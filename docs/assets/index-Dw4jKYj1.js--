var fme=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var AQe=fme((dZe,Ny)=>{(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const s of a.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function i(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerPolicy&&(a.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?a.credentials="include":n.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(n){if(n.ep)return;n.ep=!0;const a=i(n);fetch(n.href,a)}})();const VY="tournament_title_block",jY="tournaments_control",jk="tournaments_table",mme="tournament_events",GY="tournament_logo",D1="tournaments",FE="tournament",Tw="splash",hme=[D1,FE,Tw];class Ra{constructor(e){this.table=e}reloadData(e,i,r){return this.table.dataLoader.load(e,void 0,void 0,void 0,i,r)}langText(){return this.table.modules.localize.getText(...arguments)}langBind(){return this.table.modules.localize.bind(...arguments)}langLocale(){return this.table.modules.localize.getLocale(...arguments)}commsConnections(){return this.table.modules.comms.getConnections(...arguments)}commsSend(){return this.table.modules.comms.send(...arguments)}layoutMode(){return this.table.modules.layout.getMode()}layoutRefresh(e){return this.table.modules.layout.layout(e)}subscribe(){return this.table.eventBus.subscribe(...arguments)}unsubscribe(){return this.table.eventBus.unsubscribe(...arguments)}subscribed(e){return this.table.eventBus.subscribed(e)}subscriptionChange(){return this.table.eventBus.subscriptionChange(...arguments)}dispatch(){return this.table.eventBus.dispatch(...arguments)}chain(){return this.table.eventBus.chain(...arguments)}confirm(){return this.table.eventBus.confirm(...arguments)}dispatchExternal(){return this.table.externalEvents.dispatch(...arguments)}subscribedExternal(e){return this.table.externalEvents.subscribed(e)}subscriptionChangeExternal(){return this.table.externalEvents.subscriptionChange(...arguments)}options(e){return this.table.options[e]}setOption(e,i){return typeof i<"u"&&(this.table.options[e]=i),this.table.options[e]}deprecationCheck(e,i,r){return this.table.deprecationAdvisor.check(e,i,r)}deprecationCheckMsg(e,i){return this.table.deprecationAdvisor.checkMsg(e,i)}deprecationMsg(e){return this.table.deprecationAdvisor.msg(e)}module(e){return this.table.module(e)}}class gr{static elVisible(e){return!(e.offsetWidth<=0&&e.offsetHeight<=0)}static elOffset(e){var i=e.getBoundingClientRect();return{top:i.top+window.pageYOffset-document.documentElement.clientTop,left:i.left+window.pageXOffset-document.documentElement.clientLeft}}static retrieveNestedData(e,i,r){var n=e?i.split(e):[i],a=n.length,s;for(let o=0;o<a&&(r=r[n[o]],s=r,!!r);o++);return s}static deepClone(e,i,r=[]){var n={}.__proto__,a=[].__proto__;i||(i=Object.assign(Array.isArray(e)?[]:{},e));for(var s in e){let o=e[s],l,u;o!=null&&typeof o=="object"&&(o.__proto__===n||o.__proto__===a)&&(l=r.findIndex(c=>c.subject===o),l>-1?i[s]=r[l].copy:(u=Object.assign(Array.isArray(o)?[]:{},o),r.unshift({subject:o,copy:u}),i[s]=this.deepClone(o,u,r)))}return i}}let gme=class HY extends Ra{constructor(e,i,r){super(e),this.element=i,this.container=this._lookupContainer(),this.parent=r,this.reversedX=!1,this.childPopup=null,this.blurable=!1,this.blurCallback=null,this.blurEventsBound=!1,this.renderedCallback=null,this.visible=!1,this.hideable=!0,this.element.classList.add("tabulator-popup-container"),this.blurEvent=this.hide.bind(this,!1),this.escEvent=this._escapeCheck.bind(this),this.destroyBinding=this.tableDestroyed.bind(this),this.destroyed=!1}tableDestroyed(){this.destroyed=!0,this.hide(!0)}_lookupContainer(){var e=this.table.options.popupContainer;return typeof e=="string"?(e=document.querySelector(e),e||console.warn("Menu Error - no container element found matching selector:",this.table.options.popupContainer,"(defaulting to document body)")):e===!0&&(e=this.table.element),e&&!this._checkContainerIsParent(e)&&(e=!1,console.warn("Menu Error - container element does not contain this table:",this.table.options.popupContainer,"(defaulting to document body)")),e||(e=document.body),e}_checkContainerIsParent(e,i=this.table.element){return e===i?!0:i.parentNode?this._checkContainerIsParent(e,i.parentNode):!1}renderCallback(e){this.renderedCallback=e}containerEventCoords(e){var i=!(e instanceof MouseEvent),r=i?e.touches[0].pageX:e.pageX,n=i?e.touches[0].pageY:e.pageY;if(this.container!==document.body){let a=gr.elOffset(this.container);r-=a.left,n-=a.top}return{x:r,y:n}}elementPositionCoords(e,i="right"){var r=gr.elOffset(e),n,a,s;switch(this.container!==document.body&&(n=gr.elOffset(this.container),r.left-=n.left,r.top-=n.top),i){case"right":a=r.left+e.offsetWidth,s=r.top-1;break;case"bottom":a=r.left,s=r.top+e.offsetHeight;break;case"left":a=r.left,s=r.top-1;break;case"top":a=r.left,s=r.top;break;case"center":a=r.left+e.offsetWidth/2,s=r.top+e.offsetHeight/2;break}return{x:a,y:s,offset:r}}show(e,i){var r,n,a,s,o;return this.destroyed||this.table.destroyed?this:(e instanceof HTMLElement?(a=e,o=this.elementPositionCoords(e,i),s=o.offset,r=o.x,n=o.y):typeof e=="number"?(s={top:0,left:0},r=e,n=i):(o=this.containerEventCoords(e),r=o.x,n=o.y,this.reversedX=!1),this.element.style.top=n+"px",this.element.style.left=r+"px",this.container.appendChild(this.element),typeof this.renderedCallback=="function"&&this.renderedCallback(),this._fitToScreen(r,n,a,s,i),this.visible=!0,this.subscribe("table-destroy",this.destroyBinding),this.element.addEventListener("mousedown",l=>{l.stopPropagation()}),this)}_fitToScreen(e,i,r,n,a){var s=this.container===document.body?document.documentElement.scrollTop:this.container.scrollTop;(e+this.element.offsetWidth>=this.container.offsetWidth||this.reversedX)&&(this.element.style.left="",r?this.element.style.right=this.container.offsetWidth-n.left+"px":this.element.style.right=this.container.offsetWidth-e+"px",this.reversedX=!0);let o=Math.max(this.container.offsetHeight,s?this.container.scrollHeight:0);i+this.element.offsetHeight>o&&(r?a==="bottom"?this.element.style.top=parseInt(this.element.style.top)-this.element.offsetHeight-r.offsetHeight-1+"px":this.element.style.top=parseInt(this.element.style.top)-this.element.offsetHeight+r.offsetHeight+1+"px":this.element.style.height=o+"px")}isVisible(){return this.visible}hideOnBlur(e){return this.blurable=!0,this.visible&&(setTimeout(()=>{this.visible&&(this.table.rowManager.element.addEventListener("scroll",this.blurEvent),this.subscribe("cell-editing",this.blurEvent),document.body.addEventListener("click",this.blurEvent),document.body.addEventListener("contextmenu",this.blurEvent),document.body.addEventListener("mousedown",this.blurEvent),window.addEventListener("resize",this.blurEvent),document.body.addEventListener("keydown",this.escEvent),this.blurEventsBound=!0)},100),this.blurCallback=e),this}_escapeCheck(e){e.keyCode==27&&this.hide()}blockHide(){this.hideable=!1}restoreHide(){this.hideable=!0}hide(e=!1){return this.visible&&this.hideable&&(this.blurable&&this.blurEventsBound&&(document.body.removeEventListener("keydown",this.escEvent),document.body.removeEventListener("click",this.blurEvent),document.body.removeEventListener("contextmenu",this.blurEvent),document.body.removeEventListener("mousedown",this.blurEvent),window.removeEventListener("resize",this.blurEvent),this.table.rowManager.element.removeEventListener("scroll",this.blurEvent),this.unsubscribe("cell-editing",this.blurEvent),this.blurEventsBound=!1),this.childPopup&&this.childPopup.hide(),this.parent&&(this.parent.childPopup=null),this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.visible=!1,this.blurCallback&&!e&&this.blurCallback(),this.unsubscribe("table-destroy",this.destroyBinding)),this}child(e){return this.childPopup&&this.childPopup.hide(),this.childPopup=new HY(this.table,e,this),this.childPopup}};class si extends Ra{constructor(e,i){super(e),this._handler=null}initialize(){}registerTableOption(e,i){this.table.optionsList.register(e,i)}registerColumnOption(e,i){this.table.columnManager.optionsList.register(e,i)}registerTableFunction(e,i){typeof this.table[e]>"u"?this.table[e]=(...r)=>(this.table.initGuard(e),i(...r)):console.warn("Unable to bind table function, name already in use",e)}registerComponentFunction(e,i,r){return this.table.componentFunctionBinder.bind(e,i,r)}registerDataHandler(e,i){this.table.rowManager.registerDataPipelineHandler(e,i),this._handler=e}registerDisplayHandler(e,i){this.table.rowManager.registerDisplayPipelineHandler(e,i),this._handler=e}displayRows(e){var i=this.table.rowManager.displayRows.length-1,r;if(this._handler&&(r=this.table.rowManager.displayPipeline.findIndex(n=>n.handler===this._handler),r>-1&&(i=r)),e&&(i=i+e),this._handler)return i>-1?this.table.rowManager.getDisplayRows(i):this.activeRows()}activeRows(){return this.table.rowManager.activeRows}refreshData(e,i){i||(i=this._handler),i&&this.table.rowManager.refreshActiveData(i,!1,e)}footerAppend(e){return this.table.footerManager.append(e)}footerPrepend(e){return this.table.footerManager.prepend(e)}footerRemove(e){return this.table.footerManager.remove(e)}popup(e,i){return new gme(this.table,e,i)}alert(e,i){return this.table.alertManager.alert(e,i)}clearAlert(){return this.table.alertManager.clear()}}var Ime={rownum:function(t,e,i,r,n,a){return a.getPosition()}};class ND extends si{static moduleName="accessor";static accessors=Ime;constructor(e){super(e),this.allowedTypes=["","data","download","clipboard","print","htmlOutput"],this.registerColumnOption("accessor"),this.registerColumnOption("accessorParams"),this.registerColumnOption("accessorData"),this.registerColumnOption("accessorDataParams"),this.registerColumnOption("accessorDownload"),this.registerColumnOption("accessorDownloadParams"),this.registerColumnOption("accessorClipboard"),this.registerColumnOption("accessorClipboardParams"),this.registerColumnOption("accessorPrint"),this.registerColumnOption("accessorPrintParams"),this.registerColumnOption("accessorHtmlOutput"),this.registerColumnOption("accessorHtmlOutputParams")}initialize(){this.subscribe("column-layout",this.initializeColumn.bind(this)),this.subscribe("row-data-retrieve",this.transformRow.bind(this))}initializeColumn(e){var i=!1,r={};this.allowedTypes.forEach(n=>{var a="accessor"+(n.charAt(0).toUpperCase()+n.slice(1)),s;e.definition[a]&&(s=this.lookupAccessor(e.definition[a]),s&&(i=!0,r[a]={accessor:s,params:e.definition[a+"Params"]||{}}))}),i&&(e.modules.accessor=r)}lookupAccessor(e){var i=!1;switch(typeof e){case"string":ND.accessors[e]?i=ND.accessors[e]:console.warn("Accessor Error - No such accessor found, ignoring: ",e);break;case"function":i=e;break}return i}transformRow(e,i){var r="accessor"+(i.charAt(0).toUpperCase()+i.slice(1)),n=e.getComponent(),a=gr.deepClone(e.data||{});return this.table.columnManager.traverse(function(s){var o,l,u,c;s.modules.accessor&&(l=s.modules.accessor[r]||s.modules.accessor.accessor||!1,l&&(o=s.getFieldValue(a),o!="undefined"&&(c=s.getComponent(),u=typeof l.params=="function"?l.params(o,a,i,c,n):l.params,s.setFieldValue(a,l.accessor(o,a,i,u,c,n)))))}),a}}var vme={method:"GET"};function Gk(t,e){var i=[];if(e=e||"",Array.isArray(t))t.forEach((n,a)=>{i=i.concat(Gk(n,e?e+"["+a+"]":a))});else if(typeof t=="object")for(var r in t)i=i.concat(Gk(t[r],e?e+"["+r+"]":r));else i.push({key:e,value:t});return i}function yme(t){var e=Gk(t),i=[];return e.forEach(function(r){i.push(encodeURIComponent(r.key)+"="+encodeURIComponent(r.value))}),i.join("&")}function WY(t,e,i){return t&&i&&Object.keys(i).length&&(!e.method||e.method.toLowerCase()=="get")&&(e.method="get",t+=(t.includes("?")?"&":"?")+yme(i)),t}function bme(t,e,i){var r;return new Promise((n,a)=>{if(t=this.urlGenerator.call(this.table,t,e,i),e.method.toUpperCase()!="GET")if(r=typeof this.table.options.ajaxContentType=="object"?this.table.options.ajaxContentType:this.contentTypeFormatters[this.table.options.ajaxContentType],r){for(var s in r.headers)e.headers||(e.headers={}),typeof e.headers[s]>"u"&&(e.headers[s]=r.headers[s]);e.body=r.body.call(this,t,e,i)}else console.warn("Ajax Error - Invalid ajaxContentType value:",this.table.options.ajaxContentType);t?(typeof e.headers>"u"&&(e.headers={}),typeof e.headers.Accept>"u"&&(e.headers.Accept="application/json"),typeof e.headers["X-Requested-With"]>"u"&&(e.headers["X-Requested-With"]="XMLHttpRequest"),typeof e.mode>"u"&&(e.mode="cors"),e.mode=="cors"?(typeof e.headers.Origin>"u"&&(e.headers.Origin=window.location.origin),typeof e.credentials>"u"&&(e.credentials="same-origin")):typeof e.credentials>"u"&&(e.credentials="include"),fetch(t,e).then(o=>{o.ok?o.json().then(l=>{n(l)}).catch(l=>{a(l),console.warn("Ajax Load Error - Invalid JSON returned",l)}):(console.error("Ajax Load Error - Connection Error: "+o.status,o.statusText),a(o))}).catch(o=>{console.error("Ajax Load Error - Connection Error: ",o),a(o)})):(console.warn("Ajax Load Error - No URL Set"),n([]))})}function Hk(t,e){var i=[];if(e=e||"",Array.isArray(t))t.forEach((n,a)=>{i=i.concat(Hk(n,e?e+"["+a+"]":a))});else if(typeof t=="object")for(var r in t)i=i.concat(Hk(t[r],e?e+"["+r+"]":r));else i.push({key:e,value:t});return i}var wme={json:{headers:{"Content-Type":"application/json"},body:function(t,e,i){return JSON.stringify(i)}},form:{headers:{},body:function(t,e,i){var r=Hk(i),n=new FormData;return r.forEach(function(a){n.append(a.key,a.value)}),n}}};class Tg extends si{static moduleName="ajax";static defaultConfig=vme;static defaultURLGenerator=WY;static defaultLoaderPromise=bme;static contentTypeFormatters=wme;constructor(e){super(e),this.config={},this.url="",this.urlGenerator=!1,this.params=!1,this.loaderPromise=!1,this.registerTableOption("ajaxURL",!1),this.registerTableOption("ajaxURLGenerator",!1),this.registerTableOption("ajaxParams",{}),this.registerTableOption("ajaxConfig","get"),this.registerTableOption("ajaxContentType","form"),this.registerTableOption("ajaxRequestFunc",!1),this.registerTableOption("ajaxRequesting",function(){}),this.registerTableOption("ajaxResponse",!1),this.contentTypeFormatters=Tg.contentTypeFormatters}initialize(){this.loaderPromise=this.table.options.ajaxRequestFunc||Tg.defaultLoaderPromise,this.urlGenerator=this.table.options.ajaxURLGenerator||Tg.defaultURLGenerator,this.table.options.ajaxURL&&this.setUrl(this.table.options.ajaxURL),this.setDefaultConfig(this.table.options.ajaxConfig),this.registerTableFunction("getAjaxUrl",this.getUrl.bind(this)),this.subscribe("data-loading",this.requestDataCheck.bind(this)),this.subscribe("data-params",this.requestParams.bind(this)),this.subscribe("data-load",this.requestData.bind(this))}requestParams(e,i,r,n){var a=this.table.options.ajaxParams;return a&&(typeof a=="function"&&(a=a.call(this.table)),n=Object.assign(Object.assign({},a),n)),n}requestDataCheck(e,i,r,n){return!!(!e&&this.url||typeof e=="string")}requestData(e,i,r,n,a){var s;return!a&&this.requestDataCheck(e)?(e&&this.setUrl(e),s=this.generateConfig(r),this.sendRequest(this.url,i,s)):a}setDefaultConfig(e={}){this.config=Object.assign({},Tg.defaultConfig),typeof e=="string"?this.config.method=e:Object.assign(this.config,e)}generateConfig(e={}){var i=Object.assign({},this.config);return typeof e=="string"?i.method=e:Object.assign(i,e),i}setUrl(e){this.url=e}getUrl(){return this.url}sendRequest(e,i,r){return this.table.options.ajaxRequesting.call(this.table,e,i)!==!1?this.loaderPromise(e,r,i).then(n=>(this.table.options.ajaxResponse&&(n=this.table.options.ajaxResponse.call(this.table,e,i,n)),n)):Promise.reject()}}var Sme={replace:function(t){return this.table.setData(t)},update:function(t){return this.table.updateOrAddData(t)},insert:function(t){return this.table.addData(t)}},Ume={table:function(t){var e=[],i=!0,r=this.table.columnManager.columns,n=[],a=[];return t=t.split(`
`),t.forEach(function(s){e.push(s.split("	"))}),e.length&&!(e.length===1&&e[0].length<2)?(e[0].forEach(function(s){var o=r.find(function(l){return s&&l.definition.title&&s.trim()&&l.definition.title.trim()===s.trim()});o?n.push(o):i=!1}),i||(i=!0,n=[],e[0].forEach(function(s){var o=r.find(function(l){return s&&l.field&&s.trim()&&l.field.trim()===s.trim()});o?n.push(o):i=!1}),i||(n=this.table.columnManager.columnsByIndex)),i&&e.shift(),e.forEach(function(s){var o={};s.forEach(function(l,u){n[u]&&(o[n[u].field]=l)}),a.push(o)}),a):!1}},Tme={copyToClipboard:["ctrl + 67","meta + 67"]},Dme={copyToClipboard:function(t){this.table.modules.edit.currentCell||this.table.modExists("clipboard",!0)&&this.table.modules.clipboard.copy(!1,!0)}},Pme={keybindings:{bindings:Tme,actions:Dme}};class AD extends si{static moduleName="clipboard";static moduleExtensions=Pme;static pasteActions=Sme;static pasteParsers=Ume;constructor(e){super(e),this.mode=!0,this.pasteParser=function(){},this.pasteAction=function(){},this.customSelection=!1,this.rowRange=!1,this.blocked=!0,this.registerTableOption("clipboard",!1),this.registerTableOption("clipboardCopyStyled",!0),this.registerTableOption("clipboardCopyConfig",!1),this.registerTableOption("clipboardCopyFormatter",!1),this.registerTableOption("clipboardCopyRowRange","active"),this.registerTableOption("clipboardPasteParser","table"),this.registerTableOption("clipboardPasteAction","insert"),this.registerColumnOption("clipboard"),this.registerColumnOption("titleClipboard")}initialize(){this.mode=this.table.options.clipboard,this.rowRange=this.table.options.clipboardCopyRowRange,(this.mode===!0||this.mode==="copy")&&this.table.element.addEventListener("copy",e=>{var i,r,n;this.blocked||(e.preventDefault(),this.customSelection?(i=this.customSelection,this.table.options.clipboardCopyFormatter&&(i=this.table.options.clipboardCopyFormatter("plain",i))):(n=this.table.modules.export.generateExportList(this.table.options.clipboardCopyConfig,this.table.options.clipboardCopyStyled,this.rowRange,"clipboard"),r=this.table.modules.export.generateHTMLTable(n),i=r?this.generatePlainContent(n):"",this.table.options.clipboardCopyFormatter&&(i=this.table.options.clipboardCopyFormatter("plain",i),r=this.table.options.clipboardCopyFormatter("html",r))),window.clipboardData&&window.clipboardData.setData?window.clipboardData.setData("Text",i):e.clipboardData&&e.clipboardData.setData?(e.clipboardData.setData("text/plain",i),r&&e.clipboardData.setData("text/html",r)):e.originalEvent&&e.originalEvent.clipboardData.setData&&(e.originalEvent.clipboardData.setData("text/plain",i),r&&e.originalEvent.clipboardData.setData("text/html",r)),this.dispatchExternal("clipboardCopied",i,r),this.reset())}),(this.mode===!0||this.mode==="paste")&&this.table.element.addEventListener("paste",e=>{this.paste(e)}),this.setPasteParser(this.table.options.clipboardPasteParser),this.setPasteAction(this.table.options.clipboardPasteAction),this.registerTableFunction("copyToClipboard",this.copy.bind(this))}reset(){this.blocked=!0,this.customSelection=!1}generatePlainContent(e){var i=[];return e.forEach(r=>{var n=[];r.columns.forEach(a=>{var s="";if(a)if(r.type==="group"&&(a.value=a.component.getKey()),a.value===null)s="";else switch(typeof a.value){case"object":s=JSON.stringify(a.value);break;case"undefined":s="";break;default:s=a.value}n.push(s)}),i.push(n.join("	"))}),i.join(`
`)}copy(e,i){var r,n;this.blocked=!1,this.customSelection=!1,(this.mode===!0||this.mode==="copy")&&(this.rowRange=e||this.table.options.clipboardCopyRowRange,typeof window.getSelection<"u"&&typeof document.createRange<"u"?(e=document.createRange(),e.selectNodeContents(this.table.element),r=window.getSelection(),r.toString()&&i&&(this.customSelection=r.toString()),r.removeAllRanges(),r.addRange(e)):typeof document.selection<"u"&&typeof document.body.createTextRange<"u"&&(n=document.body.createTextRange(),n.moveToElementText(this.table.element),n.select()),document.execCommand("copy"),r&&r.removeAllRanges())}setPasteAction(e){switch(typeof e){case"string":this.pasteAction=AD.pasteActions[e],this.pasteAction||console.warn("Clipboard Error - No such paste action found:",e);break;case"function":this.pasteAction=e;break}}setPasteParser(e){switch(typeof e){case"string":this.pasteParser=AD.pasteParsers[e],this.pasteParser||console.warn("Clipboard Error - No such paste parser found:",e);break;case"function":this.pasteParser=e;break}}paste(e){var i,r,n;this.checkPasteOrigin(e)&&(i=this.getPasteData(e),r=this.pasteParser.call(this,i),r?(e.preventDefault(),this.table.modExists("mutator")&&(r=this.mutateData(r)),n=this.pasteAction.call(this,r),this.dispatchExternal("clipboardPasted",i,r,n)):this.dispatchExternal("clipboardPasteError",i))}mutateData(e){var i=[];return Array.isArray(e)?e.forEach(r=>{i.push(this.table.modules.mutator.transformRow(r,"clipboard"))}):i=e,i}checkPasteOrigin(e){var i=!0,r=this.confirm("clipboard-paste",[e]);return(r||!["DIV","SPAN"].includes(e.target.tagName))&&(i=!1),i}getPasteData(e){var i;return window.clipboardData&&window.clipboardData.getData?i=window.clipboardData.getData("Text"):e.clipboardData&&e.clipboardData.getData?i=e.clipboardData.getData("text/plain"):e.originalEvent&&e.originalEvent.clipboardData.getData&&(i=e.originalEvent.clipboardData.getData("text/plain")),i}}class Eme{constructor(e){return this._row=e,new Proxy(this,{get:function(i,r,n){return typeof i[r]<"u"?i[r]:i._row.table.componentFunctionBinder.handle("row",i._row,r)}})}getData(e){return this._row.getData(e)}getElement(){return this._row.getElement()}getTable(){return this._row.table}getCells(){var e=[];return this._row.getCells().forEach(function(i){e.push(i.getComponent())}),e}getCell(e){var i=this._row.getCell(e);return i?i.getComponent():!1}_getSelf(){return this._row}}class zY{constructor(e){return this._cell=e,new Proxy(this,{get:function(i,r,n){return typeof i[r]<"u"?i[r]:i._cell.table.componentFunctionBinder.handle("cell",i._cell,r)}})}getValue(){return this._cell.getValue()}getOldValue(){return this._cell.getOldValue()}getInitialValue(){return this._cell.initialValue}getElement(){return this._cell.getElement()}getRow(){return this._cell.row.getComponent()}getData(e){return this._cell.row.getData(e)}getType(){return"cell"}getField(){return this._cell.column.getField()}getColumn(){return this._cell.column.getComponent()}setValue(e,i){typeof i>"u"&&(i=!0),this._cell.setValue(e,i)}restoreOldValue(){this._cell.setValueActual(this._cell.getOldValue())}restoreInitialValue(){this._cell.setValueActual(this._cell.initialValue)}checkHeight(){this._cell.checkHeight()}getTable(){return this._cell.table}_getSelf(){return this._cell}}class Dw extends Ra{constructor(e,i){super(e.table),this.table=e.table,this.column=e,this.row=i,this.element=null,this.value=null,this.initialValue,this.oldValue=null,this.modules={},this.height=null,this.width=null,this.minWidth=null,this.component=null,this.loaded=!1,this.build()}build(){this.generateElement(),this.setWidth(),this._configureCell(),this.setValueActual(this.column.getFieldValue(this.row.data)),this.initialValue=this.value}generateElement(){this.element=document.createElement("div"),this.element.className="tabulator-cell",this.element.setAttribute("role","gridcell"),this.column.isRowHeader&&this.element.classList.add("tabulator-row-header")}_configureCell(){var e=this.element,i=this.column.getField(),r={top:"flex-start",bottom:"flex-end",middle:"center"},n={left:"flex-start",right:"flex-end",center:"center"};if(e.style.textAlign=this.column.hozAlign,this.column.vertAlign&&(e.style.display="inline-flex",e.style.alignItems=r[this.column.vertAlign]||"",this.column.hozAlign&&(e.style.justifyContent=n[this.column.hozAlign]||"")),i&&e.setAttribute("tabulator-field",i),this.column.definition.cssClass){var a=this.column.definition.cssClass.split(" ");a.forEach(s=>{e.classList.add(s)})}this.dispatch("cell-init",this),this.column.visible||this.hide()}_generateContents(){var e;switch(e=this.chain("cell-format",this,null,()=>this.element.innerHTML=this.value),typeof e){case"object":if(e instanceof Node){for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.element.appendChild(e)}else this.element.innerHTML="",e!=null&&console.warn("Format Error - Formatter has returned a type of object, the only valid formatter object return is an instance of Node, the formatter returned:",e);break;case"undefined":this.element.innerHTML="";break;default:this.element.innerHTML=e}}cellRendered(){this.dispatch("cell-rendered",this)}getElement(e){return this.loaded||(this.loaded=!0,e||this.layoutElement()),this.element}getValue(){return this.value}getOldValue(){return this.oldValue}setValue(e,i,r){var n=this.setValueProcessData(e,i,r);n&&(this.dispatch("cell-value-updated",this),this.cellRendered(),this.column.definition.cellEdited&&this.column.definition.cellEdited.call(this.table,this.getComponent()),this.dispatchExternal("cellEdited",this.getComponent()),this.subscribedExternal("dataChanged")&&this.dispatchExternal("dataChanged",this.table.rowManager.getData()))}setValueProcessData(e,i,r){var n=!1;return(this.value!==e||r)&&(n=!0,i&&(e=this.chain("cell-value-changing",[this,e],null,e))),this.setValueActual(e),n&&this.dispatch("cell-value-changed",this),n}setValueActual(e){this.oldValue=this.value,this.value=e,this.dispatch("cell-value-save-before",this),this.column.setFieldValue(this.row.data,e),this.dispatch("cell-value-save-after",this),this.loaded&&this.layoutElement()}layoutElement(){this._generateContents(),this.dispatch("cell-layout",this)}setWidth(){this.width=this.column.width,this.element.style.width=this.column.widthStyled}clearWidth(){this.width="",this.element.style.width=""}getWidth(){return this.width||this.element.offsetWidth}setMinWidth(){this.minWidth=this.column.minWidth,this.element.style.minWidth=this.column.minWidthStyled}setMaxWidth(){this.maxWidth=this.column.maxWidth,this.element.style.maxWidth=this.column.maxWidthStyled}checkHeight(){this.row.reinitializeHeight()}clearHeight(){this.element.style.height="",this.height=null,this.dispatch("cell-height",this,"")}setHeight(){this.height=this.row.height,this.element.style.height=this.row.heightStyled,this.dispatch("cell-height",this,this.row.heightStyled)}getHeight(){return this.height||this.element.offsetHeight}show(){this.element.style.display=this.column.vertAlign?"inline-flex":""}hide(){this.element.style.display="none"}delete(){this.dispatch("cell-delete",this),!this.table.rowManager.redrawBlock&&this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.element=!1,this.column.deleteCell(this),this.row.deleteCell(this),this.calcs={}}getIndex(){return this.row.getCellIndex(this)}getComponent(){return this.component||(this.component=new zY(this)),this.component}}class qY{constructor(e){return this._column=e,this.type="ColumnComponent",new Proxy(this,{get:function(i,r,n){return typeof i[r]<"u"?i[r]:i._column.table.componentFunctionBinder.handle("column",i._column,r)}})}getElement(){return this._column.getElement()}getDefinition(){return this._column.getDefinition()}getField(){return this._column.getField()}getTitleDownload(){return this._column.getTitleDownload()}getCells(){var e=[];return this._column.cells.forEach(function(i){e.push(i.getComponent())}),e}isVisible(){return this._column.visible}show(){this._column.isGroup?this._column.columns.forEach(function(e){e.show()}):this._column.show()}hide(){this._column.isGroup?this._column.columns.forEach(function(e){e.hide()}):this._column.hide()}toggle(){this._column.visible?this.hide():this.show()}delete(){return this._column.delete()}getSubColumns(){var e=[];return this._column.columns.length&&this._column.columns.forEach(function(i){e.push(i.getComponent())}),e}getParentColumn(){return this._column.getParentComponent()}_getSelf(){return this._column}scrollTo(e,i){return this._column.table.columnManager.scrollToColumn(this._column,e,i)}getTable(){return this._column.table}move(e,i){var r=this._column.table.columnManager.findColumn(e);r?this._column.table.columnManager.moveColumn(this._column,r,i):console.warn("Move Error - No matching column found:",r)}getNextColumn(){var e=this._column.nextColumn();return e?e.getComponent():!1}getPrevColumn(){var e=this._column.prevColumn();return e?e.getComponent():!1}updateDefinition(e){return this._column.updateDefinition(e)}getWidth(){return this._column.getWidth()}setWidth(e){var i;return e===!0?i=this._column.reinitializeWidth(!0):i=this._column.setWidth(e),this._column.table.columnManager.rerenderColumns(!0),i}}var YY={title:void 0,field:void 0,columns:void 0,visible:void 0,hozAlign:void 0,vertAlign:void 0,width:void 0,minWidth:40,maxWidth:void 0,maxInitialWidth:void 0,cssClass:void 0,variableHeight:void 0,headerVertical:void 0,headerHozAlign:void 0,headerWordWrap:!1,editableTitle:void 0};class Vu extends Ra{static defaultOptionList=YY;constructor(e,i,r){super(i.table),this.definition=e,this.parent=i,this.type="column",this.columns=[],this.cells=[],this.isGroup=!1,this.isRowHeader=r,this.element=this.createElement(),this.contentElement=!1,this.titleHolderElement=!1,this.titleElement=!1,this.groupElement=this.createGroupElement(),this.hozAlign="",this.vertAlign="",this.field="",this.fieldStructure="",this.getFieldValue="",this.setFieldValue="",this.titleDownload=null,this.titleFormatterRendered=!1,this.mapDefinitions(),this.setField(this.definition.field),this.modules={},this.width=null,this.widthStyled="",this.maxWidth=null,this.maxWidthStyled="",this.maxInitialWidth=null,this.minWidth=null,this.minWidthStyled="",this.widthFixed=!1,this.visible=!0,this.component=null,this.definition.columns?(this.isGroup=!0,this.definition.columns.forEach((n,a)=>{var s=new Vu(n,this);this.attachColumn(s)}),this.checkColumnVisibility()):i.registerColumnField(this),this._initialize()}createElement(){var e=document.createElement("div");switch(e.classList.add("tabulator-col"),e.setAttribute("role","columnheader"),e.setAttribute("aria-sort","none"),this.isRowHeader&&e.classList.add("tabulator-row-header"),this.table.options.columnHeaderVertAlign){case"middle":e.style.justifyContent="center";break;case"bottom":e.style.justifyContent="flex-end";break}return e}createGroupElement(){var e=document.createElement("div");return e.classList.add("tabulator-col-group-cols"),e}mapDefinitions(){var e=this.table.options.columnDefaults;if(e)for(let i in e)typeof this.definition[i]>"u"&&(this.definition[i]=e[i]);this.definition=this.table.columnManager.optionsList.generate(Vu.defaultOptionList,this.definition)}checkDefinition(){Object.keys(this.definition).forEach(e=>{Vu.defaultOptionList.indexOf(e)===-1&&console.warn("Invalid column definition option in '"+(this.field||this.definition.title)+"' column:",e)})}setField(e){this.field=e,this.fieldStructure=e?this.table.options.nestedFieldSeparator?e.split(this.table.options.nestedFieldSeparator):[e]:[],this.getFieldValue=this.fieldStructure.length>1?this._getNestedData:this._getFlatData,this.setFieldValue=this.fieldStructure.length>1?this._setNestedData:this._setFlatData}registerColumnPosition(e){this.parent.registerColumnPosition(e)}registerColumnField(e){this.parent.registerColumnField(e)}reRegisterPosition(){this.isGroup?this.columns.forEach(function(e){e.reRegisterPosition()}):this.registerColumnPosition(this)}_initialize(){for(var e=this.definition;this.element.firstChild;)this.element.removeChild(this.element.firstChild);e.headerVertical&&(this.element.classList.add("tabulator-col-vertical"),e.headerVertical==="flip"&&this.element.classList.add("tabulator-col-vertical-flip")),this.contentElement=this._buildColumnHeaderContent(),this.element.appendChild(this.contentElement),this.isGroup?this._buildGroupHeader():this._buildColumnHeader(),this.dispatch("column-init",this)}_buildColumnHeader(){var e=this.definition;if(this.dispatch("column-layout",this),typeof e.visible<"u"&&(e.visible?this.show(!0):this.hide(!0)),e.cssClass){var i=e.cssClass.split(" ");i.forEach(r=>{this.element.classList.add(r)})}e.field&&this.element.setAttribute("tabulator-field",e.field),this.setMinWidth(parseInt(e.minWidth)),e.maxInitialWidth&&(this.maxInitialWidth=parseInt(e.maxInitialWidth)),e.maxWidth&&this.setMaxWidth(parseInt(e.maxWidth)),this.reinitializeWidth(),this.hozAlign=this.definition.hozAlign,this.vertAlign=this.definition.vertAlign,this.titleElement.style.textAlign=this.definition.headerHozAlign}_buildColumnHeaderContent(){var e=document.createElement("div");return e.classList.add("tabulator-col-content"),this.titleHolderElement=document.createElement("div"),this.titleHolderElement.classList.add("tabulator-col-title-holder"),e.appendChild(this.titleHolderElement),this.titleElement=this._buildColumnHeaderTitle(),this.titleHolderElement.appendChild(this.titleElement),e}_buildColumnHeaderTitle(){var e=this.definition,i=document.createElement("div");if(i.classList.add("tabulator-col-title"),e.headerWordWrap&&i.classList.add("tabulator-col-title-wrap"),e.editableTitle){var r=document.createElement("input");r.classList.add("tabulator-title-editor"),r.addEventListener("click",n=>{n.stopPropagation(),r.focus()}),r.addEventListener("mousedown",n=>{n.stopPropagation()}),r.addEventListener("change",()=>{e.title=r.value,this.dispatchExternal("columnTitleChanged",this.getComponent())}),i.appendChild(r),e.field?this.langBind("columns|"+e.field,n=>{r.value=n||e.title||"&nbsp;"}):r.value=e.title||"&nbsp;"}else e.field?this.langBind("columns|"+e.field,n=>{this._formatColumnHeaderTitle(i,n||e.title||"&nbsp;")}):this._formatColumnHeaderTitle(i,e.title||"&nbsp;");return i}_formatColumnHeaderTitle(e,i){var r=this.chain("column-format",[this,i,e],null,()=>i);switch(typeof r){case"object":r instanceof Node?e.appendChild(r):(e.innerHTML="",console.warn("Format Error - Title formatter has returned a type of object, the only valid formatter object return is an instance of Node, the formatter returned:",r));break;case"undefined":e.innerHTML="";break;default:e.innerHTML=r}}_buildGroupHeader(){if(this.element.classList.add("tabulator-col-group"),this.element.setAttribute("role","columngroup"),this.element.setAttribute("aria-title",this.definition.title),this.definition.cssClass){var e=this.definition.cssClass.split(" ");e.forEach(i=>{this.element.classList.add(i)})}this.titleElement.style.textAlign=this.definition.headerHozAlign,this.element.appendChild(this.groupElement)}_getFlatData(e){return e[this.field]}_getNestedData(e){var i=e,r=this.fieldStructure,n=r.length,a;for(let s=0;s<n&&(i=i[r[s]],a=i,!!i);s++);return a}_setFlatData(e,i){this.field&&(e[this.field]=i)}_setNestedData(e,i){var r=e,n=this.fieldStructure,a=n.length;for(let s=0;s<a;s++)if(s==a-1)r[n[s]]=i;else{if(!r[n[s]])if(typeof i<"u")r[n[s]]={};else break;r=r[n[s]]}}attachColumn(e){this.groupElement?(this.columns.push(e),this.groupElement.appendChild(e.getElement()),e.columnRendered()):console.warn("Column Warning - Column being attached to another column instead of column group")}verticalAlign(e,i){var r=this.parent.isGroup?this.parent.getGroupElement().clientHeight:i||this.parent.getHeadersElement().clientHeight;this.element.style.height=r+"px",this.dispatch("column-height",this,this.element.style.height),this.isGroup&&(this.groupElement.style.minHeight=r-this.contentElement.offsetHeight+"px"),this.columns.forEach(function(n){n.verticalAlign(e)})}clearVerticalAlign(){this.element.style.paddingTop="",this.element.style.height="",this.element.style.minHeight="",this.groupElement.style.minHeight="",this.columns.forEach(function(e){e.clearVerticalAlign()}),this.dispatch("column-height",this,"")}getElement(){return this.element}getGroupElement(){return this.groupElement}getField(){return this.field}getTitleDownload(){return this.titleDownload}getFirstColumn(){return this.isGroup?this.columns.length?this.columns[0].getFirstColumn():!1:this}getLastColumn(){return this.isGroup?this.columns.length?this.columns[this.columns.length-1].getLastColumn():!1:this}getColumns(e){var i=[];return e?this.columns.forEach(r=>{i.push(r),i=i.concat(r.getColumns(!0))}):i=this.columns,i}getCells(){return this.cells}getTopColumn(){return this.parent.isGroup?this.parent.getTopColumn():this}getDefinition(e){var i=[];return this.isGroup&&e&&(this.columns.forEach(function(r){i.push(r.getDefinition(!0))}),this.definition.columns=i),this.definition}checkColumnVisibility(){var e=!1;this.columns.forEach(function(i){i.visible&&(e=!0)}),e?(this.show(),this.dispatchExternal("columnVisibilityChanged",this.getComponent(),!1)):this.hide()}show(e,i){this.visible||(this.visible=!0,this.element.style.display="",this.parent.isGroup&&this.parent.checkColumnVisibility(),this.cells.forEach(function(r){r.show()}),!this.isGroup&&this.width===null&&this.reinitializeWidth(),this.table.columnManager.verticalAlignHeaders(),this.dispatch("column-show",this,i),e||this.dispatchExternal("columnVisibilityChanged",this.getComponent(),!0),this.parent.isGroup&&this.parent.matchChildWidths(),this.silent||this.table.columnManager.rerenderColumns())}hide(e,i){this.visible&&(this.visible=!1,this.element.style.display="none",this.table.columnManager.verticalAlignHeaders(),this.parent.isGroup&&this.parent.checkColumnVisibility(),this.cells.forEach(function(r){r.hide()}),this.dispatch("column-hide",this,i),e||this.dispatchExternal("columnVisibilityChanged",this.getComponent(),!1),this.parent.isGroup&&this.parent.matchChildWidths(),this.silent||this.table.columnManager.rerenderColumns())}matchChildWidths(){var e=0;this.contentElement&&this.columns.length&&(this.columns.forEach(function(i){i.visible&&(e+=i.getWidth())}),this.contentElement.style.maxWidth=e-1+"px",this.table.initialized&&(this.element.style.width=e+"px"),this.parent.isGroup&&this.parent.matchChildWidths())}removeChild(e){var i=this.columns.indexOf(e);i>-1&&this.columns.splice(i,1),this.columns.length||this.delete()}setWidth(e){this.widthFixed=!0,this.setWidthActual(e)}setWidthActual(e){isNaN(e)&&(e=Math.floor(this.table.element.clientWidth/100*parseInt(e))),e=Math.max(this.minWidth,e),this.maxWidth&&(e=Math.min(this.maxWidth,e)),this.width=e,this.widthStyled=e?e+"px":"",this.element.style.width=this.widthStyled,this.isGroup||this.cells.forEach(function(i){i.setWidth()}),this.parent.isGroup&&this.parent.matchChildWidths(),this.dispatch("column-width",this),this.subscribedExternal("columnWidth")&&this.dispatchExternal("columnWidth",this.getComponent())}checkCellHeights(){var e=[];this.cells.forEach(function(i){i.row.heightInitialized&&(i.row.getElement().offsetParent!==null?(e.push(i.row),i.row.clearCellHeight()):i.row.heightInitialized=!1)}),e.forEach(function(i){i.calcHeight()}),e.forEach(function(i){i.setCellHeight()})}getWidth(){var e=0;return this.isGroup?this.columns.forEach(function(i){i.visible&&(e+=i.getWidth())}):e=this.width,e}getLeftOffset(){var e=this.element.offsetLeft;return this.parent.isGroup&&(e+=this.parent.getLeftOffset()),e}getHeight(){return Math.ceil(this.element.getBoundingClientRect().height)}setMinWidth(e){this.maxWidth&&e>this.maxWidth&&(e=this.maxWidth,console.warn("the minWidth ("+e+"px) for column '"+this.field+"' cannot be bigger that its maxWidth ("+this.maxWidthStyled+")")),this.minWidth=e,this.minWidthStyled=e?e+"px":"",this.element.style.minWidth=this.minWidthStyled,this.cells.forEach(function(i){i.setMinWidth()})}setMaxWidth(e){this.minWidth&&e<this.minWidth&&(e=this.minWidth,console.warn("the maxWidth ("+e+"px) for column '"+this.field+"' cannot be smaller that its minWidth ("+this.minWidthStyled+")")),this.maxWidth=e,this.maxWidthStyled=e?e+"px":"",this.element.style.maxWidth=this.maxWidthStyled,this.cells.forEach(function(i){i.setMaxWidth()})}delete(){return new Promise((e,i)=>{this.isGroup&&this.columns.forEach(function(n){n.delete()}),this.dispatch("column-delete",this);var r=this.cells.length;for(let n=0;n<r;n++)this.cells[0].delete();this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.element=!1,this.contentElement=!1,this.titleElement=!1,this.groupElement=!1,this.parent.isGroup&&this.parent.removeChild(this),this.table.columnManager.deregisterColumn(this),this.table.columnManager.rerenderColumns(!0),this.dispatch("column-deleted",this),e()})}columnRendered(){this.titleFormatterRendered&&this.titleFormatterRendered(),this.dispatch("column-rendered",this)}generateCell(e){var i=new Dw(this,e);return this.cells.push(i),i}nextColumn(){var e=this.table.columnManager.findColumnIndex(this);return e>-1?this._nextVisibleColumn(e+1):!1}_nextVisibleColumn(e){var i=this.table.columnManager.getColumnByIndex(e);return!i||i.visible?i:this._nextVisibleColumn(e+1)}prevColumn(){var e=this.table.columnManager.findColumnIndex(this);return e>-1?this._prevVisibleColumn(e-1):!1}_prevVisibleColumn(e){var i=this.table.columnManager.getColumnByIndex(e);return!i||i.visible?i:this._prevVisibleColumn(e-1)}reinitializeWidth(e){this.widthFixed=!1,typeof this.definition.width<"u"&&!e&&this.setWidth(this.definition.width),this.dispatch("column-width-fit-before",this),this.fitToData(e),this.dispatch("column-width-fit-after",this)}fitToData(e){if(!this.isGroup){this.widthFixed||(this.element.style.width="",this.cells.forEach(n=>{n.clearWidth()}));var i=this.element.offsetWidth;if((!this.width||!this.widthFixed)&&(this.cells.forEach(n=>{var a=n.getWidth();a>i&&(i=a)}),i)){var r=i+1;e?this.setWidth(r):(this.maxInitialWidth&&!e&&(r=Math.min(r,this.maxInitialWidth)),this.setWidthActual(r))}}}updateDefinition(e){var i;return this.isGroup||this.parent.isGroup?(console.error("Column Update Error - The updateDefinition function is only available on ungrouped columns"),Promise.reject("Column Update Error - The updateDefinition function is only available on columns, not column groups")):(i=Object.assign({},this.getDefinition()),i=Object.assign(i,e),this.table.columnManager.addColumn(i,!1,this).then(r=>(i.field==this.field&&(this.field=!1),this.delete().then(()=>r.getComponent()))))}deleteCell(e){var i=this.cells.indexOf(e);i>-1&&this.cells.splice(i,1)}getComponent(){return this.component||(this.component=new qY(this)),this.component}getPosition(){return this.table.columnManager.getVisibleColumnsByIndex().indexOf(this)+1}getParentComponent(){return this.parent instanceof Vu?this.parent.getComponent():!1}}class LE{constructor(e){return this._row=e,new Proxy(this,{get:function(i,r,n){return typeof i[r]<"u"?i[r]:i._row.table.componentFunctionBinder.handle("row",i._row,r)}})}getData(e){return this._row.getData(e)}getElement(){return this._row.getElement()}getCells(){var e=[];return this._row.getCells().forEach(function(i){e.push(i.getComponent())}),e}getCell(e){var i=this._row.getCell(e);return i?i.getComponent():!1}getIndex(){return this._row.getData("data")[this._row.table.options.index]}getPosition(){return this._row.getPosition()}watchPosition(e){return this._row.watchPosition(e)}delete(){return this._row.delete()}scrollTo(e,i){return this._row.table.rowManager.scrollToRow(this._row,e,i)}move(e,i){this._row.moveToRow(e,i)}update(e){return this._row.updateData(e)}normalizeHeight(){this._row.normalizeHeight(!0)}_getSelf(){return this._row}reformat(){return this._row.reinitialize()}getTable(){return this._row.table}getNextRow(){var e=this._row.nextRow();return e&&e.getComponent()}getPrevRow(){var e=this._row.prevRow();return e&&e.getComponent()}}class Ca extends Ra{constructor(e,i,r="row"){super(i.table),this.parent=i,this.data={},this.type=r,this.element=!1,this.modules={},this.cells=[],this.height=0,this.heightStyled="",this.manualHeight=!1,this.outerHeight=0,this.initialized=!1,this.heightInitialized=!1,this.position=0,this.positionWatchers=[],this.component=null,this.created=!1,this.setData(e)}create(){this.created||(this.created=!0,this.generateElement())}createElement(){var e=document.createElement("div");e.classList.add("tabulator-row"),e.setAttribute("role","row"),this.element=e}getElement(){return this.create(),this.element}detachElement(){this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element)}generateElement(){this.createElement(),this.dispatch("row-init",this)}generateCells(){this.cells=this.table.columnManager.generateCells(this)}initialize(e,i){if(this.create(),!this.initialized||e){for(this.deleteCells();this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.dispatch("row-layout-before",this),this.generateCells(),this.initialized=!0,this.table.columnManager.renderer.renderRowCells(this,i),e&&this.normalizeHeight(),this.dispatch("row-layout",this),this.table.options.rowFormatter&&this.table.options.rowFormatter(this.getComponent()),this.dispatch("row-layout-after",this)}else this.table.columnManager.renderer.rerenderRowCells(this,i)}rendered(){this.cells.forEach(e=>{e.cellRendered()})}reinitializeHeight(){this.heightInitialized=!1,this.element&&this.element.offsetParent!==null&&this.normalizeHeight(!0)}deinitialize(){this.initialized=!1}deinitializeHeight(){this.heightInitialized=!1}reinitialize(e){this.initialized=!1,this.heightInitialized=!1,this.manualHeight||(this.height=0,this.heightStyled=""),this.element&&this.element.offsetParent!==null&&this.initialize(!0),this.dispatch("row-relayout",this)}calcHeight(e){var i=0,r=0;this.table.options.rowHeight?this.height=this.table.options.rowHeight:(r=this.calcMinHeight(),i=this.calcMaxHeight(),e?this.height=Math.max(i,r):this.height=this.manualHeight?this.height:Math.max(i,r)),this.heightStyled=this.height?this.height+"px":"",this.outerHeight=this.element.offsetHeight}calcMinHeight(){return this.table.options.resizableRows?this.element.clientHeight:0}calcMaxHeight(){var e=0;return this.cells.forEach(function(i){var r=i.getHeight();r>e&&(e=r)}),e}setCellHeight(){this.cells.forEach(function(e){e.setHeight()}),this.heightInitialized=!0}clearCellHeight(){this.cells.forEach(function(e){e.clearHeight()})}normalizeHeight(e){e&&!this.table.options.rowHeight&&this.clearCellHeight(),this.calcHeight(e),this.setCellHeight()}setHeight(e,i){(this.height!=e||i)&&(this.manualHeight=!0,this.height=e,this.heightStyled=e?e+"px":"",this.setCellHeight(),this.outerHeight=this.element.offsetHeight,this.subscribedExternal("rowHeight")&&this.dispatchExternal("rowHeight",this.getComponent()))}getHeight(){return this.outerHeight}getWidth(){return this.element.offsetWidth}deleteCell(e){var i=this.cells.indexOf(e);i>-1&&this.cells.splice(i,1)}setData(e){this.data=this.chain("row-data-init-before",[this,e],void 0,e),this.dispatch("row-data-init-after",this)}updateData(e){var i=this.element&&gr.elVisible(this.element),r={},n;return new Promise((a,s)=>{typeof e=="string"&&(e=JSON.parse(e)),this.dispatch("row-data-save-before",this),this.subscribed("row-data-changing")&&(r=Object.assign(r,this.data),r=Object.assign(r,e)),n=this.chain("row-data-changing",[this,r,e],null,e);for(let o in n)this.data[o]=n[o];this.dispatch("row-data-save-after",this);for(let o in e)this.table.columnManager.getColumnsByFieldRoot(o).forEach(u=>{let c=this.getCell(u.getField());if(c){let d=u.getFieldValue(n);c.getValue()!==d&&(c.setValueProcessData(d),i&&c.cellRendered())}});i?(this.normalizeHeight(!0),this.table.options.rowFormatter&&this.table.options.rowFormatter(this.getComponent())):(this.initialized=!1,this.height=0,this.heightStyled=""),this.dispatch("row-data-changed",this,i,e),this.dispatchExternal("rowUpdated",this.getComponent()),this.subscribedExternal("dataChanged")&&this.dispatchExternal("dataChanged",this.table.rowManager.getData()),a()})}getData(e){return e?this.chain("row-data-retrieve",[this,e],null,this.data):this.data}getCell(e){var i=!1;return e=this.table.columnManager.findColumn(e),!this.initialized&&this.cells.length===0&&this.generateCells(),i=this.cells.find(function(r){return r.column===e}),i}getCellIndex(e){return this.cells.findIndex(function(i){return i===e})}findCell(e){return this.cells.find(i=>i.element===e)}getCells(){return!this.initialized&&this.cells.length===0&&this.generateCells(),this.cells}nextRow(){var e=this.table.rowManager.nextDisplayRow(this,!0);return e||!1}prevRow(){var e=this.table.rowManager.prevDisplayRow(this,!0);return e||!1}moveToRow(e,i){var r=this.table.rowManager.findRow(e);r?(this.table.rowManager.moveRowActual(this,r,!i),this.table.rowManager.refreshActiveData("display",!1,!0)):console.warn("Move Error - No matching row found:",e)}delete(){return this.dispatch("row-delete",this),this.deleteActual(),Promise.resolve()}deleteActual(e){this.detachModules(),this.table.rowManager.deleteRow(this,e),this.deleteCells(),this.initialized=!1,this.heightInitialized=!1,this.element=!1,this.dispatch("row-deleted",this)}detachModules(){this.dispatch("row-deleting",this)}deleteCells(){var e=this.cells.length;for(let i=0;i<e;i++)this.cells[0].delete()}wipe(){if(this.detachModules(),this.deleteCells(),this.element){for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.element.parentNode&&this.element.parentNode.removeChild(this.element)}this.element=!1,this.modules={}}isDisplayed(){return this.table.rowManager.getDisplayRows().includes(this)}getPosition(){return this.isDisplayed()?this.position:!1}setPosition(e){e!=this.position&&(this.position=e,this.positionWatchers.forEach(i=>{i(this.position)}))}watchPosition(e){this.positionWatchers.push(e),e(this.position)}getGroup(){return this.modules.group||!1}getComponent(){return this.component||(this.component=new LE(this)),this.component}}var Rme={avg:function(t,e,i){var r=0,n=typeof i.precision<"u"?i.precision:2;return t.length&&(r=t.reduce(function(a,s){return Number(a)+Number(s)}),r=r/t.length,r=n!==!1?r.toFixed(n):r),parseFloat(r).toString()},max:function(t,e,i){var r=null,n=typeof i.precision<"u"?i.precision:!1;return t.forEach(function(a){a=Number(a),(a>r||r===null)&&(r=a)}),r!==null?n!==!1?r.toFixed(n):r:""},min:function(t,e,i){var r=null,n=typeof i.precision<"u"?i.precision:!1;return t.forEach(function(a){a=Number(a),(a<r||r===null)&&(r=a)}),r!==null?n!==!1?r.toFixed(n):r:""},sum:function(t,e,i){var r=0,n=typeof i.precision<"u"?i.precision:!1;return t.length&&t.forEach(function(a){a=Number(a),r+=isNaN(a)?0:Number(a)}),n!==!1?r.toFixed(n):r},concat:function(t,e,i){var r=0;return t.length&&(r=t.reduce(function(n,a){return String(n)+String(a)})),r},count:function(t,e,i){var r=0;return t.length&&t.forEach(function(n){n&&r++}),r},unique:function(t,e,i){var r=t.filter((n,a)=>(t||n===0)&&t.indexOf(n)===a);return r.length}};class Dg extends si{static moduleName="columnCalcs";static calculations=Rme;constructor(e){super(e),this.topCalcs=[],this.botCalcs=[],this.genColumn=!1,this.topElement=this.createElement(),this.botElement=this.createElement(),this.topRow=!1,this.botRow=!1,this.topInitialized=!1,this.botInitialized=!1,this.blocked=!1,this.recalcAfterBlock=!1,this.registerTableOption("columnCalcs",!0),this.registerColumnOption("topCalc"),this.registerColumnOption("topCalcParams"),this.registerColumnOption("topCalcFormatter"),this.registerColumnOption("topCalcFormatterParams"),this.registerColumnOption("bottomCalc"),this.registerColumnOption("bottomCalcParams"),this.registerColumnOption("bottomCalcFormatter"),this.registerColumnOption("bottomCalcFormatterParams")}createElement(){var e=document.createElement("div");return e.classList.add("tabulator-calcs-holder"),e}initialize(){this.genColumn=new Vu({field:"value"},this),this.subscribe("cell-value-changed",this.cellValueChanged.bind(this)),this.subscribe("column-init",this.initializeColumnCheck.bind(this)),this.subscribe("row-deleted",this.rowsUpdated.bind(this)),this.subscribe("scroll-horizontal",this.scrollHorizontal.bind(this)),this.subscribe("row-added",this.rowsUpdated.bind(this)),this.subscribe("column-moved",this.recalcActiveRows.bind(this)),this.subscribe("column-add",this.recalcActiveRows.bind(this)),this.subscribe("data-refreshed",this.recalcActiveRowsRefresh.bind(this)),this.subscribe("table-redraw",this.tableRedraw.bind(this)),this.subscribe("rows-visible",this.visibleRows.bind(this)),this.subscribe("scrollbar-vertical",this.adjustForScrollbar.bind(this)),this.subscribe("redraw-blocked",this.blockRedraw.bind(this)),this.subscribe("redraw-restored",this.restoreRedraw.bind(this)),this.subscribe("table-redrawing",this.resizeHolderWidth.bind(this)),this.subscribe("column-resized",this.resizeHolderWidth.bind(this)),this.subscribe("column-show",this.resizeHolderWidth.bind(this)),this.subscribe("column-hide",this.resizeHolderWidth.bind(this)),this.registerTableFunction("getCalcResults",this.getResults.bind(this)),this.registerTableFunction("recalc",this.userRecalc.bind(this)),this.resizeHolderWidth()}resizeHolderWidth(){this.topElement.style.minWidth=this.table.columnManager.headersElement.offsetWidth+"px"}tableRedraw(e){this.recalc(this.table.rowManager.activeRows),e&&this.redraw()}blockRedraw(){this.blocked=!0,this.recalcAfterBlock=!1}restoreRedraw(){this.blocked=!1,this.recalcAfterBlock&&(this.recalcAfterBlock=!1,this.recalcActiveRowsRefresh())}userRecalc(){this.recalc(this.table.rowManager.activeRows)}blockCheck(){return this.blocked&&(this.recalcAfterBlock=!0),this.blocked}visibleRows(e,i){return this.topRow&&i.unshift(this.topRow),this.botRow&&i.push(this.botRow),i}rowsUpdated(e){this.table.options.groupBy?this.recalcRowGroup(e):this.recalcActiveRows()}recalcActiveRowsRefresh(){this.table.options.groupBy&&this.table.options.dataTreeStartExpanded&&this.table.options.dataTree?this.recalcAll():this.recalcActiveRows()}recalcActiveRows(){this.recalc(this.table.rowManager.activeRows)}cellValueChanged(e){(e.column.definition.topCalc||e.column.definition.bottomCalc)&&(this.table.options.groupBy?((this.table.options.columnCalcs=="table"||this.table.options.columnCalcs=="both")&&this.recalcActiveRows(),this.table.options.columnCalcs!="table"&&this.recalcRowGroup(e.row)):this.recalcActiveRows())}initializeColumnCheck(e){(e.definition.topCalc||e.definition.bottomCalc)&&this.initializeColumn(e)}initializeColumn(e){var i=e.definition,r={topCalcParams:i.topCalcParams||{},botCalcParams:i.bottomCalcParams||{}};if(i.topCalc){switch(typeof i.topCalc){case"string":Dg.calculations[i.topCalc]?r.topCalc=Dg.calculations[i.topCalc]:console.warn("Column Calc Error - No such calculation found, ignoring: ",i.topCalc);break;case"function":r.topCalc=i.topCalc;break}r.topCalc&&(e.modules.columnCalcs=r,this.topCalcs.push(e),this.table.options.columnCalcs!="group"&&this.initializeTopRow())}if(i.bottomCalc){switch(typeof i.bottomCalc){case"string":Dg.calculations[i.bottomCalc]?r.botCalc=Dg.calculations[i.bottomCalc]:console.warn("Column Calc Error - No such calculation found, ignoring: ",i.bottomCalc);break;case"function":r.botCalc=i.bottomCalc;break}r.botCalc&&(e.modules.columnCalcs=r,this.botCalcs.push(e),this.table.options.columnCalcs!="group"&&this.initializeBottomRow())}}registerColumnField(){}removeCalcs(){var e=!1;this.topInitialized&&(this.topInitialized=!1,this.topElement.parentNode.removeChild(this.topElement),e=!0),this.botInitialized&&(this.botInitialized=!1,this.footerRemove(this.botElement),e=!0),e&&this.table.rowManager.adjustTableSize()}reinitializeCalcs(){this.topCalcs.length&&this.initializeTopRow(),this.botCalcs.length&&this.initializeBottomRow()}initializeTopRow(){var e=document.createDocumentFragment();this.topInitialized||(e.appendChild(document.createElement("br")),e.appendChild(this.topElement),this.table.columnManager.getContentsElement().insertBefore(e,this.table.columnManager.headersElement.nextSibling),this.topInitialized=!0)}initializeBottomRow(){this.botInitialized||(this.footerPrepend(this.botElement),this.botInitialized=!0)}scrollHorizontal(e){this.botInitialized&&this.botRow&&(this.botElement.scrollLeft=e)}recalc(e){var i,r;if(!this.blockCheck()&&(this.topInitialized||this.botInitialized)){if(i=this.rowsToData(e),this.topInitialized){for(this.topRow&&this.topRow.deleteCells(),r=this.generateRow("top",i),this.topRow=r;this.topElement.firstChild;)this.topElement.removeChild(this.topElement.firstChild);this.topElement.appendChild(r.getElement()),r.initialize(!0)}if(this.botInitialized){for(this.botRow&&this.botRow.deleteCells(),r=this.generateRow("bottom",i),this.botRow=r;this.botElement.firstChild;)this.botElement.removeChild(this.botElement.firstChild);this.botElement.appendChild(r.getElement()),r.initialize(!0)}this.table.rowManager.adjustTableSize(),this.table.modExists("frozenColumns")&&this.table.modules.frozenColumns.layout()}}recalcRowGroup(e){this.recalcGroup(this.table.modules.groupRows.getRowGroup(e))}recalcAll(){if((this.topCalcs.length||this.botCalcs.length)&&(this.table.options.columnCalcs!=="group"&&this.recalcActiveRows(),this.table.options.groupBy&&this.table.options.columnCalcs!=="table")){var e=this.table.modules.groupRows.getChildGroups();e.forEach(i=>{this.recalcGroup(i)})}}recalcGroup(e){var i,r;this.blockCheck()||e&&e.calcs&&(e.calcs.bottom&&(i=this.rowsToData(e.rows),r=this.generateRowData("bottom",i),e.calcs.bottom.updateData(r),e.calcs.bottom.reinitialize()),e.calcs.top&&(i=this.rowsToData(e.rows),r=this.generateRowData("top",i),e.calcs.top.updateData(r),e.calcs.top.reinitialize()))}generateTopRow(e){return this.generateRow("top",this.rowsToData(e))}generateBottomRow(e){return this.generateRow("bottom",this.rowsToData(e))}rowsToData(e){var i=[],r=this.table.options.dataTree&&this.table.options.dataTreeChildColumnCalcs,n=this.table.modules.dataTree;return e.forEach(a=>{i.push(a.getData()),r&&a.modules.dataTree?.open&&this.rowsToData(n.getFilteredTreeChildren(a)).forEach(s=>{i.push(a)})}),i}generateRow(e,i){var r=this.generateRowData(e,i),n;return this.table.modExists("mutator")&&this.table.modules.mutator.disable(),n=new Ca(r,this,"calc"),this.table.modExists("mutator")&&this.table.modules.mutator.enable(),n.getElement().classList.add("tabulator-calcs","tabulator-calcs-"+e),n.component=!1,n.getComponent=()=>(n.component||(n.component=new Eme(n)),n.component),n.generateCells=()=>{var a=[];this.table.columnManager.columnsByIndex.forEach(s=>{this.genColumn.setField(s.getField()),this.genColumn.hozAlign=s.hozAlign,s.definition[e+"CalcFormatter"]&&this.table.modExists("format")?this.genColumn.modules.format={formatter:this.table.modules.format.lookupFormatter(s.definition[e+"CalcFormatter"]),params:s.definition[e+"CalcFormatterParams"]||{}}:this.genColumn.modules.format={formatter:this.table.modules.format.lookupFormatter("plaintext"),params:{}},this.genColumn.definition.cssClass=s.definition.cssClass;var o=new Dw(this.genColumn,n);o.getElement(),o.column=s,o.setWidth(),s.cells.push(o),a.push(o),s.visible||o.hide()}),n.cells=a},n}generateRowData(e,i){var r={},n=e=="top"?this.topCalcs:this.botCalcs,a=e=="top"?"topCalc":"botCalc",s,o;return n.forEach(function(l){var u=[];l.modules.columnCalcs&&l.modules.columnCalcs[a]&&(i.forEach(function(c){u.push(l.getFieldValue(c))}),o=a+"Params",s=typeof l.modules.columnCalcs[o]=="function"?l.modules.columnCalcs[o](u,i):l.modules.columnCalcs[o],l.setFieldValue(r,l.modules.columnCalcs[a](u,i,s)))}),r}hasTopCalcs(){return!!this.topCalcs.length}hasBottomCalcs(){return!!this.botCalcs.length}redraw(){this.topRow&&this.topRow.normalizeHeight(!0),this.botRow&&this.botRow.normalizeHeight(!0)}getResults(){var e={},i;return this.table.options.groupBy&&this.table.modExists("groupRows")?(i=this.table.modules.groupRows.getGroups(!0),i.forEach(r=>{e[r.getKey()]=this.getGroupResults(r)})):e={top:this.topRow?this.topRow.getData():{},bottom:this.botRow?this.botRow.getData():{}},e}getGroupResults(e){var i=e._getSelf(),r=e.getSubGroups(),n={},a={};return r.forEach(s=>{n[s.getKey()]=this.getGroupResults(s)}),a={top:i.calcs.top?i.calcs.top.getData():{},bottom:i.calcs.bottom?i.calcs.bottom.getData():{},groups:n},a}adjustForScrollbar(e){this.botRow&&(this.table.rtl?this.botElement.style.paddingLeft=e+"px":this.botElement.style.paddingRight=e+"px")}}class Cme extends si{static moduleName="dataTree";constructor(e){super(e),this.indent=10,this.field="",this.collapseEl=null,this.expandEl=null,this.branchEl=null,this.elementField=!1,this.startOpen=function(){},this.registerTableOption("dataTree",!1),this.registerTableOption("dataTreeFilter",!0),this.registerTableOption("dataTreeSort",!0),this.registerTableOption("dataTreeElementColumn",!1),this.registerTableOption("dataTreeBranchElement",!0),this.registerTableOption("dataTreeChildIndent",9),this.registerTableOption("dataTreeChildField","_children"),this.registerTableOption("dataTreeCollapseElement",!1),this.registerTableOption("dataTreeExpandElement",!1),this.registerTableOption("dataTreeStartExpanded",!1),this.registerTableOption("dataTreeChildColumnCalcs",!1),this.registerTableOption("dataTreeSelectPropagate",!1),this.registerComponentFunction("row","treeCollapse",this.collapseRow.bind(this)),this.registerComponentFunction("row","treeExpand",this.expandRow.bind(this)),this.registerComponentFunction("row","treeToggle",this.toggleRow.bind(this)),this.registerComponentFunction("row","getTreeParent",this.getTreeParent.bind(this)),this.registerComponentFunction("row","getTreeChildren",this.getRowChildren.bind(this)),this.registerComponentFunction("row","addTreeChild",this.addTreeChildRow.bind(this)),this.registerComponentFunction("row","isTreeExpanded",this.isRowExpanded.bind(this))}initialize(){if(this.table.options.dataTree){var e=null,i=this.table.options;switch(this.field=i.dataTreeChildField,this.indent=i.dataTreeChildIndent,this.options("movableRows")&&console.warn("The movableRows option is not available with dataTree enabled, moving of child rows could result in unpredictable behavior"),i.dataTreeBranchElement?i.dataTreeBranchElement===!0?(this.branchEl=document.createElement("div"),this.branchEl.classList.add("tabulator-data-tree-branch")):typeof i.dataTreeBranchElement=="string"?(e=document.createElement("div"),e.innerHTML=i.dataTreeBranchElement,this.branchEl=e.firstChild):this.branchEl=i.dataTreeBranchElement:(this.branchEl=document.createElement("div"),this.branchEl.classList.add("tabulator-data-tree-branch-empty")),i.dataTreeCollapseElement?typeof i.dataTreeCollapseElement=="string"?(e=document.createElement("div"),e.innerHTML=i.dataTreeCollapseElement,this.collapseEl=e.firstChild):this.collapseEl=i.dataTreeCollapseElement:(this.collapseEl=document.createElement("div"),this.collapseEl.classList.add("tabulator-data-tree-control"),this.collapseEl.tabIndex=0,this.collapseEl.innerHTML="<div class='tabulator-data-tree-control-collapse'></div>"),i.dataTreeExpandElement?typeof i.dataTreeExpandElement=="string"?(e=document.createElement("div"),e.innerHTML=i.dataTreeExpandElement,this.expandEl=e.firstChild):this.expandEl=i.dataTreeExpandElement:(this.expandEl=document.createElement("div"),this.expandEl.classList.add("tabulator-data-tree-control"),this.expandEl.tabIndex=0,this.expandEl.innerHTML="<div class='tabulator-data-tree-control-expand'></div>"),typeof i.dataTreeStartExpanded){case"boolean":this.startOpen=function(r,n){return i.dataTreeStartExpanded};break;case"function":this.startOpen=i.dataTreeStartExpanded;break;default:this.startOpen=function(r,n){return i.dataTreeStartExpanded[n]};break}this.subscribe("row-init",this.initializeRow.bind(this)),this.subscribe("row-layout-after",this.layoutRow.bind(this)),this.subscribe("row-deleting",this.rowDeleting.bind(this)),this.subscribe("row-deleted",this.rowDelete.bind(this),0),this.subscribe("row-data-changed",this.rowDataChanged.bind(this),10),this.subscribe("cell-value-updated",this.cellValueChanged.bind(this)),this.subscribe("edit-cancelled",this.cellValueChanged.bind(this)),this.subscribe("column-moving-rows",this.columnMoving.bind(this)),this.subscribe("table-built",this.initializeElementField.bind(this)),this.subscribe("table-redrawing",this.tableRedrawing.bind(this)),this.registerDisplayHandler(this.getRows.bind(this),30)}}tableRedrawing(e){var i;e&&(i=this.table.rowManager.getRows(),i.forEach(r=>{this.reinitializeRowChildren(r)}))}initializeElementField(){var e=this.table.columnManager.getFirstVisibleColumn();this.elementField=this.table.options.dataTreeElementColumn||(e?e.field:!1)}getRowChildren(e){return this.getTreeChildren(e,!0)}columnMoving(){var e=[];return this.table.rowManager.rows.forEach(i=>{e=e.concat(this.getTreeChildren(i,!1,!0))}),e}rowDataChanged(e,i,r){this.redrawNeeded(r)&&(this.initializeRow(e),i&&(this.layoutRow(e),this.refreshData(!0)))}cellValueChanged(e){var i=e.column.getField();i===this.elementField&&this.layoutRow(e.row)}initializeRow(e){var i=e.getData()[this.field],r=Array.isArray(i),n=r||!r&&typeof i=="object"&&i!==null;!n&&e.modules.dataTree&&e.modules.dataTree.branchEl&&e.modules.dataTree.branchEl.parentNode.removeChild(e.modules.dataTree.branchEl),!n&&e.modules.dataTree&&e.modules.dataTree.controlEl&&e.modules.dataTree.controlEl.parentNode.removeChild(e.modules.dataTree.controlEl),e.modules.dataTree={index:e.modules.dataTree?e.modules.dataTree.index:0,open:n?e.modules.dataTree?e.modules.dataTree.open:this.startOpen(e.getComponent(),0):!1,controlEl:e.modules.dataTree&&n?e.modules.dataTree.controlEl:!1,branchEl:e.modules.dataTree&&n?e.modules.dataTree.branchEl:!1,parent:e.modules.dataTree?e.modules.dataTree.parent:!1,children:n}}reinitializeRowChildren(e){var i=this.getTreeChildren(e,!1,!0);i.forEach(function(r){r.reinitialize(!0)})}layoutRow(e){var i=this.elementField?e.getCell(this.elementField):e.getCells()[0],r=i.getElement(),n=e.modules.dataTree;n.branchEl&&(n.branchEl.parentNode&&n.branchEl.parentNode.removeChild(n.branchEl),n.branchEl=!1),n.controlEl&&(n.controlEl.parentNode&&n.controlEl.parentNode.removeChild(n.controlEl),n.controlEl=!1),this.generateControlElement(e,r),e.getElement().classList.add("tabulator-tree-level-"+n.index),n.index&&(this.branchEl?(n.branchEl=this.branchEl.cloneNode(!0),r.insertBefore(n.branchEl,r.firstChild),this.table.rtl?n.branchEl.style.marginRight=(n.branchEl.offsetWidth+n.branchEl.style.marginLeft)*(n.index-1)+n.index*this.indent+"px":n.branchEl.style.marginLeft=(n.branchEl.offsetWidth+n.branchEl.style.marginRight)*(n.index-1)+n.index*this.indent+"px"):this.table.rtl?r.style.paddingRight=parseInt(window.getComputedStyle(r,null).getPropertyValue("padding-right"))+n.index*this.indent+"px":r.style.paddingLeft=parseInt(window.getComputedStyle(r,null).getPropertyValue("padding-left"))+n.index*this.indent+"px")}generateControlElement(e,i){var r=e.modules.dataTree,n=r.controlEl;i=i||e.getCells()[0].getElement(),r.children!==!1&&(r.open?(r.controlEl=this.collapseEl.cloneNode(!0),r.controlEl.addEventListener("click",a=>{a.stopPropagation(),this.collapseRow(e)})):(r.controlEl=this.expandEl.cloneNode(!0),r.controlEl.addEventListener("click",a=>{a.stopPropagation(),this.expandRow(e)})),r.controlEl.addEventListener("mousedown",a=>{a.stopPropagation()}),n&&n.parentNode===i?n.parentNode.replaceChild(r.controlEl,n):i.insertBefore(r.controlEl,i.firstChild))}getRows(e){var i=[];return e.forEach((r,n)=>{var a,s;i.push(r),r instanceof Ca&&(r.create(),a=r.modules.dataTree,!a.index&&a.children!==!1&&(s=this.getChildren(r,!1,!0),s.forEach(o=>{o.create(),i.push(o)})))}),i}getChildren(e,i,r){var n=e.modules.dataTree,a=[],s=[];return n.children!==!1&&(n.open||i)&&(Array.isArray(n.children)||(n.children=this.generateChildren(e)),this.table.modExists("filter")&&this.table.options.dataTreeFilter?a=this.table.modules.filter.filter(n.children):a=n.children,this.table.modExists("sort")&&this.table.options.dataTreeSort&&this.table.modules.sort.sort(a,r),a.forEach(o=>{s.push(o);var l=this.getChildren(o,!1,!0);l.forEach(u=>{s.push(u)})})),s}generateChildren(e){var i=[],r=e.getData()[this.field];return Array.isArray(r)||(r=[r]),r.forEach(n=>{var a=new Ca(n||{},this.table.rowManager);a.create(),a.modules.dataTree.index=e.modules.dataTree.index+1,a.modules.dataTree.parent=e,a.modules.dataTree.children&&(a.modules.dataTree.open=this.startOpen(a.getComponent(),a.modules.dataTree.index)),i.push(a)}),i}expandRow(e,i){var r=e.modules.dataTree;r.children!==!1&&(r.open=!0,e.reinitialize(),this.refreshData(!0),this.dispatchExternal("dataTreeRowExpanded",e.getComponent(),e.modules.dataTree.index))}collapseRow(e){var i=e.modules.dataTree;i.children!==!1&&(i.open=!1,e.reinitialize(),this.refreshData(!0),this.dispatchExternal("dataTreeRowCollapsed",e.getComponent(),e.modules.dataTree.index))}toggleRow(e){var i=e.modules.dataTree;i.children!==!1&&(i.open?this.collapseRow(e):this.expandRow(e))}isRowExpanded(e){return e.modules.dataTree.open}getTreeParent(e){return e.modules.dataTree.parent?e.modules.dataTree.parent.getComponent():!1}getTreeParentRoot(e){return e.modules.dataTree&&e.modules.dataTree.parent?this.getTreeParentRoot(e.modules.dataTree.parent):e}getFilteredTreeChildren(e){var i=e.modules.dataTree,r=[],n;return i.children&&(Array.isArray(i.children)||(i.children=this.generateChildren(e)),this.table.modExists("filter")&&this.table.options.dataTreeFilter?n=this.table.modules.filter.filter(i.children):n=i.children,n.forEach(a=>{a instanceof Ca&&r.push(a)})),r}rowDeleting(e){var i=e.modules.dataTree;i&&i.children&&Array.isArray(i.children)&&i.children.forEach(r=>{r instanceof Ca&&r.wipe()})}rowDelete(e){var i=e.modules.dataTree.parent,r;i&&(r=this.findChildIndex(e,i),r!==!1&&i.data[this.field].splice(r,1),i.data[this.field].length||delete i.data[this.field],this.initializeRow(i),this.layoutRow(i)),this.refreshData(!0)}addTreeChildRow(e,i,r,n){var a=!1;typeof i=="string"&&(i=JSON.parse(i)),Array.isArray(e.data[this.field])||(e.data[this.field]=[],e.modules.dataTree.open=this.startOpen(e.getComponent(),e.modules.dataTree.index)),typeof n<"u"&&(a=this.findChildIndex(n,e),a!==!1&&e.data[this.field].splice(r?a:a+1,0,i)),a===!1&&(r?e.data[this.field].unshift(i):e.data[this.field].push(i)),this.initializeRow(e),this.layoutRow(e),this.refreshData(!0)}findChildIndex(e,i){var r=!1;return typeof e=="object"?e instanceof Ca?r=e.data:e instanceof LE?r=e._getSelf().data:typeof HTMLElement<"u"&&e instanceof HTMLElement?i.modules.dataTree&&(r=i.modules.dataTree.children.find(n=>n instanceof Ca?n.element===e:!1),r&&(r=r.data)):e===null&&(r=!1):typeof e>"u"?r=!1:r=i.data[this.field].find(n=>n.data[this.table.options.index]==e),r&&(Array.isArray(i.data[this.field])&&(r=i.data[this.field].indexOf(r)),r==-1&&(r=!1)),r}getTreeChildren(e,i,r){var n=e.modules.dataTree,a=[];return n&&n.children&&(Array.isArray(n.children)||(n.children=this.generateChildren(e)),n.children.forEach(s=>{s instanceof Ca&&(a.push(i?s.getComponent():s),r&&this.getTreeChildren(s,i,r).forEach(o=>{a.push(o)}))})),a}getChildField(){return this.field}redrawNeeded(e){return(this.field?typeof e[this.field]<"u":!1)||(this.elementField?typeof e[this.elementField]<"u":!1)}}function Mme(t,e={},i){var r=e.delimiter?e.delimiter:",",n=[],a=[];t.forEach(s=>{var o=[];switch(s.type){case"group":console.warn("Download Warning - CSV downloader cannot process row groups");break;case"calc":console.warn("Download Warning - CSV downloader cannot process column calculations");break;case"header":s.columns.forEach((l,u)=>{l&&l.depth===1&&(a[u]=typeof l.value>"u"||l.value===null?"":'"'+String(l.value).split('"').join('""')+'"')});break;case"row":s.columns.forEach(l=>{if(l){switch(typeof l.value){case"object":l.value=l.value!==null?JSON.stringify(l.value):"";break;case"undefined":l.value="";break}o.push('"'+String(l.value).split('"').join('""')+'"')}}),n.push(o.join(r));break}}),a.length&&n.unshift(a.join(r)),n=n.join(`
`),e.bom&&(n="\uFEFF"+n),i(n,"text/csv")}function Nme(t,e,i){var r=[];t.forEach(n=>{var a={};switch(n.type){case"header":break;case"group":console.warn("Download Warning - JSON downloader cannot process row groups");break;case"calc":console.warn("Download Warning - JSON downloader cannot process column calculations");break;case"row":n.columns.forEach(s=>{s&&(a[s.component.getTitleDownload()||s.component.getField()]=s.value)}),r.push(a);break}}),r=JSON.stringify(r,null,"	"),i(r,"application/json")}function Ame(t,e={},i){var r=[],n=[],a={},s=e.rowGroupStyles||{fontStyle:"bold",fontSize:12,cellPadding:6,fillColor:220},o=e.rowCalcStyles||{fontStyle:"bold",fontSize:10,cellPadding:4,fillColor:232},l=e.jsPDF||{},u=e.title?e.title:"",c,d;l.orientation||(l.orientation=e.orientation||"landscape"),l.unit||(l.unit="pt"),t.forEach(f=>{switch(f.type){case"header":r.push(p(f));break;case"group":n.push(p(f,s));break;case"calc":n.push(p(f,o));break;case"row":n.push(p(f));break}});function p(f,m){var h=[];return f.columns.forEach(g=>{var I;if(g){switch(typeof g.value){case"object":g.value=g.value!==null?JSON.stringify(g.value):"";break;case"undefined":g.value="";break}I={content:g.value,colSpan:g.width,rowSpan:g.height},m&&(I.styles=m),h.push(I)}}),h}c=this.dependencyRegistry.lookup("jspdf","jsPDF"),d=new c(l),e.autoTable&&(typeof e.autoTable=="function"?a=e.autoTable(d)||{}:a=e.autoTable),u&&(a.didDrawPage=function(f){d.text(u,40,30)}),a.head=r,a.body=n,d.autoTable(a),e.documentProcessing&&e.documentProcessing(d),i(d.output("arraybuffer"),"application/pdf")}function kme(t,e,i){var r=this,n=e.sheetName||"Sheet1",a=this.dependencyRegistry.lookup("XLSX"),s=a.utils.book_new(),o=new Ra(this),l="compress"in e?e.compress:!0,u=e.writeOptions||{bookType:"xlsx",bookSST:!0,compression:l},c;u.type="binary",s.SheetNames=[],s.Sheets={};function d(){var m=[],h=[],g={},I={s:{c:0,r:0},e:{c:t[0]?t[0].columns.reduce((v,w)=>v+(w&&w.width?w.width:1),0):0,r:t.length}};return t.forEach((v,w)=>{var y=[];v.columns.forEach(function(b,S){b?(y.push(!(b.value instanceof Date)&&typeof b.value=="object"?JSON.stringify(b.value):b.value),(b.width>1||b.height>-1)&&(b.height>1||b.width>1)&&h.push({s:{r:w,c:S},e:{r:w+b.height-1,c:S+b.width-1}})):y.push("")}),m.push(y)}),a.utils.sheet_add_aoa(g,m),g["!ref"]=a.utils.encode_range(I),h.length&&(g["!merges"]=h),g}if(e.sheetOnly){i(d());return}if(e.sheets)for(var p in e.sheets)e.sheets[p]===!0?(s.SheetNames.push(p),s.Sheets[p]=d()):(s.SheetNames.push(p),o.commsSend(e.sheets[p],"download","intercept",{type:"xlsx",options:{sheetOnly:!0},active:r.active,intercept:function(m){s.Sheets[p]=m}}));else s.SheetNames.push(n),s.Sheets[n]=d();e.documentProcessing&&(s=e.documentProcessing(s));function f(m){for(var h=new ArrayBuffer(m.length),g=new Uint8Array(h),I=0;I!=m.length;++I)g[I]=m.charCodeAt(I)&255;return h}c=a.write(s,u),i(f(c),"application/octet-stream")}function Ome(t,e,i){this.modExists("export",!0)&&i(this.modules.export.generateHTMLTable(t),"text/html")}function xme(t,e,i){const r=[];t.forEach(n=>{const a={};switch(n.type){case"header":break;case"group":console.warn("Download Warning - JSON downloader cannot process row groups");break;case"calc":console.warn("Download Warning - JSON downloader cannot process column calculations");break;case"row":n.columns.forEach(s=>{s&&(a[s.component.getTitleDownload()||s.component.getField()]=s.value)}),r.push(JSON.stringify(a));break}}),i(r.join(`
`),"application/x-ndjson")}var Fme={csv:Mme,json:Nme,jsonLines:xme,pdf:Ame,xlsx:kme,html:Ome};class kD extends si{static moduleName="download";static downloaders=Fme;constructor(e){super(e),this.registerTableOption("downloadEncoder",function(i,r){return new Blob([i],{type:r})}),this.registerTableOption("downloadConfig",{}),this.registerTableOption("downloadRowRange","active"),this.registerColumnOption("download"),this.registerColumnOption("titleDownload")}initialize(){this.deprecatedOptionsCheck(),this.registerTableFunction("download",this.download.bind(this)),this.registerTableFunction("downloadToTab",this.downloadToTab.bind(this))}deprecatedOptionsCheck(){}downloadToTab(e,i,r,n){this.download(e,i,r,n,!0)}download(e,i,r,n,a){var s=!1;function o(u,c){a?a===!0?this.triggerDownload(u,c,e,i,!0):a(u):this.triggerDownload(u,c,e,i)}if(typeof e=="function"?s=e:kD.downloaders[e]?s=kD.downloaders[e]:console.warn("Download Error - No such download type found: ",e),s){var l=this.generateExportList(n);s.call(this.table,l,r||{},o.bind(this))}}generateExportList(e){var i=this.table.modules.export.generateExportList(this.table.options.downloadConfig,!1,e||this.table.options.downloadRowRange,"download"),r=this.table.options.groupHeaderDownload;return r&&!Array.isArray(r)&&(r=[r]),i.forEach(n=>{var a;n.type==="group"&&(a=n.columns[0],r&&r[n.indent]&&(a.value=r[n.indent](a.value,n.component._group.getRowCount(),n.component._group.getData(),n.component)))}),i}triggerDownload(e,i,r,n,a){var s=document.createElement("a"),o=this.table.options.downloadEncoder(e,i);o&&(a?window.open(window.URL.createObjectURL(o)):(n=n||"Tabulator."+(typeof r=="function"?"txt":r),navigator.msSaveOrOpenBlob?navigator.msSaveOrOpenBlob(o,n):(s.setAttribute("href",window.URL.createObjectURL(o)),s.setAttribute("download",n),s.style.display="none",document.body.appendChild(s),s.click(),document.body.removeChild(s))),this.dispatchExternal("downloadComplete"))}commsReceived(e,i,r){i==="intercept"&&this.download(r.type,"",r.options,r.active,r.intercept)}}function _E(t,e){var i=e.mask,r=typeof e.maskLetterChar<"u"?e.maskLetterChar:"A",n=typeof e.maskNumberChar<"u"?e.maskNumberChar:"9",a=typeof e.maskWildcardChar<"u"?e.maskWildcardChar:"*";function s(o){var l=i[o];typeof l<"u"&&l!==a&&l!==r&&l!==n&&(t.value=t.value+""+l,s(o+1))}t.addEventListener("keydown",o=>{var l=t.value.length,u=o.key;if(o.keyCode>46&&!o.ctrlKey&&!o.metaKey){if(l>=i.length)return o.preventDefault(),o.stopPropagation(),!1;switch(i[l]){case r:if(u.toUpperCase()==u.toLowerCase())return o.preventDefault(),o.stopPropagation(),!1;break;case n:if(isNaN(u))return o.preventDefault(),o.stopPropagation(),!1;break;case a:break;default:if(u!==i[l])return o.preventDefault(),o.stopPropagation(),!1}}}),t.addEventListener("keyup",o=>{o.keyCode>46&&e.maskAutoFill&&s(t.value.length)}),t.placeholder||(t.placeholder=i),e.maskAutoFill&&s(t.value.length)}function Lme(t,e,i,r,n){var a=t.getValue(),s=document.createElement("input");if(s.setAttribute("type",n.search?"search":"text"),s.style.padding="4px",s.style.width="100%",s.style.boxSizing="border-box",n.elementAttributes&&typeof n.elementAttributes=="object")for(let l in n.elementAttributes)l.charAt(0)=="+"?(l=l.slice(1),s.setAttribute(l,s.getAttribute(l)+n.elementAttributes["+"+l])):s.setAttribute(l,n.elementAttributes[l]);s.value=typeof a<"u"?a:"",e(function(){t.getType()==="cell"&&(s.focus({preventScroll:!0}),s.style.height="100%",n.selectContents&&s.select())});function o(l){(a===null||typeof a>"u")&&s.value!==""||s.value!==a?i(s.value)&&(a=s.value):r()}return s.addEventListener("change",o),s.addEventListener("blur",o),s.addEventListener("keydown",function(l){switch(l.keyCode){case 13:o();break;case 27:r();break;case 35:case 36:l.stopPropagation();break}}),n.mask&&_E(s,n),s}function _me(t,e,i,r,n){var a=t.getValue(),s=n.verticalNavigation||"hybrid",o=String(a!==null&&typeof a<"u"?a:""),l=document.createElement("textarea"),u=0;if(l.style.display="block",l.style.padding="2px",l.style.height="100%",l.style.width="100%",l.style.boxSizing="border-box",l.style.whiteSpace="pre-wrap",l.style.resize="none",n.elementAttributes&&typeof n.elementAttributes=="object")for(let d in n.elementAttributes)d.charAt(0)=="+"?(d=d.slice(1),l.setAttribute(d,l.getAttribute(d)+n.elementAttributes["+"+d])):l.setAttribute(d,n.elementAttributes[d]);l.value=o,e(function(){t.getType()==="cell"&&(l.focus({preventScroll:!0}),l.style.height="100%",l.scrollHeight,l.style.height=l.scrollHeight+"px",t.getRow().normalizeHeight(),n.selectContents&&l.select())});function c(d){(a===null||typeof a>"u")&&l.value!==""||l.value!==a?(i(l.value)&&(a=l.value),setTimeout(function(){t.getRow().normalizeHeight()},300)):r()}return l.addEventListener("change",c),l.addEventListener("blur",c),l.addEventListener("keyup",function(){l.style.height="";var d=l.scrollHeight;l.style.height=d+"px",d!=u&&(u=d,t.getRow().normalizeHeight())}),l.addEventListener("keydown",function(d){switch(d.keyCode){case 13:d.shiftKey&&n.shiftEnterSubmit&&c();break;case 27:r();break;case 38:(s=="editor"||s=="hybrid"&&l.selectionStart)&&(d.stopImmediatePropagation(),d.stopPropagation());break;case 40:(s=="editor"||s=="hybrid"&&l.selectionStart!==l.value.length)&&(d.stopImmediatePropagation(),d.stopPropagation());break;case 35:case 36:d.stopPropagation();break}}),n.mask&&_E(l,n),l}function $me(t,e,i,r,n){var a=t.getValue(),s=n.verticalNavigation||"editor",o=document.createElement("input");if(o.setAttribute("type","number"),typeof n.max<"u"&&o.setAttribute("max",n.max),typeof n.min<"u"&&o.setAttribute("min",n.min),typeof n.step<"u"&&o.setAttribute("step",n.step),o.style.padding="4px",o.style.width="100%",o.style.boxSizing="border-box",n.elementAttributes&&typeof n.elementAttributes=="object")for(let c in n.elementAttributes)c.charAt(0)=="+"?(c=c.slice(1),o.setAttribute(c,o.getAttribute(c)+n.elementAttributes["+"+c])):o.setAttribute(c,n.elementAttributes[c]);o.value=a;var l=function(c){u()};e(function(){t.getType()==="cell"&&(o.removeEventListener("blur",l),o.focus({preventScroll:!0}),o.style.height="100%",o.addEventListener("blur",l),n.selectContents&&o.select())});function u(){var c=o.value;!isNaN(c)&&c!==""&&(c=Number(c)),c!==a?i(c)&&(a=c):r()}return o.addEventListener("keydown",function(c){switch(c.keyCode){case 13:u();break;case 27:r();break;case 38:case 40:s=="editor"&&(c.stopImmediatePropagation(),c.stopPropagation());break;case 35:case 36:c.stopPropagation();break}}),n.mask&&_E(o,n),o}function Bme(t,e,i,r,n){var a=t.getValue(),s=document.createElement("input");if(s.setAttribute("type","range"),typeof n.max<"u"&&s.setAttribute("max",n.max),typeof n.min<"u"&&s.setAttribute("min",n.min),typeof n.step<"u"&&s.setAttribute("step",n.step),s.style.padding="4px",s.style.width="100%",s.style.boxSizing="border-box",n.elementAttributes&&typeof n.elementAttributes=="object")for(let l in n.elementAttributes)l.charAt(0)=="+"?(l=l.slice(1),s.setAttribute(l,s.getAttribute(l)+n.elementAttributes["+"+l])):s.setAttribute(l,n.elementAttributes[l]);s.value=a,e(function(){t.getType()==="cell"&&(s.focus({preventScroll:!0}),s.style.height="100%")});function o(){var l=s.value;!isNaN(l)&&l!==""&&(l=Number(l)),l!=a?i(l)&&(a=l):r()}return s.addEventListener("blur",function(l){o()}),s.addEventListener("keydown",function(l){switch(l.keyCode){case 13:o();break;case 27:r();break}}),s}function Vme(t,e,i,r,n){var a=n.format,s=n.verticalNavigation||"editor",o=a?window.DateTime||luxon.DateTime:null,l=t.getValue(),u=document.createElement("input");function c(p){var f;return o.isDateTime(p)?f=p:a==="iso"?f=o.fromISO(String(p)):f=o.fromFormat(String(p),a),f.toFormat("yyyy-MM-dd")}if(u.type="date",u.style.padding="4px",u.style.width="100%",u.style.boxSizing="border-box",n.max&&u.setAttribute("max",a?c(n.max):n.max),n.min&&u.setAttribute("min",a?c(n.min):n.min),n.elementAttributes&&typeof n.elementAttributes=="object")for(let p in n.elementAttributes)p.charAt(0)=="+"?(p=p.slice(1),u.setAttribute(p,u.getAttribute(p)+n.elementAttributes["+"+p])):u.setAttribute(p,n.elementAttributes[p]);l=typeof l<"u"?l:"",a&&(o?l=c(l):console.error("Editor Error - 'date' editor 'format' param is dependant on luxon.js")),u.value=l,e(function(){t.getType()==="cell"&&(u.focus({preventScroll:!0}),u.style.height="100%",n.selectContents&&u.select())});function d(){var p=u.value,f;if((l===null||typeof l>"u")&&p!==""||p!==l){if(p&&a)switch(f=o.fromFormat(String(p),"yyyy-MM-dd"),a){case!0:p=f;break;case"iso":p=f.toISO();break;default:p=f.toFormat(a)}i(p)&&(l=u.value)}else r()}return u.addEventListener("blur",function(p){(p.relatedTarget||p.rangeParent||p.explicitOriginalTarget!==u)&&d()}),u.addEventListener("keydown",function(p){switch(p.keyCode){case 13:d();break;case 27:r();break;case 35:case 36:p.stopPropagation();break;case 38:case 40:s=="editor"&&(p.stopImmediatePropagation(),p.stopPropagation());break}}),u}function jme(t,e,i,r,n){var a=n.format,s=n.verticalNavigation||"editor",o=a?window.DateTime||luxon.DateTime:null,l,u=t.getValue(),c=document.createElement("input");if(c.type="time",c.style.padding="4px",c.style.width="100%",c.style.boxSizing="border-box",n.elementAttributes&&typeof n.elementAttributes=="object")for(let p in n.elementAttributes)p.charAt(0)=="+"?(p=p.slice(1),c.setAttribute(p,c.getAttribute(p)+n.elementAttributes["+"+p])):c.setAttribute(p,n.elementAttributes[p]);u=typeof u<"u"?u:"",a&&(o?(o.isDateTime(u)?l=u:a==="iso"?l=o.fromISO(String(u)):l=o.fromFormat(String(u),a),u=l.toFormat("HH:mm")):console.error("Editor Error - 'date' editor 'format' param is dependant on luxon.js")),c.value=u,e(function(){t.getType()=="cell"&&(c.focus({preventScroll:!0}),c.style.height="100%",n.selectContents&&c.select())});function d(){var p=c.value,f;if((u===null||typeof u>"u")&&p!==""||p!==u){if(p&&a)switch(f=o.fromFormat(String(p),"hh:mm"),a){case!0:p=f;break;case"iso":p=f.toISO();break;default:p=f.toFormat(a)}i(p)&&(u=c.value)}else r()}return c.addEventListener("blur",function(p){(p.relatedTarget||p.rangeParent||p.explicitOriginalTarget!==c)&&d()}),c.addEventListener("keydown",function(p){switch(p.keyCode){case 13:d();break;case 27:r();break;case 35:case 36:p.stopPropagation();break;case 38:case 40:s=="editor"&&(p.stopImmediatePropagation(),p.stopPropagation());break}}),c}function Gme(t,e,i,r,n){var a=n.format,s=n.verticalNavigation||"editor",o=a?this.table.dependencyRegistry.lookup(["luxon","DateTime"],"DateTime"):null,l,u=t.getValue(),c=document.createElement("input");if(c.type="datetime-local",c.style.padding="4px",c.style.width="100%",c.style.boxSizing="border-box",n.elementAttributes&&typeof n.elementAttributes=="object")for(let p in n.elementAttributes)p.charAt(0)=="+"?(p=p.slice(1),c.setAttribute(p,c.getAttribute(p)+n.elementAttributes["+"+p])):c.setAttribute(p,n.elementAttributes[p]);u=typeof u<"u"?u:"",a&&(o?(o.isDateTime(u)?l=u:a==="iso"?l=o.fromISO(String(u)):l=o.fromFormat(String(u),a),u=l.toFormat("yyyy-MM-dd")+"T"+l.toFormat("HH:mm")):console.error("Editor Error - 'date' editor 'format' param is dependant on luxon.js")),c.value=u,e(function(){t.getType()==="cell"&&(c.focus({preventScroll:!0}),c.style.height="100%",n.selectContents&&c.select())});function d(){var p=c.value,f;if((u===null||typeof u>"u")&&p!==""||p!==u){if(p&&a)switch(f=o.fromISO(String(p)),a){case!0:p=f;break;case"iso":p=f.toISO();break;default:p=f.toFormat(a)}i(p)&&(u=c.value)}else r()}return c.addEventListener("blur",function(p){(p.relatedTarget||p.rangeParent||p.explicitOriginalTarget!==c)&&d()}),c.addEventListener("keydown",function(p){switch(p.keyCode){case 13:d();break;case 27:r();break;case 35:case 36:p.stopPropagation();break;case 38:case 40:s=="editor"&&(p.stopImmediatePropagation(),p.stopPropagation());break}}),c}let Hme=class{constructor(e,i,r,n,a,s){this.edit=e,this.table=e.table,this.cell=i,this.params=this._initializeParams(s),this.data=[],this.displayItems=[],this.currentItems=[],this.focusedItem=null,this.input=this._createInputElement(),this.listEl=this._createListElement(),this.initialValues=null,this.isFilter=i.getType()==="header",this.filterTimeout=null,this.filtered=!1,this.typing=!1,this.values=[],this.popup=null,this.listIteration=0,this.lastAction="",this.filterTerm="",this.blurable=!0,this.actions={success:n,cancel:a},this._deprecatedOptionsCheck(),this._initializeValue(),r(this._onRendered.bind(this))}_deprecatedOptionsCheck(){}_initializeValue(){var e=this.cell.getValue();typeof e>"u"&&typeof this.params.defaultValue<"u"&&(e=this.params.defaultValue),this.initialValues=this.params.multiselect?e:[e],this.isFilter&&(this.input.value=this.initialValues?this.initialValues.join(","):"",this.headerFilterInitialListGen())}_onRendered(){var e=this.cell.getElement();function i(r){r.stopPropagation()}this.isFilter||(this.input.style.height="100%",this.input.focus({preventScroll:!0})),e.addEventListener("click",i),setTimeout(()=>{e.removeEventListener("click",i)},1e3),this.input.addEventListener("mousedown",this._preventPopupBlur.bind(this))}_createListElement(){var e=document.createElement("div");return e.classList.add("tabulator-edit-list"),e.addEventListener("mousedown",this._preventBlur.bind(this)),e.addEventListener("keydown",this._inputKeyDown.bind(this)),e}_setListWidth(){var e=this.isFilter?this.input:this.cell.getElement();this.listEl.style.minWidth=e.offsetWidth+"px",this.params.maxWidth&&(this.params.maxWidth===!0?this.listEl.style.maxWidth=e.offsetWidth+"px":typeof this.params.maxWidth=="number"?this.listEl.style.maxWidth=this.params.maxWidth+"px":this.listEl.style.maxWidth=this.params.maxWidth)}_createInputElement(){var e=this.params.elementAttributes,i=document.createElement("input");if(i.setAttribute("type",this.params.clearable?"search":"text"),i.style.padding="4px",i.style.width="100%",i.style.boxSizing="border-box",this.params.autocomplete||(i.style.cursor="default",i.style.caretColor="transparent"),e&&typeof e=="object")for(let r in e)r.charAt(0)=="+"?(r=r.slice(1),i.setAttribute(r,i.getAttribute(r)+e["+"+r])):i.setAttribute(r,e[r]);return this.params.mask&&_E(i,this.params),this._bindInputEvents(i),i}_initializeParams(e){var i=["values","valuesURL","valuesLookup"],r;return e=Object.assign({},e),e.verticalNavigation=e.verticalNavigation||"editor",e.placeholderLoading=typeof e.placeholderLoading>"u"?"Searching ...":e.placeholderLoading,e.placeholderEmpty=typeof e.placeholderEmpty>"u"?"No Results Found":e.placeholderEmpty,e.filterDelay=typeof e.filterDelay>"u"?300:e.filterDelay,e.emptyValue=Object.keys(e).includes("emptyValue")?e.emptyValue:"",r=Object.keys(e).filter(n=>i.includes(n)).length,r?r>1&&console.warn("list editor config error - only one of the values, valuesURL, or valuesLookup options can be set on the same editor"):console.warn("list editor config error - either the values, valuesURL, or valuesLookup option must be set"),e.autocomplete?e.multiselect&&(e.multiselect=!1,console.warn("list editor config error - multiselect option is not available when autocomplete is enabled")):(e.freetext&&(e.freetext=!1,console.warn("list editor config error - freetext option is only available when autocomplete is enabled")),e.filterFunc&&(e.filterFunc=!1,console.warn("list editor config error - filterFunc option is only available when autocomplete is enabled")),e.filterRemote&&(e.filterRemote=!1,console.warn("list editor config error - filterRemote option is only available when autocomplete is enabled")),e.mask&&(e.mask=!1,console.warn("list editor config error - mask option is only available when autocomplete is enabled")),e.allowEmpty&&(e.allowEmpty=!1,console.warn("list editor config error - allowEmpty option is only available when autocomplete is enabled")),e.listOnEmpty&&(e.listOnEmpty=!1,console.warn("list editor config error - listOnEmpty option is only available when autocomplete is enabled"))),e.filterRemote&&!(typeof e.valuesLookup=="function"||e.valuesURL)&&(e.filterRemote=!1,console.warn("list editor config error - filterRemote option should only be used when values list is populated from a remote source")),e}_bindInputEvents(e){e.addEventListener("focus",this._inputFocus.bind(this)),e.addEventListener("click",this._inputClick.bind(this)),e.addEventListener("blur",this._inputBlur.bind(this)),e.addEventListener("keydown",this._inputKeyDown.bind(this)),e.addEventListener("search",this._inputSearch.bind(this)),this.params.autocomplete&&e.addEventListener("keyup",this._inputKeyUp.bind(this))}_inputFocus(e){this.rebuildOptionsList()}_filter(){this.params.filterRemote?(clearTimeout(this.filterTimeout),this.filterTimeout=setTimeout(()=>{this.rebuildOptionsList()},this.params.filterDelay)):this._filterList()}_inputClick(e){e.stopPropagation()}_inputBlur(e){this.blurable&&(this.popup?this.popup.hide():this._resolveValue(!0))}_inputSearch(){this._clearChoices()}_inputKeyDown(e){switch(e.keyCode){case 38:this._keyUp(e);break;case 40:this._keyDown(e);break;case 37:case 39:this._keySide(e);break;case 13:this._keyEnter();break;case 27:this._keyEsc();break;case 36:case 35:this._keyHomeEnd(e);break;case 9:this._keyTab(e);break;default:this._keySelectLetter(e)}}_inputKeyUp(e){switch(e.keyCode){case 38:case 37:case 39:case 40:case 13:case 27:break;default:this._keyAutoCompLetter(e)}}_preventPopupBlur(){this.popup&&this.popup.blockHide(),setTimeout(()=>{this.popup&&this.popup.restoreHide()},10)}_preventBlur(){this.blurable=!1,setTimeout(()=>{this.blurable=!0},10)}_keyTab(e){this.params.autocomplete&&this.lastAction==="typing"?this._resolveValue(!0):this.focusedItem&&this._chooseItem(this.focusedItem,!0)}_keyUp(e){var i=this.displayItems.indexOf(this.focusedItem);(this.params.verticalNavigation=="editor"||this.params.verticalNavigation=="hybrid"&&i)&&(e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault(),i>0&&this._focusItem(this.displayItems[i-1]))}_keyDown(e){var i=this.displayItems.indexOf(this.focusedItem);(this.params.verticalNavigation=="editor"||this.params.verticalNavigation=="hybrid"&&i<this.displayItems.length-1)&&(e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault(),i<this.displayItems.length-1&&(i==-1?this._focusItem(this.displayItems[0]):this._focusItem(this.displayItems[i+1])))}_keySide(e){this.params.autocomplete||(e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault())}_keyEnter(e){this.params.autocomplete&&this.lastAction==="typing"?this._resolveValue(!0):this.focusedItem&&this._chooseItem(this.focusedItem)}_keyEsc(e){this._cancel()}_keyHomeEnd(e){this.params.autocomplete&&e.stopImmediatePropagation()}_keySelectLetter(e){this.params.autocomplete||(e.preventDefault(),e.keyCode>=38&&e.keyCode<=90&&this._scrollToValue(e.keyCode))}_keyAutoCompLetter(e){this._filter(),this.lastAction="typing",this.typing=!0}_scrollToValue(e){clearTimeout(this.filterTimeout);var i=String.fromCharCode(e).toLowerCase();this.filterTerm+=i.toLowerCase();var r=this.displayItems.find(n=>typeof n.label<"u"&&n.label.toLowerCase().startsWith(this.filterTerm));r&&this._focusItem(r),this.filterTimeout=setTimeout(()=>{this.filterTerm=""},800)}_focusItem(e){this.lastAction="focus",this.focusedItem&&this.focusedItem.element&&this.focusedItem.element.classList.remove("focused"),this.focusedItem=e,e&&e.element&&(e.element.classList.add("focused"),e.element.scrollIntoView({behavior:"smooth",block:"nearest",inline:"start"}))}headerFilterInitialListGen(){this._generateOptions(!0)}rebuildOptionsList(){this._generateOptions().then(this._sortOptions.bind(this)).then(this._buildList.bind(this)).then(this._showList.bind(this)).catch(e=>{Number.isInteger(e)||console.error("List generation error",e)})}_filterList(){this._buildList(this._filterOptions()),this._showList()}_generateOptions(e){var i=[],r=++this.listIteration;return this.filtered=!1,this.params.values?i=this.params.values:this.params.valuesURL?i=this._ajaxRequest(this.params.valuesURL,this.input.value):typeof this.params.valuesLookup=="function"?i=this.params.valuesLookup(this.cell,this.input.value):this.params.valuesLookup&&(i=this._uniqueColumnValues(this.params.valuesLookupField)),i instanceof Promise?(e||this._addPlaceholder(this.params.placeholderLoading),i.then().then(n=>this.listIteration===r?this._parseList(n):Promise.reject(r))):Promise.resolve(this._parseList(i))}_addPlaceholder(e){var i=document.createElement("div");typeof e=="function"&&(e=e(this.cell.getComponent(),this.listEl)),e&&(this._clearList(),e instanceof HTMLElement?i=e:(i.classList.add("tabulator-edit-list-placeholder"),i.innerHTML=e),this.listEl.appendChild(i),this._showList())}_ajaxRequest(e,i){var r=this.params.filterRemote?{term:i}:{};return e=WY(e,{},r),fetch(e).then(n=>n.ok?n.json().catch(a=>(console.warn("List Ajax Load Error - Invalid JSON returned",a),Promise.reject(a))):(console.error("List Ajax Load Error - Connection Error: "+n.status,n.statusText),Promise.reject(n))).catch(n=>(console.error("List Ajax Load Error - Connection Error: ",n),Promise.reject(n)))}_uniqueColumnValues(e){var i={},r=this.table.getData(this.params.valuesLookup),n;return e?n=this.table.columnManager.getColumnByField(e):n=this.cell.getColumn()._getSelf(),n?r.forEach(a=>{var s=n.getFieldValue(a);this._emptyValueCheck(s)||(this.params.multiselect&&Array.isArray(s)?s.forEach(o=>{this._emptyValueCheck(o)||(i[o]=!0)}):i[s]=!0)}):(console.warn("unable to find matching column to create select lookup list:",e),i=[]),Object.keys(i)}_emptyValueCheck(e){return e===null||typeof e>"u"||e===""}_parseList(e){var i=[];return Array.isArray(e)||(e=Object.entries(e).map(([r,n])=>({label:n,value:r}))),e.forEach(r=>{typeof r!="object"&&(r={label:r,value:r}),this._parseListItem(r,i,0)}),!this.currentItems.length&&this.params.freetext&&(this.input.value=this.initialValues,this.typing=!0,this.lastAction="typing"),this.data=i,i}_parseListItem(e,i,r){var n={};e.options?n=this._parseListGroup(e,r+1):(n={label:e.label,value:e.value,itemParams:e.itemParams,elementAttributes:e.elementAttributes,element:!1,selected:!1,visible:!0,level:r,original:e},this.initialValues&&this.initialValues.indexOf(e.value)>-1&&this._chooseItem(n,!0)),i.push(n)}_parseListGroup(e,i){var r={label:e.label,group:!0,itemParams:e.itemParams,elementAttributes:e.elementAttributes,element:!1,visible:!0,level:i,options:[],original:e};return e.options.forEach(n=>{this._parseListItem(n,r.options,i)}),r}_sortOptions(e){var i;return this.params.sort&&(i=typeof this.params.sort=="function"?this.params.sort:this._defaultSortFunction.bind(this),this._sortGroup(i,e)),e}_sortGroup(e,i){i.sort((r,n)=>e(r.label,n.label,r.value,n.value,r.original,n.original)),i.forEach(r=>{r.group&&this._sortGroup(e,r.options)})}_defaultSortFunction(e,i){var r,n,a,s,o=0,l,u=/(\d+)|(\D+)/g,c=/\d/,d=0;if(this.params.sort==="desc"&&([e,i]=[i,e]),!e&&e!==0)d=!i&&i!==0?0:-1;else if(!i&&i!==0)d=1;else{if(isFinite(e)&&isFinite(i))return e-i;if(r=String(e).toLowerCase(),n=String(i).toLowerCase(),r===n)return 0;if(!(c.test(r)&&c.test(n)))return r>n?1:-1;for(r=r.match(u),n=n.match(u),l=r.length>n.length?n.length:r.length;o<l;)if(a=r[o],s=n[o++],a!==s)return isFinite(a)&&isFinite(s)?(a.charAt(0)==="0"&&(a="."+a),s.charAt(0)==="0"&&(s="."+s),a-s):a>s?1:-1;return r.length>n.length}return d}_filterOptions(){var e=this.params.filterFunc||this._defaultFilterFunc,i=this.input.value;return i?(this.filtered=!0,this.data.forEach(r=>{this._filterItem(e,i,r)})):this.filtered=!1,this.data}_filterItem(e,i,r){var n=!1;return r.group?(r.options.forEach(a=>{this._filterItem(e,i,a)&&(n=!0)}),r.visible=n):r.visible=e(i,r.label,r.value,r.original),r.visible}_defaultFilterFunc(e,i,r,n){return e=String(e).toLowerCase(),i!==null&&typeof i<"u"&&(String(i).toLowerCase().indexOf(e)>-1||String(r).toLowerCase().indexOf(e)>-1)}_clearList(){for(;this.listEl.firstChild;)this.listEl.removeChild(this.listEl.firstChild);this.displayItems=[]}_buildList(e){this._clearList(),e.forEach(i=>{this._buildItem(i)}),this.displayItems.length||this._addPlaceholder(this.params.placeholderEmpty)}_buildItem(e){var i=e.element,r;if(!this.filtered||e.visible){if(!i){if(i=document.createElement("div"),i.tabIndex=0,r=this.params.itemFormatter?this.params.itemFormatter(e.label,e.value,e.original,i):e.label,r instanceof HTMLElement?i.appendChild(r):i.innerHTML=r,e.group?i.classList.add("tabulator-edit-list-group"):i.classList.add("tabulator-edit-list-item"),i.classList.add("tabulator-edit-list-group-level-"+e.level),e.elementAttributes&&typeof e.elementAttributes=="object")for(let n in e.elementAttributes)n.charAt(0)=="+"?(n=n.slice(1),i.setAttribute(n,this.input.getAttribute(n)+e.elementAttributes["+"+n])):i.setAttribute(n,e.elementAttributes[n]);e.group?i.addEventListener("click",this._groupClick.bind(this,e)):i.addEventListener("click",this._itemClick.bind(this,e)),i.addEventListener("mousedown",this._preventBlur.bind(this)),e.element=i}this._styleItem(e),this.listEl.appendChild(i),e.group?e.options.forEach(n=>{this._buildItem(n)}):this.displayItems.push(e)}}_showList(){var e=this.popup&&this.popup.isVisible();if(this.input.parentNode){if(this.params.autocomplete&&this.input.value===""&&!this.params.listOnEmpty){this.popup&&this.popup.hide(!0);return}this._setListWidth(),this.popup||(this.popup=this.edit.popup(this.listEl)),this.popup.show(this.cell.getElement(),"bottom"),e||setTimeout(()=>{this.popup.hideOnBlur(this._resolveValue.bind(this,!0))},10)}}_styleItem(e){e&&e.element&&(e.selected?e.element.classList.add("active"):e.element.classList.remove("active"))}_itemClick(e,i){i.stopPropagation(),this._chooseItem(e)}_groupClick(e,i){i.stopPropagation()}_cancel(){this.popup.hide(!0),this.actions.cancel()}_clearChoices(){this.typing=!0,this.currentItems.forEach(e=>{e.selected=!1,this._styleItem(e)}),this.currentItems=[],this.focusedItem=null}_chooseItem(e,i){var r;this.typing=!1,this.params.multiselect?(r=this.currentItems.indexOf(e),r>-1?(this.currentItems.splice(r,1),e.selected=!1):(this.currentItems.push(e),e.selected=!0),this.input.value=this.currentItems.map(n=>n.label).join(","),this._styleItem(e)):(this.currentItems=[e],e.selected=!0,this.input.value=e.label,this._styleItem(e),i||this._resolveValue()),this._focusItem(e)}_resolveValue(e){var i,r;if(this.popup&&this.popup.hide(!0),this.params.multiselect)i=this.currentItems.map(n=>n.value);else if(e&&this.params.autocomplete&&this.typing)if(this.params.freetext||this.params.allowEmpty&&this.input.value==="")i=this.input.value;else{this.actions.cancel();return}else this.currentItems[0]?i=this.currentItems[0].value:(r=Array.isArray(this.initialValues)?this.initialValues[0]:this.initialValues,r===null||typeof r>"u"||r===""?i=r:i=this.params.emptyValue);i===""&&(i=this.params.emptyValue),this.actions.success(i),this.isFilter&&(this.initialValues=i&&!Array.isArray(i)?[i]:i,this.currentItems=[])}};function Wme(t,e,i,r,n){var a=new Hme(this,t,e,i,r,n);return a.input}function zme(t,e,i,r,n){var a=this,s=t.getElement(),o=t.getValue(),l=s.getElementsByTagName("svg").length||5,u=s.getElementsByTagName("svg")[0]?s.getElementsByTagName("svg")[0].getAttribute("width"):14,c=[],d=document.createElement("div"),p=document.createElementNS("http://www.w3.org/2000/svg","svg");function f(I){c.forEach(function(v,w){w<I?(a.table.browser=="ie"?v.setAttribute("class","tabulator-star-active"):v.classList.replace("tabulator-star-inactive","tabulator-star-active"),v.innerHTML='<polygon fill="#488CE9" stroke="#014AAE" stroke-width="37.6152" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" points="259.216,29.942 330.27,173.919 489.16,197.007 374.185,309.08 401.33,467.31 259.216,392.612 117.104,467.31 144.25,309.08 29.274,197.007 188.165,173.919 "/>'):(a.table.browser=="ie"?v.setAttribute("class","tabulator-star-inactive"):v.classList.replace("tabulator-star-active","tabulator-star-inactive"),v.innerHTML='<polygon fill="#010155" stroke="#686868" stroke-width="37.6152" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" points="259.216,29.942 330.27,173.919 489.16,197.007 374.185,309.08 401.33,467.31 259.216,392.612 117.104,467.31 144.25,309.08 29.274,197.007 188.165,173.919 "/>')})}function m(I){var v=document.createElement("span"),w=p.cloneNode(!0);c.push(w),v.addEventListener("mouseenter",function(y){y.stopPropagation(),y.stopImmediatePropagation(),f(I)}),v.addEventListener("mousemove",function(y){y.stopPropagation(),y.stopImmediatePropagation()}),v.addEventListener("click",function(y){y.stopPropagation(),y.stopImmediatePropagation(),i(I),s.blur()}),v.appendChild(w),d.appendChild(v)}function h(I){o=I,f(I)}if(s.style.whiteSpace="nowrap",s.style.overflow="hidden",s.style.textOverflow="ellipsis",d.style.verticalAlign="middle",d.style.display="inline-block",d.style.padding="4px",p.setAttribute("width",u),p.setAttribute("height",u),p.setAttribute("viewBox","0 0 512 512"),p.setAttribute("xml:space","preserve"),p.style.padding="0 1px",n.elementAttributes&&typeof n.elementAttributes=="object")for(let I in n.elementAttributes)I.charAt(0)=="+"?(I=I.slice(1),d.setAttribute(I,d.getAttribute(I)+n.elementAttributes["+"+I])):d.setAttribute(I,n.elementAttributes[I]);for(var g=1;g<=l;g++)m(g);return o=Math.min(parseInt(o),l),f(o),d.addEventListener("mousemove",function(I){f(0)}),d.addEventListener("click",function(I){i(0)}),s.addEventListener("blur",function(I){r()}),s.addEventListener("keydown",function(I){switch(I.keyCode){case 39:h(o+1);break;case 37:h(o-1);break;case 13:i(o);break;case 27:r();break}}),d}function qme(t,e,i,r,n){var a=t.getElement(),s=typeof n.max>"u"?a.getElementsByTagName("div")[0]&&a.getElementsByTagName("div")[0].getAttribute("max")||100:n.max,o=typeof n.min>"u"?a.getElementsByTagName("div")[0]&&a.getElementsByTagName("div")[0].getAttribute("min")||0:n.min,l=(s-o)/100,u=t.getValue()||0,c=document.createElement("div"),d=document.createElement("div"),p,f;function m(){var h=window.getComputedStyle(a,null),g=l*Math.round(d.offsetWidth/((a.clientWidth-parseInt(h.getPropertyValue("padding-left"))-parseInt(h.getPropertyValue("padding-right")))/100))+o;i(g),a.setAttribute("aria-valuenow",g),a.setAttribute("aria-label",u)}if(c.style.position="absolute",c.style.right="0",c.style.top="0",c.style.bottom="0",c.style.width="5px",c.classList.add("tabulator-progress-handle"),d.style.display="inline-block",d.style.position="relative",d.style.height="100%",d.style.backgroundColor="#488CE9",d.style.maxWidth="100%",d.style.minWidth="0%",n.elementAttributes&&typeof n.elementAttributes=="object")for(let h in n.elementAttributes)h.charAt(0)=="+"?(h=h.slice(1),d.setAttribute(h,d.getAttribute(h)+n.elementAttributes["+"+h])):d.setAttribute(h,n.elementAttributes[h]);return a.style.padding="4px 4px",u=Math.min(parseFloat(u),s),u=Math.max(parseFloat(u),o),u=Math.round((u-o)/l),d.style.width=u+"%",a.setAttribute("aria-valuemin",o),a.setAttribute("aria-valuemax",s),d.appendChild(c),c.addEventListener("mousedown",function(h){p=h.screenX,f=d.offsetWidth}),c.addEventListener("mouseover",function(){c.style.cursor="ew-resize"}),a.addEventListener("mousemove",function(h){p&&(d.style.width=f+h.screenX-p+"px")}),a.addEventListener("mouseup",function(h){p&&(h.stopPropagation(),h.stopImmediatePropagation(),p=!1,f=!1,m())}),a.addEventListener("keydown",function(h){switch(h.keyCode){case 39:h.preventDefault(),d.style.width=d.clientWidth+a.clientWidth/100+"px";break;case 37:h.preventDefault(),d.style.width=d.clientWidth-a.clientWidth/100+"px";break;case 9:case 13:m();break;case 27:r();break}}),a.addEventListener("blur",function(){r()}),d}function Yme(t,e,i,r,n){var a=t.getValue(),s=document.createElement("input"),o=n.tristate,l=typeof n.indeterminateValue>"u"?null:n.indeterminateValue,u=!1,c=Object.keys(n).includes("trueValue"),d=Object.keys(n).includes("falseValue");if(s.setAttribute("type","checkbox"),s.style.marginTop="5px",s.style.boxSizing="border-box",n.elementAttributes&&typeof n.elementAttributes=="object")for(let f in n.elementAttributes)f.charAt(0)=="+"?(f=f.slice(1),s.setAttribute(f,s.getAttribute(f)+n.elementAttributes["+"+f])):s.setAttribute(f,n.elementAttributes[f]);s.value=a,o&&(typeof a>"u"||a===l||a==="")&&(u=!0,s.indeterminate=!0),this.table.browser!="firefox"&&this.table.browser!="safari"&&e(function(){t.getType()==="cell"&&s.focus({preventScroll:!0})}),s.checked=c?a===n.trueValue:a===!0||a==="true"||a==="True"||a===1;function p(f){var m=s.checked;return c&&m?m=n.trueValue:d&&!m&&(m=n.falseValue),o?f?u?l:m:s.checked&&!u?(s.checked=!1,s.indeterminate=!0,u=!0,l):(u=!1,m):m}return s.addEventListener("change",function(f){i(p())}),s.addEventListener("blur",function(f){i(p(!0))}),s.addEventListener("keydown",function(f){f.keyCode==13&&i(p()),f.keyCode==27&&r()}),s}function Kme(t,e,i,r,n){var a=t._getSelf().column,s,o,l;function u(c){var d=c.getValue(),p="input";switch(typeof d){case"number":p="number";break;case"boolean":p="tickCross";break;case"string":d.includes(`
`)&&(p="textarea");break}return p}return s=n.editorLookup?n.editorLookup(t):u(t),n.paramsLookup&&(l=typeof n.paramsLookup=="function"?n.paramsLookup(s,t):n.paramsLookup[s]),o=this.table.modules.edit.lookupEditor(s,a),o.call(this,t,e,i,r,l||{})}var Xme={input:Lme,textarea:_me,number:$me,range:Bme,date:Vme,time:jme,datetime:Gme,list:Wme,star:zme,progress:qme,tickCross:Yme,adaptable:Kme};class P1 extends si{static moduleName="edit";static editors=Xme;constructor(e){super(e),this.currentCell=!1,this.mouseClick=!1,this.recursionBlock=!1,this.invalidEdit=!1,this.editedCells=[],this.convertEmptyValues=!1,this.editors=P1.editors,this.registerTableOption("editTriggerEvent","focus"),this.registerTableOption("editorEmptyValue"),this.registerTableOption("editorEmptyValueFunc",this.emptyValueCheck.bind(this)),this.registerColumnOption("editable"),this.registerColumnOption("editor"),this.registerColumnOption("editorParams"),this.registerColumnOption("editorEmptyValue"),this.registerColumnOption("editorEmptyValueFunc"),this.registerColumnOption("cellEditing"),this.registerColumnOption("cellEdited"),this.registerColumnOption("cellEditCancelled"),this.registerTableFunction("getEditedCells",this.getEditedCells.bind(this)),this.registerTableFunction("clearCellEdited",this.clearCellEdited.bind(this)),this.registerTableFunction("navigatePrev",this.navigatePrev.bind(this)),this.registerTableFunction("navigateNext",this.navigateNext.bind(this)),this.registerTableFunction("navigateLeft",this.navigateLeft.bind(this)),this.registerTableFunction("navigateRight",this.navigateRight.bind(this)),this.registerTableFunction("navigateUp",this.navigateUp.bind(this)),this.registerTableFunction("navigateDown",this.navigateDown.bind(this)),this.registerComponentFunction("cell","isEdited",this.cellIsEdited.bind(this)),this.registerComponentFunction("cell","clearEdited",this.clearEdited.bind(this)),this.registerComponentFunction("cell","edit",this.editCell.bind(this)),this.registerComponentFunction("cell","cancelEdit",this.cellCancelEdit.bind(this)),this.registerComponentFunction("cell","navigatePrev",this.navigatePrev.bind(this)),this.registerComponentFunction("cell","navigateNext",this.navigateNext.bind(this)),this.registerComponentFunction("cell","navigateLeft",this.navigateLeft.bind(this)),this.registerComponentFunction("cell","navigateRight",this.navigateRight.bind(this)),this.registerComponentFunction("cell","navigateUp",this.navigateUp.bind(this)),this.registerComponentFunction("cell","navigateDown",this.navigateDown.bind(this))}initialize(){this.subscribe("cell-init",this.bindEditor.bind(this)),this.subscribe("cell-delete",this.clearEdited.bind(this)),this.subscribe("cell-value-changed",this.updateCellClass.bind(this)),this.subscribe("column-layout",this.initializeColumnCheck.bind(this)),this.subscribe("column-delete",this.columnDeleteCheck.bind(this)),this.subscribe("row-deleting",this.rowDeleteCheck.bind(this)),this.subscribe("row-layout",this.rowEditableCheck.bind(this)),this.subscribe("data-refreshing",this.cancelEdit.bind(this)),this.subscribe("clipboard-paste",this.pasteBlocker.bind(this)),this.subscribe("keybinding-nav-prev",this.navigatePrev.bind(this,void 0)),this.subscribe("keybinding-nav-next",this.keybindingNavigateNext.bind(this)),this.subscribe("keybinding-nav-up",this.navigateUp.bind(this,void 0)),this.subscribe("keybinding-nav-down",this.navigateDown.bind(this,void 0)),Object.keys(this.table.options).includes("editorEmptyValue")&&(this.convertEmptyValues=!0)}pasteBlocker(e){if(this.currentCell)return!0}keybindingNavigateNext(e){var i=this.currentCell,r=this.options("tabEndNewRow");i&&(this.navigateNext(i,e)||r&&(i.getElement().firstChild.blur(),this.invalidEdit||(r===!0?r=this.table.addRow({}):typeof r=="function"?r=this.table.addRow(r(i.row.getComponent())):r=this.table.addRow(Object.assign({},r)),r.then(()=>{setTimeout(()=>{i.getComponent().navigateNext()})}))))}cellIsEdited(e){return!!e.modules.edit&&e.modules.edit.edited}cellCancelEdit(e){e===this.currentCell?this.table.modules.edit.cancelEdit():console.warn("Cancel Editor Error - This cell is not currently being edited ")}updateCellClass(e){this.allowEdit(e)?e.getElement().classList.add("tabulator-editable"):e.getElement().classList.remove("tabulator-editable")}clearCellEdited(e){e||(e=this.table.modules.edit.getEditedCells()),Array.isArray(e)||(e=[e]),e.forEach(i=>{this.table.modules.edit.clearEdited(i._getSelf())})}navigatePrev(e=this.currentCell,i){var r,n;if(e){if(i&&i.preventDefault(),r=this.navigateLeft(),r)return!0;if(n=this.table.rowManager.prevDisplayRow(e.row,!0),n&&(r=this.findPrevEditableCell(n,n.cells.length),r))return r.getComponent().edit(),!0}return!1}navigateNext(e=this.currentCell,i){var r,n;if(e){if(i&&i.preventDefault(),r=this.navigateRight(),r)return!0;if(n=this.table.rowManager.nextDisplayRow(e.row,!0),n&&(r=this.findNextEditableCell(n,-1),r))return r.getComponent().edit(),!0}return!1}navigateLeft(e=this.currentCell,i){var r,n;return e&&(i&&i.preventDefault(),r=e.getIndex(),n=this.findPrevEditableCell(e.row,r),n)?(n.getComponent().edit(),!0):!1}navigateRight(e=this.currentCell,i){var r,n;return e&&(i&&i.preventDefault(),r=e.getIndex(),n=this.findNextEditableCell(e.row,r),n)?(n.getComponent().edit(),!0):!1}navigateUp(e=this.currentCell,i){var r,n;return e&&(i&&i.preventDefault(),r=e.getIndex(),n=this.table.rowManager.prevDisplayRow(e.row,!0),n)?(n.cells[r].getComponent().edit(),!0):!1}navigateDown(e=this.currentCell,i){var r,n;return e&&(i&&i.preventDefault(),r=e.getIndex(),n=this.table.rowManager.nextDisplayRow(e.row,!0),n)?(n.cells[r].getComponent().edit(),!0):!1}findNextEditableCell(e,i){var r=!1;if(i<e.cells.length-1)for(var n=i+1;n<e.cells.length;n++){let a=e.cells[n];if(a.column.modules.edit&&gr.elVisible(a.getElement())&&this.allowEdit(a)){r=a;break}}return r}findPrevEditableCell(e,i){var r=!1;if(i>0)for(var n=i-1;n>=0;n--){let a=e.cells[n];if(a.column.modules.edit&&gr.elVisible(a.getElement())&&this.allowEdit(a)){r=a;break}}return r}initializeColumnCheck(e){typeof e.definition.editor<"u"&&this.initializeColumn(e)}columnDeleteCheck(e){this.currentCell&&this.currentCell.column===e&&this.cancelEdit()}rowDeleteCheck(e){this.currentCell&&this.currentCell.row===e&&this.cancelEdit()}rowEditableCheck(e){e.getCells().forEach(i=>{i.column.modules.edit&&typeof i.column.modules.edit.check=="function"&&this.updateCellClass(i)})}initializeColumn(e){var i=Object.keys(e.definition).includes("editorEmptyValue"),r={editor:!1,blocked:!1,check:e.definition.editable,params:e.definition.editorParams||{},convertEmptyValues:i,editorEmptyValue:e.definition.editorEmptyValue,editorEmptyValueFunc:e.definition.editorEmptyValueFunc};r.editor=this.lookupEditor(e.definition.editor,e),r.editor&&(e.modules.edit=r)}lookupEditor(e,i){var r;switch(typeof e){case"string":this.editors[e]?r=this.editors[e]:console.warn("Editor Error - No such editor found: ",e);break;case"function":r=e;break;case"boolean":e===!0&&(typeof i.definition.formatter!="function"?this.editors[i.definition.formatter]?r=this.editors[i.definition.formatter]:r=this.editors.input:console.warn("Editor Error - Cannot auto lookup editor for a custom formatter: ",i.definition.formatter));break}return r}getCurrentCell(){return this.currentCell?this.currentCell.getComponent():!1}clearEditor(e){var i=this.currentCell,r;if(this.invalidEdit=!1,i){for(this.currentCell=!1,r=i.getElement(),this.dispatch("edit-editor-clear",i,e),r.classList.remove("tabulator-editing");r.firstChild;)r.removeChild(r.firstChild);i.row.getElement().classList.remove("tabulator-editing"),i.table.element.classList.remove("tabulator-editing")}}cancelEdit(){if(this.currentCell){var e=this.currentCell,i=this.currentCell.getComponent();this.clearEditor(!0),e.setValueActual(e.getValue()),e.cellRendered(),(e.column.definition.editor=="textarea"||e.column.definition.variableHeight)&&e.row.normalizeHeight(!0),e.column.definition.cellEditCancelled&&e.column.definition.cellEditCancelled.call(this.table,i),this.dispatch("edit-cancelled",e),this.dispatchExternal("cellEditCancelled",i)}}bindEditor(e){if(e.column.modules.edit){var i=this,r=e.getElement(!0);this.updateCellClass(e),r.setAttribute("tabindex",0),r.addEventListener("mousedown",function(n){n.button===2?n.preventDefault():i.mouseClick=!0}),this.options("editTriggerEvent")==="dblclick"&&r.addEventListener("dblclick",function(n){r.classList.contains("tabulator-editing")||(r.focus({preventScroll:!0}),i.edit(e,n,!1))}),(this.options("editTriggerEvent")==="focus"||this.options("editTriggerEvent")==="click")&&r.addEventListener("click",function(n){r.classList.contains("tabulator-editing")||(r.focus({preventScroll:!0}),i.edit(e,n,!1))}),this.options("editTriggerEvent")==="focus"&&r.addEventListener("focus",function(n){i.recursionBlock||i.edit(e,n,!1)})}}focusCellNoEvent(e,i){this.recursionBlock=!0,i&&this.table.browser==="ie"||e.getElement().focus({preventScroll:!0}),this.recursionBlock=!1}editCell(e,i){this.focusCellNoEvent(e),this.edit(e,!1,i)}focusScrollAdjust(e){if(this.table.rowManager.getRenderMode()=="virtual"){var i=this.table.rowManager.element.scrollTop,r=this.table.rowManager.element.clientHeight+this.table.rowManager.element.scrollTop,n=e.row.getElement();n.offsetTop<i?this.table.rowManager.element.scrollTop-=i-n.offsetTop:n.offsetTop+n.offsetHeight>r&&(this.table.rowManager.element.scrollTop+=n.offsetTop+n.offsetHeight-r);var a=this.table.rowManager.element.scrollLeft,s=this.table.rowManager.element.clientWidth+this.table.rowManager.element.scrollLeft,o=e.getElement();this.table.modExists("frozenColumns")&&(a+=parseInt(this.table.modules.frozenColumns.leftMargin||0),s-=parseInt(this.table.modules.frozenColumns.rightMargin||0)),this.table.options.renderHorizontal==="virtual"&&(a-=parseInt(this.table.columnManager.renderer.vDomPadLeft),s-=parseInt(this.table.columnManager.renderer.vDomPadLeft)),o.offsetLeft<a?this.table.rowManager.element.scrollLeft-=a-o.offsetLeft:o.offsetLeft+o.offsetWidth>s&&(this.table.rowManager.element.scrollLeft+=o.offsetLeft+o.offsetWidth-s)}}allowEdit(e){var i=!!e.column.modules.edit;if(e.column.modules.edit)switch(typeof e.column.modules.edit.check){case"function":e.row.initialized&&(i=e.column.modules.edit.check(e.getComponent()));break;case"string":i=!!e.row.data[e.column.modules.edit.check];break;case"boolean":i=e.column.modules.edit.check;break}return i}edit(e,i,r){var n=this,a=!0,s=function(){},o=e.getElement(),l=!1,u,c,d;if(this.currentCell){!this.invalidEdit&&this.currentCell!==e&&this.cancelEdit();return}function p(I){if(n.currentCell===e&&!l){var v=n.chain("edit-success",[e,I],!0,!0);return v===!0||n.table.options.validationMode==="highlight"?(l=!0,n.clearEditor(),e.modules.edit||(e.modules.edit={}),e.modules.edit.edited=!0,n.editedCells.indexOf(e)==-1&&n.editedCells.push(e),I=n.transformEmptyValues(I,e),e.setValue(I,!0),v===!0):(l=!0,n.invalidEdit=!0,n.focusCellNoEvent(e,!0),s(),setTimeout(()=>{l=!1},10),!1)}}function f(){n.currentCell===e&&!l&&n.cancelEdit()}function m(I){s=I}if(e.column.modules.edit.blocked)return this.mouseClick=!1,this.blur(o),!1;if(i&&i.stopPropagation(),a=this.allowEdit(e),a||r){if(n.cancelEdit(),n.currentCell=e,this.focusScrollAdjust(e),c=e.getComponent(),this.mouseClick&&(this.mouseClick=!1,e.column.definition.cellClick&&e.column.definition.cellClick.call(this.table,i,c)),e.column.definition.cellEditing&&e.column.definition.cellEditing.call(this.table,c),this.dispatch("cell-editing",e),this.dispatchExternal("cellEditing",c),d=typeof e.column.modules.edit.params=="function"?e.column.modules.edit.params(c):e.column.modules.edit.params,u=e.column.modules.edit.editor.call(n,c,m,p,f,d),this.currentCell&&u!==!1)if(u instanceof Node){for(o.classList.add("tabulator-editing"),e.row.getElement().classList.add("tabulator-editing"),e.table.element.classList.add("tabulator-editing");o.firstChild;)o.removeChild(o.firstChild);o.appendChild(u),s();for(var h=o.children,g=0;g<h.length;g++)h[g].addEventListener("click",function(I){I.stopPropagation()})}else return console.warn("Edit Error - Editor should return an instance of Node, the editor returned:",u),this.blur(o),!1;else return this.blur(o),!1;return!0}else return this.mouseClick=!1,this.blur(o),!1}emptyValueCheck(e){return e===""||e===null||typeof e>"u"}transformEmptyValues(e,i){var r=i.column.modules.edit,n=r.convertEmptyValues||this.convertEmptyValues,a;return n&&(a=r.editorEmptyValueFunc||this.options("editorEmptyValueFunc"),a&&a(e)&&(e=r.convertEmptyValues?r.editorEmptyValue:this.options("editorEmptyValue"))),e}blur(e){this.confirm("edit-blur",[e])||e.blur()}getEditedCells(){var e=[];return this.editedCells.forEach(i=>{e.push(i.getComponent())}),e}clearEdited(e){var i;e.modules.edit&&e.modules.edit.edited&&(e.modules.edit.edited=!1,this.dispatch("edit-edited-clear",e)),i=this.editedCells.indexOf(e),i>-1&&this.editedCells.splice(i,1)}}class DH{constructor(e,i,r,n){this.type=e,this.columns=i,this.component=r||!1,this.indent=n||0}}class TA{constructor(e,i,r,n,a){this.value=e,this.component=i||!1,this.width=r,this.height=n,this.depth=a}}var Jme={},Qme={visible:function(){return this.rowManager.getVisibleRows(!1,!0)},all:function(){return this.rowManager.rows},selected:function(){return this.modules.selectRow.selectedRows},active:function(){return this.options.pagination?this.rowManager.getDisplayRows(this.rowManager.displayRows.length-2):this.rowManager.getDisplayRows()}};class Ay extends si{static moduleName="export";static columnLookups=Jme;static rowLookups=Qme;constructor(e){super(e),this.config={},this.cloneTableStyle=!0,this.colVisProp="",this.colVisPropAttach="",this.registerTableOption("htmlOutputConfig",!1),this.registerColumnOption("htmlOutput"),this.registerColumnOption("titleHtmlOutput")}initialize(){this.registerTableFunction("getHtml",this.getHtml.bind(this))}generateExportList(e,i,r,n){var a,s,o,l;return this.cloneTableStyle=i,this.config=e||{},this.colVisProp=n,this.colVisPropAttach=this.colVisProp.charAt(0).toUpperCase()+this.colVisProp.slice(1),l=Ay.columnLookups[r],l&&(o=l.call(this.table),o=o.filter(u=>this.columnVisCheck(u))),a=this.config.columnHeaders!==!1?this.headersToExportRows(this.generateColumnGroupHeaders(o)):[],o&&(o=o.map(u=>u.getComponent())),s=this.bodyToExportRows(this.rowLookup(r),o),a.concat(s)}generateTable(e,i,r,n){var a=this.generateExportList(e,i,r,n);return this.generateTableElement(a)}rowLookup(e){var i=[],r;return typeof e=="function"?e.call(this.table).forEach(n=>{n=this.table.rowManager.findRow(n),n&&i.push(n)}):(r=Ay.rowLookups[e]||Ay.rowLookups.active,i=r.call(this.table)),Object.assign([],i)}generateColumnGroupHeaders(e){var i=[];return e||(e=this.config.columnGroups!==!1?this.table.columnManager.columns:this.table.columnManager.columnsByIndex),e.forEach(r=>{var n=this.processColumnGroup(r);n&&i.push(n)}),i}processColumnGroup(e){var i=e.columns,r=0,n=e.definition["title"+this.colVisPropAttach]||e.definition.title,a={title:n,column:e,depth:1};if(i.length){if(a.subGroups=[],a.width=0,i.forEach(s=>{var o=this.processColumnGroup(s);o&&(a.width+=o.width,a.subGroups.push(o),o.depth>r&&(r=o.depth))}),a.depth+=r,!a.width)return!1}else if(this.columnVisCheck(e))a.width=1;else return!1;return a}columnVisCheck(e){var i=e.definition[this.colVisProp];return this.config.rowHeaders===!1&&e.isRowHeader?!1:(typeof i=="function"&&(i=i.call(this.table,e.getComponent())),i===!1||i===!0?i:e.visible&&e.field)}headersToExportRows(e){var i=[],r=0,n=[];function a(s,o){var l=r-o;if(typeof i[o]>"u"&&(i[o]=[]),s.height=s.subGroups?1:l-s.depth+1,i[o].push(s),s.height>1)for(let u=1;u<s.height;u++)typeof i[o+u]>"u"&&(i[o+u]=[]),i[o+u].push(!1);if(s.width>1)for(let u=1;u<s.width;u++)i[o].push(!1);s.subGroups&&s.subGroups.forEach(function(u){a(u,o+1)})}return e.forEach(function(s){s.depth>r&&(r=s.depth)}),e.forEach(function(s){a(s,0)}),i.forEach(s=>{var o=[];s.forEach(l=>{if(l){let u=typeof l.title>"u"?"":l.title;o.push(new TA(u,l.column.getComponent(),l.width,l.height,l.depth))}else o.push(null)}),n.push(new DH("header",o))}),n}bodyToExportRows(e,i=[]){var r=[];return i.length===0&&this.table.columnManager.columnsByIndex.forEach(n=>{this.columnVisCheck(n)&&i.push(n.getComponent())}),this.config.columnCalcs!==!1&&this.table.modExists("columnCalcs")&&(this.table.modules.columnCalcs.topInitialized&&e.unshift(this.table.modules.columnCalcs.topRow),this.table.modules.columnCalcs.botInitialized&&e.push(this.table.modules.columnCalcs.botRow)),e=e.filter(n=>{switch(n.type){case"group":return this.config.rowGroups!==!1;case"calc":return this.config.columnCalcs!==!1;case"row":return!(this.table.options.dataTree&&this.config.dataTree===!1&&n.modules.dataTree.parent)}return!0}),e.forEach((n,a)=>{var s=n.getData(this.colVisProp),o=[],l=0;switch(n.type){case"group":l=n.level,o.push(new TA(n.key,n.getComponent(),i.length,1));break;case"calc":case"row":i.forEach(u=>{o.push(new TA(u._column.getFieldValue(s),u,1,1))}),this.table.options.dataTree&&this.config.dataTree!==!1&&(l=n.modules.dataTree.index);break}r.push(new DH(n.type,o,n.getComponent(),l))}),r}generateTableElement(e){var i=document.createElement("table"),r=document.createElement("thead"),n=document.createElement("tbody"),a=this.lookupTableStyles(),s=this.table.options["rowFormatter"+this.colVisPropAttach],o={};return o.rowFormatter=s!==null?s:this.table.options.rowFormatter,this.table.options.dataTree&&this.config.dataTree!==!1&&this.table.modExists("columnCalcs")&&(o.treeElementField=this.table.modules.dataTree.elementField),o.groupHeader=this.table.options["groupHeader"+this.colVisPropAttach],o.groupHeader&&!Array.isArray(o.groupHeader)&&(o.groupHeader=[o.groupHeader]),i.classList.add("tabulator-print-table"),this.mapElementStyles(this.table.columnManager.getHeadersElement(),r,["border-top","border-left","border-right","border-bottom","background-color","color","font-weight","font-family","font-size"]),e.length>1e3&&console.warn("It may take a long time to render an HTML table with more than 1000 rows"),e.forEach((l,u)=>{let c;switch(l.type){case"header":r.appendChild(this.generateHeaderElement(l,o,a));break;case"group":n.appendChild(this.generateGroupElement(l,o,a));break;case"calc":n.appendChild(this.generateCalcElement(l,o,a));break;case"row":c=this.generateRowElement(l,o,a),this.mapElementStyles(u%2&&a.evenRow?a.evenRow:a.oddRow,c,["border-top","border-left","border-right","border-bottom","color","font-weight","font-family","font-size","background-color"]),n.appendChild(c);break}}),r.innerHTML&&i.appendChild(r),i.appendChild(n),this.mapElementStyles(this.table.element,i,["border-top","border-left","border-right","border-bottom"]),i}lookupTableStyles(){var e={};return this.cloneTableStyle&&window.getComputedStyle&&(e.oddRow=this.table.element.querySelector(".tabulator-row-odd:not(.tabulator-group):not(.tabulator-calcs)"),e.evenRow=this.table.element.querySelector(".tabulator-row-even:not(.tabulator-group):not(.tabulator-calcs)"),e.calcRow=this.table.element.querySelector(".tabulator-row.tabulator-calcs"),e.firstRow=this.table.element.querySelector(".tabulator-row:not(.tabulator-group):not(.tabulator-calcs)"),e.firstGroup=this.table.element.getElementsByClassName("tabulator-group")[0],e.firstRow&&(e.styleCells=e.firstRow.getElementsByClassName("tabulator-cell"),e.styleRowHeader=e.firstRow.getElementsByClassName("tabulator-row-header")[0],e.firstCell=e.styleCells[0],e.lastCell=e.styleCells[e.styleCells.length-1])),e}generateHeaderElement(e,i,r){var n=document.createElement("tr");return e.columns.forEach(a=>{if(a){var s=document.createElement("th"),o=a.component._column.definition.cssClass?a.component._column.definition.cssClass.split(" "):[];s.colSpan=a.width,s.rowSpan=a.height,s.innerHTML=a.value,this.cloneTableStyle&&(s.style.boxSizing="border-box"),o.forEach(function(l){s.classList.add(l)}),this.mapElementStyles(a.component.getElement(),s,["text-align","border-left","border-right","background-color","color","font-weight","font-family","font-size"]),this.mapElementStyles(a.component._column.contentElement,s,["padding-top","padding-left","padding-right","padding-bottom"]),a.component._column.visible?this.mapElementStyles(a.component.getElement(),s,["width"]):a.component._column.definition.width&&(s.style.width=a.component._column.definition.width+"px"),a.component._column.parent&&a.component._column.parent.isGroup?this.mapElementStyles(a.component._column.parent.groupElement,s,["border-top"]):this.mapElementStyles(a.component.getElement(),s,["border-top"]),a.component._column.isGroup?this.mapElementStyles(a.component.getElement(),s,["border-bottom"]):this.mapElementStyles(this.table.columnManager.getElement(),s,["border-bottom"]),n.appendChild(s)}}),n}generateGroupElement(e,i,r){var n=document.createElement("tr"),a=document.createElement("td"),s=e.columns[0];return n.classList.add("tabulator-print-table-row"),i.groupHeader&&i.groupHeader[e.indent]?s.value=i.groupHeader[e.indent](s.value,e.component._group.getRowCount(),e.component._group.getData(),e.component):i.groupHeader!==!1&&(s.value=e.component._group.generator(s.value,e.component._group.getRowCount(),e.component._group.getData(),e.component)),a.colSpan=s.width,a.innerHTML=s.value,n.classList.add("tabulator-print-table-group"),n.classList.add("tabulator-group-level-"+e.indent),s.component.isVisible()&&n.classList.add("tabulator-group-visible"),this.mapElementStyles(r.firstGroup,n,["border-top","border-left","border-right","border-bottom","color","font-weight","font-family","font-size","background-color"]),this.mapElementStyles(r.firstGroup,a,["padding-top","padding-left","padding-right","padding-bottom"]),n.appendChild(a),n}generateCalcElement(e,i,r){var n=this.generateRowElement(e,i,r);return n.classList.add("tabulator-print-table-calcs"),this.mapElementStyles(r.calcRow,n,["border-top","border-left","border-right","border-bottom","color","font-weight","font-family","font-size","background-color"]),n}generateRowElement(e,i,r){var n=document.createElement("tr");if(n.classList.add("tabulator-print-table-row"),e.columns.forEach((a,s)=>{if(a){var o=document.createElement("td"),l=a.component._column,u=this.table,c=u.columnManager.findColumnIndex(l),d=a.value,p,f,m={modules:{},getValue:function(){return d},getField:function(){return l.definition.field},getElement:function(){return o},getType:function(){return"cell"},getColumn:function(){return l.getComponent()},getData:function(){return e.component.getData()},getRow:function(){return e.component},getTable:function(){return u},getComponent:function(){return m},column:l},h=l.definition.cssClass?l.definition.cssClass.split(" "):[];if(h.forEach(function(g){o.classList.add(g)}),this.table.modExists("format")&&this.config.formatCells!==!1)d=this.table.modules.format.formatExportValue(m,this.colVisProp);else switch(typeof d){case"object":d=d!==null?JSON.stringify(d):"";break;case"undefined":d="";break}d instanceof Node?o.appendChild(d):o.innerHTML=d,f=["padding-top","padding-left","padding-right","padding-bottom","border-top","border-left","border-right","border-bottom","color","font-weight","font-family","font-size","text-align"],l.isRowHeader?(p=r.styleRowHeader,f.push("background-color")):p=r.styleCells&&r.styleCells[c]?r.styleCells[c]:r.firstCell,p&&(this.mapElementStyles(p,o,f),l.definition.align&&(o.style.textAlign=l.definition.align)),this.table.options.dataTree&&this.config.dataTree!==!1&&(i.treeElementField&&i.treeElementField==l.field||!i.treeElementField&&s==0)&&(e.component._row.modules.dataTree.controlEl&&o.insertBefore(e.component._row.modules.dataTree.controlEl.cloneNode(!0),o.firstChild),e.component._row.modules.dataTree.branchEl&&o.insertBefore(e.component._row.modules.dataTree.branchEl.cloneNode(!0),o.firstChild)),n.appendChild(o),m.modules.format&&m.modules.format.renderedCallback&&m.modules.format.renderedCallback()}}),i.rowFormatter&&e.type==="row"&&this.config.formatCells!==!1){let a=Object.assign(e.component);a.getElement=function(){return n},i.rowFormatter(e.component)}return n}generateHTMLTable(e){var i=document.createElement("div");return i.appendChild(this.generateTableElement(e)),i.innerHTML}getHtml(e,i,r,n){var a=this.generateExportList(r||this.table.options.htmlOutputConfig,i,e,n||"htmlOutput");return this.generateHTMLTable(a)}mapElementStyles(e,i,r){if(this.cloneTableStyle&&e&&i){var n={"background-color":"backgroundColor",color:"fontColor",width:"width","font-weight":"fontWeight","font-family":"fontFamily","font-size":"fontSize","text-align":"textAlign","border-top":"borderTop","border-left":"borderLeft","border-right":"borderRight","border-bottom":"borderBottom","padding-top":"paddingTop","padding-left":"paddingLeft","padding-right":"paddingRight","padding-bottom":"paddingBottom"};if(window.getComputedStyle){var a=window.getComputedStyle(e);r.forEach(function(s){i.style[n[s]]||(i.style[n[s]]=a.getPropertyValue(s))})}}}}var Zme={"=":function(t,e,i,r){return e==t},"<":function(t,e,i,r){return e<t},"<=":function(t,e,i,r){return e<=t},">":function(t,e,i,r){return e>t},">=":function(t,e,i,r){return e>=t},"!=":function(t,e,i,r){return e!=t},regex:function(t,e,i,r){return typeof t=="string"&&(t=new RegExp(t)),t.test(e)},like:function(t,e,i,r){return t===null||typeof t>"u"?e===t:typeof e<"u"&&e!==null?String(e).toLowerCase().indexOf(t.toLowerCase())>-1:!1},keywords:function(t,e,i,r){var n=t.toLowerCase().split(typeof r.separator>"u"?" ":r.separator),a=String(e===null||typeof e>"u"?"":e).toLowerCase(),s=[];return n.forEach(o=>{a.includes(o)&&s.push(!0)}),r.matchAll?s.length===n.length:!!s.length},starts:function(t,e,i,r){return t===null||typeof t>"u"?e===t:typeof e<"u"&&e!==null?String(e).toLowerCase().startsWith(t.toLowerCase()):!1},ends:function(t,e,i,r){return t===null||typeof t>"u"?e===t:typeof e<"u"&&e!==null?String(e).toLowerCase().endsWith(t.toLowerCase()):!1},in:function(t,e,i,r){return Array.isArray(t)?t.length?t.indexOf(e)>-1:!0:(console.warn("Filter Error - filter value is not an array:",t),!1)}};class Gf extends si{static moduleName="filter";static filters=Zme;constructor(e){super(e),this.filterList=[],this.headerFilters={},this.headerFilterColumns=[],this.prevHeaderFilterChangeCheck="",this.prevHeaderFilterChangeCheck="{}",this.changed=!1,this.tableInitialized=!1,this.registerTableOption("filterMode","local"),this.registerTableOption("initialFilter",!1),this.registerTableOption("initialHeaderFilter",!1),this.registerTableOption("headerFilterLiveFilterDelay",300),this.registerTableOption("placeholderHeaderFilter",!1),this.registerColumnOption("headerFilter"),this.registerColumnOption("headerFilterPlaceholder"),this.registerColumnOption("headerFilterParams"),this.registerColumnOption("headerFilterEmptyCheck"),this.registerColumnOption("headerFilterFunc"),this.registerColumnOption("headerFilterFuncParams"),this.registerColumnOption("headerFilterLiveFilter"),this.registerTableFunction("searchRows",this.searchRows.bind(this)),this.registerTableFunction("searchData",this.searchData.bind(this)),this.registerTableFunction("setFilter",this.userSetFilter.bind(this)),this.registerTableFunction("refreshFilter",this.userRefreshFilter.bind(this)),this.registerTableFunction("addFilter",this.userAddFilter.bind(this)),this.registerTableFunction("getFilters",this.getFilters.bind(this)),this.registerTableFunction("setHeaderFilterFocus",this.userSetHeaderFilterFocus.bind(this)),this.registerTableFunction("getHeaderFilterValue",this.userGetHeaderFilterValue.bind(this)),this.registerTableFunction("setHeaderFilterValue",this.userSetHeaderFilterValue.bind(this)),this.registerTableFunction("getHeaderFilters",this.getHeaderFilters.bind(this)),this.registerTableFunction("removeFilter",this.userRemoveFilter.bind(this)),this.registerTableFunction("clearFilter",this.userClearFilter.bind(this)),this.registerTableFunction("clearHeaderFilter",this.userClearHeaderFilter.bind(this)),this.registerComponentFunction("column","headerFilterFocus",this.setHeaderFilterFocus.bind(this)),this.registerComponentFunction("column","reloadHeaderFilter",this.reloadHeaderFilter.bind(this)),this.registerComponentFunction("column","getHeaderFilterValue",this.getHeaderFilterValue.bind(this)),this.registerComponentFunction("column","setHeaderFilterValue",this.setHeaderFilterValue.bind(this))}initialize(){this.subscribe("column-init",this.initializeColumnHeaderFilter.bind(this)),this.subscribe("column-width-fit-before",this.hideHeaderFilterElements.bind(this)),this.subscribe("column-width-fit-after",this.showHeaderFilterElements.bind(this)),this.subscribe("table-built",this.tableBuilt.bind(this)),this.subscribe("placeholder",this.generatePlaceholder.bind(this)),this.table.options.filterMode==="remote"&&this.subscribe("data-params",this.remoteFilterParams.bind(this)),this.registerDataHandler(this.filter.bind(this),10)}tableBuilt(){this.table.options.initialFilter&&this.setFilter(this.table.options.initialFilter),this.table.options.initialHeaderFilter&&this.table.options.initialHeaderFilter.forEach(e=>{var i=this.table.columnManager.findColumn(e.field);if(i)this.setHeaderFilterValue(i,e.value);else return console.warn("Column Filter Error - No matching column found:",e.field),!1}),this.tableInitialized=!0}remoteFilterParams(e,i,r,n){return n.filter=this.getFilters(!0,!0),n}generatePlaceholder(e){if(this.table.options.placeholderHeaderFilter&&Object.keys(this.headerFilters).length)return this.table.options.placeholderHeaderFilter}userSetFilter(e,i,r,n){this.setFilter(e,i,r,n),this.refreshFilter()}userRefreshFilter(){this.refreshFilter()}userAddFilter(e,i,r,n){this.addFilter(e,i,r,n),this.refreshFilter()}userSetHeaderFilterFocus(e){var i=this.table.columnManager.findColumn(e);if(i)this.setHeaderFilterFocus(i);else return console.warn("Column Filter Focus Error - No matching column found:",e),!1}userGetHeaderFilterValue(e){var i=this.table.columnManager.findColumn(e);if(i)return this.getHeaderFilterValue(i);console.warn("Column Filter Error - No matching column found:",e)}userSetHeaderFilterValue(e,i){var r=this.table.columnManager.findColumn(e);if(r)this.setHeaderFilterValue(r,i);else return console.warn("Column Filter Error - No matching column found:",e),!1}userRemoveFilter(e,i,r){this.removeFilter(e,i,r),this.refreshFilter()}userClearFilter(e){this.clearFilter(e),this.refreshFilter()}userClearHeaderFilter(){this.clearHeaderFilter(),this.refreshFilter()}searchRows(e,i,r){return this.search("rows",e,i,r)}searchData(e,i,r){return this.search("data",e,i,r)}initializeColumnHeaderFilter(e){var i=e.definition;i.headerFilter&&this.initializeColumn(e)}initializeColumn(e,i){var r=this,n=e.getField();function a(s){var o=e.modules.filter.tagType=="input"&&e.modules.filter.attrType=="text"||e.modules.filter.tagType=="textarea"?"partial":"match",l="",u="",c;if(typeof e.modules.filter.prevSuccess>"u"||e.modules.filter.prevSuccess!==s){if(e.modules.filter.prevSuccess=s,e.modules.filter.emptyFunc(s))delete r.headerFilters[n];else{switch(e.modules.filter.value=s,typeof e.definition.headerFilterFunc){case"string":Gf.filters[e.definition.headerFilterFunc]?(l=e.definition.headerFilterFunc,c=function(d){var p=e.definition.headerFilterFuncParams||{},f=e.getFieldValue(d);return p=typeof p=="function"?p(s,f,d):p,Gf.filters[e.definition.headerFilterFunc](s,f,d,p)}):console.warn("Header Filter Error - Matching filter function not found: ",e.definition.headerFilterFunc);break;case"function":c=function(d){var p=e.definition.headerFilterFuncParams||{},f=e.getFieldValue(d);return p=typeof p=="function"?p(s,f,d):p,e.definition.headerFilterFunc(s,f,d,p)},l=c;break}c||(o==="partial"?(c=function(d){var p=e.getFieldValue(d);return typeof p<"u"&&p!==null?String(p).toLowerCase().indexOf(String(s).toLowerCase())>-1:!1},l="like"):(c=function(d){return e.getFieldValue(d)==s},l="=")),r.headerFilters[n]={value:s,func:c,type:l}}e.modules.filter.value=s,u=JSON.stringify(r.headerFilters),r.prevHeaderFilterChangeCheck!==u&&(r.prevHeaderFilterChangeCheck=u,r.trackChanges(),r.refreshFilter())}return!0}e.modules.filter={success:a,attrType:!1,tagType:!1,emptyFunc:!1},this.generateHeaderFilterElement(e)}generateHeaderFilterElement(e,i,r){var n=this,a=e.modules.filter.success,s=e.getField(),o,l,u,c,d,p,f,m;e.modules.filter.value=i;function h(){}function g(I){m=I}if(e.modules.filter.headerElement&&e.modules.filter.headerElement.parentNode&&e.contentElement.removeChild(e.modules.filter.headerElement.parentNode),s){switch(e.modules.filter.emptyFunc=e.definition.headerFilterEmptyCheck||function(I){return!I&&I!==0},o=document.createElement("div"),o.classList.add("tabulator-header-filter"),typeof e.definition.headerFilter){case"string":n.table.modules.edit.editors[e.definition.headerFilter]?(l=n.table.modules.edit.editors[e.definition.headerFilter],(e.definition.headerFilter==="tick"||e.definition.headerFilter==="tickCross")&&!e.definition.headerFilterEmptyCheck&&(e.modules.filter.emptyFunc=function(I){return I!==!0&&I!==!1})):console.warn("Filter Error - Cannot build header filter, No such editor found: ",e.definition.editor);break;case"function":l=e.definition.headerFilter;break;case"boolean":e.modules.edit&&e.modules.edit.editor?l=e.modules.edit.editor:e.definition.formatter&&n.table.modules.edit.editors[e.definition.formatter]?(l=n.table.modules.edit.editors[e.definition.formatter],(e.definition.formatter==="tick"||e.definition.formatter==="tickCross")&&!e.definition.headerFilterEmptyCheck&&(e.modules.filter.emptyFunc=function(I){return I!==!0&&I!==!1})):l=n.table.modules.edit.editors.input;break}if(l){if(c={getValue:function(){return typeof i<"u"?i:""},getField:function(){return e.definition.field},getElement:function(){return o},getColumn:function(){return e.getComponent()},getTable:()=>this.table,getType:()=>"header",getRow:function(){return{normalizeHeight:function(){}}}},f=e.definition.headerFilterParams||{},f=typeof f=="function"?f.call(n.table,c):f,u=l.call(this.table.modules.edit,c,g,a,h,f),!u){console.warn("Filter Error - Cannot add filter to "+s+" column, editor returned a value of false");return}if(!(u instanceof Node)){console.warn("Filter Error - Cannot add filter to "+s+" column, editor should return an instance of Node, the editor returned:",u);return}n.langBind("headerFilters|columns|"+e.definition.field,function(I){u.setAttribute("placeholder",typeof I<"u"&&I?I:e.definition.headerFilterPlaceholder||n.langText("headerFilters|default"))}),u.addEventListener("click",function(I){I.stopPropagation(),u.focus()}),u.addEventListener("focus",I=>{var v=this.table.columnManager.contentsElement.scrollLeft,w=this.table.rowManager.element.scrollLeft;v!==w&&(this.table.rowManager.scrollHorizontal(v),this.table.columnManager.scrollHorizontal(v))}),d=!1,p=function(I){d&&clearTimeout(d),d=setTimeout(function(){a(u.value)},n.table.options.headerFilterLiveFilterDelay)},e.modules.filter.headerElement=u,e.modules.filter.attrType=u.hasAttribute("type")?u.getAttribute("type").toLowerCase():"",e.modules.filter.tagType=u.tagName.toLowerCase(),e.definition.headerFilterLiveFilter!==!1&&(e.definition.headerFilter==="autocomplete"||e.definition.headerFilter==="tickCross"||(e.definition.editor==="autocomplete"||e.definition.editor==="tickCross")&&e.definition.headerFilter===!0||(u.addEventListener("keyup",p),u.addEventListener("search",p),e.modules.filter.attrType=="number"&&u.addEventListener("change",function(I){a(u.value)}),e.modules.filter.attrType=="text"&&this.table.browser!=="ie"&&u.setAttribute("type","search")),(e.modules.filter.tagType=="input"||e.modules.filter.tagType=="select"||e.modules.filter.tagType=="textarea")&&u.addEventListener("mousedown",function(I){I.stopPropagation()})),o.appendChild(u),e.contentElement.appendChild(o),r||n.headerFilterColumns.push(e),m&&m()}}else console.warn("Filter Error - Cannot add header filter, column has no field set:",e.definition.title)}hideHeaderFilterElements(){this.headerFilterColumns.forEach(function(e){e.modules.filter&&e.modules.filter.headerElement&&(e.modules.filter.headerElement.style.display="none")})}showHeaderFilterElements(){this.headerFilterColumns.forEach(function(e){e.modules.filter&&e.modules.filter.headerElement&&(e.modules.filter.headerElement.style.display="")})}setHeaderFilterFocus(e){e.modules.filter&&e.modules.filter.headerElement?e.modules.filter.headerElement.focus():console.warn("Column Filter Focus Error - No header filter set on column:",e.getField())}getHeaderFilterValue(e){if(e.modules.filter&&e.modules.filter.headerElement)return e.modules.filter.value;console.warn("Column Filter Error - No header filter set on column:",e.getField())}setHeaderFilterValue(e,i){e&&(e.modules.filter&&e.modules.filter.headerElement?(this.generateHeaderFilterElement(e,i,!0),e.modules.filter.success(i)):console.warn("Column Filter Error - No header filter set on column:",e.getField()))}reloadHeaderFilter(e){e&&(e.modules.filter&&e.modules.filter.headerElement?this.generateHeaderFilterElement(e,e.modules.filter.value,!0):console.warn("Column Filter Error - No header filter set on column:",e.getField()))}refreshFilter(){this.tableInitialized&&(this.table.options.filterMode==="remote"?this.reloadData(null,!1,!1):this.refreshData(!0))}trackChanges(){this.changed=!0,this.dispatch("filter-changed")}hasChanged(){var e=this.changed;return this.changed=!1,e}setFilter(e,i,r,n){this.filterList=[],Array.isArray(e)||(e=[{field:e,type:i,value:r,params:n}]),this.addFilter(e)}addFilter(e,i,r,n){var a=!1;Array.isArray(e)||(e=[{field:e,type:i,value:r,params:n}]),e.forEach(s=>{s=this.findFilter(s),s&&(this.filterList.push(s),a=!0)}),a&&this.trackChanges()}findFilter(e){var i;if(Array.isArray(e))return this.findSubFilters(e);var r=!1;return typeof e.field=="function"?r=function(n){return e.field(n,e.type||{})}:Gf.filters[e.type]?(i=this.table.columnManager.getColumnByField(e.field),i?r=function(n){return Gf.filters[e.type](e.value,i.getFieldValue(n),n,e.params||{})}:r=function(n){return Gf.filters[e.type](e.value,n[e.field],n,e.params||{})}):console.warn("Filter Error - No such filter type found, ignoring: ",e.type),e.func=r,e.func?e:!1}findSubFilters(e){var i=[];return e.forEach(r=>{r=this.findFilter(r),r&&i.push(r)}),i.length?i:!1}getFilters(e,i){var r=[];return e&&(r=this.getHeaderFilters()),i&&r.forEach(function(n){typeof n.type=="function"&&(n.type="function")}),r=r.concat(this.filtersToArray(this.filterList,i)),r}filtersToArray(e,i){var r=[];return e.forEach(n=>{var a;Array.isArray(n)?r.push(this.filtersToArray(n,i)):(a={field:n.field,type:n.type,value:n.value},i&&typeof a.type=="function"&&(a.type="function"),r.push(a))}),r}getHeaderFilters(){var e=[];for(var i in this.headerFilters)e.push({field:i,type:this.headerFilters[i].type,value:this.headerFilters[i].value});return e}removeFilter(e,i,r){Array.isArray(e)||(e=[{field:e,type:i,value:r}]),e.forEach(n=>{var a=-1;typeof n.field=="object"?a=this.filterList.findIndex(s=>n===s):a=this.filterList.findIndex(s=>n.field===s.field&&n.type===s.type&&n.value===s.value),a>-1?this.filterList.splice(a,1):console.warn("Filter Error - No matching filter type found, ignoring: ",n.type)}),this.trackChanges()}clearFilter(e){this.filterList=[],e&&this.clearHeaderFilter(),this.trackChanges()}clearHeaderFilter(){this.headerFilters={},this.prevHeaderFilterChangeCheck="{}",this.headerFilterColumns.forEach(e=>{typeof e.modules.filter.value<"u"&&delete e.modules.filter.value,e.modules.filter.prevSuccess=void 0,this.reloadHeaderFilter(e)}),this.trackChanges()}search(e,i,r,n){var a=[],s=[];return Array.isArray(i)||(i=[{field:i,type:r,value:n}]),i.forEach(o=>{o=this.findFilter(o),o&&s.push(o)}),this.table.rowManager.rows.forEach(o=>{var l=!0;s.forEach(u=>{this.filterRecurse(u,o.getData())||(l=!1)}),l&&a.push(e==="data"?o.getData("data"):o.getComponent())}),a}filter(e,i){var r=[],n=[];return this.subscribedExternal("dataFiltering")&&this.dispatchExternal("dataFiltering",this.getFilters(!0)),this.table.options.filterMode!=="remote"&&(this.filterList.length||Object.keys(this.headerFilters).length)?e.forEach(a=>{this.filterRow(a)&&r.push(a)}):r=e.slice(0),this.subscribedExternal("dataFiltered")&&(r.forEach(a=>{n.push(a.getComponent())}),this.dispatchExternal("dataFiltered",this.getFilters(!0),n)),r}filterRow(e,i){var r=!0,n=e.getData();this.filterList.forEach(s=>{this.filterRecurse(s,n)||(r=!1)});for(var a in this.headerFilters)this.headerFilters[a].func(n)||(r=!1);return r}filterRecurse(e,i){var r=!1;return Array.isArray(e)?e.forEach(n=>{this.filterRecurse(n,i)&&(r=!0)}):r=e.func(i),r}}function ehe(t,e,i){return this.emptyToSpace(this.sanitizeHTML(t.getValue()))}function the(t,e,i){return t.getValue()}function ihe(t,e,i){return t.getElement().style.whiteSpace="pre-wrap",this.emptyToSpace(this.sanitizeHTML(t.getValue()))}function rhe(t,e,i){var r=parseFloat(t.getValue()),n="",a,s,o,l,u,c=e.decimal||".",d=e.thousand||",",p=e.negativeSign||"-",f=e.symbol||"",m=!!e.symbolAfter,h=typeof e.precision<"u"?e.precision:2;if(isNaN(r))return this.emptyToSpace(this.sanitizeHTML(t.getValue()));if(r<0&&(r=Math.abs(r),n=p),a=h!==!1?r.toFixed(h):r,a=String(a).split("."),s=a[0],o=a.length>1?c+a[1]:"",e.thousand!==!1)for(l=/(\d+)(\d{3})/;l.test(s);)s=s.replace(l,"$1"+d+"$2");return u=s+o,n===!0?(u="("+u+")",m?u+f:f+u):m?n+u+f:n+f+u}function nhe(t,e,i){var r=t.getValue(),n=e.urlPrefix||"",a=e.download,s=r,o=document.createElement("a"),l;function u(c,d){var p=c.shift(),f=d[p];return c.length&&typeof f=="object"?u(c,f):f}if(e.labelField&&(l=t.getData(),s=u(e.labelField.split(this.table.options.nestedFieldSeparator),l)),e.label)switch(typeof e.label){case"string":s=e.label;break;case"function":s=e.label(t);break}if(s){if(e.urlField&&(l=t.getData(),r=gr.retrieveNestedData(this.table.options.nestedFieldSeparator,e.urlField,l)),e.url)switch(typeof e.url){case"string":r=e.url;break;case"function":r=e.url(t);break}return o.setAttribute("href",n+r),e.target&&o.setAttribute("target",e.target),e.download&&(typeof a=="function"?a=a(t):a=a===!0?"":a,o.setAttribute("download",a)),o.innerHTML=this.emptyToSpace(this.sanitizeHTML(s)),o}else return"&nbsp;"}function ahe(t,e,i){var r=document.createElement("img"),n=t.getValue();switch(e.urlPrefix&&(n=e.urlPrefix+t.getValue()),e.urlSuffix&&(n=n+e.urlSuffix),r.setAttribute("src",n),typeof e.height){case"number":r.style.height=e.height+"px";break;case"string":r.style.height=e.height;break}switch(typeof e.width){case"number":r.style.width=e.width+"px";break;case"string":r.style.width=e.width;break}return r.addEventListener("load",function(){t.getRow().normalizeHeight()}),r}function she(t,e,i){var r=t.getValue(),n=t.getElement(),a=e.allowEmpty,s=e.allowTruthy,o=Object.keys(e).includes("trueValue"),l=typeof e.tickElement<"u"?e.tickElement:'<svg enable-background="new 0 0 24 24" height="14" width="14" viewBox="0 0 24 24" xml:space="preserve" ><path fill="#2DC214" clip-rule="evenodd" d="M21.652,3.211c-0.293-0.295-0.77-0.295-1.061,0L9.41,14.34  c-0.293,0.297-0.771,0.297-1.062,0L3.449,9.351C3.304,9.203,3.114,9.13,2.923,9.129C2.73,9.128,2.534,9.201,2.387,9.351  l-2.165,1.946C0.078,11.445,0,11.63,0,11.823c0,0.194,0.078,0.397,0.223,0.544l4.94,5.184c0.292,0.296,0.771,0.776,1.062,1.07  l2.124,2.141c0.292,0.293,0.769,0.293,1.062,0l14.366-14.34c0.293-0.294,0.293-0.777,0-1.071L21.652,3.211z" fill-rule="evenodd"/></svg>',u=typeof e.crossElement<"u"?e.crossElement:'<svg enable-background="new 0 0 24 24" height="14" width="14"  viewBox="0 0 24 24" xml:space="preserve" ><path fill="#CE1515" d="M22.245,4.015c0.313,0.313,0.313,0.826,0,1.139l-6.276,6.27c-0.313,0.312-0.313,0.826,0,1.14l6.273,6.272  c0.313,0.313,0.313,0.826,0,1.14l-2.285,2.277c-0.314,0.312-0.828,0.312-1.142,0l-6.271-6.271c-0.313-0.313-0.828-0.313-1.141,0  l-6.276,6.267c-0.313,0.313-0.828,0.313-1.141,0l-2.282-2.28c-0.313-0.313-0.313-0.826,0-1.14l6.278-6.269  c0.313-0.312,0.313-0.826,0-1.14L1.709,5.147c-0.314-0.313-0.314-0.827,0-1.14l2.284-2.278C4.308,1.417,4.821,1.417,5.135,1.73  L11.405,8c0.314,0.314,0.828,0.314,1.141,0.001l6.276-6.267c0.312-0.312,0.826-0.312,1.141,0L22.245,4.015z"/></svg>';return o&&r===e.trueValue||!o&&(s&&r||r===!0||r==="true"||r==="True"||r===1||r==="1")?(n.setAttribute("aria-checked",!0),l||""):a&&(r==="null"||r===""||r===null||typeof r>"u")?(n.setAttribute("aria-checked","mixed"),""):(n.setAttribute("aria-checked",!1),u||"")}function ohe(t,e,i){var r=this.table.dependencyRegistry.lookup(["luxon","DateTime"],"DateTime"),n=e.inputFormat||"yyyy-MM-dd HH:mm:ss",a=e.outputFormat||"dd/MM/yyyy HH:mm:ss",s=typeof e.invalidPlaceholder<"u"?e.invalidPlaceholder:"",o=t.getValue();if(typeof r<"u"){var l;return r.isDateTime(o)?l=o:n==="iso"?l=r.fromISO(String(o)):l=r.fromFormat(String(o),n),l.isValid?(e.timezone&&(l=l.setZone(e.timezone)),l.toFormat(a)):s===!0||!o?o:typeof s=="function"?s(o):s}else console.error("Format Error - 'datetime' formatter is dependant on luxon.js")}function lhe(t,e,i){var r=this.table.dependencyRegistry.lookup(["luxon","DateTime"],"DateTime"),n=e.inputFormat||"yyyy-MM-dd HH:mm:ss",a=typeof e.invalidPlaceholder<"u"?e.invalidPlaceholder:"",s=typeof e.suffix<"u"?e.suffix:!1,o=typeof e.unit<"u"?e.unit:"days",l=typeof e.humanize<"u"?e.humanize:!1,u=typeof e.date<"u"?e.date:r.now(),c=t.getValue();if(typeof r<"u"){var d;return r.isDateTime(c)?d=c:n==="iso"?d=r.fromISO(String(c)):d=r.fromFormat(String(c),n),d.isValid?l?d.diff(u,o).toHuman()+(s?" "+s:""):parseInt(d.diff(u,o)[o])+(s?" "+s:""):a===!0?c:typeof a=="function"?a(c):a}else console.error("Format Error - 'datetimediff' formatter is dependant on luxon.js")}function uhe(t,e,i){var r=t.getValue();return typeof e[r]>"u"?(console.warn("Missing display value for "+r),r):e[r]}function che(t,e,i){var r=t.getValue(),n=t.getElement(),a=e&&e.stars?e.stars:5,s=document.createElement("span"),o=document.createElementNS("http://www.w3.org/2000/svg","svg"),l='<polygon fill="#FFEA00" stroke="#C1AB60" stroke-width="37.6152" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" points="259.216,29.942 330.27,173.919 489.16,197.007 374.185,309.08 401.33,467.31 259.216,392.612 117.104,467.31 144.25,309.08 29.274,197.007 188.165,173.919 "/>',u='<polygon fill="#D2D2D2" stroke="#686868" stroke-width="37.6152" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" points="259.216,29.942 330.27,173.919 489.16,197.007 374.185,309.08 401.33,467.31 259.216,392.612 117.104,467.31 144.25,309.08 29.274,197.007 188.165,173.919 "/>';s.style.verticalAlign="middle",o.setAttribute("width","14"),o.setAttribute("height","14"),o.setAttribute("viewBox","0 0 512 512"),o.setAttribute("xml:space","preserve"),o.style.padding="0 1px",r=r&&!isNaN(r)?parseInt(r):0,r=Math.max(0,Math.min(r,a));for(var c=1;c<=a;c++){var d=o.cloneNode(!0);d.innerHTML=c<=r?l:u,s.appendChild(d)}return n.style.whiteSpace="nowrap",n.style.overflow="hidden",n.style.textOverflow="ellipsis",n.setAttribute("aria-label",r),s}function dhe(t,e,i){var r=this.sanitizeHTML(t.getValue())||0,n=document.createElement("span"),a=e&&e.max?e.max:100,s=e&&e.min?e.min:0,o=e&&typeof e.color<"u"?e.color:["red","orange","green"],l="#666666",u,c;if(!(isNaN(r)||typeof t.getValue()>"u")){switch(n.classList.add("tabulator-traffic-light"),c=parseFloat(r)<=a?parseFloat(r):a,c=parseFloat(c)>=s?parseFloat(c):s,u=(a-s)/100,c=Math.round((c-s)/u),typeof o){case"string":l=o;break;case"function":l=o(r);break;case"object":if(Array.isArray(o)){var d=100/o.length,p=Math.floor(c/d);p=Math.min(p,o.length-1),p=Math.max(p,0),l=o[p];break}}return n.style.backgroundColor=l,n}}function phe(t,e={},i){var r=this.sanitizeHTML(t.getValue())||0,n=t.getElement(),a=e.max?e.max:100,s=e.min?e.min:0,o=e.legendAlign?e.legendAlign:"center",l,u,c,d,p;switch(u=parseFloat(r)<=a?parseFloat(r):a,u=parseFloat(u)>=s?parseFloat(u):s,l=(a-s)/100,u=Math.round((u-s)/l),typeof e.color){case"string":c=e.color;break;case"function":c=e.color(r);break;case"object":if(Array.isArray(e.color)){let g=100/e.color.length,I=Math.floor(u/g);I=Math.min(I,e.color.length-1),I=Math.max(I,0),c=e.color[I];break}default:c="#2DC214"}switch(typeof e.legend){case"string":d=e.legend;break;case"function":d=e.legend(r);break;case"boolean":d=r;break;default:d=!1}switch(typeof e.legendColor){case"string":p=e.legendColor;break;case"function":p=e.legendColor(r);break;case"object":if(Array.isArray(e.legendColor)){let g=100/e.legendColor.length,I=Math.floor(u/g);I=Math.min(I,e.legendColor.length-1),I=Math.max(I,0),p=e.legendColor[I]}break;default:p="#000"}n.style.minWidth="30px",n.style.position="relative",n.setAttribute("aria-label",u);var f=document.createElement("div");f.style.display="inline-block",f.style.width=u+"%",f.style.backgroundColor=c,f.style.height="100%",f.setAttribute("data-max",a),f.setAttribute("data-min",s);var m=document.createElement("div");if(m.style.position="relative",m.style.width="100%",m.style.height="100%",d){var h=document.createElement("div");h.style.position="absolute",h.style.top=0,h.style.left=0,h.style.textAlign=o,h.style.width="100%",h.style.color=p,h.innerHTML=d}return i(function(){if(!(t instanceof zY)){var g=document.createElement("div");g.style.position="absolute",g.style.top="4px",g.style.bottom="4px",g.style.left="4px",g.style.right="4px",n.appendChild(g),n=g}n.appendChild(m),m.appendChild(f),d&&m.appendChild(h)}),""}function fhe(t,e,i){return t.getElement().style.backgroundColor=this.sanitizeHTML(t.getValue()),""}function mhe(t,e,i){return'<svg enable-background="new 0 0 24 24" height="14" width="14" viewBox="0 0 24 24" xml:space="preserve" ><path fill="#2DC214" clip-rule="evenodd" d="M21.652,3.211c-0.293-0.295-0.77-0.295-1.061,0L9.41,14.34  c-0.293,0.297-0.771,0.297-1.062,0L3.449,9.351C3.304,9.203,3.114,9.13,2.923,9.129C2.73,9.128,2.534,9.201,2.387,9.351  l-2.165,1.946C0.078,11.445,0,11.63,0,11.823c0,0.194,0.078,0.397,0.223,0.544l4.94,5.184c0.292,0.296,0.771,0.776,1.062,1.07  l2.124,2.141c0.292,0.293,0.769,0.293,1.062,0l14.366-14.34c0.293-0.294,0.293-0.777,0-1.071L21.652,3.211z" fill-rule="evenodd"/></svg>'}function hhe(t,e,i){return'<svg enable-background="new 0 0 24 24" height="14" width="14" viewBox="0 0 24 24" xml:space="preserve" ><path fill="#CE1515" d="M22.245,4.015c0.313,0.313,0.313,0.826,0,1.139l-6.276,6.27c-0.313,0.312-0.313,0.826,0,1.14l6.273,6.272  c0.313,0.313,0.313,0.826,0,1.14l-2.285,2.277c-0.314,0.312-0.828,0.312-1.142,0l-6.271-6.271c-0.313-0.313-0.828-0.313-1.141,0  l-6.276,6.267c-0.313,0.313-0.828,0.313-1.141,0l-2.282-2.28c-0.313-0.313-0.313-0.826,0-1.14l6.278-6.269  c0.313-0.312,0.313-0.826,0-1.14L1.709,5.147c-0.314-0.313-0.314-0.827,0-1.14l2.284-2.278C4.308,1.417,4.821,1.417,5.135,1.73  L11.405,8c0.314,0.314,0.828,0.314,1.141,0.001l6.276-6.267c0.312-0.312,0.826-0.312,1.141,0L22.245,4.015z"/></svg>'}function ghe(t,e,i){var r=t.getValue(),n=e.size||15,a=n+"px",s,o,l=e.hasOwnProperty("onValue")?e.onValue:!0,u=e.hasOwnProperty("offValue")?e.offValue:!1,c=e.onTruthy?r:r===l;return s=document.createElement("div"),s.classList.add("tabulator-toggle"),c?(s.classList.add("tabulator-toggle-on"),s.style.flexDirection="row-reverse",e.onColor&&(s.style.background=e.onColor)):e.offColor&&(s.style.background=e.offColor),s.style.width=2.5*n+"px",s.style.borderRadius=a,e.clickable&&s.addEventListener("click",d=>{t.setValue(c?u:l)}),o=document.createElement("div"),o.classList.add("tabulator-toggle-switch"),o.style.height=a,o.style.width=a,o.style.borderRadius=a,s.appendChild(o),s}function Ihe(t,e,i){var r=document.createElement("span"),n=t.getRow(),a=t.getTable();return n.watchPosition(s=>{e.relativeToPage&&(s+=a.modules.page.getPageSize()*(a.modules.page.getPage()-1)),r.innerText=s}),r}function vhe(t,e,i){return t.getElement().classList.add("tabulator-row-handle"),"<div class='tabulator-row-handle-box'><div class='tabulator-row-handle-bar'></div><div class='tabulator-row-handle-bar'></div><div class='tabulator-row-handle-bar'></div></div>"}function yhe(t,e,i){var r,n,a;function s(o){var l=o.getValue(),u="plaintext";switch(typeof l){case"boolean":u="tickCross";break;case"string":l.includes(`
`)&&(u="textarea");break}return u}return r=e.formatterLookup?e.formatterLookup(t):s(t),e.paramsLookup&&(a=typeof e.paramsLookup=="function"?e.paramsLookup(r,t):e.paramsLookup[r]),n=this.table.modules.format.lookupFormatter(r),n.call(this,t,a||{},i)}function bhe(t,e,i){var r=e.delimiter||",",n=t.getValue(),a=this.table,s;return e.valueMap&&(typeof e.valueMap=="string"?s=function(o){return o.map(l=>gr.retrieveNestedData(a.options.nestedFieldSeparator,e.valueMap,l))}:s=e.valueMap),Array.isArray(n)?(s&&(n=s(n)),n.join(r)):n}function whe(t,e,i){var r=e.indent||"	",n=typeof e.multiline>"u"?!0:e.multiline,a=e.replacer||null,s=t.getValue();return n&&(t.getElement().style.whiteSpace="pre-wrap"),JSON.stringify(s,a,r)}var She={plaintext:ehe,html:the,textarea:ihe,money:rhe,link:nhe,image:ahe,tickCross:she,datetime:ohe,datetimediff:lhe,lookup:uhe,star:che,traffic:dhe,progress:phe,color:fhe,buttonTick:mhe,buttonCross:hhe,toggle:ghe,rownum:Ihe,handle:vhe,adaptable:yhe,array:bhe,json:whe};class Pg extends si{static moduleName="format";static formatters=She;constructor(e){super(e),this.registerColumnOption("formatter"),this.registerColumnOption("formatterParams"),this.registerColumnOption("formatterPrint"),this.registerColumnOption("formatterPrintParams"),this.registerColumnOption("formatterClipboard"),this.registerColumnOption("formatterClipboardParams"),this.registerColumnOption("formatterHtmlOutput"),this.registerColumnOption("formatterHtmlOutputParams"),this.registerColumnOption("titleFormatter"),this.registerColumnOption("titleFormatterParams")}initialize(){this.subscribe("cell-format",this.formatValue.bind(this)),this.subscribe("cell-rendered",this.cellRendered.bind(this)),this.subscribe("column-layout",this.initializeColumn.bind(this)),this.subscribe("column-format",this.formatHeader.bind(this))}initializeColumn(e){e.modules.format=this.lookupTypeFormatter(e,""),typeof e.definition.formatterPrint<"u"&&(e.modules.format.print=this.lookupTypeFormatter(e,"Print")),typeof e.definition.formatterClipboard<"u"&&(e.modules.format.clipboard=this.lookupTypeFormatter(e,"Clipboard")),typeof e.definition.formatterHtmlOutput<"u"&&(e.modules.format.htmlOutput=this.lookupTypeFormatter(e,"HtmlOutput"))}lookupTypeFormatter(e,i){var r={params:e.definition["formatter"+i+"Params"]||{}},n=e.definition["formatter"+i];return r.formatter=this.lookupFormatter(n),r}lookupFormatter(e){var i;switch(typeof e){case"string":Pg.formatters[e]?i=Pg.formatters[e]:(console.warn("Formatter Error - No such formatter found: ",e),i=Pg.formatters.plaintext);break;case"function":i=e;break;default:i=Pg.formatters.plaintext;break}return i}cellRendered(e){e.modules.format&&e.modules.format.renderedCallback&&!e.modules.format.rendered&&(e.modules.format.renderedCallback(),e.modules.format.rendered=!0)}formatHeader(e,i,r){var n,a,s,o;return e.definition.titleFormatter?(n=this.lookupFormatter(e.definition.titleFormatter),s=l=>{e.titleFormatterRendered=l},o={getValue:function(){return i},getElement:function(){return r},getType:function(){return"header"},getColumn:function(){return e.getComponent()},getTable:()=>this.table},a=e.definition.titleFormatterParams||{},a=typeof a=="function"?a():a,n.call(this,o,a,s)):i}formatValue(e){var i=e.getComponent(),r=typeof e.column.modules.format.params=="function"?e.column.modules.format.params(i):e.column.modules.format.params;function n(a){e.modules.format||(e.modules.format={}),e.modules.format.renderedCallback=a,e.modules.format.rendered=!1}return e.column.modules.format.formatter.call(this,i,r,n)}formatExportValue(e,i){var r=e.column.modules.format[i],n;if(r){let s=function(o){e.modules.format||(e.modules.format={}),e.modules.format.renderedCallback=o,e.modules.format.rendered=!1};var a=s;return n=typeof r.params=="function"?r.params(e.getComponent()):r.params,r.formatter.call(this,e.getComponent(),n,s)}else return this.formatValue(e)}sanitizeHTML(e){if(e){var i={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};return String(e).replace(/[&<>"'`=/]/g,function(r){return i[r]})}else return e}emptyToSpace(e){return e===null||typeof e>"u"||e===""?"&nbsp;":e}}class Uhe extends si{static moduleName="frozenColumns";constructor(e){super(e),this.leftColumns=[],this.rightColumns=[],this.initializationMode="left",this.active=!1,this.blocked=!0,this.registerColumnOption("frozen")}reset(){this.initializationMode="left",this.leftColumns=[],this.rightColumns=[],this.active=!1}initialize(){this.subscribe("cell-layout",this.layoutCell.bind(this)),this.subscribe("column-init",this.initializeColumn.bind(this)),this.subscribe("column-width",this.layout.bind(this)),this.subscribe("row-layout-after",this.layoutRow.bind(this)),this.subscribe("table-layout",this.layout.bind(this)),this.subscribe("columns-loading",this.reset.bind(this)),this.subscribe("column-add",this.reinitializeColumns.bind(this)),this.subscribe("column-deleted",this.reinitializeColumns.bind(this)),this.subscribe("column-hide",this.reinitializeColumns.bind(this)),this.subscribe("column-show",this.reinitializeColumns.bind(this)),this.subscribe("columns-loaded",this.reinitializeColumns.bind(this)),this.subscribe("table-redraw",this.layout.bind(this)),this.subscribe("layout-refreshing",this.blockLayout.bind(this)),this.subscribe("layout-refreshed",this.unblockLayout.bind(this)),this.subscribe("scrollbar-vertical",this.adjustForScrollbar.bind(this))}blockLayout(){this.blocked=!0}unblockLayout(){this.blocked=!1}layoutCell(e){this.layoutElement(e.element,e.column)}reinitializeColumns(){this.reset(),this.table.columnManager.columnsByIndex.forEach(e=>{this.initializeColumn(e)}),this.layout()}initializeColumn(e){var i={margin:0,edge:!1};e.isGroup||(this.frozenCheck(e)?(i.position=this.initializationMode,this.initializationMode=="left"?this.leftColumns.push(e):this.rightColumns.unshift(e),this.active=!0,e.modules.frozen=i):this.initializationMode="right")}frozenCheck(e){return e.parent.isGroup&&e.definition.frozen&&console.warn("Frozen Column Error - Parent column group must be frozen, not individual columns or sub column groups"),e.parent.isGroup?this.frozenCheck(e.parent):e.definition.frozen}layoutCalcRows(){this.table.modExists("columnCalcs")&&(this.table.modules.columnCalcs.topInitialized&&this.table.modules.columnCalcs.topRow&&this.layoutRow(this.table.modules.columnCalcs.topRow),this.table.modules.columnCalcs.botInitialized&&this.table.modules.columnCalcs.botRow&&this.layoutRow(this.table.modules.columnCalcs.botRow),this.table.modExists("groupRows")&&this.layoutGroupCalcs(this.table.modules.groupRows.getGroups()))}layoutGroupCalcs(e){e.forEach(i=>{i.calcs.top&&this.layoutRow(i.calcs.top),i.calcs.bottom&&this.layoutRow(i.calcs.bottom),i.groupList&&i.groupList.length&&this.layoutGroupCalcs(i.groupList)})}layoutColumnPosition(e){var i=[],r=0,n=0;this.leftColumns.forEach((a,s)=>{if(a.modules.frozen.marginValue=r,a.modules.frozen.margin=a.modules.frozen.marginValue+"px",a.visible&&(r+=a.getWidth()),s==this.leftColumns.length-1?a.modules.frozen.edge=!0:a.modules.frozen.edge=!1,a.parent.isGroup){var o=this.getColGroupParentElement(a);i.includes(o)||(this.layoutElement(o,a),i.push(o)),o.classList.toggle("tabulator-frozen-left",a.modules.frozen.edge&&a.modules.frozen.position==="left"),o.classList.toggle("tabulator-frozen-right",a.modules.frozen.edge&&a.modules.frozen.position==="right")}else this.layoutElement(a.getElement(),a);e&&a.cells.forEach(l=>{this.layoutElement(l.getElement(!0),a)})}),this.rightColumns.forEach((a,s)=>{a.modules.frozen.marginValue=n,a.modules.frozen.margin=a.modules.frozen.marginValue+"px",a.visible&&(n+=a.getWidth()),s==this.rightColumns.length-1?a.modules.frozen.edge=!0:a.modules.frozen.edge=!1,a.parent.isGroup?this.layoutElement(this.getColGroupParentElement(a),a):this.layoutElement(a.getElement(),a),e&&a.cells.forEach(o=>{this.layoutElement(o.getElement(!0),a)})})}getColGroupParentElement(e){return e.parent.isGroup?this.getColGroupParentElement(e.parent):e.getElement()}layout(){this.active&&!this.blocked&&(this.layoutColumnPosition(),this.reinitializeRows(),this.layoutCalcRows())}reinitializeRows(){var e=this.table.rowManager.getVisibleRows(!0),i=this.table.rowManager.getRows().filter(r=>!e.includes(r));i.forEach(r=>{r.deinitialize()}),e.forEach(r=>{r.type==="row"&&this.layoutRow(r)})}layoutRow(e){this.table.options.layout==="fitDataFill"&&this.rightColumns.length&&(this.table.rowManager.getTableElement().style.minWidth="calc(100% - "+this.rightMargin+")"),this.leftColumns.forEach(i=>{var r=e.getCell(i);r&&this.layoutElement(r.getElement(!0),i)}),this.rightColumns.forEach(i=>{var r=e.getCell(i);r&&this.layoutElement(r.getElement(!0),i)})}layoutElement(e,i){var r;i.modules.frozen&&e&&(e.style.position="sticky",this.table.rtl?r=i.modules.frozen.position==="left"?"right":"left":r=i.modules.frozen.position,e.style[r]=i.modules.frozen.margin,e.classList.add("tabulator-frozen"),e.classList.toggle("tabulator-frozen-left",i.modules.frozen.edge&&i.modules.frozen.position==="left"),e.classList.toggle("tabulator-frozen-right",i.modules.frozen.edge&&i.modules.frozen.position==="right"))}adjustForScrollbar(e){this.rightColumns.length&&(this.table.columnManager.getContentsElement().style.width="calc(100% - "+e+"px)")}getFrozenColumns(){return this.leftColumns.concat(this.rightColumns)}_calcSpace(e,i){var r=0;for(let n=0;n<i;n++)e[n].visible&&(r+=e[n].getWidth());return r}}class The extends si{static moduleName="frozenRows";constructor(e){super(e),this.topElement=document.createElement("div"),this.rows=[],this.registerComponentFunction("row","freeze",this.freezeRow.bind(this)),this.registerComponentFunction("row","unfreeze",this.unfreezeRow.bind(this)),this.registerComponentFunction("row","isFrozen",this.isRowFrozen.bind(this)),this.registerTableOption("frozenRowsField","id"),this.registerTableOption("frozenRows",!1)}initialize(){var e=document.createDocumentFragment();this.rows=[],this.topElement.classList.add("tabulator-frozen-rows-holder"),e.appendChild(document.createElement("br")),e.appendChild(this.topElement),this.table.columnManager.getContentsElement().insertBefore(e,this.table.columnManager.headersElement.nextSibling),this.subscribe("row-deleting",this.detachRow.bind(this)),this.subscribe("rows-visible",this.visibleRows.bind(this)),this.registerDisplayHandler(this.getRows.bind(this),10),this.table.options.frozenRows&&(this.subscribe("data-processed",this.initializeRows.bind(this)),this.subscribe("row-added",this.initializeRow.bind(this)),this.subscribe("table-redrawing",this.resizeHolderWidth.bind(this)),this.subscribe("column-resized",this.resizeHolderWidth.bind(this)),this.subscribe("column-show",this.resizeHolderWidth.bind(this)),this.subscribe("column-hide",this.resizeHolderWidth.bind(this))),this.resizeHolderWidth()}resizeHolderWidth(){this.topElement.style.minWidth=this.table.columnManager.headersElement.offsetWidth+"px"}initializeRows(){this.table.rowManager.getRows().forEach(e=>{this.initializeRow(e)})}initializeRow(e){var i=this.table.options.frozenRows,r=typeof i;r==="number"?e.getPosition()&&e.getPosition()+this.rows.length<=i&&this.freezeRow(e):r==="function"?i.call(this.table,e.getComponent())&&this.freezeRow(e):Array.isArray(i)&&i.includes(e.data[this.options("frozenRowsField")])&&this.freezeRow(e)}isRowFrozen(e){var i=this.rows.indexOf(e);return i>-1}isFrozen(){return!!this.rows.length}visibleRows(e,i){return this.rows.forEach(r=>{i.push(r)}),i}getRows(e){var i=e.slice(0);return this.rows.forEach(function(r){var n=i.indexOf(r);n>-1&&i.splice(n,1)}),i}freezeRow(e){e.modules.frozen?console.warn("Freeze Error - Row is already frozen"):(e.modules.frozen=!0,this.topElement.appendChild(e.getElement()),e.initialize(),e.normalizeHeight(),this.rows.push(e),this.refreshData(!1,"display"),this.table.rowManager.adjustTableSize(),this.styleRows())}unfreezeRow(e){e.modules.frozen?(e.modules.frozen=!1,this.detachRow(e),this.table.rowManager.adjustTableSize(),this.refreshData(!1,"display"),this.rows.length&&this.styleRows()):console.warn("Freeze Error - Row is already unfrozen")}detachRow(e){var i=this.rows.indexOf(e);if(i>-1){var r=e.getElement();r.parentNode&&r.parentNode.removeChild(r),this.rows.splice(i,1)}}styleRows(e){this.rows.forEach((i,r)=>{this.table.rowManager.styleRow(i,r)})}}class Dhe{constructor(e){return this._group=e,this.type="GroupComponent",new Proxy(this,{get:function(i,r,n){return typeof i[r]<"u"?i[r]:i._group.groupManager.table.componentFunctionBinder.handle("group",i._group,r)}})}getKey(){return this._group.key}getField(){return this._group.field}getElement(){return this._group.element}getRows(){return this._group.getRows(!0)}getSubGroups(){return this._group.getSubGroups(!0)}getParentGroup(){return this._group.parent?this._group.parent.getComponent():!1}isVisible(){return this._group.visible}show(){this._group.show()}hide(){this._group.hide()}toggle(){this._group.toggleVisibility()}scrollTo(e,i){return this._group.groupManager.table.rowManager.scrollToRow(this._group,e,i)}_getSelf(){return this._group}getTable(){return this._group.groupManager.table}}class Eg{constructor(e,i,r,n,a,s,o){this.groupManager=e,this.parent=i,this.key=n,this.level=r,this.field=a,this.hasSubGroups=r<e.groupIDLookups.length-1,this.addRow=this.hasSubGroups?this._addRowToGroup:this._addRow,this.type="group",this.old=o,this.rows=[],this.groups=[],this.groupList=[],this.generator=s,this.element=!1,this.elementContents=!1,this.height=0,this.outerHeight=0,this.initialized=!1,this.calcs={},this.initialized=!1,this.modules={},this.arrowElement=!1,this.visible=o?o.visible:typeof e.startOpen[r]<"u"?e.startOpen[r]:e.startOpen[0],this.component=null,this.createElements(),this.addBindings(),this.createValueGroups()}wipe(e){e||(this.groupList.length?this.groupList.forEach(function(i){i.wipe()}):this.rows.forEach(i=>{i.modules&&delete i.modules.group})),this.element=!1,this.arrowElement=!1,this.elementContents=!1}createElements(){var e=document.createElement("div");e.classList.add("tabulator-arrow"),this.element=document.createElement("div"),this.element.classList.add("tabulator-row"),this.element.classList.add("tabulator-group"),this.element.classList.add("tabulator-group-level-"+this.level),this.element.setAttribute("role","rowgroup"),this.arrowElement=document.createElement("div"),this.arrowElement.classList.add("tabulator-group-toggle"),this.arrowElement.appendChild(e),this.groupManager.table.options.movableRows!==!1&&this.groupManager.table.modExists("moveRow")&&this.groupManager.table.modules.moveRow.initializeGroupHeader(this)}createValueGroups(){var e=this.level+1;this.groupManager.allowedValues&&this.groupManager.allowedValues[e]&&this.groupManager.allowedValues[e].forEach(i=>{this._createGroup(i,e)})}addBindings(){var e;this.groupManager.table.options.groupToggleElement&&(e=this.groupManager.table.options.groupToggleElement=="arrow"?this.arrowElement:this.element,e.addEventListener("click",i=>{this.groupManager.table.options.groupToggleElement==="arrow"&&(i.stopPropagation(),i.stopImmediatePropagation()),setTimeout(()=>{this.toggleVisibility()})}))}_createGroup(e,i){var r=i+"_"+e,n=new Eg(this.groupManager,this,i,e,this.groupManager.groupIDLookups[i].field,this.groupManager.headerGenerator[i]||this.groupManager.headerGenerator[0],this.old?this.old.groups[r]:!1);this.groups[r]=n,this.groupList.push(n)}_addRowToGroup(e){var i=this.level+1;if(this.hasSubGroups){var r=this.groupManager.groupIDLookups[i].func(e.getData()),n=i+"_"+r;this.groupManager.allowedValues&&this.groupManager.allowedValues[i]?this.groups[n]&&this.groups[n].addRow(e):(this.groups[n]||this._createGroup(r,i),this.groups[n].addRow(e))}}_addRow(e){this.rows.push(e),e.modules.group=this}insertRow(e,i,r){var n=this.conformRowData({});e.updateData(n);var a=this.rows.indexOf(i);a>-1?r?this.rows.splice(a+1,0,e):this.rows.splice(a,0,e):r?this.rows.push(e):this.rows.unshift(e),e.modules.group=this,this.groupManager.table.modExists("columnCalcs")&&this.groupManager.table.options.columnCalcs!="table"&&this.groupManager.table.modules.columnCalcs.recalcGroup(this),this.groupManager.updateGroupRows(!0)}scrollHeader(e){this.arrowElement&&(this.arrowElement.style.marginLeft=e,this.groupList.forEach(function(i){i.scrollHeader(e)}))}getRowIndex(e){}conformRowData(e){return this.field?e[this.field]=this.key:console.warn("Data Conforming Error - Cannot conform row data to match new group as groupBy is a function"),this.parent&&(e=this.parent.conformRowData(e)),e}removeRow(e){var i=this.rows.indexOf(e),r=e.getElement();i>-1&&this.rows.splice(i,1),!this.groupManager.table.options.groupValues&&!this.rows.length?(this.parent?this.parent.removeGroup(this):this.groupManager.removeGroup(this),this.groupManager.updateGroupRows(!0)):(r.parentNode&&r.parentNode.removeChild(r),this.groupManager.blockRedraw||(this.generateGroupHeaderContents(),this.groupManager.table.modExists("columnCalcs")&&this.groupManager.table.options.columnCalcs!="table"&&this.groupManager.table.modules.columnCalcs.recalcGroup(this)))}removeGroup(e){var i=e.level+"_"+e.key,r;this.groups[i]&&(delete this.groups[i],r=this.groupList.indexOf(e),r>-1&&this.groupList.splice(r,1),this.groupList.length||(this.parent?this.parent.removeGroup(this):this.groupManager.removeGroup(this)))}getHeadersAndRows(){var e=[];return e.push(this),this._visSet(),this.calcs.top&&(this.calcs.top.detachElement(),this.calcs.top.deleteCells()),this.calcs.bottom&&(this.calcs.bottom.detachElement(),this.calcs.bottom.deleteCells()),this.visible?this.groupList.length?this.groupList.forEach(function(i){e=e.concat(i.getHeadersAndRows())}):(this.groupManager.table.options.columnCalcs!="table"&&this.groupManager.table.modExists("columnCalcs")&&this.groupManager.table.modules.columnCalcs.hasTopCalcs()&&(this.calcs.top=this.groupManager.table.modules.columnCalcs.generateTopRow(this.rows),e.push(this.calcs.top)),e=e.concat(this.rows),this.groupManager.table.options.columnCalcs!="table"&&this.groupManager.table.modExists("columnCalcs")&&this.groupManager.table.modules.columnCalcs.hasBottomCalcs()&&(this.calcs.bottom=this.groupManager.table.modules.columnCalcs.generateBottomRow(this.rows),e.push(this.calcs.bottom))):!this.groupList.length&&this.groupManager.table.options.columnCalcs!="table"&&this.groupManager.table.modExists("columnCalcs")&&(this.groupManager.table.modules.columnCalcs.hasTopCalcs()&&this.groupManager.table.options.groupClosedShowCalcs&&(this.calcs.top=this.groupManager.table.modules.columnCalcs.generateTopRow(this.rows),e.push(this.calcs.top)),this.groupManager.table.modules.columnCalcs.hasBottomCalcs()&&this.groupManager.table.options.groupClosedShowCalcs&&(this.calcs.bottom=this.groupManager.table.modules.columnCalcs.generateBottomRow(this.rows),e.push(this.calcs.bottom))),e}getData(e,i){var r=[];return this._visSet(),(!e||e&&this.visible)&&this.rows.forEach(n=>{r.push(n.getData(i||"data"))}),r}getRowCount(){var e=0;return this.groupList.length?this.groupList.forEach(i=>{e+=i.getRowCount()}):e=this.rows.length,e}toggleVisibility(){this.visible?this.hide():this.show()}hide(){this.visible=!1,this.groupManager.table.rowManager.getRenderMode()=="basic"&&!this.groupManager.table.options.pagination?(this.element.classList.remove("tabulator-group-visible"),this.groupList.length?this.groupList.forEach(e=>{var i=e.getHeadersAndRows();i.forEach(r=>{r.detachElement()})}):this.rows.forEach(e=>{var i=e.getElement();i.parentNode.removeChild(i)}),this.groupManager.updateGroupRows(!0)):this.groupManager.updateGroupRows(!0),this.groupManager.table.externalEvents.dispatch("groupVisibilityChanged",this.getComponent(),!1)}show(){if(this.visible=!0,this.groupManager.table.rowManager.getRenderMode()=="basic"&&!this.groupManager.table.options.pagination){this.element.classList.add("tabulator-group-visible");var e=this.generateElement();this.groupList.length?this.groupList.forEach(i=>{var r=i.getHeadersAndRows();r.forEach(n=>{var a=n.getElement();e.parentNode.insertBefore(a,e.nextSibling),n.initialize(),e=a})}):this.rows.forEach(i=>{var r=i.getElement();e.parentNode.insertBefore(r,e.nextSibling),i.initialize(),e=r}),this.groupManager.updateGroupRows(!0)}else this.groupManager.updateGroupRows(!0);this.groupManager.table.externalEvents.dispatch("groupVisibilityChanged",this.getComponent(),!0)}_visSet(){var e=[];typeof this.visible=="function"&&(this.rows.forEach(function(i){e.push(i.getData())}),this.visible=this.visible(this.key,this.getRowCount(),e,this.getComponent()))}getRowGroup(e){var i=!1;return this.groupList.length?this.groupList.forEach(function(r){var n=r.getRowGroup(e);n&&(i=n)}):this.rows.find(function(r){return r===e})&&(i=this),i}getSubGroups(e){var i=[];return this.groupList.forEach(function(r){i.push(e?r.getComponent():r)}),i}getRows(e,i){var r=[];return i&&this.groupList.length?this.groupList.forEach(n=>{r=r.concat(n.getRows(e,i))}):this.rows.forEach(function(n){r.push(e?n.getComponent():n)}),r}generateGroupHeaderContents(){var e=[],i=this.getRows(!1,!0);for(i.forEach(function(r){e.push(r.getData())}),this.elementContents=this.generator(this.key,this.getRowCount(),e,this.getComponent());this.element.firstChild;)this.element.removeChild(this.element.firstChild);typeof this.elementContents=="string"?this.element.innerHTML=this.elementContents:this.element.appendChild(this.elementContents),this.element.insertBefore(this.arrowElement,this.element.firstChild)}getPath(e=[]){return e.unshift(this.key),this.parent&&this.parent.getPath(e),e}getElement(){return this.elementContents?this.element:this.generateElement()}generateElement(){this.addBindings=!1,this._visSet(),this.visible?this.element.classList.add("tabulator-group-visible"):this.element.classList.remove("tabulator-group-visible");for(var e=0;e<this.element.childNodes.length;++e)this.element.childNodes[e].parentNode.removeChild(this.element.childNodes[e]);return this.generateGroupHeaderContents(),this.element}detachElement(){this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element)}normalizeHeight(){this.setHeight(this.element.clientHeight)}initialize(e){(!this.initialized||e)&&(this.normalizeHeight(),this.initialized=!0)}reinitialize(){this.initialized=!1,this.height=0,gr.elVisible(this.element)&&this.initialize(!0)}setHeight(e){this.height!=e&&(this.height=e,this.outerHeight=this.element.offsetHeight)}getHeight(){return this.outerHeight}getGroup(){return this}reinitializeHeight(){}calcHeight(){}setCellHeight(){}clearCellHeight(){}deinitializeHeight(){}rendered(){}getComponent(){return this.component||(this.component=new Dhe(this)),this.component}}class Phe extends si{static moduleName="groupRows";constructor(e){super(e),this.groupIDLookups=!1,this.startOpen=[function(){return!1}],this.headerGenerator=[function(){return""}],this.groupList=[],this.allowedValues=!1,this.groups={},this.displayHandler=this.getRows.bind(this),this.blockRedraw=!1,this.registerTableOption("groupBy",!1),this.registerTableOption("groupStartOpen",!0),this.registerTableOption("groupValues",!1),this.registerTableOption("groupUpdateOnCellEdit",!1),this.registerTableOption("groupHeader",!1),this.registerTableOption("groupHeaderPrint",null),this.registerTableOption("groupHeaderClipboard",null),this.registerTableOption("groupHeaderHtmlOutput",null),this.registerTableOption("groupHeaderDownload",null),this.registerTableOption("groupToggleElement","arrow"),this.registerTableOption("groupClosedShowCalcs",!1),this.registerTableFunction("setGroupBy",this.setGroupBy.bind(this)),this.registerTableFunction("setGroupValues",this.setGroupValues.bind(this)),this.registerTableFunction("setGroupStartOpen",this.setGroupStartOpen.bind(this)),this.registerTableFunction("setGroupHeader",this.setGroupHeader.bind(this)),this.registerTableFunction("getGroups",this.userGetGroups.bind(this)),this.registerTableFunction("getGroupedData",this.userGetGroupedData.bind(this)),this.registerComponentFunction("row","getGroup",this.rowGetGroup.bind(this))}initialize(){this.subscribe("table-destroy",this._blockRedrawing.bind(this)),this.subscribe("rows-wipe",this._blockRedrawing.bind(this)),this.subscribe("rows-wiped",this._restore_redrawing.bind(this)),this.table.options.groupBy&&(this.table.options.groupUpdateOnCellEdit&&(this.subscribe("cell-value-updated",this.cellUpdated.bind(this)),this.subscribe("row-data-changed",this.reassignRowToGroup.bind(this),0)),this.subscribe("table-built",this.configureGroupSetup.bind(this)),this.subscribe("row-deleting",this.rowDeleting.bind(this)),this.subscribe("row-deleted",this.rowsUpdated.bind(this)),this.subscribe("scroll-horizontal",this.scrollHeaders.bind(this)),this.subscribe("rows-wipe",this.wipe.bind(this)),this.subscribe("rows-added",this.rowsUpdated.bind(this)),this.subscribe("row-moving",this.rowMoving.bind(this)),this.subscribe("row-adding-index",this.rowAddingIndex.bind(this)),this.subscribe("rows-sample",this.rowSample.bind(this)),this.subscribe("render-virtual-fill",this.virtualRenderFill.bind(this)),this.registerDisplayHandler(this.displayHandler,20),this.initialized=!0)}_blockRedrawing(){this.blockRedraw=!0}_restore_redrawing(){this.blockRedraw=!1}configureGroupSetup(){if(this.table.options.groupBy){var e=this.table.options.groupBy,i=this.table.options.groupStartOpen,r=this.table.options.groupHeader;if(this.allowedValues=this.table.options.groupValues,Array.isArray(e)&&Array.isArray(r)&&e.length>r.length&&console.warn("Error creating group headers, groupHeader array is shorter than groupBy array"),this.headerGenerator=[function(){return""}],this.startOpen=[function(){return!1}],this.langBind("groups|item",(a,s)=>{this.headerGenerator[0]=(o,l,u)=>(typeof o>"u"?"":o)+"<span>("+l+" "+(l===1?a:s.groups.items)+")</span>"}),this.groupIDLookups=[],e)this.table.modExists("columnCalcs")&&this.table.options.columnCalcs!="table"&&this.table.options.columnCalcs!="both"&&this.table.modules.columnCalcs.removeCalcs();else if(this.table.modExists("columnCalcs")&&this.table.options.columnCalcs!="group"){var n=this.table.columnManager.getRealColumns();n.forEach(a=>{a.definition.topCalc&&this.table.modules.columnCalcs.initializeTopRow(),a.definition.bottomCalc&&this.table.modules.columnCalcs.initializeBottomRow()})}Array.isArray(e)||(e=[e]),e.forEach((a,s)=>{var o,l;typeof a=="function"?o=a:(l=this.table.columnManager.getColumnByField(a),l?o=function(u){return l.getFieldValue(u)}:o=function(u){return u[a]}),this.groupIDLookups.push({field:typeof a=="function"?!1:a,func:o,values:this.allowedValues?this.allowedValues[s]:!1})}),i&&(Array.isArray(i)||(i=[i]),i.forEach(a=>{}),this.startOpen=i),r&&(this.headerGenerator=Array.isArray(r)?r:[r])}else this.groupList=[],this.groups={}}rowSample(e,i){if(this.table.options.groupBy){var r=this.getGroups(!1)[0];i.push(r.getRows(!1)[0])}return i}virtualRenderFill(){var e=this.table.rowManager.tableElement,i=this.table.rowManager.getVisibleRows();if(this.table.options.groupBy)i=i.filter(r=>r.type!=="group"),e.style.minWidth=i.length?"":this.table.columnManager.getWidth()+"px";else return i}rowAddingIndex(e,i,r){if(this.table.options.groupBy){this.assignRowToGroup(e);var n=e.modules.group.rows;return n.length>1&&(!i||i&&n.indexOf(i)==-1?r?n[0]!==e&&(i=n[0],this.table.rowManager.moveRowInArray(e.modules.group.rows,e,i,!r)):n[n.length-1]!==e&&(i=n[n.length-1],this.table.rowManager.moveRowInArray(e.modules.group.rows,e,i,!r)):this.table.rowManager.moveRowInArray(e.modules.group.rows,e,i,!r)),i}}trackChanges(){this.dispatch("group-changed")}setGroupBy(e){this.table.options.groupBy=e,this.initialized||this.initialize(),this.configureGroupSetup(),!e&&this.table.modExists("columnCalcs")&&this.table.options.columnCalcs===!0&&this.table.modules.columnCalcs.reinitializeCalcs(),this.refreshData(),this.trackChanges()}setGroupValues(e){this.table.options.groupValues=e,this.configureGroupSetup(),this.refreshData(),this.trackChanges()}setGroupStartOpen(e){this.table.options.groupStartOpen=e,this.configureGroupSetup(),this.table.options.groupBy?(this.refreshData(),this.trackChanges()):console.warn("Grouping Update - cant refresh view, no groups have been set")}setGroupHeader(e){this.table.options.groupHeader=e,this.configureGroupSetup(),this.table.options.groupBy?(this.refreshData(),this.trackChanges()):console.warn("Grouping Update - cant refresh view, no groups have been set")}userGetGroups(e){return this.getGroups(!0)}userGetGroupedData(){return this.table.options.groupBy?this.getGroupedData():this.getData()}rowGetGroup(e){return e.modules.group?e.modules.group.getComponent():!1}rowMoving(e,i,r){if(this.table.options.groupBy){!r&&i instanceof Eg&&(i=this.table.rowManager.prevDisplayRow(e)||i);var n=i instanceof Eg?i:i.modules.group,a=e instanceof Eg?e:e.modules.group;n===a?this.table.rowManager.moveRowInArray(n.rows,e,i,r):(a&&a.removeRow(e),n.insertRow(e,i,r))}}rowDeleting(e){this.table.options.groupBy&&e.modules.group&&e.modules.group.removeRow(e)}rowsUpdated(e){this.table.options.groupBy&&this.updateGroupRows(!0)}cellUpdated(e){this.table.options.groupBy&&this.reassignRowToGroup(e.row)}getRows(e){return this.table.options.groupBy&&this.groupIDLookups.length?(this.dispatchExternal("dataGrouping"),this.generateGroups(e),this.subscribedExternal("dataGrouped")&&this.dispatchExternal("dataGrouped",this.getGroups(!0)),this.updateGroupRows()):e.slice(0)}getGroups(e){var i=[];return this.groupList.forEach(function(r){i.push(e?r.getComponent():r)}),i}getChildGroups(e){var i=[];return e||(e=this),e.groupList.forEach(r=>{r.groupList.length?i=i.concat(this.getChildGroups(r)):i.push(r)}),i}wipe(){this.table.options.groupBy&&(this.groupList.forEach(function(e){e.wipe()}),this.groupList=[],this.groups={})}pullGroupListData(e){var i=[];return e.forEach(r=>{var n={};n.level=0,n.rowCount=0,n.headerContent="";var a=[];r.hasSubGroups?(a=this.pullGroupListData(r.groupList),n.level=r.level,n.rowCount=a.length-r.groupList.length,n.headerContent=r.generator(r.key,n.rowCount,r.rows,r),i.push(n),i=i.concat(a)):(n.level=r.level,n.headerContent=r.generator(r.key,r.rows.length,r.rows,r),n.rowCount=r.getRows().length,i.push(n),r.getRows().forEach(s=>{i.push(s.getData("data"))}))}),i}getGroupedData(){return this.pullGroupListData(this.groupList)}getRowGroup(e){var i=!1;return this.options("dataTree")&&(e=this.table.modules.dataTree.getTreeParentRoot(e)),this.groupList.forEach(r=>{var n=r.getRowGroup(e);n&&(i=n)}),i}countGroups(){return this.groupList.length}generateGroups(e){var i=this.groups;this.groups={},this.groupList=[],this.allowedValues&&this.allowedValues[0]?(this.allowedValues[0].forEach(r=>{this.createGroup(r,0,i)}),e.forEach(r=>{this.assignRowToExistingGroup(r,i)})):e.forEach(r=>{this.assignRowToGroup(r,i)}),Object.values(i).forEach(r=>{r.wipe(!0)})}createGroup(e,i,r){var n=i+"_"+e,a;r=r||[],a=new Eg(this,!1,i,e,this.groupIDLookups[0].field,this.headerGenerator[0],r[n]),this.groups[n]=a,this.groupList.push(a)}assignRowToExistingGroup(e,i){var r=this.groupIDLookups[0].func(e.getData()),n="0_"+r;this.groups[n]&&this.groups[n].addRow(e)}assignRowToGroup(e,i){var r=this.groupIDLookups[0].func(e.getData()),n=!this.groups["0_"+r];return n&&this.createGroup(r,0,i),this.groups["0_"+r].addRow(e),!n}reassignRowToGroup(e){if(e.type==="row"){var i=e.modules.group,r=i.getPath(),n=this.getExpectedPath(e),a;a=r.length==n.length&&r.every((s,o)=>s===n[o]),a||(i.removeRow(e),this.assignRowToGroup(e,this.groups),this.refreshData(!0))}}getExpectedPath(e){var i=[],r=e.getData();return this.groupIDLookups.forEach(n=>{i.push(n.func(r))}),i}updateGroupRows(e){var i=[];return this.blockRedraw||(this.groupList.forEach(r=>{i=i.concat(r.getHeadersAndRows())}),e&&this.refreshData(!0)),i}scrollHeaders(e){this.table.options.groupBy&&(this.table.options.renderHorizontal==="virtual"&&(e-=this.table.columnManager.renderer.vDomPadLeft),e=e+"px",this.groupList.forEach(i=>{i.scrollHeader(e)}))}removeGroup(e){var i=e.level+"_"+e.key,r;this.groups[i]&&(delete this.groups[i],r=this.groupList.indexOf(e),r>-1&&this.groupList.splice(r,1))}checkBasicModeGroupHeaderWidth(){var e=this.table.rowManager.tableElement,i=!0;this.table.rowManager.getDisplayRows().forEach((r,n)=>{this.table.rowManager.styleRow(r,n),e.appendChild(r.getElement()),r.initialize(!0),r.type!=="group"&&(i=!1)}),i?e.style.minWidth=this.table.columnManager.getWidth()+"px":e.style.minWidth=""}}var Ehe={cellEdit:function(t){t.component.setValueProcessData(t.data.oldValue),t.component.cellRendered()},rowAdd:function(t){t.component.deleteActual(),this.table.rowManager.checkPlaceholder()},rowDelete:function(t){var e=this.table.rowManager.addRowActual(t.data.data,t.data.pos,t.data.index);this.table.options.groupBy&&this.table.modExists("groupRows")&&this.table.modules.groupRows.updateGroupRows(!0),this._rebindRow(t.component,e),this.table.rowManager.checkPlaceholder()},rowMove:function(t){var e=t.data.posFrom-t.data.posTo>0;this.table.rowManager.moveRowActual(t.component,this.table.rowManager.getRowFromPosition(t.data.posFrom),e),this.table.rowManager.regenerateRowPositions(),this.table.rowManager.reRenderInPosition()}},Rhe={cellEdit:function(t){t.component.setValueProcessData(t.data.newValue),t.component.cellRendered()},rowAdd:function(t){var e=this.table.rowManager.addRowActual(t.data.data,t.data.pos,t.data.index);this.table.options.groupBy&&this.table.modExists("groupRows")&&this.table.modules.groupRows.updateGroupRows(!0),this._rebindRow(t.component,e),this.table.rowManager.checkPlaceholder()},rowDelete:function(t){t.component.deleteActual(),this.table.rowManager.checkPlaceholder()},rowMove:function(t){this.table.rowManager.moveRowActual(t.component,this.table.rowManager.getRowFromPosition(t.data.posTo),t.data.after),this.table.rowManager.regenerateRowPositions(),this.table.rowManager.reRenderInPosition()}},Che={undo:["ctrl + 90","meta + 90"],redo:["ctrl + 89","meta + 89"]},Mhe={undo:function(t){var e=!1;this.table.options.history&&this.table.modExists("history")&&this.table.modExists("edit")&&(e=this.table.modules.edit.currentCell,e||(t.preventDefault(),this.table.modules.history.undo()))},redo:function(t){var e=!1;this.table.options.history&&this.table.modExists("history")&&this.table.modExists("edit")&&(e=this.table.modules.edit.currentCell,e||(t.preventDefault(),this.table.modules.history.redo()))}},Nhe={keybindings:{bindings:Che,actions:Mhe}};class OD extends si{static moduleName="history";static moduleExtensions=Nhe;static undoers=Ehe;static redoers=Rhe;constructor(e){super(e),this.history=[],this.index=-1,this.registerTableOption("history",!1)}initialize(){this.table.options.history&&(this.subscribe("cell-value-updated",this.cellUpdated.bind(this)),this.subscribe("cell-delete",this.clearComponentHistory.bind(this)),this.subscribe("row-delete",this.rowDeleted.bind(this)),this.subscribe("rows-wipe",this.clear.bind(this)),this.subscribe("row-added",this.rowAdded.bind(this)),this.subscribe("row-move",this.rowMoved.bind(this))),this.registerTableFunction("undo",this.undo.bind(this)),this.registerTableFunction("redo",this.redo.bind(this)),this.registerTableFunction("getHistoryUndoSize",this.getHistoryUndoSize.bind(this)),this.registerTableFunction("getHistoryRedoSize",this.getHistoryRedoSize.bind(this)),this.registerTableFunction("clearHistory",this.clear.bind(this))}rowMoved(e,i,r){this.action("rowMove",e,{posFrom:e.getPosition(),posTo:i.getPosition(),to:i,after:r})}rowAdded(e,i,r,n){this.action("rowAdd",e,{data:i,pos:r,index:n})}rowDeleted(e){var i,r;this.table.options.groupBy?(r=e.getComponent().getGroup()._getSelf().rows,i=r.indexOf(e),i&&(i=r[i-1])):(i=e.table.rowManager.getRowIndex(e),i&&(i=e.table.rowManager.rows[i-1])),this.action("rowDelete",e,{data:e.getData(),pos:!i,index:i})}cellUpdated(e){this.action("cellEdit",e,{oldValue:e.oldValue,newValue:e.value})}clear(){this.history=[],this.index=-1}action(e,i,r){this.history=this.history.slice(0,this.index+1),this.history.push({type:e,component:i,data:r}),this.index++}getHistoryUndoSize(){return this.index+1}getHistoryRedoSize(){return this.history.length-(this.index+1)}clearComponentHistory(e){var i=this.history.findIndex(function(r){return r.component===e});i>-1&&(this.history.splice(i,1),i<=this.index&&this.index--,this.clearComponentHistory(e))}undo(){if(this.index>-1){let e=this.history[this.index];return OD.undoers[e.type].call(this,e),this.index--,this.dispatchExternal("historyUndo",e.type,e.component.getComponent(),e.data),!0}else return console.warn(this.options("history")?"History Undo Error - No more history to undo":"History module not enabled"),!1}redo(){if(this.history.length-1>this.index){this.index++;let e=this.history[this.index];return OD.redoers[e.type].call(this,e),this.dispatchExternal("historyRedo",e.type,e.component.getComponent(),e.data),!0}else return console.warn(this.options("history")?"History Redo Error - No more history to redo":"History module not enabled"),!1}_rebindRow(e,i){this.history.forEach(function(r){if(r.component instanceof Ca)r.component===e&&(r.component=i);else if(r.component instanceof Dw&&r.component.row===e){var n=r.component.column.getField();n&&(r.component=i.getCell(n))}})}}class Ahe extends si{static moduleName="htmlTableImport";constructor(e){super(e),this.fieldIndex=[],this.hasIndex=!1}initialize(){this.tableElementCheck()}tableElementCheck(){this.table.originalElement&&this.table.originalElement.tagName==="TABLE"&&(this.table.originalElement.childNodes.length?this.parseTable():console.warn("Unable to parse data from empty table tag, Tabulator should be initialized on a div tag unless importing data from a table element."))}parseTable(){var e=this.table.originalElement,i=this.table.options,r=e.getElementsByTagName("th"),n=e.getElementsByTagName("tbody")[0],a=[];this.hasIndex=!1,this.dispatchExternal("htmlImporting"),n=n?n.getElementsByTagName("tr"):[],this._extractOptions(e,i),r.length?this._extractHeaders(r,n):this._generateBlankHeaders(r,n);for(var s=0;s<n.length;s++){var o=n[s],l=o.getElementsByTagName("td"),u={};this.hasIndex||(u[i.index]=s);for(var c=0;c<l.length;c++){var d=l[c];typeof this.fieldIndex[c]<"u"&&(u[this.fieldIndex[c]]=d.innerHTML)}a.push(u)}i.data=a,this.dispatchExternal("htmlImported")}_extractOptions(e,i,r){var n=e.attributes,a=Object.keys(r||i),s={};a.forEach(c=>{s[c.toLowerCase()]=c});for(var o in n){var l=n[o],u;l&&typeof l=="object"&&l.name&&l.name.indexOf("tabulator-")===0&&(u=l.name.replace("tabulator-",""),typeof s[u]<"u"&&(i[s[u]]=this._attribValue(l.value)))}}_attribValue(e){return e==="true"?!0:e==="false"?!1:e}_findCol(e){var i=this.table.options.columns.find(r=>r.title===e);return i||!1}_extractHeaders(e,i){for(var r=0;r<e.length;r++){var n=e[r],a=!1,s=this._findCol(n.textContent),o;s?a=!0:s={title:n.textContent.trim()},s.field||(s.field=n.textContent.trim().toLowerCase().replaceAll(" ","_")),o=n.getAttribute("width"),o&&!s.width&&(s.width=o),this._extractOptions(n,s,this.table.columnManager.optionsList.registeredDefaults),this.fieldIndex[r]=s.field,s.field==this.table.options.index&&(this.hasIndex=!0),a||this.table.options.columns.push(s)}}_generateBlankHeaders(e,i){for(var r=0;r<e.length;r++){var n=e[r],a={title:"",field:"col"+r};this.fieldIndex[r]=a.field;var s=n.getAttribute("width");s&&(a.width=s),this.table.options.columns.push(a)}}}function khe(t){var e=[],i=0,r=0,n=!1;for(let a=0;a<t.length;a++){let s=t[a],o=t[a+1];if(e[i]||(e[i]=[]),e[i][r]||(e[i][r]=""),s=='"'&&n&&o=='"'){e[i][r]+=s,a++;continue}if(s=='"'){n=!n;continue}if(s==","&&!n){r++;continue}if(s=="\r"&&o==`
`&&!n){r=0,i++,a++;continue}if((s=="\r"||s==`
`)&&!n){r=0,i++;continue}e[i][r]+=s}return e}function Ohe(t){try{return JSON.parse(t)}catch(e){return console.warn("JSON Import Error - File contents is invalid JSON",e),Promise.reject()}}function xhe(t){return t}function Fhe(t){var e=this.dependencyRegistry.lookup("XLSX"),i=e.read(t),r=i.Sheets[i.SheetNames[0]];return e.utils.sheet_to_json(r,{header:1})}var Lhe={csv:khe,json:Ohe,array:xhe,xlsx:Fhe};class E1 extends si{static moduleName="import";static importers=Lhe;constructor(e){super(e),this.registerTableOption("importFormat"),this.registerTableOption("importReader","text"),this.registerTableOption("importHeaderTransform"),this.registerTableOption("importValueTransform"),this.registerTableOption("importDataValidator"),this.registerTableOption("importFileValidator")}initialize(){this.registerTableFunction("import",this.importFromFile.bind(this)),this.table.options.importFormat&&(this.subscribe("data-loading",this.loadDataCheck.bind(this),10),this.subscribe("data-load",this.loadData.bind(this),10))}loadDataCheck(e){return this.table.options.importFormat&&(typeof e=="string"||Array.isArray(e)&&e.length&&Array.isArray(e))}loadData(e,i,r,n,a){return this.importData(this.lookupImporter(),e).then(this.structureData.bind(this)).catch(s=>(console.error("Import Error:",s||"Unable to import data"),Promise.reject(s)))}lookupImporter(e){var i;return e||(e=this.table.options.importFormat),typeof e=="string"?i=E1.importers[e]:i=e,i||console.error("Import Error - Importer not found:",e),i}importFromFile(e,i,r){var n=this.lookupImporter(e);if(n)return this.pickFile(i,r).then(this.importData.bind(this,n)).then(this.structureData.bind(this)).then(this.mutateData.bind(this)).then(this.validateData.bind(this)).then(this.setData.bind(this)).catch(a=>(this.dispatch("import-error",a),this.dispatchExternal("importError",a),console.error("Import Error:",a||"Unable to import file"),this.table.dataLoader.alertError(),setTimeout(()=>{this.table.dataLoader.clearAlert()},3e3),Promise.reject(a)))}pickFile(e,i){return new Promise((r,n)=>{var a=document.createElement("input");a.type="file",a.accept=e,a.addEventListener("change",s=>{var o=a.files[0],l=new FileReader,u=this.validateFile(o);if(u===!0){switch(this.dispatch("import-importing",a.files),this.dispatchExternal("importImporting",a.files),i||this.table.options.importReader){case"buffer":l.readAsArrayBuffer(o);break;case"binary":l.readAsBinaryString(o);break;case"url":l.readAsDataURL(o);break;default:l.readAsText(o)}l.onload=c=>{r(l.result)},l.onerror=c=>{console.warn("File Load Error - Unable to read file"),n(c)}}else n(u)}),this.dispatch("import-choose"),this.dispatchExternal("importChoose"),a.click()})}importData(e,i){var r;return this.table.dataLoader.alertLoader(),new Promise((n,a)=>{setTimeout(()=>{r=e.call(this.table,i),r instanceof Promise||r?n(r):a()},10)})}structureData(e){var i=[];return Array.isArray(e)&&e.length&&Array.isArray(e[0])?(this.table.options.autoColumns?i=this.structureArrayToObject(e):i=this.structureArrayToColumns(e),i):e}mutateData(e){var i=[];return Array.isArray(e)?e.forEach(r=>{i.push(this.table.modules.mutator.transformRow(r,"import"))}):i=e,i}transformHeader(e){var i=[];if(this.table.options.importHeaderTransform)e.forEach(r=>{i.push(this.table.options.importHeaderTransform.call(this.table,r,e))});else return e;return i}transformData(e){var i=[];if(this.table.options.importValueTransform)e.forEach(r=>{i.push(this.table.options.importValueTransform.call(this.table,r,e))});else return e;return i}structureArrayToObject(e){var i=this.transformHeader(e.shift()),r=e.map(n=>{var a={};return n=this.transformData(n),i.forEach((s,o)=>{a[s]=n[o]}),a});return r}structureArrayToColumns(e){var i=[],r=this.transformHeader(e[0]),n=this.table.getColumns();return n[0]&&r[0]&&n[0].getDefinition().title===r[0]&&e.shift(),e.forEach(a=>{var s={};a=this.transformData(a),a.forEach((o,l)=>{var u=n[l];u&&(s[u.getField()]=o)}),i.push(s)}),i}validateFile(e){return this.table.options.importFileValidator?this.table.options.importFileValidator.call(this.table,e):!0}validateData(e){var i;return this.table.options.importDataValidator?(i=this.table.options.importDataValidator.call(this.table,e),i===!0?e:Promise.reject(i)):e}setData(e){return this.dispatch("import-imported",e),this.dispatchExternal("importImported",e),this.table.dataLoader.clearAlert(),this.table.setData(e)}}class _he extends si{static moduleName="interaction";constructor(e){super(e),this.eventMap={rowClick:"row-click",rowDblClick:"row-dblclick",rowContext:"row-contextmenu",rowMouseEnter:"row-mouseenter",rowMouseLeave:"row-mouseleave",rowMouseOver:"row-mouseover",rowMouseOut:"row-mouseout",rowMouseMove:"row-mousemove",rowMouseDown:"row-mousedown",rowMouseUp:"row-mouseup",rowTap:"row",rowDblTap:"row",rowTapHold:"row",cellClick:"cell-click",cellDblClick:"cell-dblclick",cellContext:"cell-contextmenu",cellMouseEnter:"cell-mouseenter",cellMouseLeave:"cell-mouseleave",cellMouseOver:"cell-mouseover",cellMouseOut:"cell-mouseout",cellMouseMove:"cell-mousemove",cellMouseDown:"cell-mousedown",cellMouseUp:"cell-mouseup",cellTap:"cell",cellDblTap:"cell",cellTapHold:"cell",headerClick:"column-click",headerDblClick:"column-dblclick",headerContext:"column-contextmenu",headerMouseEnter:"column-mouseenter",headerMouseLeave:"column-mouseleave",headerMouseOver:"column-mouseover",headerMouseOut:"column-mouseout",headerMouseMove:"column-mousemove",headerMouseDown:"column-mousedown",headerMouseUp:"column-mouseup",headerTap:"column",headerDblTap:"column",headerTapHold:"column",groupClick:"group-click",groupDblClick:"group-dblclick",groupContext:"group-contextmenu",groupMouseEnter:"group-mouseenter",groupMouseLeave:"group-mouseleave",groupMouseOver:"group-mouseover",groupMouseOut:"group-mouseout",groupMouseMove:"group-mousemove",groupMouseDown:"group-mousedown",groupMouseUp:"group-mouseup",groupTap:"group",groupDblTap:"group",groupTapHold:"group"},this.subscribers={},this.touchSubscribers={},this.columnSubscribers={},this.touchWatchers={row:{tap:null,tapDbl:null,tapHold:null},cell:{tap:null,tapDbl:null,tapHold:null},column:{tap:null,tapDbl:null,tapHold:null},group:{tap:null,tapDbl:null,tapHold:null}},this.registerColumnOption("headerClick"),this.registerColumnOption("headerDblClick"),this.registerColumnOption("headerContext"),this.registerColumnOption("headerMouseEnter"),this.registerColumnOption("headerMouseLeave"),this.registerColumnOption("headerMouseOver"),this.registerColumnOption("headerMouseOut"),this.registerColumnOption("headerMouseMove"),this.registerColumnOption("headerMouseDown"),this.registerColumnOption("headerMouseUp"),this.registerColumnOption("headerTap"),this.registerColumnOption("headerDblTap"),this.registerColumnOption("headerTapHold"),this.registerColumnOption("cellClick"),this.registerColumnOption("cellDblClick"),this.registerColumnOption("cellContext"),this.registerColumnOption("cellMouseEnter"),this.registerColumnOption("cellMouseLeave"),this.registerColumnOption("cellMouseOver"),this.registerColumnOption("cellMouseOut"),this.registerColumnOption("cellMouseMove"),this.registerColumnOption("cellMouseDown"),this.registerColumnOption("cellMouseUp"),this.registerColumnOption("cellTap"),this.registerColumnOption("cellDblTap"),this.registerColumnOption("cellTapHold")}initialize(){this.initializeExternalEvents(),this.subscribe("column-init",this.initializeColumn.bind(this)),this.subscribe("cell-dblclick",this.cellContentsSelectionFixer.bind(this)),this.subscribe("scroll-horizontal",this.clearTouchWatchers.bind(this)),this.subscribe("scroll-vertical",this.clearTouchWatchers.bind(this))}clearTouchWatchers(){var e=Object.values(this.touchWatchers);e.forEach(i=>{for(let r in i)i[r]=null})}cellContentsSelectionFixer(e,i){var r;if(!(this.table.modExists("edit")&&this.table.modules.edit.currentCell===i)){e.preventDefault();try{document.selection?(r=document.body.createTextRange(),r.moveToElementText(i.getElement()),r.select()):window.getSelection&&(r=document.createRange(),r.selectNode(i.getElement()),window.getSelection().removeAllRanges(),window.getSelection().addRange(r))}catch{}}}initializeExternalEvents(){for(let e in this.eventMap)this.subscriptionChangeExternal(e,this.subscriptionChanged.bind(this,e))}subscriptionChanged(e,i){i?this.subscribers[e]||(this.eventMap[e].includes("-")?(this.subscribers[e]=this.handle.bind(this,e),this.subscribe(this.eventMap[e],this.subscribers[e])):this.subscribeTouchEvents(e)):this.eventMap[e].includes("-")?this.subscribers[e]&&!this.columnSubscribers[e]&&!this.subscribedExternal(e)&&(this.unsubscribe(this.eventMap[e],this.subscribers[e]),delete this.subscribers[e]):this.unsubscribeTouchEvents(e)}subscribeTouchEvents(e){var i=this.eventMap[e];this.touchSubscribers[i+"-touchstart"]||(this.touchSubscribers[i+"-touchstart"]=this.handleTouch.bind(this,i,"start"),this.touchSubscribers[i+"-touchend"]=this.handleTouch.bind(this,i,"end"),this.subscribe(i+"-touchstart",this.touchSubscribers[i+"-touchstart"]),this.subscribe(i+"-touchend",this.touchSubscribers[i+"-touchend"])),this.subscribers[e]=!0}unsubscribeTouchEvents(e){var i=!0,r=this.eventMap[e];if(this.subscribers[e]&&!this.subscribedExternal(e)){delete this.subscribers[e];for(let n in this.eventMap)this.eventMap[n]===r&&this.subscribers[n]&&(i=!1);i&&(this.unsubscribe(r+"-touchstart",this.touchSubscribers[r+"-touchstart"]),this.unsubscribe(r+"-touchend",this.touchSubscribers[r+"-touchend"]),delete this.touchSubscribers[r+"-touchstart"],delete this.touchSubscribers[r+"-touchend"])}}initializeColumn(e){var i=e.definition;for(let r in this.eventMap)i[r]&&(this.subscriptionChanged(r,!0),this.columnSubscribers[r]||(this.columnSubscribers[r]=[]),this.columnSubscribers[r].push(e))}handle(e,i,r){this.dispatchEvent(e,i,r)}handleTouch(e,i,r,n){var a=this.touchWatchers[e];switch(e==="column"&&(e="header"),i){case"start":a.tap=!0,clearTimeout(a.tapHold),a.tapHold=setTimeout(()=>{clearTimeout(a.tapHold),a.tapHold=null,a.tap=null,clearTimeout(a.tapDbl),a.tapDbl=null,this.dispatchEvent(e+"TapHold",r,n)},1e3);break;case"end":a.tap&&(a.tap=null,this.dispatchEvent(e+"Tap",r,n)),a.tapDbl?(clearTimeout(a.tapDbl),a.tapDbl=null,this.dispatchEvent(e+"DblTap",r,n)):a.tapDbl=setTimeout(()=>{clearTimeout(a.tapDbl),a.tapDbl=null},300),clearTimeout(a.tapHold),a.tapHold=null;break}}dispatchEvent(e,i,r){var n=r.getComponent(),a;this.columnSubscribers[e]&&(r instanceof Dw?a=r.column.definition[e]:r instanceof Vu&&(a=r.definition[e]),a&&a(i,n)),this.dispatchExternal(e,i,n)}}var $he={navPrev:"shift + 9",navNext:9,navUp:38,navDown:40,navLeft:37,navRight:39,scrollPageUp:33,scrollPageDown:34,scrollToStart:36,scrollToEnd:35},Bhe={keyBlock:function(t){t.stopPropagation(),t.preventDefault()},scrollPageUp:function(t){var e=this.table.rowManager,i=e.scrollTop-e.element.clientHeight;t.preventDefault(),e.displayRowsCount&&(i>=0?e.element.scrollTop=i:e.scrollToRow(e.getDisplayRows()[0])),this.table.element.focus()},scrollPageDown:function(t){var e=this.table.rowManager,i=e.scrollTop+e.element.clientHeight,r=e.element.scrollHeight;t.preventDefault(),e.displayRowsCount&&(i<=r?e.element.scrollTop=i:e.scrollToRow(e.getDisplayRows()[e.displayRowsCount-1])),this.table.element.focus()},scrollToStart:function(t){var e=this.table.rowManager;t.preventDefault(),e.displayRowsCount&&e.scrollToRow(e.getDisplayRows()[0]),this.table.element.focus()},scrollToEnd:function(t){var e=this.table.rowManager;t.preventDefault(),e.displayRowsCount&&e.scrollToRow(e.getDisplayRows()[e.displayRowsCount-1]),this.table.element.focus()},navPrev:function(t){this.dispatch("keybinding-nav-prev",t)},navNext:function(t){this.dispatch("keybinding-nav-next",t)},navLeft:function(t){this.dispatch("keybinding-nav-left",t)},navRight:function(t){this.dispatch("keybinding-nav-right",t)},navUp:function(t){this.dispatch("keybinding-nav-up",t)},navDown:function(t){this.dispatch("keybinding-nav-down",t)}};class ky extends si{static moduleName="keybindings";static bindings=$he;static actions=Bhe;constructor(e){super(e),this.watchKeys=null,this.pressedKeys=null,this.keyupBinding=!1,this.keydownBinding=!1,this.registerTableOption("keybindings",{}),this.registerTableOption("tabEndNewRow",!1)}initialize(){var e=this.table.options.keybindings,i={};this.watchKeys={},this.pressedKeys=[],e!==!1&&(Object.assign(i,ky.bindings),Object.assign(i,e),this.mapBindings(i),this.bindEvents()),this.subscribe("table-destroy",this.clearBindings.bind(this))}mapBindings(e){for(let i in e)ky.actions[i]?e[i]&&(typeof e[i]!="object"&&(e[i]=[e[i]]),e[i].forEach(r=>{var n=Array.isArray(r)?r:[r];n.forEach(a=>{this.mapBinding(i,a)})})):console.warn("Key Binding Error - no such action:",i)}mapBinding(e,i){var r={action:ky.actions[e],keys:[],ctrl:!1,shift:!1,meta:!1},n=i.toString().toLowerCase().split(" ").join("").split("+");n.forEach(a=>{switch(a){case"ctrl":r.ctrl=!0;break;case"shift":r.shift=!0;break;case"meta":r.meta=!0;break;default:a=isNaN(a)?a.toUpperCase().charCodeAt(0):parseInt(a),r.keys.push(a),this.watchKeys[a]||(this.watchKeys[a]=[]),this.watchKeys[a].push(r)}})}bindEvents(){var e=this;this.keyupBinding=function(i){var r=i.keyCode,n=e.watchKeys[r];n&&(e.pressedKeys.push(r),n.forEach(function(a){e.checkBinding(i,a)}))},this.keydownBinding=function(i){var r=i.keyCode,n=e.watchKeys[r];if(n){var a=e.pressedKeys.indexOf(r);a>-1&&e.pressedKeys.splice(a,1)}},this.table.element.addEventListener("keydown",this.keyupBinding),this.table.element.addEventListener("keyup",this.keydownBinding)}clearBindings(){this.keyupBinding&&this.table.element.removeEventListener("keydown",this.keyupBinding),this.keydownBinding&&this.table.element.removeEventListener("keyup",this.keydownBinding)}checkBinding(e,i){var r=!0;return e.ctrlKey==i.ctrl&&e.shiftKey==i.shift&&e.metaKey==i.meta?(i.keys.forEach(n=>{var a=this.pressedKeys.indexOf(n);a==-1&&(r=!1)}),r&&i.action.call(this,e),!0):!1}}class Vhe extends si{static moduleName="menu";constructor(e){super(e),this.menuContainer=null,this.nestedMenuBlock=!1,this.currentComponent=null,this.rootPopup=null,this.columnSubscribers={},this.registerTableOption("rowContextMenu",!1),this.registerTableOption("rowClickMenu",!1),this.registerTableOption("rowDblClickMenu",!1),this.registerTableOption("groupContextMenu",!1),this.registerTableOption("groupClickMenu",!1),this.registerTableOption("groupDblClickMenu",!1),this.registerColumnOption("headerContextMenu"),this.registerColumnOption("headerClickMenu"),this.registerColumnOption("headerDblClickMenu"),this.registerColumnOption("headerMenu"),this.registerColumnOption("headerMenuIcon"),this.registerColumnOption("contextMenu"),this.registerColumnOption("clickMenu"),this.registerColumnOption("dblClickMenu")}initialize(){this.deprecatedOptionsCheck(),this.initializeRowWatchers(),this.initializeGroupWatchers(),this.subscribe("column-init",this.initializeColumn.bind(this))}deprecatedOptionsCheck(){}initializeRowWatchers(){this.table.options.rowContextMenu&&(this.subscribe("row-contextmenu",this.loadMenuEvent.bind(this,this.table.options.rowContextMenu)),this.table.on("rowTapHold",this.loadMenuEvent.bind(this,this.table.options.rowContextMenu))),this.table.options.rowClickMenu&&this.subscribe("row-click",this.loadMenuEvent.bind(this,this.table.options.rowClickMenu)),this.table.options.rowDblClickMenu&&this.subscribe("row-dblclick",this.loadMenuEvent.bind(this,this.table.options.rowDblClickMenu))}initializeGroupWatchers(){this.table.options.groupContextMenu&&(this.subscribe("group-contextmenu",this.loadMenuEvent.bind(this,this.table.options.groupContextMenu)),this.table.on("groupTapHold",this.loadMenuEvent.bind(this,this.table.options.groupContextMenu))),this.table.options.groupClickMenu&&this.subscribe("group-click",this.loadMenuEvent.bind(this,this.table.options.groupClickMenu)),this.table.options.groupDblClickMenu&&this.subscribe("group-dblclick",this.loadMenuEvent.bind(this,this.table.options.groupDblClickMenu))}initializeColumn(e){var i=e.definition;i.headerContextMenu&&!this.columnSubscribers.headerContextMenu&&(this.columnSubscribers.headerContextMenu=this.loadMenuTableColumnEvent.bind(this,"headerContextMenu"),this.subscribe("column-contextmenu",this.columnSubscribers.headerContextMenu),this.table.on("headerTapHold",this.loadMenuTableColumnEvent.bind(this,"headerContextMenu"))),i.headerClickMenu&&!this.columnSubscribers.headerClickMenu&&(this.columnSubscribers.headerClickMenu=this.loadMenuTableColumnEvent.bind(this,"headerClickMenu"),this.subscribe("column-click",this.columnSubscribers.headerClickMenu)),i.headerDblClickMenu&&!this.columnSubscribers.headerDblClickMenu&&(this.columnSubscribers.headerDblClickMenu=this.loadMenuTableColumnEvent.bind(this,"headerDblClickMenu"),this.subscribe("column-dblclick",this.columnSubscribers.headerDblClickMenu)),i.headerMenu&&this.initializeColumnHeaderMenu(e),i.contextMenu&&!this.columnSubscribers.contextMenu&&(this.columnSubscribers.contextMenu=this.loadMenuTableCellEvent.bind(this,"contextMenu"),this.subscribe("cell-contextmenu",this.columnSubscribers.contextMenu),this.table.on("cellTapHold",this.loadMenuTableCellEvent.bind(this,"contextMenu"))),i.clickMenu&&!this.columnSubscribers.clickMenu&&(this.columnSubscribers.clickMenu=this.loadMenuTableCellEvent.bind(this,"clickMenu"),this.subscribe("cell-click",this.columnSubscribers.clickMenu)),i.dblClickMenu&&!this.columnSubscribers.dblClickMenu&&(this.columnSubscribers.dblClickMenu=this.loadMenuTableCellEvent.bind(this,"dblClickMenu"),this.subscribe("cell-dblclick",this.columnSubscribers.dblClickMenu))}initializeColumnHeaderMenu(e){var i=e.definition.headerMenuIcon,r;r=document.createElement("span"),r.classList.add("tabulator-header-popup-button"),i?(typeof i=="function"&&(i=i(e.getComponent())),i instanceof HTMLElement?r.appendChild(i):r.innerHTML=i):r.innerHTML="&vellip;",r.addEventListener("click",n=>{n.stopPropagation(),n.preventDefault(),this.loadMenuEvent(e.definition.headerMenu,n,e)}),e.titleElement.insertBefore(r,e.titleElement.firstChild)}loadMenuTableCellEvent(e,i,r){r._cell&&(r=r._cell),r.column.definition[e]&&this.loadMenuEvent(r.column.definition[e],i,r)}loadMenuTableColumnEvent(e,i,r){r._column&&(r=r._column),r.definition[e]&&this.loadMenuEvent(r.definition[e],i,r)}loadMenuEvent(e,i,r){r._group?r=r._group:r._row&&(r=r._row),e=typeof e=="function"?e.call(this.table,i,r.getComponent()):e,this.loadMenu(i,r,e)}loadMenu(e,i,r,n,a){var s=!(e instanceof MouseEvent),o=document.createElement("div"),l;if(o.classList.add("tabulator-menu"),s||e.preventDefault(),!(!r||!r.length)){if(n)l=a.child(o);else{if(this.nestedMenuBlock){if(this.rootPopup)return}else this.nestedMenuBlock=setTimeout(()=>{this.nestedMenuBlock=!1},100);this.rootPopup&&this.rootPopup.hide(),this.rootPopup=l=this.popup(o)}r.forEach(u=>{var c=document.createElement("div"),d=u.label,p=u.disabled;u.separator?c.classList.add("tabulator-menu-separator"):(c.classList.add("tabulator-menu-item"),typeof d=="function"&&(d=d.call(this.table,i.getComponent())),d instanceof Node?c.appendChild(d):c.innerHTML=d,typeof p=="function"&&(p=p.call(this.table,i.getComponent())),p?(c.classList.add("tabulator-menu-item-disabled"),c.addEventListener("click",f=>{f.stopPropagation()})):u.menu&&u.menu.length?c.addEventListener("click",f=>{f.stopPropagation(),this.loadMenu(f,i,u.menu,c,l)}):u.action&&c.addEventListener("click",f=>{u.action(f,i.getComponent())}),u.menu&&u.menu.length&&c.classList.add("tabulator-menu-item-submenu")),o.appendChild(c)}),o.addEventListener("click",u=>{this.rootPopup&&this.rootPopup.hide()}),l.show(n||e),l===this.rootPopup&&(this.rootPopup.hideOnBlur(()=>{this.rootPopup=null,this.currentComponent&&(this.dispatch("menu-closed",r,l),this.dispatchExternal("menuClosed",this.currentComponent.getComponent()),this.currentComponent=null)}),this.currentComponent=i,this.dispatch("menu-opened",r,l),this.dispatchExternal("menuOpened",i.getComponent()))}}}class jhe extends si{static moduleName="moveColumn";constructor(e){super(e),this.placeholderElement=this.createPlaceholderElement(),this.hoverElement=!1,this.checkTimeout=!1,this.checkPeriod=250,this.moving=!1,this.toCol=!1,this.toColAfter=!1,this.startX=0,this.autoScrollMargin=40,this.autoScrollStep=5,this.autoScrollTimeout=!1,this.touchMove=!1,this.moveHover=this.moveHover.bind(this),this.endMove=this.endMove.bind(this),this.registerTableOption("movableColumns",!1)}createPlaceholderElement(){var e=document.createElement("div");return e.classList.add("tabulator-col"),e.classList.add("tabulator-col-placeholder"),e}initialize(){this.table.options.movableColumns&&(this.subscribe("column-init",this.initializeColumn.bind(this)),this.subscribe("alert-show",this.abortMove.bind(this)))}abortMove(){clearTimeout(this.checkTimeout)}initializeColumn(e){var i=this,r={},n;!e.modules.frozen&&!e.isGroup&&!e.isRowHeader&&(n=e.getElement(),r.mousemove=(function(a){e.parent===i.moving.parent&&((i.touchMove?a.touches[0].pageX:a.pageX)-gr.elOffset(n).left+i.table.columnManager.contentsElement.scrollLeft>e.getWidth()/2?(i.toCol!==e||!i.toColAfter)&&(n.parentNode.insertBefore(i.placeholderElement,n.nextSibling),i.moveColumn(e,!0)):(i.toCol!==e||i.toColAfter)&&(n.parentNode.insertBefore(i.placeholderElement,n),i.moveColumn(e,!1)))}).bind(i),n.addEventListener("mousedown",function(a){i.touchMove=!1,a.which===1&&(i.checkTimeout=setTimeout(function(){i.startMove(a,e)},i.checkPeriod))}),n.addEventListener("mouseup",function(a){a.which===1&&i.checkTimeout&&clearTimeout(i.checkTimeout)}),i.bindTouchEvents(e)),e.modules.moveColumn=r}bindTouchEvents(e){var i=e.getElement(),r=!1,n,a,s,o,l,u;i.addEventListener("touchstart",c=>{this.checkTimeout=setTimeout(()=>{this.touchMove=!0,n=e.nextColumn(),s=n?n.getWidth()/2:0,a=e.prevColumn(),o=a?a.getWidth()/2:0,l=0,u=0,r=!1,this.startMove(c,e)},this.checkPeriod)},{passive:!0}),i.addEventListener("touchmove",c=>{var d,p;this.moving&&(this.moveHover(c),r||(r=c.touches[0].pageX),d=c.touches[0].pageX-r,d>0?n&&d-l>s&&(p=n,p!==e&&(r=c.touches[0].pageX,p.getElement().parentNode.insertBefore(this.placeholderElement,p.getElement().nextSibling),this.moveColumn(p,!0))):a&&-d-u>o&&(p=a,p!==e&&(r=c.touches[0].pageX,p.getElement().parentNode.insertBefore(this.placeholderElement,p.getElement()),this.moveColumn(p,!1))),p&&(n=p.nextColumn(),l=s,s=n?n.getWidth()/2:0,a=p.prevColumn(),u=o,o=a?a.getWidth()/2:0))},{passive:!0}),i.addEventListener("touchend",c=>{this.checkTimeout&&clearTimeout(this.checkTimeout),this.moving&&this.endMove(c)})}startMove(e,i){var r=i.getElement(),n=this.table.columnManager.getContentsElement(),a=this.table.columnManager.getHeadersElement();this.table.modules.selectRange&&this.table.modules.selectRange.columnSelection&&this.table.modules.selectRange.mousedown&&this.table.modules.selectRange.selecting==="column"||(this.moving=i,this.startX=(this.touchMove?e.touches[0].pageX:e.pageX)-gr.elOffset(r).left,this.table.element.classList.add("tabulator-block-select"),this.placeholderElement.style.width=i.getWidth()+"px",this.placeholderElement.style.height=i.getHeight()+"px",r.parentNode.insertBefore(this.placeholderElement,r),r.parentNode.removeChild(r),this.hoverElement=r.cloneNode(!0),this.hoverElement.classList.add("tabulator-moving"),n.appendChild(this.hoverElement),this.hoverElement.style.left="0",this.hoverElement.style.bottom=n.clientHeight-a.offsetHeight+"px",this.touchMove||(this._bindMouseMove(),document.body.addEventListener("mousemove",this.moveHover),document.body.addEventListener("mouseup",this.endMove)),this.moveHover(e),this.dispatch("column-moving",e,this.moving))}_bindMouseMove(){this.table.columnManager.columnsByIndex.forEach(function(e){e.modules.moveColumn.mousemove&&e.getElement().addEventListener("mousemove",e.modules.moveColumn.mousemove)})}_unbindMouseMove(){this.table.columnManager.columnsByIndex.forEach(function(e){e.modules.moveColumn.mousemove&&e.getElement().removeEventListener("mousemove",e.modules.moveColumn.mousemove)})}moveColumn(e,i){var r=this.moving.getCells();this.toCol=e,this.toColAfter=i,i?e.getCells().forEach(function(n,a){var s=n.getElement(!0);s.parentNode&&r[a]&&s.parentNode.insertBefore(r[a].getElement(),s.nextSibling)}):e.getCells().forEach(function(n,a){var s=n.getElement(!0);s.parentNode&&r[a]&&s.parentNode.insertBefore(r[a].getElement(),s)})}endMove(e){(e.which===1||this.touchMove)&&(this._unbindMouseMove(),this.placeholderElement.parentNode.insertBefore(this.moving.getElement(),this.placeholderElement.nextSibling),this.placeholderElement.parentNode.removeChild(this.placeholderElement),this.hoverElement.parentNode.removeChild(this.hoverElement),this.table.element.classList.remove("tabulator-block-select"),this.toCol&&this.table.columnManager.moveColumnActual(this.moving,this.toCol,this.toColAfter),this.moving=!1,this.toCol=!1,this.toColAfter=!1,this.touchMove||(document.body.removeEventListener("mousemove",this.moveHover),document.body.removeEventListener("mouseup",this.endMove)))}moveHover(e){var i=this.table.columnManager.getContentsElement(),r=i.scrollLeft,n=(this.touchMove?e.touches[0].pageX:e.pageX)-gr.elOffset(i).left+r,a;this.hoverElement.style.left=n-this.startX+"px",n-r<this.autoScrollMargin&&(this.autoScrollTimeout||(this.autoScrollTimeout=setTimeout(()=>{a=Math.max(0,r-5),this.table.rowManager.getElement().scrollLeft=a,this.autoScrollTimeout=!1},1))),r+i.clientWidth-n<this.autoScrollMargin&&(this.autoScrollTimeout||(this.autoScrollTimeout=setTimeout(()=>{a=Math.min(i.clientWidth,r+5),this.table.rowManager.getElement().scrollLeft=a,this.autoScrollTimeout=!1},1)))}}var Ghe={delete:function(t,e,i){t.delete()}},Hhe={insert:function(t,e,i){return this.table.addRow(t.getData(),void 0,e),!0},add:function(t,e,i){return this.table.addRow(t.getData()),!0},update:function(t,e,i){return e?(e.update(t.getData()),!0):!1},replace:function(t,e,i){return e?(this.table.addRow(t.getData(),void 0,e),e.delete(),!0):!1}};class xD extends si{static moduleName="moveRow";static senders=Ghe;static receivers=Hhe;constructor(e){super(e),this.placeholderElement=this.createPlaceholderElement(),this.hoverElement=!1,this.checkTimeout=!1,this.checkPeriod=150,this.moving=!1,this.toRow=!1,this.toRowAfter=!1,this.hasHandle=!1,this.startY=0,this.startX=0,this.moveHover=this.moveHover.bind(this),this.endMove=this.endMove.bind(this),this.tableRowDropEvent=!1,this.touchMove=!1,this.connection=!1,this.connectionSelectorsTables=!1,this.connectionSelectorsElements=!1,this.connectionElements=[],this.connections=[],this.connectedTable=!1,this.connectedRow=!1,this.registerTableOption("movableRows",!1),this.registerTableOption("movableRowsConnectedTables",!1),this.registerTableOption("movableRowsConnectedElements",!1),this.registerTableOption("movableRowsSender",!1),this.registerTableOption("movableRowsReceiver","insert"),this.registerColumnOption("rowHandle")}createPlaceholderElement(){var e=document.createElement("div");return e.classList.add("tabulator-row"),e.classList.add("tabulator-row-placeholder"),e}initialize(){this.table.options.movableRows&&(this.connectionSelectorsTables=this.table.options.movableRowsConnectedTables,this.connectionSelectorsElements=this.table.options.movableRowsConnectedElements,this.connection=this.connectionSelectorsTables||this.connectionSelectorsElements,this.subscribe("cell-init",this.initializeCell.bind(this)),this.subscribe("column-init",this.initializeColumn.bind(this)),this.subscribe("row-init",this.initializeRow.bind(this)))}initializeGroupHeader(e){var i=this,r={};r.mouseup=(function(n){i.tableRowDrop(n,e)}).bind(i),r.mousemove=(function(n){var a;n.pageY-gr.elOffset(e.element).top+i.table.rowManager.element.scrollTop>e.getHeight()/2?(i.toRow!==e||!i.toRowAfter)&&(a=e.getElement(),a.parentNode.insertBefore(i.placeholderElement,a.nextSibling),i.moveRow(e,!0)):(i.toRow!==e||i.toRowAfter)&&(a=e.getElement(),a.previousSibling&&(a.parentNode.insertBefore(i.placeholderElement,a),i.moveRow(e,!1)))}).bind(i),e.modules.moveRow=r}initializeRow(e){var i=this,r={},n;r.mouseup=(function(a){i.tableRowDrop(a,e)}).bind(i),r.mousemove=(function(a){var s=e.getElement();a.pageY-gr.elOffset(s).top+i.table.rowManager.element.scrollTop>e.getHeight()/2?(i.toRow!==e||!i.toRowAfter)&&(s.parentNode.insertBefore(i.placeholderElement,s.nextSibling),i.moveRow(e,!0)):(i.toRow!==e||i.toRowAfter)&&(s.parentNode.insertBefore(i.placeholderElement,s),i.moveRow(e,!1))}).bind(i),this.hasHandle||(n=e.getElement(),n.addEventListener("mousedown",function(a){a.which===1&&(i.checkTimeout=setTimeout(function(){i.startMove(a,e)},i.checkPeriod))}),n.addEventListener("mouseup",function(a){a.which===1&&i.checkTimeout&&clearTimeout(i.checkTimeout)}),this.bindTouchEvents(e,e.getElement())),e.modules.moveRow=r}initializeColumn(e){e.definition.rowHandle&&this.table.options.movableRows!==!1&&(this.hasHandle=!0)}initializeCell(e){if(e.column.definition.rowHandle&&this.table.options.movableRows!==!1){var i=this,r=e.getElement(!0);r.addEventListener("mousedown",function(n){n.which===1&&(i.checkTimeout=setTimeout(function(){i.startMove(n,e.row)},i.checkPeriod))}),r.addEventListener("mouseup",function(n){n.which===1&&i.checkTimeout&&clearTimeout(i.checkTimeout)}),this.bindTouchEvents(e.row,r)}}bindTouchEvents(e,i){var r=!1,n,a,s,o,l,u;i.addEventListener("touchstart",c=>{this.checkTimeout=setTimeout(()=>{this.touchMove=!0,n=e.nextRow(),s=n?n.getHeight()/2:0,a=e.prevRow(),o=a?a.getHeight()/2:0,l=0,u=0,r=!1,this.startMove(c,e)},this.checkPeriod)},{passive:!0}),this.moving,this.toRow,this.toRowAfter,i.addEventListener("touchmove",c=>{var d,p;this.moving&&(c.preventDefault(),this.moveHover(c),r||(r=c.touches[0].pageY),d=c.touches[0].pageY-r,d>0?n&&d-l>s&&(p=n,p!==e&&(r=c.touches[0].pageY,p.getElement().parentNode.insertBefore(this.placeholderElement,p.getElement().nextSibling),this.moveRow(p,!0))):a&&-d-u>o&&(p=a,p!==e&&(r=c.touches[0].pageY,p.getElement().parentNode.insertBefore(this.placeholderElement,p.getElement()),this.moveRow(p,!1))),p&&(n=p.nextRow(),l=s,s=n?n.getHeight()/2:0,a=p.prevRow(),u=o,o=a?a.getHeight()/2:0))}),i.addEventListener("touchend",c=>{this.checkTimeout&&clearTimeout(this.checkTimeout),this.moving&&(this.endMove(c),this.touchMove=!1)})}_bindMouseMove(){this.table.rowManager.getDisplayRows().forEach(e=>{(e.type==="row"||e.type==="group")&&e.modules.moveRow&&e.modules.moveRow.mousemove&&e.getElement().addEventListener("mousemove",e.modules.moveRow.mousemove)})}_unbindMouseMove(){this.table.rowManager.getDisplayRows().forEach(e=>{(e.type==="row"||e.type==="group")&&e.modules.moveRow&&e.modules.moveRow.mousemove&&e.getElement().removeEventListener("mousemove",e.modules.moveRow.mousemove)})}startMove(e,i){var r=i.getElement();this.setStartPosition(e,i),this.moving=i,this.table.element.classList.add("tabulator-block-select"),this.placeholderElement.style.width=i.getWidth()+"px",this.placeholderElement.style.height=i.getHeight()+"px",this.connection?(this.table.element.classList.add("tabulator-movingrow-sending"),this.connectToTables(i)):(r.parentNode.insertBefore(this.placeholderElement,r),r.parentNode.removeChild(r)),this.hoverElement=r.cloneNode(!0),this.hoverElement.classList.add("tabulator-moving"),this.connection?(document.body.appendChild(this.hoverElement),this.hoverElement.style.left="0",this.hoverElement.style.top="0",this.hoverElement.style.width=this.table.element.clientWidth+"px",this.hoverElement.style.whiteSpace="nowrap",this.hoverElement.style.overflow="hidden",this.hoverElement.style.pointerEvents="none"):(this.table.rowManager.getTableElement().appendChild(this.hoverElement),this.hoverElement.style.left="0",this.hoverElement.style.top="0",this._bindMouseMove()),document.body.addEventListener("mousemove",this.moveHover),document.body.addEventListener("mouseup",this.endMove),this.dispatchExternal("rowMoving",i.getComponent()),this.moveHover(e)}setStartPosition(e,i){var r=this.touchMove?e.touches[0].pageX:e.pageX,n=this.touchMove?e.touches[0].pageY:e.pageY,a,s;a=i.getElement(),this.connection?(s=a.getBoundingClientRect(),this.startX=s.left-r+window.pageXOffset,this.startY=s.top-n+window.pageYOffset):this.startY=n-a.getBoundingClientRect().top}endMove(e){(!e||e.which===1||this.touchMove)&&(this._unbindMouseMove(),this.connection||(this.placeholderElement.parentNode.insertBefore(this.moving.getElement(),this.placeholderElement.nextSibling),this.placeholderElement.parentNode.removeChild(this.placeholderElement)),this.hoverElement.parentNode.removeChild(this.hoverElement),this.table.element.classList.remove("tabulator-block-select"),this.toRow?this.table.rowManager.moveRow(this.moving,this.toRow,this.toRowAfter):this.dispatchExternal("rowMoveCancelled",this.moving.getComponent()),this.moving=!1,this.toRow=!1,this.toRowAfter=!1,document.body.removeEventListener("mousemove",this.moveHover),document.body.removeEventListener("mouseup",this.endMove),this.connection&&(this.table.element.classList.remove("tabulator-movingrow-sending"),this.disconnectFromTables()))}moveRow(e,i){this.toRow=e,this.toRowAfter=i}moveHover(e){this.connection?this.moveHoverConnections.call(this,e):this.moveHoverTable.call(this,e)}moveHoverTable(e){var i=this.table.rowManager.getElement(),r=i.scrollTop,n=(this.touchMove?e.touches[0].pageY:e.pageY)-i.getBoundingClientRect().top+r;this.hoverElement.style.top=Math.min(n-this.startY,this.table.rowManager.element.scrollHeight-this.hoverElement.offsetHeight)+"px"}moveHoverConnections(e){this.hoverElement.style.left=this.startX+(this.touchMove?e.touches[0].pageX:e.pageX)+"px",this.hoverElement.style.top=this.startY+(this.touchMove?e.touches[0].pageY:e.pageY)+"px"}elementRowDrop(e,i,r){this.dispatchExternal("movableRowsElementDrop",e,i,r?r.getComponent():!1)}connectToTables(e){var i;this.connectionSelectorsTables&&(i=this.commsConnections(this.connectionSelectorsTables),this.dispatchExternal("movableRowsSendingStart",i),this.commsSend(this.connectionSelectorsTables,"moveRow","connect",{row:e})),this.connectionSelectorsElements&&(this.connectionElements=[],Array.isArray(this.connectionSelectorsElements)||(this.connectionSelectorsElements=[this.connectionSelectorsElements]),this.connectionSelectorsElements.forEach(r=>{typeof r=="string"?this.connectionElements=this.connectionElements.concat(Array.prototype.slice.call(document.querySelectorAll(r))):this.connectionElements.push(r)}),this.connectionElements.forEach(r=>{var n=a=>{this.elementRowDrop(a,r,this.moving)};r.addEventListener("mouseup",n),r.tabulatorElementDropEvent=n,r.classList.add("tabulator-movingrow-receiving")}))}disconnectFromTables(){var e;this.connectionSelectorsTables&&(e=this.commsConnections(this.connectionSelectorsTables),this.dispatchExternal("movableRowsSendingStop",e),this.commsSend(this.connectionSelectorsTables,"moveRow","disconnect")),this.connectionElements.forEach(i=>{i.classList.remove("tabulator-movingrow-receiving"),i.removeEventListener("mouseup",i.tabulatorElementDropEvent),delete i.tabulatorElementDropEvent})}connect(e,i){return this.connectedTable?(console.warn("Move Row Error - Table cannot accept connection, already connected to table:",this.connectedTable),!1):(this.connectedTable=e,this.connectedRow=i,this.table.element.classList.add("tabulator-movingrow-receiving"),this.table.rowManager.getDisplayRows().forEach(r=>{r.type==="row"&&r.modules.moveRow&&r.modules.moveRow.mouseup&&r.getElement().addEventListener("mouseup",r.modules.moveRow.mouseup)}),this.tableRowDropEvent=this.tableRowDrop.bind(this),this.table.element.addEventListener("mouseup",this.tableRowDropEvent),this.dispatchExternal("movableRowsReceivingStart",i,e),!0)}disconnect(e){e===this.connectedTable?(this.connectedTable=!1,this.connectedRow=!1,this.table.element.classList.remove("tabulator-movingrow-receiving"),this.table.rowManager.getDisplayRows().forEach(i=>{i.type==="row"&&i.modules.moveRow&&i.modules.moveRow.mouseup&&i.getElement().removeEventListener("mouseup",i.modules.moveRow.mouseup)}),this.table.element.removeEventListener("mouseup",this.tableRowDropEvent),this.dispatchExternal("movableRowsReceivingStop",e)):console.warn("Move Row Error - trying to disconnect from non connected table")}dropComplete(e,i,r){var n=!1;if(r){switch(typeof this.table.options.movableRowsSender){case"string":n=xD.senders[this.table.options.movableRowsSender];break;case"function":n=this.table.options.movableRowsSender;break}n?n.call(this,this.moving?this.moving.getComponent():void 0,i?i.getComponent():void 0,e):this.table.options.movableRowsSender&&console.warn("Mover Row Error - no matching sender found:",this.table.options.movableRowsSender),this.dispatchExternal("movableRowsSent",this.moving.getComponent(),i?i.getComponent():void 0,e)}else this.dispatchExternal("movableRowsSentFailed",this.moving.getComponent(),i?i.getComponent():void 0,e);this.endMove()}tableRowDrop(e,i){var r=!1,n=!1;switch(e.stopImmediatePropagation(),typeof this.table.options.movableRowsReceiver){case"string":r=xD.receivers[this.table.options.movableRowsReceiver];break;case"function":r=this.table.options.movableRowsReceiver;break}r?n=r.call(this,this.connectedRow.getComponent(),i?i.getComponent():void 0,this.connectedTable):console.warn("Mover Row Error - no matching receiver found:",this.table.options.movableRowsReceiver),n?this.dispatchExternal("movableRowsReceived",this.connectedRow.getComponent(),i?i.getComponent():void 0,this.connectedTable):this.dispatchExternal("movableRowsReceivedFailed",this.connectedRow.getComponent(),i?i.getComponent():void 0,this.connectedTable),this.commsSend(this.connectedTable,"moveRow","dropcomplete",{row:i,success:n})}commsReceived(e,i,r){switch(i){case"connect":return this.connect(e,r.row);case"disconnect":return this.disconnect(e);case"dropcomplete":return this.dropComplete(e,r.row,r.success)}}}var Whe={};class FD extends si{static moduleName="mutator";static mutators=Whe;constructor(e){super(e),this.allowedTypes=["","data","edit","clipboard","import"],this.enabled=!0,this.registerColumnOption("mutator"),this.registerColumnOption("mutatorParams"),this.registerColumnOption("mutatorData"),this.registerColumnOption("mutatorDataParams"),this.registerColumnOption("mutatorEdit"),this.registerColumnOption("mutatorEditParams"),this.registerColumnOption("mutatorClipboard"),this.registerColumnOption("mutatorClipboardParams"),this.registerColumnOption("mutatorImport"),this.registerColumnOption("mutatorImportParams"),this.registerColumnOption("mutateLink")}initialize(){this.subscribe("cell-value-changing",this.transformCell.bind(this)),this.subscribe("cell-value-changed",this.mutateLink.bind(this)),this.subscribe("column-layout",this.initializeColumn.bind(this)),this.subscribe("row-data-init-before",this.rowDataChanged.bind(this)),this.subscribe("row-data-changing",this.rowDataChanged.bind(this))}rowDataChanged(e,i,r){return this.transformRow(i,"data",r)}initializeColumn(e){var i=!1,r={};this.allowedTypes.forEach(n=>{var a="mutator"+(n.charAt(0).toUpperCase()+n.slice(1)),s;e.definition[a]&&(s=this.lookupMutator(e.definition[a]),s&&(i=!0,r[a]={mutator:s,params:e.definition[a+"Params"]||{}}))}),i&&(e.modules.mutate=r)}lookupMutator(e){var i=!1;switch(typeof e){case"string":FD.mutators[e]?i=FD.mutators[e]:console.warn("Mutator Error - No such mutator found, ignoring: ",e);break;case"function":i=e;break}return i}transformRow(e,i,r){var n="mutator"+(i.charAt(0).toUpperCase()+i.slice(1)),a;return this.enabled&&this.table.columnManager.traverse(s=>{var o,l,u;s.modules.mutate&&(o=s.modules.mutate[n]||s.modules.mutate.mutator||!1,o&&(a=s.getFieldValue(typeof r<"u"?r:e),(i=="data"&&!r||typeof a<"u")&&(u=s.getComponent(),l=typeof o.params=="function"?o.params(a,e,i,u):o.params,s.setFieldValue(e,o.mutator(a,e,i,l,u)))))}),e}transformCell(e,i){if(e.column.modules.mutate){var r=e.column.modules.mutate.mutatorEdit||e.column.modules.mutate.mutator||!1,n={};if(r)return n=Object.assign(n,e.row.getData()),e.column.setFieldValue(n,i),r.mutator(i,n,"edit",r.params,e.getComponent())}return i}mutateLink(e){var i=e.column.definition.mutateLink;i&&(Array.isArray(i)||(i=[i]),i.forEach(r=>{var n=e.row.getCell(r);n&&n.setValue(n.getValue(),!0,!0)}))}enable(){this.enabled=!0}disable(){this.enabled=!1}}function zhe(t,e,i,r,n){var a=document.createElement("span"),s=document.createElement("span"),o=document.createElement("span"),l=document.createElement("span"),u=document.createElement("span"),c=document.createElement("span");return this.table.modules.localize.langBind("pagination|counter|showing",d=>{s.innerHTML=d}),this.table.modules.localize.langBind("pagination|counter|of",d=>{l.innerHTML=d}),this.table.modules.localize.langBind("pagination|counter|rows",d=>{c.innerHTML=d}),r?(o.innerHTML=" "+e+"-"+Math.min(e+t-1,r)+" ",u.innerHTML=" "+r+" ",a.appendChild(s),a.appendChild(o),a.appendChild(l),a.appendChild(u),a.appendChild(c)):(o.innerHTML=" 0 ",a.appendChild(s),a.appendChild(o),a.appendChild(c)),a}function qhe(t,e,i,r,n){var a=document.createElement("span"),s=document.createElement("span"),o=document.createElement("span"),l=document.createElement("span"),u=document.createElement("span"),c=document.createElement("span");return this.table.modules.localize.langBind("pagination|counter|showing",d=>{s.innerHTML=d}),o.innerHTML=" "+i+" ",this.table.modules.localize.langBind("pagination|counter|of",d=>{l.innerHTML=d}),u.innerHTML=" "+n+" ",this.table.modules.localize.langBind("pagination|counter|pages",d=>{c.innerHTML=d}),a.appendChild(s),a.appendChild(o),a.appendChild(l),a.appendChild(u),a.appendChild(c),a}var Yhe={rows:zhe,pages:qhe};class R1 extends si{static moduleName="page";static pageCounters=Yhe;constructor(e){super(e),this.mode="local",this.progressiveLoad=!1,this.element=null,this.pageCounterElement=null,this.pageCounter=null,this.size=0,this.page=1,this.count=5,this.max=1,this.remoteRowCountEstimate=null,this.initialLoad=!0,this.dataChanging=!1,this.pageSizes=[],this.registerTableOption("pagination",!1),this.registerTableOption("paginationMode","local"),this.registerTableOption("paginationSize",!1),this.registerTableOption("paginationInitialPage",1),this.registerTableOption("paginationCounter",!1),this.registerTableOption("paginationCounterElement",!1),this.registerTableOption("paginationButtonCount",5),this.registerTableOption("paginationSizeSelector",!1),this.registerTableOption("paginationElement",!1),this.registerTableOption("paginationAddRow","page"),this.registerTableOption("paginationOutOfRange",!1),this.registerTableOption("progressiveLoad",!1),this.registerTableOption("progressiveLoadDelay",0),this.registerTableOption("progressiveLoadScrollMargin",0),this.registerTableFunction("setMaxPage",this.setMaxPage.bind(this)),this.registerTableFunction("setPage",this.setPage.bind(this)),this.registerTableFunction("setPageToRow",this.userSetPageToRow.bind(this)),this.registerTableFunction("setPageSize",this.userSetPageSize.bind(this)),this.registerTableFunction("getPageSize",this.getPageSize.bind(this)),this.registerTableFunction("previousPage",this.previousPage.bind(this)),this.registerTableFunction("nextPage",this.nextPage.bind(this)),this.registerTableFunction("getPage",this.getPage.bind(this)),this.registerTableFunction("getPageMax",this.getPageMax.bind(this)),this.registerComponentFunction("row","pageTo",this.setPageToRow.bind(this))}initialize(){this.table.options.pagination?(this.subscribe("row-deleted",this.rowsUpdated.bind(this)),this.subscribe("row-added",this.rowsUpdated.bind(this)),this.subscribe("data-processed",this.initialLoadComplete.bind(this)),this.subscribe("table-built",this.calculatePageSizes.bind(this)),this.subscribe("footer-redraw",this.footerRedraw.bind(this)),this.table.options.paginationAddRow=="page"&&this.subscribe("row-adding-position",this.rowAddingPosition.bind(this)),this.table.options.paginationMode==="remote"&&(this.subscribe("data-params",this.remotePageParams.bind(this)),this.subscribe("data-loaded",this._parseRemoteData.bind(this))),this.table.options.progressiveLoad&&console.error("Progressive Load Error - Pagination and progressive load cannot be used at the same time"),this.registerDisplayHandler(this.restOnRenderBefore.bind(this),40),this.registerDisplayHandler(this.getRows.bind(this),50),this.createElements(),this.initializePageCounter(),this.initializePaginator()):this.table.options.progressiveLoad&&(this.subscribe("data-params",this.remotePageParams.bind(this)),this.subscribe("data-loaded",this._parseRemoteData.bind(this)),this.subscribe("table-built",this.calculatePageSizes.bind(this)),this.subscribe("data-processed",this.initialLoadComplete.bind(this)),this.initializeProgressive(this.table.options.progressiveLoad),this.table.options.progressiveLoad==="scroll"&&this.subscribe("scroll-vertical",this.scrollVertical.bind(this)))}rowAddingPosition(e,i){var r=this.table.rowManager,n=r.getDisplayRows(),a;return i?n.length?a=n[0]:r.activeRows.length&&(a=r.activeRows[r.activeRows.length-1],i=!1):n.length&&(a=n[n.length-1],i=!(n.length<this.size)),{index:a,top:i}}calculatePageSizes(){var e,i;this.table.options.paginationSize?this.size=this.table.options.paginationSize:(e=document.createElement("div"),e.classList.add("tabulator-row"),e.style.visibility="hidden",i=document.createElement("div"),i.classList.add("tabulator-cell"),i.innerHTML="Page Row Test",e.appendChild(i),this.table.rowManager.getTableElement().appendChild(e),this.size=Math.floor(this.table.rowManager.getElement().clientHeight/e.offsetHeight),this.table.rowManager.getTableElement().removeChild(e)),this.dispatchExternal("pageSizeChanged",this.size),this.generatePageSizeSelectList()}initialLoadComplete(){this.initialLoad=!1}remotePageParams(e,i,r,n){return this.initialLoad||(this.progressiveLoad&&!r||!this.progressiveLoad&&!this.dataChanging)&&this.reset(!0),n.page=this.page,this.size&&(n.size=this.size),n}userSetPageToRow(e){return this.table.options.pagination&&(e=this.table.rowManager.findRow(e),e)?this.setPageToRow(e):Promise.reject()}userSetPageSize(e){return this.table.options.pagination?(this.setPageSize(e),this.setPage(1)):!1}scrollVertical(e,i){var r,n,a;!i&&!this.table.dataLoader.loading&&(r=this.table.rowManager.getElement(),n=r.scrollHeight-r.clientHeight-e,a=this.table.options.progressiveLoadScrollMargin||r.clientHeight*2,n<a&&this.nextPage().catch(()=>{}))}restOnRenderBefore(e,i){return i||this.mode==="local"&&this.reset(),e}rowsUpdated(){this.refreshData(!0,"all")}createElements(){var e;this.element=document.createElement("span"),this.element.classList.add("tabulator-paginator"),this.pagesElement=document.createElement("span"),this.pagesElement.classList.add("tabulator-pages"),e=document.createElement("button"),e.classList.add("tabulator-page"),e.setAttribute("type","button"),e.setAttribute("role","button"),e.setAttribute("aria-label",""),e.setAttribute("title",""),this.firstBut=e.cloneNode(!0),this.firstBut.setAttribute("data-page","first"),this.prevBut=e.cloneNode(!0),this.prevBut.setAttribute("data-page","prev"),this.nextBut=e.cloneNode(!0),this.nextBut.setAttribute("data-page","next"),this.lastBut=e.cloneNode(!0),this.lastBut.setAttribute("data-page","last"),this.table.options.paginationSizeSelector&&(this.pageSizeSelect=document.createElement("select"),this.pageSizeSelect.classList.add("tabulator-page-size"))}generatePageSizeSelectList(){var e=[];if(this.pageSizeSelect){if(Array.isArray(this.table.options.paginationSizeSelector))e=this.table.options.paginationSizeSelector,this.pageSizes=e,this.pageSizes.indexOf(this.size)==-1&&e.unshift(this.size);else if(this.pageSizes.indexOf(this.size)==-1){e=[];for(let i=1;i<5;i++)e.push(this.size*i);this.pageSizes=e}else e=this.pageSizes;for(;this.pageSizeSelect.firstChild;)this.pageSizeSelect.removeChild(this.pageSizeSelect.firstChild);e.forEach(i=>{var r=document.createElement("option");r.value=i,i===!0?this.langBind("pagination|all",function(n){r.innerHTML=n}):r.innerHTML=i,this.pageSizeSelect.appendChild(r)}),this.pageSizeSelect.value=this.size}}initializePageCounter(){var e=this.table.options.paginationCounter,i=null;e&&(typeof e=="function"?i=e:i=R1.pageCounters[e],i?(this.pageCounter=i,this.pageCounterElement=document.createElement("span"),this.pageCounterElement.classList.add("tabulator-page-counter")):console.warn("Pagination Error - No such page counter found: ",e))}initializePaginator(e){var i,r;e||(this.langBind("pagination|first",n=>{this.firstBut.innerHTML=n}),this.langBind("pagination|first_title",n=>{this.firstBut.setAttribute("aria-label",n),this.firstBut.setAttribute("title",n)}),this.langBind("pagination|prev",n=>{this.prevBut.innerHTML=n}),this.langBind("pagination|prev_title",n=>{this.prevBut.setAttribute("aria-label",n),this.prevBut.setAttribute("title",n)}),this.langBind("pagination|next",n=>{this.nextBut.innerHTML=n}),this.langBind("pagination|next_title",n=>{this.nextBut.setAttribute("aria-label",n),this.nextBut.setAttribute("title",n)}),this.langBind("pagination|last",n=>{this.lastBut.innerHTML=n}),this.langBind("pagination|last_title",n=>{this.lastBut.setAttribute("aria-label",n),this.lastBut.setAttribute("title",n)}),this.firstBut.addEventListener("click",()=>{this.setPage(1)}),this.prevBut.addEventListener("click",()=>{this.previousPage()}),this.nextBut.addEventListener("click",()=>{this.nextPage()}),this.lastBut.addEventListener("click",()=>{this.setPage(this.max)}),this.table.options.paginationElement&&(this.element=this.table.options.paginationElement),this.pageSizeSelect&&(i=document.createElement("label"),this.langBind("pagination|page_size",n=>{this.pageSizeSelect.setAttribute("aria-label",n),this.pageSizeSelect.setAttribute("title",n),i.innerHTML=n}),this.element.appendChild(i),this.element.appendChild(this.pageSizeSelect),this.pageSizeSelect.addEventListener("change",n=>{this.setPageSize(this.pageSizeSelect.value=="true"?!0:this.pageSizeSelect.value),this.setPage(1)})),this.element.appendChild(this.firstBut),this.element.appendChild(this.prevBut),this.element.appendChild(this.pagesElement),this.element.appendChild(this.nextBut),this.element.appendChild(this.lastBut),this.table.options.paginationElement||(this.table.options.paginationCounter&&(this.table.options.paginationCounterElement?this.table.options.paginationCounterElement instanceof HTMLElement?this.table.options.paginationCounterElement.appendChild(this.pageCounterElement):typeof this.table.options.paginationCounterElement=="string"&&(r=document.querySelector(this.table.options.paginationCounterElement),r?r.appendChild(this.pageCounterElement):console.warn("Pagination Error - Unable to find element matching paginationCounterElement selector:",this.table.options.paginationCounterElement)):this.footerAppend(this.pageCounterElement)),this.footerAppend(this.element)),this.page=this.table.options.paginationInitialPage,this.count=this.table.options.paginationButtonCount),this.mode=this.table.options.paginationMode}initializeProgressive(e){this.initializePaginator(!0),this.mode="progressive_"+e,this.progressiveLoad=!0}trackChanges(){this.dispatch("page-changed")}setMaxRows(e){e?this.max=this.size===!0?1:Math.ceil(e/this.size):this.max=1,this.page>this.max&&(this.page=this.max)}reset(e){this.initialLoad||(this.mode=="local"||e)&&(this.page=1,this.trackChanges())}setMaxPage(e){e=parseInt(e),this.max=e||1,this.page>this.max&&(this.page=this.max,this.trigger())}setPage(e){switch(e){case"first":return this.setPage(1);case"prev":return this.previousPage();case"next":return this.nextPage();case"last":return this.setPage(this.max)}return e=parseInt(e),e>0&&e<=this.max||this.mode!=="local"?(this.page=e,this.trackChanges(),this.trigger()):(console.warn("Pagination Error - Requested page is out of range of 1 - "+this.max+":",e),Promise.reject())}setPageToRow(e){var i=this.displayRows(-1),r=i.indexOf(e);if(r>-1){var n=this.size===!0?1:Math.ceil((r+1)/this.size);return this.setPage(n)}else return console.warn("Pagination Error - Requested row is not visible"),Promise.reject()}setPageSize(e){e!==!0&&(e=parseInt(e)),e>0&&(this.size=e,this.dispatchExternal("pageSizeChanged",e)),this.pageSizeSelect&&this.generatePageSizeSelectList(),this.trackChanges()}_setPageCounter(e,i,r){var n;if(this.pageCounter)switch(this.mode==="remote"&&(i=this.size,r=(this.page-1)*this.size+1,e=this.remoteRowCountEstimate),n=this.pageCounter.call(this,i,r,this.page,e,this.max),typeof n){case"object":if(n instanceof Node){for(;this.pageCounterElement.firstChild;)this.pageCounterElement.removeChild(this.pageCounterElement.firstChild);this.pageCounterElement.appendChild(n)}else this.pageCounterElement.innerHTML="",n!=null&&console.warn("Page Counter Error - Page Counter has returned a type of object, the only valid page counter object return is an instance of Node, the page counter returned:",n);break;case"undefined":this.pageCounterElement.innerHTML="";break;default:this.pageCounterElement.innerHTML=n}}_setPageButtons(){let e=Math.floor((this.count-1)/2),i=Math.ceil((this.count-1)/2),r=this.max-this.page+e+1<this.count?this.max-this.count+1:Math.max(this.page-e,1),n=this.page<=i?Math.min(this.count,this.max):Math.min(this.page+i,this.max);for(;this.pagesElement.firstChild;)this.pagesElement.removeChild(this.pagesElement.firstChild);this.page==1?(this.firstBut.disabled=!0,this.prevBut.disabled=!0):(this.firstBut.disabled=!1,this.prevBut.disabled=!1),this.page==this.max?(this.lastBut.disabled=!0,this.nextBut.disabled=!0):(this.lastBut.disabled=!1,this.nextBut.disabled=!1);for(let a=r;a<=n;a++)a>0&&a<=this.max&&this.pagesElement.appendChild(this._generatePageButton(a));this.footerRedraw()}_generatePageButton(e){var i=document.createElement("button");return i.classList.add("tabulator-page"),e==this.page&&i.classList.add("active"),i.setAttribute("type","button"),i.setAttribute("role","button"),this.langBind("pagination|page_title",r=>{i.setAttribute("aria-label",r+" "+e),i.setAttribute("title",r+" "+e)}),i.setAttribute("data-page",e),i.textContent=e,i.addEventListener("click",r=>{this.setPage(e)}),i}previousPage(){return this.page>1?(this.page--,this.trackChanges(),this.trigger()):(console.warn("Pagination Error - Previous page would be less than page 1:",0),Promise.reject())}nextPage(){return this.page<this.max?(this.page++,this.trackChanges(),this.trigger()):(this.progressiveLoad||console.warn("Pagination Error - Next page would be greater than maximum page of "+this.max+":",this.max+1),Promise.reject())}getPage(){return this.page}getPageMax(){return this.max}getPageSize(e){return this.size}getMode(){return this.mode}getRows(e){var i=0,r,n,a,s,o=e.filter(l=>l.type==="row");if(this.mode=="local"){r=[],this.setMaxRows(e.length),this.size===!0?(n=0,a=e.length):(n=this.size*(this.page-1),a=n+parseInt(this.size)),this._setPageButtons();for(let l=n;l<a;l++){let u=e[l];u&&(r.push(u),u.type==="row"&&(s||(s=u),i++))}return this._setPageCounter(o.length,i,s?o.indexOf(s)+1:0),r}else return this._setPageButtons(),this._setPageCounter(o.length),e.slice(0)}trigger(){var e;switch(this.mode){case"local":return e=this.table.rowManager.scrollLeft,this.refreshData(),this.table.rowManager.scrollHorizontal(e),this.dispatchExternal("pageLoaded",this.getPage()),Promise.resolve();case"remote":return this.dataChanging=!0,this.reloadData(null).finally(()=>{this.dataChanging=!1});case"progressive_load":case"progressive_scroll":return this.reloadData(null,!0);default:return console.warn("Pagination Error - no such pagination mode:",this.mode),Promise.reject()}}_parseRemoteData(e){var i,r;if(typeof e.last_page>"u"&&console.warn("Remote Pagination Error - Server response missing '"+(this.options("dataReceiveParams").last_page||"last_page")+"' property"),e.data)if(this.max=parseInt(e.last_page)||1,this.remoteRowCountEstimate=typeof e.last_row<"u"?e.last_row:e.last_page*this.size-(this.page==e.last_page?this.size-e.data.length:0),this.progressiveLoad){switch(this.mode){case"progressive_load":this.page==1?this.table.rowManager.setData(e.data,!1,this.page==1):this.table.rowManager.addRows(e.data),this.page<this.max&&setTimeout(()=>{this.nextPage()},this.table.options.progressiveLoadDelay);break;case"progressive_scroll":e=this.page===1?e.data:this.table.rowManager.getData().concat(e.data),this.table.rowManager.setData(e,this.page!==1,this.page==1),i=this.table.options.progressiveLoadScrollMargin||this.table.rowManager.element.clientHeight*2,this.table.rowManager.element.scrollHeight<=this.table.rowManager.element.clientHeight+i&&this.page<this.max&&setTimeout(()=>{this.nextPage()});break}return!1}else{if(this.page>this.max&&(console.warn("Remote Pagination Error - Server returned last page value lower than the current page"),r=this.options("paginationOutOfRange"),r))return this.setPage(typeof r=="function"?r.call(this,this.page,this.max):r);this.dispatchExternal("pageLoaded",this.getPage())}else console.warn("Remote Pagination Error - Server response missing '"+(this.options("dataReceiveParams").data||"data")+"' property");return e.data}footerRedraw(){var e=this.table.footerManager.containerElement;Math.ceil(e.clientWidth)-e.scrollWidth<0?this.pagesElement.style.display="none":(this.pagesElement.style.display="",Math.ceil(e.clientWidth)-e.scrollWidth<0&&(this.pagesElement.style.display="none"))}}var Khe={local:function(t,e){var i=localStorage.getItem(t+"-"+e);return i?JSON.parse(i):!1},cookie:function(t,e){var i=document.cookie,r=t+"-"+e,n=i.indexOf(r+"="),a,s;return n>-1&&(i=i.slice(n),a=i.indexOf(";"),a>-1&&(i=i.slice(0,a)),s=i.replace(r+"=","")),s?JSON.parse(s):!1}},Xhe={local:function(t,e,i){localStorage.setItem(t+"-"+e,JSON.stringify(i))},cookie:function(t,e,i){var r=new Date;r.setDate(r.getDate()+1e4),document.cookie=t+"-"+e+"="+JSON.stringify(i)+"; expires="+r.toUTCString()}};class _u extends si{static moduleName="persistence";static moduleInitOrder=-10;static readers=Khe;static writers=Xhe;constructor(e){super(e),this.mode="",this.id="",this.defWatcherBlock=!1,this.config={},this.readFunc=!1,this.writeFunc=!1,this.registerTableOption("persistence",!1),this.registerTableOption("persistenceID",""),this.registerTableOption("persistenceMode",!0),this.registerTableOption("persistenceReaderFunc",!1),this.registerTableOption("persistenceWriterFunc",!1)}localStorageTest(){var e="_tabulator_test";try{return window.localStorage.setItem(e,e),window.localStorage.removeItem(e),!0}catch{return!1}}initialize(){if(this.table.options.persistence){var e=this.table.options.persistenceMode,i=this.table.options.persistenceID,r;this.mode=e!==!0?e:this.localStorageTest()?"local":"cookie",this.table.options.persistenceReaderFunc?typeof this.table.options.persistenceReaderFunc=="function"?this.readFunc=this.table.options.persistenceReaderFunc:_u.readers[this.table.options.persistenceReaderFunc]?this.readFunc=_u.readers[this.table.options.persistenceReaderFunc]:console.warn("Persistence Read Error - invalid reader set",this.table.options.persistenceReaderFunc):_u.readers[this.mode]?this.readFunc=_u.readers[this.mode]:console.warn("Persistence Read Error - invalid reader set",this.mode),this.table.options.persistenceWriterFunc?typeof this.table.options.persistenceWriterFunc=="function"?this.writeFunc=this.table.options.persistenceWriterFunc:_u.writers[this.table.options.persistenceWriterFunc]?this.writeFunc=_u.writers[this.table.options.persistenceWriterFunc]:console.warn("Persistence Write Error - invalid reader set",this.table.options.persistenceWriterFunc):_u.writers[this.mode]?this.writeFunc=_u.writers[this.mode]:console.warn("Persistence Write Error - invalid writer set",this.mode),this.id="tabulator-"+(i||this.table.element.getAttribute("id")||""),this.config={sort:this.table.options.persistence===!0||this.table.options.persistence.sort,filter:this.table.options.persistence===!0||this.table.options.persistence.filter,headerFilter:this.table.options.persistence===!0||this.table.options.persistence.headerFilter,group:this.table.options.persistence===!0||this.table.options.persistence.group,page:this.table.options.persistence===!0||this.table.options.persistence.page,columns:this.table.options.persistence===!0?["title","width","visible"]:this.table.options.persistence.columns},this.config.page&&(r=this.retrieveData("page"),r&&(typeof r.paginationSize<"u"&&(this.config.page===!0||this.config.page.size)&&(this.table.options.paginationSize=r.paginationSize),typeof r.paginationInitialPage<"u"&&(this.config.page===!0||this.config.page.page)&&(this.table.options.paginationInitialPage=r.paginationInitialPage))),this.config.group&&(r=this.retrieveData("group"),r&&(typeof r.groupBy<"u"&&(this.config.group===!0||this.config.group.groupBy)&&(this.table.options.groupBy=r.groupBy),typeof r.groupStartOpen<"u"&&(this.config.group===!0||this.config.group.groupStartOpen)&&(this.table.options.groupStartOpen=r.groupStartOpen),typeof r.groupHeader<"u"&&(this.config.group===!0||this.config.group.groupHeader)&&(this.table.options.groupHeader=r.groupHeader))),this.config.columns&&(this.table.options.columns=this.load("columns",this.table.options.columns),this.subscribe("column-init",this.initializeColumn.bind(this)),this.subscribe("column-show",this.save.bind(this,"columns")),this.subscribe("column-hide",this.save.bind(this,"columns")),this.subscribe("column-moved",this.save.bind(this,"columns"))),this.subscribe("table-built",this.tableBuilt.bind(this),0),this.subscribe("table-redraw",this.tableRedraw.bind(this)),this.subscribe("filter-changed",this.eventSave.bind(this,"filter")),this.subscribe("filter-changed",this.eventSave.bind(this,"headerFilter")),this.subscribe("sort-changed",this.eventSave.bind(this,"sort")),this.subscribe("group-changed",this.eventSave.bind(this,"group")),this.subscribe("page-changed",this.eventSave.bind(this,"page")),this.subscribe("column-resized",this.eventSave.bind(this,"columns")),this.subscribe("column-width",this.eventSave.bind(this,"columns")),this.subscribe("layout-refreshed",this.eventSave.bind(this,"columns"))}this.registerTableFunction("getColumnLayout",this.getColumnLayout.bind(this)),this.registerTableFunction("setColumnLayout",this.setColumnLayout.bind(this))}eventSave(e){this.config[e]&&this.save(e)}tableBuilt(){var e,i,r;this.config.sort&&(e=this.load("sort"),e&&(this.table.options.initialSort=e)),this.config.filter&&(i=this.load("filter"),i&&(this.table.options.initialFilter=i)),this.config.headerFilter&&(r=this.load("headerFilter"),r&&(this.table.options.initialHeaderFilter=r))}tableRedraw(e){e&&this.config.columns&&this.save("columns")}getColumnLayout(){return this.parseColumns(this.table.columnManager.getColumns())}setColumnLayout(e){return this.table.columnManager.setColumns(this.mergeDefinition(this.table.options.columns,e,!0)),!0}initializeColumn(e){var i,r;this.config.columns&&(this.defWatcherBlock=!0,i=e.getDefinition(),r=this.config.columns===!0?Object.keys(i):this.config.columns,r.forEach(n=>{var a=Object.getOwnPropertyDescriptor(i,n),s=i[n];a&&Object.defineProperty(i,n,{set:o=>{s=o,this.defWatcherBlock||this.save("columns"),a.set&&a.set(o)},get:()=>(a.get&&a.get(),s)})}),this.defWatcherBlock=!1)}load(e,i){var r=this.retrieveData(e);return i&&(r=r?this.mergeDefinition(i,r):i),r}retrieveData(e){return this.readFunc?this.readFunc(this.id,e):!1}mergeDefinition(e,i,r){var n=[];return i=i||[],i.forEach((a,s)=>{var o=this._findColumn(e,a),l;o&&(r?l=Object.keys(a):this.config.columns===!0||this.config.columns==null?(l=Object.keys(o),l.push("width")):l=this.config.columns,l.forEach(u=>{u!=="columns"&&typeof a[u]<"u"&&(o[u]=a[u])}),o.columns&&(o.columns=this.mergeDefinition(o.columns,a.columns)),n.push(o))}),e.forEach((a,s)=>{var o=this._findColumn(i,a);o||(n.length>s?n.splice(s,0,a):n.push(a))}),n}_findColumn(e,i){var r=i.columns?"group":i.field?"field":"object";return e.find(function(n){switch(r){case"group":return n.title===i.title&&n.columns.length===i.columns.length;case"field":return n.field===i.field;case"object":return n===i}})}save(e){var i={};switch(e){case"columns":i=this.parseColumns(this.table.columnManager.getColumns());break;case"filter":i=this.table.modules.filter.getFilters();break;case"headerFilter":i=this.table.modules.filter.getHeaderFilters();break;case"sort":i=this.validateSorters(this.table.modules.sort.getSort());break;case"group":i=this.getGroupConfig();break;case"page":i=this.getPageConfig();break}this.writeFunc&&this.writeFunc(this.id,e,i)}validateSorters(e){return e.forEach(function(i){i.column=i.field,delete i.field}),e}getGroupConfig(){var e={};return this.config.group&&((this.config.group===!0||this.config.group.groupBy)&&(e.groupBy=this.table.options.groupBy),(this.config.group===!0||this.config.group.groupStartOpen)&&(e.groupStartOpen=this.table.options.groupStartOpen),(this.config.group===!0||this.config.group.groupHeader)&&(e.groupHeader=this.table.options.groupHeader)),e}getPageConfig(){var e={};return this.config.page&&((this.config.page===!0||this.config.page.size)&&(e.paginationSize=this.table.modules.page.getPageSize()),(this.config.page===!0||this.config.page.page)&&(e.paginationInitialPage=this.table.modules.page.getPage())),e}parseColumns(e){var i=[],r=["headerContextMenu","headerMenu","contextMenu","clickMenu"];return e.forEach(n=>{var a={},s=n.getDefinition(),o;n.isGroup?(a.title=s.title,a.columns=this.parseColumns(n.getColumns())):(a.field=n.getField(),this.config.columns===!0||this.config.columns==null?(o=Object.keys(s),o.push("width"),o.push("visible")):o=this.config.columns,o.forEach(l=>{switch(l){case"width":a.width=n.getWidth();break;case"visible":a.visible=n.visible;break;default:typeof s[l]!="function"&&r.indexOf(l)===-1&&(a[l]=s[l])}})),i.push(a)}),i}}class Jhe extends si{static moduleName="popup";constructor(e){super(e),this.columnSubscribers={},this.registerTableOption("rowContextPopup",!1),this.registerTableOption("rowClickPopup",!1),this.registerTableOption("rowDblClickPopup",!1),this.registerTableOption("groupContextPopup",!1),this.registerTableOption("groupClickPopup",!1),this.registerTableOption("groupDblClickPopup",!1),this.registerColumnOption("headerContextPopup"),this.registerColumnOption("headerClickPopup"),this.registerColumnOption("headerDblClickPopup"),this.registerColumnOption("headerPopup"),this.registerColumnOption("headerPopupIcon"),this.registerColumnOption("contextPopup"),this.registerColumnOption("clickPopup"),this.registerColumnOption("dblClickPopup"),this.registerComponentFunction("cell","popup",this._componentPopupCall.bind(this)),this.registerComponentFunction("column","popup",this._componentPopupCall.bind(this)),this.registerComponentFunction("row","popup",this._componentPopupCall.bind(this)),this.registerComponentFunction("group","popup",this._componentPopupCall.bind(this))}initialize(){this.initializeRowWatchers(),this.initializeGroupWatchers(),this.subscribe("column-init",this.initializeColumn.bind(this))}_componentPopupCall(e,i,r){this.loadPopupEvent(i,null,e,r)}initializeRowWatchers(){this.table.options.rowContextPopup&&(this.subscribe("row-contextmenu",this.loadPopupEvent.bind(this,this.table.options.rowContextPopup)),this.table.on("rowTapHold",this.loadPopupEvent.bind(this,this.table.options.rowContextPopup))),this.table.options.rowClickPopup&&this.subscribe("row-click",this.loadPopupEvent.bind(this,this.table.options.rowClickPopup)),this.table.options.rowDblClickPopup&&this.subscribe("row-dblclick",this.loadPopupEvent.bind(this,this.table.options.rowDblClickPopup))}initializeGroupWatchers(){this.table.options.groupContextPopup&&(this.subscribe("group-contextmenu",this.loadPopupEvent.bind(this,this.table.options.groupContextPopup)),this.table.on("groupTapHold",this.loadPopupEvent.bind(this,this.table.options.groupContextPopup))),this.table.options.groupClickPopup&&this.subscribe("group-click",this.loadPopupEvent.bind(this,this.table.options.groupClickPopup)),this.table.options.groupDblClickPopup&&this.subscribe("group-dblclick",this.loadPopupEvent.bind(this,this.table.options.groupDblClickPopup))}initializeColumn(e){var i=e.definition;i.headerContextPopup&&!this.columnSubscribers.headerContextPopup&&(this.columnSubscribers.headerContextPopup=this.loadPopupTableColumnEvent.bind(this,"headerContextPopup"),this.subscribe("column-contextmenu",this.columnSubscribers.headerContextPopup),this.table.on("headerTapHold",this.loadPopupTableColumnEvent.bind(this,"headerContextPopup"))),i.headerClickPopup&&!this.columnSubscribers.headerClickPopup&&(this.columnSubscribers.headerClickPopup=this.loadPopupTableColumnEvent.bind(this,"headerClickPopup"),this.subscribe("column-click",this.columnSubscribers.headerClickPopup)),i.headerDblClickPopup&&!this.columnSubscribers.headerDblClickPopup&&(this.columnSubscribers.headerDblClickPopup=this.loadPopupTableColumnEvent.bind(this,"headerDblClickPopup"),this.subscribe("column-dblclick",this.columnSubscribers.headerDblClickPopup)),i.headerPopup&&this.initializeColumnHeaderPopup(e),i.contextPopup&&!this.columnSubscribers.contextPopup&&(this.columnSubscribers.contextPopup=this.loadPopupTableCellEvent.bind(this,"contextPopup"),this.subscribe("cell-contextmenu",this.columnSubscribers.contextPopup),this.table.on("cellTapHold",this.loadPopupTableCellEvent.bind(this,"contextPopup"))),i.clickPopup&&!this.columnSubscribers.clickPopup&&(this.columnSubscribers.clickPopup=this.loadPopupTableCellEvent.bind(this,"clickPopup"),this.subscribe("cell-click",this.columnSubscribers.clickPopup)),i.dblClickPopup&&!this.columnSubscribers.dblClickPopup&&(this.columnSubscribers.dblClickPopup=this.loadPopupTableCellEvent.bind(this,"dblClickPopup"),this.subscribe("cell-click",this.columnSubscribers.dblClickPopup))}initializeColumnHeaderPopup(e){var i=e.definition.headerPopupIcon,r;r=document.createElement("span"),r.classList.add("tabulator-header-popup-button"),i?(typeof i=="function"&&(i=i(e.getComponent())),i instanceof HTMLElement?r.appendChild(i):r.innerHTML=i):r.innerHTML="&vellip;",r.addEventListener("click",n=>{n.stopPropagation(),n.preventDefault(),this.loadPopupEvent(e.definition.headerPopup,n,e)}),e.titleElement.insertBefore(r,e.titleElement.firstChild)}loadPopupTableCellEvent(e,i,r){r._cell&&(r=r._cell),r.column.definition[e]&&this.loadPopupEvent(r.column.definition[e],i,r)}loadPopupTableColumnEvent(e,i,r){r._column&&(r=r._column),r.definition[e]&&this.loadPopupEvent(r.definition[e],i,r)}loadPopupEvent(e,i,r,n){var a;function s(o){a=o}r._group?r=r._group:r._row&&(r=r._row),e=typeof e=="function"?e.call(this.table,i,r.getComponent(),s):e,this.loadPopup(i,r,e,a,n)}loadPopup(e,i,r,n,a){var s=!(e instanceof MouseEvent),o,l;r instanceof HTMLElement?o=r:(o=document.createElement("div"),o.innerHTML=r),o.classList.add("tabulator-popup"),o.addEventListener("click",u=>{u.stopPropagation()}),s||e.preventDefault(),l=this.popup(o),typeof n=="function"&&l.renderCallback(n),e?l.show(e):l.show(i.getElement(),a||"center"),l.hideOnBlur(()=>{this.dispatchExternal("popupClosed",i.getComponent())}),this.dispatchExternal("popupOpened",i.getComponent())}}class Qhe extends si{static moduleName="print";constructor(e){super(e),this.element=!1,this.manualBlock=!1,this.beforeprintEventHandler=null,this.afterprintEventHandler=null,this.registerTableOption("printAsHtml",!1),this.registerTableOption("printFormatter",!1),this.registerTableOption("printHeader",!1),this.registerTableOption("printFooter",!1),this.registerTableOption("printStyled",!0),this.registerTableOption("printRowRange","visible"),this.registerTableOption("printConfig",{}),this.registerColumnOption("print"),this.registerColumnOption("titlePrint")}initialize(){this.table.options.printAsHtml&&(this.beforeprintEventHandler=this.replaceTable.bind(this),this.afterprintEventHandler=this.cleanup.bind(this),window.addEventListener("beforeprint",this.beforeprintEventHandler),window.addEventListener("afterprint",this.afterprintEventHandler),this.subscribe("table-destroy",this.destroy.bind(this))),this.registerTableFunction("print",this.printFullscreen.bind(this))}destroy(){this.table.options.printAsHtml&&(window.removeEventListener("beforeprint",this.beforeprintEventHandler),window.removeEventListener("afterprint",this.afterprintEventHandler))}replaceTable(){this.manualBlock||(this.element=document.createElement("div"),this.element.classList.add("tabulator-print-table"),this.element.appendChild(this.table.modules.export.generateTable(this.table.options.printConfig,this.table.options.printStyled,this.table.options.printRowRange,"print")),this.table.element.style.display="none",this.table.element.parentNode.insertBefore(this.element,this.table.element))}cleanup(){document.body.classList.remove("tabulator-print-fullscreen-hide"),this.element&&this.element.parentNode&&(this.element.parentNode.removeChild(this.element),this.table.element.style.display="")}printFullscreen(e,i,r){var n=window.scrollX,a=window.scrollY,s=document.createElement("div"),o=document.createElement("div"),l=this.table.modules.export.generateTable(typeof r<"u"?r:this.table.options.printConfig,typeof i<"u"?i:this.table.options.printStyled,e||this.table.options.printRowRange,"print"),u,c;this.manualBlock=!0,this.element=document.createElement("div"),this.element.classList.add("tabulator-print-fullscreen"),this.table.options.printHeader&&(s.classList.add("tabulator-print-header"),u=typeof this.table.options.printHeader=="function"?this.table.options.printHeader.call(this.table):this.table.options.printHeader,typeof u=="string"?s.innerHTML=u:s.appendChild(u),this.element.appendChild(s)),this.element.appendChild(l),this.table.options.printFooter&&(o.classList.add("tabulator-print-footer"),c=typeof this.table.options.printFooter=="function"?this.table.options.printFooter.call(this.table):this.table.options.printFooter,typeof c=="string"?o.innerHTML=c:o.appendChild(c),this.element.appendChild(o)),document.body.classList.add("tabulator-print-fullscreen-hide"),document.body.appendChild(this.element),this.table.options.printFormatter&&this.table.options.printFormatter(this.element,l),window.print(),this.cleanup(),window.scrollTo(n,a),this.manualBlock=!1}}class Zhe extends si{static moduleName="reactiveData";constructor(e){super(e),this.data=!1,this.blocked=!1,this.origFuncs={},this.currentVersion=0,this.registerTableOption("reactiveData",!1)}initialize(){this.table.options.reactiveData&&(this.subscribe("cell-value-save-before",this.block.bind(this,"cellsave")),this.subscribe("cell-value-save-after",this.unblock.bind(this,"cellsave")),this.subscribe("row-data-save-before",this.block.bind(this,"rowsave")),this.subscribe("row-data-save-after",this.unblock.bind(this,"rowsave")),this.subscribe("row-data-init-after",this.watchRow.bind(this)),this.subscribe("data-processing",this.watchData.bind(this)),this.subscribe("table-destroy",this.unwatchData.bind(this)))}watchData(e){var i=this,r;this.currentVersion++,r=this.currentVersion,this.unwatchData(),this.data=e,this.origFuncs.push=e.push,Object.defineProperty(this.data,"push",{enumerable:!1,configurable:!0,value:function(){var n=Array.from(arguments),a;return!i.blocked&&r===i.currentVersion&&(i.block("data-push"),n.forEach(s=>{i.table.rowManager.addRowActual(s,!1)}),a=i.origFuncs.push.apply(e,arguments),i.unblock("data-push")),a}}),this.origFuncs.unshift=e.unshift,Object.defineProperty(this.data,"unshift",{enumerable:!1,configurable:!0,value:function(){var n=Array.from(arguments),a;return!i.blocked&&r===i.currentVersion&&(i.block("data-unshift"),n.forEach(s=>{i.table.rowManager.addRowActual(s,!0)}),a=i.origFuncs.unshift.apply(e,arguments),i.unblock("data-unshift")),a}}),this.origFuncs.shift=e.shift,Object.defineProperty(this.data,"shift",{enumerable:!1,configurable:!0,value:function(){var n,a;return!i.blocked&&r===i.currentVersion&&(i.block("data-shift"),i.data.length&&(n=i.table.rowManager.getRowFromDataObject(i.data[0]),n&&n.deleteActual()),a=i.origFuncs.shift.call(e),i.unblock("data-shift")),a}}),this.origFuncs.pop=e.pop,Object.defineProperty(this.data,"pop",{enumerable:!1,configurable:!0,value:function(){var n,a;return!i.blocked&&r===i.currentVersion&&(i.block("data-pop"),i.data.length&&(n=i.table.rowManager.getRowFromDataObject(i.data[i.data.length-1]),n&&n.deleteActual()),a=i.origFuncs.pop.call(e),i.unblock("data-pop")),a}}),this.origFuncs.splice=e.splice,Object.defineProperty(this.data,"splice",{enumerable:!1,configurable:!0,value:function(){var n=Array.from(arguments),a=n[0]<0?e.length+n[0]:n[0],s=n[1],o=n[2]?n.slice(2):!1,l,u;if(!i.blocked&&r===i.currentVersion){if(i.block("data-splice"),o&&(l=e[a]?i.table.rowManager.getRowFromDataObject(e[a]):!1,l?o.forEach(d=>{i.table.rowManager.addRowActual(d,!0,l,!0)}):(o=o.slice().reverse(),o.forEach(d=>{i.table.rowManager.addRowActual(d,!0,!1,!0)}))),s!==0){var c=e.slice(a,typeof n[1]>"u"?n[1]:a+s);c.forEach((d,p)=>{var f=i.table.rowManager.getRowFromDataObject(d);f&&f.deleteActual(p!==c.length-1)})}(o||s!==0)&&i.table.rowManager.reRenderInPosition(),u=i.origFuncs.splice.apply(e,arguments),i.unblock("data-splice")}return u}})}unwatchData(){if(this.data!==!1)for(var e in this.origFuncs)Object.defineProperty(this.data,e,{enumerable:!0,configurable:!0,writable:!0,value:this.origFuncs.key})}watchRow(e){var i=e.getData();for(var r in i)this.watchKey(e,i,r);this.table.options.dataTree&&this.watchTreeChildren(e)}watchTreeChildren(e){var i=this,r=e.getData()[this.table.options.dataTreeChildField],n={};r&&(n.push=r.push,Object.defineProperty(r,"push",{enumerable:!1,configurable:!0,value:()=>{if(!i.blocked){i.block("tree-push");var a=n.push.apply(r,arguments);this.rebuildTree(e),i.unblock("tree-push")}return a}}),n.unshift=r.unshift,Object.defineProperty(r,"unshift",{enumerable:!1,configurable:!0,value:()=>{if(!i.blocked){i.block("tree-unshift");var a=n.unshift.apply(r,arguments);this.rebuildTree(e),i.unblock("tree-unshift")}return a}}),n.shift=r.shift,Object.defineProperty(r,"shift",{enumerable:!1,configurable:!0,value:()=>{if(!i.blocked){i.block("tree-shift");var a=n.shift.call(r);this.rebuildTree(e),i.unblock("tree-shift")}return a}}),n.pop=r.pop,Object.defineProperty(r,"pop",{enumerable:!1,configurable:!0,value:()=>{if(!i.blocked){i.block("tree-pop");var a=n.pop.call(r);this.rebuildTree(e),i.unblock("tree-pop")}return a}}),n.splice=r.splice,Object.defineProperty(r,"splice",{enumerable:!1,configurable:!0,value:()=>{if(!i.blocked){i.block("tree-splice");var a=n.splice.apply(r,arguments);this.rebuildTree(e),i.unblock("tree-splice")}return a}}))}rebuildTree(e){this.table.modules.dataTree.initializeRow(e),this.table.modules.dataTree.layoutRow(e),this.table.rowManager.refreshActiveData("tree",!1,!0)}watchKey(e,i,r){var n=this,a=Object.getOwnPropertyDescriptor(i,r),s=i[r],o=this.currentVersion;Object.defineProperty(i,r,{set:l=>{if(s=l,!n.blocked&&o===n.currentVersion){n.block("key");var u={};u[r]=l,e.updateData(u),n.unblock("key")}a.set&&a.set(l)},get:()=>(a.get&&a.get(),s)})}unwatchRow(e){var i=e.getData();for(var r in i)Object.defineProperty(i,r,{value:i[r]})}block(e){this.blocked||(this.blocked=e)}unblock(e){this.blocked===e&&(this.blocked=!1)}}class ege extends si{static moduleName="resizeColumns";constructor(e){super(e),this.startColumn=!1,this.startX=!1,this.startWidth=!1,this.latestX=!1,this.handle=null,this.initialNextColumn=null,this.nextColumn=null,this.initialized=!1,this.registerColumnOption("resizable",!0),this.registerTableOption("resizableColumnFit",!1),this.registerTableOption("resizableColumnGuide",!1)}initialize(){this.subscribe("column-rendered",this.layoutColumnHeader.bind(this))}initializeEventWatchers(){this.initialized||(this.subscribe("cell-rendered",this.layoutCellHandles.bind(this)),this.subscribe("cell-delete",this.deInitializeComponent.bind(this)),this.subscribe("cell-height",this.resizeHandle.bind(this)),this.subscribe("column-moved",this.columnLayoutUpdated.bind(this)),this.subscribe("column-hide",this.deInitializeColumn.bind(this)),this.subscribe("column-show",this.columnLayoutUpdated.bind(this)),this.subscribe("column-width",this.columnWidthUpdated.bind(this)),this.subscribe("column-delete",this.deInitializeComponent.bind(this)),this.subscribe("column-height",this.resizeHandle.bind(this)),this.initialized=!0)}layoutCellHandles(e){e.row.type==="row"&&(this.deInitializeComponent(e),this.initializeColumn("cell",e,e.column,e.element))}layoutColumnHeader(e){e.definition.resizable&&(this.initializeEventWatchers(),this.deInitializeComponent(e),this.initializeColumn("header",e,e,e.element))}columnLayoutUpdated(e){var i=e.prevColumn();this.reinitializeColumn(e),i&&this.reinitializeColumn(i)}columnWidthUpdated(e){e.modules.frozen&&(this.table.modules.frozenColumns.leftColumns.includes(e)?this.table.modules.frozenColumns.leftColumns.forEach(i=>{this.reinitializeColumn(i)}):this.table.modules.frozenColumns.rightColumns.includes(e)&&this.table.modules.frozenColumns.rightColumns.forEach(i=>{this.reinitializeColumn(i)}))}frozenColumnOffset(e){var i=!1;return e.modules.frozen&&(i=e.modules.frozen.marginValue,e.modules.frozen.position==="left"?i+=e.getWidth()-3:i&&(i-=3)),i!==!1?i+"px":!1}reinitializeColumn(e){var i=this.frozenColumnOffset(e);e.cells.forEach(r=>{r.modules.resize&&r.modules.resize.handleEl&&(i&&(r.modules.resize.handleEl.style[e.modules.frozen.position]=i,r.modules.resize.handleEl.style["z-index"]=11),r.element.after(r.modules.resize.handleEl))}),e.modules.resize&&e.modules.resize.handleEl&&(i&&(e.modules.resize.handleEl.style[e.modules.frozen.position]=i),e.element.after(e.modules.resize.handleEl))}initializeColumn(e,i,r,n){var a=this,s=!1,o=r.definition.resizable,l={},u=r.getLastColumn();if(e==="header"&&(s=r.definition.formatter=="textarea"||r.definition.variableHeight,l={variableHeight:s}),(o===!0||o==e)&&this._checkResizability(u)){var c=document.createElement("span");c.className="tabulator-col-resize-handle",c.addEventListener("click",function(p){p.stopPropagation()});var d=function(p){a.startColumn=r,a.initialNextColumn=a.nextColumn=u.nextColumn(),a._mouseDown(p,u,c)};c.addEventListener("mousedown",d),c.addEventListener("touchstart",d,{passive:!0}),c.addEventListener("dblclick",p=>{var f=u.getWidth();p.stopPropagation(),u.reinitializeWidth(!0),f!==u.getWidth()&&(a.dispatch("column-resized",u),a.dispatchExternal("columnResized",u.getComponent()))}),r.modules.frozen&&(c.style.position="sticky",c.style[r.modules.frozen.position]=this.frozenColumnOffset(r)),l.handleEl=c,n.parentNode&&r.visible&&n.after(c)}i.modules.resize=l}deInitializeColumn(e){this.deInitializeComponent(e),e.cells.forEach(i=>{this.deInitializeComponent(i)})}deInitializeComponent(e){var i;e.modules.resize&&(i=e.modules.resize.handleEl,i&&i.parentElement&&i.parentElement.removeChild(i))}resizeHandle(e,i){e.modules.resize&&e.modules.resize.handleEl&&(e.modules.resize.handleEl.style.height=i)}resize(e,i){var r=typeof e.clientX>"u"?e.touches[0].clientX:e.clientX,n=r-this.startX,a=r-this.latestX,s,o;if(this.latestX=r,this.table.rtl&&(n=-n,a=-a),s=i.width==i.minWidth||i.width==i.maxWidth,i.setWidth(this.startWidth+n),o=i.width==i.minWidth||i.width==i.maxWidth,a<0&&(this.nextColumn=this.initialNextColumn),this.table.options.resizableColumnFit&&this.nextColumn&&!(s&&o)){let l=this.nextColumn.getWidth();a>0&&l<=this.nextColumn.minWidth&&(this.nextColumn=this.nextColumn.nextColumn()),this.nextColumn&&this.nextColumn.setWidth(this.nextColumn.getWidth()-a)}this.table.columnManager.rerenderColumns(!0),!this.table.browserSlow&&i.modules.resize&&i.modules.resize.variableHeight&&i.checkCellHeights()}calcGuidePosition(e,i,r){var n=typeof e.clientX>"u"?e.touches[0].clientX:e.clientX,a=r.getBoundingClientRect().x-this.table.element.getBoundingClientRect().x,s=this.table.element.getBoundingClientRect().x,o=i.element.getBoundingClientRect().left-s,l=n-this.startX,u=Math.max(a+l,o+i.minWidth);return i.maxWidth&&(u=Math.min(u,o+i.maxWidth)),u}_checkResizability(e){return e.definition.resizable}_mouseDown(e,i,r){var n=this,a;this.dispatchExternal("columnResizing",i.getComponent()),n.table.options.resizableColumnGuide&&(a=document.createElement("span"),a.classList.add("tabulator-col-resize-guide"),n.table.element.appendChild(a),setTimeout(()=>{a.style.left=n.calcGuidePosition(e,i,r)+"px"})),n.table.element.classList.add("tabulator-block-select");function s(l){n.table.options.resizableColumnGuide?a.style.left=n.calcGuidePosition(l,i,r)+"px":n.resize(l,i)}function o(l){n.table.options.resizableColumnGuide&&(n.resize(l,i),a.remove()),n.startColumn.modules.edit&&(n.startColumn.modules.edit.blocked=!1),n.table.browserSlow&&i.modules.resize&&i.modules.resize.variableHeight&&i.checkCellHeights(),document.body.removeEventListener("mouseup",o),document.body.removeEventListener("mousemove",s),r.removeEventListener("touchmove",s),r.removeEventListener("touchend",o),n.table.element.classList.remove("tabulator-block-select"),n.startWidth!==i.getWidth()&&(n.table.columnManager.verticalAlignHeaders(),n.dispatch("column-resized",i),n.dispatchExternal("columnResized",i.getComponent()))}e.stopPropagation(),n.startColumn.modules.edit&&(n.startColumn.modules.edit.blocked=!0),n.startX=typeof e.clientX>"u"?e.touches[0].clientX:e.clientX,n.latestX=n.startX,n.startWidth=i.getWidth(),document.body.addEventListener("mousemove",s),document.body.addEventListener("mouseup",o),r.addEventListener("touchmove",s,{passive:!0}),r.addEventListener("touchend",o)}}class tge extends si{static moduleName="resizeRows";constructor(e){super(e),this.startColumn=!1,this.startY=!1,this.startHeight=!1,this.handle=null,this.prevHandle=null,this.registerTableOption("resizableRows",!1),this.registerTableOption("resizableRowGuide",!1)}initialize(){this.table.options.resizableRows&&this.subscribe("row-layout-after",this.initializeRow.bind(this))}initializeRow(e){var i=this,r=e.getElement(),n=document.createElement("div");n.className="tabulator-row-resize-handle";var a=document.createElement("div");a.className="tabulator-row-resize-handle prev",n.addEventListener("click",function(l){l.stopPropagation()});var s=function(l){i.startRow=e,i._mouseDown(l,e,n)};n.addEventListener("mousedown",s),n.addEventListener("touchstart",s,{passive:!0}),a.addEventListener("click",function(l){l.stopPropagation()});var o=function(l){var u=i.table.rowManager.prevDisplayRow(e);u&&(i.startRow=u,i._mouseDown(l,u,a))};a.addEventListener("mousedown",o),a.addEventListener("touchstart",o,{passive:!0}),r.appendChild(n),r.appendChild(a)}resize(e,i){i.setHeight(this.startHeight+((typeof e.screenY>"u"?e.touches[0].screenY:e.screenY)-this.startY))}calcGuidePosition(e,i,r){var n=typeof e.screenY>"u"?e.touches[0].screenY:e.screenY,a=r.getBoundingClientRect().y-this.table.element.getBoundingClientRect().y,s=this.table.element.getBoundingClientRect().y,o=i.element.getBoundingClientRect().top-s,l=n-this.startY;return Math.max(a+l,o)}_mouseDown(e,i,r){var n=this,a;n.dispatchExternal("rowResizing",i.getComponent()),n.table.options.resizableRowGuide&&(a=document.createElement("span"),a.classList.add("tabulator-row-resize-guide"),n.table.element.appendChild(a),setTimeout(()=>{a.style.top=n.calcGuidePosition(e,i,r)+"px"})),n.table.element.classList.add("tabulator-block-select");function s(l){n.table.options.resizableRowGuide?a.style.top=n.calcGuidePosition(l,i,r)+"px":n.resize(l,i)}function o(l){n.table.options.resizableRowGuide&&(n.resize(l,i),a.remove()),document.body.removeEventListener("mouseup",s),document.body.removeEventListener("mousemove",s),r.removeEventListener("touchmove",s),r.removeEventListener("touchend",o),n.table.element.classList.remove("tabulator-block-select"),n.dispatchExternal("rowResized",i.getComponent())}e.stopPropagation(),n.startY=typeof e.screenY>"u"?e.touches[0].screenY:e.screenY,n.startHeight=i.getHeight(),document.body.addEventListener("mousemove",s),document.body.addEventListener("mouseup",o),r.addEventListener("touchmove",s,{passive:!0}),r.addEventListener("touchend",o)}}class ige extends si{static moduleName="resizeTable";constructor(e){super(e),this.binding=!1,this.visibilityObserver=!1,this.resizeObserver=!1,this.containerObserver=!1,this.tableHeight=0,this.tableWidth=0,this.containerHeight=0,this.containerWidth=0,this.autoResize=!1,this.visible=!1,this.initialized=!1,this.initialRedraw=!1,this.registerTableOption("autoResize",!0)}initialize(){if(this.table.options.autoResize){var e=this.table,i;this.tableHeight=e.element.clientHeight,this.tableWidth=e.element.clientWidth,e.element.parentNode&&(this.containerHeight=e.element.parentNode.clientHeight,this.containerWidth=e.element.parentNode.clientWidth),typeof IntersectionObserver<"u"&&typeof ResizeObserver<"u"&&e.rowManager.getRenderMode()==="virtual"?(this.initializeVisibilityObserver(),this.autoResize=!0,this.resizeObserver=new ResizeObserver(r=>{if(!e.browserMobile||e.browserMobile&&(!e.modules.edit||e.modules.edit&&!e.modules.edit.currentCell)){var n=Math.floor(r[0].contentRect.height),a=Math.floor(r[0].contentRect.width);(this.tableHeight!=n||this.tableWidth!=a)&&(this.tableHeight=n,this.tableWidth=a,e.element.parentNode&&(this.containerHeight=e.element.parentNode.clientHeight,this.containerWidth=e.element.parentNode.clientWidth),this.redrawTable())}}),this.resizeObserver.observe(e.element),i=window.getComputedStyle(e.element),this.table.element.parentNode&&!this.table.rowManager.fixedHeight&&(i.getPropertyValue("max-height")||i.getPropertyValue("min-height"))&&(this.containerObserver=new ResizeObserver(r=>{if(!e.browserMobile||e.browserMobile&&(!e.modules.edit||e.modules.edit&&!e.modules.edit.currentCell)){var n=Math.floor(r[0].contentRect.height),a=Math.floor(r[0].contentRect.width);(this.containerHeight!=n||this.containerWidth!=a)&&(this.containerHeight=n,this.containerWidth=a,this.tableHeight=e.element.clientHeight,this.tableWidth=e.element.clientWidth),this.redrawTable()}}),this.containerObserver.observe(this.table.element.parentNode)),this.subscribe("table-resize",this.tableResized.bind(this))):(this.binding=function(){(!e.browserMobile||e.browserMobile&&(!e.modules.edit||e.modules.edit&&!e.modules.edit.currentCell))&&(e.columnManager.rerenderColumns(!0),e.redraw())},window.addEventListener("resize",this.binding)),this.subscribe("table-destroy",this.clearBindings.bind(this))}}initializeVisibilityObserver(){this.visibilityObserver=new IntersectionObserver(e=>{this.visible=e[0].isIntersecting,this.initialized?this.visible&&(this.redrawTable(this.initialRedraw),this.initialRedraw=!1):(this.initialized=!0,this.initialRedraw=!this.visible)}),this.visibilityObserver.observe(this.table.element)}redrawTable(e){this.initialized&&this.visible&&(this.table.columnManager.rerenderColumns(!0),this.table.redraw(e))}tableResized(){this.table.rowManager.redraw()}clearBindings(){this.binding&&window.removeEventListener("resize",this.binding),this.resizeObserver&&this.resizeObserver.unobserve(this.table.element),this.visibilityObserver&&this.visibilityObserver.unobserve(this.table.element),this.containerObserver&&this.containerObserver.unobserve(this.table.element.parentNode)}}function rge(t,e,i){var r=document.createElement("div"),n=t.getRow()._row.modules.responsiveLayout;r.classList.add("tabulator-responsive-collapse-toggle"),r.innerHTML=`<svg class='tabulator-responsive-collapse-toggle-open' viewbox="0 0 24 24">
  <line x1="7" y1="12" x2="17" y2="12" fill="none" stroke-width="3" stroke-linecap="round" />
  <line y1="7" x1="12" y2="17" x2="12" fill="none" stroke-width="3" stroke-linecap="round" />
</svg>

<svg class='tabulator-responsive-collapse-toggle-close' viewbox="0 0 24 24">
  <line x1="7" y1="12" x2="17" y2="12"  fill="none" stroke-width="3" stroke-linecap="round" />
</svg>`,t.getElement().classList.add("tabulator-row-handle");function a(s){var o=n.element;n.open=s,o&&(n.open?(r.classList.add("open"),o.style.display=""):(r.classList.remove("open"),o.style.display="none"))}return r.addEventListener("click",function(s){s.stopImmediatePropagation(),a(!n.open),t.getTable().rowManager.adjustTableSize()}),a(n.open),r}var nge={format:{formatters:{responsiveCollapse:rge}}};class age extends si{static moduleName="responsiveLayout";static moduleExtensions=nge;constructor(e){super(e),this.columns=[],this.hiddenColumns=[],this.mode="",this.index=0,this.collapseFormatter=[],this.collapseStartOpen=!0,this.collapseHandleColumn=!1,this.registerTableOption("responsiveLayout",!1),this.registerTableOption("responsiveLayoutCollapseStartOpen",!0),this.registerTableOption("responsiveLayoutCollapseUseFormatters",!0),this.registerTableOption("responsiveLayoutCollapseFormatter",!1),this.registerColumnOption("responsive")}initialize(){this.table.options.responsiveLayout&&(this.subscribe("column-layout",this.initializeColumn.bind(this)),this.subscribe("column-show",this.updateColumnVisibility.bind(this)),this.subscribe("column-hide",this.updateColumnVisibility.bind(this)),this.subscribe("columns-loaded",this.initializeResponsivity.bind(this)),this.subscribe("column-moved",this.initializeResponsivity.bind(this)),this.subscribe("column-add",this.initializeResponsivity.bind(this)),this.subscribe("column-delete",this.initializeResponsivity.bind(this)),this.subscribe("table-redrawing",this.tableRedraw.bind(this)),this.table.options.responsiveLayout==="collapse"&&(this.subscribe("row-data-changed",this.generateCollapsedRowContent.bind(this)),this.subscribe("row-init",this.initializeRow.bind(this)),this.subscribe("row-layout",this.layoutRow.bind(this))))}tableRedraw(e){["fitColumns","fitDataStretch"].indexOf(this.layoutMode())===-1&&(e||this.update())}initializeResponsivity(){var e=[];this.mode=this.table.options.responsiveLayout,this.collapseFormatter=this.table.options.responsiveLayoutCollapseFormatter||this.formatCollapsedData,this.collapseStartOpen=this.table.options.responsiveLayoutCollapseStartOpen,this.hiddenColumns=[],this.collapseFormatter&&(this.collapseFormatter=this.collapseFormatter.bind(this.table)),this.table.columnManager.columnsByIndex.forEach((i,r)=>{i.modules.responsive&&i.modules.responsive.order&&i.modules.responsive.visible&&(i.modules.responsive.index=r,e.push(i),!i.visible&&this.mode==="collapse"&&this.hiddenColumns.push(i))}),e=e.reverse(),e=e.sort((i,r)=>{var n=r.modules.responsive.order-i.modules.responsive.order;return n||r.modules.responsive.index-i.modules.responsive.index}),this.columns=e,this.mode==="collapse"&&this.generateCollapsedContent();for(let i of this.table.columnManager.columnsByIndex)if(i.definition.formatter=="responsiveCollapse"){this.collapseHandleColumn=i;break}this.collapseHandleColumn&&(this.hiddenColumns.length?this.collapseHandleColumn.show():this.collapseHandleColumn.hide())}initializeColumn(e){var i=e.getDefinition();e.modules.responsive={order:typeof i.responsive>"u"?1:i.responsive,visible:i.visible!==!1}}initializeRow(e){var i;e.type!=="calc"&&(i=document.createElement("div"),i.classList.add("tabulator-responsive-collapse"),e.modules.responsiveLayout={element:i,open:this.collapseStartOpen},this.collapseStartOpen||(i.style.display="none"))}layoutRow(e){var i=e.getElement();e.modules.responsiveLayout&&(i.appendChild(e.modules.responsiveLayout.element),this.generateCollapsedRowContent(e))}updateColumnVisibility(e,i){!i&&e.modules.responsive&&(e.modules.responsive.visible=e.visible,this.initializeResponsivity())}hideColumn(e){var i=this.hiddenColumns.length;e.hide(!1,!0),this.mode==="collapse"&&(this.hiddenColumns.unshift(e),this.generateCollapsedContent(),this.collapseHandleColumn&&!i&&this.collapseHandleColumn.show())}showColumn(e){var i;e.show(!1,!0),e.setWidth(e.getWidth()),this.mode==="collapse"&&(i=this.hiddenColumns.indexOf(e),i>-1&&this.hiddenColumns.splice(i,1),this.generateCollapsedContent(),this.collapseHandleColumn&&!this.hiddenColumns.length&&this.collapseHandleColumn.hide())}update(){for(var e=!0;e;){let i=this.table.modules.layout.getMode()=="fitColumns"?this.table.columnManager.getFlexBaseWidth():this.table.columnManager.getWidth(),r=(this.table.options.headerVisible?this.table.columnManager.element.clientWidth:this.table.element.clientWidth)-i;if(r<0){let n=this.columns[this.index];n?(this.hideColumn(n),this.index++):e=!1}else{let n=this.columns[this.index-1];n&&r>0&&r>=n.getWidth()?(this.showColumn(n),this.index--):e=!1}this.table.rowManager.activeRowsCount||this.table.rowManager.renderEmptyScroll()}}generateCollapsedContent(){var e=this.table.rowManager.getDisplayRows();e.forEach(i=>{this.generateCollapsedRowContent(i)})}generateCollapsedRowContent(e){var i,r;if(e.modules.responsiveLayout){for(i=e.modules.responsiveLayout.element;i.firstChild;)i.removeChild(i.firstChild);r=this.collapseFormatter(this.generateCollapsedRowData(e)),r&&i.appendChild(r),e.calcHeight(!0)}}generateCollapsedRowData(e){var i=e.getData(),r=[],n;return this.hiddenColumns.forEach(a=>{var s=a.getFieldValue(i);if(a.definition.title&&a.field)if(a.modules.format&&this.table.options.responsiveLayoutCollapseUseFormatters){let l=function(u){u()};var o=l;n={value:!1,data:{},getValue:function(){return s},getData:function(){return i},getType:function(){return"cell"},getElement:function(){return document.createElement("div")},getRow:function(){return e.getComponent()},getColumn:function(){return a.getComponent()},getTable:()=>this.table},r.push({field:a.field,title:a.definition.title,value:a.modules.format.formatter.call(this.table.modules.format,n,a.modules.format.params,l)})}else r.push({field:a.field,title:a.definition.title,value:s})}),r}formatCollapsedData(e){var i=document.createElement("table");return e.forEach(r=>{var n=document.createElement("tr"),a=document.createElement("td"),s=document.createElement("td"),o,l=document.createElement("strong");a.appendChild(l),this.modules.localize.bind("columns|"+r.field,function(u){l.innerHTML=u||r.title}),r.value instanceof Node?(o=document.createElement("div"),o.appendChild(r.value),s.appendChild(o)):s.innerHTML=r.value,n.appendChild(a),n.appendChild(s),i.appendChild(n)}),Object.keys(e).length?i:""}}function sge(t,e,i){var r=document.createElement("input"),n=!1;if(r.type="checkbox",r.setAttribute("aria-label","Select Row"),this.table.modExists("selectRow",!0))if(r.addEventListener("click",s=>{s.stopPropagation()}),typeof t.getRow=="function"){var a=t.getRow();a instanceof LE?(r.addEventListener("change",s=>{this.table.options.selectableRowsRangeMode==="click"&&n?n=!1:a.toggleSelect()}),this.table.options.selectableRowsRangeMode==="click"&&r.addEventListener("click",s=>{n=!0,this.table.modules.selectRow.handleComplexRowClick(a._row,s)}),r.checked=a.isSelected&&a.isSelected(),this.table.modules.selectRow.registerRowSelectCheckbox(a,r)):r=""}else r.addEventListener("change",s=>{this.table.modules.selectRow.selectedRows.length?this.table.deselectRow():this.table.selectRow(e.rowRange)}),this.table.modules.selectRow.registerHeaderSelectCheckbox(r);return r}var oge={format:{formatters:{rowSelection:sge}}};class lge extends si{static moduleName="selectRow";static moduleExtensions=oge;constructor(e){super(e),this.selecting=!1,this.lastClickedRow=!1,this.selectPrev=[],this.selectedRows=[],this.headerCheckboxElement=null,this.registerTableOption("selectableRows","highlight"),this.registerTableOption("selectableRowsRangeMode","drag"),this.registerTableOption("selectableRowsRollingSelection",!0),this.registerTableOption("selectableRowsPersistence",!0),this.registerTableOption("selectableRowsCheck",function(i,r){return!0}),this.registerTableFunction("selectRow",this.selectRows.bind(this)),this.registerTableFunction("deselectRow",this.deselectRows.bind(this)),this.registerTableFunction("toggleSelectRow",this.toggleRow.bind(this)),this.registerTableFunction("getSelectedRows",this.getSelectedRows.bind(this)),this.registerTableFunction("getSelectedData",this.getSelectedData.bind(this)),this.registerComponentFunction("row","select",this.selectRows.bind(this)),this.registerComponentFunction("row","deselect",this.deselectRows.bind(this)),this.registerComponentFunction("row","toggleSelect",this.toggleRow.bind(this)),this.registerComponentFunction("row","isSelected",this.isRowSelected.bind(this))}initialize(){this.deprecatedOptionsCheck(),this.table.options.selectableRows==="highlight"&&this.table.options.selectableRange&&(this.table.options.selectableRows=!1),this.table.options.selectableRows!==!1&&(this.subscribe("row-init",this.initializeRow.bind(this)),this.subscribe("row-deleting",this.rowDeleted.bind(this)),this.subscribe("rows-wipe",this.clearSelectionData.bind(this)),this.subscribe("rows-retrieve",this.rowRetrieve.bind(this)),this.table.options.selectableRows&&!this.table.options.selectableRowsPersistence&&this.subscribe("data-refreshing",this.deselectRows.bind(this)))}deprecatedOptionsCheck(){}rowRetrieve(e,i){return e==="selected"?this.selectedRows:i}rowDeleted(e){this._deselectRow(e,!0)}clearSelectionData(e){var i=this.selectedRows.length;this.selecting=!1,this.lastClickedRow=!1,this.selectPrev=[],this.selectedRows=[],i&&e!==!0&&this._rowSelectionChanged()}initializeRow(e){var i=this,r=i.checkRowSelectability(e),n=e.getElement(),a=function(){setTimeout(function(){i.selecting=!1},50),document.body.removeEventListener("mouseup",a)};e.modules.select={selected:!1},n.classList.toggle("tabulator-selectable",r),n.classList.toggle("tabulator-unselectable",!r),i.checkRowSelectability(e)&&i.table.options.selectableRows&&i.table.options.selectableRows!="highlight"&&(i.table.options.selectableRowsRangeMode==="click"?n.addEventListener("click",this.handleComplexRowClick.bind(this,e)):(n.addEventListener("click",function(s){(!i.table.modExists("edit")||!i.table.modules.edit.getCurrentCell())&&i.table._clearSelection(),i.selecting||i.toggleRow(e)}),n.addEventListener("mousedown",function(s){if(s.shiftKey)return i.table._clearSelection(),i.selecting=!0,i.selectPrev=[],document.body.addEventListener("mouseup",a),document.body.addEventListener("keyup",a),i.toggleRow(e),!1}),n.addEventListener("mouseenter",function(s){i.selecting&&(i.table._clearSelection(),i.toggleRow(e),i.selectPrev[1]==e&&i.toggleRow(i.selectPrev[0]))}),n.addEventListener("mouseout",function(s){i.selecting&&(i.table._clearSelection(),i.selectPrev.unshift(e))})))}handleComplexRowClick(e,i){if(i.shiftKey){this.table._clearSelection(),this.lastClickedRow=this.lastClickedRow||e;var r=this.table.rowManager.getDisplayRowIndex(this.lastClickedRow),n=this.table.rowManager.getDisplayRowIndex(e),a=r<=n?r:n,s=r>=n?r:n,o=this.table.rowManager.getDisplayRows().slice(0),l=o.splice(a,s-a+1);i.ctrlKey||i.metaKey?(l.forEach(u=>{u!==this.lastClickedRow&&(this.table.options.selectableRows!==!0&&!this.isRowSelected(e)?this.selectedRows.length<this.table.options.selectableRows&&this.toggleRow(u):this.toggleRow(u))}),this.lastClickedRow=e):(this.deselectRows(void 0,!0),this.table.options.selectableRows!==!0&&l.length>this.table.options.selectableRows&&(l=l.slice(0,this.table.options.selectableRows)),this.selectRows(l)),this.table._clearSelection()}else i.ctrlKey||i.metaKey?(this.toggleRow(e),this.lastClickedRow=e):(this.deselectRows(void 0,!0),this.selectRows(e),this.lastClickedRow=e)}checkRowSelectability(e){return e&&e.type==="row"?this.table.options.selectableRowsCheck.call(this.table,e.getComponent()):!1}toggleRow(e){this.checkRowSelectability(e)&&(e.modules.select&&e.modules.select.selected?this._deselectRow(e):this._selectRow(e))}selectRows(e){var i=[],r,n;switch(typeof e){case"undefined":r=this.table.rowManager.rows;break;case"number":r=this.table.rowManager.findRow(e);break;case"string":r=this.table.rowManager.findRow(e),r||(r=this.table.rowManager.getRows(e));break;default:r=e;break}Array.isArray(r)?r.length&&(r.forEach(a=>{n=this._selectRow(a,!0,!0),n&&i.push(n)}),this._rowSelectionChanged(!1,i)):r&&this._selectRow(r,!1,!0)}_selectRow(e,i,r){if(!isNaN(this.table.options.selectableRows)&&this.table.options.selectableRows!==!0&&!r&&this.selectedRows.length>=this.table.options.selectableRows)if(this.table.options.selectableRowsRollingSelection)this._deselectRow(this.selectedRows[0]);else return!1;var n=this.table.rowManager.findRow(e);if(n){if(this.selectedRows.indexOf(n)==-1)return n.getElement().classList.add("tabulator-selected"),n.modules.select||(n.modules.select={}),n.modules.select.selected=!0,n.modules.select.checkboxEl&&(n.modules.select.checkboxEl.checked=!0),this.selectedRows.push(n),this.table.options.dataTreeSelectPropagate&&this.childRowSelection(n,!0),this.dispatchExternal("rowSelected",n.getComponent()),this._rowSelectionChanged(i,n),n}else i||console.warn("Selection Error - No such row found, ignoring selection:"+e)}isRowSelected(e){return this.selectedRows.indexOf(e)!==-1}deselectRows(e,i){var r=[],n,a;switch(typeof e){case"undefined":n=Object.assign([],this.selectedRows);break;case"number":n=this.table.rowManager.findRow(e);break;case"string":n=this.table.rowManager.findRow(e),n||(n=this.table.rowManager.getRows(e));break;default:n=e;break}Array.isArray(n)?n.length&&(n.forEach(s=>{a=this._deselectRow(s,!0,!0),a&&r.push(a)}),this._rowSelectionChanged(i,[],r)):n&&this._deselectRow(n,i,!0)}_deselectRow(e,i){var r=this,n=r.table.rowManager.findRow(e),a,s;if(n){if(a=r.selectedRows.findIndex(function(o){return o==n}),a>-1)return s=n.getElement(),s&&s.classList.remove("tabulator-selected"),n.modules.select||(n.modules.select={}),n.modules.select.selected=!1,n.modules.select.checkboxEl&&(n.modules.select.checkboxEl.checked=!1),r.selectedRows.splice(a,1),this.table.options.dataTreeSelectPropagate&&this.childRowSelection(n,!1),this.dispatchExternal("rowDeselected",n.getComponent()),r._rowSelectionChanged(i,void 0,n),n}else i||console.warn("Deselection Error - No such row found, ignoring selection:"+e)}getSelectedData(){var e=[];return this.selectedRows.forEach(function(i){e.push(i.getData())}),e}getSelectedRows(){var e=[];return this.selectedRows.forEach(function(i){e.push(i.getComponent())}),e}_rowSelectionChanged(e,i=[],r=[]){this.headerCheckboxElement&&(this.selectedRows.length===0?(this.headerCheckboxElement.checked=!1,this.headerCheckboxElement.indeterminate=!1):this.table.rowManager.rows.length===this.selectedRows.length?(this.headerCheckboxElement.checked=!0,this.headerCheckboxElement.indeterminate=!1):(this.headerCheckboxElement.indeterminate=!0,this.headerCheckboxElement.checked=!1)),e||(Array.isArray(i)||(i=[i]),i=i.map(n=>n.getComponent()),Array.isArray(r)||(r=[r]),r=r.map(n=>n.getComponent()),this.dispatchExternal("rowSelectionChanged",this.getSelectedData(),this.getSelectedRows(),i,r))}registerRowSelectCheckbox(e,i){e._row.modules.select||(e._row.modules.select={}),e._row.modules.select.checkboxEl=i}registerHeaderSelectCheckbox(e){this.headerCheckboxElement=e}childRowSelection(e,i){var r=this.table.modules.dataTree.getChildren(e,!0,!0);if(i)for(let n of r)this._selectRow(n,!0);else for(let n of r)this._deselectRow(n,!0)}}class uge{constructor(e){return this._range=e,new Proxy(this,{get:function(i,r,n){return typeof i[r]<"u"?i[r]:i._range.table.componentFunctionBinder.handle("range",i._range,r)}})}getElement(){return this._range.element}getData(){return this._range.getData()}getCells(){return this._range.getCells(!0,!0)}getStructuredCells(){return this._range.getStructuredCells()}getRows(){return this._range.getRows().map(e=>e.getComponent())}getColumns(){return this._range.getColumns().map(e=>e.getComponent())}getBounds(){return this._range.getBounds()}getTopEdge(){return this._range.top}getBottomEdge(){return this._range.bottom}getLeftEdge(){return this._range.left}getRightEdge(){return this._range.right}setBounds(e,i){this._range.destroyedGuard("setBounds")&&this._range.setBounds(e&&e._cell,i&&i._cell)}setStartBound(e){this._range.destroyedGuard("setStartBound")&&(this._range.setEndBound(e&&e._cell),this._range.rangeManager.layoutElement())}setEndBound(e){this._range.destroyedGuard("setEndBound")&&(this._range.setEndBound(e&&e._cell),this._range.rangeManager.layoutElement())}clearValues(){this._range.destroyedGuard("clearValues")&&this._range.clearValues()}remove(){this._range.destroyedGuard("remove")&&this._range.destroy(!0)}}class cge extends Ra{constructor(e,i,r,n){super(e),this.rangeManager=i,this.element=null,this.initialized=!1,this.initializing={start:!1,end:!1},this.destroyed=!1,this.top=0,this.bottom=0,this.left=0,this.right=0,this.table=e,this.start={row:0,col:0},this.end={row:0,col:0},this.rangeManager.rowHeader&&(this.left=1,this.right=1,this.start.col=1,this.end.col=1),this.initElement(),setTimeout(()=>{this.initBounds(r,n)})}initElement(){this.element=document.createElement("div"),this.element.classList.add("tabulator-range")}initBounds(e,i){this._updateMinMax(),e&&this.setBounds(e,i||e)}setStart(e,i){(this.start.row!==e||this.start.col!==i)&&(this.start.row=e,this.start.col=i,this.initializing.start=!0,this._updateMinMax())}setEnd(e,i){(this.end.row!==e||this.end.col!==i)&&(this.end.row=e,this.end.col=i,this.initializing.end=!0,this._updateMinMax())}setBounds(e,i,r){e&&this.setStartBound(e),this.setEndBound(i||e),this.rangeManager.layoutElement(r)}setStartBound(e){var i,r;e.type==="column"?this.rangeManager.columnSelection&&this.setStart(0,e.getPosition()-1):(i=e.row.position-1,r=e.column.getPosition()-1,e.column===this.rangeManager.rowHeader?this.setStart(i,1):this.setStart(i,r))}setEndBound(e){var i=this._getTableRows().length,r,n,a;e.type==="column"?this.rangeManager.columnSelection&&(this.rangeManager.selecting==="column"?this.setEnd(i-1,e.getPosition()-1):this.rangeManager.selecting==="cell"&&this.setEnd(0,e.getPosition()-1)):(r=e.row.position-1,n=e.column.getPosition()-1,a=e.column===this.rangeManager.rowHeader,this.rangeManager.selecting==="row"?this.setEnd(r,this._getTableColumns().length-1):this.rangeManager.selecting!=="row"&&a?this.setEnd(r,0):this.rangeManager.selecting==="column"?this.setEnd(i-1,n):this.setEnd(r,n))}_updateMinMax(){this.top=Math.min(this.start.row,this.end.row),this.bottom=Math.max(this.start.row,this.end.row),this.left=Math.min(this.start.col,this.end.col),this.right=Math.max(this.start.col,this.end.col),this.initialized?this.dispatchExternal("rangeChanged",this.getComponent()):this.initializing.start&&this.initializing.end&&(this.initialized=!0,this.dispatchExternal("rangeAdded",this.getComponent()))}_getTableColumns(){return this.table.columnManager.getVisibleColumnsByIndex()}_getTableRows(){return this.table.rowManager.getDisplayRows().filter(e=>e.type==="row")}layout(){var e=this.table.rowManager.renderer.vDomTop,i=this.table.rowManager.renderer.vDomBottom,r=this.table.columnManager.renderer.leftCol,n=this.table.columnManager.renderer.rightCol,a,s,o,l,u,c,d,p,f,m;this.table.options.renderHorizontal==="virtual"&&this.rangeManager.rowHeader&&(n+=1),e==null&&(e=0),i==null&&(i=1/0),r==null&&(r=0),n==null&&(n=1/0),this.overlaps(r,e,n,i)&&(a=Math.max(this.top,e),s=Math.min(this.bottom,i),o=Math.max(this.left,r),l=Math.min(this.right,n),u=this.rangeManager.getCell(a,o),c=this.rangeManager.getCell(s,l),d=u.getElement(),p=c.getElement(),f=u.row.getElement(),m=c.row.getElement(),this.element.classList.add("tabulator-range-active"),this.table.rtl?(this.element.style.right=f.offsetWidth-d.offsetLeft-d.offsetWidth+"px",this.element.style.width=d.offsetLeft+d.offsetWidth-p.offsetLeft+"px"):(this.element.style.left=f.offsetLeft+d.offsetLeft+"px",this.element.style.width=p.offsetLeft+p.offsetWidth-d.offsetLeft+"px"),this.element.style.top=f.offsetTop+"px",this.element.style.height=m.offsetTop+m.offsetHeight-f.offsetTop+"px")}atTopLeft(e){return e.row.position-1===this.top&&e.column.getPosition()-1===this.left}atBottomRight(e){return e.row.position-1===this.bottom&&e.column.getPosition()-1===this.right}occupies(e){return this.occupiesRow(e.row)&&this.occupiesColumn(e.column)}occupiesRow(e){return this.top<=e.position-1&&e.position-1<=this.bottom}occupiesColumn(e){return this.left<=e.getPosition()-1&&e.getPosition()-1<=this.right}overlaps(e,i,r,n){return!(this.left>r||e>this.right||this.top>n||i>this.bottom)}getData(){var e=[],i=this.getRows(),r=this.getColumns();return i.forEach(n=>{var a=n.getData(),s={};r.forEach(o=>{s[o.field]=a[o.field]}),e.push(s)}),e}getCells(e,i){var r=[],n=this.getRows(),a=this.getColumns();return e?r=n.map(s=>{var o=[];return s.getCells().forEach(l=>{a.includes(l.column)&&o.push(i?l.getComponent():l)}),o}):n.forEach(s=>{s.getCells().forEach(o=>{a.includes(o.column)&&r.push(i?o.getComponent():o)})}),r}getStructuredCells(){return this.getCells(!0,!0)}getRows(){return this._getTableRows().slice(this.top,this.bottom+1)}getColumns(){return this._getTableColumns().slice(this.left,this.right+1)}clearValues(){var e=this.getCells(),i=this.table.options.selectableRangeClearCellsValue;this.table.blockRedraw(),e.forEach(r=>{r.setValue(i)}),this.table.restoreRedraw()}getBounds(e){var i=this.getCells(!1,e),r={start:null,end:null};return i.length?(r.start=i[0],r.end=i[i.length-1]):console.warn("No bounds defined on range"),r}getComponent(){return this.component||(this.component=new uge(this)),this.component}destroy(e){this.destroyed=!0,this.element.remove(),e&&this.rangeManager.rangeRemoved(this),this.initialized&&this.dispatchExternal("rangeRemoved",this.getComponent())}destroyedGuard(e){return this.destroyed&&console.warn("You cannot call the "+e+" function on a destroyed range"),!this.destroyed}}var dge={rangeJumpUp:["ctrl + 38","meta + 38"],rangeJumpDown:["ctrl + 40","meta + 40"],rangeJumpLeft:["ctrl + 37","meta + 37"],rangeJumpRight:["ctrl + 39","meta + 39"],rangeExpandUp:"shift + 38",rangeExpandDown:"shift + 40",rangeExpandLeft:"shift + 37",rangeExpandRight:"shift + 39",rangeExpandJumpUp:["ctrl + shift + 38","meta + shift + 38"],rangeExpandJumpDown:["ctrl + shift + 40","meta + shift + 40"],rangeExpandJumpLeft:["ctrl + shift + 37","meta + shift + 37"],rangeExpandJumpRight:["ctrl + shift + 39","meta + shift + 39"]},pge={rangeJumpLeft:function(t){this.dispatch("keybinding-nav-range",t,"left",!0,!1)},rangeJumpRight:function(t){this.dispatch("keybinding-nav-range",t,"right",!0,!1)},rangeJumpUp:function(t){this.dispatch("keybinding-nav-range",t,"up",!0,!1)},rangeJumpDown:function(t){this.dispatch("keybinding-nav-range",t,"down",!0,!1)},rangeExpandLeft:function(t){this.dispatch("keybinding-nav-range",t,"left",!1,!0)},rangeExpandRight:function(t){this.dispatch("keybinding-nav-range",t,"right",!1,!0)},rangeExpandUp:function(t){this.dispatch("keybinding-nav-range",t,"up",!1,!0)},rangeExpandDown:function(t){this.dispatch("keybinding-nav-range",t,"down",!1,!0)},rangeExpandJumpLeft:function(t){this.dispatch("keybinding-nav-range",t,"left",!0,!0)},rangeExpandJumpRight:function(t){this.dispatch("keybinding-nav-range",t,"right",!0,!0)},rangeExpandJumpUp:function(t){this.dispatch("keybinding-nav-range",t,"up",!0,!0)},rangeExpandJumpDown:function(t){this.dispatch("keybinding-nav-range",t,"down",!0,!0)}},fge={range:function(t){var e=[],i=this.table.modules.selectRange.activeRange,r=!1,n,a,s,o,l;return l=t.length,i&&(n=i.getBounds(),a=n.start,n.start===n.end&&(r=!0),a&&(e=this.table.rowManager.activeRows.slice(),s=e.indexOf(a.row),r?o=t.length:o=e.indexOf(n.end.row)-s+1,s>-1&&(this.table.blockRedraw(),e=e.slice(s,s+o),e.forEach((u,c)=>{u.updateData(t[c%l])}),this.table.restoreRedraw()))),e}},mge={range:function(t){var e=[],i=[],r=this.table.modules.selectRange.activeRange,n=!1,a,s,o,l,u;return r&&(a=r.getBounds(),s=a.start,a.start===a.end&&(n=!0),s&&(t=t.split(`
`),t.forEach(function(c){e.push(c.split("	"))}),e.length&&(l=this.table.columnManager.getVisibleColumnsByIndex(),u=l.indexOf(s.column),u>-1)))?(n?o=e[0].length:o=l.indexOf(a.end.column)-u+1,l=l.slice(u,u+o),e.forEach(c=>{var d={},p=c.length;l.forEach(function(f,m){d[f.field]=c[m%p]}),i.push(d)}),i):!1}},hge={range:function(){var t=this.modules.selectRange.selectedColumns();return this.columnManager.rowHeader&&t.unshift(this.columnManager.rowHeader),t}},gge={range:function(){return this.modules.selectRange.selectedRows()}},Ige={keybindings:{bindings:dge,actions:pge},clipboard:{pasteActions:fge,pasteParsers:mge},export:{columnLookups:hge,rowLookups:gge}};class vge extends si{static moduleName="selectRange";static moduleInitOrder=1;static moduleExtensions=Ige;constructor(e){super(e),this.selecting="cell",this.mousedown=!1,this.ranges=[],this.overlay=null,this.rowHeader=null,this.layoutChangeTimeout=null,this.columnSelection=!1,this.rowSelection=!1,this.maxRanges=0,this.activeRange=!1,this.blockKeydown=!1,this.keyDownEvent=this._handleKeyDown.bind(this),this.mouseUpEvent=this._handleMouseUp.bind(this),this.registerTableOption("selectableRange",!1),this.registerTableOption("selectableRangeColumns",!1),this.registerTableOption("selectableRangeRows",!1),this.registerTableOption("selectableRangeClearCells",!1),this.registerTableOption("selectableRangeClearCellsValue",void 0),this.registerTableOption("selectableRangeAutoFocus",!0),this.registerTableFunction("getRangesData",this.getRangesData.bind(this)),this.registerTableFunction("getRanges",this.getRanges.bind(this)),this.registerTableFunction("addRange",this.addRangeFromComponent.bind(this)),this.registerComponentFunction("cell","getRanges",this.cellGetRanges.bind(this)),this.registerComponentFunction("row","getRanges",this.rowGetRanges.bind(this)),this.registerComponentFunction("column","getRanges",this.colGetRanges.bind(this))}initialize(){this.options("selectableRange")&&(this.options("selectableRows")?console.warn("SelectRange functionality cannot be used in conjunction with row selection"):(this.maxRanges=this.options("selectableRange"),this.initializeTable(),this.initializeWatchers()),this.options("columns").findIndex(e=>e.frozen)>0&&console.warn("Having frozen column in arbitrary position with selectRange option may result in unpredictable behavior."),this.options("columns").filter(e=>e.frozen)>1&&console.warn("Having multiple frozen columns with selectRange option may result in unpredictable behavior."))}initializeTable(){this.overlay=document.createElement("div"),this.overlay.classList.add("tabulator-range-overlay"),this.rangeContainer=document.createElement("div"),this.rangeContainer.classList.add("tabulator-range-container"),this.activeRangeCellElement=document.createElement("div"),this.activeRangeCellElement.classList.add("tabulator-range-cell-active"),this.overlay.appendChild(this.rangeContainer),this.overlay.appendChild(this.activeRangeCellElement),this.table.rowManager.element.addEventListener("keydown",this.keyDownEvent),this.resetRanges(),this.table.rowManager.element.appendChild(this.overlay),this.table.columnManager.element.setAttribute("tabindex",0),this.table.element.classList.add("tabulator-ranges")}initializeWatchers(){this.columnSelection=this.options("selectableRangeColumns"),this.rowSelection=this.options("selectableRangeRows"),this.subscribe("column-init",this.initializeColumn.bind(this)),this.subscribe("column-mousedown",this.handleColumnMouseDown.bind(this)),this.subscribe("column-mousemove",this.handleColumnMouseMove.bind(this)),this.subscribe("column-resized",this.handleColumnResized.bind(this)),this.subscribe("column-moving",this.handleColumnMoving.bind(this)),this.subscribe("column-moved",this.handleColumnMoved.bind(this)),this.subscribe("column-width",this.layoutChange.bind(this)),this.subscribe("column-height",this.layoutChange.bind(this)),this.subscribe("column-resized",this.layoutChange.bind(this)),this.subscribe("columns-loaded",this.updateHeaderColumn.bind(this)),this.subscribe("cell-height",this.layoutChange.bind(this)),this.subscribe("cell-rendered",this.renderCell.bind(this)),this.subscribe("cell-mousedown",this.handleCellMouseDown.bind(this)),this.subscribe("cell-mousemove",this.handleCellMouseMove.bind(this)),this.subscribe("cell-click",this.handleCellClick.bind(this)),this.subscribe("cell-editing",this.handleEditingCell.bind(this)),this.subscribe("page-changed",this.redraw.bind(this)),this.subscribe("scroll-vertical",this.layoutChange.bind(this)),this.subscribe("scroll-horizontal",this.layoutChange.bind(this)),this.subscribe("data-destroy",this.tableDestroyed.bind(this)),this.subscribe("data-processed",this.resetRanges.bind(this)),this.subscribe("table-layout",this.layoutElement.bind(this)),this.subscribe("table-redraw",this.redraw.bind(this)),this.subscribe("table-destroy",this.tableDestroyed.bind(this)),this.subscribe("edit-editor-clear",this.finishEditingCell.bind(this)),this.subscribe("edit-blur",this.restoreFocus.bind(this)),this.subscribe("keybinding-nav-prev",this.keyNavigate.bind(this,"left")),this.subscribe("keybinding-nav-next",this.keyNavigate.bind(this,"right")),this.subscribe("keybinding-nav-left",this.keyNavigate.bind(this,"left")),this.subscribe("keybinding-nav-right",this.keyNavigate.bind(this,"right")),this.subscribe("keybinding-nav-up",this.keyNavigate.bind(this,"up")),this.subscribe("keybinding-nav-down",this.keyNavigate.bind(this,"down")),this.subscribe("keybinding-nav-range",this.keyNavigateRange.bind(this))}initializeColumn(e){this.columnSelection&&e.definition.headerSort&&this.options("headerSortClickElement")!=="icon"&&console.warn("Using column headerSort with selectableRangeColumns option may result in unpredictable behavior. Consider using headerSortClickElement: 'icon'."),e.modules.edit}updateHeaderColumn(){var e;this.rowSelection&&(this.rowHeader=this.table.columnManager.getVisibleColumnsByIndex()[0],this.rowHeader&&(this.rowHeader.definition.cssClass=this.rowHeader.definition.cssClass+" tabulator-range-row-header",this.rowHeader.definition.headerSort&&console.warn("Using column headerSort with selectableRangeRows option may result in unpredictable behavior"),this.rowHeader.definition.editor&&console.warn("Using column editor with selectableRangeRows option may result in unpredictable behavior"))),this.table.modules.frozenColumns&&this.table.modules.frozenColumns.active&&(e=this.table.modules.frozenColumns.getFrozenColumns(),(e.length>1||e.length===1&&e[0]!==this.rowHeader)&&console.warn("Using frozen columns that are not the range header in combination with the selectRange option may result in unpredictable behavior"))}getRanges(){return this.ranges.map(e=>e.getComponent())}getRangesData(){return this.ranges.map(e=>e.getData())}addRangeFromComponent(e,i){return e=e?e._cell:null,i=i?i._cell:null,this.addRange(e,i)}cellGetRanges(e){var i=[];return e.column===this.rowHeader?i=this.ranges.filter(r=>r.occupiesRow(e.row)):i=this.ranges.filter(r=>r.occupies(e)),i.map(r=>r.getComponent())}rowGetRanges(e){var i=this.ranges.filter(r=>r.occupiesRow(e));return i.map(r=>r.getComponent())}colGetRanges(e){var i=this.ranges.filter(r=>r.occupiesColumn(e));return i.map(r=>r.getComponent())}_handleMouseUp(e){this.mousedown=!1,document.removeEventListener("mouseup",this.mouseUpEvent)}_handleKeyDown(e){if(!this.blockKeydown&&(!this.table.modules.edit||this.table.modules.edit&&!this.table.modules.edit.currentCell)){if(e.key==="Enter"){if(this.table.modules.edit&&this.table.modules.edit.currentCell)return;this.table.modules.edit.editCell(this.getActiveCell()),e.preventDefault()}(e.key==="Backspace"||e.key==="Delete")&&this.options("selectableRangeClearCells")&&this.activeRange&&this.activeRange.clearValues()}}initializeFocus(e){var i;this.restoreFocus();try{document.selection?(i=document.body.createTextRange(),i.moveToElementText(e.getElement()),i.select()):window.getSelection&&(i=document.createRange(),i.selectNode(e.getElement()),window.getSelection().removeAllRanges(),window.getSelection().addRange(i))}catch{}}restoreFocus(e){return this.table.rowManager.element.focus(),!0}handleColumnResized(e){var i;this.selecting!=="column"&&this.selecting!=="all"||(i=this.ranges.some(r=>r.occupiesColumn(e)),i&&this.ranges.forEach(r=>{var n=r.getColumns(!0);n.forEach(a=>{a!==e&&a.setWidth(e.width)})}))}handleColumnMoving(e,i){this.resetRanges().setBounds(i),this.overlay.style.visibility="hidden"}handleColumnMoved(e,i,r){this.activeRange.setBounds(e),this.layoutElement()}handleColumnMouseDown(e,i){e.button===2&&(this.selecting==="column"||this.selecting==="all")&&this.activeRange.occupiesColumn(i)||this.table.options.movableColumns&&this.selecting==="column"&&this.activeRange.occupiesColumn(i)||(this.mousedown=!0,document.addEventListener("mouseup",this.mouseUpEvent),this.newSelection(e,i))}handleColumnMouseMove(e,i){i===this.rowHeader||!this.mousedown||this.selecting==="all"||this.activeRange.setBounds(!1,i,!0)}renderCell(e){var i=e.getElement(),r=this.ranges.findIndex(n=>n.occupies(e));i.classList.toggle("tabulator-range-selected",r!==-1),i.classList.toggle("tabulator-range-only-cell-selected",this.ranges.length===1&&this.ranges[0].atTopLeft(e)&&this.ranges[0].atBottomRight(e)),i.dataset.range=r}handleCellMouseDown(e,i){e.button===2&&(this.activeRange.occupies(i)||(this.selecting==="row"||this.selecting==="all")&&this.activeRange.occupiesRow(i.row))||(this.mousedown=!0,document.addEventListener("mouseup",this.mouseUpEvent),this.newSelection(e,i))}handleCellMouseMove(e,i){!this.mousedown||this.selecting==="all"||this.activeRange.setBounds(!1,i,!0)}handleCellClick(e,i){this.initializeFocus(i)}handleEditingCell(e){this.activeRange&&this.activeRange.setBounds(e)}finishEditingCell(){this.blockKeydown=!0,this.table.rowManager.element.focus(),setTimeout(()=>{this.blockKeydown=!1},10)}keyNavigate(e,i){this.navigate(!1,!1,e),i.preventDefault()}keyNavigateRange(e,i,r,n){this.navigate(r,n,i),e.preventDefault()}navigate(e,i,r){var n=!1,a,s,o,l,u,c,d,p,f,m,h;if(this.table.modules.edit&&this.table.modules.edit.currentCell)return!1;if(this.ranges.length>1&&(this.ranges=this.ranges.filter(g=>g===this.activeRange?(g.setEnd(g.start.row,g.start.col),!0):(g.destroy(),!1))),a=this.activeRange,o={top:a.top,bottom:a.bottom,left:a.left,right:a.right},s=i?a.end:a.start,l=s.row,u=s.col,e)switch(r){case"left":u=this.findJumpCellLeft(a.start.row,s.col);break;case"right":u=this.findJumpCellRight(a.start.row,s.col);break;case"up":l=this.findJumpCellUp(s.row,a.start.col);break;case"down":l=this.findJumpCellDown(s.row,a.start.col);break}else{if(i&&(this.selecting==="row"&&(r==="left"||r==="right")||this.selecting==="column"&&(r==="up"||r==="down")))return;switch(r){case"left":u=Math.max(u-1,0);break;case"right":u=Math.min(u+1,this.getTableColumns().length-1);break;case"up":l=Math.max(l-1,0);break;case"down":l=Math.min(l+1,this.getTableRows().length-1);break}}if(this.rowHeader&&u===0&&(u=1),i||a.setStart(l,u),a.setEnd(l,u),i||(this.selecting="cell"),n=o.top!==a.top||o.bottom!==a.bottom||o.left!==a.left||o.right!==a.right,n)return c=this.getRowByRangePos(a.end.row),d=this.getColumnByRangePos(a.end.col),p=c.getElement().getBoundingClientRect(),m=d.getElement().getBoundingClientRect(),f=this.table.rowManager.getElement().getBoundingClientRect(),h=this.table.columnManager.getElement().getBoundingClientRect(),p.top>=f.top&&p.bottom<=f.bottom||(c.getElement().parentNode&&d.getElement().parentNode?this.autoScroll(a,c.getElement(),d.getElement()):c.getComponent().scrollTo(void 0,!1)),m.left>=h.left+this.getRowHeaderWidth()&&m.right<=h.right||(c.getElement().parentNode&&d.getElement().parentNode?this.autoScroll(a,c.getElement(),d.getElement()):d.getComponent().scrollTo(void 0,!1)),this.layoutElement(),!0}rangeRemoved(e){this.ranges=this.ranges.filter(i=>i!==e),this.activeRange===e&&(this.ranges.length?this.activeRange=this.ranges[this.ranges.length-1]:this.addRange()),this.layoutElement()}findJumpRow(e,i,r,n,a){return r&&(i=i.reverse()),this.findJumpItem(n,a,i,function(s){return s.getData()[e.getField()]})}findJumpCol(e,i,r,n,a){return r&&(i=i.reverse()),this.findJumpItem(n,a,i,function(s){return e.getData()[s.getField()]})}findJumpItem(e,i,r,n){var a;for(let s of r){let o=n(s);if(e){if(a=s,o)break}else if(i){if(a=s,o)break}else if(o)a=s;else break}return a}findJumpCellLeft(e,i){var r=this.getRowByRangePos(e),n=this.getTableColumns(),a=this.isEmpty(r.getData()[n[i].getField()]),s=n[i-1]?this.isEmpty(r.getData()[n[i-1].getField()]):!1,o=this.rowHeader?n.slice(1,i):n.slice(0,i),l=this.findJumpCol(r,o,!0,a,s);return l?l.getPosition()-1:i}findJumpCellRight(e,i){var r=this.getRowByRangePos(e),n=this.getTableColumns(),a=this.isEmpty(r.getData()[n[i].getField()]),s=n[i+1]?this.isEmpty(r.getData()[n[i+1].getField()]):!1,o=this.findJumpCol(r,n.slice(i+1,n.length),!1,a,s);return o?o.getPosition()-1:i}findJumpCellUp(e,i){var r=this.getColumnByRangePos(i),n=this.getTableRows(),a=this.isEmpty(n[e].getData()[r.getField()]),s=n[e-1]?this.isEmpty(n[e-1].getData()[r.getField()]):!1,o=this.findJumpRow(r,n.slice(0,e),!0,a,s);return o?o.position-1:e}findJumpCellDown(e,i){var r=this.getColumnByRangePos(i),n=this.getTableRows(),a=this.isEmpty(n[e].getData()[r.getField()]),s=n[e+1]?this.isEmpty(n[e+1].getData()[r.getField()]):!1,o=this.findJumpRow(r,n.slice(e+1,n.length),!1,a,s);return o?o.position-1:e}newSelection(e,i){var r;if(i.type==="column"){if(!this.columnSelection)return;if(i===this.rowHeader){r=this.resetRanges(),this.selecting="all";var n,a=this.getCell(-1,-1);this.rowHeader?n=this.getCell(0,1):n=this.getCell(0,0),r.setBounds(n,a);return}else this.selecting="column"}else i.column===this.rowHeader?this.selecting="row":this.selecting="cell";e.shiftKey?this.activeRange.setBounds(!1,i):e.ctrlKey?this.addRange().setBounds(i):this.resetRanges().setBounds(i)}autoScroll(e,i,r){var n=this.table.rowManager.element,a,s,o,l;typeof i>"u"&&(i=this.getRowByRangePos(e.end.row).getElement()),typeof r>"u"&&(r=this.getColumnByRangePos(e.end.col).getElement()),a={left:r.offsetLeft,right:r.offsetLeft+r.offsetWidth,top:i.offsetTop,bottom:i.offsetTop+i.offsetHeight},s={left:n.scrollLeft+this.getRowHeaderWidth(),right:Math.ceil(n.scrollLeft+n.clientWidth),top:n.scrollTop,bottom:n.scrollTop+n.offsetHeight-this.table.rowManager.scrollbarWidth},o=s.left<a.left&&a.left<s.right&&s.left<a.right&&a.right<s.right,l=s.top<a.top&&a.top<s.bottom&&s.top<a.bottom&&a.bottom<s.bottom,o||(a.left<s.left?n.scrollLeft=a.left-this.getRowHeaderWidth():a.right>s.right&&(n.scrollLeft=Math.min(a.right-n.clientWidth,a.left-this.getRowHeaderWidth()))),l||(a.top<s.top?n.scrollTop=a.top:a.bottom>s.bottom&&(n.scrollTop=a.bottom-n.clientHeight))}layoutChange(){this.overlay.style.visibility="hidden",clearTimeout(this.layoutChangeTimeout),this.layoutChangeTimeout=setTimeout(this.layoutRanges.bind(this),200)}redraw(e){e&&(this.selecting="cell",this.resetRanges(),this.layoutElement())}layoutElement(e){var i;e?i=this.table.rowManager.getVisibleRows(!0):i=this.table.rowManager.getRows(),i.forEach(r=>{r.type==="row"&&(this.layoutRow(r),r.cells.forEach(n=>this.renderCell(n)))}),this.getTableColumns().forEach(r=>{this.layoutColumn(r)}),this.layoutRanges()}layoutRow(e){var i=e.getElement(),r=!1,n=this.ranges.some(a=>a.occupiesRow(e));this.selecting==="row"?r=n:this.selecting==="all"&&(r=!0),i.classList.toggle("tabulator-range-selected",r),i.classList.toggle("tabulator-range-highlight",n)}layoutColumn(e){var i=e.getElement(),r=!1,n=this.ranges.some(a=>a.occupiesColumn(e));this.selecting==="column"?r=n:this.selecting==="all"&&(r=!0),i.classList.toggle("tabulator-range-selected",r),i.classList.toggle("tabulator-range-highlight",n)}layoutRanges(){var e,i,r;this.table.initialized&&(e=this.getActiveCell(),e&&(i=e.getElement(),r=e.row.getElement(),this.table.rtl?this.activeRangeCellElement.style.right=r.offsetWidth-i.offsetLeft-i.offsetWidth+"px":this.activeRangeCellElement.style.left=r.offsetLeft+i.offsetLeft+"px",this.activeRangeCellElement.style.top=r.offsetTop+"px",this.activeRangeCellElement.style.width=i.offsetWidth+"px",this.activeRangeCellElement.style.height=r.offsetHeight+"px",this.ranges.forEach(n=>n.layout()),this.overlay.style.visibility="visible"))}getCell(e,i){var r;return i<0&&(i=this.getTableColumns().length+i,i<0)?null:(e<0&&(e=this.getTableRows().length+e),r=this.table.rowManager.getRowFromPosition(e+1),r?r.getCells(!1,!0).filter(n=>n.column.visible)[i]:null)}getActiveCell(){return this.getCell(this.activeRange.start.row,this.activeRange.start.col)}getRowByRangePos(e){return this.getTableRows()[e]}getColumnByRangePos(e){return this.getTableColumns()[e]}getTableRows(){return this.table.rowManager.getDisplayRows().filter(e=>e.type==="row")}getTableColumns(){return this.table.columnManager.getVisibleColumnsByIndex()}addRange(e,i){var r;return this.maxRanges!==!0&&this.ranges.length>=this.maxRanges&&this.ranges.shift().destroy(),r=new cge(this.table,this,e,i),this.activeRange=r,this.ranges.push(r),this.rangeContainer.appendChild(r.element),r}resetRanges(){var e,i,r;return this.ranges.forEach(n=>n.destroy()),this.ranges=[],e=this.addRange(),this.table.rowManager.activeRows.length&&(r=this.table.rowManager.activeRows[0].cells.filter(n=>n.column.visible),i=r[this.rowHeader?1:0],i&&(e.setBounds(i),this.options("selectableRangeAutoFocus")&&this.initializeFocus(i))),e}tableDestroyed(){document.removeEventListener("mouseup",this.mouseUpEvent),this.table.rowManager.element.removeEventListener("keydown",this.keyDownEvent)}selectedRows(e){return e?this.activeRange.getRows().map(i=>i.getComponent()):this.activeRange.getRows()}selectedColumns(e){return e?this.activeRange.getColumns().map(i=>i.getComponent()):this.activeRange.getColumns()}getRowHeaderWidth(){return this.rowHeader?this.rowHeader.getElement().offsetWidth:0}isEmpty(e){return e==null||e===""}}function yge(t,e,i,r,n,a,s){var o=s.alignEmptyValues,l=s.decimalSeparator,u=s.thousandSeparator,c=0;if(t=String(t),e=String(e),u&&(t=t.split(u).join(""),e=e.split(u).join("")),l&&(t=t.split(l).join("."),e=e.split(l).join(".")),t=parseFloat(t),e=parseFloat(e),isNaN(t))c=isNaN(e)?0:-1;else if(isNaN(e))c=1;else return t-e;return(o==="top"&&a==="desc"||o==="bottom"&&a==="asc")&&(c*=-1),c}function bge(t,e,i,r,n,a,s){var o=s.alignEmptyValues,l=0,u;if(!t)l=e?-1:0;else if(!e)l=1;else{switch(typeof s.locale){case"boolean":s.locale&&(u=this.langLocale());break;case"string":u=s.locale;break}return String(t).toLowerCase().localeCompare(String(e).toLowerCase(),u)}return(o==="top"&&a==="desc"||o==="bottom"&&a==="asc")&&(l*=-1),l}function C1(t,e,i,r,n,a,s){var o=this.table.dependencyRegistry.lookup(["luxon","DateTime"],"DateTime"),l=s.format||"dd/MM/yyyy HH:mm:ss",u=s.alignEmptyValues,c=0;if(typeof o<"u"){if(o.isDateTime(t)||(l==="iso"?t=o.fromISO(String(t)):t=o.fromFormat(String(t),l)),o.isDateTime(e)||(l==="iso"?e=o.fromISO(String(e)):e=o.fromFormat(String(e),l)),!t.isValid)c=e.isValid?-1:0;else if(!e.isValid)c=1;else return t-e;return(u==="top"&&a==="desc"||u==="bottom"&&a==="asc")&&(c*=-1),c}else console.error("Sort Error - 'datetime' sorter is dependant on luxon.js")}function wge(t,e,i,r,n,a,s){return s.format||(s.format="dd/MM/yyyy"),C1.call(this,t,e,i,r,n,a,s)}function Sge(t,e,i,r,n,a,s){return s.format||(s.format="HH:mm"),C1.call(this,t,e,i,r,n,a,s)}function Uge(t,e,i,r,n,a,s){var o=t===!0||t==="true"||t==="True"||t===1?1:0,l=e===!0||e==="true"||e==="True"||e===1?1:0;return o-l}function Tge(t,e,i,r,n,a,s){var o=s.type||"length",l=s.alignEmptyValues,u=0,c=this.table,d;s.valueMap&&(typeof s.valueMap=="string"?d=function(f){return f.map(m=>gr.retrieveNestedData(c.options.nestedFieldSeparator,s.valueMap,m))}:d=s.valueMap);function p(f){var m;switch(d&&(f=d(f)),o){case"length":m=f.length;break;case"sum":m=f.reduce(function(h,g){return h+g});break;case"max":m=Math.max.apply(null,f);break;case"min":m=Math.min.apply(null,f);break;case"avg":m=f.reduce(function(h,g){return h+g})/f.length;break;case"string":m=f.join("");break}return m}if(!Array.isArray(t))u=Array.isArray(e)?-1:0;else if(!Array.isArray(e))u=1;else return o==="string"?String(p(t)).toLowerCase().localeCompare(String(p(e)).toLowerCase()):p(e)-p(t);return(l==="top"&&a==="desc"||l==="bottom"&&a==="asc")&&(u*=-1),u}function Dge(t,e,i,r,n,a,s){var o=typeof t>"u"?0:1,l=typeof e>"u"?0:1;return o-l}function Pge(t,e,i,r,n,a,s){var o,l,u,c,d=0,p,f=/(\d+)|(\D+)/g,m=/\d/,h=s.alignEmptyValues,g=0;if(!t&&t!==0)g=!e&&e!==0?0:-1;else if(!e&&e!==0)g=1;else{if(isFinite(t)&&isFinite(e))return t-e;if(o=String(t).toLowerCase(),l=String(e).toLowerCase(),o===l)return 0;if(!(m.test(o)&&m.test(l)))return o>l?1:-1;for(o=o.match(f),l=l.match(f),p=o.length>l.length?l.length:o.length;d<p;)if(u=o[d],c=l[d++],u!==c)return isFinite(u)&&isFinite(c)?(u.charAt(0)==="0"&&(u="."+u),c.charAt(0)==="0"&&(c="."+c),u-c):u>c?1:-1;return o.length>l.length}return(h==="top"&&a==="desc"||h==="bottom"&&a==="asc")&&(g*=-1),g}var Ege={number:yge,string:bge,date:wge,time:Sge,datetime:C1,boolean:Uge,array:Tge,exists:Dge,alphanum:Pge};class Oy extends si{static moduleName="sort";static sorters=Ege;constructor(e){super(e),this.sortList=[],this.changed=!1,this.registerTableOption("sortMode","local"),this.registerTableOption("initialSort",!1),this.registerTableOption("columnHeaderSortMulti",!0),this.registerTableOption("sortOrderReverse",!1),this.registerTableOption("headerSortElement","<div class='tabulator-arrow'></div>"),this.registerTableOption("headerSortClickElement","header"),this.registerColumnOption("sorter"),this.registerColumnOption("sorterParams"),this.registerColumnOption("headerSort",!0),this.registerColumnOption("headerSortStartingDir"),this.registerColumnOption("headerSortTristate")}initialize(){this.subscribe("column-layout",this.initializeColumn.bind(this)),this.subscribe("table-built",this.tableBuilt.bind(this)),this.registerDataHandler(this.sort.bind(this),20),this.registerTableFunction("setSort",this.userSetSort.bind(this)),this.registerTableFunction("getSorters",this.getSort.bind(this)),this.registerTableFunction("clearSort",this.clearSort.bind(this)),this.table.options.sortMode==="remote"&&this.subscribe("data-params",this.remoteSortParams.bind(this))}tableBuilt(){this.table.options.initialSort&&this.setSort(this.table.options.initialSort)}remoteSortParams(e,i,r,n){var a=this.getSort();return a.forEach(s=>{delete s.column}),n.sort=a,n}userSetSort(e,i){this.setSort(e,i),this.refreshSort()}clearSort(){this.clear(),this.refreshSort()}initializeColumn(e){var i=!1,r,n;switch(typeof e.definition.sorter){case"string":Oy.sorters[e.definition.sorter]?i=Oy.sorters[e.definition.sorter]:console.warn("Sort Error - No such sorter found: ",e.definition.sorter);break;case"function":i=e.definition.sorter;break}if(e.modules.sort={sorter:i,dir:"none",params:e.definition.sorterParams||{},startingDir:e.definition.headerSortStartingDir||"asc",tristate:e.definition.headerSortTristate},e.definition.headerSort!==!1){switch(r=e.getElement(),r.classList.add("tabulator-sortable"),n=document.createElement("div"),n.classList.add("tabulator-col-sorter"),this.table.options.headerSortClickElement){case"icon":n.classList.add("tabulator-col-sorter-element");break;case"header":r.classList.add("tabulator-col-sorter-element");break;default:r.classList.add("tabulator-col-sorter-element");break}switch(this.table.options.headerSortElement){case"function":break;case"object":n.appendChild(this.table.options.headerSortElement);break;default:n.innerHTML=this.table.options.headerSortElement}e.titleHolderElement.appendChild(n),e.modules.sort.element=n,this.setColumnHeaderSortIcon(e,"none"),this.table.options.headerSortClickElement==="icon"&&n.addEventListener("mousedown",a=>{a.stopPropagation()}),(this.table.options.headerSortClickElement==="icon"?n:r).addEventListener("click",a=>{var s="",o=[],l=!1;if(e.modules.sort){if(e.modules.sort.tristate)e.modules.sort.dir=="none"?s=e.modules.sort.startingDir:e.modules.sort.dir==e.modules.sort.startingDir?s=e.modules.sort.dir=="asc"?"desc":"asc":s="none";else switch(e.modules.sort.dir){case"asc":s="desc";break;case"desc":s="asc";break;default:s=e.modules.sort.startingDir}this.table.options.columnHeaderSortMulti&&(a.shiftKey||a.ctrlKey)?(o=this.getSort(),l=o.findIndex(u=>u.field===e.getField()),l>-1?(o[l].dir=s,l=o.splice(l,1)[0],s!="none"&&o.push(l)):s!="none"&&o.push({column:e,dir:s}),this.setSort(o)):s=="none"?this.clear():this.setSort(e,s),this.refreshSort()}})}}refreshSort(){this.table.options.sortMode==="remote"?this.reloadData(null,!1,!1):this.refreshData(!0)}hasChanged(){var e=this.changed;return this.changed=!1,e}getSort(){var e=this,i=[];return e.sortList.forEach(function(r){r.column&&i.push({column:r.column.getComponent(),field:r.column.getField(),dir:r.dir})}),i}setSort(e,i){var r=this,n=[];Array.isArray(e)||(e=[{column:e,dir:i}]),e.forEach(function(a){var s;s=r.table.columnManager.findColumn(a.column),s?(a.column=s,n.push(a),r.changed=!0):console.warn("Sort Warning - Sort field does not exist and is being ignored: ",a.column)}),r.sortList=n,this.dispatch("sort-changed")}clear(){this.setSort([])}findSorter(e){var i=this.table.rowManager.activeRows[0],r="string",n,a;if(i&&(i=i.getData(),n=e.getField(),n))switch(a=e.getFieldValue(i),typeof a){case"undefined":r="string";break;case"boolean":r="boolean";break;default:!isNaN(a)&&a!==""?r="number":a.match(/((^[0-9]+[a-z]+)|(^[a-z]+[0-9]+))+$/i)&&(r="alphanum");break}return Oy.sorters[r]}sort(e,i){var r=this,n=this.table.options.sortOrderReverse?r.sortList.slice().reverse():r.sortList,a=[],s=[];return this.subscribedExternal("dataSorting")&&this.dispatchExternal("dataSorting",r.getSort()),i||r.clearColumnHeaders(),this.table.options.sortMode!=="remote"?(n.forEach(function(o,l){var u;o.column&&(u=o.column.modules.sort,u&&(u.sorter||(u.sorter=r.findSorter(o.column)),o.params=typeof u.params=="function"?u.params(o.column.getComponent(),o.dir):u.params,a.push(o)),i||r.setColumnHeader(o.column,o.dir))}),a.length&&r._sortItems(e,a)):i||n.forEach(function(o,l){r.setColumnHeader(o.column,o.dir)}),this.subscribedExternal("dataSorted")&&(e.forEach(o=>{s.push(o.getComponent())}),this.dispatchExternal("dataSorted",r.getSort(),s)),e}clearColumnHeaders(){this.table.columnManager.getRealColumns().forEach(e=>{e.modules.sort&&(e.modules.sort.dir="none",e.getElement().setAttribute("aria-sort","none"),this.setColumnHeaderSortIcon(e,"none"))})}setColumnHeader(e,i){e.modules.sort.dir=i,e.getElement().setAttribute("aria-sort",i==="asc"?"ascending":"descending"),this.setColumnHeaderSortIcon(e,i)}setColumnHeaderSortIcon(e,i){var r=e.modules.sort.element,n;if(e.definition.headerSort&&typeof this.table.options.headerSortElement=="function"){for(;r.firstChild;)r.removeChild(r.firstChild);n=this.table.options.headerSortElement.call(this.table,e.getComponent(),i),typeof n=="object"?r.appendChild(n):r.innerHTML=n}}_sortItems(e,i){var r=i.length-1;e.sort((n,a)=>{for(var s,o=r;o>=0;o--){let l=i[o];if(s=this._sortRow(n,a,l.column,l.dir,l.params),s!==0)break}return s})}_sortRow(e,i,r,n,a){var s,o,l=n=="asc"?e:i,u=n=="asc"?i:e;return e=r.getFieldValue(l.getData()),i=r.getFieldValue(u.getData()),e=typeof e<"u"?e:"",i=typeof i<"u"?i:"",s=l.getComponent(),o=u.getComponent(),r.modules.sort.sorter.call(this,e,i,s,o,r.getComponent(),n,a)}}class Rge{constructor(e,i){this.columnCount=e,this.rowCount=i,this.columnString=[],this.columns=[],this.rows=[]}genColumns(e){var i=Math.max(this.columnCount,Math.max(...e.map(r=>r.length)));this.columnString=[],this.columns=[];for(let r=1;r<=i;r++)this.incrementChar(this.columnString.length-1),this.columns.push(this.columnString.join(""));return this.columns}genRows(e){var i=Math.max(this.rowCount,e.length);this.rows=[];for(let r=1;r<=i;r++)this.rows.push(r);return this.rows}incrementChar(e){let i=this.columnString[e];i?i!=="Z"?this.columnString[e]=String.fromCharCode(this.columnString[e].charCodeAt(0)+1):(this.columnString[e]="A",e?this.incrementChar(e-1):this.columnString.push("A")):this.columnString.push("A")}setRowCount(e){this.rowCount=e}setColumnCount(e){this.columnCount=e}}class KY{constructor(e){return this._sheet=e,new Proxy(this,{get:function(i,r,n){return typeof i[r]<"u"?i[r]:i._sheet.table.componentFunctionBinder.handle("sheet",i._sheet,r)}})}getTitle(){return this._sheet.title}getKey(){return this._sheet.key}getDefinition(){return this._sheet.getDefinition()}getData(){return this._sheet.getData()}setData(e){return this._sheet.setData(e)}clear(){return this._sheet.clear()}remove(){return this._sheet.remove()}active(){return this._sheet.active()}setTitle(e){return this._sheet.setTitle(e)}setRows(e){return this._sheet.setRows(e)}setColumns(e){return this._sheet.setColumns(e)}}class PH extends Ra{constructor(e,i){super(e.table),this.spreadsheetManager=e,this.definition=i,this.title=this.definition.title||"",this.key=this.definition.key||this.definition.title,this.rowCount=this.definition.rows,this.columnCount=this.definition.columns,this.data=this.definition.data||[],this.element=null,this.isActive=!1,this.grid=new Rge(this.columnCount,this.rowCount),this.defaultColumnDefinition={width:100,headerHozAlign:"center",headerSort:!1},this.columnDefinition=Object.assign(this.defaultColumnDefinition,this.options("spreadsheetColumnDefinition")),this.columnDefs=[],this.rowDefs=[],this.columnFields=[],this.columns=[],this.rows=[],this.scrollTop=null,this.scrollLeft=null,this.initialize(),this.dispatchExternal("sheetAdded",this.getComponent())}initialize(){this.initializeElement(),this.initializeColumns(),this.initializeRows()}reinitialize(){this.initializeColumns(),this.initializeRows()}initializeElement(){this.element=document.createElement("div"),this.element.classList.add("tabulator-spreadsheet-tab"),this.element.innerText=this.title,this.element.addEventListener("click",()=>{this.spreadsheetManager.loadSheet(this)})}initializeColumns(){this.grid.setColumnCount(this.columnCount),this.columnFields=this.grid.genColumns(this.data),this.columnDefs=[],this.columnFields.forEach(e=>{var i=Object.assign({},this.columnDefinition);i.field=e,i.title=e,this.columnDefs.push(i)})}initializeRows(){var e;this.grid.setRowCount(this.rowCount),e=this.grid.genRows(this.data),this.rowDefs=[],e.forEach((i,r)=>{var n={_id:i},a=this.data[r];a&&a.forEach((s,o)=>{var l=this.columnFields[o];l&&(n[l]=s)}),this.rowDefs.push(n)})}unload(){this.isActive=!1,this.scrollTop=this.table.rowManager.scrollTop,this.scrollLeft=this.table.rowManager.scrollLeft,this.data=this.getData(!0),this.element.classList.remove("tabulator-spreadsheet-tab-active")}load(){var e=!this.isActive;this.isActive=!0,this.table.blockRedraw(),this.table.setData([]),this.table.setColumns(this.columnDefs),this.table.setData(this.rowDefs),this.table.restoreRedraw(),e&&this.scrollTop!==null&&(this.table.rowManager.element.scrollLeft=this.scrollLeft,this.table.rowManager.element.scrollTop=this.scrollTop),this.element.classList.add("tabulator-spreadsheet-tab-active"),this.dispatchExternal("sheetLoaded",this.getComponent())}getComponent(){return new KY(this)}getDefinition(){return{title:this.title,key:this.key,rows:this.rowCount,columns:this.columnCount,data:this.getData()}}getData(e){var i=[],r,n,a;return this.rowDefs.forEach(s=>{var o=[];this.columnFields.forEach(l=>{o.push(s[l])}),i.push(o)}),!e&&!this.options("spreadsheetOutputFull")&&(r=i.map(s=>s.findLastIndex(o=>typeof o<"u")+1),n=Math.max(...r),a=r.findLastIndex(s=>s>0)+1,i=i.slice(0,a),i=i.map(s=>s.slice(0,n))),i}setData(e){this.data=e,this.reinitialize(),this.dispatchExternal("sheetUpdated",this.getComponent()),this.isActive&&this.load()}clear(){this.setData([])}setTitle(e){this.title=e,this.element.innerText=e,this.dispatchExternal("sheetUpdated",this.getComponent())}setRows(e){this.rowCount=e,this.initializeRows(),this.dispatchExternal("sheetUpdated",this.getComponent()),this.isActive&&this.load()}setColumns(e){this.columnCount=e,this.reinitialize(),this.dispatchExternal("sheetUpdated",this.getComponent()),this.isActive&&this.load()}remove(){this.spreadsheetManager.removeSheet(this)}destroy(){this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.dispatchExternal("sheetRemoved",this.getComponent())}active(){this.spreadsheetManager.loadSheet(this)}}class Cge extends si{static moduleName="spreadsheet";constructor(e){super(e),this.sheets=[],this.element=null,this.registerTableOption("spreadsheet",!1),this.registerTableOption("spreadsheetRows",50),this.registerTableOption("spreadsheetColumns",50),this.registerTableOption("spreadsheetColumnDefinition",{}),this.registerTableOption("spreadsheetOutputFull",!1),this.registerTableOption("spreadsheetData",!1),this.registerTableOption("spreadsheetSheets",!1),this.registerTableOption("spreadsheetSheetTabs",!1),this.registerTableOption("spreadsheetSheetTabsElement",!1),this.registerTableFunction("setSheets",this.setSheets.bind(this)),this.registerTableFunction("addSheet",this.addSheet.bind(this)),this.registerTableFunction("getSheets",this.getSheets.bind(this)),this.registerTableFunction("getSheetDefinitions",this.getSheetDefinitions.bind(this)),this.registerTableFunction("setSheetData",this.setSheetData.bind(this)),this.registerTableFunction("getSheet",this.getSheet.bind(this)),this.registerTableFunction("getSheetData",this.getSheetData.bind(this)),this.registerTableFunction("clearSheet",this.clearSheet.bind(this)),this.registerTableFunction("removeSheet",this.removeSheetFunc.bind(this)),this.registerTableFunction("activeSheet",this.activeSheetFunc.bind(this))}initialize(){this.options("spreadsheet")&&(this.subscribe("table-initialized",this.tableInitialized.bind(this)),this.subscribe("data-loaded",this.loadRemoteData.bind(this)),this.table.options.index="_id",this.options("spreadsheetData")&&this.options("spreadsheetSheets")&&(console.warn("You cannot use spreadsheetData and spreadsheetSheets at the same time, ignoring spreadsheetData"),this.table.options.spreadsheetData=!1),this.compatibilityCheck(),this.options("spreadsheetSheetTabs")&&this.initializeTabset())}compatibilityCheck(){this.options("data")&&console.warn("Do not use the data option when working with spreadsheets, use either spreadsheetData or spreadsheetSheets to pass data into the table"),this.options("pagination")&&console.warn("The spreadsheet module is not compatible with the pagination module"),this.options("groupBy")&&console.warn("The spreadsheet module is not compatible with the row grouping module"),this.options("responsiveCollapse")&&console.warn("The spreadsheet module is not compatible with the responsive collapse module")}initializeTabset(){this.element=document.createElement("div"),this.element.classList.add("tabulator-spreadsheet-tabs");var e=this.options("spreadsheetSheetTabsElement");e&&!(e instanceof HTMLElement)&&(e=document.querySelector(e),e||console.warn("Unable to find element matching spreadsheetSheetTabsElement selector:",this.options("spreadsheetSheetTabsElement"))),e?e.appendChild(this.element):this.footerAppend(this.element)}tableInitialized(){this.sheets.length?this.loadSheet(this.sheets[0]):this.options("spreadsheetSheets")?this.loadSheets(this.options("spreadsheetSheets")):this.options("spreadsheetData")&&this.loadData(this.options("spreadsheetData"))}loadRemoteData(e,i,r){return console.log("data",e,i,r),Array.isArray(e)?(this.table.dataLoader.clearAlert(),this.dispatchExternal("dataLoaded",e),!e.length||Array.isArray(e[0])?this.loadData(e):this.loadSheets(e)):console.error(`Spreadsheet Loading Error - Unable to process remote data due to invalid data type 
Expecting: array 
Received: `,typeof e,`
Data:     `,e),!1}loadData(e){var i={data:e};this.loadSheet(this.newSheet(i))}destroySheets(){this.sheets.forEach(e=>{e.destroy()}),this.sheets=[],this.activeSheet=null}loadSheets(e){Array.isArray(e)||(e=[]),this.destroySheets(),e.forEach(i=>{this.newSheet(i)}),this.loadSheet(this.sheets[0])}loadSheet(e){this.activeSheet!==e&&(this.activeSheet&&this.activeSheet.unload(),this.activeSheet=e,e.load())}newSheet(e={}){var i;return e.rows||(e.rows=this.options("spreadsheetRows")),e.columns||(e.columns=this.options("spreadsheetColumns")),i=new PH(this,e),this.sheets.push(i),this.element&&this.element.appendChild(i.element),i}removeSheet(e){var i=this.sheets.indexOf(e),r;this.sheets.length>1?i>-1&&(this.sheets.splice(i,1),e.destroy(),this.activeSheet===e&&(r=this.sheets[i-1]||this.sheets[0],r?this.loadSheet(r):this.activeSheet=null)):console.warn("Unable to remove sheet, at least one sheet must be active")}lookupSheet(e){return e?e instanceof PH?e:e instanceof KY?e._sheet:this.sheets.find(i=>i.key===e)||!1:this.activeSheet}setSheets(e){return this.loadSheets(e),this.getSheets()}addSheet(e){return this.newSheet(e).getComponent()}getSheetDefinitions(){return this.sheets.map(e=>e.getDefinition())}getSheets(){return this.sheets.map(e=>e.getComponent())}getSheet(e){var i=this.lookupSheet(e);return i?i.getComponent():!1}setSheetData(e,i){e&&!i&&(i=e,e=!1);var r=this.lookupSheet(e);return r?r.setData(i):!1}getSheetData(e){var i=this.lookupSheet(e);return i?i.getData():!1}clearSheet(e){var i=this.lookupSheet(e);return i?i.clear():!1}removeSheetFunc(e){var i=this.lookupSheet(e);i&&this.removeSheet(i)}activeSheetFunc(e){var i=this.lookupSheet(e);return i?this.loadSheet(i):!1}}class Mge extends si{static moduleName="tooltip";constructor(e){super(e),this.tooltipSubscriber=null,this.headerSubscriber=null,this.timeout=null,this.popupInstance=null,this.registerTableOption("tooltipDelay",300),this.registerColumnOption("tooltip"),this.registerColumnOption("headerTooltip")}initialize(){this.deprecatedOptionsCheck(),this.subscribe("column-init",this.initializeColumn.bind(this))}deprecatedOptionsCheck(){}initializeColumn(e){e.definition.headerTooltip&&!this.headerSubscriber&&(this.headerSubscriber=!0,this.subscribe("column-mousemove",this.mousemoveCheck.bind(this,"headerTooltip")),this.subscribe("column-mouseout",this.mouseoutCheck.bind(this,"headerTooltip"))),e.definition.tooltip&&!this.tooltipSubscriber&&(this.tooltipSubscriber=!0,this.subscribe("cell-mousemove",this.mousemoveCheck.bind(this,"tooltip")),this.subscribe("cell-mouseout",this.mouseoutCheck.bind(this,"tooltip")))}mousemoveCheck(e,i,r){var n=e==="tooltip"?r.column.definition.tooltip:r.definition.headerTooltip;n&&(this.clearPopup(),this.timeout=setTimeout(this.loadTooltip.bind(this,i,r,n),this.table.options.tooltipDelay))}mouseoutCheck(e,i,r){this.popupInstance||this.clearPopup()}clearPopup(e,i,r){clearTimeout(this.timeout),this.timeout=null,this.popupInstance&&this.popupInstance.hide()}loadTooltip(e,i,r){var n,a,s;function o(l){a=l}typeof r=="function"&&(r=r(e,i.getComponent(),o)),r instanceof HTMLElement?n=r:(n=document.createElement("div"),r===!0&&(i instanceof Dw?r=i.value:i.definition.field?this.langBind("columns|"+i.definition.field,l=>{n.innerHTML=r=l||i.definition.title}):r=i.definition.title),n.innerHTML=r),(r||r===0||r===!1)&&(n.classList.add("tabulator-tooltip"),n.addEventListener("mousemove",l=>l.preventDefault()),this.popupInstance=this.popup(n),typeof a=="function"&&this.popupInstance.renderCallback(a),s=this.popupInstance.containerEventCoords(e),this.popupInstance.show(s.x+15,s.y+15).hideOnBlur(()=>{this.dispatchExternal("TooltipClosed",i.getComponent()),this.popupInstance=null}),this.dispatchExternal("TooltipOpened",i.getComponent()))}}var Nge={integer:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:(e=Number(e),!isNaN(e)&&isFinite(e)&&Math.floor(e)===e)},float:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:(e=Number(e),!isNaN(e)&&isFinite(e)&&e%1!==0)},numeric:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:!isNaN(e)},string:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:isNaN(e)},alphanumeric:function(t,e,i){if(e===""||e===null||typeof e>"u")return!0;var r=new RegExp(/^[a-z0-9]+$/i);return r.test(e)},max:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:parseFloat(e)<=i},min:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:parseFloat(e)>=i},starts:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:String(e).toLowerCase().startsWith(String(i).toLowerCase())},ends:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:String(e).toLowerCase().endsWith(String(i).toLowerCase())},minLength:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:String(e).length>=i},maxLength:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:String(e).length<=i},in:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:(typeof i=="string"&&(i=i.split("|")),i.indexOf(e)>-1)},regex:function(t,e,i){if(e===""||e===null||typeof e>"u")return!0;var r=new RegExp(i);return r.test(e)},unique:function(t,e,i){if(e===""||e===null||typeof e>"u")return!0;var r=!0,n=t.getData(),a=t.getColumn()._getSelf();return this.table.rowManager.rows.forEach(function(s){var o=s.getData();o!==n&&e==a.getFieldValue(o)&&(r=!1)}),r},required:function(t,e,i){return e!==""&&e!==null&&typeof e<"u"}};class M1 extends si{static moduleName="validate";static validators=Nge;constructor(e){super(e),this.invalidCells=[],this.registerTableOption("validationMode","blocking"),this.registerColumnOption("validator"),this.registerTableFunction("getInvalidCells",this.getInvalidCells.bind(this)),this.registerTableFunction("clearCellValidation",this.userClearCellValidation.bind(this)),this.registerTableFunction("validate",this.userValidate.bind(this)),this.registerComponentFunction("cell","isValid",this.cellIsValid.bind(this)),this.registerComponentFunction("cell","clearValidation",this.clearValidation.bind(this)),this.registerComponentFunction("cell","validate",this.cellValidate.bind(this)),this.registerComponentFunction("column","validate",this.columnValidate.bind(this)),this.registerComponentFunction("row","validate",this.rowValidate.bind(this))}initialize(){this.subscribe("cell-delete",this.clearValidation.bind(this)),this.subscribe("column-layout",this.initializeColumnCheck.bind(this)),this.subscribe("edit-success",this.editValidate.bind(this)),this.subscribe("edit-editor-clear",this.editorClear.bind(this)),this.subscribe("edit-edited-clear",this.editedClear.bind(this))}editValidate(e,i,r){var n=this.table.options.validationMode!=="manual"?this.validate(e.column.modules.validate,e,i):!0;return n!==!0&&setTimeout(()=>{e.getElement().classList.add("tabulator-validation-fail"),this.dispatchExternal("validationFailed",e.getComponent(),i,n)}),n}editorClear(e,i){i&&e.column.modules.validate&&this.cellValidate(e),e.getElement().classList.remove("tabulator-validation-fail")}editedClear(e){e.modules.validate&&(e.modules.validate.invalid=!1)}cellIsValid(e){return e.modules.validate&&e.modules.validate.invalid||!0}cellValidate(e){return this.validate(e.column.modules.validate,e,e.getValue())}columnValidate(e){var i=[];return e.cells.forEach(r=>{this.cellValidate(r)!==!0&&i.push(r.getComponent())}),i.length?i:!0}rowValidate(e){var i=[];return e.cells.forEach(r=>{this.cellValidate(r)!==!0&&i.push(r.getComponent())}),i.length?i:!0}userClearCellValidation(e){e||(e=this.getInvalidCells()),Array.isArray(e)||(e=[e]),e.forEach(i=>{this.clearValidation(i._getSelf())})}userValidate(e){var i=[];return this.table.rowManager.rows.forEach(r=>{r=r.getComponent();var n=r.validate();n!==!0&&(i=i.concat(n))}),i.length?i:!0}initializeColumnCheck(e){typeof e.definition.validator<"u"&&this.initializeColumn(e)}initializeColumn(e){var i=this,r=[],n;e.definition.validator&&(Array.isArray(e.definition.validator)?e.definition.validator.forEach(a=>{n=i._extractValidator(a),n&&r.push(n)}):(n=this._extractValidator(e.definition.validator),n&&r.push(n)),e.modules.validate=r.length?r:!1)}_extractValidator(e){var i,r,n;switch(typeof e){case"string":return n=e.indexOf(":"),n>-1?(i=e.substring(0,n),r=e.substring(n+1)):i=e,this._buildValidator(i,r);case"function":return this._buildValidator(e);case"object":return this._buildValidator(e.type,e.parameters)}}_buildValidator(e,i){var r=typeof e=="function"?e:M1.validators[e];return r?{type:typeof e=="function"?"function":e,func:r,params:i}:(console.warn("Validator Setup Error - No matching validator found:",e),!1)}validate(e,i,r){var n=this,a=[],s=this.invalidCells.indexOf(i);return e&&e.forEach(o=>{o.func.call(n,i.getComponent(),r,o.params)||a.push({type:o.type,parameters:o.params})}),i.modules.validate||(i.modules.validate={}),a.length?(i.modules.validate.invalid=a,this.table.options.validationMode!=="manual"&&i.getElement().classList.add("tabulator-validation-fail"),s==-1&&this.invalidCells.push(i)):(i.modules.validate.invalid=!1,i.getElement().classList.remove("tabulator-validation-fail"),s>-1&&this.invalidCells.splice(s,1)),a.length?a:!0}getInvalidCells(){var e=[];return this.invalidCells.forEach(i=>{e.push(i.getComponent())}),e}clearValidation(e){var i;e.modules.validate&&e.modules.validate.invalid&&(e.getElement().classList.remove("tabulator-validation-fail"),e.modules.validate.invalid=!1,i=this.invalidCells.indexOf(e),i>-1&&this.invalidCells.splice(i,1))}}var DA=Object.freeze({__proto__:null,AccessorModule:ND,AjaxModule:Tg,ClipboardModule:AD,ColumnCalcsModule:Dg,DataTreeModule:Cme,DownloadModule:kD,EditModule:P1,ExportModule:Ay,FilterModule:Gf,FormatModule:Pg,FrozenColumnsModule:Uhe,FrozenRowsModule:The,GroupRowsModule:Phe,HistoryModule:OD,HtmlTableImportModule:Ahe,ImportModule:E1,InteractionModule:_he,KeybindingsModule:ky,MenuModule:Vhe,MoveColumnsModule:jhe,MoveRowsModule:xD,MutatorModule:FD,PageModule:R1,PersistenceModule:_u,PopupModule:Jhe,PrintModule:Qhe,ReactiveDataModule:Zhe,ResizeColumnsModule:ege,ResizeRowsModule:tge,ResizeTableModule:ige,ResponsiveLayoutModule:age,SelectRangeModule:vge,SelectRowModule:lge,SortModule:Oy,SpreadsheetModule:Cge,TooltipModule:Mge,ValidateModule:M1}),Age={debugEventsExternal:!1,debugEventsInternal:!1,debugInvalidOptions:!0,debugInvalidComponentFuncs:!0,debugInitialization:!0,debugDeprecation:!0,height:!1,minHeight:!1,maxHeight:!1,columnHeaderVertAlign:"top",popupContainer:!1,columns:[],columnDefaults:{},rowHeader:!1,data:!1,autoColumns:!1,autoColumnsDefinitions:!1,nestedFieldSeparator:".",footerElement:!1,index:"id",textDirection:"auto",addRowPos:"bottom",headerVisible:!0,renderVertical:"virtual",renderHorizontal:"basic",renderVerticalBuffer:0,scrollToRowPosition:"top",scrollToRowIfVisible:!0,scrollToColumnPosition:"left",scrollToColumnIfVisible:!0,rowFormatter:!1,rowFormatterPrint:null,rowFormatterClipboard:null,rowFormatterHtmlOutput:null,rowHeight:null,placeholder:!1,dataLoader:!0,dataLoaderLoading:!1,dataLoaderError:!1,dataLoaderErrorTimeout:3e3,dataSendParams:{},dataReceiveParams:{},dependencies:{}};class XY{constructor(e,i,r={}){this.table=e,this.msgType=i,this.registeredDefaults=Object.assign({},r)}register(e,i){this.registeredDefaults[e]=i}generate(e,i={}){var r=Object.assign({},this.registeredDefaults),n=this.table.options.debugInvalidOptions||i.debugInvalidOptions===!0;Object.assign(r,e);for(let a in i)r.hasOwnProperty(a)||(n&&console.warn("Invalid "+this.msgType+" option:",a),r[a]=i.key);for(let a in r)a in i?r[a]=i[a]:Array.isArray(r[a])?r[a]=Object.assign([],r[a]):typeof r[a]=="object"&&r[a]!==null?r[a]=Object.assign({},r[a]):typeof r[a]>"u"&&delete r[a];return r}}class $E extends Ra{constructor(e){super(e),this.elementVertical=e.rowManager.element,this.elementHorizontal=e.columnManager.element,this.tableElement=e.rowManager.tableElement,this.verticalFillMode="fit"}initialize(){}clearRows(){}clearColumns(){}reinitializeColumnWidths(e){}renderRows(){}renderColumns(){}rerenderRows(e){e&&e()}rerenderColumns(e,i){}renderRowCells(e){}rerenderRowCells(e,i){}scrollColumns(e,i){}scrollRows(e,i){}resize(){}scrollToRow(e){}scrollToRowNearestTop(e){}visibleRows(e){return[]}rows(){return this.table.rowManager.getDisplayRows()}styleRow(e,i){var r=e.getElement();i%2?(r.classList.add("tabulator-row-even"),r.classList.remove("tabulator-row-odd")):(r.classList.add("tabulator-row-odd"),r.classList.remove("tabulator-row-even"))}clear(){this.clearRows(),this.clearColumns()}render(){this.renderRows(),this.renderColumns()}rerender(e){this.rerenderRows(),this.rerenderColumns()}scrollToRowPosition(e,i,r){var n=this.rows().indexOf(e),a=e.getElement(),s=0;return new Promise((o,l)=>{if(n>-1){if(typeof r>"u"&&(r=this.table.options.scrollToRowIfVisible),!r&&gr.elVisible(a)&&(s=gr.elOffset(a).top-gr.elOffset(this.elementVertical).top,s>0&&s<this.elementVertical.clientHeight-a.offsetHeight))return o(),!1;switch(typeof i>"u"&&(i=this.table.options.scrollToRowPosition),i==="nearest"&&(i=this.scrollToRowNearestTop(e)?"top":"bottom"),this.scrollToRow(e),i){case"middle":case"center":this.elementVertical.scrollHeight-this.elementVertical.scrollTop==this.elementVertical.clientHeight?this.elementVertical.scrollTop=this.elementVertical.scrollTop+(a.offsetTop-this.elementVertical.scrollTop)-(this.elementVertical.scrollHeight-a.offsetTop)/2:this.elementVertical.scrollTop=this.elementVertical.scrollTop-this.elementVertical.clientHeight/2;break;case"bottom":this.elementVertical.scrollHeight-this.elementVertical.scrollTop==this.elementVertical.clientHeight?this.elementVertical.scrollTop=this.elementVertical.scrollTop-(this.elementVertical.scrollHeight-a.offsetTop)+a.offsetHeight:this.elementVertical.scrollTop=this.elementVertical.scrollTop-this.elementVertical.clientHeight+a.offsetHeight;break;case"top":this.elementVertical.scrollTop=a.offsetTop;break}o()}else console.warn("Scroll Error - Row not visible"),l("Scroll Error - Row not visible")})}}class kge extends $E{constructor(e){super(e)}renderRowCells(e,i){const r=document.createDocumentFragment();e.cells.forEach(n=>{r.appendChild(n.getElement())}),e.element.appendChild(r),i||e.cells.forEach(n=>{n.cellRendered()})}reinitializeColumnWidths(e){e.forEach(function(i){i.reinitializeWidth()})}}class Oge extends $E{constructor(e){super(e),this.leftCol=0,this.rightCol=0,this.scrollLeft=0,this.vDomScrollPosLeft=0,this.vDomScrollPosRight=0,this.vDomPadLeft=0,this.vDomPadRight=0,this.fitDataColAvg=0,this.windowBuffer=200,this.visibleRows=null,this.initialized=!1,this.isFitData=!1,this.columns=[]}initialize(){this.compatibilityCheck(),this.layoutCheck(),this.vertScrollListen()}compatibilityCheck(){this.options("layout")=="fitDataTable"&&console.warn("Horizontal Virtual DOM is not compatible with fitDataTable layout mode"),this.options("responsiveLayout")&&console.warn("Horizontal Virtual DOM is not compatible with responsive columns"),this.options("rtl")&&console.warn("Horizontal Virtual DOM is not currently compatible with RTL text direction")}layoutCheck(){this.isFitData=this.options("layout").startsWith("fitData")}vertScrollListen(){this.subscribe("scroll-vertical",this.clearVisRowCache.bind(this)),this.subscribe("data-refreshed",this.clearVisRowCache.bind(this))}clearVisRowCache(){this.visibleRows=null}renderColumns(e,i){this.dataChange()}scrollColumns(e,i){this.scrollLeft!=e&&(this.scrollLeft=e,this.scroll(e-(this.vDomScrollPosLeft+this.windowBuffer)))}calcWindowBuffer(){var e=this.elementVertical.clientWidth;this.table.columnManager.columnsByIndex.forEach(i=>{if(i.visible){var r=i.getWidth();r>e&&(e=r)}}),this.windowBuffer=e*2}rerenderColumns(e,i){var r={cols:this.columns,leftCol:this.leftCol,rightCol:this.rightCol},n=0;e&&!this.initialized||(this.clear(),this.calcWindowBuffer(),this.scrollLeft=this.elementVertical.scrollLeft,this.vDomScrollPosLeft=this.scrollLeft-this.windowBuffer,this.vDomScrollPosRight=this.scrollLeft+this.elementVertical.clientWidth+this.windowBuffer,this.table.columnManager.columnsByIndex.forEach(a=>{var s={},o;a.visible&&(a.modules.frozen||(o=a.getWidth(),s.leftPos=n,s.rightPos=n+o,s.width=o,this.isFitData&&(s.fitDataCheck=a.modules.vdomHoz?a.modules.vdomHoz.fitDataCheck:!0),n+o>this.vDomScrollPosLeft&&n<this.vDomScrollPosRight?(this.leftCol==-1&&(this.leftCol=this.columns.length,this.vDomPadLeft=n),this.rightCol=this.columns.length):this.leftCol!==-1&&(this.vDomPadRight+=o),this.columns.push(a),a.modules.vdomHoz=s,n+=o))}),this.tableElement.style.paddingLeft=this.vDomPadLeft+"px",this.tableElement.style.paddingRight=this.vDomPadRight+"px",this.initialized=!0,i||(!e||this.reinitChanged(r))&&this.reinitializeRows(),this.elementVertical.scrollLeft=this.scrollLeft)}renderRowCells(e){if(this.initialized)this.initializeRow(e);else{const i=document.createDocumentFragment();e.cells.forEach(r=>{i.appendChild(r.getElement())}),e.element.appendChild(i),e.cells.forEach(r=>{r.cellRendered()})}}rerenderRowCells(e,i){this.reinitializeRow(e,i)}reinitializeColumnWidths(e){for(let i=this.leftCol;i<=this.rightCol;i++){let r=this.columns[i];r&&r.reinitializeWidth()}}deinitialize(){this.initialized=!1}clear(){this.columns=[],this.leftCol=-1,this.rightCol=0,this.vDomScrollPosLeft=0,this.vDomScrollPosRight=0,this.vDomPadLeft=0,this.vDomPadRight=0}dataChange(){var e=!1,i,r;if(this.isFitData){if(this.table.columnManager.columnsByIndex.forEach(n=>{!n.definition.width&&n.visible&&(e=!0)}),e&&this.table.rowManager.getDisplayRows().length&&(this.vDomScrollPosRight=this.scrollLeft+this.elementVertical.clientWidth+this.windowBuffer,i=this.chain("rows-sample",[1],[],()=>this.table.rowManager.getDisplayRows())[0],i)){r=i.getElement(),i.generateCells(),this.tableElement.appendChild(r);for(let n=0;n<i.cells.length;n++){let a=i.cells[n];r.appendChild(a.getElement()),a.column.reinitializeWidth()}r.parentNode.removeChild(r),this.rerenderColumns(!1,!0)}}else this.options("layout")==="fitColumns"&&(this.layoutRefresh(),this.rerenderColumns(!1,!0))}reinitChanged(e){var i=!0;return e.cols.length!==this.columns.length||e.leftCol!==this.leftCol||e.rightCol!==this.rightCol?!0:(e.cols.forEach((r,n)=>{r!==this.columns[n]&&(i=!1)}),!i)}reinitializeRows(){var e=this.getVisibleRows(),i=this.table.rowManager.getRows().filter(r=>!e.includes(r));e.forEach(r=>{this.reinitializeRow(r,!0)}),i.forEach(r=>{r.deinitialize()})}getVisibleRows(){return this.visibleRows||(this.visibleRows=this.table.rowManager.getVisibleRows()),this.visibleRows}scroll(e){this.vDomScrollPosLeft+=e,this.vDomScrollPosRight+=e,Math.abs(e)>this.windowBuffer/2?this.rerenderColumns():e>0?(this.addColRight(),this.removeColLeft()):(this.addColLeft(),this.removeColRight())}colPositionAdjust(e,i,r){for(let n=e;n<i;n++){let a=this.columns[n];a.modules.vdomHoz.leftPos+=r,a.modules.vdomHoz.rightPos+=r}}addColRight(){for(var e=!1,i=!0;i;){let r=this.columns[this.rightCol+1];r&&r.modules.vdomHoz.leftPos<=this.vDomScrollPosRight?(e=!0,this.getVisibleRows().forEach(n=>{if(n.type!=="group"){var a=n.getCell(r);n.getElement().insertBefore(a.getElement(),n.getCell(this.columns[this.rightCol]).getElement().nextSibling),a.cellRendered()}}),this.fitDataColActualWidthCheck(r),this.rightCol++,this.getVisibleRows().forEach(n=>{n.type!=="group"&&(n.modules.vdomHoz.rightCol=this.rightCol)}),this.rightCol>=this.columns.length-1?this.vDomPadRight=0:this.vDomPadRight-=r.getWidth()):i=!1}e&&(this.tableElement.style.paddingRight=this.vDomPadRight+"px")}addColLeft(){for(var e=!1,i=!0;i;){let r=this.columns[this.leftCol-1];if(r)if(r.modules.vdomHoz.rightPos>=this.vDomScrollPosLeft){e=!0,this.getVisibleRows().forEach(a=>{if(a.type!=="group"){var s=a.getCell(r);a.getElement().insertBefore(s.getElement(),a.getCell(this.columns[this.leftCol]).getElement()),s.cellRendered()}}),this.leftCol--,this.getVisibleRows().forEach(a=>{a.type!=="group"&&(a.modules.vdomHoz.leftCol=this.leftCol)}),this.leftCol<=0?this.vDomPadLeft=0:this.vDomPadLeft-=r.getWidth();let n=this.fitDataColActualWidthCheck(r);n&&(this.scrollLeft=this.elementVertical.scrollLeft=this.elementVertical.scrollLeft+n,this.vDomPadRight-=n)}else i=!1;else i=!1}e&&(this.tableElement.style.paddingLeft=this.vDomPadLeft+"px")}removeColRight(){for(var e=!1,i=!0;i;){let r=this.columns[this.rightCol];r&&r.modules.vdomHoz.leftPos>this.vDomScrollPosRight?(e=!0,this.getVisibleRows().forEach(n=>{if(n.type!=="group"){var a=n.getCell(r);try{n.getElement().removeChild(a.getElement())}catch(s){console.warn("Could not removeColRight",s.message)}}}),this.vDomPadRight+=r.getWidth(),this.rightCol--,this.getVisibleRows().forEach(n=>{n.type!=="group"&&(n.modules.vdomHoz.rightCol=this.rightCol)})):i=!1}e&&(this.tableElement.style.paddingRight=this.vDomPadRight+"px")}removeColLeft(){for(var e=!1,i=!0;i;){let r=this.columns[this.leftCol];r&&r.modules.vdomHoz.rightPos<this.vDomScrollPosLeft?(e=!0,this.getVisibleRows().forEach(n=>{if(n.type!=="group"){var a=n.getCell(r);try{n.getElement().removeChild(a.getElement())}catch(s){console.warn("Could not removeColLeft",s.message)}}}),this.vDomPadLeft+=r.getWidth(),this.leftCol++,this.getVisibleRows().forEach(n=>{n.type!=="group"&&(n.modules.vdomHoz.leftCol=this.leftCol)})):i=!1}e&&(this.tableElement.style.paddingLeft=this.vDomPadLeft+"px")}fitDataColActualWidthCheck(e){var i,r;return e.modules.vdomHoz.fitDataCheck&&(e.reinitializeWidth(),i=e.getWidth(),r=i-e.modules.vdomHoz.width,r&&(e.modules.vdomHoz.rightPos+=r,e.modules.vdomHoz.width=i,this.colPositionAdjust(this.columns.indexOf(e)+1,this.columns.length,r)),e.modules.vdomHoz.fitDataCheck=!1),r}initializeRow(e){if(e.type!=="group"){e.modules.vdomHoz={leftCol:this.leftCol,rightCol:this.rightCol},this.table.modules.frozenColumns&&this.table.modules.frozenColumns.leftColumns.forEach(i=>{this.appendCell(e,i)});for(let i=this.leftCol;i<=this.rightCol;i++)this.appendCell(e,this.columns[i]);this.table.modules.frozenColumns&&this.table.modules.frozenColumns.rightColumns.forEach(i=>{this.appendCell(e,i)})}}appendCell(e,i){if(i&&i.visible){let r=e.getCell(i);e.getElement().appendChild(r.getElement()),r.cellRendered()}}reinitializeRow(e,i){if(e.type!=="group"&&(i||!e.modules.vdomHoz||e.modules.vdomHoz.leftCol!==this.leftCol||e.modules.vdomHoz.rightCol!==this.rightCol)){for(var r=e.getElement();r.firstChild;)r.removeChild(r.firstChild);this.initializeRow(e)}}}class xge extends Ra{constructor(e){super(e),this.blockHozScrollEvent=!1,this.headersElement=null,this.contentsElement=null,this.rowHeader=null,this.element=null,this.columns=[],this.columnsByIndex=[],this.columnsByField={},this.scrollLeft=0,this.optionsList=new XY(this.table,"column definition",YY),this.redrawBlock=!1,this.redrawBlockUpdate=null,this.renderer=null}initialize(){this.initializeRenderer(),this.headersElement=this.createHeadersElement(),this.contentsElement=this.createHeaderContentsElement(),this.element=this.createHeaderElement(),this.contentsElement.insertBefore(this.headersElement,this.contentsElement.firstChild),this.element.insertBefore(this.contentsElement,this.element.firstChild),this.initializeScrollWheelWatcher(),this.subscribe("scroll-horizontal",this.scrollHorizontal.bind(this)),this.subscribe("scrollbar-vertical",this.padVerticalScrollbar.bind(this))}padVerticalScrollbar(e){this.table.rtl?this.headersElement.style.marginLeft=e+"px":this.headersElement.style.marginRight=e+"px"}initializeRenderer(){var e,i={virtual:Oge,basic:kge};typeof this.table.options.renderHorizontal=="string"?e=i[this.table.options.renderHorizontal]:e=this.table.options.renderHorizontal,e?(this.renderer=new e(this.table,this.element,this.tableElement),this.renderer.initialize()):console.error("Unable to find matching renderer:",this.table.options.renderHorizontal)}createHeadersElement(){var e=document.createElement("div");return e.classList.add("tabulator-headers"),e.setAttribute("role","row"),e}createHeaderContentsElement(){var e=document.createElement("div");return e.classList.add("tabulator-header-contents"),e.setAttribute("role","rowgroup"),e}createHeaderElement(){var e=document.createElement("div");return e.classList.add("tabulator-header"),e.setAttribute("role","rowgroup"),this.table.options.headerVisible||e.classList.add("tabulator-header-hidden"),e}getElement(){return this.element}getContentsElement(){return this.contentsElement}getHeadersElement(){return this.headersElement}scrollHorizontal(e){this.contentsElement.scrollLeft=e,this.scrollLeft=e,this.renderer.scrollColumns(e)}initializeScrollWheelWatcher(){this.contentsElement.addEventListener("wheel",e=>{var i;e.deltaX&&(i=this.contentsElement.scrollLeft+e.deltaX,this.table.rowManager.scrollHorizontal(i),this.table.columnManager.scrollHorizontal(i))})}generateColumnsFromRowData(e){var i=[],r={},n=this.table.options.autoColumns==="full"?e:[e[0]],a=this.table.options.autoColumnsDefinitions;if(e&&e.length){if(n.forEach(s=>{Object.keys(s).forEach((o,l)=>{let u=s[o],c;r[o]?r[o]!==!0&&typeof u<"u"&&(r[o].sorter=this.calculateSorterFromValue(u),r[o]=!0):(c={field:o,title:o,sorter:this.calculateSorterFromValue(u)},i.splice(l,0,c),r[o]=typeof u>"u"?c:!0)})}),a)switch(typeof a){case"function":this.table.options.columns=a.call(this.table,i);break;case"object":Array.isArray(a)?i.forEach(s=>{var o=a.find(l=>l.field===s.field);o&&Object.assign(s,o)}):i.forEach(s=>{a[s.field]&&Object.assign(s,a[s.field])}),this.table.options.columns=i;break}else this.table.options.columns=i;this.setColumns(this.table.options.columns)}}calculateSorterFromValue(e){var i;switch(typeof e){case"undefined":i="string";break;case"boolean":i="boolean";break;case"number":i="number";break;case"object":Array.isArray(e)?i="array":i="string";break;default:!isNaN(e)&&e!==""?i="number":e.match(/((^[0-9]+[a-z]+)|(^[a-z]+[0-9]+))+$/i)?i="alphanum":i="string";break}return i}setColumns(e,i){for(;this.headersElement.firstChild;)this.headersElement.removeChild(this.headersElement.firstChild);this.columns=[],this.columnsByIndex=[],this.columnsByField={},this.dispatch("columns-loading"),this.dispatchExternal("columnsLoading"),this.table.options.rowHeader&&(this.rowHeader=new Vu(this.table.options.rowHeader===!0?{}:this.table.options.rowHeader,this,!0),this.columns.push(this.rowHeader),this.headersElement.appendChild(this.rowHeader.getElement()),this.rowHeader.columnRendered()),e.forEach((r,n)=>{this._addColumn(r)}),this._reIndexColumns(),this.dispatch("columns-loaded"),this.subscribedExternal("columnsLoaded")&&this.dispatchExternal("columnsLoaded",this.getComponents()),this.rerenderColumns(!1,!0),this.redraw(!0)}_addColumn(e,i,r){var n=new Vu(e,this),a=n.getElement(),s=r&&this.findColumnIndex(r);if(i&&this.rowHeader&&(!r||r===this.rowHeader)&&(i=!1,r=this.rowHeader,s=0),r&&s>-1){var o=r.getTopColumn(),l=this.columns.indexOf(o),u=o.getElement();i?(this.columns.splice(l,0,n),u.parentNode.insertBefore(a,u)):(this.columns.splice(l+1,0,n),u.parentNode.insertBefore(a,u.nextSibling))}else i?(this.columns.unshift(n),this.headersElement.insertBefore(n.getElement(),this.headersElement.firstChild)):(this.columns.push(n),this.headersElement.appendChild(n.getElement()));return n.columnRendered(),n}registerColumnField(e){e.definition.field&&(this.columnsByField[e.definition.field]=e)}registerColumnPosition(e){this.columnsByIndex.push(e)}_reIndexColumns(){this.columnsByIndex=[],this.columns.forEach(function(e){e.reRegisterPosition()})}verticalAlignHeaders(){var e=0;this.redrawBlock||(this.headersElement.style.height="",this.columns.forEach(i=>{i.clearVerticalAlign()}),this.columns.forEach(i=>{var r=i.getHeight();r>e&&(e=r)}),this.headersElement.style.height=e+"px",this.columns.forEach(i=>{i.verticalAlign(this.table.options.columnHeaderVertAlign,e)}),this.table.rowManager.adjustTableSize())}findColumn(e){var i;if(typeof e=="object"){if(e instanceof Vu)return e;if(e instanceof qY)return e._getSelf()||!1;if(typeof HTMLElement<"u"&&e instanceof HTMLElement)return i=[],this.columns.forEach(n=>{i.push(n),i=i.concat(n.getColumns(!0))}),i.find(n=>n.element===e)||!1}else return this.columnsByField[e]||!1;return!1}getColumnByField(e){return this.columnsByField[e]}getColumnsByFieldRoot(e){var i=[];return Object.keys(this.columnsByField).forEach(r=>{var n=this.table.options.nestedFieldSeparator?r.split(this.table.options.nestedFieldSeparator)[0]:r;n===e&&i.push(this.columnsByField[r])}),i}getColumnByIndex(e){return this.columnsByIndex[e]}getFirstVisibleColumn(){var e=this.columnsByIndex.findIndex(i=>i.visible);return e>-1?this.columnsByIndex[e]:!1}getVisibleColumnsByIndex(){return this.columnsByIndex.filter(e=>e.visible)}getColumns(){return this.columns}findColumnIndex(e){return this.columnsByIndex.findIndex(i=>e===i)}getRealColumns(){return this.columnsByIndex}traverse(e){this.columnsByIndex.forEach((i,r)=>{e(i,r)})}getDefinitions(e){var i=[];return this.columnsByIndex.forEach(r=>{(!e||e&&r.visible)&&i.push(r.getDefinition())}),i}getDefinitionTree(){var e=[];return this.columns.forEach(i=>{e.push(i.getDefinition(!0))}),e}getComponents(e){var i=[],r=e?this.columns:this.columnsByIndex;return r.forEach(n=>{i.push(n.getComponent())}),i}getWidth(){var e=0;return this.columnsByIndex.forEach(i=>{i.visible&&(e+=i.getWidth())}),e}moveColumn(e,i,r){i.element.parentNode.insertBefore(e.element,i.element),r&&i.element.parentNode.insertBefore(i.element,e.element),this.moveColumnActual(e,i,r),this.verticalAlignHeaders(),this.table.rowManager.reinitialize()}moveColumnActual(e,i,r){e.parent.isGroup?this._moveColumnInArray(e.parent.columns,e,i,r):this._moveColumnInArray(this.columns,e,i,r),this._moveColumnInArray(this.columnsByIndex,e,i,r,!0),this.rerenderColumns(!0),this.dispatch("column-moved",e,i,r),this.subscribedExternal("columnMoved")&&this.dispatchExternal("columnMoved",e.getComponent(),this.table.columnManager.getComponents())}_moveColumnInArray(e,i,r,n,a){var s=e.indexOf(i),o,l=[];s>-1&&(e.splice(s,1),o=e.indexOf(r),o>-1?n&&(o=o+1):o=s,e.splice(o,0,i),a&&(l=this.chain("column-moving-rows",[i,r,n],null,[])||[],l=l.concat(this.table.rowManager.rows),l.forEach(function(u){if(u.cells.length){var c=u.cells.splice(s,1)[0];u.cells.splice(o,0,c)}})))}scrollToColumn(e,i,r){var n=0,a=e.getLeftOffset(),s=0,o=e.getElement();return new Promise((l,u)=>{if(typeof i>"u"&&(i=this.table.options.scrollToColumnPosition),typeof r>"u"&&(r=this.table.options.scrollToColumnIfVisible),e.visible){switch(i){case"middle":case"center":s=-this.element.clientWidth/2;break;case"right":s=o.clientWidth-this.headersElement.clientWidth;break}if(!r&&a>0&&a+o.offsetWidth<this.element.clientWidth)return!1;n=a+s,n=Math.max(Math.min(n,this.table.rowManager.element.scrollWidth-this.table.rowManager.element.clientWidth),0),this.table.rowManager.scrollHorizontal(n),this.scrollHorizontal(n),l()}else console.warn("Scroll Error - Column not visible"),u("Scroll Error - Column not visible")})}generateCells(e){var i=[];return this.columnsByIndex.forEach(r=>{i.push(r.generateCell(e))}),i}getFlexBaseWidth(){var e=this.table.element.clientWidth,i=0;return this.table.rowManager.element.scrollHeight>this.table.rowManager.element.clientHeight&&(e-=this.table.rowManager.element.offsetWidth-this.table.rowManager.element.clientWidth),this.columnsByIndex.forEach(function(r){var n,a,s;r.visible&&(n=r.definition.width||0,a=parseInt(r.minWidth),typeof n=="string"?n.indexOf("%")>-1?s=e/100*parseInt(n):s=parseInt(n):s=n,i+=s>a?s:a)}),i}addColumn(e,i,r){return new Promise((n,a)=>{var s=this._addColumn(e,i,r);this._reIndexColumns(),this.dispatch("column-add",e,i,r),this.layoutMode()!="fitColumns"&&s.reinitializeWidth(),this.redraw(!0),this.table.rowManager.reinitialize(),this.rerenderColumns(),n(s)})}deregisterColumn(e){var i=e.getField(),r;i&&delete this.columnsByField[i],r=this.columnsByIndex.indexOf(e),r>-1&&this.columnsByIndex.splice(r,1),r=this.columns.indexOf(e),r>-1&&this.columns.splice(r,1),this.verticalAlignHeaders(),this.redraw()}rerenderColumns(e,i){this.redrawBlock?(e===!1||e===!0&&this.redrawBlockUpdate===null)&&(this.redrawBlockUpdate=e):this.renderer.rerenderColumns(e,i)}blockRedraw(){this.redrawBlock=!0,this.redrawBlockUpdate=null}restoreRedraw(){this.redrawBlock=!1,this.verticalAlignHeaders(),this.renderer.rerenderColumns(this.redrawBlockUpdate)}redraw(e){gr.elVisible(this.element)&&this.verticalAlignHeaders(),e&&(this.table.rowManager.resetScroll(),this.table.rowManager.reinitialize()),this.confirm("table-redrawing",e)||this.layoutRefresh(e),this.dispatch("table-redraw",e),this.table.footerManager.redraw()}}class Fge extends $E{constructor(e){super(e),this.verticalFillMode="fill",this.scrollTop=0,this.scrollLeft=0,this.scrollTop=0,this.scrollLeft=0}clearRows(){for(var e=this.tableElement;e.firstChild;)e.removeChild(e.firstChild);e.scrollTop=0,e.scrollLeft=0,e.style.minWidth="",e.style.minHeight="",e.style.display="",e.style.visibility=""}renderRows(){var e=this.tableElement,i=!0,r=document.createDocumentFragment(),n=this.rows();n.forEach((a,s)=>{this.styleRow(a,s),a.initialize(!1,!0),a.type!=="group"&&(i=!1),r.appendChild(a.getElement())}),e.appendChild(r),n.forEach(a=>{a.rendered(),a.heightInitialized||a.calcHeight(!0)}),n.forEach(a=>{a.heightInitialized||a.setCellHeight()}),i?e.style.minWidth=this.table.columnManager.getWidth()+"px":e.style.minWidth=""}rerenderRows(e){this.clearRows(),e&&e(),this.renderRows(),this.rows().length||this.table.rowManager.tableEmpty()}scrollToRowNearestTop(e){var i=gr.elOffset(e.getElement()).top;return!(Math.abs(this.elementVertical.scrollTop-i)>Math.abs(this.elementVertical.scrollTop+this.elementVertical.clientHeight-i))}scrollToRow(e){var i=e.getElement();this.elementVertical.scrollTop=gr.elOffset(i).top-gr.elOffset(this.elementVertical).top+this.elementVertical.scrollTop}visibleRows(e){return this.rows()}}class Lge extends $E{constructor(e){super(e),this.verticalFillMode="fill",this.scrollTop=0,this.scrollLeft=0,this.vDomRowHeight=20,this.vDomTop=0,this.vDomBottom=0,this.vDomScrollPosTop=0,this.vDomScrollPosBottom=0,this.vDomTopPad=0,this.vDomBottomPad=0,this.vDomMaxRenderChain=90,this.vDomWindowBuffer=0,this.vDomWindowMinTotalRows=20,this.vDomWindowMinMarginRows=5,this.vDomTopNewRows=[],this.vDomBottomNewRows=[]}clearRows(){for(var e=this.tableElement;e.firstChild;)e.removeChild(e.firstChild);e.style.paddingTop="",e.style.paddingBottom="",e.style.minHeight="",e.style.display="",e.style.visibility="",this.elementVertical.scrollTop=0,this.elementVertical.scrollLeft=0,this.scrollTop=0,this.scrollLeft=0,this.vDomTop=0,this.vDomBottom=0,this.vDomTopPad=0,this.vDomBottomPad=0,this.vDomScrollPosTop=0,this.vDomScrollPosBottom=0}renderRows(){this._virtualRenderFill()}rerenderRows(e){for(var i=this.elementVertical.scrollTop,r=!1,n=!1,a=this.table.rowManager.scrollLeft,s=this.rows(),o=this.vDomTop;o<=this.vDomBottom;o++)if(s[o]){var l=i-s[o].getElement().offsetTop;if(n===!1||Math.abs(l)<n)n=l,r=o;else break}s.forEach(u=>{u.deinitializeHeight()}),e&&e(),this.rows().length?this._virtualRenderFill(r===!1?this.rows.length-1:r,!0,n||0):(this.clear(),this.table.rowManager.tableEmpty()),this.scrollColumns(a)}scrollColumns(e){this.table.rowManager.scrollHorizontal(e)}scrollRows(e,i){var r=e-this.vDomScrollPosTop,n=e-this.vDomScrollPosBottom,a=this.vDomWindowBuffer*2,s=this.rows();if(this.scrollTop=e,-r>a||n>a){var o=this.table.rowManager.scrollLeft;this._virtualRenderFill(Math.floor(this.elementVertical.scrollTop/this.elementVertical.scrollHeight*s.length)),this.scrollColumns(o)}else i?(r<0&&this._addTopRow(s,-r),n<0&&(this.vDomScrollHeight-this.scrollTop>this.vDomWindowBuffer?this._removeBottomRow(s,-n):this.vDomScrollPosBottom=this.scrollTop)):(n>=0&&this._addBottomRow(s,n),r>=0&&(this.scrollTop>this.vDomWindowBuffer?this._removeTopRow(s,r):this.vDomScrollPosTop=this.scrollTop))}resize(){this.vDomWindowBuffer=this.table.options.renderVerticalBuffer||this.elementVertical.clientHeight}scrollToRowNearestTop(e){var i=this.rows().indexOf(e);return!(Math.abs(this.vDomTop-i)>Math.abs(this.vDomBottom-i))}scrollToRow(e){var i=this.rows().indexOf(e);i>-1&&this._virtualRenderFill(i,!0)}visibleRows(e){var i=this.elementVertical.scrollTop,r=this.elementVertical.clientHeight+i,n=!1,a=0,s=0,o=this.rows();if(e)a=this.vDomTop,s=this.vDomBottom;else for(var l=this.vDomTop;l<=this.vDomBottom;l++)if(o[l])if(n)if(r-o[l].getElement().offsetTop>=0)s=l;else break;else if(i-o[l].getElement().offsetTop>=0)a=l;else if(n=!0,r-o[l].getElement().offsetTop>=0)s=l;else break;return o.slice(a,s+1)}_virtualRenderFill(e,i,r){var n=this.tableElement,a=this.elementVertical,s=0,o=0,l=0,u=0,c=0,d=0,p=this.rows(),f=p.length,m=0,h,g,I=[],v=0,w=0,y=this.table.rowManager.fixedHeight,b=this.elementVertical.clientHeight,S=this.table.options.rowHeight,U=!0;if(e=e||0,r=r||0,!e)this.clear();else{for(;n.firstChild;)n.removeChild(n.firstChild);u=(f-e+1)*this.vDomRowHeight,u<b&&(e-=Math.ceil((b-u)/this.vDomRowHeight),e<0&&(e=0)),s=Math.min(Math.max(Math.floor(this.vDomWindowBuffer/this.vDomRowHeight),this.vDomWindowMinMarginRows),e),e-=s}if(f&&gr.elVisible(this.elementVertical)){for(this.vDomTop=e,this.vDomBottom=e-1,y||this.table.options.maxHeight?(S&&(w=b/S+this.vDomWindowBuffer/S),w=Math.max(this.vDomWindowMinTotalRows,Math.ceil(w))):w=f;(w==f||o<=b+this.vDomWindowBuffer||v<this.vDomWindowMinTotalRows)&&this.vDomBottom<f-1;){for(I=[],g=document.createDocumentFragment(),d=0;d<w&&this.vDomBottom<f-1;)m=this.vDomBottom+1,h=p[m],this.styleRow(h,m),h.initialize(!1,!0),!h.heightInitialized&&!this.table.options.rowHeight&&h.clearCellHeight(),g.appendChild(h.getElement()),I.push(h),this.vDomBottom++,d++;if(!I.length)break;n.appendChild(g),I.forEach(T=>{T.rendered(),T.heightInitialized||T.calcHeight(!0)}),I.forEach(T=>{T.heightInitialized||T.setCellHeight()}),I.forEach(T=>{l=T.getHeight(),v<s?c+=l:o+=l,l>this.vDomWindowBuffer&&(this.vDomWindowBuffer=l*2),v++}),U=this.table.rowManager.adjustTableSize(),b=this.elementVertical.clientHeight,U&&(y||this.table.options.maxHeight)&&(S=o/v,w=Math.max(this.vDomWindowMinTotalRows,Math.ceil(b/S+this.vDomWindowBuffer/S)))}e?(this.vDomTopPad=i?this.vDomRowHeight*this.vDomTop+r:this.scrollTop-c,this.vDomBottomPad=this.vDomBottom==f-1?0:Math.max(this.vDomScrollHeight-this.vDomTopPad-o-c,0)):(this.vDomTopPad=0,this.vDomRowHeight=Math.floor((o+c)/v),this.vDomBottomPad=this.vDomRowHeight*(f-this.vDomBottom-1),this.vDomScrollHeight=c+o+this.vDomBottomPad-b),n.style.paddingTop=this.vDomTopPad+"px",n.style.paddingBottom=this.vDomBottomPad+"px",i&&(this.scrollTop=this.vDomTopPad+c+r-(this.elementVertical.scrollWidth>this.elementVertical.clientWidth?this.elementVertical.offsetHeight-b:0)),this.scrollTop=Math.min(this.scrollTop,this.elementVertical.scrollHeight-b),this.elementVertical.scrollWidth>this.elementVertical.clientWidth&&i&&(this.scrollTop+=this.elementVertical.offsetHeight-b),this.vDomScrollPosTop=this.scrollTop,this.vDomScrollPosBottom=this.scrollTop,a.scrollTop=this.scrollTop,this.dispatch("render-virtual-fill")}}_addTopRow(e,i){for(var r=this.tableElement,n=[],a=0,s=this.vDomTop-1,o=0,l=!0;l;)if(this.vDomTop){let u=e[s],c,d;u&&o<this.vDomMaxRenderChain?(c=u.getHeight()||this.vDomRowHeight,d=u.initialized,i>=c?(this.styleRow(u,s),r.insertBefore(u.getElement(),r.firstChild),(!u.initialized||!u.heightInitialized)&&n.push(u),u.initialize(),d||(c=u.getElement().offsetHeight,c>this.vDomWindowBuffer&&(this.vDomWindowBuffer=c*2)),i-=c,a+=c,this.vDomTop--,s--,o++):l=!1):l=!1}else l=!1;for(let u of n)u.clearCellHeight();this._quickNormalizeRowHeight(n),a&&(this.vDomTopPad-=a,this.vDomTopPad<0&&(this.vDomTopPad=s*this.vDomRowHeight),s<1&&(this.vDomTopPad=0),r.style.paddingTop=this.vDomTopPad+"px",this.vDomScrollPosTop-=a)}_removeTopRow(e,i){for(var r=[],n=0,a=0,s=!0;s;){let o=e[this.vDomTop],l;o&&a<this.vDomMaxRenderChain?(l=o.getHeight()||this.vDomRowHeight,i>=l?(this.vDomTop++,i-=l,n+=l,r.push(o),a++):s=!1):s=!1}for(let o of r){let l=o.getElement();l.parentNode&&l.parentNode.removeChild(l)}n&&(this.vDomTopPad+=n,this.tableElement.style.paddingTop=this.vDomTopPad+"px",this.vDomScrollPosTop+=this.vDomTop?n:n+this.vDomWindowBuffer)}_addBottomRow(e,i){for(var r=this.tableElement,n=[],a=0,s=this.vDomBottom+1,o=0,l=!0;l;){let u=e[s],c,d;u&&o<this.vDomMaxRenderChain?(c=u.getHeight()||this.vDomRowHeight,d=u.initialized,i>=c?(this.styleRow(u,s),r.appendChild(u.getElement()),(!u.initialized||!u.heightInitialized)&&n.push(u),u.initialize(),d||(c=u.getElement().offsetHeight,c>this.vDomWindowBuffer&&(this.vDomWindowBuffer=c*2)),i-=c,a+=c,this.vDomBottom++,s++,o++):l=!1):l=!1}for(let u of n)u.clearCellHeight();this._quickNormalizeRowHeight(n),a&&(this.vDomBottomPad-=a,(this.vDomBottomPad<0||s==e.length-1)&&(this.vDomBottomPad=0),r.style.paddingBottom=this.vDomBottomPad+"px",this.vDomScrollPosBottom+=a)}_removeBottomRow(e,i){for(var r=[],n=0,a=0,s=!0;s;){let o=e[this.vDomBottom],l;o&&a<this.vDomMaxRenderChain?(l=o.getHeight()||this.vDomRowHeight,i>=l?(this.vDomBottom--,i-=l,n+=l,r.push(o),a++):s=!1):s=!1}for(let o of r){let l=o.getElement();l.parentNode&&l.parentNode.removeChild(l)}n&&(this.vDomBottomPad+=n,this.vDomBottomPad<0&&(this.vDomBottomPad=0),this.tableElement.style.paddingBottom=this.vDomBottomPad+"px",this.vDomScrollPosBottom-=n)}_quickNormalizeRowHeight(e){for(let i of e)i.calcHeight();for(let i of e)i.setCellHeight()}}class _ge extends Ra{constructor(e){super(e),this.element=this.createHolderElement(),this.tableElement=this.createTableElement(),this.heightFixer=this.createTableElement(),this.placeholder=null,this.placeholderContents=null,this.firstRender=!1,this.renderMode="virtual",this.fixedHeight=!1,this.rows=[],this.activeRowsPipeline=[],this.activeRows=[],this.activeRowsCount=0,this.displayRows=[],this.displayRowsCount=0,this.scrollTop=0,this.scrollLeft=0,this.redrawBlock=!1,this.redrawBlockRestoreConfig=!1,this.redrawBlockRenderInPosition=!1,this.dataPipeline=[],this.displayPipeline=[],this.scrollbarWidth=0,this.renderer=null}createHolderElement(){var e=document.createElement("div");return e.classList.add("tabulator-tableholder"),e.setAttribute("tabindex",0),e}createTableElement(){var e=document.createElement("div");return e.classList.add("tabulator-table"),e.setAttribute("role","rowgroup"),e}initializePlaceholder(){var e=this.table.options.placeholder;if(typeof e=="function"&&(e=e.call(this.table)),e=this.chain("placeholder",[e],e,e)||e,e){let i=document.createElement("div");if(i.classList.add("tabulator-placeholder"),typeof e=="string"){let r=document.createElement("div");r.classList.add("tabulator-placeholder-contents"),r.innerHTML=e,i.appendChild(r),this.placeholderContents=r}else typeof HTMLElement<"u"&&e instanceof HTMLElement?(i.appendChild(e),this.placeholderContents=e):(console.warn("Invalid placeholder provided, must be string or HTML Element",e),this.el=null);this.placeholder=i}}getElement(){return this.element}getTableElement(){return this.tableElement}initialize(){this.initializePlaceholder(),this.initializeRenderer(),this.element.appendChild(this.tableElement),this.firstRender=!0,this.element.addEventListener("scroll",()=>{var e=this.element.scrollLeft,i=this.scrollLeft>e,r=this.element.scrollTop,n=this.scrollTop>r;this.scrollLeft!=e&&(this.scrollLeft=e,this.dispatch("scroll-horizontal",e,i),this.dispatchExternal("scrollHorizontal",e,i),this._positionPlaceholder()),this.scrollTop!=r&&(this.scrollTop=r,this.renderer.scrollRows(r,n),this.dispatch("scroll-vertical",r,n),this.dispatchExternal("scrollVertical",r,n))})}findRow(e){if(typeof e=="object"){if(e instanceof Ca)return e;if(e instanceof LE)return e._getSelf()||!1;if(typeof HTMLElement<"u"&&e instanceof HTMLElement)return this.rows.find(r=>r.getElement()===e)||!1;if(e===null)return!1}else return typeof e>"u"?!1:this.rows.find(r=>r.data[this.table.options.index]==e)||!1;return!1}getRowFromDataObject(e){var i=this.rows.find(r=>r.data===e);return i||!1}getRowFromPosition(e){return this.getDisplayRows().find(i=>i.type==="row"&&i.getPosition()===e&&i.isDisplayed())}scrollToRow(e,i,r){return this.renderer.scrollToRowPosition(e,i,r)}setData(e,i,r){return new Promise((n,a)=>{i&&this.getDisplayRows().length?this.table.options.pagination?this._setDataActual(e,!0):this.reRenderInPosition(()=>{this._setDataActual(e)}):(this.table.options.autoColumns&&r&&this.table.initialized&&this.table.columnManager.generateColumnsFromRowData(e),this.resetScroll(),this._setDataActual(e)),n()})}_setDataActual(e,i){this.dispatchExternal("dataProcessing",e),this._wipeElements(),Array.isArray(e)?(this.dispatch("data-processing",e),e.forEach((r,n)=>{if(r&&typeof r=="object"){var a=new Ca(r,this);this.rows.push(a)}else console.warn("Data Loading Warning - Invalid row data detected and ignored, expecting object but received:",r)}),this.refreshActiveData(!1,!1,i),this.dispatch("data-processed",e),this.dispatchExternal("dataProcessed",e)):console.error(`Data Loading Error - Unable to process data due to invalid data type 
Expecting: array 
Received: `,typeof e,`
Data:     `,e)}_wipeElements(){this.dispatch("rows-wipe"),this.destroy(),this.adjustTableSize(),this.dispatch("rows-wiped")}destroy(){this.rows.forEach(e=>{e.wipe()}),this.rows=[],this.activeRows=[],this.activeRowsPipeline=[],this.activeRowsCount=0,this.displayRows=[],this.displayRowsCount=0}deleteRow(e,i){var r=this.rows.indexOf(e),n=this.activeRows.indexOf(e);n>-1&&this.activeRows.splice(n,1),r>-1&&this.rows.splice(r,1),this.setActiveRows(this.activeRows),this.displayRowIterator(a=>{var s=a.indexOf(e);s>-1&&a.splice(s,1)}),i||this.reRenderInPosition(),this.regenerateRowPositions(),this.dispatchExternal("rowDeleted",e.getComponent()),this.displayRowsCount||this.tableEmpty(),this.subscribedExternal("dataChanged")&&this.dispatchExternal("dataChanged",this.getData())}addRow(e,i,r,n){var a=this.addRowActual(e,i,r,n);return a}addRows(e,i,r,n){var a=[];return new Promise((s,o)=>{i=this.findAddRowPos(i),Array.isArray(e)||(e=[e]),(typeof r>"u"&&i||typeof r<"u"&&!i)&&e.reverse(),e.forEach((l,u)=>{var c=this.addRow(l,i,r,!0);a.push(c),this.dispatch("row-added",c,l,i,r)}),this.refreshActiveData(n?"displayPipeline":!1,!1,!0),this.regenerateRowPositions(),this.displayRowsCount&&this._clearPlaceholder(),s(a)})}findAddRowPos(e){return typeof e>"u"&&(e=this.table.options.addRowPos),e==="pos"&&(e=!0),e==="bottom"&&(e=!1),e}addRowActual(e,i,r,n){var a=e instanceof Ca?e:new Ca(e||{},this),s=this.findAddRowPos(i),o=-1,l,u;return r||(u=this.chain("row-adding-position",[a,s],null,{index:r,top:s}),r=u.index,s=u.top),typeof r<"u"&&(r=this.findRow(r)),r=this.chain("row-adding-index",[a,r,s],null,r),r&&(o=this.rows.indexOf(r)),r&&o>-1?(l=this.activeRows.indexOf(r),this.displayRowIterator(function(c){var d=c.indexOf(r);d>-1&&c.splice(s?d:d+1,0,a)}),l>-1&&this.activeRows.splice(s?l:l+1,0,a),this.rows.splice(s?o:o+1,0,a)):s?(this.displayRowIterator(function(c){c.unshift(a)}),this.activeRows.unshift(a),this.rows.unshift(a)):(this.displayRowIterator(function(c){c.push(a)}),this.activeRows.push(a),this.rows.push(a)),this.setActiveRows(this.activeRows),this.dispatchExternal("rowAdded",a.getComponent()),this.subscribedExternal("dataChanged")&&this.dispatchExternal("dataChanged",this.table.rowManager.getData()),n||this.reRenderInPosition(),a}moveRow(e,i,r){this.dispatch("row-move",e,i,r),this.moveRowActual(e,i,r),this.regenerateRowPositions(),this.dispatch("row-moved",e,i,r),this.dispatchExternal("rowMoved",e.getComponent())}moveRowActual(e,i,r){this.moveRowInArray(this.rows,e,i,r),this.moveRowInArray(this.activeRows,e,i,r),this.displayRowIterator(n=>{this.moveRowInArray(n,e,i,r)}),this.dispatch("row-moving",e,i,r)}moveRowInArray(e,i,r,n){var a,s,o,l;if(i!==r&&(a=e.indexOf(i),a>-1&&(e.splice(a,1),s=e.indexOf(r),s>-1?n?e.splice(s+1,0,i):e.splice(s,0,i):e.splice(a,0,i)),e===this.getDisplayRows())){o=a<s?a:s,l=s>a?s:a+1;for(let u=o;u<=l;u++)e[u]&&this.styleRow(e[u],u)}}clearData(){this.setData([])}getRowIndex(e){return this.findRowIndex(e,this.rows)}getDisplayRowIndex(e){var i=this.getDisplayRows().indexOf(e);return i>-1?i:!1}nextDisplayRow(e,i){var r=this.getDisplayRowIndex(e),n=!1;return r!==!1&&r<this.displayRowsCount-1&&(n=this.getDisplayRows()[r+1]),n&&(!(n instanceof Ca)||n.type!="row")?this.nextDisplayRow(n,i):n}prevDisplayRow(e,i){var r=this.getDisplayRowIndex(e),n=!1;return r&&(n=this.getDisplayRows()[r-1]),i&&n&&(!(n instanceof Ca)||n.type!="row")?this.prevDisplayRow(n,i):n}findRowIndex(e,i){var r;return e=this.findRow(e),e&&(r=i.indexOf(e),r>-1)?r:!1}getData(e,i){var r=[],n=this.getRows(e);return n.forEach(function(a){a.type=="row"&&r.push(a.getData(i||"data"))}),r}getComponents(e){var i=[],r=this.getRows(e);return r.forEach(function(n){i.push(n.getComponent())}),i}getDataCount(e){var i=this.getRows(e);return i.length}scrollHorizontal(e){this.scrollLeft=e,this.element.scrollLeft=e,this.dispatch("scroll-horizontal",e)}registerDataPipelineHandler(e,i){typeof i<"u"?(this.dataPipeline.push({handler:e,priority:i}),this.dataPipeline.sort((r,n)=>r.priority-n.priority)):console.error("Data pipeline handlers must have a priority in order to be registered")}registerDisplayPipelineHandler(e,i){typeof i<"u"?(this.displayPipeline.push({handler:e,priority:i}),this.displayPipeline.sort((r,n)=>r.priority-n.priority)):console.error("Display pipeline handlers must have a priority in order to be registered")}refreshActiveData(e,i,r){var n=this.table,a="",s=0,o=["all","dataPipeline","display","displayPipeline","end"];if(!this.table.destroyed){if(typeof e=="function")if(s=this.dataPipeline.findIndex(l=>l.handler===e),s>-1)a="dataPipeline",i&&(s==this.dataPipeline.length-1?a="display":s++);else if(s=this.displayPipeline.findIndex(l=>l.handler===e),s>-1)a="displayPipeline",i&&(s==this.displayPipeline.length-1?a="end":s++);else{console.error("Unable to refresh data, invalid handler provided",e);return}else a=e||"all",s=0;if(this.redrawBlock){(!this.redrawBlockRestoreConfig||this.redrawBlockRestoreConfig&&(this.redrawBlockRestoreConfig.stage===a&&s<this.redrawBlockRestoreConfig.index||o.indexOf(a)<o.indexOf(this.redrawBlockRestoreConfig.stage)))&&(this.redrawBlockRestoreConfig={handler:e,skipStage:i,renderInPosition:r,stage:a,index:s});return}else gr.elVisible(this.element)?r?this.reRenderInPosition(this.refreshPipelines.bind(this,e,a,s,r)):(this.refreshPipelines(e,a,s,r),e||this.table.columnManager.renderer.renderColumns(),this.renderTable(),n.options.layoutColumnsOnNewData&&this.table.columnManager.redraw(!0)):this.refreshPipelines(e,a,s,r),this.dispatch("data-refreshed")}}refreshPipelines(e,i,r,n){switch(this.dispatch("data-refreshing"),(!e||!this.activeRowsPipeline[0])&&(this.activeRowsPipeline[0]=this.rows.slice(0)),i){case"all":case"dataPipeline":for(let a=r;a<this.dataPipeline.length;a++){let s=this.dataPipeline[a].handler(this.activeRowsPipeline[a].slice(0));this.activeRowsPipeline[a+1]=s||this.activeRowsPipeline[a].slice(0)}this.setActiveRows(this.activeRowsPipeline[this.dataPipeline.length]);case"display":r=0,this.resetDisplayRows();case"displayPipeline":for(let a=r;a<this.displayPipeline.length;a++){let s=this.displayPipeline[a].handler((a?this.getDisplayRows(a-1):this.activeRows).slice(0),n);this.setDisplayRows(s||this.getDisplayRows(a-1).slice(0),a)}case"end":this.regenerateRowPositions()}this.getDisplayRows().length&&this._clearPlaceholder()}regenerateRowPositions(){var e=this.getDisplayRows(),i=1;e.forEach(r=>{r.type==="row"&&(r.setPosition(i),i++)})}setActiveRows(e){this.activeRows=this.activeRows=Object.assign([],e),this.activeRowsCount=this.activeRows.length}resetDisplayRows(){this.displayRows=[],this.displayRows.push(this.activeRows.slice(0)),this.displayRowsCount=this.displayRows[0].length}setDisplayRows(e,i){this.displayRows[i]=e,i==this.displayRows.length-1&&(this.displayRowsCount=this.displayRows[this.displayRows.length-1].length)}getDisplayRows(e){return typeof e>"u"?this.displayRows.length?this.displayRows[this.displayRows.length-1]:[]:this.displayRows[e]||[]}getVisibleRows(e,i){var r=Object.assign([],this.renderer.visibleRows(!i));return e&&(r=this.chain("rows-visible",[i],r,r)),r}displayRowIterator(e){this.activeRowsPipeline.forEach(e),this.displayRows.forEach(e),this.displayRowsCount=this.displayRows[this.displayRows.length-1].length}getRows(e){var i=[];switch(e){case"active":i=this.activeRows;break;case"display":i=this.table.rowManager.getDisplayRows();break;case"visible":i=this.getVisibleRows(!1,!0);break;default:i=this.chain("rows-retrieve",e,null,this.rows)||this.rows}return i}reRenderInPosition(e){this.redrawBlock?e?e():this.redrawBlockRenderInPosition=!0:(this.dispatchExternal("renderStarted"),this.renderer.rerenderRows(e),this.fixedHeight||this.adjustTableSize(),this.scrollBarCheck(),this.dispatchExternal("renderComplete"))}scrollBarCheck(){var e=0;this.element.scrollHeight>this.element.clientHeight&&(e=this.element.offsetWidth-this.element.clientWidth),e!==this.scrollbarWidth&&(this.scrollbarWidth=e,this.dispatch("scrollbar-vertical",e))}initializeRenderer(){var e,i={virtual:Lge,basic:Fge};typeof this.table.options.renderVertical=="string"?e=i[this.table.options.renderVertical]:e=this.table.options.renderVertical,e?(this.renderMode=this.table.options.renderVertical,this.renderer=new e(this.table,this.element,this.tableElement),this.renderer.initialize(),(this.table.element.clientHeight||this.table.options.height)&&!(this.table.options.minHeight&&this.table.options.maxHeight)?this.fixedHeight=!0:this.fixedHeight=!1):console.error("Unable to find matching renderer:",this.table.options.renderVertical)}getRenderMode(){return this.renderMode}renderTable(){this.dispatchExternal("renderStarted"),this.element.scrollTop=0,this._clearTable(),this.displayRowsCount?(this.renderer.renderRows(),this.firstRender&&(this.firstRender=!1,this.fixedHeight||this.adjustTableSize(),this.layoutRefresh(!0))):this.renderEmptyScroll(),this.fixedHeight||this.adjustTableSize(),this.dispatch("table-layout"),this.displayRowsCount||this._showPlaceholder(),this.scrollBarCheck(),this.dispatchExternal("renderComplete")}renderEmptyScroll(){this.placeholder?this.tableElement.style.display="none":this.tableElement.style.minWidth=this.table.columnManager.getWidth()+"px"}_clearTable(){this._clearPlaceholder(),this.scrollTop=0,this.scrollLeft=0,this.renderer.clearRows()}tableEmpty(){this.renderEmptyScroll(),this._showPlaceholder()}checkPlaceholder(){this.displayRowsCount?this._clearPlaceholder():this.tableEmpty()}_showPlaceholder(){this.placeholder&&(this.placeholder&&this.placeholder.parentNode&&this.placeholder.parentNode.removeChild(this.placeholder),this.initializePlaceholder(),this.placeholder.setAttribute("tabulator-render-mode",this.renderMode),this.getElement().appendChild(this.placeholder),this._positionPlaceholder(),this.adjustTableSize())}_clearPlaceholder(){this.placeholder&&this.placeholder.parentNode&&this.placeholder.parentNode.removeChild(this.placeholder),this.tableElement.style.minWidth="",this.tableElement.style.display=""}_positionPlaceholder(){this.placeholder&&this.placeholder.parentNode&&(this.placeholder.style.width=this.table.columnManager.getWidth()+"px",this.placeholderContents.style.width=this.table.rowManager.element.clientWidth+"px",this.placeholderContents.style.marginLeft=this.scrollLeft+"px")}styleRow(e,i){var r=e.getElement();i%2?(r.classList.add("tabulator-row-even"),r.classList.remove("tabulator-row-odd")):(r.classList.add("tabulator-row-odd"),r.classList.remove("tabulator-row-even"))}normalizeHeight(e){this.activeRows.forEach(function(i){i.normalizeHeight(e)})}adjustTableSize(){let e=this.element.clientHeight,i,r=!1;if(this.renderer.verticalFillMode==="fill"){let n=Math.floor(this.table.columnManager.getElement().getBoundingClientRect().height+(this.table.footerManager&&this.table.footerManager.active&&!this.table.footerManager.external?this.table.footerManager.getElement().getBoundingClientRect().height:0));if(this.fixedHeight){i=isNaN(this.table.options.minHeight)?this.table.options.minHeight:this.table.options.minHeight+"px";const a="calc(100% - "+n+"px)";this.element.style.minHeight=i||"calc(100% - "+n+"px)",this.element.style.height=a,this.element.style.maxHeight=a}else this.element.style.height="",this.element.style.height=this.table.element.clientHeight-n+"px",this.element.scrollTop=this.scrollTop;this.renderer.resize(),!this.fixedHeight&&e!=this.element.clientHeight&&(r=!0,this.subscribed("table-resize")?this.dispatch("table-resize"):this.redraw()),this.scrollBarCheck()}return this._positionPlaceholder(),r}reinitialize(){this.rows.forEach(function(e){e.reinitialize(!0)})}blockRedraw(){this.redrawBlock=!0,this.redrawBlockRestoreConfig=!1}restoreRedraw(){this.redrawBlock=!1,this.redrawBlockRestoreConfig?(this.refreshActiveData(this.redrawBlockRestoreConfig.handler,this.redrawBlockRestoreConfig.skipStage,this.redrawBlockRestoreConfig.renderInPosition),this.redrawBlockRestoreConfig=!1):this.redrawBlockRenderInPosition&&this.reRenderInPosition(),this.redrawBlockRenderInPosition=!1}redraw(e){this.adjustTableSize(),this.table.tableWidth=this.table.element.clientWidth,e?this.renderTable():(this.reRenderInPosition(),this.scrollHorizontal(this.scrollLeft))}resetScroll(){if(this.element.scrollLeft=0,this.element.scrollTop=0,this.table.browser==="ie"){var e=document.createEvent("Event");e.initEvent("scroll",!1,!0),this.element.dispatchEvent(e)}else this.element.dispatchEvent(new Event("scroll"))}}class $ge extends Ra{constructor(e){super(e),this.active=!1,this.element=this.createElement(),this.containerElement=this.createContainerElement(),this.external=!1}initialize(){this.initializeElement()}createElement(){var e=document.createElement("div");return e.classList.add("tabulator-footer"),e}createContainerElement(){var e=document.createElement("div");return e.classList.add("tabulator-footer-contents"),this.element.appendChild(e),e}initializeElement(){this.table.options.footerElement&&(typeof this.table.options.footerElement==="string"?this.table.options.footerElement[0]==="<"?this.containerElement.innerHTML=this.table.options.footerElement:(this.external=!0,this.containerElement=document.querySelector(this.table.options.footerElement)):this.element=this.table.options.footerElement)}getElement(){return this.element}append(e){this.activate(),this.containerElement.appendChild(e),this.table.rowManager.adjustTableSize()}prepend(e){this.activate(),this.element.insertBefore(e,this.element.firstChild),this.table.rowManager.adjustTableSize()}remove(e){e.parentNode.removeChild(e),this.deactivate()}deactivate(e){(!this.element.firstChild||e)&&(this.external||this.element.parentNode.removeChild(this.element),this.active=!1)}activate(){this.active||(this.active=!0,this.external||(this.table.element.appendChild(this.getElement()),this.table.element.style.display=""))}redraw(){this.dispatch("footer-redraw")}}class Bge extends Ra{constructor(e){super(e),this.el=null,this.abortClasses=["tabulator-headers","tabulator-table"],this.previousTargets={},this.listeners=["click","dblclick","contextmenu","mouseenter","mouseleave","mouseover","mouseout","mousemove","mouseup","mousedown","touchstart","touchend"],this.componentMap={"tabulator-cell":"cell","tabulator-row":"row","tabulator-group":"group","tabulator-col":"column"},this.pseudoTrackers={row:{subscriber:null,target:null},cell:{subscriber:null,target:null},group:{subscriber:null,target:null},column:{subscriber:null,target:null}},this.pseudoTracking=!1}initialize(){this.el=this.table.element,this.buildListenerMap(),this.bindSubscriptionWatchers()}buildListenerMap(){var e={};this.listeners.forEach(i=>{e[i]={handler:null,components:[]}}),this.listeners=e}bindPseudoEvents(){Object.keys(this.pseudoTrackers).forEach(e=>{this.pseudoTrackers[e].subscriber=this.pseudoMouseEnter.bind(this,e),this.subscribe(e+"-mouseover",this.pseudoTrackers[e].subscriber)}),this.pseudoTracking=!0}pseudoMouseEnter(e,i,r){this.pseudoTrackers[e].target!==r&&(this.pseudoTrackers[e].target&&this.dispatch(e+"-mouseleave",i,this.pseudoTrackers[e].target),this.pseudoMouseLeave(e,i),this.pseudoTrackers[e].target=r,this.dispatch(e+"-mouseenter",i,r))}pseudoMouseLeave(e,i){var r=Object.keys(this.pseudoTrackers),n={row:["cell"],cell:["row"]};r=r.filter(a=>{var s=n[e];return a!==e&&(!s||s&&!s.includes(a))}),r.forEach(a=>{var s=this.pseudoTrackers[a].target;this.pseudoTrackers[a].target&&(this.dispatch(a+"-mouseleave",i,s),this.pseudoTrackers[a].target=null)})}bindSubscriptionWatchers(){var e=Object.keys(this.listeners),i=Object.values(this.componentMap);for(let r of i)for(let n of e){let a=r+"-"+n;this.subscriptionChange(a,this.subscriptionChanged.bind(this,r,n))}this.subscribe("table-destroy",this.clearWatchers.bind(this))}subscriptionChanged(e,i,r){var n=this.listeners[i].components,a=n.indexOf(e),s=!1;r?a===-1&&(n.push(e),s=!0):this.subscribed(e+"-"+i)||a>-1&&(n.splice(a,1),s=!0),(i==="mouseenter"||i==="mouseleave")&&!this.pseudoTracking&&this.bindPseudoEvents(),s&&this.updateEventListeners()}updateEventListeners(){for(let e in this.listeners){let i=this.listeners[e];i.components.length?i.handler||(i.handler=this.track.bind(this,e),this.el.addEventListener(e,i.handler)):i.handler&&(this.el.removeEventListener(e,i.handler),i.handler=null)}}track(e,i){var r=i.composedPath&&i.composedPath()||i.path,n=this.findTargets(r);n=this.bindComponents(e,n),this.triggerEvents(e,i,n),this.pseudoTracking&&(e=="mouseover"||e=="mouseleave")&&!Object.keys(n).length&&this.pseudoMouseLeave("none",i)}findTargets(e){var i={};let r=Object.keys(this.componentMap);for(let n of e){let a=n.classList?[...n.classList]:[];if(a.filter(l=>this.abortClasses.includes(l)).length)break;let o=a.filter(l=>r.includes(l));for(let l of o)i[this.componentMap[l]]||(i[this.componentMap[l]]=n)}return i.group&&i.group===i.row&&delete i.row,i}bindComponents(e,i){var r=Object.keys(i).reverse(),n=this.listeners[e],a={},s={},o={};for(let l of r){let u,c=i[l],d=this.previousTargets[l];if(d&&d.target===c)u=d.component;else switch(l){case"row":case"group":(n.components.includes("row")||n.components.includes("cell")||n.components.includes("group"))&&(u=this.table.rowManager.getVisibleRows(!0).find(f=>f.getElement()===c),i.row&&i.row.parentNode&&i.row.parentNode.closest(".tabulator-row")&&(i[l]=!1));break;case"column":n.components.includes("column")&&(u=this.table.columnManager.findColumn(c));break;case"cell":n.components.includes("cell")&&(a.row instanceof Ca?u=a.row.findCell(c):i.row&&console.warn("Event Target Lookup Error - The row this cell is attached to cannot be found, has the table been reinitialized without being destroyed first?"));break}u&&(a[l]=u,o[l]={target:c,component:u})}return this.previousTargets=o,Object.keys(i).forEach(l=>{let u=a[l];s[l]=u}),s}triggerEvents(e,i,r){var n=this.listeners[e];for(let a in r)r[a]&&n.components.includes(a)&&this.dispatch(a+"-"+e,i,r[a])}clearWatchers(){for(let e in this.listeners){let i=this.listeners[e];i.handler&&(this.el.removeEventListener(e,i.handler),i.handler=null)}}}class Vge{constructor(e){this.table=e,this.bindings={}}bind(e,i,r){this.bindings[e]||(this.bindings[e]={}),this.bindings[e][i]?console.warn("Unable to bind component handler, a matching function name is already bound",e,i,r):this.bindings[e][i]=r}handle(e,i,r){if(this.bindings[e]&&this.bindings[e][r]&&typeof this.bindings[e][r].bind=="function")return this.bindings[e][r].bind(null,i);r!=="then"&&typeof r=="string"&&!r.startsWith("_")&&this.table.options.debugInvalidComponentFuncs&&console.error("The "+e+" component does not have a "+r+" function, have you checked that you have the correct Tabulator module installed?")}}class jge extends Ra{constructor(e){super(e),this.requestOrder=0,this.loading=!1}initialize(){}load(e,i,r,n,a,s){var o=++this.requestOrder;if(this.table.destroyed)return Promise.resolve();if(this.dispatchExternal("dataLoading",e),e&&(e.indexOf("{")==0||e.indexOf("[")==0)&&(e=JSON.parse(e)),this.confirm("data-loading",[e,i,r,a])){this.loading=!0,a||this.alertLoader(),i=this.chain("data-params",[e,r,a],i||{},i||{}),i=this.mapParams(i,this.table.options.dataSendParams);var l=this.chain("data-load",[e,i,r,a],!1,Promise.resolve([]));return l.then(u=>{if(this.table.destroyed)console.warn("Data Load Response Blocked - Table has been destroyed");else{!Array.isArray(u)&&typeof u=="object"&&(u=this.mapParams(u,this.objectInvert(this.table.options.dataReceiveParams)));var c=this.chain("data-loaded",[u],null,u);o==this.requestOrder?(this.clearAlert(),c!==!1&&(this.dispatchExternal("dataLoaded",c),this.table.rowManager.setData(c,n,typeof s>"u"?!n:s))):console.warn("Data Load Response Blocked - An active data load request was blocked by an attempt to change table data while the request was being made")}}).catch(u=>{console.error("Data Load Error: ",u),this.dispatchExternal("dataLoadError",u),a||this.alertError(),setTimeout(()=>{this.clearAlert()},this.table.options.dataLoaderErrorTimeout)}).finally(()=>{this.loading=!1})}else return this.dispatchExternal("dataLoaded",e),e||(e=[]),this.table.rowManager.setData(e,n,typeof s>"u"?!n:s),Promise.resolve()}mapParams(e,i){var r={};for(let n in e)r[i.hasOwnProperty(n)?i[n]:n]=e[n];return r}objectInvert(e){var i={};for(let r in e)i[e[r]]=r;return i}blockActiveLoad(){this.requestOrder++}alertLoader(){var e=typeof this.table.options.dataLoader=="function"?this.table.options.dataLoader():this.table.options.dataLoader;e&&this.table.alertManager.alert(this.table.options.dataLoaderLoading||this.langText("data|loading"))}alertError(){this.table.alertManager.alert(this.table.options.dataLoaderError||this.langText("data|error"),"error")}clearAlert(){this.table.alertManager.clear()}}class Gge{constructor(e,i,r){this.table=e,this.events={},this.optionsList=i||{},this.subscriptionNotifiers={},this.dispatch=r?this._debugDispatch.bind(this):this._dispatch.bind(this),this.debug=r}subscriptionChange(e,i){this.subscriptionNotifiers[e]||(this.subscriptionNotifiers[e]=[]),this.subscriptionNotifiers[e].push(i),this.subscribed(e)&&this._notifySubscriptionChange(e,!0)}subscribe(e,i){this.events[e]||(this.events[e]=[]),this.events[e].push(i),this._notifySubscriptionChange(e,!0)}unsubscribe(e,i){var r;if(this.events[e])if(i)if(r=this.events[e].findIndex(n=>n===i),r>-1)this.events[e].splice(r,1);else{console.warn("Cannot remove event, no matching event found:",e,i);return}else delete this.events[e];else{console.warn("Cannot remove event, no events set on:",e);return}this._notifySubscriptionChange(e,!1)}subscribed(e){return this.events[e]&&this.events[e].length}_notifySubscriptionChange(e,i){var r=this.subscriptionNotifiers[e];r&&r.forEach(n=>{n(i)})}_dispatch(){var e=Array.from(arguments),i=e.shift(),r;return this.events[i]&&this.events[i].forEach((n,a)=>{let s=n.apply(this.table,e);a||(r=s)}),r}_debugDispatch(){var e=Array.from(arguments),i=e[0];return e[0]="ExternalEvent:"+e[0],(this.debug===!0||this.debug.includes(i))&&console.log(...e),this._dispatch(...arguments)}}class Hge{constructor(e){this.events={},this.subscriptionNotifiers={},this.dispatch=e?this._debugDispatch.bind(this):this._dispatch.bind(this),this.chain=e?this._debugChain.bind(this):this._chain.bind(this),this.confirm=e?this._debugConfirm.bind(this):this._confirm.bind(this),this.debug=e}subscriptionChange(e,i){this.subscriptionNotifiers[e]||(this.subscriptionNotifiers[e]=[]),this.subscriptionNotifiers[e].push(i),this.subscribed(e)&&this._notifySubscriptionChange(e,!0)}subscribe(e,i,r=1e4){this.events[e]||(this.events[e]=[]),this.events[e].push({callback:i,priority:r}),this.events[e].sort((n,a)=>n.priority-a.priority),this._notifySubscriptionChange(e,!0)}unsubscribe(e,i){var r;if(this.events[e]){if(i)if(r=this.events[e].findIndex(n=>n.callback===i),r>-1)this.events[e].splice(r,1);else{console.warn("Cannot remove event, no matching event found:",e,i);return}}else{console.warn("Cannot remove event, no events set on:",e);return}this._notifySubscriptionChange(e,!1)}subscribed(e){return this.events[e]&&this.events[e].length}_chain(e,i,r,n){var a=r;return Array.isArray(i)||(i=[i]),this.subscribed(e)?(this.events[e].forEach((s,o)=>{a=s.callback.apply(this,i.concat([a]))}),a):typeof n=="function"?n():n}_confirm(e,i){var r=!1;return Array.isArray(i)||(i=[i]),this.subscribed(e)&&this.events[e].forEach((n,a)=>{n.callback.apply(this,i)&&(r=!0)}),r}_notifySubscriptionChange(e,i){var r=this.subscriptionNotifiers[e];r&&r.forEach(n=>{n(i)})}_dispatch(){var e=Array.from(arguments),i=e.shift();this.events[i]&&this.events[i].forEach(r=>{r.callback.apply(this,e)})}_debugDispatch(){var e=Array.from(arguments),i=e[0];return e[0]="InternalEvent:"+i,(this.debug===!0||this.debug.includes(i))&&console.log(...e),this._dispatch(...arguments)}_debugChain(){var e=Array.from(arguments),i=e[0];return e[0]="InternalEvent:"+i,(this.debug===!0||this.debug.includes(i))&&console.log(...e),this._chain(...arguments)}_debugConfirm(){var e=Array.from(arguments),i=e[0];return e[0]="InternalEvent:"+i,(this.debug===!0||this.debug.includes(i))&&console.log(...e),this._confirm(...arguments)}}class Wge extends Ra{constructor(e){super(e)}_warnUser(){this.options("debugDeprecation")&&console.warn(...arguments)}check(e,i,r){var n="";return typeof this.options(e)<"u"?(n="Deprecated Setup Option - Use of the %c"+e+"%c option is now deprecated",i?(n=n+", Please use the %c"+i+"%c option instead",this._warnUser(n,"font-weight: bold;","font-weight: normal;","font-weight: bold;","font-weight: normal;"),r&&(this.table.options[i]=this.table.options[e])):this._warnUser(n,"font-weight: bold;","font-weight: normal;"),!1):!0}checkMsg(e,i){return typeof this.options(e)<"u"?(this._warnUser("%cDeprecated Setup Option - Use of the %c"+e+" %c option is now deprecated, "+i,"font-weight: normal;","font-weight: bold;","font-weight: normal;"),!1):!0}msg(e){this._warnUser(e)}}class zge extends Ra{constructor(e){super(e),this.deps={},this.props={}}initialize(){this.deps=Object.assign({},this.options("dependencies"))}lookup(e,i,r){if(Array.isArray(e)){for(const a of e){var n=this.lookup(a,i,!0);if(n)break}if(n)return n;this.error(e)}else return i?this.lookupProp(e,i,r):this.lookupKey(e,r)}lookupProp(e,i,r){var n;if(this.props[e]&&this.props[e][i])return this.props[e][i];if(n=this.lookupKey(e,r),n)return this.props[e]||(this.props[e]={}),this.props[e][i]=n[i]||n,this.props[e][i]}lookupKey(e,i){var r;return this.deps[e]?r=this.deps[e]:window[e]?(this.deps[e]=window[e],r=this.deps[e]):i||this.error(e),r}error(e){console.error("Unable to find dependency",e,"Please check documentation and ensure you have imported the required library into your project")}}function qge(t,e){e&&this.table.columnManager.renderer.reinitializeColumnWidths(t),this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&this.table.modules.responsiveLayout.update()}function EH(t,e){t.forEach(function(i){i.reinitializeWidth()}),this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&this.table.modules.responsiveLayout.update()}function Yge(t,e){var i=0,r=this.table.rowManager.element.clientWidth,n=0,a=!1;t.forEach((s,o)=>{s.widthFixed||s.reinitializeWidth(),(this.table.options.responsiveLayout?s.modules.responsive.visible:s.visible)&&(a=s),s.visible&&(i+=s.getWidth())}),a?(n=r-i+a.getWidth(),this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&(a.setWidth(0),this.table.modules.responsiveLayout.update()),n>0?a.setWidth(n):a.reinitializeWidth()):this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&this.table.modules.responsiveLayout.update()}function Kge(t,e){var i=this.table.rowManager.element.getBoundingClientRect().width,r=0,n=0,a=0,s=0,o=[],l=[],u=0,c=0,d=0;function p(m){var h;return typeof m=="string"?m.indexOf("%")>-1?h=i/100*parseInt(m):h=parseInt(m):h=m,h}function f(m,h,g,I){var v=[],w=0,y=0,b=0,S=a,U=0,T=0,P=[];function D(R){return g*(R.column.definition.widthGrow||1)}function E(R){return p(R.width)-g*(R.column.definition.widthShrink||0)}return m.forEach(function(R,C){var M=I?E(R):D(R);R.column.minWidth>=M?v.push(R):R.column.maxWidth&&R.column.maxWidth<M?(R.width=R.column.maxWidth,h-=R.column.maxWidth,S-=I?R.column.definition.widthShrink||1:R.column.definition.widthGrow||1,S&&(g=Math.floor(h/S))):(P.push(R),T+=I?R.column.definition.widthShrink||1:R.column.definition.widthGrow||1)}),v.length?(v.forEach(function(R){w+=I?R.width-R.column.minWidth:R.column.minWidth,R.width=R.column.minWidth}),y=h-w,b=T?Math.floor(y/T):y,U=f(P,y,b,I)):(U=T?h-Math.floor(h/T)*T:h,P.forEach(function(R){R.width=I?E(R):D(R)})),U}this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&this.table.modules.responsiveLayout.update(),this.table.rowManager.element.scrollHeight>this.table.rowManager.element.clientHeight&&(i-=this.table.rowManager.element.offsetWidth-this.table.rowManager.element.clientWidth),t.forEach(function(m){var h,g,I;m.visible&&(h=m.definition.width,g=parseInt(m.minWidth),h?(I=p(h),r+=I>g?I:g,m.definition.widthShrink&&(l.push({column:m,width:I>g?I:g}),u+=m.definition.widthShrink)):(o.push({column:m,width:0}),a+=m.definition.widthGrow||1))}),n=i-r,s=Math.floor(n/a),d=f(o,n,s,!1),o.length&&d>0&&(o[o.length-1].width+=d),o.forEach(function(m){n-=m.width}),c=Math.abs(d)+n,c>0&&u&&(d=f(l,c,Math.floor(c/u),!0)),d&&l.length&&(l[l.length-1].width-=d),o.forEach(function(m){m.column.setWidth(m.width)}),l.forEach(function(m){m.column.setWidth(m.width)})}var Xge={fitData:qge,fitDataFill:EH,fitDataTable:EH,fitDataStretch:Yge,fitColumns:Kge};class LD extends si{static moduleName="layout";static modes=Xge;constructor(e){super(e,"layout"),this.mode=null,this.registerTableOption("layout","fitData"),this.registerTableOption("layoutColumnsOnNewData",!1),this.registerColumnOption("widthGrow"),this.registerColumnOption("widthShrink")}initialize(){var e=this.table.options.layout;LD.modes[e]?this.mode=e:(console.warn("Layout Error - invalid mode set, defaulting to 'fitData' : "+e),this.mode="fitData"),this.table.element.setAttribute("tabulator-layout",this.mode),this.subscribe("column-init",this.initializeColumn.bind(this))}initializeColumn(e){e.definition.widthGrow&&(e.definition.widthGrow=Number(e.definition.widthGrow)),e.definition.widthShrink&&(e.definition.widthShrink=Number(e.definition.widthShrink))}getMode(){return this.mode}layout(e){var i=this.table.columnManager.columnsByIndex.find(r=>r.definition.variableHeight||r.definition.formatter==="textarea");this.dispatch("layout-refreshing"),LD.modes[this.mode].call(this,this.table.columnManager.columnsByIndex,e),i&&this.table.rowManager.normalizeHeight(!0),this.dispatch("layout-refreshed")}}var Jge={default:{groups:{item:"item",items:"items"},columns:{},data:{loading:"Loading",error:"Error"},pagination:{page_size:"Page Size",page_title:"Show Page",first:"First",first_title:"First Page",last:"Last",last_title:"Last Page",prev:"Prev",prev_title:"Prev Page",next:"Next",next_title:"Next Page",all:"All",counter:{showing:"Showing",of:"of",rows:"rows",pages:"pages"}},headerFilters:{default:"filter column...",columns:{}}}};class N1 extends si{static moduleName="localize";static langs=Jge;constructor(e){super(e),this.locale="default",this.lang=!1,this.bindings={},this.langList={},this.registerTableOption("locale",!1),this.registerTableOption("langs",{})}initialize(){this.langList=gr.deepClone(N1.langs),this.table.options.columnDefaults.headerFilterPlaceholder!==!1&&this.setHeaderFilterPlaceholder(this.table.options.columnDefaults.headerFilterPlaceholder);for(let e in this.table.options.langs)this.installLang(e,this.table.options.langs[e]);this.setLocale(this.table.options.locale),this.registerTableFunction("setLocale",this.setLocale.bind(this)),this.registerTableFunction("getLocale",this.getLocale.bind(this)),this.registerTableFunction("getLang",this.getLang.bind(this))}setHeaderFilterPlaceholder(e){this.langList.default.headerFilters.default=e}installLang(e,i){this.langList[e]?this._setLangProp(this.langList[e],i):this.langList[e]=i}_setLangProp(e,i){for(let r in i)e[r]&&typeof e[r]=="object"?this._setLangProp(e[r],i[r]):e[r]=i[r]}setLocale(e){e=e||"default";function i(r,n){for(var a in r)typeof r[a]=="object"?(n[a]||(n[a]={}),i(r[a],n[a])):n[a]=r[a]}if(e===!0&&navigator.language&&(e=navigator.language.toLowerCase()),e&&!this.langList[e]){let r=e.split("-")[0];this.langList[r]?(console.warn("Localization Error - Exact matching locale not found, using closest match: ",e,r),e=r):(console.warn("Localization Error - Matching locale not found, using default: ",e),e="default")}this.locale=e,this.lang=gr.deepClone(this.langList.default||{}),e!="default"&&i(this.langList[e],this.lang),this.dispatchExternal("localized",this.locale,this.lang),this._executeBindings()}getLocale(e){return this.locale}getLang(e){return e?this.langList[e]:this.lang}getText(e,i){var r=i?e+"|"+i:e,n=r.split("|"),a=this._getLangElement(n,this.locale);return a||""}_getLangElement(e,i){var r=this.lang;return e.forEach(function(n){var a;r&&(a=r[n],typeof a<"u"?r=a:r=!1)}),r}bind(e,i){this.bindings[e]||(this.bindings[e]=[]),this.bindings[e].push(i),i(this.getText(e),this.lang)}_executeBindings(){for(let e in this.bindings)this.bindings[e].forEach(i=>{i(this.getText(e),this.lang)})}}class Qge extends si{static moduleName="comms";constructor(e){super(e)}initialize(){this.registerTableFunction("tableComms",this.receive.bind(this))}getConnections(e){var i=[],r;return r=this.table.constructor.registry.lookupTable(e),r.forEach(n=>{this.table!==n&&i.push(n)}),i}send(e,i,r,n){var a=this.getConnections(e);a.forEach(s=>{s.tableComms(this.table.element,i,r,n)}),!a.length&&e&&console.warn("Table Connection Error - No tables matching selector found",e)}receive(e,i,r,n){if(this.table.modExists(i))return this.table.modules[i].commsReceived(e,r,n);console.warn("Inter-table Comms Error - no such module:",i)}}var Zge=Object.freeze({__proto__:null,CommsModule:Qge,LayoutModule:LD,LocalizeModule:N1});class _o{static registry={tables:[],register(e){_o.registry.tables.push(e)},deregister(e){var i=_o.registry.tables.indexOf(e);i>-1&&_o.registry.tables.splice(i,1)},lookupTable(e,i){var r=[],n,a;if(typeof e=="string"){if(n=document.querySelectorAll(e),n.length)for(var s=0;s<n.length;s++)a=_o.registry.matchElement(n[s]),a&&r.push(a)}else typeof HTMLElement<"u"&&e instanceof HTMLElement||e instanceof _o?(a=_o.registry.matchElement(e),a&&r.push(a)):Array.isArray(e)?e.forEach(function(o){r=r.concat(_o.registry.lookupTable(o))}):i||console.warn("Table Connection Error - Invalid Selector",e);return r},matchElement(e){return _o.registry.tables.find(function(i){return e instanceof _o?i===e:i.element===e})}};static findTable(e){var i=_o.registry.lookupTable(e,!0);return Array.isArray(i)&&!i.length?!1:i}}class xr extends _o{static moduleBindings={};static moduleExtensions={};static modulesRegistered=!1;static defaultModules=!1;constructor(){super()}static initializeModuleBinder(e){xr.modulesRegistered||(xr.modulesRegistered=!0,xr._registerModules(Zge,!0),e&&xr._registerModules(e))}static _extendModule(e,i,r){if(xr.moduleBindings[e]){var n=xr.moduleBindings[e][i];if(n)if(typeof r=="object")for(let a in r)n[a]=r[a];else console.warn("Module Error - Invalid value type, it must be an object");else console.warn("Module Error - property does not exist:",i)}else console.warn("Module Error - module does not exist:",e)}static _registerModules(e,i){var r=Object.values(e);i&&r.forEach(n=>{n.prototype.moduleCore=!0}),xr._registerModule(r)}static _registerModule(e){Array.isArray(e)||(e=[e]),e.forEach(i=>{xr._registerModuleBinding(i),xr._registerModuleExtensions(i)})}static _registerModuleBinding(e){e.moduleName?xr.moduleBindings[e.moduleName]=e:console.error("Unable to bind module, no moduleName defined",e.moduleName)}static _registerModuleExtensions(e){var i=e.moduleExtensions;if(e.moduleExtensions)for(let r in i){let n=i[r];if(xr.moduleBindings[r])for(let a in n)xr._extendModule(r,a,n[a]);else{xr.moduleExtensions[r]||(xr.moduleExtensions[r]={});for(let a in n)xr.moduleExtensions[r][a]||(xr.moduleExtensions[r][a]={}),Object.assign(xr.moduleExtensions[r][a],n[a])}}xr._extendModuleFromQueue(e)}static _extendModuleFromQueue(e){var i=xr.moduleExtensions[e.moduleName];if(i)for(let r in i)xr._extendModule(e.moduleName,r,i[r])}_bindModules(){var e=[],i=[],r=[];this.modules={};for(var n in xr.moduleBindings){let a=xr.moduleBindings[n],s=new a(this);this.modules[n]=s,a.prototype.moduleCore?this.modulesCore.push(s):a.moduleInitOrder?a.moduleInitOrder<0?e.push(s):i.push(s):r.push(s)}e.sort((a,s)=>a.moduleInitOrder>s.moduleInitOrder?1:-1),i.sort((a,s)=>a.moduleInitOrder>s.moduleInitOrder?1:-1),this.modulesRegular=e.concat(r.concat(i))}}class eIe extends Ra{constructor(e){super(e),this.element=this._createAlertElement(),this.msgElement=this._createMsgElement(),this.type=null,this.element.appendChild(this.msgElement)}_createAlertElement(){var e=document.createElement("div");return e.classList.add("tabulator-alert"),e}_createMsgElement(){var e=document.createElement("div");return e.classList.add("tabulator-alert-msg"),e.setAttribute("role","alert"),e}_typeClass(){return"tabulator-alert-state-"+this.type}alert(e,i="msg"){if(e){for(this.clear(),this.dispatch("alert-show",i),this.type=i;this.msgElement.firstChild;)this.msgElement.removeChild(this.msgElement.firstChild);this.msgElement.classList.add(this._typeClass()),typeof e=="function"&&(e=e()),e instanceof HTMLElement?this.msgElement.appendChild(e):this.msgElement.innerHTML=e,this.table.element.appendChild(this.element)}}clear(){this.dispatch("alert-hide",this.type),this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.msgElement.classList.remove(this._typeClass())}}class ip extends xr{static defaultOptions=Age;static extendModule(){ip.initializeModuleBinder(),ip._extendModule(...arguments)}static registerModule(){ip.initializeModuleBinder(),ip._registerModule(...arguments)}constructor(e,i,r){super(),ip.initializeModuleBinder(r),this.options={},this.columnManager=null,this.rowManager=null,this.footerManager=null,this.alertManager=null,this.vdomHoz=null,this.externalEvents=null,this.eventBus=null,this.interactionMonitor=!1,this.browser="",this.browserSlow=!1,this.browserMobile=!1,this.rtl=!1,this.originalElement=null,this.componentFunctionBinder=new Vge(this),this.dataLoader=!1,this.modules={},this.modulesCore=[],this.modulesRegular=[],this.deprecationAdvisor=new Wge(this),this.optionsList=new XY(this,"table constructor"),this.dependencyRegistry=new zge(this),this.initialized=!1,this.destroyed=!1,this.initializeElement(e)&&(this.initializeCoreSystems(i),setTimeout(()=>{this._create()})),this.constructor.registry.register(this)}initializeElement(e){return typeof HTMLElement<"u"&&e instanceof HTMLElement?(this.element=e,!0):typeof e=="string"?(this.element=document.querySelector(e),this.element?!0:(console.error("Tabulator Creation Error - no element found matching selector: ",e),!1)):(console.error("Tabulator Creation Error - Invalid element provided:",e),!1)}initializeCoreSystems(e){this.columnManager=new xge(this),this.rowManager=new _ge(this),this.footerManager=new $ge(this),this.dataLoader=new jge(this),this.alertManager=new eIe(this),this._bindModules(),this.options=this.optionsList.generate(ip.defaultOptions,e),this._clearObjectPointers(),this._mapDeprecatedFunctionality(),this.externalEvents=new Gge(this,this.options,this.options.debugEventsExternal),this.eventBus=new Hge(this.options.debugEventsInternal),this.interactionMonitor=new Bge(this),this.dataLoader.initialize(),this.footerManager.initialize(),this.dependencyRegistry.initialize()}_mapDeprecatedFunctionality(){}_clearSelection(){this.element.classList.add("tabulator-block-select"),window.getSelection?window.getSelection().empty?window.getSelection().empty():window.getSelection().removeAllRanges&&window.getSelection().removeAllRanges():document.selection&&document.selection.empty(),this.element.classList.remove("tabulator-block-select")}_create(){this.externalEvents.dispatch("tableBuilding"),this.eventBus.dispatch("table-building"),this._rtlCheck(),this._buildElement(),this._initializeTable(),this.initialized=!0,this._loadInitialData().finally(()=>{this.eventBus.dispatch("table-initialized"),this.externalEvents.dispatch("tableBuilt")})}_rtlCheck(){var e=window.getComputedStyle(this.element);switch(this.options.textDirection){case"auto":if(e.direction!=="rtl")break;case"rtl":this.element.classList.add("tabulator-rtl"),this.rtl=!0;break;case"ltr":this.element.classList.add("tabulator-ltr");default:this.rtl=!1}}_clearObjectPointers(){this.options.columns=this.options.columns.slice(0),Array.isArray(this.options.data)&&!this.options.reactiveData&&(this.options.data=this.options.data.slice(0))}_buildElement(){var e=this.element,i=this.options,r;if(e.tagName==="TABLE"){this.originalElement=this.element,r=document.createElement("div");var n=e.attributes;for(var a in n)typeof n[a]=="object"&&r.setAttribute(n[a].name,n[a].value);e.parentNode.replaceChild(r,e),this.element=e=r}for(e.classList.add("tabulator"),e.setAttribute("role","grid");e.firstChild;)e.removeChild(e.firstChild);i.height&&(i.height=isNaN(i.height)?i.height:i.height+"px",e.style.height=i.height),i.minHeight!==!1&&(i.minHeight=isNaN(i.minHeight)?i.minHeight:i.minHeight+"px",e.style.minHeight=i.minHeight),i.maxHeight!==!1&&(i.maxHeight=isNaN(i.maxHeight)?i.maxHeight:i.maxHeight+"px",e.style.maxHeight=i.maxHeight)}_initializeTable(){var e=this.element,i=this.options;this.interactionMonitor.initialize(),this.columnManager.initialize(),this.rowManager.initialize(),this._detectBrowser(),this.modulesCore.forEach(r=>{r.initialize()}),e.appendChild(this.columnManager.getElement()),e.appendChild(this.rowManager.getElement()),i.footerElement&&this.footerManager.activate(),i.autoColumns&&i.data&&this.columnManager.generateColumnsFromRowData(this.options.data),this.modulesRegular.forEach(r=>{r.initialize()}),this.columnManager.setColumns(i.columns),this.eventBus.dispatch("table-built")}_loadInitialData(){return this.dataLoader.load(this.options.data).finally(()=>{this.columnManager.verticalAlignHeaders()})}destroy(){var e=this.element;for(this.destroyed=!0,this.constructor.registry.deregister(this),this.eventBus.dispatch("table-destroy"),this.rowManager.destroy();e.firstChild;)e.removeChild(e.firstChild);e.classList.remove("tabulator"),this.externalEvents.dispatch("tableDestroyed")}_detectBrowser(){var e=navigator.userAgent||navigator.vendor||window.opera;e.indexOf("Trident")>-1?(this.browser="ie",this.browserSlow=!0):e.indexOf("Edge")>-1?(this.browser="edge",this.browserSlow=!0):e.indexOf("Firefox")>-1?(this.browser="firefox",this.browserSlow=!1):e.indexOf("Mac OS")>-1?(this.browser="safari",this.browserSlow=!1):(this.browser="other",this.browserSlow=!1),this.browserMobile=/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw-(n|u)|c55\/|capi|ccwa|cdm-|cell|chtm|cldc|cmd-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc-s|devi|dica|dmob|do(c|p)o|ds(12|-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(-|_)|g1 u|g560|gene|gf-5|g-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd-(m|p|t)|hei-|hi(pt|ta)|hp( i|ip)|hs-c|ht(c(-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i-(20|go|ma)|i230|iac( |-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|-[a-w])|libw|lynx|m1-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|-([1-8]|c))|phil|pire|pl(ay|uc)|pn-2|po(ck|rt|se)|prox|psio|pt-g|qa-a|qc(07|12|21|32|60|-[2-7]|i-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h-|oo|p-)|sdk\/|se(c(-|0|1)|47|mc|nd|ri)|sgh-|shar|sie(-|m)|sk-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h-|v-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl-|tdg-|tel(i|m)|tim-|t-mo|to(pl|sh)|ts(70|m-|m3|m5)|tx-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas-|your|zeto|zte-/i.test(e.slice(0,4))}initGuard(e,i){var r,n;return this.options.debugInitialization&&!this.initialized&&(e||(r=new Error().stack.split(`
`),n=r[0]=="Error"?r[2]:r[1],n[0]==" "?e=n.trim().split(" ")[1].split(".")[1]:e=n.trim().split("@")[0]),console.warn("Table Not Initialized - Calling the "+e+" function before the table is initialized may result in inconsistent behavior, Please wait for the `tableBuilt` event before calling this function."+(i?" "+i:""))),this.initialized}blockRedraw(){this.initGuard(),this.eventBus.dispatch("redraw-blocking"),this.rowManager.blockRedraw(),this.columnManager.blockRedraw(),this.eventBus.dispatch("redraw-blocked")}restoreRedraw(){this.initGuard(),this.eventBus.dispatch("redraw-restoring"),this.rowManager.restoreRedraw(),this.columnManager.restoreRedraw(),this.eventBus.dispatch("redraw-restored")}setData(e,i,r){return this.initGuard(!1,"To set initial data please use the 'data' property in the table constructor."),this.dataLoader.load(e,i,r,!1)}clearData(){this.initGuard(),this.dataLoader.blockActiveLoad(),this.rowManager.clearData()}getData(e){return this.rowManager.getData(e)}getDataCount(e){return this.rowManager.getDataCount(e)}replaceData(e,i,r){return this.initGuard(),this.dataLoader.load(e,i,r,!0,!0)}updateData(e){var i=0;return this.initGuard(),new Promise((r,n)=>{this.dataLoader.blockActiveLoad(),typeof e=="string"&&(e=JSON.parse(e)),e&&e.length>0?e.forEach(a=>{var s=this.rowManager.findRow(a[this.options.index]);s?(i++,s.updateData(a).then(()=>{i--,i||r()}).catch(o=>{n("Update Error - Unable to update row",a,o)})):n("Update Error - Unable to find row",a)}):(console.warn("Update Error - No data provided"),n("Update Error - No data provided"))})}addData(e,i,r){return this.initGuard(),new Promise((n,a)=>{this.dataLoader.blockActiveLoad(),typeof e=="string"&&(e=JSON.parse(e)),e?this.rowManager.addRows(e,i,r).then(s=>{var o=[];s.forEach(function(l){o.push(l.getComponent())}),n(o)}):(console.warn("Update Error - No data provided"),a("Update Error - No data provided"))})}updateOrAddData(e){var i=[],r=0;return this.initGuard(),new Promise((n,a)=>{this.dataLoader.blockActiveLoad(),typeof e=="string"&&(e=JSON.parse(e)),e&&e.length>0?e.forEach(s=>{var o=this.rowManager.findRow(s[this.options.index]);r++,o?o.updateData(s).then(()=>{r--,i.push(o.getComponent()),r||n(i)}):this.rowManager.addRows(s).then(l=>{r--,i.push(l[0].getComponent()),r||n(i)})}):(console.warn("Update Error - No data provided"),a("Update Error - No data provided"))})}getRow(e){var i=this.rowManager.findRow(e);return i?i.getComponent():(console.warn("Find Error - No matching row found:",e),!1)}getRowFromPosition(e){var i=this.rowManager.getRowFromPosition(e);return i?i.getComponent():(console.warn("Find Error - No matching row found:",e),!1)}deleteRow(e){var i=[];this.initGuard(),Array.isArray(e)||(e=[e]);for(let r of e){let n=this.rowManager.findRow(r,!0);if(n)i.push(n);else return console.error("Delete Error - No matching row found:",r),Promise.reject("Delete Error - No matching row found")}return i.sort((r,n)=>this.rowManager.rows.indexOf(r)>this.rowManager.rows.indexOf(n)?1:-1),i.forEach(r=>{r.delete()}),this.rowManager.reRenderInPosition(),Promise.resolve()}addRow(e,i,r){return this.initGuard(),typeof e=="string"&&(e=JSON.parse(e)),this.rowManager.addRows(e,i,r,!0).then(n=>n[0].getComponent())}updateOrAddRow(e,i){var r=this.rowManager.findRow(e);return this.initGuard(),typeof i=="string"&&(i=JSON.parse(i)),r?r.updateData(i).then(()=>r.getComponent()):this.rowManager.addRows(i).then(n=>n[0].getComponent())}updateRow(e,i){var r=this.rowManager.findRow(e);return this.initGuard(),typeof i=="string"&&(i=JSON.parse(i)),r?r.updateData(i).then(()=>Promise.resolve(r.getComponent())):(console.warn("Update Error - No matching row found:",e),Promise.reject("Update Error - No matching row found"))}scrollToRow(e,i,r){var n=this.rowManager.findRow(e);return n?this.rowManager.scrollToRow(n,i,r):(console.warn("Scroll Error - No matching row found:",e),Promise.reject("Scroll Error - No matching row found"))}moveRow(e,i,r){var n=this.rowManager.findRow(e);this.initGuard(),n?n.moveToRow(i,r):console.warn("Move Error - No matching row found:",e)}getRows(e){return this.rowManager.getComponents(e)}getRowPosition(e){var i=this.rowManager.findRow(e);return i?i.getPosition():(console.warn("Position Error - No matching row found:",e),!1)}setColumns(e){this.initGuard(!1,"To set initial columns please use the 'columns' property in the table constructor"),this.columnManager.setColumns(e)}getColumns(e){return this.columnManager.getComponents(e)}getColumn(e){var i=this.columnManager.findColumn(e);return i?i.getComponent():(console.warn("Find Error - No matching column found:",e),!1)}getColumnDefinitions(){return this.columnManager.getDefinitionTree()}showColumn(e){var i=this.columnManager.findColumn(e);if(this.initGuard(),i)i.show();else return console.warn("Column Show Error - No matching column found:",e),!1}hideColumn(e){var i=this.columnManager.findColumn(e);if(this.initGuard(),i)i.hide();else return console.warn("Column Hide Error - No matching column found:",e),!1}toggleColumn(e){var i=this.columnManager.findColumn(e);if(this.initGuard(),i)i.visible?i.hide():i.show();else return console.warn("Column Visibility Toggle Error - No matching column found:",e),!1}addColumn(e,i,r){var n=this.columnManager.findColumn(r);return this.initGuard(),this.columnManager.addColumn(e,i,n).then(a=>a.getComponent())}deleteColumn(e){var i=this.columnManager.findColumn(e);return this.initGuard(),i?i.delete():(console.warn("Column Delete Error - No matching column found:",e),Promise.reject())}updateColumnDefinition(e,i){var r=this.columnManager.findColumn(e);return this.initGuard(),r?r.updateDefinition(i):(console.warn("Column Update Error - No matching column found:",e),Promise.reject())}moveColumn(e,i,r){var n=this.columnManager.findColumn(e),a=this.columnManager.findColumn(i);this.initGuard(),n?a?this.columnManager.moveColumn(n,a,r):console.warn("Move Error - No matching column found:",a):console.warn("Move Error - No matching column found:",e)}scrollToColumn(e,i,r){return new Promise((n,a)=>{var s=this.columnManager.findColumn(e);return s?this.columnManager.scrollToColumn(s,i,r):(console.warn("Scroll Error - No matching column found:",e),Promise.reject("Scroll Error - No matching column found"))})}redraw(e){this.initGuard(),this.columnManager.redraw(e),this.rowManager.redraw(e)}setHeight(e){this.options.height=isNaN(e)?e:e+"px",this.element.style.height=this.options.height,this.rowManager.initializeRenderer(),this.rowManager.redraw(!0)}on(e,i){this.externalEvents.subscribe(e,i)}off(e,i){this.externalEvents.unsubscribe(e,i)}dispatchEvent(){var e=Array.from(arguments);e.shift(),this.externalEvents.dispatch(...arguments)}alert(e,i){this.initGuard(),this.alertManager.alert(e,i)}clearAlert(){this.initGuard(),this.alertManager.clear()}modExists(e,i){return this.modules[e]?!0:(i&&console.error("Tabulator Module Not Installed: "+e),!1)}module(e){var i=this.modules[e];return i||console.error("Tabulator module not installed: "+e),i}}var py=ip;class tIe extends py{static extendModule(){py.initializeModuleBinder(DA),py._extendModule(...arguments)}static registerModule(){py.initializeModuleBinder(DA),py._registerModule(...arguments)}constructor(e,i,r){super(e,i,DA)}}var KI=tIe,iIe=Object.defineProperty,ct=(t,e)=>{for(var i in e)iIe(t,i,{get:e[i],enumerable:!0})};function BE(){return"2.4.6-beta.2"}var JY={};ct(JY,{competitionGovernor:()=>QY,drawsGovernor:()=>UR,entriesGovernor:()=>CX,eventGovernor:()=>FX,generationGovernor:()=>QX,matchUpFormatGovernor:()=>lJ,matchUpGovernor:()=>uJ,mocksGovernor:()=>G_,participantGovernor:()=>rQ,policyGovernor:()=>aX,publishingGovernor:()=>PQ,queryGovernor:()=>uX,rankingGovernor:()=>i$,reportGovernor:()=>BQ,scheduleGovernor:()=>r$,scoreGovernor:()=>m0,temporalGovernor:()=>SZ,tieFormatGovernor:()=>eZ,tournamentGovernor:()=>uZ,venueGovernor:()=>JZ});var QY={};ct(QY,{getLinkedTournamentIds:()=>Ww,getTournamentIds:()=>Gw,linkTournaments:()=>Q5,mutate:()=>ZY,query:()=>tK,unlinkTournament:()=>eK,unlinkTournaments:()=>Z5});var ZY={};ct(ZY,{linkTournaments:()=>Q5,unlinkTournament:()=>eK,unlinkTournaments:()=>Z5});var Zf="SINGLES",Wt="SINGLES",Sp="DOUBLES",$t="DOUBLES",ka="TEAM",Zt="TEAM",rIe={SINGLES_MATCHUP:Zf,SINGLES:Wt,DOUBLES_MATCHUP:Sp,DOUBLES:$t,TEAM_MATCHUP:ka,TEAM:Zt},e6={[Wt]:[Wt,"S"],[$t]:[$t,"D"],[Zt]:[Zt,"T"],S:[Wt,"S"],D:[$t,"D"],T:[Zt,"T"]};function ir(t,e){return(t??0)-(e??0)}function Ye(t){return typeof t=="number"?parseInt(t.toString()):typeof t=="string"?parseInt(t):0}function pa(t){return typeof t=="function"}function ri(t){return typeof t=="string"}function bt(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)}function nIe(t,e){if(!bt(t)||!bt(e))return!1;let i=Object.keys(t),r=Object.keys(e);if(i.length!==r.length)return!1;for(let n of i)if(t[n]!==e[n])return!1;return!0}function t6(t,e){return Array.isArray(t)?Object.assign({},...(t??[]).filter(bt).map(i=>i[e]&&{[i[e]]:i}).filter(Boolean)):{}}var aIe=t=>e=>Object.keys(t).every(i=>e[i]===t[i]);function Wk(t,e){if(t===void 0)return null;if(!bt(t)||t===null)return t;let i=Object.keys(t),r=n=>n===void 0?null:n;return Object.assign({},...i.map(n=>Array.isArray(t[n])?{[n]:e?t[n]:t[n].map(a=>Wk(a))}:{[n]:e?r(t[n]):Wk(t[n])}))}function zk(t){return Array.isArray(t)?t.length+t.map(zk).reduce((e,i)=>e+i,0):bt(t)&&t!==null?Object.keys(t).length+Object.keys(t).map(e=>zk(t[e])).reduce((e,i)=>e+i,0):0}function sIe(t){if(t===null||typeof t!="object")return;let e=JSON.stringify(t),i=zk(t),r=e.split("").reduce((n,a)=>n+a.charCodeAt(0),0);return[e.length,i,r].map(n=>n.toString(36)).join("")}function Uo(t){return Number.isNaN(Number(t))?!1:t>0&&(t&t-1)===0}function RH(t){if(!t.length)return;let e=[...t].sort(ir),i=Math.floor(e.length/2);return e.length%2?e[i]:(e[i-1]+e[i])/2}function oIe(t){if(t===1||Number.isNaN(Number(t))||!Uo(t))return!1;let e=t,i=1;for(;e!==2;)i+=1,e=e/2;return i}function A1(t){return Number.isNaN(Number(t))?0:t%2&&t+1||t}function k1(t){return Math.pow(2,Math.round(Math.log(t)/Math.log(2)))}function Ni(t){return!Number.isNaN(Number.parseFloat(t))}function i6(t){let e=Ye(t);if(!Number.isNaN(e))return e===0?!1:(e&-e)===1}function XI(t){if(Number.isNaN(Number(t)))return!1;for(;!Uo(t);)t++;return t}function ts(t,e){return t=Math.ceil(t),e=Math.floor(e),Math.floor(Math.random()*(e-t+1))+t}function ot(t){return ri(t)&&!t.trim().length?!1:Number.isSafeInteger(typeof t=="string"?+t:t)}function lIe(t=1,e=3,i=!0){let r=0;for(let n=0;n<e;n++)r+=Math.random()*(t/e);return i&&t>1?Math.round(r):r}function uIe(t,e){e||(e=1);let i=1/e;return Math.round(t*i)/i}function r6(t,e,i,r,n=2){let a=1-Math.random(),s=1-Math.random(),o=Math.sqrt(-2*Math.log(a))*Math.cos(2*Math.PI*s);return o=o/10+.5,o>1||o<0?o=r6(t,e,i):(o=Math.pow(o,i),o*=e-t,o+=t),r&&(o=uIe(o,r)),Number.parseFloat(o.toFixed(n))}function _D(t,e=2){return Number.parseFloat(Number(Math.round(t*1e3)/1e3).toFixed(e))}function rt(t){return Array.isArray(t)?t?.filter((e,i,r)=>r.lastIndexOf(e)===i):[]}function cIe(t){return Array.isArray(t)?t?.map(e=>e===null?void 0:e):t}function Dn(t){return Array.isArray(t)?t.map(e=>[Math.random(),e]).sort((e,i)=>e[0]-i[0]).map(e=>e[1]):[]}function qg(t){return ot(t)?t:1/0}function va(t){return Array.isArray(t)?t.reduce((e,i)=>(e[i]||(e[i]=0),e[i]++,e),{}):{}}function dIe(t){return n6(va(t))}function n6(t){return Object.keys(t).reduce((e,i)=>{let r=t[i];return e[r]?e[r].push(i):e[r]=[i],e},{})}function pIe(t,e,i){return i.indexOf(t)===e}function a6(t){return t.filter(pIe)}function ma(t){return Array.isArray(t)&&t.length?t.splice(Math.floor(Math.random()*t.length),1)[0]:void 0}function da(t){let e=Math.floor(Math.random()*t.length);return t[e]}function Re(t,e){return Array.from({length:e-t},(i,r)=>r+t)}function qo(t,e){return e.reduce((i,r,n)=>(r===t&&i.push(n),i),[])}function xi(t,e){return!Array.isArray(t)||!Array.isArray(e)?[]:t.filter(i=>e.indexOf(i)!==-1).filter((i,r,n)=>n.indexOf(i)===r)}function CH(t,e){return!Array.isArray(t)||!Array.isArray(e)?[]:t.filter(i=>!e.includes(i))}function kn(t,e){return!Array.isArray(t)||!Array.isArray(e)?!1:t.some(i=>e.includes(i))}function fIe(t,e){return Array.isArray(e)&&e.reduce((i,r)=>(i[r]=1+i[r]||1,i),{})[t]||0}function mIe(t,e,i,r){return Array.isArray(t)?[].concat(...t.slice(0,e),...t.slice(e,e+i).sort(r),...t.slice(e+i,t.length)):[]}function yr(t,e){return Array.isArray(t)?t.reduce((i,r,n)=>{let a=Math.floor(n/e);return i[a]=[].concat(i[a]||[],r),i},[]):[]}function s6(t,[e,...i]){return t.length?[t.slice(0,e),...s6(t.slice(e),[...i,e])]:[]}function hIe(t){return t.reduce((e,i)=>{let r=e[e.length-1];return(!r||r[r.length-1]!==i-1)&&e.push([]),e[e.length-1].push(i),e},[])}function o6(t){return Array.isArray(t)?t.reduce((e,i)=>!isNaN(parseInt(i))&&e,!0):!1}function l6(t){return Array.isArray(t)?t.reduce((e,i)=>isNaN(parseInt(i))&&e,!0):!1}function qk(t,e,i){return Array.isArray(t)?t.reduce((r,n,a)=>{let s=i?!!(Math.floor(a/e)%2):!1,o=a%e,l=s?e-1-o:o;return r[l]||(r[l]=[]),r[l].push(n),r},[]):[]}function gIe(t,e=1){if(!Array.isArray(t)||!t.every(ot))return[];let i=Math.min(...t,e),r=Math.max(...t);return Re(i,r+1).filter(n=>!t.includes(n))}function em(t,e){return!Array.isArray(t)||!ri(e)?!1:xi(t,e6[e]).length}var H={success:!0},u6="error",IIe={SUCCESS:H,ERROR:u6};function c6({collectionValueProfiles:t,matchUpCount:e}){let i=[];if(!Array.isArray(t))return i.push(`collectionValueProfiles is not an array: ${t}`),{errors:i};if(t.length&&t.length!==e)return i.push("collectionValueProfiles do not align with matchUpsCount"),{errors:i};for(let n of t){if(typeof n!="object")return i.push(`valueProfile is not type object: ${n}`),{errors:i};let{matchUpValue:a,collectionPosition:s}=n;if(typeof a!="number"||typeof s!="number"||s>e||s<1)return i.push("Invalid value profile: value and collectionPosition must be numeric. collectionPosition cannot be greater than matchUpCount"),{errors:i}}let r=t.map(n=>n.collectionPosition);return r.length!==rt(r).length?(i.push("collectionPositions are not unique"),{errors:i}):{...H}}var vIe={};ct(vIe,{addNotice:()=>at,callListener:()=>rO,createInstanceState:()=>tve,cycleMutationStatus:()=>oF,deepCopyEnabled:()=>sF,deleteNotice:()=>lF,deleteNotices:()=>Ow,disableNotifications:()=>R4,enableNotifications:()=>ZE,getDevContext:()=>ra,getMethods:()=>N4,getNotices:()=>A4,getProvider:()=>nO,getTopics:()=>gs,getTournamentId:()=>nh,getTournamentRecord:()=>uF,getTournamentRecords:()=>ah,globalLog:()=>x4,handleCaughtError:()=>iR,hasTopic:()=>eR,removeTournamentRecord:()=>O4,setDeepCopy:()=>db,setDevContext:()=>cb,setGlobalLog:()=>E4,setGlobalMethods:()=>C4,setGlobalSubscriptions:()=>rve,setMethods:()=>M4,setStateMethods:()=>F4,setStateProvider:()=>eve,setSubscriptions:()=>nve,setTournamentId:()=>pb,setTournamentRecord:()=>k4,setTournamentRecords:()=>tR,timeKeeper:()=>ive});var Yk={message:"Chronological error; time violation.",code:"ANACHRONISM"},lb={message:"Duplicate entry",code:"DUPLICATE_ENTRY"},d6={message:"Cannot remove main structure",code:"ERR_CANNOT_REMOVE_MAIN_STRUCTURE"},Kk={message:"records must be an object with tournamentId keys",code:"ERR_INVALID_TOURNAMENTS"},Ci={message:"Missing tournamentRecords",code:"ERR_MISSING_TOURNAMENTS"},Ie={message:"Missing tournamentRecord",code:"ERR_MISSING_TOURNAMENT"},Pw={message:"Invalid tournamentRecord",code:"ERR_INVALID_TOURNAMENT"},Yg={message:"Missing tournamentId",code:"ERR_MISSING_TOURNAMENT_ID"},tm={message:"Invalid drawDefinition",code:"ERR_INVALID_DRAWDEF"},_e={message:"Missing drawDefinition",code:"ERR_MISSING_DRAWDEF"},p6={message:"Existing drawDefinition(s)",code:"ERR_EXISTING_DRAWDEFS"},Oa={message:"drawDefinition not found",code:"ERR_NOT_FOUND_DRAWDEF"},Qp={message:"Invalid structure",code:"ERR_INVALID_STRUCTURE"},O1={message:"Incomplete source structure",code:"ERR_INCOMPLETE_STRUCTURE"},x1={message:"Invalid drawPosition for seedAssignment",code:"ERR_INVALID_SEEDING_POSITION"},Kg={message:"drawPosition already assigned",code:"ERR_EXISTING_POSITION_ASSIGNMENT"},f6={message:"Schedule not cleared",code:"ERR_UNCHANGED_SCHEDULE_NOT_CLEARED"},m6={message:"Schedule conflict: court slot already occupied",code:"ERR_SCHEDULE_CONFLICT_DOUBLE_BOOKING"},h6={message:"drawPosition not cleared",code:"ERR_FAILURE_POSITION_NOT_CLEARED"},yIe={message:"drawPosition not found",code:"ERR_NOT_FOUND_DRAW_POSITION"},F1={message:"Unrecognized drawType",code:"ERR_UNRECOGNIZED_DRAW_TYPE"},Ew={message:"Missing drawPositions",code:"ERR_MISSING_DRAW_POSITIONS"},Rw={message:"drawPosition is active",code:"ERR_ACTIVE_DRAW_POSITION"},bIe={message:"drawPosition is occupied",code:"ERR_OCCUPIED_DRAW_POSITION"},eh={message:"Invlid drawPosition",code:"ERR_INVALID_DRAW_POSITION"},JI={message:"Missing drawPosition",code:"ERR_MISSING_DRAW_POSITION"},L1={message:"Invalid drawType",code:"ERR_INVALID_DRAW_TYPE"},VE={message:"Invalid drawSize",code:"ERR_INVALID_DRAW_SIZE"},g6={message:"Cannot set drawSize to be less than existing entries",code:"ERR_INVALID_DRAW_SIZE_MISMATCH"},Cw={message:"Missing drawSize",code:"ERR_MISSING_DRAW_SIZE"},Oo={message:"Missing drawId",code:"ERR_MISSING_DRAW_ID"},I6={message:"drawId exists",code:"ERR_EXISTING_DRAW_ID"},v6={message:"participantId cannot be assigned to multiple seedNumbers",code:"INVALID_PARTICIPANT_SEEDING"},y6={message:"seedsCount greater than drawSize",code:"ERR_INVALID_SEED_COUNT"},b6={message:"Missing seedCountThresholds",code:"ERR_MISSING_SEED_COUNT_THRESHOLD"},w6={message:"Invalid action",code:"ERR_INVALID_ACTION"},Xk={message:"Invalid assignment",code:"ERR_INVALID_ASSIGNMENT"},S6={message:"Missing seedAssignments",code:"ERR_MISSING_SEED_ASSIGNMENTS"},U6={message:"Invalid seedNumber",code:"ERR_INVALID_SEED_NUMBER"},T6={message:"Invalid seedPosition",code:"ERR_INVALID_SEED_POSITION"},_1={message:"Missing targetLink",code:"ERR_MISSING_LINK_TARGET"},D6={message:"Existing round",code:"ERR_EXISTING_ROUND"},wIe={message:"Missing roundNumber",code:"ERR_MISSING_ROUND_NUMBER"},Va={message:"Missing structureId",code:"ERR_MISSING_STRUCTURE_ID"},Ii={message:"structure not found",code:"ERR_NOT_FOUND_STRUCTURE"},$1={message:"Missing structures",code:"ERR_MISSING_STRUCTURES"},Zp={message:"Missing structure",code:"ERR_MISSING_STRUCTURE"},B1={message:"Missing MAIN structure",code:"ERR_MISSING_MAIN_STRUCTURE"},P6={message:"drawDefinition contains unlinked structures",code:"ERR_MISSING_STRUCTURE_LINKS"},Zl={message:"Invalid eventType",code:"ERR_INVALID_EVENT_TYPE"},li={message:"Missing event / eventId",code:"ERR_MISSING_EVENT_ID"},os={message:"Event not found",code:"ERR_NOT_FOUND_EVENT"},E6={message:"Event exists",code:"ERR_EXISTING_EVENT"},R6={message:"Missing entries",code:"ERR_MISSING_ENTRIES"},C6={message:"Invalid entries",code:"ERR_INVALID_ENTRIES"},V1={message:"Missing assignments",code:"ERR_MISSING_ASSIGNMENTS"},M6={message:"Missing stage",code:"ERR_MISSING_STAGE"},ef={message:"Invalid stage",code:"ERR_INVALID_STAGE"},N6={message:"stageSequence limit",code:"ERR_LIMIT_STAGE_SEQUENCE"},A6={message:"Missing positionAssignments",code:"ERR_MISSING_POSITION_ASSIGNMENTS"},k6={message:"Cannot Assign BYE status if no assignment: { bye: true }",code:"ERR_UNCHANGED_CANNOT_ASSIGN_BYE"},Jk={message:"Unrecognized matchUpStatus",code:"ERR_UNRECOGNIZED_MATCHUP_STATUS"},Mw={message:"Unrecognized matchUpFormat",code:"ERR_UNRECOGNIZED_MATCHUP_FORMAT"},zT={message:"Incompatible matchUpStatus",code:"ERR_INCOMPATIBLE_MATCHUP_STATUS"},SIe={message:"Propagated exits downstream",code:"ERR_PROPAGATED_EXITS_DOWNSTREAM"},QI={message:"Invalid matchUpStatus",code:"ERR_INVALID_MATCHUP_STATUS"},Vl={message:"Invalid tieFormat",code:"ERR_INVALID_TIE_FORMAT"},O6={message:"Invalid matchUpFormat",code:"ERR_INVALID_MATCHUP_FORMAT"},x6={message:"Missing matchUpFormat",code:"ERR_MISSING_MATCHUP_FORMAT"},F6={message:"Missing collectionDefinition",code:"ERR_MISSING_COLLECTION_DEFINITION"},ZI={message:"Missing tieFormat",code:"ERR_MISSING_TIE_FORMAT"},Un={message:"Missing matchUpId",code:"ERR_MISSING_MATCHUP_ID"},th={message:"Missing matchUpIds",code:"ERR_MISSING_MATCHUP_IDS"},un={message:"matchUp not found",code:"ERR_NOT_FOUND_MATCHUP"},Tu={message:"Missing matchUps",code:"ERR_MISSING_MATCHUPS"},ta={message:"Missing matchUp",code:"ERR_MISSING_MATCHUP"},ia={message:"Invalid matchUp",code:"ERR_INVALID_MATCHUP"},j1={message:"Missing policyType",code:"ERR_MISSING_POLICY_TYPE"},jE={message:"Missing policyDefinitions",code:"ERR_MISSING_POLICY_DEFINITIONS"},UIe={message:"Missing seeding policy",code:"ERR_MISSING_POLICY_SEEDING"},L6={message:"Missing avoidance policy",code:"ERR_MISSING_POLICY_AVOIDANCE"},G1={message:"Missing policy attributes",code:"ERR_MISSING_POLICY_ATTRIBUTES"},_6={message:"Invalid policyDefinitions",code:"ERR_INVALID_POLICY_DEFINITIONS"},H1={message:"existing policyType",code:"ERR_EXISTING_POLICY_TYPE"},TIe={message:"Policy not attached",code:"ERR_FAILURE_POLICY_NOT_ATTACHED"},Nw={message:"Policy not found",code:"ERR_NOT_FOUND_POLICY"},DIe={message:"Missing scoring policy / matchUpFormats",code:"ERR_MISSING_POLICY_SCORING_MATCHUP_FORMATS"},$6={message:"Invalid sideNumber",code:"ERR_INVALID_SIDE_NUMBER"},PIe={message:"Invalid setNumber",code:"ERR_INVALID_SET_NUMBER"},GE={message:"Missing setObject",code:"ERR_MISSING_SET_ATTRIBUTE"},EIe={message:"Missing setNumber",code:"ERR_MISSING_SET_NUMBER"},RIe={message:"Missing sideNumber",code:"ERR_MISSING_SIDE_NUMBER"},ih={message:"Missing courtId",code:"ERR_MISSING_COURT_ID"},Xe={message:"Missing value",code:"ERR_MISSING_VALUE"},B6={message:"Missing birthdate",code:"ERR_MISSING_BIRTH_DATE"},V6={message:"Missing date",code:"ERR_MISSING_DATE"},j6={message:"No valid dates",code:"ERR_NO_VALID_DATES"},$D={message:"Invalid bookings",code:"ERR_INVALID_BOOKINGS"},qT={message:"Invalid dateAvailability",code:"ERR_INVALID_DATE_AVAILABILITY"},G6={message:"Missing dateAvailability",code:"ERR_MISSING_DATE_AVAILABILITY"},sr={message:"Invalid Date",code:"ERR_INVALID_DATE"},Ps={message:"Invalid time",code:"ERR_INVALID_TIME"},H6={message:"Invalid tournament dates",code:"ERR_INVALID_DATES_TOURNAMENT"},CIe={message:"Missing date range",info:"Event or tournament must have start and end dates",code:"ERR_MISSING_DATE_RANGE"},HE={message:"Invalid Time Zone",code:"ERR_INVALID_TIME_ZONE"},Rg={message:"Invalid embargo: must be an ISO 8601 datetime with timezone (Z or HH:MM offset)",code:"ERR_INVALID_EMBARGO"},Qk={message:"Invalid game scores",code:"ERR_INVALID_SCORES_GAME"},W6={message:"Invalid score",code:"ERR_INVALID_SCORE"},WE={message:"Invalid winningSide",code:"ERR_INVALID_WINNING_SIDE"},MIe={message:"No participants generated",code:"ERR_NO_PARTICIPANTS_GENERATED"},W1={message:"Cannot modify tieFormat",code:"ERR_UNCHANGED_CANNOT_MODIFY_TIEFORMAT"},z6={message:"Cannot modify participantType",code:"ERR_UNCHANGED_CANNOT_MODIFY_PARTICIPANT_TYPE"},zE={message:"Cannot remove participants",code:"ERR_UNCHANGED_CANNOT_REMOVE_PARTICIPANTS"},q6={message:"Participant category mismatch",code:"ERR_CATEGORY_MISMATCH"},qE={message:"Cannot change winningSide",code:"ERR_UNCHANGED_CANNOT_CHANGE_WINNING_SIDE"},Up={message:"Invalid participant",code:"ERR_INVALID_PARTICIPANT"},To={message:"Invalid participantId",code:"ERR_INVALID_PARTICIPANT_ID"},ga={message:"Invalid participantIds",code:"ERR_INVALID_PARTICIPANT_IDS"},Y6={message:"Invalid participantRole",code:"ERR_INVALID_PARTICIPANT_ROLE"},Do={message:"Invalid participantType",code:"ERR_INVALID_PARTICIPANT_TYPE"},K6={message:"Missing participantRole",code:"ERR_MISSING_PARTICIPANT_ROLE"},rh={message:"Missing participant",code:"ERR_MISSING_PARTICIPANT"},Aw={message:"Missing participants",code:"ERR_MISSING_PARTICIPANTS"},lr={message:"Missing participantId",code:"ERR_MISSING_PARTICIPANT_ID"},X6={message:"Missing qualified participants",code:"ERR_MISSING_QUALIFIED_PARTICIPANTS"},Vi={message:"Participant Not Found",code:"ERR_NOT_FOUND_PARTICIPANT"},J6={message:"participantId exists",code:"ERR_EXISTING_PARTICIPANT_ID"},NIe={message:"participant pair exists",code:"ERR_EXISTING_PARTICIPANT_PAIR"},Q6={message:"No participant removed",code:"ERR_UNCHANGED_NO_PARTICIPANT_REMOVED"},Od={message:"Missing participantIds",code:"ERR_MISSING_PARTICIPANT_IDS"},Z6={message:"Missing participantsCount",code:"ERR_MISSING_PARTICIPANT_COUNT"},e4={message:"Participant not checked in",code:"ERR_UNCHANGED_PARTICIPANT_NOT_CHECKED_IN"},t4={message:"Missing person details",code:"ERR_MISSING_PERSON_DETAILS"},ev={message:"Existing participant drawPosition assignment",code:"ERR_EXISTING_PARTICIPANT_DRAW_POSITION_ASSIGNMENT"},YE={message:"Existing participant",code:"ERR_EXISTING_PARTICIPANT"},z1={message:"participantsCount exceeds drawSize",code:"ERR_INVALID_PARTICIPANT_COUNT"},Zk={message:"Invalid entry status",code:"ERR_INVALID_ENTRY_STATUS"},i4={message:"Participant Entry Not Found",code:"ERR_NOT_FOUND_PARTICIPANT_ENTRY"},AIe={message:"Participant not entered in stage",code:"ERR_UNCHANGED_PARTICIPANT_NOT_ENTERED"},kIe={message:"Participant not found in stageSequence",code:"ERR_NOT_FOUND_PARTICIPANT_IN_STAGE"},r4={message:"entryStatus not allowed in stage",code:"ERR_INVALID_ENTRY_STATUS_IN_STAGE"},n4={message:"entryStatus not allowed for event",code:"ERR_INVALID_ENTRY_STATUS_IN_EVENT"},eO={message:"No stage space available for entryStatus",code:"ERR_UNCHANGED_NO_AVAILABLE_STAGE_SPACE"},q1={message:"Insufficient drawPositions to accommodate qualifiers",code:"ERR_UNCHANGED_NO_DRAW_POSITIONS_FOR_QUALIFIERS"},Y1={message:"Insufficient drawPositions to accommodate entries",code:"ERR_INSUFFICIENT_DRAW_POSITIONS"},a4={message:"Missing penaltyType",code:"ERR_MISSING_PENALTY_TYPE"},K1={message:"Missing penaltyId",code:"ERR_MISSING_PENALTY_ID"},Xg={message:"Penalty not found",code:"ERR_NOT_FOUND_PENALTY"},s4={message:"Missing courtsCount/courtNames",code:"ERR_MISSING_COURTS_INFO"},ac={message:"Court not found",code:"ERR_NOT_FOUND_COURT"},o4={message:"Court exists",code:"ERR_EXISTING_COURT"},tO={message:"Booking not found",code:"ERR_NOT_FOUND_BOOKING"},l4={message:"Existing matchUps conflict with booking",code:"ERR_EXISTING_MATCHUPS"},u4={message:"Venue exists",code:"ERR_EXISTING_VENUE"},tf={message:"Venue not found",code:"ERR_NOT_FOUND_VENUE"},xd={message:"Missing venueId",code:"ERR_MISSING_VENUE_ID"},c4={message:"Invalid endTime",code:"ERR_INVALID_END_TIME"},X1={message:"Existing endTime",code:"ERR_EXISTING_END_TIME"},d4={message:"Invalid stopTime",code:"ERR_INVALID_STOP_TIME"},p4={message:"Invalid startTime",code:"ERR_INVALID_START_TIME"},OIe={message:"Invalid resumeTime",code:"ERR_INVALID_RESUME_TIME"},J1={message:"Invalid timeItem",code:"ERR_INVALID_TIME_ITEMS"},f4={message:"Missing async state provider",code:"ERR_MISSING_ASYNC_STATE_PROVIDER"},Q1={message:"Missing timeItem",code:"ERR_MISSING_TIME_ITEM"},Z1={message:"Missing timeItems",code:"ERR_MISSING_TIME_ITEMS"},KE={message:"Missing context",code:"ERR_MISSING_CONTEXT"},m4={message:"Missing schedule",code:"ERR_MISSING_SCHEDULE"},Dm={message:"Invalid scaleItem",code:"ERR_INVALID_SCALE_ITEM"},h4={message:"Modifications failed",code:"ERR_FAILURE_MODIFICATIONS"},tv={message:"No modifications applied",code:"ERR_UNCHANGED_NO_MODIFICATIONS_APPLIED"},g4={message:"Unable to assign court",code:"ERR_UNCHANGED_COURT_NOT_ASSIGNED"},XE={message:"No Candidates",code:"ERR_UNCHANGED_NO_CANDIDATES"},I4={message:"Invalid configuration",code:"ERR_INVALID_CONFIG"},v4={message:"Invalid collectionDefinition",code:"ERR_INVALID_COLLECTION_DEFINITION"},Ac={message:"Invalid object",code:"ERR_INVALID_OBJECT"},xy={message:"Invalid gender",code:"ERR_INVALID_GENDER"},ub={message:"Invalid category",code:"ERR_INVALID_CATEGORY"},ie={message:"Invalid values",code:"ERR_INVALID_VALUES"},y4={message:"Duplicate value",code:"ERR_DUPLICATE_VALUE"},eF={message:"Team not found",code:"ERR_NOT_FOUND_TEAM"},b4={message:"No valid actions",code:"ERR_NO_VALID_ACTIONS"},JE={message:"No valid attributes",code:"ERR_NO_VALID_ATTRIBUTES"},tF={message:"Value unchanged",code:"ABORT_UNCHANGED"},_r={message:"Not found",code:"ERR_NOT_FOUND"},iF={message:"Not implemented",code:"ERR_NOT_IMPLEMENTED"},w4={message:"Existing flight",code:"ERR_EXISTING_FLIGHT"},rF={message:"Existing flight profile",code:"ERR_EXISTING_FLIGHT_PROFILE"},S4={message:"Existing outcome",code:"ERR_EXISTING_OUTCOME"},U4={message:"Existing matchUpId",code:"ERR_EXISTING_MATCHUP_ID"},iO={message:"Existing stage",code:"ERR_EXISTING_STAGE"},nF={message:"Existing structure",code:"ERR_EXISTING_STRUCTURE"},QE={message:"Method not found",code:"ERR_NOT_FOUND_METHOD"},T4={message:"Scheduled matchUps",code:"ERR_SCHEDULED_MATCHUPS"},kw={message:"Scores present",code:"ERR_SCORES_PRESENT"},xIe={ANACHRONISM:Yk,BOOKING_NOT_FOUND:tO,CANNOT_CHANGE_WINNING_SIDE:qE,CANNOT_MODIFY_TIEFORMAT:W1,CANNOT_MODIFY_PARTICIPANT_TYPE:z6,CANNOT_REMOVE_MAIN_STRUCTURE:d6,CANNOT_REMOVE_PARTICIPANTS:zE,CATEGORY_MISMATCH:q6,COURT_EXISTS:o4,COURT_NOT_FOUND:ac,EXISTING_MATCHUPS:l4,DRAW_DEFINITION_NOT_FOUND:Oa,DRAW_ID_EXISTS:I6,DRAW_POSITION_ACTIVE:Rw,DRAW_POSITION_ASSIGNED:Kg,DRAW_POSITION_NOT_CLEARED:h6,DRAW_POSITION_NOT_FOUND:yIe,DRAW_SIZE_MISMATCH:g6,DUPLICATE_ENTRY:lb,DUPLICATE_VALUE:y4,ENTRY_STATUS_NOT_ALLOWED_FOR_EVENT:n4,ENTRY_STATUS_NOT_ALLOWED_IN_STAGE:r4,EVENT_EXISTS:E6,EVENT_NOT_FOUND:os,EXISTING_DRAW_DEFINITIONS:p6,EXISTING_END_TIME:X1,EXISTING_FLIGHT:w4,EXISTING_MATCHUP_ID:U4,EXISTING_OUTCOME:S4,EXISTING_PARTICIPANT_DRAW_POSITION_ASSIGNMENT:ev,EXISTING_PARTICIPANT:YE,EXISTING_POLICY_TYPE:H1,EXISTING_PROFILE:rF,EXISTING_ROUND:D6,EXISTING_STAGE:iO,EXISTING_STRUCTURE:nF,INCOMPATIBLE_MATCHUP_STATUS:zT,INCOMPLETE_SOURCE_STRUCTURE:O1,INSUFFICIENT_DRAW_POSITIONS:Y1,INVALID_ACTION:w6,INVALID_ASSIGNMENT:Xk,INVALID_BOOKINGS:$D,INVALID_CATEGORY:ub,INVALID_COLLECTION_DEFINITION:v4,INVALID_CONFIGURATION:I4,INVALID_DATE_AVAILABILITY:qT,INVALID_DATE:sr,INVALID_DRAW_DEFINITION:tm,INVALID_DRAW_POSITION_FOR_SEEDING:x1,INVALID_DRAW_POSITION:eh,INVALID_DRAW_SIZE:VE,INVALID_END_TIME:c4,INVALID_ENTRIES:C6,INVALID_EVENT_TYPE:Zl,INVALID_GAME_SCORES:Qk,INVALID_GENDER:xy,INVALID_MATCHUP_FORMAT:O6,INVALID_MATCHUP_STATUS:QI,INVALID_MATCHUP_STATUS_BYE:k6,INVALID_MATCHUP:ia,INVALID_OBJECT:Ac,INVALID_PARTICIPANT_ID:To,INVALID_PARTICIPANT_IDS:ga,INVALID_PARTICIPANT_ROLE:Y6,INVALID_PARTICIPANT_SEEDING:v6,INVALID_PARTICIPANT_TYPE:Do,INVALID_PARTICIPANT:Up,INVALID_POLICY_DEFINITION:_6,INVALID_RECORDS:Kk,INVALID_SCALE_ITEM:Dm,INVALID_SEED_NUMBER:U6,INVALID_SEED_POSITION:T6,INVALID_SET_NUMBER:PIe,INVALID_SIDE_NUMBER:$6,INVALID_SCORE:W6,INVALID_STAGE:ef,INVALID_START_TIME:p4,INVALID_STRUCTURE:Qp,INVALID_STOP_TIME:d4,INVALID_TIE_FORMAT:Vl,INVALID_TIME:Ps,INVALID_TIME_ITEM:J1,INVALID_TOURNAMENT_DATES:H6,INVALID_TOURNAMENT_RECORD:Pw,INVALID_VALUES:ie,INVALID_WINNING_SIDE:WE,MATCHUP_NOT_FOUND:un,METHOD_NOT_FOUND:QE,MISSING_ASSIGNMENTS:V1,MISSING_ASYNC_STATE_PROVIDER:f4,MISSING_AVOIDANCE_POLICY:L6,MISSING_BIRTH_DATE:B6,MISSING_COLLECTION_DEFINITION:F6,MISSING_COURT_ID:ih,MISSING_COURTS_INFO:s4,MISSING_DATE_AVAILABILITY:G6,MISSING_DATE:V6,MISSING_DRAW_DEFINITION:_e,MISSING_DRAW_ID:Oo,MISSING_DRAW_POSITION:JI,MISSING_DRAW_POSITIONS:Ew,MISSING_DRAW_SIZE:Cw,MISSING_ENTRIES:R6,MISSING_EVENT:li,MISSING_QUALIFIED_PARTICIPANTS:X6,MISSING_MATCHUP_FORMAT:x6,MISSING_MATCHUP_ID:Un,MISSING_MATCHUP_IDS:th,MISSING_MATCHUP:ta,MISSING_MATCHUPS:Tu,MISSING_PARTICIPANT_COUNT:Z6,MISSING_PARTICIPANT_ID:lr,MISSING_PARTICIPANT_IDS:Od,MISSING_PARTICIPANT_ROLE:K6,MISSING_PARTICIPANT:rh,MISSING_PARTICIPANTS:Aw,MISSING_PENALTY_ID:K1,MISSING_PENALTY_TYPE:a4,MISSING_PERSON_DETAILS:t4,MISSING_POLICY_ATTRIBUTES:G1,MISSING_POLICY_DEFINITION:jE,MISSING_POLICY_TYPE:j1,MISSING_POSITION_ASSIGNMENTS:A6,MISSING_ROUND_NUMBER:wIe,MISSING_SCHEDULE:m4,MISSING_SCORING_POLICY:DIe,MISSING_SEED_ASSIGNMENTS:S6,MISSING_SEEDCOUNT_THRESHOLDS:b6,MISSING_SEEDING_POLICY:UIe,MISSING_SET_NUMBER:EIe,MISSING_SET_OBJECT:GE,MISSING_SIDE_NUMBER:RIe,MISSING_STAGE:M6,MISSING_STRUCTURE_ID:Va,MISSING_STRUCTURE:Zp,MISSING_MAIN_STRUCTURE:B1,MISSING_STRUCTURES:$1,MISSING_TARGET_LINK:_1,MISSING_TIE_FORMAT:ZI,MISSING_TIME_ITEM:Q1,MISSING_TIME_ITEMS:Z1,MISSING_TOURNAMENT_ID:Yg,MISSING_TOURNAMENT_RECORD:Ie,MISSING_TOURNAMENT_RECORDS:Ci,MISSING_VALUE:Xe,MISSING_VENUE_ID:xd,MODIFICATIONS_FAILED:h4,NO_CANDIDATES:XE,NO_DRAW_POSITIONS_AVAILABLE_FOR_QUALIFIERS:q1,NO_MODIFICATIONS_APPLIED:tv,NO_STAGE_SPACE_AVAILABLE_FOR_ENTRY_STATUS:eO,NO_PARTICIPANT_REMOVED:Q6,NO_VALID_ACTIONS:b4,NO_VALID_ATTRIBUTES:JE,NO_VALID_DATES:j6,NOT_FOUND:_r,NOT_IMPLEMENTED:iF,PARTICIPANT_COUNT_EXCEEDS_DRAW_SIZE:z1,PARTICIPANT_ID_EXISTS:J6,PARTICIPANT_NOT_CHECKED_IN:e4,PARTICIPANT_NOT_FOUND:Vi,PARTICIPANT_PAIR_EXISTS:NIe,PENALTY_NOT_FOUND:Xg,POLICY_NOT_ATTACHED:TIe,POLICY_NOT_FOUND:Nw,SCHEDULE_NOT_CLEARED:f6,SCHEDULE_CONFLICT_DOUBLE_BOOKING:m6,SCHEDULED_MATCHUPS:T4,SCORES_PRESENT:kw,SEEDSCOUNT_GREATER_THAN_DRAW_SIZE:y6,STAGE_SEQUENCE_LIMIT:N6,STRUCTURE_NOT_FOUND:Ii,TEAM_NOT_FOUND:eF,UNABLE_TO_ASSIGN_COURT:g4,UNLINKED_STRUCTURES:P6,UNRECOGNIZED_DRAW_TYPE:F1,UNRECOGNIZED_MATCHUP_FORMAT:Mw,UNRECOGNIZED_MATCHUP_STATUS:Jk,VALUE_UNCHANGED:tF,VENUE_EXISTS:u4},hi={disableNotifications:!1,tournamentId:void 0,tournamentRecords:{},subscriptions:{},modified:!1,methods:{},notices:[]},D4={addNotice:qIe,callListener:QIe,cycleMutationStatus:zIe,deleteNotice:XIe,deleteNotices:KIe,disableNotifications:FIe,enableNotifications:LIe,getMethods:aF,getNotices:YIe,getTopics:JIe,getTournamentId:P4,getTournamentRecord:_Ie,getTournamentRecords:$Ie,removeTournamentRecord:GIe,setMethods:WIe,setSubscriptions:HIe,setTournamentId:VIe,setTournamentRecord:BIe,setTournamentRecords:jIe,handleCaughtError:ZIe};function FIe(){hi.disableNotifications=!0}function LIe(){hi.disableNotifications=!1}function P4(){return hi.tournamentId}function _Ie(t){return hi.tournamentRecords[t]}function $Ie(){return hi.tournamentRecords}function BIe(t){let e=t?.tournamentId;return e?(hi.tournamentRecords[e]=t,{success:!0}):{error:Pw}}function VIe(t){return t?hi.tournamentRecords[t]?(hi.tournamentId=t,{success:!0}):{error:Ie}:(hi.tournamentId=void 0,{success:!0})}function jIe(t){hi.tournamentRecords=t;let e=Object.keys(t);e.length===1?hi.tournamentId=e[0]:e.length||(hi.tournamentId=void 0)}function GIe(t){if(typeof t!="string")return{error:ie};if(!hi.tournamentRecords[t])return{error:_r};delete hi.tournamentRecords[t];let e=Object.keys(hi.tournamentRecords);return e.length===1?hi.tournamentId=e[0]:e.length||(hi.tournamentId=void 0),{success:!0}}function HIe(t){return t.subscriptions===null||Object.keys(t.subscriptions).length===0?(hi.subscriptions={},{...H}):typeof t.subscriptions!="object"?{error:ie}:(Object.keys(t.subscriptions).forEach(e=>{typeof t.subscriptions[e]=="function"?hi.subscriptions[e]=t.subscriptions[e]:delete hi.subscriptions[e]}),{...H})}function WIe(t){return typeof t!="object"?{error:ie}:(Object.keys(t).forEach(e=>{typeof t[e]=="function"&&(hi.methods[e]=t[e])}),{...H})}function zIe(){let t=hi.modified;return hi.modified=!1,t}function qIe({topic:t,payload:e,key:i},r){if(!(typeof t!="string"||typeof e!="object")&&(hi.disableNotifications||(hi.modified=!0),!(hi.disableNotifications||!hi.subscriptions[t]&&!r)))return i&&(hi.notices=hi.notices.filter(n=>!(n.topic===t&&n.key===i))),hi.notices.push({topic:t,payload:e,key:i}),{...H}}function aF(){return hi.methods??{}}function YIe({topic:t}){return hi.notices.filter(e=>e.topic===t).map(e=>e.payload)}function KIe(){hi.notices=[]}function XIe({topic:t,key:e}){hi.notices=hi.notices.filter(i=>(!t||i.topic===t)&&i.key!==e)}function JIe(){return{topics:Object.keys(hi.subscriptions)}}function QIe({topic:t,notices:e},i){let r=hi.subscriptions[t];r&&typeof r=="function"&&r(e);let n=i?.[t];n&&typeof n=="function"&&n(e)}function ZIe({engineName:t,methodName:e,params:i,err:r}){let n;return typeof r=="string"?n=r.toUpperCase():r instanceof Error&&(n=r.message),console.log("ERROR",{tournamentId:P4(),params:JSON.stringify(i),engine:t,methodName:e,error:n}),{error:n}}var Xt={timers:{default:{elapsedTime:0}},globalSubscriptions:{},deepCopyAttributes:{stringify:[],ignore:[],toJSON:[]},globalMethods:[],deepCopy:!0},Nr=D4,MH=["addNotice","callListener","cycleMutationStatus","deleteNotice","deleteNotices","disableNotifications","enableNotifications","getMethods","getNotices","getTopics","getTournamentId","getTournamentRecord","getTournamentRecords","removeTournamentRecord","setSubscriptions","setTournamentId","setTournamentRecord","setTournamentRecords"];function eve(t){if(typeof t!="object")throw new Error("Global state provider can not be undefined or null");if(xi(Object.keys(t),MH).length!==MH.length)throw new Error("Global state provider is missing required methods");return Nr=t,{success:!0}}function tve(){if(Nr.createInstanceState){try{Nr.createInstanceState()}catch(t){return{error:t}}return{success:!0}}else return{error:f4}}function ra(t){return!t||typeof t!="object"?Xt.devContext??!1:typeof Xt.devContext!="object"?!1:Object.keys(t).every(e=>Xt.devContext?.[e]===t[e])&&Xt.devContext}function ive(t="reset",e="default"){let i=Date.now();if(t==="report"){if(e==="allTimers")return Object.keys(Xt.timers).filter(r=>r!=="default"||Xt.timers[r].startTime).map(r=>{let n=Xt.timers[r],a=n.state==="stopped"?0:(i-(n?.startTime??0))/1e3,s=n.elapsedTime+a;return{state:Xt.timers[r].state,elapsedTime:s.toFixed(2),timer:r}});{let r=Xt.timers[e].state==="stopped"?0:(i-(Xt.timers[e]?.startTime??0))/1e3,n=Xt.timers[e].elapsedTime+r;return{state:Xt.timers[e].state,elapsedTime:n.toFixed(2),timer:e}}}if(!Xt.timers[e]||t==="reset"){if(e==="allTimers")return Xt.timers={default:{elapsedTime:0}},!0;Xt.timers[e]={startTime:i,state:"active",elapsedTime:0}}return Xt.timers[e].elapsedTime||(Xt.timers[e].elapsedTime=0),t==="stop"&&Xt.timers[e].state!=="stopped"&&(Xt.timers[e].state="stopped")&&(Xt.timers[e].elapsedTime+=(i-(Xt.timers[e]?.startTime??0))/1e3),t==="start"&&(Xt.timers[e].startTime=i)&&(Xt.timers[e].state="active"),Xt.timers[e]}function E4(t){pa(t)?Xt.globalLog=t:delete Xt.globalLog}function cb(t){Xt.devContext=t}function R4(){Nr.disableNotifications()}function ZE(){Nr.enableNotifications()}function db(t,e){typeof t=="boolean"&&(Xt.deepCopy=t),typeof e=="object"&&(Array.isArray(e.ignore)&&(Xt.deepCopyAttributes.ignore=e.ignore),Array.isArray(e.toJSON)&&(Xt.deepCopyAttributes.toJSON=e.toJSON),Array.isArray(e.stringify)&&(Xt.deepCopyAttributes.stringify=e.stringify),e.threshold&&(Xt.deepCopyAttributes.threshold=e.threshold))}function sF(){return{enabled:Xt.deepCopy,...Xt.deepCopyAttributes}}function rve(t){return t?.subscriptions?(Object.keys(t.subscriptions).forEach(e=>{Xt.globalSubscriptions[e]=t.subscriptions[e]}),{...H}):{error:Xe,info:"missing subscriptions"}}function nve(t){return t?.subscriptions?Nr.setSubscriptions({subscriptions:t.subscriptions}):{error:Xe,info:"missing subscriptions"}}function C4(t){return t?typeof t!="object"?{error:ie}:(Object.keys(t).forEach(e=>{pa(t[e])&&(Xt.globalMethods[e]=t[e])}),{...H}):{error:Xe,info:"missing method declarations"}}function M4(t){return t?typeof t!="object"?{error:ie}:Nr.setMethods(t):{error:Xe,info:"missing method declarations"}}function oF(){return Nr.cycleMutationStatus()}function at(t){if(typeof t?.topic!="string")return;let e=Xt.globalSubscriptions[t.topic];return Nr.addNotice(t,e)}function N4(){return{...Xt.globalMethods,...Nr.getMethods()}}function A4(t){return Nr.getNotices(t)}function lF({key:t,topic:e}){return Nr.deleteNotice({key:t,topic:e})}function Ow(){return Nr.deleteNotices()}function gs(){return Nr.getTopics()}function eR(t){return gs()?.topics?.includes(t)}async function rO(t){return Nr.callListener(t,Xt.globalSubscriptions)}function nh(){return Nr.getTournamentId()}function uF(t){return Nr.getTournamentRecord(t)}function ah(){return Nr.getTournamentRecords()}function k4(t){return Nr.setTournamentRecord(t)}function tR(t){return Nr.setTournamentRecords(t)}function pb(t){return Nr.setTournamentId(t)}function O4(t){return Nr.removeTournamentRecord(t)}function nO(){return Nr}function iR({engineName:t,methodName:e,params:i,err:r}){let n=pa(Nr.handleCaughtError)&&Nr.handleCaughtError||D4.handleCaughtError,{tournamentRecord:a,...s}=i;return n({params:s,engineName:t,methodName:e,err:r})}function x4(t,e){if(Xt.globalLog)try{Xt.globalLog({log:t,engine:e})}catch(i){console.log("globalLog error",i),console.log(e,t),E4()}else console.log(e,t)}function F4(t,e,i,r){if(!bt(t))return{error:ie};Ni||(i=1);let n=Array.isArray(e)?e:[],a={},s=(o,l=0)=>{Object.keys(o).forEach(u=>{pa(o[u])?a[u]=o[u]:bt(o[u])&&(e===!0||n?.includes(u))&&(i===void 0||l<i)&&s(o[u],l+1)})};return s(t),r?C4(a):M4(a),{methods:a}}function ave(t,e,i){return Object.keys(t).filter(r=>!e.includes(t[r])&&(!i||(Array.isArray(t[r])?t[r].length:!0)))}function Ve(t,e,i,r){if(typeof t!="object"||t===null)return t;sF()?.enabled||(r=!0);let n=["",void 0,null];e&&n.push(!1);let a=ave(t,n,i);return Object.assign({},...a.map(s=>Array.isArray(t[s])?{[s]:r?t[s]:t[s].map(o=>Ve(o))}:{[s]:r?t[s]:Ve(t[s])}))}function z({context:t,result:e,stack:i,info:r}){return e&&!Array.isArray(e?.stack)&&(e.stack=[]),e&&Array.isArray(e?.stack)&&typeof i=="string"&&e.stack.push(i),e&&r&&(e.info=r),e&&typeof t=="object"&&Object.keys(t).length&&(e.context||(e.context={}),Object.assign(e.context,Ve(t))),e&&!e?.error&&!e?.success&&Object.assign(e,{...H}),e??{success:!0}}var Hr="FEMALE",ju="OTHER",sh="MIXED",er="MALE",rR={FEMALE_ABBR:"F",OTHER_ABBR:"O",MIXED_ABBR:"X",MALE_ABBR:"M",ANY_ABBR:"A",FEMALE:Hr,MIXED:sh,OTHER:ju,MALE:er,ANY:"ANY"};function op(t){return[Hr,"F"].includes(t)}function zf(t){return[er,"M"].includes(t)}function Na(t){return[sh,"X"].includes(t)}function eu(t){return["ANY","A"].includes(t)}function on(t){if(t){if(op(t))return Hr;if(Na(t))return sh;if(zf(t))return er;if(eu(t))return"ANY"}return ju}function il(t){return op(t)||zf(t)}var sve="MIXED events can not contain mixed singles or { gender: ANY } collections",ove="events with { gender: ANY } can not contain MIXED singles collections";function nR(t){let e="tieFormatGenderValidityCheck",{referenceGender:i,matchUpType:r,gender:n}=t;return i&&n&&il(i)&&on(i)!==on(n)?z({result:{valid:!1,error:xy},context:{gender:n},stack:e}):Na(i)&&(eu(n)||Na(n)&&r!==$t)?z({result:{error:xy,valid:!1},info:sve,stack:e}):eu(i)&&Na(n)&&r!==$t?z({result:{error:xy,valid:!1},info:ove,stack:e}):{valid:!0}}var lve="normal",NH="timed",uve="final",cF="NOAD",L4=["SET","HAL","QTR","PER","INN","RND","FRM","MAP","MAT"],_4="CONSECUTIVE",$4="TRADITIONAL",cve={S:lve,F:uve,G:"game"};function aR(t,e){if(bt(t)&&(t?.bestOf||t?.exactly)&&t?.setFormat)return pve(t,e)}function fb(t){return!Number.isNaN(Number(t))&&Number(t)}function B4(t){let e=`T${t.minutes}`;return t.based==="P"&&(e+="P"),t.tiebreakFormat?.tiebreakTo&&(e+=`/TB${t.tiebreakFormat.tiebreakTo}`),t.modifier&&(e+=`@${t.modifier}`),e}function dve(t){let e=t?.deuceAfter?`${t.deuceAfter}D`:"";if(t?.type===$4)return`TN${e}`;if(t?.type===_4&&Number.isInteger(t.count))return`${t.count}C${e}`}function pve(t,e){let i=fb(t.bestOf)||void 0,r=fb(t.exactly)||void 0,n=i||r;if(t.setFormat?.timed&&t.simplified&&n===1)return B4(t.setFormat);let a=t.matchRoot||"SET",s=r&&r!==1?"X":"",o=t.aggregate?"A":"",l=n&&`${a}${n}${s}${o}`||"",u=AH(t.setFormat,e),c=u&&`S:${u}`||"",d=AH(t.finalSetFormat,e),p=n&&n>1&&d&&u!==d&&`F:${d}`||"",f=t.gameFormat?`G:${dve(t.gameFormat)}`:"";if(l&&u)return[l,c,f,p].filter(Boolean).join("-")}function AH(t,e){if(typeof t=="object"&&Object.keys(t).length){if(t.timed)return B4(t);if(t.tiebreakSet)return kH(t.tiebreakSet);let i=fb(t.setTo);if(i){let r=t.NoAD&&cF||"",n=kH(t.tiebreakFormat),a=n&&`/${n}`||"",s=fb(t.tiebreakAt),o=s&&(s!==i||e)&&`@${s}`||"";if(n!==!1)return`${i}${r}${a}${o}`}}}function kH(t){if(t){if(typeof t=="object"&&!t.tiebreakTo)return"";if(typeof t=="object"&&fb(t.tiebreakTo)){let e=`TB${t.tiebreakTo}${t.NoAD?cF:""}`;return t.modifier&&(e+=`@${t.modifier}`),e}else return!1}}function zi(t){if(ri(t)){let e=t.startsWith("T")&&NH||L4.some(i=>t.startsWith(i))&&"SET"||"";if(e===NH){let i=G4(t),r={simplified:!0,setFormat:i,bestOf:1};if(i)return r}if(e==="SET")return hve(t)}}function fve(t){let e=L4.find(u=>t.startsWith(u));if(!e)return;let i=t.slice(e.length),r=/^(\d+)([A-Z]*)$/.exec(i);if(!r)return;let n=Jg(r[1]);if(!n)return;let a=r[2],s=!1,o=!1,l=[];for(let u of a)u==="X"?s=!0:u==="A"?o=!0:l.push(u);return{matchRoot:e,count:n,exactly:s,aggregate:o,matchMods:l}}function mve(t){let e=/^(.+?)(\d+D)$/.exec(t),i=e?e[1]:t,r=e?Number(e[2].slice(0,-1)):void 0;if(r!==void 0&&(r<1||!Number.isInteger(r)))return;if(i==="TN"){let a={type:$4};return r&&(a.deuceAfter=r),a}let n=/^([1-9]\d*)C$/.exec(i);if(n){let a={type:_4,count:Number(n[1])};return r&&(a.deuceAfter=r),a}}function hve(t){let e=t.split("-"),i=fve(e[0]);if(!i)return;let{matchRoot:r,count:n,exactly:a,aggregate:s,matchMods:o}=i,l=a&&n!==1?void 0:n,u=a&&n!==1?n:void 0,c,d,p,f=0,m=0,h=0;for(let v=1;v<e.length;v++){let w=e[v].indexOf(":");if(w<0)return;let y=e[v].slice(0,w),b=e[v].slice(w+1);if(!(y in cve))return;if(y==="S"){if(f++,f>1)return;c=OH(e[v],b)}else if(y==="F"){if(m++,m>1)return;d=OH(e[v],b)}else if(y==="G"&&(h++,h>1||(p=mve(b),!p)))return}let g=c&&c.timed||d&&d.timed;if(r==="SET"&&!(l&&l<6||g&&u)||!c||!(!d||d))return;let I=Ve({setFormat:c,exactly:u,bestOf:l});return r!=="SET"&&(I.matchRoot=r),s&&(I.aggregate=!0),o.length>0&&(I.matchMods=o),d&&(I.finalSetFormat=d),p&&(I.gameFormat=p),I}function OH(t,e){return e.startsWith("TB")?gve(e):e.startsWith("T")?G4(e):Ive(t,e)}function gve(t){let e=j4(t);return e===!1?!1:typeof e=="object"?{tiebreakSet:e}:void 0}function Ive(t,e){let i=/^[FS]:(\d+)([A-Za-z]*)/.exec(t),r=i&&H4(i[2])||!1,n=!i?.[2]||r,a=i?Jg(i[1]):void 0,s=V4(e),o=s!==!1,l=o&&s||a,u=j4(e.split("/")[1]);return!a||!n||u===!1||!o?!1:vve(a,r,u,l)}function vve(t,e,i,r){let n={setTo:t};return e&&(n.NoAD=!0),i?(n.tiebreakFormat=i,n.tiebreakAt=r):n.noTiebreak=!0,n}function V4(t,e=!0){let i=t?.indexOf("@")>0&&t.split("@");if(i)return(e?Jg(i[1]):i[1])||!1}function j4(t){if(t)return t.startsWith("TB")?yve(t):!1}function yve(t){let e=V4(t,!1),i=/^TB(\d+)([A-Za-z]*)/.exec(t),r=i?.[1],n=i&&H4(i[2]),a=!i?.[2]||n,s=Jg(r);if(!s||!a)return!1;let o={tiebreakTo:s};return e&&typeof e=="string"&&!ot(e)&&(o.modifier=e),n&&(o.NoAD=!0),o}function G4(t){let e=t.slice(1),i=/^(\d+)([PG])?(?:\/TB(\d+))?(@[A-Za-z]+)?$/.exec(e),r=Jg(i?.[1]);if(!r)return;let n={timed:!0,minutes:r},a=i?.[2];a==="P"?n.based="P":a==="G"&&(n.based="G");let s=i?.[3];if(s){let u=Jg(s);u&&(n.tiebreakFormat={tiebreakTo:u})}let o=i?.[4],l=[void 0,"P","G",""].includes(o);if(o&&!l){let u=/^(\d+)([PGA])?(?:\/TB\d+)?(@)([A-Za-z]+)$/.exec(e)?.[4];return u?(n.modifier=u,n):void 0}return o&&(n.based=o),n}function H4(t){return t?.includes(cF)}function Jg(t){let e=Number(t);return Number.isNaN(e)?0:e}function bve(t){return t.replaceAll(/T(\d+)G(?=\/TB|@|-|$)/g,"T$1")}function xa({matchUpFormat:t}){if(!ri(t)||t==="")return!1;let e=zi(t),i=/-S:(\d+)\/TB(\d{1,2})@?(\d?)/.exec(t),r=i?.[1],n=i?.[2],a=i?.[3],s=/-F:(\d+)\/TB(\d{1,2})@?(\d?)/.exec(t),o=s?.[1],l=s?.[2],u=s?.[3];return aR(e,!!(i&&n&&r===a||s&&l&&o===u))===bve(t)}var BD=/^\d{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2]\d|3[0-1])$/,W4=/^((0\d|1\d|2[0-3]):[0-5]\d(:[0-5]\d)?)([.,]\d{3})?$/,rl=/^(\d{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2]\d|3[0-1]))([ T](0\d|1\d|2[0-3]):[0-5]\d(:[0-5]\d)?)?([.,]\d{3})?Z?$/,lp=/^(\d{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2]\d|3[0-1]))?([ T]?(0\d|1\d|2[0-3]):[0-5]\d(:[0-5]\d)?)?([.,]\d{3})?Z?$/;function VD(t){let{scheduledDate:e}=t;if(!e&&t.scheduledTime&&(e=Qe(t.scheduledTime)),!e)return;let i=ci(t.scheduledTime),r=Qe(e);return r&&i&&(r+=`T${i}`),r}function wve(t){return typeof t!="object"||Array.isArray(t)?!1:Object.prototype.toString.call(t)==="[object Date]"}function iv(t){let e=typeof t=="string"?t?.split(" "):[];if(t&&e?.length>1&&!["AM","PM"].includes(e[1].toUpperCase()))return!1;let i=oh(t,!0,!0);return!!(!t||i&&lp.test(i))}function Pn(t){return sc(t)||BD.test(t)}function Sve(t){let e=new Date(t),i=e.getSeconds()+60*e.getMinutes()+3600*e.getHours();return Uve(i,{displaySeconds:!1})}function Uve(t,e){let i=Number.parseInt(t,10),r=Math.floor(i/3600),n=Math.floor((i-r*3600)/60),a=i-r*3600-n*60;return(!e||e?.displaySeconds?r+":"+n+":"+a:r+":"+n).split(":").map(rs).join(":")}var dF=t=>{let e=mb(t)||sc(t)?new Date(t):new Date,i=e.getUTCMonth()+1,r=i<10?`0${i}`:`${i}`;return`${e.getUTCFullYear()}-${rs(r)}-${rs(e.getUTCDate())}`};function Tve(t){let e=mb(t)||sc(t)?new Date(t):new Date;return Date.UTC(e.getFullYear(),e.getMonth(),e.getDate())}function Os(t,e="-",i="YMD"){if(!t)return"";typeof t=="string"&&!t.includes("T")&&(t=t+"T00:00");let r=new Date(t),n=""+(r.getMonth()+1),a=""+r.getDate(),s=r.getFullYear();return n.length<2&&(n="0"+n),a.length<2&&(a="0"+a),i==="DMY"?[a,n,s].join(e):i==="MDY"?[n,a,s].join(e):i==="YDM"?[s,a,n].join(e):i==="DYM"?[a,s,n].join(e):i==="MYD"?[n,s,a].join(e):[s,n,a].join(e)}function jD(t){let e=t?new Date(t):new Date,i=e.getTimezoneOffset();return new Date(e.getTime()-i*60*1e3)}function Dve(t){return jD(t).getTime()}function mb(t){if(typeof t=="boolean")return!1;let e=t instanceof Date&&t||!Number.isNaN(Number(t))&&new Date(t)||!1;return e&&!Number.isNaN(Number(e.valueOf()))}function Pve(t,e){return t<=e}function Qg(t,e){if(!Pn(t)||!Pn(e))return[];let i=Qe(t)+"T00:00",r=Qe(e)+"T00:00",n=new Date(i),a=new Date(r),s=mb(a)&&mb(n)&&Pve(n,a),o=[],l=0;if(s){let u=n,c=u.getTime();for(;c<=a.getTime()&&l<300;)l+=1,o.push(new Date(u)),c=u.setDate(u.getDate()+1)}return o.map(u=>Os(u))}var Eve=/^([+-]?\d{4}(?!\d{2}\b))((-?)((0[1-9]|1[0-2])(\3([12]\d|0[1-9]|3[01]))?|W([0-4]\d|5[0-2])(-?[1-7])?|(00[1-9]|0[1-9]\d|[12]\d{2}|3([0-5]\d|6[1-6])))([T\s]((([01]\d|2[0-3])((:?)[0-5]\d)?|24:?00)([.,]\d+(?!:))?)?(\17[0-5]\d([.,]\d+)?)?([zZ]|([+-])([01]\d|2[0-3]):?([0-5]\d)?)?)?)?$/;function sc(t){return typeof t!="string"?!1:Eve.test(t)}function id(t){return typeof t!="string"||!sc(t)?!1:/([zZ]|[+-]\d{2}:?\d{2})$/.test(t)}function pF(t){if(typeof t!="string")return!1;let e=t.split("Z")[0].split(":"),i=e.every(r=>!Number.isNaN(Number.parseInt(r)));return!(e.length<2||!i||Number.parseInt(e[0])>23||Number.parseInt(e[1])>60)}function Pt(t){let e=ci(t);if(!e)return 0;let[i,r]=e.split(":").map(n=>Number.parseInt(n));return i*60+r}function Rve(t){let e=Math.floor(t/60),i=t-e*60;return e>23&&(e=e%24),[rs(e),rs(i)].join(":")}function GD(t){return pF(t)?t.split(":").slice(0,2).map(rs).join(":"):void 0}function ci(t){return sc(t)&&t.indexOf("T")>0?GD(t.split("T").reverse()[0]):GD(t)}function Qe(t){return sc(t)||rl.test(t)?t.split("T")[0]:""}function wy(t,e){let i=new Date(t);return i.setDate(i.getDate()+e),Qe(i.toISOString())}function HD(t){t=typeof t=="string"?t:"00:00";let e={},i={};return{0:e.time,1:e.ampm}=t.split(" ")||[],{0:i.hours,1:i.minutes}=e.time.split(":")||[],i.ampm=e.ampm,Number.isNaN(Number.parseInt(i.hours))||Number.isNaN(Number.parseInt(i.minutes))||i.ampm&&!["AM","PM"].includes(i.ampm.toUpperCase())?{}:i}function Cve(t){let e=HD(t);return e.ampm&&e.hours&&(e.ampm.toLowerCase()==="pm"&&Number.parseInt(e.hours)<12&&(e.hours=(e.hours&&Number.parseInt(e.hours)||0)+12),e.ampm.toLowerCase()==="am"&&e.hours==="12"&&(e.hours="00")),`${e.hours||"12"}:${e.minutes||"00"}`.split(":").map(rs).join(":")}function Mve(t){let e=HD(t);if(!(typeof e=="object"&&!Object.keys(e).length))return e.ampm?t:(e.hours>12?(e.hours-=12,e.ampm="PM"):e.hours==="12"?e.ampm="PM":(e.hours==="00"&&(e.hours="12"),e.ampm="AM"),e.hours?.[0]==="0"&&(e.hours=e.hours.slice(1)),`${e.hours||"12"}:${e.minutes||"00"} ${e.ampm}`)}function oh(t,e,i){let r=Qe(t),n=ci(t),a=r?n:t;return t?e&&(r&&i&&t||Cve(a))||Mve(a):void 0}function z4(t,e){let i=HD(t),r=HD(e);if(Number.parseInt(i.hours)<Number.parseInt(r.hours))return-1;if(Number.parseInt(i.hours)>Number.parseInt(r.hours))return 1;if(i.hours===r.hours){if(Number.parseInt(i.minutes)<Number.parseInt(r.minutes))return-1;if(Number.parseInt(i.minutes)>Number.parseInt(r.minutes))return 1}return 0}function fF(t,e=7){let i=Qe(t)+"T00:00",r=new Date(i),n=new Date(r.setDate(r.getDate()+e));return Os(n)}function Nve(t){return fF(t)}function Ave(t,e,i,r=!1){let n=new Date(e,0,1+(t-1)*7),a=r?0:1;return n.setDate(n.getDate()+(a-n.getDay())),Os(n,i)}function kve(t,e,i){let r=new Date(t,0);return Os(new Date(r.setDate(e)),i)}function Xi(t,e=void 0){let[i,r]=(t||"00:00").split(":").map(rs),n=jD(e).setHours(i,r,0,0);return jD(n)}function xw(t,e,i=!0){let r=new Date(t),n=(new Date(e).getTime()-r.getTime())/1e3/60;return i?Math.abs(Math.round(n)):Math.round(n)}function Jn(t,e){let i=ci(t);if(!i)return"00:00";let r=Number.isNaN(e)?0:e;return ci(mF(Xi(i),r).toISOString())||"00:00"}function mF(t,e){let i=new Date(t);return new Date(i.getTime()+e*6e4)}function rs(t){return t.toString()[1]?t:"0"+t}function tu(t,e){let i=new Date(t),r=new Date(e);return i.getFullYear()===r.getFullYear()&&i.getMonth()===r.getMonth()&&i.getDate()===r.getDate()}var q4={addDays:fF,addWeek:Nve,addMinutesToTimeString:Jn,convertTime:oh,getIsoDateString:VD,getUTCdateString:dF,DateHHMM:Sve,extractDate:Qe,extractTime:ci,formatDate:Os,getDateByWeek:Ave,isISODateString:sc,isValidEmbargoDate:id,isDate:mb,isTimeString:pF,offsetDate:jD,offsetTime:Dve,sameDay:tu,timeStringMinutes:Pt,timeToDate:Xi,timeUTC:Tve,validTimeValue:iv,validDateString:BD,timeValidation:lp,dateValidation:rl},Ove=(t,e)=>t.filter(Boolean).every(i=>typeof i===e),xve=t=>t.filter(Boolean).every(Ni);function ag(t,e){return`${t}-${e}`}function Tp(t){let e=t.category;if(typeof e!="object"||!e)return{error:ub};let{ageCategoryCode:i,ageMaxDate:r,ageMinDate:n,ageMax:a,ageMin:s}=e,o=e.categoryName,l;if(!(Ove([i,r,n,o],"string")&&xve([a,s])&&[r,n].filter(Boolean).every(Pn)))return{error:ub};let u=t.consideredDate??Qe(new Date().toLocaleDateString("sv"));if(!u||!Pn(u))return{error:sr};let[c]=u.split("-").slice(0,3).map(L=>Number.parseInt(L)),d=wy(u,-1);if(!d)return{error:sr};let[p,f]=d.split("-").slice(1,3).map(L=>Number.parseInt(L)),m=`${rs(p)}-${rs(f)}`,h=wy(u,1);if(!h)return{error:sr};let[g,I]=h.split("-").slice(1,3).map(L=>Number.parseInt(L)),v=`${rs(g)}-${rs(I)}`,w=s&&wy(u,-1*365*s),y=a&&wy(u,-1*365*a),b=[],S=L=>!b.includes(L)&&b.push(L);i=i??o;let U=/^([UO]?)(\d{1,2})([UO]?)$/,T=/^C(\d{1,2})-(\d{1,2})$/,P=i?.includes("-"),D=P&&i?.match(T),E=i?.match(U);function R(L){let $=c-L,V=ag($,v);e.ageMinDate&&e.ageMinDate!==V&&S(`Invalid submitted ageMinDate: ${n}`),n=V,i&&(e.ageMax&&e.ageMax!==L-1&&(S(`Invalid submitted ageMax: ${a}`),y=void 0),a=L-1)}function C(L){let $=c-L-1,V=ag($,v);e.ageMin&&e.ageMin>L&&S(`Invalid submitted ageMin: ${s}`),e.ageMax&&e.ageMax>L&&S(`Invalid submitted ageMax: ${a}`),e.ageMinDate&&e.ageMinDate!==V&&S(`Invalid submitted ageMinDate: ${n}`),n=V,i&&(e.ageMax&&e.ageMax!==L&&(S(`Invalid submitted ageMax: ${a}`),w=void 0),a=L)}function M(L){let $=c-L,V=ag($,m);e.ageMaxDate&&e.ageMaxDate!==V&&S(`Invalid submitted ageMaxDate: ${r}`),r=V,i&&(e.ageMin&&e.ageMin!==L+1&&(S(`Invalid submitted ageMin: ${s}`),w=void 0),s=L+1)}function N(L){let $=c-L-1,V=ag($,m);e.ageMaxDate&&e.ageMaxDate!==V&&S(`Invalid submitted ageMaxDate: ${r}`),r=V,i&&(e.ageMin&&e.ageMin!==L&&(S(`Invalid submitted ageMin: ${s}`),w=void 0),s=L)}function A(L){let $=U.exec(L)||[],[V,_,B]=$.slice(1),G=Number.parseInt(_);V==="U"?(e.ageMaxDate&&e.ageMaxDate!==r&&S(`Invalid submitted ageMaxDate: ${e.ageMaxDate}`),R(G)):V==="O"&&M(G),B==="U"?(e.ageMaxDate&&e.ageMaxDate!==r&&S(`Invalid submitted ageMaxDate: ${e.ageMaxDate}`),C(G)):B==="O"&&N(G),r=(r??w)||void 0,n=(n??y)||void 0}function O(){if(r=void 0,n=void 0,a=void 0,s=void 0,e.ageMin){let V=c-e.ageMin;r=ag(V,m)}if(e.ageMax){let V=c-e.ageMax-1;n=ag(V,v)}let[L,$]=(i?.match(T)??[]).slice(1).map(V=>Number.parseInt(V));L<=$?(s=L,a=$,l=!0):S(`Invalid combined age range ${i}`)}function k(){s&&M(s),a&&C(a)}function F(){D?O():P?i?.split("-").forEach(A):E&&i?A(i):k()}F(),a&&e?.ageMin&&e?.ageMin>a&&(S(`Invalid submitted ageMin: ${e?.ageMin}`),s=void 0);let x=Ve({consideredDate:u,combinedAge:l,ageMaxDate:r,ageMinDate:n,ageMax:a,ageMin:s});return b.length&&(x.errors=b),x}function hb({category:t}){if(!bt(t))return{error:ie};let e=Tp({category:t});if(e.error)return{error:e};let{ratingMax:i,ratingMin:r}=t;return i&&!Ni(i)?z({result:{error:ie},context:{ratingMax:i}}):r&&!Ni(r)?z({result:{error:ie},context:{ratingMin:r}}):{...e}}function Fw({childCategory:t,withDetails:e,category:i}){let r=hb({category:i}),n=hb({category:t}),a=n.ageMin&&(r.ageMin&&n.ageMin<r.ageMin||r.ageMax&&n.ageMin>r.ageMax),s=n.ageMax&&(r.ageMax&&n.ageMax>r.ageMax||r.ageMin&&n.ageMax<r.ageMin),o=n.ageMinDate&&r.ageMaxDate&&new Date(n.ageMinDate)>new Date(r.ageMaxDate),l=n.ageMaxDate&&r.ageMinDate&&new Date(n.ageMaxDate)<new Date(r.ageMinDate),u=i?.ratingType&&t?.ratingType&&i.ratingType===t.ratingType&&(i.ratingMin&&t.ratingMin&&t.ratingMin<i.ratingMin||i.ratingMax&&t.ratingMax&&t.ratingMax>i.ratingMax||i.ratingMin&&t.ratingMax&&t.ratingMax<i.ratingMin||i.ratingMax&&t.ratingMin&&t.ratingMin>i.ratingMax),c=i?.ballType&&t?.ballType&&i.ballType!==t.ballType,d=Ve({invalidRatingRange:u,invalidAgeMinDate:o,invalidAgeMaxDate:l,invalidBallType:c,invalidAgeMax:s,invalidAgeMin:a,valid:!u&&!o&&!l&&!c&&!s&&!a},!0);return e&&Object.assign(d,{categoryDetails:r,childCategoryDetails:n}),d}function Lw({checkCategory:t=!0,collectionDefinition:e,checkCollectionIds:i,checkGender:r=!0,referenceCategory:n,referenceGender:a,event:s}){a=a??s?.gender;let o="validateCollectionDefinition",l=[];if(typeof e!="object")return l.push(`collectionDefinition must be an object: ${e}`),z({result:{errors:l,error:Ac},stack:o});let{collectionValueProfiles:u,collectionGroupNumber:c,collectionValue:d,collectionId:p,matchUpCount:f,matchUpFormat:m,matchUpValue:h,matchUpType:g,scoreValue:I,setValue:v,category:w,gender:y}=e;if(i&&typeof p!="string"&&l.push(`collectionId is not type string: ${p}`),typeof f!="number"&&l.push(`matchUpCount is not type number: ${f}`),g&&!em([Wt,$t],g)&&l.push(`matchUpType must be SINGLES or DOUBLES: ${g}`),[!!u?.length].concat([h,d,I,v].map(ot)).filter(Boolean).length!==1&&l.push("Missing value definition for matchUps: matchUpValue, collectionValue, or collectionValueProfiles"),h&&typeof h!="number"&&l.push(`matchUpValue is not type number: ${h}`),d&&typeof d!="number"&&l.push(`collectionValue is not type number: ${d}`),u&&f){let b=c6({collectionValueProfiles:u,matchUpCount:f});b.errors&&l.push(...b.errors)}if(c&&typeof c!="number"&&l.push(`collectionGroupNumber is not type number: ${d}`),m&&!xa({matchUpFormat:m})&&l.push(`Invalid matchUpFormat: ${m}`),r){let b=nR({referenceGender:a,matchUpType:g,gender:y});if(b.error)return z({context:{referenceGender:a,gender:y},result:b,stack:o})}if(t&&n&&w){let b=Fw({category:n,childCategory:w});if(!b.valid)return z({result:{error:ub},context:b,stack:o})}return l.length?z({result:{errors:l,error:v4},stack:o}):{valid:!0}}function Bn(t){let e=!!(t?.enforceCategory!==!1&&t?.category),i=!!(t?.enforceGender!==!1&&t?.gender),r=t?.checkCollectionIds,n=t?.tieFormat,a=t?.event,s="validateTieFormat",o=[],l=Fve({...t,stack:s});if(l?.error)return l;let u,c=n.collectionDefinitions.every(g=>{let{setValue:I,scoreValue:v,collectionValue:w}=g;(I||v)&&!w&&(u=!0);let{valid:y,errors:b}=Lw({referenceCategory:t.category,referenceGender:t.gender,collectionDefinition:g,checkCollectionIds:r,checkCategory:e,checkGender:i,event:a});return y?!0:(Array.isArray(b)&&o.push(...b),!1)}),d=typeof n.winCriteria?.valueGoal=="number"&&n.winCriteria?.valueGoal>0&&!u||n.winCriteria?.aggregateValue;if(!(d||n.winCriteria?.aggregateValue))return u?o.push("aggregateValue is required"):o.push("Either non-zero valueGoal, or { aggregateValue: true } must be specified in winCriteria"),z({context:{tieFormat:n,errors:o,aggregateValueImperative:u},result:{error:Vl},stack:s});let p=n.collectionDefinitions.map(({collectionId:g})=>g),f=!r||p.length===rt(p).length,m=c&&d&&f;return m?{valid:m,errors:o}:z({result:{error:Vl},context:{tieFormat:n,errors:o},stack:s})}function Fve(t){let{tieFormat:e,stack:i}=t;return!t||!e||!bt(e)?z({result:{error:Vl},context:{tieFormat:e,message:"tieformat must be an object"},stack:i}):bt(e.winCriteria)?Array.isArray(e.collectionDefinitions)?{...H}:z({result:{error:Vl},context:{tieFormat:e,message:"collectionDefinitions must be an array"},stack:i}):z({result:{error:Vl},context:{tieFormat:e,message:"tieformat.winCritiera must be an object"},stack:i})}var WD="resourceSubType",zD="resourceType",Zg="identifier",aO="name",Lve={RESOURCE_SUB_TYPE:WD,RESOURCE_TYPE:zD,IDENTIFIER:Zg,NAME:aO};function ke(t,e,i,r,n=0){if(nO().makeDeepCopy)return nO().makeDeepCopy(t,e,i,r);let a=sF(),{stringify:s,toJSON:o,ignore:l,modulate:u}=a||{};if(!a?.enabled&&!i||typeof t!="object"||pa(t)||t===null||typeof a?.threshold=="number"&&n>=a.threshold)return t;let c=Array.isArray(t)?[]:{},d=Object.keys(t).filter(f=>!i||!l||Array.isArray(l)&&!l.includes(f)||pa(l)&&!l(f)),p=(f,m)=>{c[f]=pa(m?.toString)?m.toString():JSON.stringify(m)};for(let f of d){let m=t[f],h=pa(u)?u(m):void 0;if(h!==void 0)c[f]=h;else if(e&&f==="extensions"&&Array.isArray(m)){let g=hF(m);Object.assign(c,...g)}else r&&f==="extensions"?c[f]=[]:Array.isArray(s)&&s.includes(f)?p(f,m):Array.isArray(o)&&o.includes(f)&&pa(m?.toJSON)?c[f]=m.toJSON():m===null?c[f]=void 0:wve(m)?c[f]=new Date(m).toISOString():c[f]=ke(m,e,i,r,n+1)}return c}function hF(t){return t?.map(e=>{let{name:i,value:r}=e;return i&&r&&{[`_${i}`]:r}}).filter(Boolean)}function Y4(t=1,e){return Re(0,t).map(()=>Et(e))}function Et(t){let e=[];for(let o=0;o<256;o++)e[o]=(o<16?"0":"")+o.toString(16);let i=Math.trunc(Math.random()*4294967295),r=Math.trunc(Math.random()*4294967295),n=Math.trunc(Math.random()*4294967295),a=Math.trunc(Math.random()*4294967295),s=e[i&255]+e[i>>8&255]+e[i>>16&255]+e[i>>24&255]+"-"+e[r&255]+e[r>>8&255]+"-"+e[r>>16&15|64]+e[r>>24&255]+"-"+e[n&63|128]+e[n>>8&255]+"-"+e[n>>16&255]+e[n>>24&255]+e[a&255]+e[a>>8&255]+e[a>>16&255]+e[a>>24&255];return typeof t=="string"?`${t}_${s.replaceAll("-","")}`:s}var K4={collectionDefinitions:[{collectionName:"Male Singles",matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpCount:4,matchUpValue:1,gender:"MALE"},{collectionName:"Female Singles",matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:4,matchUpValue:1},{collectionName:"Male Doubles",matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpCount:2,matchUpValue:1,gender:"MALE"},{collectionName:"Female Doubles",matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:2,matchUpValue:1},{collectionName:"Mixed Doubles",matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpCount:4,matchUpValue:1,gender:"MIXED"}],tieFormatName:"USTA_GOLD_TEAM_CHALLENGE",winCriteria:{valueGoal:9}},X4={collectionDefinitions:[{collectionName:"Round 1",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Round 2",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Round 3",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"Doubles Shuffle",unrestrictedSelections:!0,winCriteria:{aggregateValue:!0}},J4={collectionDefinitions:[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_SOUTHERN_LEVEL_5",winCriteria:{valueGoal:8}},Q4={collectionDefinitions:[{category:{ageCategoryCode:"16U"},collectionName:"16U Singles",matchUpCount:4,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Singles",matchUpCount:4,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Doubles",matchUpCount:2,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Doubles",matchUpCount:2,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Tiebreak Doubles",matchUpCount:1,matchUpFormat:"SET1-S:TB10",matchUpType:"DOUBLES",matchUpValue:1,processCodes:["RANKING.IGNORE"]}],tieFormatName:"USTA_SECTION_BATTLE",winCriteria:{valueGoal:9}},Z4={collectionDefinitions:[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_INTERSECTIONAL",winCriteria:{valueGoal:8}},e5={collectionDefinitions:[{scoreValue:1,matchUpType:"SINGLES",collectionName:"Men's Singles",matchUpFormat:"SET1-S:T60",gender:"MALE",matchUpCount:1},{scoreValue:1,matchUpType:"SINGLES",collectionName:"Women's Singles",matchUpFormat:"SET1-S:T60",gender:"FEMALE",matchUpCount:1},{matchUpValue:1,matchUpType:"DOUBLES",collectionName:"Mixed Doubles",matchUpFormat:"SET1-S:T60",gender:"MIXED",matchUpCount:1}],tieFormatName:"Time Tennis Pro Circuit",winCriteria:{aggregateValue:!0}},t5={collectionDefinitions:[{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"DOMINANT_DUO_MIXED",winCriteria:{valueGoal:2}},i5={collectionDefinitions:[{scoreValue:1,matchUpType:"SINGLES",collectionName:"Men's Singles",matchUpFormat:"SET1-S:T60",gender:"MALE",matchUpCount:3},{scoreValue:1,matchUpType:"SINGLES",collectionName:"Women's Singles",matchUpFormat:"SET1-S:T60",gender:"FEMALE",matchUpCount:3},{scoreValue:1,matchUpType:"DOUBLES",collectionName:"Men's Doubles",matchUpFormat:"SET1-S:T60",gender:"MALE",matchUpCount:1},{matchUpValue:1,matchUpType:"DOUBLES",collectionName:"Women's Doubles",matchUpFormat:"SET1-S:T60",gender:"FEMALE",matchUpCount:1},{matchUpValue:1,matchUpType:"DOUBLES",collectionName:"Mixed Doubles",matchUpFormat:"SET1-S:T60",gender:"MIXED",matchUpCount:1}],tieFormatName:"Time Tennis Dual",winCriteria:{aggregateValue:!0}},r5={collectionDefinitions:[{category:{ageCategoryCode:"14U"},collectionName:"14U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],collectionGroups:[{groupNumber:1,groupName:"Doubles",groupValue:1,winCriteria:{valueGoal:2}}],tieFormatName:"USTA_BREWER_CUP",winCriteria:{valueGoal:4}},n5={winCriteria:{valueGoal:23},tieFormatName:"USTA_OZAKI_CUP",collectionDefinitions:[{category:{ageCategoryCode:"18U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"18U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"18U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"18U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"18U"},collectionName:"18U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"16U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"16U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"16U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"16U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"16U"},collectionName:"16U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"14U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"14U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"14U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"14U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"14U"},collectionName:"14U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"12U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"12U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"12U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"12U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"12U"},collectionName:"12U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"12U"},collectionName:"12U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"12U"},collectionName:"12U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1}]},Ju="SET3-S:6/TB7",_ve="SET3-S:6/TB7-F:TB10",a5={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"DOMINANT_DUO",winCriteria:{valueGoal:2}},s5={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",collectionValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"USTA_COLLEGE",winCriteria:{valueGoal:4}},o5={collectionDefinitions:[{collectionName:"Male Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_LEVEL_1",winCriteria:{valueGoal:10}},l5={collectionDefinitions:[{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Overtime",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"USTA_WTT_ITT",winCriteria:{aggregateValue:!0}},u5={collectionDefinitions:[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_ZONAL",winCriteria:{valueGoal:10}},c5={collectionDefinitions:[{collectionGroupNumber:1,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:1},{collectionGroupNumber:1,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:1},{collectionGroupNumber:2,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:2},{collectionGroupNumber:2,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:2},{collectionGroupNumber:3,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:3},{collectionGroupNumber:3,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:3}],collectionGroups:[{groupNumber:1,groupName:"Day 1"},{groupNumber:2,groupName:"Day 2"},{groupNumber:3,groupName:"Day 3"}],tieFormatName:"LAVER_CUP",winCriteria:{valueGoal:13}},d5={collectionDefinitions:[{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Overtime",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"USTA_TOC",winCriteria:{aggregateValue:!0}},qD="COLLEGE_DEFAULT",sO="COLLEGE_JUCO",oO="COLLEGE_D3",p5="DOMINANT_DUO",f5="DOMINANT_DUO_MIXED",m5="LAVER_CUP",h5="TEAM_DOUBLES_3_AGGREGATION",g5="TIME_TENNIS_DUAL",I5="TIME_TENNIS_PRO_CIRCUIT",v5="USTA_BREWER_CUP",y5="USTA_OZAKI_CUP",b5="USTA_COLLEGE",w5="USTA_GOLD_TEAM_CHALLENGE",S5="USTA_LEVEL_1",U5="USTA_INTERSECTIONAL",T5="USTA_SECTION_BATTLE",D5="USTA_SOUTHERN_LEVEL_5",P5="USTA_TOC",E5="USTA_WTT_ITT",R5="USTA_ZONAL",$ve={COLLEGE_D3:oO,COLLEGE_DEFAULT:qD,COLLEGE_JUCO:sO,DOMINANT_DUO:p5,DOMINANT_DUO_MIXED:f5,LAVER_CUP:m5,TEAM_DOUBLES_3_AGGREGATION:h5,TIME_TENNIS_DUAL:g5,TIME_TENNIS_PRO_CIRCUIT:I5,USTA_BREWER_CUP:v5,USTA_OZAKI_CUP:y5,USTA_COLLEGE:b5,USTA_GOLD_TEAM_CHALLENGE:w5,USTA_INTERSECTIONAL:U5,USTA_LEVEL_1:S5,USTA_SECTION_BATTLE:T5,USTA_SOUTHERN_LEVEL_5:D5,USTA_TOC:P5,USTA_WTT_ITT:E5,USTA_ZONAL:R5},C5="STANDARD",xH={[C5]:{hydrate:!0,doubles:{matchUpCount:3,matchUpValue:1},singles:{matchUpCount:6,matchUpValue:1},valueGoal:5},[oO]:{hydrate:!0,doubles:{matchUpFormat:"SET1-S:8/TB7@7",matchUpCount:3,matchUpValue:1},singles:{matchUpFormat:Ju,matchUpCount:6,matchUpValue:1},tieFormatName:oO,valueGoal:5},[qD]:{hydrate:!0,doubles:{matchUpFormat:"SET1-S:6/TB7",collectionValue:1,matchUpCount:3},singles:{matchUpFormat:Ju,matchUpCount:6,matchUpValue:1},tieFormatName:qD,valueGoal:4},[sO]:{hydrate:!0,doubles:{matchUpFormat:"SET1-S:8/TB7",matchUpCount:3,matchUpValue:1},singles:{matchUpFormat:Ju,matchUpCount:6,matchUpValue:1},tieFormatName:sO,valueGoal:5},[m5]:c5,[p5]:a5,[f5]:t5,[h5]:X4,[g5]:i5,[I5]:e5,[v5]:r5,[y5]:n5,[b5]:s5,[w5]:K4,[U5]:Z4,[S5]:o5,[T5]:Q4,[D5]:J4,[E5]:l5,[P5]:d5,[R5]:u5},Bve=t=>{let e=t?.namedFormat&&Object.keys(xH).includes(t.namedFormat)?t.namedFormat:C5,i=Array.isArray(t?.uuids)?t?.uuids:[],r,{category:n,gender:a}=t?.event??{},s=ke(xH[e],!1,!0),o=l=>{if(!t?.isMock&&!t?.event?.isMock||!t.event)return i?.pop()??Et();let u=t?.event?.eventId;return i.pop()??`${u}-COL-${l+1}`};return s.hydrate?(r={winCriteria:{valueGoal:s.valueGoal},collectionDefinitions:[{collectionId:o(0),matchUpFormat:_ve,collectionName:"Doubles",matchUpType:$t,...s.doubles},{collectionId:o(1),matchUpFormat:Ju,collectionName:"Singles",matchUpType:Wt,...s.singles}]},s.tieFormatName&&(r.tieFormatName=s.tieFormatName)):(s.collectionDefinitions.forEach((l,u)=>l.collectionId=o(u)),r=s),t?.hydrateCollections&&r.collectionDefinitions.forEach(l=>{n&&!l.category&&(l.category=n),a&&!l.gender&&(l.gender=a)}),r},oc=Bve,nl="SINGLES",Pm="SINGLES",ls="DOUBLES",lc="DOUBLES",rr="TEAM",ya="TEAM",Vve="RATING",jve="BOTH",gF={AGE:"AGE",BOTH:jve,DOUBLES:ls,DOUBLES_EVENT:lc,RATING:Vve,SINGLES:nl,SINGLES_EVENT:Pm,TEAM_EVENT:ya,TEAM:rr},xe="MAIN",We="QUALIFYING",Zr="CONSOLATION",Er="VOLUNTARY_CONSOLATION",Ui="PLAY_OFF",sR=[xe,We,Zr,Ui,Er],Em={[We]:1,[xe]:2,[Ui]:3,[Zr]:3,[Er]:4},M5="finishingPositions",N5="aggregateEventStructures",A5={[xe]:1,[Ui]:2,[Zr]:3,[We]:4,[Er]:5},Gve={[Ui]:1,[xe]:2,[Zr]:3,[We]:4,[Er]:5},oR="CLUSTER",lR="ADJACENT",k5="SEPARATE",Dp="WATERFALL",uR="ITEM",fn="CONTAINER",Cs="DRAW",cR="RANDOM",Ms="TOP_DOWN",Pp="BOTTOM_UP",iu="POSITION",ru="WINNER",nu="LOSER",al="FIRST_MATCHUP",na="AD_HOC",Hve="AD_HOC",rv="FEED_IN",eI="COMPASS",tI="OLYMPIC",Wve="SINGLE_ELIMINATION",Yo="SINGLE_ELIMINATION",_w="DOUBLE_ELIMINATION",iI="FIRST_MATCH_LOSER_CONSOLATION",$w="FIRST_ROUND_LOSER_CONSOLATION",rf="LUCKY_DRAW",dR="CURTIS_CONSOLATION",zve="CURTIS_CONSOLATION",IF="FEED_IN_CHAMPIONSHIP_TO_SF",gb="FEED_IN_CHAMPIONSHIP_TO_SF",vF="FEED_IN_CHAMPIONSHIP_TO_QF",Ib="FEED_IN_CHAMPIONSHIP_TO_QF",yF="FEED_IN_CHAMPIONSHIP_TO_R16",vb="FEED_IN_CHAMPIONSHIP_TO_R16",O5="MODIFIED_FEED_IN_CHAMPIONSHIP",yb="MODIFIED_FEED_IN_CHAMPIONSHIP",Bw="FEED_IN_CHAMPIONSHIP",qve="DOUBLE_ROUND_ROBIN",Ks="ROUND_ROBIN",au="ROUND_ROBIN_WITH_PLAYOFF",x5="DECIDER",F5="BACKDRAW",bF={0:{name:"East",abbreviation:"E"},"0-1":{name:"West",abbreviation:"W"},"0-2":{name:"North",abbreviation:"N"},"0-3":{name:"Northeast",abbreviation:"NE"},"0-1-1":{name:"South",abbreviation:"S"},"0-1-2":{name:"Southwest",abbreviation:"SW"},"0-2-1":{name:"Northwest",abbreviation:"NW"},"0-1-1-1":{name:"Southeast",abbreviation:"SE"}},wF={0:{name:"East",abbreviation:"E"},"0-1":{name:"West",abbreviation:"W"},"0-2":{name:"North",abbreviation:"N"},"0-1-1":{name:"South",abbreviation:"S"}},Ep="WIN_RATIO",lh="ROUND_OUTCOME",L5=[eI,dR,Ib,vb,gb,Bw,vF,yF,IF,iI,$w,rf,yb,tI,Ui,au],Yve=[na,eI,dR,_w,Ib,vb,gb,Bw,rv,iI,$w,rf,yb,tI,Ui,Ks,au,Yo],pR={MAIN:xe,QUALIFYING:We,CONSOLATION:Zr,ITEM:uR,CONTAINER:fn,FIRST_MATCHUP:al,WINNER:ru,LOSER:nu,AD_HOC:na,FEED_IN:rv,FLEX_ROUNDS:Hve,COMPASS:eI,PLAY_OFF:Ui,OLYMPIC:tI,KNOCKOUT:Wve,SINGLE_ELIMINATION:Yo,DOUBLE_ELIMINATION:_w,CURTIS:dR,FICSF:IF,FICQF:vF,FICR16:yF,MFIC:O5,VOLUNTARY_CONSOLATION:Er,FIRST_MATCH_LOSER_CONSOLATION:iI,FIRST_ROUND_LOSER_CONSOLATION:$w,MODIFIED_FEED_IN_CHAMPIONSHIP:yb,FEED_IN_CHAMPIONSHIP_TO_R16:vb,FEED_IN_CHAMPIONSHIP_TO_QF:Ib,FEED_IN_CHAMPIONSHIP_TO_SF:gb,FEED_IN_CHAMPIONSHIP:Bw,LUCKY_DRAW:rf,ROUND_ROBIN_WITH_PLAYOFF:au,ROUND_ROBIN:Ks,DECIDER:x5,BACKDRAW:F5,COMPASS_ATTRIBUTES:bF,OLYMPIC_ATTRIBUTES:wF,DRAW:Cs,RANDOM:cR,TOP_DOWN:Ms,BOTTOM_UP:Pp,CLUSTER:oR,ADJACENT:lR,SEPARATE:k5,WATERFALL:Dp,WIN_RATIO:Ep,ROUND_OUTCOME:lh,MULTI_STRUCTURE_DRAWS:L5,generatedDrawTypes:Yve,stageOrder:Em,finishOrder:A5,AGGREGATE_EVENT_STRUCTURES:N5,FINISHING_POSITIONS:M5},Kve=pR,cn="tournamentRecords",SF="policyDefinitions",mr="tournamentRecord",UF="onlineResource",mn="drawDefinition",_5="tieFormatName",TF="matchUpFormat",su="participantId",$5="scheduleDates",Xve="tournamentId",Jve="scheduleDate",Qve="roundNumber",fR="structureId",DF="participant",Vw="matchUpIds",B5="entryStage",Zve="policyType",V5="structures",PF="eventType",Ul="matchUpId",mR="tieFormat",hR="inContext",gR="structure",IR="courtIds",eye="personId",vR="venueIds",EF="matchUps",j5="courtId",G5="eventId",Du="matchUp",H5="drawId",xs="error",kc="event",nv="param",RF="uuids",tye="averageMatchUpMinutes",iye="recoveryMinutes",rye="periodLength",nye="number",Yn="object",an="array",Wr="_validate",W5="_message",Fa="_invalid",zn="_ofType",CF="_anyOf",rI="_oneOf",FH={[UF]:t=>xi(Object.keys(t),[WD,zD,Zg]).length===3,[_5]:t=>t&&oc({namedFormat:t}),[RF]:t=>!t||Array.isArray(t)&&t.every(ri),[mR]:t=>!Bn({tieFormat:t}).error,[PF]:t=>[nl,ls,rr].includes(t),[B5]:t=>sR.includes(t)},aye={[cn]:Ci,[mr]:Ie,[SF]:jE,[mn]:_e,[su]:lr,[TF]:x6,[Xve]:Yg,[fR]:Va,[Vw]:th,[DF]:rh,[UF]:Ac,[PF]:Zl,[V5]:$1,[Ul]:Un,[mR]:Vl,[gR]:Zp,[j5]:ih,[EF]:Tu,[G5]:os,[Du]:ta,[IR]:Xe,[vR]:Xe,[H5]:Oo,[kc]:li},sye={[cn]:Yn,[SF]:Yn,[mr]:Yn,[mn]:Yn,[UF]:Yn,[$5]:an,[DF]:Yn,[Vw]:an,[V5]:an,[mR]:Yn,[gR]:Yn,[IR]:an,[vR]:an,[EF]:an,[Du]:Yn,[kc]:Yn,[RF]:an};function Ge(t,e,i){if(!t&&!bt(t))return{error:ie};if(!e?.length||t?._bypassParamCheck)return{valid:!0};if(!Array.isArray(e))return{error:ie};let{paramError:r,errorParam:n}=uye(t,e);if(!r)return{valid:!0};let a=r[Wr]&&(r[xs]||r[Fa])||t?.[n]===void 0&&(r[xs]||r[Fa]||aye[n]||ie)||ie,s=n??(r[rI]&&Object.keys(r[rI]).join(", "));return z({info:{param:s,message:r[W5]},result:{error:a},stack:i})}function z5(t,e){let i=Object.keys(t),r=Object.keys(e);return xi(i,r)}function oye(t,e){if(!e)return;let i=z5(t,e);return i.length!==1?{error:ie}:i.reduce((r,n)=>({...r,[n]:!0}),{})}function lye(t,e){if(!e)return;let i=z5(t,e).filter(r=>t[r]);return i.length<1?{error:ie}:i.reduce((r,n)=>({...r,[n]:!0}),{})}function uye(t,e){let i,r;return{paramError:e.find(({_ofType:n,_oneOf:a,_anyOf:s,_validate:o,_info:l,...u})=>{let c=a&&oye(t,a);if(c?.error)return c.error;c&&Object.assign(u,c);let d=s&&lye(t,s);if(d?.error)return d.error;d&&Object.assign(u,d);let p=Object.keys(u).filter(m=>typeof u[m]=="boolean"),f=p.find(m=>{let h=o&&!pa(o),g=t[m]!==void 0&&!o&&cye(t,m,n),I=u[m]&&[void 0,null].includes(t[m]),v=h||g||I||o&&t[m]!==void 0&&!dye(t[m],o)||FH[m]&&!FH[m](t[m]);return v&&(i=m,r=l),v});return!p.length||f}),errorParam:i,paramInfo:r}}function cye(t,e,i){return i=i||sye[e]||"string",i==="array"?!Array.isArray(t[e]):typeof t[e]!==i}function dye(t,e){return pa(e)?e(t):!0}var MF="DYNAMIC",ou="RANKING",od="RATING",pd="SCALE",jl="SEEDING",pye={RANKING:ou,RATING:od,SCALE:pd,SEEDING:jl};function av(t){let e=Ge(t,[{[DF]:!0}]);if(e.error)return e;let i=t.participant.timeItems?.filter(({itemType:n})=>n?.startsWith(pd)&&[ou,od,jl].includes(n.split(".")[1])),r={ratings:{},rankings:{},seedings:{}};if(i?.length){let n=s=>i.filter(o=>o?.itemType===s).sort((o,l)=>new Date(o.createdAt||void 0).getTime()-new Date(l.createdAt||void 0).getTime()).pop(),a=rt(i.map(({itemType:s})=>s));for(let s of a){let o=n(s);if(o){let[,l,u,c,d]=o.itemType.split("."),p=d?`${c}.${d}`:c,f=l===jl&&"seedings"||l===ou&&"rankings"||"ratings";r[f][u]||(r[f][u]=[]),r[f][u].push({scaleValue:o.itemValue,scaleDate:o.itemDate,scaleName:p})}}}return{...H,...r}}function Rm(t){if(t===null)return{};let{source:e,template:i}=t||{};if(!i)return e;let r={};return n(e,i,r),r;function n(a,s,o){if(!a||!s)return;let l=Object.keys(a),u=Object.keys(s),c=Object.assign({},...u.filter(f=>f.indexOf("||")).map(f=>f.split("||").map(m=>({[m]:f}))).flat()),d=u.concat(...Object.keys(c)),p=d.includes("*");for(let f of l)if(d.indexOf(f)>=0||p){let m=c[f]||f,h=s[m]||p,g=a[f];if(typeof h=="object"&&typeof g!="function"&&!Array.isArray(h))if(Array.isArray(g)){let I=g.map(v=>{let w={};return n(v,h,w)!==!1?w:void 0}).filter(Boolean);o[f]=I}else g&&(o[f]={},n(g,h,o[f]));else{let I=a[f];if(Array.isArray(h)&&!h.includes(I))return!1;(s[f]||p&&s[f]!==!1)&&(o[f]=I)}}}}var lO="voluntaryConsolation",Gu="competitiveBands",NF="roundRobinTally",Rp="positionActions",Rr="matchUpActions",YT="rankingPoints",uc="roundNaming",jw="participant",bb="progression",Fd="scheduling",YD="avoidance",fye="participant",mye="display",Po="scoring",fo="seeding",nI="feedIn",hye="audit",KD="draws",gye={POLICY_TYPE_VOLUNTARY_CONSOLATION:lO,POLICY_TYPE_COMPETITIVE_BANDS:Gu,POLICY_TYPE_ROUND_ROBIN_TALLY:NF,POLICY_TYPE_POSITION_ACTIONS:Rp,POLICY_TYPE_MATCHUP_ACTIONS:Rr,POLICY_TYPE_RANKING_POINTS:YT,POLICY_TYPE_ROUND_NAMING:uc,POLICY_TYPE_PARTICIPANT:jw,POLICY_TYPE_PROGRESSION:bb,POLICY_TYPE_SCHEDULING:Fd,POLICY_TYPE_AVOIDANCE:YD,POLICY_TYPE_DISPLAY:mye,POLICY_TYPE_PRIVACY:fye,POLICY_TYPE_FEED_IN:nI,POLICY_TYPE_SCORING:Po,POLICY_TYPE_SEEDING:fo,POLICY_TYPE_AUDIT:hye,POLICY_TYPE_DRAWS:KD};function fd({tournamentParticipants:t=[],policyDefinitions:e={},contextProfile:i,participantId:r,internalUse:n,personId:a}){let s=t.find(l=>r&&l.participantId===r||a&&l.person&&l.person.personId===a),o=ke(s,!1,n);if(o){let l=e?.[jw];if(i?.withScaleValues){let{ratings:u,rankings:c}=av({participant:o});o.rankings=c,o.ratings=u}if(l?.participant)return Rm({template:l.participant,source:o})}return o}var Iye="element required",vye="missing name";function En(t){if(!t||typeof t!="object")return{error:Xe};if(t.element&&typeof t?.element!="object")return{error:ie};if(!t?.name)return{error:Xe,info:vye};if(!t?.element){if(t.discover&&t.tournamentRecords){for(let e of Object.keys(t.tournamentRecords)){let i=t.tournamentRecords[e],r=En({element:i,name:t.name});if(r.error)return z({result:r,stack:"removeExtension"})}return{...H}}return{error:Xe,info:Iye}}return t?.element.extensions?(t.element.extensions=t.element.extensions.filter(e=>e?.name!==t.name),{...H}):{...H,info:_r}}function sl({requiredAttributes:t=["name","value"],extension:e}){if(!e||typeof e!="object"||typeof e.name!="string")return!1;let i=Object.keys(e);return t.filter(r=>i.includes(r)).length===t.length}function xt(t){if(typeof t!="object")return{error:Xe};let e="addExtension";if(t?.element&&typeof t.element!="object")return z({result:{error:ie},stack:e});if(!sl({extension:t.extension}))return z({result:{error:ie,info:"invalid extension"},stack:e});if(!t.element)if(t.discover&&!t.tournamentId&&t.tournamentRecords){for(let r of Object.values(t.tournamentRecords)){let n=xt({extension:t.extension,element:r});if(n.error)return z({result:n,stack:e})}return{...H}}else return z({result:{error:Xe},stack:e});if(t.element.extensions||(t.element.extensions=[]),t?.creationTime??!0){let r=new Date().toISOString();Object.assign(t.extension,{createdAt:r})}let i=t.element.extensions.find(({name:r})=>r===t.extension.name);return i?i.value=t.extension.value:t.extension.value&&t.element.extensions.push(t.extension),{...H}}function AF(t){return!t||typeof t!="object"?{error:Xe}:t.tournamentRecord?xt({creationTime:t.creationTime,element:t.tournamentRecord,extension:t.extension}):{error:Ie}}function yR(t){return!t||typeof t!="object"?{error:Xe}:t.drawDefinition?xt({creationTime:t.creationTime,element:t.drawDefinition,extension:t.extension}):{error:Oa}}function Ld(t){return!t||typeof t!="object"?{error:Xe}:t.event?xt({creationTime:t.creationTime,extension:t.extension,element:t.event}):{error:os}}function q5(t){if(!t||typeof t!="object")return{error:Xe};if(!t.participantId)return{error:lr};let e=t.tournamentRecord?.participants||[],i=fd({participantId:t.participantId,tournamentParticipants:e});return i?xt({creationTime:t.creationTime,extension:t.extension,element:i}):{error:Vi}}function kF(t){return!t||typeof t!="object"?{error:Xe}:t.tournamentRecord?En({element:t.tournamentRecord,name:t.name}):{error:Ie}}function Y5(t){return!t||typeof t!="object"?{error:Xe}:t.drawDefinition?En({element:t.drawDefinition,name:t.name}):{error:Oa}}function bR(t){return!t||typeof t!="object"?{error:Xe}:t?.event?En({element:t.event,name:t.name}):{error:os}}function K5(t){if(!t||typeof t!="object")return{error:Xe};if(!t.participantId)return{error:lr};let e=t.tournamentRecord?.participants||[],i=fd({participantId:t.participantId,tournamentParticipants:e});return i?En({element:i,name:t.name}):{error:Vi}}function Gw({tournamentRecords:t}){return{tournamentIds:bt(t)?Object.keys(t):[],...H}}var yye="extensionQueries";function mt({discover:t,element:e,name:i,...r}){if(!e||!i){if(t&&r){let a=Object.keys(r).filter(l=>typeof t=="boolean"||Array.isArray(t)&&t.includes(l)).find(l=>Array.isArray(r[l]?.extensions)?r[l].extensions.find(u=>u?.name===i):!1),s=a&&r[a];!s&&r.tournamentRecords&&(s=Object.values(r.tournamentRecords).find(l=>l.extensions?.length));let o=s?.extensions?.find(l=>l?.name===i);return{extension:o,info:o?void 0:_r}}return z({result:{error:Xe},stack:yye})}if(!Array.isArray(e.extensions))return{info:"no extensions"};let n=e.extensions.find(a=>a?.name===i);return{extension:n,info:n?void 0:_r}}var bye="activeSuspension",wb="appliedPolicies",X5="context",wR="delegatedOutcome",Io="disabled",Cm="disableAutoCalc",SR="disableLinks",XD="display",fp="drawDeletions",wye="drawProfile",JD="entryProfile",Sye="eventProfile",Uye="eventWithdrawalRequests",Tye="factory",Xs="flightProfile",uO="groupingAttribute",cc="lineUps",Cp="linkedTournamentsIds",OF="participantRepresentatives",sv="personRequests",Bg="positionActions",Dye="rankingPoints",Pye="registration",Tl="roundTarget",Hw="scheduleLimits",dc="scheduleTiming",Mm="schedulingProfile",Eye="statusDetail",aI="subOrder",pc="tally",Fy="tieFormatModification",J5={ACTIVE_SUSPENSION:bye,APPLIED_POLICIES:wb,CONTEXT:X5,DELEGATED_OUTCOME:wR,DISABLED:Io,DISABLE_LINKS:SR,DISABLE_AUTO_CALC:Cm,DISPLAY:XD,DRAW_DELETIONS:fp,DRAW_PROFILE:wye,ENTRY_PROFILE:JD,EVENT_PROFILE:Sye,EVENT_WITHDRAWAL_REQUESTS:Uye,FLIGHT_PROFILE:Xs,GROUPING_ATTRIBUTE:uO,LINEUPS:cc,LINKED_TOURNAMENTS:Cp,PARTICIPANT_REPRESENTATIVES:OF,PERSON_REQUESTS:sv,POSITION_ACTIONS:Bg,RANKING_POINTS:Dye,REGISTRATION:Pye,ROUND_TARGET:Tl,SCHEDULE_LIMITS:Hw,SCHEDULE_TIMING:dc,SCHEDULING_PROFILE:Mm,STATUS_DETAIL:Eye,SUB_ORDER:aI,TALLY:pc,TIE_FORMAT_MODIFICATIONS:Fy,FACTORY:Tye},LH=[wR,Io,Cm,SR,Xs,cc,Cp,OF,sv,Tl,Hw,dc,Mm,aI,pc,Fy];function Q5({tournamentRecords:t}){if(typeof t!="object"||!Object.keys(t).length)return{error:Ci};let e=Gw({tournamentRecords:t}),{tournamentIds:i}=e;return i?.length>1?xt({tournamentRecords:t,discover:!0,extension:{name:Cp,value:{tournamentIds:i}}}):{...H}}function Z5({tournamentRecords:t}){if(typeof t!="object"||!Object.keys(t).length)return{error:Ci};let e=En({name:Cp,tournamentRecords:t,discover:!0});return z({result:e,stack:"unlinkTournaments"})}function eK({tournamentRecords:t,tournamentId:e}){if(typeof t!="object")return{error:ie};if(!e)return{error:Yg};let i=Gw({tournamentRecords:t}),{tournamentIds:r}=i;if(!r.includes(e))return{error:Yg};let n;return r.every(a=>{let s=t[a],{extension:o}=mt({element:s,name:Cp});if(!o)return!0;let l=o?.value?.tournamentIds||[];if(!l?.length||l.length===1&&l.includes(e)||a===e){let d=kF({name:Cp,tournamentRecord:s});return d.error&&(n=d.error),d.success}let u=l.filter(d=>d!==e);o.value={tournamentIds:u};let c=AF({tournamentRecord:s,extension:o});return c.error&&(n=c.error),c.success}),n?{error:n}:{...H}}var tK={};ct(tK,{getLinkedTournamentIds:()=>Ww,getTournamentIds:()=>Gw});function Ww({tournamentRecords:t}){return typeof t!="object"||!Object.keys(t).length?{error:Ci}:{linkedTournamentIds:Object.assign({},...Object.keys(t).map(e=>{let i=t[e],r=i?.tournamentId,{extension:n}=mt({element:i,name:Cp}),a=(n?.value?.tournamentIds||[]).filter(s=>s!==r);return{[e]:a}}))}}var UR={};ct(UR,{adHocPositionSwap:()=>h8,addAdHocMatchUps:()=>JR,addDrawDefinitionTimeItem:()=>BL,addFinishingRounds:()=>oS,addGoesTo:()=>Np,addPlayoffStructures:()=>XR,addQualifyingStructure:()=>m8,addVoluntaryConsolationStage:()=>o8,addVoluntaryConsolationStructure:()=>EL,allPlayoffPositionsFilled:()=>LL,alternateDrawPositionAssignment:()=>q7,assignDrawPosition:()=>N8,assignDrawPositionBye:()=>Wa,attachConsolationStructures:()=>E8,attachPlayoffStructures:()=>e0,attachQualifyingStructure:()=>$L,attachStructures:()=>KR,autoSeeding:()=>bRe,automatedPlayoffPositioning:()=>hv,automatedPositioning:()=>IS,buildDrawHierarchy:()=>vRe,checkValidEntries:()=>tC,deleteAdHocMatchUps:()=>k8,drawMatic:()=>L0,findDrawDefinition:()=>a0,generateAdHocMatchUps:()=>iC,generateAdHocRounds:()=>F0,generateAndPopulatePlayoffStructures:()=>QL,generateDrawDefinition:()=>OS,generateDrawMaticRound:()=>f0,generateDrawStructuresAndLinks:()=>c0,generateDrawTypeAndModifyDrawDefinition:()=>d0,generateQualifyingStructure:()=>zL,generateVoluntaryConsolation:()=>c9,getAssignedParticipantIds:()=>df,getAvailableMatchUpsCount:()=>QR,getAvailablePlayoffProfiles:()=>bS,getDrawDefinitionTimeItem:()=>eL,getDrawParticipantRepresentativeIds:()=>r0,getDrawStructures:()=>Js,getDrawTypeCoercion:()=>ES,getEligibleVoluntaryConsolationParticipants:()=>i0,getMatchUpsMap:()=>kr,getParticipantIdFinishingPositions:()=>n0,getPositionAssignments:()=>cI,getPositionsPlayedOff:()=>gv,getRandomQualifierList:()=>l0,getSeedingThresholds:()=>NL,getSeedsCount:()=>RS,getStructureSeedAssignments:()=>ds,getTeamLineUp:()=>Mp,getValidGroupSizes:()=>hS,isAdHoc:()=>Vn,isCompletedStructure:()=>uu,isValidForQualifying:()=>u0,luckyLoserDrawPositionAssignment:()=>V7,modifyDrawDefinition:()=>R8,modifyDrawName:()=>t0,modifySeedAssignment:()=>e8,mutate:()=>iK,positionActions:()=>o0,pruneDrawDefinition:()=>M8,qualifierDrawPositionAssignment:()=>_L,qualifierProgression:()=>t8,query:()=>F8,removeDrawPositionAssignment:()=>Pb,removeRoundMatchUps:()=>O8,removeSeededParticipant:()=>f8,removeStructure:()=>a8,renameStructures:()=>n8,resetDrawDefinition:()=>C8,resetQualifyingStructure:()=>l8,resetVoluntaryConsolationStructure:()=>yK,setDrawParticipantRepresentativeIds:()=>rK,setPositionAssignments:()=>W7,setStructureOrder:()=>i8,setSubOrder:()=>x8,shiftAdHocRounds:()=>H7,swapAdHocRounds:()=>z7,swapDrawPositionAssignments:()=>d8,updateTeamLineUp:()=>wh,withdrawParticipantAtDrawPosition:()=>k7});var iK={};ct(iK,{adHocPositionSwap:()=>h8,addAdHocMatchUps:()=>JR,addDrawDefinitionTimeItem:()=>BL,addPlayoffStructures:()=>XR,addQualifyingStructure:()=>m8,addVoluntaryConsolationStage:()=>o8,addVoluntaryConsolationStructure:()=>EL,alternateDrawPositionAssignment:()=>q7,assignDrawPosition:()=>N8,assignDrawPositionBye:()=>Wa,attachConsolationStructures:()=>E8,attachPlayoffStructures:()=>e0,attachQualifyingStructure:()=>$L,attachStructures:()=>KR,automatedPlayoffPositioning:()=>hv,automatedPositioning:()=>IS,deleteAdHocMatchUps:()=>k8,luckyLoserDrawPositionAssignment:()=>V7,modifyDrawDefinition:()=>R8,modifyDrawName:()=>t0,modifySeedAssignment:()=>e8,pruneDrawDefinition:()=>M8,qualifierDrawPositionAssignment:()=>_L,qualifierProgression:()=>t8,removeDrawPositionAssignment:()=>Pb,removeRoundMatchUps:()=>O8,removeSeededParticipant:()=>f8,removeStructure:()=>a8,renameStructures:()=>n8,resetDrawDefinition:()=>C8,resetQualifyingStructure:()=>l8,resetVoluntaryConsolationStructure:()=>yK,setDrawParticipantRepresentativeIds:()=>rK,setPositionAssignments:()=>W7,setStructureOrder:()=>i8,setSubOrder:()=>x8,shiftAdHocRounds:()=>H7,swapAdHocRounds:()=>z7,swapDrawPositionAssignments:()=>d8,updateTeamLineUp:()=>wh,withdrawParticipantAtDrawPosition:()=>k7});var xF=t=>e=>t[e],FF=(t=[])=>t.map(Ir).filter(Boolean),cO=(t=[])=>t.map(vt).filter(Boolean),vt=(t={})=>xF(t)("participantId"),Ir=(t={})=>xF(t)("matchUpId"),Sb=(t={})=>xF(t)("drawId");function rK({representativeParticipantIds:t,drawDefinition:e}){if(!e)return{error:Oa};if(!Array.isArray(t))return{error:ie};let i=cO(e?.entries||[]);return t.length&&xi(t,i).length<t.length?{error:ie}:yR({drawDefinition:e,extension:{name:OF,value:t}})}var us="ABANDONED",uh="AWAITING_RESULT",Oc="CANCELLED",ki="COMPLETED",ov="DEAD_RUBBER",Qt="DEFAULTED",Hi="DOUBLE_DEFAULT",wi="DOUBLE_WALKOVER",ao="IN_PROGRESS",cs="INCOMPLETE",LF="NOT_PLAYED",$r="RETIRED",_d="SUSPENDED",Fi="TO_BE_PLAYED",mi="WALKOVER",Rye=[uh,ki,Qt,ao,cs,$r,_d],nK=[uh,ki,Qt,wi,Hi,ao,cs,$r,_d,mi],aK=[us,uh,"BYE",Oc,ki,ov,Qt,wi,Hi,ao,cs,LF,$r,_d,Fi,mi],sK=["BYE",wi,Hi,ki,Qt,$r,mi],oK=[us,uh,Oc,ov,ao,cs,LF,_d,Fi,void 0],Yi=[Oc,us,ki,ov,Qt,wi,Hi,$r,mi],_F=[us,ki,Qt,wi,Hi,ao,$r,mi],lK=[ao,cs,_d,Fi],uK={ABANDONED:us,AWAITING_RESULT:uh,BYE:"BYE",CANCELLED:Oc,COMPLETED:ki,DEAD_RUBBER:ov,DEFAULTED:Qt,DOUBLE_WALKOVER:wi,DOUBLE_DEFAULT:Hi,IN_PROGRESS:ao,INCOMPLETE:cs,NOT_PLAYED:LF,RETIRED:$r,SUSPENDED:_d,TO_BE_PLAYED:Fi,WALKOVER:mi};function ch(t,e,i){let r=d=>mt({element:d,name:Tl})?.extension?.value,n=i?.deprioritizeCompleted,a=i?.mode===N5&&Gve,s=i?.mode===M5&&A5,o=s||a||Em,l=d=>d?.stage===xe&&d?.stageSequence===1,u=d=>l(d)?-1:o[d?.stage],c=d=>d?.matchUps.every(({matchUpStatus:p})=>Yi.includes(p)?1:-1);return n&&c(t)-c(e)||a&&u(t)-u(e)||(t?.stage&&o[t.stage]||0)-(e?.stage&&o[e.stage]||0)||(r(t)||0)-(r(e)||0)||!s&&!a&&(e?.positionAssignments?.length??1/0)-(t?.positionAssignments?.length??1/0)||(t?.stageSequence??0)-(e?.stageSequence??0)||(QD(t)||0)-(QD(e)||0)}function QD(t){return(t?.matchUps||[]).reduce((e,i)=>{let r=(i.finishingPositionRange?.winner||[]).reduce((n,a)=>n+a,0);return!e||r<e?r:e},void 0)}function et(t){let e=Ge(t,[{[mn]:!0,[fR]:!0}]);if(e.error)return e;let{drawDefinition:i,structureId:r}=t,{structures:n}=Js({drawDefinition:i}),a=n?.flatMap(l=>l.structures?[...l.structures].concat(l):l),s=a?.find(l=>l.structureId===r);if(!s)return{error:Ii};let o=s.structureType===uR?a?.find(l=>l.structures?.some(u=>u.structureId===r)):void 0;return{structure:s,containingStructure:o}}function Js({withStageGrouping:t,drawDefinition:e,stageSequences:i,stageSequence:r,roundTarget:n,sortConfig:a,stages:s,stage:o}){let l=!e&&_e||!e?.structures&&$1||void 0;if(l)return{error:l,structures:[],stageStructures:{}};let u=m=>{let h=mt({element:m,name:Tl})?.extension?.value;return!n||n===h},c=e?.structures?.filter(p).filter(f).filter(u).sort((m,h)=>ch(m,h,a))??[],d=t?Object.assign({},...sR.map(m=>{let h=c?.filter(g=>g.stage===m);return h?.length&&{[m]:h}}).filter(Boolean)):{};return{structures:c,stageStructures:d};function p(m){return!o&&!Array.isArray(s)||o&&m.stage===o||Array.isArray(s)&&s.includes(m.stage)}function f(m){return!r&&!Array.isArray(i)||r&&m.stageSequence===r||Array.isArray(i)&&i.includes(m.stageSequence)}}function cK({drawDefinition:t}){if(!t)return{error:_e};let e={};return{allPositionedParticipantIds:(t.structures||[]).map(i=>{let r=i.stage;e[r]||(e[r]=[]);let{positionAssignments:n}=Yt({structure:i}),a=n?.map(vt).filter(Boolean)??[];return e[r].push(...a),a}).flat(),stagePositionedParticipantIds:e}}function Yt({drawDefinition:t,structureId:e,structure:i}){let r,n=[];if(!i){if(!t)return{positionAssignments:n,error:_e};if({structure:i,error:r}=et({drawDefinition:t,structureId:e}),r)return{positionAssignments:n,error:r}}return i.structures?n=[].concat(...i.structures.map(a=>Yt({structure:a}).positionAssignments)):i.positionAssignments?n=i.positionAssignments:r=A6,{positionAssignments:n,error:r}}function ur({drawDefinition:t,structureId:e,structure:i}){let r=Yt({drawDefinition:t,structureId:e,structure:i})?.positionAssignments||[],n=r?.filter(u=>u.participantId??u.bye??u.qualifier),a=r&&r?.length===n?.length,s=r?.filter(u=>!u.participantId&&!u.bye&&!u.qualifier),o=r?.filter(u=>!u.participantId&&u.bye),l=r?.filter(u=>!u.participantId&&u.qualifier);return{allPositionsAssigned:a,positionAssignments:r,unassignedPositions:s,assignedPositions:n,qualifierPositions:l,byePositions:o}}var $F="addDrawDefinition",TR="addMatchUps",md="addParticipants",BF="addScaleItems",dK="addEvent",pK="addVenue",Qu="audit",VF="dataIssue",jF="deleteParticipants",GF="deleteVenue",HF="deletedDrawIds",WF="deletedMatchUpIds",zF="modifyDrawDefinition",fK="modifyDrawEntries",mK="modifyEventEntries",qF="modifyMatchUp",en="modifyParticipants",YF="modifyPositionAssignments",KF="modifySeedAssignments",nf="modifyTournamentDetail",xc="modifyVenue",dO="mutations",pO="publishEvent",hK="publishEventSeeding",gK="publishOrderOfPlay",IK="publishParticipants",XF="unPublishEvent",JF="unPublishEventSeeding",QF="unPublishOrderOfPlay",Cye="unPublishParticipants",DR="updateInContextMatchUp",Mye={ADD_DRAW_DEFINITION:$F,ADD_MATCHUPS:TR,ADD_PARTICIPANTS:md,ADD_SCALE_ITEMS:BF,ADD_EVENT:dK,ADD_VENUE:pK,AUDIT:Qu,DATA_ISSUE:VF,DELETE_PARTICIPANTS:jF,DELETE_VENUE:GF,DELETED_DRAW_IDS:HF,DELETED_MATCHUP_IDS:WF,MODIFY_DRAW_DEFINITION:zF,MODIFY_DRAW_ENTRIES:fK,MODIFY_EVENT_ENTRIES:mK,MODIFY_MATCHUP:qF,MODIFY_PARTICIPANTS:en,MODIFY_POSITION_ASSIGNMENTS:YF,MODIFY_SEED_ASSIGNMENTS:KF,MODIFY_TOURNAMENT_DETAIL:nf,MODIFY_VENUE:xc,MUTATIONS:dO,PUBLISH_EVENT_SEEDING:hK,PUBLISH_EVENT:pO,PUBLISH_ORDER_OF_PLAY:gK,PUBLISH_PARTICIPANTS:IK,UNPUBLISH_EVENT_SEEDING:JF,UNPUBLISH_EVENT:XF,UNPUBLISH_ORDER_OF_PLAY:QF,UPDATE_INCONTEXT_MATCHUP:DR};function PR(t,e){if(!t)return{error:_e};let i=Date.now();t.updatedAt&&i===new Date(t.updatedAt).getTime()&&(i+=1);let r=new Date(i).toISOString(),n=e?.filter(Boolean);return t.updatedAt=r,t.structures?.filter(Boolean).forEach(a=>{(!n?.length||n?.includes(a.structureId))&&(a.updatedAt=r)}),{...H}}function hd({drawDefinition:t,tournamentId:e,matchUps:i,eventId:r}){return t&&PR(t),at({payload:{matchUps:i,tournamentId:e,eventId:r},topic:TR}),{...H}}function Pu({drawDefinition:t,tournamentId:e,matchUpIds:i,eventId:r,action:n}){t&&PR(t),at({topic:WF,payload:{tournamentId:e,matchUpIds:i,eventId:r,action:n}});for(let a of i)lF({key:a});return{...H}}function St({drawDefinition:t,tournamentId:e,structureId:i,context:r,eventId:n,matchUp:a}){return a?(t&&ti({drawDefinition:t,structureIds:i?[i]:void 0,tournamentId:e,eventId:n}),at({topic:qF,payload:{matchUp:a,tournamentId:e,context:r},key:a.matchUpId}),{...H}):(console.log(ta),{error:ta})}function Nye({tournamentId:t,inContextMatchUp:e}){return e?(at({payload:{inContextMatchUp:e,tournamentId:t},topic:DR,key:e.matchUpId}),{...H}):{error:ta}}function zw({tournamentId:t,eventId:e,drawDefinition:i}){return i?(PR(i),at({payload:{drawDefinition:i,tournamentId:t,eventId:e},topic:$F,key:i.drawId}),{...H}):(console.log(_e),{error:_e})}function Aye({tournamentId:t,eventId:e,drawId:i}){return at({payload:{drawId:i,tournamentId:t,eventId:e},topic:HF,key:i}),lF({key:i}),{...H}}function ti({drawDefinition:t,tournamentId:e,structureIds:i,eventId:r}){return t?(PR(t,i),at({payload:{tournamentId:e,eventId:r,drawDefinition:t},topic:zF,key:t.drawId}),{...H}):{error:_e}}function vK({drawDefinition:t,tournamentId:e,structure:i,eventId:r}){if(!t)return{error:_e};if(!i)return{error:Zp};let n=i.seedAssignments,a=i.structureId,s=t.drawId;return at({payload:{tournamentId:e,eventId:r,drawId:s,structureId:a,seedAssignments:n},topic:KF,key:t.drawId}),ti({structureIds:[a],drawDefinition:t,tournamentId:e,eventId:r}),{...H}}function fc({drawDefinition:t,tournamentId:e,structure:i,event:r}){if(!t)return{error:_e};if(!i)return{error:Zp};let n=Yt({structure:i}),a=i.structureId,s=t.drawId,o=r?.eventId;return at({topic:YF,payload:{positionAssignments:n,tournamentId:e,structureId:a,eventId:o,drawId:s},key:a}),ti({structureIds:[a],drawDefinition:t,tournamentId:e,eventId:o}),{...H}}function yK({tournamentRecord:t,drawDefinition:e,resetEntries:i,event:r}){if(!e)return{error:_e};let n=e.structures?.find(s=>s.stage===Er);if(!n)return{error:Ii};let a=n.matchUps?.map(({matchUpId:s})=>s)||[];return n.positionAssignments=[],n.seedAssignments=[],n.matchUps=[],Pu({tournamentId:t?.tournamentId,action:"resetVoluntaryConsolationStructure",matchUpIds:a,drawDefinition:e}),i&&(e.entries=e.entries.filter(s=>s.entryStage!==Er)),ti({tournamentId:t?.tournamentId,eventId:r?.eventId,drawDefinition:e,structureIds:[n.structureId]}),{...H}}function ZF({drawPositions:t,structure:e}){if([We,xe].includes(e.stage)&&e.stageSequence===1)return;let{positionAssignments:i}=Yt({structure:e});i?.filter(({drawPosition:r})=>t?.includes(r))?.forEach(r=>{xt({element:r,extension:{name:SR,value:!0}})})}function qw(t){let{appliedPolicies:e,positionAction:i,drawDefinition:r}=t;if(e?.audit?.[Bg]===!1)return;let{extension:n}=mt({name:Bg,element:r}),a=Array.isArray(n?.value)?n?.value??[]:[];if(!a?.length){let o=r.structures.find(l=>l.stage===xe);if(o){let l=Yt({structure:o}).positionAssignments?.map(({drawPosition:u,participantId:c,bye:d,qualifier:p})=>({drawPosition:u,participantId:c,qualifier:p,bye:d}));a.push({name:"initialMainAssignments",initialAssignments:l})}}let s={value:a.concat(i),name:Bg};xt({element:r,extension:s})}function lv({tournamentRecord:t,drawDefinition:e,event:i}){let r=(t?.events||i&&[i])?.map(o=>o?.drawDefinitions).flat().filter(Boolean)||e&&[e]||[],n={},a={},s=r.map(o=>o?.structures?.filter(l=>l?.structures)).flat().filter(Boolean);for(let o of s){let{structures:l,structureId:u}=o??{};l&&u&&(n[u]=l?.map(c=>c.structureId))&&l.forEach(c=>a[c.structureId]=o?.structureId)}return{containedStructures:n,containerStructures:a}}function ER(t){let{sides:e,matchUpType:i}=t||{},r=t.potentialParticipants?.length?t.potentialParticipants.flat().map(a=>i===$t?a?.individualParticipantIds||[]:a.participantId).flat():[],n=(e||[]).map(a=>i===$t&&(a?.participant?.individualParticipantIds||[])||a?.participantId&&[a.participantId]||[]).flat();return{individualParticipantIds:n.concat(r).flat(),enteredIndividualParticipantIds:n,potentialIndividualParticipantIds:r}}function Is(t){return t?.tournamentRecords??(t?.tournamentRecord&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord})??{}}var Yw="SIGN_IN_STATUS",bK="SIGNED_OUT",Ub="SIGNED_IN",_n="TEAM",gt="INDIVIDUAL",ja="GROUP",pt="PAIR",Lt="TEAM",Ly={TEAM_PARTICIPANT:_n,INDIVIDUAL:gt,GROUP:ja,TEAM:Lt,PAIR:pt},wK={INDIVIDUAL:gt,GROUP:ja,PAIR:pt,TEAM:Lt,SIGN_IN_STATUS:Yw,SIGNED_OUT:bK,SIGNED_IN:Ub};function RR({participantsProfile:t,participants:e=[],deepCopy:i}){let r=new Map,n=i!==!1?ke(e,t?.convertExtensions,!0):e,a=n.filter(l=>l.participantType===Lt),s=n.filter(l=>l.participantType===ja),o=n.filter(l=>l.participantType===pt);return n.forEach(l=>{if(l.participantType===gt){let{participantId:u}=l;l.groupParticipantIds=[],l.teamParticipantIds=[],l.pairParticipantIds=[],l.groups=[],l.teams=[],a.forEach(c=>{(c?.individualParticipantIds||[]).forEach(d=>{d===u&&!l.teamParticipantIds?.includes(c.participantId)&&(l.teamParticipantIds.push(c.participantId),r.get(c.participantId)||r.set(c.participantId,{participantName:c.participantName,participantId:c.participantId}),l.teams.push({participantRoleResponsibilities:c.participantRoleResponsibilities,participantOtherName:c.participantOtherName,participantName:c.participantName,participantId:c.participantId,teamId:c.teamId}))})}),o.forEach(c=>{(c?.individualParticipantIds||[]).forEach(d=>{d===u&&!l.pairParticipantIds.includes(c.participantId)&&l.pairParticipantIds.push(c.participantId)})}),s.forEach(c=>{(c?.individualParticipantIds||[]).forEach(d=>{d===u&&!l.groupParticipantIds.includes(c.participantId)&&(l.groupParticipantIds.push(c.participantId),l.groups.push({participantRoleResponsibilities:c.participantRoleResponsibilities,participantOtherName:c.participantOtherName,participantName:c.participantName,participantId:c.participantId}))})})}}),{participantsWithGroupings:n,groupInfo:Object.fromEntries(r)}}var im=[{ioc:"",iso2:"",iso:"",label:"NONE",phone:""},{ioc:"AND",iso2:"AD",iso:"AND",label:"Andorra",phone:"376"},{ioc:"UAE",iso2:"AE",iso:"ARE",label:"United Arab Emirates",phone:"971"},{ioc:"AFG",iso2:"AF",iso:"AFG",label:"Afghanistan",phone:"93"},{ioc:"ANT",iso2:"AG",iso:"ATG",label:"Antigua and Barbuda",phone:"1-268"},{ioc:"AIA",iso2:"AI",iso:"AIA",label:"Anguilla",phone:"1-264"},{ioc:"ALB",iso2:"AL",iso:"ALB",label:"Albania",phone:"355"},{ioc:"ARM",iso2:"AM",iso:"ARM",label:"Armenia",phone:"374"},{ioc:"ANG",iso2:"AO",iso:"AGO",label:"Angola",phone:"244"},{ioc:"",iso2:"AQ",iso:"ATA",label:"Antarctica",phone:"672"},{ioc:"ARG",iso2:"AR",iso:"ARG",label:"Argentina",phone:"54"},{ioc:"ASA",iso2:"AS",iso:"ASM",label:"American Samoa",phone:"1-684"},{ioc:"AUT",iso2:"AT",iso:"AUT",label:"Austria",phone:"43"},{ioc:"AUS",iso2:"AU",iso:"AUS",label:"Australia",phone:"61",suggested:!0},{ioc:"ARU",iso2:"AW",iso:"ABW",label:"Aruba",phone:"297"},{ioc:"AZE",iso2:"AZ",iso:"AZE",label:"Azerbaijan",phone:"994"},{ioc:"BIH",iso2:"BA",iso:"BIH",label:"Bosnia and Herzegovina",phone:"387"},{ioc:"BAR",iso2:"BB",iso:"BRB",label:"Barbados",phone:"1-246"},{ioc:"BAN",iso2:"BD",iso:"BGD",label:"Bangladesh",phone:"880"},{ioc:"BEL",iso2:"BE",iso:"BEL",label:"Belgium",phone:"32"},{ioc:"BUR",iso2:"BF",iso:"BFA",label:"Burkina Faso",phone:"226"},{ioc:"BUL",iso2:"BG",iso:"BGR",label:"Bulgaria",phone:"359"},{ioc:"BRN",iso2:"BH",iso:"BHR",label:"Bahrain",phone:"973"},{ioc:"BDI",iso2:"BI",iso:"BDI",label:"Burundi",phone:"257"},{ioc:"BEN",iso2:"BJ",iso:"BEN",label:"Benin",phone:"229"},{ioc:"",iso2:"BL",iso:"BLM",label:"Saint Barthelemy",phone:"590"},{ioc:"BER",iso2:"BM",iso:"BMU",label:"Bermuda",phone:"1-441"},{ioc:"BRU",iso2:"BN",iso:"BRN",label:"Brunei Darussalam",phone:"673"},{ioc:"BOL",iso2:"BO",iso:"BOL",label:"Bolivia",phone:"591"},{ioc:"BRA",iso2:"BR",iso:"BRA",label:"Brazil",phone:"55"},{ioc:"BAH",iso2:"BS",iso:"BHS",label:"Bahamas",phone:"1-242"},{ioc:"BHU",iso2:"BT",iso:"BTN",label:"Bhutan",phone:"975"},{ioc:"",iso2:"BV",iso:"BVT",label:"Bouvet Island",phone:"47"},{ioc:"BOT",iso2:"BW",iso:"BWA",label:"Botswana",phone:"267"},{ioc:"BLR",iso2:"BY",iso:"BLR",label:"Belarus",phone:"375"},{ioc:"BIZ",iso2:"BZ",iso:"BLZ",label:"Belize",phone:"501"},{ioc:"CAN",iso2:"CA",iso:"CAN",label:"Canada",phone:"1",suggested:!0},{ioc:"",iso2:"CC",iso:"CCK",label:"Cocos (Keeling) Islands",phone:"61"},{ioc:"CGO",iso2:"CD",iso:"COG",label:"Congo, Republic of the",phone:"242"},{ioc:"CAF",iso2:"CF",iso:"CAF",label:"Central African Republic",phone:"236"},{ioc:"COD",iso2:"CG",iso:"CGD",label:"Congo, Democratic Republic of the",phone:"243"},{ioc:"SUI",iso2:"CH",iso:"CHE",label:"Switzerland",phone:"41"},{ioc:"CIV",iso2:"CI",iso:"CIV",label:"Cote d'Ivoire",phone:"225"},{ioc:"COK",iso2:"CK",iso:"COK",label:"Cook Islands",phone:"682"},{ioc:"CHI",iso2:"CL",iso:"CHL",label:"Chile",phone:"56"},{ioc:"CMR",iso2:"CM",iso:"CMR",label:"Cameroon",phone:"237"},{ioc:"CHN",iso2:"CN",iso:"CHN",label:"China",phone:"86"},{ioc:"COL",iso2:"CO",iso:"COL",label:"Colombia",phone:"57"},{ioc:"CRC",iso2:"CR",iso:"CRI",label:"Costa Rica",phone:"506"},{ioc:"CUB",iso2:"CU",iso:"CUB",label:"Cuba",phone:"53"},{ioc:"CPV",iso2:"CV",iso:"CPV",label:"Cape Verde",phone:"238"},{ioc:"CUW",iso2:"CW",iso:"CUW",label:"Curacao",phone:"599"},{ioc:"CXR",iso2:"CX",iso:"CXR",label:"Christmas Island",phone:"61"},{ioc:"CYP",iso2:"CY",iso:"CYP",label:"Cyprus",phone:"357"},{ioc:"CZE",iso2:"CZ",iso:"CZE",label:"Czech Republic",phone:"420"},{ioc:"GER",iso2:"DE",iso:"DEU",label:"Germany",phone:"49",suggested:!0},{ioc:"DJI",iso2:"DJ",iso:"DJI",label:"Djibouti",phone:"253"},{ioc:"DEN",iso2:"DK",iso:"DNK",label:"Denmark",phone:"45"},{ioc:"DMA",iso2:"DM",iso:"DMA",label:"Dominica",phone:"1-767"},{ioc:"DOM",iso2:"DO",iso:"DOM",label:"Dominican Republic",phone:"1-809"},{ioc:"ALG",iso2:"DZ",iso:"DZA",label:"Algeria",phone:"213"},{ioc:"ECU",iso2:"EC",iso:"ECU",label:"Ecuador",phone:"593"},{ioc:"EST",iso2:"EE",iso:"ESE",label:"Estonia",phone:"372"},{ioc:"EGY",iso2:"EG",iso:"EGY",label:"Egypt",phone:"20"},{ioc:"",iso2:"EH",iso:"ESH",label:"Western Sahara",phone:"212"},{ioc:"ERI",iso2:"ER",iso:"ERI",label:"Eritrea",phone:"291"},{ioc:"ESP",iso2:"ES",iso:"ESP",label:"Spain",phone:"34"},{ioc:"ETH",iso2:"ET",iso:"ETH",label:"Ethiopia",phone:"251"},{ioc:"FIN",iso2:"FI",iso:"FIN",label:"Finland",phone:"358"},{ioc:"FIJ",iso2:"FJ",iso:"FJI",label:"Fiji",phone:"679"},{ioc:"FLK",iso2:"FK",iso:"FLK",label:"Falkland Islands (Malvinas)",phone:"500"},{ioc:"FSM",iso2:"FM",iso:"FSM",label:"Micronesia, Federated States of",phone:"691"},{ioc:"FAR",iso2:"FO",iso:"FRO",label:"Faroe Islands",phone:"298"},{ioc:"FRA",iso2:"FR",iso:"FRA",label:"France",phone:"33",suggested:!0},{ioc:"GAB",iso2:"GA",iso:"GAB",label:"Gabon",phone:"241"},{ioc:"GBR",iso2:"GB",iso:"GBR",label:"United Kingdom",phone:"44"},{ioc:"GRN",iso2:"GD",iso:"GRD",label:"Grenada",phone:"1-473"},{ioc:"GEO",iso2:"GE",iso:"GEO",label:"Georgia",phone:"995"},{ioc:"FGU",iso2:"GF",iso:"GUF",label:"French Guiana",phone:"594"},{ioc:"",iso2:"GG",iso:"GGY",label:"Guernsey",phone:"44"},{ioc:"",iso2:"GH",iso:"GHA",label:"Ghana",phone:"233"},{ioc:"GIB",iso2:"GI",iso:"GIB",label:"Gibraltar",phone:"350"},{ioc:"GRL",iso2:"GL",iso:"GRL",label:"Greenland",phone:"299"},{ioc:"GAM",iso2:"GM",iso:"GMB",label:"Gambia",phone:"220"},{ioc:"GUI",iso2:"GN",iso:"GIN",label:"Guinea",phone:"224"},{ioc:"GUD",iso2:"GP",iso:"GLP",label:"Guadeloupe",phone:"590"},{ioc:"GEQ",iso2:"GQ",iso:"GNQ",label:"Equatorial Guinea",phone:"240"},{ioc:"GRE",iso2:"GR",iso:"GRC",label:"Greece",phone:"30"},{ioc:"",iso2:"GS",iso:"SGS",label:"South Georgia and the South Sandwich Islands",phone:"500"},{ioc:"GUA",iso2:"GT",iso:"GTM",label:"Guatemala",phone:"502"},{ioc:"GUM",iso2:"GU",iso:"GUM",label:"Guam",phone:"1-671"},{ioc:"GBS",iso2:"GW",iso:"GNB",label:"Guinea-Bissau",phone:"245"},{ioc:"GUY",iso2:"GY",iso:"GUY",label:"Guyana",phone:"592"},{ioc:"HKG",iso2:"HK",iso:"HKG",label:"Hong Kong",phone:"852"},{ioc:"",iso2:"HM",iso:"HMD",label:"Heard Island and McDonald Islands",phone:"672"},{ioc:"HON",iso2:"HN",iso:"HND",label:"Honduras",phone:"504"},{ioc:"CRO",iso2:"HR",iso:"HRV",label:"Croatia",phone:"385"},{ioc:"HAI",iso2:"HT",iso:"HTI",label:"Haiti",phone:"509"},{ioc:"HUN",iso2:"HU",iso:"HUN",label:"Hungary",phone:"36"},{ioc:"INA",iso2:"ID",iso:"IDN",label:"Indonesia",phone:"62"},{ioc:"IRL",iso2:"IE",iso:"IRL",label:"Ireland",phone:"353"},{ioc:"ISR",iso2:"IL",iso:"ISR",label:"Israel",phone:"972"},{ioc:"",iso2:"IM",iso:"IMN",label:"Isle of Man",phone:"44"},{ioc:"IND",iso2:"IN",iso:"IND",label:"India",phone:"91"},{ioc:"",iso2:"IO",iso:"IOT",label:"British Indian Ocean Territory",phone:"246"},{ioc:"IRQ",iso2:"IQ",iso:"IRQ",label:"Iraq",phone:"964"},{ioc:"IRI",iso2:"IR",iso:"IRN",label:"Iran, Islamic Republic of",phone:"98"},{ioc:"ISL",iso2:"IS",iso:"ISL",label:"Iceland",phone:"354"},{ioc:"ITA",iso2:"IT",iso:"ITA",label:"Italy",phone:"39"},{ioc:"",iso2:"JE",iso:"JEY",label:"Jersey",phone:"44"},{ioc:"JAM",iso2:"JM",iso:"JAM",label:"Jamaica",phone:"1-876"},{ioc:"JOR",iso2:"JO",iso:"JOR",label:"Jordan",phone:"962"},{ioc:"JPN",iso2:"JP",iso:"JPN",label:"Japan",phone:"81",suggested:!0},{ioc:"KEN",iso2:"KE",iso:"KEN",label:"Kenya",phone:"254"},{ioc:"KGZ",iso2:"KG",iso:"KGZ",label:"Kyrgyzstan",phone:"996"},{ioc:"CAM",iso2:"KH",iso:"KHM",label:"Cambodia",phone:"855"},{ioc:"KIR",iso2:"KI",iso:"KIR",label:"Kiribati",phone:"686"},{ioc:"COM",iso2:"KM",iso:"COM",label:"Comoros",phone:"269"},{ioc:"SKN",iso2:"KN",iso:"KNA",label:"Saint Kitts and Nevis",phone:"1-869"},{ioc:"KOR",iso2:"KP",iso:"KOR",label:"Korea, Democratic People's Republic of",phone:"850"},{ioc:"PRK",iso2:"KR",iso:"PRK",label:"Korea, Republic of",phone:"82"},{ioc:"KUW",iso2:"KW",iso:"KWT",label:"Kuwait",phone:"965"},{ioc:"CAY",iso2:"KY",iso:"CYM",label:"Cayman Islands",phone:"1-345"},{ioc:"KAZ",iso2:"KZ",iso:"KAZ",label:"Kazakhstan",phone:"7"},{ioc:"LAO",iso2:"LA",iso:"LAO",label:"Lao People's Democratic Republic",phone:"856"},{ioc:"LIB",iso2:"LB",iso:"LBN",label:"Lebanon",phone:"961"},{ioc:"LCA",iso2:"LC",iso:"LCA",label:"Saint Lucia",phone:"1-758"},{ioc:"LIE",iso2:"LI",iso:"LIE",label:"Liechtenstein",phone:"423"},{ioc:"SRI",iso2:"LK",iso:"LKA",label:"Sri Lanka",phone:"94"},{ioc:"LBR",iso2:"LR",iso:"LBR",label:"Liberia",phone:"231"},{ioc:"LES",iso2:"LS",iso:"LSO",label:"Lesotho",phone:"266"},{ioc:"LTU",iso2:"LT",iso:"LTU",label:"Lithuania",phone:"370"},{ioc:"LUX",iso2:"LU",iso:"LUX",label:"Luxembourg",phone:"352"},{ioc:"LAT",iso2:"LV",iso:"LVA",label:"Latvia",phone:"371"},{ioc:"LBA",iso2:"LY",iso:"LBY",label:"Libya",phone:"218"},{ioc:"MAR",iso2:"MA",iso:"MAR",label:"Morocco",phone:"212"},{ioc:"MON",iso2:"MC",iso:"MCO",label:"Monaco",phone:"377"},{ioc:"MDA",iso2:"MD",iso:"MDA",label:"Moldova, Republic of",phone:"373"},{ioc:"MNE",iso2:"ME",iso:"MNE",label:"Montenegro",phone:"382"},{ioc:"",iso2:"MF",iso:"MAF",label:"Saint Martin (French part)",phone:"590"},{ioc:"MAD",iso2:"MG",iso:"MDG",label:"Madagascar",phone:"261"},{ioc:"MSH",iso2:"MH",iso:"MHL",label:"Marshall Islands",phone:"692"},{ioc:"MKD",iso2:"MK",iso:"MKD",label:"Macedonia, the Former Yugoslav Republic of",phone:"389"},{ioc:"MLI",iso2:"ML",iso:"MLI",label:"Mali",phone:"223"},{ioc:"MYA",iso2:"MM",iso:"MMR",label:"Myanmar",phone:"95"},{ioc:"MGL",iso2:"MN",iso:"MNG",label:"Mongolia",phone:"976"},{ioc:"MAC",iso2:"MO",iso:"MAC",label:"Macao",phone:"853"},{ioc:"NMA",iso2:"MP",iso:"NMP",label:"Northern Mariana Islands",phone:"1-670"},{ioc:"MRT",iso2:"MQ",iso:"MTQ",label:"Martinique",phone:"596"},{ioc:"MTN",iso2:"MR",iso:"MRT",label:"Mauritania",phone:"222"},{ioc:"MNT",iso2:"MS",iso:"MSR",label:"Montserrat",phone:"1-664"},{ioc:"MLT",iso2:"MT",iso:"MLT",label:"Malta",phone:"356"},{ioc:"MRI",iso2:"MU",iso:"MUS",label:"Mauritius",phone:"230"},{ioc:"MDV",iso2:"MV",iso:"MDV",label:"Maldives",phone:"960"},{ioc:"MAW",iso2:"MW",iso:"MWI",label:"Malawi",phone:"265"},{ioc:"MEX",iso2:"MX",iso:"MEX",label:"Mexico",phone:"52"},{ioc:"MAS",iso2:"MY",iso:"MYS",label:"Malaysia",phone:"60"},{ioc:"MOZ",iso2:"MZ",iso:"MOZ",label:"Mozambique",phone:"258"},{ioc:"NAM",iso2:"NA",iso:"NAM",label:"Namibia",phone:"264"},{ioc:"NCL",iso2:"NC",iso:"NCL",label:"New Caledonia",phone:"687"},{ioc:"NIG",iso2:"NE",iso:"NER",label:"Niger",phone:"227"},{ioc:"NFI",iso2:"NF",iso:"NFK",label:"Norfolk Island",phone:"672"},{ioc:"NGR",iso2:"NG",iso:"NGA",label:"Nigeria",phone:"234"},{ioc:"NCA",iso2:"NI",iso:"NIC",label:"Nicaragua",phone:"505"},{ioc:"NED",iso2:"NL",iso:"NLD",label:"Netherlands",phone:"31"},{ioc:"NOR",iso2:"NO",iso:"NOR",label:"Norway",phone:"47"},{ioc:"NEP",iso2:"NP",iso:"NPL",label:"Nepal",phone:"977"},{ioc:"NRU",iso2:"NR",iso:"NRU",label:"Nauru",phone:"674"},{ioc:"NIU",iso2:"NU",iso:"NIU",label:"Niue",phone:"683"},{ioc:"NZL",iso2:"NZ",iso:"NZL",label:"New Zealand",phone:"64"},{ioc:"OMA",iso2:"OM",iso:"OMN",label:"Oman",phone:"968"},{ioc:"PAN",iso2:"PA",iso:"PAN",label:"Panama",phone:"507"},{ioc:"PER",iso2:"PE",iso:"PER",label:"Peru",phone:"51"},{ioc:"FPO",iso2:"PF",iso:"PYF",label:"French Polynesia",phone:"689"},{ioc:"PNG",iso2:"PG",iso:"PNG",label:"Papua New Guinea",phone:"675"},{ioc:"PHI",iso2:"PH",iso:"PHL",label:"Philippines",phone:"63"},{ioc:"PAK",iso2:"PK",iso:"PAK",label:"Pakistan",phone:"92"},{ioc:"POL",iso2:"PL",iso:"POL",label:"Poland",phone:"48"},{ioc:"SPM",iso2:"PM",iso:"SPM",label:"Saint Pierre and Miquelon",phone:"508"},{ioc:"",iso2:"PN",iso:"PCN",label:"Pitcairn",phone:"870"},{ioc:"PUR",iso2:"PR",iso:"PRI",label:"Puerto Rico",phone:"1"},{ioc:"PLE",iso2:"PS",iso:"PSE",label:"Palestine, State of",phone:"970"},{ioc:"POR",iso2:"PT",iso:"PRT",label:"Portugal",phone:"351"},{ioc:"PLW",iso2:"PW",iso:"PLW",label:"Palau",phone:"680"},{ioc:"PAR",iso2:"PY",iso:"PRY",label:"Paraguay",phone:"595"},{ioc:"QAT",iso2:"QA",iso:"QAT",label:"Qatar",phone:"974"},{ioc:"REU",iso2:"RE",iso:"REU",label:"Reunion",phone:"262"},{ioc:"ROU",iso2:"RO",iso:"ROU",label:"Romania",phone:"40"},{ioc:"SRB",iso2:"RS",iso:"SRB",label:"Serbia",phone:"381"},{ioc:"RUS",iso2:"RU",iso:"RUS",label:"Russia",phone:"7"},{ioc:"RWA",iso2:"RW",iso:"RWA",label:"Rwanda",phone:"250"},{ioc:"KSA",iso2:"SA",iso:"SAU",label:"Saudi Arabia",phone:"966"},{ioc:"SOL",iso2:"SB",iso:"SLB",label:"Solomon Islands",phone:"677"},{ioc:"SEY",iso2:"SC",iso:"SYC",label:"Seychelles",phone:"248"},{ioc:"SUD",iso2:"SD",iso:"SDN",label:"Sudan",phone:"249"},{ioc:"SWE",iso2:"SE",iso:"SWE",label:"Sweden",phone:"46"},{ioc:"SIN",iso2:"SG",iso:"SGP",label:"Singapore",phone:"65"},{ioc:"HEL",iso2:"SH",iso:"SHN",label:"Saint Helena",phone:"290"},{ioc:"SLO",iso2:"SI",iso:"SVN",label:"Slovenia",phone:"386"},{ioc:"",iso2:"SJ",iso:"SJM",label:"Svalbard and Jan Mayen",phone:"47"},{ioc:"SVK",iso2:"SK",iso:"SVK",label:"Slovakia",phone:"421"},{ioc:"SLE",iso2:"SL",iso:"SLE",label:"Sierra Leone",phone:"232"},{ioc:"SMR",iso2:"SM",iso:"SMR",label:"San Marino",phone:"378"},{ioc:"SEN",iso2:"SN",iso:"SEN",label:"Senegal",phone:"221"},{ioc:"SOM",iso2:"SO",iso:"SOM",label:"Somalia",phone:"252"},{ioc:"SUR",iso2:"SR",iso:"SUR",label:"Suriname",phone:"597"},{ioc:"",iso2:"SS",iso:"SSD",label:"South Sudan",phone:"211"},{ioc:"STP",iso2:"ST",iso:"STP",label:"Sao Tome and Principe",phone:"239"},{ioc:"ESA",iso2:"SV",iso:"SLV",label:"El Salvador",phone:"503"},{ioc:"",iso2:"SX",iso:"SMX",label:"Sint Maarten",phone:"1-721"},{ioc:"SYR",iso2:"SY",iso:"SYR",label:"Syria",phone:"963"},{ioc:"",iso2:"SZ",iso:"SWZ",label:"Swaziland",phone:"268"},{ioc:"TKS",iso2:"TC",iso:"TCA",label:"Turks and Caicos Islands",phone:"1-649"},{ioc:"CHA",iso2:"TD",iso:"TCD",label:"Chad",phone:"235"},{ioc:"",iso2:"TF",iso:"ATF",label:"French Southern Territories",phone:"262"},{ioc:"TOG",iso2:"TG",iso:"TGO",label:"Togo",phone:"228"},{ioc:"THA",iso2:"TH",iso:"THA",label:"Thailand",phone:"66"},{ioc:"TJK",iso2:"TJ",iso:"TJK",label:"Tajikistan",phone:"992"},{ioc:"",iso2:"TK",iso:"TKL",label:"Tokelau",phone:"690"},{ioc:"TLS",iso2:"TL",iso:"TLS",label:"Timor-Leste",phone:"670"},{ioc:"TKM",iso2:"TM",iso:"TKM",label:"Turkmenistan",phone:"993"},{ioc:"TUN",iso2:"TN",iso:"TUN",label:"Tunisia",phone:"216"},{ioc:"TGA",iso2:"TO",iso:"TON",label:"Tonga",phone:"676"},{ioc:"TUR",iso2:"TR",iso:"TUR",label:"Turkey",phone:"90"},{ioc:"TTO",iso2:"TT",iso:"TTO",label:"Trinidad and Tobago",phone:"1-868"},{ioc:"TUV",iso2:"TV",iso:"TUV",label:"Tuvalu",phone:"688"},{ioc:"TPE",iso2:"TW",iso:"TWN",label:"Taiwan",phone:"886"},{ioc:"TAN",iso2:"TZ",iso:"TZA",label:"United Republic of Tanzania",phone:"255"},{ioc:"UKR",iso2:"UA",iso:"UKR",label:"Ukraine",phone:"380"},{ioc:"UGA",iso2:"UG",iso:"UGA",label:"Uganda",phone:"256"},{ioc:"USA",iso2:"US",label:"United States",phone:"1",suggested:!0,iso:"USA"},{ioc:"URU",iso2:"UY",iso:"URY",label:"Uruguay",phone:"598"},{ioc:"UZB",iso2:"UZ",iso:"UZB",label:"Uzbekistan",phone:"998"},{ioc:"",iso2:"VA",iso:"VAT",label:"Holy See (Vatican City State)",phone:"379"},{ioc:"VIN",iso2:"VC",iso:"VCT",label:"Saint Vincent and the Grenadines",phone:"1-784"},{ioc:"VEN",iso2:"VE",iso:"VEN",label:"Venezuela",phone:"58"},{ioc:"IVB",iso2:"VG",iso:"VGB",label:"British Virgin Islands",phone:"1-284"},{ioc:"ISV",iso2:"VI",iso:"VIR",label:"US Virgin Islands",phone:"1-340"},{ioc:"VIE",iso2:"VN",iso:"VNM",label:"Vietnam",phone:"84"},{ioc:"VAN",iso2:"VU",iso:"VUT",label:"Vanuatu",phone:"678"},{ioc:"WAF",iso2:"WF",iso:"WLF",label:"Wallis and Futuna",phone:"681"},{ioc:"SAM",iso2:"WS",iso:"WSM",label:"Samoa",phone:"685"},{ioc:"KOS",iso2:"XK",iso:"KOS",label:"Kosovo",phone:"383"},{ioc:"YEM",iso2:"YE",iso:"YEM",label:"Yemen",phone:"967"},{ioc:"MAY",iso2:"YT",iso:"MYT",label:"Mayotte",phone:"262"},{ioc:"RSA",iso2:"ZA",iso:"ZAF",label:"South Africa",phone:"27"},{ioc:"ZAM",iso2:"ZM",iso:"ZMB",label:"Zambia",phone:"260"},{ioc:"ZIM",iso2:"ZW",iso:"ZWE",label:"Zimbabwe",phone:"263"}];function SK({participant:t,withISO2:e,withIOC:i}){let{person:r,individualParticipants:n}=t,a=[r,n?.map(({person:o})=>o)].flat().filter(Boolean);function s(o){let{nationalityCode:l}=o||{};if(l){let u=im.find(({iso:c})=>c===l);i&&u?.ioc&&!o.iocNationalityCode&&(o.iocNationalityCode=u.ioc),e&&u?.iso2&&!o.iso2NationalityCode&&(o.iso2NationalityCode=u.iso2),u?.label&&!o.countryName&&(o.countryName=u.label)}}a.forEach(s)}function kye({participantMap:t,template:e}){let i=Object.values(t);for(let r of i){let n=r.participant;if(n.individualParticipantIds?.length){n.individualParticipants=[];for(let a of n.individualParticipantIds){let s=t[a].participant;n.individualParticipants.push(e?Rm({template:e,source:s}):s)}}}}function $d(t){let{tournamentRecord:e,participantId:i}=t,r=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};for(let n of Object.values(r)){let a=n.participants?.find(s=>s.participantId===i);if(a)return{participant:a,tournamentId:n.tournamentId}}return{error:Vi}}function UK(t){let{tournamentRecord:e,participantId:i}=t;if(i){let n=$d({tournamentRecord:e,participantId:i});return n.participant??n}return t.element||t.drawDefinition||t.event||t.tournamentRecord||{error:Xe}}function vs(t){let{returnPreviousValues:e,itemSubTypes:i,itemType:r}=t,n=UK(t);if(n.error)return n;if(i&&!Array.isArray(i))return{error:ie,context:{itemSubTypes:i}};if(!Array.isArray(n.timeItems))return{error:Z1};let a=n.timeItems.filter(o=>o?.itemType===r).filter(o=>!i?.length||i.some(l=>o?.itemSubTypes?.includes(l))).sort((o,l)=>{let u=new Date(o.createdAt||void 0).getTime(),c=new Date(l.createdAt||void 0).getTime();return u-c}),s=ke(a.pop(),!1,!0);if(s){let o={timeItem:s,...H};return e&&Object.assign(o,{previousItems:a}),o}else return{info:_r}}function eL({returnPreviousValues:t,drawDefinition:e,itemSubTypes:i,itemType:r}){if(!e)return{error:Oo};if(!e.timeItems)return{info:_r};let{timeItem:n,previousItems:a,info:s}=vs({element:e,returnPreviousValues:t,itemSubTypes:i,itemType:r});return n&&{timeItem:n,previousItems:a}||{info:s}}function Kw({returnPreviousValues:t,itemSubTypes:e,itemType:i,event:r}){if(!r)return{error:li};if(!r.timeItems)return{info:_r};let{timeItem:n,previousItems:a,info:s}=vs({returnPreviousValues:t,element:r,itemSubTypes:e,itemType:i});return n&&{timeItem:n,previousItems:a}||{info:s}}function CR({returnPreviousValues:t,tournamentRecord:e,itemSubTypes:i,itemType:r}){if(!e)return{error:Ie};if(!e.timeItems)return{info:_r};let{timeItem:n,previousItems:a,info:s}=vs({element:e,returnPreviousValues:t,itemSubTypes:i,itemType:r});return n&&{timeItem:n,previousItems:a}||{info:s}}function tL({returnPreviousValues:t,tournamentRecord:e,participantId:i,itemSubTypes:r,itemType:n}){if(!e)return{error:Ie};if(!i)return{error:lr};let a=$d({tournamentRecord:e,participantId:i});if(a.error)return a;let{participant:s}=a;if(!s?.timeItems)return{info:_r};let{timeItem:o,previousItems:l,info:u}=vs({element:a.participant,returnPreviousValues:t,itemSubTypes:r,itemType:n});return o&&{timeItem:o,previousItems:l}||{info:u}}var Oye={[ja]:"groupParticipantIds",[pt]:"pairParticipantIds",[Lt]:"teamParticipantIds"},xye={[ja]:"groups",[Lt]:"teams"};function TK({withIndividualParticipants:t,convertExtensions:e,tournamentRecord:i,withSignInStatus:r,withScaleValues:n,withGroupings:a,internalUse:s,withISO2:o,withIOC:l}){let u=[],c={};for(let p of i.participants??[]){let f=p?.participantId;f&&_ye({participantMap:c,participantId:f})}for(let p of i.participants??[]){let f=ke(p,e,s),{participantId:m,individualParticipantIds:h,participantType:g}=f;if(!c[m]){u.push(m);continue}if(Object.assign(c[m].participant,f),h){let I=Lye({individualParticipantIds:h,participantCopy:f,participantMap:c,participantType:g,participantId:m});I.missingParticipantIds.length&&u.push(...I.missingParticipantIds)}if(r&&(c[m].participant.signedIn=Fye(f)),n){let{ratings:I,rankings:v,seedings:w}=av({participant:f});c[m].participant.seedings=w,c[m].participant.rankings=v,c[m].participant.ratings=I}(l||o)&&SK({participant:c[m].participant,withISO2:o,withIOC:l})}if(t){let p=bt(t)?t:void 0;kye({participantMap:c,template:p})}let d;return a&&(d=RR({participants:Object.values(c).map(({participant:p})=>p),participantsProfile:{convertExtensions:e},deepCopy:!1}).groupInfo),{missingParticipantIds:u,participantMap:c,groupInfo:d}}function Fye(t){let{timeItem:e}=vs({itemType:Yw,element:t});return e?.itemValue===Ub}function Lye({individualParticipantIds:t,participantCopy:e,participantMap:i,participantType:r,participantId:n}){let a=[];for(let s of t){let o=i[s]?.participant;if(!o){a.push(s);continue}if(o[Oye[r]].push(n),[Lt,ja].includes(r)){let{participantRoleResponsibilities:l,participantOtherName:u,participantName:c,participantId:d,teamId:p}=e,f=xye[r];o[f].push({participantRoleResponsibilities:l,participantOtherName:u,participantName:c,participantId:d,teamId:p})}if(r===pt){let l=t.find(u=>u!==s);i[s].pairIdMap[n]=l,i[s].pairIdMap[l]=n}}return{missingParticipantIds:a}}function _ye({participantMap:t,participantId:e}){if(t[e])return;let i={walkoverWins:0,defaultWins:0,walkovers:0,defaults:0,losses:0,wins:0};t[e]={structureParticipation:{},potentialMatchUps:{},scheduleConflicts:{},scheduleItems:[],participant:{groupParticipantIds:[],pairParticipantIds:[],teamParticipantIds:[],seedings:{},rankings:{},ratings:{},groups:[],teams:[]},statistics:{},opponents:{},pairIdMap:{},matchUps:{},events:{},draws:{},counters:{[Wt]:{...i},[$t]:{...i},[Lt]:{...i},...i}}}function af({participantsProfile:t,useParticipantMap:e,tournamentRecord:i,contextProfile:r,inContext:n}){if(e)return TK({...t,...r,tournamentRecord:i});let a=ke(i.participants,!1,!0)||[];(t?.withIOC||t?.withISO2)&&a.forEach(o=>SK({participant:o,...t}));let s;if((n||t?.withGroupings)&&a?.length&&({participantsWithGroupings:a,groupInfo:s}=RR({participantsProfile:t,deepCopy:!1,participants:a})),t?.withScaleValues&&a?.length)for(let o of a){let{ratings:l,rankings:u}=av({participant:o});o.rankings=u,o.ratings=l}return{participants:a,groupInfo:s}}function Tt({onlySpecifiedPolicyTypes:t=!1,policyTypes:e=[],tournamentRecord:i,drawDefinition:r,structure:n,event:a}){if(!Array.isArray(e))return{error:j1};let s={};return i&&o(i),a&&o(a),r&&o(r),n&&o(n),{appliedPolicies:s,...H};function o(l){let u=l?.extensions?.find(c=>c.name===wb)?.value;if(u)for(let c of Object.keys(u))(t?e.includes(c):!e.length||e.includes(c))&&(s[c]=ke(u[c],!1,!0))}}function Fc({policyTypes:t=[],tournamentRecord:e,drawDefinition:i,structure:r,event:n}){if(!Array.isArray(t))return{error:j1};let{appliedPolicies:a}=Tt({tournamentRecord:e,drawDefinition:i,structure:r,event:n}),s={};for(let o of t){let l=a?.[o];l&&(s[o]=l)}return Object.keys(s).length?{policyDefinitions:s}:{info:Nw.message}}var DK="WALKOVER",_H="RETIRED",iL="COMPETITIVE",Tb="ROUTINE",Db="DECISIVE",KT="winRatio",$ye={[Gu]:{policyName:"Competitive Bands Default",profileBands:{[Db]:20,[Tb]:50}}},rL=$ye;function Lc({policyDefinitions:t,tournamentRecord:e,contextProfile:i,drawDefinition:r,event:n}){let a={policies:{}};if(!i)return a;let s=Fc({tournamentRecord:e,drawDefinition:r,event:n}).policyDefinitions;if(i.withCompetitiveness){let o=t?.[Gu]??s?.[Gu]??rL[Gu];a.policies[Gu]=o}return a}function sf({tournamentRecord:t,drawDefinition:e,policyType:i,structure:r,event:n}){if(!t)return{error:Ie};let{appliedPolicies:a}=Tt({tournamentRecord:t,drawDefinition:e,structure:r,event:n});return a?.[i]?{policy:a[i]}:{info:Nw?.message}}function Xw({tournamentRecord:t,categoryName:e,categoryType:i,event:r}){e=e??r?.category?.categoryName??r?.category?.ageCategoryCode,i=i??r?.category?.categoryType??r?.category?.subType;let{policy:n}=sf({policyType:Fd,tournamentRecord:t,event:r}),a=(t?mt({element:t,name:dc}).extension:void 0)?.value,s=(r&&mt({name:dc,element:r}).extension)?.value;return{scheduleTiming:{tournamentScheduling:a,eventScheduling:s,categoryName:e,categoryType:i,policy:n}}}function nL({drawDefinition:t,attributes:e}){let{extension:i}=mt({element:t,name:JD}),r=i?.value||{};return e.forEach(n=>{Object.keys(n).forEach(a=>{r[a]?Object.assign(r[a],n[a]):r[a]=n[a]})}),i={name:JD,value:r},yR({drawDefinition:t,extension:i}),{entryProfile:r}}function Jw({drawDefinition:t}){let{extension:e}=mt({element:t,name:JD});return{entryProfile:e?.value||{}}}var Fs="ALTERNATE",Qw="CONFIRMED",aa="DIRECT_ACCEPTANCE",Zw="FEED_IN",eS="JUNIOR_EXEMPT",mc="LUCKY_LOSER",tS="ORGANISER_ACCEPTANCE",iS="QUALIFIER",Bye="REGISTERED",rS="SPECIAL_EXEMPT",ys="UNGROUPED",of="UNPAIRED",sI="WILDCARD",hc="WITHDRAWN",XT=[Qw,aa,eS,tS,rS],PK=[Zw,mc,iS],lf=[Qw,aa,Zw,eS,tS,rS,sI],so=[Qw,aa,eS,mc,iS,tS,rS,sI],EK=[Fs,Qw,aa,Zw,eS,mc,tS,iS,Bye,rS,ys,of,sI,hc],Vye={ALTERNATE:Fs,CONFIRMED:Qw,DIRECT_ACCEPTANCE:aa,DIRECT_ENTRY_STATUSES:lf,DRAW_SPECIFIC_STATUSES:PK,EQUIVALENT_ACCEPTANCE_STATUSES:XT,FEED_IN:Zw,JUNIOR_EXEMPT:eS,LUCKY_LOSER:mc,ORGANISER_ACCEPTANCE:tS,QUALIFIER:iS,SPECIAL_EXEMPT:rS,STRUCTURE_SELECTED_STATUSES:so,UNGROUPED:ys,UNPAIRED:of,VALID_ENTRY_STATUSES:EK,WILDCARD:sI,WITHDRAWN:hc};function aL({stage:t,drawDefinition:e}){let{entryProfile:i}=Jw({drawDefinition:e}),r=Object.keys(i).includes(t);if(!r&&sR.includes(t)){let n=[{[t]:{drawSize:void 0,alternates:!0}}];return nL({drawDefinition:e,attributes:n}),!0}return r}function jye({stage:t,drawDefinition:e}){let{entryProfile:i}=Jw({drawDefinition:e});return i[t]?.alternates||0}function Gye({stage:t,drawDefinition:e}){let{entryProfile:i}=Jw({drawDefinition:e});return i[t]?.wildcardsCount||0}function fO({stage:t,drawDefinition:e,entryStatus:i}){return e.entries.reduce((r,n)=>n.entryStage===t&&n.entryStatus===i?r+1:r,0)}function dh({provisionalPositioning:t,placementGroup:e,drawDefinition:i,stageSequence:r,entryStatuses:n,structureId:a,roundTarget:s,stages:o,stage:l}){let u=i.entries?.reduce((c,d)=>{let p=mt({name:Tl,element:d})?.extension?.value,f=l&&d.entryStage===l||o?.length&&d.entryStage&&o.includes(d.entryStage),m=!n||d.entryStatus&&n.includes(d.entryStatus),h=d.entryStageSequence??1;return f&&(!r||h===r)&&m&&(!s||!p||s===p)?c.concat(d):c},[])??[];if(a&&l===Ui){let{playoffEntries:c,error:d}=Hye({provisionalPositioning:t,drawDefinition:i,structureId:a});return d&&console.log("playoff entries error"),(c?.length?c:u).filter(p=>!e||p.placementGroup===e)}return u}function Hye({provisionalPositioning:t,drawDefinition:e,structureId:i}){let r=[],n=(e.links??[]).find(a=>a.linkType===iu&&a.target.structureId===i);if(n){let{finishingPositions:a,structureId:s}=n.source,{structure:o}=et({drawDefinition:e,structureId:s});o?.structureType===fn&&(o.structures??[]).forEach(l=>{let u=l.positionAssignments??[],{structureId:c}=l,d=c,p=Object.assign({},...u.map(h=>{let{participantId:g}=h,I=mt({element:h,name:pc}).extension?.value;return I&&g?{[g]:I}:void 0}).filter(Boolean)),f=Object.keys(p).reduce((h,g)=>{let I=p[g],v=I.groupOrder||t&&I.provisionalOrder;return h.includes(v)||h.push(v),h},[]).length===Object.keys(p).length,m=Object.keys(p).filter(h=>{let g=p[h],I=g.groupOrder||t&&g.provisionalOrder;return a?.includes(I)});(!t||f)&&m.forEach(h=>{let g=p[h],{groupOrder:I,provisionalOrder:v,GEMscore:w}=g,y=I||t&&v,b=[...a??[]].sort(ir).indexOf(y)+1;r.push({entryStage:Ui,entryStatus:Zw,placementGroup:b,groupingValue:d,participantId:h,GEMscore:w})})})}return{playoffEntries:r}}function Wye({stage:t,drawDefinition:e}){return lf.reduce((i,r)=>(fO({drawDefinition:e,entryStatus:r,stage:t})||0)+i,0)}function ds({provisionalPositioning:t,returnAllProxies:e,drawDefinition:i,structureId:r,structure:n}){let a,s=[];n||({structure:n,error:a}=et({drawDefinition:i,structureId:r}));let o=Yt({structure:n}).positionAssignments;if(a||!n)return{seedAssignments:[],error:Ii};r||(r=n.structureId);let{stage:l,stageSequence:u}=n,c=l===Ui&&i&&dh({provisionalPositioning:t,drawDefinition:i,stageSequence:u,structureId:r,stage:l}),d=c?c.filter(m=>m.placementGroup===1).sort((m,h)=>m.GEMscore<h.GEMscore&&1||m.GEMscore>h.GEMscore&&-1||0).map((m,h)=>{let g=h+1;return{participantId:m.participantId,seedValue:g,seedProxy:!0,seedNumber:g}}):[],p=d?.slice(0,e?d.length:o.length/2);p.length?s=p:n.seedAssignments?s=n.seedAssignments:a=S6;let f=n.seedLimit??n?.positionAssignments?.length;return{seedAssignments:s,stageSequence:u,seedLimit:f,stage:l,error:a}}function $o(t){if(!t)return;let{tieFormatId:e,tieFormats:i}=t;if(t.tieFormat)return t.tieFormat;if(e&&Array.isArray(i))return i.find(r=>r.tieFormatId===e)}function _y({item:t,drawDefinition:e,structure:i,event:r}){if(t){if(t.tieFormat)return t.tieFormat;if(t.tieFormatId)return e.tieFormat?e.tieFormat:e.tieFormats?.find(a=>t.tieFormatId===a.tieFormatId)||(r.tieFormat?r.tieFormat:r.tieFormats?.find(a=>t.tieFormatId===a.tieFormatId));if(i?.tieFormat)return i.tieFormat;if(i?.tieFormatId){let n=e.tieFormats?.find(a=>i.tieFormatId===a.tieFormatId);if(n)return n}}}function vn({drawDefinition:t,structure:e,matchUp:i,event:r}){return{tieFormat:_y({item:i,drawDefinition:t,structure:e,event:r})||_y({item:e,drawDefinition:t,structure:e,event:r})||$o(t)||$o(r)}}function zye({matchUps:t}){let e=t.reduce((i,r)=>!r.collectionPosition||i.includes(r.collectionPosition)?i:i.concat(r.collectionPosition),[]).map(i=>({[i]:t.filter(r=>r.collectionPosition===i)}));return{collectionPositionMatchUps:Object.assign({},...e)}}function kr({drawDefinition:t,structure:e}){let i={},r=[];return(t?.structures??[e]).filter(n=>n&&typeof n=="object").forEach(n=>{if(!n)return;let{structureId:a,matchUps:s,structures:o}=n,l=Array.isArray(o);if(l)l&&o.forEach(u=>{let{structureName:c}=u,d=u.matchUps;i[u.structureId]={matchUps:d,itemStructureIds:[],structureName:c},d&&(r.push(...d),d.forEach(p=>{p.tieMatchUps&&r.push(...p.tieMatchUps)})),i[a]||(i[a]={itemStructureIds:[],matchUps:[]}),i[a].itemStructureIds||(i[a].itemStructureIds=[]),i[a].itemStructureIds.push(u.structureId)});else{let u=s;i[a]={matchUps:u,itemStructureIds:[]},u?.forEach(c=>{r.push(c),c.tieMatchUps&&r.push(...c.tieMatchUps)})}}),{mappedMatchUps:i,drawMatchUps:r}}function gd({mappedMatchUps:t,matchUpsMap:e,structureId:i,inContext:r}){t=e?.mappedMatchUps??t;let n=t[i],a=(n?.itemStructureIds||[]).map(s=>{let{matchUps:o,structureName:l}=t[s];return r?o.map(u=>Object.assign(ke(u,!0,!0),{containerStructureId:i,structureId:s,structureName:l})):o}).flat();return(n?.matchUps||[]).concat(...a)}function RK({groupedOrder:t,roundPositionsCount:e}){if(!t||t?.length<=e)return t;let i=yr(t,t.length/e).map(n=>n.reduce((a,s)=>a+s)),r=i.slice().sort(ir);return i.map(n=>r.indexOf(n)+1)}function MR(t){if(!bt(t))return!1;let{matchUpId:e,drawPositions:i}=t,r=typeof e=="string",n=!i||Array.isArray(i)&&i.length<=2&&i.every(a=>ot(a)||a===void 0||a===null);return r&&n}function Ga(t){return Array.isArray(t)?t.every(MR):!1}function qye(t,e){return e?.find(i=>t.includes(i))}function bn({matchUps:t=[],interpolate:e}){if(!Ga(t))return{roundMatchUps:[],error:ie};let i=t.reduce((d,p)=>{let f=typeof p.roundNumber=="string"?Ye(p.roundNumber):p.roundNumber;return!p.roundNumber||d.includes(f)?d:d.concat(f)},[]).sort(ir).map(d=>{let p=t.filter(h=>h.roundNumber===d),f=p.find(({matchUpType:h})=>h===Zt)?p.filter(({matchUpType:h})=>h===Zt):p,m=h=>h.sort((g,I)=>ir(g.roundPosition,I.roundPosition));return{[d]:m(f)}}),r=t.reduce((d,p)=>{let f=typeof p.roundNumber=="string"?Ye(p.roundNumber):p.roundNumber;return d[f]||(d[f]=Ve({abbreviatedRoundName:p.abbreviatedRoundName,finishingRound:p.finishingRound,roundName:p.roundName})),d},{}),n=Object.assign({},...i);if(e){let d=Math.max(...Object.keys(n).map(f=>Ye(f)).filter(f=>!Number.isNaN(f))),p=n[d]?.length;if(p>1&&Uo(p)){let f=d+1,m=f+p/2;Re(f,m).forEach((h,g)=>{n[h]=Re(0,p/(2+g*2)).map(()=>({}))})}}let a=0,s=Object.assign({},...Object.keys(n).map(d=>{let p=n[d]?.length,f=n[d]?.filter(h=>!Yi.includes(h.matchUpStatus)&&!h.score?.scoreStringSide1)?.length,m=p&&p===f;return a=Math.max(a,p),{[d]:{matchUpsCount:p,inactiveCount:f,inactiveRound:m}}})),o=0,l=0,u=Object.keys(n).map(d=>Ye(d)).filter(d=>!Number.isNaN(d));u.forEach(d=>{let p=n[d].sort((m,h)=>m.roundPosition-h.roundPosition),f=p.flatMap(m=>m?.drawPositions||[]);if(s[d].roundNumber=d,s[d].roundFactor=s[d].matchUpsCount?a/s[d].matchUpsCount:1,s[d].finishingRound=r[d]?.finishingRound,s[d].roundName=r[d]?.roundName,s[d].abbreviatedRoundName=r[d]?.abbreviatedRoundName,s[d].finishingPositionRange=n[d]?.[0]?.finishingPositionRange,d===1||!s[d-1]){let m=f.sort(ir),h=yr(m,2);s[d].drawPositions=m,s[d].pairedDrawPositions=h}else{let m=s[d-1],h=m.drawPositions,g=m.matchUpsCount/s[d].matchUpsCount,I=yr(h,g),v=p.map(w=>{let{roundPosition:y}=w,b=[...w.drawPositions||[],void 0,void 0].slice(0,2);if(!y)return b;let S=b?.filter(Boolean)||[];if(!S?.length)return[void 0,void 0];if(d<3&&S?.length===2)return b?.slice().sort(ir);let U=xi(h,S).length!==S?.length;if(S?.length&&U)return S?.length===1?[S[0],void 0]:b?.slice().sort(ir);let T=(y-1)*2;return I.slice(T,T+2).map(P=>qye(P,S))});s[d].drawPositions=v?.flat(),s[d].pairedDrawPositions=v}s[d+1]?.matchUpsCount===s[d].matchUpsCount&&(s[d+1].feedRound=!0,s[d+1].feedRoundIndex=l,s[d].preFeedRound=!0,l+=1),s[d]&&!s[d].feedRound&&(s[d].roundIndex=o,o+=1)});let c=!!Object.values(s).some(({matchUpsCount:d})=>!Uo(d));return{hasNoRoundPositions:t.some(d=>!d.roundPosition),roundsNotPowerOf2:c,maxMatchUpsCount:a,roundMatchUps:n,roundNumbers:u,roundProfile:s,...H}}function JT(t){if(!Array.isArray(t))return"";let e=t.filter(Ni);return e.length?rt([Math.min(...e),Math.max(...e)]).join("-"):""}function Yye({drawDefinition:t,structureId:e,matchUpsMap:i}){if(!t)return{error:_e};if(!e)return{error:Va};let{structure:r}=et({drawDefinition:t,structureId:e});if(r?.stage!==Zr)return{error:ef,info:"Structure is not CONSOLATION stage"};let{links:n}=t,a=n?.filter(d=>d.target.structureId===e)||[],s=a?.reduce((d,p)=>{let{structureId:f}=p.source;return d.includes(f)?d:d.concat(f)},[])||[],o=Object.assign({},...s.map(d=>{let p=gd({structureId:d,matchUpsMap:i}),f=bn({matchUps:p}).roundProfile;return{[d]:f}})),l=gd({matchUpsMap:i,structureId:e}),{roundProfile:u}=bn({matchUps:l}),c={};return a?.forEach(d=>{let{structureId:p,roundNumber:f}=d.source,{feedProfile:m,groupedOrder:h,positionInterleave:g,roundNumber:I}=d.target,v=o[p],w=v[1]?.drawPositions,y=v[f]?.matchUpsCount;if(!y)return;let b=y?w.length/y:0,S=w.length/b,U=w.slice(),T=RK({roundPositionsCount:S,groupedOrder:h}),P=T?.length||1;if(P<=S){let R=w.length/P,C=yr(U,R);m===Pp&&C.forEach(M=>M.reverse()),U=T?.length&&T?.map(M=>C[M-1]).flat()||C.flat()}let D=yr(U,b);if(g){let R=Re(0,g.interleave).map(()=>{}),C=Re(0,g.offset).map(()=>{});D=D.map(N=>[N,...R]),D.unshift(C),D=D.flat(1);let M=D.length-g.offset;D=D.slice(0,M)}c[I]||(c[I]={});let E=u?.[I]?.feedRound?2:1;D.forEach((R,C)=>{let M=1+C*E;c[I][M]||(c[I][M]=JT(R))})}),{sourceDrawPositionRanges:c}}function CK({drawDefinition:t}){if(typeof t!="object")return{error:tm};let e={},{structures:i=[],links:r=[]}=t||{},n=i.reduce((s,o)=>{let{stage:l}=o;return s[l]?s[l].push(o):s[l]=[o],s},{});for(let s of Object.keys(n)){let o=n[s].find(({stageSequence:u})=>u===1);if(!o)continue;let{structureId:l}=o;a({aggregator:{},targetRound:0,exitProfiles:e,exitProfile:"0",structureId:l,stage:s})}return{exitProfiles:e};function a({exitProfiles:s,exitProfile:o,structureId:l,targetRound:u,aggregator:c,stage:d}){s[l]||(s[l]=[]),o==="0"&&[Zr,Ui].includes(d)||s[l].push(o);let p=r.filter(f=>f.source.structureId===l&&f.source.roundNumber>=u);for(let f of p){let m=f.source.roundNumber,h=f.target.roundNumber,g=f.target.structureId,I=i.find(w=>w.structureId===g).stage,v=[I,g,h,m].join("|");if(c[v])return;c[v]=!0,a({exitProfile:`${o}-${m}`,structureId:g,exitProfiles:s,targetRound:h,aggregator:c,stage:I})}}}function Kye({drawDefinition:t,roundProfile:e,structureId:i,matchUpsMap:r}){if(!t)return{error:_e};if(!i)return{error:Va};if(!e){let s=gd({matchUpsMap:r,structureId:i});if({roundProfile:e}=bn({matchUps:s}),!e)return{error:Xe}}let n=(Math.min(...e?.[1]?.drawPositions??[])||1)-1,a=Object.keys(e);return{drawPositionsRanges:Object.assign({},...(a||[]).map(s=>{let o=e?.[s]?.matchUpsCount,l=e?.[1]?.drawPositions??[],u=yr(l,l.length/o),c=u.map(JT),d=u.map(g=>g.map(I=>I-n)).map(JT),p=a.map(g=>{if(g>s)return;let I=e?.[g]?.drawPositions??[];return yr(I,I.length/o)}).filter(Boolean),f=Re(0,o).map(g=>p.map(I=>I[g]).flat().filter(Boolean).sort(ir)).map(g=>rt(g)),m=f.map(g=>hIe(g).map(JT).join(", ")),h=Object.assign({},...Re(0,o).map(g=>({[g+1]:{firstRoundDrawPositionsRange:c[g],firstRoundOffsetDrawPositionsRange:d[g],possibleDrawPositions:f[g],drawPositionsRange:m[g]}})));return{[s]:h}}))}}function sL({roundsNotPowerOf2:t,drawDefinition:e,structure:i,matchUps:r}){if(!i)return!1;r=r??i.matchUps??[],t=t??bn({matchUps:r}).roundsNotPowerOf2;let n=!!i.positionAssignments?.find(({drawPosition:a})=>a)||!!r?.find(({drawPositions:a})=>a?.length);return(!e?.drawType||e.drawType!==rf)&&!i?.structures&&t&&n}function Vn({structure:t}){if(!t)return!1;let e=t.matchUps||t.roundMatchUps&&Object.values(t.roundMatchUps).flat(),i=!!e?.find(n=>n?.roundPosition),r=!!e?.find(n=>n?.drawPositions?.length);return!t?.structures&&t?.stage!==Er&&(!e.length||!i&&!r)}var MK={[uc]:{policyName:"Round Naming Default",namingConventions:{round:"Round",pre:"Pre"},qualifyingFinishMap:{1:"Final"},abbreviatedRoundNamingMap:{1:"F",2:"SF",4:"QF"},roundNamingMap:{1:"Final",2:"Semifinal",4:"Quarterfinal"},affixes:{roundNumber:"R",preFeedRound:"Q",preQualifying:"P"},stageConstants:{[xe]:"",[Ui]:"P",[We]:"Q",[Zr]:"C"}}},Xye=MK;function NK({roundNamingPolicy:t,drawDefinition:e,structure:i,matchUps:r}){let{roundProfile:n,roundMatchUps:a}=bn({matchUps:r}),{structureAbbreviation:s,stage:o}=i,l=Vn({structure:i}),u=sL({structure:i}),c=i.structures,d={},p=MK[uc],f=i.stage===We,m=f?Math.max(...(e?.structures??[]).filter(R=>R.stage===We).map(({stageSequence:R})=>R??1),0):0,h=(i.stageSequence??1)<m?i.stageSequence??1:"",g=h&&(t?.affixes?.preQualifying||p.affixes.preQualifying)||"",I=t?.roundNamingMap||p.roundNamingMap||{},v=t?.abbreviatedRoundNamingMap||p.abbreviatedRoundNamingMap||{},w=t?.affixes?.preFeedRound||p.affixes.preFeedRound,y=t?.affixes?.roundNumber||p.affixes.roundNumber,b=(t?.namingConventions||p.namingConventions).round,S=o&&o!==xe?o[0]:"",U=t?.stageConstants||p.stageConstants,T=o&&U?.[o]||S,P=`${g}${T}${h}`,D=n?Object.keys(n):[],E=f&&U?.[We]?`${U?.[We]}-`:"";if(c||l||u)Object.assign(d,...D.map(R=>{let C=`${E}${b} ${R}`,M=`${y}${R}`;return{[R]:{roundName:C,abbreviatedRoundName:M}}}));else{let R=f&&(t?.qualifyingFinishMap||p?.qualifyingFinishMap||{});Object.assign(d,...D.map(C=>{if(!n?.[C])return;let{matchUpsCount:M,preFeedRound:N}=n[C],A=M*2,O=R?.[n?.[C].finishingRound]||R&&`${y}${A}`||I[M]||`${y}${A}`,k=N?`-${w}`:"",F=`${O}${k}`,x=[P,s,F].filter(Boolean).join("-"),L=`${v[M]||`${y}${A}`}${k}`,$=[P,s,L].filter(Boolean).join("-");return{[C]:{abbreviatedRoundName:$,roundName:x}}}))}return{roundNamingProfile:d,roundProfile:n,roundMatchUps:a}}var Jye=(t,e)=>(t||0)+(e||0);function AK(t,e){let i=Array.isArray(t)?t[0]:t;return Number.isNaN(i)&&DK||i<=e[Db]&&Db||i<=e[Tb]&&Tb||iL}function kK({score:t}){let e=t?.sets||[],i=e.reduce((n,a)=>(n[0]+=a.side1Score||0,n[1]+=a.side2Score||0,n),[0,0]),r=e.reduce((n,a)=>(n[0]+=a.side1TiebreakScore||0,n[1]+=a.side2TiebreakScore||0,n),[0,0]);return r.reduce(Jye)&&(i[r[0]>r[1]?0:1]+=1),{sets:e,games:i,score:t}}function Qye(t){let e=Math.min(...t.games),i=Math.max(...t.games);return Math.round(e/i*100)}function OK(t){return t.map(Qye).sort().map(e=>parseFloat(e.toFixed(2)))}function nS({tournamentRecord:t,profileBands:e,matchUp:i}){if(!i)return{error:ta};let{score:r,winningSide:n}=i;if(!n)return{error:ie};let a=!e&&t&&sf({policyType:Gu,tournamentRecord:t}).policy,s=e||a?.profileBands||rL[Gu].profileBands,o=kK({score:r}),l=OK([o]),u=AK(l,s),c=Array.isArray(l)?l[0]:l;return{...H,competitiveness:u,pctSpread:c}}function xK({matchUp:t}){if(!t)return{error:ta};if(t&&!t.sides)return{error:ia};if(t&&!t.hasContext)return{error:KE};let e=(t.sides??[])?.map(s=>s?.participantId).filter(Boolean),i=t.sides?.filter(s=>s.participant?.participantType===gt).map(s=>s.participantId).filter(Boolean)??[],r=((t.sides??[])?.map(s=>s.participant?.individualParticipants).filter(Boolean)??[]).map(s=>(s??[]).map(o=>o?.participantId).filter(Boolean)),n=[...i,...r.flat()].filter(Boolean)??[],a=rt(n.concat(e)).filter(Boolean)??[];return{nestedIndividualParticipantIds:r,allRelevantParticipantIds:a,individualParticipantIds:n,sideParticipantIds:e,...H}}var ZD="CHECK_IN",eP="CHECK_OUT",Zye="SCHEDULE",ph="SCHEDULE.ASSIGNMENT.VENUE",lu="SCHEDULE.ALLOCATION.COURTS",Id="SCHEDULE.ASSIGNMENT.COURT",NR="SCHEDULE.COURT.ORDER",fh="SCHEDULE.DATE",ebe="COMPLETED.DATE",oL="HOME_PARTICIPANT_ID",lL="SCHEDULE.ASSIGN.OFFICIAL",mh="SCHEDULE.TIME.SCHEDULED",mo="SCHEDULE.TIME.START",Zu="SCHEDULE.TIME.STOP",Gl="SCHEDULE.TIME.RESUME",gc="SCHEDULE.TIME.END",AR="SCHEDULE.TIME.MODIFIERS",FK="TO_BE_ANNOUNCED",LK="NEXT_AVAILABLE",_K="FOLLOWED_BY",$K="AFTER_REST",BK="RAIN_DELAY",tbe="NOT_BEFORE",mO=[FK,LK,_K,$K,BK],ibe="ELIGIBILITY",rbe="REGISTRATION",nbe="SUSPENSION",abe="MEDICAL",sbe="PENALTY",VK="SCALE",jK="RATING",GK="RANKING",uL="SEEDING",Bd="PUBLISH",Ha="PUBLIC",Vd="STATUS",obe="MODIFICATION",lbe="RETRIEVAL",ube="other",cbe={MUTUALLY_EXCLUSIVE_TIME_MODIFIERS:mO,AFTER_REST:$K,ALLOCATE_COURTS:lu,ASSIGN_COURT:Id,ASSIGN_OFFICIAL:lL,ASSIGN_VENUE:ph,CHECK_IN:ZD,CHECK_OUT:eP,COMPLETED_DATE:ebe,COURT_ORDER:NR,ELIGIBILITY:ibe,END_TIME:gc,FOLLOWED_BY:_K,MEDICAL:abe,MODIFICATION:obe,NEXT_AVAILABLE:LK,NOT_BEFORE:tbe,OTHER:ube,PENALTY:sbe,PUBLIC:Ha,PUBLISH:Bd,RANKING:GK,RATING:jK,RAIN_DELAY:BK,REGISTRATION:rbe,RESUME_TIME:Gl,RETRIEVAL:lbe,SCALE:VK,SCHEDULE:Zye,SCHEDULED_DATE:fh,SCHEDULED_TIME:mh,SEEDING:uL,START_TIME:mo,STATUS:Vd,STOP_TIME:Zu,SUSPENSION:nbe,TIME_MODIFIERS:AR,TO_BE_ANNOUNCED:FK};function hh({matchUp:t}){if(!t)return{error:ta};if(!t.hasContext)return{error:KE};if(!t.sides||t?.sides.filter(Boolean).length!==2)return{error:ia};let{nestedIndividualParticipantIds:e,allRelevantParticipantIds:i,sideParticipantIds:r}=xK({matchUp:t}),n=(t.timeItems??[]).filter(o=>o?.itemType&&[ZD,eP].includes(o.itemType)).sort((o,l)=>(o.createdAt?new Date(o.createdAt).getTime():0)-(l.createdAt?new Date(l.createdAt).getTime():0)),a=n.map(o=>o.itemValue).filter(o=>n.filter(l=>l?.itemValue===o).reverse()[0].itemType===ZD);e?.forEach((o,l)=>{let u=r?.[l],c=o?.length&&o.every(d=>a.includes(d));u&&c&&!a.includes(u)&&a.push(u)}),r?.forEach((o,l)=>{a.includes(o)&&(e?.[l]??[]).forEach(u=>{u&&!a.includes(u)&&a.push(u)})});let s=r?.reduce((o,l)=>a.includes(l)&&o,!0);return{allRelevantParticipantIds:i,allParticipantsCheckedIn:s,checkedInParticipantIds:a,...H}}var Di=t=>e=>{let i=bt(e)&&e?.matchUpType||ri(e)&&e;return i&&e6[t].includes(i)};function $y(t){let{matchUpAverageTimes:e,matchUpFormat:i}=t||{},r=e?.map(({matchUpFormatCodes:a})=>a?.filter(s=>s===i)).flat().filter(Boolean).sort((a,s)=>(a?.length||0)-(s?.length||0))||[],n=r.includes(i)?i:r[0];return e?.find(({matchUpFormatCodes:a,averageTimes:s})=>a?.find(o=>n===o)&&s)?.averageTimes}function By(t){let{matchUpRecoveryTimes:e,averageMinutes:i,matchUpFormat:r}=t||{};return e?.find(({matchUpFormatCodes:n,averageTimes:a,recoveryTimes:s})=>{if(a&&i){let{greaterThan:o=0,lessThan:l=360}=a;if(i>o&&i<l)return!0}return n?.find(o=>o===r)&&s})?.recoveryTimes}function HK({timesBlockArray:t,categoryName:e,categoryType:i}){return t.filter(r=>Array.isArray(r)).map(r=>r.sort((n,a)=>(a.categoryNames?.length||0)-(n.categoryNames?.length||0)).find(({categoryTypes:n,categoryNames:a})=>!a?.length&&!n?.length||a?.includes(e)||n?.includes(i))).find(Boolean)}function dbe({tournamentScheduling:t,eventScheduling:e,averageMinutes:i,defaultTiming:r,matchUpFormat:n,categoryName:a,categoryType:s,policy:o}){let l=e?.matchUpRecoveryTimes&&By({...e,averageMinutes:i,matchUpFormat:n}),u=t?.matchUpRecoveryTimes&&By({...t,averageMinutes:i,matchUpFormat:n}),c=o?.matchUpRecoveryTimes&&By({...o,averageMinutes:i,matchUpFormat:n}),d=[l,u,c,o?.defaultTimes?.recoveryTimes,r?.recoveryTimes];return HK({categoryName:a,categoryType:s,timesBlockArray:d})}function pbe({matchUpFormat:t,categoryName:e,categoryType:i,defaultTiming:r,tournamentScheduling:n,eventScheduling:a,policy:s}){let o=a?.matchUpAverageTimes&&$y({...a,matchUpFormat:t}),l=n?.matchUpAverageTimes&&$y({...n,matchUpFormat:t}),u=s?.matchUpAverageTimes&&$y({...s,matchUpFormat:t}),c=[o,l,u,s?.defaultTimes?.averageTimes,r?.averageTimes];return HK({categoryName:e,categoryType:i,timesBlockArray:c})}var WK="DOUBLES_SINGLES",zK="SINGLES_DOUBLES",Ls="total",hO="participantConflict",gO="potentialParticipantConflict",Za="matchUpConflict",qK="courtDoubleBooking",YK="positionLinkConflict",KK="ISSUE_IDS",Al="CONFLICT",kl="WARNING",Sy="ERROR",Uy="ISSUE",QT="STATE",fbe="BLOCKED",mbe="PRACTICE",hbe="MAINTENANCE",gbe={SINGLES_DOUBLES:zK,DOUBLES_SINGLES:WK,TOTAL:Ls,CONFLICT_MATCHUP_ORDER:Za,CONFLICT_PARTICIPANTS:hO,CONFLICT_POTENTIAL_PARTICIPANTS:gO,CONFLICT_COURT_DOUBLE_BOOKING:qK,CONFLICT_POSITION_LINK:YK,SCHEDULE_ISSUE_IDS:KK,SCHEDULE_CONFLICT:Al,SCHEDULE_WARNING:kl,SCHEDULE_ERROR:Sy,SCHEDULE_ISSUE:Uy,SCHEDULE_STATE:QT,BLOCKED:fbe,PRACTICE:mbe,MAINTENANCE:hbe};function aS({defaultAverageMinutes:t=90,defaultRecoveryMinutes:e=0,tournamentRecord:i,matchUpFormat:r,categoryName:n,categoryType:a,eventType:s,event:o}){if(!i)return{error:Ie};s=s??o?.eventType??Pm;let l={averageTimes:[{minutes:{default:t}}],recoveryTimes:[{minutes:{default:e}}]},{scheduleTiming:u}=Xw({tournamentRecord:i,categoryName:n,categoryType:a,event:o}),c={...u,matchUpFormat:r,categoryType:a,defaultTiming:l};return kR({eventType:s,timingDetails:c})}function kR({timingDetails:t,eventType:e}){let i=pbe(t),r=Object.keys(i?.minutes||{}),n=i?.minutes&&(r?.includes(e)&&i.minutes[e]||i.minutes.default),a=dbe({...t,averageMinutes:n}),s=Object.keys(a?.minutes||{}),o=a?.minutes&&(s?.includes(e)&&a.minutes[e]||a.minutes.default),l=Di(Pm)(e)?zK:WK,u=a?.minutes&&(s?.includes(l)&&a.minutes[l]||o);return{averageMinutes:n,recoveryMinutes:o,typeChangeRecoveryMinutes:u}}function PA(t){return t.createdAt?new Date(t.createdAt).getTime():0}function uf({timeItems:t,itemType:e}){let i=t.filter(n=>n&&n.itemType===e).sort((n,a)=>PA(n)-PA(a)).pop(),r=i&&PA(i);return{itemValue:i?.itemValue,timeStamp:r}}function cL({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:r,timeStamp:n}=uf({timeItems:i?.timeItems||[],itemType:mh});return!e||n&&t&&new Date(n).getTime()>new Date(t).getTime()?{scheduledTime:r}:e}function cf({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:r,timeStamp:n}=uf({timeItems:i?.timeItems||[],itemType:fh});return!e||n&&t&&new Date(n).getTime()>new Date(t).getTime()?{scheduledDate:r}:e}function kf(t){if(W4.test(t)){let e=dF();return new Date(`${e}T${t}`)}else return new Date(t)}function Ibe({matchUp:t}){if(!t)return{error:ta};if(!t.timeItems)return{error:Z1};let e=t.timeItems.filter(r=>[mo,Zu,Gl,gc].includes(r?.itemType)).sort((r,n)=>kf(r.itemValue).getTime()-kf(n.itemValue).getTime()),i=e.reduce((r,n)=>{let a,s=n?.itemType?.split("."),o=`SCHEDULE.TIME.${n?.itemType?.startsWith("SCHEDULE.TIME")&&s[2]}`;switch(o){case mo:a=0;break;case gc:if(r.lastValue&&[mo,Gl].includes(r.lastType)){let l=kf(n.itemValue).getTime()-kf(r.lastValue).getTime();a=r.milliseconds+l}else a=r.milliseconds;break;case Zu:if([mo,"SCHECULE.TIME.RESUME"].includes(r.lastType)){let l=kf(n.itemValue).getTime()-kf(r.lastValue).getTime();a=r.milliseconds+l}else a=r.milliseconds;break;default:a=r.milliseconds;break}return{milliseconds:a,lastType:o,lastValue:n.itemValue}},{milliseconds:0,lastType:void 0,lastValue:void 0});if([mo,Gl].includes(i.lastType)){let r=new Date().getTime()-kf(i.lastValue).getTime();i.milliseconds+=r}return{milliseconds:i.milliseconds,time:vbe(i.milliseconds),relevantTimeItems:e}}function vbe(t){let e=(i,r=2)=>("00"+i).slice(-r);return e(t/36e5|0)+":"+e(t%36e5/6e4|0)+":"+e(t%6e4/1e3|0)}function ybe({matchUp:t}){let e=t?.timeItems||[],i=r=>r.createdAt?new Date(r.createdAt).getTime():0;return{startTime:e.reduce((r,n)=>{let a=n.itemType===mo&&n;return a&&(!r||i(a)<i(r))?a:r},void 0)?.itemValue}}function tP(t){return parseInt(t)}function iP({startTime:t="",endTime:e=""}={}){if(!t||!e||!lp.test(t)||!lp.test(e))return!1;let[i,r]=t.split(":").map(tP),[n,a]=e.split(":").map(tP);return n<i?!1:!(i===n&&a<r)}function bbe(t,e){let[i,r]=t.startTime.split(":").map(tP),[n,a]=e.startTime.split(":").map(tP);return i<n?-1:i>n?1:r<a?-1:r>a?1:0}function OR({dateAvailability:t}){if(!t)return{error:G6};if(!Array.isArray(t))return{error:qT};let e="Dates must be formated => YYYY-MM-DD",i="Times must be 24 hour => 00:00";for(let r of t){if(typeof r!="object")return{error:qT};let{date:n,startTime:a,endTime:s,bookings:o=[]}=r;if(!a||!s)return{error:qT};if(n&&!rl.test(n))return{error:sr,dateAvailability:{date:n},info:e};if(!lp.test(a))return{error:Ps,dateAvailability:{startTime:a},info:i};if(!lp.test(s))return{error:Ps,dateAvailability:{endTime:s},info:i};if(a===s)return{error:Ps,dateAvailability:{startTime:a,endTime:s},info:"startTime and endTime are equivalent"};if(!iP({startTime:a,endTime:s}))return{error:Ps,dateAvailability:{startTime:a,endTime:s},info:"endTime must be after startTime"};if(o){if(!Array.isArray(o))return{error:$D};for(let l of o){if(typeof l!="object")return{error:$D};let{startTime:u,endTime:c}=l;if(!lp.test(u))return{error:Ps,booking:{startTime:u},info:i};if(!lp.test(c))return{error:Ps,booking:{endTime:c},info:i};if(u===c)return{error:Ps,dateAvailability:{startTime:u,endTime:c},info:"startTime and endTime are equivalent"};if(!iP({startTime:u,endTime:c}))return{error:Ps,dateAvailability:{startTime:u,endTime:c},info:"endTime must be after startTime"}}}}return{valid:!0}}function XK({tournamentRecord:t}){for(let e of t.venues??[])e.isPrimary&&delete e.isPrimary}function sS(t){let{disableNotice:e,venue:i,context:r}=t;if(typeof i!="object")return{error:ie};let n=Is(t);i.venueId||(i.venueId=Et());let a;for(let s of Object.values(n)){let o=wbe({disableNotice:!0,tournamentRecord:s,context:r,venue:i});if(o?.error)return o;a=o.venue}return e||at({topic:pK,payload:{venue:i}}),Ve({...H,venue:a})}function wbe({tournamentRecord:t,disableNotice:e,context:i,venue:r}){if(!t)return{error:Ie};if(!r)return{error:Xe,info:"missing venue"};if(t.venues||(t.venues=[]),r.venueId||(r.venueId=Et()),t.venues.reduce((n,a)=>n||a.venueId===r.venueId,void 0))return{error:u4};if(r.dateAvailability?.length){let n=OR({dateAvailability:r.dateAvailability});if(n.error)return n}if(r.defaultStartTime||r.defaultEndTime){if(!r.defaultStartTime||!r.defaultEndTime)return{error:ie,info:"both defaultStartTime and defaultEndTime are required"};if(!iP({startTime:r.defaultStartTime,endTime:r.defaultEndTime}))return{error:ie,info:"defaultEndTime must be after defaultStartTime"}}return i&&xt({element:r,extension:{value:i,name:X5}}),r.isPrimary&&XK({tournamentRecord:t}),t.venues.push(r),{...H,venue:ke(r)}}function Eu({tournamentRecords:t,tournamentRecord:e,venueId:i}){if(!e)return{error:Ie};if(!i)return{error:xd};let r=(e.venues??[]).reduce((n,a)=>a.venueId===i?a:n,void 0);if(!r&&t){let n=(Ww({tournamentRecords:t}).linkedTournamentIds??[])[e.tournamentId];for(let a of n){let s=t[a],o=Eu({tournamentRecord:s,venueId:i});if(o.success&&o.venue)return sS({tournamentRecord:e,venue:o.venue}),{...H,venue:r}}}return r?{...H,venue:r}:{error:tf}}function dL({convertExtensions:t,...e}){let{tournamentRecords:i,tournamentRecord:r,venueId:n}=e,a=Eu({tournamentRecords:i,tournamentRecord:r,venueId:n});return ke(a,t,!0)}function jd({tournamentRecords:t,tournamentRecord:e,courtId:i}){if(!e)return{error:Ie};if(!i)return{error:ih};let r="findCourt",n,a;if((e.venues??[]).forEach(s=>{(s.courts??[]).forEach(o=>{o.courtId===i&&(n=o,a=s)})}),n)return{...H,court:n,venue:a};if(t){let s=(Ww({tournamentRecords:t}).linkedTournamentIds??[])[e.tournamentId];for(let o of s){let l=t[o],u=jd({tournamentRecord:l,courtId:i});if(u.success)return u.venue&&sS({tournamentRecord:e,venue:u.venue}),{...H,court:n,venue:a}}}return z({result:{error:ac},stack:r})}function pL(t){return ke(jd(t),!1,!0)}function xR({tournamentRecord:t,internalUse:e,courtId:i}){if(!t)return{error:Ie};if(!i)return{error:ih};let r=jd({tournamentRecord:t,courtId:i});if(r.error)return r;let n=r.court&&(({altitude:a,courtId:s,courtName:o,courtDimensions:l,latitude:u,longitude:c,surfaceCategory:d,surfaceType:p,surfacedDate:f,pace:m,notes:h})=>({altitude:a,courtId:s,courtName:o,courtDimensions:l,latitude:u,longitude:c,surfaceCategory:d,surfaceType:p,surfacedDate:f,pace:m,notes:h}))(r.court);return{...H,courtInfo:ke(n,!1,e)}}function oI(t){let e=Ge(t,[{[mr]:!0},{venueId:!0,[xs]:xd}]);if(e.error)return e;let{tournamentRecord:i,venueId:r}=t,n=Eu({tournamentRecord:i,venueId:r});if(n.error)return n;let a=(n.venue?.courts??[]).map(l=>(({courtInfo:u})=>({...u}))(xR({courtId:l.courtId,internalUse:!0,tournamentRecord:i}))),s=n.venue&&(({venueId:l,venueName:u,venueAbbreviation:c})=>({venueAbbreviation:c,venueName:u,venueId:l}))(n.venue),o=s&&{...s,courtsInfo:a};return{...H,venueData:ke(o,!1,!0)}}function Sbe({matchUp:t}){let e=t?.timeItems||[],i=r=>r.createdAt?new Date(r.createdAt).getTime():0;return{endTime:e.reduce((r,n)=>{let a=n.itemType===gc&&n;return a&&(!r||i(a)>i(r))?a:r},void 0)?.itemValue}}function $i({event:t,eventId:e}){if(!t)return{error:li};let i=mt({name:Xs,element:t})?.extension,r=e?ke(i?.value,!1,!0):i?.value;return e&&t.drawDefinitions?.forEach(n=>{r?.flights?.forEach(a=>{a.drawId===n.drawId&&Object.assign(a,{drawDefinition:n})})}),{flightProfile:r}}function jn(t){let{tournamentRecord:e,eventId:i,drawId:r}=t,n="findEvent",a={},s=t.tournamentRecords??(e&&{[e.tournamentId]:e})??{},o=Object.values(s).map(({events:u,tournamentId:c})=>(u&&u.forEach(d=>{a[d.eventId]={tournamentId:c}}),u??[])).flat(),l;if(r){let u,c=o.find(d=>{let p=(d?.drawDefinitions??[]).find(f=>f.drawId===r);if(p)u=p,l=a[d.eventId].tournamentId;else{let f=(d&&$i({event:d})?.flightProfile)?.flights?.find(m=>m.drawId===r);if(f)return l=a[d.eventId].tournamentId,{entries:f.drawEntries,drawName:f.drawName,tournamentId:l,drawId:r}}return p});if(c)return{event:c,drawDefinition:u,tournamentId:l}}if(i){let u=o.find(c=>c?.eventId===i);if(u)l=a[u.eventId].tournamentId;else return{event:void 0,drawDefinition:void 0,...z({result:{error:os},stack:n})};return{event:u,drawDefinition:void 0,tournamentId:l}}return{event:void 0,drawDefinition:void 0,...z({result:{error:Oa},context:{drawId:r,eventId:i},stack:n})}}function FR(t){let e=t.event,i=t.matchUpType,{scheduleVisibilityFilters:r,afterRecoveryTimes:n,tournamentRecord:a,usePublishState:s,scheduleTiming:o,matchUpFormat:l,publishStatus:u,matchUp:c}=t;if(!c)return{error:ta};if(n&&!c.matchUpType&&!t.matchUpType&&(e||a)&&c.drawId){let b=t.drawDefinition||e?.drawDefinitions?.find(U=>U.drawId===c.drawId);!b&&a&&({drawDefinition:b,event:e}=jn({drawId:c.drawId,tournamentRecord:a}));let S=c.structureId&&b?.structures?.find(({structureId:U})=>U===c.structureId);i=t.matchUpType||S?.matchUpType||b?.matchUpType||e?.eventType!==rr&&e?.eventType}let{milliseconds:d,time:p}=Ibe({matchUp:c}),{startTime:f}=ybe({matchUp:c}),{endTime:m}=Sbe({matchUp:c}),h,{eventIds:g,drawIds:I}=r??{};if((!g||g.includes(c.eventId))&&(!I||I.includes(c.drawId))){let b=X=>X.createdAt?new Date(X.createdAt).getTime():0,S=new Map,U=c.timeItems?.toSorted((X,Z)=>b(X)-b(Z))??[];for(let X of U)S.set(X.itemType,X.itemValue);let T=S.get(oL),P=S.get(lu),D=S.get(mh),E=S.get(AR),R=S.get(fh),C=S.get(lL),M=S.get(NR),N=S.get(ph),A=S.get(Id),O,k,F,x,L,$=c.matchUpType??i;if(o&&D&&n&&$){let X={matchUpFormat:c.matchUpFormat??l,...o};({averageMinutes:k=0,recoveryMinutes:F=0,typeChangeRecoveryMinutes:x=0}=kR({timingDetails:X,eventType:$})),(k||F)&&(O=m?Jn(ci(m),F):Jn(D,k+F)),x&&(L=m?Jn(ci(m),x):Jn(D,k+x))}!R&&D&&(R=Qe(D));let V=VD({scheduledDate:R,scheduledTime:D}),_={},B=(a&&N&&oI({tournamentRecord:a,venueId:N}))?.venueData||{};N&&(_[N]=B);let{venueName:G,venueAbbreviation:j,courtsInfo:K}=B,Y=(A&&K?.find(X=>X.courtId===A))?.courtName;for(let X of P||[]){if(!a)break;X.venueId&&!_[X.venueid]&&(_[X.venueId]=oI({venueId:X.venueId,tournamentRecord:a})?.venueData);let Z=_[X.venueId];X.venueName=Z?.venueName;let J=Z?.courtsInfo?.find(ae=>ae.courtId===X.courtId);X.courtName=J?.courtName}h=Ve({typeChangeTimeAfterRecovery:L,timeAfterRecovery:O,scheduledDate:R,scheduledTime:D,isoDateString:V,homeParticipantId:T,venueAbbreviation:j,allocatedCourts:P,timeModifiers:E,venueName:G,venueId:N,courtOrder:M,courtName:Y,courtId:A,official:C,typeChangeRecoveryMinutes:x,recoveryMinutes:F,averageMinutes:k,milliseconds:d,startTime:f,endTime:m,time:p})}else h=Ve({milliseconds:d,startTime:f,endTime:m,time:p});let{scheduledDate:v}=cf({matchUp:c}),{scheduledTime:w}=cL({matchUp:c});if(s&&u?.displaySettings?.draws){let b=u.displaySettings.draws,S=(b?.[c.drawId]??b?.default)?.scheduleDetails;if(S){let U=(S.find(T=>v&&T.dates?.includes(v))??S.find(T=>!T.dates?.length))?.attributes;if(U){let T=Object.assign({},...Object.keys(h).map(P=>({[P]:!0})),U);h=Rm({source:h,template:T})}}}let y=c.matchUpStatus&&Yi.includes(c.matchUpStatus)&&(Qe(m)||Qe(v)||Qe(w))||void 0;return{schedule:h,endDate:y}}function Ube({drawPositions:t,roundProfile:e,roundNumber:i}){let r=[void 0,void 0];if(l6(t))return{orderedDrawPositions:r,displayOrder:r};let n=e?.[i],a=n?.pairedDrawPositions?.find(o=>kn(o||[],t.filter(Boolean)))??r,s=n?.feedRound;if(o6(t)){let o=[...t].sort(ir);return{orderedDrawPositions:o.length===2?o:a,displayOrder:s?o:a}}if(s){let o=[t.find(l=>!isNaN(Ye(l))),void 0];return{orderedDrawPositions:o,displayOrder:o}}return{orderedDrawPositions:a,displayOrder:a}}function rP({collectionPosition:t,collectionId:e,lineUp:i}){let r=[],n=[];if(i){let a=o=>o===void 0?-1:o,s=i.map(o=>{let{collectionAssignments:l,participantId:u}=o,c=l?.find(d=>d.collectionPosition===t&&d.collectionId===e);return c&&{participantId:u,...c}}).filter(Boolean).sort((o,l)=>a(o.substitutionOrder)-a(l.substitutionOrder));for(let o of s){let{participantId:l,previousParticipantId:u,substitutionOrder:c}=o;r.includes(l)||(u&&n.push({previousParticipantId:u,substitutionOrder:c,participantId:l}),r=r.filter(d=>d!==u),r.push(l))}}return{assignedParticipantIds:r,substitutions:n}}function Qs({tournamentParticipants:t,tournamentRecord:e,participantIds:i}){let r="getPairedParticipant";if(!t&&!e)return{error:Ie};if(!Array.isArray(i)||i.length>2)return{error:ga};if(!i.length)return z({result:{error:Od},stack:r});t=t??e?.participants??[];let n=t.filter(o=>o.participantType===pt&&xi(i,o.individualParticipantIds).length===i.length&&o.individualParticipantIds.length===i.length),a=n[0];if(!a)return z({result:{error:Vi},stack:r});let s=ke(n.slice(1),!1,!0);return{participant:ke(a),duplicatedPairParticipants:s,...H}}function Mp({drawDefinition:t,participantId:e}){if(typeof t!="object")return{error:_e};if(typeof e!="string")return{error:lr};let{extension:i}=mt({element:t,name:cc});return{lineUp:(i?.value||{})[e]}}function Tbe({tournamentParticipants:t,positionAssignments:e,collectionPosition:i,drawPositions:r=[],participantMap:n,drawDefinition:a,collectionId:s,sideLineUps:o,matchUpType:l}){if(!s||!i)return{};let u=({attribute:d,lineUp:p,teamParticipant:f})=>{let{assignedParticipantIds:m,substitutions:h}=rP({collectionPosition:i,collectionId:s,lineUp:p});if(l===$t){if(m?.length<=2){let g=n?.[m[0]]?.pairIdMap?.[m[1]],I=(g&&n[g]?.participant||Qs({participantIds:m,tournamentParticipants:t}).participant)?.participantId;return{[d]:{participantId:I,teamParticipant:f,substitutions:h}}}else if(m?.length>2)return{[d]:{teamParticipant:f,substitutions:h}}}else{let g=m?.[0];return g&&{[d]:{participantId:g,teamParticipant:f,substitutions:h}}}};if(!r?.length){let d=o?.map(p=>{let{teamParticipant:f,sideNumber:m}=p,h=p.lineUp||Mp({participantId:f.teamParticipantId,drawDefinition:a})?.lineUp;return u({attribute:m,lineUp:h,teamParticipant:f})}).filter(Boolean)||{};return{sideNumberCollectionAssignment:Object.assign({},...d)}}let c=r?.map(d=>{let p=e.find(g=>g.drawPosition===d)?.participantId,f=o?.find(g=>g?.drawPosition===d),m=f?.teamParticipant||p&&n?.[p]?.participant||t?.find(({participantId:g})=>g===p),h=f?.lineUp||Mp({participantId:p,drawDefinition:a})?.lineUp;return u({attribute:d,lineUp:h,teamParticipant:m})}).filter(Boolean)||{};return{drawPositionCollectionAssignment:Object.assign({},...c)}}function LR(t){let e=Ge(t,[{[Du]:!0}]);if(e.error)return e;let i=t?.matchUp,r=i?.matchUpType;if(!r&&i?.sides?.length){let n=i.sides.find(({participant:a})=>a)?.participant?.participantType;r=n===gt&&Wt||n===pt&&$t||n===Lt&&Lt||void 0}return{matchUpType:r}}function Dbe({drawPositionCollectionAssignment:t,sideNumberCollectionAssignment:e,positionAssignments:i,displaySideNumber:r,seedAssignments:n,drawPosition:a,isFeedRound:s,sideNumber:o}){let l=i.find(f=>f.drawPosition&&f.drawPosition===a),u=a&&t,c=o&&e,d=u?u[a]?.participantId:l?.participantId,p=l?Pbe({displaySideNumber:r,seedAssignments:n,participantId:d,assignment:l,sideNumber:o}):{...c?.[o]};if(s&&(o===1?Object.assign(p,{participantFed:!0}):Object.assign(p,{participantAdvanced:!0})),a&&u){let f=u[a]?.teamParticipant,m=u[a]?.participant,h=u[a]?.substitutions;m&&(p.participant=m),h&&(p.substitutions=h),f&&(p.teamParticipant=f)}return p}function Pbe({displaySideNumber:t,seedAssignments:e,participantId:i,assignment:r,sideNumber:n}){let a={drawPosition:r.drawPosition,displaySideNumber:t,sideNumber:n};if(i){let s=Ebe({seedAssignments:e,participantId:i});Object.assign(a,s,{participantId:i}),s?.seedNumber&&s?.seedValue===""&&(a.seedValue="~")}else r.bye&&Object.assign(a,{bye:!0});return r.qualifier&&Object.assign(a,{qualifier:!0}),a}function Ebe({seedAssignments:t,participantId:e}){return t?.find(i=>!i.seedProxy&&i.participantId===e)}function JK({scheduleVisibilityFilters:t,sourceDrawPositionRanges:e,tournamentParticipants:i,positionAssignments:r,drawPositionsRanges:n,hydrateParticipants:a,afterRecoveryTimes:s,initialRoundOfPlay:o,additionalContext:l,roundNamingProfile:u,tournamentRecord:c,tieDrawPositions:d,appliedPolicies:p,isCollectionBye:f,seedAssignments:m,usePublishState:h,participantMap:g,contextContent:I,scheduleTiming:v,contextProfile:w,drawDefinition:y,publishStatus:b,scoringActive:S,matchUpTieId:U,isRoundRobin:T,roundProfile:P,sideLineUps:D,structure:E,context:R,matchUp:C,event:M}){l=l??{};let N=vn({drawDefinition:y,structure:E,matchUp:C,event:M})?.tieFormat,{roundOffset:A,structureId:O,structureName:k,stage:F,stageSequence:x}=E,{drawId:L,drawName:$,drawType:V}=y??{},_=N?.collectionDefinitions,B=C.collectionId&&_?.find(Q=>Q.collectionId===C.collectionId),G=C.collectionId?B?.matchUpFormat:C.matchUpFormat??E?.matchUpFormat??y?.matchUpFormat??M?.matchUpFormat,j=C.matchUpType||B?.matchUpType||E?.matchUpType||y?.matchUpType||!Di(rr)(M?.eventType)&&M?.eventType,K=f?"BYE":C.matchUpStatus,{schedule:Y,endDate:X}=FR({scheduleVisibilityFilters:t,afterRecoveryTimes:s,tournamentRecord:c,usePublishState:h,scheduleTiming:v,drawDefinition:y,matchUpFormat:G,publishStatus:b,matchUpType:j,matchUp:C,event:M}),Z=d??C.drawPositions??[],{collectionPosition:J,collectionId:ae,roundPosition:te}=C,ne=C.roundNumber??l.roundNumber,le=ae?Tbe({tournamentParticipants:i,positionAssignments:r,collectionPosition:J,participantMap:g,drawDefinition:y,drawPositions:Z,collectionId:ae,sideLineUps:D,matchUpType:j}):void 0,de=u?.[ne]?.roundName||l.roundName,pe=u?.[ne]?.abbreviatedRoundName||l.abbreviatedRoundName,ge=P?.[ne]?.feedRound,Me=P?.[ne]?.preFeedRound,Pe=P?.[ne]?.roundFactor,Be=n?.[ne],fe=te?Be?.[te]:void 0,Te=e?.[ne],ce=B?.category?{...R?.category,...B.category}:R?.category??M?.category,ye=C.processCodes?.length&&C.processCodes||B?.processCodes?.length&&B?.processCodes||E?.processCodes?.length&&E?.processCodes||y?.processCodes?.length&&y?.processCodes||M?.processCodes?.length&&M?.processCodes||c?.processCodes,be=w?.withCompetitiveness&&nS({...I,matchUp:C}),Fe=C.finishingPositionRange??l.finishingPositionRange,we=F!==We&&ot(o)&&o+(ne||0),Ne=Q=>Ve(Q,void 0,!0),me={...Ne(R),...Ne({matchUpFormat:j===rr?void 0:G,tieFormat:j===rr?N:void 0,gender:B?.gender??M?.gender,endDate:C.endDate??X,discipline:M?.discipline,category:ce,finishingPositionRange:Fe,abbreviatedRoundName:pe,drawPositionsRange:fe,competitiveProfile:be,structureName:k,stageSequence:x,drawPositions:Z,matchUpStatus:K,processCodes:ye,isRoundRobin:T,matchUpTieId:U,preFeedRound:Me,matchUpType:j,roundFactor:Pe,roundOffset:A,structureId:O,roundNumber:ne,roundOfPlay:we,feedRound:ge,roundName:de,drawName:$,drawType:V,schedule:Y,drawId:L,stage:F}),...ke(Ne(C),!0,!0)};if(G&&C.score?.scoreStringSide1){let Q=zi(G),{bestOf:se,finalSetFormat:oe,setFormat:ue}=Q??{};(oe?.tiebreakSet||ue?.tiebreakSet||ue?.timed)&&(me.score.sets=me.score.sets.sort((ee,Se)=>ee.setNumber-Se.setNumber).map((ee,Se)=>{let De=Se+1===se&&oe?oe:ue,it=De?.tiebreakSet&&!De?.timed,Ue=De?.timed;return it?(ee.tiebreakSet=!0,[1,2].includes(ee.winningSide)&&(ee.side1Score=ee.winningSide===1?1:0,ee.side2Score=ee.winningSide===2?1:0)):Ue&&(ee.timed=!0),ee}))}if(Array.isArray(Z)){let{orderedDrawPositions:Q,displayOrder:se}=Ube({drawPositions:Z,roundProfile:P,roundNumber:ne}),oe=P?.[ne]?.feedRound,ue=se[0]!==Q[0],ee=Q.concat(void 0,void 0).slice(0,2).map((Se,De)=>{let it=De+1,Ue=ue?3-it:it,ut=Dbe({...le,positionAssignments:r,displaySideNumber:Ue,seedAssignments:m,drawPosition:Se,isFeedRound:oe,sideNumber:it}),yi=C.sides?.find(oi=>oi.sideNumber===it),qe=te?(te-1)*2+De+1:void 0,bi=qe?Te?.[qe]:void 0;return Ne({sourceDrawPositionRange:bi,...yi,...ut})});Object.assign(me,ke({sides:ee},!0,!0))}if(i&&me.sides){let Q=p?.[jw],se=oe=>{let ue=g?.[oe]?.participant;return ue&&Rm({template:Q?.participant,source:ue})};if(me.sides.filter(Boolean).forEach(oe=>{if(oe.participantId){let ue=ke(se(oe.participantId)||(i?fd({policyDefinitions:p,participantId:oe.participantId,tournamentParticipants:i,internalUse:!0,contextProfile:w}):void 0),void 0,!0);if(ue){let ee,Se;if(y?.entries){let De=y.entries.find(Ue=>Ue.participantId===oe.participantId),it=M?.entries?.find(Ue=>Ue.participantId===oe.participantId);ee=De?.entryStatus||it?.entryStatus,ue.entryStatus=ee,De?.entryStage&&(Se=De.entryStage,ue.entryStage=Se)}a===!1?Object.assign(oe,{participant:{entryStage:Se,entryStatus:ee}}):Object.assign(oe,{participant:ue})}}if(oe?.participant?.individualParticipantIds?.length&&!oe.participant.individualParticipants?.length){let ue=oe.participant.individualParticipantIds.map(ee=>se(ee)||(i?fd({policyDefinitions:p,tournamentParticipants:i,internalUse:!0,contextProfile:w,participantId:ee}):void 0));a!==!1&&Object.assign(oe.participant,{individualParticipants:ue})}}),!me.matchUpType){let{matchUpType:oe}=LR({matchUp:me});oe&&Object.assign(me,{matchUpType:oe})}if(w?.inferGender&&(!me.gender||me.gender===sh)&&me.sides?.length===2&&me.matchUpType!==rr){let oe=me.sides.map(ue=>{if(Di(Wt)(me.matchUpType))return ue.participant?.person?.sex;if(ue.participant?.individualParticipants?.length===2){let ee=rt(ue.participant.individualParticipants.map(Se=>Se.person?.sex)).filter(Boolean);if(ee.length===1)return ee[0]}});if(oe.filter(Boolean).length===2&&rt(oe).length===1){let ue=oe[0];me.inferredGender=ue}}}if(me.tieMatchUps){let Q=me.matchUpStatus==="BYE",se=me.sides?.map(({participant:oe,drawPosition:ue,sideNumber:ee,lineUp:Se})=>{let De=oe?.participantType===rr&&oe;return{teamParticipant:De&&Ve({participantRoleResponsibilities:De.participantRoleResponsibilities,participantOtherName:De.participanOthertName,participantName:De.participantName,participantId:De.participantId,teamId:De.teamId}),drawPosition:ue,sideNumber:ee,lineUp:Se}});me.tieMatchUps=me.tieMatchUps.map(oe=>{let ue=me.matchUpId,ee={finishingPositionRange:me.finishingPositionRange,abbreviatedRoundName:pe,roundNumber:ne,roundName:de};return JK({tieDrawPositions:Z,scheduleVisibilityFilters:t,sourceDrawPositionRanges:e,sideLineUps:se,drawPositionsRanges:n,initialRoundOfPlay:o,roundNamingProfile:u,additionalContext:ee,appliedPolicies:p,isCollectionBye:Q,usePublishState:h,publishStatus:b,matchUpTieId:ue,isRoundRobin:T,roundProfile:P,matchUp:oe,event:M,tournamentParticipants:i,positionAssignments:r,tournamentRecord:c,seedAssignments:m,participantMap:g,contextContent:I,scheduleTiming:v,contextProfile:w,drawDefinition:y,scoringActive:S,structure:E,context:R})})}let Ee=me.sides?.filter(Q=>Q?.participantId).length===2,Le=!me.winningSide;if(Object.assign(me,{readyToScore:S&&Ee&&Le,hasContext:!0}),Ee){let{allParticipantsCheckedIn:Q,checkedInParticipantIds:se}=hh({matchUp:me});Object.assign(me,{allParticipantsCheckedIn:Q,checkedInParticipantIds:se})}return Array.isArray(w?.exclude)&&w?.exclude.forEach(Q=>delete me[Q]),me}function Rbe({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:r,timeStamp:n}=uf({timeItems:i?.timeItems||[],itemType:lu});return!e||n&&t&&new Date(n).getTime()>new Date(t).getTime()?{allocatedCourts:ke(r,!1,!0)}:e}function Cbe({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:r,timeStamp:n}=uf({timeItems:i?.timeItems||[],itemType:Id});return!e||n&&t&&new Date(n).getTime()>new Date(t).getTime()?{courtId:r}:e}function Mbe({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:r,timeStamp:n}=uf({timeItems:i?.timeItems||[],itemType:ph});return!e||n&&t&&new Date(n).getTime()>new Date(t).getTime()?{venueId:r}:e}function Hu(t){if(!Array.isArray(t.matchUps))return[];let{matchUps:e,excludeMatchUpStatuses:i,hasParticipantsCount:r,isCollectionMatchUp:n,matchUpStatuses:a,hasWinningSide:s,matchUpFormats:o,roundPositions:l,matchUpFormat:u,collectionIds:c,isMatchUpTie:d,roundNumbers:p,matchUpIds:f,roundNames:m,filterMatchUpTypes:h=!0,filterMatchUpIds:g=!0,stageSequences:I,scheduledDates:v,scheduledDate:w,participantIds:y,processContext:b,tournamentIds:S,matchUpTypes:U,structureIds:T,readyToScore:P,courtIds:D,eventIds:E,venueIds:R,drawIds:C,stages:M}=t,N=Array.isArray(y)?y.filter(Boolean):[],A=Array.isArray(a)?a.filter(Boolean):[],O=Array.isArray(i)?i.filter(Boolean):[],k=Array.isArray(M)?M.filter(Boolean):[],F=Array.isArray(I)?I.filter(Boolean):[],x=Array.isArray(c)?c.filter(Boolean):[],L=Array.isArray(m)?m.filter(Boolean):[],$=Array.isArray(p)?p.filter(Boolean):[],V=Array.isArray(l)?l.filter(Boolean):[],_=Array.isArray(f)&&g?f.filter(Boolean):[],B=Array.isArray(U)&&h?U.filter(Boolean):[],G=Array.isArray(D)?D.filter(Boolean):[],j=Array.isArray(R)?R.filter(Boolean):[],K=Array.isArray(o)&&o.filter(Boolean)||typeof u=="string"&&[u]||[],Y=Array.isArray(v)&&v.filter(Boolean)||typeof w=="string"&&w.length&&[w]||[],X=Array.isArray(S)?S.filter(Boolean):[],Z=Array.isArray(E)?E.filter(Boolean):[],J=Array.isArray(C)?C.filter(Boolean):[],ae=Array.isArray(T)?T.filter(Boolean):[];return e.filter(te=>{if(P&&!Di(ka)(te)&&!te.readyToScore||te.winningSide&&s&&![1,2].includes(te.winningSide)||d!==void 0&&(d&&!te.tieMatchUps||!d&&te.tieMatchUps)||n!==void 0&&(n&&!te.collectionId||!n&&te.collectionId)||k.length&&!k.includes(te.stage)||F.length&&!F.includes(te.stageSequence)||x.length&&(!te.collectionId||!x.includes(te.collectionId))||L.length&&(!te.roundName||!L.includes(te.roundName))||$.length&&(!te.roundNumber||!$.includes(te.roundNumber))||V.length&&(!te.roundPosition||!V.includes(te.roundPosition))||A.length&&(!te.matchUpStatus||!A.includes(te.matchUpStatus))||O.length&&te.matchUpStatus&&O.includes(te.matchUpStatus)||_.length&&!_.includes(te.matchUpId)||B.length&&(!te.matchUpType||!em(B,te.matchUpType))||K.length&&(!te.matchUpFormat||!K.includes(te.matchUpFormat)))return!1;if(Y?.length){let{scheduledTime:ne}=cL({matchUp:te}),{scheduledDate:le}=cf({matchUp:te}),de=Qe(ne)||le;if(!Y.some(pe=>tu(pe,de)))return!1}if(G.length){let{courtId:ne}=Cbe({matchUp:te}),{allocatedCourts:le}=Rbe({matchUp:te}),de=le?.map(({courtId:pe})=>pe);if(!G.filter(Boolean).includes(ne)||de?.includes(ne))return!1}if(j.length){let{venueId:ne}=Mbe({matchUp:te});if(!j.filter(Boolean).includes(ne))return!1}if(b){if(X.length&&!X.includes(te.tournamentId)||Z.length&&!Z.includes(te.eventId)||J.length&&!J.includes(te.drawId)||ae.length&&!ae.includes(te.structureId))return!1;let ne=te.sides?.map(({participantId:le})=>le).filter(Boolean)??[];if(r&&ne.length<r||N.length&&!N.some(le=>ne.includes(le)))return!1}return!0})}function Nt(t){let{provisionalPositioning:e,tournamentRecord:i,contextFilters:r,matchUpFilters:n,contextProfile:a,drawDefinition:s,context:o={},structure:l,inContext:u,event:c}=t,{seedAssignments:d,contextContent:p,exitProfiles:f,matchUpsMap:m}=t,h={},g={};if(!l)return{collectionPositionMatchUps:h,error:Zp,roundMatchUps:g,matchUps:[]};let I=Array.isArray(n?.eventIds)?n?.eventIds.filter(Boolean):[],v=Array.isArray(n?.structureIds)?n?.structureIds.filter(Boolean):[],w=Array.isArray(n?.drawIds)?n?.drawIds.filter(Boolean):[],y=!o?.eventId||!I?.length&&!r?.eventIds?.filter(Boolean).length||I?.includes(o.eventId)||r?.eventIds?.includes(o.eventId),b=!v?.length||v.includes(l.structureId),S=!s||!w?.length||w.includes(s.drawId);if(!y||!b||!S)return{collectionPositionMatchUps:h,roundMatchUps:g,matchUps:[]};a&&!p&&(p=Lc({tournamentRecord:i,contextProfile:a,drawDefinition:s}));let{appliedPolicies:U}=Tt({drawDefinition:s}),T={...t.tournamentAppliedPolicies,...U,...t.policyDefinitions},P=T?.scoring?.structures,D=l.stage&&P?.stage?.[l.stage],E=l.stageSequence&&D?.stageSequence?.[l.stageSequence],R=T?.scoring?.requireAllPositionsAssigned||D?.requireAllPositionsAssigned||E?.requireAllPositionsAssigned;m||(m=kr({drawDefinition:s,structure:l}));let{positionAssignments:C,allPositionsAssigned:M}=ur({structure:l}),N=!R||M,{seedAssignments:A}=ds({provisionalPositioning:e,drawDefinition:s,structure:l});d=d??A;let{structureId:O}=l;f=f||s&&CK({drawDefinition:s}).exitProfiles;let k=f?.[O],F=k?.length&&(k[0].split("-").map(G=>parseInt(G)).reduce((G,j)=>G+j)||0),x=!!l.structures,L=gd({matchUpsMap:m,structureId:O,inContext:u}),$=T?.[uc],V=NK({roundNamingPolicy:$,drawDefinition:s,structure:l,matchUps:L}),{roundNamingProfile:_,roundProfile:B}=V;if(g=V?.roundMatchUps??[],n&&(L=Hu({matchUps:L,...n,filterMatchUpTypes:!1,filterMatchUpIds:!1})),u){let{sourceDrawPositionRanges:G}=Yye({drawDefinition:s,matchUpsMap:m,structureId:O}),j=s?Kye({drawDefinition:s,roundProfile:B,matchUpsMap:m,structureId:O}).drawPositionsRanges:void 0,K=t.tournamentParticipants,Y=t.participantMap;!K?.length&&!Y&&i&&({participants:K=[],participantMap:Y}=af({participantsProfile:t.participantsProfile,useParticipantMap:t.useParticipantMap,policyDefinitions:t.policyDefinitions,tournamentRecord:i,contextProfile:a,inContext:u})),L=L.map(X=>JK({scheduleVisibilityFilters:t.scheduleVisibilityFilters,hydrateParticipants:t.hydrateParticipants,afterRecoveryTimes:t.afterRecoveryTimes,usePublishState:t.usePublishState,scheduleTiming:t.scheduleTiming,publishStatus:t.publishStatus,sourceDrawPositionRanges:G,tournamentParticipants:K,positionAssignments:C,drawPositionsRanges:j,initialRoundOfPlay:F,roundNamingProfile:_,tournamentRecord:i,appliedPolicies:T,seedAssignments:d,contextContent:p,participantMap:Y,contextProfile:a,drawDefinition:s,scoringActive:N,isRoundRobin:x,roundProfile:B,structure:l,context:o,matchUp:X,event:c})),(L?.filter(X=>Array.isArray(X.tieMatchUps))).forEach(X=>{let Z=X.tieMatchUps;L=L.concat(...Z)}),r&&(L=Hu({processContext:!0,...r,matchUps:L}))}else(L?.filter(G=>Array.isArray(G.tieMatchUps))).forEach(G=>{let j=G.tieMatchUps;L=L.concat(...j)});return n&&(L=Hu({matchUps:L,...n,filterMatchUpTypes:!1,filterMatchUpIds:!1})),(n?.matchUpTypes||n?.matchUpIds)&&(L=Hu({matchUpTypes:n.matchUpTypes,matchUpIds:n.matchUpIds,matchUps:L})),(n?.matchUpTypes||n?.matchUpIds||u)&&(g=bn({matchUps:L}).roundMatchUps??[]),vn({drawDefinition:s,structure:l,event:c})?.tieFormat&&({collectionPositionMatchUps:h}=zye({matchUps:L})),{collectionPositionMatchUps:h,roundMatchUps:g,isRoundRobin:x,roundProfile:B,matchUpsMap:m,matchUps:L}}function mp({matchUp:t}){return t?Yi.includes(t?.matchUpStatus)||t?.winningSide:!1}function _R({requireParticipants:t=!0,scheduleVisibilityFilters:e,tournamentAppliedPolicies:i,tournamentParticipants:r,hydrateParticipants:n,afterRecoveryTimes:a,policyDefinitions:s,tournamentRecord:o,usePublishState:l,matchUpFilters:u,contextFilters:c,contextContent:d,participantMap:p,scheduleTiming:f,publishStatus:m,contextProfile:h,drawDefinition:g,exitProfiles:I,matchUpsMap:v,structureId:w,inContext:y,structure:b,context:S,event:U}){!b&&w&&({structure:b}=et({drawDefinition:g,structureId:w}));let T=Nt({tournamentAppliedPolicies:i,scheduleVisibilityFilters:e,tournamentParticipants:r,hydrateParticipants:n,afterRecoveryTimes:a,policyDefinitions:s,tournamentRecord:o,usePublishState:l,matchUpFilters:u,contextFilters:c,contextContent:d,participantMap:p,scheduleTiming:f,publishStatus:m,contextProfile:h,drawDefinition:g,exitProfiles:I,matchUpsMap:v,structure:b,inContext:y,context:S,event:U}),P=[],D=[],E=[],R=[],C=[];if(T.error)return T;let{matchUps:M}=T,{assignedPositions:N}=ur({structure:b}),A=N?.filter(k=>k.participantId).map(k=>k.drawPosition),O;return M.filter(k=>{let F=u?.matchUpTypes?.length===1&&u.matchUpTypes[0]===Zt;return!(k.matchUpType!==Zt&&F)}).forEach(k=>{if(k.matchUpStatus===us){P.push(k);return}k.matchUpType===Zt&&(O=!0);let F=!!k.collectionId,x=F&&k.sides?.every(G=>G.participantId),L=!F&&k.drawPositions?.filter(Boolean).length===2,$=!F&&k.drawPositions?.every(G=>A?.includes(G)),V=N?.filter(G=>G.bye).map(G=>G.drawPosition),_=!F&&k.drawPositions?.find(G=>V?.includes(G)),B=lK.includes(k.matchUpStatus)&&(x||L&&(!t||$));return _?C.push(k):mp({matchUp:k})?D.push(k):B?E.push(k):R.push(k)}),{includesTeamMatchUps:O,abandonedMatchUps:P,completedMatchUps:D,upcomingMatchUps:E,pendingMatchUps:R,byeMatchUps:C,structure:b}}function Nbe({drawDefinition:t,roundNumber:e,structureId:i}){if(!t)return{error:_e};if(!i)return{error:Va};let{links:r}=uv({drawDefinition:t,structureId:i}),n=r.source.reduce((s,o)=>!o.source.roundNumber||o.source.roundNumber===e?s.concat(o):s,[]),a=r.target.reduce((s,o)=>!o.target.roundNumber||o.target.roundNumber===e?s.concat(o):s,[]);return{links:{source:n,target:a}}}function EA({finishingPositions:t,linkCondition:e,linkType:i,source:r}){let n=r.find(a=>{let s=!a.source?.finishingPositions||!t||kn(t,a.source?.finishingPositions);return e===a.linkCondition&&s&&a.linkType===i});return[ru,nu].includes(n?.linkType)&&!n?.source?.roundNumber?z({result:{error:ie},stack:"getTargetLink",context:n}):n}function uv({drawDefinition:t,structureId:e,roundNumber:i}){return t?e?{links:(t.links||[]).filter(Boolean).reduce((r,n)=>(n.source?.structureId===e&&(!i||n.source.roundNumber===i)&&(r.source=r.source.concat(n)),n.target?.structureId===e&&(!i||n.target.roundNumber===i)&&(r.target=r.target.concat(n)),r),{source:[],target:[]})}:{error:Va}:{error:_e}}function Abe({structureMatchUps:t,matchUp:e}){let{roundNumber:i,roundPosition:r}=e,n=t.filter(s=>s.roundNumber===i&&!s.matchUpTieId),a=t.filter(s=>s.roundNumber===i+1&&!s.matchUpTieId);if(a.length){let s;return a.length===n.length?s=a.find(o=>o.roundPosition===r):a.length===n.length/2&&(s=a.find(o=>o.roundPosition===Math.ceil(r/2))),{matchUp:s}}return{message:"no progression found"}}function RA({sourceRoundMatchUpCount:t,inContextDrawMatchUps:e,sourceRoundPosition:i,drawDefinition:r,targetLink:n}){if(!n)return{error:_1};let{target:{structureId:a,feedProfile:s,groupedOrder:o,roundNumber:l,positionInterleave:u}}=n,{structure:c}=et({drawDefinition:r,structureId:a}),{positionAssignments:d}=Yt({structure:c}),p=(e?.filter(P=>P.structureId===c?.structureId)).filter(P=>P.roundNumber===l&&!P.matchUpTieId),f=p.length,m=Re(1,f+1),h=f/t,g=Math.ceil(h*i),I=1-i%2;if(u?.interleave&&h!==.5){let P=u.offset+(i-1)*u.interleave,D=i+P;g=Math.ceil(D/2),I=1-D%2}let v=m,w=m[g-1],y=RK({roundPositionsCount:m.length,groupedOrder:o}),b=y?.length||1;if(b<=m.length){let P=f/b,D=yr(m,P);s===Pp&&D.forEach(E=>E.reverse()),v=y?.length&&y?.map(E=>D[E-1]).flat()||v}s===Ms?w=v[g-1]:s===Pp?((!y?.length||b>m.length)&&(g=p.length+1-g),w=v[g-1]):s===cR&&ra()&&console.log(iF,{feedProfile:s});let S=w&&p.reduce((P,D)=>D.roundPosition===w?D:P,void 0),U;S?.feedRound?(I=0,U=Math.min(...(S.drawPositions||[]).filter(Boolean))):U=S?.drawPositions?.length===2&&S?.drawPositions[I];let T=d?.find(({drawPosition:P})=>P===U);if(T){let{extension:P}=mt({element:T,name:SR});if(P?.value)return{disabledDrawPosition:U}}return{matchUp:S,targetDrawPosition:U,matchUpDrawPositionIndex:I}}function On({inContextDrawMatchUps:t=[],useTargetMatchUpIds:e,inContextMatchUp:i,drawDefinition:r,matchUpId:n}){let a=i;t.length&&!a&&(a=t.find(o=>o.matchUpId===n));let{structure:s}=et({structureId:a?.structureId,drawDefinition:r});return s?.finishingPosition===lh?kbe({inContextDrawMatchUps:t,useTargetMatchUpIds:e,drawDefinition:r,structure:s,matchUp:a}):Obe({matchUp:a})}function kbe({inContextDrawMatchUps:t,useTargetMatchUpIds:e,drawDefinition:i,structure:r,matchUp:n}){let{winnerMatchUpId:a,loserMatchUpId:s}=n,{links:o}=Nbe({roundNumber:n.roundNumber,structureId:r.structureId,drawDefinition:i}),l=o?.source,u=EA({source:l,linkType:ru}),c=EA({linkCondition:al,linkType:nu,source:l}),d=EA({source:l,linkType:nu}),p=c&&d;d||(d=c);let f=u?.target?.feedProfile,m=d?.target?.feedProfile,h=c?.target?.feedProfile,g,I,v,w,y,b,S,U,T,P;if(e&&(a||s)&&(S=a&&f!==Cs&&t.find(({matchUpId:R})=>R===a),w=s&&m!==Cs&&t.find(({matchUpId:R})=>R===s),S||w))return{matchUp:n,targetLinks:{loserTargetLink:d,winnerTargetLink:u},targetMatchUps:{loserMatchUp:w,winnerMatchUp:S}};let{roundPosition:D}=n;P=P||t.filter(R=>R.structureId===r.structureId);let E=P.reduce((R,C)=>C.roundNumber===n.roundNumber&&!C.matchUpTieId?R+1:R,0);return d&&!w&&m!==Cs&&({matchUpDrawPositionIndex:b,targetDrawPosition:y,matchUp:w}=RA({targetLink:d,sourceRoundMatchUpCount:E,inContextDrawMatchUps:t,sourceRoundPosition:D,drawDefinition:i})),p&&h!==Cs&&({matchUpDrawPositionIndex:v,targetDrawPosition:I,matchUp:g}=RA({targetLink:c,sourceRoundMatchUpCount:E,inContextDrawMatchUps:t,sourceRoundPosition:D,drawDefinition:i})),u&&!S&&f!==Cs&&({matchUpDrawPositionIndex:T,targetDrawPosition:U,matchUp:S}=RA({targetLink:u,sourceRoundMatchUpCount:E,inContextDrawMatchUps:t,sourceRoundPosition:D,drawDefinition:i})),S||(P=P||t.filter(R=>R.structureId===r.structureId),{matchUp:S}=Abe({structureMatchUps:P,matchUp:n})),Ve({matchUp:n,targetLinks:{loserTargetLink:d,winnerTargetLink:u,byeTargetLink:c},targetMatchUps:{winnerMatchUpDrawPositionIndex:T,loserMatchUpDrawPositionIndex:b,byeMatchUpDrawPositionIndex:v,winnerTargetDrawPosition:U,loserTargetDrawPosition:y,byeTargetDrawPosition:I,winnerMatchUp:S,loserMatchUp:w,byeMatchUp:g},targetMatchUpIds:!!(a||s)})}function Obe({matchUp:t}){return{targetLinks:{loserTargetLink:void 0,winnerTargetLink:void 0},targetMatchUps:{loserMatchUp:void 0,winnerMatchUp:void 0},matchUp:t}}function xbe({drawDefinition:t,inContextDrawMatchUps:e}){let i={};return e.forEach(r=>{let{matchUpId:n,structureId:a,drawPositions:s=[]}=r,{structure:o}=et({drawDefinition:t,structureId:a});if(o?.finishingPosition===Ep){let{roundNumber:l}=r,u=l&&Ye(l)+1,c=o.matchUps??[],{roundMatchUps:d}=bn({matchUps:c});if(u&&d?.[u]){let p=[...s].sort(ir).map((f,m)=>{let h=d[u].find(g=>g.drawPositions?.includes(f));return{matchUpId:h?.matchUpId,roundNumber:u,schedule:h?.schedule,sideNumber:m+1,structureName:o.structureName}});Object.assign(r,{sidesTo:p})}}else{let l=On({useTargetMatchUpIds:!0,inContextDrawMatchUps:e,inContextMatchUp:r,drawDefinition:t,matchUpId:n}),{winnerMatchUp:u}=l.targetMatchUps,{loserMatchUp:c}=l.targetMatchUps;!r.winnerMatchUpId&&u&&(r.winnerMatchUpId=u.matchUpId),!r.loserMatchUpId&&c&&(r.loserMatchUpId=c.matchUpId);let d=CA({upcomingMatchUp:u}),p=CA({upcomingMatchUp:c});if(r.matchUpStatus!=="BYE"&&c?.matchUpStatus==="BYE"){let{matchUp:m}=QK({matchUp:c,drawDefinition:t,inContextDrawMatchUps:e})||{};p=m&&CA({upcomingMatchUp:m})||p}let f=r.schedule?.timeAfterRecovery;if(f&&(d?.schedule?.scheduledTime&&Pt(d.schedule.scheduledTime)<Pt(f)&&(i[d.matchUpId]=r.matchUpId,d.schedule.scheduleConflict=r.matchUpId),p?.schedule?.scheduledTime&&Pt(p.schedule.scheduledTime)<Pt(f)&&(i[p.matchUpId]=r.matchUpId,p.schedule.scheduleConflict=r.matchUpId)),Object.assign(r,{winnerTo:d,loserTo:p}),r.drawPositions?.filter(Boolean).length){let m=l.targetLinks?.loserTargetLink?.linkCondition===al,h=Fbe(r);if(h.length){let g=cO(u?.sides),I=cO(c?.sides),v=h.find(({participantId:y})=>g.includes(y))?[]:h,w=h.find(({participantId:y})=>I.includes(y))?[]:h;c&&m&&w.length<2&&w.push({bye:!0,tbd:!0}),v?.length&&u&&(!l.targetMatchUpIds&&u&&(u=e.find(({matchUpId:y})=>y===u.matchUpId)),u.potentialParticipants||(u.potentialParticipants=[]),u.potentialParticipants.push(v)),w?.length&&c&&(l.targetMatchUpIds||(u=e.find(({matchUpId:y})=>y===c.matchUpId)),c.potentialParticipants||(c.potentialParticipants=[]),c.potentialParticipants.push(w))}}}}),Object.keys(i).length&&e.forEach(r=>{Object.keys(i).includes(r.matchUpId)&&(r.schedule.scheduleConflict=i[r.matchUpId])}),{scheduleConflictMatchUpIds:i}}function Fbe(t){return t?.sides?.map(({participant:e,participantId:i,qualifier:r})=>e||i&&{participantId:i}||r&&{qualifier:r}).filter(Boolean)||[]}function QK({matchUp:t,drawDefinition:e,inContextDrawMatchUps:i}){let{matchUpId:r,matchUpStatus:n,structureId:a}=t||{};if(!t||!a||t?.matchUpStatus===Fi)return{matchUp:t};if(n==="BYE"){let s;return t.winnerMatchUpId?s=i.find(({matchUpId:o})=>o===t.winnerMatchUpId):{winnerMatchUp:s}=On({inContextDrawMatchUps:i,drawDefinition:e,matchUpId:r})?.targetMatchUps||{},QK({matchUp:s,drawDefinition:e,inContextDrawMatchUps:i})}return{matchUp:void 0}}function CA(t){if(t?.upcomingMatchUp)return(({matchUpId:e,structureId:i,schedule:r,roundNumber:n,roundPosition:a,structureName:s})=>({matchUpId:e,structureId:i,schedule:r,roundNumber:n,roundPosition:a,structureName:s}))(t.upcomingMatchUp)}function Qi(t){let e="getAllDrawMatchUps";Object.assign(t,{requireParticipants:!1});let i=cv(t);if(i.error)return z({result:i,stack:e});let{abandonedMatchUps:r,completedMatchUps:n,upcomingMatchUps:a,pendingMatchUps:s,byeMatchUps:o,matchUpsMap:l}=i;return{matchUps:(r??[]).concat(...n??[],...a??[],...s??[],...o??[]),matchUpsMap:l}}function cv(t){if(!t?.drawDefinition)return{error:_e};let{tournamentParticipants:e,contextContent:i,matchUpsMap:r}=t,{scheduleVisibilityFilters:n,tournamentAppliedPolicies:a,requireParticipants:s,participantsProfile:o,afterRecoveryTimes:l,policyDefinitions:u,tournamentRecord:c,usePublishState:d,contextFilters:p,matchUpFilters:f,scheduleTiming:m,participantMap:h,publishStatus:g,contextProfile:I,drawDefinition:v,nextMatchUps:w,inContext:y,context:b,event:S}=t,U=[],T=[],P=[],D=[],E=[];I&&!i&&(i=Lc({policyDefinitions:u,tournamentRecord:c,contextProfile:I,event:S}));let R;!e?.length&&c&&(e=c?.participants,(y||o?.withGroupings)&&e?.length&&({participantsWithGroupings:e,groupInfo:R}=RR({participants:e,participantsProfile:o})));let{structures:C}=Js({drawDefinition:v});if(!C)return{error:Ii};r||(r=kr({drawDefinition:v}));let M=v&&CK({drawDefinition:v}).exitProfiles;C.forEach(O=>{let{byeMatchUps:k=[],pendingMatchUps:F=[],upcomingMatchUps:x=[],completedMatchUps:L=[],abandonedMatchUps:$=[]}=_R({matchUpFilters:w?void 0:f,contextFilters:w?void 0:p,inContext:y||w||p,hydrateParticipants:t.hydrateParticipants,tournamentAppliedPolicies:a,scheduleVisibilityFilters:n,tournamentParticipants:e,requireParticipants:s,afterRecoveryTimes:l,policyDefinitions:u,tournamentRecord:c,usePublishState:d,contextContent:i,participantMap:h,scheduleTiming:m,publishStatus:g,contextProfile:I,drawDefinition:v,exitProfiles:M,matchUpsMap:r,structure:O,context:b,event:S});U=U.concat(...$),T=T.concat(...L),P=P.concat(...x),D=D.concat(...F),E=E.concat(...k)});let N=O=>(!f&&!w&&!p||(f&&(O=Hu({matchUps:O,...f})),p&&(O=Hu({matchUps:O,...p,processContext:!0}))),O),A={abandonedMatchUps:N(U),completedMatchUps:N(T),upcomingMatchUps:N(P),pendingMatchUps:N(D),byeMatchUps:N(E),matchUpsMap:r,...H,groupInfo:R};if(w){let O=typeof w=="object"||{abandoned:!0,completed:!0,upcoming:!0,pending:!0,bye:!0},{abandoned:k,completed:F,upcoming:x,pending:L,bye:$}=O,V=[].concat(...k&&U||[],...F&&T||[],...x&&P||[],...L&&D||[],...$&&E||[]);xbe({inContextDrawMatchUps:V,drawDefinition:v})}return A}function Ru(t){let{participants:e=[],contextContent:i,participantMap:r}=t,{scheduleVisibilityFilters:n,tournamentAppliedPolicies:a,participantsProfile:s,afterRecoveryTimes:o,policyDefinitions:l,useParticipantMap:u,tournamentRecord:c,usePublishState:d,contextFilters:p,matchUpFilters:f,contextProfile:m,nextMatchUps:h,inContext:g,context:I,event:v}=t;if(!v)return{error:li};let{eventId:w,eventName:y,endDate:b,eventType:S,category:U,gender:T,matchUpFormat:P}=v??{},D={...I,...Ve({indoorOutDoor:v.indoorOutdoor??c?.indoorOutdoor,surfaceCategory:v.surfaceCategory??c?.surfaceCategory,endDate:v.endDate??c?.endDate,tournamentId:c?.tournamentId,matchUpFormat:P,eventName:y,eventType:S,category:U,eventId:w,gender:T})};b&&(D.endDate=b),m&&!i&&(i=Lc({policyDefinitions:l,tournamentRecord:c,contextProfile:m,event:v}));let E;if(!e?.length&&!r&&c){let M=af({participantsProfile:s,useParticipantMap:u,tournamentRecord:c,contextProfile:m,inContext:g});r=M.participantMap,e=M.participants??[],E=M.groupInfo}let R=v.drawDefinitions??[],C=Xw({tournamentRecord:c,event:v}).scheduleTiming;return{matchUps:R.flatMap(M=>{let{matchUps:N}=Qi({tournamentParticipants:e,tournamentAppliedPolicies:a,scheduleVisibilityFilters:n,context:D,participantsProfile:s,afterRecoveryTimes:o,policyDefinitions:l,tournamentRecord:c,usePublishState:d,contextFilters:p,contextProfile:m,drawDefinition:M,contextContent:i,matchUpFilters:f,participantMap:r,scheduleTiming:C,nextMatchUps:h,inContext:g,event:v});return N??[]}),groupInfo:E}}function br(t){let e=Ge(t,[{tournamentRecord:!0}]);if(e.error)return e;if(!t?.tournamentRecord)return{error:Ie};let{participantMap:i,participants:r}=t,{scheduleVisibilityFilters:n,participantsProfile:a,afterRecoveryTimes:s,useParticipantMap:o,policyDefinitions:l,tournamentRecord:u,inContext:c=!0,usePublishState:d,contextProfile:p,matchUpFilters:f,contextFilters:m,nextMatchUps:h,context:g}=t,I=t.tournamentId??u.tournamentId,v=u?.events??[];r||({participants:r,participantMap:i}=af({participantsProfile:a,useParticipantMap:o,tournamentRecord:u,contextProfile:p,inContext:c}));let{appliedPolicies:w}=Tt({tournamentRecord:u}),y={...g,tournamentId:I,indoorOutDoor:u.indoorOutdoor,surfaceCategory:u.surfaceCategory,endDate:u.endDate},b=Lc({policyDefinitions:l,tournamentRecord:u,contextProfile:p});return{matchUps:v.flatMap(S=>(y.eventDrawsCount=S.drawDefinitions?.length??0,Ru({context:y,scheduleVisibilityFilters:n,tournamentAppliedPolicies:w,participantsProfile:a,afterRecoveryTimes:s,policyDefinitions:l,tournamentRecord:u,usePublishState:d,contextContent:b,contextFilters:m,contextProfile:p,matchUpFilters:f,participantMap:i,nextMatchUps:h,participants:r,inContext:c,event:S}).matchUps??[])).concat(...u.matchUps??[])}}function Eo({scheduleVisibilityFilters:t,afterRecoveryTimes:e,participantsProfile:i,tournamentRecords:r,policyDefinitions:n,usePublishState:a,matchUpFilters:s,contextFilters:o,nextMatchUps:l,inContext:u}){if(typeof r!="object"||!Object.keys(r).length)return{error:Ci};let c=Object.keys(r).map(d=>{let p=r[d];return br({scheduleVisibilityFilters:t,afterRecoveryTimes:e,participantsProfile:i,policyDefinitions:n,tournamentRecord:p,usePublishState:a,matchUpFilters:s,contextFilters:o,nextMatchUps:l,inContext:u}).matchUps??[]}).flat();return{...H,matchUps:c}}function gh(t,e){return Lbe(t,e)||(t?.stageSequence||0)-(e?.stageSequence||0)||t?.roundNumber&&e.roundNumber&&t?.roundNumber-e?.roundNumber||(t?.roundPosition??0)-(e?.roundPosition??0)}function Lbe(t,e){return(Em[t?.stage]||0)-(Em[e?.stage]||0)}function Rn(t){let{participants:e,participantMap:i,contextContent:r}=t,{scheduleVisibilityFilters:n,tournamentAppliedPolicies:a,participantsProfile:s,afterRecoveryTimes:o,policyDefinitions:l,useParticipantMap:u,tournamentRecord:c,matchUpFilters:d,contextFilters:p,contextProfile:f,drawDefinition:m,nextMatchUps:h,inContext:g,context:I,event:v}=t,{eventId:w,eventName:y,endDate:b,eventType:S,category:U,gender:T,matchUpFormat:P}=v??{},D={...I,surfaceCategory:v?.surfaceCategory??c?.surfaceCategory,indoorOutDoor:v?.indoorOutdoor??c?.indoorOutdoor,matchUpFormat:P,eventType:S,eventName:y,category:U,eventId:w,endDate:b,gender:T},E;return!e?.length&&!i&&c&&({participants:e=[],participantMap:i,groupInfo:E}=af({participantsProfile:s,useParticipantMap:u,tournamentRecord:c,contextProfile:f,inContext:g})),f&&!r&&(r=Lc({policyDefinitions:l,tournamentRecord:c,contextProfile:f,drawDefinition:m,event:v})),{...Qi({context:D,tournamentAppliedPolicies:a,scheduleVisibilityFilters:n,tournamentParticipants:e,participantsProfile:s,afterRecoveryTimes:o,policyDefinitions:l,tournamentRecord:c,drawDefinition:m,contextContent:r,contextFilters:p,contextProfile:f,matchUpFilters:d,participantMap:i,nextMatchUps:h,inContext:g,event:v}),groupInfo:E}}function hp({element:t,accessor:e}){if(typeof e!="string")return{values:[]};let i=ke(t),r=e.split("."),n=[],a;o({targetElement:i,attributes:r});let s={value:a};return n.length&&(s.values=n),s;function o({targetElement:l,attributes:u=[],significantCharacters:c}){for(let[p,f]of u.entries())if(l?.[f]){let m=u.slice(p+1);m.length?Array.isArray(l[f])?l[f].forEach(h=>o({targetElement:h,attributes:m})):(l=l[f],d({targetElement:l,index:p})):(a||(a=l[f]),n.includes(l[f])||n.push(l[f]))}function d({targetElement:p,index:f}){if(p&&f===u.length-1&&["string","number"].includes(typeof p)){let m=c?p.slice(0,c):p;a?n.includes(m)||n.push(m):(a=m,n.push(m))}}}}var ZK=t=>e=>!t||typeof e!="object"?void 0:Array.isArray(t)&&t.map(i=>({[i]:hp({element:e,accessor:i})?.value}))||typeof t=="object"&&Object.keys(t).map(i=>({[i]:hp({element:e,accessor:i})?.value}))||(typeof t=="string"&&hp({element:e,accessor:t}))?.value,ba=ZK;function oS({finishingPositionOffset:t=0,finishingPositionLimit:e,positionsFed:i,roundsCount:r,roundLimit:n,matchUps:a,lucky:s,fmlc:o}){if(!Ga(a))return[];let{roundProfile:l,roundNumbers:u=[]}=bn({interpolate:!0,matchUps:a});r=r??Math.max(...u,0);let c=n?r-n:0,d=c&&l?.[r-c]?.matchUpsCount,p=l&&Object.values(l).map(ba("matchUpsCount")),f=(g,I)=>{let v=Math.min(...g);d&&I&&v===1&&(v=d);let w=Math.max(...g);return e&&w>e&&(w=e),[v,w]},m=l&&Object.assign({},...u.map(g=>{let I=(r??0)+1-g-c,v=l[g].matchUpsCount,w={finishingPositionRange:{},finishingRound:I},y=p?.slice(g-1).reduce((R,C)=>R+(C||0),0),b=o&&g!==1,S=1+t+(b?i??0:0),U=1,T=Re(S,s?S+v*2:y+S+U),P=y+U-v,D=f(T.slice(P)),E=f(T.slice(0,P),!0);return w.finishingPositionRange={loser:D,winner:E},{[g]:w}})),h=ra({finishingRound:!0});return a.filter(Boolean).forEach(g=>{let I=g.roundNumber&&m[g.roundNumber];h&&!I&&console.log({roundFinishingData:m,matchUp:g}),g.finishingRound=I?.finishingRound,g.finishingPositionRange=I?.finishingPositionRange}),a}function Np({inContextDrawMatchUps:t,drawDefinition:e,matchUpsMap:i}){if(!e)return{error:_e};let r={loserMatchUpIds:{},winnerMatchUpIds:{}};if(t||({matchUps:t,matchUpsMap:i}=Qi({inContext:!0,drawDefinition:e,matchUpsMap:i})),!i?.drawMatchUps.some(n=>n.finishingPositionRange)&&e?.structures?.length===1&&!e?.structures[0].structures){let n=i?.drawMatchUps??[];oS({matchUps:n})}return(t??[]).filter(({collectionId:n})=>!n).forEach(n=>{let{matchUpId:a,structureId:s}=n,o=On({inContextDrawMatchUps:t,drawDefinition:e,matchUpId:a}),{winnerMatchUp:l,loserMatchUp:u}=o.targetMatchUps,c=l?.matchUpId,d=u?.matchUpId,p=gd({matchUpsMap:i,structureId:s}).find(f=>f.matchUpId===a);if(p&&(c&&(r.winnerMatchUpIds[p.matchUpId]=c,Object.assign(p,{winnerMatchUpId:c}),Object.assign(n,{winnerMatchUpId:c})),d&&(r.loserMatchUpIds[p.matchUpId]=d,n.loserMatchUpId=d,p.loserMatchUpId=d,n.finishingPositionRange))){let f=u.finishingPositionRange&&[...n.finishingPositionRange.loser,...u.finishingPositionRange.loser],m=f&&[Math.min(...f),Math.max(...f)];n.finishingPositionRange.loser=m,p.finishingPositionRange.loser=m}}),{inContextDrawMatchUps:t,goesToMap:r}}function oo(t){let e=Is(t),i=t.matchUps??[],r=t.drawIds??[],{includeParticipantDependencies:n,tournamentRecord:a,drawDefinition:s}=t;if(!Array.isArray(i))return{error:Tu};if(!Array.isArray(r))return{error:Oo};let o=t.matchUpIds?.length?t.matchUpIds:i.map(v=>v.matchUpId);if(!Array.isArray(o))return{error:th};let l={},u={},c={},d={};a&&!Object.keys(e).length&&(e={[a.tournamentId]:a});let p=Object.values(e),f=p.reduce((v,w)=>v.concat(w.events??[]).map(y=>(y.drawDefinitions||[]).map(b=>b.links||[])).flat(1/0),[]).filter(({linkType:v})=>v===iu),m=i;if(f.length){m=Eo({nextMatchUps:!0,tournamentRecords:e}).matchUps;let v=f.reduce((w,y)=>{let b=y.source?.structureId,S=y.target?.structureId;return b&&S&&(c[S]=b),b&&!w.includes(b)&&w.push(b),w},[]);for(let w of v)l[w]=[];for(let w of m??[]){let y=w.containerStructureId||w.structureId;v.includes(y)&&l[y].push(w.matchUpId)}}let h=v=>{u[v]||(u[v]={dependentMatchUpIds:[],participantIds:[],matchUpIds:[],sources:[]},d[v]=[])},g=(v,w)=>{u[v].matchUpIds.forEach(y=>{u[w].matchUpIds.push(y)}),u[w].matchUpIds.push(v),u[v].dependentMatchUpIds.push(w),n&&u[v].participantIds.forEach(y=>u[w].participantIds.push(y))},I=v=>{let w=Object.keys(l).length;for(let y of v||[]){let{matchUpId:b,winnerMatchUpId:S,loserMatchUpId:U}=y;if(!o.length||o.includes(b)){if(h(b),n){let{individualParticipantIds:D}=ER(y);u[b].participantIds=D}S&&(h(S),g(b,S),d[S].push(b)),U&&(h(U),g(b,U),d[U].push(b)),u[b].sources.push(d[b]);let T=d[b].map(D=>u[D].sources[0]).flat(),P=d[b].map(D=>u[D].sources[1]).flat();if(u[b].sources.push(T,P),w){let D=y.containerStructureId||y.structureId,E=c[D];if(l[E])for(let R of l[E])h(R),g(R,b),d[R].push(b)}}}};if(s)Np({drawDefinition:s}),m?.length||(m=Rn({drawDefinition:s}).matchUps),I(m);else{if(m?.length||(m=Eo({nextMatchUps:!0,tournamentRecords:e}).matchUps),!r.length){let v=p?.length?p.map(({events:w=[]})=>w.map(({drawDefinitions:y=[]})=>y.map(({drawId:b})=>b))).flat(1/0):[];v&&(r=v)}for(let v of r){let w=m?.filter(y=>y.drawId===v).sort(gh);if(!w?.find(({roundPosition:y})=>!y)){let y=w?.find(({tournamentId:S})=>S),{drawDefinition:b}=jn({tournamentRecord:e[y?.tournamentId],drawId:v});b&&Np({drawDefinition:b})}I(w)}}return{positionDependencies:l,matchUpDependencies:u,sourceMatchUpIds:d,matchUps:m,...H}}function cr(t){let e=t?.matchUp,i=t?.score||e?.score,r=i?.sets?.[0],{side1Score:n,side2Score:a,side1TiebreakScore:s,side2TiebreakScore:o,side1PointScore:l,side2PointScore:u}=r||{},c=n||a||s||o||l||u;return!!(i?.sets?.length>1||c)}function lS({matchUpStatus:t}){return sK.includes(t)}function _be({matchUpStatus:t}){return _F.includes(t)}function IO({matchUpStatus:t}){return oK.includes(t)}function fL({matchUpStatus:t,winningSide:e,tieMatchUps:i,sides:r,score:n}){let a=r?.find(({participantId:o})=>o),s=i?.filter(fL)?.length;return cr({score:n})||s||e&&a||t&&_be({matchUpStatus:t})&&![Qt,mi,ao].includes(t)}function dv(t){let{drawDefinition:e,findContainer:i,structureId:r,event:n}=t,a=t.structure,{containedStructures:s}=lv({drawDefinition:e}),o=r?s[r]||[]:[],l={isCollectionMatchUp:!1};if(!a){let U=et({drawDefinition:e,structureId:r});if(U.error)return U;a=i?U.containingStructure??U.structure:U.structure}if(Vn({structure:a}))return{structure:a,isAdHoc:!0,error:eh};let{matchUps:u}=Qi({inContext:!0,matchUpFilters:l,drawDefinition:e,event:n}),c=u?.filter(U=>U.structureId===r||o.includes(U.structureId)),{matchUpDependencies:d}=oo({drawIds:[e.drawId],matchUps:u,drawDefinition:e}),p=[],f=[],m={},h=[];for(let U of u??[]){if(U.structureId===r||o.includes(U.structureId)){f.push(...U.drawPositions??[]);let T=U.roundNumber;for(let P of(U.drawPositions??[]).filter(Boolean))(!m[P]||T&&m[P]>T)&&(m[P]=T)}fL(U)&&(h.push(U),p.push(U.matchUpId,...d?.[U?.matchUpId]?.matchUpIds||[]))}let g=rt(f.filter(Boolean)).sort(ir),I=rt(p),v=rt(c?.map(({matchUpId:U,drawPositions:T})=>I.includes(U)?T:[]).flat().filter(Boolean)).sort(ir),{positionAssignments:w}=Yt({drawDefinition:e,structure:a}),y=w?.filter(U=>U.bye).map(U=>U.drawPosition),b=w?.filter(U=>U.qualifier).map(U=>U.drawPosition),S=g?.filter(U=>!v.includes(U))||[];return{allDrawPositions:g,inContextStructureMatchUps:c,drawPositionInitialRounds:m,activeDependentMatchUpIds:I,qualifyingDrawPositions:b,inactiveDrawPositions:S,positionAssignments:w,activeDrawPositions:v,byeDrawPositions:y,activeMatchUps:h,structure:a}}function Nm({drawPosition:t,matchUps:e=[]}){return{initialRoundNumber:e.filter(({drawPositions:i})=>t&&i?.includes(t)).map(({roundNumber:i})=>i).sort(ir)[0]}}var Yc={reset:"\x1B[0m",bright:"\x1B[1m",dim:"\x1B[2m",red:"\x1B[31m",brightred:"\x1B[91m",green:"\x1B[32m",brightgreen:"\x1B[92m",yellow:"\x1B[33m",brightyellow:"\x1B[93m",blue:"\x1B[34m",brightblue:"\x1B[94m",lightblue:"\x1B[105m",magenta:"\x1B[35m",brightmagenta:"\x1B[95m",cyan:"\x1B[36m",brightcyan:"\x1B[96m",white:"\x1B[37m",brightwhite:"\x1B[97m"},mL=[];function Gt(t,e){ri(t)&&(t={method:t}),(e||ra())&&mL.push(t)}function $be(t){return mL.slice()}function Bbe(t){let e=$be().map(i=>{let{color:r,keyColors:n,method:a,newline:s}=i,o=Object.keys(Yc).includes(r)?Yc[r]:Yc.cyan,l=Object.keys(i).filter(c=>!["color","keyColors","method","newline"].includes(c)).map(c=>{let d=n&&Object.keys(n).includes(c)&&Yc[n[c]]?Yc[n[c]]:Yc.brightwhite;return`${Yc.white}${c}: ${d}${i[c]}`}).join(", "),u=a?.length<15?"		":"	";return[s?`
`:"",o,a,u,Yc.white,l,Yc.reset,`
`].join("")});e?.length&&console.log(...e)}function Vbe(){mL.length=0}function hL(t){let e=t.bye,i=t.qualifier,r=t.participantId;return{containsBye:e,containsQualifier:i,containsParticipant:r,filled:e||i||r}}function Fr(t){return[Qt,mi,$r].includes(t)}function Wa({provisionalPositioning:t,isPositionAction:e,tournamentRecord:i,drawDefinition:r,drawPosition:n,loserMatchUp:a,matchUpsMap:s,structureId:o,structure:l,event:u}){if(!r)return{error:_e};if(l||({structure:l}=et({drawDefinition:r,structureId:o})),!l)return{error:Ii};o||({structureId:o}=l);let c="assignDrawPositionBye";Gt({method:c,color:"cyan",drawPosition:n}),s??=kr({drawDefinition:r});let{positionAssignments:d}=Yt({structure:l}),{activeDrawPositions:p}=dv({drawDefinition:r,structureId:o});if(d?.find(E=>E.drawPosition===n)?.bye)return{...H};let f=!!(a&&s.drawMatchUps.some(E=>E.loserMatchUpId===a?.matchUpId&&Fr(E.matchUpStatus)));if(p?.includes(n)&&!f)return{error:Rw};let m=d?.find(E=>E.drawPosition===n);if(!m)return{error:eh};let{filled:h,containsBye:g,containsParticipant:I}=hL(m);if(g)return{...H};if(h&&!g&&!f)return z({result:{error:Kg},stack:c});let v=Tt({tournamentRecord:i,drawDefinition:r,event:u}).appliedPolicies??{},w=Qi({inContext:!0,drawDefinition:r,matchUpsMap:s}).matchUps??[],y={isCollectionMatchUp:!1},{matchUps:b}=Nt({provisionalPositioning:t,drawDefinition:r,matchUpFilters:y,matchUpsMap:s,structure:l});if(d?.forEach(E=>{E.drawPosition===n&&(E.bye=!0,f&&(E.participantId=void 0))}),l.structureType===fn)return jbe({tournamentRecord:i,drawDefinition:r,drawPosition:n,matchUps:b}),fc({tournamentId:i?.tournamentId,drawDefinition:r,structure:l,event:u}),$H({assignedParticipantId:I,isPositionAction:e,appliedPolicies:v,drawDefinition:r,drawPosition:n,structureId:o,stack:c});let{roundProfile:S,roundMatchUps:U}=bn({matchUps:b}),T=(S&&Object.keys(S).map(E=>Number.parseInt(E)).reverse())?.find(E=>S?.[E].drawPositions?.includes(n)),P=T?U?.[T].find(({drawPositions:E})=>E?.includes(n)):void 0;P&&e7({tournamentRecord:i,drawDefinition:r,matchUp:P,event:u});let D=P?.drawPositions?.find(E=>E!==n);if(P&&D){let E=gL({sourceDrawPositions:P.drawPositions,matchUpId:P.matchUpId,inContextDrawMatchUps:w,drawPositionToAdvance:D,tournamentRecord:i,drawDefinition:r,matchUpsMap:s});if(E.error)return E}return fc({tournamentId:i?.tournamentId,drawDefinition:r,structure:l,event:u}),$H({assignedParticipantId:I,isPositionAction:e,appliedPolicies:v,drawDefinition:r,drawPosition:n,structureId:o,stack:c})}function $H({assignedParticipantId:t,isPositionAction:e,appliedPolicies:i,drawDefinition:r,drawPosition:n,structureId:a,stack:s}){return e&&qw({appliedPolicies:i,drawDefinition:r,positionAction:{removedParticipantId:t,drawPosition:n,structureId:a,name:s}}),z({result:{...H},stack:s})}function e7({tournamentRecord:t,drawDefinition:e,eventId:i,matchUp:r,event:n}){Object.assign(r,{matchUpStatus:"BYE",score:void 0,winningSide:void 0}),St({tournamentId:t?.tournamentId,eventId:i??n?.eventId,context:"setMatchUpStatusBye",drawDefinition:e,matchUp:r})}function jbe({tournamentRecord:t,drawDefinition:e,drawPosition:i,matchUps:r,event:n}){r.forEach(a=>{a.drawPositions?.includes(i)&&e7({eventId:n?.eventId,tournamentRecord:t,drawDefinition:e,matchUp:a})})}function gL({drawPositionToAdvance:t,inContextDrawMatchUps:e,sourceDrawPositions:i,tournamentRecord:r,drawDefinition:n,matchUpsMap:a,matchUpId:s,event:o}){Gt({method:"advanceDrawPosition",color:"cyan",drawPositionToAdvance:t});let l=a.drawMatchUps.find(w=>w.matchUpId===s),u=e.find(w=>w.matchUpId===s)?.structureId,{structure:c}=et({drawDefinition:n,structureId:u}),{positionAssignments:d}=Yt({structure:c}),p=d?.filter(w=>w.bye).map(w=>w.drawPosition),f=l?.drawPositions?.find(w=>w!==t),m=f&&p?.includes(f),{targetLinks:{loserTargetLink:h},targetMatchUps:{loserMatchUp:g,winnerMatchUp:I,loserTargetDrawPosition:v}}=On({inContextDrawMatchUps:e,drawDefinition:n,matchUpId:s});if(I&&I.structureId===c?.structureId&&Gbe({drawPositionToAdvance:t,inContextDrawMatchUps:e,sourceDrawPositions:i,tournamentRecord:r,drawDefinition:n,winnerMatchUp:I,matchUpsMap:a,event:o}),g&&m&&g.structureId!==c?.structureId){let{roundNumber:w}=g;if(w===1){let y=Wa({structureId:h.target.structureId,drawPosition:v,tournamentRecord:r,drawDefinition:n,event:o});if(y.error)return y}else t7({loserTargetDrawPosition:v,tournamentRecord:r,loserTargetLink:h,drawDefinition:n,loserMatchUp:g,matchUpsMap:a,event:o})}return{...H}}function Gbe({drawPositionToAdvance:t,inContextDrawMatchUps:e,sourceDrawPositions:i,tournamentRecord:r,drawDefinition:n,winnerMatchUp:a,matchUpsMap:s,event:o}){let l="advanceWinner",u=s.drawMatchUps.find(M=>M.matchUpId===a.matchUpId),c=e.find(M=>M.matchUpId===a.matchUpId)?.structureId,{structure:d}=et({drawDefinition:n,structureId:c}),{positionAssignments:p}=Yt({structure:d}),f=p?.find(({drawPosition:M})=>M===t)?.bye,m=u.drawPositions?.filter(Boolean),h=p?.filter(M=>m?.includes(M.drawPosition)),g=p?.find(({drawPosition:M})=>M===t),I=i?.find(M=>M!==t),v=(I&&h?.find(({drawPosition:M})=>M===I))?.bye,w=f&&v;if(w&&console.log({isByeAdvancedBye:w}),m?.length>1&&f&&!v)return z({result:{error:Kg},stack:l});let y=m?.find(M=>M!==t),b=w,S=[...(u.drawPositions||[]).filter(Boolean),void 0,void 0].slice(0,2),U=S.map(M=>!M&&!b||M===t?(b=!0,t):M).sort(ir);if(!b)return console.log("@@@@@@@",{advancingAssignmentIsBye:g,drawPositionToAdvance:t,existingAssignments:h}),z({result:{error:Kg},stack:l});let T=p?.find(({drawPosition:M})=>M===y)?.bye,P=p?.find(({drawPosition:M})=>M===t)?.bye;Object.assign(u,{matchUpStatus:P||T?"BYE":Fi,score:void 0,winningSide:void 0,drawPositions:U});let D=u.drawPositions.find(M=>!S.includes(M));Gt({method:l,color:"brightyellow",changedDrawPosition:D,pairedDrawPositionIsBye:T,drawPositionIsBye:P}),St({tournamentId:r?.tournamentId,matchUp:u,eventId:o?.eventId,context:l,drawDefinition:n});let{targetLinks:{loserTargetLink:E},targetMatchUps:{loserMatchUp:R,loserTargetDrawPosition:C}}=On({matchUpId:a.matchUpId,inContextDrawMatchUps:e,drawDefinition:n});if(T||P){let M=T?t:y;if(M)gL({drawPositionToAdvance:M,matchUpId:a.matchUpId,inContextDrawMatchUps:e,tournamentRecord:r,drawDefinition:n,matchUpsMap:s});else if(P&&E&&R)if(R.feedRound)t7({loserTargetDrawPosition:C,tournamentRecord:r,loserTargetLink:E,drawDefinition:n,loserMatchUp:R,matchUpsMap:s});else{let N=1-a.roundPosition%2,A=R.drawPositions[N],O=Wa({structureId:E.target.structureId,drawPosition:A,tournamentRecord:r,drawDefinition:n,event:o});if(O.error)return O}}}function t7({loserTargetDrawPosition:t,tournamentRecord:e,loserTargetLink:i,drawDefinition:r,loserMatchUp:n,matchUpsMap:a,event:s}){let{roundNumber:o}=n;Gt({method:"assignFedDrawPositionBye",color:"cyan",loserTargetDrawPosition:t});let l=(a?.mappedMatchUps||{})[n.structureId].matchUps,{initialRoundNumber:u}=Nm({drawPosition:t,matchUps:l});if(u===o){let c=Wa({structureId:i.target.structureId,drawPosition:t,tournamentRecord:e,drawDefinition:r,event:s});if(c.error)return c}}function i7({positionAssignments:t,tournamentRecord:e,drawDefinition:i,matchUpsMap:r,structure:n,event:a}){let{matchUps:s}=Nt({drawDefinition:i,matchUpsMap:r,structure:n,event:a});s.forEach(o=>{let l=t.filter(({drawPosition:u})=>o.drawPositions?.includes(u)).filter(u=>u.bye).length;o.winningSide||(Object.assign(o,{matchUpStatus:l?"BYE":Fi}),St({tournamentId:e?.tournamentId,context:"modifyRoundRobinMatchUpsStatus",eventId:a?.eventId,drawDefinition:i,matchUp:o}))})}function uS(t){let{inContextDrawMatchUps:e,participantId:i,drawPosition:r}=t,{tournamentRecord:n,drawDefinition:a,structureId:s,matchUpsMap:o,event:l}=t,{structure:u}=et({drawDefinition:a,structureId:s}),c=(ur({drawDefinition:a,structure:u}).positionAssignments||[]).find(p=>i&&p.participantId===i||r&&p.drawPosition===r);if(c&&i&&!r&&(r=c?.drawPosition),!r)return{error:JI};i||(i=c?.participantId);let{activeDrawPositions:d}=dv({drawDefinition:a,structureId:s});return d.includes(r)?{error:Rw}:(e||({matchUps:e}=Qi({inContext:!0,drawDefinition:a,matchUpsMap:o})),vO({inContextDrawMatchUps:e,tournamentRecord:n,drawDefinition:a,structureId:s,drawPosition:r,matchUpsMap:o,event:l}).drawPositionCleared?(fc({tournamentId:n?.tournamentId,drawDefinition:a,structure:u,event:l}),{...H,participantId:i}):{error:h6})}function vO({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,matchUpsMap:n,structureId:a,event:s}){let{structure:o}=et({drawDefinition:i,structureId:a});if(!o)return{error:Ii};let l=ur({drawDefinition:i,structure:o}).positionAssignments||[],u=l.some(I=>{if(I.drawPosition===r)return delete I.participantId,delete I.qualifier,delete I.bye,!0});if(o.structureType===fn)return i7({positionAssignments:l,tournamentRecord:e,drawDefinition:i,matchUpsMap:n,structure:o}),{drawPositionCleared:u,...H};let c={isCollectionMatchUp:!1},{matchUps:d}=Nt({drawDefinition:i,matchUpFilters:c,matchUpsMap:n,structure:o,event:s}),{roundProfile:p,roundMatchUps:f}=bn({matchUps:d}),m=(p&&Object.keys(p))?.map(I=>Ye(I)),h=r,g=m?.map(I=>{let v=p?.[I]?.pairedDrawPositions?.find(D=>D.includes(h)),w=v?.find(D=>D!==h),y=l.find(D=>D.drawPosition===w),b=p?.[I+1],S=y?.bye,U=b?.pairedDrawPositions?.find(D=>D.includes(w)),T=S&&U&&b&&b.drawPositions?.includes(w),P=v&&{pairedDrawPositionByeAdvancedPair:!T&&U,pairedDrawPosition:w,targetDrawPosition:h,relevantPair:v,roundNumber:I};return T&&(h=w),P}).filter(I=>I?.targetDrawPosition)?.reduce((I,v)=>{let{roundNumber:w,relevantPair:y,targetDrawPosition:b,pairedDrawPosition:S,pairedDrawPositionByeAdvancedPair:U}=v,T={roundNumber:w,targetDrawPosition:b,relevantPair:y},P=U&&{roundNumber:w+1,targetDrawPosition:S,relevantPair:U,subsequentRoundRemoval:!0},D=[T,P].filter(Boolean);return I.concat(...D)},[]);return g?.forEach(({roundNumber:I,targetDrawPosition:v,relevantPair:w})=>{let y=f?.[I].find(b=>kn(b.drawPositions?.filter(Boolean),w.filter(Boolean)));y&&(Hbe({inContextDrawMatchUps:t,targetDrawPosition:v,tournamentRecord:e,drawDefinition:i,structureId:a,roundNumber:I,matchUpsMap:n}),r7({inContextDrawMatchUps:t,positionAssignments:l,tournamentRecord:e,drawDefinition:i,targetMatchUp:y,drawPosition:r,matchUpsMap:n,structure:o,event:s}))}),{tasks:g,drawPositionCleared:u,positionAssignments:l}}function Hbe({inContextDrawMatchUps:t,targetDrawPosition:e,tournamentRecord:i,drawDefinition:r,matchUpsMap:n,roundNumber:a,structureId:s}){let{structure:o}=et({drawDefinition:r,structureId:s});if(!o)return{error:Ii};if(o.structureType===fn)return;n=n||kr({drawDefinition:r});let l=(n?.mappedMatchUps||{})[s].matchUps,{initialRoundNumber:u}=Nm({drawPosition:e,matchUps:l}),c=l?.filter(p=>p.roundNumber>=a&&p.roundNumber!==u&&p.drawPositions?.includes(e)),d=Yt({drawDefinition:r,structureId:s}).positionAssignments??[];return c?.forEach(p=>r7({drawPosition:e,targetMatchUp:p,inContextDrawMatchUps:t,positionAssignments:d,tournamentRecord:i,drawDefinition:r,matchUpsMap:n,structure:o})),{...H}}function r7({inContextDrawMatchUps:t,positionAssignments:e,tournamentRecord:i,drawDefinition:r,targetMatchUp:n,drawPosition:a,matchUpsMap:s,structure:o,event:l}){let u="removeDrawPosition",c=n.drawPositions?.slice(),d=n.matchUpStatus,p=n.winningSide;s=s??kr({drawDefinition:r});let f=s.mappedMatchUps[o.structureId].matchUps,{initialRoundNumber:m}=Nm({drawPosition:a,matchUps:f});if(n.roundNumber&&m&&n.roundNumber>m){let U=(n.drawPositions??[]).map(T=>T===a?void 0:T);n.drawPositions=U}if(n.matchUpType===Zt){let U=(t?.find(T=>T.matchUpId===n.matchUpId)?.sides??[]).reduce((T,P,D)=>P.drawPosition===a?D:T,void 0);U!==void 0&&n.sides?.[U]?.lineUp&&(delete n.sides?.[U].lineUp,St({tournamentId:i?.tournamentId,context:`${u}-TEAM`,eventId:l?.eventId,matchUp:n,drawDefinition:r}))}let h=On({matchUpId:n.matchUpId,inContextDrawMatchUps:t,drawDefinition:r}),{targetLinks:{winnerTargetLink:g},targetMatchUps:{loserMatchUp:I,winnerMatchUp:v,loserMatchUpDrawPositionIndex:w}}=h,y=e.filter(({drawPosition:U})=>n.drawPositions?.includes(U)).filter(U=>U.bye).length,b=y&&"BYE"||n.matchUpStatus&&Fr(n.matchUpStatus)&&n.matcHUpStatus||Fi;n.matchUpStatus=b,n.matchUpStatus&&Fr(n.matchUpStatus)&&(n.winningSide=void 0);let S=c?.find(U=>!n.drawPositions?.includes(U));if(c?.includes(a)&&d===n.matchUpStatus&&p===n.winningSide||(S&&Gt({method:u,color:"brightyellow",removedDrawPosition:S}),St({tournamentId:i?.tournamentId,context:`${u}-${a}`,eventId:l?.eventId,matchUp:n,drawDefinition:r})),I&&I.structureId!==h.matchUp.structureId&&!y){let{drawPositions:U,roundNumber:T}=I;if(T===1){let P=U[w];vO({structureId:I.structureId,drawPosition:P,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:r,matchUpsMap:s})}else{let P=Math.min(...U.filter(Boolean)),D=Wbe({loserMatchUpDrawPosition:P,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:r,loserMatchUp:I,matchUpsMap:s,event:l});if(D.error)return z({result:D,stack:u});let E=(s?.mappedMatchUps||{})[I.structureId].matchUps,{initialRoundNumber:R}=Nm({drawPosition:P,matchUps:E});R===1&&(Gt({method:u,color:"brightyellow",loserMatchUpDrawPosition:P}),vO({structureId:I.structureId,drawPosition:P,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:r,matchUpsMap:s}))}}return v&&v.structureId!==h.matchUp.structureId&&g.target.feedProfile,{...H}}function Wbe({loserMatchUpDrawPosition:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:r,loserMatchUp:n,matchUpsMap:a,event:s}){let{structure:o}=et({structureId:n.structureId,drawDefinition:r}),{positionAssignments:l}=Yt({structure:o});if(l?.find(u=>u.drawPosition===t)?.bye){let u=uS({drawPosition:t,structureId:n.structureId,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:r,matchUpsMap:a,event:s});if(u.error)return u}return{...H}}function df({drawDefinition:t,stages:e}){if(!t)return{error:_e};let i=(t?.structures??[]).filter(n=>!e?.length||n.stage&&e.includes(n.stage)),r=rt(i.map(n=>{let{positionAssignments:a}=Yt({structure:n});return a?a.map(vt):[]}).flat().filter(Boolean));return{...H,assignedParticipantIds:r}}function vo(t){let e=(t?.entries??[]).filter(Boolean).reduce((r,n)=>{let{entryStage:a,entryStatus:s}=n,o=`_${a||xe}${s||""}`;return r[o]||(r[o]=[]),r[o].push(n),r},{}),i=r=>isNaN(r)?1/0:r;return Object.keys(e).map(r=>e[r].sort((n,a)=>i(n.entryPosition)-i(a.entryPosition)).map((n,a)=>{let s=a+1;return{...n,entryPosition:s}})).flat()}function up(t){return[of,ys].includes(t)}function nP({autoEntryPositions:t=!0,ignoreAssignment:e,tournamentRecord:i,drawDefinition:r,participantIds:n,entryStatus:a,entryStage:s,extension:o,eventSync:l,drawId:u,stage:c,event:d}){if(!n||!Array.isArray(n))return{error:To,method:"modifyEntriesStatus",participantIds:n};if(!r&&!d)return{error:li};if(a&&!EK.includes(a))return{error:Zk};if(s&&!sR.includes(s))return{error:ef};let p="modifyEntriesStatus",f=[];if(!a&&!o)return z({result:{error:Xe},info:"Missing entryStatus",stack:p});if(o&&!sl({extension:o,requiredAttributes:["name"]}))return z({result:{error:ie},info:"Invalid extension",context:{extension:o},stack:p});let m=[];d?.drawDefinitions?.forEach(P=>{let D=df({stages:c&&[c],drawDefinition:P}).assignedParticipantIds??[];m.push(...D)});let h=i?.participants??[];if(!n.every(P=>{let D=fd({tournamentParticipants:h,participantId:P})?.participantType;return!(D&&[pt,_n].includes(D)&&up(a))&&!(a&&d?.eventType&&D===gt&&[ls,ya].includes(d.eventType)&&[Fs,...XT].includes(a))}))return{error:Zk};let g=d&&$i({event:d}).flightProfile,I=g?.flights?.find(P=>P.drawId===u),v=P=>{let D=(P||[]).filter(R=>!c||!R.entryStage||c===R.entryStage).filter(({participantId:R})=>n.includes(R)),E=R=>a&&m.includes(R.participantId)&&!(XT.includes(R.entryStatus)&&XT.includes(a));return D.every(R=>E(R)&&!e?!1:(a&&(R.entryStatus=a,delete R.entryPosition),s&&(R.entryStage=s,delete R.entryPosition),o&&(o.value?xt({element:R,extension:o}):En({element:R,name:o.name})),!0))?{...H}:{error:ev}},w=({flight:P,drawDefinition:D})=>{d&&(d.entries=vo({entries:d.entries??[]})),P&&(P.drawEntries=vo({entries:P.drawEntries})),D&&(D.entries=vo({entries:D.entries}))},y=P=>{let{flight:D,drawDefinition:E}=P,R="updateDrawEntries";if(D){let C=v(D.drawEntries);if(C.error)return z({result:C,stack:R})}if(E){let C=v(E.entries);if(C.error)return z({result:C,stack:R});f.includes(E.drawId)||f.push(E.drawId)}return{...H}},b=d?.entries?.find(({entryPosition:P})=>P)??(I?.drawEntries?.find(({entryPosition:P})=>P)||r?.entries?.find(({entryPosition:P})=>P));if(t&&!b&&w({flight:I,drawDefinition:r}),I||r){let P=y({flight:I,drawDefinition:r});if(P.error)return z({result:P,stack:p})}let S=d?.drawDefinitions?.map(({drawId:P})=>P)??[],U=g?.flights?.filter(P=>!S.includes(P.drawId))||[];for(let P of U){let D=P&&y({flight:P});if(D?.error)return z({result:D,stack:p})}let T=g?.flights?.length===1&&(d?.drawDefinitions?.length??0)<=g?.flights?.length;if(!I&&!r&&a&&PK.includes(a))return{error:n4};if(!I&&!r||a===hc||l&&T){let P=v(d?.entries);if(P?.error)return z({result:P,stack:p});let D;if(a===hc&&(g?.flights?.every(E=>{let R=v(E.drawEntries);return R.error?(D=R.error,!1):(E.drawEntries=E.drawEntries.filter(({participantId:C})=>!n.includes(C)),!0)}),d?.drawDefinitions?.every(E=>{let R=v(E.entries);return R.error?(D=R.error,!1):(E.entries=E.entries?.filter(({participantId:C})=>!n.includes(C)),!0)})),D)return z({result:{error:D},stack:p})}t&&w({flight:I,drawDefinition:r});for(let P of d?.drawDefinitions??[])f.length&&!f.includes(P.drawId)||ti({tournamentId:i.tournamentId,eventId:d?.eventId,drawDefinition:P});return{...H}}function Cg({value:t,sourceRange:e,targetRange:i}){if(!Array.isArray(e)||e.length!==2)return 0;let r=Math.min(...e),n=Math.max(...e),a=Math.min(...i),s=Math.max(...i);return(t-r)*(s-a)/(n-r)+a}var n7="NTRP",a7="DUPR",s7="UTR_P",o7="UTPR",l7="SQUASH_LEVELS",u7="US_SQUASH",c7="USATT",d7="ITTF",p7="USAR",zbe={ELO:"ELO",NTRP:n7,TRN:"TRN",UTR:"UTR",WTN:"WTN",DUPR:a7,UTR_P:s7,UTPR:o7,PSA:"PSA",SQUASH_LEVELS:l7,US_SQUASH:u7,USATT:c7,ITTF:d7,USAR:p7,BWF:"BWF"},qbe={ELO:{defaultInitialization:1500,decimalsCount:0,range:[0,3e3],ascending:!1},[n7]:{accessors:["ntrpRating","dntrpRatingHundredths"],attributes:{ustaRatingType:""},accessor:"dntrpRatingHundredths",defaultInitialization:3,decimalsCount:1,ascending:!1,range:[1,7]},UTR:{defaultInitialization:6,accessors:["utrRating"],accessor:"utrRating",decimalsCount:2,ascending:!1,range:[1,16]},WTN:{attributes:{confidence:{generator:!0,range:[60,100]}},accessors:["wtnRating","confidence"],defaultInitialization:23,accessor:"wtnRating",ascending:!0,decimalsCount:2,range:[40,1]},[a7]:{defaultInitialization:3.5,accessors:["duprRating","reliabilityScore"],accessor:"duprRating",attributes:{reliabilityScore:{generator:!0,range:[0,100]}},decimalsCount:3,ascending:!1,range:[2,8]},[s7]:{defaultInitialization:5,accessors:["utrpRating","verified"],accessor:"utrpRating",attributes:{verified:{type:"boolean"},provisional:{type:"string"}},decimalsCount:1,ascending:!1,range:[1,10]},[o7]:{defaultInitialization:3.5,accessor:"utprRating",decimalsCount:1,ascending:!1,range:[2,5],deprecated:!0},PSA:{defaultInitialization:500,accessor:"psaPoints",decimalsCount:0,ascending:!1,range:[0,3e3],attributes:{tournaments:{generator:!0,range:[1,20]},divisor:{generator:!0,range:[10,20]}}},[l7]:{defaultInitialization:2e3,accessor:"squashLevel",decimalsCount:0,ascending:!1,range:[0,7e3]},[u7]:{defaultInitialization:3.5,accessor:"usSquashRating",decimalsCount:1,ascending:!1,range:[2,6]},[c7]:{defaultInitialization:1e3,accessor:"usattRating",decimalsCount:0,ascending:!1,range:[200,3e3]},[d7]:{defaultInitialization:500,accessor:"ittfPoints",decimalsCount:0,ascending:!1,range:[0,2e4]},[p7]:{defaultInitialization:1e4,accessor:"usarRanking",decimalsCount:0,ascending:!0,range:[1,25e3]},BWF:{defaultInitialization:5e3,accessor:"bwfPoints",decimalsCount:0,ascending:!0,range:[0,15e4],attributes:{tournaments:{generator:!0,range:[1,10]}}}},Dr=qbe;function Ybe({sourceRatingType:t,sourceRating:e}){let i=Dr[t]?.range,r=i?.[0]>i?.[1],n=Dr.ELO.range;return Cg({value:r?i[0]-e:e,sourceRange:i,targetRange:n})}function Kbe({targetRatingType:t,sourceRating:e}){let i=Dr[t]?.decimalsCount||0,r=Dr[t]?.range,n=r?.[0]>r?.[1],a=Math.max(...r),s=Dr.ELO?.range,o=Cg({targetRange:r,sourceRange:s,value:e}),l=Number.parseFloat(o?.toFixed(i))||0;return n?a-l:l}function BH(t){let e=Ge(t,[{ratings:!0,[zn]:Yn}]);if(e.error)return e;let i=t.matchUpType&&[Wt,$t].includes(t.matchUpType)?t.matchUpType:Wt,r=Object.keys(Dr),n=t.targetRatingType&&r.includes(t.targetRatingType)?t.targetRatingType:"ELO",a=t.ratings[i]?t.ratings[i].reduce((p,f)=>p.includes(f.scaleName)?p:p.concat(f.scaleName),[]):[];if(!a)return{error:_r};let s=t.ratings[i]?.find(p=>p.scaleName===n)??t.ratings[i]?.[0];if(a[0]===n)return s;let o=s?.scaleName,l=Dr[s?.scaleName]?.accessor,u=l&&s.scaleValue[l]||s?.scaleValue,c=Ybe({sourceRatingType:o,sourceRating:u}),d=Kbe({targetRatingType:n,sourceRating:c});return d?{convertedRating:d,sourceRating:u}:{error:ie}}function Xbe({participantResults:t,sides:e,score:i}){let r=e?.find(({sideNumber:o})=>o===1),n=e?.find(({sideNumber:o})=>o===2),a=r?.participant?.ratings,s=n?.participant?.ratings;if(a?.[Wt]&&s?.[Wt]){let o="ELO",{convertedRating:l}=BH({ratings:a,targetRatingType:o}),{convertedRating:u}=BH({ratings:s,targetRatingType:o}),{side1pressure:c,side2pressure:d}=Jbe({side1ConvertedRating:l,side2ConvertedRating:u,score:i});c&&t[r?.participantId].pressureScores.push(c),d&&t[n?.participantId].pressureScores.push(d);let p=Math.max(...Dr.ELO.range),f=_D((u-l)/p),m=_D((l-u)/p);t[r?.participantId].ratingVariation.push(f),t[n?.participantId].ratingVariation.push(m)}}function Jbe({side1ConvertedRating:t,side2ConvertedRating:e,score:i}){let r=Math.max(t,e),n=Math.min(t,e),a=Math.abs(t-e),s=Dr.ELO.range,o=Math.max(...s),l=(o-r)*0,u=(r+l)/o*a,c=i?.sets?.reduce((v,w)=>v+(w?.side1Score??0),0),d=i?.sets?.reduce((v,w)=>v+(w.side2Score??0),0),p=t>e?2:1,f=(c||0)*(n+(p===1?u:0)),m=(d||0)*(n+(p===2?u:0)),h=f+m,g=h?_D(f/h):0,I=h?_D(m/h):0;return{side1pressure:g,side2pressure:I}}function IL({winningSide:t,matchUpFormat:e=Ju,matchUpStatus:i,tallyPolicy:r,score:n}){let a=[0,0],s=n?.sets,o=typeof t=="number"&&t-1,l=zi(e),u=vL(l?.bestOf??1);if(typeof o=="number"&&(i===Qt&&r?.setsCreditForDefaults||i===mi&&r?.setsCreditForWalkovers))a[o]=u;else for(let c of s||[]){let{winningSide:d}=c;d&&(a[d-1]+=1)}return typeof o=="number"&&i===$r&&(+a[1-o]===u&&(a[1-o]-=1),r?.setsCreditForRetirements&&(a[o]=u)),a}function f7({matchUpFormat:t=Ju,winningSide:e,matchUpStatus:i,tallyPolicy:r,score:n}){let{sets:a}=n||{};if(!a)return[0,0];let s=typeof e=="number"&&e-1,o=zi(t),l=o?.bestOf??1,u=vL(l),c=o?.setFormat?.tiebreakAt||0,d=[[],[]];if(typeof s=="number"&&(i===Qt&&r?.gamesCreditForDefaults||i===mi&&r?.gamesCreditForWalkovers)){let p=o?.setFormat?.setTo||0,f=u*p;d[s].push(f)}else a.forEach((p,f)=>{let m=(p.setNumber||f+1)>u&&o?.finalSetFormat?"finalSetFormat":"setFormat",h=o?.[m]?.based,g=o?.[m].tiebreakSet,{side1Score:I,side2Score:v}=p;VH(h)&&!g&&(d[0].push(Ye(I||0)),d[1].push(Ye(v||0))),g&&p.winningSide&&r?.gamesCreditForTiebreakSets!==!1&&d[p.winningSide-1].push(1)});if(i===$r&&typeof s=="number"){let p=a.length>u&&o?.finalSetFormat?"finalSetFormat":"setFormat",f=o?.[p];if(VH(f.based)){let m=f?.setTo||0,h=I=>{if(!(!o||I===""))return+I===c-1||+I===c?Ye(c||0)+1:+I<c?m:c},g=IL({winningSide:e,score:{sets:a},matchUpStatus:i,matchUpFormat:t,tallyPolicy:r});if(d.map(I=>I[s]<=I[1-s]).reduce((I,v)=>I+(v?1:0),0)>g[1-s]){let I=d[s].length,v=h(d[1-s][I-1]);v&&(d[s][I-1]=v)}u>d[s].length&&r?.gamesCreditForRetirements&&d[s].push(m)}}return[d[0].reduce((p,f)=>p+f,0),d[1].reduce((p,f)=>p+f,0)]}function m7({matchUpFormat:t,score:e}){let i=t?zi(t):void 0,r=i?.bestOf??1,n=vL(r),a=[0,0],s=[0,0];return e?.sets?.forEach((o,l)=>{let u=(o.setNumber||l+1)>n&&i?.finalSetFormat?"finalSetFormat":"setFormat",c=i?.[u]?.based;if(h7(c)){let{side1Score:d,side2Score:p}=o;d&&(s[0]+=Ye(d||0)),p&&(s[1]+=Ye(p||0))}else o.side1TiebreakScore&&(s[0]+=Ye(o.side1TiebreakScore||0)),o.side2TiebreakScore&&(s[1]+=Ye(o.side2TiebreakScore||0)),(o.side1TiebreakScore||o.side2TiebreakScore)&&o.winningSide&&(a[o.winningSide-1]+=1)}),{pointsTally:s,tiebreaksTally:a}}function vL(t){return t&&Math.ceil(t/2)||1}function h7(t){return t==="P"}function VH(t){return!h7(t)}function Qbe({participantResults:t,groupingTotal:e,matchUpFormat:i,tallyPolicy:r,totalGames:n,perPlayer:a,totalSets:s}){let o=i&&zi(i)||{},l=o.bestOf,u=l&&Math.ceil(l/2)||1,c=o.setFormat?.setTo,d=Math.pow(10,r?.precision||3);Object.keys(t).forEach(p=>{let f=t[p].setsWon,m=t[p].setsLost,h=r?.groupTotalSetsPlayed||e==="setsPct"?s:a*u||f+m,g=Math.round(f/h*d)/d;(g===1/0||Number.isNaN(g))&&(g=h);let I=t[p].tieMatchUpsWon,v=t[p].tieMatchUpsLost,w=I+v,y=Math.round(I/w*d)/d;(y===1/0||Number.isNaN(y))&&(y=I);let b=t[p].matchUpsWon,S=t[p].matchUpsLost,U=b+S,T=Math.round(b/U*d)/d;(T===1/0||Number.isNaN(T))&&(T=b);let P=t[p].gamesWon||0,D=t[p].gamesLost||0,E=(a||0)*u*(c||0),R=r?.groupTotalGamesPlayed||e==="gamesPct"?n:Math.max(E,P+D),C=Math.round(P/R*d)/d;(C===1/0||Number.isNaN(C))&&(C=0);let M=t[p].pointsWon+t[p].pointsLost,N=Math.round(t[p].pointsWon/M*d)/d;(N===1/0||Number.isNaN(N))&&(N=0),t[p].setsWon=f,t[p].setsLost=m,t[p].setsPct=g,t[p].tieMatchUpsWon=I,t[p].tieMatchUpsPct=y,t[p].matchUpsPct=T,t[p].gamesWon=P,t[p].gamesLost=D,t[p].gamesPct=C,t[p].pointsPct=N,t[p].result=`${t[p].matchUpsWon}/${t[p].matchUpsLost}`})}function cS({participantIds:t,pressureRating:e,groupingTotal:i,matchUpFormat:r,tallyPolicy:n,perPlayer:a,matchUps:s}){let o={},l=n?.excludeMatchUpStatuses||[],u=s?.filter(f=>(f.tieMatchUps||!l.includes(f.matchUpStatus))&&(!t?.length||xi(t,[Mg(f,0),Mg(f,1)]).length===2)),c=u?.flatMap(({score:f,tieMatchUps:m})=>m?m.filter(({matchUpStatus:h})=>!l.includes(h)).flatMap(({score:h})=>h?.sets?.length??0):f?.sets?.length??0)?.reduce((f,m)=>f+m,0),d=f=>f?.sets?.reduce((m,h)=>m+(h?.side1Score??0)+(h?.side2Score??0),0)??0,p=u?.flatMap(({score:f,tieMatchUps:m})=>m?m.filter(({matchUpStatus:h})=>!l.includes(h)).flatMap(({score:h})=>d(h)):d(f))?.reduce((f,m)=>f+m,0);for(let f of u??[]){let{matchUpStatus:m,tieMatchUps:h,tieFormat:g,score:I,winningSide:v,sides:w}=f,y=g&&f._disableAutoCalc&&g.collectionDefinitions.every(({scoreValue:U})=>U),b=v&&Zbe(f),S=v&&ewe(f);if(!b&&!S)if(m&&Yi.includes(m)){let U=Mg(f,0),T=Mg(f,1);U&&(Jc(o,U),o[U].matchUpsCancelled+=1),T&&(Jc(o,T),o[T].matchUpsCancelled+=1)}else if(h?.length){a=0;for(let U of h){if(U.winningSide){let T=w?.find(({sideNumber:D})=>D===U.winningSide)?.participantId,P=w?.find(({sideNumber:D})=>D===U.winningSide)?.participantId;T&&P&&(Jc(o,T),Jc(o,P),o[T].tieMatchUpsWon+=1,o[P].tieMatchUpsLost+=1,Di(Wt)(U.matchUpType)?(o[T].tieSinglesWon+=1,o[P].tieSinglesLost+=1):Di($t)(U.matchUpType)&&(o[T].tieDoublesWon+=1,o[P].tieDoublesLost+=1))}jH({score:U.score,manualGamesOverride:y,participantResults:o,sides:w})}}else jH({manualGamesOverride:y,participantResults:o,score:I,sides:w});else if(Jc(o,b),Jc(o,S),h?.length){a=0;for(let U of h){let{matchUpType:T}=U,P=Di($t)(T),D=Di(Wt)(T);U.winningSide&&(U.winningSide===v?(b&&(o[b].tieMatchUpsWon+=1,D&&(o[b].tieSinglesWon+=1),P&&(o[b].tieDoublesWon+=1)),S&&(o[S].tieMatchUpsLost+=1,D&&(o[S].tieSinglesLost+=1),P&&(o[S].tieDoublesLost+=1))):U.winningSide!==v&&(S&&(o[S].tieMatchUpsWon+=1,D&&(o[S].tieSinglesWon+=1),P&&(o[S].tieDoublesWon+=1)),b&&(o[b].tieMatchUpsLost+=1,D&&(o[b].tieSinglesLost+=1),P&&(o[b].tieDoublesLost+=1)))),GH({matchUpFormat:U.matchUpFormat,matchUpStatus:U.matchUpStatus,matchUpType:U.matchUpType,score:U.score,sides:U.sides,winningParticipantId:b,losingParticipantId:S,manualGamesOverride:y,participantResults:o,isTieMatchUp:!0,pressureRating:e,tallyPolicy:n,winningSide:v})}g7({winningParticipantId:b,losingParticipantId:S,participantResults:o,matchUpStatus:m})}else GH({matchUpFormat:f.matchUpFormat??r,matchUpType:f.matchUpType,isTieMatchUp:void 0,winningParticipantId:b,manualGamesOverride:y,losingParticipantId:S,participantResults:o,pressureRating:e,matchUpStatus:m,tallyPolicy:n,winningSide:v,score:I,sides:w});if(y){let U=I?.sets?.reduce((E,R)=>E+(R?.side1Score??0),0),T=I?.sets?.reduce((E,R)=>E+(R.side2Score??0),0),P=w?.find(({sideNumber:E})=>E===1)?.participantId,D=w?.find(({sideNumber:E})=>E===2)?.participantId;Jc(o,P),Jc(o,D),P&&(o[P].gamesWon+=U,o[P].gamesLost+=T),D&&(o[D].gamesWon+=T,o[D].gamesLost+=U)}}return Qbe({participantResults:o,groupingTotal:i,matchUpFormat:r,tallyPolicy:n,totalGames:p,perPlayer:a,totalSets:c}),{participantResults:o}}function Zbe(t){let e=t.winningSide-1;return Mg(t,e)}function ewe(t){let e=1-(t.winningSide-1);return Mg(t,e)}function Mg(t,e){if(!t?.sides)return console.log("no sides:",{matchUp:t}),"foo";let i=t.sides[e];return i?i.participantId:(console.log("No Side",{matchUp:t,index:e}),"foo")}function Jc(t,e){e&&!t[e]&&(t[e]={allDefaults:0,defaults:0,defeats:[],gamesLost:0,gamesWon:0,matchUpsCancelled:0,matchUpsLost:0,matchUpsWon:0,pointsLost:0,pointsWon:0,pressureScores:[],ratingVariation:[],retirements:0,setsLost:0,setsWon:0,tieSinglesWon:0,tieSinglesLost:0,tieDoublesWon:0,tieDoublesLost:0,tieMatchUpsLost:0,tieMatchUpsWon:0,victories:[],walkovers:0})}function jH({manualGamesOverride:t,participantResults:e,score:i,sides:r}){let{sets:n}=i||{},a=[[],[]],s=[0,0];for(let l of n||[]){let{winningSide:u,side1Score:c,side2Score:d}=l;u&&(s[u-1]+=1),a[0].push(Ye(c||0)),a[1].push(Ye(d||0))}let o=[a[0].reduce((l,u)=>l+u,0),a[1].reduce((l,u)=>l+u,0)];r.forEach((l,u)=>{let{participantId:c}=l;c&&(Jc(e,c),e[c].setsWon+=s[u],e[c].setsLost+=s[1-u],t||(e[c].gamesWon+=o[u],e[c].gamesLost+=o[1-u]))})}function GH({winningParticipantId:t,manualGamesOverride:e,losingParticipantId:i,participantResults:r,pressureRating:n,matchUpFormat:a,matchUpStatus:s,isTieMatchUp:o,matchUpType:l,tallyPolicy:u,winningSide:c,score:d,sides:p}){let f=c&&c-1,m=1-f;n&&l===Wt&&Xbe({participantResults:r,sides:p,score:d}),o||g7({winningParticipantId:t,losingParticipantId:i,participantResults:r,matchUpStatus:s});let h=IL({matchUpStatus:s,matchUpFormat:a,tallyPolicy:u,winningSide:c,score:d}),g=f7({matchUpStatus:s,matchUpFormat:a,tallyPolicy:u,winningSide:c,score:d}),{pointsTally:I}=m7({score:d,matchUpFormat:a});t&&(r[t].setsWon+=h[f],r[t].setsLost+=h[m],e||(r[t].gamesWon+=g[f],r[t].gamesLost+=g[m]),r[t].pointsWon+=I[f],r[t].pointsLost+=I[m]),i&&(r[i].setsWon+=h[m],r[i].setsLost+=h[f],e||(r[i].gamesWon+=g[m],r[i].gamesLost+=g[f]),r[i].pointsWon+=I[m],r[i].pointsLost+=I[f])}function g7({winningParticipantId:t,losingParticipantId:e,participantResults:i,matchUpStatus:r}){e&&(r===mi&&(i[e].walkovers+=1),r===Qt&&(i[e].defaults+=1),r===$r&&(i[e].retirements+=1),Fr(r)&&(i[e].allDefaults+=1),i[e].matchUpsLost+=1),t&&(i[t].matchUpsWon+=1),e&&t&&(i[e].defeats.push(t),i[t].victories.push(e))}function twe(t,e,i,r){t.groups&&Object.keys(t.groups).sort(r).forEach(n=>{let a=t.groups[n].map(o=>e[o]).join(", "),s=`${n} ${t.attribute}: ${a}`;i.push(s)})}function iwe(t,e,i,r){if(t.excludedDirectives?.length){let n=t.excludedDirectives.map(({attribute:o})=>o).join(", "),a=`${n.length} directives were excluded due to participants limit}`;r.push(a);let s=`Excluded: ${n}`;r.push(s)}else{let n=(u,c)=>Number.parseFloat(t.reversed?u:c)-Number.parseFloat(t.reversed?c:u),a=t.groups?Object.values(t.groups).flat(1/0).length:t.participantIds?.length??0,s=t.reversed?" in reverse order":"",o=t.groups?"grouped":"separated",l=`Step ${e+1}: ${a} particiants were ${o}${s} by ${t.attribute}`;if(r.push(l),t.idsFilter){let u=`${t.attribute} was calculated considering ONLY TIED PARTICIPANTS`;r.push(u)}twe(t,i,r,n)}r.push("----------------------")}function rwe({matchUps:t,order:e,report:i}){let r={};t.forEach(({sides:a})=>{a.forEach(s=>{s.participantId&&s.participant&&(r[s.participantId]=s.participant.participantName)})});let n=[];return Array.isArray(i)&&i.forEach((a,s)=>{iwe(a,s,r,n)}),n.push("Final Order:"),e.forEach(a=>{let{participantId:s,resolved:o}=a,l=a.groupOrder||a.provisionalOrder;n.push(`${l}: ${r[s]} => resolved: ${!!o}`)}),n.join(`\r
`)}function I7({participantResults:t,participantIds:e,attribute:i}){return v7({participantResults:t,participantIds:e}).reduce((r,n)=>{let{participantId:a,results:s}=n,o=s?.[i];return!isNaN(o)&&a&&(r[o]?r[o].push(a):r[o]=[a]),r},{})}function v7(t){return(t.participantIds||Object.keys(t.participantResults)).reduce((e,i,r)=>(e.push({participantId:i,i:r,results:t.participantResults[i]}),e),[])}var nwe=[{attribute:"matchUpsPct",idsFilter:!1},{attribute:"allDefaults",reversed:!0,idsFilter:!1},{attribute:"defaults",reversed:!0,idsFilter:!1},{attribute:"walkovers",reversed:!0,idsFilter:!1},{attribute:"retirements",reversed:!0,idsFilter:!1},{attribute:"setsPct",idsFilter:!1},{attribute:"gamesPct",idsFilter:!1},{attribute:"pointsPct",idsFilter:!1},{attribute:"matchUpsPct",idsFilter:!0},{attribute:"setsPct",idsFilter:!0},{attribute:"gamesPct",idsFilter:!0},{attribute:"pointsPct",idsFilter:!0}],MA={matchUpsPct:20,tieMatchUpsPct:16,pointsPct:4,gamesPct:8,setsPct:12};function HH(t){let{requireCompletion:e=!0,participantResults:i,subOrderMap:r,tallyPolicy:n}=t,a=[];if(e&&!awe(t))return{};let s=["tieMatchUpsWon","tieSinglesWon","tieDoublesWon","matchUpsWon","pointsWon","gamesWon","setsWon","gamesPct","setsPct","pointsPct","matchUpsPct"].includes(n?.groupOrderKey)?n.groupOrderKey:"matchUpsWon",o=I7({participantResults:i,attribute:s});a.push({attribute:s,groups:o});let l=Object.keys(o).map(g=>Number.parseFloat(g)).sort((g,I)=>I-g).map(g=>o[g]).map(g=>{let I=y7({participantIds:g,...t});return a.push(...I.report??[]),I.order}).flatMap((g,I)=>g.map(v=>v.resolved?v:{...v,subGroup:[I].concat(...v.subGroup??[])})),u,c=0,d=1,p;l.forEach((g,I)=>{I&&(g.resolved||p&&!g.resolved)&&(d+=1),p=g.resolved;let v=Number.parseInt(g.subGroup?.join("")||0);g.resolved?(g.position=I+1,d=g.position):(u&&v>u&&(d+=c,c=0),g.position=d,c+=1),u=v});let f=l.map(({position:g})=>g),m=va(f);return l.forEach(g=>{let{participantId:I,position:v}=g||{},w=i[I];g.GEMscore=h(w);let y=m[v];g?.position!==void 0&&(y>1&&(g.ties=y,r&&(g.subOrder=r[I])),g.rankOrder=v,g.groupOrder=v+(g.subOrder||1)-1)}),{groupOrder:l,report:a.flat(1/0).filter(Boolean)};function h(g){return(Array.isArray(n?.GEMscore)?Object.keys(MA).filter(I=>n.GEMscore.includes(I)):Object.keys(MA)).map(I=>(g[I]||0)*Math.pow(10,MA[I].toFixed(3))).reduce((I,v)=>I+v,0)}}function awe({participantResults:t,participantsCount:e}){let i=v7({participantResults:t}).filter(r=>e-1===r.results.matchUpsWon+r.results.matchUpsLost+r.results.matchUpsCancelled);return e===i.length}function swe({disableHeadToHead:t,participantIds:e,matchUpFormat:i,groupTotals:r,tallyPolicy:n,attribute:a,idsFilter:s,matchUps:o,reversed:l}){let{participantResults:u}=cS({participantIds:s&&e,groupingTotal:r&&a,matchUpFormat:i,tallyPolicy:n,matchUps:o}),c=I7({participantResults:u,participantIds:e,attribute:a}),d=[{attribute:a,reversed:l,groups:c,idsFilter:s,groupTotals:r}],p;return Object.keys(c).length>1&&e.length&&(p=Object.keys(c).map(f=>Number.parseFloat(f)).sort((f,m)=>l?f-m:m-f).map(f=>c[f]).map(f=>{let m=y7({participantResults:u,disableHeadToHead:t,participantIds:f,matchUpFormat:i,tallyPolicy:n,matchUps:o});return d.push(...m.report??[]),m.order}).flatMap((f,m)=>f.map(h=>h.resolved?h:{...h,subGroup:[m].concat(...h.subGroup??[])}))),{order:p,report:d}}function y7({participantResults:t,disableHeadToHead:e,participantIds:i,matchUpFormat:r,tallyPolicy:n,matchUps:a}){let s=[],o=[],l;if(i?.length===1)return{order:[{resolved:!0,participantId:i[0]}]};if(i?.length===2&&(!n?.headToHead||!n.headToHead.disabled&&!e)){let c=owe({participantIds:i,participantResults:t});if(c){let d=c[0].participantId;return o.push({attribute:"head2Head",participantIds:i,headToHeadWinner:d}),{order:c,headToHeadWinner:d,report:o}}}let u=(n?.tallyDirectives||nwe).filter(c=>{let d=!(Ni(c.maxParticipants)&&i?.length>c.maxParticipants);return d||s.push(c),d});return s.length&&o.push({excludedDirectives:s,participantIds:i}),u.every(({attribute:c,reversed:d,idsFilter:p,groupTotals:f,disableHeadToHead:m})=>(l=swe({disableHeadToHead:m,participantIds:i,matchUpFormat:r,groupTotals:f,tallyPolicy:n,attribute:c,idsFilter:p,matchUps:a,reversed:d}),o.push(l.report),!l.order)),l.order?{order:l.order,report:o}:{order:i?.map(c=>({participantId:c})),report:o}}function owe({participantIds:t,participantResults:e}){if(t){if(e[t[0]].victories.includes(t[1]))return t.map(i=>({resolved:!0,participantId:i}));if(e[t[1]].victories.includes(t[0]))return t.reverse().map(i=>({resolved:!0,participantId:i}))}}function Ih({policyDefinitions:t,generateReport:e,pressureRating:i,matchUpFormat:r,matchUps:n=[],subOrderMap:a,perPlayer:s}){if(!n?.length||!Ga(n))return{error:Tu};let o=rt(n.map(({structureId:y})=>y));if(o.length!==1)return z({result:{error:ie,info:"Maximum one structureId"},stack:"tallyParticipantResults",context:{structureIds:o}});let l=n.filter(y=>y&&y.matchUpStatus!=="BYE"),u=l.length&&rt(l.flatMap(({drawPositions:y})=>y)).length,c=l.filter(y=>mp({matchUp:y})).length===l.length;c||(s=0);let d=n.every(({matchUpType:y,tieMatchUps:b})=>y===Zt&&b?.every(S=>mp({matchUp:S}))),p=t?.[NF],f=n.filter(y=>mp({matchUp:y})??y.matchUpType===Zt),{participantResults:m}=cS({matchUps:f,pressureRating:i,matchUpFormat:r,tallyPolicy:p,perPlayer:s}),h,g,{groupOrder:I,report:v}=HH({matchUps:f,participantResults:m,participantsCount:u,matchUpFormat:r,subOrderMap:a,tallyPolicy:p});if(i&&lwe({participantResults:m}),c&&I)h=v,g=I,I.forEach(y=>{let{participantId:b,groupOrder:S,rankOrder:U,subOrder:T,ties:P,GEMscore:D}=y,E=m[b];Object.assign(E,{groupOrder:S,rankOrder:U,GEMscore:D,subOrder:T,ties:P})});else{let{groupOrder:y,report:b}=HH({requireCompletion:!1,participantResults:m,participantsCount:u,matchUpFormat:r,tallyPolicy:p,subOrderMap:a,matchUps:n});h=b,g=y,y&&y.forEach(S=>{let{participantId:U,groupOrder:T,GEMscore:P}=S,D=m[U];Object.assign(D,{provisionalOrder:T,GEMscore:P})})}let w={completedTieMatchUps:d,readableReport:"",participantResults:m,bracketComplete:c,order:[],report:h};if((c||d)&&(w.order=g),e||ra({tally:!0})){let y=rwe({matchUps:n,report:h,order:g});ra({tally:!0})&&console.log(y),w.readableReport=y}return w}function lwe({participantResults:t}){let e=n=>n.reduce((a,s)=>a+parseFloat(s),0),i=n=>parseFloat((e(n)/n.length).toFixed(2)),r=Object.keys(t).map(n=>{let a=t[n],{pressureScores:s}=a,o=s?.length?i(s):0;return{participantId:n,averagePressure:o}}).sort((n,a)=>(a.averagePressure||0)-(n.averagePressure||0)).map((n,a)=>({...n,order:a+1}));for(let n of r)t[n.participantId].pressureOrder=n.order}function Hl({requireTimeStamp:t,scaleAttributes:e,participant:i}){if(!i)return{error:rh};if(!bt(e))return{error:ie};if(i.timeItems??=[],Array.isArray(i.timeItems)){let{accessor:r,scaleType:n,eventType:a,scaleName:s}=e,o=[pd,n,a,s].join("."),l=i.timeItems.filter(u=>u?.itemType===o).filter(u=>!t||u?.itemDate).sort((u,c)=>(u.createdAt?new Date(u.createdAt).getTime():0)-(c.createdAt?new Date(c.createdAt).getTime():0)).pop();if(l){let[u,c,d,p]=l.itemType?.split(".")??[];if(u!==pd)return{error:Dm};let f=r&&hp({element:l.itemValue,accessor:r}),m=f?.value||l.itemValue,h={rawValue:f&&l.itemValue,eventType:d,scaleDate:l.itemDate,scaleValue:m,scaleName:p,scaleType:c};return{...H,scaleItem:h}}}return{...H,scaleItem:void 0}}function uwe({publishedSeeding:t,usePublishState:e,withSeeding:i,participant:r,event:n}){let a={},s=c=>[pd,jl,n.eventType,c].join("."),o=Object.assign({},...(r.timeItems||[]).filter(({itemType:c})=>c.split(".")[1]===jl).map(({itemType:c,itemValue:d})=>({[c]:d}))),l=(t?.stageSeedingScaleNames&&Object.values(t?.stageSeedingScaleNames)||Array.isArray(t?.seedingScaleNames)&&t.seedingScaleNames||[]).map(s),u=xi(Object.keys(o),l);if((!e||!Object.keys(o).length&&!t?.drawIds?.length||u.length)&&u.length){if(t?.stageSeedingScaleNames){let c=Object.keys(t.stageSeedingScaleNames).map(p=>{let f=s(t.stageSeedingScaleNames[p]),m=o[f];return[p,m]}).filter(p=>p[1]).map(p=>({[p[0]]:{seedValue:p[1]}})),d=Object.assign({},...c);a.seedAssignments=d}else if(u){let c=u.map(d=>o[d]);a.seedValue=c.pop()}}else if(!e&&typeof i=="object"){let c=Object.keys(i).map(p=>{let f=s(i[p]),m=o[f];return[p,m]}).filter(p=>p[1]).map(p=>({[p[0]]:{seedValue:p[1]}})),d=Object.assign({},...c);a.seedAssignments=d}else{let{categoryName:c,ageCategoryCode:d}=n.category||{},p=[d,n.eventId,c].filter(Boolean),f;for(let m of p){let h={eventType:n.eventType,scaleType:jl,scaleName:m},g=Hl({scaleAttributes:h,participant:r});if(g.scaleItem){f=g.scaleItem;break}}if(f&&(!e||t?.published&&!t?.published?.drawIds?.length)){let m=f.scaleValue;a.seedValue=m}}return a}function yL({positionAssignments:t}){let e=(t||[]).filter(ba(su)).map(n=>{let{extension:a}=mt({element:n,name:aI}),s=Ye(a?.value),o=!isNaN(s)&&s;return o&&{participantId:n.participantId,subOrder:o}}).filter(Boolean),i=e.map(({subOrder:n})=>n),r=va(i);return{subOrderMap:Object.assign({},...e.filter(({subOrder:n})=>r[n]===1).map(({participantId:n,subOrder:a})=>({[n]:a})))}}function cwe({convertExtensions:t,seedAssignments:e,participant:i,withSeeding:r,seedValue:n,eventId:a,ranking:s,entry:o}){let{entryStatus:l,entryStage:u,entryPosition:c,extensions:d}=o,p=d?.length&&t?Object.assign({},...hF(d??[])):{},f=Object.assign(p,{entryPosition:c,entryStatus:l,entryStage:u,ranking:s,eventId:a});i.events[a]=Ve(f,!1,!1,!0),r&&(e&&(i.events[a].seedAssignments=e),n&&(i.events[a].seedValue=n))}function dS(t){let e=Ge(t,[{[mr]:!0}]);if(e.error)return e;let{tournamentRecord:i,status:r=Ha}=t,n=`${Bd}.${Vd}`;return ke(CR({tournamentRecord:i,itemType:n})?.timeItem?.itemValue?.[r],!1,!0)}function dwe(t){let{tournamentId:e}=t??{};return!!e}function za({event:t,status:e=Ha}){let i=`${Bd}.${Vd}`;return Kw({itemType:i,event:t})?.timeItem?.itemValue?.[e]}function xf(t){let e=t?.embargo;return!e||!sc(e)?!1:new Date(e).getTime()>Date.now()}function Bo(t){return!!t?.published&&!xf(t)}function bL({drawDetails:t,drawId:e,ignoreEmbargo:i=!1}){let r=t?.[e]?.publishingDetail;return i?!!r?.published:Bo(r)}function vh(t){let{tournamentRecord:e,drawDefinition:i,eventIds:r,eventId:n,drawIds:a,drawId:s,event:o}=t??{};if(e&&!dwe(e))return{error:ie};if(n&&!o)return{error:os};if(Array.isArray(r)&&r?.length){let p={};for(let f of r){if(!ri(f))return{error:ie};let m=jn({tournamentRecord:e,eventId:f})?.event;if(!m)return{error:os};let h=NA({event:m});p[f]=h}return{...H,publishState:p}}if(o){let p=NA({event:o}),f={};if(s)return i?{publishState:{status:{published:!!p.status.publishedDrawIds?.includes(s),drawDetail:p.status.drawDetails?.[s]},...H}}:{error:Oa};if(Array.isArray(a)&&a?.length){let m=o.drawDefinitions?.map(Sb)??[];for(let h of a){if(!ri(h))return{error:ie};if(!m.includes(h))return{error:Oa};f[h]={status:{published:!!p.status.publishedDrawIds.includes(h),drawDetail:p.status.drawDetails?.[h]}}}}else f=p;return{...H,publishState:f}}let l=[],u=!1,c={};for(let p of e?.events??[]){let f=NA({event:p});c[p.eventId]=f,f.status.published&&(l.push(p.eventId),u=!0);for(let{drawId:m}of p.drawDefinitions??[]){let h=f.status?.publishedDrawIds?.includes(m);h&&(c[m]={status:{published:h}})}}let d=[];if(e){let p=dS({tournamentRecord:e});c.tournament=p??{},(p?.orderOfPlay?.published||p?.participants?.published)&&(u=!0),c.tournament.status={published:u,publishedEventIds:l},p?.orderOfPlay?.embargo&&d.push({type:"orderOfPlay",embargo:p.orderOfPlay.embargo,embargoActive:xf(p.orderOfPlay)}),p?.participants?.embargo&&d.push({type:"participants",embargo:p.participants.embargo,embargoActive:xf(p.participants)})}for(let p of e?.events??[]){let f=za({event:p})?.drawDetails??{};for(let[m,h]of Object.entries(f)){h?.publishingDetail?.embargo&&d.push({type:"draw",id:m,embargo:h.publishingDetail.embargo,embargoActive:xf(h.publishingDetail)});for(let[g,I]of Object.entries(h?.stageDetails??{}))I?.embargo&&d.push({type:"stage",id:`${m}:${g}`,embargo:I.embargo,embargoActive:xf(I)});for(let[g,I]of Object.entries(h?.structureDetails??{}))if(I?.embargo&&d.push({type:"structure",id:g,embargo:I.embargo,embargoActive:xf(I)}),I?.scheduledRounds)for(let[v,w]of Object.entries(I.scheduledRounds))w?.embargo&&d.push({type:"scheduledRound",id:`${g}:round${v}`,embargo:w.embargo,embargoActive:xf(w)})}}return d.length&&(c.embargoes=d),{...H,publishState:c}}function NA({event:t}){let e=za({event:t});if(!e)return{status:{published:!1}};let i={published:void 0,seedingScaleNames:[],drawIds:[]};e.seeding&&Object.assign(i,e.seeding);let r=e.drawDetails??{};for(let o of t.drawDefinitions?.map(Sb)||[])r[o]||(r[o]={publishingDetail:{published:!1}});let n=r&&Object.keys(r).length&&Object.keys(r).filter(o=>bL({drawDetails:r,drawId:o,ignoreEmbargo:!0})),a=n?.length?n:e.drawIds??[];if(a?.length&&!n?.length)for(let o of a)r[o]={publishingDetail:{published:!0}};let s=a?.length>0;return{status:{publishedDrawIds:a,publishedSeeding:i,drawDetails:r,published:s}}}function b7(t){let{participantMap:e,participantId:i,matchUpStatus:r,roundPosition:n,structureId:a,matchUpType:s,roundNumber:o,matchUpId:l,potential:u,schedule:c,drawId:d,score:p}=t;!c||!Object.keys(c).length||r==="BYE"||e[i].scheduleItems.push({...c,scheduledDate:Qe(c?.scheduledDate),scheduledTime:ci(c?.scheduledTime),checkScoreHasValue:cr({score:p}),matchUpStatus:r,roundPosition:n,structureId:a,matchUpType:s,roundNumber:o,matchUpId:l,potential:u,drawId:d})}function pwe({finishingPositionRange:t={winner:[],loser:[]},collectionPosition:e,participantMap:i,finishingRound:r,participantWon:n,collectionId:a,matchUpStatus:s,participantId:o,stageSequence:l,roundNumber:u,structureId:c,matchUpId:d,drawId:p,stage:f}){let m=i[o],h=y=>Math.abs(y[0]-y[1]);m.structureParticipation[c]||(m.structureParticipation[c]={rankingStage:f,walkoverWinCount:0,defaultWinCount:0,stageSequence:l,winCount:0,structureId:c,drawId:p});let g=m.structureParticipation[c],{winner:I,loser:v}=t,w=n?I:v;n&&(g.winCount+=1,s===mi&&(g.walkoverWinCount+=1),s===Qt&&(g.defaultWinCount+=1)),w&&(!g.finishingPositionRange||h(w)<h(g.finishingPositionRange))&&(g.finishingPositionRange=w),r&&((!g.finishingRound||r<g.finishingRound)&&(g.finishingMatchUpId=d,g.finishingRound=r,g.roundNumber=u),r===1&&(g.participantWon=n)),e&&(g.lineParticipation||(g.lineParticipation=[]),g.lineParticipation.push({collectionPosition:e,collectionId:a,won:n}))}function WH(t){let{withScheduleItems:e,scheduleAnalysis:i,withTeamMatchUps:r,participantMap:n,withOpponents:a,withMatchUps:s,withEvents:o,withDraws:l,finishingPositionRange:u,finishingRound:c,matchUpStatus:d,stageSequence:p,roundNumber:f,structureId:m,score:h,stage:g,withRankingProfile:I,collectionPosition:v,tieWinningSide:w,roundPosition:y,matchUpTieId:b,matchUpSides:S,collectionId:U,matchUpType:T,winningSide:P,matchUpId:D,schedule:E,eventId:R,drawId:C,sides:M}=t,N=a&&M?.length===2&&Object.assign({},...M.map(({sideNumber:A},O)=>{let k=M[1-O].participantId;return A&&{[A]:k}}).filter(Boolean));for(let A of M){let{participantId:O,sideNumber:k,bye:F}=A;if(F)continue;let x=P===k,L=_=>{let B=n[_]?.participant,G=B?.participantType,j=[{participantId:_,participantType:G}];if(G!==_n)for(let K of B?.individualParticipantIds||[]){let Y=n[K]?.participant;j.push({participantType:Y?.participantType,participantId:K})}return j},$=(_,B)=>{if(s){if(n[_].matchUps[D]={participantWon:x,matchUpType:T,structureId:m,sideNumber:k,matchUpId:D,eventId:R,drawId:C,stage:g},a){let G=L(B);n[_].matchUps[D].opponentParticipantInfo=G}U&&(n[_].matchUps[D].collectionId=U)}a&&B&&(n[_].opponents[B]={participantId:B,matchUpId:D,eventId:R,drawId:C}),I&&pwe({finishingPositionRange:u,collectionPosition:v,participantMap:n,participantWon:x,collectionId:U,finishingRound:c,matchUpStatus:d,participantId:_,stageSequence:p,roundNumber:f,structureId:m,matchUpId:D,drawId:C,stage:g}),(i||e)&&b7({participantMap:n,participantId:_,matchUpStatus:d,roundPosition:y,matchUpType:T,roundNumber:f,structureId:m,matchUpId:D,schedule:E,drawId:C,score:h})},V=({participant:_,partnerParticipantId:B})=>{let G=(j,K)=>{j&&(j.partnerParticipantIds||(j.partnerParticipantIds=[]),j.partnerParticipantIds.includes(K)||j.partnerParticipantIds.push(K))};l&&G(_?.draws?.[C],B),o&&G(_?.events?.[R],B),s&&G(_?.matchUps?.[D],B)};if(O&&n[O]){let _=N?.[k];$(O,_);let B=n[O]?.participant.participantType===pt,G=n[O]?.participant.individualParticipantIds||[];if(b){if(r){let j=K=>n[K].matchUps[b]={participantWon:w===k,matchUpId:b,matchUpType:Zt,sideNumber:k};j(O),G.forEach(j)}if(l&&!n[O].draws[C]){let j=S.find(X=>X.sideNumber===k)?.participant?.participantId,K=n[j]?.draws?.[C]?.entryStatus,Y=X=>n[X].draws[C]={entryStatus:K,eventId:R,drawId:C};Y(O),G.forEach(Y)}}if(B&&(G.forEach(j=>n[j]&&$(j,_)),G.forEach((j,K)=>{let Y=G[1-K],X=n[j];X&&V({participant:X,partnerParticipantId:Y})}),o&&S)){let j=S.find(K=>K.sideNumber===k)?.participant?.participantId;if(j){let K=n[j]?.events[R];K?(n[O].events[R]={...K},G.forEach(Y=>n[Y].events[R]={...K})):console.log("Missing teamEntry",{eventId:R,teamParticipantId:j})}}if(P){let j=K=>{x?(n[K].counters[T].wins+=1,n[K].counters.wins+=1,d===mi&&(n[K].counters[T].walkoverWins+=1,n[K].counters.walkoverWins+=1),d===Qt&&(n[K].counters[T].defaultWins+=1,n[K].counters.defaultWins+=1)):(n[K].counters[T].losses+=1,n[K].counters.losses+=1,d===mi&&(n[K].counters[T].walkovers+=1,n[K].counters.walkovers+=1),d===Qt&&(n[K].counters[T].defaults+=1,n[K].counters.defaults+=1))};j(O),G.forEach(j)}}}}function $R(t,e){return(t||"").localeCompare(e||"")}function fwe(t){let{participantFilters:e,convertExtensions:i,policyDefinitions:r,tournamentRecord:n,usePublishState:a,contextFilters:s,matchUpFilters:o,participantMap:l,contextProfile:u,withPotentialMatchUps:c,withRankingProfile:d,withScheduleItems:p,scheduleAnalysis:f,withTeamMatchUps:m,withStatistics:h,withOpponents:g,withMatchUps:I,withSeeding:v,withEvents:w,withDraws:y}=t,b=e?.participantIds,S=k=>{let F=[k];return l[k]?.participant.individualParticipantIds?.forEach(x=>F.push(x)),F.some(x=>!b?.length||b.includes(x))?F:[]},U={withMatchUps:I||d,withEvents:w||d,withDraws:y||d,withPotentialMatchUps:c,withRankingProfile:d,withScheduleItems:p,scheduleAnalysis:f,withTeamMatchUps:m,withStatistics:h,participantMap:l,withOpponents:g,withSeeding:v},T=[],P={},D=[],E={},R={},C={},M={},N={},A=({eventType:k,scaleNames:F,participantId:x})=>l[x]?.participant?.rankings?.[k]?.find(L=>F.includes(L.scaleName))?.scaleValue;for(let k of n?.events||[]){if(e?.eventIds&&!e.eventIds.includes(k.eventId))continue;let{drawDefinitions:F=[],extensions:x=[],wheelchairClass:L,eventType:$,eventName:V,category:_,entries:B,eventId:G,gender:j}=k,{flightProfile:K}=$i({event:k}),Y=K?.flights??[],X=vh({event:k}).publishState;X&&(E[G]=X);let Z=X?.status?.publishedSeeding;if(w||v||d){let ae=i?Object.assign({},...hF(x??[])):{};R[G]={...ae,wheelchairClass:L,eventName:V,eventType:$,category:_,eventId:G,gender:j};let te=[_?.categoryName,_?.ageCategoryCode].filter(Boolean);for(let ne of B){let{participantId:le}=ne;if(!le||!l[le])continue;let de=A({eventType:$,scaleNames:te,participantId:le}),pe,ge;if(v){let Pe=l[le].participant;({seedAssignments:pe,seedValue:ge}=uwe({publishedSeeding:Z,usePublishState:a,withSeeding:v,participant:Pe,event:k}))}let Me=Pe=>{if(l[Pe]?.events?.[G])return;let Be=l[Pe];cwe({convertExtensions:i,seedAssignments:pe,participant:Be,withSeeding:v,seedValue:ge,eventId:G,ranking:de,entry:ne})};Me(le),(l[le].participant.individualParticipantIds||[]).forEach(Me)}}let J=E?.[G]?.publishedSeeding;if(y||d||v){let ae=ne=>ne?Object.assign({},...ne.map(({participantId:le,seedValue:de,seedNumber:pe})=>({[le]:{seedValue:de,seedNumber:pe}}))):void 0,te=rt([...F.map(Sb),...Y.map(Sb)]);for(let ne of te){let le=F.find(ee=>ee.drawId===ne),de=[_?.categoryName,_?.ageCategoryCode].filter(Boolean),{structures:pe=[],drawOrder:ge,drawName:Me,drawType:Pe}=le??{},Be=Y?.find(ee=>ee.drawId===ne),fe=le?.entries||Be?.drawEntries,Te=Be?.flightNumber,ce=(le?.structures||[]).sort((ee,Se)=>ch(ee,Se)).map(({structureId:ee,structures:Se})=>[ee,...(Se||[]).map(({structureId:De})=>De)]).flat(1/0),ye,be,Fe,we,Ne=0,me=new Set(pe.filter(({stage:ee,stageSequence:Se})=>ee===xe&&Se===1||ee===We).flatMap(ee=>{let{positionAssignments:Se}=Yt({structure:ee}),{seedAssignments:De,stageSequence:it,stage:Ue}=ee;return Ue===xe?(Ne=Se?.length??0,Fe=Se,we=De):it===1&&(ye=Se,be=De),Se}).map(({participantId:ee})=>ee).filter(Boolean)),Ee=ae(we),Le=ae(be),Q=le?fe.filter(({participantId:ee})=>me.has(ee)):fe,se=!a||J?.published&&(J?.drawIds?.length===0||J?.drawIds?.includes(ne));for(let ee of Q){if(!l[ee.participantId])continue;let{entryStatus:Se,entryStage:De,entryPosition:it,participantId:Ue}=ee,ut=A({participantId:Ue,scaleNames:de,eventType:$}),yi=qe=>{if(!l[qe]||l[qe].draws?.[ne])return;let bi=v&&se,oi=bi?{}:void 0,nn=bi?Ee?.[Ue]?.seedValue||Ee?.[Ue]?.seedNumber:void 0,Fo=nn?Ee?.[Ue]:void 0,Nf=bi?Le?.[Ue]?.seedValue||Le?.[Ue]?.seedNumber:void 0,Af=Nf?Le?.[Ue]:void 0;oi&&nn&&(oi[xe]=Fo),oi&&Nf&&(oi[We]=Af);let cy=nn||Nf;cy&&(l[qe].participant.seedings[$]||(l[qe].participant.seedings[$]=[]),Fo&&l[qe].participant.seedings[$].push({...Fo,scaleName:ne}),Af&&l[qe].participant.seedings[$].push({...Af,scaleName:ne}),oi&&(l[qe].events[G].seedAssignments||(l[qe].events[G].seedAssignments={}),Object.keys(oi).forEach(dy=>l[qe].events[G].seedAssignments[dy]=oi[dy]))),(y||d)&&(l[qe].draws[ne]=Ve({seedAssignments:oi,entryPosition:it,entryStatus:Se,entryStage:De,seedValue:cy,eventId:G,ranking:ut,drawId:ne},!1,!1,!0))};[ys,of].includes(Se)||(yi(Ue),(l[Ue].participant.individualParticipantIds||[])?.forEach(yi))}let oe=(le?.structures??[]).reduce((ee,Se)=>(ee.includes(Se.stage)||ee.push(Se.stage),ee),[]),ue=(le?.links??[]).length;C[ne]={qualifyingPositionAssignments:ye,qualifyingSeedAssignments:be,mainPositionAssignments:Fe,qualifyingSeedingMap:Le,mainSeedAssignments:we,orderedStructureIds:ce,mainSeedingMap:Ee,flightNumber:Te,linksCount:ue,drawOrder:ge,drawName:Me,drawType:Pe,drawSize:Ne,drawId:ne,stages:oe}}}if(d||f||m||h||g||I||y){let ae=!!f||c,te=Ru({afterRecoveryTimes:!!f,policyDefinitions:r,tournamentRecord:n,inContext:!0,participantMap:l,contextFilters:s,matchUpFilters:o,contextProfile:u,nextMatchUps:ae,event:k})?.matchUps??[];for(let ne of te){let{finishingPositionRange:le,potentialParticipants:de,tieMatchUps:pe=[],sides:ge=[],winningSide:Me,matchUpType:Pe,matchUpId:Be,eventId:fe,drawId:Te,collectionId:ce,containerStructureId:ye,stageSequence:be,finishingRound:Fe,matchUpStatus:we,roundPosition:Ne,roundNumber:me,structureId:Ee,schedule:Le,score:Q,stage:se}=ne;if(P[Be]=ne,d&&ye&&Ee&&Te&&(M[Ee]||(M[Ee]=[]),M[Ee].push(ne),!N[ye])){let ue=F.find(ee=>ee.drawId===Te);ue&&(N[ye]={drawDefinition:ue,drawId:Te})}let oe={finishingPositionRange:le,containerStructureId:ye,finishingRound:Fe,stageSequence:be,roundPosition:Ne,collectionId:ce,roundNumber:me,structureId:Ee,schedule:Le,eventId:fe,drawId:Te,score:Q,stage:se};WH({...oe,...U,matchUpStatus:we,winningSide:Me,matchUpType:Pe,matchUpId:Be,sides:ge});for(let ue of pe){let{winningSide:ee,sides:Se=[],matchUpId:De,collectionPosition:it,collectionId:Ue,matchUpStatus:ut,matchUpType:yi}=ue;WH({...oe,...U,winningSide:ee,tieWinningSide:Me,matchUpTieId:Be,matchUpId:De,sides:Se,collectionId:Ue,collectionPosition:it,matchUpSides:ge,matchUpStatus:ut,matchUpType:yi})}Array.isArray(de)&&(ae||f||p)&&de.flat().map(vt).filter(Boolean)?.forEach(ue=>{S(ue)?.forEach(ee=>{l[ee]&&(l[ee].potentialMatchUps[Be]=Ve({tournamentId:n?.tournamentId,matchUpId:Be,eventId:fe,drawId:Te}))}),(f||p)&&b7({potential:!0,participantMap:l,participantId:ue,matchUpStatus:we,roundPosition:Ne,structureId:Ee,matchUpType:Pe,roundNumber:me,matchUpId:Be,schedule:Le,drawId:Te,score:Q})})}D.push(...te)}}let O={};if(d)for(let[k,F]of Object.entries(N)){let{drawDefinition:x,drawId:L}=F,$=x.structures?.find(j=>j.structureType===fn&&j.stage===xe&&j.stageSequence===1);if(!$?.structures)continue;let V=$.structures,_=V.length,B=V.reduce((j,K)=>j+(K.positionAssignments?.length||0),0),G=x.structures?.find(j=>j.stage===Ui);O[L]||(O[L]={});for(let j of V){let K=j.structureId,Y=M[K];if(!Y?.length)continue;let X=j.positionAssignments?.length,{subOrderMap:Z}=yL({positionAssignments:j.positionAssignments}),J=Ih({matchUps:Y,subOrderMap:Z});if(J?.participantResults)for(let[ae,te]of Object.entries(J.participantResults)){let{groupOrder:ne,provisionalOrder:le}=te,de=ne||le;if(!de)continue;let pe;if(B===X&&de)pe=[de,de];else if(_>1&&de&&!G)pe=[1,_];else if(_>1&&de&&G){let ge=x.links?.find(Me=>Me.source.structureId===k)?.source?.finishingPositions;if(ge){let Me=ge.length*_;if(ge.includes(de))pe=[1,Me];else{let Pe=(X-de)*_;pe=[Me+1,B-Pe]}}}pe&&(O[L][ae]=pe)}}}if(h||d||f){let k=Object.values(l);for(let F of k){let{wins:x,losses:L,[Wt]:{wins:$,losses:V},[$t]:{wins:_,losses:B}}=F.counters,G=(j,K,Y)=>{let X=K+Y,Z=K,J=X&&Z/X;F.statistics[j]={denominator:X,numerator:Z,statValue:J,statCode:j}};if(h&&(G(KT,x,L),G(`${KT}.${Wt}`,$,V),G(`${KT}.${$t}`,_,B)),d){let j=(K=[])=>Math.abs(K[0]-K[1]);for(let K of Object.keys(F.draws)){let{orderedStructureIds:Y=[],flightNumber:X}=C[K]||{};if(F.structureParticipation&&Y.length){let Z,J=0,ae=Y.map(te=>{let ne=F.structureParticipation[te];if(!ne)return;Z||(Z=ne?.finishingPositionRange),j(Z)>j(ne?.finishingPositionRange)&&(Z=ne?.finishingPositionRange);let le=ne.stage!==We;return le&&(J+=1),Ve({...ne,participationOrder:le?J:void 0,flightNumber:X})}).filter(Boolean);if(F.draws[K]){let te=F.participant.participantId,ne=O[K]?.[te];ne&&(Z=ne),F.draws[K].finishingPositionRange=Z,F.draws[K].structureParticipation=ae}}}}if(f){let j=bt(f)?f.scheduledMinutesDifference:0,K=F.scheduleItems||[],Y=F.potentialMatchUps||{},X=K.reduce((J,ae)=>{let{scheduledDate:te,scheduledTime:ne}=ae;return J[te]||(J[te]=[]),ne&&J[te].push(ae),J},{});Object.values(X).forEach(J=>J.sort(z4));for(let J of K){let{typeChangeTimeAfterRecovery:ae,timeAfterRecovery:te,scheduledDate:ne,scheduledTime:le}=J,de=X[ne],pe=Pt(le);for(let ge of de){if(ge.matchUpId===J.matchUpId||Fr(ge.matchUpStatus)&&!ge.checkScoreHasValue)continue;let Me=J.matchUpType!==ge.matchUpType&&ae||te,Pe=J.drawId===ge.drawId,Be=Y[J.matchUpId]&&Y[ge.matchUpId],fe=Pt(ge.scheduledTime),Te=Math.abs(fe-pe),ce=fe>=pe;if((j&&!Number.isNaN(j)?Te<=j:ce&&Pt(ge.scheduledTime)<Pt(Me))&&!(Be&&Pe)&&ce){let ye=[J.matchUpId,ge.matchUpId].sort($R).join("|");F.scheduleConflicts[ye]={priorScheduledMatchUpId:J.matchUpId,matchUpIdWithConflict:ge.matchUpId}}}}let Z=F.participant.participantId;Object.keys(F.scheduleConflicts).length&&T.push(Z),l[Z].scheduleConflicts=F.scheduleConflicts}}}return{participantIdsWithConflicts:T,eventsPublishStatuses:E,derivedEventInfo:R,derivedDrawInfo:C,mappedMatchUps:P,participantMap:l,matchUps:D}}function pS({participantFilters:t={},tournamentRecord:e,participants:i=[]}){if(!Object.keys(t).length)return i;let{accessorValues:r,drawEntryStatuses:n,positionedParticipants:a,eventEntryStatuses:s,participantRoles:o,participantRoleResponsibilities:l,participantTypes:u,participantIds:c,signInStatus:d,enableOrFiltering:p,eventIds:f,genders:m}=t,h=Ml(f)&&e?.events?.filter(y=>f?.includes(y.eventId))||e?.events||[],g=n&&mwe({drawEntryStatuses:n,tournamentEvents:h}),I=s&&hwe({eventEntryStatuses:s,tournamentEvents:h}),v=a!==void 0&&[!0,!1].includes(a)&&h.reduce((y,b)=>y.concat(...(b.drawDefinitions||[]).map(S=>cK({drawDefinition:S}).allPositionedParticipantIds).filter(Boolean)),[]),w=y=>r?.reduce((b,S)=>{let{accessor:U,value:T}=S,{values:P}=hp({element:y,accessor:U});return b&&P?.includes(T)},!0);if(i=i?.filter(y=>{let b=vs({element:y,itemType:Yw})?.timeItem?.itemValue,{participantRoleResponsibilities:S,participantType:U,participantRole:T,participantId:P,person:D}=y,E=Array.isArray(m)&&m?.length&&D?.sex&&m.includes(D.sex);return p?m&&E||a&&v.includes(P)||a===!1&&!v.includes(P)||g?.includes(P)||I?.includes(P)||c?.includes(P)||d&&b===d||u&&U&&Ml(u)&&u.includes(U)||o&&T&&Ml(o)&&o.includes(T)||l&&Ml(S)&&Ml(l)&&l.find(R=>S?.includes(R))||r?.length&&Ml(r)&&w(y):(!m||E)&&(a===void 0||a&&v.includes(P)||a===!1&&!v.includes(P))&&(!g||g.includes(P))&&(!I||I.includes(P))&&(!c||c.includes(P))&&(!d||b===d)&&(!u||U&&Ml(u)&&u.includes(U))&&(!o||T&&Ml(o)&&o.includes(T))&&(!l||Ml(S)&&Ml(l)&&l.find(R=>S?.includes(R)))&&(!r?.length||Ml(r)&&w(y))}),h.length&&f){let y=new Set(h.filter(b=>f.includes(b.eventId)).flatMap(b=>{let S=(b.entries||[]).map(T=>T.participantId);if(Di(nl)(b.eventType))return S;let U=(e?.participants??[]).filter(T=>S.includes(T.participantId)).flatMap(T=>T.individualParticipantIds);return S.concat(...U)}));i=i?.filter(b=>y.has(b.participantId))}return i}function Ml(t){return t&&Array.isArray(t)&&t.length}function mwe({drawEntryStatuses:t,tournamentEvents:e}){let i=({entryStatus:r})=>Array.isArray(t)?t.includes(r):!0;return rt(e.reduce((r,n)=>{let{flightProfile:a}=$i({event:n}),s=a?.flights?.flatMap(({drawEntries:l})=>Array.isArray(l)?l.filter(i).map(vt):[])||[],o=n.drawDefinitions?.map(({entries:l})=>l?l.filter(i).map(vt):[])||[];return r.concat(...s,...o)},[]))}function hwe({eventEntryStatuses:t,tournamentEvents:e}){return rt(e.reduce((i,r)=>{let n=(r.entries||[]).filter(({entryStatus:a})=>Array.isArray(t)?t.includes(a):!0).map(vt);return i.concat(...n)},[]))}function Ei(t){let{withIndividualParticipants:e,participantFilters:i={},withPotentialMatchUps:r,withRankingProfile:n,convertExtensions:a,policyDefinitions:s,withScheduleItems:o,tournamentRecord:l,scheduleAnalysis:u,withSignInStatus:c,withTeamMatchUps:d,withScaleValues:p,usePublishState:f,withStatistics:m,contextFilters:h,matchUpFilters:g,contextProfile:I,withOpponents:v,withMatchUps:w,internalUse:y,withSeeding:b,withEvents:S,withDraws:U,withISO2:T,withIOC:P}=t,D="getParticipants";if(!l)return z({stack:D,result:{error:Ie}});(w||n)&&oo({tournamentRecord:l});let E=TK({convertExtensions:a,tournamentRecord:l,withSignInStatus:c,withScaleValues:p,internalUse:y,withISO2:T,withIOC:P}),{participantMap:R}=E,C=fwe({withMatchUps:w??n,withEvents:S??n,withDraws:U??n,withPotentialMatchUps:r,participantFilters:i,withRankingProfile:n,convertExtensions:a,withScheduleItems:o,policyDefinitions:s,tournamentRecord:l,scheduleAnalysis:u,withTeamMatchUps:d,usePublishState:f,withStatistics:m,contextFilters:h,matchUpFilters:g,participantMap:R,withOpponents:v,contextProfile:I,withSeeding:b}),{participantIdsWithConflicts:M,eventsPublishStatuses:N,derivedEventInfo:A,derivedDrawInfo:O,mappedMatchUps:k}=C,F=C.matchUps;R=C.participantMap;let x=u??r,L=({potentialMatchUps:j,scheduleConflicts:K,scheduleItems:Y,participant:X,statistics:Z,opponents:J,matchUps:ae,events:te,draws:ne})=>{let le=Object.values(ne),de=Object.values(J);return v&&le?.forEach(pe=>{pe.opponents=de.filter(ge=>ge.drawId===pe.drawId)}),Ve({...X,scheduleConflicts:u?Object.values(K):void 0,draws:U||n?le:void 0,events:S||n?Object.values(te):void 0,matchUps:w||n?Object.values(ae):void 0,opponents:v?de:void 0,potentialMatchUps:x?Object.values(j):void 0,statistics:m?Object.values(Z):void 0,scheduleItems:o?Y:void 0},!1,!1,!0)},$=new Map;for(let j of Object.keys(R))$.set(j,L(R[j]));let V=[...$.values()],_=s?.[jw]?.participant,B=pS({participants:V,participantFilters:i,tournamentRecord:l});if(e){let j=bt(e)?e:void 0;for(let K of B)for(let Y of K.individualParticipantIds??[]){K.individualParticipants??=[];let X=$.get(Y),Z=j?Rm({template:j,source:X}):X;K.individualParticipants.push(Z)}}let G=_?B.map(j=>Rm({source:j,template:_})):B;return{participantMap:t.returnParticipantMap!==!1?R:void 0,mappedMatchUps:t.returnMatchUps!==!1?k:void 0,matchUps:t.returnMatchUps!==!1?F:void 0,missingParticipantIds:E.missingParticipantIds,participantIdsWithConflicts:M,eventsPublishStatuses:N,derivedEventInfo:A,derivedDrawInfo:O,participants:G,...H}}function Am(t){let{tournamentRecord:e,scaleAttributes:i,participantId:r}=t,n=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(!r)return{error:lr};let{participant:a,tournamentId:s}=$d({tournamentRecords:n,tournamentRecord:e,participantId:r});return a?{...Hl({participant:a,scaleAttributes:i}),tournamentId:s}:{error:Vi}}function gwe(t,e){let i=t.startDate||e?.startDate,r=t.endDate||e?.endDate;return!i||!r?{error:CIe}:!Pn(i)||!Pn(r)?{error:sr}:{startDate:i,endDate:r}}function zH(t,e){let i=new Date(Qe(t)),r=new Date(Qe(e)),n=r.getFullYear()-i.getFullYear(),a=r.getMonth()-i.getMonth();return(a<0||a===0&&r.getDate()<i.getDate())&&n--,n}function qH(t,e,i){return!(e!==void 0&&t<e||i!==void 0&&t>i)}function Iwe(t){return/^C\d{1,2}-\d{1,2}$/.test(t.ageCategoryCode||"")}function vwe(t,e,i,r){if(Iwe(e))return{valid:!0};let n=e.ageMin,a=e.ageMax;if(e.ageCategoryCode&&!n&&!a){let d=Tp({consideredDate:i,category:e});d.error||(n=d.ageMin,a=d.ageMax)}if(!n&&!a)return{valid:!0};let s=t.person?.birthDate;if(!s)return{valid:!1,reason:"Missing birthDate",details:{requiredMin:n,requiredMax:a}};let o=zH(s,i),l=zH(s,r),u=qH(o,n,a),c=qH(l,n,a);if(!u){let d=[n===void 0?null:`min: ${n}`,a===void 0?null:`max: ${a}`].filter(Boolean).join(", ");return{valid:!1,reason:`Age ${o} at event start (${i}) outside range [${d}]`,details:{birthDate:s,ageAtStart:o,ageAtEnd:l,requiredMin:n,requiredMax:a}}}if(!c){let d=[n===void 0?null:`min: ${n}`,a===void 0?null:`max: ${a}`].filter(Boolean).join(", ");return{valid:!1,reason:`Age ${l} at event end (${r}) outside range [${d}]`,details:{birthDate:s,ageAtStart:o,ageAtEnd:l,requiredMin:n,requiredMax:a}}}return{valid:!0}}function ywe(t,e,i,r){if(!e.ratingMin&&!e.ratingMax)return{valid:!0};if(!e.ratingType)return{valid:!0};let n={scaleType:"RATING",scaleName:e.ratingType,eventType:i.eventType},{scaleItem:a}=Am({tournamentRecord:r,participantId:t.participantId,scaleAttributes:n});if(!a?.scaleValue)return{valid:!1,reason:`Missing ${e.ratingType} rating`,details:{ratingType:e.ratingType,requiredMin:e.ratingMin,requiredMax:e.ratingMax}};let s;if(typeof a.scaleValue=="object"){let o=hp({element:a.scaleValue,accessor:a.scaleValue?.accessor});if(o===void 0)return{valid:!1,reason:`Cannot extract rating value from ${e.ratingType} scale item`,details:{ratingType:e.ratingType,requiredMin:e.ratingMin,requiredMax:e.ratingMax}};s=o}else s=a.scaleValue;return e.ratingMin!==void 0&&s<e.ratingMin?{valid:!1,reason:`${e.ratingType} rating ${s} below minimum ${e.ratingMin}`,details:{ratingType:e.ratingType,ratingValue:s,requiredMin:e.ratingMin,requiredMax:e.ratingMax}}:e.ratingMax!==void 0&&s>e.ratingMax?{valid:!1,reason:`${e.ratingType} rating ${s} above maximum ${e.ratingMax}`,details:{ratingType:e.ratingType,ratingValue:s,requiredMin:e.ratingMin,requiredMax:e.ratingMax}}:{valid:!0}}function bwe(t){let e=t.person;if(!e)return"Unknown";let i=e.standardGivenName||e.passportGivenName,r=e.standardFamilyName||e.passportFamilyName;return[i,r].filter(Boolean).join(" ")||"Unknown"}function wwe(t,e,i,r,n,a){let s=vwe(t,e,r,n),o=ywe(t,e,i,a);if(!s.valid||!o.valid){let l={participantId:t.participantId,participantName:bwe(t),rejectionReasons:[]};return s.valid||l.rejectionReasons.push({type:"age",reason:s.reason,details:s.details||{}}),o.valid||l.rejectionReasons.push({type:"rating",reason:o.reason,details:o.details||{}}),l}return null}function rm({participantId:t,drawDefinition:e,entryStatus:i,entryStage:r}){if(!e)return{error:_e};let n=e.entries?.find(a=>a.participantId===t&&(!i||i===a.entryStatus)&&(!r||r===a.entryStage));return t&&n}function Swe({relevantLinks:t,drawDefinition:e,provisionalPositioning:i,roundQualifiersCounts:r}){let n=0;for(let a of t){let s=et({structureId:a.source.structureId,drawDefinition:e})?.structure;if(s?.stage===We){let o=a.source.roundNumber,l=a.target.roundNumber,u;if(s.structureType===fn){let c=s.structures?.length??0,d=a.source.finishingPositions?.length??0;u=c*d}else u=Nt({matchUpFilters:{roundNumbers:[o]},structure:s,afterRecoveryTimes:!1,provisionalPositioning:i,inContext:!1}).matchUps?.length||0;r[l]||(r[l]=0),r[l]+=u,n+=u}}return n}function pv(t){let{provisionalPositioning:e,drawDefinition:i,stageSequence:r,structureId:n,stage:a}=t;if(!i)return{error:_e};let{entryProfile:s}=Jw({drawDefinition:i}),o=a&&r&&s?.[a]?.stageSequence?.[r]?.qualifiersCount||a&&s?.[a]?.qualifiersCount||0,l={};if(!n)return{qualifiersCount:o,roundQualifiersCounts:l};let{structure:u}=et({drawDefinition:i,structureId:n}),c=i.links?.filter(f=>f?.target?.structureId===u?.structureId),d=0;c?.length&&(d=Swe({relevantLinks:c,drawDefinition:i,provisionalPositioning:e,roundQualifiersCounts:l}));let p=Object.keys(l);if(p.length<=1){let f=p[0]||1;l[f]=Math.max(l[f]||0,o)}return d=Math.max(d,o),{qualifiersCount:d,roundQualifiersCounts:l}}function aP({stage:t,drawDefinition:e}){let{entryProfile:i}=Jw({drawDefinition:e});return i?.[t]?.drawSize||0}function Uwe(t){let{provisionalPositioning:e,drawDefinition:i,stageSequence:r,stage:n}=t,a=aP({stage:n,drawDefinition:i}),{qualifiersCount:s}=pv({provisionalPositioning:e,drawDefinition:i,stageSequence:r,stage:n});return a&&a-s}function w7({stage:t,drawDefinition:e}){return!!(t===Er||aL({stage:t,drawDefinition:e})&&aP({stage:t,drawDefinition:e}))}function S7({entryStatus:t=aa,drawDefinition:e,stageSequence:i,stage:r}){if(t===Fs)return jye({stage:r,drawDefinition:e})?{positionsAvailable:1/0,...H}:{error:r4};let n=Uwe({drawDefinition:e,stageSequence:i,stage:r}),a=Gye({drawDefinition:e,stage:r}),s=fO({entryStatus:sI,drawDefinition:e,stage:r}),o=fO({entryStatus:aa,drawDefinition:e,stage:r}),l=s+o,u=l>=n,c=n-l;return r!==Er&&u?{error:eO}:t===sI?s<a?{...H}:{error:eO}:{positionsAvailable:c,...H}}function wL(t){let e=Ge(t,[{[mn]:!0,[B5]:!0}]);if(e.error)return e;let{suppressDuplicateEntries:i=!0,entryStatus:r=aa,entryStageSequence:n,entryStage:a=xe,ignoreStageSpace:s,drawDefinition:o,entryPosition:l,participant:u,roundTarget:c,extensions:d,extension:p,drawType:f,event:m}=t,h="addDrawEntry";if(f!==na&&!w7({stage:a,drawDefinition:o}))return z({result:{error:ef},stack:h});let g=S7({stageSequence:n,stage:a,drawDefinition:o,entryStatus:r});if(!s&&!g.success&&(!f||f!==na))return{error:g.error};if(p&&!sl({extension:p}))return z({result:{error:ie},info:"Invalid extension",context:{extension:p},stack:h});let I=t.participantId||u?.participantId;if(!I)return z({result:{error:lr},stack:h});let v=r===mc&&rm({participantId:I,drawDefinition:o,entryStatus:r}),w=a===Er&&rm({participantId:I,drawDefinition:o,entryStage:a}),y=rm({participantId:I,drawDefinition:o}),b=r!==mc&&a!==Er&&y;if(b)return i?(at({payload:{drawId:o.drawId,eventId:m?.eventId,error:lb,participantId:I},topic:VF}),{...H}):z({result:{error:lb},context:{participantId:I},stack:h});if(v||w)return z({context:{invalidEntry:b,invalidLuckyLoser:v,invalidVoluntaryConsolation:w},result:{error:YE},stack:h});let S=Ve({entryStageSequence:n,participantId:I,entryPosition:l,entryStatus:r,entryStage:a,extensions:d});return p&&xt({element:S,extension:p}),c&&xt({extension:{name:"roundEntry",value:c},element:S}),o.entries??=[],o.entries.push(S),ti({drawDefinition:o}),{...H}}function Twe(t){let e="addDrawEntries",{suppressDuplicateEntries:i=!0,entryStatus:r=aa,autoEntryPositions:n=!0,ignoreStageSpace:a,participantIds:s,drawDefinition:o,stageSequence:l,stage:u=xe,roundTarget:c,extension:d,event:p}=t,f=o.drawType===na;if(!u)return{error:M6};if(!o)return{error:_e};if(!Array.isArray(s))return{error:ga};if(!f&&!w7({stage:u,drawDefinition:o}))return{error:ef};if(d&&!sl({extension:d}))return z({result:{error:ie},info:"Invalid extension",context:{extension:d},stack:e});let m=S7({drawDefinition:o,stageSequence:l,entryStatus:r,stage:u});if(!a&&!m.success&&!f)return{error:m.error};let h=m.positionsAvailable??0;if(!a&&!f&&u!==Er&&h<s.length)return{error:z1};let g=[],I=o.drawId,v=p?.eventId,w=s.reduce((y,b)=>{let S=r===mc&&rm({participantId:b,drawDefinition:o,entryStatus:r}),U=u===Er&&rm({entryStage:u,drawDefinition:o,participantId:b}),T=rm({participantId:b,drawDefinition:o});return r!==mc&&u!==Er&&T&&(g.push(b),i&&at({payload:{error:lb,participantId:b,eventId:v,drawId:I},topic:VF})),S||U?y.concat(b):y},[]);return g.length&&!i?z({context:{eventId:v,drawId:I,duplicateEntries:g},result:{error:lb},stack:e}):(s.filter(y=>y&&!w.includes(y)).forEach(y=>{let b={entryStageSequence:l,entryStage:u,participantId:y,entryStatus:r};d&&xt({element:b,extension:d}),c&&xt({extension:{name:Tl,value:c},element:b}),o.entries??=[],o.entries.push(b)}),n&&(o.entries=vo({entries:o.entries})),ti({drawDefinition:o}),w?.length||g?.length?{info:"some participantIds could not be added",participantIdsNotAdded:w,duplicateEntries:g,...H}:{...H})}function SL({suppressDuplicateEntries:t=!0,autoEntryPositions:e=!0,entryStageSequence:i,ignoreStageSpace:r,participantIds:n,drawDefinition:a,entryStatus:s,roundTarget:o,entryStage:l,extension:u,drawId:c,event:d}){if(!n?.length)return{error:Od};if(!d)return{error:os};if(!c)return{error:Oo};let p=(d.entries||[]).map(vt);if(n.filter(h=>!p.includes(h)).length)return{error:R6};if(a){let h=Twe({stageSequence:i,suppressDuplicateEntries:t,autoEntryPositions:e,stage:l,ignoreStageSpace:r,participantIds:n,drawDefinition:a,entryStatus:s,roundTarget:o,extension:u});if(h.error)return h}let{flightProfile:f}=$i({event:d}),m=f?.flights.find(h=>h.drawId===c);return m?.drawEntries&&(n.forEach(h=>{let g=s===mc&&AA({participantId:h,entryStatus:s,flight:m}),I=l===Er&&AA({participantId:h,entryStage:l,flight:m});!(s!==mc&&l!==Er&&AA({flight:m,participantId:h}))&&!g&&!I&&m.drawEntries.push({participantId:h,entryStatus:s,entryStage:l})}),e&&(m.drawEntries=vo({entries:m.drawEntries}))),{...H}}function AA({participantId:t,entryStatus:e,entryStage:i,flight:r}){let n=r.drawEntries?.find(a=>a.participantId===t&&(!e||e===a.entryStatus)&&(!i||i===a.entryStage));return t&&n}function fS({autoEntryPositions:t=!0,participantIds:e=[],entryStatuses:i,stage:r,event:n}){let a="removeEventEntries";if(!n?.eventId)return{error:li};if(!Array.isArray(e)||e.some(d=>!ri(d)))return z({result:{error:To},stack:a});let s=(n.drawDefinitions??[]).flatMap(d=>df({drawDefinition:d}).assignedParticipantIds??[]),o=(i?.length&&n.entries?.filter(d=>d.entryStatus&&i.includes(d.entryStatus))||[]).map(vt).filter(d=>!s.includes(d)),l=(r&&n.entries?.filter(d=>d.entryStage&&d.entryStage===r)||[]).map(vt).filter(d=>!s.includes(d));if(e.length?e=e.filter(d=>(!i?.length||o.includes(d))&&(!r||l.includes(d))):o.length&&l.length?e=xi(o,l):o.length?e=o:l.length&&(e=l),e?.length&&s.some(d=>e.includes(d)))return z({result:{error:ev},stack:a});if(!e?.length)return{...H,participantIdsRemoved:[]};let u=[];n.entries=(n.entries??[]).filter(d=>{let p=!e.includes(d?.participantId);return p||u.push(d.participantId),p}),t&&(n.entries=vo({entries:n.entries}));let{flightProfile:c}=$i({event:n});return c?.flights?.forEach(d=>{d.drawEntries=(d.drawEntries||[]).filter(p=>!e.includes(p.participantId))}),n.drawDefinitions?.forEach(d=>{d.entries=(d.entries??[]).filter(p=>!e.includes(p.participantId))}),{...H,participantIdsRemoved:u}}var U7={[Rr]:{policyName:"matchUpActionsDefault",enabledStructures:[{stages:[],stageSequences:[],enabledActions:[],disabledActions:[]}],participants:{enforceCategory:!0,enforceGender:!0},processCodes:{substitution:["RANKING.IGNORE","RATING.IGNORE"]},substituteAfterCompleted:!1,substituteWithoutScore:!1}},fv=U7;function Dwe(t,e,i,r){return e.gender&&i&&!(Na(e.gender)||eu(e.gender))&&on(e.gender)!==on(t.person?.sex)?(r.push({participantId:t.participantId,sex:t.person?.sex}),!1):!0}function Pwe({participantIds:t,typedParticipantIds:e,checkTypedParticipants:i}){return t.filter(r=>!i||e.includes(r))}function Ewe({tournamentRecord:t,participantIds:e,event:i,entryStatus:r,genderEnforced:n,mismatchedGender:a}){function s(c,d,p){return Di(Wt)(d.eventType)&&c.participantType===gt&&!up(p)}function o(c,d,p){return d.eventType===$t&&c.participantType===pt&&!up(p)}function l(c,d,p,f,m){return d.eventType===$t&&c.participantType===gt&&up(p)?d.gender&&f&&!(Na(d.gender)||eu(d.gender))&&on(d.gender)!==on(c.person?.sex)?(m.push({participantId:c.participantId,sex:c.person?.sex}),!1):!0:!1}function u(c,d,p){return d.eventType===Lt&&(c.participantType===Lt||up(p)&&c.participantType===gt)}return t?.participants?.filter(c=>e.includes(c.participantId)?s(c,i,r)&&(!i.gender||!n||Na(i.gender)||eu(i.gender)||on(i.gender)===on(c.person?.sex))||o(c,i,r)||l(c,i,r,n,a)?!0:s(c,i,r)&&!Dwe(c,i,n,a)?!1:u(c,i,r):!1).map(c=>c.participantId)??[]}function Rwe({typedParticipantIds:t,categoryRejections:e,tournamentRecord:i,startDate:r,endDate:n,event:a}){let s=[];for(let o of t){let l=i.participants?.find(u=>u.participantId===o);if(l)if(a.category){let u=wwe(l,a.category,a,r,n,i);u?e.push(u):s.push(o)}else s.push(o)}return s}function Cwe({enforceCategory:t,event:e,tournamentRecord:i,typedParticipantIds:r,categoryRejections:n}){if(t&&e.category&&i){let a=gwe(e,i);if(!("error"in a)){let{startDate:s,endDate:o}=a;return Rwe({typedParticipantIds:r,tournamentRecord:i,event:e,startDate:s,endDate:o,categoryRejections:n})}}return r}function Mwe({validParticipantIds:t,existingIds:e,entryStatus:i,entryStage:r,extensions:n,extension:a,roundTarget:s,entryStageSequence:o,addedParticipantIdEntries:l,event:u}){t.forEach(c=>{if(!e.has(c)){let d=Ve({participantId:c,entryStatus:i,entryStage:r,extensions:n});a&&xt({element:d,extension:a}),s&&xt({extension:{name:Tl,value:s},element:d}),o&&(d.entryStageSequence=o),l.push(d.participantId),u.entries?.push(d)}})}function Nwe({tournamentRecord:t,removedEntries:e,event:i}){if(i.eventType&&[lc,ya].includes(i.eventType)){let r=new Set((i.entries||[]).map(l=>l.participantId)),n=(i.entries||[]).filter(l=>up(l.entryStatus)).map(l=>l.participantId),a=t?.participants??[],s=new Set(a.filter(l=>r.has(l.participantId)&&l.participantType&&[pt,Lt].includes(l.participantType)).map(l=>l.individualParticipantIds).flat(1/0)),o=n.filter(l=>s.has(l));o.length&&(e.push(...o),fS({participantIds:o,autoEntryPositions:!1,event:i}))}}function Awe(t,e){if(!Array.isArray(t.participantIds))return z({result:{error:ga},stack:e});let i=rt(t.participantIds??[]);return t.event?i?.length?t.event?.eventId?{participantIds:i}:{error:os}:z({result:{error:Od},stack:e}):{error:li}}function kwe({policyDefinitions:t,tournamentRecord:e,event:i,enforceGender:r}){let n=Tt({tournamentRecord:e,event:i}).appliedPolicies??{},a=t?.[Rr]??n?.[Rr]??fv[Rr],s=(r??a?.participants?.enforceGender)!==!1;return{matchUpActionsPolicy:a,genderEnforced:s}}function Owe(t,e,i){return t&&(!Array.isArray(t)||!t.every(r=>sl({extension:r})))||e&&!sl({extension:e})?z({context:Ve({extension:e,extensions:t}),result:{error:ie},info:"Invalid extension(s)",stack:i}):null}function Ko(t){let{suppressDuplicateEntries:e=!0,entryStatus:i=aa,autoEntryPositions:r=!0,enforceCategory:n=!1,enforceGender:a=!0,entryStageSequence:s,policyDefinitions:o,entryStage:l=xe,tournamentRecord:u,ignoreStageSpace:c,drawDefinition:d,roundTarget:p,extensions:f,extension:m,drawId:h,event:g}=t,I="addEventEntries",v=Awe(t,I);if("error"in v)return v;let w="participantIds"in v?v.participantIds:[],y=Owe(f,m,I);if(y)return y;let{genderEnforced:b}=kwe({policyDefinitions:o,tournamentRecord:u,event:g,enforceGender:a}),S=[],U=[],T=!!u,P=[],D,E=Ewe({tournamentRecord:u,participantIds:w,event:g,entryStatus:i,genderEnforced:b,mismatchedGender:P}),R=[];E=Cwe({enforceCategory:n,event:g,tournamentRecord:u,typedParticipantIds:E,categoryRejections:R});let C=Pwe({participantIds:w,typedParticipantIds:E,checkTypedParticipants:T});g.entries??=[];let M=new Set(g.entries.map(O=>O.participantId||O.participant?.participantId));if(Mwe({validParticipantIds:C,existingIds:M,entryStatus:i,entryStage:l,extensions:f,extension:m,roundTarget:p,entryStageSequence:s,addedParticipantIdEntries:S,event:g}),h&&!up(l)){let O=SL({participantIds:C,suppressDuplicateEntries:e,autoEntryPositions:r,entryStageSequence:s,ignoreStageSpace:c,drawDefinition:d,entryStatus:i,roundTarget:p,entryStage:l,extension:m,drawId:h,event:g});O.error&&(D=O.error)}if(Nwe({event:g,tournamentRecord:u,removedEntries:U}),C.length!==w.length)return z({context:Ve({categoryRejections:R.length?R:void 0,mismatchedGender:P.length?P:void 0,gender:g.gender}),result:{error:ga},stack:I});r&&(g.entries=vo({entries:g.entries||[]}));let N=S.length,A=U.length;return z({result:{...H,addedEntriesCount:N,removedEntriesCount:A,...R.length&&{context:Ve({categoryRejections:R})}},stack:I,info:D})}var T7="ADMINISTRATION",xwe="CAPTAIN",Fwe="COACH",Kr="COMPETITOR",Lwe="DIRECTOR",_we="HOSPITALITY",D7="MEDIA",P7="MEDICAL",UL="OFFICIAL",E7="OTHER",R7="SECURITY",$we="STRINGER",Bwe="SUPERVISOR",Vwe="TRANSPORT",jwe="VOLUNTEER",TL={ADMINISTRATION:T7,CAPTAIN:xwe,COACH:Fwe,COMPETITOR:Kr,DIRECTOR:Lwe,HOSPITALITY:_we,MEDIA:D7,MEDICAL:P7,OFFICIAL:UL,OTHER:E7,SECURITY:R7,STRINGER:$we,SUPERVISOR:Bwe,TRANSPORT:Vwe,VOLUNTEER:jwe};function DL({addIndividualParticipantsToEvents:t,individualParticipantIds:e,groupingParticipantId:i,tournamentRecord:r,suppressErrors:n}){let a="removeIndividualParticipantIds";if(!r)return z({result:{error:Ie},stack:a});if(!i||!e)return z({result:{error:Xe},stack:a});let s=(r.participants??[]).find(c=>c.participantId===i);if(!s)return z({result:{error:Vi},stack:a});if(![Lt,ja].includes(s.participantType))return z({result:{participantType:s.participantType,error:Do},stack:a});let o=C7({individualParticipantIds:e,groupingParticipant:s,tournamentRecord:r,suppressErrors:n}),{removed:l,error:u}=o;if(u)return z({result:o,stack:a});if(t)for(let c of r.events??[]){let d=(c.entries??[]).map(({participantId:p})=>p).filter(Boolean);if(d.includes(i)){let p=l?.filter(f=>!d.includes(f));Ko({participantIds:p,entryStatus:ys,tournamentRecord:r,event:c})}}return l&&at({topic:en,payload:{tournamentId:r.tournamentId,participants:[s]}}),{...H,...o}}function C7({individualParticipantIds:t=[],groupingParticipant:e,tournamentRecord:i,suppressErrors:r,mappedMatchUps:n,participants:a}){let s=[];if(!e)return{removed:s};let o=[],l=[];a||({participants:a,mappedMatchUps:n}=Ei({withMatchUps:!0,tournamentRecord:i,withEvents:!0}));let u=a?.find(({participantId:p})=>p===e.participantId)?.events?.map(({eventId:p})=>p),c=(e.individualParticipantIds??[]).filter(p=>{let f=t?.includes(p),m=f&&a?.find(g=>g.participantId===p)?.matchUps.filter(({eventId:g})=>u.includes(g)).map(({matchUpId:g})=>n?.[g]).filter(({winningSide:g,score:I})=>g||cr({score:I})),h=f&&!m?.length;if(f&&!h&&l.push(p),h){s.push(p);for(let g of i.events??[])for(let I of g.drawDefinitions??[]){let{extension:v}=mt({element:I,name:cc}),w=v?.value[e.participantId];v&&w&&(v.value[e.participantId]=w.filter(b=>b.participantId!==p),xt({element:I,extension:v}),zw({drawDefinition:I}));let y=Rn({drawDefinition:I,inContext:!1}).matchUps??[];for(let b of y){let S=b.sides??[];for(let U of S){let T=U.lineUp??[];T.find(P=>P.participantId===p)&&(U.lineUp=T.filter(P=>P.participantId!==p),St({tournamentId:i?.tournamentId,drawDefinition:I,matchUp:b}))}}}}else o.push(p);return!h});e.individualParticipantIds=c;let d={groupingParticipantId:e.participantId,cannotRemove:l,notRemoved:o,removed:s};return l.length&&!r&&{...d,cannotRemove:l,error:zE}||d}function BR({participantRole:t=Kr,individualParticipantIds:e=[],groupingTypes:i=[_n,ja],tournamentRecord:r}){if(!r)return{error:Ie};let n=r.participants??[],{participants:a,mappedMatchUps:s}=Ei({withMatchUps:!0,tournamentRecord:r,withEvents:!0}),o=0;return n.filter(l=>(l.participantRole===t||!l.participantRole)&&l.participantType&&i.includes(l.participantType)).forEach(l=>{let{removed:u}=C7({groupingParticipant:l,individualParticipantIds:e,tournamentRecord:r,mappedMatchUps:s,participants:a});u&&o++}),o?H:{error:Q6}}function yh(t){let e=Ge(t,[{[mr]:!0},{participantIds:!0,[zn]:an,[xs]:Od}]);if(e.error)return e;let{addIndividualParticipantsToEvents:i,tournamentRecord:r,participantIds:n}=t,a=r.participants?.length||0;if(!a)return{...H};let s=(r.events||[])?.filter(({eventType:m})=>m===rr).map(m=>m?.drawDefinitions?.map(({drawId:h})=>h)).flat(1/0),o=Ei({participantFilters:{participantIds:n},tournamentRecord:r,withDraws:!0}).participants??[],l=m=>{let h=(br({matchUpFilters:{drawIds:m,matchUpTypes:[$t]},tournamentRecord:r}).matchUps??[]).flatMap(({sides:g})=>g?.map(({participantId:I})=>I||[])).filter(Boolean);return xi(h,n)},u=s?.length?l(s):[],c=o.filter(m=>m.draws?.filter(h=>(!s?.length||!s?.includes(h.drawId))&&h.positionAssignments).length);if(u?.length||c.length)return{error:ev};let d={},p={};for(let m of r.events||[]){let h=fS({participantIds:n,event:m});if(h.error)return h;d[m.eventId]=h.participantIdsRemoved}r.participants=(r.participants??[]).filter(m=>{let h=n.includes(m.participantId)||m.participantType===pt&&m.individualParticipantIds?.some(g=>n.includes(g));if(!h&&m.participantType===rr&&m.individualParticipantIds?.some(g=>n.includes(g))&&(m.individualParticipantIds=m.individualParticipantIds.filter(g=>!n.includes(g))),h&&i&&m.participantType&&[pt,Lt].includes(m.participantType))for(let g of m.individualParticipantIds||[])n.includes(g)||(p[m.participantId]||(p[m.participantId]=[]),p[m.participantId].push(g));return!h});let f=a-r.participants.length;if(BR({individualParticipantIds:n,tournamentRecord:r}),i)for(let m of r.events||[]){let h=d[m.eventId].map(g=>p[g]||[]).flat();Ko({participantIds:h,entryStatus:ys,tournamentRecord:r,event:m})}return f&&at({payload:{participantIds:n,tournamentId:r.tournamentId},topic:jF}),f?{...H,participantsRemovedCount:f}:{error:zE}}function M7({selected:t=!0,drawDefinition:e,entryStatuses:i,drawId:r,event:n,stage:a}){let s=n.entries??[];if(r){let{flightProfile:l}=$i({event:n}),u=l?.flights?.find(c=>c.drawId===r);u?s=u.drawEntries:e.entries&&(s=e?.entries)}let o=s.filter(l=>(!i?.length||!l.entryStatus||i.includes(l.entryStatus))&&(!a||!l.entryStage||l.entryStage===a)&&(!t||l.entryStatus&&so.includes(l.entryStatus)));return{entries:s,stageEntries:o}}function N7({removeGroupParticipant:t,tournamentRecord:e,drawDefinition:i,participantId:r,drawId:n,stage:a,event:s}){let o="destroyGroupEntry";if(!e)return{error:Ie};if(!r)return z({result:{error:lr},stack:o});if(!s)return{error:li};if(!s.eventType||![lc,ya].includes(s.eventType))return z({result:{error:Zl},stack:o});let l=e.participants??[],u=l.find(I=>I.participantId===r);if(!u)return z({result:{error:Vi},stack:o});if(!u.participantType||![pt,_n].includes(u.participantType)||u.participantType===_n&&s.eventType!==ya||u.participantType===pt&&s.eventType!==lc)return{error:Do};let c=(s.entries??[]).find(I=>I.participantId===r);if(!c)return{error:i4};let{stageEntries:d}=M7({selected:!1,drawDefinition:i,drawId:n,event:s,stage:a}),p=d.map(vt),f=l.filter(({participantId:I})=>p.includes(I)).map(({individualParticipantIds:I})=>I).flat().filter(Boolean),m=u.individualParticipantIds?.filter(I=>qo(I,f).length===1),h=fS({participantIds:[r],event:s});if(h.error||m?.length&&(h=Ko({participantIds:m,entryStatus:ys,entryStage:c.entryStage,tournamentRecord:e,drawDefinition:i,drawId:n,event:s}),h.error))return h;let g;return t&&yh({participantIds:[r],tournamentRecord:e}).success&&(g=!0),{...H,participantRemoved:g}}function PL({removeGroupParticipant:t,tournamentRecord:e,drawDefinition:i,participantId:r,drawId:n,event:a}){return N7({removeGroupParticipant:t,tournamentRecord:e,drawDefinition:i,participantId:r,drawId:n,event:a})}function A7(t){if(!t.tournamentRecord)return{error:Ie};let{participantIds:e,...i}=t,r=0,n=[];for(let a of e){let s=N7({participantId:a,...i});s.success&&(r+=1),s.error&&n.push(s.error)}return r?{destroyedCount:r,...H}:{error:n}}function Pb(t){let{tournamentRecord:e,replaceWithBye:i,drawDefinition:r,destroyPair:n,entryStatus:a,matchUpsMap:s,drawId:o}=t,l="removeDrawPositionAssignment",u=uS(t);if(u.error)return z({result:u,stack:l});let{participantId:c}=u,{drawPosition:d,event:p,structureId:f}=t,m=Tt({tournamentRecord:e,drawDefinition:r,event:p}).appliedPolicies??{};if([Fs,hc].includes(a)&&c){let{tournamentRecord:g}=t,{participant:I}=$d({tournamentRecord:g,participantId:c}),{participantType:v,individualParticipantIds:w}=I??{};if(n&&v===pt){let y=PL({tournamentRecord:g,drawDefinition:r,participantId:c,event:p});if(y.error)return z({result:y,stack:l});w&&nP({participantIds:w,tournamentRecord:g,drawDefinition:r,entryStatus:a,drawId:o,event:p})}else nP({participantIds:[c],tournamentRecord:g,drawDefinition:r,entryStatus:a,drawId:o,event:p})}if(i){let g=Wa({tournamentRecord:e,drawDefinition:r,drawPosition:d,structureId:f,matchUpsMap:s,event:p});if(g.error)return z({result:g,stack:l})}let{structure:h}=et({drawDefinition:r,structureId:f});return ZF({structure:h,drawPositions:[d]}),qw({appliedPolicies:m,drawDefinition:r,positionAction:{name:"removeDrawPositionAssignment",replaceWithBye:i,drawPosition:d,entryStatus:a,structureId:f}}),u}function k7(t){return Object.assign(t,{entryStatus:hc}),Pb(t)}var ld=({finishingPosition:t=lh,hasExistingDrawDefinition:e,qualifyingRoundNumber:i,structureAbbreviation:r,seedAssignments:n=[],stageSequence:a=1,qualifyingOnly:s,structureOrder:o,seedingProfile:l,matchUpFormat:u,structureType:c,structureName:d,matchUps:p=[],matchUpType:f,structureId:m,roundOffset:h,roundLimit:g,stageOrder:I,structures:v,tieFormat:w,stage:y})=>{let b={structureId:m??Et(),structureAbbreviation:r,finishingPosition:t,seedAssignments:n,matchUpFormat:u,stageSequence:a,structureName:d};(s||e&&w)&&(b.tieFormat=w),o&&(b.structureOrder=o),c&&(b.structureType=c),l&&(typeof l=="string"?b.seedingProfile=l:typeof l=="object"&&typeof l.positioning=="string"&&(b.seedingProfile=l.positioning)),f&&(b.matchUpType=f),h&&(b.roundOffset=h),I&&(b.stageOrder=I),g&&(b.roundLimit=g),y&&(b.stage=y),i&&(b.qualifyingRoundNumber=i);let S=p.flatMap(({drawPositions:U})=>U).filter(Boolean);return v?b.structures=v:(b.matchUps=p,b.positionAssignments=rt(S).sort((U,T)=>U-T).map(U=>({drawPosition:U}))),b},ns=ld;function yO(t){return ri(t)?t.split(" ").map(e=>e.split("").map((i,r)=>r?i.toLowerCase():i.toUpperCase()).join("")).join(" "):t}function Xr(t){return ri(t)?yO(t.replace(/_/g," ")):""}function EL({structureName:t=Xr(Er),structureAbbreviation:e,drawDefinition:i,matchUpType:r,structureId:n}){if(!i)return{error:_e};let a=ns({stage:Er,structureAbbreviation:e,structureName:t,matchUps:[],structureId:n,matchUpType:r});return i.structures||(i.structures=[]),i.structures.push(a),ti({drawDefinition:i,structureIds:[a.structureId]}),{...H}}function Gwe({size:t}){let e=[t],i=t;for(;i/2===Math.floor(i/2);)i=i/2,e.push(i);return e.includes(1)||e.push(1),e.sort(ir),e.reverse(),e}function Hwe({blockPattern:t,index:e}){let i=0;for(let r of t){if(i===e)return r;let n=0;for(;n<r.length;){if(i===e)return r;i+=1,n++}}}function Wwe({positioning:t,size:e}){let i=Gwe({size:e}),r=[],n=[],a=p=>p[0],s=p=>p[p.length-1],o=(p,f)=>(t&&[oR,lR,Dp].includes(t)&&f%2?s(p):a(p))||a(p),l=(p,f)=>{if(p.every(m=>!n.includes(m))){let m=o(p,f);return n.push(m),m}},u=p=>{let f=p.filter(m=>!n.includes(m));if(f.length)return n.push(...f),f},c=(p,f)=>{let m=o(p,f);if(!n.includes(m))return n.push(m),m},d=Re(1,e+1);for(let p of i)if(p===1){let f=yr(d,2),m=f.map(l).filter(Boolean);m.length&&r.push(m);let h=f.flatMap(u).filter(Boolean);h.length&&r.push(h)}else{let f=yr(d,p).map(c).filter(Boolean);f.length&&r.push(f)}return{divisions:i,divisionGroupings:r}}function RL({drawPositions:t}){if(!t?.length)return{error:Ew};let e=n=>t.filter(a=>a!==n).map(a=>[n,a]),i=[].concat(...(t??[]).map(e)),r=rt(i.map(VR)).map(n=>n.split("|").map(a=>+a));return{groupMatchUps:i,uniqueMatchUpGroupings:r}}function VR(t=[]){return!Array.isArray(t)||!t.length?"":[...t].sort(ir).join("|")}function O7({groupSize:t,drawPositionOffset:e}){if(!t)return[];let i=d=>[...Array(d)].map((p,f)=>f),r=i(2*Math.round(t/2)+1).slice(1),n=i(r.length-1).map(()=>[]),a=r.slice(0,r.length/2),s=r.slice(r.length/2);r.slice(1).forEach((d,p)=>{a.forEach((g,I)=>{n[p].push([a[I],s[I]])});let f=a.shift(),m=a.pop(),h=s.shift();a=[f,h,...a].filter(Boolean),s=[...s,m].filter(Boolean)});let o=a.shift(),l=a.pop(),u=s.shift();a=[o,u,...a].filter(Boolean),s=[...s,l].filter(Boolean);let c=d=>d[0].reduce((p,f)=>p+f);return[...n].reverse().sort((d,p)=>c(d)-c(p)).map(d=>d.filter(p=>p.every(f=>f<=t)).map(p=>{let f=p.map(m=>m+e);return VR(f)}))}function zwe({rounds:t,hash:e}){return t?.length?t?.reduce((i,r,n)=>r.includes(e)?n+1:i,void 0):{error:Xe}}var qwe={getRoundRobinGroupMatchUps:RL,determineRoundNumber:zwe,drawPositionsHash:VR,groupRounds:O7};function mS(t){let{hasExistingDrawDefinition:e,groupNameBase:i="Group",playoffAttributes:r,stageSequence:n=1,structureOptions:a,appliedPolicies:s,qualifyingOnly:o,seedingProfile:l,stage:u=xe,matchUpType:c,roundTarget:d,structureId:p,groupNames:f,tieFormat:m,drawSize:h,idPrefix:g,isMock:I,uuids:v}=t,w=t.structureName??r?.["0"]?.name??Xr(xe),{groupCount:y,groupSize:b}=Ywe({structureOptions:a,appliedPolicies:s,drawSize:h}),S=Ep,U,T=Re(1,y+1).map(D=>{let E=Kwe({groupSize:b,structureOrder:D,matchUpType:c,drawSize:h,idPrefix:g,isMock:I});U=Array.isArray(E)?Math.max(...E.map(({roundNumber:C})=>C??0)):0;let R=f?.[D-1]??`${i} ${D}`;return ld({structureId:v?.pop(),hasExistingDrawDefinition:e,structureType:uR,finishingPosition:S,qualifyingOnly:o,structureOrder:D,structureName:R,tieFormat:m,matchUps:E})}),P=ld({structureId:p??v?.pop(),hasExistingDrawDefinition:e,structureType:fn,finishingPosition:S,seedingProfile:l,structureName:w,stageSequence:n,structures:T,tieFormat:m,stage:u});return d&&xt({extension:{name:Tl,value:d},element:P}),{structures:[P],maxRoundNumber:U,groupCount:y,links:[],groupSize:b,...H}}function Ywe({appliedPolicies:t,structureOptions:e,drawSize:i}){let r=e?.groupSize,n=e?.groupSizeLimit||8,{validGroupSizes:a}=hS({groupSizeLimit:n,drawSize:i}),s=a&&Math.max(...a);r&&a?.includes(r)||(r&&r>4||!a?.includes(4)?r=s:r=4);let o=Math.ceil(i/r);return{groupSize:r,groupCount:o}}function hS(t){let{groupSizeLimit:e=10,drawSize:i=0}=t??{},r=Re(3,e+1).filter(n=>{let a=Math.ceil(i/n),s=a*n-i,o=Math.ceil(i/a),l=Math.ceil(s/a);return(!s||s<n)&&o===n&&o>=3&&l<2});return{...H,validGroupSizes:r}}function Kwe({structureOrder:t,matchUpType:e,groupSize:i,drawSize:r,idPrefix:n,isMock:a,uuids:s}){let o=(t-1)*i,l=Re(1+o,i+1+o),u=RL({drawPositions:l}).uniqueMatchUpGroupings??[],c=O7({groupSize:i,drawPositionOffset:o});return u.map(p).sort((f,m)=>(f.roundNumber??1/0)-(m.roundNumber??1/0));function d(f){return c.reduce((m,h,g)=>h.includes(f)?g+1:m,void 0)}function p(f){let m=VR(f),h=d(m),g=[1,r],I=Xwe({structureOrder:t,drawPositions:f,roundNumber:h,idPrefix:n,uuids:s}),v={matchUpStatus:h?Fi:"BYE",matchUpType:e,finishingPositionRange:{winner:g,loser:g},drawPositions:f,roundNumber:h,matchUpId:I};return a&&(v.isMock=!0),v}}function Xwe({structureOrder:t,drawPositions:e,roundNumber:i,idPrefix:r,uuids:n}){return r?`${r}-${t}-${i}-DP-${e.join("-")}`:n?.pop()||Et()}function CL(t){let{roundRobinGroupsCount:e,participantsCount:i,cluster:r}=t;if(!ot(i))return{seedBlocks:void 0,...z({result:{error:ie},context:{participantsCount:i},stack:"getSeedBlocks"})};let n=XI(i);if(e){let f=Math.min(e,n),m=[],h=1;for(Re(0,f).forEach(()=>{m.push([h]),h++});h<n;){let g=Re(h,h+f);h+=f,m.push(g)}return{...H,seedBlocks:m}}let a=Re(1,n+1),s=[],o=n/2;for(;o>1;){let f=yr(a,o),m=f.length;f.forEach((h,g)=>{let I,v=g<m/2,w=g%2===0,y=h[0],b=h[h.length-1];r&&m>4?m===8?I=v?b:y:I=w?y:b:I=v?y:b,kn(h,s)||s.push(I)}),o=o/2}let l=a.filter(f=>!s.includes(f));for(;l.length;)l.length%2===0?s.push(l.pop()):s.push(l.shift());let u=Re(0,20).map(f=>Math.pow(2,f));u.unshift(1);let c=u.indexOf(n),d=0,p=[];return Re(0,c).forEach(f=>{p.push(s.slice(d,d+u[f])),d+=u[f]}),{...H,seedBlocks:p}}function ML({roundRobinGroupsCount:t,drawSize:e}){let i="getSeedGroups";if(!ot(e))return{seedGroups:void 0,...z({result:{error:ie},context:{drawSize:e},stack:i})};if(t){if(!ot(t))return{seedGroups:void 0,...z({context:{roundRobinGroupsCount:t},result:{error:ie},stack:i})};let r=1,n=Math.floor(e/t);return{seedGroups:Re(0,n).map(()=>{let a=Re(r,r+t);return r+=t,a})}}else{let{seedBlocks:r}=CL({participantsCount:e,roundRobinGroupsCount:t}),n=0;return{seedGroups:(r||[]).map(a=>(a||[]).map(()=>(n+=1,n)))}}}function NL({roundRobinGroupsCount:t,participantsCount:e}){if(t){let{validGroupSizes:n}=hS({drawSize:e});if(!n?.map(a=>Math.ceil(e/a))?.includes(t))return z({context:{roundRobinGroupsCount:t},result:{error:ie}})}let{seedGroups:i}=ML({drawSize:e,roundRobinGroupsCount:t}),r=i?.map(n=>Math.min(...n))||[];return{...H,seedingThresholds:r}}function lI(t){if(!t)return 1/0;if(ot(t))return Ye(t);let e=t.split("-")[0];return ot(e)?Ye(e):1/0}function bh({provisionalPositioning:t,returnAllProxies:e,appliedPolicies:i,seedingProfile:r,drawDefinition:n,allPositions:a,structure:s}){let o=[];if(!s)return{error:Zp};let{matchUps:l,roundMatchUps:u}=Nt({matchUpFilters:{roundNumbers:[1]},provisionalPositioning:t,structure:s}),{seedAssignments:c}=ds({provisionalPositioning:t,returnAllProxies:e,drawDefinition:n,structure:s}),{positionAssignments:d}=ur({structure:s}),p=d?.length,f=c?.length??0,m=[],h=Object.keys(u).map(A=>Number.parseInt(A)).sort((A,O)=>A-O).map(A=>{let O=u[A].map(F=>F.drawPositions).flat(1/0).filter(Boolean),k=O.filter(F=>!m.includes(F));return m=m.concat(...O),k}).filter(A=>A.length).reverse(),g=h.pop()??[],I=g&&Math.min(...g)-1||0;r=r??i?.seeding?.seedingProfile;let v=g?.length||0,w=h.filter(A=>A.filter(O=>O<=f).length),{stage:y,structureType:b,roundLimit:S}=s,U=b===fn,T=!U&&h?.length,P=!U&&y===We&&S,D=w.flat(1/0),E=T?D?.length:0,R=a?p:f,C=sL({drawDefinition:n,structure:s,matchUps:l}),M=C?0:!T&&R||R&&D.length<R&&R-D.length||0;if(P){let A=s?.matchUps?s.matchUps.filter(({roundNumber:k})=>k===s.roundLimit).length:0,O=g.length/A;if(!T){let k=gS(r),F=yr(g,O),x=1,L=Re(0,F[0].length).map(()=>{let $=Re(x,x+F.length);return x+=F.length,$});({validSeedBlocks:o}=x7({drawPositionBlocks:F,nonRandom:r?.nonRandom,positioning:k,seedGroups:L}))}}else U?{validSeedBlocks:o}=Jwe({nonRandom:r?.nonRandom,seedingProfile:r,structure:s}):T?o=w.map(A=>({seedNumbers:A,drawPositions:A})):C&&yr(g,2).map((A,O)=>({drawPositions:[A[0]],seedNumbers:[O+1]})).forEach(A=>o.push(A));if(!U&&!C&&!P){let{blocks:A}=Qwe({drawPositionOffset:I,seedNumberOffset:E,seedCountGoal:M,seedingProfile:r,baseDrawSize:v});A.forEach(O=>o.push(O))}let N=o.flatMap(A=>A.drawPositions).reduce((A,O)=>g?.includes(O)&&A,!0);return!C&&!T&&!U&&!N?{error:T6,validSeedBlocks:[],isContainer:U,isFeedIn:T}:{isLuckyStructure:C,validSeedBlocks:o,isContainer:U,isFeedIn:T}}function Jwe({seedingProfile:t,structure:e,nonRandom:i}){let r=e.structures||[],n=r.length,a=Yt({structure:e})?.positionAssignments,s=gS(t),o=a?.length??0,{seedGroups:l}=ML({roundRobinGroupsCount:n,drawSize:o}),u=r.map(c=>Yt({structure:c}).positionAssignments?.map(d=>d.drawPosition));return x7({drawPositionBlocks:u,positioning:s,seedGroups:l,nonRandom:i})}function x7({drawPositionBlocks:t,positioning:e,seedGroups:i,nonRandom:r}){let n=[],{divisionGroupings:a}=Wwe({size:i.length,positioning:e}),s=[];return i.forEach((o,l)=>{let u=Hwe({blockPattern:a,index:l});o.forEach((c,d)=>{let p=l%2?t.length-d-1:d,f=t[p].slice().filter((h,g)=>u.includes(g+1)&&h);e!==Dp?f=r?f:Dn(f):l%2&&f.reverse();let m=f.find(h=>!s.includes(h));m&&(s.push(m),n.push({drawPositions:[m],seedNumbers:[c]}))})}),{validSeedBlocks:n}}function Qwe(t){let{drawPositionOffset:e=0,roundRobinGroupsCount:i,seedNumberOffset:r=0,seedingProfile:n,seedCountGoal:a,baseDrawSize:s}=t,o,l=[],{seedBlocks:u}=CL({cluster:[oR,lR].includes(gS(n)),participantsCount:s,roundRobinGroupsCount:i});o=0;for(let c of u){if(o+1>a)break;let d=c.map(f=>f+e),p=Zwe(o+1,c.length).map(f=>+f+r);o+=c.length,l.push({drawPositions:d,seedNumbers:p})}return{blocks:l}}function Zwe(t,e){return Array.from(new Array(e),(i,r)=>r+t)}function sP({appliedPolicies:t,drawDefinition:e,seedBlockInfo:i,drawPosition:r,structureId:n,seedNumber:a}){let{structure:s}=et({drawDefinition:e,structureId:n});t??=Tt({drawDefinition:e}).appliedPolicies;let o=i?.validSeedBlocks;return!o&&s&&(o=bh({appliedPolicies:t,drawDefinition:e,structure:s})?.validSeedBlocks),t?.seeding?.validSeedPositions?.ignore?!0:t?.seeding?.validSeedPositions?.strict?(o.find(l=>l.seedNumbers.includes(a))?.drawPositions||[]).includes(r):o.flatMap(l=>l.drawPositions).includes(r)}function F7(t){let{provisionalPositioning:e,drawDefinition:i,seedingProfile:r,seedBlockInfo:n,structureId:a,randomize:s}=t,{structure:o}=et({drawDefinition:i,structureId:a}),{seedAssignments:l}=ds({returnAllProxies:t.returnAllProxies,provisionalPositioning:e,drawDefinition:i,structure:o}),{positionAssignments:u}=ur({structure:o}),c=u?.filter(R=>R.participantId??R.bye??R.qualifier)?.map(R=>R.drawPosition).filter(Boolean),{appliedPolicies:d}=Tt({drawDefinition:i}),p=(n?.validSeedBlocks||o&&bh({returnAllProxies:t.returnAllProxies,provisionalPositioning:e,appliedPolicies:d,drawDefinition:i,seedingProfile:r,structure:o})?.validSeedBlocks||[]).find(R=>R.drawPositions.filter(C=>!c?.includes(C)).length),f=l?.map(R=>R.participantId).filter(Boolean),m=u?.map(R=>R.participantId).filter(Boolean),h=f?.filter(R=>m?.includes(R)),g=f?.filter(R=>!m?.includes(R)),I=l?.filter(R=>g?.includes(R.participantId)),v=l?.filter(R=>!R.participantId),w=(I?.length&&I.length>0?I.length:v?.length??0)&&p?.drawPositions.filter(R=>!c?.includes(R))||[],y=s?Dn(w):w,b=[],S=y.map(()=>{let R=E(I,b)?.participantId;return R&&b.push(R),R}).filter(Boolean),U=l?.filter(R=>h?.includes(R.participantId)).map(R=>R.seedNumber),T=(p?.seedNumbers||[]).filter(R=>!U?.includes(R)),P=l?.filter(R=>T.includes(R.seedNumber)).map(R=>R.participantId),D=d?.seeding?.duplicateSeedNumbers;return{nextSeedBlock:p,unplacedSeedParticipantIds:typeof D!="boolean"||D?S:P,unplacedSeedNumbers:T,unfilledPositions:y,unplacedSeedAssignments:I};function E(R,C){let M=R.filter(O=>!C.includes(O.participantId)),N=Math.min(...M.map(O=>lI(O.seedValue))),A=M.filter(O=>lI(O.seedValue)===N);return Dn(A).pop()}}function gS(t){if(typeof t=="string")return t;if(typeof t=="object")return t.positioning}function mv({provisionalPositioning:t,tournamentRecord:e,drawDefinition:i,seedingProfile:r,participantId:n,seedBlockInfo:a,structureId:s,seedNumber:o,seedValue:l,eventId:u,event:c}){let d="assignSeed",{structure:p}=et({drawDefinition:i,structureId:s}),{positionAssignments:f}=ur({structure:p}),m=ds({provisionalPositioning:t,drawDefinition:i,structure:p}).seedAssignments,h=m.map(b=>b.seedNumber),g=rm({drawDefinition:i,participantId:n});if(n&&!g)return z({result:{error:To},context:{participantId:n},stack:d});let I=c?$i({event:c}).flightProfile?.flights?.length:0,v=I&&I>1,w=f?.find(b=>b.participantId===n)?.drawPosition;if(w&&!sP({drawPosition:w,drawDefinition:i,seedBlockInfo:a,structureId:s,seedNumber:o}))return z({result:{error:x1},context:{assignedDrawPosition:w},info:"invalid seed position",stack:d});h.includes(o)||m.push({seedNumber:o,seedValue:l});let y;return m.forEach(b=>{b.participantId===n&&b.seedNumber!==o&&(b.participantId=void 0),b.seedNumber===o&&(b.participantId=n,!r?.groupSeedingThreshold&&!v&&(b.seedValue=l??o),y=!0)}),y?(vK({tournamentId:e?.tournamentId,drawDefinition:i,structure:p,eventId:u}),{...H}):z({result:{error:U6},stack:d})}function AL({inContextTargetMatchUp:t,drawPositionSideIndex:e,teamParticipantId:i,tournamentRecord:r,drawDefinition:n,matchUp:a,event:s}){let o=t?.sides?.[e]?.sideNumber,l=o&&a.sides?.find(p=>p.sideNumber===o),{extension:u}=mt({element:n,name:cc}),c=u?.value||{},d=ke(c[i],!1,!0);if(l)a?.sides?.forEach(p=>{p.sideNumber===o&&(p.lineUp=d)});else{a.sides=[1,2].map(f=>({...a.sides?.find(m=>m.sideNumber===f)??{},sideNumber:f}));let p=a.sides.find(f=>f.sideNumber===o);p&&(p.lineUp=d)}St({tournamentId:r?.tournamentId,context:"updateSidLineUp",eventId:s?.eventId,drawDefinition:n,matchUp:a})}function L7(t){let{sourceMatchUp:e}=t,{targetMatchUp:i,structure:r,matchUpsMap:n,drawPosition:a}=t,s=i.roundNumber>1&&i.roundNumber-1,o=gd({structureId:r.structureId,matchUpsMap:n});Gt({method:"getPairedPreviousMatchUpIsDoubleExit",color:"brightcyan",keyColors:{structureId:"brightyellow",sourceMatchUpId:"brightmagenta"},structureId:r.structureId?.slice(0,8),targetMatchUpId:i.matchUpId,targetRound:[i.roundNumber,i.roundPosition],previousRoundNumber:s,sourceMatchUpId:e?.matchUpId,sourceStructureId:e?.structureId?.slice(0,8),sourceRound:e?[e.roundNumber,e.roundPosition]:void 0,drawPosition:a,structureMatchUpCount:o?.length}),e&&e.structureId!==r.structureId&&a?(Gt({method:"getPairedPreviousMatchUpIsDoubleExit",color:"cyan",info:"cross_structure_sourceMatchUp_resolving_in_target",originalSourceId:e?.matchUpId,originalSourceStructure:e?.structureId?.slice(0,8),targetStructure:r.structureId?.slice(0,8)}),e=o.find(({drawPositions:m,roundNumber:h})=>h===s&&m?.includes(a)),Gt({method:"getPairedPreviousMatchUpIsDoubleExit",color:"cyan",info:"resolved_cross_structure_sourceMatchUp",resolvedMatchUpId:e?.matchUpId,resolvedRound:e?[e.roundNumber,e.roundPosition]:void 0,resolvedStatus:e?.matchUpStatus})):!e&&a&&(e=o.find(({drawPositions:m,roundNumber:h})=>h===s&&m?.includes(a)),Gt({method:"getPairedPreviousMatchUpIsDoubleExit",color:"cyan",info:"resolved_sourceMatchUp_from_drawPosition",resolvedMatchUpId:e?.matchUpId,resolvedRound:e?[e.roundNumber,e.roundPosition]:void 0,resolvedStatus:e?.matchUpStatus}));let l=e?.roundPosition,u=l%2?1:-1,c=l+u,d=s&&o.find(({roundNumber:m,roundPosition:h})=>m===s&&h===c),p=d?.matchUpStatus,f=[wi,Hi].includes(p);return Gt({method:"getPairedPreviousMatchUpIsDoubleExit",color:f?"brightred":"brightgreen",keyColors:{pairedMatchUpId:"brightcyan",isDoubleExit:f?"brightred":"brightgreen"},sourceRoundPosition:l,offset:u,pairedRoundPosition:c,pairedMatchUpId:d?.matchUpId,pairedRound:d?[d.roundNumber,d.roundPosition]:void 0,pairedStatus:p,isDoubleExit:f}),{pairedPreviousMatchUp:d,pairedPreviousMatchUpIsDoubleExit:f}}function eSe({drawPosition:t,drawPositions:e}){let i=!1,r=!!e?.includes(t);return{updatedDrawPositions:r?e||[]:[...e,void 0,void 0].slice(0,2).map(n=>!n&&!r?(r=!0,i=!0,t):n).sort(ir).filter(Boolean),positionAdded:i,positionAssigned:r}}function _7({structureId:t,matchUpsMap:e,matchUp:i}){let r=i?.roundPosition,n=r%2?1:-1,a=r+n;return{pairedPreviousMatchUp:gd({matchUpsMap:e,structureId:t}).find(({roundNumber:s,roundPosition:o})=>s===i?.roundNumber&&o===a)}}function $7({inContextDrawMatchUps:t,sourceMatchUpStatus:e,sourceMatchUpId:i,matchUpsMap:r,matchUp:n}){let a=t.find(o=>o.matchUpId===i),{pairedPreviousMatchUp:s}=_7({structureId:a?.structureId,matchUp:a,matchUpsMap:r});if(a&&s){let o=s?.matchUpId,l=t.find(c=>c.matchUpId===o),u=a?.structureId===l?.structureId?a?.roundPosition<l?.roundPosition&&1||2:a.structureId===l?.structureId&&2||1;n.matchUpStatusCodes=(n.matchUpStatusCodes??[]).map(c=>{let d=ri(c)||!isNaN(c)?{code:c}:c;return d.sideNumber===u?{...d,previousMatchUpStatus:e}:d})}}function ZT({inContextDrawMatchUps:t,drawPosition:e,matchUpId:i}){let r=t.filter(({winnerMatchUpId:n,loserMatchUpId:a})=>a===i||n===i).sort((n,a)=>n.roundPosition-a.roundPosition);return t.find(n=>n.matchUpId===i).feedRound?1:r.reduce((n,a,s)=>a.drawPositions?.includes(e)?s+1:n,void 0)}function nm({inContextDrawMatchUps:t,sourceMatchUpStatus:e,tournamentRecord:i,sourceMatchUpId:r,drawDefinition:n,matchUpStatus:a,drawPosition:s,matchUpsMap:o,matchUpId:l,event:u}){let c="assignMatchUpDrawPosition";o||(o=kr({drawDefinition:n})),t||(t=Qi({inContext:!0,drawDefinition:n,matchUpsMap:o}).matchUps??[]);let d=t.find(C=>C.matchUpId===l),p=d?.structureId,f=n?.structures?.find(C=>C.structureId===p);if(!f)return{error:Ii};let m=o?.drawMatchUps?.find(C=>C.matchUpId===l),h=m?.drawPositions??[],{positionAdded:g,positionAssigned:I,updatedDrawPositions:v}=eSe({drawPositions:h,drawPosition:s}),{positionAssignments:w}=Yt({drawDefinition:n,structure:f}),y=w?.filter(C=>v.includes(C.drawPosition))?.find(({bye:C})=>C),b=m?.matchUpStatus&&Fr(m.matchUpStatus)&&v.filter(Boolean).length<2;a=y&&"BYE"||a||b&&m.matchUpStatus||m?.matchUpStatus&&[wi,Hi].includes(m.matchUpStatus)&&m.matchUpStatus||Fi;let S=!!(Fr(m?.matchUpStatus)&&m?.winningSide);if(m&&g){t=Qi({inContext:!0,drawDefinition:n,matchUpsMap:o}).matchUps??[];let C=b&&ZT({inContextDrawMatchUps:t,drawPosition:s,matchUpId:l})||S&&m.winningSide||void 0;m?.matchUpStatusCodes&&$7({inContextDrawMatchUps:t,sourceMatchUpStatus:e,sourceMatchUpId:r,matchUpsMap:o,matchUp:m}),Object.assign(m,{drawPositions:v,winningSide:C,matchUpStatus:S?m?.matchUpStatus:a}),St({tournamentId:i?.tournamentId,eventId:d?.eventId,context:c,drawDefinition:n,matchUp:m})}let U=On({inContextDrawMatchUps:t,inContextMatchUp:d,drawDefinition:n,matchUpId:l}),{targetMatchUps:{winnerMatchUp:T,loserMatchUp:P,loserTargetDrawPosition:D},targetLinks:{loserTargetLink:E}}=U,R=gd({structureId:f.structureId,matchUpsMap:o});if(I&&y){if(T)if(["BYE",wi,Hi].includes(a)){let C=nm({matchUpId:T.matchUpId,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:n,drawPosition:s,matchUpsMap:o});if(C.error)return C}else{let{structureId:C}=T;C!==f.structureId&&console.log("winnerMatchUp in different structure... participant is in different targetDrawPosition")}}else if(I&&S){if(T){let C=nm({matchUpId:T.matchUpId,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:n,drawPosition:s,matchUpsMap:o});if(C.error)return C}}else if(T&&d&&!d.feedRound){let{pairedPreviousMatchUpIsDoubleExit:C}=L7({targetMatchUp:m,drawPosition:s,matchUpsMap:o,structure:f});if(C){let M=nm({matchUpId:T.matchUpId,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:n,drawPosition:s,matchUpsMap:o});if(M.error)return M}}if(m?.matchUpType===Zt){let C=t?.find(({matchUpId:A})=>A===m.matchUpId),M=(C?.sides??[]).reduce((A,O,k)=>O.drawPosition===s?k:A,void 0),N=w?.find(A=>A.drawPosition===s)?.participantId;N&&M!==void 0&&AL({inContextTargetMatchUp:C,drawPositionSideIndex:M,teamParticipantId:N,tournamentRecord:i,drawDefinition:n,matchUp:m})}if(E?.linkCondition===al&&v.filter(Boolean).length===2&&!y&&R.filter(({drawPositions:C,roundNumber:M})=>M===1&&kn(C,v)).every(({matchUpStatus:C})=>[ki,$r].includes(C))&&P){let{structureId:C}=P,M=Wa({drawPosition:D,tournamentRecord:i,drawDefinition:n,structureId:C,matchUpsMap:o,event:u});if(M.error)return M}return I?{...H}:z({result:{error:Kg},context:{drawPosition:s},stack:c})}function B7({inContextDrawMatchUps:t,drawDefinition:e,assignments:i,matchUpsMap:r,structure:n}){let a=lv({drawDefinition:e})?.containedStructures?.[n.structureId]?.map(({structureId:c})=>c)||[];a.push(n?.structureId);let s=i?.map(({drawPosition:c})=>c)||[],o=t?.filter(c=>a.includes(c.structureId)&&xi(c.drawPositions??[],s).length)??[],l=o.map(({matchUpId:c})=>c),u=r?.drawMatchUps?.filter(c=>l.includes(c.matchUpId))??[];return{drawPositions:s,matchUps:u,targetMatchUps:o}}function kL({lineUp:t}){if(!Array.isArray(t))return;let e={};return rt(t.flatMap(({collectionAssignments:i})=>i?.map(({collectionId:r,collectionPosition:n})=>[r,n].join("|"))).filter(Boolean)).forEach(i=>{let[r,n]=i.split("|"),a=parseInt(n),{assignedParticipantIds:s}=rP({collectionPosition:a,collectionId:r,lineUp:t});s.forEach(o=>{e[o]||(e[o]=[]),e[o].push({collectionId:r,collectionPosition:a})})}),Object.keys(e).map(i=>({participantId:i,collectionAssignments:e[i]}))}function Ap(t){return`${t} must be an array`}function jR({lineUp:t,tieFormat:e}){let i=[];if(!Array.isArray(t))return i.push(Ap("lineUp")),{valid:!1,errors:i,error:ie};let r=t.every(a=>{if(typeof a!="object")return i.push("lineUp entries must be objects"),!1;let{participantId:s,collectionAssignments:o}=a;return s?typeof s!="string"?(i.push("participantIds must be strings"),!1):Array.isArray(o)?o.every(l=>{if(typeof l!="object")return i.push("collectionAssignments must be objects"),!1;let{collectionPosition:u}=l;return typeof u!="number"?(i.push("collectionPosition must be a number"),!1):!0}):(i.push(Ap("collectionAssignments")),!1):(i.push("Missing participantId"),!1)}),n=rt(t.map(vt)).length===t.length;return n||i.push("Duplicated participantId(s)"),{valid:r&&n,errors:i,error:i.length?ie:void 0}}function wh({drawDefinition:t,participantId:e,tieFormat:i,lineUp:r}){if(typeof t!="object")return{error:_e};if(typeof e!="string")return{error:lr};let n=jR({lineUp:r,tieFormat:i});if(!n.valid)return n;let{extension:a}=mt({element:t,name:cc}),s=a?.value||{};return s[e]=kL({lineUp:r}),xt({element:t,extension:{name:cc,value:s}}),zw({drawDefinition:t}),{...H}}function OL({inContextDrawMatchUps:t,inheritance:e=!0,tournamentRecord:i,drawDefinition:r,matchUpsMap:n,assignments:a,structure:s,event:o}){if(!r)return{error:_e};let{drawPositions:l,matchUps:u,targetMatchUps:c}=B7({inContextDrawMatchUps:t,matchUpsMap:n,assignments:a,structure:s});for(let d of c)d.matchUpType===ka&&(d.sides??[]).forEach((p,f)=>{if(p?.drawPosition&&l?.includes(p.drawPosition)){let m=u.find(({matchUpId:h})=>h===d.matchUpId);if(m?.sides?.[f]){if(delete m.sides[f].lineUp,e===!1){let h=d.tieFormat,g=p.participantId;h&&g&&wh({drawDefinition:r,participantId:g,lineUp:[],tieFormat:h})}St({tournamentId:i?.tournamentId,context:"resetLineUps",eventId:o?.eventId,drawDefinition:r,matchUp:m})}}});return{...H}}function ol({provisionalPositioning:t,inContextDrawMatchUps:e,isQualifierPosition:i,sourceMatchUpStatus:r,tournamentRecord:n,drawDefinition:a,seedingProfile:s,participantId:o,seedBlockInfo:l,drawPosition:u,matchUpsMap:c,structureId:d,event:p}){let f="assignDrawPosition";if(!o&&!i)return z({result:{error:lr},stack:f});c=c??kr({drawDefinition:a}),e||({matchUps:e}=Qi({inContext:!0,drawDefinition:a,matchUpsMap:c}));let m=et({drawDefinition:a,structureId:d});if(m.error)return z({result:m,stack:f});let{structure:h}=m;if(!h)return{error:Ii};if(Vn({structure:h}))return z({result:{error:ia},stack:f});let{seedAssignments:g}=ds({provisionalPositioning:t,drawDefinition:a,structure:h}),I=g?.find(P=>P.participantId===o)?.seedNumber,{appliedPolicies:v}=Tt({tournamentRecord:n,drawDefinition:a,structure:h,event:p});if(I&&!sP({seedNumber:I,appliedPolicies:v,drawDefinition:a,seedBlockInfo:l,drawPosition:u,structureId:d}))return z({result:{error:x1},context:{drawPosition:u},stack:f});let w=ur({structure:h}).positionAssignments||[],y=w?.find(P=>P.drawPosition===u);if(!y)return z({result:{error:eh},context:{drawPosition:u},stack:f});if(w?.map(vt).includes(o))return z({result:{error:ev},context:{drawPosition:u},stack:f});let{containsParticipant:b,containsBye:S}=hL(y);if(S){let P=uS({inContextDrawMatchUps:e,tournamentRecord:n,drawDefinition:a,drawPosition:u,structureId:d,matchUpsMap:c,event:p});if(P.error)return z({result:P,stack:f})}if(b&&y.participantId!==o){let{activeDrawPositions:P}=dv({drawDefinition:a,structureId:d});if(P.includes(u))return z({result:{error:Rw},stack:f});OL({assignments:[y],inContextDrawMatchUps:e,tournamentRecord:n,drawDefinition:a,matchUpsMap:c,structure:h})}if(y.participantId=o,i&&(y.qualifier=!0),h.stage===xe&&(!h.stageSequence||h.stageSequence>1)||h.stage&&[Zr,Ui].includes(h.stage)){let P=h.stage===We?We:xe,D=(a.structures?.find(E=>E?.stage===P&&E?.stageSequence===1)?.seedAssignments??[]).find(E=>E.participantId===o);if(D?.participantId){let{participantId:E,seedNumber:R,seedValue:C}=D;mv({eventId:p?.eventId,provisionalPositioning:t,tournamentRecord:n,drawDefinition:a,seedingProfile:s,participantId:E,seedNumber:R,seedValue:C,structureId:d,event:p})}}if(h.structureType===fn){i7({positionAssignments:w,tournamentRecord:n,drawDefinition:a,matchUpsMap:c,structure:h});let{drawPositions:P,matchUps:D,targetMatchUps:E}=B7({assignments:[y],inContextDrawMatchUps:e,drawDefinition:a,matchUpsMap:c,structure:h});if(P&&D?.length===1&&D[0].matchUpType===Zt){let R=(E?.[0].sides??[]).reduce((C,M,N)=>P?.includes(M.drawPosition)?N:C,void 0);AL({inContextTargetMatchUp:E[0],teamParticipantId:o,matchUp:D[0],drawPositionSideIndex:R,tournamentRecord:n,drawDefinition:a})}}else tSe({provisionalPositioning:t,inContextDrawMatchUps:e,sourceMatchUpStatus:r,tournamentRecord:n,drawDefinition:a,drawPosition:u,matchUpsMap:c,structure:h,event:p});let U=a.entries?.find(P=>P.participantId===o),T=p?.entries?.find(P=>P.participantId===o);return!U&&T&&wL({entryStatus:T.entryStatus,entryStage:h.stage,ignoreStageSpace:!0,drawDefinition:a,participantId:o,event:p}),fc({tournamentId:n?.tournamentId,drawDefinition:a,structure:h,event:p}),{positionAssignments:w,...H}}function tSe({provisionalPositioning:t,inContextDrawMatchUps:e,sourceMatchUpStatus:i,tournamentRecord:r,drawDefinition:n,drawPosition:a,matchUpsMap:s,structure:o,event:l}){let u={isCollectionMatchUp:!1},{matchUps:c}=Nt({provisionalPositioning:t,matchUpFilters:u,drawDefinition:n,matchUpsMap:s,structure:o,event:l}),{roundMatchUps:d}=bn({matchUps:c}),{initialRoundNumber:p}=Nm({drawPosition:a,matchUps:c}),f=p&&d?.[p].find(m=>m.drawPositions?.includes(a));if(f){let m=nm({matchUpId:f.matchUpId,inContextDrawMatchUps:e,sourceMatchUpStatus:i,tournamentRecord:r,drawDefinition:n,drawPosition:a,matchUpsMap:s});if(m.error)return z({stack:"assignDrawPositionToMatchUps",context:{drawPosition:a},result:m})}return{...H}}function xL(t){let{participantIdAttributeName:e="participantId",isQualifierPosition:i,positionActionName:r,tournamentRecord:n,drawDefinition:a,participantId:s,drawPosition:o,structureId:l,event:u}=t,c="positionParticipantAction";if(!a)return{error:_e};let d=Tt({tournamentRecord:n,drawDefinition:a,event:u}).appliedPolicies??{},{inContextDrawMatchUps:p,matchUpsMap:f}=t;f||(f=kr({drawDefinition:a}),Object.assign(t,{matchUpsMap:f})),p||({matchUps:p}=Qi({inContext:!0,drawDefinition:a,matchUpsMap:f}),Object.assign(t,{inContextDrawMatchUps:p}));let{positionAssignments:m}=Yt({drawDefinition:a,structureId:l}),h=m?.find(y=>y.drawPosition===o);if(h?.participantId){let y=h.participantId,b=ol({inContextDrawMatchUps:p,tournamentRecord:n,drawDefinition:a,participantId:s,drawPosition:o,structureId:l,matchUpsMap:f,event:u});return b.success?w({appliedPolicies:d,removedParticipantId:y}):z({result:b,stack:c})}let g=uS({inContextDrawMatchUps:p,tournamentRecord:n,drawDefinition:a,drawPosition:o,structureId:l,matchUpsMap:f,event:u});if(g.error)return z({result:g,stack:c});let I=g.participantId,v=ol({inContextDrawMatchUps:p,isQualifierPosition:i,tournamentRecord:n,drawDefinition:a,participantId:s,drawPosition:o,structureId:l,matchUpsMap:f,event:u});if(!v.success)return z({result:v,stack:c});return w({appliedPolicies:d,removedParticipantId:I});function w({appliedPolicies:y,removedParticipantId:b}){let{structure:S}=et({drawDefinition:a,structureId:l});ZF({drawPositions:[o],structure:S});let U={[e]:s,name:r,drawPosition:o,structureId:l};return qw({appliedPolicies:y,drawDefinition:a,positionAction:U}),z({context:{removedParticipantId:b},result:{...H},stack:c})}}function iSe({luckyLoserParticipantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,structureId:n}){return xL({positionActionName:"luckyLoserDrawPositionAssignment",participantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,structureId:n})}function V7(t){return iSe(t)}function j7({params:t,modMap:e,structure:i}){let{tournamentRecord:r,drawDefinition:n,event:a}=t;for(let s of i.matchUps)e[s.matchUpId]&&(s.roundNumber=e[s.matchUpId],St({tournamentId:r?.tournamentId,eventId:a?.eventId,drawDefinition:n,matchUp:s}))}function G7(t,e){let i=[{drawDefinition:!0,structureId:!0}];Array.isArray(e)&&i.push(...e);let r=Ge(t,i);if(r.error)return r;let n=et(t);if(n.error)return n;let a=n.structure;if(!Vn({structure:a}))return z({result:{error:Qp,message:"structure must be adHoc"}});let{roundMatchUps:s=[],roundNumbers:o}=bn({matchUps:a?.matchUps});return o?.length?{valid:!0,structure:a,roundMatchUps:s,roundNumbers:o}:{error:Tu}}function H7(t){let e=G7(t,[{targetRoundNumber:!0,roundNumber:!0,[zn]:nye}]);if(e.error)return e;let{structure:i,roundMatchUps:r,roundNumbers:n}=e,{targetRoundNumber:a,roundNumber:s}=t;if(!n?.includes(s)||!n?.includes(a))return z({result:{error:ie},info:"roundNumbers must be valid rounds"});let o=a>s,l=o?Re(s+1,a+1):Re(a,s),u={};return l.forEach(c=>(r?.[c]??[]).forEach(({matchUpId:d})=>{u[d]=c-(o?1:-1)})),r?.[s]?.forEach(({matchUpId:c})=>u[c]=a),j7({params:t,modMap:u,structure:i}),{...H}}function W7({structurePositionAssignments:t,provisionalPositioning:e,tournamentRecord:i,drawDefinition:r,event:n}){if(!r)return{error:_e};if(!Array.isArray(t))return{error:ie};let a="setPositionAssignments";for(let o of t){let{structureId:l,positionAssignments:u}=o;if(!u)continue;let c=et({drawDefinition:r,structureId:l});if(c.error)return c;let d=c.structure;if(!d)return{error:Ii};let p=Yt({structure:d}).positionAssignments?.map(({drawPosition:g})=>g),f=u?.map(({drawPosition:g})=>g);if(xi(p,f).length!==p?.length)return z({result:{error:ie},info:"drawPositions do not match",stack:a});let m=kr({drawDefinition:r}),{matchUps:h}=Qi({inContext:!0,drawDefinition:r,matchUpsMap:m});for(let g of u||[]){let{drawPosition:I,participantId:v,bye:w,qualifier:y}=g;if(w){let b=Wa({tournamentRecord:i,drawDefinition:r,drawPosition:I,matchUpsMap:m,structureId:l,structure:d,event:n});if(b?.error)return b}else if(y)u.forEach(b=>{b.drawPosition===I&&(b.qualifier=!0,delete b.participantId,delete b.bye)});else if(v){let b=ol({provisionalPositioning:e,inContextDrawMatchUps:h,tournamentRecord:i,drawDefinition:r,participantId:v,drawPosition:I,matchUpsMap:m,structureId:l,event:n});if(b?.error)return b}}fc({tournamentId:i?.tournamentId,drawDefinition:r,structure:d,event:n})}let s=t.map(({structureId:o})=>o);return ti({tournamentId:i?.tournamentId,eventId:n?.eventId,drawDefinition:r,structureIds:s}),{...H}}function z7(t){let e=G7(t,[{roundNumbers:!0,[zn]:an,[Wr]:s=>s.length===2&&s.every(Ni)}]);if(e.error)return e;let{structure:i,roundMatchUps:r,roundNumbers:n}=e;if(!t.roundNumbers.every(s=>n?.includes(s)))return z({result:{error:ie,message:"roundNumbers must be valid rounds"}});let a={};return t.roundNumbers.forEach((s,o)=>(r?.[s]??[]).forEach(({matchUpId:l})=>{a[l]=t.roundNumbers[1-o]})),j7({params:t,modMap:a,structure:i}),{...H}}function q7({alternateParticipantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,structureId:n,event:a}){return xL({positionActionName:"alternateDrawPositionAssignment",participantIdAttributeName:"alternateParticipantid",participantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,structureId:n,event:a})}function Y7({drawDefinition:t,structureId:e}){if(!t)return{error:_e};let{structure:i}=et({drawDefinition:t,structureId:e}),r=(t?.links||[]).filter(n=>n.source?.structureId===e).map(n=>n.target?.structureId);return{playoffStructures:(t?.structures||[]).filter(n=>r.includes(n.structureId)),structure:i}}function GR({withStageGrouping:t,stageSequences:e,stageSequence:i,roundTarget:r,stages:n,event:a,stage:s}){if(!a)return{error:li};let o={},l=[];for(let u of a.drawDefinitions||[]){let{structures:c,stageStructures:d}=Js({withStageGrouping:t,stageSequences:e,drawDefinition:u,stageSequence:i,roundTarget:r,stages:n,stage:s});if(l.push(...c),d)for(let p of Object.keys(d))o[p]||(o[p]=[]),o[p].push(...d[p])}return{structures:l,stageStructures:o}}function FL({withStageGrouping:t,tournamentRecord:e,stageSequences:i,stageSequence:r,roundTarget:n,stages:a,stage:s}){if(!e)return{error:Ie};let o={},l=[];for(let u of e.events||[]){let{structures:c,stageStructures:d}=GR({withStageGrouping:t,stageSequences:i,stageSequence:r,roundTarget:n,stages:a,event:u,stage:s});if(c&&l.push(...c),d)for(let p of Object.keys(d))o[p]||(o[p]=[]),o[p].push(...d[p])}return{structures:l,stageStructures:o}}function uu(t){if(!t?.drawDefinition)return!1;let e=_R(t),i=e?.includesTeamMatchUps,{completedMatchUps:r,pendingMatchUps:n,upcomingMatchUps:a}=e||{};return i&&(r=r?.filter(({matchUpType:s})=>s===Zt),n=n?.filter(({matchUpType:s})=>s===Zt),a=a?.filter(({matchUpType:s})=>s===Zt)),!!(r?.length&&!n?.length&&!a?.length)}function LL(t){let{drawDefinition:e,structureId:i}=t;if(!e)return{error:_e};let{playoffStructures:r}=Y7({drawDefinition:e,structureId:i});if(!r?.length)return!1;let n=e?.entries?.filter(s=>s?.entryStatus&&so.includes(s.entryStatus))?.length??0,a=0;return(r||[]).reduce((s,o)=>!!((Yt({structure:o}).positionAssignments??[])?.filter(l=>(l.participantId&&a++,l?.bye??l?.participantId)).length&&s),!!r.length)||a===n}function bO({significantCharacters:t,accessors:e=[],value:i}){let r=[],n=e[0];if(i?.[n]){let s=e.slice(1);if(Array.isArray(i[n]))i[n].forEach(o=>{let l=bO({accessors:s,significantCharacters:t,value:o});r.push(...l)});else if(i=i[n],s.length){let o=bO({accessors:s,significantCharacters:t,value:i});r.push(...o)}else a({value:i})}function a({value:s}){if(s&&["string","number"].includes(typeof s)){let o=t?s.slice(0,t):s;r.push(o)}}return r}function rSe({targetParticipantIds:t,policyAttributes:e,idCollections:i,participants:r}){if(!Array.isArray(e))return{error:G1};if(!Array.isArray(r))return{error:Aw};let n={};return t.forEach(a=>{let s=r.find(l=>l.participantId===a),{values:o}=K7({policyAttributes:e,idCollections:i,participants:r,participant:s});o&&o.forEach(l=>{n[l]||(n[l]=[]),n[l].includes(a)||n[l].push(a)})}),n}function K7({policyAttributes:t,idCollections:e,participants:i,participant:r}){if(!Array.isArray(t))return{error:G1};if(!r)return{error:rh};let n=[];return t.forEach(a=>{let{directive:s,groupings:o,key:l,significantCharacters:u}=a||{};if(l){let c=l.split(".");n.push(...bO({significantCharacters:u,value:r,accessors:c}))}else if(s){let c=a?.includeIds,d=(e?.[s]||[]).filter(p=>!c||c.includes(p));d?.length&&i?.length&&d.forEach(p=>{let f=i.find(m=>m.participantId===p);if(f?.individualParticipantIds?.includes(r.participantId)){let m=f?.participantId;n.push(m)}})}else o&&Object.keys(o).forEach(c=>{o[c].includes(r.participantId)&&n.push(c)})}),{values:rt(n)}}function YH({candidatePositionAssignments:t,participantsWithGroupings:e,policyAttributes:i,idCollections:r}){let n=Object.assign({},...e.map(a=>({[a.participantId]:a})));return t.map(a=>{let s=n[a.participantId],{values:o}=K7({participants:e,policyAttributes:i,idCollections:r,participant:s});return{...a,values:o}})}function X7({participantIdGroups:t,positionAssignments:e,groupsToAvoid:i}){return Object.assign({},...e.filter(r=>r?.participantId).map(r=>{let{drawPosition:n,participantId:a}=r,s=t?t[a]||[]:[],o=!!i.some(l=>s.includes(l));return{[n]:{participantGroups:s,includesGroupsToAvoid:o}}}))}function nSe(t){let{unfilledPositions:e,chunkedDrawPositions:i}=t,r=X7(t);return i.map(a=>{let s=e.filter(u=>a.includes(u)),o=n(s),l=s.filter(u=>!o.includes(u)).filter(u=>{let c=KH(u);return!r[c]?.includesGroupsToAvoid});return{unassigned:s,unpaired:o,pairedNoConflict:l}});function n(a){return a.filter(o=>!s(o));function s(o){let l=KH(o);return!a.includes(l)}}}function aSe(t){let{unfilledPositions:e,chunkedDrawPositions:i}=t,r=X7(t);return i.map(n=>{let a=e.filter(l=>n.includes(l)),s=a.length===n.length?a:[],o=n.filter(l=>r[l]?.includesGroupsToAvoid).length;return{unassigned:a,unpaired:s,pairedNoConflict:o?[]:a,conflictsCount:o}})}function KH(t){return Number(t%2?t+1:t-1)}function sSe({allGroups:t,participantId:e}){return Object.keys(t).filter(i=>t[i].includes(e))}function oSe({selectedParticipantGroups:t,participantIdGroups:e,positionAssignments:i,drawPositionChunks:r,unfilledPositions:n,isRoundRobin:a}){let s=r.map(o=>a?aSe({groupsToAvoid:t,chunkedDrawPositions:o,participantIdGroups:e,positionAssignments:i,unfilledPositions:n}):nSe({groupsToAvoid:t,chunkedDrawPositions:o,participantIdGroups:e,positionAssignments:i,unfilledPositions:n}));if(a){let o=s.map(c=>c.map(d=>d.unassigned).filter(d=>d?.length)).filter(c=>c?.length).sort((c,d)=>(d.length||0)-(c.length||0)),l=s.map(c=>c.map(d=>d.unpaired).filter(d=>d?.length)).filter(c=>c?.length),u=s.map(c=>c.map(d=>d.pairedNoConflict).filter(d=>d?.length)).filter(c=>c?.length).sort((c,d)=>(d.length||0)-(c.length||0));return{unassigned:o,unpaired:l,pairedNoConflict:u}}else{let o=s.map(c=>c.map(d=>d.unassigned).filter(d=>d?.length)).filter(c=>c?.length),l=s.map(c=>c.map(d=>d.unpaired).filter(d=>d?.length)).filter(c=>c?.length),u=s.map(c=>c.map(d=>d.pairedNoConflict).filter(d=>d?.length)).filter(c=>c?.length);return{unassigned:o,unpaired:l,pairedNoConflict:u}}}function J7({positionAssignments:t,participantIds:e}){let i=t.map(r=>r.participantId);return e.filter(r=>!i.includes(r))}function lSe({useSpecifiedGroupKey:t=!1,targetParticipantIds:e,largestFirst:i=!0,allGroups:r,groupKey:n}){let a=Object.assign({},...Object.keys(r).map(u=>[u,r[u].filter(c=>e.includes(c))]).filter(u=>u[1].length).map(([u,c])=>({[u]:c}))),s=Object.keys(a).reduce((u,c)=>a[c].length>u?a[c].length:u,0),o=Object.keys(a).filter(u=>a[u].length===s),l=da(i?o:Object.keys(a));return n=t&&a[n]?.length?n:l,{participantId:n&&a[n]?da(a[n]):da(e),groupKey:n}}function uSe({drawPositionGroups:t,positionAssignments:e}){let i=Object.assign({},...e.map(r=>({[r.drawPosition]:r})));return t.map(r=>r.filter(Boolean).map(n=>i[n]).filter(Boolean).filter(n=>!n.participantId&&!n.bye).map(n=>n.drawPosition)).flat().filter(Boolean)}function cSe({candidatePositionAssignments:t,unseededParticipantIds:e,participantIdGroups:i,drawPositionChunks:r,drawPositionGroups:n,pairedPriority:a,allGroups:s,groupKey:o}){let l=n.reduce((T,P)=>P.length>T?P.length:T,0)<=2,u=J7({positionAssignments:t,participantIds:e}),c=uSe({positionAssignments:t,drawPositionGroups:n}),{participantId:d,groupKey:p}=lSe({targetParticipantIds:u,useSpecifiedGroupKey:l,allGroups:s,groupKey:o}),f=sSe({participantId:d,allGroups:s}),m=oSe({positionAssignments:t,isRoundRobin:l,selectedParticipantGroups:f,participantIdGroups:i,drawPositionChunks:r,unfilledPositions:c}),{unassigned:h,unpaired:g,pairedNoConflict:I}=m,v=I?.length&&I[0],w=g?.length&&g[0],y=a&&v?v:w,b=a?w:v,S=y?.length&&y||b?.length&&b,U;if(S?.length){let T=ma(S);U=ma(T)}else{let T=ma(h[0]);U=ma(T)}return{newGroupKey:p,selectedParticipantId:d,targetDrawPosition:U}}function wO({isRoundRobin:t,groupedParticipants:e}){let i=[];return t?e.forEach(r=>{let n=r.map(o=>o.drawPosition),a=RL({drawPositions:n}).uniqueMatchUpGroupings??[],s=Object.assign({},...r.map(o=>({[o.drawPosition]:o})));a.forEach(o=>{kn(s[o[0]].values||[],s[o[1]].values||[])&&(i.push(o),r.conflict=!0)})}):e.forEach(r=>{kn(r[0]?.values||[],r[1]?.values||[])&&(i.push(r),r.conflict=!0)}),i}function dSe(t,e){let i=t.find(r=>r.includes(e));if(i)return i.find(r=>r!==e)}function XH(t,e){return t.find(i=>i.drawPosition===e)}function pSe({moveableParticipant:t,possibleDrawPosition:e,positionedParticipants:i,drawPositionGroups:r,isRoundRobin:n,getAvoidanceConflicts:a}){let s=dSe(r,e),o=XH(i,s),l=a({isRoundRobin:n,groupedParticipants:[[t,o]]}),u=[XH(i,e),o],c=a({isRoundRobin:n,groupedParticipants:[u]});return!l.length&&!c.length}function fSe({positionedParticipants:t,potentialDrawPositions:e,drawPositionGroups:i,avoidanceConflicts:r,isRoundRobin:n}){return r.flatMap(a=>{let s=a.map(o=>o.drawPosition);return a.filter(o=>e.includes(o.drawPosition)).map(o=>{let l=e.filter(u=>!s?.includes(u)).filter(u=>pSe({moveableParticipant:o,possibleDrawPosition:u,positionedParticipants:t,drawPositionGroups:i,isRoundRobin:n,getAvoidanceConflicts:wO}));if(l.length)return{drawPosition:o.drawPosition,possibleDrawPositions:l}}).filter(Boolean)})}function JH(t){let{initialPositionAssignments:e,participantsWithGroupings:i,opponentsToPlaceCount:r,unseededByePositions:n,drawPositionGroups:a,policyAttributes:s,idCollections:o,allGroups:l}=t,u=[],c,d=Math.min(...(a||[]).map(w=>w?.length).filter(Boolean)),p=d>2,f=ke(e,!1,!0).filter(w=>!w.qualifier),m=e.filter(w=>!w.participantId&&(!w.bye||n?.includes(w.drawPosition))).map(w=>w.drawPosition);Re(0,r).forEach(()=>{let{newGroupKey:w,selectedParticipantId:y,targetDrawPosition:b}=cSe({...t,candidatePositionAssignments:f,allGroups:l,groupKey:c});c=w,f.forEach(S=>{S.drawPosition===b&&(S.participantId=y)})});let h=YH({candidatePositionAssignments:f,participantsWithGroupings:i,policyAttributes:s,idCollections:o}),g=yr(h,d),I=wO({groupedParticipants:g,isRoundRobin:p}),v=0;for(;v<20&&I.length;){let w=fSe({positionedParticipants:h,potentialDrawPositions:m,avoidanceConflicts:I,drawPositionGroups:a,isRoundRobin:p});if(w.length){let y=mSe({candidatePositionAssignments:f,swapOptions:w});y.error&&console.log({result:y}),h=YH({candidatePositionAssignments:f,participantsWithGroupings:i,policyAttributes:s,idCollections:o}),g=yr(h,d),I=wO({groupedParticipants:g,isRoundRobin:p}),v++}else v=20}return f.forEach(w=>{if(w.bye&&w.participantId){let y=Xk;u.push(y)}if(w.qualifier&&w.participantId){let y=Xk;u.push(y)}}),{positionAssignments:f,conflicts:I.length,groupedParticipants:g,errors:u}}function mSe({candidatePositionAssignments:t,swapOptions:e}){let i=ma(e);if(!i)return{error:{message:"No swap options"}};let r=i.drawPosition,n=ma(i.possibleDrawPositions),a=t.find(u=>u.drawPosition===r),s=t.find(u=>u.drawPosition===n)??{},o={participantId:s?.participantId,qualifier:s?.qualifier,bye:s?.bye},l={participantId:a.participantId,qualifier:a.qualifier,bye:a.bye};return Object.assign(a,o),Object.assign(s,l),{...H}}function hSe({provisionalPositioning:t,unseededParticipantIds:e,inContextDrawMatchUps:i,unseededByePositions:r,tournamentRecord:n,drawDefinition:a,seedBlockInfo:s,participants:o,matchUpsMap:l,structureId:u,avoidance:c,drawSize:d,event:p}){if(!c)return{error:L6};let{candidatesCount:f=1,policyAttributes:m,targetDivisions:h}=c,{roundsToSeparate:g}=c,I="randomUnseededSeparation",{structure:v}=et({drawDefinition:a,structureId:u}),{matchUps:w}=Nt({provisionalPositioning:t,matchUpsMap:l,structure:v,event:p});if(h&&Uo(h)&&!g){let L=oIe(h)||0,$=w.reduce((V,_)=>_.roundNumber>V?_.roundNumber:V,0);g=$<L?1:$-L+1}let{positionAssignments:y}=ur({structure:v}),b=RR({participantsProfile:{convertExtensions:!0},deepCopy:!1,participants:o}).participantsWithGroupings,S=y?.filter(L=>!L.participantId),U=y?.map(L=>L.drawPosition),T=v?.structureType===fn,P=T?{structure:v,matchUps:w,allDrawPositions:U,roundsToSeparate:g}:{matchUps:w,allDrawPositions:U,roundsToSeparate:g},{drawPositionGroups:D,drawPositionChunks:E}=T?gSe(P):ISe(P),R={groupParticipants:o.filter(L=>L.participantType===ja).map(L=>L.participantId),teamParticipants:o.filter(L=>L.participantType===Lt).map(L=>L.participantId),pairParticipants:o.filter(L=>L.participantType===pt).map(L=>L.participantId)},C=rSe({targetParticipantIds:e,policyAttributes:m,idCollections:R,participants:o});if(C.error)return z({result:C,stack:I});let M=Object.assign({},...e.map(L=>{let $=Object.keys(C).filter(V=>(C[V]??[]).includes(L));return{[L]:$}})),N=J7({participantIds:e,positionAssignments:y});if(N.length>(S?.length||0))return{error:Y1};let A,O=N.length,k=Re(0,f).map(()=>JH({initialPositionAssignments:y,participantsWithGroupings:b,unseededParticipantIds:e,opponentsToPlaceCount:O,pairedPriority:!1,unseededByePositions:r,participantIdGroups:M,drawPositionChunks:E,drawPositionGroups:D,policyAttributes:m,idCollections:R,allGroups:C,drawSize:d}));if(A=k.reduce((L,$)=>!L||($.conflicts||0)<(L.conflicts||0)?$:L,void 0),!A||A.conflicts){let L=Re(0,f).map(()=>JH({initialPositionAssignments:y,participantsWithGroupings:b,unseededParticipantIds:e,opponentsToPlaceCount:O,pairedPriority:!0,unseededByePositions:r,participantIdGroups:M,drawPositionChunks:E,drawPositionGroups:D,policyAttributes:m,idCollections:R,allGroups:C,drawSize:d}));A=k.concat(...L).filter($=>!$.errors?.length).reduce(($,V)=>!$||(V.conflicts||0)<($.conflicts||0)?V:$,void 0)}if(!A)return{error:XE};let F=(Yt({structure:v})?.positionAssignments??[]).filter(L=>L.participantId).map(L=>L.participantId),x=A.positionAssignments.filter(L=>!F.includes(L.participantId));for(let L of x)if(L.bye){let $=Wa({tournamentRecord:n,drawDefinition:a,structureId:u,matchUpsMap:l,event:p,...L});if($.error)return z({result:$,stack:I})}else if(L.participantId){let $=ol({inContextDrawMatchUps:i,tournamentRecord:n,drawDefinition:a,seedBlockInfo:s,structureId:u,matchUpsMap:l,event:p,...L});if($.error)return z({result:$,stack:I,context:{assignment:L}})}return{...H}}function gSe(t){let{structure:{structures:e}}=t,i=e.map(r=>r.positionAssignments.map(n=>n.drawPosition));return{drawPositionGroups:i,drawPositionChunks:[i]}}function ISe({allDrawPositions:t,roundsToSeparate:e,matchUps:i}){let r=i.filter(c=>c.roundNumber===1).map(c=>c.drawPositions),n=r.flat().sort(ir),a=Math.max(...n),s=t.filter(c=>c>a),o=n.length,l=Re(o===2?1:2,o).filter(c=>c===k1(c)),u=l.slice(0,e||l.length).reverse().map(c=>yr(n,c));return s.length&&console.log({fedDrawPositions:s}),{drawPositionGroups:r,drawPositionChunks:u}}function vSe({provisionalPositioning:t,inContextDrawMatchUps:e,unseededByePositions:i,multipleStructures:r,tournamentRecord:n,drawDefinition:a,seedBlockInfo:s,participants:o,matchUpsMap:l,structureId:u,structure:c,drawSize:d,event:p}){let f="positionUnseededParticipants";c||({structure:c}=et({drawDefinition:a,structureId:u})),u||({structureId:u}=c);let{positionAssignments:m}=ur({structure:c}),{seedAssignments:h}=ds({provisionalPositioning:t,drawDefinition:a,structure:c}),g=h?.map(P=>P.participantId).filter(Boolean),{stage:I,stageSequence:v}=c,w=I===We?mt({element:c,name:Tl})?.extension?.value:void 0,y=dh({provisionalPositioning:t,drawDefinition:a,stageSequence:v,entryStatuses:lf,structureId:u,roundTarget:w,stage:I}),b=y.filter(P=>!g?.includes(P.participantId)).map(P=>P.participantId),S=m?.filter(P=>!P.participantId&&!P.bye&&!P.qualifier).map(P=>P.drawPosition);if(!r&&b.length>(S?.length||0))return z({result:{error:Y1},context:{unseededParticipantsCount:b.length,unfilledDrawPositionsCount:S?.length},stack:f});let{appliedPolicies:U}=Tt({tournamentRecord:n,drawDefinition:a,event:p}),T=U?.[YD];if(c.stage===Ui){let P=y.reduce((D,E)=>(D[E.groupingValue]||(D[E.groupingValue]=[]),D[E.groupingValue].push(E.participantId),D),{});Object.keys(P).length&&(T||(T={policyName:"Playoff Avoidance"}),T.policyAttributes||(T.policyAttributes=[]),T.policyAttributes.push({groupings:P}))}return T&&o?hSe({provisionalPositioning:t,unseededParticipantIds:b,inContextDrawMatchUps:e,unseededByePositions:i,tournamentRecord:n,drawDefinition:a,seedBlockInfo:s,participants:o,matchUpsMap:l,structureId:u,avoidance:T,drawSize:d}):ySe({provisionalPositioning:t,unseededParticipantIds:b,inContextDrawMatchUps:e,unfilledDrawPositions:S,multipleStructures:r,tournamentRecord:n,drawDefinition:a,seedBlockInfo:s,structureId:u,matchUpsMap:l,drawSize:d,event:p})}function ySe({provisionalPositioning:t,unseededParticipantIds:e,inContextDrawMatchUps:i,unfilledDrawPositions:r,multipleStructures:n,tournamentRecord:a,drawDefinition:s,seedBlockInfo:o,matchUpsMap:l,structureId:u,drawSize:c,event:d}){let p=c>2?Dn(r):r.reverse();for(let f of e){let m=p.pop();if(!n||m){let h=ol({provisionalPositioning:t,inContextDrawMatchUps:i,tournamentRecord:a,drawDefinition:s,seedBlockInfo:o,participantId:f,drawPosition:m,matchUpsMap:l,structureId:u,event:d});if(h?.error&&console.log("!!!!!",{result:h}),h?.error)return z({result:h,stack:"randomUnseededDistribution"})}}return{...H}}function bSe(t){let e=t.structure??et(t).structure,i="positionQualifiers",r=[];if(e.stage===Zr)return z({result:{error:ef},stack:i});let{unplacedRoundQualifierCounts:n,positionAssignments:a,roundDrawPositions:s}=wSe(t);for(let o of Object.keys(n)){let l=a?.filter(u=>s[o].includes(u.drawPosition)&&!u.participantId&&!u.qualifier&&!u.bye).map(u=>u.drawPosition);if(n[o]>(l||0))return z({result:{error:q1},context:{unfilledDrawPositions:l},stack:i});Re(0,n[o]).forEach(()=>{let u=ma(l);r.push(u),a?.forEach(c=>{c.drawPosition===u&&(c.qualifier=!0,delete c.participantId,delete c.bye)})})}return{...H,qualifierDrawPositions:r}}function wSe({drawDefinition:t,structure:e,structureId:i}){e||({structure:e}=et({drawDefinition:t,structureId:i})),i||({structureId:i}=e);let{positionAssignments:r}=ur({structure:e}),{stage:n,stageSequence:a}=e,{qualifiersCount:s,roundQualifiersCounts:o}=pv({drawDefinition:t,stageSequence:a,structureId:i,stage:n}),l=(o?Object.keys(o):[]).map(h=>Ye(h)),{matchUps:u}=Nt({structure:e}),{roundProfile:c}=bn({matchUps:u}),d=Object.assign({},...l.filter(h=>c?.[h]).map(h=>({[h]:c?.[h]?.drawPositions?.filter(Boolean)??[]}))),p=r?.filter(h=>h.qualifier).map(h=>h.drawPosition),f=s-(p?.length??0),m=p?.length;return{unplacedRoundQualifierCounts:Object.assign({},...l.map(h=>{let g=r?.filter(I=>I.qualifier&&d[h]?.drawPositions?.includes(I.drawPosition)).map(I=>I.drawPosition);return{[h]:(o?.[h]??0)-(g?.length??0)}})),unplacedQualifiersCount:f,placedQualifiersCount:m,roundQualifiersCounts:o,positionAssignments:r,roundDrawPositions:d,qualifiersCount:s}}function Q7({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,appliedPolicies:r,validSeedBlocks:n,drawDefinition:a,seedingProfile:s,seedBlockInfo:o,participants:l,groupsCount:u,structureId:c,matchUpsMap:d,structure:p,event:f}){let m=[],h=[],g=0;if(p||({structure:p}=et({drawDefinition:a,structureId:c})),c||(c=p?.structureId),r||(r=Tt({drawDefinition:a}).appliedPolicies),!n){let I=p&&bh({provisionalPositioning:t,appliedPolicies:r,drawDefinition:a,seedingProfile:s,structure:p});I?.error&&h.push(I.error),n=I?.validSeedBlocks}return u=u??n?.length??0,Re(0,u).forEach(()=>{if(g<(u||0)){let I=SSe({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:a,seedingProfile:s,seedBlockInfo:o,participants:l,structureId:c,matchUpsMap:d,event:f});I?.success&&(g++,m.push(...I.seedPositions??[])),I.error&&h.push({seedPositionError:I.error})}}),h.length?{error:h}:{...H,seedPositions:m}}function SSe({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:r,seedingProfile:n,seedBlockInfo:a,participants:s,structureId:o,matchUpsMap:l,event:u}){let{unplacedSeedParticipantIds:c,unfilledPositions:d}=F7({provisionalPositioning:t,randomize:!0,drawDefinition:r,seedingProfile:n,seedBlockInfo:a,structureId:o}),{appliedPolicies:p}=Tt({drawDefinition:r}),{avoidance:f}=p??{};f&&s&&c?.length>2;let m=[];for(let h of c){let g=d.pop();if(!g)return{error:JI};m.push(g);let I=ol({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:r,seedingProfile:n,participantId:h,seedBlockInfo:a,drawPosition:g,matchUpsMap:l,structureId:o,event:u});if(!I.success)return I}return{...H,seedPositions:m}}function USe({provisionalPositioning:t,drawDefinition:e,structure:i}){let{positionAssignments:r}=ur({structure:i}),{seedAssignments:n}=ds({provisionalPositioning:t,drawDefinition:e,structure:i}),a=Object.assign({},...(n||[]).filter(s=>s.participantId).map(s=>({[s.participantId]:s})));return r?.map(s=>a[s.participantId]?{...s,seedNumber:a[s.participantId].seedNumber,seedValue:a[s.participantId].seedValue}:"").filter(Boolean)}function TSe({orderedSortedFirstRoundSeededDrawPositions:t,validSeedBlocks:e,byesToPlace:i}){let r=[];e.forEach(a=>DSe(a,i,r,t));let n=r.map(a=>Array.isArray(a)?Dn(a):a).flat(1/0);return i6(i)&&e.map(a=>a.seedNumbers[0]).includes(i)?t:n}function DSe(t,e,i,r){if(e-i.length>t.drawPositions.length)i.push(...t.drawPositions);else{let n=SO(yr(t.drawPositions,2));PSe(n,i,r)}}function PSe(t,e,i){let r,n=i[e.length];for(;r=eD(t,n);)e.push(r),n=i[e.length]}function eD(t,e){return Array.isArray(t)&&t.length!==2?t.pop():Array.isArray(t[0])?RSe(t,e):ESe(t,e)}function ESe(t,e){return t.includes(e)?t.indexOf(e)?t.pop():t.shift():Math.round(Math.random())?t.pop():t.shift()}function RSe(t,e){let i=t[0].flat(1/0).length,r=t[1].flat(1/0).length;if(i===r){let n=t[0].flat(1/0).includes(e)?t[0]:t[1];return eD(e?n:t[Math.round(Math.random())],e)}return i<r?eD(t[1],e):eD(t[0],e)}function SO(t){let e=Math.floor(t.length/2);return t.length>2?[SO(t.slice(0,e)),SO(t.slice(e))]:t}function CSe({provisionalPositioning:t,relevantMatchUps:e,appliedPolicies:i,drawDefinition:r,seedingProfile:n,seedBlockInfo:a,byesToPlace:s,structure:o}){a||(a=bh({provisionalPositioning:t,appliedPolicies:i,drawDefinition:r,seedingProfile:n,structure:o}));let{isFeedIn:l,isLuckyStructure:u,isContainer:c}=a,{validSeedBlocks:d}=a;i?.seeding?.containerByesIgnoreSeeding&&(d=[]);let p=USe({provisionalPositioning:t,drawDefinition:r,structure:o})??[],f=rt([].concat(...e.map(y=>y.drawPositions))),m=p.filter(y=>f.includes(y.drawPosition)),h=(y,b)=>lI(y.seedValue)-lI(b.seedValue),g=d.reduce((y,b)=>{let S=m.filter(U=>b.drawPositions?.includes(U.drawPosition)).sort(h);return y.concat(...S)},[]).map(y=>y.drawPosition),I=TSe({orderedSortedFirstRoundSeededDrawPositions:g,validSeedBlocks:d,byesToPlace:s}),v=QH({orderedSeedDrawPositions:g,relevantMatchUps:e}).slice(0,s),w=QH({orderedSeedDrawPositions:I,relevantMatchUps:e}).slice(0,s);return{strictSeedOrderByePositions:v,blockSeedOrderByePositions:w,isLuckyStructure:u,positionedSeeds:p,isContainer:c,isFeedIn:l}}function QH({orderedSeedDrawPositions:t,relevantMatchUps:e}){let i=e.map(r=>r.drawPositions).map(r=>r?.sort((n,a)=>n-a)).filter(r=>r?.[0]+1===r?.[1]);return t.map(r=>i.find(n=>n?.includes(r))).filter(Boolean).map(r=>r?.reduce((n,a)=>t.includes(a)?n:a,void 0)).filter(Boolean)}function MSe({provisionalPositioning:t,seedOrderByePositions:e,isLuckyStructure:i,appliedPolicies:r,drawDefinition:n,seedLimit:a,structure:s,isFeedIn:o}){let l=r?.seeding?.seedingProfile,u=s.stage===We,{positionAssignments:c}=ur({structure:s}),d=c?.filter(N=>N.participantId).map(N=>N.drawPosition),p={isCollectionMatchUp:!1},{matchUps:f,roundMatchUps:m}=Nt({provisionalPositioning:t,matchUpFilters:p,structure:s}),h=m?.[1]||[],g=s.structureType===fn?f:h,I=rt([].concat(...g.map(N=>N.drawPositions))),v=Math.min(...I)-1,w=d?.filter(N=>I.includes(N)),y=N=>{let A=Math.ceil(N.length/2),O=[N.slice(0,A),N.slice(A)],k=O.map(G=>[].concat(...G.flat(1/0)).length),F=Math.min(...k.flat(1/0)),x=Math.max(...k.flat(1/0)),L=k.indexOf(x),$=F!==x,V=Dn(O),[_,B]=!F||$?[O[L],O[1-L]]:[V[0],V[1]];return{greaterHalf:_,lesserHalf:B}},b=N=>{let{greaterHalf:A,lesserHalf:O}=y(N),{greaterHalf:k,lesserHalf:F}=y(A),x=Dn(k.flat(1/0)).pop(),L=k.flat().filter($=>$!==x);return{newlyFilteredChunks:[...O,...F,L],drawPosition:x}},S=N=>!e.includes(N),U=N=>!w?.includes(N),T=N=>{let A=yr(N.sort(ir),Math.ceil(N.length/4)).map(F=>F.filter(U)),O=[].concat(...A.flat(1/0)).length,k=[];for(let F=0;F<O;F++){let{newlyFilteredChunks:x,drawPosition:L}=b(A);k.push(L),A=x}return k},{validSeedBlocks:P}=bh({provisionalPositioning:t,allPositions:!0,appliedPolicies:r,drawDefinition:n,structure:s}),D=P?.map(N=>N.drawPositions?.map(A=>A+v)),E;if(o){let N=I.length,{seedBlocks:A}=CL({cluster:[oR,lR].includes(gS(l)),participantsCount:N});E=A.map(O=>O.map(k=>k+v)).map(T).filter(O=>O.length)}else u?E=D?.map(N=>N.filter(U)):E=D?.map(T).filter(N=>N.length);let R=g.map(N=>N.drawPositions).map(N=>N?.sort((A,O)=>A-O)).filter(N=>N?.[0]+1===N?.[1]),C=N=>R.reduce((A,O)=>O.includes(N)?O.reduce((k,F)=>F!==N?F:k,void 0):A,void 0),M=E.map(N=>N.map(C)).flat(1/0).filter(U).filter(S).filter(Boolean);if(u&&!s.structures){let N=a%4,A=M.slice(0,N),O=m[s.roundLimit]?.length,k=yr(M.slice(N),O).map(Dn).flat();M=A.concat(k)}return{unseededByePositions:M}}function NSe({provisionalPositioning:t,drawDefinition:e,matchUpsMap:i,structure:r,event:n}){let a={isCollectionMatchUp:!1},{matchUps:s,roundMatchUps:o}=Nt({afterRecoveryTimes:!1,provisionalPositioning:t,drawDefinition:e,matchUpFilters:a,matchUpsMap:i,structure:r,event:n}),l=o?.[1]||[],u=r?.structureType===fn,c=u?s:l,d=u?r?.structures?.length||0:s.length,{structureId:p,stage:f,stageSequence:m}=r,h=dh({entryStatuses:so,provisionalPositioning:t,drawDefinition:e,stageSequence:m,structureId:p,stage:f}),{qualifiersCount:g}=pv({provisionalPositioning:t,drawDefinition:e,stageSequence:m,structureId:p,stage:f}),I=h.length+g,{positionAssignments:v,unassignedPositions:w}=ur({structure:r}),y=w?.map(D=>D.drawPosition),b=v?.filter(D=>D.bye).length,S=v?.filter(D=>D.bye).map(D=>D.drawPosition),U=c.map(D=>D.drawPositions).filter(D=>D?.reduce((E,R)=>!S?.includes(R)&&E,!0)).flat(1/0).filter(D=>y?.includes(D)),T=v?.length,P=T?T-I:0;return P>d&&r.stageSequence===1&&r.stage!==Zr&&(P=d),{placedByes:b,byesCount:P,relevantMatchUps:c,placedByePositions:S,roundMatchUps:o,positionsToAvoidDoubleBye:U}}function Z7({provisionalPositioning:t,tournamentRecord:e,appliedPolicies:i,drawDefinition:r,seedBlockInfo:n,seedingProfile:a,matchUpsMap:s,structureId:o,structure:l,seedLimit:u,seedsOnly:c,event:d}){l||({structure:l}=et({drawDefinition:r,structureId:o})),o||(o=l?.structureId);let p=!(l?.structures??l?.stage===We),{byesCount:f,placedByes:m,relevantMatchUps:h}=NSe({provisionalPositioning:t,drawDefinition:r,matchUpsMap:s,structure:l,event:d}),g=f-(m||0);if(g<=0)return{...H};let{strictSeedOrderByePositions:I,blockSeedOrderByePositions:v,isLuckyStructure:w,isFeedIn:y}=CSe({provisionalPositioning:t,relevantMatchUps:h,appliedPolicies:i,drawDefinition:r,seedingProfile:a,seedBlockInfo:n,byesToPlace:g,structure:l}),b=l?.structureType&&[fn,uR].includes(l.structureType)&&i?.seeding?.containerByesIgnoreSeeding,S=p&&v?.length?v:I,{unseededByePositions:U}=MSe({provisionalPositioning:t,seedOrderByePositions:S,isLuckyStructure:w,appliedPolicies:i,drawDefinition:r,seedLimit:u,structure:l,isFeedIn:y}),T=R=>R%2,P=(R,C)=>(R||[]).every(M=>T(M)?C!==M+1:C!==M-1),D=[].concat(...S);if(!c)for(;U.length;){let R=U.find(C=>P(D,C));R?(D.push(R),U=U.filter(C=>C!==R)):(D.push(...U),U=[])}b&&(D=Dn(D),ra({ignoreSeededByes:b})&&console.log({byePositions:D}));let E=D.slice(0,g);for(let R of E){let C=Wa({provisionalPositioning:t,tournamentRecord:e,drawDefinition:r,drawPosition:R,matchUpsMap:s,structureId:o,structure:l,event:d});if(C?.error)return C}return{...H,unseededByePositions:U,byeDrawPositions:E}}function fy(t,e){return e||ZE(),z({result:t,stack:"automatedPositioning"})}function ASe(t,e){return e||ZE(),t}function kSe(t,e,i,r){let n=et({drawDefinition:e,structureId:i});if(n.error)return{error:n.error};let a=n.structure;if(!a)return{error:Ii};let s=t.appliedPolicies||Tt({drawDefinition:e,structure:a,event:r})?.appliedPolicies,{qualifiersCount:o}=pv({stageSequence:a.stageSequence,provisionalPositioning:t.provisionalPositioning,stage:a.stage,drawDefinition:e,structureId:i}),l=lf,u=dh({stageSequence:a.stageSequence,provisionalPositioning:t.provisionalPositioning,stage:a.stage,placementGroup:t.placementGroup,drawDefinition:e,entryStatuses:l,structureId:i});return{structure:a,appliedPolicies:s,qualifiersCount:o,entries:u}}function OSe({placeByes:t,provisionalPositioning:e,tournamentRecord:i,appliedPolicies:r,drawDefinition:n,seedBlockInfo:a,matchUpsMap:s,structure:o,seedLimit:l,seedsOnly:u,event:c,structureSeedingProfile:d,seedingProfile:p,inContextDrawMatchUps:f,participants:m,positioningReport:h}){let g=t?Z7({provisionalPositioning:e,tournamentRecord:i,appliedPolicies:r,drawDefinition:n,seedBlockInfo:a,matchUpsMap:s,structure:o,seedLimit:l,seedsOnly:u,event:c}):void 0;if(g?.error)return{error:g.error};let I=g?.unseededByePositions;return h.push({action:"positionByes",unseededByePositions:I}),g=Q7({seedingProfile:d?{positioning:d}:p,provisionalPositioning:e,inContextDrawMatchUps:f,tournamentRecord:i,appliedPolicies:r,validSeedBlocks:a.validSeedBlocks,drawDefinition:n,seedBlockInfo:a,participants:m,matchUpsMap:s,structure:o,event:c}),g.error?{error:g.error}:(h.push({seedPositions:g.seedPositions,action:"positionSeedBlocks"}),{unseededByePositions:I})}function xSe({drawType:t,LUCKY_DRAW:e,structureSeedingProfile:i,seedingProfile:r,provisionalPositioning:n,inContextDrawMatchUps:a,tournamentRecord:s,appliedPolicies:o,validSeedBlocks:l,drawDefinition:u,seedBlockInfo:c,participants:d,matchUpsMap:p,structure:f,event:m,placeByes:h,seedLimit:g,seedsOnly:I,positioningReport:v}){let w;if(t!==e){let b=Q7({seedingProfile:i?{positioning:i}:r,provisionalPositioning:n,inContextDrawMatchUps:a,tournamentRecord:s,appliedPolicies:o,validSeedBlocks:l,drawDefinition:u,seedBlockInfo:c,participants:d,matchUpsMap:p,structure:f,event:m});if(b.error)return{error:b.error};v.push({action:"positionSeedBlocks",seedPositions:b.seedPositions})}let y=h?Z7({provisionalPositioning:n,tournamentRecord:s,appliedPolicies:o,drawDefinition:u,seedBlockInfo:c,matchUpsMap:p,structure:f,seedLimit:g,seedsOnly:I,event:m}):void 0;return y?.error?{error:y.error}:(w=y?.unseededByePositions,v.push({action:"positionByes",byeDrawPositions:y?.byeDrawPositions,unseededByePositions:w}),{unseededByePositions:w})}function FSe({seedsOnly:t,inContextDrawMatchUps:e,tournamentRecord:i,appliedPolicies:r,validSeedBlocks:n,drawDefinition:a,seedBlockInfo:s,participants:o,matchUpsMap:l,structure:u,positionQualifiers:c,positionUnseededParticipants:d,provisionalPositioning:p,unseededByePositions:f,multipleStructures:m,structureId:h,drawSize:g,event:I,positioningReport:v,conflicts:w}){if(t)return{};let y=c({inContextDrawMatchUps:e,tournamentRecord:i,appliedPolicies:r,validSeedBlocks:n,drawDefinition:a,seedBlockInfo:s,participants:o,matchUpsMap:l,structure:u});return y.error?{error:y.error}:(y.conflicts&&(w.qualifierConflicts=y.conflicts),v.push({action:"positionQualifiers",qualifierDrawPositions:y.qualifierDrawPositions}),y=d({provisionalPositioning:p,inContextDrawMatchUps:e,unseededByePositions:f,multipleStructures:m,tournamentRecord:i,drawDefinition:a,seedBlockInfo:s,participants:o,matchUpsMap:l,structureId:h,structure:u,drawSize:g,event:I}),y.error?{error:y.error}:(y.conflicts&&(w.unseededConflicts=y.conflicts),v.push({action:"positionUnseededParticipants"}),{}))}function IS(t){let{drawDefinition:e}=t,{applyPositioning:i=!0,provisionalPositioning:r,multipleStructures:n,placeByes:a=!0,tournamentRecord:s,seedingProfile:o,structureId:l,seedLimit:u,seedsOnly:c,drawType:d,drawSize:p,event:f}=t,m=[];i||(R4(),e=ke(e,!1,!0));let{structure:h,appliedPolicies:g,qualifiersCount:I,entries:v,error:w}=kSe(t,e,l,f);if(w)return fy(w,i);if(!v?.length&&!I)return ASe({...H},i);let y=t.matchUpsMap??kr({drawDefinition:e}),b=t.inContextDrawMatchUps??Qi({inContext:!0,drawDefinition:e,matchUpsMap:y})?.matchUps,S=bh({provisionalPositioning:r,appliedPolicies:g,drawDefinition:e,seedingProfile:o,structure:h});if(S.error)return fy(S,i);let{validSeedBlocks:U}=S;m.push({validSeedBlocks:U});let T=t.participants||(s?Ei({withIndividualParticipants:!0,convertExtensions:!0,tournamentRecord:s})?.participants:[]),P;if(gS(h.seedingProfile||o)===Dp){let C=OSe({placeByes:a,provisionalPositioning:r,tournamentRecord:s,appliedPolicies:g,drawDefinition:e,seedBlockInfo:S,matchUpsMap:y,structure:h,seedLimit:u,seedsOnly:c,event:f,structureSeedingProfile:h.seedingProfile,seedingProfile:o,inContextDrawMatchUps:b,participants:T,positioningReport:m});if(C?.error)return fy(C.error,i);P=C.unseededByePositions}else{let C=xSe({drawType:d,LUCKY_DRAW:rf,structureSeedingProfile:h.seedingProfile,seedingProfile:o,provisionalPositioning:r,inContextDrawMatchUps:b,tournamentRecord:s,appliedPolicies:g,validSeedBlocks:U,drawDefinition:e,seedBlockInfo:S,participants:T,matchUpsMap:y,structure:h,event:f,placeByes:a,seedLimit:u,seedsOnly:c,positioningReport:m});if(C?.error)return fy(C.error,i);P=C.unseededByePositions}let D={},E=FSe({seedsOnly:c,inContextDrawMatchUps:b,tournamentRecord:s,appliedPolicies:g,validSeedBlocks:U,drawDefinition:e,seedBlockInfo:S,participants:T,matchUpsMap:y,structure:h,positionQualifiers:bSe,positionUnseededParticipants:vSe,provisionalPositioning:r,unseededByePositions:P,multipleStructures:n,structureId:l,drawSize:p,event:f,positioningReport:m,conflicts:D});if(E?.error)return fy(E.error,i);let{positionAssignments:R}=Yt({drawDefinition:e,structure:h});return ti({drawDefinition:e,structureIds:[l]}),i||ZE(),{positionAssignments:R,conflicts:D,...H,positioningReport:m}}function hv(t){let{applyPositioning:e=!0,provisionalPositioning:i,tournamentRecord:r,drawDefinition:n,seedingProfile:a,structureId:s,placeByes:o,seedsOnly:l}=t;if(!n)return{error:Oa};if(!uu({drawDefinition:n,structureId:s})&&!i)return{error:O1};let u=Y7({drawDefinition:n,structureId:s}).playoffStructures?.sort((p,f)=>QD(p)-QD(f)),c=[],d=[];if(u)for(let p of u){let{structureId:f}=p,m=IS({structureId:f,provisionalPositioning:i,applyPositioning:e,tournamentRecord:r,drawDefinition:n,seedingProfile:a,placeByes:o,seedsOnly:l});if(m.error)return m;m.positionAssignments&&c.push({positionAssignments:m.positionAssignments,structureId:f}),m.positioningReport&&d.push(m.positioningReport)}return{...H,structurePositionAssignments:c,positioningReports:d}}function e8({validation:t=!0,tournamentRecord:e,drawDefinition:i,participantId:r,structureId:n,seedValue:a,event:s}){if(!i)return{error:_e};if(!n)return{error:Va};let o=(e?.participants??[]).find(p=>p.participantId===r);if(e&&!o)return{error:To};let{structure:l}=et({drawDefinition:i,structureId:n});if(!l)return{error:Ii};if(!(!t||Ni(a)||a===void 0||a===""||typeof a=="string"&&a.split("-").every(p=>Ni(p)&&Ye(p)>0)))return{error:ie};let{seedAssignments:u}=ds({drawDefinition:i,structure:l}),c=u?.map(p=>p.seedNumber),d=u?.find(p=>p.participantId===r);if(d){let p=typeof a=="string"?a.includes("-")&&a.split("-").map(f=>parseInt(f)).join("-")||parseInt(a)>0&&parseInt(a)||"":a&&a>0&&a||"";d.seedValue=p}else{let p={seedNumber:Math.max(0,...c||[])+1,participantId:r};a&&(p.seedValue=a),l.seedAssignments||(l.seedAssignments=[]),l.seedAssignments.push(p)}return vK({tournamentId:e?.tournamentId,eventId:s?.eventId,drawDefinition:i,structure:l}),{...H}}function _L({qualifyingParticipantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,structureId:n}){return xL({positionActionName:"qualifierDrawPositionAssignment",participantId:t,isQualifierPosition:!0,tournamentRecord:e,drawDefinition:i,drawPosition:r,structureId:n})}function Eb({targetRoundNumber:t,finishingPosition:e,drawDefinition:i,structureId:r,linkType:n}){let{links:a}=uv({drawDefinition:i,structureId:r})||{},s=(a?.target||[]).filter(({linkType:o})=>o===n).filter(({target:o})=>!t||t===o.roundNumber).map(o=>{let l=o.source.structureId,{structure:u}=et({structureId:l,drawDefinition:i});if(!(e&&u?.finishingPosition!==e))return o}).filter(Boolean);return{sourceStructureIds:s.map(({source:o})=>o.structureId),relevantLinks:s}}var LSe=(t,e)=>{let i=[...new Set(e.slice(0,t.length))],r=[...i].sort((o,l)=>o-l),n=new Set,a=[];i.forEach(o=>{let l=t.indexOf(o);if(l!==-1&&!n.has(l))a.push(l),n.add(l);else{let u=r.indexOf(o),c=t.findIndex((d,p)=>!n.has(p));for(;n.has(c)&&c===-1&&n.size<t.length;)c=t.findIndex((d,p)=>!n.has(p)&&p>c);a.push(u),n.add(u)}});let s=t.filter((o,l)=>!n.has(l));return[...a,...s]};function t8({targetRoundNumber:t=1,tournamentRecord:e,drawDefinition:i,event:r,randomList:n}){let a=Ge({drawDefinition:i,event:r,tournamentRecord:e},[{[mn]:!0,[kc]:!0,[mr]:!0}]);if(a.error)return a;let s=[],o=[],l=i.structures?.find(g=>g.stage===xe&&g.stageSequence===1);if(!l)return z({result:{error:B1}});let u=(Tt({tournamentRecord:e,drawDefinition:i,structure:l,event:r}).appliedPolicies??{})[Rp]?.requireCompletedStructures,{qualifierPositions:c,positionAssignments:d}=ur({structure:l});if(!c.length)return z({result:{error:q1}});let p=Re(0,c.length);n&&(p=LSe(p,n));let f=d.map(g=>g.participantId).filter(Boolean),{relevantLinks:m}=Eb({structureId:l.structureId,targetRoundNumber:t,linkType:ru,drawDefinition:i})||{},{relevantLinks:h}=Eb({structureId:l.structureId,targetRoundNumber:t,linkType:iu,drawDefinition:i})||{};for(let g of m){let I=i.structures?.find(w=>w.structureId===g.source.structureId);if(I?.stage!==We)continue;let v=uu({structureId:g.source.structureId,drawDefinition:i});if(!u||v){let w=I.qualifyingRoundNumber,{matchUps:y}=Nt({matchUpFilters:{...w&&{roundNumbers:[w]},isCollectionMatchUp:!1,hasWinningSide:!0},afterRecoveryTimes:!1,inContext:!0,structure:I});for(let b of y){let S=b.matchUpStatus==="BYE"&&b.sides?.find(({participantId:T})=>T),U=b.sides.find(T=>T?.sideNumber===b.winningSide);if(U||S){let{participantId:T}=U||S||{};T&&!f.includes(T)&&o.push(T)}}}}for(let g of h){let I=i?.structures?.find(v=>v.structureId===g.source.structureId);if(I?.stage===We&&uu({structureId:g.source.structureId,drawDefinition:i})){let{positionAssignments:v}=Yt({structure:I}),w=v?.map(y=>{let b=y.participantId,S=mt({element:y,name:pc}).extension?.value;return S?{participantId:b,groupOrder:S?.groupOrder}:{}}).filter(({groupOrder:y,participantId:b})=>y===1&&!f.includes(b)).map(({participantId:y})=>y)??[];w&&o.push(...w)}}return o.length?(p.forEach((g,I)=>{let v=o[I],w=c[g].drawPosition;v&&_L({qualifyingParticipantId:v,structureId:l.structureId,drawPosition:w,tournamentRecord:e,drawDefinition:i})?.success&&s.push({participantId:v,drawPosition:w})}),z({result:Ve({...H,assignedParticipants:s})})):z({result:{error:X6}})}function i8({drawDefinition:t,orderMap:e}){return t?((typeof e!="object"||!Object.values(e).every(i=>ot(i)))&&z({result:{error:ie},context:{orderMap:e}}),t.structures||(t.structures=[]),t.structures.forEach(i=>{let r=e[i.structureId];r&&(i.structureOrder=r)}),t.structures.sort((i,r)=>qg(i.structureOrder)-qg(r.structureOrder)),{...H}):{error:_e}}function HR({drawDefinition:t}){let e=t.structures??[],i=t.links??[],r=new Map,n=g=>{let I=r.get(g)||r.set(g,{drawSources:[],drawTargets:[],progeny:[],sources:[],targets:[]})&&r.get(g);if(I&&!I?.stage){let v=e.find(w=>w.structureId===g);I.stage=v?.stage}return I},a={},s={},o=i.map(g=>{let I=g.source.structureId,v=g.target.structureId,w=n(I),y=n(v);return[Pp,Ms,cR,Dp].includes(g.target.feedProfile)?(w?.targets.push(v),y?.sources.push(I)):g.target.feedProfile===Cs&&(y?.drawSources.push(I),w?.drawTargets.push(v)),s[v]=s[v]||g.target.feedProfile===Cs,a[v]=rt([...a[v]||[],I]).filter(Boolean),[g.source.structureId,g.target.structureId]});for(let g of r.keys()){let I=r.get(g);if(I){let v=I.targets??[];for(;v.length;){let w=v.pop(),y=w&&r[w];y?.targets?.length?v.push(...y.targets):y&&(I.rootStage=y.stage)}if(I.rootStage||(I.rootStage=I.stage),!I.targets?.length){let w=I.sources??[];for(;w.length;){let y=w.pop(),b=y&&r[y];if(b?.sources?.length){for(let S of b.sources)I.progeny?.includes(S)||I.progeny?.push(S);w.push(...b.sources)}}}}}let l=0;for(let g of r.keys()){let I=r.get(g);if(I&&I.rootStage===We){let v=[I.drawTargets?.[0]],w=0;for(;v.length;){w+=1;let y=v.pop(),b=y?r.get(y):void 0;b?.drawTargets?.length&&v.push(b.drawTargets[0])}I.distanceFromMain=w,w>l&&(l=w)}}let u=o.length;Re(0,Math.ceil(u/2)).forEach(()=>{o=Re(0,u).map(g=>{let I=o[g],v=o.reduce((w,y)=>kn(I,y)?w.concat(...y):w,[])||[];return rt(I.concat(...v))})});let c=o[0],d=(g,I)=>xi(g,I).length===g.length,p=o.slice(1).reduce((g,I)=>g&&d(I,c),!0),f=[c].filter(Boolean),m=[c].filter(Boolean);e.forEach(g=>{let{structureId:I,stage:v}=g;f.find(w=>w.includes(I))||(f.push([I]),v!==Er&&m.push([I]))});let h=p&&m.length===1;return!i?.length&&e.length===1&&n(e[0].structureId),{structureProfiles:Object.fromEntries(r),allStructuresLinked:h,maxQualifyingDepth:l,sourceStructureIds:a,hasDrawFeedProfile:s,structureGroups:f}}function r8({drawDefinition:t}){let{maxQualifyingDepth:e,structureProfiles:i}=HR({drawDefinition:t});for(let r of t.structures){let n=i[r.structureId];n.distanceFromMain&&(r.stageSequence=e+1-n.distanceFromMain)}return{...H}}function $L(t){let e=Ge(t,[{[mr]:!0,[mn]:!0}]);if(e.error)return e;let{tournamentRecord:i,drawDefinition:r,structure:n,link:a}=t;return _Se({tournamentId:i.tournamentId,drawDefinition:r,structure:n,link:a})}function _Se(t){let e=Ge(t,[{[mn]:!0,[gR]:!0},{link:!0,[zn]:Yn,[u6]:_1}]);if(e.error)return e;let{drawDefinition:i,tournamentId:r,structure:n,eventId:a,link:s}=t,o=s.target.structureId,l=et({drawDefinition:i,structureId:o});if(l.error)return z({stack:"attachQualifyingStructure",context:{targetStructureId:o},result:l});i.structures||(i.structures=[]),i.links||(i.links=[]),i.structures.push(n),i.links.push(s),r8({drawDefinition:i});let u=Nt({structure:n})?.matchUps||[];return hd({drawDefinition:i,tournamentId:r,matchUps:u,eventId:a}),ti({drawDefinition:i,structureIds:[n.structureId]}),{...H}}function n8({drawDefinition:t,structureDetails:e}){if(!Array.isArray(e))return{error:ie};if(!t)return{error:_e};let i=Object.assign({},...e.map(r=>{if(!bt(r))return;let{structureId:n,structureName:a}=r||{};if(!(!n||!a))return{[n]:a}}).filter(Boolean));if(!Object.values(i).length)return{error:Xe};for(let r of t.structures||[]){let n=i[r.structureId];if(n&&(r.structureName=n),r.structures)for(let a of r.structures){let s=i[a.structureId];s&&(a.structureName=s)}}return{...H}}function BL({drawDefinition:t,timeItem:e}){if(!t)return{error:Oa};if(!e)return{error:Q1};let i=e&&Object.keys(e),r=["itemType","itemValue"];if(r.filter(a=>i.includes(a)).length!==r.length)return{error:J1};t.timeItems||(t.timeItems=[]);let n=new Date().toISOString();return Object.assign(e,{createdAt:n}),t.timeItems.push(e),zw({drawDefinition:t}),{...H}}function a8(t){let{tournamentRecord:e,drawDefinition:i,structureId:r,event:n}=t,a=Ge(t,[{drawDefinition:!0,structureId:!0}]);if(a.error)return a;let s=i.structures??[],o=s.find(I=>I.structureId===r);if(!o)return{error:Ii};let l=s.find(({stage:I,stageSequence:v})=>I===xe&&v===1),u=r===l?.structureId,c=s.filter(({stage:I})=>I===We).map(ba("structureId"));if(u&&!c.length)return{error:d6};let d=c.includes(r),p=$Se({isQualifyingStructure:d,structure:o,...t});if(p?.error)return p;let{structureIdsToRemove:f,relatedStructureIdsMap:m}=VSe({qualifyingStructureIds:c,isQualifyingStructure:d,isMainStageSequence1:u,mainStageSequence1:l,drawDefinition:i,structureId:r}),{removedMatchUpIds:h,removedStructureIds:g}=jSe({relatedStructureIdsMap:m,qualifyingStructureIds:c,isMainStageSequence1:u,mainStageSequence1:l,drawDefinition:i,structureIdsToRemove:f,structureId:r});if(BSe({removedMatchUpIds:h,drawDefinition:i}),u){let I=(l.matchUps??[])?.map(ba("matchUpId"));h.push(...I),l.positionAssignments=[],l.seedAssignments=[],l.matchUps=[],l.extensions&&(l.extensions=[])}return d&&r8({drawDefinition:i}),Pu({tournamentId:e?.tournamentId,matchUpIds:h,action:"removeStructure",eventId:n?.eventId,drawDefinition:i}),ti({drawDefinition:i,eventId:n?.eventId}),{...H,removedMatchUpIds:h,removedStructureIds:g}}function $Se({isQualifyingStructure:t,tournamentRecord:e,drawDefinition:i,structureId:r,structure:n,event:a,force:s}){let o=[r];if(t){let l=c=>i.links?.find(d=>d.target.structureId===c),u=l(r)?.source.structureId;for(;u;)o.push(u),u=l(u)?.source.structureId}if(Qi({matchUpFilters:{structureIds:o},drawDefinition:i}).matchUps?.some(({score:l})=>cr({score:l}))){let l=Tt({tournamentRecord:e,drawDefinition:i,structure:n,event:a})?.appliedPolicies;if(!(s??l?.[Po]?.allowDeletionWithScoresPresent?.structures))return{error:kw}}return{...H}}function BSe({removedMatchUpIds:t,drawDefinition:e}){let{matchUps:i}=Qi({drawDefinition:e});i?.forEach(r=>{r.winnerMatchUpId&&t.includes(r.winnerMatchUpId)&&delete r.winnerMatchUpId,r.loserMatchUpId&&t.includes(r.loserMatchUpId)&&delete r.loserMatchUpId})}function VSe({qualifyingStructureIds:t,isQualifyingStructure:e,isMainStageSequence1:i,mainStageSequence1:r,drawDefinition:n,structureId:a}){let s=(n.structures??[]).map(ba("structureId")),o=c=>n.links?.map(d=>d.source.structureId===c&&d.target.structureId!==r?.structureId&&d.target.structureId).filter(Boolean)??[],l=c=>n.links?.map(d=>t.includes(d.source.structureId)&&d.target.structureId===c&&d.source.structureId).filter(Boolean)??[],u=new Map;return s.forEach(c=>u.set(c,e?l(c):o(c))),{structureIdsToRemove:i?u.get(a):[a],relatedStructureIdsMap:u}}function jSe({relatedStructureIdsMap:t,qualifyingStructureIds:e,isMainStageSequence1:i,mainStageSequence1:r,drawDefinition:n,structureIdsToRemove:a,structureId:s}){let o=[],l=[];for(;a?.length;){let u=a.pop();l.push(...WSe({idBeingRemoved:u,drawDefinition:n}));let c=HSe({qualifyingStructureIds:e,isMainStageSequence1:i,idBeingRemoved:u,drawDefinition:n,structureId:s});o.push(...c.removedStructureIds);let d=GSe({relatedStructureIdsMap:t,mainStageSequence1:r,idBeingRemoved:u,structureId:s});d?.length&&a.push(...d)}return{removedMatchUpIds:l,removedStructureIds:o}}function GSe({idBeingRemoved:t,relatedStructureIdsMap:e,mainStageSequence1:i,structureId:r}){return t&&e.get(t)?.filter(n=>n!==i?.structureId||r===i.structureId)}function HSe({qualifyingStructureIds:t,isMainStageSequence1:e,idBeingRemoved:i,drawDefinition:r,structureId:n}){let a=[];return r.links=r.links?.filter(s=>s.source.structureId!==i&&s.target.structureId!==i)??[],(!e||e&&t.length||i!==n)&&(r.structures=(r.structures??[]).filter(s=>(i&&i===s.structureId&&a.push(i),s.structureId!==i))),{removedStructureIds:a}}function WSe({idBeingRemoved:t,drawDefinition:e}){let{structure:i}=et({structureId:t,drawDefinition:e}),r=Nt({structure:i}).matchUps;return FF(r)}function oP({stageSequence:t=1,drawDefinition:e,drawSize:i,stage:r}){if(!e)return{error:_e};if(!aL({drawDefinition:e,stage:r}))return{error:ef};let n=Wye({drawDefinition:e,stage:r}),{qualifiersCount:a}=pv({drawDefinition:e,stageSequence:t,stage:r}),s=n+a;if(i<s)return{error:g6};let{entryProfile:o}=nL({attributes:[{[r]:{drawSize:i}}],drawDefinition:e});return ti({drawDefinition:e}),{...H,entryProfile:o}}function s8({qualifiersCount:t=0,drawDefinition:e,stage:i}){return e?aL({drawDefinition:e,stage:i})?(nL({attributes:[{[i]:{qualifiersCount:t}}],drawDefinition:e}),ti({drawDefinition:e}),{...H}):{error:ef}:{error:_e}}function zSe({drawDefinition:t,drawSize:e}){if(!t)return{error:_e};let i=oP({stage:Er,stageSequence:1,drawDefinition:t,drawSize:e});return i.error?i:(ti({drawDefinition:t}),{...H})}function o8(t){return zSe(t)}function l8({tournamentRecord:t,drawDefinition:e,event:i,structureId:r}){if(!e)return{error:_e};let n=e.structures?.find(s=>s.stage===We&&s.structureId===r);if(!n)return{error:Ii};if(n.matchUps?.some(({matchUpStatus:s,score:o})=>cr({score:o})??Yi.includes(s)))return{error:kw};let a=n.matchUps?.map(({matchUpId:s})=>s)||[];return n.positionAssignments=[],n.seedAssignments=[],n.matchUps=[],Pu({tournamentId:t?.tournamentId,action:"resetVoluntaryConsolationStructure",matchUpIds:a,drawDefinition:e}),ti({tournamentId:t?.tournamentId,eventId:i?.eventId,drawDefinition:e,structureIds:[n.structureId]}),{...H}}var qSe="qualifierDrawPositionAssignment",YSe="withdrawParticipantAtDrawPosition",KSe="alternateDrawPositionAssignment",XSe="luckyLoserDrawPositionAssignment",ZH="removeDrawPositionAssignment",u8="swapDrawPositionAssignments",JSe="modifyPairAssignment",QSe="adHocPositionSwap",ZSe="modifyParticipantOtherName",eW="assignDrawPosition",eUe="removeSeededParticipant",tUe="assignDrawPositionBye",iUe="modifySeedAssignment",c8="addPenalty",VL="MODIFY_PAIR",WR="QUALIFIER",jL="ALTERNATE",GL="WITHDRAW",km="ASSIGN",UO="REMOVE",HL="LUCKY",tD="REMOVE_SEED",zR="SWAP",lP="NICKNAME",Vy="SEED_VALUE",uI="PENALTY",rUe={MODIFY_PAIR_ASSIGNMENT:VL,QUALIFYING_PARTICIPANT:WR,ALTERNATE_PARTICIPANT:jL,WITHDRAW_PARTICIPANT:GL,ASSIGN_PARTICIPANT:km,LUCKY_PARTICIPANT:HL,REMOVE_ASSIGNMENT:UO,SWAP_PARTICIPANTS:zR,ADD_NICKNAME:lP,REMOVE_SEED:tD,ADD_PENALTY:uI,ASSIGN_BYE:"BYE",SEED_VALUE:Vy};function d8({tournamentRecord:t,drawDefinition:e,drawPositions:i,structureId:r,event:n}){if(!e)return{error:_e};if(!r)return{error:Va};if(i?.length!==2)return{error:ie,drawPositions:i};let a=kr({drawDefinition:e}),{matchUps:s}=Qi({inContext:!0,drawDefinition:e,matchUpsMap:a}),{structure:o}=et({drawDefinition:e,structureId:r});if(!o)return{error:Ii};let l=Tt({tournamentRecord:t,drawDefinition:e,event:n}).appliedPolicies??{},u;if(o.structureType===fn?u=sUe({inContextDrawMatchUps:s,tournamentRecord:t,drawDefinition:e,drawPositions:i,matchUpsMap:a,structure:o,event:n}):u=nUe({inContextDrawMatchUps:s,tournamentRecord:t,drawDefinition:e,drawPositions:i,matchUpsMap:a,structure:o,event:n}),u.error)return u;if(ZF({structure:o,drawPositions:i}),qw({appliedPolicies:l,drawDefinition:e,positionAction:{name:u8,drawPositions:i,structureId:r}}),fc({tournamentId:t?.tournamentId,drawDefinition:e,structure:o,event:n}),n.eventType===ya){let c=Nt({matchUpFilters:{matchUpTypes:[ka]},inContext:!0,structure:o}).matchUps.filter(p=>p.drawPositions?.some(f=>i.includes(f))),d=Nt({matchUpFilters:{matchUpTypes:[ka]},structure:o}).matchUps;c.forEach(p=>{(p.sides||[]).forEach(f=>{let m=f?.drawPosition;if(i.includes(m)){let h=f.participantId,g=d.find(({matchUpId:v})=>v===p.matchUpId),I=p?.sides?.reduce((v,w,y)=>w.drawPosition===m?y:v,void 0);AL({inContextTargetMatchUp:p,drawPositionSideIndex:I,teamParticipantId:h,tournamentRecord:t,drawDefinition:e,matchUp:g,event:n})}})})}return ti({drawDefinition:e,structureIds:[r]}),{...H}}function nUe({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPositions:r,matchUpsMap:n,structure:a,event:s}){let o=a?.positionAssignments.filter(u=>r?.includes(u.drawPosition));if(!o)return{error:ie,structure:a,info:"Missing positionAssignments"};if(o.filter(({bye:u})=>u).length===2)return{...H};if(o.filter(({qualifier:u})=>u).length===2)return{...H};let l=o.some(({qualifier:u})=>u);return o.some(({bye:u})=>u)&&!l?p8({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:o,matchUpsMap:n,structure:a,event:s}):aUe({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:o,matchUpsMap:n,structure:a,event:s})}function p8({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:r,matchUpsMap:n,structure:a,event:s}){let o=r.find(({bye:m})=>m),l=r.find(({participantId:m})=>m),u=o.drawPosition,{participantId:c,drawPosition:d}=l,{structureId:p}=a,f=Pb({drawPosition:u,inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:p,matchUpsMap:n});return f.error||(f=Pb({drawPosition:d,inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:p,matchUpsMap:n}),f.error)||(Wa({drawPosition:d,tournamentRecord:e,drawDefinition:i,structureId:p,matchUpsMap:n,event:s}),f=ol({drawPosition:u,inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:p,participantId:c,matchUpsMap:n,event:s}),f.error)?f:{...H}}function aUe({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:r,matchUpsMap:n,structure:a,event:s}){let o=Object.assign({},...r.map((l,u)=>{let{drawPosition:c}=l,d={...r[1-u],drawPosition:c};return{[c]:d}}));return a.positionAssignments=a.positionAssignments.map(l=>o[l.drawPosition]||l),OL({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,matchUpsMap:n,assignments:r,structure:a,event:s}),{...H}}function sUe({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPositions:r,matchUpsMap:n,structure:a,event:s}){let o=a.structures?.reduce((u,c)=>{let d=c?.positionAssignments.filter(p=>r?.includes(p.drawPosition));return d&&u.push(...d),u},[]);if(o.filter(({bye:u})=>u).length===2)return{...H};if(o.filter(({qualifier:u})=>u).length===2)return{...H};OL({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,matchUpsMap:n,assignments:o,structure:a,event:s});let l=o.some(({qualifier:u})=>u);if(o.some(({bye:u})=>u)&&!l)p8({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:o,matchUpsMap:n,structure:a,event:s});else{let u=ke(o,!1,!0);o.forEach((c,d)=>{let p=u[1-d].participantId;c.qualifier=u[1-d].qualifier,c.participantId=p})}return{...H}}function f8({tournamentRecord:t,drawDefinition:e,participantId:i,structureId:r}){let n="removeSeededParticipant";if(!t)return{error:Ie};if(!e)return{error:_e};let a=(e.structures??[]).find(s=>s.structureId===r);return a?!a.stage||![xe,We].includes(a.stage)||a.stage===xe&&a.stageSequence!==1?z({result:{error:Qp},stack:n}):a.seedAssignments?.find(s=>s.participantId===i)?{...H}:z({info:"participant not seeded",result:{error:_r},context:{participantId:i}}):z({result:{error:Ii},stack:n})}function vS({targetEntryRound:t=1,finishingPositions:e,sourceRoundNumber:i,sourceStructureId:r,targetStructureId:n,linkType:a=ru}){return!r||!n?{error:Va}:{link:Ve({linkType:a,source:{roundNumber:i,structureId:r,finishingPositions:e},target:{feedProfile:Cs,roundNumber:t,structureId:n}})}}function Sh({matchUp:t,tieFormat:e,isMock:i,uuids:r}){let{collectionDefinitions:n}=e??{};return{tieMatchUps:(n??[]).map(a=>yS({matchUp:t,collectionDefinition:a,uuids:r,isMock:i})).filter(Boolean).flat()}}function yS({collectionPositionOffset:t=0,collectionDefinition:e,matchUpsLimit:i,matchUp:r,isMock:n,uuids:a}){let{matchUpCount:s,matchUpType:o,collectionId:l,processCodes:u}=e||{},c=i??s??0,d=p=>{if(!n&&!r?.isMock)return a?.pop()??Et();let f=e?.collectionId;return a?.pop()??`${r?.matchUpId}-${f}-TMU-${p+1}`};return Re(0,c).map(p=>{let f=t+p+1;return{sides:[{sideNumber:1},{sideNumber:2}],matchUpId:d(p),matchUpStatus:Fi,collectionPosition:f,collectionId:l,processCodes:u,matchUpType:o,isMock:n}})}function WL({roundPosition:t,roundNumber:e,idPrefix:i,uuids:r}){return i?`${i}-${e}-${t}`:r?.pop()||Et()}function uP({includeMatchUpType:t,matchUpType:e,roundNumber:i,matchUps:r,idPrefix:n,isMock:a,uuids:s,nodes:o}){let l=0,u=[],c=1,d=i-1,p=o?.length;for(;l<(p||0);){let f=o?.[l],m=o?.[l+1];d&&(f.roundNumber=d),m&&d&&(m.roundNumber=d);let h=WL({roundPosition:c,roundNumber:i,idPrefix:n,uuids:s}),g={roundPosition:c,children:[f,m],matchUpId:h};u.push(g);let I={drawPositions:g.children.map(v=>v?.drawPosition).filter(Boolean),matchUpStatus:Fi,matchUpId:g.matchUpId,roundPosition:c,roundNumber:i};t&&e&&(I.matchUpType=e),a&&(I.isMock=!0),r.push(I),c++,l+=2}return{roundNodes:u,matchUps:r}}function ll({finishingPositionOffset:t,finishingPositionLimit:e,qualifyingRoundNumber:i,qualifyingPositions:r,matchUpType:n,roundLimit:a,idPrefix:s,drawSize:o,isMock:l,uuids:u}){if(isNaN(o)||o<2||r&&o<=r)return{matchUps:[],roundsCount:0};if(r&&(!Uo(o)||o%r)){let g=r;for(;g<o;)g=2*g;o=g}let c=r&&!(o%2)&&(!isNaN(r)||i&&!isNaN(i))&&(o/r===Math.round(o/r)||i&&o/i===Math.round(o/i));if(!Uo(o)&&!c)return{matchUps:[],roundsCount:0};let d=Re(1,o+1).map(g=>({drawPosition:g})),p,f=[],m=1;for({roundNodes:p,matchUps:f}=uP({matchUpType:n,roundNumber:m,idPrefix:s,matchUps:f,isMock:l,nodes:d,uuids:u}),m++,a=a??i;p.length>1;)r&&p.length===r&&(a=m-1),{roundNodes:p,matchUps:f}=uP({nodes:p,matchUpType:n,roundNumber:m,idPrefix:s,matchUps:f,isMock:l,uuids:u}),m++;let h=m-1;return f=oS({finishingPositionOffset:t,finishingPositionLimit:e,roundsCount:h,roundLimit:a,matchUps:f}),a?f=f.filter(g=>a&&(g.roundNumber??0)<=a):a=m-1,{drawSize:o,matchUps:f,roundsCount:h,roundLimit:a}}function oUe(t,e){return t.drawDefinition?t.drawSize&&!ot(t.drawSize)||t.participantsCount&&!ot(t.participantsCount)||t.qualifyingPositions&&!ot(t.qualifyingPositions)?z({result:{error:ie},stack:e}):t.drawSize?t.qualifyingPositions&&t.qualifyingPositions>=t.drawSize?z({result:{error:ie},context:{drawSize:t.drawSize,qualifyingPositions:t.qualifyingPositions},stack:e}):null:z({result:{error:Cw},context:{drawSize:t.drawSize},stack:e}):z({result:{error:_e},stack:e})}function lUe(t,e,i){let{structureProfiles:r}=HR({drawDefinition:t});return r[e]||z({result:{error:Ii},context:{targetStructureId:e},stack:i})}function uUe(t){let{maxRoundNumber:e,structures:i,groupCount:r}=mS(t);return{qualifiersCount:r,roundLimit:e,structure:i[0],finishingPositions:[1]}}function cUe(t){let{drawSize:e,matchUps:i,roundLimit:r,roundsCount:n}=ll(t);r||(r=n);let a=ns({structureName:t.structureName,structureId:t.structureId,qualifyingRoundNumber:r,stage:We,matchUpFormat:t.matchUpFormat,stageSequence:t.stageSequence,matchUpType:t.matchUpType,roundLimit:r,matchUps:i});t.roundTarget&&xt({extension:{name:Tl,value:t.roundTarget},element:a});let s=i?.filter(o=>o.roundNumber===r)?.length??0;return{drawSize:e,structure:a,matchUps:i,roundLimit:r,qualifiersCount:s}}function zL(t){let e="generateQualifyingStructure",i=oUe(t,e);if(i)return i;let r=t.drawSize??A1(t.participantsCount),{hasExistingDrawDefinition:n,qualifyingRoundNumber:a,qualifyingPositions:s,targetStructureId:o,structureOptions:l,appliedPolicies:u,qualifyingOnly:c,drawDefinition:d,matchUpFormat:p,structureName:f,structureId:m,roundTarget:h,tieFormat:g,drawType:I,idPrefix:v,isMock:w,uuids:y}=t,b=lUe(d,o,e);if(b?.error)return b;let S=d.matchUpType,U=1,T=h?`${h}-`:"",P=typeof b=="object"&&"stage"in b&&b.stage===We,D=u?.[uc]?.namingConventions?.pre??Xye[uc]?.namingConventions?.pre,E=P&&D?`${D}-`:"",R=f??(T?`${E}${Xr(We)} ${T}`:`${E}${Xr(We)}`),C,M,N,A,O;if(I===Ks){let x=uUe({structureName:f??R,structureId:m??y?.pop(),hasExistingDrawDefinition:n,stage:We,structureOptions:l,appliedPolicies:u,qualifyingOnly:c,stageSequence:U,matchUpType:S,roundTarget:h,tieFormat:g,idPrefix:v,drawSize:r,isMock:w,uuids:y});A=x.qualifiersCount,N=x.roundLimit,C=x.structure,O=x.finishingPositions}else{let x=cUe({qualifyingRoundNumber:a,qualifyingPositions:s,matchUpType:S,idPrefix:v,drawSize:r,isMock:w,uuids:y,structureName:f??R,structureId:m??y?.pop(),matchUpFormat:p,stageSequence:U,roundTarget:h});r=x.drawSize,C=x.structure,N=x.roundLimit,A=x.qualifiersCount}let k=I===Ks?iu:ru,F=C&&N&&vS({sourceStructureId:C.structureId,sourceRoundNumber:N,targetStructureId:o,finishingPositions:O,linkType:k})?.link;return g&&(M=Nt({structure:C})?.matchUps||[],M?.forEach(x=>{let{tieMatchUps:L}=Sh({tieFormat:g,matchUp:x,isMock:w});Object.assign(x,{tieMatchUps:L,matchUpType:S})})),{qualifyingDrawPositionsCount:r,qualifiersCount:A,...H,structure:C,link:F}}function m8(t){if(!t.tournamentRecord)return{error:Ie};let e=dUe(t);return e.error,e}function dUe(t){if(!t.drawDefinition)return{error:_e};if(!t.targetStructureId)return{error:Va};let e=zL(t);if(e.error)return e;let{structure:i,link:r}=e;return!i||!r?{error:ie}:$L({tournamentRecord:t.tournamentRecord,drawDefinition:t.drawDefinition,structure:i,link:r})}function h8(t){let e=Ge(t,[{[mn]:!0,[fR]:!0,[Ul]:!0},{[Qve]:!0,[Wr]:d=>Number.isInteger(d)&&d>0},{[Wr]:d=>Array.isArray(d)&&d.length===2&&d.every(ri),[Fa]:ga,participantIds:!0}]);if(e.error)return e;let{drawDefinition:i,structureId:r,tournamentRecord:n,event:a}=t,{structure:s}=et({drawDefinition:i,structureId:r});if(!s)return{error:Ii};if(!Vn({structure:s}))return{error:Qp};let o=d=>d.sides?.map(p=>p.participantId).some(p=>t.participantIds.includes(p)),l=d=>d.roundNumber===t.roundNumber,u=d=>!cr(d),c=(s?.matchUps??[]).filter(l).filter(u).filter(o);if(c.length!==2)return{error:ga};for(let d of c){let p=d?.sides?.find(f=>t.participantIds.includes(f?.participantId));if(p){let f=t.participantIds.find(m=>m!==p?.participantId);p.participantId=f,St({tournamentId:n?.tournamentId,eventId:a?.eventId,drawDefinition:i,matchUp:d})}}return ti({drawDefinition:i,structureIds:[r]}),{...H}}function pUe({includeMatchUpType:t,drawPosition:e,roundNumber:i,matchUpType:r,idPrefix:n,matchUps:a,isMock:s,uuids:o,nodes:l,fed:u}){let c=l.length,d=e?e-c:void 0,p=Re(0,c).map(h=>d?d+h:void 0),f=[];for(let h=0;h<c;h++){let g=p.shift(),I={drawPosition:g,fed:u+1,feed:!0},v=l[h];v.roundNumber=i-1;let w=WL({roundPosition:v.roundPosition,roundNumber:i,idPrefix:n,uuids:o}),y={roundPosition:v.roundPosition,drawPositions:[g],matchUpStatus:Fi,roundNumber:i,matchUpId:w};t&&(y.matchUpType=r),s&&(y.isMock=!0),a.push(y);let b={children:[v,I]};f.push(b)}let m=e?e-c:void 0;return{roundNodes:f,matchUps:a,drawPosition:m}}function vd(t){let e=t.drawSize,{feedRoundsProfile:i,feedRounds:r=0,skipRounds:n=0,baseDrawSize:a}=t,{linkFedFinishingRoundNumbers:s,finishingPositionOffset:o,linkFedRoundNumbers:l,feedsFromFinal:u,isConsolation:c,matchUpType:d,idPrefix:p,isMock:f,uuids:m,fmlc:h}=t;a=a??M(e);let g=fUe({drawSize:a}),I=g.length,v=0;if(i?.length)v=i.reduce((N,A)=>N+A,0);else if(e){let N=e-a;i=g.filter(A=>A<=N?(N-=A,!0):!1),v=i.reduce((A,O)=>A+O,0),r=i.length}else n>=I?r=0:u&&(r=I-u,n=0),i=g.filter((N,A)=>u&&!r||r&&A>=n+r||A<n?0:N),v=i.reduce((N,A)=>N+A,0),r=i.length;let w=[...g,...i].sort((N,A)=>A-N),y=w.length,b=[...(l??[]).map(N=>N-1),...(s??[]).map(N=>y-N)].map(N=>w[N]).reduce((N,A)=>N+A,0);v=v-b;let S=0,U=[],T,P=1,D=Re(0,a).map((N,A)=>({drawPosition:A+1+v})),E=v+1;for(let N of g){if({roundNodes:T,matchUps:U}=uP({matchUpType:d,roundNumber:P,idPrefix:p,matchUps:U,isMock:f,nodes:D,uuids:m}),P++,i.includes(N)){let A=va(i)[N],O=Re(0,A),k=y+1-P,F=s?.includes(k)??l?.includes(P);O.forEach(()=>{({roundNodes:T,matchUps:U,drawPosition:E}=pUe({drawPosition:!F&&E||void 0,nodes:T,matchUpType:d,roundNumber:P,idPrefix:p,matchUps:U,isMock:f,uuids:m,fed:S})),P++,S+=1})}D=T}y!==P-1&&console.log("ERROR");let R=a-v;U=oS({finishingPositionOffset:c?R:o,positionsFed:v,roundsCount:y,matchUps:U,fmlc:h});let C=T?.length?T[0]:T;return C&&(C.roundNumber=P-1,C.matchUps=U),{draw:C,matchUps:U,roundsCount:y};function M(N){let A=k1(N);return A>N?A/2:A}}function fUe({drawSize:t}){let e=Math.ceil(Math.log(t)/Math.log(2));return Re(0,e).reverse().map(i=>Math.pow(2,i))}function Vg(t){let{finishingPositionOffset:e=0,addNameBaseToAttributeName:i,playoffStructureNameBase:r,finishingPositionNaming:n,finishingPositionLimit:a,playoffAttributes:s,stageSequence:o=1,exitProfile:l="0",exitProfileLimit:u,roundOffsetLimit:c,roundOffset:d=0,drawDefinition:p,staggeredEntry:f,sequenceLimit:m,stage:h=xe,drawSize:g,idPrefix:I,isMock:v,uuids:w}=t;if(!(!s||!u||s?.[l])||g<2||m&&o>m)return{};let y=[],b=[],S=[],U=t.matchUpType??p?.matchUpType,T=e+1,P=e+g,D=`${T}-${P}`,E=s?.[l],R=r&&`${r} `||"",C=s?.[D]??n?.[D],M=t.structureName||C?.name||E?.name&&(i?`${R}${E?.name}`:E.name)||`${R}${D}`,N=C?.abbreviation??E?.abbreviation,A=t.structureId??E?.structureId??w?.pop(),O={idPrefix:I&&`${I}-${M}-RP`,finishingPositionOffset:e,matchUpType:U,drawSize:g,isMock:v,uuids:w},{matchUps:k}=f?vd(O):ll(O),F=ns({structureAbbreviation:N,stageSequence:o,structureName:M,matchUpType:U,roundOffset:d,structureId:A,matchUps:k,stage:h});y.push(...k),b.push(F);let x=Math.ceil(Math.log(g)/Math.log(2)),L=c?Math.min(c-d,x):(!a||T<a)&&x||0;return g>2&&Re(1,L+1).forEach(V=>$(V)),{structureId:F.structureId,matchUps:y,structureName:M,structures:b,links:S,...H};function $(V){let _=g/Math.pow(2,V);if(_<2)return;let B=g/Math.pow(2,V)+e;if(a&&B+1>a)return;let{structures:G,structureId:j,matchUps:K,links:Y}=Vg({finishingPositionOffset:B,exitProfile:`${l}-${V}`,roundOffset:d+V,stageSequence:o+1,drawSize:_,addNameBaseToAttributeName:i,playoffStructureNameBase:r,finishingPositionNaming:n,finishingPositionLimit:a,playoffAttributes:s,exitProfileLimit:u,roundOffsetLimit:c,drawDefinition:p,sequenceLimit:m,matchUpType:U,idPrefix:I,uuids:w,stage:h});if(F.structureId&&j){let X={linkType:nu,source:{roundNumber:V,structureId:F.structureId},target:{roundNumber:1,feedProfile:Ms,structureId:j}};Y&&F&&Y.push(X),Y?.length&&S.push(...Y)}return G?.length&&b.push(...G),K?.length&&y.push(...K),{structureId:j,childLinks:Y,structures:b}}}function qL({drawDefinition:t,matchUpsMap:e,structureId:i}){let r=et({drawDefinition:t,structureId:i});if(r.error)return z({result:r});let{matchUps:n}=Nt({structure:r.structure,matchUpsMap:e});return{...bn({matchUps:n}),matchUps:n,matchUpsMap:e}}function tW({finishingPositions:t,drawDefinition:e,structureId:i}){let{roundProfile:r}=qL({drawDefinition:e,structureId:i});return(r&&Object.keys(r))?.reduce((n,a)=>(g8(r?.[a]).forEach(s=>{t.forEach(o=>{mUe({position:o,rangeDefinition:s})&&(n[o]={roundNumber:a})})}),n),{})}function mUe({position:t,rangeDefinition:e}){if(!Array.isArray(e)||e.reduce((n,a)=>n||isNaN(a),!1))return!1;let[i,r]=e;return Re(i,(r||i)+1).includes(t)}function g8(t){return[rt(t?.finishingPositionRange?.loser||[]),rt(t?.finishingPositionRange?.winner||[])]}function hUe(t){return g8(t).map(e=>Re(e[0],e[1]&&e[1]+1||e[0]+1))}function gv({drawDefinition:t,structureIds:e,matchUpsMap:i}){if(e&&!Array.isArray(e))return{error:ie,context:{structureIds:e}};if(!t)return{error:_e};e=e??(t.structures??[]).filter(a=>a.stage!==We).map(({structureId:a})=>a);let r=e.map(a=>{let{roundProfile:s}=qL({drawDefinition:t,matchUpsMap:i,structureId:a});return(s&&Object.values(s))?.map(hUe).flat()}).flat(),n=r.filter(a=>a?.length===1).sort(ir).flat();return{positionsNotPlayedOff:rt(r.flat()).filter(a=>!n.includes(a)),positionsPlayedOff:n}}function I8({excludeRoundNumbers:t=[],playoffPositions:e=[],drawDefinition:i,structureId:r}){if(!i)return{error:_e};if(!r)return{error:Va};if(!e)return{error:Xe,info:"missing playoffPositions"};let n=gv({drawDefinition:i});if(n.error)return n;let a=n.positionsPlayedOff,s=e.filter(I=>!a.includes(I)),o=tW({finishingPositions:s,drawDefinition:i,structureId:r}),l=Object.values(o).reduce((I,v)=>I.includes(v.roundNumber)?I:I.concat(v.roundNumber),[]).map(I=>Ye(I)).filter(I=>!t.includes(I)),u=tW({finishingPositions:a,drawDefinition:i,structureId:r}),c=u?Object.values(u):[],d=u?c.reduce((I,v)=>I.includes(v.roundNumber)?I:I.concat(v.roundNumber),[]).map(I=>Ye(I)):[],p=l.filter(I=>!d.includes(I)).sort(ir),{roundProfile:f}=qL({drawDefinition:i,structureId:r}),m=p.map(I=>{let v=f?.[I].finishingPositionRange.loser,[w,y]=v??[0,0];return Re(w,(y||w)+1)}).flat().sort(ir),{playoffRoundsRanges:h}=gUe({playoffSourceRounds:p,roundProfile:f}),g=[...p,...d];return{playoffPositionsReturned:m,playedOffSourceRounds:d,playoffRoundsRanges:h,playoffSourceRounds:p,sourceRounds:g,roundProfile:f}}function gUe({playoffSourceRounds:t,roundProfile:e}){return{playoffRoundsRanges:t.map(i=>{let r=e[i].finishingPositionRange.loser,[n,a]=r,s=Re(n,(a||n)+1);return{finishingPositionRange:r.join("-"),finishingPositions:s,roundNumber:i}})}}function bS({drawDefinition:t,structureId:e}){if(!t)return{error:_e};let{matchUps:i,matchUpsMap:r}=Rn({inContext:!0,drawDefinition:t}),{positionsNotPlayedOff:n,positionsPlayedOff:a}=gv({drawDefinition:t,matchUpsMap:r}),{structures:s}=Js({drawDefinition:t}),o=s.filter(u=>!e&&u.stage!==Er||u.structureId===e),l={};for(let u of o){let c=u?.structureId,d=IUe({playoffPositions:n,drawDefinition:t,structure:u,matchUps:i}),{error:p,...f}=d;if(p)return d;l[c]={structureId:c,...f}}return e?{positionsPlayedOff:a,...l[e]}:{availablePlayoffProfiles:Object.values(l),availablePlayoffRounds:Object.values(l),positionsPlayedOff:a}}function IUe({playoffPositions:t,drawDefinition:e,structure:i,matchUps:r}){let n=i?.structureId,{links:a}=uv({drawDefinition:e,structureId:n});if(i.structureType===fn||i.structures){let f=Yt({structure:i})?.positionAssignments?.length,m=i.structures.length,h=(f??0)/m,g=a.source?.flatMap(({source:D})=>D?.finishingPositions||[])||[],I=Re(1,h+1).filter(D=>!g.includes(D)),v=r.find(D=>D.containerStructureId===n&&D.finishingPositionRange)?.finishingPositionRange?.winner||[0,1],w=a?.source.map(({target:D})=>D.structureId),{positionsPlayedOff:y=[],positionsNotPlayedOff:b=[]}=gv({structureIds:w,drawDefinition:e}),S=new Set([...y,...b]),U=Re(v[0],v[1]+1).filter(D=>!S.has(D)),T=yr(U,U.length/I.length),P=I.map((D,E)=>{let R=T[E],C=[Math.min(...R||[]),Math.max(...R||[])].join("-");return{finishingPosition:D,finishingPositions:R,finishingPositionRange:C}});return{positionsNotPlayedOff:U,playoffFinishingPositionRanges:P,finishingPositionsAvailable:I,finishingPositionsPlayedOff:g,positionsPlayedOff:y,groupCount:m,groupSize:h}}let s=a?.source?.filter(f=>f.linkCondition!==al).map(f=>f.source?.roundNumber)||[],o=a?.source?.filter(f=>f.linkCondition===al).map(f=>f.source?.roundNumber)||[],l=I8({excludeRoundNumbers:s,playoffPositions:t,drawDefinition:e,structureId:n}),u=l?.playoffSourceRounds?[...l?.playoffSourceRounds||[]]:void 0,c=[...l?.playoffRoundsRanges||[]],{roundProfile:d,error:p}=l;for(let f of o){let m=a?.source.find(w=>w.source.roundNumber===f),h=m?.target.roundNumber,g=m?.target.structureId,I=r.filter(({roundNumber:w,structureId:y})=>y===g&&w===h),v=I.filter(({sides:w})=>w.find(y=>y.participantFed&&!y.participantId)).length;if(u&&v===I.length){u.push(f);let w=d?.[f]?.finishingPositionRange?.loser;if(w){let y=Math.min(...w),b=y+v,S=Re(y,b),U={finishingPositionRange:[y,b-1].join("-"),finishingPositions:S,roundNumber:f};c.push(U)}}}return u&&u.sort(ir),c.sort((f,m)=>f.roundNumber-m.roundNumber),{playoffRounds:u,playoffRoundsRanges:c,error:p}}function vUe({playoffGroups:t,drawDefinition:e,structureId:i}){if(!e)return{error:_e};if(!ri(i)||!Array.isArray(t))return{error:ie};let r=t.map(({finishingPositions:n})=>n).flat();return{positionRangeMap:bS({drawDefinition:e,structureId:i}).playoffFinishingPositionRanges?.filter(n=>r.includes(n.finishingPosition))?.reduce((n,a)=>(n[a.finishingPosition]=a,n),{})}}function v8(t){let{finishingPositionOffset:e=0,playoffAttributes:i,stageSequence:r=1,staggeredEntry:n,structureName:a,stage:s=xe,matchUpType:o,structureId:l,idPrefix:u,drawSize:c,isMock:d,uuids:p}=t,f={finishingPositionOffset:e,matchUpType:o,drawSize:c,idPrefix:u,isMock:d,uuids:p},{matchUps:m}=n?vd(f):ll(f),h=ns({structureName:a||i?.["0"]?.name||Xr(xe),structureId:l||p?.pop(),stageSequence:r,matchUpType:o,matchUps:m,stage:s}),g=[h],I=[];if(c>2){let v=c/2,{matchUps:w}=ll({finishingPositionOffset:e+v,idPrefix:u&&`${u}-c`,drawSize:v,matchUpType:o,isMock:d}),y=Xr(Zr),b=i?.["0-1"]?.name??t.consolationStructureName??(a?`${a} ${y}`:y),S=ns({structureName:b,matchUps:w,structureId:p?.pop(),stage:Zr,stageSequence:1,matchUpType:o});g.push(S);let U={linkType:nu,source:{roundNumber:1,structureId:h.structureId},target:{roundNumber:1,feedProfile:Ms,structureId:S.structureId}};I.push(U)}return{...H,structures:g,links:I}}function y8({consolationStructure:t,roundOffset:e=0,mainStructure:i,roundsCount:r,feedPolicy:n,fmlc:a}){let s=t.matchUps.reduce((u,c)=>(c.drawPositions||[]).filter(Boolean).length&&!u.includes(c.roundNumber)?u.concat(c.roundNumber):u,[]),o=n?.roundGroupedOrder||[],l=n?.roundFeedProfiles;return Re(1+e,r+1+e).map(u=>{let c=l?.[u-1]?l[u-1]:u%2&&Ms||Pp,d=u-e<=2?u-e:(u-e-2)*2+2,p={linkType:nu,source:{roundNumber:u,structureId:i.structureId},target:{feedProfile:c,roundNumber:d,structureId:t.structureId}},f=o[u-1];return f&&(p.target.groupedOrder=f),ra()&&(p.source.structureName=i.structureName,p.target.structureName=t.structureName),u===2&&a&&(p.linkCondition=al,p.target.feedProfile=Ms),s.includes(d)?p:void 0}).filter(Boolean)}function b8(t){let{playoffStructureNameBase:e,finishingPositionOffset:i,stageSequence:r=1,playoffAttributes:n,structureNameMap:a,staggeredEntry:s,stage:o=xe,matchUpType:l,structureId:u,drawSize:c,idPrefix:d,isMock:p,uuids:f}=t,m={finishingPositionOffset:i,matchUpType:l,drawSize:c,idPrefix:d,isMock:p,uuids:f},{matchUps:h,roundsCount:g}=s?vd(m):ll(m),I=t.structureName??n?.["0"]?.name??Xr(xe),v=ld({structureId:u||f?.pop(),structureName:I,stageSequence:r,matchUpType:l,matchUps:h,stage:o}),w=[v],y=[];if(c>2){let b=[0,2].slice(0,c/16).map((S,U)=>{let T=U+1,{consolationStructure:P}=yUe({idPrefix:d&&`${d}-c${U}`,structureId:f?.pop(),playoffStructureNameBase:e,playoffAttributes:n,structureNameMap:a,stageSequence:T,roundOffset:S,matchUpType:l,drawSize:c,isMock:p,index:U,uuids:f});w.push(P);let D=y8({consolationStructure:P,roundsCount:2,mainStructure:v,roundOffset:S});return{consolationStructure:P,links:D}}).map(S=>S.links).flat();if(y.push(...b),c>=4&&c<=16||c>32){let{matchUps:S}=ll({idPrefix:d&&`${d}-p3t4`,finishingPositionOffset:2,drawSize:2,matchUpType:l,isMock:p}),U=n?.["3-4"]?.name??Xr(Ui),T=a?.[U]||U,P=e?`${e} ${T}`:T,D=ld({structureId:f?.pop(),matchUps:S,stageSequence:2,stage:Ui,structureName:P,matchUpType:l}),E={linkType:nu,source:{roundNumber:g-1,structureId:v.structureId},target:{structureId:D.structureId,feedProfile:Ms,roundNumber:1}};w.push(D),y.push(E)}}return{structures:w,links:y,...H}}function yUe({playoffStructureNameBase:t,stageSequence:e=1,playoffAttributes:i,structureNameMap:r,roundOffset:n=0,matchUpType:a,structureId:s,idPrefix:o,drawSize:l,isMock:u,index:c,uuids:d}){let p=l/(2*Math.pow(2,n)),{matchUps:f,roundsCount:m}=vd({finishingPositionOffset:p,baseDrawSize:p,isConsolation:!0,feedRounds:1,matchUpType:a,idPrefix:o,isMock:u,uuids:d}),h=c===0&&i?.["0-1"]?.name||c===1&&i?.["0-3"]?.name||`${Xr(Zr)} ${c+1}`,g=r?.[h]||h,I=t?`${t} ${g}`:g;return{consolationStructure:ld({matchUps:f,stage:Zr,structureName:I,stageSequence:e,matchUpType:a,structureId:s}),consolationRoundsCount:m}}function Ff(t){let{finishingPositionOffset:e,stageSequence:i=1,playoffAttributes:r,feedsFromFinal:n,staggeredEntry:a,structureName:s,stage:o=xe,structureId:l,matchUpType:u,skipRounds:c,feedRounds:d,idPrefix:p,drawSize:f,isMock:m,uuids:h,fmlc:g}=t,I=t.feedPolicy||t.policyDefinitions?.[nI]||t.appliedPolicies?.[nI],v={finishingPositionOffset:e,matchUpType:u,skipRounds:c,drawSize:f,idPrefix:p,isMock:m,uuids:h},{matchUps:w}=a?vd(v):ll(v),y=ns({structureName:s||r?.["0"]?.name||Xr(xe),structureId:l||h?.pop(),stageSequence:i,matchUpType:u,matchUps:w,stage:o}),b=[y],S=[],U=f/2,{matchUps:T,roundsCount:P}=vd({finishingPositionOffset:U,idPrefix:p&&`${p}-c`,isConsolation:!0,feedsFromFinal:n,baseDrawSize:U,matchUpType:u,feedRounds:d,skipRounds:c,isMock:m,uuids:h,fmlc:g});if(f>2){let D=r?.["0-1"]?.name??Xr(Zr),E=t.playoffStructureNameBase?`${t.playoffStructureNameBase} ${D}`:D,R=ns({matchUps:T,structureId:h?.pop(),stage:Zr,stageSequence:1,structureName:E,matchUpType:u});b.push(R);let C=y8({consolationStructure:R,mainStructure:y,roundsCount:P,feedPolicy:I,fmlc:g});S.push(...C)}return{...H,structures:b,links:S}}function w8({requireSequential:t=!0,playoffMatchUpFormat:e,playoffAttributes:i,sourceStructureId:r,policyDefinitions:n,stageSequence:a,drawDefinition:s,playoffGroups:o,matchUpType:l,feedPolicy:u,groupCount:c,idPrefix:d,isMock:p,uuids:f}){u=u||n?.[nI];let m="processPlayoffGroups",h=0,g=[],I=[],v=[],{error:w,positionRangeMap:y}=vUe({structureId:r,drawDefinition:s,playoffGroups:o});if(w)return z({result:{error:w},stack:m});if(!(!y||o?.every(b=>{let{finishingPositions:S=[]}=b;if(!S.length)return!1;let U=[...S].sort(ir).map((T,P)=>(S[P+1]||T)-T).every(T=>T<2);return(!t||U)&&S.every(T=>y[T])})))return z({context:{validFinishingPositions:Object.values(y)},result:{error:ie},stack:m});for(let b of o){let S=b.finishingPositions,U=y&&S.flatMap(N=>y[N]?.finishingPositions??[]),T=c*S.length,P=XI(T),D=P===2&&Yo||b.drawType||Yo;U&&(h=Math.min(...U)-1);let E=U&&`${Math.min(...U)}-${Math.max(...U)}`,R=b.structureName||E&&b.playoffAttributes?.[E]?.name||b.playoffAttributes?.["0"]?.name,C={addNameBaseToAttributeName:b.addNameBaseToAttributeName,playoffStructureNameBase:b.playoffStructureNameBase,finishingPositionNaming:b.finishingPositionNaming,finishingPositionLimit:b.finishingPositionLimit,structureId:b.structureId??f?.pop(),playoffAttributes:b.playoffAttributes,structureNameMap:b.structureNameMap,sequenceLimit:b.sequenceLimit,structureName:R,idPrefix:d&&`${d}-po`,appliedPolicies:n,finishingPositionOffset:h,stage:Ui,stageSequence:a,matchUpType:l,drawSize:P,isMock:p,uuids:f},M=({playoffStructures:N,playoffLinks:A})=>{let[O]=N,k=vT({playoffStructureId:O.structureId,finishingPositions:S,sourceStructureId:r});v.push(k,...A),I.push(...N),g.push({structureId:O.structureId,finishingPositions:S}),h+=T};if(D===Yo){let{matchUps:N}=ll({finishingPositionLimit:h+T,idPrefix:d&&`${d}-po`,finishingPositionOffset:h,matchUpType:l,drawSize:P,isMock:p,uuids:f}),A=ns({structureId:b.structureId??f?.pop(),matchUpFormat:e,stage:Ui,structureName:R,stageSequence:a,matchUps:N});I.push(A);let O=vT({playoffStructureId:A.structureId,finishingPositions:S,sourceStructureId:r});v.push(O),h+=T,g.push({structureId:A.structureId,finishingPositions:S})}else if([eI,tI,Ui].includes(D)){let N={playoffAttributes:b.playoffAttributes??i,playoffStructureNameBase:b.playoffStructureNameBase,structureId:b.structureId??f?.pop(),structureName:b.structureName,idPrefix:d&&`${d}-po`,addNameBaseToAttributeName:!0,finishingPositionOffset:h,stage:Ui,roundOffset:0,stageSequence:a,drawSize:P,isMock:p,uuids:f};D===eI?Object.assign(N,{playoffAttributes:b?.playoffAttributes??i??bF,roundOffsetLimit:3}):D===tI&&Object.assign(N,{playoffAttributes:b?.playoffAttributes??i??wF,roundOffsetLimit:2});let A=Vg(N);if(A.error)return A;if(A.links?.length&&v.push(...A.links),A.structures?.length&&I.push(...A.structures),I.sort(ch),A.structureId){let O=vT({playoffStructureId:A.structureId,finishingPositions:S,sourceStructureId:r});v.push(O),g.push({structureId:A.structureId,finishingPositions:S})}h+=T}else if([iI,Bw,vb,Ib,gb,yb].includes(D)){let N=[f?.pop(),f?.pop()],A={playoffStructureNameBase:b.playoffStructureNameBase,structureId:b.structureId??f?.pop(),playoffAttributes:b.playoffAttributes,idPrefix:d&&`${d}-po`,finishingPositionOffset:h,uuids:N,stage:Ui,structureName:R,matchUpType:l,feedPolicy:u,drawSize:P,isMock:p},O={[iI]:{fmlc:!0,feedRounds:1},[yb]:{feedRounds:1},[vb]:{feedsFromFinal:3},[Ib]:{feedsFromFinal:2},[gb]:{feedsFromFinal:1}};Object.assign(A,O[D]||{});let{structures:k,links:F}=Ff(A),[x]=k,L=vT({playoffStructureId:x.structureId,finishingPositions:S,sourceStructureId:r});v.push(L,...F),I.push(...k),g.push({structureId:x.structureId,finishingPositions:S}),h+=T}else if([Ks].includes(D)){let{structures:N,links:A}=mS({...C,structureOptions:b.structureOptions||{groupSize:4}});M({playoffStructures:N,playoffLinks:A})}else if([$w].includes(D)){let{structures:N,links:A}=v8(C);M({playoffStructures:N,playoffLinks:A})}else if([zve].includes(D)){let{structures:N,links:A}=b8(C);M({playoffStructures:N,playoffLinks:A})}else if([na].includes(D)){let N=ns({structureId:b.structureId??f?.pop(),structureName:b.structureName,finishingPosition:KT,stage:Ui,stageSequence:a,matchUps:[]});M({playoffStructures:[N],playoffLinks:[]})}}return{finishingPositionTargets:g,positionRangeMap:y,structures:I,links:v}}function vT({playoffStructureId:t,finishingPositions:e,sourceStructureId:i}){return{linkType:iu,source:{structureId:i,finishingPositions:e},target:{structureId:t,feedProfile:Cs,roundNumber:1}}}function bUe(t){let e="generateAndPopulateRRplayoffStructures";if(!t.playoffGroups)return z({result:{error:Xe},info:"playoffGroups required",stack:e});let{sourceStructureId:i,requireSequential:r,tournamentRecord:n,drawDefinition:a,playoffGroups:s,groupCount:o,groupSize:l,event:u}=t,c=w8({requireSequential:r,sourceStructureId:i,playoffGroups:s,groupCount:o,...t});if(c.error)return z({result:c,stack:e});let{structures:d=[],links:p=[],finishingPositionTargets:f,positionRangeMap:m}=c,h=f?.flatMap(({finishingPositions:T})=>T).flatMap(T=>m[T].finishingPositions);a.structures.push(...d),a.links.push(...p);let{matchUps:g,matchUpsMap:I}=Qi({inContext:!0,drawDefinition:a}),v=new Set(d.map(({structureId:T})=>T)),w=g?.filter(({structureId:T})=>v.has(T)).map(Ir),y=I?.drawMatchUps?.filter(({matchUpId:T})=>w?.includes(T));if(y?.length){let T=vn({drawDefinition:a,event:u})?.tieFormat;T&&y.forEach(P=>{let{tieMatchUps:D}=Sh({isMock:t.isMock,tieFormat:T,matchUp:P});Object.assign(P,{tieMatchUps:D,matchUpType:ka})})}let{positionAssignments:b}=Yt({structureId:i,drawDefinition:a}),S={};b?.forEach(T=>{let P=mt({element:T,name:pc})?.extension?.value?.groupOrder;P&&(S[P]||(S[P]=[]),S[P].push(T.participantId))});let U=hv({provisionalPositioning:t.provisionalPositioning,structureId:i,applyPositioning:!0,event:t.event,tournamentRecord:n,drawDefinition:a});return U.error&&U.error?.code!==O1.code?z({result:U,stack:e}):{structures:d,links:p,positionsPlayedOff:h,drawDefinition:a,...H}}function YL({positionAssignments:t,tournamentRecord:e,drawDefinition:i,matchUpFormat:r,matchUps:n,event:a}){if(!Ga(n))return{error:ie};if(!t)return{error:ie};let{policyDefinitions:s}=Fc({policyTypes:[NF],tournamentRecord:e,drawDefinition:i,event:a}),{subOrderMap:o}=yL({positionAssignments:t}),l=n.length?Ih({policyDefinitions:s,matchUpFormat:r,subOrderMap:o,matchUps:n}):void 0;if(l?.error)return l;let{participantResults:u={},bracketComplete:c,report:d}=l??{},p=Object.keys(u);return t.forEach(f=>{let{participantId:m}=f;if(p.includes(m)){let h={value:u[m],name:pc};xt({element:f,extension:h}),u[m].ties||En({element:f,name:aI})}else En({element:f,name:pc}),En({element:f,name:aI})}),ti({drawDefinition:i}),{...H,participantResults:u,bracketComplete:c,report:d}}function S8({matchUps:t,matchUpId:e}){return{matchUp:(t||[]).find(i=>i.matchUpId===e)}}function di(t){let e=Ge(t,[{[mn]:!0,[Ul]:!0}]);if(e.error)return e;let{tournamentParticipants:i,afterRecoveryTimes:r,contextProfile:n,drawDefinition:a,matchUpsMap:s,matchUpId:o,inContext:l,context:u,event:c}=t,{structures:d=[]}=Js({drawDefinition:a}),p=t.contextContent||n&&Lc({contextProfile:n,drawDefinition:a});for(let f of d){let{matchUps:m}=Nt({tournamentParticipants:i,afterRecoveryTimes:r,contextContent:p,drawDefinition:a,contextProfile:n,matchUpsMap:s,inContext:l,structure:f,context:u,event:c}),{matchUp:h}=S8({matchUps:m,matchUpId:o});if(h)return{matchUp:h,structure:f}}return{error:un}}function qR(t){return!bt(t)||!t.notes?{error:Xe}:bt(t.element)?!ri(t.notes)&&!t.notes?.testing?{error:ie}:(Object.assign(t.element,{notes:t.notes}),{...H}):{error:ie}}function KL(t){return bt(t)?bt(t.element)?(t.element.notes&&delete t.element.notes,{...H}):{error:ie}:{error:Xe}}var YR={matchUpStatus:Fi,matchUpStatusCodes:[],score:{scoreStringSide1:"",scoreStringSide2:"",sets:void 0},matchUpFormat:void 0,winningSide:void 0};function yo(t){let e="modifyMatchUpScore",i=t.matchUpFormat,r=t.matchUp,n,{matchUpStatusCodes:a,tournamentRecord:s,drawDefinition:o,matchUpStatus:l,removeScore:u,winningSide:c,matchUpId:d,event:p,notes:f,score:m}=t,h=t.appliedPolicies&&Object.keys(t.appliedPolicies).length?t.appliedPolicies:Tt({policyTypes:[Po],tournamentRecord:s,drawDefinition:o,structure:n,event:p})?.appliedPolicies,g=r.matchUpType===Zt;if(g&&o){if(d&&r.matchUpId!==d){let U=di({drawDefinition:o,matchUpId:d,event:p});if(!U.matchUp)return{error:un};({matchUp:r,structure:n}=U)}}else r.matchUpId!==d&&console.log("!!!!!");l&&[mi,wi].includes(l)||u?Object.assign(r,{...YR}):m&&(r.score=m);let I=l&&r?.matchUpStatus===Qt&&l!==Qt;l&&(r.matchUpStatus=l),i&&(r.matchUpFormat=i),a&&(r.matchUpStatusCodes=a),c&&(r.winningSide=c),t.removeWinningSide&&(r.winningSide=void 0),!n&&o&&({structure:n}=di({drawDefinition:o,matchUpId:d,event:p})),l&&!r.winningSide&&cr(r)&&!Yi.includes(l)&&![uh,_d,cs].includes(l)&&(r.matchUpStatus=ao);let v;if((I&&r?.processCodes?.length||l===Qt)&&(v=h?.[Po]?.processCodes?.incompleteAssignmentsOnDefault),!r.collectionId){let U=n?.structureType===fn,T=Vn({structure:n});if(sL({drawDefinition:o,structure:n})||T||U){let P=R=>{i=g?"SET1-S:T100":i??r.matchUpFormat??R?.matchUpFormat??o?.matchUpFormat??p?.matchUpFormat;let C=g?{matchUpTypes:[Zt]}:void 0,{matchUps:M}=Nt({afterRecoveryTimes:!1,tournamentRecord:s,inContext:!0,matchUpFilters:C,drawDefinition:o,structure:R,event:p});return T&&(R.positionAssignments=rt(M.flatMap(N=>(N.sides??[]).map(A=>A.participantId)).filter(Boolean)).map(N=>({participantId:N}))),YL({positionAssignments:R.positionAssignments,tournamentRecord:s,drawDefinition:o,matchUpFormat:i,matchUps:M,event:p})},D=U&&n.structures.find(R=>R?.matchUps.find(C=>C.matchUpId===d)),E=P(D||n);if(E.error)return z({result:E,stack:e})}}if(f){let U=qR({element:r,notes:f});if(U.error)return z({result:U,stack:e})}let w=s?.tournamentId,y=gs().topics.includes(DR),b=(y||v)&&kr({drawDefinition:o}),S=b&&Qi({matchUpFilters:{matchUpIds:[d]},nextMatchUps:!0,tournamentRecord:s,inContext:!0,drawDefinition:o,matchUpsMap:b}).matchUps?.[0];if(y&&S&&Nye({tournamentId:w,inContextMatchUp:S}),Array.isArray(v)&&S&&!S.sides?.every(({participantId:U})=>U))if(l===Qt)r.processCodes=rt([...r.processCodes??[],...v]);else for(let U of v||[]){let T=U&&r?.processCodes?.lastIndexOf(U);r?.processCodes?.splice(T,1)}return St({eventId:p?.eventId,context:e,drawDefinition:o,tournamentId:w,matchUp:r}),{...H}}function XL(t){let{propagateExitStatus:e,matchUpStatusCodes:i,autoCalcDisabled:r,inContextMatchUp:n,matchUpStatus:a,dualMatchUp:s,structure:o,matchUp:l}=t,u=lS({matchUpStatus:a})||[Oc,us].includes(a)&&s||r,c=l?.sides?.map(h=>h.participantId).filter(Boolean).length||n?.sides?.map(h=>h.participantId).filter(Boolean).length,d="attemptToModifyScore";if(!(Vn({structure:o})&&c===1||a===Qt&&c||wUe({structure:o,matchUp:l,inContextMatchUp:n})||t.appliedPolicies?.[Po]?.requireParticipantsForScoring===!1||Fr(a)&&c===1&&e))return z({result:{error:V1},stack:d});let p=[mi].includes(a),f=u?a:t.winningSide&&ki||cs,m=yo({...t,winningSide:t.winningSide,matchUpStatusCodes:u&&i||[],matchUpStatus:f,removeScore:p});return z({result:m,stack:d})}function wUe({structure:t,matchUp:e,inContextMatchUp:i}){let{drawPositions:r}=e,{positionAssignments:n}=ur({structure:t}),a=n?.filter(o=>r?.includes(o.drawPosition)&&o.participantId),s=i?.sides?.every(o=>o.participantId);return a?.length===2||s}function U8({collectionGroups:t=[]}){let e=Object.assign({},...t.filter(r=>ot(r?.groupValue)&&r?.groupNumber).map(r=>({[r.groupNumber]:{...r,allGroupMatchUpsCompleted:!0,matchUpsCount:0,sideWins:[0,0],values:[0,0]}}))),i=Object.keys(e).map(r=>Ye(r));return{groupValueGroups:e,groupValueNumbers:i}}function SUe({collectionDefinition:t,groupValueNumbers:e,groupValueGroups:i,sideTieValues:r,tieMatchUps:n}){let a=n.filter(v=>v.collectionId===t.collectionId),s=[0,0],o=[0,0],l=a.every(v=>Yi.includes(v.matchUpStatus)),{collectionValueProfiles:u,collectionGroupNumber:c,collectionValue:d,matchUpValue:p,winCriteria:f,scoreValue:m,setValue:h}=t,g=c&&e.includes(c),I=[0,0];if(a.forEach(v=>{v.winningSide&&(I[v.winningSide-1]+=1)}),ot(p)?a.forEach(v=>{v.winningSide&&(s[v.winningSide-1]+=p)}):ot(h)?a.forEach(v=>{v.score?.sets?.forEach(w=>{w.winningSide&&(s[w.winningSide-1]+=h)})}):ot(m)?a.forEach(v=>{v.score?.sets?.forEach(w=>{let{side1TiebreakScore:y=0,side2TiebreakScore:b=0,side1Score:S=0,side2Score:U=0}=w;(v.matchUpStatus===ki||v.winningSide||w.winningSide)&&(S||U?(s[0]+=S,s[1]+=U):(y||b)&&w.winningSide&&(s[w.winningSide-1]+=1))})}):Array.isArray(u)&&a.forEach(v=>{if(v.winningSide){let w=v.collectionPosition,y=UUe({collectionDefinition:t,collectionPosition:w});ot(y)&&(s[v.winningSide-1]+=y)}}),ot(d)){let v;if(f?.aggregateValue)l&&(ot(p||h||m)&&s[0]!==s[1]?v=s[0]>s[1]?1:2:I[0]!==I[1]&&(v=I[0]>I[1]?1:2));else if(f?.valueGoal)v=s.reduce((w,y,b)=>y>=f.valueGoal?b+1:w,0);else{let w=Math.floor(t.matchUpCount/2)+1;v=I.reduce((y,b,S)=>b>=w?S+1:y,0)}v&&(g?i[c].values[v-1]+=d:o[v-1]+=d)}else g?(i[c].values[0]+=s[0]||0,i[c].values[1]+=s[1]||0):o=s;g?(i[c].sideWins[0]+=I[0]||0,i[c].sideWins[1]+=I[1]||0,i[c].allGroupMatchUpsCompleted=i[c].allGroupMatchUpsCompleted&&l,i[c].matchUpsCount+=a.length):o.forEach((v,w)=>r[w]+=v||0)}function UUe({collectionDefinition:t,collectionPosition:e}){return(t.collectionValueProfiles||[])?.find(i=>i.collectionPosition===e)?.matchUpValue}function wS(t){let{sideAdjustments:e=[0,0],separator:i="-",drawDefinition:r,matchUpsMap:n,structure:a,matchUp:s,event:o}=t;if(!Array.isArray(e)||e.length!==2||Number.isNaN(e.reduce((y,b)=>y+b)))return{error:ie};if(!s)return{error:ta};let l=vn({matchUp:s,drawDefinition:r,structure:a,event:o})?.tieFormat||t?.tieFormat;if(!l)return{error:ZI};let u=Bn({tieFormat:l});if(u.error)return u;let c=l?.collectionDefinitions||[],d=s?.tieMatchUps??[],p=[0,0],{groupValueGroups:f,groupValueNumbers:m}=U8(l);for(let y of c)SUe({collectionDefinition:y,groupValueNumbers:m,groupValueGroups:f,sideTieValues:p,tieMatchUps:d});for(let y of m){let b=f[y],{allGroupMatchUpsCompleted:S,matchUpCount:U,winCriteria:T,groupValue:P,sideWins:D,values:E}=b,R;if(T?.aggregateValue)S&&E[0]!==E[1]&&(R=E[0]>E[1]?1:2);else if(T?.valueGoal)R=E.reduce((C,M,N)=>M>=T.valueGoal?N+1:C,void 0);else{let C=Math.floor(U/2)+1;R=D.reduce((M,N,A)=>N>=C?A+1:M,void 0)}R&&(p[R-1]+=P||0)}let h=p.map((y,b)=>(y||0)+e[b]),g={side1Score:h[0],side2Score:h[1],winningSide:void 0},I=h.join(i),v=h.slice().reverse().join(i),w;if(l?.winCriteria){let{valueGoal:y,aggregateValue:b,tallyDirectives:S}=l.winCriteria;if(y?w=h.map((U,T)=>({sideNumber:T+1,points:U})).find(({points:U})=>U>=y)?.sideNumber:b&&d.every(U=>U.matchUpStatus&&Yi.includes(U.matchUpStatus)||U.winningSide)&&h[0]!==h[1]&&(w=h[0]>h[1]?1:2),!w&&S){let U=s.matchUpId,T=s.hasContext?s:n?.drawMatchUps?.[U]||r&&di({inContext:!0,drawDefinition:r,matchUpId:U})?.matchUp;if(T){let{completedTieMatchUps:P,order:D}=Ih({matchUps:[T]});if(P&&D?.length){let E=D[0].participantId;w=T.sides.find(({participantId:R})=>R===E)?.sideNumber}}}}return w&&(g.winningSide=w),{scoreStringSide1:I,scoreStringSide2:v,winningSide:w,set:g}}function SS({inContextDualMatchUp:t,drawDefinition:e,tournamentId:i,dualMatchUp:r,eventId:n}){if(r){t||(t=di({matchUpId:r.matchUpId,inContext:!0,drawDefinition:e})?.matchUp);let{extension:a}=mt({element:e,name:cc}),s=ke(a?.value||{},!1,!0),o=({displaySideNumber:l,drawPosition:u,sideNumber:c})=>({drawPosition:u,sideNumber:c,displaySideNumber:l});r.sides=t?.sides?.map(l=>{let u=l.participantId,c=u&&s[u]||void 0,{lineUp:d,...p}=r.sides?.find(({sideNumber:m})=>m===l.sideNumber)??{},f=d?.length?d:c;return{...o(l),...p,lineUp:f}}),St({context:"ensureSidLineUps",matchUp:r,drawDefinition:e,tournamentId:i,eventId:n})}}function jr(t){if(t)return ke(t,!1,!0)}function JL(t){let e=Ge(t,[{[cn]:!0}]);return e.error?e:Object.keys(t.tournamentRecords).reduce((i,r)=>{i.tournamentIdMap[r]=[];let n=t.tournamentRecords[r].events??[],a=n.map(({eventId:o})=>o),s=n.map(o=>(o.drawDefinitions??[]).map(({drawId:l})=>l)).flat();return i.tournamentIdMap[r].push(...a,...s),i.eventIds.push(...a),i.drawIds.push(...s),i},{eventIds:[],drawIds:[],tournamentIdMap:{}})}function T8({tournamentRecords:t,eventId:e,drawId:i}){let{tournamentIdMap:r}=JL({tournamentRecords:t});return(r?Object.keys(r):[]).find(n=>e&&r?.[n].includes(e)||i&&r?.[n].includes(i))}function _c(t){let{exitWhenNoValues:e,drawDefinition:i,matchUpStatus:r,removeScore:n,matchUpsMap:a,matchUpId:s,event:o}=t,l=t.tournamentRecords||t.tournamentRecord&&{[t.tournamentRecord?.tournamentId]:t.tournamentRecord}||{},u=t.tournamentId||t.tournamentRecord?.tournamentId;l&&T8({tournamentRecords:l,...t});let c=u&&l[u];if(!c)return{error:Ie};let d=di({drawDefinition:i,event:o,matchUpId:s});if(d.error)return d;if(!d.matchUp)return{error:un};let{matchUp:p,structure:f}=d;if(!p.tieMatchUps)return{error:ia};SS({tournamentId:c?.tournamentId,eventId:o?.eventId,dualMatchUp:p,drawDefinition:i});let{extension:m}=mt({name:Cm,element:p});if(m?.value)if(n)En({element:p,name:Cm});else return{...H,score:p.score};let h=vn({drawDefinition:i,structure:f,matchUp:p,event:o})?.tieFormat;p.tieFormat=jr(h);let g=wS({drawDefinition:i,matchUpsMap:a,structure:f,matchUp:p,event:o}),{winningSide:I,set:v,scoreStringSide1:w,scoreStringSide2:y}=g,b=v?.side1Score||v?.side2Score;if(e&&!p.score&&!b)return{...H};let S={scoreStringSide1:w,scoreStringSide2:y,sets:v?[v]:[]},U=I&&[1,2].includes(I),T=U&&ki||fL({matchUpStatus:r??p.matchUpStatus,tieMatchUps:p.tieMatchUps,winningSide:p.winningSide,score:S})&&ao||Fi,P=!!(p.winningSide&&!U),D=p.tieMatchUps.find(({score:R,winningSide:C,matchUpStatus:M})=>R?.sets?.length&&(R.sets[0].side1Score||R.sets[0].side2Score)||M&&Yi.includes(M)||C),E;if(p.tieFormat&&!U&&!D){let R=vn({drawDefinition:i,structure:f,event:o})?.tieFormat;R&&JSON.stringify(h)===JSON.stringify(R)&&(p.tieFormatId=void 0,p.tieFormat=void 0,E=!0)}return yo({appliedPolicies:t.appliedPolicies,matchUpStatus:T,score:S,removeWinningSide:P,tournamentRecord:c,drawDefinition:i,removeScore:n,winningSide:I,matchUpId:s,matchUp:p,event:o}),{...H,score:S,removeWinningSide:P,tieFormatRemoved:E,winningSide:I}}function TUe({winnerMatchUpDrawPositionIndex:t,inContextDrawMatchUps:e,projectedWinningSide:i,sourceMatchUpStatus:r,winningDrawPosition:n,tournamentRecord:a,winnerTargetLink:s,sourceMatchUpId:o,drawDefinition:l,winnerMatchUp:u,dualMatchUp:c,matchUpsMap:d,event:p}){let f="directWinner";if(s){let m=u.drawPositions||[],h=m[t],g=s.source.structureId,I=et({structureId:g,drawDefinition:l});if(I.error)return I;let{structure:v}=I,{positionAssignments:w}=ur({structureId:g,drawDefinition:l}),y=w?.find(D=>D.drawPosition===n)?.participantId,b=s.target.structureId,{positionAssignments:S}=ur({structureId:b,drawDefinition:l}),U=S?.find(D=>D.participantId===y)?.drawPosition,T=S?.filter(D=>{let E=m.includes(D.drawPosition),R=!D.participantId&&!D.bye&&!D.qualifier;return E&&R}).map(D=>D.drawPosition),P=T?.includes(h);if(y&&s.target.roundNumber===1&&P)ol({drawPosition:h,participantId:y,structureId:b,inContextDrawMatchUps:e,sourceMatchUpStatus:r,tournamentRecord:a,drawDefinition:l,matchUpsMap:d,event:p});else if(y&&T?.length){let D=T.pop();D&&ol({participantId:y,structureId:b,inContextDrawMatchUps:e,sourceMatchUpStatus:r,tournamentRecord:a,drawDefinition:l,drawPosition:D,matchUpsMap:d,event:p})}else if(U){let D=nm({drawPosition:U,matchUpId:u.matchUpId,inContextDrawMatchUps:e,sourceMatchUpStatus:r,tournamentRecord:a,sourceMatchUpId:o,drawDefinition:l,matchUpsMap:d});if(D.error)return z({result:D,stack:f})}else if(v?.stage!==We){let D="winner target position unavaiallble";console.log(D),z({stack:f,result:{error:D}})}if(v?.seedAssignments&&v.structureId!==b){let D=v.seedAssignments.find(({participantId:R})=>R===y),E=D?.participantId;D&&E&&mv({eventId:u?.eventId,structureId:b,...D,tournamentRecord:a,drawDefinition:l,participantId:E})}}else{let m=nm({matchUpId:u.matchUpId,drawPosition:n,inContextDrawMatchUps:e,sourceMatchUpStatus:r,tournamentRecord:a,sourceMatchUpId:o,drawDefinition:l,matchUpsMap:d});if(m.error)return m}if(c&&i){let m=c.sides?.find(h=>h.sideNumber===i);if(m?.lineUp){let h=c.roundPosition,g=u.roundPosition,I=h===g&&h!==1||Math.floor(h/2)===g?2:1,v=d?.drawMatchUps?.find(({matchUpId:b})=>b===u.matchUpId),w=[1,2].map(b=>({...v.sides?.find(S=>S.sideNumber===b)||{},sideNumber:b}));v.sides=w;let y=v.sides.find(b=>b.sideNumber===I);if(y){let b=m.lineUp?.filter(S=>S?.participantId);y.lineUp=kL({lineUp:b}),St({tournamentId:a?.tournamentId,eventId:u?.eventId,matchUp:v,context:f,drawDefinition:l})}}}return{...H}}function DUe(t){let{loserMatchUpDrawPositionIndex:e,inContextDrawMatchUps:i,projectedWinningSide:r,propagateExitStatus:n,sourceMatchUpStatus:a,loserDrawPosition:s,tournamentRecord:o,loserTargetLink:l,drawDefinition:u,loserMatchUp:c,dualMatchUp:d,matchUpsMap:p,event:f}=t,m="directLoser",h=l.linkCondition,g=c.drawPositions||[],I=h===al&&c.roundNumber===2&&Math.min(...g.filter(Boolean)),v=I||g[e],w=I||g[1-e],y=l.source.structureId,{structure:b}=et({structureId:y,drawDefinition:u}),{matchUps:S}=Nt({afterRecoveryTimes:!1,inContext:!0,drawDefinition:u,structure:b,event:f}),U=S.filter(_=>_.drawPositions?.includes(s)).filter(_=>{let B=_.sides.find(j=>j.drawPosition===s),G=_.matchUpStatus===mi||_.matchUpStatus===Qt&&!cr(_);return B?.sideNumber===_.winningSide&&!G}),T=h===al&&U.length===0,{positionAssignments:P}=ur({structureId:y,drawDefinition:u}),D=P?.find(_=>_.drawPosition===s)?.participantId,E={loserParticipantId:D},R=l.target.structureId,{positionAssignments:C}=ur({structureId:R,drawDefinition:u}),M=C?.filter(({drawPosition:_})=>g.includes(_)),N=M?.some(_=>_.participantId&&D&&_.participantId===D),A=n&&[$r,mi,Qt].includes(a||"");if(N)return{...H,stack:m};let O=M?.filter(_=>{let B=g.includes(_.drawPosition),G=!_.participantId&&!_.bye&&!_.qualifier;return B&&G}).map(_=>_.drawPosition),k=O?.includes(v),F=l.target.roundNumber>1&&O?.length,x=l.target.roundNumber===1&&k;if(I){let _=L();if(_.context&&Object.assign(E,_.context),_.error)return z({result:_,stack:m})}else if(x){let _=V();if(_.context&&Object.assign(E,_.context),_.error)return z({result:_,stack:m})}else if(D&&F){O.sort(ir);let _=O[0],B=ol({participantId:D,structureId:R,drawPosition:_,inContextDrawMatchUps:i,sourceMatchUpStatus:a,tournamentRecord:o,drawDefinition:u,matchUpsMap:p,event:f});if(B.error)return z({result:B,stack:m});if(!B.error&&A&&n)return{stack:m,context:{progressExitStatus:!0,loserParticipantId:D}}}else return z({context:{loserDrawPosition:s,loserTargetLink:l,targetDrawPositionIsUnfilled:k},result:{error:k?eh:bIe},stack:m});if(b?.seedAssignments&&b.structureId!==R){let _=b.seedAssignments.find(({participantId:G})=>G===D),B=_?.participantId;_&&B&&mv({eventId:c?.eventId,structureId:R,..._,tournamentRecord:o,drawDefinition:u,participantId:B})}if(d&&r){let _=d.sides?.find(B=>B.sideNumber===3-r);if(_?.lineUp){let{roundNumber:B,eventId:G}=c,{roundPosition:j}=d,K=B===1?2-j%2:1,Y=p?.drawMatchUps?.find(({matchUpId:J})=>J===c.matchUpId),X=[1,2].map(J=>({...Y.sides?.find(ae=>ae.sideNumber===J)||{},sideNumber:J}));Y.sides=X;let Z=Y.sides.find(J=>J.sideNumber===K);Z&&(Z.lineUp=kL({lineUp:_.lineUp}),St({tournamentId:o?.tournamentId,matchUp:Y,context:m,drawDefinition:u,eventId:G}))}}return z({result:{...H},stack:m,context:E});function L(){let _="loserLinkFedFMLC";return z(T?{result:V(),stack:_}:{result:$(),stack:_})}function $(){let _=Wa({drawPosition:w,structureId:R,tournamentRecord:o,drawDefinition:u,event:f});return z({result:_,stack:"assignLoserPositionBye"})}function V(){let _=D?ol({drawPosition:v,participantId:D,structureId:R,inContextDrawMatchUps:i,sourceMatchUpStatus:a,tournamentRecord:o,drawDefinition:u,matchUpsMap:p,event:f}):{error:lr};return!_.error&&A&&n?{stack:m,context:{progressExitStatus:!0}}:z({result:_,stack:"assignLoserDrawPosition"})}}function D8(t){let e="directParticipants",i=XL(t);if(i.error)return z({result:i,stack:e});let r=lS({matchUpStatus:t.matchUpStatus}),{dualWinningSideChange:n,inContextDrawMatchUps:a,projectedWinningSide:s,propagateExitStatus:o,matchUpStatusCodes:l,tournamentRecord:u,drawDefinition:c,matchUpStatus:d,dualMatchUp:p,matchUpsMap:f,winningSide:m,targetData:h,matchUpId:g,structure:I,matchUp:v,event:w}=t,y=!!v.collectionId,b=Vn({structure:I}),S=v.drawPositions,U;if(y){let{matchUpTieId:T,matchUpsMap:P}=t,D=_c({appliedPolicies:t.appliedPolicies,matchUpId:T,tournamentRecord:u,drawDefinition:c,matchUpsMap:P,event:w});if(U=D&&{tieMatchUpResult:D},S=a.find(({matchUpId:E})=>E===T)?.drawPositions,!n)return z({result:{...H,...U},stack:e})}if(b)return z({result:{...H,...U},stack:e});if(S){let T=s?s-1:m-1,P=1-T,D=S[T],E=S[P],R={},{targetLinks:{loserTargetLink:C,winnerTargetLink:M,byeTargetLink:N},targetMatchUps:{winnerMatchUpDrawPositionIndex:A,loserMatchUpDrawPositionIndex:O,winnerMatchUp:k,loserMatchUp:F,byeMatchUp:x}}=h;if(k){let L=TUe({sourceMatchUpStatus:r&&d||ki,winnerMatchUpDrawPositionIndex:A,sourceMatchUpId:g,inContextDrawMatchUps:a,projectedWinningSide:s,winningDrawPosition:D,tournamentRecord:u,winnerTargetLink:M,drawDefinition:c,winnerMatchUp:k,dualMatchUp:p,matchUpsMap:f,event:w});if(L.error)return z({result:L,stack:e})}if(F){let L=DUe({sourceMatchUpStatus:r&&d||ki,loserMatchUpDrawPositionIndex:O,inContextDrawMatchUps:a,projectedWinningSide:s,propagateExitStatus:o,loserDrawPosition:E,tournamentRecord:u,loserTargetLink:C,drawDefinition:c,loserMatchUp:F,matchUpsMap:f,dualMatchUp:p,event:w});if(L.context?.progressExitStatus&&Object.assign(R,L.context,{sourceMatchUpStatus:r&&d||ki,sourceMatchUpStatusCodes:l||[],loserMatchUp:F,matchUpsMap:f}),L.error)return z({result:L,stack:e})}if(x){let L=x.drawPositions||[],$=Math.min(...L.filter(Boolean)),V=N.target.structureId,_=Wa({drawPosition:$,structureId:V,tournamentRecord:u,drawDefinition:c,event:w});if(_.error)return z({result:_,stack:e})}return z({result:{...H,...U},stack:e,context:R})}else return z({result:{error:Ew},stack:e})}function QL(t){let e="genPlayoffStructure";if(!t.drawDefinition)return z({result:{error:_e},stack:e});let i=bS(t);if(i.error)return z({result:i,stack:e});let{structureId:r,addNameBaseToAttributeName:n,playoffStructureNameBase:a,finishingPositionNaming:s,finishingPositionLimit:o,playoffAttributes:l,playoffPositions:u,roundOffsetLimit:c,tournamentRecord:d,exitProfileLimit:p,roundProfiles:f,roundNumbers:m,idPrefix:h,isMock:g,event:I,uuids:v}=t,w=ke(t.drawDefinition,!1,!0),{structure:y}=et({structureId:r,drawDefinition:w});if(!y)return z({result:{error:Ii},stack:e});if(y.structureType===fn||y.structures)return bUe({sourceStructureId:y.structureId,...t,...i,drawDefinition:w});let{playoffRoundsRanges:b,playoffRounds:S}=i,{playoffPositionsReturned:U,error:T,playoffSourceRounds:P,playoffRoundsRanges:D}=I8(t);if(T)return z({result:{error:T},stack:e});let E=f?.length&&Object.assign({},...f),R=m||typeof f=="object"&&f.map(j=>Object.keys(j)).flat(),C=Array.isArray(R)&&R.map(j=>!isNaN(j)&&Ye(j)).filter(Boolean);if(C){if(!Array.isArray(C))return z({result:{error:ie},context:{validRoundNumbers:C},stack:e});C.forEach(j=>{if(!S?.includes(j))return z({result:{error:ie},context:{roundNumber:j},stack:e})})}u&&u.forEach(j=>{if(!U?.includes(j))return z({result:{error:ie},context:{playoffPosition:j},stack:e})});let M=C||P,N=C?b:D,A=[],O=[];for(let j of M??[]){let K=N?.find(le=>le.roundNumber===j);if(!K)return z({result:{error:ie},context:{roundNumber:j},stack:e});let Y=K.finishingPositions.length,X=Math.min(...K.finishingPositions)-1,Z=2,J=j&&E?.[j]&&Z+E[j]-1,ae=Vg({exitProfile:`0-${j}`,addNameBaseToAttributeName:n,playoffStructureNameBase:a,finishingPositionOffset:X,playoffAttributes:l,exitProfileLimit:p,stage:Ui,roundOffset:0,drawDefinition:w,sequenceLimit:J,stageSequence:Z,drawSize:Y,idPrefix:h,isMock:g,uuids:v,finishingPositionNaming:s,finishingPositionLimit:o,roundOffsetLimit:c});if(ae.error)return z({result:ae,stack:e});let{structures:te,links:ne}=ae;if(te?.length&&A.push(...te),ne?.length&&O.push(...ne),ae.structureId&&j){let le={linkType:nu,source:{structureId:r,roundNumber:j},target:{structureId:ae.structureId,feedProfile:Ms,roundNumber:1}};O.push(le)}}if(!A.length)return z({result:{error:ie},info:"No structures generated",stack:e});w.structures.push(...A),w.links.push(...O);let{matchUps:k,matchUpsMap:F}=Qi({inContext:!0,drawDefinition:w}),x=A.map(({structureId:j})=>j),L=k?.filter(({structureId:j})=>x.includes(j)).map(Ir),$=F?.drawMatchUps?.filter(({matchUpId:j})=>L?.includes(j));if($?.length){let j=vn({drawDefinition:w,event:I})?.tieFormat;j&&$.forEach(K=>{let{tieMatchUps:Y}=Sh({matchUp:K,tieFormat:j,isMock:g});Object.assign(K,{tieMatchUps:Y,matchUpType:Zt})})}k?.filter(j=>mp({matchUp:j})&&j.structureId===r)?.forEach(j=>{let{matchUpId:K,score:Y,winningSide:X}=j,Z=On({inContextDrawMatchUps:k,drawDefinition:w,matchUpId:K}),J=D8({inContextDrawMatchUps:k,tournamentRecord:d,drawDefinition:w,matchUpsMap:F,winningSide:X,targetData:Z,matchUpId:K,structure:y,matchUp:j,score:Y,event:I});J.error&&console.log(J.error)}),k?.filter(j=>j.matchUpStatus==="BYE"&&j.structureId===r)?.forEach(j=>{let{matchUpId:K}=j,Y=On({inContextDrawMatchUps:k,drawDefinition:w,matchUpId:K}),{targetLinks:{loserTargetLink:X},targetMatchUps:{loserMatchUpDrawPositionIndex:Z,loserMatchUp:J}}=Y;if(X&&J){let ae=X.target.structureId,te=J.drawPositions[Z],ne=Wa({drawPosition:te,structureId:ae,tournamentRecord:d,drawDefinition:w,event:I});ne.error&&console.log(ne.error)}});let V=[],_=Np({inContextDrawMatchUps:k,drawDefinition:w,matchUpsMap:F}).goesToMap,{structure:B}=et({drawDefinition:t.drawDefinition,structureId:r}),{matchUps:G}=Nt({structure:B});return G.forEach(j=>{let K=_?.loserMatchUpIds[j.matchUpId];if(K&&j.loserMatchUpId!==K){j.loserMatchUpId=K;let X={tournamentId:d?.tournamentId,eventId:t.event?.eventId,context:e,matchUp:j};V.push(X)}let Y=_?.winnerMatchUpIds[j.matchUpId];if(Y&&j.winnerMatchUpId!==Y){j.winnerMatchUpId=Y;let X={tournamentId:d?.tournamentId,eventId:t.event?.eventId,context:e,matchUp:j};V.push(X)}}),{structures:A,matchUpModifications:V,links:O,drawDefinition:w,...H}}function P8({element:t}){if(!t)return{error:ie};if(!t.timeItems)return{};if(!Array.isArray(t.timeItems))return{error:ie};let e=(i,r)=>(n,a)=>(a[i]&&(n[a[i]]=a[r]),n);return t.timeItems.reduce(e("itemType","itemValue"),{})}function Dl(t){let{duplicateValues:e=!0,creationTime:i=!0,removePriorValues:r,timeItem:n}=t;if(!n)return{error:Q1};let a=UK(t);if(a.error)return a;if(!(bt(n)&&ri(n.itemType)&&Object.keys(n).includes("itemValue")))return{error:J1};if(!a.timeItems)a.timeItems=[];else if(PUe({element:a,duplicateValues:e,timeItem:n}))return{...H};if(n.itemSubTypes&&!n.itemSubTypes.length&&delete n.itemSubTypes,i){let s=new Date().toISOString();Object.assign(n,{createdAt:s})}return r&&(a.timeItems=a.timeItems.filter(({itemType:s})=>n.itemType!==s)),r&&!n.itemValue||a.timeItems.push(n),{...H}}function PUe({element:t,duplicateValues:e,timeItem:i}){let{itemType:r,itemSubTypes:n,itemValue:a}=i,s=r&&vs({itemSubTypes:n,itemType:r,element:t})?.timeItem;return s&&JSON.stringify(s?.itemValue)===JSON.stringify(a)&&!e}function ZL({creationTime:t=!0,removePriorValues:e,tournamentRecord:i,duplicateValues:r,participantId:n,timeItem:a}){if(!i)return{error:Ie};if(!n)return{error:lr};let s=$d({tournamentRecord:i,participantId:n});return s.error?s:Dl({element:s.participant,removePriorValues:e,duplicateValues:r,creationTime:t,timeItem:a})}function US(t){let{removePriorValues:e,tournamentRecord:i,duplicateValues:r,creationTime:n,timeItem:a}=t;if(!i)return{error:Ie};let s=Dl({element:i,removePriorValues:e,duplicateValues:r,creationTime:n,timeItem:a});if(s.error)return s;let o=P8({element:i});return at({payload:{parentOrganisation:i.parentOrganisation,tournamentId:i.tournamentId,timeItemValues:o},topic:nf}),s}function Uh(t){let{removePriorValues:e,duplicateValues:i,creationTime:r,timeItem:n,event:a}=t;return a?Dl({removePriorValues:e,duplicateValues:i,element:a,creationTime:r,timeItem:n}):{error:os}}function E8(t){return KR({...t,itemType:"attachConsolationStructures"})}function e0(t){return KR({...t,itemType:"attachPlayoffStructures"})}function KR({itemType:t="attachStructures",matchUpModifications:e,tournamentRecord:i,drawDefinition:r,structures:n,links:a=[],event:s}){let o="attachStructures";if(!r)return{error:_e};if(!Array.isArray(n)||!Array.isArray(a))return z({result:{error:ie},stack:o});let l=g=>[g.source.structureId,g.source.roundNumber||g.source.finishingPositions?.join("|"),g.target.roundNumber].join("|"),u=r.links?.map(l);if(a.some(g=>{let I=l(g);return u?.includes(I)}))return z({result:{error:nF},info:"playoff structure exists",stack:o});a.length&&r.links?.push(...a);let c=n.map(({structureId:g})=>g),d=r.structures?.map(({structureId:g})=>g);r.structures=(r.structures??[]).map(g=>c.includes(g.structureId)?n.find(({structureId:I})=>I===g.structureId):g);let p=n?.filter(({structureId:g})=>!d?.includes(g));p.length&&r.structures.push(...p),Np({drawDefinition:r});let f=n.map(g=>Nt({structure:g})?.matchUps||[]).flat();hd({tournamentId:i?.tournamentId,eventId:s?.eventId,drawDefinition:r,matchUps:f});let m=n.map(({structureId:g})=>g);if(ti({drawDefinition:r,structureIds:m}),e?.length){let g={};e.forEach(v=>{let w=v.matchUp?.matchUpId;w&&(g[w]=v)});let I=v=>{v.matchUps.forEach(w=>{if(g[w.matchUpId]){let{tieMatchUps:y,...b}=g[w.matchUpId].matchUp;if(Object.assign(w,b),y?.length){let S={};y.forEach(U=>g[U.matchUpId]=U),w.tieMatchUps.forEach(U=>Object.assign(U,S[U.matchUpId]))}g[w.matchUpId].matchUp=w,St(g[w.matchUpId])}})};r.structures.forEach(v=>{if(d?.includes(v.structureId))if(v.structures)for(let w of v.structures)I(w);else I(v)})}let h=p.map(ba("structureId"));if(i){let g={itemValue:{structureIds:m,drawId:r.drawId},itemType:t};Dl({element:i,timeItem:g})}return{...H,addedStructureIds:h}}function XR(t){let{structures:e,links:i,matchUpModifications:r,error:n}=QL(t);if(n)return{error:n};let a=t.drawDefinition;return e0({tournamentId:t.tournamentRecord?.tournamentId,eventId:t.event?.eventId||t.eventId,matchUpModifications:r,drawDefinition:a,structures:e,links:i})}function kp(t){let e=Ge(t,[{_anyOf:{[cn]:!1,[mr]:!1,[mn]:!1,[kc]:!1},[SF]:!0}]);if(e.error)return e;let i=[],r=t.drawDefinition??t.event??((t.tournamentId||!t.tournamentRecords)&&t.tournamentRecord);if(r){let n=iW(t,r);if(n.error)return n;i.push(...n?.applied??[]),t.drawDefinition&&ti({drawDefinition:t.drawDefinition,tournamentId:t.tournamentId})}else if(t.tournamentRecords){let n=Object.keys(t.tournamentRecords);if(!n.length)return{error:Ie};for(let a of n){let s=t.tournamentRecords[a],o=iW(t,s);if(o.error)return o;i.push(...o?.applied??[])}}else return{error:Ie};return i.length?{...H,applied:i}:{error:H1}}function iW(t,e){let i=Tt(t).appliedPolicies??{};e.extensions||(e.extensions=[]);let r=[],n=Object.keys(t.policyDefinitions);if(!n.length)return{error:jE};for(let a of n)if(!i[a]||t.allowReplacement){let s=t.policyDefinitions[a];if(!s)continue;if(!bt(s))return{error:ie};let{policyName:o,...l}=s;if(!l||!Object.keys(l).length||o&&!ri(o))return{error:ie};i[a]=t.policyDefinitions[a],r.push(a)}return r?.length?{...xt({element:e,extension:{name:wb,value:i}}),applied:r}:{applied:r,error:H1}}function t0({tournamentRecord:t,drawDefinition:e,flightProfile:i,drawName:r,drawId:n,event:a}){if(!r||typeof r!="string")return z({result:{error:ie},context:{drawName:r}});i||(i=$i({event:a}).flightProfile);let s=i?.flights?.find(o=>o.drawId===n);if(s){s.drawName=r;let o={name:Xs,value:{...i,flights:i.flights}};Ld({event:a,extension:o})}return e&&(e.drawName=r,ti({tournamentId:t?.tournamentId,drawDefinition:e})),!s&&!e?{error:_e}:{...H,flight:s}}function R8({tournamentRecord:t,drawDefinition:e,drawUpdates:i,drawId:r,event:n}){if(!bt(i))return{error:ie};let a=$i({event:n}).flightProfile,s=i.drawName&&t0({drawName:i.drawName,tournamentRecord:t,drawDefinition:e,flightProfile:a,drawId:r,event:n});if(s?.error)return s?.error;let o=s?.flight||a?.flights?.find(l=>l.drawId===r);if(!o&&!e)return{error:_e};if(o){let l={name:Xs,value:{...a,flights:a.flights}};Ld({event:n,extension:l})}return e&&(i.policyDefinitions&&kp({policyDefinitions:i.policyDefinitions,drawDefinition:e}),ti({tournamentId:t?.tournamentId,drawDefinition:e})),{...H}}function C8({tournamentRecord:t,removeScheduling:e,drawDefinition:i}){if(!i)return{error:_e};let r=kr({drawDefinition:i}),n=s=>r?.drawMatchUps?.find(o=>o.matchUpId===s);for(let s of i.structures||[]){let{positionAssignments:o,stage:l,stageSequence:u}=s;o&&(u!==1||![We,xe].includes(l))&&(s.positionAssignments=o.map(p=>(delete p.participantId,p)),s.seedAssignments=[]);let{matchUps:c,isRoundRobin:d}=Nt({afterRecoveryTimes:!1,inContext:!0,matchUpsMap:r,structure:s});for(let p of c){let{matchUpId:f,roundNumber:m}=p,h=p.sides||[],g=n(f);if(g){if(delete g.extensions,delete g.notes,g.matchUpStatus!=="BYE"&&Object.assign(g,YR),m&&m>1&&g.drawPositions?.length&&!d){let I=h?.map(({drawPosition:w,participantFed:y})=>!y&&w).filter(Boolean),v=g.drawPositions.map(w=>I.includes(w)?void 0:w);g.drawPositions=v}e?delete g.timeItems:g.timeItems?.length&&(g.timeItems=g.timeItems.filter(I=>I.itemType&&![lu,Id,ph,lL,fh,mh].includes(I.itemType))),St({tournamentId:t?.tournamentId,context:"resetDrawDefiniton",drawDefinition:i,matchUp:g})}}}i.extensions=i.extensions.filter(s=>s.name!==Bg);let a=(i.structures||[]).map(({structureId:s})=>s);return ti({drawDefinition:i,structureIds:a}),{...H}}function TS({tournamentRecord:t}){if(!t)return{error:Ie};let e={positionsNoOutcomes:[],canBePruned:[],matchPlay:[],inactive:[],drawAnalysis:{}},i={};return(t.events?.flatMap(r=>{let n=r.eventId;return i[n]=r,(r?.drawDefinitions||[]).map(a=>({drawDefinition:a,eventId:n}))}).filter(Boolean)).forEach(({drawDefinition:r,eventId:n})=>{let a=0,s=0,o=0,{allStructuresLinked:l}=HR({drawDefinition:r}),u=i[n],c=(r?.structures||[]).map(w=>{let{stage:y,stageSequence:b,structureId:S}=w,U=Em[y],{inContextStructureMatchUps:T}=dv({drawDefinition:r,structureId:S,structure:w,event:u}),P=T?.filter(({winningSide:$})=>$),D=P.filter(Boolean).length||0;s+=D,o+=T.length-s;let E=Math.max(P.filter(({roundNumber:$})=>$===1).map(({roundPosition:$})=>$)),{positionAssignments:R}=Yt({structure:w}),C=R?.filter(({participantId:$})=>$);a+=C?.length??0;let M=(R?.length??0)-(C?.length??0),{roundMatchUps:N,roundProfile:A,roundNumbers:O,maxMatchUpsCount:k}=bn({matchUps:T}),F=A&&Object.keys(A).filter($=>!A[$].inactiveRound).map($=>Number.parseInt($)),x=A&&Object.keys(A).filter($=>A[$].inactiveRound).map($=>Number.parseInt($)),L=A&&Object.values(A).every($=>$.inactiveRound);return{positionsAssignedCount:C?.length??0,maxWinningSideFirstRoundPosition:E,unassignedPositionsCount:M,inactiveStructure:L,maxMatchUpsCount:k,inactiveRounds:x,roundMatchUps:N,activeRounds:F,roundNumbers:O,roundProfile:A,structureId:S,stageSequence:b,orderNumber:U,stage:y}}),d=c.find(w=>w.orderNumber===2&&w.stageSequence===1),p=c.filter(({inactiveStructure:w})=>!w).length,{links:f}=uv({structureId:d.structureId,drawDefinition:r}),m=Ye(d.activeRounds[0])===1&&d.activeRounds.length===1&&p===1,h=c?.every(({inactiveStructure:w})=>w),g=!f.length&&d.activeRounds.length&&(d.roundProfile[1].inactiveCount||d.inactiveRounds.length),I=r.drawId;a&&!s&&e.positionsNoOutcomes.push(I),h&&e.inactive.push(I),m&&e.matchPlay.push(I),g&&e.canBePruned.push(I);let v={matchUpsWithWinningSideCount:s,matchUpsNoOutcomeCount:o,positionsAssignedCount:a,allStructuresLinked:l,structuresData:c,inactiveDraw:h,isMatchPlay:m,drawId:I};e.drawAnalysis[I]=v}),{...H,drawsAnalysis:e}}function M8({matchPlayDrawPositions:t=!0,tournamentRecord:e,drawDefinition:i,drawId:r}){if(!e)return{error:Ie};if(!i)return{error:_e};let n=[],{drawsAnalysis:a}=TS({tournamentRecord:e});if(a.canBePruned.includes(r)){let s=a.matchPlay.includes(r),o=a.drawAnalysis[r],{structures:[l]}=Js({stageSequence:1,drawDefinition:i,stage:xe}),u=o.structuresData.find(({structureId:f})=>l.structureId===f),c=(l.matchUps??[]).sort((f,m)=>f.roundPosition-m.roundPosition);n=c.filter(({roundNumber:f})=>!u.inactiveRounds.includes(f));let d=n.map(Ir),p=c.map(Ir).filter(f=>!d.includes(f));if(s){let f=n.filter(({roundNumber:v})=>!u.inactiveRounds.includes(v)).filter(({winningSide:v})=>v),m=f.map(Ir),h=d.filter(v=>!m.includes(v));p.push(...h);let g=f.flatMap(v=>v.drawPositions??[]).filter(Boolean).flat(),I=Object.assign({},...g.map((v,w)=>({[v]:w+1})));if(f.forEach(v=>{t?v.drawPositions=v.drawPositions.map(w=>I[w]):delete v.drawPositions}),t){let v=l?.positionAssignments?.filter(w=>g.includes(w.drawPosition)).map(w=>(w.drawPosition=I[w.drawPosition],w));l.positionAssignments=v}else l.positionAssignments=[];l.matchUps=f,n=f}Pu({tournamentId:e?.tournamentId,matchUpIds:p,drawDefinition:i}),ti({drawDefinition:i})}return{...H,matchUps:n}}function EUe({isPositionAction:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,loserMatchUp:n,matchUpsMap:a,structureId:s,structure:o,event:l}){if(!i)return{error:_e};if(o||({structure:o}=et({drawDefinition:i,structureId:s})),!o)return{error:Ii};s||({structureId:s}=o);let u="assignDrawPositionQualifier";Gt({method:u,color:"cyan",drawPosition:r}),a??=kr({drawDefinition:i});let{positionAssignments:c}=Yt({structure:o}),{activeDrawPositions:d}=dv({drawDefinition:i,structureId:s});if(c?.find(I=>I.drawPosition===r)?.qualifier)return{...H};let p=!!(n&&a.drawMatchUps.some(I=>I.loserMatchUpId===n?.matchUpId&&Fr(I.matchUpStatus)));if(d?.includes(r)&&!p)return{error:Rw};let f=c?.find(I=>I.drawPosition===r);if(!f)return{error:eh};let{containsQualifier:m,containsParticipant:h}=hL(f);if(m)return{...H};let g=Tt({tournamentRecord:e,drawDefinition:i,event:l}).appliedPolicies??{};return c?.forEach(I=>{I.drawPosition===r&&(I.qualifier=!0,p&&(I.participantId=void 0,console.log("oddity: invalid participantId on qualifier position cleared")))}),fc({tournamentId:e?.tournamentId,drawDefinition:i,structure:o,event:l}),RUe({assignedParticipantId:h,isPositionAction:t,appliedPolicies:g,drawDefinition:i,drawPosition:r,structureId:s,stack:u})}function RUe({assignedParticipantId:t,isPositionAction:e,appliedPolicies:i,drawDefinition:r,drawPosition:n,structureId:a,stack:s}){return e&&qw({appliedPolicies:i,drawDefinition:r,positionAction:{removedParticipantId:t,drawPosition:n,structureId:a,name:s}}),z({result:{...H},stack:s})}function N8({tournamentRecord:t,drawDefinition:e,participantId:i,drawPosition:r,structureId:n,qualifier:a,event:s,bye:o}){if(!e)return{error:_e};if(!r)return{error:JI};if(!n)return{error:Va};if(o){let l=Wa({tournamentRecord:t,drawDefinition:e,drawPosition:r,structureId:n,event:s});if(l.error)return l}else if(a){let l=EUe({tournamentRecord:t,drawDefinition:e,drawPosition:r,structureId:n,event:s});if(l.error)return l}else{let l=ol({participantId:i,tournamentRecord:t,drawDefinition:e,drawPosition:r,structureId:n,event:s});if(l.error)return l}return{...H}}function A8(t){let e=t.matchUpIds??[],{drawDefinition:i}=t,r=t.structureId??i?.structures?.find(l=>l.matchUps?.some(({matchUpId:u})=>e.includes(u)))?.structureId??i?.structures?.[0]?.structureId;if(!r)return{error:Ii};let n=i.structures?.find(l=>l.structureId===r);if(!n)return{error:Ii};let a=n?.matchUps,s=a?.find(l=>!!l.roundPosition);if(n.structures||s||n.finishingPosition===lh)return{error:Qp};let o=a.filter(({roundNumber:l})=>t.roundNumbers?.includes(l)).map(Ir);return e=e.filter(l=>!o.includes(l)),t.roundNumbers&&!e.length&&(e=o),{existingMatchUps:a,matchUpIds:e,structureId:r,structure:n}}function k8(t){let e=Ge(t,[{[mn]:!0},{[rI]:{[Vw]:!1,roundNumbers:!1},[Fa]:ie,[zn]:an}]);if(e.error)return e;let{removeIncomplete:i=!1,removeUnAssigned:r=!0,removeCompleted:n=!1,tournamentRecord:a,drawDefinition:s,event:o}=t,l=A8(t);if(l.error)return l;let{structure:u,structureId:c,existingMatchUps:d,matchUpIds:p}=l,f=[],m=d?.filter(({matchUpId:I,score:v,winningSide:w})=>{if(w&&!n)return!1;if(w||cr({score:v})){if(!w&&!i)return!1;f.push(I)}else if(!r)return!1;return p?.includes(I)})??[],h=m.map(Ir),g=m.map(({tieMatchUps:I})=>I?.map(Ir)).filter(Boolean).flat();if(h.length){u.matchUps=(u.matchUps??[]).filter(({matchUpId:w})=>!h.includes(w)),Pu({tournamentId:a?.tournamentId,matchUpIds:[...g,...h],action:"deleteAdHocMatchUps",eventId:o?.eventId,drawDefinition:s});let I=rt(u.matchUps.map(ba("roundNumber"))),v=gIe(I);if(v.length){v.reverse();for(let w of v)u.matchUps.forEach(y=>{y.roundNumber&&y.roundNumber>w&&(y.roundNumber-=1,St({tournamentId:a?.tournamentId,context:["adHoc round deletion"],eventId:o?.eventId,drawDefinition:s,matchUp:y}))})}if(f.length){u.positionAssignments=rt(u.matchUps.flatMap(U=>(U.sides??[]).map(T=>T.participantId)).filter(Boolean)).map(U=>({participantId:U}));let w=u?.matchUpFormat??s?.matchUpFormat??o?.matchUpFormat,y=l.existingMatchUps.some(U=>U.matchUpType===ka)?{matchUpTypes:[ka]}:void 0,{matchUps:b}=Nt({afterRecoveryTimes:!1,inContext:!0,matchUpFilters:y,structure:u,event:o});Vn({structure:u})&&(u.positionAssignments=rt(b.flatMap(U=>(U.sides??[]).map(T=>T.participantId)).filter(Boolean)).map(U=>({participantId:U})));let S=YL({positionAssignments:u.positionAssignments,tournamentRecord:a,drawDefinition:s,matchUpFormat:w,matchUps:b,event:o});S.error&&console.log(S)}ti({structureIds:[c],eventId:o?.eventId,drawDefinition:s})}return!h.length&&p.length?{error:kw}:{...H,deletedMatchUpsCount:[...h,...g].length}}function O8({removeCompletedMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:r,roundNumber:n,event:a}){if(!e)return{error:Ie};if(!i)return{error:_e};if(!n)return z({result:{error:Xe},info:"roundNumber required"});let s=et({drawDefinition:i,structureId:r});if(s.error)return s;let o=s.structure;return o?.structures?{error:Qp}:Vn({structure:o})?CUe({tournamentId:e.tournamentId,removeCompletedMatchUps:t,eventId:a.eventId,drawDefinition:i,roundNumber:n,structure:o}):(console.log("not implemented"),{...H})}function CUe({removeCompletedMatchUps:t,drawDefinition:e,tournamentId:i,roundNumber:r,structure:n,eventId:a}){let s=n?.matchUps??[],o=[],l=[],u=!1;if(s.reduce((c,d)=>{let p=d?.roundNumber;return p?c.includes(p)?c:c.concat(p):c},[]).sort(ir).includes(r)){let c=s.filter(d=>{let p=d.roundNumber===r&&(!Yi.includes(d.matchUpStatus)||t);return p&&(l.push(d.matchUpId),d.tieMatchUps&&o.push(...d.tieMatchUps.map(Ir))),!p});l.length&&(Pu({matchUpIds:[...o,...l],drawDefinition:e,tournamentId:i,eventId:a}),c.some(d=>d.roundNumber===r)||(c.forEach(d=>{d.roundNumber>r&&(d.roundNumber-=1,St({drawDefinition:e,tournamentId:i,eventId:a,matchUp:d}))}),u=!0),n.matchUps=c)}return{deletedMatchUpsCount:l.length,roundRemoved:u,...H}}function JR(t){let{suppressNotifications:e,tournamentRecord:i,drawDefinition:r,matchUps:n,event:a}=t;if(typeof r!="object")return{error:_e};let s=t?.structureId;if(!s&&r.structures?.length===1&&(s=r.structures?.[0]?.structureId),typeof s!="string")return{error:Va};if(!Ga(n))return{error:ie,info:Ap("matchUps")};let o=r.structures?.find(p=>p.structureId===s);if(!o)return{error:Ii};let l=(o?.matchUps).find(p=>!!p.roundPosition);if(o.structures||l||o.finishingPosition===lh)return{error:Qp};let u=br({tournamentRecord:i,inContext:!1})?.matchUps?.map(Ir)??[],c=n.map(Ir);if(kn(u,c))return{error:U4,info:"One or more matchUpIds already present in tournamentRecord"};o.matchUps.push(...n);let d=n.map(({tieMatchUps:p})=>p).filter(Boolean).flat();return e||(hd({tournamentId:i?.tournamentId,matchUps:[...d,...n],eventId:a?.eventId,drawDefinition:r}),ti({drawDefinition:r,structureIds:[s]})),{...H}}function x8({tournamentRecord:t,drawDefinition:e,drawPosition:i,structureId:r,subOrder:n,event:a}){if(!e)return{error:_e};if(!r)return{error:Va};if(!i)return{error:JI};let{structure:s}=et({drawDefinition:e,structureId:r});if(!s)return{error:Ii};let o=s;s.structures&&s.structureType===fn&&(o=s.structures?.find(f=>f.positionAssignments?.find(m=>m.drawPosition===i)));let l=o?.positionAssignments,u=l?.find(f=>f.drawPosition===i);u&&xt({element:u,extension:{name:aI,value:n}});let c=(a?.eventType===Zt||e.matchUpType===Zt||(a?.tieFormat??e?.tieFormat??s?.tieFormat))&&{matchUpTypes:[Zt]},{matchUps:d}=Nt({structure:o,afterRecoveryTimes:!1,inContext:!0,matchUpFilters:c,event:a}),p=s?.matchUpFormat??e.matchUpFormat;return YL({positionAssignments:l,tournamentRecord:t,drawDefinition:e,matchUpFormat:p,matchUps:d,event:a}),ti({drawDefinition:e,structureIds:[r]}),{...H}}var F8={};ct(F8,{addGoesTo:()=>Np,allPlayoffPositionsFilled:()=>LL,checkValidEntries:()=>tC,findDrawDefinition:()=>a0,getAssignedParticipantIds:()=>df,getAvailableMatchUpsCount:()=>QR,getAvailablePlayoffProfiles:()=>bS,getDrawDefinitionTimeItem:()=>eL,getDrawParticipantRepresentativeIds:()=>r0,getDrawStructures:()=>Js,getDrawTypeCoercion:()=>ES,getEligibleVoluntaryConsolationParticipants:()=>i0,getMatchUpsMap:()=>kr,getParticipantIdFinishingPositions:()=>n0,getPositionAssignments:()=>cI,getPositionsPlayedOff:()=>gv,getRandomQualifierList:()=>l0,getSeedingThresholds:()=>NL,getSeedsCount:()=>RS,getStructureSeedAssignments:()=>ds,getTeamLineUp:()=>Mp,getValidGroupSizes:()=>hS,isAdHoc:()=>Vn,isCompletedStructure:()=>uu,isValidForQualifying:()=>u0,positionActions:()=>o0});function i0({excludedMatchUpStatuses:t=[],includeEventParticipants:e,includeQualifyingStage:i,finishingRoundLimit:r,policyDefinitions:n,roundNumberLimit:a,tournamentRecord:s,drawDefinition:o,matchUpsLimit:l,requirePlay:u,requireLoss:c,allEntries:d,winsLimit:p,event:f}){if(!o)return{error:_e};let m=[xe,Ui];i&&m.push(We);let h=f?.eventType?{matchUpTypes:[f.eventType]}:void 0,g=o?.matchUpType?{matchUpTypes:[o.matchUpType]}:void 0,I=e&&f?Ru({contextFilters:{stages:m},matchUpFilters:h,tournamentRecord:s,inContext:!0,event:f})?.matchUps??[]:Rn({contextFilters:{stages:m},matchUpFilters:g,tournamentRecord:s,inContext:!0,drawDefinition:o})?.matchUps??[],v=dh({stage:Er,drawDefinition:o}),w=new Set(v.map(({participantId:F})=>F)),y={},b={},S={},U={};n??=Fc({policyTypes:[lO],tournamentRecord:s,drawDefinition:o,event:f}).policyDefinitions;let T=n?.[lO];t=t.length&&t||T?.excludedMatchUpStatuses||[],e=e??T?.includeEventParticipants,d=d??T?.allEntries,r=r??T?.finishingRoundLimit,a=a??T?.roundNumberLimit,l=l??T?.matchUpsLimit,u??=T?.requirePlay??!0,c??=T?.requireLoss??!0,p=p??T?.winsLimit;for(let F of I){if(u&&F.winningSide&&![1,2].includes(F.winningSide)&&F.matchUpStatus!==wi||F.finishingRound&&r&&F.finishingRound>=r||F.finishingRound&&a&&F.finishingRound<=a)continue;let x=F.sides?.find(({sideNumber:$})=>F.winningSide&&$===3-F.winningSide),L=F.sides?.find(({sideNumber:$})=>F.winningSide&&$===F.winningSide);if(F.sides?.forEach($=>{let V=$?.participant?.participantId;V&&(S[V]=$.participant,F.matchUpStatus===wi&&!u&&(b[V]=$.participant,y[V]||(y[V]=0),(!F.matchUpStatus||!t.includes(F.matchUpStatus))&&(y[V]+=1)))}),x?.participant){let $=x.participant.participantId;b[$]=x.participant,y[$]||(y[$]=0),F.matchUpStatus&&!t.includes(F.matchUpStatus)&&(y[$]+=1)}if(L?.participant){let $=L.participant.participantId;U[$]||(U[$]=0),U[$]+=1,y[$]||(y[$]=0),F.matchUpStatus&&!t.includes(F.matchUpStatus)&&(y[$]+=1)}}let P=s?.participants&&!u&&!c&&d,D;e&&f?D=f.entries:D=o.entries;let E=P?(D??[]).filter(F=>![hc,ys].includes(F.entryStatus)).map(({participantId:F})=>F):[],R=Object.keys(b),C=P?(s?.participants??[]).filter(({participantId:F})=>E.includes(F)):c&&Object.values(b)||Object.values(S),M=F=>!c||R.includes(F),N=F=>!u||(y[F]||0)>=0,A=F=>!p||(U[F]||0)<=p,O=F=>!l||y[F]<=l,k=F=>!w.has(F);return{eligibleParticipants:C.filter(F=>M(F.participantId)&&N(F.participantId)&&A(F.participantId)&&O(F.participantId)&&k(F.participantId)).map(F=>({...F,individualParticipants:F.individualParticipantIds?.map(x=>s?.participants?.find(L=>L.participantId===x))})),losingParticipantIds:R,...H}}function QR(t){let e=Ge(t,[{drawDefinition:!0}]);if(e.error)return e;let{drawDefinition:i,roundNumber:r}=t,n=t.structureId??(i.structures?.length===1&&i.structures?.[0]?.structureId);if(typeof n!="string")return{error:Va};let a=i.structures?.find(m=>m.structureId===n);if(!a)return{error:Ii};let s,o=(a.matchUps??[])?.reduce((m,h)=>(h.roundPosition&&(s=!0),(h?.roundNumber||0)>m?h.roundNumber:m),0);if(a.structures||s||a.finishingPosition===lh)return{error:Qp};let l=i?.entries?.filter(m=>{let h=m.entryStatus;return so.includes(h)})??[],u=Math.floor(l?.length/2)||1,c=r??o??1,d=a.matchUps?.filter(m=>m.roundNumber===c)?.length??0,p=u-d,f=p>0?p:0;return{...H,availableMatchUpsCount:f,lastRoundNumber:o,roundMatchUpsCount:u}}function r0({drawDefinition:t}){let e=mt({name:"participantRepresentatives",element:t});return e.error?e:{representativeParticipantIds:e.extension?.value||[]}}function MUe({tournamentParticipants:t,drawDefinition:e,event:i}){if(!e)return{error:_e};let r=Qi({tournamentParticipants:t,inContext:!0,drawDefinition:e,event:i}),n=ke(r.matchUps,!1,!0),a=rt(n.reduce((o,l)=>o.concat(...l.sides.map(u=>u.participantId).filter(Boolean)),[])),s=Object.assign({},...a.map(o=>{let l=n.filter(u=>u.sides.map(c=>c.participantId).filter(Boolean).includes(o));return{[o]:l}}));return{participantIds:a,participantIdMatchUps:s}}function cI({tournamentRecord:t,drawDefinition:e,stage:i=xe,structureId:r,structure:n}){if(!t)return{error:Ie};if(!n&&!e)return{error:_e};if(!n&&!r&&e?.structures?.filter(o=>o.stage===i).length===1&&(n=e.structures.find(o=>o.stage===i)),!n&&!r)return{error:Va};let{error:a,positionAssignments:s}=Yt({drawDefinition:e,structureId:r,structure:n});return{positionAssignments:s??[],structureId:n?.structureId,error:a}}function L8({dates:t=[],extension:e}){if(!e)return!1;if(typeof e.value=="boolean"&&e.value)return!0;if(!t.length)return!1;let i=bt(e.value)?e.value?.dates:void 0;if(Array.isArray(i))return i?.length?!!i.filter(r=>!t.length||t.includes(r)).length:!1}function NUe({inContextCourt:t,venue:e}){let{defaultStartTime:i,defaultEndTime:r,dateAvailability:n}=e;if(!(i||r||n?.length))return;let a=t.dateAvailability;if(!a?.length){n?.length?t.dateAvailability=n.map(s=>({...s})):i&&r&&(t.dateAvailability=[{startTime:i,endTime:r}]);return}t.dateAvailability=a.map(s=>{let o=AUe({date:s.date,venueDateAvailability:n,defaultStartTime:i,defaultEndTime:r});if(!o)return s;let l=kUe(s.startTime,o.startTime),u=OUe(s.endTime,o.endTime),c=xUe(s.bookings,o.bookings);return{...s,startTime:l,endTime:u,...c.length?{bookings:c}:{}}})}function AUe({date:t,venueDateAvailability:e,defaultStartTime:i,defaultEndTime:r}){if(e?.length){if(t){let a=e.find(s=>s.date===t);if(a)return a}let n=e.find(a=>!a.date);if(n)return n}if(i||r)return{startTime:i,endTime:r}}function kUe(t,e){return t?e?t>e?t:e:t:e}function OUe(t,e){return t?e?t<e?t:e:t:e}function xUe(t,e){let i=[];return t?.length&&i.push(...t),e?.length&&i.push(...e),i}function _8({convertExtensions:t,ignoreDisabled:e,venue:i,court:r}){let n={...ke(r,t,!0),venueId:i.venueId},{extension:a}=mt({name:Io,element:r});if(e&&a){let s=bt(a.value)?a.value?.dates:void 0,o=a?.value===!0?[]:n.dateAvailability.map(l=>{let u=l.date;if(!(!u||s.includes(u)))return l}).filter(Boolean);n.dateAvailability=o}return NUe({inContextCourt:n,venue:i}),{inContextCourt:n}}function FUe(t,e,i){if(e.length&&!e.includes(t.venueId))return!1;if(i){let{extension:r}=mt({name:Io,element:t});if(r?.value)return!1}return!0}function LUe({venue:t,convertExtensions:e,ignoreDisabled:i,dates:r,uniqueVenueIds:n,venues:a,uniqueCourtIds:s,courts:o}){n.includes(t.venueId)||(a.push(ke(t,e,!0)),n.push(t.venueId));for(let l of t.courts??[])if(!s.includes(l.courtId)){if(i){let{extension:c}=mt({name:Io,element:l});if(L8({extension:c,dates:r}))continue}let{inContextCourt:u}=_8({convertExtensions:e,ignoreDisabled:i,venue:t,court:l});o.push(u),s.push(l.courtId)}}function Cu(t){let{convertExtensions:e,ignoreDisabled:i,venueIds:r=[],dates:n}=t,a=t.tournamentRecords||t.tournamentRecord&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord}||{},s=[],o=[],l=[],u=[];return Object.keys(a).filter(c=>!t.tournamentId||c===t.tournamentId).forEach(c=>{let d=a[c];for(let p of d.venues??[])FUe(p,r,!!i)&&LUe({venue:p,convertExtensions:e,ignoreDisabled:i,dates:n,uniqueVenueIds:s,venues:u,uniqueCourtIds:o,courts:l})}),{courts:l,venues:u,...H}}function _Ue({convertExtensions:t,tournamentRecord:e,ignoreDisabled:i,dates:r}){if(!e)return{error:Ci};let n=ke(e.venues??[],t).filter(s=>{if(!i)return s;let{extension:o}=mt({name:Io,element:s});return!o?.value&&s}).filter(Boolean),a=n.reduce((s,o)=>{let l=(o?.courts||[]).filter(u=>{if(!i&&!r?.length)return u;let{extension:c}=mt({name:Io,element:u});return L8({extension:c,dates:r})}).filter(Boolean).map(u=>{let{inContextCourt:c}=_8({convertExtensions:t,ignoreDisabled:i,venue:o,court:u});return c});return l.length?s.concat(l):s},[]);return{venues:n,courts:a}}function DS({tournamentRecords:t,requireCourts:e,dates:i}){return typeof t!="object"||!Object.keys(t).length?{error:Ci}:Object.keys(t).reduce((r,n)=>{let a=t[n],{venues:s}=_Ue({tournamentRecord:a,dates:i});return s?.forEach(o=>{let{venueId:l,courts:u}=o;(!e||u?.length)&&!r.venueIds.includes(l)&&(r.venues.push(o),r.venueIds.push(l))}),r},{venues:[],venueIds:[]})}function $8({event:t}){let{surfaceCategory:e,onlineResources:i,matchUpFormat:r,discipline:n,eventLevel:a,eventName:s,eventType:o,startDate:l,category:u,ballType:c,eventId:d,endDate:p,gender:f,notes:m}=t;return{eventInfo:{drawDefinitionCount:t.drawDefinitions?.length,surfaceCategory:e,onlineResources:i,matchUpFormat:r,discipline:n,eventLevel:a,eventName:s,eventType:o,ballType:c,startDate:l,category:u,endDate:p,eventId:d,gender:f,notes:m}}}var $Ue="IN_PROGRESS",BUe="ABANDONED",VUe="CANCELLED",jUe="COMPLETED",GUe="ACTIVE",B8="tournamentImage",V8={TOURNAMENT_IMAGE_RESOURCE_NAME:B8,IN_PROGRESS:$Ue,ABANDONED:BUe,CANCELLED:VUe,COMPLETED:jUe,ACTIVE:GUe},HUe={[jw]:{policyName:"Staff Privacy Policy",participant:{contacts:!1,individualParticipants:!1,individualParticipantIds:!1,onlineResources:!1,participantName:!0,participantOtherName:!0,participantId:!0,participantRole:!0,participantRoleResponsibilities:!0,participantStatus:!0,penalties:!1,representing:!0,participantType:!0,person:{addresses:!1,biographicalInformation:!1,birthDate:!1,contacts:!1,nationalityCode:!0,nativeFamilyName:!1,nativeGivenName:!1,onlineResources:!1,otherNames:!0,parentOrganisationId:!1,passportFamilyName:!1,passportGivenName:!1,personId:!1,personOtherIds:!1,previousNames:!1,sex:!1,standardFamilyName:!0,standardGivenName:!0,status:!1,tennisId:!1,wheelchair:!0}}}},WUe=HUe;function Th(t){let{tournamentRecord:e,withMatchUpStats:i,withStructureDetails:r,withVenueData:n}=t??{};if(!e)return{error:Ie};let a=(({tournamentId:m,tournamentRank:h,tournamentStatus:g,formalName:I,tournamentName:v,promotionalName:w,onlineResources:y,localTimeZone:b,activeDates:S,startDate:U,endDate:T,hostCountryCode:P,venues:D,notes:E,updatedAt:R})=>({tournamentId:m,tournamentRank:h,tournamentStatus:g,formalName:I,tournamentName:v,promotionalName:w,onlineResources:y,localTimeZone:b,activeDates:S,startDate:U,endDate:T,hostCountryCode:P,venues:D,notes:E,updatedAt:R}))(e),s=e.venues?.find(m=>m.isPrimary);s?.addresses?.length&&(a.tournamentAddress=s.addresses[0]);let o=Ei({participantFilters:{participantRoles:[T7,UL,D7,P7,R7]},policyDefinitions:WUe,tournamentRecord:e})?.participants??[];o&&(a.tournamentContacts=o);let l=e?.onlineResources?.find(m=>m.name===B8&&m.resourceType==="URL")?.identifier;l&&(a.imageUrl=l);let u=vh({tournamentRecord:e})?.publishState,c=u?.tournament?.status?.publishedEventIds||[],d=[];for(let m of e.events??[])if(!t?.usePublishState||c.includes(m.eventId)){let h=$8({event:m}).eventInfo;h&&d.push(h)}a.timeItemValues=P8({element:e}),a.publishState=u?.tournament,a.eventInfo=d;let p=[],f=[];if(i||r)for(let m of e.events??[])for(let h of m.drawDefinitions??[])for(let g of h.structures??[])f.push(...g.matchUps??[]),p.push(Ve({eventId:m.eventId,eventName:m.eventName,eventType:m.eventType,drawId:h.drawId,drawName:h.drawName,drawType:h.drawType,structureId:g.structureId,structureName:g.structureName,stage:g.stage,stageSequence:g.stageSequence,positionAssignments:g.positionAssignments,seedAssignments:g.seedAssignments,matchUpFormat:g.matchUpFormat}));if(r&&(a.structures=p),i){let m=e.participants?.filter(S=>S.participantType===gt).length??0,h=e.participants?.filter(S=>S.participantType===Lt).length??0,g=e.events?.length??0,I=f?.filter(S=>S.matchUpStatus!=="BYE"),v=I?.length,w=I?.filter(S=>Yi.includes(S.matchUpStatus)||S.winningSide)?.length,y=I?.filter(S=>cf({matchUp:S})?.scheduledDate||cL({matchUp:S})?.scheduledTime)?.length,b=v>0?Math.round(w/v*100):0;a.matchUpStats={total:v,completed:w,scheduled:y,percentComplete:b},a.individualParticipantCount=m,a.teamParticipantCount=h,a.eventCount=g}if(n){let{venues:m}=Cu({tournamentRecord:e});a.venues=m??[]}return{tournamentInfo:ke(Ve(a),!1,!0),...H}}function j8({publishStatus:t,drawId:e}){return t?.drawDetails?Bo(t.drawDetails?.[e]?.publishingDetail):t?.drawIds?t.drawIds.includes(e):!0}var G8="PUBLIC",zUe="ADMIN",qUe={PUBLIC_DISPLAY:G8,ADMIN_DISPLAY:zUe};function ZR(t){let{tournamentParticipants:e=[],includePositionAssignments:i,policyDefinitions:r,tournamentRecord:n,inContext:a=!0,usePublishState:s,status:o=Ha,pressureRating:l,refreshResults:u,contextProfile:c,drawDefinition:d,noDeepCopy:p,sortConfig:f,context:m,event:h}=t;if(!d)return{error:_e};let{matchUpFormat:g,updatedAt:I,drawType:v,drawName:w,drawId:y}=d,b={matchUpFormat:g,updatedAt:I,drawName:w,drawType:v,drawId:y};b.display=mt({element:d,name:XD}).extension?.value;let S={},U,T,{allStructuresLinked:P,sourceStructureIds:D,hasDrawFeedProfile:E,structureGroups:R}=HR({drawDefinition:d});if(!P)return{error:P6};let C=t?.eventPublishState??vh({event:h}).publishState,M=t?.publishStatus??za({event:h,status:o}),N=C?.status?.drawDetails?.[d.drawId],A=!!C?.status?.published,O=N?.structureDetails,k=!1,F=!1,x=R.map(L=>{let $={},V=L.map(_=>{let{structure:B}=et({drawDefinition:d,structureId:_}),{seedAssignments:G}=ds({drawDefinition:d,structure:B});return B?.stage===xe&&B.stageSequence===1&&(U=G),B?.stage===We&&(S[B.stageSequence??0]=G),B}).sort((_,B)=>ch(_,B,f)).map(_=>{if(!_)return;let B=_?.structureId,G=[];_.stage&&[xe,Zr,Ui].includes(_.stage)&&(G=U),_?.stage===We&&(G=S[_.stageSequence??0]);let{matchUps:j,roundMatchUps:K,roundProfile:Y}=Nt({seedAssignments:_?.seedAssignments?.length?void 0:G,context:{drawId:b.drawId,...m},hydrateParticipants:t.hydrateParticipants,participantsProfile:t.participantsProfile,tournamentParticipants:e,policyDefinitions:r,tournamentRecord:n,usePublishState:s,publishStatus:M,contextProfile:c,drawDefinition:d,inContext:a,structure:_,event:h}),{positionAssignments:X}=Yt({structure:_}),Z=X?.filter(ba(su)).map(ne=>{let le=mt({element:ne,name:pc})?.extension?.value,{drawPosition:de,participantId:pe}=ne;return F=!0,{participantResult:le,participantId:pe,drawPosition:de}});if(j.length&&(!Z?.length&&t.allParticipantResults||u&&!_.structures)){let{subOrderMap:ne}=yL({positionAssignments:X}),le=j.some(pe=>pe.matchUpType===ka)?j.filter(pe=>pe.matchUpType===ka):j,de=Ih({matchUpFormat:_.matchUpFormat,matchUps:le,policyDefinitions:r,pressureRating:l,subOrderMap:ne});T=de?.report,Z=X?.filter(ba(su)).map(pe=>{let{drawPosition:ge,participantId:Me}=pe;return F=!0,{participantResult:Me&&de?.participantResults?.[Me],participantId:Me,drawPosition:ge}})}let J=_?{stageSequence:_.stageSequence,structureName:_.structureName,structureType:_.structureType,matchUpFormat:_.matchUpFormat,stage:_.stage}:{},ae=mt({element:_,name:XD}).extension?.value;J.display=ae?.[G8]??ae,J.sourceStructureIds=D[B],J.hasDrawFeedProfile=E[B],J.positionAssignments=X,J.structureActive=j.reduce((ne,le)=>{let de=[wi,Hi,ao,ki,Oc,Qt,$r,mi].includes(le.matchUpStatus);return ne||de||!!le.winningSide||!!le.score?.scoreStringSide1},!1);let te=j.every(ne=>[...Yi,"BYE"].includes(ne.matchUpStatus));return J.structureCompleted=te,$[B]=te,J.structureActive&&(k=!0),{...J,participantResults:Z,seedAssignments:G,roundMatchUps:K,roundProfile:Y,structureId:B,report:T}});return V.forEach(_=>{i||delete _.positionAssignments,_.sourceStructuresComplete=_.sourceStructureIds?.every(B=>$[B])}),V}).flat().filter(L=>!s||Bo(O?.[L?.structureId])||!0);return b.drawActive=k,b.participantPlacements=F,b.drawGenerated=x?.reduce((L,$)=>L||!!$?.roundMatchUps,!1),b.drawCompleted=x?.reduce((L,$)=>L&&$.structureCompleted,!0),b.drawPublished=s?A&&j8({publishStatus:M,drawId:b.drawId}):void 0,{structures:!s||b.drawPublished?p&&x||ke(x,!1,!0):void 0,drawInfo:p?b:ke(b,!1,!0),...H}}function PS(t){let{includePositionAssignments:e,participantsProfile:i,policyDefinitions:r,usePublishState:n,status:a=Ha,contextProfile:s,sortConfig:o}=t,l=Ge(t,[{tournamentRecord:!0},{[CF]:{event:!1,eventId:!1}}]);if(l.error)return l;let u=ke(t.tournamentRecord,!1,!0),c=t.event==null?jn({tournamentRecord:u,eventId:t.eventId}).event:void 0,d=t.event?ke(t.event,!1,!0):c&&ke(c,!1,!0)||void 0;if(!d)return{error:os};let{eventId:p}=d,{tournamentId:f,endDate:m}=u,h=za({event:d,status:a}),g=vh({event:d}).publishState??{},I=!!g?.status?.published,{participants:v}=Ei({participantFilters:t.participantFilters,withEvents:!1,withDraws:!1,policyDefinitions:r,...i,tournamentRecord:u}),w=({stage:C,drawId:M})=>{if(!n)return!0;let N=h?.drawDetails?.[M]?.stageDetails;return!N||!Object.keys(N).length?!0:Bo(N[C])},y=({structureId:C,drawId:M})=>{if(!n)return!0;let N=h?.drawDetails?.[M]?.structureDetails;return!N||!Object.keys(N).length?!0:Bo(N[C])},b=({drawId:C})=>n?j8({publishStatus:h,drawId:C}):!0,S=({drawId:C,drawType:M,structure:N})=>{if(!n||M!==na)return N;let A=h?.drawDetails?.[C]?.structureDetails?.[N.structureId]?.roundLimit;if(ot(A)){let O=Re(1,A+1),k={},F={};for(let x of O)N.roundMatchUps[x]&&(k[x]=N.roundMatchUps[x],F[x]=N.roundProfile[x]);N.roundMatchUps=k,N.roundProfile=F}return N},U=d.drawDefinitions||[],T=!n||I?U.filter(b).map(C=>(({drawInfo:M,structures:N})=>({...M,structures:N}))(ZR({allParticipantResults:t.allParticipantResults,hydrateParticipants:t.hydrateParticipants,context:{eventId:p,tournamentId:f,endDate:m},pressureRating:t.pressureRating,refreshResults:t.refreshResults,includePositionAssignments:e,tournamentParticipants:v,eventPublishState:g,noDeepCopy:!0,policyDefinitions:r,tournamentRecord:u,usePublishState:n,contextProfile:s,drawDefinition:C,publishStatus:h,sortConfig:o,event:d}))).map(({structures:C,...M})=>{let N=C?.filter(({stage:A,structureId:O})=>y({structureId:O,drawId:M.drawId})&&w({stage:A,drawId:M.drawId})).map(A=>S({drawId:M.drawId,drawType:M.drawType,structure:A}));return{...M,structures:N}}).filter(C=>C.structures?.length):void 0,P=(Array.isArray(u.venues)?u.venues:[]).map(C=>{let{venueData:M}=oI({venueId:C.venueId,tournamentRecord:u});return{...M}}),D=(({eventId:C,eventName:M,eventType:N,eventLevel:A,surfaceCategory:O,matchUpFormat:k,category:F,gender:x,startDate:L,endDate:$,ballType:V,discipline:_})=>({eventId:C,eventName:M,eventType:N,eventLevel:A,surfaceCategory:O,matchUpFormat:k,category:F,gender:x,startDate:L,endDate:$,ballType:V,discipline:_}))(d);D.display=mt({element:d,name:XD}).extension?.value;let{tournamentInfo:E}=Th({tournamentRecord:u}),R={tournamentInfo:E,venuesData:P,eventInfo:D,drawsData:T};return R.eventInfo.publishState=g,R.eventInfo.published=g?.status?.published,{...H,eventData:R,participants:v}}function n0({byeAdvancements:t=!1,tournamentRecord:e,drawDefinition:i,event:r}){if(!i)return{error:_e};let{participantIds:n,participantIdMatchUps:a}=MUe({tournamentParticipants:e?.participants,drawDefinition:i}),s=Object.values(a).some(p=>p.some(f=>f.containerStructureId)),o=(s&&PS({tournamentRecord:e,event:r}))?.eventData?.drawsData?.find(p=>p.drawId===i.drawId)?.structures,l=i?.structures?.find(p=>p.stage===xe&&p.stageSequence===1),u=l?.structureType===fn&&l.structures,c=(s?cI({tournamentRecord:e,drawDefinition:i,structureId:l?.structureId})?.positionAssignments:void 0)?.length||0,d=n?.map(p=>{let f=a[p].filter(I=>[ki,"BYE"].includes(I.matchUpStatus)||I.winningSide),m=f.map(I=>{let v=I.sides.find(y=>y.bye),w=I.sides.find(y=>y.participantId===p).sideNumber;if(I.containerStructureId){let y=YUe({containedStructures:u,drawPositionsCount:c,drawDataStructures:o,drawDefinition:i,participantId:p,matchUp:I});if(y)return y}return(I.winningSide||t&&v&&w)===w?I.finishingPositionRange.winner:I.finishingPositionRange.loser}),h=I=>Math.abs(I[0]-I[1]),g=m.reduce((I,v)=>I&&h(I)<h(v)?I:v,void 0);return{[p]:{finishingPositionRanges:m,finishingPositionRange:g,relevantMatchUps:f}}})||[];return Object.assign({},...d)}function YUe({containedStructures:t,drawPositionsCount:e,drawDataStructures:i,drawDefinition:r,participantId:n,matchUp:a}){let s=t?.find(f=>f.structureId===a.structureId)?.positionAssignments?.length,o=i.find(f=>f.structureId===a.containerStructureId)?.participantResults?.find(f=>f.participantId===n)?.participantResult,{ties:l,groupOrder:u,provisionalOrder:c}=o||{},d=t?.length,p=r.structure?.find(f=>f.stage===Ui);if(ra()&&console.log({drawPositionsCount:e,provisionalOrder:c,bracketsCount:d,bracketSize:s,groupOrder:u,ties:l}),e===s&&u)return[u,u];if(d>1&&u&&!p)return[1,d];if(d>1&&u&&p){let f=r.links?.find(h=>h.source.structureId===a.containerStructureId)?.source?.finishingPositions,m=f.length*d;if(u in f)return[1,m];{let h=(s-u)*d;return[m+1,e-h]}}}function Gd({tournamentRecords:t,tournamentRecord:e,tournamentId:i,drawId:r}){if(!e&&!t)return{error:Ie};if(!r)return{error:Oo};if(!e&&t){if(typeof i!="string"&&(i=T8({tournamentRecords:t,drawId:r}),!i))return{error:Yg};if(e=t[i],!e)return{error:Ie}}let n=e&&jn({tournamentRecord:e,drawId:r});return n?.drawDefinition?{drawDefinition:n.drawDefinition,event:n.event,tournamentRecord:e,...H}:z({result:{error:Oa},stack:"findDrawDefinition"})}function a0(t){let{drawDefinition:e,error:i}=Gd(t);return i?{error:i}:{drawDefinition:ke(e)}}function KUe({tournamentParticipants:t,returnParticipants:e,drawPosition:i,participant:r,drawId:n,event:a}){let s=a?.entries?.filter(({entryStatus:o})=>[ys,of].includes(o)).map(({participantId:o})=>o)||[];if(s.length){let o=r.individualParticipantIds,l=e?t.filter(({participantId:c})=>s.includes(c)):void 0,u=e?t.filter(({participantId:c})=>o.includes(c)):void 0;return{validModifyAssignedPairAction:Ve({payload:{participantId:r.participantId,replacementIndividualParticipantId:void 0,existingIndividualParticipantId:void 0,drawPosition:i,drawId:n},method:JSe,availableIndividualParticipantIds:s,availableIndividualParticipants:l,existingIndividualParticipantIds:o,existingIndividualParticipants:u,type:VL},!1,!1,!0)}}return{}}function Op(t){let{inContextDrawMatchUps:e,targetData:i,drawDefinition:r,relevantLink:n}=t;if(n?.linkCondition===al&&i?.matchUp?.matchUpStatus==="BYE")return!1;let{targetMatchUps:{loserMatchUp:a,winnerMatchUp:s},targetLinks:o}=i,l=a&&On({matchUpId:a.matchUpId,inContextDrawMatchUps:e,drawDefinition:r}),u=l?.targetMatchUps?.loserMatchUp,c=l?.targetMatchUps?.loserMatchUpDrawPositionIndex,d=u?.sides[c]?.participant,p=Fr(a?.matchUpStatus),f=p&&!d,m=a?.sides?.filter(w=>w?.participant).length??0,h=a?.winningSide&&p&&m===1,g=s?.drawPositions?.filter(Boolean).length||0;if(!h&&(a?.winningSide&&!f||s?.winningSide&&g===2&&(!s.feedRound||!Fr(s?.matchUpStatus))))return!0;let I=s&&On({matchUpId:s.matchUpId,inContextDrawMatchUps:e,drawDefinition:r}),v=l&&Op({relevantLink:o?.loserTargetLink,targetData:l,inContextDrawMatchUps:e,drawDefinition:r});return!!(I&&Op({targetData:I,inContextDrawMatchUps:e,drawDefinition:r})||v)}var XUe={[Rp]:{policyName:"positionActionsDefault",enabledStructures:[{stages:[We,xe],stageSequences:[1],enabledActions:[],disabledActions:[]},{stages:[],stageSequences:[],enabledActions:[lP,uI,WR,Vy],disabledActions:[]}],disbledStructures:[],otherFlightEntries:!1,activePositionOverrides:[]}},iD="positionAction",TO="matchUpAction";function H8({actionType:t=iD,appliedPolicies:e,drawDefinition:i,structure:r}){let n=t===iD&&Rp||t===TO&&Rr,a=t===iD&&XUe||t===TO&&U7,s=n&&(e?.[n]||a?.[n]),o=i.links?.filter(d=>d?.target?.structureId===r?.structureId)?.map(({target:d})=>d.feedProfile)??[],{enabledStructures:l,disabledStructures:u}=s||{},c=u?.find(d=>{let{stages:p,stageSequences:f,structureTypes:m,feedProfiles:h}=d;return(!h?.length||Array.isArray(h)&&h.some(g=>o.includes(g)))&&(!p?.length||Array.isArray(p)&&p?.includes(r?.stage))&&(!m?.length||Array.isArray(m)&&m?.includes(r?.structureType))&&(!f?.length||Array.isArray(f)&&f.includes(r?.stageSequence))});return{enabledStructures:l,actionsDisabled:c,actionsPolicy:s}}function JUe({activePositionOverrides:t,activeDrawPositions:e,action:i}){return i&&t.includes(i)?!0:!e.length}function W8({enabledStructures:t,drawDefinition:e,structure:i}){if(t===!1)return{};if(!t?.length)return{policyActions:{enabledActions:[],disabledActions:[]}};let{stage:r,stageSequence:n,structureType:a}=i||{},s=e.links?.filter(o=>o?.target?.structureId===i?.structureId)?.map(({target:o})=>o.feedProfile)||[];return{policyActions:t.find(o=>{let{stages:l,stageSequences:u,structureTypes:c,feedProfiles:d}=o||{},p=!l?.length||Array.isArray(l)&&l.includes(r),f=!u?.length||Array.isArray(u)&&u.includes(n),m=!c?.length||Array.isArray(c)&&c.includes(a),h=!d?.length||Array.isArray(d)&&d.some(g=>s.includes(g));return f&&m&&h&&o&&p})}}function Qn({action:t,policyActions:e}){let i=!e?.enabledActions||e?.disabledActions?.length&&e.disabledActions.includes(t);return i?!1:(e?.enabledActions.length===0||e?.enabledActions.includes(t))&&!i}var z8="replaceTieMatchUpParticipantId",q8="assignTieMatchUpParticipantId",DO="removeTieMatchUpParticipantId",rW="assignMatchUpSideParticipant",QUe="removeMatchUpSideParticipant",Y8="substituteParticipant",PO="REMOVE_SUBSTITUTION",K8="REPLACE_PARTICIPANT",s0="REMOVE_PARTICIPANT",EO="setMatchUpStatus",RO="SUBSTITUTION",X8="SCHEDULE",ZUe="PENALTY",CO="REFEREE",J8="STATUS",MO="START",Q8="SCORE",eTe={REPLACE_TEAM_POSITION_METHOD:z8,ASSIGN_TEAM_POSITION_METHOD:q8,REMOVE_TEAM_POSITION_METHOD:DO,REPLACE_PARTICIPANT:K8,SUBSTITUTION_METHOD:Y8,REMOVE_SUBSTITUTION:PO,REMOVE_PARTICIPANT:s0,SCHEDULE_METHOD:EO,SUBSTITUTION:RO,SCHEDULE:X8,PENALTY:ZUe,REFEREE:CO,STATUS:J8,SCORE:Q8,START:MO,END:"END"};function tTe({specifiedPolicyDefinitions:t,inContextDrawMatchUps:e,matchUpParticipantIds:i,matchUpActionsPolicy:r,inContextMatchUp:n,policyActions:a,enforceGender:s,participantId:o,sideNumber:l,matchUpId:u,matchUp:c,drawId:d,side:p}){let f=[],m=n.sides?.find(M=>M.participant),h=Na(n.gender)&&n.sideNumber&&n.sides?.filter(M=>M.particiapntId).length===1&&m?.participant?.person?.sex,g=n.matchUpType,I=(s??r?.participants?.enforceGender)!==!1?n.gender:void 0,v=n.sides?.flatMap(M=>M.participant?.individualParticipants||M.participant).filter(Boolean)?.map(vt),w=n.sides?.filter(M=>!l||M.sideNumber===l).flatMap(M=>M.participant?.individualParticipants||M.participant).filter(Boolean),y=w?.map(vt),b=e?.find(M=>M.matchUpId===n.matchUpTieId)?.sides?.map(M=>M?.participant?.individualParticipants?.filter(({participantId:N,person:A})=>!y?.includes(N)&&(!I||eu(I)||A.sex===I||Na(I)&&!h||h&&A.sex!==h))),S=l?b?.[l-1]:b?.map((M,N)=>({participants:M,sideNumber:N+1})),U=l?b?.[l-1]?.map(vt):b?.map((M,N)=>({participants:M?.map(vt),sideNumber:N+1})),T=l&&(Di(Zf)(g)&&!y?.length||Di(Sp)(g)&&(y?.length??0)<2)||!l&&(Di(Zf)(g)&&(y?.length??0)<2||Di(Sp)(g)&&(y?.length??0)<4),P=U?.filter(M=>!v?.includes(M)),D=S?.filter(({participantId:M})=>P.includes(M));if(T&&P?.length&&f.push({availableParticipantIds:P,method:q8,availableParticipants:D,type:km,payload:{participantId:void 0,tieMatchUpId:u,sideNumber:l,drawId:d}}),y?.length&&(!cr(c)||p?.substitutions?.length)&&f.push({method:DO,type:s0,existingParticipantIds:y,payload:{participantId:void 0,tieMatchUpId:u,drawId:d}}),D?.length&&(!l&&y?.length||l&&p?.participant)&&f.push({availableParticipantIds:P,method:z8,availableParticipants:D,type:K8,existingParticipantIds:y,payload:{existingParticipantId:void 0,participantId:void 0,tieMatchUpId:u,drawId:d}}),Qn({policyActions:a,action:PO})&&p?.substitutions?.length){let M=p.participant?.participantType===gt&&[p.participantId]||p.participant?.participantType===pt&&p.participant.individualParticipantIds||[],N=p.substitutions.map(A=>A.participantId).filter(A=>M.includes(A));(!o||N.includes(o))&&f.push({method:DO,type:PO,substitutedParticipantIds:N,payload:{participantId:void 0,tieMatchUpId:u,drawId:d}})}let E=t?.[Rr],R=E?.substituteWithoutScore,C=E?.substituteAfterCompleted;if(Qn({policyActions:a,action:RO})&&i.length===2&&(!l&&y?.length||l&&p?.participant)&&(R||cr(c))&&(C||c.matchUpStatus&&!Yi.includes(c.matchUpStatus))&&w?.length&&S.length){let M=w.map(vt);f.push({info:"list of team players available for substitution",method:Y8,availableParticipantIds:U,existingParticipantIds:M,availableParticipants:S,existingParticipants:w,type:RO,payload:{substituteParticipantId:void 0,existingParticipantId:void 0,sideNumber:l,matchUpId:u,drawId:d}})}return f}function iTe({tournamentParticipants:t=[],possiblyDisablingAction:e,activeDrawPositions:i,positionAssignments:r,returnParticipants:n,appliedPolicies:a,drawDefinition:s,drawPosition:o,validActions:l,structureId:u,structure:c,drawId:d,event:p}){if(i.includes(o))return{};let f=l.find(U=>U.type===km)?.availableParticipantIds,m=a?.[Rp]?.otherFlightEntries,h=a?.[Rp]?.restrictQualifyingAlternates,g=(s.entries??[]).filter(({entryStage:U})=>!h||(c.stage===We?U===We:U!==We)).sort((U,T)=>(U.entryPosition??1/0)-(T.entryPosition??1/0)).map(({participantId:U})=>U).filter(Boolean),{allPositionedParticipantIds:I}=cK({drawDefinition:s}),v=r.map(U=>U.participantId).filter(Boolean),w=g.filter(U=>c.stage&&[We,xe,Ui].includes(c.stage)?!I?.includes(U):!v.includes(U)),y=(p?.entries??[]).filter(U=>U.entryStatus===Fs&&Z8({restrictQualifyingAlternates:h,structure:c,entry:U})&&(c.stage&&[We,xe,Ui].includes(c.stage)?!I?.includes(U.participantId):!v.includes(U.participantId))).sort((U,T)=>(U.entryPosition??1/0)-(T.entryPosition??1/0)).map(U=>U.participantId),b=rt(w.concat(y));if(m){let U=(p?$i({event:p}).flightProfile:void 0)?.flights?.filter(T=>T.drawId!==d).map(T=>T.drawEntries.filter(P=>P.participantId&&![hc,ys,of].includes(P.entryStatus)&&!g.includes(P.participantId)).map(({participantId:P})=>P)).flat().filter(Boolean);U?.length&&b.push(...U)}f?.length&&(b=b.filter(U=>!f.includes(U)));let S=n?t?.filter(U=>b.includes(U.participantId)):void 0;return S?.forEach(U=>{let T=(s.entries??[]).find(P=>P.participantId===U.participantId);U.entryPosition=T?.entryPosition}),S?.sort((U,T)=>(U.entryPosition||1/0)-(T.entryPosition||1/0)),b.length?{validAlternatesAction:Ve({payload:{drawId:d,structureId:u,drawPosition:o},willDisableLinks:e,method:KSe,availableAlternatesParticipantIds:b,type:jL,availableAlternates:S})}:{}}function Z8({restrictQualifyingAlternates:t,structure:e,entry:i}){let{stage:r}=e;if(!i.entryStage||i.entryStage===r||r===We&&!t||i.entryStage===xe&&r===Zr)return!0}function rTe({eventEntries:t,structure:e}){let i=n=>n.entryStatus===Fs&&Z8({structure:e,entry:n}),r=(n,a)=>(n.entryPosition||1/0)-(a.entryPosition||1/0);return t.filter(i).sort(r).map(vt)}function nTe({restrictAdHocRoundParticipants:t,tournamentParticipants:e,matchUpParticipantIds:i,otherFlightEntries:r,drawDefinition:n,structureId:a,sideNumber:s,matchUpId:o,structure:l,matchUp:u,drawId:c,event:d}){let p=[],f=l?.matchUps??[],m=u.sides?.find(T=>T.sideNumber===s)?.participantId,h=f.filter(({roundNumber:T})=>T===u.roundNumber),g=n?.entries?.filter(({entryStatus:T})=>T&&lf.includes(T)).map(vt)??[],I=h.map(T=>(T.sides??[]).flatMap(vt)).flat().filter(Boolean),v=g.filter(T=>!i.includes(T)&&(!t||!I.includes(T))),w=e?.filter(T=>v?.includes(T.participantId)).map(T=>ke(T,void 0,!0));w?.forEach(T=>{let P=(n.entries??[]).find(D=>D.participantId===T.participantId);T.entryPosition=P?.entryPosition}),v.length&&p.push({payload:{drawId:c,matchUpId:o,structureId:a,sideNumber:s},method:rW,type:km,availableParticipantIds:v,participantsAvailable:w});let y=d?.entries??[],b=rTe({eventEntries:y,structure:l}),S=rt(g.concat(b));if(r){let T=(d?$i({event:d}):void 0)?.flights?.filter(P=>P.drawId!==c).flatMap(P=>P.drawEntries.filter(D=>D.participantId&&![hc,ys,of].includes(D.entryStatus)).map(({participantId:D})=>D)).filter(Boolean);T?.length&&S.push(...T)}S=S.filter(T=>!i.includes(T)&&!v.includes(T)&&(!t||!I.includes(T)));let U=e?.filter(T=>S.includes(T.participantId)).map(T=>ke(T,void 0,!0));if(U?.forEach(T=>{let P=(n.entries??[]).find(D=>D.participantId===T.participantId);T.entryPosition=P?.entryPosition}),U?.sort((T,P)=>(T.entryPosition||1/0)-(P.entryPosition||1/0)),S.length&&p.push({payload:{drawId:c,matchUpId:o,structureId:a,sideNumber:s},availableParticipantIds:S,participantsAvailable:U,method:rW,type:Fs}),!cr(u)&&s&&m){p.push({payload:{drawId:c,matchUpId:o,structureId:a,sideNumber:s},method:QUe,type:s0});let T=A=>A.sides.map(vt),P=({matchUpId:A})=>A!==u.matchUpId,D=A=>!cr(A),E=u.sides?.find(A=>A.sideNumber!==s)?.participantId,R=f.filter(({roundNumber:A})=>A!==u.roundNumber).filter(P).map(T),C=[E,...R.filter(A=>A.includes(m)).flat()].filter(Boolean),M=A=>!C.flat().includes(A),N=h.filter(D).filter(P).map(T).flat().filter(M);if(N.length){let A=e?.filter(O=>N.includes(O.participantId)).map(O=>ke(O,void 0,!0));p.push({payload:{participantIds:[m],roundNumber:u.roundNumber,structureId:a,sideNumber:s,matchUpId:o,drawId:c},swappableParticipantIds:N,method:QSe,type:zR,swappableParticipants:A})}}return p}function eC(t){if(!t)return{error:ie};let{drawDefinition:e,event:i}=t,{restrictAdHocRoundParticipants:r=!0,policyDefinitions:n,enforceGender:a,participantId:s,sideNumber:o,matchUpId:l}=t,u=t.tournamentRecord??(t.tournamentId&&ri(t.tournamentId)&&t.tournamentRecords?.[t.tournamentId]);if(!u)return{error:Ie};if(!l||!ri(l))return{error:Un};if(o&&![1,2].includes(o))return z({result:{error:ie},context:{sideNumber:o}});if(!e){let Y=(br({tournamentRecord:u}).matchUps??[]).find(Z=>Z.matchUpId===l);i=(u?.events??[]).find(Z=>Z.eventId===Y?.eventId);let X=(i?.drawDefinitions??[]).find(Z=>Z.drawId===Y?.drawId);X&&(e=X)}if(!e)return{error:_e};let c=Ei({withIndividualParticipants:!0,tournamentRecord:u}).participants,{drawId:d}=e,{matchUp:p,structure:f}=di({drawDefinition:e,matchUpId:l,event:i});if(!p)return{error:un};let m=Tt({tournamentRecord:u,drawDefinition:e,structure:f,event:i}).appliedPolicies??{};Object.assign(m,n??{});let h=m?.[Rp]?.otherFlightEntries,g=m?.[Rr]??fv[Rr],{enabledStructures:I}=H8({actionType:TO,appliedPolicies:m,drawDefinition:e,structure:f}),{policyActions:v}=W8({enabledStructures:I,drawDefinition:e,structure:f}),w=t.matchUpsMap??kr({drawDefinition:e}),y=t.inContextDrawMatchUps??Qi({tournamentParticipants:c,inContext:!0,drawDefinition:e,matchUpsMap:w,event:i}).matchUps,b=y?.find(Y=>Y.matchUpId===l),S=o&&b?.sides?.find(Y=>Y.sideNumber===o),U=b?.sides?.map(Y=>Y.participantId||Y.participant?.participantid).filter(Boolean)??[],{assignedPositions:T,allPositionsAssigned:P}=ur({structure:f}),{structureId:D}=f??{},E=[];if(!D)return{validActions:E};let R=Vn({structure:f}),C=!!p.collectionId;if(R&&!C){let Y=nTe({restrictAdHocRoundParticipants:r,tournamentParticipants:c,matchUpParticipantIds:U,otherFlightEntries:h,drawDefinition:e,structureId:D,sideNumber:o,matchUpId:l,structure:f,matchUp:p,drawId:d,event:i});E.push(...Y)}let M=uu({drawDefinition:e,structure:f}),N=T?.filter(Y=>Y.participantId).map(Y=>Y.drawPosition),A=T?.filter(Y=>Y.bye).map(Y=>Y.drawPosition),O=p.matchUpStatus==="BYE"||!C&&p.drawPositions?.reduce((Y,X)=>A?.includes(X)||Y,!1);if(O)return{validActions:E,isByeMatchUp:O};Qn({policyActions:v,action:CO})&&E.push({type:CO,payload:{matchUpId:l}});let k=!lS({matchUpStatus:p.matchUpStatus}),F=m?.scoring?.structures,x=f?.stage&&F?.stage?.[f.stage],L=f?.stageSequence&&x?.stageSequence?.[f.stageSequence],$=!(m?.scoring?.requireAllPositionsAssigned||x?.requireAllPositionsAssigned||L?.requireAllPositionsAssigned)||P,V=p.sides?.filter(Y=>Y?.participantId).length===2,_=p.matchUpStatus&&[wi,Hi].includes(p.matchUpStatus),B=On({inContextDrawMatchUps:y,drawDefinition:e,matchUpId:l}),G=Op({inContextDrawMatchUps:y,drawDefinition:e,targetData:B}),j=(b?.drawPositions?.length===2&&b.drawPositions.every(Y=>N?.includes(Y))&&b?.sides?.length===2&&b.sides.every(({participantId:Y})=>Y)||V)&&!(_&&G),K={method:c8,type:uI,payload:{drawId:d,matchUpId:l,penaltyCode:void 0,penaltyType:void 0,participantIds:[],notes:void 0}};if(k&&E.push({payload:{drawId:d,matchUpId:l,schedule:{}},method:EO,type:X8}),Qn({policyActions:v,action:uI})&&(S?.participant||!o&&U?.length)&&E.push(K),k&&j&&E.push({type:J8}),$&&j){let{matchUpId:Y,matchUpFormat:X}=p,Z={drawId:d,matchUpId:Y,matchUpFormat:X,outcome:{scoreStringSide1:void 0,scoreStringSide2:void 0,sets:[]},winningSide:void 0};E.push({info:"set outcome and winningSide",method:EO,type:Q8,payload:Z}),Qn({policyActions:v,action:MO})&&E.push({type:MO}),Qn({policyActions:v,action:"END"})&&E.push({type:"END"})}if(C&&b){let Y=tTe({specifiedPolicyDefinitions:n,inContextDrawMatchUps:y,matchUpParticipantIds:U,matchUpActionsPolicy:g,inContextMatchUp:b,policyActions:v,enforceGender:a,participantId:s,sideNumber:o,matchUpId:l,matchUp:p,drawId:d,side:S});E.push(...Y)}return{structureIsComplete:M,validActions:E,isDoubleExit:_,...H}}function aTe({tournamentParticipants:t=[],sourceStructuresComplete:e,possiblyDisablingAction:i,isWinRatioFedStructure:r,activeDrawPositions:n,positionAssignments:a,drawDefinition:s,drawPosition:o,structureId:l,structure:u,drawId:c,event:d}){if(n.includes(o)||r&&!e)return{};let{sourceStructureIds:p,targetStructureIds:f}=s.links?.reduce((I,v)=>{let w=v.source?.structureId,y=v.target?.structureId;return I.sourceStructureIds.includes(w)||I.sourceStructureIds.push(w),I.targetStructureIds.includes(y)||I.targetStructureIds.push(y),I},{sourceStructureIds:[],targetStructureIds:[]})||{},m=[],h=s.links?.filter(I=>I.target?.structureId===u.structureId)??[];for(let I of h){let v=I?.source?.structureId,{structure:w}=et({structureId:v,drawDefinition:s}),y=w?.finishingPosition===lh&&(p?.length!==1||f?.length!==1),b={};if(y){let{matchUps:T}=Nt({drawDefinition:s,structure:u,event:d}),{initialRoundNumber:P}=Nm({drawPosition:o,matchUps:T}),D=s.links?.find(E=>E.target?.structureId===u?.structureId&&E.target.roundNumber===P)?.source?.roundNumber;b.roundNumbers=[D]}let{completedMatchUps:S}=_R({structureId:v,inContext:!0,matchUpFilters:b,drawDefinition:s}),U=a.map(T=>T.participantId).filter(Boolean);S?.filter(({matchUpType:T,winningSide:P})=>P&&(d?.eventType!==rr||T===rr)).map(({winningSide:T,sides:P})=>T&&P?.[1-(T-1)]).map(vt).filter(T=>T&&!U.includes(T))?.forEach(T=>{m.includes(T)||m.push(T)})}let g=t?.filter(I=>m?.includes(I.participantId));return g?.forEach(I=>{let v=(s.entries??[]).find(w=>w.participantId===I.participantId);I.entryPosition=v?.entryPosition}),m?.length?{validLuckyLosersAction:{type:HL,method:XSe,availableLuckyLosers:g,availableLuckyLoserParticipantIds:m,willDisableLinks:i,payload:{drawId:c,structureId:l,drawPosition:o}}}:{}}function sTe({positionSourceStructureIds:t,unassignedParticipantIds:e,possiblyDisablingAction:i,provisionalPositioning:r,tournamentParticipants:n,isWinRatioFedStructure:a,positionAssignments:s,returnParticipants:o,appliedPolicies:l,drawDefinition:u,seedingProfile:c,isByePosition:d,drawPosition:p,structureId:f,event:m}){let{drawId:h}=u,g=[],I,v,w=[],y=l?.[fo]?.validSeedPositions?.ignore;if(y||({unplacedSeedParticipantIds:I,unplacedSeedAssignments:v,unfilledPositions:w}=F7({provisionalPositioning:r,returnAllProxies:!0,randomize:!0,drawDefinition:u,seedingProfile:c,structureId:f})),w?.length||(w=s.filter(b=>!b.participantId&&!b.bye&&!b.qualifier).map(b=>b.drawPosition)),d||g.push({payload:{drawId:h,structureId:f,drawPosition:p,isPositionAction:!0},willDisableLinks:i,method:tUe,type:"BYE"}),a&&y){let b=s.map(D=>D.participantId).filter(Boolean),S={structureIds:t},{completedMatchUps:U}=cv({inContext:!0,matchUpFilters:S,drawDefinition:u}),T=rt((U??[]).filter(({matchUpType:D})=>m?.eventType!==rr||D===rr)?.map(({sides:D})=>D?.map(vt)).flat().filter(D=>D&&!b.includes(D))),P=o?n?.filter(D=>T?.includes(D.participantId)).map(D=>ke(D,void 0,!0)):void 0;return P?.forEach(D=>{let E=(u.entries??[]).find(R=>R.participantId===D.participantId);D.entryPosition=E?.entryPosition}),P?.length&&g.push(Ve({payload:{drawId:h,structureId:f,drawPosition:p},willDisableLinks:i,method:eW,type:km,availableParticipantIds:T,participantsAvailable:P})),{validAssignmentActions:g}}if(w.includes(p)||d){let b;if(v?.length){let U=v.filter(T=>I?.includes(T.participantId));U.sort(oTe),b=U.map(T=>T.participantId)}else b=e;let S=o?n?.filter(U=>b.includes(U.participantId)).map(U=>ke(U,void 0,!0)):void 0;S?.length&&g.push(Ve({payload:{drawId:h,structureId:f,drawPosition:p},willDisableLinks:i,method:eW,type:km,availableParticipantIds:b,participantsAvailable:S}))}return{validAssignmentActions:g}}function oTe(t,e){return t.bye||lI(t.seedValue)<lI(e.seedValue)||t.seedValue&&!e.seedValue?-1:(t.seedNumber||0)-(e.seedNumber||0)}function lTe({drawPositionInitialRounds:t,tournamentParticipants:e,positionAssignments:i,returnParticipants:r,appliedPolicies:n,drawDefinition:a,drawPosition:s,structureId:o,drawId:l}){let u=[],c=[],d=[],p=[],f=new Set(i.map(b=>b.participantId).filter(Boolean)),m=n?.[Rp],h=!m?.disableRoundRestrictions&&t[s],g=m?.requireCompletedStructures,{sourceStructureIds:I,relevantLinks:v}=Eb({targetRoundNumber:h,linkType:ru,drawDefinition:a,structureId:o})||{};I?.length&&p.push(...I);let{sourceStructureIds:w,relevantLinks:y}=Eb({targetRoundNumber:h,linkType:iu,drawDefinition:a,structureId:o})||{};w?.length&&p.push(...w);for(let b of v){let S=a.structures?.find(T=>T.structureId===b.source.structureId);if(S?.stage!==We)continue;let U=uu({structureId:b.source.structureId,drawDefinition:a});if(!g||U){let T=S.qualifyingRoundNumber,{matchUps:P}=Nt({matchUpFilters:{roundNumbers:[T],isCollectionMatchUp:!1,hasWinningSide:!0},afterRecoveryTimes:!1,tournamentParticipants:e,inContext:!0,structure:S});for(let D of P){let E=D.sides.find(C=>C?.sideNumber===D.winningSide),R=D.matchUpStatus==="BYE"&&D.sides?.find(({participantId:C})=>C);if(E||R){let{participantId:C,participant:M}=E||R||{};C&&!f.has(C)&&(M&&r&&u.push(M),c.push(C))}}}}for(let b of y){let S=a.structures?.find(T=>T.structureId===b.source.structureId);if(S?.stage!==We)continue;let U=uu({structureId:b.source.structureId,drawDefinition:a});if(!g||U){let{positionAssignments:T}=Yt({structure:S}),P=T?.map(D=>{let E=D.participantId,R=mt({element:D,name:pc}).extension?.value;return R?{participantId:E,groupOrder:R?.groupOrder}:{}}).filter(({groupOrder:D,participantId:E})=>D===1&&!f.has(E)).map(({participantId:D})=>D)??[];if(P&&c.push(...P),r){let D=e.filter(({participantId:E})=>P.includes(E));u.push(...D)}}}return c.length&&d.push(Ve({qualifyingParticipants:r?u:void 0,method:qSe,type:WR,qualifyingParticipantIds:c,payload:{qualifyingParticipantId:void 0,drawPosition:s,structureId:o,drawId:l}})),{validAssignmentActions:d,sourceStructureIds:p}}function uTe({onlyAssignedPositions:t=!0,possiblyDisablingAction:e,tournamentParticipants:i,inactiveDrawPositions:r,activeDrawPositions:n,positionAssignments:a,returnParticipants:s,byeDrawPositions:o,drawDefinition:l,isByePosition:u,drawPosition:c,structureId:d,structure:p,drawId:f,event:m}){if(n.includes(c))return{};let h=D=>!t||D.participantId||D.qualifier||D.bye,g=r?.filter(D=>D!==c&&!(u&&o.includes(D))),I=a?.filter(D=>h(D)&&g?.includes(D.drawPosition))??[],v=I.map(({drawPosition:D})=>D),{matchUps:w}=Nt({afterRecoveryTimes:!1,inContext:!0,drawDefinition:l,structure:p,event:m}),y=w.filter(({drawPositions:D})=>kn(D,v)),b=Object.assign({},...y.map(D=>D.sides?.filter(({sourceDrawPositionRange:E})=>E).map(({drawPosition:E,sourceDrawPositionRange:R})=>({[E]:R}))).flat()),S=I.map(D=>D.participantId).filter(Boolean),U=(i??[]).filter(D=>S.includes(D.participantId)),T=Object.assign({},...U.map(D=>({[D.participantId]:D}))),P=I.map(D=>{let E=T?.[D.participantId],R=b[D.drawPosition];return Ve({...D,participant:s?ke(E,!1,!0):void 0,sourceDrawPositionRange:R})});return P.length?{validSwapAction:{payload:{drawId:f,structureId:d,drawPositions:[c]},willDisableLinks:e,method:u8,type:zR,availableAssignments:P}}:{}}function cTe(t,e){return t.filter(i=>!e.includes(i.participantId)).map(i=>i.participantId)}function dTe({validActions:t,policyActions:e,isActiveDrawPosition:i,positionAssignments:r,disablePlacementActions:n,positionAssignment:a,isByePosition:s,getValidAssignmentActions:o,positionSourceStructureIds:l,unassignedParticipantIds:u,possiblyDisablingAction:c,isWinRatioFedStructure:d,tournamentParticipants:p,returnParticipants:f,appliedPolicies:m,drawDefinition:h,drawPosition:g,structureId:I,event:v}){if(Qn({policyActions:e,action:km})&&!i&&r&&!n&&(!a||s)){let{validAssignmentActions:w}=o({positionSourceStructureIds:l,unassignedParticipantIds:u,possiblyDisablingAction:c,isWinRatioFedStructure:d,tournamentParticipants:p,positionAssignments:r,returnParticipants:f,appliedPolicies:m,drawDefinition:h,isByePosition:s,drawPosition:g,structureId:I,event:v});w?.forEach(y=>t.push(y))}}function pTe({validActions:t,policyActions:e,isActiveDrawPosition:i,getValidQualifiersAction:r,drawPositionInitialRounds:n,tournamentParticipants:a,positionAssignments:s,returnParticipants:o,appliedPolicies:l,drawDefinition:u,drawPosition:c,structureId:d,drawId:p}){if(Qn({policyActions:e,action:WR})&&!i){let{validAssignmentActions:f}=r({drawPositionInitialRounds:n,tournamentParticipants:a,positionAssignments:s,returnParticipants:o,appliedPolicies:l,drawDefinition:u,drawPosition:c,structureId:d,drawId:p});f?.forEach(m=>t.push(m))}}function fTe({validActions:t,policyActions:e,isActiveDrawPosition:i,drawId:r,structureId:n,drawPosition:a,possiblyDisablingAction:s,isByePosition:o}){Qn({policyActions:e,action:UO})&&!i&&(t.push({type:UO,method:ZH,payload:{drawId:r,structureId:n,drawPosition:a},willDisableLinks:s}),o||t.push({type:GL,method:YSe,payload:{drawId:r,structureId:n,drawPosition:a},willDisableLinks:s}),Qn({policyActions:e,action:"BYE"})&&!o&&t.push({type:"BYE",method:ZH,payload:{drawId:r,structureId:n,drawPosition:a,replaceWithBye:!0},willDisableLinks:s}))}function mTe({validActions:t,policyActions:e,activePositionsCheck:i,activePositionOverrides:r,activeDrawPositions:n,drawDefinition:a,structureId:s,drawPosition:o,structure:l,isByePosition:u,participantId:c,participant:d,drawId:p}){let f=l.stage===We||l.stage===xe&&l.stageSequence===1;if(!u&&i({activePositionOverrides:r,activeDrawPositions:n,action:Vy})&&Qn({policyActions:e,action:Vy})&&sP({drawDefinition:a,structureId:s,drawPosition:o})&&f){let{seedAssignments:m}=ds({returnAllProxies:!0,drawDefinition:a,structure:l}),{seedNumber:h,seedValue:g}=m?.find(I=>I.participantId===c)??{};t.push({type:Vy,method:iUe,participant:d,seedNumber:h,payload:{drawId:p,structureId:s,participantId:c,seedValue:g}})}if(!u&&i({activePositionOverrides:r,activeDrawPositions:n,action:tD})&&Qn({policyActions:e,action:tD})&&sP({drawDefinition:a,structureId:s,drawPosition:o})&&f){let{seedAssignments:m}=ds({returnAllProxies:!0,drawDefinition:a,structure:l}),{seedNumber:h}=m?.find(g=>g.participantId===c)??{};t.push({method:eUe,type:tD,participant:d,seedNumber:h,payload:{participantId:c,structureId:s,drawId:p}})}}function hTe({validActions:t,policyActions:e,isByePosition:i,participantId:r,participant:n,drawId:a}){if(!i&&r){if(Qn({policyActions:e,action:uI})){let s={type:uI,method:c8,participant:n,payload:{penaltyCode:void 0,penaltyType:void 0,participantIds:[],notes:void 0,drawId:a}};t.push(s)}if(Qn({policyActions:e,action:lP})){let s={type:lP,method:ZSe,participant:n,payload:{participantId:r,otherName:void 0}};t.push(s)}}}function gTe({validActions:t,policyActions:e,getValidSwapAction:i,possiblyDisablingAction:r,tournamentParticipants:n,inactiveDrawPositions:a,activeDrawPositions:s,positionAssignments:o,returnParticipants:l,byeDrawPositions:u,drawDefinition:c,isByePosition:d,drawPosition:p,structureId:f,structure:m,drawId:h}){if(Qn({policyActions:e,action:zR})){let{validSwapAction:g}=i({possiblyDisablingAction:r,tournamentParticipants:n,inactiveDrawPositions:a,activeDrawPositions:s,positionAssignments:o,returnParticipants:l,byeDrawPositions:u,drawDefinition:c,isByePosition:d,drawPosition:p,structureId:f,structure:m,drawId:h});g&&t.push(g)}}function ITe({validActions:t,policyActions:e,getValidAlternatesAction:i,possiblyDisablingAction:r,tournamentParticipants:n,positionAssignments:a,activeDrawPositions:s,returnParticipants:o,appliedPolicies:l,drawDefinition:u,drawPosition:c,structureId:d,structure:p,drawId:f,event:m,disablePlacementActions:h}){if(Qn({policyActions:e,action:jL})&&!h){let{validAlternatesAction:g}=i({possiblyDisablingAction:r,tournamentParticipants:n,positionAssignments:a,activeDrawPositions:s,returnParticipants:o,appliedPolicies:l,drawDefinition:u,drawPosition:c,validActions:t,structureId:d,structure:p,drawId:f,event:m});g&&t.push(g)}}function vTe({validActions:t,policyActions:e,getValidLuckyLosersAction:i,sourceStructuresComplete:r,possiblyDisablingAction:n,isWinRatioFedStructure:a,tournamentParticipants:s,activeDrawPositions:o,positionAssignments:l,drawDefinition:u,drawPosition:c,structureId:d,structure:p,drawId:f,disablePlacementActions:m,isActiveDrawPosition:h}){if(Qn({policyActions:e,action:HL})&&!m&&!h&&l){let{validLuckyLosersAction:g}=i({sourceStructuresComplete:r,possiblyDisablingAction:n,isWinRatioFedStructure:a,tournamentParticipants:s,activeDrawPositions:o,positionAssignments:l,drawDefinition:u,drawPosition:c,structureId:d,structure:p,drawId:f});g&&t.push(g)}}function yTe({validActions:t,policyActions:e,getValidModifyAssignedPairAction:i,participant:r,tournamentParticipants:n,returnParticipants:a,drawPosition:s,drawId:o,event:l}){if(r?.participantType===pt&&Qn({policyActions:e,action:VL})){let{validModifyAssignedPairAction:u}=i({tournamentParticipants:n,returnParticipants:a,drawPosition:s,participant:r,drawId:o,event:l});u&&t.push(u)}}function o0(t){return bTe(t)}function bTe(t){let e=Ge(t,[{event:!0,drawDefinition:!0,structureId:!0}]);if(e.error)return e;let{policyDefinitions:i,returnParticipants:r=!0,provisionalPositioning:n,tournamentRecord:a,drawDefinition:s,drawPosition:o,event:l}=t,u=t.tournamentParticipants??(a&&Ei({withIndividualParticipants:!0,tournamentRecord:a}).participants)??[],c=et({structureId:t.structureId,drawDefinition:s});if(c.error)return c;let d=c.containingStructure||c.structure;if(!d)return{error:Ii};let p=d.structureId;if(c=dv({drawDefinition:s,structureId:p}),o===void 0&&!c.isAdHoc)return{error:JI};if(c.isAdHoc)return eC(t);if(c.error)return c;let{drawPositionInitialRounds:f,inactiveDrawPositions:m,activeDrawPositions:h,byeDrawPositions:g}=c,I=Tt({tournamentRecord:a,drawDefinition:s,structure:d,event:l}).appliedPolicies??{};Object.assign(I,i??{});let{actionsPolicy:v,enabledStructures:w,actionsDisabled:y}=H8({actionType:iD,appliedPolicies:I,drawDefinition:s,structure:d}),b=v?.activePositionOverrides||[],{sourceStructureIds:S}=Eb({finishingPosition:Ep,targetRoundNumber:1,linkType:iu,drawDefinition:s,structureId:p})||{},U;S?.length&&(U=S.every(K=>uu({structureId:K,drawDefinition:s})));let T=S.length,P=S.length&&!U,{policyActions:D}=W8({enabledStructures:w,drawDefinition:s,structure:d}),E=![We,xe].includes(d.stage)||d.stageSequence!==1,{drawId:R}=s,C=[],{assignedPositions:M,positionAssignments:N}=ur({structure:d}),A=M?.find(K=>K.drawPosition===o),O=!!A;if(!N?.map(K=>K.drawPosition)?.includes(o))return{error:eh};let{stage:k,stageSequence:F}=d,x=[k];k===Zr&&x.push(xe),k===xe&&x.push(Zr);let L=dh({entryStatuses:lf,provisionalPositioning:n,drawDefinition:s,stageSequence:F,structureId:p,stages:x}),$=df({drawDefinition:s,stages:x}).assignedParticipantIds??[],V=cTe(L,$),_=g.includes(o),B=h.includes(o);if(y)return{info:"Actions Disabled for structure",isActiveDrawPosition:B,isDrawPosition:!0,hasPositionAssigned:O,validActions:[],isByePosition:_};dTe({validActions:C,policyActions:D,isActiveDrawPosition:B,positionAssignments:N,disablePlacementActions:P,positionAssignment:A,isByePosition:_,getValidAssignmentActions:sTe,positionSourceStructureIds:S,unassignedParticipantIds:V,possiblyDisablingAction:E,isWinRatioFedStructure:T,tournamentParticipants:u,returnParticipants:r,appliedPolicies:I,drawDefinition:s,drawPosition:o,structureId:p,event:l}),pTe({validActions:C,policyActions:D,isActiveDrawPosition:B,getValidQualifiersAction:lTe,drawPositionInitialRounds:f,tournamentParticipants:u,positionAssignments:N,returnParticipants:r,appliedPolicies:I,drawDefinition:s,drawPosition:o,structureId:p,drawId:R});let{participantId:G}=A||{},j=G&&u.find(K=>K.participantId===G);return A&&(fTe({validActions:C,policyActions:D,isActiveDrawPosition:B,drawId:R,structureId:p,drawPosition:o,possiblyDisablingAction:E,isByePosition:_}),mTe({validActions:C,policyActions:D,activePositionsCheck:JUe,activePositionOverrides:b,activeDrawPositions:h,drawDefinition:s,structureId:p,drawPosition:o,structure:d,isByePosition:_,participantId:G,participant:j,drawId:R}),hTe({validActions:C,policyActions:D,isByePosition:_,participantId:G,participant:j,drawId:R}),gTe({validActions:C,policyActions:D,getValidSwapAction:uTe,possiblyDisablingAction:E,tournamentParticipants:u,inactiveDrawPositions:m,activeDrawPositions:h,positionAssignments:N,returnParticipants:r,byeDrawPositions:g,drawDefinition:s,isByePosition:_,drawPosition:o,structureId:p,structure:d,drawId:R})),ITe({validActions:C,policyActions:D,getValidAlternatesAction:iTe,possiblyDisablingAction:E,tournamentParticipants:u,positionAssignments:N,activeDrawPositions:h,returnParticipants:r,appliedPolicies:I,drawDefinition:s,drawPosition:o,structureId:p,structure:d,drawId:R,event:l,disablePlacementActions:P}),vTe({validActions:C,policyActions:D,getValidLuckyLosersAction:aTe,sourceStructuresComplete:U,possiblyDisablingAction:E,isWinRatioFedStructure:T,tournamentParticipants:u,activeDrawPositions:h,positionAssignments:N,drawDefinition:s,drawPosition:o,structureId:p,structure:d,drawId:R,disablePlacementActions:P,isActiveDrawPosition:B}),yTe({validActions:C,policyActions:D,getValidModifyAssignedPairAction:KUe,participant:j,tournamentParticipants:u,returnParticipants:r,drawPosition:o,drawId:R,event:l}),{isActiveDrawPosition:B,isDrawPosition:!0,hasPositionAssigned:O,isByePosition:_,validActions:C,...H}}function ES({policyDefinitions:t,appliedPolicies:e,drawType:i}){let r=t?.[KD]?.drawTypeCoercion,n=e?.[KD]?.drawTypeCoercion;return(typeof r=="boolean"?r:void 0)??(i&&r?.[i])??(typeof n=="boolean"?n:void 0)??(i&&n?.[i])??!0}var l0=({drawDefinition:t})=>{let e=Ge({drawDefinition:t},[{[mn]:!0}]);if(e.error)return e;let i=t.structures?.find(n=>n.stage===xe&&n.stageSequence===1);if(!i)return z({result:{error:B1}});let{qualifierPositions:r}=ur({structure:i});return Re(0,r.length).sort(()=>Math.random()-.5)};function u0({structureId:t,drawDefinition:e}){if(!e)return{error:_e};if(!ri(t))return{error:ie};let i=uv({drawDefinition:e,structureId:t});if(i.error)return i;let r=i.links.target.flatMap(a=>a.target.feedProfile).filter(Boolean),n=!xi([Pp,Ms,cR,Dp],r).length;return{...H,valid:n}}function e9({participantsCount:t,participantCount:e}){if(t=t??e,!t)return{error:ie};let i=XI(t);return i?{drawSize:i}:z({result:{error:ie},stack:"getEliminationDrawSize",context:{participantsCount:t}})}function RS(t){let{drawSizeProgression:e=!1,policyDefinitions:i,drawSize:r}=t||{},{requireParticipantCount:n=!0,tournamentRecord:a,drawDefinition:s,event:o}=t||{},l="getSeedsCount",u=t?.participantsCount??t?.participantCount;if(!i){let m=Fc({tournamentRecord:a,drawDefinition:s,event:o});if(m.error)return z({result:m,stack:l});i=m.policyDefinitions}let c=ot(u);if(u&&!c)return z({result:{error:ie},context:{participantsCount:u},stack:l});if(n&&!c)return z({result:{error:Z6},stack:l});if(Number.isNaN(Number(r)))if(u)({drawSize:r}=e9({participantsCount:u}));else return z({result:{error:Cw},stack:l});let d=n&&u||r;if(d&&d>r)return{error:z1};let p=i?.[fo];if(!p)return{error:_6};let f=p.seedsCountThresholds;return f?(p.drawSizeProgression!==void 0&&(e=p.drawSizeProgression),{seedsCount:f.filter(m=>e?m.drawSize<=r:r===m.drawSize).reduce((m,h)=>u&&u>=h.minimumParticipantCount?h.seedsCount:m,0)}):{error:b6}}function tC({consideredEntries:t,policyDefinitions:e,tournamentRecord:i,appliedPolicies:r,participantMap:n,enforceGender:a,participants:s,event:o}){if((!s||!n)&&i&&({participants:s,participantMap:n}=Ei({tournamentRecord:i})),!s)return{error:Aw};if(!Array.isArray(s))return{error:ie};if(!o)return{error:li};let l=e?.[Rr]??r?.[Rr]??fv[Rr],u=(a??l?.participants?.enforceGender)!==!1,{eventType:c,gender:d}=o,p=c===lc,f=c===ya&&Lt||p&&pt||gt,m=Object.assign({},...(t??o.entries??[]).map(I=>({[I.participantId]:I.entryStatus}))),h=Object.keys(m),g=s.filter(I=>h.includes(I.participantId)).filter(I=>{let v=wTe({participant:I,participantType:f,eventType:c,entryStatusMap:m}),w=STe({genderEnforced:u,participantMap:n,eventGender:d,participant:I,isDoubles:p,mismatch:v});return v||!w});if(g.length){let I=g.map(v=>v.participantId);return{error:C6,invalidParticipantIds:I}}return{...H,valid:!0}}function wTe({participant:t,participantType:e,eventType:i,entryStatusMap:r}){let n=r[t.participantId],a=i&&[lc,ya].includes(i)&&t.participantType===gt&&(up(n)||n===hc);return t.participantType!==e&&!a}function STe(t){let{participant:e,participantMap:i,eventGender:r,mismatch:n,isDoubles:a,genderEnforced:s}=t,o=!n&&a&&rt(e?.individualParticipantIds?.map(d=>i?.[d]?.participant?.person?.sex).filter(Boolean)??[])||[],l=!r||!o?.length||eu(r)||il(r)&&on(o[0])===on(r)||Na(r)&&(o.length===1&&e.individualParticipantIds?.length===1||o.length===2),u=e?.person?.sex,c=!e?.person||!r||Na(r)||eu(r)||il(r)&&on(u)===on(r);return!s||l&&c}function t9({hasExistingDrawDefinition:t,qualifyingProfiles:e,appliedPolicies:i,qualifyingOnly:r,tieFormat:n,idPrefix:a,isMock:s,uuids:o}){let l="generateQualifyingSTructures",u=[],c=[],d=[],p=(v,w)=>v.stageSequence-w.stageSequence,f=(v,w)=>v.roundTarget-w.roundTarget,m=0,h=0,g,I=1;for(let v of e.sort(f)){let w=v.structureProfiles||[];I=v.roundTarget||I;let y=1,b=0,S,U,T;for(let P of(w||[]).sort(p)){let D=A1(P.drawSize||P.participantsCount),{qualifyingRoundNumber:E,structureOptions:R,matchUpFormat:C,structureName:M,structureId:N,drawType:A}=P,O=P.matchUpType,k=P.qualifyingPositions||UTe({drawSize:D,qualifyingRoundNumber:E}),F,x,L;if(!ot(D))return z({result:{error:Cw},stack:l});let $=e.length>1?`${I}-`:"",V=w.length>1||$?y:"",_=M||($||V?`${Xr(We)} ${$}${V}`:Xr(We));if(A===Ks){let{structures:B,groupCount:G,maxRoundNumber:j}=mS({structureName:P.structureName||_,structureId:N||o?.pop(),hasExistingDrawDefinition:t,stage:We,structureOptions:R,appliedPolicies:i,qualifyingOnly:r,stageSequence:y,matchUpType:O,roundTarget:I,tieFormat:n,drawSize:D,idPrefix:a,isMock:s,uuids:o});b=G,F=j,x=B[0],g=[1]}else({drawSize:D,matchUps:L,roundLimit:F}=ll({qualifyingRoundNumber:E,qualifyingPositions:k,matchUpType:O,drawSize:D,idPrefix:a,isMock:s,uuids:o})),x=ns({structureName:P.structureName||_,structureId:N||o?.pop(),qualifyingRoundNumber:F,hasExistingDrawDefinition:t,stage:We,qualifyingOnly:r,matchUpFormat:C,stageSequence:y,matchUpType:O,roundLimit:F,tieFormat:n,matchUps:L}),I&&xt({extension:{name:Tl,value:I},element:x}),b=L?.filter(B=>B.roundNumber===F)?.length||0;if(y>1){let{link:B}=vS({sourceStructureId:U,sourceRoundNumber:S,targetStructureId:x.structureId,finishingPositions:T===iu?[1]:void 0,linkType:T});d.push(B),m+=(D||0)-b}else m+=D||0;T=A===Ks?iu:ru,U=x.structureId,S=F,n&&(L=Nt({structure:x})?.matchUps||[],L?.forEach(B=>{let{tieMatchUps:G}=Sh({tieFormat:n,matchUp:B,isMock:s});Object.assign(B,{tieMatchUps:G,matchUpType:O})})),c.push(x),y+=1}h+=b,u.push({qualifiersCount:b,finalQualifyingRoundNumber:S,finalQualifyingStructureId:U,finishingPositions:g,roundTarget:I,linkType:T}),I+=1}return{qualifiersCount:h,qualifyingDrawPositionsCount:m,qualifyingDetails:u,structures:c,...H,links:d}}function UTe({drawSize:t,qualifyingRoundNumber:e}){let i=t,r=0;for(;r<e;)i=Math.floor(i/2),r+=1;return i}function i9(t){let{drawTypeCoercion:e,enforceMinimumDrawSize:i}=t,r=Ye(t.drawSize),n=e&&t.drawType!==na&&(typeof e=="boolean"||e<=2)&&r===2&&Yo||t.drawType||Yo,a=L5.includes(n);if(r&&a){if(e&&(typeof e=="boolean"&&r<4||r<=e))n=Yo;else if(r<4&&i)return{...z({context:{enforceMinimumDrawSize:i,drawSize:r,drawType:n},result:{error:VE},stack:"getCoercedDrawType"}),drawType:n}}return{drawType:n}}function TTe(t){let{drawDefinition:e,structureOptions:i,requireSequential:r}=t,n={structureName:Xr(xe),...t,stage:xe},{structures:a,groupCount:s}=mS(n);if(s<1)return{error:I4};let o=i?.playoffGroups||[{finishingPositions:[1],structureName:Xr(Ui)}],[l]=a,{structures:u,links:c}=w8({sourceStructureId:l.structureId,requireSequential:r,drawDefinition:e,playoffGroups:o,groupCount:s,...t});return u&&a.push(...u),{...H,structures:a,links:c}}function DTe({mainStructure:t,consolationStructure:e,deciderStructure:i}){let r=e.matchUps.reduce((u,c)=>(c.drawPositions||[]).filter(Boolean).length&&!u.includes(c.roundNumber)?u.concat(c.roundNumber):u,[]),n=t.matchUps.reduce((u,c)=>!u||c.roundNumber>u?c.roundNumber:u,void 0),a=e.matchUps.reduce((u,c)=>!u||c.roundNumber>u?c.roundNumber:u,void 0),s=r.map((u,c)=>{let d=r.indexOf(u)%2?Ms:Pp,p=1+c;return{linkType:nu,source:{roundNumber:p,structureId:t.structureId},target:{feedProfile:d,roundNumber:u,structureId:e.structureId}}}),o={linkType:ru,source:{roundNumber:a,structureId:e.structureId},target:{feedProfile:Ms,roundNumber:n,structureId:t.structureId}},l=[{linkType:ru,source:{roundNumber:n,structureId:t.structureId},target:{feedProfile:Ms,roundNumber:1,structureId:i.structureId}},{linkType:nu,source:{roundNumber:n,structureId:t.structureId},target:{feedProfile:Ms,roundNumber:1,structureId:i.structureId}}];return[...s,o,...l]}function PTe({structureName:t,matchUpType:e,idPrefix:i,drawSize:r,isMock:n,uuids:a}){let s=[],{matchUps:o}=vd({linkFedFinishingRoundNumbers:[1],drawSize:r+1,matchUpType:e,idPrefix:i,isMock:n}),l=ld({structureName:t||Xr(xe),structureId:a?.pop(),stageSequence:1,stage:xe,matchUpType:e,matchUps:o});s.push(l);let u=r/2,{matchUps:c}=vd({finishingPositionOffset:u,idPrefix:i&&`${i}-c`,drawSize:r-1,isConsolation:!0,matchUpType:e,isMock:n,uuids:a}),d=ld({structureName:Xr(F5),matchUps:c,structureId:a?.pop(),stage:Zr,stageSequence:2,matchUpType:e});s.push(d);let{matchUps:p}=ll({idPrefix:i&&`${i}-p1t2`,drawSize:2,matchUpType:e,isMock:n}),f=ld({structureName:Xr(x5),matchUps:p,structureId:a?.pop(),stageSequence:3,stage:Ui,matchUpType:e});s.push(f);let m=DTe({mainStructure:l,consolationStructure:d,deciderStructure:f});return{structures:s,links:m,...H}}function ETe(t){let{qualifyingRoundNumber:e,finishingPositionOffset:i,qualifyingPositions:r,matchUpType:n,idPrefix:a,drawSize:s,isMock:o,uuids:l}=t;if(!ot(s)||s<2)return{matchUps:[],roundsCount:0};if(Uo(s))return ll(t);let u=RTe(s),c=u.shift(),d=Re(1,(c?.participantsCount||0)+1).map(g=>({drawPosition:g})),p=[],f=1;({matchUps:p}=uP({roundNumber:f,matchUpType:n,idPrefix:a,matchUps:p,isMock:o,nodes:d,uuids:l})),f++;let m=t.roundLimit||e;for(let g of u){let I=g.participantsCount/2,v=Re(1,I+1);r&&I===r&&(m=f-1);let w=v.map(y=>{let b=WL({roundPosition:y,roundNumber:f,idPrefix:a,uuids:l});return{roundPosition:y,roundNumber:f,matchUpId:b}});p.push(...w),f++}let h=f-1;return p=oS({finishingPositionOffset:i,lucky:!0,roundsCount:h,roundLimit:m,matchUps:p}),m&&(p=p.filter(g=>g.roundNumber<=m)),{matchUps:p,roundsCount:h,roundLimit:m}}function RTe(t){let e=Ye(t),i=e%2?e+1:e,r=!!(Math.ceil(i/2)%2),n=[{participantsCount:i,preFeedRound:r}];for(;i>2;){let a=Math.ceil(i/2),s=a===1,o=!!(!s&&a%2);i=!s&&o?a+1:a;let l=!!(i!==2&&Math.ceil(i/2)%2);n.push({participantsCount:i,preFeedRound:l,feedRound:o})}return n}function r9(t){let{playoffAttributes:e,stageSequence:i=1,stage:r=xe,tieFormat:n,matchUpType:a,drawSize:s,uuids:o}=t,l=()=>!t.isMock&&!t.idPrefix?void 0:`${t.drawDefinition.drawId}-s-0`,u=t.structureId||l()||o?.pop(),c=t.appliedPolicies??Tt(t),d=t.policyDefinitions?.[nI]||c?.[nI];t.skipRounds=t.skipRounds||s<=4&&(d?.feedFromMainFinal?0:1)||0;let p=t.structureName??e?.["0"]?.name??Xr(xe),f=()=>{let{matchUps:m}=ll(t);return{structures:[ns({stageSequence:i,structureName:p,matchUpType:a,structureId:u,tieFormat:n,matchUps:m,stage:r})],links:[],...H}};return{generators:{[na]:()=>({structures:[ns({finishingPosition:Ep,stageSequence:i,structureName:p,matchUps:[],matchUpType:a,structureId:u,stage:r})],links:[],...H}),[rf]:()=>{let{matchUps:m}=ETe(t);return{structures:[ns({stageSequence:i,structureName:p,matchUpType:a,structureId:u,matchUps:m,stage:r})],links:[],...H}},[Yo]:()=>f(),[_w]:()=>PTe(t),[eI]:()=>Vg({...t,roundOffsetLimit:3,playoffAttributes:e??bF}),[tI]:()=>Vg({...t,roundOffsetLimit:2,playoffAttributes:e??wF}),[Ui]:()=>Vg(t),[rv]:()=>{let{matchUps:m}=vd({drawSize:s,uuids:o,matchUpType:a});return{structures:[ns({stageSequence:i,structureName:p,matchUpType:a,structureId:u,stage:xe,tieFormat:n,matchUps:m})],links:[],...H}},[$w]:()=>v8(t),[iI]:()=>Ff({...t,feedRounds:1,fmlc:!0}),[O5]:()=>Ff({...t,feedRounds:1}),[IF]:()=>Ff({...t,feedsFromFinal:1}),[vF]:()=>Ff({...t,feedsFromFinal:2}),[yF]:()=>Ff({...t,feedsFromFinal:3}),[Bw]:()=>Ff(t),[dR]:()=>b8(t),[Ks]:()=>mS(t),[au]:()=>TTe(t)}}}function c0(t){let{enforceMinimumDrawSize:e=!0,overwriteExisting:i,appliedPolicies:r,qualifyingOnly:n,staggeredEntry:a,drawDefinition:s,tieFormat:o,isMock:l,uuids:u}=t||{},c=Ye(t.drawSize),d=t.drawTypeCoercion??ES({appliedPolicies:r,drawType:t.drawType}),p="generateDrawStructuresAndLinks",f=i9({drawType:t.drawType,enforceMinimumDrawSize:e,drawTypeCoercion:d,drawSize:c});if(f.error)return f;let m=f.drawType,h=[],g=[],I=t?.matchUpType??Wt,v=s?.structures?.filter(({stage:V})=>V===We);v&&h.push(...v);let w=v?.map(({structureId:V})=>V),y=s?.structures?.find(({stage:V,stageSequence:_})=>V===xe&&_===1),b=s?.links?.filter(V=>V.target.structureId===y?.structureId&&w?.includes(V.source.structureId)),S=(V,_)=>{if(V.linkType===iu&&_?.structures){let B=V.source.finishingPositions||[];return _.structures.length*B.length}else if(V.linkType===ru&&_?.matchUps?.length){let B=V.source.roundNumber;return _.matchUps.filter(({roundNumber:G})=>G===B).length}},U=v?.map(V=>{let _=b?.find(Y=>Y.target.structureId===V.structureId),B=Yt({structure:V})?.positionAssignments?.length??0;if(!_)return B;let G=_?.source.structureId,j=s.structures?.find(Y=>Y.structureId===G),K=S(_,j)||0;return B-K}).filter(Boolean).reduce((V,_)=>V+_,0),T=b?.map(V=>{let _=V.source.structureId,B=v?.find(G=>G.structureId===_);return S(V,B)}).filter(Boolean).reduce((V,_)=>V+_,0),P=!!(y&&!y?.matchUps?.length);if(v?.length&&!P)return{error:iO};let D=!v?.length&&t.qualifyingProfiles,E=D?.length&&t9({idPrefix:t.idPrefix,qualifyingProfiles:D,appliedPolicies:r,qualifyingOnly:n,tieFormat:o,isMock:l,uuids:u});if(E?.error)return E;let{qualifyingDrawPositionsCount:R,qualifyingDetails:C,qualifiersCount:M}=E||{qualifyingDrawPositionsCount:U,qualifiersCount:T};R&&(E?.structures&&h.push(...E.structures),E?.links&&g.push(...E.links)),Object.assign(t,Ve({drawSize:c,matchUpType:I,tieFormat:o}));let N=m!==na&&(!c||c<2||!a&&![rv,rf].includes(m)&&([au,Ks].includes(m)&&c<3||![Ks,au].includes(m)&&!Uo(c)));if(N&&!R)return z({context:{drawSize:c,invalidDrawSize:N},result:{error:VE},stack:p});let{generators:A,error:O}=r9(t);if(O)return{error:O};let k=A[m];if(!k)return{error:F1};let F=k?.();if(F.error)return F;let{structures:x,links:L}=F;if(x?.length){let V=x.find(({stage:_,stageSequence:B})=>_===xe&&B===1);if(y&&V){if(P){let _=V.structureId;if(V.structureId=y.structureId,L?.length)for(let B of L)B.source.structureId===_&&(B.source.structureId=y.structureId),B.target.structureId===_&&(B.target.structureId=y.structureId)}else if(!i)return{error:iO}}h.push(...x)}h.sort(ch),L?.length&&g.push(...L);let $=F.structures.find(({stage:V,stageSequence:_})=>V===xe&&_===1);for(let V of C||[]){let{finalQualifyingRoundNumber:_,finalQualifyingStructureId:B,roundTarget:G,finishingPositions:j,linkType:K}=V,Y=$&&vS({targetStructureId:$.structureId,sourceStructureId:B,sourceRoundNumber:_,finishingPositions:j,targetEntryRound:G,linkType:K})?.link;if(Y?.error)return Y;Y&&g.push(Y)}return b&&g.push(...b),{...H,qualifyingResult:{qualifyingDrawPositionsCount:R,qualifiersCount:M},structures:h,links:g}}function d0(t){let{modifyOriginal:e=!0,stageSequence:i=1,isMock:r}=t||{},n="generateDrawTypeAndModifyDrawDefinition";if(!t.drawDefinition)return z({result:{error:_e},stack:n});let a=e?t.drawDefinition:ke(t.drawDefinition,!1,!0),{tieFormat:s,matchUpType:o}=t;if(s){let w=Bn({tieFormat:s});if(w.error)return w}s=jr(s??vn({drawDefinition:a})?.tieFormat),o=o??(a.matchUpType||Wt),t.tieFormat=s,t.matchUpType=o;let l=aP({drawDefinition:a,stage:xe});t.drawSize=t.drawSize??l,!l&&t.drawSize&&oP({drawSize:t.drawSize,drawDefinition:a,stageSequence:i,stage:xe});let u=kr({drawDefinition:a}).drawMatchUps.map(Ir),c=c0(t);if(c.error)return z({result:c,stack:n});let{structures:d,links:p,qualifyingResult:f}=c;a.structures=d,a.links=p;let m=Math.max(t.qualifiersCount??0,f?.qualifiersCount||0);if(f?.qualifyingDrawPositionsCount&&!aP({stage:We,drawDefinition:a})){let w=oP({drawSize:f.qualifyingDrawPositionsCount,stage:We,drawDefinition:a});if(w.error)return w}if(m){let w=s8({qualifiersCount:m,drawDefinition:a,stage:xe});if(w.error)return w}let h=t.drawSize??l;Object.assign(t,Ve({drawSize:h,matchUpType:o,tieFormat:s}));let{matchUps:g,matchUpsMap:I}=Qi({drawDefinition:a});s&&g?.forEach(w=>{if(!u.includes(w.matchUpId)){let{tieMatchUps:y}=Sh({tieFormat:s,matchUp:w,isMock:r});Object.assign(w,{tieMatchUps:y,matchUpType:o})}});let{inContextDrawMatchUps:v}=Np({drawDefinition:a,matchUpsMap:I});return ti({tournamentId:t.tournamentRecord?.tournamentId,drawDefinition:a}),{inContextDrawMatchUps:v,drawDefinition:a,matchUpsMap:I,...H,structures:d,matchUps:g,links:p}}function Iv(t){let{removePriorValues:e,tournamentRecord:i,participantId:r,scaleItem:n}=t,a,s;if(!a9({scaleItem:n}))return{error:Dm};if(r&&Array.isArray(i.participants)&&(s=i.participants.find(o=>o.participantId===r),s)){if(s.participantType===_n&&n?.eventType!==ya)return{error:Dm};let o=s9({removePriorValues:e,participant:s,scaleItem:n});if(o.error)return o;a=!o.valueChanged;let{topics:l}=gs();l.includes(en)&&at({topic:en,payload:{tournamentId:i.tournamentId,participants:[s]}})}return a&&{...H,info:tF,existingValue:n?.scaleValue}||s&&{...H,newValue:n?.scaleValue}||{error:Vi}}function n9(t){let{scaleItemsWithParticipantIds:e=[],removePriorValues:i,tournamentRecord:r,auditData:n,context:a}=t;if(!r)return{error:Ie};if(!r.participants)return{error:Aw};let s=0,o={},l=[];for(let d of e){let p=d?.participantId;if(Array.isArray(d?.scaleItems))for(let f of d.scaleItems)if(a9({scaleItem:f}))Array.isArray(o[p])||(o[p]=[]),o[p].push(f);else return{error:Dm}}for(let d of r.participants){let{participantId:p}=d||{};if(Array.isArray(o[p]))for(let f of o[p]){if(d.participantType===_n&&f?.eventType!==ya)return z({context:{participantId:p,scaleItem:f,participantType:d.participantType},info:"Invalid participantType for eventType",result:{error:Dm}});s9({participant:d,scaleItem:f,removePriorValues:i}),l.push(d),s++}}let u=s?void 0:tv,{topics:c}=gs();if(c.includes(en)&&s&&at({topic:en,payload:{tournamentId:r.tournamentId,participants:l}}),a){let{eventId:d,drawId:p,...f}=a,m=f.scaleAttributes?.scaleType&&[f.scaleAttributes.scaleType];if(Object.keys(f).length){let h={itemType:BF,itemValue:f};if(m&&(h.itemSubTypes=m),p||d){let{drawDefinition:g,event:I}=jn({tournamentRecord:r,eventId:d,drawId:p});p&&BL({drawDefinition:g,timeItem:h}),d&&Uh({event:I,timeItem:h})}else US({tournamentRecord:r,timeItem:h})}}return n&&c.includes(Qu)&&at({topic:Qu,payload:n}),Ve({...H,modificationsApplied:s,info:u})}function a9({scaleItem:t}){let e=t&&Object.keys(t),i=["scaleType","eventType","scaleName"];return i.filter(r=>e?.includes(r)).length===i.length}function s9({removePriorValues:t,participant:e,scaleItem:i}){if(!e)return{error:rh};let r=i&&Object.keys(i),n=["scaleType","eventType","scaleName"];if(n.filter(u=>r.includes(u)&&i[u]).length!==n.length)return{error:Dm};let a=new Date().toISOString();e.timeItems||(e.timeItems=[]);let{scaleItem:s}=Hl({scaleAttributes:i,participant:e}),o=u=>[void 0,null,""].includes(u),l=!(o(s?.scaleValue)&&o(i.scaleValue))&&JSON.stringify(s?.scaleValue)!==JSON.stringify(i.scaleValue);if(l){let{scaleType:u,eventType:c,scaleName:d}=i,p=[pd,u,c,d].join("."),f=Ve({itemValue:i.scaleValue,itemDate:i.scaleDate,createdAt:a,itemType:p});i.scaleId&&(f.itemSubTypes=[i.scaleId]),t&&(e.timeItems=e.timeItems.filter(m=>m.itemType!==p)),e.timeItems.push(f)}return{...H,valueChanged:l,newValue:i.scaleValue}}function p0(t){let{tournamentRecord:e,modifiedScaleValues:i,removePriorValues:r}=t,n=Ge(t,[{[mr]:!0},{modifiedScaleValues:!0,[zn]:Yn}]);if(n.error)return n;for(let a in i){let s=Iv({scaleItem:i[a],removePriorValues:r,tournamentRecord:e,participantId:a});if(s.error)return s}return{...H}}var CTe=(t=0)=>250/Math.pow(t+5,.4),MTe=()=>1;function NTe(t=3,e=2){let i=t/e;return Number.isNaN(i)?yg.kDefault():i}var yg={nSpread:400,diffThreshold:.125,kCalc:CTe,kMultiplier:NTe,kDefault:MTe};function o9(t){let{winnerRating:e,loserRating:i}=t,{ratings:r=Dr,winnerCountables:n=1,loserCountables:a=0,ratingType:s="ELO",maxCountables:o,countables:l}=t||{},u=r?.[s];if(!u)return{error:Xe};let c=u.range||t.ratingRange;e=e||u.defaultInitialization,i=i||u.defaultInitialization;let d=c[0]>c[1],p=u.decimalsCount||0,f=d?c.slice().reverse():c,m=(A,O)=>Number.parseFloat(O)>=Math.min(...A)&&Number.parseFloat(O)<=Math.max(...A);(!m(c,e)||!m(c,i))&&(m(c,e)||(e=u.defaultInitialization),m(c,i)||(i=u.defaultInitialization));let h=Cg({targetRange:Dr.ELO.range,sourceRange:f,value:d?c[0]-e:e}),g=Cg({targetRange:Dr.ELO.range,sourceRange:f,value:d?c[0]-i:i}),I=(A,O)=>1/(1+Math.pow(10,(O-A)/yg.nSpread)),v=I(h,g),w=I(g,h),y=yg.kCalc(n),b=yg.kCalc(a),S=yg.kMultiplier(o,l),U=h+S*y*(1-v),T=g+S*b*(0-w),P=Cg({sourceRange:Dr.ELO.range,value:U,targetRange:f}),D=Cg({sourceRange:Dr.ELO.range,value:T,targetRange:f}),E=d?c[0]-P:P,R=Number.parseFloat(E.toFixed(p)),C=d?c[0]-D:D,M=Number.parseFloat(C.toFixed(p)),N=Math.max(...c)?Math.abs(e-i)/Math.max(...c):0;return(P>D&&N>yg.diffThreshold||R<0||M<0)&&(R=e,M=i),{newWinnerRating:R,newLoserRating:M}}var ATe=t=>t?.reduce((e,i)=>(i.winningSide&&(e[i.winningSide-1]+=1),e),[0,0])||[0,0];function l9(t){let e=Ge(t,[{[mr]:!0},{matchUpIds:!0,[zn]:an,[xs]:th},{ratingType:!1,[Wr]:v=>Dr[v]}]);if(e.error)return e;let{updateParticipantRatings:i,removePriorValues:r=!0,tournamentRecord:n,ratingType:a="ELO",refreshDynamic:s,considerGames:o,drawDefinition:l,matchUpIds:u,asDynamic:c}=t,d=Dr[a],{accessor:p}=d,f={},m=(t.matchUps||s&&Rn({drawDefinition:l,tournamentRecord:n,inContext:!0,matchUpFilters:{matchUpStatuses:Yi}}).matchUps||br({matchUpFilters:{matchUpIds:u,matchUpStatuses:Yi},tournamentRecord:n,inContext:!0}).matchUps)??[],h=`${a}.${MF}`,g=c?h:a;m.sort(gh);for(let v of m){let{endDate:w,matchUpFormat:y,score:b,sides:S,winningSide:U}=v,T=v.matchUpType,P={eventType:T,scaleName:a,scaleType:od},D={scaleName:h,eventType:T,scaleType:od},E=Object.assign({},...(S??[]).map(x=>{let{sideNumber:L,participant:$}=x;return L&&{[L]:[$?.participantId,...$?.individualParticipantIds??[]].filter(Boolean).flat()}})),R=Object.assign({},...Object.values(E).flat().map(x=>{let L=f[x],$=!s||L?Am({scaleAttributes:D,tournamentRecord:n,participantId:x}).scaleItem:void 0,V=Am({tournamentRecord:n,scaleAttributes:P,participantId:x}).scaleItem,_=p?{[p]:void 0}:void 0;return x&&{[x]:$??V??{scaleName:g,eventType:T,scaleDate:w,scaleType:od,scaleValue:_}}})),C=y?zi(y):{},M=C?.bestOf||1,N=C?.setsTo||1,A=o?M&N:M,O=b?.sets&&ATe(b.sets)||U===1&&[1,0]||[0,1],k=U?E[U]:[],F=U?E[3-U]:[];for(let x of k){let L=R[x]?.scaleValue,$=typeof L=="object"?L[p]:L;for(let V of F){let _=R[V]?.scaleValue,B=typeof _=="object"?_[p]:_,G=U?O[U]:[0,0],j=U?O[3-U]:[0,0],{newWinnerRating:K,newLoserRating:Y}=o9({winnerCountables:G,loserCountables:j,maxCountables:A,winnerRating:$,loserRating:B,ratingType:a}),X=p?{...L,[p]:K}:K,Z=p?{..._,[p]:Y}:Y;R[x].scaleValue=X,R[V].scaleValue=Z,R[x].scaleName=g,R[V].scaleName=g}}Object.assign(f,R),i&&p0({tournamentRecord:n,modifiedScaleValues:f,removePriorValues:r})}let I=m.map(({matchUpId:v})=>v);return{...H,modifiedScaleValues:f,outputScaleName:g,processedMatchUpIds:I}}function iC(t){let{matchUpIds:e=[],drawDefinition:i,roundNumber:r,newRound:n,isMock:a,event:s}=t;if(typeof i!="object")return{error:_e};let{participantIdPairings:o,matchUpsCount:l}=t,u=QR(t);if(u.error)return z({result:u});let{lastRoundNumber:c,availableMatchUpsCount:d=0,roundMatchUpsCount:p=0}=u;if(!l)n?l=p:d>0&&(l=d);else if(l>p&&t.restrictMatchUpsCount!==!1)return z({result:{error:ie,info:"matchUpsCount error",context:{roundMatchUpsCount:p}}});if(o&&!Array.isArray(o)||l&&!ot(l)||e&&!Array.isArray(e)||!o&&!l)return{error:ie,info:"matchUpsCount or pairings error"};if(l&&t.restrictMatchUpsCount!==!1&&l>32)return{error:ie,info:"matchUpsCount must be less than 33"};if(r&&!t.ignoreLastRoundNumber&&r-1>(c||0))return{error:ie,info:"roundNumber error"};let f=r??(n&&(c??0)+1||c||1);o=o??Re(0,l).map(()=>({participantIds:[void 0,void 0]}));let m=g=>{if(!t.idPrefix)return;let I=i.drawId,v=t.idPrefix??"ah";return`${I}-${v}-${f}-${g}`},h=o?.map((g,I)=>{let v=g?.participantIds??[void 0,void 0];v.push(void 0,void 0);let w=v.slice(0,2).map((b,S)=>Ve({sideNumber:S+1,participantId:b})),y=e[I]??m(I)??Et();return{roundNumber:f,matchUpStatus:Fi,matchUpId:y,sides:w}});if(h?.length){let g=vn({drawDefinition:i,event:s})?.tieFormat;g&&h.forEach(I=>{let{tieMatchUps:v}=Sh({tieFormat:g,matchUp:I,isMock:a});Object.assign(I,{tieMatchUps:v,matchUpType:Zt})})}return{roundNumber:f,matchUpsCount:h?.length??0,matchUps:h,...H}}function kTe({maxIterations:t=4e3,valueSortedPairings:e,pairingValues:i,valueObjects:r,deltaObjects:n}){let a=Object.assign({},...e.map(v=>({[v.pairing]:v.value}))),s=Object.keys(i),o=[],l=nW({actorsCount:s.length,valueSortedPairings:e,pairingValueMap:a,deltaObjects:n,valueObjects:r}),u=[kA(l)];o.push(l);let c=l.value,d=l,p=1,f=0,m=s.length,h;do m-=1,h=s.length*i[s[0]].length;while(h>t&&m>5);let g=[];s.forEach(v=>{i[v].slice(0,m).forEach(w=>{f+=1;let y=am(v,w.opponent);if(!g.includes(y)){let b=nW({stipulated:[[v,w.opponent]],actorsCount:s.length,valueSortedPairings:e,pairingValueMap:a,deltaObjects:n,valueObjects:r});if(!u.includes(kA(b))){u.push(kA(b)),o.push(b);let{maxDelta:S,value:U}=b;S<d.maxDelta&&(d=b),(U<c||U===c&&Math.round(Math.random()))&&(c=U),g.push(y),p+=1}}}),o=o.filter(w=>Math.abs(w.value-c)<5)}),o.sort((v,w)=>v.maxDiff-w.maxDiff);let I=ma(o);return{candidatesCount:p,deltaCandidate:d,maxIterations:t,iterations:f,candidate:I}}function kA(t){return t.participantIdPairings.map(({participantIds:e})=>e.sort().join("|")).sort().join("/")}function nW({valueSortedPairings:t,stipulated:e=[],pairingValueMap:i,deltaObjects:r,valueObjects:n,actorsCount:a}){let s=e.flat(),o=[],l=0;e.filter(Boolean).forEach(d=>{let[p,f]=d,m=am(p,f),h=i[m];o.push({participantIds:d,value:h}),l+=i[m]}),yr(t,a).flatMap(d=>Dn(d).map(p=>({...p,value:p.value+Math.random()*Math.round(Math.random())}))).forEach(d=>{let p=d.pairing.split("|");if(!p.reduce((f,m)=>s.includes(m)||f,!1)){s.push(...p);let f=d.value;l+=f,o.push({participantIds:p,value:f})}}),o.sort((d,p)=>d.value-p.value);let u=o.reduce((d,p)=>{let[f,m]=p.participantIds,h=am(f,m),g=r[h];return Math.max(g,d)},0),c=o.reduce((d,p)=>{let[f,m]=p.participantIds,h=am(f,m),g=n[h];return Math.max(g,d)},0);return{value:l,participantIdPairings:o,maxDelta:u,maxDiff:c}}function am(t,e){return[t,e].sort($R).join("|")}function u9({participantIds:t}){let e={},i=[];t.forEach(n=>{e[n]=t.filter(a=>a!==n),e[n].forEach(a=>{let s=am(a,n);i.includes(s)||i.push(s)})});let r=Object.assign({},...i.map(n=>({[n]:0})));return{uniquePairings:i,possiblePairings:e,deltaObjects:r}}function OTe({matchUps:t}){let e=[];for(let i of t){let r=i.sides.map(vt);if(r.length===2){let[n,a]=r,s=am(n,a);e.includes(s)||e.push(s)}}return{encounters:e}}function xTe({possiblePairings:t,valueObjects:e}){let i={};for(let n of Object.keys(t)){let a=t[n].map(s=>r(n,s));i[n]=a.sort((s,o)=>s.value-o.value)}function r(n,a){let s=am(n,a);return{opponent:a,value:e[s]}}return{pairingValues:i}}var FTe=0;function LTe({tournamentParticipants:t,adHocRatings:e,eventType:i,scaleName:r,pairing:n}){let a=Dr[r]?.defaultInitialization??FTe;return n.split("|").map(s=>{if(i===ls){let o=t?.find(l=>l.participantId===s)?.individualParticipantIds;return o?o?.map(l=>e[l]||a):a*2}else return e[s]||a})}function _Te(t){let{tournamentParticipants:e,adHocRatings:i={},possiblePairings:r,uniquePairings:n,maxIterations:a,minimizeDelta:s,deltaObjects:o,valueObjects:l,eventType:u,scaleName:c,salted:d}=t;n.forEach(w=>{let y=LTe({tournamentParticipants:e,adHocRatings:i,scaleName:c,eventType:u,pairing:w}),b=typeof d=="number"&&d||.5,S=d&&(Math.round(Math.random())?b:b*-1)||0,U=Math.abs(y[0]-y[1])+S,T=Math.abs(y[0]-y[1]);o[w]=T,l[w]||(l[w]=0),l[w]+=U?Math.pow(U,2):0});let p=n.map(w=>({pairing:w,value:l[w]})).sort((w,y)=>w.value-y.value),{pairingValues:f}=xTe({possiblePairings:r,valueObjects:l}),{candidate:m,candidatesCount:h,deltaCandidate:g,iterations:I}=kTe({valueSortedPairings:p,maxIterations:a,pairingValues:f,deltaObjects:o,valueObjects:l}),{participantIdPairings:v}=s?g:m;return{participantIdPairings:v,candidatesCount:h,deltaCandidate:g,iterations:I,candidate:m}}var $Te=100,BTe=100,VTe=4e3;function f0(t){let{encounterValue:e=$Te,sameTeamValue:i=BTe,maxIterations:r=VTe,updateParticipantRatings:n,generateMatchUps:a=!0,ignoreLastRoundNumber:s,iterationMatchUps:o,tournamentRecord:l,dynamicRatings:u,refreshDynamic:c,participantIds:d,drawDefinition:p,roundNumber:f,structureId:m,matchUpIds:h,eventType:g,scaleName:I,idPrefix:v,isMock:w,salted:y,event:b}=t;if(!p)return{error:_e};if(!t.structure&&!m)return{error:Ii};let S=t.structure||et({drawDefinition:p,structureId:m}).structure;if(!bt(S))return{error:Zp};if(!d?.length)return{error:Od};let U=[...o??[],...S?.matchUps??[]],{encounters:T}=OTe({matchUps:U}),P=l?.participants??[],D={};if(u){let G=rt(S?.matchUps?S.matchUps.map(({roundNumber:K})=>K):[]),j=Math.max(...G,0);if(j){let K=S?.matchUps?.filter(({roundNumber:X})=>X===j).map(({matchUpId:X})=>X),Y=l9({ratingType:I??b?.category?.ratingType,updateParticipantRatings:n,tournamentRecord:l,asDynamic:!0,refreshDynamic:c,drawDefinition:p,matchUpIds:K});if(Y.error)return Y;Y.modifiedScaleValues&&(D=Y.modifiedScaleValues)}}let{valueObjects:E}=jTe({tournamentParticipants:P,encounterValue:e,sameTeamValue:i,encounters:T}),{uniquePairings:R,possiblePairings:C,deltaObjects:M}=u9({participantIds:d}),N=Object.values(D).length?D:t.adHocRatings,A={tournamentParticipants:P,possiblePairings:C,uniquePairings:R,maxIterations:r,adHocRatings:N,deltaObjects:M,valueObjects:E,eventType:g,scaleName:I,salted:y},{candidatesCount:O,participantIdPairings:k,deltaCandidate:F,iterations:x,candidate:L}=_Te(A);if(!O)return{error:XE};let $,V;if(a){let G=iC({structureId:S?.structureId,ignoreLastRoundNumber:s,participantIdPairings:k,newRound:!0,drawDefinition:p,roundNumber:f,matchUpIds:h,idPrefix:v,isMock:w,event:b});if(G.error)return G;$=G.roundNumber,V=G.matchUps}let{maxDelta:_,maxDiff:B}=L;return{roundNumber:$,participantIdPairings:k,modifiedScaleValues:D,candidatesCount:O,deltaCandidate:F,...H,iterations:x,matchUps:V,maxDelta:_,maxDiff:B}}function jTe({encounters:t,tournamentParticipants:e,encounterValue:i,sameTeamValue:r}){let n={};for(let s of t)n[s]||(n[s]=0),n[s]+=i;let a=e?.filter(({participantType:s})=>s===Lt);if(a)for(let s of a){let o=s.individualParticipantIds??[],{uniquePairings:l}=u9({participantIds:o});for(let u of l)n[u]||(n[u]=0),n[u]+=r}return{valueObjects:n}}function c9(t){let{drawType:e=Yo,attachConsolation:i=!0,applyPositioning:r=!0,tournamentRecord:n,staggeredEntry:a,automated:s,placeByes:o,isMock:l,event:u}=t,c=t?.drawDefinition;if(!c)return{error:_e};let d=Er,p=dh({stageSequence:1,drawDefinition:c,stage:d}),f=[Ks,_w,au].includes(e)?p.length:XI(p.length);if(!a&&e===rv&&p.length<2||e===Ks&&p.length<3)return{error:VE};let{tieFormat:m,matchUpType:h}=t;if(m){let E=Bn({tieFormat:m});if(E.error)return E}m=jr(m??vn({drawDefinition:c})?.tieFormat),h=h??c.matchUpType;let{structures:g}=Js({stageSequence:1,drawDefinition:c,stage:d});if(g.length>1)return{error:N6};if(g?.[0]?.matchUps?.length)return{error:nF};let I=g?.[0]?.structureId;Object.assign(t,Ve({structureName:t.structureName??Xr(Er),structureId:I,matchUpType:h,tieFormat:m,drawSize:f,stage:d}));let v=r9(t);if(v.error)return v;let w=v.generators[e];if(!w)return{error:F1};let y=w?.();if(y.error)return y;let{structures:b,links:S}=y,U=b.flatMap(E=>Nt({structure:E}).matchUps);m&&U.forEach(E=>{let{tieMatchUps:R}=Sh({matchUp:E,tieFormat:m,isMock:l});Object.assign(E,{tieMatchUps:R,matchUpType:h})}),(!r||!i)&&(c=ke(c,!1,!0)),c.links??=[],S.length&&c.links.push(...S);let T=new Set(b.map(({structureId:E})=>E));c.structures??=[];let P=new Set(c.structures.map(({structureId:E})=>E));c.structures=c.structures.map(E=>T.has(E.structureId)?b.find(({structureId:R})=>R===E.structureId):E);let D=b.filter(({structureId:E})=>!P.has(E));return D.length&&c.structures.push(...D),s&&IS({seedingProfile:t.seedingProfile,applyPositioning:r,tournamentRecord:n,drawDefinition:c,structureId:I,placeByes:o,drawSize:f,event:u}),i&&ti({drawDefinition:c}),{links:S,structures:b,...H}}var m0={};ct(m0,{ScoringEngine:()=>I9,addPoint:()=>gp,analyzeScore:()=>k0,analyzeSequence:()=>J9,analyzeSet:()=>Cb,calculateMatchStatistics:()=>D0,calculatePointsTo:()=>nC,checkScoreHasValue:()=>cr,checkSetIsComplete:()=>lC,createMatchUp:()=>rd,deduceMatchUpFormat:()=>mC,enrichPointHistory:()=>h9,exportMatchUpJSON:()=>oEe,generate:()=>d9,generateScoreString:()=>Wl,generateTieMatchUpScore:()=>wS,getEpisodes:()=>T0,getQuickStats:()=>g9,getScore:()=>yd,getScoreboard:()=>w0,getSetComplement:()=>x0,getSetScoreString:()=>HPe,getTiebreakComplement:()=>fC,getWinner:()=>S0,groupByMatch:()=>tX,helpers:()=>y9,inferServeSide:()=>g0,isComplete:()=>U0,isValidMatchUpFormat:()=>xa,keyValueScore:()=>B9,mcpValidator:()=>sEe,mutate:()=>v9,parseCSV:()=>eX,parseMCPPoint:()=>Z9,parseMatchUpFormat:()=>zi,parseScoreString:()=>CS,pbpValidator:()=>zPe,pointParser:()=>Q9,query:()=>W9,resolvePointValue:()=>I0,reverseScore:()=>p9,shotParser:()=>xO,shotSplitter:()=>X9,stringifyMatchUpFormat:()=>aR,tidyScore:()=>H9,toStatObjects:()=>P0,validateMCPMatch:()=>iX,validateMatchUp:()=>q9,validateMatchUpScore:()=>z9,validateScore:()=>O0,validateSet:()=>WPe,validateSetScore:()=>A0,validateTieFormat:()=>Bn});var d9={};ct(d9,{ScoringEngine:()=>I9,generateScoreString:()=>Wl,generateTieMatchUpScore:()=>wS,reverseScore:()=>p9});function Wl(t){let{winnerFirst:e=!0,setTBlast:i=!0,addOutcomeString:r,reversed:n=!1,matchUpStatus:a,matchUpFormat:s,autoComplete:o,winningSide:l,sets:u}=t;if(!u)return{error:Xe,info:"missing sets"};let c=s&&zi(s),{bestOf:d,finalSetFormat:p,setFormat:f}=c??{},m=n||!(!e||!l||l===1),h=r?GTe({matchUpStatus:a}):"",g=u?.sort(HTe).map(I).filter(Boolean).join(" ")||"";if(!h)return g;if(l===2)return`${h} ${g}`;return`${g} ${h}`;function I(v){let w=d&&v.setNumber===d&&p?p:f,y=V=>Ni(V?.side1Score)||Ni(V?.side2Score),b=(V=>Ni(V?.side1TiebreakScore)||Ni(V?.side2TiebreakScore))(v),S=w?.tiebreakSet||!y(v)&&b,{side1Score:U,side2Score:T,side1TiebreakScore:P,side2TiebreakScore:D}=v,E=P||(Ni(P)||b&&o?0:""),R=D||(Ni(D)||b&&o?0:"");if(S){let V=y(v)&&!b,_=V?U:E,B=V?T:R;return`[${(m?[B,_]:[_,B]).join("-")}]`}let C=b?Math.min(E,R):"",M=C===E?1:2,N=Ni(C)?`(${C})`:"",A=U||(Ni(U)||o?0:""),O=T||(Ni(T)||o?0:""),k=V=>!i&&M===V?N:"",F=`${A}${k(1)}`,x=`${O}${k(2)}`,L=i&&b?`(${C})`:"",$=m?`${[x,F].join("-")}${L}`:`${[F,x].join("-")}${L}`;return["-"," "].includes($)&&($=""),$}}function GTe({matchUpStatus:t}){let e={[$r]:"RET",[mi]:"WO",[Hi]:"DF/DF",[wi]:"WO/WO",[_d]:"SUS",[us]:"ABN",[Qt]:"DEF",[ov]:"DR"};return t&&e[t]||""}function HTe(t,e){return t.setNumber-e.setNumber}function p9(t){if(!t?.score)return{error:Xe};let{sets:e}=t.score,i=e.map(s=>{let{side1TiebreakScore:o,side2TiebreakScore:l,winningSide:u,side1Score:c,side2Score:d,setNumber:p}=s;return Ve({winningSide:u?3-u:void 0,side1TiebreakScore:l,side2TiebreakScore:o,side1Score:d,side2Score:c,setNumber:p})}),r=t?.setTBlast,n=Wl({setTBlast:r,sets:i}),a=Wl({sets:i,reversed:!0,setTBlast:r});return{reversedScore:{sets:i,scoreStringSide1:n,scoreStringSide2:a},...H}}function rd(t){let{matchUpId:e=Et(),matchUpFormat:i,participants:r=[],isDoubles:n=!1,matchUpType:a}=t,s=a||(n?"DOUBLES":"SINGLES"),o=r.map((l,u)=>({sideNumber:u+1,participantId:l.participantId,participant:l}));return o.length===0&&o.push({sideNumber:1},{sideNumber:2}),{matchUpId:e,matchUpFormat:i,matchUpStatus:"TO_BE_PLAYED",matchUpType:s,sides:o,score:{sets:[]},createdAt:new Date().toISOString()}}function h0(t){return t?!!t.aggregate:!1}function rC(t,e){let i=t.bestOf||t.exactly||3,r=Math.ceil(i/2);if(e[0]===r-1&&e[1]===r-1&&t.finalSetFormat){let a=t.finalSetFormat;return a.tiebreakSet?"matchTiebreak":a.timed?"timed":"standard"}let n=t.setFormat;return n?n.tiebreakSet?"tiebreakOnly":n.timed?"timed":"standard":"standard"}function nC(t,e,i,r,n){if(i==="timed"||!r)return;let a=WTe(t),s=zTe(t),o=e.exactly||e.bestOf||3,l=Math.ceil(o/2),{side1Points:u,side2Points:c}=qTe(a),d=YTe(u,c,r,i,e,a),p=XTe(a,r,i),f=JTe(d,p,r,i),m=QTe(f,s,l,e),h=eDe(d,n);return{pointsToGame:d,pointsToSet:f,pointsToMatch:m,gamesToSet:p,isBreakpoint:h}}function WTe(t){let e=t.score.sets;if(e.length===0)return;let i=e.at(-1);return i?.winningSide===void 0?i:void 0}function zTe(t){let e=[0,0];return t.score.sets.forEach(i=>{i.winningSide===1&&e[0]++,i.winningSide===2&&e[1]++}),e}function qTe(t){if(!t)return{side1Points:0,side2Points:0};let e=t.side1GameScores||[],i=t.side2GameScores||[];if(e.length===0&&i.length===0)return{side1Points:0,side2Points:0};let r=Math.max(e.length,i.length)-1;return{side1Points:e[r]??0,side2Points:i[r]??0}}function YTe(t,e,i,r,n,a){if(r==="tiebreakOnly"){let s=i.tiebreakSet?.tiebreakTo||11,o=i.tiebreakSet?.NoAD||!1;return OA(t,e,s,o)}if(r==="matchTiebreak"){let s=n.finalSetFormat?.tiebreakSet?.tiebreakTo||10,o=n.finalSetFormat?.tiebreakSet?.NoAD||!1;return OA(t,e,s,o)}if(a){let s=a.side1Score||0,o=a.side2Score||0,l=i.setTo||6,u=(typeof i.tiebreakAt=="number"?i.tiebreakAt:void 0)??l;if(!i.noTiebreak&&s===u&&o===u){let c=i.tiebreakFormat?.tiebreakTo||7,d=i.tiebreakFormat?.NoAD||!1;return OA(t,e,c,d)}}if(n.gameFormat?.type==="CONSECUTIVE"){let s=n.gameFormat.count||3;return[s,s]}return KTe(t,e,i)}function KTe(t,e,i){let r=i.gameFormat?.NoAD||i.NoAD||!1,n=4;return[aW(t,e,n,r),aW(e,t,n,r)]}function aW(t,e,i,r){if(t>=i-1&&e>=i-1){if(r)return t>e?0:t===e?1:2;let n=t-e;return n>=2?0:n===1?1:2}return t>=i?0:i-t}function OA(t,e,i,r){return[sW(t,e,i,r),sW(e,t,i,r)]}function sW(t,e,i,r){if(t>=i&&(t-e>=2||r&&t>e))return 0;if(t>=i-1&&e>=i-1){if(r)return t>e?0:t===e?1:2;let n=t-e;return n>=2?0:n===1?1:2}return t>=i?0:i-t}function XTe(t,e,i){if(i==="tiebreakOnly"||i==="matchTiebreak")return!t||t.winningSide!==void 0?[1,1]:[1,1];let r=t?.side1Score||0,n=t?.side2Score||0,a=e.setTo||6,s=(typeof e.tiebreakAt=="number"?e.tiebreakAt:void 0)??a,o=e.noTiebreak||!1,l=e.winBy||2;return[oW(r,n,a,s,o,l),oW(n,r,a,s,o,l)]}function oW(t,e,i,r,n,a){if(!n&&t===r&&e===r)return 1;if(t>=i){let o=t-e;return o>=a?0:a-o}let s=i-t;if(e>=i-1&&t>=i-1){if(!n)return Math.max(1,i-t);let o=t-e;return o>=a?0:a-o}return s}function JTe(t,e,i,r){if(r==="tiebreakOnly"||r==="matchTiebreak")return[...t];let n=4;return[lW(t[0],e[0],n),lW(t[1],e[1],n)]}function lW(t,e,i){if(e<=0)return 0;let r=Math.max(0,e-1);return t+r*i}function QTe(t,e,i,r){let n=r.setFormat,a=ZTe(n,r);return[uW(t[0],e[0],i,a),uW(t[1],e[1],i,a)]}function ZTe(t,e){if(!t)return 24;if(t.tiebreakSet)return t.tiebreakSet.tiebreakTo||11;if(t.timed)return 0;let i=t.setTo||6,r=e.gameFormat?.type==="CONSECUTIVE"?e.gameFormat?.count||3:4;return i*r}function uW(t,e,i,r){if(e>=i)return 0;let n=Math.max(0,i-e-1);return t+n*r}function eDe(t,e){if(e===void 0)return!1;let i=1-e;return t[i]===1}function g0(t,e,i){if(i==="timed")return;let r=tDe(t);return h0(e)?iDe(t,r):i==="tiebreakOnly"||i==="matchTiebreak"?rDe(r):nDe(t,e,r)}function tDe(t){let e=t.score.sets;if(e.length===0)return;let i=e[e.length-1];return i.winningSide===void 0?i:void 0}function iDe(t,e){let i=0;for(let r of t.score.sets)r.winningSide!==void 0&&(r.side1TiebreakScore!==void 0?i+=(r.side1TiebreakScore??0)+(r.side2TiebreakScore??0):i+=(r.side1Score??0)+(r.side2Score??0));if(e&&e.winningSide===void 0){let r=e.side1GameScores||[],n=e.side2GameScores||[];if(r.length>0||n.length>0){let a=Math.max(r.length,n.length)-1;i+=(r[a]??0)+(n[a]??0)}else i+=(e.side1Score??0)+(e.side2Score??0)}return i%2===0?"deuce":"ad"}function rDe(t){if(!t)return"deuce";let e=t.side1GameScores||[],i=t.side2GameScores||[];return e.length===0&&i.length===0||((e[0]??0)+(i[0]??0))%2===0?"deuce":"ad"}function nDe(t,e,i){if(!i)return"deuce";let r=i.side1GameScores||[],n=i.side2GameScores||[];if(r.length===0&&n.length===0)return"deuce";let a=Math.max(r.length,n.length)-1;return((r[a]??0)+(n[a]??0))%2===0?"deuce":"ad"}function I0(t,e){if(!e.length)return 1;for(let{condition:i,value:r}of e)if(i.results&&t.result&&i.results.includes(t.result)||i.strokes&&t.stroke&&i.strokes.includes(t.stroke))return r;return 1}function gp(t,e,i){if(!bt(e)||e.winner===void 0||e.winner===null)return t;let r=t,{winner:n,server:a,timestamp:s}=e;r.history??={points:[]};let o=zi(t.matchUpFormat);if(!o)throw new Error(`Invalid matchUpFormat: ${t.matchUpFormat}`);let l=o.exactly||o.bestOf||3,u=Math.ceil(l/2),c=r.history.points.length+1,d=r.history.points.length,p=[0,0];r.score.sets.forEach(U=>{U.winningSide===1&&p[0]++,U.winningSide===2&&p[1]++});let f=rC(o,p),m=p[0]===u-1&&p[1]===u-1,h=m&&o.finalSetFormat?o.finalSetFormat:o.setFormat,g=h?.tiebreakSet?.modifier==="RALLY"||h?.modifier==="RALLY";a===void 0&&!g&&(a=b0(r,o,f));let I=e.code;!I&&n!==void 0&&a!==void 0&&(I=n===a?"S":"R");let v={...e,pointNumber:c,winner:n,server:a,timestamp:s||new Date().toISOString()};I&&(v.code=I),v.index=d;let w=nC(r,o,f,h,a);w&&(v.pointsToGame=w.pointsToGame,v.pointsToSet=w.pointsToSet,v.pointsToMatch=w.pointsToMatch,v.gamesToSet=w.gamesToSet,v.isBreakpoint=w.isBreakpoint);let y=g0(r,o,f);y!==void 0&&(v.serveSide=y);let b=i?.pointMultipliers||[],S=I0(v,b);switch(S!==1&&(v.scoreValue=S),r.history.points.push(v),r.matchUpStatus==="TO_BE_PLAYED"&&(r.matchUpStatus="IN_PROGRESS"),f){case"tiebreakOnly":sDe(r,v,n,o,h,p,u,S);break;case"matchTiebreak":oDe(r,v,n,o,p,u,S);break;case"timed":lDe(r,v,n,h,S);break;default:aDe(r,v,n,o,h,p,u,m);break}return r}function aDe(t,e,i,r,n,a,s,o){let l=aC(t,!1,!1),u=t.score.sets.indexOf(l),c=l.side1Score||0,d=l.side2Score||0,p=l.side1GameScores||[],f=l.side2GameScores||[];p.length===0&&f.length===0&&(p.push(0),f.push(0));let m=Math.max(p.length,f.length)-1,h=m>=0?p[m]??0:0,g=m>=0?f[m]??0:0;e.set=u,e.game=m,e.number=h+g;let I=n.setTo||6,v=(typeof n.tiebreakAt=="number"?n.tiebreakAt:void 0)??I,w=o&&r.finalSetFormat?.noTiebreak;i===0?(h++,p[p.length-1]=h):(g++,f[f.length-1]=g),l.side1GameScores=p,l.side2GameScores=f;let y=r.gameFormat?.type==="CONSECUTIVE",b=r.gameFormat?.count||3;if(y){let P=l.currentStreak;P&&P.side===i?l.currentStreak={side:i,count:P.count+1}:l.currentStreak={side:i,count:1}}let S=!w&&c===v&&d===v,U;y&&!S?U=l.currentStreak.count>=b?l.currentStreak.side:void 0:U=uDe(h,g,n,S);let T=U===void 0?f9(h,g,S,y&&!S):"0-0";if(e.score=T,U!==void 0){y&&(l.currentStreak=void 0),U===0?l.side1Score=c+1:l.side2Score=d+1,S&&(l.side1TiebreakScore=h,l.side2TiebreakScore=g);let P=cDe(l.side1Score||0,l.side2Score||0,n,o,r.finalSetFormat);typeof P=="number"?(l.winningSide=P+1,v0(t,r,s)):(l.side1GameScores.push(0),l.side2GameScores.push(0))}}function sDe(t,e,i,r,n,a,s,o=1){let l=aC(t,!0,!1),u=t.score.sets.indexOf(l),c=n.tiebreakSet.tiebreakTo||11,d=n.tiebreakSet.NoAD||!1,p=l.side1GameScores||[],f=l.side2GameScores||[];p.length===0&&f.length===0&&(p.push(0),f.push(0),l.side1GameScores=p,l.side2GameScores=f);let m=p[0]||0,h=f[0]||0;e.set=u,e.game=0,e.number=m+h,i===0?(m+=o,p[0]=m):(h+=o,f[0]=h),l.side1GameScores=p,l.side2GameScores=f;let g=y0(m,h,c,d);e.score=g===void 0?`${m}-${h}`:"0-0",g!==void 0&&(l.winningSide=g+1,l.side1TiebreakScore=m,l.side2TiebreakScore=h,l.side1Score=g===0?1:0,l.side2Score=g===0?0:1,v0(t,r,s))}function oDe(t,e,i,r,n,a,s=1){let o=r.finalSetFormat?.tiebreakSet?.tiebreakTo||10,l=r.finalSetFormat?.tiebreakSet?.NoAD||!1,u=aC(t,!1,!1),c=t.score.sets.indexOf(u),d=u.side1GameScores||[],p=u.side2GameScores||[];d.length===0&&p.length===0&&(d.push(0),p.push(0),u.side1GameScores=d,u.side2GameScores=p);let f=d[0]||0,m=p[0]||0;e.set=c,e.game=0,e.number=f+m,i===0?(f+=s,d[0]=f):(m+=s,p[0]=m),u.side1GameScores=d,u.side2GameScores=p;let h=y0(f,m,o,l);e.score=h===void 0?`${f}-${m}`:"0-0",h!==void 0&&(u.side1TiebreakScore=f,u.side2TiebreakScore=m,u.side1Score=h===0?1:0,u.side2Score=h===0?0:1,u.winningSide=h+1,v0(t,r,a))}function lDe(t,e,i,r,n=1){let a=aC(t,!1,!0),s=t.score.sets.indexOf(a);e.set=s,e.game=0,e.number=(a.side1Score||0)+(a.side2Score||0),i===0?a.side1Score=(a.side1Score||0)+n:a.side2Score=(a.side2Score||0)+n;let o=a.side1Score||0,l=a.side2Score||0;e.score=`${o}-${l}`}function aC(t,e,i){let r=t.score.sets.length-1;if(r>=0&&t.score.sets[r].winningSide===void 0)return t.score.sets[r];let n={setNumber:t.score.sets.length+1,side1Score:0,side2Score:0,side1GameScores:[],side2GameScores:[]};return e&&(n.isTiebreakOnly=!0),i&&(n.isTimed=!0),t.score.sets.push(n),n}function v0(t,e,i){let r=[0,0];t.score.sets.forEach(o=>{o.winningSide===1&&r[0]++,o.winningSide===2&&r[1]++});let n=h0(e),a=e.exactly;if(n){let o=a||e.bestOf||3;if(t.score.sets.filter(u=>u.winningSide!==void 0).length<o)return;let l=t.score.sets.reduce((u,c)=>(c.side1TiebreakScore!==void 0&&c.side2TiebreakScore!==void 0?(u[0]+=c.side1TiebreakScore,u[1]+=c.side2TiebreakScore):(u[0]+=c.side1Score??0,u[1]+=c.side2Score??0),u),[0,0]);l[0]!==l[1]&&(t.matchUpStatus="COMPLETED",t.winningSide=l[0]>l[1]?1:2,t.endTime=new Date().toISOString());return}if(!(r[0]>=i||r[1]>=i)||a&&t.score.sets.filter(o=>o.winningSide!==void 0).length<a)return;let s=r[0]>=i?0:1;t.matchUpStatus="COMPLETED",t.winningSide=s+1,t.endTime=new Date().toISOString()}function y0(t,e,i,r=!1){let n=Math.abs(t-e),a=r?1:2;if((t>=i||e>=i)&&n>=a)return t>e?0:1}function uDe(t,e,i,r){let n=i.gameFormat?.NoAD||i.NoAD||!1;if(r){let o=i.tiebreakFormat?.tiebreakTo||7,l=i.tiebreakFormat?.NoAD||!1;return y0(t,e,o,l)}let a=4,s=Math.abs(t-e);if(n)return t>=a||e>=a?t>e?0:1:void 0;if((t>=a||e>=a)&&s>=2)return t>e?0:1}function cDe(t,e,i,r,n){let a=i.setTo||6,s=(typeof i.tiebreakAt=="number"?i.tiebreakAt:void 0)??a,o=r&&n?.noTiebreak;if(a===1)return t>=1||e>=1?t>e?0:1:void 0;let l=(r&&n?n:i).winBy||2;if(!o&&(t===s+1||e===s+1)||(t>=a||e>=a)&&Math.abs(t-e)>=l)return t>e?0:1}function b0(t,e,i){let r=dDe(t,e,i);return t.history?.points?.[0]?.server===1?1-r:r}function dDe(t,e,i){let r=t.score.sets.length-1,n=r>=0?t.score.sets[r]:void 0;if(i==="tiebreakOnly"||i==="matchTiebreak"){let u=n?.side1GameScores||[],c=n?.side2GameScores||[],d=(u[0]||0)+(c[0]||0),p=0;for(let h=0;h<t.score.sets.length-1;h++){let g=t.score.sets[h];p+=(g.side1Score||0)+(g.side2Score||0)}let f=p%2,m=Math.floor(d/2)%2;return(f+m)%2}if(i==="timed")return((n?.side1Score||0)+(n?.side2Score||0))%2;let a=n?.side1Score||0,s=n?.side2Score||0,o=e.setFormat?.setTo||6,l=(typeof e.setFormat?.tiebreakAt=="number"?e.setFormat.tiebreakAt:void 0)??o;if(!e.finalSetFormat?.noTiebreak&&a===l&&s===l){let u=n?.side1GameScores||[],c=n?.side2GameScores||[],d=(u.at(-1)||0)+(c.at(-1)||0),p=(a+s)%2,f=Math.floor(d/2)%2;return(p+f)%2}return(a+s)%2}function f9(t,e,i,r){if(i||r)return`${t}-${e}`;let n=["0","15","30","40"];if(t<4&&e<4)return`${n[t]}-${n[e]}`;if(t>=3&&e>=3&&t===e)return"40-40";if(t>=3&&e>=3){let a=t-e;if(a===1)return"A-40";if(a===-1)return"40-A";if(a>=2)return"G-40";if(a<=-2)return"40-G"}return t>=3?`40-${e<4?n[e]:"40"}`:e>=3?`${t<4?n[t]:"40"}-40`:`${t<4?n[t]:"0"}-${e<4?n[e]:"0"}`}function yd(t,e){let i=t.score.sets,r=mDe(t,e?.useBracketNotation),n=i.length>0?i.at(-1):null,a=n&&n.winningSide===void 0?[n.side1Score||0,n.side2Score||0]:[0,0],s=[0,0];if(n?.side1GameScores&&n.side2GameScores){let u=Math.max(n.side1GameScores.length,n.side2GameScores.length)-1;u>=0&&(s=[n.side1GameScores[u]||0,n.side2GameScores[u]||0])}let o=pDe(t,s),l=fDe(t);return{sets:i,scoreString:r,games:a,points:s,pointDisplay:o,situation:l}}function pDe(t,e){if(t.matchUpStatus==="COMPLETED"||t.matchUpStatus==="TO_BE_PLAYED")return;let i=zi(t.matchUpFormat);if(!i)return;let r=t.score.sets.at(-1);if(!r||r.winningSide!==void 0)return;let n=[0,0];t.score.sets.forEach(c=>{c.winningSide===1&&n[0]++,c.winningSide===2&&n[1]++});let a=rC(i,n),s=a==="tiebreakOnly"||a==="matchTiebreak",o=i.gameFormat?.type==="CONSECUTIVE",l=s;if(!l&&a==="standard"){let c=i.exactly||i.bestOf||3,d=Math.ceil(c/2),p=n[0]===d-1&&n[1]===d-1,f=p&&i.finalSetFormat?i.finalSetFormat:i.setFormat;if(f){let m=r.side1Score||0,h=r.side2Score||0,g=f.setTo||6,I=(typeof f.tiebreakAt=="number"?f.tiebreakAt:void 0)??g,v=f.noTiebreak||!1,w=p&&i.finalSetFormat?.noTiebreak;l=!v&&!w&&m===I&&h===I}}let u=f9(e[0],e[1],l,o&&!l).split("-");return u.length===2?[u[0],u[1]]:[String(e[0]),String(e[1])]}function fDe(t){if(t.matchUpStatus==="COMPLETED"||t.matchUpStatus==="TO_BE_PLAYED")return;let e=zi(t.matchUpFormat);if(!e)return;let i=e.exactly||e.bestOf||3,r=Math.ceil(i/2),n=[0,0];t.score.sets.forEach(y=>{y.winningSide===1&&n[0]++,y.winningSide===2&&n[1]++});let a=rC(e,n),s=n[0]===r-1&&n[1]===r-1,o=s&&e.finalSetFormat?e.finalSetFormat:e.setFormat,l=o?.tiebreakSet?.modifier==="RALLY"||o?.modifier==="RALLY",u;l||(u=b0(t,e,a));let c=nC(t,e,a,o,u);if(!c)return{isBreakPoint:!1,isGamePoint:!1,isSetPoint:!1,isMatchPoint:!1,isGoldenPoint:!1,isTiebreak:!1,server:u};let{pointsToGame:d,pointsToSet:p,pointsToMatch:f,isBreakpoint:m}=c,h=a==="tiebreakOnly"||a==="matchTiebreak";if(!h&&a==="standard"&&o){let y=t.score.sets.at(-1);if(y){let b=y.side1Score||0,S=y.side2Score||0,U=o.setTo||6,T=(typeof o.tiebreakAt=="number"?o.tiebreakAt:void 0)??U,P=o.noTiebreak||!1,D=s&&e.finalSetFormat?.noTiebreak;h=!P&&!D&&b===T&&S===T}}let g=!!(o?.NoAD||o?.gameFormat?.NoAD||h&&(o?.tiebreakFormat?.NoAD||o?.tiebreakSet?.NoAD||e.finalSetFormat?.tiebreakSet?.NoAD))&&d[0]===1&&d[1]===1,I=u===void 0?!1:d[u]===1,v=Math.min(p[0],p[1])===1,w=Math.min(f[0],f[1])===1;return{isBreakPoint:m,isGamePoint:I,isSetPoint:v,isMatchPoint:w,isGoldenPoint:g,isTiebreak:h,server:u}}function mDe(t,e=!1){let i=t.score.sets;return i.length===0?"0-0":i.map(r=>{let n=r.side1Score||0,a=r.side2Score||0;if(r.side1TiebreakScore!==void 0||r.side2TiebreakScore!==void 0){let s=r.side1TiebreakScore||0,o=r.side2TiebreakScore||0;return e&&(n===0&&a===1||n===1&&a===0)?`[${s}-${o}]`:n>a?`${n}-${a}(${o})`:`${n}(${s})-${a}`}return`${n}-${a}`}).join(", ")}function w0(t,e){let i=t.score.sets;if(i.length===0)return"0-0";let r=e?.perspective,n=i.map(s=>{let o=s.side1Score||0,l=s.side2Score||0;if(r===1&&([o,l]=[l,o]),s.side1TiebreakScore!==void 0||s.side2TiebreakScore!==void 0){let u=s.side1TiebreakScore||0,c=s.side2TiebreakScore||0;return r===1&&([u,c]=[c,u]),o>l?`${o}-${l}(${c})`:`${o}(${u})-${l}`}return`${o}-${l}`}),a=i.at(-1);if(t.matchUpStatus==="IN_PROGRESS"&&a&&!a.winningSide){let s=a.side1GameScores||[],o=s.length-1;if(o>=0&&s.length>0){let l=s[o]||0,u=(a.side2GameScores||[])[o]||0;if(l===0&&u===0)return n.join(", ");r===1&&([l,u]=[u,l]);let c=a.side1Score||0,d=a.side2Score||0,p=t.matchUpFormat?zi(t.matchUpFormat):void 0,f=p?.setFormat?.setTo||6,m=(typeof p?.setFormat?.tiebreakAt=="number"?p.setFormat.tiebreakAt:void 0)??f,h=c===m&&d===m,g=p?.gameFormat?.type==="CONSECUTIVE",I=n.at(-1),v=`${n.slice(0,-1).join(", ")}${n.length>1?", ":""}${I}`;if(h||g)return`${v} (${l}-${u})`;{let w=hDe(l,u);return`${v} (${w})`}}}return n.join(", ")}function hDe(t,e){let i=["0","15","30","40"];if(t<=3&&e<=3)return`${i[t]}-${i[e]}`;if(t>=3&&e>=3){let r=t-e;return r===0?"40-40":r===1?"A-40":r===-1?"40-A":r>=2?"G-40":"40-G"}return t>=3?"G-40":e>=3?"40-G":`${i[t]}-${i[e]}`}function S0(t){if(t.matchUpStatus==="COMPLETED")return t.winningSide}function U0(t){return t.matchUpStatus==="COMPLETED"}function T0(t){if(!t)return[];let e=t.history?.points;if(!e||e.length===0)return[];let i=[];for(let r=0;r<e.length;r++){let n=e[r],a=r<e.length-1?e[r+1]:void 0,s=n.set??0,o=n.game??0,l=n.number??0,u=a?a.set??0:void 0,c=a?a.game??0:void 0,d=r===e.length-1,p=d?t.matchUpStatus==="COMPLETED"||u===void 0&&c===void 0:u!==s||c!==o,f=d?t.matchUpStatus==="COMPLETED"||!1:a!==void 0&&u!==s,m;p&&(m=n.winner);let h;if(f){let b=t.score.sets[s];b?.winningSide!==void 0&&(h=b.winningSide-1)}let g={};n.pointsToGame&&(g.pointsToGame=n.pointsToGame),n.pointsToSet&&(g.pointsToSet=n.pointsToSet),n.pointsToMatch&&(g.pointsToMatch=n.pointsToMatch),n.gamesToSet&&(g.gamesToSet=n.gamesToSet),n.isBreakpoint!==void 0&&(g.isBreakpoint=n.isBreakpoint);let I=a?.server??n.server??0,v=t.score.sets[s],w=!!(v?.isTiebreakOnly||o>0&&v&&v.side1Score!==void 0&&v.side2Score!==void 0&&!v.isTiebreakOnly),y={action:"addPoint",point:{index:r,number:l,winner:n.winner,server:n.server,score:n.score,result:n.result},game:{index:o,isTiebreak:w,complete:p,winner:m},set:{index:s,complete:f,winner:h},needed:g,nextService:I,result:n.result,complete:d&&t.matchUpStatus==="COMPLETED"};i.push(y)}return i}var gDe={A:"Ace",D:"Double Fault",S:"Serve Winner",R:"Return Winner",W:"Winner",E:"Unforced Error",F:"Forced Error"},IDe=new Set(["A","S"]),vDe=new Set(["D","R","E","F"]);function yDe(t,e){let i={...t};return i.server=e.server,i.index=e.index,i.set=e.set,i.game=e.game,i.code&&!i.winner&&(i.winner=bDe(i.code,e.server)),i.code&&!i.result&&(i.result=gDe[i.code]),i.first_serve?i.serve=2:i.serve||(i.serve=1),i}function bDe(t,e){return IDe.has(t)?e:vDe.has(t)?1-e:e}function wDe(t){let e=[],i=[],r=t.result?.toLowerCase()||"";return r.includes("ace")&&e.push("aces"),(r.includes("winner")||r.includes("ace"))&&e.push("winners"),r.includes("double fault")&&i.push("doubleFaults"),r.includes("unforced error")&&i.push("unforcedErrors"),r.includes("forced error")&&i.push("forcedErrors"),t.winner===t.server?(e.push("servesWon"),t.serve===1?e.push("serves1stWon"):t.serve===2&&e.push("serves2ndWon")):(e.push("returns"),t.serve===1?e.push("received1stWon"):t.serve===2&&e.push("received2ndWon")),e.push("pointsWon"),{winner:e,loser:i}}function m9(t,e){let i={players:{},teams:{}};for(let a=0;a<2;a++)i.players[a]={},i.teams[a]={};let r=t;e?.setFilter!==void 0&&(r=t.filter(a=>a.set===e.setFilter));let n;return r.forEach((a,s)=>{if(a.winner===void 0){console.warn("Point missing winner:",a);return}let{winner:o,loser:l}=wDe(a),u=a.winner,c=1-u;if(o.forEach(d=>{i.teams[u][d]||(i.teams[u][d]=[]),i.teams[u][d].push(a),i.players[u][d]||(i.players[u][d]=[]),i.players[u][d].push(a)}),l.forEach(d=>{i.teams[c][d]||(i.teams[c][d]=[]),i.teams[c][d].push(a),i.players[c][d]||(i.players[c][d]=[]),i.players[c][d].push(a)}),a.server!==void 0){let d=a.server;i.teams[d].pointsServed||(i.teams[d].pointsServed=[]),i.teams[d].pointsServed.push(a),a.serve===1?(i.teams[d].serves1stIn||(i.teams[d].serves1stIn=[]),i.teams[d].serves1stIn.push(a)):a.serve===2&&(i.teams[d].serves2ndIn||(i.teams[d].serves2ndIn=[]),i.teams[d].serves2ndIn.push(a))}if(a.hand){let d=a.hand;i.teams[u][d]||(i.teams[u][d]=[]),i.teams[u][d].push({point:a,index:s})}if(SDe(a,n)&&n?.winner!==void 0){let d=n.winner;i.teams[d].gamesWon||(i.teams[d].gamesWon=[]),i.teams[d].gamesWon.push(n),i.players[d].gamesWon||(i.players[d].gamesWon=[]),i.players[d].gamesWon.push(n)}if(a.breakpoint){let d=a.server;i.teams[d].breakpointsFaced||(i.teams[d].breakpointsFaced=[]),i.teams[d].breakpointsFaced.push(a),u===d&&(i.teams[d].breakpointsSaved||(i.teams[d].breakpointsSaved=[]),i.teams[d].breakpointsSaved.push(a))}n=a}),i}function SDe(t,e){return e&&t.game!==void 0&&e.game!==void 0?t.game!==e.game:!1}function UDe(t){let e={totalPoints:0,byTeam:[0,0],byCategory:{}};for(let r=0;r<2;r++)if(t.teams[r].pointsWon){let n=t.teams[r].pointsWon.length;e.byTeam[r]=n,e.totalPoints+=n}let i=new Set;for(let r=0;r<2;r++)Object.keys(t.teams[r]).forEach(n=>i.add(n));return i.forEach(r=>{e.byCategory[r]=0;for(let n=0;n<2;n++)t.teams[n][r]&&(e.byCategory[r]+=t.teams[n][r].length)}),e}function TDe(t){if(!t?.teams)return[];let e=[];return Object.values({Aces:{category:"Aces",numerators:["aces"],calc:"number"},"Double Faults":{category:"Double Faults",numerators:["doubleFaults"],calc:"number"},Winners:{category:"Winners",numerators:["winners"],calc:"number"},"Unforced Errors":{category:"Unforced Errors",numerators:["unforcedErrors"],calc:"number"},"Forced Errors":{category:"Forced Errors",numerators:["forcedErrors"],calc:"number"},"Total Points Won":{category:"Total Points Won",numerators:["pointsWon"],calc:"number"},"Max Pts/Row":{category:"Max Pts/Row",numerators:["pointsWon"],calc:"maxConsecutive",attribute:"index"},"Max Games/Row":{category:"Max Games/Row",numerators:["gamesWon"],calc:"maxConsecutive",attribute:"game"},"First Serve %":{category:"First Serve %",numerators:["serves1stIn"],denominators:["pointsServed"],calc:"percentage"},"Points Won 1st":{category:"Points Won 1st",numerators:["serves1stWon"],denominators:["serves1stIn"],calc:"percentage"},"Points Won 2nd":{category:"Points Won 2nd",numerators:["serves2ndWon"],denominators:["serves2ndIn"],calc:"percentage"},"Points Won Receiving":{category:"Points Won Receiving",numerators:["received1stWon","received2ndWon"],denominators:["-pointsServed"],calc:"percentage"},"Breakpoints Saved":{category:"Breakpoints Saved",numerators:["breakpointsSaved"],denominators:["breakpointsFaced"],calc:"percentage"},"Breakpoints Converted":{category:"Breakpoints Converted",numerators:["-breakpointsSaved"],denominators:["-breakpointsFaced"],calc:"difference"},"Games Won":{category:"Games Won",numerators:["gamesWon"],calc:"number"},"Service Points Won":{category:"Service Points Won",numerators:["servesWon"],denominators:["pointsServed"],calc:"percentage"},"Aggressive Margin":{category:"Aggressive Margin",numerators:["*doubleFaults","*unforcedErrors"],denominators:["*aces","*winners","-*forcedErrors"],calc:"aggressiveMargin"}}).forEach(i=>{let r=[cW(i,t.teams,0),cW(i,t.teams,1)];(r[0].value!==0||r[1].value!==0)&&e.push({category:i.category,teams:r})}),e}function cW(t,e,i){switch(t.calc){case"number":return DDe(t,e,i);case"percentage":return PDe(t,e,i);case"maxConsecutive":return EDe(t,e,i);case"difference":return RDe(t,e,i);case"aggressiveMargin":return CDe(t,e,i)}}function DDe(t,e,i){let r=Om(t.numerators,e,i);return{value:r,display:String(r),numerators:t.numerators}}function PDe(t,e,i){let r=Om(t.numerators,e,i),n=Om(t.denominators||[],e,i);if(!n)return{value:0,display:"0",numerators:t.numerators};let a=Math.round(r/n*100);return{value:a,display:`${a}% (${r}/${n})`,numerators:t.numerators}}function EDe(t,e,i){let r=t.numerators[0],n=t.attribute||"index";if(!e[i][r])return{value:0,display:"0"};let a=e[i][r],s=0,o=a.length?1:0,l;return a.forEach(u=>{let c=u[n];l!==void 0&&c===l+1?o++:(o>s&&(s=o),o=1),l=c}),o>s&&(s=o),{value:s,display:String(s)}}function RDe(t,e,i){let r=Om(t.numerators,e,i),n=Om(t.denominators||[],e,i);if(!n)return{value:0,display:"0",numerators:t.numerators};let a=Math.abs(n-r),s=Math.round(a/n*100);return{value:s,display:`${s}% (${a}/${n})`,numerators:t.numerators}}function CDe(t,e,i){let r=Om(t.denominators||[],e,i),n=Om(t.numerators,e,i),a=r-n;return{value:a,display:String(a)}}function Om(t,e,i){return t?t.reduce((r,n)=>{let a=n.startsWith("-");n.includes("*");let s=n.replace("-","").replace("*",""),o=a?1-i:i,l=e[o]?.[s];return l?r+l.length:r},0):0}function D0(t,e,i){let r=m9(e||[],i),n=TDe(r),a=UDe(r);return{counters:r,calculated:n,summary:a}}function h9(t){if(!t)return[];let e=[],i=0,r=0,n=0;return t.forEach((a,s)=>{let o=yDe(a,{server:i,index:s,set:r,game:n});e.push(o)}),e}function g9(t,e){let i=m9(t||[],e);return{aces:[i.teams[0].aces?.length||0,i.teams[1].aces?.length||0],doubleFaults:[i.teams[0].doubleFaults?.length||0,i.teams[1].doubleFaults?.length||0],winners:[i.teams[0].winners?.length||0,i.teams[1].winners?.length||0],unforcedErrors:[i.teams[0].unforcedErrors?.length||0,i.teams[1].unforcedErrors?.length||0],totalPoints:[i.teams[0].pointsWon?.length||0,i.teams[1].pointsWon?.length||0]}}function Vt(t,e,i){return t.teams[e]?.[i]?.length??0}function Ts(t,e){return!e||!t?0:Number.parseFloat((t/e*100).toFixed(2))}function yT(t,e,i){return t.find(r=>r.category===e)?.teams[i]?.value??0}function P0(t){if(!t?.counters?.teams)return[];let{counters:e,calculated:i}=t,r=[];r.push({name:"Aces",numerator:[Vt(e,0,"aces"),Vt(e,1,"aces")],default:"numerator"},{name:"Double Faults",numerator:[Vt(e,0,"doubleFaults"),Vt(e,1,"doubleFaults")],default:"numerator"});let n=[Vt(e,0,"serves1stWon"),Vt(e,1,"serves1stWon")],a=[Vt(e,0,"servesWon"),Vt(e,1,"servesWon")];if(n[0]+n[1]>0&&(a[0]!==n[0]||a[1]!==n[1])){let y=[Vt(e,0,"pointsServed"),Vt(e,1,"pointsServed")],b=[Vt(e,0,"serves1stIn"),Vt(e,1,"serves1stIn")],S=[Vt(e,0,"serves2ndWon"),Vt(e,1,"serves2ndWon")],U=[Vt(e,0,"serves2ndIn"),Vt(e,1,"serves2ndIn")];r.push({name:"1st Serve In",numerator:b,denominator:y,pct:[Ts(b[0],y[0]),Ts(b[1],y[1])]},{name:"1st Serve Points Won",numerator:n,denominator:b,pct:[Ts(n[0],b[0]),Ts(n[1],b[1])]},{name:"2nd Serve Points Won",numerator:S,denominator:U,pct:[Ts(S[0],U[0]),Ts(S[1],U[1])]})}r.push({name:"Total Points Won",numerator:[Vt(e,0,"pointsWon"),Vt(e,1,"pointsWon")],default:"numerator"});let s=Vt(e,0,"received1stWon")+Vt(e,0,"received2ndWon"),o=Vt(e,1,"received1stWon")+Vt(e,1,"received2ndWon"),l=Vt(e,1,"pointsServed"),u=Vt(e,0,"pointsServed");r.push({name:"Receiving Points Won",numerator:[s,o],denominator:[l,u],pct:[Ts(s,l),Ts(o,u)]});let c=Vt(e,1,"breakpointsFaced")-Vt(e,1,"breakpointsSaved"),d=Vt(e,0,"breakpointsFaced")-Vt(e,0,"breakpointsSaved"),p=Vt(e,1,"breakpointsFaced"),f=Vt(e,0,"breakpointsFaced");r.push({name:"Break Points Won",numerator:[c,d],denominator:[p,f],pct:[Ts(c,p),Ts(d,f)]});let m=Vt(e,0,"breakpointsSaved"),h=Vt(e,1,"breakpointsSaved"),g=Vt(e,0,"breakpointsFaced"),I=Vt(e,1,"breakpointsFaced");r.push({name:"Break Points Saved",numerator:[m,h],denominator:[g,I],pct:[Ts(m,g),Ts(h,I)]},{name:"Winners",numerator:[Vt(e,0,"winners"),Vt(e,1,"winners")],default:"numerator"},{name:"Unforced Errors",numerator:[Vt(e,0,"unforcedErrors"),Vt(e,1,"unforcedErrors")],default:"numerator"},{name:"Forced Errors",numerator:[Vt(e,0,"forcedErrors"),Vt(e,1,"forcedErrors")],default:"numerator"});let v=a,w=[Vt(e,0,"pointsServed"),Vt(e,1,"pointsServed")];return r.push({name:"Service Points Won",numerator:v,denominator:w,pct:[Ts(v[0],w[0]),Ts(v[1],w[1])]},{name:"Games Won",numerator:[Vt(e,0,"gamesWon"),Vt(e,1,"gamesWon")]},{name:"Most Consecutive Points Won",numerator:[yT(i,"Max Pts/Row",0),yT(i,"Max Pts/Row",1)]},{name:"Most Consecutive Games Won",numerator:[yT(i,"Max Games/Row",0),yT(i,"Max Games/Row",1)]}),r}var I9=class{constructor(e={}){this.redoStack=[],this.pointMultipliers=[],e.competitionFormat?(this.competitionFormat=e.competitionFormat,this.matchUpFormat=e.matchUpFormat||e.competitionFormat.matchUpFormat||"SET3-S:6/TB7",this.pointMultipliers=e.pointMultipliers||e.competitionFormat.pointMultipliers||[]):(this.matchUpFormat=e.matchUpFormat||"SET3-S:6/TB7",this.pointMultipliers=e.pointMultipliers||[]),this.matchUpId=e.matchUpId,this.isDoubles=e.isDoubles||!1,this.eventHandlers=e.eventHandlers,this.state=rd({matchUpFormat:this.matchUpFormat,matchUpId:this.matchUpId,isDoubles:this.isDoubles}),this.cacheFormatStructure()}setState(e){this.state=e,this.matchUpFormat=e.matchUpFormat,this.matchUpId=e.matchUpId,this.isDoubles=e.matchUpType==="DOUBLES",this.redoStack=[],this.initialScore=void 0,this.cacheFormatStructure()}getState(){return this.state}addPoint(e){let i=this.state.history?.points.length||0,r=this.state.score.sets.reduce((o,l)=>o+(l.side1Score||0)+(l.side2Score||0),0),n=this.state.score.sets.filter(o=>o.winningSide!==void 0).length,a=this.state.matchUpStatus==="COMPLETED",s=this.hasLineUp()?this.getActivePlayers():void 0;if(this.state=gp(this.state,e,{pointMultipliers:this.pointMultipliers}),s){let o=this.state.history.points[this.state.history.points.length-1];this.isDoubles?o.activePlayers=[s.side1,s.side2]:o.activePlayers=[s.side1[0]||"",s.side2[0]||""]}if(e.penaltyType){let o=this.state.history.points[this.state.history.points.length-1];o.penaltyType=e.penaltyType}if(this.ensureHistory(),this.state.history.entries.push({type:"point",data:{winner:e.winner,server:e.server,timestamp:e.timestamp,rallyLength:e.rallyLength,result:e.result,penaltyType:e.penaltyType},timestamp:e.timestamp||new Date().toISOString(),pointIndex:i}),this.redoStack=[],this.eventHandlers){let o=this.buildEventContext();if(this.eventHandlers.onPoint?.(o),this.state.score.sets.reduce((l,u)=>l+(u.side1Score||0)+(u.side2Score||0),0)>r&&this.eventHandlers.onGameComplete?.({...o,gameWinner:e.winner}),this.state.score.sets.filter(l=>l.winningSide!==void 0).length>n){let l=this.state.score.sets.findLast(u=>u.winningSide!==void 0)?.winningSide===1?0:1;this.eventHandlers.onSetComplete?.({...o,setWinner:l})}if(!a&&this.state.matchUpStatus==="COMPLETED"){let l=this.state.winningSide===1?0:1;this.eventHandlers.onMatchComplete?.({...o,matchWinner:l})}}}addSet(e){this.applyAddSet(e),this.ensureHistory();let i=this.state.score.sets.at(-1)?.winningSide;this.state.history.entries.push({type:"set",data:{...e,winningSide:i},timestamp:e.timestamp||new Date().toISOString()}),this.redoStack=[]}addGame(e){this.applyAddGame(e),this.ensureHistory(),this.state.history.entries.push({type:"game",data:e,timestamp:e.timestamp||new Date().toISOString()}),this.redoStack=[]}endSegment(e){this.applyEndSegment(e),this.ensureHistory();let i=(e?.setNumber??this.state.score.sets.length)-1;this.state.history.entries.push({type:"endSegment",data:{setNumber:i+1,...e},timestamp:e?.timestamp||new Date().toISOString()})}setInitialScore(e){this.initialScore=e,this.redoStack=[],this.applyInitialScore(this.state,e),this.ensureHistory(),this.state.history.entries.push({type:"setInitialScore",data:e,timestamp:new Date().toISOString()}),this.state.matchUpStatus==="TO_BE_PLAYED"&&(this.state.matchUpStatus="IN_PROGRESS")}undo(e=1){let i=this.state.history?.entries;if(i&&i.length>0){let a=Math.min(e,i.length);for(let s=0;s<a;s++){let o=i.pop();this.redoStack.push(o),o.type==="point"&&this.state.history.points.pop()}return this.rebuildFromEntries(),this.eventHandlers?.onUndo?.(this.buildEventContext()),!0}let r=this.state.history?.points||[];if(r.length===0)return!1;let n=Math.min(e,r.length);for(let a=0;a<n;a++){let s=r.pop();this.redoStack.push({type:"point",data:{winner:s.winner,server:s.server,timestamp:s.timestamp,rallyLength:s.rallyLength},timestamp:s.timestamp||""})}return this.rebuildState(),this.eventHandlers?.onUndo?.(this.buildEventContext()),!0}redo(e=1){if(this.redoStack.length===0)return!1;let i=Math.min(e,this.redoStack.length);for(let r=0;r<i;r++){let n=this.redoStack.pop();this.ensureHistory(),this.state.history.entries.push(n),n.type}return this.rebuildFromEntries(),this.eventHandlers?.onRedo?.(this.buildEventContext()),!0}canUndo(){let e=this.state.history?.entries;return e&&e.length>0?!0:(this.state.history?.points.length||0)>0}canRedo(){return this.redoStack.length>0}getUndoDepth(){let e=this.state.history?.entries;return e&&e.length>0?e.length:this.state.history?.points.length||0}getRedoDepth(){return this.redoStack.length}getScore(){return yd(this.state)}getScoreboard(e){return w0(this.state,e)}getWinner(){return S0(this.state)}isComplete(){return U0(this.state)}getPointCount(){return this.state.history?.points.length||0}getFormat(){return this.state.matchUpFormat}getStatistics(e){let i=this.state.history?.points||[];return D0(this.state,i,e)}getStatObjects(e){return P0(this.getStatistics(e))}getNextServer(){if(this.competitionFormat?.serverRule==="WINNER_SERVES"){let r=this.state.history?.points.at(-1);return r?r.winner:0}if(!this.cachedFormatStructure)return 0;let e=[0,0];this.state.score.sets.forEach(r=>{r.winningSide===1&&e[0]++,r.winningSide===2&&e[1]++});let i=rC(this.cachedFormatStructure,e);return b0(this.state,this.cachedFormatStructure,i)}getEpisodes(){return T0(this.state)}isNoAd(){return!!(this.cachedFormatStructure?.setFormat?.NoAD||this.cachedFormatStructure?.setFormat?.gameFormat?.NoAD)}getSetsToWin(){if(!this.cachedFormatStructure)return 2;let e=this.cachedFormatStructure.exactly||this.cachedFormatStructure.bestOf||3;return Math.ceil(e/2)}getTiebreakAt(){let e=this.cachedFormatStructure?.setFormat;if(!e||e.tiebreakSet||e.timed||e.noTiebreak)return null;let i=e.setTo||6;return(typeof e.tiebreakAt=="number"?e.tiebreakAt:void 0)??i}hasFinalSetTiebreak(){let e=this.cachedFormatStructure?.finalSetFormat;return e?e.tiebreakSet?!0:e.noTiebreak?!1:!!(e.tiebreakFormat||e.tiebreakAt!==void 0):this.getTiebreakAt()!==null}getFormatStructure(){return this.cachedFormatStructure}getInputMode(){let e=this.state.history?.entries||[];if(e.length===0)return(this.state.history?.points.length||0)>0?"points":"none";let i=new Set(e.filter(r=>r.type!=="setInitialScore"&&r.type!=="endSegment").map(r=>r.type));if(i.size===0)return"none";if(i.size===1){let r=i.values().next().value;if(r==="point")return"points";if(r==="game")return"games";if(r==="set")return"sets"}return"mixed"}setLineUp(e,i){let r=this.state.sides.find(n=>n.sideNumber===e);r&&(r.lineUp=i),this.initialLineUps??={},this.initialLineUps[e]=i.map(n=>({...n}))}substitute(e){let i=this.state.sides.find(a=>a.sideNumber===e.sideNumber);if(!i?.lineUp)return;let r=i.lineUp.findIndex(a=>a.participantId===e.outParticipantId);if(r===-1)return;this.ensureHistory(),this.state.history.substitutions??=[];let n={sideNumber:e.sideNumber,outParticipantId:e.outParticipantId,inParticipantId:e.inParticipantId,beforePointIndex:this.state.history.points.length,timestamp:e.timestamp};this.state.history.substitutions.push(n),i.lineUp[r]={...i.lineUp[r],participantId:e.inParticipantId},this.state.history.entries.push({type:"substitution",data:n,timestamp:e.timestamp||new Date().toISOString()}),this.redoStack=[]}getActivePlayers(){let e=this.state.sides.find(r=>r.sideNumber===1),i=this.state.sides.find(r=>r.sideNumber===2);return{side1:e?.lineUp?.map(r=>r.participantId)||[],side2:i?.lineUp?.map(r=>r.participantId)||[]}}hasLineUp(){return this.state.sides.some(e=>e.lineUp&&e.lineUp.length>0)}setPointMultipliers(e){this.pointMultipliers=e}getPointMultipliers(){return this.pointMultipliers}getSupplementaryState(){return{redoStack:[...this.redoStack],initialLineUps:this.initialLineUps?Object.fromEntries(Object.entries(this.initialLineUps).map(([e,i])=>[e,i.map(r=>({...r}))])):void 0}}loadSupplementaryState(e){e.redoStack&&(this.redoStack=[...e.redoStack]),e.initialLineUps&&(this.initialLineUps=Object.fromEntries(Object.entries(e.initialLineUps).map(([i,r])=>[i,r.map(n=>({...n}))])))}getPenaltyProfile(){return this.competitionFormat?.penaltyProfile}getPointProfile(){return this.competitionFormat?.pointProfile}getTimerProfile(){return this.competitionFormat?.timerProfile}getTimeoutRules(){return this.competitionFormat?.timeoutRules}getSubstitutionRules(){return this.competitionFormat?.substitutionRules}getPlayerRules(){return this.competitionFormat?.playerRules}setEventHandlers(e){this.eventHandlers=e}getEventHandlers(){return this.eventHandlers}decoratePoint(e,i){let r=this.state.history?.points[e];r&&Object.assign(r,i)}markHardBoundary(e){let i=this.state.score.sets[e.setIndex];i&&(i.hardBoundaries??=[],i.hardBoundaries.includes(e.gameIndex)||(i.hardBoundaries.push(e.gameIndex),i.hardBoundaries.sort((r,n)=>r-n)))}editPoint(e,i,r){let n=this.state.history?.points;if(!n||e<0||e>=n.length)return;let a=r?.recalculate!==!1,s=n[e];if(i.winner!==void 0&&(s.winner=i.winner),i.server!==void 0&&(s.server=i.server),i.timestamp!==void 0&&(s.timestamp=i.timestamp),i.rallyLength!==void 0&&(s.rallyLength=i.rallyLength),i.wrongSide!==void 0&&(s.wrongSide=i.wrongSide),i.wrongServer!==void 0&&(s.wrongServer=i.wrongServer),i.penaltyPoint!==void 0&&(s.penaltyPoint=i.penaltyPoint),!a)return;let o=this.state.history?.entries;if(o){let l=o.find(u=>u.type==="point"&&u.pointIndex===e);l&&(i.winner!==void 0&&(l.data.winner=i.winner),i.server!==void 0&&(l.data.server=i.server))}o&&o.length>0?this.rebuildFromEntries():this.rebuildState(),this.redoStack=[]}reset(){this.state=rd({matchUpFormat:this.matchUpFormat,matchUpId:this.matchUpId,isDoubles:this.isDoubles}),this.redoStack=[],this.initialScore=void 0,this.initialLineUps=void 0,this.eventHandlers?.onReset?.(this.buildEventContext())}ensureHistory(){this.state.history??={points:[]},this.state.history.entries??=[]}buildEventContext(){return{state:this.state,score:yd(this.state)}}cacheFormatStructure(){this.cachedFormatStructure=zi(this.matchUpFormat)}getInitialLineUps(){return this.initialLineUps}applyAddSet(e){let{side1Score:i,side2Score:r,side1TiebreakScore:n,side2TiebreakScore:a}=e,s=e.winningSide;s===void 0&&(i>r?s=1:r>i&&(s=2));let o={setNumber:this.state.score.sets.length+1,side1Score:i,side2Score:r,winningSide:s};n!==void 0&&(o.side1TiebreakScore=n),a!==void 0&&(o.side2TiebreakScore=a),this.state.score.sets.push(o),this.state.matchUpStatus==="TO_BE_PLAYED"&&(this.state.matchUpStatus="IN_PROGRESS"),s!==void 0&&this.checkMatchCompletion()}applyAddGame(e){let{winner:i,tiebreakScore:r}=e,n=this.state.score.sets.length>0?this.state.score.sets.at(-1):void 0;(!n||n.winningSide!==void 0)&&(n={setNumber:this.state.score.sets.length+1,side1Score:0,side2Score:0},this.state.score.sets.push(n)),i===0?n.side1Score=(n.side1Score||0)+1:n.side2Score=(n.side2Score||0)+1,r&&(n.side1TiebreakScore=r[0],n.side2TiebreakScore=r[1]),this.state.matchUpStatus==="TO_BE_PLAYED"&&(this.state.matchUpStatus="IN_PROGRESS"),this.checkSetCompletion(n),n.winningSide!==void 0&&this.checkMatchCompletion()}applySubstitution(e){let i=this.state.sides.find(n=>n.sideNumber===e.sideNumber);if(!i?.lineUp)return;let r=i.lineUp.findIndex(n=>n.participantId===e.outParticipantId);r!==-1&&(i.lineUp[r]={...i.lineUp[r],participantId:e.inParticipantId},this.state.history??={points:[]},this.state.history.substitutions??=[],this.state.history.substitutions.push(e))}applyEndSegment(e){let i=(e?.setNumber??this.state.score.sets.length)-1,r=this.state.score.sets[i];if(!r||r.winningSide!==void 0)return;let n=r.side1Score||0,a=r.side2Score||0;n>a?r.winningSide=1:a>n&&(r.winningSide=2),this.checkMatchCompletion()}checkSetCompletion(e){let i=zi(this.state.matchUpFormat);if(!i)return;let r=i.exactly||i.bestOf||3,n=Math.ceil(r/2),a=[0,0];this.state.score.sets.forEach(u=>{u.winningSide===1&&a[0]++,u.winningSide===2&&a[1]++});let s=a[0]===n-1&&a[1]===n-1&&i.finalSetFormat?i.finalSetFormat:i.setFormat;if(!s)return;let o=e.side1Score||0,l=e.side2Score||0;if(s.tiebreakSet){let u=s.tiebreakSet.tiebreakTo||11,c=s.tiebreakSet.NoAD?1:2;(o>=u||l>=u)&&Math.abs(o-l)>=c&&(e.winningSide=o>l?1:2)}else if(!s.timed){let u=s.setTo||6,c=(typeof s.tiebreakAt=="number"?s.tiebreakAt:void 0)??u,d=s.noTiebreak||!1,p=s.winBy||2;(!d&&e.side1TiebreakScore!==void 0&&(o===c+1||l===c+1)||(o>=u||l>=u)&&Math.abs(o-l)>=p)&&(e.winningSide=o>l?1:2)}}checkMatchCompletion(){let e=zi(this.state.matchUpFormat);if(!e)return;let i=e.exactly||e.bestOf||3,r=Math.ceil(i/2),n=h0(e),a=e.exactly;if(n){let s=a||i;if(this.state.score.sets.filter(o=>o.winningSide!==void 0).length>=s){let o=this.state.score.sets.reduce((l,u)=>(u.side1TiebreakScore===void 0?(l[0]+=u.side1Score??0,l[1]+=u.side2Score??0):(l[0]+=u.side1TiebreakScore,l[1]+=u.side2TiebreakScore??0),l),[0,0]);o[0]!==o[1]&&(this.state.matchUpStatus="COMPLETED",this.state.winningSide=o[0]>o[1]?1:2,this.state.endTime=new Date().toISOString())}}else{let s=[0,0];if(this.state.score.sets.forEach(o=>{o.winningSide===1&&s[0]++,o.winningSide===2&&s[1]++}),(s[0]>=r||s[1]>=r)&&(!a||this.state.score.sets.filter(o=>o.winningSide!==void 0).length>=a)){let o=s[0]>=r?0:1;this.state.matchUpStatus="COMPLETED",this.state.winningSide=o+1,this.state.endTime=new Date().toISOString()}}}rebuildFromEntries(){let e=this.state.history?.entries||[],i=this.getInitialLineUps(),r=rd({matchUpFormat:this.matchUpFormat,matchUpId:this.matchUpId,isDoubles:this.isDoubles});if(i)for(let n of r.sides)i[n.sideNumber]&&(n.lineUp=i[n.sideNumber].map(a=>({...a})));this.initialScore&&(this.applyInitialScore(r,this.initialScore),r.matchUpStatus==="TO_BE_PLAYED"&&(r.matchUpStatus="IN_PROGRESS")),r.history={points:[],entries:[...e]},this.state=r;for(let n of e)switch(n.type){case"point":this.state=gp(this.state,n.data,{pointMultipliers:this.pointMultipliers}),this.state.history.entries=r.history.entries;break;case"set":this.applyAddSet(n.data);break;case"game":this.applyAddGame(n.data);break;case"endSegment":this.applyEndSegment(n.data);break;case"substitution":this.applySubstitution(n.data);break}}rebuildState(){let e=this.state.history?.points||[],i=rd({matchUpFormat:this.matchUpFormat,matchUpId:this.matchUpId,isDoubles:this.isDoubles});this.initialScore&&(this.applyInitialScore(i,this.initialScore),i.matchUpStatus==="TO_BE_PLAYED"&&(i.matchUpStatus="IN_PROGRESS"));for(let r of e)i=gp(i,{winner:r.winner,server:r.server,timestamp:r.timestamp,rallyLength:r.rallyLength,result:r.result},{pointMultipliers:this.pointMultipliers});this.state=i}applyInitialScore(e,i){e.score.sets=[];for(let r=0;r<i.sets.length;r++){let n=i.sets[r],a={setNumber:r+1,side1Score:n.side1Score,side2Score:n.side2Score};n.side1TiebreakScore!==void 0&&(a.side1TiebreakScore=n.side1TiebreakScore),n.side2TiebreakScore!==void 0&&(a.side2TiebreakScore=n.side2TiebreakScore),n.winningSide!==void 0?a.winningSide=n.winningSide:n.side1Score>n.side2Score?a.winningSide=1:n.side2Score>n.side1Score&&(a.winningSide=2),e.score.sets.push(a)}if(i.currentSetScore){let r={setNumber:e.score.sets.length+1,side1Score:i.currentSetScore.side1Score,side2Score:i.currentSetScore.side2Score,side1GameScores:[],side2GameScores:[]};i.currentGameScore?(r.side1GameScores=[i.currentGameScore.side1Points],r.side2GameScores=[i.currentGameScore.side2Points]):(r.side1GameScores=[0],r.side2GameScores=[0]),e.score.sets.push(r)}}},v9={};ct(v9,{addPoint:()=>gp,calculatePointsTo:()=>nC,createMatchUp:()=>rd,inferServeSide:()=>g0,resolvePointValue:()=>I0});var y9={};ct(y9,{keyValueScore:()=>B9,parseMatchUpFormat:()=>zi,stringifyMatchUpFormat:()=>aR,tidyScore:()=>H9});var MDe="COMPLETED",NDe="WO/WO",b9=["RET","DEF","WO",NDe,"ABN","SUS","INT"],NO="DEFAULTED",w9="WALKOVER",S9="ABANDONED",U9="SUSPENDED",T9="RETIRED",D9="INTERRUPTED",ADe=[T9,NO,w9],kDe="Enter Score",xm="()",xp="[]",E0=["up","left","shift+tab"],R0=["enter","down","tab","right"],cP="backspace",P9="r",E9="s",R9="a",C9="d",M9="w",N9="i",sC=[P9,C9,M9,R9,E9,N9],oC="space",xA=["[","("],dP=[...E0,...R0,oC,"]"],A9="-",ODe="/",sm=A9,zl=A9,k9=[ODe],xDe=0,FDe=["=","+","num_1","num_2","shift+=","shift+-"],C0=["0","1","2","3","4","5","6","7","8","9"].concat(sC),O9=C0.map(t=>`shift+${t}`),x9=[sm,cP].concat(dP,k9),F9=[C0,O9,x9].join(","),LDe=[F9,E0,R0,FDe].join(","),_De={OUTCOMEKEYS:sC,SIDE1KEYS:C0,SIDE2KEYS:O9,MODIFIERS:x9,PROMPT:kDe,MOVEUP:E0,MOVEDOWN:R0,HOTKEYS:LDe};function sg({scoreString:t,lowSide:e,outcome:i}){if({scoreString:t}=L9({scoreString:t}),e===2){let r=(t&&t[t.length-1])!==" "?" ":"";return t+r+i}else return i+" "+t}function L9({scoreString:t}){if(!t)return{scoreString:""};let e=!1;for(let i of b9){let r=t?.indexOf(i);r===0?t=t.slice(i.length+1).trim()+" ":r>0&&(t=t.slice(0,r)),r>=0&&(e=!0)}return t?.trim()||(t=""),{scoreString:t,removed:e}}function AO({analysis:t,scoreString:e,sets:i,lowSide:r}){let n,a;if(!e)return{scoreString:e,sets:i};let{scoreString:s,removed:o}=L9({scoreString:e});if(e=s,o)return{scoreString:e,sets:i,outcomeRemoved:!0};let l=i[i.length-1]||{},u=Object.values(l).filter(h=>h!==void 0).length;l.setNumber&&u===1&&(i=i.slice(0,i.length-1),l=i[i.length-1]||{});let{tiebreakSet:c}=t.setFormat,{tiebreakTo:d,NoAD:p}=c||{},{isTiebreakEntry:f}=jg({brackets:xp,scoreString:e}),m=BDe(e);if(m>=0){n=e.slice(0,m);let{isTiebreakEntry:h}=jg({brackets:xm,scoreString:n}),{lastOpenBracketIndex:g,isTiebreakEntry:I}=jg({brackets:xp,scoreString:n}),v=n&&n[n.length-1].trim(),w=n&&!isNaN(v),y=t.isIncompleteSetScore;if(f&&I){let b=n.slice(g+1).split(zl),S=b?.length>0&&b[0]!==void 0&&!isNaN(parseInt(b[0]))&&parseInt(b[0])||void 0,U=b?.length>1&&b[1]!==void 0&&parseInt(b[1])||void 0,T=[S,U];if(U){let P=r===1?1:0;T[P]=(T?.[1-P]||0)+(p?1:2),(T[P]||0)<d&&(T[P]=d),n=e.slice(0,g+1),n+=T.join(zl)}else S!==void 0?(n=e.slice(0,g+1),n+=S):(n=e.slice(0,g),y=!0);l.side1TiebreakScore=T[0]||0,l.side2TiebreakScore=T[1]||0}if(n.length||(n=void 0),y){let b=l.side1Score?.toString();if(b){let S=b?.slice(0,b.length-1);l.side1Score=!isNaN(S)&&parseInt(S)||void 0,l.side1Score===void 0&&(l.side2Score=void 0)}t.isTimedSet?(a=l.side1Score?i:i?.slice(0,i.length-1)||[],a[i.length-1]=l):a=i?.slice(0,i.length-1)||[]}else if(w){let b=l.side2Score?.toString(),S=l.side1Score?.toString();if(!t.isTiebreakEntry&&!t.isMatchTiebreak)if(l.side2Score){let U=b?.slice(0,b.length-1);l.side2Score=!isNaN(U)&&parseInt(U)||void 0}else{let U=S?.slice(0,S.length-1);l.side1Score=!isNaN(U)&&parseInt(U)||void 0}t.isTimedSet?l.side1Score?(a=i||[],a[i.length-1]=l):a=i?.slice(0,i.length-1)||[]:(a=i||[],a[i.length-1]=l),a[a.length-1]&&Object.assign(a[a.length-1],{winningSide:void 0})}else h?(a=i||[],Object.assign(a[a.length-1]||{},{winningSide:void 0,side1TiebreakScore:void 0,side2TiebreakScore:void 0})):(f&&!I?a=i?.slice(0,i.length-1)||[]:(a=i,a[i.length-1]=l),f||(a[a.length-1].side2Score=0,a[a.length-1].winningSide=void 0));return{scoreString:n,sets:a}}return{scoreString:e,sets:i}}function jg({brackets:t=xm,scoreString:e}){if(!e)return{};let[i,r]=t.split(""),n=e.split(""),a=Math.max(...qo(i,n)),s=Math.max(...qo(r,n));return{isTiebreakEntry:a>s,lastOpenBracketIndex:a}}function $De({scoreString:t}){if(!t)return!1;let e=t&&t[t.length-1].trim(),i=t&&!isNaN(e),[r,n]=xp.split(""),a=t.split(""),s=Math.max(...qo(r,a)),o=Math.max(...qo(n,a)),l=Math.max(...qo(zl,a));return i&&s>o&&l>s}function BDe(t){return t.split("").reduce((e,i,r)=>(i.match(/\d+/g)&&e.push(r),e),[]).pop()}function _9(t){let{lowValue:e=0,NoAD:i=!1,tiebreakTo:r}=t||{},n=i?1:2;return e+1>=r?e+n:parseInt(r)}function dW({matchUpFormat:t,matchUpStatus:e,winningSide:i,sets:r}){let n=zi(t),{bestOf:a}=n,s=Math.ceil(a/2),o=r?.reduce((l,u)=>{let{winningSide:c}=u;return c&&l[c-1]++,l},[0,0])?.indexOf(s)+1||void 0;return ADe.includes(e)&&i&&(o=i),{matchUpWinningSide:o}}function lC({ignoreTiebreak:t=!1,matchUpScoringFormat:e,matchUpFormat:i,isTiebreakSet:r,isDecidingSet:n,isTimedSet:a,set:s}){if(!s)return{error:Xe,info:"missing set"};e=e||i&&zi(i);let o=n&&e.finalSetFormat||e?.setFormat||{},{side1Score:l,side2Score:u}=s,{setTo:c,tiebreakAt:d}=o,p=l||u,f=uC({set:s}),m=Math.abs(l-u),h=l>=c||u>=c,g=r||l>=c&&u>=c||d&&d<c&&(l===d||u===d),I=t||g&&(f===1&&s.side1TiebreakScore>s.side2TiebreakScore||f===2&&s.side2TiebreakScore>s.side1TiebreakScore),v=!g&&o.NoAD||g||r&&o.tiebreakFormat?.NoAD?1:2,w=m>=v;return!!((a&&p||h&&(w||g)||r)&&(!g||I))}function uC({set:t}){if(t.side1Score||t.side2Score){if(t.side1Score>t.side2Score)return 1;if(t.side2Score>t.side1Score)return 2}else if(t.side1TiebreakScore||t.side2TiebreakScore){if(t.side1TiebreakScore>t.side2TiebreakScore)return 1;if(t.side2TiebreakScore>t.side1TiebreakScore)return 2}}function M0({analysis:t,set:e}){let i=uC({set:e}),{isDecidingSet:r,isTiebreakSet:n,matchUpScoringFormat:a}=t;return lC({matchUpScoringFormat:a,isDecidingSet:r,isTiebreakSet:n,set:e})&&i}function VDe({analysis:t,scoreString:e,sets:i,value:r}){let n;if(!i?.length)return{sets:[]};let a=i[i.length-1];r=Ye(r);let{validSide2Score:s,requiresTiebreak:o}=jDe({analysis:t,set:a,value:r});if(s){n=!0,e=(e||"")+r,a.side2Score=r;let l=M0({analysis:t,set:i[i.length-1]});if(a.winningSide=l||void 0,o){let u=xm.split("")[0];e+=u}else t.isDecidingSet||(e+=" ")}return{sets:i,scoreString:e,updated:n}}function jDe({analysis:t,set:e={},value:i}){let r=t.isDecidingSet&&t.matchUpScoringFormat.finalSetFormat||t.matchUpScoringFormat.setFormat,{tiebreakAt:n,setTo:a,NoAD:s}=r,{side1Score:o}=e,l,u;return n&&n<a?o===n?l=i<=a:l=i<=n:o===a?s?l=i<a:l=i<=a+1:o===a-1?s?l=i<=a:l=i<=a+1:o===a+1?l=i===a||i===a-1:l=i<=a,l&&(n&&n<a?u=o===a&&i===n||o===n&&i===a:u=o>=a&&i>=a&&o!==i),{validSide2Score:l,requiresTiebreak:u}}function $9({lowSide:t,value:e,sets:i,scoreString:r,winningSide:n,matchUpStatus:a}){let s;return e===P9?r?(s=!0,r=sg({scoreString:r,lowSide:t,outcome:"RET"}),n=t===2?1:2,a=T9):(s=!0,r=sg({scoreString:r,lowSide:t,outcome:"DEF"}),n=t===2?1:2,a=NO):e===C9?(s=!0,r=sg({scoreString:r,lowSide:t,outcome:"DEF"}),n=t===2?1:2,a=NO):e===M9?(s=!0,i=[],r="WO",n=t===2?1:2,a=w9):e===E9&&r?(s=!0,r=sg({scoreString:r,lowSide:t,outcome:"SUS"}),a=U9,n=void 0):e===R9?(s=!0,r=sg({scoreString:r,lowSide:t,outcome:"ABN"}),a=S9,n=void 0):e===N9&&r&&(s=!0,r=sg({scoreString:r,lowSide:t,outcome:"INT"}),a=D9,n=void 0),{updated:s,sets:i,scoreString:r,matchUpStatus:a,winningSide:n}}function GDe(t){let{sets:e,info:i,scoreString:r,winningSide:n,matchUpStatus:a}=t,{analysis:s,lowSide:o,value:l}=t,u,c;!e?.length&&l!==cP&&(e=[{setNumber:1}]);let d=e.length-1;if(sC.includes(l)){let p=e[e.length-1]||{},{side1Score:f,side2Score:m}=p;f&&!m?i="missing side2Score":s.finalSetIsComplete||n?i="final set is already complete":s.isIncompleteSetScore?i="incomplete set scoreString":s.isIncompleteSetScore||({sets:e,scoreString:r,winningSide:n,matchUpStatus:a,updated:u}=$9({lowSide:o,value:l,sets:e,scoreString:r,matchUpStatus:a,winningSide:n}))}else if(l===cP){if({scoreString:r,sets:e,outcomeRemoved:c}=AO({analysis:s,scoreString:r,sets:e}),r?.trim()===""&&(r=r.trim()),r||(e=[]),c){let p=e[e.length-1]||{},{side1Score:f,side2Score:m}=p;if(f&&m){let h=f>m&&1||m>f&&2||void 0;h&&(p.winningSide=h,e.push({setNumber:e.length+1}))}}a=void 0,n=void 0,u=!0}else if(s.hasOutcome)i="has outcome";else{if(n)return{sets:e,scoreString:r,winningSide:n,matchUpStatus:a,updated:!1,info:"matchUp is complete"};if(l===oC){let p=e[e.length-1]||{},{side1Score:f,side2Score:m}=p,h=f>m&&1||m>f&&2||void 0;h&&!n&&!s.isIncompleteSetScore&&(e[e.length-1].winningSide=h,e.push({setNumber:e.length+1}),r+=" ",u=!0)}else if(l===sm&&e[d].side1Score!==void 0&&e[d].side2Score===void 0&&r&&s.isNumericEnding)r+="-",e[d].side2Score=0,a=void 0,n=void 0,u=!0;else if(!isNaN(l)){let p;if(e[d].side2Score===void 0){let f=Ye((e[d].side1Score||0).toString()+l).toString().slice(0,2);e[d].side1Score=Ye(f),p=e[d].side1Score.toString(),u=!0}else{let f=Ye((e[d].side2Score||0).toString()+l).toString().slice(0,2);e[d].side2Score=Ye(f),p=[e[d].side1Score,e[d].side2Score].join("-"),u=!0}if(u){let f=(e.slice(0,d)||[]).filter(m=>m).map(m=>{let{side1Score:h,side2Score:g}=m;return[h,g].join("-")}).join(" ");f?r=f+" "+p:r=p}}}return{sets:e,scoreString:r,winningSide:n,matchUpStatus:a,info:i,updated:u}}function HDe({analysis:t,auto:e,lowSide:i,scoreString:r="",sets:n,value:a}){let s,o,{tiebreakSet:{tiebreakTo:l,NoAD:u}}=t.setFormat,[c]=xp.split("");if(t.isMatchTiebreakEntry||(r+=c),n[t.setNumber-1]){let{lastOpenBracketIndex:d}=jg({brackets:xp,scoreString:r}),p=(r.slice((d??0)+1)+(e?"":a)).split(zl);if((p[i-1]?.length||0)>=2)o="tiebreak digit limit";else if(e){i===1&&(p[0]=(p[0]||"")+a),i===2&&(p[1]=(p[1]||"")+a);let f=[p[0]||0,p[1]||0].map(g=>Ye(g)),m=i===1?1:0;f[m]=f[1-m]+(u?1:2),f[m]<l&&(f[m]=l);let h=n[n.length-1];h.side1TiebreakScore=f[0],h.side2TiebreakScore=f[1],r=r.slice(0,(d??0)+1),r+=f.join(zl),s=!0}else{let f=[p[0]||0,p[1]||0].map(h=>Ye(h)),m=n[n.length-1];m.side1TiebreakScore=f[0],m.side2TiebreakScore=f[1],r+=a,s=!0}}else{let d=_9({lowValue:Ye(a||0),tiebreakTo:l,NoAD:u}),p=[Ye(a),d];i===2&&p.reverse();let f={side1TiebreakScore:p[0],side2TiebreakScore:p[1],setNumber:n?.length+1||1};n.push(f),r+=p.join(zl),s=!0}return{info:o,scoreString:r,sets:n,updated:s}}function WDe({analysis:t,lowSide:e,scoreString:i,value:r}){let{setTo:n,tiebreakAt:a,NoAD:s}=t?.setFormat||{},o=r===parseInt(a||n);if(a&&a<n&&r>a)return{scoreString:i};if(s&&r===n||r>n)return{scoreString:i};let l=m(),u=[r,l];e===2&&u.reverse();let c=xm.split("")[0],d=u.join(sm)+(o?c:" ");i=(i||"")+d;let p={side1Score:u[0],side2Score:u[1]},f=M0({analysis:t,set:p});return p.winningSide=f||void 0,{scoreString:i,set:p};function m(){return o?r+1:r+1===n?r+(s?1:2):n}}function zDe({matchUpFormat:t,scoreString:e,winningSide:i,value:r,sets:n}){let a=(n?.filter(F=>F?.winningSide)?.length||0)+(i?0:1),s=zi(t),o=a===s?.bestOf,l=o&&s?.finalSetFormat||s?.setFormat||{},u=l?.timed,c=o&&n[s?.bestOf-1],d=c?.winningSide,{isTiebreakEntry:p}=jg({brackets:xm,scoreString:e}),{isTiebreakEntry:f}=jg({brackets:xp,scoreString:e}),m=p||f,h=!!l.tiebreakSet,g=e?.[e.length-1]?.trim(),I=e&&!isNaN(g),v=!m&&g===sm,w=p&&xA.includes(g),y=f&&xA.includes(g),b=f&&g===zl,S=e?.split(""),[U]=xp.split(""),T=S&&Math.max(...qo(U,S)),P=S&&Math.max(...qo(zl,S)),D=S&&P>T,E=n[n.length-1]?.winningSide,R=n?.length&&!E,C=b9.find(F=>e?.indexOf(F)>=0),M=!isNaN(r),N=r===oC,A=dP.includes(r),O=e?.split("").find(F=>xA.includes(F)),k=A&&f&&!y&&(b||!$De({scoreString:e}));return{isTiebreakSetValue:h&&M,matchUpScoringFormat:s,setNumber:a,setFormat:l,matchTiebreakHasJoiner:D,isGameScoreEntry:R,isSpace:N,isCloser:A,isTiebreakCloser:A&&O&&m&&I,isDecidingSet:o,isTiebreakSet:h,isTimedSet:u,isNumericEnding:I,isNumericValue:M,hasOpener:O,hasOutcome:C,finalSet:c,finalSetIsComplete:d,lastSetIsComplete:E,isInvalidSetTiebreakValue:N&&m&&w,isInvalidMatchTiebreakValue:k,isTiebreakEntry:m,isSetTiebreakEntry:p,isMatchTiebreakEntry:f,isIncompleteSetScore:v,isIncompleteSetTiebreak:w,isIncompleteMatchTiebreak:y,isPartialMatchTiebreakValue:b}}function B9(t){let{lowSide:e=1,value:i}=t,{scoreString:r,sets:n,winningSide:a,matchUpStatus:s}=t,{matchUpFormat:o,shiftFirst:l,auto:u=!0}=t,c,d,p=l&&e===2||!l&&e===1;if(!F9.includes(i))return{updated:!1,info:"invalid key"};l&&(e=3-e);let{matchUpWinningSide:f}=dW({sets:n,winningSide:a,matchUpStatus:s,matchUpFormat:o});a=f;let m=zDe({value:i,winningSide:a,scoreString:r,sets:n,matchUpFormat:o});if(k9.includes(i)&&(i=sm),m.hasOpener&&m.isTiebreakEntry&&!m.isTiebreakSet&&p&&Ye(i)===0&&(m.isTiebreakCloser=!0),dP.includes(i)&&m.hasOpener&&(i=""),dP.includes(i)&&(i=oC),m.lastSetIsComplete){let h=r?.length&&r[r.length-1];r&&h!==" "&&(r+=" ")}if(m.isTimedSet)({info:d,sets:n,scoreString:r,updated:c,matchUpStatus:s,winningSide:a}=GDe({analysis:m,lowSide:e,scoreString:r,sets:n,matchUpStatus:s,winningSide:a,value:i}));else if(sC.includes(i))m.finalSetIsComplete||a?d="final set is already complete":!m.isTiebreakEntry&&!m.isIncompleteSetScore?{sets:n,scoreString:r,matchUpStatus:s,winningSide:a,updated:c}=$9({lowSide:e,sets:n,scoreString:r,matchUpStatus:s,winningSide:a,value:i}):m.isTiebreakEntry||m.isIncompleteSetScore?d="incomplete set scoreString or tiebreak entry":console.log("handle case",{value:i});else if(i===cP)c=!0,{scoreString:r,sets:n}=AO({analysis:m,scoreString:r,sets:n,lowSide:e}),r||(n=[]),s=void 0,a=void 0;else if(m.hasOutcome)d="has outcome";else if(i===sm&&!m.isMatchTiebreakEntry)(!m.isSetTiebreakEntry||m.isSetTiebreakEntry&&!m.isNumericEnding)&&(c=!0,{scoreString:r,sets:n}=AO({analysis:m,scoreString:r,sets:n,lowSide:e}),s=void 0);else if(i===zl&&m.isMatchTiebreakEntry&&!m.isSetTiebreakEntry)m.matchTiebreakHasJoiner?d="existing joiner":m.isNumericEnding&&(c=!0,r+=zl);else if([sm,zl].includes(i))d="invalid location for joiner";else{if(a)return{updated:!1,info:"matchUp is complete"};if(m.isIncompleteSetScore)m.isNumericValue&&({sets:n,scoreString:r,updated:c}=VDe({analysis:m,scoreString:r,sets:n,value:i}));else if(m.isInvalidMatchTiebreakValue)d="invalid matchUp tiebreak character";else if(m.isInvalidSetTiebreakValue)d="invalid set tiebreak character";else if(m.isTiebreakCloser){let h=m.isSetTiebreakEntry?xm:xp,g=h.split("").reverse()[0],I=h.split("")[0],v=n[n.length-1],{tiebreakFormat:w}=m.setFormat,{tiebreakTo:y,NoAD:b}=w||{},S=uC({set:v});if(!m.isTiebreakSet){let T=Number.parseInt(r.split(I).reverse()[0]),P=_9({lowValue:T,tiebreakTo:y,NoAD:b});S===1?(v.side1TiebreakScore=P,v.side2TiebreakScore=T):(v.side1TiebreakScore=T,v.side2TiebreakScore=P)}r=(r||"")+g,m.isDecidingSet||(r+=" ");let U=M0({analysis:m,set:v});v.winningSide=U||void 0,c=!0}else if(m.isTiebreakSetValue)({info:d,scoreString:r,sets:n,updated:c}=HDe({analysis:m,auto:u,lowSide:e,scoreString:r,sets:n,value:i}));else if(m.isSetTiebreakEntry){let[h]=xm.split(""),g=Math.max(...qo(h,r.split(""))),I=r.slice(g+1),v=I&&Ye(I)===xDe,w=Ye(I?I+i:i),{tiebreakFormat:y}=m.setFormat,{tiebreakTo:b,NoAD:S}=y||{};!v&&I.length<2?S&&w>b-1?d="invalid low value for NoAD tiebreak":(c=!0,r=(r||"")+i):d=v?"tiebreak begins with zero":"tiebreak digit limit"}else if(m.isCloser)d=`invalid key: ${i}`;else if(m.isGameScoreEntry)d="game scoreString entry";else if(m.lastSetIsComplete||!n.length){c=!0;let{scoreString:h,set:g}=WDe({analysis:m,lowSide:e,scoreString:r,value:Ye(i)});g&&(g.setNumber=n?.length+1||1),n=n?.concat(g).filter(Boolean)||[g],r=h||void 0}else console.log("error: unknown outcome")}if(c){n=n?.filter(Boolean);let{matchUpWinningSide:h}=dW({sets:n,winningSide:a,matchUpStatus:s,matchUpFormat:o});return a=h,h&&(!s||[Fi,cs].includes(s))?(s=MDe,n=n.filter(g=>{let{side1Score:I,side2Score:v,side1TiebreakScore:w,side2TiebreakScore:y}=g;return I||v||w||y})):r&&!a&&![U9,S9,D9].includes(s)&&(s=void 0),{updated:c,scoreString:r,sets:n,winningSide:a,matchUpStatus:s,info:d}}return{updated:c,scoreString:r,sets:n,winningSide:a,matchUpStatus:s,info:d}}var cC="\\d+-\\d+",Rb="\\d+-\\d+\\(\\d+\\)",N0="\\[\\d+-\\d+\\]",qDe="\\d+-\\d+\\(\\d+-\\d+\\)",YDe=new RegExp(`(${cC}),`,"g"),KDe=new RegExp(`(${Rb}),`,"g"),XDe=[cC,Rb,N0,qDe],JDe=["0","1","2","00","01","10","11","002","012","102","112","000","001","010","100","011","101","110","111","002","012","102","112","0002","0012","0102","1002","0112","1012","1102","1112","3","03","13","013","103"],QDe=JDe.map(t=>{let e=t.split("").map(i=>XDe[i]).join(" ");return new RegExp(`^${e}$`)});function pW(t){return!t||QDe.some(e=>e.test(t))}function ZDe(t){let e="[];()",i=["[","("],r=Object.assign({},...e.split("").map(s=>({[s]:0}))),n="",a=t.split("").map(s=>{let o=e.includes(s)&&s,l=i.includes(o);if(l&&o)return r[o]+=1,n=o,s;if(!l&&o&&n&&o!==n){r[n]-=1;let u="[];".includes(n)&&"[];"||"()".includes(n)&&"()"||"",c=u.split("").find(d=>d!==n);if(u.includes(o))r[n]||(n="");else return r[o]||(n=""),c}return s}).join("");return t!==a?a:t}function rD(t){return/^\(\d+\)$/.test(t)||/^\(\d+$/.test(t)}function ePe(t){return/^\(\d+-\d+\)$/.test(t)||/^\[\d+-\d+\]$/.test(t)}function dI(t){let e=(i=>i?.split("-").join("").split("/").join(""))(t);if(/^\d+$/.test(e)&&e.length===2){let i=e.split("");return Math.abs(i.reduce((r,n)=>+r-+n))===1}return!1}function pP(t,e){let i=[t.slice(e,e+2),e?t.slice(0,1):t.slice(2)].map(n=>parseInt(n.join("")));e&&i.reverse();let r=i;if(Math.abs(r.reduce((n,a)=>+n-+a))>=2)return r.join("-")}function fW(t){return t.length===2?t.split("").join("-"):([", ",",","/"," "].forEach(e=>t=t.split(e).join("-")),t=t.replace(/-{2,}/,"-"),t)}function tPe(t){return t.startsWith("(")&&t.endsWith(")")}function iPe({score:t,applied:e}){t=ZDe(t);let i=/\)(\d+)/g;if(i.test(t))for(let S of t.match(i)){let U=S.replace(")",") ");t=t.replace(S,U)}t=t.replace(/\)\//g,") / "),t=t.replace(/\/\)/g,")");let r=/\(([\d- ]+)\)/g,n=/\(([\d- ]+)\)/,a=t.match(r);for(let S of a||[]){let[U]=S.match(n).slice(1),T=U.replace(/ /g,"");t=t.replace(S,`(${T})`)}let s=/\(\(\d-\d\)\)/g;if(s.test(t)){let S=t.match(s);S.length&&S.forEach(U=>{let T=U.match(/\((\(\d-\d\))\)/).slice(1)[0];t=t.replace(U,T)})}if(s=/\(\((\d)\)\)/g,s.test(t)){let S=t.match(s);S.length&&S.forEach(U=>{let T=U.match(/\((\(\d\))\)/).slice(1)[0];t=t.replace(U,T)})}/(^|\s)6-,/.test(t)&&(t=t.replace(/(^|\s)6-,/g,"6-0,"));let o=new RegExp(/[-,]{2,}/g);t=t.replace(o,"-"),["- "," -"].forEach(S=>{let U=new RegExp(`(\\d+)${S}(\\d+)`,"g"),T=t.match(U);T&&T.forEach(P=>t=t.replace(P,P.split(S).join("-")))}),/^[(-/,]+$/.test(t)&&(t=""),/\)[-/,]+$/.test(t)&&(t=t.slice(0,t.length-1)),/\d \/\d/.test(t)&&(t=t.replace(/ \//g,"/")),t.includes(" /")&&(t=t.replace(/ \//g," "));let l=/\(\d+, \)/g;l.test(t)&&t.match(l).forEach(S=>{let[U]=S.match(/\((\d+), \)/).slice(1);U.length===2?t=t.replace(S,`(${U})`):U.length===1&&U==="6"&&(t=t.replace(S,"(6-0)"))});let u=/\((\d+)\/\)/g;u.test(t)&&t.match(u).forEach(S=>{let[U]=S.match(/\((\d+)\/\)/).slice(1);U.length===2?t=t.replace(S,`(${U})`):U.length===1&&U==="6"?t=t.replace(S,"(6-0)"):t=t.replace(S,`(${U})`)});let c=/\d\/\d\/,/g;c.test(t)&&t.match(c).forEach(S=>{let[U]=S.match(/(\d\/\d)\/,/).slice(1);t=t.replace(S,`${U},`),e.push("slashComma")});let d=/\(\/(\d+)\)/g;d.test(t)&&t.match(d).forEach(S=>{let[U]=S.match(/\(\/(\d+)\)/).slice(1);U.length===2?t=t.replace(S,`(${U})`):U.length===1&&parseInt(U)<6?t=t.replace(S,`(6-${U})`):t=t.replace(S,`(${U})`)});let p,f,m,h,g,I=()=>{g=va(t.split("")),f=g["("]===(g[")"]||0)+1,p=(g["("]||0)+1===g[")"],m=g["["]===g["]"]+1,h=f&&!m};I();let v=/(\d+-\d+\(\d+)0,/;if(v.test(t)){let[S]=t.match(v).slice(1);t=t.replace(v,S+")")}if(g["("]===g[")"]&&g["("]>1){let S=t.split(")(").join(") (").split(" ");S.every(tPe)?t=S.map(U=>{let T=U.slice(1,U.length-1);return T.length>2?T:U}).join(" "):t=S.join(" ")}I();let w=/[A-Za-z]+/.test(t),y=/\d+/.test(t);if(!w&&!y)return{score:""};if(/^\[.+\]$/.test(t)&&"()/,- ".split("").some(S=>g[S])&&(t=t.slice(1,t.length-1)),/^\(.+\)$/.test(t)&&g["("]===1&&g[")"]===1&&"[]/,".split("").some(S=>g[S]>1)&&(t=t.slice(1,t.length-1)),t.startsWith("(")&&t.endsWith("))")&&(t=t.slice(1,t.length-1)),g["("]>(g[")"]||0)&&t[t.length-1]==="("&&(t=t.slice(0,t.length-1)+")",I()),g["("]===1&&!g[")"]&&t[0]==="("&&(t=t+")",I()),g["("]>(g[")"]||0)&&t.slice(0,2)==="(("&&(t=t.slice(1)),p){if(/^9\d/.test(t))t="("+t.slice(1);else if(t[0]!=="(")t="("+t;else{let S=[],U=0;for(let T of t.split("").reverse())T===")"&&(U?S.push("("):U+=1),T==="("&&(U-=1),S.push(T);S.reverse(),t=S.join("")}I()}if(g[")"]>(g["("]||0)&&t[0]===")"&&(t="("+t.slice(1),I()),h&&(t.endsWith(9)||/\d+0$/.test(t))&&(t=t.slice(0,t.length-1)+")",I()),h&&(!t.endsWith(")")||t.startsWith("(("))&&(t=t+")",I()),h){let S="",U=0;for(let T of t.split(""))T==="("&&(U?S+=")":U+=1),T===")"&&(U-=1),S+=T;t=S}I(),m&&!f&&(t=t+"]"),t.includes("([")&&t.includes("])")&&(t=t.split("([").join("[").split("])").join("]"),I()),/\(\d+0$/.test(t)&&(t=t.slice(0,t.length-1)+")"),I(),g[")"]===1&&!g["("]&&t.endsWith(")")&&(t=t.slice(0,t.length-1)),t.startsWith("(")&&t.endsWith(")")&&g["("]===1&&g[")"]===1&&(t=t.slice(1,t.length-1),I());let b=S=>{let U=S.indexOf("("),T=S.indexOf(")");return U>=0&&T>=0&&U<T};if(/^\([\d ]+.*[\d ]+\)$/.test(t)&&g["("]===g[")"]){let S=t.slice(1,t.length-1);b(S)&&(t=S,I())}return{score:t,applied:e}}function dC(t){if(!/^[\d-]+(\(\d\))*$/.test(t))return t;let e=qo("-",t.split(""));if(!e.length)return t;let i=t.split("-"),r=!(i.length%2),n=!!(e.length%2);return r&&n&&e.length>i.length/2&&e.filter((a,s)=>s%2).forEach(a=>{t=t.substring(0,a)+" "+t.substring(a+1)}),t}function rPe({score:t,applied:e}){return t.includes("( ")&&(e.push("removeParenSpacingAfterOpen"),t=t.split("( ").map(i=>i.trim()).join("(")),t.includes(" )")&&(e.push("removeParenSpacingBeforeClose"),t=t.split(" )").map(i=>i.trim()).join(")")),[YDe,KDe].forEach(i=>{let r=t.match(i);r?.length&&(r.forEach(n=>{t=t.replace(n,n.slice(0,n.length-1)+" ")}),e.push("setsEndComma"))}),t=t.split(" ").filter(Boolean).map(dC).join(" "),{score:t,applied:e}}function nPe({score:t}){if(typeof t!="string")return{score:t};let e=p=>p?.split("-").join("").split("/").join(""),i=p=>p.split("[").join("(").split("]").join(")");t=t.split(", ").join(" ");let r=t.split(" ");t=r.map(p=>{let f=/^-(\d+)$/;if(f.test(p)){let[m]=p.match(f).slice(1);if(m.length===2)return m.split("").join("-")}return p}).join(" "),r=t.split(" ");let n=r.filter(rD),a=0,s="";for(let p of n){let f=qo(p,r).find(I=>!a||I>a),m=r.slice(a,f-1),h=r[f-1],g=e(h);if(/^\d+$/.test(g)&&g.length===2){let I=g.split(""),v=Math.abs(I.reduce((w,y)=>+w-+y));if(v===1){let w=[m.join(" "),[h,p].join("")].join(" ");s+=w,a=f+1}else if(v===0){let w=Math.max(...I);if([4,5,6,7,8,9].includes(w)){let y=[6,4].includes(w)?w+1:w-1,b=[w,y].sort().reverse().join("-"),S=[m.join(" "),[b,p].join("")].join(" ");s+=S,a=f+1}}}}if(n.length&&s.length){let p=r.slice(a).join(" ");return s=[s,p].join(" "),{score:s.trim()}}if(r.length===2&&["(","["].some(p=>r[1].includes(p))){let p=e(r[0]).split("");if(Math.abs(p.reduce((f,m)=>+f-+m,0))===1)return r[1]=i(r[1]),{score:r.join("")}}let o=r.map(p=>ePe(p)&&"bracket"||dI(p)&&"set");if(o.includes("set")&&o.includes("bracket")){let p,f="";return r.forEach((m,h)=>{o[h]==="bracket"&&p==="set"?(m=i(m),f+=m):f+=` ${m}`,p=o[h]}),{score:f.trim()}}r=t.split(" ");let l,u=r.map(p=>{let f=new RegExp(/^(\d+)-(\d+)$/);if(f.test(p)){let[m,h]=p.match(f).slice(1),g=Math.abs([m,h].reduce((v,w)=>+v-+w,0)),I=Math.max(m,h);if(g===1)return l="tiebreakSet",l;if(g>=2&&I>=7&&l==="tiebreakSet")return l="tiebreak",l}}),c=qo("tiebreak",u);if(c.length){let p="";r.forEach((f,m)=>{c.includes(m)?p+=`(${f}) `:c.includes(m+1)?p+=`${f}`:p+=`${f} `}),t=p.trim()}let d=/(\d+-\d+)\((\d+)-(\d+)\)$/;if(d.test(t)){let[p,f,m]=t.match(d).slice(1),h=Math.max(f,m)>=10;!dI(p)&&h&&(t=t.replace(d,`${p} [${f}-${m}]`))}return u=[],t=t.split(" ").map(p=>{let f=/^\((.*)\)$/,m=f.test(p),h=new RegExp(N0).test(p)&&"super"||new RegExp(Rb).test(p)&&"tiebreak"||new RegExp(cC).test(p)&&"standard"||"unknown";return u.push(h),h==="standard"&&m?p.match(f)[1]:p}).join(" "),{score:t}}function aPe({score:t,applied:e}){for(let T of[".",","," ","/"]){let P=new RegExp(`^(\\d+)\\${T}(\\d+)$`);if(P.test(t)){let D=t.match(P).slice(1).map(R=>parseInt(R)),E=Math.abs(D[0]-D[1]);E<=10&&E>=2&&(t=t.split(T).join("-"),e.push("variedJoinerPattern"))}}t.includes(";")&&(t=t.split(";").join(" "),e.push("semicolon set separation"));let i=/(^|\s)(\d)\/(\d)(\d)\/(\d)(\(|$)/;if(i.test(t)){let[T,P,D,E,R,C]=t.match(i).slice(1);t=t.replace(i,`${T}${P}-${D} ${E}-${R}${C}`),e.push("smashSlashPattern")}/.*\s6[/-]+$/.test(t)&&(t+="0",e.push("incompleteFinalSetPattern"));let r=/\(6,\)/g;r.test(t)&&(t=t.replace(r,"(6, 0)"),e.push("missingZeroPattern1"));let n=/^\d{3,}\(/,a=/\(\d+\)\d+/;[n,a].forEach(()=>{t=t.split(" ").map(T=>(n.test(T)&&(T=T.replace("("," (")),a.test(T)&&(T=T.replace(")",") ")),T)).join(" "),e.push("spaceConsiderationPatterns")});let s=dC(t);s!==t&&(t=s,e.push("deDashMash"));let o=/^(\d)[-/,]+(\d{2})[-/,]+(\d)$/;if(o.test(t)){let[T,P,D]=t.match(o).slice(1),[E,R]=P.split("");t=`${T}-${E} ${R}-${D}`,e.push("smashSetPattern")}let l=/^(\d+)[ -](\d+)$/,u=/^([\d -]+)\/([\d -]+)$/;if(u.test(t)){let[T,P]=t.match(u).slice(1),D=T.trim(),E=P.trim();if(l.test(D)&&l.test(E)){let R=D.match(l).slice(1,3).join("-"),C=E.match(l).slice(1,3).join("-");t=`${R} ${C}`,e.push("slashSeparationPattern")}}let c=/^([\d -]+),([\d -]+)$/;if(c.test(t)){let[T,P]=t.match(c).slice(1),D=T.trim(),E=P.trim();if(l.test(D)&&l.test(E)){let R=D.match(l).slice(1,3).join("-"),C=E.match(l).slice(1,3).join("-");t=`${R} ${C}`,e.push("commaSeparationPattern")}}let d=/^\d \d,/;if(d.test(t)){let T=t.match(d)[0],P=T.slice(0,T.length-1).split(" ").join("-");t=t.replace(T,P),e.push("singleSetCommaSeparationPattern")}let p=0,f=/(\d+)-(\d{2})-(\d+)/;for(;f.test(t)&&p<3;){let[T,P,D]=t.match(f).slice(1),E=P.split(""),R=`${T}-${E[0]} ${E[1]}-${D}`;t=t.replace(f,R),e.push("noSetSeparationPattern"),p+=1}let m=/(^|\s)7-6\s(\d+)\s/g,h=t.match(m);if(h?.length){let T=/(^|\s)7-6\s(\d+)\s/;h.forEach(P=>{let D=P.match(T).slice(2)[0];t=t.replace(P,`7-6(${D}) `),e.push("floatingTiebreakPattern1")})}let g=t.match(/\d \d /);g?.forEach(T=>{let P=T.slice(0,T.length-1).split(" ").join("-");t=t.replace(T,P),e.push("spaceSeparatedSetPattern1")}),g=t.match(/ \d \d$/),g?.forEach(T=>{let P=" "+T.slice(1).split(" ").join("-");t=t.replace(T,P),e.push("spaceSeparatedSetPattern2")});let I=/^\d, *\d\/\d, *\d/;if(I.test(t)){let T=t.match(I)[0],P=T.split("/").map(D=>`(${D})`).join(" ")+" ";t=t.replace(T,P),e.push("slashCommaSetPattern")}let v=/\(6-\)/g;v.test(t)&&(t=t.replace(v,"(6-0)"),e.push("missingZeroPattern2"));let w=new RegExp("(?<!-)(\\d+)\\/(\\d+)(?!-)","g");if(w.test(t)){let T=t.match(w),P=new RegExp("(?<!-)(\\d+)\\/(\\d+)(?!-)"),D=t;T.forEach(E=>{let[R,C]=E.match(P).slice(1),M=`${R}-${C}`;D=D.replace(E,M)}),t=D,e.push("slashSetPattern")}let y=/(.*)\s(1\d)\s(\d+)$/;if(y.test(t)){let[T,P,D]=t.match(y).slice(1);T.replace(/\D/g,"").length>=4&&(t=T+` ${P}${D}`,e.push("spaceSeparatedSuperPattern"))}let b=/(^|\s)(\d+-\d+)\s(\d+)(\s|$)/g;for(let T of t.match(b)||[]){let[P,D,E,R]=T.match(/(^|\s)(\d+-\d+)\s(\d+)(\s|$)/).slice(1),[C,M]=D.split("-").map(N=>parseInt(N));Math.abs(C-M)===1&&(t=t.replace(T,`${P}${D}(${E})${R}`),e.push("spaceSeparatedSetPattern"))}let S=/\d-\d \(\d{1,2}\)(\s|$|,)/g;for(let T of t.match(S)||[]){let P=/(\d-\d) \((\d{1,2})\)(\s|$|,)/,[D,E,R]=T.match(P).slice(1),[C,M]=D.split("-").map(N=>parseInt(N));Math.abs(C-M)===1&&(t=t.replace(T,`${D}(${E})${R}`),e.push("floatingTiebreakPattern2"))}let U=/(^|\s)(\d \d)\(/g;for(let T of t.match(U)||[]){let P=/(^|\s)(\d \d)\(/,[D,E]=T.match(P).slice(1);t=t.replace(T,`${D}${E.split(" ").join("-")}(`),e.push("spacedTiebreakPattern")}return{score:t,applied:e}}function sPe({score:t,matchUpStatus:e}){let i=t?.split(" ");t=i.map(o=>{if(o.endsWith("]")){let l=o.split("[");if(dI(l[0]))return l[0]+`(${l[1].slice(0,-1)})`}return o}).join(" ");let r=new RegExp(/(\([\d ]+\))/g);if(r.test(t))for(let o of t.match(r)){let l=o.replace(" ","-").match(/\((.*)\)/)?.[1];if(Ni(l)&&l?.[0]>2){if([2,4].includes(l.length))l=l.split("").join("-");else if(l.length===3){let u=l.indexOf("1");l=pP(l.split(""),u)}}t=t.replace(o,`(${l})`)}i=t?.split(" ");let n=new RegExp(/^(\d[-/]+\d)\((\d+)[-/]+(\d+)\)$/),a=i.length-1;t=i.map((o,l)=>{let u=[void 0,"","COMPLETED"].includes(e)||l!==a;if(n.test(o)&&u){let[c,d,p]=Array.from(o.match(n)).slice(1),f=Math.min(d,p);return`${c}(${f})`}return o}).join(" "),i=t?.split(" "),n=new RegExp(/^(\d{2})\((\d+)\)$/),t=i.map(o=>{if(n.test(o)){let[l,u]=Array.from(o.match(n)).slice(1),c=l.split("");return`${c[0]}-${c[1]}(${u})`}return o}).join(" "),i=t?.split(" "),n=new RegExp(/^\((\d[-/]+\d)\)(\d+)$/),t=i.map(o=>{if(n.test(o)){let[l,u]=Array.from(o.match(n)).slice(1);return dI(l)?`${l}(${u})`:l}return o}).join(" "),i=t?.split(" "),n=new RegExp(/^1-0\((\d+)\)$/),t=i.map(o=>{if(n.test(o)){let[l]=o.match(n).slice(1);return`[${l<9?10:Number.parseInt(l)+2}-${l}]`}return o}).join(" ");let s=/\((\d)+0 /;if(s.test(t)){let o=t.match(s)[1];t=t.replace(s,`(${o}) `)}return{score:t}}function oPe({score:t,attributes:e,identifier:i}){if(typeof t!="string")return{score:t,identifier:i};let r=new RegExp(/\([\d,/ ]+\)/g),n=t.match(r);for(let c of n||[]){let d=c.match(/^\((.*)\)$/)?.slice(1)?.[0],p=t.split(c)[0].split(")").reverse()[0].replace(/\D/g,"");if(d?.length===2&&p?.length>=2){let h=p.slice(p.length-2).split("").map(g=>parseInt(g));if(Math.abs(h[0]-h[1])===1)continue}let f=fW(d),m=dC(f);t=t.replace(c,`(${m})`).trim()}let a=new RegExp(/\[[\d,/ ]+\]/g);t.match(a)?.forEach(c=>{let d=fW(c.match(/^\[(.*)\]$/)[1]);t=t.replace(c,`(${d}) `).trim()});let s=[")","]"],o=[")(","), (",") (",")[",") [","](","] ("];if(t.startsWith("(")&&s.some(c=>t.endsWith(c))&&o.some(c=>t.includes(c))){let c="",d=t.split(/[)\]]/).filter(Boolean).map(g=>(g.startsWith(",")&&(g=g.slice(1)),g.trim())),p=d.every(g=>g.includes(",")||rD(g)),f=d.every(g=>g.includes("/")||rD(g)),m=d.every(g=>g.includes("-")||rD(g)),h=p&&","||m&&"-"||f&&"/";if(h){let g;d.forEach(I=>{if(I.startsWith("("))if(g==="set"&&(c+=" "),I.includes(h))c+=I.slice(1).split(h).map(v=>v.trim()).join("-"),g="set";else{let v=I.slice(1);c+=`(${v}) `,g="tiebreak"}else if(I.startsWith("[")){let v=I.slice(1).split(h).map(y=>parseInt(y.trim())),w=Math.min(...v);g==="set"?c+=`(${w}) `:c+=`[${v.join("-")}] `,g="tiebreak"}}),t=c.trim()}}let l=va(t.split(""));l["("]===1&&l[")"]===1&&t.startsWith("(")&&t.endsWith(")")&&(t=t.slice(1,t.length-1),l["-"]===1&&dI(t)&&Ni(e?.removed)&&(t=t+`(${e.removed})`,e.removed=void 0));let u=/\(\)/g;return u.test(t)&&(t=t.replace(u,"").trim()),{score:t}}function V9({score:t}){let e=t.split(""),i=[],r,n=()=>r=[void 0,void 0,void 0],a=()=>{let o=`${r[0]}-${r[1]}`;return r[2]&&(o+=` (${r[2]})`),n(),r.push(r),o};n();let s=()=>r[0]!==void 0&&r[1]!==void 0&&Math.abs(parseInt(r[0])-parseInt(r[1]));for(;e.length;){let o=e.shift(),l=Ni(o)&&parseInt(o),u=r[0]!==void 0&&r[1]!==void 0;if(Ni(l)){if(r[0]===void 0){r[0]=l;continue}if(r[1]===void 0&&(r[1]=l,s())){i.push(a()),r=[void 0,void 0];continue}if(u&&e.length===1&&Ni(e[0])){let c=e.pop();r[0]=r[0].toString()+r[1].toString(),r[1]=c,i.push(a()),r=[void 0,void 0]}u&&s()}}return{sets:i}}function kO(t){let e=t.indexOf("1"),i=t.split(""),r=i.every(n=>!isNaN(n));if(r&&t.length===3&&e===0){let n=pP(i,e);if(n)return n}if(r&&t.length===7&&e>3){let n=i.slice(4),a=pP(n,e-4);if(a)return`${i[0]}-${i[1]} ${i[2]}-${i[3]} ${a}`}}function j9(t){let{score:e}=t,{applied:i,matchUpStatus:r}=t,n=e?.toString().split(""),a=n?.every(o=>Ni(o)),s=o=>Math.abs(o[0]-o[1]);if(typeof e=="number"||a){e=e.toString().toLowerCase(),a&&(e=n.join(""));let o=a?n.map(u=>parseInt(u)):e.split("").map(u=>parseInt(u)),{sets:l}=V9({score:e});if(o.length,e.length===3&&s(o.slice(0,2))===1){let[u,c,d]=o;e=`${u}-${c}(${d})`,i.push("numericTiebreakPattern1")}else if(e.length===3&&o[0]===1){let[u,c,d]=o;e=`[${u}${c}-${d}]`,i.push("numericTiebreakPattern2")}else if(e.length===4&&s(o.slice(0,2))===1&&"987654".split("").includes(o[0].toString())){let[u,c,d,p]=o,f=Math.min(d,p);e=`${u}-${c}(${f})`,i.push("numericTiebreakPattern3")}else if(e.length===4&&o[0]===1&&o[2]===1){let[u,c,d,p]=o;e=`[${u}${c}-${d}${p}]`,i.push("bigSuper")}else if(e.length===4){let[u,c,d,p]=o;e=`${u}${c} ${d}${p}`,i.push("split4")}else if(e.length===5&&s(o.slice(0,2))===1){let[u,c,d,p,f]=o;e=`${u}-${c}(${d}) ${p}-${f}`,i.push("numericTiebreakPattern4")}else if(e.length===5&&s(o.slice(3))===1){let[u,c,d,p,f]=o;e=`${u}-${c} ${d}-${p}(${f})`,i.push("numericTiebreakPattern5")}else if(o.length===7)if(s(o.slice(0,2))>1&&s(o.slice(2,4))>1&&o[4]===1){let[u,c,d,p,f,m,h]=o;e=`${u}-${c} ${d}-${p} [${f}${m}-${h}]`,i.push("numericTiebreakPattern6")}else if(s(o.slice(0,2))===1&&s(o.slice(3,5))>1&&s(o.slice(5,7))>1){let[u,c,d,p,f,m,h]=o;e=`${u}-${c}(${d}) ${p}-${f} ${m}-${h}`,i.push("numericTiebreakPattern7")}else if(s(o.slice(0,2))>1&&s(o.slice(2,4))===1&&s(o.slice(5,7))>1){let[u,c,d,p,f,m,h]=o;e=`${u}-${c} ${d}-${p}(${f}) ${m}-${h}`,i.push("numericTiebreakPattern8")}else if(s(o.slice(0,2))>1&&s(o.slice(2,4))>1&&s(o.slice(4,6))===1){let[u,c,d,p,f,m,h]=o;e=`${u}-${c} ${d}-${p} ${f}-${m}(${h})`,i.push("numericTiebreakPattern9")}else e=e.slice(0,2)+" "+e.slice(2,4)+" "+e.slice(4),i.push("numericMatchTiebreakPattern");else if(e.length%2){let u=kO(e);u&&e!==u&&i.push("parsedSuperPattern"),e=u??e}else{let u=yr(e.split(""),2).map(I=>I.join("")),c=u.map(I=>{let[v,w]=I.split("").map(S=>parseInt(S)),y=Math.abs(v-w),b=v>w?1:2;return y>1&&b||b*-1}),d=c.reduce((I,v)=>I>0&&v>0,1),p=va(c),f=c.map(I=>Math.abs(I)),m=va(f),h=c[0]<0,g=!h&&c[1]<0;if(c[0]>0&&c[1]>0&&c[0]!==c[1])e=[u.slice(0,2).join(" "),u.slice(2).join("-")].join(" "),i.push("numeric3rdSetTiebreakPattern");else if(d)e=u.join(" "),i.push("chunkSplit");else if(o.length===6){if(p[1]===2||p[2]===2)if(!Object.values(m).includes(3))e=u.join(" "),i.push("chunkSplit");else{let[I,v,w,y,b,S]=o,U=c.reduce((T,P,D)=>P<0?D:T,void 0);if(U===0){let T=Math.min(w,y);e=`${I}-${v}(${T}) ${b}-${S}`,i.push("chunkSplitTiebreak1")}else if(U===1){let T=Math.min(b,S);e=`${I}-${v} ${w}-${y}(${T})`,i.push("chunkSplitTiebreak2")}else e=`${I}-${v} ${w}-${y}`,i.push("chunkSplitTrimExtraneous")}}else if(o.length===8){let[I,v,w,y,b,S,U,T]=o;h||g?o[5]===1&&(h?e=`${I}-${v}(${w}) ${y}-${b} [${S}${U}-${T}]`:e=`${I}-${v} ${w}-${y}(${b}) [${S}${U}-${T}]`):(c[0],c[1])}}}return{score:e,applied:i,matchUpStatus:r}}function G9(t){let e=[0,0],i=[],r=t.split(" "),n=/(\d+)-(\d+)/;r.forEach(l=>{if(n.test(l)){let u=l.match(n).slice(1).map(d=>Number.parseInt(d)),c=u[0]>u[1]&&1||u[1]>u[0]&&2;c&&(e[c-1]+=1,i.push(c))}});let a=e[0]>e[1]&&1||e[1]>e[0]&&2,s=e[0]>0&&e[0]===e[1],o=e.reduce((l,u)=>l+u,0);return{setsWon:e,setsTied:s,setWinners:i,totalSets:o,winningSide:a}}function lPe({score:t,matchUpStatus:e,attributes:i}){let r=[],n,a=t.split(" "),s=a.length;t=a.map((c,d)=>{if(new RegExp(Rb).test(c)){let f=c.slice(3),m=c.slice(0,3),h=m.split("-");if(!dI(m)&&!e){let g=Math.max(...h),I=m.indexOf(g),v=[g,g-1];return I&&v.reverse(),v.join("-")+f}}else if(c.length===2&&Ni(c))return c.split("").join("-");c=dC(c);let p=new RegExp(`^${N0}$`).test(c)&&"super"||new RegExp(`^${Rb}$`).test(c)&&"tiebreak"||new RegExp(`^${cC}$`).test(c)&&"standard"||"unknown";if(r.push(p),s>1&&p==="standard"&&d<2){let[f,m]=c.split("-"),h=Math.abs(parseInt(f)-parseInt(m)),g=Math.max(f,m),I=Math.min(f,m),v=[parseInt(f),parseInt(m)].indexOf(I);if(g>9&&h>2){let w=g.toString().split(""),y=w.find(b=>parseInt(b)>I||d&&parseInt(b)<=n)??w[0];y&&(c=v?[y,I].join("-"):[I,y].join("-"))}g>(n||0)&&(n=g)}if(p==="standard"){let[f,m]=c.split("-");if(!Math.abs(parseInt(f)-parseInt(m))&&e!=="RETIRED")return""}return c}).filter(Boolean).join(" ");let{setsWon:o,setWinners:l,totalSets:u}=G9(t);if(u===1&&i?.removed==="6"&&(t+=" 6-0"),t.split(" ").length>2&&Math.max(...o)>=2&&l[0]===l[1]&&(t=t.split(" ").slice(0,2).join(" ")),Math.max(...o)>2){let c=[0,0];t=t.split(" ").map((d,p)=>(c[l[p]]+=1,Math.max(...c)>2?void 0:d)).filter(Boolean).join(" ")}return{score:t,profile:r}}function uPe({score:t}){let{setsTied:e,winningSide:i}=G9(t),r=/\s\((\d+)\)$/;if(!i&&e&&r.test(t)){let o=t.match(r).slice(1)[0],l=o<=8?10:o+2;t=t.replace(r,` [${l}-${o}]`)}let n=t.split(" "),a=n[n.length-1];if(!a.includes("-")||a.indexOf("(")>0)return{score:t};let s=a.split("(").join("").split(")").join("").split("-");if(!s.every(o=>Ni(o)))return{score:t};if(s[0]==="76"){let o=s[1].length===2?Math.min(...s[1].split("").map(l=>parseInt(l))):s[1];t=[...n.slice(0,n.length-1),`7-6(${o})`].join(" ")}else{s=s.map(u=>parseInt(u));let o=Math.max(...s),l=Math.abs(s[0]-s[1]);if(o>=10){if(l>2&&s.every(u=>+u>=10)){let u=s.map(c=>c===o?c-10:10).sort();l=Math.abs(u[0]-u[1]),l>2&&(s=u)}t=[...n.slice(0,n.length-1),`[${s.join("-")}]`].join(" ")}else n.length===3&&o>=7&&l>2&&(t=[...n.slice(0,n.length-1),`[${s.join("-")}]`].join(" "))}return{score:t}}function cPe({score:t}){return t=t?.toString().toLowerCase()||"",{score:t}}function dPe({score:t,applied:e}){return typeof t!="string"?{score:t}:(t.toLowerCase().includes("o")&&(t=t.toLowerCase().split(" ").map(i=>i.split("o").join("0")).join(" "),e.push("replaceOh")),{score:t,applied:e})}function pPe({score:t,applied:e}){return typeof t!="string"?{score:t}:(t=t.toLowerCase().split(" ").map(i=>{if(/^\d+$/.test(i)&&i.length>2){let r=i.indexOf("1");if(i.length%2){if(i.length===3&&r===0){let n=pP(i.split(""),r);return e.push("getSuper"),n}}else{let{score:n,applied:a}=j9({score:i,applied:[]});n!==i&&(i=n,e.push(...a))}}return i}).join(" "),{score:t,applied:e})}function fPe({score:t,applied:e}){return typeof t!="string"?{score:t}:[3,4].includes(t.length)&&kO(t)?{score:kO(t)}:(t=t.toLowerCase().split(" ").map(i=>{if(/^\d+$/.test(i)&&i.length===1){e.push("removeErroneous1");return}return i}).filter(Boolean).join(" "),{score:t,applied:e})}function mPe({score:t,applied:e}){return["walkover","wo","w/o","w-o"].includes(t?.toString().toLowerCase())?(e.push("handleWalkover"),{matchUpStatus:"walkover",score:"",applied:e}):{score:t}}function hPe({score:t,profile:e,applied:i}){t=t?.toString().toLowerCase();let r=/^(.*\d+.*)(ret|con)+[A-Za-z ]*$/;if(r.test(t)){let[s]=t.match(r).slice(1);return i.push("handleRetired"),{score:s.trim(),matchUpStatus:"retired",applied:i}}let n=e?.matchUpStatuses?.retired,a=["rtd",...Array.isArray(n)?n:[n].filter(Boolean)].find(s=>t?.endsWith(s));return a?(i.push("handleRetired"),{matchUpStatus:"retired",score:t?.replace(a,"").trim(),applied:i}):{score:t}}function gPe({score:t,profile:e,applied:i}){t=t?.toString().toLowerCase();let r=/^(.*\d+.*)(def|defaulted)+[A-Za-z ]*$/;if(r.test(t)){let[s]=t.match(r).slice(1);return i.push("handleDefaulted"),{score:s.trim(),matchUpStatus:"defaulted",applied:i}}let n=e?.matchUpStatuses?.defaulted,a=["dft",...Array.isArray(n)?n:[n].filter(Boolean)].find(s=>t?.endsWith(s));return a?(i.push("handleDefaulted"),{matchUpStatus:"defaulted",score:t?.replace(a,"").trim(),applied:i}):{score:t}}function IPe({score:t,attributes:e}){(t.endsWith(" am")||t.endsWith(" pm"))&&(t=""),t=t.replace(/[A-Za-z]+/g,"").trim(),[".",","].some(n=>t.endsWith(n))&&(t=t.slice(0,t.length-1));let i="()/-".split("").some(n=>t.includes(n));/ \d$/.test(t)&&i&&(e={removed:t.slice(t.length-2).trim()},t=t.slice(0,t.length-2));let r=/(.*)[A-Za-z]+$/;return r.test(t)&&(t=t.match(r).slice(1)[0].trim()),{score:t,attributes:e}}function vPe({score:t}){return new RegExp(/-\d+\/\d+-/).test(t)&&(t=t.split("/").join(" ")),{score:t}}function yPe({score:t}){let e=new RegExp(/^\d+\/\d+/),i=t.split(" ");i.some(n=>e.test(n))&&(t=i.map(n=>e.test(n)?n.replace("/","-"):n).join(" "));let r=/^(\d+), *(\d+)$/;if(r.test(t)){let[n,a]=t.match(r).slice(1);t=[n,a].join("-")}return{score:t}}function bPe({score:t}){let e=new RegExp(/\(\d+\/\d+\)/g),i=t.match(e);for(let r of i||[]){let n=r.replace("/","-");t=t.replace(r,n)}return{score:t}}function wPe({score:t}){if(t.includes(",")){let e=t.split(",").map(r=>r.trim()),i=r=>/\d \d/.test(r);e.every(i)&&(t=e.map(r=>{let n=/\d+ \d+/g;for(let a of r.match(n)){let[s,o]=a.match(/(\d+) (\d+)/).slice(1);r=r.replace(a,`${s}-${o}`)}return r}).join(" "))}if(t.includes(" ")){let e=t.replace(/[ ,]/g,"");e.split("").every(i=>Ni(i))&&e.length===4&&(t=e)}return{score:t}}function SPe({score:t}){let e=new RegExp(/^\[\d+\](.*)$/);e.test(t)&&(t=t.match(e).slice(1)[0].trim());let i=/\(,/g;return i.test(t)&&(t=t.replace(i,"(")),{score:t}}var UPe={handleTiebreakSlashSeparation:bPe,handleSetSlashSeparation:vPe,punctuationAdjustments:iPe,handleGameSeparation:yPe,joinFloatingTiebreak:nPe,handleBracketSpacing:rPe,handleSpaceSeparator:wPe,separateScoreBlocks:pPe,matchKnownPatterns:aPe,removeDanglingBits:IPe,removeErroneous:fPe,handleDefaulted:gPe,handleWalkover:mPe,properTiebreak:sPe,handleNumeric:j9,handleRetired:hPe,containedSets:oPe,sensibleSets:lPe,stringScore:cPe,superSquare:uPe,setBuilder:V9,excisions:SPe,replaceOh:dPe},FA={},TPe=["handleNumeric","handleWalkover","handleRetired","handleDefaulted","replaceOh","stringScore","punctuationAdjustments","excisions","handleSpaceSeparator","matchKnownPatterns","removeDanglingBits","handleBracketSpacing","matchKnownPatterns","containedSets","separateScoreBlocks","handleGameSeparation","removeErroneous","joinFloatingTiebreak","handleSetSlashSeparation","handleTiebreakSlashSeparation","properTiebreak","sensibleSets","superSquare"],DPe=["handleNumeric","separateScoreBlocks","sensibleSets","superSquare"];function H9(t){if(!t.score)return{error:ie};let{score:e,sheetName:i,identifier:r,fileName:n,stepLog:a,fullLog:s,profile:o}=t,l=[],u,c=[],d,p,f=e,m=g=>{g.forEach(I=>{p=UPe[I]({profile:o,identifier:r,matchUpStatus:u,attributes:d,applied:c,score:f});let v=p.score!==f;v&&l.push({method:I,score:p.score}),a&&(s||v||p.matchUpStatus!==u)&&console.log(u?{score:p.score,matchUpStatus:u}:{score:p.score},I),p.matchUpStatus&&(u=p.matchUpStatus),p.attributes&&(d=p.attributes),p.applied&&(c=p.applied),f=p.score})};m(TPe);let h=pW(f);return h||(f=e.toString().replaceAll(/\D/g,""),d?.removed&&(d.removed=void 0),m(DPe),h=pW(f),h||(f="")),c.forEach(g=>{FA[g]||(FA[g]=0),FA[g]+=1}),{matchUpStatus:u?.toUpperCase(),modifications:l,attributes:d,isValid:h,score:f}}var W9={};ct(W9,{analyzeScore:()=>k0,analyzeSet:()=>Cb,calculateMatchStatistics:()=>D0,checkScoreHasValue:()=>cr,checkSetIsComplete:()=>lC,deduceMatchUpFormat:()=>mC,enrichPointHistory:()=>h9,getEpisodes:()=>T0,getQuickStats:()=>g9,getScore:()=>yd,getScoreboard:()=>w0,getSetComplement:()=>x0,getTiebreakComplement:()=>fC,getWinner:()=>S0,isComplete:()=>U0,isValidMatchUpFormat:()=>xa,parseScoreString:()=>CS,toStatObjects:()=>P0,validateMatchUpScore:()=>z9,validateScore:()=>O0,validateSetScore:()=>A0,validateTieFormat:()=>Bn});function PPe(t,e,i,r,n,a=!1){return n?{isValid:!0}:t===0&&e===0?{isValid:!1,error:"Tiebreak-only set requires both scores"}:t<r?{isValid:!1,error:`Tiebreak-only set winner must reach at least ${r}, got ${t}`}:i<(a?1:2)?{isValid:!1,error:a?`Tiebreak-only set (NoAD) must be won by at least 1 point, got ${t}-${e}`:`Tiebreak-only set must be won by at least 2 points, got ${t}-${e}`}:a?{isValid:!0}:t===r&&e>r-2?{isValid:!1,error:`Tiebreak-only set at ${r}-${e} requires playing past ${r}`}:t>r&&i!==2?{isValid:!1,error:`Tiebreak-only set past ${r} must be won by exactly 2 points, got ${t}-${e}`}:{isValid:!0}}function EPe(t,e,i,r){let n=r===i?i+1:i,a=r;return t!==n?{isValid:!1,error:`Tiebreak set winner must have ${n} games, got ${t}`}:e!==a?{isValid:!1,error:`Tiebreak set loser must have ${a} games, got ${e}`}:{isValid:!0}}function RPe(t,e,i){let r=Math.max(t||0,e||0),n=Math.min(t||0,e||0),a=r-n,s=i.tiebreakTo||7;return r<s?{isValid:!1,error:`Tiebreak winner must reach ${s} points, got ${r}`}:a<2?{isValid:!1,error:`Tiebreak must be won by 2 points, got ${r}-${n}`}:n>=s-1&&a>2?{isValid:!1,error:`Tiebreak score ${r}-${n} is invalid`}:{isValid:!0}}function CPe(t,e,i,r){return r?t===i+1&&e<i-1?{isValid:!1,error:`With tiebreak format, if side 1 has ${i+1} games, side 2 must be at least ${i-1}, got ${e}`}:e===i+1&&t<i-1?{isValid:!1,error:`With tiebreak format, if side 2 has ${i+1} games, side 1 must be at least ${i-1}, got ${t}`}:{isValid:!0}:{isValid:!0}}function MPe(t,e,i,r,n){if(t<r)return{isValid:!1,error:`Set winner must reach ${r} games, got ${t}`};let a=n&&t===r&&e===n&&i===1;if(i<2&&!a)return{isValid:!1,error:`Set must be won by at least 2 games, got ${t}-${e}`};if(n){if(e>=n&&!a)return{isValid:!1,error:`When tied at ${n}-${n}, must play tiebreak. Use format like ${n+1}-${n}(5)`};let s=n===r?r+1:r;if(t>s)return{isValid:!1,error:`With tiebreak format, set score cannot exceed ${s}-${n}. Got ${t}-${e}`}}else if(t>r+10)return{isValid:!1,error:`Set score ${t}-${e} exceeds reasonable limits`};return{isValid:!0}}function NPe(t,e,i){let r=t.side1TiebreakScore,n=t.side2TiebreakScore,a=e&&i?r:t.side1Score||t.side1||0,s=e&&i?n:t.side2Score||t.side2||0;return{side1Score:a,side2Score:s,side1TiebreakScore:r,side2TiebreakScore:n}}function APe(t,e,i,r,n,a,s){if(i&&r){let o=EPe(t,e,i,r);if(!o.isValid)return o}return(n!==void 0||a!==void 0)&&s?RPe(n,a,s):{isValid:!0}}function kPe(t,e,i){return i&&(t>i+10||e>i+10)?{isValid:!1,error:`Set score ${t}-${e} exceeds expected range for ${i}-game sets`}:{isValid:!0}}function OPe(t,e,i){let{side1:r,side2:n,winner:a,loser:s,diff:o}=t,{setTo:l,tiebreakAt:u}=e;if(l&&u){let c=CPe(r,n,l,u);if(!c.isValid)return c}return i?kPe(a,s,l):l?MPe(a,s,o,l,u):{isValid:!0}}function A0(t,e,i,r){if(!e)return{isValid:!0};let n=zi(e);if(!n)return{isValid:!0};let a=i&&n.finalSetFormat?n.finalSetFormat:n.setFormat;if(!a)return{isValid:!0};if(a.timed){if(!r){let S=t.side1Score??0,U=t.side2Score??0;if(S===0&&U===0)return{isValid:!1,error:"Timed set requires at least one side to have scored"};if(a.based==="P"&&S===U&&S>0&&a.tiebreakFormat&&!(t.side1TiebreakScore!==void 0||t.side2TiebreakScore!==void 0))return{isValid:!1,error:"Tied timed set requires tiebreak"}}return{isValid:!0}}let{setTo:s,tiebreakAt:o,tiebreakFormat:l,tiebreakSet:u}=a,c=u?.tiebreakTo,d=!!c&&!s,p=t.side1TiebreakScore!==void 0&&t.side2TiebreakScore!==void 0,{side1Score:f,side2Score:m,side1TiebreakScore:h,side2TiebreakScore:g}=NPe(t,d,p),I=Math.max(f,m),v=Math.min(f,m),w=I-v;if(d){let S=t.NoAD??a.tiebreakSet?.NoAD??!1;return PPe(I,v,w,c,r??!1,S)}let y=h!==void 0||g!==void 0,b=s&&I===s+1&&v===s;return y||b?APe(I,v,s,o,h,g,l):OPe({side1:f,side2:m,winner:I,loser:v,diff:w},{setTo:s,tiebreakAt:o},r)}function z9(t,e,i){if(!t||t.length===0)return{isValid:!0};let r=e?.match(/SET(\d+)/)?.[1],n=r?Number.parseInt(r):3,a=[$r,mi,Qt].includes(i||"");for(let s=0;s<t.length;s++){let o=t[s],l=s+1===n,u=o.winningSide!==void 0,c=A0(o,e,l,a||i===void 0&&!u);if(!c.isValid)return{isValid:!1,error:`Set ${s+1}: ${c.error}`}}return{isValid:!0}}function pC(t){return!!t?.aggregate}function xPe(t,e,i,r,n,a){let{tiebreakTo:s,NoAD:o}=t||{},l=Math.max(e??0,i??0);return!(o&&l>s||l<s&&r&&(n&&!a||!n))}function FPe(t,e,i,r,n,a){let s=e+1===r,{side1Score:o,side2Score:l,side1TiebreakScore:u,side2TiebreakScore:c,winningSide:d}=t,p=Math.max(o??0,l??0),f=u??c,{finalSetFormat:m,setFormat:h}=i,g=s&&m||h;return f&&!xPe(g?.tiebreakFormat,u,c,d,n,a)?!1:g.setTo?!(!g.noTiebreak&&p>g.setTo+1):!0}function LPe(t){let e=t.reduce((i,r)=>((r.side1Score!==void 0||r.side2Score!==void 0)&&(i[0]+=r.side1Score??0,i[1]+=r.side2Score??0),i),[0,0]);return e[0]>e[1]?1:e[1]>e[0]?2:t.find(i=>i.side1TiebreakScore!==void 0||i.side2TiebreakScore!==void 0)?.winningSide}function _Pe(t,e,i,r,n){return(!n||t===e)&&i===1&&r.indexOf(t)+1||void 0}function k0({existingMatchUpStatus:t,matchUpFormat:e,matchUpStatus:i,winningSide:r,score:n}){let a=n?.sets??[],s=(a?.filter(T=>T?.winningSide)||[]).reduce((T,P)=>{let{winningSide:D}=P;if(!D)return T;let E=D-1;return T[E]++,T},[0,0]),o=r?r-1:void 0,l=o!==void 0&&[0,1].includes(o)?1-o:void 0,u=o!==void 0&&s[o],c=l!==void 0&&s[l],d=e?zi(e):void 0,p=Math.max(...s),f=va(s)[p],m=d?.setFormat?.timed||d?.finalSetFormat?.timed,h=d?.bestOf||d?.exactly,g=h&&Math.ceil(h/2)||1,I=i??t,v=!!(I&&[Qt,$r,mi].includes(I)),w=!d||!a.length||a.every((T,P)=>FPe(T,P,d,h??0,P===a.length-1,v)),y=d?.exactly,b=!y||!I||I!==ki||v||a.length>=y,S=pC(d),U=S&&a.length>0?LPe(a):_Pe(p,g,f,s,e);return{valid:!!(w&&b&&(r&&S&&r===U||r&&!S&&u>c&&r===U||r&&v||!r&&!U&&(![ki,Qt,$r,mi].includes(I)||m&&I===ki)))}}function O0({existingMatchUpStatus:t,matchUpFormat:e,matchUpStatus:i,winningSide:r,score:n}){if(typeof n!="object")return{error:ie};let{sets:a,scoreStringSide1:s,scoreStringSide2:o}=n,l="scoreString must be a string!";if(s!==void 0&&typeof s!="string")return{error:ie,info:l};if(o!==void 0&&typeof o!="string")return{error:ie,info:l};if(a!==void 0&&!Array.isArray(a))return{error:ie,info:Ap("sets")};if(a?.length){let u=a.map(d=>d?.setNumber).filter(Boolean);if(u.length!==rt(u).length)return{error:ie,info:"setNumbers not unique"};for(let d of a){let{side1Score:p,side2Score:f,side1TiebreakScore:m,side2TiebreakScore:h,side1PointScore:g,side2PointScore:I,winningSide:v,setNumber:w}=d;if(![[p,f],[m,h],[g,I]].filter(y=>y.some(b=>![void 0,null].includes(b))).every(y=>y.every(b=>ot(b))))return{error:ie,info:"non-numeric values"};if(![w,v].filter(y=>![void 0,null].includes(y)).every(y=>ot(y)))return{error:ie,info:"non-numeric values"};if(v&&![1,2].includes(v))return{error:ie,info:"winningSide must be 1 or 2"}}let{valid:c}=k0({existingMatchUpStatus:t,matchUpStatus:i,matchUpFormat:e,winningSide:r,score:n});if(!c)return{error:W6,info:"score is invalid for matchUpFormat or winningSide does not match calculated winningSide"}}return{valid:!0}}var x0=t=>{let{isSide1:e,lowValue:i,setTo:r,tiebreakAt:n,NoAD:a}=t;if(i===void 0)return!1;let s=Ye(i);s?.toString().length>2&&(s=Number.parseInt(s.toString().slice(0,2))),n&&n<r&&s>n&&(s=n);let o;return a&&!n?s>r?o=r:o=s<r?r:r-1:o=s+1<r&&r||n&&n<r&&s===n&&r||!n&&s+2||r+1,[e?s:o,e?o:s]},fC=t=>{let{isSide1:e,lowValue:i,tiebreakTo:r,tiebreakNoAd:n}=t;if(i===void 0)return!1;let a=typeof i=="string"?Number.parseInt(i):i;a?.toString().length>2&&(a=Number.parseInt(a.toString().slice(0,2))),n&&a>r-1&&(a=r-1);let s=$Pe({lowValue:a,NoAD:n,tiebreakTo:r});return[e?a:s,e?s:a]};function $Pe(t){let{lowValue:e,NoAD:i,tiebreakTo:r}=t,n=i?1:2;return e+1>=r?e+n:r}function OO(t,e){return t>e&&1||t<e&&2||void 0}function BPe(t,e){return e?{side1Score:t[0],side2Score:t[1],winningSide:OO(t[0],t[1])}:{side1TiebreakScore:t[0],side2TiebreakScore:t[1],winningSide:OO(t[0],t[1])}}function CS({tiebreakTo:t=7,scoreString:e="",matchUpFormat:i}){let r,n=3;if(i)try{r=zi(i);let c=/SET(\d+)/.exec(i)?.[1];n=c?Number.parseInt(c):3}catch{}return e?.split(" ").filter(Boolean).map((c,d)=>u({set:c,setNumber:d+1}));function a(c,d){if(!r||!d)return!1;let p=c===n&&r.finalSetFormat?r.finalSetFormat:r.setFormat;if(!p)return!1;let f=p.tiebreakSet?.tiebreakTo,m=p.setTo;return!!f&&!m}function s(c){if(!r)return t;let d=c===n&&r.finalSetFormat?r.finalSetFormat:r.setFormat;return d?.tiebreakSet?.tiebreakTo??d?.tiebreakFormat?.tiebreakTo??t}function o(c,d,p){let f=c[1],m=s(p),h=fC({lowValue:f,isSide1:d===2,tiebreakTo:m});return Array.isArray(h)?[h[0],h[1]]:[void 0,void 0]}function l(c,d,p,f){let m=(d&&c.replace(d[0],"")||p&&c.replace(p[0],"")||c).split("-").map(y=>Number.parseInt(y)),h=m[0],g=m[1],I=OO(h,g),v,w;if(d&&([v,w]=o(d,I,f)),p){let y=p[1].split("-").map(b=>Number.parseInt(b));v=y[0],w=y[1]}return{side1Score:h,side2Score:g,side1TiebreakScore:v,side2TiebreakScore:w,winningSide:I}}function u({set:c,setNumber:d}){let p=/\(([^)]+)\)/,f=/\[([^\]]+)\]/,m=p.exec(c),h=f.exec(c),g=c?.startsWith("[")&&h,I=a(d,!!g),v=s(d),w=I&&v===1,y;if(g){let b=h[1].split("-").map(S=>Number.parseInt(S));y=BPe(b,I)}else y=l(c,m,h,d);return{side1Score:y.side1Score,side2Score:y.side2Score,side1TiebreakScore:y.side1TiebreakScore,side2TiebreakScore:y.side2TiebreakScore,winningSide:y.winningSide,setNumber:d,...w&&{NoAD:!0},...I&&{tiebreakSet:!0}}}}function VPe({matchUpScoringFormat:t,isDecidingSet:e,isTiebreakSet:i,isTimedSet:r,setObject:n}){if(!n)return;let a=uC({set:n});return lC({matchUpScoringFormat:t,set:n,isDecidingSet:e,isTiebreakSet:i,isTimedSet:r})&&a||void 0}function Cb(t){let{setObject:e,matchUpScoringFormat:i}=t;if(!e)return{error:GE};let{setNumber:r}=e||{},{bestOf:n,exactly:a}=i||{},s=n||a,o=!!(r&&s&&r===s),l=o&&i?.finalSetFormat||i?.setFormat,u=!!l?.tiebreakSet,c=!!l?.timed,d=!u&&!c,p=!!(r&&s&&r<=s),f=[e?.side1Score,e?.side2Score],m=[e?.side1PointScore,e?.side2PointScore],h=[e?.side1TiebreakScore,e?.side2TiebreakScore],g=f.filter(k=>k!==void 0).length,I=m.filter(k=>k!==void 0).length,v=h.filter(k=>k!==void 0).length,w=f?.filter(k=>!isNaN(k)).length,y=h?.filter(k=>!isNaN(k)).length,{tiebreakAt:b}=l||{},S=b&&f.filter(k=>k>=b).length===2,U=S&&(f[0]>f[1]&&1||f[1]>f[0]&&2||void 0),T=!!(y&&!w),P=!!e?.winningSide,{error:D,result:E}=jPe({sideTiebreakScores:h,sideGameScores:f,setFormat:l,setObject:e}),{error:R,result:C}=GPe({sideTiebreakScores:h,setObject:e,setFormat:l}),M=d&&!T&&E||u&&T&&C||c,N=p&&!(u&&!T)&&!(d&&T)&&(!P||M),A=VPe({isTimedSet:c,matchUpScoringFormat:i,isDecidingSet:o,isTiebreakSet:T,setObject:e}),O={expectTiebreakSet:u,expectTimedSet:c,hasTiebreakCondition:S,isCompletedSet:P,isDecidingSet:o,isTiebreakSet:T,isValidSet:N,isValidSetNumber:p,isValidSetOutcome:M,leadingSide:U,setFormat:l,sideGameScores:f,sideGameScoresCount:g,sidePointScores:m,sidePointScoresCount:I,sideTiebreakScores:h,sideTiebreakScoresCount:v,winningSide:A};return e?.winningSide!==void 0&&(T?(O.isValidTiebreakSetOutcome=C,C||(O.tiebreakSetError=R)):(O.isValidStandardSetOutcome=E,E||(O.standardSetError=D))),O}function jPe({setObject:t,setFormat:e,sideGameScores:i,sideTiebreakScores:r}){if(!t)return{result:!1,error:GE};let n=!!e?.tiebreakSet,a=!!e?.timed;if(!e||n||a)return{result:!1,error:ie};if(i?.filter(U=>!isNaN(U)).length!==2)return{result:!1,error:Qk};let{setTo:s,tiebreakAt:o,tiebreakFormat:l,NoAD:u}=e||{};if(!(s&&i?.find(U=>U>=s)))return{result:!1,error:Qk};let c=[1,2].includes(t?.winningSide);if(!t||!c)return{result:!1,error:WE};let d=t?.winningSide-1,p=1-d,f=i[d],m=i[p],h=f-m;if(!(f>m))return{result:!1,error:{message:"winningSide game scoreString is not high"}};let g=o&&l,I=r?.filter(U=>!isNaN(U)).length===2,v=r?.[d],w=r?.[p],y=o&&i.filter(U=>U>=o).length===2;if(g){let{NoAD:U,tiebreakTo:T}=l;if(y){if(h>1)return{result:!1,error:{message:"invalid winning game scoreString (5)"}};if(!I)return{result:!1,error:{message:"invalid tiebreak scores (1)"}};if(isNaN(T))return{result:!1,error:{message:"tiebreakTo error"}};if(!(T&&r?.find(C=>C>=T)))return{result:!1,error:{message:"invalid tiebreak scores (2)"}};let P=o<s?s:s+1;if(f>P)return{result:!1,error:{message:"invalid winning game scoreString (1)"}};if(!v||!w||v<w)return{result:!1,error:{message:"winningSide tiebreak value is not high"}};let D=U?1:2,E=v-w,R=w>=T-1;if(E&&R&&E<D)return{result:!1,error:{message:"invalid tiebreak scores (3)"}}}if(f>s&&!y)return{result:!1,error:{message:"invalid winning game scoreString (2)"}}}let b=u?1:2,S=m>=s-1;return h&&S&&!y&&h<b?{result:!1,error:{message:"invalid winning game scoreString (3)"}}:h>b&&f>s?{result:!1,error:{message:"invalid winning game scoreString (4)"}}:{result:!0}}function GPe({setObject:t,setFormat:e,sideTiebreakScores:i}){if(!t)return{result:!1,error:GE};let r=!!e?.tiebreakSet,n=!!e?.timed;if(!e||!r||n)return{result:!1,error:{message:"not tiebreak set"}};let a=[1,2].includes(t?.winningSide);if(!t||!a)return{result:!1,error:WE};let{tiebreakSet:s}=e||{},{NoAD:o,tiebreakTo:l}=s||{};if(i?.filter(g=>!isNaN(g)).length!==2)return{result:!1,error:{message:"invalid tiebreak scores (1)"}};if(isNaN(l))return{result:!1,error:{message:"tiebreakTo error"}};if(!i?.find(g=>g>=l))return{result:!1,error:{message:"invalid tiebreak scores (2)"}};let u=t?.winningSide-1,c=1-u,d=i[u],p=i[c];if(!d||!p||d<p)return{result:!1,error:{message:"winningSide tiebreak value is not high"}};let f=o?1:2,m=d-p,h=p>=l-1;return m&&h&&m<f?{result:!1,error:{message:"invalid tiebreak scores (3)"}}:{result:!0}}var LA="SET3-S:6/TB7";function mC(t){let e=t.split(/[\s,]+/).filter(o=>o.length>0);if(e.length===0)return LA;let i;e.length===1?i=1:e.length===2?i=3:i=5;for(let o of e){let l=o.replace(/\([^)]*\)/g,"").match(/(\d+)/g)?.map(u=>Number.parseInt(u,10))||[];if(l.length===2){let u=Math.max(...l),c=Math.min(...l),d=u-c;if(u===10||u>10&&d<=2)return`SET${i}-S:TB10`}}let r=null;for(let o of e)if(/\(/.test(o)){r=o;break}let n;if(r){let o=r.replace(/\([^)]*\)/g,"").match(/(\d+)/g)?.map(c=>parseInt(c,10))||[];if(o.length===0)return LA;let l=Math.max(...o),u=Math.min(...o);l===u+1?n=u:n=l-1}else{let o=[];for(let u of e){let c=u.replace(/\([^)]*\)/g,"").match(/(\d+)/g)?.map(d=>parseInt(d,10))||[];c.length>0&&o.push(Math.max(...c))}if(o.length===0)return LA;let l=Math.max(...o);l>=6?n=6:n=l}let a=!1;if(e.length>=3){let o=e.at(-1).replace(/\([^)]*\)/g,"").match(/(\d+)/g)?.map(l=>Number.parseInt(l,10))||[];if(o.length===2){let l=Math.max(...o),u=Math.min(...o);l>n+1&&l-u===2&&(a=!0)}}let s;return n===6?s=`SET${i}-S:6/TB7`:n===4?s=`SET${i}-S:4/TB7`:s=`SET${i}-S:${n}/TB7`,a&&(s+=`-F:${n}`),s}function q9(t){let{matchUp:e,expectedScore:i}=t;if(!e)return{isValid:!1,errors:["No matchUp provided"],warnings:[],actual:{sets:[],scoreString:""},expected:{sets:i?.sets,scoreString:i?.scoreString},pointsProcessed:0,pointsRejected:0};let r=[],n=[],a=rd({matchUpFormat:e?.matchUpFormat,matchUpId:e?.matchUpId,participants:e?.sides?.map(c=>c.participant).filter(c=>c!==void 0)}),s=e?.history?.points||[];s.length===0&&n.push("No points found to validate");let o=0,l=0;for(let c of s)try{a=gp(a,{winner:c.winner,server:c.server}),o++}catch(d){l++;let p=d instanceof Error?d.message:String(d);r.push(`Point ${c.pointNumber||o+1}: ${p}`)}let u=yd(a);return i&&(i.sets&&(u.sets.length!==i.sets.length&&r.push(`Set count mismatch: expected ${i.sets.length}, got ${u.sets.length}`),i.sets.forEach((c,d)=>{let p=u.sets[d];if(!p){r.push(`Missing set ${d+1}`);return}c.side1Score!==void 0&&p.side1Score!==c.side1Score&&r.push(`Set ${d+1} side1Score: expected ${c.side1Score}, got ${p.side1Score}`),c.side2Score!==void 0&&p.side2Score!==c.side2Score&&r.push(`Set ${d+1} side2Score: expected ${c.side2Score}, got ${p.side2Score}`),c.side1TiebreakScore!==void 0&&p.side1TiebreakScore!==c.side1TiebreakScore&&r.push(`Set ${d+1} side1TiebreakScore: expected ${c.side1TiebreakScore}, got ${p.side1TiebreakScore}`),c.side2TiebreakScore!==void 0&&p.side2TiebreakScore!==c.side2TiebreakScore&&r.push(`Set ${d+1} side2TiebreakScore: expected ${c.side2TiebreakScore}, got ${p.side2TiebreakScore}`)})),i.scoreString&&u.scoreString!==i.scoreString&&r.push(`Score string mismatch: expected "${i.scoreString}", got "${u.scoreString}"`)),{isValid:r.length===0,errors:r,warnings:n,actual:{sets:u.sets,scoreString:u.scoreString},expected:{sets:i?.sets,scoreString:i?.scoreString},pointsProcessed:o,pointsRejected:l}}function HPe(t){let e=t?.side1Score||0,i=t?.side2Score||0;if(t?.side1TiebreakScore!==void 0||t?.side2TiebreakScore!==void 0){let r=t?.side1TiebreakScore||0,n=t?.side2TiebreakScore||0;return e>i?`${e}-${i}(${n})`:`${e}(${r})-${i}`}return`${e}-${i}`}function WPe(t){let{points:e,matchUpFormat:i,expectedGames:r,expectedTiebreak:n}=t,a={matchUpId:"validation",matchUpFormat:i,matchUpStatus:"TO_BE_PLAYED",matchUpType:"SINGLES",sides:[{sideNumber:1},{sideNumber:2}],score:{sets:[]},history:{points:e?.map((s,o)=>({...s,pointNumber:o+1,timestamp:"",winner:s.winner,server:s.server}))}};return q9({matchUp:a,expectedScore:{sets:[{side1Score:r?.[0],side2Score:r?.[1],side1TiebreakScore:n?.[0],side2TiebreakScore:n?.[1]}]}})}function zPe(t){let{points:e,expectedScore:i,matchUpFormat:r,allowExtraPoints:n=!1,debug:a=!1}=t,s=[],o=[],l=[],u,c=!1;r?u=r:i?(u=mC(i),c=!0,a&&console.log(`Deduced format: ${u} from score: ${i}`)):(u="SET3-S:6/TB7",c=!0,o.push("No format provided, using default SET3-S:6/TB7"));let d=rd({matchUpFormat:u}),p=e?.split("").map(v=>{let w=Number.parseInt(v,10);return Number.isNaN(w)||w!==0&&w!==1?null:w}).filter(v=>v!==null);if(p?.length===0)return s.push("No valid points found in point string"),{valid:!1,errors:s,warnings:o,pointsProcessed:0,pointsRejected:[],actualScore:"0-0",matchUpFormat:u,formatDeduced:c,sets:[]};let f=0;for(let v=0;v<p?.length;v++){let w=p[v];if(d.matchUpStatus==="COMPLETED"&&!n){l.push(w),a&&console.log(`Point ${v+1}: Rejected (match complete)`);continue}try{if(d=gp(d,{winner:w}),f++,a){let y=yd(d);console.log(`Point ${v+1}: ${w}  ${y.scoreString}`)}}catch(y){l.push(w);let b=y instanceof Error?y.message:String(y);s.push(`Point ${v+1}: ${b}`),a&&console.log(`Point ${v+1}: Error - ${b}`)}}let m=yd(d),h=m.scoreString,g=m.sets.map(v=>{let w=[v.side1Score||0,v.side2Score||0],y=v.side1TiebreakScore===void 0?void 0:[v.side1TiebreakScore,v.side2TiebreakScore||0],b=`${w[0]}-${w[1]}`;return y&&(b=w[0]>w[1]?`${w[0]}-${w[1]}(${y[1]})`:`${w[0]}(${y[0]})-${w[1]}`),{games:w,tiebreak:y,scoreString:b}}),I=!0;if(i){let v=mW(i),w=mW(h);v!==w&&(I=!1,s.push(`Score mismatch: expected "${i}", got "${h}"`))}return l.length>0&&o.push(`${l.length} excess points after match complete`),s.length>0&&(I=!1),{valid:I,errors:s,warnings:o,pointsProcessed:f,pointsRejected:l,expectedScore:i,actualScore:h,matchUpFormat:u,formatDeduced:c,sets:g}}function mW(t){return t.replace(/\s+/g,"").replace(/,/g,", ").toLowerCase()}var qPe={4:"Wide",5:"Body",6:"T"},Y9={f:"Forehand",r:"Forehand Slice",v:"Forehand Volley",o:"Overhead Smash",u:"Forehand Drop Shot",l:"Forehand Lob",h:"Forehand Half-volley",j:"Forehand Drive Volley"},K9={b:"Backhand",s:"Backhand Slice",z:"Backhand Volley",p:"Backhand Overhead Smash",y:"Backhand Drop Shot",m:"Backhand Lob",i:"Backhand Half-volley",k:"Backhand Drive Volley"},YPe={t:"Trick Shot",q:"Unknown Shot"},KPe={...Y9,...K9,...YPe},XPe={7:"shallow",8:"deep",9:"very deep"},JPe={1:1,2:2,3:3},QPe={"+":"approach","-":"net","=":"baseline"},Lf={n:"Net",w:"Out Wide",d:"Out Long",x:"Out Wide and Long",g:"Foot Fault",e:"Unknown","!":"Shank"};function ZPe(t,e){return t.PtWinner===t.Svr?e:1-e}function X9(t){let e=[],i="",r="fbrsvzouymlhijkpqt";for(let n=0;n<t.length;n++){let a=t[n];a&&(r.includes(a)||"456".includes(a)?(i&&e.push(i),i=a):i+=a)}return i&&e.push(i),e}function eEe(t){if(t.includes("*"))return"*";if(t.includes("#"))return"#";if(t.includes("@"))return"@"}function Ol(t){if(t){for(let e of Object.keys(Lf))if(t.includes(e))return e}}function tEe(t){let e=[];for(let i of t){if(!i)continue;let r=i[0];if(r&&/[456]/.test(r))e.push(i);else break}return e}function J9(t){if(!ri(t))return{serves:[],rally:[]};let e,i,r,n=t.split("c").length-1;t=t.split("c").join("");let a=X9(t),s=a;for(let c=a.length-1;c>=0;c--){let d=a[c];if(d&&(i=eEe(d),i)){s=a.slice(0,c+1),r=a.slice(c+1),e=d;break}}let o=tEe(s),l=o.length?s.slice(o.length):s;if(!i&&!o.length&&l.length===1){let c=l[0];c&&["S","P","Q","R"].includes(c)&&(e=c,l.length=0)}let u={serves:o,rally:l};return n&&(u.lets=n),i&&(u.terminator=i),e&&(u.result=e),r?.length,u}function Q9(t){let e=t.join("|"),i=xO(t[0],1);if(i.winner==="S"||!t[1])return i.serve=1,i.code=e,i;let r=xO(t[1],2);return r.serve=2,r.first_serve={serves:i.serves},i.lets&&(r.first_serve.lets=i.lets),i.error&&(r.first_serve.error=i.error),i.parse_notes&&(r.first_serve.parse_notes=i.parse_notes),r.code=e,r}function xO(t,e){let i=J9(t);if(["Q","S"].includes(i.result||""))return i.winner="S",i;if(["P","R"].includes(i.result||"")||!i.terminator&&!Ol(i.serves[0])&&i.serves.length>2)return i.winner="R",i;let r=(i.serves.length+i.rally.length)%2===0?"R":"S",n;if(i.rally.length>0?n=i.rally[i.rally.length-1]:i.serves.length>0&&(n=i.serves[i.serves.length-1]),!n)return{...i,winner:void 0};if(!i.rally.length){if(i.terminator==="*")i.result="Ace",i.winner="S";else if(i.terminator==="#")i.result="Serve Winner",i.winner="S";else{let a=Ol(i.serves[0]);a?(i.error=Lf[a],e===2&&(i.result="Double Fault",i.winner="R")):(i.parse_notes="treated as a fault",e===2&&(i.result="Double Fault",i.winner="R"))}return i}if(i.rally.length===1&&n.includes("#")){i.result="Serve Winner",i.winner="S";let a=Ol(n);return a&&(i.error=Lf[a]),i}return n.includes("#")?(i.result="Forced Error",i.error=Lf[Ol(n)],i.winner=r==="R"?"S":"R"):n.includes("*")?(i.result="Winner",i.winner=r):n.includes("@")?(i.result="Unforced Error",i.error=Lf[Ol(n)],i.winner=r==="R"?"S":"R"):Ol(i.serves[0])?i.rally.length===1&&Ol(n)&&(i.error=Lf[Ol(n)],i.winner=r==="R"?"S":"R"):i.serves.length&&i.rally.length?(i.parse_notes="no terminator: receiver wins point",i.result="Unknown",i.winner="R"):i.rally.length===1&&Ol(n)&&(i.error=Lf[Ol(n)],i.winner=r==="R"?"S":"R"),i}function FO(t){if(t)for(let e of t){let i=KPe[e];if(i)return i}}function iEe(t){if(t)for(let e of t){let i=qPe[e];if(i)return i}}function rEe(t,e,i){let r=[],n=1,a=i;if(t.length>0&&!Ol(t[t.length-1])){let s=t[t.length-1],o=FO(s)||"Forehand";r.push({shotNumber:n++,player:a,stroke:o,code:s}),a=1-a}for(let s of e){let o=FO(s);if(!o)continue;let l={shotNumber:n++,player:a,stroke:o,code:s};for(let u of s){let c=JPe[u];c!==void 0&&(l.direction=c)}for(let u of s){let c=XPe[u];c&&(l.depth=c)}for(let u of s){let c=QPe[u];c&&(l.position=c)}r.push(l),a=1-a}return r}function Z9(t,e){let i=ZPe(t,e),r=t["1st"]||"",n=t["2nd"]||"";if(!r&&!n)return{winner:i,server:e,result:"Unknown"};let a=Q9([r,n]),s={winner:i,server:e};a.result&&(s.result=a.result),a.serve&&(s.serve=a.serve);let o=a.serve===1?r:n,l=iEe(o);l&&(s.serveLocation=l);let u=a.rally[a.rally.length-1];if(u){let d=FO(u);d&&(s.stroke=d,Object.values(Y9).includes(d)?s.hand="Forehand":Object.values(K9).includes(d)&&(s.hand="Backhand"))}let c=rEe(a.serves,a.rally,e);return c.length>0&&(s.rally=c,s.rallyLength=c.length),a.code&&(s.code=a.code),s}function eX(t){if(!t||!ri(t))return[];let e=t.trim().split(`
`);if(e.length<2)return[];let i=e[0]?.split(",")||[],r=[];for(let n=1;n<e.length;n++){let a=e[n];if(!a)continue;let s=a.split(","),o={};for(let l=0;l<i.length;l++){let u=i[l];u&&(o[u]=s[l]||"")}r.push(o)}return r}function tX(t){if(!Array.isArray(t))return[];let e=new Map;for(let i of t){let r=i.match_id;e.has(r)||e.set(r,[]),e.get(r).push(i)}return Array.from(e.entries()).map(([i,r])=>({match_id:i,points:r}))}function nEe(t){let e=t?.split("-")||[];if(e.length<6)return{player1:"Player 1",player2:"Player 2"};let i=e[0],r=e[2]?.replace(/_/g," "),n=e[4]?.replace(/_/g," ")||"Player 1",a=e[5]?.replace(/_/g," ")||"Player 2";return{player1:n,player2:a,date:i,tournament:r}}function aEe(t){if(!t||t.length===0)return;let e=t.at(-1);if(!e)return;let i=e.Set1,r=e.Set2,n=e.Set3,a=e.Set4,s=e.Set5,o=[];return i&&o.push(`${i}-${r}`),n&&o.push(`${n}-${r||"0"}`),a&&o.push(`${a}-${r||"0"}`),s&&o.push(`${s}-${r||"0"}`),o.length>0?o.join(", "):void 0}function iX(t,e={}){let{matchUpFormat:i,validateScore:r=!0,debug:n=!1}=e,a=[],s=[],o=nEe(t.match_id),l=aEe(t.points),u,c=!1;i?u=i:l?(u=mC(l),c=!0,n&&console.log(`Deduced format: ${u} from score: ${l}`)):(u="SET3-S:6/TB7",c=!0,s.push("No format provided, using default SET3-S:6/TB7")),n&&(console.log(`Validating match: ${o.player1} vs ${o.player2}`),console.log(`Format: ${u}`),console.log(`Total points: ${t.points.length}`),l&&console.log(`Expected score: ${l}`));let d=rd({matchUpFormat:u,matchUpId:t.match_id});d.sides[0]&&(d.sides[0].participant={participantId:"player1",participantName:o.player1,participantType:"INDIVIDUAL",participantRole:"COMPETITOR"}),d.sides[1]&&(d.sides[1].participant={participantId:"player2",participantName:o.player2,participantType:"INDIVIDUAL",participantRole:"COMPETITOR"});let p=0,f=0,m=0,h=0,g=0,I,v=0;for(let S=0;S<t.points?.length;S++){let U=t.points[S];if(U){I=U.Svr==="1"?0:1;try{let T=Z9(U,I),P={winner:T.winner,server:T.server};if(d=gp(d,P),d.history?.points&&d.history.points.length>0){let D=d.history.points[d.history.points.length-1];D&&(T.result&&(D.result=T.result),T.stroke&&(D.stroke=T.stroke),T.hand&&(D.hand=T.hand),T.serve&&(D.serve=T.serve),T.serveLocation&&(D.serveLocation=T.serveLocation),T.rally&&(D.rally=T.rally),T.rallyLength&&(D.rallyLength=T.rallyLength),T.code&&(D.code=T.code))}if(v++,T.result==="Ace"&&p++,T.result==="Double Fault"&&f++,T.result==="Winner"&&m++,T.result==="Unforced Error"&&h++,T.result==="Forced Error"&&g++,n&&(S<5||S===t.points.length-1)){let D=yd(d);console.log(`Point ${S+1}: ${T.result||"Rally"}  ${D.scoreString}`)}}catch(T){let P=T instanceof Error?T.message:String(T);a.push(`Point ${S+1}: ${P}`),n&&console.error(`Point ${S+1} failed:`,P)}}}let w=yd(d).scoreString,y=d.matchUpStatus==="COMPLETED";y||s.push(`Match not complete. Final score: ${w}`);let b;if(r&&l){let S=hW(l),U=hW(w);b=S===U,b||a.push(`Score mismatch: expected "${l}", got "${w}"`),n&&(console.log(`Expected: ${l}  ${S}`),console.log(`Actual: ${w}  ${U}`),console.log(`Score matches: ${b}`))}return n&&(console.log(`Final score: ${w}`),console.log(`Match complete: ${y}`),console.log(`Stats: ${p} aces, ${f} DFs, ${m} winners, ${h} UEs, ${g} FEs`)),{valid:a.length===0,errors:a,warnings:s,matchUp:d,pointsProcessed:v,expectedScore:l,actualScore:w,scoreMatches:b,formatDeduced:c,aces:p,doubleFaults:f,winners:m,unforcedErrors:h,forcedErrors:g}}function hW(t){return t.replace(/\s+/g,"").replace(/,/g,", ").toLowerCase()}function sEe(t){let{csvData:e,matchId:i,matchUpFormat:r,debug:n=!1}=t,a=[],s=[],o=[],l;try{l=eX(e)}catch(I){let v=I instanceof Error?I.message:String(I);return a.push(`Failed to parse CSV: ${v}`),{valid:!1,errors:a,warnings:s,matchesProcessed:0,pointsProcessed:0,matchUps:[],totalAces:0,totalDoubleFaults:0,totalWinners:0,totalUnforcedErrors:0,totalForcedErrors:0}}let u=tX(l);n&&console.log(`Parsed ${l.length} points from ${u.length} matches`);let c=i?u.filter(I=>I.match_id===i):u;if(c.length===0)return a.push(i?`Match ID not found: ${i}`:"No matches found in CSV data"),{valid:!1,errors:a,warnings:s,matchesProcessed:0,pointsProcessed:0,matchUps:[],totalAces:0,totalDoubleFaults:0,totalWinners:0,totalUnforcedErrors:0,totalForcedErrors:0};let d=0,p=0,f=0,m=0,h=0,g=0;for(let I of c){let v=iX(I,{matchUpFormat:r,debug:n});v.valid||a.push(...v.errors),s.push(...v.warnings),o.push(v.matchUp),d+=v.pointsProcessed,p+=v.aces,f+=v.doubleFaults,m+=v.winners,h+=v.unforcedErrors,g+=v.forcedErrors}return{valid:a.length===0,errors:a,warnings:s,matchesProcessed:c.length,pointsProcessed:d,matchUps:o,totalAces:p,totalDoubleFaults:f,totalWinners:m,totalUnforcedErrors:h,totalForcedErrors:g}}function oEe(t){return JSON.stringify(t,null,2)}function lEe(t){let{existingDrawDefinition:e,hydrateCollections:i,enforceGender:r,tieFormatName:n,matchUpType:a,eventType:s,isMock:o,event:l}=t,{tieFormat:u,matchUpFormat:c}=t;if(a===rr&&s===rr){let d=e?.structures?.find(({stage:p})=>p===xe)?.tieFormat;u=u||d||n&&l?.tieFormat?.tieFormatName===n&&l.tieFormat||n&&oc({namedFormat:n,hydrateCollections:i,isMock:o,event:l})||l?.tieFormat||oc({event:l,isMock:o,hydrateCollections:i}),c=void 0}else c||(u=void 0,l?.matchUpFormat||(c=Ju));if(u){let d=Bn({gender:l?.gender,enforceGender:r,tieFormat:u});if(d.error)return d}return{tieFormat:u,matchUpFormat:c}}function uEe(t){let e=t.drawDefinition,{existingQualifyingPlaceholderStructureId:i,appliedPolicies:r,qualifyingOnly:n,drawEntries:a,structureId:s,tieFormat:o,idPrefix:l,isMock:u,event:c}=t,d=t.qualifyingProfiles,p=d?.length?t9({hasExistingDrawDefinition:!0,uuids:t.uuids,qualifyingProfiles:d,appliedPolicies:r,qualifyingOnly:n,tieFormat:o,idPrefix:l,isMock:u}):void 0;if(p?.error)return p;e.structures=e.structures?.filter(({structureId:b})=>b!==i),e.links=e.links?.filter(({source:b})=>b.structureId!==i);let{qualifiersCount:f,qualifyingDrawPositionsCount:m,qualifyingDetails:h}=p??{};m&&(p?.structures&&e.structures?.push(...p.structures),p?.links&&e.links?.push(...p.links));let g=e.structures?.find(({stage:b,stageSequence:S})=>b===xe&&S===1),{qualifiersCount:I}=pv({stageSequence:1,drawDefinition:e,structureId:s,stage:xe}),v=Math.max(f??0,I??0),w=s8({qualifiersCount:v,drawDefinition:e,stage:xe});if(w.error||(w=oP({drawSize:m,stage:We,drawDefinition:e}),w.error))return w;cEe({drawDefinition:e,drawEntries:a,event:c});let y=dEe({mainStructure:g,qualifyingDetails:h,drawDefinition:e});return y.error?y:{drawDefinition:e,structureId:s}}function cEe({drawDefinition:t,drawEntries:e,event:i}){for(let r of(e??[]).filter(({entryStage:n})=>n===We)){let n={...r,entryStage:r.entryStage??xe,drawDefinition:t,event:i};wL(n)}}function dEe({mainStructure:t,qualifyingDetails:e,drawDefinition:i}){for(let r of e||[]){let{finalQualifyingRoundNumber:n,finalQualifyingStructureId:a,roundTarget:s,finishingPositions:o,linkType:l}=r,u=t&&vS({targetStructureId:t.structureId,sourceStructureId:a,sourceRoundNumber:n,finishingPositions:o,targetEntryRound:s,linkType:l})?.link;if(u?.error)return u;u&&(i.links||(i.links=[]),i.links.push(u))}return{error:void 0}}function rX(t){let{participantIds:e}=t,i=t.drawDefinition?.entries?.filter(r=>{let n=r.entryStatus;return!t.restrictEntryStatus||so.includes(n)}).map(vt)??[];if(e){let r=e.filter(n=>!i?.includes(n));if(r?.length)return z({result:{error:To},info:{invalidParticipantIds:r}})}else e=i;return t.roundsCount&&t.restrictRoundsCount!==!1&&t.roundsCount>e.length-1&&(!t.enableDoubleRobin||t.roundsCount>(e.length-1)*2)?{error:ie,info:"Not enough participants for roundsCount"}:t.roundsCount&&t.restrictRoundsCount!==!1&&t.roundsCount>31?{error:ie,info:"roundsCount must be less than 32"}:{participantIds:e}}function F0(t){let e=[],{roundsCount:i=1,drawDefinition:r,matchUpsCount:n,structureId:a,idPrefix:s,isMock:o,event:l}=t,u,c=rX(t);if(c.error)return c;for(let d of Re(1,i+1)){let p=iC({restrictMatchUpsCount:t.restrictMatchUpsCount,ignoreLastRoundNumber:!!u,newRound:!u,drawDefinition:r,matchUpsCount:n,structureId:a,roundNumber:u,idPrefix:s,isMock:o,event:l});if(p.error)return z({result:p,info:{iteration:d}});p.matchUps?.length&&e.push(...p.matchUps),u=(p?.roundNumber??1)+1}return{matchUps:e}}function pEe(t){let{tournamentRecord:e,participantIds:i,scaleName:r,eventType:n,adHocRatings:a={}}=t,s=t.scaleAccessor??Dr[r]?.accessor,o=e.participants??[];for(let l of i??[]){let u=o?.find(d=>d.participantId===l),c=gW({scaleName:`${r}.${MF}`,participant:u,eventType:n});!c&&r&&(c=gW({scaleAccessor:s,participant:u,scaleName:r,eventType:n})),c&&!a[l]&&(a[l]=c)}return a}function gW({scaleType:t=od,scaleAccessor:e,participant:i,scaleName:r,eventType:n}){let a=(i&&Hl({scaleAttributes:{eventType:n??Pm,scaleType:t,scaleName:r},participant:i}))?.scaleItem?.scaleValue;return e&&bt(a)?a[e]:a}function L0(t){let e=mEe(t);if(e?.error)return e;let i=rX(t);if(i.error)return i;let r=fEe(t);if(r.error)return r;let n=pEe(t),a=t.tournamentRecord?.isMock??t.isMock,s=t.eventType??t.event?.eventType,o=[],l=[],u;for(let c of Re(1,(t.roundsCount??1)+1)){let d=f0({...t,participantIds:i.participantIds,structure:r.structure,ignoreLastRoundNumber:!0,iterationMatchUps:o,adHocRatings:n,roundNumber:u,eventType:s,isMock:a});if(d.error)return d;let{matchUps:p,...f}=d;f.modifiedScaleValues&&(n=f.modifiedScaleValues),l.push({...f,iteration:c,matchUpsCount:p?.length}),u=(f?.roundNumber??1)+1,p?.length&&o.push(...p)}return{...H,matchUps:o,roundResults:l}}function fEe(t){if(t.structureId)return t.structureId;let e=t.drawDefinition,i=e?.structures?.filter(n=>n.stageSequence===1)?.reduce((n,a)=>{let s=a.stage&&Em[a.stage];return Vn({structure:a})&&s>(Em[n?.stage]||1)?a:n},void 0),r=e?.structures?.find(n=>n.structureId===i?.structureId);return r?Vn({structure:r})?{structure:r}:{error:tm}:{error:Ii}}function mEe(t){return t.roundsCount&&typeof t.roundsCount!="number"?{error:ie,info:"roundsCount must be a number"}:typeof t.drawDefinition!="object"||t.drawDefinition.drawType&&t.drawDefinition.drawType!==na?{error:tm}:!Array.isArray(t.drawDefinition?.entries)&&t.participantIds&&!Array.isArray(t.participantIds)?{error:ie,info:"Missing Entries"}:{error:void 0}}function hEe(t){let{tournamentRecord:e,drawDefinition:i,structureId:r,idPrefix:n,isMock:a,event:s}=t,o=s?.entries?.filter(({entryStage:c,entryStatus:d})=>(!c||c===xe)&&d&&so.includes(d)),l=o?.map(vt),u=o?Math.floor(o.length/2):0;if(t.automated)return gEe({...t,participantIds:l});{let c=F0({roundsCount:t.roundsCount,drawDefinition:i,matchUpsCount:u,idPrefix:n,isMock:a,event:s});if(c.error)return c;c.matchUps?.length&&JR({matchUps:c.matchUps,suppressNotifications:!0,tournamentRecord:e,drawDefinition:i,structureId:r,event:s})}return{...H}}function gEe(t){let{restrictEntryStatus:e,generateMatchUps:i,structureId:r,matchUpIds:n,scaleName:a,scaleAccessor:s}=t.drawMatic??{},o=L0({...t,eventType:t.drawMatic?.eventType??t.matchUpType,generateMatchUps:i??!0,scaleAccessor:s??t.scaleAccessor,scaleName:a??t.scaleName,participantIds:t.participantIds,roundsCount:t.roundsCount,restrictEntryStatus:e,structureId:r,matchUpIds:n});return o.error?o:(o?.matchUps?.length&&JR({tournamentRecord:t.tournamentRecord,drawDefinition:t.drawDefinition,suppressNotifications:!0,matchUps:o.matchUps,event:t.event,structureId:r}),{...H})}function IEe({requireParticipantCount:t=!0,enforcePolicyLimits:e=!0,drawSizeProgression:i,participantsCount:r,participantCount:n,appliedPolicies:a,drawDefinition:s,seedingProfile:o,structureId:l,seedsCount:u}){r=r??n;let c=et({drawDefinition:s,structureId:l});if(c.error)return c;let d=c.structure;if(!d)return{error:Ii};let{positionAssignments:p}=ur({structure:d}),f=p?.length||0;if(u>f)return{error:y6};let m=d.structures?.length,h=ot(o?.groupSeedingThreshold)&&o?.groupSeedingThreshold,g=ML({roundRobinGroupsCount:m,drawSize:f})?.seedGroups,{seedsCount:I}=RS({policyDefinitions:a,requireParticipantCount:t,drawSizeProgression:i,participantsCount:r,drawSize:f});return I&&a?.[fo]&&u>I&&e&&(u=I),d.seedLimit=u,d.seedAssignments=Re(1,u+1).map(v=>{let w=g?.find(S=>S.includes(v)),y=w&&Math.min(...w),b=h&&v>=h?y:v;return{participantId:void 0,seedNumber:v,seedValue:b}}),ti({drawDefinition:s,structureIds:[l]}),{...H,seedLimit:u}}function Dh({sortDescending:t=!1,tournamentRecord:e,scaleAttributes:i,scaleSortMethod:r,stageSequence:n,entries:a,event:s,stage:o}){if(!e)return{error:Ie};a=a??s?.entries??[];let l=a.filter(f=>(!o||!f.entryStage||f.entryStage===o)&&(!n||!f.entryStageSequence||f.entryStageSequence===n)&&so.includes(f.entryStatus)),u={...i};return{scaledEntries:l.map(f=>{let{participantId:m}=f,{scaleItem:h}=Am({tournamentRecord:e,scaleAttributes:i,participantId:m});return{...f,...h}}).filter(f=>{let m=f.scaleValue;return!r&&(Number.isNaN(m)||!Number.parseFloat(m))?!1:m}).sort(r||(t||u?.ascending===!1?d:c))};function c(f,m){return p(f)-p(m)}function d(f,m){return p(m)-p(f)}function p(f){return Number.parseFloat(f.scaleValue||(t?-1:1e5))}}function nX(t){let e="prepareStage",{drawDefinition:i}=t,{structures:r}=Js({stageSequence:t.stageSequence||1,roundTarget:t.roundTarget,stage:t.stage,drawDefinition:i}),n=t.preparedStructureIds||[],a=r?.find(({structureId:f})=>!n.includes(f));if(!a)return z({result:{error:Ii},stack:e});let s=a?.structureId,{seedsCount:o,stageEntries:l,seedLimit:u}=DEe({...t,structureId:s});(t.seededParticipants||t.event||t.seedingScaleName)&&bEe({...t,seedsCount:o,structure:a,structureId:s});let c=t.automated!==!1&&t.drawType!==na&&!(t.qualifyingOnly&&t.stage!==We),d=(r?.length||0)>1,p=c?yEe({...t,multipleStructures:d,seedLimit:u,structureId:s}):{};return p?.error?z({result:p,stack:e}):{...p,stageEntries:l,structureId:s,seedsCount:o}}function vEe({entries:t,stage:e,stageSequence:i,roundTarget:r}){return t.filter(n=>{let a=mt({name:Tl,element:n})?.extension?.value;return(!n.entryStage||n.entryStage===e)&&(!i||!n.entryStageSequence||n.entryStageSequence===i)&&(!r||!a||a===r)&&lf.includes(n.entryStatus)})}function yEe(t){let e=typeof t.automated=="object"&&t.automated.seedsOnly,i=IS({...t,seedsOnly:e});if(i.error)return i;let r=i?.positionAssignments,n=i?.positioningReport;return{conflicts:i.conflicts,positionAssignments:r,positioningReport:n}}function bEe(t){let{seededParticipants:e,seedingScaleName:i,entries:r,event:n}=t,a=r.map(vt);e?wEe({...t,enteredParticipantIds:a}):(n||i)&&SEe({...t,enteredParticipantIds:a})}function wEe(t){let{provisionalPositioning:e,enteredParticipantIds:i,seededParticipants:r,tournamentRecord:n,appliedPolicies:a,drawDefinition:s,seedingProfile:o,structureId:l,structure:u,event:c}=t,d=u?bh({provisionalPositioning:e,appliedPolicies:a,drawDefinition:s,seedingProfile:o,structure:u}):void 0;r.filter(({participantId:p})=>i.includes(p)).filter(p=>!p.seedNumber||p.seedNumber<=r.length).sort((p,f)=>p.seedNumber<f.seedNumber?-1:p.seedNumber<f.seedNumber?1:0).forEach(p=>{let{participantId:f,seedNumber:m,seedValue:h}=p;mv({provisionalPositioning:e,tournamentRecord:n,drawDefinition:s,seedingProfile:o,participantId:f,seedBlockInfo:d,structureId:l,seedNumber:m,seedValue:h,event:c})})}function SEe(t){let e=t.seedsCount,{provisionalPositioning:i,enteredParticipantIds:r,seedAssignmentProfile:n,assignSeedsCount:a,tournamentRecord:s,drawDefinition:o,seedByRanking:l,seedingProfile:u,structureId:c,event:d}=t,{categoryName:p,ageCategoryCode:f}=d?.category||{};d?.eventType;let m=UEe({...t})||l&&TEe({...t}),h=m?.length??0;h<e&&(e=h),m?.filter(({participantId:g})=>r.includes(g)).slice(0,a||e).forEach((g,I)=>{let v=I+1,{participantId:w,scaleValue:y}=g,b=n?.[v]||y||v;mv({provisionalPositioning:i,tournamentRecord:s,drawDefinition:o,seedingProfile:u,participantId:w,structureId:c,seedNumber:v,seedValue:b,event:d})})}function UEe(t){let{tournamentRecord:e,seedingScaleName:i,stageSequence:r,entries:n,stage:a,event:s}=t,{categoryName:o,ageCategoryCode:l}=s?.category||{},u=s?.eventType,c={scaleName:i||o||l||s.eventId,scaleType:jl,eventType:u};return Dh({scaleAttributes:c,tournamentRecord:e,stageSequence:r,entries:n,stage:a}).scaledEntries}function TEe(t){let{tournamentRecord:e,stageSequence:i,event:r,entries:n,stage:a}=t,{categoryName:s,ageCategoryCode:o}=r?.category||{},l=r?.eventType;return Dh({scaleAttributes:{scaleName:s||o,scaleType:ou,eventType:l},tournamentRecord:e,stageSequence:i,entries:n,stage:a}).scaledEntries}function DEe(t){let{seedsCount:e}=t;t.seededParticipants&&(e=t.seededParticipants.length),e>t.drawSize&&(e=t.drawSize);let i=vEe(t);e>i.length&&(e=i.length);let{seedLimit:r}=IEe({enforcePolicyLimits:t.enforcePolicyLimits??!0,appliedPolicies:t.appliedPolicies,participantsCount:i.length,seedingProfile:t.seedingProfile,drawDefinition:t.drawDefinition,structureId:t.structureId,seedsCount:e});return r&&r<e&&(e=r),{seedsCount:e,stageEntries:i,seedLimit:r}}function PEe(t){let e=d0({...t,modifyOriginal:!1});if(e.error)return e;let i=e.drawDefinition,{suppressDuplicateEntries:r=!0,ignoreStageSpace:n,appliedPolicies:a,qualifyingOnly:s,seedingProfile:o,participants:l,drawEntries:u,placeByes:c,drawSize:d,drawType:p,entries:f}=t,m=[],h=[],g=EEe({ignoreStageSpace:n,drawDefinition:i,drawEntries:u,drawType:p,entries:f});if(g.error)return g;let I=p===rf?0:Ye(t.seedsCount??0),v=nX({...t,qualifyingOnly:!d||s,appliedPolicies:a,drawDefinition:i,seedingProfile:o,participants:l,stage:xe,seedsCount:I,placeByes:c,drawSize:d,entries:f});if(v.error&&!v.conflicts)return v;v.positioningReport?.length&&m.push({[xe]:v.positioningReport});let w=v.structureId;return v.conflicts&&(h=v.conflicts),p===na&&t.roundsCount&&hEe({...t,drawDefinition:i,structureId:w}),{drawDefinition:i,positioningReports:m,conflicts:h,structureId:w}}function EEe(t){let{ignoreStageSpace:e,drawDefinition:i,drawEntries:r,drawType:n,entries:a}=t;for(let s of a){if(r&&s.entryStage&&s.entryStage!==xe)continue;let o={...s,ignoreStageSpace:e??n===na,entryStage:s.entryStage??xe,event:t.event,drawDefinition:i,drawType:n},l=wL(o);if(r&&l.error)return l}return{error:void 0}}var REe=()=>({matchUpType:void 0,drawName:void 0,drawId:void 0,structures:[],entries:[],links:[]}),CEe=REe;function MEe(t){let{drawId:e=Et(),processCodes:i,matchUpType:r,drawType:n}=t??{},a=CEe();return Object.assign(a,{processCodes:i,matchUpType:r,drawType:n,drawId:e})}function _0(t){let e=t.structureIds,{tournamentRecord:i,drawDefinition:r,matchUpFormat:n,structureId:a,matchUpId:s,event:o}=t,l=Ge(t,[{[mn]:!0,[TF]:!0}]);if(l.error)return l;if(!xa({matchUpFormat:n}))return{error:Mw};let u="setMatchUpFormat";if(s){let c=di({drawDefinition:r,matchUpId:s,event:o});if(c.error)return c;let d=c.matchUp;if(d?.matchUpType===rr)return{info:"Cannot set matchUpFormat when { matchUpType: TEAM }",error:ia};d&&(d.matchUpFormat=n,St({tournamentId:i?.tournamentId,eventId:o?.eventId,context:u,drawDefinition:r,matchUp:d}))}else if(Array.isArray(e)){if(o?.eventType===rr)return{error:Zl};for(let c of e){let d=et({drawDefinition:r,structureId:c});if(d.error)return d;d.structure&&(d.structure.matchUpFormat=n)}}else if(a){if(o?.eventType===rr)return{error:Zl};let c=et({drawDefinition:r,structureId:a});if(c.error)return c;c.structure&&(c.structure.matchUpFormat=n)}else r&&(r.matchUpFormat=n);return e=e??(a?[a]:void 0),ti({drawDefinition:r,structureIds:e}),{...H}}function NEe({tieFormat:t}){let e=Bn({checkCollectionIds:!1,tieFormat:t});if(e.error)return e;for(let i of t.collectionDefinitions)i.collectionId||(i.collectionId=Et());return{tieFormat:t}}function AEe({existingQualifyingStructures:t,tournamentRecord:e,drawDefinition:i,matchUpFormat:r,matchUpType:n,tieFormat:a,event:s}){if((r||a)&&!(r&&s?.matchUpFormat===r||s?.tieFormat&&a&&JSON.stringify(s.tieFormat)===JSON.stringify(a))){if(a){let o=NEe({tieFormat:a});if(o.error)return o;let l=t?.every(u=>u.tieFormat);(!t?.length||l)&&(i.tieFormat=o.tieFormat??a)}else if(r){let o=_0({tournamentRecord:e,drawDefinition:i,matchUpFormat:r,event:s});if(o.error)return{info:"matchUpFormat or tieFormat error",error:o.error}}n&&(i.matchUpType=n)}return{error:void 0}}var aX={};ct(aX,{attachPolicies:()=>kp,findPolicy:()=>sf,getAppliedPolicies:()=>Tt,getPolicyDefinitions:()=>Fc,mutate:()=>sX,query:()=>lX,removePolicy:()=>oX});var sX={};ct(sX,{attachPolicies:()=>kp,removePolicy:()=>oX});function oX(t){let e=Ge(t,[{[Zve]:!0,_anyOf:{[cn]:!1,[mr]:!1,[mn]:!1,[kc]:!1}}]);if(e.error)return e;let i,r=t.drawDefinition??t.event??((t.tournamentId||!t.tournamentRecords)&&t.tournamentRecord);if(r)return IW(t,r);if(t.tournamentRecords){let n=Object.keys(t.tournamentRecords);if(!n.length)return{error:Ie};for(let a of n){let s=t.tournamentRecords[a],o=IW(t,s);if(o.error)return o;i=!0}}else return{error:Ie};return i?{...H}:{error:Nw}}function IW(t,e){let i=Tt(t).appliedPolicies??{};return i[t.policyType]?(delete i[t.policyType],Object.keys(i).length?xt({element:e,extension:{name:wb,value:i}}):En({element:e,name:wb}),{...H}):{error:Nw}}var lX={};ct(lX,{findPolicy:()=>sf,getAppliedPolicies:()=>Tt,getPolicyDefinitions:()=>Fc});var kEe={[fo]:{validSeedPositions:{ignore:!0},duplicateSeedNumbers:!0,drawSizeProgression:!0,seedingProfile:{drawTypes:{[au]:{positioning:Dp},[Ks]:{positioning:Dp}},positioning:k5},policyName:"USTA SEEDING",seedsCountThresholds:[{drawSize:4,minimumParticipantCount:3,seedsCount:2},{drawSize:16,minimumParticipantCount:12,seedsCount:4},{drawSize:32,minimumParticipantCount:24,seedsCount:8},{drawSize:64,minimumParticipantCount:48,seedsCount:16},{drawSize:128,minimumParticipantCount:96,seedsCount:32},{drawSize:256,minimumParticipantCount:192,seedsCount:64}]}},LO=kEe;function OEe({appliedPolicies:t,policyDefinitions:e,drawDefinition:i,stack:r}){if(e&&typeof e!="object")return z({info:"policyDefinitions must be an object",result:{error:ie},stack:r});let n={[YD]:t?.[YD]};return e?xEe({policyDefinitions:e,appliedPolicies:t,policiesToAttach:n,drawDefinition:i}):n.avoidance&&kp({drawDefinition:i,policyDefinitions:n}),!t?.[fo]&&!e?.[fo]&&(kp({policyDefinitions:LO,drawDefinition:i}),t&&Object.assign(t,LO)),{error:void 0}}function xEe({policyDefinitions:t,appliedPolicies:e,policiesToAttach:i,drawDefinition:r}){for(let n of Object.keys(t))JSON.stringify(e?.[n])!==JSON.stringify(t[n])&&(i[n]=t[n]);Object.keys(i).length&&(kp({policyDefinitions:i,drawDefinition:r}),e&&Object.assign(e,i))}function FEe(t){let{tournamentRecord:e,policyDefinitions:i,appliedPolicies:r,matchUpFormat:n,matchUpType:a,tieFormat:s,drawType:o,stack:l,event:u}=t,c=t.drawId?u?.drawDefinitions?.find(I=>I.drawId===t.drawId):void 0,d=c?.structures?.find(I=>I.stage===xe&&I.stageSequence===1)?.structureId,p=c?c.structures?.filter(I=>I.stage===We):[],f=p?.length===1&&!p[0].matchUps?.length&&p[0].structureId;c&&o!==c.drawType&&(c.drawType=o);let m=c??MEe({processCodes:t.processCodes,drawId:t.drawId,drawType:o}),h=AEe({existingQualifyingStructures:p,tournamentRecord:e,drawDefinition:m,matchUpFormat:n,matchUpType:a,tieFormat:s,event:u});if(h.error)return z({result:h,stack:l});let g=OEe({appliedPolicies:r,policyDefinitions:i,drawDefinition:m,stack:l});return g.error?g:{drawDefinition:m,structureId:d,existingDrawDefinition:c,existingQualifyingPlaceholderStructureId:f}}function LEe(t){let e="generateOrGetExisting",i=[],r=[],n=FEe(t);if(n.error)return z({result:n,stack:e});let a=n.existingDrawDefinition,s,o,l=t.drawEntries??t.eventEntries??[],u=n.existingQualifyingPlaceholderStructureId&&uEe({...t,...n})||PEe({...t,...n,entries:l});return u.error?z({result:u,stack:e}):(u.positioningReports?.length&&i.push(...u.positioningReports??[]),u.conflicts?.length&&r.push(...u.conflicts??[]),s=u.drawDefinition,o=u.structureId,{existingDrawDefinition:a,positioningReports:i,drawDefinition:s,structureId:o,conflicts:r,entries:l})}function _Ee(t){let{qualifyingPlaceholder:e,existingDrawDefinition:i,positioningReports:r,qualifyingProfiles:n,appliedPolicies:a,qualifyingOnly:s,drawDefinition:o,seedingProfile:l,participants:u,structureId:c,tieFormat:d,entries:p,stack:f}=t,m=e&&!n?.length&&!i,h=[];if(n){let g=(y,b)=>y.stageSequence-b.stageSequence,I=(y,b)=>y.roundTarget-b.roundTarget,v=[],w=1;n.sort(I);for(let y of n){if(!Array.isArray(y.structureProfiles))return z({info:Ap("structureProfiles"),result:{error:Xe},stack:f});w=y.roundTarget||w;let b=y.structureProfiles?.sort(g)||[],S=1;for(let U of b){let{qualifyingRoundNumber:T,qualifyingPositions:P,seededParticipants:D,seedingScaleName:E,seedsCount:R=0,seedByRanking:C,placeByes:M,drawSize:N}=U,A=nX({...t,seedingProfile:U.seedingProfile??l,stageSequence:S,qualifyingRoundNumber:T,preparedStructureIds:v,qualifyingPositions:P,seededParticipants:D,stage:We,seedingScaleName:E,appliedPolicies:a,drawDefinition:o,qualifyingOnly:s,seedByRanking:C,participants:u,roundTarget:w,seedsCount:R,placeByes:M,drawSize:N,entries:p});if(A.error)return A;A.structureId&&v.push(A.structureId),S+=1,A.conflicts?.length&&h.push(...A.conflicts),A.positioningReport?.length&&r.push({[We]:A.positioningReport})}w+=1}}else if(c&&m){let g=ns({structureName:Xr(We),stage:We,qualifyingOnly:s,tieFormat:d}),{link:I}=vS({sourceStructureId:g.structureId,targetStructureId:c,sourceRoundNumber:0,linkType:iu});o.structures||(o.structures=[]),o.structures.push(g),o.links||(o.links=[]),o.links.push(I)}return{qualifyingConflicts:h,error:void 0}}var uX={};ct(uX,{addGoesTo:()=>Np,allCompetitionMatchUps:()=>Eo,allDrawMatchUps:()=>Rn,allEventMatchUps:()=>Ru,allPlayoffPositionsFilled:()=>LL,allTournamentMatchUps:()=>br,analyzeDraws:()=>TS,analyzeMatchUp:()=>Nb,analyzeTournament:()=>Y0,bulkUpdatePublishedEventIds:()=>Q0,calculateWinCriteria:()=>Ph,categoryCanContain:()=>Fw,checkMatchUpIsComplete:()=>mp,checkValidEntries:()=>tC,compareTieFormats:()=>Ic,competitionScheduleMatchUps:()=>kS,courtGridRows:()=>UC,credits:()=>$Ee,drawMatchUps:()=>p_,eventMatchUps:()=>PC,filterMatchUps:()=>Hu,filterParticipants:()=>pS,findDrawDefinition:()=>a0,findExtension:()=>mt,findVenue:()=>Eu,getAggregateTeamResults:()=>q0,getAllDrawMatchUps:()=>Qi,getAllEventData:()=>Z0,getAllStructureMatchUps:()=>Nt,getAllowedDrawTypes:()=>hC,getAllowedMatchUpFormats:()=>H0,getAppliedPolicies:()=>Tt,getAssignedParticipantIds:()=>df,getAvailableMatchUpsCount:()=>QR,getAvailablePlayoffProfiles:()=>bS,getCategoryAgeDetails:()=>Tp,getCheckedInParticipantIds:()=>hh,getCompetitionDateRange:()=>IC,getCompetitionMatchUps:()=>Mb,getCompetitionParticipants:()=>$0,getCompetitionPenalties:()=>W0,getCompetitionVenues:()=>DS,getCourtInfo:()=>xR,getCourts:()=>f_,getDrawData:()=>ZR,getDrawDefinitionTimeItem:()=>eL,getDrawParticipantRepresentativeIds:()=>r0,getDrawStructures:()=>Js,getDrawTypeCoercion:()=>ES,getEligibleVoluntaryConsolationParticipants:()=>i0,getEntriesAndSeedsCount:()=>TC,getEvent:()=>g_,getEventData:()=>PS,getEventMatchUpFormatTiming:()=>r_,getEventProperties:()=>m_,getEventPublishStatus:()=>za,getEventStructures:()=>GR,getEventTimeItem:()=>Kw,getEvents:()=>h_,getFlightProfile:()=>$i,getHomeParticipantId:()=>o_,getLinkedTournamentIds:()=>Ww,getMatchUpCompetitiveProfile:()=>nS,getMatchUpContextIds:()=>l_,getMatchUpDailyLimits:()=>RC,getMatchUpDailyLimitsUpdate:()=>n_,getMatchUpDependencies:()=>oo,getMatchUpFormat:()=>u_,getMatchUpFormatTiming:()=>aS,getMatchUpFormatTimingUpdate:()=>i_,getMatchUpScheduleDetails:()=>FR,getMatchUpType:()=>LR,getMatchUpsMap:()=>kr,getMatchUpsStats:()=>c_,getMatchUpsToSchedule:()=>yC,getMaxEntryPosition:()=>t_,getModifiedMatchUpFormatTiming:()=>DC,getPairedParticipant:()=>Qs,getParticipantEventDetails:()=>B0,getParticipantIdFinishingPositions:()=>n0,getParticipantMembership:()=>V0,getParticipantResults:()=>cS,getParticipantScaleItem:()=>Am,getParticipantSchedules:()=>j0,getParticipantSignInStatus:()=>G0,getParticipantTimeItem:()=>tL,getParticipants:()=>Ei,getPersonRequests:()=>pf,getPolicyDefinitions:()=>Fc,getPositionAssignments:()=>cI,getPositionsPlayedOff:()=>gv,getPredictiveAccuracy:()=>s_,getProfileRounds:()=>SC,getPublishState:()=>vh,getRandomQualifierList:()=>l0,getRoundMatchUps:()=>bn,getRounds:()=>d_,getScaleValues:()=>av,getScaledEntries:()=>Dh,getScheduledRoundsDetails:()=>MS,getSchedulingProfile:()=>$c,getSchedulingProfileIssues:()=>e_,getSeedingThresholds:()=>NL,getSeedsCount:()=>RS,getStructureSeedAssignments:()=>ds,getTeamLineUp:()=>Mp,getTieFormat:()=>vC,getTimeItem:()=>vs,getTournamentIds:()=>Gw,getTournamentInfo:()=>Th,getTournamentPenalties:()=>gC,getTournamentPersons:()=>z0,getTournamentPoints:()=>vv,getTournamentPublishStatus:()=>dS,getTournamentStructures:()=>FL,getTournamentTimeItem:()=>CR,getValidGroupSizes:()=>hS,getVenueData:()=>oI,getVenuesAndCourts:()=>Cu,isAdHoc:()=>Vn,isCompletedStructure:()=>uu,isValidForQualifying:()=>u0,isValidMatchUpFormat:()=>xa,matchUpActions:()=>eC,participantScaleItem:()=>Hl,participantScheduledMatchUps:()=>a_,positionActions:()=>o0,publicFindCourt:()=>pL,publicFindVenue:()=>dL,tallyParticipantResults:()=>Ih,tieFormatGenderValidityCheck:()=>nR,tournamentMatchUps:()=>EC,validMatchUp:()=>MR,validMatchUps:()=>Ga,validateCollectionDefinition:()=>Lw,validateLineUp:()=>jR});function $Ee(){return`
    This project would not have been possible without the generous input and patience
    of tournament organizers and directors who worked with early versions of CourtHive/TMX.

    Thanks to Miro, Pavel, Ivan, Mladen, Zdenko, Antonia, Jakov, Kreso, Barry, Jeff, Bobby... to name just a few. 

    The project would not have even begun without the support of Miro, or the introduction by Sretchko.
    The project would not have succeeded without the enthusiasm of Randy and Bruce.
    Thanks to serendipity and Luca and the ensuing TODS conversations with ITF.
    Thanks to Scott and Jake for sanity checks, suggestions, and camaraderie.
    Thanks to Zoran for inspiring the async support and getting into the weeds with subscriptions.
    Thanks to Dave for backing the conversion of TMX 1.x source into the factory repository.
    Thanks to Vuk and Pavle and Rich and Chris and Deepa for the direct engagement with the APIs.
    Thanks to Joe for repeatedly challenging me and the many pointers to useful tooling.
    Thanks to Shannon for the validation of the approach from his deep domain experience.
    Thanks to Nikola for the ongoing camaraderie and explorations of what we can do with TODS.

    And a special thanks to my family for putting up with the long days and weeks and months of coding
    and conversations at all hours.
  `}var cX={};ct(cX,{filterParticipants:()=>pS,getCompetitionParticipants:()=>$0,getPairedParticipant:()=>Qs,getParticipantEventDetails:()=>B0,getParticipantMembership:()=>V0,getParticipantScaleItem:()=>Am,getParticipantSchedules:()=>j0,getParticipantSignInStatus:()=>G0,getParticipantTimeItem:()=>tL,getParticipants:()=>Ei,getScaleValues:()=>av,participantScaleItem:()=>Hl,validateLineUp:()=>jR});function $0(t){let{tournamentRecords:e}=t||{};if(typeof e!="object"||!Object.keys(e).length)return{error:Ci};let i=[],r={},n={},a={},s=[],o={},l=[];for(let u of Object.values(e)){let{participantIdsWithConflicts:c,mappedMatchUps:d,participantMap:p,participants:f,matchUps:m,derivedEventInfo:h,derivedDrawInfo:g}=Ei({...t,tournamentRecord:u});Object.assign(o,d),Object.assign(r,p),Object.assign(n,h),Object.assign(a,g),i.push(...f??[]),s.push(...m??[]),c?.forEach(I=>{l.includes(I)||l.push(I)})}return{participantIdsWithConflicts:l,derivedEventInfo:n,derivedDrawInfo:a,participantMap:r,mappedMatchUps:o,participants:i,...H,matchUps:s}}function B0({tournamentRecord:t,participantId:e}){if(!t)return{error:Ie};if(!e)return{error:lr};let i=[e].concat((t.participants??[]).filter(r=>r?.participantType&&[Lt,pt].includes(r.participantType)&&r.individualParticipantIds?.includes(e)).map(r=>r.participantId));return{eventDetails:(t.events??[]).filter(r=>{let n=(r?.entries??[]).map(a=>a.participantId);return kn(n,i)}).map(r=>({eventName:r.eventName,eventId:r.eventId}))}}function V0({tournamentRecord:t,participantId:e}){if(!t)return{error:Ie};if(!e)return{error:lr};let{participants:i}=Ei({participantFilters:{participantTypes:[Lt,pt,ja]},tournamentRecord:t});return(i??[]).filter(r=>r.individualParticipantIds?.includes(e)).reduce((r,n)=>{let a=n.participantType;return a&&(r[a]||(r[a]=[]),r[a].push(n)),r},{})}function j0({participantFilters:t={},tournamentRecord:e}){if(!e)return{error:Ie};if(typeof t!="object")return{error:Ac,context:{participantFilters:t}};let i={eventIds:t.eventIds},r=br({tournamentRecord:e,contextFilters:i}).matchUps??[],n=Object.assign({},...r.map(l=>({[l.matchUpId]:l}))),a=r.filter(({schedule:l})=>l&&Object.keys(l).length),s=oo({tournamentRecord:e,matchUps:r}).sourceMatchUpIds??[],o={};for(let l of a){let{sides:u}=l,c,d=u?.map(f=>{if(f.participant)return[f.participant].concat(...f.participant.individualParticipants||[]);s[l.matchUpId]&&!c&&(c=(s[l.matchUpId]||[]).map(m=>n[m]).filter(({winningSide:m,bye:h})=>!m&&!h))}).filter(Boolean).flat()??[];for(let f of d){let{participantId:m}=f;o[m]||(o[m]={potentialMatchUps:[],participant:f,matchUps:[]}),o[m].matchUps.push(l)}let p=c?.map(({sides:f})=>f).flat().map(({participant:f})=>f&&[f].concat(...f.individualParticipants||[])).filter(Boolean).flat()||[];for(let f of p){let{participantId:m}=f;o[m]||(o[m]={potentialMatchUps:[],participant:f,matchUps:[]}),o[m].potentialMatchUps.push(l)}}return{participantSchedules:Object.values(o).filter(({participant:l})=>!(t.participantIds&&!t.participantIds.includes(l.participantId)||t.participantTypes&&!t.participantTypes.includes(l.participantType))),...H}}function G0({tournamentRecord:t,participantId:e}){if(!t)return{error:Ie};if(!e)return{error:lr};let{participant:i}=$d({tournamentRecord:t,participantId:e});if(!i)return{error:Vi};let{timeItem:r}=vs({itemType:Yw,element:i});return r&&r.itemValue===Ub&&Ub}var dX={};ct(dX,{analyzeDraws:()=>TS,analyzeTournament:()=>Y0,getAggregateTeamResults:()=>q0,getAllowedDrawTypes:()=>hC,getAllowedMatchUpFormats:()=>H0,getAppliedPolicies:()=>Tt,getCompetitionDateRange:()=>IC,getCompetitionPenalties:()=>W0,getPolicyDefinitions:()=>Fc,getTournamentInfo:()=>Th,getTournamentPenalties:()=>gC,getTournamentPersons:()=>z0,getTournamentPoints:()=>vv,getTournamentStructures:()=>FL,getTournamentTimeItem:()=>CR});function H0({tournamentRecord:t,categoryName:e,categoryType:i}){if(!t)return{error:Ie};let{appliedPolicies:r}=Tt({tournamentRecord:t});return(r?.[Po]?.matchUpFormats||[]).filter(({categoryNames:n,categoryTypes:a})=>!e&&!a||e&&n?.includes(e)||i&&a?.includes(i))}function hC({tournamentRecord:t,categoryName:e,categoryType:i}){if(!t)return{error:Ie};let{appliedPolicies:r}=Tt({tournamentRecord:t});return(r?.[KD]?.allowedDrawTypes||[]).filter(({categoryNames:n,categoryTypes:a})=>!e&&!a||e&&n?.includes(e)||i&&a?.includes(i))}function gC({tournamentRecord:t}){if(!t)return{error:Ie};let e=(t?.participants??[]).reduce((i,r)=>{let{participantId:n}=r;return(r.penalties??[]).forEach(a=>{let{penaltyId:s}=a||{};i[s]?i[s].participants.push(n):i[s]={...a,participantIds:[n]}}),i},{});return{penalties:Object.values(e)}}function W0({tournamentRecords:t}){if(typeof t!="object"||!Object.keys(t).length)return{error:Ci};let e=[];for(let i of Object.values(t)){let{penalties:r}=gC({tournamentRecord:i});e.push(...r??[])}return{penalties:e}}function IC({tournamentRecords:t}){if(!bt(t))return{error:Ci};let e=Object.keys(t??{}).reduce((n,a)=>{let s=t[a],{tournamentInfo:{startDate:o,endDate:l}}=Th({tournamentRecord:s}),u=o&&Qe(o),c=u&&new Date(u);(!n.startDate||c&&c<n.startDate)&&(n.startDate=c);let d=l&&Qe(l),p=d&&new Date(d);return(!n.endDate||p&&p>n.endDate)&&(n.endDate=p),n},{startDate:void 0,endDate:void 0}),i=e.startDate&&Qe(e.startDate.toISOString()),r=e.endDate&&Qe(e.endDate.toISOString());return!i||!r?{error:V6}:{startDate:i,endDate:r}}function z0({tournamentRecord:t,participantFilters:e}){if(!t)return{error:Ie};let i=t.participants||[];e&&(i=pS({participants:i,participantFilters:e,tournamentRecord:t}));let r={},n=a=>{if(a.person){let{personId:s}=a.person;r[s]?r[s].participantIds.push(a.participantId):r[s]={...a.person,participantIds:[a.participantId]}}};return i.forEach(a=>{a.person&&n(a)}),{tournamentPersons:Object.values(r)}}function q0(t){let e=Ge(t,[{[mr]:!0}]);if(e.error)return e;let i=t.finishingPositionRangeBounsPoints||{},r={},n=d=>{let p=d?.individualParticipants?.map(f=>f.teams?.length===1&&f.teams[0]);return d?.teams?.length===1&&d?.teams?.[0]||p?.[0].participantId===p?.[1].participantId&&p?.[0]},{matchUps:a,participants:s}=Ei({participantFilters:{participantTypes:[gt]},withRankingProfile:!0,withStatistics:!0,...t});for(let d of s??[]){if(d.participantType===_n)continue;d.draws?.[0]?.drawId==="draw-0-3"&&console.log(d.participantType,d.draws[0].finishingPositionRange);let p=n(d);if(p)for(let f of d?.draws??[]){let m=f?.finishingPositionRange?.join("-");if(m&&i?.[m]){let h=p?.participantId,g=f?.drawId,I=`${h}|${g}|${m}`;r[I]=i[m]}}}let o=d=>({teamName:d,standingPoints:0,pointsPlayed:0,pointsPct:0,points:0,bonus:0,diff:0,loss:0,win:0}),l=(d,p,f)=>{d[p]===void 0&&(d[p]=0),d[p]+=f},u={},c={};for(let d of a??[]){let{sides:p,matchUpFormat:f}=d,m=f&&zi(f);if(p?.length===2&&m.setFormat?.timed&&(!m.finalSetFormat||m.finalSetFormat?.timed))for(let h of p){let g=n(h.participant),I=g?.participantId,v=h.participant?.participantId,w=g?.participantName,y=h.sideNumber,b=h.participant?.individualParticipantIds||v&&[v]||[];if(b.forEach(S=>{S&&!u[S]&&(u[S]=o(w))}),I&&y){c[I]||(c[I]=o(w));let S=[...b.map(T=>u[T]),c[I]];d.winningSide&&(y===d.winningSide?S.forEach(T=>l(T,"win",1)):S.forEach(T=>l(T,"loss",1)));let U=d.score?.sets||[];for(let T of U){let P=T?.[`side${3-y}Score`]||0,D=T?.[`side${y}Score`]||0,E=D-P;S.forEach(R=>l(R,"pointsPlayed",D+P)),S.forEach(R=>l(R,"points",D)),S.forEach(R=>l(R,"diff",E))}}}}for(let d of Object.keys(r)){let[p]=d.split("|");c[p]&&(c[p].bonus+=r[d],c[p].pointsPct=parseFloat((c[p].points/c[p].pointsPlayed).toFixed(2)),c[p].standingPoints=c[p].win+c[p].bonus)}for(let d of Object.keys(u))u[d].pointsPct=parseFloat((u[d].points/u[d].pointsPlayed).toFixed(2));return{...H,individualResults:u,teamResults:c}}function BEe(t){let e=t.participants?.filter(({participantType:a})=>a===Lt)?.length===2,i=t.events?.length===1&&t.events[0],r=i?.drawDefinitions?.length===1&&i.drawDefinitions[0],n=(r?.structures?.length===1&&r.structures[0])?.positionAssignments?.length===2;return!!(i.tieFormat&&e&&n)}function Y0({tournamentRecord:t}){if(!t)return{error:Ie};let{drawsAnalysis:e}=TS({tournamentRecord:t}),i={isDual:BEe(t),drawsAnalysis:e},r=Ei({tournamentRecord:t});return r.missingParticipantIds?.length&&(i.missingParticipantIds=r.missingParticipantIds),{...H,analysis:i}}function Ng(t,e){return t&&e&&Array.isArray(e)&&e[t-1]||typeof e=="object"&&e[t]}function K0({qualityWinProfiles:t,wonMatchUpIds:e,mappedMatchUps:i,participantSideMap:r,tournamentParticipants:n,tournamentStartDate:a,level:s}){let o=0,l=[],u={};for(let c of n)u[c.participantId]=c;for(let c of t){let{rankingScaleName:d,rankingSnapshot:p="latestAvailable",includeWalkovers:f=!1,rankingRanges:m=[],maxBonusPerTournament:h,unrankedOpponentBehavior:g="noBonus"}=c,I=0;for(let v of e){let w=i[v];if(!w)continue;let{matchUpStatus:y,sides:b=[],winningSide:S}=w;if(!f&&(y===mi||y===Qt))continue;let U=r[v];if(!U||S!==U)continue;let T=b.find(R=>R.sideNumber!==U)?.participantId;if(!T)continue;let P=u[T];if(!P)continue;let D=VEe({participant:P,rankingScaleName:d,rankingSnapshot:p,tournamentStartDate:a});if(!D){if(g==="noBonus")continue;continue}let E=m.find(R=>D>=R.rankRange[0]&&D<=R.rankRange[1]);if(E){let R;if(typeof E.value=="number")R=E.value;else if(typeof E.value=="object"){let C=Ng(s,E.value.level??E.value);typeof C=="number"&&(R=C)}R&&(I+=R,l.push({opponentParticipantId:T,opponentRank:D,points:R,matchUpId:v}))}}h!==void 0&&I>h&&(I=h),o+=I}return{qualityWinPoints:o,qualityWins:l}}function VEe({participant:t,rankingScaleName:e,rankingSnapshot:i,tournamentStartDate:r}){let n=(t.timeItems||[]).filter(o=>{if(!o?.itemType)return!1;let l=o.itemType.split(".");return l[0]===pd&&l[1]===ou&&l[3]===e});if(!n.length)return;let a=n;if(i==="tournamentStart"&&r){let o=new Date(r).getTime();a=n.filter(l=>(l.itemDate?new Date(l.itemDate).getTime():0)<=o)}if(!a.length)return;a.sort((o,l)=>(o.createdAt?new Date(o.createdAt).getTime():0)-(l.createdAt?new Date(l.createdAt).getTime():0));let s=a[a.length-1]?.itemValue;return typeof s=="number"?s:void 0}var jEe="RANKING_POINTS",GEe="QUALITY_WIN",HEe="fullToEach",pX="splitEven",WEe="teamOnly",fX=["ageCategoryCodes","genders","categoryNames","categoryTypes","ratingTypes","ballTypes","wheelchairClasses","subTypes"],mX=["eventTypes","drawTypes","drawSizes","maxDrawSize","stages","stageSequences","levels","maxLevel","flights","maxFlightNumber","participationOrder","dateRanges"],zEe={RANKING_POINTS:jEe,QUALITY_WIN:GEe,FULL_TO_EACH:HEe,SPLIT_EVEN:pX,TEAM_ONLY:WEe,CATEGORY_SCOPE_FIELDS:fX,PROFILE_SCOPE_FIELDS:mX};function X0(t){let{participation:e={},awardProfiles:i,wheelchairClass:r,startDate:n,eventType:a,drawSize:s,drawType:o,category:l,endDate:u,gender:c,level:d}=t,{participationOrder:p,flightNumber:f,rankingStage:m}=e,h=b=>!n&&!u||!b.dateRanges?!0:b.dateRanges.some(S=>{let U=!n||!S.startDate||new Date(n)>new Date(S.startDate),T=!u||!S.endDate||new Date(u)<=new Date(S.endDate);return U&&T}),g=b=>{if(!b)return!0;let S=l||{};return!(b.ageCategoryCodes?.length&&!b.ageCategoryCodes.includes(S.ageCategoryCode)||b.genders?.length&&!b.genders.includes(c)||b.categoryNames?.length&&!b.categoryNames.includes(S.categoryName)||b.categoryTypes?.length&&!b.categoryTypes.includes(S.type)||b.ratingTypes?.length&&!b.ratingTypes.includes(S.ratingType)||b.ballTypes?.length&&!b.ballTypes.includes(S.ballType)||b.wheelchairClasses?.length&&!b.wheelchairClasses.includes(r)||b.subTypes?.length&&!b.subTypes.includes(S.subType))},I=b=>h(b)&&(!b.maxFlightNumber||f<=b.maxFlightNumber)&&(!b.drawTypes?.length||b.drawTypes?.includes(o))&&(!b.drawSizes?.length||b.drawSizes.includes(s))&&(!b.stages?.length||b.stages.includes(m))&&(!b.levels?.length||b.levels.includes(d))&&(!b.maxDrawSize||s<=b.maxDrawSize)&&(!b.drawSize||b.drawSize===s)&&(!b.maxLevel||d<=b.maxLevel)&&(!f||!b.flights?.flightNumbers?.length||b.flights.flightNumbers.includes(f))&&(!b.participationOrder||b.participationOrder===p)&&g(b.category)&&(!b.eventTypes?.length||b.eventTypes?.includes(a)),v=i.filter(I);if(v.length===0)return{awardProfile:void 0};if(v.length===1)return{awardProfile:v[0]};let w=v.filter(b=>b.priority!==void 0);if(w.length){let b=Math.max(...w.map(S=>S.priority));return{awardProfile:w.find(S=>S.priority===b)}}let y=v.map((b,S)=>({profile:b,score:qEe(b),index:S}));return y.sort((b,S)=>S.score-b.score||b.index-S.index),{awardProfile:y[0].profile}}function qEe(t){let e=0;for(let i of mX){let r=t[i];if(r!=null){if(Array.isArray(r)&&r.length===0)continue;e+=1}}if(t.category)for(let i of fX){let r=t.category[i];Array.isArray(r)&&r.length>0&&(e+=1)}return e}function fP({participantWon:t,flightNumber:e,valueObj:i,drawSize:r,flights:n,level:a}){let s=(m,h)=>{if(m){if(Array.isArray(h)){let g=h.find(I=>I.flight===m||I.f===m);return g.value||g.v}if(typeof h=="object"){let g=h.flights||h.f;if(Array.isArray(g))return g[m-1]}}},o=(m,h)=>{let g=m?.value||m?.v||(ot(m)?m:0),I=Ng(a,m?.level);return{value:s(h,I)||ot(I)&&I||g}},l=0,u,c,d,p,f=t&&"won"||t===!1&&"lost"||void 0;if(Array.isArray(i)){let m=i.find(I=>I.drawSize===r||I.drawSizes?.includes(r)),h=i.find(I=>I.drawSize&&I.threshold&&r>I.drawSize),g=i.find(I=>!I.drawSize&&!I.drawSizes?.length);f!==void 0&&(m=m?.[f],h=h?.[f],g=g?.[f]),c=o(m,e).value,d=o(h,e).value,p=o(g,e).value,l=c||d||p,u=c&&m.requireWin||d&&h.requireWin||g?.requireWin}else if(typeof i=="object"){let m=i?.drawSizes?.[r],h=i;f!==void 0&&(m=m?.[f],h=h?.[f]),c=o(m,e).value,p=o(h,e).value,l=c||p,u=c?m.requireWin:h?.requireWin}else ot(i)&&f===void 0&&(l=i);return e&&n?.pct?.[e]&&(l=Math.round(l*n.pct[e])),{awardPoints:l,requireWin:u}}function vv({participantFilters:t,policyDefinitions:e,tournamentRecord:i,level:r}){if(!i)return{error:Ie};let n=ra(),{policyDefinitions:a}=Fc({policyTypes:[YT],tournamentRecord:i}),s=e?.[YT]??a?.[YT];if(!s)return{error:jE};let o=s.awardProfiles,l=s.requireWinFirstRound,u=s.requireWinForPoints,c=s.doublesAttribution,d=s.qualityWinProfiles,{participants:p,derivedEventInfo:f,derivedDrawInfo:m,mappedMatchUps:h}=Ei({withRankingProfile:!0,participantFilters:t,tournamentRecord:i}),g=p?.filter(S=>S.draws?.length),I={},v={};for(let S of i.participants||[])S.person?.personId&&(I[S.participantId]=S.person.personId),S.individualParticipantIds?.length&&(v[S.participantId]=S.individualParticipantIds);let w={},y={},b={};for(let S of g??[]){let{participantType:U,participantId:T,person:P,draws:D}=S;for(let E of D){let{drawId:R,structureParticipation:C,eventId:M}=E,N=f[M],A=m[R],O=A?.drawType,{category:k,eventType:F,gender:x,wheelchairClass:L}=N||{},$=E.startDate||N.startDate||i.startDate,V=E.endDate||N.endDate||i.endDate;if(F===ya&&U!==_n)continue;let _;if(o){let B=u,G=0,j=0,K=0,Y=0,X,Z,J=0,ae,te,ne;for(let le of C){let{finishingPositionRange:de,participationOrder:pe,participantWon:ge,flightNumber:Me,rankingStage:Pe,winCount:Be}=le;if(G+=Be||0,Array.isArray(de)&&de.length){let ce=Math.min(...de);(te===void 0||ce<te)&&(te=ce)}let fe=A?.drawSize,{awardProfile:Te}=X0({wheelchairClass:L,awardProfiles:o,participation:le,eventType:F,startDate:$,category:k,drawSize:fe,drawType:O,endDate:V,gender:x,level:r});if(Te){if(!fe)continue;if(Te.profileName&&(Z=Te.profileName),ne||(ne=Te),ae===void 0&&Te.maxCountableMatches!==void 0){let ee=Te.maxCountableMatches;if(typeof ee=="number")ae=ee;else if(typeof ee=="object"){let Se=Ng(r,ee.level??ee);typeof Se=="number"&&(ae=Se)}}let ce=Array.isArray(de)&&Math.max(...de),ye=rt(de||[]).join("-"),be=ce&&Pe!==We&&de?.includes(fe);Te.requireWinForPoints!==void 0&&(B=Te.requireWinForPoints),Te.requireWinFirstRound!==void 0&&(l=Te.requireWinFirstRound);let{finishingPositionPoints:Fe={},finishingPositionRanges:we,finishingRound:Ne,pointsPerWin:me,flights:Ee}=Te,Le=Array.isArray(Te.perWinPoints)?Te.perWinPoints?.find(ee=>ee.participationOrders?.includes(pe)):Te.perWinPoints,Q=Fe.participationOrders,se=0,oe;if((!Q||Q.includes(pe))&&we&&ce){let ee=we[ce];ee&&({awardPoints:se,requireWin:oe}=fP({flightNumber:Me,valueObj:ee,drawSize:fe,flights:Ee,level:r}))}if(!se&&Ne&&pe===1&&ce){let ee=Ne[ce];ee&&({awardPoints:se,requireWin:oe}=fP({participantWon:ge,flightNumber:Me,valueObj:ee,drawSize:fe,flights:Ee,level:r}))}be&&l!==void 0&&(B=l),oe!==void 0&&(B=oe),se>j&&(!B||Be)&&(j=se,X=ce,ne=Te);let ue=ae!==void 0?Math.min(Be||0,Math.max(0,ae-J)):Be;if(!se&&me&&ue&&(K+=ue*me,J+=ue,X=ye),!se&&Be&&Le){let ee=Ng(r,Le?.level);typeof ee=="number"?(K+=(ue||0)*ee,J+=ue||0):!ee&&Le.value&&(K+=(ue||0)*Le.value,J+=ue||0)}}if(U===_n&&Te){let ce=Array.isArray(Te.perWinPoints)?Te.perWinPoints?.find(be=>be.participationOrders?.includes(pe)):Te.perWinPoints,ye=ce&&Ng(r,ce.level);if(ye){let be=(S.matchUps||[]).filter(({structureId:Fe})=>Fe===le.structureId);for(let{matchUpId:Fe}of be){let we=h[Fe],Ne=we?.sides?.find(me=>me.participantId===T)?.sideNumber;if(!(!Ne||we.winningSide!==Ne))for(let me of we.tieMatchUps||[]){if(!me.winningSide)continue;let{collectionPosition:Ee}=me,Le;if(typeof ye=="object"&&ye.line){if(ye.limit&&Ee>ye.limit)continue;Le=ye.line[Ee-1]}else typeof ye=="number"&&(Le=ye);if(Le)for(let Q of me.sides||[]){if(Q.sideNumber!==me.winningSide)continue;let se=Q.participantId;if(!se)continue;let oe=v[se]||[se];for(let ue of oe){let ee=I[ue];ee&&(w[ee]||(w[ee]=[]),w[ee].push({linePoints:Le,collectionPosition:Ee,eventType:F,drawId:R}))}}}}}}}if(ne?.bonusPoints&&te!==void 0){for(let le of ne.bonusPoints)if(le.finishingPositions?.includes(te)){let de=le.value;if(typeof de=="number")Y=de;else if(typeof de=="object"){let pe=Ng(r,de.level??de);typeof pe=="number"&&(Y=pe)}break}}if(_=j+K+Y,K||j||Y){let le={winCount:G,positionPoints:j,rangeAccessor:X,perWinPoints:K,bonusPoints:Y,eventType:F,drawId:R,points:_,category:k,drawType:O,startDate:$,endDate:V,level:r};n&&Z&&(le.profileName=Z);let de=P?.personId;if(de)w[de]||(w[de]=[]),w[de].push(le);else if(U===pt){if(b[T]||(b[T]=[]),b[T].push(le),c){let pe=c===pX?.5:1,ge=v[T]||[];for(let Me of ge){let Pe=I[Me];if(!Pe)continue;let Be={...le,points:Math.round(le.points*pe),positionPoints:Math.round(le.positionPoints*pe),perWinPoints:Math.round(le.perWinPoints*pe),bonusPoints:Math.round(le.bonusPoints*pe),doublesParticipantId:T};w[Pe]||(w[Pe]=[]),w[Pe].push(Be)}}}else U===_n&&(y[T]||(y[T]=[]),y[T].push(le))}if(d?.length&&S.matchUps){let le=Object.values(S.matchUps).filter(de=>de.drawId===R&&de.participantWon);if(le.length){let de=le.map(Pe=>Pe.matchUpId),pe={};for(let Pe of le)pe[Pe.matchUpId]=Pe.sideNumber;let{qualityWinPoints:ge,qualityWins:Me}=K0({qualityWinProfiles:d,wonMatchUpIds:de,mappedMatchUps:h,participantSideMap:pe,tournamentParticipants:i.participants||[],tournamentStartDate:i.startDate,level:r});if(ge>0){let Pe=P?.personId;Pe&&(w[Pe]||(w[Pe]=[]),w[Pe].push({qualityWinPoints:ge,qualityWins:Me,eventType:F,drawId:R}))}}}}}}return{participantsWithOutcomes:g,personPoints:w,pairPoints:b,teamPoints:y,...H}}var hX={};ct(hX,{compareTieFormats:()=>Ic,getTieFormat:()=>vC,tieFormatGenderValidityCheck:()=>nR,validateCollectionDefinition:()=>Lw});function mP(t){if(!t)return{};let e=[],i=t.tieFormatName,r=t.collectionDefinitions?.map(n=>{let{matchUpType:a,matchUpFormat:s,matchUpCount:o,category:l,gender:u}=n;e.includes(s)||e.push(s);let c=l?.ageCategoryCode;return[o,a===Sp?"D":"S",c,s,u].join(";")}).join("|");return{tieFormatName:t&&i||"UNNAMED",matchUpFormats:e,tieFormatDesc:r}}function Ic({considerations:t={},descendant:e,ancestor:i}){let r={},n={},{matchUpFormats:a,tieFormatDesc:s}=mP(e),{matchUpFormats:o,tieFormatDesc:l}=mP(i),u=rt((a??[]).filter(b=>!(o??[]).includes(b)).concat((o??[]).filter(b=>!(a??[]).includes(b)))),c=!!(t?.collectionName&&e.collectionDefinitions.map(({collectionName:b})=>b).join("|")!==i.collectionDefinitions.map(({collectionName:b})=>b).join("|")),d=!!(t?.collectionOrder&&e.collectionDefinitions.map(({collectionOrder:b})=>b).join("|")!==i.collectionDefinitions.map(({collectionOrder:b})=>b).join("|")),p=Object.assign({},...(e?.collectionDefinitions||[]).map(b=>({[b.collectionId]:b}))),f=Object.assign({},...(i?.collectionDefinitions||[]).map(b=>({[b.collectionId]:b})));r.collectionIds=CH(Object.keys(p),Object.keys(f)),n.collectionIds=CH(Object.keys(f),Object.keys(p)),r.collectionsValue=vW(p),n.collectionsValue=vW(f),r.groupsCount=i?.collectionGroups?.length??(0-(e?.collectionGroups?.length??0)||0),n.groupsCount=r.groupsCount?-1*r.groupsCount:0;let m=r.collectionsValue.totalValue-n.collectionsValue.totalValue,h=r.collectionsValue.totalMatchUps-n.collectionsValue.totalMatchUps,g=n.collectionsValue.assignmentValues.length!==r.collectionsValue.assignmentValues.length,I=n.collectionsValue.assignmentValues.some((b,S)=>{let U=r.collectionsValue.assignmentValues[S];return!U||b.valueKey!==U.valueKey||b.value!==U.value?!0:Array.isArray(b.value)?b.value.every((T,P)=>U.value[P]===T):!1}),v=c||d||l!==s||g||I||m!==0,w=[...n.collectionsValue.invalidValues,...r.collectionsValue.invalidValues],y=w.length&&w;return{matchUpFormatDifferences:u,matchUpCountDifference:h,descendantDifferences:r,ancestorDifferences:n,orderDifference:d,valueDifference:m,nameDifference:c,descendantDesc:s,ancestorDesc:l,...H,different:v,invalid:y}}function vW(t){let e=[],i=[],r=0;return{totalValue:Object.keys(t).sort($R).reduce((n,a)=>{let s=t[a],{collectionValueProfiles:o,collectionValue:l,matchUpCount:u,matchUpValue:c,scoreValue:d,setValue:p}=s,f={collectionValueProfiles:o,collectionValue:l,matchUpValue:c,scoreValue:d,setValue:p},m=Object.keys(f).filter(g=>![void 0,null].includes(f[g])&&(!Array.isArray(f[g])||f[g].length>0));m.length!==1&&e.push({collectionId:a});let h=m[0];if(h){let g=h==="collectionValueProfiles"?Object.values(o):f[h];i.push({valueKey:h,value:g})}return r+=u,o?.length?n+o.reduce((g,I)=>g+I.value,0):u?ot(c)?n+c*u:ot(d)?n+d*u:ot(p)?n+p*u:n+l:n},0),totalMatchUps:r,invalidValues:e,assignmentValues:i}}function J0(t){Object.assign(t,{inContext:!0});let{matchUp:e,error:i}=gX(t);return{matchUp:ke(e,!0,!0),error:i}}function gX({participantsProfile:t,afterRecoveryTimes:e,tournamentRecord:i,contextContent:r,contextProfile:n,drawDefinition:a,nextMatchUps:s,matchUpId:o,inContext:l,eventId:u,drawId:c,event:d}){if(!i)return{error:Ie};if(typeof o!="string")return{error:Un};if(!a||!d){let m=(br({tournamentRecord:i,nextMatchUps:s}).matchUps??[]).find(h=>h.matchUpId===o);if(!m)return{error:un};({eventId:u,drawId:c}=m),{event:d,drawDefinition:a}=jn({tournamentRecord:i,eventId:u,drawId:c})}if(!a)return{error:Oa};n&&!r&&(r=Lc({tournamentRecord:i,contextProfile:n}));let p={surfaceCategory:d?.surfaceCategory??i.surfaceCategory,indoorOutDoor:d?.indoorOutdoor??i.indoorOutdoor,endDate:d?.endDate??i.endDate,tournamentId:i.tournamentId,eventId:u??d?.eventId,drawId:c},{participants:f=[]}=af({participantsProfile:t,tournamentRecord:i,contextProfile:n,inContext:l});if(s){let m=(Rn({context:l?p:void 0,participants:f,afterRecoveryTimes:e,contextContent:r,contextProfile:n,drawDefinition:a,nextMatchUps:s,inContext:l,event:d}).matchUps??[]).find(g=>g.matchUpId===o);if(!m)return{error:un};let h=a?.structures?.find(g=>g.structureId===m.structureId);return{drawDefinition:a,structure:h,matchUp:m}}else{let{matchUp:m,structure:h}=di({context:l?p:void 0,tournamentParticipants:f,afterRecoveryTimes:e,contextContent:r,drawDefinition:a,contextProfile:n,matchUpId:o,inContext:l,event:d});return{matchUp:m,structure:h,drawDefinition:a}}}function vC({tournamentRecord:t,drawDefinition:e,structureId:i,matchUpId:r,structure:n,eventId:a,drawId:s,event:o}){if(!t)return{error:Ie};if(!s&&!o&&!i&&!r)return z({result:{error:Xe},stack:"getTieFormat"});a&&!o&&(o=t.events?.find(f=>f.eventId===a));let l=J0({tournamentRecord:t,drawDefinition:e,matchUpId:r,drawId:s,event:o});if(r&&l?.error)return l;if(!e&&l?.drawDefinition&&(e=l?.drawDefinition),n=n??l?.structure,!n&&i&&!r){if(!e)return{error:Oo};let f=et({drawDefinition:e,structureId:i});if(f.error)return f;n=f.structure}let u=(n?.tieFormat||n?.tieFormatId)&&vn({structure:n,drawDefinition:e,event:o})?.tieFormat,c=(e?.tieFormat||e?.tieFormatId)&&vn({drawDefinition:e,event:o})?.tieFormat,d=vn({event:o})?.tieFormat,p=vn({matchUp:l?.matchUp,drawDefinition:e,structure:n,event:o})?.tieFormat;return{...H,matchUp:l?.matchUp,structureDefaultTieFormat:jr(u),eventDefaultTieFormat:jr(d),drawDefaultTieFormat:jr(c),tieFormat:jr(p),structure:n}}var IX={};ct(IX,{bulkUpdatePublishedEventIds:()=>Q0,getAllEventData:()=>Z0,getCourtInfo:()=>xR,getDrawData:()=>ZR,getEventData:()=>PS,getEventPublishStatus:()=>za,getPublishState:()=>vh,getTournamentPublishStatus:()=>dS,getVenueData:()=>oI});function Q0({tournamentRecord:t,outcomes:e}){if(!t)return{error:Ie};if(!e?.length)return{error:Xe,info:"Missing outcomes"};let i=e.reduce((n,a)=>{let{drawId:s,eventId:o}=a;return o&&s&&(n[o]?n[o].includes(s)||n[o].push(s):n[o]=[s]),n},{}),r=Object.keys(i);return{publishedEventIds:(t.events?.filter(n=>r.includes(n.eventId))).filter(n=>{let a=za({event:n}),{drawDetails:s,drawIds:o}=a??{},{eventId:l}=n;return i[l].filter(u=>{let c=s?Object.keys(a.drawDetails).filter(d=>bL({drawId:d,drawDetails:s})):[];return o?.includes(u)||c.includes(u)}).length}).map(n=>n.eventId),eventIdPublishedDrawIdsMap:i}}function Z0({tournamentRecord:t,policyDefinitions:e}){if(!t)return{error:Ie};let i=t.events||[],r=t?.participants||[],{tournamentInfo:n}=Th({tournamentRecord:t}),{venues:a}=Cu({tournamentRecord:t}),s=i.map(o=>{let{eventId:l}=o,u=$8({event:o}).eventInfo,c=Xw({tournamentRecord:t,event:o}).scheduleTiming,d=(o.drawDefinitions||[]).map(f=>{let{drawId:m,drawName:h,matchUpFormat:g,updatedAt:I}=f,v={drawId:m,drawName:h,matchUpFormat:g,updatedAt:I},{abandonedMatchUps:w,completedMatchUps:y,upcomingMatchUps:b,pendingMatchUps:S}=cv({requireParticipants:!0,tournamentParticipants:r,context:{eventId:l},policyDefinitions:e,tournamentRecord:t,inContext:!0,scheduleTiming:c,drawDefinition:f,event:o});return{drawInfo:v,matchUps:{abandonedMatchUps:w,completedMatchUps:y,upcomingMatchUps:b,pendingMatchUps:S}}}),p=za({event:o});return Object.assign(u,{drawsData:d,publish:p}),u});return{allEventData:{tournamentInfo:n,venuesData:a,eventsData:s}}}var vX={};ct(vX,{courtGridRows:()=>UC,findVenue:()=>Eu,getMatchUpsToSchedule:()=>yC,getPersonRequests:()=>pf,getProfileRounds:()=>SC,getScheduledRoundsDetails:()=>MS,getSchedulingProfile:()=>$c,getSchedulingProfileIssues:()=>e_,publicFindCourt:()=>pL});function pI({matchUpPotentialParticipantIds:t,matchUpNotBeforeTimes:e,timeAfterRecovery:i,matchUp:r}){let{individualParticipantIds:n}=ER(r);i=i??r.schedule?.timeAfterRecovery;let a=u=>{t[u]||(t[u]=[]),t[u]=rt(t[u].concat(...n))},s=u=>{i&&(!e[u]||i>e[u])&&(e[u]=i)},o=r.winnerTo?.matchUpId||r.winnerMatchUpId;o&&(i&&s(o),a(o));let l=r.loserTo?.matchUpId||r.loserMatchUpId;l&&(i&&s(l),a(l)),r.sidesTo?.length&&r.sidesTo.forEach(({matchUpId:u})=>{u&&(i&&s(u),a(u))})}function yC(t){let e=Ge(t,[{[EF]:!0}]);if(e.error)return e;let{matchUpPotentialParticipantIds:i,dateScheduledMatchUpIds:r=[],scheduleCompletedMatchUps:n,matchUpNotBeforeTimes:a,matchUpScheduleTimes:s,orderedMatchUpIds:o,clearDate:l,matchUps:u}=t,c=s?Object.keys(s):[],d=(o??[]).map(f=>u.find(m=>m.matchUpId===f)).filter(Boolean).filter(f=>{let m=!l&&(r.includes(f.matchUpId)||c.includes(f.matchUpId)),h=["BYE",Qt,ki,us,$r,mi,wi,Hi].includes(f?.matchUpStatus);return n||!m&&!f.winningSide&&!h}),p=i&&a?d.reduce((f,m)=>{let{drawId:h,tournamentId:g}=m;return f.matchUpMap[g]||(f.matchUpMap[g]={}),f.matchUpMap[g][h]?f.matchUpMap[g][h].push(m):f.matchUpMap[g][h]=[m],pI({matchUpPotentialParticipantIds:i,matchUpNotBeforeTimes:a,matchUp:m}),f},{matchUpMap:{}}).matchUpMap:{};return{matchUpsToSchedule:d,matchUpMap:p}}function bC({defaultRecoveryMinutes:t=0,defaultAverageMinutes:e,tournamentRecords:i,matchUpFormat:r,categoryName:n,categoryType:a,tournamentId:s,eventType:o,eventId:l}){if(!xa({matchUpFormat:r}))return{error:Mw};let u=Object.keys(i).filter(d=>!s||d===s),c;return u.forEach(d=>{if(c)return;let p=i[d],f=l?jn({tournamentRecord:p,eventId:l})?.event:void 0;return c=aS({tournamentRecord:p,matchUpFormat:r,categoryName:n,categoryType:a,eventType:o,event:f}),c?.averageMinutes||c?.recoveryMinutes}),{recoveryMinutes:c?.recoveryMinutes||t,averageMinutes:c?.averageMinutes||e,typeChangeRecoveryMinutes:c?.typeChangeRecoveryMinutes||c?.recoveryMinutes||t}}function MS(t){let e=Ge(t,[{[CF]:{tournamentRecords:!1,tournamentRecord:!1}},{rounds:!0,[zn]:an}]);if(e.error)return e;let{scheduleCompletedMatchUps:i,periodLength:r=30}=t,n=t.tournamentRecords||t.tournamentRecord&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord}||{};if(typeof n!="object")return{error:Ci};let a={},s=[],o=t.rounds.toSorted((m,h)=>(m.sortOrder??0)-(h.sortOrder??0)),l=t.containedStructureIds??Object.assign({},...Object.values(n).map(m=>lv({tournamentRecord:m}).containedStructures)),u=t.matchUps??Eo({nextMatchUps:!0,tournamentRecords:n}).matchUps,c=0,d={},p={},f={};return{scheduledRoundsDetails:o.flatMap(m=>{let h=m.periodLength||r,g=[];l?.[m.structureId]?g.push(...l[m.structureId]):g.push(m.structureId);let I=u?Hu({tournamentIds:[m.tournamentId],roundNumbers:[m.roundNumber],matchUpIds:m.matchUpIds,eventIds:[m.eventId],drawIds:[m.drawId],processContext:!0,structureIds:g,matchUps:u}).sort(gh):[],{segmentNumber:v,segmentsCount:w}=m.roundSegment||{};if(ot(v)&&Uo(I?.length)&&Uo(w)&&v>0&&v<=w&&w<I?.length&&!m.matchUpIds?.length){let U=I.length/w,T=U*(v-1);I=I.slice(T,T+U)}let y=n[m.tournamentId],b=jn({drawId:m.drawId,tournamentRecord:y}).event,S=[];for(let U of I){let T=U.matchUpFormat;T&&(a[T]||(a[T]=[],a[T].push(U)),S.push(T))}for(let U of S){let{eventType:T,category:P}=b??{},{categoryName:D,ageCategoryCode:E}=P??{},{typeChangeRecoveryMinutes:R,recoveryMinutes:C,averageMinutes:M,error:N}=bC({categoryName:D??E,categoryType:P?.categoryType,tournamentId:m.tournamentId,eventId:m.eventId,tournamentRecords:n,matchUpFormat:U,eventType:T});if(N)return{error:N,round:m};let A=I.filter(k=>(i||!Yi.includes(k.matchUpStatus))&&k.matchUpStatus!=="BYE").map(Ir);A.forEach(k=>{f[k]={typeChangeRecoveryMinutes:R,recoveryMinutes:C,averageMinutes:M},d[k]=C,p[k]=M}),s.push(...A),c=Math.max(M||0,c);let O=`${M}|${h}`;return{roundPeriodLength:h,recoveryMinutes:C,averageMinutes:M,matchUpIds:A,hash:O}}}),greatestAverageMinutes:c,matchUpFormatCohorts:a,recoveryMinutesMap:d,averageMinutesMap:p,orderedMatchUpIds:s,minutesMap:f,...H}}function yX({schedulingProfile:t,venueIds:e,eventIds:i,drawIds:r}){let n=[],a=t?.map(o=>{let l=Qe(o?.scheduleDate);if(!l){n.push(`Invalid date: ${o?.scheduledDate}`);return}let u=(o?.venues||[]).map(c=>{let{rounds:d,venueId:p}=c;if(!e?.includes(p)){n.push(`Missing venueId: ${p}`);return}let f=d.filter(m=>{let h=i.includes(m.eventId)&&r.includes(m.drawId);return h||n.push(`Invalid eventId: ${m.eventId} or drawId: ${m.drawId}`),h});if(f.length)return{venueId:p,rounds:f}}).filter(Boolean);return u.length&&l&&{...o,venues:u}}).filter(Boolean),s=n.length;return{updatedSchedulingProfile:a,modifications:s,issues:n}}function wC({tournamentRecords:t,schedulingProfile:e}){if(!e)return{valid:!0};if(!Array.isArray(e))return{valid:!1,error:ie};let{venueIds:i,tournamentsMap:r}=KEe({tournamentRecords:t}),n,a,s=e.every(o=>{let{scheduleDate:l,venues:u}=o;return Pn(l)?u.every(c=>{let{venueId:d,rounds:p}=c;return typeof d!="string"?(a="venueId should be a string",!1):Array.isArray(p)?i.includes(d)?!!p.every(f=>{if(!f)return a="empty round",!1;let{roundSegment:m,tournamentId:h,structureId:g,roundNumber:I,eventId:v,drawId:w}=f,y=r?.[h]?.[v]?.[w]?.[g]?.includes(I);y||(a="Invalid rounds");let{segmentNumber:b,segmentsCount:S}=m||{},U=!m||ot(b)&&Uo(S)&&b<=S;return U||(a="Invalid segment"),y&&U}):(n=tf,!1):(a="rounds should be an array",!1)}):!1});return!s&&!n&&(n=ie),{valid:!!s,error:n,info:a}}function YEe(t){let{tournamentRecord:e={},tournamentMap:i={},requireCourts:r}=t,n=[],a=[],s=[],o=[],l=(e?.venues||[]).map(({venueId:c,courts:d})=>(!r||d?.length)&&c),u=e?.tournamentId;if(u){n.push(u),i[u]={};let c=e?.events||[];for(let d of c){let p=d.eventId;s.push(p),i[u][p]={};let f=m=>parseInt(m);for(let m of d.drawDefinitions||[]){let h=m.drawId;o.push(h),i[u][p][h]={};let{structures:g}=Js({drawDefinition:m});for(let I of g||[]){let v=I.structureId,{matchUps:w}=Nt({structure:I}),{roundMatchUps:y}=bn({matchUps:w}),b=y&&Object.keys(y).map(f);if(i[u][p][h][v]=b,a.push(v),I.structures?.length)for(let S of I.structures)a.push(S.structureId),i[u][p][h][S.structureId]=b}}}}return{tournamentMap:i,tournamentIds:n,structureIds:a,venueIds:l,eventIds:s,drawIds:o}}function KEe(t){let e=t?.tournamentRecords&&Object.values(t?.tournamentRecords)||[],i={},{venueIds:r,eventIds:n,drawIds:a,structureIds:s,tournamentIds:o}=e.reduce((l,u)=>{let{tournamentIds:c,tournamentMap:d,structureIds:p,venueIds:f,eventIds:m,drawIds:h}=YEe({tournamentRecord:u});return f.forEach(g=>{l.venueIds.includes(g)||l.venueIds.push(g)}),l.tournamentIds.push(...c),l.structureIds.push(...p),l.eventIds.push(...m),l.drawIds.push(...h),Object.assign(i,d),l},{tournamentIds:[],structureIds:[],venueIds:[],eventIds:[],drawIds:[]});return{tournamentsMap:i,tournamentIds:o,structureIds:s,venueIds:r,eventIds:n,drawIds:a}}function $c({tournamentRecords:t,tournamentRecord:e}){if(typeof t!="object"||!Object.keys(t).length)return{error:Ci};let{extension:i}=mt({element:e,name:Mm,tournamentRecords:t,discover:!0}),r=i?.value||[];if(r.length){let{venueIds:n}=DS({requireCourts:!0,tournamentRecords:t}),{eventIds:a,drawIds:s}=JL({tournamentRecords:t}),{updatedSchedulingProfile:o,modifications:l,issues:u}=yX({schedulingProfile:r,venueIds:n,eventIds:a,drawIds:s});if(l){r=o;let c=yv({tournamentRecords:t,tournamentRecord:e,schedulingProfile:r});return c.error?c:{schedulingProfile:r,modifications:l,issues:u}}}return{schedulingProfile:r,modifications:0}}function yv({tournamentRecords:t,tournamentRecord:e,schedulingProfile:i}){let r=wC({tournamentRecords:t,schedulingProfile:i});return r.error?r:i?xt({tournamentRecords:t,discover:!0,extension:{name:Mm,value:i}}):En({element:e,name:Mm,tournamentRecords:t,discover:!0})}function NS(t){let{tournamentRecord:e}=t,i=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(!t.schedulingProfile){let{modifications:u,issues:c}=$c({tournamentRecords:i,tournamentRecord:e});return{success:!u,modifications:u,issues:c}}let{venueIds:r}=DS({tournamentRecords:i}),{eventIds:n,drawIds:a}=JL({tournamentRecords:i}),{updatedSchedulingProfile:s,modifications:o,issues:l}=yX({schedulingProfile:t.schedulingProfile,venueIds:r,eventIds:n,drawIds:a});return o?{...yv({schedulingProfile:s,tournamentRecords:i}),modifications:o,issues:l}:{...H,modifications:o,issues:l}}function e_(t){let{scheduleDates:e=[],tournamentRecords:i,periodLength:r=30}=t??{};if(typeof i!="object")return{error:Pw};if(!Array.isArray(e))return{error:ie};if(!e.every(Pn))return{error:sr};let n=[],a=0,s={},{schedulingProfile:o}=$c({tournamentRecords:i});if(!o)return{issues:n,...H};let{matchUps:l}=Eo({nextMatchUps:!0,tournamentRecords:i});for(let c of o){let{scheduleDate:d,venues:p=[]}=c;if(!e?.length||e.includes(d)){for(let f of p||[])if(f){let{rounds:m}=f,h=[],{orderedMatchUpIds:g,scheduledRoundsDetails:I}=MS({tournamentRecords:i,periodLength:r,matchUps:l,rounds:m}),{matchUpDependencies:v}=oo({tournamentRecords:i,matchUps:l}),w=y=>{let b;return I?.find((S,U)=>{let T=S.matchUpIds.includes(y);return T&&(b=U),T}),b};if(g?.forEach((y,b)=>{let S=g.slice(b+1),U=xi(S,v?.[y]?.matchUpIds||[]);U.length&&h.push({matchUpId:y,shouldBeAfter:U})}),h.length){a+=h.length;let y=h.map(({matchUpId:b,shouldBeAfter:S})=>{let U=w(b),T=rt(S.map(w));return s[d]||(s[d]={}),s[d][U]||(s[d][U]=[]),T.forEach(P=>{s[d][U].includes(P)||s[d][U].push(P)}),{matchUpId:b,matchUpRoundIndex:U,earlierRoundIndices:T,shouldBeAfter:S}});n.push(...y)}}}}let u={matchUpIdShouldBeAfter:Object.assign({},...n.map(c=>{let{matchUpId:d,shouldBeAfter:p,earlierRoundIndices:f}=c;return{[d]:{earlierRoundIndices:f,shouldBeAfter:p}}}))};return{issuesCount:a,profileIssues:u,roundIndexShouldBeAfter:s,...H}}function pf(t){let{tournamentRecords:e,requestType:i}=t,r=Ge(t,[{[cn]:!0}]);if(r.error)return r;let n={};for(let a of Object.values(e)){let{extension:s}=mt({element:a,name:sv}),o=s?.value||[];for(let l of o){let{personId:u,requests:c}=l||{};n[u]||(n[u]=[]);for(let d of c)i&&d.requestType!==i||n[u].push(d)}}return{personRequests:n,...H}}function _O(t){let{containerStructureId:e,roundSegment:i,isRoundRobin:r,tournamentId:n,roundNumber:a,structureId:s,eventId:o,drawId:l}=t,u=r?e:s,c=[n,o,l,u,a].join("|");return Ve({structureId:u,roundSegment:i,tournamentId:n,roundNumber:a,eventId:o,drawId:l,id:c})}function yW({round:t,matchUps:e,events:i,tournamentRecords:r}){let n=i.find(p=>p.eventId===t.eventId),{eventType:a,category:s,categoryType:o}=n||{},{categoryName:l,ageCategoryCode:u}=s||{},c=va(e.map(({matchUpFormat:p})=>p)),d=0;return Object.keys(c).forEach(p=>{let f=c[p],m=bC({categoryName:l||u,tournamentId:t.tournamentId,eventId:t.eventId,tournamentRecords:r,matchUpFormat:p,categoryType:o,eventType:a});if(m.error)return m;let h=m.averageMinutes*f;isNaN(d)||(d+=h)}),{roundMinutes:d}}function XEe(t){return(t||[]).reduce((e,i)=>{let r=(i.finishingPositionRange?.winner||[]).reduce((a,s)=>a+s,0),n=(i.finishingPositionRange?.winner||[]).join("-")||"";return!e.minFinishingSum||r<e.minFinishingSum?{minFinishingSum:r,winnerFinishingPositionRange:n}:e},{minFinishingSum:0,winnerFinishingPositionRange:""})}function bW(t){let e=t.length,i=t.filter(({sides:u})=>u?.some(({bye:c})=>c)).length||0,r=t.filter(({winningSide:u,matchUpStatus:c})=>u||Yi.includes(c)).length||0,n=t.filter(({schedule:u,matchUpStatus:c})=>u?.scheduledDate&&u?.scheduledTime&&c!=="BYE").length||0,a=e-i,s=a===r,o=a-n,l=a-n;return{unscheduledCount:o,incompleteCount:l,scheduledCount:n,completedCount:r,matchUpsCount:e,isScheduled:a===n,isComplete:s,byeCount:i}}function SC({tournamentRecords:t,schedulingProfile:e,tournamentRecord:i,withRoundId:r}){if(i&&!t){if(typeof i!="object")return{error:Pw};t={[i.tournamentId]:i}}if(e){let a=wC({tournamentRecords:t,schedulingProfile:e});if(a.error)return a}if(!e&&t){let a=$c({tournamentRecords:t});if(a.error)return a;e=a.schedulingProfile}if(!e)return{error:_r};let n={};return{profileRounds:e.map(({venues:a,scheduleDate:s})=>a.map(({rounds:o})=>o.map(l=>{let u=_O(l);return u.roundSegment?.segmentsCount&&(n[u.id]=u.roundSegment.segmentsCount),Ve({id:r?u.id:void 0,scheduleDate:s,...u})}))).flat(1/0),segmentedRounds:n}}function bd({court:t,date:e}){let i=e&&t.dateAvailability?.find(n=>tu(n.date,e)),r=t.dateAvailability?.find(n=>!n.date);return i||r}function JEe({court:t,date:e}){let i=bd({court:t,date:e}),r=new Map,n=[];return(i?.bookings||[]).forEach(a=>{if(typeof a.courtOrder=="number"){let s=a.rowCount||1;for(let o=0;o<s;o++)r.set(a.courtOrder+o,a)}else n.push(a)}),{gridBookings:r,timeBookings:n}}function UC({courtPrefix:t="C|",minRowsCount:e,courtsData:i,scheduledDate:r}){if(!Array.isArray(i))return{error:ie};let n=i?.reduce((o,l)=>{let u=l.matchUps||[],c=Math.max(0,...u.map(d=>d.schedule.courtOrder||0));return Math.max(c,o)},1),a=Math.max(e||0,n),s=Re(0,a).map(o=>({matchUps:Re(0,i.length).map(l=>{let u=i[l],{courtId:c,venueId:d}=u;if(r){let{gridBookings:p}=JEe({court:u,date:r});if(p.has(o+1)){let f=p.get(o+1);return{schedule:{courtOrder:o+1,venueId:d,courtId:c},isBlocked:!0,booking:f}}}return{schedule:{courtOrder:o+1,venueId:d,courtId:c}}})}));return i.forEach((o,l)=>{for(let u of o.matchUps){let c=u.schedule?.courtOrder;c&&(s[c-1].matchUps[l]=u)}}),{courtPrefix:t,rows:s.map((o,l)=>Object.assign({rowId:`rowId-${l+1}`},...o.matchUps.map((u,c)=>({[`${t}${c}`]:u}))))}}var bX={};ct(bX,{getEntriesAndSeedsCount:()=>TC,getMaxEntryPosition:()=>t_});function TC({policyDefinitions:t,drawDefinition:e,drawSize:i,drawId:r,event:n,stage:a}){if(!n)return{error:li};let{entries:s,stageEntries:o}=M7({drawDefinition:e,drawId:r,stage:a,event:n}),l=o.length,{drawSize:u}=e9({participantsCount:l}),c=RS({drawSize:i??u,participantsCount:l,policyDefinitions:t});if(c.error)return z({result:c,stack:"getEntriesAndSeedsCount"});let{seedsCount:d}=c;return{entries:s,seedsCount:d,stageEntries:o}}function t_(t){let{entries:e=[],entryStatus:i,stage:r}=t;return Math.max(...e.filter(n=>(!r||r===n.entryStage)&&(!i||n.entryStatus===i)&&!isNaN(n.entryPosition)).map(({entryPosition:n})=>Ye(n||0)),0)}var wX={};ct(wX,{allCompetitionMatchUps:()=>Eo,allDrawMatchUps:()=>Rn,allEventMatchUps:()=>Ru,allTournamentMatchUps:()=>br,analyzeMatchUp:()=>Nb,calculateWinCriteria:()=>Ph,checkMatchUpIsComplete:()=>mp,competitionScheduleMatchUps:()=>kS,drawMatchUps:()=>p_,eventMatchUps:()=>PC,filterMatchUps:()=>Hu,getAllDrawMatchUps:()=>Qi,getAllStructureMatchUps:()=>Nt,getCheckedInParticipantIds:()=>hh,getCompetitionMatchUps:()=>Mb,getEventMatchUpFormatTiming:()=>r_,getHomeParticipantId:()=>o_,getMatchUpCompetitiveProfile:()=>nS,getMatchUpContextIds:()=>l_,getMatchUpDailyLimits:()=>RC,getMatchUpDailyLimitsUpdate:()=>n_,getMatchUpDependencies:()=>oo,getMatchUpFormat:()=>u_,getMatchUpFormatTiming:()=>aS,getMatchUpFormatTimingUpdate:()=>i_,getMatchUpScheduleDetails:()=>FR,getMatchUpType:()=>LR,getMatchUpsStats:()=>c_,getModifiedMatchUpFormatTiming:()=>DC,getParticipantResults:()=>cS,getPredictiveAccuracy:()=>s_,getRoundMatchUps:()=>bn,getRounds:()=>d_,isValidMatchUpFormat:()=>xa,matchUpActions:()=>eC,participantScheduledMatchUps:()=>a_,tallyParticipantResults:()=>Ih,tournamentMatchUps:()=>EC,validMatchUp:()=>MR,validMatchUps:()=>Ga});function SX({tournamentRecords:t,extensionName:e}){if(typeof t!="object"||!Object.keys(t).length)return{error:Ci};let i=[],r;for(let n of Object.values(t)){let{extension:a}=mt({element:n,name:e});a&&!r&&(i.push({params:{extension:a,discover:!0},method:"addExtension"}),r=!0);let s=n.events??[];for(let o of s){let{eventId:l}=o,{extension:u}=mt({name:e,element:o});u&&i.push({params:{eventId:l,extension:u},method:"addEventExtension"})}}return{methods:i}}function i_({tournamentRecords:t}){return SX({extensionName:dc,tournamentRecords:t})}var _A="ADULT",$A="JUNIOR",bT="WHEELCHAIR",QEe={[Fd]:{allowModificationWhenMatchUpsScheduled:{courts:!1,venues:!1},defaultTimes:{averageTimes:[{categoryNames:[],minutes:{default:90}}],recoveryTimes:[{minutes:{[$t]:30,default:60}}]},defaultDailyLimits:{[Wt]:2,[$t]:2,total:3},matchUpAverageTimes:[{matchUpFormatCodes:[Ju],averageTimes:[{categoryNames:[],minutes:{default:90}},{categoryTypes:[bT],minutes:{default:120}}]},{matchUpFormatCodes:["SET3-S:6/TB7-F:TB10"],averageTimes:[{categoryNames:[],minutes:{default:85}}]},{matchUpFormatCodes:["SET3-S:6/TB7-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:70}}]},{matchUpFormatCodes:["SET3-S:4NOAD-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:55}}]},{matchUpFormatCodes:["SET3-S:4/TB7"],averageTimes:[{categoryNames:[],minutes:{default:60}}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:50}}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB10"],averageTimes:[{categoryNames:[],minutes:{default:55}}]},{matchUpFormatCodes:["SET3-S:4/TB5@3"],averageTimes:[{categoryNames:[],minutes:{default:45}}]},{matchUpFormatCodes:["SET1-S:8/TB7","SET1-S:8/TB7@7"],averageTimes:[{categoryNames:[],minutes:{default:40}}]},{matchUpFormatCodes:["SET1-S:5/TB9@4"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:6/TB7"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:6NOAD"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:4/TB7","SET1-S:4/TB5@3","SET3-S:TB10","SET1-S:T20"],averageTimes:[{categoryNames:[],minutes:{default:20}}]},{matchUpFormatCodes:["SET1-S:4NOAD"],averageTimes:[{categoryNames:[],minutes:{default:20}}]},{matchUpFormatCodes:["SET1-S:TB10"],averageTimes:[{categoryNames:[],minutes:{default:10}}]}],matchUpRecoveryTimes:[{matchUpFormatCodes:["SET3-S:6/TB7","SET3-S:6/TB7-F:TB10","SET3-S:6/TB7-F:TB7"],recoveryTimes:[{categoryTypes:[_A,bT],minutes:{default:60,[$t]:30}},{categoryTypes:[$A],minutes:{default:60,[$t]:60}}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB7","SET3-S:4/TB7-F:TB10","SET3-S:4NOAD-F:TB7","SET3-S:4/TB7","SET3-S:4/TB5@3"],recoveryTimes:[{categoryTypes:[_A,bT],minutes:{default:30}},{categoryTypes:[$A],minutes:{default:60}}]},{matchUpFormatCodes:["SET1-S:8/TB7","SET1-S:8/TB7@7","SET1-S:5/TB9@4","SET1-S:6/TB7","SET1-S:6NOAD","SET1-S:4/TB7","SET1-S:4NOAD","SET3-S:TB10","SET1-S:T20"],recoveryTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:4/TB5@3"],recoveryTimes:[{categoryTypes:[_A,$A],minutes:{default:30}},{categoryTypes:[bT],minutes:{default:15}}]},{matchUpFormatCodes:["SET1-S:TB10"],recoveryTimes:[{categoryNames:[],minutes:{default:15}}]}],matchUpDailyLimits:[]}},ZEe=QEe;function r_({tournamentRecord:t,matchUpFormats:e,categoryType:i,event:r}){if(!r)return{error:li};let n,a;if(e?.length){let d=[];n=e.map(p=>{let f=typeof p=="string"?{matchUpFormat:p}:p;if(!d.includes(f?.matchUpFormat)&&xa({matchUpFormat:f?.matchUpFormat}))return d.push(f.matchUpFormat),f}).filter(Boolean)}else{let{policy:d}=sf({policyType:Po,tournamentRecord:t,event:r});if(d?.matchUpFormats)n=d?.matchUpFormats;else{let{extension:p}=mt({name:dc,element:r}),f,m;p?.value?{matchUpAverageTimes:f,matchUpRecoveryTimes:m}=p.value:{matchUpAverageTimes:f,matchUpRecoveryTimes:m}=ZEe[Fd],n=rt([...(f||[]).map(h=>h.matchUpFormatCodes),...(m||[]).map(h=>h.matchUpFormatCodes)].flat()).map(h=>({matchUpFormat:h})),a="default scheduling policy in use"}}let{eventType:s,eventId:o,category:l}=r,u=l?.categoryName??l?.ageCategoryCode??o;if(!o)return{error:li};let c=n.map(({matchUpFormat:d,description:p})=>{let f=aS({tournamentRecord:t,matchUpFormat:d,categoryName:u,categoryType:i,eventType:s,event:r});return{matchUpFormat:d,description:p,...f}});return Ve({eventMatchUpFormatTiming:c,info:a})}function DC(t){let e=Ge(t,[{[mr]:!0},{[Wr]:h=>xa({matchUpFormat:h}),[Fa]:Mw,[TF]:!0}]);if(e.error)return e;let{tournamentRecord:i,matchUpFormat:r,event:n}=t,{extension:a}=mt({name:dc,element:n}),s=a?.value,{extension:o}=mt({element:i,name:dc}),l=o?.value,u=s?.matchUpAverageTimes&&$y({...s,matchUpFormat:r}),c=l?.matchUpAverageTimes&&$y({...l,matchUpFormat:r}),d=[u,c].find(h=>h),p=s?.matchUpRecoveryTimes&&By({...s,matchUpFormat:r}),f=l?.matchUpRecoveryTimes&&By({...l,matchUpFormat:r}),m=[p,f].find(h=>h);return{matchUpFormat:r,recoveryTimes:m,averageTimes:d}}function n_({tournamentRecords:t}){return SX({extensionName:Hw,tournamentRecords:t})}var AS=({scheduleAttributes:t=["scheduledDate","scheduledTime"],schedule:e={}})=>!!Object.keys(e).filter(i=>t.includes(i)).filter(i=>e[i]).length;function a_({scheduleAttributes:t=["scheduledDate","scheduledTime"],matchUps:e=[]}){if(!Ga(e))return{error:Tu};if(!Array.isArray(t))return{error:ie};let i=e.filter(Boolean).filter(({schedule:r})=>AS({schedule:r,scheduleAttributes:t})).reduce((r,n)=>{let{schedule:a}=n,s=Qe(a?.scheduledDate),o=ci(a?.scheduledTime);return s&&o&&(r[s]?r[s].push(n):r[s]=[n]),r},{});return Object.keys(i).forEach(r=>{i[r].sort((n,a)=>z4(ci(n.schedule?.scheduledTime),ci(a.schedule?.scheduledTime)))}),{...H,scheduledMatchUps:i}}function eRe({tournamentRecords:t}){let e={},i=[];for(let r of Object.values(t))for(let n of r.events??[]){let a=za({event:n}),s=a?.drawDetails;bt(s)?(Object.assign(e,s),i.push(...Object.keys(s).filter(o=>bL({drawId:o,drawDetails:s})))):a?.drawIds?.length&&i.push(...a.drawIds)}return{drawIds:i,detailsMap:e}}function hP({schedulingProfile:t,matchUps:e=[]}){let i={},r=({eventId:o,drawId:l,structureId:u,roundNumber:c})=>`${o}|${l}|${u}${c}`;t?.length&&t.flatMap(({venues:o})=>o.map(({rounds:l})=>l)).forEach(o=>{o.sort((l,u)=>(l.sortOrder||0)-(u.sortOrder||0)).forEach(({eventId:l,drawId:u,structureId:c,roundNumber:d},p)=>{let f=r({eventId:l,drawId:u,structureId:c,roundNumber:d});i[f]=p})});let n=[],a={noScheduledDate:[]};for(let o of e){let l=o.schedule||{},u=l.scheduledDate&&Qe(l.scheduledDate)||l.scheduledTime&&Qe(l.scheduledTime)||"noScheduledDate";a[u]||(a[u]=[]),a[u].push(o)}let s=Object.keys(a).sort((o,l)=>o.localeCompare(l));for(let o of s){let l=a[o],u={noScheduledTime:[]};for(let d of l){let p=d.schedule||{},f=p.scheduledTime&&ci(p.scheduledTime)||"noScheduledTime";u[f]||(u[f]=[]),u[f].push(d)}for(let d of Object.keys(u)){let p=u[d].sort((f,m)=>(f.roundNumber||0)-(m.roundNumber||0));u[d]=p}let c=Object.keys(u).sort((d,p)=>d.localeCompare(p));for(let d of c){let p=u[d];p.sort((f,m)=>{let h=i[r(f)]||0,g=i[r(m)]||0;return h-g}),n.push(...p)}}return n}function PC(t){let{participants:e,contextContent:i,participantMap:r}=t,{tournamentAppliedPolicies:n,scheduleVisibilityFilters:a,participantsProfile:s,afterRecoveryTimes:o,policyDefinitions:l,useParticipantMap:u,tournamentRecord:c,usePublishState:d,contextFilters:p,matchUpFilters:f,contextProfile:m,nextMatchUps:h,tournamentId:g,inContext:I,context:v,event:w}=t;if(!w)return{error:li};let{eventId:y,eventName:b,endDate:S,eventType:U,category:T,gender:P}=w??{},D={...v,...Ve({surfaceCategory:w.surfaceCategory??c?.surfaceCategory,indoorOutDoor:w.indoorOutdoor??c?.indoorOutdoor,tournamentId:g??c?.tournamentId,endDate:S??c?.endDate,eventName:b,eventType:U,category:T,eventId:y,gender:P})},E;!e&&c&&({participants:e,participantMap:r,groupInfo:E}=af({participantsProfile:s,useParticipantMap:u,tournamentRecord:c,contextProfile:m,inContext:I})),m&&!i&&(i=Lc({policyDefinitions:l,tournamentRecord:c,contextProfile:m,event:w}));let R=za({event:w});return{...(w.drawDefinitions??[]).reduce((C,M)=>{let N=cv({hydrateParticipants:t.hydrateParticipants,context:D,tournamentAppliedPolicies:n,scheduleVisibilityFilters:a,tournamentParticipants:e,participantsProfile:s,afterRecoveryTimes:o,policyDefinitions:l,tournamentRecord:c,usePublishState:d,contextContent:i,contextFilters:p,matchUpFilters:f,participantMap:r,publishStatus:R,contextProfile:m,drawDefinition:M,nextMatchUps:h,inContext:I,event:w});return Object.keys(N)?.forEach(A=>{Array.isArray(N[A])&&(C[A]||(C[A]=[]),C[A]=C[A].concat(N[A]))}),C},{}),...H,groupInfo:E}}function EC(t){if(!t?.tournamentRecord)return{error:Ie};let e=t.contextContent,{scheduleVisibilityFilters:i,participantsProfile:r,afterRecoveryTimes:n,policyDefinitions:a,tournamentRecord:s,inContext:o=!0,usePublishState:l,contextFilters:u,matchUpFilters:c,contextProfile:d,nextMatchUps:p,context:f}=t,m=t.tournamentId??s.tournamentId,h=s?.events??[],{participants:g,participantMap:I,groupInfo:v}=af({participantsProfile:r,tournamentRecord:s,contextProfile:d,inContext:o});d&&!e&&(e=Lc({policyDefinitions:a,tournamentRecord:s,contextProfile:d}));let{appliedPolicies:w}=Tt({tournamentRecord:s}),y=u?.eventIds??[];return{...h.filter(b=>!y.includes(b.eventId)).map(b=>{let S={eventDrawsCount:$i({event:b}).flightProfile?.flights?.length||b.drawDefinitions?.length||0,...f};return PC({hydrateParticipants:t.hydrateParticipants,context:S,tournamentAppliedPolicies:w,scheduleVisibilityFilters:i,participantsProfile:r,afterRecoveryTimes:n,policyDefinitions:a,tournamentRecord:s,usePublishState:l,contextFilters:u,contextProfile:d,contextContent:e,matchUpFilters:c,participantMap:I,participants:g,tournamentId:m,nextMatchUps:p,inContext:o,event:b})}).reduce((b,S)=>((S&&Object.keys(S).filter(U=>!["success","matchUpsMap"].includes(U)))?.forEach(U=>{Array.isArray(S[U])&&(b[U]||(b[U]=[]),b[U]=b[U].concat(S[U]),b.matchUpsCount!==void 0?b.matchUpsCount+=S[U].length:b.matchUpsCount=S[U].length)}),b),{matchUpsCount:0}),groupInfo:v,participants:g}}function Mb({scheduleVisibilityFilters:t,hydrateParticipants:e,participantsProfile:i,tournamentRecords:r,useParticipantMap:n,policyDefinitions:a,usePublishState:s,matchUpFilters:o,contextFilters:l,nextMatchUps:u,inContext:c}){if(typeof r!="object"||!Object.keys(r).length)return{error:Ci};let d=Object.keys(r).map(m=>{let h=r[m];return EC({scheduleVisibilityFilters:t,hydrateParticipants:e,participantsProfile:i,policyDefinitions:a,tournamentRecord:h,usePublishState:s,matchUpFilters:o,contextFilters:l,nextMatchUps:u,inContext:c})}),p={},f={};return{...d.reduce((m,h)=>(Object.keys(h).forEach(g=>{if(g==="groupInfo")Object.assign(f,h[g]);else if(g==="participants")for(let I of h[g]??[])p[I.participantId]=I;else Array.isArray(h[g])&&(m[g]||(m[g]=[]),m[g]=m[g].concat(h[g]))}),m),{}),groupInfo:f,mappedParticipants:p}}function kS(t){if(typeof t?.tournamentRecords!="object"||!Object.keys(t?.tournamentRecords).length)return{error:Ci};let{courts:e,venues:i}=Cu(t),r=$c(t).schedulingProfile,{sortDateMatchUps:n=!0,courtCompletedMatchUps:a,alwaysReturnCompleted:s,activeTournamentId:o,tournamentRecords:l,withCourtGridRows:u,minCourtGridRows:c,usePublishState:d,status:p=Ha,sortCourtsData:f}=t,m=o??nh()??Object.keys(l)[0],h=d?dS({tournamentRecord:l[m],status:p}):void 0,g=s?Mb({...t,matchUpFilters:{...t.matchUpFilters,matchUpStatuses:[ki]},contextFilters:t.contextFilters}).completedMatchUps:[];if(d&&!Bo(h?.orderOfPlay))return{completedMatchUps:g,dateMatchUps:[],courtsData:[],venues:i};let I,v;d&&({drawIds:I,detailsMap:v}=eRe({tournamentRecords:l})),I?.length&&(t.contextFilters??={},t.contextFilters.drawIds?t.contextFilters.drawIds=t.contextFilters.drawIds.filter(M=>I.includes(M)):t.contextFilters.drawIds=I),h?.eventIds?.length&&(t.matchUpFilters??={},t.matchUpFilters?.eventIds&&t.matchUpFilters.eventIds.length?t.matchUpFilters.eventIds=t.matchUpFilters.eventIds.filter(M=>h.eventIds.includes(M)):t.matchUpFilters.eventIds=h.eventIds),h?.scheduledDates?.length&&(t.matchUpFilters??={},t.matchUpFilters.scheduledDates&&t.matchUpFilters.scheduledDates.length?t.matchUpFilters.scheduledDates=t.matchUpFilters.scheduledDates.filter(M=>h.scheduledDates.includes(M)):t.matchUpFilters.scheduledDates=h.scheduledDates),s&&(t.matchUpFilters??={},t.matchUpFilters?.excludeMatchUpStatuses?.length?t.matchUpFilters.excludeMatchUpStatuses.includes(ki)||t.matchUpFilters.excludeMatchUpStatuses.push(ki):t.matchUpFilters.excludeMatchUpStatuses=[ki]);let{completedMatchUps:w,upcomingMatchUps:y,pendingMatchUps:b,abandonedMatchUps:S,groupInfo:U,mappedParticipants:T}=Mb({...t,matchUpFilters:t.matchUpFilters,contextFilters:t.contextFilters}),P=[...y??[],...b??[]];v&&(!I?.length||Object.keys(v).length)&&(P=P.filter(M=>{let{drawId:N,structureId:A,stage:O}=M;if(!Bo(v?.[N]?.publishingDetail))return!1;let k=Object.keys(v[N].stageDetails??{});if(k.length){let x=k.filter($=>!Bo(v[N].stageDetails[$])),L=k.filter($=>Bo(v[N].stageDetails[$]));return x.length&&x.includes(O)?!1:L.length&&L.includes(O)?!0:x.length&&!x.includes(O)&&!L.length}let F=Object.keys(v[N].structureDetails??{});if(F.length){let x=F.filter($=>!Bo(v[N].structureDetails[$])),L=F.filter($=>Bo(v[N].structureDetails[$]));return x.length&&x.includes(A)?!1:L.length&&L.includes(A)?!0:x.length&&!x.includes(A)&&!L.length}return!0})),v&&d&&(P=P.filter(M=>{let{drawId:N,structureId:A,roundNumber:O}=M;if(!ot(O))return!0;let k=v[N]?.structureDetails?.[A];if(!k)return!0;let{scheduledRounds:F,roundLimit:x}=k;if(ot(x)&&O>x)return!1;if(F){let L=F[O];return L?Bo(L):!1}return!0}));let D=n?hP({matchUps:P,schedulingProfile:r}):P,E=e?.map(M=>{let N=C(M);return{surfaceCategory:M?.surfaceCategory??"",matchUps:N,...M}}),R={completedMatchUps:s?g:w,mappedParticipants:t.hydrateParticipants?void 0:T,dateMatchUps:D,courtsData:E,groupInfo:U,venues:i};if(u){let M=t.matchUpFilters?.scheduledDate,{rows:N,courtPrefix:A}=UC({minRowsCount:Math.max(c||0,D.length||0),scheduledDate:M,courtsData:E});R.courtPrefix=A,R.rows=N}return{...R,...H};function C({courtId:M}){let N=(a?D.concat(w??[],S??[]):D).filter(A=>A.schedule?.courtId===M||A.schedule?.allocatedCourts?.map(({courtId:O})=>O).includes(M));return f?hP({matchUps:N,schedulingProfile:r}):N}}function RC({tournamentRecords:t,tournamentId:e}){if(typeof t!="object"||!Object.keys(t).length)return{error:Ci};let i=Object.keys(t).filter(n=>!e||n===e),r;return i.forEach(n=>{let a=t[n],{matchUpDailyLimits:s}=tRe({tournamentRecord:a});r=s}),{matchUpDailyLimits:r}}function tRe(t){let e=Ge(t,[{[mr]:!0}]);if(e.error)return e;let{tournamentRecord:i}=t,{policy:r}=sf({policyType:Fd,tournamentRecord:i}),{extension:n}=mt({element:i,name:Hw}),a=n?.value?.dailyLimits,s=r?.defaultDailyLimits;return{matchUpDailyLimits:a||s}}function s_(t){let{matchUps:e}=t,{singlesForDoubles:i,tournamentRecord:r,drawDefinition:n,excludeMargin:a,exclusionRule:s,zoneDoubling:o,matchUpType:l,scaleName:u,eventId:c,zonePct:d,drawId:p,event:f}=t;if(!r&&!e)return{error:Ie};if(l&&![Wt,$t].includes(l))return{error:ie,info:{matchUpType:l}};if(e&&!Ga(e))return{error:ie,context:{matchUps:e}};let m=Dr[u],h=m?.ascending??t.ascending??!1,g=m?.accessor??t.valueAccessor,I=Array.isArray(m?.range)?Math.abs(m.range[0]-m.range[1]):0,v=ot(d)&&I?(d??0/100)*I:t.zoneMargin??I,w={withScaleValues:!0,withCompetitiveness:!0},y={matchUpTypes:l?[l]:[Wt,$t]},b=r?.participants;e?.[0]?.hasContext?p?e=e.filter(M=>M.drawId===p):c&&(e=e.filter(M=>M.eventId===c)):e??=p&&!n&&[]||!p&&c&&!f&&[]||p&&Rn({inContext:!0,drawDefinition:n,contextFilters:y,contextProfile:w,participants:b})?.matchUps||!p&&c&&Ru({inContext:!0,contextFilters:y,contextProfile:w,participants:b,event:f})?.matchUps||br({tournamentRecord:r,contextFilters:y,contextProfile:w})?.matchUps||[],l&&(e=e.filter(M=>M.matchUpType===l));let S=e.filter(({winningSide:M,score:N,sides:A,matchUpStatus:O})=>![$r,Qt,mi,ov,us].includes(O??"")&&cr({score:N})&&A?.length===2&&M),U=rRe({matchUps:S,excludeMargin:a,exclusionRule:s,valueAccessor:g,ascending:h,scaleName:u}),T=!o||Di(Wt)(l)?v:(v||0)*2,P=v?S.map(({competitiveProfile:M,matchUpType:N,score:A,sides:O})=>{let k=UX({singlesForDoubles:i,valueAccessor:g,matchUpType:N,scaleName:u,sides:O}),F=Math.abs(k[0].value-k[1].value);return{competitiveness:M?.competitiveness,valuesGap:F,score:A}}).filter(({valuesGap:M})=>M<=T):[],D=iRe({zoneData:P}),E=D&&Object.values(D).flat().length,R=E&&Object.assign({},...Object.keys(D).map(M=>({[M]:Math.round(1e4*D[M].length/E)/100}))),C=S.length-(P?.length||0);return{...H,relevantMatchUps:S,zoneDistribution:R,zoneData:P,accuracy:U,nonZone:C}}function iRe({zoneData:t}){let e={[iL]:[],[Tb]:[],[Db]:[]};for(let i of t){let{competitiveness:r,score:n,valuesGap:a}=i;e[r]&&e[r].push({score:n,valuesGap:a})}return e}function UX({singlesForDoubles:t,exclusionRule:e,valueAccessor:i,matchUpType:r,scaleName:n,sides:a}){let s=e?.range.sort(),o=l=>{let u=l?.[e?.valueAccessor];return{exclude:e&&u>=s[0]&&u<=s[1],exclusionValue:u}};return a.sort((l,u)=>l.sideNumber-u.sideNumber).map(({participant:l})=>{let u=[],c=l?.individualParticipants;if(c?.length){let d=[],p=0;for(let f of c){let{scaleValue:m,value:h}=wW({singlesForDoubles:t,valueAccessor:i,participant:f,matchUpType:r,scaleName:n}),{exclude:g,exclusionValue:I}=o(m);g&&u.push(I),d.push(m),h&&!Number.isNaN(Number(p))?p+=h:p=void 0}return{participantName:l.participantName,exclusionValues:u,scaleValues:d,value:p}}else if(l){let{scaleValue:d,value:p}=wW({singlesForDoubles:t,valueAccessor:i,matchUpType:r,participant:l,scaleName:n}),{exclude:f,exclusionValue:m}=o(d);return f&&u.push(m),{participantName:l.participantName,exclusionValues:u,scaleValue:d,value:p}}else return{}})}function wW({singlesForDoubles:t,valueAccessor:e,matchUpType:i,participant:r,scaleName:n}){let a=t?Wt:i,s=r?.rankings?.[a]?.find(u=>u.scaleName===n),o=(r?.ratings?.[a]?.find(u=>u.scaleName===n)||s)?.scaleValue,l=e?o?.[e]:o;return{scaleValue:o,value:l}}function rRe({excludeMargin:t,exclusionRule:e,valueAccessor:i,ascending:r,scaleName:n,matchUps:a}){let s={affirmative:[],negative:[],excluded:[]};for(let u of a)nRe({matchUp:u,accuracy:s,excludeMargin:t,exclusionRule:e,valueAccessor:i,ascending:r,scaleName:n});let o=s.affirmative.length+s.negative.length,l=o&&s.affirmative.length/o*100;return s.percent=l?Math.round(100*l)/100:0,s}function nRe({matchUp:t,accuracy:e,excludeMargin:i,exclusionRule:r,valueAccessor:n,ascending:a,scaleName:s}){let{matchUpType:o,sides:l,score:u,winningSide:c}=t;if(!c)return;if(r&&(!r.valueAccessor||!r.range)){e.error={info:"exclusionRule requires valueAccessor and range",error:Xe};return}let d=c-1,p=UX({exclusionRule:r,valueAccessor:n,matchUpType:o,scaleName:s,sides:l});if(aRe({exclusionRule:r,sideValues:p,accuracy:e,score:u,winningSide:c}))return;if(sRe(p)){e.excluded.push({scoreString:u?.scoreStringSide1,missingValues:!0,winningSide:c,sideValues:p});return}let f=p[d].value-p[1-d].value;if(oRe({excludeMargin:i,valuesGap:f})){e.excluded.push({scoreString:u?.scoreStringSide1,excludeMargin:i,winningSide:c,excludeGap:!0,sideValues:p,valuesGap:f});return}let m=a?f:f*-1,h=c===1?u?.scoreStringSide1:u?.scoreStringSide2;m>0?e.affirmative.push({winningScoreString:h,winningSide:c,sideValues:p,valuesGap:f,score:u}):e.negative.push({winningScoreString:h,winningSide:c,sideValues:p,valuesGap:f,score:u})}function aRe({exclusionRule:t,sideValues:e,accuracy:i,score:r,winningSide:n}){if(t){let a=e.flatMap(({exclusionValues:s})=>s);if(a.length)return i.excluded.push({scoreString:r?.scoreStringSide1,exclusionValues:a,winningSide:n,sideValues:e}),!0}return!1}function sRe(t){return t.filter(e=>![void 0,"",null].includes(e.value)).length<2}function oRe({excludeMargin:t,valuesGap:e}){let i=Number.parseFloat(t||0);return i&&Math.abs(e)<i}function Ph({collectionDefinitions:t=[],collectionGroups:e=[]}){let i=0,{groupValueNumbers:r}=U8({collectionGroups:e}),n;for(let a of t||[]){let{collectionValueProfiles:s,collectionGroupNumber:o,collectionValue:l,matchUpCount:u,matchUpValue:c,scoreValue:d,setValue:p}=a,f=o&&r.includes(o);if(ot(p||d))n=!0;else{if(f)continue;if(typeof l=="number"&&ot(l))i+=l;else if(Array.isArray(s)&&s?.length)for(let m of s)i+=m.matchUpValue;else typeof c=="number"&&ot(c)&&(i+=(u??0)*c)}}for(let a of e)i+=a.groupValue??0;return n||!i?{aggregateValue:!0,...H}:{valueGoal:Math.floor(i/2)+1,...H}}function o_(t){let{timeStamp:e,schedule:i,matchUp:r}=t,n=Ge(t,[{[Du]:!0}]);if(n.error)return n;let{itemValue:a,timeStamp:s}=uf({timeItems:r?.timeItems||[],itemType:oL});return!i||s&&e&&new Date(s).getTime()>new Date(e).getTime()?{homeParticipantId:a}:i}function l_({matchUps:t,matchUpId:e}){if(!Ga(t))return{error:ie};let i=t.find(o=>o.matchUpId===e),{drawId:r,eventId:n,structureId:a,tournamentId:s}=i||{};return{matchUpId:e,drawId:r,eventId:n,structureId:a,tournamentId:s}}function bv(t,e){if(!bt(t))return{error:ie};if(!Array.isArray(e))return{error:ie};let i={};for(let{param:r,error:n,attr:a}of e){let s=lRe({params:t,param:r,attr:a,error:n});if(s?.error)return s;i[r]=s}return i}function lRe({params:t,param:e,attr:i,error:r}){if(e===gR&&bt(t.drawDefinition)&&ri(t.structureId)){let n=(t.drawDefinition.structures??[]).find(({structureId:a})=>a===t.structureId);return!n.length&&r?{error:r}:{structure:n}}if(e===Du){let n=gX({...t,...i});return n.error&&r?{...n,error:r}:n}return{error:_r,info:{param:e}}}function u_(t){let{structureId:e,matchUpId:i,event:r}=t,n=t.drawDefinition,a=Ge(t,[{[mr]:!0},{[CF]:{[fR]:!1,[Ul]:!1,[H5]:!1,[kc]:!1}}]);if(a[xs])return a;let s=bv(t,[{[nv]:Du,[xs]:Xe}])?.matchUp;if(i&&s?.error)return s;!n&&s?.drawDefinition&&(n=s?.drawDefinition);let o=s?.structure;if(!o&&e&&!i){if(!n)return{error:Oo};let p=et({drawDefinition:n,structureId:e});if(p.error)return p;o=p.structure}let l=o?.matchUpFormat,u=n?.matchUpFormat,c=r?.matchUpFormat,d=s?.matchUp?.matchUpFormat||l||u||c;return{structureDefaultMatchUpFormat:l,eventDefaultMatchUpFormat:c,drawDefaultMatchUpFormat:u,matchUpFormat:d}}function c_({profileBands:t,tournamentRecord:e,matchUps:i}){if(!Ga(i))return{error:Tu};let r=!t&&sf({policyType:Gu,tournamentRecord:e}).policy,n=t||r?.profileBands||rL[Gu].profileBands,a=i.filter(({winningSide:p})=>p),s=a.map(kK),o=(p,f)=>{let m=AK(f,n);return p[m]+=1,p},l=OK(s).reduce((p,f)=>o(p,f),{[iL]:0,[Tb]:0,[Db]:0,[DK]:0}),u=Object.keys(l).reduce((p,f)=>(l[f]||0)+p,0),c=Object.keys(l).map(p=>{let f=Number.parseFloat((l[p]/u).toFixed(4));return{[p]:f*100}}),d=a.filter(({matchUpStatus:p})=>p===_H).length;return c.push({[_H]:Number.parseFloat((d/u).toFixed(4))*100}),{competitiveBands:Object.assign({},...c),...H}}var{stageOrder:SW}=Kve;function uRe(t,e){return t.eventName.localeCompare(e.eventName)||t.eventId.localeCompare(e.eventId)||(SW[t?.stage]||0)-(SW[e?.stage]||0)||e.matchUpsCount-t.matchUpsCount||`${t.stageSequence}-${t.roundNumber}-${t.minFinishingSum}`.localeCompare(`${e.stageSequence}-${e.roundNumber}-${e.minFinishingSum}`)}function d_({excludeScheduleDateProfileRounds:t,excludeScheduledRounds:e,excludeCompletedRounds:i,inContextMatchUps:r,tournamentRecords:n,schedulingProfile:a,tournamentRecord:s,withSplitRounds:o,matchUpFilters:l,scheduleDate:u,withRoundId:c,venueId:d,context:p}){if(r&&!Array.isArray(r||typeof r[0]!="object"))return{error:ie,inContextMatchUps:r};if(s&&!n){if(typeof s!="object")return{error:Pw};n={[s.tournamentId]:s}}let f=typeof n!="object"||!Object.keys(n).length;if((d||u||!r||!a&&(t||i||a||o))&&f)return{error:Ci};let m=Object.assign({},...Object.values(n??{}).map(({venues:S=[],tournamentId:U})=>({[U]:S?.map(({venueId:T})=>T)}))),h=Object.values(n??{}).map(({events:S=[],tournamentId:U,startDate:T,endDate:P})=>S.map(D=>({...D,validVenueIds:m[U],startDate:D.startDate??T,endDate:D.endDate??P}))).flat(),{segmentedRounds:g,profileRounds:I}=n&&(t||i||a||o)&&SC({tournamentRecords:n,schedulingProfile:a})||{},v=t&&Object.assign({},...I.map(S=>({[S.id]:S}))),w=r||n&&Eo({tournamentRecords:n,matchUpFilters:l})?.matchUps||[],y=[],b=w&&Object.values(w.reduce((S,U)=>{let T=_O(U).id,P=g?.[T],D=[...S[T]?.matchUps??[],U],{containerStructureId:E,stageSequence:R,structureName:C,tournamentId:M,isRoundRobin:N,matchUpType:A,roundNumber:O,roundOffset:k,structureId:F,eventName:x,roundName:L,drawName:$,eventId:V,drawId:_}=U,B=N?E:F;return{...S,[T]:{id:c?T:void 0,structureId:B,stageSequence:R,segmentsCount:P,structureName:C,tournamentId:M,matchUpType:A,roundNumber:O,roundOffset:k,eventName:x,roundName:L,drawName:$,matchUps:D,eventId:V,drawId:_}}},{})).map(S=>{let{minFinishingSum:U,winnerFinishingPositionRange:T}=XEe(S.matchUps),P=S.segmentsCount;if(P){let O=S.matchUps.length/P;return yr(S.matchUps.sort((k,F)=>k.roundPosition-F.roundPosition),O).map((k,F)=>{let{unscheduledCount:x,incompleteCount:L,matchUpsCount:$,isScheduled:V,isComplete:_,byeCount:B}=bW(k),G=yW({matchUps:S.matchUps,tournamentRecords:n,events:h,round:S});return Ve({...S,...p,roundSegment:{segmentsCount:P,segmentNumber:F+1},winnerFinishingPositionRange:T,unscheduledCount:x,incompleteCount:L,minFinishingSum:U,matchUpsCount:$,isScheduled:V,roundTiming:G,isComplete:_,byeCount:B,matchUps:k})})}let{unscheduledCount:D,incompleteCount:E,matchUpsCount:R,isScheduled:C,isComplete:M,byeCount:N}=bW(S.matchUps),A=yW({matchUps:S.matchUps,tournamentRecords:n,events:h,round:S});return Ve({...S,...p,winnerFinishingPositionRange:T,unscheduledCount:D,incompleteCount:E,minFinishingSum:U,matchUpsCount:R,isScheduled:C,roundTiming:A,isComplete:M,byeCount:N})}).flat().filter(S=>{if(t){let F=Qe(t),x=c?S.id:_O(S).id;if(F&&v[x]&&Qe(v[x].scheduleDate)===F)return!1}let{isComplete:U,isScheduled:T}=S,P=!i||!U,D=!e||!T,E=d||u?h?.find(({eventId:F})=>F===S.eventId):void 0,R=E?.startDate??s?.startDate,C=E?.endDate??s?.endDate,M=!u||!R||new Date(u)>=new Date(R),N=!u||!C||new Date(u)<=new Date(C),A=M&&N,O=!d||E?.validVenueIds.includes(d),k=P&&D&&O&&A;return k||y.push(S),k}).sort(uRe)||[];return{...H,rounds:b,excludedRounds:y}}function Nb(t){let{matchUp:e,sideNumber:i,setNumber:r,isTiebreakValue:n,isPointValue:a}=t||{},{matchUpFormat:s}=t||{};if(!e)return{error:ta};s=s||e?.matchUpFormat;let o=zi(s),l=!!e?.winningSide,u=e.score?.sets,c=u?.length,d=r&&r-1,p=!!u?.find((B,G)=>B.setNumber===r&&G===d),f=u?.filter(B=>B?.winningSide)||[],m=f?.length||0,h=r&&u?.slice(r)||[],g=!!(c&&r&&h?.reduce((B,G)=>(!G||!G.side1Score&&!G.side2Score&&!G.side1TiebreakScore&&!G.side2TiebreakScore&&!G.side1PointScore&&!G.side2PointScore)&&B,!0)),I=r<=c&&u.find(B=>B.setNumber===r),v=I&&Cb({setObject:I,matchUpScoringFormat:o}),{isCompletedSet:w,sideGameScores:y,sideTiebreakScores:b}=v||{},S=!!(I&&!w&&g||r&&r===c+1&&!l),U=[1,2].includes(i),T=U?i-1:0,P=I&&U&&(!n&&!a&&y[T]!==void 0&&y[T]||n&&b[T]!==void 0&&b[T]),D=!!P,E=f?.map(B=>Cb({setObject:B,matchUpScoringFormat:o}).isValidSetOutcome).reduce((B,G)=>B&&G,!0),R=f.reduce((B,G)=>{let{winningSide:j}=G,K=j-1;return B[K]++,B},[0,0]),C=e?.winningSide,M=C&&C-1,N=1-M,A=R[M],O=R[N],k=Math.max(...R),F=va(R)[k],{bestOf:x,exactly:L}=o??{},$=Math.ceil((x||L||1)/2),V=k===$&&F===1&&R.indexOf(k)+1||void 0,_=A>O&&C===V;return{completedSetsHaveValidOutcomes:E,validMatchUpWinningSide:_,calculatedWinningSide:V,matchUpScoringFormat:o,validMatchUpOutcome:V&&E&&_,isLastSetWithValues:g,completedSetsCount:m,isCompletedMatchUp:l,isValidSideNumber:U,hasExistingValue:D,existingValue:P,isExistingSet:p,isActiveSet:S,...v}}function p_({participants:t,tournamentAppliedPolicies:e,scheduleVisibilityFilters:i,participantsProfile:r,afterRecoveryTimes:n,policyDefinitions:a,useParticipantMap:s,tournamentRecord:o,usePublishState:l,contextFilters:u,contextContent:c,matchUpFilters:d,participantMap:p,publishStatus:f,contextProfile:m,drawDefinition:h,nextMatchUps:g,tournamentId:I,inContext:v,context:w,event:y}){let{eventId:b,eventName:S,endDate:U,eventType:T,category:P,gender:D}=y??{},E={...w,...Ve({surfaceCategory:y?.surfaceCategory??o?.surfaceCategory,indoorOutDoor:y?.indoorOutdoor??o?.indoorOutdoor,endDate:U??y?.endDate??o?.endDate,tournamentId:I??o?.tournamentId,eventName:S,eventType:T,category:P,eventId:b,gender:D})},R;return!t?.length&&o&&({participants:t,participantMap:p,groupInfo:R}=af({participantsProfile:r,useParticipantMap:s,tournamentRecord:o,contextProfile:m,inContext:v})),y&&m&&!c&&(c=Lc({policyDefinitions:a,tournamentRecord:o,contextProfile:m,drawDefinition:h,event:y})),{...cv({context:E,tournamentAppliedPolicies:e,scheduleVisibilityFilters:i,tournamentParticipants:t,participantsProfile:r,afterRecoveryTimes:n,policyDefinitions:a,tournamentRecord:o,usePublishState:l,participantMap:p,contextContent:c,contextFilters:u,matchUpFilters:d,publishStatus:f,contextProfile:m,drawDefinition:h,nextMatchUps:g,inContext:v,event:y}),groupInfo:R}}var TX={};ct(TX,{getCompetitionVenues:()=>DS,getCourts:()=>f_,getVenuesAndCourts:()=>Cu,publicFindVenue:()=>dL});function f_({tournamentRecord:t,venueId:e,venueIds:i}){return t?{courts:(t.venues||[]).filter(r=>e?r.venueId===e:i?i.includes(r.venueId):!0).map(r=>{let{venueId:n}=r,a=ke(r.courts||[]);return a.forEach(s=>Object.assign(s,{venueId:n})),a}).flat()}:{error:Ie}}var DX={};ct(DX,{categoryCanContain:()=>Fw,getCategoryAgeDetails:()=>Tp,getEvent:()=>g_,getEventProperties:()=>m_,getEventStructures:()=>GR,getEventTimeItem:()=>Kw,getEvents:()=>h_,getFlightProfile:()=>$i,getScaledEntries:()=>Dh});function m_({tournamentRecord:t,event:e}){if(!t)return{error:Ie};if(!e)return{error:li};let i=e.entries||[],r=t.participants||[],n=e.category?.categoryName||e.category?.ageCategoryCode,{eventType:a}=e,s=new Set(i.map(d=>d.participantId)),o=r.filter(d=>s.has(d.participantId)),l,u,c;return{entryScaleAttributes:o.map(d=>{let{participantId:p,participantName:f,name:m}=d,h={scaleType:uL,eventType:a,scaleName:n},g=Hl({participant:d,scaleAttributes:h})?.scaleItem?.scaleValue;h={scaleType:GK,eventType:a,scaleName:n};let I=Hl({participant:d,scaleAttributes:h})?.scaleItem?.scaleValue;h={scaleType:jK,eventType:a,scaleName:n};let v=Hl({participant:d,scaleAttributes:h})?.scaleItem?.scaleValue;return l=!!(l||g),u=!!(u||I),c=!!(c||v),{participantId:p,participantName:f||m,seed:g,ranking:I,rating:v}}),hasSeededParticipants:l,hasRankedParticipants:u,hasRatedParticipants:c}}function h_({tournamentRecord:t,withScaleValues:e,scaleEventType:i,inContext:r,eventIds:n,drawIds:a,context:s}){if(!t)return{error:Ie};let{tournamentId:o}=t,l=(t.events??[]).filter(({eventId:c})=>!n||Array.isArray(n)&&n.includes(c)).map(c=>{let d=c.drawDefinitions?.map(Sb);if(a?.length&&!xi(a,d).length)return;let p=ke(c);return r&&Object.assign(p,{tournamentId:o}),s&&Object.assign(p,s),p}).filter(Boolean),u={};if(e){let c=Ei({withScaleValues:!0,tournamentRecord:t}).participantMap,d=p=>p.reduce((f,m)=>f+Number.parseFloat(m),0);for(let p of l){let f=i??p.eventType,m=p.eventId;u[m]||(u[m]={ratingsStats:{},ratings:{},ranking:{},draws:{}});let h=(p.entries??[]).filter(({entryStatus:S})=>so.includes(S)).map(vt),g=S=>{if(S?.ratings?.[f])for(let U of S?.ratings?.[f]??[]){let T=U.scaleName;u[m].ratings[T]||(u[m].ratings[T]=[]);let P=Dr[T]?.accessor;if(P){let D=Number.parseFloat(U.scaleValue?.[P]);D&&u[m].ratings[T].push(D)}}if(S?.rankings?.[f])for(let U of S?.rankings?.[f]??[]){let T=U.scaleName;u[m].ranking[T]||(u[m].ranking[T]=[]),U.scaleValue&&u[m].ranking[T].push(U.scaleValue)}};for(let S of h){let U=c?.[S]?.participant;if(U?.participantType===gt)g(U);else for(let T of U?.individualParticipantIds??[]){let P=c?.[T]?.participant;g(P)}}let I=u[m].ratings;for(let S of Object.keys(I)){let U=I[S];if(!U.length)continue;let T=RH(U)?.toFixed(2);u[m].ratingsStats[S]={avg:Number.parseFloat((d(U)/U.length).toFixed(2)),median:T?Number.parseFloat(T):void 0,max:Math.max(...U),min:Math.min(...U)}}let v=(S,U)=>{let T=P=>{if(u[m].draws?.[S]&&P?.ratings?.[f])for(let D of P?.ratings?.[f]??[]){let E=D.scaleName;u[m].draws[S]?.ratings[E]||(u[m].draws[S].ratings[E]=[]);let R=Dr[E]?.accessor;if(R){let C=Number.parseFloat(D.scaleValue?.[R]);C&&u[m].draws[S].ratings[E].push(C)}}if(u[m].draws?.[S]&&P?.rankings?.[f])for(let D of P?.rankings?.[f]??[]){let E=D.scaleName;u[m].draws[S]?.ranking[E]||(u[m].draws[S].ranking[E]=[]);let R=D.scaleValue;R&&u[m].draws[S].ranking[E].push(R)}};for(let P of U.filter(Boolean)){let D=c?.[P]?.participant;if(D?.participantType===gt)T(D);else for(let E of D?.individualParticipantIds??[]){let R=c?.[E]?.participant;T(R)}}},w=[],y=S=>a?.length&&a.includes(S)||w.includes(S);for(let S of p.drawDefinitions??[]){let U=S.drawId;if(y(U))continue;let T=df({drawDefinition:S}).assignedParticipantIds??[];u[m].draws[U]||(u[m].draws[U]={ratingsStats:{},ratings:{},ranking:{}}),w.push(U),v(U,T)}let b=$i({event:p}).flightProfile;for(let S of b?.flights??[]){let U=S.drawId;if(y(U))continue;let T=S.drawEntries.map(vt);v(U,T)}for(let S of w){let U=u[m].draws[S].ratings;for(let T of Object.keys(U)){let P=U[T];if(!P.length)continue;let D=RH(P)?.toFixed(2);u[m].draws[S].ratingsStats[T]={avg:Number.parseFloat((d(P)/P.length).toFixed(2)),median:D?Number.parseFloat(D):void 0,max:Math.max(...P),min:Math.min(...P)}}}}}return Ve({eventScaleValues:u,events:l,...H})}function g_({tournamentRecord:t,drawDefinition:e,context:i,event:r}){if(!t)return{error:Ie};if(!r)return{error:li};let n=ke(r);i&&Object.assign(n,i);let a=e&&n.drawDefinitions?.find(({drawId:s})=>e.drawId===s);return Ve({drawDefinition:a,event:n})}function cRe(t){let e="validateAndDeriveDrawValues",{appliedPolicies:i,policyDefinitions:r}=fRe(t),n=mRe({...t,policyDefinitions:r,appliedPolicies:i}),a=pRe(t),s=hRe({...t,consideredEntries:a,appliedPolicies:i});if(s?.error)return z({result:s,stack:e});let o=gRe({...t,consideredEntries:a}),l=dRe({...t,appliedPolicies:i,policyDefinitions:r,drawSize:o});if(l.error)return z({result:l,stack:e});let u=l.drawType;if(isNaN(o)&&u!==na)return z({result:{error:Cw},stack:e});let c=r?.[fo]??i?.[fo],d=t.seedingProfile??c?.seedingProfile?.drawTypes?.[u??""]??c?.seedingProfile;t.seedingProfile&&(r[fo]||(r[fo]={...LO[fo]}),r[fo].seedingProfile=d);let p=IRe({...t,drawType:u});return p?.error?z({result:p,stack:e}):{drawSize:o,drawType:u,enforceGender:n,seedingProfile:d,appliedPolicies:i,policyDefinitions:r}}function dRe(t){let{policyDefinitions:e,appliedPolicies:i,enforceMinimumDrawSize:r=!0,drawSize:n}=t,a=t.drawTypeCoercion??ES({drawType:t.drawType,policyDefinitions:e,appliedPolicies:i}),s=i9({drawType:t.drawType,enforceMinimumDrawSize:r,drawTypeCoercion:a,drawSize:n});return s.error?s:{drawType:s.drawType}}function PX(t){return t?.filter(e=>e.entryStatus&&[...so,iS].includes(e.entryStatus))}function pRe({considerEventEntries:t=!0,drawEntries:e,eventEntries:i,qualifyingOnly:r}){return(r&&[]||PX(e)||(t?i:[])).filter(({entryStage:n})=>!n||n===xe)}function fRe(t){let{tournamentRecord:e,event:i}=t,r={...t?.appliedPolicies,...Tt({tournamentRecord:e,event:i}).appliedPolicies??{}},n=ke(t.policyDefinitions??{},!1,!0);return{appliedPolicies:r,policyDefinitions:n}}function mRe({enforceGender:t,policyDefinitions:e,appliedPolicies:i}){return t??e?.[Rr]?.participants?.enforceGender??i?.[Rr]?.participants?.enforceGender}function hRe(t){let{consideredEntries:e,appliedPolicies:i,policyDefinitions:r,enforceGender:n,participantMap:a,participants:s,event:o}=t;return o&&s&&tC({consideredEntries:e,policyDefinitions:r,appliedPolicies:i,participantMap:a,enforceGender:n,participants:s,event:o})}function gRe(t){return!t.drawSize&&t.consideredEntries.length&&![na,_w,rv,Ks,au].includes(t.drawType??"")&&XI(t.consideredEntries.length)||t.drawSize&&Ye(t.drawSize)||!1}function IRe(t){let{tournamentRecord:e,event:i,ignoreAllowedDrawTypes:r,drawType:n}=t,a=!r&&e&&hC({tournamentRecord:e,categoryType:i?.category?.categoryType,categoryName:i?.category?.categoryName});return a?.length&&!a.includes(n)?{error:L1}:{...H}}function EX(t){let{drawDefinition:e,appliedPolicies:i}=t,r=i?.[uc],n=kr({drawDefinition:e});return e.structures?.forEach(a=>{let s=gd({structureId:a.structureId,matchUpsMap:n}),o=NK({roundNamingPolicy:r,drawDefinition:e,structure:a,matchUps:s}),{roundNamingProfile:l,roundProfile:u}=o;(a.structures||[a]).forEach(c=>{(c.matchUps??[]).forEach(d=>{let p=d?.roundNumber?.toString();if(p){let f=l?.[p]?.roundName,m=l?.[p]?.abbreviatedRoundName,h=u?.[p]?.feedRound;Object.assign(d,{abbreviatedRoundName:m,feedRound:h,roundName:f})}})})}),{drawDefinition:e}}function OS(t){let{voluntaryConsolation:e,tournamentRecord:i,event:r}=t,n="generateDrawDefinition",{participants:a,participantMap:s}=Ei({withIndividualParticipants:!0,convertExtensions:!0,internalUse:!0,tournamentRecord:i}),o=PX(r?.entries)??[],l=cRe({...t,participantMap:s,participants:a,eventEntries:o});if(l.error)return z({result:l,stack:n});let{appliedPolicies:u,policyDefinitions:c,drawSize:d,drawType:p,enforceGender:f,seedingProfile:m}=l,h=r?.eventType,g=t.matchUpType??h,I=lEe({...t,enforceGender:f,eventType:h,matchUpType:g});if(I.error)return z({result:I,stack:n});let{matchUpFormat:v,tieFormat:w}=I;if(t.drawId&&typeof t.drawId!="string")return z({result:{error:ie},stack:n});let y=LEe({...t,policyDefinitions:c,tournamentRecord:i,appliedPolicies:u,matchUpFormat:v,seedingProfile:m,participants:a,eventEntries:o,matchUpType:g,tieFormat:w,drawSize:d,drawType:p,event:r});if(y.error)return z({result:y,stack:n});let{existingDrawDefinition:b,positioningReports:S,drawDefinition:U,structureId:T,conflicts:P,entries:D}=y;if(!U)return z({result:{error:ie},stack:n});let E=_Ee({...t,existingDrawDefinition:b,positioningReports:S,appliedPolicies:u,drawDefinition:U,seedingProfile:m,participants:a,structureId:T,entries:D,params:t,stack:n});if(E.error)return E;let{qualifyingConflicts:R}=E;return U.drawName=t.drawName??(p&&Xr(p)),d&&typeof e=="object"&&d>=4&&EL({...e,drawDefinition:U,matchUpType:g}),t.hydrateRoundNames&&u?.[uc]&&EX({drawDefinition:U,appliedPolicies:u}),{existingDrawDefinition:!!b,qualifyingConflicts:R,positioningReports:S,drawDefinition:U,structureId:T,...H,conflicts:P}}function vRe({matchUps:t,matchUpType:e}){if(!t)return{error:Tu};let i=[],r=[],n=0;e&&(t=t.filter(T=>T.matchUpType===e));let a=rt(t.map(({matchUpType:T})=>T));if(a.length>1)if(em(a,Zt))t=t.filter(Di(Zt));else if(em(a,Wt))t=t.filter(Di(Wt));else if(em(a,$t))t=t.filter(Di($t));else return{};if(!Ga(t)||!t.length)return{};let s=(T,P)=>Ye(T)-Ye(P),o=rt(t.flatMap(T=>T.drawPositions).filter(Boolean)).sort(s),l=Re(1,Math.max(...o)+1).filter(T=>!o.includes(T)).sort(s),{roundMatchUps:u}=bn({matchUps:t}),c=u?.[1],d=u?.[2]??[],p=c?.[0],f=p?.drawId,m=p?.structureId,h=u?Object.keys(u).map(T=>Ye(T)):[],g=Math.max(...h),I=u?.[g]?.length??0,v=Math.ceil(Math.log(I)/Math.log(2)),w=Re(1,v+1).map(T=>{let P=Math.pow(2,T-1),D=g+v-T+1;return Re(1,P+1).map(E=>({drawId:f,structureId:m,matchUpId:Et(),drawPositions:[],sides:[],roundNumber:D,roundPosition:E,finishingRound:T}))});v&&(t=t.concat(...w.flat()));let y=c?.map(T=>T.drawPositions)?.flat(1/0),b=d.map(T=>T.drawPositions).flat(1/0).filter(T=>!y?.includes(T)).sort(s),S=d.filter(T=>T.drawPositions?.find(P=>b.includes(P))).map(T=>{let P=T.drawPositions?.find(R=>b.includes(R)),D=P&&T.drawPositions?.indexOf(P),E=D!==void 0&&T.sides?.[D];return P&&{[P]:E}});if(l?.length&&b?.length===l?.length){let T=b.map((R,C)=>[R,l[C]].sort(s)),P=Object.assign({},...S),D=ke(c?.[0].finishingRound,!1,!0),E=ke(c?.[0].finishingPositionRange,!1,!0);r=T.map((R,C)=>{let M=Math.max(...R||[])/2,N=R?.map(A=>P[A]||{bye:!0,drawPosition:A});return{finishingPositionRange:E,sideNumber:C+1,matchUpStatus:"BYE",matchUpId:Et(),finishingRound:D,roundNumber:1,drawPositions:R,roundPosition:M,structureId:m,drawId:f,sides:N}}),t=t.concat(...r)}let U=g+v;return Re(1,U+1).forEach(T=>{let P=[],D=UW({matchUps:t,roundNumber:T}),E=UW({matchUps:t,roundNumber:T-1}),R=new Set(E.map(yRe).filter(Boolean)),C=D?.length===i?.length,M=D?.length===i?.length/2;T===1&&D.forEach(N=>{let A=N.drawPositions||[],{matchUpId:O,structureId:k}=N,F=[{...N.sides[0],drawPosition:A[0],matchUpId:O,structureId:k},{...N.sides[1],drawPosition:A[1],matchUpId:O,structureId:k}],x={...N,children:F};P.push(x)}),C?(n++,D.forEach((N,A)=>{let O=N.drawPositions||[],{matchUpId:k,structureId:F}=N,x=O.filter(Boolean).reduce((V,_)=>y?.includes(_)?V:_,void 0),L=[{...N.sides.filter(Boolean).reduce((V,_)=>_.participantId&&!R.has(_.participantId)?_:V,void 0),drawPosition:x,feedRoundNumber:n,sides:N.sides,matchUpId:k,structureId:F},i[A]],$={...N,children:L};P.push($)})):M&&D.forEach((N,A)=>{let O=[i[A*2],i[A*2+1]],k={...N,children:O};P.push(k)}),i=P}),{hierarchy:i[0],missingMatchUps:r,maxRound:g,finalRound:U,matchUps:t}}function UW({matchUps:t,roundNumber:e}){return t.filter(i=>i.roundNumber===e).sort((i,r)=>i.roundPosition-r.roundPosition)}function yRe(t){if(t.matchUpStatus==="BYE")return t.sides.reduce((e,i)=>i.participantId||e,void 0);if(t.winningSide)return t.sides.reduce((e,i)=>i.sideNumber===t.winningSide?i.participantId:e,void 0)}function RX({scaleAttributes:t,scaledEntries:e,stageEntries:i,seedsCount:r,scaleName:n}){if(!t)return{error:Xe,info:"missing scaleAttributes"};let a=Object.assign({},...(e||[]).slice(0,r).map(({participantId:o},l)=>({[o]:l+1})));n=n||t.scaleName;let s=new Date().toISOString();return{scaleItemsWithParticipantIds:i.map(({participantId:o})=>({scaleItems:[{scaleValue:a[o],eventType:t.eventType,scaleType:jl,scaleName:n,scaleDate:s}],participantId:o}))}}function bRe({tournamentRecord:t,drawDefinition:e,policyDefinitions:i,scaleAttributes:r,scaleName:n,drawSize:a,drawId:s,event:o,stage:l,sortDescending:u,scaleSortMethod:c}){let d=TC({policyDefinitions:i,drawDefinition:e,drawSize:a,drawId:s,event:o,stage:l});if(d.error)return d;let{entries:p,seedsCount:f,stageEntries:m}=d;if(!m||!f)return{error:ie};let h=Dh({tournamentRecord:t,scaleAttributes:r,scaleSortMethod:c,sortDescending:u,entries:p,stage:l}).scaledEntries??[],{scaleItemsWithParticipantIds:g}=RX({scaleAttributes:r,scaledEntries:h,stageEntries:m,seedsCount:f,scaleName:n});return{scaleItemsWithParticipantIds:g}}var CX={};ct(CX,{addDrawEntries:()=>SL,addEventEntries:()=>Ko,addEventEntryPairs:()=>OX,destroyPairEntries:()=>A7,destroyPairEntry:()=>PL,getEntriesAndSeedsCount:()=>TC,getMaxEntryPosition:()=>t_,modifyEntriesStatus:()=>nP,modifyEventEntries:()=>xX,mutate:()=>MX,promoteAlternate:()=>AX,promoteAlternates:()=>v_,query:()=>bX,removeDrawEntries:()=>kX,removeEventEntries:()=>fS,setEntryPosition:()=>I_,setEntryPositions:()=>NX});var MX={};ct(MX,{addDrawEntries:()=>SL,addEventEntries:()=>Ko,addEventEntryPairs:()=>OX,destroyPairEntries:()=>A7,destroyPairEntry:()=>PL,modifyEntriesStatus:()=>nP,modifyEventEntries:()=>xX,promoteAlternate:()=>AX,promoteAlternates:()=>v_,removeDrawEntries:()=>kX,removeEventEntries:()=>fS,setEntryPosition:()=>I_,setEntryPositions:()=>NX});function I_({tournamentRecord:t,drawDefinition:e,participantId:i,entryPosition:r,skipRefresh:n,event:a}){let s="setEntryPositions";if(!t)return{error:Ie};if(!i)return z({result:{error:lr},stack:s});if(r!==void 0&&!Number.isSafeInteger(r))return{error:ie,entryPosition:r};(a?.entries||[]).forEach(l=>{l.participantId===i&&(l.entryPosition=r)}),(e?.entries||[]).forEach(l=>{l.participantId===i&&(l.entryPosition=r)});let o=l=>{l.entries.forEach(u=>{u.entryPosition===r&&u.participantId!==i&&(u.entryPosition+=.1)})};return n||(a?.entries&&(o(a),a.entries=vo({entries:a.entries})),e?.entries&&(o(e),e.entries=vo({entries:e.entries}))),{...H}}function NX({tournamentRecord:t,entryPositions:e,drawDefinition:i,event:r}){if(!t)return{error:Ie};if(!Array.isArray(e))return{error:ie};for(let n of e){let{participantId:a,entryPosition:s}=n,o=I_({skipRefresh:!0,tournamentRecord:t,drawDefinition:i,participantId:a,entryPosition:s,event:r});if(o.error)return o}return r?.entries&&(r.entries=vo({entries:r.entries})),i?.entries&&(i.entries=vo({entries:i.entries})),{...H}}function AX(t){let{participantId:e}=t;return e&&typeof e!="string"?{error:ie,participantId:e}:v_({...t,participantIds:[e].filter(Boolean)})}function v_({tournamentRecord:t,drawDefinition:e,participantIds:i,stageSequence:r,stage:n=xe,eventId:a,event:s}){if(!t)return{error:Ie};if(!Array.isArray(i))return{error:ie,participantIds:i};if(!s)return{error:li};let o="promoteAlternates";if(s){let l=TW({element:s,participantIds:i,stageSequence:r,stage:n});if(l.error)return l}if(e){let l=TW({element:e,participantIds:i,stageSequence:r,stage:n});if(l.error)return a?z({context:{drawPromotionError:l.error,drawId:e.drawId},result:{...H},stack:o}):l}return{...H}}function TW({participantIds:t,stageSequence:e,element:i,stage:r}){let n=(i.entries||[]).filter(d=>d.entryStatus===Fs),a=(i.entries||[]).filter(d=>t.includes(d.participantId)),s=n.reduce((d,p)=>{let{entryPosition:f}=p;return isNaN(f)&&d||(!d||f<d.entryPosition)&&p||d},void 0),o=a.length?a:[s].filter(Boolean);if(!o?.length)return{error:i4};let l=o.filter(({entryStatus:d})=>d!==Fs);if(l.length)return{error:Zk,invalidEntryStatus:l};let u=o.filter(({entryStage:d})=>d&&d!==r);if(u.length)return{error:AIe,invalidStage:u};let c=e&&o.filter(d=>d.stageSequence!==e);if(c?.length)return{error:kIe,invalidStageSequence:c};for(let d of o){d.entryStatus=aa;let p=d?.entryPosition;isNaN(p)||i.entries.forEach(m=>{m.entryStatus===Fs&&m.entryPosition>p&&(m.entryPosition=m.entryPosition-1)});let f=Math.max(...i.entries.filter(m=>m.entryStatus===aa&&!isNaN(m.entryPosition)).map(({entryPosition:m})=>Ye(m||0)),0);d.entryPosition=f||0}return{...H}}function kX({autoEntryPositions:t=!0,participantIds:e,drawDefinition:i,drawId:r,stages:n,event:a}){if(!a)return{error:li};if(!r)return{error:Oo};if(!e?.length)return{error:Od};let s=df({drawDefinition:i,stages:n}).assignedParticipantIds??[];if(kn(s,e))return{error:ev};let o=c=>{let d=c.participantId;return!e.includes(d)},{flightProfile:l}=$i({event:a}),u=l?.flights?.find(c=>c.drawId===r);return u?.drawEntries&&(u.drawEntries=u.drawEntries.filter(o),t&&(u.drawEntries=vo({entries:u.drawEntries}))),i?.entries&&(i.entries=i.entries.filter(o),t&&(i.entries=vo({entries:i.entries}))),{...H}}function ul(t){let e="addParticipant",{allowDuplicateParticipantIdPairs:i,returnParticipant:r,disableNotice:n,pairOverride:a,participant:s}=t,o=t.tournamentId?t.tournamentRecords?.[t.tournamentId]:t.tournamentRecord??(t.activeTournamentId&&t.tournamentRecords?.[t.activeTournamentId]);if(!o)return{error:Ie};if(!s)return z({result:{error:rh},stack:e});s.participantId||(s.participantId=Et()),o.participants||(o.participants=[]);let{participantId:l,individualParticipantIds:u}=s;if(o.participants.reduce((h,g)=>g.participantId===l||h,!1))return{error:J6};let{participantType:c,participantRole:d}=s;if(!c||!Object.keys(Ly).includes(c))return{error:Do,participantType:c};if(!d)return{error:K6};let p=o.participants||[],f=p.filter(h=>h.participantType===gt).map(h=>h.participantId);if(c!==gt&&s.person)return{error:ie,person:s.person};if(u&&!Array.isArray(u))return{error:ie,individualParticipantIds:u};if(c===pt){if(s.person)return{error:ie,person:s.person};if(s.individualParticipantIds){if(s.individualParticipantIds.length!==2&&!a)return z({info:"PAIR must be 2 individualParticipantIds",result:{error:ga},stack:e});{let I=p.filter(v=>v.participantType===gt).map(v=>v.participantId);if(!Array.isArray(s.individualParticipantIds))return z({result:{error:ga},stack:e});if(!s.individualParticipantIds.reduce((v,w)=>I.includes(w)&&v,!0))return z({result:{error:ga},stack:e})}}else return z({result:{error:Od},stack:e});let h=p.filter(I=>I.participantType===pt).map(I=>({individualParticipantIds:I.individualParticipantIds,participant:I})),g=s.participantType===pt&&h.find(I=>xi(I.individualParticipantIds,s.individualParticipantIds).length===2);if(g&&!i)return{...H,existingParticipant:!0,participant:r&&ke(g.participant)};if(!s.participantName){let I=p.filter(w=>s.individualParticipantIds?.includes(w.participantId)),v=I.map(w=>w.person?.standardFamilyName).filter(Boolean).join("/");I.length===1&&(v+="/Unknown"),s.participantName=v}}else if(c===gt){if(!s.person?.standardFamilyName||!s.person?.standardGivenName)return{error:t4};if(!s.participantName){let h=`${s.person.standardFamilyName.toUpperCase()}, ${s.person.standardGivenName}`;s.participantName=h}}else if(c&&[Lt,ja].includes(c)){if(u||(s.individualParticipantIds=[]),s.individualParticipantIds?.length)for(let h of s.individualParticipantIds){if(typeof h!="string")return z({result:{participantId:h,error:ie},stack:e});if(!f.includes(h))return z({result:{participantId:h,error:Vi},stack:e})}}else return{error:Do};o.participants.push(s),n||at({payload:{tournamentId:o.tournamentId,participants:[s]},topic:md});let m={participant:r&&ke(s),...H};return Ve(m)}function Zs({allowDuplicateParticipantIdPairs:t,returnParticipants:e,tournamentRecord:i,participants:r=[]}){if(!i)return{error:Ie};i.participants||(i.participants=[]);let n=i.participants.map(d=>d.participantId)||[];r.forEach(d=>{d.participantId||(d.participantId=Et())});let a=r.filter(d=>!n.includes(d.participantId)),s=r.filter(d=>n.includes(d.participantId)),o=a.filter(d=>d.participantType===gt),l=a.filter(d=>d.participantType!==gt),u=o.concat(...l),c=[];if(u.length){for(let p of u){let f=ul({allowDuplicateParticipantIdPairs:t,returnParticipant:!0,disableNotice:!0,tournamentRecord:i,participant:p});if(f.error)return f;f.success&&!f.existingParticipant&&c.push(f.participant)}c.length&&at({topic:md,payload:{tournamentId:i.tournamentId,participants:c}});let d={participants:e&&ke(c),addedCount:c.length,...H};return s.length&&Object.assign(d,{notAdded:s,info:YE}),Ve(d)}else return{info:"No new participants to add",addedCount:0,...H}}function OX(t){let e=Ge(t,[{[mr]:!0,[kc]:!0}]);if(e.error)return e;let{allowDuplicateParticipantIdPairs:i,entryStatus:r=Fs,participantIdPairs:n=[],entryStage:a=xe,tournamentRecord:s,drawDefinition:o,event:l,uuids:u}=t;if(l.eventType!==$t)return{error:Zl};let c=[],d=new Map;for(let y of s.participants??[]){let{participantType:b,participantId:S,person:U,individualParticipantIds:T}=y;b===gt&&U?.sex?d.set(S,U.sex):b===pt&&T&&c.push(T)}let p=n.filter(y=>{if(y.length!==2)return!0;if(!l.gender||eu(l.gender))return!1;if(!d.has(y[0])||!d.has(y[1]))return!0;let b=y.map(U=>d.get(U)),S=zf(l.gender)&&(!zf(b[0])||!zf(b[1]))||op(l.gender)&&(!op(b[0])||!op(b[1]));return Na(l.gender)&&(b.sort($R),(!op(b[0])||!zf(b[1]))&&(S=!0)),S});if(p.length)return{error:ga,invalidParticipantIdPairs:p};let f=n.map(y=>({participantId:u?.pop()??Et(),participantRole:Kr,individualParticipantIds:y,participantType:pt})),m=i?f:f.filter(y=>!c.find(b=>xi(b,y.individualParticipantIds).length===2)),h,g=[];if(m){let y=Zs({allowDuplicateParticipantIdPairs:i,participants:m,returnParticipants:!0,tournamentRecord:s});if(y.error)return y;g=y.participants||[],h=y.info}let I=n.map(y=>{let b=g.find(U=>xi(U.individualParticipantIds,y).length===2);if(b)return b;let{participant:S}=Qs({tournamentRecord:s,participantIds:y});return S}).map(y=>y.participantId),v=Ko({participantIds:I,tournamentRecord:s,drawDefinition:o,entryStatus:r,entryStage:a,event:l});m.length&&at({payload:{participants:m},topic:md});let w=m.map(vt);return{...v,info:h,newParticipantIds:w}}function xX({entryStatus:t=aa,unpairedParticipantIds:e=[],participantIdPairs:i=[],entryStage:r=xe,tournamentRecord:n,event:a}){if(!n)return{error:Ie};if(!a)return{error:li};let s=n.participants??[],o=s.filter(h=>h.participantType===gt).map(h=>h.participantId),l=e.concat(...i).flat(1/0).filter(h=>!o.includes(h));if(l.length)return{error:ga,invalidParticipantIds:l};let u=i.filter(h=>h.length!==2);if(u.length)return{error:ga,invalidParticipantIdPairs:u};let c=s.filter(h=>h.participantType===pt).map(h=>h.individualParticipantIds),d=i.filter(h=>!c.find(g=>xi(g,h).length===2)).map(h=>({participantType:pt,participantRole:Kr,individualParticipantIds:h})),p=Zs({participants:d,tournamentRecord:n});if(p.error)return p;let f=i.map(h=>{let{participant:g}=Qs({tournamentRecord:n,participantIds:h});return g}).map(h=>({participantId:h,entryStatus:t,entryStage:r})),m=e.map(h=>({entryStatus:ys,participantId:h,entryStage:r}));return a.entries=(a.entries??[]).filter(h=>h.entryStage===r),a.entries=a.entries.concat(...f,...m),{...H}}var FX={};ct(FX,{addDrawDefinition:()=>xS,addEvent:()=>wv,addFlight:()=>AC,assignSeedPositions:()=>YX,attachFlightProfile:()=>D_,categoryCanContain:()=>Fw,deleteDrawDefinitions:()=>CC,deleteEvents:()=>XX,deleteFlightAndFlightDraw:()=>zX,deleteFlightProfileAndFlightDraws:()=>VX,generate:()=>LX,generateEventsFromTieFormat:()=>_X,getCategoryAgeDetails:()=>Tp,getEvent:()=>g_,getEventProperties:()=>m_,getEventStructures:()=>GR,getEventTimeItem:()=>Kw,getEvents:()=>h_,getFlightProfile:()=>$i,getScaledEntries:()=>Dh,modifyEvent:()=>JX,modifyEventMatchUpFormatTiming:()=>jX,modifyPairAssignment:()=>qX,mutate:()=>$X,query:()=>DX,refreshEventDrawOrder:()=>T_,removeEventMatchUpFormatTiming:()=>MC,removeScaleValues:()=>P_,removeSeeding:()=>KX,setEventDates:()=>S_,setEventDisplay:()=>NC,setEventEndDate:()=>w_,setEventStartDate:()=>b_,updateDrawIdsOrder:()=>U_,validateCategory:()=>hb});var LX={};ct(LX,{generateEventsFromTieFormat:()=>_X});function wRe({tournamentId:t,event:e}){return e?(at({payload:{tournamentId:t,event:e},key:e.eventId,topic:dK}),{...H}):{error:li}}var SRe={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_D3",winCriteria:{valueGoal:5}},URe={collectionDefinitions:[{collectionName:"Doubles",collectionValue:1,matchUpCount:3,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES"},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_DEFAULT",winCriteria:{valueGoal:5}},TRe={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_JUCO",winCriteria:{valueGoal:5}},DRe={COLLEGE_D3:SRe,COLLEGE_DEFAULT:URe,COLLEGE_JUCO:TRe,DOMINANT_DUO:a5,DOMINANT_DUO_MIXED:t5,LAVER_CUP:c5,TEAM_DOUBLES_3_AGGREGATION:X4,TIME_TENNIS_DUAL:i5,TIME_TENNIS_PRO_CIRCUIT:e5,USTA_BREWER_CUP:r5,USTA_OZAKI_CUP:n5,USTA_COLLEGE:s5,USTA_GOLD_TEAM_CHALLENGE:K4,USTA_INTERSECTIONAL:Z4,USTA_LEVEL_1:o5,USTA_SECTION_BATTLE:Q4,USTA_SOUTHERN_LEVEL_5:J4,USTA_TOC:d5,USTA_WTT_ITT:l5,USTA_ZONAL:u5};function wv({suppressNotifications:t,tournamentRecord:e,internalUse:i,event:r}){if(!e)return{error:Ie};if(e.events||(e.events=[]),!r)return{error:li};let{startDate:n,endDate:a}=e;if(!i&&(r.entries?.length||r.drawDefinitions?.length)){let o=Ve({drawDefinitions:!!r.drawDefinitions?.length,entries:!!r.entries?.length});return{info:"entries/drawDefinitions cannot exist",error:ie,context:o}}let s={eventType:Pm,drawDefinitions:[],entries:[],startDate:n,endDate:a,...r};if(r.eventType===ya){if(r.tieFormat){let o=Bn({tieFormat:r.tieFormat});if(o.error)return o}else if(r.tieFormatName){if(!DRe[r.tieFormatName])return{context:{tieFormatName:r.tieFormatName},error:ie};let o=oc({isMock:e?.isMock,namedFormat:r.tieFormatName,event:r});s.tieFormat=o}}if(s.eventId||(s.eventId=Et()),e.events.reduce((o,l)=>o||l.eventId===s.eventId,void 0))return{error:E6};{let o=s;if(e.events.push(o),!t){let{topics:l}=gs();if(l.includes(TR)){let d=Ru({event:r}).matchUps??[];hd({tournamentId:e?.tournamentId,eventId:r.eventId,matchUps:d})}let{drawDefinitions:u,...c}=r;for(let d of u||[])zw({drawDefinition:d});wRe({tournamentId:e?.tournamentId,event:c})}return{...H,event:s}}}function _X(t){let e=Ge(t,[{[rI]:{[mR]:!0,[_5]:!0}},{[mr]:!0}]);if(e.error)return e;let i=t.tieFormat||oc({namedFormat:t.tieFormatName}),r=t.uuids||[Y4(i.collectionDefinitions.length)],n={[er]:[],[Hr]:[]};if(t.addEntriesFromTeams){let s=t.tournamentRecord.participants?.filter(o=>o.participantType===_n)?.flatMap(o=>o.individualParticipantIds??[]);for(let o of t.tournamentRecord.participants??[])if(s?.includes(o.participantId)){let l=o.person?.sex;if(l&&il(l)){let u=on(l);u&&n[u].push(o.participantId)}}}let a=[];for(let s of i.collectionDefinitions??[]){let o=r?.pop()?.toString()||Et(),l=s.matchUpType,u=s.gender,c={matchUpFormat:s.matchUpFormat,eventName:s.collectionName,category:s.category,gender:u,eventType:l,eventId:o};if(t.addEntriesFromTeams){let d=l===lc?ys:t.entryStatus||aa,p=Na(u)?[...n[er],...n[Hr]]:n[on(u)||ju]??[];if(p.length){let f=Ko({participantIds:p,entryStatus:d,event:c});if(f.error)return f}}if(a.push(c),t.addEvents!==!1){let d=wv({internalUse:!0,tournamentRecord:t.tournamentRecord,event:c});if(d.error)return d}}return{...H,events:a}}var $X={};ct($X,{addDrawDefinition:()=>xS,addEvent:()=>wv,addFlight:()=>AC,assignSeedPositions:()=>YX,attachFlightProfile:()=>D_,deleteDrawDefinitions:()=>CC,deleteEvents:()=>XX,deleteFlightAndFlightDraw:()=>zX,deleteFlightProfileAndFlightDraws:()=>VX,modifyEvent:()=>JX,modifyEventMatchUpFormatTiming:()=>jX,modifyPairAssignment:()=>qX,refreshEventDrawOrder:()=>T_,removeEventMatchUpFormatTiming:()=>MC,removeScaleValues:()=>P_,removeSeeding:()=>KX,setEventDates:()=>S_,setEventDisplay:()=>NC,setEventEndDate:()=>w_,setEventStartDate:()=>b_,updateDrawIdsOrder:()=>U_,validateCategory:()=>hb});function Sv({removePriorValues:t=!0,status:e=Ha,statusObject:i,event:r}){if(!bt(i))return{error:ie};let n=za({event:r,status:e}),a=`${Bd}.${Vd}`,s={itemValue:{[e]:{...n,...i}},itemType:a};return Uh({timeItem:s,removePriorValues:t,event:r})}function Uv(t){let e=Ge(t,[{[mr]:!0,[kc]:!0},{eventDataParams:!1,[zn]:Yn}]);if(e.error)return e;let{includePositionAssignments:i,removePriorValues:r,tournamentRecord:n,status:a=Ha,event:s,drawIdsToRemove:o,drawIdsToAdd:l}=t,{appliedPolicies:u}=Tt({tournamentRecord:n,event:s}),c={...u,...t.policyDefinitions},d=s?.drawDefinitions?.map(({drawId:b})=>b)??[],p=t.drawDetails?Object.keys(t.drawDetails):[],f=p.length?[]:t.drawIds,m=(l??[]).concat(...o??[],...f??[],...p),h=m.filter(b=>!d.includes(b));if(h.length)return z({result:{error:Oa},context:{invalidDrawIds:h}});if(t.drawDetails)for(let b of Object.keys(t.drawDetails)){let S=t.drawDetails[b];if(S.publishingDetail?.embargo&&!id(S.publishingDetail.embargo))return{error:Rg};if(S.stageDetails){for(let U of Object.keys(S.stageDetails))if(S.stageDetails[U].embargo&&!id(S.stageDetails[U].embargo))return{error:Rg}}if(S.structureDetails)for(let U of Object.keys(S.structureDetails)){let T=S.structureDetails[U];if(T.embargo&&!id(T.embargo))return{error:Rg};if(T.scheduledRounds){for(let P of Object.keys(T.scheduledRounds))if(T.scheduledRounds[P].embargo&&!id(T.scheduledRounds[P].embargo))return{error:Rg}}}}let g=za({event:s,status:a}),I=Object.keys(g?.drawDetails||{}).filter(b=>d.includes(b)).reduce((b,S)=>(b[S]=g.drawDetails[S],b),{});for(let b of d)if((!m.length||m.includes(b))&&(o?.includes(b)||f?.length&&!f.includes(b)?I[b]={...I[b],publishingDetail:{published:!1}}:(l?.includes(b)||f?.includes(b)||!f?.length)&&(I[b]={...I[b],publishingDetail:{published:!0}})),t.drawDetails?.[b]){let S=t.drawDetails[b],U=S.structureDetails??I[b].structureDetails,T=S.stageDetails??I[b].stageDetails??{},{structureIdsToRemove:P=[],structureIdsToAdd:D=[],publishingDetail:E={},stagesToRemove:R=[],stagesToAdd:C=[]}=S;if((D||C)&&(E.published=!0),I[b]={publishingDetail:E,structureDetails:U,stageDetails:T},D.length||P.length){let N=(s?.drawDefinitions?.find(O=>O.drawId===b)?.structures??[]).map(({structureId:O})=>O),A=(D??[]).concat(P??[]).filter(O=>!N.includes(O));if(A.length)return z({result:{error:Ii},context:{invalidStructureIds:A}});U=U??{};for(let O of N)P.includes(O)?U[O]={published:!1}:U[O]={published:!0};I[b].structureDetails=U}let M=(s?.drawDefinitions?.find(N=>N.drawId===b)?.structures??[]).map(({stage:N})=>N);if(C.length){for(let N of C)T[N]={published:!0};for(let N of M)T[N]||(T[N]={published:!1})}if(C.length||R.length){for(let N of R)T[N]={published:!1};for(let N of M)T[N]||(T[N]={published:!0})}(C.length||R.length)&&(I[b].stageDetails=T)}Sv({statusObject:{drawDetails:I},removePriorValues:r,status:a,event:s});let{topics:v}=gs(),w=v.includes(pO),y=w||t.returnEventData?PS({includePositionAssignments:i,...t.eventDataParams,usePublishState:!0,tournamentRecord:n,policyDefinitions:c,event:s})?.eventData:void 0;return w&&at({payload:{eventData:y,tournamentId:n.tournamentId},topic:pO}),{...H,eventData:y}}var BX="deleteDrawDefinitions",$O="autoSchedulingAudit",nD="deleteEvents",PRe={AUTO_SCHEDULING_AUDIT:$O,DELETE_EVENTS:nD,DELETE_DRAW_DEFINITIONS:BX};function CC(t){if(!t.tournamentRecord)return{error:Ie};let e="deleteDrawDefinitions",i=t.drawIds??[],r=t.event,{autoPublish:n=!0,tournamentRecord:a,auditData:s,eventId:o,force:l}=t,{appliedPolicies:u}=Tt({tournamentRecord:a,event:r}),c={...u,...t.policyDefinitions},d=Array.isArray(i)?i[0]:void 0;if(!r){let T=jn({tournamentRecord:a,eventId:o,drawId:d});if(T.error)return T;r=T.event}let p=[],f=[],m=[];if(!r?.drawDefinitions)return z({info:"event has no drawDefinition",result:{...H},stack:e});let h=r.drawDefinitions.map(({drawId:T})=>T);if(i.length||(i=h),i=i.filter(T=>h.includes(T)),!i.length)return z({info:"nothing to do; no matching drawIds in event.",result:{...H},stack:e});let g=ke($i({event:r}).flightProfile,!1,!0),I=({participantId:T,drawPosition:P,qualifier:D,bye:E})=>({bye:E,qualifier:D,drawPosition:P,participantId:T}),v=l??u?.[Po]?.allowDeletionWithScoresPresent?.drawDefinitions,w=za({event:r})??{},y=w.drawIds??(w.drawDetails&&Object.keys(w.drawDetails))??[],b,S=[],U=r.drawDefinitions.filter(T=>{if(i.includes(T.drawId)){let P=Rn({event:r,drawDefinition:T})?.matchUps??[];if(P.some(({score:F})=>cr({score:F}))&&!v)return S.push(T.drawId),!0;let{drawId:D,drawType:E,drawName:R}=T,C=g?.flights?.find(F=>F.drawId===T.drawId);C&&(C.drawEntries=C.drawEntries?.filter(F=>so.includes(F.entryStatus))),y.includes(D)&&(y=y.filter(F=>F!==D),b=!0);let M=Js({stageSequence:1,drawDefinition:T,stage:xe})?.structures?.[0],N=(M?cI({structureId:M.structureId,tournamentRecord:a,drawDefinition:T}):void 0)?.positionAssignments?.map(I),A=Js({stage:We,drawDefinition:T})?.structures,O=A?.length?A.map(F=>{let x=F.stageSequence;return{positionAssignments:cI({structureId:F.structureId,tournamentRecord:a,drawDefinition:T})?.positionAssignments.map(I),stageSequence:x}}):void 0,k={action:BX,payload:{drawDefinitions:[T],eventId:o??r?.eventId,auditData:s}};m.push(k),p.push(Ve({tournamentId:a.tournamentId,eventId:o??r?.eventId,qualifyingPositionAssignments:O,positionAssignments:N,auditData:s,drawType:E,drawName:R,drawId:D})),P?.forEach(({matchUpId:F})=>f.push(F))}return!i.includes(T.drawId)});if(S.length&&!l)return z({context:{drawIdsWithScoresPresent:S},result:{error:kw},stack:e});if(r.drawDefinitions=U,g&&Ld({event:r,extension:{name:Xs,value:g}}),NS({tournamentRecord:a}),b){let T={};for(let D of y)T[D]=w.drawDetails?.[D]??{published:!0};let P=Sv({statusObject:{drawDetails:T},event:r});if(P.error)return{error:P.error}}if(m.length)if(eR(Qu)){let T=a.tournamentId;at({topic:Qu,payload:{tournamentId:T,detail:m}});let P=(vs({element:r,itemType:fp})?.timeItem?.itemValue||0)+1;Dl({element:r,timeItem:{itemType:fp,itemValue:P},removePriorValues:!0})}else ERe({appliedPolicies:u,event:r,deletedDrawsDetail:p,auditData:s});if(f.length&&Pu({tournamentId:a?.tournamentId,matchUpIds:f}),i.forEach(T=>Aye({drawId:T})),n&&b){let T=Uv({...t.eventDataParams,drawIdsToRemove:i,policyDefinitions:c,tournamentRecord:a,event:r});if(T.error)return{...H,info:T.error}}return{...H}}function ERe({appliedPolicies:t,event:e,deletedDrawsDetail:i,auditData:r}){if(t?.audit?.[fp]===!1)return;let{extension:n}=mt({name:fp,element:e}),a={...r,deletedDrawsDetail:i},s={value:Array.isArray(n?.value)?n?.value.concat(a):[a],name:fp};xt({element:e,extension:s})}function VX({autoPublish:t=!0,tournamentRecord:e,auditData:i,event:r,force:n}){if(!e)return{error:Ie};if(!r)return{error:li};let{flightProfile:a}=$i({event:r});if(a){let s=a.flights?.map(({drawId:l})=>l).filter(Boolean),o=CC({eventId:r.eventId,tournamentRecord:e,autoPublish:t,auditData:i,drawIds:s,event:r,force:n});return o.error?o:bR({event:r,name:Xs})}return{...H}}function y_(t){let{matchUpFormat:e,recoveryTimes:i,averageTimes:r,tournamentId:n,eventId:a}=t,s=t?.tournamentRecords??(t?.tournamentRecord&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord})??{};if(!Object.keys(s).length)return{error:Ci};let o=Object.keys(s).filter(u=>!n||n===u);if(n&&!o.includes(n))return{error:ie};let l;for(let u of o){let c=s[u],{event:d}=jn({tournamentRecord:c,eventId:a});a&&d&&(l=!0);let p=RRe({tournamentRecord:c,event:d,matchUpFormat:e,averageTimes:r,recoveryTimes:i});if(p.error)return p}return!a||l?{...H}:{error:os}}function RRe({tournamentRecord:t,recoveryTimes:e,matchUpFormat:i,averageTimes:r,event:n}){if(!t)return{error:Ie};if(r&&!Array.isArray(r))return{error:ie};if(e&&!Array.isArray(e))return{error:ie};let a=dc;if(n){let{extension:s}=mt({element:n,name:a}),o=s?.value||{},l=DW({...o,matchUpFormat:i,averageTimes:r,recoveryTimes:e});xt({element:n,extension:{name:a,value:l}})}else{let{extension:s}=mt({element:t,name:a}),o=s?.value||{},l=DW({...o,matchUpFormat:i,averageTimes:r,recoveryTimes:e});xt({extension:{name:a,value:l},element:t})}return{...H}}function DW(t){let{matchUpRecoveryTimes:e=[],matchUpAverageTimes:i=[],matchUpFormat:r}=t,{averageTimes:n,recoveryTimes:a}=t;n=(n||[]).filter(l=>l?.categoryNames?.length||l?.categoryTypes?.length);let s=n?.length&&i.map(l=>l?.matchUpFormatCodes.includes(r)?{...l,matchUpFormatCodes:l.matchUpFormatCodes?.filter(u=>u!==r)}:l).filter(({matchUpFormatCodes:l})=>l?.length).concat({matchUpFormatCodes:[r],averageTimes:n});a=(a||[]).filter(l=>l?.categoryNames?.length||l?.categoryTypes?.length);let o=a?.length&&e.map(l=>l?.matchUpFormatCodes.includes(r)?{...l,matchUpFormatCodes:l.matchUpFormatCodes?.filter(u=>u!==r)}:l).filter(({matchUpFormatCodes:l,averageTimes:u})=>l?.length||u).concat({matchUpFormatCodes:[r],recoveryTimes:a});return{matchUpAverageTimes:s?.length&&s||i,matchUpRecoveryTimes:o?.length&&o||e}}function jX(t){let{tournamentRecord:e,recoveryMinutes:i,averageMinutes:r,matchUpFormat:n,categoryType:a,eventId:s,event:o}=t;if(!e)return{error:Ie};if(!xa({matchUpFormat:n}))return{error:ie};if(!o)return{error:li};let{averageTimes:l=[],recoveryTimes:u=[]}=DC({tournamentRecord:e,matchUpFormat:n,event:o}),c=o.category,d=c?.categoryName||c?.ageCategoryCode||o?.eventId,p={categoryNames:[d],minutes:{}},f={categoryNames:[d],minutes:{}},m=w=>{if(w.categoryTypes?.includes(a)&&console.log("encountered:",{categoryType:a}),!(w.categoryNames?.includes(d)&&(w.categoryNames=w.categoryNames.filter(y=>y!==d),p={minutes:w.minutes,categoryNames:[d]},!w.categoryNames.length)))return w},h=r&&!isNaN(Ye(r)),g=i&&!isNaN(Ye(i)),I=l.map(m).filter(w=>w?.categoryNames?.length),v=u.map(m).filter(w=>w?.categoryNames?.length);return h&&(Object.assign(p.minutes,{[o?.eventType||Wt]:r}),I.push(p)),g&&(Object.assign(f.minutes,{[o?.eventType||Wt]:i}),v.push(f)),!h&&!g?{error:ie}:y_({averageTimes:h&&I,recoveryTimes:g&&v,tournamentRecord:e,matchUpFormat:n,eventId:s})}function MC(t){if(t.event)return PW({event:t.event});{t.tournamentRecord&&!t.tournamentRecords&&(t.tournamentRecords={[t.tournamentRecord.tournamentId]:t.tournamentRecord});let e=Ge(t,[{[cn]:!0,[G5]:!0}]);if(e.error)return e;let{tournamentRecords:i,eventId:r}=t;for(let n of Object.values(i??{})){let{event:a}=jn({tournamentRecord:n,eventId:r});if(a)return PW({event:a})}}return{error:os}}function PW({event:t}){return bR({event:t,name:dc})}var GX={MON:"MON",TUE:"TUE",WED:"WED",THU:"THU",FRI:"FRI",SAT:"SAT",SUN:"SUN"};function HX(t){return!Array.isArray(t)||rt(t).length!==t.length?!1:t.every(e=>Object.keys(GX).includes(e))}function b_({tournamentRecord:t,event:e,startDate:i}){if(!t)return{error:Ie};if(!e)return{error:li};if(!rl.test(i))return{error:sr};let r=WX(t),n="setEventStartDate";if(r.error)return z({result:r,stack:n});let{tournamentStartDate:a,tournamentEndDate:s}=r,o=new Date(Qe(i)).getTime();if(!a||!s||o<a||o>s)return z({result:{error:sr},stack:n,info:"startDate must be within tournament start and end dates"});let l=e.endDate&&new Date(Qe(e.endDate)).getTime();return l&&o>l&&(e.endDate=i),e.startDate=i,{...H}}function w_(t){let{tournamentRecord:e,event:i,endDate:r}=t;if(!e)return{error:Ie};if(!i)return{error:li};if(!rl.test(r))return{error:sr};let n=WX(e);if(n.error)return n;let{tournamentStartDate:a,tournamentEndDate:s}=n,o=new Date(Qe(r)).getTime();if(!a||!s||o<a||o>s)return{error:sr};let l=i.startDate&&new Date(Qe(i.startDate)).getTime();return l&&o<l&&(i.startDate=r),i.endDate=r,{...H}}function S_(t){let e="setEventDates",i=Ge(t,[{tournamentRecord:!0,event:!0},{[Wr]:u=>rl.test(u),[Fa]:sr,startDate:!1,endDate:!1},{[Wr]:u=>u.filter(Boolean).every(c=>rl.test(c)),[Fa]:sr,activeDates:!1},{[Wr]:HX,weekdays:!1}]);if(i.error)return i;let{tournamentRecord:r,weekdays:n,event:a,startDate:s,endDate:o}=t,l=t.activeDates?.filter(Boolean);if(s&&o){let u=new Date(Qe(s)).getTime(),c=new Date(Qe(o)).getTime();if(u>c)return z({result:{error:ie},stack:e,info:"startDate cannot be after endDate"})}if(l){let u=s||r.startDate,c=o||r.endDate,d=!u||l.every(f=>new Date(f)>=new Date(u)),p=!c||l.every(f=>new Date(f)<=new Date(c));if(!d||!p)return z({result:{error:sr},stack:e})}if(s){let u=b_({tournamentRecord:r,event:a,startDate:s});if(u.error)return z({result:u,stack:e})}if(o){let u=w_({tournamentRecord:r,event:a,endDate:o});if(u.error)return z({result:u,stack:e})}return l&&(a.activeDates=l),n&&(a.weekdays=n),{...H}}function WX(t){let{startDate:e,endDate:i}=t;return!rl.test(e)||!rl.test(i)?z({result:{error:H6},context:{startDate:e,endDate:i}}):{tournamentStartDate:new Date(Qe(e)).getTime(),tournamentEndDate:new Date(Qe(i)).getTime()}}function U_({event:t,orderedDrawIdsMap:e}){if(typeof t!="object")return{error:li};if(!e)return{error:Xe,info:"Missing drawIdsOrderMap"};if(typeof e!="object")return{error:ie,info:"orderedDrawIdsMap must be an object"};let i=Object.values(e);if(!i.every(n=>!Number.isNaN(Number(n))))return{error:ie,info:"drawOrder must be numeric"};if(rt(i).length!==i.length)return{info:"drawOrder values must be unique",error:ie};if(t.drawDefinitions?.length){let n=(t.drawDefinitions||[]).map(({drawId:s})=>s),a=Object.keys(e);if(a?.length&&xi(n,a).length!==n.length)return{error:ie,info:"Missing drawIds"};t.drawDefinitions.forEach(s=>{s.drawOrder=e[s.drawId]})}let{flightProfile:r}=$i({event:t});return r?.flights?.forEach(n=>{n.flightNumber=e[n.drawId]}),{...H}}function T_({tournamentRecord:t,event:e}){if(!t)return{error:Ie};if(!e)return{error:li};let{flightProfile:i}=$i({event:e}),r=i?.flights?.sort((s,o)=>s.flightNumber-o.flightNumber).map(s=>s.drawId).filter(Boolean),n=e.drawDefinitions?.sort((s,o)=>s.drawOrder-o.drawOrder).map(s=>s.drawId).filter(Boolean).filter(s=>!r?.includes(s)),a=Object.assign({},...[...r||[],...n||[]].map((s,o)=>({[s]:o+1})));return a?U_({event:e,orderedDrawIdsMap:a}):{...H}}function zX({autoPublish:t=!0,tournamentRecord:e,auditData:i,drawId:r,event:n,force:a}){if(!e)return{error:Ie};if(!r)return{error:Oo};if(!n)return{error:li};let{flightProfile:s}=$i({event:n});if(s&&s.flights?.find(o=>o.drawId===r)){let o=s.flights.filter(u=>u.drawId!==r),l={name:Xs,value:{...s,flights:o}};Ld({event:n,extension:l})}if(n.drawDefinitions?.find(o=>o.drawId===r)){let o=CC({drawIds:[r],eventId:n.eventId,tournamentRecord:e,autoPublish:t,auditData:i,event:n,force:a});if(o.error)return o}return T_({tournamentRecord:e,event:n})}function qX(t){let e=Ge(t,[{[kc]:!0,[mr]:!0,[RF]:!1},{replacementIndividualParticipantId:!0,[Wr]:g=>ri(g),existingIndividualParticipantId:!0,[xs]:lr,participantId:!0}]),{replacementIndividualParticipantId:i,existingIndividualParticipantId:r,tournamentRecord:n,drawDefinition:a,participantId:s,event:o,uuids:l}=t;if(e.error)return e;if(o?.eventType!==ls)return{error:Zl};if(!(o?.entries?.filter(({entryStatus:g})=>[ys,of].includes(g)).map(({participantId:g})=>g)||[]).includes(i))return{error:To};let u=(n.participants||[]).find(g=>g.participantId===s);if(u?.participantType!==pt)return{error:Up,participant:u};let c=u.individualParticipantIds,d=[i,...c.filter(g=>g!==r)],{participant:p}=Qs({participantIds:d,tournamentRecord:n}),f;if(p)f=p.participantId;else{let g={participantId:l?.pop(),participantRole:Kr,individualParticipantIds:d,participantType:pt},I=ul({participant:g,returnParticipant:!0,tournamentRecord:n});if(I.error)return I;f=I.participant.participantId}let{flightProfile:m}=$i({event:o});if(a){let g=m?.flights?.find(({drawId:I})=>I===a.drawId);g&&(g.drawEntries=g.drawEntries.map(I=>I.participantId===s?{...I,participantId:f}:I)),a.entries=a.entries.map(I=>I.participantId===s?{...I,participantId:f}:I);for(let I of a.structures||[])if(I.structures){I.positionAssignments=void 0;for(let v of I.structures)v.positionAssignments=v.positionAssignments.map(w=>w.participantId===s?{...w,participantId:f}:w)}else I.positionAssignments&&(I.positionAssignments=I.positionAssignments.map(v=>v.participantId===s?{...v,participantId:f}:v))}o.entries=o.entries.map(g=>g.participantId===s&&{...g,participantId:f}||g.participantId===i&&{...g,participantId:r}||g);let h=n.events.some(({entries:g,eventId:I,drawDefinitions:v})=>o.eventId===I?v.some(({drawId:w,entries:y})=>w===a?.drawId?!1:y?.find(b=>b.participantId===s)):g?.find(w=>w.participantId===s));if(!h){let g=yh({addIndividualParticipantsToEvents:!1,participantIds:[s],tournamentRecord:n});if(g.error)return g}return{...H,participantOtherEntries:h,newPairParticipantId:f}}function xS(t){let{flight:e,suppressNotifications:i,modifyEventEntries:r,existingDrawCount:n,allowReplacement:a,checkEntryStatus:s,tournamentRecord:o,drawDefinition:l,event:u}=t;if(!l)return{error:_e};if(!u)return{error:li};u.drawDefinitions||(u.drawDefinitions=[]);let{drawId:c,drawName:d,entries:p}=l,{entries:f}=u,m=0;if(n!==void 0&&n!==u.drawDefinitions.length)return{error:ie,info:"drawDefintions count mismatch"};let{flightProfile:h}=$i({event:u}),g=e&&h?.flights?.find(R=>R.flightNumber===e.flightNumber),I=h?.links?.find(R=>R?.target?.drawId===c)?.source?.drawId;if(I&&!u.drawDefinitions.find(R=>R.drawId===I))return z({result:{error:_e},info:{sourceDrawId:I}});if(g&&g.drawId!==l.drawId)return z({result:{error:tm},info:{relevantFlight:g}});let v=p?.every(({participantId:R,entryStatus:C})=>{let M=g?.drawEntries.find(N=>N.participantId===R);return!C||M?.entryStatus===C}),w=!s||f&&p?.every(({participantId:R,entryStatus:C,entryStage:M})=>f.find(N=>N.participantId===R&&(!N.entryStage||N.entryStage===M))?.entryStatus===C);if(g&&!v)return z({result:{error:tm},context:{drawEntriesPresentInFlight:v,matchingEventEntries:w,relevantFlight:g},info:"Draw entries are not present in flight or do not match entryStatuses"});if(r&&p?.filter(Boolean).forEach(R=>{if(R?.entryStatus&&so.includes(R?.entryStatus)){let C=f?.filter(Boolean).find(M=>M.participantId===R.participantId);C&&R.entryStatus&&C?.entryStatus!==R.entryStatus&&(C.entryStatus=R.entryStatus,m+=1)}}),f&&!w)return z({result:{info:"Draw entries do not match event entryStatuses",context:{matchingEventEntries:w,eventEntries:f},error:tm}});let y=h?.flights?.map(({flightNumber:R})=>!isNaN(R)&&Ye(R))?.filter(Boolean)||[],b=u.drawDefinitions.map(({drawOrder:R})=>R&&Ye(R))?.filter(Boolean)||[],S=Math.max(0,...b,...y)+1,U=h?.flights?.find(R=>R.drawId===c),T;if(U){U.drawName=l.drawName,T={name:Xs,value:{...h,flights:h.flights}};let R=U.flightNumber;R&&!b.includes(R)?S=R:U.flightNumber=S}else{let R=h?.flights||[];R.push({manuallyAdded:!0,flightNumber:S,drawEntries:p,drawName:d,drawId:c}),T={name:Xs,value:{...h||{},flights:R}}}Ld({event:u,extension:T}),Object.assign(l,{drawOrder:S});let P=u.drawDefinitions.find(R=>R.drawId===c),D=o?.tournamentId,E=u.eventId;if(P){if(!a)return{error:I6};let R=Rn({drawDefinition:P})?.matchUps?.map(Ir)??[],C=Rn({drawDefinition:l})?.matchUps;if(!i){R?.length&&Pu({matchUpIds:R,action:"modifyDrawDefinition",tournamentId:D,eventId:E}),C?.length&&hd({matchUps:C,tournamentId:D,eventId:E}),u.drawDefinitions=u.drawDefinitions.map(N=>N.drawId===c?l:N);let M=l.structures?.map(({structureId:N})=>N);ti({drawDefinition:l,tournamentId:D,structureIds:M,eventId:E})}}else if(u.drawDefinitions.push(l),!i){let{matchUps:R}=Rn({drawDefinition:l,event:u});R&&hd({tournamentId:o?.tournamentId,matchUps:R}),zw({drawDefinition:l,tournamentId:D,eventId:E})}return{...H,modifiedEventEntryStatusCount:m}}function YX(t){let{provisionalPositioning:e,useExistingSeedLimit:i,tournamentRecord:r,drawDefinition:n,seedingProfile:a,structureId:s,assignments:o,drawId:l,event:u}=t,c=0;if(!o?.length)return{error:V1};if(!r)return{error:Ie};if(!l)return{error:Oo};let d=ds({provisionalPositioning:e,drawDefinition:n,structureId:s});if(d.error)return d;let{seedAssignments:p,seedLimit:f}=d,m=Object.assign({},...(p??[]).filter(I=>I.seedNumber).map(I=>({[I.seedNumber]:I})));o.forEach(I=>{let{seedNumber:v}=I;f&&v<=f&&(!i||m[v])&&(m[v]=I)});let h=Object.values(m),g=h.map(I=>I?.participantId).filter(Boolean);if(g.length!==a6(g).length)return{error:v6};for(let I of h){let v=mv({...I,provisionalPositioning:e,tournamentRecord:r,drawDefinition:n,seedingProfile:a,structureId:s,event:u});if(v?.error)return v;v?.success&&c++}return c?{...H,modifications:c}:{error:tv}}function D_({deleteExisting:t,event:e,flightProfile:i}){let r="attachFlightProfile";if(!i)return z({result:{error:Xe},stack:r});if(!e)return z({result:{error:li},stack:r});let{flightProfile:n}=$i({event:e});return n&&!t?z({result:{error:rF},stack:r}):e.drawDefinitions?.length?z({result:{error:p6},stack:r}):(Ld({event:e,extension:{name:Xs,value:i}}),{flightProfile:ke(i,!1,!0),...H})}function CRe({tournamentRecord:t,scaleAttributes:e,participantIds:i}){if(!t)return{error:Ie};if(!i)return{error:Od};if(!e)return{error:Xe,info:"scaleAttributes required"};let{scaleType:r,eventType:n,scaleName:a}=e,s=[VK,r,n,a].join(".");return t.participants?.forEach(o=>{i.includes(o.participantId)&&o.timeItems&&(o.timeItems=o.timeItems.filter(l=>l&&l?.itemType!==s))}),{...H}}function P_({tournamentRecord:t,scaleAttributes:e,drawDefinition:i,entryStatuses:r,drawId:n,event:a,stage:s}){if(!a)return{error:li};if(r&&!Array.isArray(r))return z({result:{error:ie},info:Ap("entryStatus"),stack:"removeScaleValues"});let o=a.entries;if(n){let{flightProfile:u}=$i({event:a}),c=u?.flights?.find(d=>d.drawId===n);c?o=c.drawEntries:o=i?.entries}let l=(o||[]).filter(u=>(!s||!u.entryStage||u.entryStage===s)&&(!r||r.includes(u.entryStatus))).map(vt);return CRe({tournamentRecord:t,scaleAttributes:e,participantIds:l})}function NC({removePriorValues:t,tournamentRecord:e,displaySettings:i,status:r=Ha,event:n}){if(!e)return z({result:{error:Ie}});if(!n)return z({result:{error:li}});if(!bt(i))return z({result:{error:Xe}});if(bt(i.draws))for(let s of Object.keys(i.draws)){let o=i.draws[s].scheduleDetails??[];if(o.length){let l=[];for(let u of o){let c=l.find(d=>nIe(d.attributes,u.attributes));c?.dates&&u.dates?c.dates.push(...u.dates):l.push(u)}i.draws[s].scheduleDetails=l}}let a=Sv({statusObject:{displaySettings:i},removePriorValues:t,status:r,event:n});return a.error?a:{...H}}function KX({tournamentRecord:t,drawDefinition:e,entryStatuses:i,scaleName:r,drawId:n,event:a,stage:s}){if(!t)return{error:Ie};if(!a)return{error:li};r=r||a.category?.categoryName||a.category?.ageCategoryCode;let o={eventType:a.eventType,scaleType:jl,scaleName:r};return P_({tournamentRecord:t,scaleAttributes:o,drawDefinition:e,entryStatuses:i,drawId:n,event:a,stage:s})}function XX(t){let e=Ge(t,[{[mr]:!0},{eventIds:!0,[zn]:an}]);if(e.error)return e;let{removePairParticipants:i,tournamentRecord:r,eventIds:n}=t,a=[],s=[],o=[],l=[];if(r.events=(r.events||[]).filter(u=>{if(n.includes(u.eventId)){let p={action:nD,payload:{events:[u]}};a.push(p),s.push({tournamentId:r.tournamentId,eventName:u.eventName,eventType:u.eventType,category:u.category,eventId:u.eventId,gender:u.gender})}let c=u.eventType===ls?(u.entries||[]).map(({entryStatus:p,participantId:f})=>p!==ys&&f).filter(Boolean):[],d=n.includes(u.eventId);return d?l.push(...c):o.push(...c),!d}),i){let u=l.filter(c=>!o.includes(c));r.participants=r.participants.filter(({participantId:c})=>!u.includes(c))}if(NS({tournamentRecord:r}),a.length)if(eR(Qu)){let u=r.tournamentId;at({topic:Qu,payload:{type:nD,tournamentId:u,detail:a}})}else US({tournamentRecord:r,timeItem:{itemValue:s,itemType:nD}});return{...H}}function JX(t){let e=Ge(t,[{tournamentRecord:!0,eventId:!0,event:!0},{eventUpdates:!0,_ofType:Yn}]);if(e.error)return e;let{eventUpdates:i,event:r}=t,n="modifyEvent",a=ORe(t),s=xRe({enteredParticipants:a}),{enteredParticipantGenders:o,enteredParticipantTypes:l}=s,u=$i({event:r})?.flightProfile?.flights,c=!r.drawDefinitions?.length&&!u?.length,d=FRe({noFlightsNoDraws:c,enteredParticipantGenders:o,eventUpdates:i,stack:n});if(d.error)return d;let p=LRe({enteredParticipantTypes:l,eventUpdates:i,stack:n});if(p.error)return p;let f=MRe({...t,...s,enteredParticipants:a,stack:n});if(f.error)return f;let m=kRe({...t,stack:n});return m.error?m:(i.eventType&&(r.eventType=i.eventType),i.eventName&&(r.eventName=i.eventName),i.gender&&(r.gender=i.gender),{...H})}function MRe(t){let e=t.eventUpdates?.category;if(!e)return{...H};let i=hb({category:e});if(i.error)return i;if(t.event.eventType===rr){let r=NRe(t);if(r.error)return r}if(t.enteredParticipants?.length){let r=ARe(t,e);if(r.error)return r}return{...H}}function NRe(t){let e=t.event?.drawDefinitions?.map(n=>$o(n))??[],i=$o(t.event),r=(Ru(t)?.matchUps??[]).map(n=>$o(n))??[];return[i,...e,...r].filter(Boolean).every(n=>n.collectionDefinitions.every(a=>!a.category||Fw({category:t.eventUpdates.category,childCategory:a.category})))?{...H}:z({result:{error:ub},stack:t.stack})}function ARe(t,e){let i=t.eventUpdates.startDate||t.event.startDate||t.tournamentRecord.startDate,r=t.eventUpdates.endDate||t.event.endDate||t.tournamentRecord.endDate,n=t.enteredParticipants.flatMap(o=>o.participantType===gt?[o]:o.individualParticpants??[]),a=Tp({category:e,consideredDate:i}),s=Tp({category:e,consideredDate:r});if(a?.ageMinDate||a?.ageMaxDate||s?.ageMinDate||s?.ageMaxDate)for(let o of n){let l=o.person?.birthDate;if(!l)return z({result:{error:B6},stack:t.stack});let u=new Date(l).getTime(),c=EW(u,a,t.stack);if(c)return c;let d=EW(u,s,t.stack);if(d)return d}return{...H}}function EW(t,e,i){if(!e)return null;if(e.ageMinDate||e.ageMaxDate){let r=new Date(e.ageMinDate).getTime(),n=new Date(e.ageMaxDate).getTime();if(t<r||t>n)return z({result:{error:q6},stack:i})}return null}function kRe(t){let{tournamentRecord:e,eventUpdates:i,event:r,stack:n}=t;if(i.startDate||i.endDate){let a=S_({startDate:i.startDate||r.startDate||e.startDate,endDate:i.endDate||r.endDate||e.endDate,tournamentRecord:e,event:r});if(a.error)return z({result:a,stack:n})}return{...H}}function ORe(t){let{tournamentRecord:e,event:i}=t,r=i?.entries?.filter(({entryStatus:n})=>{let a=n;return[...so,Fs].includes(a)}).map(({participantId:n})=>n)??[];return r?Ei({participantFilters:{participantIds:r},withIndividualParticipants:!0,tournamentRecord:e}).participants??[]:[]}function xRe({enteredParticipants:t}){let e=[],i=t.reduce((n,a)=>{let s=a.person?.sex?[a.person.sex]:a.individualParticpants?.map(o=>o.person?.sex)||[];return e.push(...s),n.includes(a.participantType)?n:n.concat(a.participantType)},[]),r=rt(e);return{enteredParticipantTypes:i,enteredParticipantGenders:r}}function FRe({noFlightsNoDraws:t,enteredParticipantGenders:e,eventUpdates:i,stack:r}){let n=!e.length||!i.gender||eu(i.gender)||e.length===1&&e[0]===i.gender||t&&Na(i.gender);return i.gender&&!n?z({context:{gender:i.gender,validGender:n},result:{error:xy},stack:r}):{...H}}function LRe({enteredParticipantTypes:t,eventUpdates:e,stack:i}){let r=(t.includes(rr)&&[rr]||t.includes(gt)&&[nl]||t.includes(pt)&&[ls]||[ls,nl,rr]).includes(e.eventType??"");return e.eventType&&!r?z({context:{participantType:e.eventType,validEventType:r},result:{error:Zl},stack:i}):{...H}}function AC({qualifyingPositions:t,drawEntries:e=[],drawName:i,drawId:r,event:n,stage:a}){let s="addFlight";if(!n)return z({result:{error:li},stack:s});if(!i)return z({result:{error:Xe},stack:s});if(e?.length){let f=(n.entries??[]).map(vt),m=e.map(vt);if(xi(m,f).length!==m.length)return z({result:{error:ie},stack:s})}let o=$i({event:n})?.flightProfile,l=o?.flights?.map(({flightNumber:f})=>!isNaN(f)&&Ye(f))?.filter(Boolean)||[],u=Math.max(0,...l)+1,c={drawId:r||Et(),flightNumber:u,drawEntries:e,drawName:i};if(a&&(c.stage=a),t&&(c.qualifyingPositions=t),(o?.flights||[]).find(({drawId:f})=>f===c.drawId))return z({result:{error:w4},stack:s});let d=(o?.flights||[]).concat(c),p={name:Xs,value:{...o||{},flights:d}};return Ld({event:n,extension:p})}var QX={};ct(QX,{drawMatic:()=>L0,garman:()=>nJ,generateAdHocMatchUps:()=>iC,generateAdHocRounds:()=>F0,generateAndPopulatePlayoffStructures:()=>QL,generateCourts:()=>E_,generateDrawDefinition:()=>OS,generateDrawMaticRound:()=>f0,generateDrawStructuresAndLinks:()=>c0,generateDrawTypeAndModifyDrawDefinition:()=>d0,generateFlightProfile:()=>BRe,generateLineUps:()=>rJ,generateQualifyingStructure:()=>zL,generateSeedingScaleItems:()=>RX,generateStatCrew:()=>VRe,generateVoluntaryConsolation:()=>c9,roundRobinGroups:()=>qwe});var _Re="splitLevelBased",ZX="splitWaterfall",eJ="splitShuttle",$Re={SPLIT_LEVEL_BASED:_Re,SPLIT_WATERFALL:ZX,SPLIT_SHUTTLE:eJ};function BRe(t){let{drawNameRoot:e="Flight",attachFlightProfile:i,tournamentRecord:r,scaleAttributes:n,scaleSortMethod:a,deleteExisting:s,sortDescending:o,drawNames:l=[],flightsCount:u,splitMethod:c,uuids:d=[],event:p,stage:f}=t;if(!p)return{error:li};let m=p.entries??[],{flightProfile:h}=$i({event:p});if(h&&i&&!s)return{error:rF};let g=t.scaledEntries??Dh({tournamentRecord:r,scaleAttributes:n,scaleSortMethod:a,sortDescending:o,event:p,stage:f}).scaledEntries,I=new Set(g.map(vt)),v=Dn(m.filter(({participantId:D})=>!I.has(D)).filter(D=>(!f||!D.entryStage||D.entryStage===f)&&(!D.entryStatus||lf.includes(D.entryStatus)))),w=g.concat(...v),y=w.length,b=Math.ceil(y/u),S=yr(w,b);c===ZX?S=qk(w,u):c===eJ&&(S=qk(w,u,!0));function U(D){return(D||[]).map(({participantId:E,scaleValue:R})=>{let C=m.find(M=>M.participantId===E);return C?.scaleValue&&R&&(C.scaleValue=R),C}).sort((E,R)=>E.scaleValue-R.scaleValue).map((E,R)=>(E.scaleValue&&(E.seedNumber=R+1),E))}let T=Re(0,u).map(D=>{let E=D+1;return{flightNumber:E,drawId:d?.pop()??Et(),drawEntries:U(S[D]),drawName:l?.length&&l[D]||`${e} ${E}`}}),P={scaleAttributes:n,splitMethod:c,flights:T};if(i){let D=D_({flightProfile:P,deleteExisting:s,event:p});return{splitEntries:ra()&&S||void 0,...D}}else return{flightProfile:P,...H}}function tJ({json:t,tagName:e}){let i=Object.keys(t).filter(a=>Array.isArray(t[a])).map(a=>({key:a,value:t[a].filter(s=>typeof s=="object"&&Object.keys(s).length===1)})),r=Object.keys(t).filter(a=>typeof t[a]=="object"&&!Array.isArray(t[a])).map(a=>({key:a,value:t[a]})),n=Object.keys(t).filter(a=>["string","number"].includes(typeof t[a])).map(a=>({key:a,value:t[a]}));return iJ({tagName:e,attributes:n,childArrays:i,childObjects:r})}function iJ(t){let{tagName:e,attributes:i=[],childArrays:r=[],childObjects:n}=t,a=`\r
`,s=f=>{let m=Object.keys(f)[0],h=f[m];return{key:m,value:h}},o=r?.map(({key:f,value:m})=>iJ({tagName:f,childObjects:m.map(s)})).join(`\r
`),l=n?.map(({key:f,value:m})=>tJ({tagName:f,json:m??[]})).join(`\r
`),u=i?.map(({key:f,value:m})=>`${f}="${m}"`).join(" "),c=u?` ${u}`:"";if(e==="childArray")return l;let d=l?.length?`${a}${l}${a}`:"",p=o?.length?`${a}${o}${a}`:"";return`<${e}${c}>${d}${p}</${e}>`}function VRe(t){let e=Ge(t,[{[mr]:!0}]);if(e.error)return e;let{tournamentRecord:i}=t,{startDate:r,tournamentId:n,tournamentName:a}=i,{participantMap:s,matchUps:o,mappedMatchUps:l}=Ei({withMatchUps:!0,withEvents:!0,tournamentRecord:i}),u=i.participants.filter(w=>w.participantType===Lt),c=o?.filter(w=>w.matchUpType===Lt)??[],d=c?.reduce((w,y)=>{let b=y?.tieMatchUps??[];return b&&[...w,...b]},[])??[],p=o?.filter(w=>w.matchUpType===Wt)??[],f=o?.filter(w=>w.matchUpType===$t)??[],m=d.length===p.length+f.length,h=c.length===1&&m,g={mappedMatchUps:l,participantMap:s,tournamentName:a,tournamentId:n,tournament:m?"N":"Y",startDate:r},I=[],v=[];if(h){let w=c[0],{json:y,xml:b}=RW({teamParticipants:u,teamMatchUp:w,...g,doubles:f,singles:p});v.push(y),I.push(b)}else for(let w of c){let y=w?.sides?.map(({participant:T})=>T?.participantId).filter(Boolean);if(y?.length!==2)continue;let b=y.map(T=>T&&s?.[T]?.participant),{xml:S,json:U}=RW({doubles:w.tieMatchUps?.filter(T=>T.matchUpType===$t),singles:w.tieMatchUps?.filter(T=>T.matchUpType===Wt),teamParticipants:b,teamMatchUp:w,...g});v.push(U),I.push(S)}return{json:v,xml:I,...H}}function RW({teamParticipants:t,mappedMatchUps:e,participantMap:i,tournamentName:r,tournamentId:n,teamMatchUp:a,tournament:s,startDate:o,doubles:l,singles:u}){let c=t?.find(y=>y.participantRoleResponsibilities?.includes("Home")),d=t?.filter(y=>y.participantId!==c?.participantId),p=Os(o,"/","MDY"),f=c?.participantName||d?.[1]?.participantName,m=c?.participantId||d?.[1]?.participantId,h=d?.[0]?.participantName,g=d?.[0]?.participantId,I={},v=t.map(y=>({team:{...HRe({teamParticipant:y,teamMatchUp:a,uniValues:I,participantMap:i,mappedMatchUps:e,homeid:m})}})),w=Ve({venue:{tournamentname:s?r:void 0,neutralgame:c?"N":"Y",gameid:n,officials:{},tournament:s,rules:{},homename:f,visname:h,homeid:m,visid:g,date:p},childArray:v,singles_matches:u?.map(y=>CW({matchUp:y,homeid:m,uniValues:I})),doubles_matches:l?.map(y=>CW({matchUp:y,homeid:m,uniValues:I}))});return{json:w,xml:tJ({json:w,tagName:"tngame"})}}function jRe({homeid:t,uniValues:e,participant:i}){if(!i)return{};let r=i.individualParticipants?.length===2,n=r?rt(i.individualParticipants?.map(h=>h.teams?.[0]?.participantId)):[],a=r?rt(i.individualParticipants?.map(h=>h.teams?.[0]?.teamId)):[],s=!r&&i.teams?.[0]?.participantId||n?.length===1&&n[0]||void 0,o=!r&&i.teams?.[0]?.teamId||a?.length===1&&a[0]||s,l=r?void 0:i.participantName,u=i.individualParticipants?.[0]?.participantName,c=i.individualParticipants?.[1]?.participantName,d=t&&(s===t?"H":"V")||"",p=r?void 0:e[s][i.participantId],f=e[s][i.individualParticipants?.[0]?.participantId],m=e[s][i.individualParticipants?.[1]?.participantId];return Ve({vh:d,uni:p,uni_1:f,uni_2:m,team:o,name:l,name_1:u,name_2:c})}function GRe({sets:t,sideNumber:e}){return Object.assign({},...t?.map(i=>{let{setNumber:r,side1Score:n,side2Score:a,side1TiebreakScore:s,side2TiebreakScore:o}=i,l=`set_${r}`,u=`tie_${r}`,c=e===1?n:a,d=e===1?s:o;return{[l]:c,[u]:d}})??[])}function HRe({teamParticipant:t,teamMatchUp:e,participantMap:i,mappedMatchUps:r,homeid:n,uniValues:a}){let{participantId:s,participantName:o}=t,l=n&&(s===n?"H":"V")||"",u=i?.[s]?.matchUps,c=u&&Object.keys(u),d=e?.sides?.find(({participant:y})=>y.participantId===s)?.sideNumber,p=e?.score?.sets?.[0]?.[`side${d}Score`]??0;a[s]={};let f={SINGLES:{w:0,l:0},DOUBLES:{w:0,l:0}},m=[],h=[],g=0;for(let y of c??[]){let b=r?.[y],S=b.sides.find(({participant:T})=>T.participantId===s)?.sideNumber,U=b.score?.sets?.[0]?.[`side${S}Score`]??0;g+=U;for(let T of b.tieMatchUps??[]){let{matchUpType:P,winningSide:D}=T,E=D&&(D===S?"w":"l")||"";E&&(f[P][E]+=1);let R=E==="w"?"1":"0",C=E==="l"?"1":"0";if(P===Wt){let M=h.length+1;h.push({singles_pair:{pair:M,won:R,lost:C,tied:"0"}})}else if(P===$t){let M=m.length+1;m.push({doubles_pair:{pair:M,won:R,lost:C,tied:"0"}})}}}let I=[{singles:{childArray:h,won:f.SINGLES.w,lost:f.SINGLES.l}},{doubles:{childArray:m,won:f.DOUBLES.w,lost:f.DOUBLES.l}}],v=[],w=1;for(let y of t.individualParticipantIds){let b=i?.[y];if(b){let{participant:S,counters:U}=b,T={won:U?.DOUBLES?.wins||0,lost:U?.DOUBLES?.losses||0},P={won:U?.SINGLES?.wins||0,lost:U?.SINGLES?.losses||0},{participantName:D,participantId:E}=S;a[s][E]=w,v.push({player:{name:D,uni:w,singles:P,doubles:T}})}w+=1}return{vh:l,id:s,name:o,score:p||g,totals:I,childArray:v}}function CW({matchUp:t,homeid:e,uniValues:i}){let{collectionPosition:r,orderOfFinish:n,matchUpType:a,sides:s}=t??{},o=s?.map(l=>{let{sideNumber:u,participant:c}=l,d=GRe({sets:t.score?.sets,sideNumber:u});return{[a===Wt?"singles_score":"doubles_score"]:{...jRe({homeid:e,uniValues:i,participant:c}),...d}}});return{[a===Wt?"singles_match":"doubles_match"]:{match:r,order:n,childArray:o}}}var WRe="DESC",BO="DESC",zRe={ASC:"ASC",ASCENDING:"ASC",DESC:WRe,DESCENDING:BO};function rJ(t){let{tieFormat:e}=t,{useDefaultEventRanking:i,tournamentRecord:r,drawDefinition:n,scaleAccessor:a,singlesOnly:s,attach:o,event:l}=t;if(l?.eventType!==ya)return{error:Zl};if(!r)return{error:Ie};if(!e&&!n)return{error:Oa};if(e=e??vn({drawDefinition:n,event:l})?.tieFormat,Bn({tieFormat:e}).error)return{error:Vl};if(typeof a!="object"&&!i)return{error:ie,context:{scaleAccessor:a}};let u={},c=(n?.entries??l?.entries??[]).filter(E=>E?.entryStatus===aa).map(vt),{participants:d=[]}=Ei({withIndividualParticipants:!0,withScaleValues:!0,tournamentRecord:r}),p=d.filter(({participantId:E})=>c.includes(E)),f=E=>E===ou?"rankings":"ratings",m=l?.category?.categoryName??l?.category?.ageCategoryCode,{scaleName:h=m,scaleType:g=ou,sortOrder:I,accessor:v}=a||{},w=f(g),y=(E,R)=>{let C=E[w]?.[R];if(!C&&i&&(C=E[w]?.[Zf]),Array.isArray(C)){let M=C.find(N=>N.scaleName===h)?.scaleValue;if(Ni(M))return M;if(v&&typeof M=="object")return M[v]}return 0},b=(E,R,C)=>{let M=I===BO?R:E,N=I===BO?E:R;return y(M,C)-y(N,C)},S=(E,R)=>b(E,R,Zf),U=(E,R)=>b(E,R,Sp),T=[],P=e?.collectionDefinitions??[];for(let E of p){let R=E.individualParticipants?.sort(S)??[],C=s?R:E.individualParticipants?.sort(U)??[],M={};for(let A of P){let O=[],{collectionId:k,matchUpCount:F,matchUpType:x,gender:L}=A,$=Di(Zf)(x);Re(0,F).forEach(V=>{let _=$?R:C??[],B=V+1,G=[];Re(0,$?1:2).forEach(j=>{let K=_?.find(Y=>{let X=on(L),Z=X&&(il(L)&&X||Na(L)&&[er,Hr][j]);return(!Z||Z===Y.person?.sex)&&!O.includes(Y.participantId)})?.participantId;K&&(G.push(K),O.push(K),M[K]||(M[K]=[]),M[K].push({collectionPosition:B,collectionId:k}))}),$||T.push(G)})}let N=Object.keys(M).map(A=>({collectionAssignments:M[A],participantId:A}));u[E.participantId]=N}let D=[];for(let E of T){let{participant:R}=Qs({tournamentParticipants:d,participantIds:E});if(!R){let C={individualParticipantIds:E,participantRole:Kr,participantType:pt};D.push(C)}}if(o){for(;D.length;)ul({participant:D.pop(),tournamentRecord:r});xt({element:n,extension:{name:cc,value:u}})}return{...H,lineUps:u,participantsToAdd:D}}function E_(t){if(!t)return{error:Xe};let e=Ge(t,[{dates:!1,[Wr]:s=>Array.isArray(s)&&s.every(Pn)},{uuids:!1,[Wr]:s=>Array.isArray(s)&&s.every(ri)},{startTime:!1,endTime:!1,[Wr]:pF},{idPrefix:!1,namePrefix:!1,[Wr]:ri},{count:!0,[Wr]:Ni}]);if(e.error)return e;let{startDate:i,endDate:r}=t.tournamentRecord??{},n=t.dates||i&&r&&Qg(i,r)||[],a=Re(1,t.count+1).map(s=>Ve({courtId:t.uuids?.pop()??(t.idPrefix&&`${t.idPrefix}-${s}`)??Et(),courtName:t.courtNames?.pop()??(t.namePrefix&&`${t.namePrefix} ${s}`),dateAvailability:n.map(o=>({startTime:t.startTime??"08:00",endTime:t.endTime??"20:00",date:o}))}));return{...H,courts:a}}var nJ={};ct(nJ,{default:()=>KRe,garman:()=>oJ});function Tv(t){let e=Ge(t,[{courtDate:!0,_ofType:Yn}]);if(e.error)return e;let{includeBookingTypes:i=[],courtDate:r}=t,n=[],a=Xi(r.startTime);(r.bookings||[]).filter(o=>!o.bookingType||!i.includes(o.bookingType)).sort((o,l)=>(GD(o.startTime)||"").localeCompare(GD(l.startTime)||"")).forEach(o=>{let l={startTime:ci(a.toISOString()),endTime:o.startTime};Xi(o.startTime)>a&&n.push(l),Xi(o.endTime)>a&&(a=Xi(o.endTime))});let s={startTime:ci(a.toISOString()),endTime:r.endTime};return Xi(r.endTime)>a&&n.push(s),{timeSlots:n}}function qRe({averageMatchUpMinutes:t,includeBookingTypes:e,periodStartTime:i,periodEndTime:r}){let n=s=>{let{timeSlots:o}=Tv({includeBookingTypes:e,courtDate:s});return!!o?.filter(a)?.length};function a(s){let o=Xi(s.startTime),l=Xi(s.endTime);return o>i||l<r?!1:xw(i,l)>=t}return{enoughTime:n}}function aJ(t){let e=Ge(t,[{periodStart:!0,date:!0},{courts:!0,_ofType:an}]);if(e.error)return e;let{averageMatchUpMinutes:i,includeBookingTypes:r,periodStart:n,date:a}=t,s=t.courts,o=Xi(n),l=mF(o,i),{enoughTime:u}=qRe({averageMatchUpMinutes:i,includeBookingTypes:r,periodStartTime:o,periodEndTime:l});return{availableToScheduleCount:(s?.filter(c=>{if(!Array.isArray(c.dateAvailability))return!1;let d=bd({date:a,court:c});return!!(d&&u(d))})||[]).length,...H}}function kC(t){let{remainingScheduleTimes:e=[],clearScheduleDates:i,periodLength:r=30,scheduleDate:n,courts:a=[]}=t,{bookings:s=[]}=t;if(!Array.isArray(a)||!a.length)return{error:ie,courts:a};if(!Array.isArray(s))return{error:$D};if(!Pn(n))return{error:sr};i&&(Array.isArray(i)?i.includes(n)&&(s=[]):s=[]);let{courtBookings:o,unassignedBookings:l}=s.reduce((p,f)=>{let{courtId:m}=f;return m?p.courtBookings[m]?p.courtBookings[m].push(f):p.courtBookings[m]=[f]:p.unassignedBookings.push(f),p},{courtBookings:{},unassignedBookings:[]}),u=a.map((p,f)=>{let{courtId:m,courtName:h}=p,g=o[m]||[],I=bd({date:n,court:p})||{},{bookings:v=[],startTime:w,endTime:y,date:b}=I,S=[e[f]&&{startTime:w,endTime:e[f]},...ke(v,!1,!0),...g].filter(Boolean);return{courtId:m,courtName:h,dateAvailability:{bookings:S,startTime:w,endTime:y,date:b}}});l.sort((p,f)=>Pt(p.startTime)-Pt(f.startTime));let c=()=>u.flatMap(p=>{let f=p.dateAvailability,{timeSlots:m=[]}=Tv({courtDate:f});return{courtName:p.courtName,courtId:p.courtId,timeSlots:m}}),d=[];for(let p of l){let{startTime:f,endTime:m,averageMinutes:h,recoveryMinutes:g,matchUpId:I}=p,v=Pt(f),w=Pt(m),y=c().reduce((b,{courtId:S,courtName:U,timeSlots:T})=>{let P;return T.find(({startTime:D,endTime:E})=>{P=Pt(D)-v;let R=v>=Pt(D);return w<=Pt(E)&&b.startDifference!==0&&((P===0||P+r>=0)&&(b.startDifference===void 0||P<b.startDifference)||R)})?{courtName:U,courtId:S,startDifference:P}:b},{});if(y.courtId){let b={averageMinutes:h,recoveryMinutes:g,matchUpId:I,startTime:f,endTime:m};d.push(b),u.find(({courtId:S})=>S===y.courtId)?.dateAvailability.bookings.push(b)}else console.log({unassignedBooking:p})}return{virtualCourts:u.map(({courtId:p,courtName:f,dateAvailability:m})=>({dateAvailability:[m],courtName:f,courtId:p})),assignedBookings:d}}function OC({averageMatchUpMinutes:t,periodLength:e=30,recoveryMinutes:i}){let r=(t||90)+(i||0);return e>r?r:e||30}function sJ(t){let{startTime:e="8:00",endTime:i="20:30",count:r=10,date:n}=t??{};return Re(0,r).map(()=>({dateAvailability:[{date:n,startTime:e,endTime:i}]}))}function fI({scheduleDate:t,startTime:e,endTime:i,courts:r}){let n=e&&"startTime"||i&&"endTime"||void 0;return r.reduce((a,s)=>{let o=bd({date:t,court:s}),l=n&&(o?.[n]||s[n]);return l&&(!a||e&&Pt(l)<Pt(a)||i&&Pt(l)>Pt(a))?l:a},void 0)}function YRe({averageMinutes:t,startTime:e,endTime:i,courts:r,date:n}){e=e||fI({courts:r,scheduleDate:n,startTime:!0}),i=i||fI({courts:r,scheduleDate:n,endTime:!0});let a;if(e&&i){let s=Xi(e),o=Xi(i);for(let l of r||[]){if(!Array.isArray(l.dateAvailability))continue;let u=bd({court:l,date:n}),{timeSlots:c}=Tv({courtDate:u});c?.forEach(d=>{let p=Xi(d.startTime),f=Xi(d.endTime);if(p>o||p<s||f<s)return!1;if(xw(p,f)>=t){let m=ci(p.toISOString());m&&(!a||m<a)&&(a=m)}})}}return{firstTimeSlotStartTime:a}}function R_(t){let e=Ge(t,[{courts:!0,_ofType:an}]);if(e.error)return e;let{date:i=dF(),startTime:r="08:00",endTime:n="19:00",periodLength:a,courts:s}=t,{calculateStartTimeFromCourts:o=!0,remainingScheduleTimes:l,averageMatchUpMinutes:u,clearScheduleDates:c,courtsCount:d,bookings:p}=t;a=a||OC({averageMatchUpMinutes:u}),i=Qe(i),r=ci(r),n=ci(n);let f=0,m=0,h=0,g=0,I=0;!s&&d&&(s=sJ({startTime:r,endTime:n,count:d,date:i}));let{virtualCourts:v}=kC({remainingScheduleTimes:l,clearScheduleDates:c,scheduleDate:i,periodLength:a,bookings:p,courts:s}),{firstTimeSlotStartTime:w}=YRe({averageMinutes:u,courts:v,startTime:r,endTime:n,date:i});o&&w&&(r=w??r);let y=Pt(r),b=Pt(n)-y,S=Math.floor(b/a),U=Re(0,S+1).map(T=>{let P=y+T*a,D=Rve(P),E=aJ({courts:v??[],averageMatchUpMinutes:u,periodStart:D,date:i});if(E.error)return{error:E.error};let{availableToScheduleCount:R=0}=E,C=R>m?R-m:0;I+=T?R:0;let M=T?I/T:R,N=a*M/u,A=T?N*(T-1)+M:M,O=R?m&&A-f||C:0;f=A,m=R,h+=O;let k=Ye(h)-g;return g+=k,{periodStart:D,add:k,availableToScheduleCount:R,newCourts:C,totalMatchUps:g}});return{scheduleTimes:U.reduce((T,P)=>{let D=Re(0,P.add).map(()=>({scheduleTime:P.periodStart}));return T.concat(...D)},[]).flat(),timingProfile:U,totalMatchUps:g}}var oJ={getCourtsAvailableAtPeriodStart:aJ,generateTimeSlots:Tv,getScheduleTimes:R_,courtGenerator:sJ},KRe=oJ,lJ={};ct(lJ,{isAggregateFormat:()=>pC,isValid:()=>xa,isValidMatchUpFormat:()=>xa,parse:()=>zi,stringify:()=>aR});var uJ={};ct(uJ,{allCompetitionMatchUps:()=>Eo,allDrawMatchUps:()=>Rn,allEventMatchUps:()=>Ru,allTournamentMatchUps:()=>br,analyzeMatchUp:()=>Nb,applyLineUps:()=>AJ,assignMatchUpSideParticipant:()=>dJ,assignTieMatchUpParticipantId:()=>gP,bulkMatchUpStatusUpdate:()=>RJ,calculateWinCriteria:()=>Ph,checkInParticipant:()=>M_,checkMatchUpIsComplete:()=>mp,checkOutParticipant:()=>C_,competitionScheduleMatchUps:()=>kS,disableTieAutoCalc:()=>DJ,drawMatchUps:()=>p_,enableTieAutoCalc:()=>SJ,eventMatchUps:()=>PC,filterMatchUps:()=>Hu,findMatchUp:()=>J0,getAllDrawMatchUps:()=>Qi,getAllStructureMatchUps:()=>Nt,getCheckedInParticipantIds:()=>hh,getCompetitionMatchUps:()=>Mb,getEventMatchUpFormatTiming:()=>r_,getHomeParticipantId:()=>o_,getMatchUpCompetitiveProfile:()=>nS,getMatchUpContextIds:()=>l_,getMatchUpDailyLimits:()=>RC,getMatchUpDailyLimitsUpdate:()=>n_,getMatchUpDependencies:()=>oo,getMatchUpFormat:()=>u_,getMatchUpFormatTiming:()=>aS,getMatchUpFormatTimingUpdate:()=>i_,getMatchUpScheduleDetails:()=>FR,getMatchUpType:()=>LR,getMatchUpsStats:()=>c_,getModifiedMatchUpFormatTiming:()=>DC,getParticipantResults:()=>cS,getPredictiveAccuracy:()=>s_,getRoundMatchUps:()=>bn,getRounds:()=>d_,isValidMatchUpFormat:()=>xa,matchUpActions:()=>eC,mutate:()=>cJ,participantScheduledMatchUps:()=>a_,query:()=>wX,removeDelegatedOutcome:()=>UJ,removeMatchUpSideParticipant:()=>k_,removeTieMatchUpParticipantId:()=>fJ,replaceTieMatchUpParticipantId:()=>A_,resetAdHocMatchUps:()=>MJ,resetMatchUpLineUps:()=>B_,resetScorecard:()=>j_,resetTieFormat:()=>V_,setDelegatedOutcome:()=>CJ,setMatchUpFormat:()=>PJ,setMatchUpState:()=>ff,setMatchUpStatus:()=>FS,setOrderOfFinish:()=>NJ,substituteParticipant:()=>TJ,tallyParticipantResults:()=>Ih,toggleParticipantCheckInState:()=>xC,tournamentMatchUps:()=>EC,updateTieMatchUpScore:()=>_c,validMatchUp:()=>MR,validMatchUps:()=>Ga});var cJ={};ct(cJ,{applyLineUps:()=>AJ,assignMatchUpSideParticipant:()=>dJ,assignTieMatchUpParticipantId:()=>gP,bulkMatchUpStatusUpdate:()=>RJ,checkInParticipant:()=>M_,checkOutParticipant:()=>C_,disableTieAutoCalc:()=>DJ,enableTieAutoCalc:()=>SJ,findMatchUp:()=>J0,removeDelegatedOutcome:()=>UJ,removeMatchUpSideParticipant:()=>k_,removeTieMatchUpParticipantId:()=>fJ,replaceTieMatchUpParticipantId:()=>A_,resetAdHocMatchUps:()=>MJ,resetMatchUpLineUps:()=>B_,resetScorecard:()=>j_,resetTieFormat:()=>V_,setDelegatedOutcome:()=>CJ,setMatchUpFormat:()=>PJ,setMatchUpState:()=>ff,setMatchUpStatus:()=>FS,setOrderOfFinish:()=>NJ,substituteParticipant:()=>TJ,toggleParticipantCheckInState:()=>xC,updateTieMatchUpScore:()=>_c});function dJ({tournamentRecord:t,drawDefinition:e,participantId:i,sideNumber:r,matchUpId:n,event:a}){if(i&&typeof i!="string")return{error:To};if(!e)return{error:_e};if(!n)return{error:Un};let s=r===void 0;if(s&&(r=1),![1,2].includes(r))return z({result:{error:ie,context:{sideNumber:r}}});let{matchUp:o,structure:l}=di({drawDefinition:e,matchUpId:n,event:a});if(!o)return{error:un};if(!(!l?.structures&&!(e.drawType&&e.drawType!==na)&&!l?.matchUps?.find(({roundPosition:u})=>!!u)))return{error:L1};if(!i&&(o?.score?.scoreStringSide1||Yi.includes(o?.matchUpstatus)||o?.matchUpStatus&&[wi,Hi].includes(o.matchUpStatus)))return{error:zE,info:"matchUp has completed status or score"};if(o){if(o.sides=[1,2].map(u=>{let c=o.sides?.find(d=>d.sideNumber===u)??{sideNumber:u};return r===u?{...c,participantId:i}:c}),s)for(let u of o.sides)u.sideNumber&&(u.sideNumber=3-u.sideNumber);St({tournamentId:t?.tournamentId,context:"assignSideParticipant",drawDefinition:e,matchUp:o})}return{...H,sidesSwapped:s}}function wa({removePriorValues:t,tournamentRecord:e,duplicateValues:i,drawDefinition:r,disableNotice:n,matchUpId:a,timeItem:s,event:o}){let{matchUp:l}=di({drawDefinition:r,event:o,matchUpId:a});if(!l)return{error:un};let u=Dl({removePriorValues:t,element:l,duplicateValues:i,timeItem:s});return n||St({tournamentId:e?.tournamentId,eventId:o?.eventId,context:"addTimeItem",drawDefinition:r,matchUp:l}),u}function C_(t){let e=[{[mr]:!0},{[mn]:!0},{[su]:!0},{[Ul]:!0}],i=Ge(t,e);if(i.error)return i;let r=bv(t,[{[nv]:Du,attr:{[hR]:!0}}]);if(r.error)return r;let{tournamentRecord:n,drawDefinition:a,participantId:s,matchUpId:o}=t,l=r?.matchUp?.matchUp,{matchUpStatus:u,score:c}=l??{};if(u&&_F.includes(u)||u&&Yi.includes(u)||cr({score:c}))return{error:w6};let d=hh({matchUp:l});if(d?.error)return d;let{checkedInParticipantIds:p,allRelevantParticipantIds:f}=d??{};if(!f?.includes(s))return{error:To};if(!p?.includes(s))return{error:e4};let m=xK({matchUp:l});if(m?.error)return m;let{sideParticipantIds:h,nestedIndividualParticipantIds:g}=m??{},I=h?.indexOf(s);return I!==void 0&&[0,1].includes(I)&&(g?.[I]??[]).forEach(v=>{wa({drawDefinition:a,matchUpId:o,timeItem:{itemType:eP,itemValue:v}})}),wa({tournamentRecord:n,drawDefinition:a,matchUpId:o,timeItem:{itemValue:s,itemType:eP}}),{...H,checkedOut:!0}}function M_(t){let e=[{[mr]:!0},{[mn]:!0},{[su]:!0},{[Ul]:!0}],i=Ge(t,e);if(i[xs])return i;let r=bv(t,[{[nv]:Du,attr:{[hR]:!0}}]);if(r[xs])return r;let{tournamentRecord:n,drawDefinition:a,participantId:s,matchUpId:o}=t,l=hh({matchUp:r?.matchUp?.matchUp});if(l?.error)return l;let{checkedInParticipantIds:u,allRelevantParticipantIds:c}=l??{};if(!c?.includes(s))return{[xs]:To};let d={...H,checkedIn:!0};return u?.includes(s)||wa({tournamentRecord:n,drawDefinition:a,matchUpId:o,timeItem:{itemValue:s,itemType:ZD}}),d}function xC(t){let e=Ge(t,[{[su]:!0,[mn]:!0,[Ul]:!0}]);if(e.error)return e;let i=t.tournamentId??t.activeTournamentId,r=t.tournamentRecord??(i&&t.tournamentRecords?.[i]);if(!r)return{error:Ie};let n=bv(t,[{[nv]:Du,attr:{[hR]:!0},[xs]:un}]).matchUp?.matchUp;if(!n)return{error:un};let{checkedInParticipantIds:a=[]}=hh({matchUp:n}),{participantId:s,matchUpId:o,drawDefinition:l}=t;return s&&a.includes(s)?C_({tournamentRecord:r,drawDefinition:l,participantId:s,matchUpId:o,matchUp:n}):M_({tournamentRecord:r,drawDefinition:l,participantId:s,matchUpId:o,matchUp:n})}function N_({tournamentRecord:t,drawDefinition:e,tieMatchUpId:i,event:r}){if(!t)return{error:Ie};if(!e)return{error:Oo};if(!r)return{error:os};let n=kr({drawDefinition:e}),{matchUp:a}=di({matchUpId:i,drawDefinition:e,matchUpsMap:n});if(!a)return{error:un};let{matchUp:s,structure:o}=di({tournamentParticipants:t.participants,matchUpId:i,inContext:!0,drawDefinition:e,matchUpsMap:n,event:r});if(!s)return{error:un};let{collectionPosition:l,drawPositions:u,collectionId:c,matchUpTieId:d,matchUpType:p}=s;if(p&&!em([Wt,$t],p))return{error:ia};let{positionAssignments:f}=Yt({structure:o}),m=f?.filter(S=>u?.includes(S.drawPosition)),{matchUp:h}=di({matchUpId:d,drawDefinition:e,matchUpsMap:n}),g=h?.sides?.map(vt)??[],I=m?.map(vt)??[],v=[...g,...I],{participants:w}=Ei({tournamentRecord:t,participantFilters:{participantTypes:[Lt],participantIds:v}}),{matchUp:y}=di({matchUpId:d,inContext:!0,drawDefinition:e,matchUpsMap:n}),b=vn({matchUp:h,drawDefinition:e,structure:o,event:r})?.tieFormat;return{inContextDualMatchUp:y,inContextTieMatchUp:s,relevantAssignments:m,collectionPosition:l,teamParticipants:w,collectionId:c,matchUpType:p,dualMatchUp:h,tieMatchUp:a,tieFormat:b,structure:o,...H}}function A_(t){let e=N_(t);if(e.error)return e;let i="replaceTieMatchUpParticipantid",{existingParticipantId:r,tournamentRecord:n,newParticipantId:a,drawDefinition:s,substitution:o,event:l}=t;if(!r||!a)return z({result:{error:lr},stack:i});if(r===a)return{...H};let{inContextDualMatchUp:u,inContextTieMatchUp:c,collectionPosition:d,collectionId:p,dualMatchUp:f,tieMatchUp:m,tieFormat:h}=e,g=c?.matchUpType,I=c?.sides?.find(k=>k.participant?.participantId===r||k.participant?.individualParticipantIds?.includes(r));if(!I)return{error:Vi};let v=Ei({tournamentRecord:n,participantFilters:{participantIds:[r,a]}})?.participants??[];if(v.length!==2)return z({result:{error:lr},stack:i});if(v[0].participantType!==v[1].participantType)return z({result:{error:Do},stack:i});let{appliedPolicies:w}=Tt({tournamentRecord:n,drawDefinition:s,event:l}),y=t.policyDefinitions?.[Rr]??w?.[Rr]??fv[Rr],b=v.find(({participantId:k})=>k===a);if((t.enforceGender??y?.participants?.enforceGender)!==!1&&il(c?.gender)&&on(c?.gender)!==on(b?.person?.sex))return{error:Up,info:"Gender mismatch"};let S=y?.processCodes?.substitution;SS({tournamentId:n.tournamentId,eventId:l.eventId,inContextDualMatchUp:u,drawDefinition:s,dualMatchUp:f});let U=f?.sides?.find(({sideNumber:k})=>k===I.sideNumber);if(!U)return z({result:{sideNumber:I.sideNumber,existingParticipantId:r,error:_r},stack:i});if(c?.sides?.flatMap(k=>k.participant?.individualParticipantIds||k.participant?.participantId||[])?.includes(a))return z({result:{error:YE},stack:i});let T=u?.sides?.find(({sideNumber:k})=>k===I.sideNumber)?.participantId,P=U.lineUp,D=P?.find(({participantId:k})=>a===k),E=P?.reduce((k,F)=>F.substitutionOrder>k?F.substitutionOrder:k,0),R=P?.map(k=>{let F=ke(k,!1,!0);if(![r,a].includes(F.participantId))return F;if(!o&&[r,a].includes(F.participantId)&&(F.collectionAssignments=F.collectionAssignments?.filter(x=>!(x.collectionPosition===d&&x.collectionId===p))),o&&r===F.participantId&&(F.collectionAssignments=F.collectionAssignments.map(x=>x.collectionPosition===d&&x.collectionId===p&&x.substitutionOrder===void 0?{...x,substitutionOrder:E}:x)),F.participantId===a){F.collectionAssignments||(F.collectionAssignments=[]);let x={collectionId:p,collectionPosition:d};o&&(x.previousParticipantId=r,x.substitutionOrder=(E??0)+1),F.collectionAssignments.push(x)}return F})??[];if(!D){let k={collectionId:p,collectionPosition:d};o&&(k.substitutionOrder=(E??0)+1,k.previousParticipantId=r);let F={collectionAssignments:[k],participantId:a};R.push(F)}let C=g===$t,{assignedParticipantIds:M}=rP({lineUp:P,collectionPosition:d,collectionId:p}),{assignedParticipantIds:N}=rP({lineUp:R,collectionPosition:d,collectionId:p});if(U.lineUp=R,T&&h){let k=wh({participantId:T,lineUp:R,drawDefinition:s,tieFormat:h});if(k.error)return z({result:k,stack:i})}else console.log("team participantId not found");let A,O;if(C){let{tournamentRecord:k}=t,F=Qs({participantIds:N,tournamentRecord:k});if(!F.participant){let L=ul({returnParticipant:!0,pairOverride:!0,tournamentRecord:k,participant:{participantRole:Kr,individualParticipantIds:N,participantType:pt}});if(L.error)return z({result:L,stack:i});A=L.participant?.participantId}F=Qs({participantIds:M,tournamentRecord:k});let x=F.participant?.participantId;x&&yh({participantIds:[x],tournamentRecord:k}).success&&(O=x)}if(o||I.substitutions?.length===1){if(o)S&&m&&(m.processCodes=rt([...m?.processCodes??[],...S]));else for(let k of S||[]){let F=m?.processCodes?.lastIndexOf(k);F!==void 0&&m?.processCodes?.splice(F,1)}m&&St({tournamentId:n?.tournamentId,matchUp:m,context:i,drawDefinition:s})}return f&&St({tournamentId:n?.tournamentId,matchUp:f,context:i,drawDefinition:s}),{...H,modifiedLineUp:R,participantRemoved:O,participantAdded:A}}function pJ({collectionPosition:t,teamParticipantId:e,dualMatchUpSide:i,drawDefinition:r,participantIds:n,collectionId:a}){if(!a||!t||!Array.isArray(n))return{modifiedLineUp:i?.lineUp||[],error:ie};let s=i?.lineUp||Mp({participantId:e,drawDefinition:r})?.lineUp,o=[],l=[];return{modifiedLineUp:s?.map(u=>{if(!n.includes(u.participantId))return u;let c=u.collectionAssignments?.filter(d=>{let p=d.collectionId===a&&d.collectionPosition===t;return p&&(d.previousParticipantId&&o.push(d.previousParticipantId),l.push({participantId:u.participantId,...d})),!p});return{participantId:u.participantId,collectionAssignments:c}}).filter(Boolean)||[],assignmentsRemoved:l,previousParticipantIds:o}}function XRe({individualParticipantIds:t,groupingParticipantId:e,tournamentRecord:i}){let r=(i.events||[]).filter(a=>a?.eventType===rr&&a?.entries?.some(s=>s.participantId===e)),n=a=>!t.includes(a.participantId);for(let a of r){a.entries=(a.entries||[]).filter(n);let{flightProfile:s}=$i({event:a});s?.flights?.forEach(o=>{o.drawEntries=(o.drawEntries||[]).filter(n)}),a?.drawDefinitions?.forEach(o=>{o.entries=(o.entries||[]).filter(n)})}return{...H}}function FC({individualParticipantIds:t,groupingParticipantId:e,removeFromOtherTeams:i,tournamentRecord:r}){let n="addIndividualParticipantIds";if(!r)return z({result:{error:Ie},stack:n});if(!e||!t)return z({result:{error:Xe},stack:n});let a=r.participants??[],s=a.find(d=>d.participantId===e);if(!s)return z({result:{error:Vi},stack:n});if(s?.participantType&&![Lt,ja].includes(s.participantType))return z({context:{participantType:s.participantType},result:{error:Do},stack:n});let o=t.filter(d=>a.find(p=>p.participantId===d)?.participantType!==gt);if(o.length)return z({result:{error:ga,invalidParticipantIds:o},stack:n});s.individualParticipantIds||(s.individualParticipantIds=[]);let l=s.individualParticipantIds,u=t.filter(d=>!l.includes(d));u.length&&(i&&BR({individualParticipantIds:u,tournamentRecord:r}),s.individualParticipantIds=s.individualParticipantIds.concat(...u));let{topics:c}=gs();if(c.includes(en)){let d=a.find(({participantId:p})=>p===e);at({topic:en,payload:{participants:[d]}})}return XRe({individualParticipantIds:t,groupingParticipantId:e,tournamentRecord:r}),{groupingParticipant:ke(s,!1,!0),added:u.length,...H}}function LC(t){let{updateParticipantName:e=!0,groupingParticipantId:i,removeFromOtherTeams:r,tournamentRecord:n,pairOverride:a,participant:s}=t;if(!n)return{error:Ie};if(!s)return{error:rh};if(!s.participantId)return ul({tournamentRecord:n,participant:s});let{participant:o}=$d({participantId:s.participantId,tournamentRecord:n});if(!o)return ul({tournamentRecord:n,participant:s});let{participantRoleResponsibilties:l,individualParticipantIds:u,participantOtherName:c,participantName:d,participantRole:p,participantType:f,onlineResources:m,contacts:h,person:g}=s;if(f&&o.participantType!==f)return{error:z6};let I={};if(h&&(I.contacts=h),m&&(I.onlineResources=m),c&&ri(c)&&(I.participantOtherName=c),d&&ri(d)&&(I.participantName=d),Array.isArray(u)){let{participants:v}=Ei({participantFilters:{participantTypes:[gt]},tournamentRecord:n}),w=v?.map(vt);if(w){let y=u.filter(b=>ri(b)&&w.includes(b));([ja,Zt].includes(f||o.participantType)||f===pt&&(y.length===2||a))&&(I.individualParticipantIds=y),o.participantType===Ly.PAIR&&e&&(I.participantName=JRe({individualParticipants:v,newValues:I}))}}return Object.keys(TL).includes(p)&&(I.participantRole=p),Object.keys(Ly).includes(f)&&(I.participantType=f),Array.isArray(l)&&(I.participantRoleResponsibilties=l),o.participantType===Ly.INDIVIDUAL&&g&&QRe({updateParticipantName:e,existingParticipant:o,newValues:I,person:g}),Object.assign(o,Ve(I)),i&&FC({individualParticipantIds:[o.participantId],groupingParticipantId:i,removeFromOtherTeams:r,tournamentRecord:n}),at({topic:en,payload:{tournamentId:n.tournamentId,participants:[o]}}),{participant:ke(o),...H}}function JRe({individualParticipants:t,newValues:e}){let i=e.individualParticipantIds,r=t.filter(({participantId:n})=>i.includes(n)).map(({person:n})=>n?.standardFamilyName).filter(Boolean).sort().join("/");return i.length===1&&(r+="/Unknown"),r}function QRe({updateParticipantName:t,existingParticipant:e,newValues:i,person:r}){let n={},{standardFamilyName:a,standardGivenName:s,nationalityCode:o,personId:l,birthdate:u,tennisId:c,sex:d}=r;d&&Object.keys(rR).includes(d)&&(n.sex=d);let p;if(ri(l)&&(n.personId=l),o&&ri(o)&&(ZRe(o)||o==="")&&(n.nationalityCode=o),a&&typeof ri(a)&&a.length>1&&(n.standardFamilyName=a,p=!0),s&&typeof ri(s)&&s.length>1&&(n.standardGivenName=s,p=!0),p&&t){let f=`${n.standardGivenName} ${n.standardFamilyName}`;i.participantName=f}u&&Pn(u)&&(n.birthdate=u),c&&ri(c)&&(n.tennisId=c),Object.assign(e.person,n)}function ZRe(t){return im.flatMap(({iso:e,ioc:i})=>[e,i]).filter(Boolean).includes(t)}function gP(t){let e=N_(t);if(e.error)return e;let i="assignTieMatchUpParticipantId",r=t.teamParticipantId,{tournamentRecord:n,drawDefinition:a,participantId:s,event:o}=t;if(!s)return z({result:{error:lr},stack:i});if(t.sideNumber&&![1,2].includes(t.sideNumber))return z({result:{error:$6},stack:i});let{inContextDualMatchUp:l,inContextTieMatchUp:u,relevantAssignments:c,collectionPosition:d,teamParticipants:p,collectionId:f,matchUpType:m,dualMatchUp:h,tieFormat:g}=e;if(u?.sides?.flatMap(x=>x.participant?.individualParticipantIds||x.participant?.participantId||[])?.includes(s))return z({result:{...H},stack:i});r=r??(t.sideNumber?l?.sides?.find(x=>x.sideNumber===t.sideNumber)?.participantId:void 0);let I=Ei({participantFilters:{participantIds:[s]},tournamentRecord:n})?.participants?.[0];if(!I)return z({result:{error:Vi},stack:i});let{appliedPolicies:v}=Tt({tournamentRecord:n,drawDefinition:a,event:o}),w=t.policyDefinitions?.[Rr]??v?.[Rr]??fv[Rr];if((t.enforceGender??w?.participants?.enforceGender)!==!1&&il(u?.gender)&&on(u?.gender)!==on(I.person?.sex))return{error:Up,info:"Gender mismatch"};let{individualParticipantIds:y,participantType:b}=I;if(Di(Wt)(m)&&b!==gt)return{error:Do};let S=b===gt?[s]:y,U=r&&p?.find(({participantId:x})=>x===r)||p?.find(({individualParticipantIds:x})=>kn(S,x));if(!U)return{error:eF};if(r||(r=U.participantId),!r)return{error:Vi};let T=c?.find(x=>x.participantId===U?.participantId)?.drawPosition,P=h?.sides?.find(x=>x.participantId===r)?.sideNumber,D=u?.sides?.find(x=>T&&x.drawPosition===T)?.sideNumber,E=P??D??t.sideNumber;if(!g)return{error:ZI};if(!g.collectionDefinitions?.find(x=>x.collectionId===f))return{error:F6};SS({tournamentId:n.tournamentId,eventId:o.eventId,inContextDualMatchUp:l,drawDefinition:a,dualMatchUp:h});let R=h?.sides?.find(x=>x.sideNumber===E),C=u?.sides?.find(x=>x.sideNumber===E),M=(R?.lineUp??Mp({participantId:r,drawDefinition:a})?.lineUp)?.filter(x=>x.collectionAssignments?.find(L=>L.collectionPosition===d&&L.collectionId===f&&!L.previousParticipantId))?.map(x=>x?.participantId),N=M?.length>1&&M||(b===pt?I.individualParticipantIds:[s]),A=pJ({collectionPosition:d,teamParticipantId:r,dualMatchUpSide:R,drawDefinition:a,participantIds:N,collectionId:f});if(A.error)return z({result:A,stack:i});let{modifiedLineUp:O}=A,k;if(m===$t){if(b!==pt){let x=BA({collectionPosition:d,teamParticipantId:r,drawDefinition:a,modifiedLineUp:O,participantId:s,collectionId:f,tieFormat:g});if(x?.error)return z({result:x,stack:i});if(x=F({side:C}),x.error)return x;k=x.deletedParticipantId,R&&(R.lineUp=O),h&&St({tournamentId:n?.tournamentId,matchUp:h,context:i,drawDefinition:a})}else if(b===pt)for(let x of N)BA({collectionPosition:d,teamParticipantId:r,drawDefinition:a,modifiedLineUp:O,participantId:x,collectionId:f,tieFormat:g})}else{let x=BA({collectionPosition:d,teamParticipantId:r,drawDefinition:a,modifiedLineUp:O,participantId:s,collectionId:f,tieFormat:g});if(x?.error)return x}if(R&&(R.lineUp=O),h&&St({tournamentId:n?.tournamentId,matchUp:h,context:i,drawDefinition:a}),k){let{error:x}=yh({participantIds:[k],tournamentRecord:n});x&&console.log("cleanup")}return{...H,modifiedLineUp:O};function F({side:x}){let L;if(x.participant){let $=x.participant.individualParticipantIds||[];if($.filter(Boolean).length===1){let{participant:V}=Qs({participantIds:$,tournamentRecord:n});$.push(s);let{participant:_}=Qs({participantIds:$,tournamentRecord:n});if(!_&&V){V.individualParticipantIds=$;let B=LC({pairOverride:!0,tournamentRecord:n,participant:V});if(B.error)return B}else L=V?.participantId}}else{let $=ul({participant:{individualParticipantIds:[s],participantRole:Kr,participantType:pt},pairOverride:!0,tournamentRecord:n});if($.error)return $}return{...H,deletedParticipantId:L}}}function BA({collectionPosition:t,teamParticipantId:e,drawDefinition:i,modifiedLineUp:r,participantId:n,collectionId:a,tieFormat:s}){let o=Mp({participantId:e,drawDefinition:i})?.lineUp,l=(r||o)?.find(c=>c?.participantId===n),u={collectionId:a,collectionPosition:t};if(l)l.collectionAssignments.push(u);else{let c={collectionAssignments:[u],participantId:n};r.push(c)}return wh({participantId:e,lineUp:r,drawDefinition:i,tieFormat:s})}function fJ(t){let{tournamentRecord:e,drawDefinition:i,participantId:r,event:n}=t,a="removeTieMatchUpParticiapantId";if(!r)return z({result:{error:lr},stack:a});let s=N_(t);if(s.error)return s;let{appliedPolicies:o}=Tt({tournamentRecord:e,drawDefinition:i,event:n}),l=(t.policyDefinitions?.[Rr]??o?.[Rr]??fv[Rr])?.processCodes?.substitution,{inContextDualMatchUp:u,inContextTieMatchUp:c,relevantAssignments:d,collectionPosition:p,teamParticipants:f,collectionId:m,matchUpType:h,dualMatchUp:g,tieMatchUp:I,tieFormat:v}=s;if(!g)return z({result:{error:ta},stack:a});let w=c?.sides?.find(E=>E.participant?.participantId===r||E.participant?.individualParticipantIds?.includes(r));if(!w)return z({result:{error:Vi},stack:a});let y=t.policyDefinitions?.[Po]??o?.[Po];if(!w.substitutions?.length&&(cr({score:c?.score})||c?.winningSide)&&y?.requireParticipantsForScoring!==!1)return z({result:{error:S4},stack:a});let b=u?.sides?.find(({sideNumber:E})=>E===w.sideNumber)?.participantId;if(!b)return z({result:{error:Vi},stack:a});let S=Ei({participantFilters:{participantIds:[r]},tournamentRecord:e})?.participants?.[0];if(!S)return z({result:{error:Vi},stack:a});if(h===Wt&&S.participantType===pt)return z({result:{error:Up},stack:a});let U=S.participantType===gt?[r]:S.individualParticipantIds;SS({tournamentId:e.tournamentId,eventId:n.eventId,inContextDualMatchUp:u,drawDefinition:i,dualMatchUp:g});let T=g.sides?.find(({sideNumber:E})=>E===w.sideNumber);if(!T&&(g.sides?.filter(({lineUp:E})=>!E).length||0)<2){let E=f?.map(({participantId:R})=>({drawPosition:d?.find(C=>C.participantId===R)?.drawPosition,teamParticipantId:R}));T=g.sides?.find(R=>E?.find(({drawPosition:C})=>C===R.drawPosition)?.teamParticipantId===b)}if(!T)return z({result:{error:Vi,context:{participantId:r}}});let{modifiedLineUp:P,previousParticipantIds:D}=pJ({collectionPosition:p,teamParticipantId:b,dualMatchUpSide:T,participantIds:U,drawDefinition:i,collectionId:m});if(T.lineUp=P,b&&v&&wh({participantId:b,lineUp:P,drawDefinition:i,tieFormat:v}),h===$t&&S.participantType===gt){let E=c?.sides?.find(M=>M.sideNumber===T?.sideNumber),{participantId:R}=E??{},C=R&&Ei({participantFilters:{participantIds:[R]},tournamentRecord:e,withDraws:!0})?.participants?.[0];if(C){let M=C?.individualParticipantIds?.filter(N=>N!==r)??[];if(D&&M.push(...D),M.length>2)return z({result:{error:ga},stack:a});if(C.draws?.length){if(M.length===1){let{participant:N}=Qs({participantIds:M,tournamentRecord:e});if(!N){let A=ul({participant:{participantRole:Kr,individualParticipantIds:M,participantType:pt},pairOverride:!0,tournamentRecord:e});if(A.error)return z({result:A,stack:a})}}}else if(M.length){C.individualParticipantIds=M;let N=LC({participant:C,pairOverride:!0,tournamentRecord:e});if(N.error)return z({result:N,stack:a})}else{let N=yh({participantIds:[R],tournamentRecord:e});N.error&&console.log("cleanup",{result:N})}}else return z({result:{error:Vi},stack:a})}if(w.substitutions?.length===1&&!c?.sides?.find(E=>E.sideNumber!==w.sideNumber)?.substitutions?.length&&I?.processCodes?.length){for(let E of l||[]){let R=I.processCodes.lastIndexOf(E);I.processCodes.splice(R,1)}St({tournamentId:e?.tournamentId,matchUp:I,context:a,drawDefinition:i})}return St({tournamentId:e?.tournamentId,matchUp:g,context:a,drawDefinition:i}),{...H,modifiedLineUp:P}}function k_(t){let e=Ge(t,[{[mr]:!0,[mn]:!0,[Ul]:!0}]);if(e.error)return e;let{drawDefinition:i,sideNumber:r,matchUpId:n,event:a}=t;if(r&&![1,2].includes(r))return{error:ie,sideNumber:r};let{matchUp:s,structure:o}=di({drawDefinition:i,matchUpId:n,event:a});return s?Vn({structure:o})?(s.sides?.forEach(l=>{(!r||l.sideNumber===r)&&delete l.participantId}),St({tournamentId:t.tournamentRecord?.tournamentId,context:"assignSideParticipant",drawDefinition:i,matchUp:s}),{...H}):{error:L1}:{error:un}}function eCe({matchUpStatuses:t=["BYE",mi,Qt],drawPositionMatchUps:e,loserDrawPosition:i,sourceMatchUps:r}){let n=e?.reduce((c,d)=>!c||d.roundNumber>c.roundNumber?d:c,void 0),a=n?.drawPositions?.find(c=>c!==i),s=r.filter(c=>c?.drawPositions?.includes(a)).map(c=>c.matchUpStatus),o=r.filter(c=>c?.drawPositions?.includes(i)).map(c=>c.matchUpStatus),l=kn(s||[],t),u=kn(o||[],t);return{sourceMatchUp:n,winnerHadMatchUpStatus:l,winnerMatchUpStatuses:s,loserHadMatchUpStatus:u,loserMatchUpStatuses:o}}function tCe({inContextDrawMatchUps:t,sourceMatchUpStatus:e,targetDrawPosition:i,tournamentRecord:r,sourceMatchUpId:n,drawDefinition:a,structureId:s,dualMatchUp:o,roundNumber:l,matchUpsMap:u,event:c}){let{structure:d}=et({drawDefinition:a,structureId:s});if(d?.structureType===fn)return{...H};u=u??kr({drawDefinition:a});let p=(u?.mappedMatchUps||{})[s].matchUps,{initialRoundNumber:f}=Nm({drawPosition:i,matchUps:p}),m=p?.filter(g=>g.roundNumber>=l&&g.roundNumber!==f&&g.drawPositions?.includes(i)),{positionAssignments:h}=Yt({drawDefinition:a,structureId:s});for(let g of m??[])iCe({inContextDrawMatchUps:t,sourceMatchUpStatus:e,positionAssignments:h,targetDrawPosition:i,tournamentRecord:r,sourceMatchUpId:n,drawDefinition:a,dualMatchUp:o,matchUpsMap:u,matchUp:g,event:c});return{...H}}function iCe({inContextDrawMatchUps:t,positionAssignments:e,sourceMatchUpStatus:i,targetDrawPosition:r,tournamentRecord:n,sourceMatchUpId:a,drawDefinition:s,dualMatchUp:o,matchUpsMap:l,matchUp:u,event:c}){let d="removeSubsequentDrawPosition";if(o){let f=t.find(({matchUpId:h})=>u.matchUpId===h).sides?.find(h=>h.drawPosition===r)?.sideNumber,m=u.sides?.find(h=>h.sideNumber===f);m&&delete m.lineUp}u.drawPositions=(u.drawPositions||[]).map(f=>f===r?void 0:f).filter(Boolean);let p=e.filter(({drawPosition:f})=>u.drawPositions?.includes(f)).filter(f=>f.bye).length;return u.matchUpStatus=p&&"BYE"||Fr(u.matchUpStatus)&&u.matchUpStatus||Fi,Fr(u.matchUpStatus)&&(u.winningSide=void 0),u.matchUpStatusCodes&&$7({inContextDrawMatchUps:t,sourceMatchUpStatus:i,sourceMatchUpId:a,matchUpsMap:l,matchUp:u}),St({tournamentId:n?.tournamentId,eventId:c?.eventId,context:`${d}-${r}`,drawDefinition:s,matchUp:u}),{...H}}function Dv(t){let{dualWinningSideChange:e,inContextDrawMatchUps:i,tournamentRecord:r,drawDefinition:n,matchUpStatus:a,matchUpsMap:s,dualMatchUp:o,targetData:l,matchUpId:u,structure:c,event:d}=t,p=!!t.matchUp.collectionId,f=Vn({structure:c}),{drawPositions:m,winningSide:h}=l.matchUp||{};if(!f&&!m)return{error:Ew};let{targetLinks:{loserTargetLink:g,winnerTargetLink:I,byeTargetLink:v},targetMatchUps:{loserMatchUp:w,winnerMatchUp:y,byeMatchUp:b}}=l,S=yo({...t,matchUpStatus:a||Fi,removeWinningSide:!0});if(S.error)return S;let U;if(p){let{matchUpTieId:O,matchUpsMap:k}=t;if(U=_c({appliedPolicies:t.appliedPolicies,matchUpId:O,tournamentRecord:r,drawDefinition:n,matchUpsMap:k,event:d}),!e&&!U.removeWinningSide)return{...H}}if(f)return{...H};let{matchUps:T}=Nt({afterRecoveryTimes:!1,inContext:!0,drawDefinition:n,matchUpsMap:s,structure:c}),{positionAssignments:P}=ur({structure:c}),D=h-1,E=1-D,R=m[D],C=m[E],{winnerParticipantId:M,loserParticipantId:N}=P?.reduce((O,k)=>(k.drawPosition===C&&(O.loserParticipantId=k.participantId),k.drawPosition===R&&(O.winnerParticipantId=k.participantId),O),{winnerParticipantId:void 0,loserParticipantId:void 0})||{},A=T.filter(O=>O.drawPositions?.includes(C));if(y&&mJ({sourceMatchUpStatus:a,sourceMatchUpId:u,inContextDrawMatchUps:i,winningDrawPosition:R,winnerParticipantId:M,tournamentRecord:r,winnerTargetLink:I,drawDefinition:n,winnerMatchUp:y,dualMatchUp:o,matchUpsMap:s}),w){let{winnerHadMatchUpStatus:O}=eCe({drawPositionMatchUps:A,loserDrawPosition:C,sourceMatchUps:T}),k=g.linkCondition===al;if(O&&k){let x=Math.min(...w.drawPositions);VO({targetLink:g,inContextDrawMatchUps:i,drawDefinition:n,drawPosition:x,matchUpsMap:s,event:d})}let F=rCe({sourceMatchUpStatus:a,sourceMatchUpId:u,loserParticipantId:N,tournamentRecord:r,loserTargetLink:g,drawDefinition:n,loserMatchUp:w,dualMatchUp:o,matchUpsMap:s,event:d});if(F.error)return F}if(b){let O=Math.min(...b.drawPositions);VO({targetLink:v,inContextDrawMatchUps:i,drawDefinition:n,drawPosition:O,matchUpsMap:s,event:d})}return{...H,...U&&{tieMatchUpResult:U}}}function mJ({inContextDrawMatchUps:t,winningDrawPosition:e,sourceMatchUpStatus:i,winnerParticipantId:r,tournamentRecord:n,winnerTargetLink:a,sourceMatchUpId:s,drawDefinition:o,winnerMatchUp:l,matchUpsMap:u,dualMatchUp:c,event:d}){let{structureId:p,roundNumber:f}=l,m="removeDirectedWinner";if(a){let h=a.target.structureId,{structure:g}=et({drawDefinition:o,structureId:h});if(!g)return{error:Ii};let{positionAssignments:I}=ur({structure:g});g.seedAssignments=(g.seedAssignments??[]).filter(U=>U.participantId!==r);let v=I?.find(U=>U.participantId===r)?.drawPosition,{matchUps:w}=Nt({drawDefinition:o,structure:g,event:d}),y=w.map(U=>U.drawPositions).flat(1/0).filter(Boolean),b=va(y);if((v?b[v]:void 0)===1)I?.forEach(U=>{U.participantId===r&&delete U.participantId});else{let U=w.filter(({drawPositions:T})=>T.includes(v));console.log("not removing from position assignments since instances > 1",{drawPositionMatchUps:U,winnerTargetLink:a})}let S=u?.drawMatchUps?.find(({matchUpId:U})=>U===l.matchUpId);S&&St({tournamentId:n?.tournamentId,eventId:d?.eventId,matchUp:S,context:m,drawDefinition:o})}return f&&tCe({targetDrawPosition:e,inContextDrawMatchUps:t,sourceMatchUpStatus:i,tournamentRecord:n,sourceMatchUpId:s,drawDefinition:o,dualMatchUp:c,matchUpsMap:u,roundNumber:f,structureId:p}),{...H}}function rCe({sourceMatchUpStatus:t,loserParticipantId:e,tournamentRecord:i,loserTargetLink:r,sourceMatchUpId:n,drawDefinition:a,loserMatchUp:s,matchUpsMap:o,dualMatchUp:l,event:u}){let c="removeDirectedLoser",d=r.target.structureId,{structure:p}=et({drawDefinition:a,structureId:d});if(!p)return{error:Ii};let{positionAssignments:f}=ur({structure:p}),m=f?.find(h=>h.participantId===e)?.drawPosition;if(f?.forEach(h=>{h.participantId===e&&delete h.participantId}),n&&t){let h=o?.drawMatchUps?.find(({matchUpId:g})=>g===s.matchUpId);h.matchUpStatusCodes=t===wi?["WO","WO"]:[]}if(p.seedAssignments=(p.seedAssignments??[]).filter(h=>h.participantId!==e),l){let h=s?.sides.reduce((v,w,y)=>w.drawPosition===m?y:v,void 0),g=o?.drawMatchUps?.find(({matchUpId:v})=>v===s.matchUpId),I=g?.sides?.[h];I&&(delete I.lineUp,St({tournamentId:i?.tournamentId,eventId:u?.eventId,matchUp:g,context:c,drawDefinition:a}))}return{...H}}function VO({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,matchUpsMap:n,targetLink:a,event:s}){let o=a.target.structureId,l="removeDirectedBye";Gt({color:"brightyellow",method:l,drawPosition:r});let u=uS({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,matchUpsMap:n,structureId:o,event:s});return z({result:u,stack:l})}function nCe(t){let{matchUpFormat:e,score:i}=t,r=i?.sets?.length,n=e&&zi(e),{setFormat:a,finalSetFormat:s,bestOf:o}=n??{};return(o&&r===o&&s||a)?.timed||!1}function aCe({tournamentRecord:t,drawDefinition:e,structure:i,matchUp:r}){let n="attemptToSetMatchUpStatusBYE";if(r?.winningSide)return z({result:{error:QI},context:{matchUpStatus:"BYE"},stack:n});let{positionAssignments:a}=ur({structure:i}),s=a?.filter(o=>o.bye).map(o=>o.drawPosition);return r.drawPositions?.some(o=>s?.includes(o))?(r.matchUpStatus="BYE",r.matchUpStatusCodes=[],St({tournamentId:t?.tournamentId,context:n,drawDefinition:e,matchUp:r}),{...H}):z({result:{error:k6},info:"matchUp does not include BYE",stack:n})}function jy(t){let{tournamentRecord:e,appliedPolicies:i,drawDefinition:r,matchUpsMap:n,targetData:a,structure:s,event:o}=t,l="doubleExitAdvancement";if(s.structureType===fn)return z({result:{...H},stack:l});let{matchUp:u,targetMatchUps:c,targetLinks:d}=a,{loserMatchUp:p,winnerMatchUp:f,loserTargetDrawPosition:m}=c,h=Fr(p?.matchUpStatus)&&!p.sides?.map(I=>I.participantId??I.participant).filter(Boolean).length,g=p?.matchUpStatus===wi;if(Gt({method:l,newline:!0,color:"brightyellow",keyColors:{sourceMatchUpId:"brightcyan",loserMatchUpId:"brightmagenta",winnerMatchUpId:"brightgreen"},sourceMatchUpId:u?.matchUpId,sourceStatus:t.matchUpStatus,sourceDP:JSON.stringify(u?.drawPositions),loserMatchUpId:p?.matchUpId,loserStatus:p?.matchUpStatus,loserDP:JSON.stringify(p?.drawPositions),loserTargetDP:m,loserIsEmptyExit:h,loserIsDoubleExit:g,loserSides:JSON.stringify(p?.sides?.map(I=>({sn:I.sideNumber,pid:I.participantId?.slice(0,8),fed:I.participantFed}))),winnerMatchUpId:f?.matchUpId,winnerStatus:f?.matchUpStatus,winnerDP:JSON.stringify(f?.drawPositions)}),p&&p.matchUpStatus!=="BYE"){let{loserTargetLink:I}=d,v=i?.progression?.doubleExitPropagateBye,w=p.feedRound&&p.sides?.[0]?.participantFed;if(v||w){Gt({method:l,color:"cyan",decision:"advanceByeToLoserMatchUp",propagateBye:v,targetFedIn:!!w});let y=hJ({loserTargetDrawPosition:m,tournamentRecord:e,loserTargetLink:I,drawDefinition:r,loserMatchUp:p,matchUpsMap:n,event:o});if(y.error)return z({result:y,stack:l})}else if(h){let y=t.matchUpStatus===Hi?Hi:wi,b=t.matchUpStatus===Hi?Qt:mi,S=n.drawMatchUps.find(U=>U.matchUpId===p.matchUpId);if(Gt({method:l,color:"brightred",decision:"EMPTY_EXIT_converting_to_DOUBLE_EXIT",loserMatchUpId:p.matchUpId,currentStatus:p.matchUpStatus,newStatus:y}),S){let U=[{matchUpStatus:b,previousMatchUpStatus:y,sideNumber:1},{matchUpStatus:b,previousMatchUpStatus:t.matchUpStatus,sideNumber:2}].map(P=>Ve(P)),T=yo({...t,matchUp:S,matchUpId:p.matchUpId,matchUpStatus:y,matchUpStatusCodes:U,winningSide:void 0,removeScore:!0});if(T.error)return z({result:T,stack:l})}}else if(g)Gt({method:l,color:"brightyellow",decision:"SKIP_loserMatchUp_already_doubleExit",loserMatchUpId:p.matchUpId});else{let{feedRound:y,drawPositions:b,matchUpId:S}=p,U=y?2:2-b.indexOf(m);Gt({method:l,color:"cyan",decision:"conditionallyAdvanceLoser",feedRound:y,walkoverWinningSide:U,loserMatchUpId:S});let T=MW({...t,targetMatchUp:p,walkoverWinningSide:U,tournamentRecord:e,sourceMatchUp:u,matchUpId:S});if(T.error)return z({result:T,stack:l})}}if(f){Gt({method:l,color:"cyan",decision:"conditionallyAdvanceWinner",winnerMatchUpId:f.matchUpId});let I=MW({...t,matchUpId:f.matchUpId,targetMatchUp:f,tournamentRecord:e,sourceMatchUp:u});if(I.error)return z({result:I,stack:l})}return z({result:{...H},stack:l})}function MW(t){let{inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:r,sourceMatchUp:n,targetMatchUp:a,matchUpsMap:s}=t,o=r.structures.find(({structureId:_})=>_===a.structureId),l=t.matchUpStatus===Hi?Hi:wi,u=t.matchUpStatus===Hi?Qt:mi,c="conditionallyAdvanceDrawPosition",d=s.drawMatchUps.find(_=>_.matchUpId===a.matchUpId);if(!d)return{error:ta};let p=n?.drawPositions||[],f=d.drawPositions?.filter(Boolean),m=n?.structureId===a.structureId;if(Gt({method:c,newline:!0,color:"magenta",keyColors:{targetMatchUpId:"brightcyan",sourceMatchUpId:"brightyellow"},targetMatchUpId:a.matchUpId,targetStructureId:a.structureId?.slice(0,8),targetRound:[a.roundNumber,a.roundPosition],targetDP:JSON.stringify(d.drawPositions),targetStatus:d.matchUpStatus,targetFeedRound:a.feedRound,sourceMatchUpId:n?.matchUpId,sourceStructureId:n?.structureId?.slice(0,8),sourceRound:n?[n.roundNumber,n.roundPosition]:void 0,sourceDP:JSON.stringify(p),sameStructure:m,paramMatchUpStatus:t.matchUpStatus,EXIT:u,DOUBLE_EXIT:l}),m&&kn(p,f)&&(f=f.filter(_=>!p.includes(_))),m&&f.length>1)return z({result:{error:Kg},stack:c});let{pairedPreviousMatchUpIsDoubleExit:h,pairedPreviousMatchUp:g}=L7({...t,structure:o});Gt({method:c,color:"magenta",keyColors:{pairedMatchUpId:"brightcyan"},pairedMatchUpId:g?.matchUpId,pairedRound:g?[g.roundNumber,g.roundPosition]:void 0,pairedStatus:g?.matchUpStatus,pairedStructureId:g?.structureId?.slice(0,8),pairedIsDoubleExit:h});let I=On({matchUpId:a.matchUpId,inContextDrawMatchUps:e,drawDefinition:r}),{targetMatchUps:v,targetLinks:w}=I,{loserTargetDrawPosition:y,winnerMatchUp:b,loserMatchUp:S}=v;if(S){let{loserTargetLink:_}=w,B=hJ({loserTargetDrawPosition:y,loserMatchUp:S,tournamentRecord:i,loserTargetLink:_,drawDefinition:r,matchUpsMap:s});if(B.error)return z({result:B,stack:c})}let U=d.drawPositions?.filter(Boolean)||[],T=U.length===1,P=t.walkoverWinningSide||T&&ZT({drawPosition:U[0],matchUpId:a.matchUpId,inContextDrawMatchUps:e})||void 0,D=Fr(d.matchUpStatus)&&!U.length,E=D?l:u;Gt({method:c,color:"brightyellow",keyColors:{matchUpStatus:"brightgreen",existingExit:"brightred"},existingExit:D,matchUpStatus:E,targetCurrentStatus:d.matchUpStatus,targetDP:JSON.stringify(U),hasDrawPosition:T,walkoverWinningSide:P});let R=e.find(_=>_.matchUpId===g.matchUpId),C=[],M;n&&(n?.structureId===R?.structureId?n.roundPosition<g?.roundPosition?M=1:M=2:a.feedRound?n.structureId===a.structureId?M=2:M=1:P&&(M=3-P),Gt({method:c,color:"cyan",keyColors:{sourceSideNumber:"brightgreen"},sourceSideNumber:M,sourceStructureId:n.structureId?.slice(0,8),pairedStructureId:R?.structureId?.slice(0,8),targetStructureId:a.structureId?.slice(0,8),sameStructureAsPaired:n?.structureId===R?.structureId,targetFeedRound:a.feedRound,sourceRP:n.roundPosition,pairedRP:g?.roundPosition}));let N=t.matchUpStatus,A=g?.matchUpStatus;M===1?C=[{matchUpStatus:wT(N),previousMatchUpStatus:N,sideNumber:1},{matchUpStatus:wT(A),previousMatchUpStatus:A,sideNumber:2}]:M===2&&(C=[{matchUpStatus:wT(A),previousMatchUpStatus:A,sideNumber:1},{matchUpStatus:wT(N),previousMatchUpStatus:N,sideNumber:2}]),C.length&&(C=C.map(_=>Ve(_))),Gt({method:c,color:"brightgreen",keyColors:{matchUpStatus:"brightcyan",winningSide:"brightyellow"},action:"modifyMatchUpScore",targetMatchUpId:d.matchUpId,matchUpStatus:E,winningSide:P,matchUpStatusCodes:JSON.stringify(C),sourceStatus:N,pairedStatus:A});let O=yo({...t,winningSide:P,matchUp:d,matchUpStatusCodes:C,matchUpStatus:E});if(O.error)return z({result:O,stack:c});if(D)return Gt({method:c,color:"brightred",decision:"EXISTING_EXIT_triggers_recursive_doubleExitAdvancement",targetMatchUpId:d.matchUpId,matchUpStatus:E}),jy({...t,matchUpStatus:E,targetData:I});if(!b)return z({result:{...H},stack:c});let k=f.length===2?f[P-1]:f[0],{positionAssignments:F}=Yt({structure:o}),x=F?.find(_=>_.drawPosition===k),L=s.drawMatchUps.find(_=>_.matchUpId===b.matchUpId),$=L?.drawPositions?.filter(Boolean),V=$.length===1;if(k){if(x?.bye){let _=On({matchUpId:L.matchUpId,inContextDrawMatchUps:e,drawDefinition:r});if(V){let B=$.filter(Boolean)[0],G=ZT({drawPosition:B,matchUpId:L.matchUpId,inContextDrawMatchUps:e}),j=yo({appliedPolicies:t.appliedPolicies,matchUpId:L.matchUpId,matchUp:L,matchUpStatus:u,matchUpStatusCodes:[],removeScore:!0,drawDefinition:r,winningSide:G});return j.error?z({result:j,stack:c}):gL({drawPositionToAdvance:B,matchUpId:L.matchUpId,inContextDrawMatchUps:e,drawDefinition:r,matchUpsMap:s})}else if(Fr(b.matchUpStatus)){let B=jy({...t,matchUpId:L.matchUpId,matchUpStatus:E,targetData:_});if(B.error)return z({result:B,stack:c})}return z({result:{...H},stack:c})}return nm({matchUpId:b.matchUpId,drawPosition:k,inContextDrawMatchUps:e,drawDefinition:r})}else if(h){if(!L)return{error:ta};if(V){let G=$[0],j=ZT({matchUpId:a.matchUpId,inContextDrawMatchUps:e,drawPosition:G});console.log("existing drawPosition is winningSide",{walkoverWinningSide:j})}let _=Fr(L.matchUpStatus)?u:l,B=yo({matchUpId:L.matchUpId,appliedPolicies:t.appliedPolicies,matchUp:L,matchUpStatusCodes:[],removeScore:!0,drawDefinition:r,matchUpStatus:_});if(B.error)return z({result:B,stack:c});if(_===l){let G=jy({...t,matchUpId:a.matchUpId,matchUpStatus:_,targetData:I});if(G.error)return G}}return z({result:{...H},stack:c})}function hJ(t){let{loserTargetDrawPosition:e,tournamentRecord:i,loserTargetLink:r,drawDefinition:n,matchUpsMap:a,event:s,loserMatchUp:o}=t,l=r?.target?.structureId,{structure:u}=et({drawDefinition:n,structureId:l});return u?Wa({drawPosition:e,tournamentRecord:i,drawDefinition:n,structureId:l,matchUpsMap:a,loserMatchUp:o,event:s}):{error:Zp}}function wT(t){return t===wi?mi:t===Hi?Qt:t}function sCe(t){let{tournamentRecord:e,drawDefinition:i,matchUpStatus:r,structure:n,matchUp:a}=t,s=!!(a.tieMatchUps&&!a.rondPosition&&t.inContextDrawMatchUps.find(v=>v.matchUpId===a.matchUpId).containerStructureId),o="attemptToSetMatchUpStatus",l=r==="BYE",u=a.winningSide,c=[wi,Hi].includes(r),d=lS({matchUpStatus:r}),p=IO({matchUpStatus:r}),f=!d&&!p,m=t.matchUpTieId||u&&d&&!c,h=u&&c;Gt({method:o,newline:!0,color:"brightyellow",keyColors:{matchUpStatus:"brightcyan",matchUpId:"brightmagenta"},matchUpId:a.matchUpId,matchUpStatus:r,existingStatus:a.matchUpStatus,existingWinningSide:u,isDoubleExit:c,isBYE:l,directing:d,nonDirecting:p,unrecognized:f,onlyModifyScore:m,changeCompletedToDoubleExit:h,propagateExitStatus:t.propagateExitStatus,teamRoundRobinContext:s});let g=()=>yo({...t,removeScore:[Oc,mi].includes(r),matchUpStatus:r||Fi}),I=f&&"unrecognized"||m&&"onlyModifyScore"||h&&"changeCompletedToDoubleExit"||u&&"existingWinningSide_removeDirected"||p&&"nonDirecting_clearScore"||l&&"isBYE"||!d&&"notDirecting_error"||c&&"isDoubleExit_modifyAndAdvance"||s&&"teamRoundRobinContext"||t.propagateExitStatus&&"propagateExitStatus"||"fallthrough_error";return Gt({method:o,color:"brightgreen",keyColors:{route:"brightcyan"},route:I,matchUpId:a.matchUpId}),f&&{error:Jk}||m&&aD(t)||h&&oCe(t)||u&&Dv(t)||p&&g()||l&&aCe({tournamentRecord:e,drawDefinition:i,structure:n,matchUp:a})||!d&&{error:Jk}||c&&lCe(t)||s&&aD(t)||t.propagateExitStatus&&aD(t)||z({result:{error:QI,info:"matchUpStatus: "+r},stack:o})}function oCe(t){let e=Dv(t);return e.error?e:jy(t)}function lCe(t){let e=aD({...t,removeScore:!0});return e.error?e:jy(t)}function aD(t){let e="scoreModification";if(t.isCollectionMatchUp&&t.dualMatchUp?.winningSide&&!t.projectedWinningSide){let n=Dv(t);if(n.error)return z({result:n,stack:e})}let i=!!t.matchUp.collectionId,r=yo({...t});if(i){let{matchUpTieId:n,drawDefinition:a,matchUpsMap:s}=t,o=_c({tournamentRecord:t.tournamentRecord,appliedPolicies:t.appliedPolicies,matchUpId:n,event:t.event,drawDefinition:a,matchUpsMap:s});if(o.error)return z({result:o,stack:e});Object.assign(r,{tieMatchUpResult:o})}return z({result:r,stack:e})}function uCe({drawDefinition:t,structure:e,matchUp:i}){let{drawPositions:r}=i,{positionAssignments:n}=Yt({drawDefinition:t,structure:e}),a=n?.filter(({drawPosition:l})=>r?.includes(l))?.map(l=>{let{extension:u}=mt({element:l,name:pc});return u?.value?.groupOrder}),{containerStructures:s}=lv({drawDefinition:t}),o=s[e.structureId];return{structureIds:uv({drawDefinition:t,structureId:o})?.links?.source?.filter(l=>kn(a,l.source?.finishingPositions||[])).map(l=>l.source.structureId)}}function gJ({drawDefinition:t,structure:e,matchUp:i}){let r=[];if(e.finishingPosition===Ep&&uu({drawDefinition:t,structure:e})){let{structureIds:n}=uCe({drawDefinition:t,structure:e,matchUp:i});n?.length&&r.push(...n)}return{connectedStructureIds:r}}function cCe(t){let e,{inContextDrawMatchUps:i,inContextMatchUp:r,drawDefinition:n,winningSide:a}=t,s=t.targetData.targetLinks?.winnerTargetLink;if(s.target.feedProfile===Cs){let o=r.sides.find(({sideNumber:u})=>u!==a).participantId,l=i.find(u=>u.structureId===s.target.structureId&&u.roundNumber===s.target.roundNumber&&u.sides.some(({participantId:c})=>c===o));if(l?.matchUpStatus===Fi){let u=On({matchUpId:l.matchUpId,inContextDrawMatchUps:i,drawDefinition:n});if(!Op({inContextDrawMatchUps:i,drawDefinition:n,targetData:u})){let{structure:c}=et({structureId:l.structureId,drawDefinition:n}),d=Yt({structure:c}).positionAssignments;for(let p of d||[])if(p.participantId===o){let f=r.sides.find(({sideNumber:m})=>m===a).participantId;if(p.participantId=f,c?.positionAssignments)c.positionAssignments=d;else if(c?.structures){let m=Object.assign({},...(d||[]).map(h=>({[h.drawPosition]:h.participantId})));for(let h of c.structures)h.positionAssignments?.forEach(g=>g.participantId=m[g.drawPosition])}fc({tournamentId:t.tournamentRecord?.tournamentId,event:t.event,drawDefinition:n,structure:c}),e=!0}}}}return{...H,qualifierReplaced:e}}function dCe(t){let e,{inContextDrawMatchUps:i,inContextMatchUp:r,drawDefinition:n,winningSide:a}=t,s=t.targetData.targetLinks?.winnerTargetLink;if(s.target.feedProfile===Cs){let o=r.sides.find(({sideNumber:c})=>c===a)?.participantId,l=i.filter(c=>c.structureId===s.target.structureId&&c.roundNumber===s.target.roundNumber&&c.sides.some(({participantId:d,qualifier:p})=>p&&!d)),u=da(l);if(u?.matchUpStatus===Fi){let c=On({matchUpId:u.matchUpId,inContextDrawMatchUps:i,drawDefinition:n});if(!Op({inContextDrawMatchUps:i,drawDefinition:n,targetData:c})){let d=u.sides.find(m=>m.qualifier&&!m.participantId)?.drawPosition,{structure:p}=et({structureId:u.structureId,drawDefinition:n});if(!p)return{error:Ii};let f=Yt({structure:p}).positionAssignments;for(let m of f||[])if(m.drawPosition===d&&!m.participantId){if(m.participantId=o,p.positionAssignments)p.positionAssignments=f;else if(p.structures){let h=Object.assign({},...(f||[]).map(g=>({[g.drawPosition]:g.participantId})));for(let g of p.structures)g.positionAssignments?.forEach(I=>I.participantId=h[I.drawPosition])}fc({tournamentId:t.tournamentRecord?.tournamentId,event:t.event,drawDefinition:n,structure:p}),e=!0}}}}return{...H,qualifierPlaced:e}}function pCe(t){let e="attemptToSetWinningSide",i,r={},{appliedPolicies:n,disableAutoCalc:a,drawDefinition:s,dualMatchUp:o,winningSide:l,structure:u,matchUp:c}=t;if(o?._disableAutoCalc&&a!==!1)return XL(t);if(c.winningSide&&c.winningSide!==l){let{connectedStructureIds:m}=gJ({drawDefinition:s,structure:u,matchUp:c});m.length&&(console.log({connectedStructureIds:m}),i=!0);let h=Dv(t);if(h.error)return h}let d=D8(t);if(d.context?.progressExitStatus&&Object.assign(r,d.context),d.error)return z({result:d,stack:e});let p,f;return t.qualifierChanging&&n?.[bb]?.autoReplaceQualifiers&&(p=cCe(t).qualifierReplaced),t.qualifierAdvancing&&n?.[bb]?.autoPlaceQualifiers&&(f=dCe(t).qualifierPlaced),z({result:Ve({...H,...d,connectedStructures:i,qualifierReplaced:p,qualifierPlaced:f,context:r}),stack:e})}var sD={drawPositionToRemove:"green",iteration:"brightred",winner:"green",loser:"brightred"};function IJ(t){let{inContextDrawMatchUps:e,appliedPolicies:i,drawDefinition:r,matchUpsMap:n,targetData:a,matchUp:s}=t,{matchUpId:o}=s,{iteration:l=0}=t;l+=1;let u="removeDoubleExit";Gt({color:"brightyellow",method:u,matchUpId:o,iteration:l,keyColors:sD});let{targetMatchUps:{loserMatchUp:c,winnerMatchUp:d,loserTargetDrawPosition:p},targetLinks:{loserTargetLink:f}}=a;if(d&&d.matchUpStatus!=="BYE"){let{stage:g,roundNumber:I,roundPosition:v,structureName:w}=d;Gt({winner:"winner",roundPosition:v,structureName:w,roundNumber:I,keyColors:sD,stage:g}),NW({...t,targetMatchUp:d,sourceMatchUp:s,iteration:l})}let m=c?.matchUpStatus==="BYE"&&(c?.feedRound||c?.roundNumber===1),h=a?.targetLinks?.loserTargetLink?.linkCondition===al;if(m&&h){let g=e.filter(({roundNumber:w,structureId:y})=>y===s.structureId&&w===1),I=g.map(({roundPosition:w})=>w),v=yr(I.sort(),2).find(w=>w.includes(s.roundPosition));if((g.filter(({roundPosition:w})=>v.includes(w))?.map(({matchUpStatus:w})=>w)).every(w=>[Hi,wi].includes(w)))return z({result:{...H},stack:u})}if(c&&(c.matchUpStatus!=="BYE"||m)){let g=e.find(({matchUpId:U})=>U===c.matchUpId),{structure:I}=et({drawDefinition:r,structureId:g.structureId}),{stage:v,roundNumber:w,roundPosition:y,feedRound:b,structureName:S}=c;if(Gt({loser:"loser",roundPosition:y,structureName:S,roundNumber:w,keyColors:sD,feedRound:b,stage:v}),i?.progression?.doubleExitPropagateBye||m)VO({drawPosition:p,targetLink:f,inContextDrawMatchUps:e,drawDefinition:r,matchUpsMap:n});else{let U=NW({...t,targetMatchUp:c,structure:I,iteration:l});if(U.error)return z({result:U,stack:u})}}return z({result:{...H},stack:u})}function NW(t){let{inContextDrawMatchUps:e,appliedPolicies:i,drawDefinition:r,sourceMatchUp:n,targetMatchUp:a,matchUpsMap:s,structure:o,iteration:l}=t,u="conditionallyRemoveDrawPosition";Gt({method:u,structureName:o?.structureName,iteration:l});let c=On({matchUpId:a.matchUpId,inContextDrawMatchUps:e,drawDefinition:r}),{targetMatchUps:{winnerMatchUp:d}}=c,p=s?.drawMatchUps.find(w=>w.matchUpId===a.matchUpId),f,m,h;if(a.feedRound)h=d?.drawPositions?.filter(Boolean)?.find(w=>a.drawPositions.includes(w));else if(n==null)h=xi(a?.drawPositions||[],d?.drawPositions||[])?.[0];else{m=_7({structureId:o.structureId,matchUp:n,matchUpsMap:s})?.pairedPreviousMatchUp,f=[wi,Hi].includes(m?.matchUpStatus);let w=m?.drawPositions?.filter(Boolean)||[];if([...Yi,"BYE"].includes(m?.matchUpStatus)||m?.winningSide){let y=n.drawPositions||[],b=a.drawPositions?.filter(Boolean);kn(y,b)&&(b=b?.filter(S=>!y.includes(S))),h=y.concat(w).find(S=>b?.includes(S))}}if(d&&h){let{stage:w,roundNumber:y,roundPosition:b,structureName:S}=d;Gt({method:"removeDirectedWinner",drawPositionToRemove:h,color:"brightgreen",roundPosition:b,structureName:S,roundNumber:y,keyColors:sD,stage:w}),mJ({winningDrawPosition:h,winnerMatchUp:d,inContextDrawMatchUps:e,drawDefinition:r,matchUpsMap:s})}let g=IJ({targetData:c,matchUp:a,inContextDrawMatchUps:e,appliedPolicies:i,drawDefinition:r,matchUpsMap:s,structure:o,iteration:l});if(g.error)return z({result:g,stack:u});let I=fCe({pairedPreviousDoubleExit:f,noContextTargetMatchUp:p}),v=!f;return g=yo({...t,matchUpId:a.matchUpId,matchUp:p,removeWinningSide:!0,matchUpStatusCodes:[],matchUpStatus:I,removeScore:v,score:{scoreStringSide1:"",scoreStringSide2:"",sets:void 0}}),g.error?z({result:g,stack:u}):{...H}}function fCe({pairedPreviousDoubleExit:t,noContextTargetMatchUp:e}){return e.matchUpStatus==="BYE"?"BYE":t?[Hi,Qt].includes(e?.matchUpStatus)?Qt:mi:Fi}function mCe(t){let e,{inContextDrawMatchUps:i,inContextMatchUp:r,drawDefinition:n}=t,a=t.targetData.targetLinks?.winnerTargetLink;if(a.target.feedProfile===Cs){let s=r.sides?.find(({sideNumber:l})=>l===r.winningSide)?.participantId,o=i.find(l=>l.structureId===a.target.structureId&&l.roundNumber===a.target.roundNumber&&l.sides?.some(({participantId:u})=>u===s));if(o&&o.matchUpStatus===Fi){let l=On({matchUpId:o.matchUpId,inContextDrawMatchUps:i,drawDefinition:n});if(!Op({inContextDrawMatchUps:i,drawDefinition:n,targetData:l})){let{structure:u}=et({structureId:o.structureId,drawDefinition:n}),c=Yt({structure:u}).positionAssignments;for(let d of c||[])if(d.participantId===s){if(d.participantId=void 0,u?.positionAssignments)u.positionAssignments=c;else if(u?.structures){let p=Object.assign({},...(c||[]).map(f=>({[f.drawPosition]:f.participantId})));for(let f of u?.structures||[])f.positionAssignments?.forEach(m=>m.participantId=p[m.drawPosition])}fc({tournamentId:t.tournamentRecord?.tournamentId,event:t.event,drawDefinition:n,structure:u}),e=!0}}}}return{qualifierRemoved:e}}function hCe(t){let{matchUp:e,matchUpStatus:i,score:r,winningSide:n}=t,a="noDownStreamDependencies";if([wi,Hi].includes(e?.matchUpStatus)&&![wi,Hi].includes(i)){let g=IJ(t);if(g.error)return z({result:g,stack:a})}let s=i===wi,o=cr({score:r})&&!s&&(t.isCollectionMatchUp&&!t.projectedWinningSide||!n),l=t?.inContextMatchUp?.collectionId&&nCe(t.inContextMatchUp),u=t.removeScore||!l&&![cs,us].includes(i||cs),c=t.isCollectionMatchUp&&t.dualMatchUp.winningSide&&!t.projectedWinningSide||e.winningSide&&!n&&!cr({score:r}),d=g=>{let I,{structure:v,drawDefinition:w,dualMatchUp:y,disableAutoCalc:b}=t;if(y?._disableAutoCalc&&b!==!1)return XL({...t,removeWinningSide:c});let{connectedStructureIds:S}=gJ({drawDefinition:w,structure:v,matchUp:e});S.length&&(console.log({connectedStructureIds:S}),I=!0),Object.assign(t,{removeScore:g});let U=Dv(t);if(U.error)return U;if(t.removingQualifier&&t.appliedPolicies?.[bb]?.autoRemoveQualifiers){let T=mCe(t);return{...H,connectedStructures:I,...T}}return{...H,connectedStructures:I}};if(c&&n&&t.isCollectionMatchUp)return AW(t);let p=[Oc,us].includes(i)&&t.dualWinningSideChange,f=i&&i!==Fi,m=t.propagateExitStatus&&Fr(i),h=(n||p||m)&&pCe(t)||o&&d(u)||f&&sCe(t)||c&&d(u)||e&&AW({...t,removeScore:!0})||{...H};return z({result:h,stack:a})}function AW(t){let e="ndd:scoreModification";if(t.isCollectionMatchUp&&t.dualMatchUp?.winningSide&&!t.projectedWinningSide&&!t.autoCalcDisabled){let r=Dv(t);if(r.error)return r}let i=yo({...t});if(t.isCollectionMatchUp){let{matchUpTieId:r,drawDefinition:n,event:a,matchUpsMap:s}=t,{removeWinningSide:o}=_c({tournamentRecord:t.tournamentRecord,appliedPolicies:t.appliedPolicies,matchUpId:r,drawDefinition:n,matchUpsMap:s,event:a});o&&console.log("REMOVE WINNING SIDE")}return z({result:i,stack:e})}function O_(t){let e=Ge(t,[{[mr]:!0,[mn]:!0,[Ul]:!0},{homeParticipantId:!0,[xs]:lr}]);if(e.error)return e;let i=bv(t,[{[nv]:Du,attr:{[hR]:!0}}]);if(i.error)return i;let r=i?.matchUp?.matchUp?.sides?.map(c=>c?.participantId);if(t.homeParticipantId&&!r?.includes(t.homeParticipantId))return{error:To};let{disableNotice:n,homeParticipantId:a,removePriorValues:s,tournamentRecord:o,drawDefinition:l,matchUpId:u}=t;return wa({duplicateValues:!1,removePriorValues:s,tournamentRecord:o,drawDefinition:l,disableNotice:n,matchUpId:u,timeItem:{itemType:oL,itemValue:a}})}function vJ({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:r,timeStamp:n}=uf({timeItems:i?.timeItems||[],itemType:AR});return!e||n&&t&&new Date(n).getTime()>new Date(t).getTime()?{timeModifiers:r}:e}function Hd(t){let e="addMatchUpScheduledTime",i=t.matchUp,{removePriorValues:r,tournamentRecord:n,drawDefinition:a,disableNotice:s,scheduledTime:o,matchUpId:l}=t;if(!l)return z({result:{error:Un},stack:e});if(!iv(o))return z({result:{error:Ps},stack:e});if(!i){let f=di({drawDefinition:a,matchUpId:l});if(f.error)return z({result:f,stack:e});i=f.matchUp}let u=Qe(o),c=cf({matchUp:i}).scheduledDate,d=u&&!c;if((vJ({matchUp:i}).timeModifiers||[])?.length){let f=yJ({disableNotice:!0,removePriorValues:r,tournamentRecord:n,timeModifiers:[],drawDefinition:a,matchUpId:l,matchUp:i});if(f?.error)return z({result:f,stack:e})}let p=oh(o,!0,d);return wa({duplicateValues:!1,removePriorValues:r,tournamentRecord:n,drawDefinition:a,disableNotice:s,matchUpId:l,timeItem:{itemType:mh,itemValue:p}})}function yJ({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,timeModifiers:n,matchUpId:a,matchUp:s}){let o="addMatchUpTimeModifiers";if(!a)return z({result:{error:Un},stack:o});if(n!==void 0&&!Array.isArray(n))return z({info:Ap("timeModifiers"),result:{error:ie},stack:o});if(!s){let d=di({drawDefinition:i,matchUpId:a});if(d.error)return z({result:d,stack:o});s=d.matchUp}let l=vJ({matchUp:s}).timeModifiers||[],u=n.filter(d=>!l.includes(d));if(n.length&&!u.length)return{...H};if(u.some(d=>mO.includes(d))){l=l.filter(p=>!mO.includes(p));let d=Hd({disableNotice:!0,removePriorValues:t,scheduledTime:"",tournamentRecord:e,drawDefinition:i,matchUpId:a});if(d.error)return z({result:d,stack:o})}let c=n?.length?[...u,...l]:void 0;return wa({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:a,timeItem:{itemType:AR,itemValue:c}})}function _C({scheduledDate:t,removePriorValues:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:a}){if(!a)return{error:Un};let s=t&&rl.test(t);if(t&&!s)return{error:sr};let o={itemValue:Qe(t),itemType:fh};return wa({duplicateValues:!1,removePriorValues:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:a,timeItem:o})}function $C({removePriorValues:t,tournamentRecords:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,courtDayDate:a,matchUpId:s,courtIds:o}){if(!i&&!e)return{error:Ie};if(!s)return{error:Un};let l=di({drawDefinition:r,matchUpId:s});if(l.error)return l;if(l?.matchUp?.matchUpType!==ka)return{error:ia};if(!(o===void 0||Array.isArray(o)&&o.length&&o.every(c=>typeof c=="string")))return{error:ie,context:{courtIds:o}};let u;if(o){let c=e||i&&{[i.tournamentId]:i},d=Cu({tournamentRecords:c});if(d.error)return d;let p=d.courts?.filter(f=>o.includes(f.courtId));if(p?.length!==o.length)return{error:ie,context:{courtIds:o}};u=p?.map(f=>({venueId:f.venueId,courtId:f.courtId}))}return wa({duplicateValues:!1,removePriorValues:t,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:s,timeItem:{itemType:lu,itemDate:a,itemValue:u}})}function Pv({removePriorValues:t,tournamentRecords:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:a,venueId:s}){if(!i)return{error:Ie};if(!a)return{error:Un};if(s){let o=Eu({tournamentRecords:e,tournamentRecord:i,venueId:s});if(o.error)return o}return wa({duplicateValues:!1,removePriorValues:t,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:a,timeItem:{itemType:ph,itemValue:s}})}function Eh({removePriorValues:t,tournamentRecords:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,courtDayDate:a,matchUpId:s,courtId:o}){if(!i&&!e)return{error:Ie};if(!s)return{error:Un};if(o){let l=jd({tournamentRecords:e,tournamentRecord:i,courtId:o});if(l.error)return l;let u=l.venue?.venueId;Pv({tournamentRecords:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:s,venueId:u})}return wa({duplicateValues:!1,removePriorValues:t,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:s,timeItem:{itemType:Id,itemDate:a,itemValue:o}})}function Ho(t,e){let i=W4.test(t)?t:ci(t),r=Qe(t)||Qe(e)||Os(new Date);return new Date(`${r}T${i}`).getTime()}function BC(t){let e="addMatchUpScheduleItems",i=Ge(t,[{drawDefinition:!0,matchUpId:!0},{schedule:!0,[zn]:Yn}],e);if(i.error)return i;let{matchUpDependencies:r,inContextMatchUps:n}=t,{proConflictDetection:a=!1,errorOnAnachronism:s=!1,checkChronology:o=!0,removePriorValues:l,tournamentRecords:u,tournamentRecord:c,drawDefinition:d,disableNotice:p,drawMatchUps:f,matchUpId:m,schedule:h,event:g}=t,I,v;if(f)I=f.find(A=>A.matchUpId===m);else{let A=di({drawDefinition:d,event:g,matchUpId:m});if(A.error)return A;I=A.matchUp}let{endTime:w,courtId:y,courtIds:b,courtOrder:S,resumeTime:U,homeParticipantId:T,scheduledDate:P,scheduledTime:D,startTime:E,stopTime:R,timeModifiers:C,venueId:M}=h;o&&(!r||!n)&&({matchUpDependencies:r,matchUps:n}=oo({drawDefinition:d}));let N=r?.[m]?.matchUpIds;if(h.scheduledDate&&o&&N){let A=n?.filter(O=>(O.schedule?.scheduledDate||Qe(O.schedule?.scheduledTime))&&N.includes(O.matchUpId)).map(({schedule:O})=>{let k=VD(O);return new Date(k??"").getTime()});if(A?.length){let O=VD(h),k=new Date(O??"").getTime();if(Math.max(...A)>=k){if(s)return z({result:{error:Yk},stack:e});v=Yk}}}if(P!==void 0){let A=_C({disableNotice:!0,removePriorValues:l,tournamentRecord:c,drawDefinition:d,scheduledDate:P,matchUpId:m});if(A?.error)return z({result:A,stack:e,context:{scheduledDate:P}})}if(D!==void 0){let A=Hd({disableNotice:!0,removePriorValues:l,tournamentRecord:c,drawDefinition:d,scheduledTime:D,matchUpId:m,matchUp:I});if(A?.error)return z({result:A,stack:e,context:{scheduledTime:D}})}if(E!==void 0){let A=F_({disableNotice:!0,removePriorValues:l,tournamentRecord:c,drawDefinition:d,matchUpId:m,startTime:E,event:g});if(A?.error)return z({result:A,stack:e,context:{startTime:E}})}if(R!==void 0){let A=__({disableNotice:!0,removePriorValues:l,tournamentRecord:c,drawDefinition:d,matchUpId:m,stopTime:R,event:g});if(A?.error)return z({result:A,stack:e,context:{stopTime:R}})}if(U!==void 0){let A=$_({disableNotice:!0,removePriorValues:l,tournamentRecord:c,drawDefinition:d,resumeTime:U,matchUpId:m,event:g});if(A?.error)return z({result:A,stack:e,context:{resumeTime:U}})}if(w!==void 0){let A=L_({disableNotice:!0,removePriorValues:l,tournamentRecord:c,drawDefinition:d,matchUpId:m,endTime:w,event:g});if(A?.error)return z({result:A,stack:e,context:{endTime:w}})}if(b!==void 0){let A=$C({disableNotice:!0,removePriorValues:l,tournamentRecord:c,drawDefinition:d,matchUpId:m,courtIds:b});if(A?.error)return z({result:A,stack:e,context:{courtIds:b}})}if(a&&y!==void 0&&P!==void 0&&S!==void 0&&ot(S)){let A=Ye(S),O=(br({tournamentRecord:c})?.matchUps??[]).find(k=>{if(k.matchUpId===m)return!1;let F=k.schedule?.courtOrder?Ye(k.schedule.courtOrder):void 0;return k.schedule?.courtId===y&&F===A&&k.schedule?.scheduledDate===P});if(O)return z({result:{error:m6,info:`Court slot already occupied by matchUp ${O.matchUpId}`},stack:e,context:{courtId:y,courtOrder:S,scheduledDate:P}})}if(y!==void 0&&P!==void 0){let A=Eh({courtDayDate:P,disableNotice:!0,removePriorValues:l,tournamentRecords:u,tournamentRecord:c,drawDefinition:d,matchUpId:m,courtId:y});if(A?.error)return z({result:A,stack:e,context:{courtId:y}})}if(M!==void 0){let A=Pv({disableNotice:!0,removePriorValues:l,tournamentRecords:u,tournamentRecord:c,drawDefinition:d,matchUpId:m,venueId:M});if(A?.error)return z({result:A,stack:e,context:{venueId:M}})}if(S!==void 0&&ot(S)){let A=x_({disableNotice:!0,removePriorValues:l,tournamentRecord:c,drawDefinition:d,courtOrder:S,matchUpId:m});if(A?.error)return z({result:A,stack:e,context:{courtOrder:S}})}if(C!==void 0){let A=yJ({disableNotice:!0,removePriorValues:l,tournamentRecord:c,drawDefinition:d,timeModifiers:C,matchUpId:m,matchUp:I});if(A?.error)return z({result:A,stack:e,context:{timeModifiers:C}})}return ri(T)&&O_({disableNotice:!0,homeParticipantId:T,removePriorValues:l,tournamentRecord:c,drawDefinition:d,matchUpId:m}),p||St({tournamentId:c?.tournamentId,eventId:g?.eventId,context:e,drawDefinition:d,matchUp:I}),v?{...H,warnings:[v]}:{...H}}function x_({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,courtOrder:n,matchUpId:a}){if(!a)return{error:Un};if(n&&!ot(n))return{error:ie,info:"courtOrder must be numeric"};let s=n&&Ye(n);return wa({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:a,timeItem:{itemType:NR,itemValue:s}})}function bJ({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,participantId:n,officialType:a,matchUpId:s}){if(!s)return{error:Un};if(!n)return{error:lr};if(e){let l=Ei({tournamentRecord:e,participantFilters:{participantTypes:[gt],participantRoles:[UL]}}).participants??[];if(!fd({tournamentParticipants:l,participantId:n}))return{error:Vi}}let o={itemType:"SCHEDULE.ASSIGNMENT.OFFICIAL",itemValue:n};return a&&(o.itemSubTypes=[a]),wa({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:s,timeItem:o})}function F_({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:n,startTime:a,event:s}){if(!n)return{error:Un};if(!iv(a))return{error:Ps};let{matchUp:o}=di({drawDefinition:i,event:s,matchUpId:n}),{scheduledDate:l}=cf({matchUp:o}),u=(o?.timeItems??[]).filter(c=>[Zu,Gl,gc].includes(c?.itemType)).map(c=>Ho(c.itemValue,l)).reduce((c,d)=>!c||d<c?d:c,void 0);if(!u||Ho(a,l)<u){o?.timeItems&&(o.timeItems=o.timeItems.filter(d=>d.itemType!==mo));let c=oh(a,!0,!0);return wa({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:n,timeItem:{itemType:mo,itemValue:c}})}else return{error:p4}}function L_({validateTimeSeries:t=!0,removePriorValues:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:a,endTime:s,event:o}){if(!a)return{error:Un};if(!iv(s))return{error:Ps};let{matchUp:l}=di({drawDefinition:r,event:o,matchUpId:a}),{scheduledDate:u}=cf({matchUp:l}),c=(l?.timeItems??[]).filter(d=>[mo,Gl,Zu].includes(d?.itemType)).map(d=>Ho(d.itemValue,u)).reduce((d,p)=>!d||p>d?p:d,void 0);if(!t||!c||Ho(s,u)>c){l?.timeItems&&(l.timeItems=l.timeItems.filter(p=>p.itemType!==gc));let d=oh(s,!0,!0);return wa({duplicateValues:!1,removePriorValues:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:a,timeItem:{itemType:gc,itemValue:d}})}else return{error:c4}}function __({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:n,stopTime:a,event:s}){if(!n)return{error:Un};if(!iv(a))return{error:Ps};let{matchUp:o}=di({drawDefinition:i,event:s,matchUpId:n}),{scheduledDate:l}=cf({matchUp:o}),u=o?.timeItems??[];if(u.reduce((m,h)=>h.itemType===gc||m,void 0))return{error:X1};let c=u.filter(m=>[mo,Gl,Zu].includes(m?.itemType)).sort((m,h)=>Ho(m.itemValue,l)-Ho(h.itemValue,l)),d=c.at(-1),p=d?.itemType===Zu,f=c.filter(m=>!p||m.createdAt!==d.createdAt).map(m=>Ho(m.itemValue,l)).reduce((m,h)=>!m||h>m?h:m,void 0);if(Ho(a,l)>f){if(o?.timeItems&&p){let h=d.createdAt;o.timeItems=o.timeItems.filter(g=>g.createdAt!==h)}let m={itemValue:oh(a,!0,!0),itemType:Zu};return wa({duplicateValues:!0,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:n,timeItem:m})}else return{error:d4}}function $_({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,resumeTime:n,matchUpId:a,event:s}){if(!a)return{error:Un};if(!iv(n))return{error:Ps};let{matchUp:o}=di({drawDefinition:i,event:s,matchUpId:a}),{scheduledDate:l}=cf({matchUp:o}),u=o?.timeItems??[];if(u.reduce((m,h)=>h.itemType===gc||m,void 0))return{error:X1};let c=u.filter(m=>[mo,Gl,Zu].includes(m?.itemType)).sort((m,h)=>Ho(m.itemValue,l)-Ho(h.itemValue,l)),d=c.at(-1),p=d?.itemType===Gl,f=c.filter(m=>!p||m.createdAt!==d.createdAt).map(m=>Ho(m.itemValue,l)).reduce((m,h)=>!m||h>m?h:m,void 0);if(Ho(n,l)>f){if(o?.timeItems&&p){let h=d.createdAt;o.timeItems=o.timeItems.filter(g=>g.createdAt!==h)}let m={itemValue:oh(n,!0,!0),itemType:Gl};return wa({duplicateValues:!0,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:a,timeItem:m})}else return{error:OIe}}function gCe(t){let{targetData:e,matchUpsMap:i}=t,{targetMatchUps:{loserMatchUp:r}}=e,n=Fr(r?.matchUpStatus),a=!!i?.drawMatchUps.find(s=>s.loserMatchUpId===r?.matchUpId&&Fr(s.matchUpStatus));return a&&r?.matchUpStatus===wi||a&&n}function ICe({drawDefinition:t,matchUpStatus:e,matchUpsMap:i,winningSide:r,dualMatchUp:n,tieFormat:a,structure:s,matchUp:o,event:l,score:u}){let c=ke(n,void 0,!0);for(let p of c?.tieMatchUps||[])p.matchUpId===o.matchUpId&&(p.winningSide=r,p.score=u,!cr({score:u})&&!e?Object.assign(p,{...YR}):e&&(p.matchUpStatus=e));a=a??vn({matchUp:o,structure:s,drawDefinition:t,event:l})?.tieFormat;let{winningSide:d}=wS({matchUp:c,drawDefinition:t,matchUpsMap:i,structure:s,tieFormat:a,event:l});return{projectedWinningSide:d}}function vCe(t){let{tournamentRecord:e,inContextMatchUp:i,structure:r,drawDefinition:n}=t,a=i.roundNumber,s=i.sides.find(b=>b.sideNumber===i.winningSide),o=i.sides.find(b=>b.sideNumber!==i.winningSide),{drawPosition:l,participantId:u}=s,{drawPosition:c,participantId:d}=o,p="swapWinnerLoser",{matchUps:f}=Nt(t),m=f.filter(({drawPositions:b,roundNumber:S})=>b?.includes(l)&&S>a);ra({changeWinner:!0})&&console.log({existingWinnerSubsequentMatchUps:m}),m.forEach(b=>{b.drawPositions=b.drawPositions?.map(S=>S===l?c:S)||[],St({tournamentId:e?.tournamentId,eventId:t.event?.eventId,context:p,drawDefinition:n,matchUp:b})});let{stage:h,stageSequence:g}=r,I=n.structures.filter(({stage:b,stageSequence:S})=>b===h&&S>g).map(({structureId:b})=>b),{targetLinks:{loserTargetLink:v,winnerTargetLink:w}}=t.targetData,y=[v?.target.structureId,w?.target?.structureId].filter(Boolean);return n.structures.filter(({stage:b,structureId:S})=>b!==h&&y.includes(S)).forEach(({stage:b,stageSequence:S,structureId:U})=>{I.includes(U)||I.push(U),n.structures.filter(({stage:T,stageSequence:P})=>T===b&&P>S).forEach(({structureId:T})=>{I.includes(T)||I.push(T)})}),n.structures.filter(({structureId:b})=>I.includes(b)).forEach(b=>{let{positionAssignments:S}=Yt({structure:b}),U=S?.find(({participantId:P})=>P===u),T=S?.find(({participantId:P})=>P===d);U&&(U.participantId=d),T&&(T.participantId=u)}),yo({...t})}function ff(t){let e="setMatchUpStatus";t.matchUpStatus&&[mi,wi].includes(t.matchUpStatus)&&(t.score=void 0);let{allowChangePropagation:i,disableScoreValidation:r,propagateExitStatus:n,tournamentRecords:a,tournamentRecord:s,disableAutoCalc:o,enableAutoCalc:l,drawDefinition:u,matchUpStatus:c,winningSide:d,matchUpId:p,event:f,score:m}=t;if(!u)return{error:_e};if(c&&[Oc,cs,us,Fi].includes(c)&&d)return{error:ie,winningSide:d,matchUpStatus:c};if(![void 0,...aK].includes(c))return z({result:{error:QI},info:"matchUpStatus does not exist",stack:"setMatchUpStatus"});let h=kr({drawDefinition:u}),{matchUps:g}=Qi({nextMatchUps:!0,tournamentRecord:s,inContext:!0,drawDefinition:u,matchUpsMap:h,event:f}),I=h.drawMatchUps.find(V=>V.matchUpId===p),v=g?.find(V=>V.matchUpId===p);if(!I||!g)return{error:un};if((I.winningSide||d)&&c==="BYE")return{context:"Cannot have Bye with winningSide",error:zT,matchUpStatus:c};let w=v?.structureId,{structure:y}=et({drawDefinition:u,structureId:w}),b=Di(Zt)(I.matchUpType),S=v?.drawPositions?.filter(Boolean),U=v?.matchUpTieId,T=On({matchUpId:U||p,inContextDrawMatchUps:g,drawDefinition:u});Object.assign(t,{inContextDrawMatchUps:g,inContextMatchUp:v,matchUpTieId:U,matchUpsMap:h,targetData:T,structure:y,matchUp:I});let P=c===Fi&&m?.scoreStringSide1===""&&m?.scoreStringSide2===""&&!d;if(gCe(t)&&P)return{error:SIe};let D=Op(t),E;if(b){if(o)xt({extension:{name:Cm,value:!0},element:I});else if(l){let V=I.winningSide,{winningSide:_,scoreStringSide1:B,scoreStringSide2:G,set:j}=wS({drawDefinition:u,matchUpsMap:h,structure:y,matchUp:I,event:f}),K={scoreStringSide1:B,scoreStringSide2:G,sets:j?[j]:[]};if(E=_!==V,D&&E)return z({stack:"winningSideWithDownstreamDependencies",result:{error:qE},context:{winningSide:d,matchUp:I}});En({name:Cm,element:I}),Object.assign(t,{winningSide:_,dualWinningSideChange:E,projectedWinningSide:_,score:K})}SS({tournamentId:s?.tournamentId,inContextDualMatchUp:v,eventId:f?.eventId,dualMatchUp:I,drawDefinition:u})}if(b&&c&&[uh].includes(c))return{info:"Not supported for matchUpType: TEAM",error:ie};if(m&&!b&&!r){let V=I.matchUpFormat??y?.matchUpFormat??u?.matchUpFormat??f?.matchUpFormat,_=O0({existingMatchUpStatus:I.matchUpStatus,matchUpFormat:V,matchUpStatus:c,winningSide:d,score:m});if(_.error)return _}let R=Tt({policyTypes:[bb,Po],tournamentRecord:s,drawDefinition:u,event:f})?.appliedPolicies??{};bt(t.policyDefinitions)&&Object.assign(R,t.policyDefinitions);let C=bCe({assignedDrawPositions:S,propagateExitStatus:n,inContextMatchUp:v,appliedPolicies:R,drawDefinition:u,matchUpStatus:c,structure:y,matchUp:I});if(C?.error)return C;let M=v?.stage===We&&v.finishingRound===1,N=M&&d,A=M&&I.winningSide&&!d&&(!t.matchUpStatus||t.matchUpStatus&&IO({matchUpStatus:t.matchUpStatus}))&&(!t.outcome||!cr({outcome:t.outcome})),O=N&&d!==I.winningSide&&I.winningSide;if(Object.assign(t,{qualifierAdvancing:N,qualifierChanging:O,removingQualifier:A,appliedPolicies:R}),U){let{matchUp:V}=di({matchUpId:U,inContext:!0,drawDefinition:u,matchUpsMap:h,event:f});if(V){let _=vn({matchUp:V,drawDefinition:u,structure:y,event:f})?.tieFormat,{projectedWinningSide:B}=ICe({drawDefinition:u,matchUpStatus:c,dualMatchUp:V,matchUpsMap:h,winningSide:d,tieFormat:_,structure:y,matchUp:I,event:f,score:m}),G=V.winningSide;E=B!==G;let j=V._disableAutoCalc;Object.assign(t,{isCollectionMatchUp:!0,dualWinningSideChange:E,projectedWinningSide:B,autoCalcDisabled:j,matchUpTieId:U,dualMatchUp:V,tieFormat:_})}}let k=lS({matchUpStatus:c});if(!U){if(D&&!d&&(c&&IO({matchUpStatus:c})||c&&[wi,Hi].includes(c)))return{error:zT,activeDownstream:D,winningSide:d};if(d&&d===I.winningSide&&c&&!k)return{context:"winningSide must include directing matchUpStatus",error:zT,directingMatchUpStatus:k,matchUpStatus:c}}let{schedule:F}=t;if(F){let V=BC({disableNotice:!0,tournamentRecords:a,tournamentRecord:s,drawDefinition:u,matchUpId:p,schedule:F});if(V.error)return V}let x=!b&&!E&&d&&I.winningSide&&I.winningSide!==d;if(i&&x&&I.roundPosition)return vCe(t);let L=d&&!U||t.projectedWinningSide;Gt({activeDownstream:D,matchUpWinner:L,method:e,winningSide:d});let $=!D&&hCe(t)||L&&yCe(t)||(k||t.autoCalcDisabled)&&wJ(t)||{error:b4};return z({result:$,stack:e})}function yCe(t){let{matchUp:e,winningSide:i,matchUpTieId:r,dualWinningSideChange:n}=t;return i===e.winningSide||r&&!n?wJ(t):z({stack:"winningSideWithDownstreamDependencies",result:{error:qE},context:{winningSide:i,matchUp:e}})}function wJ(t){let{tournamentRecord:e,matchUp:i,event:r}=t,n=t.isCollectionMatchUp&&i.winningSide&&!t.winningSide&&!cr({score:t.score}),a=t.isCollectionMatchUp?t.matchUpStatus||n&&Fi||t.winningSide&&ki||cs:t.matchUpStatus||ki,s=t.removeScore||[Oc,mi].includes(a)&&![cs,us].includes(a),o=yo({...t,matchUpStatus:a,removeWinningSide:n,removeScore:s});if(o.error)return o;if(t.isCollectionMatchUp){let{matchUpTieId:l,drawDefinition:u,matchUpsMap:c}=t,d=_c({appliedPolicies:t.appliedPolicies,matchUpId:l,tournamentRecord:e,drawDefinition:u,matchUpsMap:c,event:r});if(d.error)return d;Object.assign(o,{tieMatchUpResult:d})}return o}function bCe({assignedDrawPositions:t,propagateExitStatus:e,inContextMatchUp:i,appliedPolicies:r,drawDefinition:n,matchUpStatus:a,structure:s,matchUp:o}){if(r?.[Po]?.requireParticipantsForScoring===!1)return{...H};let l=i?.sides?.map(d=>d.participantId).filter(Boolean).length,u=o?.sides?[]:Yt({structureId:s?.structureId,drawDefinition:n}).positionAssignments,c=l&&l===2||o.collectionId&&Vn({structure:s})&&l&&l>=1||t?.length===2&&u?.filter(d=>t.includes(d.drawPosition)).every(d=>d.participantId);return a&&[mi,Qt,wi].includes(a)&&l===1&&e?{...H}:a&&nK.includes(a)&&!c?z({info:"matchUpStatus requires assigned participants",context:{matchUpStatus:a,requiredParticipants:c},result:{error:QI}}):{...H}}function SJ({tournamentRecord:t,drawDefinition:e,matchUpId:i,event:r}){if(!e)return{error:_e};let{matchUp:n}=di({drawDefinition:e,matchUpId:i,event:r});return n?.matchUpType!==ka?{error:ia}:ff({enableAutoCalc:!0,tournamentRecord:t,drawDefinition:e,matchUpId:i,event:r})}function UJ({drawDefinition:t,event:e,matchUpId:i}){if(!t)return{error:_e};if(!i)return{error:Un};let{matchUp:r}=di({drawDefinition:t,event:e,matchUpId:i});return r?En({name:wR,element:r}):{error:un}}function wCe({substituteParticipantId:t,existingParticipantId:e,tournamentRecord:i,drawDefinition:r,sideNumber:n,matchUpId:a,event:s}){let o="substituteParticipant";if(!r)return{error:_e};if(!a)return{error:Un};if(!e||!t)return z({result:{error:lr},stack:o});let{matchUp:l}=di({drawDefinition:r,matchUpId:a,event:s});if(!l)return{error:un};if(!l.collectionId)return z({result:{error:ia},stack:o});let u=kr({drawDefinition:r}),{matchUps:c}=Qi({tournamentParticipants:i?.participants,inContext:!0,drawDefinition:r,matchUpsMap:u}),d=c?.find(f=>f.matchUpId===a),p=c?.find(f=>f.matchUpId===d?.matchUpTieId)?.sides?.find(f=>f.participant.individualParticipants.some(({participantId:m})=>m===e));return!p||n&&p.sideNumber!==n?{error:To}:p.participant?.individualParticipants?.map(vt).filter(f=>f!==e)?.includes(t)?A_({newParticipantId:t,tieMatchUpId:a,existingParticipantId:e,substitution:!0,tournamentRecord:i,drawDefinition:r,event:s}):z({result:{error:To},stack:o})}function TJ(t){return wCe(t)}function DJ({drawDefinition:t,matchUpId:e,event:i}){if(!t)return{error:_e};let{matchUp:r}=di({drawDefinition:t,matchUpId:e,event:i});return xt({extension:{name:Cm,value:!0},element:r})}function PJ(t){let e="setMatchUpFormat",i=Ge(t,[{tournamentRecord:!0},{[Wr]:b=>xa({matchUpFormat:b}),[Fa]:Mw,matchUpFormat:!0}]);if(i.error)return z({result:i,stack:e});let{tournamentRecord:r,drawDefinition:n,scheduledDates:a,stageSequences:s,matchUpFormat:o,structureId:l,eventType:u,matchUpId:c,eventId:d,stages:p,drawId:f,event:m,force:h}=t;if(a&&!Array.isArray(a))return z({result:{error:ie,scheduledDates:a},stack:e});if(u&&!em([nl,ls],u))return z({result:{error:Zl},stack:e});let g=0,I=t.structureIds||l&&[l].filter(Boolean)||[],v=t.eventIds||d&&[d].filter(Boolean)||[],w=t.drawIds||f&&[f].filter(Boolean)||[];if((l||I?.length)&&!n)return z({result:{error:_e},stack:e});if(f&&c&&n){let b=_0({tournamentRecord:r,drawDefinition:n,matchUpFormat:o,structureIds:I,structureId:l,matchUpId:c});if(b.error)return b;g+=1}let y=b=>{let S=[];for(let U of b.structures||[]){if(Array.isArray(p)&&!p.includes(U.stage)||Array.isArray(s)&&!s.includes(U.stageSequence)||I?.length&&!I.includes(U.structureId))continue;I?.length&&U.matchUpFormat!==o&&(U.matchUpFormat=o,S.push(U.structureId),g+=1);let T=((h||a)&&Nt({matchUpFilters:{matchUpStatuses:[Fi]},structure:U}).matchUps)??[],P=(a&&Nt({matchUpFilters:{matchUpStatuses:[Fi]},contextFilters:{scheduledDates:a},afterRecoveryTimes:!1,inContext:!0,structure:U}).matchUps)??[];if(T?.length){let D=P?P.map(Ir):T.map(Ir);for(let E of T)D.includes(E.matchUpId)&&(E.matchUpFormat=a?.length?o:void 0,St({tournamentId:r?.tournamentId,eventId:m?.eventId,context:e,drawDefinition:b,matchUp:E}))}}return!S.length&&b.matchUpFormat!==o&&(b.matchUpFormat=o,g+=1),S};for(let b of r?.events||[])if(!(v?.length&&!v.includes(b.eventId)||u&&u!==b.eventType||u===rr))if(Array.isArray(s)||Array.isArray(p)||I?.length||w?.length)for(let S of b.drawDefinitions||[]){if(Array.isArray(w)&&!w.includes(S.drawId))continue;let U=y(S);ti({structureIds:U,drawDefinition:S})}else b.matchUpFormat!==o&&(b.matchUpFormat=o,g+=1);return g?{...H,modificationsCount:g}:{...H,info:tv}}function B_({inheritance:t=!0,tournamentRecord:e,drawDefinition:i,matchUpId:r,event:n}){if(!i)return{error:_e};let a=di({drawDefinition:i,matchUpId:r})?.matchUp;if(!a?.tieMatchUps)return{error:ia};let s=di({inContext:!0,drawDefinition:i,matchUpId:r,event:n})?.matchUp,o=0;return(a?.sides||[]).forEach(l=>{l.lineUp&&delete l.lineUp}),(s?.sides||[]).forEach(l=>{if(o+=1,t===!1){let u=s?.tieFormat,c=l.participantId;u&&c&&wh({drawDefinition:i,participantId:c,lineUp:[],tieFormat:u})}St({tournamentId:e?.tournamentId,context:"resetMatchUpLineUps",eventId:n?.eventId,drawDefinition:i,matchUp:a})}),{...H,modificationsCount:o}}function EJ(t){let{matchUpFormat:e,matchUpStatus:i,winningSide:r,score:n,setTBlast:a}=t;if(!n)return{sets:[]};let s=n.sets||[],o=Wl({winnerFirst:!1,matchUpFormat:e,matchUpStatus:i,setTBlast:a,sets:s}),l=Wl({winnerFirst:!1,reversed:!0,matchUpFormat:e,matchUpStatus:i,setTBlast:a,sets:s}),u=Wl({matchUpFormat:e,matchUpStatus:i,winningSide:r,setTBlast:a,sets:s}),c=o===u?l:o;return r&&(o=r===1?u:c,l=r===2?u:c),{score:{sets:s,scoreStringSide1:o,scoreStringSide2:l}}}function SCe({sourceMatchUpStatusCodes:t,propagateExitStatus:e,sourceMatchUpStatus:i,loserParticipantId:r,tournamentRecord:n,drawDefinition:a,loserMatchUp:s,matchUpsMap:o,event:l}){let u="progressExitStatus";Gt({method:u,newline:!0,color:"magenta",keyColors:{loserMatchUpId:"brightcyan",sourceMatchUpStatus:"brightyellow"},loserMatchUpId:s?.matchUpId,loserMatchUpStatus:s?.matchUpStatus,sourceMatchUpStatus:i,sourceMatchUpStatusCodes:JSON.stringify(t),loserParticipantId:r?.slice(0,8),propagateExitStatus:e});let c=Fr(i)&&i!==$r&&i||mi,d=Qi({inContext:!0,drawDefinition:a,matchUpsMap:o})?.matchUps,p=c,f=d?.find(m=>m.matchUpId===s?.matchUpId);if(Gt({method:u,color:"magenta",carryOverMatchUpStatus:c,updatedLoserMatchUpId:f?.matchUpId,updatedLoserStatus:f?.matchUpStatus,updatedLoserSides:JSON.stringify(f?.sides?.map(m=>({sn:m.sideNumber,pid:m.participantId?.slice(0,8),bye:m.bye}))),updatedLoserDP:JSON.stringify(f?.drawPositions),existingStatusCodes:JSON.stringify(f?.matchUpStatusCodes)}),f?.matchUpId&&p){let m,h=f.matchUpStatusCodes?.map(v=>typeof v=="string"?v:"WO")??[],g=f.sides?.find(v=>v.participantId===r);if(g?.sideNumber){let v=f?.sides?.reduce((w,y)=>y?.participantId?w+1:w,0);if(Gt({method:u,color:"brightyellow",keyColors:{decision:"brightgreen"},loserSideNumber:g.sideNumber,participantsCount:v,statusCodesLength:h.length,existingStatusCodes:JSON.stringify(h),loserMatchUpIsExit:Fr(s.matchUpStatus),loserMatchUpOriginalStatus:s.matchUpStatus}),v===1&&h.length===0)m=g.sideNumber===1?2:1,h[0]=t[0],Gt({method:u,color:"brightgreen",decision:"SINGLE_PARTICIPANT_no_existing_codes",winningSide:m,statusCodes:JSON.stringify(h)});else if(!Fr(s.matchUpStatus))m=g.sideNumber===1?2:1,h[0]=t[0],Gt({method:u,color:"brightgreen",decision:"TWO_PARTICIPANTS_not_exit",winningSide:m,statusCodes:JSON.stringify(h)});else{let w=h[0];h[g.sideNumber-1]=t[0];let y=g.sideNumber===1?2:1;h[y-1]=w,p=wi,m=void 0,Gt({method:u,color:"brightred",decision:"BOTH_EXITS_converting_to_DOUBLE_WALKOVER",loserMatchUpStatus:p,winningSide:m,statusCodes:JSON.stringify(h)})}}else Gt({method:u,color:"brightyellow",decision:"NO_LOSER_PARTICIPANT_SIDE_FOUND",loserParticipantId:r?.slice(0,8),availableSides:JSON.stringify(f.sides?.map(v=>({sn:v.sideNumber,pid:v.participantId?.slice(0,8)})))});Gt({method:u,color:"brightmagenta",keyColors:{finalStatus:"brightgreen",finalWinningSide:"brightyellow"},action:"calling_setMatchUpState",loserMatchUpId:s.matchUpId,finalStatus:p,finalWinningSide:m,finalStatusCodes:JSON.stringify(h)});let I=ff({matchUpStatus:p,matchUpId:s.matchUpId,matchUpStatusCodes:h,allowChangePropagation:!0,propagateExitStatus:e,tournamentRecord:n,drawDefinition:a,winningSide:m,event:l});return z({result:I,stack:u,context:{progressExitStatus:!0}})}return z({result:{error:ta},stack:u})}function FS(t){let e=Ge(t,[{[Ul]:!0,[mn]:!0}]);if(e.error)return e;let i="setMatchUpStatus",r=Is(t);if(!t.drawDefinition){let b=t.tournamentRecord??(t.tournamentId&&r[t.tournamentId]);t.tournamentRecord||(t.tournamentRecord=b);let S=jn({eventId:t.eventId,drawId:t.drawId,tournamentRecord:b});if(S.error)return S;S.drawDefinition&&(t.drawDefinition=S.drawDefinition),t.event=S.event}let{disableScoreValidation:n,propagateExitStatus:a,policyDefinitions:s,tournamentRecord:o,disableAutoCalc:l,enableAutoCalc:u,drawDefinition:c,matchUpId:d,schedule:p,event:f,notes:m}=t,h=t.matchUpFormat||t.outcome?.matchUpFormat,{policy:g}=sf({policyType:Po,tournamentRecord:o,event:f}),I=t.allowChangePropagation!==void 0&&t.allowChangePropagation||g?.allowChangePropagation!==void 0&&g.allowChangePropagation||void 0,{outcome:v,setTBlast:w}=t;if(v?.winningSide&&![1,2].includes(v.winningSide))return{error:WE};if(h){let b=_0({tournamentRecord:o,drawDefinition:c,matchUpFormat:h,matchUpId:d,event:f});if(b.error)return b}if(v?.score?.sets&&!v.score.scoreStringSide1){let{score:b}=EJ({...v,setTBlast:w});v.score=b,v.score.sets=v.score.sets.filter(S=>S.side1Score||S.side2Score||S.side1TiebreakScore||S.side2TiebreakScore)}let y=ff({matchUpStatusCodes:v?.matchUpStatusCodes,matchUpStatus:v?.matchUpStatus,winningSide:v?.winningSide,allowChangePropagation:I,disableScoreValidation:n,score:v?.score,propagateExitStatus:a,tournamentRecords:r,policyDefinitions:s,tournamentRecord:o,disableAutoCalc:l,enableAutoCalc:u,drawDefinition:c,matchUpFormat:h,matchUpId:d,schedule:p,event:f,notes:m});if(y.context?.progressExitStatus){let b=!0,S=0;for(;b&&S<10;){b=!1,S+=1;let U=SCe({sourceMatchUpStatusCodes:y.context.sourceMatchUpStatusCodes,sourceMatchUpStatus:y.context.sourceMatchUpStatus,loserParticipantId:y.context.loserParticipantId,propagateExitStatus:t.propagateExitStatus,tournamentRecord:t.tournamentRecord,loserMatchUp:y.context.loserMatchUp,matchUpsMap:y.context.matchUpsMap,drawDefinition:t.drawDefinition,event:t.event});U.context?.loserMatchUp&&(Object.assign(y.context,U.context),b=!0)}}return z({result:y,stack:i})}function RJ(t){if(!t?.outcomes)return{error:Xe};if(!Array.isArray(t.outcomes))return{error:Xe,info:{outcomes:t.outcomes}};let e=t.tournamentRecords||t.tournamentRecord&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord}||{},i=t.outcomes??[],r=i.reduce((n,a)=>n.includes(a.tournamentId)?n:n.concat(a.tournamentId),[]);for(let n of r){let a=e[n];if(!a)return{error:Ie};let s=i.filter(o=>o.tournamentId===n);if(s.length){let o=UCe({outcomes:s,tournamentRecord:a});if(o.error)return o}}return{...H}}function UCe(t){let{tournamentRecords:e,tournamentRecord:i,outcomes:r,policyDefinitions:n}=t,a={};r.forEach(s=>{let{eventId:o}=s;a[o]||(a[o]=[]),a[o].push(s)});for(let s of Object.keys(a)){let{event:o}=jn({tournamentRecord:i,eventId:s});for(let l of a[s]){let{drawId:u}=l,c=o?.drawDefinitions?.find(d=>d.drawId===u);if(c&&u){let{matchUpFormat:d,matchUpId:p}=l,f=FS({schedule:l?.schedule,tournamentRecords:e,policyDefinitions:n,tournamentRecord:i,drawDefinition:c,matchUpFormat:d,matchUpId:p,outcome:l,drawId:u,event:o});if(f.error)return f}}}return{...H}}function TCe({drawDefinition:t,matchUpId:e,outcome:i,matchUp:r}){if(!r&&!t)return{error:_e};if(!i)return{error:Xe,info:"missing outcome"};if(!r&&!e)return{error:ta};if(!r){let n=di({drawDefinition:t,matchUpId:e});if(n.error)return n;r=n.matchUp}return typeof i!="object"||!i.score?.scoreStringSide1||!i.score?.scoreStringSide2?{error:ie}:xt({element:r,extension:{name:wR,value:i}})}function CJ(t){return TCe(t)}function V_(t){let e="resetTieFormat",{drawDefinition:i,event:r,uuids:n}=t,a=Ge(t,[{[mr]:!0,[Ul]:!0}],e);if(a.error)return a;let s=bv(t,[{[nv]:Du}]);if(s[xs])return s;let o=t.tournamentRecord?.tournamentId,{matchUp:l,structure:u}=s?.matchUp??{};if(!l?.tieMatchUps)return z({result:{error:ia},info:"Must be a TEAM matchUp",stack:e});if(!l.tieFormat)return{...H};let c=vn({structure:u,drawDefinition:i,event:r})?.tieFormat;if(!c)return z({result:{error:_r},info:"No inherited tieFormat",stack:e});let d=[],p=[],f=[],m=[];for(let h of c.collectionDefinitions){let{matchUpCount:g,collectionId:I}=h;p.push(I);let v=(l.tieMatchUps||[]).filter(w=>w.collectionId===I);if(v.length>g)v.sort((w,y)=>(w.matchUpStatus===Fi?1:0)-(y.matchUpStatus===Fi?1:0)),f.push(...v.slice(0,g)),d.push(...v.slice(3).map(Ir));else if(f.push(...v),v.length<g){let w=g-v.length,y=yS({collectionDefinition:h,matchUpsLimit:w,matchUp:l,uuids:n});m.push(...y)}}for(let h of l?.tieMatchUps||[])h.collectionId&&!p.includes(h.collectionId)&&d.push(h.matchUpId);return m.length&&(f.push(...m),hd({eventId:r?.eventId,matchUps:m,drawDefinition:i,tournamentId:o})),d.length&&Pu({matchUpIds:d,eventId:r?.eventId,drawDefinition:i,tournamentId:o}),l&&(l.tieMatchUps=f,l.tieFormatId=void 0,l.tieFormat=void 0,St({structureId:u?.structureId,eventId:r?.eventId,context:e,drawDefinition:i,tournamentId:o,matchUp:l})),{...H,newMatchUps:m,deletedMatchUpIds:d}}function j_(t){let{tournamentRecord:e,drawDefinition:i,matchUpId:r,event:n}=t,a="resetScorecard";if(!i)return z({result:{error:_e},stack:a});if(!r)return z({result:{error:Un},stack:a});if(!ri(r))return z({result:{error:ie,matchUpId:r},stack:a});let s=kr({drawDefinition:i}),{matchUps:o}=Qi({nextMatchUps:!0,inContext:!0,drawDefinition:i,matchUpsMap:s}),l=s.drawMatchUps.find(h=>h.matchUpId===r),u=o?.find(h=>h.matchUpId===r);if(!l||!o)return{error:un};if(l.matchUpType!==ya)return{error:ia};let c=On({inContextDrawMatchUps:o,drawDefinition:i,matchUpId:r}),d=u?.structureId,{structure:p}=et({drawDefinition:i,structureId:d});if(Object.assign(t,{inContextDrawMatchUps:o,inContextMatchUp:u,matchUpsMap:s,targetData:c,structure:p,matchUp:l}),Op(t))return{error:qE};if(l.tieMatchUps?.length)for(let h of l.tieMatchUps){let g=ff({matchUpId:h.matchUpId,matchUpTieId:r,winningSide:void 0,removeScore:!0,tournamentRecord:e,drawDefinition:i,event:n});if(g.error)return z({result:g,stack:a})}let f=Tt({tournamentRecord:e,drawDefinition:i,event:n})?.appliedPolicies,m=_c({event:t.event,removeScore:!0,tournamentRecord:e,appliedPolicies:f,drawDefinition:i,matchUpsMap:s,matchUpId:r});if(m.error)return z({result:m,stack:a});if(t.tiebreakReset&&!m.tieFormatRemoved){let h=vn({drawDefinition:i,structure:p,event:n})?.tieFormat;if(l.tieFormat&&h){let{matchUpCountDifference:g,descendantDifferences:I,ancestorDifferences:v,valueDifference:w}=Ic({descendant:l.tieFormat,ancestor:h});if(I.collectionIds.length===1&&!v.collectionIds.length&&!v.groupsCount&&g===1&&w===1){let y=V_({tournamentRecord:e,drawDefinition:i,matchUpId:r,event:n});if(y.error)return y}}}return{...H}}function MJ(t){let e=Ge(t,[{[mn]:!0,[kc]:!0},{[rI]:{[Vw]:!1,roundNumbers:!1},[W5]:"At least one must be provided",[zn]:an}]);if(e.error)return e;let i=A8(t);if(i.error)return i;let{matchUpIds:r}=i,n=Di(ya)(t.event.eventType),{tournamentRecord:a,drawDefinition:s,event:o}=t;for(let l of r){if(n){let c=j_({tiebreakReset:!0,tournamentRecord:a,drawDefinition:s,matchUpId:l,event:o});if(c.error||t.removeAssignments&&B_({inheritance:!1,drawDefinition:s,matchUpId:l}).error)return c}let u=ff({winningSide:void 0,removeScore:!0,tournamentRecord:a,drawDefinition:s,matchUpId:l,event:o});if(u.error)return u;if(t.removeAssignments){let c=k_({...t,matchUpId:l});if(c.error)return c}}return{...H}}function DCe({tournamentRecord:t,drawDefinition:e,finishingOrder:i}){if(!e)return{error:_e};let r="setOrderOfFinish";if(!Array.isArray(i))return z({info:Ap("finishingOrder"),result:{error:ie},stack:r});let{completedMatchUps:n,matchUpsMap:a}=cv({inContext:!0,drawDefinition:e}),s=n?.map(Ir)??[],o=i.map(Ir),{matchUpTypes:l,roundNumbers:u,structureIds:c,matchUpTieIds:d}=(n??[]).filter(({matchUpId:v})=>o.includes(v)).reduce((v,w)=>{let{matchUpTieId:y,matchUpType:b,roundNumber:S,structureId:U}=w;return v.matchUpTypes.includes(b)||v.matchUpTypes.push(b),v.roundNumbers.includes(S)||v.roundNumbers.push(S),v.structureIds.includes(U)||v.structureIds.push(U),v.matchUpTieIds.includes(y)||v.matchUpTieIds.push(y),v},{matchUpTypes:[],roundNumbers:[],structureIds:[],matchUpTieIds:[]});if(l.length>1||d.length>1||u.length>1||c.length>1)return z({info:"matchUpType, structureId and roundNumber must be equivalent",result:{error:ie},stack:r});let p,f,m={},h=[],g=[];if(!i.every(({orderOfFinish:v,matchUpId:w})=>(h.push(w),v&&g.push(v),m[w]=v,p=s.includes(w),f=v===void 0||ot(v)&&Math.floor(v)>0,p&&f)))return z({result:{error:p?ie:QI},info:!p&&"matchUps must be completed"||!f&&"orderOfFinish must be integer > 0 or undefined"||void 0,stack:r});let I=n?.filter(v=>v.structureId===c[0]&&v.roundNumber===u[0]&&v.matchUpType===l[0]&&v.matchUpTieId===d[0]&&!h.includes(v.matchUpId));for(let v of I??[]){let{orderOfFinish:w}=v||{};if(w){if(!ot(w))return z({context:{orderOfFinish:w,matchUp:v},result:{error:ie},stack:r});g.push(w)}}if(a6(g).length!==g.length||Math.max(...g)>g.length)return z({info:"Values not unique or greater than expected number of values",result:{error:ie},stack:r});if(c.length){let v=_R({matchUpFilters:{matchUpIds:o},structureId:c[0],drawDefinition:e,matchUpsMap:a});if(v.error)return z({result:v,stack:r});v.completedMatchUps?.forEach(w=>{w.orderOfFinish=m[w.matchUpId],St({tournamentId:t.tournamentId,context:"setOrderOfFinish",drawDefinition:e,matchUp:w})})}return{...H}}function NJ(t){return DCe(t)}function AJ(t){let{tournamentRecord:e,drawDefinition:i,matchUpId:r,lineUps:n,event:a}=t,s="applyLineUps",o=Ge(t,[{[mr]:!0,[mn]:!0,[Ul]:!0},{lineUps:!0,[zn]:an}],s);if(o.error)return o;let l=e.participants||[],u=di({tournamentParticipants:l,inContext:!0,drawDefinition:i,matchUpId:r});if(u.error)return u;if(!u.matchUp)return{error:un};let{matchUp:c,structure:d}=u,{drawPositions:p,matchUpType:f}=c;if(f!==Zt)return{error:ia};if(!p?.length)return{error:Ew};let m=vn({matchUp:c,drawDefinition:i,structure:d,event:a})?.tieFormat,h={};for(let I of n){if(!Array.isArray(I))return{error:ie,lineUp:I};let v={},w=[];for(let T of I){if(typeof T!="object")return{error:ie,lineUpAssignment:T};let{participantId:P,collectionAssignments:D=[]}=T;if(!Array.isArray(D))return{error:ie,collectionAssignments:D};let E=l.find(C=>C.participantId===P);if(!E)return{error:Vi};if(E.participantType!==gt)return{error:Do};let R=c.sides?.find(C=>C.participant?.individualParticipantIds?.includes(P))?.sideNumber;R&&w.push(R);for(let C of D){if(typeof C!="object")return{error:ie,collectionAssignment:C};let{collectionId:M,collectionPosition:N}=C,A=m?.collectionDefinitions?.find(F=>F.collectionId===M);if(!A)return{error:ie,collectionId:M};let O=`${M}-${N}`;v[O]||(v[O]=[]);let k=v[O].length;if(Di(Wt)(A.matchUpType)&&k||A.matchUpType===$t&&k>1)return{info:"Excessive collectionPosition assignments",error:ie};v[O].push(P)}}let y=Object.values(v);for(let T of y)if(T.length===2){let{participant:P}=Qs({tournamentParticipants:l,participantIds:T});if(!P){let D=ul({participant:{participantType:pt,participantRole:Kr,individualParticipantIds:T},pairOverride:!0,tournamentRecord:e});if(D.error)return D}}let b=va(w),S=(b[1]||0)>(b[2]||0)&&1||(b[2]||0)>(b[1]||0)&&2||void 0,U=Object.keys(h).map(T=>parseInt(T));S&&!U.includes(S)&&(h[S]=I)}if(!Object.keys(h).length)return{error:tF};if(u=di({drawDefinition:i,matchUpId:r}),u.error)return u;if(!u.matchUp)return{error:un};let{matchUp:g}=u;g.sides??=[];for(let I of[1,2]){let v=g.sides.find(y=>y.sideNumber===I),w=h[I];if(w)v?v.lineUp=w:g.sides.push({lineUp:w,sideNumber:I});else continue}return St({tournamentId:e?.tournamentId,context:s,drawDefinition:i,matchUp:g}),{...H}}var G_={};ct(G_,{anonymizeTournamentRecord:()=>eQ,generate:()=>kJ,generateEventWithDraw:()=>zC,generateOutcome:()=>J_,generateOutcomeFromScoreString:()=>H_,generateParticipants:()=>Ev,generateTournamentRecord:()=>QJ,modifyTournamentRecord:()=>iQ,mutate:()=>ZJ});var kJ={};ct(kJ,{generateEventWithDraw:()=>zC,generateOutcome:()=>J_,generateOutcomeFromScoreString:()=>H_,generateParticipants:()=>Ev,generateTournamentRecord:()=>QJ});function PCe(t){let e=t.reduce((i,r)=>((r.side1Score!==void 0||r.side2Score!==void 0)&&(i.side1+=r.side1Score??0,i.side2+=r.side2Score??0),i),{side1:0,side2:0});return e.side1>e.side2?1:e.side2>e.side1?2:t.find(i=>i.side1TiebreakScore!==void 0||i.side2TiebreakScore!==void 0)?.winningSide}function ECe(t){let e={side1:0,side2:0};if(t.forEach(i=>{i.winningSide===1?e.side1++:i.winningSide===2&&e.side2++}),e.side1>e.side2)return 1;if(e.side2>e.side1)return 2}function RCe(t,e,i){if(t||!e||!i)return t;let r=zi(e);return pC(r)?PCe(i):ECe(i)}function CCe(t,e,i){let r=CS({scoreString:t,matchUpFormat:e});return{sets:r,scoreStringSide1:Wl({sets:r,matchUpFormat:e,setTBlast:i}),scoreStringSide2:Wl({sets:r,reversed:!0,matchUpFormat:e,setTBlast:i})}}function MCe(t,e,i,r){let n=Wl({sets:t,matchUpFormat:i,setTBlast:r}),a=Wl({sets:t,reversed:!0,matchUpFormat:i,setTBlast:r});if(typeof n!="string")return n;if(typeof a!="string")return a;let s=e===2?a:n,o=e===2?n:a;return{sets:CS({scoreString:s,matchUpFormat:i}),scoreStringSide1:s,scoreStringSide2:o}}function H_(t){let{matchUpFormat:e,matchUpStatus:i,winningSide:r,scoreString:n,setTBlast:a,preserveSideOrder:s=!1}=t;if(!n)return{outcome:{...YR,winningSide:r,matchUpStatus:i}};if(r&&![1,2,void 0].includes(r))return{error:ie,winningSide:r};let o=n&&CS({scoreString:n,matchUpFormat:e}),l=n?.trim().startsWith("["),u=RCe(r,e,o),c=zi(e),d=s||l||pC(c)?CCe(n,e,a):MCe(o,u,e,a);return Ve({outcome:{matchUpStatus:i,winningSide:u,score:d}})}function W_({matchUpScheduleTimes:t,matchUpDependencies:e,allDateMatchUpIds:i,matchUp:r}){let n=(e?.[r.matchUpId]?.matchUpIds||[]).filter(a=>i.includes(a)).filter(a=>!t[a]);return{dependenciesScheduled:!n?.length,remainingDependencies:n}}function LS({individualParticipantProfiles:t,participantId:e}){t[e]||(t[e]={typeChangeTimeAfterRecovery:void 0,timeAfterRecovery:void 0,priorMatchUpType:void 0,potentialRecovery:{},potentialCounted:{},potentialBookings:{},bookings:[],counters:{}})}function NCe({individualParticipantProfiles:t,recoveryValue:e,participantId:i,scheduleTime:r,drawId:n}){t[i].potentialRecovery[n]||(t[i].potentialRecovery[n]=[]),t[i].potentialRecovery[n].push(e),t[i].potentialBookings[n]||(t[i].potentialBookings[n]=[]),t[i].potentialBookings[n].push({timeAfterRecovery:e,scheduleTime:r})}function Ab({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,typeChangeRecoveryMinutes:i,averageMatchUpMinutes:r=0,matchUpNotBeforeTimes:n,matchUpDependencies:a,recoveryMinutes:s=0,scheduleTime:o,matchUp:l}){let u=ci(l?.schedule?.endTime),c=u?Jn(u,Ye(s)):Jn(o,Ye(r)+Ye(s)),d=i&&(u?Jn(ci(u),i):Jn(o,Ye(r)+Ye(i))),p=a?.[l.matchUpId]?.participantIds||[],f=(l.roundPosition&&t[l.matchUpId]||[]).flat();p.forEach(m=>{LS({individualParticipantProfiles:e,participantId:m});let h=e[m].priorMatchUpType!==l.matchUpType&&d||c;f.includes(m)?NCe({individualParticipantProfiles:e,drawId:l.drawId,recoveryValue:h,participantId:m,scheduleTime:o}):(e[m].timeAfterRecovery=h,e[m].bookings.push({scheduleTime:o,timeAfterRecovery:h}))}),pI({matchUpPotentialParticipantIds:t,matchUpNotBeforeTimes:n,timeAfterRecovery:c,matchUp:l})}function OJ({matchUpScheduleTimes:t,matchUpDependencies:e,scheduleTime:i,matchUpId:r,details:n}){let a,s=n.minutesMap?.[r]?.recoveryMinutes,o=(n.minutesMap?.[r]?.averageMinutes||0)+(s||0),l=Jn(i,o),u=e?.[r]?.dependentMatchUpIds||[];if(u.length){let c=u.reduce((d,p)=>{let f=t[p];if(!f)return d;let m={scheduleTime:f,matchUpId:p};return f&&!d.matchUpId||Pt(f)<Pt(d.scheduleTime)?m:d},{});c.scheduleTime&&Pt(l)>Pt(c.scheduleTime)&&(a=c)}return{scheduledDependent:a}}function ACe(t){let{sides:e,matchUpType:i}=t||{};return(e||[]).map(r=>i===$t&&(r?.participant?.individualParticipants||[])||r?.participant&&[r.participant]||[]).flat()}var _S="DO_NOT_SCHEDULE",kCe={DO_NOT_SCHEDULE:_S};function z_({averageMatchUpMinutes:t=90,requestConflicts:e={},potentials:i=!0,personRequests:r,scheduleTime:n,scheduleDate:a,matchUp:s}){let o=ACe(s).map(({person:f})=>f?.personId);if(i){let f=(s?.potentialParticipants||[]).flat().map(({person:m})=>m?.personId);o.push(...f)}let l=o.map(f=>r[f]?.map(m=>({...m,personId:f}))).filter(Boolean).flat().filter(f=>f.requestType===_S&&tu(a,f.date)),u=[],c=s?.matchUpId,d=Xi(ci(n),Qe(a)),p=ci(mF(d,t).toISOString());for(let f of l){let{requestId:m,startTime:h,endTime:g}=f;(n>h&&n<g||p&&p>h&&p<g)&&(u.push({matchUpId:c,request:f,scheduleTime:n}),e[m]?(e[m].scheduleTimes.includes(n)||e[m].scheduleTimes.push(n),e[m].matchUpIds.includes(c)||e[m].matchUpIds.push(c)):e[m]={request:f,scheduleTimes:[n],matchUpIds:[c]})}return{conflicts:u}}function jO({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,matchUp:i,value:r}){let{matchUpType:n}=i,{individualParticipantIds:a}=ER(i),s=(t[i.matchUpId]||[]).filter(o=>!kn(o,a)).flat();[...a,...s].forEach(o=>{if(LS({individualParticipantProfiles:e,participantId:o}),!e[o].potentialCounted[i.drawId]){let l=e[o].counters;l[n]?l[n]+=r:r>0&&(l[n]=r),l[Ls]?l[Ls]+=r:r>0&&(l[Ls]=r),s.includes(o)&&(e[o].potentialCounted[i.drawId]=!0)}})}function OCe({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,dateScheduledMatchUpIds:i,greatestAverageMinutes:r,dateScheduledMatchUps:n,matchUpNotBeforeTimes:a,matchUpScheduleTimes:s,matchUpDependencies:o,clearScheduleDates:l,scheduleDate:u,minutesMap:c,matchUps:d}){let p=[];i||(n=d?.filter(h=>{let g=h.schedule||{},I=h.matchUpStatus==="BYE";return I&&p.push({tournamentId:h.tournamentId,matchUpId:h.matchUpId}),!I&&AS({schedule:g})&&(!u||h.schedule.scheduledDate===u)}),i=n.map(Ir));let f=Array.isArray(l)?l.includes(u):l,m=f?[]:d.filter(({matchUpId:h})=>i.includes(h));for(let h of m){jO({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,value:1,matchUp:h});let g=h.schedule?.scheduledTime;if(g){s[h.matchUpId]=g;let I=c?.[h.matchUpId]?.recoveryMinutes;Ab({individualParticipantProfiles:e,matchUpPotentialParticipantIds:t,matchUpNotBeforeTimes:a,matchUpDependencies:o,averageMatchUpMinutes:r,recoveryMinutes:I,scheduleTime:g,matchUp:h})}}return{dateScheduledMatchUpIds:i,byeScheduledMatchUpDetails:p,dateScheduledMatchUps:n,clearDate:f}}function VC({defaultRecoveryMinutes:t=0,averageMatchUpMinutes:e=90,dateScheduledMatchUps:i,tournamentRecords:r,venueIds:n=[],periodLength:a,scheduleDate:s,matchUps:o}){if(typeof r!="object")return{error:Ci};if(!Ga(o)&&!Array.isArray(i))return{error:Tu};a=a??OC({recoveryMinutes:t,averageMatchUpMinutes:e});let l=Object.assign({},...Object.values(r).flatMap(d=>(d.events??[]).map(p=>{let{scheduleTiming:f}=Xw({tournamentRecord:d,event:p});return{[p.eventId]:{event:p,scheduleTiming:f}}}))),u={averageTimes:[{minutes:{default:e}}],recoveryTimes:[{minutes:{default:t}}]};i??=o?.filter(d=>{let p=d.schedule;return AS({schedule:p})&&(!s||d.schedule.scheduledDate===s)});let c=i?.filter(d=>(!n.length||n.includes(d.schedule.venueId))&&d.matchUpStatus!=="BYE");return{bookings:c?.map(({eventId:d,schedule:p,matchUpFormat:f})=>{let{event:m,scheduleTiming:h}=l[d],g=m?.eventType,I={...h,defaultTiming:u,matchUpFormat:f},{averageMinutes:v,recoveryMinutes:w}=kR({timingDetails:I,eventType:g}),{courtId:y,venueId:b}=p,S=ci(p.scheduledTime),U=Jn(S,v);return{recoveryMinutes:w,averageMinutes:v,periodLength:a,startTime:S,courtId:y,endTime:U,venueId:b}}).filter(Boolean),relevantMatchUps:c,dateScheduledMatchUps:i}}function xCe({calculateStartTimeFromCourts:t=!0,remainingScheduleTimes:e,defaultRecoveryMinutes:i,averageMatchUpMinutes:r,clearScheduleDates:n,tournamentRecords:a,tournamentRecord:s,periodLength:o,scheduleDate:l,startTime:u,venueIds:c,matchUps:d,endTime:p}){if(s&&!a&&(a={[s.tournamentId]:s}),typeof a!="object"||!Object.keys(a).length)return{error:Ci};o=o??OC({recoveryMinutes:i,averageMatchUpMinutes:r});let{courts:f,venues:m}=Cu({dates:[l],ignoreDisabled:!0,tournamentRecords:a}),h=f?.filter(b=>!c||c.includes(b.venueId))??[];u=u??fI({courts:h,scheduleDate:l,startTime:!0}),p=p??fI({courts:h,scheduleDate:l,endTime:!0});let{bookings:g,dateScheduledMatchUps:I}=VC({defaultRecoveryMinutes:i,averageMatchUpMinutes:r,tournamentRecords:a,scheduleDate:l,periodLength:o,venueIds:c,matchUps:d}),v={calculateStartTimeFromCourts:t,remainingScheduleTimes:e,averageMatchUpMinutes:r,clearScheduleDates:n,date:l,periodLength:o,startTime:u,bookings:g,endTime:p,courts:h},{scheduleTimes:w}=R_(v),y=c?.length===1&&c[0]||m?.length===1&&m[0].venueId||void 0;return{dateScheduledMatchUpIds:I?.map(ba("matchUpId")),dateScheduledMatchUps:I,scheduleTimes:w,venueId:y}}function FCe({scheduledRoundsDetails:t,greatestAverageMinutes:e,garmanSinglePass:i}){let r=[],n=[],a,s,o,l;for(let u of t.filter(Boolean))l||(l=u.hash),(u.hash===l||i)&&(n=n.concat(u.matchUpIds)),u.hash,o=e,s=u.recoveryMinutes,a=u.roundPeriodLength;return n.length&&r.push({matchUpIds:n,roundPeriodLength:a,recoveryMinutes:s,averageMinutes:o}),{groupedRounds:r}}function xJ({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,scheduleCompletedMatchUps:i,containedStructureIds:r,matchUpNotBeforeTimes:n,matchUpScheduleTimes:a,matchUpDependencies:s,clearScheduleDates:o,tournamentRecords:l,periodLength:u,scheduleDate:c,useGarman:d,matchUps:p,courts:f,venues:m}){let h={},g=[],I=[],v=[];for(let w of m){let{rounds:y=[],venueId:b}=w,{scheduledRoundsDetails:S,greatestAverageMinutes:U,orderedMatchUpIds:T,minutesMap:P}=MS({scheduleCompletedMatchUps:i,containedStructureIds:r,tournamentRecords:l,periodLength:u,matchUps:p,rounds:y});v.push(...T??[]);let{groupedRounds:D}=FCe({scheduledRoundsDetails:S,greatestAverageMinutes:U,garmanSinglePass:!0}),E,R=[];d&&({scheduleTimes:R,dateScheduledMatchUpIds:E}=xCe({averageMatchUpMinutes:D[0]?.averageMinutes,scheduleDate:Qe(c),venueIds:[w.venueId],clearScheduleDates:o,tournamentRecords:l,periodLength:u,matchUps:p}));let C=OCe({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,dateScheduledMatchUpIds:E,greatestAverageMinutes:U,matchUpNotBeforeTimes:n,matchUpScheduleTimes:a,matchUpDependencies:s,clearScheduleDates:o,scheduleDate:c,minutesMap:P,matchUps:p});({dateScheduledMatchUpIds:E}=C);let M=C,{byeScheduledMatchUpDetails:N,clearDate:A}=C;N?.length&&I.push(...N);let{matchUpsToSchedule:O,matchUpMap:k}=yC({matchUpPotentialParticipantIds:t,scheduleCompletedMatchUps:i,dateScheduledMatchUpIds:E,matchUpNotBeforeTimes:n,matchUpScheduleTimes:a,orderedMatchUpIds:T,clearDate:A,matchUps:p}),F=f.filter(x=>x.venueId===b);h[b]={previousRemainingScheduleTimes:[],courtsCount:F.length,greatestAverageMinutes:U,scheduledRoundsDetails:S,dateScheduledMatchUps:M,matchUpsToSchedule:O,scheduleTimes:R,groupedRounds:D,venueCourts:F,minutesMap:P,matchUpMap:k},o||g.push(...E)}return{allDateScheduledByeMatchUpDetails:I,allDateScheduledMatchUpIds:g,venueScheduledRoundDetails:h,allDateMatchUpIds:v}}function LCe(t,e){let i=Pt(t.scheduleTime),r=Pt(t.timeAfterRecovery),n=Pt(e.scheduleTime),a=Pt(e.timeAfterRecovery),s=i===n||r===a,o=i>n&&i<a,l=n>i&&n<r,u=r>n&&r<a,c=a>i&&a<r;return Ve({hasOverlap:s||o||u||l||c,startAisContained:o,endAisContained:u,startBisContained:l,endBisContained:c},!0)}function q_({individualParticipantProfiles:t,matchUpNotBeforeTimes:e,matchUpDependencies:i,scheduleTime:r,matchUp:n,details:a}){let s=(i?.[n.matchUpId]?.participantIds||[]).flat(),o=a?.minutesMap?.[n.matchUpId]?.averageMinutes||0,l=a?.minutesMap?.[n.matchUpId]?.recoveryMinutes||0,u=s.every(p=>{LS({individualParticipantProfiles:t,participantId:p});let f=t[p];if(!f.timeAfterRecovery)return!0;let m=ci(n?.schedule?.endTime),h=m?Jn(m,Ye(l)):Jn(r,Ye(o)+Ye(l));return![...Object.keys(f.potentialBookings).filter(g=>g!==n.drawId).map(g=>f.potentialBookings[g]).flat(),...f.bookings].find(g=>LCe({scheduleTime:r,timeAfterRecovery:h},g).hasOverlap)}),c=e[n.matchUpId],d=(c?xw(Xi(c),Xi(r),!1):0)>=0;return{enoughTime:u&&d}}function FJ({autoSchedulingAudit:t,tournamentRecords:e}){at({topic:Qu,payload:t});let i=s=>s?Object.values(s).reduce((o,l)=>o+l.length||0,0):0,r=(t?.schedulingProfile||[]).reduce((s,o)=>s+o.venues.reduce((l,u)=>l+u.rounds.length,0),0),n={scheduledDatesCount:t.scheduledDates?.length,noTimeMatchUpIdsCount:i(t?.noTimeMatchUpIds),scheduledMatchUpIdsCount:i(t?.scheduledMatchUpIds),overLimitMatchUpIdsCount:i(t?.overLimitMatchUpIds),requestConflictsCount:i(t?.requestConflicts),profileRoundsCount:r},a={itemType:$O,itemValue:n};for(let s of Object.values(e)){let o=s.tournamentId;eR(Qu)?at({payload:{type:$O,tournamentId:o,detail:n},topic:Qu}):US({tournamentRecord:s,timeItem:a})}}function Y_({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,matchUpDailyLimits:i={},matchUp:r}){let{enteredIndividualParticipantIds:n}=ER(r),{matchUpId:a,matchUpType:s}=r,o=(r.roundPosition&&t[a]||[]).flat(),l=rt(n.concat(...o));return l.forEach(u=>{LS({individualParticipantProfiles:e,participantId:u})}),{participantIdsAtLimit:l.filter(u=>{let c=e[u];if(c)return[s,Ls].find(d=>{let p=c.counters?.[d]||0,f=i[d]||0;return p&&f&&p>=f})}),relevantParticipantIds:l}}function kb({scheduleCompletedMatchUps:t=!1,scheduleByeMatchUps:e=!1,errorOnAnachronism:i=!1,checkChronology:r=!0,matchUpDependencies:n,removePriorValues:a,tournamentRecords:s,tournamentRecord:o,matchUpDetails:l,matchUpIds:u,schedule:c}){if(!o)return{error:Ie};if(!l&&(!u||!Array.isArray(u)))return{error:th};if(!l&&(!c||typeof c!="object"))return{error:m4};let d,p=[],f=0;if(r&&!n){let g=oo({tournamentRecords:s,tournamentRecord:o});n=g.matchUpDependencies,d=g.matchUps}d||(d=br({tournamentRecord:o})?.matchUps??[]);let m=d.reduce((g,I)=>{let{matchUpId:v,drawId:w,matchUpStatus:y}=I;return(e||y!=="BYE")&&(t||!Yi.includes(y))&&(g[w]?g[w].push(v):g[w]=[v]),g},{}),h=l?.map(g=>g.matchUpId);for(let g of Object.keys(m)){let{drawDefinition:I}=Gd({tournamentRecord:o,drawId:g});if(!I)continue;let v=m[g].filter(y=>u?.includes(y)??h?.includes(y)),w=Rn({inContext:!1,drawDefinition:I}).matchUps;for(let y of v){let b=l?.find(U=>U.matchUpId===y)?.schedule||c,S=BC({schedule:b,matchUpDependencies:n,errorOnAnachronism:i,removePriorValues:a,inContextMatchUps:d,tournamentRecords:s,tournamentRecord:o,checkChronology:r,drawDefinition:I,drawMatchUps:w,matchUpId:y});if(S?.warnings?.length&&p.push(...S.warnings),S?.success&&(f+=1),S.error)return S}}return p.length?{...H,scheduled:f,warnings:p}:{...H,scheduled:f}}function $S(t){let{scheduleCompletedMatchUps:e=!1,scheduleByeMatchUps:i=!1,errorOnAnachronism:r,matchUpContextIds:n,removePriorValues:a,tournamentRecords:s,checkChronology:o,matchUpDetails:l,schedule:u}=t;if(t.matchUpIds&&!n)return kb(t);let c=Ge(t,[{[cn]:!0},{[rI]:{matchUpContextIds:!1,matchUpDetails:!1},[Fa]:ie,[zn]:an}]);if(c.error)return c;if((!l||n)&&!u)return{error:Xe,info:"schedule is required"};let d=[],p=0,{matchUpDependencies:f}=oo({tournamentRecords:s});for(let m of Object.values(s)){let{tournamentId:h}=m,g=n?.filter(v=>v.tournamentId===h).map(Ir),I=l?.filter(v=>v?.tournamentId===h);if(g?.length||I?.length){let v=kb({matchUpDetails:I,scheduleCompletedMatchUps:e,scheduleByeMatchUps:i,matchUpDependencies:f,errorOnAnachronism:r,removePriorValues:a,tournamentRecords:s,tournamentRecord:m,checkChronology:o,matchUpIds:g,schedule:u});if(v.warnings?.length&&d.push(...v.warnings),v.scheduled&&(p+=v.scheduled),v.error)return v}}return d.length?{...H,scheduled:p,warnings:d}:{...H,scheduled:p}}function _Ce({schedulingProfileModifications:t,checkPotentialRequestConflicts:e,scheduleCompletedMatchUps:i,schedulingProfileIssues:r,dateSchedulingProfiles:n,containedStructureIds:a,matchUpDependencies:s,matchUpDailyLimits:o,clearScheduleDates:l,tournamentRecords:u,schedulingProfile:c,personRequests:d,periodLength:p,matchUps:f,courts:m,dryRun:h}){let g={},I={},v={},w={},y={},b={},S={},U={},T={},P={};for(let R of n){let C=Qe(R?.scheduleDate),M=R?.venues||[],N={},A={},O=(G,j)=>{G.forEach(K=>{let Y=A[K].counters;Y[j]?Y[j]+=1:Y[j]=1,Y[Ls]?Y[Ls]+=1:Y[Ls]=1})};v[C]={},w[C]={},g[C]={},I[C]={},S[C]=[],U[C]=[],T[C]=[],P[C]=[];let k={};f.forEach(G=>{G.schedule?.scheduledDate&&tu(C,Qe(G.schedule.scheduledDate))&&pI({matchUpPotentialParticipantIds:N,matchUpNotBeforeTimes:k,matchUp:G})});let{allDateScheduledByeMatchUpDetails:F,venueScheduledRoundDetails:x,allDateMatchUpIds:L}=xJ({matchUpPotentialParticipantIds:N,individualParticipantProfiles:A,scheduleCompletedMatchUps:i,containedStructureIds:a,matchUpNotBeforeTimes:k,matchUpScheduleTimes:b,matchUpDependencies:s,clearScheduleDates:l,tournamentRecords:u,useGarman:!0,periodLength:p,scheduleDate:C,matchUps:f,courts:m,venues:M}),$=10,V=0,_,B=10;for(;!_;){for(let{venueId:G}of M){let j=0,K=x[G];for(;K.courtsCount&&K.scheduleTimes?.length&&K.matchUpsToSchedule?.length&&j<=K.courtsCount;){let{scheduleTime:Y,attempts:X=0}=K.scheduleTimes.shift(),Z=K.matchUpsToSchedule.find(J=>{let{matchUpId:ae,matchUpType:te}=J,{participantIdsAtLimit:ne,relevantParticipantIds:le}=Y_({matchUpPotentialParticipantIds:N,individualParticipantProfiles:A,matchUpDailyLimits:o,matchUp:J});if(ne.length)return U[C].includes(ae)||U[C].push(ae),!1;let{scheduledDependent:de}=OJ({matchUpScheduleTimes:b,matchUpDependencies:s,scheduleTime:Y,matchUpId:ae,details:K});if(de)return!1;let{dependenciesScheduled:pe,remainingDependencies:ge}=W_({matchUpScheduleTimes:b,matchUpDependencies:s,allDateMatchUpIds:L,matchUp:J});if(!pe)return w[C][ae]||(w[C][ae]=[]),w[C][ae].push({scheduleTime:Y,remainingDependencies:ge}),!1;let{enoughTime:Me}=q_({individualParticipantProfiles:A,matchUpNotBeforeTimes:k,matchUpDependencies:s,scheduleTime:Y,details:K,matchUp:J});if(!Me)return v[C][ae]||(v[C][ae]=[]),v[C][ae].push({scheduleTime:Y}),!1;let Pe=K.greatestAverageMinutes,{conflicts:Be}=z_({potentials:e,averageMatchUpMinutes:Pe,requestConflicts:P,personRequests:d,scheduleTime:Y,scheduleDate:C,matchUp:J});if(Be?.length)return y[C]||(y[C]=[]),y[C].push(...Be),!1;O(le,te);let fe=K.minutesMap?.[ae]?.recoveryMinutes;return Ab({matchUpPotentialParticipantIds:N,individualParticipantProfiles:A,matchUpNotBeforeTimes:k,averageMatchUpMinutes:Pe,matchUpDependencies:s,recoveryMinutes:fe,scheduleTime:Y,matchUp:J}),b[ae]=Y,!0});K.matchUpsToSchedule=K.matchUpsToSchedule.filter(({matchUpId:J})=>J!==Z?.matchUpId),Z?j+=1:(I[C][G]||(I[C][G]=[]),I[C][G].push({scheduleTime:Y,attempts:X+1}))}K.matchUpsToSchedule?.length&&(I[C][G]=I[C][G]?.filter(Y=>{let X=Y.attempts<$;return X&&K.scheduleTimes.push(Y),!X})),(!K.scheduleTimes?.length||!K.matchUpsToSchedule?.length)&&(K.complete=!0)}V+=1,_=M.every(({venueId:G})=>x[G].complete)||V===B}for(let{venueId:G}of M){let j=x[G].matchUpMap;Object.keys(j).forEach(K=>{let Y=u[K];Y&&Object.keys(j[K]).forEach(X=>{let{drawDefinition:Z}=Gd({tournamentRecord:Y,drawId:X});Z&&j[K][X].forEach(({matchUpId:J})=>{let ae=b[J];if(ae){let te=ae.split(":").map(rs).join(":"),ne=`${Qe(C)}T${te}`;h?S[C].push(J):(Hd({drawDefinition:Z,scheduledTime:ne,matchUpId:J}).success&&S[C].push(J),G&&Pv({tournamentRecord:Y,drawDefinition:Z,matchUpId:J,venueId:G}))}})})}),T[C]=x[G].matchUpsToSchedule.map(Ir),g[C][G]=x[G].scheduleTimes.sort((K,Y)=>Pt(K.scheduleTime)-Pt(Y.scheduleTime))}!h&&F?.length&&$S({matchUpDetails:F,scheduleByeMatchUps:!0,removePriorValues:!0,tournamentRecords:u,schedule:{scheduledDate:"",scheduledTime:"",courtOrder:"",courtId:"",venueId:""}});for(let G of R.venues)for(let j of G.rounds){let K=(j.matchUps?.map(({matchUpId:X})=>X)||[]).filter(X=>S[C].includes(X));j.canScheduledMatchUpIds=K;let Y=Math.round(K.length/j.matchUpsCount*1e4)/100;(Y===1/0||isNaN(Y))&&(Y=0),j.possibleToSchedulePct=Y,j.matchUpsCount===K.length&&(j.possibleToSchedule=!0)}}let D=n.map(({scheduleDate:R})=>R),E={timeStamp:Date.now(),overLimitMatchUpIds:U,scheduledMatchUpIds:S,schedulingProfile:c,noTimeMatchUpIds:T,requestConflicts:P,scheduledDates:D};return FJ({tournamentRecords:u,autoSchedulingAudit:E}),{...H,schedulingProfileModifications:t,schedulingProfileIssues:r,scheduleTimesRemaining:g,dateSchedulingProfiles:n,skippedScheduleTimes:I,recoveryTimeDeferredMatchUpIds:v,dependencyDeferredMatchUpIds:w,matchUpScheduleTimes:b,overLimitMatchUpIds:U,scheduledMatchUpIds:S,noTimeMatchUpIds:T,requestConflicts:P,scheduledDates:D}}function kW({averageMinutes:t,startTime:e,endTime:i,court:r,date:n}){if(!Array.isArray(r.dateAvailability))return{error:Xe,stack:"getEarliestCourtTime"};let a=fI({scheduleDate:n,courts:[r],startTime:!0}),s=fI({scheduleDate:n,courts:[r],endTime:!0});e=e||a,i=i||s;let o=bd({court:r,date:n}),{timeSlots:l}=Tv({courtDate:o}),u=Xi(e),c=Xi(i);return{earliestCourtTime:l?.reduce((d,p)=>{let f=Xi(p.startTime),m=Xi(p.endTime);if(f>c||m<u)return d;let h=u>f?u:f;if(xw(h,m)>=t){let g=ci(h.toISOString());g&&(!d||g<d)&&(d=g)}return d},void 0),courtStartTime:a,courtEndTime:s}}function $Ce({schedulingProfileModifications:t,checkPotentialRequestConflicts:e,scheduleCompletedMatchUps:i,schedulingProfileIssues:r,dateSchedulingProfiles:n,containedStructureIds:a,matchUpDependencies:s,matchUpDailyLimits:o,clearScheduleDates:l,tournamentRecords:u,periodLength:c=30,schedulingProfile:d,personRequests:p,matchUps:f=[],courts:m,dryRun:h}){let g={},I={},v={},w={},y={},b={},S={},U={},T={};for(let E of n??[]){let R=Qe(E?.scheduleDate),C=E?.venues||[],M={},N={},A=(Z,J)=>{Z.forEach(ae=>{let te=N[ae].counters;te[J]?te[J]+=1:te[J]=1,te[Ls]?te[Ls]+=1:te[Ls]=1})};g[R]={},I[R]={},b[R]=[],S[R]=[],U[R]=[],T[R]=[];let O={};f?.forEach(Z=>{Z.schedule?.scheduledDate&&tu(R,Qe(Z.schedule.scheduledDate))&&pI({matchUpPotentialParticipantIds:M,matchUpNotBeforeTimes:O,matchUp:Z})});let{allDateScheduledByeMatchUpDetails:k,allDateScheduledMatchUpIds:F,venueScheduledRoundDetails:x,allDateMatchUpIds:L}=xJ({matchUpPotentialParticipantIds:M,individualParticipantProfiles:N,scheduleCompletedMatchUps:i,containedStructureIds:a,matchUpNotBeforeTimes:O,matchUpScheduleTimes:y,matchUpDependencies:s,clearScheduleDates:l,tournamentRecords:u,periodLength:c,scheduleDate:R,matchUps:f,courts:m,venues:C}),$=f?.filter(({matchUpId:Z})=>F.includes(Z)),{bookings:V}=VC({dateScheduledMatchUps:$,tournamentRecords:u,scheduleDate:R,periodLength:c}),{virtualCourts:_}=kC({scheduleDate:R,periodLength:c,bookings:V,courts:m}),B=_?.reduce((Z,J)=>{let{earliestCourtTime:ae,courtEndTime:te}=kW({date:R,averageMinutes:0,court:J});return(!Z.startTime||Xi(ae)<Xi(Z.startTime))&&(Z.startTime=ae),(!Z.endTime||Xi(te)>Xi(Z.endTime))&&(Z.endTime=te),Z},{}),G=B.startTime,j=({courtId:Z,booking:J})=>_?.find(ae=>ae.courtId===Z)?.dateAvailability[0].bookings.push(J),K=10,Y=0,X;for(;!X;){for(let{venueId:Z}of C){let J=x[Z],ae=J.matchUpsToSchedule.length,te=[],ne=[],le,de=0;for(;!le;){for(let pe of J.matchUpsToSchedule){if(ne.length===J.courtsCount||te.length===J.courtsCount){le=!0;break}let{matchUpId:ge,matchUpType:Me}=pe,{participantIdsAtLimit:Pe,relevantParticipantIds:Be}=Y_({matchUpPotentialParticipantIds:M,individualParticipantProfiles:N,matchUpDailyLimits:o,matchUp:pe});if(Pe.length){S[R].includes(ge)||S[R].push(ge);continue}let{dependenciesScheduled:fe,remainingDependencies:Te}=W_({matchUpScheduleTimes:y,matchUpDependencies:s,allDateMatchUpIds:L,matchUp:pe});if(!fe){I[R][ge]||(I[R][ge]=[]),I[R][ge].push({remainingDependencies:Te});continue}let ce=[],ye=_?.reduce((be,Fe)=>{if(ne.includes(Fe.courtId))return be;let{earliestCourtTime:we}=kW({averageMinutes:J.greatestAverageMinutes,startTime:G,date:R,court:Fe});if(be.scheduleTime&&Pt(we)>=Pt(be.scheduleTime))return be;let{scheduledDependent:Ne}=OJ({matchUpScheduleTimes:y,matchUpDependencies:s,scheduleTime:we,matchUpId:ge,details:J});if(Ne)return be;let{enoughTime:me}=q_({individualParticipantProfiles:N,matchUpNotBeforeTimes:O,matchUpDependencies:s,scheduleTime:we,details:J,matchUp:pe});if(!me)return g[R][ge]||(g[R][ge]=[]),g[R][ge].includes(we)||g[R][ge].push(we),be;let Ee=J.minutesMap?.[ge]?.averageMinutes||J.greatestAverageMinutes,{conflicts:Le}=z_({potentials:e,averageMatchUpMinutes:Ee,requestConflicts:T,personRequests:p,scheduleTime:we,scheduleDate:R,matchUp:pe});if(Le?.length)return ce.push(...Le),!1;A(Be,Me);let Q=J.minutesMap?.[ge]?.recoveryMinutes;return Ab({matchUpPotentialParticipantIds:M,individualParticipantProfiles:N,matchUpNotBeforeTimes:O,averageMatchUpMinutes:Ee,matchUpDependencies:s,recoveryMinutes:Q,scheduleTime:we,matchUp:pe}),(!be.scheduleTime||Pt(we)<Pt(be.scheduleTime))&&(be.averageMatchUpMinutes=Ee,be.recoveryMinutes=Q,be.scheduleTime=we,be.courtName=Fe.courtName,be.courtId=Fe.courtId),be},{});if(ye.scheduleTime){let{averageMatchUpMinutes:be,recoveryMinutes:Fe,scheduleTime:we,courtId:Ne}=ye;y[ge]=we,w[ge]=Ne,te.push(ge),ne.push(Ne);let me=we,Ee=Jn(me,be);j({courtId:Ne,booking:{averageMatchUpMinutes:be,recoveryMinutes:Fe,periodLength:c,matchUpId:ge,startTime:me,courtId:Ne,endTime:Ee,venueId:Z}}),J.matchUpsToSchedule=J.matchUpsToSchedule.filter(Le=>Le.matchUpId!==ge)}else ce?.length&&(v[R]||(v[R]=[]),v[R].push(...ce))}(ne.length===J.courtsCount||te.length===J.courtsCount||!J.matchUpsToSchedule.length)&&(le=!0),J.matchUpsToSchedule.length&&te<J.courtsCount&&(Xi(G)<Xi(B.endTime)?G=Jn(G,c):(le=!0,J.complete=!0)),de+=1,!le&&de>=ae&&(le=!0)}J.matchUpsToSchedule?.length||(J.complete=!0)}Y+=1,X=C.every(({venueId:Z})=>x[Z].complete)||Y===K}for(let{venueId:Z}of C){let J=x[Z].matchUpMap;Object.keys(J).forEach(ae=>{let te=u[ae];te&&Object.keys(J[ae]).forEach(ne=>{let{drawDefinition:le}=Gd({tournamentRecord:te,drawId:ne});le&&J[ae][ne].forEach(({matchUpId:de})=>{let pe=y[de],ge=w[de];if(pe){let Me=pe.split(":").map(rs).join(":"),Pe=`${Qe(R)}T${Me}`;h||(Hd({drawDefinition:le,scheduledTime:Pe,matchUpId:de}),Eh({courtDayDate:R,tournamentRecords:u,tournamentRecord:te,drawDefinition:le,matchUpId:de,courtId:ge})),b[R].push(de)}})})}),U[R]=x[Z].matchUpsToSchedule.map(Ir)}!h&&k?.length&&$S({matchUpDetails:k,scheduleByeMatchUps:!0,removePriorValues:!0,tournamentRecords:u,schedule:{scheduledDate:"",scheduledTime:"",courtOrder:"",courtId:"",venueId:""}});for(let Z of E.venues)for(let J of Z.rounds){let ae=(J.matchUps??[]).map(({matchUpId:ne})=>ne)?.filter(ne=>b[R].includes(ne));J.canScheduledMatchUpIds=ae;let te=Math.round((ae?.length||0)/J.matchUpsCount*1e4)/100;(te===1/0||isNaN(te))&&(te=void 0),J.possibleToSchedulePct=te,J.matchUpsCount===ae?.length&&(J.possibleToSchedule=!0)}}let P=(n??[]).map(({scheduleDate:E})=>E),D={timeStamp:Date.now(),overLimitMatchUpIds:S,scheduledMatchUpIds:b,schedulingProfile:d,noTimeMatchUpIds:U,requestConflicts:T,scheduledDates:P};return FJ({tournamentRecords:u,autoSchedulingAudit:D}),{...H,schedulingProfileModifications:t,schedulingProfileIssues:r,dateSchedulingProfiles:n,recoveryTimeDeferredMatchUpIds:g,dependencyDeferredMatchUpIds:I,matchUpScheduleTimes:y,overLimitMatchUpIds:S,scheduledMatchUpIds:b,noTimeMatchUpIds:U,requestConflicts:T,scheduledDates:P}}function jC(t){let{scheduleAttributes:e=["scheduledDate","scheduledTime","courtOrder"],ignoreMatchUpStatuses:i=Yi,scheduledDates:r,venueIds:n}=t,a=Is(t),s=bt(a)?Object.values(a).map(({tournamentId:l})=>l).filter(Boolean):[];if(!s?.length)return{error:Ci};let o=0;for(let l of s){let u=a[l],c=BCe({ignoreMatchUpStatuses:i,scheduleAttributes:e,tournamentRecord:u,scheduledDates:r,venueIds:n});if(c.error)return c;o+=c.clearedScheduleCount??0}return{...H,clearedScheduleCount:o}}function BCe({scheduleAttributes:t=["scheduledDate","scheduledTime","courtOrder"],ignoreMatchUpStatuses:e=Yi,tournamentRecord:i,scheduledDates:r,venueIds:n=[]}){if(typeof i!="object")return{error:Ie};if(!Array.isArray(e)||!Array.isArray(n))return{error:ie};n.length&&t.push("venueId");let a=br({matchUpFilters:{scheduledDates:r},tournamentRecord:i}).matchUps??[],s={};a.forEach(({matchUpStatus:u,schedule:c,drawId:d,matchUpId:p})=>{(!u||!e.includes(u))&&AS({schedule:c,scheduleAttributes:t})&&(!n?.length||n.includes(c.venueId))&&(s[d]||(s[d]=[]),s[d].push(p))});let o=i.tournamentId,l=0;for(let u in s){let{event:c,drawDefinition:d}=jn({tournamentRecord:i,drawId:u}),p=Rn({drawDefinition:d,matchUpFilters:{matchUpIds:s[u]}}).matchUps??[];for(let f of p){let m=!1;f.timeItems=(f.timeItems??[]).filter(h=>{let g=h?.itemType&&![lu,Id,ph,NR,fh,mh].includes(h?.itemType);return g||(m=!0),g}),m&&(St({context:"clear schedules",eventId:c?.eventId,drawDefinition:d,tournamentId:o,matchUp:f}),l+=1)}}return{...H,clearedScheduleCount:l}}function GC(t){let{checkPotentialRequestConflicts:e=!0,scheduleCompletedMatchUps:i,clearScheduleDates:r,scheduleDates:n=[],tournamentRecords:a,periodLength:s,useGarman:o,dryRun:l,pro:u}=t,c=Ge(t,[{[cn]:!0},{[Wr]:P=>!P||Array.isArray(P)&&P.every(Pn),[$5]:!1,[zn]:an}]);if(c.error)return c;let d=$c({tournamentRecords:a});if(d.error)return d;if(!d.schedulingProfile.length)return{...H};let{modifications:p,issues:f=[],schedulingProfile:m=[]}=d,h=Object.assign({},...Object.values(a).map(P=>lv({tournamentRecord:P}).containedStructures)),g=new Set(n.map(P=>{if(Pn(P))return Qe(P)}).filter(Boolean)),I=m.map(P=>P.scheduleDate).map(P=>Pn(P)&&Qe(P)).filter(P=>P&&(!n.length||g.has(P)));if(!I.length)return{error:j6};if(r&&!l){let P=Array.isArray(r)?r:[];jC({tournamentRecords:a,scheduledDates:P})}let v=Cu({ignoreDisabled:!1,tournamentRecords:a}).courts,{matchUps:w}=Eo({matchUpFilters:{matchUpTypes:[Wt,$t]},afterRecoveryTimes:!0,nextMatchUps:!0,tournamentRecords:a}),{matchUpDependencies:y}=oo({includeParticipantDependencies:!0,tournamentRecords:a,matchUps:w}),{matchUpDailyLimits:b}=RC({tournamentRecords:a}),{personRequests:S}=pf({requestType:_S,tournamentRecords:a}),U=m.filter(P=>{let D=Qe(P?.scheduleDate);return I.includes(D)}).sort((P,D)=>new Date(P.scheduleDate).getTime()-new Date(D.scheduleDate).getTime()),T={schedulingProfileModifications:p,checkPotentialRequestConflicts:e,scheduleCompletedMatchUps:i,schedulingProfileIssues:f,dateSchedulingProfiles:U,containedStructureIds:h,matchUpDependencies:y,matchUpDailyLimits:b,clearScheduleDates:r,tournamentRecords:a,schedulingProfile:m,personRequests:S,periodLength:s,matchUps:w,dryRun:l,courts:v};return u?$Ce(T):_Ce(T)}function HC(t){if(!t||typeof t!="string")return!1;try{return Intl.DateTimeFormat(void 0,{timeZone:t}),!0}catch{return!1}}function GO(t,e){let i=e??new Date,r=new Intl.DateTimeFormat("en-US",{timeZone:t,timeZoneName:"longOffset"}).formatToParts(i).find(l=>l.type==="timeZoneName")?.value??"";if(r==="GMT")return 0;let n=r.match(/GMT([+-])(\d{2}):(\d{2})/);if(!n)return 0;let a=n[1]==="+"?1:-1,s=Number.parseInt(n[2],10),o=Number.parseInt(n[3],10);return a*(s*60+o)}function LJ(t,e,i){if(!HC(i))return{error:HE};let[r,n]=e.split(":").map(Number),[a,s,o]=t.split("-").map(Number),l=new Date(Date.UTC(a,s-1,o,r,n,0,0)),u=GO(i,l),c=l.getTime()-u*60*1e3,d=new Date(c),p=GO(i,d);if(p!==u){let f=l.getTime()-p*60*1e3;return new Date(f).toISOString()}return d.toISOString()}function VCe(t,e){if(!HC(e))return{error:HE};let i=new Date(t),r=new Intl.DateTimeFormat("en-CA",{timeZone:e,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!1}).formatToParts(i),n=o=>r.find(l=>l.type===o)?.value??"",a=`${n("year")}-${n("month")}-${n("day")}`,s=`${n("hour")==="24"?"00":n("hour")}:${n("minute")}`;return{date:a,time:s}}function jCe(t,e,i){let r=LJ(t,e,i);return typeof r!="string"||id(r)?r:{error:HE}}var GCe={isValidIANATimeZone:HC,getTimeZoneOffsetMinutes:GO,wallClockToUTC:LJ,utcToWallClock:VCe,toEmbargoUTC:jCe};function WC(t){let{tournamentRecord:e,tournamentRecords:i,activeTournamentId:r,...n}=t||{};return n.tournamentId||(n.tournamentId=Et()),n.startDate&&!sc(n.startDate)&&!BD.test(n.startDate)?{error:sr}:n.endDate&&!sc(n.endDate)&&!BD.test(n.endDate)?{error:sr}:n.localTimeZone&&!HC(n.localTimeZone)?{error:HE}:(n.extensions&&(n.extensions=n.extensions.filter(sl)),{...n})}function K_({addParticipants:t=!0,participantAttribute:e,tournamentRecord:i,personAttribute:r,teamNames:n,accessor:a,uuids:s}){if(!i)return{error:Ie};let o={},l=(i.participants??[]).filter(({participantType:m,participantRole:h})=>m===gt&&h===Kr),u=0;for(let m of l){let h=a&&hp({element:m,accessor:a})?.value||r&&m.person?.[r]||e&&m[e];if(h){if(!Object.keys(o).includes(h)){o[h]={participantName:n?.[u]??h,participantId:s?.pop()??Et(),individualParticipantIds:[],participantRole:Kr,participantType:Lt};let g={value:r??e,name:uO};xt({element:o[h],extension:g}),u+=1}o[h].individualParticipantIds.push(m.participantId)}}let c=Object.keys(o),d=(i.participants??[]).map(m=>{if(m.participantType!==Lt||m.participantRole!==Kr)return;let{extension:h}=mt({name:uO,element:m}),g=h?.value;if(c.includes(g))return m.participantId}).filter(Boolean),p=0,f=[];return Object.keys(o).forEach(m=>{let h=o[m],{participantId:g}=h;d.includes(g)||(i.participants||(i.participants=[]),t&&i.participants.push(h),f.push(h),p++)}),t&&p?(at({payload:{tournamentId:i.tournamentId,participants:f},topic:md}),{...H,participantsAdded:p}):f.length?{...H,newParticipants:f}:{error:MIe}}var HCe=[{AA:"Annexia"},{BA:"Bacteria"},{BO:"Borduria"},{BM:"Bensalem"},{BS:"Basenji"},{BI:"Balnibarbi"},{BV:"Bartovia"},{BZ:"Berzerkistan"},{CA:"Caldonia"},{CC:"Concordia"},{CH:"Chula"},{DA:"Deltora"},{DW:"Discworld"},{EA:"Eastasia"},{EP:"Ecotopia"},{ER:"Erewhon"},{FA:"Freedonia"},{FN:"Florin"},{FG:"Fogg"},{FK:"Fourecks"},{GA:"Genovia"},{GL:"Gilead"},{GD:"Gilead"},{GL:"Gondal"},{GO:"Gondor"},{GR:"Gruzinia"},{GT:"Goritania"},{GU:"Guilder"},{HA:"Heldscalla"},{HO:"Hidalgo"},{IL:"Illyria"},{KA:"Kinakuta"},{KG:"Kangan"},{KN:"Kreplachistan"},{KS:"Kallipolis"},{LH:"Lugash"},{LI:"Listenbourg"},{LT:"Lilliput"},{LU:"Luggnagg"},{LV:"Lichtenslava"},{MR:"Moher"},{NA:"Narnia"},{NV:"Novaria"},{OA:"Oceania"},{OS:"Orsinia"},{OV:"Octavia"},{PA:"Palombia"},{PG:"Penguina"},{QA:"Qasha"},{PM:"Panem"},{SA:"Solymbria"},{SD:"Syldavia"},{SG:"San Glucose"},{SL:"San Lorenzo"},{SR:"Sontar"},{SY:"Sylvania"},{TF:"Tralfamadore"},{TH:"Themyscira"},{UA:"Utopia"},{VA:"Vespugia"},{WA:"Wakanda"},{WX:"Wessex"},{ZA:"Zamunda"},{ZK:"Zubrowka"}],WCe=["Amber","Ansul","Atlantis","Braavos","Busytown","Castle Rock","Centralia","Coober Pedy","Chefchaouen","Chronopolis","Damanhur","Diaspar","Dictionopolis","Diomira","El Dorado","Elista","Ephesus","Gotham","Hadleyburg","Hallstatt","Hierusalem","Ilium","Inverness","Kowloon","Laputa","Longyearbyen","Lys","Matmata","Maycomb","Metropolis","Miyake-jima","Monowi","Nagoro","Navarre","New New York","Nimbin","Pemberley","Pseudopolis","Rivendell","Roswell","Shangri-La","Springfield","Supilinn","Thneedville","Trantor","Wobegon","Yonwood","Xanadu","Xylar","Zion"];function _J({count:t=1,participantsCount:e=32}={}){let i=Dn(WCe),r=i.slice(0,t);return{cities:Re(0,e).map(n=>n<Math.min(t,i.length)?r[n]:da(r))}}function $J({count:t=1,participantsCount:e=32}={}){let i=Dn(HCe),r=i.slice(0,t).map(n=>Object.keys(n)).flat();return{states:Re(0,e).map(n=>n<Math.min(t,i.length)?r[n]:da(r))}}function BJ({count:t=1,participantsCount:e=32}={}){let i=Re(0,t).map(()=>Re(0,5).map(()=>ts(0,9)).join(""));return{postalCodes:Re(0,e).map(r=>r<t?i[r]:da(i))}}function IP({idPrefix:t,participantType:e,index:i,uuids:r}){let n=ri(e)?e[0]:"X";return t?`${t}-${n}-${i}`:r?.pop()||Et()}function VJ(t){let{cities:e,states:i,postalCodes:r,nationalityCode:n,participantIndex:a}=t;return{postalCode:r?.[a],state:i?.[a],city:e?.[a],countryCode:n}}var zCe={lastNames:["Abbey","Ahern","Ampleforth","Ananiadis","Andelic","Assange","Atreides","Austen","Bach","Banks","Barrington","Batty","Bauers","Beals","Beer","Bennett","Berry","Bonaparte","Brewer","Brockovich","Bukowski","Cassidy","Catton","Calvino","Carlin","Carson","Chip","Constant","Crane","Crowne","Cummings","Curie","Dallas","Diamond","Deckard","Drazic","Dunbar","Earhart","Eisenstein","Eldritch","Elliot","Ellul","Escher","Eyre","Faulkner","Fulcher","Fukuoka","Godel","Goldstein","Greer","Hedges","Herbert","Holmgren","Humperdinck","Huxley","Illich","Jeffers","Jensen","Jevons","Johnson","Johnstone","Jovovich","Kingsnorth","Langer","Fernwright","Fuller","Le Guin","Lem","Lovelace","Mander","McLuhan","Midgely","Mond","Montoya","Moore","Murry","Nagle","Nearing","Ogden","Ophuls","Parks","Paz","Peet","Perfect","Pendejo","Pevensie","Postman","Ripley","Rodda","Rumfoord","Runciter","Rugen","Sale","Schumacher","Shaftoe","Shelley","Shepard","Smith","Stratton","Stewart","Swift","Tillich","Turing","Tyrell","Twain","Yeats","Veblen","Yates","Vonnegut","Waterhouse","Watson","Wolin","Wirt","Waschuk","Wormwood","Zecic"],firstFemale:["Ada","Amelia","Amelie","America","Anne","Antonia","Aravis","Astrid","Beatrice","Brienne","Buttercup","Caitlin","Cimorene","Cordelia","Desdemona","Ellen","Elizabeth","Emily","Emmie","Erin","Eva","Evelyn","Heather","Helen","Hermia","Hypatia","Imogen","Jane","Jasmine","Juliana","Juliet","Katniss","Leeloo","Lenina","Lilith","Linda","Lizzie","Louise","Lucy","Marie","Mary","Martha","Matilda","Milla","Miranda","Meg","Melba","Nicole","Ola","Portia","Pris","Rachael","Rachel","Rebecca","River","Rosa","Rosalind","Scout","Sharn","Susanne","Titania","Uhura","Ursula","Valentina","Viola","Virginia","Xena","Zoe"],firstMale:["Alan","Aldous","August","Axel","Barda","Barry","Bill","Bruce","Charles","Chris","Constantine","Darwin","David","Derrick","Edward","Emmanuel","Ernst","Estlin","Fezzik","Filby","Frank","Frito","George","Glen","Helmholtz","Inigo","Italo","Ivan","Jacques","James","Jared","Jerry","Joe","Johann","Julian","John Michael","Jonathan","Korben","Kirkpatrick","Kurt","Lief","Malachi","Mark","Marhsall","Masanobu","Maurits","Michael","Miro","Mustapha","Neil","Nikola","Octavio","Palmer","Paul","Pierre","Robinson","Rick","Rincewind","Roy","Shannon","Sheldon","Stafford","Stanislaw","Stanley","Syme","Thorstein","Thomas","Tyrone","Vizzini","Walton","Walker","Warren","Wendell","Westley","William","Winston","Zoran"]};function VA(t){let{count:e=100,sex:i}=t||{};if(!e||i&&!il(i))return{personData:[],error:ie};let r=Math.ceil(e*1.3),{lastNames:n,firstFemale:a,firstMale:s}=zCe,o=im.map(({iso:h})=>h).filter(Boolean),l=Math.ceil(r/n.length),u=Math.ceil(r/a.length),c=Math.ceil(r/s.length),d=Re(0,l).flatMap(()=>{let h=ke(n,!1,!0);return Re(0,n.length).map(()=>ma(h))}),p=Re(0,u).flatMap(()=>{let h=ke(a,!1,!0);return Re(0,a.length).map(()=>ma(h))}),f=Re(0,c).flatMap(()=>{let h=ke(s,!1,!0);return Re(0,s.length).map(()=>ma(h))}),m={};for(let h=0;h<r;h++){let g=d.pop(),I=i||da([er,Hr]),v=I===er?f.pop():p.pop(),w=da(o);m[`${v}${g}`]={nationalityCode:w,sex:I,firstName:v,lastName:g}}return{personData:Object.values(m).slice(0,e)}}function jJ(t){let e=t?.count||1,{personExtensions:i,consideredDate:r,isMock:n=!0,gendersCount:a,personData:s,category:o,sex:l}=t||{};if(Number.isNaN(Number(e)))return{error:ie};let u=a?.[er]||zf(l)&&e||0,c=a?.[Hr]||op(l)&&e||0;e=Math.max(e,u+c);let d=e-(u+c),p=u&&VA({count:u,sex:er}).personData||[],f=c&&VA({count:c,sex:Hr}).personData||[],m=[...p,...f,...d&&VA({count:d}).personData||[]],h=m.filter(T=>!l||u&&c||T.sex===l),g=[];if(Array.isArray(s)){let T=s.filter(P=>typeof P.firstName!="string"||typeof P.lastName!="string"||P.sex&&![er,Hr].includes(P.sex)||P.nationalityCode&&(typeof P.nationalityCode!="string"||P.nationalityCode.length>3||!im.some(({iso:D,ioc:E})=>[D,E].includes(P.nationalityCode)))?!1:(P.nationalityCode&&g.push(P.nationalityCode),!0));if(T.length)h=T;else return{error:ie}}let I=s?h:Dn(h);if(I.length<e){let{maleFirstNames:T,maleLastNames:P,femaleFirstNames:D,femaleLastNames:E,nationalityCodes:R}=m.reduce((C,M)=>{let{firstName:N,lastName:A,nationalityCode:O}=M;return M.sex===er?(C.maleFirstNames.includes(N)||C.maleFirstNames.push(N),C.maleLastNames.includes(A)||C.maleLastNames.push(A)):(C.femaleFirstNames.includes(N)||C.femaleFirstNames.push(N),C.femaleLastNames.includes(A)||C.femaleLastNames.push(A)),C.nationalityCodes.includes(O)||C.nationalityCodes.push(O),C},{maleFirstNames:[],maleLastNames:[],femaleFirstNames:[],femaleLastNames:[],nationalityCodes:[]});Re(0,e-I.length).forEach(()=>{let C=l||da([er,Hr]),M=da(R),N=da(C===er?T:D),A=da(C===er?P:E),O={firstName:N,lastName:A,sex:C,nationalityCode:M};I.push(O)})}let{ageMinDate:v,ageMaxDate:w}=Tp({consideredDate:r,category:o}),y=Ye(v?.slice(0,4)||0)||Ye(w?.slice(0,4)||0)-3,b=Ye(w?.slice(0,4)||0)||Ye(v?.slice(0,4)||0)+3,S=(v||w)&&[y,b],U=I.slice(0,e).map((T,P)=>{let[D,E]=S||[],R=S&&ma(Re(D,E)),C=ma(Re(0,365)),M=R&&kve(R,C);return Object.assign(Ve({extensions:i||[{name:"regionCode",value:P+1}],birthDate:M,isMock:n}),T)});return{persons:U.length&&U||I[0],nationalityCodes:g}}var qCe=["Ace Academy","Avengers","Ball Bouncers","Baseliners","Captivators","Civil Disobedients","Continentals","Court Royal","Court Sharks","Diamond Dogs","Danger Zone","Doubles Dominators","Double Faults","Tricksters","Eliminators","Court Crusaders","Fuzz Busters","Game Changers","Goal Gurus","Good Volley","Green Machine","Hawk Eyes","Inside Outers","Killer Instinct","Line Toers","Masters of Mayhem","Matter Catchers","Cheap Shot","Mean Machines","Mindspace Invaders","Net Centric","Net Positive","Smash Mullet","Over Your Head","Spin Meisters","Aggressors","Racket Machine","Slice Happy","Refs Nightmare","Sandeaters","Sun Seekers","Slicer Dicers","Stacked Deck","Cross Stringers","The Emergence","Total Demolition","Touch and Go","Unreturnables","Upside Downers","Vertically Challenged","Visual Spectacle"];function vP({nameRoot:t="TEAM",count:e=1}={}){let i=Dn(qCe).slice(0,e);return i.length<e&&Re(0,e-i.length).forEach(r=>i.push(`${t} ${r+1}`)),{names:i}}function Ev(t){let{scaledParticipantsCount:e,rankingRange:i}=t,{ratingsParameters:r=Dr,valuesInstanceLimit:n,ratingsValues:a=[],consideredDate:s,categories:o,category:l,nationalityCodesCount:u,nationalityCodeType:c,nationalityCodes:d,participantsCount:p=32,participantType:f,teamSize:m=8,personIds:h,idPrefix:g,uuids:I,personExtensions:v,addressProps:w,gendersCount:y,matchUpType:b,personData:S,sex:U,inContext:T,withISO2:P,withIOC:D,scaleAllParticipants:E}=t,R=f===pt||b===Sp,C=f===Lt||b===Lt;i&&(!Array.isArray(i)||!i.every(fe=>Ni(fe))||i.length!==2)&&(i=void 0),e=E?p:e;let M=1e3,N=e&&e>M?e:M;i=i||[1,N],i[1]+=1;let A=p*(R&&2||C&&(m??8)||1),O=jJ({count:A,personExtensions:v,consideredDate:s,gendersCount:y,personData:S,category:l,sex:U});if(O.error)return O;let{nationalityCodes:k,persons:F}=O,x={},L={},$={},V={},_=fe=>{Object.assign(x,fe.doublesRankings),Object.assign(L,fe.singlesRankings),Object.assign(V,fe.doublesRatings),Object.assign($,fe.singlesRatings)};if(bt(l)){let fe=OW({scaledParticipantsCount:e,ratingsParameters:r,participantType:f,ratingsValues:a,rankingRange:i,category:l});_(fe)}Array.isArray(o)&&o.forEach(fe=>{let Te=OW({scaledParticipantsCount:e,ratingsParameters:r,participantType:f,ratingsValues:a,rankingRange:i,category:fe});_(Te)});let B=im.filter(fe=>c==="IOC"&&fe.ioc||fe.iso);function G(fe){let Te=Math.ceil(A/fe);return n&&Te>n?Math.ceil(A/n):fe}let{postalCodesProfile:j,postalCodesCount:K,statesProfile:Y,citiesProfile:X,citiesCount:Z,statesCount:J}=w||{},ae=fe=>Object.keys(fe).flatMap(Te=>Re(0,Y[Te]).map(()=>Te)),te=X&&ae(X)||w?.cities||_J({count:Z||A,participantsCount:A}).cities,ne=Y&&ae(Y)||w?.states||$J({count:J||A,participantsCount:A}).states,le=j&&ae(j)||w?.postalCodes||BJ({count:K||A,participantsCount:A}).postalCodes,de={cities:te,states:ne,postalCodes:le},pe=G(u),ge=pe?Dn(B).slice(0,u):d&&B.filter(fe=>d.includes(fe.iso))||B,Me=Dn(Re(0,Math.ceil(A/(pe||1))).map(()=>ge).flat(1/0)),Pe=vP({count:p}).names;return{participants:Re(0,p).flatMap(fe=>{let Te=R&&2||C&&(m??8)||1,ce=Re(0,Te).map(Ne=>{let me=fe*Te+Ne;return Be(me)}),ye=ce.map(Ne=>Ne.participantId),be=ce.map(Ne=>Ne.person.standardFamilyName).join("/"),Fe=R?pt:Lt,we={participantId:IP({participantType:Fe,index:fe,idPrefix:g,uuids:I}),participantName:R?be:Pe[fe],participantRole:Kr,individualParticipantIds:ye,participantType:Fe};return T&&(we.individualParticipants=ce),R||C?[we,...ce]:ce}),...H};function Be(fe){let Te=F[fe],{nationalityCode:ce,participantExtensions:ye,participantTimeItems:be,extensions:Fe,firstName:we,birthDate:Ne,lastName:me,personId:Ee,sex:Le}=Te||{},Q=we||"GivenName",se=me||"FamilyName",oe=`${Q} ${se}`,ue=Me[fe],ee=k?.length&&ce||ue&&(c==="IOC"?ue.ioc||ue.iso:ue.iso||ue.ioc)||ce;Me?.length&&!ee&&!ce&&console.log("%c Invalid Nationality Code",{participantIndex:fe,country:ue});let Se=VJ({...de,participantIndex:fe,nationalityCode:ee}),De=Ve({participantId:IP({participantType:gt,index:fe,idPrefix:g,uuids:I}),extensions:ye,timeItems:be,participantRole:Kr,participantType:gt,participantName:oe,person:{personId:Ee||h?.length&&h[fe]||Et(),birthDate:Pn(Ne)?Ne:void 0,addresses:[Se],standardFamilyName:se,standardGivenName:Q,nationalityCode:ee,extensions:Fe,sex:Le}});if(D&&ee){let Ue=im.find(({iso:ut})=>ut===ee);Ue?.ioc&&(De.person.iocNationalityCode=Ue.ioc),Ue?.label&&(De.person.countryName=Ue.label)}if(P&&ee){let Ue=im.find(({iso:ut})=>ut===ee);Ue?.iso2&&(De.person.iso2NationalityCode=Ue.iso2),Ue?.label&&(De.person.countryName=Ue.label)}let it=Ue=>{let ut=Ue.categoryName||Ue.ratingType||Ue.ageCategoryCode,yi=L[ut]?.[fe],qe=x[ut]?.[fe];ST({scaleValue:yi,eventType:Pm,scaleType:ou,participant:De,category:Ue}),ST({scaleValue:qe,eventType:lc,scaleType:ou,participant:De,category:Ue});let bi=$[ut]?.[fe],oi=V[ut]?.[fe];ST({scaleValue:bi,eventType:Pm,scaleType:od,participant:De,category:Ue}),ST({scaleValue:oi,eventType:lc,scaleType:od,participant:De,category:Ue})};return Array.isArray(o)?o.forEach(Ue=>it(Ue)):l&&it(l),De}}function ST({scaleValue:t,participant:e,eventType:i,scaleType:r,category:n}){let a=n.categoryName||n.ratingType||n.ageCategoryCode,s=[pd,r,i,a].join("."),o={itemValue:t,itemType:s};a&&t&&(e.timeItems||(e.timeItems=[]),e.timeItems.push(o))}function OW(t){let{category:e,scaledParticipantsCount:i,ratingsParameters:r,participantType:n,ratingsValues:a=[]}=t,s=e.rankingRange||t.rankingRange||[1,1e3],o={},l={},u={},c={},{categoryName:d,ageCategoryCode:p,ratingType:f}=e,m=e.categoryName||e.ratingType||e.ageCategoryCode;if((d||p)&&!f){let[h,g]=s||[];if(l[m]=Dn(Re(h,g)).slice(0,i||ts(20,30)),[pt,Lt].includes(n)){let[I,v]=s||[];o[m]=Dn(Re(I,v)).slice(0,i||ts(20,30))}}if(f&&r[f]){let{ratingMax:h,ratingMin:g,ratingAttributes:I}=e,v={...r[f],...I||{}},{attributes:w={},decimalsCount:y,accessors:b,range:S,step:U}=v,T=C=>{let M={},N=Object.keys(C||{});for(let A of N){let O=C[A];if(typeof O=="object"&&O.generator){let{range:k}=O,[F,x]=k.slice().sort();M[A]=ts(F,x)}else M[A]=O}return M},P=S[0]>S[1]?2:.7,[D,E]=S.slice().sort(),R=Re(0,2e3).map(()=>r6(D,E,P,U,y)).filter(C=>(!h||C<=h)&&(!g||C>=g)).slice(0,i||ts(20,30)).map(C=>b?Object.assign({},...b.map(M=>({[M]:C})),T(w)):C);u[m]=[...a,...R],[pt,Lt].includes(n)&&(c[m]=[...a,...R])}return{singlesRankings:l,doublesRankings:o,singlesRatings:u,doublesRatings:c}}function X_(t){let{alternatesCount:e=0,tieFormatName:i,drawSize:r}=t,n=0,a=0,s=0,o=0,l={},u={[er]:0,[Hr]:0,[sh]:0,[ju]:0,ANY:0};(bt(t.tieFormat)?t.tieFormat:oc({namedFormat:i}))?.collectionDefinitions?.filter(Boolean).forEach(f=>{let{category:m,collectionId:h,matchUpType:g,matchUpCount:I,gender:v}=f;if(il(v)){let w=on(v),y=I*(g===$t?2:1);w&&u[w]<y&&(u[w]=y)}else Na(v)&&(u[er]<I&&(u[er]=I),u[Hr]<I&&(u[Hr]=I));if(m){let w=JSON.stringify(m);l[w]=m}if(h||(f.collectionId=Et()),Di($t)(g)){let w=I;o+=I,n=Math.max(n,w)}if(Di(Wt)(g)){let w=I;s+=I,a=Math.max(a,w)}});let c=Object.keys(l).length?Math.max(s,o*2):Math.max(a,n*2),d=n*(r+e),p=a*(r+e);return{maxDoublesDraw:d,maxSinglesDraw:p,teamSize:c,genders:u}}function YCe({participantsProfile:t,eventProfiles:e,drawProfiles:i}){let{participantsCount:r,participantType:n=gt}=t||{},a=r||0,s={[Hr]:0,[sh]:0,[ju]:0,[er]:0,ANY:0},o=0,l=0,u=0,c=0,d=0,p=({alternatesCount:m=0,uniqueParticipants:h,tieFormatName:g,drawSize:I=0,eventType:v,tieFormat:w,category:y,gender:b,stage:S})=>{let U=v===ls,T=v===rr,P=!!(h||S===We||y||b);if(T){c=Math.max(c,I+m),w=typeof w=="object"?w:oc({namedFormat:g});let{teamSize:D,maxDoublesDraw:E,maxSinglesDraw:R,genders:C}=X_({alternatesCount:m,tieFormatName:g,tieFormat:w,drawSize:I});u=Math.max(u,D),l=Math.max(l,R),P||(o=Math.max(o,E)),Object.keys(C).forEach(M=>s[M]+=C[M])}else if(U)if(P){let D=(I+m)*2;d+=D,b&&(s[b]+=D)}else I+m&&I+m>o&&(o=I+m);else if(P){let D=I+m;b&&(s[b]+=D),d+=D}else I&&I>l&&(l=I+m)};if(e?.forEach(m=>{let{tieFormatName:h,tieFormat:g,drawProfiles:I,eventType:v,category:w,gender:y}=m;if(I)for(let b of I){let{tieFormatName:S,tieFormat:U}=b;p({...b,tieFormatName:S||h,tieFormat:U||g,eventType:v,category:w,gender:y})}}),Array.isArray(i))for(let m of i)p(m);let f=Math.max(c*u,o*2,l);return o&&(n=pt),(r||a)<f&&(r=f),r&&o&&[pt,rr].includes(n)&&(l&&Math.floor(l/2)>o?r=Math.floor(l/2):(!l||o*2>=l)&&(r=Math.ceil(r/2))),r===void 0&&(r=!e?.length&&!i?.length?32:0),r<a&&(r=a),{uniqueParticipantsCount:d,participantsCount:r,largestTeamDraw:c,largestTeamSize:u,participantType:n,gendersCount:s}}function GJ({participantsProfile:t,tournamentRecord:e,eventProfiles:i,drawProfiles:r,startDate:n,uuids:a}){if(t?.participantsCount===0)return{addedCount:0,...H};let{participantsCount:s,participantType:o,largestTeamDraw:l,largestTeamSize:u,gendersCount:c}=YCe({participantsProfile:t,eventProfiles:i,drawProfiles:r}),d=t?.teamKey,p=Ev({consideredDate:n,...t,participantsCount:s,participantType:o,gendersCount:c,uuids:a}).participants,f=0,m=Zs({tournamentRecord:e,participants:p});if(m.error)return m;if(f+=m.addedCount,d){let v=K_({tournamentRecord:e,...d});if(v.error)return v}let h=p.filter(({participantType:v})=>v===gt).map(vt),g=t?.idPrefix?`${Lt}-${t.idPrefix}`:void 0,I=Re(0,l).map(v=>{let w=h.slice(v*u,(v+1)*u),y=IP({index:v,participantType:o,idPrefix:g,uuids:a});return{participantName:`Team ${v+1}`,participantRole:Kr,individualParticipantIds:w,participantType:Lt,participantId:y}});return m=Zs({participants:I,tournamentRecord:e}),m.error?m:(f+=m.addedCount,{addedCount:f,...H})}function HJ({drawProfiles:t,category:e,gender:i}){let r={},n=t?.reduce((s,o)=>{let{qualifyingPositions:l=0,participantsCount:u=0,uniqueParticipants:c,stage:d=xe,drawSize:p=0}=o||{};Object.keys(s).includes(d)||(s[d]=0);let f=(u||p)-l;return c||i||e||d===We?(Object.keys(r).includes(d)||(r[d]=0),r[d]+=f):s[d]=Math.max(s[d],f),s},{}),a=Object.keys(r);return a.forEach(s=>n[s]+=r[s]),{stageParticipantsCount:n,uniqueParticipantsCount:r,uniqueParticipantStages:a}}function WJ({allUniqueParticipantIds:t,stageParticipantsCount:e,eventParticipantType:i,targetParticipants:r}){let n=e[xe]||0,a=e[We]||0;return{stageParticipants:{QUALIFYING:r?.filter(({participantType:s})=>s===i).filter(({participantId:s})=>!t.includes(s)).slice(0,a),MAIN:r?.filter(({participantType:s})=>s===i).filter(({participantId:s})=>!t.includes(s)).slice(a,a+n)}}}var KCe={[mi]:2,[wi]:1,[Hi]:1,[$r]:1,[Qt]:4};function J_(t){let{defaultWithScorePercent:e=2,winningSide:i}=t,{matchUpStatusProfile:r=KCe,matchUpFormat:n=Ju,pointsPerMinute:a=1,sideWeight:s=4}=t;if(!xa({matchUpFormat:n}))return{error:O6};if(typeof r!="object")return{error:ie};if(e>100&&(e=100),Number.isNaN(Number(e))||Number.isNaN(Number(a))||Number.isNaN(Number(s)))return{error:ie};let o=Object.keys(r).filter(D=>Object.keys(uK).includes(D)&&D!==ki);if(Object.keys(o).reduce((D,E)=>D+r[E],0)>100)return{error:ie,matchUpStatusProfile:r};let l=o.reduce((D,E)=>(D.pointer=D.pointer+r[E],D.valueMap.push([D.pointer,E]),D),{pointer:0,valueMap:[]}),u=ts(1,100),c=(l.valueMap.find(D=>u<=D[0])??[100,ki])[1],d={sets:[],scoreStringSide1:"",side2ScoreString:""};if(Fr(c)){i=i||ts(1,2);let D={score:d,matchUpStatus:c,winningSide:i};if(!(c===Qt&&ts(1,100)>100-e))return{outcome:D}}else if([wi,Hi].includes(c))return{outcome:{score:d,matchUpStatus:c}};let p=zi(n),{bestOf:f=1,exactly:m,setFormat:h,finalSetFormat:g}=p??{},I=[],v=ts(0,1),w=i?[i-1]:[...Re(0,s).map(()=>v),1-v],y=[$r,Qt,cs,_d].includes(c)&&(ma(Re(1,m||f))||1),b,S=Re(1,(m??f)+1);for(let D of S){let E=D===(m??f),{set:R,incomplete:C,winningSideNumber:M}=XCe({setFormat:E&&g||h,incomplete:y===D,pointsPerMinute:a,matchUpStatus:c,weightedRange:w,setNumber:D});if(I.push(R),C){b=M;break}if(Nb({matchUp:{score:{sets:I},matchUpFormat:n}}).calculatedWinningSide)break}let U=Nb({matchUp:{score:{sets:I},matchUpFormat:n,winningSide:i}}),T=b?i||b:U.calculatedWinningSide,{score:P}=EJ({winningSide:T,score:{sets:I},matchUpStatus:c});return{outcome:{winningSide:T,matchUpStatus:c,score:P}}}function XCe({weightedRange:t=[0,1],pointsPerMinute:e,matchUpStatus:i,incomplete:r,setFormat:n,setNumber:a}){let s={setNumber:a},{setTo:o,tiebreakFormat:l,tiebreakAt:u,tiebreakSet:c,timed:d,minutes:p}=n,f=ts(0,t.length-1),m=t[f],h;if(d){let g=p*e,I=Math.round(g*.2),v=g+ma([1,-1])*I,w=lIe(v,2),y=[w,v-w];m&&y.reverse(),h=t[f]+1;let b=y[0]>y[1]&&1||y[1]>y[0]&&2||0;if(r){let[T,P]=y;return Object.assign(s,{side1Score:T,side2Score:P}),Yi.includes(i)?{set:s,incomplete:r,winningSideNumber:h}:{set:s,incomplete:r}}b||(y[ts(0,1)]+=1),b=y[0]>y[1]?1:2,b!==h&&y.reverse();let[S,U]=y;return Object.assign(s,{side1Score:S,side2Score:U,winningSide:h}),{set:s}}else{if(r)return s.side1Score=ts(0,u),s.side2Score=ts(0,u),Yi.includes(i)&&(h=t[f]+1),{set:s,incomplete:r,winningSideNumber:h};{let g=Re(1,o+1).flatMap(U=>Re(0,o+2-U).map(()=>U)),I=g[ts(0,g.length-1)],v=o&&x0({isSide1:!0,tiebreakAt:u,lowValue:I,setTo:o}),w=!v,y=t.length===1&&t[f]+1;if(!w){y?(v[0]>v[1]?1:2)!==y&&v.reverse():m&&v.reverse();let[U,T]=v;Object.assign(s,{side1Score:U,side2Score:T})}let b=Cb({matchUpScoringFormat:{setFormat:n},setObject:s}),S;if(b.hasTiebreakCondition||w){let{NoAD:U,tiebreakTo:T}=l||c||{},P=Re(1,T+1).flatMap(R=>Re(0,T+2-R).map(()=>R)),D=P[ts(0,P.length-1)],E=fC({isSide1:!0,tiebreakNoAd:U,tiebreakTo:T,lowValue:D});if(E)if(w){let R=E[0]>E[1]?1:2;y?R!==y&&E.reverse():m&&E.reverse(),[s.side1TiebreakScore,s.side2TiebreakScore]=E,S=E[0]>E[1]&&1||E[1]>E[0]&&2||void 0}else b.leadingSide===2?[s.side1TiebreakScore,s.side2TiebreakScore]=E:[s.side2TiebreakScore,s.side1TiebreakScore]=E}s.winningSide=b.winningSide||b.leadingSide||y||S}}return{set:s}}function JCe({firstRoundDualMatchUps:t,event:e,tournamentRecord:i,drawDefinition:r}){let n=e?.category?.ageCategoryCode||e?.category?.categoryName;if(n){let d=rJ({singlesOnly:!0,tournamentRecord:i,drawDefinition:r,scaleAccessor:{scaleName:n,sortOrder:"ASC",scaleType:ou},event:e});if(d.error)return d;let{lineUps:p,participantsToAdd:f}=d;Zs({tournamentRecord:i,participants:f}),xt({element:r,extension:{name:cc,value:p}});return}let a=t[0]?.structureId,{positionAssignments:s}=Yt({drawDefinition:r,structureId:a});if(!s?.length)return;let{participants:o}=Ei({participantFilters:{participantTypes:[Zt]},tournamentRecord:i});function l(d){return o?.find(p=>{let{participantId:f}=p;return s.find(m=>m.participantId===f)?.drawPosition===d})}function u(d,p,f){d.sides.forEach(m=>{let{drawPosition:h}=m,g=l(h);if(g){let I=g.individualParticipantIds?.[p];I&&gP({teamParticipantId:g.participantId,participantId:I,tournamentRecord:i,drawDefinition:r,tieMatchUpId:f,event:e});return}})}function c(d,p,f){d.sides.forEach(m=>{let{drawPosition:h}=m,g=l(h);g&&g.individualParticipantIds?.slice(p*2,p*2+2)?.forEach(I=>{gP({teamParticipantId:g.participantId,participantId:I,tournamentRecord:i,drawDefinition:r,tieMatchUpId:f,event:e})})})}t.forEach(d=>{let p=d.tieMatchUps.filter(Di(Wt)),f=d.tieMatchUps.filter(Di($t));p.forEach((m,h)=>{let g=m.matchUpId;u(m,h,g)}),f.forEach((m,h)=>{let g=m.matchUpId;c(m,h,g)})})}function QCe({structure:t,matchUpsMap:e,drawDefinition:i,tournamentRecord:r,event:n,matchUpStatusProfile:a,matchUpFormat:s,matchUpStatus:o,scoreString:l,randomWinningSide:u,completionGoal:c,completedCount:d}){let p=Nt({contextFilters:{matchUpTypes:[$t,Wt]},afterRecoveryTimes:!1,tournamentRecord:r,inContext:!0,drawDefinition:i,matchUpsMap:e,structure:t,event:n}).matchUps.filter(({winningSide:f})=>!f).sort(gh).map(Ir);for(let f of p){if(!Number.isNaN(Number(c))&&d.value>=c)break;let{matchUps:m}=Nt({matchUpFilters:{matchUpTypes:[$t,Wt]},afterRecoveryTimes:!1,tournamentRecord:r,inContext:!0,drawDefinition:i,matchUpsMap:e,structure:t,event:n}),h=m.find(I=>I.matchUpId===f),g=[wi,Hi].includes(h.matchUpStatus);if(h?.readyToScore&&!g){let I=ZCe({matchUpStatusProfile:a,tournamentRecord:r,drawDefinition:i,targetMatchUp:h,matchUpFormat:s,matchUpStatus:o,scoreString:l,winningSide:!u&&1,event:n});if(I?.error)return I;d.value+=1}}}function yP(t){let{matchUpStatusProfile:e,completeAllMatchUps:i,randomWinningSide:r,tournamentRecord:n,completionGoal:a,drawDefinition:s,event:o}=t;if(!s)return{error:_e};let l=t.matchUpFormat||s.matchUpFormat||o?.matchUpFormat,u=s.structures.slice().sort(ch),c={value:0},{matchUps:d,matchUpsMap:p}=Qi({matchUpFilters:{matchUpTypes:[Zt],roundNumbers:[1]},contextFilters:{stages:[xe,We]},inContext:!0,drawDefinition:s});if(d?.length){let I=JCe({firstRoundDualMatchUps:d,event:o,tournamentRecord:n,drawDefinition:s});if(I?.error)return I}let f=typeof i=="string"&&i,m=f&&ki,h=u.length===2&&u[0].finishingPosition===Ep&&xi(u.map(({stage:I})=>I),[xe,Ui]).length===2,g=u.map(({structureId:I})=>I);for(let I of g){if(c.value>=a)break;let v=s.structures.find(y=>y.structureId===I),w=QCe({structure:v,matchUpsMap:p,drawDefinition:s,tournamentRecord:n,event:o,matchUpStatusProfile:e,matchUpFormat:l,matchUpStatus:m,scoreString:f,randomWinningSide:r,completionGoal:a,completedCount:c});if(w?.error)return w;h&&v.finishingPosition===Ep&&t.completeRoundRobinPlayoffs&&hv({structureId:v.structureId,applyPositioning:!0,drawDefinition:s})}return{...H,completedCount:c.value}}function zJ(t){let{matchUpStatusCodes:e,policyDefinitions:i,tournamentRecord:r,drawDefinition:n,targetMatchUp:a,matchUpStatus:s,matchUpFormat:o,scoreString:l,winningSide:u,event:c}=t;if(!a||a.matchUpStatus==="BYE")return;let{matchUpId:d}=a||{},{outcome:p}=H_({matchUpFormat:o,matchUpStatus:s,scoreString:l,winningSide:u});return e&&(p.matchUpStatusCodes=e),FS({tournamentRecord:r,policyDefinitions:i,drawDefinition:n,matchUpFormat:o,matchUpId:d,outcome:p,event:c})}function ZCe(t){let{matchUpStatusProfile:e={},tournamentRecord:i,policyDefinitions:r,drawDefinition:n,matchUpStatus:a,matchUpFormat:s,targetMatchUp:o,scoreString:l,winningSide:u,event:c}=t;if(l||a)return zJ(t);let{matchUpId:d}=o||{},{outcome:p}=J_({matchUpStatusProfile:e,matchUpFormat:s,winningSide:u});return FS({policyDefinitions:r,tournamentRecord:i,drawDefinition:n,matchUpFormat:s,matchUpId:d,outcome:p,event:c})}function qJ({matchUpStatusProfile:t,completeAllMatchUps:e,randomWinningSide:i,tournamentRecord:r,drawProfiles:n,isMock:a,event:s}){let o=$i({event:s}).flightProfile,{eventName:l,eventType:u,category:c}=s,{startDate:d}=r,p=[],f=c?.categoryName||c?.ageCategoryCode||c?.ratingType,m=s.drawDefinitions?.map(({drawId:h})=>h);if(Array.isArray(o?.flights))for(let[h,g]of o.flights.entries()){let{drawId:I,stage:v,drawName:w,drawEntries:y}=g;p.push(g.drawId);let b=n[h],{seedsCount:S,generate:U=!0}=b||{};if(U){let T=y.filter(ba(su)).map(ba(su)),P=f||l;if(r&&S&&S<=T.length&&Re(1,S+1).forEach((M,N)=>{let A={scaleValue:M,scaleName:P,scaleType:jl,eventType:u,scaleDate:d},O=T[N];Iv({tournamentRecord:r,participantId:O,scaleItem:A})}),m?.includes(I))break;let D=OS({...b,matchUpType:u,seedingScaleName:P,tournamentRecord:r,drawEntries:y,drawName:w,drawId:I,isMock:a,event:s,stage:v});if(D.error)return{error:D.error,drawIds:[]};let{drawDefinition:E}=D;if(!E)return{error:Oa};let R=n[h]?.drawExtensions;if(Array.isArray(R)&&R.filter(sl).forEach(M=>xt({element:E,extension:M})),D=xS({suppressNotifications:!0,tournamentRecord:r,drawDefinition:E,event:s}),D.error)return{error:D.error,drawIds:[]};if(b?.withPlayoffs){let M=E.structures?.[0].structureId,N=XR({idPrefix:b.idPrefix,...b.withPlayoffs,tournamentRecord:r,drawDefinition:E,structureId:M,isMock:a,event:s});if(N?.error)return N}let C=b?.completionGoal;if(b?.automated!==!1&&(e||C)){let M=b?.matchUpFormat,N=yP({completeAllMatchUps:!C&&e,matchUpStatusProfile:t,randomWinningSide:i,tournamentRecord:r,completionGoal:C,drawDefinition:E,matchUpFormat:M,event:s});if(N.error)return{error:N.error,drawIds:[]};let A=N.completedCount;if(b?.drawType===au){let O=E.structures?.find(x=>x.stage===xe);if(!O)return{error:Ii};let k=hv({structureId:O.structureId,tournamentRecord:r,drawDefinition:E});if(k.error)return{error:k.error,drawIds:[]};let F=C?C-(A??0):void 0;if(k=yP({completeAllMatchUps:!C&&e,completionGoal:C?F:void 0,matchUpStatusProfile:t,randomWinningSide:i,tournamentRecord:r,drawDefinition:E,matchUpFormat:M,event:s}),k.error)return{error:k.error,drawIds:[]}}}}}return{...H,drawIds:p}}function YJ(t){let{participantsProfile:e={},uniqueParticipantsCount:i,ratingsParameters:r,tournamentRecord:n,eventProfile:a,eventIndex:s,event:o,uuids:l}=t,{category:u,gender:c,eventType:d}=o,p=Di(nl)(d)&&gt||Di(ls)(d)&&pt||d,f=i[xe]||0,m=i[We]||0,h=a.drawProfiles?.length?f+m:a.participantsProfile?.participantsCount??0,g=il(c)?c:void 0,I=e?.idPrefix?`E-${s}-${e?.idPrefix}`:void 0,{participants:v}=Ev({uuids:a.uuids||l,...e,scaledParticipantsCount:a.scaledParticipantsCount,consideredDate:n?.startDate,rankingRange:a.rankingRange,participantType:p,participantsCount:h,ratingsParameters:r,category:u,idPrefix:I,sex:g}),w=Zs({tournamentRecord:n,participants:v});if(w.error)return w;let y=v?.filter(({participantType:S})=>S===p),b=v?.map(vt);return{uniqueDrawParticipants:y,uniqueParticipantIds:b}}function eMe({autoEntryPositions:t,tournamentRecord:e,drawParticipants:i,drawProfile:r,event:n}){let{drawType:a=Yo,qualifyingPositions:s=0,stage:o=xe,drawSize:l=0,drawName:u,drawId:c}=r,d=l-s,p=i.slice(0,d).map(vt);if(p.length){let h=Ko({participantIds:p,autoEntryPositions:t,entryStage:o,tournamentRecord:e,event:n});if(h.error)return h}let f=p.map(h=>({entryStatus:aa,entryStage:o,participantId:h})),m=AC({drawName:u||a,qualifyingPositions:s,drawEntries:f,drawId:c,event:n,stage:o});return m.error?m:{...H}}function KJ({uniqueDrawParticipants:t,autoEntryPositions:e,stageParticipants:i,tournamentRecord:r,drawProfiles:n,category:a,gender:s,event:o}){let l=0;for(let u of n){let{qualifyingPositions:c=0,uniqueParticipants:d,stage:p=xe,drawSize:f=0}=u,m=f-c,h=d||s||a||p===We,g=h?t.slice(l,l+m):i[p||xe]||[];h&&(l+=m);let I=eMe({autoEntryPositions:e,drawParticipants:g,tournamentRecord:r,drawProfile:u,event:o});if(I.error)return I}return{...H}}function XJ(t){let{allUniqueParticipantIds:e,matchUpStatusProfile:i,participantsProfile:r,completeAllMatchUps:n,autoEntryPositions:a,hydrateCollections:s,randomWinningSide:o,ratingsParameters:l,tournamentRecord:u,eventProfile:c,eventIndex:d,publish:p,isMock:f,uuids:m}=t,h=c.gender,g=c.eventName,{eventType:I=nl,policyDefinitions:v,drawProfiles:w=[],eventExtensions:y,surfaceCategory:b,tieFormatName:S,processCodes:U,discipline:T,eventLevel:P,timeItems:D,ballType:E,category:R}=c,C=c.eventId||Et(),M=c.tieFormat||(I===rr?oc({namedFormat:S,event:{eventId:C,category:R,gender:h},hydrateCollections:s,isMock:f}):void 0),N=u.participants;for(let Y of w)!h&&Y.gender&&(h=Y?.gender);let{stageParticipantsCount:A,uniqueParticipantsCount:O,uniqueParticipantStages:k}=HJ({drawProfiles:w,category:R,gender:h}),F=Di(nl)(I)&&gt||Di(ls)(I)&&pt||I,{uniqueDrawParticipants:x=[],uniqueParticipantIds:L=[]}=k?YJ({event:{eventType:I,category:R,gender:h},uniqueParticipantsCount:O,participantsProfile:r,ratingsParameters:l,tournamentRecord:u,eventProfile:c,eventIndex:d,uuids:m}):{},{eventAttributes:$}=c;typeof $!="object"&&($={});let V=R?.categoryName||R?.ageCategoryCode||R?.ratingType;g=g||V||"Generated Event";let _={...$,surfaceCategory:b,processCodes:U,discipline:T,eventLevel:P,eventName:g,eventType:I,tieFormat:M,ballType:E,category:R,eventId:C,gender:h};if(y?.length&&Array.isArray(y)){let Y=y.filter(sl);Y?.length&&Object.assign(_,{extensions:Y})}if(Array.isArray(D)&&D.forEach(Y=>Uh({event:j,timeItem:Y})),typeof v=="object")for(let Y of Object.keys(v))kp({policyDefinitions:{[Y]:v[Y]},event:_});_.category&&(_.category.categoryName=V);let B,G=wv({suppressNotifications:!1,internalUse:!0,tournamentRecord:u,event:_});if(G.error)return G;let j=G?.event,{stageParticipants:K}=WJ({allUniqueParticipantIds:e,stageParticipantsCount:A,eventParticipantType:F,targetParticipants:N});if(w?.length){let Y=KJ({uniqueDrawParticipants:x,autoEntryPositions:a,stageParticipants:K,tournamentRecord:u,drawProfiles:w,category:R,gender:h,event:j});if(Y.error)return Y;let X=qJ({matchUpStatusProfile:i,completeAllMatchUps:n,randomWinningSide:o,tournamentRecord:u,drawProfiles:w,isMock:f,event:j});if(X.error)return X;B=X.drawIds}else if(c?.participantsProfile?.participantsCount){let Y=x.map(vt);if(Y.length){let X=Ko({participantIds:Y,autoEntryPositions:a,tournamentRecord:u,entryStage:xe,event:j});if(X.error)return X}}return p&&Uv({tournamentRecord:u,event:j}),{drawIds:B,eventId:C,uniqueParticipantIds:L}}function Q_({tournamentRecords:t,scheduleDate:e,venueId:i,round:r}){if(!Pn(e))return{error:sr};let n="addSchedulingProfileRound",{extension:a}=mt({name:Mm,tournamentRecords:t,discover:!0}),s=a?.value||[],o=s.find(p=>tu(e,p.scheduleDate));if(!o){let{startDate:p,endDate:f}=IC({tournamentRecords:t}),m=new Date(e);if(p&&m<new Date(p)||f&&m>new Date(f))return{error:sr};o={scheduleDate:e,venues:[]},s.push(o)}let l=o.venues.find(p=>p.venueId===i);l||(l={venueId:i,rounds:[]},o.venues.push(l));let u=["notBeforeTime"],c=p=>Object.keys(p).filter(f=>!u.includes(f)).sort().map(f=>bt(p[f])?c(p[f]):p[f]).flat().join("|");if(l.rounds.find(p=>c(p)===c(r)))return z({result:{error:D6},stack:n});l.rounds.push(r);let d=yv({tournamentRecords:t,schedulingProfile:s});return d.error?d:{...H}}function tMe({schedulingProfile:t,tournamentRecord:e}){if(typeof t!="object")return{error:ie};let i=lv({tournamentRecord:e}).containedStructures,r=br({tournamentRecord:e}).matchUps??[],{tournamentId:n}=e,a=[];for(let s of t){let{scheduleDate:o,venues:l=[]}=s;for(let u of l){let{rounds:c,venueId:d}=u;for(let p of c){let{drawId:f,winnerFinishingPositionRange:m,roundSegment:h}=p,g=r.filter(I=>{let v=m?.indexOf("-")>0&&m.split("-").map(y=>+y),w=I.finishingPositionRange?.winner;return I.drawId===f&&(!p.roundNumber||I.roundNumber===p.roundNumber)&&(!w||!v||xi(w,v).length===2||rt(w).length===rt(v).length&&xi(w,v).length===rt(w).length)})[0];if(g){let{eventId:I,roundNumber:v,drawName:w,structureName:y,roundName:b}=g,S=g.structureId;v&&!m&&(S=Object.keys(i).find(P=>i[P].includes(S))??S);let U={tournamentId:n,structureId:S,roundNumber:v,roundSegment:h,eventId:I,drawId:f},T=Q_({tournamentRecords:{[n]:e},round:U,scheduleDate:o,venueId:d});if(T.error)return T;a.push({structureName:y,roundName:b,drawName:w,...U})}}}}return{scheduledRounds:a}}function zC(t){let e=Ge(t,[{drawProfile:!0,_ofType:Yn}]);if(e.error)return e;let{allUniqueParticipantIds:i=[],participantsProfile:r={},matchUpStatusProfile:n,completeAllMatchUps:a,autoEntryPositions:s,hydrateCollections:o,randomWinningSide:l,ratingsParameters:u,tournamentRecord:c,isMock:d=!0,drawProfile:p,startDate:f,drawIndex:m,uuids:h}=t,g=ke(p,!1,!0),{excessParticipantAlternates:I=!0,matchUpFormat:v=Ju,drawType:w=Yo,tournamentAlternates:y=0,alternatesCount:b=0,qualifyingPositions:S,qualifyingProfiles:U,generate:T=!0,eventExtensions:P,drawExtensions:D,completionGoal:E,tieFormatName:R,buildTeams:C,seedsCount:M,timeItems:N,drawName:A,category:O,idPrefix:k,publish:F,gender:x,stage:L}=g,$=g.drawSize||(g.ignoreDefaults?void 0:32),V=g.eventId||Et(),_=p.eventType||p.matchUpType||nl,B=_===ls?pt:gt,G=bt(p.tieFormat)&&p.tieFormat||_===Lt&&oc({event:{eventId:V,category:O,gender:x},namedFormat:R,hydrateCollections:o,isMock:d})||void 0,j=O?.categoryName||O?.ageCategoryCode||O?.ratingType,K=p.eventName||j||`Generated ${_}`,Y=c?.participants||[],X=(U?.flatMap(ce=>ce.structureProfiles||[]).reduce((ce,ye)=>{let be=!ye.participantsCount||ye.participantsCount>ye.drawSize?ye.drawSize:ye.participantsCount||0;return ce+be},0)||0)*(B===pt?2:1),Z=(!p.participantsCount||p.participantsCount>$?$:p.participantsCount)||0,J={eventName:K,eventType:_,tieFormat:G,category:O,eventId:V,gender:x};Array.isArray(N)&&N.forEach(ce=>Uh({event:J,timeItem:ce}));let{eventAttributes:ae}=p;if(typeof ae!="object"&&(ae={}),Object.assign(J,ae),P?.length&&Array.isArray(P)){let ce=P.filter(sl);ce?.length&&Object.assign(J,{extensions:ce})}let te=[];if(r?.participantsCount===0||p.uniqueParticipants||X||!c||x||O){let ce=(Z||0)+b+X,ye=ce,be={[er]:0,[Hr]:0},Fe,we;_===Lt&&({teamSize:Fe,genders:we}=X_({alternatesCount:b,tieFormatName:R,tieFormat:G,drawSize:$}),Object.keys(we).forEach(Ee=>{let Le=on(Ee);Le&&il(Ee)&&we[Le]&&(be[Le]=$*we[Le])}),ye=Fe*(($||0)+X));let Ne=r?.idPrefix?`D-${m}-${r?.idPrefix}`:void 0,me=Ev({...r,scaledParticipantsCount:p.scaledParticipantsCount||r.scaledParticipantsCount,participantsCount:ye,consideredDate:c?.startDate,sex:x||r?.sex,rankingRange:p.rankingRange,uuids:p.uuids||h,ratingsParameters:u,participantType:B,gendersCount:be,idPrefix:Ne,category:O}).participants;if(J.category&&(J.category.categoryName=j),c){let Ee=Zs({participants:me,tournamentRecord:c});if(Ee.error)return Ee}if(me.forEach(({participantId:Ee})=>te.push(Ee)),Y=me,_===Lt){let Ee=we[er]?me.filter(({participantType:Ue,person:ut})=>Ue===gt&&ut?.sex===er).map(vt):[],Le=we[Hr]?me.filter(({participantType:Ue,person:ut})=>Ue===gt&&op(ut?.sex)).map(vt):[],Q=me.filter(({participantType:Ue})=>Ue===gt).map(vt).filter(Ue=>!Ee.includes(Ue)&&!Le.includes(Ue)),se=[...g.teamNames??[],...vP({count:ce}).names],oe=Fe-(we[er]+we[Hr]),ue=0,ee=0,Se=0,De=Re(0,ce).map(Ue=>{let ut=Le.slice(ue,ue+we[Hr]),yi=Ee.slice(ee,ee+we[er]),qe=Q.slice(Se,Se+oe);ue+=we[Hr],ee+=we[er],Se+=oe;let bi=C!==!1?[...ut,...yi,...qe]:[];return{participantName:se[Ue]||`Team ${Ue+1}`,participantOtherName:`TM${Ue+1}`,participantRole:Kr,individualParticipantIds:bi,participantType:Lt,participantId:Et()}}),it=Zs({participants:De,tournamentRecord:c});if(!it.success)return it;Y=De}}let ne=ce=>{let{participantType:ye}=ce;return Di(nl)(_)&&ye===gt||Di(ls)(_)&&ye===pt?!0:_===Lt&&ye===Lt},le=ce=>!p.gender||ce.person?.sex===p.gender?!0:ce.individualParticipantIds?.some(ye=>{let be=Y.find(Fe=>Fe.participantId===ye);return be&&le(be)}),de=Y.filter(ne).filter(le).filter(({participantId:ce})=>!i.includes(ce)),pe=de.slice(0,Z).map(ce=>ce.participantId);if(d&&pe?.length){let ce=Ko({autoEntryPositions:s,entryStage:L,tournamentRecord:c,participantIds:pe,event:J});if(ce.error)return ce}let ge=X?de.slice(Z,Z+X).map(ce=>ce.participantId):0;if(d&&ge?.length){let ce=0,ye=1,be=(we,Ne)=>we.stageSequence-Ne.stageSequence,Fe=(we,Ne)=>we.roundTarget-Ne.roundTarget;for(let we of U.sort(Fe)){ye=we.roundTarget||ye;let Ne=1,me;for(let Ee of we.structureProfiles.sort(be)){let Le=(Ee.drawSize||A1(Ee.participantsCount))-(me||0),Q=ge.slice(ce,ce+Le),se=Ko({entryStage:We,entryStageSequence:Ne,autoEntryPositions:s,tournamentRecord:c,participantIds:Q,roundTarget:ye,event:J});if(se.error)return se;me=Ee.qualifyingPositions,ce+=Le,Ne+=1}ye+=1}}let Me=I&&c?.participants?.filter(({participantId:ce})=>!pe.includes(ce)).filter(ne).filter(le).slice(0,b||$-Z||y).map(ce=>ce.participantId);if(d&&Me?.length){let ce=Ko({participantIds:Me,autoEntryPositions:!1,entryStatus:Fs,tournamentRecord:c,event:J});if(ce.error)return ce.error}let Pe=j||K;c&&M&&M<=pe.length&&Re(1,M+1).forEach((ce,ye)=>{let be={scaleName:Pe,scaleDate:f,scaleType:uL,scaleValue:ce,eventType:_},Fe=pe[ye];Iv({tournamentRecord:c,participantId:Fe,scaleItem:be})});let Be=OS({...ke(p,!1,!0),tournamentRecord:c,seedingScaleName:Pe,matchUpFormat:v,eventId:V,isMock:d,event:J});if(Be.error)return Be;if(!Be.drawDefinition)return{error:Oa};let{drawDefinition:fe}=Be,Te=fe.drawId;if(Array.isArray(D)&&D.filter(sl).forEach(ce=>xt({element:fe,extension:ce})),T){if(xS({drawDefinition:fe,event:J,suppressNotifications:!0}),p.withPlayoffs){let ye=fe.structures?.[0].structureId,be=XR({...p.withPlayoffs,tournamentRecord:c,drawDefinition:fe,structureId:ye,idPrefix:k,isMock:d,event:J});if(be?.error)return be}let ce=p.automated===!1;if(d&&!ce){let ye=be=>{let Fe=yP({completeAllMatchUps:be.completeAllMatchUps,completionGoal:be.completionGoal,matchUpStatusProfile:n,randomWinningSide:l,tournamentRecord:c,drawDefinition:fe,matchUpFormat:v,event:J});if(Fe.error)return Fe;let we=Fe.completedCount;if(w===au){let Ne=fe.structures?.find(Le=>Le.stage===xe);if(!Ne)return{error:Ii};hv({structureId:Ne.structureId,tournamentRecord:c,drawDefinition:fe});let me=E?E-(we??0):void 0,Ee=yP({completionGoal:E?me:void 0,matchUpStatusProfile:n,completeAllMatchUps:a,randomWinningSide:l,tournamentRecord:c,drawDefinition:fe,matchUpFormat:v,event:J});if(Ee.error)return Ee}};if(E&&ye({completionGoal:E}),p.outcomes){let{matchUps:be}=Rn({inContext:!0,drawDefinition:fe,event:J});for(let Fe of p.outcomes){let{matchUpStatus:we=ki,matchUpStatusCodes:Ne,stageSequence:me=1,matchUpIndex:Ee=0,structureOrder:Le,matchUpFormat:Q,drawPositions:se,roundPosition:oe,stage:ue=xe,roundNumber:ee,winningSide:Se,scoreString:De}=Fe,it=be?.reduce((qe,bi)=>{let{structureId:oi,matchUpId:nn}=bi;return qe[oi]?qe[oi].push(nn):qe[oi]=[nn],qe},{})??[],Ue=Object.assign({},...Object.keys(it).map((qe,bi)=>({[qe]:bi+1}))),ut=be?.filter(qe=>(!ue||qe.stage===ue)&&(!me||qe.stageSequence===me)&&(!ee||qe.roundNumber===ee)&&(!oe||qe.roundPosition===oe)&&(!Le||Ue[qe.structureId]===Le)&&(!se||xi(se,qe.drawPositions).length===2))?.[Ee],yi=zJ({matchUpStatusCodes:Ne,tournamentRecord:c,drawDefinition:fe,targetMatchUp:ut,matchUpFormat:Q,matchUpStatus:we,scoreString:De,winningSide:Se});if(yi?.error)return yi}}a&&ye({completeAllMatchUps:a})}F&&Uv({tournamentRecord:c,event:J})}else{let ce=AC({drawEntries:fe.entries,drawName:A||w,qualifyingPositions:S,drawId:Te,event:J,stage:L});if(ce.error)return ce}return{...H,event:Ve(J),uniqueParticipantIds:te,targetParticipants:Y,drawDefinition:fe,eventId:V,drawId:Te}}var JJ=()=>({altitude:void 0,courtId:void 0,courtName:"",courtDimensions:void 0,latitude:void 0,longitude:void 0,surfaceCategory:void 0,surfaceType:void 0,surfacedDate:void 0,indoorOutdoor:void 0,floodlit:void 0,dateAvailability:[],onlineResources:[],pace:void 0,notes:void 0}),iMe=JJ;function qC({tournamentRecord:t,disableNotice:e,venueId:i,courtId:r,court:n}){let{venue:a}=Eu({tournamentRecord:t,venueId:i});if(!a)return{error:tf};a.courts||(a.courts=[]);let s={...JJ(),venueId:i,courtId:r};if(s.courtId||(s.courtId=Et()),a.courts.some(o=>o.courtId===s.courtId))return{error:o4};{let o=(n?.dateAvailability||[]).map(c=>({...c,date:Qe(c.date),startTime:ci(c.startTime),endTime:ci(c.endTime),bookings:c.bookings?.map(({startTime:d,endTime:p,bookingType:f})=>({startTime:ci(d),endTime:ci(p),bookingType:f}))})),l=Object.keys(s);for(let c of l)if(n?.[c])if(c==="dateAvailability"){let d=OR({dateAvailability:o});if(!d.valid&&d.error)return d;s.dateAvailability=o}else s[c]=n[c];let u=s;return a.courts.push(u),e||at({payload:{venue:a,tournamentId:t.tournamentId},topic:xc,key:a.venueId}),{...H,court:ke(s),venueId:i}}}function Z_(t){let{tournamentRecord:e,venueId:i}=t;if(typeof i!="string"||!i)return{error:xd};let r=t.tournamentRecords??(e&&{[e.tournamentId]:e})??{},n=[],a;for(let s of Object.values(r)){let{venue:o}=Eu({tournamentRecord:s,venueId:i});if(o){let l=rMe({...t,tournamentRecord:s});for(let u of l?.courts??[])n.push(u?.courtId);if(l.error)return l;a=!0}}return a?{...H,courtIds:n}:{error:tf}}function rMe({courtNameRoot:t="Court",dateAvailability:e=[],venueAbbreviationRoot:i,tournamentRecord:r,courtNames:n=[],courtTimings:a,courtsCount:s,startTime:o,courtIds:l,endTime:u,idPrefix:c,venueId:d,dates:p}){if(!d)return{error:xd};let f=Eu({tournamentRecord:r,venueId:d});if(f.error)return f;let{venue:m}=f;if(!Ni(s)||!n)return{error:s4};s=s??n.length;let h=Re(0,s).map(g=>{let I=a?.[g],v=I?p.map(w=>({date:Os(w),startTime:o,endTime:u,...I})):e;return I&&o&&u&&v.push({startTime:o,endTime:u}),{courtName:n[g]||i&&m?.venueAbbreviation&&`${m?.venueAbbreviation} ${g+1}`||`${t} ${g+1}`,dateAvailability:v}}).map((g,I)=>{let v=l?.pop()||c&&`${c}-${I+1}`;return qC({disableNotice:!0,tournamentRecord:r,courtId:v,venueId:d,court:g})}).map(g=>g.court).filter(Boolean);return h.length!==s?z({info:"not all courts could be generated",result:{error:ie}}):(m&&at({payload:{venue:m,tournamentId:r.tournamentId},topic:xc,key:m.venueId}),{...H,courts:ke(h)})}function e$({tournamentRecord:t,ignoreExistingVenues:e,venueProfiles:i,uuids:r}){let{startDate:n,endDate:a}=t,s=[];for(let[o,l]of i.entries()){let{venueAbbreviation:u,venueId:c=r?.pop()??Et(),dateAvailability:d,venueDateAvailability:p,defaultStartTime:f,defaultEndTime:m,startTime:h="07:00",endTime:g="19:00",courtTimings:I,courtsCount:v,courtNames:w,venueName:y,idPrefix:b,courtIds:S}=l,U={venueName:y||`Venue ${o+1}`,venueAbbreviation:u,venueId:c};f&&(U.defaultStartTime=f),m&&(U.defaultEndTime=m),l.isPrimary&&(U.isPrimary=!0),p&&(U.dateAvailability=p);let T=sS({tournamentRecord:t,venue:U});if(T.error){if(e)continue;return T}s.push(c);let P=Qg(n,a),D=!Array.isArray(d)&&[{startTime:h,endTime:g}].concat(P.map(E=>({date:Os(E),startTime:h,endTime:g})));if(v||w){let E=Z_({dateAvailability:d||D,tournamentRecord:t,courtTimings:I,courtsCount:v,courtNames:w,startTime:h,idPrefix:b,courtIds:S,endTime:g,venueId:c,dates:P});if(E.error)return E}}return s}function nMe(t){let{tournamentRecord:e,leagueProfiles:i,eventIds:r,venueIds:n,drawIds:a,allUniqueParticipantIds:s,uuids:o}=t,l=0;for(let c of i){let d=[],{tieFormatName:p=qD,teamProfiles:f=[],teamsCount:m=0,category:h,idPrefix:g,gender:I}=c,v=c.leagueName??c.eventName??`League ${l+1}`,w=c.leagueId??c.eventId??o?.pop()??Et();r.push(w);let y=bt(c.tieFormat)&&c.tieFormat||oc({event:{eventId:w,category:h,gender:I},namedFormat:p,isMock:t.isMock})||void 0;if(!y)return{error:ZI};let b=Math.max(m,f.length),S=Re(0,b),{genders:U,teamSize:T}=X_({tieFormat:y,drawSize:b}),P={[Hr]:0,[sh]:0,[ju]:0,[er]:0,ANY:0};Object.keys(U).forEach(E=>P[E]+=U[E]);for(let E of S){let R=f?.[E]?.teamName??`Team ${E+1}`,C=f?.[E]?.teamId||o?.pop()||Et(),M=c.startDate??t.startDate,N=Ev({...c?.participantsProfile,participantsCount:T,consideredDate:M,gendersCount:P,category:h,uuids:o}).participants,A=N.map($=>$.participantId),O=Lt,k=C??IP({participantType:O,idPrefix:g,index:E,uuids:o});d.push({participantId:k,entryStatus:aa,entryStage:xe});let F=f?.[E]?.venueIds??[],x={participantId:k,participantRole:Kr,participantName:R,individualParticipantIds:A,participantType:O,homeVenueIds:F};F.forEach($=>!n.includes($)&&n.push($)),s.push(...A,k);let L=Zs({participants:[x,...N],tournamentRecord:e});if(L.error)return L}let D={eventName:v,entries:d,eventType:Lt,tieFormat:y,category:h,eventId:w,gender:I};if(e.events||(e.events=[]),e.events.push(D),d.length){let E=(Ni(c.roundsCount)&&c.roundsCount)??c.roundsCount===qve?(b-1)*2:b-1,R=OS({automated:c.automated,tournamentRecord:e,drawType:na,roundsCount:E,drawSize:b,event:D});if(R.error)return R;let{drawDefinition:C}=R;if(C){let M=C?.drawId;xS({drawDefinition:C,event:D,suppressNotifications:!0}),a.push(M)}}l++}let u=n.map(c=>({venueId:c}));e$({tournamentRecord:e,ignoreExistingVenues:!0,venueProfiles:u,uuids:o})}var aMe=["Generated Tournament","CourtHive Challenge","Replication Crisis","Open Competition","Factory Follies","Mock Tournament","Atomic Culture","Racket Rally","Stats Fail"];function QJ(t){let{startDate:e,endDate:i}=t??{},{tournamentName:r=ma(aMe),ratingsParameters:n=Dr,tournamentExtensions:a,policyDefinitions:s,schedulingProfile:o,venueProfiles:l,uuids:u}=t??{},c=t?.isMock===!1?void 0:!0;if(e&&!Pn(e)||i&&!Pn(i))return{error:sr};if(t.leagueProfiles&&!Array.isArray(t.leagueProfiles)||t.eventProfiles&&!Array.isArray(t.eventProfiles)||t.drawProfiles&&!Array.isArray(t.drawProfiles))return{error:ie};if(!e){let v=new Date;e=Os(i??v),i=Os(v.setDate(v.getDate()+7))}if(!i){let v=new Date(e);i=Os(v.setDate(v.getDate()+7))}let d=WC({...t.tournamentAttributes??{},tournamentName:r,startDate:e,endDate:i,isMock:c}),p=l?.length?e$({tournamentRecord:d,venueProfiles:l,uuids:u}):[];if(a?.length&&Array.isArray(a)){let v=a.filter(w=>sl({extension:w}));v?.length&&Object.assign(d,{extensions:v,isMock:c})}if(typeof s=="object")for(let v of Object.keys(s))kp({policyDefinitions:{[v]:s[v]},tournamentRecord:d});if(!t?.leagueProfiles?.length||t.eventProfiles?.length||t.drawProfiles?.length||t.participantsProfile){let v=GJ({tournamentRecord:d,...t});if(!v.success)return v}let f=[],m=[],h=[];if(t.leagueProfiles){let v=nMe({allUniqueParticipantIds:f,tournamentRecord:d,...t,eventIds:m,venueIds:p,drawIds:h});if(v?.error)return v}if(t.drawProfiles){let v=sMe({allUniqueParticipantIds:f,ratingsParameters:n,tournamentRecord:d,...t,eventIds:m,drawIds:h});if(v?.error)return v}if(t.eventProfiles){let v=oMe({allUniqueParticipantIds:f,ratingsParameters:n,tournamentRecord:d,...t,eventIds:m,drawIds:h});if(v?.error)return v}let{scheduledRounds:g=void 0,schedulerResult:I={}}=o?lMe({...t,tournamentRecord:d}):{};return oF(),Ve({...H,tournamentRecord:d,scheduledRounds:g,schedulerResult:I,eventIds:m,venueIds:p,drawIds:h})}function sMe(t){let{tournamentRecord:e,drawProfiles:i,allUniqueParticipantIds:r,eventIds:n,drawIds:a}=t,s=0;for(let o of i){let l=zC({allUniqueParticipantIds:r,tournamentRecord:e,drawProfile:o,drawIndex:s,...t});if(l.error)return l;let{drawId:u,eventId:c,event:d,uniqueParticipantIds:p}=l;if(o?.addEvent!==!1){if(l=wv({suppressNotifications:!1,internalUse:!0,tournamentRecord:e,event:d}),l.error)return l;u&&a.push(u),n.push(c)}p?.length&&r.push(...p),s+=1}}function oMe(t){let{eventProfiles:e,allUniqueParticipantIds:i,eventIds:r,drawIds:n}=t,a=0;for(let s of e){let o=XJ({...t,eventIndex:a,eventProfile:s});if(o.error)return o;let{eventId:l,drawIds:u,uniqueParticipantIds:c}=o;u&&n.push(...u),r.push(l),c?.length&&i.push(...c),a+=1}}function lMe(t){let{schedulingProfile:e,tournamentRecord:i,autoSchedule:r,periodLength:n,scheduleCompletedMatchUps:a}=t,s=tMe({schedulingProfile:e,tournamentRecord:i});if(s.error)return s;let o=s.scheduledRounds;if(r){let{tournamentId:l}=i,u={[l]:i};return{schedulerResult:GC({scheduleCompletedMatchUps:a,tournamentRecords:u,periodLength:n}),scheduledRounds:o}}return{scheduledRounds:o}}var ZJ={};ct(ZJ,{anonymizeTournamentRecord:()=>eQ,modifyTournamentRecord:()=>iQ});function eQ({keepExtensions:t=[],anonymizeParticipantNames:e=!0,tournamentRecord:i,tournamentName:r,personIds:n=[],tournamentId:a}){if(!i)return{error:Ie};let s=Array.isArray(t)?LH.concat(...t):LH,o=k=>Array.isArray(t)?k?.extensions?.filter(F=>s.includes(F.name)):k?.extensions,l={};i.extensions=o(i);let u=a||Et();l[i.tournamentId]=u,i.tournamentId=u,i.createdAt=new Date().toISOString(),i.tournamentName=r||`Anonymized: ${Os(new Date)}`,i.isMock=!0,delete i.parentOrganisation;for(let k of i.participants||[]){k.extensions=o(k),k.onlineResources=[];let F=Et();l[k.participantId]=F,k.participantId=F}for(let k of i.participants||[])Array.isArray(k.individualParticipantIds)&&(k.individualParticipantIds=k.individualParticipantIds.map(F=>l[F]));let c=0;for(let k of i.venues||[]){k.venueAbbreviation=`V${c}`,k.extensions=o(k),k.venueName=`Venue #${c}`,k.onlineResources=[],k.addresses=[];let F=Et();l[k.venueId]=F,k.isMock=!0,c+=1;let x=0;for(let L of k.courts||[])L.courtName=`V${c}C${x}`,L.extensions=o(L),L.onlineResources=[],L.isMock=!0,x+=1}let d=1;for(let k of i.events||[]){k.extensions=o(k),k.onlineResources=[],k.isMock=!0;let F=Et();l[k.eventId]=F,k.eventId=F;let x=k.category?.categoryName||k.category?.ageCategoryCode||k.category?.ratingType||k.gender;if(k.eventName=`Event ${d} ${x}`,Array.isArray(k.entries))for(let $ of k.entries)$.participantId=l[$.participantId];for(let $ of k.drawDefinitions||[]){$.extensions=o($);let V=Et();if(l[$.drawId]=V,$.drawId=V,$.isMock=!0,Array.isArray($.entries))for(let B of $.entries)B.participantId=l[B.participantId];let _=B=>{B.extensions=o(B);let G=Et();l[B.structureId]=G,B.structureId=G;for(let j of B.positionAssignments||[])j.participantId&&(j.participantId=l[j.participantId]);for(let j of B.seedAssignments||[])j.participantId&&(j.participantId=l[j.participantId]);for(let j of B.matchUps||[]){j.isMock=!0;for(let K of j.sides||[])K.lineUp&&(K.lineUp=K.lineUp.map(({participantId:Y,collectionAssignments:X})=>({participantId:l[Y],collectionAssignments:X})))}};for(let B of $.structures||[])if(_(B),Array.isArray(B.structures))for(let G of B.structures)_(G);for(let B of $.links||[])B.source.structureId=l[B.source.structureId],B.target.structureId=l[B.target.structureId]}let{extension:L}=mt({name:Xs,element:k});Array.isArray(L?.value?.flights)&&L?.value.flights?.forEach($=>{if($.drawId=l[$.drawId],Array.isArray($.drawEntries))for(let V of $.drawEntries)V.participantId=l[V.participantId]}),d+=1}let p=i.startDate||Os(new Date),f=(i.participants||[]).filter(({participantType:k})=>k===gt),m=f.reduce((k,F)=>{let x=F.person?.sex,L=on(x);return L&&il(x)?k[L]+=1:k[ju]+=1,k},{[er]:0,[Hr]:0,[ju]:0}),h=Object.assign({},...Object.keys(m).map(k=>({[k]:jJ({category:{ageCategoryCode:"O18"},count:m[k],personExtensions:[],consideredDate:p,sex:k})?.persons||[]}))),g={[er]:0,[Hr]:0,[ju]:0},I=f.length,v=f.reduce((k,F)=>{let x=F.person?.addresses?.[0]||{},{city:L,state:$,postalCode:V}=x;return k.cities.includes(L)||k.cities.push(L),k.states.includes($)||k.states.push($),k.postalCodes.includes(V)||k.postalCodes.push(V),k},{cities:[],postalCodes:[],states:[]}),w=v.postalCodes.length,y=v.cities.length,b=v.states.length,{cities:S}=_J({count:y||I,participantsCount:I}),{states:U}=$J({count:b||I,participantsCount:I}),{postalCodes:T}=BJ({count:w||I,participantsCount:I}),P={cities:S,states:U,postalCodes:T};f.forEach((k,F)=>{let x=k?.person,L=x?.sex||ju,$=Qe(x?.birthDate)?.split("-")[0],V=g[L],_=h[L][V];if(g[L]+=1,$){let[,B,G]=_?.birthDate?.split("-")||[],j=[$,B,G].join("-");_.birthDate=j}if(x?.addresses){let B=VJ({...P,participantIndex:F,nationalityCode:_.nationalityCode});_.addresses=[B]}_.personId=n?.[F]||Et(),e?(_.standardFamilyName=_.lastName,_.standardGivenName=_.firstName,k.participantName=`${_.standardGivenName} ${_.standardFamilyName}`):(_.standardFamilyName=x?.standardFamilyName,_.standardGivenName=x?.standardGivenName),delete _.firstName,delete _.lastName,_.extensions=o(x),k.person=_,l[x?.personId]=_.personId}),(i.participants||[]).filter(({participantType:k})=>k===pt).forEach(k=>{let{individualParticipantIds:F}=k;k.participantName=uMe({individualParticipantIds:F,individualParticipants:f})});let D=(i.participants||[]).filter(({participantType:k})=>k===Lt),E=D.length,R=vP({count:E}).names;D.forEach((k,F)=>{k.participantName=R[F]});let C=(i.participants||[]).filter(({participantType:k})=>k===ja),M=C.length,N=vP({count:M,nameRoot:"Group"}).names;C.forEach((k,F)=>{k.participantName=N[F]});let{extension:A}=mt({element:i,name:Mm});Array.isArray(A?.value)&&A?.value.forEach(k=>{k.tournamentId=l[k.tournamentId],k.structureId=l[k.structureId],k.eventId=l[k.eventId],k.drawId=l[k.drawId]});let{extension:O}=mt({element:i,name:sv});return Array.isArray(O?.value)&&O?.value.forEach(k=>{k.personId=l[k.personId]}),{...H}}function uMe({individualParticipantIds:t,individualParticipants:e}){let i=e.filter(({participantId:r})=>t.includes(r)).map(({person:r})=>r?.standardFamilyName).filter(Boolean).sort().join("/");return t.length===1&&(i+="/Unknown"),i}function cMe({event:t,eventProfile:e,tournamentRecord:i,allUniqueParticipantIds:r,drawIds:n}){let{gender:a,category:s,eventType:o}=t,{drawProfiles:l,publish:u}=e,c=Di(nl)(o)&&gt||Di(ls)(o)&&pt||o;if(l){let{stageParticipantsCount:d,uniqueParticipantsCount:p,uniqueParticipantStages:f}=HJ({drawProfiles:l,category:s,gender:a}),{uniqueDrawParticipants:m=[],uniqueParticipantIds:h=[]}=f?YJ({event:{eventType:o,category:s,gender:a},uniqueParticipantsCount:p,participantsProfile:e.participantsProfile,ratingsParameters:e.ratingsParameters,tournamentRecord:i,eventProfile:e,uuids:e.uuids}):{};r.push(...h);let{stageParticipants:g}=WJ({targetParticipants:i.participants||[],allUniqueParticipantIds:r,stageParticipantsCount:d,eventParticipantType:c}),I=KJ({uniqueDrawParticipants:m,autoEntryPositions:e.autoEntryPositions,stageParticipants:g,tournamentRecord:i,drawProfiles:l,category:s,gender:a,event:t});if(I.error||(I=qJ({matchUpStatusProfile:e.matchUpStatusProfile,completeAllMatchUps:e.completeAllMatchUps,randomWinningSide:e.randomWinningSide,tournamentRecord:i,drawProfiles:l,isMock:e.isMock,event:t}),I.error))return I;n.push(...I.drawIds)}return u&&Uv({tournamentRecord:i,event:t}),H}function tQ(t,e){return t?.find((i,r)=>e.eventIndex!==void 0&&r===e.eventIndex||e.eventName&&i.eventName===e.eventName||e.eventId&&i.eventId===e.eventId)}function dMe({event:t,eventProfile:e,tournamentRecord:i,allUniqueParticipantIds:r,drawIds:n,params:a}){return cMe({event:t,eventProfile:{...e,...a},tournamentRecord:i,allUniqueParticipantIds:r,drawIds:n})}function pMe({eventProfile:t,tournamentRecord:e,allUniqueParticipantIds:i,eventIds:r,drawIds:n,params:a,eventIndex:s}){let o=XJ({startDate:e.startDate,allUniqueParticipantIds:i,matchUpStatusProfile:a.matchUpStatusProfile,participantsProfile:a.participantsProfile,completeAllMatchUps:a.completeAllMatchUps,autoEntryPositions:a.autoEntryPositions,randomWinningSide:a.randomWinningSide,ratingsParameters:t.ratingsParameters,tournamentRecord:e,eventProfile:t,eventIndex:s,uuids:a.uuids});if(o.error)return o;let{eventId:l,drawIds:u,uniqueParticipantIds:c}=o;return u&&n.push(...u),r.push(l),c?.length&&i.push(...c),{eventIndexIncrement:1}}function fMe({eventProfiles:t,tournamentRecord:e,allUniqueParticipantIds:i,eventIds:r,drawIds:n,params:a}){let s=e.events?.length||0;for(let o of t){let l=tQ(e.events,o);if(l){let u=dMe({event:l,eventProfile:o,tournamentRecord:e,allUniqueParticipantIds:i,drawIds:n,params:a});if(u?.error)return u}else{let u=pMe({eventProfile:o,tournamentRecord:e,allUniqueParticipantIds:i,eventIds:r,drawIds:n,params:a,eventIndex:s});if(u?.error)return u;s+=u?.eventIndexIncrement||1}}return H}function mMe({drawProfiles:t,tournamentRecord:e,allUniqueParticipantIds:i,eventIds:r,drawIds:n,params:a}){let s=(e.events||[]).flatMap(o=>o.drawDefinitions?.map(()=>1)||[]).reduce((o,l)=>o+l,0);for(let o of t){let l=zC({startDate:e.startDate,allUniqueParticipantIds:i,matchUpStatusProfile:a.matchUpStatusProfile,participantsProfile:a.participantsProfile,completeAllMatchUps:a.completeAllMatchUps,autoEntryPositions:a.autoEntryPositions,hydrateCollections:a.hydrateCollections,randomWinningSide:a.randomWinningSide,ratingsParameters:a.ratingsParameters,tournamentRecord:e,drawProfile:o,drawIndex:s,uuids:a.uuids});if(l.error)return l;let{drawId:u,eventId:c,event:d,uniqueParticipantIds:p}=l;if(l=wv({tournamentRecord:e,event:d,internalUse:!0}),l.error)return l;u&&n.push(u),r.push(c),p?.length&&i.push(...p),s+=1}return H}function hMe({schedulingProfile:t,autoSchedule:e,periodLength:i,tournamentRecord:r}){let n=[],a={};if(t?.length){let s={[r.tournamentId]:r},o=yv({tournamentRecords:s,schedulingProfile:t});if(o.error)return o;if(e){let{tournamentId:l}=r,u={[l]:r};a=GC({tournamentRecords:u,periodLength:i})}}return{scheduledRounds:n,schedulerResult:a}}function iQ(t){let{participantsProfile:e={},schedulingProfile:i,tournamentRecord:r,autoSchedule:n,eventProfiles:a,periodLength:s,venueProfiles:o,drawProfiles:l,uuids:u}=t;if(!r)return{error:Ie};let c=[],d=[],p=[];a?.forEach(w=>{let y=tQ(r.events,w);y?.gender&&(w.gender=y.gender)});let f=r.participants?.length||void 0;f&&e?.idPrefix&&(e.idPrefix=`${e.idPrefix}-${f}`);let m=GJ({startDate:r.startDate,participantsProfile:e,tournamentRecord:r,eventProfiles:a,drawProfiles:l,uuids:u});if(!m.success)return m;if(a){let w=fMe({eventProfiles:a,tournamentRecord:r,allUniqueParticipantIds:c,eventIds:d,drawIds:p,params:t});if(w.error)return w}if(l){let w=mMe({drawProfiles:l,tournamentRecord:r,allUniqueParticipantIds:c,eventIds:d,drawIds:p,params:t});if(w.error)return w}let h=o?.length?e$({tournamentRecord:r,venueProfiles:o}):[],g=hMe({tournamentRecord:r,schedulingProfile:i,autoSchedule:n,periodLength:s});if(g.error)return g;let{scheduledRounds:I,schedulerResult:v}=g;return{totalParticipantsCount:r.participants.length,scheduledRounds:I,schedulerResult:v,...H,eventIds:d,venueIds:h,drawIds:p}}var rQ={};ct(rQ,{addDynamicRatings:()=>p0,addIndividualParticipantIds:()=>FC,addParticipant:()=>ul,addParticipants:()=>Zs,addPenalty:()=>TQ,addPersonRequests:()=>uQ,addPersons:()=>DQ,createGroupParticipant:()=>hQ,createTeamsFromParticipantAttributes:()=>K_,deleteParticipants:()=>yh,filterParticipants:()=>pS,findParticipant:()=>mQ,getCompetitionParticipants:()=>$0,getPairedParticipant:()=>Qs,getParticipantEventDetails:()=>B0,getParticipantMembership:()=>V0,getParticipantScaleItem:()=>Am,getParticipantSchedules:()=>j0,getParticipantSignInStatus:()=>G0,getParticipantTimeItem:()=>tL,getParticipants:()=>Ei,getScaleValues:()=>av,mergeParticipants:()=>UQ,modifyIndividualParticipantIds:()=>cQ,modifyParticipant:()=>LC,modifyParticipantName:()=>gQ,modifyParticipantOtherName:()=>pQ,modifyParticipantsSignInStatus:()=>dQ,modifyPenalty:()=>wQ,modifyPersonRequests:()=>oQ,mutate:()=>nQ,participantScaleItem:()=>Hl,query:()=>cX,regenerateParticipantNames:()=>fQ,removeIndividualParticipantIds:()=>DL,removeParticipantIdsFromAllTeams:()=>BR,removePenalty:()=>yQ,removePersonRequests:()=>lQ,removeRatings:()=>vQ,scaledTeamAssignment:()=>IQ,setParticipantScaleItem:()=>Iv,setParticipantScaleItems:()=>n9,validateLineUp:()=>jR});var nQ={};ct(nQ,{addDynamicRatings:()=>p0,addIndividualParticipantIds:()=>FC,addParticipant:()=>ul,addParticipants:()=>Zs,addPenalty:()=>TQ,addPersonRequests:()=>uQ,addPersons:()=>DQ,createGroupParticipant:()=>hQ,createTeamsFromParticipantAttributes:()=>K_,deleteParticipants:()=>yh,findParticipant:()=>mQ,mergeParticipants:()=>UQ,modifyIndividualParticipantIds:()=>cQ,modifyParticipant:()=>LC,modifyParticipantName:()=>gQ,modifyParticipantOtherName:()=>pQ,modifyParticipantsSignInStatus:()=>dQ,modifyPenalty:()=>wQ,modifyPersonRequests:()=>oQ,regenerateParticipantNames:()=>fQ,removeIndividualParticipantIds:()=>DL,removeParticipantIdsFromAllTeams:()=>BR,removePenalty:()=>yQ,removePersonRequests:()=>lQ,removeRatings:()=>vQ,scaledTeamAssignment:()=>IQ,setParticipantScaleItem:()=>Iv,setParticipantScaleItems:()=>n9});function aQ(t=0){(typeof t!="number"||isNaN(t))&&(t=0);let e=new Date;return e.setHours(e.getHours()+t),e.getTime().toString(36).slice(-6).toUpperCase()}function sQ({personRequests:t,personId:e,requests:i}){t[e]||(t[e]=[]);let r=i.filter(({requestType:n})=>n).map(n=>{let{date:a,startTime:s,endTime:o}=n;return n.requestType===_S&&(a=Qe(a),s=ci(s),o=ci(o),a&&s&&o)?{date:a,startTime:s,endTime:o,requestType:n.requestType}:n}).filter(Boolean);for(let n of r)n.requestId=aQ(),t[e].push(n);return{mergeCount:r.length}}function t$(t){let{tournamentRecords:e,personRequests:i}=t,r=Ge(t,[{[cn]:!0}]);if(r.error)return r;if(!i)return{...H};let n=Object.values(e);for(let a of n){let s=a.participants??[],o=[];for(let l of Object.keys(i))if(fd({tournamentParticipants:s,personId:l})){let u=i[l];u.length&&o.push({personId:l,requests:u})}Object.keys(o).length&&xt({element:a,extension:{value:o,name:sv}})}return{...H}}function oQ(t){let{tournamentRecords:e,requests:i,personId:r}=t,n=Ge(t,[{[cn]:!0},{requests:!0,[zn]:an,[Fa]:ie}]);if(n.error)return n;let a=i.map(({requestId:u})=>u).filter(Boolean),{personRequests:s}=pf({tournamentRecords:e}),o=u=>{s&&(s[u]=s[u].map(c=>{if(!a.includes(c.requestId))return c;let d=i.find(p=>p.requestId===c.requestId);if(d.requestType)return Object.assign(c,d)}).filter(Boolean))};if(r&&s?.[r])o(r);else if(s)for(let u of Object.keys(s))o(u);let l=i.filter(u=>!u.requestId);return l.length&&sQ({personRequests:s,personId:r,requests:l}),t$({tournamentRecords:e,personRequests:s})}function lQ(t){let{tournamentRecords:e,requestType:i,requestId:r,personId:n,date:a}=t,s=Ge(t,[{[cn]:!0}]);if(s.error)return s;let{personRequests:o}=pf({tournamentRecords:e}),l=c=>{o&&(o[c]=o[c].filter(d=>(!i||d.requestType!==i)&&(!r||d.requestId!==r)&&(!a||d.date!==a)),o?.[c]?.length||delete o[c])},u=!i&&!r&&!n&&!a;if(!u){if(n&&o?.[n])l(n);else if(o)for(let c of Object.keys(o))l(c)}return u||!o||!Object.keys(o).length?En({name:sv,tournamentRecords:e,discover:!0}):t$({tournamentRecords:e,personRequests:o})}function uQ(t){let{tournamentRecords:e,personId:i,requests:r}=t,n=Ge(t,[{[cn]:!0,[eye]:!0},{requests:!0,[zn]:an,[Fa]:ie}]);if(n.error)return n;let{personRequests:a}=pf({tournamentRecords:e}),{mergeCount:s}=sQ({personRequests:a,personId:i,requests:r});return s&&a?t$({tournamentRecords:e,personRequests:a}):{error:ie}}function cQ({individualParticipantIds:t,groupingParticipantId:e,tournamentRecord:i}){let r="modifyIndividualParticipantIds";if(!i)return z({result:{error:Ie},stack:r});if(!e||!t)return z({result:{error:Xe},stack:r});let n=i.participants||[],a=n.find(f=>f.participantId===e);if(!a)return z({result:{error:Vi},stack:r});if(![Lt,ja].includes(a.participantType))return z({result:{error:Do},context:{participantType:a.participantType},stack:r});let s=t.filter(f=>n.find(m=>m.participantId===f)?.participantType!==gt);if(s.length)return z({result:{error:ga,invalidParticipantIds:s},stack:r});let o=a.individualParticipantIds||[],l=t.filter(f=>!o.includes(f)),u=o.filter(f=>!t.includes(f)),c=FC({individualParticipantIds:l,groupingParticipantId:e,tournamentRecord:i});if(c.error)return z({result:c,stack:r});let d=DL({individualParticipantIds:u,groupingParticipantId:e,tournamentRecord:i});if(d.error)return z({result:d,stack:r});let{topics:p}=gs();if(p.includes(en)){let f=n.find(({participantId:m})=>m===e);at({topic:en,payload:{tournamentId:i.tournamentId,participants:[f]}})}return{...c,...d}}function dQ({tournamentRecord:t,participantIds:e,signInState:i}){if(!t)return{error:Ie};if(!Array.isArray(e))return{error:Xe};if(![Ub,bK].includes(i))return{error:ie,signInState:i};let r=t.participants||[];if(!r.length)return{error:Aw};let n=r.map(vt),a=e.filter(u=>!n.includes(u));if(a.length)return{error:ie,context:{invalidParticipantIds:a}};let s=[],o=new Date().toISOString();for(let u of r){let{participantId:c}=u;if(e.includes(c)){let d=ZL({duplicateValues:!1,tournamentRecord:t,participantId:c,timeItem:{itemType:Yw,itemValue:i,createdAt:o}});if(d.error)return d;s.push(u)}}let{topics:l}=gs();return s.length&&l.includes(en)&&at({topic:en,payload:{tournamentId:t.tournamentId,participants:s}}),{...H}}function pQ({tournamentRecord:t,participantId:e,participantOtherName:i}){if(!t)return{error:Ie};if(!e)return{error:lr};let{participant:r}=$d({tournamentRecord:t,participantId:e});if(!r)return{error:Vi};r.participantOtherName=i;let{topics:n}=gs();return n.includes(en)&&at({topic:en,payload:{tournamentId:t.tournamentId,participants:[r]}}),{...H}}function xW({personFormat:t,person:e}){let i=h=>h.replace(/\W/g,""),r=h=>/^[a-z]*$/.test(i(h)),n=h=>/^[A-Z]*$/.test(i(h)),a=h=>/^[LAST]{4}/.test(i(h)),s=h=>h.toLowerCase().indexOf("l")<h.toLowerCase().indexOf("f"),o=h=>h.indexOf(",")>=0,l=h=>h.toLowerCase().indexOf("f.")>=0,u=h=>h.toLowerCase().indexOf("f")<0,c=h=>h.indexOf(" ")>0;if(!e)return;let d=c(t)?" ":"",p=yO(e?.standardGivenName??""),f=yO(e?.standardFamilyName??"");if(!t)return`${p}${d}${f}`;l(t)&&!o(t)&&!s(t)&&(p=`${p[0]}.`),r(t)?(p=p.toLowerCase(),f=f.toLowerCase()):n(t)?(p=p.toUpperCase(),f=f.toUpperCase()):a(t)&&(f=f.toUpperCase());let m=`${p}${d}${f}`;return u(t)?m=f:s(t)&&(o(t)?m=`${f},${d}${p}`:m=`${f}${d}${p}`),m}function gMe({participantMap:t,participant:e,formats:i}){let{participantType:r,individualParticipantIds:n,person:a}=e,s=r&&i[r];if(r!==_n&&s){let{personFormat:o,doublesJoiner:l}=s;r===gt&&(e.participantName=xW({person:a,personFormat:o})),r===pt&&(e.participantName=n?.map(u=>{let c=t[u]?.person;return xW({person:c,personFormat:o})}).filter(Boolean).join(l??"/"))}}function fQ({tournamentRecord:t,formats:e}){if(!t)return{error:Ie};if(!bt(e))return{error:Xe};let i=t.participants??[],r=t6(i,"participantId");for(let n of i)gMe({participant:n,participantMap:r,formats:e});return{...H}}function mQ(t){let{tournamentRecord:e,policyDefinitions:i,contextProfile:r,participantId:n,personId:a}=t,s=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(typeof n!="string"&&typeof a!="string")return{error:Xe,stack:"publicFindParticipant"};let o,l;for(let u of Object.values(s)){l=u.tournamentId;let c=u.participants||[];if(o=fd({tournamentParticipants:c,internalUse:!0,policyDefinitions:i,contextProfile:r,participantId:n,personId:a}),o)break}return{participant:o,tournamentId:l,...H}}function hQ({individualParticipantIds:t=[],participantRoleResponsibilities:e,participantRole:i=E7,tournamentRecord:r,participantId:n,groupName:a}){if(!r)return{error:Ie};if(!a)return{error:Xe,info:"Missing groupName"};if(!Array.isArray(t))return{info:"Invalid individualParticipantIds",error:ie};let s=(Ei({participantFilters:{participantTypes:[gt]},tournamentRecord:r}).participants??[]).map(c=>c.participantId);for(let c of t)if(!s.includes(c))return{error:Do,participantId:c};let o=Ve({participantId:n||Et(),participantRoleResponsibilities:e,participantName:a,individualParticipantIds:t,participantType:ja,participantRole:i}),l=ul({participant:o,tournamentRecord:r});if(l.error)return l;let{topics:u}=gs();return u.includes(md)&&at({topic:md,payload:{tournamentId:r.tournamentId,participants:[o]}}),{...H,participant:ke(o)}}function gQ({tournamentRecord:t,participantName:e,participantId:i}){if(!t)return{error:Ie};if(!i)return{error:lr};if(!e)return{error:Xe,info:"Missing participantName"};let{participant:r}=$d({tournamentRecord:t,participantId:i});if(!r)return{error:Vi};r.participantName=e;let{topics:n}=gs();return n.includes(en)&&at({topic:en,payload:{tournamentId:t.tournamentId,participants:[r]}}),{...H}}function IQ({clearExistingAssignments:t=!0,individualParticipantIds:e,reverseAssignmentOrder:i,initialTeamIndex:r=0,scaledParticipants:n=[],teamParticipantIds:a,tournamentRecord:s,scaleAttributes:o,teamNameBase:l,teamsCount:u,eventId:c,event:d}){if(!s)return{error:Ie};if(!Array.isArray(a)&&!ot(u)&&!c||!ot(r)||n&&!Array.isArray(n)||o&&(typeof o!="object"||!Object.keys(o).length))return{error:ie};if(!o&&!n.length||!n&&!(e&&o))return{error:Xe,info:"Missing scaling details"};if(c&&!a){if(d?.eventType!==ya)return{error:Zl};a=d?.entries?.filter(({entryStatus:I})=>I===aa).map(vt)}if(!a?.length&&!u)return{info:"Missing teamParticipantIds or teamsCount",error:Xe};let p=e??n.map(({participantId:I})=>I);i&&(a?.reverse(),r+=1),r>(a?.length||0)-1&&(r=0);let f=a?.slice(r).concat(...a.slice(0,r))??[],m=[];for(let I of s.participants??[]){let{participantId:v,participantType:w}=I;if(f.includes(v)){if(w!==_n)return{error:Do,participant:I};m.push(I)}}if(u&&m.length<u){let I=u-(m?.length||0),v=l??"Team",w=Re(0,I).map(U=>({participantName:`${v} ${U+1}`,participantType:_n,participantRole:Kr})),{participants:y=[]}=Zs({participants:w,returnParticipants:!0,tournamentRecord:s}),b=y.map(vt),S=s.participants?.filter(({participantId:U})=>b.includes(U))??[];m.push(...S)}if(!m.length)return{error:eF};if(t)for(let I of m)I.individualParticipantIds=[];else{let I=m.map(v=>v).flat();e?.length?p=p.filter(v=>!I.includes(v)):n=n?.filter(({participantId:v})=>!I.includes(v))}if(!e?.length&&!n?.length)return{error:XE,info:"Nothing to be done"};if(!n.length){for(let I of s.participants??[]){let{participantId:v,participantType:w}=I;if(!p.includes(v))continue;if(w!==gt)return{error:Do,participant:I};let y=Hl({scaleAttributes:o,participant:I})?.scaleItem,b=o?.accessor?y?.scaleValue?.[o?.accessor]:y?.scaleValue,S={participantId:v,scaleValue:b};n.push(S)}if(!n.length)return{error:Vi}}n.sort((I,v)=>o?.sortOrder?(v?.scaleValue||0)-(I?.scaleValue||0):(I?.scaleValue||1/0)-(v?.scaleValue||1/0));for(let I of n)if(!I.participantId)return{error:ie,scaledParticipant:I};let h=0;for(;h<n.length;){for(let I of m){if(h+1>n.length)break;let v=n[h];I.individualParticipantIds.push(v.participantId),h++}m.reverse()}let g=m.map(vt);for(let I of s.events??[]){if(I.eventType!==ya)continue;let v=(I.entries??[]).filter(w=>g.includes(w.participantId));for(let w of v){let y=w.participantId,b=m.find(U=>U.participantId===y)?.individualParticipantIds;I.entries=(I.entries??[]).filter(U=>!b.includes(U.participantId)),(I.drawDefinitions??[]).forEach(U=>{U.entries=(U.entries??[]).filter(T=>!b.includes(T.participantId))});let{flightProfile:S}=$i({event:I});(S?.flights||[]).forEach(U=>{U.drawEntries=(U.drawEntries||[]).filter(T=>!b.includes(T.participantId))})}}return{...H,scaledParticipants:n}}function vQ(t){let e=Ge(t,[{[mr]:!0,[PF]:!0},{ratingType:!1,[Wr]:s=>Dr[s]}]);if(e.error)return e;let i=`${t.ratingType}.${MF}`,r=t.asDynamic?i:t.ratingType,n=[pd,od,t.eventType,r].join("."),a=t.tournamentRecord.participants??[];for(let s of a)s.timeItems&&(s.timeItems=s.timeItems.filter(o=>o.itemType!==n));return{...H}}function yQ(t){let{tournamentRecords:e}=t;if(typeof e!="object"||!Object.keys(e).length)return{error:Ci};for(let i of Object.values(e)){let r=IMe({...t,tournamentRecord:i});if(r.error&&r.error!==Xg)return r}return{...H}}function IMe({tournamentRecord:t,penaltyId:e}){if(!t)return{error:Ie};if(!e)return{error:K1};let i=t?.participants??[],r=[],n=!1,a;return i.forEach(s=>{let o=!1;s.penalties=(s.penalties??[]).filter(l=>(l.penaltyId===e&&(o=!0,n||(a=l,n=!0)),o&&r.push(s),l.penaltyId!==e))}),a&&at({topic:en,payload:{tournamentId:t.tournamentId,participants:r}}),a?{...H,penalty:a}:{error:Xg}}var vMe=({penaltyId:t=Et()}={})=>({refereeParticipantId:void 0,penaltyCode:void 0,penaltyType:void 0,extensions:void 0,matchUpId:void 0,createdAt:void 0,issuedAt:void 0,notes:void 0,penaltyId:t}),bQ=vMe;function wQ(t){let{tournamentRecords:e}=t;if(typeof e!="object"||!Object.keys(e).length)return{error:Ci};for(let i of Object.values(e)){let r=yMe({...t,tournamentRecord:i});if(r.error&&r.error!==Xg||r.success)return r}return{error:Xg}}function yMe({tournamentRecord:t,modifications:e,penaltyId:i}){if(!t)return{error:Ie};if(!e)return{error:ie,modifications:e};if(!i)return{error:K1};let r=t?.participants??[],n=Object.keys(bQ()).filter(l=>l!=="penaltyId"),a=Object.keys(e).filter(l=>n.includes(l));if(!a.length)return{error:JE};let s,o=[];return r.forEach(l=>{let u=!1;l.penalties=(l.penalties??[]).map(c=>(c.penaltyId===i&&(u=!0,a.forEach(d=>Object.assign(c,{[d]:e[d]})),s||(s=c)),c)),u&&o.push(l)}),s&&at({topic:en,payload:{tournamentId:t.tournamentId,participants:o}}),s?{...H,penalty:s}:{error:Xg}}function SQ(t,e,i){return!t&&e?e:t&&!e||typeof t!="object"||typeof e!="object"?t:rt(Object.keys(t).concat(Object.keys(e))).reduce((r,n)=>{if(!e[n])r[n]=t[n];else if(!t[n])r[n]=e[n];else if(typeof t[n]!=typeof e[n])r[n]=e[n];else if(Array.isArray(t[n]))if(i===!0||Array.isArray(i)&&i.includes(n)){let a=rt(t[n].map(s=>JSON.stringify(s)).concat(e[n].map(s=>JSON.stringify(s)))).map(s=>JSON.parse(s));r[n]=a}else r[n]=e[n];else typeof t[n]=="object"?r[n]=SQ(t[n],e[n],i):r[n]=e[n];return r},{})}function UQ({participants:t=[],tournamentRecord:e,arraysToMerge:i}){if(!e)return{error:Ie};e.participants||(e.participants=[]);let r=t.filter(ba(su)).map(u=>({[u.participantId]:u})),n=Object.assign({},...r),a=[];e.participants=e.participants.map(u=>{if(n[u.participantId]){let c=SQ(u,n[u.participantId],i);return a.push(c),c}return u});let s=e.participants.map(ba(su))||[],o=t.filter(({participantId:u})=>!s.includes(u)),{topics:l}=gs();return o.length&&(e.participants=e.participants.concat(...o),l.includes(md)&&at({topic:md,payload:{participants:o}})),a.length&&l.includes(en)&&at({topic:en,payload:{tournamentId:e.tournamentId,participants:a}}),{modifiedParticipantsCount:a.length,newParticipantsCount:o.length,...H}}function TQ(t){let{tournamentRecord:e,participantIds:i}=t,r=t.tournamentRecords??(e&&{[e.tournamentId]:e})??{},n;for(let a of Object.values(r)){let s=(Ei({tournamentRecord:a}).participants??[])?.map(vt).filter(o=>i.includes(o));s.length&&(n=bMe({...t,penaltyId:t.penaltyId??n,tournamentRecord:a,participantIds:s}).penaltyId)}return n?{...H,penaltyId:n}:{error:Vi}}function bMe({refereeParticipantId:t,tournamentRecord:e,participantIds:i,penaltyCode:r,penaltyType:n,extensions:a,penaltyId:s,matchUpId:o,issuedAt:l,notes:u}){if(!e)return{error:Ie};if(!i)return{error:lr};if(!n)return{error:a4};let c=(e?.participants??[]).filter(f=>i.includes(f.participantId));if(!c.length)return{error:Vi};let d=new Date().toISOString(),p=Object.assign(bQ({penaltyId:s}),{refereeParticipantId:t,penaltyCode:r,penaltyType:n,matchUpId:o,createdAt:d,issuedAt:l,notes:u});return Array.isArray(a)&&a.forEach(f=>xt({element:p,extension:f})),c.forEach(f=>{f.penalties??=[],f.penalties.push(p)}),at({topic:en,payload:{tournamentId:e.tournamentId,participants:c}}),{...H,penaltyId:p.penaltyId}}function DQ({participantRole:t=Kr,tournamentRecord:e,persons:i}){if(!e)return{error:Ie};if(!Array.isArray(i))return{error:ie};if(!Object.keys(TL).includes(t))return{error:Y6};let r=new Set((e.participants||[]).map(({person:m})=>m?.personId).filter(Boolean)),n=[],a=i.filter(m=>m&&(!m.personId||!r.has(m.personId))).map(m=>(m.personId||(m.personId=Et()),n.push(m.personId),m)),s=(m,h)=>Object.assign({},...Object.keys(m).filter(g=>!h.includes(g)).map(g=>({[g]:m[g]}))),o=a.map(m=>Ve({extensions:m.participantExtensions,timeItems:m.participantTimeItems,participantType:gt,participantRole:t,person:s(m,["participantExtensions","participantTimeItems","pairedPersons"])})),l=0,u,c=Zs({participants:o,tournamentRecord:e});if(c.error)return c;u=c.addedCount||0;let d=[],p=Ei({participantFilters:{participantTypes:[gt]},tournamentRecord:e})?.participants??[];if(t===Kr&&i.filter(({pairedPersons:m})=>m).forEach(({personId:m,pairedPersons:h})=>{Array.isArray(h)&&h.forEach(g=>{let I=[m,g.personId].map(v=>fd({tournamentParticipants:p,personId:v})).filter(Boolean);if(I.length===2){let v=I.map(vt);d.push(Ve({extensions:g.participantExtensions,timeItems:g.timeItems,participantRole:Kr,individualParticipantIds:v,participantType:pt}))}})}),d.length){if(c=Zs({participants:d,tournamentRecord:e}),c.error)return c;l=c.addedCount||0}let f=u+l;return{...H,addedCount:f,newPersonIds:n}}var PQ={};ct(PQ,{bulkUpdatePublishedEventIds:()=>Q0,getAllEventData:()=>Z0,getCourtInfo:()=>xR,getDrawData:()=>ZR,getEventData:()=>PS,getEventPublishStatus:()=>za,getPublishState:()=>vh,getTournamentPublishStatus:()=>dS,getVenueData:()=>oI,mutate:()=>EQ,publishEvent:()=>Uv,publishEventSeeding:()=>RQ,publishOrderOfPlay:()=>kQ,publishParticipants:()=>AQ,query:()=>IX,setEventDisplay:()=>NC,unPublishEvent:()=>OQ,unPublishEventSeeding:()=>CQ,unPublishOrderOfPlay:()=>NQ,unPublishParticipants:()=>MQ});var EQ={};ct(EQ,{publishEvent:()=>Uv,publishEventSeeding:()=>RQ,publishOrderOfPlay:()=>kQ,publishParticipants:()=>AQ,setEventDisplay:()=>NC,unPublishEvent:()=>OQ,unPublishEventSeeding:()=>CQ,unPublishOrderOfPlay:()=>NQ,unPublishParticipants:()=>MQ});function RQ({removePriorValues:t=!0,stageSeedingScaleNames:e,seedingScaleNames:i,tournamentRecord:r,status:n=Ha,drawIds:a=[],event:s}){if(!r)return{error:Ie};if(!s)return{error:li};let o=za({event:s,status:n}),l=(o?.seeding?.seedingScaleNames||i)&&{...o?.seeding?.seedingScaleNames,...i},u=(o?.seeding?.stageSeedingScaleNames||e)&&{...o?.seeding?.stageSeedingScaleNames,...e},c=Ve({stageSeedingScaleNames:u,seedingScaleNames:l,published:!0,drawIds:a});return Sv({statusObject:{seeding:c},removePriorValues:t,status:n,event:s}),at({topic:hK,payload:{tournamentId:r.tournamentId,eventId:s.eventId,drawIds:a}}),{...H}}function CQ({removePriorValues:t=!0,seedingScaleNames:e,tournamentRecord:i,status:r=Ha,drawIds:n,stages:a,event:s}){if(!i)return{error:Ie};if(!s)return{error:li};let o=za({event:s});if(o){let l=o.seeding;if(Array.isArray(a)&&l.stageSeedingScaleNames)for(let u of a)l.stageSeedingScaleNames[u]&&delete l.stageSeedingScaleNames[u];Array.isArray(e)&&l?.seedingScaleNames&&(l.seedingScaleNames=l.seedingScaleNames.filter(u=>!e.includes(u))),Array.isArray(n)&&l?.drawIds&&(l.drawIds=l.drawIds.filter(u=>!n.includes(u))),(!Object.values(l.stageSeedingScaleNames??{}).length&&!l.seedingScaleNames?.length&&!l.drawIds?.length||!a&&!e&&!n?.length)&&(delete l.stageSeedingScaleNames,delete l.seedingScaleNames,delete l.drawIds,l.published=!1),Sv({statusObject:{seeding:l},removePriorValues:t,status:r,event:s})}return at({topic:JF,payload:{tournamentId:i.tournamentId,eventId:s.eventId}}),{...H}}function MQ(t){let e=Is(t);if(!Object.keys(e).length)return{error:Ci};for(let i of Object.values(e)){let r=wMe({tournamentRecord:i,...t});if(r.error)return r}return{...H}}function wMe({removePriorValues:t=!0,tournamentRecord:e,status:i=Ha}){if(!e)return{error:Ie};let r=`${Bd}.${Vd}`,{timeItem:n}=vs({element:e,itemType:r}),a=n?.itemValue||{[i]:{}};return a[i]&&delete a[i].participants,Dl({timeItem:{itemValue:a,itemType:r},element:e,removePriorValues:t}),at({payload:{tournamentId:e.tournamentId},topic:Cye}),{...H}}function NQ(t){let e=Is(t);if(!Object.keys(e).length)return{error:Ci};for(let i of Object.values(e)){let r=SMe({tournamentRecord:i,...t});if(r.error)return r}return{...H}}function SMe({removePriorValues:t=!0,tournamentRecord:e,status:i=Ha}){if(!e)return{error:Ie};let r=`${Bd}.${Vd}`,{timeItem:n}=vs({element:e,itemType:r}),a=n?.itemValue||{[i]:{}};return a[i]&&delete a[i].orderOfPlay,Dl({timeItem:{itemValue:a,itemType:r},element:e,removePriorValues:t}),at({topic:QF,payload:{tournamentId:e.tournamentId}}),{...H}}function AQ(t){let e=Is(t);if(!Object.keys(e).length)return{error:Ci};for(let i of Object.values(e)){let r=UMe({tournamentRecord:i,...t});if(r.error)return r}return{...H}}function UMe({removePriorValues:t,tournamentRecord:e,status:i=Ha,embargo:r}){if(!e)return{error:Ie};let n=`${Bd}.${Vd}`,{timeItem:a}=vs({element:e,itemType:n}),s=a?.itemValue||{[i]:{}},o={published:!0};return r&&!id(r)?{error:Rg}:(r&&(o.embargo=r),s[i].participants=o,Dl({timeItem:{itemValue:s,itemType:n},element:e,removePriorValues:t}),at({payload:{tournamentId:e.tournamentId},topic:IK}),{...H})}function kQ(t){let e=Is(t);if(!Object.keys(e).length)return{error:Ci};for(let i of Object.values(e)){let r=TMe({tournamentRecord:i,...t});if(r.error)return r}return{...H}}function TMe({scheduledDates:t=[],removePriorValues:e,tournamentRecord:i,status:r=Ha,eventIds:n=[],embargo:a}){if(!i)return{error:Ie};let s=`${Bd}.${Vd}`,{timeItem:o}=vs({element:i,itemType:s}),l=o?.itemValue||{[r]:{}},u={published:!0,scheduledDates:t,eventIds:n};return a&&!id(a)?{error:Rg}:(a&&(u.embargo=a),l[r].orderOfPlay=u,Dl({timeItem:{itemValue:l,itemType:s},element:i,removePriorValues:e}),at({topic:gK,payload:{tournamentId:i.tournamentId,scheduledDates:t,eventIds:n}}),{...H})}function OQ({removePriorValues:t=!0,tournamentRecord:e,status:i=Ha,event:r}){if(!e)return{error:Ie};if(!r)return{error:li};let n=`${Bd}.${Vd}`,{timeItem:a}=Kw({itemType:n,event:r}),s=a?.itemValue||{[i]:{}};return delete s[i].structureIds,delete s[i].drawDetails,delete s[i].drawIds,Uh({event:r,timeItem:{itemValue:s,itemType:n},removePriorValues:t}),Sv({statusObject:{structureIds:void 0,drawIds:void 0,seeding:void 0},removePriorValues:t,status:i,event:r}),at({topic:XF,payload:{tournamentId:e.tournamentId,eventId:r.eventId}}),{eventId:r.eventId,...H}}var i$={};ct(i$,{applyTournamentRankingPoints:()=>$Q,generateRankingList:()=>FQ,getAwardPoints:()=>fP,getAwardProfile:()=>X0,getParticipantPoints:()=>LQ,getQualityWinPoints:()=>K0,getTournamentPoints:()=>vv,mutate:()=>_Q,query:()=>xQ});var xQ={};ct(xQ,{generateRankingList:()=>FQ,getAwardPoints:()=>fP,getAwardProfile:()=>X0,getParticipantPoints:()=>LQ,getQualityWinPoints:()=>K0,getTournamentPoints:()=>vv});function bP({awards:t,pointComponents:e,bestOfCount:i,maxResultsPerLevel:r,mandatoryRules:n}){let a=t.map(d=>{let p=0;for(let f of e)p+=typeof d[f]=="number"?d[f]:0;return{award:d,value:p}});a.sort((d,p)=>p.value-d.value);let s=a,o=[];if(r){let d={};s=[];for(let p of a){let f=p.award.level;f===void 0||!r[f]?s.push(p):(d[f]=(d[f]||0)+1,d[f]<=r[f]?s.push(p):o.push(p))}}if(n?.length)return DMe(s,o,i,n);let l=i>0?s.slice(0,i):s,u=[...i>0?s.slice(i):[],...o],c=l.reduce((d,p)=>d+p.value,0);return{counting:l,dropped:u,bucketTotal:c}}function DMe(t,e,i,r){let n=new Set;for(let p of r){let f=new Set(p.levels),m=[];for(let g=0;g<t.length;g++){let I=t[g].award.level;I!==void 0&&f.has(I)&&m.push(g)}let h=p.bestOfCount?m.slice(0,p.bestOfCount):m;for(let g of h)n.add(g)}let a=[],s=[];for(let p=0;p<t.length;p++)n.has(p)?a.push(t[p]):s.push(t[p]);let o,l;if(i>0){let p=Math.max(0,i-a.length);o=s.slice(0,p),l=s.slice(p)}else o=s,l=[];let u=[...a,...o],c=[...l,...e],d=u.reduce((p,f)=>p+f.value,0);return{counting:u,dropped:c,bucketTotal:d}}function FQ({pointAwards:t,aggregationRules:e={},categoryFilter:i,asOfDate:r}){let{rollingPeriodDays:n,countingBuckets:a,tiebreakCriteria:s=[],minCountableResults:o=0,maxResultsPerLevel:l,bestOfCount:u}=e,c=t;if(i&&(c=c.filter(m=>{if(i.ageCategoryCodes?.length){let h=m.category?.ageCategoryCode;if(!h||!i.ageCategoryCodes.includes(h))return!1}if(i.genders?.length){let h=m.category?.gender||m.gender;if(!h||!i.genders.includes(h))return!1}return!(i.eventTypes?.length&&(!m.eventType||!i.eventTypes.includes(m.eventType)))})),n&&r){let m=new Date(r);m.setDate(m.getDate()-n);let h=m.getTime();c=c.filter(g=>g.endDate?new Date(g.endDate).getTime()>=h:!0)}let d={};for(let m of c){let h=m.personId;h&&(d[h]||(d[h]=[]),d[h].push(m))}let p=[];for(let[m,h]of Object.entries(d)){let g=0,I=[],v=[],w;if(a?.length){w=[];for(let S of a){let{bucketName:U,eventTypes:T,pointComponents:P,bestOfCount:D,maxResultsPerLevel:E,mandatoryRules:R}=S,C=h;T?.length&&(C=C.filter(O=>O.eventType&&T.includes(O.eventType)));let{counting:M,dropped:N,bucketTotal:A}=bP({awards:C,pointComponents:P,bestOfCount:D,maxResultsPerLevel:E,mandatoryRules:R});g+=A,I.push(...M.map(O=>O.award)),v.push(...N.map(O=>O.award)),w.push({bucketName:U,countingResults:M.map(O=>O.award),droppedResults:N.map(O=>O.award),bucketTotal:A})}}else{let{counting:S,dropped:U,bucketTotal:T}=bP({awards:h,pointComponents:["points","qualityWinPoints"],bestOfCount:u||0,maxResultsPerLevel:l});g=T,I=S.map(P=>P.award),v=U.map(P=>P.award)}let y=I.length>=o,b={personId:m,totalPoints:g,rank:0,meetsMinimum:y,countingResults:I,droppedResults:v};w&&(b.bucketBreakdown=w),p.push(b)}p.sort((m,h)=>h.totalPoints-m.totalPoints),s.length&&p.sort((m,h)=>{if(m.totalPoints!==h.totalPoints)return h.totalPoints-m.totalPoints;for(let g of s){let I=FW(g,m,h);if(I!==0)return I}return 0});let f=1;for(let m=0;m<p.length;m++)m>0&&p[m].totalPoints===p[m-1].totalPoints?s.length>0&&s.some(h=>FW(h,p[m-1],p[m])!==0)?p[m].rank=f:p[m].rank=p[m-1].rank:p[m].rank=f,f=m+2;return p}function FW(t,e,i){switch(t){case"highestSingleResult":{let r=Math.max(0,...e.countingResults.map(n=>n.points||0));return Math.max(0,...i.countingResults.map(n=>n.points||0))-r}case"mostCountingResults":return i.countingResults.length-e.countingResults.length;case"mostWins":{let r=e.countingResults.reduce((n,a)=>n+(a.winCount||0),0);return i.countingResults.reduce((n,a)=>n+(a.winCount||0),0)-r}default:return 0}}function LQ({pointAwards:t,personId:e,aggregationRules:i={}}){let{countingBuckets:r,maxResultsPerLevel:n,bestOfCount:a}=i,s=t.filter(c=>c.personId===e);if(r?.length){let c=[],d=0;for(let p of r){let{bucketName:f,eventTypes:m,pointComponents:h,bestOfCount:g,maxResultsPerLevel:I,mandatoryRules:v}=p,w=s;m?.length&&(w=w.filter(U=>U.eventType&&m.includes(U.eventType)));let{counting:y,dropped:b,bucketTotal:S}=bP({awards:w,pointComponents:h,bestOfCount:g,maxResultsPerLevel:I,mandatoryRules:v});d+=S,c.push({bucketName:f,countingResults:y.map(U=>U.award),droppedResults:b.map(U=>U.award),bucketTotal:S})}return{buckets:c,totalPoints:d}}let{counting:o,dropped:l,bucketTotal:u}=bP({awards:s,pointComponents:["points","qualityWinPoints"],bestOfCount:a||0,maxResultsPerLevel:n});return{buckets:[{bucketName:"All",countingResults:o.map(c=>c.award),droppedResults:l.map(c=>c.award),bucketTotal:u}],totalPoints:u}}var _Q={};ct(_Q,{applyTournamentRankingPoints:()=>$Q});function $Q({tournamentRecord:t,policyDefinitions:e,participantFilters:i,scaleName:r="RANKING_POINTS",level:n,removePriorValues:a}){if(!t)return{error:Ie};let s=vv({tournamentRecord:t,policyDefinitions:e,participantFilters:i,level:n});if(s.error)return s;let{personPoints:o,pairPoints:l,teamPoints:u}=s,c={};for(let f of t.participants||[])f.person?.personId&&(c[f.person.personId]=f.participantId);let d=t.endDate,p=0;for(let[f,m]of Object.entries(o)){let h=c[f];if(!h)continue;let g={};for(let I of m){let v=I.eventType||"SINGLES";g[v]||(g[v]=[]),g[v].push(I)}for(let[I,v]of Object.entries(g)){let w=v.reduce((b,S)=>b+(S.points||0)+(S.qualityWinPoints||0)+(S.linePoints||0),0),y=Iv({tournamentRecord:t,participantId:h,scaleItem:{scaleType:ou,scaleName:r,eventType:I,scaleDate:d,scaleValue:{points:w,awards:v}},removePriorValues:a});if(y.error)return y;p++}}return{...H,personPoints:o,pairPoints:l,teamPoints:u,modificationsApplied:p}}var BQ={};ct(BQ,{getEntryStatusReports:()=>EMe,getParticipantStats:()=>PMe,getStructureReports:()=>CMe,getVenuesReport:()=>xMe});function PMe({withCompetitiveProfiles:t,opponentParticipantId:e,withIndividualStats:i,teamParticipantId:r,tournamentRecord:n,withScaleValues:a,tallyPolicy:s,matchUps:o}){if(!n)return{error:Ie};if(o&&!Array.isArray(o))return{error:ia};if(o=o??br({tournamentRecord:n,participantsProfile:a?{withScaleValues:a}:void 0}).matchUps,!o?.length)return{error:Tu};let l=[];e&&l.push(e),r&&l.push(r);let u=l.length?{participantIds:l}:{participantTypes:[_n]},c=Ei({participantFilters:u,tournamentRecord:n}).participants??[];if(!c.every(({participantType:U})=>U===_n))return{error:ga};l.length||l.push(...c.map(vt));let d=new Map,p=new Map,f=new Map,m=new Map,h=(U,T="")=>p.get(U)||p.set(U,{participantName:T,participantId:U,competitorIds:[],competitiveness:{},matchUpStatuses:{},tiebreaks:[0,0],matchUps:[0,0],points:[0,0],games:[0,0],sets:[0,0]})&&p.get(U);for(let U of c){let{participantId:T,individualParticipantIds:P}=U;m.set(T,P??[]),h(T,U.participantName)}if(r&&!m.get(r))return z({result:{error:Vi},context:{teamParticipantId:r}});if(e&&!m.get(e))return z({result:{error:Vi},context:{opponentParticipantId:e}});let g=[],I=U=>{let T=[[],[]];for(let D of U){let E=D.participant;if(E?.participantName){d.set(E.participantId,{participantName:E.participantName,ratings:E.ratings});let R=p.get(E.participantId);R&&(R.participantName=E.participantName)}}let P=({side:D,individualParticipantIds:E})=>D.participantId&&(!E?.length||E.includes(D.participantId))&&[D.participantId]||D.participant?.individualParticipantIds?.length&&(!E?.length||xi(E,D.participant?.individualParticipantIds).length===D.participant?.individualParticipantIds?.length)&&D.participant.individualParticipantIds;if(m.size){let D=(E,R)=>{for(let C of U){if(!C.participant)continue;let M=P({individualParticipantIds:R,side:C});if(M?.length){let N=C.sideNumber;if(!N)continue;let A=[E];i&&A.push(...M),T[N-1]=A;let O=p.get(E);for(let k of M.filter(Boolean))O&&!O.competitorIds.includes(k)&&O.competitorIds.push(k)}}};if(r)(!e||U.every(E=>E.participant&&(P({individualParticipantIds:m.get(r),side:E})||P({individualParticipantIds:m.get(e),side:E}))))&&D(r,m.get(r));else for(let[E,R]of m)D(E,R)}else if(i)for(let D of U){if(!D.participant)continue;let E=P({individualParticipantIds:[],side:D}),R=D.sideNumber;R&&(T[R-1]=E)}return T};for(let U of o){if(!bt(U))return{error:ia};let{matchUpStatus:T,matchUpFormat:P,matchUpType:D,winningSide:E,score:R,sides:C}=U;if(!C||!R||D===ka||T==="BYE")continue;let M=I(C);if(!M.filter(Boolean).length)continue;let N=t&&E&&nS({matchUp:U})?.competitiveness;g.push(U);let A=IL({matchUpStatus:T,matchUpFormat:P,tallyPolicy:s,winningSide:E,score:R}),O=f7({matchUpStatus:T,matchUpFormat:P,tallyPolicy:s,winningSide:E,score:R}),{pointsTally:k,tiebreaksTally:F}=m7({matchUpFormat:P,score:R});M.forEach((x,L)=>{for(let $ of x){let V=d.get($)?.participantName,_=h($,V);if(_){let B=(X,Z)=>Z.forEach((J,ae)=>_[X][ae]+=J),G=L?[...F].reverse():F,j=L?[...k].reverse():k,K=L?[...O].reverse():O,Y=L?[...A].reverse():A;if(B("tiebreaks",G),B("points",j),B("games",K),B("sets",Y),E){let X=E-1===L?0:1;_.matchUps[X]+=1}if(N){let X=N.toLowerCase();_.competitiveness[X]||(_.competitiveness[X]=[0,0]),_.competitiveness[X][L]+=1}if(T){let X=T.toLowerCase();_.matchUpStatuses[X]||(_.matchUpStatuses[X]=0),_.matchUpStatuses[X]+=1}}}})}let v=["tiebreaks","matchUps","points","games","sets"],w=["competitive","routine","decisive"],y=new Map,b=(U,T)=>(U??0)+(T??0);for(let[U,T]of p.entries()){for(let P of v){let D=T[P].reduce(b);if(D){let E=T[P][0]/D,R=`${P}Ratio`,C=parseFloat(E.toFixed(2));T[R]=C,f.set(U,!0),y.has(R)||y.set(R,[]),y.get(R)?.push(C)}}for(let P of w){let D=T.competitiveness?.[P]?.reduce(b);if(D){let E=T.competitiveness[P][0]/D,R=`${P}Ratio`,C=parseFloat(E.toFixed(2));T[R]=C}}}if(!r){let U=(T,P)=>P-T;for(let T of p.values())for(let P of v){let D=`${P}Ratio`;if(typeof T[D]=="number"){let E=y.get(D)?.sort(U).indexOf(T[D]);if(typeof E=="number"&&E>=0){let R=`${P}Rank`;T[R]=E+1}}}}let S={relevantMatchUps:g,...H};return r?(S.teamStats=p.get(r),e&&(S.opponentStats=p.get(e))):S.participatingTeamsCount=f.size,S.allParticipantStats=[...p.values()],S}function wP({participant:t,eventType:e}){let i=t?.person?.personId,r=t?.person?.personOtherIds?.[0],n=t?.person?.tennisId,a=t?.ratings?.[e]?.find(({scaleName:u})=>u==="WTN"),s=a?.scaleValue,{wtnRating:o,confidence:l}=s||{};return{timeStamp:a?.scaleDate,personOtherId:r,confidence:l,wtnRating:o,personId:i,tennisId:n}}function EMe({tournamentRecord:t}){if(!t)return{error:Ie};let e=t.tournamentId,{participantMap:i}=Ei({withScaleValues:!0,withEvents:!0,withSeeding:!0,tournamentRecord:t,withDraws:!0}),r=(br({matchUpFilters:{matchUpTypes:[Zf,Sp]},tournamentRecord:t}).matchUps??[]).flatMap(({sides:f,matchUpType:m})=>f?.flatMap(h=>m===Sp?h?.participant?.individualParticipantIds:h?.participant?.participantId||h.participantId).filter(Boolean)).filter(Boolean),n=[],a={},s={},o={},l=0,u=({id:f,entry:m,eventId:h,eventType:g})=>{let{qualifyingSeeding:I,mainSeeding:v,entryStatus:w,entryStage:y,drawId:b}=m;a[f]||(a[f]=[]);let{participant:S,events:U}=i?.[f]??{},T=wP({participant:S,eventType:g}),P=U?.[h]?.ranking;w===GL&&n.push(f),a[f].push({participantType:S?.participantType,participantId:f,tournamentId:e,eventType:g,eventId:h,drawId:b,entryStatus:w,entryStage:y,...T,ranking:P,mainSeeding:v,qualifyingSeeding:I})};for(let f of t.events??[]){let m={},h=U=>{m[U]||(m[U]={count:0}),m[U].count+=1},{drawDefinitions:g=[],eventType:I,eventId:v}=f,w=g.flatMap(U=>{let{drawId:T,entries:P}=U;l+=1;let D=({stage:M,stageSequence:N})=>M===xe&&N===1||M===We,E=(U.structures??[]).filter(D).flatMap(({positionAssignments:M})=>M).filter(Boolean).map(({participantId:M})=>M),R=({participantId:M})=>E.includes(M),C=M=>{let{participantId:N,entryStatus:A,entryStage:O}=M;h(A);let k=i?.[N]?.draws?.[T]?.seedAssignments?.[xe];return{qualifyingSeeding:i?.[N]?.draws?.[T]?.seedAssignments?.[We],participantId:N,mainSeeding:k,entryStatus:A,entryStage:O,drawId:T}};return P?.filter(R).map(C)}),y=U=>{let T=U.participantId,P=i?.[T].participant.individualParticipantIds?.filter(D=>r.includes(D));return T&&{[T]:{individualParticipantIds:P}}};I===lc?(()=>{let U=Object.assign({},...w.map(y).filter(Boolean)),T=P=>{U[P.participantId].individualParticipantIds.forEach(D=>{u({id:D,eventType:I,eventId:v,entry:P})})};w.forEach(T)})():w.forEach(U=>{u({id:U?.participantId,eventType:I,eventId:v,entry:U})});let b=Object.values(m).reduce((U,T)=>U+T.count,0);Object.keys(m).forEach(U=>{m[U].pct=m[U].count/b*100}),o[v]={tournamentId:e,eventId:v,entries:w,entryStatuses:m};let S=Object.assign({},...so.flatMap(U=>[{[U+"_count"]:m[U]?.count},{[U+"_pct"]:m[U]?.pct}]));s[v]={tournamentId:e,eventId:v,...S}}let c=Object.values(i??{}).filter(({participant:{participantType:f,participantRole:m}})=>f===gt&&m===Kr),d=c.filter(({participant:f})=>!r.includes(f.participantId)).map(({participant:f})=>f.participantId),p={nonParticipatingEntriesCount:d.length,individualParticipantsCount:c.length,eventsCount:Object.values(o).length,nonParticipatingParticipantIds:d,drawDefinitionsCount:l,tournamentId:e};return{entryStatusReports:Object.values(s).flat(),participantEntryReports:Object.values(a).flat(),eventReports:Object.values(o).flat(),withDrawnParticipantIds:n,tournamentEntryReport:p}}function RMe({eventType:t,matchUps:e,eventId:i,drawId:r}){let n={},a=m=>{let h=m?.matchUpFormat;h&&(n[h]||(n[h]=0),n[h]+=1)},s=e.filter(m=>i?m.eventId===i:m.drawId===r).reduce((m,h)=>(a(h),(h.sides??[]).flatMap(g=>(g?.participant?.individualParticipants||[g?.participant]).filter(Boolean)).forEach(g=>m[g.participantId]=g),m),{}),o=Object.values(s),l=o.map(m=>wP({participant:m,eventType:t})).filter(({wtnRating:m})=>m),u=(o.length-l.length)/o.length*100,c=l.reduce((m,h)=>{let{wtnRating:g,confidence:I}=h;return m.totalWTN+=g,m.totalConfidence+=I,m},{totalWTN:0,totalConfidence:0}),d=l?.length?c.totalWTN/l.length:0,p=l?.length?c.totalConfidence/l.length:0,f=Object.values(n).reduce((m,h)=>m+(h||0),0);return{matchUpFormatCounts:n,matchUpsCount:f,avgConfidence:p,pctNoRating:u,avgWTN:d}}function CMe(t){let{tournamentRecord:e,extensionProfiles:i,firstFlightOnly:r,firstStageSequenceOnly:n=!0}=t;if(!e)return{error:Yg};let a=[],s={},o={},l=[],u=g=>I=>I.structureId===g,c=Object.assign({},...(i??[]).map(({name:g,label:I,accessor:v})=>{let w=mt({element:e,name:g})?.extension?.value,y=v?hp({element:w,accessor:v})?.value:w;return{[I??g]:y}})),d=e?.tournamentId,p=br({participantsProfile:{withScaleValues:!0},tournamentRecord:e}).matchUps??[],f=g=>vs({itemType:BF,itemSubTypes:[jl],element:{timeItems:g}})?.timeItem?.itemValue?.scaleBasis,m=({positionManipulations:g})=>{g?.forEach(I=>{let{structureId:v,name:w}=I,y=I.drawPositions??[I.drawPosition];s[v]??=[],s[v].push(`${w}: ${y.join("/")}`)})},h=e?.events?.flatMap(({timeItems:g,drawDefinitions:I=[],extensions:v,eventType:w,eventName:y,eventId:b,category:S})=>{let U=v?.find(N=>N.name===Xs)?.value?.flights?.map(N=>({[N.drawId]:N.flightNumber})),T=U&&Object.assign({},...U),P=v?.find(N=>N.name===fp),D=g?.find(N=>N.itemType===fp),E=P?.value?.length??D?.itemValue??0,R=Object.values(T??{}),C=T&&Math.min(...R),M=f(g);return o[b]={seedingBasis:M?JSON.stringify(M):void 0,totalPositionManipulations:0,maxPositionManipulations:0,generatedDrawsCount:0,drawDeletionsCount:E,tournamentId:d,eventId:b},I.filter(N=>!r||!U||T[N.drawId]===C).flatMap(N=>{let{matchUpFormat:A,tieFormat:O,timeItems:k,extensions:F,structures:x,drawName:L,drawType:$,drawId:V}=N,{matchUpFormatCounts:_,matchUpsCount:B,avgConfidence:G,pctNoRating:j,avgWTN:K}=RMe({eventType:w,matchUps:p,drawId:V}),Y=f(k)??M,X=MMe({extensions:F}),Z=X?.length??0;return m({positionManipulations:X}),o[b].totalPositionManipulations+=Z,o[b].generatedDrawsCount+=1,Z>o[b].maxPositionManipulations&&(o[b].maxPositionManipulations=Z),x?.filter(J=>(J.stageSequence===1||!n)&&[We,xe,Zr,Ui].includes(J.stage)).map(J=>{let ae=[xe,Ui].includes(J.stage)?NMe(p,J.structureId):void 0;J.stage===xe&&a.push({eventName:y,drawName:L,structureId:J.structureId});let te=AMe(ae)?.participant,ne=kMe(te),le=OMe(te),de=wP({participant:le?.[0]??te,eventType:w}),{personId:pe,personOtherId:ge,tennisId:Me,confidence:Pe,wtnRating:Be}=de||{},fe=wP({participant:le?.[1],eventType:w}),{personId:Te,personOtherId:ce,tennisId:ye,confidence:be,wtnRating:Fe}=fe||{},{ageCategoryCode:we,categoryName:Ne,subType:me}=S??{},Ee=J.matchUpFormat??A,Le=(_[Ee]??0)/B*100,{tieFormatName:Q,tieFormatDesc:se}=mP(O),{tieFormatName:oe,tieFormatDesc:ue}=mP(J.tieFormat),ee=se===ue,Se=!ee&&oe,De=J.tieFormat&&!ee&&ue,it=X?.filter(u(J.structureId))?.length??0;return{...c,tournamentId:d,eventId:b,structureId:J.structureId,drawId:V,eventType:w,category:me,categoryName:Ne,ageCategoryCode:we,flightNumber:T?.[V],drawType:$,stage:J.stage,seedingBasis:Y?JSON.stringify(Y):void 0,winningPersonId:pe,winningPersonOtherId:ge,winningPersonTennisId:Me,winningPersonWTNrating:Be,winningPersonWTNconfidence:Pe,winningPerson2Id:Te,winningPerson2OtherId:ce,winningPerson2TennisId:ye,winningPerson2WTNrating:Fe,winningPerson2WTNconfidence:be,winningTeamId:ne,positionManipulations:it,pctNoRating:j,matchUpFormat:Ee,pctInitialMatchUpFormat:Le,matchUpsCount:B,drawTieFormatName:Q,drawTieFormatDesc:se,tieFormatName:Se,tieFormatDesc:De,avgConfidence:G,avgWTN:K}})})});return a.forEach(({eventName:g,drawName:I,structureId:v})=>{s[v]?.length&&l.push({eventName:g,drawName:I,actions:s[v]})}),{eventStructureReports:Object.values(o),structureReports:h,flightReports:l}}function MMe({extensions:t}){return t?.find(({name:e})=>e===Bg)?.value?.slice(1)}function NMe(t,e){return t.find(i=>i.structureId===e&&i.finishingRound===1&&i.winningSide)}function AMe(t){if(t?.sides)return t.sides.find(e=>e.sideNumber===t.winningSide)}function kMe(t){return t?.participantType===_n?t.participantId:void 0}function OMe(t){return t?.participantType===pt?t.individualParticipants??[]:[]}function xMe({ignoreDisabled:t=!0,tournamentRecords:e,tournamentId:i,venueIds:r=[],dates:n=[]}){if(!Array.isArray(n))return{error:ie,dates:n};if(!Array.isArray(r))return{error:ie,venueIds:r};if(!(e&&Object.keys(e).filter(c=>!i||c===i)||[]).length)return{error:Ci};if(!n.every(Pn))return{error:sr};let a=Cu({tournamentRecords:e,ignoreDisabled:t,dates:n});if(a.error)return a;let s=a?.venues?.filter(({venueId:c})=>!r?.length||r.includes(c)),o=a.courts?.reduce((c,d)=>(d.dateAvailability?.forEach(p=>{let f=p.date;c.includes(f)||c.push(f)}),c),[]).filter(c=>!n.length||n.includes(c)),l={venueIds:s?.map(({venueId:c})=>c)},{matchUps:u}=Eo({afterRecoveryTimes:!0,tournamentRecords:e,matchUpFilters:l});return{venuesReport:s?.map(c=>FMe(o,c,u))}}function FMe(t,e,i){let{venueId:r,courts:n,venueName:a}=e,s={};return t.forEach(o=>{let l=0,u=0,c=0;for(let f of n){let m=f.dateAvailability.find(g=>g.date===o),h=(m&&Tv({courtDate:m}).timeSlots)?.reduce((g,I)=>{let{startTime:v,endTime:w}=I,y=Pt(w)-Pt(v);return g+y},0);h&&(c+=1),l+=h}let d=i.filter(({schedule:f})=>f.venueId===r&&tu(o,f.scheduledDate));d.forEach(({schedule:f})=>{let m=ci(f.scheduledTime),h=Jn(m,f.averageMinutes),g=Pt(h)-Pt(m);u+=g});let p=l?(u/l*100).toFixed(2):"100";s[o]={scheduledMatchUpsCount:d.length,availableCourts:c,availableMinutes:l,scheduledMinutes:u,percentUtilization:p}}),{venueId:r,venueName:a,venueReport:s}}var r$={};ct(r$,{addCourtGridBooking:()=>QQ,addMatchUpCourtOrder:()=>x_,addMatchUpEndTime:()=>L_,addMatchUpOfficial:()=>bJ,addMatchUpResumeTime:()=>$_,addMatchUpScheduleItems:()=>BC,addMatchUpScheduledDate:()=>_C,addMatchUpScheduledTime:()=>Hd,addMatchUpStartTime:()=>F_,addMatchUpStopTime:()=>__,addSchedulingProfileRound:()=>Q_,allocateTeamMatchUpCourts:()=>$C,assignMatchUpCourt:()=>Eh,assignMatchUpVenue:()=>Pv,bulkRescheduleMatchUps:()=>YQ,bulkScheduleMatchUps:()=>$S,bulkScheduleTournamentMatchUps:()=>kb,bulkUpdateCourtAssignments:()=>HQ,calculateScheduleTimes:()=>n$,clearMatchUpSchedule:()=>XQ,clearScheduledMatchUps:()=>jC,courtGridRows:()=>UC,findMatchUpFormatTiming:()=>bC,findVenue:()=>Eu,generateBookings:()=>VC,generateVirtualCourts:()=>kC,getMatchUpsToSchedule:()=>yC,getPersonRequests:()=>pf,getProfileRounds:()=>SC,getScheduledRoundsDetails:()=>MS,getSchedulingProfile:()=>$c,getSchedulingProfileIssues:()=>e_,matchUpScheduleChange:()=>KQ,modifyMatchUpFormatTiming:()=>y_,mutate:()=>VQ,proAutoSchedule:()=>GQ,proConflicts:()=>zQ,publicFindCourt:()=>pL,query:()=>vX,removeCourtGridBooking:()=>ZQ,removeEventMatchUpFormatTiming:()=>MC,removeMatchUpCourtAssignment:()=>jQ,reorderUpcomingMatchUps:()=>qQ,scheduleMatchUps:()=>WQ,scheduleProfileRounds:()=>GC,setMatchUpDailyLimits:()=>JQ,setMatchUpHomeParticipantId:()=>O_,setSchedulingProfile:()=>yv,toggleParticipantCheckInState:()=>xC,validateSchedulingProfile:()=>wC});var VQ={};ct(VQ,{addCourtGridBooking:()=>QQ,addMatchUpCourtOrder:()=>x_,addMatchUpEndTime:()=>L_,addMatchUpOfficial:()=>bJ,addMatchUpResumeTime:()=>$_,addMatchUpScheduleItems:()=>BC,addMatchUpScheduledDate:()=>_C,addMatchUpScheduledTime:()=>Hd,addMatchUpStartTime:()=>F_,addMatchUpStopTime:()=>__,addSchedulingProfileRound:()=>Q_,allocateTeamMatchUpCourts:()=>$C,assignMatchUpCourt:()=>Eh,assignMatchUpVenue:()=>Pv,bulkRescheduleMatchUps:()=>YQ,bulkScheduleMatchUps:()=>$S,bulkScheduleTournamentMatchUps:()=>kb,bulkUpdateCourtAssignments:()=>HQ,calculateScheduleTimes:()=>n$,clearMatchUpSchedule:()=>XQ,clearScheduledMatchUps:()=>jC,findMatchUpFormatTiming:()=>bC,generateBookings:()=>VC,generateVirtualCourts:()=>kC,matchUpScheduleChange:()=>KQ,modifyMatchUpFormatTiming:()=>y_,proAutoSchedule:()=>GQ,proConflicts:()=>zQ,removeCourtGridBooking:()=>ZQ,removeEventMatchUpFormatTiming:()=>MC,removeMatchUpCourtAssignment:()=>jQ,reorderUpcomingMatchUps:()=>qQ,scheduleMatchUps:()=>WQ,scheduleProfileRounds:()=>GC,setMatchUpDailyLimits:()=>JQ,setMatchUpHomeParticipantId:()=>O_,setSchedulingProfile:()=>yv,toggleParticipantCheckInState:()=>xC,validateSchedulingProfile:()=>wC});function n$({calculateStartTimeFromCourts:t=!0,defaultRecoveryMinutes:e=0,averageMatchUpMinutes:i=90,remainingScheduleTimes:r,clearScheduleDates:n,tournamentRecords:a,periodLength:s,scheduleDate:o,startTime:l,venueIds:u,endTime:c}){if(typeof a!="object"||!Object.keys(a).length)return{error:Ci};s=s??OC({recoveryMinutes:e,averageMatchUpMinutes:i});let{courts:d,venues:p}=Cu({dates:[o],ignoreDisabled:!0,tournamentRecords:a}),f=d?.filter(D=>!u||u.includes(D.venueId));l||(l=f?.reduce((D,E)=>{let R=E.dateAvailability?.find(C=>!C.date||tu(o,C.date))?.startTime??E.startTime;return R&&(!D||Pt(R)<Pt(D))?R:D},void 0)),c||(c=f?.reduce((D,E)=>{let R=E.dateAvailability?.find(C=>!C.date||tu(o,C.date))?.endTime??E.endTime;return R&&(!D||Pt(R)>Pt(D))?R:D},void 0));let m=Object.values(a),h=Object.assign({},...m.map(D=>(D.events??[]).map(E=>{let{scheduleTiming:R}=Xw({tournamentRecord:D,event:E});return{[E.eventId]:{event:E,scheduleTiming:R}}})).flat()),g=kS({sortDateMatchUps:!1,tournamentRecords:a,matchUpFilters:{scheduledDate:o,venueIds:u}}),I=g?.dateMatchUps??[],v=g?.completedMatchUps??[],w=[];w.push(...I),w.push(...v);let y={averageTimes:[{minutes:{default:i}}],recoveryTimes:[{minutes:{default:e}}]},b=w?.map(({eventId:D,schedule:E,matchUpFormat:R})=>{let{event:C,scheduleTiming:M}=h[D],N=C?.eventType,A={...M,defaultTiming:y,matchUpFormat:R},{averageMinutes:O,recoveryMinutes:k}=kR({eventType:N,timingDetails:A}),{courtId:F,venueId:x}=E,L=ci(E.scheduledTime),$=Jn(L,O);return{recoveryMinutes:k,averageMinutes:O,periodLength:s,startTime:L,endTime:$,courtId:F,venueId:x}}),S={calculateStartTimeFromCourts:t,remainingScheduleTimes:r,averageMatchUpMinutes:i,date:o,clearScheduleDates:n,periodLength:s,startTime:l,endTime:c,bookings:b,courts:f},{scheduleTimes:U}=R_(S),T=u?.length===1&&u[0]||p?.length===1&&p[0].venueId||void 0,P=w.map(Ir);return{venueId:T,scheduleTimes:U,dateScheduledMatchUpIds:P}}function jQ(t){let e=Ge(t,[{[cn]:!0}]);if(e.error)return e;let{removePriorValues:i,tournamentRecords:r,tournamentId:n,courtDayDate:a,matchUpId:s,courtId:o,drawId:l}=t,u=r[n];if(!u)return{error:Ie};let{drawDefinition:c,event:d}=Gd({tournamentRecord:u,drawId:l});if(!c)return{error:_e};let p=di({drawDefinition:c,event:d,matchUpId:s});if(p.error)return p;if(p?.matchUp?.matchUpType===ka){let{itemValue:f}=uf({timeItems:p.matchUp.timeItems??[],itemType:lu}),m=o&&f.filter(h=>h.courtId!==o);return wa({duplicateValues:!1,removePriorValues:i,tournamentRecord:u,drawDefinition:c,matchUpId:s,timeItem:{itemType:lu,itemValue:m}})}else return Eh({tournamentRecord:u,drawDefinition:c,courtDayDate:a,courtId:"",matchUpId:s})}function GQ({scheduleCompletedMatchUps:t,minCourtGridRows:e=10,tournamentRecords:i,scheduledDate:r,matchUps:n}){if(!Ga(n))return{error:ie};if(n.some(({hasContext:m})=>!m))return{info:"matchUps must have { inContext: true, nextMatchUps: true }",error:KE};let a=kS({courtCompletedMatchUps:!0,withCourtGridRows:!0,minCourtGridRows:e,tournamentRecords:i,matchUpFilters:{localPerspective:!0,scheduledDate:r}});if(a.error)return a;let{rows:s}=a,o=[],l=m=>[(m.sides||[]).map(h=>[h.participantId,h.participant?.individualParticipantIds]),(m.potentialParticipants||[]).flat().map(h=>[h.participantId,h.individualParticipantIds])].flat(1/0).filter(Boolean),u=s?.reduce((m,h)=>{let g=[],I=[];Object.values(h).forEach(w=>{if(bt(w)&&(w.matchUpId&&(g.push(w.matchUpId),o.push(w)),w.sides)){let y=l(w);I.push(...y)}});let v=Object.values(h).filter(w=>bt(w)&&!w.matchUpId&&!w.isBlocked);return m.concat({matchUpIds:g,availableCourts:v,rowId:h.rowId,participantIds:I})},[]);n.filter(({matchUpStatus:m})=>m&&m!=="BYE"&&(t||!Yi.includes(m))).sort(gh);let c=oo({matchUps:n.concat(o),includeParticipantDependencies:!0,tournamentRecords:i}).matchUpDependencies,d=[],p=[];for(;n.length&&u.length;){let m=u.shift(),h=[];for(;n.length&&m.availableCourts.length;){let g=n.concat(h).map(P=>P.matchUpId),I=n.shift(),v=I?.matchUpId,w=v&&c[v].matchUpIds.concat(c[v].dependentMatchUpIds),y=v&&g.some(P=>c[v].matchUpIds.includes(P)),b=v&&p.some(P=>c[v].dependentMatchUpIds.includes(P)),S=m.matchUpIds.some(P=>w.includes(P)),U=l(I),T=m.participantIds.some(P=>U.includes(P));if(I&&!S&&!y&&!T&&!b){let P=m.availableCourts.shift();Object.assign(I.schedule,P.schedule),Object.assign(P,I),d.push(I),m.participantIds.push(...U),m.matchUpIds.push(v)}else I&&h.push(I)}n.push(...h),p.push(...m.matchUpIds)}let f=d.map(({matchUpId:m,tournamentId:h,schedule:g,drawId:I})=>({tournamentId:h,matchUpId:m,drawId:I,schedule:{...g,scheduledDate:r}}));return a=$S({tournamentRecords:i,matchUpDetails:f}),{...a,scheduled:d,notScheduled:n}}function HQ(t){let{courtDayDate:e}=t,i=Ge(t,[{courtAssignments:!0,[zn]:an,[Fa]:Xe},{[cn]:!0}]);if(i.error)return i;let r=t.courtAssignments.reduce((a,s)=>{let{tournamentId:o}=s;return a[o]||(a[o]=[]),a[o].push(s),a},{}),n;return Object.keys(r).every(a=>{let s=t[cn][a];if(!s)return n={error:Ie},!1;let o=r[a].reduce((l,u)=>{let{drawId:c}=u;return l[c]||(l[c]=[]),l[c].push(u),l},{});Object.keys(o).every(l=>{let{drawDefinition:u}=jn({tournamentRecord:s,drawId:l});return u?(o[l].every(c=>{let{matchUpId:d,courtId:p}=c,f=Eh({tournamentRecord:s,drawDefinition:u,courtDayDate:e,matchUpId:d,courtId:p});if(f.success)return f?.success;n={error:g4}}),!0):(n={error:_e},!1)})}),n||H}function WQ(t){let{tournamentRecords:e,allDateMatchUpIds:i=[],averageMatchUpMinutes:r=90,recoveryMinutes:n=0,recoveryMinutesMap:a,matchUpPotentialParticipantIds:s={},individualParticipantProfiles:o={},matchUpNotBeforeTimes:l={},matchUpDailyLimits:u={},checkPotentialRequestConflicts:c=!0,remainingScheduleTimes:d,clearScheduleDates:p,periodLength:f=30,scheduleDate:m,matchUpIds:h,venueIds:g,startTime:I,endTime:v,dryRun:w}=t,y=Ge(t,[{[cn]:!0,[Vw]:!0},{[Wr]:Pn,[Fa]:sr,[Jve]:!0},{[Wr]:B=>!B||!isNaN(B),[tye]:!1,[Fa]:ie,[iye]:!1,[rye]:!1}]);if(y.error)return y;let b=t.competitionMatchUps??Eo({nextMatchUps:!0,tournamentRecords:e}).matchUps??[],S=t.matchUpDependencies??oo({includeParticipantDependencies:!0,matchUps:b,tournamentRecords:e}).matchUpDependencies;b.forEach(B=>{B.schedule?.scheduledDate&&tu(m,Qe(B.schedule.scheduledDate))&&pI({matchUpPotentialParticipantIds:s,matchUpNotBeforeTimes:l,matchUp:B})});let U=h.map(B=>b.find(G=>G.matchUpId===B)).filter(Boolean),{venueId:T,scheduleTimes:P,dateScheduledMatchUpIds:D}=n$({tournamentRecords:e,remainingScheduleTimes:d,startTime:ci(I),endTime:ci(v),scheduleDate:Qe(m),averageMatchUpMinutes:r,clearScheduleDates:p,periodLength:f,venueIds:g}),E={},R=[],C={},M={},N={};b.filter(({matchUpId:B})=>D?.includes(B)).forEach(B=>{jO({matchUpPotentialParticipantIds:s,individualParticipantProfiles:o,matchUp:B,value:1});let G=B.schedule?.scheduledTime;if(G){C[B.matchUpId]=G;let j=a?.[B.matchUpId];Ab({recoveryMinutes:j||n,matchUpPotentialParticipantIds:s,individualParticipantProfiles:o,matchUpNotBeforeTimes:l,averageMatchUpMinutes:r,matchUpDependencies:S,scheduleTime:G,matchUp:B})}});let A=U.filter(B=>{let G=D?.includes(B.matchUpId),j=["BYE",Qt,ki,us,$r,mi].includes(B?.matchUpStatus);return!G&&!B.winningSide&&!j}),{matchUpMap:O,overLimitMatchUpIds:k,participantIdsAtLimit:F}=A.reduce((B,G)=>{let{drawId:j,tournamentId:K,matchUpType:Y}=G,{participantIdsAtLimit:X,relevantParticipantIds:Z}=Y_({individualParticipantProfiles:o,matchUpPotentialParticipantIds:s,matchUpDailyLimits:u,matchUp:G});return X?.length?(B.overLimitMatchUpIds.push(G.matchUpId),B.participantIdsAtLimit.push(...X),B):(Z.forEach(J=>{LS({individualParticipantProfiles:o,participantId:J});let ae=o[J].counters;ae[Y]?ae[Y]+=1:ae[Y]=1,ae[Ls]?ae[Ls]+=1:ae[Ls]=1}),B.matchUpMap[K]||(B.matchUpMap[K]={}),B.matchUpMap[K][j]?B.matchUpMap[K][j].push(G):B.matchUpMap[K][j]=[G],pI({matchUpPotentialParticipantIds:s,matchUpNotBeforeTimes:l,matchUp:G}),B)},{matchUpMap:{},overLimitMatchUpIds:[],participantIdsAtLimit:[]});A=A.filter(({matchUpId:B})=>!k.includes(B));let x=0,L=P?.length??0,{personRequests:$}=pf({tournamentRecords:e,requestType:_S});for(;P?.length&&A.length&&x<=L;){x++;let{scheduleTime:B}=P.shift(),G=A.find(j=>{let{matchUpId:K}=j,{dependenciesScheduled:Y,remainingDependencies:X}=W_({matchUpScheduleTimes:C,matchUpDependencies:S,allDateMatchUpIds:i,matchUp:j});if(!Y)return N[K]||(N[K]=[]),N[K].push({scheduleTime:B,remainingDependencies:X}),!1;let{enoughTime:Z}=q_({individualParticipantProfiles:o,matchUpNotBeforeTimes:l,matchUpDependencies:S,scheduleTime:B,matchUp:j});if(!Z)return M[K]||(M[K]=[]),M[K].push({scheduleTime:B}),!1;let{conflicts:J}=z_({potentials:c,averageMatchUpMinutes:r,requestConflicts:E,personRequests:$,scheduleTime:B,scheduleDate:m,matchUp:j});if(J?.length)return!1;let ae=a?.[j.matchUpId];return Ab({recoveryMinutes:ae||n,matchUpPotentialParticipantIds:s,individualParticipantProfiles:o,matchUpNotBeforeTimes:l,averageMatchUpMinutes:r,matchUpDependencies:S,scheduleTime:B,matchUp:j}),C[j.matchUpId]=B,!0});A=A.filter(({matchUpId:j})=>j!==G?.matchUpId),G||R.push(B)}A.forEach(B=>{jO({individualParticipantProfiles:o,matchUpPotentialParticipantIds:s,value:-1,matchUp:B})});let V=[];Object.keys(O).forEach(B=>{let G=e[B];G&&Object.keys(O[B]).forEach(j=>{let{drawDefinition:K}=Gd({tournamentRecord:G,drawId:j});K&&O[B][j].forEach(({matchUpId:Y})=>{let X=C[Y];if(X){let Z=X.split(":").map(rs).join(":"),J=`${Qe(m)}T${Z}`;w?V.push(Y):(Hd({drawDefinition:K,matchUpId:Y,scheduledTime:J}).success&&V.push(Y),T&&Pv({tournamentRecords:e,tournamentRecord:G,drawDefinition:K,matchUpId:Y,venueId:T}))}})})});let _=FF(A);return{...H,requestConflicts:Object.values(E),remainingScheduleTimes:P?.map(({scheduleTime:B})=>B),individualParticipantProfiles:o,matchUpNotBeforeTimes:l,participantIdsAtLimit:F,skippedScheduleTimes:R,overLimitMatchUpIds:k,scheduledMatchUpIds:V,noTimeMatchUpIds:_,recoveryTimeDeferred:M,dependencyDeferred:N}}function zQ({useDeepDependencies:t=!1,tournamentRecords:e,matchUps:i}){if(!Ga(i))return{error:Tu};if(i.some(({matchUpId:b,hasContext:S})=>b&&!S))return{info:"matchUps must have { inContext: true, nextMatchUps: true }",error:KE};let r=Math.max(...i.map(({schedule:b})=>b?.courtOrder||1).map(b=>Ye(b))),n=Re(1,r+1).map(b=>i.filter(S=>Ye(S.schedule?.courtOrder)===b)),a={},s={},o={};n.flat().filter(Boolean).sort(gh).forEach(({schedule:b})=>delete b[QT]);let l=rt(i.map(({drawId:b})=>b)),u=oo({includeParticipantDependencies:!0,tournamentRecords:e,drawIds:l}),c=u.matchUpDependencies,d=t?u.positionDependencies??{}:{},p=n.map((b,S)=>b.reduce((U,T)=>{if(!T.matchUpId)return U;let{matchUpId:P,winnerMatchUpId:D,loserMatchUpId:E,schedule:R,sides:C,potentialParticipants:M}=T,N=R?.courtId;a[P]=S,s[N]=[],U.matchUpIds.push(P),o[P]=T;let A=c[P].matchUpIds;A.length&&U.sourceMatchUpIds.push(...A);let O=C?.flatMap(F=>[F.participant?.individualParticipantIds,F.participantId]).flat().filter(Boolean)??[],k=M?.flat().flatMap(({individualParticipantIds:F,participantId:x})=>[F,x]).flat().filter(Boolean)||[];return U.participantIds.push(...k,...O),D&&U.targetMatchUpIds.push(D),E&&U.targetMatchUpIds.push(E),U},{sourceMatchUpIds:[],targetMatchUpIds:[],participantIds:[],matchUpIds:[]})),f=(b,S)=>c[b].sources.reduce((U,T,P)=>T.includes(S)&&P+1||U,0),m=p.map(()=>[]),h=(b,S,U)=>{U[b]||(U[b]={}),U[b][kl]||(U[b][kl]=S.filter(T=>T!==b))},g=(b,S,U)=>{S.participantIds.filter(T=>b.participantIds.includes(T)).forEach(T=>{let P=S.matchUpIds.concat(b.matchUpIds).filter(D=>c[D].participantIds.includes(T));P.forEach(D=>{h(D,P,U)})})},I=(b,S,U)=>{U[b]||(U[b]={}),U[b][Al]||(U[b][Al]=S.filter(T=>T!==b))},v=b=>{let S={},U=va(b.participantIds),T=new Set(Object.keys(U).filter(D=>U[D]>1)),P=b.matchUpIds.filter(D=>c[D].participantIds.some(E=>T.has(E)));return P.forEach(D=>{I(D,P,S)}),S},w=b=>{let S={},U={};return b.forEach(T=>{let{matchUpId:P,schedule:D}=T;if(!P||!D?.courtId||!D?.scheduledDate)return;let E=`${D.courtId}|${D.scheduledDate}`;U[E]||(U[E]=[]),U[E].push(P)}),Object.values(U).forEach(T=>{T.length>1&&T.forEach(P=>{S[P]=T.filter(D=>D!==P)})}),S},y=(b,S,U,T)=>{if(!o[b].schedule[QT]){o[b].schedule[QT]=S,o[b].schedule[KK]=T,m[a[b]].push({matchUpId:b,issueType:U,issueIds:T,issue:S});let P=o[b].schedule.courtId;s[P]||(s[P]=[]),s[P].push({matchUpId:b,issue:S,issueType:U,issueIds:T})}};if(p.forEach((b,S)=>{let U=S?p[S-1]:void 0,T=p.slice(S+1),P=v(b),D=w(n[S].filter(E=>b.matchUpIds.includes(E.matchUpId)));U&&g(U,b,P),b.matchUpIds.forEach(E=>{let R=c[E].matchUpIds;for(let M of T){let N=M.matchUpIds.filter(A=>R.includes(A));N?.length&&(N.forEach(A=>y(A,Sy,Za,[E])),y(E,Sy,Za,N))}if(D[E]&&y(E,Al,qK,D[E]),P[E]?.[Al]&&y(E,Al,hO,P[E][Al]),b.sourceMatchUpIds.includes(E)){let M=b.matchUpIds.filter(N=>c[N].matchUpIds.includes(E));y(E,Al,Za,M),b.matchUpIds.filter(N=>c[N].matchUpIds.includes(E)).forEach(N=>y(N,Al,Za,[E]))}let C=U?.matchUpIds?.filter(M=>f(E,M)>1);if(C?.length&&(y(E,Uy,Za,C),C.forEach(M=>y(M,Uy,Za,[E]))),P[E]?.[kl]&&y(E,kl,hO,P[E][kl]),U?.targetMatchUpIds?.includes(E)){let M=o[E].schedule.courtId,N=R.filter(A=>U.matchUpIds.includes(A));N.some(A=>o[A].schedule.courtId===M)||(N.forEach(A=>y(A,kl,Za,[E])),y(E,kl,Za,N))}})}),t){let b=new Set(Object.keys(a)),S={};for(let P of b)S[P]=new Set(c[P]?.dependentMatchUpIds??[]);let U=0;for(let P of b){let D=c[P]?.sources?.length??0;D>U&&(U=D)}let T=P=>{let D=new Set(P.participantIds),E={};for(let R of P.matchUpIds){let C=c[R]?.participantIds??[];for(let M of C)D.has(M)||(E[M]||(E[M]=new Set),E[M].add(R))}return E};if(p.forEach((P,D)=>{let E=T(P);for(let[,R]of Object.entries(E))if(R.size>1){let C=[...R];for(let M of C)y(M,kl,gO,C.filter(N=>N!==M))}if(D>0){let R=p[D-1],C=T(R);for(let[M,N]of Object.entries(E))if(C[M]){let A=[...new Set([...N,...C[M]])];for(let O of A)y(O,kl,gO,A.filter(k=>k!==O))}}}),p.forEach((P,D)=>{for(let E of P.matchUpIds)for(let R=2;R<=Math.min(D,U);R++){let C=p[D-R];for(let M of C.matchUpIds){let N=f(E,M);N>0&&R<N&&(y(E,Uy,Za,[M]),y(M,Uy,Za,[E]))}}}),p.forEach((P,D)=>{for(let E of P.matchUpIds){let R=S[E];if(!R?.size)continue;for(let M=0;M<D;M++){let N=p[M].matchUpIds.filter(A=>R.has(A));if(N.length){for(let A of N)y(A,Sy,Za,[E]);y(E,Sy,Za,N)}}let C=P.matchUpIds.filter(M=>M!==E&&R.has(M));if(C.length){for(let M of C)y(M,Al,Za,[E]);y(E,Al,Za,C)}}}),Object.keys(d).length){let P=new Set(Object.values(d).flat());p.forEach(D=>{for(let E of D.matchUpIds){let R=(c[E]?.matchUpIds??[]).filter(C=>P.has(C)).filter(C=>!b.has(C));R.length&&y(E,kl,YK,R)}})}}return{courtIssues:s,rowIssues:m}}function qQ(t){let e="reorderUpcomingMatchUps",{tournamentRecords:i}=t;if(typeof i!="object"||!Object.keys(i).length)return z({result:{error:Ci},stack:e});let{matchUpsContextIds:r,firstToLast:n}=t;if(!r)return z({result:{error:Xe},stack:e});let a=r?.length;if(!a)return{...H};let s=0;return r.forEach((l,u)=>{let{tournamentId:c,drawId:d,matchUpId:p}=l,f=u+(n?-1:1);f<0&&(f=a-1),f===a&&(f=0);let m=r[f].schedule.scheduledTime,h=o({tournamentId:c,scheduledTime:m,matchUpId:p,drawId:d});if(h.success)s++;else return h}),s===a?H:z({result:{error:h4},stack:e});function o({tournamentId:l,scheduledTime:u,matchUpId:c,drawId:d}){let p=i[l],{drawDefinition:f}=Gd({tournamentRecord:p,drawId:d});return f?Hd({drawDefinition:f,scheduledTime:u,matchUpId:c}):{error:Oa}}}function YQ(t){let{scheduleChange:e,matchUpIds:i,dryRun:r}=t;if(!i||!Array.isArray(i))return{error:th};if(typeof e!="object")return{error:ie};let n=Is(t),a=[],s=[];for(let l of Object.values(n)){let u=LMe({tournamentRecord:l,scheduleChange:e,matchUpIds:i,dryRun:r});if(u.error)return u;Array.isArray(u.notRescheduled)&&s.push(...u.notRescheduled);let c=FF(u.notRescheduled),d=[];u.rescheduled?.forEach(p=>{let{matchUpId:f}=p;c.includes(f)&&d.push(f),a.push(p)}),d.length&&(s=u?.notRescheduled?.filter(({matchUpId:p})=>!d.includes(p))||[])}let o=!!(a.length&&!s.length);return{...H,rescheduled:a,notRescheduled:s,allRescheduled:o}}function LMe({tournamentRecord:t,scheduleChange:e,matchUpIds:i,dryRun:r}){if(!t)return{error:Ie};if(!i||!Array.isArray(i))return{error:th};if(typeof e!="object")return{error:ie};let n=[],a=[],{minutesChange:s,daysChange:o}=e;if(!s&&!o)return{...H};if(s&&isNaN(s))return{error:ie};if(o&&isNaN(o))return{error:ie};let{matchUps:l}=br({matchUpFilters:{matchUpIds:i},tournamentRecord:t}),u=({matchUpStatus:y})=>!Yi.includes(y),c=l?.filter(y=>AS({schedule:y.schedule})).filter(y=>u({matchUpStatus:y.matchUpStatus}));if(!c?.length)return{...H};let{tournamentInfo:d}=Th({tournamentRecord:t}),{startDate:p,endDate:f}=d,m=c?.reduce((y,b)=>{let{matchUpId:S,drawId:U}=b;return y[U]?y[U].push(S):y[U]=[S],y},{}),h=1440;for(let y of Object.keys(m)){let b=Gd({tournamentRecord:t,drawId:y});if(b.error)return b;let S=b.drawDefinition,U=m[y].filter(T=>i.includes(T));for(let T of U)if(T&&S){let P=c.find(N=>N.matchUpId===T)?.schedule,{scheduledTime:D,scheduledDate:E}=P,R,C,M;if(!R&&o&&E){let N=Qe(E);M=wy(N,o),R=new Date(M)<new Date(p)||new Date(M)>new Date(f)}if(s&&D){let N=Qe(D),A=Pt(ci(D))+s;if(R=A<0||A>h,!R){let O=Jn(D,s),k=N&&M||E===N&&N;C=k?`${k}T${O}`:O}}if(R)a.push(T);else{if(!r){if(C){let N=Hd({scheduledTime:C,drawDefinition:S,matchUpId:T});if(N.error)return N}if(M){let N=_C({scheduledDate:M,drawDefinition:S,matchUpId:T});if(N.error)return N}}(C||M)&&n.push(T)}}}let g=br({matchUpFilters:{matchUpIds:i},tournamentRecord:t}).matchUps??[],I=g.filter(({matchUpId:y})=>n.includes(y)),v=g.filter(({matchUpId:y})=>a.includes(y)),w=I.length&&!v.length;return{...H,rescheduled:I,notRescheduled:v,allRescheduled:w}}function KQ(t){let e="matchUpScheduleChange",{tournamentRecords:i}=t;if(typeof i!="object"||!Object.keys(i).length)return{error:Ci};let{sourceMatchUpContextIds:r,targetMatchUpContextIds:n,sourceCourtId:a,targetCourtId:s,courtDayDate:o}=t||{},{drawId:l,matchUpId:u,tournamentId:c}=r||{},{drawId:d,matchUpId:p,tournamentId:f}=n||{};if(!u&&!p)return z({result:{error:Xe},stack:e});let{matchUps:m}=Eo({matchUpFilters:{matchUpIds:[u,p].filter(Boolean),drawIds:[l,d].filter(Boolean)},tournamentRecords:t.tournamentRecords}),h=m?.find(({matchUpId:y})=>y===u),g=m?.find(({matchUpId:y})=>y===p),I=0;if(s&&u&&!p){let y=v({tournamentId:c,matchUpId:u,courtId:s,matchUp:h,drawId:l,tournamentRecords:i,sourceCourtId:a,courtDayDate:o});if(y?.success&&I++,y.error)return z({result:y,stack:e})}else if(a&&s&&u&&p){let y=v({tournamentId:c,matchUpId:u,courtId:s,matchUp:h,drawId:l,tournamentRecords:i,sourceCourtId:a,courtDayDate:o});if(y.success&&I++,y.error)return z({result:y,stack:e,info:"source"});let b=v({tournamentId:f,sourceCourtId:s,matchUpId:p,matchUp:g,courtId:a,drawId:d,tournamentRecords:i,courtDayDate:o});if(b.success&&I++,b.error)return z({result:b,stack:e,info:"target"})}else return{error:Xe};return I?H:z({result:{error:tv},stack:e});function v(y){let{tournamentRecords:b,tournamentId:S,matchUp:U,drawId:T}=y,P=b[S],{drawDefinition:D}=Gd({tournamentRecord:P,drawId:T});return U.matchUpType===Zt?w({...y,tournamentRecord:P,drawDefinition:D}):Eh({...y,tournamentRecord:P,drawDefinition:D})}function w({removePriorValues:y,tournamentRecords:b,tournamentRecord:S,drawDefinition:U,sourceCourtId:T,courtDayDate:P,matchUpId:D,matchUp:E,courtId:R}){let C=[R].concat(E.schedule.allocatedCourts.map(({courtId:M})=>M).filter(M=>M!==T));return $C({removePriorValues:y,tournamentRecords:b,tournamentRecord:S,drawDefinition:U,courtDayDate:P,matchUpId:D,courtIds:C})}}function XQ({scheduleAttributes:t=[lu,Id,ph,fh,mh,mo,gc,Gl,Zu],tournamentRecord:e,drawDefinition:i,matchUpId:r}){let n="clearMatchUpSchedule",a=i?Rn({matchUpFilters:{matchUpIds:[r]},inContext:!1,drawDefinition:i}).matchUps?.[0]:br({matchUpFilters:{matchUpIds:[r]},tournamentRecord:e,inContext:!1}).matchUps?.[0];if(!a)return{error:un};let s=(a.timeItems??[]).filter(o=>o?.itemType&&!t.includes(o?.itemType));return a.timeItems=s,St({tournamentId:e.tournamentId,context:n,drawDefinition:i,matchUp:a}),{...H}}function JQ(t){let{tournamentRecord:e,tournamentId:i,dailyLimits:r}=t,n=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(typeof n!="object"||!Object.keys(n).length)return{error:Ci};if(typeof r!="object")return{error:Ac};let a=Object.keys(n).filter(s=>!i||i===s);if(i&&!a.includes(i))return{error:ie};for(let s of a){let o=n[s],l=xt({extension:{name:Hw,value:{dailyLimits:r}},element:o});if(l.error)return l}return{...H}}function QQ(t){let{tournamentRecord:e,disableNotice:i,scheduledDate:r,bookingType:n,courtOrder:a,rowCount:s=1,courtId:o,notes:l}=t;if(!e)return z({result:{error:ie},info:"tournamentRecord is required"});if(!o)return{error:ac};if(!r)return z({result:{error:ie},info:"scheduledDate is required"});if(!n)return z({result:{error:ie},info:"bookingType is required"});if(a==null)return z({result:{error:ie},info:"courtOrder is required"});if(!Number.isInteger(a)||a<1)return z({result:{error:ie},info:"courtOrder must be a positive integer"});if(!Number.isInteger(s)||s<1)return z({result:{error:ie},info:"rowCount must be a positive integer"});let{court:u,venue:c}=jd({tournamentRecord:e,courtId:o});if(!u)return{error:ac};if(!bd({court:u,date:r})){u.dateAvailability||(u.dateAvailability=[]);let f={date:r,bookings:[]};u.dateAvailability.push(f)}let d=bd({court:u,date:r});if(d.bookings){for(let f of d.bookings)if(typeof f.courtOrder=="number"){let m=f.courtOrder,h=m+(f.rowCount||1)-1,g=a,I=a+s-1;if(g<=h&&I>=m)return z({result:{error:l4},info:`Booking conflicts with existing booking at rows ${m}-${h}`})}}let p={courtOrder:a,rowCount:s,bookingType:n,notes:l,createdAt:new Date().toISOString()};return d.bookings||(d.bookings=[]),d.bookings.push(p),!i&&c&&at({payload:{venue:c,tournamentId:e.tournamentId},topic:xc,key:c.venueId}),{...H,booking:p}}function ZQ(t){let{tournamentRecord:e,disableNotice:i,scheduledDate:r,courtOrder:n,courtId:a}=t;if(!e)return z({result:{error:ie},info:"tournamentRecord is required"});if(!a)return{error:ac};if(!r)return z({result:{error:ie},info:"scheduledDate is required"});if(n==null)return z({result:{error:ie},info:"courtOrder is required"});let{court:s,venue:o}=jd({tournamentRecord:e,courtId:a});if(!s)return{error:ac};let l=bd({court:s,date:r});if(!l?.bookings)return z({result:{error:tO},info:"No bookings found for this date"});let u=l.bookings.findIndex(d=>d.courtOrder===n);if(u===-1)return z({result:{error:tO},info:`No booking found at row ${n}`});let c=l.bookings.splice(u,1)[0];return!i&&o&&at({payload:{venue:o,tournamentId:e.tournamentId},topic:xc,key:o.venueId}),{...H,booking:c}}var eZ={};ct(eZ,{addCollectionDefinition:()=>o$,addCollectionGroup:()=>sZ,aggregateTieFormats:()=>lZ,compareTieFormats:()=>Ic,getTieFormat:()=>vC,modifyCollectionDefinition:()=>a$,modifyTieFormat:()=>oZ,mutate:()=>tZ,orderCollectionDefinitions:()=>nZ,query:()=>hX,removeCollectionDefinition:()=>s$,removeCollectionGroup:()=>rZ,tieFormatGenderValidityCheck:()=>nR,validateCollectionDefinition:()=>Lw});var tZ={};ct(tZ,{addCollectionDefinition:()=>o$,addCollectionGroup:()=>sZ,aggregateTieFormats:()=>lZ,modifyCollectionDefinition:()=>a$,modifyTieFormat:()=>oZ,orderCollectionDefinitions:()=>nZ,removeCollectionDefinition:()=>s$,removeCollectionGroup:()=>rZ});function Fp({drawDefinition:t,structureId:e,matchUpId:i,structure:r,matchUp:n,eventId:a,event:s}){let o="getTieFormat",l;if(e=r?.structureId??e,i=n?.matchUpId??i,(i||e)&&!t)return{error:_e};if(a&&s)l=$o(s);else if(i){if(t&&(!n||!r)){let u=di({drawDefinition:t,matchUpId:i});if(u.error)return u;if(u.matchUp?.matchUpType!==ka)return z({result:{error:ia},stack:o});r||(r=u.structure),n||(n=u.matchUp)}l=_y({item:n,drawDefinition:t,structure:r,event:s})||_y({item:r,drawDefinition:t,structure:r,event:s})||$o(t)||$o(s)}else if(t&&e){if(!r){let u=et({drawDefinition:t,structureId:e});if(u.error)return u;r=u?.structure}l=_y({item:r,drawDefinition:t,structure:r,event:s})||$o(t)||$o(s)}else l=$o(t)||$o(s);return l?{...H,structure:r,tieFormat:l,matchUp:n}:z({result:{error:ZI},stack:o})}function SP({matchUp:t,updateInProgressMatchUps:e}){return!t.winningSide&&![Yi].includes(t.matchUpStatus)&&(e||t.matchUpStatus!==ao&&!cr(t))}function jA({from:t,to:e}){let i=Object.keys(t),r=xi(i,Object.keys(e)).length===i.length,n=i.filter(s=>t[s]!==e[s]).map(s=>({countChange:e[s]-t[s],collectionId:s})),a=i.every(s=>t[s]===e[s]);return{equivalent:r&&a,matchUpsCountChanges:n}}function _Me({updateInProgressMatchUps:t,tournamentRecord:e,drawDefinition:i,structure:r,tieFormat:n,eventId:a,matchUp:s,event:o,uuids:l}){let u="updateTieFormat",c=e?.tournamentId,d=0,p=0,f=0,m=0,h=n?.collectionDefinitions.reduce((S,U)=>(S[U.collectionId]=(S[U.collectionId]||0)+U.matchUpCount,S),{}),g=({tieFormat:S})=>{let U=S?.collectionDefinitions.reduce((T,P)=>(T[P.collectionId]=(T[P.collectionId]||0)+P.matchUpCount,T),{});return jA({from:U,to:h}).equivalent},I=Fp({drawDefinition:i})?.tieFormat,v=Fp({event:o})?.tieFormat;if(o&&a){for(let S of o.drawDefinitions??[])w({drawDefinition:S});o.tieFormat=jr(n),m+=1}else if(s){if(!s.tieMatchUps)return z({result:{error:ia},stack:u});let S=va(s.tieMatchUps?.map(({collectionId:E})=>E)),U=jA({to:h,from:S}),{changes:T,changesArePossible:P,cannotChangeReaon:D}=LW({matchUp:s,check:U});if(U.equivalent)if(SP({matchUp:s,updateInProgressMatchUps:t}))s.tieFormat=jr(n),m+=1;else return z({result:{error:W1},info:"matchUp is IN_PROGRESS or COMPLETE",stack:u});else if(P)b({tieFormat:n,matchUp:s,changes:T,uuids:l});else return z({context:{collectionMap:h,matchUpMap:S},result:{error:Vl},info:D||"specified changes not possible",stack:u});p+=1,St({eventId:o?.eventId,context:u,drawDefinition:i,tournamentId:c,matchUp:s})}else if(r){let S=y({inheritedTieFormat:I??v,structure:r})?.modifiedMatchUpsCount;S&&(p+=S,d+=1,m+=1);let U=!r.tieFormat||Ic({ancestor:r.tieFormat,descendant:n}).different;U&&(r.tieFormat=jr(n),d+=1,m+=1),(S||U)&&i&&ti({structureIds:[r.structureId],eventId:o?.eventId,drawDefinition:i})}else if(i)w({drawDefinition:i}),i.tieFormat=jr(n),m+=1;else return{error:_e};return{modifiedStructuresCount:d,modifiedMatchUpsCount:p,addedMatchUpsCount:f,modifiedCount:m,...H,tieFormat:n};function w({drawDefinition:S}){let U=S.structures||[],T=[];for(let P of U){if(P.tieFormat)continue;let D=y({inheritedTieFormat:v,structure:P})?.modifiedMatchUpsCount;if(D){d+=1,p+=D;let E=P.structureId;T.push(E)}}return ti({structureIds:T,eventId:o?.eventId,drawDefinition:S}),T.length}function y({inheritedTieFormat:S,structure:U}){let T=0,P=Nt({matchUpFilters:{matchUpTypes:[Zt]},structure:U})?.matchUps||[];for(let D of P){let E=SP({matchUp:D,updateInProgressMatchUps:t}),R=!1,C=va(D.tieMatchUps?.map(({collectionId:N})=>N)),M=jA({from:C,to:h});if(M.equivalent)D.tieFormat&&g(D)&&E&&(D.tieFormat=jr(n),R=!0);else{let{changes:N,changesArePossible:A}=LW({matchUp:D,check:M});if(A&&!D.tieFormat)b({changes:N,matchUp:D,tieFormat:n,uuids:l});else if(S)(!D.tieFormat||Ic({ancestor:S,descendant:D.tieFormat}).different)&&(D.tieFormat=S,R=!0);else return z({result:{error:ZI},stack:u})}R&&(T+=1,St({tournamentId:e?.tournamentId,drawDefinition:i,context:u,eventId:a,matchUp:D}))}return{modifiedMatchUpsCount:T}}function b({uuids:S,matchUp:U,tieFormat:T,changes:P}){U.tieFormat=jr(T);let D=[],E=[];return P.forEach(R=>{if(R.countChange>0){let C=Math.max(0,...U.tieMatchUps.filter(A=>A.collectionId===R.collectionId).map(ba("collectionPosition"))),M=T.collectionDefinitions.find(A=>A.collectionId===R.collectionId),N=yS({matchUpsLimit:R.countChange,collectionPositionOffset:C,collectionDefinition:M,matchUp:U,uuids:S});E.push(...ke(N,!1,!0)),f+=E.length,U.tieMatchUps.push(...N)}else{let C=R.toBePlayedTieMatchUpIds.slice(0,Math.abs(R.countChange));console.log("remove",C.length),D.push(...C),U.tieMatchUps=U.tieMatchUps.filter(({matchUpId:M})=>!C.includes(M))}}),E.length&&hd({matchUps:E,drawDefinition:i,tournamentId:c,eventId:a}),D.length&&Pu({matchUpIds:D,action:"updateTieFormat",drawDefinition:i,tournamentId:c,eventId:a}),{matchUpIdsRemoved:D,matchUpsAdded:E}}}function LW({check:t,matchUp:e}){let i="",r=[];return{changesArePossible:t.matchUpsCountChanges.every(({collectionId:n,countChange:a})=>{let s=e.tieMatchUps.filter(l=>l.collectionId===n&&l.matchUpStatus===Fi).map(ba("matchUpId")),o=s.length+a>=0||a>0;return!o&&a<0&&(i="Insufficient TO_BE_PLAYED matchUps"),r.push({toBePlayedTieMatchUpIds:s,collectionId:n,countChange:a}),o}),changes:r,cannotChangeReaon:i}}function YC({appliedPolicies:t,drawDefinition:e,auditData:i}){if(!t?.audit?.[Fy])return;let{extension:r}=mt({name:Fy,element:e}),n={value:Array.isArray(r?.value)?r?.value.concat(i):[i],name:Fy};xt({element:e,extension:n})}function a$({updateInProgressMatchUps:t=!1,tournamentRecord:e,collectionOrder:i,collectionName:r,tieFormatName:n,drawDefinition:a,matchUpFormat:s,matchUpCount:o,collectionId:l,matchUpType:u,structureId:c,matchUpId:d,category:p,eventId:f,gender:m,event:h,collectionValueProfiles:g,collectionValue:I,matchUpValue:v,scoreValue:w,setValue:y}){let b="modifyCollectionDefinition";if(s&&!xa({matchUpFormat:s}))return z({result:{error:ie},context:{matchUpFormat:s},stack:b});if(r&&typeof r!="string")return z({result:{error:ie},context:{collectionName:r},stack:b});if(m&&!Object.values(rR).includes(m))return z({result:{error:ie},context:{gender:m},stack:b});if(p&&typeof p!="object")return z({result:{error:ie},context:{category:p},stack:b});let S={collectionValueProfiles:g,collectionValue:I,matchUpValue:v,scoreValue:w,setValue:y};if(!Object.values(S).filter(Boolean).length&&!i&&!r&&!s&&!o&&!u)return z({result:{error:Xe},stack:b});if(Object.values(S).filter(Boolean).length>1)return z({info:"Only one value assignment allowed per collectionDefinition",result:{error:ie},stack:b});let U=Fp({drawDefinition:a,structureId:c,matchUpId:d,eventId:f,event:h});if(U.error)return z({result:U,stack:b});let{matchUp:T,structure:P,tieFormat:D}=U,E=jr(D),R=D?.collectionDefinitions.find(V=>V.collectionId===l),C=E?.collectionDefinitions.find(V=>V.collectionId===l);if(!R)return z({info:"source collectionDefinition",result:{error:_r},context:{collectionId:l},stack:b});let M=I??v??w??y;if(g?.length){let V=c6({matchUpCount:o??R?.matchUpCount??0,collectionValueProfiles:g});if(V.errors)return z({result:{error:ie},info:V.errors,stack:b})}else if(M&&!ot(M))return z({result:{error:ie},info:"value is not an integer",context:{value:M},stack:b});let N=(V,_)=>xi(Object.keys(V),Object.keys(_)).length===Object.keys(V).length&&xi(Object.values(V),Object.values(_)).length===Object.values(V).length,A=g&&(!R.collectionValueProfiles||!N(R.collectionValueProfiles,g)),O=ot(I)&&R.collectionValue!==I||ot(v)&&R.matchUpValue!==v||ot(w)&&R.scoreValue!==w||ot(y)&&R.setValue!==y||A,k=[];if(O&&(C.collectionValueProfiles=void 0,C.collectionValue=void 0,C.matchUpValue=void 0,C.scoreValue=void 0,C.setValue=void 0,Object.assign(C,S),k.push({collectionId:l,...Ve(S)})),(ot(w)||ot(y))&&C.collectionGroupNumber){let V=C.collectionGroupNumber;E.collectionDefinitions=E.collectionDefinitions.map(_=>{let{collectionGroupNumber:B,...G}=_;return B===V?G:_}),E.collectionGroups=E.collectionGroups.filter(({groupNumber:_})=>_!==V),k.push({collectionId:l,change:"collectionGroupNumber removed"})}let{aggregateValue:F,valueGoal:x}=Ph(E),L=Ve({aggregateValue:F,valueGoal:x});if((L.aggregateValue!==D?.winCriteria.aggregateValue||L.valueGoal!==D?.winCriteria.valueGoal)&&(E.winCriteria=L,k.push({collectionId:l,winCriteria:L})),ot(i)&&R.collectionOrder!==i&&(C.collectionOrder=i,k.push({collectionId:l,collectionOrder:i})),r&&R.collectionName!==r&&(C.collectionName=r,k.push({collectionId:l,collectionName:r})),s&&R.matchUpFormat!==s&&(C.matchUpFormat=s,k.push({collectionId:l,matchUpFormat:s})),ot(o)&&R.matchUpCount!==o&&(C.matchUpCount=o,k.push({collectionId:l,matchUpCount:o})),u&&R.matchUpType!==u)return z({result:{error:iF},context:{matchUpType:u},stack:b});p&&R.category!==p&&(C.category=p,k.push({collectionId:l,category:p})),m&&R.gender!==m&&(C.gender=m,k.push({collectionId:l,gender:m}));let $=Ve(E);if(U=Bn({tieFormat:$}),U.error)return z({result:U,stack:b});if(!k.length)return z({result:{...H,modifications:k}});if(D?.tieFormatName!==n?($.tieFormatName=n,k.push({tieFormatName:n})):k.length&&(delete $.tieFormatName,k.push("tieFormatName removed: modifications without new tieFormatName")),U=_Me({tieFormat:$,updateInProgressMatchUps:t,tournamentRecord:e,drawDefinition:a,structure:P,eventId:f,matchUp:T,event:h}),!U.error){let{appliedPolicies:V}=Tt({tournamentRecord:e}),_=Ve({collectionDefinition:C,drawId:a?.drawId,action:b,structureId:c,matchUpId:d,eventId:f});YC({appliedPolicies:V,drawDefinition:a,auditData:_})}return z({result:{...U,modifications:k},stack:b})}function $Me({updateInProgressMatchUps:t,drawDefinition:e,structureId:i,structure:r,matchUpId:n,matchUp:a}){let s=[];return n&&a?s=[a]:i&&r?s=Nt({matchUpFilters:{matchUpTypes:[Zt]},structure:r})?.matchUps??[]:e&&(s=Rn({matchUpFilters:{matchUpTypes:[Zt]},drawDefinition:e})?.matchUps??[]),{targetMatchUps:s.filter(o=>!o.winningSide&&o.matchUpStatus!==ki&&(t||o.matchUpStatus!==ao&&!cr(o)))}}function BMe({updateInProgressMatchUps:t,tournamentRecord:e,drawDefinition:i,targetMatchUps:r,tieFormat:n,event:a}){for(let s of r){let o=!!s.tieFormat;o&&(s.tieFormat=jr(n));let l;if(t){let u=Tt({tournamentRecord:e,drawDefinition:i,event:a}).appliedPolicies,c=_c({matchUpId:s.matchUpId,exitWhenNoValues:!0,tournamentRecord:e,appliedPolicies:u,drawDefinition:i,event:a});if(c.error)return c;l=c.score}o&&!l&&St({tournamentId:e?.tournamentId,context:"updateTargetTeamMatchUps",eventId:a?.eventId,matchUp:s,drawDefinition:i})}return{...H}}function iZ({updateInProgressMatchUps:t,originalValueGoal:e,tournamentRecord:i,wasAggregateValue:r,tieFormatName:n,drawDefinition:a,structureId:s,structure:o,tieFormat:l,matchUpId:u,matchUp:c,eventId:d,event:p}){let{aggregateValue:f,valueGoal:m}=Ph(l);l.winCriteria=Ve({aggregateValue:f,valueGoal:m}),(e&&e!==m||f&&!r)&&(n?l.tieFormatName=n:delete l.tieFormatName);let{targetMatchUps:h}=$Me({updateInProgressMatchUps:t,drawDefinition:a,structureId:s,structure:o,matchUpId:u,matchUp:c});BMe({updateInProgressMatchUps:t,tournamentRecord:i,targetMatchUps:h,drawDefinition:a,tieFormat:l,event:p});let g=Ve(l),I=Bn({tieFormat:g});if(I.error)return I;if(d&&p)p.tieFormat=g;else if(u&&c)c.tieFormat=l;else if(o)o.tieFormat=g;else if(a)a.tieFormat=g;else if(!c||!a)return{error:_e};return ti({drawDefinition:a,eventId:p?.eventId}),{...H}}function rZ({updateInProgressMatchUps:t=!0,collectionGroupNumber:e,tournamentRecord:i,drawDefinition:r,tieFormatName:n,structureId:a,matchUpId:s,matchUp:o,eventId:l,event:u}){if(!e)return{error:Xe};if(isNaN(e))return{error:ie};let c="removeCollectionGroup",d=o?void 0:Fp({drawDefinition:r,structureId:a,matchUpId:s,eventId:l,event:u});if(d?.error)return z({result:d,stack:c});let p=d?.structure;o=o??d?.matchUp;let f=d?.tieFormat,m=f?.winCriteria.valueGoal,h=f?.winCriteria.aggregateValue,g=jr(f);if(d=Bn({tieFormat:g}),d.error)return z({result:d,stack:c});let I=[];if(g.collectionDefinitions=g.collectionDefinitions.map(v=>{let{collectionGroupNumber:w,...y}=v;return w!==e?v:(I.push(v.collectionId),y)}),g.collectionGroups=g.collectionGroups.filter(({groupNumber:v})=>v!==e),d=iZ({updateInProgressMatchUps:t,originalValueGoal:m,wasAggregateValue:h,tournamentRecord:i,drawDefinition:r,tieFormatName:n,structureId:a,structure:p,tieFormat:g,matchUpId:s,matchUp:o,eventId:l,event:u}),!d.error){let{appliedPolicies:v}=Tt({tournamentRecord:i}),w=Ve({drawId:r?.drawId,collectionGroupNumber:e,action:c,structureId:a,matchUpId:s,eventId:l});YC({appliedPolicies:v,drawDefinition:r,auditData:w})}return z({result:{...d,modifiedCollectionIds:I},stack:c})}function mI({tieFormat:t,orderMap:e}){let i=jr(t);return i.collectionDefinitions?.forEach(r=>{let n=e[r.collectionId];n&&(r.collectionOrder=n)}),i.collectionDefinitions?.sort((r,n)=>qg(r.collectionOrder)-qg(n.collectionOrder)),i}function nZ({tournamentRecord:t,drawDefinition:e,structureId:i,matchUpId:r,orderMap:n,eventId:a,matchUp:s,event:o}){if(typeof n!="object"||!Object.values(n).every(c=>ot(c)))return z({result:{error:ie},context:{orderMap:n}});let l=i?et({drawDefinition:e,structureId:i}):void 0;if(l?.error)return l;let u=l?.structure;if(a&&o?.tieFormat)_W({tournamentRecord:t,event:o,orderMap:n});else if(r){let c=e&&di({drawDefinition:e,matchUpId:r});if(c?.error)return c;if(s=c.matchUp,!s)return{error:ta};let d=vC({tournamentRecord:t,matchUpId:r,structure:u,drawDefinition:e,event:o})?.tieFormat;s.tieFormat=mI({tieFormat:d,orderMap:n}),St({tournamentId:t?.tournamentId,eventId:o?.eventId,drawDefinition:e,matchUp:s})}else if(i)if(u?.tieFormat)u.tieFormat=mI({tieFormat:u.tieFormat,orderMap:n}),aZ({eventId:o?.eventId,tournamentRecord:t,drawDefinition:e,structure:u,orderMap:n}),ti({drawDefinition:e,structureIds:[u.structureId]});else if(e.tieFormat)HO({structureIds:[i],tournamentRecord:t,drawDefinition:e,orderMap:n,event:o});else if(o?.tieFormat)_W({structureIds:[i],tournamentRecord:t,orderMap:n,event:o});else return{error:_r};else if(e?.tieFormat)HO({tournamentRecord:t,drawDefinition:e,orderMap:n,event:o});else return{error:_r};return{...H}}function _W({tournamentRecord:t,structureIds:e,orderMap:i,event:r}){let n=mI({tieFormat:r.tieFormat,orderMap:i});e?.length||(r.tieFormat=n);for(let a of r.drawDefinitions??[])HO({tournamentRecord:t,drawDefinition:a,structureIds:e,orderMap:i,event:r})}function HO({tournamentRecord:t,drawDefinition:e,structureIds:i,orderMap:r,event:n}){let a=e.tieFormat??n?.tieFormat,s=mI({tieFormat:a,orderMap:r});i?.length||(e.tieFormat=s);let o=[];for(let l of e.structures??[])i?.length&&!i.includes(l.structureId)||((l.tieFormat||i?.includes(l.structureId))&&(l.tieFormat=mI({tieFormat:l.tieFormat??e.tieFormat??n?.tieFormat,orderMap:r})),aZ({eventId:n?.eventId,tournamentRecord:t,drawDefinition:e,structure:l,orderMap:r}),o.push(l.structureId));ti({drawDefinition:e,structureIds:o})}function aZ({tournamentRecord:t,drawDefinition:e,structure:i,orderMap:r,eventId:n}){let a=Nt({matchUpFilters:{matchUpTypes:[Zt]},structure:i})?.matchUps;for(let s of a)s.tieFormat&&(s.tieFormat=mI({tieFormat:s.tieFormat,orderMap:r}),St({tournamentId:t?.tournamentId,drawDefinition:e,eventId:n,matchUp:s}))}function s$({updateInProgressMatchUps:t=!0,tieFormatComparison:e,tournamentRecord:i,drawDefinition:r,tieFormatName:n,collectionId:a,structureId:s,matchUpId:o,eventId:l,matchUp:u,event:c}){let d="removeCollectionDefinition",p=u?void 0:Fp({drawDefinition:r,structureId:s,matchUpId:o,eventId:l,event:c});if(p?.error)return z({result:p,stack:d});let f=p?.structure;u=u??p?.matchUp;let m=p?.tieFormat,h=jr(m);if(p=Bn({tieFormat:h}),p.error)return z({result:p,stack:d});let g=h?.collectionDefinitions?.find(E=>E.collectionId===a);if(!g)return z({result:{error:_r,collectionId:a}});h.collectionDefinitions=h.collectionDefinitions.filter(E=>E.collectionId!==a),g.collectionGroupNumber&&(h.collectionDefinitions=h.collectionDefinitions.map(E=>{let{collectionGroupNumber:R,...C}=E;return C}),h.collectionGroups=h.collectionGroups.filter(({groupNumber:E})=>E!==g.collectionGroupNumber));let{aggregateValue:I,valueGoal:v}=Ph(h);h.winCriteria=Ve({aggregateValue:I,valueGoal:v});let w=m?.winCriteria.valueGoal,y=m?.winCriteria.aggregateValue;(w&&w!==v||I&&!y)&&(n?h.tieFormatName=n:delete h.tieFormatName);let b=[];o&&u?b=[u]:s&&f?b=Nt({matchUpFilters:{matchUpTypes:[Zt]},structure:f})?.matchUps??[]:r?b=Rn({matchUpFilters:{matchUpTypes:[Zt]},drawDefinition:r})?.matchUps??[]:c&&(b=Ru({matchUpFilters:{matchUpTypes:[Zt]}})?.matchUps??[]);let S=(b||[]).filter(E=>{let R=E.tieMatchUps?.filter(M=>M.collectionId===a)?.some(cr),C=e&&E.tieFormat?Ic({descendant:E.tieFormat,ancestor:h})?.different:!1;return t&&!R||!E.winningSide&&E.matchUpStatus!==ki&&(t||E.matchUpStatus!==ao&&!cr(E)&&!C)});if(!S.length)return{error:tv};let{appliedPolicies:U}=Tt({tournamentRecord:i});if(o&&u&&t){let E=u.tieMatchUps?.filter(R=>R.collectionId===a);for(let R of E??[]){let C=ff({matchUpId:R.matchUpId,tieMatchUpId:u?.matchUpId,winningSide:void 0,removeScore:!0,tournamentRecord:i,appliedPolicies:U,drawDefinition:r,event:c});if(C.error||(C=di({drawDefinition:r,matchUpId:o}),C.error))return C;u=C?.matchUp}}let T=[];for(let E of S){for(let R of E?.sides??[])R.lineUp=(R.lineUp??[]).map(C=>({participantId:C.participantId,collectionAssignments:(C?.collectionAssignments??[]).filter(M=>M.collectionId!==a)}));if(E.tieMatchUps=(E.tieMatchUps??[]).filter(R=>{let C=R.collectionId===a;return C&&T.push(R.matchUpId),!C}),E.tieFormat&&(E.tieFormat=jr(h)),t){let R=_c({matchUpId:E.matchUpId,exitWhenNoValues:!0,tournamentRecord:i,appliedPolicies:U,drawDefinition:r,event:c});if(R.error)return R}St({tournamentId:i?.tournamentId,eventId:c?.eventId,drawDefinition:r,context:d,matchUp:E})}T.length&&Pu({tournamentId:i?.tournamentId,matchUpIds:T,eventId:c?.eventId,drawDefinition:r});let P=Ve(h);if(p=Bn({tieFormat:P}),p.error)return z({result:p,stack:d});if(l&&c)c.tieFormat=P;else if(o&&u)u.tieFormat=P;else if(f)f.tieFormat=P;else if(r)r.tieFormat=P;else if(!u||!r)return{error:_e};ti({drawDefinition:r,eventId:c?.eventId});let D=Ve({drawId:r?.drawId,action:d,collectionId:a,structureId:s,matchUpId:o,eventId:l});return YC({appliedPolicies:U,drawDefinition:r,auditData:D}),{tieFormat:P,deletedMatchUpIds:T,targetMatchUps:S,...H}}function sZ({updateInProgressMatchUps:t=!0,tournamentRecord:e,groupDefinition:i,drawDefinition:r,collectionIds:n,tieFormatName:a,structureId:s,matchUpId:o,matchUp:l,eventId:u,event:c}){let d="addCollectionGroup";if(!Array.isArray(n))return z({result:{error:Xe},stack:d});let p=l?void 0:Fp({drawDefinition:r,structureId:s,matchUpId:o,eventId:u,event:c});if(p?.error)return z({result:p,stack:d});let f=p?.structure;l=l||p?.matchUp;let m=p?.tieFormat,h=m?.winCriteria.valueGoal,g=jr(m);if(p=Bn({tieFormat:g}),p.error)return z({result:p,stack:d});for(let v of g.collectionDefinitions){let{collectionId:w,collectionGroupNumber:y}=v;if(y&&n.includes(w))return z({info:"collectionIds cannot be part of other collectionGroups",result:{error:ie},stack:d})}let I=(g.collectionGroups||[]).reduce((v,w)=>w.groupNumber>v?w.groupNumber:v,0)+1;return i.groupNumber=I,g.collectionDefinitions=g.collectionDefinitions.map(v=>n.includes(v.collectionId)?{...v,collectionGroupNumber:I}:v),g.collectionGroups=[...g.collecitonGroups||[],i],iZ({updateInProgressMatchUps:t,originalValueGoal:h,tournamentRecord:e,drawDefinition:r,tieFormatName:a,structureId:s,structure:f,tieFormat:g,matchUpId:o,matchUp:l,eventId:u,event:c})}function o$({updateInProgressMatchUps:t=!0,collectionDefinition:e,referenceCategory:i,tournamentRecord:r,policyDefinitions:n,enforceCategory:a,referenceGender:s,drawDefinition:o,tieFormatName:l,enforceGender:u,structureId:c,matchUpId:d,matchUp:p,eventId:f,uuids:m,event:h}){let g="addCollectionDefinition",I=Tt({tournamentRecord:r,drawDefinition:o,event:h}).appliedPolicies??{},v=n?.[Rr]??I?.[Rr];a=a??v?.participants?.enforceCategory;let w=(u??v?.participants?.enforceGender)!==!1,y=!!((i??h?.category)&&a!==!1),b=!!((s??h?.gender)&&w),S=Lw({referenceCategory:i??h?.category,collectionDefinition:e,referenceGender:s,checkCategory:y,checkGender:b,event:h});if(S.error)return z({result:S,stack:g});let U=p?.tieFormat?void 0:Fp({drawDefinition:o,structureId:c,matchUpId:d,eventId:f,event:h});if(U?.error)return z({result:{error:U.error},stack:g});let T=U?.structure;p=p??U?.matchUp;let P=p?.tieFormat??U?.tieFormat,D=jr(P);if(U=Bn({tieFormat:D}),U?.error)return z({result:{error:U.error},stack:g});if(!e.collectionId)e.collectionId=Et();else if(D.collectionDefinitions.map(({collectionId:x})=>x).includes(e.collectionId))return z({context:{collectionId:e.collectionId},result:{error:y4}});D.collectionDefinitions.push(e),D.collectionDefinitions.sort((x,L)=>(x.collectionOrder||0)-(L.collectionOrder||0)).forEach((x,L)=>x.collectionOrder=L+1);let{aggregateValue:E,valueGoal:R}=Ph(D);D.winCriteria=Ve({aggregateValue:E,valueGoal:R});let C=P?.winCriteria.valueGoal,M=P?.winCriteria.aggregateValue;(C&&C!==R||E&&!M)&&(l?D.tieFormatName=l:delete D.tieFormatName);let N=[],A=[],O=[],k=Ve(D);if(U=Bn({tieFormat:k}),U?.error)return z({result:{error:U.error},stack:g});if(f&&h){h.tieFormat=k;for(let x of h.drawDefinitions??[])if(!x.tieFormat)for(let L of x.structures??[]){if(L.tieFormat)continue;let $=GA({updateInProgressMatchUps:t,collectionDefinition:e,structure:L,uuids:m});A.push(...$.newMatchUps),O.push(...$.targetMatchUps),N.push(L.structureId)}UT({modifiedMatchUps:O,eventId:h?.eventId,modifiedStructureIds:N,tournamentRecord:r,drawDefinition:o,addedMatchUps:A,stack:g})}else if(c&&T){T.tieFormat=k;let x=GA({updateInProgressMatchUps:t,collectionDefinition:e,structure:T,uuids:m});A.push(...x.newMatchUps),O=x.targetMatchUps,UT({modifiedMatchUps:O,eventId:h?.eventId,modifiedStructureIds:N,tournamentRecord:r,drawDefinition:o,addedMatchUps:A,stack:g})}else if(d&&p){if(!SP({matchUp:p,updateInProgressMatchUps:t}))return z({result:{error:W1},stack:g});p.tieFormat=k;let x=yS({collectionDefinition:e,matchUp:p,uuids:m});Array.isArray(p.tieMatchUps)||(p.tieMatchUps=[]),p.tieMatchUps.push(...x),A.push(...x),UT({modifiedMatchUps:[p],eventId:h?.eventId,modifiedStructureIds:N,tournamentRecord:r,drawDefinition:o,addedMatchUps:A,stack:g})}else if(o){o.tieFormat=k;for(let x of o.structures??[]){let L=GA({updateInProgressMatchUps:t,collectionDefinition:e,structure:x,uuids:m});N.push(x.structureId),A.push(...L.newMatchUps),O.push(...L.targetMatchUps)}UT({modifiedMatchUps:O,eventId:h?.eventId,tournamentRecord:r,drawDefinition:o,addedMatchUps:A,stack:g})}else return{error:_e};let F=Ve({drawId:o?.drawId,collectionDefinition:e,action:g,structureId:c,matchUpId:d,eventId:f});return YC({appliedPolicies:I,drawDefinition:o,auditData:F}),{tieFormat:k,targetMatchUps:O,addedMatchUps:A,...H}}function GA({updateInProgressMatchUps:t,collectionDefinition:e,structure:i,uuids:r}){let n=[],a=(Nt({matchUpFilters:{matchUpTypes:[Zt]},structure:i})?.matchUps).filter(s=>SP({matchUp:s,updateInProgressMatchUps:t})&&!s.tieFormat);for(let s of a){let o=yS({collectionDefinition:e,matchUp:s,uuids:r});Array.isArray(s.tieMatchUps)||(s.tieMatchUps=[]),s.tieMatchUps.push(...o),n.push(...o)}return{newMatchUps:n,targetMatchUps:a}}function UT({modifiedStructureIds:t,tournamentRecord:e,modifiedMatchUps:i,drawDefinition:r,addedMatchUps:n,eventId:a,stack:s}){hd({tournamentId:e?.tournamentId,matchUps:n,drawDefinition:r,eventId:a}),i?.forEach(o=>{St({tournamentId:e?.tournamentId,drawDefinition:r,context:s,matchUp:o,eventId:a})}),ti({structureIds:t,drawDefinition:r,eventId:a})}function oZ({updateInProgressMatchUps:t=!1,tieFormatComparison:e,modifiedTieFormat:i,tournamentRecord:r,considerations:n,drawDefinition:a,structureId:s,matchUpId:o,eventId:l,uuids:u,event:c}){let d="modifyTieFormat";if(!Bn({tieFormat:i}).valid)return z({result:{error:Vl},info:"falied validation",stack:d});let p=Fp({drawDefinition:a,structureId:s,matchUpId:o,eventId:l,event:c});if(p.error)return z({result:p,stack:d});let{matchUp:f,tieFormat:m}=p,h=jr(m),g=Ic({descendant:i,ancestor:h,considerations:n});if(g.invalid)return z({context:{invalid:g.invalid},result:{error:Vl},stack:d});if(!g?.different)return z({result:{...H},info:"Nothing to do",stack:d});let I=h.collectionDefinitions.map(({collectionId:P})=>P),v=i.collectionDefinitions.map(({collectionId:P})=>P),w=I.filter(P=>!v.includes(P)),y=i.collectionDefinitions.filter(({collectionId:P})=>!I.includes(P)),b=y.map(ba("collectionId")),S=[],U,T=i.tieFormatName;for(let P of i.collectionDefinitions){if(b.includes(P.collectionId))continue;let D=a$({updateInProgressMatchUps:t,...P,tournamentRecord:r,tieFormatName:T,drawDefinition:a,structureId:s,matchUpId:o,eventId:l,event:c});if(D.modifications&&S.push(...D.modifications),D.error)return z({result:D,stack:d});D.tieFormat&&(U=D.tieFormat)}for(let P of y){let D=o$({updateInProgressMatchUps:t,collectionDefinition:P,tournamentRecord:r,drawDefinition:a,tieFormatName:T,structureId:s,matchUpId:o,matchUp:f,eventId:l,uuids:u,event:c});if(D.error)return z({result:D,stack:d});D.tieFormat&&(U=D.tieFormat)}for(let P of w){let D=s$({updateInProgressMatchUps:t,tieFormatComparison:e,tournamentRecord:r,drawDefinition:a,tieFormatName:T,collectionId:P,structureId:s,matchUpId:o,eventId:l,matchUp:f,event:c});if(D.error)return z({result:D,stack:d});D.tieFormat&&(U=D.tieFormat)}return m?.tieFormatName!==T?(U.tieFormatName=T,S.push({tieFormatName:T})):(S.length||b.length||w.length)&&(delete U.tieFormatName,S.push("tieFormatName removed: modifications without new tieFormatName")),U.collectionDefinitions=U.collectionDefinitions.sort((P,D)=>qg(P.collectionOrder)-qg(D.collectionOrder)).map((P,D)=>({...P,collectionOrder:D+1})),{processedTieFormat:jr(U),modifications:S,...H}}function lZ({tournamentRecord:t}){if(!t)return{error:Ie};let e=0;for(let i of t.events??[]){let r=i.tieFormats??[],n=u=>{if(!u.tieFormat)return;let c;for(let d of r)Ic({descendant:u.tieFormat,ancestor:d}).different||(c=d.tieFormatId);if(c)u.tieFormatId=c,delete u.tieFormat;else{let d=ke(u.tieFormat,void 0,!0);d.tieFormatId||(d.tieFormatId=Et()),u.tieFormatId=d.tieFormatId,delete u.tieFormat,r.push(d),e+=1}};i.eventType,n({tieFormat:i.tieFormat});for(let u of i.drawDefinitions??[]){n({tieFormat:u.tieFormat});for(let c of u.structures??[])n({tieFormat:c.tieFormat})}let a=(u,c)=>{let d=o.matchUps?.find(p=>p.matchUpId===u);d&&(d.tieFormatId=c,delete d.tieFormat,St({tournamentId:t?.tournamentId,eventId:i.eventId,matchUp:d}))},s=u=>{let c=ke(u.tieFormat,void 0,!0);c.tieFormatId||(c.tieFormatId=Et()),r.push(c),e+=1,a(u.matchUpId,c.tieFormatId)},o=Ru({matchUpFilters:{matchUpTypes:[ka]},event:i}),l=o.matchUps??[];for(let u of l){let c;for(let d of r)u.tieFormat&&Ic({descendant:u.tieFormat,ancestor:d}).different||(c=d.tieFormatId);c?a(u.matchUpId,c):s(u)}r.length&&(i.tieFormats=r)}return{...H,addedCount:e}}var uZ={};ct(uZ,{addDrawDefinitionExtension:()=>yR,addEventExtension:()=>Ld,addEventTimeItem:()=>Uh,addExtension:()=>xt,addNotes:()=>qR,addOnlineResource:()=>gZ,addParticipantExtension:()=>q5,addParticipantTimeItem:()=>ZL,addTimeItem:()=>Dl,addTournamentExtension:()=>AF,addTournamentTimeItem:()=>US,analyzeDraws:()=>TS,analyzeTournament:()=>Y0,copyTournamentRecord:()=>dZ,createTournamentRecord:()=>WC,generate:()=>cZ,getAggregateTeamResults:()=>q0,getAllowedDrawTypes:()=>hC,getAllowedMatchUpFormats:()=>H0,getAppliedPolicies:()=>Tt,getCompetitionDateRange:()=>IC,getCompetitionPenalties:()=>W0,getPolicyDefinitions:()=>Fc,getTournamentInfo:()=>Th,getTournamentPenalties:()=>gC,getTournamentPersons:()=>z0,getTournamentPoints:()=>vv,getTournamentStructures:()=>FL,getTournamentTimeItem:()=>CR,hydrateTournamentRecord:()=>fZ,mutate:()=>pZ,query:()=>dX,removeDrawDefinitionExtension:()=>Y5,removeEventExtension:()=>bR,removeExtension:()=>En,removeNotes:()=>KL,removeOnlineResource:()=>hZ,removeParticipantExtension:()=>K5,removeTournamentExtension:()=>kF,setTournamentCategories:()=>yZ,setTournamentDates:()=>KC,setTournamentEndDate:()=>wZ,setTournamentName:()=>IZ,setTournamentNotes:()=>vZ,setTournamentStartDate:()=>bZ,setTournamentStatus:()=>mZ});var cZ={};ct(cZ,{copyTournamentRecord:()=>dZ,createTournamentRecord:()=>WC});function dZ(t){let e=Ge(t,[{tournamentRecord:!0,startDate:!0,endDate:!1,tournamentName:!0}]);if(e.error)return e;let{startDate:i,endDate:r}=t.tournamentRecord,n=1440*60*1e3,a=(i&&r?new Date(Qe(r)).getTime()-new Date(Qe(i)).getTime():0)/n,s=t.endDate||fF(t.startDate,a),o=p=>p?.filter(({itemType:f})=>t.itemTypeList?.includes(f)),l=p=>p?.filter(({name:f})=>t.extensionList?.includes(f)),u=p=>{let{timeItems:f,extensions:m,...h}=p;return ke({...h,timeItems:o(f),extensions:l(m)},!1,!0)},c=p=>{let{drawDefinitions:f,timeItems:m,extensions:h,startDate:g,endDate:I,...v}=p;return ke({extensions:l(h),timeItems:o(m),startDate:t.startDate,endDate:s,...v},!1,!0)},d={participants:t.copyParticipants?t.tournamentRecord.participants?.map(u)??[]:[],parentOrganisation:ke({...t.tournamentRecord.parentOrganisation},!1,!0),venues:ke(t.tournamentRecord.venues??[],!1,!0),extensions:l(t.tournamentRecord.extensions),timeItems:o(t.tournamentRecord.timeItems),events:t.tournamentRecord.events?.map(c)??[],weekdays:[...t.tournamentRecord.weekdays??[]],tournamentName:t.tournamentName,startDate:t.startDate,tournamentId:Et(),endDate:s};return{...H,tournamentRecord:d}}var pZ={};ct(pZ,{addDrawDefinitionExtension:()=>yR,addEventExtension:()=>Ld,addEventTimeItem:()=>Uh,addExtension:()=>xt,addNotes:()=>qR,addOnlineResource:()=>gZ,addParticipantExtension:()=>q5,addParticipantTimeItem:()=>ZL,addTimeItem:()=>Dl,addTournamentExtension:()=>AF,addTournamentTimeItem:()=>US,hydrateTournamentRecord:()=>fZ,removeDrawDefinitionExtension:()=>Y5,removeEventExtension:()=>bR,removeExtension:()=>En,removeNotes:()=>KL,removeOnlineResource:()=>hZ,removeParticipantExtension:()=>K5,removeTournamentExtension:()=>kF,setTournamentCategories:()=>yZ,setTournamentDates:()=>KC,setTournamentEndDate:()=>wZ,setTournamentName:()=>IZ,setTournamentNotes:()=>vZ,setTournamentStartDate:()=>bZ,setTournamentStatus:()=>mZ});function fZ(t){let{tournamentRecord:e,eventProfiles:i=[],directives:r,policyDefinitions:n}=t;return e?((e.events||[]).forEach(a=>{let s=i.find(o=>o.eventId&&o.eventId===a.eventId);(s?.directives?.hydrateRoundNames||r?.hydrateRoundNames)&&a.drawDefinitions?.forEach(o=>{(s?.policyDefinitions?.[uc]||n?.[uc])&&EX({drawDefinition:o,appliedPolicies:n})})}),{tournamentRecord:e}):{error:Ie}}function mZ({tournamentRecord:t,status:e}){return t?e&&!Object.keys(V8).includes(e)?{error:ie,info:"Unknown status"}:(t.tournamentStatus=e,{...H}):{error:Ie}}function hZ(t){let e=Ge(t,[{tournamentRecord:!0,onlineResource:!0}]);if(e.error)return e;let{tournamentRecord:i,onlineResource:r,organisationId:n,participantId:a,personId:s,courtId:o,venueId:l}=t;if(n){if(i.parentOrganisation?.parentOrganisationId!==n)return z({result:{error:_r}});og({element:i.parentOrganisation,onlineResource:r})}else if(a||s){let u=(i.participants??[]).find(c=>s&&c.person?.personId===s||c.participantId===a);if(!u)return z(s?{result:{error:_r}}:{result:{error:Vi}});if(s){if(u.person?.personId!==s)return z({result:{error:Up}});og({element:u.person,onlineResource:r})}else og({element:u,onlineResource:r})}else if(o){let u=(i.venues??[]).filter(c=>!l||c.venueId===l).flatMap(c=>(c.courts??[]).filter(d=>d.courtId===o))?.[0];if(!u)return z({result:{error:ac}});og({element:u,onlineResource:r})}else if(l){let u=(i.venues??[]).find(c=>c.venueId===l);if(!u)return z({result:{error:tf}});og({element:u,onlineResource:r})}else og({element:i,onlineResource:r}),at({payload:{parentOrganisation:i.parentOrganisation,onlineResources:i.onlineResources,tournamentId:i.tournamentId},topic:nf});return{...H}}function og({element:t,onlineResource:e}){let i=(t.onlineResources??[]).filter(r=>!(r?.[WD]===e[WD]&&r?.[zD]===e[zD]&&r?.[Zg]===e[Zg]));t.onlineResources=i}function gZ(t){let e=Ge(t,[{tournamentRecord:!0,onlineResource:!0}]);if(e.error)return e;let{tournamentRecord:i,onlineResource:r,organisationId:n,participantId:a,personId:s,courtId:o,venueId:l}=t;if(n){if(i.parentOrganisation?.parentOrganisationId!==n)return z({result:{error:_r}});lg({element:i.parentOrganisation,onlineResource:r})}else{if(a&&s&&a!==s)return z({result:{error:Up}});if(a||s){let u=(i.participants??[]).find(c=>s&&c.person?.personId===s||c.participantId===a);if(!u)return z(s?{result:{error:_r}}:{result:{error:Vi}});if(s){if(u.person?.personId!==s)return z({result:{error:Up}});lg({element:u.person,onlineResource:r})}else lg({element:u,onlineResource:r})}else if(o){let u=(i.venues??[]).filter(c=>!l||c.venueId===l).flatMap(c=>(c.courts??[]).filter(d=>d.courtId===o))?.[0];if(!u)return z({result:{error:ac}});lg({element:u,onlineResource:r})}else if(l){let u=(i.venues??[]).find(c=>c.venueId===l);if(!u)return z({result:{error:tf}});lg({element:u,onlineResource:r})}else lg({element:i,onlineResource:r}),at({payload:{parentOrganisation:i.parentOrganisation,onlineResources:i.onlineResources,tournamentId:i.tournamentId},topic:nf})}return{...H}}function lg({element:t,onlineResource:e}){let i=(t.onlineResources??[]).filter(r=>r?.[aO]!==e[aO]&&r?.[Zg]!==e[Zg]);return i.push(e),t.onlineResources=i,{...H}}function IZ({tournamentRecord:t,promotionalName:e,tournamentName:i,formalName:r}){if(!t)return{error:Ie};let n=t.tournamentId,a={tournamentId:n};return i&&i!==t.tournamentName&&(t.tournamentName=i,a.tournamentName=i),e&&e!==t.promotionalName&&(t.promotionalName=e,a.promotionalName=e),r&&r!==t.formalName&&(t.formalName=r,a.formalName=r),t.promotionalName===t.tournamentName&&(delete t.promotionalName,a.promotionalName=""),t.formalName===t.tournamentName&&(delete t.formalName,a.formalName=""),Object.keys(a).length>1&&at({topic:nf,payload:{parentOrganisation:t.parentOrganisation,tournamentId:n,...a}}),{...H}}function vZ({tournamentRecord:t,notes:e}){if(!t)return{error:Ie};let i=e?qR({element:t,notes:e}):KL({element:t});return i.error?i:(at({topic:nf,payload:{parentOrganisation:t.parentOrganisation,tournamentId:t.tournamentId,notes:e??""}}),{...H})}function yZ({tournamentRecord:t,categories:e}){return t?(e=(e||[]).filter(i=>i.categoryName&&i.type),t.tournamentCategories=e,at({topic:nf,payload:{parentOrganisation:t.parentOrganisation,tournamentId:t.tournamentId,categories:e}}),{...H}):{error:Ie}}function VMe({tournamentRecord:t}){if(!t)return{error:Ie};let{startDate:e,endDate:i}=t,r=Qg(e,i),n=[];for(let a of t.venues||[])a?.courts?.length&&n.push(...a.courts);for(let a of n){let{startTime:s,endTime:o}=(a.dateAvailability??[]).reduce((c,d)=>{let p=Pt(c.startTime),f=Pt(c.endTime);return d.startTime&&Pt(d.startTime)<p&&(c.startTime=d.startTime),d.endTime&&Pt(d.endTime)>f&&(c.endTime=d.endTime),c},{startTime:"08:00",endTime:"18:00"}),l=r.map(c=>a.dateAvailability?.find(d=>d.date===c)??{date:c,startTime:s,endTime:o}),u=a.dateAvailability?.find(c=>!c.date);u&&l.unshift(u),a.dateAvailability=l}return{...H}}function KC(t){let{tournamentRecord:e,startDate:i,endDate:r,weekdays:n}=t,a=t.activeDates?.filter(Boolean),s=Ge(t,[{tournamentRecord:!0},{[Wr]:f=>rl.test(f),[Fa]:sr,startDate:!1,endDate:!1},{[Wr]:f=>f.filter(Boolean).every(m=>rl.test(m)),[Fa]:sr,activeDates:!1},{[Wr]:HX,weekdays:!1}]);if(s.error)return s;if(r&&i&&new Date(r)<new Date(i))return{error:ie};if(r&&i&&new Date(i)>new Date(r))return{error:ie};if(a?.length){let f=i||e.startDate,m=r||e.endDate,h=!f||a.every(I=>new Date(I)>=new Date(f)),g=!m||a.every(I=>new Date(I)<=new Date(m));if(!h||!g)return{error:sr}}let o;(i&&e.startDate&&new Date(i)>new Date(e.startDate)||r&&e.endDate&&new Date(r)<new Date(e.endDate))&&(o=!0);let l=Qg(e.startDate,e.endDate);i&&(e.startDate=i),r&&(e.endDate=r);let u=Qg(e.startDate,e.endDate),c=l.filter(f=>!u.includes(f)),d=u.filter(f=>!l.includes(f));for(let f of e.events??[])i&&f.startDate&&new Date(f.startDate)<new Date(i)&&(f.startDate=i),r&&f.startDate&&new Date(f.startDate)>new Date(r)&&(f.startDate=i??r),r&&f.endDate&&new Date(f.endDate)>new Date(r)&&(f.endDate=r),i&&f.endDate&&new Date(f.endDate)<new Date(i)&&(f.endDate=r??i);i&&e.endDate&&new Date(i)>new Date(e.endDate)&&(e.endDate=i),r&&e.startDate&&new Date(r)<new Date(e.startDate)&&(e.startDate=r),a&&(e.activeDates=a),n&&(e.weekdays=n);let p=o&&jMe({tournamentRecord:e})?.unscheduledMatchUpIds;return VMe({tournamentRecord:e}),at({payload:Ve({parentOrganisation:e.parentOrganisation,tournamentId:e.tournamentId,activeDates:a,startDate:i,weekdays:n,endDate:r}),topic:nf}),{...H,unscheduledMatchUpIds:p,datesAdded:d,datesRemoved:c}}function bZ({tournamentRecord:t,startDate:e}){return e?KC({tournamentRecord:t,startDate:e}):{error:sr}}function wZ({tournamentRecord:t,endDate:e}){return e?KC({tournamentRecord:t,endDate:e}):{error:sr}}function jMe({tournamentRecord:t}){let e=br({tournamentRecord:t}).matchUps??[],i=t.startDate&&new Date(t.startDate),r=t.endDate&&new Date(t.endDate),n=[],a=[];for(let s of e){let{schedule:o,matchUpId:l}=s;if(o&&o.scheduledDate){let u=new Date(o.scheduledDate);(i&&u<i||r&&u>r)&&(a.push(l),n.includes(o.scheduledDate)||n.push(o.scheduledDate))}}return n.length&&!jC({scheduledDates:n,tournamentRecord:t}).clearedScheduleCount?{error:f6}:{unscheduledMatchUpIds:a}}var SZ={};ct(SZ,{BLOCK_TYPES:()=>kt,EvaluatorRegistry:()=>FZ,adjacentBlockEvaluator:()=>v$,applyTemporalAvailabilityToTournamentRecord:()=>HZ,blockDurationEvaluator:()=>b$,buildDayRange:()=>DZ,buildEdges:()=>c$,buildSchedulingProfileFromUISelections:()=>WZ,calculateCapacityStats:()=>EZ,calculateCourtHours:()=>XZ,clampDragToCollisions:()=>kZ,clampToDayRange:()=>l$,compareCapacityCurves:()=>MZ,computePlanItemId:()=>TP,courtDayKey:()=>Gy,courtKey:()=>Ag,courtOverlapEvaluator:()=>g$,createFollowByEvaluator:()=>LZ,dayBoundaryEvaluator:()=>w$,defaultEvaluators:()=>xZ,deriveRailSegments:()=>p$,diffMinutes:()=>BS,extractDay:()=>rp,filterCapacityCurve:()=>RZ,findBlocksContainingTime:()=>AZ,formatConflicts:()=>BZ,generateCapacityCurve:()=>m$,getHighestSeverity:()=>$Z,groupConflictsBySeverity:()=>_Z,hhmmToMinutes:()=>Ob,intervalsOverlap:()=>NZ,iterateDayTicks:()=>jZ,lightingEvaluator:()=>y$,maintenanceWindowEvaluator:()=>S$,matchWindowEvaluator:()=>I$,mergeAdjacentSegments:()=>f$,mergeOverlappingAvailability:()=>KZ,minutesToHhmm:()=>XC,overlappingRange:()=>TZ,railsToDateAvailability:()=>T$,rangesOverlap:()=>u$,resolveCourtId:()=>qf,resolveStatus:()=>UP,resolveVenueId:()=>om,runValidationPipeline:()=>GZ,sampleCapacityCurve:()=>CZ,snapIsoToGranularity:()=>VZ,snapToGranularity:()=>U$,sortBlocksByStart:()=>OZ,sortEdges:()=>d$,timeInsideBlock:()=>h$,todsAvailabilityToBlocks:()=>zZ,validateDateAvailability:()=>YZ,validateSchedulingProfileFormat:()=>qZ,validateSegments:()=>PZ,venueDayKey:()=>UZ,venueKey:()=>Hf});var kt={MAINTENANCE:"MAINTENANCE",PRACTICE:"PRACTICE",RESERVED:"RESERVED",BLOCKED:"BLOCKED",CLOSED:"CLOSED",SCHEDULED:"SCHEDULED",SOFT_BLOCK:"SOFT_BLOCK",HARD_BLOCK:"HARD_BLOCK",LOCKED:"LOCKED",AVAILABLE:"AVAILABLE",UNSPECIFIED:"UNSPECIFIED"};function Gy(t,e){return`${t.tournamentId}|${t.venueId}|${t.courtId}|${e}`}function Ag(t){return`${t.tournamentId}|${t.venueId}|${t.courtId}`}function Hf(t,e){return`${t}|${e}`}function UZ(t,e,i){return`${t}|${e}|${i}`}function om(t){return t.venueId||t.venueName||"unknown-venue"}function qf(t){return t.courtId||t.courtName||"unknown-court"}function l$(t,e){let i=t.start,r=t.end,n=e?.start,a=e?.end;if(r<=n||i>=a)return null;let s=i<n?n:i,o=r>a?a:r;return{...t,start:s,end:o}}function u$(t,e){return t?.start<e?.end&&e?.start<t?.end}function TZ(t,e){let i=t?.start>e?.start?t?.start:e?.start,r=t?.end<e?.end?t?.end:e?.end;return{start:i,end:r}}function BS(t,e){let i=new Date(t),r=(new Date(e).getTime()-i.getTime())/(1e3*60);return Number.isNaN(r)?0:r}function UP(t,e,i){if(t.length===0||!i||i.length===0)return kt.AVAILABLE;let r=new Map(i.map((s,o)=>[s,o])),n=kt.AVAILABLE,a=1/0;for(let s of t){let o=e.get(s);if(!o)continue;let l=r.get(o.type);l!==void 0&&l<a&&(a=l,n=o.type)}return n}function c$(t){let e=[];if(!Array.isArray(t))return e;for(let i of t)e.push({time:i.start,type:"START",blockId:i.id}),e.push({time:i.end,type:"END",blockId:i.id});return e}function d$(t){return Array.isArray(t)?t.slice().sort((e,i)=>{let r=e.time.localeCompare(i.time);return r!==0?r:e.type==="END"&&i.type==="START"?-1:e.type==="START"&&i.type==="END"?1:0}):[]}function p$(t,e,i){if(!Array.isArray(t)||!e||!i)return[];let r=t.map(u=>l$(u,e)).filter(u=>u!==null);if(r.length===0)return[{start:e.start,end:e.end,status:kt.AVAILABLE,contributingBlocks:[]}];let n=new Map(r.map(u=>[u.id,u])),a=d$(c$(r)),s=new Set,o=[],l=e.start;for(let u of a){let c=u.time;if(c>l){let d=Array.from(s),p=UP(d,n,i.typePrecedence);o.push({start:l,end:c,status:p,contributingBlocks:d})}u.type==="START"?s.add(u.blockId):s.delete(u.blockId),l=c}if(l<e.end){let u=Array.from(s),c=UP(u,n,i.typePrecedence);o.push({start:l,end:e.end,status:c,contributingBlocks:u})}return f$(o)}function f$(t){if(t.length===0)return t;let e=[],i={...t[0]};for(let r=1;r<t.length;r++){let n=t[r],a=i.status===n.status,s=i.contributingBlocks.length===n.contributingBlocks.length&&i.contributingBlocks.every(l=>n.contributingBlocks.includes(l)),o=i.end===n.start;a&&s&&o?i.end=n.end:(e.push(i),i={...n})}return e.push(i),e}function rp(t){return Qe(t)}function DZ(t,e){return{start:`${t}T${e?.dayStartTime}:00`,end:`${t}T${e?.dayEndTime}:00`}}function PZ(t){for(let e=0;e<t.length;e++){let i=t[e];if(i.start>=i.end)return!1;if(e<t.length-1){let r=t[e+1];if(i.end>r.start||i.end!==r.start)return!1}}return!0}function m$(t,e){let i=new Set;if(!Array.isArray(e))return{day:t,points:[]};for(let a of e)for(let s of a.rails)for(let o of s.segments)i.add(o.start),i.add(o.end);let r=Array.from(i).sort(),n=r.map(a=>({time:a,courtsAvailable:0,courtsSoftBlocked:0,courtsHardBlocked:0}));for(let a of e)for(let s of a.rails)for(let o=0;o<r.length;o++){let l=r[o],u=GMe(s.segments,l);if(u){let c=n[o];HMe(u,c)}}return{day:t,points:n}}function GMe(t,e){for(let i of t)if(e>=i.start&&e<i.end)return i;return null}function HMe(t,e){switch(t.status){case kt.AVAILABLE:e.courtsAvailable++;break;case kt.RESERVED:case kt.SOFT_BLOCK:e.courtsSoftBlocked++;break;case kt.BLOCKED:case kt.PRACTICE:case kt.MAINTENANCE:case kt.CLOSED:e.courtsSoftBlocked++;break;case kt.SCHEDULED:case kt.HARD_BLOCK:case kt.LOCKED:e.courtsHardBlocked++;break}}function EZ(t){if(!t.points||t.points.length===0)return{peakAvailable:0,peakTime:"",minAvailable:0,minTime:"",avgAvailable:0,totalCourtHours:0,utilizationPercent:0,peakUnavailable:0,peakUnavailableTime:"",totalCourts:0,totalAvailableHours:0,totalUnavailableHours:0,availablePercent:0,avgBlockedHoursPerCourt:0};let e=0,i=t.points[0].time,r=1/0,n=t.points[0].time,a=0,s=t.points[0].time,o=0,l=0,u=0;for(let g=0;g<t.points.length-1;g++){let I=t.points[g],v=t.points[g+1],w=(new Date(v.time).getTime()-new Date(I.time).getTime())/(1e3*60*60),y=I.courtsAvailable+I.courtsSoftBlocked+I.courtsHardBlocked;u=Math.max(u,y);let b=I.courtsSoftBlocked+I.courtsHardBlocked;I.courtsAvailable>e&&(e=I.courtsAvailable,i=I.time),I.courtsAvailable<r&&(r=I.courtsAvailable,n=I.time),b>a&&(a=b,s=I.time),o+=I.courtsAvailable*w,l+=b*w}let c=(new Date(t.points.at(-1).time).getTime()-new Date(t.points[0].time).getTime())/(1e3*60*60),d=u*c,p=d>0?o/d*100:0,f=d>0?l/d*100:0,m=u>0?l/u:0,h=t.points.length>1?t.points.slice(0,-1).reduce((g,I)=>g+I.courtsAvailable,0)/(t.points.length-1):0;return{peakAvailable:e,peakTime:i,minAvailable:r===1/0?0:r,minTime:n,avgAvailable:h,totalCourtHours:d,utilizationPercent:f,peakUnavailable:a,peakUnavailableTime:s,totalCourts:u,totalAvailableHours:o,totalUnavailableHours:l,availablePercent:p,avgBlockedHoursPerCourt:m}}function RZ(t,e){let i=t.points?.filter(r=>r.time>=e.start&&r.time<=e.end);return{...t,points:i}}function CZ(t,e){if(!t.points||t.points.length===0)return t;let i=[],r=new Date(t.points[0].time),n=new Date(t.points.at(-1).time),a=new Date(r);for(;a<=n;){let s=a.toISOString(),o=WMe(t.points,s);o&&i.push(o),a=new Date(a.getTime()+e*60*1e3)}return{...t,points:i}}function WMe(t,e){for(let i=t.length-1;i>=0;i--)if(t[i].time<=e)return{time:e,courtsAvailable:t[i].courtsAvailable,courtsSoftBlocked:t[i].courtsSoftBlocked,courtsHardBlocked:t[i].courtsHardBlocked};return null}function MZ(t,e){let i=[],r=new Set;t.points?.forEach(a=>r.add(a.time)),e?.points?.forEach(a=>r.add(a.time));let n=Array.from(r).sort();for(let a of n){let s=t.points?.find(l=>l.time===a)||{courtsAvailable:0,courtsSoftBlocked:0,courtsHardBlocked:0},o=e.points?.find(l=>l.time===a)||{courtsAvailable:0,courtsSoftBlocked:0,courtsHardBlocked:0};i.push({time:a,availableDelta:o.courtsAvailable-s.courtsAvailable,softBlockedDelta:o.courtsSoftBlocked-s.courtsSoftBlocked,hardBlockedDelta:o.courtsHardBlocked-s.courtsHardBlocked})}return i}function NZ(t,e){let i=new Date(t.start?.endsWith("Z")?t.start:t.start+"Z").getTime(),r=new Date(t.end?.endsWith("Z")?t.end:t.end+"Z").getTime(),n=new Date(e?.start?.endsWith("Z")?e?.start:e?.start+"Z").getTime(),a=new Date(e?.end?.endsWith("Z")?e?.end:e?.end+"Z").getTime();return i<a&&r>n}function h$(t,e){let i=new Date(e?.start?.endsWith("Z")?e?.start:e?.start+"Z").getTime(),r=new Date(e?.end?.endsWith("Z")?e?.end:e?.end+"Z").getTime();return i<=t&&t<r}function AZ(t,e){return Array.isArray(e)?e.filter(i=>h$(t,i)):[]}function kZ(t,e,i){let r=e>=t?"forward":"backward",n=Math.min(t,e),a=Math.max(t,e),s,o,l=!1,u;if(r==="forward"){let c=a;for(let d of i){let p=new Date(d.start.endsWith("Z")?d.start:d.start+"Z").getTime(),f=new Date(d.end.endsWith("Z")?d.end:d.end+"Z").getTime();p>t&&p<a&&p<c&&(c=p,l=!0,u=d),p<a&&f>t&&p<c&&p>t&&(c=p,l=!0,u=d)}s=t,o=c}else{let c=n;if(Array.isArray(i))for(let d of i){let p=new Date(d.start.endsWith("Z")?d.start:d.start+"Z").getTime(),f=new Date(d.end.endsWith("Z")?d.end:d.end+"Z").getTime();f<t&&f>n&&f>c&&(c=f,l=!0,u=d),p<t&&f>n&&f>c&&f<t&&(c=f,l=!0,u=d)}s=c,o=t}return{start:s,end:o,clamped:l,clampedBy:u,direction:r}}function OZ(t){Array.isArray(t)&&t.sort((e,i)=>{let r=new Date(e.start.endsWith("Z")?e.start:e.start+"Z").getTime(),n=new Date(i.start.endsWith("Z")?i.start:i.start+"Z").getTime();return r-n})}var g$={id:"COURT_OVERLAP",description:"Prevent double-booking courts or overriding hard blocks",evaluate:(t,e)=>{let i=[];for(let r of e){if(r.kind==="REMOVE_BLOCK")continue;let n=r.block,a=Qe(n.start),s=`${n.court.tournamentId}|${n.court.venueId}|${n.court.courtId}|${a}`,o=t.blocksByCourtDay.get(s)||[];for(let l of o){if(l===n.id)continue;let u=t.blocksById.get(l);if(u&&u$(n,u)){let c=u.type===kt.HARD_BLOCK||u.type===kt.LOCKED||n.type===kt.HARD_BLOCK||n.type===kt.LOCKED?"ERROR":"WARN",d=n.start>u.start?n.start:u.start,p=n.end<u.end?n.end:u.end;i.push({code:"COURT_OVERLAP",message:`Block overlaps existing ${u.type.toLowerCase()} (${u.reason||"no reason"}) on court ${n.court.courtId}`,severity:c,timeRange:{start:d,end:p},courts:[n.court]})}}}return i}},I$={id:"MATCH_WINDOW",description:"Ensure availability windows are large enough for typical matches",evaluate:(t,e)=>{let i=[],r=new Set;for(let n of e){let a=n.block,s=Qe(a.start),o=`${a.court.tournamentId}|${a.court.venueId}|${a.court.courtId}|${s}`;r.add(o)}for(let n of r){let a=(t.blocksByCourtDay.get(n)||[]).map(o=>t.blocksById.get(o)).filter(Boolean).slice().sort((o,l)=>o.start.localeCompare(l.start)),s=null;for(let o of a)if(o.type!==kt.AVAILABLE&&o.type!==kt.SOFT_BLOCK&&o.type!==kt.RESERVED){if(s){let l=BS(s,o.start);l>0&&l<60&&i.push({code:"MATCH_WINDOW_TOO_SMALL",message:`Availability window (${l} minutes) is smaller than typical match duration (60 minutes)`,severity:"WARN",timeRange:{start:s,end:o.start},courts:[o.court]})}s=o.end}}return i}},v$={id:"ADJACENT_BLOCK",description:"Warn about blocks with no transition time",evaluate:(t,e)=>{let i=[];for(let r of e){if(r.kind==="REMOVE_BLOCK")continue;let n=r.block,a=Qe(n.start),s=`${n.court.tournamentId}|${n.court.venueId}|${n.court.courtId}|${a}`,o=t.blocksByCourtDay.get(s)||[];for(let l of o){if(l===n.id)continue;let u=t.blocksById.get(l);u&&(u.end===n.start||n.end===u.start)&&u.type!==n.type&&i.push({code:"NO_TRANSITION_TIME",message:`${n.type} immediately follows ${u.type} with no transition time (recommended: 15 minutes)`,severity:"INFO",timeRange:{start:u.end,end:n.start},courts:[n.court]})}}return i}},y$={id:"LIGHTING",description:"Prevent scheduling on unlit courts after sunset",evaluate:(t,e)=>{let i=[],r="19:00";for(let n of e){if(n.kind==="REMOVE_BLOCK")continue;let a=n.block;a.end.slice(11,16)>r&&(a.type===kt.AVAILABLE||a.type===kt.RESERVED)&&i.push({code:"AFTER_SUNSET",message:`Court scheduled after sunset (${r}). Verify court has adequate lighting.`,severity:"WARN",timeRange:{start:`${a.start.slice(0,11)}${r}:00`,end:a.end},courts:[a.court]})}return i}},b$={id:"BLOCK_DURATION",description:"Validate block durations are reasonable",evaluate:(t,e)=>{let i=[];for(let r of e){if(r.kind==="REMOVE_BLOCK")continue;let n=r.block,a=BS(n.start,n.end);a<15?i.push({code:"BLOCK_TOO_SHORT",message:`Block duration (${a} minutes) is unusually short. Minimum recommended: 15 minutes.`,severity:"WARN",timeRange:n,courts:[n.court]}):a>720&&i.push({code:"BLOCK_TOO_LONG",message:`Block duration (${a/60} hours) is unusually long. Maximum recommended: ${720/60} hours.`,severity:"WARN",timeRange:n,courts:[n.court]})}return i}},w$={id:"DAY_BOUNDARY",description:"Ensure blocks do not span multiple days",evaluate:(t,e)=>{let i=[];for(let r of e){if(r.kind==="REMOVE_BLOCK")continue;let n=r.block,a=Qe(n.start),s=Qe(n.end);a!==s&&i.push({code:"SPANS_MULTIPLE_DAYS",message:`Block spans from ${a} to ${s}. Blocks should be contained within a single day.`,severity:"ERROR",timeRange:n,courts:[n.court]})}return i}},S$={id:"MAINTENANCE_WINDOW",description:"Validate maintenance scheduling practices",evaluate:(t,e)=>{let i=[],r="09:00",n="17:00";for(let a of e){if(a.kind==="REMOVE_BLOCK")continue;let s=a.block;if(s.type===kt.MAINTENANCE){let o=s.start.slice(11,16),l=s.end.slice(11,16),u=BS(s.start,s.end);(o>=r&&o<n||l>r&&l<=n)&&i.push({code:"MAINTENANCE_DURING_PEAK",message:`Maintenance scheduled during peak hours (${r}-${n}). Consider scheduling during off-peak times.`,severity:"INFO",timeRange:s,courts:[s.court]}),u<30&&i.push({code:"MAINTENANCE_TOO_SHORT",message:`Maintenance duration (${u} minutes) may be insufficient. Recommended minimum: 30 minutes.`,severity:"INFO",timeRange:s,courts:[s.court]})}}return i}},xZ=[g$,w$,b$,I$,v$,y$,S$],FZ=class{constructor(){this.evaluators=new Map}register(t){this.evaluators.set(t.id,t)}unregister(t){this.evaluators.delete(t)}get(t){return this.evaluators.get(t)}getAll(){return Array.from(this.evaluators.values())}clear(){this.evaluators.clear()}},LZ=t=>({id:"FOLLOW_BY",description:"Player rest and follow-by conflicts using Competition Factory",evaluate:(e,i)=>[]});function _Z(t){return Array.isArray(t)?{errors:t?.filter(e=>e.severity==="ERROR"),warnings:t.filter(e=>e.severity==="WARN"),info:t.filter(e=>e.severity==="INFO")}:{errors:[],warnings:[],info:[]}}function $Z(t){return Array.isArray(t)?t.some(e=>e.severity==="ERROR")?"ERROR":t.some(e=>e.severity==="WARN")?"WARN":t.some(e=>e.severity==="INFO")?"INFO":null:null}function BZ(t){return Array.isArray(t)?t.map(e=>{let i=e.courts.map(n=>n.courtId).join(", "),r=`${e.timeRange.start.slice(11,16)}-${e.timeRange.end.slice(11,16)}`;return`[${e.severity}] ${e.code}: ${e.message} (${i} @ ${r})`}):[]}function Ob(t){if(typeof t!="string")return 0;let[e,i]=t.split(":").map(Number);return e*60+i}function XC(t){let e=Math.max(0,Math.min(1439,Math.round(t))),i=Math.floor(e/60),r=e%60;return`${String(i).padStart(2,"0")}:${String(r).padStart(2,"0")}`}function U$(t,e,i="round"){if(e<=0)return t;switch(i){case"floor":return Math.floor(t/e)*e;case"ceil":return Math.ceil(t/e)*e;case"round":return Math.round(t/e)*e}}function VZ(t,e,i="round"){if(!t||typeof t!="string")return t;let r=t.slice(0,10),n=t.slice(11,16),a=Ob(n),s=U$(a,e,i),o=XC(s);return`${r}T${o}:00`}function*jZ(t,e,i){if(i<=0)return;let r=Ob(t),n=Ob(e);for(let a=r;a<n;a+=i)yield XC(a)}function TP(t){let e=[t.day,t.venueId,t.eventId];return t.drawId&&e.push(t.drawId),e.push(`R${t.roundNumber}`),e.join("|")}function zMe(t,e){let i=[],r=new Set(t.getTournamentDays()),n=t.listCourtMeta(),a=new Set(n.map(s=>s.ref.venueId));for(let s of e){r.has(s.day)||i.push({ruleId:"PRECHECK_INVALID_DAY",phase:"PRECHECK",severity:"ERROR",message:`Day '${s.day}' is not within the tournament date range`,context:{day:s.day}});for(let o of s.items)a.has(o.venueId)||i.push({ruleId:"PRECHECK_INVALID_VENUE",phase:"PRECHECK",severity:"ERROR",message:`Venue '${o.venueId}' does not exist in the tournament record`,context:{day:s.day,venueId:o.venueId,planItemId:o.planItemId}}),o.notBeforeTime&&!/^\d{2}:\d{2}$/.test(o.notBeforeTime)&&i.push({ruleId:"PRECHECK_INVALID_TIME_FORMAT",phase:"PRECHECK",severity:"ERROR",message:`notBeforeTime '${o.notBeforeTime}' is not valid HH:MM format`,context:{day:s.day,planItemId:o.planItemId}}),o.roundNumber<1&&i.push({ruleId:"PRECHECK_INVALID_ROUND",phase:"PRECHECK",severity:"ERROR",message:`roundNumber must be >= 1, got ${o.roundNumber}`,context:{day:s.day,planItemId:o.planItemId}})}return i}function qMe(t,e){let i=[],r=new Set;for(let n of e)for(let a of n.items)r.has(a.planItemId)&&i.push({ruleId:"INTEGRITY_DUPLICATE_PLAN_ITEM",phase:"INTEGRITY",severity:"ERROR",message:`Duplicate plan item '${a.planItemId}'`,context:{day:n.day,planItemId:a.planItemId}}),r.add(a.planItemId);return i}function YMe(t,e){let i=[],r=new Map;for(let n of e)for(let a of n.items){let s=`${a.eventId}|${a.drawId||""}`,o=r.get(s)||[];o.push({day:n.day,roundNumber:a.roundNumber,planItemId:a.planItemId}),r.set(s,o)}for(let[n,a]of r.entries()){if(a.length<2)continue;let s=[...a].sort((o,l)=>o.roundNumber-l.roundNumber);for(let o=1;o<s.length;o++){let l=s[o-1],u=s[o];u.day<l.day&&i.push({ruleId:"ORDERING_ROUND_DAY_SEQUENCE",phase:"ORDERING",severity:"WARN",message:`Round ${u.roundNumber} is scheduled on ${u.day} which is before round ${l.roundNumber} on ${l.day} (event: ${n.split("|")[0]})`,context:{day:u.day,planItemId:u.planItemId},fixAction:{type:"MOVE_PLAN_ITEM",description:`Move round ${u.roundNumber} to ${l.day} or later`,payload:{planItemId:u.planItemId,suggestedDay:l.day}}})}}return i}function KMe(t,e){let i=[];for(let r of e){let n=0,a=r.items.filter(p=>p.estimatedDurationMinutes);for(let p of a)n+=p.estimatedDurationMinutes;if(n===0)continue;let s=t.getVisibleTimeRange(r.day),o=$W(s.startTime),l=$W(s.endTime)-o,u=t.listCourtMeta(),c=new Set(r.items.map(p=>p.venueId)),d=(c.size===1?u.filter(p=>p.ref.venueId===[...c][0]):u).length*l;n>d?i.push({ruleId:"CAPACITY_DEMAND_EXCEEDS_SUPPLY",phase:"CAPACITY",severity:"WARN",message:`Estimated demand (${Math.round(n/60)}h) exceeds available court-hours (${Math.round(d/60)}h) on ${r.day}`,context:{day:r.day}}):n>d*.9&&i.push({ruleId:"CAPACITY_NEAR_LIMIT",phase:"CAPACITY",severity:"INFO",message:`Demand is at ${Math.round(n/d*100)}% of capacity on ${r.day}`,context:{day:r.day}})}return i}function $W(t){let[e,i]=t.split(":").map(Number);return e*60+i}var BW=["PRECHECK","INTEGRITY","ORDERING","CAPACITY"],XMe={PRECHECK:zMe,INTEGRITY:qMe,ORDERING:YMe,CAPACITY:KMe};function GZ(t){let{engine:e,day:i,phases:r}=t,n;if(i){let l=e.getDayPlan(i);n=l?[l]:[]}else n=e?.getAllPlans();let a=r?BW.filter(l=>r.includes(l)):BW,s=[];for(let l of a){let u=XMe[l],c=u(e,n);if(s.push(...c),l==="PRECHECK"&&c.some(d=>d.severity==="ERROR"))break}let o=new Map;for(let l of s){let u=l.context?.planItemId||"__global__",c=o.get(u)||[];c.push(l),o.set(u,c)}return{results:s,issueIndex:o}}var JMe={courtToCourtId:t=>t.courtId,isSchedulableStatus:t=>t===kt.AVAILABLE||t===kt.SOFT_BLOCK||t===kt.RESERVED,aggregateByVenue:!1};function T$(t,e={}){let i={...JMe,...e},r=[];for(let n of t){let{day:a,venueId:s,rails:o}=n;for(let l of o){let{court:u,segments:c}=l,d=i.courtToCourtId(u),p=QMe(c,i);for(let f of p)r.push({date:a,startTime:VW(f.start),endTime:VW(f.end),venueId:s,courtIds:[d]})}}return i.aggregateByVenue?ZMe(r):r}function QMe(t,e){let i=[],r=null,n=null;for(let a of t)e.isSchedulableStatus(a.status)?(r||(r=a.start),n=a.end):(r&&n&&i.push({start:r,end:n}),r=null,n=null);return r&&n&&i.push({start:r,end:n}),i}function VW(t){return t.slice(11,16)}function ZMe(t){let e=new Map;for(let i of t){let r=`${i.venueId}|${i.date}|${i.startTime}|${i.endTime}`;if(e.has(r)){let n=e.get(r);i.courtIds&&(n.courtIds=[...n.courtIds||[],...i.courtIds])}else e.set(r,{...i})}return Array.from(e.values())}function HZ(t){let{tournamentRecord:e,timelines:i,config:r={},engine:n}=t,a=T$(i,r),s=structuredClone(e),o=new Map;for(let l of a){let u=o.get(l.venueId)||[];u.push(l),o.set(l.venueId,u)}if(s.venues&&Array.isArray(s.venues)){let l=n?.getConfig()?.tournamentId;for(let u of s.venues){let c=om(u),d=o.get(c);if(d&&(u.dateAvailability=d),n&&l){let p=n.getVenueAvailability(l,c);p&&(u.defaultStartTime=p.startTime,u.defaultEndTime=p.endTime)}}}return s}function WZ(t){let e=[];for(let i of t)!i.scheduleDate||!i.venueIds.length||e.push({scheduleDate:i.scheduleDate,venueIds:i.venueIds,rounds:i.rounds||[]});return e}function zZ(t){let{venue:e,tournamentId:i,blockType:r=kt.AVAILABLE}=t,n=[];if(!e.dateAvailability)return n;let a=om(e);for(let s of e.dateAvailability){let{date:o,startTime:l,endTime:u,courtIds:c}=s;if(c&&c.length>0)for(let d of c)n.push({court:{tournamentId:i,venueId:a,courtId:d},start:`${o}T${l}:00`,end:`${o}T${u}:00`,type:r});else if(e.courts&&e.courts.length>0)for(let d of e.courts){let p=qf(d);n.push({court:{tournamentId:i,venueId:a,courtId:p},start:`${o}T${l}:00`,end:`${o}T${u}:00`,type:r})}}return n}function qZ(t){let e=[];if(!Array.isArray(t))return e.push("Profile must be an array"),{valid:!1,errors:e};for(let i=0;i<t.length;i++){let r=t[i];if(r.scheduleDate?/^\d{4}-\d{2}-\d{2}$/.test(r.scheduleDate)||e.push(`Item ${i}: invalid scheduleDate format (expected YYYY-MM-DD)`):e.push(`Item ${i}: missing scheduleDate`),(!r.venueIds||!Array.isArray(r.venueIds)||r.venueIds.length===0)&&e.push(`Item ${i}: missing or empty venueIds array`),r.rounds)if(!Array.isArray(r.rounds))e.push(`Item ${i}: rounds must be an array`);else for(let n=0;n<r.rounds.length;n++)r.rounds[n].eventId||e.push(`Item ${i}, round ${n}: missing eventId`)}return{valid:e.length===0,errors:e}}function YZ(t){let e=[];if(!Array.isArray(t))return e.push("Entries must be an array"),{valid:!1,errors:e};for(let i=0;i<t.length;i++){let r=t[i];(!r.date||!/^\d{4}-\d{2}-\d{2}$/.test(r.date))&&e.push(`Entry ${i}: invalid or missing date`),(!r.startTime||!/^\d{2}:\d{2}$/.test(r.startTime))&&e.push(`Entry ${i}: invalid or missing startTime (expected HH:MM)`),(!r.endTime||!/^\d{2}:\d{2}$/.test(r.endTime))&&e.push(`Entry ${i}: invalid or missing endTime (expected HH:MM)`),r.startTime&&r.endTime&&r.startTime>=r.endTime&&e.push(`Entry ${i}: startTime must be before endTime`),r.venueId||e.push(`Entry ${i}: missing venueId`)}return{valid:e.length===0,errors:e}}function KZ(t){if(t.length===0)return t;let e=new Map;for(let r of t){let n=`${r.venueId}|${r.date}`,a=e.get(n)||[];a.push(r),e.set(n,a)}let i=[];for(let r of e.values()){r.sort((a,s)=>a.startTime.localeCompare(s.startTime));let n={...r[0]};for(let a=1;a<r.length;a++){let s=r[a];s.startTime<=n.endTime?(n.endTime=s.endTime>n.endTime?s.endTime:n.endTime,n.courtIds&&s.courtIds&&(n.courtIds=[...new Set([...n.courtIds,...s.courtIds])])):(i.push(n),n={...s})}i.push(n)}return i}function XZ(t){let e=0;for(let i of t){let r=jW(i.startTime),n=(jW(i.endTime)-r)/60,a=i.courtIds?.length||1;e+=n*a}return e}function jW(t){let[e,i]=t.split(":").map(Number);return e*60+i}var JZ={};ct(JZ,{addCourt:()=>qC,addCourts:()=>Z_,addVenue:()=>sS,deleteCourt:()=>see,deleteVenue:()=>R$,deleteVenues:()=>tee,disableCourts:()=>iee,disableVenues:()=>ree,enableCourts:()=>nee,enableVenues:()=>aee,generate:()=>QZ,generateCourts:()=>E_,getCompetitionVenues:()=>DS,getCourts:()=>f_,getVenuesAndCourts:()=>Cu,modifyCourt:()=>C$,modifyCourtAvailability:()=>P$,modifyVenue:()=>oee,mutate:()=>ZZ,publicFindVenue:()=>dL,query:()=>TX});var QZ={};ct(QZ,{generateCourts:()=>E_});var ZZ={};ct(ZZ,{addCourt:()=>qC,addCourts:()=>Z_,addVenue:()=>sS,deleteCourt:()=>see,deleteVenue:()=>R$,deleteVenues:()=>tee,disableCourts:()=>iee,disableVenues:()=>ree,enableCourts:()=>nee,enableVenues:()=>aee,modifyCourt:()=>C$,modifyCourtAvailability:()=>P$,modifyVenue:()=>oee});function D$(t){if(!t?.tournamentRecord&&!Array.isArray(t?.venueMatchUps))return{error:Ie};if(!t?.courtId)return{error:ih};let{scheduleVisibilityFilters:e,tournamentRecord:i,matchUpFilters:r,venueMatchUps:n,courtId:a}=t,{schedulingProfile:s}=$c({tournamentRecord:i});if(Array.isArray(n))return{matchUps:l({matchUps:n,courtId:a})};let{matchUps:o}=br({scheduleVisibilityFilters:e,tournamentRecord:i,matchUpFilters:r});return{matchUps:l({matchUps:o,courtId:a})};function l({matchUps:u,courtId:c}){let d=u.filter(p=>{let f=p.schedule?.allocatedCourts?.map(({courtId:m})=>m);return p.schedule?.courtId===c||f?.includes(c)});return hP({matchUps:d,schedulingProfile:s})}}function eNe({scheduleVisibilityFilters:t,tournamentRecord:e,matchUpFilters:i,venueId:r}){if(!e)return{error:Ie};if(!r)return{error:xd};let{schedulingProfile:n}=$c({tournamentRecord:e}),{matchUps:a}=br({scheduleVisibilityFilters:t,tournamentRecord:e,matchUpFilters:i});return{matchUps:s({matchUps:a,venueId:r})};function s({matchUps:o,venueId:l}){let u=o.filter(c=>{let d=c.schedule?.allocatedCourts?.map(({venueId:p})=>p);return c.schedule?.venueId===l||d?.includes(l)});return hP({matchUps:u,schedulingProfile:n})}}function P$({tournamentRecord:t,dateAvailability:e,disableNotice:i,venueMatchUps:r,courtId:n,force:a}){if(!t)return{error:Ie};if(!n)return{error:ih};let s=OR({dateAvailability:e});if(s.error)return s;let{updatedDateAvailability:o,totalMergeCount:l}=tNe(e);e=o;let u=jd({tournamentRecord:t,courtId:n});if(u.error)return u;let{court:c,venue:d}=u,{matchUps:p}=D$({tournamentRecord:t,venueMatchUps:r,courtId:n});if(p?.length){let f=Tt({tournamentRecord:t})?.appliedPolicies,m=a??f?.[Fd]?.allowDeletionWithScoresPresent?.courts,h=[];h.length&&(m||console.log("throw error: scheduled court matchUps",h.length))}return c&&(c.dateAvailability=e,!i&&d&&at({payload:{venue:d,tournamentId:t.tournamentId},topic:xc,key:d.venueId})),{...H,totalMergeCount:l}}function tNe(t){let e=0,i=t.reduce((n,a)=>{let{date:s,startTime:o,endTime:l,bookings:u}=a;return n[s]||(n[s]=[]),n[s].push({startTime:o,endTime:l,bookings:u}),n},{}),r=[];return Object.keys(i).forEach(n=>{i[n].sort(bbe);let{mergedAvailability:a,mergeCount:s}=iNe(i[n]);r.push(...a.map(o=>({date:n,...o}))),e+=s}),{updatedDateAvailability:r,totalMergeCount:e}}function iNe(t){let e,i,r,n=t.length,a=0,s=[];for(;t.length&&n;){let l=t.shift(),{startTime:u,endTime:c,bookings:d}=l;if(n-=1,!e)e=u,r=d,i=c;else if(xw(Xi(i),Xi(u),!1)>0){let p={startTime:e,endTime:i};r?.length&&(p.bookings=r),s.push(p),e=u,r=d,i=c}else d&&(r?r.push(d):r=d),i=c,a+=1}let o={startTime:e,endTime:i};return r?.length&&(o.bookings=r),s.push(o),{mergedAvailability:s,mergeCount:a}}function E$({matchUpsCount:t=0}){let e=`Schedule would be deleted from ${t} ${t===1?"matchUp":"matchUps"}; use { force: true }`;return{error:T4,info:e}}function eee({tournamentRecord:t,drawDefinition:e,matchUpId:i,drawId:r}){let n="removeCourtAssignment";if(!i)return{error:Un};if(!e&&!r)return{error:Oo};let a;if(!e){if(!t)return{error:Ie};({drawDefinition:e}=jn({tournamentRecord:t,drawId:r}))}if(e)({matchUp:a}=di({drawDefinition:e,matchUpId:i}));else{if(!t)return{error:Ie};let s=br({tournamentRecord:t,inContext:!1}).matchUps??[];({matchUp:a}=S8({matchUps:s,matchUpId:i}))}return a?(a.timeItems&&a.timeItems.find(s=>[Id,lu].includes(s.itemType))&&(a.timeItems=a.timeItems.filter(({itemType:s})=>![Id,lu].includes(s)),St({tournamentId:t?.tournamentId,context:n,drawDefinition:e,matchUp:a})),{...H}):{error:un}}function R$(t){if(typeof t?.venueId!="string")return{error:xd};let{tournamentRecord:e,venueId:i,force:r}=t,n=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(!Object.keys(n).length)return{error:Ie};let a=Eo({tournamentRecords:n,contextFilters:{venueIds:[i]}}).matchUps??[],s=Tt({tournamentRecord:e})?.appliedPolicies,o=r??s?.[Fd]?.allowDeletionWithScoresPresent?.venues;if(!a.length||o)for(let l of Object.values(n)){for(let c of a){let d=eee({matchUpId:c.matchUpId,drawId:c.drawId,tournamentRecord:l});if(d.error)return d}let u;l.venues=(l.venues??[]).filter(c=>c?.venueId!==i?!0:(u=!0,!1)),u&&at({payload:{venueId:i,tournamentId:l.tournamentId},topic:GF,key:i})}else return E$({matchUpsCount:a.length});return NS({tournamentRecords:n}),{...H}}function tee({tournamentRecord:t,venueIds:e,force:i}){if(!t)return{error:Ie};if(!Array.isArray(e))return{error:ie};for(let r of t.venues||[]){let{venueId:n}=r;if(e.includes(n)){let{venueId:a}=r,s=R$({tournamentRecord:t,venueId:a,force:i});if(s.error)return s}}return{...H}}function iee(t){let{courtIds:e,dates:i}=t,r=Is(t),n=[{[cn]:!0,[IR]:!0}],a=Ge(t,n);if(a.error)return a;for(let s of Object.values(r))rNe({tournamentRecord:s,courtIds:e,dates:i});return{...H}}function rNe({tournamentRecord:t,courtIds:e,dates:i}){let r=Array.isArray(i)&&i.length?{dates:i}:!0,n=a=>xt({extension:{value:r,name:Io},creationTime:!1,element:a});for(let a of t.venues||[])for(let s of a.courts||[])if(e?.includes(s.courtId)){let o=n(s);if(o.error)return o}return{...H}}function ree(t){let{tournamentRecords:e,tournamentId:i,venueIds:r}=t,n=[{[cn]:!0,[vR]:!0}],a=Ge(t,n);if(a.error)return a;let s=Object.keys(e).filter(o=>!i||o===i);for(let o of s){let l=e[o];nNe({tournamentRecord:l,venueIds:r})}return{...H}}function nNe({tournamentRecord:t,venueIds:e}){for(let i of t.venues||[])if(e?.includes(i.venueId)){let r=xt({creationTime:!1,element:i,extension:{name:Io,value:!0}});if(r.error)return r}return{...H}}function nee(t){let e=Is(t),i=[{[cn]:!0}];!t.enableAll&&i.push({[IR]:!0});let r=Ge(t,i);if(r.error)return r;let{enableAll:n,courtIds:a,dates:s}=t;for(let o of Object.values(e))aNe({tournamentRecord:o,courtIds:a,enableAll:n,dates:s});return{...H}}function aNe({tournamentRecord:t,courtIds:e,enableAll:i,dates:r}){for(let n of t.venues||[])for(let a of n.courts||[])if(i||e?.includes(a.courtId))if(Array.isArray(r)){let{extension:s}=mt({element:a,name:Io});if(s){let o=s.value;Array.isArray(o.dates)&&(o.dates=o.dates.filter(l=>!r.includes(l))),xt({extension:{name:Io,value:o},creationTime:!1,element:a})}}else En({element:a,name:Io});return{...H}}function aee(t){let e=Is(t),i=[{[cn]:!0}];!t.enableAll&&i.push({[vR]:!0});let r=Ge(t,i);if(r.error)return r;let{venueIds:n,enableAll:a}=t;for(let s of Object.values(e))for(let o of s.venues||[])(a||n?.includes(o.venueId))&&En({element:o,name:Io});return{...H}}function see(t){let{courtId:e,disableNotice:i,force:r}=t,n=Is(t),a=Ge(t,[{[cn]:!0,[j5]:!0}]);if(a.error)return a;let s,o;for(let l of Object.values(n)){if(o=sNe({tournamentRecord:l,disableNotice:i,courtId:e,force:r}),o.error&&o.error!==ac)return o;o.success&&(s=!0)}return s?{...H}:o}function sNe({tournamentRecord:t,disableNotice:e,courtId:i,force:r}){let n=jd({tournamentRecord:t,courtId:i});if(n.error)return n;let a=n.venue,{matchUps:s}=D$({tournamentRecord:t,courtId:i}),o=Tt({tournamentRecord:t})?.appliedPolicies,l=r??o?.[Fd]?.allowDeletionWithScoresPresent?.courts;if(!s?.length||l){for(let u of s??[]){let c=eee({matchUpId:u.matchUpId,drawId:u.drawId,tournamentRecord:t});if(c.error)return c}a&&(a.courts=(a.courts??[]).filter(u=>u.courtId!==i),e||at({payload:{venue:a,tournamentId:t.tournamentId},topic:xc,key:a.venueId}))}else return E$({matchUpsCount:s.length});return{...H}}function C$(t){let{disableNotice:e,modifications:i,courtId:r,force:n,venueMatchUps:a}=t,s=Is(t);if(!Object.keys(s).length)return{error:Ci};let o;for(let l of Object.values(s)){let u=oNe({tournamentRecord:l,disableNotice:e,venueMatchUps:a,modifications:i,courtId:r,force:n});if(u?.error)return u;o=!0}return o?{...H}:void 0}function oNe({tournamentRecord:t,disableNotice:e,venueMatchUps:i,modifications:r,courtId:n,force:a}){if(!t)return{error:Ie};if(!n)return{error:ih};if(!r||typeof r!="object")return{error:Ac};let s=jd({tournamentRecord:t,courtId:n});if(s.error)return s;let{venue:o,court:l}=s,u=Object.keys(iMe()).filter(p=>p!=="courtId");if(!Object.keys(r).filter(p=>u.includes(p)).length)return{error:JE};let c=new Set(u.filter(p=>!["dateAvailability"].includes(p))),d=Object.keys(r).filter(p=>c.has(p));if(l&&d.forEach(p=>Object.assign(l,{[p]:r[p]})),r.dateAvailability){let p=P$({dateAvailability:r.dateAvailability,tournamentRecord:t,venueMatchUps:i,disableNotice:e,courtId:n,force:a});if(p.error)return p}return e||at({payload:{venue:o,tournamentId:t.tournamentId},topic:xc,key:o?.venueId}),{...H,court:ke(l)}}var lNe=()=>({venueId:void 0,venueName:"",venueAbbreviation:"",onlineResources:[],venueType:void 0,defaultStartTime:void 0,defaultEndTime:void 0,isPrimary:void 0,dateAvailability:[],addresses:[],contacts:[],courts:[],roles:[]}),uNe=lNe;function oee(t){let{modifications:e,venueId:i,force:r}=t,n=Is(t);if(!Object.keys(n).length)return{error:Ci};if(typeof i!="string")return{error:xd};let a,s;for(let o of Object.values(n)){let l=pNe({tournamentRecord:o,modifications:e,venueId:i,force:r});if(l.success&&(s=!0),l.error&&(a=l.error),l.error&&l.error!==tf)return l}return NS({tournamentRecords:n}),s?{...H}:{error:a}}function cNe({venue:t,modifications:e,tournamentRecord:i,venueMatchUps:r,allowModificationWhenMatchUpsScheduled:n}){let a=t?.courts?.map(u=>u.courtId)??[],s=e.courts?.map(u=>u.courtId)||[],o=s.length?a.filter(u=>!s.includes(u)):e?.courts&&a,l=[];if(o?.length){let u=t?.courts?.filter(c=>o.includes(c.courtId))?.map(c=>{let d=D$({courtId:c.courtId,tournamentRecord:i,venueMatchUps:r});for(let p of d.matchUps??[])l.push({matchUpId:p.matchUpId,drawId:p.drawId});return d.matchUps?.length??0}).reduce((c,d)=>c+d);return t&&(!u||n)?(t.courts=t.courts?.filter(c=>s.includes(c.courtId)),kb({schedule:{courtId:"",scheduledDate:""},matchUpDetails:l,removePriorValues:!0,tournamentRecord:i}),{success:!0}):E$({matchUpsCount:u})}return{success:!0}}function dNe({modifications:t,tournamentRecord:e,venueMatchUps:i,venueId:r,force:n}){if(t.courts)for(let a of t.courts){let{courtId:s}=a||{},o=C$({modifications:a,disableNotice:!0,tournamentRecord:e,venueMatchUps:i,courtId:s,force:n});if(o?.error===ac&&(o=qC({disableNotice:!0,tournamentRecord:e,venueId:r,court:a})),o?.error)return o}return{success:!0}}function pNe({tournamentRecord:t,modifications:e,venueId:i,force:r}){if(!t)return{error:Ie};if(!e||typeof e!="object")return{error:Ac};if(!i)return{error:xd};let n=Tt({tournamentRecord:t})?.appliedPolicies,a=r??n?.[Fd]?.allowDeletionWithScoresPresent?.venues,{matchUps:s}=eNe({tournamentRecord:t,venueId:i}),o=Eu({tournamentRecord:t,venueId:i});if(o.error)return o;let l=o.venue,u=Object.keys(uNe()).filter(g=>g!=="venueId");if(!Object.keys(e).filter(g=>u.includes(g)).length)return{error:JE};let c=new Set(u.filter(g=>!["courts","onlineResources","dateAvailability","isPrimary"].includes(g))),d=Object.keys(e).filter(g=>c.has(g));if(!l)return{error:tf};let p=e.defaultStartTime??l.defaultStartTime,f=e.defaultEndTime??l.defaultEndTime;if(p||f){if(!p||!f)return{error:ie,info:"both defaultStartTime and defaultEndTime are required"};if(!iP({startTime:p,endTime:f}))return{error:ie,info:"defaultEndTime must be after defaultStartTime"}}if(d.forEach(g=>Object.assign(l,{[g]:e[g]})),"isPrimary"in e&&(e.isPrimary?(XK({tournamentRecord:t}),l.isPrimary=!0):delete l.isPrimary),e.dateAvailability!==void 0){if(Array.isArray(e.dateAvailability)&&e.dateAvailability.length){let g=OR({dateAvailability:e.dateAvailability});if(g.error)return g}l.dateAvailability=e.dateAvailability}let m=cNe({venue:l,modifications:e,tournamentRecord:t,venueMatchUps:s,allowModificationWhenMatchUpsScheduled:a});if("error"in m&&m.error)return m;let h=dNe({modifications:e,tournamentRecord:t,venueMatchUps:s,venueId:i,force:r});return h?.error?h:(NS({tournamentRecord:t}),l&&at({payload:{venue:l,tournamentId:t.tournamentId},topic:xc,key:l?.venueId}),{...H,venue:ke(l)})}var JC={};ct(JC,{JSON2CSV:()=>yNe,UUID:()=>Et,UUIDS:()=>Y4,allNumeric:()=>o6,attributeFilter:()=>Rm,chunkArray:()=>yr,chunkByNth:()=>qk,chunkSizeProfile:()=>s6,constantToString:()=>Xr,countValues:()=>dIe,createMap:()=>t6,dateTime:()=>q4,definedAttributes:()=>Ve,dehydrateMatchUps:()=>hNe,extractAttributes:()=>ZK,flattenJSON:()=>M$,generateDateRange:()=>Qg,generateHashCode:()=>sIe,generateRange:()=>Re,generateTimeCode:()=>aQ,groupValues:()=>n6,hasAttributeValues:()=>aIe,instanceCount:()=>va,intersection:()=>xi,isConvertableInteger:()=>ot,isNumeric:()=>Ni,isOdd:()=>i6,isPowerOf2:()=>Uo,isValidEmbargoDate:()=>id,makeDeepCopy:()=>ke,matchUpScheduleSort:()=>mNe,matchUpSort:()=>gh,nearestPowerOf2:()=>k1,nextPowerOf2:()=>XI,noNulls:()=>cIe,noNumeric:()=>l6,numericSort:()=>ir,occurrences:()=>fIe,overlap:()=>kn,randomMember:()=>da,randomPop:()=>ma,shuffleArray:()=>Dn,structureSort:()=>ch,subSort:()=>mIe,timeZone:()=>GCe,undefinedToNull:()=>Wk,unique:()=>rt,visualizeScheduledMatchUps:()=>fNe});function fNe({scheduledMatchUps:t,showGlobalLog:e}){Vbe();let i=t?.reduce((n,{structureId:a})=>n.includes(a)?n:n.concat(a),[]),r=Array.isArray(i)&&{...i.map(n=>{let{structureName:a,matchUpType:s}=t.find(o=>o.structureId===n);return{[n]:`${a} ${s}`}})};i?.forEach(n=>{Gt({color:"blue",method:"draw",structure:r[n],keyColors:{structure:"magenta"}},!0);let a=t.filter(o=>o.structureId===n),s=bn({matchUps:a})?.roundMatchUps||[];Object.keys(s).forEach(o=>{Gt({roundNumber:o,keyColors:{roundNumber:"brightcyan"}},!0),s[o].forEach(({matchUpId:l,schedule:u})=>{let c=ci(u.scheduledTime);Gt({matchUpId:l,time:c,date:u.scheduledDate,venue:u.venueId,keyColors:{time:"brightcyan",date:"brightcyan",matchUpId:"yellow",venue:"magenta"}},!0)})})}),e&&Bbe()}var{extractTime:GW,timeStringMinutes:HW}=q4;function mNe(t,e){let i=t.schedule??{},r=e.schedule??{};if(i.scheduledDate&&!r.scheduledDate)return 1;if(r.scheduledDate&&!i.scheduledDate)return-1;if(i.scheduledDate&&r.scheduledDate){if(i.scheduledDate===r.scheduledDate){if(i.scheduledTime&&!r.scheduledTime)return 1;if(r.scheduledTime&&!i.scheduledTime)return-1;if(i.scheduledTime&&r.scheduledTime){let n=HW(GW(i.scheduledTime)),a=HW(GW(r.scheduledTime));return n-a}}return new Date(i.scheduledDate).getTime()-new Date(r.scheduledDate).getTime()}return 0}function hNe({tournamentRecord:t}){if(!t)return{error:Ie};if(typeof t!="object"||!t.tournamentId)return{error:ie};let{matchUps:e}=br({tournamentRecord:t,inContext:!1});if(e?.length){let i=gNe({tournamentRecord:t});vNe(e,i)}return{...H}}function gNe({tournamentRecord:t}){let e={};for(let i of t.events||[]){i.matchUpFormat&&(e[i.eventId]=i.matchUpFormat);for(let r of i.drawDefinitions||[]){r.matchUpFormat&&(e[r.drawId]=r.matchUpFormat);for(let n of r.structures||[]){n.matchUpFormat&&(e[n.structureId]=n.matchUpFormat);for(let a of n.structures||[])a.matchUpFormat&&(e[a.structureId]=a.matchUpFormat)}}}return e}var INe=["collectionId","collectionPosition","drawPositions","extensions","finishingPositionRange","finishingRound","isMock","matchUpId","matchUpStatus","matchUpStatusCodes","orderOfFinish","processCodes","roundNumber","tieFormat","tieMatchUps","roundPosition","score","sides","winnerMatchUpId","loserMatchUpId","matchUpDuration","winningSide"];function vNe(t,e={}){for(let i of t){let{structureId:r,drawId:n,eventId:a}=i,s=e[r]||e[n]||e[a],o=i.matchUpFormat===s?void 0:i.matchUpFormat;for(let l of Object.keys(i))INe.includes(l)||delete i[l];i.sides&&i.drawPositions&&!i.tieMatchUps&&delete i.sides,o&&(i.matchUpFormat=o)}}function yNe(t,e){if(e&&typeof e!="object")return{error:ie};let{columnTransform:i={}}=e||{},{includeTransformAccessors:r,includeHeaderRow:n=!0,returnTransformedJSON:a,removeEmptyColumns:s,onlyHeaderRow:o,columnAccessors:l=[],functionMap:u={},columnMap:c={},valuesMap:d={},context:p={},delimiter:f='"',columnJoiner:m=",",rowJoiner:h=`\r
`,keyJoiner:g="."}=e||{};if(!Array.isArray(t)||!Array.isArray(l)||typeof p!="object"||typeof c!="object"||typeof i!="object"||typeof u!="object"||typeof d!="object"||typeof m!="string"||typeof h!="string"||typeof g!="string"||typeof f!="string")return{error:ie};i=Object.assign({},...Object.keys(i).reverse().map(M=>({[M]:Array.isArray(i[M])?i[M]:[typeof i[M]=="string"&&i[M]].filter(Boolean)})));let I=t.filter(Boolean).map(M=>M$(M,g)),v=Object.values(i).flat();r&&l.push(...v);let w=I.reduce((M,N)=>Object.keys(N).every(A=>!M.includes(A)&&M.push(A)||!0)&&M,[]).filter(M=>!l?.length||l.includes(M)),y=Object.assign({},...Object.keys(i).reverse().map(M=>i[M].map(N=>({[N]:M})).flat()).flat()),b=(M,N)=>e?.sortOrder?e.sortOrder.includes(M)&&e.sortOrder.includes(N)&&e.sortOrder.indexOf(M)-e.sortOrder.indexOf(N)||!e.sortOrder.includes(N)&&-1:0,S=w.reduce((M,N)=>{let A=y[N];return A?M.includes(A)||M.push(A):M.push(N),M},[]).sort(b);Object.keys(c).forEach(M=>!S.includes(M)&&S.unshift(M)),Object.keys(i).forEach(M=>!S.includes(M)&&S.unshift(M)),typeof p=="object"&&Object.keys(p).forEach(M=>!S.includes(M)&&S.unshift(M));let U=S.map(M=>c[M]||M);if(o)return[U];let T=M=>`${f}${M}${f}`,P=[],D=M=>Object.values(S.reduce((N,A,O)=>{let k=i[A],F=(k?.length?M[k.find($=>M[$])]:M[A])||p?.[A]||"",x=d[A]?.[F]||F,L=pa(u[A])?u[A](x):x;return N[A]=T(L),L&&(P[O]=(P[O]||0)+1),N},{})),E=I.map(D),R=s&&[...P].map((M,N)=>!M&&N).filter(Ni).reverse();if(R){let M=N=>N.filter((A,O)=>!R.includes(O));E=E.map(M),U=M(U)}let C=E.map(M=>M.join(m));return a?C.map(M=>{let N=M.split(m);return Object.assign({},...N.map((A,O)=>({[U[O]]:A})))}):n?[U.map(T).join(m),...C].join(h):C.join(h)}function M$(t,e=".",i=[]){return typeof t=="object"&&Object.keys(t).reduce((r,n)=>typeof t[n]!="object"?(r[i.concat(n).join(e)]=t[n],r):Object.assign(r,M$(t[n],e,i.concat(n))),{})}var{FACTORY:WW}=J5;function bNe({tournamentRecord:t,value:e}){let{extension:i}=mt({element:t,name:WW}),r={name:WW,value:{...i?.value,...e}};xt({element:t,extension:r})}function lee({timeStamp:t}){let e=ah(),i=oF();return i&&Object.values(e).forEach(r=>{bNe({tournamentRecord:r,value:{version:BE(),timeStamp:t}})}),i}function uee({engineType:t,methodName:e,elapsed:i,params:r,result:n}){let a=ra();if(typeof a!="object")return;let s={method:e},o=n?.error&&(a.errors===!0||Array.isArray(a.errors)&&a.errors.includes(e)),l=Array.isArray(a.params)&&a.params?.includes(e),u=a.params&&!Array.isArray(a.params)||l,c=Array.isArray(a.exclude)&&a.exclude.includes(e);!c&&![void 0,!1].includes(a.perf)&&!isNaN(a.perf)&&i>=a.perf&&(s.elapsed=i),!c&&(o||u)&&(s.params=r),!c&&(o||a.result&&!Array.isArray(a.result)&&(!Array.isArray(a.params)||l)||Array.isArray(a.result)&&a.result?.includes(e))&&(s.result=n),Object.keys(s).length>1&&x4(s,t)}function N$({methodName:t,params:e,start:i}){let r={error:QE,methodName:t},n=i?Date.now()-i:0;return uee({result:r,methodName:t,elapsed:n,params:e,engineType:"sync"}),r}function wNe(t,e){if(e._middleware===!1)return e;if(e.tournamentId&&!t[e.tournamentId])return{error:Ie};let i=e.drawId||e.matchUp?.drawId;if(i){let{event:a,drawDefinition:s,tournamentId:o}=jn({tournamentRecords:t,drawId:i});s&&(e.drawDefinition=s),o&&(e.tournamentId=o),a&&(e.event=a)}if(e.eventId&&!e.event){let{event:a,tournamentId:s}=jn({eventId:e.eventId,tournamentRecords:t});if(!a)return{error:os};e.tournamentId=s,e.event=a}let r=e.tournamentId??nh();if(!r&&e)return e;let n=t[r];return r&&!n?{error:Ie}:(n&&(e.tournamentRecord=n),e)}function A$(t,e,i,r,n){delete t.success,delete t.error;let a=Date.now(),s=nh();i&&(i.activeTournamentId=s);let o=i?.tournamentRecord||uF(s),l=typeof i?.tournamentRecord=="object"&&{[i?.tournamentRecord.tournamentId]:i.tournamentRecord}||ah(),u=i?ke(i,void 0,!0):void 0,c=i?wNe(l,i):void 0;if(c?.error)return c;let d=SNe({params:c,tournamentRecords:l,tournamentRecord:o,methodName:r,method:e}),p=Date.now()-a;return uee({result:d,methodName:r,elapsed:p,params:u,engineType:n}),d}function SNe({tournamentRecords:t,tournamentRecord:e,params:i,methodName:r,method:n}){if(ra())return n({tournamentRecords:t,tournamentRecord:e,...i});try{return n({tournamentRecords:t,tournamentRecord:e,...i})}catch(a){return iR({engineName:"engine",methodName:r,params:i,err:a})}}function QC(t){let{mutationStatus:e,tournamentId:i,directives:r,timeStamp:n}=t||{},{topics:a}=gs();for(let s of[...a].sort(UNe)){let o=A4({topic:s});o?.length&&rO({topic:s,notices:o})}e&&n&&a.includes(dO)&&rO({notices:[{tournamentId:i,directives:r,timeStamp:n}],topic:dO})}var zW={[JF]:5,[XF]:5,[QF]:5,[KF]:5,[YF]:5,[zF]:5,[fK]:5,[mK]:5,[qF]:1,[DR]:1,[en]:5,[xc]:5,[WF]:4,[jF]:4,[GF]:4,[HF]:4,[TR]:3,[$F]:2};function UNe(t,e){return(zW[e]||0)-(zW[t]||0)}function TNe({convertExtensions:t,removeExtensions:e}){let i=ah();return{tournamentId:nh(),tournamentRecords:ke(i,t,!1,e)}}function DNe(t){let{convertExtensions:e=!1,removeExtensions:i=!1}=t??{},r=t?.tournamentId??nh();if(typeof r!="string")return{};let n=uF(r);return{tournamentRecord:ke(n,e,!1,i)}}function PNe(){let t=ah(),{extension:e}=mt({name:Cp,tournamentRecords:t,discover:!0}),i=e?.value?.tournamentIds||[];return Object.keys(t).forEach(r=>{i.includes(r)||delete t[r]}),tR(t)}function qW(t,e=!0){return typeof t!="object"||Array.isArray(t)?{error:Ac}:t?.tournamentId?k4(e?ke(t):t):{error:ie}}function xb(t,e=!0){if(typeof t!="object")return{error:Ac};if(pb(),Array.isArray(t)){if(t.filter(i=>i?.tournamentId).length!==t.length)return{error:Kk};t=Object.assign({},...t.map(i=>({[i.tournamentId]:i})))}else if(t?.tournamentId)t={[t.tournamentId]:t},pb(t.tournamentId);else if(!Object.keys(t).every(i=>t[i].tournamentId===i))return{error:Kk};return tR(e?ke(t):t)}function ENe(t,e,i,r,n,a){let s=F4(i,r,n,a);if(s.error)return s;let o=s.methods??[];return Object.keys(o).filter(l=>pa(o[l])).forEach(l=>{t[l]=u=>{let c=()=>e(t,{[l]:o[l],...u});if(ra())return c();try{return c()}catch(d){iR({engineName:"engine",methodName:l,params:u,err:d})}}}),{...H,...t}}function ug(t,e){return e?.error?(t.error=e.error,t.success=!1):(t.error=void 0,t.success=!0),t}function cee(t,e){t.importMethods=(i,r,n,a)=>ENe(t,e,i,r,n,a),t.getTournament=i=>DNe(i),t.getState=i=>TNe({convertExtensions:i?.convertExtensions,removeExtensions:i?.removeExtensions}),t.version=()=>BE(),t.reset=()=>(tR({}),ug(t)),t.devContext=i=>(cb(i),ug(t)),t.getDevContext=i=>ra(i),t.newTournamentRecord=(i={})=>{let r=WC(i),n=r.tournamentId;return r.error?r:(qW(r),pb(n),{...H,tournamentId:n})},t.setState=(i,r,n)=>{db(r,n);let a=xb(i,r);return ug(t,a)},t.setTournamentId=i=>pb(i),t.getTournamentId=()=>nh(),t.setTournamentRecord=(i,r,n)=>{db(r,n);let a=qW(i,r);return ug(t,a)},t.removeTournamentRecord=i=>{let r=O4(i);return ug(t,r)},t.removeUnlinkedTournamentRecords=()=>{let i=PNe();return ug(t,i)}}function RNe(t,e,i){if(!Array.isArray(e))return{error:ie,message:"directives must be an array"};let r=N4(),n=Date.now(),a=i&&ke(ah(),!1,!0),s=[];for(let u of e){if(typeof u!="object")return{error:ie,message:"directive must be an object"};if(u.params&&typeof u.params!="object")return{error:ie,message:"params must be an object"};let{method:c,pipe:d}=u,p=u.params?{...u.params}:{};if(!r[c])return N$({methodName:c,start:n,params:p});if(d){let m=s.at(-1),h=Object.keys(d);for(let g of h)m[g]&&(p[g]=m[g])}let f=A$(t,r[c],p,c,"sync");if(f?.error)return a&&xb(a),{...f,rolledBack:!!a};s.push({...f,methodName:c})}let o=Date.now(),l=lee({timeStamp:o});return QC({directives:e,mutationStatus:l,timeStamp:o}),Ow(),{success:s.every(u=>u.success),results:s}}function YW(t,e){if(!bt(e))return{error:ie,message:"args must be an object"};let i=Object.values(e).filter(pa).length;if(i>1)return{message:"there must be only one arg with typeof function",error:ie};let r=i?Object.keys(e).find(f=>pa(e[f])):ri(e.method)&&e.method;if(!r)return{error:QE};let{[r]:n,...a}=e,s=e?.params?{...e.params}:{...a},o=s.rollbackOnError&&ke(ah(),!1,!0),l=n||t[r]||aF()[r];if(!l)return N$({methodName:r,params:s});let u=A$(t,l,s,r,"sync")??{};u?.error&&o&&xb(o);let c=Date.now(),d=lee({timeStamp:c}),p=u?.success&&s?.delayNotify!==!0&&s?.doNotNotify!==!0;return p&&QC({directives:[{method:l,params:s}],mutationStatus:d,timeStamp:c}),(p||!u?.success||s?.doNotNotify)&&Ow(),u}var CNe=(()=>{let t={executionQueue:(e,i)=>RNe(t,e,i),execute:e=>YW(t,e)};return cee(t,YW),t})(),k$=CNe;function KW(t,e){if(!bt(e))return{error:ie,message:"args must be an object"};let i=Object.values(e).filter(pa).length;if(i>1)return{message:"there must be only one arg with typeof function",error:ie};let r=i?Object.keys(e).find(l=>pa(e[l])):ri(e.method)&&e.method;if(!r)return{error:QE};let{[r]:n,...a}=e,s=e?.params?{...e.params}:{...a},o=n||t[r]||aF()[r];return o?A$(t,o,s,r,"ask"):N$({methodName:r,params:s})}(()=>{let t={execute:e=>KW(t,e)};return cee(t,KW),t})();var lm={},ed;function dee(t,e=!0){if(!t)return{error:Xe};if(typeof t!="object")return{error:Ac};if(t.matchUpId)ed=t.matchUpId,lm[ed]=e?ke(t):t;else if(Array.isArray(t))for(let i of t.reverse())i.matchUpId&&(lm[i.matchUpId]=e?ke(i):i,ed||(ed=i.matchUpId));else for(let i of Object.values(t))i.matchUpId&&(lm[i.matchUpId]=e?ke(i):i,ed||(ed=i.matchUpId));return e?ke(t):t}function MNe(){return lm[ed]}function NNe(){return Object.values(lm)}function ANe(){ed=void 0,lm={}}function kNe(t){return ke(lm[ed],t?.convertExtensions,!1,t?.removeExtensions)}(()=>{let t={getState:i=>kNe(i),version:()=>BE(),reset:()=>(ANe(),{...H}),drawId:void 0,error:void 0,success:!1,devContext:i=>(cb(i),t),setState:(i,r,n)=>{db(r,n);let a=dee(i);return e(a)}};function e(i){return i?.error?(t.error=i.error,t.success=!1):(t.error=void 0,t.success=!0,t.drawId=i.drawId),t}return ONe(t,[m0]),t})();function ONe(t,e){e.forEach(i=>{Object.keys(i).forEach(r=>{t[r]=n=>{if(ra())return XW(t,{params:n,governor:i,methodName:r});try{return XW(t,{params:n,governor:i,methodName:r})}catch(a){iR({engineName:"matchUpEngine",methodName:r,params:n,err:a})}}})})}function XW(t,{params:e,governor:i,methodName:r}){t.error=void 0,t.success=!1;let n=e?.matchUp||MNe(),a=e?.matchUps||NNe(),s=e?.rollbackOnError&&ke(n,!1,!0);e={...e,matchUpId:n?.matchUpId,matchUps:a,matchUp:n};let o=i[r](e);if(o?.error)return s&&dee(s),{...o,rolledBack:!!s};let l=o?.success&&e?.delayNotify!==!0&&e?.doNotNotify!==!0;return l&&QC(),(l||!o?.success||e?.doNotNotify)&&Ow(),o}var HA=!1;(()=>{let t={version:()=>BE(),setDeepCopy:(n,a)=>(db(n,a),t),devContext:n=>(cb(n),HA=!0,t)};return i([G_]),t;function e(n,a){let s=n({...a});return s?.error||QC(),Ow(),HA&&(cb(!1),HA=!1),s}function i(n){n.forEach(a=>{Object.keys(a).forEach(s=>{t[s]=r(a,s)})})}function r(n,a){return s=>{if(ra()){let o=e(n[a],s);return!o?.error&&s?.setState&&o?.tournamentRecord&&xb(o.tournamentRecord),o}else try{let o=e(n[a],s);return!o?.error&&s?.setState&&o?.tournamentRecord&&xb(o.tournamentRecord),o}catch(o){let l;typeof o=="string"?l=o.toUpperCase():o instanceof Error&&(l=o.message),console.log("ERROR",{params:JSON.stringify(s),method:a,error:l})}}}})();var xNe={};ct(xNe,{BLOCK_TYPES:()=>kt,EvaluatorRegistry:()=>FZ,TemporalEngine:()=>FNe,adjacentBlockEvaluator:()=>v$,applyTemporalAvailabilityToTournamentRecord:()=>HZ,blockDurationEvaluator:()=>b$,buildDayRange:()=>DZ,buildEdges:()=>c$,buildSchedulingProfileFromUISelections:()=>WZ,calculateCapacityStats:()=>EZ,calculateCourtHours:()=>XZ,clampDragToCollisions:()=>kZ,clampToDayRange:()=>l$,compareCapacityCurves:()=>MZ,computePlanItemId:()=>TP,courtDayKey:()=>Gy,courtKey:()=>Ag,courtOverlapEvaluator:()=>g$,createFollowByEvaluator:()=>LZ,dayBoundaryEvaluator:()=>w$,defaultEvaluators:()=>xZ,deriveRailSegments:()=>p$,diffMinutes:()=>BS,extractDay:()=>rp,filterCapacityCurve:()=>RZ,findBlocksContainingTime:()=>AZ,formatConflicts:()=>BZ,generateCapacityCurve:()=>m$,getHighestSeverity:()=>$Z,groupConflictsBySeverity:()=>_Z,hhmmToMinutes:()=>Ob,intervalsOverlap:()=>NZ,iterateDayTicks:()=>jZ,lightingEvaluator:()=>y$,maintenanceWindowEvaluator:()=>S$,matchWindowEvaluator:()=>I$,mergeAdjacentSegments:()=>f$,mergeOverlappingAvailability:()=>KZ,minutesToHhmm:()=>XC,overlappingRange:()=>TZ,railsToDateAvailability:()=>T$,rangesOverlap:()=>u$,resolveCourtId:()=>qf,resolveStatus:()=>UP,resolveVenueId:()=>om,runValidationPipeline:()=>GZ,sampleCapacityCurve:()=>CZ,snapIsoToGranularity:()=>VZ,snapToGranularity:()=>U$,sortBlocksByStart:()=>OZ,sortEdges:()=>d$,timeInsideBlock:()=>h$,todsAvailabilityToBlocks:()=>zZ,validateDateAvailability:()=>YZ,validateSchedulingProfileFormat:()=>qZ,validateSegments:()=>PZ,venueDayKey:()=>UZ,venueKey:()=>Hf});var sd,FNe=(sd=class{constructor(){this.tournamentRecord=null,this.blocksById=new Map,this.blocksByCourtDay=new Map,this.courtDayAvailability=new Map,this.venueDayAvailability=new Map,this.templates=new Map,this.rules=new Map,this.plans=new Map,this.subscribers=[],this.resolvedGranularity=15,this.nextBlockId=1}init(e,i){this.tournamentRecord=e,this.config={tournamentId:i?.tournamentId||e?.tournamentId||"tournament-1",dayStartTime:i?.dayStartTime||"06:00",dayEndTime:i?.dayEndTime||"23:00",slotMinutes:i?.slotMinutes||15,granularityMinutes:i?.granularityMinutes,typePrecedence:i?.typePrecedence||[kt.HARD_BLOCK,kt.LOCKED,kt.MAINTENANCE,kt.BLOCKED,kt.PRACTICE,kt.RESERVED,kt.SOFT_BLOCK,kt.AVAILABLE,kt.UNSPECIFIED],conflictEvaluators:i?.conflictEvaluators||[]},this.resolvedGranularity=this.config.granularityMinutes??this.config.slotMinutes??15,this.plans.clear(),this.loadBlocksFromTournamentRecord(),this.emit({type:"STATE_CHANGED",payload:{reason:"INIT"}})}updateTournamentRecord(e){this.tournamentRecord=e,this.loadBlocksFromTournamentRecord(),this.emit({type:"STATE_CHANGED",payload:{reason:"TOURNAMENT_RECORD_UPDATED"}})}getConfig(){return{...this.config}}getResolvedGranularityMinutes(){return this.resolvedGranularity}getCourtAvailability(e,i){let r=Ag(e),n=this.courtDayAvailability.get(`${r}|${i}`)??this.courtDayAvailability.get(`${r}|DEFAULT`)??null,a=Hf(e.tournamentId,e.venueId),s=this.venueDayAvailability.get(`${a}|${i}`)??this.venueDayAvailability.get(`${a}|DEFAULT`)??null;if(n&&s){let l=n.startTime>s.startTime?n.startTime:s.startTime,u=n.endTime<s.endTime?n.endTime:s.endTime;return l>=u?s:{startTime:l,endTime:u}}return n||s||this.courtDayAvailability.get("GLOBAL|DEFAULT")||{startTime:this.config.dayStartTime,endTime:this.config.dayEndTime}}setCourtAvailability(e,i,r){let n=Ag(e);this.courtDayAvailability.set(`${n}|${i}`,r),this.emit({type:"AVAILABILITY_CHANGED",payload:{court:e,day:i,avail:r}})}setCourtAvailabilityAllDays(e,i){let r=Ag(e);this.courtDayAvailability.set(`${r}|DEFAULT`,i),this.emit({type:"AVAILABILITY_CHANGED",payload:{court:e,scope:"all-days",avail:i}})}setAllCourtsDefaultAvailability(e){this.courtDayAvailability.set("GLOBAL|DEFAULT",e),this.emit({type:"AVAILABILITY_CHANGED",payload:{scope:"global",avail:e}})}getVenueAvailability(e,i,r){let n=Hf(e,i);if(r){let a=this.venueDayAvailability.get(`${n}|${r}`);if(a)return a}return this.venueDayAvailability.get(`${n}|DEFAULT`)??null}setVenueDefaultAvailability(e,i,r){let n=Hf(e,i);this.venueDayAvailability.set(`${n}|DEFAULT`,r),this.emit({type:"AVAILABILITY_CHANGED",payload:{tournamentId:e,venueId:i,scope:"venue",avail:r}})}setVenueDayAvailability(e,i,r,n){let a=Hf(e,i);this.venueDayAvailability.set(`${a}|${r}`,n),this.emit({type:"AVAILABILITY_CHANGED",payload:{tournamentId:e,venueId:i,day:r,scope:"venue-day",avail:n}})}getVisibleTimeRange(e,i){let r=i&&i.length>0?i:this.getAllCourtsFromTournamentRecord(),n="23:59",a="00:00";for(let s of r){let o=this.getCourtAvailability(s,e);o.startTime<n&&(n=o.startTime),o.endTime>a&&(a=o.endTime)}return r.length===0?{startTime:this.config.dayStartTime,endTime:this.config.dayEndTime}:{startTime:n,endTime:a}}getTournamentDays(){if(!this.tournamentRecord?.startDate)return[];let e=this.tournamentRecord.startDate,i=this.tournamentRecord.endDate||e,r=[],n=new Date(e),a=new Date(i);for(;n<=a;)r.push(n.toISOString().slice(0,10)),n.setDate(n.getDate()+1);return r}getDayTimeline(e){let i=this.getAllCourtsFromTournamentRecord(),r=new Map;for(let a of i){let s=r.get(a.venueId)||[];s.push(a),r.set(a.venueId,s)}let n=[];for(let[a,s]of r.entries()){let o=[];for(let l of s){let u=this.getCourtRail(e,l);u&&o.push(u)}n.push({day:e,venueId:a,rails:o})}return n}getVenueTimeline(e,i){return this.getDayTimeline(e).find(r=>r.venueId===i)||null}getCourtRail(e,i){let r=this.getCourtAvailability(i,e),n={start:`${e}T${r.startTime}:00`,end:`${e}T${r.endTime}:00`},a=Gy(i,e),s=(this.blocksByCourtDay.get(a)||[]).map(l=>this.blocksById.get(l)).filter(l=>!!l),o=p$(s,n,this.config);return{court:i,segments:o}}getCapacityCurve(e){let i=this.getDayTimeline(e);return m$(e,i)}getDayBlocks(e){let i=[];for(let r of this.blocksById.values())rp(r.start)===e&&i.push(r);return i}getAllBlocks(){return Array.from(this.blocksById.values())}getTemplates(){return Array.from(this.templates.values())}getTemplate(e){return this.templates.get(e)||null}getRules(){return Array.from(this.rules.values())}getRule(e){return this.rules.get(e)||null}addPlanItem(e){let i=TP(e),r={...e,planItemId:i},n=this.plans.get(e.day)||{day:e.day,items:[]};return n.items=n.items.filter(a=>a.planItemId!==i),n.items.push(r),this.plans.set(e.day,n),this.emit({type:"PLAN_CHANGED",payload:{action:"ADD",planItem:r}}),this.emit({type:"STATE_CHANGED",payload:{reason:"PLAN_CHANGED"}}),r}removePlanItem(e){for(let[i,r]of this.plans.entries()){let n=r.items.findIndex(a=>a.planItemId===e);if(n!==-1){let a=r.items.splice(n,1)[0];return r.items.length===0&&this.plans.delete(i),this.emit({type:"PLAN_CHANGED",payload:{action:"REMOVE",planItem:a}}),this.emit({type:"STATE_CHANGED",payload:{reason:"PLAN_CHANGED"}}),!0}}return!1}updatePlanItem(e,i){for(let r of this.plans.values()){let n=r.items.find(a=>a.planItemId===e);if(n)return Object.assign(n,i),this.emit({type:"PLAN_CHANGED",payload:{action:"UPDATE",planItem:n}}),this.emit({type:"STATE_CHANGED",payload:{reason:"PLAN_CHANGED"}}),n}return null}movePlanItem(e,i){let r=null;for(let[s,o]of this.plans.entries()){let l=o.items.findIndex(u=>u.planItemId===e);if(l!==-1){r=o.items.splice(l,1)[0],o.items.length===0&&this.plans.delete(s);break}}if(!r)return null;let n={...r,day:i};n.planItemId=TP(n);let a=this.plans.get(i)||{day:i,items:[]};return a.items=a.items.filter(s=>s.planItemId!==n.planItemId),a.items.push(n),this.plans.set(i,a),this.emit({type:"PLAN_CHANGED",payload:{action:"MOVE",planItem:n,fromDay:r.day}}),this.emit({type:"STATE_CHANGED",payload:{reason:"PLAN_CHANGED"}}),n}getDayPlan(e){return this.plans.get(e)||null}getAllPlans(){return Array.from(this.plans.values())}applyBlock(e){let i=[];for(let r of e.courts){let n=rp(e.timeRange.start),a=this.clampToAvailability(r,n,e.timeRange.start,e.timeRange.end);if(!a)continue;let s={id:this.generateBlockId(),court:r,start:a.start,end:a.end,type:e.type,reason:e.reason,hardSoft:e.hardSoft,source:e.source||"USER"};i.push({kind:"ADD_BLOCK",block:s})}return this.applyMutations(i)}moveBlock(e){let i=this.blocksById.get(e.blockId);if(!i)return{applied:[],rejected:[],warnings:[{code:"BLOCK_NOT_FOUND",message:`Block ${e.blockId} not found`}],conflicts:[]};let r=e.newCourt||i.court,n=rp(e.newTimeRange.start),a=this.clampToAvailability(r,n,e.newTimeRange.start,e.newTimeRange.end);if(!a)return{applied:[],rejected:[],warnings:[{code:"OUTSIDE_AVAILABILITY",message:"Block falls outside court availability"}],conflicts:[]};let s={...i,start:a.start,end:a.end,court:r};return this.applyMutations([{kind:"UPDATE_BLOCK",block:s,previousBlock:i}])}resizeBlock(e){let i=this.blocksById.get(e.blockId);if(!i)return{applied:[],rejected:[],warnings:[{code:"BLOCK_NOT_FOUND",message:`Block ${e.blockId} not found`}],conflicts:[]};let r=rp(e.newTimeRange.start),n=this.clampToAvailability(i.court,r,e.newTimeRange.start,e.newTimeRange.end);if(!n)return{applied:[],rejected:[],warnings:[{code:"OUTSIDE_AVAILABILITY",message:"Block falls outside court availability"}],conflicts:[]};let a={...i,start:n.start,end:n.end};return this.applyMutations([{kind:"UPDATE_BLOCK",block:a,previousBlock:i}])}removeBlock(e){let i=this.blocksById.get(e);return i?this.applyMutations([{kind:"REMOVE_BLOCK",block:i}]):{applied:[],rejected:[],warnings:[{code:"BLOCK_NOT_FOUND",message:`Block ${e} not found`}],conflicts:[]}}applyTemplate(e){return this.templates.get(e.templateId)?{applied:[],rejected:[],warnings:[],conflicts:[]}:{applied:[],rejected:[],warnings:[{code:"TEMPLATE_NOT_FOUND",message:`Template ${e.templateId} not found`}],conflicts:[]}}importScheduledMatchUps(e){let i=[];for(let a of this.blocksById.values())a.type===kt.SCHEDULED&&a.source==="SYSTEM"&&i.push({kind:"REMOVE_BLOCK",block:a});for(let a of i)this.applyMutation(a);let r=[];for(let a of e){let s=a.startTime.length===5?`${a.startTime}:00`:a.startTime,o=this.timeToMinutes(s)+a.durationMinutes,l=Math.floor(o/60),u=o%60,c=`${String(l).padStart(2,"0")}:${String(u).padStart(2,"0")}:00`,d={id:this.generateBlockId(),court:{tournamentId:this.config.tournamentId,venueId:a.venueId,courtId:a.courtId},start:`${a.date}T${s}`,end:`${a.date}T${c}`,type:kt.SCHEDULED,source:"SYSTEM",matchUpId:a.matchUpId,reason:"Scheduled Match"};r.push({kind:"ADD_BLOCK",block:d})}let n=this.applyMutations(r);return{...n,applied:[...i,...n.applied]}}timeToMinutes(e){let i=e.split(":").map(Number);return i[0]*60+i[1]}simulateBlocks(e,i){let r=this.createSnapshot(),n=r.applyMutations(e),a=i||this.getFirstAvailableDay(),s=a?r.getDayTimeline(a):[],o=a?r.getCapacityCurve(a):void 0;return{previewRails:s,capacityImpact:o,conflicts:n.conflicts}}subscribe(e){return this.subscribers.push(e),()=>{let i=this.subscribers.indexOf(e);i>-1&&this.subscribers.splice(i,1)}}emit(e){for(let i of this.subscribers)try{i(e)}catch(r){console.error("Error in event listener:",r)}}applyMutations(e){let i=this.evaluateConflicts(e);if(i.filter(n=>n.severity==="ERROR").length>0)return{applied:[],rejected:e,warnings:[],conflicts:i};let r=[];for(let n of e)this.applyMutation(n),r.push(n);return this.emit({type:"BLOCKS_CHANGED",payload:{mutations:r}}),this.emit({type:"STATE_CHANGED",payload:{reason:"BLOCKS_MUTATED"}}),i.length>0&&this.emit({type:"CONFLICTS_CHANGED",payload:{conflicts:i}}),{applied:r,rejected:[],warnings:i.filter(n=>n.severity==="WARN").map(n=>({code:n.code,message:n.message})),conflicts:i}}applyMutation(e){let{kind:i,block:r,previousBlock:n}=e;switch(i){case"ADD_BLOCK":this.blocksById.set(r.id,r),this.indexBlock(r);break;case"UPDATE_BLOCK":n&&this.unindexBlock(n),this.blocksById.set(r.id,r),this.indexBlock(r);break;case"REMOVE_BLOCK":this.unindexBlock(r),this.blocksById.delete(r.id);break}}indexBlock(e){let i=rp(e.start),r=Gy(e.court,i),n=this.blocksByCourtDay.get(r)||[];n.includes(e.id)||(n.push(e.id),this.blocksByCourtDay.set(r,n))}unindexBlock(e){let i=rp(e.start),r=Gy(e.court,i),n=(this.blocksByCourtDay.get(r)||[]).filter(a=>a!==e.id);n.length>0?this.blocksByCourtDay.set(r,n):this.blocksByCourtDay.delete(r)}evaluateConflicts(e){let i=this.createContext(),r=[];for(let n of this.config.conflictEvaluators||[])try{let a=n.evaluate(i,e);r.push(...a)}catch(a){console.error(`Error in evaluator ${n.id}:`,a)}return r}createContext(){return{config:this.config,tournamentRecord:this.tournamentRecord,blocksById:new Map(this.blocksById),blocksByCourtDay:new Map(this.blocksByCourtDay),templates:new Map(this.templates),rules:new Map(this.rules)}}createSnapshot(){let e=new sd;return e.config={...this.config},e.tournamentRecord=this.tournamentRecord,e.blocksById=new Map(this.blocksById),e.blocksByCourtDay=new Map(this.blocksByCourtDay),e.courtDayAvailability=new Map(this.courtDayAvailability),e.venueDayAvailability=new Map(this.venueDayAvailability),e.templates=new Map(this.templates),e.rules=new Map(this.rules),e.plans=new Map([...this.plans.entries()].map(([i,r])=>[i,{...r,items:[...r.items]}])),e.nextBlockId=this.nextBlockId,e.resolvedGranularity=this.resolvedGranularity,e}loadBlocksFromTournamentRecord(){if(this.blocksById.clear(),this.blocksByCourtDay.clear(),this.courtDayAvailability.clear(),this.venueDayAvailability.clear(),!!this.tournamentRecord?.venues)for(let e of this.tournamentRecord.venues){let i=om(e),r=Hf(this.config.tournamentId,i);if(e.defaultStartTime&&e.defaultEndTime&&this.venueDayAvailability.set(`${r}|DEFAULT`,{startTime:e.defaultStartTime,endTime:e.defaultEndTime}),e.dateAvailability?.length){for(let n of e.dateAvailability)if(n.date?n.startTime&&n.endTime&&this.venueDayAvailability.set(`${r}|${n.date}`,{startTime:n.startTime,endTime:n.endTime}):n.startTime&&n.endTime&&this.venueDayAvailability.set(`${r}|DEFAULT`,{startTime:n.startTime,endTime:n.endTime}),n.bookings?.length&&e.courts?.length){let a=n.date||this.tournamentRecord.startDate;for(let s of n.bookings){if(!s.startTime||!s.endTime)continue;let o=s.startTime.length===5?`${s.startTime}:00`:s.startTime,l=s.endTime.length===5?`${s.endTime}:00`:s.endTime,u=sd.BOOKING_TYPE_MAP[(s.bookingType||"").toUpperCase()]||kt.RESERVED;for(let c of e.courts){let d={tournamentId:this.config.tournamentId,venueId:i,courtId:qf(c)},p=this.generateBlockId(),f={id:p,court:d,start:`${a}T${o}`,end:`${a}T${l}`,type:u,reason:s.bookingType||"Booking",source:"SYSTEM"};this.blocksById.set(p,f),this.indexBlock(f)}}}}for(let n of e.courts||[]){if(!n.dateAvailability?.length)continue;let a={tournamentId:this.config.tournamentId,venueId:i,courtId:qf(n)};for(let s of n.dateAvailability){let o=s.date||this.tournamentRecord.startDate;if(s.startTime&&s.endTime){let l=Ag(a);this.courtDayAvailability.set(`${l}|${o}`,{startTime:s.startTime,endTime:s.endTime})}if(s.bookings?.length)for(let l of s.bookings){if(!l.startTime||!l.endTime)continue;let u=l.startTime.length===5?`${l.startTime}:00`:l.startTime,c=l.endTime.length===5?`${l.endTime}:00`:l.endTime,d=sd.BOOKING_TYPE_MAP[(l.bookingType||"").toUpperCase()]||kt.RESERVED,p=this.generateBlockId(),f={id:p,court:a,start:`${o}T${u}`,end:`${o}T${c}`,type:d,reason:l.bookingType||"Booking",source:"SYSTEM"};this.blocksById.set(p,f),this.indexBlock(f)}}}}}getAllCourtsFromTournamentRecord(){if(!this.tournamentRecord?.venues)return[];let e=[];for(let i of this.tournamentRecord.venues){let r=om(i);if(i.courts)for(let n of i.courts)e.push({tournamentId:this.config.tournamentId,venueId:r,courtId:qf(n)})}return e}getFirstAvailableDay(){return this.tournamentRecord?.startDate?Qe(this.tournamentRecord.startDate):null}generateBlockId(){return`block-${this.nextBlockId++}`}clampToAvailability(e,i,r,n){let a=this.getCourtAvailability(e,i),s=`${i}T${a.startTime}:00`,o=`${i}T${a.endTime}:00`,l=r<s?s:r,u=n>o?o:n;return l>=u?null:{start:l,end:u}}listCourtMeta(){return this.getAllCourtsFromTournamentRecord().map(e=>this.getCourtMeta(e))}getCourtMeta(e){if(this.tournamentRecord?.venues){for(let i of this.tournamentRecord.venues)if(om(i)===e.venueId)for(let r of i.courts||[]){if(qf(r)!==e.courtId)continue;let n=this.getFirstAvailableDay(),a=n?this.getCourtAvailability(e,n):void 0;return{ref:e,name:r.courtName||r.courtId,surface:r.surfaceCategory||r.surfaceType||"hard",indoor:r.indoorOutdoor==="INDOOR"||r.indoor||!1,hasLights:r.hasLights||!1,tags:[],openTime:a?.startTime,closeTime:a?.endTime}}}return{ref:e,name:e.courtId,surface:"hard",indoor:!1,hasLights:!1,tags:[]}}},sd.BOOKING_TYPE_MAP={MAINTENANCE:kt.MAINTENANCE,PRACTICE:kt.PRACTICE,RESERVED:kt.RESERVED,MATCH:kt.SCHEDULED,SCHEDULED:kt.SCHEDULED},sd),LNe={calculateNewRatings:o9,generateDynamicRatings:l9};k$.importMethods({...i$,...LNe});k$.importMethods(JY,!0,1);var _Ne=k$,$Ne={ratingsParameters:Dr},pee={};ct(pee,{activeMatchUpStatuses:()=>_F,auditConstants:()=>PRe,competitionFormatConstants:()=>qNe,completedMatchUpStatuses:()=>Yi,directingMatchUpStatuses:()=>sK,displayConstants:()=>qUe,drawDefinitionConstants:()=>pR,entryStatusConstants:()=>Vye,errorConditionConstants:()=>xIe,eventConstants:()=>gF,extensionConstants:()=>J5,flightConstants:()=>$Re,genderConstants:()=>rR,keyValueConstants:()=>_De,matchUpActionConstants:()=>eTe,matchUpStatusConstants:()=>uK,matchUpTypes:()=>rIe,nonDirectingMatchUpStatuses:()=>oK,particicipantsRequiredMatchUpStatuses:()=>nK,participantConstants:()=>wK,participantRoles:()=>TL,participantTypes:()=>Ly,penaltyConstants:()=>dAe,policyConstants:()=>gye,positionActionConstants:()=>rUe,rankingConstants:()=>zEe,ratingConstants:()=>zbe,recoveryTimeRequiredMatchUpStatuses:()=>Rye,requestConstants:()=>kCe,resourceContants:()=>Lve,resultConstants:()=>IIe,scaleConstants:()=>pye,scheduleConstants:()=>gbe,sortingConstants:()=>zRe,surfaceConstants:()=>IAe,tieFormatConstants:()=>$ve,timeItemConstants:()=>cbe,topicConstants:()=>Mye,tournamentConstants:()=>V8,upcomingMatchUpStatuses:()=>lK,validMatchUpStatuses:()=>aK,venueConstants:()=>bAe,weekdayConstants:()=>GX});var BNe="INTENNSE_STANDARD",VNe="TENNIS_STANDARD",jNe="MATCHUP",GNe="HALF",HNe="SEGMENT",WNe="BETWEEN_GAMES",zNe="BETWEEN_POINTS",qNe={INTENNSE_STANDARD:BNe,TENNIS_STANDARD:VNe,MATCHUP:jNe,SET:"SET",HALF:GNe,SEGMENT:HNe,BETWEEN_GAMES:WNe,BETWEEN_POINTS:zNe,ANY:"ANY"},YNe="Coaching",KNe="Ball Abuse",XNe="Racket Abuse",JNe="Verbal Abuse",QNe="INELIGIBILITY",ZNe="Physical Abuse",eAe="Unsportmanlike Conduct",tAe="Dress Code Violation",iAe="Equipment Violation",rAe="Leaving the court",nAe="Failure to complete",aAe="No Show",sAe="Other",oAe="REFUSAL_TO_PLAY",lAe="PROHIBITED_SUBSTANCE",uAe="Puncuality",cAe="Failure to sign in",dAe={COACHING:YNe,BALL_ABUSE:KNe,RACKET_ABUSE:XNe,VERBAL_ABUSE:JNe,PHYSICAL_ABUSE:ZNe,INELIGIBILITY:QNe,UNSPORTSMANLIKE_CONDUCT:eAe,PROHIBITED_SUBSTANCE:lAe,DRESS_CODE_VIOLATION:tAe,EQUIMENT_VIOLATION:iAe,LEAVING_THE_COURT:rAe,REFUSAL_TO_PLAY:oAe,FAILURE_TO_COMPLETE:nAe,NO_SHOW:aAe,OTHER:sAe,PUNCTUALITY:uAe,FAILUIRE_TO_SIGN_IN:cAe},pAe="CLAY",fAe="HARD",mAe="GRASS",hAe="CARPET",gAe="ARTIFICIAL",IAe={CLAY:pAe,HARD:fAe,GRASS:mAe,CARPET:hAe,ARTIFICIAL:gAe},vAe="INDOOR",yAe="OUTDOOR",bAe={INDOOR:vAe,OUTDOOR:yAe};function DP(t,e){const i=t?.person||t?.participant?.person,r=e?.person||e?.participant?.person;return i||r?i?.standardFamilyName&&!r?.standardFamilyName||r?.standardFamilyName&&!i?.standardFamilyName||!i?.standardFamilyName&&!r?.standardFamilyName?1:i.standardFamilyName?.localeCompare(r?.standardFamilyName):t.participantName&&!e.participantName||e.participantName&&!t.participantName||!t?.participantName&&!e?.participantName?1:t?.participantName?.localeCompare(e?.participantName)}function VS({anchorId:t}){const e=KI.findTable(`#${t}`)[0];e&&e.destroy()}const{ratingsParameters:JW}=$Ne,{SINGLES:QW}=gF,ZW="playersTable";function wAe({participants:t=[]}){VS({anchorId:ZW});const e=document.getElementById(ZW);if(!e)return;const i=t.filter(u=>u.participantType==="INDIVIDUAL");i.sort(DP);const r=i.map(u=>{const d=(u.person||{}).nationalityCode||"",p=(u.events||[]).map(g=>g.eventName).join(", "),f={};for(const g of u.ratings?.[QW]||[]){const I=g.scaleName.toLowerCase(),w=JW[g.scaleName.toUpperCase()]?.accessor||`${I}Rating`;f[I]=typeof g.scaleValue=="object"&&g.scaleValue!==null?g.scaleValue:{[w]:g.scaleValue}}const h=u.rankings?.[QW]?.[0]?.scaleValue??void 0;return{name:u.participantName||"",country:d,ratings:f,ranking:h,events:p}}),n=new Set;let a=!1;for(const u of r){for(const c of Object.keys(u.ratings||{}))n.add(c);u.ranking!==null&&u.ranking!==void 0&&(a=!0)}const s=[];for(const u of n){const c=u.toUpperCase(),d=JW[c];if(!d)continue;const p=d.accessor||`${u}Rating`;s.push({title:c,field:`ratings.${u}.${p}`,sorter:"number",sorterParams:{alignEmptyValues:"bottom"},headerSort:!0,width:80})}s.sort((u,c)=>u.title.localeCompare(c.title));const o=[{title:"Name",field:"name",sorter:"string",headerSort:!0},{title:"Country",field:"country",sorter:"string",headerSort:!0,width:100}],l=[];a&&l.push({title:"Rank",field:"ranking",sorter:"number",sorterParams:{alignEmptyValues:"bottom"},headerSort:!0,width:80}),l.push(...s),l.push({title:"Events",field:"events",sorter:"string",headerSort:!0}),o.push(...l),new KI(e,{height:window.innerHeight*.84,placeholder:"No participants",data:r,columns:o})}const{AFTER_REST:SAe,FOLLOWED_BY:UAe,NEXT_AVAILABLE:TAe,NOT_BEFORE:DAe,TO_BE_ANNOUNCED:PAe}=pee.timeItemConstants,WO="overlay",Gi="center",ez="header",Fm="right",Lp="left",tz="top",zO="",TT="flex",Go="none",EAe="buttonBar",iz="roundsColumns",RAe=8,rz="roundsStats",nz="roundsTable",CAe={[SAe]:"After rest",[UAe]:"Followed by",[PAe]:"TBA",[TAe]:"Next available",[DAe]:"NB"};function Wu(t){return typeof t=="function"}function qO(t){return typeof t=="object"&&!Array.isArray(t)}const WA="font-medium";function um(t){const{target:e,button:i,stateChange:r}=t;let n=0;const a=()=>(n+=1,`Item${n}`),s=document.createElement("div");i.class&&s.classList.add(i.class),s.classList.add("dropdown"),i.id&&(s.id=i.id),i.align===Fm?(s.classList.add("is-right"),s.style.marginLeft="1em"):s.style.marginRight="1em";const o=v=>v.classList.contains("is-active"),l=()=>{o(s)&&s.classList.remove("is-active")},u=v=>{o(v)?v.classList.remove("is-active"):v.classList.add("is-active")};s.onmouseleave=l,s.onclick=()=>u(s);const c=document.createElement("div");c.classList.add("dropdown-trigger");const d=document.createElement("button");d.className="button font-medium",i.intent&&d.classList.add(i.intent),d.setAttribute("aria-haspopup","true");const p=document.createElement("span");Wu(i.onClick)&&(p.onclick=i.onClick),p.style.marginRight="1em",p.innerHTML=i.label,d.appendChild(p);const f=document.createElement("span");Wu(i.onClick)&&(f.onclick=i.onClick),f.innerHTML=`
      <span class="icon is-small font-medium">
        
      </span>
  `,f.style.height="2em",d.appendChild(f),c.appendChild(d),s.appendChild(c);const m=document.createElement("div");m.classList.add("dropdown-menu"),m.style.zIndex="99998";const h=document.createElement("div");h.classList.add("dropdown-content");const g=()=>{const v=m.querySelectorAll(".dropdown-item");for(const w of Array.from(v))w.classList.remove("is-active")},I=v=>{const w=document.createElement("a");w.className=WA;const y=v.disabled?"0.4":"1";return w.style.textDecoration="none",w.style.opacity=y,v.color&&(w.style.color=v.color),w.classList.add("dropdown-item"),v.isActive&&w.classList.add("is-active"),v.value&&w.setAttribute("value",v.value),v.class&&w.classList.add(v.class),w.onclick=b=>{if(v.disabled)return;v.value&&(d.value=v.value,s.setAttribute("value",v.value)),b.stopPropagation(),Wu(v.onClick)&&(Wu(r)&&r(),v.onClick(b)),v.close&&l();const S=o(w);g(),S?p.innerHTML=i.label:(i.selection&&u(w),i.modifyLabel&&v.modifyLabel!==!1&&(p.innerHTML=`${i.append?i.label+": ":""}${v?.label||a()}`))},w.innerHTML=v?.label||a(),w};for(const v of i.options||[])if(v.heading){const w=document.createElement("div");w.style.fontWeight="bold",w.classList.add("dropdown-item"),w.classList.add(WA),w.innerHTML=v.heading,h.appendChild(w)}else if(v.divider){const w=document.createElement("hr");w.classList.add("dropdown-divider"),w.classList.add(WA),h.appendChild(w)}else v.hide||h.appendChild(I(v));return i.options?.length&&(i.options[0].value&&s.setAttribute("value",i.options[0].value),m.appendChild(h)),s.appendChild(m),e&&e.appendChild(s),s}function MAe(t){if(t)for(;t.firstChild;)t.removeChild(t.firstChild)}function NAe(t,e){return t?JC.dateTime.convertTime(t,e):""}function fee(t){const e=document.createElement("span");if(!t.getColumn().getDefinition().field)return e.className="schedule-cell",e;const r=t.getValue(),{potentialParticipants:n,eventName:a="",roundName:s="",schedule:o={},winningSide:l,matchUpId:u,sides:c}=r||{},{courtOrder:d="",scheduledTime:p="",courtId:f="",timeModifiers:m,venueId:h=""}=o;if(e.setAttribute("courtOrder",d),e.setAttribute("courtId",f),e.setAttribute("venueId",h),e.className="schedule-cell dragdrop",e.ondragover=R=>R.preventDefault(),u&&(e.draggable=!0,e.id=u,l&&e.classList.add("matchup-complete")),!u)return e;const g=`${a} ${s}`,I=R=>R.person?.standardFamilyName?.toUpperCase()||R.participantName,v=n?.map(R=>R?.map(C=>`<span class='potential nowrap'>${I(C)}</span>`).join('<span style="font-weight: bold">&nbsp;or&nbsp;</span>')),w=R=>{const C=c?.find(M=>R===M.sideNumber)?.participant?.participantName;if(C)return l===R?`<span style='font-weight: bold'>${C}</span>`:C},y=w(1)||v?.shift()||"Unkown",b=w(2)||v?.shift()||"Unknown";e.id=u;const S=document.createElement("div");S.className="header flexrow",S.innerHTML=(m?.[0]&&CAe[m[0]]+"&nbsp;"||"")+NAe(p,!1),e.appendChild(S);const U=document.createElement("div");U.className="catround",U.innerHTML=g,e.appendChild(U);const T=document.createElement("div");T.className="scheduled_teams";const P=document.createElement("div");P.className="scheduled_team",P.style.fontSize="1em",P.innerHTML=y,T.appendChild(P);const D=document.createElement("div");D.className="divider",D.innerHTML="vs.",T.appendChild(D);const E=document.createElement("div");if(E.className="scheduled_team",E.style.fontSize="1em",E.innerHTML=b,T.appendChild(E),l){const R=document.createElement("div");R.innerHTML=r.score?.scoreStringSide1||"",T.appendChild(R)}return e.appendChild(T),e}function AAe({count:t}){return t>0?JC.generateRange(0,t).map(()=>({headerHozAlign:Gi,formatter:fee,headerSort:!1,resizable:!1,minWidth:150})):[]}function kAe(t){t.getElement().style.backgroundColor="var(--chc-bg-primary)";const e=document.createElement("span"),i=t.getRow().getData();return e.innerHTML=i.rowNumber,e}function OAe(){return{formatter:kAe,headerSort:!1,resizable:!1,hozAlign:Gi,frozen:!0,width:55}}function xAe({courtsData:t,courtPrefix:e}){const i=RAe-t?.length||0,r=i<=0?1:i,n=AAe({count:r}),a=OAe(),s=(o,l)=>({field:`${e}${l}`,title:o.courtName,headerHozAlign:Gi,formatter:fee,headerSort:!1,resizable:!1,hozAlign:Gi,minWidth:150});return[].concat([a],t?.map(s),n)}function FAe(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var oD={exports:{}},LAe=oD.exports,az;function _Ae(){return az||(az=1,(function(t,e){(function(i,r){t.exports=r()})(LAe,(function(){var i=1e3,r=6e4,n=36e5,a="millisecond",s="second",o="minute",l="hour",u="day",c="week",d="month",p="quarter",f="year",m="date",h="Invalid Date",g=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,I=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,v={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(M){var N=["th","st","nd","rd"],A=M%100;return"["+M+(N[(A-20)%10]||N[A]||N[0])+"]"}},w=function(M,N,A){var O=String(M);return!O||O.length>=N?M:""+Array(N+1-O.length).join(A)+M},y={s:w,z:function(M){var N=-M.utcOffset(),A=Math.abs(N),O=Math.floor(A/60),k=A%60;return(N<=0?"+":"-")+w(O,2,"0")+":"+w(k,2,"0")},m:function M(N,A){if(N.date()<A.date())return-M(A,N);var O=12*(A.year()-N.year())+(A.month()-N.month()),k=N.clone().add(O,d),F=A-k<0,x=N.clone().add(O+(F?-1:1),d);return+(-(O+(A-k)/(F?k-x:x-k))||0)},a:function(M){return M<0?Math.ceil(M)||0:Math.floor(M)},p:function(M){return{M:d,y:f,w:c,d:u,D:m,h:l,m:o,s,ms:a,Q:p}[M]||String(M||"").toLowerCase().replace(/s$/,"")},u:function(M){return M===void 0}},b="en",S={};S[b]=v;var U="$isDayjsObject",T=function(M){return M instanceof R||!(!M||!M[U])},P=function M(N,A,O){var k;if(!N)return b;if(typeof N=="string"){var F=N.toLowerCase();S[F]&&(k=F),A&&(S[F]=A,k=F);var x=N.split("-");if(!k&&x.length>1)return M(x[0])}else{var L=N.name;S[L]=N,k=L}return!O&&k&&(b=k),k||!O&&b},D=function(M,N){if(T(M))return M.clone();var A=typeof N=="object"?N:{};return A.date=M,A.args=arguments,new R(A)},E=y;E.l=P,E.i=T,E.w=function(M,N){return D(M,{locale:N.$L,utc:N.$u,x:N.$x,$offset:N.$offset})};var R=(function(){function M(A){this.$L=P(A.locale,null,!0),this.parse(A),this.$x=this.$x||A.x||{},this[U]=!0}var N=M.prototype;return N.parse=function(A){this.$d=(function(O){var k=O.date,F=O.utc;if(k===null)return new Date(NaN);if(E.u(k))return new Date;if(k instanceof Date)return new Date(k);if(typeof k=="string"&&!/Z$/i.test(k)){var x=k.match(g);if(x){var L=x[2]-1||0,$=(x[7]||"0").substring(0,3);return F?new Date(Date.UTC(x[1],L,x[3]||1,x[4]||0,x[5]||0,x[6]||0,$)):new Date(x[1],L,x[3]||1,x[4]||0,x[5]||0,x[6]||0,$)}}return new Date(k)})(A),this.init()},N.init=function(){var A=this.$d;this.$y=A.getFullYear(),this.$M=A.getMonth(),this.$D=A.getDate(),this.$W=A.getDay(),this.$H=A.getHours(),this.$m=A.getMinutes(),this.$s=A.getSeconds(),this.$ms=A.getMilliseconds()},N.$utils=function(){return E},N.isValid=function(){return this.$d.toString()!==h},N.isSame=function(A,O){var k=D(A);return this.startOf(O)<=k&&k<=this.endOf(O)},N.isAfter=function(A,O){return D(A)<this.startOf(O)},N.isBefore=function(A,O){return this.endOf(O)<D(A)},N.$g=function(A,O,k){return E.u(A)?this[O]:this.set(k,A)},N.unix=function(){return Math.floor(this.valueOf()/1e3)},N.valueOf=function(){return this.$d.getTime()},N.startOf=function(A,O){var k=this,F=!!E.u(O)||O,x=E.p(A),L=function(Y,X){var Z=E.w(k.$u?Date.UTC(k.$y,X,Y):new Date(k.$y,X,Y),k);return F?Z:Z.endOf(u)},$=function(Y,X){return E.w(k.toDate()[Y].apply(k.toDate("s"),(F?[0,0,0,0]:[23,59,59,999]).slice(X)),k)},V=this.$W,_=this.$M,B=this.$D,G="set"+(this.$u?"UTC":"");switch(x){case f:return F?L(1,0):L(31,11);case d:return F?L(1,_):L(0,_+1);case c:var j=this.$locale().weekStart||0,K=(V<j?V+7:V)-j;return L(F?B-K:B+(6-K),_);case u:case m:return $(G+"Hours",0);case l:return $(G+"Minutes",1);case o:return $(G+"Seconds",2);case s:return $(G+"Milliseconds",3);default:return this.clone()}},N.endOf=function(A){return this.startOf(A,!1)},N.$set=function(A,O){var k,F=E.p(A),x="set"+(this.$u?"UTC":""),L=(k={},k[u]=x+"Date",k[m]=x+"Date",k[d]=x+"Month",k[f]=x+"FullYear",k[l]=x+"Hours",k[o]=x+"Minutes",k[s]=x+"Seconds",k[a]=x+"Milliseconds",k)[F],$=F===u?this.$D+(O-this.$W):O;if(F===d||F===f){var V=this.clone().set(m,1);V.$d[L]($),V.init(),this.$d=V.set(m,Math.min(this.$D,V.daysInMonth())).$d}else L&&this.$d[L]($);return this.init(),this},N.set=function(A,O){return this.clone().$set(A,O)},N.get=function(A){return this[E.p(A)]()},N.add=function(A,O){var k,F=this;A=Number(A);var x=E.p(O),L=function(_){var B=D(F);return E.w(B.date(B.date()+Math.round(_*A)),F)};if(x===d)return this.set(d,this.$M+A);if(x===f)return this.set(f,this.$y+A);if(x===u)return L(1);if(x===c)return L(7);var $=(k={},k[o]=r,k[l]=n,k[s]=i,k)[x]||1,V=this.$d.getTime()+A*$;return E.w(V,this)},N.subtract=function(A,O){return this.add(-1*A,O)},N.format=function(A){var O=this,k=this.$locale();if(!this.isValid())return k.invalidDate||h;var F=A||"YYYY-MM-DDTHH:mm:ssZ",x=E.z(this),L=this.$H,$=this.$m,V=this.$M,_=k.weekdays,B=k.months,G=k.meridiem,j=function(X,Z,J,ae){return X&&(X[Z]||X(O,F))||J[Z].slice(0,ae)},K=function(X){return E.s(L%12||12,X,"0")},Y=G||function(X,Z,J){var ae=X<12?"AM":"PM";return J?ae.toLowerCase():ae};return F.replace(I,(function(X,Z){return Z||(function(J){switch(J){case"YY":return String(O.$y).slice(-2);case"YYYY":return E.s(O.$y,4,"0");case"M":return V+1;case"MM":return E.s(V+1,2,"0");case"MMM":return j(k.monthsShort,V,B,3);case"MMMM":return j(B,V);case"D":return O.$D;case"DD":return E.s(O.$D,2,"0");case"d":return String(O.$W);case"dd":return j(k.weekdaysMin,O.$W,_,2);case"ddd":return j(k.weekdaysShort,O.$W,_,3);case"dddd":return _[O.$W];case"H":return String(L);case"HH":return E.s(L,2,"0");case"h":return K(1);case"hh":return K(2);case"a":return Y(L,$,!0);case"A":return Y(L,$,!1);case"m":return String($);case"mm":return E.s($,2,"0");case"s":return String(O.$s);case"ss":return E.s(O.$s,2,"0");case"SSS":return E.s(O.$ms,3,"0");case"Z":return x}return null})(X)||x.replace(":","")}))},N.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},N.diff=function(A,O,k){var F,x=this,L=E.p(O),$=D(A),V=($.utcOffset()-this.utcOffset())*r,_=this-$,B=function(){return E.m(x,$)};switch(L){case f:F=B()/12;break;case d:F=B();break;case p:F=B()/3;break;case c:F=(_-V)/6048e5;break;case u:F=(_-V)/864e5;break;case l:F=_/n;break;case o:F=_/r;break;case s:F=_/i;break;default:F=_}return k?F:E.a(F)},N.daysInMonth=function(){return this.endOf(d).$D},N.$locale=function(){return S[this.$L]},N.locale=function(A,O){if(!A)return this.$L;var k=this.clone(),F=P(A,O,!0);return F&&(k.$L=F),k},N.clone=function(){return E.w(this.$d,this)},N.toDate=function(){return new Date(this.valueOf())},N.toJSON=function(){return this.isValid()?this.toISOString():null},N.toISOString=function(){return this.$d.toISOString()},N.toString=function(){return this.$d.toUTCString()},M})(),C=R.prototype;return D.prototype=C,[["$ms",a],["$s",s],["$m",o],["$H",l],["$W",u],["$M",d],["$y",f],["$D",m]].forEach((function(M){C[M[1]]=function(N){return this.$g(N,M[0],M[1])}})),D.extend=function(M,N){return M.$i||(M(N,R,D),M.$i=!0),D},D.locale=P,D.isDayjs=T,D.unix=function(M){return D(1e3*M)},D.en=S[b],D.Ls=S,D.p={},D}))})(oD)),oD.exports}var $Ae=_Ae();const BAe=FAe($Ae);function VAe(t){const{dateMatchUps:e=[],completedMatchUps:i=[],groupInfo:r,mappedParticipants:n}=t?.data??{},a=e.concat(...i),s=a.reduce((b,S)=>{const U=S?.schedule?.scheduledDate;return U&&!b.includes(U)&&b.push(U),b},[]),o=s[0];let l;const u=b=>{for(const S of b.sides||[])S.participantId&&(S.participant=n[S.participantId],S.participant?.individualParticipantIds&&(S.participant.individualParticipants=S.participant.individualParticipantIds.map(U=>n[U])))},c=({scheduledDate:b})=>{const S=t?.data?.courtsData.map(D=>{const{matchUps:E,...R}=D;return E.forEach(u),{...R,matchUps:E.filter(C=>C.schedule?.scheduledDate===b)}}),U="C|",T=r$.courtGridRows({courtsData:S,courtPrefix:U,minRowsCount:10,scheduledDate:b}).rows,P=xAe({courtsData:S,courtPrefix:U});return T?.forEach((D,E)=>{D.rowId=`rowId-${E+1}`,D.rowNumber=E+1}),{rows:T,columns:P,courtsCount:S?.length??0,courtsData:S,groupInfo:r}},d=({scheduledDate:b})=>{const{rows:S}=c({scheduledDate:b});l?.replaceData(S),l.matchUps=a},p=b=>BAe(b).format("dddd MMM D"),f=s.map(b=>({onClick:()=>d({scheduledDate:b}),label:p(b),value:b,close:!0})),m={label:p(o),options:f,id:"dateSelector",modifyLabel:!0,selection:!0},h=document.getElementById("scheduleHeader");MAe(h);const g=um({button:m});h.appendChild(g),VS({anchorId:"tournamentSchedule"});const I=document.getElementById("tournamentSchedule"),{rows:v=[],columns:w=[],courtsCount:y}=c({scheduledDate:o});return l=new KI(I,{height:window.innerHeight*.84,renderHorizontal:"virtual",placeholder:"No courts",index:"rowId",data:v,columns:w}),{table:l,courtsCount:y}}function jAe(){return"tmxToken"}function mee(t,e){return function(){return t.apply(e,arguments)}}const{toString:GAe}=Object.prototype,{getPrototypeOf:O$}=Object,{iterator:ZC,toStringTag:hee}=Symbol,eM=(t=>e=>{const i=GAe.call(e);return t[i]||(t[i]=i.slice(8,-1).toLowerCase())})(Object.create(null)),Mu=t=>(t=t.toLowerCase(),e=>eM(e)===t),tM=t=>e=>typeof e===t,{isArray:Rv}=Array,hI=tM("undefined");function jS(t){return t!==null&&!hI(t)&&t.constructor!==null&&!hI(t.constructor)&&_s(t.constructor.isBuffer)&&t.constructor.isBuffer(t)}const gee=Mu("ArrayBuffer");function HAe(t){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(t):e=t&&t.buffer&&gee(t.buffer),e}const WAe=tM("string"),_s=tM("function"),Iee=tM("number"),GS=t=>t!==null&&typeof t=="object",zAe=t=>t===!0||t===!1,lD=t=>{if(eM(t)!=="object")return!1;const e=O$(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(hee in t)&&!(ZC in t)},qAe=t=>{if(!GS(t)||jS(t))return!1;try{return Object.keys(t).length===0&&Object.getPrototypeOf(t)===Object.prototype}catch{return!1}},YAe=Mu("Date"),KAe=Mu("File"),XAe=t=>!!(t&&typeof t.uri<"u"),JAe=t=>t&&typeof t.getParts<"u",QAe=Mu("Blob"),ZAe=Mu("FileList"),eke=t=>GS(t)&&_s(t.pipe);function tke(){return typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{}}const sz=tke(),oz=typeof sz.FormData<"u"?sz.FormData:void 0,ike=t=>{let e;return t&&(oz&&t instanceof oz||_s(t.append)&&((e=eM(t))==="formdata"||e==="object"&&_s(t.toString)&&t.toString()==="[object FormData]"))},rke=Mu("URLSearchParams"),[nke,ake,ske,oke]=["ReadableStream","Request","Response","Headers"].map(Mu),lke=t=>t.trim?t.trim():t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function HS(t,e,{allOwnKeys:i=!1}={}){if(t===null||typeof t>"u")return;let r,n;if(typeof t!="object"&&(t=[t]),Rv(t))for(r=0,n=t.length;r<n;r++)e.call(null,t[r],r,t);else{if(jS(t))return;const a=i?Object.getOwnPropertyNames(t):Object.keys(t),s=a.length;let o;for(r=0;r<s;r++)o=a[r],e.call(null,t[o],o,t)}}function vee(t,e){if(jS(t))return null;e=e.toLowerCase();const i=Object.keys(t);let r=i.length,n;for(;r-- >0;)if(n=i[r],e===n.toLowerCase())return n;return null}const Yf=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,yee=t=>!hI(t)&&t!==Yf;function YO(){const{caseless:t,skipUndefined:e}=yee(this)&&this||{},i={},r=(n,a)=>{if(a==="__proto__"||a==="constructor"||a==="prototype")return;const s=t&&vee(i,a)||a;lD(i[s])&&lD(n)?i[s]=YO(i[s],n):lD(n)?i[s]=YO({},n):Rv(n)?i[s]=n.slice():(!e||!hI(n))&&(i[s]=n)};for(let n=0,a=arguments.length;n<a;n++)arguments[n]&&HS(arguments[n],r);return i}const uke=(t,e,i,{allOwnKeys:r}={})=>(HS(e,(n,a)=>{i&&_s(n)?Object.defineProperty(t,a,{value:mee(n,i),writable:!0,enumerable:!0,configurable:!0}):Object.defineProperty(t,a,{value:n,writable:!0,enumerable:!0,configurable:!0})},{allOwnKeys:r}),t),cke=t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),dke=(t,e,i,r)=>{t.prototype=Object.create(e.prototype,r),Object.defineProperty(t.prototype,"constructor",{value:t,writable:!0,enumerable:!1,configurable:!0}),Object.defineProperty(t,"super",{value:e.prototype}),i&&Object.assign(t.prototype,i)},pke=(t,e,i,r)=>{let n,a,s;const o={};if(e=e||{},t==null)return e;do{for(n=Object.getOwnPropertyNames(t),a=n.length;a-- >0;)s=n[a],(!r||r(s,t,e))&&!o[s]&&(e[s]=t[s],o[s]=!0);t=i!==!1&&O$(t)}while(t&&(!i||i(t,e))&&t!==Object.prototype);return e},fke=(t,e,i)=>{t=String(t),(i===void 0||i>t.length)&&(i=t.length),i-=e.length;const r=t.indexOf(e,i);return r!==-1&&r===i},mke=t=>{if(!t)return null;if(Rv(t))return t;let e=t.length;if(!Iee(e))return null;const i=new Array(e);for(;e-- >0;)i[e]=t[e];return i},hke=(t=>e=>t&&e instanceof t)(typeof Uint8Array<"u"&&O$(Uint8Array)),gke=(t,e)=>{const r=(t&&t[ZC]).call(t);let n;for(;(n=r.next())&&!n.done;){const a=n.value;e.call(t,a[0],a[1])}},Ike=(t,e)=>{let i;const r=[];for(;(i=t.exec(e))!==null;)r.push(i);return r},vke=Mu("HTMLFormElement"),yke=t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(i,r,n){return r.toUpperCase()+n}),lz=(({hasOwnProperty:t})=>(e,i)=>t.call(e,i))(Object.prototype),bke=Mu("RegExp"),bee=(t,e)=>{const i=Object.getOwnPropertyDescriptors(t),r={};HS(i,(n,a)=>{let s;(s=e(n,a,t))!==!1&&(r[a]=s||n)}),Object.defineProperties(t,r)},wke=t=>{bee(t,(e,i)=>{if(_s(t)&&["arguments","caller","callee"].indexOf(i)!==-1)return!1;const r=t[i];if(_s(r)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+i+"'")})}})},Ske=(t,e)=>{const i={},r=n=>{n.forEach(a=>{i[a]=!0})};return Rv(t)?r(t):r(String(t).split(e)),i},Uke=()=>{},Tke=(t,e)=>t!=null&&Number.isFinite(t=+t)?t:e;function Dke(t){return!!(t&&_s(t.append)&&t[hee]==="FormData"&&t[ZC])}const Pke=t=>{const e=new Array(10),i=(r,n)=>{if(GS(r)){if(e.indexOf(r)>=0)return;if(jS(r))return r;if(!("toJSON"in r)){e[n]=r;const a=Rv(r)?[]:{};return HS(r,(s,o)=>{const l=i(s,n+1);!hI(l)&&(a[o]=l)}),e[n]=void 0,a}}return r};return i(t,0)},Eke=Mu("AsyncFunction"),Rke=t=>t&&(GS(t)||_s(t))&&_s(t.then)&&_s(t.catch),wee=((t,e)=>t?setImmediate:e?((i,r)=>(Yf.addEventListener("message",({source:n,data:a})=>{n===Yf&&a===i&&r.length&&r.shift()()},!1),n=>{r.push(n),Yf.postMessage(i,"*")}))(`axios@${Math.random()}`,[]):i=>setTimeout(i))(typeof setImmediate=="function",_s(Yf.postMessage)),Cke=typeof queueMicrotask<"u"?queueMicrotask.bind(Yf):typeof process<"u"&&process.nextTick||wee,Mke=t=>t!=null&&_s(t[ZC]),he={isArray:Rv,isArrayBuffer:gee,isBuffer:jS,isFormData:ike,isArrayBufferView:HAe,isString:WAe,isNumber:Iee,isBoolean:zAe,isObject:GS,isPlainObject:lD,isEmptyObject:qAe,isReadableStream:nke,isRequest:ake,isResponse:ske,isHeaders:oke,isUndefined:hI,isDate:YAe,isFile:KAe,isReactNativeBlob:XAe,isReactNative:JAe,isBlob:QAe,isRegExp:bke,isFunction:_s,isStream:eke,isURLSearchParams:rke,isTypedArray:hke,isFileList:ZAe,forEach:HS,merge:YO,extend:uke,trim:lke,stripBOM:cke,inherits:dke,toFlatObject:pke,kindOf:eM,kindOfTest:Mu,endsWith:fke,toArray:mke,forEachEntry:gke,matchAll:Ike,isHTMLForm:vke,hasOwnProperty:lz,hasOwnProp:lz,reduceDescriptors:bee,freezeMethods:wke,toObjectSet:Ske,toCamelCase:yke,noop:Uke,toFiniteNumber:Tke,findKey:vee,global:Yf,isContextDefined:yee,isSpecCompliantForm:Dke,toJSONObject:Pke,isAsyncFn:Eke,isThenable:Rke,setImmediate:wee,asap:Cke,isIterable:Mke};let Mt=class See extends Error{static from(e,i,r,n,a,s){const o=new See(e.message,i||e.code,r,n,a);return o.cause=e,o.name=e.name,e.status!=null&&o.status==null&&(o.status=e.status),s&&Object.assign(o,s),o}constructor(e,i,r,n,a){super(e),Object.defineProperty(this,"message",{value:e,enumerable:!0,writable:!0,configurable:!0}),this.name="AxiosError",this.isAxiosError=!0,i&&(this.code=i),r&&(this.config=r),n&&(this.request=n),a&&(this.response=a,this.status=a.status)}toJSON(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:he.toJSONObject(this.config),code:this.code,status:this.status}}};Mt.ERR_BAD_OPTION_VALUE="ERR_BAD_OPTION_VALUE";Mt.ERR_BAD_OPTION="ERR_BAD_OPTION";Mt.ECONNABORTED="ECONNABORTED";Mt.ETIMEDOUT="ETIMEDOUT";Mt.ERR_NETWORK="ERR_NETWORK";Mt.ERR_FR_TOO_MANY_REDIRECTS="ERR_FR_TOO_MANY_REDIRECTS";Mt.ERR_DEPRECATED="ERR_DEPRECATED";Mt.ERR_BAD_RESPONSE="ERR_BAD_RESPONSE";Mt.ERR_BAD_REQUEST="ERR_BAD_REQUEST";Mt.ERR_CANCELED="ERR_CANCELED";Mt.ERR_NOT_SUPPORT="ERR_NOT_SUPPORT";Mt.ERR_INVALID_URL="ERR_INVALID_URL";const Nke=null;function KO(t){return he.isPlainObject(t)||he.isArray(t)}function Uee(t){return he.endsWith(t,"[]")?t.slice(0,-2):t}function zA(t,e,i){return t?t.concat(e).map(function(n,a){return n=Uee(n),!i&&a?"["+n+"]":n}).join(i?".":""):e}function Ake(t){return he.isArray(t)&&!t.some(KO)}const kke=he.toFlatObject(he,{},null,function(e){return/^is[A-Z]/.test(e)});function iM(t,e,i){if(!he.isObject(t))throw new TypeError("target must be an object");e=e||new FormData,i=he.toFlatObject(i,{metaTokens:!0,dots:!1,indexes:!1},!1,function(h,g){return!he.isUndefined(g[h])});const r=i.metaTokens,n=i.visitor||c,a=i.dots,s=i.indexes,l=(i.Blob||typeof Blob<"u"&&Blob)&&he.isSpecCompliantForm(e);if(!he.isFunction(n))throw new TypeError("visitor must be a function");function u(m){if(m===null)return"";if(he.isDate(m))return m.toISOString();if(he.isBoolean(m))return m.toString();if(!l&&he.isBlob(m))throw new Mt("Blob is not supported. Use a Buffer instead.");return he.isArrayBuffer(m)||he.isTypedArray(m)?l&&typeof Blob=="function"?new Blob([m]):Buffer.from(m):m}function c(m,h,g){let I=m;if(he.isReactNative(e)&&he.isReactNativeBlob(m))return e.append(zA(g,h,a),u(m)),!1;if(m&&!g&&typeof m=="object"){if(he.endsWith(h,"{}"))h=r?h:h.slice(0,-2),m=JSON.stringify(m);else if(he.isArray(m)&&Ake(m)||(he.isFileList(m)||he.endsWith(h,"[]"))&&(I=he.toArray(m)))return h=Uee(h),I.forEach(function(w,y){!(he.isUndefined(w)||w===null)&&e.append(s===!0?zA([h],y,a):s===null?h:h+"[]",u(w))}),!1}return KO(m)?!0:(e.append(zA(g,h,a),u(m)),!1)}const d=[],p=Object.assign(kke,{defaultVisitor:c,convertValue:u,isVisitable:KO});function f(m,h){if(!he.isUndefined(m)){if(d.indexOf(m)!==-1)throw Error("Circular reference detected in "+h.join("."));d.push(m),he.forEach(m,function(I,v){(!(he.isUndefined(I)||I===null)&&n.call(e,I,he.isString(v)?v.trim():v,h,p))===!0&&f(I,h?h.concat(v):[v])}),d.pop()}}if(!he.isObject(t))throw new TypeError("data must be an object");return f(t),e}function uz(t){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(r){return e[r]})}function x$(t,e){this._pairs=[],t&&iM(t,this,e)}const Tee=x$.prototype;Tee.append=function(e,i){this._pairs.push([e,i])};Tee.toString=function(e){const i=e?function(r){return e.call(this,r,uz)}:uz;return this._pairs.map(function(n){return i(n[0])+"="+i(n[1])},"").join("&")};function Oke(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function Dee(t,e,i){if(!e)return t;const r=i&&i.encode||Oke,n=he.isFunction(i)?{serialize:i}:i,a=n&&n.serialize;let s;if(a?s=a(e,n):s=he.isURLSearchParams(e)?e.toString():new x$(e,n).toString(r),s){const o=t.indexOf("#");o!==-1&&(t=t.slice(0,o)),t+=(t.indexOf("?")===-1?"?":"&")+s}return t}class cz{constructor(){this.handlers=[]}use(e,i,r){return this.handlers.push({fulfilled:e,rejected:i,synchronous:r?r.synchronous:!1,runWhen:r?r.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){he.forEach(this.handlers,function(r){r!==null&&e(r)})}}const F$={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1,legacyInterceptorReqResOrdering:!0},xke=typeof URLSearchParams<"u"?URLSearchParams:x$,Fke=typeof FormData<"u"?FormData:null,Lke=typeof Blob<"u"?Blob:null,_ke={isBrowser:!0,classes:{URLSearchParams:xke,FormData:Fke,Blob:Lke},protocols:["http","https","file","blob","url","data"]},L$=typeof window<"u"&&typeof document<"u",XO=typeof navigator=="object"&&navigator||void 0,$ke=L$&&(!XO||["ReactNative","NativeScript","NS"].indexOf(XO.product)<0),Bke=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",Vke=L$&&window.location.href||"http://localhost",jke=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:L$,hasStandardBrowserEnv:$ke,hasStandardBrowserWebWorkerEnv:Bke,navigator:XO,origin:Vke},Symbol.toStringTag,{value:"Module"})),Ma={...jke,..._ke};function Gke(t,e){return iM(t,new Ma.classes.URLSearchParams,{visitor:function(i,r,n,a){return Ma.isNode&&he.isBuffer(i)?(this.append(r,i.toString("base64")),!1):a.defaultVisitor.apply(this,arguments)},...e})}function Hke(t){return he.matchAll(/\w+|\[(\w*)]/g,t).map(e=>e[0]==="[]"?"":e[1]||e[0])}function Wke(t){const e={},i=Object.keys(t);let r;const n=i.length;let a;for(r=0;r<n;r++)a=i[r],e[a]=t[a];return e}function Pee(t){function e(i,r,n,a){let s=i[a++];if(s==="__proto__")return!0;const o=Number.isFinite(+s),l=a>=i.length;return s=!s&&he.isArray(n)?n.length:s,l?(he.hasOwnProp(n,s)?n[s]=[n[s],r]:n[s]=r,!o):((!n[s]||!he.isObject(n[s]))&&(n[s]=[]),e(i,r,n[s],a)&&he.isArray(n[s])&&(n[s]=Wke(n[s])),!o)}if(he.isFormData(t)&&he.isFunction(t.entries)){const i={};return he.forEachEntry(t,(r,n)=>{e(Hke(r),n,i,0)}),i}return null}function zke(t,e,i){if(he.isString(t))try{return(e||JSON.parse)(t),he.trim(t)}catch(r){if(r.name!=="SyntaxError")throw r}return(i||JSON.stringify)(t)}const WS={transitional:F$,adapter:["xhr","http","fetch"],transformRequest:[function(e,i){const r=i.getContentType()||"",n=r.indexOf("application/json")>-1,a=he.isObject(e);if(a&&he.isHTMLForm(e)&&(e=new FormData(e)),he.isFormData(e))return n?JSON.stringify(Pee(e)):e;if(he.isArrayBuffer(e)||he.isBuffer(e)||he.isStream(e)||he.isFile(e)||he.isBlob(e)||he.isReadableStream(e))return e;if(he.isArrayBufferView(e))return e.buffer;if(he.isURLSearchParams(e))return i.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let o;if(a){if(r.indexOf("application/x-www-form-urlencoded")>-1)return Gke(e,this.formSerializer).toString();if((o=he.isFileList(e))||r.indexOf("multipart/form-data")>-1){const l=this.env&&this.env.FormData;return iM(o?{"files[]":e}:e,l&&new l,this.formSerializer)}}return a||n?(i.setContentType("application/json",!1),zke(e)):e}],transformResponse:[function(e){const i=this.transitional||WS.transitional,r=i&&i.forcedJSONParsing,n=this.responseType==="json";if(he.isResponse(e)||he.isReadableStream(e))return e;if(e&&he.isString(e)&&(r&&!this.responseType||n)){const s=!(i&&i.silentJSONParsing)&&n;try{return JSON.parse(e,this.parseReviver)}catch(o){if(s)throw o.name==="SyntaxError"?Mt.from(o,Mt.ERR_BAD_RESPONSE,this,null,this.response):o}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Ma.classes.FormData,Blob:Ma.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};he.forEach(["delete","get","head","post","put","patch"],t=>{WS.headers[t]={}});const qke=he.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Yke=t=>{const e={};let i,r,n;return t&&t.split(`
`).forEach(function(s){n=s.indexOf(":"),i=s.substring(0,n).trim().toLowerCase(),r=s.substring(n+1).trim(),!(!i||e[i]&&qke[i])&&(i==="set-cookie"?e[i]?e[i].push(r):e[i]=[r]:e[i]=e[i]?e[i]+", "+r:r)}),e},dz=Symbol("internals");function my(t){return t&&String(t).trim().toLowerCase()}function uD(t){return t===!1||t==null?t:he.isArray(t)?t.map(uD):String(t)}function Kke(t){const e=Object.create(null),i=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let r;for(;r=i.exec(t);)e[r[1]]=r[2];return e}const Xke=t=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(t.trim());function qA(t,e,i,r,n){if(he.isFunction(r))return r.call(this,e,i);if(n&&(e=i),!!he.isString(e)){if(he.isString(r))return e.indexOf(r)!==-1;if(he.isRegExp(r))return r.test(e)}}function Jke(t){return t.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,i,r)=>i.toUpperCase()+r)}function Qke(t,e){const i=he.toCamelCase(" "+e);["get","set","has"].forEach(r=>{Object.defineProperty(t,r+i,{value:function(n,a,s){return this[r].call(this,e,n,a,s)},configurable:!0})})}let $s=class{constructor(e){e&&this.set(e)}set(e,i,r){const n=this;function a(o,l,u){const c=my(l);if(!c)throw new Error("header name must be a non-empty string");const d=he.findKey(n,c);(!d||n[d]===void 0||u===!0||u===void 0&&n[d]!==!1)&&(n[d||l]=uD(o))}const s=(o,l)=>he.forEach(o,(u,c)=>a(u,c,l));if(he.isPlainObject(e)||e instanceof this.constructor)s(e,i);else if(he.isString(e)&&(e=e.trim())&&!Xke(e))s(Yke(e),i);else if(he.isObject(e)&&he.isIterable(e)){let o={},l,u;for(const c of e){if(!he.isArray(c))throw TypeError("Object iterator must return a key-value pair");o[u=c[0]]=(l=o[u])?he.isArray(l)?[...l,c[1]]:[l,c[1]]:c[1]}s(o,i)}else e!=null&&a(i,e,r);return this}get(e,i){if(e=my(e),e){const r=he.findKey(this,e);if(r){const n=this[r];if(!i)return n;if(i===!0)return Kke(n);if(he.isFunction(i))return i.call(this,n,r);if(he.isRegExp(i))return i.exec(n);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,i){if(e=my(e),e){const r=he.findKey(this,e);return!!(r&&this[r]!==void 0&&(!i||qA(this,this[r],r,i)))}return!1}delete(e,i){const r=this;let n=!1;function a(s){if(s=my(s),s){const o=he.findKey(r,s);o&&(!i||qA(r,r[o],o,i))&&(delete r[o],n=!0)}}return he.isArray(e)?e.forEach(a):a(e),n}clear(e){const i=Object.keys(this);let r=i.length,n=!1;for(;r--;){const a=i[r];(!e||qA(this,this[a],a,e,!0))&&(delete this[a],n=!0)}return n}normalize(e){const i=this,r={};return he.forEach(this,(n,a)=>{const s=he.findKey(r,a);if(s){i[s]=uD(n),delete i[a];return}const o=e?Jke(a):String(a).trim();o!==a&&delete i[a],i[o]=uD(n),r[o]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const i=Object.create(null);return he.forEach(this,(r,n)=>{r!=null&&r!==!1&&(i[n]=e&&he.isArray(r)?r.join(", "):r)}),i}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,i])=>e+": "+i).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...i){const r=new this(e);return i.forEach(n=>r.set(n)),r}static accessor(e){const r=(this[dz]=this[dz]={accessors:{}}).accessors,n=this.prototype;function a(s){const o=my(s);r[o]||(Qke(n,s),r[o]=!0)}return he.isArray(e)?e.forEach(a):a(e),this}};$s.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);he.reduceDescriptors($s.prototype,({value:t},e)=>{let i=e[0].toUpperCase()+e.slice(1);return{get:()=>t,set(r){this[i]=r}}});he.freezeMethods($s);function YA(t,e){const i=this||WS,r=e||i,n=$s.from(r.headers);let a=r.data;return he.forEach(t,function(o){a=o.call(i,a,n.normalize(),e?e.status:void 0)}),n.normalize(),a}function Eee(t){return!!(t&&t.__CANCEL__)}let zS=class extends Mt{constructor(e,i,r){super(e??"canceled",Mt.ERR_CANCELED,i,r),this.name="CanceledError",this.__CANCEL__=!0}};function Ree(t,e,i){const r=i.config.validateStatus;!i.status||!r||r(i.status)?t(i):e(new Mt("Request failed with status code "+i.status,[Mt.ERR_BAD_REQUEST,Mt.ERR_BAD_RESPONSE][Math.floor(i.status/100)-4],i.config,i.request,i))}function Zke(t){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(t);return e&&e[1]||""}function eOe(t,e){t=t||10;const i=new Array(t),r=new Array(t);let n=0,a=0,s;return e=e!==void 0?e:1e3,function(l){const u=Date.now(),c=r[a];s||(s=u),i[n]=l,r[n]=u;let d=a,p=0;for(;d!==n;)p+=i[d++],d=d%t;if(n=(n+1)%t,n===a&&(a=(a+1)%t),u-s<e)return;const f=c&&u-c;return f?Math.round(p*1e3/f):void 0}}function tOe(t,e){let i=0,r=1e3/e,n,a;const s=(u,c=Date.now())=>{i=c,n=null,a&&(clearTimeout(a),a=null),t(...u)};return[(...u)=>{const c=Date.now(),d=c-i;d>=r?s(u,c):(n=u,a||(a=setTimeout(()=>{a=null,s(n)},r-d)))},()=>n&&s(n)]}const PP=(t,e,i=3)=>{let r=0;const n=eOe(50,250);return tOe(a=>{const s=a.loaded,o=a.lengthComputable?a.total:void 0,l=s-r,u=n(l),c=s<=o;r=s;const d={loaded:s,total:o,progress:o?s/o:void 0,bytes:l,rate:u||void 0,estimated:u&&o&&c?(o-s)/u:void 0,event:a,lengthComputable:o!=null,[e?"download":"upload"]:!0};t(d)},i)},pz=(t,e)=>{const i=t!=null;return[r=>e[0]({lengthComputable:i,total:t,loaded:r}),e[1]]},fz=t=>(...e)=>he.asap(()=>t(...e)),iOe=Ma.hasStandardBrowserEnv?((t,e)=>i=>(i=new URL(i,Ma.origin),t.protocol===i.protocol&&t.host===i.host&&(e||t.port===i.port)))(new URL(Ma.origin),Ma.navigator&&/(msie|trident)/i.test(Ma.navigator.userAgent)):()=>!0,rOe=Ma.hasStandardBrowserEnv?{write(t,e,i,r,n,a,s){if(typeof document>"u")return;const o=[`${t}=${encodeURIComponent(e)}`];he.isNumber(i)&&o.push(`expires=${new Date(i).toUTCString()}`),he.isString(r)&&o.push(`path=${r}`),he.isString(n)&&o.push(`domain=${n}`),a===!0&&o.push("secure"),he.isString(s)&&o.push(`SameSite=${s}`),document.cookie=o.join("; ")},read(t){if(typeof document>"u")return null;const e=document.cookie.match(new RegExp("(?:^|; )"+t+"=([^;]*)"));return e?decodeURIComponent(e[1]):null},remove(t){this.write(t,"",Date.now()-864e5,"/")}}:{write(){},read(){return null},remove(){}};function nOe(t){return typeof t!="string"?!1:/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)}function aOe(t,e){return e?t.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):t}function Cee(t,e,i){let r=!nOe(e);return t&&(r||i==!1)?aOe(t,e):e}const mz=t=>t instanceof $s?{...t}:t;function Lm(t,e){e=e||{};const i={};function r(u,c,d,p){return he.isPlainObject(u)&&he.isPlainObject(c)?he.merge.call({caseless:p},u,c):he.isPlainObject(c)?he.merge({},c):he.isArray(c)?c.slice():c}function n(u,c,d,p){if(he.isUndefined(c)){if(!he.isUndefined(u))return r(void 0,u,d,p)}else return r(u,c,d,p)}function a(u,c){if(!he.isUndefined(c))return r(void 0,c)}function s(u,c){if(he.isUndefined(c)){if(!he.isUndefined(u))return r(void 0,u)}else return r(void 0,c)}function o(u,c,d){if(d in e)return r(u,c);if(d in t)return r(void 0,u)}const l={url:a,method:a,data:a,baseURL:s,transformRequest:s,transformResponse:s,paramsSerializer:s,timeout:s,timeoutMessage:s,withCredentials:s,withXSRFToken:s,adapter:s,responseType:s,xsrfCookieName:s,xsrfHeaderName:s,onUploadProgress:s,onDownloadProgress:s,decompress:s,maxContentLength:s,maxBodyLength:s,beforeRedirect:s,transport:s,httpAgent:s,httpsAgent:s,cancelToken:s,socketPath:s,responseEncoding:s,validateStatus:o,headers:(u,c,d)=>n(mz(u),mz(c),d,!0)};return he.forEach(Object.keys({...t,...e}),function(c){if(c==="__proto__"||c==="constructor"||c==="prototype")return;const d=he.hasOwnProp(l,c)?l[c]:n,p=d(t[c],e[c],c);he.isUndefined(p)&&d!==o||(i[c]=p)}),i}const Mee=t=>{const e=Lm({},t);let{data:i,withXSRFToken:r,xsrfHeaderName:n,xsrfCookieName:a,headers:s,auth:o}=e;if(e.headers=s=$s.from(s),e.url=Dee(Cee(e.baseURL,e.url,e.allowAbsoluteUrls),t.params,t.paramsSerializer),o&&s.set("Authorization","Basic "+btoa((o.username||"")+":"+(o.password?unescape(encodeURIComponent(o.password)):""))),he.isFormData(i)){if(Ma.hasStandardBrowserEnv||Ma.hasStandardBrowserWebWorkerEnv)s.setContentType(void 0);else if(he.isFunction(i.getHeaders)){const l=i.getHeaders(),u=["content-type","content-length"];Object.entries(l).forEach(([c,d])=>{u.includes(c.toLowerCase())&&s.set(c,d)})}}if(Ma.hasStandardBrowserEnv&&(r&&he.isFunction(r)&&(r=r(e)),r||r!==!1&&iOe(e.url))){const l=n&&a&&rOe.read(a);l&&s.set(n,l)}return e},sOe=typeof XMLHttpRequest<"u",oOe=sOe&&function(t){return new Promise(function(i,r){const n=Mee(t);let a=n.data;const s=$s.from(n.headers).normalize();let{responseType:o,onUploadProgress:l,onDownloadProgress:u}=n,c,d,p,f,m;function h(){f&&f(),m&&m(),n.cancelToken&&n.cancelToken.unsubscribe(c),n.signal&&n.signal.removeEventListener("abort",c)}let g=new XMLHttpRequest;g.open(n.method.toUpperCase(),n.url,!0),g.timeout=n.timeout;function I(){if(!g)return;const w=$s.from("getAllResponseHeaders"in g&&g.getAllResponseHeaders()),b={data:!o||o==="text"||o==="json"?g.responseText:g.response,status:g.status,statusText:g.statusText,headers:w,config:t,request:g};Ree(function(U){i(U),h()},function(U){r(U),h()},b),g=null}"onloadend"in g?g.onloadend=I:g.onreadystatechange=function(){!g||g.readyState!==4||g.status===0&&!(g.responseURL&&g.responseURL.indexOf("file:")===0)||setTimeout(I)},g.onabort=function(){g&&(r(new Mt("Request aborted",Mt.ECONNABORTED,t,g)),g=null)},g.onerror=function(y){const b=y&&y.message?y.message:"Network Error",S=new Mt(b,Mt.ERR_NETWORK,t,g);S.event=y||null,r(S),g=null},g.ontimeout=function(){let y=n.timeout?"timeout of "+n.timeout+"ms exceeded":"timeout exceeded";const b=n.transitional||F$;n.timeoutErrorMessage&&(y=n.timeoutErrorMessage),r(new Mt(y,b.clarifyTimeoutError?Mt.ETIMEDOUT:Mt.ECONNABORTED,t,g)),g=null},a===void 0&&s.setContentType(null),"setRequestHeader"in g&&he.forEach(s.toJSON(),function(y,b){g.setRequestHeader(b,y)}),he.isUndefined(n.withCredentials)||(g.withCredentials=!!n.withCredentials),o&&o!=="json"&&(g.responseType=n.responseType),u&&([p,m]=PP(u,!0),g.addEventListener("progress",p)),l&&g.upload&&([d,f]=PP(l),g.upload.addEventListener("progress",d),g.upload.addEventListener("loadend",f)),(n.cancelToken||n.signal)&&(c=w=>{g&&(r(!w||w.type?new zS(null,t,g):w),g.abort(),g=null)},n.cancelToken&&n.cancelToken.subscribe(c),n.signal&&(n.signal.aborted?c():n.signal.addEventListener("abort",c)));const v=Zke(n.url);if(v&&Ma.protocols.indexOf(v)===-1){r(new Mt("Unsupported protocol "+v+":",Mt.ERR_BAD_REQUEST,t));return}g.send(a||null)})},lOe=(t,e)=>{const{length:i}=t=t?t.filter(Boolean):[];if(e||i){let r=new AbortController,n;const a=function(u){if(!n){n=!0,o();const c=u instanceof Error?u:this.reason;r.abort(c instanceof Mt?c:new zS(c instanceof Error?c.message:c))}};let s=e&&setTimeout(()=>{s=null,a(new Mt(`timeout of ${e}ms exceeded`,Mt.ETIMEDOUT))},e);const o=()=>{t&&(s&&clearTimeout(s),s=null,t.forEach(u=>{u.unsubscribe?u.unsubscribe(a):u.removeEventListener("abort",a)}),t=null)};t.forEach(u=>u.addEventListener("abort",a));const{signal:l}=r;return l.unsubscribe=()=>he.asap(o),l}},uOe=function*(t,e){let i=t.byteLength;if(i<e){yield t;return}let r=0,n;for(;r<i;)n=r+e,yield t.slice(r,n),r=n},cOe=async function*(t,e){for await(const i of dOe(t))yield*uOe(i,e)},dOe=async function*(t){if(t[Symbol.asyncIterator]){yield*t;return}const e=t.getReader();try{for(;;){const{done:i,value:r}=await e.read();if(i)break;yield r}}finally{await e.cancel()}},hz=(t,e,i,r)=>{const n=cOe(t,e);let a=0,s,o=l=>{s||(s=!0,r&&r(l))};return new ReadableStream({async pull(l){try{const{done:u,value:c}=await n.next();if(u){o(),l.close();return}let d=c.byteLength;if(i){let p=a+=d;i(p)}l.enqueue(new Uint8Array(c))}catch(u){throw o(u),u}},cancel(l){return o(l),n.return()}},{highWaterMark:2})},gz=64*1024,{isFunction:DT}=he,pOe=(({Request:t,Response:e})=>({Request:t,Response:e}))(he.global),{ReadableStream:Iz,TextEncoder:vz}=he.global,yz=(t,...e)=>{try{return!!t(...e)}catch{return!1}},fOe=t=>{t=he.merge.call({skipUndefined:!0},pOe,t);const{fetch:e,Request:i,Response:r}=t,n=e?DT(e):typeof fetch=="function",a=DT(i),s=DT(r);if(!n)return!1;const o=n&&DT(Iz),l=n&&(typeof vz=="function"?(m=>h=>m.encode(h))(new vz):async m=>new Uint8Array(await new i(m).arrayBuffer())),u=a&&o&&yz(()=>{let m=!1;const h=new i(Ma.origin,{body:new Iz,method:"POST",get duplex(){return m=!0,"half"}}).headers.has("Content-Type");return m&&!h}),c=s&&o&&yz(()=>he.isReadableStream(new r("").body)),d={stream:c&&(m=>m.body)};n&&["text","arrayBuffer","blob","formData","stream"].forEach(m=>{!d[m]&&(d[m]=(h,g)=>{let I=h&&h[m];if(I)return I.call(h);throw new Mt(`Response type '${m}' is not supported`,Mt.ERR_NOT_SUPPORT,g)})});const p=async m=>{if(m==null)return 0;if(he.isBlob(m))return m.size;if(he.isSpecCompliantForm(m))return(await new i(Ma.origin,{method:"POST",body:m}).arrayBuffer()).byteLength;if(he.isArrayBufferView(m)||he.isArrayBuffer(m))return m.byteLength;if(he.isURLSearchParams(m)&&(m=m+""),he.isString(m))return(await l(m)).byteLength},f=async(m,h)=>{const g=he.toFiniteNumber(m.getContentLength());return g??p(h)};return async m=>{let{url:h,method:g,data:I,signal:v,cancelToken:w,timeout:y,onDownloadProgress:b,onUploadProgress:S,responseType:U,headers:T,withCredentials:P="same-origin",fetchOptions:D}=Mee(m),E=e||fetch;U=U?(U+"").toLowerCase():"text";let R=lOe([v,w&&w.toAbortSignal()],y),C=null;const M=R&&R.unsubscribe&&(()=>{R.unsubscribe()});let N;try{if(S&&u&&g!=="get"&&g!=="head"&&(N=await f(T,I))!==0){let L=new i(h,{method:"POST",body:I,duplex:"half"}),$;if(he.isFormData(I)&&($=L.headers.get("content-type"))&&T.setContentType($),L.body){const[V,_]=pz(N,PP(fz(S)));I=hz(L.body,gz,V,_)}}he.isString(P)||(P=P?"include":"omit");const A=a&&"credentials"in i.prototype,O={...D,signal:R,method:g.toUpperCase(),headers:T.normalize().toJSON(),body:I,duplex:"half",credentials:A?P:void 0};C=a&&new i(h,O);let k=await(a?E(C,D):E(h,O));const F=c&&(U==="stream"||U==="response");if(c&&(b||F&&M)){const L={};["status","statusText","headers"].forEach(B=>{L[B]=k[B]});const $=he.toFiniteNumber(k.headers.get("content-length")),[V,_]=b&&pz($,PP(fz(b),!0))||[];k=new r(hz(k.body,gz,V,()=>{_&&_(),M&&M()}),L)}U=U||"text";let x=await d[he.findKey(d,U)||"text"](k,m);return!F&&M&&M(),await new Promise((L,$)=>{Ree(L,$,{data:x,headers:$s.from(k.headers),status:k.status,statusText:k.statusText,config:m,request:C})})}catch(A){throw M&&M(),A&&A.name==="TypeError"&&/Load failed|fetch/i.test(A.message)?Object.assign(new Mt("Network Error",Mt.ERR_NETWORK,m,C,A&&A.response),{cause:A.cause||A}):Mt.from(A,A&&A.code,m,C,A&&A.response)}}},mOe=new Map,Nee=t=>{let e=t&&t.env||{};const{fetch:i,Request:r,Response:n}=e,a=[r,n,i];let s=a.length,o=s,l,u,c=mOe;for(;o--;)l=a[o],u=c.get(l),u===void 0&&c.set(l,u=o?new Map:fOe(e)),c=u;return u};Nee();const _$={http:Nke,xhr:oOe,fetch:{get:Nee}};he.forEach(_$,(t,e)=>{if(t){try{Object.defineProperty(t,"name",{value:e})}catch{}Object.defineProperty(t,"adapterName",{value:e})}});const bz=t=>`- ${t}`,hOe=t=>he.isFunction(t)||t===null||t===!1;function gOe(t,e){t=he.isArray(t)?t:[t];const{length:i}=t;let r,n;const a={};for(let s=0;s<i;s++){r=t[s];let o;if(n=r,!hOe(r)&&(n=_$[(o=String(r)).toLowerCase()],n===void 0))throw new Mt(`Unknown adapter '${o}'`);if(n&&(he.isFunction(n)||(n=n.get(e))))break;a[o||"#"+s]=n}if(!n){const s=Object.entries(a).map(([l,u])=>`adapter ${l} `+(u===!1?"is not supported by the environment":"is not available in the build"));let o=i?s.length>1?`since :
`+s.map(bz).join(`
`):" "+bz(s[0]):"as no adapter specified";throw new Mt("There is no suitable adapter to dispatch the request "+o,"ERR_NOT_SUPPORT")}return n}const Aee={getAdapter:gOe,adapters:_$};function KA(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new zS(null,t)}function wz(t){return KA(t),t.headers=$s.from(t.headers),t.data=YA.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),Aee.getAdapter(t.adapter||WS.adapter,t)(t).then(function(r){return KA(t),r.data=YA.call(t,t.transformResponse,r),r.headers=$s.from(r.headers),r},function(r){return Eee(r)||(KA(t),r&&r.response&&(r.response.data=YA.call(t,t.transformResponse,r.response),r.response.headers=$s.from(r.response.headers))),Promise.reject(r)})}const kee="1.13.6",rM={};["object","boolean","number","function","string","symbol"].forEach((t,e)=>{rM[t]=function(r){return typeof r===t||"a"+(e<1?"n ":" ")+t}});const Sz={};rM.transitional=function(e,i,r){function n(a,s){return"[Axios v"+kee+"] Transitional option '"+a+"'"+s+(r?". "+r:"")}return(a,s,o)=>{if(e===!1)throw new Mt(n(s," has been removed"+(i?" in "+i:"")),Mt.ERR_DEPRECATED);return i&&!Sz[s]&&(Sz[s]=!0,console.warn(n(s," has been deprecated since v"+i+" and will be removed in the near future"))),e?e(a,s,o):!0}};rM.spelling=function(e){return(i,r)=>(console.warn(`${r} is likely a misspelling of ${e}`),!0)};function IOe(t,e,i){if(typeof t!="object")throw new Mt("options must be an object",Mt.ERR_BAD_OPTION_VALUE);const r=Object.keys(t);let n=r.length;for(;n-- >0;){const a=r[n],s=e[a];if(s){const o=t[a],l=o===void 0||s(o,a,t);if(l!==!0)throw new Mt("option "+a+" must be "+l,Mt.ERR_BAD_OPTION_VALUE);continue}if(i!==!0)throw new Mt("Unknown option "+a,Mt.ERR_BAD_OPTION)}}const cD={assertOptions:IOe,validators:rM},Lo=cD.validators;let cm=class{constructor(e){this.defaults=e||{},this.interceptors={request:new cz,response:new cz}}async request(e,i){try{return await this._request(e,i)}catch(r){if(r instanceof Error){let n={};Error.captureStackTrace?Error.captureStackTrace(n):n=new Error;const a=n.stack?n.stack.replace(/^.+\n/,""):"";try{r.stack?a&&!String(r.stack).endsWith(a.replace(/^.+\n.+\n/,""))&&(r.stack+=`
`+a):r.stack=a}catch{}}throw r}}_request(e,i){typeof e=="string"?(i=i||{},i.url=e):i=e||{},i=Lm(this.defaults,i);const{transitional:r,paramsSerializer:n,headers:a}=i;r!==void 0&&cD.assertOptions(r,{silentJSONParsing:Lo.transitional(Lo.boolean),forcedJSONParsing:Lo.transitional(Lo.boolean),clarifyTimeoutError:Lo.transitional(Lo.boolean),legacyInterceptorReqResOrdering:Lo.transitional(Lo.boolean)},!1),n!=null&&(he.isFunction(n)?i.paramsSerializer={serialize:n}:cD.assertOptions(n,{encode:Lo.function,serialize:Lo.function},!0)),i.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?i.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:i.allowAbsoluteUrls=!0),cD.assertOptions(i,{baseUrl:Lo.spelling("baseURL"),withXsrfToken:Lo.spelling("withXSRFToken")},!0),i.method=(i.method||this.defaults.method||"get").toLowerCase();let s=a&&he.merge(a.common,a[i.method]);a&&he.forEach(["delete","get","head","post","put","patch","common"],m=>{delete a[m]}),i.headers=$s.concat(s,a);const o=[];let l=!0;this.interceptors.request.forEach(function(h){if(typeof h.runWhen=="function"&&h.runWhen(i)===!1)return;l=l&&h.synchronous;const g=i.transitional||F$;g&&g.legacyInterceptorReqResOrdering?o.unshift(h.fulfilled,h.rejected):o.push(h.fulfilled,h.rejected)});const u=[];this.interceptors.response.forEach(function(h){u.push(h.fulfilled,h.rejected)});let c,d=0,p;if(!l){const m=[wz.bind(this),void 0];for(m.unshift(...o),m.push(...u),p=m.length,c=Promise.resolve(i);d<p;)c=c.then(m[d++],m[d++]);return c}p=o.length;let f=i;for(;d<p;){const m=o[d++],h=o[d++];try{f=m(f)}catch(g){h.call(this,g);break}}try{c=wz.call(this,f)}catch(m){return Promise.reject(m)}for(d=0,p=u.length;d<p;)c=c.then(u[d++],u[d++]);return c}getUri(e){e=Lm(this.defaults,e);const i=Cee(e.baseURL,e.url,e.allowAbsoluteUrls);return Dee(i,e.params,e.paramsSerializer)}};he.forEach(["delete","get","head","options"],function(e){cm.prototype[e]=function(i,r){return this.request(Lm(r||{},{method:e,url:i,data:(r||{}).data}))}});he.forEach(["post","put","patch"],function(e){function i(r){return function(a,s,o){return this.request(Lm(o||{},{method:e,headers:r?{"Content-Type":"multipart/form-data"}:{},url:a,data:s}))}}cm.prototype[e]=i(),cm.prototype[e+"Form"]=i(!0)});let vOe=class Oee{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let i;this.promise=new Promise(function(a){i=a});const r=this;this.promise.then(n=>{if(!r._listeners)return;let a=r._listeners.length;for(;a-- >0;)r._listeners[a](n);r._listeners=null}),this.promise.then=n=>{let a;const s=new Promise(o=>{r.subscribe(o),a=o}).then(n);return s.cancel=function(){r.unsubscribe(a)},s},e(function(a,s,o){r.reason||(r.reason=new zS(a,s,o),i(r.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const i=this._listeners.indexOf(e);i!==-1&&this._listeners.splice(i,1)}toAbortSignal(){const e=new AbortController,i=r=>{e.abort(r)};return this.subscribe(i),e.signal.unsubscribe=()=>this.unsubscribe(i),e.signal}static source(){let e;return{token:new Oee(function(n){e=n}),cancel:e}}};function yOe(t){return function(i){return t.apply(null,i)}}function bOe(t){return he.isObject(t)&&t.isAxiosError===!0}const JO={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511,WebServerIsDown:521,ConnectionTimedOut:522,OriginIsUnreachable:523,TimeoutOccurred:524,SslHandshakeFailed:525,InvalidSslCertificate:526};Object.entries(JO).forEach(([t,e])=>{JO[e]=t});function xee(t){const e=new cm(t),i=mee(cm.prototype.request,e);return he.extend(i,cm.prototype,e,{allOwnKeys:!0}),he.extend(i,e,null,{allOwnKeys:!0}),i.create=function(n){return xee(Lm(t,n))},i}const wn=xee(WS);wn.Axios=cm;wn.CanceledError=zS;wn.CancelToken=vOe;wn.isCancel=Eee;wn.VERSION=kee;wn.toFormData=iM;wn.AxiosError=Mt;wn.Cancel=wn.CanceledError;wn.all=function(e){return Promise.all(e)};wn.spread=yOe;wn.isAxiosError=bOe;wn.mergeConfig=Lm;wn.AxiosHeaders=$s;wn.formToJSON=t=>Pee(he.isHTMLForm(t)?new FormData(t):t);wn.getAdapter=Aee.getAdapter;wn.HttpStatusCode=JO;wn.default=wn;const{Axios:$Qe,AxiosError:BQe,CanceledError:VQe,isCancel:jQe,CancelToken:GQe,VERSION:HQe,all:WQe,Cancel:zQe,isAxiosError:qQe,spread:YQe,toFormData:KQe,AxiosHeaders:XQe,HttpStatusCode:JQe,formToJSON:QQe,getAdapter:ZQe,mergeConfig:eZe}=wn,Fee=jAe(),wOe=globalThis.location.host.includes("localhost")||globalThis.location.hostname==="127.0.0.1",SOe=window.dev?.baseURL||(wOe?"http://localhost:8383":"https://courthive.net"),qS=wn.create({baseURL:SOe});qS.interceptors.request.use(t=>{const e=localStorage.getItem(Fee);return e&&(t.headers.Authorization=`Bearer ${e}`),t},t=>Promise.reject(t));qS.interceptors.response.use(t=>t,t=>{if(t.message==="Network Error"&&console.log("network error"),t.response){t.response?.status===401&&Lee();const e=t.response.data.message||t.response.data.error||t.response.data;console.log({message:e})}});const UOe=()=>{const t=localStorage.getItem(Fee);qS.defaults.headers.common.Authorization=`Bearer ${t}`},Lee=()=>{qS.defaults.headers.common.Authorization=void 0},Rh={...qS,addAuthorization:UOe,removeAuthorization:Lee},nM="Missing tournamentId";async function _ee(t){if(!t?.tournamentId)throw new Error(nM);return await Rh.post("/factory/tournamentinfo",t)}async function QO({providerAbbr:t}){if(!t)throw new Error("missing provicerAbbr");return await Rh.post("/provider/calendar",{providerAbbr:t})}async function $ee(t){if(!t?.tournamentId)throw new Error(nM);if(!t?.eventId)throw new Error("missing eventId");return await Rh.post("/factory/eventdata",t)}async function TOe(t){if(!t?.tournamentId)throw new Error(nM);return Object.assign(t,{courtCompletedMatchUps:!0,withCourtGridRows:!0,usePublishState:!0,minCourtGridRows:10,nextMatchUps:!0}),await Rh.post("/factory/scheduledmatchUps",{params:t})}async function DOe(t){if(!t?.tournamentId)throw new Error(nM);return await Rh.post("/factory/participants",{params:t})}async function POe(){return await Rh.get("/factory/version")}const EOe=t=>{let e;const i=Array.isArray(t)?t:[t];return r=>{if(e&&i.forEach(n=>n.removeFilter(e)),r){const n=r?.toLowerCase();e=a=>a.searchText?.includes(n),i.forEach(a=>a.addFilter(e))}else e=void 0}},Bee=t=>(e,i)=>{const r=e.getDefinition();return t.includes(r.field)?"":i==="asc"&&"<div><i class='fas fa-sort-up'></div>"||i==="desc"&&"<div><i class=' fas fa-sort-down'></div>"||"<div><i class='fas fa-sort'></div>"};function ROe(t,e,i,r){const n=e>1?"items":"item";return t+`<span style='color:blue; margin-left:10px;'>(${e} ${n})</span>`}function COe(t,e){return t.pctSpread&&!e.pctSpread?-1:e.pctSpread&&!t.pctSpread?1:!t.pctSpread&&!e.pctSpread?0:e.pctSpread-t.pctSpread}function $$(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Uz={exports:{}},Tz;function MOe(){return Tz||(Tz=1,(function(t){(function(){var e={}.hasOwnProperty;function i(){for(var a="",s=0;s<arguments.length;s++){var o=arguments[s];o&&(a=n(a,r(o)))}return a}function r(a){if(typeof a=="string"||typeof a=="number")return a;if(typeof a!="object")return"";if(Array.isArray(a))return i.apply(null,a);if(a.toString!==Object.prototype.toString&&!a.toString.toString().includes("[native code]"))return a.toString();var s="";for(var o in a)e.call(a,o)&&a[o]&&(s=n(s,o));return s}function n(a,s){return s?a?a+" "+s:a+s:a}t.exports?(i.default=i,t.exports=i):window.classNames=i})()})(Uz)),Uz.exports}var NOe=MOe();const hn=$$(NOe);function AOe({variant:t}){return hn("chc-placeholder",t==="showAddress"&&"chc-placeholder--show-address")}const kOe=t=>"chc-participant",OOe=t=>hn("chc-participant-name",t?.variant&&`chc-participant-name--${t.variant}`),xOe=t=>hn("chc-participant-type",t?.variant&&`chc-participant-type--${t.variant}`);function FOe({drawPosition:t,sideNumber:e}){const i=hn("chc-participant-container",e===1&&"chc-participant-container--side1");return t?`${i} chc-has-draw-position`:i}function LOe({winnerChevron:t,isDoubles:e}){return t?e?"chc-chevron-doubles--winner":"chc-chevron--winner":""}const B$=()=>"chc-participant-detail";function _Oe({individualParticipant:t,className:e}){const{city:i,state:r,countryCode:n}=t?.person?.addresses?.[0]||{},a=[i,r,n].filter(Boolean).join(", ")||" ",s=document.createElement("div");return s.className=hn(B$(),e),s.innerHTML=a,s}function Xn(t){return typeof t=="function"}function $Oe(t){return typeof t=="string"}function BOe({element:t,attr:e}){if(!$Oe(e))return;const i=e.split(".");for(const r of i)if(t=t?.[r],!t)return;return t}function VOe({individualParticipant:t,attribute:e,className:i}){const r=t?.person,n=BOe({element:r,attr:e});if(!n)return"";const a=document.createElement("div");return a.className=hn(B$(),i),a.innerHTML=n,a}function jOe({individualParticipant:t,className:e}){const i=t?.teams?.[0],r=i?.participantName||" ",n=document.createElement("div");return n.className=hn(B$(),e),n.classList.add("tmx-tm"),n.setAttribute("id",i?.participantId||""),n.innerHTML=r,n}function GOe(t){const e=t?.composition?.configuration?.participantDetail;if(e==="TEAM")return jOe(t);if(t?.composition?.configuration?.showAddress??e==="ADDRESS")return _Oe(t);if(e){const i=VOe({...t,attribute:e});if(i&&typeof i!="string")return i}return document.createElement("div")}function po(t){return typeof t=="function"}var Dz={exports:{}},Pz;function HOe(){return Pz||(Pz=1,(function(t){(function(){var e=function(l,u){var c=this;e.count=(e.count||0)+1,this.count=e.count,this.isOpened=!1,this.input=a(l),this.input.setAttribute("autocomplete","off"),this.input.setAttribute("aria-autocomplete","list"),this.input.setAttribute("aria-expanded","false"),this.input.setAttribute("aria-controls","awesomplete_list_"+this.count),this.input.setAttribute("aria-owns","awesomplete_list_"+this.count),this.input.setAttribute("role","combobox"),this.options=u=u||{},r(this,{minChars:2,maxItems:10,autoFirst:!1,data:e.DATA,filter:e.FILTER_CONTAINS,sort:u.sort===!1?!1:e.SORT_BYLENGTH,container:e.CONTAINER,item:e.ITEM,replace:e.REPLACE,tabSelect:!1,listLabel:"Results List",statusNoResults:"No results found",statusXResults:"{0} results found",statusTypeXChar:"Type {0} or more characters for results"},u),this.index=-1,this.container=this.container(l),this.ul=a.create("ul",{hidden:"hidden",role:"listbox",id:"awesomplete_list_"+this.count,inside:this.container,"aria-label":this.listLabel}),this.status=a.create("span",{className:"visually-hidden",role:"status","aria-live":"assertive","aria-atomic":!0,inside:this.container,textContent:""}),this._events={input:{input:this.evaluate.bind(this),blur:this.close.bind(this,{reason:"blur"}),keydown:function(d){var p=d.keyCode;c.opened&&(p===13&&c.selected||p===9&&c.selected&&c.tabSelect?(d.preventDefault(),c.select(void 0,void 0,d)):p===27?c.close({reason:"esc"}):(p===38||p===40)&&(d.preventDefault(),c[p===38?"previous":"next"]()))}},form:{submit:this.close.bind(this,{reason:"submit"})},ul:{mousedown:function(d){d.preventDefault()},click:function(d){var p=d.target;if(p!==this){for(;p&&!/li/i.test(p.nodeName);)p=p.parentNode;p&&d.button===0&&(d.preventDefault(),c.select(p,d.target,d))}}}},a.bind(this.input,this._events.input),a.bind(this.input.form,this._events.form),a.bind(this.ul,this._events.ul),this.input.hasAttribute("list")?(this.list="#"+this.input.getAttribute("list"),this.input.removeAttribute("list")):this.list=this.input.getAttribute("data-list")||u.list||[],e.all.push(this)};e.prototype={set list(l){if(Array.isArray(l))this._list=l;else if(typeof l=="string"&&l.indexOf(",")>-1)this._list=l.split(/\s*,\s*/);else if(l=a(l),l&&l.children){var u=[];n.apply(l.children).forEach(function(c){if(!c.disabled){var d=c.textContent.trim(),p=c.value||d,f=c.label||d;p!==""&&u.push({label:f,value:p})}}),this._list=u}document.activeElement===this.input&&this.evaluate()},get selected(){return this.index>-1},get opened(){return this.isOpened},close:function(l){this.opened&&(this.input.setAttribute("aria-expanded","false"),this.ul.setAttribute("hidden",""),this.isOpened=!1,this.index=-1,this.status.setAttribute("hidden",""),this.input.setAttribute("aria-activedescendant",""),a.fire(this.input,"awesomplete-close",l||{}))},open:function(){this.input.setAttribute("aria-expanded","true"),this.ul.removeAttribute("hidden"),this.isOpened=!0,this.status.removeAttribute("hidden"),this.autoFirst&&this.index===-1&&this.goto(0),a.fire(this.input,"awesomplete-open")},destroy:function(){if(a.unbind(this.input,this._events.input),a.unbind(this.input.form,this._events.form),!this.options.container){var l=this.container.parentNode;l.insertBefore(this.input,this.container),l.removeChild(this.container)}this.input.removeAttribute("autocomplete"),this.input.removeAttribute("aria-autocomplete"),this.input.removeAttribute("aria-expanded"),this.input.removeAttribute("aria-controls"),this.input.removeAttribute("aria-owns"),this.input.removeAttribute("role");var u=e.all.indexOf(this);u!==-1&&e.all.splice(u,1)},next:function(){var l=this.ul.children.length;this.goto(this.index<l-1?this.index+1:l?0:-1)},previous:function(){var l=this.ul.children.length,u=this.index-1;this.goto(this.selected&&u!==-1?u:l-1)},goto:function(l){var u=this.ul.children;this.selected&&u[this.index].setAttribute("aria-selected","false"),this.index=l,l>-1&&u.length>0&&(u[l].setAttribute("aria-selected","true"),this.input.setAttribute("aria-activedescendant",this.ul.id+"_item_"+this.index),this.ul.scrollTop=u[l].offsetTop-this.ul.clientHeight+u[l].clientHeight,a.fire(this.input,"awesomplete-highlight",{text:this.suggestions[this.index]}))},select:function(l,u,c){if(l?this.index=a.siblingIndex(l):l=this.ul.children[this.index],l){var d=this.suggestions[this.index],p=a.fire(this.input,"awesomplete-select",{text:d,origin:u||l,originalEvent:c});p&&(this.replace(d),this.close({reason:"select"}),a.fire(this.input,"awesomplete-selectcomplete",{text:d,originalEvent:c}))}},evaluate:function(){var l=this,u=this.input.value;u.length>=this.minChars&&this._list&&this._list.length>0?(this.index=-1,this.ul.innerHTML="",this.suggestions=this._list.map(function(c){return new i(l.data(c,u))}).filter(function(c){return l.filter(c,u)}),this.sort!==!1&&(this.suggestions=this.suggestions.sort(this.sort)),this.suggestions=this.suggestions.slice(0,this.maxItems),this.suggestions.forEach(function(c,d){l.ul.appendChild(l.item(c,u,d))}),this.ul.children.length===0?(this.status.textContent=this.statusNoResults,this.close({reason:"nomatches"})):(this.input.setAttribute("aria-activedescendant",""),this.open(),this.status.textContent=this.statusXResults.replaceAll("{0}",this.ul.children.length))):(this.close({reason:"nomatches"}),this.minChar<=1||u.length>=this.minChars?this.status.textContent=this.statusNoResults:this.status.textContent=this.statusTypeXChar.replaceAll("{0}",this.minChars))}},e.all=[],e.FILTER_CONTAINS=function(l,u){return RegExp(a.regExpEscape(u.trim()),"i").test(l)},e.FILTER_STARTSWITH=function(l,u){return RegExp("^"+a.regExpEscape(u.trim()),"i").test(l)},e.SORT_BYLENGTH=function(l,u){return l.length!==u.length?l.length-u.length:l<u?-1:1},e.CONTAINER=function(l){return a.create("div",{className:"awesomplete",around:l})},e.ITEM=function(l,u,c){var d=u.trim()===""?l:l.replace(RegExp(a.regExpEscape(u.trim()),"gi"),"<mark>$&</mark>");return a.create("li",{innerHTML:d,role:"option","aria-selected":"false",tabindex:"-1",id:"awesomplete_list_"+this.count+"_item_"+c})},e.REPLACE=function(l){this.input.value=l.value},e.DATA=function(l){return l};function i(l){var u=Array.isArray(l)?{label:l[0],value:l[1]}:typeof l=="object"&&"label"in l&&"value"in l?l:{label:l,value:l};this.label=u.label||u.value,this.value=u.value}Object.defineProperty(i.prototype=Object.create(String.prototype),"length",{get:function(){return this.label.length}}),i.prototype.toString=i.prototype.valueOf=function(){return""+this.label};function r(l,u,c){for(var d in u){var p=u[d],f=l.input.getAttribute("data-"+d.toLowerCase());typeof p=="number"?l[d]=parseInt(f):p===!1?l[d]=f!==null:p instanceof Function?l[d]=null:l[d]=f,!l[d]&&l[d]!==0&&(l[d]=d in c?c[d]:p)}}var n=Array.prototype.slice;function a(l,u){return typeof l=="string"?(u||document).querySelector(l):l||null}function s(l,u){return n.call((u||document).querySelectorAll(l))}a.create=function(l,u){var c=document.createElement(l);for(var d in u){var p=u[d];if(d==="inside")a(p).appendChild(c);else if(d==="around"){var f=a(p);f.parentNode.insertBefore(c,f),c.appendChild(f),f.getAttribute("autofocus")!=null&&f.focus()}else d in c?c[d]=p:c.setAttribute(d,p)}return c},a.bind=function(l,u){if(l)for(var c in u){var d=u[c];c.split(/\s+/).forEach(function(p){l.addEventListener(p,d)})}},a.unbind=function(l,u){if(l)for(var c in u){var d=u[c];c.split(/\s+/).forEach(function(p){l.removeEventListener(p,d)})}},a.fire=function(l,u,c){var d=document.createEvent("HTMLEvents");d.initEvent(u,!0,!0);for(var p in c)d[p]=c[p];return l.dispatchEvent(d)},a.regExpEscape=function(l){return l.replace(/[-\\^$*+?.()|[\]{}]/g,"\\$&")},a.siblingIndex=function(l){for(var u=0;l=l.previousElementSibling;u++);return u};function o(){s("input.awesomplete").forEach(function(l){new e(l)})}return typeof self<"u"&&(self.Awesomplete=e),typeof Document<"u"&&(document.readyState!=="loading"?o():document.addEventListener("DOMContentLoaded",o)),e.$=a,e.$$=s,t.exports&&(t.exports=e),e})()})(Dz)),Dz.exports}var WOe=HOe();const zOe=$$(WOe);function qOe({list:t,element:e,callback:i,currentValue:r,withCatchTab:n,onChange:a,onSelectComplete:s,listProvider:o}){const l=new zOe(e,{list:t});e.parentElement&&(e.parentElement.style.width="100%"),po(o)&&e.addEventListener("focus",()=>{const d=o();l.list=d});let u=!1;const c=d=>{u=!0,po(i)&&i(d.text.value),e.value=d.text.label,l.suggestions=[],po(s)&&setTimeout(()=>s(),0)};if(n){const d=p=>p.key==="Tab"&&p.preventDefault();e.addEventListener("keydown",d,!1),e.addEventListener("keyup",d,!1)}if(typeof a=="function"&&e.addEventListener("change",a),e.setAttribute("autocomplete","off"),e.addEventListener("awesomplete-selectcomplete",d=>c(d),!1),e.addEventListener("keyup",function(d){const p=d.key==="Tab"&&d.shiftKey;if((d.key==="Enter"||d.key==="Tab"&&!p)&&!u){const f=e.value.trim()==="";if(d.key==="Enter"&&f){po(i)&&i(""),e.value="",l.suggestions=[],po(s)&&setTimeout(()=>s(),0);return}l.suggestions?.length&&!f&&(l.next(),l.select(0))}u=!1}),r){const d=t.find(p=>p.value===r)?.label;d&&(e.value=d)}return{typeAhead:l}}function V$(t){return t[t.length-1]}function YS(t,...e){return e.forEach(i=>{t.includes(i)||t.push(i)}),t}function Ez(t,e){return t?t.split(e):[]}function j$(t,e,i){const r=e===void 0||t>=e,n=i===void 0||t<=i;return r&&n}function Vee(t,e,i){return t<e?e:t>i?i:t}function gI(t,e,i={},r=0,n=""){const a=Object.keys(i).reduce((o,l)=>{let u=i[l];return typeof u=="function"&&(u=u(r)),`${o} ${l}="${u}"`},t);n+=`<${a}></${t}>`;const s=r+1;return s<e?gI(t,e,i,s,n):n}function G$(t){return t.replace(/>\s+/g,">").replace(/\s+</,"<")}function ZO(t){return new Date(t).setHours(0,0,0,0)}function Ch(){return new Date().setHours(0,0,0,0)}function II(...t){switch(t.length){case 0:return Ch();case 1:return ZO(t[0])}const e=new Date(0);return e.setFullYear(...t),e.setHours(0,0,0,0)}function Fb(t,e){const i=new Date(t);return i.setDate(i.getDate()+e)}function YOe(t,e){return Fb(t,e*7)}function EP(t,e){const i=new Date(t),r=i.getMonth()+e;let n=r%12;n<0&&(n+=12);const a=i.setMonth(r);return i.getMonth()!==n?i.setDate(0):a}function Lb(t,e){const i=new Date(t),r=i.getMonth(),n=i.setFullYear(i.getFullYear()+e);return r===1&&i.getMonth()===2?i.setDate(0):n}function Rz(t,e){return(t-e+7)%7}function dm(t,e,i=0){const r=new Date(t).getDay();return Fb(t,Rz(e,i)-Rz(r,i))}function jee(t,e){return Math.round((t-e)/6048e5)+1}function KOe(t){const e=dm(t,4,1),i=dm(new Date(e).setMonth(0,4),4,1);return jee(e,i)}function Gee(t,e){const i=dm(new Date(t).setMonth(0,1),e,e),r=dm(t,e,e),n=jee(r,i);if(n<53)return n;const a=dm(new Date(t).setDate(32),e,e);return r===a?1:n}function XOe(t){return Gee(t,0)}function JOe(t){return Gee(t,6)}function cg(t,e){const i=new Date(t).getFullYear();return Math.floor(i/e)*e}function Ip(t,e,i){if(e!==1&&e!==2)return t;const r=new Date(t);return e===1?i?r.setMonth(r.getMonth()+1,0):r.setDate(1):i?r.setFullYear(r.getFullYear()+1,0,0):r.setMonth(0,1),r.setHours(0,0,0,0)}const ex=/dd?|DD?|mm?|MM?|yy?(?:yy)?/,QOe=/[\s!-/:-@[-`{-~]+/;let XA={};const Cz={y(t,e){return new Date(t).setFullYear(parseInt(e,10))},m(t,e,i){const r=new Date(t);let n=parseInt(e,10)-1;if(isNaN(n)){if(!e)return NaN;const a=e.toLowerCase(),s=o=>o.toLowerCase().startsWith(a);if(n=i.monthsShort.findIndex(s),n<0&&(n=i.months.findIndex(s)),n<0)return NaN}return r.setMonth(n),r.getMonth()!==Hee(n)?r.setDate(0):r.getTime()},d(t,e){return new Date(t).setDate(parseInt(e,10))}},ZOe={d(t){return t.getDate()},dd(t){return PT(t.getDate(),2)},D(t,e){return e.daysShort[t.getDay()]},DD(t,e){return e.days[t.getDay()]},m(t){return t.getMonth()+1},mm(t){return PT(t.getMonth()+1,2)},M(t,e){return e.monthsShort[t.getMonth()]},MM(t,e){return e.months[t.getMonth()]},y(t){return t.getFullYear()},yy(t){return PT(t.getFullYear(),2).slice(-2)},yyyy(t){return PT(t.getFullYear(),4)}};function Hee(t){return t>-1?t%12:Hee(t+12)}function PT(t,e){return t.toString().padStart(e,"0")}function Wee(t){if(typeof t!="string")throw new Error("Invalid date format.");if(t in XA)return XA[t];const e=t.split(ex),i=t.match(new RegExp(ex,"g"));if(e.length===0||!i)throw new Error("Invalid date format.");const r=i.map(a=>ZOe[a]),n=Object.keys(Cz).reduce((a,s)=>(i.find(o=>o[0]!=="D"&&o[0].toLowerCase()===s)&&a.push(s),a),[]);return XA[t]={parser(a,s){const o=a.split(QOe).reduce((l,u,c)=>{if(u.length>0&&i[c]){const d=i[c][0];d==="M"?l.m=u:d!=="D"&&(l[d]=u)}return l},{});return n.reduce((l,u)=>{const c=Cz[u](l,o[u],s);return isNaN(c)?l:c},Ch())},formatter(a,s){let o=r.reduce((l,u,c)=>l+=`${e[c]}${u(a,s)}`,"");return o+=V$(e)}}}function _m(t,e,i){if(t instanceof Date||typeof t=="number"){const r=ZO(t);return isNaN(r)?void 0:r}if(t){if(t==="today")return Ch();if(e&&e.toValue){const r=e.toValue(t,e,i);return isNaN(r)?void 0:ZO(r)}return Wee(e).parser(t,i)}}function aM(t,e,i){if(isNaN(t)||!t&&t!==0)return"";const r=typeof t=="number"?new Date(t):t;return e.toDisplay?e.toDisplay(r,e,i):Wee(e).formatter(r,i)}const exe=document.createRange();function wd(t){return exe.createContextualFragment(t)}function zee(t){return t.parentElement||(t.parentNode instanceof ShadowRoot?t.parentNode.host:void 0)}function sM(t){return t.getRootNode().activeElement===t}function Hy(t){t.style.display!=="none"&&(t.style.display&&(t.dataset.styleDisplay=t.style.display),t.style.display="none")}function Wy(t){t.style.display==="none"&&(t.dataset.styleDisplay?(t.style.display=t.dataset.styleDisplay,delete t.dataset.styleDisplay):t.style.display="")}function RP(t){t.firstChild&&(t.removeChild(t.firstChild),RP(t))}function txe(t,e){RP(t),e instanceof DocumentFragment?t.appendChild(e):typeof e=="string"?t.appendChild(wd(e)):typeof e.forEach=="function"&&e.forEach(i=>{t.appendChild(i)})}const CP=new WeakMap,{addEventListener:ixe,removeEventListener:rxe}=EventTarget.prototype;function tx(t,e){let i=CP.get(t);i||(i=[],CP.set(t,i)),e.forEach(r=>{ixe.call(...r),i.push(r)})}function nxe(t){let e=CP.get(t);e&&(e.forEach(i=>{rxe.call(...i)}),CP.delete(t))}if(!Event.prototype.composedPath){const t=(e,i=[])=>{i.push(e);let r;return e.parentNode?r=e.parentNode:e.host?r=e.host:e.defaultView&&(r=e.defaultView),r?t(r,i):i};Event.prototype.composedPath=function(){return t(this.target)}}function qee(t,e,i){const[r,...n]=t;if(e(r))return r;if(!(r===i||r.tagName==="HTML"||n.length===0))return qee(n,e,i)}function Yee(t,e){const i=typeof e=="function"?e:r=>r instanceof Element&&r.matches(e);return qee(t.composedPath(),i,t.currentTarget)}const hy={en:{days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],daysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],daysMin:["Su","Mo","Tu","We","Th","Fr","Sa"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],today:"Today",clear:"Clear",titleFormat:"MM y"}},H$={autohide:!1,beforeShowDay:null,beforeShowDecade:null,beforeShowMonth:null,beforeShowYear:null,clearButton:!1,dateDelimiter:",",datesDisabled:[],daysOfWeekDisabled:[],daysOfWeekHighlighted:[],defaultViewDate:void 0,disableTouchKeyboard:!1,enableOnReadonly:!0,format:"mm/dd/yyyy",language:"en",maxDate:null,maxNumberOfDates:1,maxView:3,minDate:null,nextArrow:"",orientation:"auto",pickLevel:0,prevArrow:"",showDaysOfWeek:!0,showOnClick:!0,showOnFocus:!0,startView:0,title:"",todayButton:!1,todayButtonMode:0,todayHighlight:!1,updateOnBlur:!0,weekNumbers:0,weekStart:0},{language:JA,format:axe,weekStart:sxe}=H$;function Mz(t,e){return t.length<6&&e>=0&&e<7?YS(t,e):t}function Kee(t,e){switch(t===4?e===6?3:!e+1:t){case 1:return KOe;case 2:return XOe;case 3:return JOe}}function Nz(t,e,i){return e.weekStart=t,e.weekEnd=(t+6)%7,i===4&&(e.getWeekNumber=Kee(4,t)),t}function Az(t,e,i,r){const n=_m(t,e,i);return n!==void 0?n:r}function QA(t,e,i=3){const r=parseInt(t,10);return r>=0&&r<=i?r:e}function ET(t,e,i,r=void 0){e in t&&(i in t||(t[i]=r?r(t[e]):t[e]),delete t[e])}function ZA(t,e){const i=Object.assign({},t),r={},n=e.constructor.locales,a=!!e.rangeSideIndex;let{datesDisabled:s,format:o,language:l,locale:u,maxDate:c,maxView:d,minDate:p,pickLevel:f,startView:m,weekNumbers:h,weekStart:g}=e.config||{};if(ET(i,"calendarWeeks","weekNumbers",S=>S?1:0),ET(i,"clearBtn","clearButton"),ET(i,"todayBtn","todayButton"),ET(i,"todayBtnMode","todayButtonMode"),i.language){let S;if(i.language!==l&&(n[i.language]?S=i.language:(S=i.language.split("-")[0],n[S]||(S=!1))),delete i.language,S){l=r.language=S;const U=u||n[JA];u=Object.assign({format:axe,weekStart:sxe},n[JA]),l!==JA&&Object.assign(u,n[l]),r.locale=u,o===U.format&&(o=r.format=u.format),g===U.weekStart&&(g=Nz(u.weekStart,r,h))}}if(i.format){const S=typeof i.format.toDisplay=="function",U=typeof i.format.toValue=="function",T=ex.test(i.format);(S&&U||T)&&(o=r.format=i.format),delete i.format}let I=f;"pickLevel"in i&&(I=QA(i.pickLevel,f,2),delete i.pickLevel),I!==f&&(I>f&&("minDate"in i||(i.minDate=p),"maxDate"in i||(i.maxDate=c)),s&&!i.datesDisabled&&(i.datesDisabled=[]),f=r.pickLevel=I);let v=p,w=c;if("minDate"in i){const S=II(0,0,1);v=i.minDate===null?S:Az(i.minDate,o,u,v),v!==S&&(v=Ip(v,f,!1)),delete i.minDate}if("maxDate"in i&&(w=i.maxDate===null?void 0:Az(i.maxDate,o,u,w),w!==void 0&&(w=Ip(w,f,!0)),delete i.maxDate),w<v?(p=r.minDate=w,c=r.maxDate=v):(p!==v&&(p=r.minDate=v),c!==w&&(c=r.maxDate=w)),i.datesDisabled){const S=i.datesDisabled;if(typeof S=="function")r.datesDisabled=null,r.checkDisabled=(U,T)=>S(new Date(U),T,a);else{const U=r.datesDisabled=S.reduce((T,P)=>{const D=_m(P,o,u);return D!==void 0?YS(T,Ip(D,f,a)):T},[]);r.checkDisabled=T=>U.includes(T)}delete i.datesDisabled}if("defaultViewDate"in i){const S=_m(i.defaultViewDate,o,u);S!==void 0&&(r.defaultViewDate=S),delete i.defaultViewDate}if("weekStart"in i){const S=Number(i.weekStart)%7;isNaN(S)||(g=Nz(S,r,h)),delete i.weekStart}if(i.daysOfWeekDisabled&&(r.daysOfWeekDisabled=i.daysOfWeekDisabled.reduce(Mz,[]),delete i.daysOfWeekDisabled),i.daysOfWeekHighlighted&&(r.daysOfWeekHighlighted=i.daysOfWeekHighlighted.reduce(Mz,[]),delete i.daysOfWeekHighlighted),"weekNumbers"in i){let S=i.weekNumbers;if(S){const U=typeof S=="function"?(T,P)=>S(new Date(T),P):Kee(S=parseInt(S,10),g);U&&(h=r.weekNumbers=S,r.getWeekNumber=U)}else h=r.weekNumbers=0,r.getWeekNumber=null;delete i.weekNumbers}if("maxNumberOfDates"in i){const S=parseInt(i.maxNumberOfDates,10);S>=0&&(r.maxNumberOfDates=S,r.multidate=S!==1),delete i.maxNumberOfDates}i.dateDelimiter&&(r.dateDelimiter=String(i.dateDelimiter),delete i.dateDelimiter);let y=d;"maxView"in i&&(y=QA(i.maxView,d),delete i.maxView),y=f>y?f:y,y!==d&&(d=r.maxView=y);let b=m;if("startView"in i&&(b=QA(i.startView,b),delete i.startView),b<f?b=f:b>d&&(b=d),b!==m&&(r.startView=b),i.prevArrow){const S=wd(i.prevArrow);S.childNodes.length>0&&(r.prevArrow=S.childNodes),delete i.prevArrow}if(i.nextArrow){const S=wd(i.nextArrow);S.childNodes.length>0&&(r.nextArrow=S.childNodes),delete i.nextArrow}if("disableTouchKeyboard"in i&&(r.disableTouchKeyboard="ontouchstart"in document&&!!i.disableTouchKeyboard,delete i.disableTouchKeyboard),i.orientation){const S=i.orientation.toLowerCase().split(/\s+/g);r.orientation={x:S.find(U=>U==="left"||U==="right")||"auto",y:S.find(U=>U==="top"||U==="bottom")||"auto"},delete i.orientation}if("todayButtonMode"in i){switch(i.todayButtonMode){case 0:case 1:r.todayButtonMode=i.todayButtonMode}delete i.todayButtonMode}return Object.entries(i).forEach(([S,U])=>{U!==void 0&&S in H$&&(r[S]=U)}),r}const kz={show:{key:"ArrowDown"},hide:null,toggle:{key:"Escape"},prevButton:{key:"ArrowLeft",ctrlOrMetaKey:!0},nextButton:{key:"ArrowRight",ctrlOrMetaKey:!0},viewSwitch:{key:"ArrowUp",ctrlOrMetaKey:!0},clearButton:{key:"Backspace",ctrlOrMetaKey:!0},todayButton:{key:".",ctrlOrMetaKey:!0},exitEditMode:{key:"ArrowDown",ctrlOrMetaKey:!0}};function oxe(t){return Object.keys(kz).reduce((e,i)=>{const r=t[i]===void 0?kz[i]:t[i],n=r&&r.key;if(!n||typeof n!="string")return e;const a={key:n,ctrlOrMetaKey:!!(r.ctrlOrMetaKey||r.ctrlKey||r.metaKey)};return n.length>1&&(a.altKey=!!r.altKey,a.shiftKey=!!r.shiftKey),e[i]=a,e},{})}const Oz=t=>t.map(e=>`<button type="button" class="%buttonClass% ${e}" tabindex="-1"></button>`).join(""),lxe=G$(`<div class="datepicker">
  <div class="datepicker-picker">
    <div class="datepicker-header">
      <div class="datepicker-title"></div>
      <div class="datepicker-controls">
        ${Oz(["prev-button prev-btn","view-switch","next-button next-btn"])}
      </div>
    </div>
    <div class="datepicker-main"></div>
    <div class="datepicker-footer">
      <div class="datepicker-controls">
        ${Oz(["today-button today-btn","clear-button clear-btn"])}
      </div>
    </div>
  </div>
</div>`),uxe=G$(`<div class="days">
  <div class="days-of-week">${gI("span",7,{class:"dow"})}</div>
  <div class="datepicker-grid">${gI("span",42)}</div>
</div>`),cxe=G$(`<div class="week-numbers calendar-weeks">
  <div class="days-of-week"><span class="dow"></span></div>
  <div class="weeks">${gI("span",6,{class:"week"})}</div>
</div>`);class W${constructor(e,i){Object.assign(this,i,{picker:e,element:wd('<div class="datepicker-view"></div>').firstChild,selected:[],isRangeEnd:!!e.datepicker.rangeSideIndex}),this.init(this.picker.datepicker.config)}init(e){"pickLevel"in e&&(this.isMinView=this.id===e.pickLevel),this.setOptions(e),this.updateFocus(),this.updateSelection()}prepareForRender(e,i,r){this.disabled=[];const n=this.picker;n.setViewSwitchLabel(e),n.setPrevButtonDisabled(i),n.setNextButtonDisabled(r)}setDisabled(e,i){i.add("disabled"),YS(this.disabled,e)}performBeforeHook(e,i){let r=this.beforeShow(new Date(i));switch(typeof r){case"boolean":r={enabled:r};break;case"string":r={classes:r}}if(r){const n=e.classList;if(r.enabled===!1&&this.setDisabled(i,n),r.classes){const a=r.classes.split(/\s+/);n.add(...a),a.includes("disabled")&&this.setDisabled(i,n)}r.content&&txe(e,r.content)}}renderCell(e,i,r,n,{selected:a,range:s},o,l=[]){e.textContent=i,this.isMinView&&(e.dataset.date=n);const u=e.classList;if(e.className=`datepicker-cell ${this.cellClass}`,r<this.first?u.add("prev"):r>this.last&&u.add("next"),u.add(...l),(o||this.checkDisabled(n,this.id))&&this.setDisabled(n,u),s){const[c,d]=s;r>c&&r<d&&u.add("range"),r===c&&u.add("range-start"),r===d&&u.add("range-end")}a.includes(r)&&u.add("selected"),r===this.focused&&u.add("focused"),this.beforeShow&&this.performBeforeHook(e,n)}refreshCell(e,i,r,[n,a]){const s=e.classList;s.remove("range","range-start","range-end","selected","focused"),i>n&&i<a&&s.add("range"),i===n&&s.add("range-start"),i===a&&s.add("range-end"),r.includes(i)&&s.add("selected"),i===this.focused&&s.add("focused")}changeFocusedCell(e){this.grid.querySelectorAll(".focused").forEach(i=>{i.classList.remove("focused")}),this.grid.children[e].classList.add("focused")}}class dxe extends W${constructor(e){super(e,{id:0,name:"days",cellClass:"day"})}init(e,i=!0){if(i){const r=wd(uxe).firstChild;this.dow=r.firstChild,this.grid=r.lastChild,this.element.appendChild(r)}super.init(e)}setOptions(e){let i;if("minDate"in e&&(this.minDate=e.minDate),"maxDate"in e&&(this.maxDate=e.maxDate),e.checkDisabled&&(this.checkDisabled=e.checkDisabled),e.daysOfWeekDisabled&&(this.daysOfWeekDisabled=e.daysOfWeekDisabled,i=!0),e.daysOfWeekHighlighted&&(this.daysOfWeekHighlighted=e.daysOfWeekHighlighted),"todayHighlight"in e&&(this.todayHighlight=e.todayHighlight),"weekStart"in e&&(this.weekStart=e.weekStart,this.weekEnd=e.weekEnd,i=!0),e.locale){const r=this.locale=e.locale;this.dayNames=r.daysMin,this.switchLabelFormat=r.titleFormat,i=!0}if("beforeShowDay"in e&&(this.beforeShow=typeof e.beforeShowDay=="function"?e.beforeShowDay:void 0),"weekNumbers"in e)if(e.weekNumbers&&!this.weekNumbers){const r=wd(cxe).firstChild;this.weekNumbers={element:r,dow:r.firstChild,weeks:r.lastChild},this.element.insertBefore(r,this.element.firstChild)}else this.weekNumbers&&!e.weekNumbers&&(this.element.removeChild(this.weekNumbers.element),this.weekNumbers=null);"getWeekNumber"in e&&(this.getWeekNumber=e.getWeekNumber),"showDaysOfWeek"in e&&(e.showDaysOfWeek?(Wy(this.dow),this.weekNumbers&&Wy(this.weekNumbers.dow)):(Hy(this.dow),this.weekNumbers&&Hy(this.weekNumbers.dow))),i&&Array.from(this.dow.children).forEach((r,n)=>{const a=(this.weekStart+n)%7;r.textContent=this.dayNames[a],r.className=this.daysOfWeekDisabled.includes(a)?"dow disabled":"dow"})}updateFocus(){const e=new Date(this.picker.viewDate),i=e.getFullYear(),r=e.getMonth(),n=II(i,r,1),a=dm(n,this.weekStart,this.weekStart);this.first=n,this.last=II(i,r+1,0),this.start=a,this.focused=this.picker.viewDate}updateSelection(){const{dates:e,rangepicker:i}=this.picker.datepicker;this.selected=e,i&&(this.range=i.dates)}render(){if(this.today=this.todayHighlight?Ch():void 0,this.prepareForRender(aM(this.focused,this.switchLabelFormat,this.locale),this.first<=this.minDate,this.last>=this.maxDate),this.weekNumbers){const e=this.weekStart,i=dm(this.first,e,e);Array.from(this.weekNumbers.weeks.children).forEach((r,n)=>{const a=YOe(i,n);r.textContent=this.getWeekNumber(a,e),n>3&&r.classList[a>this.last?"add":"remove"]("next")})}Array.from(this.grid.children).forEach((e,i)=>{const r=Fb(this.start,i),n=new Date(r),a=n.getDay(),s=[];this.today===r&&s.push("today"),this.daysOfWeekHighlighted.includes(a)&&s.push("highlighted"),this.renderCell(e,n.getDate(),r,r,this,r<this.minDate||r>this.maxDate||this.daysOfWeekDisabled.includes(a),s)})}refresh(){const e=this.range||[];Array.from(this.grid.children).forEach(i=>{this.refreshCell(i,Number(i.dataset.date),this.selected,e)})}refreshFocus(){this.changeFocusedCell(Math.round((this.focused-this.start)/864e5))}}function xz(t,e){if(!t||!t[0]||!t[1])return;const[[i,r],[n,a]]=t;if(!(i>e||n<e))return[i===e?r:-1,n===e?a:12]}class pxe extends W${constructor(e){super(e,{id:1,name:"months",cellClass:"month"})}init(e,i=!0){i&&(this.grid=this.element,this.element.classList.add("months","datepicker-grid"),this.grid.appendChild(wd(gI("span",12,{"data-month":r=>r}))),this.first=0,this.last=11),super.init(e)}setOptions(e){if(e.locale&&(this.monthNames=e.locale.monthsShort),"minDate"in e)if(e.minDate===void 0)this.minYear=this.minMonth=this.minDate=void 0;else{const i=new Date(e.minDate);this.minYear=i.getFullYear(),this.minMonth=i.getMonth(),this.minDate=i.setDate(1)}if("maxDate"in e)if(e.maxDate===void 0)this.maxYear=this.maxMonth=this.maxDate=void 0;else{const i=new Date(e.maxDate);this.maxYear=i.getFullYear(),this.maxMonth=i.getMonth(),this.maxDate=II(this.maxYear,this.maxMonth+1,0)}e.checkDisabled&&(this.checkDisabled=this.isMinView||e.datesDisabled===null?e.checkDisabled:()=>!1),"beforeShowMonth"in e&&(this.beforeShow=typeof e.beforeShowMonth=="function"?e.beforeShowMonth:void 0)}updateFocus(){const e=new Date(this.picker.viewDate);this.year=e.getFullYear(),this.focused=e.getMonth()}updateSelection(){const{dates:e,rangepicker:i}=this.picker.datepicker;this.selected=e.reduce((r,n)=>{const a=new Date(n),s=a.getFullYear(),o=a.getMonth();return r[s]===void 0?r[s]=[o]:YS(r[s],o),r},{}),i&&i.dates&&(this.range=i.dates.map(r=>{const n=new Date(r);return isNaN(n)?void 0:[n.getFullYear(),n.getMonth()]}))}render(){this.prepareForRender(this.year,this.year<=this.minYear,this.year>=this.maxYear);const e=this.selected[this.year]||[],i=this.year<this.minYear||this.year>this.maxYear,r=this.year===this.minYear,n=this.year===this.maxYear,a=xz(this.range,this.year);Array.from(this.grid.children).forEach((s,o)=>{const l=Ip(new Date(this.year,o,1),1,this.isRangeEnd);this.renderCell(s,this.monthNames[o],o,l,{selected:e,range:a},i||r&&o<this.minMonth||n&&o>this.maxMonth)})}refresh(){const e=this.selected[this.year]||[],i=xz(this.range,this.year)||[];Array.from(this.grid.children).forEach((r,n)=>{this.refreshCell(r,n,e,i)})}refreshFocus(){this.changeFocusedCell(this.focused)}}function fxe(t){return[...t].reduce((e,i,r)=>e+=r?i:i.toUpperCase(),"")}class Fz extends W${constructor(e,i){super(e,i)}init(e,i=!0){i&&(this.navStep=this.step*10,this.beforeShowOption=`beforeShow${fxe(this.cellClass)}`,this.grid=this.element,this.element.classList.add(this.name,"datepicker-grid"),this.grid.appendChild(wd(gI("span",12)))),super.init(e)}setOptions(e){if("minDate"in e&&(e.minDate===void 0?this.minYear=this.minDate=void 0:(this.minYear=cg(e.minDate,this.step),this.minDate=II(this.minYear,0,1))),"maxDate"in e&&(e.maxDate===void 0?this.maxYear=this.maxDate=void 0:(this.maxYear=cg(e.maxDate,this.step),this.maxDate=II(this.maxYear,11,31))),e.checkDisabled&&(this.checkDisabled=this.isMinView||e.datesDisabled===null?e.checkDisabled:()=>!1),this.beforeShowOption in e){const i=e[this.beforeShowOption];this.beforeShow=typeof i=="function"?i:void 0}}updateFocus(){const e=new Date(this.picker.viewDate),i=cg(e,this.navStep),r=i+9*this.step;this.first=i,this.last=r,this.start=i-this.step,this.focused=cg(e,this.step)}updateSelection(){const{dates:e,rangepicker:i}=this.picker.datepicker;this.selected=e.reduce((r,n)=>YS(r,cg(n,this.step)),[]),i&&i.dates&&(this.range=i.dates.map(r=>{if(r!==void 0)return cg(r,this.step)}))}render(){this.prepareForRender(`${this.first}-${this.last}`,this.first<=this.minYear,this.last>=this.maxYear),Array.from(this.grid.children).forEach((e,i)=>{const r=this.start+i*this.step,n=Ip(new Date(r,0,1),2,this.isRangeEnd);e.dataset.year=r,this.renderCell(e,r,r,n,this,r<this.minYear||r>this.maxYear)})}refresh(){const e=this.range||[];Array.from(this.grid.children).forEach(i=>{this.refreshCell(i,Number(i.textContent),this.selected,e)})}refreshFocus(){this.changeFocusedCell(Math.round((this.focused-this.start)/this.step))}}function bg(t,e){const i={bubbles:!0,cancelable:!0,detail:{date:t.getDate(),viewDate:new Date(t.picker.viewDate),viewId:t.picker.currentView.id,datepicker:t}};t.element.dispatchEvent(new CustomEvent(e,i))}function MP(t,e){const{config:i,picker:r}=t,{currentView:n,viewDate:a}=r;let s;switch(n.id){case 0:s=EP(a,e);break;case 1:s=Lb(a,e);break;default:s=Lb(a,e*n.navStep)}s=Vee(s,i.minDate,i.maxDate),r.changeFocus(s).render()}function Xee(t){const e=t.picker.currentView.id;e!==t.config.maxView&&t.picker.changeView(e+1).render()}function Jee(t){t.setDate({clear:!0})}function Qee(t){const e=Ch();t.config.todayButtonMode===1?t.setDate(e,{forceRefresh:!0,viewDate:e}):t.setFocusedDate(e,!0)}function Zee(t){const e=()=>{t.config.updateOnBlur?t.update({revert:!0}):t.refresh("input"),t.hide()},i=t.element;sM(i)?i.addEventListener("blur",e,{once:!0}):e()}function Lz(t,e){const i=t.picker,r=new Date(i.viewDate),n=i.currentView.id,a=n===1?EP(r,e-r.getMonth()):Lb(r,e-r.getFullYear());i.changeFocus(a).changeView(n-1).render()}function mxe(t){Xee(t)}function hxe(t){MP(t,-1)}function gxe(t){MP(t,1)}function Ixe(t,e){const i=Yee(e,".datepicker-cell");if(!i||i.classList.contains("disabled"))return;const{id:r,isMinView:n}=t.picker.currentView,a=i.dataset;n?t.setDate(Number(a.date)):r===1?Lz(t,Number(a.month)):Lz(t,Number(a.year))}function vxe(t){t.preventDefault()}const ek=["left","top","right","bottom"].reduce((t,e)=>(t[e]=`datepicker-orient-${e}`,t),{}),_z=t=>t&&`${t}px`;function $z(t,e){if("title"in e&&(e.title?(t.controls.title.textContent=e.title,Wy(t.controls.title)):(t.controls.title.textContent="",Hy(t.controls.title))),e.prevArrow){const i=t.controls.prevButton;RP(i),e.prevArrow.forEach(r=>{i.appendChild(r.cloneNode(!0))})}if(e.nextArrow){const i=t.controls.nextButton;RP(i),e.nextArrow.forEach(r=>{i.appendChild(r.cloneNode(!0))})}if(e.locale&&(t.controls.todayButton.textContent=e.locale.today,t.controls.clearButton.textContent=e.locale.clear),"todayButton"in e&&(e.todayButton?Wy(t.controls.todayButton):Hy(t.controls.todayButton)),"minDate"in e||"maxDate"in e){const{minDate:i,maxDate:r}=t.datepicker.config;t.controls.todayButton.disabled=!j$(Ch(),i,r)}"clearButton"in e&&(e.clearButton?Wy(t.controls.clearButton):Hy(t.controls.clearButton))}function Bz(t){const{dates:e,config:i,rangeSideIndex:r}=t,n=e.length>0?V$(e):Ip(i.defaultViewDate,i.pickLevel,r);return Vee(n,i.minDate,i.maxDate)}function Vz(t,e){!("_oldViewDate"in t)&&e!==t.viewDate&&(t._oldViewDate=t.viewDate),t.viewDate=e;const{id:i,year:r,first:n,last:a}=t.currentView,s=new Date(e).getFullYear();switch(i){case 0:return e<n||e>a;case 1:return s!==r;default:return s<n||s>a}}function tk(t){return window.getComputedStyle(t).direction}function ete(t){const e=zee(t);if(!(e===document.body||!e))return window.getComputedStyle(e).overflow!=="visible"?e:ete(e)}class yxe{constructor(e){const{config:i,inputField:r}=this.datepicker=e,n=lxe.replace(/%buttonClass%/g,i.buttonClass),a=this.element=wd(n).firstChild,[s,o,l]=a.firstChild.children,u=s.firstElementChild,[c,d,p]=s.lastElementChild.children,[f,m]=l.firstChild.children,h={title:u,prevButton:c,viewSwitch:d,nextButton:p,todayButton:f,clearButton:m};this.main=o,this.controls=h;const g=r?"dropdown":"inline";a.classList.add(`datepicker-${g}`),$z(this,i),this.viewDate=Bz(e),tx(e,[[a,"mousedown",vxe],[o,"click",Ixe.bind(null,e)],[h.viewSwitch,"click",mxe.bind(null,e)],[h.prevButton,"click",hxe.bind(null,e)],[h.nextButton,"click",gxe.bind(null,e)],[h.todayButton,"click",Qee.bind(null,e)],[h.clearButton,"click",Jee.bind(null,e)]]),this.views=[new dxe(this),new pxe(this),new Fz(this,{id:2,name:"years",cellClass:"year",step:1}),new Fz(this,{id:3,name:"decades",cellClass:"decade",step:10})],this.currentView=this.views[i.startView],this.currentView.render(),this.main.appendChild(this.currentView.element),i.container?i.container.appendChild(this.element):r.after(this.element)}setOptions(e){$z(this,e),this.views.forEach(i=>{i.init(e,!1)}),this.currentView.render()}detach(){this.element.remove()}show(){if(this.active)return;const{datepicker:e,element:i}=this,r=e.inputField;if(r){const n=tk(r);n!==tk(zee(i))?i.dir=n:i.dir&&i.removeAttribute("dir"),this.place(),i.classList.add("active"),e.config.disableTouchKeyboard&&r.blur()}else i.classList.add("active");this.active=!0,bg(e,"show")}hide(){this.active&&(this.datepicker.exitEditMode(),this.element.classList.remove("active"),this.active=!1,bg(this.datepicker,"hide"))}place(){const{classList:e,style:i}=this.element;i.display="block";const{width:r,height:n}=this.element.getBoundingClientRect(),a=this.element.offsetParent;i.display="";const{config:s,inputField:o}=this.datepicker,{left:l,top:u,right:c,bottom:d,width:p,height:f}=o.getBoundingClientRect();let{x:m,y:h}=s.orientation,g=l,I=u;if(a===document.body||!a)g+=window.scrollX,I+=window.scrollY;else{const T=a.getBoundingClientRect();g-=T.left-a.scrollLeft,I-=T.top-a.scrollTop}const v=ete(o);let w=0,y=0,{clientWidth:b,clientHeight:S}=document.documentElement;if(v){const T=v.getBoundingClientRect();T.top>0&&(y=T.top),T.left>0&&(w=T.left),T.right<b&&(b=T.right),T.bottom<S&&(S=T.bottom)}let U=0;m==="auto"&&(l<w?(m="left",U=w-l):l+r>b?(m="right",b<c&&(U=b-c)):tk(o)==="rtl"?m=c-r<w?"left":"right":m="left"),m==="right"&&(g+=p-r),g+=U,h==="auto"&&(u-n>y?h=d+n>S?"top":"bottom":h="bottom"),h==="top"?I-=n:I+=f,e.remove(...Object.values(ek)),e.add(ek[m],ek[h]),i.left=_z(g),i.top=_z(I)}setViewSwitchLabel(e){this.controls.viewSwitch.textContent=e}setPrevButtonDisabled(e){this.controls.prevButton.disabled=e}setNextButtonDisabled(e){this.controls.nextButton.disabled=e}changeView(e){const i=this.currentView;return e!==i.id&&(this._oldView||(this._oldView=i),this.currentView=this.views[e],this._renderMethod="render"),this}changeFocus(e){return this._renderMethod=Vz(this,e)?"render":"refreshFocus",this.views.forEach(i=>{i.updateFocus()}),this}update(e=void 0){const i=e===void 0?Bz(this.datepicker):e;return this._renderMethod=Vz(this,i)?"render":"refresh",this.views.forEach(r=>{r.updateFocus(),r.updateSelection()}),this}render(e=!0){const{currentView:i,datepicker:r,_oldView:n}=this,a=new Date(this._oldViewDate),s=e&&this._renderMethod||"render";if(delete this._oldView,delete this._oldViewDate,delete this._renderMethod,i[s](),n&&(this.main.replaceChild(i.element,n.element),bg(r,"changeView")),!isNaN(a)){const o=new Date(this.viewDate);o.getFullYear()!==a.getFullYear()&&bg(r,"changeYear"),o.getMonth()!==a.getMonth()&&bg(r,"changeMonth")}}}function tte(t,e,i,r,n,a){if(j$(t,n,a)){if(r(t)){const s=e(t,i);return tte(s,e,i,r,n,a)}return t}}function bxe(t,e,i){const r=t.picker,n=r.currentView,a=n.step||1;let s=r.viewDate,o;switch(n.id){case 0:s=Fb(s,i?e*7:e),o=Fb;break;case 1:s=EP(s,i?e*4:e),o=EP;break;default:s=Lb(s,e*(i?4:1)*a),o=Lb}s=tte(s,o,e<0?-a:a,l=>n.disabled.includes(l),n.minDate,n.maxDate),s!==void 0&&r.changeFocus(s).render()}function wxe(t,e){const{config:i,picker:r,editMode:n}=t,a=r.active,{key:s,altKey:o,shiftKey:l}=e,u=e.ctrlKey||e.metaKey,c=()=>{e.preventDefault(),e.stopPropagation()};if(s==="Tab"){Zee(t);return}if(s==="Enter"){if(!a)t.update();else if(n)t.exitEditMode({update:!0,autohide:i.autohide});else{const h=r.currentView;h.isMinView?t.setDate(r.viewDate):(r.changeView(h.id-1).render(),c())}return}const d=i.shortcutKeys,p={key:s,ctrlOrMetaKey:u,altKey:o,shiftKey:l},f=Object.keys(d).find(h=>{const g=d[h];return!Object.keys(g).find(I=>g[I]!==p[I])});if(f){let h;if(f==="toggle"?h=f:n?f==="exitEditMode"&&(h=f):a?f==="hide"?h=f:f==="prevButton"?h=[MP,[t,-1]]:f==="nextButton"?h=[MP,[t,1]]:f==="viewSwitch"?h=[Xee,[t]]:i.clearButton&&f==="clearButton"?h=[Jee,[t]]:i.todayButton&&f==="todayButton"&&(h=[Qee,[t]]):f==="show"&&(h=f),h){Array.isArray(h)?h[0].apply(null,h[1]):t[h](),c();return}}if(!a||n)return;const m=(h,g)=>{l||u||o?t.enterEditMode():(bxe(t,h,g),e.preventDefault())};s==="ArrowLeft"?m(-1,!1):s==="ArrowRight"?m(1,!1):s==="ArrowUp"?m(-1,!0):s==="ArrowDown"?m(1,!0):(s==="Backspace"||s==="Delete"||s&&s.length===1&&!u)&&t.enterEditMode()}function Sxe(t){t.config.showOnFocus&&!t._showing&&t.show()}function Uxe(t,e){const i=e.target;(t.picker.active||t.config.showOnClick)&&(i._active=sM(i),i._clicking=setTimeout(()=>{delete i._active,delete i._clicking},2e3))}function Txe(t,e){const i=e.target;i._clicking&&(clearTimeout(i._clicking),delete i._clicking,i._active&&t.enterEditMode(),delete i._active,t.config.showOnClick&&t.show())}function Dxe(t,e){e.clipboardData.types.includes("text/plain")&&t.enterEditMode()}function Pxe(t,e){const{element:i,picker:r}=t;if(!r.active&&!sM(i))return;const n=r.element;Yee(e,a=>a===i||a===n)||Zee(t)}function ite(t,e){return t.map(i=>aM(i,e.format,e.locale)).join(e.dateDelimiter)}function rte(t,e,i=!1){if(e.length===0)return i?[]:void 0;const{config:r,dates:n,rangeSideIndex:a}=t,{pickLevel:s,maxNumberOfDates:o}=r;let l=e.reduce((u,c)=>{let d=_m(c,r.format,r.locale);return d===void 0||(d=Ip(d,s,a),j$(d,r.minDate,r.maxDate)&&!u.includes(d)&&!r.checkDisabled(d,s)&&(s>0||!r.daysOfWeekDisabled.includes(new Date(d).getDay()))&&u.push(d)),u},[]);if(l.length!==0)return r.multidate&&!i&&(l=l.reduce((u,c)=>(n.includes(c)||u.push(c),u),n.filter(u=>!l.includes(u)))),o&&l.length>o?l.slice(o*-1):l}function NP(t,e=3,i=!0,r=void 0){const{config:n,picker:a,inputField:s}=t;if(e&2){const o=a.active?n.pickLevel:n.startView;a.update(r).changeView(o).render(i)}e&1&&s&&(s.value=ite(t.dates,n))}function jz(t,e,i){const r=t.config;let{clear:n,render:a,autohide:s,revert:o,forceRefresh:l,viewDate:u}=i;a===void 0&&(a=!0),a?s===void 0&&(s=r.autohide):s=l=!1,u=_m(u,r.format,r.locale);const c=rte(t,e,n);!c&&!o||(c&&c.toString()!==t.dates.toString()?(t.dates=c,NP(t,a?3:1,!0,u),bg(t,"changeDate")):NP(t,l?3:1,!0,u),s&&t.hide())}function Gz(t,e){return e?i=>aM(i,e,t.config.locale):i=>new Date(i)}class Exe{constructor(e,i={},r=void 0){e.datepicker=this,this.element=e,this.dates=[];const n=this.config=Object.assign({buttonClass:i.buttonClass&&String(i.buttonClass)||"button",container:null,defaultViewDate:Ch(),maxDate:void 0,minDate:void 0},ZA(H$,this));let a;if(e.tagName==="INPUT"?(a=this.inputField=e,a.classList.add("datepicker-input"),i.container&&(n.container=i.container instanceof HTMLElement?i.container:document.querySelector(i.container))):n.container=e,r){const c=r.inputs.indexOf(a),d=r.datepickers;if(c<0||c>1||!Array.isArray(d))throw Error("Invalid rangepicker object.");d[c]=this,this.rangepicker=r,this.rangeSideIndex=c}this._options=i,Object.assign(n,ZA(i,this)),n.shortcutKeys=oxe(i.shortcutKeys||{});const s=Ez(e.value||e.dataset.date,n.dateDelimiter);delete e.dataset.date;const o=rte(this,s);o&&o.length>0&&(this.dates=o),a&&(a.value=ite(this.dates,n));const l=this.picker=new yxe(this),u=[e,"keydown",wxe.bind(null,this)];a?tx(this,[u,[a,"focus",Sxe.bind(null,this)],[a,"mousedown",Uxe.bind(null,this)],[a,"click",Txe.bind(null,this)],[a,"paste",Dxe.bind(null,this)],[document,"mousedown",Pxe.bind(null,this)],[window,"resize",l.place.bind(l)]]):(tx(this,[u]),this.show())}static formatDate(e,i,r){return aM(e,i,r&&hy[r]||hy.en)}static parseDate(e,i,r){return _m(e,i,r&&hy[r]||hy.en)}static get locales(){return hy}get active(){return!!(this.picker&&this.picker.active)}get pickerElement(){return this.picker?this.picker.element:void 0}setOptions(e){const i=ZA(e,this);Object.assign(this._options,e),Object.assign(this.config,i),this.picker.setOptions(i),NP(this,3)}show(){if(this.inputField){const{config:e,inputField:i}=this;if(i.disabled||i.readOnly&&!e.enableOnReadonly)return;!sM(i)&&!e.disableTouchKeyboard&&(this._showing=!0,i.focus(),delete this._showing)}this.picker.show()}hide(){this.inputField&&(this.picker.hide(),this.picker.update().changeView(this.config.startView).render())}toggle(){this.picker.active?this.inputField&&this.picker.hide():this.show()}destroy(){this.hide(),nxe(this),this.picker.detach();const e=this.element;return e.classList.remove("datepicker-input"),delete e.datepicker,this}getDate(e=void 0){const i=Gz(this,e);if(this.config.multidate)return this.dates.map(i);if(this.dates.length>0)return i(this.dates[0])}setDate(...e){const i=[...e],r={},n=V$(e);n&&typeof n=="object"&&!Array.isArray(n)&&!(n instanceof Date)&&Object.assign(r,i.pop());const a=Array.isArray(i[0])?i[0]:i;jz(this,a,r)}update(e=void 0){if(!this.inputField)return;const i=Object.assign(e||{},{clear:!0,render:!0,viewDate:void 0}),r=Ez(this.inputField.value,this.config.dateDelimiter);jz(this,r,i)}getFocusedDate(e=void 0){return Gz(this,e)(this.picker.viewDate)}setFocusedDate(e,i=!1){const{config:r,picker:n,active:a,rangeSideIndex:s}=this,o=r.pickLevel,l=_m(e,r.format,r.locale);l!==void 0&&(n.changeFocus(Ip(l,o,s)),a&&i&&n.changeView(o),n.render())}refresh(e=void 0,i=!1){e&&typeof e!="string"&&(i=e,e=void 0);let r;e==="picker"?r=2:e==="input"?r=1:r=3,NP(this,r,!i)}enterEditMode(){const e=this.inputField;!e||e.readOnly||!this.picker.active||this.editMode||(this.editMode=!0,e.classList.add("in-edit"))}exitEditMode(e=void 0){if(!this.inputField||!this.editMode)return;const i=Object.assign({update:!1},e);delete this.editMode,this.inputField.classList.remove("in-edit"),i.update&&this.update(i)}}function Rxe(t,e,i,r,n){if(n){const a=e.target.value;n(a)?(r.innerHTML="",r.classList.remove("is-danger"),i.classList.remove("is-danger"),i.classList.add("is-success")):(r.innerHTML=t.error||"Invalid",i.classList.remove("is-success"),i.classList.add("is-danger"),r.classList.add("is-danger"))}}function Cxe(t){const e=new Set(t.options.filter(m=>m.selected).map(m=>m.value)),i=document.createElement("div");i.style.cssText="position: relative; width: 100%;";const r=document.createElement("div");r.style.cssText=["display: flex","align-items: center","flex-wrap: wrap","gap: 4px","min-height: 2.5em","padding: 4px 8px","border: 1px solid var(--chc-input-border, #7a7a7a)","border-radius: 4px","background: var(--chc-input-bg, #fff)","cursor: pointer","box-sizing: border-box"].join("; ");const n=document.createElement("div");n.style.cssText="display: flex; flex-wrap: wrap; gap: 4px; flex: 1; min-width: 0;";const a=document.createElement("span");a.textContent="",a.style.cssText="margin-left: auto; padding-left: 8px; user-select: none; color: var(--chc-text-secondary, #666);",r.appendChild(n),r.appendChild(a);const s=document.createElement("div");s.style.cssText=["display: none","position: absolute","top: 100%","left: 0","right: 0","z-index: 50","max-height: 220px","overflow-y: auto","border: 1px solid var(--chc-border-primary, #dbdbdb)","border-top: none","border-radius: 0 0 4px 4px","background: var(--chc-dropdown-bg, #fff)","box-shadow: 0 4px 8px rgba(0,0,0,0.1)"].join("; ");const o=new Map;for(const m of t.options){const h=document.createElement("label");h.style.cssText=["display: flex","align-items: center","gap: 8px","padding: 6px 10px","cursor: pointer","color: var(--chc-text-primary, #363636)"].join("; "),h.addEventListener("mouseenter",()=>{h.style.background="var(--chc-hover-bg, #f5f5f5)"}),h.addEventListener("mouseleave",()=>{h.style.background=""});const g=document.createElement("input");g.type="checkbox",g.value=m.value,g.checked=!!m.selected,m.disabled&&(g.disabled=!0),g.style.cssText="margin: 0; cursor: pointer;";const I=document.createElement("span");I.textContent=m.label,h.appendChild(g),h.appendChild(I),s.appendChild(h),o.set(m.value,g)}i.appendChild(r),i.appendChild(s);let l=!1;function u(){l=!l,s.style.display=l?"block":"none"}function c(){l=!1,s.style.display="none"}function d(){if(n.innerHTML="",e.size===0){const m=document.createElement("span");m.textContent="Select",m.style.cssText="color: var(--chc-text-muted, #999); user-select: none;",n.appendChild(m);return}for(const m of e){const h=t.options.find(v=>v.value===m);if(!h)continue;const g=document.createElement("span");g.style.cssText=["display: inline-flex","align-items: center","gap: 4px","padding: 2px 6px","border-radius: 3px","background: var(--chc-status-info, blue)","color: var(--chc-text-inverse, #fff)","font-size: 0.85em","white-space: nowrap"].join("; "),g.textContent=h.label;const I=document.createElement("span");I.textContent="",I.style.cssText="cursor: pointer; margin-left: 2px; font-weight: bold;",I.addEventListener("click",v=>{v.stopPropagation(),e.delete(m);const w=o.get(m);w&&(w.checked=!1),d(),p()}),g.appendChild(I),n.appendChild(g)}}function p(){if(po(t.onChange)){const m=new Event("change",{bubbles:!0});f.dispatchEvent(m),t.onChange(m,t)}}r.addEventListener("click",()=>u()),document.addEventListener("click",m=>{l&&!i.contains(m.target)&&c()});for(const[m,h]of o)h.addEventListener("change",()=>{h.checked?e.add(m):e.delete(m),d(),p()});d();const f=i;return Object.defineProperty(f,"selectedValues",{get:()=>[...e],enumerable:!0}),Object.defineProperty(f,"value",{get:()=>[...e].join(","),enumerable:!0}),{container:i,element:f}}const ik="none";function Mxe(t,e){for(const i of e.options){if(i.hide)continue;const r=document.createElement("option");r.className="font-medium",i.value&&r.setAttribute("value",i.value),(i.selected||e.value===i.value)&&r.setAttribute("selected","true"),i.disabled&&r.setAttribute("disabled","true"),r.innerHTML=i.label,t.appendChild(r)}}function Nxe(t){const e=document.createElement("div");if(e.className="field font-medium",t.class&&e.classList.add(t.class),t.width?e.style.cssText=`width: ${t.width}`:e.style.cssText="flex-grow: 1",t.label&&!t.checkbox){const s=document.createElement("label");s.style.cssText=t.labelStyle||"font-weight: bold; font-size: larger;",s.innerHTML=t.label,e.appendChild(s)}let i,r,n=[];const a=document.createElement("div");if(a.className="control font-medium",t.controlVisible===!1&&(a.style.display=ik),t.controlId&&(a.id=t.controlId),t.text){const s=document.createElement("div");t.id&&(s.id=t.id),s.className="content",s.innerHTML=t.text,a.appendChild(s)}else if(t.radio){const s=document.createElement("div");s.id=t.id,s.className="control";for(const o of t.options??[]){const l=document.createElement("label");l.className="radio";const u=document.createElement("input");o.field&&n.push({input:u,field:o.field}),o.id&&(u.id=o.id),u.name=t.id,u.type="radio",u.value=o.text,o.checked&&(u.checked=!0),po(t.onChange)&&u.addEventListener("change",d=>t.onChange(d,t)),l.appendChild(u),s.appendChild(l);const c=document.createElement("span");c.style.marginLeft=".25em",c.style.marginRight="1em",c.style.color="var(--chc-text-primary)",c.innerHTML=o.text,s.appendChild(c)}a.appendChild(s),i=s}else if(t.options&&t.multiple){const{container:s,element:o}=Cxe(t);t.id&&(s.id=t.id),a.appendChild(s),i=o}else if(t.options){const s=document.createElement("div");s.className="select font-medium",s.style.cssText="width: 100%",t.zIndex&&(s.style.zIndex=t.zIndex);const o=document.createElement("select");if(t.dataPlaceholder&&o.setAttribute("data-placeholder",t.dataPlaceholder),t.dataType&&o.setAttribute("data-type",t.dataType),t.disabled&&(o.disabled=!0),t.id&&(s.id=t.id),o.style.cssText="width: 100%",Mxe(o,t),s.appendChild(o),a.appendChild(s),t.help){const l=document.createElement("p");l.className="help font-medium is-info",l.innerHTML=t.help?.text,l.style.display=t.help?.visible?"":ik,a.appendChild(l)}i=o,po(t.onChange)&&o.addEventListener("change",l=>t.onChange(l,t))}else if(t.checkbox){const s=document.createElement("div");s.className="flexrow nowrap",s.style.display="inline-block";const o=document.createElement("input");po(t.onChange)&&o.addEventListener("change",c=>t.onChange(c,t)),i=o;const l=t.intent??"is-success";o.className=`is-checkradio ${l}`,o.type="checkbox",o.id=t.id,t.checked&&(o.checked=!0),s.appendChild(o);const u=document.createElement("label");u.setAttribute("for",t.id),t.color&&(u.style.color=t.color),u.innerHTML=t.label,s.appendChild(u),a.appendChild(s)}else{const s=document.createElement("input");if(s.className="input font-medium",t.class&&s.classList.add(t.class),s.setAttribute("type",t.type||"text"),s.setAttribute("autocomplete",t.autocomplete||"off"),s.setAttribute("placeholder",t.placeholder||""),t.disabled&&s.setAttribute("disabled","true"),t.id&&s.setAttribute("id",t.id),a.appendChild(s),t.iconLeft){a.classList.add("has-icons-left");const l=document.createElement("span");l.className="icon is-small is-left font-medium";const u=document.createElement("i");u.className=t.iconLeft,l.appendChild(u),a.appendChild(l)}if(t.type==="password"){a.classList.add("has-icons-right");const l=document.createElement("span");l.className="icon is-small is-right font-medium";const u=document.createElement("i");u.className=t.iconRight,l.appendChild(u),a.appendChild(l)}i=s;const o=document.createElement("p");if(o.className="help font-medium",a.appendChild(o),t.validator&&s.addEventListener("input",l=>Rxe(t,l,s,o,t.validator)),t.date){const l=t.maxNumberOfDates||1,u=!t.maxNumberOfDates||l===1;r=new Exe(s,{maxDate:t.maxDate,minDate:t.minDate,format:"yyyy-mm-dd",maxNumberOfDates:l,autohide:u})}else t.typeAhead&&qOe({...t.typeAhead,element:s});po(t.onKeyDown)&&s.addEventListener("keydown",l=>t.onKeyDown(l,t)),po(t.onChange)&&s.addEventListener("change",l=>t.onChange(l,t)),po(t.onInput)&&s.addEventListener("input",l=>t.onInput(l,t)),po(t.onKeyUp)&&s.addEventListener("keyup",l=>t.onKeyUp(l,t)),t.value!==void 0&&(s.value=t.value),t.selectOnFocus&&s.addEventListener("focus",()=>s.select())}return e.appendChild(a),t.visible===!1&&(e.style.display=ik),{field:e,inputElement:i,datepicker:r,subFields:n}}const rk="__BYE__",nk="__QUALIFIER__";function Axe({matchUp:t,side:e,sideNumber:i,eventHandlers:r,composition:n,position:a,currentParticipant:s}){const o=n?.configuration,l=e?.drawPosition,u=()=>{const y=Xn(o?.participantProvider)?o.participantProvider():[],b=o?.persistInputFields;let S=y;b&&s&&(y.some(E=>E.participantId===s.participantId)||(S=[s,...y]));const U=S.map(E=>({label:E.participantName||E.participantId,value:E.participantId})),T=s?.participantId===rk,P=s?.participantId===nk,D=[];return T||D.push({label:" BYE ",value:rk}),o?.hasQualifying&&!P&&D.push({label:" QUALIFIER ",value:nk}),[...D,...U]},c=u(),d=y=>{if(!e)return;if(!y||y.trim()===""){Xn(r?.removeAssignment)&&r.removeAssignment({matchUp:t,side:e,sideNumber:i||1});return}if(y===rk){Xn(r?.assignBye)&&r.assignBye({matchUp:t,side:e,sideNumber:i||1});return}if(y===nk){Xn(r?.assignQualifier)&&r.assignQualifier({matchUp:t,side:e,sideNumber:i||1});return}const b=(Xn(o?.participantProvider)?o.participantProvider():[]).find(S=>S.participantId===y);b&&Xn(r?.assignParticipant)&&r.assignParticipant({matchUp:t,side:e,sideNumber:i||1,participant:b})};let p=!1;const f=()=>{if(p){p=!1;return}const y=Array.from(document.querySelectorAll(".participant-assignment-input input")),b=y.findIndex(S=>S.id===h);if(b!==-1&&b<y.length-1){const S=y[b+1];setTimeout(()=>{S.focus()},100)}},m=a?`-p${a}`:"",h=`assign-${t.matchUpId}-side${i}${m}`,g=s?.participantId,{field:I}=Nxe({typeAhead:{list:c,callback:d,onSelectComplete:f,listProvider:u,currentValue:g},placeholder:a?`Partner ${a}`:"Type participant name...",field:h,id:h,class:"participant-assignment-input"});l&&(I.dataset.drawPosition=l.toString());const v=I.querySelector("input");v&&v.addEventListener("keydown",y=>{y.key==="Tab"&&(p=!0,setTimeout(()=>{p=!1},500))}),I.style.width="100%",I.style.margin="0";const w=o?.assignmentInputFontSize;return w&&(I.style.fontSize=w),setTimeout(()=>{const y=I.querySelector("input");if(y){let b=y.parentElement,S=0;for(;b&&S<15;){const U=window.getComputedStyle(b);(U.overflow!=="visible"||U.overflowX!=="visible"||U.overflowY!=="visible")&&(b.style.setProperty("overflow","visible","important"),b.style.setProperty("overflow-x","visible","important"),b.style.setProperty("overflow-y","visible","important")),b=b.parentElement,S++}}},100),I}const kxe=()=>"chc-seed";function Oxe({className:t,composition:e,side:i}){const r=i?.seedValue==="~"?"":i?.seedValue!==void 0&&i.seedValue||i?.seedNumber;if(!r)return"";const n=e?.configuration||{},{bracketedSeeds:a}=n,s=typeof a=="boolean"&&["(",")"]||a==="square"&&["[","]"]||["",""],o=`${s[0]}${r}${s[1]}`,l=n.seedingElement==="sup"?"sup":"span",u=document.createElement(l);return u.className=t||"",u.innerHTML=o,u}const xxe=t=>hn("chc-scale",t?.color&&`chc-scale--${t.color}`);function Fxe({individualParticipant:t,composition:e,className:i,matchUp:r,spacer:n}){const a=e?.configuration,s=a?.scaleAttributes?.eventType||r?.matchUpType||"SINGLES",o=t?.rankings,l=t?.ratings,u=a?.scaleAttributes,c=u?.scaleType,d=u?.scaleName,p=u?.accessor,f=c==="RATING"?l:o,m=f?.SINGLES?.find(T=>T?.scaleName===d)?.scaleValue,h=f?.DOUBLES?.find(T=>T?.scaleName===d)?.scaleValue,g=m&&p?m[p]:m||"",I=h&&p?h[p]:h||"",v=s==="SINGLES"?g:I,w=a?.scaleAttributes?.fallback,y=!n&&(v||w&&(g||I)),b=document.createElement("span"),S=a?.scaleAttributes?.scaleColor,U=S==="green"||S==="red"?S:void 0;return y&&(b.className=hn(i,xxe(U?{color:U}:{}))),b.innerHTML=y||"",b}var Lxe=Object.defineProperty,dt=(t,e)=>{for(var i in e)Lxe(t,i,{get:e[i],enumerable:!0})};function oM(){return"2.4.6-beta.2"}var z$={};dt(z$,{competitionGovernor:()=>nte,drawsGovernor:()=>cne,entriesGovernor:()=>$le,eventGovernor:()=>zle,generationGovernor:()=>uue,matchUpFormatGovernor:()=>yue,matchUpGovernor:()=>bue,mocksGovernor:()=>aG,participantGovernor:()=>mce,policyGovernor:()=>fle,publishingGovernor:()=>Lce,queryGovernor:()=>vle,rankingGovernor:()=>vG,reportGovernor:()=>Jce,scheduleGovernor:()=>Qce,scoreGovernor:()=>MV,temporalGovernor:()=>Ode,tieFormatGovernor:()=>pde,tournamentGovernor:()=>wde,venueGovernor:()=>upe});var nte={};dt(nte,{getLinkedTournamentIds:()=>mU,getTournamentIds:()=>pU,linkTournaments:()=>sne,mutate:()=>ate,query:()=>une,unlinkTournament:()=>lne,unlinkTournaments:()=>one});var ate={};dt(ate,{linkTournaments:()=>sne,unlinkTournament:()=>lne,unlinkTournaments:()=>one});var pm="SINGLES",zt="SINGLES",_p="DOUBLES",Bt="DOUBLES",La="TEAM",ei="TEAM",_xe={SINGLES_MATCHUP:pm,SINGLES:zt,DOUBLES_MATCHUP:_p,DOUBLES:Bt,TEAM_MATCHUP:La,TEAM:ei},ste={[zt]:[zt,"S"],[Bt]:[Bt,"D"],[ei]:[ei,"T"],S:[zt,"S"],D:[Bt,"D"],T:[ei,"T"]};function nr(t,e){return(t??0)-(e??0)}function Ke(t){return typeof t=="number"?parseInt(t.toString()):typeof t=="string"?parseInt(t):0}function fa(t){return typeof t=="function"}function ni(t){return typeof t=="string"}function wt(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)}function $xe(t,e){if(!wt(t)||!wt(e))return!1;let i=Object.keys(t),r=Object.keys(e);if(i.length!==r.length)return!1;for(let n of i)if(t[n]!==e[n])return!1;return!0}function ote(t,e){return Array.isArray(t)?Object.assign({},...(t??[]).filter(wt).map(i=>i[e]&&{[i[e]]:i}).filter(Boolean)):{}}var Bxe=t=>e=>Object.keys(t).every(i=>e[i]===t[i]);function ix(t,e){if(t===void 0)return null;if(!wt(t)||t===null)return t;let i=Object.keys(t),r=n=>n===void 0?null:n;return Object.assign({},...i.map(n=>Array.isArray(t[n])?{[n]:e?t[n]:t[n].map(a=>ix(a))}:{[n]:e?r(t[n]):ix(t[n])}))}function rx(t){return Array.isArray(t)?t.length+t.map(rx).reduce((e,i)=>e+i,0):wt(t)&&t!==null?Object.keys(t).length+Object.keys(t).map(e=>rx(t[e])).reduce((e,i)=>e+i,0):0}function Vxe(t){if(t===null||typeof t!="object")return;let e=JSON.stringify(t),i=rx(t),r=e.split("").reduce((n,a)=>n+a.charCodeAt(0),0);return[e.length,i,r].map(n=>n.toString(36)).join("")}function Ro(t){return Number.isNaN(Number(t))?!1:t>0&&(t&t-1)===0}function Hz(t){if(!t.length)return;let e=[...t].sort(nr),i=Math.floor(e.length/2);return e.length%2?e[i]:(e[i-1]+e[i])/2}function jxe(t){if(t===1||Number.isNaN(Number(t))||!Ro(t))return!1;let e=t,i=1;for(;e!==2;)i+=1,e=e/2;return i}function q$(t){return Number.isNaN(Number(t))?0:t%2&&t+1||t}function Y$(t){return Math.pow(2,Math.round(Math.log(t)/Math.log(2)))}function Ai(t){return!Number.isNaN(Number.parseFloat(t))}function lte(t){let e=Ke(t);if(!Number.isNaN(e))return e===0?!1:(e&-e)===1}function Cv(t){if(Number.isNaN(Number(t)))return!1;for(;!Ro(t);)t++;return t}function is(t,e){return t=Math.ceil(t),e=Math.floor(e),Math.floor(Math.random()*(e-t+1))+t}function lt(t){return ni(t)&&!t.trim().length?!1:Number.isSafeInteger(typeof t=="string"?+t:t)}function Gxe(t=1,e=3,i=!0){let r=0;for(let n=0;n<e;n++)r+=Math.random()*(t/e);return i&&t>1?Math.round(r):r}function Hxe(t,e){e||(e=1);let i=1/e;return Math.round(t*i)/i}function ute(t,e,i,r,n=2){let a=1-Math.random(),s=1-Math.random(),o=Math.sqrt(-2*Math.log(a))*Math.cos(2*Math.PI*s);return o=o/10+.5,o>1||o<0?o=ute(t,e,i):(o=Math.pow(o,i),o*=e-t,o+=t),r&&(o=Hxe(o,r)),Number.parseFloat(o.toFixed(n))}function AP(t,e=2){return Number.parseFloat(Number(Math.round(t*1e3)/1e3).toFixed(e))}function nt(t){return Array.isArray(t)?t?.filter((e,i,r)=>r.lastIndexOf(e)===i):[]}function Wxe(t){return Array.isArray(t)?t?.map(e=>e===null?void 0:e):t}function Cn(t){return Array.isArray(t)?t.map(e=>[Math.random(),e]).sort((e,i)=>e[0]-i[0]).map(e=>e[1]):[]}function vI(t){return lt(t)?t:1/0}function Sa(t){return Array.isArray(t)?t.reduce((e,i)=>(e[i]||(e[i]=0),e[i]++,e),{}):{}}function zxe(t){return cte(Sa(t))}function cte(t){return Object.keys(t).reduce((e,i)=>{let r=t[i];return e[r]?e[r].push(i):e[r]=[i],e},{})}function qxe(t,e,i){return i.indexOf(t)===e}function dte(t){return t.filter(qxe)}function ha(t){return Array.isArray(t)&&t.length?t.splice(Math.floor(Math.random()*t.length),1)[0]:void 0}function Ns(t){let e=Math.floor(Math.random()*t.length);return t[e]}function Ce(t,e){return Array.from({length:e-t},(i,r)=>r+t)}function Xo(t,e){return e.reduce((i,r,n)=>(r===t&&i.push(n),i),[])}function Li(t,e){return!Array.isArray(t)||!Array.isArray(e)?[]:t.filter(i=>e.indexOf(i)!==-1).filter((i,r,n)=>n.indexOf(i)===r)}function Wz(t,e){return!Array.isArray(t)||!Array.isArray(e)?[]:t.filter(i=>!e.includes(i))}function xn(t,e){return!Array.isArray(t)||!Array.isArray(e)?!1:t.some(i=>e.includes(i))}function Yxe(t,e){return Array.isArray(e)&&e.reduce((i,r)=>(i[r]=1+i[r]||1,i),{})[t]||0}function Kxe(t,e,i,r){return Array.isArray(t)?[].concat(...t.slice(0,e),...t.slice(e,e+i).sort(r),...t.slice(e+i,t.length)):[]}function wr(t,e){return Array.isArray(t)?t.reduce((i,r,n)=>{let a=Math.floor(n/e);return i[a]=[].concat(i[a]||[],r),i},[]):[]}function pte(t,[e,...i]){return t.length?[t.slice(0,e),...pte(t.slice(e),[...i,e])]:[]}function Xxe(t){return t.reduce((e,i)=>{let r=e[e.length-1];return(!r||r[r.length-1]!==i-1)&&e.push([]),e[e.length-1].push(i),e},[])}function fte(t){return Array.isArray(t)?t.reduce((e,i)=>!isNaN(parseInt(i))&&e,!0):!1}function mte(t){return Array.isArray(t)?t.reduce((e,i)=>isNaN(parseInt(i))&&e,!0):!1}function nx(t,e,i){return Array.isArray(t)?t.reduce((r,n,a)=>{let s=i?!!(Math.floor(a/e)%2):!1,o=a%e,l=s?e-1-o:o;return r[l]||(r[l]=[]),r[l].push(n),r},[]):[]}function Jxe(t,e=1){if(!Array.isArray(t)||!t.every(lt))return[];let i=Math.min(...t,e),r=Math.max(...t);return Ce(i,r+1).filter(n=>!t.includes(n))}function fm(t,e){return!Array.isArray(t)||!ni(e)?!1:Li(t,ste[e]).length}var W={success:!0},hte="error",Qxe={SUCCESS:W,ERROR:hte};function gte({collectionValueProfiles:t,matchUpCount:e}){let i=[];if(!Array.isArray(t))return i.push(`collectionValueProfiles is not an array: ${t}`),{errors:i};if(t.length&&t.length!==e)return i.push("collectionValueProfiles do not align with matchUpsCount"),{errors:i};for(let n of t){if(typeof n!="object")return i.push(`valueProfile is not type object: ${n}`),{errors:i};let{matchUpValue:a,collectionPosition:s}=n;if(typeof a!="number"||typeof s!="number"||s>e||s<1)return i.push("Invalid value profile: value and collectionPosition must be numeric. collectionPosition cannot be greater than matchUpCount"),{errors:i}}let r=t.map(n=>n.collectionPosition);return r.length!==nt(r).length?(i.push("collectionPositions are not unique"),{errors:i}):{...W}}var Zxe={};dt(Zxe,{addNotice:()=>st,callListener:()=>mx,createInstanceState:()=>F1e,cycleMutationStatus:()=>SB,deepCopyEnabled:()=>wB,deleteNotice:()=>UB,deleteNotices:()=>rU,disableNotifications:()=>Oie,enableNotifications:()=>bM,getDevContext:()=>la,getMethods:()=>Lie,getNotices:()=>_ie,getProvider:()=>hx,getTopics:()=>bs,getTournamentId:()=>Oh,getTournamentRecord:()=>TB,getTournamentRecords:()=>xh,globalLog:()=>Vie,handleCaughtError:()=>UM,hasTopic:()=>wM,removeTournamentRecord:()=>Bie,setDeepCopy:()=>Vb,setDevContext:()=>Bb,setGlobalLog:()=>kie,setGlobalMethods:()=>xie,setGlobalSubscriptions:()=>_1e,setMethods:()=>Fie,setStateMethods:()=>jie,setStateProvider:()=>x1e,setSubscriptions:()=>$1e,setTournamentId:()=>jb,setTournamentRecord:()=>$ie,setTournamentRecords:()=>SM,timeKeeper:()=>L1e});var ax={message:"Chronological error; time violation.",code:"ANACHRONISM"},_b={message:"Duplicate entry",code:"DUPLICATE_ENTRY"},Ite={message:"Cannot remove main structure",code:"ERR_CANNOT_REMOVE_MAIN_STRUCTURE"},sx={message:"records must be an object with tournamentId keys",code:"ERR_INVALID_TOURNAMENTS"},Mi={message:"Missing tournamentRecords",code:"ERR_MISSING_TOURNAMENTS"},ve={message:"Missing tournamentRecord",code:"ERR_MISSING_TOURNAMENT"},KS={message:"Invalid tournamentRecord",code:"ERR_INVALID_TOURNAMENT"},yI={message:"Missing tournamentId",code:"ERR_MISSING_TOURNAMENT_ID"},mm={message:"Invalid drawDefinition",code:"ERR_INVALID_DRAWDEF"},$e={message:"Missing drawDefinition",code:"ERR_MISSING_DRAWDEF"},vte={message:"Existing drawDefinition(s)",code:"ERR_EXISTING_DRAWDEFS"},_a={message:"drawDefinition not found",code:"ERR_NOT_FOUND_DRAWDEF"},mf={message:"Invalid structure",code:"ERR_INVALID_STRUCTURE"},K$={message:"Incomplete source structure",code:"ERR_INCOMPLETE_STRUCTURE"},X$={message:"Invalid drawPosition for seedAssignment",code:"ERR_INVALID_SEEDING_POSITION"},bI={message:"drawPosition already assigned",code:"ERR_EXISTING_POSITION_ASSIGNMENT"},yte={message:"Schedule not cleared",code:"ERR_UNCHANGED_SCHEDULE_NOT_CLEARED"},bte={message:"Schedule conflict: court slot already occupied",code:"ERR_SCHEDULE_CONFLICT_DOUBLE_BOOKING"},wte={message:"drawPosition not cleared",code:"ERR_FAILURE_POSITION_NOT_CLEARED"},e1e={message:"drawPosition not found",code:"ERR_NOT_FOUND_DRAW_POSITION"},J$={message:"Unrecognized drawType",code:"ERR_UNRECOGNIZED_DRAW_TYPE"},XS={message:"Missing drawPositions",code:"ERR_MISSING_DRAW_POSITIONS"},JS={message:"drawPosition is active",code:"ERR_ACTIVE_DRAW_POSITION"},t1e={message:"drawPosition is occupied",code:"ERR_OCCUPIED_DRAW_POSITION"},Mh={message:"Invlid drawPosition",code:"ERR_INVALID_DRAW_POSITION"},Mv={message:"Missing drawPosition",code:"ERR_MISSING_DRAW_POSITION"},Q$={message:"Invalid drawType",code:"ERR_INVALID_DRAW_TYPE"},lM={message:"Invalid drawSize",code:"ERR_INVALID_DRAW_SIZE"},Ste={message:"Cannot set drawSize to be less than existing entries",code:"ERR_INVALID_DRAW_SIZE_MISMATCH"},QS={message:"Missing drawSize",code:"ERR_MISSING_DRAW_SIZE"},xo={message:"Missing drawId",code:"ERR_MISSING_DRAW_ID"},Ute={message:"drawId exists",code:"ERR_EXISTING_DRAW_ID"},Tte={message:"participantId cannot be assigned to multiple seedNumbers",code:"INVALID_PARTICIPANT_SEEDING"},Dte={message:"seedsCount greater than drawSize",code:"ERR_INVALID_SEED_COUNT"},Pte={message:"Missing seedCountThresholds",code:"ERR_MISSING_SEED_COUNT_THRESHOLD"},Ete={message:"Invalid action",code:"ERR_INVALID_ACTION"},ox={message:"Invalid assignment",code:"ERR_INVALID_ASSIGNMENT"},Rte={message:"Missing seedAssignments",code:"ERR_MISSING_SEED_ASSIGNMENTS"},Cte={message:"Invalid seedNumber",code:"ERR_INVALID_SEED_NUMBER"},Mte={message:"Invalid seedPosition",code:"ERR_INVALID_SEED_POSITION"},Z$={message:"Missing targetLink",code:"ERR_MISSING_LINK_TARGET"},Nte={message:"Existing round",code:"ERR_EXISTING_ROUND"},i1e={message:"Missing roundNumber",code:"ERR_MISSING_ROUND_NUMBER"},qa={message:"Missing structureId",code:"ERR_MISSING_STRUCTURE_ID"},vi={message:"structure not found",code:"ERR_NOT_FOUND_STRUCTURE"},eB={message:"Missing structures",code:"ERR_MISSING_STRUCTURES"},hf={message:"Missing structure",code:"ERR_MISSING_STRUCTURE"},tB={message:"Missing MAIN structure",code:"ERR_MISSING_MAIN_STRUCTURE"},Ate={message:"drawDefinition contains unlinked structures",code:"ERR_MISSING_STRUCTURE_LINKS"},cu={message:"Invalid eventType",code:"ERR_INVALID_EVENT_TYPE"},ui={message:"Missing event / eventId",code:"ERR_MISSING_EVENT_ID"},ps={message:"Event not found",code:"ERR_NOT_FOUND_EVENT"},kte={message:"Event exists",code:"ERR_EXISTING_EVENT"},Ote={message:"Missing entries",code:"ERR_MISSING_ENTRIES"},xte={message:"Invalid entries",code:"ERR_INVALID_ENTRIES"},iB={message:"Missing assignments",code:"ERR_MISSING_ASSIGNMENTS"},Fte={message:"Missing stage",code:"ERR_MISSING_STAGE"},gf={message:"Invalid stage",code:"ERR_INVALID_STAGE"},Lte={message:"stageSequence limit",code:"ERR_LIMIT_STAGE_SEQUENCE"},_te={message:"Missing positionAssignments",code:"ERR_MISSING_POSITION_ASSIGNMENTS"},$te={message:"Cannot Assign BYE status if no assignment: { bye: true }",code:"ERR_UNCHANGED_CANNOT_ASSIGN_BYE"},lx={message:"Unrecognized matchUpStatus",code:"ERR_UNRECOGNIZED_MATCHUP_STATUS"},ZS={message:"Unrecognized matchUpFormat",code:"ERR_UNRECOGNIZED_MATCHUP_FORMAT"},dD={message:"Incompatible matchUpStatus",code:"ERR_INCOMPATIBLE_MATCHUP_STATUS"},r1e={message:"Propagated exits downstream",code:"ERR_PROPAGATED_EXITS_DOWNSTREAM"},Nv={message:"Invalid matchUpStatus",code:"ERR_INVALID_MATCHUP_STATUS"},ql={message:"Invalid tieFormat",code:"ERR_INVALID_TIE_FORMAT"},Bte={message:"Invalid matchUpFormat",code:"ERR_INVALID_MATCHUP_FORMAT"},Vte={message:"Missing matchUpFormat",code:"ERR_MISSING_MATCHUP_FORMAT"},jte={message:"Missing collectionDefinition",code:"ERR_MISSING_COLLECTION_DEFINITION"},Av={message:"Missing tieFormat",code:"ERR_MISSING_TIE_FORMAT"},Tn={message:"Missing matchUpId",code:"ERR_MISSING_MATCHUP_ID"},Nh={message:"Missing matchUpIds",code:"ERR_MISSING_MATCHUP_IDS"},dn={message:"matchUp not found",code:"ERR_NOT_FOUND_MATCHUP"},Nu={message:"Missing matchUps",code:"ERR_MISSING_MATCHUPS"},sa={message:"Missing matchUp",code:"ERR_MISSING_MATCHUP"},oa={message:"Invalid matchUp",code:"ERR_INVALID_MATCHUP"},rB={message:"Missing policyType",code:"ERR_MISSING_POLICY_TYPE"},uM={message:"Missing policyDefinitions",code:"ERR_MISSING_POLICY_DEFINITIONS"},n1e={message:"Missing seeding policy",code:"ERR_MISSING_POLICY_SEEDING"},Gte={message:"Missing avoidance policy",code:"ERR_MISSING_POLICY_AVOIDANCE"},nB={message:"Missing policy attributes",code:"ERR_MISSING_POLICY_ATTRIBUTES"},Hte={message:"Invalid policyDefinitions",code:"ERR_INVALID_POLICY_DEFINITIONS"},aB={message:"existing policyType",code:"ERR_EXISTING_POLICY_TYPE"},a1e={message:"Policy not attached",code:"ERR_FAILURE_POLICY_NOT_ATTACHED"},eU={message:"Policy not found",code:"ERR_NOT_FOUND_POLICY"},s1e={message:"Missing scoring policy / matchUpFormats",code:"ERR_MISSING_POLICY_SCORING_MATCHUP_FORMATS"},Wte={message:"Invalid sideNumber",code:"ERR_INVALID_SIDE_NUMBER"},o1e={message:"Invalid setNumber",code:"ERR_INVALID_SET_NUMBER"},cM={message:"Missing setObject",code:"ERR_MISSING_SET_ATTRIBUTE"},l1e={message:"Missing setNumber",code:"ERR_MISSING_SET_NUMBER"},u1e={message:"Missing sideNumber",code:"ERR_MISSING_SIDE_NUMBER"},Ah={message:"Missing courtId",code:"ERR_MISSING_COURT_ID"},Je={message:"Missing value",code:"ERR_MISSING_VALUE"},zte={message:"Missing birthdate",code:"ERR_MISSING_BIRTH_DATE"},qte={message:"Missing date",code:"ERR_MISSING_DATE"},Yte={message:"No valid dates",code:"ERR_NO_VALID_DATES"},kP={message:"Invalid bookings",code:"ERR_INVALID_BOOKINGS"},pD={message:"Invalid dateAvailability",code:"ERR_INVALID_DATE_AVAILABILITY"},Kte={message:"Missing dateAvailability",code:"ERR_MISSING_DATE_AVAILABILITY"},or={message:"Invalid Date",code:"ERR_INVALID_DATE"},Es={message:"Invalid time",code:"ERR_INVALID_TIME"},Xte={message:"Invalid tournament dates",code:"ERR_INVALID_DATES_TOURNAMENT"},c1e={message:"Missing date range",info:"Event or tournament must have start and end dates",code:"ERR_MISSING_DATE_RANGE"},dM={message:"Invalid Time Zone",code:"ERR_INVALID_TIME_ZONE"},kg={message:"Invalid embargo: must be an ISO 8601 datetime with timezone (Z or HH:MM offset)",code:"ERR_INVALID_EMBARGO"},ux={message:"Invalid game scores",code:"ERR_INVALID_SCORES_GAME"},Jte={message:"Invalid score",code:"ERR_INVALID_SCORE"},pM={message:"Invalid winningSide",code:"ERR_INVALID_WINNING_SIDE"},d1e={message:"No participants generated",code:"ERR_NO_PARTICIPANTS_GENERATED"},sB={message:"Cannot modify tieFormat",code:"ERR_UNCHANGED_CANNOT_MODIFY_TIEFORMAT"},Qte={message:"Cannot modify participantType",code:"ERR_UNCHANGED_CANNOT_MODIFY_PARTICIPANT_TYPE"},fM={message:"Cannot remove participants",code:"ERR_UNCHANGED_CANNOT_REMOVE_PARTICIPANTS"},Zte={message:"Participant category mismatch",code:"ERR_CATEGORY_MISMATCH"},mM={message:"Cannot change winningSide",code:"ERR_UNCHANGED_CANNOT_CHANGE_WINNING_SIDE"},$p={message:"Invalid participant",code:"ERR_INVALID_PARTICIPANT"},Co={message:"Invalid participantId",code:"ERR_INVALID_PARTICIPANT_ID"},Ia={message:"Invalid participantIds",code:"ERR_INVALID_PARTICIPANT_IDS"},eie={message:"Invalid participantRole",code:"ERR_INVALID_PARTICIPANT_ROLE"},Mo={message:"Invalid participantType",code:"ERR_INVALID_PARTICIPANT_TYPE"},tie={message:"Missing participantRole",code:"ERR_MISSING_PARTICIPANT_ROLE"},kh={message:"Missing participant",code:"ERR_MISSING_PARTICIPANT"},tU={message:"Missing participants",code:"ERR_MISSING_PARTICIPANTS"},dr={message:"Missing participantId",code:"ERR_MISSING_PARTICIPANT_ID"},iie={message:"Missing qualified participants",code:"ERR_MISSING_QUALIFIED_PARTICIPANTS"},ji={message:"Participant Not Found",code:"ERR_NOT_FOUND_PARTICIPANT"},rie={message:"participantId exists",code:"ERR_EXISTING_PARTICIPANT_ID"},p1e={message:"participant pair exists",code:"ERR_EXISTING_PARTICIPANT_PAIR"},nie={message:"No participant removed",code:"ERR_UNCHANGED_NO_PARTICIPANT_REMOVED"},Wd={message:"Missing participantIds",code:"ERR_MISSING_PARTICIPANT_IDS"},aie={message:"Missing participantsCount",code:"ERR_MISSING_PARTICIPANT_COUNT"},sie={message:"Participant not checked in",code:"ERR_UNCHANGED_PARTICIPANT_NOT_CHECKED_IN"},oie={message:"Missing person details",code:"ERR_MISSING_PERSON_DETAILS"},kv={message:"Existing participant drawPosition assignment",code:"ERR_EXISTING_PARTICIPANT_DRAW_POSITION_ASSIGNMENT"},hM={message:"Existing participant",code:"ERR_EXISTING_PARTICIPANT"},oB={message:"participantsCount exceeds drawSize",code:"ERR_INVALID_PARTICIPANT_COUNT"},cx={message:"Invalid entry status",code:"ERR_INVALID_ENTRY_STATUS"},lie={message:"Participant Entry Not Found",code:"ERR_NOT_FOUND_PARTICIPANT_ENTRY"},f1e={message:"Participant not entered in stage",code:"ERR_UNCHANGED_PARTICIPANT_NOT_ENTERED"},m1e={message:"Participant not found in stageSequence",code:"ERR_NOT_FOUND_PARTICIPANT_IN_STAGE"},uie={message:"entryStatus not allowed in stage",code:"ERR_INVALID_ENTRY_STATUS_IN_STAGE"},cie={message:"entryStatus not allowed for event",code:"ERR_INVALID_ENTRY_STATUS_IN_EVENT"},dx={message:"No stage space available for entryStatus",code:"ERR_UNCHANGED_NO_AVAILABLE_STAGE_SPACE"},lB={message:"Insufficient drawPositions to accommodate qualifiers",code:"ERR_UNCHANGED_NO_DRAW_POSITIONS_FOR_QUALIFIERS"},uB={message:"Insufficient drawPositions to accommodate entries",code:"ERR_INSUFFICIENT_DRAW_POSITIONS"},die={message:"Missing penaltyType",code:"ERR_MISSING_PENALTY_TYPE"},cB={message:"Missing penaltyId",code:"ERR_MISSING_PENALTY_ID"},wI={message:"Penalty not found",code:"ERR_NOT_FOUND_PENALTY"},pie={message:"Missing courtsCount/courtNames",code:"ERR_MISSING_COURTS_INFO"},vc={message:"Court not found",code:"ERR_NOT_FOUND_COURT"},fie={message:"Court exists",code:"ERR_EXISTING_COURT"},px={message:"Booking not found",code:"ERR_NOT_FOUND_BOOKING"},mie={message:"Existing matchUps conflict with booking",code:"ERR_EXISTING_MATCHUPS"},hie={message:"Venue exists",code:"ERR_EXISTING_VENUE"},If={message:"Venue not found",code:"ERR_NOT_FOUND_VENUE"},zd={message:"Missing venueId",code:"ERR_MISSING_VENUE_ID"},gie={message:"Invalid endTime",code:"ERR_INVALID_END_TIME"},dB={message:"Existing endTime",code:"ERR_EXISTING_END_TIME"},Iie={message:"Invalid stopTime",code:"ERR_INVALID_STOP_TIME"},vie={message:"Invalid startTime",code:"ERR_INVALID_START_TIME"},h1e={message:"Invalid resumeTime",code:"ERR_INVALID_RESUME_TIME"},pB={message:"Invalid timeItem",code:"ERR_INVALID_TIME_ITEMS"},yie={message:"Missing async state provider",code:"ERR_MISSING_ASYNC_STATE_PROVIDER"},fB={message:"Missing timeItem",code:"ERR_MISSING_TIME_ITEM"},mB={message:"Missing timeItems",code:"ERR_MISSING_TIME_ITEMS"},gM={message:"Missing context",code:"ERR_MISSING_CONTEXT"},bie={message:"Missing schedule",code:"ERR_MISSING_SCHEDULE"},$m={message:"Invalid scaleItem",code:"ERR_INVALID_SCALE_ITEM"},wie={message:"Modifications failed",code:"ERR_FAILURE_MODIFICATIONS"},Ov={message:"No modifications applied",code:"ERR_UNCHANGED_NO_MODIFICATIONS_APPLIED"},Sie={message:"Unable to assign court",code:"ERR_UNCHANGED_COURT_NOT_ASSIGNED"},IM={message:"No Candidates",code:"ERR_UNCHANGED_NO_CANDIDATES"},Uie={message:"Invalid configuration",code:"ERR_INVALID_CONFIG"},Tie={message:"Invalid collectionDefinition",code:"ERR_INVALID_COLLECTION_DEFINITION"},Bc={message:"Invalid object",code:"ERR_INVALID_OBJECT"},zy={message:"Invalid gender",code:"ERR_INVALID_GENDER"},$b={message:"Invalid category",code:"ERR_INVALID_CATEGORY"},re={message:"Invalid values",code:"ERR_INVALID_VALUES"},Die={message:"Duplicate value",code:"ERR_DUPLICATE_VALUE"},hB={message:"Team not found",code:"ERR_NOT_FOUND_TEAM"},Pie={message:"No valid actions",code:"ERR_NO_VALID_ACTIONS"},vM={message:"No valid attributes",code:"ERR_NO_VALID_ATTRIBUTES"},gB={message:"Value unchanged",code:"ABORT_UNCHANGED"},Br={message:"Not found",code:"ERR_NOT_FOUND"},IB={message:"Not implemented",code:"ERR_NOT_IMPLEMENTED"},Eie={message:"Existing flight",code:"ERR_EXISTING_FLIGHT"},vB={message:"Existing flight profile",code:"ERR_EXISTING_FLIGHT_PROFILE"},Rie={message:"Existing outcome",code:"ERR_EXISTING_OUTCOME"},Cie={message:"Existing matchUpId",code:"ERR_EXISTING_MATCHUP_ID"},fx={message:"Existing stage",code:"ERR_EXISTING_STAGE"},yB={message:"Existing structure",code:"ERR_EXISTING_STRUCTURE"},yM={message:"Method not found",code:"ERR_NOT_FOUND_METHOD"},Mie={message:"Scheduled matchUps",code:"ERR_SCHEDULED_MATCHUPS"},iU={message:"Scores present",code:"ERR_SCORES_PRESENT"},g1e={ANACHRONISM:ax,BOOKING_NOT_FOUND:px,CANNOT_CHANGE_WINNING_SIDE:mM,CANNOT_MODIFY_TIEFORMAT:sB,CANNOT_MODIFY_PARTICIPANT_TYPE:Qte,CANNOT_REMOVE_MAIN_STRUCTURE:Ite,CANNOT_REMOVE_PARTICIPANTS:fM,CATEGORY_MISMATCH:Zte,COURT_EXISTS:fie,COURT_NOT_FOUND:vc,EXISTING_MATCHUPS:mie,DRAW_DEFINITION_NOT_FOUND:_a,DRAW_ID_EXISTS:Ute,DRAW_POSITION_ACTIVE:JS,DRAW_POSITION_ASSIGNED:bI,DRAW_POSITION_NOT_CLEARED:wte,DRAW_POSITION_NOT_FOUND:e1e,DRAW_SIZE_MISMATCH:Ste,DUPLICATE_ENTRY:_b,DUPLICATE_VALUE:Die,ENTRY_STATUS_NOT_ALLOWED_FOR_EVENT:cie,ENTRY_STATUS_NOT_ALLOWED_IN_STAGE:uie,EVENT_EXISTS:kte,EVENT_NOT_FOUND:ps,EXISTING_DRAW_DEFINITIONS:vte,EXISTING_END_TIME:dB,EXISTING_FLIGHT:Eie,EXISTING_MATCHUP_ID:Cie,EXISTING_OUTCOME:Rie,EXISTING_PARTICIPANT_DRAW_POSITION_ASSIGNMENT:kv,EXISTING_PARTICIPANT:hM,EXISTING_POLICY_TYPE:aB,EXISTING_PROFILE:vB,EXISTING_ROUND:Nte,EXISTING_STAGE:fx,EXISTING_STRUCTURE:yB,INCOMPATIBLE_MATCHUP_STATUS:dD,INCOMPLETE_SOURCE_STRUCTURE:K$,INSUFFICIENT_DRAW_POSITIONS:uB,INVALID_ACTION:Ete,INVALID_ASSIGNMENT:ox,INVALID_BOOKINGS:kP,INVALID_CATEGORY:$b,INVALID_COLLECTION_DEFINITION:Tie,INVALID_CONFIGURATION:Uie,INVALID_DATE_AVAILABILITY:pD,INVALID_DATE:or,INVALID_DRAW_DEFINITION:mm,INVALID_DRAW_POSITION_FOR_SEEDING:X$,INVALID_DRAW_POSITION:Mh,INVALID_DRAW_SIZE:lM,INVALID_END_TIME:gie,INVALID_ENTRIES:xte,INVALID_EVENT_TYPE:cu,INVALID_GAME_SCORES:ux,INVALID_GENDER:zy,INVALID_MATCHUP_FORMAT:Bte,INVALID_MATCHUP_STATUS:Nv,INVALID_MATCHUP_STATUS_BYE:$te,INVALID_MATCHUP:oa,INVALID_OBJECT:Bc,INVALID_PARTICIPANT_ID:Co,INVALID_PARTICIPANT_IDS:Ia,INVALID_PARTICIPANT_ROLE:eie,INVALID_PARTICIPANT_SEEDING:Tte,INVALID_PARTICIPANT_TYPE:Mo,INVALID_PARTICIPANT:$p,INVALID_POLICY_DEFINITION:Hte,INVALID_RECORDS:sx,INVALID_SCALE_ITEM:$m,INVALID_SEED_NUMBER:Cte,INVALID_SEED_POSITION:Mte,INVALID_SET_NUMBER:o1e,INVALID_SIDE_NUMBER:Wte,INVALID_SCORE:Jte,INVALID_STAGE:gf,INVALID_START_TIME:vie,INVALID_STRUCTURE:mf,INVALID_STOP_TIME:Iie,INVALID_TIE_FORMAT:ql,INVALID_TIME:Es,INVALID_TIME_ITEM:pB,INVALID_TOURNAMENT_DATES:Xte,INVALID_TOURNAMENT_RECORD:KS,INVALID_VALUES:re,INVALID_WINNING_SIDE:pM,MATCHUP_NOT_FOUND:dn,METHOD_NOT_FOUND:yM,MISSING_ASSIGNMENTS:iB,MISSING_ASYNC_STATE_PROVIDER:yie,MISSING_AVOIDANCE_POLICY:Gte,MISSING_BIRTH_DATE:zte,MISSING_COLLECTION_DEFINITION:jte,MISSING_COURT_ID:Ah,MISSING_COURTS_INFO:pie,MISSING_DATE_AVAILABILITY:Kte,MISSING_DATE:qte,MISSING_DRAW_DEFINITION:$e,MISSING_DRAW_ID:xo,MISSING_DRAW_POSITION:Mv,MISSING_DRAW_POSITIONS:XS,MISSING_DRAW_SIZE:QS,MISSING_ENTRIES:Ote,MISSING_EVENT:ui,MISSING_QUALIFIED_PARTICIPANTS:iie,MISSING_MATCHUP_FORMAT:Vte,MISSING_MATCHUP_ID:Tn,MISSING_MATCHUP_IDS:Nh,MISSING_MATCHUP:sa,MISSING_MATCHUPS:Nu,MISSING_PARTICIPANT_COUNT:aie,MISSING_PARTICIPANT_ID:dr,MISSING_PARTICIPANT_IDS:Wd,MISSING_PARTICIPANT_ROLE:tie,MISSING_PARTICIPANT:kh,MISSING_PARTICIPANTS:tU,MISSING_PENALTY_ID:cB,MISSING_PENALTY_TYPE:die,MISSING_PERSON_DETAILS:oie,MISSING_POLICY_ATTRIBUTES:nB,MISSING_POLICY_DEFINITION:uM,MISSING_POLICY_TYPE:rB,MISSING_POSITION_ASSIGNMENTS:_te,MISSING_ROUND_NUMBER:i1e,MISSING_SCHEDULE:bie,MISSING_SCORING_POLICY:s1e,MISSING_SEED_ASSIGNMENTS:Rte,MISSING_SEEDCOUNT_THRESHOLDS:Pte,MISSING_SEEDING_POLICY:n1e,MISSING_SET_NUMBER:l1e,MISSING_SET_OBJECT:cM,MISSING_SIDE_NUMBER:u1e,MISSING_STAGE:Fte,MISSING_STRUCTURE_ID:qa,MISSING_STRUCTURE:hf,MISSING_MAIN_STRUCTURE:tB,MISSING_STRUCTURES:eB,MISSING_TARGET_LINK:Z$,MISSING_TIE_FORMAT:Av,MISSING_TIME_ITEM:fB,MISSING_TIME_ITEMS:mB,MISSING_TOURNAMENT_ID:yI,MISSING_TOURNAMENT_RECORD:ve,MISSING_TOURNAMENT_RECORDS:Mi,MISSING_VALUE:Je,MISSING_VENUE_ID:zd,MODIFICATIONS_FAILED:wie,NO_CANDIDATES:IM,NO_DRAW_POSITIONS_AVAILABLE_FOR_QUALIFIERS:lB,NO_MODIFICATIONS_APPLIED:Ov,NO_STAGE_SPACE_AVAILABLE_FOR_ENTRY_STATUS:dx,NO_PARTICIPANT_REMOVED:nie,NO_VALID_ACTIONS:Pie,NO_VALID_ATTRIBUTES:vM,NO_VALID_DATES:Yte,NOT_FOUND:Br,NOT_IMPLEMENTED:IB,PARTICIPANT_COUNT_EXCEEDS_DRAW_SIZE:oB,PARTICIPANT_ID_EXISTS:rie,PARTICIPANT_NOT_CHECKED_IN:sie,PARTICIPANT_NOT_FOUND:ji,PARTICIPANT_PAIR_EXISTS:p1e,PENALTY_NOT_FOUND:wI,POLICY_NOT_ATTACHED:a1e,POLICY_NOT_FOUND:eU,SCHEDULE_NOT_CLEARED:yte,SCHEDULE_CONFLICT_DOUBLE_BOOKING:bte,SCHEDULED_MATCHUPS:Mie,SCORES_PRESENT:iU,SEEDSCOUNT_GREATER_THAN_DRAW_SIZE:Dte,STAGE_SEQUENCE_LIMIT:Lte,STRUCTURE_NOT_FOUND:vi,TEAM_NOT_FOUND:hB,UNABLE_TO_ASSIGN_COURT:Sie,UNLINKED_STRUCTURES:Ate,UNRECOGNIZED_DRAW_TYPE:J$,UNRECOGNIZED_MATCHUP_FORMAT:ZS,UNRECOGNIZED_MATCHUP_STATUS:lx,VALUE_UNCHANGED:gB,VENUE_EXISTS:hie},gi={disableNotifications:!1,tournamentId:void 0,tournamentRecords:{},subscriptions:{},modified:!1,methods:{},notices:[]},Nie={addNotice:R1e,callListener:k1e,cycleMutationStatus:E1e,deleteNotice:N1e,deleteNotices:M1e,disableNotifications:I1e,enableNotifications:v1e,getMethods:bB,getNotices:C1e,getTopics:A1e,getTournamentId:Aie,getTournamentRecord:y1e,getTournamentRecords:b1e,removeTournamentRecord:T1e,setMethods:P1e,setSubscriptions:D1e,setTournamentId:S1e,setTournamentRecord:w1e,setTournamentRecords:U1e,handleCaughtError:O1e};function I1e(){gi.disableNotifications=!0}function v1e(){gi.disableNotifications=!1}function Aie(){return gi.tournamentId}function y1e(t){return gi.tournamentRecords[t]}function b1e(){return gi.tournamentRecords}function w1e(t){let e=t?.tournamentId;return e?(gi.tournamentRecords[e]=t,{success:!0}):{error:KS}}function S1e(t){return t?gi.tournamentRecords[t]?(gi.tournamentId=t,{success:!0}):{error:ve}:(gi.tournamentId=void 0,{success:!0})}function U1e(t){gi.tournamentRecords=t;let e=Object.keys(t);e.length===1?gi.tournamentId=e[0]:e.length||(gi.tournamentId=void 0)}function T1e(t){if(typeof t!="string")return{error:re};if(!gi.tournamentRecords[t])return{error:Br};delete gi.tournamentRecords[t];let e=Object.keys(gi.tournamentRecords);return e.length===1?gi.tournamentId=e[0]:e.length||(gi.tournamentId=void 0),{success:!0}}function D1e(t){return t.subscriptions===null||Object.keys(t.subscriptions).length===0?(gi.subscriptions={},{...W}):typeof t.subscriptions!="object"?{error:re}:(Object.keys(t.subscriptions).forEach(e=>{typeof t.subscriptions[e]=="function"?gi.subscriptions[e]=t.subscriptions[e]:delete gi.subscriptions[e]}),{...W})}function P1e(t){return typeof t!="object"?{error:re}:(Object.keys(t).forEach(e=>{typeof t[e]=="function"&&(gi.methods[e]=t[e])}),{...W})}function E1e(){let t=gi.modified;return gi.modified=!1,t}function R1e({topic:t,payload:e,key:i},r){if(!(typeof t!="string"||typeof e!="object")&&(gi.disableNotifications||(gi.modified=!0),!(gi.disableNotifications||!gi.subscriptions[t]&&!r)))return i&&(gi.notices=gi.notices.filter(n=>!(n.topic===t&&n.key===i))),gi.notices.push({topic:t,payload:e,key:i}),{...W}}function bB(){return gi.methods??{}}function C1e({topic:t}){return gi.notices.filter(e=>e.topic===t).map(e=>e.payload)}function M1e(){gi.notices=[]}function N1e({topic:t,key:e}){gi.notices=gi.notices.filter(i=>(!t||i.topic===t)&&i.key!==e)}function A1e(){return{topics:Object.keys(gi.subscriptions)}}function k1e({topic:t,notices:e},i){let r=gi.subscriptions[t];r&&typeof r=="function"&&r(e);let n=i?.[t];n&&typeof n=="function"&&n(e)}function O1e({engineName:t,methodName:e,params:i,err:r}){let n;return typeof r=="string"?n=r.toUpperCase():r instanceof Error&&(n=r.message),console.log("ERROR",{tournamentId:Aie(),params:JSON.stringify(i),engine:t,methodName:e,error:n}),{error:n}}var Jt={timers:{default:{elapsedTime:0}},globalSubscriptions:{},deepCopyAttributes:{stringify:[],ignore:[],toJSON:[]},globalMethods:[],deepCopy:!0},Ar=Nie,zz=["addNotice","callListener","cycleMutationStatus","deleteNotice","deleteNotices","disableNotifications","enableNotifications","getMethods","getNotices","getTopics","getTournamentId","getTournamentRecord","getTournamentRecords","removeTournamentRecord","setSubscriptions","setTournamentId","setTournamentRecord","setTournamentRecords"];function x1e(t){if(typeof t!="object")throw new Error("Global state provider can not be undefined or null");if(Li(Object.keys(t),zz).length!==zz.length)throw new Error("Global state provider is missing required methods");return Ar=t,{success:!0}}function F1e(){if(Ar.createInstanceState){try{Ar.createInstanceState()}catch(t){return{error:t}}return{success:!0}}else return{error:yie}}function la(t){return!t||typeof t!="object"?Jt.devContext??!1:typeof Jt.devContext!="object"?!1:Object.keys(t).every(e=>Jt.devContext?.[e]===t[e])&&Jt.devContext}function L1e(t="reset",e="default"){let i=Date.now();if(t==="report"){if(e==="allTimers")return Object.keys(Jt.timers).filter(r=>r!=="default"||Jt.timers[r].startTime).map(r=>{let n=Jt.timers[r],a=n.state==="stopped"?0:(i-(n?.startTime??0))/1e3,s=n.elapsedTime+a;return{state:Jt.timers[r].state,elapsedTime:s.toFixed(2),timer:r}});{let r=Jt.timers[e].state==="stopped"?0:(i-(Jt.timers[e]?.startTime??0))/1e3,n=Jt.timers[e].elapsedTime+r;return{state:Jt.timers[e].state,elapsedTime:n.toFixed(2),timer:e}}}if(!Jt.timers[e]||t==="reset"){if(e==="allTimers")return Jt.timers={default:{elapsedTime:0}},!0;Jt.timers[e]={startTime:i,state:"active",elapsedTime:0}}return Jt.timers[e].elapsedTime||(Jt.timers[e].elapsedTime=0),t==="stop"&&Jt.timers[e].state!=="stopped"&&(Jt.timers[e].state="stopped")&&(Jt.timers[e].elapsedTime+=(i-(Jt.timers[e]?.startTime??0))/1e3),t==="start"&&(Jt.timers[e].startTime=i)&&(Jt.timers[e].state="active"),Jt.timers[e]}function kie(t){fa(t)?Jt.globalLog=t:delete Jt.globalLog}function Bb(t){Jt.devContext=t}function Oie(){Ar.disableNotifications()}function bM(){Ar.enableNotifications()}function Vb(t,e){typeof t=="boolean"&&(Jt.deepCopy=t),typeof e=="object"&&(Array.isArray(e.ignore)&&(Jt.deepCopyAttributes.ignore=e.ignore),Array.isArray(e.toJSON)&&(Jt.deepCopyAttributes.toJSON=e.toJSON),Array.isArray(e.stringify)&&(Jt.deepCopyAttributes.stringify=e.stringify),e.threshold&&(Jt.deepCopyAttributes.threshold=e.threshold))}function wB(){return{enabled:Jt.deepCopy,...Jt.deepCopyAttributes}}function _1e(t){return t?.subscriptions?(Object.keys(t.subscriptions).forEach(e=>{Jt.globalSubscriptions[e]=t.subscriptions[e]}),{...W}):{error:Je,info:"missing subscriptions"}}function $1e(t){return t?.subscriptions?Ar.setSubscriptions({subscriptions:t.subscriptions}):{error:Je,info:"missing subscriptions"}}function xie(t){return t?typeof t!="object"?{error:re}:(Object.keys(t).forEach(e=>{fa(t[e])&&(Jt.globalMethods[e]=t[e])}),{...W}):{error:Je,info:"missing method declarations"}}function Fie(t){return t?typeof t!="object"?{error:re}:Ar.setMethods(t):{error:Je,info:"missing method declarations"}}function SB(){return Ar.cycleMutationStatus()}function st(t){if(typeof t?.topic!="string")return;let e=Jt.globalSubscriptions[t.topic];return Ar.addNotice(t,e)}function Lie(){return{...Jt.globalMethods,...Ar.getMethods()}}function _ie(t){return Ar.getNotices(t)}function UB({key:t,topic:e}){return Ar.deleteNotice({key:t,topic:e})}function rU(){return Ar.deleteNotices()}function bs(){return Ar.getTopics()}function wM(t){return bs()?.topics?.includes(t)}async function mx(t){return Ar.callListener(t,Jt.globalSubscriptions)}function Oh(){return Ar.getTournamentId()}function TB(t){return Ar.getTournamentRecord(t)}function xh(){return Ar.getTournamentRecords()}function $ie(t){return Ar.setTournamentRecord(t)}function SM(t){return Ar.setTournamentRecords(t)}function jb(t){return Ar.setTournamentId(t)}function Bie(t){return Ar.removeTournamentRecord(t)}function hx(){return Ar}function UM({engineName:t,methodName:e,params:i,err:r}){let n=fa(Ar.handleCaughtError)&&Ar.handleCaughtError||Nie.handleCaughtError,{tournamentRecord:a,...s}=i;return n({params:s,engineName:t,methodName:e,err:r})}function Vie(t,e){if(Jt.globalLog)try{Jt.globalLog({log:t,engine:e})}catch(i){console.log("globalLog error",i),console.log(e,t),kie()}else console.log(e,t)}function jie(t,e,i,r){if(!wt(t))return{error:re};Ai||(i=1);let n=Array.isArray(e)?e:[],a={},s=(o,l=0)=>{Object.keys(o).forEach(u=>{fa(o[u])?a[u]=o[u]:wt(o[u])&&(e===!0||n?.includes(u))&&(i===void 0||l<i)&&s(o[u],l+1)})};return s(t),r?xie(a):Fie(a),{methods:a}}function B1e(t,e,i){return Object.keys(t).filter(r=>!e.includes(t[r])&&(!i||(Array.isArray(t[r])?t[r].length:!0)))}function je(t,e,i,r){if(typeof t!="object"||t===null)return t;wB()?.enabled||(r=!0);let n=["",void 0,null];e&&n.push(!1);let a=B1e(t,n,i);return Object.assign({},...a.map(s=>Array.isArray(t[s])?{[s]:r?t[s]:t[s].map(o=>je(o))}:{[s]:r?t[s]:je(t[s])}))}function q({context:t,result:e,stack:i,info:r}){return e&&!Array.isArray(e?.stack)&&(e.stack=[]),e&&Array.isArray(e?.stack)&&typeof i=="string"&&e.stack.push(i),e&&r&&(e.info=r),e&&typeof t=="object"&&Object.keys(t).length&&(e.context||(e.context={}),Object.assign(e.context,je(t))),e&&!e?.error&&!e?.success&&Object.assign(e,{...W}),e??{success:!0}}var zr="FEMALE",zu="OTHER",Fh="MIXED",tr="MALE",DB={FEMALE_ABBR:"F",OTHER_ABBR:"O",MIXED_ABBR:"X",MALE_ABBR:"M",ANY_ABBR:"A",FEMALE:zr,MIXED:Fh,OTHER:zu,MALE:tr,ANY:"ANY"};function cp(t){return[zr,"F"].includes(t)}function Kf(t){return[tr,"M"].includes(t)}function Aa(t){return[Fh,"X"].includes(t)}function du(t){return["ANY","A"].includes(t)}function ln(t){if(t){if(cp(t))return zr;if(Aa(t))return Fh;if(Kf(t))return tr;if(du(t))return"ANY"}return zu}function cl(t){return cp(t)||Kf(t)}var V1e="MIXED events can not contain mixed singles or { gender: ANY } collections",j1e="events with { gender: ANY } can not contain MIXED singles collections";function TM(t){let e="tieFormatGenderValidityCheck",{referenceGender:i,matchUpType:r,gender:n}=t;return i&&n&&cl(i)&&ln(i)!==ln(n)?q({result:{valid:!1,error:zy},context:{gender:n},stack:e}):Aa(i)&&(du(n)||Aa(n)&&r!==Bt)?q({result:{error:zy,valid:!1},info:V1e,stack:e}):du(i)&&Aa(n)&&r!==Bt?q({result:{error:zy,valid:!1},info:j1e,stack:e}):{valid:!0}}var G1e="normal",qz="timed",H1e="final",PB="NOAD",Gie=["SET","HAL","QTR","PER","INN","RND","FRM","MAP","MAT"],Hie="CONSECUTIVE",Wie="TRADITIONAL",W1e={S:G1e,F:H1e,G:"game"};function DM(t,e){if(wt(t)&&(t?.bestOf||t?.exactly)&&t?.setFormat)return q1e(t,e)}function Gb(t){return!Number.isNaN(Number(t))&&Number(t)}function zie(t){let e=`T${t.minutes}`;return t.based==="P"&&(e+="P"),t.tiebreakFormat?.tiebreakTo&&(e+=`/TB${t.tiebreakFormat.tiebreakTo}`),t.modifier&&(e+=`@${t.modifier}`),e}function z1e(t){let e=t?.deuceAfter?`${t.deuceAfter}D`:"";if(t?.type===Wie)return`TN${e}`;if(t?.type===Hie&&Number.isInteger(t.count))return`${t.count}C${e}`}function q1e(t,e){let i=Gb(t.bestOf)||void 0,r=Gb(t.exactly)||void 0,n=i||r;if(t.setFormat?.timed&&t.simplified&&n===1)return zie(t.setFormat);let a=t.matchRoot||"SET",s=r&&r!==1?"X":"",o=t.aggregate?"A":"",l=n&&`${a}${n}${s}${o}`||"",u=Yz(t.setFormat,e),c=u&&`S:${u}`||"",d=Yz(t.finalSetFormat,e),p=n&&n>1&&d&&u!==d&&`F:${d}`||"",f=t.gameFormat?`G:${z1e(t.gameFormat)}`:"";if(l&&u)return[l,c,f,p].filter(Boolean).join("-")}function Yz(t,e){if(typeof t=="object"&&Object.keys(t).length){if(t.timed)return zie(t);if(t.tiebreakSet)return Kz(t.tiebreakSet);let i=Gb(t.setTo);if(i){let r=t.NoAD&&PB||"",n=Kz(t.tiebreakFormat),a=n&&`/${n}`||"",s=Gb(t.tiebreakAt),o=s&&(s!==i||e)&&`@${s}`||"";if(n!==!1)return`${i}${r}${a}${o}`}}}function Kz(t){if(t){if(typeof t=="object"&&!t.tiebreakTo)return"";if(typeof t=="object"&&Gb(t.tiebreakTo)){let e=`TB${t.tiebreakTo}${t.NoAD?PB:""}`;return t.modifier&&(e+=`@${t.modifier}`),e}else return!1}}function qi(t){if(ni(t)){let e=t.startsWith("T")&&qz||Gie.some(i=>t.startsWith(i))&&"SET"||"";if(e===qz){let i=Kie(t),r={simplified:!0,setFormat:i,bestOf:1};if(i)return r}if(e==="SET")return X1e(t)}}function Y1e(t){let e=Gie.find(u=>t.startsWith(u));if(!e)return;let i=t.slice(e.length),r=/^(\d+)([A-Z]*)$/.exec(i);if(!r)return;let n=SI(r[1]);if(!n)return;let a=r[2],s=!1,o=!1,l=[];for(let u of a)u==="X"?s=!0:u==="A"?o=!0:l.push(u);return{matchRoot:e,count:n,exactly:s,aggregate:o,matchMods:l}}function K1e(t){let e=/^(.+?)(\d+D)$/.exec(t),i=e?e[1]:t,r=e?Number(e[2].slice(0,-1)):void 0;if(r!==void 0&&(r<1||!Number.isInteger(r)))return;if(i==="TN"){let a={type:Wie};return r&&(a.deuceAfter=r),a}let n=/^([1-9]\d*)C$/.exec(i);if(n){let a={type:Hie,count:Number(n[1])};return r&&(a.deuceAfter=r),a}}function X1e(t){let e=t.split("-"),i=Y1e(e[0]);if(!i)return;let{matchRoot:r,count:n,exactly:a,aggregate:s,matchMods:o}=i,l=a&&n!==1?void 0:n,u=a&&n!==1?n:void 0,c,d,p,f=0,m=0,h=0;for(let v=1;v<e.length;v++){let w=e[v].indexOf(":");if(w<0)return;let y=e[v].slice(0,w),b=e[v].slice(w+1);if(!(y in W1e))return;if(y==="S"){if(f++,f>1)return;c=Xz(e[v],b)}else if(y==="F"){if(m++,m>1)return;d=Xz(e[v],b)}else if(y==="G"&&(h++,h>1||(p=K1e(b),!p)))return}let g=c&&c.timed||d&&d.timed;if(r==="SET"&&!(l&&l<6||g&&u)||!c||!(!d||d))return;let I=je({setFormat:c,exactly:u,bestOf:l});return r!=="SET"&&(I.matchRoot=r),s&&(I.aggregate=!0),o.length>0&&(I.matchMods=o),d&&(I.finalSetFormat=d),p&&(I.gameFormat=p),I}function Xz(t,e){return e.startsWith("TB")?J1e(e):e.startsWith("T")?Kie(e):Q1e(t,e)}function J1e(t){let e=Yie(t);return e===!1?!1:typeof e=="object"?{tiebreakSet:e}:void 0}function Q1e(t,e){let i=/^[FS]:(\d+)([A-Za-z]*)/.exec(t),r=i&&Xie(i[2])||!1,n=!i?.[2]||r,a=i?SI(i[1]):void 0,s=qie(e),o=s!==!1,l=o&&s||a,u=Yie(e.split("/")[1]);return!a||!n||u===!1||!o?!1:Z1e(a,r,u,l)}function Z1e(t,e,i,r){let n={setTo:t};return e&&(n.NoAD=!0),i?(n.tiebreakFormat=i,n.tiebreakAt=r):n.noTiebreak=!0,n}function qie(t,e=!0){let i=t?.indexOf("@")>0&&t.split("@");if(i)return(e?SI(i[1]):i[1])||!1}function Yie(t){if(t)return t.startsWith("TB")?eFe(t):!1}function eFe(t){let e=qie(t,!1),i=/^TB(\d+)([A-Za-z]*)/.exec(t),r=i?.[1],n=i&&Xie(i[2]),a=!i?.[2]||n,s=SI(r);if(!s||!a)return!1;let o={tiebreakTo:s};return e&&typeof e=="string"&&!lt(e)&&(o.modifier=e),n&&(o.NoAD=!0),o}function Kie(t){let e=t.slice(1),i=/^(\d+)([PG])?(?:\/TB(\d+))?(@[A-Za-z]+)?$/.exec(e),r=SI(i?.[1]);if(!r)return;let n={timed:!0,minutes:r},a=i?.[2];a==="P"?n.based="P":a==="G"&&(n.based="G");let s=i?.[3];if(s){let u=SI(s);u&&(n.tiebreakFormat={tiebreakTo:u})}let o=i?.[4],l=[void 0,"P","G",""].includes(o);if(o&&!l){let u=/^(\d+)([PGA])?(?:\/TB\d+)?(@)([A-Za-z]+)$/.exec(e)?.[4];return u?(n.modifier=u,n):void 0}return o&&(n.based=o),n}function Xie(t){return t?.includes(PB)}function SI(t){let e=Number(t);return Number.isNaN(e)?0:e}function tFe(t){return t.replaceAll(/T(\d+)G(?=\/TB|@|-|$)/g,"T$1")}function $a({matchUpFormat:t}){if(!ni(t)||t==="")return!1;let e=qi(t),i=/-S:(\d+)\/TB(\d{1,2})@?(\d?)/.exec(t),r=i?.[1],n=i?.[2],a=i?.[3],s=/-F:(\d+)\/TB(\d{1,2})@?(\d?)/.exec(t),o=s?.[1],l=s?.[2],u=s?.[3];return DM(e,!!(i&&n&&r===a||s&&l&&o===u))===tFe(t)}var OP=/^\d{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2]\d|3[0-1])$/,Jie=/^((0\d|1\d|2[0-3]):[0-5]\d(:[0-5]\d)?)([.,]\d{3})?$/,dl=/^(\d{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2]\d|3[0-1]))([ T](0\d|1\d|2[0-3]):[0-5]\d(:[0-5]\d)?)?([.,]\d{3})?Z?$/,dp=/^(\d{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2]\d|3[0-1]))?([ T]?(0\d|1\d|2[0-3]):[0-5]\d(:[0-5]\d)?)?([.,]\d{3})?Z?$/;function xP(t){let{scheduledDate:e}=t;if(!e&&t.scheduledTime&&(e=Ze(t.scheduledTime)),!e)return;let i=pi(t.scheduledTime),r=Ze(e);return r&&i&&(r+=`T${i}`),r}function iFe(t){return typeof t!="object"||Array.isArray(t)?!1:Object.prototype.toString.call(t)==="[object Date]"}function xv(t){let e=typeof t=="string"?t?.split(" "):[];if(t&&e?.length>1&&!["AM","PM"].includes(e[1].toUpperCase()))return!1;let i=Lh(t,!0,!0);return!!(!t||i&&dp.test(i))}function Mn(t){return yc(t)||OP.test(t)}function rFe(t){let e=new Date(t),i=e.getSeconds()+60*e.getMinutes()+3600*e.getHours();return nFe(i,{displaySeconds:!1})}function nFe(t,e){let i=Number.parseInt(t,10),r=Math.floor(i/3600),n=Math.floor((i-r*3600)/60),a=i-r*3600-n*60;return(!e||e?.displaySeconds?r+":"+n+":"+a:r+":"+n).split(":").map(as).join(":")}var EB=t=>{let e=Hb(t)||yc(t)?new Date(t):new Date,i=e.getUTCMonth()+1,r=i<10?`0${i}`:`${i}`;return`${e.getUTCFullYear()}-${as(r)}-${as(e.getUTCDate())}`};function aFe(t){let e=Hb(t)||yc(t)?new Date(t):new Date;return Date.UTC(e.getFullYear(),e.getMonth(),e.getDate())}function Bs(t,e="-",i="YMD"){if(!t)return"";typeof t=="string"&&!t.includes("T")&&(t=t+"T00:00");let r=new Date(t),n=""+(r.getMonth()+1),a=""+r.getDate(),s=r.getFullYear();return n.length<2&&(n="0"+n),a.length<2&&(a="0"+a),i==="DMY"?[a,n,s].join(e):i==="MDY"?[n,a,s].join(e):i==="YDM"?[s,a,n].join(e):i==="DYM"?[a,s,n].join(e):i==="MYD"?[n,s,a].join(e):[s,n,a].join(e)}function FP(t){let e=t?new Date(t):new Date,i=e.getTimezoneOffset();return new Date(e.getTime()-i*60*1e3)}function sFe(t){return FP(t).getTime()}function Hb(t){if(typeof t=="boolean")return!1;let e=t instanceof Date&&t||!Number.isNaN(Number(t))&&new Date(t)||!1;return e&&!Number.isNaN(Number(e.valueOf()))}function oFe(t,e){return t<=e}function UI(t,e){if(!Mn(t)||!Mn(e))return[];let i=Ze(t)+"T00:00",r=Ze(e)+"T00:00",n=new Date(i),a=new Date(r),s=Hb(a)&&Hb(n)&&oFe(n,a),o=[],l=0;if(s){let u=n,c=u.getTime();for(;c<=a.getTime()&&l<300;)l+=1,o.push(new Date(u)),c=u.setDate(u.getDate()+1)}return o.map(u=>Bs(u))}var lFe=/^([+-]?\d{4}(?!\d{2}\b))((-?)((0[1-9]|1[0-2])(\3([12]\d|0[1-9]|3[01]))?|W([0-4]\d|5[0-2])(-?[1-7])?|(00[1-9]|0[1-9]\d|[12]\d{2}|3([0-5]\d|6[1-6])))([T\s]((([01]\d|2[0-3])((:?)[0-5]\d)?|24:?00)([.,]\d+(?!:))?)?(\17[0-5]\d([.,]\d+)?)?([zZ]|([+-])([01]\d|2[0-3]):?([0-5]\d)?)?)?)?$/;function yc(t){return typeof t!="string"?!1:lFe.test(t)}function nd(t){return typeof t!="string"||!yc(t)?!1:/([zZ]|[+-]\d{2}:?\d{2})$/.test(t)}function RB(t){if(typeof t!="string")return!1;let e=t.split("Z")[0].split(":"),i=e.every(r=>!Number.isNaN(Number.parseInt(r)));return!(e.length<2||!i||Number.parseInt(e[0])>23||Number.parseInt(e[1])>60)}function Rt(t){let e=pi(t);if(!e)return 0;let[i,r]=e.split(":").map(n=>Number.parseInt(n));return i*60+r}function uFe(t){let e=Math.floor(t/60),i=t-e*60;return e>23&&(e=e%24),[as(e),as(i)].join(":")}function LP(t){return RB(t)?t.split(":").slice(0,2).map(as).join(":"):void 0}function pi(t){return yc(t)&&t.indexOf("T")>0?LP(t.split("T").reverse()[0]):LP(t)}function Ze(t){return yc(t)||dl.test(t)?t.split("T")[0]:""}function Ty(t,e){let i=new Date(t);return i.setDate(i.getDate()+e),Ze(i.toISOString())}function _P(t){t=typeof t=="string"?t:"00:00";let e={},i={};return{0:e.time,1:e.ampm}=t.split(" ")||[],{0:i.hours,1:i.minutes}=e.time.split(":")||[],i.ampm=e.ampm,Number.isNaN(Number.parseInt(i.hours))||Number.isNaN(Number.parseInt(i.minutes))||i.ampm&&!["AM","PM"].includes(i.ampm.toUpperCase())?{}:i}function cFe(t){let e=_P(t);return e.ampm&&e.hours&&(e.ampm.toLowerCase()==="pm"&&Number.parseInt(e.hours)<12&&(e.hours=(e.hours&&Number.parseInt(e.hours)||0)+12),e.ampm.toLowerCase()==="am"&&e.hours==="12"&&(e.hours="00")),`${e.hours||"12"}:${e.minutes||"00"}`.split(":").map(as).join(":")}function dFe(t){let e=_P(t);if(!(typeof e=="object"&&!Object.keys(e).length))return e.ampm?t:(e.hours>12?(e.hours-=12,e.ampm="PM"):e.hours==="12"?e.ampm="PM":(e.hours==="00"&&(e.hours="12"),e.ampm="AM"),e.hours?.[0]==="0"&&(e.hours=e.hours.slice(1)),`${e.hours||"12"}:${e.minutes||"00"} ${e.ampm}`)}function Lh(t,e,i){let r=Ze(t),n=pi(t),a=r?n:t;return t?e&&(r&&i&&t||cFe(a))||dFe(a):void 0}function Qie(t,e){let i=_P(t),r=_P(e);if(Number.parseInt(i.hours)<Number.parseInt(r.hours))return-1;if(Number.parseInt(i.hours)>Number.parseInt(r.hours))return 1;if(i.hours===r.hours){if(Number.parseInt(i.minutes)<Number.parseInt(r.minutes))return-1;if(Number.parseInt(i.minutes)>Number.parseInt(r.minutes))return 1}return 0}function CB(t,e=7){let i=Ze(t)+"T00:00",r=new Date(i),n=new Date(r.setDate(r.getDate()+e));return Bs(n)}function pFe(t){return CB(t)}function fFe(t,e,i,r=!1){let n=new Date(e,0,1+(t-1)*7),a=r?0:1;return n.setDate(n.getDate()+(a-n.getDay())),Bs(n,i)}function mFe(t,e,i){let r=new Date(t,0);return Bs(new Date(r.setDate(e)),i)}function Ji(t,e=void 0){let[i,r]=(t||"00:00").split(":").map(as),n=FP(e).setHours(i,r,0,0);return FP(n)}function nU(t,e,i=!0){let r=new Date(t),n=(new Date(e).getTime()-r.getTime())/1e3/60;return i?Math.abs(Math.round(n)):Math.round(n)}function Zn(t,e){let i=pi(t);if(!i)return"00:00";let r=Number.isNaN(e)?0:e;return pi(MB(Ji(i),r).toISOString())||"00:00"}function MB(t,e){let i=new Date(t);return new Date(i.getTime()+e*6e4)}function as(t){return t.toString()[1]?t:"0"+t}function pu(t,e){let i=new Date(t),r=new Date(e);return i.getFullYear()===r.getFullYear()&&i.getMonth()===r.getMonth()&&i.getDate()===r.getDate()}var Zie={addDays:CB,addWeek:pFe,addMinutesToTimeString:Zn,convertTime:Lh,getIsoDateString:xP,getUTCdateString:EB,DateHHMM:rFe,extractDate:Ze,extractTime:pi,formatDate:Bs,getDateByWeek:fFe,isISODateString:yc,isValidEmbargoDate:nd,isDate:Hb,isTimeString:RB,offsetDate:FP,offsetTime:sFe,sameDay:pu,timeStringMinutes:Rt,timeToDate:Ji,timeUTC:aFe,validTimeValue:xv,validDateString:OP,timeValidation:dp,dateValidation:dl},hFe=(t,e)=>t.filter(Boolean).every(i=>typeof i===e),gFe=t=>t.filter(Boolean).every(Ai);function dg(t,e){return`${t}-${e}`}function Bp(t){let e=t.category;if(typeof e!="object"||!e)return{error:$b};let{ageCategoryCode:i,ageMaxDate:r,ageMinDate:n,ageMax:a,ageMin:s}=e,o=e.categoryName,l;if(!(hFe([i,r,n,o],"string")&&gFe([a,s])&&[r,n].filter(Boolean).every(Mn)))return{error:$b};let u=t.consideredDate??Ze(new Date().toLocaleDateString("sv"));if(!u||!Mn(u))return{error:or};let[c]=u.split("-").slice(0,3).map(L=>Number.parseInt(L)),d=Ty(u,-1);if(!d)return{error:or};let[p,f]=d.split("-").slice(1,3).map(L=>Number.parseInt(L)),m=`${as(p)}-${as(f)}`,h=Ty(u,1);if(!h)return{error:or};let[g,I]=h.split("-").slice(1,3).map(L=>Number.parseInt(L)),v=`${as(g)}-${as(I)}`,w=s&&Ty(u,-1*365*s),y=a&&Ty(u,-1*365*a),b=[],S=L=>!b.includes(L)&&b.push(L);i=i??o;let U=/^([UO]?)(\d{1,2})([UO]?)$/,T=/^C(\d{1,2})-(\d{1,2})$/,P=i?.includes("-"),D=P&&i?.match(T),E=i?.match(U);function R(L){let $=c-L,V=dg($,v);e.ageMinDate&&e.ageMinDate!==V&&S(`Invalid submitted ageMinDate: ${n}`),n=V,i&&(e.ageMax&&e.ageMax!==L-1&&(S(`Invalid submitted ageMax: ${a}`),y=void 0),a=L-1)}function C(L){let $=c-L-1,V=dg($,v);e.ageMin&&e.ageMin>L&&S(`Invalid submitted ageMin: ${s}`),e.ageMax&&e.ageMax>L&&S(`Invalid submitted ageMax: ${a}`),e.ageMinDate&&e.ageMinDate!==V&&S(`Invalid submitted ageMinDate: ${n}`),n=V,i&&(e.ageMax&&e.ageMax!==L&&(S(`Invalid submitted ageMax: ${a}`),w=void 0),a=L)}function M(L){let $=c-L,V=dg($,m);e.ageMaxDate&&e.ageMaxDate!==V&&S(`Invalid submitted ageMaxDate: ${r}`),r=V,i&&(e.ageMin&&e.ageMin!==L+1&&(S(`Invalid submitted ageMin: ${s}`),w=void 0),s=L+1)}function N(L){let $=c-L-1,V=dg($,m);e.ageMaxDate&&e.ageMaxDate!==V&&S(`Invalid submitted ageMaxDate: ${r}`),r=V,i&&(e.ageMin&&e.ageMin!==L&&(S(`Invalid submitted ageMin: ${s}`),w=void 0),s=L)}function A(L){let $=U.exec(L)||[],[V,_,B]=$.slice(1),G=Number.parseInt(_);V==="U"?(e.ageMaxDate&&e.ageMaxDate!==r&&S(`Invalid submitted ageMaxDate: ${e.ageMaxDate}`),R(G)):V==="O"&&M(G),B==="U"?(e.ageMaxDate&&e.ageMaxDate!==r&&S(`Invalid submitted ageMaxDate: ${e.ageMaxDate}`),C(G)):B==="O"&&N(G),r=(r??w)||void 0,n=(n??y)||void 0}function O(){if(r=void 0,n=void 0,a=void 0,s=void 0,e.ageMin){let V=c-e.ageMin;r=dg(V,m)}if(e.ageMax){let V=c-e.ageMax-1;n=dg(V,v)}let[L,$]=(i?.match(T)??[]).slice(1).map(V=>Number.parseInt(V));L<=$?(s=L,a=$,l=!0):S(`Invalid combined age range ${i}`)}function k(){s&&M(s),a&&C(a)}function F(){D?O():P?i?.split("-").forEach(A):E&&i?A(i):k()}F(),a&&e?.ageMin&&e?.ageMin>a&&(S(`Invalid submitted ageMin: ${e?.ageMin}`),s=void 0);let x=je({consideredDate:u,combinedAge:l,ageMaxDate:r,ageMinDate:n,ageMax:a,ageMin:s});return b.length&&(x.errors=b),x}function Wb({category:t}){if(!wt(t))return{error:re};let e=Bp({category:t});if(e.error)return{error:e};let{ratingMax:i,ratingMin:r}=t;return i&&!Ai(i)?q({result:{error:re},context:{ratingMax:i}}):r&&!Ai(r)?q({result:{error:re},context:{ratingMin:r}}):{...e}}function aU({childCategory:t,withDetails:e,category:i}){let r=Wb({category:i}),n=Wb({category:t}),a=n.ageMin&&(r.ageMin&&n.ageMin<r.ageMin||r.ageMax&&n.ageMin>r.ageMax),s=n.ageMax&&(r.ageMax&&n.ageMax>r.ageMax||r.ageMin&&n.ageMax<r.ageMin),o=n.ageMinDate&&r.ageMaxDate&&new Date(n.ageMinDate)>new Date(r.ageMaxDate),l=n.ageMaxDate&&r.ageMinDate&&new Date(n.ageMaxDate)<new Date(r.ageMinDate),u=i?.ratingType&&t?.ratingType&&i.ratingType===t.ratingType&&(i.ratingMin&&t.ratingMin&&t.ratingMin<i.ratingMin||i.ratingMax&&t.ratingMax&&t.ratingMax>i.ratingMax||i.ratingMin&&t.ratingMax&&t.ratingMax<i.ratingMin||i.ratingMax&&t.ratingMin&&t.ratingMin>i.ratingMax),c=i?.ballType&&t?.ballType&&i.ballType!==t.ballType,d=je({invalidRatingRange:u,invalidAgeMinDate:o,invalidAgeMaxDate:l,invalidBallType:c,invalidAgeMax:s,invalidAgeMin:a,valid:!u&&!o&&!l&&!c&&!s&&!a},!0);return e&&Object.assign(d,{categoryDetails:r,childCategoryDetails:n}),d}function sU({checkCategory:t=!0,collectionDefinition:e,checkCollectionIds:i,checkGender:r=!0,referenceCategory:n,referenceGender:a,event:s}){a=a??s?.gender;let o="validateCollectionDefinition",l=[];if(typeof e!="object")return l.push(`collectionDefinition must be an object: ${e}`),q({result:{errors:l,error:Bc},stack:o});let{collectionValueProfiles:u,collectionGroupNumber:c,collectionValue:d,collectionId:p,matchUpCount:f,matchUpFormat:m,matchUpValue:h,matchUpType:g,scoreValue:I,setValue:v,category:w,gender:y}=e;if(i&&typeof p!="string"&&l.push(`collectionId is not type string: ${p}`),typeof f!="number"&&l.push(`matchUpCount is not type number: ${f}`),g&&!fm([zt,Bt],g)&&l.push(`matchUpType must be SINGLES or DOUBLES: ${g}`),[!!u?.length].concat([h,d,I,v].map(lt)).filter(Boolean).length!==1&&l.push("Missing value definition for matchUps: matchUpValue, collectionValue, or collectionValueProfiles"),h&&typeof h!="number"&&l.push(`matchUpValue is not type number: ${h}`),d&&typeof d!="number"&&l.push(`collectionValue is not type number: ${d}`),u&&f){let b=gte({collectionValueProfiles:u,matchUpCount:f});b.errors&&l.push(...b.errors)}if(c&&typeof c!="number"&&l.push(`collectionGroupNumber is not type number: ${d}`),m&&!$a({matchUpFormat:m})&&l.push(`Invalid matchUpFormat: ${m}`),r){let b=TM({referenceGender:a,matchUpType:g,gender:y});if(b.error)return q({context:{referenceGender:a,gender:y},result:b,stack:o})}if(t&&n&&w){let b=aU({category:n,childCategory:w});if(!b.valid)return q({result:{error:$b},context:b,stack:o})}return l.length?q({result:{errors:l,error:Tie},stack:o}):{valid:!0}}function Gn(t){let e=!!(t?.enforceCategory!==!1&&t?.category),i=!!(t?.enforceGender!==!1&&t?.gender),r=t?.checkCollectionIds,n=t?.tieFormat,a=t?.event,s="validateTieFormat",o=[],l=IFe({...t,stack:s});if(l?.error)return l;let u,c=n.collectionDefinitions.every(h=>{let{setValue:g,scoreValue:I,collectionValue:v}=h;(g||I)&&!v&&(u=!0);let{valid:w,errors:y}=sU({referenceCategory:t.category,referenceGender:t.gender,collectionDefinition:h,checkCollectionIds:r,checkCategory:e,checkGender:i,event:a});return w?!0:(Array.isArray(y)&&o.push(...y),!1)}),d=typeof n.winCriteria?.valueGoal=="number"&&n.winCriteria?.valueGoal>0&&!u||n.winCriteria?.aggregateValue;if(!(d||n.winCriteria?.aggregateValue))return u?o.push("aggregateValue is required"):o.push("Either non-zero valueGoal, or { aggregateValue: true } must be specified in winCriteria"),q({context:{tieFormat:n,errors:o,aggregateValueImperative:u},result:{error:ql},stack:s});let p=n.collectionDefinitions.map(({collectionId:h})=>h),f=!r||p.length===nt(p).length,m=c&&d&&f;return m?{valid:m,errors:o}:q({result:{error:ql},context:{tieFormat:n,errors:o},stack:s})}function IFe(t){let{tieFormat:e,stack:i}=t;return!t||!e||!wt(e)?q({result:{error:ql},context:{tieFormat:e,message:"tieformat must be an object"},stack:i}):wt(e.winCriteria)?Array.isArray(e.collectionDefinitions)?{...W}:q({result:{error:ql},context:{tieFormat:e,message:"collectionDefinitions must be an array"},stack:i}):q({result:{error:ql},context:{tieFormat:e,message:"tieformat.winCritiera must be an object"},stack:i})}var $P="resourceSubType",BP="resourceType",TI="identifier",gx="name",vFe={RESOURCE_SUB_TYPE:$P,RESOURCE_TYPE:BP,IDENTIFIER:TI,NAME:gx};function Oe(t,e,i,r,n=0){if(hx().makeDeepCopy)return hx().makeDeepCopy(t,e,i,r);let a=wB(),{stringify:s,toJSON:o,ignore:l,modulate:u}=a||{};if(!a?.enabled&&!i||typeof t!="object"||fa(t)||t===null||typeof a?.threshold=="number"&&n>=a.threshold)return t;let c=Array.isArray(t)?[]:{},d=Object.keys(t).filter(f=>!i||!l||Array.isArray(l)&&!l.includes(f)||fa(l)&&!l(f)),p=(f,m)=>{c[f]=fa(m?.toString)?m.toString():JSON.stringify(m)};for(let f of d){let m=t[f],h=fa(u)?u(m):void 0;if(h!==void 0)c[f]=h;else if(e&&f==="extensions"&&Array.isArray(m)){let g=NB(m);Object.assign(c,...g)}else r&&f==="extensions"?c[f]=[]:Array.isArray(s)&&s.includes(f)?p(f,m):Array.isArray(o)&&o.includes(f)&&fa(m?.toJSON)?c[f]=m.toJSON():m===null?c[f]=void 0:iFe(m)?c[f]=new Date(m).toISOString():c[f]=Oe(m,e,i,r,n+1)}return c}function NB(t){return t?.map(e=>{let{name:i,value:r}=e;return i&&r&&{[`_${i}`]:r}}).filter(Boolean)}function ere(t=1,e){return Ce(0,t).map(()=>Ct(e))}function Ct(t){let e=[];for(let o=0;o<256;o++)e[o]=(o<16?"0":"")+o.toString(16);let i=Math.trunc(Math.random()*4294967295),r=Math.trunc(Math.random()*4294967295),n=Math.trunc(Math.random()*4294967295),a=Math.trunc(Math.random()*4294967295),s=e[i&255]+e[i>>8&255]+e[i>>16&255]+e[i>>24&255]+"-"+e[r&255]+e[r>>8&255]+"-"+e[r>>16&15|64]+e[r>>24&255]+"-"+e[n&63|128]+e[n>>8&255]+"-"+e[n>>16&255]+e[n>>24&255]+e[a&255]+e[a>>8&255]+e[a>>16&255]+e[a>>24&255];return typeof t=="string"?`${t}_${s.replaceAll("-","")}`:s}var tre={collectionDefinitions:[{collectionName:"Male Singles",matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpCount:4,matchUpValue:1,gender:"MALE"},{collectionName:"Female Singles",matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:4,matchUpValue:1},{collectionName:"Male Doubles",matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpCount:2,matchUpValue:1,gender:"MALE"},{collectionName:"Female Doubles",matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:2,matchUpValue:1},{collectionName:"Mixed Doubles",matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpCount:4,matchUpValue:1,gender:"MIXED"}],tieFormatName:"USTA_GOLD_TEAM_CHALLENGE",winCriteria:{valueGoal:9}},ire={collectionDefinitions:[{collectionName:"Round 1",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Round 2",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Round 3",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"Doubles Shuffle",unrestrictedSelections:!0,winCriteria:{aggregateValue:!0}},rre={collectionDefinitions:[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_SOUTHERN_LEVEL_5",winCriteria:{valueGoal:8}},nre={collectionDefinitions:[{category:{ageCategoryCode:"16U"},collectionName:"16U Singles",matchUpCount:4,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Singles",matchUpCount:4,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Doubles",matchUpCount:2,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Doubles",matchUpCount:2,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Tiebreak Doubles",matchUpCount:1,matchUpFormat:"SET1-S:TB10",matchUpType:"DOUBLES",matchUpValue:1,processCodes:["RANKING.IGNORE"]}],tieFormatName:"USTA_SECTION_BATTLE",winCriteria:{valueGoal:9}},are={collectionDefinitions:[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_INTERSECTIONAL",winCriteria:{valueGoal:8}},sre={collectionDefinitions:[{scoreValue:1,matchUpType:"SINGLES",collectionName:"Men's Singles",matchUpFormat:"SET1-S:T60",gender:"MALE",matchUpCount:1},{scoreValue:1,matchUpType:"SINGLES",collectionName:"Women's Singles",matchUpFormat:"SET1-S:T60",gender:"FEMALE",matchUpCount:1},{matchUpValue:1,matchUpType:"DOUBLES",collectionName:"Mixed Doubles",matchUpFormat:"SET1-S:T60",gender:"MIXED",matchUpCount:1}],tieFormatName:"Time Tennis Pro Circuit",winCriteria:{aggregateValue:!0}},ore={collectionDefinitions:[{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"DOMINANT_DUO_MIXED",winCriteria:{valueGoal:2}},lre={collectionDefinitions:[{scoreValue:1,matchUpType:"SINGLES",collectionName:"Men's Singles",matchUpFormat:"SET1-S:T60",gender:"MALE",matchUpCount:3},{scoreValue:1,matchUpType:"SINGLES",collectionName:"Women's Singles",matchUpFormat:"SET1-S:T60",gender:"FEMALE",matchUpCount:3},{scoreValue:1,matchUpType:"DOUBLES",collectionName:"Men's Doubles",matchUpFormat:"SET1-S:T60",gender:"MALE",matchUpCount:1},{matchUpValue:1,matchUpType:"DOUBLES",collectionName:"Women's Doubles",matchUpFormat:"SET1-S:T60",gender:"FEMALE",matchUpCount:1},{matchUpValue:1,matchUpType:"DOUBLES",collectionName:"Mixed Doubles",matchUpFormat:"SET1-S:T60",gender:"MIXED",matchUpCount:1}],tieFormatName:"Time Tennis Dual",winCriteria:{aggregateValue:!0}},ure={collectionDefinitions:[{category:{ageCategoryCode:"14U"},collectionName:"14U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],collectionGroups:[{groupNumber:1,groupName:"Doubles",groupValue:1,winCriteria:{valueGoal:2}}],tieFormatName:"USTA_BREWER_CUP",winCriteria:{valueGoal:4}},cre={winCriteria:{valueGoal:23},tieFormatName:"USTA_OZAKI_CUP",collectionDefinitions:[{category:{ageCategoryCode:"18U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"18U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"18U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"18U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"18U"},collectionName:"18U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"16U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"16U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"16U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"16U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"16U"},collectionName:"16U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"14U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"14U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"14U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"14U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"14U"},collectionName:"14U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"12U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"12U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"12U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"12U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"12U"},collectionName:"12U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"12U"},collectionName:"12U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"12U"},collectionName:"12U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1}]},Vs="SET3-S:6/TB7",yFe="SET3-S:6NOAD",dre="SET3-S:6/TB7-F:TB10",bFe="SET3-S:4/TB7",wFe="SET3-S:4/TB5@3",SFe="SET1-S:T20",UFe="SET1-S:8/TB7",TFe="SET1-S:8/TB7@7",DFe={FORMAT_STANDARD:Vs,FORMAT_STANDARD_NOAD:yFe,FORMAT_ATP_DOUBLES:dre,FORMAT_SHORT_SETS:bFe,FORMAT_FAST4:wFe,FORMAT_PRO_SET:UFe,FORMAT_COLLEGE_PRO_SET:TFe,TIMED20:SFe},pre={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"DOMINANT_DUO",winCriteria:{valueGoal:2}},fre={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",collectionValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"USTA_COLLEGE",winCriteria:{valueGoal:4}},mre={collectionDefinitions:[{collectionName:"Male Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_LEVEL_1",winCriteria:{valueGoal:10}},hre={collectionDefinitions:[{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Overtime",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"USTA_WTT_ITT",winCriteria:{aggregateValue:!0}},gre={collectionDefinitions:[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_ZONAL",winCriteria:{valueGoal:10}},Ire={collectionDefinitions:[{collectionGroupNumber:1,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:1},{collectionGroupNumber:1,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:1},{collectionGroupNumber:2,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:2},{collectionGroupNumber:2,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:2},{collectionGroupNumber:3,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:3},{collectionGroupNumber:3,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:3}],collectionGroups:[{groupNumber:1,groupName:"Day 1"},{groupNumber:2,groupName:"Day 2"},{groupNumber:3,groupName:"Day 3"}],tieFormatName:"LAVER_CUP",winCriteria:{valueGoal:13}},vre={collectionDefinitions:[{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Overtime",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"USTA_TOC",winCriteria:{aggregateValue:!0}},VP="COLLEGE_DEFAULT",Ix="COLLEGE_JUCO",vx="COLLEGE_D3",yre="DOMINANT_DUO",bre="DOMINANT_DUO_MIXED",wre="LAVER_CUP",Sre="TEAM_DOUBLES_3_AGGREGATION",Ure="TIME_TENNIS_DUAL",Tre="TIME_TENNIS_PRO_CIRCUIT",Dre="USTA_BREWER_CUP",Pre="USTA_OZAKI_CUP",Ere="USTA_COLLEGE",Rre="USTA_GOLD_TEAM_CHALLENGE",Cre="USTA_LEVEL_1",Mre="USTA_INTERSECTIONAL",Nre="USTA_SECTION_BATTLE",Are="USTA_SOUTHERN_LEVEL_5",kre="USTA_TOC",Ore="USTA_WTT_ITT",xre="USTA_ZONAL",PFe={COLLEGE_D3:vx,COLLEGE_DEFAULT:VP,COLLEGE_JUCO:Ix,DOMINANT_DUO:yre,DOMINANT_DUO_MIXED:bre,LAVER_CUP:wre,TEAM_DOUBLES_3_AGGREGATION:Sre,TIME_TENNIS_DUAL:Ure,TIME_TENNIS_PRO_CIRCUIT:Tre,USTA_BREWER_CUP:Dre,USTA_OZAKI_CUP:Pre,USTA_COLLEGE:Ere,USTA_GOLD_TEAM_CHALLENGE:Rre,USTA_INTERSECTIONAL:Mre,USTA_LEVEL_1:Cre,USTA_SECTION_BATTLE:Nre,USTA_SOUTHERN_LEVEL_5:Are,USTA_TOC:kre,USTA_WTT_ITT:Ore,USTA_ZONAL:xre},Fre="STANDARD",Jz={[Fre]:{hydrate:!0,doubles:{matchUpCount:3,matchUpValue:1},singles:{matchUpCount:6,matchUpValue:1},valueGoal:5},[vx]:{hydrate:!0,doubles:{matchUpFormat:"SET1-S:8/TB7@7",matchUpCount:3,matchUpValue:1},singles:{matchUpFormat:Vs,matchUpCount:6,matchUpValue:1},tieFormatName:vx,valueGoal:5},[VP]:{hydrate:!0,doubles:{matchUpFormat:"SET1-S:6/TB7",collectionValue:1,matchUpCount:3},singles:{matchUpFormat:Vs,matchUpCount:6,matchUpValue:1},tieFormatName:VP,valueGoal:4},[Ix]:{hydrate:!0,doubles:{matchUpFormat:"SET1-S:8/TB7",matchUpCount:3,matchUpValue:1},singles:{matchUpFormat:Vs,matchUpCount:6,matchUpValue:1},tieFormatName:Ix,valueGoal:5},[wre]:Ire,[yre]:pre,[bre]:ore,[Sre]:ire,[Ure]:lre,[Tre]:sre,[Dre]:ure,[Pre]:cre,[Ere]:fre,[Rre]:tre,[Mre]:are,[Cre]:mre,[Nre]:nre,[Are]:rre,[Ore]:hre,[kre]:vre,[xre]:gre},EFe=t=>{let e=t?.namedFormat&&Object.keys(Jz).includes(t.namedFormat)?t.namedFormat:Fre,i=Array.isArray(t?.uuids)?t?.uuids:[],r,{category:n,gender:a}=t?.event??{},s=Oe(Jz[e],!1,!0),o=l=>{if(!t?.isMock&&!t?.event?.isMock||!t.event)return i?.pop()??Ct();let u=t?.event?.eventId;return i.pop()??`${u}-COL-${l+1}`};return s.hydrate?(r={winCriteria:{valueGoal:s.valueGoal},collectionDefinitions:[{collectionId:o(0),matchUpFormat:dre,collectionName:"Doubles",matchUpType:Bt,...s.doubles},{collectionId:o(1),matchUpFormat:Vs,collectionName:"Singles",matchUpType:zt,...s.singles}]},s.tieFormatName&&(r.tieFormatName=s.tieFormatName)):(s.collectionDefinitions.forEach((l,u)=>l.collectionId=o(u)),r=s),t?.hydrateCollections&&r.collectionDefinitions.forEach(l=>{n&&!l.category&&(l.category=n),a&&!l.gender&&(l.gender=a)}),r},bc=EFe,pl="SINGLES",Bm="SINGLES",fs="DOUBLES",wc="DOUBLES",ar="TEAM",Ua="TEAM",RFe="RATING",CFe="BOTH",MFe={AGE:"AGE",BOTH:CFe,DOUBLES:fs,DOUBLES_EVENT:wc,RATING:RFe,SINGLES:pl,SINGLES_EVENT:Bm,TEAM_EVENT:Ua,TEAM:ar},Ae="MAIN",ze="QUALIFYING",tn="CONSOLATION",Cr="VOLUNTARY_CONSOLATION",Ti="PLAY_OFF",PM=[Ae,ze,tn,Ti,Cr],Vm={[ze]:1,[Ae]:2,[Ti]:3,[tn]:3,[Cr]:4},Lre="finishingPositions",_re="aggregateEventStructures",$re={[Ae]:1,[Ti]:2,[tn]:3,[ze]:4,[Cr]:5},NFe={[Ti]:1,[Ae]:2,[tn]:3,[ze]:4,[Cr]:5},oU="CLUSTER",EM="ADJACENT",Bre="SEPARATE",Vp="WATERFALL",RM="ITEM",gn="CONTAINER",ho="DRAW",CM="RANDOM",As="TOP_DOWN",jp="BOTTOM_UP",fu="POSITION",mu="WINNER",hu="LOSER",fl="FIRST_MATCHUP",ua="AD_HOC",AFe="AD_HOC",Fv="FEED_IN",DI="COMPASS",PI="OLYMPIC",kFe="SINGLE_ELIMINATION",Jo="SINGLE_ELIMINATION",lU="DOUBLE_ELIMINATION",EI="FIRST_MATCH_LOSER_CONSOLATION",uU="FIRST_ROUND_LOSER_CONSOLATION",vf="LUCKY_DRAW",MM="CURTIS_CONSOLATION",OFe="CURTIS_CONSOLATION",AB="FEED_IN_CHAMPIONSHIP_TO_SF",zb="FEED_IN_CHAMPIONSHIP_TO_SF",kB="FEED_IN_CHAMPIONSHIP_TO_QF",qb="FEED_IN_CHAMPIONSHIP_TO_QF",OB="FEED_IN_CHAMPIONSHIP_TO_R16",Yb="FEED_IN_CHAMPIONSHIP_TO_R16",Vre="MODIFIED_FEED_IN_CHAMPIONSHIP",Kb="MODIFIED_FEED_IN_CHAMPIONSHIP",cU="FEED_IN_CHAMPIONSHIP",xFe="DOUBLE_ROUND_ROBIN",eo="ROUND_ROBIN",gu="ROUND_ROBIN_WITH_PLAYOFF",jre="DECIDER",Gre="BACKDRAW",xB={0:{name:"East",abbreviation:"E"},"0-1":{name:"West",abbreviation:"W"},"0-2":{name:"North",abbreviation:"N"},"0-3":{name:"Northeast",abbreviation:"NE"},"0-1-1":{name:"South",abbreviation:"S"},"0-1-2":{name:"Southwest",abbreviation:"SW"},"0-2-1":{name:"Northwest",abbreviation:"NW"},"0-1-1-1":{name:"Southeast",abbreviation:"SE"}},FB={0:{name:"East",abbreviation:"E"},"0-1":{name:"West",abbreviation:"W"},"0-2":{name:"North",abbreviation:"N"},"0-1-1":{name:"South",abbreviation:"S"}},Gp="WIN_RATIO",_h="ROUND_OUTCOME",Hre=[DI,MM,qb,Yb,zb,cU,kB,OB,AB,EI,uU,vf,Kb,PI,Ti,gu],FFe=[ua,DI,MM,lU,qb,Yb,zb,cU,Fv,EI,uU,vf,Kb,PI,Ti,eo,gu,Jo],Wre={MAIN:Ae,QUALIFYING:ze,CONSOLATION:tn,ITEM:RM,CONTAINER:gn,FIRST_MATCHUP:fl,WINNER:mu,LOSER:hu,AD_HOC:ua,FEED_IN:Fv,FLEX_ROUNDS:AFe,COMPASS:DI,PLAY_OFF:Ti,OLYMPIC:PI,KNOCKOUT:kFe,SINGLE_ELIMINATION:Jo,DOUBLE_ELIMINATION:lU,CURTIS:MM,FICSF:AB,FICQF:kB,FICR16:OB,MFIC:Vre,VOLUNTARY_CONSOLATION:Cr,FIRST_MATCH_LOSER_CONSOLATION:EI,FIRST_ROUND_LOSER_CONSOLATION:uU,MODIFIED_FEED_IN_CHAMPIONSHIP:Kb,FEED_IN_CHAMPIONSHIP_TO_R16:Yb,FEED_IN_CHAMPIONSHIP_TO_QF:qb,FEED_IN_CHAMPIONSHIP_TO_SF:zb,FEED_IN_CHAMPIONSHIP:cU,LUCKY_DRAW:vf,ROUND_ROBIN_WITH_PLAYOFF:gu,ROUND_ROBIN:eo,DECIDER:jre,BACKDRAW:Gre,COMPASS_ATTRIBUTES:xB,OLYMPIC_ATTRIBUTES:FB,DRAW:ho,RANDOM:CM,TOP_DOWN:As,BOTTOM_UP:jp,CLUSTER:oU,ADJACENT:EM,SEPARATE:Bre,WATERFALL:Vp,WIN_RATIO:Gp,ROUND_OUTCOME:_h,MULTI_STRUCTURE_DRAWS:Hre,generatedDrawTypes:FFe,stageOrder:Vm,finishOrder:$re,AGGREGATE_EVENT_STRUCTURES:_re,FINISHING_POSITIONS:Lre},LFe=Wre,pn="tournamentRecords",LB="policyDefinitions",hr="tournamentRecord",_B="onlineResource",In="drawDefinition",zre="tieFormatName",$B="matchUpFormat",Iu="participantId",qre="scheduleDates",_Fe="tournamentId",$Fe="scheduleDate",BFe="roundNumber",NM="structureId",BB="participant",dU="matchUpIds",Yre="entryStage",VFe="policyType",Kre="structures",VB="eventType",Pl="matchUpId",AM="tieFormat",kM="inContext",OM="structure",xM="courtIds",jFe="personId",FM="venueIds",jB="matchUps",Xre="courtId",Jre="eventId",Au="matchUp",Qre="drawId",js="error",Vc="event",Lv="param",GB="uuids",GFe="averageMatchUpMinutes",HFe="recoveryMinutes",WFe="periodLength",zFe="number",Kn="object",sn="array",qr="_validate",Zre="_message",Ba="_invalid",qn="_ofType",HB="_anyOf",RI="_oneOf",Qz={[_B]:t=>Li(Object.keys(t),[$P,BP,TI]).length===3,[zre]:t=>t&&bc({namedFormat:t}),[GB]:t=>!t||Array.isArray(t)&&t.every(ni),[AM]:t=>!Gn({tieFormat:t}).error,[VB]:t=>[pl,fs,ar].includes(t),[Yre]:t=>PM.includes(t)},qFe={[pn]:Mi,[hr]:ve,[LB]:uM,[In]:$e,[Iu]:dr,[$B]:Vte,[_Fe]:yI,[NM]:qa,[dU]:Nh,[BB]:kh,[_B]:Bc,[VB]:cu,[Kre]:eB,[Pl]:Tn,[AM]:ql,[OM]:hf,[Xre]:Ah,[jB]:Nu,[Jre]:ps,[Au]:sa,[xM]:Je,[FM]:Je,[Qre]:xo,[Vc]:ui},YFe={[pn]:Kn,[LB]:Kn,[hr]:Kn,[In]:Kn,[_B]:Kn,[qre]:sn,[BB]:Kn,[dU]:sn,[Kre]:sn,[AM]:Kn,[OM]:Kn,[xM]:sn,[FM]:sn,[jB]:sn,[Au]:Kn,[Vc]:Kn,[GB]:sn};function He(t,e,i){if(!t&&!wt(t))return{error:re};if(!e?.length||t?._bypassParamCheck)return{valid:!0};if(!Array.isArray(e))return{error:re};let{paramError:r,errorParam:n}=JFe(t,e);if(!r)return{valid:!0};let a=r[qr]&&(r[js]||r[Ba])||t?.[n]===void 0&&(r[js]||r[Ba]||qFe[n]||re)||re,s=n??(r[RI]&&Object.keys(r[RI]).join(", "));return q({info:{param:s,message:r[Zre]},result:{error:a},stack:i})}function ene(t,e){let i=Object.keys(t),r=Object.keys(e);return Li(i,r)}function KFe(t,e){if(!e)return;let i=ene(t,e);return i.length!==1?{error:re}:i.reduce((r,n)=>({...r,[n]:!0}),{})}function XFe(t,e){if(!e)return;let i=ene(t,e).filter(r=>t[r]);return i.length<1?{error:re}:i.reduce((r,n)=>({...r,[n]:!0}),{})}function JFe(t,e){let i,r;return{paramError:e.find(({_ofType:n,_oneOf:a,_anyOf:s,_validate:o,_info:l,...u})=>{let c=a&&KFe(t,a);if(c?.error)return c.error;c&&Object.assign(u,c);let d=s&&XFe(t,s);if(d?.error)return d.error;d&&Object.assign(u,d);let p=Object.keys(u).filter(m=>typeof u[m]=="boolean"),f=p.find(m=>{let h=o&&!fa(o),g=t[m]!==void 0&&!o&&QFe(t,m,n),I=u[m]&&[void 0,null].includes(t[m]),v=h||g||I||o&&t[m]!==void 0&&!ZFe(t[m],o)||Qz[m]&&!Qz[m](t[m]);return v&&(i=m,r=l),v});return!p.length||f}),errorParam:i,paramInfo:r}}function QFe(t,e,i){return i=i||YFe[e]||"string",i==="array"?!Array.isArray(t[e]):typeof t[e]!==i}function ZFe(t,e){return fa(e)?e(t):!0}var WB="DYNAMIC",vu="RANKING",ud="RATING",Sd="SCALE",Yl="SEEDING",eLe={RANKING:vu,RATING:ud,SCALE:Sd,SEEDING:Yl};function _v(t){let e=He(t,[{[BB]:!0}]);if(e.error)return e;let i=t.participant.timeItems?.filter(({itemType:n})=>n?.startsWith(Sd)&&[vu,ud,Yl].includes(n.split(".")[1])),r={ratings:{},rankings:{},seedings:{}};if(i?.length){let n=s=>i.filter(o=>o?.itemType===s).sort((o,l)=>new Date(o.createdAt||void 0).getTime()-new Date(l.createdAt||void 0).getTime()).pop(),a=nt(i.map(({itemType:s})=>s));for(let s of a){let o=n(s);if(o){let[,l,u,c,d]=o.itemType.split("."),p=d?`${c}.${d}`:c,f=l===Yl&&"seedings"||l===vu&&"rankings"||"ratings";r[f][u]||(r[f][u]=[]),r[f][u].push({scaleValue:o.itemValue,scaleDate:o.itemDate,scaleName:p})}}}return{...W,...r}}function jm(t){if(t===null)return{};let{source:e,template:i}=t||{};if(!i)return e;let r={};return n(e,i,r),r;function n(a,s,o){if(!a||!s)return;let l=Object.keys(a),u=Object.keys(s),c=Object.assign({},...u.filter(f=>f.indexOf("||")).map(f=>f.split("||").map(m=>({[m]:f}))).flat()),d=u.concat(...Object.keys(c)),p=d.includes("*");for(let f of l)if(d.indexOf(f)>=0||p){let m=c[f]||f,h=s[m]||p,g=a[f];if(typeof h=="object"&&typeof g!="function"&&!Array.isArray(h))if(Array.isArray(g)){let I=g.map(v=>{let w={};return n(v,h,w)!==!1?w:void 0}).filter(Boolean);o[f]=I}else g&&(o[f]={},n(g,h,o[f]));else{let I=a[f];if(Array.isArray(h)&&!h.includes(I))return!1;(s[f]||p&&s[f]!==!1)&&(o[f]=I)}}}}var yx="voluntaryConsolation",qu="competitiveBands",zB="roundRobinTally",yu="positionActions",Mr="matchUpActions",fD="rankingPoints",Sc="roundNaming",$v="participant",Xb="progression",qd="scheduling",Jb="avoidance",tLe="participant",iLe="display",ms="scoring",Rs="seeding",CI="feedIn",rLe="audit",jP="draws",nLe={POLICY_TYPE_VOLUNTARY_CONSOLATION:yx,POLICY_TYPE_COMPETITIVE_BANDS:qu,POLICY_TYPE_ROUND_ROBIN_TALLY:zB,POLICY_TYPE_POSITION_ACTIONS:yu,POLICY_TYPE_MATCHUP_ACTIONS:Mr,POLICY_TYPE_RANKING_POINTS:fD,POLICY_TYPE_ROUND_NAMING:Sc,POLICY_TYPE_PARTICIPANT:$v,POLICY_TYPE_PROGRESSION:Xb,POLICY_TYPE_SCHEDULING:qd,POLICY_TYPE_AVOIDANCE:Jb,POLICY_TYPE_DISPLAY:iLe,POLICY_TYPE_PRIVACY:tLe,POLICY_TYPE_FEED_IN:CI,POLICY_TYPE_SCORING:ms,POLICY_TYPE_SEEDING:Rs,POLICY_TYPE_AUDIT:rLe,POLICY_TYPE_DRAWS:jP};function Ud({tournamentParticipants:t=[],policyDefinitions:e={},contextProfile:i,participantId:r,internalUse:n,personId:a}){let s=t.find(l=>r&&l.participantId===r||a&&l.person&&l.person.personId===a),o=Oe(s,!1,n);if(o){let l=e?.[$v];if(i?.withScaleValues){let{ratings:u,rankings:c}=_v({participant:o});o.rankings=c,o.ratings=u}if(l?.participant)return jm({template:l.participant,source:o})}return o}var aLe="element required",sLe="missing name";function Nn(t){if(!t||typeof t!="object")return{error:Je};if(t.element&&typeof t?.element!="object")return{error:re};if(!t?.name)return{error:Je,info:sLe};if(!t?.element){if(t.discover&&t.tournamentRecords){for(let e of Object.keys(t.tournamentRecords)){let i=t.tournamentRecords[e],r=Nn({element:i,name:t.name});if(r.error)return q({result:r,stack:"removeExtension"})}return{...W}}return{error:Je,info:aLe}}return t?.element.extensions?(t.element.extensions=t.element.extensions.filter(e=>e?.name!==t.name),{...W}):{...W,info:Br}}function ml({requiredAttributes:t=["name","value"],extension:e}){if(!e||typeof e!="object"||typeof e.name!="string")return!1;let i=Object.keys(e);return t.filter(r=>i.includes(r)).length===t.length}function Ft(t){if(typeof t!="object")return{error:Je};let e="addExtension";if(t?.element&&typeof t.element!="object")return q({result:{error:re},stack:e});if(!ml({extension:t.extension}))return q({result:{error:re,info:"invalid extension"},stack:e});if(!t.element)if(t.discover&&!t.tournamentId&&t.tournamentRecords){for(let r of Object.values(t.tournamentRecords)){let n=Ft({extension:t.extension,element:r});if(n.error)return q({result:n,stack:e})}return{...W}}else return q({result:{error:Je},stack:e});if(t.element.extensions||(t.element.extensions=[]),t?.creationTime??!0){let r=new Date().toISOString();Object.assign(t.extension,{createdAt:r})}let i=t.element.extensions.find(({name:r})=>r===t.extension.name);return i?i.value=t.extension.value:t.extension.value&&t.element.extensions.push(t.extension),{...W}}function qB(t){return!t||typeof t!="object"?{error:Je}:t.tournamentRecord?Ft({creationTime:t.creationTime,element:t.tournamentRecord,extension:t.extension}):{error:ve}}function LM(t){return!t||typeof t!="object"?{error:Je}:t.drawDefinition?Ft({creationTime:t.creationTime,element:t.drawDefinition,extension:t.extension}):{error:_a}}function Yd(t){return!t||typeof t!="object"?{error:Je}:t.event?Ft({creationTime:t.creationTime,extension:t.extension,element:t.event}):{error:ps}}function tne(t){if(!t||typeof t!="object")return{error:Je};if(!t.participantId)return{error:dr};let e=t.tournamentRecord?.participants||[],i=Ud({participantId:t.participantId,tournamentParticipants:e});return i?Ft({creationTime:t.creationTime,extension:t.extension,element:i}):{error:ji}}function YB(t){return!t||typeof t!="object"?{error:Je}:t.tournamentRecord?Nn({element:t.tournamentRecord,name:t.name}):{error:ve}}function ine(t){return!t||typeof t!="object"?{error:Je}:t.drawDefinition?Nn({element:t.drawDefinition,name:t.name}):{error:_a}}function _M(t){return!t||typeof t!="object"?{error:Je}:t?.event?Nn({element:t.event,name:t.name}):{error:ps}}function rne(t){if(!t||typeof t!="object")return{error:Je};if(!t.participantId)return{error:dr};let e=t.tournamentRecord?.participants||[],i=Ud({participantId:t.participantId,tournamentParticipants:e});return i?Nn({element:i,name:t.name}):{error:ji}}function pU({tournamentRecords:t}){return{tournamentIds:wt(t)?Object.keys(t):[],...W}}var oLe="extensionQueries";function ht({discover:t,element:e,name:i,...r}){if(!e||!i){if(t&&r){let a=Object.keys(r).filter(l=>typeof t=="boolean"||Array.isArray(t)&&t.includes(l)).find(l=>Array.isArray(r[l]?.extensions)?r[l].extensions.find(u=>u?.name===i):!1),s=a&&r[a];!s&&r.tournamentRecords&&(s=Object.values(r.tournamentRecords).find(l=>l.extensions?.length));let o=s?.extensions?.find(l=>l?.name===i);return{extension:o,info:o?void 0:Br}}return q({result:{error:Je},stack:oLe})}if(!Array.isArray(e.extensions))return{info:"no extensions"};let n=e.extensions.find(a=>a?.name===i);return{extension:n,info:n?void 0:Br}}var lLe="activeSuspension",Qb="appliedPolicies",nne="context",$M="delegatedOutcome",bo="disabled",Gm="disableAutoCalc",BM="disableLinks",GP="display",vp="drawDeletions",uLe="drawProfile",HP="entryProfile",cLe="eventProfile",dLe="eventWithdrawalRequests",pLe="factory",to="flightProfile",bx="groupingAttribute",Uc="lineUps",Hp="linkedTournamentsIds",KB="participantRepresentatives",Bv="personRequests",Gg="positionActions",fLe="rankingPoints",mLe="registration",El="roundTarget",fU="scheduleLimits",Tc="scheduleTiming",Hm="schedulingProfile",hLe="statusDetail",MI="subOrder",Dc="tally",qy="tieFormatModification",ane={ACTIVE_SUSPENSION:lLe,APPLIED_POLICIES:Qb,CONTEXT:nne,DELEGATED_OUTCOME:$M,DISABLED:bo,DISABLE_LINKS:BM,DISABLE_AUTO_CALC:Gm,DISPLAY:GP,DRAW_DELETIONS:vp,DRAW_PROFILE:uLe,ENTRY_PROFILE:HP,EVENT_PROFILE:cLe,EVENT_WITHDRAWAL_REQUESTS:dLe,FLIGHT_PROFILE:to,GROUPING_ATTRIBUTE:bx,LINEUPS:Uc,LINKED_TOURNAMENTS:Hp,PARTICIPANT_REPRESENTATIVES:KB,PERSON_REQUESTS:Bv,POSITION_ACTIONS:Gg,RANKING_POINTS:fLe,REGISTRATION:mLe,ROUND_TARGET:El,SCHEDULE_LIMITS:fU,SCHEDULE_TIMING:Tc,SCHEDULING_PROFILE:Hm,STATUS_DETAIL:hLe,SUB_ORDER:MI,TALLY:Dc,TIE_FORMAT_MODIFICATIONS:qy,FACTORY:pLe},Zz=[$M,bo,Gm,BM,to,Uc,Hp,KB,Bv,El,fU,Tc,Hm,MI,Dc,qy];function sne({tournamentRecords:t}){if(typeof t!="object"||!Object.keys(t).length)return{error:Mi};let e=pU({tournamentRecords:t}),{tournamentIds:i}=e;return i?.length>1?Ft({tournamentRecords:t,discover:!0,extension:{name:Hp,value:{tournamentIds:i}}}):{...W}}function one({tournamentRecords:t}){if(typeof t!="object"||!Object.keys(t).length)return{error:Mi};let e=Nn({name:Hp,tournamentRecords:t,discover:!0});return q({result:e,stack:"unlinkTournaments"})}function lne({tournamentRecords:t,tournamentId:e}){if(typeof t!="object")return{error:re};if(!e)return{error:yI};let i=pU({tournamentRecords:t}),{tournamentIds:r}=i;if(!r.includes(e))return{error:yI};let n;return r.every(a=>{let s=t[a],{extension:o}=ht({element:s,name:Hp});if(!o)return!0;let l=o?.value?.tournamentIds||[];if(!l?.length||l.length===1&&l.includes(e)||a===e){let d=YB({name:Hp,tournamentRecord:s});return d.error&&(n=d.error),d.success}let u=l.filter(d=>d!==e);o.value={tournamentIds:u};let c=qB({tournamentRecord:s,extension:o});return c.error&&(n=c.error),c.success}),n?{error:n}:{...W}}var une={};dt(une,{getLinkedTournamentIds:()=>mU,getTournamentIds:()=>pU});function mU({tournamentRecords:t}){return typeof t!="object"||!Object.keys(t).length?{error:Mi}:{linkedTournamentIds:Object.assign({},...Object.keys(t).map(e=>{let i=t[e],r=i?.tournamentId,{extension:n}=ht({element:i,name:Hp}),a=(n?.value?.tournamentIds||[]).filter(s=>s!==r);return{[e]:a}}))}}var cne={};dt(cne,{adHocPositionSwap:()=>Sse,addAdHocMatchUps:()=>hN,addDrawDefinitionTimeItem:()=>iV,addFinishingRounds:()=>MU,addGoesTo:()=>zp,addPlayoffStructures:()=>mN,addQualifyingStructure:()=>wse,addVoluntaryConsolationStage:()=>mse,addVoluntaryConsolationStructure:()=>G2,allPlayoffPositionsFilled:()=>Z2,alternateDrawPositionAssignment:()=>ese,assignDrawPosition:()=>_se,assignDrawPositionBye:()=>Ja,attachConsolationStructures:()=>Ose,attachPlayoffStructures:()=>gV,attachQualifyingStructure:()=>tV,attachStructures:()=>fN,autoSeeding:()=>oHe,automatedPlayoffPositioning:()=>Kv,automatedPositioning:()=>BU,buildDrawHierarchy:()=>aHe,checkValidEntries:()=>yN,deleteAdHocMatchUps:()=>Bse,drawMatic:()=>ZV,findDrawDefinition:()=>wV,generateAdHocMatchUps:()=>bN,generateAdHocRounds:()=>QV,generateAndPopulatePlayoffStructures:()=>mV,generateDrawDefinition:()=>rT,generateDrawMaticRound:()=>CV,generateDrawStructuresAndLinks:()=>PV,generateDrawTypeAndModifyDrawDefinition:()=>EV,generateQualifyingStructure:()=>lV,generateVoluntaryConsolation:()=>voe,getAssignedParticipantIds:()=>Pf,getAvailableMatchUpsCount:()=>gN,getAvailablePlayoffProfiles:()=>GU,getDrawDefinitionTimeItem:()=>h2,getDrawParticipantRepresentativeIds:()=>yV,getDrawStructures:()=>io,getDrawTypeCoercion:()=>XU,getEligibleVoluntaryConsolationParticipants:()=>vV,getMatchUpsMap:()=>Or,getParticipantIdFinishingPositions:()=>bV,getPositionAssignments:()=>OI,getPositionsPlayedOff:()=>Xv,getRandomQualifierList:()=>TV,getSeedingThresholds:()=>q2,getSeedsCount:()=>JU,getStructureSeedAssignments:()=>hs,getTeamLineUp:()=>Wp,getValidGroupSizes:()=>_U,isAdHoc:()=>Hn,isCompletedStructure:()=>Su,isValidForQualifying:()=>DV,luckyLoserDrawPositionAssignment:()=>Yae,modifyDrawDefinition:()=>xse,modifyDrawName:()=>IV,modifySeedAssignment:()=>ose,mutate:()=>dne,positionActions:()=>UV,pruneDrawDefinition:()=>Lse,qualifierDrawPositionAssignment:()=>eV,qualifierProgression:()=>lse,query:()=>Gse,removeDrawPositionAssignment:()=>rw,removeRoundMatchUps:()=>Vse,removeSeededParticipant:()=>bse,removeStructure:()=>pse,renameStructures:()=>dse,resetDrawDefinition:()=>Fse,resetQualifyingStructure:()=>hse,resetVoluntaryConsolationStructure:()=>Ene,setDrawParticipantRepresentativeIds:()=>pne,setPositionAssignments:()=>Qae,setStructureOrder:()=>use,setSubOrder:()=>jse,shiftAdHocRounds:()=>Jae,swapAdHocRounds:()=>Zae,swapDrawPositionAssignments:()=>vse,updateTeamLineUp:()=>Jh,withdrawParticipantAtDrawPosition:()=>Bae});var dne={};dt(dne,{adHocPositionSwap:()=>Sse,addAdHocMatchUps:()=>hN,addDrawDefinitionTimeItem:()=>iV,addPlayoffStructures:()=>mN,addQualifyingStructure:()=>wse,addVoluntaryConsolationStage:()=>mse,addVoluntaryConsolationStructure:()=>G2,alternateDrawPositionAssignment:()=>ese,assignDrawPosition:()=>_se,assignDrawPositionBye:()=>Ja,attachConsolationStructures:()=>Ose,attachPlayoffStructures:()=>gV,attachQualifyingStructure:()=>tV,attachStructures:()=>fN,automatedPlayoffPositioning:()=>Kv,automatedPositioning:()=>BU,deleteAdHocMatchUps:()=>Bse,luckyLoserDrawPositionAssignment:()=>Yae,modifyDrawDefinition:()=>xse,modifyDrawName:()=>IV,modifySeedAssignment:()=>ose,pruneDrawDefinition:()=>Lse,qualifierDrawPositionAssignment:()=>eV,qualifierProgression:()=>lse,removeDrawPositionAssignment:()=>rw,removeRoundMatchUps:()=>Vse,removeSeededParticipant:()=>bse,removeStructure:()=>pse,renameStructures:()=>dse,resetDrawDefinition:()=>Fse,resetQualifyingStructure:()=>hse,resetVoluntaryConsolationStructure:()=>Ene,setDrawParticipantRepresentativeIds:()=>pne,setPositionAssignments:()=>Qae,setStructureOrder:()=>use,setSubOrder:()=>jse,shiftAdHocRounds:()=>Jae,swapAdHocRounds:()=>Zae,swapDrawPositionAssignments:()=>vse,updateTeamLineUp:()=>Jh,withdrawParticipantAtDrawPosition:()=>Bae});var XB=t=>e=>t[e],JB=(t=[])=>t.map(vr).filter(Boolean),wx=(t=[])=>t.map(yt).filter(Boolean),yt=(t={})=>XB(t)("participantId"),vr=(t={})=>XB(t)("matchUpId"),Zb=(t={})=>XB(t)("drawId");function pne({representativeParticipantIds:t,drawDefinition:e}){if(!e)return{error:_a};if(!Array.isArray(t))return{error:re};let i=wx(e?.entries||[]);return t.length&&Li(t,i).length<t.length?{error:re}:LM({drawDefinition:e,extension:{name:KB,value:t}})}var Ta="ABANDONED",$h="AWAITING_RESULT",Rl="CANCELLED",Oi="COMPLETED",Vv="DEAD_RUBBER",qt="DEFAULTED",Wi="DOUBLE_DEFAULT",Si="DOUBLE_WALKOVER",lo="IN_PROGRESS",Da="INCOMPLETE",QB="NOT_PLAYED",Sr="RETIRED",Kd="SUSPENDED",_i="TO_BE_PLAYED",ai="WALKOVER",gLe=[$h,Oi,qt,lo,Da,Sr,Kd],fne=[$h,Oi,qt,Si,Wi,lo,Da,Sr,Kd,ai],mne=[Ta,$h,"BYE",Rl,Oi,Vv,qt,Si,Wi,lo,Da,QB,Sr,Kd,_i,ai],hne=["BYE",Si,Wi,Oi,qt,Sr,ai],gne=[Ta,$h,Rl,Vv,lo,Da,QB,Kd,_i,void 0],Ki=[Rl,Ta,Oi,Vv,qt,Si,Wi,Sr,ai],ZB=[Ta,Oi,qt,Si,Wi,lo,Sr,ai],Ine=[lo,Da,Kd,_i],VM={ABANDONED:Ta,AWAITING_RESULT:$h,BYE:"BYE",CANCELLED:Rl,COMPLETED:Oi,DEAD_RUBBER:Vv,DEFAULTED:qt,DOUBLE_WALKOVER:Si,DOUBLE_DEFAULT:Wi,IN_PROGRESS:lo,INCOMPLETE:Da,NOT_PLAYED:QB,RETIRED:Sr,SUSPENDED:Kd,TO_BE_PLAYED:_i,WALKOVER:ai};function Bh(t,e,i){let r=d=>ht({element:d,name:El})?.extension?.value,n=i?.deprioritizeCompleted,a=i?.mode===_re&&NFe,s=i?.mode===Lre&&$re,o=s||a||Vm,l=d=>d?.stage===Ae&&d?.stageSequence===1,u=d=>l(d)?-1:o[d?.stage],c=d=>d?.matchUps.every(({matchUpStatus:p})=>Ki.includes(p)?1:-1);return n&&c(t)-c(e)||a&&u(t)-u(e)||(t?.stage&&o[t.stage]||0)-(e?.stage&&o[e.stage]||0)||(r(t)||0)-(r(e)||0)||!s&&!a&&(e?.positionAssignments?.length??1/0)-(t?.positionAssignments?.length??1/0)||(t?.stageSequence??0)-(e?.stageSequence??0)||(WP(t)||0)-(WP(e)||0)}function WP(t){return(t?.matchUps||[]).reduce((e,i)=>{let r=(i.finishingPositionRange?.winner||[]).reduce((n,a)=>n+a,0);return!e||r<e?r:e},void 0)}function tt(t){let e=He(t,[{[In]:!0,[NM]:!0}]);if(e.error)return e;let{drawDefinition:i,structureId:r}=t,{structures:n}=io({drawDefinition:i}),a=n?.flatMap(l=>l.structures?[...l.structures].concat(l):l),s=a?.find(l=>l.structureId===r);if(!s)return{error:vi};let o=s.structureType===RM?a?.find(l=>l.structures?.some(u=>u.structureId===r)):void 0;return{structure:s,containingStructure:o}}function io({withStageGrouping:t,drawDefinition:e,stageSequences:i,stageSequence:r,roundTarget:n,sortConfig:a,stages:s,stage:o}){let l=!e&&$e||!e?.structures&&eB||void 0;if(l)return{error:l,structures:[],stageStructures:{}};let u=m=>{let h=ht({element:m,name:El})?.extension?.value;return!n||n===h},c=e?.structures?.filter(p).filter(f).filter(u).sort((m,h)=>Bh(m,h,a))??[],d=t?Object.assign({},...PM.map(m=>{let h=c?.filter(g=>g.stage===m);return h?.length&&{[m]:h}}).filter(Boolean)):{};return{structures:c,stageStructures:d};function p(m){return!o&&!Array.isArray(s)||o&&m.stage===o||Array.isArray(s)&&s.includes(m.stage)}function f(m){return!r&&!Array.isArray(i)||r&&m.stageSequence===r||Array.isArray(i)&&i.includes(m.stageSequence)}}function vne({drawDefinition:t}){if(!t)return{error:$e};let e={};return{allPositionedParticipantIds:(t.structures||[]).map(i=>{let r=i.stage;e[r]||(e[r]=[]);let{positionAssignments:n}=Kt({structure:i}),a=n?.map(yt).filter(Boolean)??[];return e[r].push(...a),a}).flat(),stagePositionedParticipantIds:e}}function Kt({drawDefinition:t,structureId:e,structure:i}){let r,n=[];if(!i){if(!t)return{positionAssignments:n,error:$e};if({structure:i,error:r}=tt({drawDefinition:t,structureId:e}),r)return{positionAssignments:n,error:r}}return i.structures?n=[].concat(...i.structures.map(a=>Kt({structure:a}).positionAssignments)):i.positionAssignments?n=i.positionAssignments:r=_te,{positionAssignments:n,error:r}}function pr({drawDefinition:t,structureId:e,structure:i}){let r=Kt({drawDefinition:t,structureId:e,structure:i})?.positionAssignments||[],n=r?.filter(u=>u.participantId??u.bye??u.qualifier),a=r&&r?.length===n?.length,s=r?.filter(u=>!u.participantId&&!u.bye&&!u.qualifier),o=r?.filter(u=>!u.participantId&&u.bye),l=r?.filter(u=>!u.participantId&&u.qualifier);return{allPositionsAssigned:a,positionAssignments:r,unassignedPositions:s,assignedPositions:n,qualifierPositions:l,byePositions:o}}var e2="addDrawDefinition",jM="addMatchUps",Td="addParticipants",t2="addScaleItems",yne="addEvent",bne="addVenue",ec="audit",i2="dataIssue",r2="deleteParticipants",n2="deleteVenue",a2="deletedDrawIds",s2="deletedMatchUpIds",o2="modifyDrawDefinition",wne="modifyDrawEntries",Sne="modifyEventEntries",l2="modifyMatchUp",rn="modifyParticipants",u2="modifyPositionAssignments",c2="modifySeedAssignments",yf="modifyTournamentDetail",jc="modifyVenue",Sx="mutations",Ux="publishEvent",Une="publishEventSeeding",Tne="publishOrderOfPlay",Dne="publishParticipants",d2="unPublishEvent",p2="unPublishEventSeeding",f2="unPublishOrderOfPlay",ILe="unPublishParticipants",GM="updateInContextMatchUp",vLe={ADD_DRAW_DEFINITION:e2,ADD_MATCHUPS:jM,ADD_PARTICIPANTS:Td,ADD_SCALE_ITEMS:t2,ADD_EVENT:yne,ADD_VENUE:bne,AUDIT:ec,DATA_ISSUE:i2,DELETE_PARTICIPANTS:r2,DELETE_VENUE:n2,DELETED_DRAW_IDS:a2,DELETED_MATCHUP_IDS:s2,MODIFY_DRAW_DEFINITION:o2,MODIFY_DRAW_ENTRIES:wne,MODIFY_EVENT_ENTRIES:Sne,MODIFY_MATCHUP:l2,MODIFY_PARTICIPANTS:rn,MODIFY_POSITION_ASSIGNMENTS:u2,MODIFY_SEED_ASSIGNMENTS:c2,MODIFY_TOURNAMENT_DETAIL:yf,MODIFY_VENUE:jc,MUTATIONS:Sx,PUBLISH_EVENT_SEEDING:Une,PUBLISH_EVENT:Ux,PUBLISH_ORDER_OF_PLAY:Tne,PUBLISH_PARTICIPANTS:Dne,UNPUBLISH_EVENT_SEEDING:p2,UNPUBLISH_EVENT:d2,UNPUBLISH_ORDER_OF_PLAY:f2,UPDATE_INCONTEXT_MATCHUP:GM};function HM(t,e){if(!t)return{error:$e};let i=Date.now();t.updatedAt&&i===new Date(t.updatedAt).getTime()&&(i+=1);let r=new Date(i).toISOString(),n=e?.filter(Boolean);return t.updatedAt=r,t.structures?.filter(Boolean).forEach(a=>{(!n?.length||n?.includes(a.structureId))&&(a.updatedAt=r)}),{...W}}function Dd({drawDefinition:t,tournamentId:e,matchUps:i,eventId:r}){return t&&HM(t),st({payload:{matchUps:i,tournamentId:e,eventId:r},topic:jM}),{...W}}function ku({drawDefinition:t,tournamentId:e,matchUpIds:i,eventId:r,action:n}){t&&HM(t),st({topic:s2,payload:{tournamentId:e,matchUpIds:i,eventId:r,action:n}});for(let a of i)UB({key:a});return{...W}}function Ut({drawDefinition:t,tournamentId:e,structureId:i,context:r,eventId:n,matchUp:a}){return a?(t&&ii({drawDefinition:t,structureIds:i?[i]:void 0,tournamentId:e,eventId:n}),st({topic:l2,payload:{matchUp:a,tournamentId:e,context:r},key:a.matchUpId}),{...W}):(console.log(sa),{error:sa})}function yLe({tournamentId:t,inContextMatchUp:e}){return e?(st({payload:{inContextMatchUp:e,tournamentId:t},topic:GM,key:e.matchUpId}),{...W}):{error:sa}}function hU({tournamentId:t,eventId:e,drawDefinition:i}){return i?(HM(i),st({payload:{drawDefinition:i,tournamentId:t,eventId:e},topic:e2,key:i.drawId}),{...W}):(console.log($e),{error:$e})}function bLe({tournamentId:t,eventId:e,drawId:i}){return st({payload:{drawId:i,tournamentId:t,eventId:e},topic:a2,key:i}),UB({key:i}),{...W}}function ii({drawDefinition:t,tournamentId:e,structureIds:i,eventId:r}){return t?(HM(t,i),st({payload:{tournamentId:e,eventId:r,drawDefinition:t},topic:o2,key:t.drawId}),{...W}):{error:$e}}function Pne({drawDefinition:t,tournamentId:e,structure:i,eventId:r}){if(!t)return{error:$e};if(!i)return{error:hf};let n=i.seedAssignments,a=i.structureId,s=t.drawId;return st({payload:{tournamentId:e,eventId:r,drawId:s,structureId:a,seedAssignments:n},topic:c2,key:t.drawId}),ii({structureIds:[a],drawDefinition:t,tournamentId:e,eventId:r}),{...W}}function Pc({drawDefinition:t,tournamentId:e,structure:i,event:r}){if(!t)return{error:$e};if(!i)return{error:hf};let n=Kt({structure:i}),a=i.structureId,s=t.drawId,o=r?.eventId;return st({topic:u2,payload:{positionAssignments:n,tournamentId:e,structureId:a,eventId:o,drawId:s},key:a}),ii({structureIds:[a],drawDefinition:t,tournamentId:e,eventId:o}),{...W}}function Ene({tournamentRecord:t,drawDefinition:e,resetEntries:i,event:r}){if(!e)return{error:$e};let n=e.structures?.find(s=>s.stage===Cr);if(!n)return{error:vi};let a=n.matchUps?.map(({matchUpId:s})=>s)||[];return n.positionAssignments=[],n.seedAssignments=[],n.matchUps=[],ku({tournamentId:t?.tournamentId,action:"resetVoluntaryConsolationStructure",matchUpIds:a,drawDefinition:e}),i&&(e.entries=e.entries.filter(s=>s.entryStage!==Cr)),ii({tournamentId:t?.tournamentId,eventId:r?.eventId,drawDefinition:e,structureIds:[n.structureId]}),{...W}}function m2({drawPositions:t,structure:e}){if([ze,Ae].includes(e.stage)&&e.stageSequence===1)return;let{positionAssignments:i}=Kt({structure:e});i?.filter(({drawPosition:r})=>t?.includes(r))?.forEach(r=>{Ft({element:r,extension:{name:BM,value:!0}})})}function gU(t){let{appliedPolicies:e,positionAction:i,drawDefinition:r}=t;if(e?.audit?.[Gg]===!1)return;let{extension:n}=ht({name:Gg,element:r}),a=Array.isArray(n?.value)?n?.value??[]:[];if(!a?.length){let o=r.structures.find(l=>l.stage===Ae);if(o){let l=Kt({structure:o}).positionAssignments?.map(({drawPosition:u,participantId:c,bye:d,qualifier:p})=>({drawPosition:u,participantId:c,qualifier:p,bye:d}));a.push({name:"initialMainAssignments",initialAssignments:l})}}let s={value:a.concat(i),name:Gg};Ft({element:r,extension:s})}function jv({tournamentRecord:t,drawDefinition:e,event:i}){let r=(t?.events||i&&[i])?.map(o=>o?.drawDefinitions).flat().filter(Boolean)||e&&[e]||[],n={},a={},s=r.map(o=>o?.structures?.filter(l=>l?.structures)).flat().filter(Boolean);for(let o of s){let{structures:l,structureId:u}=o??{};l&&u&&(n[u]=l?.map(c=>c.structureId))&&l.forEach(c=>a[c.structureId]=o?.structureId)}return{containedStructures:n,containerStructures:a}}function WM(t){let{sides:e,matchUpType:i}=t||{},r=t.potentialParticipants?.length?t.potentialParticipants.flat().map(a=>i===Bt?a?.individualParticipantIds||[]:a.participantId).flat():[],n=(e||[]).map(a=>i===Bt&&(a?.participant?.individualParticipantIds||[])||a?.participantId&&[a.participantId]||[]).flat();return{individualParticipantIds:n.concat(r).flat(),enteredIndividualParticipantIds:n,potentialIndividualParticipantIds:r}}function ws(t){return t?.tournamentRecords??(t?.tournamentRecord&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord})??{}}var IU="SIGN_IN_STATUS",Rne="SIGNED_OUT",ew="SIGNED_IN",$n="TEAM",It="INDIVIDUAL",Ya="GROUP",ft="PAIR",_t="TEAM",Yy={TEAM_PARTICIPANT:$n,INDIVIDUAL:It,GROUP:Ya,TEAM:_t,PAIR:ft},wLe={INDIVIDUAL:It,GROUP:Ya,PAIR:ft,TEAM:_t,SIGN_IN_STATUS:IU,SIGNED_OUT:Rne,SIGNED_IN:ew};function zM({participantsProfile:t,participants:e=[],deepCopy:i}){let r=new Map,n=i!==!1?Oe(e,t?.convertExtensions,!0):e,a=n.filter(l=>l.participantType===_t),s=n.filter(l=>l.participantType===Ya),o=n.filter(l=>l.participantType===ft);return n.forEach(l=>{if(l.participantType===It){let{participantId:u}=l;l.groupParticipantIds=[],l.teamParticipantIds=[],l.pairParticipantIds=[],l.groups=[],l.teams=[],a.forEach(c=>{(c?.individualParticipantIds||[]).forEach(d=>{d===u&&!l.teamParticipantIds?.includes(c.participantId)&&(l.teamParticipantIds.push(c.participantId),r.get(c.participantId)||r.set(c.participantId,{participantName:c.participantName,participantId:c.participantId}),l.teams.push({participantRoleResponsibilities:c.participantRoleResponsibilities,participantOtherName:c.participantOtherName,participantName:c.participantName,participantId:c.participantId,teamId:c.teamId}))})}),o.forEach(c=>{(c?.individualParticipantIds||[]).forEach(d=>{d===u&&!l.pairParticipantIds.includes(c.participantId)&&l.pairParticipantIds.push(c.participantId)})}),s.forEach(c=>{(c?.individualParticipantIds||[]).forEach(d=>{d===u&&!l.groupParticipantIds.includes(c.participantId)&&(l.groupParticipantIds.push(c.participantId),l.groups.push({participantRoleResponsibilities:c.participantRoleResponsibilities,participantOtherName:c.participantOtherName,participantName:c.participantName,participantId:c.participantId}))})})}}),{participantsWithGroupings:n,groupInfo:Object.fromEntries(r)}}function Cne(t){return t&&typeof String.fromCodePoint<"u"?t.toUpperCase().replace(/./g,e=>String.fromCodePoint(e.charCodeAt(0)+127397)):t}function SLe(t){let e=Object.assign({},...cd.filter(i=>i.ioc).map(i=>({[i.ioc]:i.iso})));return Cne(e[t])}var cd=[{ioc:"",iso2:"",iso:"",label:"NONE",phone:""},{ioc:"AND",iso2:"AD",iso:"AND",label:"Andorra",phone:"376"},{ioc:"UAE",iso2:"AE",iso:"ARE",label:"United Arab Emirates",phone:"971"},{ioc:"AFG",iso2:"AF",iso:"AFG",label:"Afghanistan",phone:"93"},{ioc:"ANT",iso2:"AG",iso:"ATG",label:"Antigua and Barbuda",phone:"1-268"},{ioc:"AIA",iso2:"AI",iso:"AIA",label:"Anguilla",phone:"1-264"},{ioc:"ALB",iso2:"AL",iso:"ALB",label:"Albania",phone:"355"},{ioc:"ARM",iso2:"AM",iso:"ARM",label:"Armenia",phone:"374"},{ioc:"ANG",iso2:"AO",iso:"AGO",label:"Angola",phone:"244"},{ioc:"",iso2:"AQ",iso:"ATA",label:"Antarctica",phone:"672"},{ioc:"ARG",iso2:"AR",iso:"ARG",label:"Argentina",phone:"54"},{ioc:"ASA",iso2:"AS",iso:"ASM",label:"American Samoa",phone:"1-684"},{ioc:"AUT",iso2:"AT",iso:"AUT",label:"Austria",phone:"43"},{ioc:"AUS",iso2:"AU",iso:"AUS",label:"Australia",phone:"61",suggested:!0},{ioc:"ARU",iso2:"AW",iso:"ABW",label:"Aruba",phone:"297"},{ioc:"AZE",iso2:"AZ",iso:"AZE",label:"Azerbaijan",phone:"994"},{ioc:"BIH",iso2:"BA",iso:"BIH",label:"Bosnia and Herzegovina",phone:"387"},{ioc:"BAR",iso2:"BB",iso:"BRB",label:"Barbados",phone:"1-246"},{ioc:"BAN",iso2:"BD",iso:"BGD",label:"Bangladesh",phone:"880"},{ioc:"BEL",iso2:"BE",iso:"BEL",label:"Belgium",phone:"32"},{ioc:"BUR",iso2:"BF",iso:"BFA",label:"Burkina Faso",phone:"226"},{ioc:"BUL",iso2:"BG",iso:"BGR",label:"Bulgaria",phone:"359"},{ioc:"BRN",iso2:"BH",iso:"BHR",label:"Bahrain",phone:"973"},{ioc:"BDI",iso2:"BI",iso:"BDI",label:"Burundi",phone:"257"},{ioc:"BEN",iso2:"BJ",iso:"BEN",label:"Benin",phone:"229"},{ioc:"",iso2:"BL",iso:"BLM",label:"Saint Barthelemy",phone:"590"},{ioc:"BER",iso2:"BM",iso:"BMU",label:"Bermuda",phone:"1-441"},{ioc:"BRU",iso2:"BN",iso:"BRN",label:"Brunei Darussalam",phone:"673"},{ioc:"BOL",iso2:"BO",iso:"BOL",label:"Bolivia",phone:"591"},{ioc:"BRA",iso2:"BR",iso:"BRA",label:"Brazil",phone:"55"},{ioc:"BAH",iso2:"BS",iso:"BHS",label:"Bahamas",phone:"1-242"},{ioc:"BHU",iso2:"BT",iso:"BTN",label:"Bhutan",phone:"975"},{ioc:"",iso2:"BV",iso:"BVT",label:"Bouvet Island",phone:"47"},{ioc:"BOT",iso2:"BW",iso:"BWA",label:"Botswana",phone:"267"},{ioc:"BLR",iso2:"BY",iso:"BLR",label:"Belarus",phone:"375"},{ioc:"BIZ",iso2:"BZ",iso:"BLZ",label:"Belize",phone:"501"},{ioc:"CAN",iso2:"CA",iso:"CAN",label:"Canada",phone:"1",suggested:!0},{ioc:"",iso2:"CC",iso:"CCK",label:"Cocos (Keeling) Islands",phone:"61"},{ioc:"CGO",iso2:"CD",iso:"COG",label:"Congo, Republic of the",phone:"242"},{ioc:"CAF",iso2:"CF",iso:"CAF",label:"Central African Republic",phone:"236"},{ioc:"COD",iso2:"CG",iso:"CGD",label:"Congo, Democratic Republic of the",phone:"243"},{ioc:"SUI",iso2:"CH",iso:"CHE",label:"Switzerland",phone:"41"},{ioc:"CIV",iso2:"CI",iso:"CIV",label:"Cote d'Ivoire",phone:"225"},{ioc:"COK",iso2:"CK",iso:"COK",label:"Cook Islands",phone:"682"},{ioc:"CHI",iso2:"CL",iso:"CHL",label:"Chile",phone:"56"},{ioc:"CMR",iso2:"CM",iso:"CMR",label:"Cameroon",phone:"237"},{ioc:"CHN",iso2:"CN",iso:"CHN",label:"China",phone:"86"},{ioc:"COL",iso2:"CO",iso:"COL",label:"Colombia",phone:"57"},{ioc:"CRC",iso2:"CR",iso:"CRI",label:"Costa Rica",phone:"506"},{ioc:"CUB",iso2:"CU",iso:"CUB",label:"Cuba",phone:"53"},{ioc:"CPV",iso2:"CV",iso:"CPV",label:"Cape Verde",phone:"238"},{ioc:"CUW",iso2:"CW",iso:"CUW",label:"Curacao",phone:"599"},{ioc:"CXR",iso2:"CX",iso:"CXR",label:"Christmas Island",phone:"61"},{ioc:"CYP",iso2:"CY",iso:"CYP",label:"Cyprus",phone:"357"},{ioc:"CZE",iso2:"CZ",iso:"CZE",label:"Czech Republic",phone:"420"},{ioc:"GER",iso2:"DE",iso:"DEU",label:"Germany",phone:"49",suggested:!0},{ioc:"DJI",iso2:"DJ",iso:"DJI",label:"Djibouti",phone:"253"},{ioc:"DEN",iso2:"DK",iso:"DNK",label:"Denmark",phone:"45"},{ioc:"DMA",iso2:"DM",iso:"DMA",label:"Dominica",phone:"1-767"},{ioc:"DOM",iso2:"DO",iso:"DOM",label:"Dominican Republic",phone:"1-809"},{ioc:"ALG",iso2:"DZ",iso:"DZA",label:"Algeria",phone:"213"},{ioc:"ECU",iso2:"EC",iso:"ECU",label:"Ecuador",phone:"593"},{ioc:"EST",iso2:"EE",iso:"ESE",label:"Estonia",phone:"372"},{ioc:"EGY",iso2:"EG",iso:"EGY",label:"Egypt",phone:"20"},{ioc:"",iso2:"EH",iso:"ESH",label:"Western Sahara",phone:"212"},{ioc:"ERI",iso2:"ER",iso:"ERI",label:"Eritrea",phone:"291"},{ioc:"ESP",iso2:"ES",iso:"ESP",label:"Spain",phone:"34"},{ioc:"ETH",iso2:"ET",iso:"ETH",label:"Ethiopia",phone:"251"},{ioc:"FIN",iso2:"FI",iso:"FIN",label:"Finland",phone:"358"},{ioc:"FIJ",iso2:"FJ",iso:"FJI",label:"Fiji",phone:"679"},{ioc:"FLK",iso2:"FK",iso:"FLK",label:"Falkland Islands (Malvinas)",phone:"500"},{ioc:"FSM",iso2:"FM",iso:"FSM",label:"Micronesia, Federated States of",phone:"691"},{ioc:"FAR",iso2:"FO",iso:"FRO",label:"Faroe Islands",phone:"298"},{ioc:"FRA",iso2:"FR",iso:"FRA",label:"France",phone:"33",suggested:!0},{ioc:"GAB",iso2:"GA",iso:"GAB",label:"Gabon",phone:"241"},{ioc:"GBR",iso2:"GB",iso:"GBR",label:"United Kingdom",phone:"44"},{ioc:"GRN",iso2:"GD",iso:"GRD",label:"Grenada",phone:"1-473"},{ioc:"GEO",iso2:"GE",iso:"GEO",label:"Georgia",phone:"995"},{ioc:"FGU",iso2:"GF",iso:"GUF",label:"French Guiana",phone:"594"},{ioc:"",iso2:"GG",iso:"GGY",label:"Guernsey",phone:"44"},{ioc:"",iso2:"GH",iso:"GHA",label:"Ghana",phone:"233"},{ioc:"GIB",iso2:"GI",iso:"GIB",label:"Gibraltar",phone:"350"},{ioc:"GRL",iso2:"GL",iso:"GRL",label:"Greenland",phone:"299"},{ioc:"GAM",iso2:"GM",iso:"GMB",label:"Gambia",phone:"220"},{ioc:"GUI",iso2:"GN",iso:"GIN",label:"Guinea",phone:"224"},{ioc:"GUD",iso2:"GP",iso:"GLP",label:"Guadeloupe",phone:"590"},{ioc:"GEQ",iso2:"GQ",iso:"GNQ",label:"Equatorial Guinea",phone:"240"},{ioc:"GRE",iso2:"GR",iso:"GRC",label:"Greece",phone:"30"},{ioc:"",iso2:"GS",iso:"SGS",label:"South Georgia and the South Sandwich Islands",phone:"500"},{ioc:"GUA",iso2:"GT",iso:"GTM",label:"Guatemala",phone:"502"},{ioc:"GUM",iso2:"GU",iso:"GUM",label:"Guam",phone:"1-671"},{ioc:"GBS",iso2:"GW",iso:"GNB",label:"Guinea-Bissau",phone:"245"},{ioc:"GUY",iso2:"GY",iso:"GUY",label:"Guyana",phone:"592"},{ioc:"HKG",iso2:"HK",iso:"HKG",label:"Hong Kong",phone:"852"},{ioc:"",iso2:"HM",iso:"HMD",label:"Heard Island and McDonald Islands",phone:"672"},{ioc:"HON",iso2:"HN",iso:"HND",label:"Honduras",phone:"504"},{ioc:"CRO",iso2:"HR",iso:"HRV",label:"Croatia",phone:"385"},{ioc:"HAI",iso2:"HT",iso:"HTI",label:"Haiti",phone:"509"},{ioc:"HUN",iso2:"HU",iso:"HUN",label:"Hungary",phone:"36"},{ioc:"INA",iso2:"ID",iso:"IDN",label:"Indonesia",phone:"62"},{ioc:"IRL",iso2:"IE",iso:"IRL",label:"Ireland",phone:"353"},{ioc:"ISR",iso2:"IL",iso:"ISR",label:"Israel",phone:"972"},{ioc:"",iso2:"IM",iso:"IMN",label:"Isle of Man",phone:"44"},{ioc:"IND",iso2:"IN",iso:"IND",label:"India",phone:"91"},{ioc:"",iso2:"IO",iso:"IOT",label:"British Indian Ocean Territory",phone:"246"},{ioc:"IRQ",iso2:"IQ",iso:"IRQ",label:"Iraq",phone:"964"},{ioc:"IRI",iso2:"IR",iso:"IRN",label:"Iran, Islamic Republic of",phone:"98"},{ioc:"ISL",iso2:"IS",iso:"ISL",label:"Iceland",phone:"354"},{ioc:"ITA",iso2:"IT",iso:"ITA",label:"Italy",phone:"39"},{ioc:"",iso2:"JE",iso:"JEY",label:"Jersey",phone:"44"},{ioc:"JAM",iso2:"JM",iso:"JAM",label:"Jamaica",phone:"1-876"},{ioc:"JOR",iso2:"JO",iso:"JOR",label:"Jordan",phone:"962"},{ioc:"JPN",iso2:"JP",iso:"JPN",label:"Japan",phone:"81",suggested:!0},{ioc:"KEN",iso2:"KE",iso:"KEN",label:"Kenya",phone:"254"},{ioc:"KGZ",iso2:"KG",iso:"KGZ",label:"Kyrgyzstan",phone:"996"},{ioc:"CAM",iso2:"KH",iso:"KHM",label:"Cambodia",phone:"855"},{ioc:"KIR",iso2:"KI",iso:"KIR",label:"Kiribati",phone:"686"},{ioc:"COM",iso2:"KM",iso:"COM",label:"Comoros",phone:"269"},{ioc:"SKN",iso2:"KN",iso:"KNA",label:"Saint Kitts and Nevis",phone:"1-869"},{ioc:"KOR",iso2:"KP",iso:"KOR",label:"Korea, Democratic People's Republic of",phone:"850"},{ioc:"PRK",iso2:"KR",iso:"PRK",label:"Korea, Republic of",phone:"82"},{ioc:"KUW",iso2:"KW",iso:"KWT",label:"Kuwait",phone:"965"},{ioc:"CAY",iso2:"KY",iso:"CYM",label:"Cayman Islands",phone:"1-345"},{ioc:"KAZ",iso2:"KZ",iso:"KAZ",label:"Kazakhstan",phone:"7"},{ioc:"LAO",iso2:"LA",iso:"LAO",label:"Lao People's Democratic Republic",phone:"856"},{ioc:"LIB",iso2:"LB",iso:"LBN",label:"Lebanon",phone:"961"},{ioc:"LCA",iso2:"LC",iso:"LCA",label:"Saint Lucia",phone:"1-758"},{ioc:"LIE",iso2:"LI",iso:"LIE",label:"Liechtenstein",phone:"423"},{ioc:"SRI",iso2:"LK",iso:"LKA",label:"Sri Lanka",phone:"94"},{ioc:"LBR",iso2:"LR",iso:"LBR",label:"Liberia",phone:"231"},{ioc:"LES",iso2:"LS",iso:"LSO",label:"Lesotho",phone:"266"},{ioc:"LTU",iso2:"LT",iso:"LTU",label:"Lithuania",phone:"370"},{ioc:"LUX",iso2:"LU",iso:"LUX",label:"Luxembourg",phone:"352"},{ioc:"LAT",iso2:"LV",iso:"LVA",label:"Latvia",phone:"371"},{ioc:"LBA",iso2:"LY",iso:"LBY",label:"Libya",phone:"218"},{ioc:"MAR",iso2:"MA",iso:"MAR",label:"Morocco",phone:"212"},{ioc:"MON",iso2:"MC",iso:"MCO",label:"Monaco",phone:"377"},{ioc:"MDA",iso2:"MD",iso:"MDA",label:"Moldova, Republic of",phone:"373"},{ioc:"MNE",iso2:"ME",iso:"MNE",label:"Montenegro",phone:"382"},{ioc:"",iso2:"MF",iso:"MAF",label:"Saint Martin (French part)",phone:"590"},{ioc:"MAD",iso2:"MG",iso:"MDG",label:"Madagascar",phone:"261"},{ioc:"MSH",iso2:"MH",iso:"MHL",label:"Marshall Islands",phone:"692"},{ioc:"MKD",iso2:"MK",iso:"MKD",label:"Macedonia, the Former Yugoslav Republic of",phone:"389"},{ioc:"MLI",iso2:"ML",iso:"MLI",label:"Mali",phone:"223"},{ioc:"MYA",iso2:"MM",iso:"MMR",label:"Myanmar",phone:"95"},{ioc:"MGL",iso2:"MN",iso:"MNG",label:"Mongolia",phone:"976"},{ioc:"MAC",iso2:"MO",iso:"MAC",label:"Macao",phone:"853"},{ioc:"NMA",iso2:"MP",iso:"NMP",label:"Northern Mariana Islands",phone:"1-670"},{ioc:"MRT",iso2:"MQ",iso:"MTQ",label:"Martinique",phone:"596"},{ioc:"MTN",iso2:"MR",iso:"MRT",label:"Mauritania",phone:"222"},{ioc:"MNT",iso2:"MS",iso:"MSR",label:"Montserrat",phone:"1-664"},{ioc:"MLT",iso2:"MT",iso:"MLT",label:"Malta",phone:"356"},{ioc:"MRI",iso2:"MU",iso:"MUS",label:"Mauritius",phone:"230"},{ioc:"MDV",iso2:"MV",iso:"MDV",label:"Maldives",phone:"960"},{ioc:"MAW",iso2:"MW",iso:"MWI",label:"Malawi",phone:"265"},{ioc:"MEX",iso2:"MX",iso:"MEX",label:"Mexico",phone:"52"},{ioc:"MAS",iso2:"MY",iso:"MYS",label:"Malaysia",phone:"60"},{ioc:"MOZ",iso2:"MZ",iso:"MOZ",label:"Mozambique",phone:"258"},{ioc:"NAM",iso2:"NA",iso:"NAM",label:"Namibia",phone:"264"},{ioc:"NCL",iso2:"NC",iso:"NCL",label:"New Caledonia",phone:"687"},{ioc:"NIG",iso2:"NE",iso:"NER",label:"Niger",phone:"227"},{ioc:"NFI",iso2:"NF",iso:"NFK",label:"Norfolk Island",phone:"672"},{ioc:"NGR",iso2:"NG",iso:"NGA",label:"Nigeria",phone:"234"},{ioc:"NCA",iso2:"NI",iso:"NIC",label:"Nicaragua",phone:"505"},{ioc:"NED",iso2:"NL",iso:"NLD",label:"Netherlands",phone:"31"},{ioc:"NOR",iso2:"NO",iso:"NOR",label:"Norway",phone:"47"},{ioc:"NEP",iso2:"NP",iso:"NPL",label:"Nepal",phone:"977"},{ioc:"NRU",iso2:"NR",iso:"NRU",label:"Nauru",phone:"674"},{ioc:"NIU",iso2:"NU",iso:"NIU",label:"Niue",phone:"683"},{ioc:"NZL",iso2:"NZ",iso:"NZL",label:"New Zealand",phone:"64"},{ioc:"OMA",iso2:"OM",iso:"OMN",label:"Oman",phone:"968"},{ioc:"PAN",iso2:"PA",iso:"PAN",label:"Panama",phone:"507"},{ioc:"PER",iso2:"PE",iso:"PER",label:"Peru",phone:"51"},{ioc:"FPO",iso2:"PF",iso:"PYF",label:"French Polynesia",phone:"689"},{ioc:"PNG",iso2:"PG",iso:"PNG",label:"Papua New Guinea",phone:"675"},{ioc:"PHI",iso2:"PH",iso:"PHL",label:"Philippines",phone:"63"},{ioc:"PAK",iso2:"PK",iso:"PAK",label:"Pakistan",phone:"92"},{ioc:"POL",iso2:"PL",iso:"POL",label:"Poland",phone:"48"},{ioc:"SPM",iso2:"PM",iso:"SPM",label:"Saint Pierre and Miquelon",phone:"508"},{ioc:"",iso2:"PN",iso:"PCN",label:"Pitcairn",phone:"870"},{ioc:"PUR",iso2:"PR",iso:"PRI",label:"Puerto Rico",phone:"1"},{ioc:"PLE",iso2:"PS",iso:"PSE",label:"Palestine, State of",phone:"970"},{ioc:"POR",iso2:"PT",iso:"PRT",label:"Portugal",phone:"351"},{ioc:"PLW",iso2:"PW",iso:"PLW",label:"Palau",phone:"680"},{ioc:"PAR",iso2:"PY",iso:"PRY",label:"Paraguay",phone:"595"},{ioc:"QAT",iso2:"QA",iso:"QAT",label:"Qatar",phone:"974"},{ioc:"REU",iso2:"RE",iso:"REU",label:"Reunion",phone:"262"},{ioc:"ROU",iso2:"RO",iso:"ROU",label:"Romania",phone:"40"},{ioc:"SRB",iso2:"RS",iso:"SRB",label:"Serbia",phone:"381"},{ioc:"RUS",iso2:"RU",iso:"RUS",label:"Russia",phone:"7"},{ioc:"RWA",iso2:"RW",iso:"RWA",label:"Rwanda",phone:"250"},{ioc:"KSA",iso2:"SA",iso:"SAU",label:"Saudi Arabia",phone:"966"},{ioc:"SOL",iso2:"SB",iso:"SLB",label:"Solomon Islands",phone:"677"},{ioc:"SEY",iso2:"SC",iso:"SYC",label:"Seychelles",phone:"248"},{ioc:"SUD",iso2:"SD",iso:"SDN",label:"Sudan",phone:"249"},{ioc:"SWE",iso2:"SE",iso:"SWE",label:"Sweden",phone:"46"},{ioc:"SIN",iso2:"SG",iso:"SGP",label:"Singapore",phone:"65"},{ioc:"HEL",iso2:"SH",iso:"SHN",label:"Saint Helena",phone:"290"},{ioc:"SLO",iso2:"SI",iso:"SVN",label:"Slovenia",phone:"386"},{ioc:"",iso2:"SJ",iso:"SJM",label:"Svalbard and Jan Mayen",phone:"47"},{ioc:"SVK",iso2:"SK",iso:"SVK",label:"Slovakia",phone:"421"},{ioc:"SLE",iso2:"SL",iso:"SLE",label:"Sierra Leone",phone:"232"},{ioc:"SMR",iso2:"SM",iso:"SMR",label:"San Marino",phone:"378"},{ioc:"SEN",iso2:"SN",iso:"SEN",label:"Senegal",phone:"221"},{ioc:"SOM",iso2:"SO",iso:"SOM",label:"Somalia",phone:"252"},{ioc:"SUR",iso2:"SR",iso:"SUR",label:"Suriname",phone:"597"},{ioc:"",iso2:"SS",iso:"SSD",label:"South Sudan",phone:"211"},{ioc:"STP",iso2:"ST",iso:"STP",label:"Sao Tome and Principe",phone:"239"},{ioc:"ESA",iso2:"SV",iso:"SLV",label:"El Salvador",phone:"503"},{ioc:"",iso2:"SX",iso:"SMX",label:"Sint Maarten",phone:"1-721"},{ioc:"SYR",iso2:"SY",iso:"SYR",label:"Syria",phone:"963"},{ioc:"",iso2:"SZ",iso:"SWZ",label:"Swaziland",phone:"268"},{ioc:"TKS",iso2:"TC",iso:"TCA",label:"Turks and Caicos Islands",phone:"1-649"},{ioc:"CHA",iso2:"TD",iso:"TCD",label:"Chad",phone:"235"},{ioc:"",iso2:"TF",iso:"ATF",label:"French Southern Territories",phone:"262"},{ioc:"TOG",iso2:"TG",iso:"TGO",label:"Togo",phone:"228"},{ioc:"THA",iso2:"TH",iso:"THA",label:"Thailand",phone:"66"},{ioc:"TJK",iso2:"TJ",iso:"TJK",label:"Tajikistan",phone:"992"},{ioc:"",iso2:"TK",iso:"TKL",label:"Tokelau",phone:"690"},{ioc:"TLS",iso2:"TL",iso:"TLS",label:"Timor-Leste",phone:"670"},{ioc:"TKM",iso2:"TM",iso:"TKM",label:"Turkmenistan",phone:"993"},{ioc:"TUN",iso2:"TN",iso:"TUN",label:"Tunisia",phone:"216"},{ioc:"TGA",iso2:"TO",iso:"TON",label:"Tonga",phone:"676"},{ioc:"TUR",iso2:"TR",iso:"TUR",label:"Turkey",phone:"90"},{ioc:"TTO",iso2:"TT",iso:"TTO",label:"Trinidad and Tobago",phone:"1-868"},{ioc:"TUV",iso2:"TV",iso:"TUV",label:"Tuvalu",phone:"688"},{ioc:"TPE",iso2:"TW",iso:"TWN",label:"Taiwan",phone:"886"},{ioc:"TAN",iso2:"TZ",iso:"TZA",label:"United Republic of Tanzania",phone:"255"},{ioc:"UKR",iso2:"UA",iso:"UKR",label:"Ukraine",phone:"380"},{ioc:"UGA",iso2:"UG",iso:"UGA",label:"Uganda",phone:"256"},{ioc:"USA",iso2:"US",label:"United States",phone:"1",suggested:!0,iso:"USA"},{ioc:"URU",iso2:"UY",iso:"URY",label:"Uruguay",phone:"598"},{ioc:"UZB",iso2:"UZ",iso:"UZB",label:"Uzbekistan",phone:"998"},{ioc:"",iso2:"VA",iso:"VAT",label:"Holy See (Vatican City State)",phone:"379"},{ioc:"VIN",iso2:"VC",iso:"VCT",label:"Saint Vincent and the Grenadines",phone:"1-784"},{ioc:"VEN",iso2:"VE",iso:"VEN",label:"Venezuela",phone:"58"},{ioc:"IVB",iso2:"VG",iso:"VGB",label:"British Virgin Islands",phone:"1-284"},{ioc:"ISV",iso2:"VI",iso:"VIR",label:"US Virgin Islands",phone:"1-340"},{ioc:"VIE",iso2:"VN",iso:"VNM",label:"Vietnam",phone:"84"},{ioc:"VAN",iso2:"VU",iso:"VUT",label:"Vanuatu",phone:"678"},{ioc:"WAF",iso2:"WF",iso:"WLF",label:"Wallis and Futuna",phone:"681"},{ioc:"SAM",iso2:"WS",iso:"WSM",label:"Samoa",phone:"685"},{ioc:"KOS",iso2:"XK",iso:"KOS",label:"Kosovo",phone:"383"},{ioc:"YEM",iso2:"YE",iso:"YEM",label:"Yemen",phone:"967"},{ioc:"MAY",iso2:"YT",iso:"MYT",label:"Mayotte",phone:"262"},{ioc:"RSA",iso2:"ZA",iso:"ZAF",label:"South Africa",phone:"27"},{ioc:"ZAM",iso2:"ZM",iso:"ZMB",label:"Zambia",phone:"260"},{ioc:"ZIM",iso2:"ZW",iso:"ZWE",label:"Zimbabwe",phone:"263"}];function Mne({participant:t,withISO2:e,withIOC:i}){let{person:r,individualParticipants:n}=t,a=[r,n?.map(({person:o})=>o)].flat().filter(Boolean);function s(o){let{nationalityCode:l}=o||{};if(l){let u=cd.find(({iso:c})=>c===l);i&&u?.ioc&&!o.iocNationalityCode&&(o.iocNationalityCode=u.ioc),e&&u?.iso2&&!o.iso2NationalityCode&&(o.iso2NationalityCode=u.iso2),u?.label&&!o.countryName&&(o.countryName=u.label)}}a.forEach(s)}function ULe({participantMap:t,template:e}){let i=Object.values(t);for(let r of i){let n=r.participant;if(n.individualParticipantIds?.length){n.individualParticipants=[];for(let a of n.individualParticipantIds){let s=t[a].participant;n.individualParticipants.push(e?jm({template:e,source:s}):s)}}}}function Xd(t){let{tournamentRecord:e,participantId:i}=t,r=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};for(let n of Object.values(r)){let a=n.participants?.find(s=>s.participantId===i);if(a)return{participant:a,tournamentId:n.tournamentId}}return{error:ji}}function Nne(t){let{tournamentRecord:e,participantId:i}=t;if(i){let r=Xd({tournamentRecord:e,participantId:i});return r.participant??r}return t.element||t.drawDefinition||t.event||t.tournamentRecord||{error:Je}}function Ss(t){let{returnPreviousValues:e,itemSubTypes:i,itemType:r}=t,n=Nne(t);if(n.error)return n;if(i&&!Array.isArray(i))return{error:re,context:{itemSubTypes:i}};if(!Array.isArray(n.timeItems))return{error:mB};let a=n.timeItems.filter(o=>o?.itemType===r).filter(o=>!i?.length||i.some(l=>o?.itemSubTypes?.includes(l))).sort((o,l)=>{let u=new Date(o.createdAt||void 0).getTime(),c=new Date(l.createdAt||void 0).getTime();return u-c}),s=Oe(a.pop(),!1,!0);if(s){let o={timeItem:s,...W};return e&&Object.assign(o,{previousItems:a}),o}else return{info:Br}}function h2({returnPreviousValues:t,drawDefinition:e,itemSubTypes:i,itemType:r}){if(!e)return{error:xo};if(!e.timeItems)return{info:Br};let{timeItem:n,previousItems:a,info:s}=Ss({element:e,returnPreviousValues:t,itemSubTypes:i,itemType:r});return n&&{timeItem:n,previousItems:a}||{info:s}}function vU({returnPreviousValues:t,itemSubTypes:e,itemType:i,event:r}){if(!r)return{error:ui};if(!r.timeItems)return{info:Br};let{timeItem:n,previousItems:a,info:s}=Ss({returnPreviousValues:t,element:r,itemSubTypes:e,itemType:i});return n&&{timeItem:n,previousItems:a}||{info:s}}function qM({returnPreviousValues:t,tournamentRecord:e,itemSubTypes:i,itemType:r}){if(!e)return{error:ve};if(!e.timeItems)return{info:Br};let{timeItem:n,previousItems:a,info:s}=Ss({element:e,returnPreviousValues:t,itemSubTypes:i,itemType:r});return n&&{timeItem:n,previousItems:a}||{info:s}}function g2({returnPreviousValues:t,tournamentRecord:e,participantId:i,itemSubTypes:r,itemType:n}){if(!e)return{error:ve};if(!i)return{error:dr};let a=Xd({tournamentRecord:e,participantId:i});if(a.error)return a;let{participant:s}=a;if(!s?.timeItems)return{info:Br};let{timeItem:o,previousItems:l,info:u}=Ss({element:a.participant,returnPreviousValues:t,itemSubTypes:r,itemType:n});return o&&{timeItem:o,previousItems:l}||{info:u}}var TLe={[Ya]:"groupParticipantIds",[ft]:"pairParticipantIds",[_t]:"teamParticipantIds"},DLe={[Ya]:"groups",[_t]:"teams"};function Ane({withIndividualParticipants:t,convertExtensions:e,tournamentRecord:i,withSignInStatus:r,withScaleValues:n,withGroupings:a,internalUse:s,withISO2:o,withIOC:l}){let u=[],c={};for(let p of i.participants??[]){let f=p?.participantId;f&&RLe({participantMap:c,participantId:f})}for(let p of i.participants??[]){let f=Oe(p,e,s),{participantId:m,individualParticipantIds:h,participantType:g}=f;if(!c[m]){u.push(m);continue}if(Object.assign(c[m].participant,f),h){let I=ELe({individualParticipantIds:h,participantCopy:f,participantMap:c,participantType:g,participantId:m});I.missingParticipantIds.length&&u.push(...I.missingParticipantIds)}if(r&&(c[m].participant.signedIn=PLe(f)),n){let{ratings:I,rankings:v,seedings:w}=_v({participant:f});c[m].participant.seedings=w,c[m].participant.rankings=v,c[m].participant.ratings=I}(l||o)&&Mne({participant:c[m].participant,withISO2:o,withIOC:l})}if(t){let p=wt(t)?t:void 0;ULe({participantMap:c,template:p})}let d;return a&&(d=zM({participants:Object.values(c).map(({participant:p})=>p),participantsProfile:{convertExtensions:e},deepCopy:!1}).groupInfo),{missingParticipantIds:u,participantMap:c,groupInfo:d}}function PLe(t){let{timeItem:e}=Ss({itemType:IU,element:t});return e?.itemValue===ew}function ELe({individualParticipantIds:t,participantCopy:e,participantMap:i,participantType:r,participantId:n}){let a=[];for(let s of t){let o=i[s]?.participant;if(!o){a.push(s);continue}if(o[TLe[r]].push(n),[_t,Ya].includes(r)){let{participantRoleResponsibilities:l,participantOtherName:u,participantName:c,participantId:d,teamId:p}=e,f=DLe[r];o[f].push({participantRoleResponsibilities:l,participantOtherName:u,participantName:c,participantId:d,teamId:p})}if(r===ft){let l=t.find(u=>u!==s);i[s].pairIdMap[n]=l,i[s].pairIdMap[l]=n}}return{missingParticipantIds:a}}function RLe({participantMap:t,participantId:e}){if(t[e])return;let i={walkoverWins:0,defaultWins:0,walkovers:0,defaults:0,losses:0,wins:0};t[e]={structureParticipation:{},potentialMatchUps:{},scheduleConflicts:{},scheduleItems:[],participant:{groupParticipantIds:[],pairParticipantIds:[],teamParticipantIds:[],seedings:{},rankings:{},ratings:{},groups:[],teams:[]},statistics:{},opponents:{},pairIdMap:{},matchUps:{},events:{},draws:{},counters:{[zt]:{...i},[Bt]:{...i},[_t]:{...i},...i}}}function bf({participantsProfile:t,useParticipantMap:e,tournamentRecord:i,contextProfile:r,inContext:n}){if(e)return Ane({...t,...r,tournamentRecord:i});let a=Oe(i.participants,!1,!0)||[];(t?.withIOC||t?.withISO2)&&a.forEach(o=>Mne({participant:o,...t}));let s;if((n||t?.withGroupings)&&a?.length&&({participantsWithGroupings:a,groupInfo:s}=zM({participantsProfile:t,deepCopy:!1,participants:a})),t?.withScaleValues&&a?.length)for(let o of a){let{ratings:l,rankings:u}=_v({participant:o});o.rankings=u,o.ratings=l}return{participants:a,groupInfo:s}}function Dt({onlySpecifiedPolicyTypes:t=!1,policyTypes:e=[],tournamentRecord:i,drawDefinition:r,structure:n,event:a}){if(!Array.isArray(e))return{error:rB};let s={};return i&&o(i),a&&o(a),r&&o(r),n&&o(n),{appliedPolicies:s,...W};function o(l){let u=l?.extensions?.find(c=>c.name===Qb)?.value;if(u)for(let c of Object.keys(u))(t?e.includes(c):!e.length||e.includes(c))&&(s[c]=Oe(u[c],!1,!0))}}function Gc({policyTypes:t=[],tournamentRecord:e,drawDefinition:i,structure:r,event:n}){if(!Array.isArray(t))return{error:rB};let{appliedPolicies:a}=Dt({tournamentRecord:e,drawDefinition:i,structure:r,event:n}),s={};for(let o of t){let l=a?.[o];l&&(s[o]=l)}return Object.keys(s).length?{policyDefinitions:s}:{info:eU.message}}var kne="WALKOVER",eq="RETIRED",I2="COMPETITIVE",tw="ROUTINE",iw="DECISIVE",mD="winRatio",CLe={[qu]:{policyName:"Competitive Bands Default",profileBands:{[iw]:20,[tw]:50}}},v2=CLe;function Hc({policyDefinitions:t,tournamentRecord:e,contextProfile:i,drawDefinition:r,event:n}){let a={policies:{}};if(!i)return a;let s=Gc({tournamentRecord:e,drawDefinition:r,event:n}).policyDefinitions;if(i.withCompetitiveness){let o=t?.[qu]??s?.[qu]??v2[qu];a.policies[qu]=o}return a}function wf({tournamentRecord:t,drawDefinition:e,policyType:i,structure:r,event:n}){if(!t)return{error:ve};let{appliedPolicies:a}=Dt({tournamentRecord:t,drawDefinition:e,structure:r,event:n});return a?.[i]?{policy:a[i]}:{info:eU?.message}}function yU({tournamentRecord:t,categoryName:e,categoryType:i,event:r}){e=e??r?.category?.categoryName??r?.category?.ageCategoryCode,i=i??r?.category?.categoryType??r?.category?.subType;let{policy:n}=wf({policyType:qd,tournamentRecord:t,event:r}),a=(t?ht({element:t,name:Tc}).extension:void 0)?.value,s=(r&&ht({name:Tc,element:r}).extension)?.value;return{scheduleTiming:{tournamentScheduling:a,eventScheduling:s,categoryName:e,categoryType:i,policy:n}}}function y2({drawDefinition:t,attributes:e}){let{extension:i}=ht({element:t,name:HP}),r=i?.value||{};return e.forEach(n=>{Object.keys(n).forEach(a=>{r[a]?Object.assign(r[a],n[a]):r[a]=n[a]})}),i={name:HP,value:r},LM({drawDefinition:t,extension:i}),{entryProfile:r}}function bU({drawDefinition:t}){let{extension:e}=ht({element:t,name:HP});return{entryProfile:e?.value||{}}}var Gs="ALTERNATE",wU="CONFIRMED",ca="DIRECT_ACCEPTANCE",SU="FEED_IN",UU="JUNIOR_EXEMPT",Ec="LUCKY_LOSER",TU="ORGANISER_ACCEPTANCE",DU="QUALIFIER",MLe="REGISTERED",PU="SPECIAL_EXEMPT",Us="UNGROUPED",Sf="UNPAIRED",NI="WILDCARD",bu="WITHDRAWN",hD=[wU,ca,UU,TU,PU],One=[SU,Ec,DU],Uf=[wU,ca,SU,UU,TU,PU,NI],uo=[wU,ca,UU,Ec,DU,TU,PU,NI],xne=[Gs,wU,ca,SU,UU,Ec,TU,DU,MLe,PU,Us,Sf,NI,bu],NLe={ALTERNATE:Gs,CONFIRMED:wU,DIRECT_ACCEPTANCE:ca,DIRECT_ENTRY_STATUSES:Uf,DRAW_SPECIFIC_STATUSES:One,EQUIVALENT_ACCEPTANCE_STATUSES:hD,FEED_IN:SU,JUNIOR_EXEMPT:UU,LUCKY_LOSER:Ec,ORGANISER_ACCEPTANCE:TU,QUALIFIER:DU,SPECIAL_EXEMPT:PU,STRUCTURE_SELECTED_STATUSES:uo,UNGROUPED:Us,UNPAIRED:Sf,VALID_ENTRY_STATUSES:xne,WILDCARD:NI,WITHDRAWN:bu};function b2({stage:t,drawDefinition:e}){let{entryProfile:i}=bU({drawDefinition:e}),r=Object.keys(i).includes(t);if(!r&&PM.includes(t)){let n=[{[t]:{drawSize:void 0,alternates:!0}}];return y2({drawDefinition:e,attributes:n}),!0}return r}function ALe({stage:t,drawDefinition:e}){let{entryProfile:i}=bU({drawDefinition:e});return i[t]?.alternates||0}function kLe({stage:t,drawDefinition:e}){let{entryProfile:i}=bU({drawDefinition:e});return i[t]?.wildcardsCount||0}function Tx({stage:t,drawDefinition:e,entryStatus:i}){return e.entries.reduce((r,n)=>n.entryStage===t&&n.entryStatus===i?r+1:r,0)}function Vh({provisionalPositioning:t,placementGroup:e,drawDefinition:i,stageSequence:r,entryStatuses:n,structureId:a,roundTarget:s,stages:o,stage:l}){let u=i.entries?.reduce((c,d)=>{let p=ht({name:El,element:d})?.extension?.value,f=l&&d.entryStage===l||o?.length&&d.entryStage&&o.includes(d.entryStage),m=!n||d.entryStatus&&n.includes(d.entryStatus),h=d.entryStageSequence??1;return f&&(!r||h===r)&&m&&(!s||!p||s===p)?c.concat(d):c},[])??[];if(a&&l===Ti){let{playoffEntries:c,error:d}=OLe({provisionalPositioning:t,drawDefinition:i,structureId:a});return d&&console.log("playoff entries error"),(c?.length?c:u).filter(p=>!e||p.placementGroup===e)}return u}function OLe({provisionalPositioning:t,drawDefinition:e,structureId:i}){let r=[],n=(e.links??[]).find(a=>a.linkType===fu&&a.target.structureId===i);if(n){let{finishingPositions:a,structureId:s}=n.source,{structure:o}=tt({drawDefinition:e,structureId:s});o?.structureType===gn&&(o.structures??[]).forEach(l=>{let u=l.positionAssignments??[],{structureId:c}=l,d=c,p=Object.assign({},...u.map(h=>{let{participantId:g}=h,I=ht({element:h,name:Dc}).extension?.value;return I&&g?{[g]:I}:void 0}).filter(Boolean)),f=Object.keys(p).reduce((h,g)=>{let I=p[g],v=I.groupOrder||t&&I.provisionalOrder;return h.includes(v)||h.push(v),h},[]).length===Object.keys(p).length,m=Object.keys(p).filter(h=>{let g=p[h],I=g.groupOrder||t&&g.provisionalOrder;return a?.includes(I)});(!t||f)&&m.forEach(h=>{let g=p[h],{groupOrder:I,provisionalOrder:v,GEMscore:w}=g,y=I||t&&v,b=[...a??[]].sort(nr).indexOf(y)+1;r.push({entryStage:Ti,entryStatus:SU,placementGroup:b,groupingValue:d,participantId:h,GEMscore:w})})})}return{playoffEntries:r}}function xLe({stage:t,drawDefinition:e}){return Uf.reduce((i,r)=>(Tx({drawDefinition:e,entryStatus:r,stage:t})||0)+i,0)}function hs({provisionalPositioning:t,returnAllProxies:e,drawDefinition:i,structureId:r,structure:n}){let a,s=[];n||({structure:n,error:a}=tt({drawDefinition:i,structureId:r}));let o=Kt({structure:n}).positionAssignments;if(a||!n)return{seedAssignments:[],error:vi};r||(r=n.structureId);let{stage:l,stageSequence:u}=n,c=l===Ti&&i&&Vh({provisionalPositioning:t,drawDefinition:i,stageSequence:u,structureId:r,stage:l}),d=c?c.filter(m=>m.placementGroup===1).sort((m,h)=>m.GEMscore<h.GEMscore&&1||m.GEMscore>h.GEMscore&&-1||0).map((m,h)=>{let g=h+1;return{participantId:m.participantId,seedValue:g,seedProxy:!0,seedNumber:g}}):[],p=d?.slice(0,e?d.length:o.length/2);p.length?s=p:n.seedAssignments?s=n.seedAssignments:a=Rte;let f=n.seedLimit??n?.positionAssignments?.length;return{seedAssignments:s,stageSequence:u,seedLimit:f,stage:l,error:a}}function Vo(t){if(!t)return;let{tieFormatId:e,tieFormats:i}=t;if(t.tieFormat)return t.tieFormat;if(e&&Array.isArray(i))return i.find(r=>r.tieFormatId===e)}function Ky({item:t,drawDefinition:e,structure:i,event:r}){if(t){if(t.tieFormat)return t.tieFormat;if(t.tieFormatId)return e.tieFormat?e.tieFormat:e.tieFormats?.find(n=>t.tieFormatId===n.tieFormatId)||(r.tieFormat?r.tieFormat:r.tieFormats?.find(n=>t.tieFormatId===n.tieFormatId));if(i?.tieFormat)return i.tieFormat;if(i?.tieFormatId){let n=e.tieFormats?.find(a=>i.tieFormatId===a.tieFormatId);if(n)return n}}}function yn({drawDefinition:t,structure:e,matchUp:i,event:r}){return{tieFormat:Ky({item:i,drawDefinition:t,structure:e,event:r})||Ky({item:e,drawDefinition:t,structure:e,event:r})||Vo(t)||Vo(r)}}function FLe({matchUps:t}){let e=t.reduce((i,r)=>!r.collectionPosition||i.includes(r.collectionPosition)?i:i.concat(r.collectionPosition),[]).map(i=>({[i]:t.filter(r=>r.collectionPosition===i)}));return{collectionPositionMatchUps:Object.assign({},...e)}}function Or({drawDefinition:t,structure:e}){let i={},r=[];return(t?.structures??[e]).filter(n=>n&&typeof n=="object").forEach(n=>{if(!n)return;let{structureId:a,matchUps:s,structures:o}=n,l=Array.isArray(o);if(l)l&&o.forEach(u=>{let{structureName:c}=u,d=u.matchUps;i[u.structureId]={matchUps:d,itemStructureIds:[],structureName:c},d&&(r.push(...d),d.forEach(p=>{p.tieMatchUps&&r.push(...p.tieMatchUps)})),i[a]||(i[a]={itemStructureIds:[],matchUps:[]}),i[a].itemStructureIds||(i[a].itemStructureIds=[]),i[a].itemStructureIds.push(u.structureId)});else{let u=s;i[a]={matchUps:u,itemStructureIds:[]},u?.forEach(c=>{r.push(c),c.tieMatchUps&&r.push(...c.tieMatchUps)})}}),{mappedMatchUps:i,drawMatchUps:r}}function Pd({mappedMatchUps:t,matchUpsMap:e,structureId:i,inContext:r}){t=e?.mappedMatchUps??t;let n=t[i],a=(n?.itemStructureIds||[]).map(s=>{let{matchUps:o,structureName:l}=t[s];return r?o.map(u=>Object.assign(Oe(u,!0,!0),{containerStructureId:i,structureId:s,structureName:l})):o}).flat();return(n?.matchUps||[]).concat(...a)}function Fne({groupedOrder:t,roundPositionsCount:e}){if(!t||t?.length<=e)return t;let i=wr(t,t.length/e).map(n=>n.reduce((a,s)=>a+s)),r=i.slice().sort(nr);return i.map(n=>r.indexOf(n)+1)}function YM(t){if(!wt(t))return!1;let{matchUpId:e,drawPositions:i}=t,r=typeof e=="string",n=!i||Array.isArray(i)&&i.length<=2&&i.every(a=>lt(a)||a===void 0||a===null);return r&&n}function Ka(t){return Array.isArray(t)?t.every(YM):!1}function LLe(t,e){return e?.find(i=>t.includes(i))}function Sn({matchUps:t=[],interpolate:e}){if(!Ka(t))return{roundMatchUps:[],error:re};let i=t.reduce((d,p)=>{let f=typeof p.roundNumber=="string"?Ke(p.roundNumber):p.roundNumber;return!p.roundNumber||d.includes(f)?d:d.concat(f)},[]).sort(nr).map(d=>{let p=t.filter(h=>h.roundNumber===d),f=p.find(({matchUpType:h})=>h===ei)?p.filter(({matchUpType:h})=>h===ei):p,m=h=>h.sort((g,I)=>nr(g.roundPosition,I.roundPosition));return{[d]:m(f)}}),r=t.reduce((d,p)=>{let f=typeof p.roundNumber=="string"?Ke(p.roundNumber):p.roundNumber;return d[f]||(d[f]=je({abbreviatedRoundName:p.abbreviatedRoundName,finishingRound:p.finishingRound,roundName:p.roundName})),d},{}),n=Object.assign({},...i);if(e){let d=Math.max(...Object.keys(n).map(f=>Ke(f)).filter(f=>!Number.isNaN(f))),p=n[d]?.length;if(p>1&&Ro(p)){let f=d+1,m=f+p/2;Ce(f,m).forEach((h,g)=>{n[h]=Ce(0,p/(2+g*2)).map(()=>({}))})}}let a=0,s=Object.assign({},...Object.keys(n).map(d=>{let p=n[d]?.length,f=n[d]?.filter(h=>!Ki.includes(h.matchUpStatus)&&!h.score?.scoreStringSide1)?.length,m=p&&p===f;return a=Math.max(a,p),{[d]:{matchUpsCount:p,inactiveCount:f,inactiveRound:m}}})),o=0,l=0,u=Object.keys(n).map(d=>Ke(d)).filter(d=>!Number.isNaN(d));u.forEach(d=>{let p=n[d].sort((m,h)=>m.roundPosition-h.roundPosition),f=p.flatMap(m=>m?.drawPositions||[]);if(s[d].roundNumber=d,s[d].roundFactor=s[d].matchUpsCount?a/s[d].matchUpsCount:1,s[d].finishingRound=r[d]?.finishingRound,s[d].roundName=r[d]?.roundName,s[d].abbreviatedRoundName=r[d]?.abbreviatedRoundName,s[d].finishingPositionRange=n[d]?.[0]?.finishingPositionRange,d===1||!s[d-1]){let m=f.sort(nr),h=wr(m,2);s[d].drawPositions=m,s[d].pairedDrawPositions=h}else{let m=s[d-1],h=m.drawPositions,g=m.matchUpsCount/s[d].matchUpsCount,I=wr(h,g),v=p.map(w=>{let{roundPosition:y}=w,b=[...w.drawPositions||[],void 0,void 0].slice(0,2);if(!y)return b;let S=b?.filter(Boolean)||[];if(!S?.length)return[void 0,void 0];if(d<3&&S?.length===2)return b?.slice().sort(nr);let U=Li(h,S).length!==S?.length;if(S?.length&&U)return S?.length===1?[S[0],void 0]:b?.slice().sort(nr);let T=(y-1)*2;return I.slice(T,T+2).map(P=>LLe(P,S))});s[d].drawPositions=v?.flat(),s[d].pairedDrawPositions=v}s[d+1]?.matchUpsCount===s[d].matchUpsCount&&(s[d+1].feedRound=!0,s[d+1].feedRoundIndex=l,s[d].preFeedRound=!0,l+=1),s[d]&&!s[d].feedRound&&(s[d].roundIndex=o,o+=1)});let c=!!Object.values(s).some(({matchUpsCount:d})=>!Ro(d));return{hasNoRoundPositions:t.some(d=>!d.roundPosition),roundsNotPowerOf2:c,maxMatchUpsCount:a,roundMatchUps:n,roundNumbers:u,roundProfile:s,...W}}function gD(t){if(!Array.isArray(t))return"";let e=t.filter(Ai);return e.length?nt([Math.min(...e),Math.max(...e)]).join("-"):""}function _Le({drawDefinition:t,structureId:e,matchUpsMap:i}){if(!t)return{error:$e};if(!e)return{error:qa};let{structure:r}=tt({drawDefinition:t,structureId:e});if(r?.stage!==tn)return{error:gf,info:"Structure is not CONSOLATION stage"};let{links:n}=t,a=n?.filter(d=>d.target.structureId===e)||[],s=a?.reduce((d,p)=>{let{structureId:f}=p.source;return d.includes(f)?d:d.concat(f)},[])||[],o=Object.assign({},...s.map(d=>{let p=Pd({structureId:d,matchUpsMap:i}),f=Sn({matchUps:p}).roundProfile;return{[d]:f}})),l=Pd({matchUpsMap:i,structureId:e}),{roundProfile:u}=Sn({matchUps:l}),c={};return a?.forEach(d=>{let{structureId:p,roundNumber:f}=d.source,{feedProfile:m,groupedOrder:h,positionInterleave:g,roundNumber:I}=d.target,v=o[p],w=v[1]?.drawPositions,y=v[f]?.matchUpsCount;if(!y)return;let b=y?w.length/y:0,S=w.length/b,U=w.slice(),T=Fne({roundPositionsCount:S,groupedOrder:h}),P=T?.length||1;if(P<=S){let R=w.length/P,C=wr(U,R);m===jp&&C.forEach(M=>M.reverse()),U=T?.length&&T?.map(M=>C[M-1]).flat()||C.flat()}let D=wr(U,b);if(g){let R=Ce(0,g.interleave).map(()=>{}),C=Ce(0,g.offset).map(()=>{});D=D.map(N=>[N,...R]),D.unshift(C),D=D.flat(1);let M=D.length-g.offset;D=D.slice(0,M)}c[I]||(c[I]={});let E=u?.[I]?.feedRound?2:1;D.forEach((R,C)=>{let M=1+C*E;c[I][M]||(c[I][M]=gD(R))})}),{sourceDrawPositionRanges:c}}function Lne({drawDefinition:t}){if(typeof t!="object")return{error:mm};let e={},{structures:i=[],links:r=[]}=t||{},n=i.reduce((s,o)=>{let{stage:l}=o;return s[l]?s[l].push(o):s[l]=[o],s},{});for(let s of Object.keys(n)){let o=n[s].find(({stageSequence:u})=>u===1);if(!o)continue;let{structureId:l}=o;a({aggregator:{},targetRound:0,exitProfiles:e,exitProfile:"0",structureId:l,stage:s})}return{exitProfiles:e};function a({exitProfiles:s,exitProfile:o,structureId:l,targetRound:u,aggregator:c,stage:d}){s[l]||(s[l]=[]),o==="0"&&[tn,Ti].includes(d)||s[l].push(o);let p=r.filter(f=>f.source.structureId===l&&f.source.roundNumber>=u);for(let f of p){let m=f.source.roundNumber,h=f.target.roundNumber,g=f.target.structureId,I=i.find(w=>w.structureId===g).stage,v=[I,g,h,m].join("|");if(c[v])return;c[v]=!0,a({exitProfile:`${o}-${m}`,structureId:g,exitProfiles:s,targetRound:h,aggregator:c,stage:I})}}}function $Le({drawDefinition:t,roundProfile:e,structureId:i,matchUpsMap:r}){if(!t)return{error:$e};if(!i)return{error:qa};if(!e){let s=Pd({matchUpsMap:r,structureId:i});if({roundProfile:e}=Sn({matchUps:s}),!e)return{error:Je}}let n=(Math.min(...e?.[1]?.drawPositions??[])||1)-1,a=Object.keys(e);return{drawPositionsRanges:Object.assign({},...(a||[]).map(s=>{let o=e?.[s]?.matchUpsCount,l=e?.[1]?.drawPositions??[],u=wr(l,l.length/o),c=u.map(gD),d=u.map(g=>g.map(I=>I-n)).map(gD),p=a.map(g=>{if(g>s)return;let I=e?.[g]?.drawPositions??[];return wr(I,I.length/o)}).filter(Boolean),f=Ce(0,o).map(g=>p.map(I=>I[g]).flat().filter(Boolean).sort(nr)).map(g=>nt(g)),m=f.map(g=>Xxe(g).map(gD).join(", ")),h=Object.assign({},...Ce(0,o).map(g=>({[g+1]:{firstRoundDrawPositionsRange:c[g],firstRoundOffsetDrawPositionsRange:d[g],possibleDrawPositions:f[g],drawPositionsRange:m[g]}})));return{[s]:h}}))}}function w2({roundsNotPowerOf2:t,drawDefinition:e,structure:i,matchUps:r}){if(!i)return!1;r=r??i.matchUps??[],t=t??Sn({matchUps:r}).roundsNotPowerOf2;let n=!!i.positionAssignments?.find(({drawPosition:a})=>a)||!!r?.find(({drawPositions:a})=>a?.length);return(!e?.drawType||e.drawType!==vf)&&!i?.structures&&t&&n}function Hn({structure:t}){if(!t)return!1;let e=t.matchUps||t.roundMatchUps&&Object.values(t.roundMatchUps).flat(),i=!!e?.find(n=>n?.roundPosition),r=!!e?.find(n=>n?.drawPositions?.length);return!t?.structures&&t?.stage!==Cr&&(!e.length||!i&&!r)}var S2={[Sc]:{policyName:"Round Naming Default",namingConventions:{round:"Round",pre:"Pre"},qualifyingFinishMap:{1:"Final"},abbreviatedRoundNamingMap:{1:"F",2:"SF",4:"QF"},roundNamingMap:{1:"Final",2:"Semifinal",4:"Quarterfinal"},affixes:{roundNumber:"R",preFeedRound:"Q",preQualifying:"P"},stageConstants:{[Ae]:"",[Ti]:"P",[ze]:"Q",[tn]:"C"}}},BLe=S2;function _ne({roundNamingPolicy:t,drawDefinition:e,structure:i,matchUps:r}){let{roundProfile:n,roundMatchUps:a}=Sn({matchUps:r}),{structureAbbreviation:s,stage:o}=i,l=Hn({structure:i}),u=w2({structure:i}),c=i.structures,d={},p=S2[Sc],f=i.stage===ze,m=f?Math.max(...(e?.structures??[]).filter(R=>R.stage===ze).map(({stageSequence:R})=>R??1),0):0,h=(i.stageSequence??1)<m?i.stageSequence??1:"",g=h&&(t?.affixes?.preQualifying||p.affixes.preQualifying)||"",I=t?.roundNamingMap||p.roundNamingMap||{},v=t?.abbreviatedRoundNamingMap||p.abbreviatedRoundNamingMap||{},w=t?.affixes?.preFeedRound||p.affixes.preFeedRound,y=t?.affixes?.roundNumber||p.affixes.roundNumber,b=(t?.namingConventions||p.namingConventions).round,S=o&&o!==Ae?o[0]:"",U=t?.stageConstants||p.stageConstants,T=o&&U?.[o]||S,P=`${g}${T}${h}`,D=n?Object.keys(n):[],E=f&&U?.[ze]?`${U?.[ze]}-`:"";if(c||l||u)Object.assign(d,...D.map(R=>{let C=`${E}${b} ${R}`,M=`${y}${R}`;return{[R]:{roundName:C,abbreviatedRoundName:M}}}));else{let R=f&&(t?.qualifyingFinishMap||p?.qualifyingFinishMap||{});Object.assign(d,...D.map(C=>{if(!n?.[C])return;let{matchUpsCount:M,preFeedRound:N}=n[C],A=M*2,O=R?.[n?.[C].finishingRound]||R&&`${y}${A}`||I[M]||`${y}${A}`,k=N?`-${w}`:"",F=`${O}${k}`,x=[P,s,F].filter(Boolean).join("-"),L=`${v[M]||`${y}${A}`}${k}`,$=[P,s,L].filter(Boolean).join("-");return{[C]:{abbreviatedRoundName:$,roundName:x}}}))}return{roundNamingProfile:d,roundProfile:n,roundMatchUps:a}}var VLe=(t,e)=>(t||0)+(e||0);function $ne(t,e){let i=Array.isArray(t)?t[0]:t;return Number.isNaN(i)&&kne||i<=e[iw]&&iw||i<=e[tw]&&tw||I2}function Bne({score:t}){let e=t?.sets||[],i=e.reduce((n,a)=>(n[0]+=a.side1Score||0,n[1]+=a.side2Score||0,n),[0,0]),r=e.reduce((n,a)=>(n[0]+=a.side1TiebreakScore||0,n[1]+=a.side2TiebreakScore||0,n),[0,0]);return r.reduce(VLe)&&(i[r[0]>r[1]?0:1]+=1),{sets:e,games:i,score:t}}function jLe(t){let e=Math.min(...t.games),i=Math.max(...t.games);return Math.round(e/i*100)}function Vne(t){return t.map(jLe).sort().map(e=>parseFloat(e.toFixed(2)))}function EU({tournamentRecord:t,profileBands:e,matchUp:i}){if(!i)return{error:sa};let{score:r,winningSide:n}=i;if(!n)return{error:re};let a=!e&&t&&wf({policyType:qu,tournamentRecord:t}).policy,s=e||a?.profileBands||v2[qu].profileBands,o=Bne({score:r}),l=Vne([o]),u=$ne(l,s),c=Array.isArray(l)?l[0]:l;return{...W,competitiveness:u,pctSpread:c}}function jne({matchUp:t}){if(!t)return{error:sa};if(t&&!t.sides)return{error:oa};if(t&&!t.hasContext)return{error:gM};let e=(t.sides??[])?.map(s=>s?.participantId).filter(Boolean),i=t.sides?.filter(s=>s.participant?.participantType===It).map(s=>s.participantId).filter(Boolean)??[],r=((t.sides??[])?.map(s=>s.participant?.individualParticipants).filter(Boolean)??[]).map(s=>(s??[]).map(o=>o?.participantId).filter(Boolean)),n=[...i,...r.flat()].filter(Boolean)??[],a=nt(n.concat(e)).filter(Boolean)??[];return{nestedIndividualParticipantIds:r,allRelevantParticipantIds:a,individualParticipantIds:n,sideParticipantIds:e,...W}}var zP="CHECK_IN",qP="CHECK_OUT",GLe="SCHEDULE",jh="SCHEDULE.ASSIGNMENT.VENUE",wu="SCHEDULE.ALLOCATION.COURTS",Ed="SCHEDULE.ASSIGNMENT.COURT",KM="SCHEDULE.COURT.ORDER",Gh="SCHEDULE.DATE",HLe="COMPLETED.DATE",U2="HOME_PARTICIPANT_ID",T2="SCHEDULE.ASSIGN.OFFICIAL",Hh="SCHEDULE.TIME.SCHEDULED",go="SCHEDULE.TIME.START",tc="SCHEDULE.TIME.STOP",Kl="SCHEDULE.TIME.RESUME",Rc="SCHEDULE.TIME.END",XM="SCHEDULE.TIME.MODIFIERS",Gne="TO_BE_ANNOUNCED",Hne="NEXT_AVAILABLE",Wne="FOLLOWED_BY",zne="AFTER_REST",qne="RAIN_DELAY",WLe="NOT_BEFORE",Dx=[Gne,Hne,Wne,zne,qne],zLe="ELIGIBILITY",qLe="REGISTRATION",YLe="SUSPENSION",KLe="MEDICAL",XLe="PENALTY",Yne="SCALE",Kne="RATING",Xne="RANKING",D2="SEEDING",Jd="PUBLISH",Xa="PUBLIC",Qd="STATUS",JLe="MODIFICATION",QLe="RETRIEVAL",ZLe="other",e0e={MUTUALLY_EXCLUSIVE_TIME_MODIFIERS:Dx,AFTER_REST:zne,ALLOCATE_COURTS:wu,ASSIGN_COURT:Ed,ASSIGN_OFFICIAL:T2,ASSIGN_VENUE:jh,CHECK_IN:zP,CHECK_OUT:qP,COMPLETED_DATE:HLe,COURT_ORDER:KM,ELIGIBILITY:zLe,END_TIME:Rc,FOLLOWED_BY:Wne,MEDICAL:KLe,MODIFICATION:JLe,NEXT_AVAILABLE:Hne,NOT_BEFORE:WLe,OTHER:ZLe,PENALTY:XLe,PUBLIC:Xa,PUBLISH:Jd,RANKING:Xne,RATING:Kne,RAIN_DELAY:qne,REGISTRATION:qLe,RESUME_TIME:Kl,RETRIEVAL:QLe,SCALE:Yne,SCHEDULE:GLe,SCHEDULED_DATE:Gh,SCHEDULED_TIME:Hh,SEEDING:D2,START_TIME:go,STATUS:Qd,STOP_TIME:tc,SUSPENSION:YLe,TIME_MODIFIERS:XM,TO_BE_ANNOUNCED:Gne};function Wh({matchUp:t}){if(!t)return{error:sa};if(!t.hasContext)return{error:gM};if(!t.sides||t?.sides.filter(Boolean).length!==2)return{error:oa};let{nestedIndividualParticipantIds:e,allRelevantParticipantIds:i,sideParticipantIds:r}=jne({matchUp:t}),n=(t.timeItems??[]).filter(o=>o?.itemType&&[zP,qP].includes(o.itemType)).sort((o,l)=>(o.createdAt?new Date(o.createdAt).getTime():0)-(l.createdAt?new Date(l.createdAt).getTime():0)),a=n.map(o=>o.itemValue).filter(o=>n.filter(l=>l?.itemValue===o).reverse()[0].itemType===zP);e?.forEach((o,l)=>{let u=r?.[l],c=o?.length&&o.every(d=>a.includes(d));u&&c&&!a.includes(u)&&a.push(u)}),r?.forEach((o,l)=>{a.includes(o)&&(e?.[l]??[]).forEach(u=>{u&&!a.includes(u)&&a.push(u)})});let s=r?.reduce((o,l)=>a.includes(l)&&o,!0);return{allRelevantParticipantIds:i,allParticipantsCheckedIn:s,checkedInParticipantIds:a,...W}}var Pi=t=>e=>{let i=wt(e)&&e?.matchUpType||ni(e)&&e;return i&&ste[t].includes(i)};function Xy(t){let{matchUpAverageTimes:e,matchUpFormat:i}=t||{},r=e?.map(({matchUpFormatCodes:a})=>a?.filter(s=>s===i)).flat().filter(Boolean).sort((a,s)=>(a?.length||0)-(s?.length||0))||[],n=r.includes(i)?i:r[0];return e?.find(({matchUpFormatCodes:a,averageTimes:s})=>a?.find(o=>n===o)&&s)?.averageTimes}function Jy(t){let{matchUpRecoveryTimes:e,averageMinutes:i,matchUpFormat:r}=t||{};return e?.find(({matchUpFormatCodes:n,averageTimes:a,recoveryTimes:s})=>{if(a&&i){let{greaterThan:o=0,lessThan:l=360}=a;if(i>o&&i<l)return!0}return n?.find(o=>o===r)&&s})?.recoveryTimes}function Jne({timesBlockArray:t,categoryName:e,categoryType:i}){return t.filter(r=>Array.isArray(r)).map(r=>r.sort((n,a)=>(a.categoryNames?.length||0)-(n.categoryNames?.length||0)).find(({categoryTypes:n,categoryNames:a})=>!a?.length&&!n?.length||a?.includes(e)||n?.includes(i))).find(Boolean)}function t0e({tournamentScheduling:t,eventScheduling:e,averageMinutes:i,defaultTiming:r,matchUpFormat:n,categoryName:a,categoryType:s,policy:o}){let l=e?.matchUpRecoveryTimes&&Jy({...e,averageMinutes:i,matchUpFormat:n}),u=t?.matchUpRecoveryTimes&&Jy({...t,averageMinutes:i,matchUpFormat:n}),c=o?.matchUpRecoveryTimes&&Jy({...o,averageMinutes:i,matchUpFormat:n}),d=[l,u,c,o?.defaultTimes?.recoveryTimes,r?.recoveryTimes];return Jne({categoryName:a,categoryType:s,timesBlockArray:d})}function i0e({matchUpFormat:t,categoryName:e,categoryType:i,defaultTiming:r,tournamentScheduling:n,eventScheduling:a,policy:s}){let o=a?.matchUpAverageTimes&&Xy({...a,matchUpFormat:t}),l=n?.matchUpAverageTimes&&Xy({...n,matchUpFormat:t}),u=s?.matchUpAverageTimes&&Xy({...s,matchUpFormat:t}),c=[o,l,u,s?.defaultTimes?.averageTimes,r?.averageTimes];return Jne({categoryName:e,categoryType:i,timesBlockArray:c})}var Qne="DOUBLES_SINGLES",Zne="SINGLES_DOUBLES",Hs="total",Px="participantConflict",Ex="potentialParticipantConflict",es="matchUpConflict",eae="courtDoubleBooking",tae="positionLinkConflict",iae="ISSUE_IDS",xl="CONFLICT",Fl="WARNING",Dy="ERROR",Py="ISSUE",ID="STATE",r0e="BLOCKED",n0e="PRACTICE",a0e="MAINTENANCE",s0e={SINGLES_DOUBLES:Zne,DOUBLES_SINGLES:Qne,TOTAL:Hs,CONFLICT_MATCHUP_ORDER:es,CONFLICT_PARTICIPANTS:Px,CONFLICT_POTENTIAL_PARTICIPANTS:Ex,CONFLICT_COURT_DOUBLE_BOOKING:eae,CONFLICT_POSITION_LINK:tae,SCHEDULE_ISSUE_IDS:iae,SCHEDULE_CONFLICT:xl,SCHEDULE_WARNING:Fl,SCHEDULE_ERROR:Dy,SCHEDULE_ISSUE:Py,SCHEDULE_STATE:ID,BLOCKED:r0e,PRACTICE:n0e,MAINTENANCE:a0e};function RU({defaultAverageMinutes:t=90,defaultRecoveryMinutes:e=0,tournamentRecord:i,matchUpFormat:r,categoryName:n,categoryType:a,eventType:s,event:o}){if(!i)return{error:ve};s=s??o?.eventType??Bm;let l={averageTimes:[{minutes:{default:t}}],recoveryTimes:[{minutes:{default:e}}]},{scheduleTiming:u}=yU({tournamentRecord:i,categoryName:n,categoryType:a,event:o}),c={...u,matchUpFormat:r,categoryType:a,defaultTiming:l};return JM({eventType:s,timingDetails:c})}function JM({timingDetails:t,eventType:e}){let i=i0e(t),r=Object.keys(i?.minutes||{}),n=i?.minutes&&(r?.includes(e)&&i.minutes[e]||i.minutes.default),a=t0e({...t,averageMinutes:n}),s=Object.keys(a?.minutes||{}),o=a?.minutes&&(s?.includes(e)&&a.minutes[e]||a.minutes.default),l=Pi(Bm)(e)?Zne:Qne,u=a?.minutes&&(s?.includes(l)&&a.minutes[l]||o);return{averageMinutes:n,recoveryMinutes:o,typeChangeRecoveryMinutes:u}}function ak(t){return t.createdAt?new Date(t.createdAt).getTime():0}function Tf({timeItems:t,itemType:e}){let i=t.filter(n=>n&&n.itemType===e).sort((n,a)=>ak(n)-ak(a)).pop(),r=i&&ak(i);return{itemValue:i?.itemValue,timeStamp:r}}function P2({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:r,timeStamp:n}=Tf({timeItems:i?.timeItems||[],itemType:Hh});return!e||n&&t&&new Date(n).getTime()>new Date(t).getTime()?{scheduledTime:r}:e}function Df({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:r,timeStamp:n}=Tf({timeItems:i?.timeItems||[],itemType:Gh});return!e||n&&t&&new Date(n).getTime()>new Date(t).getTime()?{scheduledDate:r}:e}function Of(t){if(Jie.test(t)){let e=EB();return new Date(`${e}T${t}`)}else return new Date(t)}function o0e({matchUp:t}){if(!t)return{error:sa};if(!t.timeItems)return{error:mB};let e=t.timeItems.filter(r=>[go,tc,Kl,Rc].includes(r?.itemType)).sort((r,n)=>Of(r.itemValue).getTime()-Of(n.itemValue).getTime()),i=e.reduce((r,n)=>{let a,s=n?.itemType?.split("."),o=`SCHEDULE.TIME.${n?.itemType?.startsWith("SCHEDULE.TIME")&&s[2]}`;switch(o){case go:a=0;break;case Rc:if(r.lastValue&&[go,Kl].includes(r.lastType)){let l=Of(n.itemValue).getTime()-Of(r.lastValue).getTime();a=r.milliseconds+l}else a=r.milliseconds;break;case tc:if([go,"SCHECULE.TIME.RESUME"].includes(r.lastType)){let l=Of(n.itemValue).getTime()-Of(r.lastValue).getTime();a=r.milliseconds+l}else a=r.milliseconds;break;default:a=r.milliseconds;break}return{milliseconds:a,lastType:o,lastValue:n.itemValue}},{milliseconds:0,lastType:void 0,lastValue:void 0});if([go,Kl].includes(i.lastType)){let r=new Date().getTime()-Of(i.lastValue).getTime();i.milliseconds+=r}return{milliseconds:i.milliseconds,time:l0e(i.milliseconds),relevantTimeItems:e}}function l0e(t){let e=(i,r=2)=>("00"+i).slice(-r);return e(t/36e5|0)+":"+e(t%36e5/6e4|0)+":"+e(t%6e4/1e3|0)}function u0e({matchUp:t}){let e=t?.timeItems||[],i=r=>r.createdAt?new Date(r.createdAt).getTime():0;return{startTime:e.reduce((r,n)=>{let a=n.itemType===go&&n;return a&&(!r||i(a)<i(r))?a:r},void 0)?.itemValue}}function YP(t){return parseInt(t)}function KP({startTime:t="",endTime:e=""}={}){if(!t||!e||!dp.test(t)||!dp.test(e))return!1;let[i,r]=t.split(":").map(YP),[n,a]=e.split(":").map(YP);return n<i?!1:!(i===n&&a<r)}function c0e(t,e){let[i,r]=t.startTime.split(":").map(YP),[n,a]=e.startTime.split(":").map(YP);return i<n?-1:i>n?1:r<a?-1:r>a?1:0}function QM({dateAvailability:t}){if(!t)return{error:Kte};if(!Array.isArray(t))return{error:pD};let e="Dates must be formated => YYYY-MM-DD",i="Times must be 24 hour => 00:00";for(let r of t){if(typeof r!="object")return{error:pD};let{date:n,startTime:a,endTime:s,bookings:o=[]}=r;if(!a||!s)return{error:pD};if(n&&!dl.test(n))return{error:or,dateAvailability:{date:n},info:e};if(!dp.test(a))return{error:Es,dateAvailability:{startTime:a},info:i};if(!dp.test(s))return{error:Es,dateAvailability:{endTime:s},info:i};if(a===s)return{error:Es,dateAvailability:{startTime:a,endTime:s},info:"startTime and endTime are equivalent"};if(!KP({startTime:a,endTime:s}))return{error:Es,dateAvailability:{startTime:a,endTime:s},info:"endTime must be after startTime"};if(o){if(!Array.isArray(o))return{error:kP};for(let l of o){if(typeof l!="object")return{error:kP};let{startTime:u,endTime:c}=l;if(!dp.test(u))return{error:Es,booking:{startTime:u},info:i};if(!dp.test(c))return{error:Es,booking:{endTime:c},info:i};if(u===c)return{error:Es,dateAvailability:{startTime:u,endTime:c},info:"startTime and endTime are equivalent"};if(!KP({startTime:u,endTime:c}))return{error:Es,dateAvailability:{startTime:u,endTime:c},info:"endTime must be after startTime"}}}}return{valid:!0}}function rae({tournamentRecord:t}){for(let e of t.venues??[])e.isPrimary&&delete e.isPrimary}function CU(t){let{disableNotice:e,venue:i,context:r}=t;if(typeof i!="object")return{error:re};let n=ws(t);i.venueId||(i.venueId=Ct());let a;for(let s of Object.values(n)){let o=d0e({disableNotice:!0,tournamentRecord:s,context:r,venue:i});if(o?.error)return o;a=o.venue}return e||st({topic:bne,payload:{venue:i}}),je({...W,venue:a})}function d0e({tournamentRecord:t,disableNotice:e,context:i,venue:r}){if(!t)return{error:ve};if(!r)return{error:Je,info:"missing venue"};if(t.venues||(t.venues=[]),r.venueId||(r.venueId=Ct()),t.venues.reduce((n,a)=>n||a.venueId===r.venueId,void 0))return{error:hie};if(r.dateAvailability?.length){let n=QM({dateAvailability:r.dateAvailability});if(n.error)return n}if(r.defaultStartTime||r.defaultEndTime){if(!r.defaultStartTime||!r.defaultEndTime)return{error:re,info:"both defaultStartTime and defaultEndTime are required"};if(!KP({startTime:r.defaultStartTime,endTime:r.defaultEndTime}))return{error:re,info:"defaultEndTime must be after defaultStartTime"}}return i&&Ft({element:r,extension:{value:i,name:nne}}),r.isPrimary&&rae({tournamentRecord:t}),t.venues.push(r),{...W,venue:Oe(r)}}function Ou({tournamentRecords:t,tournamentRecord:e,venueId:i}){if(!e)return{error:ve};if(!i)return{error:zd};let r=(e.venues??[]).reduce((n,a)=>a.venueId===i?a:n,void 0);if(!r&&t){let n=(mU({tournamentRecords:t}).linkedTournamentIds??[])[e.tournamentId];for(let a of n){let s=t[a],o=Ou({tournamentRecord:s,venueId:i});if(o.success&&o.venue)return CU({tournamentRecord:e,venue:o.venue}),{...W,venue:r}}}return r?{...W,venue:r}:{error:If}}function E2({convertExtensions:t,...e}){let{tournamentRecords:i,tournamentRecord:r,venueId:n}=e,a=Ou({tournamentRecords:i,tournamentRecord:r,venueId:n});return Oe(a,t,!0)}function Zd({tournamentRecords:t,tournamentRecord:e,courtId:i}){if(!e)return{error:ve};if(!i)return{error:Ah};let r="findCourt",n,a;if((e.venues??[]).forEach(s=>{(s.courts??[]).forEach(o=>{o.courtId===i&&(n=o,a=s)})}),n)return{...W,court:n,venue:a};if(t){let s=(mU({tournamentRecords:t}).linkedTournamentIds??[])[e.tournamentId];for(let o of s){let l=t[o],u=Zd({tournamentRecord:l,courtId:i});if(u.success)return u.venue&&CU({tournamentRecord:e,venue:u.venue}),{...W,court:n,venue:a}}}return q({result:{error:vc},stack:r})}function R2(t){return Oe(Zd(t),!1,!0)}function ZM({tournamentRecord:t,internalUse:e,courtId:i}){if(!t)return{error:ve};if(!i)return{error:Ah};let r=Zd({tournamentRecord:t,courtId:i});if(r.error)return r;let n=r.court&&(({altitude:a,courtId:s,courtName:o,courtDimensions:l,latitude:u,longitude:c,surfaceCategory:d,surfaceType:p,surfacedDate:f,pace:m,notes:h})=>({altitude:a,courtId:s,courtName:o,courtDimensions:l,latitude:u,longitude:c,surfaceCategory:d,surfaceType:p,surfacedDate:f,pace:m,notes:h}))(r.court);return{...W,courtInfo:Oe(n,!1,e)}}function AI(t){let e=He(t,[{[hr]:!0},{venueId:!0,[js]:zd}]);if(e.error)return e;let{tournamentRecord:i,venueId:r}=t,n=Ou({tournamentRecord:i,venueId:r});if(n.error)return n;let a=(n.venue?.courts??[]).map(l=>(({courtInfo:u})=>({...u}))(ZM({courtId:l.courtId,internalUse:!0,tournamentRecord:i}))),s=n.venue&&(({venueId:l,venueName:u,venueAbbreviation:c})=>({venueAbbreviation:c,venueName:u,venueId:l}))(n.venue),o=s&&{...s,courtsInfo:a};return{...W,venueData:Oe(o,!1,!0)}}function p0e({matchUp:t}){let e=t?.timeItems||[],i=r=>r.createdAt?new Date(r.createdAt).getTime():0;return{endTime:e.reduce((r,n)=>{let a=n.itemType===Rc&&n;return a&&(!r||i(a)>i(r))?a:r},void 0)?.itemValue}}function Bi({event:t,eventId:e}){if(!t)return{error:ui};let i=ht({name:to,element:t})?.extension,r=e?Oe(i?.value,!1,!0):i?.value;return e&&t.drawDefinitions?.forEach(n=>{r?.flights?.forEach(a=>{a.drawId===n.drawId&&Object.assign(a,{drawDefinition:n})})}),{flightProfile:r}}function Wn(t){let{tournamentRecord:e,eventId:i,drawId:r}=t,n="findEvent",a={},s=t.tournamentRecords??(e&&{[e.tournamentId]:e})??{},o=Object.values(s).map(({events:u,tournamentId:c})=>(u&&u.forEach(d=>{a[d.eventId]={tournamentId:c}}),u??[])).flat(),l;if(r){let u,c=o.find(d=>{let p=(d?.drawDefinitions??[]).find(f=>f.drawId===r);if(p)u=p,l=a[d.eventId].tournamentId;else{let f=(d&&Bi({event:d})?.flightProfile)?.flights?.find(m=>m.drawId===r);if(f)return l=a[d.eventId].tournamentId,{entries:f.drawEntries,drawName:f.drawName,tournamentId:l,drawId:r}}return p});if(c)return{event:c,drawDefinition:u,tournamentId:l}}if(i){let u=o.find(c=>c?.eventId===i);if(u)l=a[u.eventId].tournamentId;else return{event:void 0,drawDefinition:void 0,...q({result:{error:ps},stack:n})};return{event:u,drawDefinition:void 0,tournamentId:l}}return{event:void 0,drawDefinition:void 0,...q({result:{error:_a},context:{drawId:r,eventId:i},stack:n})}}function eN(t){let e=t.event,i=t.matchUpType,{scheduleVisibilityFilters:r,afterRecoveryTimes:n,tournamentRecord:a,usePublishState:s,scheduleTiming:o,matchUpFormat:l,publishStatus:u,matchUp:c}=t;if(!c)return{error:sa};if(n&&!c.matchUpType&&!t.matchUpType&&(e||a)&&c.drawId){let b=t.drawDefinition||e?.drawDefinitions?.find(U=>U.drawId===c.drawId);!b&&a&&({drawDefinition:b,event:e}=Wn({drawId:c.drawId,tournamentRecord:a}));let S=c.structureId&&b?.structures?.find(({structureId:U})=>U===c.structureId);i=t.matchUpType||S?.matchUpType||b?.matchUpType||e?.eventType!==ar&&e?.eventType}let{milliseconds:d,time:p}=o0e({matchUp:c}),{startTime:f}=u0e({matchUp:c}),{endTime:m}=p0e({matchUp:c}),h,{eventIds:g,drawIds:I}=r??{};if((!g||g.includes(c.eventId))&&(!I||I.includes(c.drawId))){let b=X=>X.createdAt?new Date(X.createdAt).getTime():0,S=new Map,U=c.timeItems?.toSorted((X,Z)=>b(X)-b(Z))??[];for(let X of U)S.set(X.itemType,X.itemValue);let T=S.get(U2),P=S.get(wu),D=S.get(Hh),E=S.get(XM),R=S.get(Gh),C=S.get(T2),M=S.get(KM),N=S.get(jh),A=S.get(Ed),O,k,F,x,L,$=c.matchUpType??i;if(o&&D&&n&&$){let X={matchUpFormat:c.matchUpFormat??l,...o};({averageMinutes:k=0,recoveryMinutes:F=0,typeChangeRecoveryMinutes:x=0}=JM({timingDetails:X,eventType:$})),(k||F)&&(O=m?Zn(pi(m),F):Zn(D,k+F)),x&&(L=m?Zn(pi(m),x):Zn(D,k+x))}!R&&D&&(R=Ze(D));let V=xP({scheduledDate:R,scheduledTime:D}),_={},B=(a&&N&&AI({tournamentRecord:a,venueId:N}))?.venueData||{};N&&(_[N]=B);let{venueName:G,venueAbbreviation:j,courtsInfo:K}=B,Y=(A&&K?.find(X=>X.courtId===A))?.courtName;for(let X of P||[]){if(!a)break;X.venueId&&!_[X.venueid]&&(_[X.venueId]=AI({venueId:X.venueId,tournamentRecord:a})?.venueData);let Z=_[X.venueId];X.venueName=Z?.venueName;let J=Z?.courtsInfo?.find(ae=>ae.courtId===X.courtId);X.courtName=J?.courtName}h=je({typeChangeTimeAfterRecovery:L,timeAfterRecovery:O,scheduledDate:R,scheduledTime:D,isoDateString:V,homeParticipantId:T,venueAbbreviation:j,allocatedCourts:P,timeModifiers:E,venueName:G,venueId:N,courtOrder:M,courtName:Y,courtId:A,official:C,typeChangeRecoveryMinutes:x,recoveryMinutes:F,averageMinutes:k,milliseconds:d,startTime:f,endTime:m,time:p})}else h=je({milliseconds:d,startTime:f,endTime:m,time:p});let{scheduledDate:v}=Df({matchUp:c}),{scheduledTime:w}=P2({matchUp:c});if(s&&u?.displaySettings?.draws){let b=u.displaySettings.draws,S=(b?.[c.drawId]??b?.default)?.scheduleDetails;if(S){let U=(S.find(T=>v&&T.dates?.includes(v))??S.find(T=>!T.dates?.length))?.attributes;if(U){let T=Object.assign({},...Object.keys(h).map(P=>({[P]:!0})),U);h=jm({source:h,template:T})}}}let y=c.matchUpStatus&&Ki.includes(c.matchUpStatus)&&(Ze(m)||Ze(v)||Ze(w))||void 0;return{schedule:h,endDate:y}}function f0e({drawPositions:t,roundProfile:e,roundNumber:i}){let r=[void 0,void 0];if(mte(t))return{orderedDrawPositions:r,displayOrder:r};let n=e?.[i],a=n?.pairedDrawPositions?.find(o=>xn(o||[],t.filter(Boolean)))??r,s=n?.feedRound;if(fte(t)){let o=[...t].sort(nr);return{orderedDrawPositions:o.length===2?o:a,displayOrder:s?o:a}}if(s){let o=[t.find(l=>!isNaN(Ke(l))),void 0];return{orderedDrawPositions:o,displayOrder:o}}return{orderedDrawPositions:a,displayOrder:a}}function XP({collectionPosition:t,collectionId:e,lineUp:i}){let r=[],n=[];if(i){let a=o=>o===void 0?-1:o,s=i.map(o=>{let{collectionAssignments:l,participantId:u}=o,c=l?.find(d=>d.collectionPosition===t&&d.collectionId===e);return c&&{participantId:u,...c}}).filter(Boolean).sort((o,l)=>a(o.substitutionOrder)-a(l.substitutionOrder));for(let o of s){let{participantId:l,previousParticipantId:u,substitutionOrder:c}=o;r.includes(l)||(u&&n.push({previousParticipantId:u,substitutionOrder:c,participantId:l}),r=r.filter(d=>d!==u),r.push(l))}}return{assignedParticipantIds:r,substitutions:n}}function ro({tournamentParticipants:t,tournamentRecord:e,participantIds:i}){let r="getPairedParticipant";if(!t&&!e)return{error:ve};if(!Array.isArray(i)||i.length>2)return{error:Ia};if(!i.length)return q({result:{error:Wd},stack:r});t=t??e?.participants??[];let n=t.filter(o=>o.participantType===ft&&Li(i,o.individualParticipantIds).length===i.length&&o.individualParticipantIds.length===i.length),a=n[0];if(!a)return q({result:{error:ji},stack:r});let s=Oe(n.slice(1),!1,!0);return{participant:Oe(a),duplicatedPairParticipants:s,...W}}function Wp({drawDefinition:t,participantId:e}){if(typeof t!="object")return{error:$e};if(typeof e!="string")return{error:dr};let{extension:i}=ht({element:t,name:Uc});return{lineUp:(i?.value||{})[e]}}function m0e({tournamentParticipants:t,positionAssignments:e,collectionPosition:i,drawPositions:r=[],participantMap:n,drawDefinition:a,collectionId:s,sideLineUps:o,matchUpType:l}){if(!s||!i)return{};let u=({attribute:d,lineUp:p,teamParticipant:f})=>{let{assignedParticipantIds:m,substitutions:h}=XP({collectionPosition:i,collectionId:s,lineUp:p});if(l===Bt){if(m?.length<=2){let g=n?.[m[0]]?.pairIdMap?.[m[1]],I=(g&&n[g]?.participant||ro({participantIds:m,tournamentParticipants:t}).participant)?.participantId;return{[d]:{participantId:I,teamParticipant:f,substitutions:h}}}else if(m?.length>2)return{[d]:{teamParticipant:f,substitutions:h}}}else{let g=m?.[0];return g&&{[d]:{participantId:g,teamParticipant:f,substitutions:h}}}};if(!r?.length){let d=o?.map(p=>{let{teamParticipant:f,sideNumber:m}=p,h=p.lineUp||Wp({participantId:f.teamParticipantId,drawDefinition:a})?.lineUp;return u({attribute:m,lineUp:h,teamParticipant:f})}).filter(Boolean)||{};return{sideNumberCollectionAssignment:Object.assign({},...d)}}let c=r?.map(d=>{let p=e.find(g=>g.drawPosition===d)?.participantId,f=o?.find(g=>g?.drawPosition===d),m=f?.teamParticipant||p&&n?.[p]?.participant||t?.find(({participantId:g})=>g===p),h=f?.lineUp||Wp({participantId:p,drawDefinition:a})?.lineUp;return u({attribute:d,lineUp:h,teamParticipant:m})}).filter(Boolean)||{};return{drawPositionCollectionAssignment:Object.assign({},...c)}}function tN(t){let e=He(t,[{[Au]:!0}]);if(e.error)return e;let i=t?.matchUp,r=i?.matchUpType;if(!r&&i?.sides?.length){let n=i.sides.find(({participant:a})=>a)?.participant?.participantType;r=n===It&&zt||n===ft&&Bt||n===_t&&_t||void 0}return{matchUpType:r}}function h0e({drawPositionCollectionAssignment:t,sideNumberCollectionAssignment:e,positionAssignments:i,displaySideNumber:r,seedAssignments:n,drawPosition:a,isFeedRound:s,sideNumber:o}){let l=i.find(f=>f.drawPosition&&f.drawPosition===a),u=a&&t,c=o&&e,d=u?u[a]?.participantId:l?.participantId,p=l?g0e({displaySideNumber:r,seedAssignments:n,participantId:d,assignment:l,sideNumber:o}):{...c?.[o]};if(s&&(o===1?Object.assign(p,{participantFed:!0}):Object.assign(p,{participantAdvanced:!0})),a&&u){let f=u[a]?.teamParticipant,m=u[a]?.participant,h=u[a]?.substitutions;m&&(p.participant=m),h&&(p.substitutions=h),f&&(p.teamParticipant=f)}return p}function g0e({displaySideNumber:t,seedAssignments:e,participantId:i,assignment:r,sideNumber:n}){let a={drawPosition:r.drawPosition,displaySideNumber:t,sideNumber:n};if(i){let s=I0e({seedAssignments:e,participantId:i});Object.assign(a,s,{participantId:i}),s?.seedNumber&&s?.seedValue===""&&(a.seedValue="~")}else r.bye&&Object.assign(a,{bye:!0});return r.qualifier&&Object.assign(a,{qualifier:!0}),a}function I0e({seedAssignments:t,participantId:e}){return t?.find(i=>!i.seedProxy&&i.participantId===e)}function nae({scheduleVisibilityFilters:t,sourceDrawPositionRanges:e,tournamentParticipants:i,positionAssignments:r,drawPositionsRanges:n,hydrateParticipants:a,afterRecoveryTimes:s,initialRoundOfPlay:o,additionalContext:l,roundNamingProfile:u,tournamentRecord:c,tieDrawPositions:d,appliedPolicies:p,isCollectionBye:f,seedAssignments:m,usePublishState:h,participantMap:g,contextContent:I,scheduleTiming:v,contextProfile:w,drawDefinition:y,publishStatus:b,scoringActive:S,matchUpTieId:U,isRoundRobin:T,roundProfile:P,sideLineUps:D,structure:E,context:R,matchUp:C,event:M}){l=l??{};let N=yn({drawDefinition:y,structure:E,matchUp:C,event:M})?.tieFormat,{roundOffset:A,structureId:O,structureName:k,stage:F,stageSequence:x}=E,{drawId:L,drawName:$,drawType:V}=y??{},_=N?.collectionDefinitions,B=C.collectionId&&_?.find(Q=>Q.collectionId===C.collectionId),G=C.collectionId?B?.matchUpFormat:C.matchUpFormat??E?.matchUpFormat??y?.matchUpFormat??M?.matchUpFormat,j=C.matchUpType||B?.matchUpType||E?.matchUpType||y?.matchUpType||!Pi(ar)(M?.eventType)&&M?.eventType,K=f?"BYE":C.matchUpStatus,{schedule:Y,endDate:X}=eN({scheduleVisibilityFilters:t,afterRecoveryTimes:s,tournamentRecord:c,usePublishState:h,scheduleTiming:v,drawDefinition:y,matchUpFormat:G,publishStatus:b,matchUpType:j,matchUp:C,event:M}),Z=d??C.drawPositions??[],{collectionPosition:J,collectionId:ae,roundPosition:te}=C,ne=C.roundNumber??l.roundNumber,le=ae?m0e({tournamentParticipants:i,positionAssignments:r,collectionPosition:J,participantMap:g,drawDefinition:y,drawPositions:Z,collectionId:ae,sideLineUps:D,matchUpType:j}):void 0,de=u?.[ne]?.roundName||l.roundName,pe=u?.[ne]?.abbreviatedRoundName||l.abbreviatedRoundName,ge=P?.[ne]?.feedRound,Me=P?.[ne]?.preFeedRound,Pe=P?.[ne]?.roundFactor,Be=n?.[ne],fe=te?Be?.[te]:void 0,Te=e?.[ne],ce=B?.category?{...R?.category,...B.category}:R?.category??M?.category,ye=C.processCodes?.length&&C.processCodes||B?.processCodes?.length&&B?.processCodes||E?.processCodes?.length&&E?.processCodes||y?.processCodes?.length&&y?.processCodes||M?.processCodes?.length&&M?.processCodes||c?.processCodes,be=w?.withCompetitiveness&&EU({...I,matchUp:C}),Fe=C.finishingPositionRange??l.finishingPositionRange,we=F!==ze&&lt(o)&&o+(ne||0),Ne=Q=>je(Q,void 0,!0),me={...Ne(R),...Ne({matchUpFormat:j===ar?void 0:G,tieFormat:j===ar?N:void 0,gender:B?.gender??M?.gender,endDate:C.endDate??X,discipline:M?.discipline,category:ce,finishingPositionRange:Fe,abbreviatedRoundName:pe,drawPositionsRange:fe,competitiveProfile:be,structureName:k,stageSequence:x,drawPositions:Z,matchUpStatus:K,processCodes:ye,isRoundRobin:T,matchUpTieId:U,preFeedRound:Me,matchUpType:j,roundFactor:Pe,roundOffset:A,structureId:O,roundNumber:ne,roundOfPlay:we,feedRound:ge,roundName:de,drawName:$,drawType:V,schedule:Y,drawId:L,stage:F}),...Oe(Ne(C),!0,!0)};if(G&&C.score?.scoreStringSide1){let Q=qi(G),{bestOf:se,finalSetFormat:oe,setFormat:ue}=Q??{};(oe?.tiebreakSet||ue?.tiebreakSet||ue?.timed)&&(me.score.sets=me.score.sets.sort((ee,Se)=>ee.setNumber-Se.setNumber).map((ee,Se)=>{let De=Se+1===se&&oe?oe:ue,it=De?.tiebreakSet&&!De?.timed,Ue=De?.timed;return it?(ee.tiebreakSet=!0,[1,2].includes(ee.winningSide)&&(ee.side1Score=ee.winningSide===1?1:0,ee.side2Score=ee.winningSide===2?1:0)):Ue&&(ee.timed=!0),ee}))}if(Array.isArray(Z)){let{orderedDrawPositions:Q,displayOrder:se}=f0e({drawPositions:Z,roundProfile:P,roundNumber:ne}),oe=P?.[ne]?.feedRound,ue=se[0]!==Q[0],ee=Q.concat(void 0,void 0).slice(0,2).map((Se,De)=>{let it=De+1,Ue=ue?3-it:it,ut=h0e({...le,positionAssignments:r,displaySideNumber:Ue,seedAssignments:m,drawPosition:Se,isFeedRound:oe,sideNumber:it}),yi=C.sides?.find(oi=>oi.sideNumber===it),qe=te?(te-1)*2+De+1:void 0,bi=qe?Te?.[qe]:void 0;return Ne({sourceDrawPositionRange:bi,...yi,...ut})});Object.assign(me,Oe({sides:ee},!0,!0))}if(i&&me.sides){let Q=p?.[$v],se=oe=>{let ue=g?.[oe]?.participant;return ue&&jm({template:Q?.participant,source:ue})};if(me.sides.filter(Boolean).forEach(oe=>{if(oe.participantId){let ue=Oe(se(oe.participantId)||(i?Ud({policyDefinitions:p,participantId:oe.participantId,tournamentParticipants:i,internalUse:!0,contextProfile:w}):void 0),void 0,!0);if(ue){let ee,Se;if(y?.entries){let De=y.entries.find(Ue=>Ue.participantId===oe.participantId),it=M?.entries?.find(Ue=>Ue.participantId===oe.participantId);ee=De?.entryStatus||it?.entryStatus,ue.entryStatus=ee,De?.entryStage&&(Se=De.entryStage,ue.entryStage=Se)}a===!1?Object.assign(oe,{participant:{entryStage:Se,entryStatus:ee}}):Object.assign(oe,{participant:ue})}}if(oe?.participant?.individualParticipantIds?.length&&!oe.participant.individualParticipants?.length){let ue=oe.participant.individualParticipantIds.map(ee=>se(ee)||(i?Ud({policyDefinitions:p,tournamentParticipants:i,internalUse:!0,contextProfile:w,participantId:ee}):void 0));a!==!1&&Object.assign(oe.participant,{individualParticipants:ue})}}),!me.matchUpType){let{matchUpType:oe}=tN({matchUp:me});oe&&Object.assign(me,{matchUpType:oe})}if(w?.inferGender&&(!me.gender||me.gender===Fh)&&me.sides?.length===2&&me.matchUpType!==ar){let oe=me.sides.map(ue=>{if(Pi(zt)(me.matchUpType))return ue.participant?.person?.sex;if(ue.participant?.individualParticipants?.length===2){let ee=nt(ue.participant.individualParticipants.map(Se=>Se.person?.sex)).filter(Boolean);if(ee.length===1)return ee[0]}});if(oe.filter(Boolean).length===2&&nt(oe).length===1){let ue=oe[0];me.inferredGender=ue}}}if(me.tieMatchUps){let Q=me.matchUpStatus==="BYE",se=me.sides?.map(({participant:oe,drawPosition:ue,sideNumber:ee,lineUp:Se})=>{let De=oe?.participantType===ar&&oe;return{teamParticipant:De&&je({participantRoleResponsibilities:De.participantRoleResponsibilities,participantOtherName:De.participanOthertName,participantName:De.participantName,participantId:De.participantId,teamId:De.teamId}),drawPosition:ue,sideNumber:ee,lineUp:Se}});me.tieMatchUps=me.tieMatchUps.map(oe=>{let ue=me.matchUpId,ee={finishingPositionRange:me.finishingPositionRange,abbreviatedRoundName:pe,roundNumber:ne,roundName:de};return nae({tieDrawPositions:Z,scheduleVisibilityFilters:t,sourceDrawPositionRanges:e,sideLineUps:se,drawPositionsRanges:n,initialRoundOfPlay:o,roundNamingProfile:u,additionalContext:ee,appliedPolicies:p,isCollectionBye:Q,usePublishState:h,publishStatus:b,matchUpTieId:ue,isRoundRobin:T,roundProfile:P,matchUp:oe,event:M,tournamentParticipants:i,positionAssignments:r,tournamentRecord:c,seedAssignments:m,participantMap:g,contextContent:I,scheduleTiming:v,contextProfile:w,drawDefinition:y,scoringActive:S,structure:E,context:R})})}let Ee=me.sides?.filter(Q=>Q?.participantId).length===2,Le=!me.winningSide;if(Object.assign(me,{readyToScore:S&&Ee&&Le,hasContext:!0}),Ee){let{allParticipantsCheckedIn:Q,checkedInParticipantIds:se}=Wh({matchUp:me});Object.assign(me,{allParticipantsCheckedIn:Q,checkedInParticipantIds:se})}return Array.isArray(w?.exclude)&&w?.exclude.forEach(Q=>delete me[Q]),me}function v0e({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:r,timeStamp:n}=Tf({timeItems:i?.timeItems||[],itemType:wu});return!e||n&&t&&new Date(n).getTime()>new Date(t).getTime()?{allocatedCourts:Oe(r,!1,!0)}:e}function y0e({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:r,timeStamp:n}=Tf({timeItems:i?.timeItems||[],itemType:Ed});return!e||n&&t&&new Date(n).getTime()>new Date(t).getTime()?{courtId:r}:e}function b0e({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:r,timeStamp:n}=Tf({timeItems:i?.timeItems||[],itemType:jh});return!e||n&&t&&new Date(n).getTime()>new Date(t).getTime()?{venueId:r}:e}function Yu(t){if(!Array.isArray(t.matchUps))return[];let{matchUps:e,excludeMatchUpStatuses:i,hasParticipantsCount:r,isCollectionMatchUp:n,matchUpStatuses:a,hasWinningSide:s,matchUpFormats:o,roundPositions:l,matchUpFormat:u,collectionIds:c,isMatchUpTie:d,roundNumbers:p,matchUpIds:f,roundNames:m,filterMatchUpTypes:h=!0,filterMatchUpIds:g=!0,stageSequences:I,scheduledDates:v,scheduledDate:w,participantIds:y,processContext:b,tournamentIds:S,matchUpTypes:U,structureIds:T,readyToScore:P,courtIds:D,eventIds:E,venueIds:R,drawIds:C,stages:M}=t,N=Array.isArray(y)?y.filter(Boolean):[],A=Array.isArray(a)?a.filter(Boolean):[],O=Array.isArray(i)?i.filter(Boolean):[],k=Array.isArray(M)?M.filter(Boolean):[],F=Array.isArray(I)?I.filter(Boolean):[],x=Array.isArray(c)?c.filter(Boolean):[],L=Array.isArray(m)?m.filter(Boolean):[],$=Array.isArray(p)?p.filter(Boolean):[],V=Array.isArray(l)?l.filter(Boolean):[],_=Array.isArray(f)&&g?f.filter(Boolean):[],B=Array.isArray(U)&&h?U.filter(Boolean):[],G=Array.isArray(D)?D.filter(Boolean):[],j=Array.isArray(R)?R.filter(Boolean):[],K=Array.isArray(o)&&o.filter(Boolean)||typeof u=="string"&&[u]||[],Y=Array.isArray(v)&&v.filter(Boolean)||typeof w=="string"&&w.length&&[w]||[],X=Array.isArray(S)?S.filter(Boolean):[],Z=Array.isArray(E)?E.filter(Boolean):[],J=Array.isArray(C)?C.filter(Boolean):[],ae=Array.isArray(T)?T.filter(Boolean):[];return e.filter(te=>{if(P&&!Pi(La)(te)&&!te.readyToScore||te.winningSide&&s&&![1,2].includes(te.winningSide)||d!==void 0&&(d&&!te.tieMatchUps||!d&&te.tieMatchUps)||n!==void 0&&(n&&!te.collectionId||!n&&te.collectionId)||k.length&&!k.includes(te.stage)||F.length&&!F.includes(te.stageSequence)||x.length&&(!te.collectionId||!x.includes(te.collectionId))||L.length&&(!te.roundName||!L.includes(te.roundName))||$.length&&(!te.roundNumber||!$.includes(te.roundNumber))||V.length&&(!te.roundPosition||!V.includes(te.roundPosition))||A.length&&(!te.matchUpStatus||!A.includes(te.matchUpStatus))||O.length&&te.matchUpStatus&&O.includes(te.matchUpStatus)||_.length&&!_.includes(te.matchUpId)||B.length&&(!te.matchUpType||!fm(B,te.matchUpType))||K.length&&(!te.matchUpFormat||!K.includes(te.matchUpFormat)))return!1;if(Y?.length){let{scheduledTime:ne}=P2({matchUp:te}),{scheduledDate:le}=Df({matchUp:te}),de=Ze(ne)||le;if(!Y.some(pe=>pu(pe,de)))return!1}if(G.length){let{courtId:ne}=y0e({matchUp:te}),{allocatedCourts:le}=v0e({matchUp:te}),de=le?.map(({courtId:pe})=>pe);if(!G.filter(Boolean).includes(ne)||de?.includes(ne))return!1}if(j.length){let{venueId:ne}=b0e({matchUp:te});if(!j.filter(Boolean).includes(ne))return!1}if(b){if(X.length&&!X.includes(te.tournamentId)||Z.length&&!Z.includes(te.eventId)||J.length&&!J.includes(te.drawId)||ae.length&&!ae.includes(te.structureId))return!1;let ne=te.sides?.map(({participantId:le})=>le).filter(Boolean)??[];if(r&&ne.length<r||N.length&&!N.some(le=>ne.includes(le)))return!1}return!0})}function At(t){let{provisionalPositioning:e,tournamentRecord:i,contextFilters:r,matchUpFilters:n,contextProfile:a,drawDefinition:s,context:o={},structure:l,inContext:u,event:c}=t,{seedAssignments:d,contextContent:p,exitProfiles:f,matchUpsMap:m}=t,h={},g={};if(!l)return{collectionPositionMatchUps:h,error:hf,roundMatchUps:g,matchUps:[]};let I=Array.isArray(n?.eventIds)?n?.eventIds.filter(Boolean):[],v=Array.isArray(n?.structureIds)?n?.structureIds.filter(Boolean):[],w=Array.isArray(n?.drawIds)?n?.drawIds.filter(Boolean):[],y=!o?.eventId||!I?.length&&!r?.eventIds?.filter(Boolean).length||I?.includes(o.eventId)||r?.eventIds?.includes(o.eventId),b=!v?.length||v.includes(l.structureId),S=!s||!w?.length||w.includes(s.drawId);if(!y||!b||!S)return{collectionPositionMatchUps:h,roundMatchUps:g,matchUps:[]};a&&!p&&(p=Hc({tournamentRecord:i,contextProfile:a,drawDefinition:s}));let{appliedPolicies:U}=Dt({drawDefinition:s}),T={...t.tournamentAppliedPolicies,...U,...t.policyDefinitions},P=T?.scoring?.structures,D=l.stage&&P?.stage?.[l.stage],E=l.stageSequence&&D?.stageSequence?.[l.stageSequence],R=T?.scoring?.requireAllPositionsAssigned||D?.requireAllPositionsAssigned||E?.requireAllPositionsAssigned;m||(m=Or({drawDefinition:s,structure:l}));let{positionAssignments:C,allPositionsAssigned:M}=pr({structure:l}),N=!R||M,{seedAssignments:A}=hs({provisionalPositioning:e,drawDefinition:s,structure:l});d=d??A;let{structureId:O}=l;f=f||s&&Lne({drawDefinition:s}).exitProfiles;let k=f?.[O],F=k?.length&&(k[0].split("-").map(G=>parseInt(G)).reduce((G,j)=>G+j)||0),x=!!l.structures,L=Pd({matchUpsMap:m,structureId:O,inContext:u}),$=T?.[Sc],V=_ne({roundNamingPolicy:$,drawDefinition:s,structure:l,matchUps:L}),{roundNamingProfile:_,roundProfile:B}=V;if(g=V?.roundMatchUps??[],n&&(L=Yu({matchUps:L,...n,filterMatchUpTypes:!1,filterMatchUpIds:!1})),u){let{sourceDrawPositionRanges:G}=_Le({drawDefinition:s,matchUpsMap:m,structureId:O}),j=s?$Le({drawDefinition:s,roundProfile:B,matchUpsMap:m,structureId:O}).drawPositionsRanges:void 0,K=t.tournamentParticipants,Y=t.participantMap;!K?.length&&!Y&&i&&({participants:K=[],participantMap:Y}=bf({participantsProfile:t.participantsProfile,useParticipantMap:t.useParticipantMap,policyDefinitions:t.policyDefinitions,tournamentRecord:i,contextProfile:a,inContext:u})),L=L.map(X=>nae({scheduleVisibilityFilters:t.scheduleVisibilityFilters,hydrateParticipants:t.hydrateParticipants,afterRecoveryTimes:t.afterRecoveryTimes,usePublishState:t.usePublishState,scheduleTiming:t.scheduleTiming,publishStatus:t.publishStatus,sourceDrawPositionRanges:G,tournamentParticipants:K,positionAssignments:C,drawPositionsRanges:j,initialRoundOfPlay:F,roundNamingProfile:_,tournamentRecord:i,appliedPolicies:T,seedAssignments:d,contextContent:p,participantMap:Y,contextProfile:a,drawDefinition:s,scoringActive:N,isRoundRobin:x,roundProfile:B,structure:l,context:o,matchUp:X,event:c})),(L?.filter(X=>Array.isArray(X.tieMatchUps))).forEach(X=>{let Z=X.tieMatchUps;L=L.concat(...Z)}),r&&(L=Yu({processContext:!0,...r,matchUps:L}))}else(L?.filter(G=>Array.isArray(G.tieMatchUps))).forEach(G=>{let j=G.tieMatchUps;L=L.concat(...j)});return n&&(L=Yu({matchUps:L,...n,filterMatchUpTypes:!1,filterMatchUpIds:!1})),(n?.matchUpTypes||n?.matchUpIds)&&(L=Yu({matchUpTypes:n.matchUpTypes,matchUpIds:n.matchUpIds,matchUps:L})),(n?.matchUpTypes||n?.matchUpIds||u)&&(g=Sn({matchUps:L}).roundMatchUps??[]),yn({drawDefinition:s,structure:l,event:c})?.tieFormat&&({collectionPositionMatchUps:h}=FLe({matchUps:L})),{collectionPositionMatchUps:h,roundMatchUps:g,isRoundRobin:x,roundProfile:B,matchUpsMap:m,matchUps:L}}function yp({matchUp:t}){return t?Ki.includes(t?.matchUpStatus)||t?.winningSide:!1}function iN({requireParticipants:t=!0,scheduleVisibilityFilters:e,tournamentAppliedPolicies:i,tournamentParticipants:r,hydrateParticipants:n,afterRecoveryTimes:a,policyDefinitions:s,tournamentRecord:o,usePublishState:l,matchUpFilters:u,contextFilters:c,contextContent:d,participantMap:p,scheduleTiming:f,publishStatus:m,contextProfile:h,drawDefinition:g,exitProfiles:I,matchUpsMap:v,structureId:w,inContext:y,structure:b,context:S,event:U}){!b&&w&&({structure:b}=tt({drawDefinition:g,structureId:w}));let T=At({tournamentAppliedPolicies:i,scheduleVisibilityFilters:e,tournamentParticipants:r,hydrateParticipants:n,afterRecoveryTimes:a,policyDefinitions:s,tournamentRecord:o,usePublishState:l,matchUpFilters:u,contextFilters:c,contextContent:d,participantMap:p,scheduleTiming:f,publishStatus:m,contextProfile:h,drawDefinition:g,exitProfiles:I,matchUpsMap:v,structure:b,inContext:y,context:S,event:U}),P=[],D=[],E=[],R=[],C=[];if(T.error)return T;let{matchUps:M}=T,{assignedPositions:N}=pr({structure:b}),A=N?.filter(k=>k.participantId).map(k=>k.drawPosition),O;return M.filter(k=>{let F=u?.matchUpTypes?.length===1&&u.matchUpTypes[0]===ei;return!(k.matchUpType!==ei&&F)}).forEach(k=>{if(k.matchUpStatus===Ta){P.push(k);return}k.matchUpType===ei&&(O=!0);let F=!!k.collectionId,x=F&&k.sides?.every(G=>G.participantId),L=!F&&k.drawPositions?.filter(Boolean).length===2,$=!F&&k.drawPositions?.every(G=>A?.includes(G)),V=N?.filter(G=>G.bye).map(G=>G.drawPosition),_=!F&&k.drawPositions?.find(G=>V?.includes(G)),B=Ine.includes(k.matchUpStatus)&&(x||L&&(!t||$));return _?C.push(k):yp({matchUp:k})?D.push(k):B?E.push(k):R.push(k)}),{includesTeamMatchUps:O,abandonedMatchUps:P,completedMatchUps:D,upcomingMatchUps:E,pendingMatchUps:R,byeMatchUps:C,structure:b}}function w0e({drawDefinition:t,roundNumber:e,structureId:i}){if(!t)return{error:$e};if(!i)return{error:qa};let{links:r}=Gv({drawDefinition:t,structureId:i}),n=r.source.reduce((s,o)=>!o.source.roundNumber||o.source.roundNumber===e?s.concat(o):s,[]),a=r.target.reduce((s,o)=>!o.target.roundNumber||o.target.roundNumber===e?s.concat(o):s,[]);return{links:{source:n,target:a}}}function sk({finishingPositions:t,linkCondition:e,linkType:i,source:r}){let n=r.find(a=>{let s=!a.source?.finishingPositions||!t||xn(t,a.source?.finishingPositions);return e===a.linkCondition&&s&&a.linkType===i});return[mu,hu].includes(n?.linkType)&&!n?.source?.roundNumber?q({result:{error:re},stack:"getTargetLink",context:n}):n}function Gv({drawDefinition:t,structureId:e,roundNumber:i}){return t?e?{links:(t.links||[]).filter(Boolean).reduce((r,n)=>(n.source?.structureId===e&&(!i||n.source.roundNumber===i)&&(r.source=r.source.concat(n)),n.target?.structureId===e&&(!i||n.target.roundNumber===i)&&(r.target=r.target.concat(n)),r),{source:[],target:[]})}:{error:qa}:{error:$e}}function S0e({structureMatchUps:t,matchUp:e}){let{roundNumber:i,roundPosition:r}=e,n=t.filter(s=>s.roundNumber===i&&!s.matchUpTieId),a=t.filter(s=>s.roundNumber===i+1&&!s.matchUpTieId);if(a.length){let s;return a.length===n.length?s=a.find(o=>o.roundPosition===r):a.length===n.length/2&&(s=a.find(o=>o.roundPosition===Math.ceil(r/2))),{matchUp:s}}return{message:"no progression found"}}function ok({sourceRoundMatchUpCount:t,inContextDrawMatchUps:e,sourceRoundPosition:i,drawDefinition:r,targetLink:n}){if(!n)return{error:Z$};let{target:{structureId:a,feedProfile:s,groupedOrder:o,roundNumber:l,positionInterleave:u}}=n,{structure:c}=tt({drawDefinition:r,structureId:a}),{positionAssignments:d}=Kt({structure:c}),p=(e?.filter(P=>P.structureId===c?.structureId)).filter(P=>P.roundNumber===l&&!P.matchUpTieId),f=p.length,m=Ce(1,f+1),h=f/t,g=Math.ceil(h*i),I=1-i%2;if(u?.interleave&&h!==.5){let P=u.offset+(i-1)*u.interleave,D=i+P;g=Math.ceil(D/2),I=1-D%2}let v=m,w=m[g-1],y=Fne({roundPositionsCount:m.length,groupedOrder:o}),b=y?.length||1;if(b<=m.length){let P=f/b,D=wr(m,P);s===jp&&D.forEach(E=>E.reverse()),v=y?.length&&y?.map(E=>D[E-1]).flat()||v}s===As?w=v[g-1]:s===jp?((!y?.length||b>m.length)&&(g=p.length+1-g),w=v[g-1]):s===CM&&la()&&console.log(IB,{feedProfile:s});let S=w&&p.reduce((P,D)=>D.roundPosition===w?D:P,void 0),U;S?.feedRound?(I=0,U=Math.min(...(S.drawPositions||[]).filter(Boolean))):U=S?.drawPositions?.length===2&&S?.drawPositions[I];let T=d?.find(({drawPosition:P})=>P===U);if(T){let{extension:P}=ht({element:T,name:BM});if(P?.value)return{disabledDrawPosition:U}}return{matchUp:S,targetDrawPosition:U,matchUpDrawPositionIndex:I}}function Fn({inContextDrawMatchUps:t=[],useTargetMatchUpIds:e,inContextMatchUp:i,drawDefinition:r,matchUpId:n}){let a=i;t.length&&!a&&(a=t.find(o=>o.matchUpId===n));let{structure:s}=tt({structureId:a?.structureId,drawDefinition:r});return s?.finishingPosition===_h?U0e({inContextDrawMatchUps:t,useTargetMatchUpIds:e,drawDefinition:r,structure:s,matchUp:a}):T0e({matchUp:a})}function U0e({inContextDrawMatchUps:t,useTargetMatchUpIds:e,drawDefinition:i,structure:r,matchUp:n}){let{winnerMatchUpId:a,loserMatchUpId:s}=n,{links:o}=w0e({roundNumber:n.roundNumber,structureId:r.structureId,drawDefinition:i}),l=o?.source,u=sk({source:l,linkType:mu}),c=sk({linkCondition:fl,linkType:hu,source:l}),d=sk({source:l,linkType:hu}),p=c&&d;d||(d=c);let f=u?.target?.feedProfile,m=d?.target?.feedProfile,h=c?.target?.feedProfile,g,I,v,w,y,b,S,U,T,P;if(e&&(a||s)&&(S=a&&f!==ho&&t.find(({matchUpId:R})=>R===a),w=s&&m!==ho&&t.find(({matchUpId:R})=>R===s),S||w))return{matchUp:n,targetLinks:{loserTargetLink:d,winnerTargetLink:u},targetMatchUps:{loserMatchUp:w,winnerMatchUp:S}};let{roundPosition:D}=n;P=P||t.filter(R=>R.structureId===r.structureId);let E=P.reduce((R,C)=>C.roundNumber===n.roundNumber&&!C.matchUpTieId?R+1:R,0);return d&&!w&&m!==ho&&({matchUpDrawPositionIndex:b,targetDrawPosition:y,matchUp:w}=ok({targetLink:d,sourceRoundMatchUpCount:E,inContextDrawMatchUps:t,sourceRoundPosition:D,drawDefinition:i})),p&&h!==ho&&({matchUpDrawPositionIndex:v,targetDrawPosition:I,matchUp:g}=ok({targetLink:c,sourceRoundMatchUpCount:E,inContextDrawMatchUps:t,sourceRoundPosition:D,drawDefinition:i})),u&&!S&&f!==ho&&({matchUpDrawPositionIndex:T,targetDrawPosition:U,matchUp:S}=ok({targetLink:u,sourceRoundMatchUpCount:E,inContextDrawMatchUps:t,sourceRoundPosition:D,drawDefinition:i})),S||(P=P||t.filter(R=>R.structureId===r.structureId),{matchUp:S}=S0e({structureMatchUps:P,matchUp:n})),je({matchUp:n,targetLinks:{loserTargetLink:d,winnerTargetLink:u,byeTargetLink:c},targetMatchUps:{winnerMatchUpDrawPositionIndex:T,loserMatchUpDrawPositionIndex:b,byeMatchUpDrawPositionIndex:v,winnerTargetDrawPosition:U,loserTargetDrawPosition:y,byeTargetDrawPosition:I,winnerMatchUp:S,loserMatchUp:w,byeMatchUp:g},targetMatchUpIds:!!(a||s)})}function T0e({matchUp:t}){return{targetLinks:{loserTargetLink:void 0,winnerTargetLink:void 0},targetMatchUps:{loserMatchUp:void 0,winnerMatchUp:void 0},matchUp:t}}function D0e({drawDefinition:t,inContextDrawMatchUps:e}){let i={};return e.forEach(r=>{let{matchUpId:n,structureId:a,drawPositions:s=[]}=r,{structure:o}=tt({drawDefinition:t,structureId:a});if(o?.finishingPosition===Gp){let{roundNumber:l}=r,u=l&&Ke(l)+1,c=o.matchUps??[],{roundMatchUps:d}=Sn({matchUps:c});if(u&&d?.[u]){let p=[...s].sort(nr).map((f,m)=>{let h=d[u].find(g=>g.drawPositions?.includes(f));return{matchUpId:h?.matchUpId,roundNumber:u,schedule:h?.schedule,sideNumber:m+1,structureName:o.structureName}});Object.assign(r,{sidesTo:p})}}else{let l=Fn({useTargetMatchUpIds:!0,inContextDrawMatchUps:e,inContextMatchUp:r,drawDefinition:t,matchUpId:n}),{winnerMatchUp:u}=l.targetMatchUps,{loserMatchUp:c}=l.targetMatchUps;!r.winnerMatchUpId&&u&&(r.winnerMatchUpId=u.matchUpId),!r.loserMatchUpId&&c&&(r.loserMatchUpId=c.matchUpId);let d=lk({upcomingMatchUp:u}),p=lk({upcomingMatchUp:c});if(r.matchUpStatus!=="BYE"&&c?.matchUpStatus==="BYE"){let{matchUp:m}=aae({matchUp:c,drawDefinition:t,inContextDrawMatchUps:e})||{};p=m&&lk({upcomingMatchUp:m})||p}let f=r.schedule?.timeAfterRecovery;if(f&&(d?.schedule?.scheduledTime&&Rt(d.schedule.scheduledTime)<Rt(f)&&(i[d.matchUpId]=r.matchUpId,d.schedule.scheduleConflict=r.matchUpId),p?.schedule?.scheduledTime&&Rt(p.schedule.scheduledTime)<Rt(f)&&(i[p.matchUpId]=r.matchUpId,p.schedule.scheduleConflict=r.matchUpId)),Object.assign(r,{winnerTo:d,loserTo:p}),r.drawPositions?.filter(Boolean).length){let m=l.targetLinks?.loserTargetLink?.linkCondition===fl,h=P0e(r);if(h.length){let g=wx(u?.sides),I=wx(c?.sides),v=h.find(({participantId:y})=>g.includes(y))?[]:h,w=h.find(({participantId:y})=>I.includes(y))?[]:h;c&&m&&w.length<2&&w.push({bye:!0,tbd:!0}),v?.length&&u&&(!l.targetMatchUpIds&&u&&(u=e.find(({matchUpId:y})=>y===u.matchUpId)),u.potentialParticipants||(u.potentialParticipants=[]),u.potentialParticipants.push(v)),w?.length&&c&&(l.targetMatchUpIds||(u=e.find(({matchUpId:y})=>y===c.matchUpId)),c.potentialParticipants||(c.potentialParticipants=[]),c.potentialParticipants.push(w))}}}}),Object.keys(i).length&&e.forEach(r=>{Object.keys(i).includes(r.matchUpId)&&(r.schedule.scheduleConflict=i[r.matchUpId])}),{scheduleConflictMatchUpIds:i}}function P0e(t){return t?.sides?.map(({participant:e,participantId:i,qualifier:r})=>e||i&&{participantId:i}||r&&{qualifier:r}).filter(Boolean)||[]}function aae({matchUp:t,drawDefinition:e,inContextDrawMatchUps:i}){let{matchUpId:r,matchUpStatus:n,structureId:a}=t||{};if(!t||!a||t?.matchUpStatus===_i)return{matchUp:t};if(n==="BYE"){let s;return t.winnerMatchUpId?s=i.find(({matchUpId:o})=>o===t.winnerMatchUpId):{winnerMatchUp:s}=Fn({inContextDrawMatchUps:i,drawDefinition:e,matchUpId:r})?.targetMatchUps||{},aae({matchUp:s,drawDefinition:e,inContextDrawMatchUps:i})}return{matchUp:void 0}}function lk(t){if(t?.upcomingMatchUp)return(({matchUpId:e,structureId:i,schedule:r,roundNumber:n,roundPosition:a,structureName:s})=>({matchUpId:e,structureId:i,schedule:r,roundNumber:n,roundPosition:a,structureName:s}))(t.upcomingMatchUp)}function Zi(t){let e="getAllDrawMatchUps";Object.assign(t,{requireParticipants:!1});let i=Hv(t);if(i.error)return q({result:i,stack:e});let{abandonedMatchUps:r,completedMatchUps:n,upcomingMatchUps:a,pendingMatchUps:s,byeMatchUps:o,matchUpsMap:l}=i;return{matchUps:(r??[]).concat(...n??[],...a??[],...s??[],...o??[]),matchUpsMap:l}}function Hv(t){if(!t?.drawDefinition)return{error:$e};let{tournamentParticipants:e,contextContent:i,matchUpsMap:r}=t,{scheduleVisibilityFilters:n,tournamentAppliedPolicies:a,requireParticipants:s,participantsProfile:o,afterRecoveryTimes:l,policyDefinitions:u,tournamentRecord:c,usePublishState:d,contextFilters:p,matchUpFilters:f,scheduleTiming:m,participantMap:h,publishStatus:g,contextProfile:I,drawDefinition:v,nextMatchUps:w,inContext:y,context:b,event:S}=t,U=[],T=[],P=[],D=[],E=[];I&&!i&&(i=Hc({policyDefinitions:u,tournamentRecord:c,contextProfile:I,event:S}));let R;!e?.length&&c&&(e=c?.participants,(y||o?.withGroupings)&&e?.length&&({participantsWithGroupings:e,groupInfo:R}=zM({participants:e,participantsProfile:o})));let{structures:C}=io({drawDefinition:v});if(!C)return{error:vi};r||(r=Or({drawDefinition:v}));let M=v&&Lne({drawDefinition:v}).exitProfiles;C.forEach(O=>{let{byeMatchUps:k=[],pendingMatchUps:F=[],upcomingMatchUps:x=[],completedMatchUps:L=[],abandonedMatchUps:$=[]}=iN({matchUpFilters:w?void 0:f,contextFilters:w?void 0:p,inContext:y||w||p,hydrateParticipants:t.hydrateParticipants,tournamentAppliedPolicies:a,scheduleVisibilityFilters:n,tournamentParticipants:e,requireParticipants:s,afterRecoveryTimes:l,policyDefinitions:u,tournamentRecord:c,usePublishState:d,contextContent:i,participantMap:h,scheduleTiming:m,publishStatus:g,contextProfile:I,drawDefinition:v,exitProfiles:M,matchUpsMap:r,structure:O,context:b,event:S});U=U.concat(...$),T=T.concat(...L),P=P.concat(...x),D=D.concat(...F),E=E.concat(...k)});let N=O=>(!f&&!w&&!p||(f&&(O=Yu({matchUps:O,...f})),p&&(O=Yu({matchUps:O,...p,processContext:!0}))),O),A={abandonedMatchUps:N(U),completedMatchUps:N(T),upcomingMatchUps:N(P),pendingMatchUps:N(D),byeMatchUps:N(E),matchUpsMap:r,...W,groupInfo:R};if(w){let O=typeof w=="object"||{abandoned:!0,completed:!0,upcoming:!0,pending:!0,bye:!0},{abandoned:k,completed:F,upcoming:x,pending:L,bye:$}=O,V=[].concat(...k&&U||[],...F&&T||[],...x&&P||[],...L&&D||[],...$&&E||[]);D0e({inContextDrawMatchUps:V,drawDefinition:v})}return A}function xu(t){let{participants:e=[],contextContent:i,participantMap:r}=t,{scheduleVisibilityFilters:n,tournamentAppliedPolicies:a,participantsProfile:s,afterRecoveryTimes:o,policyDefinitions:l,useParticipantMap:u,tournamentRecord:c,usePublishState:d,contextFilters:p,matchUpFilters:f,contextProfile:m,nextMatchUps:h,inContext:g,context:I,event:v}=t;if(!v)return{error:ui};let{eventId:w,eventName:y,endDate:b,eventType:S,category:U,gender:T,matchUpFormat:P}=v??{},D={...I,...je({indoorOutDoor:v.indoorOutdoor??c?.indoorOutdoor,surfaceCategory:v.surfaceCategory??c?.surfaceCategory,endDate:v.endDate??c?.endDate,tournamentId:c?.tournamentId,matchUpFormat:P,eventName:y,eventType:S,category:U,eventId:w,gender:T})};b&&(D.endDate=b),m&&!i&&(i=Hc({policyDefinitions:l,tournamentRecord:c,contextProfile:m,event:v}));let E;if(!e?.length&&!r&&c){let M=bf({participantsProfile:s,useParticipantMap:u,tournamentRecord:c,contextProfile:m,inContext:g});r=M.participantMap,e=M.participants??[],E=M.groupInfo}let R=v.drawDefinitions??[],C=yU({tournamentRecord:c,event:v}).scheduleTiming;return{matchUps:R.flatMap(M=>{let{matchUps:N}=Zi({tournamentParticipants:e,tournamentAppliedPolicies:a,scheduleVisibilityFilters:n,context:D,participantsProfile:s,afterRecoveryTimes:o,policyDefinitions:l,tournamentRecord:c,usePublishState:d,contextFilters:p,contextProfile:m,drawDefinition:M,contextContent:i,matchUpFilters:f,participantMap:r,scheduleTiming:C,nextMatchUps:h,inContext:g,event:v});return N??[]}),groupInfo:E}}function Ur(t){let e=He(t,[{tournamentRecord:!0}]);if(e.error)return e;if(!t?.tournamentRecord)return{error:ve};let{participantMap:i,participants:r}=t,{scheduleVisibilityFilters:n,participantsProfile:a,afterRecoveryTimes:s,useParticipantMap:o,policyDefinitions:l,tournamentRecord:u,inContext:c=!0,usePublishState:d,contextProfile:p,matchUpFilters:f,contextFilters:m,nextMatchUps:h,context:g}=t,I=t.tournamentId??u.tournamentId,v=u?.events??[];r||({participants:r,participantMap:i}=bf({participantsProfile:a,useParticipantMap:o,tournamentRecord:u,contextProfile:p,inContext:c}));let{appliedPolicies:w}=Dt({tournamentRecord:u}),y={...g,tournamentId:I,indoorOutDoor:u.indoorOutdoor,surfaceCategory:u.surfaceCategory,endDate:u.endDate},b=Hc({policyDefinitions:l,tournamentRecord:u,contextProfile:p});return{matchUps:v.flatMap(S=>(y.eventDrawsCount=S.drawDefinitions?.length??0,xu({context:y,scheduleVisibilityFilters:n,tournamentAppliedPolicies:w,participantsProfile:a,afterRecoveryTimes:s,policyDefinitions:l,tournamentRecord:u,usePublishState:d,contextContent:b,contextFilters:m,contextProfile:p,matchUpFilters:f,participantMap:i,nextMatchUps:h,participants:r,inContext:c,event:S}).matchUps??[])).concat(...u.matchUps??[])}}function No({scheduleVisibilityFilters:t,afterRecoveryTimes:e,participantsProfile:i,tournamentRecords:r,policyDefinitions:n,usePublishState:a,matchUpFilters:s,contextFilters:o,nextMatchUps:l,inContext:u}){if(typeof r!="object"||!Object.keys(r).length)return{error:Mi};let c=Object.keys(r).map(d=>{let p=r[d];return Ur({scheduleVisibilityFilters:t,afterRecoveryTimes:e,participantsProfile:i,policyDefinitions:n,tournamentRecord:p,usePublishState:a,matchUpFilters:s,contextFilters:o,nextMatchUps:l,inContext:u}).matchUps??[]}).flat();return{...W,matchUps:c}}function zh(t,e){return E0e(t,e)||(t?.stageSequence||0)-(e?.stageSequence||0)||t?.roundNumber&&e.roundNumber&&t?.roundNumber-e?.roundNumber||(t?.roundPosition??0)-(e?.roundPosition??0)}function E0e(t,e){return(Vm[t?.stage]||0)-(Vm[e?.stage]||0)}function An(t){let{participants:e,participantMap:i,contextContent:r}=t,{scheduleVisibilityFilters:n,tournamentAppliedPolicies:a,participantsProfile:s,afterRecoveryTimes:o,policyDefinitions:l,useParticipantMap:u,tournamentRecord:c,matchUpFilters:d,contextFilters:p,contextProfile:f,drawDefinition:m,nextMatchUps:h,inContext:g,context:I,event:v}=t,{eventId:w,eventName:y,endDate:b,eventType:S,category:U,gender:T,matchUpFormat:P}=v??{},D={...I,surfaceCategory:v?.surfaceCategory??c?.surfaceCategory,indoorOutDoor:v?.indoorOutdoor??c?.indoorOutdoor,matchUpFormat:P,eventType:S,eventName:y,category:U,eventId:w,endDate:b,gender:T},E;return!e?.length&&!i&&c&&({participants:e=[],participantMap:i,groupInfo:E}=bf({participantsProfile:s,useParticipantMap:u,tournamentRecord:c,contextProfile:f,inContext:g})),f&&!r&&(r=Hc({policyDefinitions:l,tournamentRecord:c,contextProfile:f,drawDefinition:m,event:v})),{...Zi({context:D,tournamentAppliedPolicies:a,scheduleVisibilityFilters:n,tournamentParticipants:e,participantsProfile:s,afterRecoveryTimes:o,policyDefinitions:l,tournamentRecord:c,drawDefinition:m,contextContent:r,contextFilters:p,contextProfile:f,matchUpFilters:d,participantMap:i,nextMatchUps:h,inContext:g,event:v}),groupInfo:E}}function bp({element:t,accessor:e}){if(typeof e!="string")return{values:[]};let i=Oe(t),r=e.split("."),n=[],a;o({targetElement:i,attributes:r});let s={value:a};return n.length&&(s.values=n),s;function o({targetElement:l,attributes:u=[],significantCharacters:c}){for(let[p,f]of u.entries())if(l?.[f]){let m=u.slice(p+1);m.length?Array.isArray(l[f])?l[f].forEach(h=>o({targetElement:h,attributes:m})):(l=l[f],d({targetElement:l,index:p})):(a||(a=l[f]),n.includes(l[f])||n.push(l[f]))}function d({targetElement:p,index:f}){if(p&&f===u.length-1&&["string","number"].includes(typeof p)){let m=c?p.slice(0,c):p;a?n.includes(m)||n.push(m):(a=m,n.push(m))}}}}var sae=t=>e=>!t||typeof e!="object"?void 0:Array.isArray(t)&&t.map(i=>({[i]:bp({element:e,accessor:i})?.value}))||typeof t=="object"&&Object.keys(t).map(i=>({[i]:bp({element:e,accessor:i})?.value}))||(typeof t=="string"&&bp({element:e,accessor:t}))?.value,Pa=sae;function MU({finishingPositionOffset:t=0,finishingPositionLimit:e,positionsFed:i,roundsCount:r,roundLimit:n,matchUps:a,lucky:s,fmlc:o}){if(!Ka(a))return[];let{roundProfile:l,roundNumbers:u=[]}=Sn({interpolate:!0,matchUps:a});r=r??Math.max(...u,0);let c=n?r-n:0,d=c&&l?.[r-c]?.matchUpsCount,p=l&&Object.values(l).map(Pa("matchUpsCount")),f=(g,I)=>{let v=Math.min(...g);d&&I&&v===1&&(v=d);let w=Math.max(...g);return e&&w>e&&(w=e),[v,w]},m=l&&Object.assign({},...u.map(g=>{let I=(r??0)+1-g-c,v=l[g].matchUpsCount,w={finishingPositionRange:{},finishingRound:I},y=p?.slice(g-1).reduce((R,C)=>R+(C||0),0),b=o&&g!==1,S=1+t+(b?i??0:0),U=1,T=Ce(S,s?S+v*2:y+S+U),P=y+U-v,D=f(T.slice(P)),E=f(T.slice(0,P),!0);return w.finishingPositionRange={loser:D,winner:E},{[g]:w}})),h=la({finishingRound:!0});return a.filter(Boolean).forEach(g=>{let I=g.roundNumber&&m[g.roundNumber];h&&!I&&console.log({roundFinishingData:m,matchUp:g}),g.finishingRound=I?.finishingRound,g.finishingPositionRange=I?.finishingPositionRange}),a}function zp({inContextDrawMatchUps:t,drawDefinition:e,matchUpsMap:i}){if(!e)return{error:$e};let r={loserMatchUpIds:{},winnerMatchUpIds:{}};if(t||({matchUps:t,matchUpsMap:i}=Zi({inContext:!0,drawDefinition:e,matchUpsMap:i})),!i?.drawMatchUps.some(n=>n.finishingPositionRange)&&e?.structures?.length===1&&!e?.structures[0].structures){let n=i?.drawMatchUps??[];MU({matchUps:n})}return(t??[]).filter(({collectionId:n})=>!n).forEach(n=>{let{matchUpId:a,structureId:s}=n,o=Fn({inContextDrawMatchUps:t,drawDefinition:e,matchUpId:a}),{winnerMatchUp:l,loserMatchUp:u}=o.targetMatchUps,c=l?.matchUpId,d=u?.matchUpId,p=Pd({matchUpsMap:i,structureId:s}).find(f=>f.matchUpId===a);if(p&&(c&&(r.winnerMatchUpIds[p.matchUpId]=c,Object.assign(p,{winnerMatchUpId:c}),Object.assign(n,{winnerMatchUpId:c})),d&&(r.loserMatchUpIds[p.matchUpId]=d,n.loserMatchUpId=d,p.loserMatchUpId=d,n.finishingPositionRange))){let f=u.finishingPositionRange&&[...n.finishingPositionRange.loser,...u.finishingPositionRange.loser],m=f&&[Math.min(...f),Math.max(...f)];n.finishingPositionRange.loser=m,p.finishingPositionRange.loser=m}}),{inContextDrawMatchUps:t,goesToMap:r}}function co(t){let e=ws(t),i=t.matchUps??[],r=t.drawIds??[],{includeParticipantDependencies:n,tournamentRecord:a,drawDefinition:s}=t;if(!Array.isArray(i))return{error:Nu};if(!Array.isArray(r))return{error:xo};let o=t.matchUpIds?.length?t.matchUpIds:i.map(v=>v.matchUpId);if(!Array.isArray(o))return{error:Nh};let l={},u={},c={},d={};a&&!Object.keys(e).length&&(e={[a.tournamentId]:a});let p=Object.values(e),f=p.reduce((v,w)=>v.concat(w.events??[]).map(y=>(y.drawDefinitions||[]).map(b=>b.links||[])).flat(1/0),[]).filter(({linkType:v})=>v===fu),m=i;if(f.length){m=No({nextMatchUps:!0,tournamentRecords:e}).matchUps;let v=f.reduce((w,y)=>{let b=y.source?.structureId,S=y.target?.structureId;return b&&S&&(c[S]=b),b&&!w.includes(b)&&w.push(b),w},[]);for(let w of v)l[w]=[];for(let w of m??[]){let y=w.containerStructureId||w.structureId;v.includes(y)&&l[y].push(w.matchUpId)}}let h=v=>{u[v]||(u[v]={dependentMatchUpIds:[],participantIds:[],matchUpIds:[],sources:[]},d[v]=[])},g=(v,w)=>{u[v].matchUpIds.forEach(y=>{u[w].matchUpIds.push(y)}),u[w].matchUpIds.push(v),u[v].dependentMatchUpIds.push(w),n&&u[v].participantIds.forEach(y=>u[w].participantIds.push(y))},I=v=>{let w=Object.keys(l).length;for(let y of v||[]){let{matchUpId:b,winnerMatchUpId:S,loserMatchUpId:U}=y;if(!o.length||o.includes(b)){if(h(b),n){let{individualParticipantIds:D}=WM(y);u[b].participantIds=D}S&&(h(S),g(b,S),d[S].push(b)),U&&(h(U),g(b,U),d[U].push(b)),u[b].sources.push(d[b]);let T=d[b].map(D=>u[D].sources[0]).flat(),P=d[b].map(D=>u[D].sources[1]).flat();if(u[b].sources.push(T,P),w){let D=y.containerStructureId||y.structureId,E=c[D];if(l[E])for(let R of l[E])h(R),g(R,b),d[R].push(b)}}}};if(s)zp({drawDefinition:s}),m?.length||(m=An({drawDefinition:s}).matchUps),I(m);else{if(m?.length||(m=No({nextMatchUps:!0,tournamentRecords:e}).matchUps),!r.length){let v=p?.length?p.map(({events:w=[]})=>w.map(({drawDefinitions:y=[]})=>y.map(({drawId:b})=>b))).flat(1/0):[];v&&(r=v)}for(let v of r){let w=m?.filter(y=>y.drawId===v).sort(zh);if(!w?.find(({roundPosition:y})=>!y)){let y=w?.find(({tournamentId:S})=>S),{drawDefinition:b}=Wn({tournamentRecord:e[y?.tournamentId],drawId:v});b&&zp({drawDefinition:b})}I(w)}}return{positionDependencies:l,matchUpDependencies:u,sourceMatchUpIds:d,matchUps:m,...W}}function fr(t){let e=t?.matchUp,i=t?.score||e?.score,r=i?.sets?.[0],{side1Score:n,side2Score:a,side1TiebreakScore:s,side2TiebreakScore:o,side1PointScore:l,side2PointScore:u}=r||{},c=n||a||s||o||l||u;return!!(i?.sets?.length>1||c)}function NU({matchUpStatus:t}){return hne.includes(t)}function R0e({matchUpStatus:t}){return ZB.includes(t)}function Rx({matchUpStatus:t}){return gne.includes(t)}function C2({matchUpStatus:t,winningSide:e,tieMatchUps:i,sides:r,score:n}){let a=r?.find(({participantId:o})=>o),s=i?.filter(C2)?.length;return fr({score:n})||s||e&&a||t&&R0e({matchUpStatus:t})&&![qt,ai,lo].includes(t)}function Wv(t){let{drawDefinition:e,findContainer:i,structureId:r,event:n}=t,a=t.structure,{containedStructures:s}=jv({drawDefinition:e}),o=r?s[r]||[]:[],l={isCollectionMatchUp:!1};if(!a){let U=tt({drawDefinition:e,structureId:r});if(U.error)return U;a=i?U.containingStructure??U.structure:U.structure}if(Hn({structure:a}))return{structure:a,isAdHoc:!0,error:Mh};let{matchUps:u}=Zi({inContext:!0,matchUpFilters:l,drawDefinition:e,event:n}),c=u?.filter(U=>U.structureId===r||o.includes(U.structureId)),{matchUpDependencies:d}=co({drawIds:[e.drawId],matchUps:u,drawDefinition:e}),p=[],f=[],m={},h=[];for(let U of u??[]){if(U.structureId===r||o.includes(U.structureId)){f.push(...U.drawPositions??[]);let T=U.roundNumber;for(let P of(U.drawPositions??[]).filter(Boolean))(!m[P]||T&&m[P]>T)&&(m[P]=T)}C2(U)&&(h.push(U),p.push(U.matchUpId,...d?.[U?.matchUpId]?.matchUpIds||[]))}let g=nt(f.filter(Boolean)).sort(nr),I=nt(p),v=nt(c?.map(({matchUpId:U,drawPositions:T})=>I.includes(U)?T:[]).flat().filter(Boolean)).sort(nr),{positionAssignments:w}=Kt({drawDefinition:e,structure:a}),y=w?.filter(U=>U.bye).map(U=>U.drawPosition),b=w?.filter(U=>U.qualifier).map(U=>U.drawPosition),S=g?.filter(U=>!v.includes(U))||[];return{allDrawPositions:g,inContextStructureMatchUps:c,drawPositionInitialRounds:m,activeDependentMatchUpIds:I,qualifyingDrawPositions:b,inactiveDrawPositions:S,positionAssignments:w,activeDrawPositions:v,byeDrawPositions:y,activeMatchUps:h,structure:a}}function Wm({drawPosition:t,matchUps:e=[]}){return{initialRoundNumber:e.filter(({drawPositions:i})=>t&&i?.includes(t)).map(({roundNumber:i})=>i).sort(nr)[0]}}var Kc={reset:"\x1B[0m",bright:"\x1B[1m",dim:"\x1B[2m",red:"\x1B[31m",brightred:"\x1B[91m",green:"\x1B[32m",brightgreen:"\x1B[92m",yellow:"\x1B[33m",brightyellow:"\x1B[93m",blue:"\x1B[34m",brightblue:"\x1B[94m",lightblue:"\x1B[105m",magenta:"\x1B[35m",brightmagenta:"\x1B[95m",cyan:"\x1B[36m",brightcyan:"\x1B[96m",white:"\x1B[37m",brightwhite:"\x1B[97m"},M2=[];function Ht(t,e){ni(t)&&(t={method:t}),(e||la())&&M2.push(t)}function C0e(t){return M2.slice()}function M0e(t){let e=C0e().map(i=>{let{color:r,keyColors:n,method:a,newline:s}=i,o=Object.keys(Kc).includes(r)?Kc[r]:Kc.cyan,l=Object.keys(i).filter(c=>!["color","keyColors","method","newline"].includes(c)).map(c=>{let d=n&&Object.keys(n).includes(c)&&Kc[n[c]]?Kc[n[c]]:Kc.brightwhite;return`${Kc.white}${c}: ${d}${i[c]}`}).join(", "),u=a?.length<15?"		":"	";return[s?`
`:"",o,a,u,Kc.white,l,Kc.reset,`
`].join("")});e?.length&&console.log(...e)}function N0e(){M2.length=0}function N2(t){let e=t.bye,i=t.qualifier,r=t.participantId;return{containsBye:e,containsQualifier:i,containsParticipant:r,filled:e||i||r}}function Lr(t){return[qt,ai,Sr].includes(t)}function Ja({provisionalPositioning:t,isPositionAction:e,tournamentRecord:i,drawDefinition:r,drawPosition:n,loserMatchUp:a,matchUpsMap:s,structureId:o,structure:l,event:u}){if(!r)return{error:$e};if(l||({structure:l}=tt({drawDefinition:r,structureId:o})),!l)return{error:vi};o||({structureId:o}=l);let c="assignDrawPositionBye";Ht({method:c,color:"cyan",drawPosition:n}),s??=Or({drawDefinition:r});let{positionAssignments:d}=Kt({structure:l}),{activeDrawPositions:p}=Wv({drawDefinition:r,structureId:o});if(d?.find(E=>E.drawPosition===n)?.bye)return{...W};let f=!!(a&&s.drawMatchUps.some(E=>E.loserMatchUpId===a?.matchUpId&&Lr(E.matchUpStatus)));if(p?.includes(n)&&!f)return{error:JS};let m=d?.find(E=>E.drawPosition===n);if(!m)return{error:Mh};let{filled:h,containsBye:g,containsParticipant:I}=N2(m);if(g)return{...W};if(h&&!g&&!f)return q({result:{error:bI},stack:c});let v=Dt({tournamentRecord:i,drawDefinition:r,event:u}).appliedPolicies??{},w=Zi({inContext:!0,drawDefinition:r,matchUpsMap:s}).matchUps??[],y={isCollectionMatchUp:!1},{matchUps:b}=At({provisionalPositioning:t,drawDefinition:r,matchUpFilters:y,matchUpsMap:s,structure:l});if(d?.forEach(E=>{E.drawPosition===n&&(E.bye=!0,f&&(E.participantId=void 0))}),l.structureType===gn)return A0e({tournamentRecord:i,drawDefinition:r,drawPosition:n,matchUps:b}),Pc({tournamentId:i?.tournamentId,drawDefinition:r,structure:l,event:u}),tq({assignedParticipantId:I,isPositionAction:e,appliedPolicies:v,drawDefinition:r,drawPosition:n,structureId:o,stack:c});let{roundProfile:S,roundMatchUps:U}=Sn({matchUps:b}),T=(S&&Object.keys(S).map(E=>Number.parseInt(E)).reverse())?.find(E=>S?.[E].drawPositions?.includes(n)),P=T?U?.[T].find(({drawPositions:E})=>E?.includes(n)):void 0;P&&oae({tournamentRecord:i,drawDefinition:r,matchUp:P,event:u});let D=P?.drawPositions?.find(E=>E!==n);if(P&&D){let E=A2({sourceDrawPositions:P.drawPositions,matchUpId:P.matchUpId,inContextDrawMatchUps:w,drawPositionToAdvance:D,tournamentRecord:i,drawDefinition:r,matchUpsMap:s});if(E.error)return E}return Pc({tournamentId:i?.tournamentId,drawDefinition:r,structure:l,event:u}),tq({assignedParticipantId:I,isPositionAction:e,appliedPolicies:v,drawDefinition:r,drawPosition:n,structureId:o,stack:c})}function tq({assignedParticipantId:t,isPositionAction:e,appliedPolicies:i,drawDefinition:r,drawPosition:n,structureId:a,stack:s}){return e&&gU({appliedPolicies:i,drawDefinition:r,positionAction:{removedParticipantId:t,drawPosition:n,structureId:a,name:s}}),q({result:{...W},stack:s})}function oae({tournamentRecord:t,drawDefinition:e,eventId:i,matchUp:r,event:n}){Object.assign(r,{matchUpStatus:"BYE",score:void 0,winningSide:void 0}),Ut({tournamentId:t?.tournamentId,eventId:i??n?.eventId,context:"setMatchUpStatusBye",drawDefinition:e,matchUp:r})}function A0e({tournamentRecord:t,drawDefinition:e,drawPosition:i,matchUps:r,event:n}){r.forEach(a=>{a.drawPositions?.includes(i)&&oae({eventId:n?.eventId,tournamentRecord:t,drawDefinition:e,matchUp:a})})}function A2({drawPositionToAdvance:t,inContextDrawMatchUps:e,sourceDrawPositions:i,tournamentRecord:r,drawDefinition:n,matchUpsMap:a,matchUpId:s,event:o}){Ht({method:"advanceDrawPosition",color:"cyan",drawPositionToAdvance:t});let l=a.drawMatchUps.find(w=>w.matchUpId===s),u=e.find(w=>w.matchUpId===s)?.structureId,{structure:c}=tt({drawDefinition:n,structureId:u}),{positionAssignments:d}=Kt({structure:c}),p=d?.filter(w=>w.bye).map(w=>w.drawPosition),f=l?.drawPositions?.find(w=>w!==t),m=f&&p?.includes(f),{targetLinks:{loserTargetLink:h},targetMatchUps:{loserMatchUp:g,winnerMatchUp:I,loserTargetDrawPosition:v}}=Fn({inContextDrawMatchUps:e,drawDefinition:n,matchUpId:s});if(I&&I.structureId===c?.structureId&&k0e({drawPositionToAdvance:t,inContextDrawMatchUps:e,sourceDrawPositions:i,tournamentRecord:r,drawDefinition:n,winnerMatchUp:I,matchUpsMap:a,event:o}),g&&m&&g.structureId!==c?.structureId){let{roundNumber:w}=g;if(w===1){let y=Ja({structureId:h.target.structureId,drawPosition:v,tournamentRecord:r,drawDefinition:n,event:o});if(y.error)return y}else lae({loserTargetDrawPosition:v,tournamentRecord:r,loserTargetLink:h,drawDefinition:n,loserMatchUp:g,matchUpsMap:a,event:o})}return{...W}}function k0e({drawPositionToAdvance:t,inContextDrawMatchUps:e,sourceDrawPositions:i,tournamentRecord:r,drawDefinition:n,winnerMatchUp:a,matchUpsMap:s,event:o}){let l="advanceWinner",u=s.drawMatchUps.find(M=>M.matchUpId===a.matchUpId),c=e.find(M=>M.matchUpId===a.matchUpId)?.structureId,{structure:d}=tt({drawDefinition:n,structureId:c}),{positionAssignments:p}=Kt({structure:d}),f=p?.find(({drawPosition:M})=>M===t)?.bye,m=u.drawPositions?.filter(Boolean),h=p?.filter(M=>m?.includes(M.drawPosition)),g=p?.find(({drawPosition:M})=>M===t),I=i?.find(M=>M!==t),v=(I&&h?.find(({drawPosition:M})=>M===I))?.bye,w=f&&v;if(w&&console.log({isByeAdvancedBye:w}),m?.length>1&&f&&!v)return q({result:{error:bI},stack:l});let y=m?.find(M=>M!==t),b=w,S=[...(u.drawPositions||[]).filter(Boolean),void 0,void 0].slice(0,2),U=S.map(M=>!M&&!b||M===t?(b=!0,t):M).sort(nr);if(!b)return console.log("@@@@@@@",{advancingAssignmentIsBye:g,drawPositionToAdvance:t,existingAssignments:h}),q({result:{error:bI},stack:l});let T=p?.find(({drawPosition:M})=>M===y)?.bye,P=p?.find(({drawPosition:M})=>M===t)?.bye;Object.assign(u,{matchUpStatus:P||T?"BYE":_i,score:void 0,winningSide:void 0,drawPositions:U});let D=u.drawPositions.find(M=>!S.includes(M));Ht({method:l,color:"brightyellow",changedDrawPosition:D,pairedDrawPositionIsBye:T,drawPositionIsBye:P}),Ut({tournamentId:r?.tournamentId,matchUp:u,eventId:o?.eventId,context:l,drawDefinition:n});let{targetLinks:{loserTargetLink:E},targetMatchUps:{loserMatchUp:R,loserTargetDrawPosition:C}}=Fn({matchUpId:a.matchUpId,inContextDrawMatchUps:e,drawDefinition:n});if(T||P){let M=T?t:y;if(M)A2({drawPositionToAdvance:M,matchUpId:a.matchUpId,inContextDrawMatchUps:e,tournamentRecord:r,drawDefinition:n,matchUpsMap:s});else if(P&&E&&R)if(R.feedRound)lae({loserTargetDrawPosition:C,tournamentRecord:r,loserTargetLink:E,drawDefinition:n,loserMatchUp:R,matchUpsMap:s});else{let N=1-a.roundPosition%2,A=R.drawPositions[N],O=Ja({structureId:E.target.structureId,drawPosition:A,tournamentRecord:r,drawDefinition:n,event:o});if(O.error)return O}}}function lae({loserTargetDrawPosition:t,tournamentRecord:e,loserTargetLink:i,drawDefinition:r,loserMatchUp:n,matchUpsMap:a,event:s}){let{roundNumber:o}=n;Ht({method:"assignFedDrawPositionBye",color:"cyan",loserTargetDrawPosition:t});let l=(a?.mappedMatchUps||{})[n.structureId].matchUps,{initialRoundNumber:u}=Wm({drawPosition:t,matchUps:l});if(u===o){let c=Ja({structureId:i.target.structureId,drawPosition:t,tournamentRecord:e,drawDefinition:r,event:s});if(c.error)return c}}function uae({positionAssignments:t,tournamentRecord:e,drawDefinition:i,matchUpsMap:r,structure:n,event:a}){let{matchUps:s}=At({drawDefinition:i,matchUpsMap:r,structure:n,event:a});s.forEach(o=>{let l=t.filter(({drawPosition:u})=>o.drawPositions?.includes(u)).filter(u=>u.bye).length;o.winningSide||(Object.assign(o,{matchUpStatus:l?"BYE":_i}),Ut({tournamentId:e?.tournamentId,context:"modifyRoundRobinMatchUpsStatus",eventId:a?.eventId,drawDefinition:i,matchUp:o}))})}function AU(t){let{inContextDrawMatchUps:e,participantId:i,drawPosition:r}=t,{tournamentRecord:n,drawDefinition:a,structureId:s,matchUpsMap:o,event:l}=t,{structure:u}=tt({drawDefinition:a,structureId:s}),c=(pr({drawDefinition:a,structure:u}).positionAssignments||[]).find(p=>i&&p.participantId===i||r&&p.drawPosition===r);if(c&&i&&!r&&(r=c?.drawPosition),!r)return{error:Mv};i||(i=c?.participantId);let{activeDrawPositions:d}=Wv({drawDefinition:a,structureId:s});return d.includes(r)?{error:JS}:(e||({matchUps:e}=Zi({inContext:!0,drawDefinition:a,matchUpsMap:o})),Cx({inContextDrawMatchUps:e,tournamentRecord:n,drawDefinition:a,structureId:s,drawPosition:r,matchUpsMap:o,event:l}).drawPositionCleared?(Pc({tournamentId:n?.tournamentId,drawDefinition:a,structure:u,event:l}),{...W,participantId:i}):{error:wte})}function Cx({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,matchUpsMap:n,structureId:a,event:s}){let{structure:o}=tt({drawDefinition:i,structureId:a});if(!o)return{error:vi};let l=pr({drawDefinition:i,structure:o}).positionAssignments||[],u=l.some(I=>{if(I.drawPosition===r)return delete I.participantId,delete I.qualifier,delete I.bye,!0});if(o.structureType===gn)return uae({positionAssignments:l,tournamentRecord:e,drawDefinition:i,matchUpsMap:n,structure:o}),{drawPositionCleared:u,...W};let c={isCollectionMatchUp:!1},{matchUps:d}=At({drawDefinition:i,matchUpFilters:c,matchUpsMap:n,structure:o,event:s}),{roundProfile:p,roundMatchUps:f}=Sn({matchUps:d}),m=(p&&Object.keys(p))?.map(I=>Ke(I)),h=r,g=m?.map(I=>{let v=p?.[I]?.pairedDrawPositions?.find(D=>D.includes(h)),w=v?.find(D=>D!==h),y=l.find(D=>D.drawPosition===w),b=p?.[I+1],S=y?.bye,U=b?.pairedDrawPositions?.find(D=>D.includes(w)),T=S&&U&&b&&b.drawPositions?.includes(w),P=v&&{pairedDrawPositionByeAdvancedPair:!T&&U,pairedDrawPosition:w,targetDrawPosition:h,relevantPair:v,roundNumber:I};return T&&(h=w),P}).filter(I=>I?.targetDrawPosition)?.reduce((I,v)=>{let{roundNumber:w,relevantPair:y,targetDrawPosition:b,pairedDrawPosition:S,pairedDrawPositionByeAdvancedPair:U}=v,T={roundNumber:w,targetDrawPosition:b,relevantPair:y},P=U&&{roundNumber:w+1,targetDrawPosition:S,relevantPair:U,subsequentRoundRemoval:!0},D=[T,P].filter(Boolean);return I.concat(...D)},[]);return g?.forEach(({roundNumber:I,targetDrawPosition:v,relevantPair:w})=>{let y=f?.[I].find(b=>xn(b.drawPositions?.filter(Boolean),w.filter(Boolean)));y&&(O0e({inContextDrawMatchUps:t,targetDrawPosition:v,tournamentRecord:e,drawDefinition:i,structureId:a,roundNumber:I,matchUpsMap:n}),cae({inContextDrawMatchUps:t,positionAssignments:l,tournamentRecord:e,drawDefinition:i,targetMatchUp:y,drawPosition:r,matchUpsMap:n,structure:o,event:s}))}),{tasks:g,drawPositionCleared:u,positionAssignments:l}}function O0e({inContextDrawMatchUps:t,targetDrawPosition:e,tournamentRecord:i,drawDefinition:r,matchUpsMap:n,roundNumber:a,structureId:s}){let{structure:o}=tt({drawDefinition:r,structureId:s});if(!o)return{error:vi};if(o.structureType===gn)return;n=n||Or({drawDefinition:r});let l=(n?.mappedMatchUps||{})[s].matchUps,{initialRoundNumber:u}=Wm({drawPosition:e,matchUps:l}),c=l?.filter(p=>p.roundNumber>=a&&p.roundNumber!==u&&p.drawPositions?.includes(e)),d=Kt({drawDefinition:r,structureId:s}).positionAssignments??[];return c?.forEach(p=>cae({drawPosition:e,targetMatchUp:p,inContextDrawMatchUps:t,positionAssignments:d,tournamentRecord:i,drawDefinition:r,matchUpsMap:n,structure:o})),{...W}}function cae({inContextDrawMatchUps:t,positionAssignments:e,tournamentRecord:i,drawDefinition:r,targetMatchUp:n,drawPosition:a,matchUpsMap:s,structure:o,event:l}){let u="removeDrawPosition",c=n.drawPositions?.slice(),d=n.matchUpStatus,p=n.winningSide;s=s??Or({drawDefinition:r});let f=s.mappedMatchUps[o.structureId].matchUps,{initialRoundNumber:m}=Wm({drawPosition:a,matchUps:f});if(n.roundNumber&&m&&n.roundNumber>m){let U=(n.drawPositions??[]).map(T=>T===a?void 0:T);n.drawPositions=U}if(n.matchUpType===ei){let U=(t?.find(T=>T.matchUpId===n.matchUpId)?.sides??[]).reduce((T,P,D)=>P.drawPosition===a?D:T,void 0);U!==void 0&&n.sides?.[U]?.lineUp&&(delete n.sides?.[U].lineUp,Ut({tournamentId:i?.tournamentId,context:`${u}-TEAM`,eventId:l?.eventId,matchUp:n,drawDefinition:r}))}let h=Fn({matchUpId:n.matchUpId,inContextDrawMatchUps:t,drawDefinition:r}),{targetLinks:{winnerTargetLink:g},targetMatchUps:{loserMatchUp:I,winnerMatchUp:v,loserMatchUpDrawPositionIndex:w}}=h,y=e.filter(({drawPosition:U})=>n.drawPositions?.includes(U)).filter(U=>U.bye).length,b=y&&"BYE"||n.matchUpStatus&&Lr(n.matchUpStatus)&&n.matcHUpStatus||_i;n.matchUpStatus=b,n.matchUpStatus&&Lr(n.matchUpStatus)&&(n.winningSide=void 0);let S=c?.find(U=>!n.drawPositions?.includes(U));if(c?.includes(a)&&d===n.matchUpStatus&&p===n.winningSide||(S&&Ht({method:u,color:"brightyellow",removedDrawPosition:S}),Ut({tournamentId:i?.tournamentId,context:`${u}-${a}`,eventId:l?.eventId,matchUp:n,drawDefinition:r})),I&&I.structureId!==h.matchUp.structureId&&!y){let{drawPositions:U,roundNumber:T}=I;if(T===1){let P=U[w];Cx({structureId:I.structureId,drawPosition:P,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:r,matchUpsMap:s})}else{let P=Math.min(...U.filter(Boolean)),D=x0e({loserMatchUpDrawPosition:P,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:r,loserMatchUp:I,matchUpsMap:s,event:l});if(D.error)return q({result:D,stack:u});let E=(s?.mappedMatchUps||{})[I.structureId].matchUps,{initialRoundNumber:R}=Wm({drawPosition:P,matchUps:E});R===1&&(Ht({method:u,color:"brightyellow",loserMatchUpDrawPosition:P}),Cx({structureId:I.structureId,drawPosition:P,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:r,matchUpsMap:s}))}}return v&&v.structureId!==h.matchUp.structureId&&g.target.feedProfile,{...W}}function x0e({loserMatchUpDrawPosition:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:r,loserMatchUp:n,matchUpsMap:a,event:s}){let{structure:o}=tt({structureId:n.structureId,drawDefinition:r}),{positionAssignments:l}=Kt({structure:o});if(l?.find(u=>u.drawPosition===t)?.bye){let u=AU({drawPosition:t,structureId:n.structureId,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:r,matchUpsMap:a,event:s});if(u.error)return u}return{...W}}function Pf({drawDefinition:t,stages:e}){if(!t)return{error:$e};let i=(t?.structures??[]).filter(n=>!e?.length||n.stage&&e.includes(n.stage)),r=nt(i.map(n=>{let{positionAssignments:a}=Kt({structure:n});return a?a.map(yt):[]}).flat().filter(Boolean));return{...W,assignedParticipantIds:r}}function wo(t){let e=(t?.entries??[]).filter(Boolean).reduce((r,n)=>{let{entryStage:a,entryStatus:s}=n,o=`_${a||Ae}${s||""}`;return r[o]||(r[o]=[]),r[o].push(n),r},{}),i=r=>isNaN(r)?1/0:r;return Object.keys(e).map(r=>e[r].sort((n,a)=>i(n.entryPosition)-i(a.entryPosition)).map((n,a)=>{let s=a+1;return{...n,entryPosition:s}})).flat()}function pp(t){return[Sf,Us].includes(t)}function JP({autoEntryPositions:t=!0,ignoreAssignment:e,tournamentRecord:i,drawDefinition:r,participantIds:n,entryStatus:a,entryStage:s,extension:o,eventSync:l,drawId:u,stage:c,event:d}){if(!n||!Array.isArray(n))return{error:Co,method:"modifyEntriesStatus",participantIds:n};if(!r&&!d)return{error:ui};if(a&&!xne.includes(a))return{error:cx};if(s&&!PM.includes(s))return{error:gf};let p="modifyEntriesStatus",f=[];if(!a&&!o)return q({result:{error:Je},info:"Missing entryStatus",stack:p});if(o&&!ml({extension:o,requiredAttributes:["name"]}))return q({result:{error:re},info:"Invalid extension",context:{extension:o},stack:p});let m=[];d?.drawDefinitions?.forEach(P=>{let D=Pf({stages:c&&[c],drawDefinition:P}).assignedParticipantIds??[];m.push(...D)});let h=i?.participants??[];if(!n.every(P=>{let D=Ud({tournamentParticipants:h,participantId:P})?.participantType;return!(D&&[ft,$n].includes(D)&&pp(a))&&!(a&&d?.eventType&&D===It&&[fs,Ua].includes(d.eventType)&&[Gs,...hD].includes(a))}))return{error:cx};let g=d&&Bi({event:d}).flightProfile,I=g?.flights?.find(P=>P.drawId===u),v=P=>{let D=(P||[]).filter(R=>!c||!R.entryStage||c===R.entryStage).filter(({participantId:R})=>n.includes(R)),E=R=>a&&m.includes(R.participantId)&&!(hD.includes(R.entryStatus)&&hD.includes(a));return D.every(R=>E(R)&&!e?!1:(a&&(R.entryStatus=a,delete R.entryPosition),s&&(R.entryStage=s,delete R.entryPosition),o&&(o.value?Ft({element:R,extension:o}):Nn({element:R,name:o.name})),!0))?{...W}:{error:kv}},w=({flight:P,drawDefinition:D})=>{d&&(d.entries=wo({entries:d.entries??[]})),P&&(P.drawEntries=wo({entries:P.drawEntries})),D&&(D.entries=wo({entries:D.entries}))},y=P=>{let{flight:D,drawDefinition:E}=P,R="updateDrawEntries";if(D){let C=v(D.drawEntries);if(C.error)return q({result:C,stack:R})}if(E){let C=v(E.entries);if(C.error)return q({result:C,stack:R});f.includes(E.drawId)||f.push(E.drawId)}return{...W}},b=d?.entries?.find(({entryPosition:P})=>P)??(I?.drawEntries?.find(({entryPosition:P})=>P)||r?.entries?.find(({entryPosition:P})=>P));if(t&&!b&&w({flight:I,drawDefinition:r}),I||r){let P=y({flight:I,drawDefinition:r});if(P.error)return q({result:P,stack:p})}let S=d?.drawDefinitions?.map(({drawId:P})=>P)??[],U=g?.flights?.filter(P=>!S.includes(P.drawId))||[];for(let P of U){let D=P&&y({flight:P});if(D?.error)return q({result:D,stack:p})}let T=g?.flights?.length===1&&(d?.drawDefinitions?.length??0)<=g?.flights?.length;if(!I&&!r&&a&&One.includes(a))return{error:cie};if(!I&&!r||a===bu||l&&T){let P=v(d?.entries);if(P?.error)return q({result:P,stack:p});let D;if(a===bu&&(g?.flights?.every(E=>{let R=v(E.drawEntries);return R.error?(D=R.error,!1):(E.drawEntries=E.drawEntries.filter(({participantId:C})=>!n.includes(C)),!0)}),d?.drawDefinitions?.every(E=>{let R=v(E.entries);return R.error?(D=R.error,!1):(E.entries=E.entries?.filter(({participantId:C})=>!n.includes(C)),!0)})),D)return q({result:{error:D},stack:p})}t&&w({flight:I,drawDefinition:r});for(let P of d?.drawDefinitions??[])f.length&&!f.includes(P.drawId)||ii({tournamentId:i.tournamentId,eventId:d?.eventId,drawDefinition:P});return{...W}}function Og({value:t,sourceRange:e,targetRange:i}){if(!Array.isArray(e)||e.length!==2)return 0;let r=Math.min(...e),n=Math.max(...e),a=Math.min(...i),s=Math.max(...i);return(t-r)*(s-a)/(n-r)+a}var dae="NTRP",pae="DUPR",fae="UTR_P",mae="UTPR",hae="SQUASH_LEVELS",gae="US_SQUASH",Iae="USATT",vae="ITTF",yae="USAR",F0e={ELO:"ELO",NTRP:dae,TRN:"TRN",UTR:"UTR",WTN:"WTN",DUPR:pae,UTR_P:fae,UTPR:mae,PSA:"PSA",SQUASH_LEVELS:hae,US_SQUASH:gae,USATT:Iae,ITTF:vae,USAR:yae,BWF:"BWF"},L0e={ELO:{defaultInitialization:1500,decimalsCount:0,range:[0,3e3],ascending:!1},[dae]:{accessors:["ntrpRating","dntrpRatingHundredths"],attributes:{ustaRatingType:""},accessor:"dntrpRatingHundredths",defaultInitialization:3,decimalsCount:1,ascending:!1,range:[1,7]},UTR:{defaultInitialization:6,accessors:["utrRating"],accessor:"utrRating",decimalsCount:2,ascending:!1,range:[1,16]},WTN:{attributes:{confidence:{generator:!0,range:[60,100]}},accessors:["wtnRating","confidence"],defaultInitialization:23,accessor:"wtnRating",ascending:!0,decimalsCount:2,range:[40,1]},[pae]:{defaultInitialization:3.5,accessors:["duprRating","reliabilityScore"],accessor:"duprRating",attributes:{reliabilityScore:{generator:!0,range:[0,100]}},decimalsCount:3,ascending:!1,range:[2,8]},[fae]:{defaultInitialization:5,accessors:["utrpRating","verified"],accessor:"utrpRating",attributes:{verified:{type:"boolean"},provisional:{type:"string"}},decimalsCount:1,ascending:!1,range:[1,10]},[mae]:{defaultInitialization:3.5,accessor:"utprRating",decimalsCount:1,ascending:!1,range:[2,5],deprecated:!0},PSA:{defaultInitialization:500,accessor:"psaPoints",decimalsCount:0,ascending:!1,range:[0,3e3],attributes:{tournaments:{generator:!0,range:[1,20]},divisor:{generator:!0,range:[10,20]}}},[hae]:{defaultInitialization:2e3,accessor:"squashLevel",decimalsCount:0,ascending:!1,range:[0,7e3]},[gae]:{defaultInitialization:3.5,accessor:"usSquashRating",decimalsCount:1,ascending:!1,range:[2,6]},[Iae]:{defaultInitialization:1e3,accessor:"usattRating",decimalsCount:0,ascending:!1,range:[200,3e3]},[vae]:{defaultInitialization:500,accessor:"ittfPoints",decimalsCount:0,ascending:!1,range:[0,2e4]},[yae]:{defaultInitialization:1e4,accessor:"usarRanking",decimalsCount:0,ascending:!0,range:[1,25e3]},BWF:{defaultInitialization:5e3,accessor:"bwfPoints",decimalsCount:0,ascending:!0,range:[0,15e4],attributes:{tournaments:{generator:!0,range:[1,10]}}}},Pr=L0e;function _0e({sourceRatingType:t,sourceRating:e}){let i=Pr[t]?.range,r=i?.[0]>i?.[1],n=Pr.ELO.range;return Og({value:r?i[0]-e:e,sourceRange:i,targetRange:n})}function $0e({targetRatingType:t,sourceRating:e}){let i=Pr[t]?.decimalsCount||0,r=Pr[t]?.range,n=r?.[0]>r?.[1],a=Math.max(...r),s=Pr.ELO?.range,o=Og({targetRange:r,sourceRange:s,value:e}),l=Number.parseFloat(o?.toFixed(i))||0;return n?a-l:l}function iq(t){let e=He(t,[{ratings:!0,[qn]:Kn}]);if(e.error)return e;let i=t.matchUpType&&[zt,Bt].includes(t.matchUpType)?t.matchUpType:zt,r=Object.keys(Pr),n=t.targetRatingType&&r.includes(t.targetRatingType)?t.targetRatingType:"ELO",a=t.ratings[i]?t.ratings[i].reduce((p,f)=>p.includes(f.scaleName)?p:p.concat(f.scaleName),[]):[];if(!a)return{error:Br};let s=t.ratings[i]?.find(p=>p.scaleName===n)??t.ratings[i]?.[0];if(a[0]===n)return s;let o=s?.scaleName,l=Pr[s?.scaleName]?.accessor,u=l&&s.scaleValue[l]||s?.scaleValue,c=_0e({sourceRatingType:o,sourceRating:u}),d=$0e({targetRatingType:n,sourceRating:c});return d?{convertedRating:d,sourceRating:u}:{error:re}}function B0e({participantResults:t,sides:e,score:i}){let r=e?.find(({sideNumber:o})=>o===1),n=e?.find(({sideNumber:o})=>o===2),a=r?.participant?.ratings,s=n?.participant?.ratings;if(a?.[zt]&&s?.[zt]){let o="ELO",{convertedRating:l}=iq({ratings:a,targetRatingType:o}),{convertedRating:u}=iq({ratings:s,targetRatingType:o}),{side1pressure:c,side2pressure:d}=V0e({side1ConvertedRating:l,side2ConvertedRating:u,score:i});c&&t[r?.participantId].pressureScores.push(c),d&&t[n?.participantId].pressureScores.push(d);let p=Math.max(...Pr.ELO.range),f=AP((u-l)/p),m=AP((l-u)/p);t[r?.participantId].ratingVariation.push(f),t[n?.participantId].ratingVariation.push(m)}}function V0e({side1ConvertedRating:t,side2ConvertedRating:e,score:i}){let r=Math.max(t,e),n=Math.min(t,e),a=Math.abs(t-e),s=Pr.ELO.range,o=Math.max(...s),l=(o-r)*0,u=(r+l)/o*a,c=i?.sets?.reduce((v,w)=>v+(w?.side1Score??0),0),d=i?.sets?.reduce((v,w)=>v+(w.side2Score??0),0),p=t>e?2:1,f=(c||0)*(n+(p===1?u:0)),m=(d||0)*(n+(p===2?u:0)),h=f+m,g=h?AP(f/h):0,I=h?AP(m/h):0;return{side1pressure:g,side2pressure:I}}function k2({winningSide:t,matchUpFormat:e=Vs,matchUpStatus:i,tallyPolicy:r,score:n}){let a=[0,0],s=n?.sets,o=typeof t=="number"&&t-1,l=qi(e),u=O2(l?.bestOf??1);if(typeof o=="number"&&(i===qt&&r?.setsCreditForDefaults||i===ai&&r?.setsCreditForWalkovers))a[o]=u;else for(let c of s||[]){let{winningSide:d}=c;d&&(a[d-1]+=1)}return typeof o=="number"&&i===Sr&&(+a[1-o]===u&&(a[1-o]-=1),r?.setsCreditForRetirements&&(a[o]=u)),a}function bae({matchUpFormat:t=Vs,winningSide:e,matchUpStatus:i,tallyPolicy:r,score:n}){let{sets:a}=n||{};if(!a)return[0,0];let s=typeof e=="number"&&e-1,o=qi(t),l=o?.bestOf??1,u=O2(l),c=o?.setFormat?.tiebreakAt||0,d=[[],[]];if(typeof s=="number"&&(i===qt&&r?.gamesCreditForDefaults||i===ai&&r?.gamesCreditForWalkovers)){let p=o?.setFormat?.setTo||0,f=u*p;d[s].push(f)}else a.forEach((p,f)=>{let m=(p.setNumber||f+1)>u&&o?.finalSetFormat?"finalSetFormat":"setFormat",h=o?.[m]?.based,g=o?.[m].tiebreakSet,{side1Score:I,side2Score:v}=p;rq(h)&&!g&&(d[0].push(Ke(I||0)),d[1].push(Ke(v||0))),g&&p.winningSide&&r?.gamesCreditForTiebreakSets!==!1&&d[p.winningSide-1].push(1)});if(i===Sr&&typeof s=="number"){let p=a.length>u&&o?.finalSetFormat?"finalSetFormat":"setFormat",f=o?.[p];if(rq(f.based)){let m=f?.setTo||0,h=I=>{if(!(!o||I===""))return+I===c-1||+I===c?Ke(c||0)+1:+I<c?m:c},g=k2({winningSide:e,score:{sets:a},matchUpStatus:i,matchUpFormat:t,tallyPolicy:r});if(d.map(I=>I[s]<=I[1-s]).reduce((I,v)=>I+(v?1:0),0)>g[1-s]){let I=d[s].length,v=h(d[1-s][I-1]);v&&(d[s][I-1]=v)}u>d[s].length&&r?.gamesCreditForRetirements&&d[s].push(m)}}return[d[0].reduce((p,f)=>p+f,0),d[1].reduce((p,f)=>p+f,0)]}function wae({matchUpFormat:t,score:e}){let i=t?qi(t):void 0,r=i?.bestOf??1,n=O2(r),a=[0,0],s=[0,0];return e?.sets?.forEach((o,l)=>{let u=(o.setNumber||l+1)>n&&i?.finalSetFormat?"finalSetFormat":"setFormat",c=i?.[u]?.based;if(Sae(c)){let{side1Score:d,side2Score:p}=o;d&&(s[0]+=Ke(d||0)),p&&(s[1]+=Ke(p||0))}else o.side1TiebreakScore&&(s[0]+=Ke(o.side1TiebreakScore||0)),o.side2TiebreakScore&&(s[1]+=Ke(o.side2TiebreakScore||0)),(o.side1TiebreakScore||o.side2TiebreakScore)&&o.winningSide&&(a[o.winningSide-1]+=1)}),{pointsTally:s,tiebreaksTally:a}}function O2(t){return t&&Math.ceil(t/2)||1}function Sae(t){return t==="P"}function rq(t){return!Sae(t)}function j0e({participantResults:t,groupingTotal:e,matchUpFormat:i,tallyPolicy:r,totalGames:n,perPlayer:a,totalSets:s}){let o=i&&qi(i)||{},l=o.bestOf,u=l&&Math.ceil(l/2)||1,c=o.setFormat?.setTo,d=Math.pow(10,r?.precision||3);Object.keys(t).forEach(p=>{let f=t[p].setsWon,m=t[p].setsLost,h=r?.groupTotalSetsPlayed||e==="setsPct"?s:a*u||f+m,g=Math.round(f/h*d)/d;(g===1/0||Number.isNaN(g))&&(g=h);let I=t[p].tieMatchUpsWon,v=t[p].tieMatchUpsLost,w=I+v,y=Math.round(I/w*d)/d;(y===1/0||Number.isNaN(y))&&(y=I);let b=t[p].matchUpsWon,S=t[p].matchUpsLost,U=b+S,T=Math.round(b/U*d)/d;(T===1/0||Number.isNaN(T))&&(T=b);let P=t[p].gamesWon||0,D=t[p].gamesLost||0,E=(a||0)*u*(c||0),R=r?.groupTotalGamesPlayed||e==="gamesPct"?n:Math.max(E,P+D),C=Math.round(P/R*d)/d;(C===1/0||Number.isNaN(C))&&(C=0);let M=t[p].pointsWon+t[p].pointsLost,N=Math.round(t[p].pointsWon/M*d)/d;(N===1/0||Number.isNaN(N))&&(N=0),t[p].setsWon=f,t[p].setsLost=m,t[p].setsPct=g,t[p].tieMatchUpsWon=I,t[p].tieMatchUpsPct=y,t[p].matchUpsPct=T,t[p].gamesWon=P,t[p].gamesLost=D,t[p].gamesPct=C,t[p].pointsPct=N,t[p].result=`${t[p].matchUpsWon}/${t[p].matchUpsLost}`})}function kU({participantIds:t,pressureRating:e,groupingTotal:i,matchUpFormat:r,tallyPolicy:n,perPlayer:a,matchUps:s}){let o={},l=n?.excludeMatchUpStatuses||[],u=s?.filter(f=>(f.tieMatchUps||!l.includes(f.matchUpStatus))&&(!t?.length||Li(t,[xg(f,0),xg(f,1)]).length===2)),c=u?.flatMap(({score:f,tieMatchUps:m})=>m?m.filter(({matchUpStatus:h})=>!l.includes(h)).flatMap(({score:h})=>h?.sets?.length??0):f?.sets?.length??0)?.reduce((f,m)=>f+m,0),d=f=>f?.sets?.reduce((m,h)=>m+(h?.side1Score??0)+(h?.side2Score??0),0)??0,p=u?.flatMap(({score:f,tieMatchUps:m})=>m?m.filter(({matchUpStatus:h})=>!l.includes(h)).flatMap(({score:h})=>d(h)):d(f))?.reduce((f,m)=>f+m,0);for(let f of u??[]){let{matchUpStatus:m,tieMatchUps:h,tieFormat:g,score:I,winningSide:v,sides:w}=f,y=g&&f._disableAutoCalc&&g.collectionDefinitions.every(({scoreValue:U})=>U),b=v&&G0e(f),S=v&&H0e(f);if(!b&&!S)if(m&&Ki.includes(m)){let U=xg(f,0),T=xg(f,1);U&&(Qc(o,U),o[U].matchUpsCancelled+=1),T&&(Qc(o,T),o[T].matchUpsCancelled+=1)}else if(h?.length){a=0;for(let U of h){if(U.winningSide){let T=w?.find(({sideNumber:D})=>D===U.winningSide)?.participantId,P=w?.find(({sideNumber:D})=>D===U.winningSide)?.participantId;T&&P&&(Qc(o,T),Qc(o,P),o[T].tieMatchUpsWon+=1,o[P].tieMatchUpsLost+=1,Pi(zt)(U.matchUpType)?(o[T].tieSinglesWon+=1,o[P].tieSinglesLost+=1):Pi(Bt)(U.matchUpType)&&(o[T].tieDoublesWon+=1,o[P].tieDoublesLost+=1))}nq({score:U.score,manualGamesOverride:y,participantResults:o,sides:w})}}else nq({manualGamesOverride:y,participantResults:o,score:I,sides:w});else if(Qc(o,b),Qc(o,S),h?.length){a=0;for(let U of h){let{matchUpType:T}=U,P=Pi(Bt)(T),D=Pi(zt)(T);U.winningSide&&(U.winningSide===v?(b&&(o[b].tieMatchUpsWon+=1,D&&(o[b].tieSinglesWon+=1),P&&(o[b].tieDoublesWon+=1)),S&&(o[S].tieMatchUpsLost+=1,D&&(o[S].tieSinglesLost+=1),P&&(o[S].tieDoublesLost+=1))):U.winningSide!==v&&(S&&(o[S].tieMatchUpsWon+=1,D&&(o[S].tieSinglesWon+=1),P&&(o[S].tieDoublesWon+=1)),b&&(o[b].tieMatchUpsLost+=1,D&&(o[b].tieSinglesLost+=1),P&&(o[b].tieDoublesLost+=1)))),aq({matchUpFormat:U.matchUpFormat,matchUpStatus:U.matchUpStatus,matchUpType:U.matchUpType,score:U.score,sides:U.sides,winningParticipantId:b,losingParticipantId:S,manualGamesOverride:y,participantResults:o,isTieMatchUp:!0,pressureRating:e,tallyPolicy:n,winningSide:v})}Uae({winningParticipantId:b,losingParticipantId:S,participantResults:o,matchUpStatus:m})}else aq({matchUpFormat:f.matchUpFormat??r,matchUpType:f.matchUpType,isTieMatchUp:void 0,winningParticipantId:b,manualGamesOverride:y,losingParticipantId:S,participantResults:o,pressureRating:e,matchUpStatus:m,tallyPolicy:n,winningSide:v,score:I,sides:w});if(y){let U=I?.sets?.reduce((E,R)=>E+(R?.side1Score??0),0),T=I?.sets?.reduce((E,R)=>E+(R.side2Score??0),0),P=w?.find(({sideNumber:E})=>E===1)?.participantId,D=w?.find(({sideNumber:E})=>E===2)?.participantId;Qc(o,P),Qc(o,D),P&&(o[P].gamesWon+=U,o[P].gamesLost+=T),D&&(o[D].gamesWon+=T,o[D].gamesLost+=U)}}return j0e({participantResults:o,groupingTotal:i,matchUpFormat:r,tallyPolicy:n,totalGames:p,perPlayer:a,totalSets:c}),{participantResults:o}}function G0e(t){let e=t.winningSide-1;return xg(t,e)}function H0e(t){let e=1-(t.winningSide-1);return xg(t,e)}function xg(t,e){if(!t?.sides)return console.log("no sides:",{matchUp:t}),"foo";let i=t.sides[e];return i?i.participantId:(console.log("No Side",{matchUp:t,index:e}),"foo")}function Qc(t,e){e&&!t[e]&&(t[e]={allDefaults:0,defaults:0,defeats:[],gamesLost:0,gamesWon:0,matchUpsCancelled:0,matchUpsLost:0,matchUpsWon:0,pointsLost:0,pointsWon:0,pressureScores:[],ratingVariation:[],retirements:0,setsLost:0,setsWon:0,tieSinglesWon:0,tieSinglesLost:0,tieDoublesWon:0,tieDoublesLost:0,tieMatchUpsLost:0,tieMatchUpsWon:0,victories:[],walkovers:0})}function nq({manualGamesOverride:t,participantResults:e,score:i,sides:r}){let{sets:n}=i||{},a=[[],[]],s=[0,0];for(let l of n||[]){let{winningSide:u,side1Score:c,side2Score:d}=l;u&&(s[u-1]+=1),a[0].push(Ke(c||0)),a[1].push(Ke(d||0))}let o=[a[0].reduce((l,u)=>l+u,0),a[1].reduce((l,u)=>l+u,0)];r.forEach((l,u)=>{let{participantId:c}=l;c&&(Qc(e,c),e[c].setsWon+=s[u],e[c].setsLost+=s[1-u],t||(e[c].gamesWon+=o[u],e[c].gamesLost+=o[1-u]))})}function aq({winningParticipantId:t,manualGamesOverride:e,losingParticipantId:i,participantResults:r,pressureRating:n,matchUpFormat:a,matchUpStatus:s,isTieMatchUp:o,matchUpType:l,tallyPolicy:u,winningSide:c,score:d,sides:p}){let f=c&&c-1,m=1-f;n&&l===zt&&B0e({participantResults:r,sides:p,score:d}),o||Uae({winningParticipantId:t,losingParticipantId:i,participantResults:r,matchUpStatus:s});let h=k2({matchUpStatus:s,matchUpFormat:a,tallyPolicy:u,winningSide:c,score:d}),g=bae({matchUpStatus:s,matchUpFormat:a,tallyPolicy:u,winningSide:c,score:d}),{pointsTally:I}=wae({score:d,matchUpFormat:a});t&&(r[t].setsWon+=h[f],r[t].setsLost+=h[m],e||(r[t].gamesWon+=g[f],r[t].gamesLost+=g[m]),r[t].pointsWon+=I[f],r[t].pointsLost+=I[m]),i&&(r[i].setsWon+=h[m],r[i].setsLost+=h[f],e||(r[i].gamesWon+=g[m],r[i].gamesLost+=g[f]),r[i].pointsWon+=I[m],r[i].pointsLost+=I[f])}function Uae({winningParticipantId:t,losingParticipantId:e,participantResults:i,matchUpStatus:r}){e&&(r===ai&&(i[e].walkovers+=1),r===qt&&(i[e].defaults+=1),r===Sr&&(i[e].retirements+=1),Lr(r)&&(i[e].allDefaults+=1),i[e].matchUpsLost+=1),t&&(i[t].matchUpsWon+=1),e&&t&&(i[e].defeats.push(t),i[t].victories.push(e))}function W0e(t,e,i,r){t.groups&&Object.keys(t.groups).sort(r).forEach(n=>{let a=t.groups[n].map(o=>e[o]).join(", "),s=`${n} ${t.attribute}: ${a}`;i.push(s)})}function z0e(t,e,i,r){if(t.excludedDirectives?.length){let n=t.excludedDirectives.map(({attribute:o})=>o).join(", "),a=`${n.length} directives were excluded due to participants limit}`;r.push(a);let s=`Excluded: ${n}`;r.push(s)}else{let n=(u,c)=>Number.parseFloat(t.reversed?u:c)-Number.parseFloat(t.reversed?c:u),a=t.groups?Object.values(t.groups).flat(1/0).length:t.participantIds?.length??0,s=t.reversed?" in reverse order":"",o=t.groups?"grouped":"separated",l=`Step ${e+1}: ${a} particiants were ${o}${s} by ${t.attribute}`;if(r.push(l),t.idsFilter){let u=`${t.attribute} was calculated considering ONLY TIED PARTICIPANTS`;r.push(u)}W0e(t,i,r,n)}r.push("----------------------")}function q0e({matchUps:t,order:e,report:i}){let r={};t.forEach(({sides:a})=>{a.forEach(s=>{s.participantId&&s.participant&&(r[s.participantId]=s.participant.participantName)})});let n=[];return Array.isArray(i)&&i.forEach((a,s)=>{z0e(a,s,r,n)}),n.push("Final Order:"),e.forEach(a=>{let{participantId:s,resolved:o}=a,l=a.groupOrder||a.provisionalOrder;n.push(`${l}: ${r[s]} => resolved: ${!!o}`)}),n.join(`\r
`)}function Tae({participantResults:t,participantIds:e,attribute:i}){return Dae({participantResults:t,participantIds:e}).reduce((r,n)=>{let{participantId:a,results:s}=n,o=s?.[i];return!isNaN(o)&&a&&(r[o]?r[o].push(a):r[o]=[a]),r},{})}function Dae(t){return(t.participantIds||Object.keys(t.participantResults)).reduce((e,i,r)=>(e.push({participantId:i,i:r,results:t.participantResults[i]}),e),[])}var Y0e=[{attribute:"matchUpsPct",idsFilter:!1},{attribute:"allDefaults",reversed:!0,idsFilter:!1},{attribute:"defaults",reversed:!0,idsFilter:!1},{attribute:"walkovers",reversed:!0,idsFilter:!1},{attribute:"retirements",reversed:!0,idsFilter:!1},{attribute:"setsPct",idsFilter:!1},{attribute:"gamesPct",idsFilter:!1},{attribute:"pointsPct",idsFilter:!1},{attribute:"matchUpsPct",idsFilter:!0},{attribute:"setsPct",idsFilter:!0},{attribute:"gamesPct",idsFilter:!0},{attribute:"pointsPct",idsFilter:!0}],uk={matchUpsPct:20,tieMatchUpsPct:16,pointsPct:4,gamesPct:8,setsPct:12};function sq(t){let{requireCompletion:e=!0,participantResults:i,subOrderMap:r,tallyPolicy:n}=t,a=[];if(e&&!K0e(t))return{};let s=["tieMatchUpsWon","tieSinglesWon","tieDoublesWon","matchUpsWon","pointsWon","gamesWon","setsWon","gamesPct","setsPct","pointsPct","matchUpsPct"].includes(n?.groupOrderKey)?n.groupOrderKey:"matchUpsWon",o=Tae({participantResults:i,attribute:s});a.push({attribute:s,groups:o});let l=Object.keys(o).map(g=>Number.parseFloat(g)).sort((g,I)=>I-g).map(g=>o[g]).map(g=>{let I=Pae({participantIds:g,...t});return a.push(...I.report??[]),I.order}).flatMap((g,I)=>g.map(v=>v.resolved?v:{...v,subGroup:[I].concat(...v.subGroup??[])})),u,c=0,d=1,p;l.forEach((g,I)=>{I&&(g.resolved||p&&!g.resolved)&&(d+=1),p=g.resolved;let v=Number.parseInt(g.subGroup?.join("")||0);g.resolved?(g.position=I+1,d=g.position):(u&&v>u&&(d+=c,c=0),g.position=d,c+=1),u=v});let f=l.map(({position:g})=>g),m=Sa(f);return l.forEach(g=>{let{participantId:I,position:v}=g||{},w=i[I];g.GEMscore=h(w);let y=m[v];g?.position!==void 0&&(y>1&&(g.ties=y,r&&(g.subOrder=r[I])),g.rankOrder=v,g.groupOrder=v+(g.subOrder||1)-1)}),{groupOrder:l,report:a.flat(1/0).filter(Boolean)};function h(g){return(Array.isArray(n?.GEMscore)?Object.keys(uk).filter(I=>n.GEMscore.includes(I)):Object.keys(uk)).map(I=>(g[I]||0)*Math.pow(10,uk[I].toFixed(3))).reduce((I,v)=>I+v,0)}}function K0e({participantResults:t,participantsCount:e}){let i=Dae({participantResults:t}).filter(r=>e-1===r.results.matchUpsWon+r.results.matchUpsLost+r.results.matchUpsCancelled);return e===i.length}function X0e({disableHeadToHead:t,participantIds:e,matchUpFormat:i,groupTotals:r,tallyPolicy:n,attribute:a,idsFilter:s,matchUps:o,reversed:l}){let{participantResults:u}=kU({participantIds:s&&e,groupingTotal:r&&a,matchUpFormat:i,tallyPolicy:n,matchUps:o}),c=Tae({participantResults:u,participantIds:e,attribute:a}),d=[{attribute:a,reversed:l,groups:c,idsFilter:s,groupTotals:r}],p;return Object.keys(c).length>1&&e.length&&(p=Object.keys(c).map(f=>Number.parseFloat(f)).sort((f,m)=>l?f-m:m-f).map(f=>c[f]).map(f=>{let m=Pae({participantResults:u,disableHeadToHead:t,participantIds:f,matchUpFormat:i,tallyPolicy:n,matchUps:o});return d.push(...m.report??[]),m.order}).flatMap((f,m)=>f.map(h=>h.resolved?h:{...h,subGroup:[m].concat(...h.subGroup??[])}))),{order:p,report:d}}function Pae({participantResults:t,disableHeadToHead:e,participantIds:i,matchUpFormat:r,tallyPolicy:n,matchUps:a}){let s=[],o=[],l;if(i?.length===1)return{order:[{resolved:!0,participantId:i[0]}]};if(i?.length===2&&(!n?.headToHead||!n.headToHead.disabled&&!e)){let c=J0e({participantIds:i,participantResults:t});if(c){let d=c[0].participantId;return o.push({attribute:"head2Head",participantIds:i,headToHeadWinner:d}),{order:c,headToHeadWinner:d,report:o}}}let u=(n?.tallyDirectives||Y0e).filter(c=>{let d=!(Ai(c.maxParticipants)&&i?.length>c.maxParticipants);return d||s.push(c),d});return s.length&&o.push({excludedDirectives:s,participantIds:i}),u.every(({attribute:c,reversed:d,idsFilter:p,groupTotals:f,disableHeadToHead:m})=>(l=X0e({disableHeadToHead:m,participantIds:i,matchUpFormat:r,groupTotals:f,tallyPolicy:n,attribute:c,idsFilter:p,matchUps:a,reversed:d}),o.push(l.report),!l.order)),l.order?{order:l.order,report:o}:{order:i?.map(c=>({participantId:c})),report:o}}function J0e({participantIds:t,participantResults:e}){if(t){if(e[t[0]].victories.includes(t[1]))return t.map(i=>({resolved:!0,participantId:i}));if(e[t[1]].victories.includes(t[0]))return t.reverse().map(i=>({resolved:!0,participantId:i}))}}function qh({policyDefinitions:t,generateReport:e,pressureRating:i,matchUpFormat:r,matchUps:n=[],subOrderMap:a,perPlayer:s}){if(!n?.length||!Ka(n))return{error:Nu};let o=nt(n.map(({structureId:y})=>y));if(o.length!==1)return q({result:{error:re,info:"Maximum one structureId"},stack:"tallyParticipantResults",context:{structureIds:o}});let l=n.filter(y=>y&&y.matchUpStatus!=="BYE"),u=l.length&&nt(l.flatMap(({drawPositions:y})=>y)).length,c=l.filter(y=>yp({matchUp:y})).length===l.length;c||(s=0);let d=n.every(({matchUpType:y,tieMatchUps:b})=>y===ei&&b?.every(S=>yp({matchUp:S}))),p=t?.[zB],f=n.filter(y=>yp({matchUp:y})??y.matchUpType===ei),{participantResults:m}=kU({matchUps:f,pressureRating:i,matchUpFormat:r,tallyPolicy:p,perPlayer:s}),h,g,{groupOrder:I,report:v}=sq({matchUps:f,participantResults:m,participantsCount:u,matchUpFormat:r,subOrderMap:a,tallyPolicy:p});if(i&&Q0e({participantResults:m}),c&&I)h=v,g=I,I.forEach(y=>{let{participantId:b,groupOrder:S,rankOrder:U,subOrder:T,ties:P,GEMscore:D}=y,E=m[b];Object.assign(E,{groupOrder:S,rankOrder:U,GEMscore:D,subOrder:T,ties:P})});else{let{groupOrder:y,report:b}=sq({requireCompletion:!1,participantResults:m,participantsCount:u,matchUpFormat:r,tallyPolicy:p,subOrderMap:a,matchUps:n});h=b,g=y,y&&y.forEach(S=>{let{participantId:U,groupOrder:T,GEMscore:P}=S,D=m[U];Object.assign(D,{provisionalOrder:T,GEMscore:P})})}let w={completedTieMatchUps:d,readableReport:"",participantResults:m,bracketComplete:c,order:[],report:h};if((c||d)&&(w.order=g),e||la({tally:!0})){let y=q0e({matchUps:n,report:h,order:g});la({tally:!0})&&console.log(y),w.readableReport=y}return w}function Q0e({participantResults:t}){let e=n=>n.reduce((a,s)=>a+parseFloat(s),0),i=n=>parseFloat((e(n)/n.length).toFixed(2)),r=Object.keys(t).map(n=>{let a=t[n],{pressureScores:s}=a,o=s?.length?i(s):0;return{participantId:n,averagePressure:o}}).sort((n,a)=>(a.averagePressure||0)-(n.averagePressure||0)).map((n,a)=>({...n,order:a+1}));for(let n of r)t[n.participantId].pressureOrder=n.order}function Xl({requireTimeStamp:t,scaleAttributes:e,participant:i}){if(!i)return{error:kh};if(!wt(e))return{error:re};if(i.timeItems??=[],Array.isArray(i.timeItems)){let{accessor:r,scaleType:n,eventType:a,scaleName:s}=e,o=[Sd,n,a,s].join("."),l=i.timeItems.filter(u=>u?.itemType===o).filter(u=>!t||u?.itemDate).sort((u,c)=>(u.createdAt?new Date(u.createdAt).getTime():0)-(c.createdAt?new Date(c.createdAt).getTime():0)).pop();if(l){let[u,c,d,p]=l.itemType?.split(".")??[];if(u!==Sd)return{error:$m};let f=r&&bp({element:l.itemValue,accessor:r}),m=f?.value||l.itemValue,h={rawValue:f&&l.itemValue,eventType:d,scaleDate:l.itemDate,scaleValue:m,scaleName:p,scaleType:c};return{...W,scaleItem:h}}}return{...W,scaleItem:void 0}}function Z0e({publishedSeeding:t,usePublishState:e,withSeeding:i,participant:r,event:n}){let a={},s=c=>[Sd,Yl,n.eventType,c].join("."),o=Object.assign({},...(r.timeItems||[]).filter(({itemType:c})=>c.split(".")[1]===Yl).map(({itemType:c,itemValue:d})=>({[c]:d}))),l=(t?.stageSeedingScaleNames&&Object.values(t?.stageSeedingScaleNames)||Array.isArray(t?.seedingScaleNames)&&t.seedingScaleNames||[]).map(s),u=Li(Object.keys(o),l);if((!e||!Object.keys(o).length&&!t?.drawIds?.length||u.length)&&u.length){if(t?.stageSeedingScaleNames){let c=Object.keys(t.stageSeedingScaleNames).map(p=>{let f=s(t.stageSeedingScaleNames[p]),m=o[f];return[p,m]}).filter(p=>p[1]).map(p=>({[p[0]]:{seedValue:p[1]}})),d=Object.assign({},...c);a.seedAssignments=d}else if(u){let c=u.map(d=>o[d]);a.seedValue=c.pop()}}else if(!e&&typeof i=="object"){let c=Object.keys(i).map(p=>{let f=s(i[p]),m=o[f];return[p,m]}).filter(p=>p[1]).map(p=>({[p[0]]:{seedValue:p[1]}})),d=Object.assign({},...c);a.seedAssignments=d}else{let{categoryName:c,ageCategoryCode:d}=n.category||{},p=[d,n.eventId,c].filter(Boolean),f;for(let m of p){let h={eventType:n.eventType,scaleType:Yl,scaleName:m},g=Xl({scaleAttributes:h,participant:r});if(g.scaleItem){f=g.scaleItem;break}}if(f&&(!e||t?.published&&!t?.published?.drawIds?.length)){let m=f.scaleValue;a.seedValue=m}}return a}function x2({positionAssignments:t}){let e=(t||[]).filter(Pa(Iu)).map(n=>{let{extension:a}=ht({element:n,name:MI}),s=Ke(a?.value),o=!isNaN(s)&&s;return o&&{participantId:n.participantId,subOrder:o}}).filter(Boolean),i=e.map(({subOrder:n})=>n),r=Sa(i);return{subOrderMap:Object.assign({},...e.filter(({subOrder:n})=>r[n]===1).map(({participantId:n,subOrder:a})=>({[n]:a})))}}function e_e({convertExtensions:t,seedAssignments:e,participant:i,withSeeding:r,seedValue:n,eventId:a,ranking:s,entry:o}){let{entryStatus:l,entryStage:u,entryPosition:c,extensions:d}=o,p=d?.length&&t?Object.assign({},...NB(d??[])):{},f=Object.assign(p,{entryPosition:c,entryStatus:l,entryStage:u,ranking:s,eventId:a});i.events[a]=je(f,!1,!1,!0),r&&(e&&(i.events[a].seedAssignments=e),n&&(i.events[a].seedValue=n))}function OU(t){let e=He(t,[{[hr]:!0}]);if(e.error)return e;let{tournamentRecord:i,status:r=Xa}=t,n=`${Jd}.${Qd}`;return Oe(qM({tournamentRecord:i,itemType:n})?.timeItem?.itemValue?.[r],!1,!0)}function t_e(t){let{tournamentId:e}=t??{};return!!e}function Qa({event:t,status:e=Xa}){let i=`${Jd}.${Qd}`;return vU({itemType:i,event:t})?.timeItem?.itemValue?.[e]}function _f(t){let e=t?.embargo;return!e||!yc(e)?!1:new Date(e).getTime()>Date.now()}function jo(t){return!!t?.published&&!_f(t)}function F2({drawDetails:t,drawId:e,ignoreEmbargo:i=!1}){let r=t?.[e]?.publishingDetail;return i?!!r?.published:jo(r)}function Yh(t){let{tournamentRecord:e,drawDefinition:i,eventIds:r,eventId:n,drawIds:a,drawId:s,event:o}=t??{};if(e&&!t_e(e))return{error:re};if(n&&!o)return{error:ps};if(Array.isArray(r)&&r?.length){let p={};for(let f of r){if(!ni(f))return{error:re};let m=Wn({tournamentRecord:e,eventId:f})?.event;if(!m)return{error:ps};let h=ck({event:m});p[f]=h}return{...W,publishState:p}}if(o){let p=ck({event:o}),f={};if(s)return i?{publishState:{status:{published:!!p.status.publishedDrawIds?.includes(s),drawDetail:p.status.drawDetails?.[s]},...W}}:{error:_a};if(Array.isArray(a)&&a?.length){let m=o.drawDefinitions?.map(Zb)??[];for(let h of a){if(!ni(h))return{error:re};if(!m.includes(h))return{error:_a};f[h]={status:{published:!!p.status.publishedDrawIds.includes(h),drawDetail:p.status.drawDetails?.[h]}}}}else f=p;return{...W,publishState:f}}let l=[],u=!1,c={};for(let p of e?.events??[]){let f=ck({event:p});c[p.eventId]=f,f.status.published&&(l.push(p.eventId),u=!0);for(let{drawId:m}of p.drawDefinitions??[]){let h=f.status?.publishedDrawIds?.includes(m);h&&(c[m]={status:{published:h}})}}let d=[];if(e){let p=OU({tournamentRecord:e});c.tournament=p??{},(p?.orderOfPlay?.published||p?.participants?.published)&&(u=!0),c.tournament.status={published:u,publishedEventIds:l},p?.orderOfPlay?.embargo&&d.push({type:"orderOfPlay",embargo:p.orderOfPlay.embargo,embargoActive:_f(p.orderOfPlay)}),p?.participants?.embargo&&d.push({type:"participants",embargo:p.participants.embargo,embargoActive:_f(p.participants)})}for(let p of e?.events??[]){let f=Qa({event:p})?.drawDetails??{};for(let[m,h]of Object.entries(f)){h?.publishingDetail?.embargo&&d.push({type:"draw",id:m,embargo:h.publishingDetail.embargo,embargoActive:_f(h.publishingDetail)});for(let[g,I]of Object.entries(h?.stageDetails??{}))I?.embargo&&d.push({type:"stage",id:`${m}:${g}`,embargo:I.embargo,embargoActive:_f(I)});for(let[g,I]of Object.entries(h?.structureDetails??{}))if(I?.embargo&&d.push({type:"structure",id:g,embargo:I.embargo,embargoActive:_f(I)}),I?.scheduledRounds)for(let[v,w]of Object.entries(I.scheduledRounds))w?.embargo&&d.push({type:"scheduledRound",id:`${g}:round${v}`,embargo:w.embargo,embargoActive:_f(w)})}}return d.length&&(c.embargoes=d),{...W,publishState:c}}function ck({event:t}){let e=Qa({event:t});if(!e)return{status:{published:!1}};let i={published:void 0,seedingScaleNames:[],drawIds:[]};e.seeding&&Object.assign(i,e.seeding);let r=e.drawDetails??{};for(let o of t.drawDefinitions?.map(Zb)||[])r[o]||(r[o]={publishingDetail:{published:!1}});let n=r&&Object.keys(r).length&&Object.keys(r).filter(o=>F2({drawDetails:r,drawId:o,ignoreEmbargo:!0})),a=n?.length?n:e.drawIds??[];if(a?.length&&!n?.length)for(let o of a)r[o]={publishingDetail:{published:!0}};let s=a?.length>0;return{status:{publishedDrawIds:a,publishedSeeding:i,drawDetails:r,published:s}}}function Eae(t){let{participantMap:e,participantId:i,matchUpStatus:r,roundPosition:n,structureId:a,matchUpType:s,roundNumber:o,matchUpId:l,potential:u,schedule:c,drawId:d,score:p}=t;!c||!Object.keys(c).length||r==="BYE"||e[i].scheduleItems.push({...c,scheduledDate:Ze(c?.scheduledDate),scheduledTime:pi(c?.scheduledTime),checkScoreHasValue:fr({score:p}),matchUpStatus:r,roundPosition:n,structureId:a,matchUpType:s,roundNumber:o,matchUpId:l,potential:u,drawId:d})}function i_e({finishingPositionRange:t={winner:[],loser:[]},collectionPosition:e,participantMap:i,finishingRound:r,participantWon:n,collectionId:a,matchUpStatus:s,participantId:o,stageSequence:l,roundNumber:u,structureId:c,matchUpId:d,drawId:p,stage:f}){let m=i[o],h=y=>Math.abs(y[0]-y[1]);m.structureParticipation[c]||(m.structureParticipation[c]={rankingStage:f,walkoverWinCount:0,defaultWinCount:0,stageSequence:l,winCount:0,structureId:c,drawId:p});let g=m.structureParticipation[c],{winner:I,loser:v}=t,w=n?I:v;n&&(g.winCount+=1,s===ai&&(g.walkoverWinCount+=1),s===qt&&(g.defaultWinCount+=1)),w&&(!g.finishingPositionRange||h(w)<h(g.finishingPositionRange))&&(g.finishingPositionRange=w),r&&((!g.finishingRound||r<g.finishingRound)&&(g.finishingMatchUpId=d,g.finishingRound=r,g.roundNumber=u),r===1&&(g.participantWon=n)),e&&(g.lineParticipation||(g.lineParticipation=[]),g.lineParticipation.push({collectionPosition:e,collectionId:a,won:n}))}function oq(t){let{withScheduleItems:e,scheduleAnalysis:i,withTeamMatchUps:r,participantMap:n,withOpponents:a,withMatchUps:s,withEvents:o,withDraws:l,finishingPositionRange:u,finishingRound:c,matchUpStatus:d,stageSequence:p,roundNumber:f,structureId:m,score:h,stage:g,withRankingProfile:I,collectionPosition:v,tieWinningSide:w,roundPosition:y,matchUpTieId:b,matchUpSides:S,collectionId:U,matchUpType:T,winningSide:P,matchUpId:D,schedule:E,eventId:R,drawId:C,sides:M}=t,N=a&&M?.length===2&&Object.assign({},...M.map(({sideNumber:A},O)=>{let k=M[1-O].participantId;return A&&{[A]:k}}).filter(Boolean));for(let A of M){let{participantId:O,sideNumber:k,bye:F}=A;if(F)continue;let x=P===k,L=_=>{let B=n[_]?.participant,G=B?.participantType,j=[{participantId:_,participantType:G}];if(G!==$n)for(let K of B?.individualParticipantIds||[]){let Y=n[K]?.participant;j.push({participantType:Y?.participantType,participantId:K})}return j},$=(_,B)=>{if(s){if(n[_].matchUps[D]={participantWon:x,matchUpType:T,structureId:m,sideNumber:k,matchUpId:D,eventId:R,drawId:C,stage:g},a){let G=L(B);n[_].matchUps[D].opponentParticipantInfo=G}U&&(n[_].matchUps[D].collectionId=U)}a&&B&&(n[_].opponents[B]={participantId:B,matchUpId:D,eventId:R,drawId:C}),I&&i_e({finishingPositionRange:u,collectionPosition:v,participantMap:n,participantWon:x,collectionId:U,finishingRound:c,matchUpStatus:d,participantId:_,stageSequence:p,roundNumber:f,structureId:m,matchUpId:D,drawId:C,stage:g}),(i||e)&&Eae({participantMap:n,participantId:_,matchUpStatus:d,roundPosition:y,matchUpType:T,roundNumber:f,structureId:m,matchUpId:D,schedule:E,drawId:C,score:h})},V=({participant:_,partnerParticipantId:B})=>{let G=(j,K)=>{j&&(j.partnerParticipantIds||(j.partnerParticipantIds=[]),j.partnerParticipantIds.includes(K)||j.partnerParticipantIds.push(K))};l&&G(_?.draws?.[C],B),o&&G(_?.events?.[R],B),s&&G(_?.matchUps?.[D],B)};if(O&&n[O]){let _=N?.[k];$(O,_);let B=n[O]?.participant.participantType===ft,G=n[O]?.participant.individualParticipantIds||[];if(b){if(r){let j=K=>n[K].matchUps[b]={participantWon:w===k,matchUpId:b,matchUpType:ei,sideNumber:k};j(O),G.forEach(j)}if(l&&!n[O].draws[C]){let j=S.find(X=>X.sideNumber===k)?.participant?.participantId,K=n[j]?.draws?.[C]?.entryStatus,Y=X=>n[X].draws[C]={entryStatus:K,eventId:R,drawId:C};Y(O),G.forEach(Y)}}if(B&&(G.forEach(j=>n[j]&&$(j,_)),G.forEach((j,K)=>{let Y=G[1-K],X=n[j];X&&V({participant:X,partnerParticipantId:Y})}),o&&S)){let j=S.find(K=>K.sideNumber===k)?.participant?.participantId;if(j){let K=n[j]?.events[R];K?(n[O].events[R]={...K},G.forEach(Y=>n[Y].events[R]={...K})):console.log("Missing teamEntry",{eventId:R,teamParticipantId:j})}}if(P){let j=K=>{x?(n[K].counters[T].wins+=1,n[K].counters.wins+=1,d===ai&&(n[K].counters[T].walkoverWins+=1,n[K].counters.walkoverWins+=1),d===qt&&(n[K].counters[T].defaultWins+=1,n[K].counters.defaultWins+=1)):(n[K].counters[T].losses+=1,n[K].counters.losses+=1,d===ai&&(n[K].counters[T].walkovers+=1,n[K].counters.walkovers+=1),d===qt&&(n[K].counters[T].defaults+=1,n[K].counters.defaults+=1))};j(O),G.forEach(j)}}}}function rN(t,e){return(t||"").localeCompare(e||"")}function r_e(t){let{participantFilters:e,convertExtensions:i,policyDefinitions:r,tournamentRecord:n,usePublishState:a,contextFilters:s,matchUpFilters:o,participantMap:l,contextProfile:u,withPotentialMatchUps:c,withRankingProfile:d,withScheduleItems:p,scheduleAnalysis:f,withTeamMatchUps:m,withStatistics:h,withOpponents:g,withMatchUps:I,withSeeding:v,withEvents:w,withDraws:y}=t,b=e?.participantIds,S=k=>{let F=[k];return l[k]?.participant.individualParticipantIds?.forEach(x=>F.push(x)),F.some(x=>!b?.length||b.includes(x))?F:[]},U={withMatchUps:I||d,withEvents:w||d,withDraws:y||d,withPotentialMatchUps:c,withRankingProfile:d,withScheduleItems:p,scheduleAnalysis:f,withTeamMatchUps:m,withStatistics:h,participantMap:l,withOpponents:g,withSeeding:v},T=[],P={},D=[],E={},R={},C={},M={},N={},A=({eventType:k,scaleNames:F,participantId:x})=>l[x]?.participant?.rankings?.[k]?.find(L=>F.includes(L.scaleName))?.scaleValue;for(let k of n?.events||[]){if(e?.eventIds&&!e.eventIds.includes(k.eventId))continue;let{drawDefinitions:F=[],extensions:x=[],wheelchairClass:L,eventType:$,eventName:V,category:_,entries:B,eventId:G,gender:j}=k,{flightProfile:K}=Bi({event:k}),Y=K?.flights??[],X=Yh({event:k}).publishState;X&&(E[G]=X);let Z=X?.status?.publishedSeeding;if(w||v||d){let ae=i?Object.assign({},...NB(x??[])):{};R[G]={...ae,wheelchairClass:L,eventName:V,eventType:$,category:_,eventId:G,gender:j};let te=[_?.categoryName,_?.ageCategoryCode].filter(Boolean);for(let ne of B){let{participantId:le}=ne;if(!le||!l[le])continue;let de=A({eventType:$,scaleNames:te,participantId:le}),pe,ge;if(v){let Pe=l[le].participant;({seedAssignments:pe,seedValue:ge}=Z0e({publishedSeeding:Z,usePublishState:a,withSeeding:v,participant:Pe,event:k}))}let Me=Pe=>{if(l[Pe]?.events?.[G])return;let Be=l[Pe];e_e({convertExtensions:i,seedAssignments:pe,participant:Be,withSeeding:v,seedValue:ge,eventId:G,ranking:de,entry:ne})};Me(le),(l[le].participant.individualParticipantIds||[]).forEach(Me)}}let J=E?.[G]?.publishedSeeding;if(y||d||v){let ae=ne=>ne?Object.assign({},...ne.map(({participantId:le,seedValue:de,seedNumber:pe})=>({[le]:{seedValue:de,seedNumber:pe}}))):void 0,te=nt([...F.map(Zb),...Y.map(Zb)]);for(let ne of te){let le=F.find(ee=>ee.drawId===ne),de=[_?.categoryName,_?.ageCategoryCode].filter(Boolean),{structures:pe=[],drawOrder:ge,drawName:Me,drawType:Pe}=le??{},Be=Y?.find(ee=>ee.drawId===ne),fe=le?.entries||Be?.drawEntries,Te=Be?.flightNumber,ce=(le?.structures||[]).sort((ee,Se)=>Bh(ee,Se)).map(({structureId:ee,structures:Se})=>[ee,...(Se||[]).map(({structureId:De})=>De)]).flat(1/0),ye,be,Fe,we,Ne=0,me=new Set(pe.filter(({stage:ee,stageSequence:Se})=>ee===Ae&&Se===1||ee===ze).flatMap(ee=>{let{positionAssignments:Se}=Kt({structure:ee}),{seedAssignments:De,stageSequence:it,stage:Ue}=ee;return Ue===Ae?(Ne=Se?.length??0,Fe=Se,we=De):it===1&&(ye=Se,be=De),Se}).map(({participantId:ee})=>ee).filter(Boolean)),Ee=ae(we),Le=ae(be),Q=le?fe.filter(({participantId:ee})=>me.has(ee)):fe,se=!a||J?.published&&(J?.drawIds?.length===0||J?.drawIds?.includes(ne));for(let ee of Q){if(!l[ee.participantId])continue;let{entryStatus:Se,entryStage:De,entryPosition:it,participantId:Ue}=ee,ut=A({participantId:Ue,scaleNames:de,eventType:$}),yi=qe=>{if(!l[qe]||l[qe].draws?.[ne])return;let bi=v&&se,oi=bi?{}:void 0,nn=bi?Ee?.[Ue]?.seedValue||Ee?.[Ue]?.seedNumber:void 0,Fo=nn?Ee?.[Ue]:void 0,Nf=bi?Le?.[Ue]?.seedValue||Le?.[Ue]?.seedNumber:void 0,Af=Nf?Le?.[Ue]:void 0;oi&&nn&&(oi[Ae]=Fo),oi&&Nf&&(oi[ze]=Af);let cy=nn||Nf;cy&&(l[qe].participant.seedings[$]||(l[qe].participant.seedings[$]=[]),Fo&&l[qe].participant.seedings[$].push({...Fo,scaleName:ne}),Af&&l[qe].participant.seedings[$].push({...Af,scaleName:ne}),oi&&(l[qe].events[G].seedAssignments||(l[qe].events[G].seedAssignments={}),Object.keys(oi).forEach(dy=>l[qe].events[G].seedAssignments[dy]=oi[dy]))),(y||d)&&(l[qe].draws[ne]=je({seedAssignments:oi,entryPosition:it,entryStatus:Se,entryStage:De,seedValue:cy,eventId:G,ranking:ut,drawId:ne},!1,!1,!0))};[Us,Sf].includes(Se)||(yi(Ue),(l[Ue].participant.individualParticipantIds||[])?.forEach(yi))}let oe=(le?.structures??[]).reduce((ee,Se)=>(ee.includes(Se.stage)||ee.push(Se.stage),ee),[]),ue=(le?.links??[]).length;C[ne]={qualifyingPositionAssignments:ye,qualifyingSeedAssignments:be,mainPositionAssignments:Fe,qualifyingSeedingMap:Le,mainSeedAssignments:we,orderedStructureIds:ce,mainSeedingMap:Ee,flightNumber:Te,linksCount:ue,drawOrder:ge,drawName:Me,drawType:Pe,drawSize:Ne,drawId:ne,stages:oe}}}if(d||f||m||h||g||I||y){let ae=!!f||c,te=xu({afterRecoveryTimes:!!f,policyDefinitions:r,tournamentRecord:n,inContext:!0,participantMap:l,contextFilters:s,matchUpFilters:o,contextProfile:u,nextMatchUps:ae,event:k})?.matchUps??[];for(let ne of te){let{finishingPositionRange:le,potentialParticipants:de,tieMatchUps:pe=[],sides:ge=[],winningSide:Me,matchUpType:Pe,matchUpId:Be,eventId:fe,drawId:Te,collectionId:ce,containerStructureId:ye,stageSequence:be,finishingRound:Fe,matchUpStatus:we,roundPosition:Ne,roundNumber:me,structureId:Ee,schedule:Le,score:Q,stage:se}=ne;if(P[Be]=ne,d&&ye&&Ee&&Te&&(M[Ee]||(M[Ee]=[]),M[Ee].push(ne),!N[ye])){let ue=F.find(ee=>ee.drawId===Te);ue&&(N[ye]={drawDefinition:ue,drawId:Te})}let oe={finishingPositionRange:le,containerStructureId:ye,finishingRound:Fe,stageSequence:be,roundPosition:Ne,collectionId:ce,roundNumber:me,structureId:Ee,schedule:Le,eventId:fe,drawId:Te,score:Q,stage:se};oq({...oe,...U,matchUpStatus:we,winningSide:Me,matchUpType:Pe,matchUpId:Be,sides:ge});for(let ue of pe){let{winningSide:ee,sides:Se=[],matchUpId:De,collectionPosition:it,collectionId:Ue,matchUpStatus:ut,matchUpType:yi}=ue;oq({...oe,...U,winningSide:ee,tieWinningSide:Me,matchUpTieId:Be,matchUpId:De,sides:Se,collectionId:Ue,collectionPosition:it,matchUpSides:ge,matchUpStatus:ut,matchUpType:yi})}Array.isArray(de)&&(ae||f||p)&&de.flat().map(yt).filter(Boolean)?.forEach(ue=>{S(ue)?.forEach(ee=>{l[ee]&&(l[ee].potentialMatchUps[Be]=je({tournamentId:n?.tournamentId,matchUpId:Be,eventId:fe,drawId:Te}))}),(f||p)&&Eae({potential:!0,participantMap:l,participantId:ue,matchUpStatus:we,roundPosition:Ne,structureId:Ee,matchUpType:Pe,roundNumber:me,matchUpId:Be,schedule:Le,drawId:Te,score:Q})})}D.push(...te)}}let O={};if(d)for(let[k,F]of Object.entries(N)){let{drawDefinition:x,drawId:L}=F,$=x.structures?.find(j=>j.structureType===gn&&j.stage===Ae&&j.stageSequence===1);if(!$?.structures)continue;let V=$.structures,_=V.length,B=V.reduce((j,K)=>j+(K.positionAssignments?.length||0),0),G=x.structures?.find(j=>j.stage===Ti);O[L]||(O[L]={});for(let j of V){let K=j.structureId,Y=M[K];if(!Y?.length)continue;let X=j.positionAssignments?.length,{subOrderMap:Z}=x2({positionAssignments:j.positionAssignments}),J=qh({matchUps:Y,subOrderMap:Z});if(J?.participantResults)for(let[ae,te]of Object.entries(J.participantResults)){let{groupOrder:ne,provisionalOrder:le}=te,de=ne||le;if(!de)continue;let pe;if(B===X&&de)pe=[de,de];else if(_>1&&de&&!G)pe=[1,_];else if(_>1&&de&&G){let ge=x.links?.find(Me=>Me.source.structureId===k)?.source?.finishingPositions;if(ge){let Me=ge.length*_;if(ge.includes(de))pe=[1,Me];else{let Pe=(X-de)*_;pe=[Me+1,B-Pe]}}}pe&&(O[L][ae]=pe)}}}if(h||d||f){let k=Object.values(l);for(let F of k){let{wins:x,losses:L,[zt]:{wins:$,losses:V},[Bt]:{wins:_,losses:B}}=F.counters,G=(j,K,Y)=>{let X=K+Y,Z=K,J=X&&Z/X;F.statistics[j]={denominator:X,numerator:Z,statValue:J,statCode:j}};if(h&&(G(mD,x,L),G(`${mD}.${zt}`,$,V),G(`${mD}.${Bt}`,_,B)),d){let j=(K=[])=>Math.abs(K[0]-K[1]);for(let K of Object.keys(F.draws)){let{orderedStructureIds:Y=[],flightNumber:X}=C[K]||{};if(F.structureParticipation&&Y.length){let Z,J=0,ae=Y.map(te=>{let ne=F.structureParticipation[te];if(!ne)return;Z||(Z=ne?.finishingPositionRange),j(Z)>j(ne?.finishingPositionRange)&&(Z=ne?.finishingPositionRange);let le=ne.stage!==ze;return le&&(J+=1),je({...ne,participationOrder:le?J:void 0,flightNumber:X})}).filter(Boolean);if(F.draws[K]){let te=F.participant.participantId,ne=O[K]?.[te];ne&&(Z=ne),F.draws[K].finishingPositionRange=Z,F.draws[K].structureParticipation=ae}}}}if(f){let j=wt(f)?f.scheduledMinutesDifference:0,K=F.scheduleItems||[],Y=F.potentialMatchUps||{},X=K.reduce((J,ae)=>{let{scheduledDate:te,scheduledTime:ne}=ae;return J[te]||(J[te]=[]),ne&&J[te].push(ae),J},{});Object.values(X).forEach(J=>J.sort(Qie));for(let J of K){let{typeChangeTimeAfterRecovery:ae,timeAfterRecovery:te,scheduledDate:ne,scheduledTime:le}=J,de=X[ne],pe=Rt(le);for(let ge of de){if(ge.matchUpId===J.matchUpId||Lr(ge.matchUpStatus)&&!ge.checkScoreHasValue)continue;let Me=J.matchUpType!==ge.matchUpType&&ae||te,Pe=J.drawId===ge.drawId,Be=Y[J.matchUpId]&&Y[ge.matchUpId],fe=Rt(ge.scheduledTime),Te=Math.abs(fe-pe),ce=fe>=pe;if((j&&!Number.isNaN(j)?Te<=j:ce&&Rt(ge.scheduledTime)<Rt(Me))&&!(Be&&Pe)&&ce){let ye=[J.matchUpId,ge.matchUpId].sort(rN).join("|");F.scheduleConflicts[ye]={priorScheduledMatchUpId:J.matchUpId,matchUpIdWithConflict:ge.matchUpId}}}}let Z=F.participant.participantId;Object.keys(F.scheduleConflicts).length&&T.push(Z),l[Z].scheduleConflicts=F.scheduleConflicts}}}return{participantIdsWithConflicts:T,eventsPublishStatuses:E,derivedEventInfo:R,derivedDrawInfo:C,mappedMatchUps:P,participantMap:l,matchUps:D}}function xU({participantFilters:t={},tournamentRecord:e,participants:i=[]}){if(!Object.keys(t).length)return i;let{accessorValues:r,drawEntryStatuses:n,positionedParticipants:a,eventEntryStatuses:s,participantRoles:o,participantRoleResponsibilities:l,participantTypes:u,participantIds:c,signInStatus:d,enableOrFiltering:p,eventIds:f,genders:m}=t,h=Nl(f)&&e?.events?.filter(y=>f?.includes(y.eventId))||e?.events||[],g=n&&n_e({drawEntryStatuses:n,tournamentEvents:h}),I=s&&a_e({eventEntryStatuses:s,tournamentEvents:h}),v=a!==void 0&&[!0,!1].includes(a)&&h.reduce((y,b)=>y.concat(...(b.drawDefinitions||[]).map(S=>vne({drawDefinition:S}).allPositionedParticipantIds).filter(Boolean)),[]),w=y=>r?.reduce((b,S)=>{let{accessor:U,value:T}=S,{values:P}=bp({element:y,accessor:U});return b&&P?.includes(T)},!0);if(i=i?.filter(y=>{let b=Ss({element:y,itemType:IU})?.timeItem?.itemValue,{participantRoleResponsibilities:S,participantType:U,participantRole:T,participantId:P,person:D}=y,E=Array.isArray(m)&&m?.length&&D?.sex&&m.includes(D.sex);return p?m&&E||a&&v.includes(P)||a===!1&&!v.includes(P)||g?.includes(P)||I?.includes(P)||c?.includes(P)||d&&b===d||u&&U&&Nl(u)&&u.includes(U)||o&&T&&Nl(o)&&o.includes(T)||l&&Nl(S)&&Nl(l)&&l.find(R=>S?.includes(R))||r?.length&&Nl(r)&&w(y):(!m||E)&&(a===void 0||a&&v.includes(P)||a===!1&&!v.includes(P))&&(!g||g.includes(P))&&(!I||I.includes(P))&&(!c||c.includes(P))&&(!d||b===d)&&(!u||U&&Nl(u)&&u.includes(U))&&(!o||T&&Nl(o)&&o.includes(T))&&(!l||Nl(S)&&Nl(l)&&l.find(R=>S?.includes(R)))&&(!r?.length||Nl(r)&&w(y))}),h.length&&f){let y=new Set(h.filter(b=>f.includes(b.eventId)).flatMap(b=>{let S=(b.entries||[]).map(T=>T.participantId);if(Pi(pl)(b.eventType))return S;let U=(e?.participants??[]).filter(T=>S.includes(T.participantId)).flatMap(T=>T.individualParticipantIds);return S.concat(...U)}));i=i?.filter(b=>y.has(b.participantId))}return i}function Nl(t){return t&&Array.isArray(t)&&t.length}function n_e({drawEntryStatuses:t,tournamentEvents:e}){let i=({entryStatus:r})=>Array.isArray(t)?t.includes(r):!0;return nt(e.reduce((r,n)=>{let{flightProfile:a}=Bi({event:n}),s=a?.flights?.flatMap(({drawEntries:l})=>Array.isArray(l)?l.filter(i).map(yt):[])||[],o=n.drawDefinitions?.map(({entries:l})=>l?l.filter(i).map(yt):[])||[];return r.concat(...s,...o)},[]))}function a_e({eventEntryStatuses:t,tournamentEvents:e}){return nt(e.reduce((i,r)=>{let n=(r.entries||[]).filter(({entryStatus:a})=>Array.isArray(t)?t.includes(a):!0).map(yt);return i.concat(...n)},[]))}function Ri(t){let{withIndividualParticipants:e,participantFilters:i={},withPotentialMatchUps:r,withRankingProfile:n,convertExtensions:a,policyDefinitions:s,withScheduleItems:o,tournamentRecord:l,scheduleAnalysis:u,withSignInStatus:c,withTeamMatchUps:d,withScaleValues:p,usePublishState:f,withStatistics:m,contextFilters:h,matchUpFilters:g,contextProfile:I,withOpponents:v,withMatchUps:w,internalUse:y,withSeeding:b,withEvents:S,withDraws:U,withISO2:T,withIOC:P}=t,D="getParticipants";if(!l)return q({stack:D,result:{error:ve}});(w||n)&&co({tournamentRecord:l});let E=Ane({convertExtensions:a,tournamentRecord:l,withSignInStatus:c,withScaleValues:p,internalUse:y,withISO2:T,withIOC:P}),{participantMap:R}=E,C=r_e({withMatchUps:w??n,withEvents:S??n,withDraws:U??n,withPotentialMatchUps:r,participantFilters:i,withRankingProfile:n,convertExtensions:a,withScheduleItems:o,policyDefinitions:s,tournamentRecord:l,scheduleAnalysis:u,withTeamMatchUps:d,usePublishState:f,withStatistics:m,contextFilters:h,matchUpFilters:g,participantMap:R,withOpponents:v,contextProfile:I,withSeeding:b}),{participantIdsWithConflicts:M,eventsPublishStatuses:N,derivedEventInfo:A,derivedDrawInfo:O,mappedMatchUps:k}=C,F=C.matchUps;R=C.participantMap;let x=u??r,L=({potentialMatchUps:j,scheduleConflicts:K,scheduleItems:Y,participant:X,statistics:Z,opponents:J,matchUps:ae,events:te,draws:ne})=>{let le=Object.values(ne),de=Object.values(J);return v&&le?.forEach(pe=>{pe.opponents=de.filter(ge=>ge.drawId===pe.drawId)}),je({...X,scheduleConflicts:u?Object.values(K):void 0,draws:U||n?le:void 0,events:S||n?Object.values(te):void 0,matchUps:w||n?Object.values(ae):void 0,opponents:v?de:void 0,potentialMatchUps:x?Object.values(j):void 0,statistics:m?Object.values(Z):void 0,scheduleItems:o?Y:void 0},!1,!1,!0)},$=new Map;for(let j of Object.keys(R))$.set(j,L(R[j]));let V=[...$.values()],_=s?.[$v]?.participant,B=xU({participants:V,participantFilters:i,tournamentRecord:l});if(e){let j=wt(e)?e:void 0;for(let K of B)for(let Y of K.individualParticipantIds??[]){K.individualParticipants??=[];let X=$.get(Y),Z=j?jm({template:j,source:X}):X;K.individualParticipants.push(Z)}}let G=_?B.map(j=>jm({source:j,template:_})):B;return{participantMap:t.returnParticipantMap!==!1?R:void 0,mappedMatchUps:t.returnMatchUps!==!1?k:void 0,matchUps:t.returnMatchUps!==!1?F:void 0,missingParticipantIds:E.missingParticipantIds,participantIdsWithConflicts:M,eventsPublishStatuses:N,derivedEventInfo:A,derivedDrawInfo:O,participants:G,...W}}function zm(t){let{tournamentRecord:e,scaleAttributes:i,participantId:r}=t,n=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(!r)return{error:dr};let{participant:a,tournamentId:s}=Xd({tournamentRecords:n,tournamentRecord:e,participantId:r});return a?{...Xl({participant:a,scaleAttributes:i}),tournamentId:s}:{error:ji}}function s_e(t,e){let i=t.startDate||e?.startDate,r=t.endDate||e?.endDate;return!i||!r?{error:c1e}:!Mn(i)||!Mn(r)?{error:or}:{startDate:i,endDate:r}}function lq(t,e){let i=new Date(Ze(t)),r=new Date(Ze(e)),n=r.getFullYear()-i.getFullYear(),a=r.getMonth()-i.getMonth();return(a<0||a===0&&r.getDate()<i.getDate())&&n--,n}function uq(t,e,i){return!(e!==void 0&&t<e||i!==void 0&&t>i)}function o_e(t){return/^C\d{1,2}-\d{1,2}$/.test(t.ageCategoryCode||"")}function l_e(t,e,i,r){if(o_e(e))return{valid:!0};let n=e.ageMin,a=e.ageMax;if(e.ageCategoryCode&&!n&&!a){let d=Bp({consideredDate:i,category:e});d.error||(n=d.ageMin,a=d.ageMax)}if(!n&&!a)return{valid:!0};let s=t.person?.birthDate;if(!s)return{valid:!1,reason:"Missing birthDate",details:{requiredMin:n,requiredMax:a}};let o=lq(s,i),l=lq(s,r),u=uq(o,n,a),c=uq(l,n,a);if(!u){let d=[n===void 0?null:`min: ${n}`,a===void 0?null:`max: ${a}`].filter(Boolean).join(", ");return{valid:!1,reason:`Age ${o} at event start (${i}) outside range [${d}]`,details:{birthDate:s,ageAtStart:o,ageAtEnd:l,requiredMin:n,requiredMax:a}}}if(!c){let d=[n===void 0?null:`min: ${n}`,a===void 0?null:`max: ${a}`].filter(Boolean).join(", ");return{valid:!1,reason:`Age ${l} at event end (${r}) outside range [${d}]`,details:{birthDate:s,ageAtStart:o,ageAtEnd:l,requiredMin:n,requiredMax:a}}}return{valid:!0}}function u_e(t,e,i,r){if(!e.ratingMin&&!e.ratingMax)return{valid:!0};if(!e.ratingType)return{valid:!0};let n={scaleType:"RATING",scaleName:e.ratingType,eventType:i.eventType},{scaleItem:a}=zm({tournamentRecord:r,participantId:t.participantId,scaleAttributes:n});if(!a?.scaleValue)return{valid:!1,reason:`Missing ${e.ratingType} rating`,details:{ratingType:e.ratingType,requiredMin:e.ratingMin,requiredMax:e.ratingMax}};let s;if(typeof a.scaleValue=="object"){let o=bp({element:a.scaleValue,accessor:a.scaleValue?.accessor});if(o===void 0)return{valid:!1,reason:`Cannot extract rating value from ${e.ratingType} scale item`,details:{ratingType:e.ratingType,requiredMin:e.ratingMin,requiredMax:e.ratingMax}};s=o}else s=a.scaleValue;return e.ratingMin!==void 0&&s<e.ratingMin?{valid:!1,reason:`${e.ratingType} rating ${s} below minimum ${e.ratingMin}`,details:{ratingType:e.ratingType,ratingValue:s,requiredMin:e.ratingMin,requiredMax:e.ratingMax}}:e.ratingMax!==void 0&&s>e.ratingMax?{valid:!1,reason:`${e.ratingType} rating ${s} above maximum ${e.ratingMax}`,details:{ratingType:e.ratingType,ratingValue:s,requiredMin:e.ratingMin,requiredMax:e.ratingMax}}:{valid:!0}}function c_e(t){let e=t.person;if(!e)return"Unknown";let i=e.standardGivenName||e.passportGivenName,r=e.standardFamilyName||e.passportFamilyName;return[i,r].filter(Boolean).join(" ")||"Unknown"}function d_e(t,e,i,r,n,a){let s=l_e(t,e,r,n),o=u_e(t,e,i,a);if(!s.valid||!o.valid){let l={participantId:t.participantId,participantName:c_e(t),rejectionReasons:[]};return s.valid||l.rejectionReasons.push({type:"age",reason:s.reason,details:s.details||{}}),o.valid||l.rejectionReasons.push({type:"rating",reason:o.reason,details:o.details||{}}),l}return null}function hm({participantId:t,drawDefinition:e,entryStatus:i,entryStage:r}){if(!e)return{error:$e};let n=e.entries?.find(a=>a.participantId===t&&(!i||i===a.entryStatus)&&(!r||r===a.entryStage));return t&&n}function p_e({relevantLinks:t,drawDefinition:e,provisionalPositioning:i,roundQualifiersCounts:r}){let n=0;for(let a of t){let s=tt({structureId:a.source.structureId,drawDefinition:e})?.structure;if(s?.stage===ze){let o=a.source.roundNumber,l=a.target.roundNumber,u;if(s.structureType===gn){let c=s.structures?.length??0,d=a.source.finishingPositions?.length??0;u=c*d}else u=At({matchUpFilters:{roundNumbers:[o]},structure:s,afterRecoveryTimes:!1,provisionalPositioning:i,inContext:!1}).matchUps?.length||0;r[l]||(r[l]=0),r[l]+=u,n+=u}}return n}function zv(t){let{provisionalPositioning:e,drawDefinition:i,stageSequence:r,structureId:n,stage:a}=t;if(!i)return{error:$e};let{entryProfile:s}=bU({drawDefinition:i}),o=a&&r&&s?.[a]?.stageSequence?.[r]?.qualifiersCount||a&&s?.[a]?.qualifiersCount||0,l={};if(!n)return{qualifiersCount:o,roundQualifiersCounts:l};let{structure:u}=tt({drawDefinition:i,structureId:n}),c=i.links?.filter(f=>f?.target?.structureId===u?.structureId),d=0;c?.length&&(d=p_e({relevantLinks:c,drawDefinition:i,provisionalPositioning:e,roundQualifiersCounts:l}));let p=Object.keys(l);if(p.length<=1){let f=p[0]||1;l[f]=Math.max(l[f]||0,o)}return d=Math.max(d,o),{qualifiersCount:d,roundQualifiersCounts:l}}function QP({stage:t,drawDefinition:e}){let{entryProfile:i}=bU({drawDefinition:e});return i?.[t]?.drawSize||0}function f_e(t){let{provisionalPositioning:e,drawDefinition:i,stageSequence:r,stage:n}=t,a=QP({stage:n,drawDefinition:i}),{qualifiersCount:s}=zv({provisionalPositioning:e,drawDefinition:i,stageSequence:r,stage:n});return a&&a-s}function Rae({stage:t,drawDefinition:e}){return!!(t===Cr||b2({stage:t,drawDefinition:e})&&QP({stage:t,drawDefinition:e}))}function Cae({entryStatus:t=ca,drawDefinition:e,stageSequence:i,stage:r}){if(t===Gs)return ALe({stage:r,drawDefinition:e})?{positionsAvailable:1/0,...W}:{error:uie};let n=f_e({drawDefinition:e,stageSequence:i,stage:r}),a=kLe({drawDefinition:e,stage:r}),s=Tx({entryStatus:NI,drawDefinition:e,stage:r}),o=Tx({entryStatus:ca,drawDefinition:e,stage:r}),l=s+o,u=l>=n,c=n-l;return r!==Cr&&u?{error:dx}:t===NI?s<a?{...W}:{error:dx}:{positionsAvailable:c,...W}}function L2(t){let e=He(t,[{[In]:!0,[Yre]:!0}]);if(e.error)return e;let{suppressDuplicateEntries:i=!0,entryStatus:r=ca,entryStageSequence:n,entryStage:a=Ae,ignoreStageSpace:s,drawDefinition:o,entryPosition:l,participant:u,roundTarget:c,extensions:d,extension:p,drawType:f,event:m}=t,h="addDrawEntry";if(f!==ua&&!Rae({stage:a,drawDefinition:o}))return q({result:{error:gf},stack:h});let g=Cae({stageSequence:n,stage:a,drawDefinition:o,entryStatus:r});if(!s&&!g.success&&(!f||f!==ua))return{error:g.error};if(p&&!ml({extension:p}))return q({result:{error:re},info:"Invalid extension",context:{extension:p},stack:h});let I=t.participantId||u?.participantId;if(!I)return q({result:{error:dr},stack:h});let v=r===Ec&&hm({participantId:I,drawDefinition:o,entryStatus:r}),w=a===Cr&&hm({participantId:I,drawDefinition:o,entryStage:a}),y=hm({participantId:I,drawDefinition:o}),b=r!==Ec&&a!==Cr&&y;if(b)return i?(st({payload:{drawId:o.drawId,eventId:m?.eventId,error:_b,participantId:I},topic:i2}),{...W}):q({result:{error:_b},context:{participantId:I},stack:h});if(v||w)return q({context:{invalidEntry:b,invalidLuckyLoser:v,invalidVoluntaryConsolation:w},result:{error:hM},stack:h});let S=je({entryStageSequence:n,participantId:I,entryPosition:l,entryStatus:r,entryStage:a,extensions:d});return p&&Ft({element:S,extension:p}),c&&Ft({extension:{name:"roundEntry",value:c},element:S}),o.entries??=[],o.entries.push(S),ii({drawDefinition:o}),{...W}}function m_e(t){let e="addDrawEntries",{suppressDuplicateEntries:i=!0,entryStatus:r=ca,autoEntryPositions:n=!0,ignoreStageSpace:a,participantIds:s,drawDefinition:o,stageSequence:l,stage:u=Ae,roundTarget:c,extension:d,event:p}=t,f=o.drawType===ua;if(!u)return{error:Fte};if(!o)return{error:$e};if(!Array.isArray(s))return{error:Ia};if(!f&&!Rae({stage:u,drawDefinition:o}))return{error:gf};if(d&&!ml({extension:d}))return q({result:{error:re},info:"Invalid extension",context:{extension:d},stack:e});let m=Cae({drawDefinition:o,stageSequence:l,entryStatus:r,stage:u});if(!a&&!m.success&&!f)return{error:m.error};let h=m.positionsAvailable??0;if(!a&&!f&&u!==Cr&&h<s.length)return{error:oB};let g=[],I=o.drawId,v=p?.eventId,w=s.reduce((y,b)=>{let S=r===Ec&&hm({participantId:b,drawDefinition:o,entryStatus:r}),U=u===Cr&&hm({entryStage:u,drawDefinition:o,participantId:b}),T=hm({participantId:b,drawDefinition:o});return r!==Ec&&u!==Cr&&T&&(g.push(b),i&&st({payload:{error:_b,participantId:b,eventId:v,drawId:I},topic:i2})),S||U?y.concat(b):y},[]);return g.length&&!i?q({context:{eventId:v,drawId:I,duplicateEntries:g},result:{error:_b},stack:e}):(s.filter(y=>y&&!w.includes(y)).forEach(y=>{let b={entryStageSequence:l,entryStage:u,participantId:y,entryStatus:r};d&&Ft({element:b,extension:d}),c&&Ft({extension:{name:El,value:c},element:b}),o.entries??=[],o.entries.push(b)}),n&&(o.entries=wo({entries:o.entries})),ii({drawDefinition:o}),w?.length||g?.length?{info:"some participantIds could not be added",participantIdsNotAdded:w,duplicateEntries:g,...W}:{...W})}function _2({suppressDuplicateEntries:t=!0,autoEntryPositions:e=!0,entryStageSequence:i,ignoreStageSpace:r,participantIds:n,drawDefinition:a,entryStatus:s,roundTarget:o,entryStage:l,extension:u,drawId:c,event:d}){if(!n?.length)return{error:Wd};if(!d)return{error:ps};if(!c)return{error:xo};let p=(d.entries||[]).map(yt);if(n.filter(h=>!p.includes(h)).length)return{error:Ote};if(a){let h=m_e({stageSequence:i,suppressDuplicateEntries:t,autoEntryPositions:e,stage:l,ignoreStageSpace:r,participantIds:n,drawDefinition:a,entryStatus:s,roundTarget:o,extension:u});if(h.error)return h}let{flightProfile:f}=Bi({event:d}),m=f?.flights.find(h=>h.drawId===c);return m?.drawEntries&&(n.forEach(h=>{let g=s===Ec&&dk({participantId:h,entryStatus:s,flight:m}),I=l===Cr&&dk({participantId:h,entryStage:l,flight:m});!(s!==Ec&&l!==Cr&&dk({flight:m,participantId:h}))&&!g&&!I&&m.drawEntries.push({participantId:h,entryStatus:s,entryStage:l})}),e&&(m.drawEntries=wo({entries:m.drawEntries}))),{...W}}function dk({participantId:t,entryStatus:e,entryStage:i,flight:r}){let n=r.drawEntries?.find(a=>a.participantId===t&&(!e||e===a.entryStatus)&&(!i||i===a.entryStage));return t&&n}function FU({autoEntryPositions:t=!0,participantIds:e=[],entryStatuses:i,stage:r,event:n}){let a="removeEventEntries";if(!n?.eventId)return{error:ui};if(!Array.isArray(e)||e.some(d=>!ni(d)))return q({result:{error:Co},stack:a});let s=(n.drawDefinitions??[]).flatMap(d=>Pf({drawDefinition:d}).assignedParticipantIds??[]),o=(i?.length&&n.entries?.filter(d=>d.entryStatus&&i.includes(d.entryStatus))||[]).map(yt).filter(d=>!s.includes(d)),l=(r&&n.entries?.filter(d=>d.entryStage&&d.entryStage===r)||[]).map(yt).filter(d=>!s.includes(d));if(e.length?e=e.filter(d=>(!i?.length||o.includes(d))&&(!r||l.includes(d))):o.length&&l.length?e=Li(o,l):o.length?e=o:l.length&&(e=l),e?.length&&s.some(d=>e.includes(d)))return q({result:{error:kv},stack:a});if(!e?.length)return{...W,participantIdsRemoved:[]};let u=[];n.entries=(n.entries??[]).filter(d=>{let p=!e.includes(d?.participantId);return p||u.push(d.participantId),p}),t&&(n.entries=wo({entries:n.entries}));let{flightProfile:c}=Bi({event:n});return c?.flights?.forEach(d=>{d.drawEntries=(d.drawEntries||[]).filter(p=>!e.includes(p.participantId))}),n.drawDefinitions?.forEach(d=>{d.entries=(d.entries??[]).filter(p=>!e.includes(p.participantId))}),{...W,participantIdsRemoved:u}}var Mae={[Mr]:{policyName:"matchUpActionsDefault",enabledStructures:[{stages:[],stageSequences:[],enabledActions:[],disabledActions:[]}],participants:{enforceCategory:!0,enforceGender:!0},processCodes:{substitution:["RANKING.IGNORE","RATING.IGNORE"]},substituteAfterCompleted:!1,substituteWithoutScore:!1}},qv=Mae;function h_e(t,e,i,r){return e.gender&&i&&!(Aa(e.gender)||du(e.gender))&&ln(e.gender)!==ln(t.person?.sex)?(r.push({participantId:t.participantId,sex:t.person?.sex}),!1):!0}function g_e({participantIds:t,typedParticipantIds:e,checkTypedParticipants:i}){return t.filter(r=>!i||e.includes(r))}function I_e({tournamentRecord:t,participantIds:e,event:i,entryStatus:r,genderEnforced:n,mismatchedGender:a}){function s(c,d,p){return Pi(zt)(d.eventType)&&c.participantType===It&&!pp(p)}function o(c,d,p){return d.eventType===Bt&&c.participantType===ft&&!pp(p)}function l(c,d,p,f,m){return d.eventType===Bt&&c.participantType===It&&pp(p)?d.gender&&f&&!(Aa(d.gender)||du(d.gender))&&ln(d.gender)!==ln(c.person?.sex)?(m.push({participantId:c.participantId,sex:c.person?.sex}),!1):!0:!1}function u(c,d,p){return d.eventType===_t&&(c.participantType===_t||pp(p)&&c.participantType===It)}return t?.participants?.filter(c=>e.includes(c.participantId)?s(c,i,r)&&(!i.gender||!n||Aa(i.gender)||du(i.gender)||ln(i.gender)===ln(c.person?.sex))||o(c,i,r)||l(c,i,r,n,a)?!0:s(c,i,r)&&!h_e(c,i,n,a)?!1:u(c,i,r):!1).map(c=>c.participantId)??[]}function v_e({typedParticipantIds:t,categoryRejections:e,tournamentRecord:i,startDate:r,endDate:n,event:a}){let s=[];for(let o of t){let l=i.participants?.find(u=>u.participantId===o);if(l)if(a.category){let u=d_e(l,a.category,a,r,n,i);u?e.push(u):s.push(o)}else s.push(o)}return s}function y_e({enforceCategory:t,event:e,tournamentRecord:i,typedParticipantIds:r,categoryRejections:n}){if(t&&e.category&&i){let a=s_e(e,i);if(!("error"in a)){let{startDate:s,endDate:o}=a;return v_e({typedParticipantIds:r,tournamentRecord:i,event:e,startDate:s,endDate:o,categoryRejections:n})}}return r}function b_e({validParticipantIds:t,existingIds:e,entryStatus:i,entryStage:r,extensions:n,extension:a,roundTarget:s,entryStageSequence:o,addedParticipantIdEntries:l,event:u}){t.forEach(c=>{if(!e.has(c)){let d=je({participantId:c,entryStatus:i,entryStage:r,extensions:n});a&&Ft({element:d,extension:a}),s&&Ft({extension:{name:El,value:s},element:d}),o&&(d.entryStageSequence=o),l.push(d.participantId),u.entries?.push(d)}})}function w_e({tournamentRecord:t,removedEntries:e,event:i}){if(i.eventType&&[wc,Ua].includes(i.eventType)){let r=new Set((i.entries||[]).map(l=>l.participantId)),n=(i.entries||[]).filter(l=>pp(l.entryStatus)).map(l=>l.participantId),a=t?.participants??[],s=new Set(a.filter(l=>r.has(l.participantId)&&l.participantType&&[ft,_t].includes(l.participantType)).map(l=>l.individualParticipantIds).flat(1/0)),o=n.filter(l=>s.has(l));o.length&&(e.push(...o),FU({participantIds:o,autoEntryPositions:!1,event:i}))}}function S_e(t,e){if(!Array.isArray(t.participantIds))return q({result:{error:Ia},stack:e});let i=nt(t.participantIds??[]);return t.event?i?.length?t.event?.eventId?{participantIds:i}:{error:ps}:q({result:{error:Wd},stack:e}):{error:ui}}function U_e({policyDefinitions:t,tournamentRecord:e,event:i,enforceGender:r}){let n=Dt({tournamentRecord:e,event:i}).appliedPolicies??{},a=t?.[Mr]??n?.[Mr]??qv[Mr],s=(r??a?.participants?.enforceGender)!==!1;return{matchUpActionsPolicy:a,genderEnforced:s}}function T_e(t,e,i){return t&&(!Array.isArray(t)||!t.every(r=>ml({extension:r})))||e&&!ml({extension:e})?q({context:je({extension:e,extensions:t}),result:{error:re},info:"Invalid extension(s)",stack:i}):null}function Qo(t){let{suppressDuplicateEntries:e=!0,entryStatus:i=ca,autoEntryPositions:r=!0,enforceCategory:n=!1,enforceGender:a=!0,entryStageSequence:s,policyDefinitions:o,entryStage:l=Ae,tournamentRecord:u,ignoreStageSpace:c,drawDefinition:d,roundTarget:p,extensions:f,extension:m,drawId:h,event:g}=t,I="addEventEntries",v=S_e(t,I);if("error"in v)return v;let w="participantIds"in v?v.participantIds:[],y=T_e(f,m,I);if(y)return y;let{genderEnforced:b}=U_e({policyDefinitions:o,tournamentRecord:u,event:g,enforceGender:a}),S=[],U=[],T=!!u,P=[],D,E=I_e({tournamentRecord:u,participantIds:w,event:g,entryStatus:i,genderEnforced:b,mismatchedGender:P}),R=[];E=y_e({enforceCategory:n,event:g,tournamentRecord:u,typedParticipantIds:E,categoryRejections:R});let C=g_e({participantIds:w,typedParticipantIds:E,checkTypedParticipants:T});g.entries??=[];let M=new Set(g.entries.map(O=>O.participantId||O.participant?.participantId));if(b_e({validParticipantIds:C,existingIds:M,entryStatus:i,entryStage:l,extensions:f,extension:m,roundTarget:p,entryStageSequence:s,addedParticipantIdEntries:S,event:g}),h&&!pp(l)){let O=_2({participantIds:C,suppressDuplicateEntries:e,autoEntryPositions:r,entryStageSequence:s,ignoreStageSpace:c,drawDefinition:d,entryStatus:i,roundTarget:p,entryStage:l,extension:m,drawId:h,event:g});O.error&&(D=O.error)}if(w_e({event:g,tournamentRecord:u,removedEntries:U}),C.length!==w.length)return q({context:je({categoryRejections:R.length?R:void 0,mismatchedGender:P.length?P:void 0,gender:g.gender}),result:{error:Ia},stack:I});r&&(g.entries=wo({entries:g.entries||[]}));let N=S.length,A=U.length;return q({result:{...W,addedEntriesCount:N,removedEntriesCount:A,...R.length&&{context:je({categoryRejections:R})}},stack:I,info:D})}var Nae="ADMINISTRATION",D_e="CAPTAIN",P_e="COACH",Jr="COMPETITOR",E_e="DIRECTOR",R_e="HOSPITALITY",Aae="MEDIA",kae="MEDICAL",$2="OFFICIAL",Oae="OTHER",xae="SECURITY",C_e="STRINGER",M_e="SUPERVISOR",N_e="TRANSPORT",A_e="VOLUNTEER",B2={ADMINISTRATION:Nae,CAPTAIN:D_e,COACH:P_e,COMPETITOR:Jr,DIRECTOR:E_e,HOSPITALITY:R_e,MEDIA:Aae,MEDICAL:kae,OFFICIAL:$2,OTHER:Oae,SECURITY:xae,STRINGER:C_e,SUPERVISOR:M_e,TRANSPORT:N_e,VOLUNTEER:A_e};function V2({addIndividualParticipantsToEvents:t,individualParticipantIds:e,groupingParticipantId:i,tournamentRecord:r,suppressErrors:n}){let a="removeIndividualParticipantIds";if(!r)return q({result:{error:ve},stack:a});if(!i||!e)return q({result:{error:Je},stack:a});let s=(r.participants??[]).find(c=>c.participantId===i);if(!s)return q({result:{error:ji},stack:a});if(![_t,Ya].includes(s.participantType))return q({result:{participantType:s.participantType,error:Mo},stack:a});let o=Fae({individualParticipantIds:e,groupingParticipant:s,tournamentRecord:r,suppressErrors:n}),{removed:l,error:u}=o;if(u)return q({result:o,stack:a});if(t)for(let c of r.events??[]){let d=(c.entries??[]).map(({participantId:p})=>p).filter(Boolean);if(d.includes(i)){let p=l?.filter(f=>!d.includes(f));Qo({participantIds:p,entryStatus:Us,tournamentRecord:r,event:c})}}return l&&st({topic:rn,payload:{tournamentId:r.tournamentId,participants:[s]}}),{...W,...o}}function Fae({individualParticipantIds:t=[],groupingParticipant:e,tournamentRecord:i,suppressErrors:r,mappedMatchUps:n,participants:a}){let s=[];if(!e)return{removed:s};let o=[],l=[];a||({participants:a,mappedMatchUps:n}=Ri({withMatchUps:!0,tournamentRecord:i,withEvents:!0}));let u=a?.find(({participantId:p})=>p===e.participantId)?.events?.map(({eventId:p})=>p),c=(e.individualParticipantIds??[]).filter(p=>{let f=t?.includes(p),m=f&&a?.find(g=>g.participantId===p)?.matchUps.filter(({eventId:g})=>u.includes(g)).map(({matchUpId:g})=>n?.[g]).filter(({winningSide:g,score:I})=>g||fr({score:I})),h=f&&!m?.length;if(f&&!h&&l.push(p),h){s.push(p);for(let g of i.events??[])for(let I of g.drawDefinitions??[]){let{extension:v}=ht({element:I,name:Uc}),w=v?.value[e.participantId];v&&w&&(v.value[e.participantId]=w.filter(b=>b.participantId!==p),Ft({element:I,extension:v}),hU({drawDefinition:I}));let y=An({drawDefinition:I,inContext:!1}).matchUps??[];for(let b of y){let S=b.sides??[];for(let U of S){let T=U.lineUp??[];T.find(P=>P.participantId===p)&&(U.lineUp=T.filter(P=>P.participantId!==p),Ut({tournamentId:i?.tournamentId,drawDefinition:I,matchUp:b}))}}}}else o.push(p);return!h});e.individualParticipantIds=c;let d={groupingParticipantId:e.participantId,cannotRemove:l,notRemoved:o,removed:s};return l.length&&!r&&{...d,cannotRemove:l,error:fM}||d}function nN({participantRole:t=Jr,individualParticipantIds:e=[],groupingTypes:i=[$n,Ya],tournamentRecord:r}){if(!r)return{error:ve};let n=r.participants??[],{participants:a,mappedMatchUps:s}=Ri({withMatchUps:!0,tournamentRecord:r,withEvents:!0}),o=0;return n.filter(l=>(l.participantRole===t||!l.participantRole)&&l.participantType&&i.includes(l.participantType)).forEach(l=>{let{removed:u}=Fae({groupingParticipant:l,individualParticipantIds:e,tournamentRecord:r,mappedMatchUps:s,participants:a});u&&o++}),o?W:{error:nie}}function Kh(t){let e=He(t,[{[hr]:!0},{participantIds:!0,[qn]:sn,[js]:Wd}]);if(e.error)return e;let{addIndividualParticipantsToEvents:i,tournamentRecord:r,participantIds:n}=t,a=r.participants?.length||0;if(!a)return{...W};let s=(r.events||[])?.filter(({eventType:m})=>m===ar).map(m=>m?.drawDefinitions?.map(({drawId:h})=>h)).flat(1/0),o=Ri({participantFilters:{participantIds:n},tournamentRecord:r,withDraws:!0}).participants??[],l=m=>{let h=(Ur({matchUpFilters:{drawIds:m,matchUpTypes:[Bt]},tournamentRecord:r}).matchUps??[]).flatMap(({sides:g})=>g?.map(({participantId:I})=>I||[])).filter(Boolean);return Li(h,n)},u=s?.length?l(s):[],c=o.filter(m=>m.draws?.filter(h=>(!s?.length||!s?.includes(h.drawId))&&h.positionAssignments).length);if(u?.length||c.length)return{error:kv};let d={},p={};for(let m of r.events||[]){let h=FU({participantIds:n,event:m});if(h.error)return h;d[m.eventId]=h.participantIdsRemoved}r.participants=(r.participants??[]).filter(m=>{let h=n.includes(m.participantId)||m.participantType===ft&&m.individualParticipantIds?.some(g=>n.includes(g));if(!h&&m.participantType===ar&&m.individualParticipantIds?.some(g=>n.includes(g))&&(m.individualParticipantIds=m.individualParticipantIds.filter(g=>!n.includes(g))),h&&i&&m.participantType&&[ft,_t].includes(m.participantType))for(let g of m.individualParticipantIds||[])n.includes(g)||(p[m.participantId]||(p[m.participantId]=[]),p[m.participantId].push(g));return!h});let f=a-r.participants.length;if(nN({individualParticipantIds:n,tournamentRecord:r}),i)for(let m of r.events||[]){let h=d[m.eventId].map(g=>p[g]||[]).flat();Qo({participantIds:h,entryStatus:Us,tournamentRecord:r,event:m})}return f&&st({payload:{participantIds:n,tournamentId:r.tournamentId},topic:r2}),f?{...W,participantsRemovedCount:f}:{error:fM}}function Lae({selected:t=!0,drawDefinition:e,entryStatuses:i,drawId:r,event:n,stage:a}){let s=n.entries??[];if(r){let{flightProfile:l}=Bi({event:n}),u=l?.flights?.find(c=>c.drawId===r);u?s=u.drawEntries:e.entries&&(s=e?.entries)}let o=s.filter(l=>(!i?.length||!l.entryStatus||i.includes(l.entryStatus))&&(!a||!l.entryStage||l.entryStage===a)&&(!t||l.entryStatus&&uo.includes(l.entryStatus)));return{entries:s,stageEntries:o}}function _ae({removeGroupParticipant:t,tournamentRecord:e,drawDefinition:i,participantId:r,drawId:n,stage:a,event:s}){let o="destroyGroupEntry";if(!e)return{error:ve};if(!r)return q({result:{error:dr},stack:o});if(!s)return{error:ui};if(!s.eventType||![wc,Ua].includes(s.eventType))return q({result:{error:cu},stack:o});let l=e.participants??[],u=l.find(I=>I.participantId===r);if(!u)return q({result:{error:ji},stack:o});if(!u.participantType||![ft,$n].includes(u.participantType)||u.participantType===$n&&s.eventType!==Ua||u.participantType===ft&&s.eventType!==wc)return{error:Mo};let c=(s.entries??[]).find(I=>I.participantId===r);if(!c)return{error:lie};let{stageEntries:d}=Lae({selected:!1,drawDefinition:i,drawId:n,event:s,stage:a}),p=d.map(yt),f=l.filter(({participantId:I})=>p.includes(I)).map(({individualParticipantIds:I})=>I).flat().filter(Boolean),m=u.individualParticipantIds?.filter(I=>Xo(I,f).length===1),h=FU({participantIds:[r],event:s});if(h.error||m?.length&&(h=Qo({participantIds:m,entryStatus:Us,entryStage:c.entryStage,tournamentRecord:e,drawDefinition:i,drawId:n,event:s}),h.error))return h;let g;return t&&Kh({participantIds:[r],tournamentRecord:e}).success&&(g=!0),{...W,participantRemoved:g}}function j2({removeGroupParticipant:t,tournamentRecord:e,drawDefinition:i,participantId:r,drawId:n,event:a}){return _ae({removeGroupParticipant:t,tournamentRecord:e,drawDefinition:i,participantId:r,drawId:n,event:a})}function $ae(t){if(!t.tournamentRecord)return{error:ve};let{participantIds:e,...i}=t,r=0,n=[];for(let a of e){let s=_ae({participantId:a,...i});s.success&&(r+=1),s.error&&n.push(s.error)}return r?{destroyedCount:r,...W}:{error:n}}function rw(t){let{tournamentRecord:e,replaceWithBye:i,drawDefinition:r,destroyPair:n,entryStatus:a,matchUpsMap:s,drawId:o}=t,l="removeDrawPositionAssignment",u=AU(t);if(u.error)return q({result:u,stack:l});let{participantId:c}=u,{drawPosition:d,event:p,structureId:f}=t,m=Dt({tournamentRecord:e,drawDefinition:r,event:p}).appliedPolicies??{};if([Gs,bu].includes(a)&&c){let{tournamentRecord:g}=t,{participant:I}=Xd({tournamentRecord:g,participantId:c}),{participantType:v,individualParticipantIds:w}=I??{};if(n&&v===ft){let y=j2({tournamentRecord:g,drawDefinition:r,participantId:c,event:p});if(y.error)return q({result:y,stack:l});w&&JP({participantIds:w,tournamentRecord:g,drawDefinition:r,entryStatus:a,drawId:o,event:p})}else JP({participantIds:[c],tournamentRecord:g,drawDefinition:r,entryStatus:a,drawId:o,event:p})}if(i){let g=Ja({tournamentRecord:e,drawDefinition:r,drawPosition:d,structureId:f,matchUpsMap:s,event:p});if(g.error)return q({result:g,stack:l})}let{structure:h}=tt({drawDefinition:r,structureId:f});return m2({structure:h,drawPositions:[d]}),gU({appliedPolicies:m,drawDefinition:r,positionAction:{name:"removeDrawPositionAssignment",replaceWithBye:i,drawPosition:d,entryStatus:a,structureId:f}}),u}function Bae(t){return Object.assign(t,{entryStatus:bu}),rw(t)}var dd=({finishingPosition:t=_h,hasExistingDrawDefinition:e,qualifyingRoundNumber:i,structureAbbreviation:r,seedAssignments:n=[],stageSequence:a=1,qualifyingOnly:s,structureOrder:o,seedingProfile:l,matchUpFormat:u,structureType:c,structureName:d,matchUps:p=[],matchUpType:f,structureId:m,roundOffset:h,roundLimit:g,stageOrder:I,structures:v,tieFormat:w,stage:y})=>{let b={structureId:m??Ct(),structureAbbreviation:r,finishingPosition:t,seedAssignments:n,matchUpFormat:u,stageSequence:a,structureName:d};(s||e&&w)&&(b.tieFormat=w),o&&(b.structureOrder=o),c&&(b.structureType=c),l&&(typeof l=="string"?b.seedingProfile=l:typeof l=="object"&&typeof l.positioning=="string"&&(b.seedingProfile=l.positioning)),f&&(b.matchUpType=f),h&&(b.roundOffset=h),I&&(b.stageOrder=I),g&&(b.roundLimit=g),y&&(b.stage=y),i&&(b.qualifyingRoundNumber=i);let S=p.flatMap(({drawPositions:U})=>U).filter(Boolean);return v?b.structures=v:(b.matchUps=p,b.positionAssignments=nt(S).sort((U,T)=>U-T).map(U=>({drawPosition:U}))),b},ss=dd;function Mx(t){return ni(t)?t.split(" ").map(e=>e.split("").map((i,r)=>r?i.toLowerCase():i.toUpperCase()).join("")).join(" "):t}function Qr(t){return ni(t)?Mx(t.replace(/_/g," ")):""}function G2({structureName:t=Qr(Cr),structureAbbreviation:e,drawDefinition:i,matchUpType:r,structureId:n}){if(!i)return{error:$e};let a=ss({stage:Cr,structureAbbreviation:e,structureName:t,matchUps:[],structureId:n,matchUpType:r});return i.structures||(i.structures=[]),i.structures.push(a),ii({drawDefinition:i,structureIds:[a.structureId]}),{...W}}function k_e({size:t}){let e=[t],i=t;for(;i/2===Math.floor(i/2);)i=i/2,e.push(i);return e.includes(1)||e.push(1),e.sort(nr),e.reverse(),e}function O_e({blockPattern:t,index:e}){let i=0;for(let r of t){if(i===e)return r;let n=0;for(;n<r.length;){if(i===e)return r;i+=1,n++}}}function x_e({positioning:t,size:e}){let i=k_e({size:e}),r=[],n=[],a=p=>p[0],s=p=>p[p.length-1],o=(p,f)=>(t&&[oU,EM,Vp].includes(t)&&f%2?s(p):a(p))||a(p),l=(p,f)=>{if(p.every(m=>!n.includes(m))){let m=o(p,f);return n.push(m),m}},u=p=>{let f=p.filter(m=>!n.includes(m));if(f.length)return n.push(...f),f},c=(p,f)=>{let m=o(p,f);if(!n.includes(m))return n.push(m),m},d=Ce(1,e+1);for(let p of i)if(p===1){let f=wr(d,2),m=f.map(l).filter(Boolean);m.length&&r.push(m);let h=f.flatMap(u).filter(Boolean);h.length&&r.push(h)}else{let f=wr(d,p).map(c).filter(Boolean);f.length&&r.push(f)}return{divisions:i,divisionGroupings:r}}function H2({drawPositions:t}){if(!t?.length)return{error:XS};let e=n=>t.filter(a=>a!==n).map(a=>[n,a]),i=[].concat(...(t??[]).map(e)),r=nt(i.map(aN)).map(n=>n.split("|").map(a=>+a));return{groupMatchUps:i,uniqueMatchUpGroupings:r}}function aN(t=[]){return!Array.isArray(t)||!t.length?"":[...t].sort(nr).join("|")}function Vae({groupSize:t,drawPositionOffset:e}){if(!t)return[];let i=d=>[...Array(d)].map((p,f)=>f),r=i(2*Math.round(t/2)+1).slice(1),n=i(r.length-1).map(()=>[]),a=r.slice(0,r.length/2),s=r.slice(r.length/2);r.slice(1).forEach((d,p)=>{a.forEach((g,I)=>{n[p].push([a[I],s[I]])});let f=a.shift(),m=a.pop(),h=s.shift();a=[f,h,...a].filter(Boolean),s=[...s,m].filter(Boolean)});let o=a.shift(),l=a.pop(),u=s.shift();a=[o,u,...a].filter(Boolean),s=[...s,l].filter(Boolean);let c=d=>d[0].reduce((p,f)=>p+f);return[...n].reverse().sort((d,p)=>c(d)-c(p)).map(d=>d.filter(p=>p.every(f=>f<=t)).map(p=>{let f=p.map(m=>m+e);return aN(f)}))}function F_e({rounds:t,hash:e}){return t?.length?t?.reduce((i,r,n)=>r.includes(e)?n+1:i,void 0):{error:Je}}var L_e={getRoundRobinGroupMatchUps:H2,determineRoundNumber:F_e,drawPositionsHash:aN,groupRounds:Vae};function LU(t){let{hasExistingDrawDefinition:e,groupNameBase:i="Group",playoffAttributes:r,stageSequence:n=1,structureOptions:a,appliedPolicies:s,qualifyingOnly:o,seedingProfile:l,stage:u=Ae,matchUpType:c,roundTarget:d,structureId:p,groupNames:f,tieFormat:m,drawSize:h,idPrefix:g,isMock:I,uuids:v}=t,w=t.structureName??r?.["0"]?.name??Qr(Ae),{groupCount:y,groupSize:b}=__e({structureOptions:a,appliedPolicies:s,drawSize:h}),S=Gp,U,T=Ce(1,y+1).map(D=>{let E=$_e({groupSize:b,structureOrder:D,matchUpType:c,drawSize:h,idPrefix:g,isMock:I});U=Array.isArray(E)?Math.max(...E.map(({roundNumber:C})=>C??0)):0;let R=f?.[D-1]??`${i} ${D}`;return dd({structureId:v?.pop(),hasExistingDrawDefinition:e,structureType:RM,finishingPosition:S,qualifyingOnly:o,structureOrder:D,structureName:R,tieFormat:m,matchUps:E})}),P=dd({structureId:p??v?.pop(),hasExistingDrawDefinition:e,structureType:gn,finishingPosition:S,seedingProfile:l,structureName:w,stageSequence:n,structures:T,tieFormat:m,stage:u});return d&&Ft({extension:{name:El,value:d},element:P}),{structures:[P],maxRoundNumber:U,groupCount:y,links:[],groupSize:b,...W}}function __e({appliedPolicies:t,structureOptions:e,drawSize:i}){let r=e?.groupSize,n=e?.groupSizeLimit||8,{validGroupSizes:a}=_U({groupSizeLimit:n,drawSize:i}),s=a&&Math.max(...a);r&&a?.includes(r)||(r&&r>4||!a?.includes(4)?r=s:r=4);let o=Math.ceil(i/r);return{groupSize:r,groupCount:o}}function _U(t){let{groupSizeLimit:e=10,drawSize:i=0}=t??{},r=Ce(3,e+1).filter(n=>{let a=Math.ceil(i/n),s=a*n-i,o=Math.ceil(i/a),l=Math.ceil(s/a);return(!s||s<n)&&o===n&&o>=3&&l<2});return{...W,validGroupSizes:r}}function $_e({structureOrder:t,matchUpType:e,groupSize:i,drawSize:r,idPrefix:n,isMock:a,uuids:s}){let o=(t-1)*i,l=Ce(1+o,i+1+o),u=H2({drawPositions:l}).uniqueMatchUpGroupings??[],c=Vae({groupSize:i,drawPositionOffset:o});return u.map(p).sort((f,m)=>(f.roundNumber??1/0)-(m.roundNumber??1/0));function d(f){return c.reduce((m,h,g)=>h.includes(f)?g+1:m,void 0)}function p(f){let m=aN(f),h=d(m),g=[1,r],I=B_e({structureOrder:t,drawPositions:f,roundNumber:h,idPrefix:n,uuids:s}),v={matchUpStatus:h?_i:"BYE",matchUpType:e,finishingPositionRange:{winner:g,loser:g},drawPositions:f,roundNumber:h,matchUpId:I};return a&&(v.isMock=!0),v}}function B_e({structureOrder:t,drawPositions:e,roundNumber:i,idPrefix:r,uuids:n}){return r?`${r}-${t}-${i}-DP-${e.join("-")}`:n?.pop()||Ct()}function W2(t){let{roundRobinGroupsCount:e,participantsCount:i,cluster:r}=t;if(!lt(i))return{seedBlocks:void 0,...q({result:{error:re},context:{participantsCount:i},stack:"getSeedBlocks"})};let n=Cv(i);if(e){let f=Math.min(e,n),m=[],h=1;for(Ce(0,f).forEach(()=>{m.push([h]),h++});h<n;){let g=Ce(h,h+f);h+=f,m.push(g)}return{...W,seedBlocks:m}}let a=Ce(1,n+1),s=[],o=n/2;for(;o>1;){let f=wr(a,o),m=f.length;f.forEach((h,g)=>{let I,v=g<m/2,w=g%2===0,y=h[0],b=h[h.length-1];r&&m>4?m===8?I=v?b:y:I=w?y:b:I=v?y:b,xn(h,s)||s.push(I)}),o=o/2}let l=a.filter(f=>!s.includes(f));for(;l.length;)l.length%2===0?s.push(l.pop()):s.push(l.shift());let u=Ce(0,20).map(f=>Math.pow(2,f));u.unshift(1);let c=u.indexOf(n),d=0,p=[];return Ce(0,c).forEach(f=>{p.push(s.slice(d,d+u[f])),d+=u[f]}),{...W,seedBlocks:p}}function z2({roundRobinGroupsCount:t,drawSize:e}){let i="getSeedGroups";if(!lt(e))return{seedGroups:void 0,...q({result:{error:re},context:{drawSize:e},stack:i})};if(t){if(!lt(t))return{seedGroups:void 0,...q({context:{roundRobinGroupsCount:t},result:{error:re},stack:i})};let r=1,n=Math.floor(e/t);return{seedGroups:Ce(0,n).map(()=>{let a=Ce(r,r+t);return r+=t,a})}}else{let{seedBlocks:r}=W2({participantsCount:e,roundRobinGroupsCount:t}),n=0;return{seedGroups:(r||[]).map(a=>(a||[]).map(()=>(n+=1,n)))}}}function q2({roundRobinGroupsCount:t,participantsCount:e}){if(t){let{validGroupSizes:n}=_U({drawSize:e});if(!n?.map(a=>Math.ceil(e/a))?.includes(t))return q({context:{roundRobinGroupsCount:t},result:{error:re}})}let{seedGroups:i}=z2({drawSize:e,roundRobinGroupsCount:t}),r=i?.map(n=>Math.min(...n))||[];return{...W,seedingThresholds:r}}function kI(t){if(!t)return 1/0;if(lt(t))return Ke(t);let e=t.split("-")[0];return lt(e)?Ke(e):1/0}function Xh({provisionalPositioning:t,returnAllProxies:e,appliedPolicies:i,seedingProfile:r,drawDefinition:n,allPositions:a,structure:s}){let o=[];if(!s)return{error:hf};let{matchUps:l,roundMatchUps:u}=At({matchUpFilters:{roundNumbers:[1]},provisionalPositioning:t,structure:s}),{seedAssignments:c}=hs({provisionalPositioning:t,returnAllProxies:e,drawDefinition:n,structure:s}),{positionAssignments:d}=pr({structure:s}),p=d?.length,f=c?.length??0,m=[],h=Object.keys(u).map(A=>Number.parseInt(A)).sort((A,O)=>A-O).map(A=>{let O=u[A].map(F=>F.drawPositions).flat(1/0).filter(Boolean),k=O.filter(F=>!m.includes(F));return m=m.concat(...O),k}).filter(A=>A.length).reverse(),g=h.pop()??[],I=g&&Math.min(...g)-1||0;r=r??i?.seeding?.seedingProfile;let v=g?.length||0,w=h.filter(A=>A.filter(O=>O<=f).length),{stage:y,structureType:b,roundLimit:S}=s,U=b===gn,T=!U&&h?.length,P=!U&&y===ze&&S,D=w.flat(1/0),E=T?D?.length:0,R=a?p:f,C=w2({drawDefinition:n,structure:s,matchUps:l}),M=C?0:!T&&R||R&&D.length<R&&R-D.length||0;if(P){let A=s?.matchUps?s.matchUps.filter(({roundNumber:k})=>k===s.roundLimit).length:0,O=g.length/A;if(!T){let k=$U(r),F=wr(g,O),x=1,L=Ce(0,F[0].length).map(()=>{let $=Ce(x,x+F.length);return x+=F.length,$});({validSeedBlocks:o}=jae({drawPositionBlocks:F,nonRandom:r?.nonRandom,positioning:k,seedGroups:L}))}}else U?{validSeedBlocks:o}=V_e({nonRandom:r?.nonRandom,seedingProfile:r,structure:s}):T?o=w.map(A=>({seedNumbers:A,drawPositions:A})):C&&wr(g,2).map((A,O)=>({drawPositions:[A[0]],seedNumbers:[O+1]})).forEach(A=>o.push(A));if(!U&&!C&&!P){let{blocks:A}=j_e({drawPositionOffset:I,seedNumberOffset:E,seedCountGoal:M,seedingProfile:r,baseDrawSize:v});A.forEach(O=>o.push(O))}let N=o.flatMap(A=>A.drawPositions).reduce((A,O)=>g?.includes(O)&&A,!0);return!C&&!T&&!U&&!N?{error:Mte,validSeedBlocks:[],isContainer:U,isFeedIn:T}:{isLuckyStructure:C,validSeedBlocks:o,isContainer:U,isFeedIn:T}}function V_e({seedingProfile:t,structure:e,nonRandom:i}){let r=e.structures||[],n=r.length,a=Kt({structure:e})?.positionAssignments,s=$U(t),o=a?.length??0,{seedGroups:l}=z2({roundRobinGroupsCount:n,drawSize:o}),u=r.map(c=>Kt({structure:c}).positionAssignments?.map(d=>d.drawPosition));return jae({drawPositionBlocks:u,positioning:s,seedGroups:l,nonRandom:i})}function jae({drawPositionBlocks:t,positioning:e,seedGroups:i,nonRandom:r}){let n=[],{divisionGroupings:a}=x_e({size:i.length,positioning:e}),s=[];return i.forEach((o,l)=>{let u=O_e({blockPattern:a,index:l});o.forEach((c,d)=>{let p=l%2?t.length-d-1:d,f=t[p].slice().filter((h,g)=>u.includes(g+1)&&h);e!==Vp?f=r?f:Cn(f):l%2&&f.reverse();let m=f.find(h=>!s.includes(h));m&&(s.push(m),n.push({drawPositions:[m],seedNumbers:[c]}))})}),{validSeedBlocks:n}}function j_e(t){let{drawPositionOffset:e=0,roundRobinGroupsCount:i,seedNumberOffset:r=0,seedingProfile:n,seedCountGoal:a,baseDrawSize:s}=t,o,l=[],{seedBlocks:u}=W2({cluster:[oU,EM].includes($U(n)),participantsCount:s,roundRobinGroupsCount:i});o=0;for(let c of u){if(o+1>a)break;let d=c.map(f=>f+e),p=G_e(o+1,c.length).map(f=>+f+r);o+=c.length,l.push({drawPositions:d,seedNumbers:p})}return{blocks:l}}function G_e(t,e){return Array.from(new Array(e),(i,r)=>r+t)}function ZP({appliedPolicies:t,drawDefinition:e,seedBlockInfo:i,drawPosition:r,structureId:n,seedNumber:a}){let{structure:s}=tt({drawDefinition:e,structureId:n});t??=Dt({drawDefinition:e}).appliedPolicies;let o=i?.validSeedBlocks;return!o&&s&&(o=Xh({appliedPolicies:t,drawDefinition:e,structure:s})?.validSeedBlocks),t?.seeding?.validSeedPositions?.ignore?!0:t?.seeding?.validSeedPositions?.strict?(o.find(l=>l.seedNumbers.includes(a))?.drawPositions||[]).includes(r):o.flatMap(l=>l.drawPositions).includes(r)}function Gae(t){let{provisionalPositioning:e,drawDefinition:i,seedingProfile:r,seedBlockInfo:n,structureId:a,randomize:s}=t,{structure:o}=tt({drawDefinition:i,structureId:a}),{seedAssignments:l}=hs({returnAllProxies:t.returnAllProxies,provisionalPositioning:e,drawDefinition:i,structure:o}),{positionAssignments:u}=pr({structure:o}),c=u?.filter(R=>R.participantId??R.bye??R.qualifier)?.map(R=>R.drawPosition).filter(Boolean),{appliedPolicies:d}=Dt({drawDefinition:i}),p=(n?.validSeedBlocks||o&&Xh({returnAllProxies:t.returnAllProxies,provisionalPositioning:e,appliedPolicies:d,drawDefinition:i,seedingProfile:r,structure:o})?.validSeedBlocks||[]).find(R=>R.drawPositions.filter(C=>!c?.includes(C)).length),f=l?.map(R=>R.participantId).filter(Boolean),m=u?.map(R=>R.participantId).filter(Boolean),h=f?.filter(R=>m?.includes(R)),g=f?.filter(R=>!m?.includes(R)),I=l?.filter(R=>g?.includes(R.participantId)),v=l?.filter(R=>!R.participantId),w=(I?.length&&I.length>0?I.length:v?.length??0)&&p?.drawPositions.filter(R=>!c?.includes(R))||[],y=s?Cn(w):w,b=[],S=y.map(()=>{let R=E(I,b)?.participantId;return R&&b.push(R),R}).filter(Boolean),U=l?.filter(R=>h?.includes(R.participantId)).map(R=>R.seedNumber),T=(p?.seedNumbers||[]).filter(R=>!U?.includes(R)),P=l?.filter(R=>T.includes(R.seedNumber)).map(R=>R.participantId),D=d?.seeding?.duplicateSeedNumbers;return{nextSeedBlock:p,unplacedSeedParticipantIds:typeof D!="boolean"||D?S:P,unplacedSeedNumbers:T,unfilledPositions:y,unplacedSeedAssignments:I};function E(R,C){let M=R.filter(O=>!C.includes(O.participantId)),N=Math.min(...M.map(O=>kI(O.seedValue))),A=M.filter(O=>kI(O.seedValue)===N);return Cn(A).pop()}}function $U(t){if(typeof t=="string")return t;if(typeof t=="object")return t.positioning}function Yv({provisionalPositioning:t,tournamentRecord:e,drawDefinition:i,seedingProfile:r,participantId:n,seedBlockInfo:a,structureId:s,seedNumber:o,seedValue:l,eventId:u,event:c}){let d="assignSeed",{structure:p}=tt({drawDefinition:i,structureId:s}),{positionAssignments:f}=pr({structure:p}),m=hs({provisionalPositioning:t,drawDefinition:i,structure:p}).seedAssignments,h=m.map(b=>b.seedNumber),g=hm({drawDefinition:i,participantId:n});if(n&&!g)return q({result:{error:Co},context:{participantId:n},stack:d});let I=c?Bi({event:c}).flightProfile?.flights?.length:0,v=I&&I>1,w=f?.find(b=>b.participantId===n)?.drawPosition;if(w&&!ZP({drawPosition:w,drawDefinition:i,seedBlockInfo:a,structureId:s,seedNumber:o}))return q({result:{error:X$},context:{assignedDrawPosition:w},info:"invalid seed position",stack:d});h.includes(o)||m.push({seedNumber:o,seedValue:l});let y;return m.forEach(b=>{b.participantId===n&&b.seedNumber!==o&&(b.participantId=void 0),b.seedNumber===o&&(b.participantId=n,!r?.groupSeedingThreshold&&!v&&(b.seedValue=l??o),y=!0)}),y?(Pne({tournamentId:e?.tournamentId,drawDefinition:i,structure:p,eventId:u}),{...W}):q({result:{error:Cte},stack:d})}function Y2({inContextTargetMatchUp:t,drawPositionSideIndex:e,teamParticipantId:i,tournamentRecord:r,drawDefinition:n,matchUp:a,event:s}){let o=t?.sides?.[e]?.sideNumber,l=o&&a.sides?.find(p=>p.sideNumber===o),{extension:u}=ht({element:n,name:Uc}),c=u?.value||{},d=Oe(c[i],!1,!0);if(l)a?.sides?.forEach(p=>{p.sideNumber===o&&(p.lineUp=d)});else{a.sides=[1,2].map(f=>({...a.sides?.find(m=>m.sideNumber===f)??{},sideNumber:f}));let p=a.sides.find(f=>f.sideNumber===o);p&&(p.lineUp=d)}Ut({tournamentId:r?.tournamentId,context:"updateSidLineUp",eventId:s?.eventId,drawDefinition:n,matchUp:a})}function Hae(t){let{sourceMatchUp:e}=t,{targetMatchUp:i,structure:r,matchUpsMap:n,drawPosition:a}=t,s=i.roundNumber>1&&i.roundNumber-1,o=Pd({structureId:r.structureId,matchUpsMap:n});Ht({method:"getPairedPreviousMatchUpIsDoubleExit",color:"brightcyan",keyColors:{structureId:"brightyellow",sourceMatchUpId:"brightmagenta"},structureId:r.structureId?.slice(0,8),targetMatchUpId:i.matchUpId,targetRound:[i.roundNumber,i.roundPosition],previousRoundNumber:s,sourceMatchUpId:e?.matchUpId,sourceStructureId:e?.structureId?.slice(0,8),sourceRound:e?[e.roundNumber,e.roundPosition]:void 0,drawPosition:a,structureMatchUpCount:o?.length}),e&&e.structureId!==r.structureId&&a?(Ht({method:"getPairedPreviousMatchUpIsDoubleExit",color:"cyan",info:"cross_structure_sourceMatchUp_resolving_in_target",originalSourceId:e?.matchUpId,originalSourceStructure:e?.structureId?.slice(0,8),targetStructure:r.structureId?.slice(0,8)}),e=o.find(({drawPositions:m,roundNumber:h})=>h===s&&m?.includes(a)),Ht({method:"getPairedPreviousMatchUpIsDoubleExit",color:"cyan",info:"resolved_cross_structure_sourceMatchUp",resolvedMatchUpId:e?.matchUpId,resolvedRound:e?[e.roundNumber,e.roundPosition]:void 0,resolvedStatus:e?.matchUpStatus})):!e&&a&&(e=o.find(({drawPositions:m,roundNumber:h})=>h===s&&m?.includes(a)),Ht({method:"getPairedPreviousMatchUpIsDoubleExit",color:"cyan",info:"resolved_sourceMatchUp_from_drawPosition",resolvedMatchUpId:e?.matchUpId,resolvedRound:e?[e.roundNumber,e.roundPosition]:void 0,resolvedStatus:e?.matchUpStatus}));let l=e?.roundPosition,u=l%2?1:-1,c=l+u,d=s&&o.find(({roundNumber:m,roundPosition:h})=>m===s&&h===c),p=d?.matchUpStatus,f=[Si,Wi].includes(p);return Ht({method:"getPairedPreviousMatchUpIsDoubleExit",color:f?"brightred":"brightgreen",keyColors:{pairedMatchUpId:"brightcyan",isDoubleExit:f?"brightred":"brightgreen"},sourceRoundPosition:l,offset:u,pairedRoundPosition:c,pairedMatchUpId:d?.matchUpId,pairedRound:d?[d.roundNumber,d.roundPosition]:void 0,pairedStatus:p,isDoubleExit:f}),{pairedPreviousMatchUp:d,pairedPreviousMatchUpIsDoubleExit:f}}function H_e({drawPosition:t,drawPositions:e}){let i=!1,r=!!e?.includes(t);return{updatedDrawPositions:r?e||[]:[...e,void 0,void 0].slice(0,2).map(n=>!n&&!r?(r=!0,i=!0,t):n).sort(nr).filter(Boolean),positionAdded:i,positionAssigned:r}}function Wae({structureId:t,matchUpsMap:e,matchUp:i}){let r=i?.roundPosition,n=r%2?1:-1,a=r+n;return{pairedPreviousMatchUp:Pd({matchUpsMap:e,structureId:t}).find(({roundNumber:s,roundPosition:o})=>s===i?.roundNumber&&o===a)}}function zae({inContextDrawMatchUps:t,sourceMatchUpStatus:e,sourceMatchUpId:i,matchUpsMap:r,matchUp:n}){let a=t.find(o=>o.matchUpId===i),{pairedPreviousMatchUp:s}=Wae({structureId:a?.structureId,matchUp:a,matchUpsMap:r});if(a&&s){let o=s?.matchUpId,l=t.find(c=>c.matchUpId===o),u=a?.structureId===l?.structureId?a?.roundPosition<l?.roundPosition&&1||2:a.structureId===l?.structureId&&2||1;n.matchUpStatusCodes=(n.matchUpStatusCodes??[]).map(c=>{let d=ni(c)||!isNaN(c)?{code:c}:c;return d.sideNumber===u?{...d,previousMatchUpStatus:e}:d})}}function vD({inContextDrawMatchUps:t,drawPosition:e,matchUpId:i}){let r=t.filter(({winnerMatchUpId:n,loserMatchUpId:a})=>a===i||n===i).sort((n,a)=>n.roundPosition-a.roundPosition);return t.find(n=>n.matchUpId===i).feedRound?1:r.reduce((n,a,s)=>a.drawPositions?.includes(e)?s+1:n,void 0)}function gm({inContextDrawMatchUps:t,sourceMatchUpStatus:e,tournamentRecord:i,sourceMatchUpId:r,drawDefinition:n,matchUpStatus:a,drawPosition:s,matchUpsMap:o,matchUpId:l,event:u}){let c="assignMatchUpDrawPosition";o||(o=Or({drawDefinition:n})),t||(t=Zi({inContext:!0,drawDefinition:n,matchUpsMap:o}).matchUps??[]);let d=t.find(C=>C.matchUpId===l),p=d?.structureId,f=n?.structures?.find(C=>C.structureId===p);if(!f)return{error:vi};let m=o?.drawMatchUps?.find(C=>C.matchUpId===l),h=m?.drawPositions??[],{positionAdded:g,positionAssigned:I,updatedDrawPositions:v}=H_e({drawPositions:h,drawPosition:s}),{positionAssignments:w}=Kt({drawDefinition:n,structure:f}),y=w?.filter(C=>v.includes(C.drawPosition))?.find(({bye:C})=>C),b=m?.matchUpStatus&&Lr(m.matchUpStatus)&&v.filter(Boolean).length<2;a=y&&"BYE"||a||b&&m.matchUpStatus||m?.matchUpStatus&&[Si,Wi].includes(m.matchUpStatus)&&m.matchUpStatus||_i;let S=!!(Lr(m?.matchUpStatus)&&m?.winningSide);if(m&&g){t=Zi({inContext:!0,drawDefinition:n,matchUpsMap:o}).matchUps??[];let C=b&&vD({inContextDrawMatchUps:t,drawPosition:s,matchUpId:l})||S&&m.winningSide||void 0;m?.matchUpStatusCodes&&zae({inContextDrawMatchUps:t,sourceMatchUpStatus:e,sourceMatchUpId:r,matchUpsMap:o,matchUp:m}),Object.assign(m,{drawPositions:v,winningSide:C,matchUpStatus:S?m?.matchUpStatus:a}),Ut({tournamentId:i?.tournamentId,eventId:d?.eventId,context:c,drawDefinition:n,matchUp:m})}let U=Fn({inContextDrawMatchUps:t,inContextMatchUp:d,drawDefinition:n,matchUpId:l}),{targetMatchUps:{winnerMatchUp:T,loserMatchUp:P,loserTargetDrawPosition:D},targetLinks:{loserTargetLink:E}}=U,R=Pd({structureId:f.structureId,matchUpsMap:o});if(I&&y){if(T)if(["BYE",Si,Wi].includes(a)){let C=gm({matchUpId:T.matchUpId,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:n,drawPosition:s,matchUpsMap:o});if(C.error)return C}else{let{structureId:C}=T;C!==f.structureId&&console.log("winnerMatchUp in different structure... participant is in different targetDrawPosition")}}else if(I&&S){if(T){let C=gm({matchUpId:T.matchUpId,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:n,drawPosition:s,matchUpsMap:o});if(C.error)return C}}else if(T&&d&&!d.feedRound){let{pairedPreviousMatchUpIsDoubleExit:C}=Hae({targetMatchUp:m,drawPosition:s,matchUpsMap:o,structure:f});if(C){let M=gm({matchUpId:T.matchUpId,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:n,drawPosition:s,matchUpsMap:o});if(M.error)return M}}if(m?.matchUpType===ei){let C=t?.find(({matchUpId:A})=>A===m.matchUpId),M=(C?.sides??[]).reduce((A,O,k)=>O.drawPosition===s?k:A,void 0),N=w?.find(A=>A.drawPosition===s)?.participantId;N&&M!==void 0&&Y2({inContextTargetMatchUp:C,drawPositionSideIndex:M,teamParticipantId:N,tournamentRecord:i,drawDefinition:n,matchUp:m})}if(E?.linkCondition===fl&&v.filter(Boolean).length===2&&!y&&R.filter(({drawPositions:C,roundNumber:M})=>M===1&&xn(C,v)).every(({matchUpStatus:C})=>[Oi,Sr].includes(C))&&P){let{structureId:C}=P,M=Ja({drawPosition:D,tournamentRecord:i,drawDefinition:n,structureId:C,matchUpsMap:o,event:u});if(M.error)return M}return I?{...W}:q({result:{error:bI},context:{drawPosition:s},stack:c})}function qae({inContextDrawMatchUps:t,drawDefinition:e,assignments:i,matchUpsMap:r,structure:n}){let a=jv({drawDefinition:e})?.containedStructures?.[n.structureId]?.map(({structureId:c})=>c)||[];a.push(n?.structureId);let s=i?.map(({drawPosition:c})=>c)||[],o=t?.filter(c=>a.includes(c.structureId)&&Li(c.drawPositions??[],s).length)??[],l=o.map(({matchUpId:c})=>c),u=r?.drawMatchUps?.filter(c=>l.includes(c.matchUpId))??[];return{drawPositions:s,matchUps:u,targetMatchUps:o}}function K2({lineUp:t}){if(!Array.isArray(t))return;let e={};return nt(t.flatMap(({collectionAssignments:i})=>i?.map(({collectionId:r,collectionPosition:n})=>[r,n].join("|"))).filter(Boolean)).forEach(i=>{let[r,n]=i.split("|"),a=parseInt(n),{assignedParticipantIds:s}=XP({collectionPosition:a,collectionId:r,lineUp:t});s.forEach(o=>{e[o]||(e[o]=[]),e[o].push({collectionId:r,collectionPosition:a})})}),Object.keys(e).map(i=>({participantId:i,collectionAssignments:e[i]}))}function qp(t){return`${t} must be an array`}function sN({lineUp:t,tieFormat:e}){let i=[];if(!Array.isArray(t))return i.push(qp("lineUp")),{valid:!1,errors:i,error:re};let r=t.every(a=>{if(typeof a!="object")return i.push("lineUp entries must be objects"),!1;let{participantId:s,collectionAssignments:o}=a;return s?typeof s!="string"?(i.push("participantIds must be strings"),!1):Array.isArray(o)?o.every(l=>{if(typeof l!="object")return i.push("collectionAssignments must be objects"),!1;let{collectionPosition:u}=l;return typeof u!="number"?(i.push("collectionPosition must be a number"),!1):!0}):(i.push(qp("collectionAssignments")),!1):(i.push("Missing participantId"),!1)}),n=nt(t.map(yt)).length===t.length;return n||i.push("Duplicated participantId(s)"),{valid:r&&n,errors:i,error:i.length?re:void 0}}function Jh({drawDefinition:t,participantId:e,tieFormat:i,lineUp:r}){if(typeof t!="object")return{error:$e};if(typeof e!="string")return{error:dr};let n=sN({lineUp:r,tieFormat:i});if(!n.valid)return n;let{extension:a}=ht({element:t,name:Uc}),s=a?.value||{};return s[e]=K2({lineUp:r}),Ft({element:t,extension:{name:Uc,value:s}}),hU({drawDefinition:t}),{...W}}function X2({inContextDrawMatchUps:t,inheritance:e=!0,tournamentRecord:i,drawDefinition:r,matchUpsMap:n,assignments:a,structure:s,event:o}){if(!r)return{error:$e};let{drawPositions:l,matchUps:u,targetMatchUps:c}=qae({inContextDrawMatchUps:t,matchUpsMap:n,assignments:a,structure:s});for(let d of c)d.matchUpType===La&&(d.sides??[]).forEach((p,f)=>{if(p?.drawPosition&&l?.includes(p.drawPosition)){let m=u.find(({matchUpId:h})=>h===d.matchUpId);if(m?.sides?.[f]){if(delete m.sides[f].lineUp,e===!1){let h=d.tieFormat,g=p.participantId;h&&g&&Jh({drawDefinition:r,participantId:g,lineUp:[],tieFormat:h})}Ut({tournamentId:i?.tournamentId,context:"resetLineUps",eventId:o?.eventId,drawDefinition:r,matchUp:m})}}});return{...W}}function hl({provisionalPositioning:t,inContextDrawMatchUps:e,isQualifierPosition:i,sourceMatchUpStatus:r,tournamentRecord:n,drawDefinition:a,seedingProfile:s,participantId:o,seedBlockInfo:l,drawPosition:u,matchUpsMap:c,structureId:d,event:p}){let f="assignDrawPosition";if(!o&&!i)return q({result:{error:dr},stack:f});c=c??Or({drawDefinition:a}),e||({matchUps:e}=Zi({inContext:!0,drawDefinition:a,matchUpsMap:c}));let m=tt({drawDefinition:a,structureId:d});if(m.error)return q({result:m,stack:f});let{structure:h}=m;if(!h)return{error:vi};if(Hn({structure:h}))return q({result:{error:oa},stack:f});let{seedAssignments:g}=hs({provisionalPositioning:t,drawDefinition:a,structure:h}),I=g?.find(P=>P.participantId===o)?.seedNumber,{appliedPolicies:v}=Dt({tournamentRecord:n,drawDefinition:a,structure:h,event:p});if(I&&!ZP({seedNumber:I,appliedPolicies:v,drawDefinition:a,seedBlockInfo:l,drawPosition:u,structureId:d}))return q({result:{error:X$},context:{drawPosition:u},stack:f});let w=pr({structure:h}).positionAssignments||[],y=w?.find(P=>P.drawPosition===u);if(!y)return q({result:{error:Mh},context:{drawPosition:u},stack:f});if(w?.map(yt).includes(o))return q({result:{error:kv},context:{drawPosition:u},stack:f});let{containsParticipant:b,containsBye:S}=N2(y);if(S){let P=AU({inContextDrawMatchUps:e,tournamentRecord:n,drawDefinition:a,drawPosition:u,structureId:d,matchUpsMap:c,event:p});if(P.error)return q({result:P,stack:f})}if(b&&y.participantId!==o){let{activeDrawPositions:P}=Wv({drawDefinition:a,structureId:d});if(P.includes(u))return q({result:{error:JS},stack:f});X2({assignments:[y],inContextDrawMatchUps:e,tournamentRecord:n,drawDefinition:a,matchUpsMap:c,structure:h})}if(y.participantId=o,i&&(y.qualifier=!0),h.stage===Ae&&(!h.stageSequence||h.stageSequence>1)||h.stage&&[tn,Ti].includes(h.stage)){let P=h.stage===ze?ze:Ae,D=(a.structures?.find(E=>E?.stage===P&&E?.stageSequence===1)?.seedAssignments??[]).find(E=>E.participantId===o);if(D?.participantId){let{participantId:E,seedNumber:R,seedValue:C}=D;Yv({eventId:p?.eventId,provisionalPositioning:t,tournamentRecord:n,drawDefinition:a,seedingProfile:s,participantId:E,seedNumber:R,seedValue:C,structureId:d,event:p})}}if(h.structureType===gn){uae({positionAssignments:w,tournamentRecord:n,drawDefinition:a,matchUpsMap:c,structure:h});let{drawPositions:P,matchUps:D,targetMatchUps:E}=qae({assignments:[y],inContextDrawMatchUps:e,drawDefinition:a,matchUpsMap:c,structure:h});if(P&&D?.length===1&&D[0].matchUpType===ei){let R=(E?.[0].sides??[]).reduce((C,M,N)=>P?.includes(M.drawPosition)?N:C,void 0);Y2({inContextTargetMatchUp:E[0],teamParticipantId:o,matchUp:D[0],drawPositionSideIndex:R,tournamentRecord:n,drawDefinition:a})}}else W_e({provisionalPositioning:t,inContextDrawMatchUps:e,sourceMatchUpStatus:r,tournamentRecord:n,drawDefinition:a,drawPosition:u,matchUpsMap:c,structure:h,event:p});let U=a.entries?.find(P=>P.participantId===o),T=p?.entries?.find(P=>P.participantId===o);return!U&&T&&L2({entryStatus:T.entryStatus,entryStage:h.stage,ignoreStageSpace:!0,drawDefinition:a,participantId:o,event:p}),Pc({tournamentId:n?.tournamentId,drawDefinition:a,structure:h,event:p}),{positionAssignments:w,...W}}function W_e({provisionalPositioning:t,inContextDrawMatchUps:e,sourceMatchUpStatus:i,tournamentRecord:r,drawDefinition:n,drawPosition:a,matchUpsMap:s,structure:o,event:l}){let u={isCollectionMatchUp:!1},{matchUps:c}=At({provisionalPositioning:t,matchUpFilters:u,drawDefinition:n,matchUpsMap:s,structure:o,event:l}),{roundMatchUps:d}=Sn({matchUps:c}),{initialRoundNumber:p}=Wm({drawPosition:a,matchUps:c}),f=p&&d?.[p].find(m=>m.drawPositions?.includes(a));if(f){let m=gm({matchUpId:f.matchUpId,inContextDrawMatchUps:e,sourceMatchUpStatus:i,tournamentRecord:r,drawDefinition:n,drawPosition:a,matchUpsMap:s});if(m.error)return q({stack:"assignDrawPositionToMatchUps",context:{drawPosition:a},result:m})}return{...W}}function J2(t){let{participantIdAttributeName:e="participantId",isQualifierPosition:i,positionActionName:r,tournamentRecord:n,drawDefinition:a,participantId:s,drawPosition:o,structureId:l,event:u}=t,c="positionParticipantAction";if(!a)return{error:$e};let d=Dt({tournamentRecord:n,drawDefinition:a,event:u}).appliedPolicies??{},{inContextDrawMatchUps:p,matchUpsMap:f}=t;f||(f=Or({drawDefinition:a}),Object.assign(t,{matchUpsMap:f})),p||({matchUps:p}=Zi({inContext:!0,drawDefinition:a,matchUpsMap:f}),Object.assign(t,{inContextDrawMatchUps:p}));let{positionAssignments:m}=Kt({drawDefinition:a,structureId:l}),h=m?.find(y=>y.drawPosition===o);if(h?.participantId){let y=h.participantId,b=hl({inContextDrawMatchUps:p,tournamentRecord:n,drawDefinition:a,participantId:s,drawPosition:o,structureId:l,matchUpsMap:f,event:u});return b.success?w({appliedPolicies:d,removedParticipantId:y}):q({result:b,stack:c})}let g=AU({inContextDrawMatchUps:p,tournamentRecord:n,drawDefinition:a,drawPosition:o,structureId:l,matchUpsMap:f,event:u});if(g.error)return q({result:g,stack:c});let I=g.participantId,v=hl({inContextDrawMatchUps:p,isQualifierPosition:i,tournamentRecord:n,drawDefinition:a,participantId:s,drawPosition:o,structureId:l,matchUpsMap:f,event:u});if(!v.success)return q({result:v,stack:c});return w({appliedPolicies:d,removedParticipantId:I});function w({appliedPolicies:y,removedParticipantId:b}){let{structure:S}=tt({drawDefinition:a,structureId:l});m2({drawPositions:[o],structure:S});let U={[e]:s,name:r,drawPosition:o,structureId:l};return gU({appliedPolicies:y,drawDefinition:a,positionAction:U}),q({context:{removedParticipantId:b},result:{...W},stack:c})}}function z_e({luckyLoserParticipantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,structureId:n}){return J2({positionActionName:"luckyLoserDrawPositionAssignment",participantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,structureId:n})}function Yae(t){return z_e(t)}function Kae({params:t,modMap:e,structure:i}){let{tournamentRecord:r,drawDefinition:n,event:a}=t;for(let s of i.matchUps)e[s.matchUpId]&&(s.roundNumber=e[s.matchUpId],Ut({tournamentId:r?.tournamentId,eventId:a?.eventId,drawDefinition:n,matchUp:s}))}function Xae(t,e){let i=[{drawDefinition:!0,structureId:!0}];Array.isArray(e)&&i.push(...e);let r=He(t,i);if(r.error)return r;let n=tt(t);if(n.error)return n;let a=n.structure;if(!Hn({structure:a}))return q({result:{error:mf,message:"structure must be adHoc"}});let{roundMatchUps:s=[],roundNumbers:o}=Sn({matchUps:a?.matchUps});return o?.length?{valid:!0,structure:a,roundMatchUps:s,roundNumbers:o}:{error:Nu}}function Jae(t){let e=Xae(t,[{targetRoundNumber:!0,roundNumber:!0,[qn]:zFe}]);if(e.error)return e;let{structure:i,roundMatchUps:r,roundNumbers:n}=e,{targetRoundNumber:a,roundNumber:s}=t;if(!n?.includes(s)||!n?.includes(a))return q({result:{error:re},info:"roundNumbers must be valid rounds"});let o=a>s,l=o?Ce(s+1,a+1):Ce(a,s),u={};return l.forEach(c=>(r?.[c]??[]).forEach(({matchUpId:d})=>{u[d]=c-(o?1:-1)})),r?.[s]?.forEach(({matchUpId:c})=>u[c]=a),Kae({params:t,modMap:u,structure:i}),{...W}}function Qae({structurePositionAssignments:t,provisionalPositioning:e,tournamentRecord:i,drawDefinition:r,event:n}){if(!r)return{error:$e};if(!Array.isArray(t))return{error:re};let a="setPositionAssignments";for(let o of t){let{structureId:l,positionAssignments:u}=o;if(!u)continue;let c=tt({drawDefinition:r,structureId:l});if(c.error)return c;let d=c.structure;if(!d)return{error:vi};let p=Kt({structure:d}).positionAssignments?.map(({drawPosition:g})=>g),f=u?.map(({drawPosition:g})=>g);if(Li(p,f).length!==p?.length)return q({result:{error:re},info:"drawPositions do not match",stack:a});let m=Or({drawDefinition:r}),{matchUps:h}=Zi({inContext:!0,drawDefinition:r,matchUpsMap:m});for(let g of u||[]){let{drawPosition:I,participantId:v,bye:w,qualifier:y}=g;if(w){let b=Ja({tournamentRecord:i,drawDefinition:r,drawPosition:I,matchUpsMap:m,structureId:l,structure:d,event:n});if(b?.error)return b}else if(y)u.forEach(b=>{b.drawPosition===I&&(b.qualifier=!0,delete b.participantId,delete b.bye)});else if(v){let b=hl({provisionalPositioning:e,inContextDrawMatchUps:h,tournamentRecord:i,drawDefinition:r,participantId:v,drawPosition:I,matchUpsMap:m,structureId:l,event:n});if(b?.error)return b}}Pc({tournamentId:i?.tournamentId,drawDefinition:r,structure:d,event:n})}let s=t.map(({structureId:o})=>o);return ii({tournamentId:i?.tournamentId,eventId:n?.eventId,drawDefinition:r,structureIds:s}),{...W}}function Zae(t){let e=Xae(t,[{roundNumbers:!0,[qn]:sn,[qr]:s=>s.length===2&&s.every(Ai)}]);if(e.error)return e;let{structure:i,roundMatchUps:r,roundNumbers:n}=e;if(!t.roundNumbers.every(s=>n?.includes(s)))return q({result:{error:re,message:"roundNumbers must be valid rounds"}});let a={};return t.roundNumbers.forEach((s,o)=>(r?.[s]??[]).forEach(({matchUpId:l})=>{a[l]=t.roundNumbers[1-o]})),Kae({params:t,modMap:a,structure:i}),{...W}}function ese({alternateParticipantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,structureId:n,event:a}){return J2({positionActionName:"alternateDrawPositionAssignment",participantIdAttributeName:"alternateParticipantid",participantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,structureId:n,event:a})}function tse({drawDefinition:t,structureId:e}){if(!t)return{error:$e};let{structure:i}=tt({drawDefinition:t,structureId:e}),r=(t?.links||[]).filter(n=>n.source?.structureId===e).map(n=>n.target?.structureId);return{playoffStructures:(t?.structures||[]).filter(n=>r.includes(n.structureId)),structure:i}}function oN({withStageGrouping:t,stageSequences:e,stageSequence:i,roundTarget:r,stages:n,event:a,stage:s}){if(!a)return{error:ui};let o={},l=[];for(let u of a.drawDefinitions||[]){let{structures:c,stageStructures:d}=io({withStageGrouping:t,stageSequences:e,drawDefinition:u,stageSequence:i,roundTarget:r,stages:n,stage:s});if(l.push(...c),d)for(let p of Object.keys(d))o[p]||(o[p]=[]),o[p].push(...d[p])}return{structures:l,stageStructures:o}}function Q2({withStageGrouping:t,tournamentRecord:e,stageSequences:i,stageSequence:r,roundTarget:n,stages:a,stage:s}){if(!e)return{error:ve};let o={},l=[];for(let u of e.events||[]){let{structures:c,stageStructures:d}=oN({withStageGrouping:t,stageSequences:i,stageSequence:r,roundTarget:n,stages:a,event:u,stage:s});if(c&&l.push(...c),d)for(let p of Object.keys(d))o[p]||(o[p]=[]),o[p].push(...d[p])}return{structures:l,stageStructures:o}}function Su(t){if(!t?.drawDefinition)return!1;let e=iN(t),i=e?.includesTeamMatchUps,{completedMatchUps:r,pendingMatchUps:n,upcomingMatchUps:a}=e||{};return i&&(r=r?.filter(({matchUpType:s})=>s===ei),n=n?.filter(({matchUpType:s})=>s===ei),a=a?.filter(({matchUpType:s})=>s===ei)),!!(r?.length&&!n?.length&&!a?.length)}function Z2(t){let{drawDefinition:e,structureId:i}=t;if(!e)return{error:$e};let{playoffStructures:r}=tse({drawDefinition:e,structureId:i});if(!r?.length)return!1;let n=e?.entries?.filter(s=>s?.entryStatus&&uo.includes(s.entryStatus))?.length??0,a=0;return(r||[]).reduce((s,o)=>!!((Kt({structure:o}).positionAssignments??[])?.filter(l=>(l.participantId&&a++,l?.bye??l?.participantId)).length&&s),!!r.length)||a===n}function Nx({significantCharacters:t,accessors:e=[],value:i}){let r=[],n=e[0];if(i?.[n]){let s=e.slice(1);if(Array.isArray(i[n]))i[n].forEach(o=>{let l=Nx({accessors:s,significantCharacters:t,value:o});r.push(...l)});else if(i=i[n],s.length){let o=Nx({accessors:s,significantCharacters:t,value:i});r.push(...o)}else a({value:i})}function a({value:s}){if(s&&["string","number"].includes(typeof s)){let o=t?s.slice(0,t):s;r.push(o)}}return r}function q_e({targetParticipantIds:t,policyAttributes:e,idCollections:i,participants:r}){if(!Array.isArray(e))return{error:nB};if(!Array.isArray(r))return{error:tU};let n={};return t.forEach(a=>{let s=r.find(l=>l.participantId===a),{values:o}=ise({policyAttributes:e,idCollections:i,participants:r,participant:s});o&&o.forEach(l=>{n[l]||(n[l]=[]),n[l].includes(a)||n[l].push(a)})}),n}function ise({policyAttributes:t,idCollections:e,participants:i,participant:r}){if(!Array.isArray(t))return{error:nB};if(!r)return{error:kh};let n=[];return t.forEach(a=>{let{directive:s,groupings:o,key:l,significantCharacters:u}=a||{};if(l){let c=l.split(".");n.push(...Nx({significantCharacters:u,value:r,accessors:c}))}else if(s){let c=a?.includeIds,d=(e?.[s]||[]).filter(p=>!c||c.includes(p));d?.length&&i?.length&&d.forEach(p=>{let f=i.find(m=>m.participantId===p);if(f?.individualParticipantIds?.includes(r.participantId)){let m=f?.participantId;n.push(m)}})}else o&&Object.keys(o).forEach(c=>{o[c].includes(r.participantId)&&n.push(c)})}),{values:nt(n)}}function cq({candidatePositionAssignments:t,participantsWithGroupings:e,policyAttributes:i,idCollections:r}){let n=Object.assign({},...e.map(a=>({[a.participantId]:a})));return t.map(a=>{let s=n[a.participantId],{values:o}=ise({participants:e,policyAttributes:i,idCollections:r,participant:s});return{...a,values:o}})}function rse({participantIdGroups:t,positionAssignments:e,groupsToAvoid:i}){return Object.assign({},...e.filter(r=>r?.participantId).map(r=>{let{drawPosition:n,participantId:a}=r,s=t?t[a]||[]:[],o=!!i.some(l=>s.includes(l));return{[n]:{participantGroups:s,includesGroupsToAvoid:o}}}))}function Y_e(t){let{unfilledPositions:e,chunkedDrawPositions:i}=t,r=rse(t);return i.map(a=>{let s=e.filter(u=>a.includes(u)),o=n(s),l=s.filter(u=>!o.includes(u)).filter(u=>{let c=dq(u);return!r[c]?.includesGroupsToAvoid});return{unassigned:s,unpaired:o,pairedNoConflict:l}});function n(a){return a.filter(o=>!s(o));function s(o){let l=dq(o);return!a.includes(l)}}}function K_e(t){let{unfilledPositions:e,chunkedDrawPositions:i}=t,r=rse(t);return i.map(n=>{let a=e.filter(l=>n.includes(l)),s=a.length===n.length?a:[],o=n.filter(l=>r[l]?.includesGroupsToAvoid).length;return{unassigned:a,unpaired:s,pairedNoConflict:o?[]:a,conflictsCount:o}})}function dq(t){return Number(t%2?t+1:t-1)}function X_e({allGroups:t,participantId:e}){return Object.keys(t).filter(i=>t[i].includes(e))}function J_e({selectedParticipantGroups:t,participantIdGroups:e,positionAssignments:i,drawPositionChunks:r,unfilledPositions:n,isRoundRobin:a}){let s=r.map(o=>a?K_e({groupsToAvoid:t,chunkedDrawPositions:o,participantIdGroups:e,positionAssignments:i,unfilledPositions:n}):Y_e({groupsToAvoid:t,chunkedDrawPositions:o,participantIdGroups:e,positionAssignments:i,unfilledPositions:n}));if(a){let o=s.map(c=>c.map(d=>d.unassigned).filter(d=>d?.length)).filter(c=>c?.length).sort((c,d)=>(d.length||0)-(c.length||0)),l=s.map(c=>c.map(d=>d.unpaired).filter(d=>d?.length)).filter(c=>c?.length),u=s.map(c=>c.map(d=>d.pairedNoConflict).filter(d=>d?.length)).filter(c=>c?.length).sort((c,d)=>(d.length||0)-(c.length||0));return{unassigned:o,unpaired:l,pairedNoConflict:u}}else{let o=s.map(c=>c.map(d=>d.unassigned).filter(d=>d?.length)).filter(c=>c?.length),l=s.map(c=>c.map(d=>d.unpaired).filter(d=>d?.length)).filter(c=>c?.length),u=s.map(c=>c.map(d=>d.pairedNoConflict).filter(d=>d?.length)).filter(c=>c?.length);return{unassigned:o,unpaired:l,pairedNoConflict:u}}}function nse({positionAssignments:t,participantIds:e}){let i=t.map(r=>r.participantId);return e.filter(r=>!i.includes(r))}function Q_e({useSpecifiedGroupKey:t=!1,targetParticipantIds:e,largestFirst:i=!0,allGroups:r,groupKey:n}){let a=Object.assign({},...Object.keys(r).map(u=>[u,r[u].filter(c=>e.includes(c))]).filter(u=>u[1].length).map(([u,c])=>({[u]:c}))),s=Object.keys(a).reduce((u,c)=>a[c].length>u?a[c].length:u,0),o=Object.keys(a).filter(u=>a[u].length===s),l=Ns(i?o:Object.keys(a));return n=t&&a[n]?.length?n:l,{participantId:n&&a[n]?Ns(a[n]):Ns(e),groupKey:n}}function Z_e({drawPositionGroups:t,positionAssignments:e}){let i=Object.assign({},...e.map(r=>({[r.drawPosition]:r})));return t.map(r=>r.filter(Boolean).map(n=>i[n]).filter(Boolean).filter(n=>!n.participantId&&!n.bye).map(n=>n.drawPosition)).flat().filter(Boolean)}function e$e({candidatePositionAssignments:t,unseededParticipantIds:e,participantIdGroups:i,drawPositionChunks:r,drawPositionGroups:n,pairedPriority:a,allGroups:s,groupKey:o}){let l=n.reduce((T,P)=>P.length>T?P.length:T,0)<=2,u=nse({positionAssignments:t,participantIds:e}),c=Z_e({positionAssignments:t,drawPositionGroups:n}),{participantId:d,groupKey:p}=Q_e({targetParticipantIds:u,useSpecifiedGroupKey:l,allGroups:s,groupKey:o}),f=X_e({participantId:d,allGroups:s}),m=J_e({positionAssignments:t,isRoundRobin:l,selectedParticipantGroups:f,participantIdGroups:i,drawPositionChunks:r,unfilledPositions:c}),{unassigned:h,unpaired:g,pairedNoConflict:I}=m,v=I?.length&&I[0],w=g?.length&&g[0],y=a&&v?v:w,b=a?w:v,S=y?.length&&y||b?.length&&b,U;if(S?.length){let T=ha(S);U=ha(T)}else{let T=ha(h[0]);U=ha(T)}return{newGroupKey:p,selectedParticipantId:d,targetDrawPosition:U}}function Ax({isRoundRobin:t,groupedParticipants:e}){let i=[];return t?e.forEach(r=>{let n=r.map(o=>o.drawPosition),a=H2({drawPositions:n}).uniqueMatchUpGroupings??[],s=Object.assign({},...r.map(o=>({[o.drawPosition]:o})));a.forEach(o=>{xn(s[o[0]].values||[],s[o[1]].values||[])&&(i.push(o),r.conflict=!0)})}):e.forEach(r=>{xn(r[0]?.values||[],r[1]?.values||[])&&(i.push(r),r.conflict=!0)}),i}function t$e(t,e){let i=t.find(r=>r.includes(e));if(i)return i.find(r=>r!==e)}function pq(t,e){return t.find(i=>i.drawPosition===e)}function i$e({moveableParticipant:t,possibleDrawPosition:e,positionedParticipants:i,drawPositionGroups:r,isRoundRobin:n,getAvoidanceConflicts:a}){let s=t$e(r,e),o=pq(i,s),l=a({isRoundRobin:n,groupedParticipants:[[t,o]]}),u=[pq(i,e),o],c=a({isRoundRobin:n,groupedParticipants:[u]});return!l.length&&!c.length}function r$e({positionedParticipants:t,potentialDrawPositions:e,drawPositionGroups:i,avoidanceConflicts:r,isRoundRobin:n}){return r.flatMap(a=>{let s=a.map(o=>o.drawPosition);return a.filter(o=>e.includes(o.drawPosition)).map(o=>{let l=e.filter(u=>!s?.includes(u)).filter(u=>i$e({moveableParticipant:o,possibleDrawPosition:u,positionedParticipants:t,drawPositionGroups:i,isRoundRobin:n,getAvoidanceConflicts:Ax}));if(l.length)return{drawPosition:o.drawPosition,possibleDrawPositions:l}}).filter(Boolean)})}function fq(t){let{initialPositionAssignments:e,participantsWithGroupings:i,opponentsToPlaceCount:r,unseededByePositions:n,drawPositionGroups:a,policyAttributes:s,idCollections:o,allGroups:l}=t,u=[],c,d=Math.min(...(a||[]).map(w=>w?.length).filter(Boolean)),p=d>2,f=Oe(e,!1,!0).filter(w=>!w.qualifier),m=e.filter(w=>!w.participantId&&(!w.bye||n?.includes(w.drawPosition))).map(w=>w.drawPosition);Ce(0,r).forEach(()=>{let{newGroupKey:w,selectedParticipantId:y,targetDrawPosition:b}=e$e({...t,candidatePositionAssignments:f,allGroups:l,groupKey:c});c=w,f.forEach(S=>{S.drawPosition===b&&(S.participantId=y)})});let h=cq({candidatePositionAssignments:f,participantsWithGroupings:i,policyAttributes:s,idCollections:o}),g=wr(h,d),I=Ax({groupedParticipants:g,isRoundRobin:p}),v=0;for(;v<20&&I.length;){let w=r$e({positionedParticipants:h,potentialDrawPositions:m,avoidanceConflicts:I,drawPositionGroups:a,isRoundRobin:p});if(w.length){let y=n$e({candidatePositionAssignments:f,swapOptions:w});y.error&&console.log({result:y}),h=cq({candidatePositionAssignments:f,participantsWithGroupings:i,policyAttributes:s,idCollections:o}),g=wr(h,d),I=Ax({groupedParticipants:g,isRoundRobin:p}),v++}else v=20}return f.forEach(w=>{if(w.bye&&w.participantId){let y=ox;u.push(y)}if(w.qualifier&&w.participantId){let y=ox;u.push(y)}}),{positionAssignments:f,conflicts:I.length,groupedParticipants:g,errors:u}}function n$e({candidatePositionAssignments:t,swapOptions:e}){let i=ha(e);if(!i)return{error:{message:"No swap options"}};let r=i.drawPosition,n=ha(i.possibleDrawPositions),a=t.find(u=>u.drawPosition===r),s=t.find(u=>u.drawPosition===n)??{},o={participantId:s?.participantId,qualifier:s?.qualifier,bye:s?.bye},l={participantId:a.participantId,qualifier:a.qualifier,bye:a.bye};return Object.assign(a,o),Object.assign(s,l),{...W}}function a$e({provisionalPositioning:t,unseededParticipantIds:e,inContextDrawMatchUps:i,unseededByePositions:r,tournamentRecord:n,drawDefinition:a,seedBlockInfo:s,participants:o,matchUpsMap:l,structureId:u,avoidance:c,drawSize:d,event:p}){if(!c)return{error:Gte};let{candidatesCount:f=1,policyAttributes:m,targetDivisions:h}=c,{roundsToSeparate:g}=c,I="randomUnseededSeparation",{structure:v}=tt({drawDefinition:a,structureId:u}),{matchUps:w}=At({provisionalPositioning:t,matchUpsMap:l,structure:v,event:p});if(h&&Ro(h)&&!g){let L=jxe(h)||0,$=w.reduce((V,_)=>_.roundNumber>V?_.roundNumber:V,0);g=$<L?1:$-L+1}let{positionAssignments:y}=pr({structure:v}),b=zM({participantsProfile:{convertExtensions:!0},deepCopy:!1,participants:o}).participantsWithGroupings,S=y?.filter(L=>!L.participantId),U=y?.map(L=>L.drawPosition),T=v?.structureType===gn,P=T?{structure:v,matchUps:w,allDrawPositions:U,roundsToSeparate:g}:{matchUps:w,allDrawPositions:U,roundsToSeparate:g},{drawPositionGroups:D,drawPositionChunks:E}=T?s$e(P):o$e(P),R={groupParticipants:o.filter(L=>L.participantType===Ya).map(L=>L.participantId),teamParticipants:o.filter(L=>L.participantType===_t).map(L=>L.participantId),pairParticipants:o.filter(L=>L.participantType===ft).map(L=>L.participantId)},C=q_e({targetParticipantIds:e,policyAttributes:m,idCollections:R,participants:o});if(C.error)return q({result:C,stack:I});let M=Object.assign({},...e.map(L=>{let $=Object.keys(C).filter(V=>(C[V]??[]).includes(L));return{[L]:$}})),N=nse({participantIds:e,positionAssignments:y});if(N.length>(S?.length||0))return{error:uB};let A,O=N.length,k=Ce(0,f).map(()=>fq({initialPositionAssignments:y,participantsWithGroupings:b,unseededParticipantIds:e,opponentsToPlaceCount:O,pairedPriority:!1,unseededByePositions:r,participantIdGroups:M,drawPositionChunks:E,drawPositionGroups:D,policyAttributes:m,idCollections:R,allGroups:C,drawSize:d}));if(A=k.reduce((L,$)=>!L||($.conflicts||0)<(L.conflicts||0)?$:L,void 0),!A||A.conflicts){let L=Ce(0,f).map(()=>fq({initialPositionAssignments:y,participantsWithGroupings:b,unseededParticipantIds:e,opponentsToPlaceCount:O,pairedPriority:!0,unseededByePositions:r,participantIdGroups:M,drawPositionChunks:E,drawPositionGroups:D,policyAttributes:m,idCollections:R,allGroups:C,drawSize:d}));A=k.concat(...L).filter($=>!$.errors?.length).reduce(($,V)=>!$||(V.conflicts||0)<($.conflicts||0)?V:$,void 0)}if(!A)return{error:IM};let F=(Kt({structure:v})?.positionAssignments??[]).filter(L=>L.participantId).map(L=>L.participantId),x=A.positionAssignments.filter(L=>!F.includes(L.participantId));for(let L of x)if(L.bye){let $=Ja({tournamentRecord:n,drawDefinition:a,structureId:u,matchUpsMap:l,event:p,...L});if($.error)return q({result:$,stack:I})}else if(L.participantId){let $=hl({inContextDrawMatchUps:i,tournamentRecord:n,drawDefinition:a,seedBlockInfo:s,structureId:u,matchUpsMap:l,event:p,...L});if($.error)return q({result:$,stack:I,context:{assignment:L}})}return{...W}}function s$e(t){let{structure:{structures:e}}=t,i=e.map(r=>r.positionAssignments.map(n=>n.drawPosition));return{drawPositionGroups:i,drawPositionChunks:[i]}}function o$e({allDrawPositions:t,roundsToSeparate:e,matchUps:i}){let r=i.filter(c=>c.roundNumber===1).map(c=>c.drawPositions),n=r.flat().sort(nr),a=Math.max(...n),s=t.filter(c=>c>a),o=n.length,l=Ce(o===2?1:2,o).filter(c=>c===Y$(c)),u=l.slice(0,e||l.length).reverse().map(c=>wr(n,c));return s.length&&console.log({fedDrawPositions:s}),{drawPositionGroups:r,drawPositionChunks:u}}function l$e({provisionalPositioning:t,inContextDrawMatchUps:e,unseededByePositions:i,multipleStructures:r,tournamentRecord:n,drawDefinition:a,seedBlockInfo:s,participants:o,matchUpsMap:l,structureId:u,structure:c,drawSize:d,event:p}){let f="positionUnseededParticipants";c||({structure:c}=tt({drawDefinition:a,structureId:u})),u||({structureId:u}=c);let{positionAssignments:m}=pr({structure:c}),{seedAssignments:h}=hs({provisionalPositioning:t,drawDefinition:a,structure:c}),g=h?.map(P=>P.participantId).filter(Boolean),{stage:I,stageSequence:v}=c,w=I===ze?ht({element:c,name:El})?.extension?.value:void 0,y=Vh({provisionalPositioning:t,drawDefinition:a,stageSequence:v,entryStatuses:Uf,structureId:u,roundTarget:w,stage:I}),b=y.filter(P=>!g?.includes(P.participantId)).map(P=>P.participantId),S=m?.filter(P=>!P.participantId&&!P.bye&&!P.qualifier).map(P=>P.drawPosition);if(!r&&b.length>(S?.length||0))return q({result:{error:uB},context:{unseededParticipantsCount:b.length,unfilledDrawPositionsCount:S?.length},stack:f});let{appliedPolicies:U}=Dt({tournamentRecord:n,drawDefinition:a,event:p}),T=U?.[Jb];if(c.stage===Ti){let P=y.reduce((D,E)=>(D[E.groupingValue]||(D[E.groupingValue]=[]),D[E.groupingValue].push(E.participantId),D),{});Object.keys(P).length&&(T||(T={policyName:"Playoff Avoidance"}),T.policyAttributes||(T.policyAttributes=[]),T.policyAttributes.push({groupings:P}))}return T&&o?a$e({provisionalPositioning:t,unseededParticipantIds:b,inContextDrawMatchUps:e,unseededByePositions:i,tournamentRecord:n,drawDefinition:a,seedBlockInfo:s,participants:o,matchUpsMap:l,structureId:u,avoidance:T,drawSize:d}):u$e({provisionalPositioning:t,unseededParticipantIds:b,inContextDrawMatchUps:e,unfilledDrawPositions:S,multipleStructures:r,tournamentRecord:n,drawDefinition:a,seedBlockInfo:s,structureId:u,matchUpsMap:l,drawSize:d,event:p})}function u$e({provisionalPositioning:t,unseededParticipantIds:e,inContextDrawMatchUps:i,unfilledDrawPositions:r,multipleStructures:n,tournamentRecord:a,drawDefinition:s,seedBlockInfo:o,matchUpsMap:l,structureId:u,drawSize:c,event:d}){let p=c>2?Cn(r):r.reverse();for(let f of e){let m=p.pop();if(!n||m){let h=hl({provisionalPositioning:t,inContextDrawMatchUps:i,tournamentRecord:a,drawDefinition:s,seedBlockInfo:o,participantId:f,drawPosition:m,matchUpsMap:l,structureId:u,event:d});if(h?.error&&console.log("!!!!!",{result:h}),h?.error)return q({result:h,stack:"randomUnseededDistribution"})}}return{...W}}function c$e(t){let e=t.structure??tt(t).structure,i="positionQualifiers",r=[];if(e.stage===tn)return q({result:{error:gf},stack:i});let{unplacedRoundQualifierCounts:n,positionAssignments:a,roundDrawPositions:s}=d$e(t);for(let o of Object.keys(n)){let l=a?.filter(u=>s[o].includes(u.drawPosition)&&!u.participantId&&!u.qualifier&&!u.bye).map(u=>u.drawPosition);if(n[o]>(l||0))return q({result:{error:lB},context:{unfilledDrawPositions:l},stack:i});Ce(0,n[o]).forEach(()=>{let u=ha(l);r.push(u),a?.forEach(c=>{c.drawPosition===u&&(c.qualifier=!0,delete c.participantId,delete c.bye)})})}return{...W,qualifierDrawPositions:r}}function d$e({drawDefinition:t,structure:e,structureId:i}){e||({structure:e}=tt({drawDefinition:t,structureId:i})),i||({structureId:i}=e);let{positionAssignments:r}=pr({structure:e}),{stage:n,stageSequence:a}=e,{qualifiersCount:s,roundQualifiersCounts:o}=zv({drawDefinition:t,stageSequence:a,structureId:i,stage:n}),l=(o?Object.keys(o):[]).map(h=>Ke(h)),{matchUps:u}=At({structure:e}),{roundProfile:c}=Sn({matchUps:u}),d=Object.assign({},...l.filter(h=>c?.[h]).map(h=>({[h]:c?.[h]?.drawPositions?.filter(Boolean)??[]}))),p=r?.filter(h=>h.qualifier).map(h=>h.drawPosition),f=s-(p?.length??0),m=p?.length;return{unplacedRoundQualifierCounts:Object.assign({},...l.map(h=>{let g=r?.filter(I=>I.qualifier&&d[h]?.drawPositions?.includes(I.drawPosition)).map(I=>I.drawPosition);return{[h]:(o?.[h]??0)-(g?.length??0)}})),unplacedQualifiersCount:f,placedQualifiersCount:m,roundQualifiersCounts:o,positionAssignments:r,roundDrawPositions:d,qualifiersCount:s}}function ase({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,appliedPolicies:r,validSeedBlocks:n,drawDefinition:a,seedingProfile:s,seedBlockInfo:o,participants:l,groupsCount:u,structureId:c,matchUpsMap:d,structure:p,event:f}){let m=[],h=[],g=0;if(p||({structure:p}=tt({drawDefinition:a,structureId:c})),c||(c=p?.structureId),r||(r=Dt({drawDefinition:a}).appliedPolicies),!n){let I=p&&Xh({provisionalPositioning:t,appliedPolicies:r,drawDefinition:a,seedingProfile:s,structure:p});I?.error&&h.push(I.error),n=I?.validSeedBlocks}return u=u??n?.length??0,Ce(0,u).forEach(()=>{if(g<(u||0)){let I=p$e({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:a,seedingProfile:s,seedBlockInfo:o,participants:l,structureId:c,matchUpsMap:d,event:f});I?.success&&(g++,m.push(...I.seedPositions??[])),I.error&&h.push({seedPositionError:I.error})}}),h.length?{error:h}:{...W,seedPositions:m}}function p$e({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:r,seedingProfile:n,seedBlockInfo:a,participants:s,structureId:o,matchUpsMap:l,event:u}){let{unplacedSeedParticipantIds:c,unfilledPositions:d}=Gae({provisionalPositioning:t,randomize:!0,drawDefinition:r,seedingProfile:n,seedBlockInfo:a,structureId:o}),{appliedPolicies:p}=Dt({drawDefinition:r}),{avoidance:f}=p??{};f&&s&&c?.length>2;let m=[];for(let h of c){let g=d.pop();if(!g)return{error:Mv};m.push(g);let I=hl({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:r,seedingProfile:n,participantId:h,seedBlockInfo:a,drawPosition:g,matchUpsMap:l,structureId:o,event:u});if(!I.success)return I}return{...W,seedPositions:m}}function f$e({provisionalPositioning:t,drawDefinition:e,structure:i}){let{positionAssignments:r}=pr({structure:i}),{seedAssignments:n}=hs({provisionalPositioning:t,drawDefinition:e,structure:i}),a=Object.assign({},...(n||[]).filter(s=>s.participantId).map(s=>({[s.participantId]:s})));return r?.map(s=>a[s.participantId]?{...s,seedNumber:a[s.participantId].seedNumber,seedValue:a[s.participantId].seedValue}:"").filter(Boolean)}function m$e({orderedSortedFirstRoundSeededDrawPositions:t,validSeedBlocks:e,byesToPlace:i}){let r=[];e.forEach(a=>h$e(a,i,r,t));let n=r.map(a=>Array.isArray(a)?Cn(a):a).flat(1/0);return lte(i)&&e.map(a=>a.seedNumbers[0]).includes(i)?t:n}function h$e(t,e,i,r){if(e-i.length>t.drawPositions.length)i.push(...t.drawPositions);else{let n=kx(wr(t.drawPositions,2));g$e(n,i,r)}}function g$e(t,e,i){let r,n=i[e.length];for(;r=yD(t,n);)e.push(r),n=i[e.length]}function yD(t,e){return Array.isArray(t)&&t.length!==2?t.pop():Array.isArray(t[0])?v$e(t,e):I$e(t,e)}function I$e(t,e){return t.includes(e)?t.indexOf(e)?t.pop():t.shift():Math.round(Math.random())?t.pop():t.shift()}function v$e(t,e){let i=t[0].flat(1/0).length,r=t[1].flat(1/0).length;if(i===r){let n=t[0].flat(1/0).includes(e)?t[0]:t[1];return yD(e?n:t[Math.round(Math.random())],e)}return i<r?yD(t[1],e):yD(t[0],e)}function kx(t){let e=Math.floor(t.length/2);return t.length>2?[kx(t.slice(0,e)),kx(t.slice(e))]:t}function y$e({provisionalPositioning:t,relevantMatchUps:e,appliedPolicies:i,drawDefinition:r,seedingProfile:n,seedBlockInfo:a,byesToPlace:s,structure:o}){a||(a=Xh({provisionalPositioning:t,appliedPolicies:i,drawDefinition:r,seedingProfile:n,structure:o}));let{isFeedIn:l,isLuckyStructure:u,isContainer:c}=a,{validSeedBlocks:d}=a;i?.seeding?.containerByesIgnoreSeeding&&(d=[]);let p=f$e({provisionalPositioning:t,drawDefinition:r,structure:o})??[],f=nt([].concat(...e.map(y=>y.drawPositions))),m=p.filter(y=>f.includes(y.drawPosition)),h=(y,b)=>kI(y.seedValue)-kI(b.seedValue),g=d.reduce((y,b)=>{let S=m.filter(U=>b.drawPositions?.includes(U.drawPosition)).sort(h);return y.concat(...S)},[]).map(y=>y.drawPosition),I=m$e({orderedSortedFirstRoundSeededDrawPositions:g,validSeedBlocks:d,byesToPlace:s}),v=mq({orderedSeedDrawPositions:g,relevantMatchUps:e}).slice(0,s),w=mq({orderedSeedDrawPositions:I,relevantMatchUps:e}).slice(0,s);return{strictSeedOrderByePositions:v,blockSeedOrderByePositions:w,isLuckyStructure:u,positionedSeeds:p,isContainer:c,isFeedIn:l}}function mq({orderedSeedDrawPositions:t,relevantMatchUps:e}){let i=e.map(r=>r.drawPositions).map(r=>r?.sort((n,a)=>n-a)).filter(r=>r?.[0]+1===r?.[1]);return t.map(r=>i.find(n=>n?.includes(r))).filter(Boolean).map(r=>r?.reduce((n,a)=>t.includes(a)?n:a,void 0)).filter(Boolean)}function b$e({provisionalPositioning:t,seedOrderByePositions:e,isLuckyStructure:i,appliedPolicies:r,drawDefinition:n,seedLimit:a,structure:s,isFeedIn:o}){let l=r?.seeding?.seedingProfile,u=s.stage===ze,{positionAssignments:c}=pr({structure:s}),d=c?.filter(N=>N.participantId).map(N=>N.drawPosition),p={isCollectionMatchUp:!1},{matchUps:f,roundMatchUps:m}=At({provisionalPositioning:t,matchUpFilters:p,structure:s}),h=m?.[1]||[],g=s.structureType===gn?f:h,I=nt([].concat(...g.map(N=>N.drawPositions))),v=Math.min(...I)-1,w=d?.filter(N=>I.includes(N)),y=N=>{let A=Math.ceil(N.length/2),O=[N.slice(0,A),N.slice(A)],k=O.map(G=>[].concat(...G.flat(1/0)).length),F=Math.min(...k.flat(1/0)),x=Math.max(...k.flat(1/0)),L=k.indexOf(x),$=F!==x,V=Cn(O),[_,B]=!F||$?[O[L],O[1-L]]:[V[0],V[1]];return{greaterHalf:_,lesserHalf:B}},b=N=>{let{greaterHalf:A,lesserHalf:O}=y(N),{greaterHalf:k,lesserHalf:F}=y(A),x=Cn(k.flat(1/0)).pop(),L=k.flat().filter($=>$!==x);return{newlyFilteredChunks:[...O,...F,L],drawPosition:x}},S=N=>!e.includes(N),U=N=>!w?.includes(N),T=N=>{let A=wr(N.sort(nr),Math.ceil(N.length/4)).map(F=>F.filter(U)),O=[].concat(...A.flat(1/0)).length,k=[];for(let F=0;F<O;F++){let{newlyFilteredChunks:x,drawPosition:L}=b(A);k.push(L),A=x}return k},{validSeedBlocks:P}=Xh({provisionalPositioning:t,allPositions:!0,appliedPolicies:r,drawDefinition:n,structure:s}),D=P?.map(N=>N.drawPositions?.map(A=>A+v)),E;if(o){let N=I.length,{seedBlocks:A}=W2({cluster:[oU,EM].includes($U(l)),participantsCount:N});E=A.map(O=>O.map(k=>k+v)).map(T).filter(O=>O.length)}else u?E=D?.map(N=>N.filter(U)):E=D?.map(T).filter(N=>N.length);let R=g.map(N=>N.drawPositions).map(N=>N?.sort((A,O)=>A-O)).filter(N=>N?.[0]+1===N?.[1]),C=N=>R.reduce((A,O)=>O.includes(N)?O.reduce((k,F)=>F!==N?F:k,void 0):A,void 0),M=E.map(N=>N.map(C)).flat(1/0).filter(U).filter(S).filter(Boolean);if(u&&!s.structures){let N=a%4,A=M.slice(0,N),O=m[s.roundLimit]?.length,k=wr(M.slice(N),O).map(Cn).flat();M=A.concat(k)}return{unseededByePositions:M}}function w$e({provisionalPositioning:t,drawDefinition:e,matchUpsMap:i,structure:r,event:n}){let a={isCollectionMatchUp:!1},{matchUps:s,roundMatchUps:o}=At({afterRecoveryTimes:!1,provisionalPositioning:t,drawDefinition:e,matchUpFilters:a,matchUpsMap:i,structure:r,event:n}),l=o?.[1]||[],u=r?.structureType===gn,c=u?s:l,d=u?r?.structures?.length||0:s.length,{structureId:p,stage:f,stageSequence:m}=r,h=Vh({entryStatuses:uo,provisionalPositioning:t,drawDefinition:e,stageSequence:m,structureId:p,stage:f}),{qualifiersCount:g}=zv({provisionalPositioning:t,drawDefinition:e,stageSequence:m,structureId:p,stage:f}),I=h.length+g,{positionAssignments:v,unassignedPositions:w}=pr({structure:r}),y=w?.map(D=>D.drawPosition),b=v?.filter(D=>D.bye).length,S=v?.filter(D=>D.bye).map(D=>D.drawPosition),U=c.map(D=>D.drawPositions).filter(D=>D?.reduce((E,R)=>!S?.includes(R)&&E,!0)).flat(1/0).filter(D=>y?.includes(D)),T=v?.length,P=T?T-I:0;return P>d&&r.stageSequence===1&&r.stage!==tn&&(P=d),{placedByes:b,byesCount:P,relevantMatchUps:c,placedByePositions:S,roundMatchUps:o,positionsToAvoidDoubleBye:U}}function sse({provisionalPositioning:t,tournamentRecord:e,appliedPolicies:i,drawDefinition:r,seedBlockInfo:n,seedingProfile:a,matchUpsMap:s,structureId:o,structure:l,seedLimit:u,seedsOnly:c,event:d}){l||({structure:l}=tt({drawDefinition:r,structureId:o})),o||(o=l?.structureId);let p=!(l?.structures??l?.stage===ze),{byesCount:f,placedByes:m,relevantMatchUps:h}=w$e({provisionalPositioning:t,drawDefinition:r,matchUpsMap:s,structure:l,event:d}),g=f-(m||0);if(g<=0)return{...W};let{strictSeedOrderByePositions:I,blockSeedOrderByePositions:v,isLuckyStructure:w,isFeedIn:y}=y$e({provisionalPositioning:t,relevantMatchUps:h,appliedPolicies:i,drawDefinition:r,seedingProfile:a,seedBlockInfo:n,byesToPlace:g,structure:l}),b=l?.structureType&&[gn,RM].includes(l.structureType)&&i?.seeding?.containerByesIgnoreSeeding,S=p&&v?.length?v:I,{unseededByePositions:U}=b$e({provisionalPositioning:t,seedOrderByePositions:S,isLuckyStructure:w,appliedPolicies:i,drawDefinition:r,seedLimit:u,structure:l,isFeedIn:y}),T=R=>R%2,P=(R,C)=>(R||[]).every(M=>T(M)?C!==M+1:C!==M-1),D=[].concat(...S);if(!c)for(;U.length;){let R=U.find(C=>P(D,C));R?(D.push(R),U=U.filter(C=>C!==R)):(D.push(...U),U=[])}b&&(D=Cn(D),la({ignoreSeededByes:b})&&console.log({byePositions:D}));let E=D.slice(0,g);for(let R of E){let C=Ja({provisionalPositioning:t,tournamentRecord:e,drawDefinition:r,drawPosition:R,matchUpsMap:s,structureId:o,structure:l,event:d});if(C?.error)return C}return{...W,unseededByePositions:U,byeDrawPositions:E}}function gy(t,e){return e||bM(),q({result:t,stack:"automatedPositioning"})}function S$e(t,e){return e||bM(),t}function U$e(t,e,i,r){let n=tt({drawDefinition:e,structureId:i});if(n.error)return{error:n.error};let a=n.structure;if(!a)return{error:vi};let s=t.appliedPolicies||Dt({drawDefinition:e,structure:a,event:r})?.appliedPolicies,{qualifiersCount:o}=zv({stageSequence:a.stageSequence,provisionalPositioning:t.provisionalPositioning,stage:a.stage,drawDefinition:e,structureId:i}),l=Uf,u=Vh({stageSequence:a.stageSequence,provisionalPositioning:t.provisionalPositioning,stage:a.stage,placementGroup:t.placementGroup,drawDefinition:e,entryStatuses:l,structureId:i});return{structure:a,appliedPolicies:s,qualifiersCount:o,entries:u}}function T$e({placeByes:t,provisionalPositioning:e,tournamentRecord:i,appliedPolicies:r,drawDefinition:n,seedBlockInfo:a,matchUpsMap:s,structure:o,seedLimit:l,seedsOnly:u,event:c,structureSeedingProfile:d,seedingProfile:p,inContextDrawMatchUps:f,participants:m,positioningReport:h}){let g=t?sse({provisionalPositioning:e,tournamentRecord:i,appliedPolicies:r,drawDefinition:n,seedBlockInfo:a,matchUpsMap:s,structure:o,seedLimit:l,seedsOnly:u,event:c}):void 0;if(g?.error)return{error:g.error};let I=g?.unseededByePositions;return h.push({action:"positionByes",unseededByePositions:I}),g=ase({seedingProfile:d?{positioning:d}:p,provisionalPositioning:e,inContextDrawMatchUps:f,tournamentRecord:i,appliedPolicies:r,validSeedBlocks:a.validSeedBlocks,drawDefinition:n,seedBlockInfo:a,participants:m,matchUpsMap:s,structure:o,event:c}),g.error?{error:g.error}:(h.push({seedPositions:g.seedPositions,action:"positionSeedBlocks"}),{unseededByePositions:I})}function D$e({drawType:t,LUCKY_DRAW:e,structureSeedingProfile:i,seedingProfile:r,provisionalPositioning:n,inContextDrawMatchUps:a,tournamentRecord:s,appliedPolicies:o,validSeedBlocks:l,drawDefinition:u,seedBlockInfo:c,participants:d,matchUpsMap:p,structure:f,event:m,placeByes:h,seedLimit:g,seedsOnly:I,positioningReport:v}){let w;if(t!==e){let b=ase({seedingProfile:i?{positioning:i}:r,provisionalPositioning:n,inContextDrawMatchUps:a,tournamentRecord:s,appliedPolicies:o,validSeedBlocks:l,drawDefinition:u,seedBlockInfo:c,participants:d,matchUpsMap:p,structure:f,event:m});if(b.error)return{error:b.error};v.push({action:"positionSeedBlocks",seedPositions:b.seedPositions})}let y=h?sse({provisionalPositioning:n,tournamentRecord:s,appliedPolicies:o,drawDefinition:u,seedBlockInfo:c,matchUpsMap:p,structure:f,seedLimit:g,seedsOnly:I,event:m}):void 0;return y?.error?{error:y.error}:(w=y?.unseededByePositions,v.push({action:"positionByes",byeDrawPositions:y?.byeDrawPositions,unseededByePositions:w}),{unseededByePositions:w})}function P$e({seedsOnly:t,inContextDrawMatchUps:e,tournamentRecord:i,appliedPolicies:r,validSeedBlocks:n,drawDefinition:a,seedBlockInfo:s,participants:o,matchUpsMap:l,structure:u,positionQualifiers:c,positionUnseededParticipants:d,provisionalPositioning:p,unseededByePositions:f,multipleStructures:m,structureId:h,drawSize:g,event:I,positioningReport:v,conflicts:w}){if(t)return{};let y=c({inContextDrawMatchUps:e,tournamentRecord:i,appliedPolicies:r,validSeedBlocks:n,drawDefinition:a,seedBlockInfo:s,participants:o,matchUpsMap:l,structure:u});return y.error?{error:y.error}:(y.conflicts&&(w.qualifierConflicts=y.conflicts),v.push({action:"positionQualifiers",qualifierDrawPositions:y.qualifierDrawPositions}),y=d({provisionalPositioning:p,inContextDrawMatchUps:e,unseededByePositions:f,multipleStructures:m,tournamentRecord:i,drawDefinition:a,seedBlockInfo:s,participants:o,matchUpsMap:l,structureId:h,structure:u,drawSize:g,event:I}),y.error?{error:y.error}:(y.conflicts&&(w.unseededConflicts=y.conflicts),v.push({action:"positionUnseededParticipants"}),{}))}function BU(t){let{drawDefinition:e}=t,{applyPositioning:i=!0,provisionalPositioning:r,multipleStructures:n,placeByes:a=!0,tournamentRecord:s,seedingProfile:o,structureId:l,seedLimit:u,seedsOnly:c,drawType:d,drawSize:p,event:f}=t,m=[];i||(Oie(),e=Oe(e,!1,!0));let{structure:h,appliedPolicies:g,qualifiersCount:I,entries:v,error:w}=U$e(t,e,l,f);if(w)return gy(w,i);if(!v?.length&&!I)return S$e({...W},i);let y=t.matchUpsMap??Or({drawDefinition:e}),b=t.inContextDrawMatchUps??Zi({inContext:!0,drawDefinition:e,matchUpsMap:y})?.matchUps,S=Xh({provisionalPositioning:r,appliedPolicies:g,drawDefinition:e,seedingProfile:o,structure:h});if(S.error)return gy(S,i);let{validSeedBlocks:U}=S;m.push({validSeedBlocks:U});let T=t.participants||(s?Ri({withIndividualParticipants:!0,convertExtensions:!0,tournamentRecord:s})?.participants:[]),P;if($U(h.seedingProfile||o)===Vp){let C=T$e({placeByes:a,provisionalPositioning:r,tournamentRecord:s,appliedPolicies:g,drawDefinition:e,seedBlockInfo:S,matchUpsMap:y,structure:h,seedLimit:u,seedsOnly:c,event:f,structureSeedingProfile:h.seedingProfile,seedingProfile:o,inContextDrawMatchUps:b,participants:T,positioningReport:m});if(C?.error)return gy(C.error,i);P=C.unseededByePositions}else{let C=D$e({drawType:d,LUCKY_DRAW:vf,structureSeedingProfile:h.seedingProfile,seedingProfile:o,provisionalPositioning:r,inContextDrawMatchUps:b,tournamentRecord:s,appliedPolicies:g,validSeedBlocks:U,drawDefinition:e,seedBlockInfo:S,participants:T,matchUpsMap:y,structure:h,event:f,placeByes:a,seedLimit:u,seedsOnly:c,positioningReport:m});if(C?.error)return gy(C.error,i);P=C.unseededByePositions}let D={},E=P$e({seedsOnly:c,inContextDrawMatchUps:b,tournamentRecord:s,appliedPolicies:g,validSeedBlocks:U,drawDefinition:e,seedBlockInfo:S,participants:T,matchUpsMap:y,structure:h,positionQualifiers:c$e,positionUnseededParticipants:l$e,provisionalPositioning:r,unseededByePositions:P,multipleStructures:n,structureId:l,drawSize:p,event:f,positioningReport:m,conflicts:D});if(E?.error)return gy(E.error,i);let{positionAssignments:R}=Kt({drawDefinition:e,structure:h});return ii({drawDefinition:e,structureIds:[l]}),i||bM(),{positionAssignments:R,conflicts:D,...W,positioningReport:m}}function Kv(t){let{applyPositioning:e=!0,provisionalPositioning:i,tournamentRecord:r,drawDefinition:n,seedingProfile:a,structureId:s,placeByes:o,seedsOnly:l}=t;if(!n)return{error:_a};if(!Su({drawDefinition:n,structureId:s})&&!i)return{error:K$};let u=tse({drawDefinition:n,structureId:s}).playoffStructures?.sort((p,f)=>WP(p)-WP(f)),c=[],d=[];if(u)for(let p of u){let{structureId:f}=p,m=BU({structureId:f,provisionalPositioning:i,applyPositioning:e,tournamentRecord:r,drawDefinition:n,seedingProfile:a,placeByes:o,seedsOnly:l});if(m.error)return m;m.positionAssignments&&c.push({positionAssignments:m.positionAssignments,structureId:f}),m.positioningReport&&d.push(m.positioningReport)}return{...W,structurePositionAssignments:c,positioningReports:d}}function ose({validation:t=!0,tournamentRecord:e,drawDefinition:i,participantId:r,structureId:n,seedValue:a,event:s}){if(!i)return{error:$e};if(!n)return{error:qa};let o=(e?.participants??[]).find(p=>p.participantId===r);if(e&&!o)return{error:Co};let{structure:l}=tt({drawDefinition:i,structureId:n});if(!l)return{error:vi};if(!(!t||Ai(a)||a===void 0||a===""||typeof a=="string"&&a.split("-").every(p=>Ai(p)&&Ke(p)>0)))return{error:re};let{seedAssignments:u}=hs({drawDefinition:i,structure:l}),c=u?.map(p=>p.seedNumber),d=u?.find(p=>p.participantId===r);if(d){let p=typeof a=="string"?a.includes("-")&&a.split("-").map(f=>parseInt(f)).join("-")||parseInt(a)>0&&parseInt(a)||"":a&&a>0&&a||"";d.seedValue=p}else{let p={seedNumber:Math.max(0,...c||[])+1,participantId:r};a&&(p.seedValue=a),l.seedAssignments||(l.seedAssignments=[]),l.seedAssignments.push(p)}return Pne({tournamentId:e?.tournamentId,eventId:s?.eventId,drawDefinition:i,structure:l}),{...W}}function eV({qualifyingParticipantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,structureId:n}){return J2({positionActionName:"qualifierDrawPositionAssignment",participantId:t,isQualifierPosition:!0,tournamentRecord:e,drawDefinition:i,drawPosition:r,structureId:n})}function nw({targetRoundNumber:t,finishingPosition:e,drawDefinition:i,structureId:r,linkType:n}){let{links:a}=Gv({drawDefinition:i,structureId:r})||{},s=(a?.target||[]).filter(({linkType:o})=>o===n).filter(({target:o})=>!t||t===o.roundNumber).map(o=>{let l=o.source.structureId,{structure:u}=tt({structureId:l,drawDefinition:i});if(!(e&&u?.finishingPosition!==e))return o}).filter(Boolean);return{sourceStructureIds:s.map(({source:o})=>o.structureId),relevantLinks:s}}var E$e=(t,e)=>{let i=[...new Set(e.slice(0,t.length))],r=[...i].sort((o,l)=>o-l),n=new Set,a=[];i.forEach(o=>{let l=t.indexOf(o);if(l!==-1&&!n.has(l))a.push(l),n.add(l);else{let u=r.indexOf(o),c=t.findIndex((d,p)=>!n.has(p));for(;n.has(c)&&c===-1&&n.size<t.length;)c=t.findIndex((d,p)=>!n.has(p)&&p>c);a.push(u),n.add(u)}});let s=t.filter((o,l)=>!n.has(l));return[...a,...s]};function lse({targetRoundNumber:t=1,tournamentRecord:e,drawDefinition:i,event:r,randomList:n}){let a=He({drawDefinition:i,event:r,tournamentRecord:e},[{[In]:!0,[Vc]:!0,[hr]:!0}]);if(a.error)return a;let s=[],o=[],l=i.structures?.find(g=>g.stage===Ae&&g.stageSequence===1);if(!l)return q({result:{error:tB}});let u=(Dt({tournamentRecord:e,drawDefinition:i,structure:l,event:r}).appliedPolicies??{})[yu]?.requireCompletedStructures,{qualifierPositions:c,positionAssignments:d}=pr({structure:l});if(!c.length)return q({result:{error:lB}});let p=Ce(0,c.length);n&&(p=E$e(p,n));let f=d.map(g=>g.participantId).filter(Boolean),{relevantLinks:m}=nw({structureId:l.structureId,targetRoundNumber:t,linkType:mu,drawDefinition:i})||{},{relevantLinks:h}=nw({structureId:l.structureId,targetRoundNumber:t,linkType:fu,drawDefinition:i})||{};for(let g of m){let I=i.structures?.find(w=>w.structureId===g.source.structureId);if(I?.stage!==ze)continue;let v=Su({structureId:g.source.structureId,drawDefinition:i});if(!u||v){let w=I.qualifyingRoundNumber,{matchUps:y}=At({matchUpFilters:{...w&&{roundNumbers:[w]},isCollectionMatchUp:!1,hasWinningSide:!0},afterRecoveryTimes:!1,inContext:!0,structure:I});for(let b of y){let S=b.matchUpStatus==="BYE"&&b.sides?.find(({participantId:T})=>T),U=b.sides.find(T=>T?.sideNumber===b.winningSide);if(U||S){let{participantId:T}=U||S||{};T&&!f.includes(T)&&o.push(T)}}}}for(let g of h){let I=i?.structures?.find(v=>v.structureId===g.source.structureId);if(I?.stage===ze&&Su({structureId:g.source.structureId,drawDefinition:i})){let{positionAssignments:v}=Kt({structure:I}),w=v?.map(y=>{let b=y.participantId,S=ht({element:y,name:Dc}).extension?.value;return S?{participantId:b,groupOrder:S?.groupOrder}:{}}).filter(({groupOrder:y,participantId:b})=>y===1&&!f.includes(b)).map(({participantId:y})=>y)??[];w&&o.push(...w)}}return o.length?(p.forEach((g,I)=>{let v=o[I],w=c[g].drawPosition;v&&eV({qualifyingParticipantId:v,structureId:l.structureId,drawPosition:w,tournamentRecord:e,drawDefinition:i})?.success&&s.push({participantId:v,drawPosition:w})}),q({result:je({...W,assignedParticipants:s})})):q({result:{error:iie}})}function use({drawDefinition:t,orderMap:e}){return t?((typeof e!="object"||!Object.values(e).every(i=>lt(i)))&&q({result:{error:re},context:{orderMap:e}}),t.structures||(t.structures=[]),t.structures.forEach(i=>{let r=e[i.structureId];r&&(i.structureOrder=r)}),t.structures.sort((i,r)=>vI(i.structureOrder)-vI(r.structureOrder)),{...W}):{error:$e}}function lN({drawDefinition:t}){let e=t.structures??[],i=t.links??[],r=new Map,n=g=>{let I=r.get(g)||r.set(g,{drawSources:[],drawTargets:[],progeny:[],sources:[],targets:[]})&&r.get(g);if(I&&!I?.stage){let v=e.find(w=>w.structureId===g);I.stage=v?.stage}return I},a={},s={},o=i.map(g=>{let I=g.source.structureId,v=g.target.structureId,w=n(I),y=n(v);return[jp,As,CM,Vp].includes(g.target.feedProfile)?(w?.targets.push(v),y?.sources.push(I)):g.target.feedProfile===ho&&(y?.drawSources.push(I),w?.drawTargets.push(v)),s[v]=s[v]||g.target.feedProfile===ho,a[v]=nt([...a[v]||[],I]).filter(Boolean),[g.source.structureId,g.target.structureId]});for(let g of r.keys()){let I=r.get(g);if(I){let v=I.targets??[];for(;v.length;){let w=v.pop(),y=w&&r[w];y?.targets?.length?v.push(...y.targets):y&&(I.rootStage=y.stage)}if(I.rootStage||(I.rootStage=I.stage),!I.targets?.length){let w=I.sources??[];for(;w.length;){let y=w.pop(),b=y&&r[y];if(b?.sources?.length){for(let S of b.sources)I.progeny?.includes(S)||I.progeny?.push(S);w.push(...b.sources)}}}}}let l=0;for(let g of r.keys()){let I=r.get(g);if(I&&I.rootStage===ze){let v=[I.drawTargets?.[0]],w=0;for(;v.length;){w+=1;let y=v.pop(),b=y?r.get(y):void 0;b?.drawTargets?.length&&v.push(b.drawTargets[0])}I.distanceFromMain=w,w>l&&(l=w)}}let u=o.length;Ce(0,Math.ceil(u/2)).forEach(()=>{o=Ce(0,u).map(g=>{let I=o[g],v=o.reduce((w,y)=>xn(I,y)?w.concat(...y):w,[])||[];return nt(I.concat(...v))})});let c=o[0],d=(g,I)=>Li(g,I).length===g.length,p=o.slice(1).reduce((g,I)=>g&&d(I,c),!0),f=[c].filter(Boolean),m=[c].filter(Boolean);e.forEach(g=>{let{structureId:I,stage:v}=g;f.find(w=>w.includes(I))||(f.push([I]),v!==Cr&&m.push([I]))});let h=p&&m.length===1;return!i?.length&&e.length===1&&n(e[0].structureId),{structureProfiles:Object.fromEntries(r),allStructuresLinked:h,maxQualifyingDepth:l,sourceStructureIds:a,hasDrawFeedProfile:s,structureGroups:f}}function cse({drawDefinition:t}){let{maxQualifyingDepth:e,structureProfiles:i}=lN({drawDefinition:t});for(let r of t.structures){let n=i[r.structureId];n.distanceFromMain&&(r.stageSequence=e+1-n.distanceFromMain)}return{...W}}function tV(t){let e=He(t,[{[hr]:!0,[In]:!0}]);if(e.error)return e;let{tournamentRecord:i,drawDefinition:r,structure:n,link:a}=t;return R$e({tournamentId:i.tournamentId,drawDefinition:r,structure:n,link:a})}function R$e(t){let e=He(t,[{[In]:!0,[OM]:!0},{link:!0,[qn]:Kn,[hte]:Z$}]);if(e.error)return e;let{drawDefinition:i,tournamentId:r,structure:n,eventId:a,link:s}=t,o=s.target.structureId,l=tt({drawDefinition:i,structureId:o});if(l.error)return q({stack:"attachQualifyingStructure",context:{targetStructureId:o},result:l});i.structures||(i.structures=[]),i.links||(i.links=[]),i.structures.push(n),i.links.push(s),cse({drawDefinition:i});let u=At({structure:n})?.matchUps||[];return Dd({drawDefinition:i,tournamentId:r,matchUps:u,eventId:a}),ii({drawDefinition:i,structureIds:[n.structureId]}),{...W}}function dse({drawDefinition:t,structureDetails:e}){if(!Array.isArray(e))return{error:re};if(!t)return{error:$e};let i=Object.assign({},...e.map(r=>{if(!wt(r))return;let{structureId:n,structureName:a}=r||{};if(!(!n||!a))return{[n]:a}}).filter(Boolean));if(!Object.values(i).length)return{error:Je};for(let r of t.structures||[]){let n=i[r.structureId];if(n&&(r.structureName=n),r.structures)for(let a of r.structures){let s=i[a.structureId];s&&(a.structureName=s)}}return{...W}}function iV({drawDefinition:t,timeItem:e}){if(!t)return{error:_a};if(!e)return{error:fB};let i=e&&Object.keys(e),r=["itemType","itemValue"];if(r.filter(a=>i.includes(a)).length!==r.length)return{error:pB};t.timeItems||(t.timeItems=[]);let n=new Date().toISOString();return Object.assign(e,{createdAt:n}),t.timeItems.push(e),hU({drawDefinition:t}),{...W}}function pse(t){let{tournamentRecord:e,drawDefinition:i,structureId:r,event:n}=t,a=He(t,[{drawDefinition:!0,structureId:!0}]);if(a.error)return a;let s=i.structures??[],o=s.find(I=>I.structureId===r);if(!o)return{error:vi};let l=s.find(({stage:I,stageSequence:v})=>I===Ae&&v===1),u=r===l?.structureId,c=s.filter(({stage:I})=>I===ze).map(Pa("structureId"));if(u&&!c.length)return{error:Ite};let d=c.includes(r),p=C$e({isQualifyingStructure:d,structure:o,...t});if(p?.error)return p;let{structureIdsToRemove:f,relatedStructureIdsMap:m}=N$e({qualifyingStructureIds:c,isQualifyingStructure:d,isMainStageSequence1:u,mainStageSequence1:l,drawDefinition:i,structureId:r}),{removedMatchUpIds:h,removedStructureIds:g}=A$e({relatedStructureIdsMap:m,qualifyingStructureIds:c,isMainStageSequence1:u,mainStageSequence1:l,drawDefinition:i,structureIdsToRemove:f,structureId:r});if(M$e({removedMatchUpIds:h,drawDefinition:i}),u){let I=(l.matchUps??[])?.map(Pa("matchUpId"));h.push(...I),l.positionAssignments=[],l.seedAssignments=[],l.matchUps=[],l.extensions&&(l.extensions=[])}return d&&cse({drawDefinition:i}),ku({tournamentId:e?.tournamentId,matchUpIds:h,action:"removeStructure",eventId:n?.eventId,drawDefinition:i}),ii({drawDefinition:i,eventId:n?.eventId}),{...W,removedMatchUpIds:h,removedStructureIds:g}}function C$e({isQualifyingStructure:t,tournamentRecord:e,drawDefinition:i,structureId:r,structure:n,event:a,force:s}){let o=[r];if(t){let l=c=>i.links?.find(d=>d.target.structureId===c),u=l(r)?.source.structureId;for(;u;)o.push(u),u=l(u)?.source.structureId}if(Zi({matchUpFilters:{structureIds:o},drawDefinition:i}).matchUps?.some(({score:l})=>fr({score:l}))){let l=Dt({tournamentRecord:e,drawDefinition:i,structure:n,event:a})?.appliedPolicies;if(!(s??l?.[ms]?.allowDeletionWithScoresPresent?.structures))return{error:iU}}return{...W}}function M$e({removedMatchUpIds:t,drawDefinition:e}){let{matchUps:i}=Zi({drawDefinition:e});i?.forEach(r=>{r.winnerMatchUpId&&t.includes(r.winnerMatchUpId)&&delete r.winnerMatchUpId,r.loserMatchUpId&&t.includes(r.loserMatchUpId)&&delete r.loserMatchUpId})}function N$e({qualifyingStructureIds:t,isQualifyingStructure:e,isMainStageSequence1:i,mainStageSequence1:r,drawDefinition:n,structureId:a}){let s=(n.structures??[]).map(Pa("structureId")),o=c=>n.links?.map(d=>d.source.structureId===c&&d.target.structureId!==r?.structureId&&d.target.structureId).filter(Boolean)??[],l=c=>n.links?.map(d=>t.includes(d.source.structureId)&&d.target.structureId===c&&d.source.structureId).filter(Boolean)??[],u=new Map;return s.forEach(c=>u.set(c,e?l(c):o(c))),{structureIdsToRemove:i?u.get(a):[a],relatedStructureIdsMap:u}}function A$e({relatedStructureIdsMap:t,qualifyingStructureIds:e,isMainStageSequence1:i,mainStageSequence1:r,drawDefinition:n,structureIdsToRemove:a,structureId:s}){let o=[],l=[];for(;a?.length;){let u=a.pop();l.push(...x$e({idBeingRemoved:u,drawDefinition:n}));let c=O$e({qualifyingStructureIds:e,isMainStageSequence1:i,idBeingRemoved:u,drawDefinition:n,structureId:s});o.push(...c.removedStructureIds);let d=k$e({relatedStructureIdsMap:t,mainStageSequence1:r,idBeingRemoved:u,structureId:s});d?.length&&a.push(...d)}return{removedMatchUpIds:l,removedStructureIds:o}}function k$e({idBeingRemoved:t,relatedStructureIdsMap:e,mainStageSequence1:i,structureId:r}){return t&&e.get(t)?.filter(n=>n!==i?.structureId||r===i.structureId)}function O$e({qualifyingStructureIds:t,isMainStageSequence1:e,idBeingRemoved:i,drawDefinition:r,structureId:n}){let a=[];return r.links=r.links?.filter(s=>s.source.structureId!==i&&s.target.structureId!==i)??[],(!e||e&&t.length||i!==n)&&(r.structures=(r.structures??[]).filter(s=>(i&&i===s.structureId&&a.push(i),s.structureId!==i))),{removedStructureIds:a}}function x$e({idBeingRemoved:t,drawDefinition:e}){let{structure:i}=tt({structureId:t,drawDefinition:e}),r=At({structure:i}).matchUps;return JB(r)}function eE({stageSequence:t=1,drawDefinition:e,drawSize:i,stage:r}){if(!e)return{error:$e};if(!b2({drawDefinition:e,stage:r}))return{error:gf};let n=xLe({drawDefinition:e,stage:r}),{qualifiersCount:a}=zv({drawDefinition:e,stageSequence:t,stage:r}),s=n+a;if(i<s)return{error:Ste};let{entryProfile:o}=y2({attributes:[{[r]:{drawSize:i}}],drawDefinition:e});return ii({drawDefinition:e}),{...W,entryProfile:o}}function fse({qualifiersCount:t=0,drawDefinition:e,stage:i}){return e?b2({drawDefinition:e,stage:i})?(y2({attributes:[{[i]:{qualifiersCount:t}}],drawDefinition:e}),ii({drawDefinition:e}),{...W}):{error:gf}:{error:$e}}function F$e({drawDefinition:t,drawSize:e}){if(!t)return{error:$e};let i=eE({stage:Cr,stageSequence:1,drawDefinition:t,drawSize:e});return i.error?i:(ii({drawDefinition:t}),{...W})}function mse(t){return F$e(t)}function hse({tournamentRecord:t,drawDefinition:e,event:i,structureId:r}){if(!e)return{error:$e};let n=e.structures?.find(s=>s.stage===ze&&s.structureId===r);if(!n)return{error:vi};if(n.matchUps?.some(({matchUpStatus:s,score:o})=>fr({score:o})??Ki.includes(s)))return{error:iU};let a=n.matchUps?.map(({matchUpId:s})=>s)||[];return n.positionAssignments=[],n.seedAssignments=[],n.matchUps=[],ku({tournamentId:t?.tournamentId,action:"resetVoluntaryConsolationStructure",matchUpIds:a,drawDefinition:e}),ii({tournamentId:t?.tournamentId,eventId:i?.eventId,drawDefinition:e,structureIds:[n.structureId]}),{...W}}var L$e="qualifierDrawPositionAssignment",_$e="withdrawParticipantAtDrawPosition",$$e="alternateDrawPositionAssignment",B$e="luckyLoserDrawPositionAssignment",hq="removeDrawPositionAssignment",gse="swapDrawPositionAssignments",V$e="modifyPairAssignment",j$e="adHocPositionSwap",G$e="modifyParticipantOtherName",gq="assignDrawPosition",H$e="removeSeededParticipant",W$e="assignDrawPositionBye",z$e="modifySeedAssignment",Ise="addPenalty",rV="MODIFY_PAIR",uN="QUALIFIER",nV="ALTERNATE",aV="WITHDRAW",qm="ASSIGN",Ox="REMOVE",sV="LUCKY",Qy="REMOVE_SEED",cN="SWAP",aw="NICKNAME",Im="SEED_VALUE",Ym="PENALTY",q$e={MODIFY_PAIR_ASSIGNMENT:rV,QUALIFYING_PARTICIPANT:uN,ALTERNATE_PARTICIPANT:nV,WITHDRAW_PARTICIPANT:aV,ASSIGN_PARTICIPANT:qm,LUCKY_PARTICIPANT:sV,REMOVE_ASSIGNMENT:Ox,SWAP_PARTICIPANTS:cN,ADD_NICKNAME:aw,REMOVE_SEED:Qy,ADD_PENALTY:Ym,ASSIGN_BYE:"BYE",SEED_VALUE:Im};function vse({tournamentRecord:t,drawDefinition:e,drawPositions:i,structureId:r,event:n}){if(!e)return{error:$e};if(!r)return{error:qa};if(i?.length!==2)return{error:re,drawPositions:i};let a=Or({drawDefinition:e}),{matchUps:s}=Zi({inContext:!0,drawDefinition:e,matchUpsMap:a}),{structure:o}=tt({drawDefinition:e,structureId:r});if(!o)return{error:vi};let l=Dt({tournamentRecord:t,drawDefinition:e,event:n}).appliedPolicies??{},u;if(o.structureType===gn?u=X$e({inContextDrawMatchUps:s,tournamentRecord:t,drawDefinition:e,drawPositions:i,matchUpsMap:a,structure:o,event:n}):u=Y$e({inContextDrawMatchUps:s,tournamentRecord:t,drawDefinition:e,drawPositions:i,matchUpsMap:a,structure:o,event:n}),u.error)return u;if(m2({structure:o,drawPositions:i}),gU({appliedPolicies:l,drawDefinition:e,positionAction:{name:gse,drawPositions:i,structureId:r}}),Pc({tournamentId:t?.tournamentId,drawDefinition:e,structure:o,event:n}),n.eventType===Ua){let c=At({matchUpFilters:{matchUpTypes:[La]},inContext:!0,structure:o}).matchUps.filter(p=>p.drawPositions?.some(f=>i.includes(f))),d=At({matchUpFilters:{matchUpTypes:[La]},structure:o}).matchUps;c.forEach(p=>{(p.sides||[]).forEach(f=>{let m=f?.drawPosition;if(i.includes(m)){let h=f.participantId,g=d.find(({matchUpId:v})=>v===p.matchUpId),I=p?.sides?.reduce((v,w,y)=>w.drawPosition===m?y:v,void 0);Y2({inContextTargetMatchUp:p,drawPositionSideIndex:I,teamParticipantId:h,tournamentRecord:t,drawDefinition:e,matchUp:g,event:n})}})})}return ii({drawDefinition:e,structureIds:[r]}),{...W}}function Y$e({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPositions:r,matchUpsMap:n,structure:a,event:s}){let o=a?.positionAssignments.filter(u=>r?.includes(u.drawPosition));if(!o)return{error:re,structure:a,info:"Missing positionAssignments"};if(o.filter(({bye:u})=>u).length===2)return{...W};if(o.filter(({qualifier:u})=>u).length===2)return{...W};let l=o.some(({qualifier:u})=>u);return o.some(({bye:u})=>u)&&!l?yse({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:o,matchUpsMap:n,structure:a,event:s}):K$e({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:o,matchUpsMap:n,structure:a,event:s})}function yse({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:r,matchUpsMap:n,structure:a,event:s}){let o=r.find(({bye:m})=>m),l=r.find(({participantId:m})=>m),u=o.drawPosition,{participantId:c,drawPosition:d}=l,{structureId:p}=a,f=rw({drawPosition:u,inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:p,matchUpsMap:n});return f.error||(f=rw({drawPosition:d,inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:p,matchUpsMap:n}),f.error)||(Ja({drawPosition:d,tournamentRecord:e,drawDefinition:i,structureId:p,matchUpsMap:n,event:s}),f=hl({drawPosition:u,inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:p,participantId:c,matchUpsMap:n,event:s}),f.error)?f:{...W}}function K$e({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:r,matchUpsMap:n,structure:a,event:s}){let o=Object.assign({},...r.map((l,u)=>{let{drawPosition:c}=l,d={...r[1-u],drawPosition:c};return{[c]:d}}));return a.positionAssignments=a.positionAssignments.map(l=>o[l.drawPosition]||l),X2({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,matchUpsMap:n,assignments:r,structure:a,event:s}),{...W}}function X$e({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPositions:r,matchUpsMap:n,structure:a,event:s}){let o=a.structures?.reduce((u,c)=>{let d=c?.positionAssignments.filter(p=>r?.includes(p.drawPosition));return d&&u.push(...d),u},[]);if(o.filter(({bye:u})=>u).length===2)return{...W};if(o.filter(({qualifier:u})=>u).length===2)return{...W};X2({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,matchUpsMap:n,assignments:o,structure:a,event:s});let l=o.some(({qualifier:u})=>u);if(o.some(({bye:u})=>u)&&!l)yse({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:o,matchUpsMap:n,structure:a,event:s});else{let u=Oe(o,!1,!0);o.forEach((c,d)=>{let p=u[1-d].participantId;c.qualifier=u[1-d].qualifier,c.participantId=p})}return{...W}}function bse({tournamentRecord:t,drawDefinition:e,participantId:i,structureId:r}){let n="removeSeededParticipant";if(!t)return{error:ve};if(!e)return{error:$e};let a=(e.structures??[]).find(s=>s.structureId===r);return a?!a.stage||![Ae,ze].includes(a.stage)||a.stage===Ae&&a.stageSequence!==1?q({result:{error:mf},stack:n}):a.seedAssignments?.find(s=>s.participantId===i)?{...W}:q({info:"participant not seeded",result:{error:Br},context:{participantId:i}}):q({result:{error:vi},stack:n})}function VU({targetEntryRound:t=1,finishingPositions:e,sourceRoundNumber:i,sourceStructureId:r,targetStructureId:n,linkType:a=mu}){return!r||!n?{error:qa}:{link:je({linkType:a,source:{roundNumber:i,structureId:r,finishingPositions:e},target:{feedProfile:ho,roundNumber:t,structureId:n}})}}function Qh({matchUp:t,tieFormat:e,isMock:i,uuids:r}){let{collectionDefinitions:n}=e??{};return{tieMatchUps:(n??[]).map(a=>jU({matchUp:t,collectionDefinition:a,uuids:r,isMock:i})).filter(Boolean).flat()}}function jU({collectionPositionOffset:t=0,collectionDefinition:e,matchUpsLimit:i,matchUp:r,isMock:n,uuids:a}){let{matchUpCount:s,matchUpType:o,collectionId:l,processCodes:u}=e||{},c=i??s??0,d=p=>{if(!n&&!r?.isMock)return a?.pop()??Ct();let f=e?.collectionId;return a?.pop()??`${r?.matchUpId}-${f}-TMU-${p+1}`};return Ce(0,c).map(p=>{let f=t+p+1;return{sides:[{sideNumber:1},{sideNumber:2}],matchUpId:d(p),matchUpStatus:_i,collectionPosition:f,collectionId:l,processCodes:u,matchUpType:o,isMock:n}})}function oV({roundPosition:t,roundNumber:e,idPrefix:i,uuids:r}){return i?`${i}-${e}-${t}`:r?.pop()||Ct()}function tE({includeMatchUpType:t,matchUpType:e,roundNumber:i,matchUps:r,idPrefix:n,isMock:a,uuids:s,nodes:o}){let l=0,u=[],c=1,d=i-1,p=o?.length;for(;l<(p||0);){let f=o?.[l],m=o?.[l+1];d&&(f.roundNumber=d),m&&d&&(m.roundNumber=d);let h=oV({roundPosition:c,roundNumber:i,idPrefix:n,uuids:s}),g={roundPosition:c,children:[f,m],matchUpId:h};u.push(g);let I={drawPositions:g.children.map(v=>v?.drawPosition).filter(Boolean),matchUpStatus:_i,matchUpId:g.matchUpId,roundPosition:c,roundNumber:i};t&&e&&(I.matchUpType=e),a&&(I.isMock=!0),r.push(I),c++,l+=2}return{roundNodes:u,matchUps:r}}function gl({finishingPositionOffset:t,finishingPositionLimit:e,qualifyingRoundNumber:i,qualifyingPositions:r,matchUpType:n,roundLimit:a,idPrefix:s,drawSize:o,isMock:l,uuids:u}){if(isNaN(o)||o<2||r&&o<=r)return{matchUps:[],roundsCount:0};if(r&&(!Ro(o)||o%r)){let g=r;for(;g<o;)g=2*g;o=g}let c=r&&!(o%2)&&(!isNaN(r)||i&&!isNaN(i))&&(o/r===Math.round(o/r)||i&&o/i===Math.round(o/i));if(!Ro(o)&&!c)return{matchUps:[],roundsCount:0};let d=Ce(1,o+1).map(g=>({drawPosition:g})),p,f=[],m=1;for({roundNodes:p,matchUps:f}=tE({matchUpType:n,roundNumber:m,idPrefix:s,matchUps:f,isMock:l,nodes:d,uuids:u}),m++,a=a??i;p.length>1;)r&&p.length===r&&(a=m-1),{roundNodes:p,matchUps:f}=tE({nodes:p,matchUpType:n,roundNumber:m,idPrefix:s,matchUps:f,isMock:l,uuids:u}),m++;let h=m-1;return f=MU({finishingPositionOffset:t,finishingPositionLimit:e,roundsCount:h,roundLimit:a,matchUps:f}),a?f=f.filter(g=>a&&(g.roundNumber??0)<=a):a=m-1,{drawSize:o,matchUps:f,roundsCount:h,roundLimit:a}}function J$e(t,e){return t.drawDefinition?t.drawSize&&!lt(t.drawSize)||t.participantsCount&&!lt(t.participantsCount)||t.qualifyingPositions&&!lt(t.qualifyingPositions)?q({result:{error:re},stack:e}):t.drawSize?t.qualifyingPositions&&t.qualifyingPositions>=t.drawSize?q({result:{error:re},context:{drawSize:t.drawSize,qualifyingPositions:t.qualifyingPositions},stack:e}):null:q({result:{error:QS},context:{drawSize:t.drawSize},stack:e}):q({result:{error:$e},stack:e})}function Q$e(t,e,i){let{structureProfiles:r}=lN({drawDefinition:t});return r[e]||q({result:{error:vi},context:{targetStructureId:e},stack:i})}function Z$e(t){let{maxRoundNumber:e,structures:i,groupCount:r}=LU(t);return{qualifiersCount:r,roundLimit:e,structure:i[0],finishingPositions:[1]}}function eBe(t){let{drawSize:e,matchUps:i,roundLimit:r,roundsCount:n}=gl(t);r||(r=n);let a=ss({structureName:t.structureName,structureId:t.structureId,qualifyingRoundNumber:r,stage:ze,matchUpFormat:t.matchUpFormat,stageSequence:t.stageSequence,matchUpType:t.matchUpType,roundLimit:r,matchUps:i});t.roundTarget&&Ft({extension:{name:El,value:t.roundTarget},element:a});let s=i?.filter(o=>o.roundNumber===r)?.length??0;return{drawSize:e,structure:a,matchUps:i,roundLimit:r,qualifiersCount:s}}function lV(t){let e="generateQualifyingStructure",i=J$e(t,e);if(i)return i;let r=t.drawSize??q$(t.participantsCount),{hasExistingDrawDefinition:n,qualifyingRoundNumber:a,qualifyingPositions:s,targetStructureId:o,structureOptions:l,appliedPolicies:u,qualifyingOnly:c,drawDefinition:d,matchUpFormat:p,structureName:f,structureId:m,roundTarget:h,tieFormat:g,drawType:I,idPrefix:v,isMock:w,uuids:y}=t,b=Q$e(d,o,e);if(b?.error)return b;let S=d.matchUpType,U=1,T=h?`${h}-`:"",P=typeof b=="object"&&"stage"in b&&b.stage===ze,D=u?.[Sc]?.namingConventions?.pre??BLe[Sc]?.namingConventions?.pre,E=P&&D?`${D}-`:"",R=f??(T?`${E}${Qr(ze)} ${T}`:`${E}${Qr(ze)}`),C,M,N,A,O;if(I===eo){let x=Z$e({structureName:f??R,structureId:m??y?.pop(),hasExistingDrawDefinition:n,stage:ze,structureOptions:l,appliedPolicies:u,qualifyingOnly:c,stageSequence:U,matchUpType:S,roundTarget:h,tieFormat:g,idPrefix:v,drawSize:r,isMock:w,uuids:y});A=x.qualifiersCount,N=x.roundLimit,C=x.structure,O=x.finishingPositions}else{let x=eBe({qualifyingRoundNumber:a,qualifyingPositions:s,matchUpType:S,idPrefix:v,drawSize:r,isMock:w,uuids:y,structureName:f??R,structureId:m??y?.pop(),matchUpFormat:p,stageSequence:U,roundTarget:h});r=x.drawSize,C=x.structure,N=x.roundLimit,A=x.qualifiersCount}let k=I===eo?fu:mu,F=C&&N&&VU({sourceStructureId:C.structureId,sourceRoundNumber:N,targetStructureId:o,finishingPositions:O,linkType:k})?.link;return g&&(M=At({structure:C})?.matchUps||[],M?.forEach(x=>{let{tieMatchUps:L}=Qh({tieFormat:g,matchUp:x,isMock:w});Object.assign(x,{tieMatchUps:L,matchUpType:S})})),{qualifyingDrawPositionsCount:r,qualifiersCount:A,...W,structure:C,link:F}}function wse(t){if(!t.tournamentRecord)return{error:ve};let e=tBe(t);return e.error,e}function tBe(t){if(!t.drawDefinition)return{error:$e};if(!t.targetStructureId)return{error:qa};let e=lV(t);if(e.error)return e;let{structure:i,link:r}=e;return!i||!r?{error:re}:tV({tournamentRecord:t.tournamentRecord,drawDefinition:t.drawDefinition,structure:i,link:r})}function Sse(t){let e=He(t,[{[In]:!0,[NM]:!0,[Pl]:!0},{[BFe]:!0,[qr]:d=>Number.isInteger(d)&&d>0},{[qr]:d=>Array.isArray(d)&&d.length===2&&d.every(ni),[Ba]:Ia,participantIds:!0}]);if(e.error)return e;let{drawDefinition:i,structureId:r,tournamentRecord:n,event:a}=t,{structure:s}=tt({drawDefinition:i,structureId:r});if(!s)return{error:vi};if(!Hn({structure:s}))return{error:mf};let o=d=>d.sides?.map(p=>p.participantId).some(p=>t.participantIds.includes(p)),l=d=>d.roundNumber===t.roundNumber,u=d=>!fr(d),c=(s?.matchUps??[]).filter(l).filter(u).filter(o);if(c.length!==2)return{error:Ia};for(let d of c){let p=d?.sides?.find(f=>t.participantIds.includes(f?.participantId));if(p){let f=t.participantIds.find(m=>m!==p?.participantId);p.participantId=f,Ut({tournamentId:n?.tournamentId,eventId:a?.eventId,drawDefinition:i,matchUp:d})}}return ii({drawDefinition:i,structureIds:[r]}),{...W}}function iBe({includeMatchUpType:t,drawPosition:e,roundNumber:i,matchUpType:r,idPrefix:n,matchUps:a,isMock:s,uuids:o,nodes:l,fed:u}){let c=l.length,d=e?e-c:void 0,p=Ce(0,c).map(h=>d?d+h:void 0),f=[];for(let h=0;h<c;h++){let g=p.shift(),I={drawPosition:g,fed:u+1,feed:!0},v=l[h];v.roundNumber=i-1;let w=oV({roundPosition:v.roundPosition,roundNumber:i,idPrefix:n,uuids:o}),y={roundPosition:v.roundPosition,drawPositions:[g],matchUpStatus:_i,roundNumber:i,matchUpId:w};t&&(y.matchUpType=r),s&&(y.isMock=!0),a.push(y);let b={children:[v,I]};f.push(b)}let m=e?e-c:void 0;return{roundNodes:f,matchUps:a,drawPosition:m}}function Rd(t){let e=t.drawSize,{feedRoundsProfile:i,feedRounds:r=0,skipRounds:n=0,baseDrawSize:a}=t,{linkFedFinishingRoundNumbers:s,finishingPositionOffset:o,linkFedRoundNumbers:l,feedsFromFinal:u,isConsolation:c,matchUpType:d,idPrefix:p,isMock:f,uuids:m,fmlc:h}=t;a=a??M(e);let g=rBe({drawSize:a}),I=g.length,v=0;if(i?.length)v=i.reduce((N,A)=>N+A,0);else if(e){let N=e-a;i=g.filter(A=>A<=N?(N-=A,!0):!1),v=i.reduce((A,O)=>A+O,0),r=i.length}else n>=I?r=0:u&&(r=I-u,n=0),i=g.filter((N,A)=>u&&!r||r&&A>=n+r||A<n?0:N),v=i.reduce((N,A)=>N+A,0),r=i.length;let w=[...g,...i].sort((N,A)=>A-N),y=w.length,b=[...(l??[]).map(N=>N-1),...(s??[]).map(N=>y-N)].map(N=>w[N]).reduce((N,A)=>N+A,0);v=v-b;let S=0,U=[],T,P=1,D=Ce(0,a).map((N,A)=>({drawPosition:A+1+v})),E=v+1;for(let N of g){if({roundNodes:T,matchUps:U}=tE({matchUpType:d,roundNumber:P,idPrefix:p,matchUps:U,isMock:f,nodes:D,uuids:m}),P++,i.includes(N)){let A=Sa(i)[N],O=Ce(0,A),k=y+1-P,F=s?.includes(k)??l?.includes(P);O.forEach(()=>{({roundNodes:T,matchUps:U,drawPosition:E}=iBe({drawPosition:!F&&E||void 0,nodes:T,matchUpType:d,roundNumber:P,idPrefix:p,matchUps:U,isMock:f,uuids:m,fed:S})),P++,S+=1})}D=T}y!==P-1&&console.log("ERROR");let R=a-v;U=MU({finishingPositionOffset:c?R:o,positionsFed:v,roundsCount:y,matchUps:U,fmlc:h});let C=T?.length?T[0]:T;return C&&(C.roundNumber=P-1,C.matchUps=U),{draw:C,matchUps:U,roundsCount:y};function M(N){let A=Y$(N);return A>N?A/2:A}}function rBe({drawSize:t}){let e=Math.ceil(Math.log(t)/Math.log(2));return Ce(0,e).reverse().map(i=>Math.pow(2,i))}function Hg(t){let{finishingPositionOffset:e=0,addNameBaseToAttributeName:i,playoffStructureNameBase:r,finishingPositionNaming:n,finishingPositionLimit:a,playoffAttributes:s,stageSequence:o=1,exitProfile:l="0",exitProfileLimit:u,roundOffsetLimit:c,roundOffset:d=0,drawDefinition:p,staggeredEntry:f,sequenceLimit:m,stage:h=Ae,drawSize:g,idPrefix:I,isMock:v,uuids:w}=t;if(!(!s||!u||s?.[l])||g<2||m&&o>m)return{};let y=[],b=[],S=[],U=t.matchUpType??p?.matchUpType,T=e+1,P=e+g,D=`${T}-${P}`,E=s?.[l],R=r&&`${r} `||"",C=s?.[D]??n?.[D],M=t.structureName||C?.name||E?.name&&(i?`${R}${E?.name}`:E.name)||`${R}${D}`,N=C?.abbreviation??E?.abbreviation,A=t.structureId??E?.structureId??w?.pop(),O={idPrefix:I&&`${I}-${M}-RP`,finishingPositionOffset:e,matchUpType:U,drawSize:g,isMock:v,uuids:w},{matchUps:k}=f?Rd(O):gl(O),F=ss({structureAbbreviation:N,stageSequence:o,structureName:M,matchUpType:U,roundOffset:d,structureId:A,matchUps:k,stage:h});y.push(...k),b.push(F);let x=Math.ceil(Math.log(g)/Math.log(2)),L=c?Math.min(c-d,x):(!a||T<a)&&x||0;return g>2&&Ce(1,L+1).forEach(V=>$(V)),{structureId:F.structureId,matchUps:y,structureName:M,structures:b,links:S,...W};function $(V){let _=g/Math.pow(2,V);if(_<2)return;let B=g/Math.pow(2,V)+e;if(a&&B+1>a)return;let{structures:G,structureId:j,matchUps:K,links:Y}=Hg({finishingPositionOffset:B,exitProfile:`${l}-${V}`,roundOffset:d+V,stageSequence:o+1,drawSize:_,addNameBaseToAttributeName:i,playoffStructureNameBase:r,finishingPositionNaming:n,finishingPositionLimit:a,playoffAttributes:s,exitProfileLimit:u,roundOffsetLimit:c,drawDefinition:p,sequenceLimit:m,matchUpType:U,idPrefix:I,uuids:w,stage:h});if(F.structureId&&j){let X={linkType:hu,source:{roundNumber:V,structureId:F.structureId},target:{roundNumber:1,feedProfile:As,structureId:j}};Y&&F&&Y.push(X),Y?.length&&S.push(...Y)}return G?.length&&b.push(...G),K?.length&&y.push(...K),{structureId:j,childLinks:Y,structures:b}}}function uV({drawDefinition:t,matchUpsMap:e,structureId:i}){let r=tt({drawDefinition:t,structureId:i});if(r.error)return q({result:r});let{matchUps:n}=At({structure:r.structure,matchUpsMap:e});return{...Sn({matchUps:n}),matchUps:n,matchUpsMap:e}}function Iq({finishingPositions:t,drawDefinition:e,structureId:i}){let{roundProfile:r}=uV({drawDefinition:e,structureId:i});return(r&&Object.keys(r))?.reduce((n,a)=>(Use(r?.[a]).forEach(s=>{t.forEach(o=>{nBe({position:o,rangeDefinition:s})&&(n[o]={roundNumber:a})})}),n),{})}function nBe({position:t,rangeDefinition:e}){if(!Array.isArray(e)||e.reduce((n,a)=>n||isNaN(a),!1))return!1;let[i,r]=e;return Ce(i,(r||i)+1).includes(t)}function Use(t){return[nt(t?.finishingPositionRange?.loser||[]),nt(t?.finishingPositionRange?.winner||[])]}function aBe(t){return Use(t).map(e=>Ce(e[0],e[1]&&e[1]+1||e[0]+1))}function Xv({drawDefinition:t,structureIds:e,matchUpsMap:i}){if(e&&!Array.isArray(e))return{error:re,context:{structureIds:e}};if(!t)return{error:$e};e=e??(t.structures??[]).filter(a=>a.stage!==ze).map(({structureId:a})=>a);let r=e.map(a=>{let{roundProfile:s}=uV({drawDefinition:t,matchUpsMap:i,structureId:a});return(s&&Object.values(s))?.map(aBe).flat()}).flat(),n=r.filter(a=>a?.length===1).sort(nr).flat();return{positionsNotPlayedOff:nt(r.flat()).filter(a=>!n.includes(a)),positionsPlayedOff:n}}function Tse({excludeRoundNumbers:t=[],playoffPositions:e=[],drawDefinition:i,structureId:r}){if(!i)return{error:$e};if(!r)return{error:qa};if(!e)return{error:Je,info:"missing playoffPositions"};let n=Xv({drawDefinition:i});if(n.error)return n;let a=n.positionsPlayedOff,s=e.filter(I=>!a.includes(I)),o=Iq({finishingPositions:s,drawDefinition:i,structureId:r}),l=Object.values(o).reduce((I,v)=>I.includes(v.roundNumber)?I:I.concat(v.roundNumber),[]).map(I=>Ke(I)).filter(I=>!t.includes(I)),u=Iq({finishingPositions:a,drawDefinition:i,structureId:r}),c=u?Object.values(u):[],d=u?c.reduce((I,v)=>I.includes(v.roundNumber)?I:I.concat(v.roundNumber),[]).map(I=>Ke(I)):[],p=l.filter(I=>!d.includes(I)).sort(nr),{roundProfile:f}=uV({drawDefinition:i,structureId:r}),m=p.map(I=>{let v=f?.[I].finishingPositionRange.loser,[w,y]=v??[0,0];return Ce(w,(y||w)+1)}).flat().sort(nr),{playoffRoundsRanges:h}=sBe({playoffSourceRounds:p,roundProfile:f}),g=[...p,...d];return{playoffPositionsReturned:m,playedOffSourceRounds:d,playoffRoundsRanges:h,playoffSourceRounds:p,sourceRounds:g,roundProfile:f}}function sBe({playoffSourceRounds:t,roundProfile:e}){return{playoffRoundsRanges:t.map(i=>{let r=e[i].finishingPositionRange.loser,[n,a]=r,s=Ce(n,(a||n)+1);return{finishingPositionRange:r.join("-"),finishingPositions:s,roundNumber:i}})}}function GU({drawDefinition:t,structureId:e}){if(!t)return{error:$e};let{matchUps:i,matchUpsMap:r}=An({inContext:!0,drawDefinition:t}),{positionsNotPlayedOff:n,positionsPlayedOff:a}=Xv({drawDefinition:t,matchUpsMap:r}),{structures:s}=io({drawDefinition:t}),o=s.filter(u=>!e&&u.stage!==Cr||u.structureId===e),l={};for(let u of o){let c=u?.structureId,d=oBe({playoffPositions:n,drawDefinition:t,structure:u,matchUps:i}),{error:p,...f}=d;if(p)return d;l[c]={structureId:c,...f}}return e?{positionsPlayedOff:a,...l[e]}:{availablePlayoffProfiles:Object.values(l),availablePlayoffRounds:Object.values(l),positionsPlayedOff:a}}function oBe({playoffPositions:t,drawDefinition:e,structure:i,matchUps:r}){let n=i?.structureId,{links:a}=Gv({drawDefinition:e,structureId:n});if(i.structureType===gn||i.structures){let f=Kt({structure:i})?.positionAssignments?.length,m=i.structures.length,h=(f??0)/m,g=a.source?.flatMap(({source:D})=>D?.finishingPositions||[])||[],I=Ce(1,h+1).filter(D=>!g.includes(D)),v=r.find(D=>D.containerStructureId===n&&D.finishingPositionRange)?.finishingPositionRange?.winner||[0,1],w=a?.source.map(({target:D})=>D.structureId),{positionsPlayedOff:y=[],positionsNotPlayedOff:b=[]}=Xv({structureIds:w,drawDefinition:e}),S=new Set([...y,...b]),U=Ce(v[0],v[1]+1).filter(D=>!S.has(D)),T=wr(U,U.length/I.length),P=I.map((D,E)=>{let R=T[E],C=[Math.min(...R||[]),Math.max(...R||[])].join("-");return{finishingPosition:D,finishingPositions:R,finishingPositionRange:C}});return{positionsNotPlayedOff:U,playoffFinishingPositionRanges:P,finishingPositionsAvailable:I,finishingPositionsPlayedOff:g,positionsPlayedOff:y,groupCount:m,groupSize:h}}let s=a?.source?.filter(f=>f.linkCondition!==fl).map(f=>f.source?.roundNumber)||[],o=a?.source?.filter(f=>f.linkCondition===fl).map(f=>f.source?.roundNumber)||[],l=Tse({excludeRoundNumbers:s,playoffPositions:t,drawDefinition:e,structureId:n}),u=l?.playoffSourceRounds?[...l?.playoffSourceRounds||[]]:void 0,c=[...l?.playoffRoundsRanges||[]],{roundProfile:d,error:p}=l;for(let f of o){let m=a?.source.find(w=>w.source.roundNumber===f),h=m?.target.roundNumber,g=m?.target.structureId,I=r.filter(({roundNumber:w,structureId:y})=>y===g&&w===h),v=I.filter(({sides:w})=>w.find(y=>y.participantFed&&!y.participantId)).length;if(u&&v===I.length){u.push(f);let w=d?.[f]?.finishingPositionRange?.loser;if(w){let y=Math.min(...w),b=y+v,S=Ce(y,b),U={finishingPositionRange:[y,b-1].join("-"),finishingPositions:S,roundNumber:f};c.push(U)}}}return u&&u.sort(nr),c.sort((f,m)=>f.roundNumber-m.roundNumber),{playoffRounds:u,playoffRoundsRanges:c,error:p}}function lBe({playoffGroups:t,drawDefinition:e,structureId:i}){if(!e)return{error:$e};if(!ni(i)||!Array.isArray(t))return{error:re};let r=t.map(({finishingPositions:n})=>n).flat();return{positionRangeMap:GU({drawDefinition:e,structureId:i}).playoffFinishingPositionRanges?.filter(n=>r.includes(n.finishingPosition))?.reduce((n,a)=>(n[a.finishingPosition]=a,n),{})}}function Dse(t){let{finishingPositionOffset:e=0,playoffAttributes:i,stageSequence:r=1,staggeredEntry:n,structureName:a,stage:s=Ae,matchUpType:o,structureId:l,idPrefix:u,drawSize:c,isMock:d,uuids:p}=t,f={finishingPositionOffset:e,matchUpType:o,drawSize:c,idPrefix:u,isMock:d,uuids:p},{matchUps:m}=n?Rd(f):gl(f),h=ss({structureName:a||i?.["0"]?.name||Qr(Ae),structureId:l||p?.pop(),stageSequence:r,matchUpType:o,matchUps:m,stage:s}),g=[h],I=[];if(c>2){let v=c/2,{matchUps:w}=gl({finishingPositionOffset:e+v,idPrefix:u&&`${u}-c`,drawSize:v,matchUpType:o,isMock:d}),y=Qr(tn),b=i?.["0-1"]?.name??t.consolationStructureName??(a?`${a} ${y}`:y),S=ss({structureName:b,matchUps:w,structureId:p?.pop(),stage:tn,stageSequence:1,matchUpType:o});g.push(S);let U={linkType:hu,source:{roundNumber:1,structureId:h.structureId},target:{roundNumber:1,feedProfile:As,structureId:S.structureId}};I.push(U)}return{...W,structures:g,links:I}}function Pse({consolationStructure:t,roundOffset:e=0,mainStructure:i,roundsCount:r,feedPolicy:n,fmlc:a}){let s=t.matchUps.reduce((u,c)=>(c.drawPositions||[]).filter(Boolean).length&&!u.includes(c.roundNumber)?u.concat(c.roundNumber):u,[]),o=n?.roundGroupedOrder||[],l=n?.roundFeedProfiles;return Ce(1+e,r+1+e).map(u=>{let c=l?.[u-1]?l[u-1]:u%2&&As||jp,d=u-e<=2?u-e:(u-e-2)*2+2,p={linkType:hu,source:{roundNumber:u,structureId:i.structureId},target:{feedProfile:c,roundNumber:d,structureId:t.structureId}},f=o[u-1];return f&&(p.target.groupedOrder=f),la()&&(p.source.structureName=i.structureName,p.target.structureName=t.structureName),u===2&&a&&(p.linkCondition=fl,p.target.feedProfile=As),s.includes(d)?p:void 0}).filter(Boolean)}function Ese(t){let{playoffStructureNameBase:e,finishingPositionOffset:i,stageSequence:r=1,playoffAttributes:n,structureNameMap:a,staggeredEntry:s,stage:o=Ae,matchUpType:l,structureId:u,drawSize:c,idPrefix:d,isMock:p,uuids:f}=t,m={finishingPositionOffset:i,matchUpType:l,drawSize:c,idPrefix:d,isMock:p,uuids:f},{matchUps:h,roundsCount:g}=s?Rd(m):gl(m),I=t.structureName??n?.["0"]?.name??Qr(Ae),v=dd({structureId:u||f?.pop(),structureName:I,stageSequence:r,matchUpType:l,matchUps:h,stage:o}),w=[v],y=[];if(c>2){let b=[0,2].slice(0,c/16).map((S,U)=>{let T=U+1,{consolationStructure:P}=uBe({idPrefix:d&&`${d}-c${U}`,structureId:f?.pop(),playoffStructureNameBase:e,playoffAttributes:n,structureNameMap:a,stageSequence:T,roundOffset:S,matchUpType:l,drawSize:c,isMock:p,index:U,uuids:f});w.push(P);let D=Pse({consolationStructure:P,roundsCount:2,mainStructure:v,roundOffset:S});return{consolationStructure:P,links:D}}).map(S=>S.links).flat();if(y.push(...b),c>=4&&c<=16||c>32){let{matchUps:S}=gl({idPrefix:d&&`${d}-p3t4`,finishingPositionOffset:2,drawSize:2,matchUpType:l,isMock:p}),U=n?.["3-4"]?.name??Qr(Ti),T=a?.[U]||U,P=e?`${e} ${T}`:T,D=dd({structureId:f?.pop(),matchUps:S,stageSequence:2,stage:Ti,structureName:P,matchUpType:l}),E={linkType:hu,source:{roundNumber:g-1,structureId:v.structureId},target:{structureId:D.structureId,feedProfile:As,roundNumber:1}};w.push(D),y.push(E)}}return{structures:w,links:y,...W}}function uBe({playoffStructureNameBase:t,stageSequence:e=1,playoffAttributes:i,structureNameMap:r,roundOffset:n=0,matchUpType:a,structureId:s,idPrefix:o,drawSize:l,isMock:u,index:c,uuids:d}){let p=l/(2*Math.pow(2,n)),{matchUps:f,roundsCount:m}=Rd({finishingPositionOffset:p,baseDrawSize:p,isConsolation:!0,feedRounds:1,matchUpType:a,idPrefix:o,isMock:u,uuids:d}),h=c===0&&i?.["0-1"]?.name||c===1&&i?.["0-3"]?.name||`${Qr(tn)} ${c+1}`,g=r?.[h]||h,I=t?`${t} ${g}`:g;return{consolationStructure:dd({matchUps:f,stage:tn,structureName:I,stageSequence:e,matchUpType:a,structureId:s}),consolationRoundsCount:m}}function $f(t){let{finishingPositionOffset:e,stageSequence:i=1,playoffAttributes:r,feedsFromFinal:n,staggeredEntry:a,structureName:s,stage:o=Ae,structureId:l,matchUpType:u,skipRounds:c,feedRounds:d,idPrefix:p,drawSize:f,isMock:m,uuids:h,fmlc:g}=t,I=t.feedPolicy||t.policyDefinitions?.[CI]||t.appliedPolicies?.[CI],v={finishingPositionOffset:e,matchUpType:u,skipRounds:c,drawSize:f,idPrefix:p,isMock:m,uuids:h},{matchUps:w}=a?Rd(v):gl(v),y=ss({structureName:s||r?.["0"]?.name||Qr(Ae),structureId:l||h?.pop(),stageSequence:i,matchUpType:u,matchUps:w,stage:o}),b=[y],S=[],U=f/2,{matchUps:T,roundsCount:P}=Rd({finishingPositionOffset:U,idPrefix:p&&`${p}-c`,isConsolation:!0,feedsFromFinal:n,baseDrawSize:U,matchUpType:u,feedRounds:d,skipRounds:c,isMock:m,uuids:h,fmlc:g});if(f>2){let D=r?.["0-1"]?.name??Qr(tn),E=t.playoffStructureNameBase?`${t.playoffStructureNameBase} ${D}`:D,R=ss({matchUps:T,structureId:h?.pop(),stage:tn,stageSequence:1,structureName:E,matchUpType:u});b.push(R);let C=Pse({consolationStructure:R,mainStructure:y,roundsCount:P,feedPolicy:I,fmlc:g});S.push(...C)}return{...W,structures:b,links:S}}function Rse({requireSequential:t=!0,playoffMatchUpFormat:e,playoffAttributes:i,sourceStructureId:r,policyDefinitions:n,stageSequence:a,drawDefinition:s,playoffGroups:o,matchUpType:l,feedPolicy:u,groupCount:c,idPrefix:d,isMock:p,uuids:f}){u=u||n?.[CI];let m="processPlayoffGroups",h=0,g=[],I=[],v=[],{error:w,positionRangeMap:y}=lBe({structureId:r,drawDefinition:s,playoffGroups:o});if(w)return q({result:{error:w},stack:m});if(!(!y||o?.every(b=>{let{finishingPositions:S=[]}=b;if(!S.length)return!1;let U=[...S].sort(nr).map((T,P)=>(S[P+1]||T)-T).every(T=>T<2);return(!t||U)&&S.every(T=>y[T])})))return q({context:{validFinishingPositions:Object.values(y)},result:{error:re},stack:m});for(let b of o){let S=b.finishingPositions,U=y&&S.flatMap(N=>y[N]?.finishingPositions??[]),T=c*S.length,P=Cv(T),D=P===2&&Jo||b.drawType||Jo;U&&(h=Math.min(...U)-1);let E=U&&`${Math.min(...U)}-${Math.max(...U)}`,R=b.structureName||E&&b.playoffAttributes?.[E]?.name||b.playoffAttributes?.["0"]?.name,C={addNameBaseToAttributeName:b.addNameBaseToAttributeName,playoffStructureNameBase:b.playoffStructureNameBase,finishingPositionNaming:b.finishingPositionNaming,finishingPositionLimit:b.finishingPositionLimit,structureId:b.structureId??f?.pop(),playoffAttributes:b.playoffAttributes,structureNameMap:b.structureNameMap,sequenceLimit:b.sequenceLimit,structureName:R,idPrefix:d&&`${d}-po`,appliedPolicies:n,finishingPositionOffset:h,stage:Ti,stageSequence:a,matchUpType:l,drawSize:P,isMock:p,uuids:f},M=({playoffStructures:N,playoffLinks:A})=>{let[O]=N,k=RT({playoffStructureId:O.structureId,finishingPositions:S,sourceStructureId:r});v.push(k,...A),I.push(...N),g.push({structureId:O.structureId,finishingPositions:S}),h+=T};if(D===Jo){let{matchUps:N}=gl({finishingPositionLimit:h+T,idPrefix:d&&`${d}-po`,finishingPositionOffset:h,matchUpType:l,drawSize:P,isMock:p,uuids:f}),A=ss({structureId:b.structureId??f?.pop(),matchUpFormat:e,stage:Ti,structureName:R,stageSequence:a,matchUps:N});I.push(A);let O=RT({playoffStructureId:A.structureId,finishingPositions:S,sourceStructureId:r});v.push(O),h+=T,g.push({structureId:A.structureId,finishingPositions:S})}else if([DI,PI,Ti].includes(D)){let N={playoffAttributes:b.playoffAttributes??i,playoffStructureNameBase:b.playoffStructureNameBase,structureId:b.structureId??f?.pop(),structureName:b.structureName,idPrefix:d&&`${d}-po`,addNameBaseToAttributeName:!0,finishingPositionOffset:h,stage:Ti,roundOffset:0,stageSequence:a,drawSize:P,isMock:p,uuids:f};D===DI?Object.assign(N,{playoffAttributes:b?.playoffAttributes??i??xB,roundOffsetLimit:3}):D===PI&&Object.assign(N,{playoffAttributes:b?.playoffAttributes??i??FB,roundOffsetLimit:2});let A=Hg(N);if(A.error)return A;if(A.links?.length&&v.push(...A.links),A.structures?.length&&I.push(...A.structures),I.sort(Bh),A.structureId){let O=RT({playoffStructureId:A.structureId,finishingPositions:S,sourceStructureId:r});v.push(O),g.push({structureId:A.structureId,finishingPositions:S})}h+=T}else if([EI,cU,Yb,qb,zb,Kb].includes(D)){let N=[f?.pop(),f?.pop()],A={playoffStructureNameBase:b.playoffStructureNameBase,structureId:b.structureId??f?.pop(),playoffAttributes:b.playoffAttributes,idPrefix:d&&`${d}-po`,finishingPositionOffset:h,uuids:N,stage:Ti,structureName:R,matchUpType:l,feedPolicy:u,drawSize:P,isMock:p},O={[EI]:{fmlc:!0,feedRounds:1},[Kb]:{feedRounds:1},[Yb]:{feedsFromFinal:3},[qb]:{feedsFromFinal:2},[zb]:{feedsFromFinal:1}};Object.assign(A,O[D]||{});let{structures:k,links:F}=$f(A),[x]=k,L=RT({playoffStructureId:x.structureId,finishingPositions:S,sourceStructureId:r});v.push(L,...F),I.push(...k),g.push({structureId:x.structureId,finishingPositions:S}),h+=T}else if([eo].includes(D)){let{structures:N,links:A}=LU({...C,structureOptions:b.structureOptions||{groupSize:4}});M({playoffStructures:N,playoffLinks:A})}else if([uU].includes(D)){let{structures:N,links:A}=Dse(C);M({playoffStructures:N,playoffLinks:A})}else if([OFe].includes(D)){let{structures:N,links:A}=Ese(C);M({playoffStructures:N,playoffLinks:A})}else if([ua].includes(D)){let N=ss({structureId:b.structureId??f?.pop(),structureName:b.structureName,finishingPosition:mD,stage:Ti,stageSequence:a,matchUps:[]});M({playoffStructures:[N],playoffLinks:[]})}}return{finishingPositionTargets:g,positionRangeMap:y,structures:I,links:v}}function RT({playoffStructureId:t,finishingPositions:e,sourceStructureId:i}){return{linkType:fu,source:{structureId:i,finishingPositions:e},target:{structureId:t,feedProfile:ho,roundNumber:1}}}function cBe(t){let e="generateAndPopulateRRplayoffStructures";if(!t.playoffGroups)return q({result:{error:Je},info:"playoffGroups required",stack:e});let{sourceStructureId:i,requireSequential:r,tournamentRecord:n,drawDefinition:a,playoffGroups:s,groupCount:o,groupSize:l,event:u}=t,c=Rse({requireSequential:r,sourceStructureId:i,playoffGroups:s,groupCount:o,...t});if(c.error)return q({result:c,stack:e});let{structures:d=[],links:p=[],finishingPositionTargets:f,positionRangeMap:m}=c,h=f?.flatMap(({finishingPositions:T})=>T).flatMap(T=>m[T].finishingPositions);a.structures.push(...d),a.links.push(...p);let{matchUps:g,matchUpsMap:I}=Zi({inContext:!0,drawDefinition:a}),v=new Set(d.map(({structureId:T})=>T)),w=g?.filter(({structureId:T})=>v.has(T)).map(vr),y=I?.drawMatchUps?.filter(({matchUpId:T})=>w?.includes(T));if(y?.length){let T=yn({drawDefinition:a,event:u})?.tieFormat;T&&y.forEach(P=>{let{tieMatchUps:D}=Qh({isMock:t.isMock,tieFormat:T,matchUp:P});Object.assign(P,{tieMatchUps:D,matchUpType:La})})}let{positionAssignments:b}=Kt({structureId:i,drawDefinition:a}),S={};b?.forEach(T=>{let P=ht({element:T,name:Dc})?.extension?.value?.groupOrder;P&&(S[P]||(S[P]=[]),S[P].push(T.participantId))});let U=Kv({provisionalPositioning:t.provisionalPositioning,structureId:i,applyPositioning:!0,event:t.event,tournamentRecord:n,drawDefinition:a});return U.error&&U.error?.code!==K$.code?q({result:U,stack:e}):{structures:d,links:p,positionsPlayedOff:h,drawDefinition:a,...W}}function cV({positionAssignments:t,tournamentRecord:e,drawDefinition:i,matchUpFormat:r,matchUps:n,event:a}){if(!Ka(n))return{error:re};if(!t)return{error:re};let{policyDefinitions:s}=Gc({policyTypes:[zB],tournamentRecord:e,drawDefinition:i,event:a}),{subOrderMap:o}=x2({positionAssignments:t}),l=n.length?qh({policyDefinitions:s,matchUpFormat:r,subOrderMap:o,matchUps:n}):void 0;if(l?.error)return l;let{participantResults:u={},bracketComplete:c,report:d}=l??{},p=Object.keys(u);return t.forEach(f=>{let{participantId:m}=f;if(p.includes(m)){let h={value:u[m],name:Dc};Ft({element:f,extension:h}),u[m].ties||Nn({element:f,name:MI})}else Nn({element:f,name:Dc}),Nn({element:f,name:MI})}),ii({drawDefinition:i}),{...W,participantResults:u,bracketComplete:c,report:d}}function Cse({matchUps:t,matchUpId:e}){return{matchUp:(t||[]).find(i=>i.matchUpId===e)}}function fi(t){let e=He(t,[{[In]:!0,[Pl]:!0}]);if(e.error)return e;let{tournamentParticipants:i,afterRecoveryTimes:r,contextProfile:n,drawDefinition:a,matchUpsMap:s,matchUpId:o,inContext:l,context:u,event:c}=t,{structures:d=[]}=io({drawDefinition:a}),p=t.contextContent||n&&Hc({contextProfile:n,drawDefinition:a});for(let f of d){let{matchUps:m}=At({tournamentParticipants:i,afterRecoveryTimes:r,contextContent:p,drawDefinition:a,contextProfile:n,matchUpsMap:s,inContext:l,structure:f,context:u,event:c}),{matchUp:h}=Cse({matchUps:m,matchUpId:o});if(h)return{matchUp:h,structure:f}}return{error:dn}}function dN(t){return!wt(t)||!t.notes?{error:Je}:wt(t.element)?!ni(t.notes)&&!t.notes?.testing?{error:re}:(Object.assign(t.element,{notes:t.notes}),{...W}):{error:re}}function dV(t){return wt(t)?wt(t.element)?(t.element.notes&&delete t.element.notes,{...W}):{error:re}:{error:Je}}var pN={matchUpStatus:_i,matchUpStatusCodes:[],score:{scoreStringSide1:"",scoreStringSide2:"",sets:void 0},matchUpFormat:void 0,winningSide:void 0};function So(t){let e="modifyMatchUpScore",i=t.matchUpFormat,r=t.matchUp,n,{matchUpStatusCodes:a,tournamentRecord:s,drawDefinition:o,matchUpStatus:l,removeScore:u,winningSide:c,matchUpId:d,event:p,notes:f,score:m}=t,h=t.appliedPolicies&&Object.keys(t.appliedPolicies).length?t.appliedPolicies:Dt({policyTypes:[ms],tournamentRecord:s,drawDefinition:o,structure:n,event:p})?.appliedPolicies,g=r.matchUpType===ei;if(g&&o){if(d&&r.matchUpId!==d){let U=fi({drawDefinition:o,matchUpId:d,event:p});if(!U.matchUp)return{error:dn};({matchUp:r,structure:n}=U)}}else r.matchUpId!==d&&console.log("!!!!!");l&&[ai,Si].includes(l)||u?Object.assign(r,{...pN}):m&&(r.score=m);let I=l&&r?.matchUpStatus===qt&&l!==qt;l&&(r.matchUpStatus=l),i&&(r.matchUpFormat=i),a&&(r.matchUpStatusCodes=a),c&&(r.winningSide=c),t.removeWinningSide&&(r.winningSide=void 0),!n&&o&&({structure:n}=fi({drawDefinition:o,matchUpId:d,event:p})),l&&!r.winningSide&&fr(r)&&!Ki.includes(l)&&![$h,Kd,Da].includes(l)&&(r.matchUpStatus=lo);let v;if((I&&r?.processCodes?.length||l===qt)&&(v=h?.[ms]?.processCodes?.incompleteAssignmentsOnDefault),!r.collectionId){let U=n?.structureType===gn,T=Hn({structure:n});if(w2({drawDefinition:o,structure:n})||T||U){let P=R=>{i=g?"SET1-S:T100":i??r.matchUpFormat??R?.matchUpFormat??o?.matchUpFormat??p?.matchUpFormat;let C=g?{matchUpTypes:[ei]}:void 0,{matchUps:M}=At({afterRecoveryTimes:!1,tournamentRecord:s,inContext:!0,matchUpFilters:C,drawDefinition:o,structure:R,event:p});return T&&(R.positionAssignments=nt(M.flatMap(N=>(N.sides??[]).map(A=>A.participantId)).filter(Boolean)).map(N=>({participantId:N}))),cV({positionAssignments:R.positionAssignments,tournamentRecord:s,drawDefinition:o,matchUpFormat:i,matchUps:M,event:p})},D=U&&n.structures.find(R=>R?.matchUps.find(C=>C.matchUpId===d)),E=P(D||n);if(E.error)return q({result:E,stack:e})}}if(f){let U=dN({element:r,notes:f});if(U.error)return q({result:U,stack:e})}let w=s?.tournamentId,y=bs().topics.includes(GM),b=(y||v)&&Or({drawDefinition:o}),S=b&&Zi({matchUpFilters:{matchUpIds:[d]},nextMatchUps:!0,tournamentRecord:s,inContext:!0,drawDefinition:o,matchUpsMap:b}).matchUps?.[0];if(y&&S&&yLe({tournamentId:w,inContextMatchUp:S}),Array.isArray(v)&&S&&!S.sides?.every(({participantId:U})=>U))if(l===qt)r.processCodes=nt([...r.processCodes??[],...v]);else for(let U of v||[]){let T=U&&r?.processCodes?.lastIndexOf(U);r?.processCodes?.splice(T,1)}return Ut({eventId:p?.eventId,context:e,drawDefinition:o,tournamentId:w,matchUp:r}),{...W}}function pV(t){let{propagateExitStatus:e,matchUpStatusCodes:i,autoCalcDisabled:r,inContextMatchUp:n,matchUpStatus:a,dualMatchUp:s,structure:o,matchUp:l}=t,u=NU({matchUpStatus:a})||[Rl,Ta].includes(a)&&s||r,c=l?.sides?.map(h=>h.participantId).filter(Boolean).length||n?.sides?.map(h=>h.participantId).filter(Boolean).length,d="attemptToModifyScore";if(!(Hn({structure:o})&&c===1||a===qt&&c||dBe({structure:o,matchUp:l,inContextMatchUp:n})||t.appliedPolicies?.[ms]?.requireParticipantsForScoring===!1||Lr(a)&&c===1&&e))return q({result:{error:iB},stack:d});let p=[ai].includes(a),f=u?a:t.winningSide&&Oi||Da,m=So({...t,winningSide:t.winningSide,matchUpStatusCodes:u&&i||[],matchUpStatus:f,removeScore:p});return q({result:m,stack:d})}function dBe({structure:t,matchUp:e,inContextMatchUp:i}){let{drawPositions:r}=e,{positionAssignments:n}=pr({structure:t}),a=n?.filter(o=>r?.includes(o.drawPosition)&&o.participantId),s=i?.sides?.every(o=>o.participantId);return a?.length===2||s}function Mse({collectionGroups:t=[]}){let e=Object.assign({},...t.filter(r=>lt(r?.groupValue)&&r?.groupNumber).map(r=>({[r.groupNumber]:{...r,allGroupMatchUpsCompleted:!0,matchUpsCount:0,sideWins:[0,0],values:[0,0]}}))),i=Object.keys(e).map(r=>Ke(r));return{groupValueGroups:e,groupValueNumbers:i}}function pBe({collectionDefinition:t,groupValueNumbers:e,groupValueGroups:i,sideTieValues:r,tieMatchUps:n}){let a=n.filter(v=>v.collectionId===t.collectionId),s=[0,0],o=[0,0],l=a.every(v=>Ki.includes(v.matchUpStatus)),{collectionValueProfiles:u,collectionGroupNumber:c,collectionValue:d,matchUpValue:p,winCriteria:f,scoreValue:m,setValue:h}=t,g=c&&e.includes(c),I=[0,0];if(a.forEach(v=>{v.winningSide&&(I[v.winningSide-1]+=1)}),lt(p)?a.forEach(v=>{v.winningSide&&(s[v.winningSide-1]+=p)}):lt(h)?a.forEach(v=>{v.score?.sets?.forEach(w=>{w.winningSide&&(s[w.winningSide-1]+=h)})}):lt(m)?a.forEach(v=>{v.score?.sets?.forEach(w=>{let{side1TiebreakScore:y=0,side2TiebreakScore:b=0,side1Score:S=0,side2Score:U=0}=w;(v.matchUpStatus===Oi||v.winningSide||w.winningSide)&&(S||U?(s[0]+=S,s[1]+=U):(y||b)&&w.winningSide&&(s[w.winningSide-1]+=1))})}):Array.isArray(u)&&a.forEach(v=>{if(v.winningSide){let w=v.collectionPosition,y=fBe({collectionDefinition:t,collectionPosition:w});lt(y)&&(s[v.winningSide-1]+=y)}}),lt(d)){let v;if(f?.aggregateValue)l&&(lt(p||h||m)&&s[0]!==s[1]?v=s[0]>s[1]?1:2:I[0]!==I[1]&&(v=I[0]>I[1]?1:2));else if(f?.valueGoal)v=s.reduce((w,y,b)=>y>=f.valueGoal?b+1:w,0);else{let w=Math.floor(t.matchUpCount/2)+1;v=I.reduce((y,b,S)=>b>=w?S+1:y,0)}v&&(g?i[c].values[v-1]+=d:o[v-1]+=d)}else g?(i[c].values[0]+=s[0]||0,i[c].values[1]+=s[1]||0):o=s;g?(i[c].sideWins[0]+=I[0]||0,i[c].sideWins[1]+=I[1]||0,i[c].allGroupMatchUpsCompleted=i[c].allGroupMatchUpsCompleted&&l,i[c].matchUpsCount+=a.length):o.forEach((v,w)=>r[w]+=v||0)}function fBe({collectionDefinition:t,collectionPosition:e}){return(t.collectionValueProfiles||[])?.find(i=>i.collectionPosition===e)?.matchUpValue}function HU(t){let{sideAdjustments:e=[0,0],separator:i="-",drawDefinition:r,matchUpsMap:n,structure:a,matchUp:s,event:o}=t;if(!Array.isArray(e)||e.length!==2||Number.isNaN(e.reduce((y,b)=>y+b)))return{error:re};if(!s)return{error:sa};let l=yn({matchUp:s,drawDefinition:r,structure:a,event:o})?.tieFormat||t?.tieFormat;if(!l)return{error:Av};let u=Gn({tieFormat:l});if(u.error)return u;let c=l?.collectionDefinitions||[],d=s?.tieMatchUps??[],p=[0,0],{groupValueGroups:f,groupValueNumbers:m}=Mse(l);for(let y of c)pBe({collectionDefinition:y,groupValueNumbers:m,groupValueGroups:f,sideTieValues:p,tieMatchUps:d});for(let y of m){let b=f[y],{allGroupMatchUpsCompleted:S,matchUpCount:U,winCriteria:T,groupValue:P,sideWins:D,values:E}=b,R;if(T?.aggregateValue)S&&E[0]!==E[1]&&(R=E[0]>E[1]?1:2);else if(T?.valueGoal)R=E.reduce((C,M,N)=>M>=T.valueGoal?N+1:C,void 0);else{let C=Math.floor(U/2)+1;R=D.reduce((M,N,A)=>N>=C?A+1:M,void 0)}R&&(p[R-1]+=P||0)}let h=p.map((y,b)=>(y||0)+e[b]),g={side1Score:h[0],side2Score:h[1],winningSide:void 0},I=h.join(i),v=h.slice().reverse().join(i),w;if(l?.winCriteria){let{valueGoal:y,aggregateValue:b,tallyDirectives:S}=l.winCriteria;if(y?w=h.map((U,T)=>({sideNumber:T+1,points:U})).find(({points:U})=>U>=y)?.sideNumber:b&&d.every(U=>U.matchUpStatus&&Ki.includes(U.matchUpStatus)||U.winningSide)&&h[0]!==h[1]&&(w=h[0]>h[1]?1:2),!w&&S){let U=s.matchUpId,T=s.hasContext?s:n?.drawMatchUps?.[U]||r&&fi({inContext:!0,drawDefinition:r,matchUpId:U})?.matchUp;if(T){let{completedTieMatchUps:P,order:D}=qh({matchUps:[T]});if(P&&D?.length){let E=D[0].participantId;w=T.sides.find(({participantId:R})=>R===E)?.sideNumber}}}}return w&&(g.winningSide=w),{scoreStringSide1:I,scoreStringSide2:v,winningSide:w,set:g}}function WU({inContextDualMatchUp:t,drawDefinition:e,tournamentId:i,dualMatchUp:r,eventId:n}){if(r){t||(t=fi({matchUpId:r.matchUpId,inContext:!0,drawDefinition:e})?.matchUp);let{extension:a}=ht({element:e,name:Uc}),s=Oe(a?.value||{},!1,!0),o=({displaySideNumber:l,drawPosition:u,sideNumber:c})=>({drawPosition:u,sideNumber:c,displaySideNumber:l});r.sides=t?.sides?.map(l=>{let u=l.participantId,c=u&&s[u]||void 0,{lineUp:d,...p}=r.sides?.find(({sideNumber:m})=>m===l.sideNumber)??{},f=d?.length?d:c;return{...o(l),...p,lineUp:f}}),Ut({context:"ensureSidLineUps",matchUp:r,drawDefinition:e,tournamentId:i,eventId:n})}}function Gr(t){if(t)return Oe(t,!1,!0)}function fV(t){let e=He(t,[{[pn]:!0}]);return e.error?e:Object.keys(t.tournamentRecords).reduce((i,r)=>{i.tournamentIdMap[r]=[];let n=t.tournamentRecords[r].events??[],a=n.map(({eventId:o})=>o),s=n.map(o=>(o.drawDefinitions??[]).map(({drawId:l})=>l)).flat();return i.tournamentIdMap[r].push(...a,...s),i.eventIds.push(...a),i.drawIds.push(...s),i},{eventIds:[],drawIds:[],tournamentIdMap:{}})}function Nse({tournamentRecords:t,eventId:e,drawId:i}){let{tournamentIdMap:r}=fV({tournamentRecords:t});return(r?Object.keys(r):[]).find(n=>e&&r?.[n].includes(e)||i&&r?.[n].includes(i))}function Wc(t){let{exitWhenNoValues:e,drawDefinition:i,matchUpStatus:r,removeScore:n,matchUpsMap:a,matchUpId:s,event:o}=t,l=t.tournamentRecords||t.tournamentRecord&&{[t.tournamentRecord?.tournamentId]:t.tournamentRecord}||{},u=t.tournamentId||t.tournamentRecord?.tournamentId;l&&Nse({tournamentRecords:l,...t});let c=u&&l[u];if(!c)return{error:ve};let d=fi({drawDefinition:i,event:o,matchUpId:s});if(d.error)return d;if(!d.matchUp)return{error:dn};let{matchUp:p,structure:f}=d;if(!p.tieMatchUps)return{error:oa};WU({tournamentId:c?.tournamentId,eventId:o?.eventId,dualMatchUp:p,drawDefinition:i});let{extension:m}=ht({name:Gm,element:p});if(m?.value)if(n)Nn({element:p,name:Gm});else return{...W,score:p.score};let h=yn({drawDefinition:i,structure:f,matchUp:p,event:o})?.tieFormat;p.tieFormat=Gr(h);let g=HU({drawDefinition:i,matchUpsMap:a,structure:f,matchUp:p,event:o}),{winningSide:I,set:v,scoreStringSide1:w,scoreStringSide2:y}=g,b=v?.side1Score||v?.side2Score;if(e&&!p.score&&!b)return{...W};let S={scoreStringSide1:w,scoreStringSide2:y,sets:v?[v]:[]},U=I&&[1,2].includes(I),T=U&&Oi||C2({matchUpStatus:r??p.matchUpStatus,tieMatchUps:p.tieMatchUps,winningSide:p.winningSide,score:S})&&lo||_i,P=!!(p.winningSide&&!U),D=p.tieMatchUps.find(({score:R,winningSide:C,matchUpStatus:M})=>R?.sets?.length&&(R.sets[0].side1Score||R.sets[0].side2Score)||M&&Ki.includes(M)||C),E;if(p.tieFormat&&!U&&!D){let R=yn({drawDefinition:i,structure:f,event:o})?.tieFormat;R&&JSON.stringify(h)===JSON.stringify(R)&&(p.tieFormatId=void 0,p.tieFormat=void 0,E=!0)}return So({appliedPolicies:t.appliedPolicies,matchUpStatus:T,score:S,removeWinningSide:P,tournamentRecord:c,drawDefinition:i,removeScore:n,winningSide:I,matchUpId:s,matchUp:p,event:o}),{...W,score:S,removeWinningSide:P,tieFormatRemoved:E,winningSide:I}}function mBe({winnerMatchUpDrawPositionIndex:t,inContextDrawMatchUps:e,projectedWinningSide:i,sourceMatchUpStatus:r,winningDrawPosition:n,tournamentRecord:a,winnerTargetLink:s,sourceMatchUpId:o,drawDefinition:l,winnerMatchUp:u,dualMatchUp:c,matchUpsMap:d,event:p}){let f="directWinner";if(s){let m=u.drawPositions||[],h=m[t],g=s.source.structureId,I=tt({structureId:g,drawDefinition:l});if(I.error)return I;let{structure:v}=I,{positionAssignments:w}=pr({structureId:g,drawDefinition:l}),y=w?.find(D=>D.drawPosition===n)?.participantId,b=s.target.structureId,{positionAssignments:S}=pr({structureId:b,drawDefinition:l}),U=S?.find(D=>D.participantId===y)?.drawPosition,T=S?.filter(D=>{let E=m.includes(D.drawPosition),R=!D.participantId&&!D.bye&&!D.qualifier;return E&&R}).map(D=>D.drawPosition),P=T?.includes(h);if(y&&s.target.roundNumber===1&&P)hl({drawPosition:h,participantId:y,structureId:b,inContextDrawMatchUps:e,sourceMatchUpStatus:r,tournamentRecord:a,drawDefinition:l,matchUpsMap:d,event:p});else if(y&&T?.length){let D=T.pop();D&&hl({participantId:y,structureId:b,inContextDrawMatchUps:e,sourceMatchUpStatus:r,tournamentRecord:a,drawDefinition:l,drawPosition:D,matchUpsMap:d,event:p})}else if(U){let D=gm({drawPosition:U,matchUpId:u.matchUpId,inContextDrawMatchUps:e,sourceMatchUpStatus:r,tournamentRecord:a,sourceMatchUpId:o,drawDefinition:l,matchUpsMap:d});if(D.error)return q({result:D,stack:f})}else if(v?.stage!==ze){let D="winner target position unavaiallble";console.log(D),q({stack:f,result:{error:D}})}if(v?.seedAssignments&&v.structureId!==b){let D=v.seedAssignments.find(({participantId:R})=>R===y),E=D?.participantId;D&&E&&Yv({eventId:u?.eventId,structureId:b,...D,tournamentRecord:a,drawDefinition:l,participantId:E})}}else{let m=gm({matchUpId:u.matchUpId,drawPosition:n,inContextDrawMatchUps:e,sourceMatchUpStatus:r,tournamentRecord:a,sourceMatchUpId:o,drawDefinition:l,matchUpsMap:d});if(m.error)return m}if(c&&i){let m=c.sides?.find(h=>h.sideNumber===i);if(m?.lineUp){let h=c.roundPosition,g=u.roundPosition,I=h===g&&h!==1||Math.floor(h/2)===g?2:1,v=d?.drawMatchUps?.find(({matchUpId:b})=>b===u.matchUpId),w=[1,2].map(b=>({...v.sides?.find(S=>S.sideNumber===b)||{},sideNumber:b}));v.sides=w;let y=v.sides.find(b=>b.sideNumber===I);if(y){let b=m.lineUp?.filter(S=>S?.participantId);y.lineUp=K2({lineUp:b}),Ut({tournamentId:a?.tournamentId,eventId:u?.eventId,matchUp:v,context:f,drawDefinition:l})}}}return{...W}}function hBe(t){let{loserMatchUpDrawPositionIndex:e,inContextDrawMatchUps:i,projectedWinningSide:r,propagateExitStatus:n,sourceMatchUpStatus:a,loserDrawPosition:s,tournamentRecord:o,loserTargetLink:l,drawDefinition:u,loserMatchUp:c,dualMatchUp:d,matchUpsMap:p,event:f}=t,m="directLoser",h=l.linkCondition,g=c.drawPositions||[],I=h===fl&&c.roundNumber===2&&Math.min(...g.filter(Boolean)),v=I||g[e],w=I||g[1-e],y=l.source.structureId,{structure:b}=tt({structureId:y,drawDefinition:u}),{matchUps:S}=At({afterRecoveryTimes:!1,inContext:!0,drawDefinition:u,structure:b,event:f}),U=S.filter(_=>_.drawPositions?.includes(s)).filter(_=>{let B=_.sides.find(j=>j.drawPosition===s),G=_.matchUpStatus===ai||_.matchUpStatus===qt&&!fr(_);return B?.sideNumber===_.winningSide&&!G}),T=h===fl&&U.length===0,{positionAssignments:P}=pr({structureId:y,drawDefinition:u}),D=P?.find(_=>_.drawPosition===s)?.participantId,E={loserParticipantId:D},R=l.target.structureId,{positionAssignments:C}=pr({structureId:R,drawDefinition:u}),M=C?.filter(({drawPosition:_})=>g.includes(_)),N=M?.some(_=>_.participantId&&D&&_.participantId===D),A=n&&[Sr,ai,qt].includes(a||"");if(N)return{...W,stack:m};let O=M?.filter(_=>{let B=g.includes(_.drawPosition),G=!_.participantId&&!_.bye&&!_.qualifier;return B&&G}).map(_=>_.drawPosition),k=O?.includes(v),F=l.target.roundNumber>1&&O?.length,x=l.target.roundNumber===1&&k;if(I){let _=L();if(_.context&&Object.assign(E,_.context),_.error)return q({result:_,stack:m})}else if(x){let _=V();if(_.context&&Object.assign(E,_.context),_.error)return q({result:_,stack:m})}else if(D&&F){O.sort(nr);let _=O[0],B=hl({participantId:D,structureId:R,drawPosition:_,inContextDrawMatchUps:i,sourceMatchUpStatus:a,tournamentRecord:o,drawDefinition:u,matchUpsMap:p,event:f});if(B.error)return q({result:B,stack:m});if(!B.error&&A&&n)return{stack:m,context:{progressExitStatus:!0,loserParticipantId:D}}}else return q({context:{loserDrawPosition:s,loserTargetLink:l,targetDrawPositionIsUnfilled:k},result:{error:k?Mh:t1e},stack:m});if(b?.seedAssignments&&b.structureId!==R){let _=b.seedAssignments.find(({participantId:G})=>G===D),B=_?.participantId;_&&B&&Yv({eventId:c?.eventId,structureId:R,..._,tournamentRecord:o,drawDefinition:u,participantId:B})}if(d&&r){let _=d.sides?.find(B=>B.sideNumber===3-r);if(_?.lineUp){let{roundNumber:B,eventId:G}=c,{roundPosition:j}=d,K=B===1?2-j%2:1,Y=p?.drawMatchUps?.find(({matchUpId:J})=>J===c.matchUpId),X=[1,2].map(J=>({...Y.sides?.find(ae=>ae.sideNumber===J)||{},sideNumber:J}));Y.sides=X;let Z=Y.sides.find(J=>J.sideNumber===K);Z&&(Z.lineUp=K2({lineUp:_.lineUp}),Ut({tournamentId:o?.tournamentId,matchUp:Y,context:m,drawDefinition:u,eventId:G}))}}return q({result:{...W},stack:m,context:E});function L(){let _="loserLinkFedFMLC";return q(T?{result:V(),stack:_}:{result:$(),stack:_})}function $(){let _=Ja({drawPosition:w,structureId:R,tournamentRecord:o,drawDefinition:u,event:f});return q({result:_,stack:"assignLoserPositionBye"})}function V(){let _=D?hl({drawPosition:v,participantId:D,structureId:R,inContextDrawMatchUps:i,sourceMatchUpStatus:a,tournamentRecord:o,drawDefinition:u,matchUpsMap:p,event:f}):{error:dr};return!_.error&&A&&n?{stack:m,context:{progressExitStatus:!0}}:q({result:_,stack:"assignLoserDrawPosition"})}}function Ase(t){let e="directParticipants",i=pV(t);if(i.error)return q({result:i,stack:e});let r=NU({matchUpStatus:t.matchUpStatus}),{dualWinningSideChange:n,inContextDrawMatchUps:a,projectedWinningSide:s,propagateExitStatus:o,matchUpStatusCodes:l,tournamentRecord:u,drawDefinition:c,matchUpStatus:d,dualMatchUp:p,matchUpsMap:f,winningSide:m,targetData:h,matchUpId:g,structure:I,matchUp:v,event:w}=t,y=!!v.collectionId,b=Hn({structure:I}),S=v.drawPositions,U;if(y){let{matchUpTieId:T,matchUpsMap:P}=t,D=Wc({appliedPolicies:t.appliedPolicies,matchUpId:T,tournamentRecord:u,drawDefinition:c,matchUpsMap:P,event:w});if(U=D&&{tieMatchUpResult:D},S=a.find(({matchUpId:E})=>E===T)?.drawPositions,!n)return q({result:{...W,...U},stack:e})}if(b)return q({result:{...W,...U},stack:e});if(S){let T=s?s-1:m-1,P=1-T,D=S[T],E=S[P],R={},{targetLinks:{loserTargetLink:C,winnerTargetLink:M,byeTargetLink:N},targetMatchUps:{winnerMatchUpDrawPositionIndex:A,loserMatchUpDrawPositionIndex:O,winnerMatchUp:k,loserMatchUp:F,byeMatchUp:x}}=h;if(k){let L=mBe({sourceMatchUpStatus:r&&d||Oi,winnerMatchUpDrawPositionIndex:A,sourceMatchUpId:g,inContextDrawMatchUps:a,projectedWinningSide:s,winningDrawPosition:D,tournamentRecord:u,winnerTargetLink:M,drawDefinition:c,winnerMatchUp:k,dualMatchUp:p,matchUpsMap:f,event:w});if(L.error)return q({result:L,stack:e})}if(F){let L=hBe({sourceMatchUpStatus:r&&d||Oi,loserMatchUpDrawPositionIndex:O,inContextDrawMatchUps:a,projectedWinningSide:s,propagateExitStatus:o,loserDrawPosition:E,tournamentRecord:u,loserTargetLink:C,drawDefinition:c,loserMatchUp:F,matchUpsMap:f,dualMatchUp:p,event:w});if(L.context?.progressExitStatus&&Object.assign(R,L.context,{sourceMatchUpStatus:r&&d||Oi,sourceMatchUpStatusCodes:l||[],loserMatchUp:F,matchUpsMap:f}),L.error)return q({result:L,stack:e})}if(x){let L=x.drawPositions||[],$=Math.min(...L.filter(Boolean)),V=N.target.structureId,_=Ja({drawPosition:$,structureId:V,tournamentRecord:u,drawDefinition:c,event:w});if(_.error)return q({result:_,stack:e})}return q({result:{...W,...U},stack:e,context:R})}else return q({result:{error:XS},stack:e})}function mV(t){let e="genPlayoffStructure";if(!t.drawDefinition)return q({result:{error:$e},stack:e});let i=GU(t);if(i.error)return q({result:i,stack:e});let{structureId:r,addNameBaseToAttributeName:n,playoffStructureNameBase:a,finishingPositionNaming:s,finishingPositionLimit:o,playoffAttributes:l,playoffPositions:u,roundOffsetLimit:c,tournamentRecord:d,exitProfileLimit:p,roundProfiles:f,roundNumbers:m,idPrefix:h,isMock:g,event:I,uuids:v}=t,w=Oe(t.drawDefinition,!1,!0),{structure:y}=tt({structureId:r,drawDefinition:w});if(!y)return q({result:{error:vi},stack:e});if(y.structureType===gn||y.structures)return cBe({sourceStructureId:y.structureId,...t,...i,drawDefinition:w});let{playoffRoundsRanges:b,playoffRounds:S}=i,{playoffPositionsReturned:U,error:T,playoffSourceRounds:P,playoffRoundsRanges:D}=Tse(t);if(T)return q({result:{error:T},stack:e});let E=f?.length&&Object.assign({},...f),R=m||typeof f=="object"&&f.map(j=>Object.keys(j)).flat(),C=Array.isArray(R)&&R.map(j=>!isNaN(j)&&Ke(j)).filter(Boolean);if(C){if(!Array.isArray(C))return q({result:{error:re},context:{validRoundNumbers:C},stack:e});C.forEach(j=>{if(!S?.includes(j))return q({result:{error:re},context:{roundNumber:j},stack:e})})}u&&u.forEach(j=>{if(!U?.includes(j))return q({result:{error:re},context:{playoffPosition:j},stack:e})});let M=C||P,N=C?b:D,A=[],O=[];for(let j of M??[]){let K=N?.find(le=>le.roundNumber===j);if(!K)return q({result:{error:re},context:{roundNumber:j},stack:e});let Y=K.finishingPositions.length,X=Math.min(...K.finishingPositions)-1,Z=2,J=j&&E?.[j]&&Z+E[j]-1,ae=Hg({exitProfile:`0-${j}`,addNameBaseToAttributeName:n,playoffStructureNameBase:a,finishingPositionOffset:X,playoffAttributes:l,exitProfileLimit:p,stage:Ti,roundOffset:0,drawDefinition:w,sequenceLimit:J,stageSequence:Z,drawSize:Y,idPrefix:h,isMock:g,uuids:v,finishingPositionNaming:s,finishingPositionLimit:o,roundOffsetLimit:c});if(ae.error)return q({result:ae,stack:e});let{structures:te,links:ne}=ae;if(te?.length&&A.push(...te),ne?.length&&O.push(...ne),ae.structureId&&j){let le={linkType:hu,source:{structureId:r,roundNumber:j},target:{structureId:ae.structureId,feedProfile:As,roundNumber:1}};O.push(le)}}if(!A.length)return q({result:{error:re},info:"No structures generated",stack:e});w.structures.push(...A),w.links.push(...O);let{matchUps:k,matchUpsMap:F}=Zi({inContext:!0,drawDefinition:w}),x=A.map(({structureId:j})=>j),L=k?.filter(({structureId:j})=>x.includes(j)).map(vr),$=F?.drawMatchUps?.filter(({matchUpId:j})=>L?.includes(j));if($?.length){let j=yn({drawDefinition:w,event:I})?.tieFormat;j&&$.forEach(K=>{let{tieMatchUps:Y}=Qh({matchUp:K,tieFormat:j,isMock:g});Object.assign(K,{tieMatchUps:Y,matchUpType:ei})})}k?.filter(j=>yp({matchUp:j})&&j.structureId===r)?.forEach(j=>{let{matchUpId:K,score:Y,winningSide:X}=j,Z=Fn({inContextDrawMatchUps:k,drawDefinition:w,matchUpId:K}),J=Ase({inContextDrawMatchUps:k,tournamentRecord:d,drawDefinition:w,matchUpsMap:F,winningSide:X,targetData:Z,matchUpId:K,structure:y,matchUp:j,score:Y,event:I});J.error&&console.log(J.error)}),k?.filter(j=>j.matchUpStatus==="BYE"&&j.structureId===r)?.forEach(j=>{let{matchUpId:K}=j,Y=Fn({inContextDrawMatchUps:k,drawDefinition:w,matchUpId:K}),{targetLinks:{loserTargetLink:X},targetMatchUps:{loserMatchUpDrawPositionIndex:Z,loserMatchUp:J}}=Y;if(X&&J){let ae=X.target.structureId,te=J.drawPositions[Z],ne=Ja({drawPosition:te,structureId:ae,tournamentRecord:d,drawDefinition:w,event:I});ne.error&&console.log(ne.error)}});let V=[],_=zp({inContextDrawMatchUps:k,drawDefinition:w,matchUpsMap:F}).goesToMap,{structure:B}=tt({drawDefinition:t.drawDefinition,structureId:r}),{matchUps:G}=At({structure:B});return G.forEach(j=>{let K=_?.loserMatchUpIds[j.matchUpId];if(K&&j.loserMatchUpId!==K){j.loserMatchUpId=K;let X={tournamentId:d?.tournamentId,eventId:t.event?.eventId,context:e,matchUp:j};V.push(X)}let Y=_?.winnerMatchUpIds[j.matchUpId];if(Y&&j.winnerMatchUpId!==Y){j.winnerMatchUpId=Y;let X={tournamentId:d?.tournamentId,eventId:t.event?.eventId,context:e,matchUp:j};V.push(X)}}),{structures:A,matchUpModifications:V,links:O,drawDefinition:w,...W}}function kse({element:t}){if(!t)return{error:re};if(!t.timeItems)return{};if(!Array.isArray(t.timeItems))return{error:re};let e=(i,r)=>(n,a)=>(a[i]&&(n[a[i]]=a[r]),n);return t.timeItems.reduce(e("itemType","itemValue"),{})}function Cl(t){let{duplicateValues:e=!0,creationTime:i=!0,removePriorValues:r,timeItem:n}=t;if(!n)return{error:fB};let a=Nne(t);if(a.error)return a;if(!(wt(n)&&ni(n.itemType)&&Object.keys(n).includes("itemValue")))return{error:pB};if(!a.timeItems)a.timeItems=[];else if(gBe({element:a,duplicateValues:e,timeItem:n}))return{...W};if(n.itemSubTypes&&!n.itemSubTypes.length&&delete n.itemSubTypes,i){let s=new Date().toISOString();Object.assign(n,{createdAt:s})}return r&&(a.timeItems=a.timeItems.filter(({itemType:s})=>n.itemType!==s)),r&&!n.itemValue||a.timeItems.push(n),{...W}}function gBe({element:t,duplicateValues:e,timeItem:i}){let{itemType:r,itemSubTypes:n,itemValue:a}=i,s=r&&Ss({itemSubTypes:n,itemType:r,element:t})?.timeItem;return s&&JSON.stringify(s?.itemValue)===JSON.stringify(a)&&!e}function hV({creationTime:t=!0,removePriorValues:e,tournamentRecord:i,duplicateValues:r,participantId:n,timeItem:a}){if(!i)return{error:ve};if(!n)return{error:dr};let s=Xd({tournamentRecord:i,participantId:n});return s.error?s:Cl({element:s.participant,removePriorValues:e,duplicateValues:r,creationTime:t,timeItem:a})}function zU(t){let{removePriorValues:e,tournamentRecord:i,duplicateValues:r,creationTime:n,timeItem:a}=t;if(!i)return{error:ve};let s=Cl({element:i,removePriorValues:e,duplicateValues:r,creationTime:n,timeItem:a});if(s.error)return s;let o=kse({element:i});return st({payload:{parentOrganisation:i.parentOrganisation,tournamentId:i.tournamentId,timeItemValues:o},topic:yf}),s}function Zh(t){let{removePriorValues:e,duplicateValues:i,creationTime:r,timeItem:n,event:a}=t;return a?Cl({removePriorValues:e,duplicateValues:i,element:a,creationTime:r,timeItem:n}):{error:ps}}function Ose(t){return fN({...t,itemType:"attachConsolationStructures"})}function gV(t){return fN({...t,itemType:"attachPlayoffStructures"})}function fN({itemType:t="attachStructures",matchUpModifications:e,tournamentRecord:i,drawDefinition:r,structures:n,links:a=[],event:s}){let o="attachStructures";if(!r)return{error:$e};if(!Array.isArray(n)||!Array.isArray(a))return q({result:{error:re},stack:o});let l=g=>[g.source.structureId,g.source.roundNumber||g.source.finishingPositions?.join("|"),g.target.roundNumber].join("|"),u=r.links?.map(l);if(a.some(g=>{let I=l(g);return u?.includes(I)}))return q({result:{error:yB},info:"playoff structure exists",stack:o});a.length&&r.links?.push(...a);let c=n.map(({structureId:g})=>g),d=r.structures?.map(({structureId:g})=>g);r.structures=(r.structures??[]).map(g=>c.includes(g.structureId)?n.find(({structureId:I})=>I===g.structureId):g);let p=n?.filter(({structureId:g})=>!d?.includes(g));p.length&&r.structures.push(...p),zp({drawDefinition:r});let f=n.map(g=>At({structure:g})?.matchUps||[]).flat();Dd({tournamentId:i?.tournamentId,eventId:s?.eventId,drawDefinition:r,matchUps:f});let m=n.map(({structureId:g})=>g);if(ii({drawDefinition:r,structureIds:m}),e?.length){let g={};e.forEach(v=>{let w=v.matchUp?.matchUpId;w&&(g[w]=v)});let I=v=>{v.matchUps.forEach(w=>{if(g[w.matchUpId]){let{tieMatchUps:y,...b}=g[w.matchUpId].matchUp;if(Object.assign(w,b),y?.length){let S={};y.forEach(U=>g[U.matchUpId]=U),w.tieMatchUps.forEach(U=>Object.assign(U,S[U.matchUpId]))}g[w.matchUpId].matchUp=w,Ut(g[w.matchUpId])}})};r.structures.forEach(v=>{if(d?.includes(v.structureId))if(v.structures)for(let w of v.structures)I(w);else I(v)})}let h=p.map(Pa("structureId"));if(i){let g={itemValue:{structureIds:m,drawId:r.drawId},itemType:t};Cl({element:i,timeItem:g})}return{...W,addedStructureIds:h}}function mN(t){let{structures:e,links:i,matchUpModifications:r,error:n}=mV(t);if(n)return{error:n};let a=t.drawDefinition;return gV({tournamentId:t.tournamentRecord?.tournamentId,eventId:t.event?.eventId||t.eventId,matchUpModifications:r,drawDefinition:a,structures:e,links:i})}function Yp(t){let e=He(t,[{_anyOf:{[pn]:!1,[hr]:!1,[In]:!1,[Vc]:!1},[LB]:!0}]);if(e.error)return e;let i=[],r=t.drawDefinition??t.event??((t.tournamentId||!t.tournamentRecords)&&t.tournamentRecord);if(r){let n=vq(t,r);if(n.error)return n;i.push(...n?.applied??[]),t.drawDefinition&&ii({drawDefinition:t.drawDefinition,tournamentId:t.tournamentId})}else if(t.tournamentRecords){let n=Object.keys(t.tournamentRecords);if(!n.length)return{error:ve};for(let a of n){let s=t.tournamentRecords[a],o=vq(t,s);if(o.error)return o;i.push(...o?.applied??[])}}else return{error:ve};return i.length?{...W,applied:i}:{error:aB}}function vq(t,e){let i=Dt(t).appliedPolicies??{};e.extensions||(e.extensions=[]);let r=[],n=Object.keys(t.policyDefinitions);if(!n.length)return{error:uM};for(let a of n)if(!i[a]||t.allowReplacement){let s=t.policyDefinitions[a];if(!s)continue;if(!wt(s))return{error:re};let{policyName:o,...l}=s;if(!l||!Object.keys(l).length||o&&!ni(o))return{error:re};i[a]=t.policyDefinitions[a],r.push(a)}return r?.length?{...Ft({element:e,extension:{name:Qb,value:i}}),applied:r}:{applied:r,error:aB}}function IV({tournamentRecord:t,drawDefinition:e,flightProfile:i,drawName:r,drawId:n,event:a}){if(!r||typeof r!="string")return q({result:{error:re},context:{drawName:r}});i||(i=Bi({event:a}).flightProfile);let s=i?.flights?.find(o=>o.drawId===n);if(s){s.drawName=r;let o={name:to,value:{...i,flights:i.flights}};Yd({event:a,extension:o})}return e&&(e.drawName=r,ii({tournamentId:t?.tournamentId,drawDefinition:e})),!s&&!e?{error:$e}:{...W,flight:s}}function xse({tournamentRecord:t,drawDefinition:e,drawUpdates:i,drawId:r,event:n}){if(!wt(i))return{error:re};let a=Bi({event:n}).flightProfile,s=i.drawName&&IV({drawName:i.drawName,tournamentRecord:t,drawDefinition:e,flightProfile:a,drawId:r,event:n});if(s?.error)return s?.error;let o=s?.flight||a?.flights?.find(l=>l.drawId===r);if(!o&&!e)return{error:$e};if(o){let l={name:to,value:{...a,flights:a.flights}};Yd({event:n,extension:l})}return e&&(i.policyDefinitions&&Yp({policyDefinitions:i.policyDefinitions,drawDefinition:e}),ii({tournamentId:t?.tournamentId,drawDefinition:e})),{...W}}function Fse({tournamentRecord:t,removeScheduling:e,drawDefinition:i}){if(!i)return{error:$e};let r=Or({drawDefinition:i}),n=s=>r?.drawMatchUps?.find(o=>o.matchUpId===s);for(let s of i.structures||[]){let{positionAssignments:o,stage:l,stageSequence:u}=s;o&&(u!==1||![ze,Ae].includes(l))&&(s.positionAssignments=o.map(p=>(delete p.participantId,p)),s.seedAssignments=[]);let{matchUps:c,isRoundRobin:d}=At({afterRecoveryTimes:!1,inContext:!0,matchUpsMap:r,structure:s});for(let p of c){let{matchUpId:f,roundNumber:m}=p,h=p.sides||[],g=n(f);if(g){if(delete g.extensions,delete g.notes,g.matchUpStatus!=="BYE"&&Object.assign(g,pN),m&&m>1&&g.drawPositions?.length&&!d){let I=h?.map(({drawPosition:w,participantFed:y})=>!y&&w).filter(Boolean),v=g.drawPositions.map(w=>I.includes(w)?void 0:w);g.drawPositions=v}e?delete g.timeItems:g.timeItems?.length&&(g.timeItems=g.timeItems.filter(I=>I.itemType&&![wu,Ed,jh,T2,Gh,Hh].includes(I.itemType))),Ut({tournamentId:t?.tournamentId,context:"resetDrawDefiniton",drawDefinition:i,matchUp:g})}}}i.extensions=i.extensions.filter(s=>s.name!==Gg);let a=(i.structures||[]).map(({structureId:s})=>s);return ii({drawDefinition:i,structureIds:a}),{...W}}function qU({tournamentRecord:t}){if(!t)return{error:ve};let e={positionsNoOutcomes:[],canBePruned:[],matchPlay:[],inactive:[],drawAnalysis:{}},i={};return(t.events?.flatMap(r=>{let n=r.eventId;return i[n]=r,(r?.drawDefinitions||[]).map(a=>({drawDefinition:a,eventId:n}))}).filter(Boolean)).forEach(({drawDefinition:r,eventId:n})=>{let a=0,s=0,o=0,{allStructuresLinked:l}=lN({drawDefinition:r}),u=i[n],c=(r?.structures||[]).map(w=>{let{stage:y,stageSequence:b,structureId:S}=w,U=Vm[y],{inContextStructureMatchUps:T}=Wv({drawDefinition:r,structureId:S,structure:w,event:u}),P=T?.filter(({winningSide:$})=>$),D=P.filter(Boolean).length||0;s+=D,o+=T.length-s;let E=Math.max(P.filter(({roundNumber:$})=>$===1).map(({roundPosition:$})=>$)),{positionAssignments:R}=Kt({structure:w}),C=R?.filter(({participantId:$})=>$);a+=C?.length??0;let M=(R?.length??0)-(C?.length??0),{roundMatchUps:N,roundProfile:A,roundNumbers:O,maxMatchUpsCount:k}=Sn({matchUps:T}),F=A&&Object.keys(A).filter($=>!A[$].inactiveRound).map($=>Number.parseInt($)),x=A&&Object.keys(A).filter($=>A[$].inactiveRound).map($=>Number.parseInt($)),L=A&&Object.values(A).every($=>$.inactiveRound);return{positionsAssignedCount:C?.length??0,maxWinningSideFirstRoundPosition:E,unassignedPositionsCount:M,inactiveStructure:L,maxMatchUpsCount:k,inactiveRounds:x,roundMatchUps:N,activeRounds:F,roundNumbers:O,roundProfile:A,structureId:S,stageSequence:b,orderNumber:U,stage:y}}),d=c.find(w=>w.orderNumber===2&&w.stageSequence===1),p=c.filter(({inactiveStructure:w})=>!w).length,{links:f}=Gv({structureId:d.structureId,drawDefinition:r}),m=Ke(d.activeRounds[0])===1&&d.activeRounds.length===1&&p===1,h=c?.every(({inactiveStructure:w})=>w),g=!f.length&&d.activeRounds.length&&(d.roundProfile[1].inactiveCount||d.inactiveRounds.length),I=r.drawId;a&&!s&&e.positionsNoOutcomes.push(I),h&&e.inactive.push(I),m&&e.matchPlay.push(I),g&&e.canBePruned.push(I);let v={matchUpsWithWinningSideCount:s,matchUpsNoOutcomeCount:o,positionsAssignedCount:a,allStructuresLinked:l,structuresData:c,inactiveDraw:h,isMatchPlay:m,drawId:I};e.drawAnalysis[I]=v}),{...W,drawsAnalysis:e}}function Lse({matchPlayDrawPositions:t=!0,tournamentRecord:e,drawDefinition:i,drawId:r}){if(!e)return{error:ve};if(!i)return{error:$e};let n=[],{drawsAnalysis:a}=qU({tournamentRecord:e});if(a.canBePruned.includes(r)){let s=a.matchPlay.includes(r),o=a.drawAnalysis[r],{structures:[l]}=io({stageSequence:1,drawDefinition:i,stage:Ae}),u=o.structuresData.find(({structureId:f})=>l.structureId===f),c=(l.matchUps??[]).sort((f,m)=>f.roundPosition-m.roundPosition);n=c.filter(({roundNumber:f})=>!u.inactiveRounds.includes(f));let d=n.map(vr),p=c.map(vr).filter(f=>!d.includes(f));if(s){let f=n.filter(({roundNumber:v})=>!u.inactiveRounds.includes(v)).filter(({winningSide:v})=>v),m=f.map(vr),h=d.filter(v=>!m.includes(v));p.push(...h);let g=f.flatMap(v=>v.drawPositions??[]).filter(Boolean).flat(),I=Object.assign({},...g.map((v,w)=>({[v]:w+1})));if(f.forEach(v=>{t?v.drawPositions=v.drawPositions.map(w=>I[w]):delete v.drawPositions}),t){let v=l?.positionAssignments?.filter(w=>g.includes(w.drawPosition)).map(w=>(w.drawPosition=I[w.drawPosition],w));l.positionAssignments=v}else l.positionAssignments=[];l.matchUps=f,n=f}ku({tournamentId:e?.tournamentId,matchUpIds:p,drawDefinition:i}),ii({drawDefinition:i})}return{...W,matchUps:n}}function IBe({isPositionAction:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,loserMatchUp:n,matchUpsMap:a,structureId:s,structure:o,event:l}){if(!i)return{error:$e};if(o||({structure:o}=tt({drawDefinition:i,structureId:s})),!o)return{error:vi};s||({structureId:s}=o);let u="assignDrawPositionQualifier";Ht({method:u,color:"cyan",drawPosition:r}),a??=Or({drawDefinition:i});let{positionAssignments:c}=Kt({structure:o}),{activeDrawPositions:d}=Wv({drawDefinition:i,structureId:s});if(c?.find(I=>I.drawPosition===r)?.qualifier)return{...W};let p=!!(n&&a.drawMatchUps.some(I=>I.loserMatchUpId===n?.matchUpId&&Lr(I.matchUpStatus)));if(d?.includes(r)&&!p)return{error:JS};let f=c?.find(I=>I.drawPosition===r);if(!f)return{error:Mh};let{containsQualifier:m,containsParticipant:h}=N2(f);if(m)return{...W};let g=Dt({tournamentRecord:e,drawDefinition:i,event:l}).appliedPolicies??{};return c?.forEach(I=>{I.drawPosition===r&&(I.qualifier=!0,p&&(I.participantId=void 0,console.log("oddity: invalid participantId on qualifier position cleared")))}),Pc({tournamentId:e?.tournamentId,drawDefinition:i,structure:o,event:l}),vBe({assignedParticipantId:h,isPositionAction:t,appliedPolicies:g,drawDefinition:i,drawPosition:r,structureId:s,stack:u})}function vBe({assignedParticipantId:t,isPositionAction:e,appliedPolicies:i,drawDefinition:r,drawPosition:n,structureId:a,stack:s}){return e&&gU({appliedPolicies:i,drawDefinition:r,positionAction:{removedParticipantId:t,drawPosition:n,structureId:a,name:s}}),q({result:{...W},stack:s})}function _se({tournamentRecord:t,drawDefinition:e,participantId:i,drawPosition:r,structureId:n,qualifier:a,event:s,bye:o}){if(!e)return{error:$e};if(!r)return{error:Mv};if(!n)return{error:qa};if(o){let l=Ja({tournamentRecord:t,drawDefinition:e,drawPosition:r,structureId:n,event:s});if(l.error)return l}else if(a){let l=IBe({tournamentRecord:t,drawDefinition:e,drawPosition:r,structureId:n,event:s});if(l.error)return l}else{let l=hl({participantId:i,tournamentRecord:t,drawDefinition:e,drawPosition:r,structureId:n,event:s});if(l.error)return l}return{...W}}function $se(t){let e=t.matchUpIds??[],{drawDefinition:i}=t,r=t.structureId??i?.structures?.find(l=>l.matchUps?.some(({matchUpId:u})=>e.includes(u)))?.structureId??i?.structures?.[0]?.structureId;if(!r)return{error:vi};let n=i.structures?.find(l=>l.structureId===r);if(!n)return{error:vi};let a=n?.matchUps,s=a?.find(l=>!!l.roundPosition);if(n.structures||s||n.finishingPosition===_h)return{error:mf};let o=a.filter(({roundNumber:l})=>t.roundNumbers?.includes(l)).map(vr);return e=e.filter(l=>!o.includes(l)),t.roundNumbers&&!e.length&&(e=o),{existingMatchUps:a,matchUpIds:e,structureId:r,structure:n}}function Bse(t){let e=He(t,[{[In]:!0},{[RI]:{[dU]:!1,roundNumbers:!1},[Ba]:re,[qn]:sn}]);if(e.error)return e;let{removeIncomplete:i=!1,removeUnAssigned:r=!0,removeCompleted:n=!1,tournamentRecord:a,drawDefinition:s,event:o}=t,l=$se(t);if(l.error)return l;let{structure:u,structureId:c,existingMatchUps:d,matchUpIds:p}=l,f=[],m=d?.filter(({matchUpId:I,score:v,winningSide:w})=>{if(w&&!n)return!1;if(w||fr({score:v})){if(!w&&!i)return!1;f.push(I)}else if(!r)return!1;return p?.includes(I)})??[],h=m.map(vr),g=m.map(({tieMatchUps:I})=>I?.map(vr)).filter(Boolean).flat();if(h.length){u.matchUps=(u.matchUps??[]).filter(({matchUpId:w})=>!h.includes(w)),ku({tournamentId:a?.tournamentId,matchUpIds:[...g,...h],action:"deleteAdHocMatchUps",eventId:o?.eventId,drawDefinition:s});let I=nt(u.matchUps.map(Pa("roundNumber"))),v=Jxe(I);if(v.length){v.reverse();for(let w of v)u.matchUps.forEach(y=>{y.roundNumber&&y.roundNumber>w&&(y.roundNumber-=1,Ut({tournamentId:a?.tournamentId,context:["adHoc round deletion"],eventId:o?.eventId,drawDefinition:s,matchUp:y}))})}if(f.length){u.positionAssignments=nt(u.matchUps.flatMap(U=>(U.sides??[]).map(T=>T.participantId)).filter(Boolean)).map(U=>({participantId:U}));let w=u?.matchUpFormat??s?.matchUpFormat??o?.matchUpFormat,y=l.existingMatchUps.some(U=>U.matchUpType===La)?{matchUpTypes:[La]}:void 0,{matchUps:b}=At({afterRecoveryTimes:!1,inContext:!0,matchUpFilters:y,structure:u,event:o});Hn({structure:u})&&(u.positionAssignments=nt(b.flatMap(U=>(U.sides??[]).map(T=>T.participantId)).filter(Boolean)).map(U=>({participantId:U})));let S=cV({positionAssignments:u.positionAssignments,tournamentRecord:a,drawDefinition:s,matchUpFormat:w,matchUps:b,event:o});S.error&&console.log(S)}ii({structureIds:[c],eventId:o?.eventId,drawDefinition:s})}return!h.length&&p.length?{error:iU}:{...W,deletedMatchUpsCount:[...h,...g].length}}function Vse({removeCompletedMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:r,roundNumber:n,event:a}){if(!e)return{error:ve};if(!i)return{error:$e};if(!n)return q({result:{error:Je},info:"roundNumber required"});let s=tt({drawDefinition:i,structureId:r});if(s.error)return s;let o=s.structure;return o?.structures?{error:mf}:Hn({structure:o})?yBe({tournamentId:e.tournamentId,removeCompletedMatchUps:t,eventId:a.eventId,drawDefinition:i,roundNumber:n,structure:o}):(console.log("not implemented"),{...W})}function yBe({removeCompletedMatchUps:t,drawDefinition:e,tournamentId:i,roundNumber:r,structure:n,eventId:a}){let s=n?.matchUps??[],o=[],l=[],u=!1;if(s.reduce((c,d)=>{let p=d?.roundNumber;return p?c.includes(p)?c:c.concat(p):c},[]).sort(nr).includes(r)){let c=s.filter(d=>{let p=d.roundNumber===r&&(!Ki.includes(d.matchUpStatus)||t);return p&&(l.push(d.matchUpId),d.tieMatchUps&&o.push(...d.tieMatchUps.map(vr))),!p});l.length&&(ku({matchUpIds:[...o,...l],drawDefinition:e,tournamentId:i,eventId:a}),c.some(d=>d.roundNumber===r)||(c.forEach(d=>{d.roundNumber>r&&(d.roundNumber-=1,Ut({drawDefinition:e,tournamentId:i,eventId:a,matchUp:d}))}),u=!0),n.matchUps=c)}return{deletedMatchUpsCount:l.length,roundRemoved:u,...W}}function hN(t){let{suppressNotifications:e,tournamentRecord:i,drawDefinition:r,matchUps:n,event:a}=t;if(typeof r!="object")return{error:$e};let s=t?.structureId;if(!s&&r.structures?.length===1&&(s=r.structures?.[0]?.structureId),typeof s!="string")return{error:qa};if(!Ka(n))return{error:re,info:qp("matchUps")};let o=r.structures?.find(p=>p.structureId===s);if(!o)return{error:vi};let l=(o?.matchUps).find(p=>!!p.roundPosition);if(o.structures||l||o.finishingPosition===_h)return{error:mf};let u=Ur({tournamentRecord:i,inContext:!1})?.matchUps?.map(vr)??[],c=n.map(vr);if(xn(u,c))return{error:Cie,info:"One or more matchUpIds already present in tournamentRecord"};o.matchUps.push(...n);let d=n.map(({tieMatchUps:p})=>p).filter(Boolean).flat();return e||(Dd({tournamentId:i?.tournamentId,matchUps:[...d,...n],eventId:a?.eventId,drawDefinition:r}),ii({drawDefinition:r,structureIds:[s]})),{...W}}function jse({tournamentRecord:t,drawDefinition:e,drawPosition:i,structureId:r,subOrder:n,event:a}){if(!e)return{error:$e};if(!r)return{error:qa};if(!i)return{error:Mv};let{structure:s}=tt({drawDefinition:e,structureId:r});if(!s)return{error:vi};let o=s;s.structures&&s.structureType===gn&&(o=s.structures?.find(f=>f.positionAssignments?.find(m=>m.drawPosition===i)));let l=o?.positionAssignments,u=l?.find(f=>f.drawPosition===i);u&&Ft({element:u,extension:{name:MI,value:n}});let c=(a?.eventType===ei||e.matchUpType===ei||(a?.tieFormat??e?.tieFormat??s?.tieFormat))&&{matchUpTypes:[ei]},{matchUps:d}=At({structure:o,afterRecoveryTimes:!1,inContext:!0,matchUpFilters:c,event:a}),p=s?.matchUpFormat??e.matchUpFormat;return cV({positionAssignments:l,tournamentRecord:t,drawDefinition:e,matchUpFormat:p,matchUps:d,event:a}),ii({drawDefinition:e,structureIds:[r]}),{...W}}var Gse={};dt(Gse,{addGoesTo:()=>zp,allPlayoffPositionsFilled:()=>Z2,checkValidEntries:()=>yN,findDrawDefinition:()=>wV,getAssignedParticipantIds:()=>Pf,getAvailableMatchUpsCount:()=>gN,getAvailablePlayoffProfiles:()=>GU,getDrawDefinitionTimeItem:()=>h2,getDrawParticipantRepresentativeIds:()=>yV,getDrawStructures:()=>io,getDrawTypeCoercion:()=>XU,getEligibleVoluntaryConsolationParticipants:()=>vV,getMatchUpsMap:()=>Or,getParticipantIdFinishingPositions:()=>bV,getPositionAssignments:()=>OI,getPositionsPlayedOff:()=>Xv,getRandomQualifierList:()=>TV,getSeedingThresholds:()=>q2,getSeedsCount:()=>JU,getStructureSeedAssignments:()=>hs,getTeamLineUp:()=>Wp,getValidGroupSizes:()=>_U,isAdHoc:()=>Hn,isCompletedStructure:()=>Su,isValidForQualifying:()=>DV,positionActions:()=>UV});function vV({excludedMatchUpStatuses:t=[],includeEventParticipants:e,includeQualifyingStage:i,finishingRoundLimit:r,policyDefinitions:n,roundNumberLimit:a,tournamentRecord:s,drawDefinition:o,matchUpsLimit:l,requirePlay:u,requireLoss:c,allEntries:d,winsLimit:p,event:f}){if(!o)return{error:$e};let m=[Ae,Ti];i&&m.push(ze);let h=f?.eventType?{matchUpTypes:[f.eventType]}:void 0,g=o?.matchUpType?{matchUpTypes:[o.matchUpType]}:void 0,I=e&&f?xu({contextFilters:{stages:m},matchUpFilters:h,tournamentRecord:s,inContext:!0,event:f})?.matchUps??[]:An({contextFilters:{stages:m},matchUpFilters:g,tournamentRecord:s,inContext:!0,drawDefinition:o})?.matchUps??[],v=Vh({stage:Cr,drawDefinition:o}),w=new Set(v.map(({participantId:F})=>F)),y={},b={},S={},U={};n??=Gc({policyTypes:[yx],tournamentRecord:s,drawDefinition:o,event:f}).policyDefinitions;let T=n?.[yx];t=t.length&&t||T?.excludedMatchUpStatuses||[],e=e??T?.includeEventParticipants,d=d??T?.allEntries,r=r??T?.finishingRoundLimit,a=a??T?.roundNumberLimit,l=l??T?.matchUpsLimit,u??=T?.requirePlay??!0,c??=T?.requireLoss??!0,p=p??T?.winsLimit;for(let F of I){if(u&&F.winningSide&&![1,2].includes(F.winningSide)&&F.matchUpStatus!==Si||F.finishingRound&&r&&F.finishingRound>=r||F.finishingRound&&a&&F.finishingRound<=a)continue;let x=F.sides?.find(({sideNumber:$})=>F.winningSide&&$===3-F.winningSide),L=F.sides?.find(({sideNumber:$})=>F.winningSide&&$===F.winningSide);if(F.sides?.forEach($=>{let V=$?.participant?.participantId;V&&(S[V]=$.participant,F.matchUpStatus===Si&&!u&&(b[V]=$.participant,y[V]||(y[V]=0),(!F.matchUpStatus||!t.includes(F.matchUpStatus))&&(y[V]+=1)))}),x?.participant){let $=x.participant.participantId;b[$]=x.participant,y[$]||(y[$]=0),F.matchUpStatus&&!t.includes(F.matchUpStatus)&&(y[$]+=1)}if(L?.participant){let $=L.participant.participantId;U[$]||(U[$]=0),U[$]+=1,y[$]||(y[$]=0),F.matchUpStatus&&!t.includes(F.matchUpStatus)&&(y[$]+=1)}}let P=s?.participants&&!u&&!c&&d,D;e&&f?D=f.entries:D=o.entries;let E=P?(D??[]).filter(F=>![bu,Us].includes(F.entryStatus)).map(({participantId:F})=>F):[],R=Object.keys(b),C=P?(s?.participants??[]).filter(({participantId:F})=>E.includes(F)):c&&Object.values(b)||Object.values(S),M=F=>!c||R.includes(F),N=F=>!u||(y[F]||0)>=0,A=F=>!p||(U[F]||0)<=p,O=F=>!l||y[F]<=l,k=F=>!w.has(F);return{eligibleParticipants:C.filter(F=>M(F.participantId)&&N(F.participantId)&&A(F.participantId)&&O(F.participantId)&&k(F.participantId)).map(F=>({...F,individualParticipants:F.individualParticipantIds?.map(x=>s?.participants?.find(L=>L.participantId===x))})),losingParticipantIds:R,...W}}function gN(t){let e=He(t,[{drawDefinition:!0}]);if(e.error)return e;let{drawDefinition:i,roundNumber:r}=t,n=t.structureId??(i.structures?.length===1&&i.structures?.[0]?.structureId);if(typeof n!="string")return{error:qa};let a=i.structures?.find(m=>m.structureId===n);if(!a)return{error:vi};let s,o=(a.matchUps??[])?.reduce((m,h)=>(h.roundPosition&&(s=!0),(h?.roundNumber||0)>m?h.roundNumber:m),0);if(a.structures||s||a.finishingPosition===_h)return{error:mf};let l=i?.entries?.filter(m=>{let h=m.entryStatus;return uo.includes(h)})??[],u=Math.floor(l?.length/2)||1,c=r??o??1,d=a.matchUps?.filter(m=>m.roundNumber===c)?.length??0,p=u-d,f=p>0?p:0;return{...W,availableMatchUpsCount:f,lastRoundNumber:o,roundMatchUpsCount:u}}function yV({drawDefinition:t}){let e=ht({name:"participantRepresentatives",element:t});return e.error?e:{representativeParticipantIds:e.extension?.value||[]}}function bBe({tournamentParticipants:t,drawDefinition:e,event:i}){if(!e)return{error:$e};let r=Zi({tournamentParticipants:t,inContext:!0,drawDefinition:e,event:i}),n=Oe(r.matchUps,!1,!0),a=nt(n.reduce((o,l)=>o.concat(...l.sides.map(u=>u.participantId).filter(Boolean)),[])),s=Object.assign({},...a.map(o=>{let l=n.filter(u=>u.sides.map(c=>c.participantId).filter(Boolean).includes(o));return{[o]:l}}));return{participantIds:a,participantIdMatchUps:s}}function OI({tournamentRecord:t,drawDefinition:e,stage:i=Ae,structureId:r,structure:n}){if(!t)return{error:ve};if(!n&&!e)return{error:$e};if(!n&&!r&&e?.structures?.filter(o=>o.stage===i).length===1&&(n=e.structures.find(o=>o.stage===i)),!n&&!r)return{error:qa};let{error:a,positionAssignments:s}=Kt({drawDefinition:e,structureId:r,structure:n});return{positionAssignments:s??[],structureId:n?.structureId,error:a}}function Hse({dates:t=[],extension:e}){if(!e)return!1;if(typeof e.value=="boolean"&&e.value)return!0;if(!t.length)return!1;let i=wt(e.value)?e.value?.dates:void 0;if(Array.isArray(i))return i?.length?!!i.filter(r=>!t.length||t.includes(r)).length:!1}function wBe({inContextCourt:t,venue:e}){let{defaultStartTime:i,defaultEndTime:r,dateAvailability:n}=e;if(!(i||r||n?.length))return;let a=t.dateAvailability;if(!a?.length){n?.length?t.dateAvailability=n.map(s=>({...s})):i&&r&&(t.dateAvailability=[{startTime:i,endTime:r}]);return}t.dateAvailability=a.map(s=>{let o=SBe({date:s.date,venueDateAvailability:n,defaultStartTime:i,defaultEndTime:r});if(!o)return s;let l=UBe(s.startTime,o.startTime),u=TBe(s.endTime,o.endTime),c=DBe(s.bookings,o.bookings);return{...s,startTime:l,endTime:u,...c.length?{bookings:c}:{}}})}function SBe({date:t,venueDateAvailability:e,defaultStartTime:i,defaultEndTime:r}){if(e?.length){if(t){let a=e.find(s=>s.date===t);if(a)return a}let n=e.find(a=>!a.date);if(n)return n}if(i||r)return{startTime:i,endTime:r}}function UBe(t,e){return t?e?t>e?t:e:t:e}function TBe(t,e){return t?e?t<e?t:e:t:e}function DBe(t,e){let i=[];return t?.length&&i.push(...t),e?.length&&i.push(...e),i}function Wse({convertExtensions:t,ignoreDisabled:e,venue:i,court:r}){let n={...Oe(r,t,!0),venueId:i.venueId},{extension:a}=ht({name:bo,element:r});if(e&&a){let s=wt(a.value)?a.value?.dates:void 0,o=a?.value===!0?[]:n.dateAvailability.map(l=>{let u=l.date;if(!(!u||s.includes(u)))return l}).filter(Boolean);n.dateAvailability=o}return wBe({inContextCourt:n,venue:i}),{inContextCourt:n}}function PBe(t,e,i){if(e.length&&!e.includes(t.venueId))return!1;if(i){let{extension:r}=ht({name:bo,element:t});if(r?.value)return!1}return!0}function EBe({venue:t,convertExtensions:e,ignoreDisabled:i,dates:r,uniqueVenueIds:n,venues:a,uniqueCourtIds:s,courts:o}){n.includes(t.venueId)||(a.push(Oe(t,e,!0)),n.push(t.venueId));for(let l of t.courts??[])if(!s.includes(l.courtId)){if(i){let{extension:c}=ht({name:bo,element:l});if(Hse({extension:c,dates:r}))continue}let{inContextCourt:u}=Wse({convertExtensions:e,ignoreDisabled:i,venue:t,court:l});o.push(u),s.push(l.courtId)}}function Fu(t){let{convertExtensions:e,ignoreDisabled:i,venueIds:r=[],dates:n}=t,a=t.tournamentRecords||t.tournamentRecord&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord}||{},s=[],o=[],l=[],u=[];return Object.keys(a).filter(c=>!t.tournamentId||c===t.tournamentId).forEach(c=>{let d=a[c];for(let p of d.venues??[])PBe(p,r,!!i)&&EBe({venue:p,convertExtensions:e,ignoreDisabled:i,dates:n,uniqueVenueIds:s,venues:u,uniqueCourtIds:o,courts:l})}),{courts:l,venues:u,...W}}function RBe({convertExtensions:t,tournamentRecord:e,ignoreDisabled:i,dates:r}){if(!e)return{error:Mi};let n=Oe(e.venues??[],t).filter(s=>{if(!i)return s;let{extension:o}=ht({name:bo,element:s});return!o?.value&&s}).filter(Boolean),a=n.reduce((s,o)=>{let l=(o?.courts||[]).filter(u=>{if(!i&&!r?.length)return u;let{extension:c}=ht({name:bo,element:u});return Hse({extension:c,dates:r})}).filter(Boolean).map(u=>{let{inContextCourt:c}=Wse({convertExtensions:t,ignoreDisabled:i,venue:o,court:u});return c});return l.length?s.concat(l):s},[]);return{venues:n,courts:a}}function YU({tournamentRecords:t,requireCourts:e,dates:i}){return typeof t!="object"||!Object.keys(t).length?{error:Mi}:Object.keys(t).reduce((r,n)=>{let a=t[n],{venues:s}=RBe({tournamentRecord:a,dates:i});return s?.forEach(o=>{let{venueId:l,courts:u}=o;(!e||u?.length)&&!r.venueIds.includes(l)&&(r.venues.push(o),r.venueIds.push(l))}),r},{venues:[],venueIds:[]})}function zse({event:t}){let{surfaceCategory:e,onlineResources:i,matchUpFormat:r,discipline:n,eventLevel:a,eventName:s,eventType:o,startDate:l,category:u,ballType:c,eventId:d,endDate:p,gender:f,notes:m}=t;return{eventInfo:{drawDefinitionCount:t.drawDefinitions?.length,surfaceCategory:e,onlineResources:i,matchUpFormat:r,discipline:n,eventLevel:a,eventName:s,eventType:o,ballType:c,startDate:l,category:u,endDate:p,eventId:d,gender:f,notes:m}}}var CBe="IN_PROGRESS",MBe="ABANDONED",NBe="CANCELLED",ABe="COMPLETED",kBe="ACTIVE",qse="tournamentImage",Yse={TOURNAMENT_IMAGE_RESOURCE_NAME:qse,IN_PROGRESS:CBe,ABANDONED:MBe,CANCELLED:NBe,COMPLETED:ABe,ACTIVE:kBe},OBe={[$v]:{policyName:"Staff Privacy Policy",participant:{contacts:!1,individualParticipants:!1,individualParticipantIds:!1,onlineResources:!1,participantName:!0,participantOtherName:!0,participantId:!0,participantRole:!0,participantRoleResponsibilities:!0,participantStatus:!0,penalties:!1,representing:!0,participantType:!0,person:{addresses:!1,biographicalInformation:!1,birthDate:!1,contacts:!1,nationalityCode:!0,nativeFamilyName:!1,nativeGivenName:!1,onlineResources:!1,otherNames:!0,parentOrganisationId:!1,passportFamilyName:!1,passportGivenName:!1,personId:!1,personOtherIds:!1,previousNames:!1,sex:!1,standardFamilyName:!0,standardGivenName:!0,status:!1,tennisId:!1,wheelchair:!0}}}},xBe=OBe;function eg(t){let{tournamentRecord:e,withMatchUpStats:i,withStructureDetails:r,withVenueData:n}=t??{};if(!e)return{error:ve};let a=(({tournamentId:m,tournamentRank:h,tournamentStatus:g,formalName:I,tournamentName:v,promotionalName:w,onlineResources:y,localTimeZone:b,activeDates:S,startDate:U,endDate:T,hostCountryCode:P,venues:D,notes:E,updatedAt:R})=>({tournamentId:m,tournamentRank:h,tournamentStatus:g,formalName:I,tournamentName:v,promotionalName:w,onlineResources:y,localTimeZone:b,activeDates:S,startDate:U,endDate:T,hostCountryCode:P,venues:D,notes:E,updatedAt:R}))(e),s=e.venues?.find(m=>m.isPrimary);s?.addresses?.length&&(a.tournamentAddress=s.addresses[0]);let o=Ri({participantFilters:{participantRoles:[Nae,$2,Aae,kae,xae]},policyDefinitions:xBe,tournamentRecord:e})?.participants??[];o&&(a.tournamentContacts=o);let l=e?.onlineResources?.find(m=>m.name===qse&&m.resourceType==="URL")?.identifier;l&&(a.imageUrl=l);let u=Yh({tournamentRecord:e})?.publishState,c=u?.tournament?.status?.publishedEventIds||[],d=[];for(let m of e.events??[])if(!t?.usePublishState||c.includes(m.eventId)){let h=zse({event:m}).eventInfo;h&&d.push(h)}a.timeItemValues=kse({element:e}),a.publishState=u?.tournament,a.eventInfo=d;let p=[],f=[];if(i||r)for(let m of e.events??[])for(let h of m.drawDefinitions??[])for(let g of h.structures??[])f.push(...g.matchUps??[]),p.push(je({eventId:m.eventId,eventName:m.eventName,eventType:m.eventType,drawId:h.drawId,drawName:h.drawName,drawType:h.drawType,structureId:g.structureId,structureName:g.structureName,stage:g.stage,stageSequence:g.stageSequence,positionAssignments:g.positionAssignments,seedAssignments:g.seedAssignments,matchUpFormat:g.matchUpFormat}));if(r&&(a.structures=p),i){let m=e.participants?.filter(S=>S.participantType===It).length??0,h=e.participants?.filter(S=>S.participantType===_t).length??0,g=e.events?.length??0,I=f?.filter(S=>S.matchUpStatus!=="BYE"),v=I?.length,w=I?.filter(S=>Ki.includes(S.matchUpStatus)||S.winningSide)?.length,y=I?.filter(S=>Df({matchUp:S})?.scheduledDate||P2({matchUp:S})?.scheduledTime)?.length,b=v>0?Math.round(w/v*100):0;a.matchUpStats={total:v,completed:w,scheduled:y,percentComplete:b},a.individualParticipantCount=m,a.teamParticipantCount=h,a.eventCount=g}if(n){let{venues:m}=Fu({tournamentRecord:e});a.venues=m??[]}return{tournamentInfo:Oe(je(a),!1,!0),...W}}function Kse({publishStatus:t,drawId:e}){return t?.drawDetails?jo(t.drawDetails?.[e]?.publishingDetail):t?.drawIds?t.drawIds.includes(e):!0}var Xse="PUBLIC",FBe="ADMIN",LBe={PUBLIC_DISPLAY:Xse,ADMIN_DISPLAY:FBe};function IN(t){let{tournamentParticipants:e=[],includePositionAssignments:i,policyDefinitions:r,tournamentRecord:n,inContext:a=!0,usePublishState:s,status:o=Xa,pressureRating:l,refreshResults:u,contextProfile:c,drawDefinition:d,noDeepCopy:p,sortConfig:f,context:m,event:h}=t;if(!d)return{error:$e};let{matchUpFormat:g,updatedAt:I,drawType:v,drawName:w,drawId:y}=d,b={matchUpFormat:g,updatedAt:I,drawName:w,drawType:v,drawId:y};b.display=ht({element:d,name:GP}).extension?.value;let S={},U,T,{allStructuresLinked:P,sourceStructureIds:D,hasDrawFeedProfile:E,structureGroups:R}=lN({drawDefinition:d});if(!P)return{error:Ate};let C=t?.eventPublishState??Yh({event:h}).publishState,M=t?.publishStatus??Qa({event:h,status:o}),N=C?.status?.drawDetails?.[d.drawId],A=!!C?.status?.published,O=N?.structureDetails,k=!1,F=!1,x=R.map(L=>{let $={},V=L.map(_=>{let{structure:B}=tt({drawDefinition:d,structureId:_}),{seedAssignments:G}=hs({drawDefinition:d,structure:B});return B?.stage===Ae&&B.stageSequence===1&&(U=G),B?.stage===ze&&(S[B.stageSequence??0]=G),B}).sort((_,B)=>Bh(_,B,f)).map(_=>{if(!_)return;let B=_?.structureId,G=[];_.stage&&[Ae,tn,Ti].includes(_.stage)&&(G=U),_?.stage===ze&&(G=S[_.stageSequence??0]);let{matchUps:j,roundMatchUps:K,roundProfile:Y}=At({seedAssignments:_?.seedAssignments?.length?void 0:G,context:{drawId:b.drawId,...m},hydrateParticipants:t.hydrateParticipants,participantsProfile:t.participantsProfile,tournamentParticipants:e,policyDefinitions:r,tournamentRecord:n,usePublishState:s,publishStatus:M,contextProfile:c,drawDefinition:d,inContext:a,structure:_,event:h}),{positionAssignments:X}=Kt({structure:_}),Z=X?.filter(Pa(Iu)).map(ne=>{let le=ht({element:ne,name:Dc})?.extension?.value,{drawPosition:de,participantId:pe}=ne;return F=!0,{participantResult:le,participantId:pe,drawPosition:de}});if(j.length&&(!Z?.length&&t.allParticipantResults||u&&!_.structures)){let{subOrderMap:ne}=x2({positionAssignments:X}),le=j.some(pe=>pe.matchUpType===La)?j.filter(pe=>pe.matchUpType===La):j,de=qh({matchUpFormat:_.matchUpFormat,matchUps:le,policyDefinitions:r,pressureRating:l,subOrderMap:ne});T=de?.report,Z=X?.filter(Pa(Iu)).map(pe=>{let{drawPosition:ge,participantId:Me}=pe;return F=!0,{participantResult:Me&&de?.participantResults?.[Me],participantId:Me,drawPosition:ge}})}let J=_?{stageSequence:_.stageSequence,structureName:_.structureName,structureType:_.structureType,matchUpFormat:_.matchUpFormat,stage:_.stage}:{},ae=ht({element:_,name:GP}).extension?.value;J.display=ae?.[Xse]??ae,J.sourceStructureIds=D[B],J.hasDrawFeedProfile=E[B],J.positionAssignments=X,J.structureActive=j.reduce((ne,le)=>{let de=[Si,Wi,lo,Oi,Rl,qt,Sr,ai].includes(le.matchUpStatus);return ne||de||!!le.winningSide||!!le.score?.scoreStringSide1},!1);let te=j.every(ne=>[...Ki,"BYE"].includes(ne.matchUpStatus));return J.structureCompleted=te,$[B]=te,J.structureActive&&(k=!0),{...J,participantResults:Z,seedAssignments:G,roundMatchUps:K,roundProfile:Y,structureId:B,report:T}});return V.forEach(_=>{i||delete _.positionAssignments,_.sourceStructuresComplete=_.sourceStructureIds?.every(B=>$[B])}),V}).flat().filter(L=>!s||jo(O?.[L?.structureId])||!0);return b.drawActive=k,b.participantPlacements=F,b.drawGenerated=x?.reduce((L,$)=>L||!!$?.roundMatchUps,!1),b.drawCompleted=x?.reduce((L,$)=>L&&$.structureCompleted,!0),b.drawPublished=s?A&&Kse({publishStatus:M,drawId:b.drawId}):void 0,{structures:!s||b.drawPublished?p&&x||Oe(x,!1,!0):void 0,drawInfo:p?b:Oe(b,!1,!0),...W}}function KU(t){let{includePositionAssignments:e,participantsProfile:i,policyDefinitions:r,usePublishState:n,status:a=Xa,contextProfile:s,sortConfig:o}=t,l=He(t,[{tournamentRecord:!0},{[HB]:{event:!1,eventId:!1}}]);if(l.error)return l;let u=Oe(t.tournamentRecord,!1,!0),c=t.event==null?Wn({tournamentRecord:u,eventId:t.eventId}).event:void 0,d=t.event?Oe(t.event,!1,!0):c&&Oe(c,!1,!0)||void 0;if(!d)return{error:ps};let{eventId:p}=d,{tournamentId:f,endDate:m}=u,h=Qa({event:d,status:a}),g=Yh({event:d}).publishState??{},I=!!g?.status?.published,{participants:v}=Ri({participantFilters:t.participantFilters,withEvents:!1,withDraws:!1,policyDefinitions:r,...i,tournamentRecord:u}),w=({stage:C,drawId:M})=>{if(!n)return!0;let N=h?.drawDetails?.[M]?.stageDetails;return!N||!Object.keys(N).length?!0:jo(N[C])},y=({structureId:C,drawId:M})=>{if(!n)return!0;let N=h?.drawDetails?.[M]?.structureDetails;return!N||!Object.keys(N).length?!0:jo(N[C])},b=({drawId:C})=>n?Kse({publishStatus:h,drawId:C}):!0,S=({drawId:C,drawType:M,structure:N})=>{if(!n||M!==ua)return N;let A=h?.drawDetails?.[C]?.structureDetails?.[N.structureId]?.roundLimit;if(lt(A)){let O=Ce(1,A+1),k={},F={};for(let x of O)N.roundMatchUps[x]&&(k[x]=N.roundMatchUps[x],F[x]=N.roundProfile[x]);N.roundMatchUps=k,N.roundProfile=F}return N},U=d.drawDefinitions||[],T=!n||I?U.filter(b).map(C=>(({drawInfo:M,structures:N})=>({...M,structures:N}))(IN({allParticipantResults:t.allParticipantResults,hydrateParticipants:t.hydrateParticipants,context:{eventId:p,tournamentId:f,endDate:m},pressureRating:t.pressureRating,refreshResults:t.refreshResults,includePositionAssignments:e,tournamentParticipants:v,eventPublishState:g,noDeepCopy:!0,policyDefinitions:r,tournamentRecord:u,usePublishState:n,contextProfile:s,drawDefinition:C,publishStatus:h,sortConfig:o,event:d}))).map(({structures:C,...M})=>{let N=C?.filter(({stage:A,structureId:O})=>y({structureId:O,drawId:M.drawId})&&w({stage:A,drawId:M.drawId})).map(A=>S({drawId:M.drawId,drawType:M.drawType,structure:A}));return{...M,structures:N}}).filter(C=>C.structures?.length):void 0,P=(Array.isArray(u.venues)?u.venues:[]).map(C=>{let{venueData:M}=AI({venueId:C.venueId,tournamentRecord:u});return{...M}}),D=(({eventId:C,eventName:M,eventType:N,eventLevel:A,surfaceCategory:O,matchUpFormat:k,category:F,gender:x,startDate:L,endDate:$,ballType:V,discipline:_})=>({eventId:C,eventName:M,eventType:N,eventLevel:A,surfaceCategory:O,matchUpFormat:k,category:F,gender:x,startDate:L,endDate:$,ballType:V,discipline:_}))(d);D.display=ht({element:d,name:GP}).extension?.value;let{tournamentInfo:E}=eg({tournamentRecord:u}),R={tournamentInfo:E,venuesData:P,eventInfo:D,drawsData:T};return R.eventInfo.publishState=g,R.eventInfo.published=g?.status?.published,{...W,eventData:R,participants:v}}function bV({byeAdvancements:t=!1,tournamentRecord:e,drawDefinition:i,event:r}){if(!i)return{error:$e};let{participantIds:n,participantIdMatchUps:a}=bBe({tournamentParticipants:e?.participants,drawDefinition:i}),s=Object.values(a).some(p=>p.some(f=>f.containerStructureId)),o=(s&&KU({tournamentRecord:e,event:r}))?.eventData?.drawsData?.find(p=>p.drawId===i.drawId)?.structures,l=i?.structures?.find(p=>p.stage===Ae&&p.stageSequence===1),u=l?.structureType===gn&&l.structures,c=(s?OI({tournamentRecord:e,drawDefinition:i,structureId:l?.structureId})?.positionAssignments:void 0)?.length||0,d=n?.map(p=>{let f=a[p].filter(I=>[Oi,"BYE"].includes(I.matchUpStatus)||I.winningSide),m=f.map(I=>{let v=I.sides.find(y=>y.bye),w=I.sides.find(y=>y.participantId===p).sideNumber;if(I.containerStructureId){let y=_Be({containedStructures:u,drawPositionsCount:c,drawDataStructures:o,drawDefinition:i,participantId:p,matchUp:I});if(y)return y}return(I.winningSide||t&&v&&w)===w?I.finishingPositionRange.winner:I.finishingPositionRange.loser}),h=I=>Math.abs(I[0]-I[1]),g=m.reduce((I,v)=>I&&h(I)<h(v)?I:v,void 0);return{[p]:{finishingPositionRanges:m,finishingPositionRange:g,relevantMatchUps:f}}})||[];return Object.assign({},...d)}function _Be({containedStructures:t,drawPositionsCount:e,drawDataStructures:i,drawDefinition:r,participantId:n,matchUp:a}){let s=t?.find(f=>f.structureId===a.structureId)?.positionAssignments?.length,o=i.find(f=>f.structureId===a.containerStructureId)?.participantResults?.find(f=>f.participantId===n)?.participantResult,{ties:l,groupOrder:u,provisionalOrder:c}=o||{},d=t?.length,p=r.structure?.find(f=>f.stage===Ti);if(la()&&console.log({drawPositionsCount:e,provisionalOrder:c,bracketsCount:d,bracketSize:s,groupOrder:u,ties:l}),e===s&&u)return[u,u];if(d>1&&u&&!p)return[1,d];if(d>1&&u&&p){let f=r.links?.find(h=>h.source.structureId===a.containerStructureId)?.source?.finishingPositions,m=f.length*d;if(u in f)return[1,m];{let h=(s-u)*d;return[m+1,e-h]}}}function ep({tournamentRecords:t,tournamentRecord:e,tournamentId:i,drawId:r}){if(!e&&!t)return{error:ve};if(!r)return{error:xo};if(!e&&t){if(typeof i!="string"&&(i=Nse({tournamentRecords:t,drawId:r}),!i))return{error:yI};if(e=t[i],!e)return{error:ve}}let n=e&&Wn({tournamentRecord:e,drawId:r});return n?.drawDefinition?{drawDefinition:n.drawDefinition,event:n.event,tournamentRecord:e,...W}:q({result:{error:_a},stack:"findDrawDefinition"})}function wV(t){let{drawDefinition:e,error:i}=ep(t);return i?{error:i}:{drawDefinition:Oe(e)}}function $Be({tournamentParticipants:t,returnParticipants:e,drawPosition:i,participant:r,drawId:n,event:a}){let s=a?.entries?.filter(({entryStatus:o})=>[Us,Sf].includes(o)).map(({participantId:o})=>o)||[];if(s.length){let o=r.individualParticipantIds,l=e?t.filter(({participantId:c})=>s.includes(c)):void 0,u=e?t.filter(({participantId:c})=>o.includes(c)):void 0;return{validModifyAssignedPairAction:je({payload:{participantId:r.participantId,replacementIndividualParticipantId:void 0,existingIndividualParticipantId:void 0,drawPosition:i,drawId:n},method:V$e,availableIndividualParticipantIds:s,availableIndividualParticipants:l,existingIndividualParticipantIds:o,existingIndividualParticipants:u,type:rV},!1,!1,!0)}}return{}}function Kp(t){let{inContextDrawMatchUps:e,targetData:i,drawDefinition:r,relevantLink:n}=t;if(n?.linkCondition===fl&&i?.matchUp?.matchUpStatus==="BYE")return!1;let{targetMatchUps:{loserMatchUp:a,winnerMatchUp:s},targetLinks:o}=i,l=a&&Fn({matchUpId:a.matchUpId,inContextDrawMatchUps:e,drawDefinition:r}),u=l?.targetMatchUps?.loserMatchUp,c=l?.targetMatchUps?.loserMatchUpDrawPositionIndex,d=u?.sides[c]?.participant,p=Lr(a?.matchUpStatus),f=p&&!d,m=a?.sides?.filter(w=>w?.participant).length??0,h=a?.winningSide&&p&&m===1,g=s?.drawPositions?.filter(Boolean).length||0;if(!h&&(a?.winningSide&&!f||s?.winningSide&&g===2&&(!s.feedRound||!Lr(s?.matchUpStatus))))return!0;let I=s&&Fn({matchUpId:s.matchUpId,inContextDrawMatchUps:e,drawDefinition:r}),v=l&&Kp({relevantLink:o?.loserTargetLink,targetData:l,inContextDrawMatchUps:e,drawDefinition:r});return!!(I&&Kp({targetData:I,inContextDrawMatchUps:e,drawDefinition:r})||v)}var Jse={[yu]:{policyName:"positionActionsDefault",enabledStructures:[{stages:[ze,Ae],stageSequences:[1],enabledActions:[],disabledActions:[]},{stages:[],stageSequences:[],enabledActions:[aw,Ym,uN,Im],disabledActions:[]}],disbledStructures:[],otherFlightEntries:!1,activePositionOverrides:[]}},bD="positionAction",xx="matchUpAction";function Qse({actionType:t=bD,appliedPolicies:e,drawDefinition:i,structure:r}){let n=t===bD&&yu||t===xx&&Mr,a=t===bD&&Jse||t===xx&&Mae,s=n&&(e?.[n]||a?.[n]),o=i.links?.filter(d=>d?.target?.structureId===r?.structureId)?.map(({target:d})=>d.feedProfile)??[],{enabledStructures:l,disabledStructures:u}=s||{},c=u?.find(d=>{let{stages:p,stageSequences:f,structureTypes:m,feedProfiles:h}=d;return(!h?.length||Array.isArray(h)&&h.some(g=>o.includes(g)))&&(!p?.length||Array.isArray(p)&&p?.includes(r?.stage))&&(!m?.length||Array.isArray(m)&&m?.includes(r?.structureType))&&(!f?.length||Array.isArray(f)&&f.includes(r?.stageSequence))});return{enabledStructures:l,actionsDisabled:c,actionsPolicy:s}}function BBe({activePositionOverrides:t,activeDrawPositions:e,action:i}){return i&&t.includes(i)?!0:!e.length}function Zse({enabledStructures:t,drawDefinition:e,structure:i}){if(t===!1)return{};if(!t?.length)return{policyActions:{enabledActions:[],disabledActions:[]}};let{stage:r,stageSequence:n,structureType:a}=i||{},s=e.links?.filter(o=>o?.target?.structureId===i?.structureId)?.map(({target:o})=>o.feedProfile)||[];return{policyActions:t.find(o=>{let{stages:l,stageSequences:u,structureTypes:c,feedProfiles:d}=o||{},p=!l?.length||Array.isArray(l)&&l.includes(r),f=!u?.length||Array.isArray(u)&&u.includes(n),m=!c?.length||Array.isArray(c)&&c.includes(a),h=!d?.length||Array.isArray(d)&&d.some(g=>s.includes(g));return f&&m&&h&&o&&p})}}function ea({action:t,policyActions:e}){let i=!e?.enabledActions||e?.disabledActions?.length&&e.disabledActions.includes(t);return i?!1:(e?.enabledActions.length===0||e?.enabledActions.includes(t))&&!i}var eoe="replaceTieMatchUpParticipantId",toe="assignTieMatchUpParticipantId",Fx="removeTieMatchUpParticipantId",yq="assignMatchUpSideParticipant",VBe="removeMatchUpSideParticipant",ioe="substituteParticipant",Lx="REMOVE_SUBSTITUTION",roe="REPLACE_PARTICIPANT",SV="REMOVE_PARTICIPANT",_x="setMatchUpStatus",$x="SUBSTITUTION",noe="SCHEDULE",jBe="PENALTY",Bx="REFEREE",aoe="STATUS",Vx="START",soe="SCORE",GBe={REPLACE_TEAM_POSITION_METHOD:eoe,ASSIGN_TEAM_POSITION_METHOD:toe,REMOVE_TEAM_POSITION_METHOD:Fx,REPLACE_PARTICIPANT:roe,SUBSTITUTION_METHOD:ioe,REMOVE_SUBSTITUTION:Lx,REMOVE_PARTICIPANT:SV,SCHEDULE_METHOD:_x,SUBSTITUTION:$x,SCHEDULE:noe,PENALTY:jBe,REFEREE:Bx,STATUS:aoe,SCORE:soe,START:Vx,END:"END"};function HBe({specifiedPolicyDefinitions:t,inContextDrawMatchUps:e,matchUpParticipantIds:i,matchUpActionsPolicy:r,inContextMatchUp:n,policyActions:a,enforceGender:s,participantId:o,sideNumber:l,matchUpId:u,matchUp:c,drawId:d,side:p}){let f=[],m=n.sides?.find(M=>M.participant),h=Aa(n.gender)&&n.sideNumber&&n.sides?.filter(M=>M.particiapntId).length===1&&m?.participant?.person?.sex,g=n.matchUpType,I=(s??r?.participants?.enforceGender)!==!1?n.gender:void 0,v=n.sides?.flatMap(M=>M.participant?.individualParticipants||M.participant).filter(Boolean)?.map(yt),w=n.sides?.filter(M=>!l||M.sideNumber===l).flatMap(M=>M.participant?.individualParticipants||M.participant).filter(Boolean),y=w?.map(yt),b=e?.find(M=>M.matchUpId===n.matchUpTieId)?.sides?.map(M=>M?.participant?.individualParticipants?.filter(({participantId:N,person:A})=>!y?.includes(N)&&(!I||du(I)||A.sex===I||Aa(I)&&!h||h&&A.sex!==h))),S=l?b?.[l-1]:b?.map((M,N)=>({participants:M,sideNumber:N+1})),U=l?b?.[l-1]?.map(yt):b?.map((M,N)=>({participants:M?.map(yt),sideNumber:N+1})),T=l&&(Pi(pm)(g)&&!y?.length||Pi(_p)(g)&&(y?.length??0)<2)||!l&&(Pi(pm)(g)&&(y?.length??0)<2||Pi(_p)(g)&&(y?.length??0)<4),P=U?.filter(M=>!v?.includes(M)),D=S?.filter(({participantId:M})=>P.includes(M));if(T&&P?.length&&f.push({availableParticipantIds:P,method:toe,availableParticipants:D,type:qm,payload:{participantId:void 0,tieMatchUpId:u,sideNumber:l,drawId:d}}),y?.length&&(!fr(c)||p?.substitutions?.length)&&f.push({method:Fx,type:SV,existingParticipantIds:y,payload:{participantId:void 0,tieMatchUpId:u,drawId:d}}),D?.length&&(!l&&y?.length||l&&p?.participant)&&f.push({availableParticipantIds:P,method:eoe,availableParticipants:D,type:roe,existingParticipantIds:y,payload:{existingParticipantId:void 0,participantId:void 0,tieMatchUpId:u,drawId:d}}),ea({policyActions:a,action:Lx})&&p?.substitutions?.length){let M=p.participant?.participantType===It&&[p.participantId]||p.participant?.participantType===ft&&p.participant.individualParticipantIds||[],N=p.substitutions.map(A=>A.participantId).filter(A=>M.includes(A));(!o||N.includes(o))&&f.push({method:Fx,type:Lx,substitutedParticipantIds:N,payload:{participantId:void 0,tieMatchUpId:u,drawId:d}})}let E=t?.[Mr],R=E?.substituteWithoutScore,C=E?.substituteAfterCompleted;if(ea({policyActions:a,action:$x})&&i.length===2&&(!l&&y?.length||l&&p?.participant)&&(R||fr(c))&&(C||c.matchUpStatus&&!Ki.includes(c.matchUpStatus))&&w?.length&&S.length){let M=w.map(yt);f.push({info:"list of team players available for substitution",method:ioe,availableParticipantIds:U,existingParticipantIds:M,availableParticipants:S,existingParticipants:w,type:$x,payload:{substituteParticipantId:void 0,existingParticipantId:void 0,sideNumber:l,matchUpId:u,drawId:d}})}return f}function WBe({tournamentParticipants:t=[],possiblyDisablingAction:e,activeDrawPositions:i,positionAssignments:r,returnParticipants:n,appliedPolicies:a,drawDefinition:s,drawPosition:o,validActions:l,structureId:u,structure:c,drawId:d,event:p}){if(i.includes(o))return{};let f=l.find(U=>U.type===qm)?.availableParticipantIds,m=a?.[yu]?.otherFlightEntries,h=a?.[yu]?.restrictQualifyingAlternates,g=(s.entries??[]).filter(({entryStage:U})=>!h||(c.stage===ze?U===ze:U!==ze)).sort((U,T)=>(U.entryPosition??1/0)-(T.entryPosition??1/0)).map(({participantId:U})=>U).filter(Boolean),{allPositionedParticipantIds:I}=vne({drawDefinition:s}),v=r.map(U=>U.participantId).filter(Boolean),w=g.filter(U=>c.stage&&[ze,Ae,Ti].includes(c.stage)?!I?.includes(U):!v.includes(U)),y=(p?.entries??[]).filter(U=>U.entryStatus===Gs&&ooe({restrictQualifyingAlternates:h,structure:c,entry:U})&&(c.stage&&[ze,Ae,Ti].includes(c.stage)?!I?.includes(U.participantId):!v.includes(U.participantId))).sort((U,T)=>(U.entryPosition??1/0)-(T.entryPosition??1/0)).map(U=>U.participantId),b=nt(w.concat(y));if(m){let U=(p?Bi({event:p}).flightProfile:void 0)?.flights?.filter(T=>T.drawId!==d).map(T=>T.drawEntries.filter(P=>P.participantId&&![bu,Us,Sf].includes(P.entryStatus)&&!g.includes(P.participantId)).map(({participantId:P})=>P)).flat().filter(Boolean);U?.length&&b.push(...U)}f?.length&&(b=b.filter(U=>!f.includes(U)));let S=n?t?.filter(U=>b.includes(U.participantId)):void 0;return S?.forEach(U=>{let T=(s.entries??[]).find(P=>P.participantId===U.participantId);U.entryPosition=T?.entryPosition}),S?.sort((U,T)=>(U.entryPosition||1/0)-(T.entryPosition||1/0)),b.length?{validAlternatesAction:je({payload:{drawId:d,structureId:u,drawPosition:o},willDisableLinks:e,method:$$e,availableAlternatesParticipantIds:b,type:nV,availableAlternates:S})}:{}}function ooe({restrictQualifyingAlternates:t,structure:e,entry:i}){let{stage:r}=e;if(!i.entryStage||i.entryStage===r||r===ze&&!t||i.entryStage===Ae&&r===tn)return!0}function zBe({eventEntries:t,structure:e}){let i=n=>n.entryStatus===Gs&&ooe({structure:e,entry:n}),r=(n,a)=>(n.entryPosition||1/0)-(a.entryPosition||1/0);return t.filter(i).sort(r).map(yt)}function qBe({restrictAdHocRoundParticipants:t,tournamentParticipants:e,matchUpParticipantIds:i,otherFlightEntries:r,drawDefinition:n,structureId:a,sideNumber:s,matchUpId:o,structure:l,matchUp:u,drawId:c,event:d}){let p=[],f=l?.matchUps??[],m=u.sides?.find(T=>T.sideNumber===s)?.participantId,h=f.filter(({roundNumber:T})=>T===u.roundNumber),g=n?.entries?.filter(({entryStatus:T})=>T&&Uf.includes(T)).map(yt)??[],I=h.map(T=>(T.sides??[]).flatMap(yt)).flat().filter(Boolean),v=g.filter(T=>!i.includes(T)&&(!t||!I.includes(T))),w=e?.filter(T=>v?.includes(T.participantId)).map(T=>Oe(T,void 0,!0));w?.forEach(T=>{let P=(n.entries??[]).find(D=>D.participantId===T.participantId);T.entryPosition=P?.entryPosition}),v.length&&p.push({payload:{drawId:c,matchUpId:o,structureId:a,sideNumber:s},method:yq,type:qm,availableParticipantIds:v,participantsAvailable:w});let y=d?.entries??[],b=zBe({eventEntries:y,structure:l}),S=nt(g.concat(b));if(r){let T=(d?Bi({event:d}):void 0)?.flights?.filter(P=>P.drawId!==c).flatMap(P=>P.drawEntries.filter(D=>D.participantId&&![bu,Us,Sf].includes(D.entryStatus)).map(({participantId:D})=>D)).filter(Boolean);T?.length&&S.push(...T)}S=S.filter(T=>!i.includes(T)&&!v.includes(T)&&(!t||!I.includes(T)));let U=e?.filter(T=>S.includes(T.participantId)).map(T=>Oe(T,void 0,!0));if(U?.forEach(T=>{let P=(n.entries??[]).find(D=>D.participantId===T.participantId);T.entryPosition=P?.entryPosition}),U?.sort((T,P)=>(T.entryPosition||1/0)-(P.entryPosition||1/0)),S.length&&p.push({payload:{drawId:c,matchUpId:o,structureId:a,sideNumber:s},availableParticipantIds:S,participantsAvailable:U,method:yq,type:Gs}),!fr(u)&&s&&m){p.push({payload:{drawId:c,matchUpId:o,structureId:a,sideNumber:s},method:VBe,type:SV});let T=A=>A.sides.map(yt),P=({matchUpId:A})=>A!==u.matchUpId,D=A=>!fr(A),E=u.sides?.find(A=>A.sideNumber!==s)?.participantId,R=f.filter(({roundNumber:A})=>A!==u.roundNumber).filter(P).map(T),C=[E,...R.filter(A=>A.includes(m)).flat()].filter(Boolean),M=A=>!C.flat().includes(A),N=h.filter(D).filter(P).map(T).flat().filter(M);if(N.length){let A=e?.filter(O=>N.includes(O.participantId)).map(O=>Oe(O,void 0,!0));p.push({payload:{participantIds:[m],roundNumber:u.roundNumber,structureId:a,sideNumber:s,matchUpId:o,drawId:c},swappableParticipantIds:N,method:j$e,type:cN,swappableParticipants:A})}}return p}function vN(t){if(!t)return{error:re};let{drawDefinition:e,event:i}=t,{restrictAdHocRoundParticipants:r=!0,policyDefinitions:n,enforceGender:a,participantId:s,sideNumber:o,matchUpId:l}=t,u=t.tournamentRecord??(t.tournamentId&&ni(t.tournamentId)&&t.tournamentRecords?.[t.tournamentId]);if(!u)return{error:ve};if(!l||!ni(l))return{error:Tn};if(o&&![1,2].includes(o))return q({result:{error:re},context:{sideNumber:o}});if(!e){let Y=(Ur({tournamentRecord:u}).matchUps??[]).find(Z=>Z.matchUpId===l);i=(u?.events??[]).find(Z=>Z.eventId===Y?.eventId);let X=(i?.drawDefinitions??[]).find(Z=>Z.drawId===Y?.drawId);X&&(e=X)}if(!e)return{error:$e};let c=Ri({withIndividualParticipants:!0,tournamentRecord:u}).participants,{drawId:d}=e,{matchUp:p,structure:f}=fi({drawDefinition:e,matchUpId:l,event:i});if(!p)return{error:dn};let m=Dt({tournamentRecord:u,drawDefinition:e,structure:f,event:i}).appliedPolicies??{};Object.assign(m,n??{});let h=m?.[yu]?.otherFlightEntries,g=m?.[Mr]??qv[Mr],{enabledStructures:I}=Qse({actionType:xx,appliedPolicies:m,drawDefinition:e,structure:f}),{policyActions:v}=Zse({enabledStructures:I,drawDefinition:e,structure:f}),w=t.matchUpsMap??Or({drawDefinition:e}),y=t.inContextDrawMatchUps??Zi({tournamentParticipants:c,inContext:!0,drawDefinition:e,matchUpsMap:w,event:i}).matchUps,b=y?.find(Y=>Y.matchUpId===l),S=o&&b?.sides?.find(Y=>Y.sideNumber===o),U=b?.sides?.map(Y=>Y.participantId||Y.participant?.participantid).filter(Boolean)??[],{assignedPositions:T,allPositionsAssigned:P}=pr({structure:f}),{structureId:D}=f??{},E=[];if(!D)return{validActions:E};let R=Hn({structure:f}),C=!!p.collectionId;if(R&&!C){let Y=qBe({restrictAdHocRoundParticipants:r,tournamentParticipants:c,matchUpParticipantIds:U,otherFlightEntries:h,drawDefinition:e,structureId:D,sideNumber:o,matchUpId:l,structure:f,matchUp:p,drawId:d,event:i});E.push(...Y)}let M=Su({drawDefinition:e,structure:f}),N=T?.filter(Y=>Y.participantId).map(Y=>Y.drawPosition),A=T?.filter(Y=>Y.bye).map(Y=>Y.drawPosition),O=p.matchUpStatus==="BYE"||!C&&p.drawPositions?.reduce((Y,X)=>A?.includes(X)||Y,!1);if(O)return{validActions:E,isByeMatchUp:O};ea({policyActions:v,action:Bx})&&E.push({type:Bx,payload:{matchUpId:l}});let k=!NU({matchUpStatus:p.matchUpStatus}),F=m?.scoring?.structures,x=f?.stage&&F?.stage?.[f.stage],L=f?.stageSequence&&x?.stageSequence?.[f.stageSequence],$=!(m?.scoring?.requireAllPositionsAssigned||x?.requireAllPositionsAssigned||L?.requireAllPositionsAssigned)||P,V=p.sides?.filter(Y=>Y?.participantId).length===2,_=p.matchUpStatus&&[Si,Wi].includes(p.matchUpStatus),B=Fn({inContextDrawMatchUps:y,drawDefinition:e,matchUpId:l}),G=Kp({inContextDrawMatchUps:y,drawDefinition:e,targetData:B}),j=(b?.drawPositions?.length===2&&b.drawPositions.every(Y=>N?.includes(Y))&&b?.sides?.length===2&&b.sides.every(({participantId:Y})=>Y)||V)&&!(_&&G),K={method:Ise,type:Ym,payload:{drawId:d,matchUpId:l,penaltyCode:void 0,penaltyType:void 0,participantIds:[],notes:void 0}};if(k&&E.push({payload:{drawId:d,matchUpId:l,schedule:{}},method:_x,type:noe}),ea({policyActions:v,action:Ym})&&(S?.participant||!o&&U?.length)&&E.push(K),k&&j&&E.push({type:aoe}),$&&j){let{matchUpId:Y,matchUpFormat:X}=p,Z={drawId:d,matchUpId:Y,matchUpFormat:X,outcome:{scoreStringSide1:void 0,scoreStringSide2:void 0,sets:[]},winningSide:void 0};E.push({info:"set outcome and winningSide",method:_x,type:soe,payload:Z}),ea({policyActions:v,action:Vx})&&E.push({type:Vx}),ea({policyActions:v,action:"END"})&&E.push({type:"END"})}if(C&&b){let Y=HBe({specifiedPolicyDefinitions:n,inContextDrawMatchUps:y,matchUpParticipantIds:U,matchUpActionsPolicy:g,inContextMatchUp:b,policyActions:v,enforceGender:a,participantId:s,sideNumber:o,matchUpId:l,matchUp:p,drawId:d,side:S});E.push(...Y)}return{structureIsComplete:M,validActions:E,isDoubleExit:_,...W}}function YBe({tournamentParticipants:t=[],sourceStructuresComplete:e,possiblyDisablingAction:i,isWinRatioFedStructure:r,activeDrawPositions:n,positionAssignments:a,drawDefinition:s,drawPosition:o,structureId:l,structure:u,drawId:c,event:d}){if(n.includes(o)||r&&!e)return{};let{sourceStructureIds:p,targetStructureIds:f}=s.links?.reduce((I,v)=>{let w=v.source?.structureId,y=v.target?.structureId;return I.sourceStructureIds.includes(w)||I.sourceStructureIds.push(w),I.targetStructureIds.includes(y)||I.targetStructureIds.push(y),I},{sourceStructureIds:[],targetStructureIds:[]})||{},m=[],h=s.links?.filter(I=>I.target?.structureId===u.structureId)??[];for(let I of h){let v=I?.source?.structureId,{structure:w}=tt({structureId:v,drawDefinition:s}),y=w?.finishingPosition===_h&&(p?.length!==1||f?.length!==1),b={};if(y){let{matchUps:T}=At({drawDefinition:s,structure:u,event:d}),{initialRoundNumber:P}=Wm({drawPosition:o,matchUps:T}),D=s.links?.find(E=>E.target?.structureId===u?.structureId&&E.target.roundNumber===P)?.source?.roundNumber;b.roundNumbers=[D]}let{completedMatchUps:S}=iN({structureId:v,inContext:!0,matchUpFilters:b,drawDefinition:s}),U=a.map(T=>T.participantId).filter(Boolean);S?.filter(({matchUpType:T,winningSide:P})=>P&&(d?.eventType!==ar||T===ar)).map(({winningSide:T,sides:P})=>T&&P?.[1-(T-1)]).map(yt).filter(T=>T&&!U.includes(T))?.forEach(T=>{m.includes(T)||m.push(T)})}let g=t?.filter(I=>m?.includes(I.participantId));return g?.forEach(I=>{let v=(s.entries??[]).find(w=>w.participantId===I.participantId);I.entryPosition=v?.entryPosition}),m?.length?{validLuckyLosersAction:{type:sV,method:B$e,availableLuckyLosers:g,availableLuckyLoserParticipantIds:m,willDisableLinks:i,payload:{drawId:c,structureId:l,drawPosition:o}}}:{}}function KBe({positionSourceStructureIds:t,unassignedParticipantIds:e,possiblyDisablingAction:i,provisionalPositioning:r,tournamentParticipants:n,isWinRatioFedStructure:a,positionAssignments:s,returnParticipants:o,appliedPolicies:l,drawDefinition:u,seedingProfile:c,isByePosition:d,drawPosition:p,structureId:f,event:m}){let{drawId:h}=u,g=[],I,v,w=[],y=l?.[Rs]?.validSeedPositions?.ignore;if(y||({unplacedSeedParticipantIds:I,unplacedSeedAssignments:v,unfilledPositions:w}=Gae({provisionalPositioning:r,returnAllProxies:!0,randomize:!0,drawDefinition:u,seedingProfile:c,structureId:f})),w?.length||(w=s.filter(b=>!b.participantId&&!b.bye&&!b.qualifier).map(b=>b.drawPosition)),d||g.push({payload:{drawId:h,structureId:f,drawPosition:p,isPositionAction:!0},willDisableLinks:i,method:W$e,type:"BYE"}),a&&y){let b=s.map(D=>D.participantId).filter(Boolean),S={structureIds:t},{completedMatchUps:U}=Hv({inContext:!0,matchUpFilters:S,drawDefinition:u}),T=nt((U??[]).filter(({matchUpType:D})=>m?.eventType!==ar||D===ar)?.map(({sides:D})=>D?.map(yt)).flat().filter(D=>D&&!b.includes(D))),P=o?n?.filter(D=>T?.includes(D.participantId)).map(D=>Oe(D,void 0,!0)):void 0;return P?.forEach(D=>{let E=(u.entries??[]).find(R=>R.participantId===D.participantId);D.entryPosition=E?.entryPosition}),P?.length&&g.push(je({payload:{drawId:h,structureId:f,drawPosition:p},willDisableLinks:i,method:gq,type:qm,availableParticipantIds:T,participantsAvailable:P})),{validAssignmentActions:g}}if(w.includes(p)||d){let b;if(v?.length){let U=v.filter(T=>I?.includes(T.participantId));U.sort(XBe),b=U.map(T=>T.participantId)}else b=e;let S=o?n?.filter(U=>b.includes(U.participantId)).map(U=>Oe(U,void 0,!0)):void 0;S?.length&&g.push(je({payload:{drawId:h,structureId:f,drawPosition:p},willDisableLinks:i,method:gq,type:qm,availableParticipantIds:b,participantsAvailable:S}))}return{validAssignmentActions:g}}function XBe(t,e){return t.bye||kI(t.seedValue)<kI(e.seedValue)||t.seedValue&&!e.seedValue?-1:(t.seedNumber||0)-(e.seedNumber||0)}function JBe({drawPositionInitialRounds:t,tournamentParticipants:e,positionAssignments:i,returnParticipants:r,appliedPolicies:n,drawDefinition:a,drawPosition:s,structureId:o,drawId:l}){let u=[],c=[],d=[],p=[],f=new Set(i.map(b=>b.participantId).filter(Boolean)),m=n?.[yu],h=!m?.disableRoundRestrictions&&t[s],g=m?.requireCompletedStructures,{sourceStructureIds:I,relevantLinks:v}=nw({targetRoundNumber:h,linkType:mu,drawDefinition:a,structureId:o})||{};I?.length&&p.push(...I);let{sourceStructureIds:w,relevantLinks:y}=nw({targetRoundNumber:h,linkType:fu,drawDefinition:a,structureId:o})||{};w?.length&&p.push(...w);for(let b of v){let S=a.structures?.find(T=>T.structureId===b.source.structureId);if(S?.stage!==ze)continue;let U=Su({structureId:b.source.structureId,drawDefinition:a});if(!g||U){let T=S.qualifyingRoundNumber,{matchUps:P}=At({matchUpFilters:{roundNumbers:[T],isCollectionMatchUp:!1,hasWinningSide:!0},afterRecoveryTimes:!1,tournamentParticipants:e,inContext:!0,structure:S});for(let D of P){let E=D.sides.find(C=>C?.sideNumber===D.winningSide),R=D.matchUpStatus==="BYE"&&D.sides?.find(({participantId:C})=>C);if(E||R){let{participantId:C,participant:M}=E||R||{};C&&!f.has(C)&&(M&&r&&u.push(M),c.push(C))}}}}for(let b of y){let S=a.structures?.find(T=>T.structureId===b.source.structureId);if(S?.stage!==ze)continue;let U=Su({structureId:b.source.structureId,drawDefinition:a});if(!g||U){let{positionAssignments:T}=Kt({structure:S}),P=T?.map(D=>{let E=D.participantId,R=ht({element:D,name:Dc}).extension?.value;return R?{participantId:E,groupOrder:R?.groupOrder}:{}}).filter(({groupOrder:D,participantId:E})=>D===1&&!f.has(E)).map(({participantId:D})=>D)??[];if(P&&c.push(...P),r){let D=e.filter(({participantId:E})=>P.includes(E));u.push(...D)}}}return c.length&&d.push(je({qualifyingParticipants:r?u:void 0,method:L$e,type:uN,qualifyingParticipantIds:c,payload:{qualifyingParticipantId:void 0,drawPosition:s,structureId:o,drawId:l}})),{validAssignmentActions:d,sourceStructureIds:p}}function QBe({onlyAssignedPositions:t=!0,possiblyDisablingAction:e,tournamentParticipants:i,inactiveDrawPositions:r,activeDrawPositions:n,positionAssignments:a,returnParticipants:s,byeDrawPositions:o,drawDefinition:l,isByePosition:u,drawPosition:c,structureId:d,structure:p,drawId:f,event:m}){if(n.includes(c))return{};let h=D=>!t||D.participantId||D.qualifier||D.bye,g=r?.filter(D=>D!==c&&!(u&&o.includes(D))),I=a?.filter(D=>h(D)&&g?.includes(D.drawPosition))??[],v=I.map(({drawPosition:D})=>D),{matchUps:w}=At({afterRecoveryTimes:!1,inContext:!0,drawDefinition:l,structure:p,event:m}),y=w.filter(({drawPositions:D})=>xn(D,v)),b=Object.assign({},...y.map(D=>D.sides?.filter(({sourceDrawPositionRange:E})=>E).map(({drawPosition:E,sourceDrawPositionRange:R})=>({[E]:R}))).flat()),S=I.map(D=>D.participantId).filter(Boolean),U=(i??[]).filter(D=>S.includes(D.participantId)),T=Object.assign({},...U.map(D=>({[D.participantId]:D}))),P=I.map(D=>{let E=T?.[D.participantId],R=b[D.drawPosition];return je({...D,participant:s?Oe(E,!1,!0):void 0,sourceDrawPositionRange:R})});return P.length?{validSwapAction:{payload:{drawId:f,structureId:d,drawPositions:[c]},willDisableLinks:e,method:gse,type:cN,availableAssignments:P}}:{}}function ZBe(t,e){return t.filter(i=>!e.includes(i.participantId)).map(i=>i.participantId)}function e2e({validActions:t,policyActions:e,isActiveDrawPosition:i,positionAssignments:r,disablePlacementActions:n,positionAssignment:a,isByePosition:s,getValidAssignmentActions:o,positionSourceStructureIds:l,unassignedParticipantIds:u,possiblyDisablingAction:c,isWinRatioFedStructure:d,tournamentParticipants:p,returnParticipants:f,appliedPolicies:m,drawDefinition:h,drawPosition:g,structureId:I,event:v}){if(ea({policyActions:e,action:qm})&&!i&&r&&!n&&(!a||s)){let{validAssignmentActions:w}=o({positionSourceStructureIds:l,unassignedParticipantIds:u,possiblyDisablingAction:c,isWinRatioFedStructure:d,tournamentParticipants:p,positionAssignments:r,returnParticipants:f,appliedPolicies:m,drawDefinition:h,isByePosition:s,drawPosition:g,structureId:I,event:v});w?.forEach(y=>t.push(y))}}function t2e({validActions:t,policyActions:e,isActiveDrawPosition:i,getValidQualifiersAction:r,drawPositionInitialRounds:n,tournamentParticipants:a,positionAssignments:s,returnParticipants:o,appliedPolicies:l,drawDefinition:u,drawPosition:c,structureId:d,drawId:p}){if(ea({policyActions:e,action:uN})&&!i){let{validAssignmentActions:f}=r({drawPositionInitialRounds:n,tournamentParticipants:a,positionAssignments:s,returnParticipants:o,appliedPolicies:l,drawDefinition:u,drawPosition:c,structureId:d,drawId:p});f?.forEach(m=>t.push(m))}}function i2e({validActions:t,policyActions:e,isActiveDrawPosition:i,drawId:r,structureId:n,drawPosition:a,possiblyDisablingAction:s,isByePosition:o}){ea({policyActions:e,action:Ox})&&!i&&(t.push({type:Ox,method:hq,payload:{drawId:r,structureId:n,drawPosition:a},willDisableLinks:s}),o||t.push({type:aV,method:_$e,payload:{drawId:r,structureId:n,drawPosition:a},willDisableLinks:s}),ea({policyActions:e,action:"BYE"})&&!o&&t.push({type:"BYE",method:hq,payload:{drawId:r,structureId:n,drawPosition:a,replaceWithBye:!0},willDisableLinks:s}))}function r2e({validActions:t,policyActions:e,activePositionsCheck:i,activePositionOverrides:r,activeDrawPositions:n,drawDefinition:a,structureId:s,drawPosition:o,structure:l,isByePosition:u,participantId:c,participant:d,drawId:p}){let f=l.stage===ze||l.stage===Ae&&l.stageSequence===1;if(!u&&i({activePositionOverrides:r,activeDrawPositions:n,action:Im})&&ea({policyActions:e,action:Im})&&ZP({drawDefinition:a,structureId:s,drawPosition:o})&&f){let{seedAssignments:m}=hs({returnAllProxies:!0,drawDefinition:a,structure:l}),{seedNumber:h,seedValue:g}=m?.find(I=>I.participantId===c)??{};t.push({type:Im,method:z$e,participant:d,seedNumber:h,payload:{drawId:p,structureId:s,participantId:c,seedValue:g}})}if(!u&&i({activePositionOverrides:r,activeDrawPositions:n,action:Qy})&&ea({policyActions:e,action:Qy})&&ZP({drawDefinition:a,structureId:s,drawPosition:o})&&f){let{seedAssignments:m}=hs({returnAllProxies:!0,drawDefinition:a,structure:l}),{seedNumber:h}=m?.find(g=>g.participantId===c)??{};t.push({method:H$e,type:Qy,participant:d,seedNumber:h,payload:{participantId:c,structureId:s,drawId:p}})}}function n2e({validActions:t,policyActions:e,isByePosition:i,participantId:r,participant:n,drawId:a}){if(!i&&r){if(ea({policyActions:e,action:Ym})){let s={type:Ym,method:Ise,participant:n,payload:{penaltyCode:void 0,penaltyType:void 0,participantIds:[],notes:void 0,drawId:a}};t.push(s)}if(ea({policyActions:e,action:aw})){let s={type:aw,method:G$e,participant:n,payload:{participantId:r,otherName:void 0}};t.push(s)}}}function a2e({validActions:t,policyActions:e,getValidSwapAction:i,possiblyDisablingAction:r,tournamentParticipants:n,inactiveDrawPositions:a,activeDrawPositions:s,positionAssignments:o,returnParticipants:l,byeDrawPositions:u,drawDefinition:c,isByePosition:d,drawPosition:p,structureId:f,structure:m,drawId:h}){if(ea({policyActions:e,action:cN})){let{validSwapAction:g}=i({possiblyDisablingAction:r,tournamentParticipants:n,inactiveDrawPositions:a,activeDrawPositions:s,positionAssignments:o,returnParticipants:l,byeDrawPositions:u,drawDefinition:c,isByePosition:d,drawPosition:p,structureId:f,structure:m,drawId:h});g&&t.push(g)}}function s2e({validActions:t,policyActions:e,getValidAlternatesAction:i,possiblyDisablingAction:r,tournamentParticipants:n,positionAssignments:a,activeDrawPositions:s,returnParticipants:o,appliedPolicies:l,drawDefinition:u,drawPosition:c,structureId:d,structure:p,drawId:f,event:m,disablePlacementActions:h}){if(ea({policyActions:e,action:nV})&&!h){let{validAlternatesAction:g}=i({possiblyDisablingAction:r,tournamentParticipants:n,positionAssignments:a,activeDrawPositions:s,returnParticipants:o,appliedPolicies:l,drawDefinition:u,drawPosition:c,validActions:t,structureId:d,structure:p,drawId:f,event:m});g&&t.push(g)}}function o2e({validActions:t,policyActions:e,getValidLuckyLosersAction:i,sourceStructuresComplete:r,possiblyDisablingAction:n,isWinRatioFedStructure:a,tournamentParticipants:s,activeDrawPositions:o,positionAssignments:l,drawDefinition:u,drawPosition:c,structureId:d,structure:p,drawId:f,disablePlacementActions:m,isActiveDrawPosition:h}){if(ea({policyActions:e,action:sV})&&!m&&!h&&l){let{validLuckyLosersAction:g}=i({sourceStructuresComplete:r,possiblyDisablingAction:n,isWinRatioFedStructure:a,tournamentParticipants:s,activeDrawPositions:o,positionAssignments:l,drawDefinition:u,drawPosition:c,structureId:d,structure:p,drawId:f});g&&t.push(g)}}function l2e({validActions:t,policyActions:e,getValidModifyAssignedPairAction:i,participant:r,tournamentParticipants:n,returnParticipants:a,drawPosition:s,drawId:o,event:l}){if(r?.participantType===ft&&ea({policyActions:e,action:rV})){let{validModifyAssignedPairAction:u}=i({tournamentParticipants:n,returnParticipants:a,drawPosition:s,participant:r,drawId:o,event:l});u&&t.push(u)}}function UV(t){return u2e(t)}function u2e(t){let e=He(t,[{event:!0,drawDefinition:!0,structureId:!0}]);if(e.error)return e;let{policyDefinitions:i,returnParticipants:r=!0,provisionalPositioning:n,tournamentRecord:a,drawDefinition:s,drawPosition:o,event:l}=t,u=t.tournamentParticipants??(a&&Ri({withIndividualParticipants:!0,tournamentRecord:a}).participants)??[],c=tt({structureId:t.structureId,drawDefinition:s});if(c.error)return c;let d=c.containingStructure||c.structure;if(!d)return{error:vi};let p=d.structureId;if(c=Wv({drawDefinition:s,structureId:p}),o===void 0&&!c.isAdHoc)return{error:Mv};if(c.isAdHoc)return vN(t);if(c.error)return c;let{drawPositionInitialRounds:f,inactiveDrawPositions:m,activeDrawPositions:h,byeDrawPositions:g}=c,I=Dt({tournamentRecord:a,drawDefinition:s,structure:d,event:l}).appliedPolicies??{};Object.assign(I,i??{});let{actionsPolicy:v,enabledStructures:w,actionsDisabled:y}=Qse({actionType:bD,appliedPolicies:I,drawDefinition:s,structure:d}),b=v?.activePositionOverrides||[],{sourceStructureIds:S}=nw({finishingPosition:Gp,targetRoundNumber:1,linkType:fu,drawDefinition:s,structureId:p})||{},U;S?.length&&(U=S.every(K=>Su({structureId:K,drawDefinition:s})));let T=S.length,P=S.length&&!U,{policyActions:D}=Zse({enabledStructures:w,drawDefinition:s,structure:d}),E=![ze,Ae].includes(d.stage)||d.stageSequence!==1,{drawId:R}=s,C=[],{assignedPositions:M,positionAssignments:N}=pr({structure:d}),A=M?.find(K=>K.drawPosition===o),O=!!A;if(!N?.map(K=>K.drawPosition)?.includes(o))return{error:Mh};let{stage:k,stageSequence:F}=d,x=[k];k===tn&&x.push(Ae),k===Ae&&x.push(tn);let L=Vh({entryStatuses:Uf,provisionalPositioning:n,drawDefinition:s,stageSequence:F,structureId:p,stages:x}),$=Pf({drawDefinition:s,stages:x}).assignedParticipantIds??[],V=ZBe(L,$),_=g.includes(o),B=h.includes(o);if(y)return{info:"Actions Disabled for structure",isActiveDrawPosition:B,isDrawPosition:!0,hasPositionAssigned:O,validActions:[],isByePosition:_};e2e({validActions:C,policyActions:D,isActiveDrawPosition:B,positionAssignments:N,disablePlacementActions:P,positionAssignment:A,isByePosition:_,getValidAssignmentActions:KBe,positionSourceStructureIds:S,unassignedParticipantIds:V,possiblyDisablingAction:E,isWinRatioFedStructure:T,tournamentParticipants:u,returnParticipants:r,appliedPolicies:I,drawDefinition:s,drawPosition:o,structureId:p,event:l}),t2e({validActions:C,policyActions:D,isActiveDrawPosition:B,getValidQualifiersAction:JBe,drawPositionInitialRounds:f,tournamentParticipants:u,positionAssignments:N,returnParticipants:r,appliedPolicies:I,drawDefinition:s,drawPosition:o,structureId:p,drawId:R});let{participantId:G}=A||{},j=G&&u.find(K=>K.participantId===G);return A&&(i2e({validActions:C,policyActions:D,isActiveDrawPosition:B,drawId:R,structureId:p,drawPosition:o,possiblyDisablingAction:E,isByePosition:_}),r2e({validActions:C,policyActions:D,activePositionsCheck:BBe,activePositionOverrides:b,activeDrawPositions:h,drawDefinition:s,structureId:p,drawPosition:o,structure:d,isByePosition:_,participantId:G,participant:j,drawId:R}),n2e({validActions:C,policyActions:D,isByePosition:_,participantId:G,participant:j,drawId:R}),a2e({validActions:C,policyActions:D,getValidSwapAction:QBe,possiblyDisablingAction:E,tournamentParticipants:u,inactiveDrawPositions:m,activeDrawPositions:h,positionAssignments:N,returnParticipants:r,byeDrawPositions:g,drawDefinition:s,isByePosition:_,drawPosition:o,structureId:p,structure:d,drawId:R})),s2e({validActions:C,policyActions:D,getValidAlternatesAction:WBe,possiblyDisablingAction:E,tournamentParticipants:u,positionAssignments:N,activeDrawPositions:h,returnParticipants:r,appliedPolicies:I,drawDefinition:s,drawPosition:o,structureId:p,structure:d,drawId:R,event:l,disablePlacementActions:P}),o2e({validActions:C,policyActions:D,getValidLuckyLosersAction:YBe,sourceStructuresComplete:U,possiblyDisablingAction:E,isWinRatioFedStructure:T,tournamentParticipants:u,activeDrawPositions:h,positionAssignments:N,drawDefinition:s,drawPosition:o,structureId:p,structure:d,drawId:R,disablePlacementActions:P,isActiveDrawPosition:B}),l2e({validActions:C,policyActions:D,getValidModifyAssignedPairAction:$Be,participant:j,tournamentParticipants:u,returnParticipants:r,drawPosition:o,drawId:R,event:l}),{isActiveDrawPosition:B,isDrawPosition:!0,hasPositionAssigned:O,isByePosition:_,validActions:C,...W}}function XU({policyDefinitions:t,appliedPolicies:e,drawType:i}){let r=t?.[jP]?.drawTypeCoercion,n=e?.[jP]?.drawTypeCoercion;return(typeof r=="boolean"?r:void 0)??(i&&r?.[i])??(typeof n=="boolean"?n:void 0)??(i&&n?.[i])??!0}var TV=({drawDefinition:t})=>{let e=He({drawDefinition:t},[{[In]:!0}]);if(e.error)return e;let i=t.structures?.find(n=>n.stage===Ae&&n.stageSequence===1);if(!i)return q({result:{error:tB}});let{qualifierPositions:r}=pr({structure:i});return Ce(0,r.length).sort(()=>Math.random()-.5)};function DV({structureId:t,drawDefinition:e}){if(!e)return{error:$e};if(!ni(t))return{error:re};let i=Gv({drawDefinition:e,structureId:t});if(i.error)return i;let r=i.links.target.flatMap(a=>a.target.feedProfile).filter(Boolean),n=!Li([jp,As,CM,Vp],r).length;return{...W,valid:n}}function loe({participantsCount:t,participantCount:e}){if(t=t??e,!t)return{error:re};let i=Cv(t);return i?{drawSize:i}:q({result:{error:re},stack:"getEliminationDrawSize",context:{participantsCount:t}})}function JU(t){let{drawSizeProgression:e=!1,policyDefinitions:i,drawSize:r}=t||{},{requireParticipantCount:n=!0,tournamentRecord:a,drawDefinition:s,event:o}=t||{},l="getSeedsCount",u=t?.participantsCount??t?.participantCount;if(!i){let m=Gc({tournamentRecord:a,drawDefinition:s,event:o});if(m.error)return q({result:m,stack:l});i=m.policyDefinitions}let c=lt(u);if(u&&!c)return q({result:{error:re},context:{participantsCount:u},stack:l});if(n&&!c)return q({result:{error:aie},stack:l});if(Number.isNaN(Number(r)))if(u)({drawSize:r}=loe({participantsCount:u}));else return q({result:{error:QS},stack:l});let d=n&&u||r;if(d&&d>r)return{error:oB};let p=i?.[Rs];if(!p)return{error:Hte};let f=p.seedsCountThresholds;return f?(p.drawSizeProgression!==void 0&&(e=p.drawSizeProgression),{seedsCount:f.filter(m=>e?m.drawSize<=r:r===m.drawSize).reduce((m,h)=>u&&u>=h.minimumParticipantCount?h.seedsCount:m,0)}):{error:Pte}}function yN({consideredEntries:t,policyDefinitions:e,tournamentRecord:i,appliedPolicies:r,participantMap:n,enforceGender:a,participants:s,event:o}){if((!s||!n)&&i&&({participants:s,participantMap:n}=Ri({tournamentRecord:i})),!s)return{error:tU};if(!Array.isArray(s))return{error:re};if(!o)return{error:ui};let l=e?.[Mr]??r?.[Mr]??qv[Mr],u=(a??l?.participants?.enforceGender)!==!1,{eventType:c,gender:d}=o,p=c===wc,f=c===Ua&&_t||p&&ft||It,m=Object.assign({},...(t??o.entries??[]).map(I=>({[I.participantId]:I.entryStatus}))),h=Object.keys(m),g=s.filter(I=>h.includes(I.participantId)).filter(I=>{let v=c2e({participant:I,participantType:f,eventType:c,entryStatusMap:m}),w=d2e({genderEnforced:u,participantMap:n,eventGender:d,participant:I,isDoubles:p,mismatch:v});return v||!w});if(g.length){let I=g.map(v=>v.participantId);return{error:xte,invalidParticipantIds:I}}return{...W,valid:!0}}function c2e({participant:t,participantType:e,eventType:i,entryStatusMap:r}){let n=r[t.participantId],a=i&&[wc,Ua].includes(i)&&t.participantType===It&&(pp(n)||n===bu);return t.participantType!==e&&!a}function d2e(t){let{participant:e,participantMap:i,eventGender:r,mismatch:n,isDoubles:a,genderEnforced:s}=t,o=!n&&a&&nt(e?.individualParticipantIds?.map(d=>i?.[d]?.participant?.person?.sex).filter(Boolean)??[])||[],l=!r||!o?.length||du(r)||cl(r)&&ln(o[0])===ln(r)||Aa(r)&&(o.length===1&&e.individualParticipantIds?.length===1||o.length===2),u=e?.person?.sex,c=!e?.person||!r||Aa(r)||du(r)||cl(r)&&ln(u)===ln(r);return!s||l&&c}function uoe({hasExistingDrawDefinition:t,qualifyingProfiles:e,appliedPolicies:i,qualifyingOnly:r,tieFormat:n,idPrefix:a,isMock:s,uuids:o}){let l="generateQualifyingSTructures",u=[],c=[],d=[],p=(v,w)=>v.stageSequence-w.stageSequence,f=(v,w)=>v.roundTarget-w.roundTarget,m=0,h=0,g,I=1;for(let v of e.sort(f)){let w=v.structureProfiles||[];I=v.roundTarget||I;let y=1,b=0,S,U,T;for(let P of(w||[]).sort(p)){let D=q$(P.drawSize||P.participantsCount),{qualifyingRoundNumber:E,structureOptions:R,matchUpFormat:C,structureName:M,structureId:N,drawType:A}=P,O=P.matchUpType,k=P.qualifyingPositions||p2e({drawSize:D,qualifyingRoundNumber:E}),F,x,L;if(!lt(D))return q({result:{error:QS},stack:l});let $=e.length>1?`${I}-`:"",V=w.length>1||$?y:"",_=M||($||V?`${Qr(ze)} ${$}${V}`:Qr(ze));if(A===eo){let{structures:B,groupCount:G,maxRoundNumber:j}=LU({structureName:P.structureName||_,structureId:N||o?.pop(),hasExistingDrawDefinition:t,stage:ze,structureOptions:R,appliedPolicies:i,qualifyingOnly:r,stageSequence:y,matchUpType:O,roundTarget:I,tieFormat:n,drawSize:D,idPrefix:a,isMock:s,uuids:o});b=G,F=j,x=B[0],g=[1]}else({drawSize:D,matchUps:L,roundLimit:F}=gl({qualifyingRoundNumber:E,qualifyingPositions:k,matchUpType:O,drawSize:D,idPrefix:a,isMock:s,uuids:o})),x=ss({structureName:P.structureName||_,structureId:N||o?.pop(),qualifyingRoundNumber:F,hasExistingDrawDefinition:t,stage:ze,qualifyingOnly:r,matchUpFormat:C,stageSequence:y,matchUpType:O,roundLimit:F,tieFormat:n,matchUps:L}),I&&Ft({extension:{name:El,value:I},element:x}),b=L?.filter(B=>B.roundNumber===F)?.length||0;if(y>1){let{link:B}=VU({sourceStructureId:U,sourceRoundNumber:S,targetStructureId:x.structureId,finishingPositions:T===fu?[1]:void 0,linkType:T});d.push(B),m+=(D||0)-b}else m+=D||0;T=A===eo?fu:mu,U=x.structureId,S=F,n&&(L=At({structure:x})?.matchUps||[],L?.forEach(B=>{let{tieMatchUps:G}=Qh({tieFormat:n,matchUp:B,isMock:s});Object.assign(B,{tieMatchUps:G,matchUpType:O})})),c.push(x),y+=1}h+=b,u.push({qualifiersCount:b,finalQualifyingRoundNumber:S,finalQualifyingStructureId:U,finishingPositions:g,roundTarget:I,linkType:T}),I+=1}return{qualifiersCount:h,qualifyingDrawPositionsCount:m,qualifyingDetails:u,structures:c,...W,links:d}}function p2e({drawSize:t,qualifyingRoundNumber:e}){let i=t,r=0;for(;r<e;)i=Math.floor(i/2),r+=1;return i}function coe(t){let{drawTypeCoercion:e,enforceMinimumDrawSize:i}=t,r=Ke(t.drawSize),n=e&&t.drawType!==ua&&(typeof e=="boolean"||e<=2)&&r===2&&Jo||t.drawType||Jo,a=Hre.includes(n);if(r&&a){if(e&&(typeof e=="boolean"&&r<4||r<=e))n=Jo;else if(r<4&&i)return{...q({context:{enforceMinimumDrawSize:i,drawSize:r,drawType:n},result:{error:lM},stack:"getCoercedDrawType"}),drawType:n}}return{drawType:n}}function f2e(t){let{drawDefinition:e,structureOptions:i,requireSequential:r}=t,n={structureName:Qr(Ae),...t,stage:Ae},{structures:a,groupCount:s}=LU(n);if(s<1)return{error:Uie};let o=i?.playoffGroups||[{finishingPositions:[1],structureName:Qr(Ti)}],[l]=a,{structures:u,links:c}=Rse({sourceStructureId:l.structureId,requireSequential:r,drawDefinition:e,playoffGroups:o,groupCount:s,...t});return u&&a.push(...u),{...W,structures:a,links:c}}function m2e({mainStructure:t,consolationStructure:e,deciderStructure:i}){let r=e.matchUps.reduce((u,c)=>(c.drawPositions||[]).filter(Boolean).length&&!u.includes(c.roundNumber)?u.concat(c.roundNumber):u,[]),n=t.matchUps.reduce((u,c)=>!u||c.roundNumber>u?c.roundNumber:u,void 0),a=e.matchUps.reduce((u,c)=>!u||c.roundNumber>u?c.roundNumber:u,void 0),s=r.map((u,c)=>{let d=r.indexOf(u)%2?As:jp,p=1+c;return{linkType:hu,source:{roundNumber:p,structureId:t.structureId},target:{feedProfile:d,roundNumber:u,structureId:e.structureId}}}),o={linkType:mu,source:{roundNumber:a,structureId:e.structureId},target:{feedProfile:As,roundNumber:n,structureId:t.structureId}},l=[{linkType:mu,source:{roundNumber:n,structureId:t.structureId},target:{feedProfile:As,roundNumber:1,structureId:i.structureId}},{linkType:hu,source:{roundNumber:n,structureId:t.structureId},target:{feedProfile:As,roundNumber:1,structureId:i.structureId}}];return[...s,o,...l]}function h2e({structureName:t,matchUpType:e,idPrefix:i,drawSize:r,isMock:n,uuids:a}){let s=[],{matchUps:o}=Rd({linkFedFinishingRoundNumbers:[1],drawSize:r+1,matchUpType:e,idPrefix:i,isMock:n}),l=dd({structureName:t||Qr(Ae),structureId:a?.pop(),stageSequence:1,stage:Ae,matchUpType:e,matchUps:o});s.push(l);let u=r/2,{matchUps:c}=Rd({finishingPositionOffset:u,idPrefix:i&&`${i}-c`,drawSize:r-1,isConsolation:!0,matchUpType:e,isMock:n,uuids:a}),d=dd({structureName:Qr(Gre),matchUps:c,structureId:a?.pop(),stage:tn,stageSequence:2,matchUpType:e});s.push(d);let{matchUps:p}=gl({idPrefix:i&&`${i}-p1t2`,drawSize:2,matchUpType:e,isMock:n}),f=dd({structureName:Qr(jre),matchUps:p,structureId:a?.pop(),stageSequence:3,stage:Ti,matchUpType:e});s.push(f);let m=m2e({mainStructure:l,consolationStructure:d,deciderStructure:f});return{structures:s,links:m,...W}}function g2e(t){let{qualifyingRoundNumber:e,finishingPositionOffset:i,qualifyingPositions:r,matchUpType:n,idPrefix:a,drawSize:s,isMock:o,uuids:l}=t;if(!lt(s)||s<2)return{matchUps:[],roundsCount:0};if(Ro(s))return gl(t);let u=I2e(s),c=u.shift(),d=Ce(1,(c?.participantsCount||0)+1).map(g=>({drawPosition:g})),p=[],f=1;({matchUps:p}=tE({roundNumber:f,matchUpType:n,idPrefix:a,matchUps:p,isMock:o,nodes:d,uuids:l})),f++;let m=t.roundLimit||e;for(let g of u){let I=g.participantsCount/2,v=Ce(1,I+1);r&&I===r&&(m=f-1);let w=v.map(y=>{let b=oV({roundPosition:y,roundNumber:f,idPrefix:a,uuids:l});return{roundPosition:y,roundNumber:f,matchUpId:b}});p.push(...w),f++}let h=f-1;return p=MU({finishingPositionOffset:i,lucky:!0,roundsCount:h,roundLimit:m,matchUps:p}),m&&(p=p.filter(g=>g.roundNumber<=m)),{matchUps:p,roundsCount:h,roundLimit:m}}function I2e(t){let e=Ke(t),i=e%2?e+1:e,r=!!(Math.ceil(i/2)%2),n=[{participantsCount:i,preFeedRound:r}];for(;i>2;){let a=Math.ceil(i/2),s=a===1,o=!!(!s&&a%2);i=!s&&o?a+1:a;let l=!!(i!==2&&Math.ceil(i/2)%2);n.push({participantsCount:i,preFeedRound:l,feedRound:o})}return n}function doe(t){let{playoffAttributes:e,stageSequence:i=1,stage:r=Ae,tieFormat:n,matchUpType:a,drawSize:s,uuids:o}=t,l=()=>!t.isMock&&!t.idPrefix?void 0:`${t.drawDefinition.drawId}-s-0`,u=t.structureId||l()||o?.pop(),c=t.appliedPolicies??Dt(t),d=t.policyDefinitions?.[CI]||c?.[CI];t.skipRounds=t.skipRounds||s<=4&&(d?.feedFromMainFinal?0:1)||0;let p=t.structureName??e?.["0"]?.name??Qr(Ae),f=()=>{let{matchUps:m}=gl(t);return{structures:[ss({stageSequence:i,structureName:p,matchUpType:a,structureId:u,tieFormat:n,matchUps:m,stage:r})],links:[],...W}};return{generators:{[ua]:()=>({structures:[ss({finishingPosition:Gp,stageSequence:i,structureName:p,matchUps:[],matchUpType:a,structureId:u,stage:r})],links:[],...W}),[vf]:()=>{let{matchUps:m}=g2e(t);return{structures:[ss({stageSequence:i,structureName:p,matchUpType:a,structureId:u,matchUps:m,stage:r})],links:[],...W}},[Jo]:()=>f(),[lU]:()=>h2e(t),[DI]:()=>Hg({...t,roundOffsetLimit:3,playoffAttributes:e??xB}),[PI]:()=>Hg({...t,roundOffsetLimit:2,playoffAttributes:e??FB}),[Ti]:()=>Hg(t),[Fv]:()=>{let{matchUps:m}=Rd({drawSize:s,uuids:o,matchUpType:a});return{structures:[ss({stageSequence:i,structureName:p,matchUpType:a,structureId:u,stage:Ae,tieFormat:n,matchUps:m})],links:[],...W}},[uU]:()=>Dse(t),[EI]:()=>$f({...t,feedRounds:1,fmlc:!0}),[Vre]:()=>$f({...t,feedRounds:1}),[AB]:()=>$f({...t,feedsFromFinal:1}),[kB]:()=>$f({...t,feedsFromFinal:2}),[OB]:()=>$f({...t,feedsFromFinal:3}),[cU]:()=>$f(t),[MM]:()=>Ese(t),[eo]:()=>LU(t),[gu]:()=>f2e(t)}}}function PV(t){let{enforceMinimumDrawSize:e=!0,overwriteExisting:i,appliedPolicies:r,qualifyingOnly:n,staggeredEntry:a,drawDefinition:s,tieFormat:o,isMock:l,uuids:u}=t||{},c=Ke(t.drawSize),d=t.drawTypeCoercion??XU({appliedPolicies:r,drawType:t.drawType}),p="generateDrawStructuresAndLinks",f=coe({drawType:t.drawType,enforceMinimumDrawSize:e,drawTypeCoercion:d,drawSize:c});if(f.error)return f;let m=f.drawType,h=[],g=[],I=t?.matchUpType??zt,v=s?.structures?.filter(({stage:V})=>V===ze);v&&h.push(...v);let w=v?.map(({structureId:V})=>V),y=s?.structures?.find(({stage:V,stageSequence:_})=>V===Ae&&_===1),b=s?.links?.filter(V=>V.target.structureId===y?.structureId&&w?.includes(V.source.structureId)),S=(V,_)=>{if(V.linkType===fu&&_?.structures){let B=V.source.finishingPositions||[];return _.structures.length*B.length}else if(V.linkType===mu&&_?.matchUps?.length){let B=V.source.roundNumber;return _.matchUps.filter(({roundNumber:G})=>G===B).length}},U=v?.map(V=>{let _=b?.find(Y=>Y.target.structureId===V.structureId),B=Kt({structure:V})?.positionAssignments?.length??0;if(!_)return B;let G=_?.source.structureId,j=s.structures?.find(Y=>Y.structureId===G),K=S(_,j)||0;return B-K}).filter(Boolean).reduce((V,_)=>V+_,0),T=b?.map(V=>{let _=V.source.structureId,B=v?.find(G=>G.structureId===_);return S(V,B)}).filter(Boolean).reduce((V,_)=>V+_,0),P=!!(y&&!y?.matchUps?.length);if(v?.length&&!P)return{error:fx};let D=!v?.length&&t.qualifyingProfiles,E=D?.length&&uoe({idPrefix:t.idPrefix,qualifyingProfiles:D,appliedPolicies:r,qualifyingOnly:n,tieFormat:o,isMock:l,uuids:u});if(E?.error)return E;let{qualifyingDrawPositionsCount:R,qualifyingDetails:C,qualifiersCount:M}=E||{qualifyingDrawPositionsCount:U,qualifiersCount:T};R&&(E?.structures&&h.push(...E.structures),E?.links&&g.push(...E.links)),Object.assign(t,je({drawSize:c,matchUpType:I,tieFormat:o}));let N=m!==ua&&(!c||c<2||!a&&![Fv,vf].includes(m)&&([gu,eo].includes(m)&&c<3||![eo,gu].includes(m)&&!Ro(c)));if(N&&!R)return q({context:{drawSize:c,invalidDrawSize:N},result:{error:lM},stack:p});let{generators:A,error:O}=doe(t);if(O)return{error:O};let k=A[m];if(!k)return{error:J$};let F=k?.();if(F.error)return F;let{structures:x,links:L}=F;if(x?.length){let V=x.find(({stage:_,stageSequence:B})=>_===Ae&&B===1);if(y&&V){if(P){let _=V.structureId;if(V.structureId=y.structureId,L?.length)for(let B of L)B.source.structureId===_&&(B.source.structureId=y.structureId),B.target.structureId===_&&(B.target.structureId=y.structureId)}else if(!i)return{error:fx}}h.push(...x)}h.sort(Bh),L?.length&&g.push(...L);let $=F.structures.find(({stage:V,stageSequence:_})=>V===Ae&&_===1);for(let V of C||[]){let{finalQualifyingRoundNumber:_,finalQualifyingStructureId:B,roundTarget:G,finishingPositions:j,linkType:K}=V,Y=$&&VU({targetStructureId:$.structureId,sourceStructureId:B,sourceRoundNumber:_,finishingPositions:j,targetEntryRound:G,linkType:K})?.link;if(Y?.error)return Y;Y&&g.push(Y)}return b&&g.push(...b),{...W,qualifyingResult:{qualifyingDrawPositionsCount:R,qualifiersCount:M},structures:h,links:g}}function EV(t){let{modifyOriginal:e=!0,stageSequence:i=1,isMock:r}=t||{},n="generateDrawTypeAndModifyDrawDefinition";if(!t.drawDefinition)return q({result:{error:$e},stack:n});let a=e?t.drawDefinition:Oe(t.drawDefinition,!1,!0),{tieFormat:s,matchUpType:o}=t;if(s){let w=Gn({tieFormat:s});if(w.error)return w}s=Gr(s??yn({drawDefinition:a})?.tieFormat),o=o??(a.matchUpType||zt),t.tieFormat=s,t.matchUpType=o;let l=QP({drawDefinition:a,stage:Ae});t.drawSize=t.drawSize??l,!l&&t.drawSize&&eE({drawSize:t.drawSize,drawDefinition:a,stageSequence:i,stage:Ae});let u=Or({drawDefinition:a}).drawMatchUps.map(vr),c=PV(t);if(c.error)return q({result:c,stack:n});let{structures:d,links:p,qualifyingResult:f}=c;a.structures=d,a.links=p;let m=Math.max(t.qualifiersCount??0,f?.qualifiersCount||0);if(f?.qualifyingDrawPositionsCount&&!QP({stage:ze,drawDefinition:a})){let w=eE({drawSize:f.qualifyingDrawPositionsCount,stage:ze,drawDefinition:a});if(w.error)return w}if(m){let w=fse({qualifiersCount:m,drawDefinition:a,stage:Ae});if(w.error)return w}let h=t.drawSize??l;Object.assign(t,je({drawSize:h,matchUpType:o,tieFormat:s}));let{matchUps:g,matchUpsMap:I}=Zi({drawDefinition:a});s&&g?.forEach(w=>{if(!u.includes(w.matchUpId)){let{tieMatchUps:y}=Qh({tieFormat:s,matchUp:w,isMock:r});Object.assign(w,{tieMatchUps:y,matchUpType:o})}});let{inContextDrawMatchUps:v}=zp({drawDefinition:a,matchUpsMap:I});return ii({tournamentId:t.tournamentRecord?.tournamentId,drawDefinition:a}),{inContextDrawMatchUps:v,drawDefinition:a,matchUpsMap:I,...W,structures:d,matchUps:g,links:p}}function Jv(t){let{removePriorValues:e,tournamentRecord:i,participantId:r,scaleItem:n}=t,a,s;if(!foe({scaleItem:n}))return{error:$m};if(r&&Array.isArray(i.participants)&&(s=i.participants.find(o=>o.participantId===r),s)){if(s.participantType===$n&&n?.eventType!==Ua)return{error:$m};let o=moe({removePriorValues:e,participant:s,scaleItem:n});if(o.error)return o;a=!o.valueChanged;let{topics:l}=bs();l.includes(rn)&&st({topic:rn,payload:{tournamentId:i.tournamentId,participants:[s]}})}return a&&{...W,info:gB,existingValue:n?.scaleValue}||s&&{...W,newValue:n?.scaleValue}||{error:ji}}function poe(t){let{scaleItemsWithParticipantIds:e=[],removePriorValues:i,tournamentRecord:r,auditData:n,context:a}=t;if(!r)return{error:ve};if(!r.participants)return{error:tU};let s=0,o={},l=[];for(let d of e){let p=d?.participantId;if(Array.isArray(d?.scaleItems))for(let f of d.scaleItems)if(foe({scaleItem:f}))Array.isArray(o[p])||(o[p]=[]),o[p].push(f);else return{error:$m}}for(let d of r.participants){let{participantId:p}=d||{};if(Array.isArray(o[p]))for(let f of o[p]){if(d.participantType===$n&&f?.eventType!==Ua)return q({context:{participantId:p,scaleItem:f,participantType:d.participantType},info:"Invalid participantType for eventType",result:{error:$m}});moe({participant:d,scaleItem:f,removePriorValues:i}),l.push(d),s++}}let u=s?void 0:Ov,{topics:c}=bs();if(c.includes(rn)&&s&&st({topic:rn,payload:{tournamentId:r.tournamentId,participants:l}}),a){let{eventId:d,drawId:p,...f}=a,m=f.scaleAttributes?.scaleType&&[f.scaleAttributes.scaleType];if(Object.keys(f).length){let h={itemType:t2,itemValue:f};if(m&&(h.itemSubTypes=m),p||d){let{drawDefinition:g,event:I}=Wn({tournamentRecord:r,eventId:d,drawId:p});p&&iV({drawDefinition:g,timeItem:h}),d&&Zh({event:I,timeItem:h})}else zU({tournamentRecord:r,timeItem:h})}}return n&&c.includes(ec)&&st({topic:ec,payload:n}),je({...W,modificationsApplied:s,info:u})}function foe({scaleItem:t}){let e=t&&Object.keys(t),i=["scaleType","eventType","scaleName"];return i.filter(r=>e?.includes(r)).length===i.length}function moe({removePriorValues:t,participant:e,scaleItem:i}){if(!e)return{error:kh};let r=i&&Object.keys(i),n=["scaleType","eventType","scaleName"];if(n.filter(u=>r.includes(u)&&i[u]).length!==n.length)return{error:$m};let a=new Date().toISOString();e.timeItems||(e.timeItems=[]);let{scaleItem:s}=Xl({scaleAttributes:i,participant:e}),o=u=>[void 0,null,""].includes(u),l=!(o(s?.scaleValue)&&o(i.scaleValue))&&JSON.stringify(s?.scaleValue)!==JSON.stringify(i.scaleValue);if(l){let{scaleType:u,eventType:c,scaleName:d}=i,p=[Sd,u,c,d].join("."),f=je({itemValue:i.scaleValue,itemDate:i.scaleDate,createdAt:a,itemType:p});i.scaleId&&(f.itemSubTypes=[i.scaleId]),t&&(e.timeItems=e.timeItems.filter(m=>m.itemType!==p)),e.timeItems.push(f)}return{...W,valueChanged:l,newValue:i.scaleValue}}function RV(t){let{tournamentRecord:e,modifiedScaleValues:i,removePriorValues:r}=t,n=He(t,[{[hr]:!0},{modifiedScaleValues:!0,[qn]:Kn}]);if(n.error)return n;for(let a in i){let s=Jv({scaleItem:i[a],removePriorValues:r,tournamentRecord:e,participantId:a});if(s.error)return s}return{...W}}var v2e=(t=0)=>250/Math.pow(t+5,.4),y2e=()=>1;function b2e(t=3,e=2){let i=t/e;return Number.isNaN(i)?wg.kDefault():i}var wg={nSpread:400,diffThreshold:.125,kCalc:v2e,kMultiplier:b2e,kDefault:y2e};function hoe(t){let{winnerRating:e,loserRating:i}=t,{ratings:r=Pr,winnerCountables:n=1,loserCountables:a=0,ratingType:s="ELO",maxCountables:o,countables:l}=t||{},u=r?.[s];if(!u)return{error:Je};let c=u.range||t.ratingRange;e=e||u.defaultInitialization,i=i||u.defaultInitialization;let d=c[0]>c[1],p=u.decimalsCount||0,f=d?c.slice().reverse():c,m=(A,O)=>Number.parseFloat(O)>=Math.min(...A)&&Number.parseFloat(O)<=Math.max(...A);(!m(c,e)||!m(c,i))&&(m(c,e)||(e=u.defaultInitialization),m(c,i)||(i=u.defaultInitialization));let h=Og({targetRange:Pr.ELO.range,sourceRange:f,value:d?c[0]-e:e}),g=Og({targetRange:Pr.ELO.range,sourceRange:f,value:d?c[0]-i:i}),I=(A,O)=>1/(1+Math.pow(10,(O-A)/wg.nSpread)),v=I(h,g),w=I(g,h),y=wg.kCalc(n),b=wg.kCalc(a),S=wg.kMultiplier(o,l),U=h+S*y*(1-v),T=g+S*b*(0-w),P=Og({sourceRange:Pr.ELO.range,value:U,targetRange:f}),D=Og({sourceRange:Pr.ELO.range,value:T,targetRange:f}),E=d?c[0]-P:P,R=Number.parseFloat(E.toFixed(p)),C=d?c[0]-D:D,M=Number.parseFloat(C.toFixed(p)),N=Math.max(...c)?Math.abs(e-i)/Math.max(...c):0;return(P>D&&N>wg.diffThreshold||R<0||M<0)&&(R=e,M=i),{newWinnerRating:R,newLoserRating:M}}var w2e=t=>t?.reduce((e,i)=>(i.winningSide&&(e[i.winningSide-1]+=1),e),[0,0])||[0,0];function goe(t){let e=He(t,[{[hr]:!0},{matchUpIds:!0,[qn]:sn,[js]:Nh},{ratingType:!1,[qr]:v=>Pr[v]}]);if(e.error)return e;let{updateParticipantRatings:i,removePriorValues:r=!0,tournamentRecord:n,ratingType:a="ELO",refreshDynamic:s,considerGames:o,drawDefinition:l,matchUpIds:u,asDynamic:c}=t,d=Pr[a],{accessor:p}=d,f={},m=(t.matchUps||s&&An({drawDefinition:l,tournamentRecord:n,inContext:!0,matchUpFilters:{matchUpStatuses:Ki}}).matchUps||Ur({matchUpFilters:{matchUpIds:u,matchUpStatuses:Ki},tournamentRecord:n,inContext:!0}).matchUps)??[],h=`${a}.${WB}`,g=c?h:a;m.sort(zh);for(let v of m){let{endDate:w,matchUpFormat:y,score:b,sides:S,winningSide:U}=v,T=v.matchUpType,P={eventType:T,scaleName:a,scaleType:ud},D={scaleName:h,eventType:T,scaleType:ud},E=Object.assign({},...(S??[]).map(x=>{let{sideNumber:L,participant:$}=x;return L&&{[L]:[$?.participantId,...$?.individualParticipantIds??[]].filter(Boolean).flat()}})),R=Object.assign({},...Object.values(E).flat().map(x=>{let L=f[x],$=!s||L?zm({scaleAttributes:D,tournamentRecord:n,participantId:x}).scaleItem:void 0,V=zm({tournamentRecord:n,scaleAttributes:P,participantId:x}).scaleItem,_=p?{[p]:void 0}:void 0;return x&&{[x]:$??V??{scaleName:g,eventType:T,scaleDate:w,scaleType:ud,scaleValue:_}}})),C=y?qi(y):{},M=C?.bestOf||1,N=C?.setsTo||1,A=o?M&N:M,O=b?.sets&&w2e(b.sets)||U===1&&[1,0]||[0,1],k=U?E[U]:[],F=U?E[3-U]:[];for(let x of k){let L=R[x]?.scaleValue,$=typeof L=="object"?L[p]:L;for(let V of F){let _=R[V]?.scaleValue,B=typeof _=="object"?_[p]:_,G=U?O[U]:[0,0],j=U?O[3-U]:[0,0],{newWinnerRating:K,newLoserRating:Y}=hoe({winnerCountables:G,loserCountables:j,maxCountables:A,winnerRating:$,loserRating:B,ratingType:a}),X=p?{...L,[p]:K}:K,Z=p?{..._,[p]:Y}:Y;R[x].scaleValue=X,R[V].scaleValue=Z,R[x].scaleName=g,R[V].scaleName=g}}Object.assign(f,R),i&&RV({tournamentRecord:n,modifiedScaleValues:f,removePriorValues:r})}let I=m.map(({matchUpId:v})=>v);return{...W,modifiedScaleValues:f,outputScaleName:g,processedMatchUpIds:I}}function bN(t){let{matchUpIds:e=[],drawDefinition:i,roundNumber:r,newRound:n,isMock:a,event:s}=t;if(typeof i!="object")return{error:$e};let{participantIdPairings:o,matchUpsCount:l}=t,u=gN(t);if(u.error)return q({result:u});let{lastRoundNumber:c,availableMatchUpsCount:d=0,roundMatchUpsCount:p=0}=u;if(!l)n?l=p:d>0&&(l=d);else if(l>p&&t.restrictMatchUpsCount!==!1)return q({result:{error:re,info:"matchUpsCount error",context:{roundMatchUpsCount:p}}});if(o&&!Array.isArray(o)||l&&!lt(l)||e&&!Array.isArray(e)||!o&&!l)return{error:re,info:"matchUpsCount or pairings error"};if(l&&t.restrictMatchUpsCount!==!1&&l>32)return{error:re,info:"matchUpsCount must be less than 33"};if(r&&!t.ignoreLastRoundNumber&&r-1>(c||0))return{error:re,info:"roundNumber error"};let f=r??(n&&(c??0)+1||c||1);o=o??Ce(0,l).map(()=>({participantIds:[void 0,void 0]}));let m=g=>{if(!t.idPrefix)return;let I=i.drawId,v=t.idPrefix??"ah";return`${I}-${v}-${f}-${g}`},h=o?.map((g,I)=>{let v=g?.participantIds??[void 0,void 0];v.push(void 0,void 0);let w=v.slice(0,2).map((b,S)=>je({sideNumber:S+1,participantId:b})),y=e[I]??m(I)??Ct();return{roundNumber:f,matchUpStatus:_i,matchUpId:y,sides:w}});if(h?.length){let g=yn({drawDefinition:i,event:s})?.tieFormat;g&&h.forEach(I=>{let{tieMatchUps:v}=Qh({tieFormat:g,matchUp:I,isMock:a});Object.assign(I,{tieMatchUps:v,matchUpType:ei})})}return{roundNumber:f,matchUpsCount:h?.length??0,matchUps:h,...W}}function S2e({maxIterations:t=4e3,valueSortedPairings:e,pairingValues:i,valueObjects:r,deltaObjects:n}){let a=Object.assign({},...e.map(v=>({[v.pairing]:v.value}))),s=Object.keys(i),o=[],l=bq({actorsCount:s.length,valueSortedPairings:e,pairingValueMap:a,deltaObjects:n,valueObjects:r}),u=[pk(l)];o.push(l);let c=l.value,d=l,p=1,f=0,m=s.length,h;do m-=1,h=s.length*i[s[0]].length;while(h>t&&m>5);let g=[];s.forEach(v=>{i[v].slice(0,m).forEach(w=>{f+=1;let y=vm(v,w.opponent);if(!g.includes(y)){let b=bq({stipulated:[[v,w.opponent]],actorsCount:s.length,valueSortedPairings:e,pairingValueMap:a,deltaObjects:n,valueObjects:r});if(!u.includes(pk(b))){u.push(pk(b)),o.push(b);let{maxDelta:S,value:U}=b;S<d.maxDelta&&(d=b),(U<c||U===c&&Math.round(Math.random()))&&(c=U),g.push(y),p+=1}}}),o=o.filter(w=>Math.abs(w.value-c)<5)}),o.sort((v,w)=>v.maxDiff-w.maxDiff);let I=ha(o);return{candidatesCount:p,deltaCandidate:d,maxIterations:t,iterations:f,candidate:I}}function pk(t){return t.participantIdPairings.map(({participantIds:e})=>e.sort().join("|")).sort().join("/")}function bq({valueSortedPairings:t,stipulated:e=[],pairingValueMap:i,deltaObjects:r,valueObjects:n,actorsCount:a}){let s=e.flat(),o=[],l=0;e.filter(Boolean).forEach(d=>{let[p,f]=d,m=vm(p,f),h=i[m];o.push({participantIds:d,value:h}),l+=i[m]}),wr(t,a).flatMap(d=>Cn(d).map(p=>({...p,value:p.value+Math.random()*Math.round(Math.random())}))).forEach(d=>{let p=d.pairing.split("|");if(!p.reduce((f,m)=>s.includes(m)||f,!1)){s.push(...p);let f=d.value;l+=f,o.push({participantIds:p,value:f})}}),o.sort((d,p)=>d.value-p.value);let u=o.reduce((d,p)=>{let[f,m]=p.participantIds,h=vm(f,m),g=r[h];return Math.max(g,d)},0),c=o.reduce((d,p)=>{let[f,m]=p.participantIds,h=vm(f,m),g=n[h];return Math.max(g,d)},0);return{value:l,participantIdPairings:o,maxDelta:u,maxDiff:c}}function vm(t,e){return[t,e].sort(rN).join("|")}function Ioe({participantIds:t}){let e={},i=[];t.forEach(n=>{e[n]=t.filter(a=>a!==n),e[n].forEach(a=>{let s=vm(a,n);i.includes(s)||i.push(s)})});let r=Object.assign({},...i.map(n=>({[n]:0})));return{uniquePairings:i,possiblePairings:e,deltaObjects:r}}function U2e({matchUps:t}){let e=[];for(let i of t){let r=i.sides.map(yt);if(r.length===2){let[n,a]=r,s=vm(n,a);e.includes(s)||e.push(s)}}return{encounters:e}}function T2e({possiblePairings:t,valueObjects:e}){let i={};for(let n of Object.keys(t)){let a=t[n].map(s=>r(n,s));i[n]=a.sort((s,o)=>s.value-o.value)}function r(n,a){let s=vm(n,a);return{opponent:a,value:e[s]}}return{pairingValues:i}}var D2e=0;function P2e({tournamentParticipants:t,adHocRatings:e,eventType:i,scaleName:r,pairing:n}){let a=Pr[r]?.defaultInitialization??D2e;return n.split("|").map(s=>{if(i===fs){let o=t?.find(l=>l.participantId===s)?.individualParticipantIds;return o?o?.map(l=>e[l]||a):a*2}else return e[s]||a})}function E2e(t){let{tournamentParticipants:e,adHocRatings:i={},possiblePairings:r,uniquePairings:n,maxIterations:a,minimizeDelta:s,deltaObjects:o,valueObjects:l,eventType:u,scaleName:c,salted:d}=t;n.forEach(w=>{let y=P2e({tournamentParticipants:e,adHocRatings:i,scaleName:c,eventType:u,pairing:w}),b=typeof d=="number"&&d||.5,S=d&&(Math.round(Math.random())?b:b*-1)||0,U=Math.abs(y[0]-y[1])+S,T=Math.abs(y[0]-y[1]);o[w]=T,l[w]||(l[w]=0),l[w]+=U?Math.pow(U,2):0});let p=n.map(w=>({pairing:w,value:l[w]})).sort((w,y)=>w.value-y.value),{pairingValues:f}=T2e({possiblePairings:r,valueObjects:l}),{candidate:m,candidatesCount:h,deltaCandidate:g,iterations:I}=S2e({valueSortedPairings:p,maxIterations:a,pairingValues:f,deltaObjects:o,valueObjects:l}),{participantIdPairings:v}=s?g:m;return{participantIdPairings:v,candidatesCount:h,deltaCandidate:g,iterations:I,candidate:m}}var R2e=100,C2e=100,M2e=4e3;function CV(t){let{encounterValue:e=R2e,sameTeamValue:i=C2e,maxIterations:r=M2e,updateParticipantRatings:n,generateMatchUps:a=!0,ignoreLastRoundNumber:s,iterationMatchUps:o,tournamentRecord:l,dynamicRatings:u,refreshDynamic:c,participantIds:d,drawDefinition:p,roundNumber:f,structureId:m,matchUpIds:h,eventType:g,scaleName:I,idPrefix:v,isMock:w,salted:y,event:b}=t;if(!p)return{error:$e};if(!t.structure&&!m)return{error:vi};let S=t.structure||tt({drawDefinition:p,structureId:m}).structure;if(!wt(S))return{error:hf};if(!d?.length)return{error:Wd};let U=[...o??[],...S?.matchUps??[]],{encounters:T}=U2e({matchUps:U}),P=l?.participants??[],D={};if(u){let G=nt(S?.matchUps?S.matchUps.map(({roundNumber:K})=>K):[]),j=Math.max(...G,0);if(j){let K=S?.matchUps?.filter(({roundNumber:X})=>X===j).map(({matchUpId:X})=>X),Y=goe({ratingType:I??b?.category?.ratingType,updateParticipantRatings:n,tournamentRecord:l,asDynamic:!0,refreshDynamic:c,drawDefinition:p,matchUpIds:K});if(Y.error)return Y;Y.modifiedScaleValues&&(D=Y.modifiedScaleValues)}}let{valueObjects:E}=N2e({tournamentParticipants:P,encounterValue:e,sameTeamValue:i,encounters:T}),{uniquePairings:R,possiblePairings:C,deltaObjects:M}=Ioe({participantIds:d}),N=Object.values(D).length?D:t.adHocRatings,A={tournamentParticipants:P,possiblePairings:C,uniquePairings:R,maxIterations:r,adHocRatings:N,deltaObjects:M,valueObjects:E,eventType:g,scaleName:I,salted:y},{candidatesCount:O,participantIdPairings:k,deltaCandidate:F,iterations:x,candidate:L}=E2e(A);if(!O)return{error:IM};let $,V;if(a){let G=bN({structureId:S?.structureId,ignoreLastRoundNumber:s,participantIdPairings:k,newRound:!0,drawDefinition:p,roundNumber:f,matchUpIds:h,idPrefix:v,isMock:w,event:b});if(G.error)return G;$=G.roundNumber,V=G.matchUps}let{maxDelta:_,maxDiff:B}=L;return{roundNumber:$,participantIdPairings:k,modifiedScaleValues:D,candidatesCount:O,deltaCandidate:F,...W,iterations:x,matchUps:V,maxDelta:_,maxDiff:B}}function N2e({encounters:t,tournamentParticipants:e,encounterValue:i,sameTeamValue:r}){let n={};for(let s of t)n[s]||(n[s]=0),n[s]+=i;let a=e?.filter(({participantType:s})=>s===_t);if(a)for(let s of a){let o=s.individualParticipantIds??[],{uniquePairings:l}=Ioe({participantIds:o});for(let u of l)n[u]||(n[u]=0),n[u]+=r}return{valueObjects:n}}function voe(t){let{drawType:e=Jo,attachConsolation:i=!0,applyPositioning:r=!0,tournamentRecord:n,staggeredEntry:a,automated:s,placeByes:o,isMock:l,event:u}=t,c=t?.drawDefinition;if(!c)return{error:$e};let d=Cr,p=Vh({stageSequence:1,drawDefinition:c,stage:d}),f=[eo,lU,gu].includes(e)?p.length:Cv(p.length);if(!a&&e===Fv&&p.length<2||e===eo&&p.length<3)return{error:lM};let{tieFormat:m,matchUpType:h}=t;if(m){let E=Gn({tieFormat:m});if(E.error)return E}m=Gr(m??yn({drawDefinition:c})?.tieFormat),h=h??c.matchUpType;let{structures:g}=io({stageSequence:1,drawDefinition:c,stage:d});if(g.length>1)return{error:Lte};if(g?.[0]?.matchUps?.length)return{error:yB};let I=g?.[0]?.structureId;Object.assign(t,je({structureName:t.structureName??Qr(Cr),structureId:I,matchUpType:h,tieFormat:m,drawSize:f,stage:d}));let v=doe(t);if(v.error)return v;let w=v.generators[e];if(!w)return{error:J$};let y=w?.();if(y.error)return y;let{structures:b,links:S}=y,U=b.flatMap(E=>At({structure:E}).matchUps);m&&U.forEach(E=>{let{tieMatchUps:R}=Qh({matchUp:E,tieFormat:m,isMock:l});Object.assign(E,{tieMatchUps:R,matchUpType:h})}),(!r||!i)&&(c=Oe(c,!1,!0)),c.links??=[],S.length&&c.links.push(...S);let T=new Set(b.map(({structureId:E})=>E));c.structures??=[];let P=new Set(c.structures.map(({structureId:E})=>E));c.structures=c.structures.map(E=>T.has(E.structureId)?b.find(({structureId:R})=>R===E.structureId):E);let D=b.filter(({structureId:E})=>!P.has(E));return D.length&&c.structures.push(...D),s&&BU({seedingProfile:t.seedingProfile,applyPositioning:r,tournamentRecord:n,drawDefinition:c,structureId:I,placeByes:o,drawSize:f,event:u}),i&&ii({drawDefinition:c}),{links:S,structures:b,...W}}var MV={};dt(MV,{ScoringEngine:()=>Doe,addPoint:()=>wp,analyzeScore:()=>KV,analyzeSequence:()=>ale,analyzeSet:()=>ow,calculateMatchStatistics:()=>VV,calculatePointsTo:()=>SN,checkScoreHasValue:()=>fr,checkSetIsComplete:()=>PN,createMatchUp:()=>ad,deduceMatchUpFormat:()=>AN,enrichPointHistory:()=>Uoe,exportMatchUpJSON:()=>Xje,generate:()=>yoe,generateScoreString:()=>Jl,generateTieMatchUpScore:()=>HU,getEpisodes:()=>BV,getQuickStats:()=>Toe,getScore:()=>Cd,getScoreboard:()=>LV,getSetComplement:()=>JV,getSetScoreString:()=>kje,getTiebreakComplement:()=>NN,getWinner:()=>_V,groupByMatch:()=>ule,helpers:()=>Eoe,inferServeSide:()=>AV,isComplete:()=>$V,isValidMatchUpFormat:()=>$a,keyValueScore:()=>Yoe,mcpValidator:()=>Kje,mutate:()=>Poe,parseCSV:()=>lle,parseMCPPoint:()=>ole,parseMatchUpFormat:()=>qi,parseScoreString:()=>QU,pbpValidator:()=>xje,pointParser:()=>sle,query:()=>Zoe,resolvePointValue:()=>kV,reverseScore:()=>boe,shotParser:()=>zx,shotSplitter:()=>nle,stringifyMatchUpFormat:()=>DM,tidyScore:()=>Qoe,toStatObjects:()=>jV,validateMCPMatch:()=>cle,validateMatchUp:()=>tle,validateMatchUpScore:()=>ele,validateScore:()=>XV,validateSet:()=>Oje,validateSetScore:()=>YV,validateTieFormat:()=>Gn});var yoe={};dt(yoe,{ScoringEngine:()=>Doe,generateScoreString:()=>Jl,generateTieMatchUpScore:()=>HU,reverseScore:()=>boe});function Jl(t){let{winnerFirst:e=!0,setTBlast:i=!0,addOutcomeString:r,reversed:n=!1,matchUpStatus:a,matchUpFormat:s,autoComplete:o,winningSide:l,sets:u}=t;if(!u)return{error:Je,info:"missing sets"};let c=s&&qi(s),{bestOf:d,finalSetFormat:p,setFormat:f}=c??{},m=n||!(!e||!l||l===1),h=r?A2e({matchUpStatus:a}):"",g=u?.sort(k2e).map(I).filter(Boolean).join(" ")||"";if(!h)return g;if(l===2)return`${h} ${g}`;return`${g} ${h}`;function I(v){let w=d&&v.setNumber===d&&p?p:f,y=V=>Ai(V?.side1Score)||Ai(V?.side2Score),b=(V=>Ai(V?.side1TiebreakScore)||Ai(V?.side2TiebreakScore))(v),S=w?.tiebreakSet||!y(v)&&b,{side1Score:U,side2Score:T,side1TiebreakScore:P,side2TiebreakScore:D}=v,E=P||(Ai(P)||b&&o?0:""),R=D||(Ai(D)||b&&o?0:"");if(S){let V=y(v)&&!b,_=V?U:E,B=V?T:R;return`[${(m?[B,_]:[_,B]).join("-")}]`}let C=b?Math.min(E,R):"",M=C===E?1:2,N=Ai(C)?`(${C})`:"",A=U||(Ai(U)||o?0:""),O=T||(Ai(T)||o?0:""),k=V=>!i&&M===V?N:"",F=`${A}${k(1)}`,x=`${O}${k(2)}`,L=i&&b?`(${C})`:"",$=m?`${[x,F].join("-")}${L}`:`${[F,x].join("-")}${L}`;return["-"," "].includes($)&&($=""),$}}function A2e({matchUpStatus:t}){let e={[Sr]:"RET",[ai]:"WO",[Wi]:"DF/DF",[Si]:"WO/WO",[Kd]:"SUS",[Ta]:"ABN",[qt]:"DEF",[Vv]:"DR"};return t&&e[t]||""}function k2e(t,e){return t.setNumber-e.setNumber}function boe(t){if(!t?.score)return{error:Je};let{sets:e}=t.score,i=e.map(s=>{let{side1TiebreakScore:o,side2TiebreakScore:l,winningSide:u,side1Score:c,side2Score:d,setNumber:p}=s;return je({winningSide:u?3-u:void 0,side1TiebreakScore:l,side2TiebreakScore:o,side1Score:d,side2Score:c,setNumber:p})}),r=t?.setTBlast,n=Jl({setTBlast:r,sets:i}),a=Jl({sets:i,reversed:!0,setTBlast:r});return{reversedScore:{sets:i,scoreStringSide1:n,scoreStringSide2:a},...W}}function ad(t){let{matchUpId:e=Ct(),matchUpFormat:i,participants:r=[],isDoubles:n=!1,matchUpType:a}=t,s=a||(n?"DOUBLES":"SINGLES"),o=r.map((l,u)=>({sideNumber:u+1,participantId:l.participantId,participant:l}));return o.length===0&&o.push({sideNumber:1},{sideNumber:2}),{matchUpId:e,matchUpFormat:i,matchUpStatus:"TO_BE_PLAYED",matchUpType:s,sides:o,score:{sets:[]},createdAt:new Date().toISOString()}}function NV(t){return t?!!t.aggregate:!1}function wN(t,e){let i=t.bestOf||t.exactly||3,r=Math.ceil(i/2);if(e[0]===r-1&&e[1]===r-1&&t.finalSetFormat){let a=t.finalSetFormat;return a.tiebreakSet?"matchTiebreak":a.timed?"timed":"standard"}let n=t.setFormat;return n?n.tiebreakSet?"tiebreakOnly":n.timed?"timed":"standard":"standard"}function SN(t,e,i,r,n){if(i==="timed"||!r)return;let a=O2e(t),s=x2e(t),o=e.exactly||e.bestOf||3,l=Math.ceil(o/2),{side1Points:u,side2Points:c}=F2e(a),d=L2e(u,c,r,i,e,a),p=$2e(a,r,i),f=B2e(d,p,r,i),m=V2e(f,s,l,e),h=G2e(d,n);return{pointsToGame:d,pointsToSet:f,pointsToMatch:m,gamesToSet:p,isBreakpoint:h}}function O2e(t){let e=t.score.sets;if(e.length===0)return;let i=e.at(-1);return i?.winningSide===void 0?i:void 0}function x2e(t){let e=[0,0];return t.score.sets.forEach(i=>{i.winningSide===1&&e[0]++,i.winningSide===2&&e[1]++}),e}function F2e(t){if(!t)return{side1Points:0,side2Points:0};let e=t.side1GameScores||[],i=t.side2GameScores||[];if(e.length===0&&i.length===0)return{side1Points:0,side2Points:0};let r=Math.max(e.length,i.length)-1;return{side1Points:e[r]??0,side2Points:i[r]??0}}function L2e(t,e,i,r,n,a){if(r==="tiebreakOnly"){let s=i.tiebreakSet?.tiebreakTo||11,o=i.tiebreakSet?.NoAD||!1;return fk(t,e,s,o)}if(r==="matchTiebreak"){let s=n.finalSetFormat?.tiebreakSet?.tiebreakTo||10,o=n.finalSetFormat?.tiebreakSet?.NoAD||!1;return fk(t,e,s,o)}if(a){let s=a.side1Score||0,o=a.side2Score||0,l=i.setTo||6,u=(typeof i.tiebreakAt=="number"?i.tiebreakAt:void 0)??l;if(!i.noTiebreak&&s===u&&o===u){let c=i.tiebreakFormat?.tiebreakTo||7,d=i.tiebreakFormat?.NoAD||!1;return fk(t,e,c,d)}}if(n.gameFormat?.type==="CONSECUTIVE"){let s=n.gameFormat.count||3;return[s,s]}return _2e(t,e,i)}function _2e(t,e,i){let r=i.gameFormat?.NoAD||i.NoAD||!1,n=4;return[wq(t,e,n,r),wq(e,t,n,r)]}function wq(t,e,i,r){if(t>=i-1&&e>=i-1){if(r)return t>e?0:t===e?1:2;let n=t-e;return n>=2?0:n===1?1:2}return t>=i?0:i-t}function fk(t,e,i,r){return[Sq(t,e,i,r),Sq(e,t,i,r)]}function Sq(t,e,i,r){if(t>=i&&(t-e>=2||r&&t>e))return 0;if(t>=i-1&&e>=i-1){if(r)return t>e?0:t===e?1:2;let n=t-e;return n>=2?0:n===1?1:2}return t>=i?0:i-t}function $2e(t,e,i){if(i==="tiebreakOnly"||i==="matchTiebreak")return!t||t.winningSide!==void 0?[1,1]:[1,1];let r=t?.side1Score||0,n=t?.side2Score||0,a=e.setTo||6,s=(typeof e.tiebreakAt=="number"?e.tiebreakAt:void 0)??a,o=e.noTiebreak||!1,l=e.winBy||2;return[Uq(r,n,a,s,o,l),Uq(n,r,a,s,o,l)]}function Uq(t,e,i,r,n,a){if(!n&&t===r&&e===r)return 1;if(t>=i){let o=t-e;return o>=a?0:a-o}let s=i-t;if(e>=i-1&&t>=i-1){if(!n)return Math.max(1,i-t);let o=t-e;return o>=a?0:a-o}return s}function B2e(t,e,i,r){if(r==="tiebreakOnly"||r==="matchTiebreak")return[...t];let n=4;return[Tq(t[0],e[0],n),Tq(t[1],e[1],n)]}function Tq(t,e,i){if(e<=0)return 0;let r=Math.max(0,e-1);return t+r*i}function V2e(t,e,i,r){let n=r.setFormat,a=j2e(n,r);return[Dq(t[0],e[0],i,a),Dq(t[1],e[1],i,a)]}function j2e(t,e){if(!t)return 24;if(t.tiebreakSet)return t.tiebreakSet.tiebreakTo||11;if(t.timed)return 0;let i=t.setTo||6,r=e.gameFormat?.type==="CONSECUTIVE"?e.gameFormat?.count||3:4;return i*r}function Dq(t,e,i,r){if(e>=i)return 0;let n=Math.max(0,i-e-1);return t+n*r}function G2e(t,e){if(e===void 0)return!1;let i=1-e;return t[i]===1}function AV(t,e,i){if(i==="timed")return;let r=H2e(t);return NV(e)?W2e(t,r):i==="tiebreakOnly"||i==="matchTiebreak"?z2e(r):q2e(t,e,r)}function H2e(t){let e=t.score.sets;if(e.length===0)return;let i=e[e.length-1];return i.winningSide===void 0?i:void 0}function W2e(t,e){let i=0;for(let r of t.score.sets)r.winningSide!==void 0&&(r.side1TiebreakScore!==void 0?i+=(r.side1TiebreakScore??0)+(r.side2TiebreakScore??0):i+=(r.side1Score??0)+(r.side2Score??0));if(e&&e.winningSide===void 0){let r=e.side1GameScores||[],n=e.side2GameScores||[];if(r.length>0||n.length>0){let a=Math.max(r.length,n.length)-1;i+=(r[a]??0)+(n[a]??0)}else i+=(e.side1Score??0)+(e.side2Score??0)}return i%2===0?"deuce":"ad"}function z2e(t){if(!t)return"deuce";let e=t.side1GameScores||[],i=t.side2GameScores||[];return e.length===0&&i.length===0||((e[0]??0)+(i[0]??0))%2===0?"deuce":"ad"}function q2e(t,e,i){if(!i)return"deuce";let r=i.side1GameScores||[],n=i.side2GameScores||[];if(r.length===0&&n.length===0)return"deuce";let a=Math.max(r.length,n.length)-1;return((r[a]??0)+(n[a]??0))%2===0?"deuce":"ad"}function kV(t,e){if(!e.length)return 1;for(let{condition:i,value:r}of e)if(i.results&&t.result&&i.results.includes(t.result)||i.strokes&&t.stroke&&i.strokes.includes(t.stroke))return r;return 1}function wp(t,e,i){if(!wt(e)||e.winner===void 0||e.winner===null)return t;let r=t,{winner:n,server:a,timestamp:s}=e;r.history??={points:[]};let o=qi(t.matchUpFormat);if(!o)throw new Error(`Invalid matchUpFormat: ${t.matchUpFormat}`);let l=o.exactly||o.bestOf||3,u=Math.ceil(l/2),c=r.history.points.length+1,d=r.history.points.length,p=[0,0];r.score.sets.forEach(U=>{U.winningSide===1&&p[0]++,U.winningSide===2&&p[1]++});let f=wN(o,p),m=p[0]===u-1&&p[1]===u-1,h=m&&o.finalSetFormat?o.finalSetFormat:o.setFormat,g=h?.tiebreakSet?.modifier==="RALLY"||h?.modifier==="RALLY";a===void 0&&!g&&(a=FV(r,o,f));let I=e.code;!I&&n!==void 0&&a!==void 0&&(I=n===a?"S":"R");let v={...e,pointNumber:c,winner:n,server:a,timestamp:s||new Date().toISOString()};I&&(v.code=I),v.index=d;let w=SN(r,o,f,h,a);w&&(v.pointsToGame=w.pointsToGame,v.pointsToSet=w.pointsToSet,v.pointsToMatch=w.pointsToMatch,v.gamesToSet=w.gamesToSet,v.isBreakpoint=w.isBreakpoint);let y=AV(r,o,f);y!==void 0&&(v.serveSide=y);let b=i?.pointMultipliers||[],S=kV(v,b);switch(S!==1&&(v.scoreValue=S),r.history.points.push(v),r.matchUpStatus==="TO_BE_PLAYED"&&(r.matchUpStatus="IN_PROGRESS"),f){case"tiebreakOnly":K2e(r,v,n,o,h,p,u,S);break;case"matchTiebreak":X2e(r,v,n,o,p,u,S);break;case"timed":J2e(r,v,n,h,S);break;default:Y2e(r,v,n,o,h,p,u,m);break}return r}function Y2e(t,e,i,r,n,a,s,o){let l=UN(t,!1,!1),u=t.score.sets.indexOf(l),c=l.side1Score||0,d=l.side2Score||0,p=l.side1GameScores||[],f=l.side2GameScores||[];p.length===0&&f.length===0&&(p.push(0),f.push(0));let m=Math.max(p.length,f.length)-1,h=m>=0?p[m]??0:0,g=m>=0?f[m]??0:0;e.set=u,e.game=m,e.number=h+g;let I=n.setTo||6,v=(typeof n.tiebreakAt=="number"?n.tiebreakAt:void 0)??I,w=o&&r.finalSetFormat?.noTiebreak;i===0?(h++,p[p.length-1]=h):(g++,f[f.length-1]=g),l.side1GameScores=p,l.side2GameScores=f;let y=r.gameFormat?.type==="CONSECUTIVE",b=r.gameFormat?.count||3;if(y){let P=l.currentStreak;P&&P.side===i?l.currentStreak={side:i,count:P.count+1}:l.currentStreak={side:i,count:1}}let S=!w&&c===v&&d===v,U;y&&!S?U=l.currentStreak.count>=b?l.currentStreak.side:void 0:U=Q2e(h,g,n,S);let T=U===void 0?woe(h,g,S,y&&!S):"0-0";if(e.score=T,U!==void 0){y&&(l.currentStreak=void 0),U===0?l.side1Score=c+1:l.side2Score=d+1,S&&(l.side1TiebreakScore=h,l.side2TiebreakScore=g);let P=Z2e(l.side1Score||0,l.side2Score||0,n,o,r.finalSetFormat);typeof P=="number"?(l.winningSide=P+1,OV(t,r,s)):(l.side1GameScores.push(0),l.side2GameScores.push(0))}}function K2e(t,e,i,r,n,a,s,o=1){let l=UN(t,!0,!1),u=t.score.sets.indexOf(l),c=n.tiebreakSet.tiebreakTo||11,d=n.tiebreakSet.NoAD||!1,p=l.side1GameScores||[],f=l.side2GameScores||[];p.length===0&&f.length===0&&(p.push(0),f.push(0),l.side1GameScores=p,l.side2GameScores=f);let m=p[0]||0,h=f[0]||0;e.set=u,e.game=0,e.number=m+h,i===0?(m+=o,p[0]=m):(h+=o,f[0]=h),l.side1GameScores=p,l.side2GameScores=f;let g=xV(m,h,c,d);e.score=g===void 0?`${m}-${h}`:"0-0",g!==void 0&&(l.winningSide=g+1,l.side1TiebreakScore=m,l.side2TiebreakScore=h,l.side1Score=g===0?1:0,l.side2Score=g===0?0:1,OV(t,r,s))}function X2e(t,e,i,r,n,a,s=1){let o=r.finalSetFormat?.tiebreakSet?.tiebreakTo||10,l=r.finalSetFormat?.tiebreakSet?.NoAD||!1,u=UN(t,!1,!1),c=t.score.sets.indexOf(u),d=u.side1GameScores||[],p=u.side2GameScores||[];d.length===0&&p.length===0&&(d.push(0),p.push(0),u.side1GameScores=d,u.side2GameScores=p);let f=d[0]||0,m=p[0]||0;e.set=c,e.game=0,e.number=f+m,i===0?(f+=s,d[0]=f):(m+=s,p[0]=m),u.side1GameScores=d,u.side2GameScores=p;let h=xV(f,m,o,l);e.score=h===void 0?`${f}-${m}`:"0-0",h!==void 0&&(u.side1TiebreakScore=f,u.side2TiebreakScore=m,u.side1Score=h===0?1:0,u.side2Score=h===0?0:1,u.winningSide=h+1,OV(t,r,a))}function J2e(t,e,i,r,n=1){let a=UN(t,!1,!0),s=t.score.sets.indexOf(a);e.set=s,e.game=0,e.number=(a.side1Score||0)+(a.side2Score||0),i===0?a.side1Score=(a.side1Score||0)+n:a.side2Score=(a.side2Score||0)+n;let o=a.side1Score||0,l=a.side2Score||0;e.score=`${o}-${l}`}function UN(t,e,i){let r=t.score.sets.length-1;if(r>=0&&t.score.sets[r].winningSide===void 0)return t.score.sets[r];let n={setNumber:t.score.sets.length+1,side1Score:0,side2Score:0,side1GameScores:[],side2GameScores:[]};return e&&(n.isTiebreakOnly=!0),i&&(n.isTimed=!0),t.score.sets.push(n),n}function OV(t,e,i){let r=[0,0];t.score.sets.forEach(o=>{o.winningSide===1&&r[0]++,o.winningSide===2&&r[1]++});let n=NV(e),a=e.exactly;if(n){let o=a||e.bestOf||3;if(t.score.sets.filter(u=>u.winningSide!==void 0).length<o)return;let l=t.score.sets.reduce((u,c)=>(c.side1TiebreakScore!==void 0&&c.side2TiebreakScore!==void 0?(u[0]+=c.side1TiebreakScore,u[1]+=c.side2TiebreakScore):(u[0]+=c.side1Score??0,u[1]+=c.side2Score??0),u),[0,0]);l[0]!==l[1]&&(t.matchUpStatus="COMPLETED",t.winningSide=l[0]>l[1]?1:2,t.endTime=new Date().toISOString());return}if(!(r[0]>=i||r[1]>=i)||a&&t.score.sets.filter(o=>o.winningSide!==void 0).length<a)return;let s=r[0]>=i?0:1;t.matchUpStatus="COMPLETED",t.winningSide=s+1,t.endTime=new Date().toISOString()}function xV(t,e,i,r=!1){let n=Math.abs(t-e),a=r?1:2;if((t>=i||e>=i)&&n>=a)return t>e?0:1}function Q2e(t,e,i,r){let n=i.gameFormat?.NoAD||i.NoAD||!1;if(r){let o=i.tiebreakFormat?.tiebreakTo||7,l=i.tiebreakFormat?.NoAD||!1;return xV(t,e,o,l)}let a=4,s=Math.abs(t-e);if(n)return t>=a||e>=a?t>e?0:1:void 0;if((t>=a||e>=a)&&s>=2)return t>e?0:1}function Z2e(t,e,i,r,n){let a=i.setTo||6,s=(typeof i.tiebreakAt=="number"?i.tiebreakAt:void 0)??a,o=r&&n?.noTiebreak;if(a===1)return t>=1||e>=1?t>e?0:1:void 0;let l=(r&&n?n:i).winBy||2;if(!o&&(t===s+1||e===s+1)||(t>=a||e>=a)&&Math.abs(t-e)>=l)return t>e?0:1}function FV(t,e,i){let r=eVe(t,e,i);return t.history?.points?.[0]?.server===1?1-r:r}function eVe(t,e,i){let r=t.score.sets.length-1,n=r>=0?t.score.sets[r]:void 0;if(i==="tiebreakOnly"||i==="matchTiebreak"){let u=n?.side1GameScores||[],c=n?.side2GameScores||[],d=(u[0]||0)+(c[0]||0),p=0;for(let h=0;h<t.score.sets.length-1;h++){let g=t.score.sets[h];p+=(g.side1Score||0)+(g.side2Score||0)}let f=p%2,m=Math.floor(d/2)%2;return(f+m)%2}if(i==="timed")return((n?.side1Score||0)+(n?.side2Score||0))%2;let a=n?.side1Score||0,s=n?.side2Score||0,o=e.setFormat?.setTo||6,l=(typeof e.setFormat?.tiebreakAt=="number"?e.setFormat.tiebreakAt:void 0)??o;if(!e.finalSetFormat?.noTiebreak&&a===l&&s===l){let u=n?.side1GameScores||[],c=n?.side2GameScores||[],d=(u.at(-1)||0)+(c.at(-1)||0),p=(a+s)%2,f=Math.floor(d/2)%2;return(p+f)%2}return(a+s)%2}function woe(t,e,i,r){if(i||r)return`${t}-${e}`;let n=["0","15","30","40"];if(t<4&&e<4)return`${n[t]}-${n[e]}`;if(t>=3&&e>=3&&t===e)return"40-40";if(t>=3&&e>=3){let a=t-e;if(a===1)return"A-40";if(a===-1)return"40-A";if(a>=2)return"G-40";if(a<=-2)return"40-G"}return t>=3?`40-${e<4?n[e]:"40"}`:e>=3?`${t<4?n[t]:"40"}-40`:`${t<4?n[t]:"0"}-${e<4?n[e]:"0"}`}function Cd(t,e){let i=t.score.sets,r=rVe(t,e?.useBracketNotation),n=i.length>0?i.at(-1):null,a=n&&n.winningSide===void 0?[n.side1Score||0,n.side2Score||0]:[0,0],s=[0,0];if(n?.side1GameScores&&n.side2GameScores){let u=Math.max(n.side1GameScores.length,n.side2GameScores.length)-1;u>=0&&(s=[n.side1GameScores[u]||0,n.side2GameScores[u]||0])}let o=tVe(t,s),l=iVe(t);return{sets:i,scoreString:r,games:a,points:s,pointDisplay:o,situation:l}}function tVe(t,e){if(t.matchUpStatus==="COMPLETED"||t.matchUpStatus==="TO_BE_PLAYED")return;let i=qi(t.matchUpFormat);if(!i)return;let r=t.score.sets.at(-1);if(!r||r.winningSide!==void 0)return;let n=[0,0];t.score.sets.forEach(c=>{c.winningSide===1&&n[0]++,c.winningSide===2&&n[1]++});let a=wN(i,n),s=a==="tiebreakOnly"||a==="matchTiebreak",o=i.gameFormat?.type==="CONSECUTIVE",l=s;if(!l&&a==="standard"){let c=i.exactly||i.bestOf||3,d=Math.ceil(c/2),p=n[0]===d-1&&n[1]===d-1,f=p&&i.finalSetFormat?i.finalSetFormat:i.setFormat;if(f){let m=r.side1Score||0,h=r.side2Score||0,g=f.setTo||6,I=(typeof f.tiebreakAt=="number"?f.tiebreakAt:void 0)??g,v=f.noTiebreak||!1,w=p&&i.finalSetFormat?.noTiebreak;l=!v&&!w&&m===I&&h===I}}let u=woe(e[0],e[1],l,o&&!l).split("-");return u.length===2?[u[0],u[1]]:[String(e[0]),String(e[1])]}function iVe(t){if(t.matchUpStatus==="COMPLETED"||t.matchUpStatus==="TO_BE_PLAYED")return;let e=qi(t.matchUpFormat);if(!e)return;let i=e.exactly||e.bestOf||3,r=Math.ceil(i/2),n=[0,0];t.score.sets.forEach(y=>{y.winningSide===1&&n[0]++,y.winningSide===2&&n[1]++});let a=wN(e,n),s=n[0]===r-1&&n[1]===r-1,o=s&&e.finalSetFormat?e.finalSetFormat:e.setFormat,l=o?.tiebreakSet?.modifier==="RALLY"||o?.modifier==="RALLY",u;l||(u=FV(t,e,a));let c=SN(t,e,a,o,u);if(!c)return{isBreakPoint:!1,isGamePoint:!1,isSetPoint:!1,isMatchPoint:!1,isGoldenPoint:!1,isTiebreak:!1,server:u};let{pointsToGame:d,pointsToSet:p,pointsToMatch:f,isBreakpoint:m}=c,h=a==="tiebreakOnly"||a==="matchTiebreak";if(!h&&a==="standard"&&o){let y=t.score.sets.at(-1);if(y){let b=y.side1Score||0,S=y.side2Score||0,U=o.setTo||6,T=(typeof o.tiebreakAt=="number"?o.tiebreakAt:void 0)??U,P=o.noTiebreak||!1,D=s&&e.finalSetFormat?.noTiebreak;h=!P&&!D&&b===T&&S===T}}let g=!!(o?.NoAD||o?.gameFormat?.NoAD||h&&(o?.tiebreakFormat?.NoAD||o?.tiebreakSet?.NoAD||e.finalSetFormat?.tiebreakSet?.NoAD))&&d[0]===1&&d[1]===1,I=u===void 0?!1:d[u]===1,v=Math.min(p[0],p[1])===1,w=Math.min(f[0],f[1])===1;return{isBreakPoint:m,isGamePoint:I,isSetPoint:v,isMatchPoint:w,isGoldenPoint:g,isTiebreak:h,server:u}}function rVe(t,e=!1){let i=t.score.sets;return i.length===0?"0-0":i.map(r=>{let n=r.side1Score||0,a=r.side2Score||0;if(r.side1TiebreakScore!==void 0||r.side2TiebreakScore!==void 0){let s=r.side1TiebreakScore||0,o=r.side2TiebreakScore||0;return e&&(n===0&&a===1||n===1&&a===0)?`[${s}-${o}]`:n>a?`${n}-${a}(${o})`:`${n}(${s})-${a}`}return`${n}-${a}`}).join(", ")}function LV(t,e){let i=t.score.sets;if(i.length===0)return"0-0";let r=e?.perspective,n=i.map(s=>{let o=s.side1Score||0,l=s.side2Score||0;if(r===1&&([o,l]=[l,o]),s.side1TiebreakScore!==void 0||s.side2TiebreakScore!==void 0){let u=s.side1TiebreakScore||0,c=s.side2TiebreakScore||0;return r===1&&([u,c]=[c,u]),o>l?`${o}-${l}(${c})`:`${o}(${u})-${l}`}return`${o}-${l}`}),a=i.at(-1);if(t.matchUpStatus==="IN_PROGRESS"&&a&&!a.winningSide){let s=a.side1GameScores||[],o=s.length-1;if(o>=0&&s.length>0){let l=s[o]||0,u=(a.side2GameScores||[])[o]||0;if(l===0&&u===0)return n.join(", ");r===1&&([l,u]=[u,l]);let c=a.side1Score||0,d=a.side2Score||0,p=t.matchUpFormat?qi(t.matchUpFormat):void 0,f=p?.setFormat?.setTo||6,m=(typeof p?.setFormat?.tiebreakAt=="number"?p.setFormat.tiebreakAt:void 0)??f,h=c===m&&d===m,g=p?.gameFormat?.type==="CONSECUTIVE",I=n.at(-1),v=`${n.slice(0,-1).join(", ")}${n.length>1?", ":""}${I}`;if(h||g)return`${v} (${l}-${u})`;{let w=nVe(l,u);return`${v} (${w})`}}}return n.join(", ")}function nVe(t,e){let i=["0","15","30","40"];if(t<=3&&e<=3)return`${i[t]}-${i[e]}`;if(t>=3&&e>=3){let r=t-e;return r===0?"40-40":r===1?"A-40":r===-1?"40-A":r>=2?"G-40":"40-G"}return t>=3?"G-40":e>=3?"40-G":`${i[t]}-${i[e]}`}function _V(t){if(t.matchUpStatus==="COMPLETED")return t.winningSide}function $V(t){return t.matchUpStatus==="COMPLETED"}function BV(t){if(!t)return[];let e=t.history?.points;if(!e||e.length===0)return[];let i=[];for(let r=0;r<e.length;r++){let n=e[r],a=r<e.length-1?e[r+1]:void 0,s=n.set??0,o=n.game??0,l=n.number??0,u=a?a.set??0:void 0,c=a?a.game??0:void 0,d=r===e.length-1,p=d?t.matchUpStatus==="COMPLETED"||u===void 0&&c===void 0:u!==s||c!==o,f=d?t.matchUpStatus==="COMPLETED"||!1:a!==void 0&&u!==s,m;p&&(m=n.winner);let h;if(f){let b=t.score.sets[s];b?.winningSide!==void 0&&(h=b.winningSide-1)}let g={};n.pointsToGame&&(g.pointsToGame=n.pointsToGame),n.pointsToSet&&(g.pointsToSet=n.pointsToSet),n.pointsToMatch&&(g.pointsToMatch=n.pointsToMatch),n.gamesToSet&&(g.gamesToSet=n.gamesToSet),n.isBreakpoint!==void 0&&(g.isBreakpoint=n.isBreakpoint);let I=a?.server??n.server??0,v=t.score.sets[s],w=!!(v?.isTiebreakOnly||o>0&&v&&v.side1Score!==void 0&&v.side2Score!==void 0&&!v.isTiebreakOnly),y={action:"addPoint",point:{index:r,number:l,winner:n.winner,server:n.server,score:n.score,result:n.result},game:{index:o,isTiebreak:w,complete:p,winner:m},set:{index:s,complete:f,winner:h},needed:g,nextService:I,result:n.result,complete:d&&t.matchUpStatus==="COMPLETED"};i.push(y)}return i}var aVe={A:"Ace",D:"Double Fault",S:"Serve Winner",R:"Return Winner",W:"Winner",E:"Unforced Error",F:"Forced Error"},sVe=new Set(["A","S"]),oVe=new Set(["D","R","E","F"]);function lVe(t,e){let i={...t};return i.server=e.server,i.index=e.index,i.set=e.set,i.game=e.game,i.code&&!i.winner&&(i.winner=uVe(i.code,e.server)),i.code&&!i.result&&(i.result=aVe[i.code]),i.first_serve?i.serve=2:i.serve||(i.serve=1),i}function uVe(t,e){return sVe.has(t)?e:oVe.has(t)?1-e:e}function cVe(t){let e=[],i=[],r=t.result?.toLowerCase()||"";return r.includes("ace")&&e.push("aces"),(r.includes("winner")||r.includes("ace"))&&e.push("winners"),r.includes("double fault")&&i.push("doubleFaults"),r.includes("unforced error")&&i.push("unforcedErrors"),r.includes("forced error")&&i.push("forcedErrors"),t.winner===t.server?(e.push("servesWon"),t.serve===1?e.push("serves1stWon"):t.serve===2&&e.push("serves2ndWon")):(e.push("returns"),t.serve===1?e.push("received1stWon"):t.serve===2&&e.push("received2ndWon")),e.push("pointsWon"),{winner:e,loser:i}}function Soe(t,e){let i={players:{},teams:{}};for(let a=0;a<2;a++)i.players[a]={},i.teams[a]={};let r=t;e?.setFilter!==void 0&&(r=t.filter(a=>a.set===e.setFilter));let n;return r.forEach((a,s)=>{if(a.winner===void 0){console.warn("Point missing winner:",a);return}let{winner:o,loser:l}=cVe(a),u=a.winner,c=1-u;if(o.forEach(d=>{i.teams[u][d]||(i.teams[u][d]=[]),i.teams[u][d].push(a),i.players[u][d]||(i.players[u][d]=[]),i.players[u][d].push(a)}),l.forEach(d=>{i.teams[c][d]||(i.teams[c][d]=[]),i.teams[c][d].push(a),i.players[c][d]||(i.players[c][d]=[]),i.players[c][d].push(a)}),a.server!==void 0){let d=a.server;i.teams[d].pointsServed||(i.teams[d].pointsServed=[]),i.teams[d].pointsServed.push(a),a.serve===1?(i.teams[d].serves1stIn||(i.teams[d].serves1stIn=[]),i.teams[d].serves1stIn.push(a)):a.serve===2&&(i.teams[d].serves2ndIn||(i.teams[d].serves2ndIn=[]),i.teams[d].serves2ndIn.push(a))}if(a.hand){let d=a.hand;i.teams[u][d]||(i.teams[u][d]=[]),i.teams[u][d].push({point:a,index:s})}if(dVe(a,n)&&n?.winner!==void 0){let d=n.winner;i.teams[d].gamesWon||(i.teams[d].gamesWon=[]),i.teams[d].gamesWon.push(n),i.players[d].gamesWon||(i.players[d].gamesWon=[]),i.players[d].gamesWon.push(n)}if(a.breakpoint){let d=a.server;i.teams[d].breakpointsFaced||(i.teams[d].breakpointsFaced=[]),i.teams[d].breakpointsFaced.push(a),u===d&&(i.teams[d].breakpointsSaved||(i.teams[d].breakpointsSaved=[]),i.teams[d].breakpointsSaved.push(a))}n=a}),i}function dVe(t,e){return e&&t.game!==void 0&&e.game!==void 0?t.game!==e.game:!1}function pVe(t){let e={totalPoints:0,byTeam:[0,0],byCategory:{}};for(let r=0;r<2;r++)if(t.teams[r].pointsWon){let n=t.teams[r].pointsWon.length;e.byTeam[r]=n,e.totalPoints+=n}let i=new Set;for(let r=0;r<2;r++)Object.keys(t.teams[r]).forEach(n=>i.add(n));return i.forEach(r=>{e.byCategory[r]=0;for(let n=0;n<2;n++)t.teams[n][r]&&(e.byCategory[r]+=t.teams[n][r].length)}),e}function fVe(t){if(!t?.teams)return[];let e=[];return Object.values({Aces:{category:"Aces",numerators:["aces"],calc:"number"},"Double Faults":{category:"Double Faults",numerators:["doubleFaults"],calc:"number"},Winners:{category:"Winners",numerators:["winners"],calc:"number"},"Unforced Errors":{category:"Unforced Errors",numerators:["unforcedErrors"],calc:"number"},"Forced Errors":{category:"Forced Errors",numerators:["forcedErrors"],calc:"number"},"Total Points Won":{category:"Total Points Won",numerators:["pointsWon"],calc:"number"},"Max Pts/Row":{category:"Max Pts/Row",numerators:["pointsWon"],calc:"maxConsecutive",attribute:"index"},"Max Games/Row":{category:"Max Games/Row",numerators:["gamesWon"],calc:"maxConsecutive",attribute:"game"},"First Serve %":{category:"First Serve %",numerators:["serves1stIn"],denominators:["pointsServed"],calc:"percentage"},"Points Won 1st":{category:"Points Won 1st",numerators:["serves1stWon"],denominators:["serves1stIn"],calc:"percentage"},"Points Won 2nd":{category:"Points Won 2nd",numerators:["serves2ndWon"],denominators:["serves2ndIn"],calc:"percentage"},"Points Won Receiving":{category:"Points Won Receiving",numerators:["received1stWon","received2ndWon"],denominators:["-pointsServed"],calc:"percentage"},"Breakpoints Saved":{category:"Breakpoints Saved",numerators:["breakpointsSaved"],denominators:["breakpointsFaced"],calc:"percentage"},"Breakpoints Converted":{category:"Breakpoints Converted",numerators:["-breakpointsSaved"],denominators:["-breakpointsFaced"],calc:"difference"},"Games Won":{category:"Games Won",numerators:["gamesWon"],calc:"number"},"Service Points Won":{category:"Service Points Won",numerators:["servesWon"],denominators:["pointsServed"],calc:"percentage"},"Aggressive Margin":{category:"Aggressive Margin",numerators:["*doubleFaults","*unforcedErrors"],denominators:["*aces","*winners","-*forcedErrors"],calc:"aggressiveMargin"}}).forEach(i=>{let r=[Pq(i,t.teams,0),Pq(i,t.teams,1)];(r[0].value!==0||r[1].value!==0)&&e.push({category:i.category,teams:r})}),e}function Pq(t,e,i){switch(t.calc){case"number":return mVe(t,e,i);case"percentage":return hVe(t,e,i);case"maxConsecutive":return gVe(t,e,i);case"difference":return IVe(t,e,i);case"aggressiveMargin":return vVe(t,e,i)}}function mVe(t,e,i){let r=Km(t.numerators,e,i);return{value:r,display:String(r),numerators:t.numerators}}function hVe(t,e,i){let r=Km(t.numerators,e,i),n=Km(t.denominators||[],e,i);if(!n)return{value:0,display:"0",numerators:t.numerators};let a=Math.round(r/n*100);return{value:a,display:`${a}% (${r}/${n})`,numerators:t.numerators}}function gVe(t,e,i){let r=t.numerators[0],n=t.attribute||"index";if(!e[i][r])return{value:0,display:"0"};let a=e[i][r],s=0,o=a.length?1:0,l;return a.forEach(u=>{let c=u[n];l!==void 0&&c===l+1?o++:(o>s&&(s=o),o=1),l=c}),o>s&&(s=o),{value:s,display:String(s)}}function IVe(t,e,i){let r=Km(t.numerators,e,i),n=Km(t.denominators||[],e,i);if(!n)return{value:0,display:"0",numerators:t.numerators};let a=Math.abs(n-r),s=Math.round(a/n*100);return{value:s,display:`${s}% (${a}/${n})`,numerators:t.numerators}}function vVe(t,e,i){let r=Km(t.denominators||[],e,i),n=Km(t.numerators,e,i),a=r-n;return{value:a,display:String(a)}}function Km(t,e,i){return t?t.reduce((r,n)=>{let a=n.startsWith("-");n.includes("*");let s=n.replace("-","").replace("*",""),o=a?1-i:i,l=e[o]?.[s];return l?r+l.length:r},0):0}function VV(t,e,i){let r=Soe(e||[],i),n=fVe(r),a=pVe(r);return{counters:r,calculated:n,summary:a}}function Uoe(t){if(!t)return[];let e=[],i=0,r=0,n=0;return t.forEach((a,s)=>{let o=lVe(a,{server:i,index:s,set:r,game:n});e.push(o)}),e}function Toe(t,e){let i=Soe(t||[],e);return{aces:[i.teams[0].aces?.length||0,i.teams[1].aces?.length||0],doubleFaults:[i.teams[0].doubleFaults?.length||0,i.teams[1].doubleFaults?.length||0],winners:[i.teams[0].winners?.length||0,i.teams[1].winners?.length||0],unforcedErrors:[i.teams[0].unforcedErrors?.length||0,i.teams[1].unforcedErrors?.length||0],totalPoints:[i.teams[0].pointsWon?.length||0,i.teams[1].pointsWon?.length||0]}}function jt(t,e,i){return t.teams[e]?.[i]?.length??0}function Ds(t,e){return!e||!t?0:Number.parseFloat((t/e*100).toFixed(2))}function CT(t,e,i){return t.find(r=>r.category===e)?.teams[i]?.value??0}function jV(t){if(!t?.counters?.teams)return[];let{counters:e,calculated:i}=t,r=[];r.push({name:"Aces",numerator:[jt(e,0,"aces"),jt(e,1,"aces")],default:"numerator"},{name:"Double Faults",numerator:[jt(e,0,"doubleFaults"),jt(e,1,"doubleFaults")],default:"numerator"});let n=[jt(e,0,"serves1stWon"),jt(e,1,"serves1stWon")],a=[jt(e,0,"servesWon"),jt(e,1,"servesWon")];if(n[0]+n[1]>0&&(a[0]!==n[0]||a[1]!==n[1])){let y=[jt(e,0,"pointsServed"),jt(e,1,"pointsServed")],b=[jt(e,0,"serves1stIn"),jt(e,1,"serves1stIn")],S=[jt(e,0,"serves2ndWon"),jt(e,1,"serves2ndWon")],U=[jt(e,0,"serves2ndIn"),jt(e,1,"serves2ndIn")];r.push({name:"1st Serve In",numerator:b,denominator:y,pct:[Ds(b[0],y[0]),Ds(b[1],y[1])]},{name:"1st Serve Points Won",numerator:n,denominator:b,pct:[Ds(n[0],b[0]),Ds(n[1],b[1])]},{name:"2nd Serve Points Won",numerator:S,denominator:U,pct:[Ds(S[0],U[0]),Ds(S[1],U[1])]})}r.push({name:"Total Points Won",numerator:[jt(e,0,"pointsWon"),jt(e,1,"pointsWon")],default:"numerator"});let s=jt(e,0,"received1stWon")+jt(e,0,"received2ndWon"),o=jt(e,1,"received1stWon")+jt(e,1,"received2ndWon"),l=jt(e,1,"pointsServed"),u=jt(e,0,"pointsServed");r.push({name:"Receiving Points Won",numerator:[s,o],denominator:[l,u],pct:[Ds(s,l),Ds(o,u)]});let c=jt(e,1,"breakpointsFaced")-jt(e,1,"breakpointsSaved"),d=jt(e,0,"breakpointsFaced")-jt(e,0,"breakpointsSaved"),p=jt(e,1,"breakpointsFaced"),f=jt(e,0,"breakpointsFaced");r.push({name:"Break Points Won",numerator:[c,d],denominator:[p,f],pct:[Ds(c,p),Ds(d,f)]});let m=jt(e,0,"breakpointsSaved"),h=jt(e,1,"breakpointsSaved"),g=jt(e,0,"breakpointsFaced"),I=jt(e,1,"breakpointsFaced");r.push({name:"Break Points Saved",numerator:[m,h],denominator:[g,I],pct:[Ds(m,g),Ds(h,I)]},{name:"Winners",numerator:[jt(e,0,"winners"),jt(e,1,"winners")],default:"numerator"},{name:"Unforced Errors",numerator:[jt(e,0,"unforcedErrors"),jt(e,1,"unforcedErrors")],default:"numerator"},{name:"Forced Errors",numerator:[jt(e,0,"forcedErrors"),jt(e,1,"forcedErrors")],default:"numerator"});let v=a,w=[jt(e,0,"pointsServed"),jt(e,1,"pointsServed")];return r.push({name:"Service Points Won",numerator:v,denominator:w,pct:[Ds(v[0],w[0]),Ds(v[1],w[1])]},{name:"Games Won",numerator:[jt(e,0,"gamesWon"),jt(e,1,"gamesWon")]},{name:"Most Consecutive Points Won",numerator:[CT(i,"Max Pts/Row",0),CT(i,"Max Pts/Row",1)]},{name:"Most Consecutive Games Won",numerator:[CT(i,"Max Games/Row",0),CT(i,"Max Games/Row",1)]}),r}var Doe=class{constructor(t={}){this.redoStack=[],this.pointMultipliers=[],t.competitionFormat?(this.competitionFormat=t.competitionFormat,this.matchUpFormat=t.matchUpFormat||t.competitionFormat.matchUpFormat||"SET3-S:6/TB7",this.pointMultipliers=t.pointMultipliers||t.competitionFormat.pointMultipliers||[]):(this.matchUpFormat=t.matchUpFormat||"SET3-S:6/TB7",this.pointMultipliers=t.pointMultipliers||[]),this.matchUpId=t.matchUpId,this.isDoubles=t.isDoubles||!1,this.eventHandlers=t.eventHandlers,this.state=ad({matchUpFormat:this.matchUpFormat,matchUpId:this.matchUpId,isDoubles:this.isDoubles}),this.cacheFormatStructure()}setState(t){this.state=t,this.matchUpFormat=t.matchUpFormat,this.matchUpId=t.matchUpId,this.isDoubles=t.matchUpType==="DOUBLES",this.redoStack=[],this.initialScore=void 0,this.cacheFormatStructure()}getState(){return this.state}addPoint(t){let e=this.state.history?.points.length||0,i=this.state.score.sets.reduce((s,o)=>s+(o.side1Score||0)+(o.side2Score||0),0),r=this.state.score.sets.filter(s=>s.winningSide!==void 0).length,n=this.state.matchUpStatus==="COMPLETED",a=this.hasLineUp()?this.getActivePlayers():void 0;if(this.state=wp(this.state,t,{pointMultipliers:this.pointMultipliers}),a){let s=this.state.history.points[this.state.history.points.length-1];this.isDoubles?s.activePlayers=[a.side1,a.side2]:s.activePlayers=[a.side1[0]||"",a.side2[0]||""]}if(t.penaltyType){let s=this.state.history.points[this.state.history.points.length-1];s.penaltyType=t.penaltyType}if(this.ensureHistory(),this.state.history.entries.push({type:"point",data:{winner:t.winner,server:t.server,timestamp:t.timestamp,rallyLength:t.rallyLength,result:t.result,penaltyType:t.penaltyType},timestamp:t.timestamp||new Date().toISOString(),pointIndex:e}),this.redoStack=[],this.eventHandlers){let s=this.buildEventContext();if(this.eventHandlers.onPoint?.(s),this.state.score.sets.reduce((o,l)=>o+(l.side1Score||0)+(l.side2Score||0),0)>i&&this.eventHandlers.onGameComplete?.({...s,gameWinner:t.winner}),this.state.score.sets.filter(o=>o.winningSide!==void 0).length>r){let o=this.state.score.sets.findLast(l=>l.winningSide!==void 0)?.winningSide===1?0:1;this.eventHandlers.onSetComplete?.({...s,setWinner:o})}if(!n&&this.state.matchUpStatus==="COMPLETED"){let o=this.state.winningSide===1?0:1;this.eventHandlers.onMatchComplete?.({...s,matchWinner:o})}}}addSet(t){this.applyAddSet(t),this.ensureHistory();let e=this.state.score.sets.at(-1)?.winningSide;this.state.history.entries.push({type:"set",data:{...t,winningSide:e},timestamp:t.timestamp||new Date().toISOString()}),this.redoStack=[]}addGame(t){this.applyAddGame(t),this.ensureHistory(),this.state.history.entries.push({type:"game",data:t,timestamp:t.timestamp||new Date().toISOString()}),this.redoStack=[]}endSegment(t){this.applyEndSegment(t),this.ensureHistory();let e=(t?.setNumber??this.state.score.sets.length)-1;this.state.history.entries.push({type:"endSegment",data:{setNumber:e+1,...t},timestamp:t?.timestamp||new Date().toISOString()})}setInitialScore(t){this.initialScore=t,this.redoStack=[],this.applyInitialScore(this.state,t),this.ensureHistory(),this.state.history.entries.push({type:"setInitialScore",data:t,timestamp:new Date().toISOString()}),this.state.matchUpStatus==="TO_BE_PLAYED"&&(this.state.matchUpStatus="IN_PROGRESS")}undo(t=1){let e=this.state.history?.entries;if(e&&e.length>0){let n=Math.min(t,e.length);for(let a=0;a<n;a++){let s=e.pop();this.redoStack.push(s),s.type==="point"&&this.state.history.points.pop()}return this.rebuildFromEntries(),this.eventHandlers?.onUndo?.(this.buildEventContext()),!0}let i=this.state.history?.points||[];if(i.length===0)return!1;let r=Math.min(t,i.length);for(let n=0;n<r;n++){let a=i.pop();this.redoStack.push({type:"point",data:{winner:a.winner,server:a.server,timestamp:a.timestamp,rallyLength:a.rallyLength},timestamp:a.timestamp||""})}return this.rebuildState(),this.eventHandlers?.onUndo?.(this.buildEventContext()),!0}redo(t=1){if(this.redoStack.length===0)return!1;let e=Math.min(t,this.redoStack.length);for(let i=0;i<e;i++){let r=this.redoStack.pop();this.ensureHistory(),this.state.history.entries.push(r),r.type}return this.rebuildFromEntries(),this.eventHandlers?.onRedo?.(this.buildEventContext()),!0}canUndo(){let t=this.state.history?.entries;return t&&t.length>0?!0:(this.state.history?.points.length||0)>0}canRedo(){return this.redoStack.length>0}getUndoDepth(){let t=this.state.history?.entries;return t&&t.length>0?t.length:this.state.history?.points.length||0}getRedoDepth(){return this.redoStack.length}getScore(){return Cd(this.state)}getScoreboard(t){return LV(this.state,t)}getWinner(){return _V(this.state)}isComplete(){return $V(this.state)}getPointCount(){return this.state.history?.points.length||0}getFormat(){return this.state.matchUpFormat}getStatistics(t){let e=this.state.history?.points||[];return VV(this.state,e,t)}getStatObjects(t){return jV(this.getStatistics(t))}getNextServer(){if(this.competitionFormat?.serverRule==="WINNER_SERVES"){let i=this.state.history?.points.at(-1);return i?i.winner:0}if(!this.cachedFormatStructure)return 0;let t=[0,0];this.state.score.sets.forEach(i=>{i.winningSide===1&&t[0]++,i.winningSide===2&&t[1]++});let e=wN(this.cachedFormatStructure,t);return FV(this.state,this.cachedFormatStructure,e)}getEpisodes(){return BV(this.state)}isNoAd(){return!!(this.cachedFormatStructure?.setFormat?.NoAD||this.cachedFormatStructure?.setFormat?.gameFormat?.NoAD)}getSetsToWin(){if(!this.cachedFormatStructure)return 2;let t=this.cachedFormatStructure.exactly||this.cachedFormatStructure.bestOf||3;return Math.ceil(t/2)}getTiebreakAt(){let t=this.cachedFormatStructure?.setFormat;if(!t||t.tiebreakSet||t.timed||t.noTiebreak)return null;let e=t.setTo||6;return(typeof t.tiebreakAt=="number"?t.tiebreakAt:void 0)??e}hasFinalSetTiebreak(){let t=this.cachedFormatStructure?.finalSetFormat;return t?t.tiebreakSet?!0:t.noTiebreak?!1:!!(t.tiebreakFormat||t.tiebreakAt!==void 0):this.getTiebreakAt()!==null}getFormatStructure(){return this.cachedFormatStructure}getInputMode(){let t=this.state.history?.entries||[];if(t.length===0)return(this.state.history?.points.length||0)>0?"points":"none";let e=new Set(t.filter(i=>i.type!=="setInitialScore"&&i.type!=="endSegment").map(i=>i.type));if(e.size===0)return"none";if(e.size===1){let i=e.values().next().value;if(i==="point")return"points";if(i==="game")return"games";if(i==="set")return"sets"}return"mixed"}setLineUp(t,e){let i=this.state.sides.find(r=>r.sideNumber===t);i&&(i.lineUp=e),this.initialLineUps??={},this.initialLineUps[t]=e.map(r=>({...r}))}substitute(t){let e=this.state.sides.find(n=>n.sideNumber===t.sideNumber);if(!e?.lineUp)return;let i=e.lineUp.findIndex(n=>n.participantId===t.outParticipantId);if(i===-1)return;this.ensureHistory(),this.state.history.substitutions??=[];let r={sideNumber:t.sideNumber,outParticipantId:t.outParticipantId,inParticipantId:t.inParticipantId,beforePointIndex:this.state.history.points.length,timestamp:t.timestamp};this.state.history.substitutions.push(r),e.lineUp[i]={...e.lineUp[i],participantId:t.inParticipantId},this.state.history.entries.push({type:"substitution",data:r,timestamp:t.timestamp||new Date().toISOString()}),this.redoStack=[]}getActivePlayers(){let t=this.state.sides.find(i=>i.sideNumber===1),e=this.state.sides.find(i=>i.sideNumber===2);return{side1:t?.lineUp?.map(i=>i.participantId)||[],side2:e?.lineUp?.map(i=>i.participantId)||[]}}hasLineUp(){return this.state.sides.some(t=>t.lineUp&&t.lineUp.length>0)}setPointMultipliers(t){this.pointMultipliers=t}getPointMultipliers(){return this.pointMultipliers}getSupplementaryState(){return{redoStack:[...this.redoStack],initialLineUps:this.initialLineUps?Object.fromEntries(Object.entries(this.initialLineUps).map(([t,e])=>[t,e.map(i=>({...i}))])):void 0}}loadSupplementaryState(t){t.redoStack&&(this.redoStack=[...t.redoStack]),t.initialLineUps&&(this.initialLineUps=Object.fromEntries(Object.entries(t.initialLineUps).map(([e,i])=>[e,i.map(r=>({...r}))])))}getPenaltyProfile(){return this.competitionFormat?.penaltyProfile}getPointProfile(){return this.competitionFormat?.pointProfile}getTimerProfile(){return this.competitionFormat?.timerProfile}getTimeoutRules(){return this.competitionFormat?.timeoutRules}getSubstitutionRules(){return this.competitionFormat?.substitutionRules}getPlayerRules(){return this.competitionFormat?.playerRules}setEventHandlers(t){this.eventHandlers=t}getEventHandlers(){return this.eventHandlers}decoratePoint(t,e){let i=this.state.history?.points[t];i&&Object.assign(i,e)}markHardBoundary(t){let e=this.state.score.sets[t.setIndex];e&&(e.hardBoundaries??=[],e.hardBoundaries.includes(t.gameIndex)||(e.hardBoundaries.push(t.gameIndex),e.hardBoundaries.sort((i,r)=>i-r)))}editPoint(t,e,i){let r=this.state.history?.points;if(!r||t<0||t>=r.length)return;let n=i?.recalculate!==!1,a=r[t];if(e.winner!==void 0&&(a.winner=e.winner),e.server!==void 0&&(a.server=e.server),e.timestamp!==void 0&&(a.timestamp=e.timestamp),e.rallyLength!==void 0&&(a.rallyLength=e.rallyLength),e.wrongSide!==void 0&&(a.wrongSide=e.wrongSide),e.wrongServer!==void 0&&(a.wrongServer=e.wrongServer),e.penaltyPoint!==void 0&&(a.penaltyPoint=e.penaltyPoint),!n)return;let s=this.state.history?.entries;if(s){let o=s.find(l=>l.type==="point"&&l.pointIndex===t);o&&(e.winner!==void 0&&(o.data.winner=e.winner),e.server!==void 0&&(o.data.server=e.server))}s&&s.length>0?this.rebuildFromEntries():this.rebuildState(),this.redoStack=[]}reset(){this.state=ad({matchUpFormat:this.matchUpFormat,matchUpId:this.matchUpId,isDoubles:this.isDoubles}),this.redoStack=[],this.initialScore=void 0,this.initialLineUps=void 0,this.eventHandlers?.onReset?.(this.buildEventContext())}ensureHistory(){this.state.history??={points:[]},this.state.history.entries??=[]}buildEventContext(){return{state:this.state,score:Cd(this.state)}}cacheFormatStructure(){this.cachedFormatStructure=qi(this.matchUpFormat)}getInitialLineUps(){return this.initialLineUps}applyAddSet(t){let{side1Score:e,side2Score:i,side1TiebreakScore:r,side2TiebreakScore:n}=t,a=t.winningSide;a===void 0&&(e>i?a=1:i>e&&(a=2));let s={setNumber:this.state.score.sets.length+1,side1Score:e,side2Score:i,winningSide:a};r!==void 0&&(s.side1TiebreakScore=r),n!==void 0&&(s.side2TiebreakScore=n),this.state.score.sets.push(s),this.state.matchUpStatus==="TO_BE_PLAYED"&&(this.state.matchUpStatus="IN_PROGRESS"),a!==void 0&&this.checkMatchCompletion()}applyAddGame(t){let{winner:e,tiebreakScore:i}=t,r=this.state.score.sets.length>0?this.state.score.sets.at(-1):void 0;(!r||r.winningSide!==void 0)&&(r={setNumber:this.state.score.sets.length+1,side1Score:0,side2Score:0},this.state.score.sets.push(r)),e===0?r.side1Score=(r.side1Score||0)+1:r.side2Score=(r.side2Score||0)+1,i&&(r.side1TiebreakScore=i[0],r.side2TiebreakScore=i[1]),this.state.matchUpStatus==="TO_BE_PLAYED"&&(this.state.matchUpStatus="IN_PROGRESS"),this.checkSetCompletion(r),r.winningSide!==void 0&&this.checkMatchCompletion()}applySubstitution(t){let e=this.state.sides.find(r=>r.sideNumber===t.sideNumber);if(!e?.lineUp)return;let i=e.lineUp.findIndex(r=>r.participantId===t.outParticipantId);i!==-1&&(e.lineUp[i]={...e.lineUp[i],participantId:t.inParticipantId},this.state.history??={points:[]},this.state.history.substitutions??=[],this.state.history.substitutions.push(t))}applyEndSegment(t){let e=(t?.setNumber??this.state.score.sets.length)-1,i=this.state.score.sets[e];if(!i||i.winningSide!==void 0)return;let r=i.side1Score||0,n=i.side2Score||0;r>n?i.winningSide=1:n>r&&(i.winningSide=2),this.checkMatchCompletion()}checkSetCompletion(t){let e=qi(this.state.matchUpFormat);if(!e)return;let i=e.exactly||e.bestOf||3,r=Math.ceil(i/2),n=[0,0];this.state.score.sets.forEach(l=>{l.winningSide===1&&n[0]++,l.winningSide===2&&n[1]++});let a=n[0]===r-1&&n[1]===r-1&&e.finalSetFormat?e.finalSetFormat:e.setFormat;if(!a)return;let s=t.side1Score||0,o=t.side2Score||0;if(a.tiebreakSet){let l=a.tiebreakSet.tiebreakTo||11,u=a.tiebreakSet.NoAD?1:2;(s>=l||o>=l)&&Math.abs(s-o)>=u&&(t.winningSide=s>o?1:2)}else if(!a.timed){let l=a.setTo||6,u=(typeof a.tiebreakAt=="number"?a.tiebreakAt:void 0)??l,c=a.noTiebreak||!1,d=a.winBy||2;(!c&&t.side1TiebreakScore!==void 0&&(s===u+1||o===u+1)||(s>=l||o>=l)&&Math.abs(s-o)>=d)&&(t.winningSide=s>o?1:2)}}checkMatchCompletion(){let t=qi(this.state.matchUpFormat);if(!t)return;let e=t.exactly||t.bestOf||3,i=Math.ceil(e/2),r=NV(t),n=t.exactly;if(r){let a=n||e;if(this.state.score.sets.filter(s=>s.winningSide!==void 0).length>=a){let s=this.state.score.sets.reduce((o,l)=>(l.side1TiebreakScore===void 0?(o[0]+=l.side1Score??0,o[1]+=l.side2Score??0):(o[0]+=l.side1TiebreakScore,o[1]+=l.side2TiebreakScore??0),o),[0,0]);s[0]!==s[1]&&(this.state.matchUpStatus="COMPLETED",this.state.winningSide=s[0]>s[1]?1:2,this.state.endTime=new Date().toISOString())}}else{let a=[0,0];if(this.state.score.sets.forEach(s=>{s.winningSide===1&&a[0]++,s.winningSide===2&&a[1]++}),(a[0]>=i||a[1]>=i)&&(!n||this.state.score.sets.filter(s=>s.winningSide!==void 0).length>=n)){let s=a[0]>=i?0:1;this.state.matchUpStatus="COMPLETED",this.state.winningSide=s+1,this.state.endTime=new Date().toISOString()}}}rebuildFromEntries(){let t=this.state.history?.entries||[],e=this.getInitialLineUps(),i=ad({matchUpFormat:this.matchUpFormat,matchUpId:this.matchUpId,isDoubles:this.isDoubles});if(e)for(let r of i.sides)e[r.sideNumber]&&(r.lineUp=e[r.sideNumber].map(n=>({...n})));this.initialScore&&(this.applyInitialScore(i,this.initialScore),i.matchUpStatus==="TO_BE_PLAYED"&&(i.matchUpStatus="IN_PROGRESS")),i.history={points:[],entries:[...t]},this.state=i;for(let r of t)switch(r.type){case"point":this.state=wp(this.state,r.data,{pointMultipliers:this.pointMultipliers}),this.state.history.entries=i.history.entries;break;case"set":this.applyAddSet(r.data);break;case"game":this.applyAddGame(r.data);break;case"endSegment":this.applyEndSegment(r.data);break;case"substitution":this.applySubstitution(r.data);break}}rebuildState(){let t=this.state.history?.points||[],e=ad({matchUpFormat:this.matchUpFormat,matchUpId:this.matchUpId,isDoubles:this.isDoubles});this.initialScore&&(this.applyInitialScore(e,this.initialScore),e.matchUpStatus==="TO_BE_PLAYED"&&(e.matchUpStatus="IN_PROGRESS"));for(let i of t)e=wp(e,{winner:i.winner,server:i.server,timestamp:i.timestamp,rallyLength:i.rallyLength,result:i.result},{pointMultipliers:this.pointMultipliers});this.state=e}applyInitialScore(t,e){t.score.sets=[];for(let i=0;i<e.sets.length;i++){let r=e.sets[i],n={setNumber:i+1,side1Score:r.side1Score,side2Score:r.side2Score};r.side1TiebreakScore!==void 0&&(n.side1TiebreakScore=r.side1TiebreakScore),r.side2TiebreakScore!==void 0&&(n.side2TiebreakScore=r.side2TiebreakScore),r.winningSide!==void 0?n.winningSide=r.winningSide:r.side1Score>r.side2Score?n.winningSide=1:r.side2Score>r.side1Score&&(n.winningSide=2),t.score.sets.push(n)}if(e.currentSetScore){let i={setNumber:t.score.sets.length+1,side1Score:e.currentSetScore.side1Score,side2Score:e.currentSetScore.side2Score,side1GameScores:[],side2GameScores:[]};e.currentGameScore?(i.side1GameScores=[e.currentGameScore.side1Points],i.side2GameScores=[e.currentGameScore.side2Points]):(i.side1GameScores=[0],i.side2GameScores=[0]),t.score.sets.push(i)}}},Poe={};dt(Poe,{addPoint:()=>wp,calculatePointsTo:()=>SN,createMatchUp:()=>ad,inferServeSide:()=>AV,resolvePointValue:()=>kV});var Eoe={};dt(Eoe,{keyValueScore:()=>Yoe,parseMatchUpFormat:()=>qi,stringifyMatchUpFormat:()=>DM,tidyScore:()=>Qoe});var yVe="COMPLETED",bVe="WO/WO",Roe=["RET","DEF","WO",bVe,"ABN","SUS","INT"],jx="DEFAULTED",Coe="WALKOVER",Moe="ABANDONED",Noe="SUSPENDED",Aoe="RETIRED",koe="INTERRUPTED",wVe=[Aoe,jx,Coe],SVe="Enter Score",Xm="()",Xp="[]",GV=["up","left","shift+tab"],HV=["enter","down","tab","right"],iE="backspace",Ooe="r",xoe="s",Foe="a",Loe="d",_oe="w",$oe="i",TN=[Ooe,Loe,_oe,Foe,xoe,$oe],DN="space",mk=["[","("],rE=[...GV,...HV,DN,"]"],Boe="-",UVe="/",ym=Boe,Ql=Boe,Voe=[UVe],TVe=0,DVe=["=","+","num_1","num_2","shift+=","shift+-"],WV=["0","1","2","3","4","5","6","7","8","9"].concat(TN),joe=WV.map(t=>`shift+${t}`),Goe=[ym,iE].concat(rE,Voe),Hoe=[WV,joe,Goe].join(","),PVe=[Hoe,GV,HV,DVe].join(","),EVe={OUTCOMEKEYS:TN,SIDE1KEYS:WV,SIDE2KEYS:joe,MODIFIERS:Goe,PROMPT:SVe,MOVEUP:GV,MOVEDOWN:HV,HOTKEYS:PVe};function pg({scoreString:t,lowSide:e,outcome:i}){if({scoreString:t}=Woe({scoreString:t}),e===2){let r=(t&&t[t.length-1])!==" "?" ":"";return t+r+i}else return i+" "+t}function Woe({scoreString:t}){if(!t)return{scoreString:""};let e=!1;for(let i of Roe){let r=t?.indexOf(i);r===0?t=t.slice(i.length+1).trim()+" ":r>0&&(t=t.slice(0,r)),r>=0&&(e=!0)}return t?.trim()||(t=""),{scoreString:t,removed:e}}function Gx({analysis:t,scoreString:e,sets:i,lowSide:r}){let n,a;if(!e)return{scoreString:e,sets:i};let{scoreString:s,removed:o}=Woe({scoreString:e});if(e=s,o)return{scoreString:e,sets:i,outcomeRemoved:!0};let l=i[i.length-1]||{},u=Object.values(l).filter(h=>h!==void 0).length;l.setNumber&&u===1&&(i=i.slice(0,i.length-1),l=i[i.length-1]||{});let{tiebreakSet:c}=t.setFormat,{tiebreakTo:d,NoAD:p}=c||{},{isTiebreakEntry:f}=Wg({brackets:Xp,scoreString:e}),m=CVe(e);if(m>=0){n=e.slice(0,m);let{isTiebreakEntry:h}=Wg({brackets:Xm,scoreString:n}),{lastOpenBracketIndex:g,isTiebreakEntry:I}=Wg({brackets:Xp,scoreString:n}),v=n&&n[n.length-1].trim(),w=n&&!isNaN(v),y=t.isIncompleteSetScore;if(f&&I){let b=n.slice(g+1).split(Ql),S=b?.length>0&&b[0]!==void 0&&!isNaN(parseInt(b[0]))&&parseInt(b[0])||void 0,U=b?.length>1&&b[1]!==void 0&&parseInt(b[1])||void 0,T=[S,U];if(U){let P=r===1?1:0;T[P]=(T?.[1-P]||0)+(p?1:2),(T[P]||0)<d&&(T[P]=d),n=e.slice(0,g+1),n+=T.join(Ql)}else S!==void 0?(n=e.slice(0,g+1),n+=S):(n=e.slice(0,g),y=!0);l.side1TiebreakScore=T[0]||0,l.side2TiebreakScore=T[1]||0}if(n.length||(n=void 0),y){let b=l.side1Score?.toString();if(b){let S=b?.slice(0,b.length-1);l.side1Score=!isNaN(S)&&parseInt(S)||void 0,l.side1Score===void 0&&(l.side2Score=void 0)}t.isTimedSet?(a=l.side1Score?i:i?.slice(0,i.length-1)||[],a[i.length-1]=l):a=i?.slice(0,i.length-1)||[]}else if(w){let b=l.side2Score?.toString(),S=l.side1Score?.toString();if(!t.isTiebreakEntry&&!t.isMatchTiebreak)if(l.side2Score){let U=b?.slice(0,b.length-1);l.side2Score=!isNaN(U)&&parseInt(U)||void 0}else{let U=S?.slice(0,S.length-1);l.side1Score=!isNaN(U)&&parseInt(U)||void 0}t.isTimedSet?l.side1Score?(a=i||[],a[i.length-1]=l):a=i?.slice(0,i.length-1)||[]:(a=i||[],a[i.length-1]=l),a[a.length-1]&&Object.assign(a[a.length-1],{winningSide:void 0})}else h?(a=i||[],Object.assign(a[a.length-1]||{},{winningSide:void 0,side1TiebreakScore:void 0,side2TiebreakScore:void 0})):(f&&!I?a=i?.slice(0,i.length-1)||[]:(a=i,a[i.length-1]=l),f||(a[a.length-1].side2Score=0,a[a.length-1].winningSide=void 0));return{scoreString:n,sets:a}}return{scoreString:e,sets:i}}function Wg({brackets:t=Xm,scoreString:e}){if(!e)return{};let[i,r]=t.split(""),n=e.split(""),a=Math.max(...Xo(i,n)),s=Math.max(...Xo(r,n));return{isTiebreakEntry:a>s,lastOpenBracketIndex:a}}function RVe({scoreString:t}){if(!t)return!1;let e=t&&t[t.length-1].trim(),i=t&&!isNaN(e),[r,n]=Xp.split(""),a=t.split(""),s=Math.max(...Xo(r,a)),o=Math.max(...Xo(n,a)),l=Math.max(...Xo(Ql,a));return i&&s>o&&l>s}function CVe(t){return t.split("").reduce((e,i,r)=>(i.match(/\d+/g)&&e.push(r),e),[]).pop()}function zoe(t){let{lowValue:e=0,NoAD:i=!1,tiebreakTo:r}=t||{},n=i?1:2;return e+1>=r?e+n:parseInt(r)}function Eq({matchUpFormat:t,matchUpStatus:e,winningSide:i,sets:r}){let n=qi(t),{bestOf:a}=n,s=Math.ceil(a/2),o=r?.reduce((l,u)=>{let{winningSide:c}=u;return c&&l[c-1]++,l},[0,0])?.indexOf(s)+1||void 0;return wVe.includes(e)&&i&&(o=i),{matchUpWinningSide:o}}function PN({ignoreTiebreak:t=!1,matchUpScoringFormat:e,matchUpFormat:i,isTiebreakSet:r,isDecidingSet:n,isTimedSet:a,set:s}){if(!s)return{error:Je,info:"missing set"};e=e||i&&qi(i);let o=n&&e.finalSetFormat||e?.setFormat||{},{side1Score:l,side2Score:u}=s,{setTo:c,tiebreakAt:d}=o,p=l||u,f=EN({set:s}),m=Math.abs(l-u),h=l>=c||u>=c,g=r||l>=c&&u>=c||d&&d<c&&(l===d||u===d),I=t||g&&(f===1&&s.side1TiebreakScore>s.side2TiebreakScore||f===2&&s.side2TiebreakScore>s.side1TiebreakScore),v=!g&&o.NoAD||g||r&&o.tiebreakFormat?.NoAD?1:2,w=m>=v;return!!((a&&p||h&&(w||g)||r)&&(!g||I))}function EN({set:t}){if(t.side1Score||t.side2Score){if(t.side1Score>t.side2Score)return 1;if(t.side2Score>t.side1Score)return 2}else if(t.side1TiebreakScore||t.side2TiebreakScore){if(t.side1TiebreakScore>t.side2TiebreakScore)return 1;if(t.side2TiebreakScore>t.side1TiebreakScore)return 2}}function zV({analysis:t,set:e}){let i=EN({set:e}),{isDecidingSet:r,isTiebreakSet:n,matchUpScoringFormat:a}=t;return PN({matchUpScoringFormat:a,isDecidingSet:r,isTiebreakSet:n,set:e})&&i}function MVe({analysis:t,scoreString:e,sets:i,value:r}){let n;if(!i?.length)return{sets:[]};let a=i[i.length-1];r=Ke(r);let{validSide2Score:s,requiresTiebreak:o}=NVe({analysis:t,set:a,value:r});if(s){n=!0,e=(e||"")+r,a.side2Score=r;let l=zV({analysis:t,set:i[i.length-1]});if(a.winningSide=l||void 0,o){let u=Xm.split("")[0];e+=u}else t.isDecidingSet||(e+=" ")}return{sets:i,scoreString:e,updated:n}}function NVe({analysis:t,set:e={},value:i}){let r=t.isDecidingSet&&t.matchUpScoringFormat.finalSetFormat||t.matchUpScoringFormat.setFormat,{tiebreakAt:n,setTo:a,NoAD:s}=r,{side1Score:o}=e,l,u;return n&&n<a?o===n?l=i<=a:l=i<=n:o===a?s?l=i<a:l=i<=a+1:o===a-1?s?l=i<=a:l=i<=a+1:o===a+1?l=i===a||i===a-1:l=i<=a,l&&(n&&n<a?u=o===a&&i===n||o===n&&i===a:u=o>=a&&i>=a&&o!==i),{validSide2Score:l,requiresTiebreak:u}}function qoe({lowSide:t,value:e,sets:i,scoreString:r,winningSide:n,matchUpStatus:a}){let s;return e===Ooe?r?(s=!0,r=pg({scoreString:r,lowSide:t,outcome:"RET"}),n=t===2?1:2,a=Aoe):(s=!0,r=pg({scoreString:r,lowSide:t,outcome:"DEF"}),n=t===2?1:2,a=jx):e===Loe?(s=!0,r=pg({scoreString:r,lowSide:t,outcome:"DEF"}),n=t===2?1:2,a=jx):e===_oe?(s=!0,i=[],r="WO",n=t===2?1:2,a=Coe):e===xoe&&r?(s=!0,r=pg({scoreString:r,lowSide:t,outcome:"SUS"}),a=Noe,n=void 0):e===Foe?(s=!0,r=pg({scoreString:r,lowSide:t,outcome:"ABN"}),a=Moe,n=void 0):e===$oe&&r&&(s=!0,r=pg({scoreString:r,lowSide:t,outcome:"INT"}),a=koe,n=void 0),{updated:s,sets:i,scoreString:r,matchUpStatus:a,winningSide:n}}function AVe(t){let{sets:e,info:i,scoreString:r,winningSide:n,matchUpStatus:a}=t,{analysis:s,lowSide:o,value:l}=t,u,c;!e?.length&&l!==iE&&(e=[{setNumber:1}]);let d=e.length-1;if(TN.includes(l)){let p=e[e.length-1]||{},{side1Score:f,side2Score:m}=p;f&&!m?i="missing side2Score":s.finalSetIsComplete||n?i="final set is already complete":s.isIncompleteSetScore?i="incomplete set scoreString":s.isIncompleteSetScore||({sets:e,scoreString:r,winningSide:n,matchUpStatus:a,updated:u}=qoe({lowSide:o,value:l,sets:e,scoreString:r,matchUpStatus:a,winningSide:n}))}else if(l===iE){if({scoreString:r,sets:e,outcomeRemoved:c}=Gx({analysis:s,scoreString:r,sets:e}),r?.trim()===""&&(r=r.trim()),r||(e=[]),c){let p=e[e.length-1]||{},{side1Score:f,side2Score:m}=p;if(f&&m){let h=f>m&&1||m>f&&2||void 0;h&&(p.winningSide=h,e.push({setNumber:e.length+1}))}}a=void 0,n=void 0,u=!0}else if(s.hasOutcome)i="has outcome";else{if(n)return{sets:e,scoreString:r,winningSide:n,matchUpStatus:a,updated:!1,info:"matchUp is complete"};if(l===DN){let p=e[e.length-1]||{},{side1Score:f,side2Score:m}=p,h=f>m&&1||m>f&&2||void 0;h&&!n&&!s.isIncompleteSetScore&&(e[e.length-1].winningSide=h,e.push({setNumber:e.length+1}),r+=" ",u=!0)}else if(l===ym&&e[d].side1Score!==void 0&&e[d].side2Score===void 0&&r&&s.isNumericEnding)r+="-",e[d].side2Score=0,a=void 0,n=void 0,u=!0;else if(!isNaN(l)){let p;if(e[d].side2Score===void 0){let f=Ke((e[d].side1Score||0).toString()+l).toString().slice(0,2);e[d].side1Score=Ke(f),p=e[d].side1Score.toString(),u=!0}else{let f=Ke((e[d].side2Score||0).toString()+l).toString().slice(0,2);e[d].side2Score=Ke(f),p=[e[d].side1Score,e[d].side2Score].join("-"),u=!0}if(u){let f=(e.slice(0,d)||[]).filter(m=>m).map(m=>{let{side1Score:h,side2Score:g}=m;return[h,g].join("-")}).join(" ");f?r=f+" "+p:r=p}}}return{sets:e,scoreString:r,winningSide:n,matchUpStatus:a,info:i,updated:u}}function kVe({analysis:t,auto:e,lowSide:i,scoreString:r="",sets:n,value:a}){let s,o,{tiebreakSet:{tiebreakTo:l,NoAD:u}}=t.setFormat,[c]=Xp.split("");if(t.isMatchTiebreakEntry||(r+=c),n[t.setNumber-1]){let{lastOpenBracketIndex:d}=Wg({brackets:Xp,scoreString:r}),p=(r.slice((d??0)+1)+(e?"":a)).split(Ql);if((p[i-1]?.length||0)>=2)o="tiebreak digit limit";else if(e){i===1&&(p[0]=(p[0]||"")+a),i===2&&(p[1]=(p[1]||"")+a);let f=[p[0]||0,p[1]||0].map(g=>Ke(g)),m=i===1?1:0;f[m]=f[1-m]+(u?1:2),f[m]<l&&(f[m]=l);let h=n[n.length-1];h.side1TiebreakScore=f[0],h.side2TiebreakScore=f[1],r=r.slice(0,(d??0)+1),r+=f.join(Ql),s=!0}else{let f=[p[0]||0,p[1]||0].map(h=>Ke(h)),m=n[n.length-1];m.side1TiebreakScore=f[0],m.side2TiebreakScore=f[1],r+=a,s=!0}}else{let d=zoe({lowValue:Ke(a||0),tiebreakTo:l,NoAD:u}),p=[Ke(a),d];i===2&&p.reverse();let f={side1TiebreakScore:p[0],side2TiebreakScore:p[1],setNumber:n?.length+1||1};n.push(f),r+=p.join(Ql),s=!0}return{info:o,scoreString:r,sets:n,updated:s}}function OVe({analysis:t,lowSide:e,scoreString:i,value:r}){let{setTo:n,tiebreakAt:a,NoAD:s}=t?.setFormat||{},o=r===parseInt(a||n);if(a&&a<n&&r>a)return{scoreString:i};if(s&&r===n||r>n)return{scoreString:i};let l=m(),u=[r,l];e===2&&u.reverse();let c=Xm.split("")[0],d=u.join(ym)+(o?c:" ");i=(i||"")+d;let p={side1Score:u[0],side2Score:u[1]},f=zV({analysis:t,set:p});return p.winningSide=f||void 0,{scoreString:i,set:p};function m(){return o?r+1:r+1===n?r+(s?1:2):n}}function xVe({matchUpFormat:t,scoreString:e,winningSide:i,value:r,sets:n}){let a=(n?.filter(F=>F?.winningSide)?.length||0)+(i?0:1),s=qi(t),o=a===s?.bestOf,l=o&&s?.finalSetFormat||s?.setFormat||{},u=l?.timed,c=o&&n[s?.bestOf-1],d=c?.winningSide,{isTiebreakEntry:p}=Wg({brackets:Xm,scoreString:e}),{isTiebreakEntry:f}=Wg({brackets:Xp,scoreString:e}),m=p||f,h=!!l.tiebreakSet,g=e?.[e.length-1]?.trim(),I=e&&!isNaN(g),v=!m&&g===ym,w=p&&mk.includes(g),y=f&&mk.includes(g),b=f&&g===Ql,S=e?.split(""),[U]=Xp.split(""),T=S&&Math.max(...Xo(U,S)),P=S&&Math.max(...Xo(Ql,S)),D=S&&P>T,E=n[n.length-1]?.winningSide,R=n?.length&&!E,C=Roe.find(F=>e?.indexOf(F)>=0),M=!isNaN(r),N=r===DN,A=rE.includes(r),O=e?.split("").find(F=>mk.includes(F)),k=A&&f&&!y&&(b||!RVe({scoreString:e}));return{isTiebreakSetValue:h&&M,matchUpScoringFormat:s,setNumber:a,setFormat:l,matchTiebreakHasJoiner:D,isGameScoreEntry:R,isSpace:N,isCloser:A,isTiebreakCloser:A&&O&&m&&I,isDecidingSet:o,isTiebreakSet:h,isTimedSet:u,isNumericEnding:I,isNumericValue:M,hasOpener:O,hasOutcome:C,finalSet:c,finalSetIsComplete:d,lastSetIsComplete:E,isInvalidSetTiebreakValue:N&&m&&w,isInvalidMatchTiebreakValue:k,isTiebreakEntry:m,isSetTiebreakEntry:p,isMatchTiebreakEntry:f,isIncompleteSetScore:v,isIncompleteSetTiebreak:w,isIncompleteMatchTiebreak:y,isPartialMatchTiebreakValue:b}}function Yoe(t){let{lowSide:e=1,value:i}=t,{scoreString:r,sets:n,winningSide:a,matchUpStatus:s}=t,{matchUpFormat:o,shiftFirst:l,auto:u=!0}=t,c,d,p=l&&e===2||!l&&e===1;if(!Hoe.includes(i))return{updated:!1,info:"invalid key"};l&&(e=3-e);let{matchUpWinningSide:f}=Eq({sets:n,winningSide:a,matchUpStatus:s,matchUpFormat:o});a=f;let m=xVe({value:i,winningSide:a,scoreString:r,sets:n,matchUpFormat:o});if(Voe.includes(i)&&(i=ym),m.hasOpener&&m.isTiebreakEntry&&!m.isTiebreakSet&&p&&Ke(i)===0&&(m.isTiebreakCloser=!0),rE.includes(i)&&m.hasOpener&&(i=""),rE.includes(i)&&(i=DN),m.lastSetIsComplete){let h=r?.length&&r[r.length-1];r&&h!==" "&&(r+=" ")}if(m.isTimedSet)({info:d,sets:n,scoreString:r,updated:c,matchUpStatus:s,winningSide:a}=AVe({analysis:m,lowSide:e,scoreString:r,sets:n,matchUpStatus:s,winningSide:a,value:i}));else if(TN.includes(i))m.finalSetIsComplete||a?d="final set is already complete":!m.isTiebreakEntry&&!m.isIncompleteSetScore?{sets:n,scoreString:r,matchUpStatus:s,winningSide:a,updated:c}=qoe({lowSide:e,sets:n,scoreString:r,matchUpStatus:s,winningSide:a,value:i}):m.isTiebreakEntry||m.isIncompleteSetScore?d="incomplete set scoreString or tiebreak entry":console.log("handle case",{value:i});else if(i===iE)c=!0,{scoreString:r,sets:n}=Gx({analysis:m,scoreString:r,sets:n,lowSide:e}),r||(n=[]),s=void 0,a=void 0;else if(m.hasOutcome)d="has outcome";else if(i===ym&&!m.isMatchTiebreakEntry)(!m.isSetTiebreakEntry||m.isSetTiebreakEntry&&!m.isNumericEnding)&&(c=!0,{scoreString:r,sets:n}=Gx({analysis:m,scoreString:r,sets:n,lowSide:e}),s=void 0);else if(i===Ql&&m.isMatchTiebreakEntry&&!m.isSetTiebreakEntry)m.matchTiebreakHasJoiner?d="existing joiner":m.isNumericEnding&&(c=!0,r+=Ql);else if([ym,Ql].includes(i))d="invalid location for joiner";else{if(a)return{updated:!1,info:"matchUp is complete"};if(m.isIncompleteSetScore)m.isNumericValue&&({sets:n,scoreString:r,updated:c}=MVe({analysis:m,scoreString:r,sets:n,value:i}));else if(m.isInvalidMatchTiebreakValue)d="invalid matchUp tiebreak character";else if(m.isInvalidSetTiebreakValue)d="invalid set tiebreak character";else if(m.isTiebreakCloser){let h=m.isSetTiebreakEntry?Xm:Xp,g=h.split("").reverse()[0],I=h.split("")[0],v=n[n.length-1],{tiebreakFormat:w}=m.setFormat,{tiebreakTo:y,NoAD:b}=w||{},S=EN({set:v});if(!m.isTiebreakSet){let T=Number.parseInt(r.split(I).reverse()[0]),P=zoe({lowValue:T,tiebreakTo:y,NoAD:b});S===1?(v.side1TiebreakScore=P,v.side2TiebreakScore=T):(v.side1TiebreakScore=T,v.side2TiebreakScore=P)}r=(r||"")+g,m.isDecidingSet||(r+=" ");let U=zV({analysis:m,set:v});v.winningSide=U||void 0,c=!0}else if(m.isTiebreakSetValue)({info:d,scoreString:r,sets:n,updated:c}=kVe({analysis:m,auto:u,lowSide:e,scoreString:r,sets:n,value:i}));else if(m.isSetTiebreakEntry){let[h]=Xm.split(""),g=Math.max(...Xo(h,r.split(""))),I=r.slice(g+1),v=I&&Ke(I)===TVe,w=Ke(I?I+i:i),{tiebreakFormat:y}=m.setFormat,{tiebreakTo:b,NoAD:S}=y||{};!v&&I.length<2?S&&w>b-1?d="invalid low value for NoAD tiebreak":(c=!0,r=(r||"")+i):d=v?"tiebreak begins with zero":"tiebreak digit limit"}else if(m.isCloser)d=`invalid key: ${i}`;else if(m.isGameScoreEntry)d="game scoreString entry";else if(m.lastSetIsComplete||!n.length){c=!0;let{scoreString:h,set:g}=OVe({analysis:m,lowSide:e,scoreString:r,value:Ke(i)});g&&(g.setNumber=n?.length+1||1),n=n?.concat(g).filter(Boolean)||[g],r=h||void 0}else console.log("error: unknown outcome")}if(c){n=n?.filter(Boolean);let{matchUpWinningSide:h}=Eq({sets:n,winningSide:a,matchUpStatus:s,matchUpFormat:o});return a=h,h&&(!s||[_i,Da].includes(s))?(s=yVe,n=n.filter(g=>{let{side1Score:I,side2Score:v,side1TiebreakScore:w,side2TiebreakScore:y}=g;return I||v||w||y})):r&&!a&&![Noe,Moe,koe].includes(s)&&(s=void 0),{updated:c,scoreString:r,sets:n,winningSide:a,matchUpStatus:s,info:d}}return{updated:c,scoreString:r,sets:n,winningSide:a,matchUpStatus:s,info:d}}var RN="\\d+-\\d+",sw="\\d+-\\d+\\(\\d+\\)",qV="\\[\\d+-\\d+\\]",FVe="\\d+-\\d+\\(\\d+-\\d+\\)",LVe=new RegExp(`(${RN}),`,"g"),_Ve=new RegExp(`(${sw}),`,"g"),$Ve=[RN,sw,qV,FVe],BVe=["0","1","2","00","01","10","11","002","012","102","112","000","001","010","100","011","101","110","111","002","012","102","112","0002","0012","0102","1002","0112","1012","1102","1112","3","03","13","013","103"],VVe=BVe.map(t=>{let e=t.split("").map(i=>$Ve[i]).join(" ");return new RegExp(`^${e}$`)});function Rq(t){return!t||VVe.some(e=>e.test(t))}function jVe(t){let e="[];()",i=["[","("],r=Object.assign({},...e.split("").map(s=>({[s]:0}))),n="",a=t.split("").map(s=>{let o=e.includes(s)&&s,l=i.includes(o);if(l&&o)return r[o]+=1,n=o,s;if(!l&&o&&n&&o!==n){r[n]-=1;let u="[];".includes(n)&&"[];"||"()".includes(n)&&"()"||"",c=u.split("").find(d=>d!==n);if(u.includes(o))r[n]||(n="");else return r[o]||(n=""),c}return s}).join("");return t!==a?a:t}function wD(t){return/^\(\d+\)$/.test(t)||/^\(\d+$/.test(t)}function GVe(t){return/^\(\d+-\d+\)$/.test(t)||/^\[\d+-\d+\]$/.test(t)}function xI(t){let e=(i=>i?.split("-").join("").split("/").join(""))(t);if(/^\d+$/.test(e)&&e.length===2){let i=e.split("");return Math.abs(i.reduce((r,n)=>+r-+n))===1}return!1}function nE(t,e){let i=[t.slice(e,e+2),e?t.slice(0,1):t.slice(2)].map(n=>parseInt(n.join("")));e&&i.reverse();let r=i;if(Math.abs(r.reduce((n,a)=>+n-+a))>=2)return r.join("-")}function Cq(t){return t.length===2?t.split("").join("-"):([", ",",","/"," "].forEach(e=>t=t.split(e).join("-")),t=t.replace(/-{2,}/,"-"),t)}function HVe(t){return t.startsWith("(")&&t.endsWith(")")}function WVe({score:t,applied:e}){t=jVe(t);let i=/\)(\d+)/g;if(i.test(t))for(let S of t.match(i)){let U=S.replace(")",") ");t=t.replace(S,U)}t=t.replace(/\)\//g,") / "),t=t.replace(/\/\)/g,")");let r=/\(([\d- ]+)\)/g,n=/\(([\d- ]+)\)/,a=t.match(r);for(let S of a||[]){let[U]=S.match(n).slice(1),T=U.replace(/ /g,"");t=t.replace(S,`(${T})`)}let s=/\(\(\d-\d\)\)/g;if(s.test(t)){let S=t.match(s);S.length&&S.forEach(U=>{let T=U.match(/\((\(\d-\d\))\)/).slice(1)[0];t=t.replace(U,T)})}if(s=/\(\((\d)\)\)/g,s.test(t)){let S=t.match(s);S.length&&S.forEach(U=>{let T=U.match(/\((\(\d\))\)/).slice(1)[0];t=t.replace(U,T)})}/(^|\s)6-,/.test(t)&&(t=t.replace(/(^|\s)6-,/g,"6-0,"));let o=new RegExp(/[-,]{2,}/g);t=t.replace(o,"-"),["- "," -"].forEach(S=>{let U=new RegExp(`(\\d+)${S}(\\d+)`,"g"),T=t.match(U);T&&T.forEach(P=>t=t.replace(P,P.split(S).join("-")))}),/^[(-/,]+$/.test(t)&&(t=""),/\)[-/,]+$/.test(t)&&(t=t.slice(0,t.length-1)),/\d \/\d/.test(t)&&(t=t.replace(/ \//g,"/")),t.includes(" /")&&(t=t.replace(/ \//g," "));let l=/\(\d+, \)/g;l.test(t)&&t.match(l).forEach(S=>{let[U]=S.match(/\((\d+), \)/).slice(1);U.length===2?t=t.replace(S,`(${U})`):U.length===1&&U==="6"&&(t=t.replace(S,"(6-0)"))});let u=/\((\d+)\/\)/g;u.test(t)&&t.match(u).forEach(S=>{let[U]=S.match(/\((\d+)\/\)/).slice(1);U.length===2?t=t.replace(S,`(${U})`):U.length===1&&U==="6"?t=t.replace(S,"(6-0)"):t=t.replace(S,`(${U})`)});let c=/\d\/\d\/,/g;c.test(t)&&t.match(c).forEach(S=>{let[U]=S.match(/(\d\/\d)\/,/).slice(1);t=t.replace(S,`${U},`),e.push("slashComma")});let d=/\(\/(\d+)\)/g;d.test(t)&&t.match(d).forEach(S=>{let[U]=S.match(/\(\/(\d+)\)/).slice(1);U.length===2?t=t.replace(S,`(${U})`):U.length===1&&parseInt(U)<6?t=t.replace(S,`(6-${U})`):t=t.replace(S,`(${U})`)});let p,f,m,h,g,I=()=>{g=Sa(t.split("")),f=g["("]===(g[")"]||0)+1,p=(g["("]||0)+1===g[")"],m=g["["]===g["]"]+1,h=f&&!m};I();let v=/(\d+-\d+\(\d+)0,/;if(v.test(t)){let[S]=t.match(v).slice(1);t=t.replace(v,S+")")}if(g["("]===g[")"]&&g["("]>1){let S=t.split(")(").join(") (").split(" ");S.every(HVe)?t=S.map(U=>{let T=U.slice(1,U.length-1);return T.length>2?T:U}).join(" "):t=S.join(" ")}I();let w=/[A-Za-z]+/.test(t),y=/\d+/.test(t);if(!w&&!y)return{score:""};if(/^\[.+\]$/.test(t)&&"()/,- ".split("").some(S=>g[S])&&(t=t.slice(1,t.length-1)),/^\(.+\)$/.test(t)&&g["("]===1&&g[")"]===1&&"[]/,".split("").some(S=>g[S]>1)&&(t=t.slice(1,t.length-1)),t.startsWith("(")&&t.endsWith("))")&&(t=t.slice(1,t.length-1)),g["("]>(g[")"]||0)&&t[t.length-1]==="("&&(t=t.slice(0,t.length-1)+")",I()),g["("]===1&&!g[")"]&&t[0]==="("&&(t=t+")",I()),g["("]>(g[")"]||0)&&t.slice(0,2)==="(("&&(t=t.slice(1)),p){if(/^9\d/.test(t))t="("+t.slice(1);else if(t[0]!=="(")t="("+t;else{let S=[],U=0;for(let T of t.split("").reverse())T===")"&&(U?S.push("("):U+=1),T==="("&&(U-=1),S.push(T);S.reverse(),t=S.join("")}I()}if(g[")"]>(g["("]||0)&&t[0]===")"&&(t="("+t.slice(1),I()),h&&(t.endsWith(9)||/\d+0$/.test(t))&&(t=t.slice(0,t.length-1)+")",I()),h&&(!t.endsWith(")")||t.startsWith("(("))&&(t=t+")",I()),h){let S="",U=0;for(let T of t.split(""))T==="("&&(U?S+=")":U+=1),T===")"&&(U-=1),S+=T;t=S}I(),m&&!f&&(t=t+"]"),t.includes("([")&&t.includes("])")&&(t=t.split("([").join("[").split("])").join("]"),I()),/\(\d+0$/.test(t)&&(t=t.slice(0,t.length-1)+")"),I(),g[")"]===1&&!g["("]&&t.endsWith(")")&&(t=t.slice(0,t.length-1)),t.startsWith("(")&&t.endsWith(")")&&g["("]===1&&g[")"]===1&&(t=t.slice(1,t.length-1),I());let b=S=>{let U=S.indexOf("("),T=S.indexOf(")");return U>=0&&T>=0&&U<T};if(/^\([\d ]+.*[\d ]+\)$/.test(t)&&g["("]===g[")"]){let S=t.slice(1,t.length-1);b(S)&&(t=S,I())}return{score:t,applied:e}}function CN(t){if(!/^[\d-]+(\(\d\))*$/.test(t))return t;let e=Xo("-",t.split(""));if(!e.length)return t;let i=t.split("-"),r=!(i.length%2),n=!!(e.length%2);return r&&n&&e.length>i.length/2&&e.filter((a,s)=>s%2).forEach(a=>{t=t.substring(0,a)+" "+t.substring(a+1)}),t}function zVe({score:t,applied:e}){return t.includes("( ")&&(e.push("removeParenSpacingAfterOpen"),t=t.split("( ").map(i=>i.trim()).join("(")),t.includes(" )")&&(e.push("removeParenSpacingBeforeClose"),t=t.split(" )").map(i=>i.trim()).join(")")),[LVe,_Ve].forEach(i=>{let r=t.match(i);r?.length&&(r.forEach(n=>{t=t.replace(n,n.slice(0,n.length-1)+" ")}),e.push("setsEndComma"))}),t=t.split(" ").filter(Boolean).map(CN).join(" "),{score:t,applied:e}}function qVe({score:t}){if(typeof t!="string")return{score:t};let e=p=>p?.split("-").join("").split("/").join(""),i=p=>p.split("[").join("(").split("]").join(")");t=t.split(", ").join(" ");let r=t.split(" ");t=r.map(p=>{let f=/^-(\d+)$/;if(f.test(p)){let[m]=p.match(f).slice(1);if(m.length===2)return m.split("").join("-")}return p}).join(" "),r=t.split(" ");let n=r.filter(wD),a=0,s="";for(let p of n){let f=Xo(p,r).find(I=>!a||I>a),m=r.slice(a,f-1),h=r[f-1],g=e(h);if(/^\d+$/.test(g)&&g.length===2){let I=g.split(""),v=Math.abs(I.reduce((w,y)=>+w-+y));if(v===1){let w=[m.join(" "),[h,p].join("")].join(" ");s+=w,a=f+1}else if(v===0){let w=Math.max(...I);if([4,5,6,7,8,9].includes(w)){let y=[6,4].includes(w)?w+1:w-1,b=[w,y].sort().reverse().join("-"),S=[m.join(" "),[b,p].join("")].join(" ");s+=S,a=f+1}}}}if(n.length&&s.length){let p=r.slice(a).join(" ");return s=[s,p].join(" "),{score:s.trim()}}if(r.length===2&&["(","["].some(p=>r[1].includes(p))){let p=e(r[0]).split("");if(Math.abs(p.reduce((f,m)=>+f-+m,0))===1)return r[1]=i(r[1]),{score:r.join("")}}let o=r.map(p=>GVe(p)&&"bracket"||xI(p)&&"set");if(o.includes("set")&&o.includes("bracket")){let p,f="";return r.forEach((m,h)=>{o[h]==="bracket"&&p==="set"?(m=i(m),f+=m):f+=` ${m}`,p=o[h]}),{score:f.trim()}}r=t.split(" ");let l,u=r.map(p=>{let f=new RegExp(/^(\d+)-(\d+)$/);if(f.test(p)){let[m,h]=p.match(f).slice(1),g=Math.abs([m,h].reduce((v,w)=>+v-+w,0)),I=Math.max(m,h);if(g===1)return l="tiebreakSet",l;if(g>=2&&I>=7&&l==="tiebreakSet")return l="tiebreak",l}}),c=Xo("tiebreak",u);if(c.length){let p="";r.forEach((f,m)=>{c.includes(m)?p+=`(${f}) `:c.includes(m+1)?p+=`${f}`:p+=`${f} `}),t=p.trim()}let d=/(\d+-\d+)\((\d+)-(\d+)\)$/;if(d.test(t)){let[p,f,m]=t.match(d).slice(1),h=Math.max(f,m)>=10;!xI(p)&&h&&(t=t.replace(d,`${p} [${f}-${m}]`))}return u=[],t=t.split(" ").map(p=>{let f=/^\((.*)\)$/,m=f.test(p),h=new RegExp(qV).test(p)&&"super"||new RegExp(sw).test(p)&&"tiebreak"||new RegExp(RN).test(p)&&"standard"||"unknown";return u.push(h),h==="standard"&&m?p.match(f)[1]:p}).join(" "),{score:t}}function YVe({score:t,applied:e}){for(let T of[".",","," ","/"]){let P=new RegExp(`^(\\d+)\\${T}(\\d+)$`);if(P.test(t)){let D=t.match(P).slice(1).map(R=>parseInt(R)),E=Math.abs(D[0]-D[1]);E<=10&&E>=2&&(t=t.split(T).join("-"),e.push("variedJoinerPattern"))}}t.includes(";")&&(t=t.split(";").join(" "),e.push("semicolon set separation"));let i=/(^|\s)(\d)\/(\d)(\d)\/(\d)(\(|$)/;if(i.test(t)){let[T,P,D,E,R,C]=t.match(i).slice(1);t=t.replace(i,`${T}${P}-${D} ${E}-${R}${C}`),e.push("smashSlashPattern")}/.*\s6[/-]+$/.test(t)&&(t+="0",e.push("incompleteFinalSetPattern"));let r=/\(6,\)/g;r.test(t)&&(t=t.replace(r,"(6, 0)"),e.push("missingZeroPattern1"));let n=/^\d{3,}\(/,a=/\(\d+\)\d+/;[n,a].forEach(()=>{t=t.split(" ").map(T=>(n.test(T)&&(T=T.replace("("," (")),a.test(T)&&(T=T.replace(")",") ")),T)).join(" "),e.push("spaceConsiderationPatterns")});let s=CN(t);s!==t&&(t=s,e.push("deDashMash"));let o=/^(\d)[-/,]+(\d{2})[-/,]+(\d)$/;if(o.test(t)){let[T,P,D]=t.match(o).slice(1),[E,R]=P.split("");t=`${T}-${E} ${R}-${D}`,e.push("smashSetPattern")}let l=/^(\d+)[ -](\d+)$/,u=/^([\d -]+)\/([\d -]+)$/;if(u.test(t)){let[T,P]=t.match(u).slice(1),D=T.trim(),E=P.trim();if(l.test(D)&&l.test(E)){let R=D.match(l).slice(1,3).join("-"),C=E.match(l).slice(1,3).join("-");t=`${R} ${C}`,e.push("slashSeparationPattern")}}let c=/^([\d -]+),([\d -]+)$/;if(c.test(t)){let[T,P]=t.match(c).slice(1),D=T.trim(),E=P.trim();if(l.test(D)&&l.test(E)){let R=D.match(l).slice(1,3).join("-"),C=E.match(l).slice(1,3).join("-");t=`${R} ${C}`,e.push("commaSeparationPattern")}}let d=/^\d \d,/;if(d.test(t)){let T=t.match(d)[0],P=T.slice(0,T.length-1).split(" ").join("-");t=t.replace(T,P),e.push("singleSetCommaSeparationPattern")}let p=0,f=/(\d+)-(\d{2})-(\d+)/;for(;f.test(t)&&p<3;){let[T,P,D]=t.match(f).slice(1),E=P.split(""),R=`${T}-${E[0]} ${E[1]}-${D}`;t=t.replace(f,R),e.push("noSetSeparationPattern"),p+=1}let m=/(^|\s)7-6\s(\d+)\s/g,h=t.match(m);if(h?.length){let T=/(^|\s)7-6\s(\d+)\s/;h.forEach(P=>{let D=P.match(T).slice(2)[0];t=t.replace(P,`7-6(${D}) `),e.push("floatingTiebreakPattern1")})}let g=t.match(/\d \d /);g?.forEach(T=>{let P=T.slice(0,T.length-1).split(" ").join("-");t=t.replace(T,P),e.push("spaceSeparatedSetPattern1")}),g=t.match(/ \d \d$/),g?.forEach(T=>{let P=" "+T.slice(1).split(" ").join("-");t=t.replace(T,P),e.push("spaceSeparatedSetPattern2")});let I=/^\d, *\d\/\d, *\d/;if(I.test(t)){let T=t.match(I)[0],P=T.split("/").map(D=>`(${D})`).join(" ")+" ";t=t.replace(T,P),e.push("slashCommaSetPattern")}let v=/\(6-\)/g;v.test(t)&&(t=t.replace(v,"(6-0)"),e.push("missingZeroPattern2"));let w=new RegExp("(?<!-)(\\d+)\\/(\\d+)(?!-)","g");if(w.test(t)){let T=t.match(w),P=new RegExp("(?<!-)(\\d+)\\/(\\d+)(?!-)"),D=t;T.forEach(E=>{let[R,C]=E.match(P).slice(1),M=`${R}-${C}`;D=D.replace(E,M)}),t=D,e.push("slashSetPattern")}let y=/(.*)\s(1\d)\s(\d+)$/;if(y.test(t)){let[T,P,D]=t.match(y).slice(1);T.replace(/\D/g,"").length>=4&&(t=T+` ${P}${D}`,e.push("spaceSeparatedSuperPattern"))}let b=/(^|\s)(\d+-\d+)\s(\d+)(\s|$)/g;for(let T of t.match(b)||[]){let[P,D,E,R]=T.match(/(^|\s)(\d+-\d+)\s(\d+)(\s|$)/).slice(1),[C,M]=D.split("-").map(N=>parseInt(N));Math.abs(C-M)===1&&(t=t.replace(T,`${P}${D}(${E})${R}`),e.push("spaceSeparatedSetPattern"))}let S=/\d-\d \(\d{1,2}\)(\s|$|,)/g;for(let T of t.match(S)||[]){let P=/(\d-\d) \((\d{1,2})\)(\s|$|,)/,[D,E,R]=T.match(P).slice(1),[C,M]=D.split("-").map(N=>parseInt(N));Math.abs(C-M)===1&&(t=t.replace(T,`${D}(${E})${R}`),e.push("floatingTiebreakPattern2"))}let U=/(^|\s)(\d \d)\(/g;for(let T of t.match(U)||[]){let P=/(^|\s)(\d \d)\(/,[D,E]=T.match(P).slice(1);t=t.replace(T,`${D}${E.split(" ").join("-")}(`),e.push("spacedTiebreakPattern")}return{score:t,applied:e}}function KVe({score:t,matchUpStatus:e}){let i=t?.split(" ");t=i.map(o=>{if(o.endsWith("]")){let l=o.split("[");if(xI(l[0]))return l[0]+`(${l[1].slice(0,-1)})`}return o}).join(" ");let r=new RegExp(/(\([\d ]+\))/g);if(r.test(t))for(let o of t.match(r)){let l=o.replace(" ","-").match(/\((.*)\)/)?.[1];if(Ai(l)&&l?.[0]>2){if([2,4].includes(l.length))l=l.split("").join("-");else if(l.length===3){let u=l.indexOf("1");l=nE(l.split(""),u)}}t=t.replace(o,`(${l})`)}i=t?.split(" ");let n=new RegExp(/^(\d[-/]+\d)\((\d+)[-/]+(\d+)\)$/),a=i.length-1;t=i.map((o,l)=>{let u=[void 0,"","COMPLETED"].includes(e)||l!==a;if(n.test(o)&&u){let[c,d,p]=Array.from(o.match(n)).slice(1),f=Math.min(d,p);return`${c}(${f})`}return o}).join(" "),i=t?.split(" "),n=new RegExp(/^(\d{2})\((\d+)\)$/),t=i.map(o=>{if(n.test(o)){let[l,u]=Array.from(o.match(n)).slice(1),c=l.split("");return`${c[0]}-${c[1]}(${u})`}return o}).join(" "),i=t?.split(" "),n=new RegExp(/^\((\d[-/]+\d)\)(\d+)$/),t=i.map(o=>{if(n.test(o)){let[l,u]=Array.from(o.match(n)).slice(1);return xI(l)?`${l}(${u})`:l}return o}).join(" "),i=t?.split(" "),n=new RegExp(/^1-0\((\d+)\)$/),t=i.map(o=>{if(n.test(o)){let[l]=o.match(n).slice(1);return`[${l<9?10:Number.parseInt(l)+2}-${l}]`}return o}).join(" ");let s=/\((\d)+0 /;if(s.test(t)){let o=t.match(s)[1];t=t.replace(s,`(${o}) `)}return{score:t}}function XVe({score:t,attributes:e,identifier:i}){if(typeof t!="string")return{score:t,identifier:i};let r=new RegExp(/\([\d,/ ]+\)/g),n=t.match(r);for(let c of n||[]){let d=c.match(/^\((.*)\)$/)?.slice(1)?.[0],p=t.split(c)[0].split(")").reverse()[0].replace(/\D/g,"");if(d?.length===2&&p?.length>=2){let h=p.slice(p.length-2).split("").map(g=>parseInt(g));if(Math.abs(h[0]-h[1])===1)continue}let f=Cq(d),m=CN(f);t=t.replace(c,`(${m})`).trim()}let a=new RegExp(/\[[\d,/ ]+\]/g);t.match(a)?.forEach(c=>{let d=Cq(c.match(/^\[(.*)\]$/)[1]);t=t.replace(c,`(${d}) `).trim()});let s=[")","]"],o=[")(","), (",") (",")[",") [","](","] ("];if(t.startsWith("(")&&s.some(c=>t.endsWith(c))&&o.some(c=>t.includes(c))){let c="",d=t.split(/[)\]]/).filter(Boolean).map(g=>(g.startsWith(",")&&(g=g.slice(1)),g.trim())),p=d.every(g=>g.includes(",")||wD(g)),f=d.every(g=>g.includes("/")||wD(g)),m=d.every(g=>g.includes("-")||wD(g)),h=p&&","||m&&"-"||f&&"/";if(h){let g;d.forEach(I=>{if(I.startsWith("("))if(g==="set"&&(c+=" "),I.includes(h))c+=I.slice(1).split(h).map(v=>v.trim()).join("-"),g="set";else{let v=I.slice(1);c+=`(${v}) `,g="tiebreak"}else if(I.startsWith("[")){let v=I.slice(1).split(h).map(y=>parseInt(y.trim())),w=Math.min(...v);g==="set"?c+=`(${w}) `:c+=`[${v.join("-")}] `,g="tiebreak"}}),t=c.trim()}}let l=Sa(t.split(""));l["("]===1&&l[")"]===1&&t.startsWith("(")&&t.endsWith(")")&&(t=t.slice(1,t.length-1),l["-"]===1&&xI(t)&&Ai(e?.removed)&&(t=t+`(${e.removed})`,e.removed=void 0));let u=/\(\)/g;return u.test(t)&&(t=t.replace(u,"").trim()),{score:t}}function Koe({score:t}){let e=t.split(""),i=[],r,n=()=>r=[void 0,void 0,void 0],a=()=>{let o=`${r[0]}-${r[1]}`;return r[2]&&(o+=` (${r[2]})`),n(),r.push(r),o};n();let s=()=>r[0]!==void 0&&r[1]!==void 0&&Math.abs(parseInt(r[0])-parseInt(r[1]));for(;e.length;){let o=e.shift(),l=Ai(o)&&parseInt(o),u=r[0]!==void 0&&r[1]!==void 0;if(Ai(l)){if(r[0]===void 0){r[0]=l;continue}if(r[1]===void 0&&(r[1]=l,s())){i.push(a()),r=[void 0,void 0];continue}if(u&&e.length===1&&Ai(e[0])){let c=e.pop();r[0]=r[0].toString()+r[1].toString(),r[1]=c,i.push(a()),r=[void 0,void 0]}u&&s()}}return{sets:i}}function Hx(t){let e=t.indexOf("1"),i=t.split(""),r=i.every(n=>!isNaN(n));if(r&&t.length===3&&e===0){let n=nE(i,e);if(n)return n}if(r&&t.length===7&&e>3){let n=i.slice(4),a=nE(n,e-4);if(a)return`${i[0]}-${i[1]} ${i[2]}-${i[3]} ${a}`}}function Xoe(t){let{score:e}=t,{applied:i,matchUpStatus:r}=t,n=e?.toString().split(""),a=n?.every(o=>Ai(o)),s=o=>Math.abs(o[0]-o[1]);if(typeof e=="number"||a){e=e.toString().toLowerCase(),a&&(e=n.join(""));let o=a?n.map(u=>parseInt(u)):e.split("").map(u=>parseInt(u)),{sets:l}=Koe({score:e});if(o.length,e.length===3&&s(o.slice(0,2))===1){let[u,c,d]=o;e=`${u}-${c}(${d})`,i.push("numericTiebreakPattern1")}else if(e.length===3&&o[0]===1){let[u,c,d]=o;e=`[${u}${c}-${d}]`,i.push("numericTiebreakPattern2")}else if(e.length===4&&s(o.slice(0,2))===1&&"987654".split("").includes(o[0].toString())){let[u,c,d,p]=o,f=Math.min(d,p);e=`${u}-${c}(${f})`,i.push("numericTiebreakPattern3")}else if(e.length===4&&o[0]===1&&o[2]===1){let[u,c,d,p]=o;e=`[${u}${c}-${d}${p}]`,i.push("bigSuper")}else if(e.length===4){let[u,c,d,p]=o;e=`${u}${c} ${d}${p}`,i.push("split4")}else if(e.length===5&&s(o.slice(0,2))===1){let[u,c,d,p,f]=o;e=`${u}-${c}(${d}) ${p}-${f}`,i.push("numericTiebreakPattern4")}else if(e.length===5&&s(o.slice(3))===1){let[u,c,d,p,f]=o;e=`${u}-${c} ${d}-${p}(${f})`,i.push("numericTiebreakPattern5")}else if(o.length===7)if(s(o.slice(0,2))>1&&s(o.slice(2,4))>1&&o[4]===1){let[u,c,d,p,f,m,h]=o;e=`${u}-${c} ${d}-${p} [${f}${m}-${h}]`,i.push("numericTiebreakPattern6")}else if(s(o.slice(0,2))===1&&s(o.slice(3,5))>1&&s(o.slice(5,7))>1){let[u,c,d,p,f,m,h]=o;e=`${u}-${c}(${d}) ${p}-${f} ${m}-${h}`,i.push("numericTiebreakPattern7")}else if(s(o.slice(0,2))>1&&s(o.slice(2,4))===1&&s(o.slice(5,7))>1){let[u,c,d,p,f,m,h]=o;e=`${u}-${c} ${d}-${p}(${f}) ${m}-${h}`,i.push("numericTiebreakPattern8")}else if(s(o.slice(0,2))>1&&s(o.slice(2,4))>1&&s(o.slice(4,6))===1){let[u,c,d,p,f,m,h]=o;e=`${u}-${c} ${d}-${p} ${f}-${m}(${h})`,i.push("numericTiebreakPattern9")}else e=e.slice(0,2)+" "+e.slice(2,4)+" "+e.slice(4),i.push("numericMatchTiebreakPattern");else if(e.length%2){let u=Hx(e);u&&e!==u&&i.push("parsedSuperPattern"),e=u??e}else{let u=wr(e.split(""),2).map(I=>I.join("")),c=u.map(I=>{let[v,w]=I.split("").map(S=>parseInt(S)),y=Math.abs(v-w),b=v>w?1:2;return y>1&&b||b*-1}),d=c.reduce((I,v)=>I>0&&v>0,1),p=Sa(c),f=c.map(I=>Math.abs(I)),m=Sa(f),h=c[0]<0,g=!h&&c[1]<0;if(c[0]>0&&c[1]>0&&c[0]!==c[1])e=[u.slice(0,2).join(" "),u.slice(2).join("-")].join(" "),i.push("numeric3rdSetTiebreakPattern");else if(d)e=u.join(" "),i.push("chunkSplit");else if(o.length===6){if(p[1]===2||p[2]===2)if(!Object.values(m).includes(3))e=u.join(" "),i.push("chunkSplit");else{let[I,v,w,y,b,S]=o,U=c.reduce((T,P,D)=>P<0?D:T,void 0);if(U===0){let T=Math.min(w,y);e=`${I}-${v}(${T}) ${b}-${S}`,i.push("chunkSplitTiebreak1")}else if(U===1){let T=Math.min(b,S);e=`${I}-${v} ${w}-${y}(${T})`,i.push("chunkSplitTiebreak2")}else e=`${I}-${v} ${w}-${y}`,i.push("chunkSplitTrimExtraneous")}}else if(o.length===8){let[I,v,w,y,b,S,U,T]=o;h||g?o[5]===1&&(h?e=`${I}-${v}(${w}) ${y}-${b} [${S}${U}-${T}]`:e=`${I}-${v} ${w}-${y}(${b}) [${S}${U}-${T}]`):(c[0],c[1])}}}return{score:e,applied:i,matchUpStatus:r}}function Joe(t){let e=[0,0],i=[],r=t.split(" "),n=/(\d+)-(\d+)/;r.forEach(l=>{if(n.test(l)){let u=l.match(n).slice(1).map(d=>Number.parseInt(d)),c=u[0]>u[1]&&1||u[1]>u[0]&&2;c&&(e[c-1]+=1,i.push(c))}});let a=e[0]>e[1]&&1||e[1]>e[0]&&2,s=e[0]>0&&e[0]===e[1],o=e.reduce((l,u)=>l+u,0);return{setsWon:e,setsTied:s,setWinners:i,totalSets:o,winningSide:a}}function JVe({score:t,matchUpStatus:e,attributes:i}){let r=[],n,a=t.split(" "),s=a.length;t=a.map((c,d)=>{if(new RegExp(sw).test(c)){let f=c.slice(3),m=c.slice(0,3),h=m.split("-");if(!xI(m)&&!e){let g=Math.max(...h),I=m.indexOf(g),v=[g,g-1];return I&&v.reverse(),v.join("-")+f}}else if(c.length===2&&Ai(c))return c.split("").join("-");c=CN(c);let p=new RegExp(`^${qV}$`).test(c)&&"super"||new RegExp(`^${sw}$`).test(c)&&"tiebreak"||new RegExp(`^${RN}$`).test(c)&&"standard"||"unknown";if(r.push(p),s>1&&p==="standard"&&d<2){let[f,m]=c.split("-"),h=Math.abs(parseInt(f)-parseInt(m)),g=Math.max(f,m),I=Math.min(f,m),v=[parseInt(f),parseInt(m)].indexOf(I);if(g>9&&h>2){let w=g.toString().split(""),y=w.find(b=>parseInt(b)>I||d&&parseInt(b)<=n)??w[0];y&&(c=v?[y,I].join("-"):[I,y].join("-"))}g>(n||0)&&(n=g)}if(p==="standard"){let[f,m]=c.split("-");if(!Math.abs(parseInt(f)-parseInt(m))&&e!=="RETIRED")return""}return c}).filter(Boolean).join(" ");let{setsWon:o,setWinners:l,totalSets:u}=Joe(t);if(u===1&&i?.removed==="6"&&(t+=" 6-0"),t.split(" ").length>2&&Math.max(...o)>=2&&l[0]===l[1]&&(t=t.split(" ").slice(0,2).join(" ")),Math.max(...o)>2){let c=[0,0];t=t.split(" ").map((d,p)=>(c[l[p]]+=1,Math.max(...c)>2?void 0:d)).filter(Boolean).join(" ")}return{score:t,profile:r}}function QVe({score:t}){let{setsTied:e,winningSide:i}=Joe(t),r=/\s\((\d+)\)$/;if(!i&&e&&r.test(t)){let o=t.match(r).slice(1)[0],l=o<=8?10:o+2;t=t.replace(r,` [${l}-${o}]`)}let n=t.split(" "),a=n[n.length-1];if(!a.includes("-")||a.indexOf("(")>0)return{score:t};let s=a.split("(").join("").split(")").join("").split("-");if(!s.every(o=>Ai(o)))return{score:t};if(s[0]==="76"){let o=s[1].length===2?Math.min(...s[1].split("").map(l=>parseInt(l))):s[1];t=[...n.slice(0,n.length-1),`7-6(${o})`].join(" ")}else{s=s.map(u=>parseInt(u));let o=Math.max(...s),l=Math.abs(s[0]-s[1]);if(o>=10){if(l>2&&s.every(u=>+u>=10)){let u=s.map(c=>c===o?c-10:10).sort();l=Math.abs(u[0]-u[1]),l>2&&(s=u)}t=[...n.slice(0,n.length-1),`[${s.join("-")}]`].join(" ")}else n.length===3&&o>=7&&l>2&&(t=[...n.slice(0,n.length-1),`[${s.join("-")}]`].join(" "))}return{score:t}}function ZVe({score:t}){return t=t?.toString().toLowerCase()||"",{score:t}}function eje({score:t,applied:e}){return typeof t!="string"?{score:t}:(t.toLowerCase().includes("o")&&(t=t.toLowerCase().split(" ").map(i=>i.split("o").join("0")).join(" "),e.push("replaceOh")),{score:t,applied:e})}function tje({score:t,applied:e}){return typeof t!="string"?{score:t}:(t=t.toLowerCase().split(" ").map(i=>{if(/^\d+$/.test(i)&&i.length>2){let r=i.indexOf("1");if(i.length%2){if(i.length===3&&r===0){let n=nE(i.split(""),r);return e.push("getSuper"),n}}else{let{score:n,applied:a}=Xoe({score:i,applied:[]});n!==i&&(i=n,e.push(...a))}}return i}).join(" "),{score:t,applied:e})}function ije({score:t,applied:e}){return typeof t!="string"?{score:t}:[3,4].includes(t.length)&&Hx(t)?{score:Hx(t)}:(t=t.toLowerCase().split(" ").map(i=>{if(/^\d+$/.test(i)&&i.length===1){e.push("removeErroneous1");return}return i}).filter(Boolean).join(" "),{score:t,applied:e})}function rje({score:t,applied:e}){return["walkover","wo","w/o","w-o"].includes(t?.toString().toLowerCase())?(e.push("handleWalkover"),{matchUpStatus:"walkover",score:"",applied:e}):{score:t}}function nje({score:t,profile:e,applied:i}){t=t?.toString().toLowerCase();let r=/^(.*\d+.*)(ret|con)+[A-Za-z ]*$/;if(r.test(t)){let[s]=t.match(r).slice(1);return i.push("handleRetired"),{score:s.trim(),matchUpStatus:"retired",applied:i}}let n=e?.matchUpStatuses?.retired,a=["rtd",...Array.isArray(n)?n:[n].filter(Boolean)].find(s=>t?.endsWith(s));return a?(i.push("handleRetired"),{matchUpStatus:"retired",score:t?.replace(a,"").trim(),applied:i}):{score:t}}function aje({score:t,profile:e,applied:i}){t=t?.toString().toLowerCase();let r=/^(.*\d+.*)(def|defaulted)+[A-Za-z ]*$/;if(r.test(t)){let[s]=t.match(r).slice(1);return i.push("handleDefaulted"),{score:s.trim(),matchUpStatus:"defaulted",applied:i}}let n=e?.matchUpStatuses?.defaulted,a=["dft",...Array.isArray(n)?n:[n].filter(Boolean)].find(s=>t?.endsWith(s));return a?(i.push("handleDefaulted"),{matchUpStatus:"defaulted",score:t?.replace(a,"").trim(),applied:i}):{score:t}}function sje({score:t,attributes:e}){(t.endsWith(" am")||t.endsWith(" pm"))&&(t=""),t=t.replace(/[A-Za-z]+/g,"").trim(),[".",","].some(n=>t.endsWith(n))&&(t=t.slice(0,t.length-1));let i="()/-".split("").some(n=>t.includes(n));/ \d$/.test(t)&&i&&(e={removed:t.slice(t.length-2).trim()},t=t.slice(0,t.length-2));let r=/(.*)[A-Za-z]+$/;return r.test(t)&&(t=t.match(r).slice(1)[0].trim()),{score:t,attributes:e}}function oje({score:t}){return new RegExp(/-\d+\/\d+-/).test(t)&&(t=t.split("/").join(" ")),{score:t}}function lje({score:t}){let e=new RegExp(/^\d+\/\d+/),i=t.split(" ");i.some(n=>e.test(n))&&(t=i.map(n=>e.test(n)?n.replace("/","-"):n).join(" "));let r=/^(\d+), *(\d+)$/;if(r.test(t)){let[n,a]=t.match(r).slice(1);t=[n,a].join("-")}return{score:t}}function uje({score:t}){let e=new RegExp(/\(\d+\/\d+\)/g),i=t.match(e);for(let r of i||[]){let n=r.replace("/","-");t=t.replace(r,n)}return{score:t}}function cje({score:t}){if(t.includes(",")){let e=t.split(",").map(r=>r.trim()),i=r=>/\d \d/.test(r);e.every(i)&&(t=e.map(r=>{let n=/\d+ \d+/g;for(let a of r.match(n)){let[s,o]=a.match(/(\d+) (\d+)/).slice(1);r=r.replace(a,`${s}-${o}`)}return r}).join(" "))}if(t.includes(" ")){let e=t.replace(/[ ,]/g,"");e.split("").every(i=>Ai(i))&&e.length===4&&(t=e)}return{score:t}}function dje({score:t}){let e=new RegExp(/^\[\d+\](.*)$/);e.test(t)&&(t=t.match(e).slice(1)[0].trim());let i=/\(,/g;return i.test(t)&&(t=t.replace(i,"(")),{score:t}}var pje={handleTiebreakSlashSeparation:uje,handleSetSlashSeparation:oje,punctuationAdjustments:WVe,handleGameSeparation:lje,joinFloatingTiebreak:qVe,handleBracketSpacing:zVe,handleSpaceSeparator:cje,separateScoreBlocks:tje,matchKnownPatterns:YVe,removeDanglingBits:sje,removeErroneous:ije,handleDefaulted:aje,handleWalkover:rje,properTiebreak:KVe,handleNumeric:Xoe,handleRetired:nje,containedSets:XVe,sensibleSets:JVe,stringScore:ZVe,superSquare:QVe,setBuilder:Koe,excisions:dje,replaceOh:eje},hk={},fje=["handleNumeric","handleWalkover","handleRetired","handleDefaulted","replaceOh","stringScore","punctuationAdjustments","excisions","handleSpaceSeparator","matchKnownPatterns","removeDanglingBits","handleBracketSpacing","matchKnownPatterns","containedSets","separateScoreBlocks","handleGameSeparation","removeErroneous","joinFloatingTiebreak","handleSetSlashSeparation","handleTiebreakSlashSeparation","properTiebreak","sensibleSets","superSquare"],mje=["handleNumeric","separateScoreBlocks","sensibleSets","superSquare"];function Qoe(t){if(!t.score)return{error:re};let{score:e,sheetName:i,identifier:r,fileName:n,stepLog:a,fullLog:s,profile:o}=t,l=[],u,c=[],d,p,f=e,m=g=>{g.forEach(I=>{p=pje[I]({profile:o,identifier:r,matchUpStatus:u,attributes:d,applied:c,score:f});let v=p.score!==f;v&&l.push({method:I,score:p.score}),a&&(s||v||p.matchUpStatus!==u)&&console.log(u?{score:p.score,matchUpStatus:u}:{score:p.score},I),p.matchUpStatus&&(u=p.matchUpStatus),p.attributes&&(d=p.attributes),p.applied&&(c=p.applied),f=p.score})};m(fje);let h=Rq(f);return h||(f=e.toString().replaceAll(/\D/g,""),d?.removed&&(d.removed=void 0),m(mje),h=Rq(f),h||(f="")),c.forEach(g=>{hk[g]||(hk[g]=0),hk[g]+=1}),{matchUpStatus:u?.toUpperCase(),modifications:l,attributes:d,isValid:h,score:f}}var Zoe={};dt(Zoe,{analyzeScore:()=>KV,analyzeSet:()=>ow,calculateMatchStatistics:()=>VV,checkScoreHasValue:()=>fr,checkSetIsComplete:()=>PN,deduceMatchUpFormat:()=>AN,enrichPointHistory:()=>Uoe,getEpisodes:()=>BV,getQuickStats:()=>Toe,getScore:()=>Cd,getScoreboard:()=>LV,getSetComplement:()=>JV,getTiebreakComplement:()=>NN,getWinner:()=>_V,isComplete:()=>$V,isValidMatchUpFormat:()=>$a,parseScoreString:()=>QU,toStatObjects:()=>jV,validateMatchUpScore:()=>ele,validateScore:()=>XV,validateSetScore:()=>YV,validateTieFormat:()=>Gn});function hje(t,e,i,r,n,a=!1){return n?{isValid:!0}:t===0&&e===0?{isValid:!1,error:"Tiebreak-only set requires both scores"}:t<r?{isValid:!1,error:`Tiebreak-only set winner must reach at least ${r}, got ${t}`}:i<(a?1:2)?{isValid:!1,error:a?`Tiebreak-only set (NoAD) must be won by at least 1 point, got ${t}-${e}`:`Tiebreak-only set must be won by at least 2 points, got ${t}-${e}`}:a?{isValid:!0}:t===r&&e>r-2?{isValid:!1,error:`Tiebreak-only set at ${r}-${e} requires playing past ${r}`}:t>r&&i!==2?{isValid:!1,error:`Tiebreak-only set past ${r} must be won by exactly 2 points, got ${t}-${e}`}:{isValid:!0}}function gje(t,e,i,r){let n=r===i?i+1:i,a=r;return t!==n?{isValid:!1,error:`Tiebreak set winner must have ${n} games, got ${t}`}:e!==a?{isValid:!1,error:`Tiebreak set loser must have ${a} games, got ${e}`}:{isValid:!0}}function Ije(t,e,i){let r=Math.max(t||0,e||0),n=Math.min(t||0,e||0),a=r-n,s=i.tiebreakTo||7;return r<s?{isValid:!1,error:`Tiebreak winner must reach ${s} points, got ${r}`}:a<2?{isValid:!1,error:`Tiebreak must be won by 2 points, got ${r}-${n}`}:n>=s-1&&a>2?{isValid:!1,error:`Tiebreak score ${r}-${n} is invalid`}:{isValid:!0}}function vje(t,e,i,r){return r?t===i+1&&e<i-1?{isValid:!1,error:`With tiebreak format, if side 1 has ${i+1} games, side 2 must be at least ${i-1}, got ${e}`}:e===i+1&&t<i-1?{isValid:!1,error:`With tiebreak format, if side 2 has ${i+1} games, side 1 must be at least ${i-1}, got ${t}`}:{isValid:!0}:{isValid:!0}}function yje(t,e,i,r,n){if(t<r)return{isValid:!1,error:`Set winner must reach ${r} games, got ${t}`};let a=n&&t===r&&e===n&&i===1;if(i<2&&!a)return{isValid:!1,error:`Set must be won by at least 2 games, got ${t}-${e}`};if(n){if(e>=n&&!a)return{isValid:!1,error:`When tied at ${n}-${n}, must play tiebreak. Use format like ${n+1}-${n}(5)`};let s=n===r?r+1:r;if(t>s)return{isValid:!1,error:`With tiebreak format, set score cannot exceed ${s}-${n}. Got ${t}-${e}`}}else if(t>r+10)return{isValid:!1,error:`Set score ${t}-${e} exceeds reasonable limits`};return{isValid:!0}}function bje(t,e,i){let r=t.side1TiebreakScore,n=t.side2TiebreakScore,a=e&&i?r:t.side1Score||t.side1||0,s=e&&i?n:t.side2Score||t.side2||0;return{side1Score:a,side2Score:s,side1TiebreakScore:r,side2TiebreakScore:n}}function wje(t,e,i,r,n,a,s){if(i&&r){let o=gje(t,e,i,r);if(!o.isValid)return o}return(n!==void 0||a!==void 0)&&s?Ije(n,a,s):{isValid:!0}}function Sje(t,e,i){return i&&(t>i+10||e>i+10)?{isValid:!1,error:`Set score ${t}-${e} exceeds expected range for ${i}-game sets`}:{isValid:!0}}function Uje(t,e,i){let{side1:r,side2:n,winner:a,loser:s,diff:o}=t,{setTo:l,tiebreakAt:u}=e;if(l&&u){let c=vje(r,n,l,u);if(!c.isValid)return c}return i?Sje(a,s,l):l?yje(a,s,o,l,u):{isValid:!0}}function YV(t,e,i,r){if(!e)return{isValid:!0};let n=qi(e);if(!n)return{isValid:!0};let a=i&&n.finalSetFormat?n.finalSetFormat:n.setFormat;if(!a)return{isValid:!0};if(a.timed){if(!r){let S=t.side1Score??0,U=t.side2Score??0;if(S===0&&U===0)return{isValid:!1,error:"Timed set requires at least one side to have scored"};if(a.based==="P"&&S===U&&S>0&&a.tiebreakFormat&&!(t.side1TiebreakScore!==void 0||t.side2TiebreakScore!==void 0))return{isValid:!1,error:"Tied timed set requires tiebreak"}}return{isValid:!0}}let{setTo:s,tiebreakAt:o,tiebreakFormat:l,tiebreakSet:u}=a,c=u?.tiebreakTo,d=!!c&&!s,p=t.side1TiebreakScore!==void 0&&t.side2TiebreakScore!==void 0,{side1Score:f,side2Score:m,side1TiebreakScore:h,side2TiebreakScore:g}=bje(t,d,p),I=Math.max(f,m),v=Math.min(f,m),w=I-v;if(d){let S=t.NoAD??a.tiebreakSet?.NoAD??!1;return hje(I,v,w,c,r??!1,S)}let y=h!==void 0||g!==void 0,b=s&&I===s+1&&v===s;return y||b?wje(I,v,s,o,h,g,l):Uje({side1:f,side2:m,winner:I,loser:v,diff:w},{setTo:s,tiebreakAt:o},r)}function ele(t,e,i){if(!t||t.length===0)return{isValid:!0};let r=e?.match(/SET(\d+)/)?.[1],n=r?Number.parseInt(r):3,a=[Sr,ai,qt].includes(i||"");for(let s=0;s<t.length;s++){let o=t[s],l=s+1===n,u=o.winningSide!==void 0,c=YV(o,e,l,a||i===void 0&&!u);if(!c.isValid)return{isValid:!1,error:`Set ${s+1}: ${c.error}`}}return{isValid:!0}}function MN(t){return!!t?.aggregate}function Tje(t,e,i,r,n,a){let{tiebreakTo:s,NoAD:o}=t||{},l=Math.max(e??0,i??0);return!(o&&l>s||l<s&&r&&(n&&!a||!n))}function Dje(t,e,i,r,n,a){let s=e+1===r,{side1Score:o,side2Score:l,side1TiebreakScore:u,side2TiebreakScore:c,winningSide:d}=t,p=Math.max(o??0,l??0),f=u??c,{finalSetFormat:m,setFormat:h}=i,g=s&&m||h;return f&&!Tje(g?.tiebreakFormat,u,c,d,n,a)?!1:g.setTo?!(!g.noTiebreak&&p>g.setTo+1):!0}function Pje(t){let e=t.reduce((i,r)=>((r.side1Score!==void 0||r.side2Score!==void 0)&&(i[0]+=r.side1Score??0,i[1]+=r.side2Score??0),i),[0,0]);return e[0]>e[1]?1:e[1]>e[0]?2:t.find(i=>i.side1TiebreakScore!==void 0||i.side2TiebreakScore!==void 0)?.winningSide}function Eje(t,e,i,r,n){return(!n||t===e)&&i===1&&r.indexOf(t)+1||void 0}function KV({existingMatchUpStatus:t,matchUpFormat:e,matchUpStatus:i,winningSide:r,score:n}){let a=n?.sets??[],s=(a?.filter(T=>T?.winningSide)||[]).reduce((T,P)=>{let{winningSide:D}=P;if(!D)return T;let E=D-1;return T[E]++,T},[0,0]),o=r?r-1:void 0,l=o!==void 0&&[0,1].includes(o)?1-o:void 0,u=o!==void 0&&s[o],c=l!==void 0&&s[l],d=e?qi(e):void 0,p=Math.max(...s),f=Sa(s)[p],m=d?.setFormat?.timed||d?.finalSetFormat?.timed,h=d?.bestOf||d?.exactly,g=h&&Math.ceil(h/2)||1,I=i??t,v=!!(I&&[qt,Sr,ai].includes(I)),w=!d||!a.length||a.every((T,P)=>Dje(T,P,d,h??0,P===a.length-1,v)),y=d?.exactly,b=!y||!I||I!==Oi||v||a.length>=y,S=MN(d),U=S&&a.length>0?Pje(a):Eje(p,g,f,s,e);return{valid:!!(w&&b&&(r&&S&&r===U||r&&!S&&u>c&&r===U||r&&v||!r&&!U&&(![Oi,qt,Sr,ai].includes(I)||m&&I===Oi)))}}function XV({existingMatchUpStatus:t,matchUpFormat:e,matchUpStatus:i,winningSide:r,score:n}){if(typeof n!="object")return{error:re};let{sets:a,scoreStringSide1:s,scoreStringSide2:o}=n,l="scoreString must be a string!";if(s!==void 0&&typeof s!="string")return{error:re,info:l};if(o!==void 0&&typeof o!="string")return{error:re,info:l};if(a!==void 0&&!Array.isArray(a))return{error:re,info:qp("sets")};if(a?.length){let u=a.map(d=>d?.setNumber).filter(Boolean);if(u.length!==nt(u).length)return{error:re,info:"setNumbers not unique"};for(let d of a){let{side1Score:p,side2Score:f,side1TiebreakScore:m,side2TiebreakScore:h,side1PointScore:g,side2PointScore:I,winningSide:v,setNumber:w}=d;if(![[p,f],[m,h],[g,I]].filter(y=>y.some(b=>![void 0,null].includes(b))).every(y=>y.every(b=>lt(b))))return{error:re,info:"non-numeric values"};if(![w,v].filter(y=>![void 0,null].includes(y)).every(y=>lt(y)))return{error:re,info:"non-numeric values"};if(v&&![1,2].includes(v))return{error:re,info:"winningSide must be 1 or 2"}}let{valid:c}=KV({existingMatchUpStatus:t,matchUpStatus:i,matchUpFormat:e,winningSide:r,score:n});if(!c)return{error:Jte,info:"score is invalid for matchUpFormat or winningSide does not match calculated winningSide"}}return{valid:!0}}var JV=t=>{let{isSide1:e,lowValue:i,setTo:r,tiebreakAt:n,NoAD:a}=t;if(i===void 0)return!1;let s=Ke(i);s?.toString().length>2&&(s=Number.parseInt(s.toString().slice(0,2))),n&&n<r&&s>n&&(s=n);let o;return a&&!n?s>r?o=r:o=s<r?r:r-1:o=s+1<r&&r||n&&n<r&&s===n&&r||!n&&s+2||r+1,[e?s:o,e?o:s]},NN=t=>{let{isSide1:e,lowValue:i,tiebreakTo:r,tiebreakNoAd:n}=t;if(i===void 0)return!1;let a=typeof i=="string"?Number.parseInt(i):i;a?.toString().length>2&&(a=Number.parseInt(a.toString().slice(0,2))),n&&a>r-1&&(a=r-1);let s=Rje({lowValue:a,NoAD:n,tiebreakTo:r});return[e?a:s,e?s:a]};function Rje(t){let{lowValue:e,NoAD:i,tiebreakTo:r}=t,n=i?1:2;return e+1>=r?e+n:r}function Wx(t,e){return t>e&&1||t<e&&2||void 0}function Cje(t,e){return e?{side1Score:t[0],side2Score:t[1],winningSide:Wx(t[0],t[1])}:{side1TiebreakScore:t[0],side2TiebreakScore:t[1],winningSide:Wx(t[0],t[1])}}function QU({tiebreakTo:t=7,scoreString:e="",matchUpFormat:i}){let r,n=3;if(i)try{r=qi(i);let c=/SET(\d+)/.exec(i)?.[1];n=c?Number.parseInt(c):3}catch{}return e?.split(" ").filter(Boolean).map((c,d)=>u({set:c,setNumber:d+1}));function a(c,d){if(!r||!d)return!1;let p=c===n&&r.finalSetFormat?r.finalSetFormat:r.setFormat;if(!p)return!1;let f=p.tiebreakSet?.tiebreakTo,m=p.setTo;return!!f&&!m}function s(c){if(!r)return t;let d=c===n&&r.finalSetFormat?r.finalSetFormat:r.setFormat;return d?.tiebreakSet?.tiebreakTo??d?.tiebreakFormat?.tiebreakTo??t}function o(c,d,p){let f=c[1],m=s(p),h=NN({lowValue:f,isSide1:d===2,tiebreakTo:m});return Array.isArray(h)?[h[0],h[1]]:[void 0,void 0]}function l(c,d,p,f){let m=(d&&c.replace(d[0],"")||p&&c.replace(p[0],"")||c).split("-").map(y=>Number.parseInt(y)),h=m[0],g=m[1],I=Wx(h,g),v,w;if(d&&([v,w]=o(d,I,f)),p){let y=p[1].split("-").map(b=>Number.parseInt(b));v=y[0],w=y[1]}return{side1Score:h,side2Score:g,side1TiebreakScore:v,side2TiebreakScore:w,winningSide:I}}function u({set:c,setNumber:d}){let p=/\(([^)]+)\)/,f=/\[([^\]]+)\]/,m=p.exec(c),h=f.exec(c),g=c?.startsWith("[")&&h,I=a(d,!!g),v=s(d),w=I&&v===1,y;if(g){let b=h[1].split("-").map(S=>Number.parseInt(S));y=Cje(b,I)}else y=l(c,m,h,d);return{side1Score:y.side1Score,side2Score:y.side2Score,side1TiebreakScore:y.side1TiebreakScore,side2TiebreakScore:y.side2TiebreakScore,winningSide:y.winningSide,setNumber:d,...w&&{NoAD:!0},...I&&{tiebreakSet:!0}}}}function Mje({matchUpScoringFormat:t,isDecidingSet:e,isTiebreakSet:i,isTimedSet:r,setObject:n}){if(!n)return;let a=EN({set:n});return PN({matchUpScoringFormat:t,set:n,isDecidingSet:e,isTiebreakSet:i,isTimedSet:r})&&a||void 0}function ow(t){let{setObject:e,matchUpScoringFormat:i}=t;if(!e)return{error:cM};let{setNumber:r}=e||{},{bestOf:n,exactly:a}=i||{},s=n||a,o=!!(r&&s&&r===s),l=o&&i?.finalSetFormat||i?.setFormat,u=!!l?.tiebreakSet,c=!!l?.timed,d=!u&&!c,p=!!(r&&s&&r<=s),f=[e?.side1Score,e?.side2Score],m=[e?.side1PointScore,e?.side2PointScore],h=[e?.side1TiebreakScore,e?.side2TiebreakScore],g=f.filter(k=>k!==void 0).length,I=m.filter(k=>k!==void 0).length,v=h.filter(k=>k!==void 0).length,w=f?.filter(k=>!isNaN(k)).length,y=h?.filter(k=>!isNaN(k)).length,{tiebreakAt:b}=l||{},S=b&&f.filter(k=>k>=b).length===2,U=S&&(f[0]>f[1]&&1||f[1]>f[0]&&2||void 0),T=!!(y&&!w),P=!!e?.winningSide,{error:D,result:E}=Nje({sideTiebreakScores:h,sideGameScores:f,setFormat:l,setObject:e}),{error:R,result:C}=Aje({sideTiebreakScores:h,setObject:e,setFormat:l}),M=d&&!T&&E||u&&T&&C||c,N=p&&!(u&&!T)&&!(d&&T)&&(!P||M),A=Mje({isTimedSet:c,matchUpScoringFormat:i,isDecidingSet:o,isTiebreakSet:T,setObject:e}),O={expectTiebreakSet:u,expectTimedSet:c,hasTiebreakCondition:S,isCompletedSet:P,isDecidingSet:o,isTiebreakSet:T,isValidSet:N,isValidSetNumber:p,isValidSetOutcome:M,leadingSide:U,setFormat:l,sideGameScores:f,sideGameScoresCount:g,sidePointScores:m,sidePointScoresCount:I,sideTiebreakScores:h,sideTiebreakScoresCount:v,winningSide:A};return e?.winningSide!==void 0&&(T?(O.isValidTiebreakSetOutcome=C,C||(O.tiebreakSetError=R)):(O.isValidStandardSetOutcome=E,E||(O.standardSetError=D))),O}function Nje({setObject:t,setFormat:e,sideGameScores:i,sideTiebreakScores:r}){if(!t)return{result:!1,error:cM};let n=!!e?.tiebreakSet,a=!!e?.timed;if(!e||n||a)return{result:!1,error:re};if(i?.filter(U=>!isNaN(U)).length!==2)return{result:!1,error:ux};let{setTo:s,tiebreakAt:o,tiebreakFormat:l,NoAD:u}=e||{};if(!(s&&i?.find(U=>U>=s)))return{result:!1,error:ux};let c=[1,2].includes(t?.winningSide);if(!t||!c)return{result:!1,error:pM};let d=t?.winningSide-1,p=1-d,f=i[d],m=i[p],h=f-m;if(!(f>m))return{result:!1,error:{message:"winningSide game scoreString is not high"}};let g=o&&l,I=r?.filter(U=>!isNaN(U)).length===2,v=r?.[d],w=r?.[p],y=o&&i.filter(U=>U>=o).length===2;if(g){let{NoAD:U,tiebreakTo:T}=l;if(y){if(h>1)return{result:!1,error:{message:"invalid winning game scoreString (5)"}};if(!I)return{result:!1,error:{message:"invalid tiebreak scores (1)"}};if(isNaN(T))return{result:!1,error:{message:"tiebreakTo error"}};if(!(T&&r?.find(C=>C>=T)))return{result:!1,error:{message:"invalid tiebreak scores (2)"}};let P=o<s?s:s+1;if(f>P)return{result:!1,error:{message:"invalid winning game scoreString (1)"}};if(!v||!w||v<w)return{result:!1,error:{message:"winningSide tiebreak value is not high"}};let D=U?1:2,E=v-w,R=w>=T-1;if(E&&R&&E<D)return{result:!1,error:{message:"invalid tiebreak scores (3)"}}}if(f>s&&!y)return{result:!1,error:{message:"invalid winning game scoreString (2)"}}}let b=u?1:2,S=m>=s-1;return h&&S&&!y&&h<b?{result:!1,error:{message:"invalid winning game scoreString (3)"}}:h>b&&f>s?{result:!1,error:{message:"invalid winning game scoreString (4)"}}:{result:!0}}function Aje({setObject:t,setFormat:e,sideTiebreakScores:i}){if(!t)return{result:!1,error:cM};let r=!!e?.tiebreakSet,n=!!e?.timed;if(!e||!r||n)return{result:!1,error:{message:"not tiebreak set"}};let a=[1,2].includes(t?.winningSide);if(!t||!a)return{result:!1,error:pM};let{tiebreakSet:s}=e||{},{NoAD:o,tiebreakTo:l}=s||{};if(i?.filter(g=>!isNaN(g)).length!==2)return{result:!1,error:{message:"invalid tiebreak scores (1)"}};if(isNaN(l))return{result:!1,error:{message:"tiebreakTo error"}};if(!i?.find(g=>g>=l))return{result:!1,error:{message:"invalid tiebreak scores (2)"}};let u=t?.winningSide-1,c=1-u,d=i[u],p=i[c];if(!d||!p||d<p)return{result:!1,error:{message:"winningSide tiebreak value is not high"}};let f=o?1:2,m=d-p,h=p>=l-1;return m&&h&&m<f?{result:!1,error:{message:"invalid tiebreak scores (3)"}}:{result:!0}}var gk="SET3-S:6/TB7";function AN(t){let e=t.split(/[\s,]+/).filter(o=>o.length>0);if(e.length===0)return gk;let i;e.length===1?i=1:e.length===2?i=3:i=5;for(let o of e){let l=o.replace(/\([^)]*\)/g,"").match(/(\d+)/g)?.map(u=>Number.parseInt(u,10))||[];if(l.length===2){let u=Math.max(...l),c=Math.min(...l),d=u-c;if(u===10||u>10&&d<=2)return`SET${i}-S:TB10`}}let r=null;for(let o of e)if(/\(/.test(o)){r=o;break}let n;if(r){let o=r.replace(/\([^)]*\)/g,"").match(/(\d+)/g)?.map(c=>parseInt(c,10))||[];if(o.length===0)return gk;let l=Math.max(...o),u=Math.min(...o);l===u+1?n=u:n=l-1}else{let o=[];for(let u of e){let c=u.replace(/\([^)]*\)/g,"").match(/(\d+)/g)?.map(d=>parseInt(d,10))||[];c.length>0&&o.push(Math.max(...c))}if(o.length===0)return gk;let l=Math.max(...o);l>=6?n=6:n=l}let a=!1;if(e.length>=3){let o=e.at(-1).replace(/\([^)]*\)/g,"").match(/(\d+)/g)?.map(l=>Number.parseInt(l,10))||[];if(o.length===2){let l=Math.max(...o),u=Math.min(...o);l>n+1&&l-u===2&&(a=!0)}}let s;return n===6?s=`SET${i}-S:6/TB7`:n===4?s=`SET${i}-S:4/TB7`:s=`SET${i}-S:${n}/TB7`,a&&(s+=`-F:${n}`),s}function tle(t){let{matchUp:e,expectedScore:i}=t;if(!e)return{isValid:!1,errors:["No matchUp provided"],warnings:[],actual:{sets:[],scoreString:""},expected:{sets:i?.sets,scoreString:i?.scoreString},pointsProcessed:0,pointsRejected:0};let r=[],n=[],a=ad({matchUpFormat:e?.matchUpFormat,matchUpId:e?.matchUpId,participants:e?.sides?.map(c=>c.participant).filter(c=>c!==void 0)}),s=e?.history?.points||[];s.length===0&&n.push("No points found to validate");let o=0,l=0;for(let c of s)try{a=wp(a,{winner:c.winner,server:c.server}),o++}catch(d){l++;let p=d instanceof Error?d.message:String(d);r.push(`Point ${c.pointNumber||o+1}: ${p}`)}let u=Cd(a);return i&&(i.sets&&(u.sets.length!==i.sets.length&&r.push(`Set count mismatch: expected ${i.sets.length}, got ${u.sets.length}`),i.sets.forEach((c,d)=>{let p=u.sets[d];if(!p){r.push(`Missing set ${d+1}`);return}c.side1Score!==void 0&&p.side1Score!==c.side1Score&&r.push(`Set ${d+1} side1Score: expected ${c.side1Score}, got ${p.side1Score}`),c.side2Score!==void 0&&p.side2Score!==c.side2Score&&r.push(`Set ${d+1} side2Score: expected ${c.side2Score}, got ${p.side2Score}`),c.side1TiebreakScore!==void 0&&p.side1TiebreakScore!==c.side1TiebreakScore&&r.push(`Set ${d+1} side1TiebreakScore: expected ${c.side1TiebreakScore}, got ${p.side1TiebreakScore}`),c.side2TiebreakScore!==void 0&&p.side2TiebreakScore!==c.side2TiebreakScore&&r.push(`Set ${d+1} side2TiebreakScore: expected ${c.side2TiebreakScore}, got ${p.side2TiebreakScore}`)})),i.scoreString&&u.scoreString!==i.scoreString&&r.push(`Score string mismatch: expected "${i.scoreString}", got "${u.scoreString}"`)),{isValid:r.length===0,errors:r,warnings:n,actual:{sets:u.sets,scoreString:u.scoreString},expected:{sets:i?.sets,scoreString:i?.scoreString},pointsProcessed:o,pointsRejected:l}}function kje(t){let e=t?.side1Score||0,i=t?.side2Score||0;if(t?.side1TiebreakScore!==void 0||t?.side2TiebreakScore!==void 0){let r=t?.side1TiebreakScore||0,n=t?.side2TiebreakScore||0;return e>i?`${e}-${i}(${n})`:`${e}(${r})-${i}`}return`${e}-${i}`}function Oje(t){let{points:e,matchUpFormat:i,expectedGames:r,expectedTiebreak:n}=t,a={matchUpId:"validation",matchUpFormat:i,matchUpStatus:"TO_BE_PLAYED",matchUpType:"SINGLES",sides:[{sideNumber:1},{sideNumber:2}],score:{sets:[]},history:{points:e?.map((s,o)=>({...s,pointNumber:o+1,timestamp:"",winner:s.winner,server:s.server}))}};return tle({matchUp:a,expectedScore:{sets:[{side1Score:r?.[0],side2Score:r?.[1],side1TiebreakScore:n?.[0],side2TiebreakScore:n?.[1]}]}})}function xje(t){let{points:e,expectedScore:i,matchUpFormat:r,allowExtraPoints:n=!1,debug:a=!1}=t,s=[],o=[],l=[],u,c=!1;r?u=r:i?(u=AN(i),c=!0,a&&console.log(`Deduced format: ${u} from score: ${i}`)):(u="SET3-S:6/TB7",c=!0,o.push("No format provided, using default SET3-S:6/TB7"));let d=ad({matchUpFormat:u}),p=e?.split("").map(v=>{let w=Number.parseInt(v,10);return Number.isNaN(w)||w!==0&&w!==1?null:w}).filter(v=>v!==null);if(p?.length===0)return s.push("No valid points found in point string"),{valid:!1,errors:s,warnings:o,pointsProcessed:0,pointsRejected:[],actualScore:"0-0",matchUpFormat:u,formatDeduced:c,sets:[]};let f=0;for(let v=0;v<p?.length;v++){let w=p[v];if(d.matchUpStatus==="COMPLETED"&&!n){l.push(w),a&&console.log(`Point ${v+1}: Rejected (match complete)`);continue}try{if(d=wp(d,{winner:w}),f++,a){let y=Cd(d);console.log(`Point ${v+1}: ${w}  ${y.scoreString}`)}}catch(y){l.push(w);let b=y instanceof Error?y.message:String(y);s.push(`Point ${v+1}: ${b}`),a&&console.log(`Point ${v+1}: Error - ${b}`)}}let m=Cd(d),h=m.scoreString,g=m.sets.map(v=>{let w=[v.side1Score||0,v.side2Score||0],y=v.side1TiebreakScore===void 0?void 0:[v.side1TiebreakScore,v.side2TiebreakScore||0],b=`${w[0]}-${w[1]}`;return y&&(b=w[0]>w[1]?`${w[0]}-${w[1]}(${y[1]})`:`${w[0]}(${y[0]})-${w[1]}`),{games:w,tiebreak:y,scoreString:b}}),I=!0;if(i){let v=Mq(i),w=Mq(h);v!==w&&(I=!1,s.push(`Score mismatch: expected "${i}", got "${h}"`))}return l.length>0&&o.push(`${l.length} excess points after match complete`),s.length>0&&(I=!1),{valid:I,errors:s,warnings:o,pointsProcessed:f,pointsRejected:l,expectedScore:i,actualScore:h,matchUpFormat:u,formatDeduced:c,sets:g}}function Mq(t){return t.replace(/\s+/g,"").replace(/,/g,", ").toLowerCase()}var Fje={4:"Wide",5:"Body",6:"T"},ile={f:"Forehand",r:"Forehand Slice",v:"Forehand Volley",o:"Overhead Smash",u:"Forehand Drop Shot",l:"Forehand Lob",h:"Forehand Half-volley",j:"Forehand Drive Volley"},rle={b:"Backhand",s:"Backhand Slice",z:"Backhand Volley",p:"Backhand Overhead Smash",y:"Backhand Drop Shot",m:"Backhand Lob",i:"Backhand Half-volley",k:"Backhand Drive Volley"},Lje={t:"Trick Shot",q:"Unknown Shot"},_je={...ile,...rle,...Lje},$je={7:"shallow",8:"deep",9:"very deep"},Bje={1:1,2:2,3:3},Vje={"+":"approach","-":"net","=":"baseline"},Bf={n:"Net",w:"Out Wide",d:"Out Long",x:"Out Wide and Long",g:"Foot Fault",e:"Unknown","!":"Shank"};function jje(t,e){return t.PtWinner===t.Svr?e:1-e}function nle(t){let e=[],i="",r="fbrsvzouymlhijkpqt";for(let n=0;n<t.length;n++){let a=t[n];a&&(r.includes(a)||"456".includes(a)?(i&&e.push(i),i=a):i+=a)}return i&&e.push(i),e}function Gje(t){if(t.includes("*"))return"*";if(t.includes("#"))return"#";if(t.includes("@"))return"@"}function Ll(t){if(t){for(let e of Object.keys(Bf))if(t.includes(e))return e}}function Hje(t){let e=[];for(let i of t){if(!i)continue;let r=i[0];if(r&&/[456]/.test(r))e.push(i);else break}return e}function ale(t){if(!ni(t))return{serves:[],rally:[]};let e,i,r,n=t.split("c").length-1;t=t.split("c").join("");let a=nle(t),s=a;for(let c=a.length-1;c>=0;c--){let d=a[c];if(d&&(i=Gje(d),i)){s=a.slice(0,c+1),r=a.slice(c+1),e=d;break}}let o=Hje(s),l=o.length?s.slice(o.length):s;if(!i&&!o.length&&l.length===1){let c=l[0];c&&["S","P","Q","R"].includes(c)&&(e=c,l.length=0)}let u={serves:o,rally:l};return n&&(u.lets=n),i&&(u.terminator=i),e&&(u.result=e),r?.length,u}function sle(t){let e=t.join("|"),i=zx(t[0],1);if(i.winner==="S"||!t[1])return i.serve=1,i.code=e,i;let r=zx(t[1],2);return r.serve=2,r.first_serve={serves:i.serves},i.lets&&(r.first_serve.lets=i.lets),i.error&&(r.first_serve.error=i.error),i.parse_notes&&(r.first_serve.parse_notes=i.parse_notes),r.code=e,r}function zx(t,e){let i=ale(t);if(["Q","S"].includes(i.result||""))return i.winner="S",i;if(["P","R"].includes(i.result||"")||!i.terminator&&!Ll(i.serves[0])&&i.serves.length>2)return i.winner="R",i;let r=(i.serves.length+i.rally.length)%2===0?"R":"S",n;if(i.rally.length>0?n=i.rally[i.rally.length-1]:i.serves.length>0&&(n=i.serves[i.serves.length-1]),!n)return{...i,winner:void 0};if(!i.rally.length){if(i.terminator==="*")i.result="Ace",i.winner="S";else if(i.terminator==="#")i.result="Serve Winner",i.winner="S";else{let a=Ll(i.serves[0]);a?(i.error=Bf[a],e===2&&(i.result="Double Fault",i.winner="R")):(i.parse_notes="treated as a fault",e===2&&(i.result="Double Fault",i.winner="R"))}return i}if(i.rally.length===1&&n.includes("#")){i.result="Serve Winner",i.winner="S";let a=Ll(n);return a&&(i.error=Bf[a]),i}return n.includes("#")?(i.result="Forced Error",i.error=Bf[Ll(n)],i.winner=r==="R"?"S":"R"):n.includes("*")?(i.result="Winner",i.winner=r):n.includes("@")?(i.result="Unforced Error",i.error=Bf[Ll(n)],i.winner=r==="R"?"S":"R"):Ll(i.serves[0])?i.rally.length===1&&Ll(n)&&(i.error=Bf[Ll(n)],i.winner=r==="R"?"S":"R"):i.serves.length&&i.rally.length?(i.parse_notes="no terminator: receiver wins point",i.result="Unknown",i.winner="R"):i.rally.length===1&&Ll(n)&&(i.error=Bf[Ll(n)],i.winner=r==="R"?"S":"R"),i}function qx(t){if(t)for(let e of t){let i=_je[e];if(i)return i}}function Wje(t){if(t)for(let e of t){let i=Fje[e];if(i)return i}}function zje(t,e,i){let r=[],n=1,a=i;if(t.length>0&&!Ll(t[t.length-1])){let s=t[t.length-1],o=qx(s)||"Forehand";r.push({shotNumber:n++,player:a,stroke:o,code:s}),a=1-a}for(let s of e){let o=qx(s);if(!o)continue;let l={shotNumber:n++,player:a,stroke:o,code:s};for(let u of s){let c=Bje[u];c!==void 0&&(l.direction=c)}for(let u of s){let c=$je[u];c&&(l.depth=c)}for(let u of s){let c=Vje[u];c&&(l.position=c)}r.push(l),a=1-a}return r}function ole(t,e){let i=jje(t,e),r=t["1st"]||"",n=t["2nd"]||"";if(!r&&!n)return{winner:i,server:e,result:"Unknown"};let a=sle([r,n]),s={winner:i,server:e};a.result&&(s.result=a.result),a.serve&&(s.serve=a.serve);let o=a.serve===1?r:n,l=Wje(o);l&&(s.serveLocation=l);let u=a.rally[a.rally.length-1];if(u){let d=qx(u);d&&(s.stroke=d,Object.values(ile).includes(d)?s.hand="Forehand":Object.values(rle).includes(d)&&(s.hand="Backhand"))}let c=zje(a.serves,a.rally,e);return c.length>0&&(s.rally=c,s.rallyLength=c.length),a.code&&(s.code=a.code),s}function lle(t){if(!t||!ni(t))return[];let e=t.trim().split(`
`);if(e.length<2)return[];let i=e[0]?.split(",")||[],r=[];for(let n=1;n<e.length;n++){let a=e[n];if(!a)continue;let s=a.split(","),o={};for(let l=0;l<i.length;l++){let u=i[l];u&&(o[u]=s[l]||"")}r.push(o)}return r}function ule(t){if(!Array.isArray(t))return[];let e=new Map;for(let i of t){let r=i.match_id;e.has(r)||e.set(r,[]),e.get(r).push(i)}return Array.from(e.entries()).map(([i,r])=>({match_id:i,points:r}))}function qje(t){let e=t?.split("-")||[];if(e.length<6)return{player1:"Player 1",player2:"Player 2"};let i=e[0],r=e[2]?.replace(/_/g," "),n=e[4]?.replace(/_/g," ")||"Player 1",a=e[5]?.replace(/_/g," ")||"Player 2";return{player1:n,player2:a,date:i,tournament:r}}function Yje(t){if(!t||t.length===0)return;let e=t.at(-1);if(!e)return;let i=e.Set1,r=e.Set2,n=e.Set3,a=e.Set4,s=e.Set5,o=[];return i&&o.push(`${i}-${r}`),n&&o.push(`${n}-${r||"0"}`),a&&o.push(`${a}-${r||"0"}`),s&&o.push(`${s}-${r||"0"}`),o.length>0?o.join(", "):void 0}function cle(t,e={}){let{matchUpFormat:i,validateScore:r=!0,debug:n=!1}=e,a=[],s=[],o=qje(t.match_id),l=Yje(t.points),u,c=!1;i?u=i:l?(u=AN(l),c=!0,n&&console.log(`Deduced format: ${u} from score: ${l}`)):(u="SET3-S:6/TB7",c=!0,s.push("No format provided, using default SET3-S:6/TB7")),n&&(console.log(`Validating match: ${o.player1} vs ${o.player2}`),console.log(`Format: ${u}`),console.log(`Total points: ${t.points.length}`),l&&console.log(`Expected score: ${l}`));let d=ad({matchUpFormat:u,matchUpId:t.match_id});d.sides[0]&&(d.sides[0].participant={participantId:"player1",participantName:o.player1,participantType:"INDIVIDUAL",participantRole:"COMPETITOR"}),d.sides[1]&&(d.sides[1].participant={participantId:"player2",participantName:o.player2,participantType:"INDIVIDUAL",participantRole:"COMPETITOR"});let p=0,f=0,m=0,h=0,g=0,I,v=0;for(let S=0;S<t.points?.length;S++){let U=t.points[S];if(U){I=U.Svr==="1"?0:1;try{let T=ole(U,I),P={winner:T.winner,server:T.server};if(d=wp(d,P),d.history?.points&&d.history.points.length>0){let D=d.history.points[d.history.points.length-1];D&&(T.result&&(D.result=T.result),T.stroke&&(D.stroke=T.stroke),T.hand&&(D.hand=T.hand),T.serve&&(D.serve=T.serve),T.serveLocation&&(D.serveLocation=T.serveLocation),T.rally&&(D.rally=T.rally),T.rallyLength&&(D.rallyLength=T.rallyLength),T.code&&(D.code=T.code))}if(v++,T.result==="Ace"&&p++,T.result==="Double Fault"&&f++,T.result==="Winner"&&m++,T.result==="Unforced Error"&&h++,T.result==="Forced Error"&&g++,n&&(S<5||S===t.points.length-1)){let D=Cd(d);console.log(`Point ${S+1}: ${T.result||"Rally"}  ${D.scoreString}`)}}catch(T){let P=T instanceof Error?T.message:String(T);a.push(`Point ${S+1}: ${P}`),n&&console.error(`Point ${S+1} failed:`,P)}}}let w=Cd(d).scoreString,y=d.matchUpStatus==="COMPLETED";y||s.push(`Match not complete. Final score: ${w}`);let b;if(r&&l){let S=Nq(l),U=Nq(w);b=S===U,b||a.push(`Score mismatch: expected "${l}", got "${w}"`),n&&(console.log(`Expected: ${l}  ${S}`),console.log(`Actual: ${w}  ${U}`),console.log(`Score matches: ${b}`))}return n&&(console.log(`Final score: ${w}`),console.log(`Match complete: ${y}`),console.log(`Stats: ${p} aces, ${f} DFs, ${m} winners, ${h} UEs, ${g} FEs`)),{valid:a.length===0,errors:a,warnings:s,matchUp:d,pointsProcessed:v,expectedScore:l,actualScore:w,scoreMatches:b,formatDeduced:c,aces:p,doubleFaults:f,winners:m,unforcedErrors:h,forcedErrors:g}}function Nq(t){return t.replace(/\s+/g,"").replace(/,/g,", ").toLowerCase()}function Kje(t){let{csvData:e,matchId:i,matchUpFormat:r,debug:n=!1}=t,a=[],s=[],o=[],l;try{l=lle(e)}catch(I){let v=I instanceof Error?I.message:String(I);return a.push(`Failed to parse CSV: ${v}`),{valid:!1,errors:a,warnings:s,matchesProcessed:0,pointsProcessed:0,matchUps:[],totalAces:0,totalDoubleFaults:0,totalWinners:0,totalUnforcedErrors:0,totalForcedErrors:0}}let u=ule(l);n&&console.log(`Parsed ${l.length} points from ${u.length} matches`);let c=i?u.filter(I=>I.match_id===i):u;if(c.length===0)return a.push(i?`Match ID not found: ${i}`:"No matches found in CSV data"),{valid:!1,errors:a,warnings:s,matchesProcessed:0,pointsProcessed:0,matchUps:[],totalAces:0,totalDoubleFaults:0,totalWinners:0,totalUnforcedErrors:0,totalForcedErrors:0};let d=0,p=0,f=0,m=0,h=0,g=0;for(let I of c){let v=cle(I,{matchUpFormat:r,debug:n});v.valid||a.push(...v.errors),s.push(...v.warnings),o.push(v.matchUp),d+=v.pointsProcessed,p+=v.aces,f+=v.doubleFaults,m+=v.winners,h+=v.unforcedErrors,g+=v.forcedErrors}return{valid:a.length===0,errors:a,warnings:s,matchesProcessed:c.length,pointsProcessed:d,matchUps:o,totalAces:p,totalDoubleFaults:f,totalWinners:m,totalUnforcedErrors:h,totalForcedErrors:g}}function Xje(t){return JSON.stringify(t,null,2)}function Jje(t){let{existingDrawDefinition:e,hydrateCollections:i,enforceGender:r,tieFormatName:n,matchUpType:a,eventType:s,isMock:o,event:l}=t,{tieFormat:u,matchUpFormat:c}=t;if(a===ar&&s===ar){let d=e?.structures?.find(({stage:p})=>p===Ae)?.tieFormat;u=u||d||n&&l?.tieFormat?.tieFormatName===n&&l.tieFormat||n&&bc({namedFormat:n,hydrateCollections:i,isMock:o,event:l})||l?.tieFormat||bc({event:l,isMock:o,hydrateCollections:i}),c=void 0}else c||(u=void 0,l?.matchUpFormat||(c=Vs));if(u){let d=Gn({gender:l?.gender,enforceGender:r,tieFormat:u});if(d.error)return d}return{tieFormat:u,matchUpFormat:c}}function Qje(t){let e=t.drawDefinition,{existingQualifyingPlaceholderStructureId:i,appliedPolicies:r,qualifyingOnly:n,drawEntries:a,structureId:s,tieFormat:o,idPrefix:l,isMock:u,event:c}=t,d=t.qualifyingProfiles,p=d?.length?uoe({hasExistingDrawDefinition:!0,uuids:t.uuids,qualifyingProfiles:d,appliedPolicies:r,qualifyingOnly:n,tieFormat:o,idPrefix:l,isMock:u}):void 0;if(p?.error)return p;e.structures=e.structures?.filter(({structureId:b})=>b!==i),e.links=e.links?.filter(({source:b})=>b.structureId!==i);let{qualifiersCount:f,qualifyingDrawPositionsCount:m,qualifyingDetails:h}=p??{};m&&(p?.structures&&e.structures?.push(...p.structures),p?.links&&e.links?.push(...p.links));let g=e.structures?.find(({stage:b,stageSequence:S})=>b===Ae&&S===1),{qualifiersCount:I}=zv({stageSequence:1,drawDefinition:e,structureId:s,stage:Ae}),v=Math.max(f??0,I??0),w=fse({qualifiersCount:v,drawDefinition:e,stage:Ae});if(w.error||(w=eE({drawSize:m,stage:ze,drawDefinition:e}),w.error))return w;Zje({drawDefinition:e,drawEntries:a,event:c});let y=eGe({mainStructure:g,qualifyingDetails:h,drawDefinition:e});return y.error?y:{drawDefinition:e,structureId:s}}function Zje({drawDefinition:t,drawEntries:e,event:i}){for(let r of(e??[]).filter(({entryStage:n})=>n===ze)){let n={...r,entryStage:r.entryStage??Ae,drawDefinition:t,event:i};L2(n)}}function eGe({mainStructure:t,qualifyingDetails:e,drawDefinition:i}){for(let r of e||[]){let{finalQualifyingRoundNumber:n,finalQualifyingStructureId:a,roundTarget:s,finishingPositions:o,linkType:l}=r,u=t&&VU({targetStructureId:t.structureId,sourceStructureId:a,sourceRoundNumber:n,finishingPositions:o,targetEntryRound:s,linkType:l})?.link;if(u?.error)return u;u&&(i.links||(i.links=[]),i.links.push(u))}return{error:void 0}}function dle(t){let{participantIds:e}=t,i=t.drawDefinition?.entries?.filter(r=>{let n=r.entryStatus;return!t.restrictEntryStatus||uo.includes(n)}).map(yt)??[];if(e){let r=e.filter(n=>!i?.includes(n));if(r?.length)return q({result:{error:Co},info:{invalidParticipantIds:r}})}else e=i;return t.roundsCount&&t.restrictRoundsCount!==!1&&t.roundsCount>e.length-1&&(!t.enableDoubleRobin||t.roundsCount>(e.length-1)*2)?{error:re,info:"Not enough participants for roundsCount"}:t.roundsCount&&t.restrictRoundsCount!==!1&&t.roundsCount>31?{error:re,info:"roundsCount must be less than 32"}:{participantIds:e}}function QV(t){let e=[],{roundsCount:i=1,drawDefinition:r,matchUpsCount:n,structureId:a,idPrefix:s,isMock:o,event:l}=t,u,c=dle(t);if(c.error)return c;for(let d of Ce(1,i+1)){let p=bN({restrictMatchUpsCount:t.restrictMatchUpsCount,ignoreLastRoundNumber:!!u,newRound:!u,drawDefinition:r,matchUpsCount:n,structureId:a,roundNumber:u,idPrefix:s,isMock:o,event:l});if(p.error)return q({result:p,info:{iteration:d}});p.matchUps?.length&&e.push(...p.matchUps),u=(p?.roundNumber??1)+1}return{matchUps:e}}function tGe(t){let{tournamentRecord:e,participantIds:i,scaleName:r,eventType:n,adHocRatings:a={}}=t,s=t.scaleAccessor??Pr[r]?.accessor,o=e.participants??[];for(let l of i??[]){let u=o?.find(d=>d.participantId===l),c=Aq({scaleName:`${r}.${WB}`,participant:u,eventType:n});!c&&r&&(c=Aq({scaleAccessor:s,participant:u,scaleName:r,eventType:n})),c&&!a[l]&&(a[l]=c)}return a}function Aq({scaleType:t=ud,scaleAccessor:e,participant:i,scaleName:r,eventType:n}){let a=(i&&Xl({scaleAttributes:{eventType:n??Bm,scaleType:t,scaleName:r},participant:i}))?.scaleItem?.scaleValue;return e&&wt(a)?a[e]:a}function ZV(t){let e=rGe(t);if(e?.error)return e;let i=dle(t);if(i.error)return i;let r=iGe(t);if(r.error)return r;let n=tGe(t),a=t.tournamentRecord?.isMock??t.isMock,s=t.eventType??t.event?.eventType,o=[],l=[],u;for(let c of Ce(1,(t.roundsCount??1)+1)){let d=CV({...t,participantIds:i.participantIds,structure:r.structure,ignoreLastRoundNumber:!0,iterationMatchUps:o,adHocRatings:n,roundNumber:u,eventType:s,isMock:a});if(d.error)return d;let{matchUps:p,...f}=d;f.modifiedScaleValues&&(n=f.modifiedScaleValues),l.push({...f,iteration:c,matchUpsCount:p?.length}),u=(f?.roundNumber??1)+1,p?.length&&o.push(...p)}return{...W,matchUps:o,roundResults:l}}function iGe(t){if(t.structureId)return t.structureId;let e=t.drawDefinition,i=e?.structures?.filter(n=>n.stageSequence===1)?.reduce((n,a)=>{let s=a.stage&&Vm[a.stage];return Hn({structure:a})&&s>(Vm[n?.stage]||1)?a:n},void 0),r=e?.structures?.find(n=>n.structureId===i?.structureId);return r?Hn({structure:r})?{structure:r}:{error:mm}:{error:vi}}function rGe(t){return t.roundsCount&&typeof t.roundsCount!="number"?{error:re,info:"roundsCount must be a number"}:typeof t.drawDefinition!="object"||t.drawDefinition.drawType&&t.drawDefinition.drawType!==ua?{error:mm}:!Array.isArray(t.drawDefinition?.entries)&&t.participantIds&&!Array.isArray(t.participantIds)?{error:re,info:"Missing Entries"}:{error:void 0}}function nGe(t){let{tournamentRecord:e,drawDefinition:i,structureId:r,idPrefix:n,isMock:a,event:s}=t,o=s?.entries?.filter(({entryStage:c,entryStatus:d})=>(!c||c===Ae)&&d&&uo.includes(d)),l=o?.map(yt),u=o?Math.floor(o.length/2):0;if(t.automated)return aGe({...t,participantIds:l});{let c=QV({roundsCount:t.roundsCount,drawDefinition:i,matchUpsCount:u,idPrefix:n,isMock:a,event:s});if(c.error)return c;c.matchUps?.length&&hN({matchUps:c.matchUps,suppressNotifications:!0,tournamentRecord:e,drawDefinition:i,structureId:r,event:s})}return{...W}}function aGe(t){let{restrictEntryStatus:e,generateMatchUps:i,structureId:r,matchUpIds:n,scaleName:a,scaleAccessor:s}=t.drawMatic??{},o=ZV({...t,eventType:t.drawMatic?.eventType??t.matchUpType,generateMatchUps:i??!0,scaleAccessor:s??t.scaleAccessor,scaleName:a??t.scaleName,participantIds:t.participantIds,roundsCount:t.roundsCount,restrictEntryStatus:e,structureId:r,matchUpIds:n});return o.error?o:(o?.matchUps?.length&&hN({tournamentRecord:t.tournamentRecord,drawDefinition:t.drawDefinition,suppressNotifications:!0,matchUps:o.matchUps,event:t.event,structureId:r}),{...W})}function sGe({requireParticipantCount:t=!0,enforcePolicyLimits:e=!0,drawSizeProgression:i,participantsCount:r,participantCount:n,appliedPolicies:a,drawDefinition:s,seedingProfile:o,structureId:l,seedsCount:u}){r=r??n;let c=tt({drawDefinition:s,structureId:l});if(c.error)return c;let d=c.structure;if(!d)return{error:vi};let{positionAssignments:p}=pr({structure:d}),f=p?.length||0;if(u>f)return{error:Dte};let m=d.structures?.length,h=lt(o?.groupSeedingThreshold)&&o?.groupSeedingThreshold,g=z2({roundRobinGroupsCount:m,drawSize:f})?.seedGroups,{seedsCount:I}=JU({policyDefinitions:a,requireParticipantCount:t,drawSizeProgression:i,participantsCount:r,drawSize:f});return I&&a?.[Rs]&&u>I&&e&&(u=I),d.seedLimit=u,d.seedAssignments=Ce(1,u+1).map(v=>{let w=g?.find(S=>S.includes(v)),y=w&&Math.min(...w),b=h&&v>=h?y:v;return{participantId:void 0,seedNumber:v,seedValue:b}}),ii({drawDefinition:s,structureIds:[l]}),{...W,seedLimit:u}}function tg({sortDescending:t=!1,tournamentRecord:e,scaleAttributes:i,scaleSortMethod:r,stageSequence:n,entries:a,event:s,stage:o}){if(!e)return{error:ve};a=a??s?.entries??[];let l=a.filter(f=>(!o||!f.entryStage||f.entryStage===o)&&(!n||!f.entryStageSequence||f.entryStageSequence===n)&&uo.includes(f.entryStatus)),u={...i};return{scaledEntries:l.map(f=>{let{participantId:m}=f,{scaleItem:h}=zm({tournamentRecord:e,scaleAttributes:i,participantId:m});return{...f,...h}}).filter(f=>{let m=f.scaleValue;return!r&&(Number.isNaN(m)||!Number.parseFloat(m))?!1:m}).sort(r||(t||u?.ascending===!1?d:c))};function c(f,m){return p(f)-p(m)}function d(f,m){return p(m)-p(f)}function p(f){return Number.parseFloat(f.scaleValue||(t?-1:1e5))}}function ple(t){let e="prepareStage",{drawDefinition:i}=t,{structures:r}=io({stageSequence:t.stageSequence||1,roundTarget:t.roundTarget,stage:t.stage,drawDefinition:i}),n=t.preparedStructureIds||[],a=r?.find(({structureId:f})=>!n.includes(f));if(!a)return q({result:{error:vi},stack:e});let s=a?.structureId,{seedsCount:o,stageEntries:l,seedLimit:u}=mGe({...t,structureId:s});(t.seededParticipants||t.event||t.seedingScaleName)&&uGe({...t,seedsCount:o,structure:a,structureId:s});let c=t.automated!==!1&&t.drawType!==ua&&!(t.qualifyingOnly&&t.stage!==ze),d=(r?.length||0)>1,p=c?lGe({...t,multipleStructures:d,seedLimit:u,structureId:s}):{};return p?.error?q({result:p,stack:e}):{...p,stageEntries:l,structureId:s,seedsCount:o}}function oGe({entries:t,stage:e,stageSequence:i,roundTarget:r}){return t.filter(n=>{let a=ht({name:El,element:n})?.extension?.value;return(!n.entryStage||n.entryStage===e)&&(!i||!n.entryStageSequence||n.entryStageSequence===i)&&(!r||!a||a===r)&&Uf.includes(n.entryStatus)})}function lGe(t){let e=typeof t.automated=="object"&&t.automated.seedsOnly,i=BU({...t,seedsOnly:e});if(i.error)return i;let r=i?.positionAssignments,n=i?.positioningReport;return{conflicts:i.conflicts,positionAssignments:r,positioningReport:n}}function uGe(t){let{seededParticipants:e,seedingScaleName:i,entries:r,event:n}=t,a=r.map(yt);e?cGe({...t,enteredParticipantIds:a}):(n||i)&&dGe({...t,enteredParticipantIds:a})}function cGe(t){let{provisionalPositioning:e,enteredParticipantIds:i,seededParticipants:r,tournamentRecord:n,appliedPolicies:a,drawDefinition:s,seedingProfile:o,structureId:l,structure:u,event:c}=t,d=u?Xh({provisionalPositioning:e,appliedPolicies:a,drawDefinition:s,seedingProfile:o,structure:u}):void 0;r.filter(({participantId:p})=>i.includes(p)).filter(p=>!p.seedNumber||p.seedNumber<=r.length).sort((p,f)=>p.seedNumber<f.seedNumber?-1:p.seedNumber<f.seedNumber?1:0).forEach(p=>{let{participantId:f,seedNumber:m,seedValue:h}=p;Yv({provisionalPositioning:e,tournamentRecord:n,drawDefinition:s,seedingProfile:o,participantId:f,seedBlockInfo:d,structureId:l,seedNumber:m,seedValue:h,event:c})})}function dGe(t){let e=t.seedsCount,{provisionalPositioning:i,enteredParticipantIds:r,seedAssignmentProfile:n,assignSeedsCount:a,tournamentRecord:s,drawDefinition:o,seedByRanking:l,seedingProfile:u,structureId:c,event:d}=t,{categoryName:p,ageCategoryCode:f}=d?.category||{};d?.eventType;let m=pGe({...t})||l&&fGe({...t}),h=m?.length??0;h<e&&(e=h),m?.filter(({participantId:g})=>r.includes(g)).slice(0,a||e).forEach((g,I)=>{let v=I+1,{participantId:w,scaleValue:y}=g,b=n?.[v]||y||v;Yv({provisionalPositioning:i,tournamentRecord:s,drawDefinition:o,seedingProfile:u,participantId:w,structureId:c,seedNumber:v,seedValue:b,event:d})})}function pGe(t){let{tournamentRecord:e,seedingScaleName:i,stageSequence:r,entries:n,stage:a,event:s}=t,{categoryName:o,ageCategoryCode:l}=s?.category||{},u=s?.eventType,c={scaleName:i||o||l||s.eventId,scaleType:Yl,eventType:u};return tg({scaleAttributes:c,tournamentRecord:e,stageSequence:r,entries:n,stage:a}).scaledEntries}function fGe(t){let{tournamentRecord:e,stageSequence:i,event:r,entries:n,stage:a}=t,{categoryName:s,ageCategoryCode:o}=r?.category||{},l=r?.eventType;return tg({scaleAttributes:{scaleName:s||o,scaleType:vu,eventType:l},tournamentRecord:e,stageSequence:i,entries:n,stage:a}).scaledEntries}function mGe(t){let{seedsCount:e}=t;t.seededParticipants&&(e=t.seededParticipants.length),e>t.drawSize&&(e=t.drawSize);let i=oGe(t);e>i.length&&(e=i.length);let{seedLimit:r}=sGe({enforcePolicyLimits:t.enforcePolicyLimits??!0,appliedPolicies:t.appliedPolicies,participantsCount:i.length,seedingProfile:t.seedingProfile,drawDefinition:t.drawDefinition,structureId:t.structureId,seedsCount:e});return r&&r<e&&(e=r),{seedsCount:e,stageEntries:i,seedLimit:r}}function hGe(t){let e=EV({...t,modifyOriginal:!1});if(e.error)return e;let i=e.drawDefinition,{suppressDuplicateEntries:r=!0,ignoreStageSpace:n,appliedPolicies:a,qualifyingOnly:s,seedingProfile:o,participants:l,drawEntries:u,placeByes:c,drawSize:d,drawType:p,entries:f}=t,m=[],h=[],g=gGe({ignoreStageSpace:n,drawDefinition:i,drawEntries:u,drawType:p,entries:f});if(g.error)return g;let I=p===vf?0:Ke(t.seedsCount??0),v=ple({...t,qualifyingOnly:!d||s,appliedPolicies:a,drawDefinition:i,seedingProfile:o,participants:l,stage:Ae,seedsCount:I,placeByes:c,drawSize:d,entries:f});if(v.error&&!v.conflicts)return v;v.positioningReport?.length&&m.push({[Ae]:v.positioningReport});let w=v.structureId;return v.conflicts&&(h=v.conflicts),p===ua&&t.roundsCount&&nGe({...t,drawDefinition:i,structureId:w}),{drawDefinition:i,positioningReports:m,conflicts:h,structureId:w}}function gGe(t){let{ignoreStageSpace:e,drawDefinition:i,drawEntries:r,drawType:n,entries:a}=t;for(let s of a){if(r&&s.entryStage&&s.entryStage!==Ae)continue;let o={...s,ignoreStageSpace:e??n===ua,entryStage:s.entryStage??Ae,event:t.event,drawDefinition:i,drawType:n},l=L2(o);if(r&&l.error)return l}return{error:void 0}}var IGe=()=>({matchUpType:void 0,drawName:void 0,drawId:void 0,structures:[],entries:[],links:[]}),vGe=IGe;function yGe(t){let{drawId:e=Ct(),processCodes:i,matchUpType:r,drawType:n}=t??{},a=vGe();return Object.assign(a,{processCodes:i,matchUpType:r,drawType:n,drawId:e})}function ej(t){let e=t.structureIds,{tournamentRecord:i,drawDefinition:r,matchUpFormat:n,structureId:a,matchUpId:s,event:o}=t,l=He(t,[{[In]:!0,[$B]:!0}]);if(l.error)return l;if(!$a({matchUpFormat:n}))return{error:ZS};let u="setMatchUpFormat";if(s){let c=fi({drawDefinition:r,matchUpId:s,event:o});if(c.error)return c;let d=c.matchUp;if(d?.matchUpType===ar)return{info:"Cannot set matchUpFormat when { matchUpType: TEAM }",error:oa};d&&(d.matchUpFormat=n,Ut({tournamentId:i?.tournamentId,eventId:o?.eventId,context:u,drawDefinition:r,matchUp:d}))}else if(Array.isArray(e)){if(o?.eventType===ar)return{error:cu};for(let c of e){let d=tt({drawDefinition:r,structureId:c});if(d.error)return d;d.structure&&(d.structure.matchUpFormat=n)}}else if(a){if(o?.eventType===ar)return{error:cu};let c=tt({drawDefinition:r,structureId:a});if(c.error)return c;c.structure&&(c.structure.matchUpFormat=n)}else r&&(r.matchUpFormat=n);return e=e??(a?[a]:void 0),ii({drawDefinition:r,structureIds:e}),{...W}}function bGe({tieFormat:t}){let e=Gn({checkCollectionIds:!1,tieFormat:t});if(e.error)return e;for(let i of t.collectionDefinitions)i.collectionId||(i.collectionId=Ct());return{tieFormat:t}}function wGe({existingQualifyingStructures:t,tournamentRecord:e,drawDefinition:i,matchUpFormat:r,matchUpType:n,tieFormat:a,event:s}){if((r||a)&&!(r&&s?.matchUpFormat===r||s?.tieFormat&&a&&JSON.stringify(s.tieFormat)===JSON.stringify(a))){if(a){let o=bGe({tieFormat:a});if(o.error)return o;let l=t?.every(u=>u.tieFormat);(!t?.length||l)&&(i.tieFormat=o.tieFormat??a)}else if(r){let o=ej({tournamentRecord:e,drawDefinition:i,matchUpFormat:r,event:s});if(o.error)return{info:"matchUpFormat or tieFormat error",error:o.error}}n&&(i.matchUpType=n)}return{error:void 0}}var fle={};dt(fle,{attachPolicies:()=>Yp,findPolicy:()=>wf,getAppliedPolicies:()=>Dt,getPolicyDefinitions:()=>Gc,mutate:()=>mle,query:()=>gle,removePolicy:()=>hle});var mle={};dt(mle,{attachPolicies:()=>Yp,removePolicy:()=>hle});function hle(t){let e=He(t,[{[VFe]:!0,_anyOf:{[pn]:!1,[hr]:!1,[In]:!1,[Vc]:!1}}]);if(e.error)return e;let i,r=t.drawDefinition??t.event??((t.tournamentId||!t.tournamentRecords)&&t.tournamentRecord);if(r)return kq(t,r);if(t.tournamentRecords){let n=Object.keys(t.tournamentRecords);if(!n.length)return{error:ve};for(let a of n){let s=t.tournamentRecords[a],o=kq(t,s);if(o.error)return o;i=!0}}else return{error:ve};return i?{...W}:{error:eU}}function kq(t,e){let i=Dt(t).appliedPolicies??{};return i[t.policyType]?(delete i[t.policyType],Object.keys(i).length?Ft({element:e,extension:{name:Qb,value:i}}):Nn({element:e,name:Qb}),{...W}):{error:eU}}var gle={};dt(gle,{findPolicy:()=>wf,getAppliedPolicies:()=>Dt,getPolicyDefinitions:()=>Gc});var Ile={[Rs]:{validSeedPositions:{ignore:!0},duplicateSeedNumbers:!0,drawSizeProgression:!0,seedingProfile:{drawTypes:{[gu]:{positioning:Vp},[eo]:{positioning:Vp}},positioning:Bre},policyName:"USTA SEEDING",seedsCountThresholds:[{drawSize:4,minimumParticipantCount:3,seedsCount:2},{drawSize:16,minimumParticipantCount:12,seedsCount:4},{drawSize:32,minimumParticipantCount:24,seedsCount:8},{drawSize:64,minimumParticipantCount:48,seedsCount:16},{drawSize:128,minimumParticipantCount:96,seedsCount:32},{drawSize:256,minimumParticipantCount:192,seedsCount:64}]}},Yx=Ile;function SGe({appliedPolicies:t,policyDefinitions:e,drawDefinition:i,stack:r}){if(e&&typeof e!="object")return q({info:"policyDefinitions must be an object",result:{error:re},stack:r});let n={[Jb]:t?.[Jb]};return e?UGe({policyDefinitions:e,appliedPolicies:t,policiesToAttach:n,drawDefinition:i}):n.avoidance&&Yp({drawDefinition:i,policyDefinitions:n}),!t?.[Rs]&&!e?.[Rs]&&(Yp({policyDefinitions:Yx,drawDefinition:i}),t&&Object.assign(t,Yx)),{error:void 0}}function UGe({policyDefinitions:t,appliedPolicies:e,policiesToAttach:i,drawDefinition:r}){for(let n of Object.keys(t))JSON.stringify(e?.[n])!==JSON.stringify(t[n])&&(i[n]=t[n]);Object.keys(i).length&&(Yp({policyDefinitions:i,drawDefinition:r}),e&&Object.assign(e,i))}function TGe(t){let{tournamentRecord:e,policyDefinitions:i,appliedPolicies:r,matchUpFormat:n,matchUpType:a,tieFormat:s,drawType:o,stack:l,event:u}=t,c=t.drawId?u?.drawDefinitions?.find(I=>I.drawId===t.drawId):void 0,d=c?.structures?.find(I=>I.stage===Ae&&I.stageSequence===1)?.structureId,p=c?c.structures?.filter(I=>I.stage===ze):[],f=p?.length===1&&!p[0].matchUps?.length&&p[0].structureId;c&&o!==c.drawType&&(c.drawType=o);let m=c??yGe({processCodes:t.processCodes,drawId:t.drawId,drawType:o}),h=wGe({existingQualifyingStructures:p,tournamentRecord:e,drawDefinition:m,matchUpFormat:n,matchUpType:a,tieFormat:s,event:u});if(h.error)return q({result:h,stack:l});let g=SGe({appliedPolicies:r,policyDefinitions:i,drawDefinition:m,stack:l});return g.error?g:{drawDefinition:m,structureId:d,existingDrawDefinition:c,existingQualifyingPlaceholderStructureId:f}}function DGe(t){let e="generateOrGetExisting",i=[],r=[],n=TGe(t);if(n.error)return q({result:n,stack:e});let a=n.existingDrawDefinition,s,o,l=t.drawEntries??t.eventEntries??[],u=n.existingQualifyingPlaceholderStructureId&&Qje({...t,...n})||hGe({...t,...n,entries:l});return u.error?q({result:u,stack:e}):(u.positioningReports?.length&&i.push(...u.positioningReports??[]),u.conflicts?.length&&r.push(...u.conflicts??[]),s=u.drawDefinition,o=u.structureId,{existingDrawDefinition:a,positioningReports:i,drawDefinition:s,structureId:o,conflicts:r,entries:l})}function PGe(t){let{qualifyingPlaceholder:e,existingDrawDefinition:i,positioningReports:r,qualifyingProfiles:n,appliedPolicies:a,qualifyingOnly:s,drawDefinition:o,seedingProfile:l,participants:u,structureId:c,tieFormat:d,entries:p,stack:f}=t,m=e&&!n?.length&&!i,h=[];if(n){let g=(y,b)=>y.stageSequence-b.stageSequence,I=(y,b)=>y.roundTarget-b.roundTarget,v=[],w=1;n.sort(I);for(let y of n){if(!Array.isArray(y.structureProfiles))return q({info:qp("structureProfiles"),result:{error:Je},stack:f});w=y.roundTarget||w;let b=y.structureProfiles?.sort(g)||[],S=1;for(let U of b){let{qualifyingRoundNumber:T,qualifyingPositions:P,seededParticipants:D,seedingScaleName:E,seedsCount:R=0,seedByRanking:C,placeByes:M,drawSize:N}=U,A=ple({...t,seedingProfile:U.seedingProfile??l,stageSequence:S,qualifyingRoundNumber:T,preparedStructureIds:v,qualifyingPositions:P,seededParticipants:D,stage:ze,seedingScaleName:E,appliedPolicies:a,drawDefinition:o,qualifyingOnly:s,seedByRanking:C,participants:u,roundTarget:w,seedsCount:R,placeByes:M,drawSize:N,entries:p});if(A.error)return A;A.structureId&&v.push(A.structureId),S+=1,A.conflicts?.length&&h.push(...A.conflicts),A.positioningReport?.length&&r.push({[ze]:A.positioningReport})}w+=1}}else if(c&&m){let g=ss({structureName:Qr(ze),stage:ze,qualifyingOnly:s,tieFormat:d}),{link:I}=VU({sourceStructureId:g.structureId,targetStructureId:c,sourceRoundNumber:0,linkType:fu});o.structures||(o.structures=[]),o.structures.push(g),o.links||(o.links=[]),o.links.push(I)}return{qualifyingConflicts:h,error:void 0}}var vle={};dt(vle,{addGoesTo:()=>zp,allCompetitionMatchUps:()=>No,allDrawMatchUps:()=>An,allEventMatchUps:()=>xu,allPlayoffPositionsFilled:()=>Z2,allTournamentMatchUps:()=>Ur,analyzeDraws:()=>qU,analyzeMatchUp:()=>uw,analyzeTournament:()=>cj,bulkUpdatePublishedEventIds:()=>mj,calculateWinCriteria:()=>ig,categoryCanContain:()=>aU,checkMatchUpIsComplete:()=>yp,checkValidEntries:()=>yN,compareTieFormats:()=>Cc,competitionScheduleMatchUps:()=>iT,courtGridRows:()=>VN,credits:()=>EGe,drawMatchUps:()=>Rj,eventMatchUps:()=>HN,filterMatchUps:()=>Yu,filterParticipants:()=>xU,findDrawDefinition:()=>wV,findExtension:()=>ht,findVenue:()=>Ou,getAggregateTeamResults:()=>uj,getAllDrawMatchUps:()=>Zi,getAllEventData:()=>hj,getAllStructureMatchUps:()=>At,getAllowedDrawTypes:()=>kN,getAllowedMatchUpFormats:()=>sj,getAppliedPolicies:()=>Dt,getAssignedParticipantIds:()=>Pf,getAvailableMatchUpsCount:()=>gN,getAvailablePlayoffProfiles:()=>GU,getCategoryAgeDetails:()=>Bp,getCheckedInParticipantIds:()=>Wh,getCompetitionDateRange:()=>xN,getCompetitionMatchUps:()=>lw,getCompetitionParticipants:()=>tj,getCompetitionPenalties:()=>oj,getCompetitionVenues:()=>YU,getCourtInfo:()=>ZM,getCourts:()=>Cj,getDrawData:()=>IN,getDrawDefinitionTimeItem:()=>h2,getDrawParticipantRepresentativeIds:()=>yV,getDrawStructures:()=>io,getDrawTypeCoercion:()=>XU,getEligibleVoluntaryConsolationParticipants:()=>vV,getEntriesAndSeedsCount:()=>jN,getEvent:()=>Aj,getEventData:()=>KU,getEventMatchUpFormatTiming:()=>yj,getEventProperties:()=>Mj,getEventPublishStatus:()=>Qa,getEventStructures:()=>oN,getEventTimeItem:()=>vU,getEvents:()=>Nj,getFlightProfile:()=>Bi,getHomeParticipantId:()=>Uj,getLinkedTournamentIds:()=>mU,getMatchUpCompetitiveProfile:()=>EU,getMatchUpContextIds:()=>Tj,getMatchUpDailyLimits:()=>zN,getMatchUpDailyLimitsUpdate:()=>bj,getMatchUpDependencies:()=>co,getMatchUpFormat:()=>Dj,getMatchUpFormatTiming:()=>RU,getMatchUpFormatTimingUpdate:()=>vj,getMatchUpScheduleDetails:()=>eN,getMatchUpType:()=>tN,getMatchUpsMap:()=>Or,getMatchUpsStats:()=>Pj,getMatchUpsToSchedule:()=>LN,getMaxEntryPosition:()=>Ij,getModifiedMatchUpFormatTiming:()=>GN,getPairedParticipant:()=>ro,getParticipantEventDetails:()=>ij,getParticipantIdFinishingPositions:()=>bV,getParticipantMembership:()=>rj,getParticipantResults:()=>kU,getParticipantScaleItem:()=>zm,getParticipantSchedules:()=>nj,getParticipantSignInStatus:()=>aj,getParticipantTimeItem:()=>g2,getParticipants:()=>Ri,getPersonRequests:()=>Ef,getPolicyDefinitions:()=>Gc,getPositionAssignments:()=>OI,getPositionsPlayedOff:()=>Xv,getPredictiveAccuracy:()=>Sj,getProfileRounds:()=>BN,getPublishState:()=>Yh,getRandomQualifierList:()=>TV,getRoundMatchUps:()=>Sn,getRounds:()=>Ej,getScaleValues:()=>_v,getScaledEntries:()=>tg,getScheduledRoundsDetails:()=>ZU,getSchedulingProfile:()=>zc,getSchedulingProfileIssues:()=>gj,getSeedingThresholds:()=>q2,getSeedsCount:()=>JU,getStructureSeedAssignments:()=>hs,getTeamLineUp:()=>Wp,getTieFormat:()=>FN,getTimeItem:()=>Ss,getTournamentIds:()=>pU,getTournamentInfo:()=>eg,getTournamentPenalties:()=>ON,getTournamentPersons:()=>lj,getTournamentPoints:()=>Qv,getTournamentPublishStatus:()=>OU,getTournamentStructures:()=>Q2,getTournamentTimeItem:()=>qM,getValidGroupSizes:()=>_U,getVenueData:()=>AI,getVenuesAndCourts:()=>Fu,isAdHoc:()=>Hn,isCompletedStructure:()=>Su,isValidForQualifying:()=>DV,isValidMatchUpFormat:()=>$a,matchUpActions:()=>vN,participantScaleItem:()=>Xl,participantScheduledMatchUps:()=>wj,positionActions:()=>UV,publicFindCourt:()=>R2,publicFindVenue:()=>E2,tallyParticipantResults:()=>qh,tieFormatGenderValidityCheck:()=>TM,tournamentMatchUps:()=>WN,validMatchUp:()=>YM,validMatchUps:()=>Ka,validateCollectionDefinition:()=>sU,validateLineUp:()=>sN});function EGe(){return`
    This project would not have been possible without the generous input and patience
    of tournament organizers and directors who worked with early versions of CourtHive/TMX.

    Thanks to Miro, Pavel, Ivan, Mladen, Zdenko, Antonia, Jakov, Kreso, Barry, Jeff, Bobby... to name just a few. 

    The project would not have even begun without the support of Miro, or the introduction by Sretchko.
    The project would not have succeeded without the enthusiasm of Randy and Bruce.
    Thanks to serendipity and Luca and the ensuing TODS conversations with ITF.
    Thanks to Scott and Jake for sanity checks, suggestions, and camaraderie.
    Thanks to Zoran for inspiring the async support and getting into the weeds with subscriptions.
    Thanks to Dave for backing the conversion of TMX 1.x source into the factory repository.
    Thanks to Vuk and Pavle and Rich and Chris and Deepa for the direct engagement with the APIs.
    Thanks to Joe for repeatedly challenging me and the many pointers to useful tooling.
    Thanks to Shannon for the validation of the approach from his deep domain experience.
    Thanks to Nikola for the ongoing camaraderie and explorations of what we can do with TODS.

    And a special thanks to my family for putting up with the long days and weeks and months of coding
    and conversations at all hours.
  `}var yle={};dt(yle,{filterParticipants:()=>xU,getCompetitionParticipants:()=>tj,getPairedParticipant:()=>ro,getParticipantEventDetails:()=>ij,getParticipantMembership:()=>rj,getParticipantScaleItem:()=>zm,getParticipantSchedules:()=>nj,getParticipantSignInStatus:()=>aj,getParticipantTimeItem:()=>g2,getParticipants:()=>Ri,getScaleValues:()=>_v,participantScaleItem:()=>Xl,validateLineUp:()=>sN});function tj(t){let{tournamentRecords:e}=t||{};if(typeof e!="object"||!Object.keys(e).length)return{error:Mi};let i=[],r={},n={},a={},s=[],o={},l=[];for(let u of Object.values(e)){let{participantIdsWithConflicts:c,mappedMatchUps:d,participantMap:p,participants:f,matchUps:m,derivedEventInfo:h,derivedDrawInfo:g}=Ri({...t,tournamentRecord:u});Object.assign(o,d),Object.assign(r,p),Object.assign(n,h),Object.assign(a,g),i.push(...f??[]),s.push(...m??[]),c?.forEach(I=>{l.includes(I)||l.push(I)})}return{participantIdsWithConflicts:l,derivedEventInfo:n,derivedDrawInfo:a,participantMap:r,mappedMatchUps:o,participants:i,...W,matchUps:s}}function ij({tournamentRecord:t,participantId:e}){if(!t)return{error:ve};if(!e)return{error:dr};let i=[e].concat((t.participants??[]).filter(r=>r?.participantType&&[_t,ft].includes(r.participantType)&&r.individualParticipantIds?.includes(e)).map(r=>r.participantId));return{eventDetails:(t.events??[]).filter(r=>{let n=(r?.entries??[]).map(a=>a.participantId);return xn(n,i)}).map(r=>({eventName:r.eventName,eventId:r.eventId}))}}function rj({tournamentRecord:t,participantId:e}){if(!t)return{error:ve};if(!e)return{error:dr};let{participants:i}=Ri({participantFilters:{participantTypes:[_t,ft,Ya]},tournamentRecord:t});return(i??[]).filter(r=>r.individualParticipantIds?.includes(e)).reduce((r,n)=>{let a=n.participantType;return a&&(r[a]||(r[a]=[]),r[a].push(n)),r},{})}function nj({participantFilters:t={},tournamentRecord:e}){if(!e)return{error:ve};if(typeof t!="object")return{error:Bc,context:{participantFilters:t}};let i={eventIds:t.eventIds},r=Ur({tournamentRecord:e,contextFilters:i}).matchUps??[],n=Object.assign({},...r.map(l=>({[l.matchUpId]:l}))),a=r.filter(({schedule:l})=>l&&Object.keys(l).length),s=co({tournamentRecord:e,matchUps:r}).sourceMatchUpIds??[],o={};for(let l of a){let{sides:u}=l,c,d=u?.map(f=>{if(f.participant)return[f.participant].concat(...f.participant.individualParticipants||[]);s[l.matchUpId]&&!c&&(c=(s[l.matchUpId]||[]).map(m=>n[m]).filter(({winningSide:m,bye:h})=>!m&&!h))}).filter(Boolean).flat()??[];for(let f of d){let{participantId:m}=f;o[m]||(o[m]={potentialMatchUps:[],participant:f,matchUps:[]}),o[m].matchUps.push(l)}let p=c?.map(({sides:f})=>f).flat().map(({participant:f})=>f&&[f].concat(...f.individualParticipants||[])).filter(Boolean).flat()||[];for(let f of p){let{participantId:m}=f;o[m]||(o[m]={potentialMatchUps:[],participant:f,matchUps:[]}),o[m].potentialMatchUps.push(l)}}return{participantSchedules:Object.values(o).filter(({participant:l})=>!(t.participantIds&&!t.participantIds.includes(l.participantId)||t.participantTypes&&!t.participantTypes.includes(l.participantType))),...W}}function aj({tournamentRecord:t,participantId:e}){if(!t)return{error:ve};if(!e)return{error:dr};let{participant:i}=Xd({tournamentRecord:t,participantId:e});if(!i)return{error:ji};let{timeItem:r}=Ss({itemType:IU,element:i});return r&&r.itemValue===ew&&ew}var ble={};dt(ble,{analyzeDraws:()=>qU,analyzeTournament:()=>cj,getAggregateTeamResults:()=>uj,getAllowedDrawTypes:()=>kN,getAllowedMatchUpFormats:()=>sj,getAppliedPolicies:()=>Dt,getCompetitionDateRange:()=>xN,getCompetitionPenalties:()=>oj,getPolicyDefinitions:()=>Gc,getTournamentInfo:()=>eg,getTournamentPenalties:()=>ON,getTournamentPersons:()=>lj,getTournamentPoints:()=>Qv,getTournamentStructures:()=>Q2,getTournamentTimeItem:()=>qM});function sj({tournamentRecord:t,categoryName:e,categoryType:i}){if(!t)return{error:ve};let{appliedPolicies:r}=Dt({tournamentRecord:t});return(r?.[ms]?.matchUpFormats||[]).filter(({categoryNames:n,categoryTypes:a})=>!e&&!a||e&&n?.includes(e)||i&&a?.includes(i))}function kN({tournamentRecord:t,categoryName:e,categoryType:i}){if(!t)return{error:ve};let{appliedPolicies:r}=Dt({tournamentRecord:t});return(r?.[jP]?.allowedDrawTypes||[]).filter(({categoryNames:n,categoryTypes:a})=>!e&&!a||e&&n?.includes(e)||i&&a?.includes(i))}function ON({tournamentRecord:t}){if(!t)return{error:ve};let e=(t?.participants??[]).reduce((i,r)=>{let{participantId:n}=r;return(r.penalties??[]).forEach(a=>{let{penaltyId:s}=a||{};i[s]?i[s].participants.push(n):i[s]={...a,participantIds:[n]}}),i},{});return{penalties:Object.values(e)}}function oj({tournamentRecords:t}){if(typeof t!="object"||!Object.keys(t).length)return{error:Mi};let e=[];for(let i of Object.values(t)){let{penalties:r}=ON({tournamentRecord:i});e.push(...r??[])}return{penalties:e}}function xN({tournamentRecords:t}){if(!wt(t))return{error:Mi};let e=Object.keys(t??{}).reduce((n,a)=>{let s=t[a],{tournamentInfo:{startDate:o,endDate:l}}=eg({tournamentRecord:s}),u=o&&Ze(o),c=u&&new Date(u);(!n.startDate||c&&c<n.startDate)&&(n.startDate=c);let d=l&&Ze(l),p=d&&new Date(d);return(!n.endDate||p&&p>n.endDate)&&(n.endDate=p),n},{startDate:void 0,endDate:void 0}),i=e.startDate&&Ze(e.startDate.toISOString()),r=e.endDate&&Ze(e.endDate.toISOString());return!i||!r?{error:qte}:{startDate:i,endDate:r}}function lj({tournamentRecord:t,participantFilters:e}){if(!t)return{error:ve};let i=t.participants||[];e&&(i=xU({participants:i,participantFilters:e,tournamentRecord:t}));let r={},n=a=>{if(a.person){let{personId:s}=a.person;r[s]?r[s].participantIds.push(a.participantId):r[s]={...a.person,participantIds:[a.participantId]}}};return i.forEach(a=>{a.person&&n(a)}),{tournamentPersons:Object.values(r)}}function uj(t){let e=He(t,[{[hr]:!0}]);if(e.error)return e;let i=t.finishingPositionRangeBounsPoints||{},r={},n=d=>{let p=d?.individualParticipants?.map(f=>f.teams?.length===1&&f.teams[0]);return d?.teams?.length===1&&d?.teams?.[0]||p?.[0].participantId===p?.[1].participantId&&p?.[0]},{matchUps:a,participants:s}=Ri({participantFilters:{participantTypes:[It]},withRankingProfile:!0,withStatistics:!0,...t});for(let d of s??[]){if(d.participantType===$n)continue;d.draws?.[0]?.drawId==="draw-0-3"&&console.log(d.participantType,d.draws[0].finishingPositionRange);let p=n(d);if(p)for(let f of d?.draws??[]){let m=f?.finishingPositionRange?.join("-");if(m&&i?.[m]){let h=p?.participantId,g=f?.drawId,I=`${h}|${g}|${m}`;r[I]=i[m]}}}let o=d=>({teamName:d,standingPoints:0,pointsPlayed:0,pointsPct:0,points:0,bonus:0,diff:0,loss:0,win:0}),l=(d,p,f)=>{d[p]===void 0&&(d[p]=0),d[p]+=f},u={},c={};for(let d of a??[]){let{sides:p,matchUpFormat:f}=d,m=f&&qi(f);if(p?.length===2&&m.setFormat?.timed&&(!m.finalSetFormat||m.finalSetFormat?.timed))for(let h of p){let g=n(h.participant),I=g?.participantId,v=h.participant?.participantId,w=g?.participantName,y=h.sideNumber,b=h.participant?.individualParticipantIds||v&&[v]||[];if(b.forEach(S=>{S&&!u[S]&&(u[S]=o(w))}),I&&y){c[I]||(c[I]=o(w));let S=[...b.map(T=>u[T]),c[I]];d.winningSide&&(y===d.winningSide?S.forEach(T=>l(T,"win",1)):S.forEach(T=>l(T,"loss",1)));let U=d.score?.sets||[];for(let T of U){let P=T?.[`side${3-y}Score`]||0,D=T?.[`side${y}Score`]||0,E=D-P;S.forEach(R=>l(R,"pointsPlayed",D+P)),S.forEach(R=>l(R,"points",D)),S.forEach(R=>l(R,"diff",E))}}}}for(let d of Object.keys(r)){let[p]=d.split("|");c[p]&&(c[p].bonus+=r[d],c[p].pointsPct=parseFloat((c[p].points/c[p].pointsPlayed).toFixed(2)),c[p].standingPoints=c[p].win+c[p].bonus)}for(let d of Object.keys(u))u[d].pointsPct=parseFloat((u[d].points/u[d].pointsPlayed).toFixed(2));return{...W,individualResults:u,teamResults:c}}function RGe(t){let e=t.participants?.filter(({participantType:a})=>a===_t)?.length===2,i=t.events?.length===1&&t.events[0],r=i?.drawDefinitions?.length===1&&i.drawDefinitions[0],n=(r?.structures?.length===1&&r.structures[0])?.positionAssignments?.length===2;return!!(i.tieFormat&&e&&n)}function cj({tournamentRecord:t}){if(!t)return{error:ve};let{drawsAnalysis:e}=qU({tournamentRecord:t}),i={isDual:RGe(t),drawsAnalysis:e},r=Ri({tournamentRecord:t});return r.missingParticipantIds?.length&&(i.missingParticipantIds=r.missingParticipantIds),{...W,analysis:i}}function Fg(t,e){return t&&e&&Array.isArray(e)&&e[t-1]||typeof e=="object"&&e[t]}function dj({qualityWinProfiles:t,wonMatchUpIds:e,mappedMatchUps:i,participantSideMap:r,tournamentParticipants:n,tournamentStartDate:a,level:s}){let o=0,l=[],u={};for(let c of n)u[c.participantId]=c;for(let c of t){let{rankingScaleName:d,rankingSnapshot:p="latestAvailable",includeWalkovers:f=!1,rankingRanges:m=[],maxBonusPerTournament:h,unrankedOpponentBehavior:g="noBonus"}=c,I=0;for(let v of e){let w=i[v];if(!w)continue;let{matchUpStatus:y,sides:b=[],winningSide:S}=w;if(!f&&(y===ai||y===qt))continue;let U=r[v];if(!U||S!==U)continue;let T=b.find(R=>R.sideNumber!==U)?.participantId;if(!T)continue;let P=u[T];if(!P)continue;let D=CGe({participant:P,rankingScaleName:d,rankingSnapshot:p,tournamentStartDate:a});if(!D){if(g==="noBonus")continue;continue}let E=m.find(R=>D>=R.rankRange[0]&&D<=R.rankRange[1]);if(E){let R;if(typeof E.value=="number")R=E.value;else if(typeof E.value=="object"){let C=Fg(s,E.value.level??E.value);typeof C=="number"&&(R=C)}R&&(I+=R,l.push({opponentParticipantId:T,opponentRank:D,points:R,matchUpId:v}))}}h!==void 0&&I>h&&(I=h),o+=I}return{qualityWinPoints:o,qualityWins:l}}function CGe({participant:t,rankingScaleName:e,rankingSnapshot:i,tournamentStartDate:r}){let n=(t.timeItems||[]).filter(o=>{if(!o?.itemType)return!1;let l=o.itemType.split(".");return l[0]===Sd&&l[1]===vu&&l[3]===e});if(!n.length)return;let a=n;if(i==="tournamentStart"&&r){let o=new Date(r).getTime();a=n.filter(l=>(l.itemDate?new Date(l.itemDate).getTime():0)<=o)}if(!a.length)return;a.sort((o,l)=>(o.createdAt?new Date(o.createdAt).getTime():0)-(l.createdAt?new Date(l.createdAt).getTime():0));let s=a[a.length-1]?.itemValue;return typeof s=="number"?s:void 0}var MGe="RANKING_POINTS",NGe="QUALITY_WIN",AGe="fullToEach",wle="splitEven",kGe="teamOnly",Sle=["ageCategoryCodes","genders","categoryNames","categoryTypes","ratingTypes","ballTypes","wheelchairClasses","subTypes"],Ule=["eventTypes","drawTypes","drawSizes","maxDrawSize","stages","stageSequences","levels","maxLevel","flights","maxFlightNumber","participationOrder","dateRanges"],OGe={RANKING_POINTS:MGe,QUALITY_WIN:NGe,FULL_TO_EACH:AGe,SPLIT_EVEN:wle,TEAM_ONLY:kGe,CATEGORY_SCOPE_FIELDS:Sle,PROFILE_SCOPE_FIELDS:Ule};function pj(t){let{participation:e={},awardProfiles:i,wheelchairClass:r,startDate:n,eventType:a,drawSize:s,drawType:o,category:l,endDate:u,gender:c,level:d}=t,{participationOrder:p,flightNumber:f,rankingStage:m}=e,h=b=>!n&&!u||!b.dateRanges?!0:b.dateRanges.some(S=>{let U=!n||!S.startDate||new Date(n)>new Date(S.startDate),T=!u||!S.endDate||new Date(u)<=new Date(S.endDate);return U&&T}),g=b=>{if(!b)return!0;let S=l||{};return!(b.ageCategoryCodes?.length&&!b.ageCategoryCodes.includes(S.ageCategoryCode)||b.genders?.length&&!b.genders.includes(c)||b.categoryNames?.length&&!b.categoryNames.includes(S.categoryName)||b.categoryTypes?.length&&!b.categoryTypes.includes(S.type)||b.ratingTypes?.length&&!b.ratingTypes.includes(S.ratingType)||b.ballTypes?.length&&!b.ballTypes.includes(S.ballType)||b.wheelchairClasses?.length&&!b.wheelchairClasses.includes(r)||b.subTypes?.length&&!b.subTypes.includes(S.subType))},I=b=>h(b)&&(!b.maxFlightNumber||f<=b.maxFlightNumber)&&(!b.drawTypes?.length||b.drawTypes?.includes(o))&&(!b.drawSizes?.length||b.drawSizes.includes(s))&&(!b.stages?.length||b.stages.includes(m))&&(!b.levels?.length||b.levels.includes(d))&&(!b.maxDrawSize||s<=b.maxDrawSize)&&(!b.drawSize||b.drawSize===s)&&(!b.maxLevel||d<=b.maxLevel)&&(!f||!b.flights?.flightNumbers?.length||b.flights.flightNumbers.includes(f))&&(!b.participationOrder||b.participationOrder===p)&&g(b.category)&&(!b.eventTypes?.length||b.eventTypes?.includes(a)),v=i.filter(I);if(v.length===0)return{awardProfile:void 0};if(v.length===1)return{awardProfile:v[0]};let w=v.filter(b=>b.priority!==void 0);if(w.length){let b=Math.max(...w.map(S=>S.priority));return{awardProfile:w.find(S=>S.priority===b)}}let y=v.map((b,S)=>({profile:b,score:xGe(b),index:S}));return y.sort((b,S)=>S.score-b.score||b.index-S.index),{awardProfile:y[0].profile}}function xGe(t){let e=0;for(let i of Ule){let r=t[i];if(r!=null){if(Array.isArray(r)&&r.length===0)continue;e+=1}}if(t.category)for(let i of Sle){let r=t.category[i];Array.isArray(r)&&r.length>0&&(e+=1)}return e}function aE({participantWon:t,flightNumber:e,valueObj:i,drawSize:r,flights:n,level:a}){let s=(m,h)=>{if(m){if(Array.isArray(h)){let g=h.find(I=>I.flight===m||I.f===m);return g.value||g.v}if(typeof h=="object"){let g=h.flights||h.f;if(Array.isArray(g))return g[m-1]}}},o=(m,h)=>{let g=m?.value||m?.v||(lt(m)?m:0),I=Fg(a,m?.level);return{value:s(h,I)||lt(I)&&I||g}},l=0,u,c,d,p,f=t&&"won"||t===!1&&"lost"||void 0;if(Array.isArray(i)){let m=i.find(I=>I.drawSize===r||I.drawSizes?.includes(r)),h=i.find(I=>I.drawSize&&I.threshold&&r>I.drawSize),g=i.find(I=>!I.drawSize&&!I.drawSizes?.length);f!==void 0&&(m=m?.[f],h=h?.[f],g=g?.[f]),c=o(m,e).value,d=o(h,e).value,p=o(g,e).value,l=c||d||p,u=c&&m.requireWin||d&&h.requireWin||g?.requireWin}else if(typeof i=="object"){let m=i?.drawSizes?.[r],h=i;f!==void 0&&(m=m?.[f],h=h?.[f]),c=o(m,e).value,p=o(h,e).value,l=c||p,u=c?m.requireWin:h?.requireWin}else lt(i)&&f===void 0&&(l=i);return e&&n?.pct?.[e]&&(l=Math.round(l*n.pct[e])),{awardPoints:l,requireWin:u}}function Qv({participantFilters:t,policyDefinitions:e,tournamentRecord:i,level:r}){if(!i)return{error:ve};let n=la(),{policyDefinitions:a}=Gc({policyTypes:[fD],tournamentRecord:i}),s=e?.[fD]??a?.[fD];if(!s)return{error:uM};let o=s.awardProfiles,l=s.requireWinFirstRound,u=s.requireWinForPoints,c=s.doublesAttribution,d=s.qualityWinProfiles,{participants:p,derivedEventInfo:f,derivedDrawInfo:m,mappedMatchUps:h}=Ri({withRankingProfile:!0,participantFilters:t,tournamentRecord:i}),g=p?.filter(S=>S.draws?.length),I={},v={};for(let S of i.participants||[])S.person?.personId&&(I[S.participantId]=S.person.personId),S.individualParticipantIds?.length&&(v[S.participantId]=S.individualParticipantIds);let w={},y={},b={};for(let S of g??[]){let{participantType:U,participantId:T,person:P,draws:D}=S;for(let E of D){let{drawId:R,structureParticipation:C,eventId:M}=E,N=f[M],A=m[R],O=A?.drawType,{category:k,eventType:F,gender:x,wheelchairClass:L}=N||{},$=E.startDate||N.startDate||i.startDate,V=E.endDate||N.endDate||i.endDate;if(F===Ua&&U!==$n)continue;let _;if(o){let B=u,G=0,j=0,K=0,Y=0,X,Z,J=0,ae,te,ne;for(let le of C){let{finishingPositionRange:de,participationOrder:pe,participantWon:ge,flightNumber:Me,rankingStage:Pe,winCount:Be}=le;if(G+=Be||0,Array.isArray(de)&&de.length){let ce=Math.min(...de);(te===void 0||ce<te)&&(te=ce)}let fe=A?.drawSize,{awardProfile:Te}=pj({wheelchairClass:L,awardProfiles:o,participation:le,eventType:F,startDate:$,category:k,drawSize:fe,drawType:O,endDate:V,gender:x,level:r});if(Te){if(!fe)continue;if(Te.profileName&&(Z=Te.profileName),ne||(ne=Te),ae===void 0&&Te.maxCountableMatches!==void 0){let ee=Te.maxCountableMatches;if(typeof ee=="number")ae=ee;else if(typeof ee=="object"){let Se=Fg(r,ee.level??ee);typeof Se=="number"&&(ae=Se)}}let ce=Array.isArray(de)&&Math.max(...de),ye=nt(de||[]).join("-"),be=ce&&Pe!==ze&&de?.includes(fe);Te.requireWinForPoints!==void 0&&(B=Te.requireWinForPoints),Te.requireWinFirstRound!==void 0&&(l=Te.requireWinFirstRound);let{finishingPositionPoints:Fe={},finishingPositionRanges:we,finishingRound:Ne,pointsPerWin:me,flights:Ee}=Te,Le=Array.isArray(Te.perWinPoints)?Te.perWinPoints?.find(ee=>ee.participationOrders?.includes(pe)):Te.perWinPoints,Q=Fe.participationOrders,se=0,oe;if((!Q||Q.includes(pe))&&we&&ce){let ee=we[ce];ee&&({awardPoints:se,requireWin:oe}=aE({flightNumber:Me,valueObj:ee,drawSize:fe,flights:Ee,level:r}))}if(!se&&Ne&&pe===1&&ce){let ee=Ne[ce];ee&&({awardPoints:se,requireWin:oe}=aE({participantWon:ge,flightNumber:Me,valueObj:ee,drawSize:fe,flights:Ee,level:r}))}be&&l!==void 0&&(B=l),oe!==void 0&&(B=oe),se>j&&(!B||Be)&&(j=se,X=ce,ne=Te);let ue=ae!==void 0?Math.min(Be||0,Math.max(0,ae-J)):Be;if(!se&&me&&ue&&(K+=ue*me,J+=ue,X=ye),!se&&Be&&Le){let ee=Fg(r,Le?.level);typeof ee=="number"?(K+=(ue||0)*ee,J+=ue||0):!ee&&Le.value&&(K+=(ue||0)*Le.value,J+=ue||0)}}if(U===$n&&Te){let ce=Array.isArray(Te.perWinPoints)?Te.perWinPoints?.find(be=>be.participationOrders?.includes(pe)):Te.perWinPoints,ye=ce&&Fg(r,ce.level);if(ye){let be=(S.matchUps||[]).filter(({structureId:Fe})=>Fe===le.structureId);for(let{matchUpId:Fe}of be){let we=h[Fe],Ne=we?.sides?.find(me=>me.participantId===T)?.sideNumber;if(!(!Ne||we.winningSide!==Ne))for(let me of we.tieMatchUps||[]){if(!me.winningSide)continue;let{collectionPosition:Ee}=me,Le;if(typeof ye=="object"&&ye.line){if(ye.limit&&Ee>ye.limit)continue;Le=ye.line[Ee-1]}else typeof ye=="number"&&(Le=ye);if(Le)for(let Q of me.sides||[]){if(Q.sideNumber!==me.winningSide)continue;let se=Q.participantId;if(!se)continue;let oe=v[se]||[se];for(let ue of oe){let ee=I[ue];ee&&(w[ee]||(w[ee]=[]),w[ee].push({linePoints:Le,collectionPosition:Ee,eventType:F,drawId:R}))}}}}}}}if(ne?.bonusPoints&&te!==void 0){for(let le of ne.bonusPoints)if(le.finishingPositions?.includes(te)){let de=le.value;if(typeof de=="number")Y=de;else if(typeof de=="object"){let pe=Fg(r,de.level??de);typeof pe=="number"&&(Y=pe)}break}}if(_=j+K+Y,K||j||Y){let le={winCount:G,positionPoints:j,rangeAccessor:X,perWinPoints:K,bonusPoints:Y,eventType:F,drawId:R,points:_,category:k,drawType:O,startDate:$,endDate:V,level:r};n&&Z&&(le.profileName=Z);let de=P?.personId;if(de)w[de]||(w[de]=[]),w[de].push(le);else if(U===ft){if(b[T]||(b[T]=[]),b[T].push(le),c){let pe=c===wle?.5:1,ge=v[T]||[];for(let Me of ge){let Pe=I[Me];if(!Pe)continue;let Be={...le,points:Math.round(le.points*pe),positionPoints:Math.round(le.positionPoints*pe),perWinPoints:Math.round(le.perWinPoints*pe),bonusPoints:Math.round(le.bonusPoints*pe),doublesParticipantId:T};w[Pe]||(w[Pe]=[]),w[Pe].push(Be)}}}else U===$n&&(y[T]||(y[T]=[]),y[T].push(le))}if(d?.length&&S.matchUps){let le=Object.values(S.matchUps).filter(de=>de.drawId===R&&de.participantWon);if(le.length){let de=le.map(Pe=>Pe.matchUpId),pe={};for(let Pe of le)pe[Pe.matchUpId]=Pe.sideNumber;let{qualityWinPoints:ge,qualityWins:Me}=dj({qualityWinProfiles:d,wonMatchUpIds:de,mappedMatchUps:h,participantSideMap:pe,tournamentParticipants:i.participants||[],tournamentStartDate:i.startDate,level:r});if(ge>0){let Pe=P?.personId;Pe&&(w[Pe]||(w[Pe]=[]),w[Pe].push({qualityWinPoints:ge,qualityWins:Me,eventType:F,drawId:R}))}}}}}}return{participantsWithOutcomes:g,personPoints:w,pairPoints:b,teamPoints:y,...W}}var Tle={};dt(Tle,{compareTieFormats:()=>Cc,getTieFormat:()=>FN,tieFormatGenderValidityCheck:()=>TM,validateCollectionDefinition:()=>sU});function sE(t){if(!t)return{};let e=[],i=t.tieFormatName,r=t.collectionDefinitions?.map(n=>{let{matchUpType:a,matchUpFormat:s,matchUpCount:o,category:l,gender:u}=n;e.includes(s)||e.push(s);let c=l?.ageCategoryCode;return[o,a===_p?"D":"S",c,s,u].join(";")}).join("|");return{tieFormatName:t&&i||"UNNAMED",matchUpFormats:e,tieFormatDesc:r}}function Cc({considerations:t={},descendant:e,ancestor:i}){let r={},n={},{matchUpFormats:a,tieFormatDesc:s}=sE(e),{matchUpFormats:o,tieFormatDesc:l}=sE(i),u=nt((a??[]).filter(b=>!(o??[]).includes(b)).concat((o??[]).filter(b=>!(a??[]).includes(b)))),c=!!(t?.collectionName&&e.collectionDefinitions.map(({collectionName:b})=>b).join("|")!==i.collectionDefinitions.map(({collectionName:b})=>b).join("|")),d=!!(t?.collectionOrder&&e.collectionDefinitions.map(({collectionOrder:b})=>b).join("|")!==i.collectionDefinitions.map(({collectionOrder:b})=>b).join("|")),p=Object.assign({},...(e?.collectionDefinitions||[]).map(b=>({[b.collectionId]:b}))),f=Object.assign({},...(i?.collectionDefinitions||[]).map(b=>({[b.collectionId]:b})));r.collectionIds=Wz(Object.keys(p),Object.keys(f)),n.collectionIds=Wz(Object.keys(f),Object.keys(p)),r.collectionsValue=Oq(p),n.collectionsValue=Oq(f),r.groupsCount=i?.collectionGroups?.length??(0-(e?.collectionGroups?.length??0)||0),n.groupsCount=r.groupsCount?-1*r.groupsCount:0;let m=r.collectionsValue.totalValue-n.collectionsValue.totalValue,h=r.collectionsValue.totalMatchUps-n.collectionsValue.totalMatchUps,g=n.collectionsValue.assignmentValues.length!==r.collectionsValue.assignmentValues.length,I=n.collectionsValue.assignmentValues.some((b,S)=>{let U=r.collectionsValue.assignmentValues[S];return!U||b.valueKey!==U.valueKey||b.value!==U.value?!0:Array.isArray(b.value)?b.value.every((T,P)=>U.value[P]===T):!1}),v=c||d||l!==s||g||I||m!==0,w=[...n.collectionsValue.invalidValues,...r.collectionsValue.invalidValues],y=w.length&&w;return{matchUpFormatDifferences:u,matchUpCountDifference:h,descendantDifferences:r,ancestorDifferences:n,orderDifference:d,valueDifference:m,nameDifference:c,descendantDesc:s,ancestorDesc:l,...W,different:v,invalid:y}}function Oq(t){let e=[],i=[],r=0;return{totalValue:Object.keys(t).sort(rN).reduce((n,a)=>{let s=t[a],{collectionValueProfiles:o,collectionValue:l,matchUpCount:u,matchUpValue:c,scoreValue:d,setValue:p}=s,f={collectionValueProfiles:o,collectionValue:l,matchUpValue:c,scoreValue:d,setValue:p},m=Object.keys(f).filter(g=>![void 0,null].includes(f[g])&&(!Array.isArray(f[g])||f[g].length>0));m.length!==1&&e.push({collectionId:a});let h=m[0];if(h){let g=h==="collectionValueProfiles"?Object.values(o):f[h];i.push({valueKey:h,value:g})}return r+=u,o?.length?n+o.reduce((g,I)=>g+I.value,0):u?lt(c)?n+c*u:lt(d)?n+d*u:lt(p)?n+p*u:n+l:n},0),totalMatchUps:r,invalidValues:e,assignmentValues:i}}function fj(t){Object.assign(t,{inContext:!0});let{matchUp:e,error:i}=Dle(t);return{matchUp:Oe(e,!0,!0),error:i}}function Dle({participantsProfile:t,afterRecoveryTimes:e,tournamentRecord:i,contextContent:r,contextProfile:n,drawDefinition:a,nextMatchUps:s,matchUpId:o,inContext:l,eventId:u,drawId:c,event:d}){if(!i)return{error:ve};if(typeof o!="string")return{error:Tn};if(!a||!d){let m=(Ur({tournamentRecord:i,nextMatchUps:s}).matchUps??[]).find(h=>h.matchUpId===o);if(!m)return{error:dn};({eventId:u,drawId:c}=m),{event:d,drawDefinition:a}=Wn({tournamentRecord:i,eventId:u,drawId:c})}if(!a)return{error:_a};n&&!r&&(r=Hc({tournamentRecord:i,contextProfile:n}));let p={surfaceCategory:d?.surfaceCategory??i.surfaceCategory,indoorOutDoor:d?.indoorOutdoor??i.indoorOutdoor,endDate:d?.endDate??i.endDate,tournamentId:i.tournamentId,eventId:u??d?.eventId,drawId:c},{participants:f=[]}=bf({participantsProfile:t,tournamentRecord:i,contextProfile:n,inContext:l});if(s){let m=(An({context:l?p:void 0,participants:f,afterRecoveryTimes:e,contextContent:r,contextProfile:n,drawDefinition:a,nextMatchUps:s,inContext:l,event:d}).matchUps??[]).find(g=>g.matchUpId===o);if(!m)return{error:dn};let h=a?.structures?.find(g=>g.structureId===m.structureId);return{drawDefinition:a,structure:h,matchUp:m}}else{let{matchUp:m,structure:h}=fi({context:l?p:void 0,tournamentParticipants:f,afterRecoveryTimes:e,contextContent:r,drawDefinition:a,contextProfile:n,matchUpId:o,inContext:l,event:d});return{matchUp:m,structure:h,drawDefinition:a}}}function FN({tournamentRecord:t,drawDefinition:e,structureId:i,matchUpId:r,structure:n,eventId:a,drawId:s,event:o}){if(!t)return{error:ve};if(!s&&!o&&!i&&!r)return q({result:{error:Je},stack:"getTieFormat"});a&&!o&&(o=t.events?.find(f=>f.eventId===a));let l=fj({tournamentRecord:t,drawDefinition:e,matchUpId:r,drawId:s,event:o});if(r&&l?.error)return l;if(!e&&l?.drawDefinition&&(e=l?.drawDefinition),n=n??l?.structure,!n&&i&&!r){if(!e)return{error:xo};let f=tt({drawDefinition:e,structureId:i});if(f.error)return f;n=f.structure}let u=(n?.tieFormat||n?.tieFormatId)&&yn({structure:n,drawDefinition:e,event:o})?.tieFormat,c=(e?.tieFormat||e?.tieFormatId)&&yn({drawDefinition:e,event:o})?.tieFormat,d=yn({event:o})?.tieFormat,p=yn({matchUp:l?.matchUp,drawDefinition:e,structure:n,event:o})?.tieFormat;return{...W,matchUp:l?.matchUp,structureDefaultTieFormat:Gr(u),eventDefaultTieFormat:Gr(d),drawDefaultTieFormat:Gr(c),tieFormat:Gr(p),structure:n}}var Ple={};dt(Ple,{bulkUpdatePublishedEventIds:()=>mj,getAllEventData:()=>hj,getCourtInfo:()=>ZM,getDrawData:()=>IN,getEventData:()=>KU,getEventPublishStatus:()=>Qa,getPublishState:()=>Yh,getTournamentPublishStatus:()=>OU,getVenueData:()=>AI});function mj({tournamentRecord:t,outcomes:e}){if(!t)return{error:ve};if(!e?.length)return{error:Je,info:"Missing outcomes"};let i=e.reduce((n,a)=>{let{drawId:s,eventId:o}=a;return o&&s&&(n[o]?n[o].includes(s)||n[o].push(s):n[o]=[s]),n},{}),r=Object.keys(i);return{publishedEventIds:(t.events?.filter(n=>r.includes(n.eventId))).filter(n=>{let a=Qa({event:n}),{drawDetails:s,drawIds:o}=a??{},{eventId:l}=n;return i[l].filter(u=>{let c=s?Object.keys(a.drawDetails).filter(d=>F2({drawId:d,drawDetails:s})):[];return o?.includes(u)||c.includes(u)}).length}).map(n=>n.eventId),eventIdPublishedDrawIdsMap:i}}function hj({tournamentRecord:t,policyDefinitions:e}){if(!t)return{error:ve};let i=t.events||[],r=t?.participants||[],{tournamentInfo:n}=eg({tournamentRecord:t}),{venues:a}=Fu({tournamentRecord:t}),s=i.map(o=>{let{eventId:l}=o,u=zse({event:o}).eventInfo,c=yU({tournamentRecord:t,event:o}).scheduleTiming,d=(o.drawDefinitions||[]).map(f=>{let{drawId:m,drawName:h,matchUpFormat:g,updatedAt:I}=f,v={drawId:m,drawName:h,matchUpFormat:g,updatedAt:I},{abandonedMatchUps:w,completedMatchUps:y,upcomingMatchUps:b,pendingMatchUps:S}=Hv({requireParticipants:!0,tournamentParticipants:r,context:{eventId:l},policyDefinitions:e,tournamentRecord:t,inContext:!0,scheduleTiming:c,drawDefinition:f,event:o});return{drawInfo:v,matchUps:{abandonedMatchUps:w,completedMatchUps:y,upcomingMatchUps:b,pendingMatchUps:S}}}),p=Qa({event:o});return Object.assign(u,{drawsData:d,publish:p}),u});return{allEventData:{tournamentInfo:n,venuesData:a,eventsData:s}}}var Ele={};dt(Ele,{courtGridRows:()=>VN,findVenue:()=>Ou,getMatchUpsToSchedule:()=>LN,getPersonRequests:()=>Ef,getProfileRounds:()=>BN,getScheduledRoundsDetails:()=>ZU,getSchedulingProfile:()=>zc,getSchedulingProfileIssues:()=>gj,publicFindCourt:()=>R2});function FI({matchUpPotentialParticipantIds:t,matchUpNotBeforeTimes:e,timeAfterRecovery:i,matchUp:r}){let{individualParticipantIds:n}=WM(r);i=i??r.schedule?.timeAfterRecovery;let a=u=>{t[u]||(t[u]=[]),t[u]=nt(t[u].concat(...n))},s=u=>{i&&(!e[u]||i>e[u])&&(e[u]=i)},o=r.winnerTo?.matchUpId||r.winnerMatchUpId;o&&(i&&s(o),a(o));let l=r.loserTo?.matchUpId||r.loserMatchUpId;l&&(i&&s(l),a(l)),r.sidesTo?.length&&r.sidesTo.forEach(({matchUpId:u})=>{u&&(i&&s(u),a(u))})}function LN(t){let e=He(t,[{[jB]:!0}]);if(e.error)return e;let{matchUpPotentialParticipantIds:i,dateScheduledMatchUpIds:r=[],scheduleCompletedMatchUps:n,matchUpNotBeforeTimes:a,matchUpScheduleTimes:s,orderedMatchUpIds:o,clearDate:l,matchUps:u}=t,c=s?Object.keys(s):[],d=(o??[]).map(f=>u.find(m=>m.matchUpId===f)).filter(Boolean).filter(f=>{let m=!l&&(r.includes(f.matchUpId)||c.includes(f.matchUpId)),h=["BYE",qt,Oi,Ta,Sr,ai,Si,Wi].includes(f?.matchUpStatus);return n||!m&&!f.winningSide&&!h}),p=i&&a?d.reduce((f,m)=>{let{drawId:h,tournamentId:g}=m;return f.matchUpMap[g]||(f.matchUpMap[g]={}),f.matchUpMap[g][h]?f.matchUpMap[g][h].push(m):f.matchUpMap[g][h]=[m],FI({matchUpPotentialParticipantIds:i,matchUpNotBeforeTimes:a,matchUp:m}),f},{matchUpMap:{}}).matchUpMap:{};return{matchUpsToSchedule:d,matchUpMap:p}}function _N({defaultRecoveryMinutes:t=0,defaultAverageMinutes:e,tournamentRecords:i,matchUpFormat:r,categoryName:n,categoryType:a,tournamentId:s,eventType:o,eventId:l}){if(!$a({matchUpFormat:r}))return{error:ZS};let u=Object.keys(i).filter(d=>!s||d===s),c;return u.forEach(d=>{if(c)return;let p=i[d],f=l?Wn({tournamentRecord:p,eventId:l})?.event:void 0;return c=RU({tournamentRecord:p,matchUpFormat:r,categoryName:n,categoryType:a,eventType:o,event:f}),c?.averageMinutes||c?.recoveryMinutes}),{recoveryMinutes:c?.recoveryMinutes||t,averageMinutes:c?.averageMinutes||e,typeChangeRecoveryMinutes:c?.typeChangeRecoveryMinutes||c?.recoveryMinutes||t}}function ZU(t){let e=He(t,[{[HB]:{tournamentRecords:!1,tournamentRecord:!1}},{rounds:!0,[qn]:sn}]);if(e.error)return e;let{scheduleCompletedMatchUps:i,periodLength:r=30}=t,n=t.tournamentRecords||t.tournamentRecord&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord}||{};if(typeof n!="object")return{error:Mi};let a={},s=[],o=t.rounds.toSorted((m,h)=>(m.sortOrder??0)-(h.sortOrder??0)),l=t.containedStructureIds??Object.assign({},...Object.values(n).map(m=>jv({tournamentRecord:m}).containedStructures)),u=t.matchUps??No({nextMatchUps:!0,tournamentRecords:n}).matchUps,c=0,d={},p={},f={};return{scheduledRoundsDetails:o.flatMap(m=>{let h=m.periodLength||r,g=[];l?.[m.structureId]?g.push(...l[m.structureId]):g.push(m.structureId);let I=u?Yu({tournamentIds:[m.tournamentId],roundNumbers:[m.roundNumber],matchUpIds:m.matchUpIds,eventIds:[m.eventId],drawIds:[m.drawId],processContext:!0,structureIds:g,matchUps:u}).sort(zh):[],{segmentNumber:v,segmentsCount:w}=m.roundSegment||{};if(lt(v)&&Ro(I?.length)&&Ro(w)&&v>0&&v<=w&&w<I?.length&&!m.matchUpIds?.length){let U=I.length/w,T=U*(v-1);I=I.slice(T,T+U)}let y=n[m.tournamentId],b=Wn({drawId:m.drawId,tournamentRecord:y}).event,S=[];for(let U of I){let T=U.matchUpFormat;T&&(a[T]||(a[T]=[],a[T].push(U)),S.push(T))}for(let U of S){let{eventType:T,category:P}=b??{},{categoryName:D,ageCategoryCode:E}=P??{},{typeChangeRecoveryMinutes:R,recoveryMinutes:C,averageMinutes:M,error:N}=_N({categoryName:D??E,categoryType:P?.categoryType,tournamentId:m.tournamentId,eventId:m.eventId,tournamentRecords:n,matchUpFormat:U,eventType:T});if(N)return{error:N,round:m};let A=I.filter(k=>(i||!Ki.includes(k.matchUpStatus))&&k.matchUpStatus!=="BYE").map(vr);A.forEach(k=>{f[k]={typeChangeRecoveryMinutes:R,recoveryMinutes:C,averageMinutes:M},d[k]=C,p[k]=M}),s.push(...A),c=Math.max(M||0,c);let O=`${M}|${h}`;return{roundPeriodLength:h,recoveryMinutes:C,averageMinutes:M,matchUpIds:A,hash:O}}}),greatestAverageMinutes:c,matchUpFormatCohorts:a,recoveryMinutesMap:d,averageMinutesMap:p,orderedMatchUpIds:s,minutesMap:f,...W}}function Rle({schedulingProfile:t,venueIds:e,eventIds:i,drawIds:r}){let n=[],a=t?.map(o=>{let l=Ze(o?.scheduleDate);if(!l){n.push(`Invalid date: ${o?.scheduledDate}`);return}let u=(o?.venues||[]).map(c=>{let{rounds:d,venueId:p}=c;if(!e?.includes(p)){n.push(`Missing venueId: ${p}`);return}let f=d.filter(m=>{let h=i.includes(m.eventId)&&r.includes(m.drawId);return h||n.push(`Invalid eventId: ${m.eventId} or drawId: ${m.drawId}`),h});if(f.length)return{venueId:p,rounds:f}}).filter(Boolean);return u.length&&l&&{...o,venues:u}}).filter(Boolean),s=n.length;return{updatedSchedulingProfile:a,modifications:s,issues:n}}function $N({tournamentRecords:t,schedulingProfile:e}){if(!e)return{valid:!0};if(!Array.isArray(e))return{valid:!1,error:re};let{venueIds:i,tournamentsMap:r}=LGe({tournamentRecords:t}),n,a,s=e.every(o=>{let{scheduleDate:l,venues:u}=o;return Mn(l)?u.every(c=>{let{venueId:d,rounds:p}=c;return typeof d!="string"?(a="venueId should be a string",!1):Array.isArray(p)?i.includes(d)?!!p.every(f=>{if(!f)return a="empty round",!1;let{roundSegment:m,tournamentId:h,structureId:g,roundNumber:I,eventId:v,drawId:w}=f,y=r?.[h]?.[v]?.[w]?.[g]?.includes(I);y||(a="Invalid rounds");let{segmentNumber:b,segmentsCount:S}=m||{},U=!m||lt(b)&&Ro(S)&&b<=S;return U||(a="Invalid segment"),y&&U}):(n=If,!1):(a="rounds should be an array",!1)}):!1});return!s&&!n&&(n=re),{valid:!!s,error:n,info:a}}function FGe(t){let{tournamentRecord:e={},tournamentMap:i={},requireCourts:r}=t,n=[],a=[],s=[],o=[],l=(e?.venues||[]).map(({venueId:c,courts:d})=>(!r||d?.length)&&c),u=e?.tournamentId;if(u){n.push(u),i[u]={};let c=e?.events||[];for(let d of c){let p=d.eventId;s.push(p),i[u][p]={};let f=m=>parseInt(m);for(let m of d.drawDefinitions||[]){let h=m.drawId;o.push(h),i[u][p][h]={};let{structures:g}=io({drawDefinition:m});for(let I of g||[]){let v=I.structureId,{matchUps:w}=At({structure:I}),{roundMatchUps:y}=Sn({matchUps:w}),b=y&&Object.keys(y).map(f);if(i[u][p][h][v]=b,a.push(v),I.structures?.length)for(let S of I.structures)a.push(S.structureId),i[u][p][h][S.structureId]=b}}}}return{tournamentMap:i,tournamentIds:n,structureIds:a,venueIds:l,eventIds:s,drawIds:o}}function LGe(t){let e=t?.tournamentRecords&&Object.values(t?.tournamentRecords)||[],i={},{venueIds:r,eventIds:n,drawIds:a,structureIds:s,tournamentIds:o}=e.reduce((l,u)=>{let{tournamentIds:c,tournamentMap:d,structureIds:p,venueIds:f,eventIds:m,drawIds:h}=FGe({tournamentRecord:u});return f.forEach(g=>{l.venueIds.includes(g)||l.venueIds.push(g)}),l.tournamentIds.push(...c),l.structureIds.push(...p),l.eventIds.push(...m),l.drawIds.push(...h),Object.assign(i,d),l},{tournamentIds:[],structureIds:[],venueIds:[],eventIds:[],drawIds:[]});return{tournamentsMap:i,tournamentIds:o,structureIds:s,venueIds:r,eventIds:n,drawIds:a}}function zc({tournamentRecords:t,tournamentRecord:e}){if(typeof t!="object"||!Object.keys(t).length)return{error:Mi};let{extension:i}=ht({element:e,name:Hm,tournamentRecords:t,discover:!0}),r=i?.value||[];if(r.length){let{venueIds:n}=YU({requireCourts:!0,tournamentRecords:t}),{eventIds:a,drawIds:s}=fV({tournamentRecords:t}),{updatedSchedulingProfile:o,modifications:l,issues:u}=Rle({schedulingProfile:r,venueIds:n,eventIds:a,drawIds:s});if(l){r=o;let c=Zv({tournamentRecords:t,tournamentRecord:e,schedulingProfile:r});return c.error?c:{schedulingProfile:r,modifications:l,issues:u}}}return{schedulingProfile:r,modifications:0}}function Zv({tournamentRecords:t,tournamentRecord:e,schedulingProfile:i}){let r=$N({tournamentRecords:t,schedulingProfile:i});return r.error?r:i?Ft({tournamentRecords:t,discover:!0,extension:{name:Hm,value:i}}):Nn({element:e,name:Hm,tournamentRecords:t,discover:!0})}function eT(t){let{tournamentRecord:e}=t,i=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(!t.schedulingProfile){let{modifications:u,issues:c}=zc({tournamentRecords:i,tournamentRecord:e});return{success:!u,modifications:u,issues:c}}let{venueIds:r}=YU({tournamentRecords:i}),{eventIds:n,drawIds:a}=fV({tournamentRecords:i}),{updatedSchedulingProfile:s,modifications:o,issues:l}=Rle({schedulingProfile:t.schedulingProfile,venueIds:r,eventIds:n,drawIds:a});return o?{...Zv({schedulingProfile:s,tournamentRecords:i}),modifications:o,issues:l}:{...W,modifications:o,issues:l}}function gj(t){let{scheduleDates:e=[],tournamentRecords:i,periodLength:r=30}=t??{};if(typeof i!="object")return{error:KS};if(!Array.isArray(e))return{error:re};if(!e.every(Mn))return{error:or};let n=[],a=0,s={},{schedulingProfile:o}=zc({tournamentRecords:i});if(!o)return{issues:n,...W};let{matchUps:l}=No({nextMatchUps:!0,tournamentRecords:i});for(let c of o){let{scheduleDate:d,venues:p=[]}=c;if(!e?.length||e.includes(d)){for(let f of p||[])if(f){let{rounds:m}=f,h=[],{orderedMatchUpIds:g,scheduledRoundsDetails:I}=ZU({tournamentRecords:i,periodLength:r,matchUps:l,rounds:m}),{matchUpDependencies:v}=co({tournamentRecords:i,matchUps:l}),w=y=>{let b;return I?.find((S,U)=>{let T=S.matchUpIds.includes(y);return T&&(b=U),T}),b};if(g?.forEach((y,b)=>{let S=g.slice(b+1),U=Li(S,v?.[y]?.matchUpIds||[]);U.length&&h.push({matchUpId:y,shouldBeAfter:U})}),h.length){a+=h.length;let y=h.map(({matchUpId:b,shouldBeAfter:S})=>{let U=w(b),T=nt(S.map(w));return s[d]||(s[d]={}),s[d][U]||(s[d][U]=[]),T.forEach(P=>{s[d][U].includes(P)||s[d][U].push(P)}),{matchUpId:b,matchUpRoundIndex:U,earlierRoundIndices:T,shouldBeAfter:S}});n.push(...y)}}}}let u={matchUpIdShouldBeAfter:Object.assign({},...n.map(c=>{let{matchUpId:d,shouldBeAfter:p,earlierRoundIndices:f}=c;return{[d]:{earlierRoundIndices:f,shouldBeAfter:p}}}))};return{issuesCount:a,profileIssues:u,roundIndexShouldBeAfter:s,...W}}function Ef(t){let{tournamentRecords:e,requestType:i}=t,r=He(t,[{[pn]:!0}]);if(r.error)return r;let n={};for(let a of Object.values(e)){let{extension:s}=ht({element:a,name:Bv}),o=s?.value||[];for(let l of o){let{personId:u,requests:c}=l||{};n[u]||(n[u]=[]);for(let d of c)i&&d.requestType!==i||n[u].push(d)}}return{personRequests:n,...W}}function Kx(t){let{containerStructureId:e,roundSegment:i,isRoundRobin:r,tournamentId:n,roundNumber:a,structureId:s,eventId:o,drawId:l}=t,u=r?e:s,c=[n,o,l,u,a].join("|");return je({structureId:u,roundSegment:i,tournamentId:n,roundNumber:a,eventId:o,drawId:l,id:c})}function xq({round:t,matchUps:e,events:i,tournamentRecords:r}){let n=i.find(p=>p.eventId===t.eventId),{eventType:a,category:s,categoryType:o}=n||{},{categoryName:l,ageCategoryCode:u}=s||{},c=Sa(e.map(({matchUpFormat:p})=>p)),d=0;return Object.keys(c).forEach(p=>{let f=c[p],m=_N({categoryName:l||u,tournamentId:t.tournamentId,eventId:t.eventId,tournamentRecords:r,matchUpFormat:p,categoryType:o,eventType:a});if(m.error)return m;let h=m.averageMinutes*f;isNaN(d)||(d+=h)}),{roundMinutes:d}}function _Ge(t){return(t||[]).reduce((e,i)=>{let r=(i.finishingPositionRange?.winner||[]).reduce((a,s)=>a+s,0),n=(i.finishingPositionRange?.winner||[]).join("-")||"";return!e.minFinishingSum||r<e.minFinishingSum?{minFinishingSum:r,winnerFinishingPositionRange:n}:e},{minFinishingSum:0,winnerFinishingPositionRange:""})}function Fq(t){let e=t.length,i=t.filter(({sides:u})=>u?.some(({bye:c})=>c)).length||0,r=t.filter(({winningSide:u,matchUpStatus:c})=>u||Ki.includes(c)).length||0,n=t.filter(({schedule:u,matchUpStatus:c})=>u?.scheduledDate&&u?.scheduledTime&&c!=="BYE").length||0,a=e-i,s=a===r,o=a-n,l=a-n;return{unscheduledCount:o,incompleteCount:l,scheduledCount:n,completedCount:r,matchUpsCount:e,isScheduled:a===n,isComplete:s,byeCount:i}}function BN({tournamentRecords:t,schedulingProfile:e,tournamentRecord:i,withRoundId:r}){if(i&&!t){if(typeof i!="object")return{error:KS};t={[i.tournamentId]:i}}if(e){let a=$N({tournamentRecords:t,schedulingProfile:e});if(a.error)return a}if(!e&&t){let a=zc({tournamentRecords:t});if(a.error)return a;e=a.schedulingProfile}if(!e)return{error:Br};let n={};return{profileRounds:e.map(({venues:a,scheduleDate:s})=>a.map(({rounds:o})=>o.map(l=>{let u=Kx(l);return u.roundSegment?.segmentsCount&&(n[u.id]=u.roundSegment.segmentsCount),je({id:r?u.id:void 0,scheduleDate:s,...u})}))).flat(1/0),segmentedRounds:n}}function Md({court:t,date:e}){let i=e&&t.dateAvailability?.find(n=>pu(n.date,e)),r=t.dateAvailability?.find(n=>!n.date);return i||r}function $Ge({court:t,date:e}){let i=Md({court:t,date:e}),r=new Map,n=[];return(i?.bookings||[]).forEach(a=>{if(typeof a.courtOrder=="number"){let s=a.rowCount||1;for(let o=0;o<s;o++)r.set(a.courtOrder+o,a)}else n.push(a)}),{gridBookings:r,timeBookings:n}}function VN({courtPrefix:t="C|",minRowsCount:e,courtsData:i,scheduledDate:r}){if(!Array.isArray(i))return{error:re};let n=i?.reduce((o,l)=>{let u=l.matchUps||[],c=Math.max(0,...u.map(d=>d.schedule.courtOrder||0));return Math.max(c,o)},1),a=Math.max(e||0,n),s=Ce(0,a).map(o=>({matchUps:Ce(0,i.length).map(l=>{let u=i[l],{courtId:c,venueId:d}=u;if(r){let{gridBookings:p}=$Ge({court:u,date:r});if(p.has(o+1)){let f=p.get(o+1);return{schedule:{courtOrder:o+1,venueId:d,courtId:c},isBlocked:!0,booking:f}}}return{schedule:{courtOrder:o+1,venueId:d,courtId:c}}})}));return i.forEach((o,l)=>{for(let u of o.matchUps){let c=u.schedule?.courtOrder;c&&(s[c-1].matchUps[l]=u)}}),{courtPrefix:t,rows:s.map((o,l)=>Object.assign({rowId:`rowId-${l+1}`},...o.matchUps.map((u,c)=>({[`${t}${c}`]:u}))))}}var Cle={};dt(Cle,{getEntriesAndSeedsCount:()=>jN,getMaxEntryPosition:()=>Ij});function jN({policyDefinitions:t,drawDefinition:e,drawSize:i,drawId:r,event:n,stage:a}){if(!n)return{error:ui};let{entries:s,stageEntries:o}=Lae({drawDefinition:e,drawId:r,stage:a,event:n}),l=o.length,{drawSize:u}=loe({participantsCount:l}),c=JU({drawSize:i??u,participantsCount:l,policyDefinitions:t});if(c.error)return q({result:c,stack:"getEntriesAndSeedsCount"});let{seedsCount:d}=c;return{entries:s,seedsCount:d,stageEntries:o}}function Ij(t){let{entries:e=[],entryStatus:i,stage:r}=t;return Math.max(...e.filter(n=>(!r||r===n.entryStage)&&(!i||n.entryStatus===i)&&!isNaN(n.entryPosition)).map(({entryPosition:n})=>Ke(n||0)),0)}var Mle={};dt(Mle,{allCompetitionMatchUps:()=>No,allDrawMatchUps:()=>An,allEventMatchUps:()=>xu,allTournamentMatchUps:()=>Ur,analyzeMatchUp:()=>uw,calculateWinCriteria:()=>ig,checkMatchUpIsComplete:()=>yp,competitionScheduleMatchUps:()=>iT,drawMatchUps:()=>Rj,eventMatchUps:()=>HN,filterMatchUps:()=>Yu,getAllDrawMatchUps:()=>Zi,getAllStructureMatchUps:()=>At,getCheckedInParticipantIds:()=>Wh,getCompetitionMatchUps:()=>lw,getEventMatchUpFormatTiming:()=>yj,getHomeParticipantId:()=>Uj,getMatchUpCompetitiveProfile:()=>EU,getMatchUpContextIds:()=>Tj,getMatchUpDailyLimits:()=>zN,getMatchUpDailyLimitsUpdate:()=>bj,getMatchUpDependencies:()=>co,getMatchUpFormat:()=>Dj,getMatchUpFormatTiming:()=>RU,getMatchUpFormatTimingUpdate:()=>vj,getMatchUpScheduleDetails:()=>eN,getMatchUpType:()=>tN,getMatchUpsStats:()=>Pj,getModifiedMatchUpFormatTiming:()=>GN,getParticipantResults:()=>kU,getPredictiveAccuracy:()=>Sj,getRoundMatchUps:()=>Sn,getRounds:()=>Ej,isValidMatchUpFormat:()=>$a,matchUpActions:()=>vN,participantScheduledMatchUps:()=>wj,tallyParticipantResults:()=>qh,tournamentMatchUps:()=>WN,validMatchUp:()=>YM,validMatchUps:()=>Ka});function Nle({tournamentRecords:t,extensionName:e}){if(typeof t!="object"||!Object.keys(t).length)return{error:Mi};let i=[],r;for(let n of Object.values(t)){let{extension:a}=ht({element:n,name:e});a&&!r&&(i.push({params:{extension:a,discover:!0},method:"addExtension"}),r=!0);let s=n.events??[];for(let o of s){let{eventId:l}=o,{extension:u}=ht({name:e,element:o});u&&i.push({params:{eventId:l,extension:u},method:"addEventExtension"})}}return{methods:i}}function vj({tournamentRecords:t}){return Nle({extensionName:Tc,tournamentRecords:t})}var Ik="ADULT",vk="JUNIOR",MT="WHEELCHAIR",Ale={[qd]:{allowModificationWhenMatchUpsScheduled:{courts:!1,venues:!1},defaultTimes:{averageTimes:[{categoryNames:[],minutes:{default:90}}],recoveryTimes:[{minutes:{[Bt]:30,default:60}}]},defaultDailyLimits:{[zt]:2,[Bt]:2,total:3},matchUpAverageTimes:[{matchUpFormatCodes:[Vs],averageTimes:[{categoryNames:[],minutes:{default:90}},{categoryTypes:[MT],minutes:{default:120}}]},{matchUpFormatCodes:["SET3-S:6/TB7-F:TB10"],averageTimes:[{categoryNames:[],minutes:{default:85}}]},{matchUpFormatCodes:["SET3-S:6/TB7-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:70}}]},{matchUpFormatCodes:["SET3-S:4NOAD-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:55}}]},{matchUpFormatCodes:["SET3-S:4/TB7"],averageTimes:[{categoryNames:[],minutes:{default:60}}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:50}}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB10"],averageTimes:[{categoryNames:[],minutes:{default:55}}]},{matchUpFormatCodes:["SET3-S:4/TB5@3"],averageTimes:[{categoryNames:[],minutes:{default:45}}]},{matchUpFormatCodes:["SET1-S:8/TB7","SET1-S:8/TB7@7"],averageTimes:[{categoryNames:[],minutes:{default:40}}]},{matchUpFormatCodes:["SET1-S:5/TB9@4"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:6/TB7"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:6NOAD"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:4/TB7","SET1-S:4/TB5@3","SET3-S:TB10","SET1-S:T20"],averageTimes:[{categoryNames:[],minutes:{default:20}}]},{matchUpFormatCodes:["SET1-S:4NOAD"],averageTimes:[{categoryNames:[],minutes:{default:20}}]},{matchUpFormatCodes:["SET1-S:TB10"],averageTimes:[{categoryNames:[],minutes:{default:10}}]}],matchUpRecoveryTimes:[{matchUpFormatCodes:["SET3-S:6/TB7","SET3-S:6/TB7-F:TB10","SET3-S:6/TB7-F:TB7"],recoveryTimes:[{categoryTypes:[Ik,MT],minutes:{default:60,[Bt]:30}},{categoryTypes:[vk],minutes:{default:60,[Bt]:60}}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB7","SET3-S:4/TB7-F:TB10","SET3-S:4NOAD-F:TB7","SET3-S:4/TB7","SET3-S:4/TB5@3"],recoveryTimes:[{categoryTypes:[Ik,MT],minutes:{default:30}},{categoryTypes:[vk],minutes:{default:60}}]},{matchUpFormatCodes:["SET1-S:8/TB7","SET1-S:8/TB7@7","SET1-S:5/TB9@4","SET1-S:6/TB7","SET1-S:6NOAD","SET1-S:4/TB7","SET1-S:4NOAD","SET3-S:TB10","SET1-S:T20"],recoveryTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:4/TB5@3"],recoveryTimes:[{categoryTypes:[Ik,vk],minutes:{default:30}},{categoryTypes:[MT],minutes:{default:15}}]},{matchUpFormatCodes:["SET1-S:TB10"],recoveryTimes:[{categoryNames:[],minutes:{default:15}}]}],matchUpDailyLimits:[]}},BGe=Ale;function yj({tournamentRecord:t,matchUpFormats:e,categoryType:i,event:r}){if(!r)return{error:ui};let n,a;if(e?.length){let d=[];n=e.map(p=>{let f=typeof p=="string"?{matchUpFormat:p}:p;if(!d.includes(f?.matchUpFormat)&&$a({matchUpFormat:f?.matchUpFormat}))return d.push(f.matchUpFormat),f}).filter(Boolean)}else{let{policy:d}=wf({policyType:ms,tournamentRecord:t,event:r});if(d?.matchUpFormats)n=d?.matchUpFormats;else{let{extension:p}=ht({name:Tc,element:r}),f,m;p?.value?{matchUpAverageTimes:f,matchUpRecoveryTimes:m}=p.value:{matchUpAverageTimes:f,matchUpRecoveryTimes:m}=BGe[qd],n=nt([...(f||[]).map(h=>h.matchUpFormatCodes),...(m||[]).map(h=>h.matchUpFormatCodes)].flat()).map(h=>({matchUpFormat:h})),a="default scheduling policy in use"}}let{eventType:s,eventId:o,category:l}=r,u=l?.categoryName??l?.ageCategoryCode??o;if(!o)return{error:ui};let c=n.map(({matchUpFormat:d,description:p})=>{let f=RU({tournamentRecord:t,matchUpFormat:d,categoryName:u,categoryType:i,eventType:s,event:r});return{matchUpFormat:d,description:p,...f}});return je({eventMatchUpFormatTiming:c,info:a})}function GN(t){let e=He(t,[{[hr]:!0},{[qr]:h=>$a({matchUpFormat:h}),[Ba]:ZS,[$B]:!0}]);if(e.error)return e;let{tournamentRecord:i,matchUpFormat:r,event:n}=t,{extension:a}=ht({name:Tc,element:n}),s=a?.value,{extension:o}=ht({element:i,name:Tc}),l=o?.value,u=s?.matchUpAverageTimes&&Xy({...s,matchUpFormat:r}),c=l?.matchUpAverageTimes&&Xy({...l,matchUpFormat:r}),d=[u,c].find(h=>h),p=s?.matchUpRecoveryTimes&&Jy({...s,matchUpFormat:r}),f=l?.matchUpRecoveryTimes&&Jy({...l,matchUpFormat:r}),m=[p,f].find(h=>h);return{matchUpFormat:r,recoveryTimes:m,averageTimes:d}}function bj({tournamentRecords:t}){return Nle({extensionName:fU,tournamentRecords:t})}var tT=({scheduleAttributes:t=["scheduledDate","scheduledTime"],schedule:e={}})=>!!Object.keys(e).filter(i=>t.includes(i)).filter(i=>e[i]).length;function wj({scheduleAttributes:t=["scheduledDate","scheduledTime"],matchUps:e=[]}){if(!Ka(e))return{error:Nu};if(!Array.isArray(t))return{error:re};let i=e.filter(Boolean).filter(({schedule:r})=>tT({schedule:r,scheduleAttributes:t})).reduce((r,n)=>{let{schedule:a}=n,s=Ze(a?.scheduledDate),o=pi(a?.scheduledTime);return s&&o&&(r[s]?r[s].push(n):r[s]=[n]),r},{});return Object.keys(i).forEach(r=>{i[r].sort((n,a)=>Qie(pi(n.schedule?.scheduledTime),pi(a.schedule?.scheduledTime)))}),{...W,scheduledMatchUps:i}}function VGe({tournamentRecords:t}){let e={},i=[];for(let r of Object.values(t))for(let n of r.events??[]){let a=Qa({event:n}),s=a?.drawDetails;wt(s)?(Object.assign(e,s),i.push(...Object.keys(s).filter(o=>F2({drawId:o,drawDetails:s})))):a?.drawIds?.length&&i.push(...a.drawIds)}return{drawIds:i,detailsMap:e}}function oE({schedulingProfile:t,matchUps:e=[]}){let i={},r=({eventId:o,drawId:l,structureId:u,roundNumber:c})=>`${o}|${l}|${u}${c}`;t?.length&&t.flatMap(({venues:o})=>o.map(({rounds:l})=>l)).forEach(o=>{o.sort((l,u)=>(l.sortOrder||0)-(u.sortOrder||0)).forEach(({eventId:l,drawId:u,structureId:c,roundNumber:d},p)=>{let f=r({eventId:l,drawId:u,structureId:c,roundNumber:d});i[f]=p})});let n=[],a={noScheduledDate:[]};for(let o of e){let l=o.schedule||{},u=l.scheduledDate&&Ze(l.scheduledDate)||l.scheduledTime&&Ze(l.scheduledTime)||"noScheduledDate";a[u]||(a[u]=[]),a[u].push(o)}let s=Object.keys(a).sort((o,l)=>o.localeCompare(l));for(let o of s){let l=a[o],u={noScheduledTime:[]};for(let d of l){let p=d.schedule||{},f=p.scheduledTime&&pi(p.scheduledTime)||"noScheduledTime";u[f]||(u[f]=[]),u[f].push(d)}for(let d of Object.keys(u)){let p=u[d].sort((f,m)=>(f.roundNumber||0)-(m.roundNumber||0));u[d]=p}let c=Object.keys(u).sort((d,p)=>d.localeCompare(p));for(let d of c){let p=u[d];p.sort((f,m)=>{let h=i[r(f)]||0,g=i[r(m)]||0;return h-g}),n.push(...p)}}return n}function HN(t){let{participants:e,contextContent:i,participantMap:r}=t,{tournamentAppliedPolicies:n,scheduleVisibilityFilters:a,participantsProfile:s,afterRecoveryTimes:o,policyDefinitions:l,useParticipantMap:u,tournamentRecord:c,usePublishState:d,contextFilters:p,matchUpFilters:f,contextProfile:m,nextMatchUps:h,tournamentId:g,inContext:I,context:v,event:w}=t;if(!w)return{error:ui};let{eventId:y,eventName:b,endDate:S,eventType:U,category:T,gender:P}=w??{},D={...v,...je({surfaceCategory:w.surfaceCategory??c?.surfaceCategory,indoorOutDoor:w.indoorOutdoor??c?.indoorOutdoor,tournamentId:g??c?.tournamentId,endDate:S??c?.endDate,eventName:b,eventType:U,category:T,eventId:y,gender:P})},E;!e&&c&&({participants:e,participantMap:r,groupInfo:E}=bf({participantsProfile:s,useParticipantMap:u,tournamentRecord:c,contextProfile:m,inContext:I})),m&&!i&&(i=Hc({policyDefinitions:l,tournamentRecord:c,contextProfile:m,event:w}));let R=Qa({event:w});return{...(w.drawDefinitions??[]).reduce((C,M)=>{let N=Hv({hydrateParticipants:t.hydrateParticipants,context:D,tournamentAppliedPolicies:n,scheduleVisibilityFilters:a,tournamentParticipants:e,participantsProfile:s,afterRecoveryTimes:o,policyDefinitions:l,tournamentRecord:c,usePublishState:d,contextContent:i,contextFilters:p,matchUpFilters:f,participantMap:r,publishStatus:R,contextProfile:m,drawDefinition:M,nextMatchUps:h,inContext:I,event:w});return Object.keys(N)?.forEach(A=>{Array.isArray(N[A])&&(C[A]||(C[A]=[]),C[A]=C[A].concat(N[A]))}),C},{}),...W,groupInfo:E}}function WN(t){if(!t?.tournamentRecord)return{error:ve};let e=t.contextContent,{scheduleVisibilityFilters:i,participantsProfile:r,afterRecoveryTimes:n,policyDefinitions:a,tournamentRecord:s,inContext:o=!0,usePublishState:l,contextFilters:u,matchUpFilters:c,contextProfile:d,nextMatchUps:p,context:f}=t,m=t.tournamentId??s.tournamentId,h=s?.events??[],{participants:g,participantMap:I,groupInfo:v}=bf({participantsProfile:r,tournamentRecord:s,contextProfile:d,inContext:o});d&&!e&&(e=Hc({policyDefinitions:a,tournamentRecord:s,contextProfile:d}));let{appliedPolicies:w}=Dt({tournamentRecord:s}),y=u?.eventIds??[];return{...h.filter(b=>!y.includes(b.eventId)).map(b=>{let S={eventDrawsCount:Bi({event:b}).flightProfile?.flights?.length||b.drawDefinitions?.length||0,...f};return HN({hydrateParticipants:t.hydrateParticipants,context:S,tournamentAppliedPolicies:w,scheduleVisibilityFilters:i,participantsProfile:r,afterRecoveryTimes:n,policyDefinitions:a,tournamentRecord:s,usePublishState:l,contextFilters:u,contextProfile:d,contextContent:e,matchUpFilters:c,participantMap:I,participants:g,tournamentId:m,nextMatchUps:p,inContext:o,event:b})}).reduce((b,S)=>((S&&Object.keys(S).filter(U=>!["success","matchUpsMap"].includes(U)))?.forEach(U=>{Array.isArray(S[U])&&(b[U]||(b[U]=[]),b[U]=b[U].concat(S[U]),b.matchUpsCount!==void 0?b.matchUpsCount+=S[U].length:b.matchUpsCount=S[U].length)}),b),{matchUpsCount:0}),groupInfo:v,participants:g}}function lw({scheduleVisibilityFilters:t,hydrateParticipants:e,participantsProfile:i,tournamentRecords:r,useParticipantMap:n,policyDefinitions:a,usePublishState:s,matchUpFilters:o,contextFilters:l,nextMatchUps:u,inContext:c}){if(typeof r!="object"||!Object.keys(r).length)return{error:Mi};let d=Object.keys(r).map(m=>{let h=r[m];return WN({scheduleVisibilityFilters:t,hydrateParticipants:e,participantsProfile:i,policyDefinitions:a,tournamentRecord:h,usePublishState:s,matchUpFilters:o,contextFilters:l,nextMatchUps:u,inContext:c})}),p={},f={};return{...d.reduce((m,h)=>(Object.keys(h).forEach(g=>{if(g==="groupInfo")Object.assign(f,h[g]);else if(g==="participants")for(let I of h[g]??[])p[I.participantId]=I;else Array.isArray(h[g])&&(m[g]||(m[g]=[]),m[g]=m[g].concat(h[g]))}),m),{}),groupInfo:f,mappedParticipants:p}}function iT(t){if(typeof t?.tournamentRecords!="object"||!Object.keys(t?.tournamentRecords).length)return{error:Mi};let{courts:e,venues:i}=Fu(t),r=zc(t).schedulingProfile,{sortDateMatchUps:n=!0,courtCompletedMatchUps:a,alwaysReturnCompleted:s,activeTournamentId:o,tournamentRecords:l,withCourtGridRows:u,minCourtGridRows:c,usePublishState:d,status:p=Xa,sortCourtsData:f}=t,m=o??Oh()??Object.keys(l)[0],h=d?OU({tournamentRecord:l[m],status:p}):void 0,g=s?lw({...t,matchUpFilters:{...t.matchUpFilters,matchUpStatuses:[Oi]},contextFilters:t.contextFilters}).completedMatchUps:[];if(d&&!jo(h?.orderOfPlay))return{completedMatchUps:g,dateMatchUps:[],courtsData:[],venues:i};let I,v;d&&({drawIds:I,detailsMap:v}=VGe({tournamentRecords:l})),I?.length&&(t.contextFilters??={},t.contextFilters.drawIds?t.contextFilters.drawIds=t.contextFilters.drawIds.filter(M=>I.includes(M)):t.contextFilters.drawIds=I),h?.eventIds?.length&&(t.matchUpFilters??={},t.matchUpFilters?.eventIds&&t.matchUpFilters.eventIds.length?t.matchUpFilters.eventIds=t.matchUpFilters.eventIds.filter(M=>h.eventIds.includes(M)):t.matchUpFilters.eventIds=h.eventIds),h?.scheduledDates?.length&&(t.matchUpFilters??={},t.matchUpFilters.scheduledDates&&t.matchUpFilters.scheduledDates.length?t.matchUpFilters.scheduledDates=t.matchUpFilters.scheduledDates.filter(M=>h.scheduledDates.includes(M)):t.matchUpFilters.scheduledDates=h.scheduledDates),s&&(t.matchUpFilters??={},t.matchUpFilters?.excludeMatchUpStatuses?.length?t.matchUpFilters.excludeMatchUpStatuses.includes(Oi)||t.matchUpFilters.excludeMatchUpStatuses.push(Oi):t.matchUpFilters.excludeMatchUpStatuses=[Oi]);let{completedMatchUps:w,upcomingMatchUps:y,pendingMatchUps:b,abandonedMatchUps:S,groupInfo:U,mappedParticipants:T}=lw({...t,matchUpFilters:t.matchUpFilters,contextFilters:t.contextFilters}),P=[...y??[],...b??[]];v&&(!I?.length||Object.keys(v).length)&&(P=P.filter(M=>{let{drawId:N,structureId:A,stage:O}=M;if(!jo(v?.[N]?.publishingDetail))return!1;let k=Object.keys(v[N].stageDetails??{});if(k.length){let x=k.filter($=>!jo(v[N].stageDetails[$])),L=k.filter($=>jo(v[N].stageDetails[$]));return x.length&&x.includes(O)?!1:L.length&&L.includes(O)?!0:x.length&&!x.includes(O)&&!L.length}let F=Object.keys(v[N].structureDetails??{});if(F.length){let x=F.filter($=>!jo(v[N].structureDetails[$])),L=F.filter($=>jo(v[N].structureDetails[$]));return x.length&&x.includes(A)?!1:L.length&&L.includes(A)?!0:x.length&&!x.includes(A)&&!L.length}return!0})),v&&d&&(P=P.filter(M=>{let{drawId:N,structureId:A,roundNumber:O}=M;if(!lt(O))return!0;let k=v[N]?.structureDetails?.[A];if(!k)return!0;let{scheduledRounds:F,roundLimit:x}=k;if(lt(x)&&O>x)return!1;if(F){let L=F[O];return L?jo(L):!1}return!0}));let D=n?oE({matchUps:P,schedulingProfile:r}):P,E=e?.map(M=>{let N=C(M);return{surfaceCategory:M?.surfaceCategory??"",matchUps:N,...M}}),R={completedMatchUps:s?g:w,mappedParticipants:t.hydrateParticipants?void 0:T,dateMatchUps:D,courtsData:E,groupInfo:U,venues:i};if(u){let M=t.matchUpFilters?.scheduledDate,{rows:N,courtPrefix:A}=VN({minRowsCount:Math.max(c||0,D.length||0),scheduledDate:M,courtsData:E});R.courtPrefix=A,R.rows=N}return{...R,...W};function C({courtId:M}){let N=(a?D.concat(w??[],S??[]):D).filter(A=>A.schedule?.courtId===M||A.schedule?.allocatedCourts?.map(({courtId:O})=>O).includes(M));return f?oE({matchUps:N,schedulingProfile:r}):N}}function zN({tournamentRecords:t,tournamentId:e}){if(typeof t!="object"||!Object.keys(t).length)return{error:Mi};let i=Object.keys(t).filter(n=>!e||n===e),r;return i.forEach(n=>{let a=t[n],{matchUpDailyLimits:s}=jGe({tournamentRecord:a});r=s}),{matchUpDailyLimits:r}}function jGe(t){let e=He(t,[{[hr]:!0}]);if(e.error)return e;let{tournamentRecord:i}=t,{policy:r}=wf({policyType:qd,tournamentRecord:i}),{extension:n}=ht({element:i,name:fU}),a=n?.value?.dailyLimits,s=r?.defaultDailyLimits;return{matchUpDailyLimits:a||s}}function Sj(t){let{matchUps:e}=t,{singlesForDoubles:i,tournamentRecord:r,drawDefinition:n,excludeMargin:a,exclusionRule:s,zoneDoubling:o,matchUpType:l,scaleName:u,eventId:c,zonePct:d,drawId:p,event:f}=t;if(!r&&!e)return{error:ve};if(l&&![zt,Bt].includes(l))return{error:re,info:{matchUpType:l}};if(e&&!Ka(e))return{error:re,context:{matchUps:e}};let m=Pr[u],h=m?.ascending??t.ascending??!1,g=m?.accessor??t.valueAccessor,I=Array.isArray(m?.range)?Math.abs(m.range[0]-m.range[1]):0,v=lt(d)&&I?(d??0/100)*I:t.zoneMargin??I,w={withScaleValues:!0,withCompetitiveness:!0},y={matchUpTypes:l?[l]:[zt,Bt]},b=r?.participants;e?.[0]?.hasContext?p?e=e.filter(M=>M.drawId===p):c&&(e=e.filter(M=>M.eventId===c)):e??=p&&!n&&[]||!p&&c&&!f&&[]||p&&An({inContext:!0,drawDefinition:n,contextFilters:y,contextProfile:w,participants:b})?.matchUps||!p&&c&&xu({inContext:!0,contextFilters:y,contextProfile:w,participants:b,event:f})?.matchUps||Ur({tournamentRecord:r,contextFilters:y,contextProfile:w})?.matchUps||[],l&&(e=e.filter(M=>M.matchUpType===l));let S=e.filter(({winningSide:M,score:N,sides:A,matchUpStatus:O})=>![Sr,qt,ai,Vv,Ta].includes(O??"")&&fr({score:N})&&A?.length===2&&M),U=HGe({matchUps:S,excludeMargin:a,exclusionRule:s,valueAccessor:g,ascending:h,scaleName:u}),T=!o||Pi(zt)(l)?v:(v||0)*2,P=v?S.map(({competitiveProfile:M,matchUpType:N,score:A,sides:O})=>{let k=kle({singlesForDoubles:i,valueAccessor:g,matchUpType:N,scaleName:u,sides:O}),F=Math.abs(k[0].value-k[1].value);return{competitiveness:M?.competitiveness,valuesGap:F,score:A}}).filter(({valuesGap:M})=>M<=T):[],D=GGe({zoneData:P}),E=D&&Object.values(D).flat().length,R=E&&Object.assign({},...Object.keys(D).map(M=>({[M]:Math.round(1e4*D[M].length/E)/100}))),C=S.length-(P?.length||0);return{...W,relevantMatchUps:S,zoneDistribution:R,zoneData:P,accuracy:U,nonZone:C}}function GGe({zoneData:t}){let e={[I2]:[],[tw]:[],[iw]:[]};for(let i of t){let{competitiveness:r,score:n,valuesGap:a}=i;e[r]&&e[r].push({score:n,valuesGap:a})}return e}function kle({singlesForDoubles:t,exclusionRule:e,valueAccessor:i,matchUpType:r,scaleName:n,sides:a}){let s=e?.range.sort(),o=l=>{let u=l?.[e?.valueAccessor];return{exclude:e&&u>=s[0]&&u<=s[1],exclusionValue:u}};return a.sort((l,u)=>l.sideNumber-u.sideNumber).map(({participant:l})=>{let u=[],c=l?.individualParticipants;if(c?.length){let d=[],p=0;for(let f of c){let{scaleValue:m,value:h}=Lq({singlesForDoubles:t,valueAccessor:i,participant:f,matchUpType:r,scaleName:n}),{exclude:g,exclusionValue:I}=o(m);g&&u.push(I),d.push(m),h&&!Number.isNaN(Number(p))?p+=h:p=void 0}return{participantName:l.participantName,exclusionValues:u,scaleValues:d,value:p}}else if(l){let{scaleValue:d,value:p}=Lq({singlesForDoubles:t,valueAccessor:i,matchUpType:r,participant:l,scaleName:n}),{exclude:f,exclusionValue:m}=o(d);return f&&u.push(m),{participantName:l.participantName,exclusionValues:u,scaleValue:d,value:p}}else return{}})}function Lq({singlesForDoubles:t,valueAccessor:e,matchUpType:i,participant:r,scaleName:n}){let a=t?zt:i,s=r?.rankings?.[a]?.find(u=>u.scaleName===n),o=(r?.ratings?.[a]?.find(u=>u.scaleName===n)||s)?.scaleValue,l=e?o?.[e]:o;return{scaleValue:o,value:l}}function HGe({excludeMargin:t,exclusionRule:e,valueAccessor:i,ascending:r,scaleName:n,matchUps:a}){let s={affirmative:[],negative:[],excluded:[]};for(let u of a)WGe({matchUp:u,accuracy:s,excludeMargin:t,exclusionRule:e,valueAccessor:i,ascending:r,scaleName:n});let o=s.affirmative.length+s.negative.length,l=o&&s.affirmative.length/o*100;return s.percent=l?Math.round(100*l)/100:0,s}function WGe({matchUp:t,accuracy:e,excludeMargin:i,exclusionRule:r,valueAccessor:n,ascending:a,scaleName:s}){let{matchUpType:o,sides:l,score:u,winningSide:c}=t;if(!c)return;if(r&&(!r.valueAccessor||!r.range)){e.error={info:"exclusionRule requires valueAccessor and range",error:Je};return}let d=c-1,p=kle({exclusionRule:r,valueAccessor:n,matchUpType:o,scaleName:s,sides:l});if(zGe({exclusionRule:r,sideValues:p,accuracy:e,score:u,winningSide:c}))return;if(qGe(p)){e.excluded.push({scoreString:u?.scoreStringSide1,missingValues:!0,winningSide:c,sideValues:p});return}let f=p[d].value-p[1-d].value;if(YGe({excludeMargin:i,valuesGap:f})){e.excluded.push({scoreString:u?.scoreStringSide1,excludeMargin:i,winningSide:c,excludeGap:!0,sideValues:p,valuesGap:f});return}let m=a?f:f*-1,h=c===1?u?.scoreStringSide1:u?.scoreStringSide2;m>0?e.affirmative.push({winningScoreString:h,winningSide:c,sideValues:p,valuesGap:f,score:u}):e.negative.push({winningScoreString:h,winningSide:c,sideValues:p,valuesGap:f,score:u})}function zGe({exclusionRule:t,sideValues:e,accuracy:i,score:r,winningSide:n}){if(t){let a=e.flatMap(({exclusionValues:s})=>s);if(a.length)return i.excluded.push({scoreString:r?.scoreStringSide1,exclusionValues:a,winningSide:n,sideValues:e}),!0}return!1}function qGe(t){return t.filter(e=>![void 0,"",null].includes(e.value)).length<2}function YGe({excludeMargin:t,valuesGap:e}){let i=Number.parseFloat(t||0);return i&&Math.abs(e)<i}function ig({collectionDefinitions:t=[],collectionGroups:e=[]}){let i=0,{groupValueNumbers:r}=Mse({collectionGroups:e}),n;for(let a of t||[]){let{collectionValueProfiles:s,collectionGroupNumber:o,collectionValue:l,matchUpCount:u,matchUpValue:c,scoreValue:d,setValue:p}=a,f=o&&r.includes(o);if(lt(p||d))n=!0;else{if(f)continue;if(typeof l=="number"&&lt(l))i+=l;else if(Array.isArray(s)&&s?.length)for(let m of s)i+=m.matchUpValue;else typeof c=="number"&&lt(c)&&(i+=(u??0)*c)}}for(let a of e)i+=a.groupValue??0;return n||!i?{aggregateValue:!0,...W}:{valueGoal:Math.floor(i/2)+1,...W}}function Uj(t){let{timeStamp:e,schedule:i,matchUp:r}=t,n=He(t,[{[Au]:!0}]);if(n.error)return n;let{itemValue:a,timeStamp:s}=Tf({timeItems:r?.timeItems||[],itemType:U2});return!i||s&&e&&new Date(s).getTime()>new Date(e).getTime()?{homeParticipantId:a}:i}function Tj({matchUps:t,matchUpId:e}){if(!Ka(t))return{error:re};let i=t.find(o=>o.matchUpId===e),{drawId:r,eventId:n,structureId:a,tournamentId:s}=i||{};return{matchUpId:e,drawId:r,eventId:n,structureId:a,tournamentId:s}}function ey(t,e){if(!wt(t))return{error:re};if(!Array.isArray(e))return{error:re};let i={};for(let{param:r,error:n,attr:a}of e){let s=KGe({params:t,param:r,attr:a,error:n});if(s?.error)return s;i[r]=s}return i}function KGe({params:t,param:e,attr:i,error:r}){if(e===OM&&wt(t.drawDefinition)&&ni(t.structureId)){let n=(t.drawDefinition.structures??[]).find(({structureId:a})=>a===t.structureId);return!n.length&&r?{error:r}:{structure:n}}if(e===Au){let n=Dle({...t,...i});return n.error&&r?{...n,error:r}:n}return{error:Br,info:{param:e}}}function Dj(t){let{structureId:e,matchUpId:i,event:r}=t,n=t.drawDefinition,a=He(t,[{[hr]:!0},{[HB]:{[NM]:!1,[Pl]:!1,[Qre]:!1,[Vc]:!1}}]);if(a[js])return a;let s=ey(t,[{[Lv]:Au,[js]:Je}])?.matchUp;if(i&&s?.error)return s;!n&&s?.drawDefinition&&(n=s?.drawDefinition);let o=s?.structure;if(!o&&e&&!i){if(!n)return{error:xo};let p=tt({drawDefinition:n,structureId:e});if(p.error)return p;o=p.structure}let l=o?.matchUpFormat,u=n?.matchUpFormat,c=r?.matchUpFormat,d=s?.matchUp?.matchUpFormat||l||u||c;return{structureDefaultMatchUpFormat:l,eventDefaultMatchUpFormat:c,drawDefaultMatchUpFormat:u,matchUpFormat:d}}function Pj({profileBands:t,tournamentRecord:e,matchUps:i}){if(!Ka(i))return{error:Nu};let r=!t&&wf({policyType:qu,tournamentRecord:e}).policy,n=t||r?.profileBands||v2[qu].profileBands,a=i.filter(({winningSide:p})=>p),s=a.map(Bne),o=(p,f)=>{let m=$ne(f,n);return p[m]+=1,p},l=Vne(s).reduce((p,f)=>o(p,f),{[I2]:0,[tw]:0,[iw]:0,[kne]:0}),u=Object.keys(l).reduce((p,f)=>(l[f]||0)+p,0),c=Object.keys(l).map(p=>{let f=Number.parseFloat((l[p]/u).toFixed(4));return{[p]:f*100}}),d=a.filter(({matchUpStatus:p})=>p===eq).length;return c.push({[eq]:Number.parseFloat((d/u).toFixed(4))*100}),{competitiveBands:Object.assign({},...c),...W}}var{stageOrder:_q}=LFe;function XGe(t,e){return t.eventName.localeCompare(e.eventName)||t.eventId.localeCompare(e.eventId)||(_q[t?.stage]||0)-(_q[e?.stage]||0)||e.matchUpsCount-t.matchUpsCount||`${t.stageSequence}-${t.roundNumber}-${t.minFinishingSum}`.localeCompare(`${e.stageSequence}-${e.roundNumber}-${e.minFinishingSum}`)}function Ej({excludeScheduleDateProfileRounds:t,excludeScheduledRounds:e,excludeCompletedRounds:i,inContextMatchUps:r,tournamentRecords:n,schedulingProfile:a,tournamentRecord:s,withSplitRounds:o,matchUpFilters:l,scheduleDate:u,withRoundId:c,venueId:d,context:p}){if(r&&!Array.isArray(r||typeof r[0]!="object"))return{error:re,inContextMatchUps:r};if(s&&!n){if(typeof s!="object")return{error:KS};n={[s.tournamentId]:s}}let f=typeof n!="object"||!Object.keys(n).length;if((d||u||!r||!a&&(t||i||a||o))&&f)return{error:Mi};let m=Object.assign({},...Object.values(n??{}).map(({venues:S=[],tournamentId:U})=>({[U]:S?.map(({venueId:T})=>T)}))),h=Object.values(n??{}).map(({events:S=[],tournamentId:U,startDate:T,endDate:P})=>S.map(D=>({...D,validVenueIds:m[U],startDate:D.startDate??T,endDate:D.endDate??P}))).flat(),{segmentedRounds:g,profileRounds:I}=n&&(t||i||a||o)&&BN({tournamentRecords:n,schedulingProfile:a})||{},v=t&&Object.assign({},...I.map(S=>({[S.id]:S}))),w=r||n&&No({tournamentRecords:n,matchUpFilters:l})?.matchUps||[],y=[],b=w&&Object.values(w.reduce((S,U)=>{let T=Kx(U).id,P=g?.[T],D=[...S[T]?.matchUps??[],U],{containerStructureId:E,stageSequence:R,structureName:C,tournamentId:M,isRoundRobin:N,matchUpType:A,roundNumber:O,roundOffset:k,structureId:F,eventName:x,roundName:L,drawName:$,eventId:V,drawId:_}=U,B=N?E:F;return{...S,[T]:{id:c?T:void 0,structureId:B,stageSequence:R,segmentsCount:P,structureName:C,tournamentId:M,matchUpType:A,roundNumber:O,roundOffset:k,eventName:x,roundName:L,drawName:$,matchUps:D,eventId:V,drawId:_}}},{})).map(S=>{let{minFinishingSum:U,winnerFinishingPositionRange:T}=_Ge(S.matchUps),P=S.segmentsCount;if(P){let O=S.matchUps.length/P;return wr(S.matchUps.sort((k,F)=>k.roundPosition-F.roundPosition),O).map((k,F)=>{let{unscheduledCount:x,incompleteCount:L,matchUpsCount:$,isScheduled:V,isComplete:_,byeCount:B}=Fq(k),G=xq({matchUps:S.matchUps,tournamentRecords:n,events:h,round:S});return je({...S,...p,roundSegment:{segmentsCount:P,segmentNumber:F+1},winnerFinishingPositionRange:T,unscheduledCount:x,incompleteCount:L,minFinishingSum:U,matchUpsCount:$,isScheduled:V,roundTiming:G,isComplete:_,byeCount:B,matchUps:k})})}let{unscheduledCount:D,incompleteCount:E,matchUpsCount:R,isScheduled:C,isComplete:M,byeCount:N}=Fq(S.matchUps),A=xq({matchUps:S.matchUps,tournamentRecords:n,events:h,round:S});return je({...S,...p,winnerFinishingPositionRange:T,unscheduledCount:D,incompleteCount:E,minFinishingSum:U,matchUpsCount:R,isScheduled:C,roundTiming:A,isComplete:M,byeCount:N})}).flat().filter(S=>{if(t){let F=Ze(t),x=c?S.id:Kx(S).id;if(F&&v[x]&&Ze(v[x].scheduleDate)===F)return!1}let{isComplete:U,isScheduled:T}=S,P=!i||!U,D=!e||!T,E=d||u?h?.find(({eventId:F})=>F===S.eventId):void 0,R=E?.startDate??s?.startDate,C=E?.endDate??s?.endDate,M=!u||!R||new Date(u)>=new Date(R),N=!u||!C||new Date(u)<=new Date(C),A=M&&N,O=!d||E?.validVenueIds.includes(d),k=P&&D&&O&&A;return k||y.push(S),k}).sort(XGe)||[];return{...W,rounds:b,excludedRounds:y}}function uw(t){let{matchUp:e,sideNumber:i,setNumber:r,isTiebreakValue:n,isPointValue:a}=t||{},{matchUpFormat:s}=t||{};if(!e)return{error:sa};s=s||e?.matchUpFormat;let o=qi(s),l=!!e?.winningSide,u=e.score?.sets,c=u?.length,d=r&&r-1,p=!!u?.find((B,G)=>B.setNumber===r&&G===d),f=u?.filter(B=>B?.winningSide)||[],m=f?.length||0,h=r&&u?.slice(r)||[],g=!!(c&&r&&h?.reduce((B,G)=>(!G||!G.side1Score&&!G.side2Score&&!G.side1TiebreakScore&&!G.side2TiebreakScore&&!G.side1PointScore&&!G.side2PointScore)&&B,!0)),I=r<=c&&u.find(B=>B.setNumber===r),v=I&&ow({setObject:I,matchUpScoringFormat:o}),{isCompletedSet:w,sideGameScores:y,sideTiebreakScores:b}=v||{},S=!!(I&&!w&&g||r&&r===c+1&&!l),U=[1,2].includes(i),T=U?i-1:0,P=I&&U&&(!n&&!a&&y[T]!==void 0&&y[T]||n&&b[T]!==void 0&&b[T]),D=!!P,E=f?.map(B=>ow({setObject:B,matchUpScoringFormat:o}).isValidSetOutcome).reduce((B,G)=>B&&G,!0),R=f.reduce((B,G)=>{let{winningSide:j}=G,K=j-1;return B[K]++,B},[0,0]),C=e?.winningSide,M=C&&C-1,N=1-M,A=R[M],O=R[N],k=Math.max(...R),F=Sa(R)[k],{bestOf:x,exactly:L}=o??{},$=Math.ceil((x||L||1)/2),V=k===$&&F===1&&R.indexOf(k)+1||void 0,_=A>O&&C===V;return{completedSetsHaveValidOutcomes:E,validMatchUpWinningSide:_,calculatedWinningSide:V,matchUpScoringFormat:o,validMatchUpOutcome:V&&E&&_,isLastSetWithValues:g,completedSetsCount:m,isCompletedMatchUp:l,isValidSideNumber:U,hasExistingValue:D,existingValue:P,isExistingSet:p,isActiveSet:S,...v}}function Rj({participants:t,tournamentAppliedPolicies:e,scheduleVisibilityFilters:i,participantsProfile:r,afterRecoveryTimes:n,policyDefinitions:a,useParticipantMap:s,tournamentRecord:o,usePublishState:l,contextFilters:u,contextContent:c,matchUpFilters:d,participantMap:p,publishStatus:f,contextProfile:m,drawDefinition:h,nextMatchUps:g,tournamentId:I,inContext:v,context:w,event:y}){let{eventId:b,eventName:S,endDate:U,eventType:T,category:P,gender:D}=y??{},E={...w,...je({surfaceCategory:y?.surfaceCategory??o?.surfaceCategory,indoorOutDoor:y?.indoorOutdoor??o?.indoorOutdoor,endDate:U??y?.endDate??o?.endDate,tournamentId:I??o?.tournamentId,eventName:S,eventType:T,category:P,eventId:b,gender:D})},R;return!t?.length&&o&&({participants:t,participantMap:p,groupInfo:R}=bf({participantsProfile:r,useParticipantMap:s,tournamentRecord:o,contextProfile:m,inContext:v})),y&&m&&!c&&(c=Hc({policyDefinitions:a,tournamentRecord:o,contextProfile:m,drawDefinition:h,event:y})),{...Hv({context:E,tournamentAppliedPolicies:e,scheduleVisibilityFilters:i,tournamentParticipants:t,participantsProfile:r,afterRecoveryTimes:n,policyDefinitions:a,tournamentRecord:o,usePublishState:l,participantMap:p,contextContent:c,contextFilters:u,matchUpFilters:d,publishStatus:f,contextProfile:m,drawDefinition:h,nextMatchUps:g,inContext:v,event:y}),groupInfo:R}}var Ole={};dt(Ole,{getCompetitionVenues:()=>YU,getCourts:()=>Cj,getVenuesAndCourts:()=>Fu,publicFindVenue:()=>E2});function Cj({tournamentRecord:t,venueId:e,venueIds:i}){return t?{courts:(t.venues||[]).filter(r=>e?r.venueId===e:i?i.includes(r.venueId):!0).map(r=>{let{venueId:n}=r,a=Oe(r.courts||[]);return a.forEach(s=>Object.assign(s,{venueId:n})),a}).flat()}:{error:ve}}var xle={};dt(xle,{categoryCanContain:()=>aU,getCategoryAgeDetails:()=>Bp,getEvent:()=>Aj,getEventProperties:()=>Mj,getEventStructures:()=>oN,getEventTimeItem:()=>vU,getEvents:()=>Nj,getFlightProfile:()=>Bi,getScaledEntries:()=>tg});function Mj({tournamentRecord:t,event:e}){if(!t)return{error:ve};if(!e)return{error:ui};let i=e.entries||[],r=t.participants||[],n=e.category?.categoryName||e.category?.ageCategoryCode,{eventType:a}=e,s=new Set(i.map(d=>d.participantId)),o=r.filter(d=>s.has(d.participantId)),l,u,c;return{entryScaleAttributes:o.map(d=>{let{participantId:p,participantName:f,name:m}=d,h={scaleType:D2,eventType:a,scaleName:n},g=Xl({participant:d,scaleAttributes:h})?.scaleItem?.scaleValue;h={scaleType:Xne,eventType:a,scaleName:n};let I=Xl({participant:d,scaleAttributes:h})?.scaleItem?.scaleValue;h={scaleType:Kne,eventType:a,scaleName:n};let v=Xl({participant:d,scaleAttributes:h})?.scaleItem?.scaleValue;return l=!!(l||g),u=!!(u||I),c=!!(c||v),{participantId:p,participantName:f||m,seed:g,ranking:I,rating:v}}),hasSeededParticipants:l,hasRankedParticipants:u,hasRatedParticipants:c}}function Nj({tournamentRecord:t,withScaleValues:e,scaleEventType:i,inContext:r,eventIds:n,drawIds:a,context:s}){if(!t)return{error:ve};let{tournamentId:o}=t,l=(t.events??[]).filter(({eventId:c})=>!n||Array.isArray(n)&&n.includes(c)).map(c=>{let d=c.drawDefinitions?.map(Zb);if(a?.length&&!Li(a,d).length)return;let p=Oe(c);return r&&Object.assign(p,{tournamentId:o}),s&&Object.assign(p,s),p}).filter(Boolean),u={};if(e){let c=Ri({withScaleValues:!0,tournamentRecord:t}).participantMap,d=p=>p.reduce((f,m)=>f+Number.parseFloat(m),0);for(let p of l){let f=i??p.eventType,m=p.eventId;u[m]||(u[m]={ratingsStats:{},ratings:{},ranking:{},draws:{}});let h=(p.entries??[]).filter(({entryStatus:S})=>uo.includes(S)).map(yt),g=S=>{if(S?.ratings?.[f])for(let U of S?.ratings?.[f]??[]){let T=U.scaleName;u[m].ratings[T]||(u[m].ratings[T]=[]);let P=Pr[T]?.accessor;if(P){let D=Number.parseFloat(U.scaleValue?.[P]);D&&u[m].ratings[T].push(D)}}if(S?.rankings?.[f])for(let U of S?.rankings?.[f]??[]){let T=U.scaleName;u[m].ranking[T]||(u[m].ranking[T]=[]),U.scaleValue&&u[m].ranking[T].push(U.scaleValue)}};for(let S of h){let U=c?.[S]?.participant;if(U?.participantType===It)g(U);else for(let T of U?.individualParticipantIds??[]){let P=c?.[T]?.participant;g(P)}}let I=u[m].ratings;for(let S of Object.keys(I)){let U=I[S];if(!U.length)continue;let T=Hz(U)?.toFixed(2);u[m].ratingsStats[S]={avg:Number.parseFloat((d(U)/U.length).toFixed(2)),median:T?Number.parseFloat(T):void 0,max:Math.max(...U),min:Math.min(...U)}}let v=(S,U)=>{let T=P=>{if(u[m].draws?.[S]&&P?.ratings?.[f])for(let D of P?.ratings?.[f]??[]){let E=D.scaleName;u[m].draws[S]?.ratings[E]||(u[m].draws[S].ratings[E]=[]);let R=Pr[E]?.accessor;if(R){let C=Number.parseFloat(D.scaleValue?.[R]);C&&u[m].draws[S].ratings[E].push(C)}}if(u[m].draws?.[S]&&P?.rankings?.[f])for(let D of P?.rankings?.[f]??[]){let E=D.scaleName;u[m].draws[S]?.ranking[E]||(u[m].draws[S].ranking[E]=[]);let R=D.scaleValue;R&&u[m].draws[S].ranking[E].push(R)}};for(let P of U.filter(Boolean)){let D=c?.[P]?.participant;if(D?.participantType===It)T(D);else for(let E of D?.individualParticipantIds??[]){let R=c?.[E]?.participant;T(R)}}},w=[],y=S=>a?.length&&a.includes(S)||w.includes(S);for(let S of p.drawDefinitions??[]){let U=S.drawId;if(y(U))continue;let T=Pf({drawDefinition:S}).assignedParticipantIds??[];u[m].draws[U]||(u[m].draws[U]={ratingsStats:{},ratings:{},ranking:{}}),w.push(U),v(U,T)}let b=Bi({event:p}).flightProfile;for(let S of b?.flights??[]){let U=S.drawId;if(y(U))continue;let T=S.drawEntries.map(yt);v(U,T)}for(let S of w){let U=u[m].draws[S].ratings;for(let T of Object.keys(U)){let P=U[T];if(!P.length)continue;let D=Hz(P)?.toFixed(2);u[m].draws[S].ratingsStats[T]={avg:Number.parseFloat((d(P)/P.length).toFixed(2)),median:D?Number.parseFloat(D):void 0,max:Math.max(...P),min:Math.min(...P)}}}}}return je({eventScaleValues:u,events:l,...W})}function Aj({tournamentRecord:t,drawDefinition:e,context:i,event:r}){if(!t)return{error:ve};if(!r)return{error:ui};let n=Oe(r);i&&Object.assign(n,i);let a=e&&n.drawDefinitions?.find(({drawId:s})=>e.drawId===s);return je({drawDefinition:a,event:n})}function JGe(t){let e="validateAndDeriveDrawValues",{appliedPolicies:i,policyDefinitions:r}=eHe(t),n=tHe({...t,policyDefinitions:r,appliedPolicies:i}),a=ZGe(t),s=iHe({...t,consideredEntries:a,appliedPolicies:i});if(s?.error)return q({result:s,stack:e});let o=rHe({...t,consideredEntries:a}),l=QGe({...t,appliedPolicies:i,policyDefinitions:r,drawSize:o});if(l.error)return q({result:l,stack:e});let u=l.drawType;if(isNaN(o)&&u!==ua)return q({result:{error:QS},stack:e});let c=r?.[Rs]??i?.[Rs],d=t.seedingProfile??c?.seedingProfile?.drawTypes?.[u??""]??c?.seedingProfile;t.seedingProfile&&(r[Rs]||(r[Rs]={...Yx[Rs]}),r[Rs].seedingProfile=d);let p=nHe({...t,drawType:u});return p?.error?q({result:p,stack:e}):{drawSize:o,drawType:u,enforceGender:n,seedingProfile:d,appliedPolicies:i,policyDefinitions:r}}function QGe(t){let{policyDefinitions:e,appliedPolicies:i,enforceMinimumDrawSize:r=!0,drawSize:n}=t,a=t.drawTypeCoercion??XU({drawType:t.drawType,policyDefinitions:e,appliedPolicies:i}),s=coe({drawType:t.drawType,enforceMinimumDrawSize:r,drawTypeCoercion:a,drawSize:n});return s.error?s:{drawType:s.drawType}}function Fle(t){return t?.filter(e=>e.entryStatus&&[...uo,DU].includes(e.entryStatus))}function ZGe({considerEventEntries:t=!0,drawEntries:e,eventEntries:i,qualifyingOnly:r}){return(r&&[]||Fle(e)||(t?i:[])).filter(({entryStage:n})=>!n||n===Ae)}function eHe(t){let{tournamentRecord:e,event:i}=t,r={...t?.appliedPolicies,...Dt({tournamentRecord:e,event:i}).appliedPolicies??{}},n=Oe(t.policyDefinitions??{},!1,!0);return{appliedPolicies:r,policyDefinitions:n}}function tHe({enforceGender:t,policyDefinitions:e,appliedPolicies:i}){return t??e?.[Mr]?.participants?.enforceGender??i?.[Mr]?.participants?.enforceGender}function iHe(t){let{consideredEntries:e,appliedPolicies:i,policyDefinitions:r,enforceGender:n,participantMap:a,participants:s,event:o}=t;return o&&s&&yN({consideredEntries:e,policyDefinitions:r,appliedPolicies:i,participantMap:a,enforceGender:n,participants:s,event:o})}function rHe(t){return!t.drawSize&&t.consideredEntries.length&&![ua,lU,Fv,eo,gu].includes(t.drawType??"")&&Cv(t.consideredEntries.length)||t.drawSize&&Ke(t.drawSize)||!1}function nHe(t){let{tournamentRecord:e,event:i,ignoreAllowedDrawTypes:r,drawType:n}=t,a=!r&&e&&kN({tournamentRecord:e,categoryType:i?.category?.categoryType,categoryName:i?.category?.categoryName});return a?.length&&!a.includes(n)?{error:Q$}:{...W}}function Lle(t){let{drawDefinition:e,appliedPolicies:i}=t,r=i?.[Sc],n=Or({drawDefinition:e});return e.structures?.forEach(a=>{let s=Pd({structureId:a.structureId,matchUpsMap:n}),o=_ne({roundNamingPolicy:r,drawDefinition:e,structure:a,matchUps:s}),{roundNamingProfile:l,roundProfile:u}=o;(a.structures||[a]).forEach(c=>{(c.matchUps??[]).forEach(d=>{let p=d?.roundNumber?.toString();if(p){let f=l?.[p]?.roundName,m=l?.[p]?.abbreviatedRoundName,h=u?.[p]?.feedRound;Object.assign(d,{abbreviatedRoundName:m,feedRound:h,roundName:f})}})})}),{drawDefinition:e}}function rT(t){let{voluntaryConsolation:e,tournamentRecord:i,event:r}=t,n="generateDrawDefinition",{participants:a,participantMap:s}=Ri({withIndividualParticipants:!0,convertExtensions:!0,internalUse:!0,tournamentRecord:i}),o=Fle(r?.entries)??[],l=JGe({...t,participantMap:s,participants:a,eventEntries:o});if(l.error)return q({result:l,stack:n});let{appliedPolicies:u,policyDefinitions:c,drawSize:d,drawType:p,enforceGender:f,seedingProfile:m}=l,h=r?.eventType,g=t.matchUpType??h,I=Jje({...t,enforceGender:f,eventType:h,matchUpType:g});if(I.error)return q({result:I,stack:n});let{matchUpFormat:v,tieFormat:w}=I;if(t.drawId&&typeof t.drawId!="string")return q({result:{error:re},stack:n});let y=DGe({...t,policyDefinitions:c,tournamentRecord:i,appliedPolicies:u,matchUpFormat:v,seedingProfile:m,participants:a,eventEntries:o,matchUpType:g,tieFormat:w,drawSize:d,drawType:p,event:r});if(y.error)return q({result:y,stack:n});let{existingDrawDefinition:b,positioningReports:S,drawDefinition:U,structureId:T,conflicts:P,entries:D}=y;if(!U)return q({result:{error:re},stack:n});let E=PGe({...t,existingDrawDefinition:b,positioningReports:S,appliedPolicies:u,drawDefinition:U,seedingProfile:m,participants:a,structureId:T,entries:D,params:t,stack:n});if(E.error)return E;let{qualifyingConflicts:R}=E;return U.drawName=t.drawName??(p&&Qr(p)),d&&typeof e=="object"&&d>=4&&G2({...e,drawDefinition:U,matchUpType:g}),t.hydrateRoundNames&&u?.[Sc]&&Lle({drawDefinition:U,appliedPolicies:u}),{existingDrawDefinition:!!b,qualifyingConflicts:R,positioningReports:S,drawDefinition:U,structureId:T,...W,conflicts:P}}function aHe({matchUps:t,matchUpType:e}){if(!t)return{error:Nu};let i=[],r=[],n=0;e&&(t=t.filter(T=>T.matchUpType===e));let a=nt(t.map(({matchUpType:T})=>T));if(a.length>1)if(fm(a,ei))t=t.filter(Pi(ei));else if(fm(a,zt))t=t.filter(Pi(zt));else if(fm(a,Bt))t=t.filter(Pi(Bt));else return{};if(!Ka(t)||!t.length)return{};let s=(T,P)=>Ke(T)-Ke(P),o=nt(t.flatMap(T=>T.drawPositions).filter(Boolean)).sort(s),l=Ce(1,Math.max(...o)+1).filter(T=>!o.includes(T)).sort(s),{roundMatchUps:u}=Sn({matchUps:t}),c=u?.[1],d=u?.[2]??[],p=c?.[0],f=p?.drawId,m=p?.structureId,h=u?Object.keys(u).map(T=>Ke(T)):[],g=Math.max(...h),I=u?.[g]?.length??0,v=Math.ceil(Math.log(I)/Math.log(2)),w=Ce(1,v+1).map(T=>{let P=Math.pow(2,T-1),D=g+v-T+1;return Ce(1,P+1).map(E=>({drawId:f,structureId:m,matchUpId:Ct(),drawPositions:[],sides:[],roundNumber:D,roundPosition:E,finishingRound:T}))});v&&(t=t.concat(...w.flat()));let y=c?.map(T=>T.drawPositions)?.flat(1/0),b=d.map(T=>T.drawPositions).flat(1/0).filter(T=>!y?.includes(T)).sort(s),S=d.filter(T=>T.drawPositions?.find(P=>b.includes(P))).map(T=>{let P=T.drawPositions?.find(R=>b.includes(R)),D=P&&T.drawPositions?.indexOf(P),E=D!==void 0&&T.sides?.[D];return P&&{[P]:E}});if(l?.length&&b?.length===l?.length){let T=b.map((R,C)=>[R,l[C]].sort(s)),P=Object.assign({},...S),D=Oe(c?.[0].finishingRound,!1,!0),E=Oe(c?.[0].finishingPositionRange,!1,!0);r=T.map((R,C)=>{let M=Math.max(...R||[])/2,N=R?.map(A=>P[A]||{bye:!0,drawPosition:A});return{finishingPositionRange:E,sideNumber:C+1,matchUpStatus:"BYE",matchUpId:Ct(),finishingRound:D,roundNumber:1,drawPositions:R,roundPosition:M,structureId:m,drawId:f,sides:N}}),t=t.concat(...r)}let U=g+v;return Ce(1,U+1).forEach(T=>{let P=[],D=$q({matchUps:t,roundNumber:T}),E=$q({matchUps:t,roundNumber:T-1}),R=new Set(E.map(sHe).filter(Boolean)),C=D?.length===i?.length,M=D?.length===i?.length/2;T===1&&D.forEach(N=>{let A=N.drawPositions||[],{matchUpId:O,structureId:k}=N,F=[{...N.sides[0],drawPosition:A[0],matchUpId:O,structureId:k},{...N.sides[1],drawPosition:A[1],matchUpId:O,structureId:k}],x={...N,children:F};P.push(x)}),C?(n++,D.forEach((N,A)=>{let O=N.drawPositions||[],{matchUpId:k,structureId:F}=N,x=O.filter(Boolean).reduce((V,_)=>y?.includes(_)?V:_,void 0),L=[{...N.sides.filter(Boolean).reduce((V,_)=>_.participantId&&!R.has(_.participantId)?_:V,void 0),drawPosition:x,feedRoundNumber:n,sides:N.sides,matchUpId:k,structureId:F},i[A]],$={...N,children:L};P.push($)})):M&&D.forEach((N,A)=>{let O=[i[A*2],i[A*2+1]],k={...N,children:O};P.push(k)}),i=P}),{hierarchy:i[0],missingMatchUps:r,maxRound:g,finalRound:U,matchUps:t}}function $q({matchUps:t,roundNumber:e}){return t.filter(i=>i.roundNumber===e).sort((i,r)=>i.roundPosition-r.roundPosition)}function sHe(t){if(t.matchUpStatus==="BYE")return t.sides.reduce((e,i)=>i.participantId||e,void 0);if(t.winningSide)return t.sides.reduce((e,i)=>i.sideNumber===t.winningSide?i.participantId:e,void 0)}function _le({scaleAttributes:t,scaledEntries:e,stageEntries:i,seedsCount:r,scaleName:n}){if(!t)return{error:Je,info:"missing scaleAttributes"};let a=Object.assign({},...(e||[]).slice(0,r).map(({participantId:o},l)=>({[o]:l+1})));n=n||t.scaleName;let s=new Date().toISOString();return{scaleItemsWithParticipantIds:i.map(({participantId:o})=>({scaleItems:[{scaleValue:a[o],eventType:t.eventType,scaleType:Yl,scaleName:n,scaleDate:s}],participantId:o}))}}function oHe({tournamentRecord:t,drawDefinition:e,policyDefinitions:i,scaleAttributes:r,scaleName:n,drawSize:a,drawId:s,event:o,stage:l,sortDescending:u,scaleSortMethod:c}){let d=jN({policyDefinitions:i,drawDefinition:e,drawSize:a,drawId:s,event:o,stage:l});if(d.error)return d;let{entries:p,seedsCount:f,stageEntries:m}=d;if(!m||!f)return{error:re};let h=tg({tournamentRecord:t,scaleAttributes:r,scaleSortMethod:c,sortDescending:u,entries:p,stage:l}).scaledEntries??[],{scaleItemsWithParticipantIds:g}=_le({scaleAttributes:r,scaledEntries:h,stageEntries:m,seedsCount:f,scaleName:n});return{scaleItemsWithParticipantIds:g}}var $le={};dt($le,{addDrawEntries:()=>_2,addEventEntries:()=>Qo,addEventEntryPairs:()=>Hle,destroyPairEntries:()=>$ae,destroyPairEntry:()=>j2,getEntriesAndSeedsCount:()=>jN,getMaxEntryPosition:()=>Ij,modifyEntriesStatus:()=>JP,modifyEventEntries:()=>Wle,mutate:()=>Ble,promoteAlternate:()=>jle,promoteAlternates:()=>Oj,query:()=>Cle,removeDrawEntries:()=>Gle,removeEventEntries:()=>FU,setEntryPosition:()=>kj,setEntryPositions:()=>Vle});var Ble={};dt(Ble,{addDrawEntries:()=>_2,addEventEntries:()=>Qo,addEventEntryPairs:()=>Hle,destroyPairEntries:()=>$ae,destroyPairEntry:()=>j2,modifyEntriesStatus:()=>JP,modifyEventEntries:()=>Wle,promoteAlternate:()=>jle,promoteAlternates:()=>Oj,removeDrawEntries:()=>Gle,removeEventEntries:()=>FU,setEntryPosition:()=>kj,setEntryPositions:()=>Vle});function kj({tournamentRecord:t,drawDefinition:e,participantId:i,entryPosition:r,skipRefresh:n,event:a}){let s="setEntryPositions";if(!t)return{error:ve};if(!i)return q({result:{error:dr},stack:s});if(r!==void 0&&!Number.isSafeInteger(r))return{error:re,entryPosition:r};(a?.entries||[]).forEach(l=>{l.participantId===i&&(l.entryPosition=r)}),(e?.entries||[]).forEach(l=>{l.participantId===i&&(l.entryPosition=r)});let o=l=>{l.entries.forEach(u=>{u.entryPosition===r&&u.participantId!==i&&(u.entryPosition+=.1)})};return n||(a?.entries&&(o(a),a.entries=wo({entries:a.entries})),e?.entries&&(o(e),e.entries=wo({entries:e.entries}))),{...W}}function Vle({tournamentRecord:t,entryPositions:e,drawDefinition:i,event:r}){if(!t)return{error:ve};if(!Array.isArray(e))return{error:re};for(let n of e){let{participantId:a,entryPosition:s}=n,o=kj({skipRefresh:!0,tournamentRecord:t,drawDefinition:i,participantId:a,entryPosition:s,event:r});if(o.error)return o}return r?.entries&&(r.entries=wo({entries:r.entries})),i?.entries&&(i.entries=wo({entries:i.entries})),{...W}}function jle(t){let{participantId:e}=t;return e&&typeof e!="string"?{error:re,participantId:e}:Oj({...t,participantIds:[e].filter(Boolean)})}function Oj({tournamentRecord:t,drawDefinition:e,participantIds:i,stageSequence:r,stage:n=Ae,eventId:a,event:s}){if(!t)return{error:ve};if(!Array.isArray(i))return{error:re,participantIds:i};if(!s)return{error:ui};let o="promoteAlternates";if(s){let l=Bq({element:s,participantIds:i,stageSequence:r,stage:n});if(l.error)return l}if(e){let l=Bq({element:e,participantIds:i,stageSequence:r,stage:n});if(l.error)return a?q({context:{drawPromotionError:l.error,drawId:e.drawId},result:{...W},stack:o}):l}return{...W}}function Bq({participantIds:t,stageSequence:e,element:i,stage:r}){let n=(i.entries||[]).filter(d=>d.entryStatus===Gs),a=(i.entries||[]).filter(d=>t.includes(d.participantId)),s=n.reduce((d,p)=>{let{entryPosition:f}=p;return isNaN(f)&&d||(!d||f<d.entryPosition)&&p||d},void 0),o=a.length?a:[s].filter(Boolean);if(!o?.length)return{error:lie};let l=o.filter(({entryStatus:d})=>d!==Gs);if(l.length)return{error:cx,invalidEntryStatus:l};let u=o.filter(({entryStage:d})=>d&&d!==r);if(u.length)return{error:f1e,invalidStage:u};let c=e&&o.filter(d=>d.stageSequence!==e);if(c?.length)return{error:m1e,invalidStageSequence:c};for(let d of o){d.entryStatus=ca;let p=d?.entryPosition;isNaN(p)||i.entries.forEach(m=>{m.entryStatus===Gs&&m.entryPosition>p&&(m.entryPosition=m.entryPosition-1)});let f=Math.max(...i.entries.filter(m=>m.entryStatus===ca&&!isNaN(m.entryPosition)).map(({entryPosition:m})=>Ke(m||0)),0);d.entryPosition=f||0}return{...W}}function Gle({autoEntryPositions:t=!0,participantIds:e,drawDefinition:i,drawId:r,stages:n,event:a}){if(!a)return{error:ui};if(!r)return{error:xo};if(!e?.length)return{error:Wd};let s=Pf({drawDefinition:i,stages:n}).assignedParticipantIds??[];if(xn(s,e))return{error:kv};let o=c=>{let d=c.participantId;return!e.includes(d)},{flightProfile:l}=Bi({event:a}),u=l?.flights?.find(c=>c.drawId===r);return u?.drawEntries&&(u.drawEntries=u.drawEntries.filter(o),t&&(u.drawEntries=wo({entries:u.drawEntries}))),i?.entries&&(i.entries=i.entries.filter(o),t&&(i.entries=wo({entries:i.entries}))),{...W}}function Il(t){let e="addParticipant",{allowDuplicateParticipantIdPairs:i,returnParticipant:r,disableNotice:n,pairOverride:a,participant:s}=t,o=t.tournamentId?t.tournamentRecords?.[t.tournamentId]:t.tournamentRecord??(t.activeTournamentId&&t.tournamentRecords?.[t.activeTournamentId]);if(!o)return{error:ve};if(!s)return q({result:{error:kh},stack:e});s.participantId||(s.participantId=Ct()),o.participants||(o.participants=[]);let{participantId:l,individualParticipantIds:u}=s;if(o.participants.reduce((h,g)=>g.participantId===l||h,!1))return{error:rie};let{participantType:c,participantRole:d}=s;if(!c||!Object.keys(Yy).includes(c))return{error:Mo,participantType:c};if(!d)return{error:tie};let p=o.participants||[],f=p.filter(h=>h.participantType===It).map(h=>h.participantId);if(c!==It&&s.person)return{error:re,person:s.person};if(u&&!Array.isArray(u))return{error:re,individualParticipantIds:u};if(c===ft){if(s.person)return{error:re,person:s.person};if(s.individualParticipantIds){if(s.individualParticipantIds.length!==2&&!a)return q({info:"PAIR must be 2 individualParticipantIds",result:{error:Ia},stack:e});{let I=p.filter(v=>v.participantType===It).map(v=>v.participantId);if(!Array.isArray(s.individualParticipantIds))return q({result:{error:Ia},stack:e});if(!s.individualParticipantIds.reduce((v,w)=>I.includes(w)&&v,!0))return q({result:{error:Ia},stack:e})}}else return q({result:{error:Wd},stack:e});let h=p.filter(I=>I.participantType===ft).map(I=>({individualParticipantIds:I.individualParticipantIds,participant:I})),g=s.participantType===ft&&h.find(I=>Li(I.individualParticipantIds,s.individualParticipantIds).length===2);if(g&&!i)return{...W,existingParticipant:!0,participant:r&&Oe(g.participant)};if(!s.participantName){let I=p.filter(w=>s.individualParticipantIds?.includes(w.participantId)),v=I.map(w=>w.person?.standardFamilyName).filter(Boolean).join("/");I.length===1&&(v+="/Unknown"),s.participantName=v}}else if(c===It){if(!s.person?.standardFamilyName||!s.person?.standardGivenName)return{error:oie};if(!s.participantName){let h=`${s.person.standardFamilyName.toUpperCase()}, ${s.person.standardGivenName}`;s.participantName=h}}else if(c&&[_t,Ya].includes(c)){if(u||(s.individualParticipantIds=[]),s.individualParticipantIds?.length)for(let h of s.individualParticipantIds){if(typeof h!="string")return q({result:{participantId:h,error:re},stack:e});if(!f.includes(h))return q({result:{participantId:h,error:ji},stack:e})}}else return{error:Mo};o.participants.push(s),n||st({payload:{tournamentId:o.tournamentId,participants:[s]},topic:Td});let m={participant:r&&Oe(s),...W};return je(m)}function no({allowDuplicateParticipantIdPairs:t,returnParticipants:e,tournamentRecord:i,participants:r=[]}){if(!i)return{error:ve};i.participants||(i.participants=[]);let n=i.participants.map(d=>d.participantId)||[];r.forEach(d=>{d.participantId||(d.participantId=Ct())});let a=r.filter(d=>!n.includes(d.participantId)),s=r.filter(d=>n.includes(d.participantId)),o=a.filter(d=>d.participantType===It),l=a.filter(d=>d.participantType!==It),u=o.concat(...l),c=[];if(u.length){for(let p of u){let f=Il({allowDuplicateParticipantIdPairs:t,returnParticipant:!0,disableNotice:!0,tournamentRecord:i,participant:p});if(f.error)return f;f.success&&!f.existingParticipant&&c.push(f.participant)}c.length&&st({topic:Td,payload:{tournamentId:i.tournamentId,participants:c}});let d={participants:e&&Oe(c),addedCount:c.length,...W};return s.length&&Object.assign(d,{notAdded:s,info:hM}),je(d)}else return{info:"No new participants to add",addedCount:0,...W}}function Hle(t){let e=He(t,[{[hr]:!0,[Vc]:!0}]);if(e.error)return e;let{allowDuplicateParticipantIdPairs:i,entryStatus:r=Gs,participantIdPairs:n=[],entryStage:a=Ae,tournamentRecord:s,drawDefinition:o,event:l,uuids:u}=t;if(l.eventType!==Bt)return{error:cu};let c=[],d=new Map;for(let y of s.participants??[]){let{participantType:b,participantId:S,person:U,individualParticipantIds:T}=y;b===It&&U?.sex?d.set(S,U.sex):b===ft&&T&&c.push(T)}let p=n.filter(y=>{if(y.length!==2)return!0;if(!l.gender||du(l.gender))return!1;if(!d.has(y[0])||!d.has(y[1]))return!0;let b=y.map(U=>d.get(U)),S=Kf(l.gender)&&(!Kf(b[0])||!Kf(b[1]))||cp(l.gender)&&(!cp(b[0])||!cp(b[1]));return Aa(l.gender)&&(b.sort(rN),(!cp(b[0])||!Kf(b[1]))&&(S=!0)),S});if(p.length)return{error:Ia,invalidParticipantIdPairs:p};let f=n.map(y=>({participantId:u?.pop()??Ct(),participantRole:Jr,individualParticipantIds:y,participantType:ft})),m=i?f:f.filter(y=>!c.find(b=>Li(b,y.individualParticipantIds).length===2)),h,g=[];if(m){let y=no({allowDuplicateParticipantIdPairs:i,participants:m,returnParticipants:!0,tournamentRecord:s});if(y.error)return y;g=y.participants||[],h=y.info}let I=n.map(y=>{let b=g.find(U=>Li(U.individualParticipantIds,y).length===2);if(b)return b;let{participant:S}=ro({tournamentRecord:s,participantIds:y});return S}).map(y=>y.participantId),v=Qo({participantIds:I,tournamentRecord:s,drawDefinition:o,entryStatus:r,entryStage:a,event:l});m.length&&st({payload:{participants:m},topic:Td});let w=m.map(yt);return{...v,info:h,newParticipantIds:w}}function Wle({entryStatus:t=ca,unpairedParticipantIds:e=[],participantIdPairs:i=[],entryStage:r=Ae,tournamentRecord:n,event:a}){if(!n)return{error:ve};if(!a)return{error:ui};let s=n.participants??[],o=s.filter(h=>h.participantType===It).map(h=>h.participantId),l=e.concat(...i).flat(1/0).filter(h=>!o.includes(h));if(l.length)return{error:Ia,invalidParticipantIds:l};let u=i.filter(h=>h.length!==2);if(u.length)return{error:Ia,invalidParticipantIdPairs:u};let c=s.filter(h=>h.participantType===ft).map(h=>h.individualParticipantIds),d=i.filter(h=>!c.find(g=>Li(g,h).length===2)).map(h=>({participantType:ft,participantRole:Jr,individualParticipantIds:h})),p=no({participants:d,tournamentRecord:n});if(p.error)return p;let f=i.map(h=>{let{participant:g}=ro({tournamentRecord:n,participantIds:h});return g}).map(h=>({participantId:h,entryStatus:t,entryStage:r})),m=e.map(h=>({entryStatus:Us,participantId:h,entryStage:r}));return a.entries=(a.entries??[]).filter(h=>h.entryStage===r),a.entries=a.entries.concat(...f,...m),{...W}}var zle={};dt(zle,{addDrawDefinition:()=>nT,addEvent:()=>ty,addFlight:()=>XN,assignSeedPositions:()=>aue,attachFlightProfile:()=>Vj,categoryCanContain:()=>aU,deleteDrawDefinitions:()=>qN,deleteEvents:()=>oue,deleteFlightAndFlightDraw:()=>rue,deleteFlightProfileAndFlightDraws:()=>Qle,generate:()=>qle,generateEventsFromTieFormat:()=>Kle,getCategoryAgeDetails:()=>Bp,getEvent:()=>Aj,getEventProperties:()=>Mj,getEventStructures:()=>oN,getEventTimeItem:()=>vU,getEvents:()=>Nj,getFlightProfile:()=>Bi,getScaledEntries:()=>tg,modifyEvent:()=>lue,modifyEventMatchUpFormatTiming:()=>Zle,modifyPairAssignment:()=>nue,mutate:()=>Xle,query:()=>xle,refreshEventDrawOrder:()=>Bj,removeEventMatchUpFormatTiming:()=>YN,removeScaleValues:()=>jj,removeSeeding:()=>sue,setEventDates:()=>_j,setEventDisplay:()=>KN,setEventEndDate:()=>Lj,setEventStartDate:()=>Fj,updateDrawIdsOrder:()=>$j,validateCategory:()=>Wb});var qle={};dt(qle,{generateEventsFromTieFormat:()=>Kle});function lHe({tournamentId:t,event:e}){return e?(st({payload:{tournamentId:t,event:e},key:e.eventId,topic:yne}),{...W}):{error:ui}}var uHe={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_D3",winCriteria:{valueGoal:5}},cHe={collectionDefinitions:[{collectionName:"Doubles",collectionValue:1,matchUpCount:3,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES"},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_DEFAULT",winCriteria:{valueGoal:5}},dHe={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_JUCO",winCriteria:{valueGoal:5}},Yle={COLLEGE_D3:uHe,COLLEGE_DEFAULT:cHe,COLLEGE_JUCO:dHe,DOMINANT_DUO:pre,DOMINANT_DUO_MIXED:ore,LAVER_CUP:Ire,TEAM_DOUBLES_3_AGGREGATION:ire,TIME_TENNIS_DUAL:lre,TIME_TENNIS_PRO_CIRCUIT:sre,USTA_BREWER_CUP:ure,USTA_OZAKI_CUP:cre,USTA_COLLEGE:fre,USTA_GOLD_TEAM_CHALLENGE:tre,USTA_INTERSECTIONAL:are,USTA_LEVEL_1:mre,USTA_SECTION_BATTLE:nre,USTA_SOUTHERN_LEVEL_5:rre,USTA_TOC:vre,USTA_WTT_ITT:hre,USTA_ZONAL:gre};function ty({suppressNotifications:t,tournamentRecord:e,internalUse:i,event:r}){if(!e)return{error:ve};if(e.events||(e.events=[]),!r)return{error:ui};let{startDate:n,endDate:a}=e;if(!i&&(r.entries?.length||r.drawDefinitions?.length)){let o=je({drawDefinitions:!!r.drawDefinitions?.length,entries:!!r.entries?.length});return{info:"entries/drawDefinitions cannot exist",error:re,context:o}}let s={eventType:Bm,drawDefinitions:[],entries:[],startDate:n,endDate:a,...r};if(r.eventType===Ua){if(r.tieFormat){let o=Gn({tieFormat:r.tieFormat});if(o.error)return o}else if(r.tieFormatName){if(!Yle[r.tieFormatName])return{context:{tieFormatName:r.tieFormatName},error:re};let o=bc({isMock:e?.isMock,namedFormat:r.tieFormatName,event:r});s.tieFormat=o}}if(s.eventId||(s.eventId=Ct()),e.events.reduce((o,l)=>o||l.eventId===s.eventId,void 0))return{error:kte};{let o=s;if(e.events.push(o),!t){let{topics:l}=bs();if(l.includes(jM)){let d=xu({event:r}).matchUps??[];Dd({tournamentId:e?.tournamentId,eventId:r.eventId,matchUps:d})}let{drawDefinitions:u,...c}=r;for(let d of u||[])hU({drawDefinition:d});lHe({tournamentId:e?.tournamentId,event:c})}return{...W,event:s}}}function Kle(t){let e=He(t,[{[RI]:{[AM]:!0,[zre]:!0}},{[hr]:!0}]);if(e.error)return e;let i=t.tieFormat||bc({namedFormat:t.tieFormatName}),r=t.uuids||[ere(i.collectionDefinitions.length)],n={[tr]:[],[zr]:[]};if(t.addEntriesFromTeams){let s=t.tournamentRecord.participants?.filter(o=>o.participantType===$n)?.flatMap(o=>o.individualParticipantIds??[]);for(let o of t.tournamentRecord.participants??[])if(s?.includes(o.participantId)){let l=o.person?.sex;if(l&&cl(l)){let u=ln(l);u&&n[u].push(o.participantId)}}}let a=[];for(let s of i.collectionDefinitions??[]){let o=r?.pop()?.toString()||Ct(),l=s.matchUpType,u=s.gender,c={matchUpFormat:s.matchUpFormat,eventName:s.collectionName,category:s.category,gender:u,eventType:l,eventId:o};if(t.addEntriesFromTeams){let d=l===wc?Us:t.entryStatus||ca,p=Aa(u)?[...n[tr],...n[zr]]:n[ln(u)||zu]??[];if(p.length){let f=Qo({participantIds:p,entryStatus:d,event:c});if(f.error)return f}}if(a.push(c),t.addEvents!==!1){let d=ty({internalUse:!0,tournamentRecord:t.tournamentRecord,event:c});if(d.error)return d}}return{...W,events:a}}var Xle={};dt(Xle,{addDrawDefinition:()=>nT,addEvent:()=>ty,addFlight:()=>XN,assignSeedPositions:()=>aue,attachFlightProfile:()=>Vj,deleteDrawDefinitions:()=>qN,deleteEvents:()=>oue,deleteFlightAndFlightDraw:()=>rue,deleteFlightProfileAndFlightDraws:()=>Qle,modifyEvent:()=>lue,modifyEventMatchUpFormatTiming:()=>Zle,modifyPairAssignment:()=>nue,refreshEventDrawOrder:()=>Bj,removeEventMatchUpFormatTiming:()=>YN,removeScaleValues:()=>jj,removeSeeding:()=>sue,setEventDates:()=>_j,setEventDisplay:()=>KN,setEventEndDate:()=>Lj,setEventStartDate:()=>Fj,updateDrawIdsOrder:()=>$j,validateCategory:()=>Wb});function iy({removePriorValues:t=!0,status:e=Xa,statusObject:i,event:r}){if(!wt(i))return{error:re};let n=Qa({event:r,status:e}),a=`${Jd}.${Qd}`,s={itemValue:{[e]:{...n,...i}},itemType:a};return Zh({timeItem:s,removePriorValues:t,event:r})}function ry(t){let e=He(t,[{[hr]:!0,[Vc]:!0},{eventDataParams:!1,[qn]:Kn}]);if(e.error)return e;let{includePositionAssignments:i,removePriorValues:r,tournamentRecord:n,status:a=Xa,event:s,drawIdsToRemove:o,drawIdsToAdd:l}=t,{appliedPolicies:u}=Dt({tournamentRecord:n,event:s}),c={...u,...t.policyDefinitions},d=s?.drawDefinitions?.map(({drawId:b})=>b)??[],p=t.drawDetails?Object.keys(t.drawDetails):[],f=p.length?[]:t.drawIds,m=(l??[]).concat(...o??[],...f??[],...p),h=m.filter(b=>!d.includes(b));if(h.length)return q({result:{error:_a},context:{invalidDrawIds:h}});if(t.drawDetails)for(let b of Object.keys(t.drawDetails)){let S=t.drawDetails[b];if(S.publishingDetail?.embargo&&!nd(S.publishingDetail.embargo))return{error:kg};if(S.stageDetails){for(let U of Object.keys(S.stageDetails))if(S.stageDetails[U].embargo&&!nd(S.stageDetails[U].embargo))return{error:kg}}if(S.structureDetails)for(let U of Object.keys(S.structureDetails)){let T=S.structureDetails[U];if(T.embargo&&!nd(T.embargo))return{error:kg};if(T.scheduledRounds){for(let P of Object.keys(T.scheduledRounds))if(T.scheduledRounds[P].embargo&&!nd(T.scheduledRounds[P].embargo))return{error:kg}}}}let g=Qa({event:s,status:a}),I=Object.keys(g?.drawDetails||{}).filter(b=>d.includes(b)).reduce((b,S)=>(b[S]=g.drawDetails[S],b),{});for(let b of d)if((!m.length||m.includes(b))&&(o?.includes(b)||f?.length&&!f.includes(b)?I[b]={...I[b],publishingDetail:{published:!1}}:(l?.includes(b)||f?.includes(b)||!f?.length)&&(I[b]={...I[b],publishingDetail:{published:!0}})),t.drawDetails?.[b]){let S=t.drawDetails[b],U=S.structureDetails??I[b].structureDetails,T=S.stageDetails??I[b].stageDetails??{},{structureIdsToRemove:P=[],structureIdsToAdd:D=[],publishingDetail:E={},stagesToRemove:R=[],stagesToAdd:C=[]}=S;if((D||C)&&(E.published=!0),I[b]={publishingDetail:E,structureDetails:U,stageDetails:T},D.length||P.length){let N=(s?.drawDefinitions?.find(O=>O.drawId===b)?.structures??[]).map(({structureId:O})=>O),A=(D??[]).concat(P??[]).filter(O=>!N.includes(O));if(A.length)return q({result:{error:vi},context:{invalidStructureIds:A}});U=U??{};for(let O of N)P.includes(O)?U[O]={published:!1}:U[O]={published:!0};I[b].structureDetails=U}let M=(s?.drawDefinitions?.find(N=>N.drawId===b)?.structures??[]).map(({stage:N})=>N);if(C.length){for(let N of C)T[N]={published:!0};for(let N of M)T[N]||(T[N]={published:!1})}if(C.length||R.length){for(let N of R)T[N]={published:!1};for(let N of M)T[N]||(T[N]={published:!0})}(C.length||R.length)&&(I[b].stageDetails=T)}iy({statusObject:{drawDetails:I},removePriorValues:r,status:a,event:s});let{topics:v}=bs(),w=v.includes(Ux),y=w||t.returnEventData?KU({includePositionAssignments:i,...t.eventDataParams,usePublishState:!0,tournamentRecord:n,policyDefinitions:c,event:s})?.eventData:void 0;return w&&st({payload:{eventData:y,tournamentId:n.tournamentId},topic:Ux}),{...W,eventData:y}}var Jle="deleteDrawDefinitions",Xx="autoSchedulingAudit",SD="deleteEvents",pHe={AUTO_SCHEDULING_AUDIT:Xx,DELETE_EVENTS:SD,DELETE_DRAW_DEFINITIONS:Jle};function qN(t){if(!t.tournamentRecord)return{error:ve};let e="deleteDrawDefinitions",i=t.drawIds??[],r=t.event,{autoPublish:n=!0,tournamentRecord:a,auditData:s,eventId:o,force:l}=t,{appliedPolicies:u}=Dt({tournamentRecord:a,event:r}),c={...u,...t.policyDefinitions},d=Array.isArray(i)?i[0]:void 0;if(!r){let T=Wn({tournamentRecord:a,eventId:o,drawId:d});if(T.error)return T;r=T.event}let p=[],f=[],m=[];if(!r?.drawDefinitions)return q({info:"event has no drawDefinition",result:{...W},stack:e});let h=r.drawDefinitions.map(({drawId:T})=>T);if(i.length||(i=h),i=i.filter(T=>h.includes(T)),!i.length)return q({info:"nothing to do; no matching drawIds in event.",result:{...W},stack:e});let g=Oe(Bi({event:r}).flightProfile,!1,!0),I=({participantId:T,drawPosition:P,qualifier:D,bye:E})=>({bye:E,qualifier:D,drawPosition:P,participantId:T}),v=l??u?.[ms]?.allowDeletionWithScoresPresent?.drawDefinitions,w=Qa({event:r})??{},y=w.drawIds??(w.drawDetails&&Object.keys(w.drawDetails))??[],b,S=[],U=r.drawDefinitions.filter(T=>{if(i.includes(T.drawId)){let P=An({event:r,drawDefinition:T})?.matchUps??[];if(P.some(({score:F})=>fr({score:F}))&&!v)return S.push(T.drawId),!0;let{drawId:D,drawType:E,drawName:R}=T,C=g?.flights?.find(F=>F.drawId===T.drawId);C&&(C.drawEntries=C.drawEntries?.filter(F=>uo.includes(F.entryStatus))),y.includes(D)&&(y=y.filter(F=>F!==D),b=!0);let M=io({stageSequence:1,drawDefinition:T,stage:Ae})?.structures?.[0],N=(M?OI({structureId:M.structureId,tournamentRecord:a,drawDefinition:T}):void 0)?.positionAssignments?.map(I),A=io({stage:ze,drawDefinition:T})?.structures,O=A?.length?A.map(F=>{let x=F.stageSequence;return{positionAssignments:OI({structureId:F.structureId,tournamentRecord:a,drawDefinition:T})?.positionAssignments.map(I),stageSequence:x}}):void 0,k={action:Jle,payload:{drawDefinitions:[T],eventId:o??r?.eventId,auditData:s}};m.push(k),p.push(je({tournamentId:a.tournamentId,eventId:o??r?.eventId,qualifyingPositionAssignments:O,positionAssignments:N,auditData:s,drawType:E,drawName:R,drawId:D})),P?.forEach(({matchUpId:F})=>f.push(F))}return!i.includes(T.drawId)});if(S.length&&!l)return q({context:{drawIdsWithScoresPresent:S},result:{error:iU},stack:e});if(r.drawDefinitions=U,g&&Yd({event:r,extension:{name:to,value:g}}),eT({tournamentRecord:a}),b){let T={};for(let D of y)T[D]=w.drawDetails?.[D]??{published:!0};let P=iy({statusObject:{drawDetails:T},event:r});if(P.error)return{error:P.error}}if(m.length)if(wM(ec)){let T=a.tournamentId;st({topic:ec,payload:{tournamentId:T,detail:m}});let P=(Ss({element:r,itemType:vp})?.timeItem?.itemValue||0)+1;Cl({element:r,timeItem:{itemType:vp,itemValue:P},removePriorValues:!0})}else fHe({appliedPolicies:u,event:r,deletedDrawsDetail:p,auditData:s});if(f.length&&ku({tournamentId:a?.tournamentId,matchUpIds:f}),i.forEach(T=>bLe({drawId:T})),n&&b){let T=ry({...t.eventDataParams,drawIdsToRemove:i,policyDefinitions:c,tournamentRecord:a,event:r});if(T.error)return{...W,info:T.error}}return{...W}}function fHe({appliedPolicies:t,event:e,deletedDrawsDetail:i,auditData:r}){if(t?.audit?.[vp]===!1)return;let{extension:n}=ht({name:vp,element:e}),a={...r,deletedDrawsDetail:i},s={value:Array.isArray(n?.value)?n?.value.concat(a):[a],name:vp};Ft({element:e,extension:s})}function Qle({autoPublish:t=!0,tournamentRecord:e,auditData:i,event:r,force:n}){if(!e)return{error:ve};if(!r)return{error:ui};let{flightProfile:a}=Bi({event:r});if(a){let s=a.flights?.map(({drawId:l})=>l).filter(Boolean),o=qN({eventId:r.eventId,tournamentRecord:e,autoPublish:t,auditData:i,drawIds:s,event:r,force:n});return o.error?o:_M({event:r,name:to})}return{...W}}function xj(t){let{matchUpFormat:e,recoveryTimes:i,averageTimes:r,tournamentId:n,eventId:a}=t,s=t?.tournamentRecords??(t?.tournamentRecord&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord})??{};if(!Object.keys(s).length)return{error:Mi};let o=Object.keys(s).filter(u=>!n||n===u);if(n&&!o.includes(n))return{error:re};let l;for(let u of o){let c=s[u],{event:d}=Wn({tournamentRecord:c,eventId:a});a&&d&&(l=!0);let p=mHe({tournamentRecord:c,event:d,matchUpFormat:e,averageTimes:r,recoveryTimes:i});if(p.error)return p}return!a||l?{...W}:{error:ps}}function mHe({tournamentRecord:t,recoveryTimes:e,matchUpFormat:i,averageTimes:r,event:n}){if(!t)return{error:ve};if(r&&!Array.isArray(r))return{error:re};if(e&&!Array.isArray(e))return{error:re};let a=Tc;if(n){let{extension:s}=ht({element:n,name:a}),o=s?.value||{},l=Vq({...o,matchUpFormat:i,averageTimes:r,recoveryTimes:e});Ft({element:n,extension:{name:a,value:l}})}else{let{extension:s}=ht({element:t,name:a}),o=s?.value||{},l=Vq({...o,matchUpFormat:i,averageTimes:r,recoveryTimes:e});Ft({extension:{name:a,value:l},element:t})}return{...W}}function Vq(t){let{matchUpRecoveryTimes:e=[],matchUpAverageTimes:i=[],matchUpFormat:r}=t,{averageTimes:n,recoveryTimes:a}=t;n=(n||[]).filter(l=>l?.categoryNames?.length||l?.categoryTypes?.length);let s=n?.length&&i.map(l=>l?.matchUpFormatCodes.includes(r)?{...l,matchUpFormatCodes:l.matchUpFormatCodes?.filter(u=>u!==r)}:l).filter(({matchUpFormatCodes:l})=>l?.length).concat({matchUpFormatCodes:[r],averageTimes:n});a=(a||[]).filter(l=>l?.categoryNames?.length||l?.categoryTypes?.length);let o=a?.length&&e.map(l=>l?.matchUpFormatCodes.includes(r)?{...l,matchUpFormatCodes:l.matchUpFormatCodes?.filter(u=>u!==r)}:l).filter(({matchUpFormatCodes:l,averageTimes:u})=>l?.length||u).concat({matchUpFormatCodes:[r],recoveryTimes:a});return{matchUpAverageTimes:s?.length&&s||i,matchUpRecoveryTimes:o?.length&&o||e}}function Zle(t){let{tournamentRecord:e,recoveryMinutes:i,averageMinutes:r,matchUpFormat:n,categoryType:a,eventId:s,event:o}=t;if(!e)return{error:ve};if(!$a({matchUpFormat:n}))return{error:re};if(!o)return{error:ui};let{averageTimes:l=[],recoveryTimes:u=[]}=GN({tournamentRecord:e,matchUpFormat:n,event:o}),c=o.category,d=c?.categoryName||c?.ageCategoryCode||o?.eventId,p={categoryNames:[d],minutes:{}},f={categoryNames:[d],minutes:{}},m=w=>{if(w.categoryTypes?.includes(a)&&console.log("encountered:",{categoryType:a}),!(w.categoryNames?.includes(d)&&(w.categoryNames=w.categoryNames.filter(y=>y!==d),p={minutes:w.minutes,categoryNames:[d]},!w.categoryNames.length)))return w},h=r&&!isNaN(Ke(r)),g=i&&!isNaN(Ke(i)),I=l.map(m).filter(w=>w?.categoryNames?.length),v=u.map(m).filter(w=>w?.categoryNames?.length);return h&&(Object.assign(p.minutes,{[o?.eventType||zt]:r}),I.push(p)),g&&(Object.assign(f.minutes,{[o?.eventType||zt]:i}),v.push(f)),!h&&!g?{error:re}:xj({averageTimes:h&&I,recoveryTimes:g&&v,tournamentRecord:e,matchUpFormat:n,eventId:s})}function YN(t){if(t.event)return jq({event:t.event});{t.tournamentRecord&&!t.tournamentRecords&&(t.tournamentRecords={[t.tournamentRecord.tournamentId]:t.tournamentRecord});let e=He(t,[{[pn]:!0,[Jre]:!0}]);if(e.error)return e;let{tournamentRecords:i,eventId:r}=t;for(let n of Object.values(i??{})){let{event:a}=Wn({tournamentRecord:n,eventId:r});if(a)return jq({event:a})}}return{error:ps}}function jq({event:t}){return _M({event:t,name:Tc})}var eue={MON:"MON",TUE:"TUE",WED:"WED",THU:"THU",FRI:"FRI",SAT:"SAT",SUN:"SUN"};function tue(t){return!Array.isArray(t)||nt(t).length!==t.length?!1:t.every(e=>Object.keys(eue).includes(e))}function Fj({tournamentRecord:t,event:e,startDate:i}){if(!t)return{error:ve};if(!e)return{error:ui};if(!dl.test(i))return{error:or};let r=iue(t),n="setEventStartDate";if(r.error)return q({result:r,stack:n});let{tournamentStartDate:a,tournamentEndDate:s}=r,o=new Date(Ze(i)).getTime();if(!a||!s||o<a||o>s)return q({result:{error:or},stack:n,info:"startDate must be within tournament start and end dates"});let l=e.endDate&&new Date(Ze(e.endDate)).getTime();return l&&o>l&&(e.endDate=i),e.startDate=i,{...W}}function Lj(t){let{tournamentRecord:e,event:i,endDate:r}=t;if(!e)return{error:ve};if(!i)return{error:ui};if(!dl.test(r))return{error:or};let n=iue(e);if(n.error)return n;let{tournamentStartDate:a,tournamentEndDate:s}=n,o=new Date(Ze(r)).getTime();if(!a||!s||o<a||o>s)return{error:or};let l=i.startDate&&new Date(Ze(i.startDate)).getTime();return l&&o<l&&(i.startDate=r),i.endDate=r,{...W}}function _j(t){let e="setEventDates",i=He(t,[{tournamentRecord:!0,event:!0},{[qr]:u=>dl.test(u),[Ba]:or,startDate:!1,endDate:!1},{[qr]:u=>u.filter(Boolean).every(c=>dl.test(c)),[Ba]:or,activeDates:!1},{[qr]:tue,weekdays:!1}]);if(i.error)return i;let{tournamentRecord:r,weekdays:n,event:a,startDate:s,endDate:o}=t,l=t.activeDates?.filter(Boolean);if(s&&o){let u=new Date(Ze(s)).getTime(),c=new Date(Ze(o)).getTime();if(u>c)return q({result:{error:re},stack:e,info:"startDate cannot be after endDate"})}if(l){let u=s||r.startDate,c=o||r.endDate,d=!u||l.every(f=>new Date(f)>=new Date(u)),p=!c||l.every(f=>new Date(f)<=new Date(c));if(!d||!p)return q({result:{error:or},stack:e})}if(s){let u=Fj({tournamentRecord:r,event:a,startDate:s});if(u.error)return q({result:u,stack:e})}if(o){let u=Lj({tournamentRecord:r,event:a,endDate:o});if(u.error)return q({result:u,stack:e})}return l&&(a.activeDates=l),n&&(a.weekdays=n),{...W}}function iue(t){let{startDate:e,endDate:i}=t;return!dl.test(e)||!dl.test(i)?q({result:{error:Xte},context:{startDate:e,endDate:i}}):{tournamentStartDate:new Date(Ze(e)).getTime(),tournamentEndDate:new Date(Ze(i)).getTime()}}function $j({event:t,orderedDrawIdsMap:e}){if(typeof t!="object")return{error:ui};if(!e)return{error:Je,info:"Missing drawIdsOrderMap"};if(typeof e!="object")return{error:re,info:"orderedDrawIdsMap must be an object"};let i=Object.values(e);if(!i.every(n=>!Number.isNaN(Number(n))))return{error:re,info:"drawOrder must be numeric"};if(nt(i).length!==i.length)return{info:"drawOrder values must be unique",error:re};if(t.drawDefinitions?.length){let n=(t.drawDefinitions||[]).map(({drawId:s})=>s),a=Object.keys(e);if(a?.length&&Li(n,a).length!==n.length)return{error:re,info:"Missing drawIds"};t.drawDefinitions.forEach(s=>{s.drawOrder=e[s.drawId]})}let{flightProfile:r}=Bi({event:t});return r?.flights?.forEach(n=>{n.flightNumber=e[n.drawId]}),{...W}}function Bj({tournamentRecord:t,event:e}){if(!t)return{error:ve};if(!e)return{error:ui};let{flightProfile:i}=Bi({event:e}),r=i?.flights?.sort((s,o)=>s.flightNumber-o.flightNumber).map(s=>s.drawId).filter(Boolean),n=e.drawDefinitions?.sort((s,o)=>s.drawOrder-o.drawOrder).map(s=>s.drawId).filter(Boolean).filter(s=>!r?.includes(s)),a=Object.assign({},...[...r||[],...n||[]].map((s,o)=>({[s]:o+1})));return a?$j({event:e,orderedDrawIdsMap:a}):{...W}}function rue({autoPublish:t=!0,tournamentRecord:e,auditData:i,drawId:r,event:n,force:a}){if(!e)return{error:ve};if(!r)return{error:xo};if(!n)return{error:ui};let{flightProfile:s}=Bi({event:n});if(s&&s.flights?.find(o=>o.drawId===r)){let o=s.flights.filter(u=>u.drawId!==r),l={name:to,value:{...s,flights:o}};Yd({event:n,extension:l})}if(n.drawDefinitions?.find(o=>o.drawId===r)){let o=qN({drawIds:[r],eventId:n.eventId,tournamentRecord:e,autoPublish:t,auditData:i,event:n,force:a});if(o.error)return o}return Bj({tournamentRecord:e,event:n})}function nue(t){let e=He(t,[{[Vc]:!0,[hr]:!0,[GB]:!1},{replacementIndividualParticipantId:!0,[qr]:g=>ni(g),existingIndividualParticipantId:!0,[js]:dr,participantId:!0}]),{replacementIndividualParticipantId:i,existingIndividualParticipantId:r,tournamentRecord:n,drawDefinition:a,participantId:s,event:o,uuids:l}=t;if(e.error)return e;if(o?.eventType!==fs)return{error:cu};if(!(o?.entries?.filter(({entryStatus:g})=>[Us,Sf].includes(g)).map(({participantId:g})=>g)||[]).includes(i))return{error:Co};let u=(n.participants||[]).find(g=>g.participantId===s);if(u?.participantType!==ft)return{error:$p,participant:u};let c=u.individualParticipantIds,d=[i,...c.filter(g=>g!==r)],{participant:p}=ro({participantIds:d,tournamentRecord:n}),f;if(p)f=p.participantId;else{let g={participantId:l?.pop(),participantRole:Jr,individualParticipantIds:d,participantType:ft},I=Il({participant:g,returnParticipant:!0,tournamentRecord:n});if(I.error)return I;f=I.participant.participantId}let{flightProfile:m}=Bi({event:o});if(a){let g=m?.flights?.find(({drawId:I})=>I===a.drawId);g&&(g.drawEntries=g.drawEntries.map(I=>I.participantId===s?{...I,participantId:f}:I)),a.entries=a.entries.map(I=>I.participantId===s?{...I,participantId:f}:I);for(let I of a.structures||[])if(I.structures){I.positionAssignments=void 0;for(let v of I.structures)v.positionAssignments=v.positionAssignments.map(w=>w.participantId===s?{...w,participantId:f}:w)}else I.positionAssignments&&(I.positionAssignments=I.positionAssignments.map(v=>v.participantId===s?{...v,participantId:f}:v))}o.entries=o.entries.map(g=>g.participantId===s&&{...g,participantId:f}||g.participantId===i&&{...g,participantId:r}||g);let h=n.events.some(({entries:g,eventId:I,drawDefinitions:v})=>o.eventId===I?v.some(({drawId:w,entries:y})=>w===a?.drawId?!1:y?.find(b=>b.participantId===s)):g?.find(w=>w.participantId===s));if(!h){let g=Kh({addIndividualParticipantsToEvents:!1,participantIds:[s],tournamentRecord:n});if(g.error)return g}return{...W,participantOtherEntries:h,newPairParticipantId:f}}function nT(t){let{flight:e,suppressNotifications:i,modifyEventEntries:r,existingDrawCount:n,allowReplacement:a,checkEntryStatus:s,tournamentRecord:o,drawDefinition:l,event:u}=t;if(!l)return{error:$e};if(!u)return{error:ui};u.drawDefinitions||(u.drawDefinitions=[]);let{drawId:c,drawName:d,entries:p}=l,{entries:f}=u,m=0;if(n!==void 0&&n!==u.drawDefinitions.length)return{error:re,info:"drawDefintions count mismatch"};let{flightProfile:h}=Bi({event:u}),g=e&&h?.flights?.find(R=>R.flightNumber===e.flightNumber),I=h?.links?.find(R=>R?.target?.drawId===c)?.source?.drawId;if(I&&!u.drawDefinitions.find(R=>R.drawId===I))return q({result:{error:$e},info:{sourceDrawId:I}});if(g&&g.drawId!==l.drawId)return q({result:{error:mm},info:{relevantFlight:g}});let v=p?.every(({participantId:R,entryStatus:C})=>{let M=g?.drawEntries.find(N=>N.participantId===R);return!C||M?.entryStatus===C}),w=!s||f&&p?.every(({participantId:R,entryStatus:C,entryStage:M})=>f.find(N=>N.participantId===R&&(!N.entryStage||N.entryStage===M))?.entryStatus===C);if(g&&!v)return q({result:{error:mm},context:{drawEntriesPresentInFlight:v,matchingEventEntries:w,relevantFlight:g},info:"Draw entries are not present in flight or do not match entryStatuses"});if(r&&p?.filter(Boolean).forEach(R=>{if(R?.entryStatus&&uo.includes(R?.entryStatus)){let C=f?.filter(Boolean).find(M=>M.participantId===R.participantId);C&&R.entryStatus&&C?.entryStatus!==R.entryStatus&&(C.entryStatus=R.entryStatus,m+=1)}}),f&&!w)return q({result:{info:"Draw entries do not match event entryStatuses",context:{matchingEventEntries:w,eventEntries:f},error:mm}});let y=h?.flights?.map(({flightNumber:R})=>!isNaN(R)&&Ke(R))?.filter(Boolean)||[],b=u.drawDefinitions.map(({drawOrder:R})=>R&&Ke(R))?.filter(Boolean)||[],S=Math.max(0,...b,...y)+1,U=h?.flights?.find(R=>R.drawId===c),T;if(U){U.drawName=l.drawName,T={name:to,value:{...h,flights:h.flights}};let R=U.flightNumber;R&&!b.includes(R)?S=R:U.flightNumber=S}else{let R=h?.flights||[];R.push({manuallyAdded:!0,flightNumber:S,drawEntries:p,drawName:d,drawId:c}),T={name:to,value:{...h||{},flights:R}}}Yd({event:u,extension:T}),Object.assign(l,{drawOrder:S});let P=u.drawDefinitions.find(R=>R.drawId===c),D=o?.tournamentId,E=u.eventId;if(P){if(!a)return{error:Ute};let R=An({drawDefinition:P})?.matchUps?.map(vr)??[],C=An({drawDefinition:l})?.matchUps;if(!i){R?.length&&ku({matchUpIds:R,action:"modifyDrawDefinition",tournamentId:D,eventId:E}),C?.length&&Dd({matchUps:C,tournamentId:D,eventId:E}),u.drawDefinitions=u.drawDefinitions.map(N=>N.drawId===c?l:N);let M=l.structures?.map(({structureId:N})=>N);ii({drawDefinition:l,tournamentId:D,structureIds:M,eventId:E})}}else if(u.drawDefinitions.push(l),!i){let{matchUps:R}=An({drawDefinition:l,event:u});R&&Dd({tournamentId:o?.tournamentId,matchUps:R}),hU({drawDefinition:l,tournamentId:D,eventId:E})}return{...W,modifiedEventEntryStatusCount:m}}function aue(t){let{provisionalPositioning:e,useExistingSeedLimit:i,tournamentRecord:r,drawDefinition:n,seedingProfile:a,structureId:s,assignments:o,drawId:l,event:u}=t,c=0;if(!o?.length)return{error:iB};if(!r)return{error:ve};if(!l)return{error:xo};let d=hs({provisionalPositioning:e,drawDefinition:n,structureId:s});if(d.error)return d;let{seedAssignments:p,seedLimit:f}=d,m=Object.assign({},...(p??[]).filter(I=>I.seedNumber).map(I=>({[I.seedNumber]:I})));o.forEach(I=>{let{seedNumber:v}=I;f&&v<=f&&(!i||m[v])&&(m[v]=I)});let h=Object.values(m),g=h.map(I=>I?.participantId).filter(Boolean);if(g.length!==dte(g).length)return{error:Tte};for(let I of h){let v=Yv({...I,provisionalPositioning:e,tournamentRecord:r,drawDefinition:n,seedingProfile:a,structureId:s,event:u});if(v?.error)return v;v?.success&&c++}return c?{...W,modifications:c}:{error:Ov}}function Vj({deleteExisting:t,event:e,flightProfile:i}){let r="attachFlightProfile";if(!i)return q({result:{error:Je},stack:r});if(!e)return q({result:{error:ui},stack:r});let{flightProfile:n}=Bi({event:e});return n&&!t?q({result:{error:vB},stack:r}):e.drawDefinitions?.length?q({result:{error:vte},stack:r}):(Yd({event:e,extension:{name:to,value:i}}),{flightProfile:Oe(i,!1,!0),...W})}function hHe({tournamentRecord:t,scaleAttributes:e,participantIds:i}){if(!t)return{error:ve};if(!i)return{error:Wd};if(!e)return{error:Je,info:"scaleAttributes required"};let{scaleType:r,eventType:n,scaleName:a}=e,s=[Yne,r,n,a].join(".");return t.participants?.forEach(o=>{i.includes(o.participantId)&&o.timeItems&&(o.timeItems=o.timeItems.filter(l=>l&&l?.itemType!==s))}),{...W}}function jj({tournamentRecord:t,scaleAttributes:e,drawDefinition:i,entryStatuses:r,drawId:n,event:a,stage:s}){if(!a)return{error:ui};if(r&&!Array.isArray(r))return q({result:{error:re},info:qp("entryStatus"),stack:"removeScaleValues"});let o=a.entries;if(n){let{flightProfile:u}=Bi({event:a}),c=u?.flights?.find(d=>d.drawId===n);c?o=c.drawEntries:o=i?.entries}let l=(o||[]).filter(u=>(!s||!u.entryStage||u.entryStage===s)&&(!r||r.includes(u.entryStatus))).map(yt);return hHe({tournamentRecord:t,scaleAttributes:e,participantIds:l})}function KN({removePriorValues:t,tournamentRecord:e,displaySettings:i,status:r=Xa,event:n}){if(!e)return q({result:{error:ve}});if(!n)return q({result:{error:ui}});if(!wt(i))return q({result:{error:Je}});if(wt(i.draws))for(let s of Object.keys(i.draws)){let o=i.draws[s].scheduleDetails??[];if(o.length){let l=[];for(let u of o){let c=l.find(d=>$xe(d.attributes,u.attributes));c?.dates&&u.dates?c.dates.push(...u.dates):l.push(u)}i.draws[s].scheduleDetails=l}}let a=iy({statusObject:{displaySettings:i},removePriorValues:t,status:r,event:n});return a.error?a:{...W}}function sue({tournamentRecord:t,drawDefinition:e,entryStatuses:i,scaleName:r,drawId:n,event:a,stage:s}){if(!t)return{error:ve};if(!a)return{error:ui};r=r||a.category?.categoryName||a.category?.ageCategoryCode;let o={eventType:a.eventType,scaleType:Yl,scaleName:r};return jj({tournamentRecord:t,scaleAttributes:o,drawDefinition:e,entryStatuses:i,drawId:n,event:a,stage:s})}function oue(t){let e=He(t,[{[hr]:!0},{eventIds:!0,[qn]:sn}]);if(e.error)return e;let{removePairParticipants:i,tournamentRecord:r,eventIds:n}=t,a=[],s=[],o=[],l=[];if(r.events=(r.events||[]).filter(u=>{if(n.includes(u.eventId)){let p={action:SD,payload:{events:[u]}};a.push(p),s.push({tournamentId:r.tournamentId,eventName:u.eventName,eventType:u.eventType,category:u.category,eventId:u.eventId,gender:u.gender})}let c=u.eventType===fs?(u.entries||[]).map(({entryStatus:p,participantId:f})=>p!==Us&&f).filter(Boolean):[],d=n.includes(u.eventId);return d?l.push(...c):o.push(...c),!d}),i){let u=l.filter(c=>!o.includes(c));r.participants=r.participants.filter(({participantId:c})=>!u.includes(c))}if(eT({tournamentRecord:r}),a.length)if(wM(ec)){let u=r.tournamentId;st({topic:ec,payload:{type:SD,tournamentId:u,detail:a}})}else zU({tournamentRecord:r,timeItem:{itemValue:s,itemType:SD}});return{...W}}function lue(t){let e=He(t,[{tournamentRecord:!0,eventId:!0,event:!0},{eventUpdates:!0,_ofType:Kn}]);if(e.error)return e;let{eventUpdates:i,event:r}=t,n="modifyEvent",a=bHe(t),s=wHe({enteredParticipants:a}),{enteredParticipantGenders:o,enteredParticipantTypes:l}=s,u=Bi({event:r})?.flightProfile?.flights,c=!r.drawDefinitions?.length&&!u?.length,d=SHe({noFlightsNoDraws:c,enteredParticipantGenders:o,eventUpdates:i,stack:n});if(d.error)return d;let p=UHe({enteredParticipantTypes:l,eventUpdates:i,stack:n});if(p.error)return p;let f=gHe({...t,...s,enteredParticipants:a,stack:n});if(f.error)return f;let m=yHe({...t,stack:n});return m.error?m:(i.eventType&&(r.eventType=i.eventType),i.eventName&&(r.eventName=i.eventName),i.gender&&(r.gender=i.gender),{...W})}function gHe(t){let e=t.eventUpdates?.category;if(!e)return{...W};let i=Wb({category:e});if(i.error)return i;if(t.event.eventType===ar){let r=IHe(t);if(r.error)return r}if(t.enteredParticipants?.length){let r=vHe(t,e);if(r.error)return r}return{...W}}function IHe(t){let e=t.event?.drawDefinitions?.map(n=>Vo(n))??[],i=Vo(t.event),r=(xu(t)?.matchUps??[]).map(n=>Vo(n))??[];return[i,...e,...r].filter(Boolean).every(n=>n.collectionDefinitions.every(a=>!a.category||aU({category:t.eventUpdates.category,childCategory:a.category})))?{...W}:q({result:{error:$b},stack:t.stack})}function vHe(t,e){let i=t.eventUpdates.startDate||t.event.startDate||t.tournamentRecord.startDate,r=t.eventUpdates.endDate||t.event.endDate||t.tournamentRecord.endDate,n=t.enteredParticipants.flatMap(o=>o.participantType===It?[o]:o.individualParticpants??[]),a=Bp({category:e,consideredDate:i}),s=Bp({category:e,consideredDate:r});if(a?.ageMinDate||a?.ageMaxDate||s?.ageMinDate||s?.ageMaxDate)for(let o of n){let l=o.person?.birthDate;if(!l)return q({result:{error:zte},stack:t.stack});let u=new Date(l).getTime(),c=Gq(u,a,t.stack);if(c)return c;let d=Gq(u,s,t.stack);if(d)return d}return{...W}}function Gq(t,e,i){if(!e)return null;if(e.ageMinDate||e.ageMaxDate){let r=new Date(e.ageMinDate).getTime(),n=new Date(e.ageMaxDate).getTime();if(t<r||t>n)return q({result:{error:Zte},stack:i})}return null}function yHe(t){let{tournamentRecord:e,eventUpdates:i,event:r,stack:n}=t;if(i.startDate||i.endDate){let a=_j({startDate:i.startDate||r.startDate||e.startDate,endDate:i.endDate||r.endDate||e.endDate,tournamentRecord:e,event:r});if(a.error)return q({result:a,stack:n})}return{...W}}function bHe(t){let{tournamentRecord:e,event:i}=t,r=i?.entries?.filter(({entryStatus:n})=>{let a=n;return[...uo,Gs].includes(a)}).map(({participantId:n})=>n)??[];return r?Ri({participantFilters:{participantIds:r},withIndividualParticipants:!0,tournamentRecord:e}).participants??[]:[]}function wHe({enteredParticipants:t}){let e=[],i=t.reduce((n,a)=>{let s=a.person?.sex?[a.person.sex]:a.individualParticpants?.map(o=>o.person?.sex)||[];return e.push(...s),n.includes(a.participantType)?n:n.concat(a.participantType)},[]),r=nt(e);return{enteredParticipantTypes:i,enteredParticipantGenders:r}}function SHe({noFlightsNoDraws:t,enteredParticipantGenders:e,eventUpdates:i,stack:r}){let n=!e.length||!i.gender||du(i.gender)||e.length===1&&e[0]===i.gender||t&&Aa(i.gender);return i.gender&&!n?q({context:{gender:i.gender,validGender:n},result:{error:zy},stack:r}):{...W}}function UHe({enteredParticipantTypes:t,eventUpdates:e,stack:i}){let r=(t.includes(ar)&&[ar]||t.includes(It)&&[pl]||t.includes(ft)&&[fs]||[fs,pl,ar]).includes(e.eventType??"");return e.eventType&&!r?q({context:{participantType:e.eventType,validEventType:r},result:{error:cu},stack:i}):{...W}}function XN({qualifyingPositions:t,drawEntries:e=[],drawName:i,drawId:r,event:n,stage:a}){let s="addFlight";if(!n)return q({result:{error:ui},stack:s});if(!i)return q({result:{error:Je},stack:s});if(e?.length){let f=(n.entries??[]).map(yt),m=e.map(yt);if(Li(m,f).length!==m.length)return q({result:{error:re},stack:s})}let o=Bi({event:n})?.flightProfile,l=o?.flights?.map(({flightNumber:f})=>!isNaN(f)&&Ke(f))?.filter(Boolean)||[],u=Math.max(0,...l)+1,c={drawId:r||Ct(),flightNumber:u,drawEntries:e,drawName:i};if(a&&(c.stage=a),t&&(c.qualifyingPositions=t),(o?.flights||[]).find(({drawId:f})=>f===c.drawId))return q({result:{error:Eie},stack:s});let d=(o?.flights||[]).concat(c),p={name:to,value:{...o||{},flights:d}};return Yd({event:n,extension:p})}var uue={};dt(uue,{drawMatic:()=>ZV,garman:()=>hue,generateAdHocMatchUps:()=>bN,generateAdHocRounds:()=>QV,generateAndPopulatePlayoffStructures:()=>mV,generateCourts:()=>Gj,generateDrawDefinition:()=>rT,generateDrawMaticRound:()=>CV,generateDrawStructuresAndLinks:()=>PV,generateDrawTypeAndModifyDrawDefinition:()=>EV,generateFlightProfile:()=>PHe,generateLineUps:()=>mue,generateQualifyingStructure:()=>lV,generateSeedingScaleItems:()=>_le,generateStatCrew:()=>EHe,generateVoluntaryConsolation:()=>voe,roundRobinGroups:()=>L_e});var THe="splitLevelBased",cue="splitWaterfall",due="splitShuttle",DHe={SPLIT_LEVEL_BASED:THe,SPLIT_WATERFALL:cue,SPLIT_SHUTTLE:due};function PHe(t){let{drawNameRoot:e="Flight",attachFlightProfile:i,tournamentRecord:r,scaleAttributes:n,scaleSortMethod:a,deleteExisting:s,sortDescending:o,drawNames:l=[],flightsCount:u,splitMethod:c,uuids:d=[],event:p,stage:f}=t;if(!p)return{error:ui};let m=p.entries??[],{flightProfile:h}=Bi({event:p});if(h&&i&&!s)return{error:vB};let g=t.scaledEntries??tg({tournamentRecord:r,scaleAttributes:n,scaleSortMethod:a,sortDescending:o,event:p,stage:f}).scaledEntries,I=new Set(g.map(yt)),v=Cn(m.filter(({participantId:D})=>!I.has(D)).filter(D=>(!f||!D.entryStage||D.entryStage===f)&&(!D.entryStatus||Uf.includes(D.entryStatus)))),w=g.concat(...v),y=w.length,b=Math.ceil(y/u),S=wr(w,b);c===cue?S=nx(w,u):c===due&&(S=nx(w,u,!0));function U(D){return(D||[]).map(({participantId:E,scaleValue:R})=>{let C=m.find(M=>M.participantId===E);return C?.scaleValue&&R&&(C.scaleValue=R),C}).sort((E,R)=>E.scaleValue-R.scaleValue).map((E,R)=>(E.scaleValue&&(E.seedNumber=R+1),E))}let T=Ce(0,u).map(D=>{let E=D+1;return{flightNumber:E,drawId:d?.pop()??Ct(),drawEntries:U(S[D]),drawName:l?.length&&l[D]||`${e} ${E}`}}),P={scaleAttributes:n,splitMethod:c,flights:T};if(i){let D=Vj({flightProfile:P,deleteExisting:s,event:p});return{splitEntries:la()&&S||void 0,...D}}else return{flightProfile:P,...W}}function pue({json:t,tagName:e}){let i=Object.keys(t).filter(a=>Array.isArray(t[a])).map(a=>({key:a,value:t[a].filter(s=>typeof s=="object"&&Object.keys(s).length===1)})),r=Object.keys(t).filter(a=>typeof t[a]=="object"&&!Array.isArray(t[a])).map(a=>({key:a,value:t[a]})),n=Object.keys(t).filter(a=>["string","number"].includes(typeof t[a])).map(a=>({key:a,value:t[a]}));return fue({tagName:e,attributes:n,childArrays:i,childObjects:r})}function fue(t){let{tagName:e,attributes:i=[],childArrays:r=[],childObjects:n}=t,a=`\r
`,s=f=>{let m=Object.keys(f)[0],h=f[m];return{key:m,value:h}},o=r?.map(({key:f,value:m})=>fue({tagName:f,childObjects:m.map(s)})).join(`\r
`),l=n?.map(({key:f,value:m})=>pue({tagName:f,json:m??[]})).join(`\r
`),u=i?.map(({key:f,value:m})=>`${f}="${m}"`).join(" "),c=u?` ${u}`:"";if(e==="childArray")return l;let d=l?.length?`${a}${l}${a}`:"",p=o?.length?`${a}${o}${a}`:"";return`<${e}${c}>${d}${p}</${e}>`}function EHe(t){let e=He(t,[{[hr]:!0}]);if(e.error)return e;let{tournamentRecord:i}=t,{startDate:r,tournamentId:n,tournamentName:a}=i,{participantMap:s,matchUps:o,mappedMatchUps:l}=Ri({withMatchUps:!0,withEvents:!0,tournamentRecord:i}),u=i.participants.filter(w=>w.participantType===_t),c=o?.filter(w=>w.matchUpType===_t)??[],d=c?.reduce((w,y)=>{let b=y?.tieMatchUps??[];return b&&[...w,...b]},[])??[],p=o?.filter(w=>w.matchUpType===zt)??[],f=o?.filter(w=>w.matchUpType===Bt)??[],m=d.length===p.length+f.length,h=c.length===1&&m,g={mappedMatchUps:l,participantMap:s,tournamentName:a,tournamentId:n,tournament:m?"N":"Y",startDate:r},I=[],v=[];if(h){let w=c[0],{json:y,xml:b}=Hq({teamParticipants:u,teamMatchUp:w,...g,doubles:f,singles:p});v.push(y),I.push(b)}else for(let w of c){let y=w?.sides?.map(({participant:T})=>T?.participantId).filter(Boolean);if(y?.length!==2)continue;let b=y.map(T=>T&&s?.[T]?.participant),{xml:S,json:U}=Hq({doubles:w.tieMatchUps?.filter(T=>T.matchUpType===Bt),singles:w.tieMatchUps?.filter(T=>T.matchUpType===zt),teamParticipants:b,teamMatchUp:w,...g});v.push(U),I.push(S)}return{json:v,xml:I,...W}}function Hq({teamParticipants:t,mappedMatchUps:e,participantMap:i,tournamentName:r,tournamentId:n,teamMatchUp:a,tournament:s,startDate:o,doubles:l,singles:u}){let c=t?.find(y=>y.participantRoleResponsibilities?.includes("Home")),d=t?.filter(y=>y.participantId!==c?.participantId),p=Bs(o,"/","MDY"),f=c?.participantName||d?.[1]?.participantName,m=c?.participantId||d?.[1]?.participantId,h=d?.[0]?.participantName,g=d?.[0]?.participantId,I={},v=t.map(y=>({team:{...MHe({teamParticipant:y,teamMatchUp:a,uniValues:I,participantMap:i,mappedMatchUps:e,homeid:m})}})),w=je({venue:{tournamentname:s?r:void 0,neutralgame:c?"N":"Y",gameid:n,officials:{},tournament:s,rules:{},homename:f,visname:h,homeid:m,visid:g,date:p},childArray:v,singles_matches:u?.map(y=>Wq({matchUp:y,homeid:m,uniValues:I})),doubles_matches:l?.map(y=>Wq({matchUp:y,homeid:m,uniValues:I}))});return{json:w,xml:pue({json:w,tagName:"tngame"})}}function RHe({homeid:t,uniValues:e,participant:i}){if(!i)return{};let r=i.individualParticipants?.length===2,n=r?nt(i.individualParticipants?.map(h=>h.teams?.[0]?.participantId)):[],a=r?nt(i.individualParticipants?.map(h=>h.teams?.[0]?.teamId)):[],s=!r&&i.teams?.[0]?.participantId||n?.length===1&&n[0]||void 0,o=!r&&i.teams?.[0]?.teamId||a?.length===1&&a[0]||s,l=r?void 0:i.participantName,u=i.individualParticipants?.[0]?.participantName,c=i.individualParticipants?.[1]?.participantName,d=t&&(s===t?"H":"V")||"",p=r?void 0:e[s][i.participantId],f=e[s][i.individualParticipants?.[0]?.participantId],m=e[s][i.individualParticipants?.[1]?.participantId];return je({vh:d,uni:p,uni_1:f,uni_2:m,team:o,name:l,name_1:u,name_2:c})}function CHe({sets:t,sideNumber:e}){return Object.assign({},...t?.map(i=>{let{setNumber:r,side1Score:n,side2Score:a,side1TiebreakScore:s,side2TiebreakScore:o}=i,l=`set_${r}`,u=`tie_${r}`,c=e===1?n:a,d=e===1?s:o;return{[l]:c,[u]:d}})??[])}function MHe({teamParticipant:t,teamMatchUp:e,participantMap:i,mappedMatchUps:r,homeid:n,uniValues:a}){let{participantId:s,participantName:o}=t,l=n&&(s===n?"H":"V")||"",u=i?.[s]?.matchUps,c=u&&Object.keys(u),d=e?.sides?.find(({participant:y})=>y.participantId===s)?.sideNumber,p=e?.score?.sets?.[0]?.[`side${d}Score`]??0;a[s]={};let f={SINGLES:{w:0,l:0},DOUBLES:{w:0,l:0}},m=[],h=[],g=0;for(let y of c??[]){let b=r?.[y],S=b.sides.find(({participant:T})=>T.participantId===s)?.sideNumber,U=b.score?.sets?.[0]?.[`side${S}Score`]??0;g+=U;for(let T of b.tieMatchUps??[]){let{matchUpType:P,winningSide:D}=T,E=D&&(D===S?"w":"l")||"";E&&(f[P][E]+=1);let R=E==="w"?"1":"0",C=E==="l"?"1":"0";if(P===zt){let M=h.length+1;h.push({singles_pair:{pair:M,won:R,lost:C,tied:"0"}})}else if(P===Bt){let M=m.length+1;m.push({doubles_pair:{pair:M,won:R,lost:C,tied:"0"}})}}}let I=[{singles:{childArray:h,won:f.SINGLES.w,lost:f.SINGLES.l}},{doubles:{childArray:m,won:f.DOUBLES.w,lost:f.DOUBLES.l}}],v=[],w=1;for(let y of t.individualParticipantIds){let b=i?.[y];if(b){let{participant:S,counters:U}=b,T={won:U?.DOUBLES?.wins||0,lost:U?.DOUBLES?.losses||0},P={won:U?.SINGLES?.wins||0,lost:U?.SINGLES?.losses||0},{participantName:D,participantId:E}=S;a[s][E]=w,v.push({player:{name:D,uni:w,singles:P,doubles:T}})}w+=1}return{vh:l,id:s,name:o,score:p||g,totals:I,childArray:v}}function Wq({matchUp:t,homeid:e,uniValues:i}){let{collectionPosition:r,orderOfFinish:n,matchUpType:a,sides:s}=t??{},o=s?.map(l=>{let{sideNumber:u,participant:c}=l,d=CHe({sets:t.score?.sets,sideNumber:u});return{[a===zt?"singles_score":"doubles_score"]:{...RHe({homeid:e,uniValues:i,participant:c}),...d}}});return{[a===zt?"singles_match":"doubles_match"]:{match:r,order:n,childArray:o}}}var NHe="DESC",Jx="DESC",AHe={ASC:"ASC",ASCENDING:"ASC",DESC:NHe,DESCENDING:Jx};function mue(t){let{tieFormat:e}=t,{useDefaultEventRanking:i,tournamentRecord:r,drawDefinition:n,scaleAccessor:a,singlesOnly:s,attach:o,event:l}=t;if(l?.eventType!==Ua)return{error:cu};if(!r)return{error:ve};if(!e&&!n)return{error:_a};if(e=e??yn({drawDefinition:n,event:l})?.tieFormat,Gn({tieFormat:e}).error)return{error:ql};if(typeof a!="object"&&!i)return{error:re,context:{scaleAccessor:a}};let u={},c=(n?.entries??l?.entries??[]).filter(E=>E?.entryStatus===ca).map(yt),{participants:d=[]}=Ri({withIndividualParticipants:!0,withScaleValues:!0,tournamentRecord:r}),p=d.filter(({participantId:E})=>c.includes(E)),f=E=>E===vu?"rankings":"ratings",m=l?.category?.categoryName??l?.category?.ageCategoryCode,{scaleName:h=m,scaleType:g=vu,sortOrder:I,accessor:v}=a||{},w=f(g),y=(E,R)=>{let C=E[w]?.[R];if(!C&&i&&(C=E[w]?.[pm]),Array.isArray(C)){let M=C.find(N=>N.scaleName===h)?.scaleValue;if(Ai(M))return M;if(v&&typeof M=="object")return M[v]}return 0},b=(E,R,C)=>{let M=I===Jx?R:E,N=I===Jx?E:R;return y(M,C)-y(N,C)},S=(E,R)=>b(E,R,pm),U=(E,R)=>b(E,R,_p),T=[],P=e?.collectionDefinitions??[];for(let E of p){let R=E.individualParticipants?.sort(S)??[],C=s?R:E.individualParticipants?.sort(U)??[],M={};for(let A of P){let O=[],{collectionId:k,matchUpCount:F,matchUpType:x,gender:L}=A,$=Pi(pm)(x);Ce(0,F).forEach(V=>{let _=$?R:C??[],B=V+1,G=[];Ce(0,$?1:2).forEach(j=>{let K=_?.find(Y=>{let X=ln(L),Z=X&&(cl(L)&&X||Aa(L)&&[tr,zr][j]);return(!Z||Z===Y.person?.sex)&&!O.includes(Y.participantId)})?.participantId;K&&(G.push(K),O.push(K),M[K]||(M[K]=[]),M[K].push({collectionPosition:B,collectionId:k}))}),$||T.push(G)})}let N=Object.keys(M).map(A=>({collectionAssignments:M[A],participantId:A}));u[E.participantId]=N}let D=[];for(let E of T){let{participant:R}=ro({tournamentParticipants:d,participantIds:E});if(!R){let C={individualParticipantIds:E,participantRole:Jr,participantType:ft};D.push(C)}}if(o){for(;D.length;)Il({participant:D.pop(),tournamentRecord:r});Ft({element:n,extension:{name:Uc,value:u}})}return{...W,lineUps:u,participantsToAdd:D}}function Gj(t){if(!t)return{error:Je};let e=He(t,[{dates:!1,[qr]:s=>Array.isArray(s)&&s.every(Mn)},{uuids:!1,[qr]:s=>Array.isArray(s)&&s.every(ni)},{startTime:!1,endTime:!1,[qr]:RB},{idPrefix:!1,namePrefix:!1,[qr]:ni},{count:!0,[qr]:Ai}]);if(e.error)return e;let{startDate:i,endDate:r}=t.tournamentRecord??{},n=t.dates||i&&r&&UI(i,r)||[],a=Ce(1,t.count+1).map(s=>je({courtId:t.uuids?.pop()??(t.idPrefix&&`${t.idPrefix}-${s}`)??Ct(),courtName:t.courtNames?.pop()??(t.namePrefix&&`${t.namePrefix} ${s}`),dateAvailability:n.map(o=>({startTime:t.startTime??"08:00",endTime:t.endTime??"20:00",date:o}))}));return{...W,courts:a}}var hue={};dt(hue,{default:()=>xHe,garman:()=>vue});function ny(t){let e=He(t,[{courtDate:!0,_ofType:Kn}]);if(e.error)return e;let{includeBookingTypes:i=[],courtDate:r}=t,n=[],a=Ji(r.startTime);(r.bookings||[]).filter(o=>!o.bookingType||!i.includes(o.bookingType)).sort((o,l)=>(LP(o.startTime)||"").localeCompare(LP(l.startTime)||"")).forEach(o=>{let l={startTime:pi(a.toISOString()),endTime:o.startTime};Ji(o.startTime)>a&&n.push(l),Ji(o.endTime)>a&&(a=Ji(o.endTime))});let s={startTime:pi(a.toISOString()),endTime:r.endTime};return Ji(r.endTime)>a&&n.push(s),{timeSlots:n}}function kHe({averageMatchUpMinutes:t,includeBookingTypes:e,periodStartTime:i,periodEndTime:r}){let n=s=>{let{timeSlots:o}=ny({includeBookingTypes:e,courtDate:s});return!!o?.filter(a)?.length};function a(s){let o=Ji(s.startTime),l=Ji(s.endTime);return o>i||l<r?!1:nU(i,l)>=t}return{enoughTime:n}}function gue(t){let e=He(t,[{periodStart:!0,date:!0},{courts:!0,_ofType:sn}]);if(e.error)return e;let{averageMatchUpMinutes:i,includeBookingTypes:r,periodStart:n,date:a}=t,s=t.courts,o=Ji(n),l=MB(o,i),{enoughTime:u}=kHe({averageMatchUpMinutes:i,includeBookingTypes:r,periodStartTime:o,periodEndTime:l});return{availableToScheduleCount:(s?.filter(c=>{if(!Array.isArray(c.dateAvailability))return!1;let d=Md({date:a,court:c});return!!(d&&u(d))})||[]).length,...W}}function JN(t){let{remainingScheduleTimes:e=[],clearScheduleDates:i,periodLength:r=30,scheduleDate:n,courts:a=[]}=t,{bookings:s=[]}=t;if(!Array.isArray(a)||!a.length)return{error:re,courts:a};if(!Array.isArray(s))return{error:kP};if(!Mn(n))return{error:or};i&&(Array.isArray(i)?i.includes(n)&&(s=[]):s=[]);let{courtBookings:o,unassignedBookings:l}=s.reduce((p,f)=>{let{courtId:m}=f;return m?p.courtBookings[m]?p.courtBookings[m].push(f):p.courtBookings[m]=[f]:p.unassignedBookings.push(f),p},{courtBookings:{},unassignedBookings:[]}),u=a.map((p,f)=>{let{courtId:m,courtName:h}=p,g=o[m]||[],I=Md({date:n,court:p})||{},{bookings:v=[],startTime:w,endTime:y,date:b}=I,S=[e[f]&&{startTime:w,endTime:e[f]},...Oe(v,!1,!0),...g].filter(Boolean);return{courtId:m,courtName:h,dateAvailability:{bookings:S,startTime:w,endTime:y,date:b}}});l.sort((p,f)=>Rt(p.startTime)-Rt(f.startTime));let c=()=>u.flatMap(p=>{let f=p.dateAvailability,{timeSlots:m=[]}=ny({courtDate:f});return{courtName:p.courtName,courtId:p.courtId,timeSlots:m}}),d=[];for(let p of l){let{startTime:f,endTime:m,averageMinutes:h,recoveryMinutes:g,matchUpId:I}=p,v=Rt(f),w=Rt(m),y=c().reduce((b,{courtId:S,courtName:U,timeSlots:T})=>{let P;return T.find(({startTime:D,endTime:E})=>{P=Rt(D)-v;let R=v>=Rt(D);return w<=Rt(E)&&b.startDifference!==0&&((P===0||P+r>=0)&&(b.startDifference===void 0||P<b.startDifference)||R)})?{courtName:U,courtId:S,startDifference:P}:b},{});if(y.courtId){let b={averageMinutes:h,recoveryMinutes:g,matchUpId:I,startTime:f,endTime:m};d.push(b),u.find(({courtId:S})=>S===y.courtId)?.dateAvailability.bookings.push(b)}else console.log({unassignedBooking:p})}return{virtualCourts:u.map(({courtId:p,courtName:f,dateAvailability:m})=>({dateAvailability:[m],courtName:f,courtId:p})),assignedBookings:d}}function QN({averageMatchUpMinutes:t,periodLength:e=30,recoveryMinutes:i}){let r=(t||90)+(i||0);return e>r?r:e||30}function Iue(t){let{startTime:e="8:00",endTime:i="20:30",count:r=10,date:n}=t??{};return Ce(0,r).map(()=>({dateAvailability:[{date:n,startTime:e,endTime:i}]}))}function LI({scheduleDate:t,startTime:e,endTime:i,courts:r}){let n=e&&"startTime"||i&&"endTime"||void 0;return r.reduce((a,s)=>{let o=Md({date:t,court:s}),l=n&&(o?.[n]||s[n]);return l&&(!a||e&&Rt(l)<Rt(a)||i&&Rt(l)>Rt(a))?l:a},void 0)}function OHe({averageMinutes:t,startTime:e,endTime:i,courts:r,date:n}){e=e||LI({courts:r,scheduleDate:n,startTime:!0}),i=i||LI({courts:r,scheduleDate:n,endTime:!0});let a;if(e&&i){let s=Ji(e),o=Ji(i);for(let l of r||[]){if(!Array.isArray(l.dateAvailability))continue;let u=Md({court:l,date:n}),{timeSlots:c}=ny({courtDate:u});c?.forEach(d=>{let p=Ji(d.startTime),f=Ji(d.endTime);if(p>o||p<s||f<s)return!1;if(nU(p,f)>=t){let m=pi(p.toISOString());m&&(!a||m<a)&&(a=m)}})}}return{firstTimeSlotStartTime:a}}function Hj(t){let e=He(t,[{courts:!0,_ofType:sn}]);if(e.error)return e;let{date:i=EB(),startTime:r="08:00",endTime:n="19:00",periodLength:a,courts:s}=t,{calculateStartTimeFromCourts:o=!0,remainingScheduleTimes:l,averageMatchUpMinutes:u,clearScheduleDates:c,courtsCount:d,bookings:p}=t;a=a||QN({averageMatchUpMinutes:u}),i=Ze(i),r=pi(r),n=pi(n);let f=0,m=0,h=0,g=0,I=0;!s&&d&&(s=Iue({startTime:r,endTime:n,count:d,date:i}));let{virtualCourts:v}=JN({remainingScheduleTimes:l,clearScheduleDates:c,scheduleDate:i,periodLength:a,bookings:p,courts:s}),{firstTimeSlotStartTime:w}=OHe({averageMinutes:u,courts:v,startTime:r,endTime:n,date:i});o&&w&&(r=w??r);let y=Rt(r),b=Rt(n)-y,S=Math.floor(b/a),U=Ce(0,S+1).map(T=>{let P=y+T*a,D=uFe(P),E=gue({courts:v??[],averageMatchUpMinutes:u,periodStart:D,date:i});if(E.error)return{error:E.error};let{availableToScheduleCount:R=0}=E,C=R>m?R-m:0;I+=T?R:0;let M=T?I/T:R,N=a*M/u,A=T?N*(T-1)+M:M,O=R?m&&A-f||C:0;f=A,m=R,h+=O;let k=Ke(h)-g;return g+=k,{periodStart:D,add:k,availableToScheduleCount:R,newCourts:C,totalMatchUps:g}});return{scheduleTimes:U.reduce((T,P)=>{let D=Ce(0,P.add).map(()=>({scheduleTime:P.periodStart}));return T.concat(...D)},[]).flat(),timingProfile:U,totalMatchUps:g}}var vue={getCourtsAvailableAtPeriodStart:gue,generateTimeSlots:ny,getScheduleTimes:Hj,courtGenerator:Iue},xHe=vue,yue={};dt(yue,{isAggregateFormat:()=>MN,isValid:()=>$a,isValidMatchUpFormat:()=>$a,parse:()=>qi,stringify:()=>DM});var bue={};dt(bue,{allCompetitionMatchUps:()=>No,allDrawMatchUps:()=>An,allEventMatchUps:()=>xu,allTournamentMatchUps:()=>Ur,analyzeMatchUp:()=>uw,applyLineUps:()=>Gue,assignMatchUpSideParticipant:()=>Sue,assignTieMatchUpParticipantId:()=>lE,bulkMatchUpStatusUpdate:()=>$ue,calculateWinCriteria:()=>ig,checkInParticipant:()=>zj,checkMatchUpIsComplete:()=>yp,checkOutParticipant:()=>Wj,competitionScheduleMatchUps:()=>iT,disableTieAutoCalc:()=>Fue,drawMatchUps:()=>Rj,enableTieAutoCalc:()=>kue,eventMatchUps:()=>HN,filterMatchUps:()=>Yu,findMatchUp:()=>fj,getAllDrawMatchUps:()=>Zi,getAllStructureMatchUps:()=>At,getCheckedInParticipantIds:()=>Wh,getCompetitionMatchUps:()=>lw,getEventMatchUpFormatTiming:()=>yj,getHomeParticipantId:()=>Uj,getMatchUpCompetitiveProfile:()=>EU,getMatchUpContextIds:()=>Tj,getMatchUpDailyLimits:()=>zN,getMatchUpDailyLimitsUpdate:()=>bj,getMatchUpDependencies:()=>co,getMatchUpFormat:()=>Dj,getMatchUpFormatTiming:()=>RU,getMatchUpFormatTimingUpdate:()=>vj,getMatchUpScheduleDetails:()=>eN,getMatchUpType:()=>tN,getMatchUpsStats:()=>Pj,getModifiedMatchUpFormatTiming:()=>GN,getParticipantResults:()=>kU,getPredictiveAccuracy:()=>Sj,getRoundMatchUps:()=>Sn,getRounds:()=>Ej,isValidMatchUpFormat:()=>$a,matchUpActions:()=>vN,mutate:()=>wue,participantScheduledMatchUps:()=>wj,query:()=>Mle,removeDelegatedOutcome:()=>Oue,removeMatchUpSideParticipant:()=>Kj,removeTieMatchUpParticipantId:()=>Tue,replaceTieMatchUpParticipantId:()=>Yj,resetAdHocMatchUps:()=>Vue,resetMatchUpLineUps:()=>iG,resetScorecard:()=>nG,resetTieFormat:()=>rG,setDelegatedOutcome:()=>Bue,setMatchUpFormat:()=>Lue,setMatchUpState:()=>Rf,setMatchUpStatus:()=>aT,setOrderOfFinish:()=>jue,substituteParticipant:()=>xue,tallyParticipantResults:()=>qh,toggleParticipantCheckInState:()=>ZN,tournamentMatchUps:()=>WN,updateTieMatchUpScore:()=>Wc,validMatchUp:()=>YM,validMatchUps:()=>Ka});var wue={};dt(wue,{applyLineUps:()=>Gue,assignMatchUpSideParticipant:()=>Sue,assignTieMatchUpParticipantId:()=>lE,bulkMatchUpStatusUpdate:()=>$ue,checkInParticipant:()=>zj,checkOutParticipant:()=>Wj,disableTieAutoCalc:()=>Fue,enableTieAutoCalc:()=>kue,findMatchUp:()=>fj,removeDelegatedOutcome:()=>Oue,removeMatchUpSideParticipant:()=>Kj,removeTieMatchUpParticipantId:()=>Tue,replaceTieMatchUpParticipantId:()=>Yj,resetAdHocMatchUps:()=>Vue,resetMatchUpLineUps:()=>iG,resetScorecard:()=>nG,resetTieFormat:()=>rG,setDelegatedOutcome:()=>Bue,setMatchUpFormat:()=>Lue,setMatchUpState:()=>Rf,setMatchUpStatus:()=>aT,setOrderOfFinish:()=>jue,substituteParticipant:()=>xue,toggleParticipantCheckInState:()=>ZN,updateTieMatchUpScore:()=>Wc});function Sue({tournamentRecord:t,drawDefinition:e,participantId:i,sideNumber:r,matchUpId:n,event:a}){if(i&&typeof i!="string")return{error:Co};if(!e)return{error:$e};if(!n)return{error:Tn};let s=r===void 0;if(s&&(r=1),![1,2].includes(r))return q({result:{error:re,context:{sideNumber:r}}});let{matchUp:o,structure:l}=fi({drawDefinition:e,matchUpId:n,event:a});if(!o)return{error:dn};if(!(!l?.structures&&!(e.drawType&&e.drawType!==ua)&&!l?.matchUps?.find(({roundPosition:u})=>!!u)))return{error:Q$};if(!i&&(o?.score?.scoreStringSide1||Ki.includes(o?.matchUpstatus)||o?.matchUpStatus&&[Si,Wi].includes(o.matchUpStatus)))return{error:fM,info:"matchUp has completed status or score"};if(o){if(o.sides=[1,2].map(u=>{let c=o.sides?.find(d=>d.sideNumber===u)??{sideNumber:u};return r===u?{...c,participantId:i}:c}),s)for(let u of o.sides)u.sideNumber&&(u.sideNumber=3-u.sideNumber);Ut({tournamentId:t?.tournamentId,context:"assignSideParticipant",drawDefinition:e,matchUp:o})}return{...W,sidesSwapped:s}}function Ea({removePriorValues:t,tournamentRecord:e,duplicateValues:i,drawDefinition:r,disableNotice:n,matchUpId:a,timeItem:s,event:o}){let{matchUp:l}=fi({drawDefinition:r,event:o,matchUpId:a});if(!l)return{error:dn};let u=Cl({removePriorValues:t,element:l,duplicateValues:i,timeItem:s});return n||Ut({tournamentId:e?.tournamentId,eventId:o?.eventId,context:"addTimeItem",drawDefinition:r,matchUp:l}),u}function Wj(t){let e=[{[hr]:!0},{[In]:!0},{[Iu]:!0},{[Pl]:!0}],i=He(t,e);if(i.error)return i;let r=ey(t,[{[Lv]:Au,attr:{[kM]:!0}}]);if(r.error)return r;let{tournamentRecord:n,drawDefinition:a,participantId:s,matchUpId:o}=t,l=r?.matchUp?.matchUp,{matchUpStatus:u,score:c}=l??{};if(u&&ZB.includes(u)||u&&Ki.includes(u)||fr({score:c}))return{error:Ete};let d=Wh({matchUp:l});if(d?.error)return d;let{checkedInParticipantIds:p,allRelevantParticipantIds:f}=d??{};if(!f?.includes(s))return{error:Co};if(!p?.includes(s))return{error:sie};let m=jne({matchUp:l});if(m?.error)return m;let{sideParticipantIds:h,nestedIndividualParticipantIds:g}=m??{},I=h?.indexOf(s);return I!==void 0&&[0,1].includes(I)&&(g?.[I]??[]).forEach(v=>{Ea({drawDefinition:a,matchUpId:o,timeItem:{itemType:qP,itemValue:v}})}),Ea({tournamentRecord:n,drawDefinition:a,matchUpId:o,timeItem:{itemValue:s,itemType:qP}}),{...W,checkedOut:!0}}function zj(t){let e=[{[hr]:!0},{[In]:!0},{[Iu]:!0},{[Pl]:!0}],i=He(t,e);if(i[js])return i;let r=ey(t,[{[Lv]:Au,attr:{[kM]:!0}}]);if(r[js])return r;let{tournamentRecord:n,drawDefinition:a,participantId:s,matchUpId:o}=t,l=Wh({matchUp:r?.matchUp?.matchUp});if(l?.error)return l;let{checkedInParticipantIds:u,allRelevantParticipantIds:c}=l??{};if(!c?.includes(s))return{[js]:Co};let d={...W,checkedIn:!0};return u?.includes(s)||Ea({tournamentRecord:n,drawDefinition:a,matchUpId:o,timeItem:{itemValue:s,itemType:zP}}),d}function ZN(t){let e=He(t,[{[Iu]:!0,[In]:!0,[Pl]:!0}]);if(e.error)return e;let i=t.tournamentId??t.activeTournamentId,r=t.tournamentRecord??(i&&t.tournamentRecords?.[i]);if(!r)return{error:ve};let n=ey(t,[{[Lv]:Au,attr:{[kM]:!0},[js]:dn}]).matchUp?.matchUp;if(!n)return{error:dn};let{checkedInParticipantIds:a=[]}=Wh({matchUp:n}),{participantId:s,matchUpId:o,drawDefinition:l}=t;return s&&a.includes(s)?Wj({tournamentRecord:r,drawDefinition:l,participantId:s,matchUpId:o,matchUp:n}):zj({tournamentRecord:r,drawDefinition:l,participantId:s,matchUpId:o,matchUp:n})}function qj({tournamentRecord:t,drawDefinition:e,tieMatchUpId:i,event:r}){if(!t)return{error:ve};if(!e)return{error:xo};if(!r)return{error:ps};let n=Or({drawDefinition:e}),{matchUp:a}=fi({matchUpId:i,drawDefinition:e,matchUpsMap:n});if(!a)return{error:dn};let{matchUp:s,structure:o}=fi({tournamentParticipants:t.participants,matchUpId:i,inContext:!0,drawDefinition:e,matchUpsMap:n,event:r});if(!s)return{error:dn};let{collectionPosition:l,drawPositions:u,collectionId:c,matchUpTieId:d,matchUpType:p}=s;if(p&&!fm([zt,Bt],p))return{error:oa};let{positionAssignments:f}=Kt({structure:o}),m=f?.filter(S=>u?.includes(S.drawPosition)),{matchUp:h}=fi({matchUpId:d,drawDefinition:e,matchUpsMap:n}),g=h?.sides?.map(yt)??[],I=m?.map(yt)??[],v=[...g,...I],{participants:w}=Ri({tournamentRecord:t,participantFilters:{participantTypes:[_t],participantIds:v}}),{matchUp:y}=fi({matchUpId:d,inContext:!0,drawDefinition:e,matchUpsMap:n}),b=yn({matchUp:h,drawDefinition:e,structure:o,event:r})?.tieFormat;return{inContextDualMatchUp:y,inContextTieMatchUp:s,relevantAssignments:m,collectionPosition:l,teamParticipants:w,collectionId:c,matchUpType:p,dualMatchUp:h,tieMatchUp:a,tieFormat:b,structure:o,...W}}function Yj(t){let e=qj(t);if(e.error)return e;let i="replaceTieMatchUpParticipantid",{existingParticipantId:r,tournamentRecord:n,newParticipantId:a,drawDefinition:s,substitution:o,event:l}=t;if(!r||!a)return q({result:{error:dr},stack:i});if(r===a)return{...W};let{inContextDualMatchUp:u,inContextTieMatchUp:c,collectionPosition:d,collectionId:p,dualMatchUp:f,tieMatchUp:m,tieFormat:h}=e,g=c?.matchUpType,I=c?.sides?.find(k=>k.participant?.participantId===r||k.participant?.individualParticipantIds?.includes(r));if(!I)return{error:ji};let v=Ri({tournamentRecord:n,participantFilters:{participantIds:[r,a]}})?.participants??[];if(v.length!==2)return q({result:{error:dr},stack:i});if(v[0].participantType!==v[1].participantType)return q({result:{error:Mo},stack:i});let{appliedPolicies:w}=Dt({tournamentRecord:n,drawDefinition:s,event:l}),y=t.policyDefinitions?.[Mr]??w?.[Mr]??qv[Mr],b=v.find(({participantId:k})=>k===a);if((t.enforceGender??y?.participants?.enforceGender)!==!1&&cl(c?.gender)&&ln(c?.gender)!==ln(b?.person?.sex))return{error:$p,info:"Gender mismatch"};let S=y?.processCodes?.substitution;WU({tournamentId:n.tournamentId,eventId:l.eventId,inContextDualMatchUp:u,drawDefinition:s,dualMatchUp:f});let U=f?.sides?.find(({sideNumber:k})=>k===I.sideNumber);if(!U)return q({result:{sideNumber:I.sideNumber,existingParticipantId:r,error:Br},stack:i});if(c?.sides?.flatMap(k=>k.participant?.individualParticipantIds||k.participant?.participantId||[])?.includes(a))return q({result:{error:hM},stack:i});let T=u?.sides?.find(({sideNumber:k})=>k===I.sideNumber)?.participantId,P=U.lineUp,D=P?.find(({participantId:k})=>a===k),E=P?.reduce((k,F)=>F.substitutionOrder>k?F.substitutionOrder:k,0),R=P?.map(k=>{let F=Oe(k,!1,!0);if(![r,a].includes(F.participantId))return F;if(!o&&[r,a].includes(F.participantId)&&(F.collectionAssignments=F.collectionAssignments?.filter(x=>!(x.collectionPosition===d&&x.collectionId===p))),o&&r===F.participantId&&(F.collectionAssignments=F.collectionAssignments.map(x=>x.collectionPosition===d&&x.collectionId===p&&x.substitutionOrder===void 0?{...x,substitutionOrder:E}:x)),F.participantId===a){F.collectionAssignments||(F.collectionAssignments=[]);let x={collectionId:p,collectionPosition:d};o&&(x.previousParticipantId=r,x.substitutionOrder=(E??0)+1),F.collectionAssignments.push(x)}return F})??[];if(!D){let k={collectionId:p,collectionPosition:d};o&&(k.substitutionOrder=(E??0)+1,k.previousParticipantId=r);let F={collectionAssignments:[k],participantId:a};R.push(F)}let C=g===Bt,{assignedParticipantIds:M}=XP({lineUp:P,collectionPosition:d,collectionId:p}),{assignedParticipantIds:N}=XP({lineUp:R,collectionPosition:d,collectionId:p});if(U.lineUp=R,T&&h){let k=Jh({participantId:T,lineUp:R,drawDefinition:s,tieFormat:h});if(k.error)return q({result:k,stack:i})}else console.log("team participantId not found");let A,O;if(C){let{tournamentRecord:k}=t,F=ro({participantIds:N,tournamentRecord:k});if(!F.participant){let L=Il({returnParticipant:!0,pairOverride:!0,tournamentRecord:k,participant:{participantRole:Jr,individualParticipantIds:N,participantType:ft}});if(L.error)return q({result:L,stack:i});A=L.participant?.participantId}F=ro({participantIds:M,tournamentRecord:k});let x=F.participant?.participantId;x&&Kh({participantIds:[x],tournamentRecord:k}).success&&(O=x)}if(o||I.substitutions?.length===1){if(o)S&&m&&(m.processCodes=nt([...m?.processCodes??[],...S]));else for(let k of S||[]){let F=m?.processCodes?.lastIndexOf(k);F!==void 0&&m?.processCodes?.splice(F,1)}m&&Ut({tournamentId:n?.tournamentId,matchUp:m,context:i,drawDefinition:s})}return f&&Ut({tournamentId:n?.tournamentId,matchUp:f,context:i,drawDefinition:s}),{...W,modifiedLineUp:R,participantRemoved:O,participantAdded:A}}function Uue({collectionPosition:t,teamParticipantId:e,dualMatchUpSide:i,drawDefinition:r,participantIds:n,collectionId:a}){if(!a||!t||!Array.isArray(n))return{modifiedLineUp:i?.lineUp||[],error:re};let s=i?.lineUp||Wp({participantId:e,drawDefinition:r})?.lineUp,o=[],l=[];return{modifiedLineUp:s?.map(u=>{if(!n.includes(u.participantId))return u;let c=u.collectionAssignments?.filter(d=>{let p=d.collectionId===a&&d.collectionPosition===t;return p&&(d.previousParticipantId&&o.push(d.previousParticipantId),l.push({participantId:u.participantId,...d})),!p});return{participantId:u.participantId,collectionAssignments:c}}).filter(Boolean)||[],assignmentsRemoved:l,previousParticipantIds:o}}function FHe({individualParticipantIds:t,groupingParticipantId:e,tournamentRecord:i}){let r=(i.events||[]).filter(a=>a?.eventType===ar&&a?.entries?.some(s=>s.participantId===e)),n=a=>!t.includes(a.participantId);for(let a of r){a.entries=(a.entries||[]).filter(n);let{flightProfile:s}=Bi({event:a});s?.flights?.forEach(o=>{o.drawEntries=(o.drawEntries||[]).filter(n)}),a?.drawDefinitions?.forEach(o=>{o.entries=(o.entries||[]).filter(n)})}return{...W}}function eA({individualParticipantIds:t,groupingParticipantId:e,removeFromOtherTeams:i,tournamentRecord:r}){let n="addIndividualParticipantIds";if(!r)return q({result:{error:ve},stack:n});if(!e||!t)return q({result:{error:Je},stack:n});let a=r.participants??[],s=a.find(d=>d.participantId===e);if(!s)return q({result:{error:ji},stack:n});if(s?.participantType&&![_t,Ya].includes(s.participantType))return q({context:{participantType:s.participantType},result:{error:Mo},stack:n});let o=t.filter(d=>a.find(p=>p.participantId===d)?.participantType!==It);if(o.length)return q({result:{error:Ia,invalidParticipantIds:o},stack:n});s.individualParticipantIds||(s.individualParticipantIds=[]);let l=s.individualParticipantIds,u=t.filter(d=>!l.includes(d));u.length&&(i&&nN({individualParticipantIds:u,tournamentRecord:r}),s.individualParticipantIds=s.individualParticipantIds.concat(...u));let{topics:c}=bs();if(c.includes(rn)){let d=a.find(({participantId:p})=>p===e);st({topic:rn,payload:{participants:[d]}})}return FHe({individualParticipantIds:t,groupingParticipantId:e,tournamentRecord:r}),{groupingParticipant:Oe(s,!1,!0),added:u.length,...W}}function tA(t){let{updateParticipantName:e=!0,groupingParticipantId:i,removeFromOtherTeams:r,tournamentRecord:n,pairOverride:a,participant:s}=t;if(!n)return{error:ve};if(!s)return{error:kh};if(!s.participantId)return Il({tournamentRecord:n,participant:s});let{participant:o}=Xd({participantId:s.participantId,tournamentRecord:n});if(!o)return Il({tournamentRecord:n,participant:s});let{participantRoleResponsibilties:l,individualParticipantIds:u,participantOtherName:c,participantName:d,participantRole:p,participantType:f,onlineResources:m,contacts:h,person:g}=s;if(f&&o.participantType!==f)return{error:Qte};let I={};if(h&&(I.contacts=h),m&&(I.onlineResources=m),c&&ni(c)&&(I.participantOtherName=c),d&&ni(d)&&(I.participantName=d),Array.isArray(u)){let{participants:v}=Ri({participantFilters:{participantTypes:[It]},tournamentRecord:n}),w=v?.map(yt);if(w){let y=u.filter(b=>ni(b)&&w.includes(b));([Ya,ei].includes(f||o.participantType)||f===ft&&(y.length===2||a))&&(I.individualParticipantIds=y),o.participantType===Yy.PAIR&&e&&(I.participantName=LHe({individualParticipants:v,newValues:I}))}}return Object.keys(B2).includes(p)&&(I.participantRole=p),Object.keys(Yy).includes(f)&&(I.participantType=f),Array.isArray(l)&&(I.participantRoleResponsibilties=l),o.participantType===Yy.INDIVIDUAL&&g&&_He({updateParticipantName:e,existingParticipant:o,newValues:I,person:g}),Object.assign(o,je(I)),i&&eA({individualParticipantIds:[o.participantId],groupingParticipantId:i,removeFromOtherTeams:r,tournamentRecord:n}),st({topic:rn,payload:{tournamentId:n.tournamentId,participants:[o]}}),{participant:Oe(o),...W}}function LHe({individualParticipants:t,newValues:e}){let i=e.individualParticipantIds,r=t.filter(({participantId:n})=>i.includes(n)).map(({person:n})=>n?.standardFamilyName).filter(Boolean).sort().join("/");return i.length===1&&(r+="/Unknown"),r}function _He({updateParticipantName:t,existingParticipant:e,newValues:i,person:r}){let n={},{standardFamilyName:a,standardGivenName:s,nationalityCode:o,personId:l,birthdate:u,tennisId:c,sex:d}=r;d&&Object.keys(DB).includes(d)&&(n.sex=d);let p;if(ni(l)&&(n.personId=l),o&&ni(o)&&($He(o)||o==="")&&(n.nationalityCode=o),a&&typeof ni(a)&&a.length>1&&(n.standardFamilyName=a,p=!0),s&&typeof ni(s)&&s.length>1&&(n.standardGivenName=s,p=!0),p&&t){let f=`${n.standardGivenName} ${n.standardFamilyName}`;i.participantName=f}u&&Mn(u)&&(n.birthdate=u),c&&ni(c)&&(n.tennisId=c),Object.assign(e.person,n)}function $He(t){return cd.flatMap(({iso:e,ioc:i})=>[e,i]).filter(Boolean).includes(t)}function lE(t){let e=qj(t);if(e.error)return e;let i="assignTieMatchUpParticipantId",r=t.teamParticipantId,{tournamentRecord:n,drawDefinition:a,participantId:s,event:o}=t;if(!s)return q({result:{error:dr},stack:i});if(t.sideNumber&&![1,2].includes(t.sideNumber))return q({result:{error:Wte},stack:i});let{inContextDualMatchUp:l,inContextTieMatchUp:u,relevantAssignments:c,collectionPosition:d,teamParticipants:p,collectionId:f,matchUpType:m,dualMatchUp:h,tieFormat:g}=e;if(u?.sides?.flatMap(x=>x.participant?.individualParticipantIds||x.participant?.participantId||[])?.includes(s))return q({result:{...W},stack:i});r=r??(t.sideNumber?l?.sides?.find(x=>x.sideNumber===t.sideNumber)?.participantId:void 0);let I=Ri({participantFilters:{participantIds:[s]},tournamentRecord:n})?.participants?.[0];if(!I)return q({result:{error:ji},stack:i});let{appliedPolicies:v}=Dt({tournamentRecord:n,drawDefinition:a,event:o}),w=t.policyDefinitions?.[Mr]??v?.[Mr]??qv[Mr];if((t.enforceGender??w?.participants?.enforceGender)!==!1&&cl(u?.gender)&&ln(u?.gender)!==ln(I.person?.sex))return{error:$p,info:"Gender mismatch"};let{individualParticipantIds:y,participantType:b}=I;if(Pi(zt)(m)&&b!==It)return{error:Mo};let S=b===It?[s]:y,U=r&&p?.find(({participantId:x})=>x===r)||p?.find(({individualParticipantIds:x})=>xn(S,x));if(!U)return{error:hB};if(r||(r=U.participantId),!r)return{error:ji};let T=c?.find(x=>x.participantId===U?.participantId)?.drawPosition,P=h?.sides?.find(x=>x.participantId===r)?.sideNumber,D=u?.sides?.find(x=>T&&x.drawPosition===T)?.sideNumber,E=P??D??t.sideNumber;if(!g)return{error:Av};if(!g.collectionDefinitions?.find(x=>x.collectionId===f))return{error:jte};WU({tournamentId:n.tournamentId,eventId:o.eventId,inContextDualMatchUp:l,drawDefinition:a,dualMatchUp:h});let R=h?.sides?.find(x=>x.sideNumber===E),C=u?.sides?.find(x=>x.sideNumber===E),M=(R?.lineUp??Wp({participantId:r,drawDefinition:a})?.lineUp)?.filter(x=>x.collectionAssignments?.find(L=>L.collectionPosition===d&&L.collectionId===f&&!L.previousParticipantId))?.map(x=>x?.participantId),N=M?.length>1&&M||(b===ft?I.individualParticipantIds:[s]),A=Uue({collectionPosition:d,teamParticipantId:r,dualMatchUpSide:R,drawDefinition:a,participantIds:N,collectionId:f});if(A.error)return q({result:A,stack:i});let{modifiedLineUp:O}=A,k;if(m===Bt){if(b!==ft){let x=yk({collectionPosition:d,teamParticipantId:r,drawDefinition:a,modifiedLineUp:O,participantId:s,collectionId:f,tieFormat:g});if(x?.error)return q({result:x,stack:i});if(x=F({side:C}),x.error)return x;k=x.deletedParticipantId,R&&(R.lineUp=O),h&&Ut({tournamentId:n?.tournamentId,matchUp:h,context:i,drawDefinition:a})}else if(b===ft)for(let x of N)yk({collectionPosition:d,teamParticipantId:r,drawDefinition:a,modifiedLineUp:O,participantId:x,collectionId:f,tieFormat:g})}else{let x=yk({collectionPosition:d,teamParticipantId:r,drawDefinition:a,modifiedLineUp:O,participantId:s,collectionId:f,tieFormat:g});if(x?.error)return x}if(R&&(R.lineUp=O),h&&Ut({tournamentId:n?.tournamentId,matchUp:h,context:i,drawDefinition:a}),k){let{error:x}=Kh({participantIds:[k],tournamentRecord:n});x&&console.log("cleanup")}return{...W,modifiedLineUp:O};function F({side:x}){let L;if(x.participant){let $=x.participant.individualParticipantIds||[];if($.filter(Boolean).length===1){let{participant:V}=ro({participantIds:$,tournamentRecord:n});$.push(s);let{participant:_}=ro({participantIds:$,tournamentRecord:n});if(!_&&V){V.individualParticipantIds=$;let B=tA({pairOverride:!0,tournamentRecord:n,participant:V});if(B.error)return B}else L=V?.participantId}}else{let $=Il({participant:{individualParticipantIds:[s],participantRole:Jr,participantType:ft},pairOverride:!0,tournamentRecord:n});if($.error)return $}return{...W,deletedParticipantId:L}}}function yk({collectionPosition:t,teamParticipantId:e,drawDefinition:i,modifiedLineUp:r,participantId:n,collectionId:a,tieFormat:s}){let o=Wp({participantId:e,drawDefinition:i})?.lineUp,l=(r||o)?.find(c=>c?.participantId===n),u={collectionId:a,collectionPosition:t};if(l)l.collectionAssignments.push(u);else{let c={collectionAssignments:[u],participantId:n};r.push(c)}return Jh({participantId:e,lineUp:r,drawDefinition:i,tieFormat:s})}function Tue(t){let{tournamentRecord:e,drawDefinition:i,participantId:r,event:n}=t,a="removeTieMatchUpParticiapantId";if(!r)return q({result:{error:dr},stack:a});let s=qj(t);if(s.error)return s;let{appliedPolicies:o}=Dt({tournamentRecord:e,drawDefinition:i,event:n}),l=(t.policyDefinitions?.[Mr]??o?.[Mr]??qv[Mr])?.processCodes?.substitution,{inContextDualMatchUp:u,inContextTieMatchUp:c,relevantAssignments:d,collectionPosition:p,teamParticipants:f,collectionId:m,matchUpType:h,dualMatchUp:g,tieMatchUp:I,tieFormat:v}=s;if(!g)return q({result:{error:sa},stack:a});let w=c?.sides?.find(E=>E.participant?.participantId===r||E.participant?.individualParticipantIds?.includes(r));if(!w)return q({result:{error:ji},stack:a});let y=t.policyDefinitions?.[ms]??o?.[ms];if(!w.substitutions?.length&&(fr({score:c?.score})||c?.winningSide)&&y?.requireParticipantsForScoring!==!1)return q({result:{error:Rie},stack:a});let b=u?.sides?.find(({sideNumber:E})=>E===w.sideNumber)?.participantId;if(!b)return q({result:{error:ji},stack:a});let S=Ri({participantFilters:{participantIds:[r]},tournamentRecord:e})?.participants?.[0];if(!S)return q({result:{error:ji},stack:a});if(h===zt&&S.participantType===ft)return q({result:{error:$p},stack:a});let U=S.participantType===It?[r]:S.individualParticipantIds;WU({tournamentId:e.tournamentId,eventId:n.eventId,inContextDualMatchUp:u,drawDefinition:i,dualMatchUp:g});let T=g.sides?.find(({sideNumber:E})=>E===w.sideNumber);if(!T&&(g.sides?.filter(({lineUp:E})=>!E).length||0)<2){let E=f?.map(({participantId:R})=>({drawPosition:d?.find(C=>C.participantId===R)?.drawPosition,teamParticipantId:R}));T=g.sides?.find(R=>E?.find(({drawPosition:C})=>C===R.drawPosition)?.teamParticipantId===b)}if(!T)return q({result:{error:ji,context:{participantId:r}}});let{modifiedLineUp:P,previousParticipantIds:D}=Uue({collectionPosition:p,teamParticipantId:b,dualMatchUpSide:T,participantIds:U,drawDefinition:i,collectionId:m});if(T.lineUp=P,b&&v&&Jh({participantId:b,lineUp:P,drawDefinition:i,tieFormat:v}),h===Bt&&S.participantType===It){let E=c?.sides?.find(M=>M.sideNumber===T?.sideNumber),{participantId:R}=E??{},C=R&&Ri({participantFilters:{participantIds:[R]},tournamentRecord:e,withDraws:!0})?.participants?.[0];if(C){let M=C?.individualParticipantIds?.filter(N=>N!==r)??[];if(D&&M.push(...D),M.length>2)return q({result:{error:Ia},stack:a});if(C.draws?.length){if(M.length===1){let{participant:N}=ro({participantIds:M,tournamentRecord:e});if(!N){let A=Il({participant:{participantRole:Jr,individualParticipantIds:M,participantType:ft},pairOverride:!0,tournamentRecord:e});if(A.error)return q({result:A,stack:a})}}}else if(M.length){C.individualParticipantIds=M;let N=tA({participant:C,pairOverride:!0,tournamentRecord:e});if(N.error)return q({result:N,stack:a})}else{let N=Kh({participantIds:[R],tournamentRecord:e});N.error&&console.log("cleanup",{result:N})}}else return q({result:{error:ji},stack:a})}if(w.substitutions?.length===1&&!c?.sides?.find(E=>E.sideNumber!==w.sideNumber)?.substitutions?.length&&I?.processCodes?.length){for(let E of l||[]){let R=I.processCodes.lastIndexOf(E);I.processCodes.splice(R,1)}Ut({tournamentId:e?.tournamentId,matchUp:I,context:a,drawDefinition:i})}return Ut({tournamentId:e?.tournamentId,matchUp:g,context:a,drawDefinition:i}),{...W,modifiedLineUp:P}}function Kj(t){let e=He(t,[{[hr]:!0,[In]:!0,[Pl]:!0}]);if(e.error)return e;let{drawDefinition:i,sideNumber:r,matchUpId:n,event:a}=t;if(r&&![1,2].includes(r))return{error:re,sideNumber:r};let{matchUp:s,structure:o}=fi({drawDefinition:i,matchUpId:n,event:a});return s?Hn({structure:o})?(s.sides?.forEach(l=>{(!r||l.sideNumber===r)&&delete l.participantId}),Ut({tournamentId:t.tournamentRecord?.tournamentId,context:"assignSideParticipant",drawDefinition:i,matchUp:s}),{...W}):{error:Q$}:{error:dn}}function BHe({matchUpStatuses:t=["BYE",ai,qt],drawPositionMatchUps:e,loserDrawPosition:i,sourceMatchUps:r}){let n=e?.reduce((c,d)=>!c||d.roundNumber>c.roundNumber?d:c,void 0),a=n?.drawPositions?.find(c=>c!==i),s=r.filter(c=>c?.drawPositions?.includes(a)).map(c=>c.matchUpStatus),o=r.filter(c=>c?.drawPositions?.includes(i)).map(c=>c.matchUpStatus),l=xn(s||[],t),u=xn(o||[],t);return{sourceMatchUp:n,winnerHadMatchUpStatus:l,winnerMatchUpStatuses:s,loserHadMatchUpStatus:u,loserMatchUpStatuses:o}}function VHe({inContextDrawMatchUps:t,sourceMatchUpStatus:e,targetDrawPosition:i,tournamentRecord:r,sourceMatchUpId:n,drawDefinition:a,structureId:s,dualMatchUp:o,roundNumber:l,matchUpsMap:u,event:c}){let{structure:d}=tt({drawDefinition:a,structureId:s});if(d?.structureType===gn)return{...W};u=u??Or({drawDefinition:a});let p=(u?.mappedMatchUps||{})[s].matchUps,{initialRoundNumber:f}=Wm({drawPosition:i,matchUps:p}),m=p?.filter(g=>g.roundNumber>=l&&g.roundNumber!==f&&g.drawPositions?.includes(i)),{positionAssignments:h}=Kt({drawDefinition:a,structureId:s});for(let g of m??[])jHe({inContextDrawMatchUps:t,sourceMatchUpStatus:e,positionAssignments:h,targetDrawPosition:i,tournamentRecord:r,sourceMatchUpId:n,drawDefinition:a,dualMatchUp:o,matchUpsMap:u,matchUp:g,event:c});return{...W}}function jHe({inContextDrawMatchUps:t,positionAssignments:e,sourceMatchUpStatus:i,targetDrawPosition:r,tournamentRecord:n,sourceMatchUpId:a,drawDefinition:s,dualMatchUp:o,matchUpsMap:l,matchUp:u,event:c}){let d="removeSubsequentDrawPosition";if(o){let f=t.find(({matchUpId:h})=>u.matchUpId===h).sides?.find(h=>h.drawPosition===r)?.sideNumber,m=u.sides?.find(h=>h.sideNumber===f);m&&delete m.lineUp}u.drawPositions=(u.drawPositions||[]).map(f=>f===r?void 0:f).filter(Boolean);let p=e.filter(({drawPosition:f})=>u.drawPositions?.includes(f)).filter(f=>f.bye).length;return u.matchUpStatus=p&&"BYE"||Lr(u.matchUpStatus)&&u.matchUpStatus||_i,Lr(u.matchUpStatus)&&(u.winningSide=void 0),u.matchUpStatusCodes&&zae({inContextDrawMatchUps:t,sourceMatchUpStatus:i,sourceMatchUpId:a,matchUpsMap:l,matchUp:u}),Ut({tournamentId:n?.tournamentId,eventId:c?.eventId,context:`${d}-${r}`,drawDefinition:s,matchUp:u}),{...W}}function ay(t){let{dualWinningSideChange:e,inContextDrawMatchUps:i,tournamentRecord:r,drawDefinition:n,matchUpStatus:a,matchUpsMap:s,dualMatchUp:o,targetData:l,matchUpId:u,structure:c,event:d}=t,p=!!t.matchUp.collectionId,f=Hn({structure:c}),{drawPositions:m,winningSide:h}=l.matchUp||{};if(!f&&!m)return{error:XS};let{targetLinks:{loserTargetLink:g,winnerTargetLink:I,byeTargetLink:v},targetMatchUps:{loserMatchUp:w,winnerMatchUp:y,byeMatchUp:b}}=l,S=So({...t,matchUpStatus:a||_i,removeWinningSide:!0});if(S.error)return S;let U;if(p){let{matchUpTieId:O,matchUpsMap:k}=t;if(U=Wc({appliedPolicies:t.appliedPolicies,matchUpId:O,tournamentRecord:r,drawDefinition:n,matchUpsMap:k,event:d}),!e&&!U.removeWinningSide)return{...W}}if(f)return{...W};let{matchUps:T}=At({afterRecoveryTimes:!1,inContext:!0,drawDefinition:n,matchUpsMap:s,structure:c}),{positionAssignments:P}=pr({structure:c}),D=h-1,E=1-D,R=m[D],C=m[E],{winnerParticipantId:M,loserParticipantId:N}=P?.reduce((O,k)=>(k.drawPosition===C&&(O.loserParticipantId=k.participantId),k.drawPosition===R&&(O.winnerParticipantId=k.participantId),O),{winnerParticipantId:void 0,loserParticipantId:void 0})||{},A=T.filter(O=>O.drawPositions?.includes(C));if(y&&Due({sourceMatchUpStatus:a,sourceMatchUpId:u,inContextDrawMatchUps:i,winningDrawPosition:R,winnerParticipantId:M,tournamentRecord:r,winnerTargetLink:I,drawDefinition:n,winnerMatchUp:y,dualMatchUp:o,matchUpsMap:s}),w){let{winnerHadMatchUpStatus:O}=BHe({drawPositionMatchUps:A,loserDrawPosition:C,sourceMatchUps:T}),k=g.linkCondition===fl;if(O&&k){let x=Math.min(...w.drawPositions);Qx({targetLink:g,inContextDrawMatchUps:i,drawDefinition:n,drawPosition:x,matchUpsMap:s,event:d})}let F=GHe({sourceMatchUpStatus:a,sourceMatchUpId:u,loserParticipantId:N,tournamentRecord:r,loserTargetLink:g,drawDefinition:n,loserMatchUp:w,dualMatchUp:o,matchUpsMap:s,event:d});if(F.error)return F}if(b){let O=Math.min(...b.drawPositions);Qx({targetLink:v,inContextDrawMatchUps:i,drawDefinition:n,drawPosition:O,matchUpsMap:s,event:d})}return{...W,...U&&{tieMatchUpResult:U}}}function Due({inContextDrawMatchUps:t,winningDrawPosition:e,sourceMatchUpStatus:i,winnerParticipantId:r,tournamentRecord:n,winnerTargetLink:a,sourceMatchUpId:s,drawDefinition:o,winnerMatchUp:l,matchUpsMap:u,dualMatchUp:c,event:d}){let{structureId:p,roundNumber:f}=l,m="removeDirectedWinner";if(a){let h=a.target.structureId,{structure:g}=tt({drawDefinition:o,structureId:h});if(!g)return{error:vi};let{positionAssignments:I}=pr({structure:g});g.seedAssignments=(g.seedAssignments??[]).filter(U=>U.participantId!==r);let v=I?.find(U=>U.participantId===r)?.drawPosition,{matchUps:w}=At({drawDefinition:o,structure:g,event:d}),y=w.map(U=>U.drawPositions).flat(1/0).filter(Boolean),b=Sa(y);if((v?b[v]:void 0)===1)I?.forEach(U=>{U.participantId===r&&delete U.participantId});else{let U=w.filter(({drawPositions:T})=>T.includes(v));console.log("not removing from position assignments since instances > 1",{drawPositionMatchUps:U,winnerTargetLink:a})}let S=u?.drawMatchUps?.find(({matchUpId:U})=>U===l.matchUpId);S&&Ut({tournamentId:n?.tournamentId,eventId:d?.eventId,matchUp:S,context:m,drawDefinition:o})}return f&&VHe({targetDrawPosition:e,inContextDrawMatchUps:t,sourceMatchUpStatus:i,tournamentRecord:n,sourceMatchUpId:s,drawDefinition:o,dualMatchUp:c,matchUpsMap:u,roundNumber:f,structureId:p}),{...W}}function GHe({sourceMatchUpStatus:t,loserParticipantId:e,tournamentRecord:i,loserTargetLink:r,sourceMatchUpId:n,drawDefinition:a,loserMatchUp:s,matchUpsMap:o,dualMatchUp:l,event:u}){let c="removeDirectedLoser",d=r.target.structureId,{structure:p}=tt({drawDefinition:a,structureId:d});if(!p)return{error:vi};let{positionAssignments:f}=pr({structure:p}),m=f?.find(h=>h.participantId===e)?.drawPosition;if(f?.forEach(h=>{h.participantId===e&&delete h.participantId}),n&&t){let h=o?.drawMatchUps?.find(({matchUpId:g})=>g===s.matchUpId);h.matchUpStatusCodes=t===Si?["WO","WO"]:[]}if(p.seedAssignments=(p.seedAssignments??[]).filter(h=>h.participantId!==e),l){let h=s?.sides.reduce((v,w,y)=>w.drawPosition===m?y:v,void 0),g=o?.drawMatchUps?.find(({matchUpId:v})=>v===s.matchUpId),I=g?.sides?.[h];I&&(delete I.lineUp,Ut({tournamentId:i?.tournamentId,eventId:u?.eventId,matchUp:g,context:c,drawDefinition:a}))}return{...W}}function Qx({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,matchUpsMap:n,targetLink:a,event:s}){let o=a.target.structureId,l="removeDirectedBye";Ht({color:"brightyellow",method:l,drawPosition:r});let u=AU({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,matchUpsMap:n,structureId:o,event:s});return q({result:u,stack:l})}function HHe(t){let{matchUpFormat:e,score:i}=t,r=i?.sets?.length,n=e&&qi(e),{setFormat:a,finalSetFormat:s,bestOf:o}=n??{};return(o&&r===o&&s||a)?.timed||!1}function WHe({tournamentRecord:t,drawDefinition:e,structure:i,matchUp:r}){let n="attemptToSetMatchUpStatusBYE";if(r?.winningSide)return q({result:{error:Nv},context:{matchUpStatus:"BYE"},stack:n});let{positionAssignments:a}=pr({structure:i}),s=a?.filter(o=>o.bye).map(o=>o.drawPosition);return r.drawPositions?.some(o=>s?.includes(o))?(r.matchUpStatus="BYE",r.matchUpStatusCodes=[],Ut({tournamentId:t?.tournamentId,context:n,drawDefinition:e,matchUp:r}),{...W}):q({result:{error:$te},info:"matchUp does not include BYE",stack:n})}function Zy(t){let{tournamentRecord:e,appliedPolicies:i,drawDefinition:r,matchUpsMap:n,targetData:a,structure:s,event:o}=t,l="doubleExitAdvancement";if(s.structureType===gn)return q({result:{...W},stack:l});let{matchUp:u,targetMatchUps:c,targetLinks:d}=a,{loserMatchUp:p,winnerMatchUp:f,loserTargetDrawPosition:m}=c,h=Lr(p?.matchUpStatus)&&!p.sides?.map(I=>I.participantId??I.participant).filter(Boolean).length,g=p?.matchUpStatus===Si;if(Ht({method:l,newline:!0,color:"brightyellow",keyColors:{sourceMatchUpId:"brightcyan",loserMatchUpId:"brightmagenta",winnerMatchUpId:"brightgreen"},sourceMatchUpId:u?.matchUpId,sourceStatus:t.matchUpStatus,sourceDP:JSON.stringify(u?.drawPositions),loserMatchUpId:p?.matchUpId,loserStatus:p?.matchUpStatus,loserDP:JSON.stringify(p?.drawPositions),loserTargetDP:m,loserIsEmptyExit:h,loserIsDoubleExit:g,loserSides:JSON.stringify(p?.sides?.map(I=>({sn:I.sideNumber,pid:I.participantId?.slice(0,8),fed:I.participantFed}))),winnerMatchUpId:f?.matchUpId,winnerStatus:f?.matchUpStatus,winnerDP:JSON.stringify(f?.drawPositions)}),p&&p.matchUpStatus!=="BYE"){let{loserTargetLink:I}=d,v=i?.progression?.doubleExitPropagateBye,w=p.feedRound&&p.sides?.[0]?.participantFed;if(v||w){Ht({method:l,color:"cyan",decision:"advanceByeToLoserMatchUp",propagateBye:v,targetFedIn:!!w});let y=Pue({loserTargetDrawPosition:m,tournamentRecord:e,loserTargetLink:I,drawDefinition:r,loserMatchUp:p,matchUpsMap:n,event:o});if(y.error)return q({result:y,stack:l})}else if(h){let y=t.matchUpStatus===Wi?Wi:Si,b=t.matchUpStatus===Wi?qt:ai,S=n.drawMatchUps.find(U=>U.matchUpId===p.matchUpId);if(Ht({method:l,color:"brightred",decision:"EMPTY_EXIT_converting_to_DOUBLE_EXIT",loserMatchUpId:p.matchUpId,currentStatus:p.matchUpStatus,newStatus:y}),S){let U=[{matchUpStatus:b,previousMatchUpStatus:y,sideNumber:1},{matchUpStatus:b,previousMatchUpStatus:t.matchUpStatus,sideNumber:2}].map(P=>je(P)),T=So({...t,matchUp:S,matchUpId:p.matchUpId,matchUpStatus:y,matchUpStatusCodes:U,winningSide:void 0,removeScore:!0});if(T.error)return q({result:T,stack:l})}}else if(g)Ht({method:l,color:"brightyellow",decision:"SKIP_loserMatchUp_already_doubleExit",loserMatchUpId:p.matchUpId});else{let{feedRound:y,drawPositions:b,matchUpId:S}=p,U=y?2:2-b.indexOf(m);Ht({method:l,color:"cyan",decision:"conditionallyAdvanceLoser",feedRound:y,walkoverWinningSide:U,loserMatchUpId:S});let T=zq({...t,targetMatchUp:p,walkoverWinningSide:U,tournamentRecord:e,sourceMatchUp:u,matchUpId:S});if(T.error)return q({result:T,stack:l})}}if(f){Ht({method:l,color:"cyan",decision:"conditionallyAdvanceWinner",winnerMatchUpId:f.matchUpId});let I=zq({...t,matchUpId:f.matchUpId,targetMatchUp:f,tournamentRecord:e,sourceMatchUp:u});if(I.error)return q({result:I,stack:l})}return q({result:{...W},stack:l})}function zq(t){let{inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:r,sourceMatchUp:n,targetMatchUp:a,matchUpsMap:s}=t,o=r.structures.find(({structureId:_})=>_===a.structureId),l=t.matchUpStatus===Wi?Wi:Si,u=t.matchUpStatus===Wi?qt:ai,c="conditionallyAdvanceDrawPosition",d=s.drawMatchUps.find(_=>_.matchUpId===a.matchUpId);if(!d)return{error:sa};let p=n?.drawPositions||[],f=d.drawPositions?.filter(Boolean),m=n?.structureId===a.structureId;if(Ht({method:c,newline:!0,color:"magenta",keyColors:{targetMatchUpId:"brightcyan",sourceMatchUpId:"brightyellow"},targetMatchUpId:a.matchUpId,targetStructureId:a.structureId?.slice(0,8),targetRound:[a.roundNumber,a.roundPosition],targetDP:JSON.stringify(d.drawPositions),targetStatus:d.matchUpStatus,targetFeedRound:a.feedRound,sourceMatchUpId:n?.matchUpId,sourceStructureId:n?.structureId?.slice(0,8),sourceRound:n?[n.roundNumber,n.roundPosition]:void 0,sourceDP:JSON.stringify(p),sameStructure:m,paramMatchUpStatus:t.matchUpStatus,EXIT:u,DOUBLE_EXIT:l}),m&&xn(p,f)&&(f=f.filter(_=>!p.includes(_))),m&&f.length>1)return q({result:{error:bI},stack:c});let{pairedPreviousMatchUpIsDoubleExit:h,pairedPreviousMatchUp:g}=Hae({...t,structure:o});Ht({method:c,color:"magenta",keyColors:{pairedMatchUpId:"brightcyan"},pairedMatchUpId:g?.matchUpId,pairedRound:g?[g.roundNumber,g.roundPosition]:void 0,pairedStatus:g?.matchUpStatus,pairedStructureId:g?.structureId?.slice(0,8),pairedIsDoubleExit:h});let I=Fn({matchUpId:a.matchUpId,inContextDrawMatchUps:e,drawDefinition:r}),{targetMatchUps:v,targetLinks:w}=I,{loserTargetDrawPosition:y,winnerMatchUp:b,loserMatchUp:S}=v;if(S){let{loserTargetLink:_}=w,B=Pue({loserTargetDrawPosition:y,loserMatchUp:S,tournamentRecord:i,loserTargetLink:_,drawDefinition:r,matchUpsMap:s});if(B.error)return q({result:B,stack:c})}let U=d.drawPositions?.filter(Boolean)||[],T=U.length===1,P=t.walkoverWinningSide||T&&vD({drawPosition:U[0],matchUpId:a.matchUpId,inContextDrawMatchUps:e})||void 0,D=Lr(d.matchUpStatus)&&!U.length,E=D?l:u;Ht({method:c,color:"brightyellow",keyColors:{matchUpStatus:"brightgreen",existingExit:"brightred"},existingExit:D,matchUpStatus:E,targetCurrentStatus:d.matchUpStatus,targetDP:JSON.stringify(U),hasDrawPosition:T,walkoverWinningSide:P});let R=e.find(_=>_.matchUpId===g.matchUpId),C=[],M;n&&(n?.structureId===R?.structureId?n.roundPosition<g?.roundPosition?M=1:M=2:a.feedRound?n.structureId===a.structureId?M=2:M=1:P&&(M=3-P),Ht({method:c,color:"cyan",keyColors:{sourceSideNumber:"brightgreen"},sourceSideNumber:M,sourceStructureId:n.structureId?.slice(0,8),pairedStructureId:R?.structureId?.slice(0,8),targetStructureId:a.structureId?.slice(0,8),sameStructureAsPaired:n?.structureId===R?.structureId,targetFeedRound:a.feedRound,sourceRP:n.roundPosition,pairedRP:g?.roundPosition}));let N=t.matchUpStatus,A=g?.matchUpStatus;M===1?C=[{matchUpStatus:NT(N),previousMatchUpStatus:N,sideNumber:1},{matchUpStatus:NT(A),previousMatchUpStatus:A,sideNumber:2}]:M===2&&(C=[{matchUpStatus:NT(A),previousMatchUpStatus:A,sideNumber:1},{matchUpStatus:NT(N),previousMatchUpStatus:N,sideNumber:2}]),C.length&&(C=C.map(_=>je(_))),Ht({method:c,color:"brightgreen",keyColors:{matchUpStatus:"brightcyan",winningSide:"brightyellow"},action:"modifyMatchUpScore",targetMatchUpId:d.matchUpId,matchUpStatus:E,winningSide:P,matchUpStatusCodes:JSON.stringify(C),sourceStatus:N,pairedStatus:A});let O=So({...t,winningSide:P,matchUp:d,matchUpStatusCodes:C,matchUpStatus:E});if(O.error)return q({result:O,stack:c});if(D)return Ht({method:c,color:"brightred",decision:"EXISTING_EXIT_triggers_recursive_doubleExitAdvancement",targetMatchUpId:d.matchUpId,matchUpStatus:E}),Zy({...t,matchUpStatus:E,targetData:I});if(!b)return q({result:{...W},stack:c});let k=f.length===2?f[P-1]:f[0],{positionAssignments:F}=Kt({structure:o}),x=F?.find(_=>_.drawPosition===k),L=s.drawMatchUps.find(_=>_.matchUpId===b.matchUpId),$=L?.drawPositions?.filter(Boolean),V=$.length===1;if(k){if(x?.bye){let _=Fn({matchUpId:L.matchUpId,inContextDrawMatchUps:e,drawDefinition:r});if(V){let B=$.filter(Boolean)[0],G=vD({drawPosition:B,matchUpId:L.matchUpId,inContextDrawMatchUps:e}),j=So({appliedPolicies:t.appliedPolicies,matchUpId:L.matchUpId,matchUp:L,matchUpStatus:u,matchUpStatusCodes:[],removeScore:!0,drawDefinition:r,winningSide:G});return j.error?q({result:j,stack:c}):A2({drawPositionToAdvance:B,matchUpId:L.matchUpId,inContextDrawMatchUps:e,drawDefinition:r,matchUpsMap:s})}else if(Lr(b.matchUpStatus)){let B=Zy({...t,matchUpId:L.matchUpId,matchUpStatus:E,targetData:_});if(B.error)return q({result:B,stack:c})}return q({result:{...W},stack:c})}return gm({matchUpId:b.matchUpId,drawPosition:k,inContextDrawMatchUps:e,drawDefinition:r})}else if(h){if(!L)return{error:sa};if(V){let G=$[0],j=vD({matchUpId:a.matchUpId,inContextDrawMatchUps:e,drawPosition:G});console.log("existing drawPosition is winningSide",{walkoverWinningSide:j})}let _=Lr(L.matchUpStatus)?u:l,B=So({matchUpId:L.matchUpId,appliedPolicies:t.appliedPolicies,matchUp:L,matchUpStatusCodes:[],removeScore:!0,drawDefinition:r,matchUpStatus:_});if(B.error)return q({result:B,stack:c});if(_===l){let G=Zy({...t,matchUpId:a.matchUpId,matchUpStatus:_,targetData:I});if(G.error)return G}}return q({result:{...W},stack:c})}function Pue(t){let{loserTargetDrawPosition:e,tournamentRecord:i,loserTargetLink:r,drawDefinition:n,matchUpsMap:a,event:s,loserMatchUp:o}=t,l=r?.target?.structureId,{structure:u}=tt({drawDefinition:n,structureId:l});return u?Ja({drawPosition:e,tournamentRecord:i,drawDefinition:n,structureId:l,matchUpsMap:a,loserMatchUp:o,event:s}):{error:hf}}function NT(t){return t===Si?ai:t===Wi?qt:t}function zHe(t){let{tournamentRecord:e,drawDefinition:i,matchUpStatus:r,structure:n,matchUp:a}=t,s=!!(a.tieMatchUps&&!a.rondPosition&&t.inContextDrawMatchUps.find(v=>v.matchUpId===a.matchUpId).containerStructureId),o="attemptToSetMatchUpStatus",l=r==="BYE",u=a.winningSide,c=[Si,Wi].includes(r),d=NU({matchUpStatus:r}),p=Rx({matchUpStatus:r}),f=!d&&!p,m=t.matchUpTieId||u&&d&&!c,h=u&&c;Ht({method:o,newline:!0,color:"brightyellow",keyColors:{matchUpStatus:"brightcyan",matchUpId:"brightmagenta"},matchUpId:a.matchUpId,matchUpStatus:r,existingStatus:a.matchUpStatus,existingWinningSide:u,isDoubleExit:c,isBYE:l,directing:d,nonDirecting:p,unrecognized:f,onlyModifyScore:m,changeCompletedToDoubleExit:h,propagateExitStatus:t.propagateExitStatus,teamRoundRobinContext:s});let g=()=>So({...t,removeScore:[Rl,ai].includes(r),matchUpStatus:r||_i}),I=f&&"unrecognized"||m&&"onlyModifyScore"||h&&"changeCompletedToDoubleExit"||u&&"existingWinningSide_removeDirected"||p&&"nonDirecting_clearScore"||l&&"isBYE"||!d&&"notDirecting_error"||c&&"isDoubleExit_modifyAndAdvance"||s&&"teamRoundRobinContext"||t.propagateExitStatus&&"propagateExitStatus"||"fallthrough_error";return Ht({method:o,color:"brightgreen",keyColors:{route:"brightcyan"},route:I,matchUpId:a.matchUpId}),f&&{error:lx}||m&&UD(t)||h&&qHe(t)||u&&ay(t)||p&&g()||l&&WHe({tournamentRecord:e,drawDefinition:i,structure:n,matchUp:a})||!d&&{error:lx}||c&&YHe(t)||s&&UD(t)||t.propagateExitStatus&&UD(t)||q({result:{error:Nv,info:"matchUpStatus: "+r},stack:o})}function qHe(t){let e=ay(t);return e.error?e:Zy(t)}function YHe(t){let e=UD({...t,removeScore:!0});return e.error?e:Zy(t)}function UD(t){let e="scoreModification";if(t.isCollectionMatchUp&&t.dualMatchUp?.winningSide&&!t.projectedWinningSide){let n=ay(t);if(n.error)return q({result:n,stack:e})}let i=!!t.matchUp.collectionId,r=So({...t});if(i){let{matchUpTieId:n,drawDefinition:a,matchUpsMap:s}=t,o=Wc({tournamentRecord:t.tournamentRecord,appliedPolicies:t.appliedPolicies,matchUpId:n,event:t.event,drawDefinition:a,matchUpsMap:s});if(o.error)return q({result:o,stack:e});Object.assign(r,{tieMatchUpResult:o})}return q({result:r,stack:e})}function KHe({drawDefinition:t,structure:e,matchUp:i}){let{drawPositions:r}=i,{positionAssignments:n}=Kt({drawDefinition:t,structure:e}),a=n?.filter(({drawPosition:l})=>r?.includes(l))?.map(l=>{let{extension:u}=ht({element:l,name:Dc});return u?.value?.groupOrder}),{containerStructures:s}=jv({drawDefinition:t}),o=s[e.structureId];return{structureIds:Gv({drawDefinition:t,structureId:o})?.links?.source?.filter(l=>xn(a,l.source?.finishingPositions||[])).map(l=>l.source.structureId)}}function Eue({drawDefinition:t,structure:e,matchUp:i}){let r=[];if(e.finishingPosition===Gp&&Su({drawDefinition:t,structure:e})){let{structureIds:n}=KHe({drawDefinition:t,structure:e,matchUp:i});n?.length&&r.push(...n)}return{connectedStructureIds:r}}function XHe(t){let e,{inContextDrawMatchUps:i,inContextMatchUp:r,drawDefinition:n,winningSide:a}=t,s=t.targetData.targetLinks?.winnerTargetLink;if(s.target.feedProfile===ho){let o=r.sides.find(({sideNumber:u})=>u!==a).participantId,l=i.find(u=>u.structureId===s.target.structureId&&u.roundNumber===s.target.roundNumber&&u.sides.some(({participantId:c})=>c===o));if(l?.matchUpStatus===_i){let u=Fn({matchUpId:l.matchUpId,inContextDrawMatchUps:i,drawDefinition:n});if(!Kp({inContextDrawMatchUps:i,drawDefinition:n,targetData:u})){let{structure:c}=tt({structureId:l.structureId,drawDefinition:n}),d=Kt({structure:c}).positionAssignments;for(let p of d||[])if(p.participantId===o){let f=r.sides.find(({sideNumber:m})=>m===a).participantId;if(p.participantId=f,c?.positionAssignments)c.positionAssignments=d;else if(c?.structures){let m=Object.assign({},...(d||[]).map(h=>({[h.drawPosition]:h.participantId})));for(let h of c.structures)h.positionAssignments?.forEach(g=>g.participantId=m[g.drawPosition])}Pc({tournamentId:t.tournamentRecord?.tournamentId,event:t.event,drawDefinition:n,structure:c}),e=!0}}}}return{...W,qualifierReplaced:e}}function JHe(t){let e,{inContextDrawMatchUps:i,inContextMatchUp:r,drawDefinition:n,winningSide:a}=t,s=t.targetData.targetLinks?.winnerTargetLink;if(s.target.feedProfile===ho){let o=r.sides.find(({sideNumber:c})=>c===a)?.participantId,l=i.filter(c=>c.structureId===s.target.structureId&&c.roundNumber===s.target.roundNumber&&c.sides.some(({participantId:d,qualifier:p})=>p&&!d)),u=Ns(l);if(u?.matchUpStatus===_i){let c=Fn({matchUpId:u.matchUpId,inContextDrawMatchUps:i,drawDefinition:n});if(!Kp({inContextDrawMatchUps:i,drawDefinition:n,targetData:c})){let d=u.sides.find(m=>m.qualifier&&!m.participantId)?.drawPosition,{structure:p}=tt({structureId:u.structureId,drawDefinition:n});if(!p)return{error:vi};let f=Kt({structure:p}).positionAssignments;for(let m of f||[])if(m.drawPosition===d&&!m.participantId){if(m.participantId=o,p.positionAssignments)p.positionAssignments=f;else if(p.structures){let h=Object.assign({},...(f||[]).map(g=>({[g.drawPosition]:g.participantId})));for(let g of p.structures)g.positionAssignments?.forEach(I=>I.participantId=h[I.drawPosition])}Pc({tournamentId:t.tournamentRecord?.tournamentId,event:t.event,drawDefinition:n,structure:p}),e=!0}}}}return{...W,qualifierPlaced:e}}function QHe(t){let e="attemptToSetWinningSide",i,r={},{appliedPolicies:n,disableAutoCalc:a,drawDefinition:s,dualMatchUp:o,winningSide:l,structure:u,matchUp:c}=t;if(o?._disableAutoCalc&&a!==!1)return pV(t);if(c.winningSide&&c.winningSide!==l){let{connectedStructureIds:m}=Eue({drawDefinition:s,structure:u,matchUp:c});m.length&&(console.log({connectedStructureIds:m}),i=!0);let h=ay(t);if(h.error)return h}let d=Ase(t);if(d.context?.progressExitStatus&&Object.assign(r,d.context),d.error)return q({result:d,stack:e});let p,f;return t.qualifierChanging&&n?.[Xb]?.autoReplaceQualifiers&&(p=XHe(t).qualifierReplaced),t.qualifierAdvancing&&n?.[Xb]?.autoPlaceQualifiers&&(f=JHe(t).qualifierPlaced),q({result:je({...W,...d,connectedStructures:i,qualifierReplaced:p,qualifierPlaced:f,context:r}),stack:e})}var TD={drawPositionToRemove:"green",iteration:"brightred",winner:"green",loser:"brightred"};function Rue(t){let{inContextDrawMatchUps:e,appliedPolicies:i,drawDefinition:r,matchUpsMap:n,targetData:a,matchUp:s}=t,{matchUpId:o}=s,{iteration:l=0}=t;l+=1;let u="removeDoubleExit";Ht({color:"brightyellow",method:u,matchUpId:o,iteration:l,keyColors:TD});let{targetMatchUps:{loserMatchUp:c,winnerMatchUp:d,loserTargetDrawPosition:p},targetLinks:{loserTargetLink:f}}=a;if(d&&d.matchUpStatus!=="BYE"){let{stage:g,roundNumber:I,roundPosition:v,structureName:w}=d;Ht({winner:"winner",roundPosition:v,structureName:w,roundNumber:I,keyColors:TD,stage:g}),qq({...t,targetMatchUp:d,sourceMatchUp:s,iteration:l})}let m=c?.matchUpStatus==="BYE"&&(c?.feedRound||c?.roundNumber===1),h=a?.targetLinks?.loserTargetLink?.linkCondition===fl;if(m&&h){let g=e.filter(({roundNumber:w,structureId:y})=>y===s.structureId&&w===1),I=g.map(({roundPosition:w})=>w),v=wr(I.sort(),2).find(w=>w.includes(s.roundPosition));if((g.filter(({roundPosition:w})=>v.includes(w))?.map(({matchUpStatus:w})=>w)).every(w=>[Wi,Si].includes(w)))return q({result:{...W},stack:u})}if(c&&(c.matchUpStatus!=="BYE"||m)){let g=e.find(({matchUpId:U})=>U===c.matchUpId),{structure:I}=tt({drawDefinition:r,structureId:g.structureId}),{stage:v,roundNumber:w,roundPosition:y,feedRound:b,structureName:S}=c;if(Ht({loser:"loser",roundPosition:y,structureName:S,roundNumber:w,keyColors:TD,feedRound:b,stage:v}),i?.progression?.doubleExitPropagateBye||m)Qx({drawPosition:p,targetLink:f,inContextDrawMatchUps:e,drawDefinition:r,matchUpsMap:n});else{let U=qq({...t,targetMatchUp:c,structure:I,iteration:l});if(U.error)return q({result:U,stack:u})}}return q({result:{...W},stack:u})}function qq(t){let{inContextDrawMatchUps:e,appliedPolicies:i,drawDefinition:r,sourceMatchUp:n,targetMatchUp:a,matchUpsMap:s,structure:o,iteration:l}=t,u="conditionallyRemoveDrawPosition";Ht({method:u,structureName:o?.structureName,iteration:l});let c=Fn({matchUpId:a.matchUpId,inContextDrawMatchUps:e,drawDefinition:r}),{targetMatchUps:{winnerMatchUp:d}}=c,p=s?.drawMatchUps.find(w=>w.matchUpId===a.matchUpId),f,m,h;if(a.feedRound)h=d?.drawPositions?.filter(Boolean)?.find(w=>a.drawPositions.includes(w));else if(n==null)h=Li(a?.drawPositions||[],d?.drawPositions||[])?.[0];else{m=Wae({structureId:o.structureId,matchUp:n,matchUpsMap:s})?.pairedPreviousMatchUp,f=[Si,Wi].includes(m?.matchUpStatus);let w=m?.drawPositions?.filter(Boolean)||[];if([...Ki,"BYE"].includes(m?.matchUpStatus)||m?.winningSide){let y=n.drawPositions||[],b=a.drawPositions?.filter(Boolean);xn(y,b)&&(b=b?.filter(S=>!y.includes(S))),h=y.concat(w).find(S=>b?.includes(S))}}if(d&&h){let{stage:w,roundNumber:y,roundPosition:b,structureName:S}=d;Ht({method:"removeDirectedWinner",drawPositionToRemove:h,color:"brightgreen",roundPosition:b,structureName:S,roundNumber:y,keyColors:TD,stage:w}),Due({winningDrawPosition:h,winnerMatchUp:d,inContextDrawMatchUps:e,drawDefinition:r,matchUpsMap:s})}let g=Rue({targetData:c,matchUp:a,inContextDrawMatchUps:e,appliedPolicies:i,drawDefinition:r,matchUpsMap:s,structure:o,iteration:l});if(g.error)return q({result:g,stack:u});let I=ZHe({pairedPreviousDoubleExit:f,noContextTargetMatchUp:p}),v=!f;return g=So({...t,matchUpId:a.matchUpId,matchUp:p,removeWinningSide:!0,matchUpStatusCodes:[],matchUpStatus:I,removeScore:v,score:{scoreStringSide1:"",scoreStringSide2:"",sets:void 0}}),g.error?q({result:g,stack:u}):{...W}}function ZHe({pairedPreviousDoubleExit:t,noContextTargetMatchUp:e}){return e.matchUpStatus==="BYE"?"BYE":t?[Wi,qt].includes(e?.matchUpStatus)?qt:ai:_i}function eWe(t){let e,{inContextDrawMatchUps:i,inContextMatchUp:r,drawDefinition:n}=t,a=t.targetData.targetLinks?.winnerTargetLink;if(a.target.feedProfile===ho){let s=r.sides?.find(({sideNumber:l})=>l===r.winningSide)?.participantId,o=i.find(l=>l.structureId===a.target.structureId&&l.roundNumber===a.target.roundNumber&&l.sides?.some(({participantId:u})=>u===s));if(o&&o.matchUpStatus===_i){let l=Fn({matchUpId:o.matchUpId,inContextDrawMatchUps:i,drawDefinition:n});if(!Kp({inContextDrawMatchUps:i,drawDefinition:n,targetData:l})){let{structure:u}=tt({structureId:o.structureId,drawDefinition:n}),c=Kt({structure:u}).positionAssignments;for(let d of c||[])if(d.participantId===s){if(d.participantId=void 0,u?.positionAssignments)u.positionAssignments=c;else if(u?.structures){let p=Object.assign({},...(c||[]).map(f=>({[f.drawPosition]:f.participantId})));for(let f of u?.structures||[])f.positionAssignments?.forEach(m=>m.participantId=p[m.drawPosition])}Pc({tournamentId:t.tournamentRecord?.tournamentId,event:t.event,drawDefinition:n,structure:u}),e=!0}}}}return{qualifierRemoved:e}}function tWe(t){let{matchUp:e,matchUpStatus:i,score:r,winningSide:n}=t,a="noDownStreamDependencies";if([Si,Wi].includes(e?.matchUpStatus)&&![Si,Wi].includes(i)){let g=Rue(t);if(g.error)return q({result:g,stack:a})}let s=i===Si,o=fr({score:r})&&!s&&(t.isCollectionMatchUp&&!t.projectedWinningSide||!n),l=t?.inContextMatchUp?.collectionId&&HHe(t.inContextMatchUp),u=t.removeScore||!l&&![Da,Ta].includes(i||Da),c=t.isCollectionMatchUp&&t.dualMatchUp.winningSide&&!t.projectedWinningSide||e.winningSide&&!n&&!fr({score:r}),d=g=>{let I,{structure:v,drawDefinition:w,dualMatchUp:y,disableAutoCalc:b}=t;if(y?._disableAutoCalc&&b!==!1)return pV({...t,removeWinningSide:c});let{connectedStructureIds:S}=Eue({drawDefinition:w,structure:v,matchUp:e});S.length&&(console.log({connectedStructureIds:S}),I=!0),Object.assign(t,{removeScore:g});let U=ay(t);if(U.error)return U;if(t.removingQualifier&&t.appliedPolicies?.[Xb]?.autoRemoveQualifiers){let T=eWe(t);return{...W,connectedStructures:I,...T}}return{...W,connectedStructures:I}};if(c&&n&&t.isCollectionMatchUp)return Yq(t);let p=[Rl,Ta].includes(i)&&t.dualWinningSideChange,f=i&&i!==_i,m=t.propagateExitStatus&&Lr(i),h=(n||p||m)&&QHe(t)||o&&d(u)||f&&zHe(t)||c&&d(u)||e&&Yq({...t,removeScore:!0})||{...W};return q({result:h,stack:a})}function Yq(t){let e="ndd:scoreModification";if(t.isCollectionMatchUp&&t.dualMatchUp?.winningSide&&!t.projectedWinningSide&&!t.autoCalcDisabled){let r=ay(t);if(r.error)return r}let i=So({...t});if(t.isCollectionMatchUp){let{matchUpTieId:r,drawDefinition:n,event:a,matchUpsMap:s}=t,{removeWinningSide:o}=Wc({tournamentRecord:t.tournamentRecord,appliedPolicies:t.appliedPolicies,matchUpId:r,drawDefinition:n,matchUpsMap:s,event:a});o&&console.log("REMOVE WINNING SIDE")}return q({result:i,stack:e})}function Xj(t){let e=He(t,[{[hr]:!0,[In]:!0,[Pl]:!0},{homeParticipantId:!0,[js]:dr}]);if(e.error)return e;let i=ey(t,[{[Lv]:Au,attr:{[kM]:!0}}]);if(i.error)return i;let r=i?.matchUp?.matchUp?.sides?.map(c=>c?.participantId);if(t.homeParticipantId&&!r?.includes(t.homeParticipantId))return{error:Co};let{disableNotice:n,homeParticipantId:a,removePriorValues:s,tournamentRecord:o,drawDefinition:l,matchUpId:u}=t;return Ea({duplicateValues:!1,removePriorValues:s,tournamentRecord:o,drawDefinition:l,disableNotice:n,matchUpId:u,timeItem:{itemType:U2,itemValue:a}})}function Cue({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:r,timeStamp:n}=Tf({timeItems:i?.timeItems||[],itemType:XM});return!e||n&&t&&new Date(n).getTime()>new Date(t).getTime()?{timeModifiers:r}:e}function tp(t){let e="addMatchUpScheduledTime",i=t.matchUp,{removePriorValues:r,tournamentRecord:n,drawDefinition:a,disableNotice:s,scheduledTime:o,matchUpId:l}=t;if(!l)return q({result:{error:Tn},stack:e});if(!xv(o))return q({result:{error:Es},stack:e});if(!i){let f=fi({drawDefinition:a,matchUpId:l});if(f.error)return q({result:f,stack:e});i=f.matchUp}let u=Ze(o),c=Df({matchUp:i}).scheduledDate,d=u&&!c;if((Cue({matchUp:i}).timeModifiers||[])?.length){let f=Mue({disableNotice:!0,removePriorValues:r,tournamentRecord:n,timeModifiers:[],drawDefinition:a,matchUpId:l,matchUp:i});if(f?.error)return q({result:f,stack:e})}let p=Lh(o,!0,d);return Ea({duplicateValues:!1,removePriorValues:r,tournamentRecord:n,drawDefinition:a,disableNotice:s,matchUpId:l,timeItem:{itemType:Hh,itemValue:p}})}function Mue({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,timeModifiers:n,matchUpId:a,matchUp:s}){let o="addMatchUpTimeModifiers";if(!a)return q({result:{error:Tn},stack:o});if(n!==void 0&&!Array.isArray(n))return q({info:qp("timeModifiers"),result:{error:re},stack:o});if(!s){let d=fi({drawDefinition:i,matchUpId:a});if(d.error)return q({result:d,stack:o});s=d.matchUp}let l=Cue({matchUp:s}).timeModifiers||[],u=n.filter(d=>!l.includes(d));if(n.length&&!u.length)return{...W};if(u.some(d=>Dx.includes(d))){l=l.filter(p=>!Dx.includes(p));let d=tp({disableNotice:!0,removePriorValues:t,scheduledTime:"",tournamentRecord:e,drawDefinition:i,matchUpId:a});if(d.error)return q({result:d,stack:o})}let c=n?.length?[...u,...l]:void 0;return Ea({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:a,timeItem:{itemType:XM,itemValue:c}})}function iA({scheduledDate:t,removePriorValues:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:a}){if(!a)return{error:Tn};let s=t&&dl.test(t);if(t&&!s)return{error:or};let o={itemValue:Ze(t),itemType:Gh};return Ea({duplicateValues:!1,removePriorValues:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:a,timeItem:o})}function rA({removePriorValues:t,tournamentRecords:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,courtDayDate:a,matchUpId:s,courtIds:o}){if(!i&&!e)return{error:ve};if(!s)return{error:Tn};let l=fi({drawDefinition:r,matchUpId:s});if(l.error)return l;if(l?.matchUp?.matchUpType!==La)return{error:oa};if(!(o===void 0||Array.isArray(o)&&o.length&&o.every(c=>typeof c=="string")))return{error:re,context:{courtIds:o}};let u;if(o){let c=e||i&&{[i.tournamentId]:i},d=Fu({tournamentRecords:c});if(d.error)return d;let p=d.courts?.filter(f=>o.includes(f.courtId));if(p?.length!==o.length)return{error:re,context:{courtIds:o}};u=p?.map(f=>({venueId:f.venueId,courtId:f.courtId}))}return Ea({duplicateValues:!1,removePriorValues:t,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:s,timeItem:{itemType:wu,itemDate:a,itemValue:u}})}function sy({removePriorValues:t,tournamentRecords:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:a,venueId:s}){if(!i)return{error:ve};if(!a)return{error:Tn};if(s){let o=Ou({tournamentRecords:e,tournamentRecord:i,venueId:s});if(o.error)return o}return Ea({duplicateValues:!1,removePriorValues:t,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:a,timeItem:{itemType:jh,itemValue:s}})}function rg({removePriorValues:t,tournamentRecords:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,courtDayDate:a,matchUpId:s,courtId:o}){if(!i&&!e)return{error:ve};if(!s)return{error:Tn};if(o){let l=Zd({tournamentRecords:e,tournamentRecord:i,courtId:o});if(l.error)return l;let u=l.venue?.venueId;sy({tournamentRecords:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:s,venueId:u})}return Ea({duplicateValues:!1,removePriorValues:t,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:s,timeItem:{itemType:Ed,itemDate:a,itemValue:o}})}function Wo(t,e){let i=Jie.test(t)?t:pi(t),r=Ze(t)||Ze(e)||Bs(new Date);return new Date(`${r}T${i}`).getTime()}function nA(t){let e="addMatchUpScheduleItems",i=He(t,[{drawDefinition:!0,matchUpId:!0},{schedule:!0,[qn]:Kn}],e);if(i.error)return i;let{matchUpDependencies:r,inContextMatchUps:n}=t,{proConflictDetection:a=!1,errorOnAnachronism:s=!1,checkChronology:o=!0,removePriorValues:l,tournamentRecords:u,tournamentRecord:c,drawDefinition:d,disableNotice:p,drawMatchUps:f,matchUpId:m,schedule:h,event:g}=t,I,v;if(f)I=f.find(A=>A.matchUpId===m);else{let A=fi({drawDefinition:d,event:g,matchUpId:m});if(A.error)return A;I=A.matchUp}let{endTime:w,courtId:y,courtIds:b,courtOrder:S,resumeTime:U,homeParticipantId:T,scheduledDate:P,scheduledTime:D,startTime:E,stopTime:R,timeModifiers:C,venueId:M}=h;o&&(!r||!n)&&({matchUpDependencies:r,matchUps:n}=co({drawDefinition:d}));let N=r?.[m]?.matchUpIds;if(h.scheduledDate&&o&&N){let A=n?.filter(O=>(O.schedule?.scheduledDate||Ze(O.schedule?.scheduledTime))&&N.includes(O.matchUpId)).map(({schedule:O})=>{let k=xP(O);return new Date(k??"").getTime()});if(A?.length){let O=xP(h),k=new Date(O??"").getTime();if(Math.max(...A)>=k){if(s)return q({result:{error:ax},stack:e});v=ax}}}if(P!==void 0){let A=iA({disableNotice:!0,removePriorValues:l,tournamentRecord:c,drawDefinition:d,scheduledDate:P,matchUpId:m});if(A?.error)return q({result:A,stack:e,context:{scheduledDate:P}})}if(D!==void 0){let A=tp({disableNotice:!0,removePriorValues:l,tournamentRecord:c,drawDefinition:d,scheduledTime:D,matchUpId:m,matchUp:I});if(A?.error)return q({result:A,stack:e,context:{scheduledTime:D}})}if(E!==void 0){let A=Qj({disableNotice:!0,removePriorValues:l,tournamentRecord:c,drawDefinition:d,matchUpId:m,startTime:E,event:g});if(A?.error)return q({result:A,stack:e,context:{startTime:E}})}if(R!==void 0){let A=eG({disableNotice:!0,removePriorValues:l,tournamentRecord:c,drawDefinition:d,matchUpId:m,stopTime:R,event:g});if(A?.error)return q({result:A,stack:e,context:{stopTime:R}})}if(U!==void 0){let A=tG({disableNotice:!0,removePriorValues:l,tournamentRecord:c,drawDefinition:d,resumeTime:U,matchUpId:m,event:g});if(A?.error)return q({result:A,stack:e,context:{resumeTime:U}})}if(w!==void 0){let A=Zj({disableNotice:!0,removePriorValues:l,tournamentRecord:c,drawDefinition:d,matchUpId:m,endTime:w,event:g});if(A?.error)return q({result:A,stack:e,context:{endTime:w}})}if(b!==void 0){let A=rA({disableNotice:!0,removePriorValues:l,tournamentRecord:c,drawDefinition:d,matchUpId:m,courtIds:b});if(A?.error)return q({result:A,stack:e,context:{courtIds:b}})}if(a&&y!==void 0&&P!==void 0&&S!==void 0&&lt(S)){let A=Ke(S),O=(Ur({tournamentRecord:c})?.matchUps??[]).find(k=>{if(k.matchUpId===m)return!1;let F=k.schedule?.courtOrder?Ke(k.schedule.courtOrder):void 0;return k.schedule?.courtId===y&&F===A&&k.schedule?.scheduledDate===P});if(O)return q({result:{error:bte,info:`Court slot already occupied by matchUp ${O.matchUpId}`},stack:e,context:{courtId:y,courtOrder:S,scheduledDate:P}})}if(y!==void 0&&P!==void 0){let A=rg({courtDayDate:P,disableNotice:!0,removePriorValues:l,tournamentRecords:u,tournamentRecord:c,drawDefinition:d,matchUpId:m,courtId:y});if(A?.error)return q({result:A,stack:e,context:{courtId:y}})}if(M!==void 0){let A=sy({disableNotice:!0,removePriorValues:l,tournamentRecords:u,tournamentRecord:c,drawDefinition:d,matchUpId:m,venueId:M});if(A?.error)return q({result:A,stack:e,context:{venueId:M}})}if(S!==void 0&&lt(S)){let A=Jj({disableNotice:!0,removePriorValues:l,tournamentRecord:c,drawDefinition:d,courtOrder:S,matchUpId:m});if(A?.error)return q({result:A,stack:e,context:{courtOrder:S}})}if(C!==void 0){let A=Mue({disableNotice:!0,removePriorValues:l,tournamentRecord:c,drawDefinition:d,timeModifiers:C,matchUpId:m,matchUp:I});if(A?.error)return q({result:A,stack:e,context:{timeModifiers:C}})}return ni(T)&&Xj({disableNotice:!0,homeParticipantId:T,removePriorValues:l,tournamentRecord:c,drawDefinition:d,matchUpId:m}),p||Ut({tournamentId:c?.tournamentId,eventId:g?.eventId,context:e,drawDefinition:d,matchUp:I}),v?{...W,warnings:[v]}:{...W}}function Jj({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,courtOrder:n,matchUpId:a}){if(!a)return{error:Tn};if(n&&!lt(n))return{error:re,info:"courtOrder must be numeric"};let s=n&&Ke(n);return Ea({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:a,timeItem:{itemType:KM,itemValue:s}})}function Nue({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,participantId:n,officialType:a,matchUpId:s}){if(!s)return{error:Tn};if(!n)return{error:dr};if(e){let l=Ri({tournamentRecord:e,participantFilters:{participantTypes:[It],participantRoles:[$2]}}).participants??[];if(!Ud({tournamentParticipants:l,participantId:n}))return{error:ji}}let o={itemType:"SCHEDULE.ASSIGNMENT.OFFICIAL",itemValue:n};return a&&(o.itemSubTypes=[a]),Ea({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:s,timeItem:o})}function Qj({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:n,startTime:a,event:s}){if(!n)return{error:Tn};if(!xv(a))return{error:Es};let{matchUp:o}=fi({drawDefinition:i,event:s,matchUpId:n}),{scheduledDate:l}=Df({matchUp:o}),u=(o?.timeItems??[]).filter(c=>[tc,Kl,Rc].includes(c?.itemType)).map(c=>Wo(c.itemValue,l)).reduce((c,d)=>!c||d<c?d:c,void 0);if(!u||Wo(a,l)<u){o?.timeItems&&(o.timeItems=o.timeItems.filter(d=>d.itemType!==go));let c=Lh(a,!0,!0);return Ea({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:n,timeItem:{itemType:go,itemValue:c}})}else return{error:vie}}function Zj({validateTimeSeries:t=!0,removePriorValues:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:a,endTime:s,event:o}){if(!a)return{error:Tn};if(!xv(s))return{error:Es};let{matchUp:l}=fi({drawDefinition:r,event:o,matchUpId:a}),{scheduledDate:u}=Df({matchUp:l}),c=(l?.timeItems??[]).filter(d=>[go,Kl,tc].includes(d?.itemType)).map(d=>Wo(d.itemValue,u)).reduce((d,p)=>!d||p>d?p:d,void 0);if(!t||!c||Wo(s,u)>c){l?.timeItems&&(l.timeItems=l.timeItems.filter(p=>p.itemType!==Rc));let d=Lh(s,!0,!0);return Ea({duplicateValues:!1,removePriorValues:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:a,timeItem:{itemType:Rc,itemValue:d}})}else return{error:gie}}function eG({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:n,stopTime:a,event:s}){if(!n)return{error:Tn};if(!xv(a))return{error:Es};let{matchUp:o}=fi({drawDefinition:i,event:s,matchUpId:n}),{scheduledDate:l}=Df({matchUp:o}),u=o?.timeItems??[];if(u.reduce((m,h)=>h.itemType===Rc||m,void 0))return{error:dB};let c=u.filter(m=>[go,Kl,tc].includes(m?.itemType)).sort((m,h)=>Wo(m.itemValue,l)-Wo(h.itemValue,l)),d=c.at(-1),p=d?.itemType===tc,f=c.filter(m=>!p||m.createdAt!==d.createdAt).map(m=>Wo(m.itemValue,l)).reduce((m,h)=>!m||h>m?h:m,void 0);if(Wo(a,l)>f){if(o?.timeItems&&p){let h=d.createdAt;o.timeItems=o.timeItems.filter(g=>g.createdAt!==h)}let m={itemValue:Lh(a,!0,!0),itemType:tc};return Ea({duplicateValues:!0,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:n,timeItem:m})}else return{error:Iie}}function tG({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,resumeTime:n,matchUpId:a,event:s}){if(!a)return{error:Tn};if(!xv(n))return{error:Es};let{matchUp:o}=fi({drawDefinition:i,event:s,matchUpId:a}),{scheduledDate:l}=Df({matchUp:o}),u=o?.timeItems??[];if(u.reduce((m,h)=>h.itemType===Rc||m,void 0))return{error:dB};let c=u.filter(m=>[go,Kl,tc].includes(m?.itemType)).sort((m,h)=>Wo(m.itemValue,l)-Wo(h.itemValue,l)),d=c.at(-1),p=d?.itemType===Kl,f=c.filter(m=>!p||m.createdAt!==d.createdAt).map(m=>Wo(m.itemValue,l)).reduce((m,h)=>!m||h>m?h:m,void 0);if(Wo(n,l)>f){if(o?.timeItems&&p){let h=d.createdAt;o.timeItems=o.timeItems.filter(g=>g.createdAt!==h)}let m={itemValue:Lh(n,!0,!0),itemType:Kl};return Ea({duplicateValues:!0,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:a,timeItem:m})}else return{error:h1e}}function iWe(t){let{targetData:e,matchUpsMap:i}=t,{targetMatchUps:{loserMatchUp:r}}=e,n=Lr(r?.matchUpStatus),a=!!i?.drawMatchUps.find(s=>s.loserMatchUpId===r?.matchUpId&&Lr(s.matchUpStatus));return a&&r?.matchUpStatus===Si||a&&n}function rWe({drawDefinition:t,matchUpStatus:e,matchUpsMap:i,winningSide:r,dualMatchUp:n,tieFormat:a,structure:s,matchUp:o,event:l,score:u}){let c=Oe(n,void 0,!0);for(let p of c?.tieMatchUps||[])p.matchUpId===o.matchUpId&&(p.winningSide=r,p.score=u,!fr({score:u})&&!e?Object.assign(p,{...pN}):e&&(p.matchUpStatus=e));a=a??yn({matchUp:o,structure:s,drawDefinition:t,event:l})?.tieFormat;let{winningSide:d}=HU({matchUp:c,drawDefinition:t,matchUpsMap:i,structure:s,tieFormat:a,event:l});return{projectedWinningSide:d}}function nWe(t){let{tournamentRecord:e,inContextMatchUp:i,structure:r,drawDefinition:n}=t,a=i.roundNumber,s=i.sides.find(b=>b.sideNumber===i.winningSide),o=i.sides.find(b=>b.sideNumber!==i.winningSide),{drawPosition:l,participantId:u}=s,{drawPosition:c,participantId:d}=o,p="swapWinnerLoser",{matchUps:f}=At(t),m=f.filter(({drawPositions:b,roundNumber:S})=>b?.includes(l)&&S>a);la({changeWinner:!0})&&console.log({existingWinnerSubsequentMatchUps:m}),m.forEach(b=>{b.drawPositions=b.drawPositions?.map(S=>S===l?c:S)||[],Ut({tournamentId:e?.tournamentId,eventId:t.event?.eventId,context:p,drawDefinition:n,matchUp:b})});let{stage:h,stageSequence:g}=r,I=n.structures.filter(({stage:b,stageSequence:S})=>b===h&&S>g).map(({structureId:b})=>b),{targetLinks:{loserTargetLink:v,winnerTargetLink:w}}=t.targetData,y=[v?.target.structureId,w?.target?.structureId].filter(Boolean);return n.structures.filter(({stage:b,structureId:S})=>b!==h&&y.includes(S)).forEach(({stage:b,stageSequence:S,structureId:U})=>{I.includes(U)||I.push(U),n.structures.filter(({stage:T,stageSequence:P})=>T===b&&P>S).forEach(({structureId:T})=>{I.includes(T)||I.push(T)})}),n.structures.filter(({structureId:b})=>I.includes(b)).forEach(b=>{let{positionAssignments:S}=Kt({structure:b}),U=S?.find(({participantId:P})=>P===u),T=S?.find(({participantId:P})=>P===d);U&&(U.participantId=d),T&&(T.participantId=u)}),So({...t})}function Rf(t){let e="setMatchUpStatus";t.matchUpStatus&&[ai,Si].includes(t.matchUpStatus)&&(t.score=void 0);let{allowChangePropagation:i,disableScoreValidation:r,propagateExitStatus:n,tournamentRecords:a,tournamentRecord:s,disableAutoCalc:o,enableAutoCalc:l,drawDefinition:u,matchUpStatus:c,winningSide:d,matchUpId:p,event:f,score:m}=t;if(!u)return{error:$e};if(c&&[Rl,Da,Ta,_i].includes(c)&&d)return{error:re,winningSide:d,matchUpStatus:c};if(![void 0,...mne].includes(c))return q({result:{error:Nv},info:"matchUpStatus does not exist",stack:"setMatchUpStatus"});let h=Or({drawDefinition:u}),{matchUps:g}=Zi({nextMatchUps:!0,tournamentRecord:s,inContext:!0,drawDefinition:u,matchUpsMap:h,event:f}),I=h.drawMatchUps.find(V=>V.matchUpId===p),v=g?.find(V=>V.matchUpId===p);if(!I||!g)return{error:dn};if((I.winningSide||d)&&c==="BYE")return{context:"Cannot have Bye with winningSide",error:dD,matchUpStatus:c};let w=v?.structureId,{structure:y}=tt({drawDefinition:u,structureId:w}),b=Pi(ei)(I.matchUpType),S=v?.drawPositions?.filter(Boolean),U=v?.matchUpTieId,T=Fn({matchUpId:U||p,inContextDrawMatchUps:g,drawDefinition:u});Object.assign(t,{inContextDrawMatchUps:g,inContextMatchUp:v,matchUpTieId:U,matchUpsMap:h,targetData:T,structure:y,matchUp:I});let P=c===_i&&m?.scoreStringSide1===""&&m?.scoreStringSide2===""&&!d;if(iWe(t)&&P)return{error:r1e};let D=Kp(t),E;if(b){if(o)Ft({extension:{name:Gm,value:!0},element:I});else if(l){let V=I.winningSide,{winningSide:_,scoreStringSide1:B,scoreStringSide2:G,set:j}=HU({drawDefinition:u,matchUpsMap:h,structure:y,matchUp:I,event:f}),K={scoreStringSide1:B,scoreStringSide2:G,sets:j?[j]:[]};if(E=_!==V,D&&E)return q({stack:"winningSideWithDownstreamDependencies",result:{error:mM},context:{winningSide:d,matchUp:I}});Nn({name:Gm,element:I}),Object.assign(t,{winningSide:_,dualWinningSideChange:E,projectedWinningSide:_,score:K})}WU({tournamentId:s?.tournamentId,inContextDualMatchUp:v,eventId:f?.eventId,dualMatchUp:I,drawDefinition:u})}if(b&&c&&[$h].includes(c))return{info:"Not supported for matchUpType: TEAM",error:re};if(m&&!b&&!r){let V=I.matchUpFormat??y?.matchUpFormat??u?.matchUpFormat??f?.matchUpFormat,_=XV({existingMatchUpStatus:I.matchUpStatus,matchUpFormat:V,matchUpStatus:c,winningSide:d,score:m});if(_.error)return _}let R=Dt({policyTypes:[Xb,ms],tournamentRecord:s,drawDefinition:u,event:f})?.appliedPolicies??{};wt(t.policyDefinitions)&&Object.assign(R,t.policyDefinitions);let C=sWe({assignedDrawPositions:S,propagateExitStatus:n,inContextMatchUp:v,appliedPolicies:R,drawDefinition:u,matchUpStatus:c,structure:y,matchUp:I});if(C?.error)return C;let M=v?.stage===ze&&v.finishingRound===1,N=M&&d,A=M&&I.winningSide&&!d&&(!t.matchUpStatus||t.matchUpStatus&&Rx({matchUpStatus:t.matchUpStatus}))&&(!t.outcome||!fr({outcome:t.outcome})),O=N&&d!==I.winningSide&&I.winningSide;if(Object.assign(t,{qualifierAdvancing:N,qualifierChanging:O,removingQualifier:A,appliedPolicies:R}),U){let{matchUp:V}=fi({matchUpId:U,inContext:!0,drawDefinition:u,matchUpsMap:h,event:f});if(V){let _=yn({matchUp:V,drawDefinition:u,structure:y,event:f})?.tieFormat,{projectedWinningSide:B}=rWe({drawDefinition:u,matchUpStatus:c,dualMatchUp:V,matchUpsMap:h,winningSide:d,tieFormat:_,structure:y,matchUp:I,event:f,score:m}),G=V.winningSide;E=B!==G;let j=V._disableAutoCalc;Object.assign(t,{isCollectionMatchUp:!0,dualWinningSideChange:E,projectedWinningSide:B,autoCalcDisabled:j,matchUpTieId:U,dualMatchUp:V,tieFormat:_})}}let k=NU({matchUpStatus:c});if(!U){if(D&&!d&&(c&&Rx({matchUpStatus:c})||c&&[Si,Wi].includes(c)))return{error:dD,activeDownstream:D,winningSide:d};if(d&&d===I.winningSide&&c&&!k)return{context:"winningSide must include directing matchUpStatus",error:dD,directingMatchUpStatus:k,matchUpStatus:c}}let{schedule:F}=t;if(F){let V=nA({disableNotice:!0,tournamentRecords:a,tournamentRecord:s,drawDefinition:u,matchUpId:p,schedule:F});if(V.error)return V}let x=!b&&!E&&d&&I.winningSide&&I.winningSide!==d;if(i&&x&&I.roundPosition)return nWe(t);let L=d&&!U||t.projectedWinningSide;Ht({activeDownstream:D,matchUpWinner:L,method:e,winningSide:d});let $=!D&&tWe(t)||L&&aWe(t)||(k||t.autoCalcDisabled)&&Aue(t)||{error:Pie};return q({result:$,stack:e})}function aWe(t){let{matchUp:e,winningSide:i,matchUpTieId:r,dualWinningSideChange:n}=t;return i===e.winningSide||r&&!n?Aue(t):q({stack:"winningSideWithDownstreamDependencies",result:{error:mM},context:{winningSide:i,matchUp:e}})}function Aue(t){let{tournamentRecord:e,matchUp:i,event:r}=t,n=t.isCollectionMatchUp&&i.winningSide&&!t.winningSide&&!fr({score:t.score}),a=t.isCollectionMatchUp?t.matchUpStatus||n&&_i||t.winningSide&&Oi||Da:t.matchUpStatus||Oi,s=t.removeScore||[Rl,ai].includes(a)&&![Da,Ta].includes(a),o=So({...t,matchUpStatus:a,removeWinningSide:n,removeScore:s});if(o.error)return o;if(t.isCollectionMatchUp){let{matchUpTieId:l,drawDefinition:u,matchUpsMap:c}=t,d=Wc({appliedPolicies:t.appliedPolicies,matchUpId:l,tournamentRecord:e,drawDefinition:u,matchUpsMap:c,event:r});if(d.error)return d;Object.assign(o,{tieMatchUpResult:d})}return o}function sWe({assignedDrawPositions:t,propagateExitStatus:e,inContextMatchUp:i,appliedPolicies:r,drawDefinition:n,matchUpStatus:a,structure:s,matchUp:o}){if(r?.[ms]?.requireParticipantsForScoring===!1)return{...W};let l=i?.sides?.map(d=>d.participantId).filter(Boolean).length,u=o?.sides?[]:Kt({structureId:s?.structureId,drawDefinition:n}).positionAssignments,c=l&&l===2||o.collectionId&&Hn({structure:s})&&l&&l>=1||t?.length===2&&u?.filter(d=>t.includes(d.drawPosition)).every(d=>d.participantId);return a&&[ai,qt,Si].includes(a)&&l===1&&e?{...W}:a&&fne.includes(a)&&!c?q({info:"matchUpStatus requires assigned participants",context:{matchUpStatus:a,requiredParticipants:c},result:{error:Nv}}):{...W}}function kue({tournamentRecord:t,drawDefinition:e,matchUpId:i,event:r}){if(!e)return{error:$e};let{matchUp:n}=fi({drawDefinition:e,matchUpId:i,event:r});return n?.matchUpType!==La?{error:oa}:Rf({enableAutoCalc:!0,tournamentRecord:t,drawDefinition:e,matchUpId:i,event:r})}function Oue({drawDefinition:t,event:e,matchUpId:i}){if(!t)return{error:$e};if(!i)return{error:Tn};let{matchUp:r}=fi({drawDefinition:t,event:e,matchUpId:i});return r?Nn({name:$M,element:r}):{error:dn}}function oWe({substituteParticipantId:t,existingParticipantId:e,tournamentRecord:i,drawDefinition:r,sideNumber:n,matchUpId:a,event:s}){let o="substituteParticipant";if(!r)return{error:$e};if(!a)return{error:Tn};if(!e||!t)return q({result:{error:dr},stack:o});let{matchUp:l}=fi({drawDefinition:r,matchUpId:a,event:s});if(!l)return{error:dn};if(!l.collectionId)return q({result:{error:oa},stack:o});let u=Or({drawDefinition:r}),{matchUps:c}=Zi({tournamentParticipants:i?.participants,inContext:!0,drawDefinition:r,matchUpsMap:u}),d=c?.find(f=>f.matchUpId===a),p=c?.find(f=>f.matchUpId===d?.matchUpTieId)?.sides?.find(f=>f.participant.individualParticipants.some(({participantId:m})=>m===e));return!p||n&&p.sideNumber!==n?{error:Co}:p.participant?.individualParticipants?.map(yt).filter(f=>f!==e)?.includes(t)?Yj({newParticipantId:t,tieMatchUpId:a,existingParticipantId:e,substitution:!0,tournamentRecord:i,drawDefinition:r,event:s}):q({result:{error:Co},stack:o})}function xue(t){return oWe(t)}function Fue({drawDefinition:t,matchUpId:e,event:i}){if(!t)return{error:$e};let{matchUp:r}=fi({drawDefinition:t,matchUpId:e,event:i});return Ft({extension:{name:Gm,value:!0},element:r})}function Lue(t){let e="setMatchUpFormat",i=He(t,[{tournamentRecord:!0},{[qr]:b=>$a({matchUpFormat:b}),[Ba]:ZS,matchUpFormat:!0}]);if(i.error)return q({result:i,stack:e});let{tournamentRecord:r,drawDefinition:n,scheduledDates:a,stageSequences:s,matchUpFormat:o,structureId:l,eventType:u,matchUpId:c,eventId:d,stages:p,drawId:f,event:m,force:h}=t;if(a&&!Array.isArray(a))return q({result:{error:re,scheduledDates:a},stack:e});if(u&&!fm([pl,fs],u))return q({result:{error:cu},stack:e});let g=0,I=t.structureIds||l&&[l].filter(Boolean)||[],v=t.eventIds||d&&[d].filter(Boolean)||[],w=t.drawIds||f&&[f].filter(Boolean)||[];if((l||I?.length)&&!n)return q({result:{error:$e},stack:e});if(f&&c&&n){let b=ej({tournamentRecord:r,drawDefinition:n,matchUpFormat:o,structureIds:I,structureId:l,matchUpId:c});if(b.error)return b;g+=1}let y=b=>{let S=[];for(let U of b.structures||[]){if(Array.isArray(p)&&!p.includes(U.stage)||Array.isArray(s)&&!s.includes(U.stageSequence)||I?.length&&!I.includes(U.structureId))continue;I?.length&&U.matchUpFormat!==o&&(U.matchUpFormat=o,S.push(U.structureId),g+=1);let T=((h||a)&&At({matchUpFilters:{matchUpStatuses:[_i]},structure:U}).matchUps)??[],P=(a&&At({matchUpFilters:{matchUpStatuses:[_i]},contextFilters:{scheduledDates:a},afterRecoveryTimes:!1,inContext:!0,structure:U}).matchUps)??[];if(T?.length){let D=P?P.map(vr):T.map(vr);for(let E of T)D.includes(E.matchUpId)&&(E.matchUpFormat=a?.length?o:void 0,Ut({tournamentId:r?.tournamentId,eventId:m?.eventId,context:e,drawDefinition:b,matchUp:E}))}}return!S.length&&b.matchUpFormat!==o&&(b.matchUpFormat=o,g+=1),S};for(let b of r?.events||[])if(!(v?.length&&!v.includes(b.eventId)||u&&u!==b.eventType||u===ar))if(Array.isArray(s)||Array.isArray(p)||I?.length||w?.length)for(let S of b.drawDefinitions||[]){if(Array.isArray(w)&&!w.includes(S.drawId))continue;let U=y(S);ii({structureIds:U,drawDefinition:S})}else b.matchUpFormat!==o&&(b.matchUpFormat=o,g+=1);return g?{...W,modificationsCount:g}:{...W,info:Ov}}function iG({inheritance:t=!0,tournamentRecord:e,drawDefinition:i,matchUpId:r,event:n}){if(!i)return{error:$e};let a=fi({drawDefinition:i,matchUpId:r})?.matchUp;if(!a?.tieMatchUps)return{error:oa};let s=fi({inContext:!0,drawDefinition:i,matchUpId:r,event:n})?.matchUp,o=0;return(a?.sides||[]).forEach(l=>{l.lineUp&&delete l.lineUp}),(s?.sides||[]).forEach(l=>{if(o+=1,t===!1){let u=s?.tieFormat,c=l.participantId;u&&c&&Jh({drawDefinition:i,participantId:c,lineUp:[],tieFormat:u})}Ut({tournamentId:e?.tournamentId,context:"resetMatchUpLineUps",eventId:n?.eventId,drawDefinition:i,matchUp:a})}),{...W,modificationsCount:o}}function _ue(t){let{matchUpFormat:e,matchUpStatus:i,winningSide:r,score:n,setTBlast:a}=t;if(!n)return{sets:[]};let s=n.sets||[],o=Jl({winnerFirst:!1,matchUpFormat:e,matchUpStatus:i,setTBlast:a,sets:s}),l=Jl({winnerFirst:!1,reversed:!0,matchUpFormat:e,matchUpStatus:i,setTBlast:a,sets:s}),u=Jl({matchUpFormat:e,matchUpStatus:i,winningSide:r,setTBlast:a,sets:s}),c=o===u?l:o;return r&&(o=r===1?u:c,l=r===2?u:c),{score:{sets:s,scoreStringSide1:o,scoreStringSide2:l}}}function lWe({sourceMatchUpStatusCodes:t,propagateExitStatus:e,sourceMatchUpStatus:i,loserParticipantId:r,tournamentRecord:n,drawDefinition:a,loserMatchUp:s,matchUpsMap:o,event:l}){let u="progressExitStatus";Ht({method:u,newline:!0,color:"magenta",keyColors:{loserMatchUpId:"brightcyan",sourceMatchUpStatus:"brightyellow"},loserMatchUpId:s?.matchUpId,loserMatchUpStatus:s?.matchUpStatus,sourceMatchUpStatus:i,sourceMatchUpStatusCodes:JSON.stringify(t),loserParticipantId:r?.slice(0,8),propagateExitStatus:e});let c=Lr(i)&&i!==Sr&&i||ai,d=Zi({inContext:!0,drawDefinition:a,matchUpsMap:o})?.matchUps,p=c,f=d?.find(m=>m.matchUpId===s?.matchUpId);if(Ht({method:u,color:"magenta",carryOverMatchUpStatus:c,updatedLoserMatchUpId:f?.matchUpId,updatedLoserStatus:f?.matchUpStatus,updatedLoserSides:JSON.stringify(f?.sides?.map(m=>({sn:m.sideNumber,pid:m.participantId?.slice(0,8),bye:m.bye}))),updatedLoserDP:JSON.stringify(f?.drawPositions),existingStatusCodes:JSON.stringify(f?.matchUpStatusCodes)}),f?.matchUpId&&p){let m,h=f.matchUpStatusCodes?.map(v=>typeof v=="string"?v:"WO")??[],g=f.sides?.find(v=>v.participantId===r);if(g?.sideNumber){let v=f?.sides?.reduce((w,y)=>y?.participantId?w+1:w,0);if(Ht({method:u,color:"brightyellow",keyColors:{decision:"brightgreen"},loserSideNumber:g.sideNumber,participantsCount:v,statusCodesLength:h.length,existingStatusCodes:JSON.stringify(h),loserMatchUpIsExit:Lr(s.matchUpStatus),loserMatchUpOriginalStatus:s.matchUpStatus}),v===1&&h.length===0)m=g.sideNumber===1?2:1,h[0]=t[0],Ht({method:u,color:"brightgreen",decision:"SINGLE_PARTICIPANT_no_existing_codes",winningSide:m,statusCodes:JSON.stringify(h)});else if(!Lr(s.matchUpStatus))m=g.sideNumber===1?2:1,h[0]=t[0],Ht({method:u,color:"brightgreen",decision:"TWO_PARTICIPANTS_not_exit",winningSide:m,statusCodes:JSON.stringify(h)});else{let w=h[0];h[g.sideNumber-1]=t[0];let y=g.sideNumber===1?2:1;h[y-1]=w,p=Si,m=void 0,Ht({method:u,color:"brightred",decision:"BOTH_EXITS_converting_to_DOUBLE_WALKOVER",loserMatchUpStatus:p,winningSide:m,statusCodes:JSON.stringify(h)})}}else Ht({method:u,color:"brightyellow",decision:"NO_LOSER_PARTICIPANT_SIDE_FOUND",loserParticipantId:r?.slice(0,8),availableSides:JSON.stringify(f.sides?.map(v=>({sn:v.sideNumber,pid:v.participantId?.slice(0,8)})))});Ht({method:u,color:"brightmagenta",keyColors:{finalStatus:"brightgreen",finalWinningSide:"brightyellow"},action:"calling_setMatchUpState",loserMatchUpId:s.matchUpId,finalStatus:p,finalWinningSide:m,finalStatusCodes:JSON.stringify(h)});let I=Rf({matchUpStatus:p,matchUpId:s.matchUpId,matchUpStatusCodes:h,allowChangePropagation:!0,propagateExitStatus:e,tournamentRecord:n,drawDefinition:a,winningSide:m,event:l});return q({result:I,stack:u,context:{progressExitStatus:!0}})}return q({result:{error:sa},stack:u})}function aT(t){let e=He(t,[{[Pl]:!0,[In]:!0}]);if(e.error)return e;let i="setMatchUpStatus",r=ws(t);if(!t.drawDefinition){let b=t.tournamentRecord??(t.tournamentId&&r[t.tournamentId]);t.tournamentRecord||(t.tournamentRecord=b);let S=Wn({eventId:t.eventId,drawId:t.drawId,tournamentRecord:b});if(S.error)return S;S.drawDefinition&&(t.drawDefinition=S.drawDefinition),t.event=S.event}let{disableScoreValidation:n,propagateExitStatus:a,policyDefinitions:s,tournamentRecord:o,disableAutoCalc:l,enableAutoCalc:u,drawDefinition:c,matchUpId:d,schedule:p,event:f,notes:m}=t,h=t.matchUpFormat||t.outcome?.matchUpFormat,{policy:g}=wf({policyType:ms,tournamentRecord:o,event:f}),I=t.allowChangePropagation!==void 0&&t.allowChangePropagation||g?.allowChangePropagation!==void 0&&g.allowChangePropagation||void 0,{outcome:v,setTBlast:w}=t;if(v?.winningSide&&![1,2].includes(v.winningSide))return{error:pM};if(h){let b=ej({tournamentRecord:o,drawDefinition:c,matchUpFormat:h,matchUpId:d,event:f});if(b.error)return b}if(v?.score?.sets&&!v.score.scoreStringSide1){let{score:b}=_ue({...v,setTBlast:w});v.score=b,v.score.sets=v.score.sets.filter(S=>S.side1Score||S.side2Score||S.side1TiebreakScore||S.side2TiebreakScore)}let y=Rf({matchUpStatusCodes:v?.matchUpStatusCodes,matchUpStatus:v?.matchUpStatus,winningSide:v?.winningSide,allowChangePropagation:I,disableScoreValidation:n,score:v?.score,propagateExitStatus:a,tournamentRecords:r,policyDefinitions:s,tournamentRecord:o,disableAutoCalc:l,enableAutoCalc:u,drawDefinition:c,matchUpFormat:h,matchUpId:d,schedule:p,event:f,notes:m});if(y.context?.progressExitStatus){let b=!0,S=0;for(;b&&S<10;){b=!1,S+=1;let U=lWe({sourceMatchUpStatusCodes:y.context.sourceMatchUpStatusCodes,sourceMatchUpStatus:y.context.sourceMatchUpStatus,loserParticipantId:y.context.loserParticipantId,propagateExitStatus:t.propagateExitStatus,tournamentRecord:t.tournamentRecord,loserMatchUp:y.context.loserMatchUp,matchUpsMap:y.context.matchUpsMap,drawDefinition:t.drawDefinition,event:t.event});U.context?.loserMatchUp&&(Object.assign(y.context,U.context),b=!0)}}return q({result:y,stack:i})}function $ue(t){if(!t?.outcomes)return{error:Je};if(!Array.isArray(t.outcomes))return{error:Je,info:{outcomes:t.outcomes}};let e=t.tournamentRecords||t.tournamentRecord&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord}||{},i=t.outcomes??[],r=i.reduce((n,a)=>n.includes(a.tournamentId)?n:n.concat(a.tournamentId),[]);for(let n of r){let a=e[n];if(!a)return{error:ve};let s=i.filter(o=>o.tournamentId===n);if(s.length){let o=uWe({outcomes:s,tournamentRecord:a});if(o.error)return o}}return{...W}}function uWe(t){let{tournamentRecords:e,tournamentRecord:i,outcomes:r,policyDefinitions:n}=t,a={};r.forEach(s=>{let{eventId:o}=s;a[o]||(a[o]=[]),a[o].push(s)});for(let s of Object.keys(a)){let{event:o}=Wn({tournamentRecord:i,eventId:s});for(let l of a[s]){let{drawId:u}=l,c=o?.drawDefinitions?.find(d=>d.drawId===u);if(c&&u){let{matchUpFormat:d,matchUpId:p}=l,f=aT({schedule:l?.schedule,tournamentRecords:e,policyDefinitions:n,tournamentRecord:i,drawDefinition:c,matchUpFormat:d,matchUpId:p,outcome:l,drawId:u,event:o});if(f.error)return f}}}return{...W}}function cWe({drawDefinition:t,matchUpId:e,outcome:i,matchUp:r}){if(!r&&!t)return{error:$e};if(!i)return{error:Je,info:"missing outcome"};if(!r&&!e)return{error:sa};if(!r){let n=fi({drawDefinition:t,matchUpId:e});if(n.error)return n;r=n.matchUp}return typeof i!="object"||!i.score?.scoreStringSide1||!i.score?.scoreStringSide2?{error:re}:Ft({element:r,extension:{name:$M,value:i}})}function Bue(t){return cWe(t)}function rG(t){let e="resetTieFormat",{drawDefinition:i,event:r,uuids:n}=t,a=He(t,[{[hr]:!0,[Pl]:!0}],e);if(a.error)return a;let s=ey(t,[{[Lv]:Au}]);if(s[js])return s;let o=t.tournamentRecord?.tournamentId,{matchUp:l,structure:u}=s?.matchUp??{};if(!l?.tieMatchUps)return q({result:{error:oa},info:"Must be a TEAM matchUp",stack:e});if(!l.tieFormat)return{...W};let c=yn({structure:u,drawDefinition:i,event:r})?.tieFormat;if(!c)return q({result:{error:Br},info:"No inherited tieFormat",stack:e});let d=[],p=[],f=[],m=[];for(let h of c.collectionDefinitions){let{matchUpCount:g,collectionId:I}=h;p.push(I);let v=(l.tieMatchUps||[]).filter(w=>w.collectionId===I);if(v.length>g)v.sort((w,y)=>(w.matchUpStatus===_i?1:0)-(y.matchUpStatus===_i?1:0)),f.push(...v.slice(0,g)),d.push(...v.slice(3).map(vr));else if(f.push(...v),v.length<g){let w=g-v.length,y=jU({collectionDefinition:h,matchUpsLimit:w,matchUp:l,uuids:n});m.push(...y)}}for(let h of l?.tieMatchUps||[])h.collectionId&&!p.includes(h.collectionId)&&d.push(h.matchUpId);return m.length&&(f.push(...m),Dd({eventId:r?.eventId,matchUps:m,drawDefinition:i,tournamentId:o})),d.length&&ku({matchUpIds:d,eventId:r?.eventId,drawDefinition:i,tournamentId:o}),l&&(l.tieMatchUps=f,l.tieFormatId=void 0,l.tieFormat=void 0,Ut({structureId:u?.structureId,eventId:r?.eventId,context:e,drawDefinition:i,tournamentId:o,matchUp:l})),{...W,newMatchUps:m,deletedMatchUpIds:d}}function nG(t){let{tournamentRecord:e,drawDefinition:i,matchUpId:r,event:n}=t,a="resetScorecard";if(!i)return q({result:{error:$e},stack:a});if(!r)return q({result:{error:Tn},stack:a});if(!ni(r))return q({result:{error:re,matchUpId:r},stack:a});let s=Or({drawDefinition:i}),{matchUps:o}=Zi({nextMatchUps:!0,inContext:!0,drawDefinition:i,matchUpsMap:s}),l=s.drawMatchUps.find(h=>h.matchUpId===r),u=o?.find(h=>h.matchUpId===r);if(!l||!o)return{error:dn};if(l.matchUpType!==Ua)return{error:oa};let c=Fn({inContextDrawMatchUps:o,drawDefinition:i,matchUpId:r}),d=u?.structureId,{structure:p}=tt({drawDefinition:i,structureId:d});if(Object.assign(t,{inContextDrawMatchUps:o,inContextMatchUp:u,matchUpsMap:s,targetData:c,structure:p,matchUp:l}),Kp(t))return{error:mM};if(l.tieMatchUps?.length)for(let h of l.tieMatchUps){let g=Rf({matchUpId:h.matchUpId,matchUpTieId:r,winningSide:void 0,removeScore:!0,tournamentRecord:e,drawDefinition:i,event:n});if(g.error)return q({result:g,stack:a})}let f=Dt({tournamentRecord:e,drawDefinition:i,event:n})?.appliedPolicies,m=Wc({event:t.event,removeScore:!0,tournamentRecord:e,appliedPolicies:f,drawDefinition:i,matchUpsMap:s,matchUpId:r});if(m.error)return q({result:m,stack:a});if(t.tiebreakReset&&!m.tieFormatRemoved){let h=yn({drawDefinition:i,structure:p,event:n})?.tieFormat;if(l.tieFormat&&h){let{matchUpCountDifference:g,descendantDifferences:I,ancestorDifferences:v,valueDifference:w}=Cc({descendant:l.tieFormat,ancestor:h});if(I.collectionIds.length===1&&!v.collectionIds.length&&!v.groupsCount&&g===1&&w===1){let y=rG({tournamentRecord:e,drawDefinition:i,matchUpId:r,event:n});if(y.error)return y}}}return{...W}}function Vue(t){let e=He(t,[{[In]:!0,[Vc]:!0},{[RI]:{[dU]:!1,roundNumbers:!1},[Zre]:"At least one must be provided",[qn]:sn}]);if(e.error)return e;let i=$se(t);if(i.error)return i;let{matchUpIds:r}=i,n=Pi(Ua)(t.event.eventType),{tournamentRecord:a,drawDefinition:s,event:o}=t;for(let l of r){if(n){let c=nG({tiebreakReset:!0,tournamentRecord:a,drawDefinition:s,matchUpId:l,event:o});if(c.error||t.removeAssignments&&iG({inheritance:!1,drawDefinition:s,matchUpId:l}).error)return c}let u=Rf({winningSide:void 0,removeScore:!0,tournamentRecord:a,drawDefinition:s,matchUpId:l,event:o});if(u.error)return u;if(t.removeAssignments){let c=Kj({...t,matchUpId:l});if(c.error)return c}}return{...W}}function dWe({tournamentRecord:t,drawDefinition:e,finishingOrder:i}){if(!e)return{error:$e};let r="setOrderOfFinish";if(!Array.isArray(i))return q({info:qp("finishingOrder"),result:{error:re},stack:r});let{completedMatchUps:n,matchUpsMap:a}=Hv({inContext:!0,drawDefinition:e}),s=n?.map(vr)??[],o=i.map(vr),{matchUpTypes:l,roundNumbers:u,structureIds:c,matchUpTieIds:d}=(n??[]).filter(({matchUpId:v})=>o.includes(v)).reduce((v,w)=>{let{matchUpTieId:y,matchUpType:b,roundNumber:S,structureId:U}=w;return v.matchUpTypes.includes(b)||v.matchUpTypes.push(b),v.roundNumbers.includes(S)||v.roundNumbers.push(S),v.structureIds.includes(U)||v.structureIds.push(U),v.matchUpTieIds.includes(y)||v.matchUpTieIds.push(y),v},{matchUpTypes:[],roundNumbers:[],structureIds:[],matchUpTieIds:[]});if(l.length>1||d.length>1||u.length>1||c.length>1)return q({info:"matchUpType, structureId and roundNumber must be equivalent",result:{error:re},stack:r});let p,f,m={},h=[],g=[];if(!i.every(({orderOfFinish:v,matchUpId:w})=>(h.push(w),v&&g.push(v),m[w]=v,p=s.includes(w),f=v===void 0||lt(v)&&Math.floor(v)>0,p&&f)))return q({result:{error:p?re:Nv},info:!p&&"matchUps must be completed"||!f&&"orderOfFinish must be integer > 0 or undefined"||void 0,stack:r});let I=n?.filter(v=>v.structureId===c[0]&&v.roundNumber===u[0]&&v.matchUpType===l[0]&&v.matchUpTieId===d[0]&&!h.includes(v.matchUpId));for(let v of I??[]){let{orderOfFinish:w}=v||{};if(w){if(!lt(w))return q({context:{orderOfFinish:w,matchUp:v},result:{error:re},stack:r});g.push(w)}}if(dte(g).length!==g.length||Math.max(...g)>g.length)return q({info:"Values not unique or greater than expected number of values",result:{error:re},stack:r});if(c.length){let v=iN({matchUpFilters:{matchUpIds:o},structureId:c[0],drawDefinition:e,matchUpsMap:a});if(v.error)return q({result:v,stack:r});v.completedMatchUps?.forEach(w=>{w.orderOfFinish=m[w.matchUpId],Ut({tournamentId:t.tournamentId,context:"setOrderOfFinish",drawDefinition:e,matchUp:w})})}return{...W}}function jue(t){return dWe(t)}function Gue(t){let{tournamentRecord:e,drawDefinition:i,matchUpId:r,lineUps:n,event:a}=t,s="applyLineUps",o=He(t,[{[hr]:!0,[In]:!0,[Pl]:!0},{lineUps:!0,[qn]:sn}],s);if(o.error)return o;let l=e.participants||[],u=fi({tournamentParticipants:l,inContext:!0,drawDefinition:i,matchUpId:r});if(u.error)return u;if(!u.matchUp)return{error:dn};let{matchUp:c,structure:d}=u,{drawPositions:p,matchUpType:f}=c;if(f!==ei)return{error:oa};if(!p?.length)return{error:XS};let m=yn({matchUp:c,drawDefinition:i,structure:d,event:a})?.tieFormat,h={};for(let I of n){if(!Array.isArray(I))return{error:re,lineUp:I};let v={},w=[];for(let T of I){if(typeof T!="object")return{error:re,lineUpAssignment:T};let{participantId:P,collectionAssignments:D=[]}=T;if(!Array.isArray(D))return{error:re,collectionAssignments:D};let E=l.find(C=>C.participantId===P);if(!E)return{error:ji};if(E.participantType!==It)return{error:Mo};let R=c.sides?.find(C=>C.participant?.individualParticipantIds?.includes(P))?.sideNumber;R&&w.push(R);for(let C of D){if(typeof C!="object")return{error:re,collectionAssignment:C};let{collectionId:M,collectionPosition:N}=C,A=m?.collectionDefinitions?.find(F=>F.collectionId===M);if(!A)return{error:re,collectionId:M};let O=`${M}-${N}`;v[O]||(v[O]=[]);let k=v[O].length;if(Pi(zt)(A.matchUpType)&&k||A.matchUpType===Bt&&k>1)return{info:"Excessive collectionPosition assignments",error:re};v[O].push(P)}}let y=Object.values(v);for(let T of y)if(T.length===2){let{participant:P}=ro({tournamentParticipants:l,participantIds:T});if(!P){let D=Il({participant:{participantType:ft,participantRole:Jr,individualParticipantIds:T},pairOverride:!0,tournamentRecord:e});if(D.error)return D}}let b=Sa(w),S=(b[1]||0)>(b[2]||0)&&1||(b[2]||0)>(b[1]||0)&&2||void 0,U=Object.keys(h).map(T=>parseInt(T));S&&!U.includes(S)&&(h[S]=I)}if(!Object.keys(h).length)return{error:gB};if(u=fi({drawDefinition:i,matchUpId:r}),u.error)return u;if(!u.matchUp)return{error:dn};let{matchUp:g}=u;g.sides??=[];for(let I of[1,2]){let v=g.sides.find(y=>y.sideNumber===I),w=h[I];if(w)v?v.lineUp=w:g.sides.push({lineUp:w,sideNumber:I});else continue}return Ut({tournamentId:e?.tournamentId,context:s,drawDefinition:i,matchUp:g}),{...W}}var aG={};dt(aG,{anonymizeTournamentRecord:()=>dce,generate:()=>Hue,generateEventWithDraw:()=>cA,generateOutcome:()=>fG,generateOutcomeFromScoreString:()=>sG,generateParticipants:()=>oy,generateTournamentRecord:()=>uce,modifyTournamentRecord:()=>fce,mutate:()=>cce});var Hue={};dt(Hue,{generateEventWithDraw:()=>cA,generateOutcome:()=>fG,generateOutcomeFromScoreString:()=>sG,generateParticipants:()=>oy,generateTournamentRecord:()=>uce});function pWe(t){let e=t.reduce((i,r)=>((r.side1Score!==void 0||r.side2Score!==void 0)&&(i.side1+=r.side1Score??0,i.side2+=r.side2Score??0),i),{side1:0,side2:0});return e.side1>e.side2?1:e.side2>e.side1?2:t.find(i=>i.side1TiebreakScore!==void 0||i.side2TiebreakScore!==void 0)?.winningSide}function fWe(t){let e={side1:0,side2:0};if(t.forEach(i=>{i.winningSide===1?e.side1++:i.winningSide===2&&e.side2++}),e.side1>e.side2)return 1;if(e.side2>e.side1)return 2}function mWe(t,e,i){if(t||!e||!i)return t;let r=qi(e);return MN(r)?pWe(i):fWe(i)}function hWe(t,e,i){let r=QU({scoreString:t,matchUpFormat:e});return{sets:r,scoreStringSide1:Jl({sets:r,matchUpFormat:e,setTBlast:i}),scoreStringSide2:Jl({sets:r,reversed:!0,matchUpFormat:e,setTBlast:i})}}function gWe(t,e,i,r){let n=Jl({sets:t,matchUpFormat:i,setTBlast:r}),a=Jl({sets:t,reversed:!0,matchUpFormat:i,setTBlast:r});if(typeof n!="string")return n;if(typeof a!="string")return a;let s=e===2?a:n,o=e===2?n:a;return{sets:QU({scoreString:s,matchUpFormat:i}),scoreStringSide1:s,scoreStringSide2:o}}function sG(t){let{matchUpFormat:e,matchUpStatus:i,winningSide:r,scoreString:n,setTBlast:a,preserveSideOrder:s=!1}=t;if(!n)return{outcome:{...pN,winningSide:r,matchUpStatus:i}};if(r&&![1,2,void 0].includes(r))return{error:re,winningSide:r};let o=n&&QU({scoreString:n,matchUpFormat:e}),l=n?.trim().startsWith("["),u=mWe(r,e,o),c=qi(e),d=s||l||MN(c)?hWe(n,e,a):gWe(o,u,e,a);return je({outcome:{matchUpStatus:i,winningSide:u,score:d}})}function oG({matchUpScheduleTimes:t,matchUpDependencies:e,allDateMatchUpIds:i,matchUp:r}){let n=(e?.[r.matchUpId]?.matchUpIds||[]).filter(a=>i.includes(a)).filter(a=>!t[a]);return{dependenciesScheduled:!n?.length,remainingDependencies:n}}function sT({individualParticipantProfiles:t,participantId:e}){t[e]||(t[e]={typeChangeTimeAfterRecovery:void 0,timeAfterRecovery:void 0,priorMatchUpType:void 0,potentialRecovery:{},potentialCounted:{},potentialBookings:{},bookings:[],counters:{}})}function IWe({individualParticipantProfiles:t,recoveryValue:e,participantId:i,scheduleTime:r,drawId:n}){t[i].potentialRecovery[n]||(t[i].potentialRecovery[n]=[]),t[i].potentialRecovery[n].push(e),t[i].potentialBookings[n]||(t[i].potentialBookings[n]=[]),t[i].potentialBookings[n].push({timeAfterRecovery:e,scheduleTime:r})}function cw({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,typeChangeRecoveryMinutes:i,averageMatchUpMinutes:r=0,matchUpNotBeforeTimes:n,matchUpDependencies:a,recoveryMinutes:s=0,scheduleTime:o,matchUp:l}){let u=pi(l?.schedule?.endTime),c=u?Zn(u,Ke(s)):Zn(o,Ke(r)+Ke(s)),d=i&&(u?Zn(pi(u),i):Zn(o,Ke(r)+Ke(i))),p=a?.[l.matchUpId]?.participantIds||[],f=(l.roundPosition&&t[l.matchUpId]||[]).flat();p.forEach(m=>{sT({individualParticipantProfiles:e,participantId:m});let h=e[m].priorMatchUpType!==l.matchUpType&&d||c;f.includes(m)?IWe({individualParticipantProfiles:e,drawId:l.drawId,recoveryValue:h,participantId:m,scheduleTime:o}):(e[m].timeAfterRecovery=h,e[m].bookings.push({scheduleTime:o,timeAfterRecovery:h}))}),FI({matchUpPotentialParticipantIds:t,matchUpNotBeforeTimes:n,timeAfterRecovery:c,matchUp:l})}function Wue({matchUpScheduleTimes:t,matchUpDependencies:e,scheduleTime:i,matchUpId:r,details:n}){let a,s=n.minutesMap?.[r]?.recoveryMinutes,o=(n.minutesMap?.[r]?.averageMinutes||0)+(s||0),l=Zn(i,o),u=e?.[r]?.dependentMatchUpIds||[];if(u.length){let c=u.reduce((d,p)=>{let f=t[p];if(!f)return d;let m={scheduleTime:f,matchUpId:p};return f&&!d.matchUpId||Rt(f)<Rt(d.scheduleTime)?m:d},{});c.scheduleTime&&Rt(l)>Rt(c.scheduleTime)&&(a=c)}return{scheduledDependent:a}}function vWe(t){let{sides:e,matchUpType:i}=t||{};return(e||[]).map(r=>i===Bt&&(r?.participant?.individualParticipants||[])||r?.participant&&[r.participant]||[]).flat()}var oT="DO_NOT_SCHEDULE",yWe={DO_NOT_SCHEDULE:oT};function lG({averageMatchUpMinutes:t=90,requestConflicts:e={},potentials:i=!0,personRequests:r,scheduleTime:n,scheduleDate:a,matchUp:s}){let o=vWe(s).map(({person:f})=>f?.personId);if(i){let f=(s?.potentialParticipants||[]).flat().map(({person:m})=>m?.personId);o.push(...f)}let l=o.map(f=>r[f]?.map(m=>({...m,personId:f}))).filter(Boolean).flat().filter(f=>f.requestType===oT&&pu(a,f.date)),u=[],c=s?.matchUpId,d=Ji(pi(n),Ze(a)),p=pi(MB(d,t).toISOString());for(let f of l){let{requestId:m,startTime:h,endTime:g}=f;(n>h&&n<g||p&&p>h&&p<g)&&(u.push({matchUpId:c,request:f,scheduleTime:n}),e[m]?(e[m].scheduleTimes.includes(n)||e[m].scheduleTimes.push(n),e[m].matchUpIds.includes(c)||e[m].matchUpIds.push(c)):e[m]={request:f,scheduleTimes:[n],matchUpIds:[c]})}return{conflicts:u}}function Zx({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,matchUp:i,value:r}){let{matchUpType:n}=i,{individualParticipantIds:a}=WM(i),s=(t[i.matchUpId]||[]).filter(o=>!xn(o,a)).flat();[...a,...s].forEach(o=>{if(sT({individualParticipantProfiles:e,participantId:o}),!e[o].potentialCounted[i.drawId]){let l=e[o].counters;l[n]?l[n]+=r:r>0&&(l[n]=r),l[Hs]?l[Hs]+=r:r>0&&(l[Hs]=r),s.includes(o)&&(e[o].potentialCounted[i.drawId]=!0)}})}function bWe({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,dateScheduledMatchUpIds:i,greatestAverageMinutes:r,dateScheduledMatchUps:n,matchUpNotBeforeTimes:a,matchUpScheduleTimes:s,matchUpDependencies:o,clearScheduleDates:l,scheduleDate:u,minutesMap:c,matchUps:d}){let p=[];i||(n=d?.filter(h=>{let g=h.schedule||{},I=h.matchUpStatus==="BYE";return I&&p.push({tournamentId:h.tournamentId,matchUpId:h.matchUpId}),!I&&tT({schedule:g})&&(!u||h.schedule.scheduledDate===u)}),i=n.map(vr));let f=Array.isArray(l)?l.includes(u):l,m=f?[]:d.filter(({matchUpId:h})=>i.includes(h));for(let h of m){Zx({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,value:1,matchUp:h});let g=h.schedule?.scheduledTime;if(g){s[h.matchUpId]=g;let I=c?.[h.matchUpId]?.recoveryMinutes;cw({individualParticipantProfiles:e,matchUpPotentialParticipantIds:t,matchUpNotBeforeTimes:a,matchUpDependencies:o,averageMatchUpMinutes:r,recoveryMinutes:I,scheduleTime:g,matchUp:h})}}return{dateScheduledMatchUpIds:i,byeScheduledMatchUpDetails:p,dateScheduledMatchUps:n,clearDate:f}}function aA({defaultRecoveryMinutes:t=0,averageMatchUpMinutes:e=90,dateScheduledMatchUps:i,tournamentRecords:r,venueIds:n=[],periodLength:a,scheduleDate:s,matchUps:o}){if(typeof r!="object")return{error:Mi};if(!Ka(o)&&!Array.isArray(i))return{error:Nu};a=a??QN({recoveryMinutes:t,averageMatchUpMinutes:e});let l=Object.assign({},...Object.values(r).flatMap(d=>(d.events??[]).map(p=>{let{scheduleTiming:f}=yU({tournamentRecord:d,event:p});return{[p.eventId]:{event:p,scheduleTiming:f}}}))),u={averageTimes:[{minutes:{default:e}}],recoveryTimes:[{minutes:{default:t}}]};i??=o?.filter(d=>{let p=d.schedule;return tT({schedule:p})&&(!s||d.schedule.scheduledDate===s)});let c=i?.filter(d=>(!n.length||n.includes(d.schedule.venueId))&&d.matchUpStatus!=="BYE");return{bookings:c?.map(({eventId:d,schedule:p,matchUpFormat:f})=>{let{event:m,scheduleTiming:h}=l[d],g=m?.eventType,I={...h,defaultTiming:u,matchUpFormat:f},{averageMinutes:v,recoveryMinutes:w}=JM({timingDetails:I,eventType:g}),{courtId:y,venueId:b}=p,S=pi(p.scheduledTime),U=Zn(S,v);return{recoveryMinutes:w,averageMinutes:v,periodLength:a,startTime:S,courtId:y,endTime:U,venueId:b}}).filter(Boolean),relevantMatchUps:c,dateScheduledMatchUps:i}}function wWe({calculateStartTimeFromCourts:t=!0,remainingScheduleTimes:e,defaultRecoveryMinutes:i,averageMatchUpMinutes:r,clearScheduleDates:n,tournamentRecords:a,tournamentRecord:s,periodLength:o,scheduleDate:l,startTime:u,venueIds:c,matchUps:d,endTime:p}){if(s&&!a&&(a={[s.tournamentId]:s}),typeof a!="object"||!Object.keys(a).length)return{error:Mi};o=o??QN({recoveryMinutes:i,averageMatchUpMinutes:r});let{courts:f,venues:m}=Fu({dates:[l],ignoreDisabled:!0,tournamentRecords:a}),h=f?.filter(b=>!c||c.includes(b.venueId))??[];u=u??LI({courts:h,scheduleDate:l,startTime:!0}),p=p??LI({courts:h,scheduleDate:l,endTime:!0});let{bookings:g,dateScheduledMatchUps:I}=aA({defaultRecoveryMinutes:i,averageMatchUpMinutes:r,tournamentRecords:a,scheduleDate:l,periodLength:o,venueIds:c,matchUps:d}),v={calculateStartTimeFromCourts:t,remainingScheduleTimes:e,averageMatchUpMinutes:r,clearScheduleDates:n,date:l,periodLength:o,startTime:u,bookings:g,endTime:p,courts:h},{scheduleTimes:w}=Hj(v),y=c?.length===1&&c[0]||m?.length===1&&m[0].venueId||void 0;return{dateScheduledMatchUpIds:I?.map(Pa("matchUpId")),dateScheduledMatchUps:I,scheduleTimes:w,venueId:y}}function SWe({scheduledRoundsDetails:t,greatestAverageMinutes:e,garmanSinglePass:i}){let r=[],n=[],a,s,o,l;for(let u of t.filter(Boolean))l||(l=u.hash),(u.hash===l||i)&&(n=n.concat(u.matchUpIds)),u.hash,o=e,s=u.recoveryMinutes,a=u.roundPeriodLength;return n.length&&r.push({matchUpIds:n,roundPeriodLength:a,recoveryMinutes:s,averageMinutes:o}),{groupedRounds:r}}function zue({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,scheduleCompletedMatchUps:i,containedStructureIds:r,matchUpNotBeforeTimes:n,matchUpScheduleTimes:a,matchUpDependencies:s,clearScheduleDates:o,tournamentRecords:l,periodLength:u,scheduleDate:c,useGarman:d,matchUps:p,courts:f,venues:m}){let h={},g=[],I=[],v=[];for(let w of m){let{rounds:y=[],venueId:b}=w,{scheduledRoundsDetails:S,greatestAverageMinutes:U,orderedMatchUpIds:T,minutesMap:P}=ZU({scheduleCompletedMatchUps:i,containedStructureIds:r,tournamentRecords:l,periodLength:u,matchUps:p,rounds:y});v.push(...T??[]);let{groupedRounds:D}=SWe({scheduledRoundsDetails:S,greatestAverageMinutes:U,garmanSinglePass:!0}),E,R=[];d&&({scheduleTimes:R,dateScheduledMatchUpIds:E}=wWe({averageMatchUpMinutes:D[0]?.averageMinutes,scheduleDate:Ze(c),venueIds:[w.venueId],clearScheduleDates:o,tournamentRecords:l,periodLength:u,matchUps:p}));let C=bWe({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,dateScheduledMatchUpIds:E,greatestAverageMinutes:U,matchUpNotBeforeTimes:n,matchUpScheduleTimes:a,matchUpDependencies:s,clearScheduleDates:o,scheduleDate:c,minutesMap:P,matchUps:p});({dateScheduledMatchUpIds:E}=C);let M=C,{byeScheduledMatchUpDetails:N,clearDate:A}=C;N?.length&&I.push(...N);let{matchUpsToSchedule:O,matchUpMap:k}=LN({matchUpPotentialParticipantIds:t,scheduleCompletedMatchUps:i,dateScheduledMatchUpIds:E,matchUpNotBeforeTimes:n,matchUpScheduleTimes:a,orderedMatchUpIds:T,clearDate:A,matchUps:p}),F=f.filter(x=>x.venueId===b);h[b]={previousRemainingScheduleTimes:[],courtsCount:F.length,greatestAverageMinutes:U,scheduledRoundsDetails:S,dateScheduledMatchUps:M,matchUpsToSchedule:O,scheduleTimes:R,groupedRounds:D,venueCourts:F,minutesMap:P,matchUpMap:k},o||g.push(...E)}return{allDateScheduledByeMatchUpDetails:I,allDateScheduledMatchUpIds:g,venueScheduledRoundDetails:h,allDateMatchUpIds:v}}function UWe(t,e){let i=Rt(t.scheduleTime),r=Rt(t.timeAfterRecovery),n=Rt(e.scheduleTime),a=Rt(e.timeAfterRecovery),s=i===n||r===a,o=i>n&&i<a,l=n>i&&n<r,u=r>n&&r<a,c=a>i&&a<r;return je({hasOverlap:s||o||u||l||c,startAisContained:o,endAisContained:u,startBisContained:l,endBisContained:c},!0)}function uG({individualParticipantProfiles:t,matchUpNotBeforeTimes:e,matchUpDependencies:i,scheduleTime:r,matchUp:n,details:a}){let s=(i?.[n.matchUpId]?.participantIds||[]).flat(),o=a?.minutesMap?.[n.matchUpId]?.averageMinutes||0,l=a?.minutesMap?.[n.matchUpId]?.recoveryMinutes||0,u=s.every(p=>{sT({individualParticipantProfiles:t,participantId:p});let f=t[p];if(!f.timeAfterRecovery)return!0;let m=pi(n?.schedule?.endTime),h=m?Zn(m,Ke(l)):Zn(r,Ke(o)+Ke(l));return![...Object.keys(f.potentialBookings).filter(g=>g!==n.drawId).map(g=>f.potentialBookings[g]).flat(),...f.bookings].find(g=>UWe({scheduleTime:r,timeAfterRecovery:h},g).hasOverlap)}),c=e[n.matchUpId],d=(c?nU(Ji(c),Ji(r),!1):0)>=0;return{enoughTime:u&&d}}function que({autoSchedulingAudit:t,tournamentRecords:e}){st({topic:ec,payload:t});let i=s=>s?Object.values(s).reduce((o,l)=>o+l.length||0,0):0,r=(t?.schedulingProfile||[]).reduce((s,o)=>s+o.venues.reduce((l,u)=>l+u.rounds.length,0),0),n={scheduledDatesCount:t.scheduledDates?.length,noTimeMatchUpIdsCount:i(t?.noTimeMatchUpIds),scheduledMatchUpIdsCount:i(t?.scheduledMatchUpIds),overLimitMatchUpIdsCount:i(t?.overLimitMatchUpIds),requestConflictsCount:i(t?.requestConflicts),profileRoundsCount:r},a={itemType:Xx,itemValue:n};for(let s of Object.values(e)){let o=s.tournamentId;wM(ec)?st({payload:{type:Xx,tournamentId:o,detail:n},topic:ec}):zU({tournamentRecord:s,timeItem:a})}}function cG({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,matchUpDailyLimits:i={},matchUp:r}){let{enteredIndividualParticipantIds:n}=WM(r),{matchUpId:a,matchUpType:s}=r,o=(r.roundPosition&&t[a]||[]).flat(),l=nt(n.concat(...o));return l.forEach(u=>{sT({individualParticipantProfiles:e,participantId:u})}),{participantIdsAtLimit:l.filter(u=>{let c=e[u];if(c)return[s,Hs].find(d=>{let p=c.counters?.[d]||0,f=i[d]||0;return p&&f&&p>=f})}),relevantParticipantIds:l}}function dw({scheduleCompletedMatchUps:t=!1,scheduleByeMatchUps:e=!1,errorOnAnachronism:i=!1,checkChronology:r=!0,matchUpDependencies:n,removePriorValues:a,tournamentRecords:s,tournamentRecord:o,matchUpDetails:l,matchUpIds:u,schedule:c}){if(!o)return{error:ve};if(!l&&(!u||!Array.isArray(u)))return{error:Nh};if(!l&&(!c||typeof c!="object"))return{error:bie};let d,p=[],f=0;if(r&&!n){let g=co({tournamentRecords:s,tournamentRecord:o});n=g.matchUpDependencies,d=g.matchUps}d||(d=Ur({tournamentRecord:o})?.matchUps??[]);let m=d.reduce((g,I)=>{let{matchUpId:v,drawId:w,matchUpStatus:y}=I;return(e||y!=="BYE")&&(t||!Ki.includes(y))&&(g[w]?g[w].push(v):g[w]=[v]),g},{}),h=l?.map(g=>g.matchUpId);for(let g of Object.keys(m)){let{drawDefinition:I}=ep({tournamentRecord:o,drawId:g});if(!I)continue;let v=m[g].filter(y=>u?.includes(y)??h?.includes(y)),w=An({inContext:!1,drawDefinition:I}).matchUps;for(let y of v){let b=l?.find(U=>U.matchUpId===y)?.schedule||c,S=nA({schedule:b,matchUpDependencies:n,errorOnAnachronism:i,removePriorValues:a,inContextMatchUps:d,tournamentRecords:s,tournamentRecord:o,checkChronology:r,drawDefinition:I,drawMatchUps:w,matchUpId:y});if(S?.warnings?.length&&p.push(...S.warnings),S?.success&&(f+=1),S.error)return S}}return p.length?{...W,scheduled:f,warnings:p}:{...W,scheduled:f}}function lT(t){let{scheduleCompletedMatchUps:e=!1,scheduleByeMatchUps:i=!1,errorOnAnachronism:r,matchUpContextIds:n,removePriorValues:a,tournamentRecords:s,checkChronology:o,matchUpDetails:l,schedule:u}=t;if(t.matchUpIds&&!n)return dw(t);let c=He(t,[{[pn]:!0},{[RI]:{matchUpContextIds:!1,matchUpDetails:!1},[Ba]:re,[qn]:sn}]);if(c.error)return c;if((!l||n)&&!u)return{error:Je,info:"schedule is required"};let d=[],p=0,{matchUpDependencies:f}=co({tournamentRecords:s});for(let m of Object.values(s)){let{tournamentId:h}=m,g=n?.filter(v=>v.tournamentId===h).map(vr),I=l?.filter(v=>v?.tournamentId===h);if(g?.length||I?.length){let v=dw({matchUpDetails:I,scheduleCompletedMatchUps:e,scheduleByeMatchUps:i,matchUpDependencies:f,errorOnAnachronism:r,removePriorValues:a,tournamentRecords:s,tournamentRecord:m,checkChronology:o,matchUpIds:g,schedule:u});if(v.warnings?.length&&d.push(...v.warnings),v.scheduled&&(p+=v.scheduled),v.error)return v}}return d.length?{...W,scheduled:p,warnings:d}:{...W,scheduled:p}}function TWe({schedulingProfileModifications:t,checkPotentialRequestConflicts:e,scheduleCompletedMatchUps:i,schedulingProfileIssues:r,dateSchedulingProfiles:n,containedStructureIds:a,matchUpDependencies:s,matchUpDailyLimits:o,clearScheduleDates:l,tournamentRecords:u,schedulingProfile:c,personRequests:d,periodLength:p,matchUps:f,courts:m,dryRun:h}){let g={},I={},v={},w={},y={},b={},S={},U={},T={},P={};for(let R of n){let C=Ze(R?.scheduleDate),M=R?.venues||[],N={},A={},O=(G,j)=>{G.forEach(K=>{let Y=A[K].counters;Y[j]?Y[j]+=1:Y[j]=1,Y[Hs]?Y[Hs]+=1:Y[Hs]=1})};v[C]={},w[C]={},g[C]={},I[C]={},S[C]=[],U[C]=[],T[C]=[],P[C]=[];let k={};f.forEach(G=>{G.schedule?.scheduledDate&&pu(C,Ze(G.schedule.scheduledDate))&&FI({matchUpPotentialParticipantIds:N,matchUpNotBeforeTimes:k,matchUp:G})});let{allDateScheduledByeMatchUpDetails:F,venueScheduledRoundDetails:x,allDateMatchUpIds:L}=zue({matchUpPotentialParticipantIds:N,individualParticipantProfiles:A,scheduleCompletedMatchUps:i,containedStructureIds:a,matchUpNotBeforeTimes:k,matchUpScheduleTimes:b,matchUpDependencies:s,clearScheduleDates:l,tournamentRecords:u,useGarman:!0,periodLength:p,scheduleDate:C,matchUps:f,courts:m,venues:M}),$=10,V=0,_,B=10;for(;!_;){for(let{venueId:G}of M){let j=0,K=x[G];for(;K.courtsCount&&K.scheduleTimes?.length&&K.matchUpsToSchedule?.length&&j<=K.courtsCount;){let{scheduleTime:Y,attempts:X=0}=K.scheduleTimes.shift(),Z=K.matchUpsToSchedule.find(J=>{let{matchUpId:ae,matchUpType:te}=J,{participantIdsAtLimit:ne,relevantParticipantIds:le}=cG({matchUpPotentialParticipantIds:N,individualParticipantProfiles:A,matchUpDailyLimits:o,matchUp:J});if(ne.length)return U[C].includes(ae)||U[C].push(ae),!1;let{scheduledDependent:de}=Wue({matchUpScheduleTimes:b,matchUpDependencies:s,scheduleTime:Y,matchUpId:ae,details:K});if(de)return!1;let{dependenciesScheduled:pe,remainingDependencies:ge}=oG({matchUpScheduleTimes:b,matchUpDependencies:s,allDateMatchUpIds:L,matchUp:J});if(!pe)return w[C][ae]||(w[C][ae]=[]),w[C][ae].push({scheduleTime:Y,remainingDependencies:ge}),!1;let{enoughTime:Me}=uG({individualParticipantProfiles:A,matchUpNotBeforeTimes:k,matchUpDependencies:s,scheduleTime:Y,details:K,matchUp:J});if(!Me)return v[C][ae]||(v[C][ae]=[]),v[C][ae].push({scheduleTime:Y}),!1;let Pe=K.greatestAverageMinutes,{conflicts:Be}=lG({potentials:e,averageMatchUpMinutes:Pe,requestConflicts:P,personRequests:d,scheduleTime:Y,scheduleDate:C,matchUp:J});if(Be?.length)return y[C]||(y[C]=[]),y[C].push(...Be),!1;O(le,te);let fe=K.minutesMap?.[ae]?.recoveryMinutes;return cw({matchUpPotentialParticipantIds:N,individualParticipantProfiles:A,matchUpNotBeforeTimes:k,averageMatchUpMinutes:Pe,matchUpDependencies:s,recoveryMinutes:fe,scheduleTime:Y,matchUp:J}),b[ae]=Y,!0});K.matchUpsToSchedule=K.matchUpsToSchedule.filter(({matchUpId:J})=>J!==Z?.matchUpId),Z?j+=1:(I[C][G]||(I[C][G]=[]),I[C][G].push({scheduleTime:Y,attempts:X+1}))}K.matchUpsToSchedule?.length&&(I[C][G]=I[C][G]?.filter(Y=>{let X=Y.attempts<$;return X&&K.scheduleTimes.push(Y),!X})),(!K.scheduleTimes?.length||!K.matchUpsToSchedule?.length)&&(K.complete=!0)}V+=1,_=M.every(({venueId:G})=>x[G].complete)||V===B}for(let{venueId:G}of M){let j=x[G].matchUpMap;Object.keys(j).forEach(K=>{let Y=u[K];Y&&Object.keys(j[K]).forEach(X=>{let{drawDefinition:Z}=ep({tournamentRecord:Y,drawId:X});Z&&j[K][X].forEach(({matchUpId:J})=>{let ae=b[J];if(ae){let te=ae.split(":").map(as).join(":"),ne=`${Ze(C)}T${te}`;h?S[C].push(J):(tp({drawDefinition:Z,scheduledTime:ne,matchUpId:J}).success&&S[C].push(J),G&&sy({tournamentRecord:Y,drawDefinition:Z,matchUpId:J,venueId:G}))}})})}),T[C]=x[G].matchUpsToSchedule.map(vr),g[C][G]=x[G].scheduleTimes.sort((K,Y)=>Rt(K.scheduleTime)-Rt(Y.scheduleTime))}!h&&F?.length&&lT({matchUpDetails:F,scheduleByeMatchUps:!0,removePriorValues:!0,tournamentRecords:u,schedule:{scheduledDate:"",scheduledTime:"",courtOrder:"",courtId:"",venueId:""}});for(let G of R.venues)for(let j of G.rounds){let K=(j.matchUps?.map(({matchUpId:X})=>X)||[]).filter(X=>S[C].includes(X));j.canScheduledMatchUpIds=K;let Y=Math.round(K.length/j.matchUpsCount*1e4)/100;(Y===1/0||isNaN(Y))&&(Y=0),j.possibleToSchedulePct=Y,j.matchUpsCount===K.length&&(j.possibleToSchedule=!0)}}let D=n.map(({scheduleDate:R})=>R),E={timeStamp:Date.now(),overLimitMatchUpIds:U,scheduledMatchUpIds:S,schedulingProfile:c,noTimeMatchUpIds:T,requestConflicts:P,scheduledDates:D};return que({tournamentRecords:u,autoSchedulingAudit:E}),{...W,schedulingProfileModifications:t,schedulingProfileIssues:r,scheduleTimesRemaining:g,dateSchedulingProfiles:n,skippedScheduleTimes:I,recoveryTimeDeferredMatchUpIds:v,dependencyDeferredMatchUpIds:w,matchUpScheduleTimes:b,overLimitMatchUpIds:U,scheduledMatchUpIds:S,noTimeMatchUpIds:T,requestConflicts:P,scheduledDates:D}}function Kq({averageMinutes:t,startTime:e,endTime:i,court:r,date:n}){if(!Array.isArray(r.dateAvailability))return{error:Je,stack:"getEarliestCourtTime"};let a=LI({scheduleDate:n,courts:[r],startTime:!0}),s=LI({scheduleDate:n,courts:[r],endTime:!0});e=e||a,i=i||s;let o=Md({court:r,date:n}),{timeSlots:l}=ny({courtDate:o}),u=Ji(e),c=Ji(i);return{earliestCourtTime:l?.reduce((d,p)=>{let f=Ji(p.startTime),m=Ji(p.endTime);if(f>c||m<u)return d;let h=u>f?u:f;if(nU(h,m)>=t){let g=pi(h.toISOString());g&&(!d||g<d)&&(d=g)}return d},void 0),courtStartTime:a,courtEndTime:s}}function DWe({schedulingProfileModifications:t,checkPotentialRequestConflicts:e,scheduleCompletedMatchUps:i,schedulingProfileIssues:r,dateSchedulingProfiles:n,containedStructureIds:a,matchUpDependencies:s,matchUpDailyLimits:o,clearScheduleDates:l,tournamentRecords:u,periodLength:c=30,schedulingProfile:d,personRequests:p,matchUps:f=[],courts:m,dryRun:h}){let g={},I={},v={},w={},y={},b={},S={},U={},T={};for(let E of n??[]){let R=Ze(E?.scheduleDate),C=E?.venues||[],M={},N={},A=(Z,J)=>{Z.forEach(ae=>{let te=N[ae].counters;te[J]?te[J]+=1:te[J]=1,te[Hs]?te[Hs]+=1:te[Hs]=1})};g[R]={},I[R]={},b[R]=[],S[R]=[],U[R]=[],T[R]=[];let O={};f?.forEach(Z=>{Z.schedule?.scheduledDate&&pu(R,Ze(Z.schedule.scheduledDate))&&FI({matchUpPotentialParticipantIds:M,matchUpNotBeforeTimes:O,matchUp:Z})});let{allDateScheduledByeMatchUpDetails:k,allDateScheduledMatchUpIds:F,venueScheduledRoundDetails:x,allDateMatchUpIds:L}=zue({matchUpPotentialParticipantIds:M,individualParticipantProfiles:N,scheduleCompletedMatchUps:i,containedStructureIds:a,matchUpNotBeforeTimes:O,matchUpScheduleTimes:y,matchUpDependencies:s,clearScheduleDates:l,tournamentRecords:u,periodLength:c,scheduleDate:R,matchUps:f,courts:m,venues:C}),$=f?.filter(({matchUpId:Z})=>F.includes(Z)),{bookings:V}=aA({dateScheduledMatchUps:$,tournamentRecords:u,scheduleDate:R,periodLength:c}),{virtualCourts:_}=JN({scheduleDate:R,periodLength:c,bookings:V,courts:m}),B=_?.reduce((Z,J)=>{let{earliestCourtTime:ae,courtEndTime:te}=Kq({date:R,averageMinutes:0,court:J});return(!Z.startTime||Ji(ae)<Ji(Z.startTime))&&(Z.startTime=ae),(!Z.endTime||Ji(te)>Ji(Z.endTime))&&(Z.endTime=te),Z},{}),G=B.startTime,j=({courtId:Z,booking:J})=>_?.find(ae=>ae.courtId===Z)?.dateAvailability[0].bookings.push(J),K=10,Y=0,X;for(;!X;){for(let{venueId:Z}of C){let J=x[Z],ae=J.matchUpsToSchedule.length,te=[],ne=[],le,de=0;for(;!le;){for(let pe of J.matchUpsToSchedule){if(ne.length===J.courtsCount||te.length===J.courtsCount){le=!0;break}let{matchUpId:ge,matchUpType:Me}=pe,{participantIdsAtLimit:Pe,relevantParticipantIds:Be}=cG({matchUpPotentialParticipantIds:M,individualParticipantProfiles:N,matchUpDailyLimits:o,matchUp:pe});if(Pe.length){S[R].includes(ge)||S[R].push(ge);continue}let{dependenciesScheduled:fe,remainingDependencies:Te}=oG({matchUpScheduleTimes:y,matchUpDependencies:s,allDateMatchUpIds:L,matchUp:pe});if(!fe){I[R][ge]||(I[R][ge]=[]),I[R][ge].push({remainingDependencies:Te});continue}let ce=[],ye=_?.reduce((be,Fe)=>{if(ne.includes(Fe.courtId))return be;let{earliestCourtTime:we}=Kq({averageMinutes:J.greatestAverageMinutes,startTime:G,date:R,court:Fe});if(be.scheduleTime&&Rt(we)>=Rt(be.scheduleTime))return be;let{scheduledDependent:Ne}=Wue({matchUpScheduleTimes:y,matchUpDependencies:s,scheduleTime:we,matchUpId:ge,details:J});if(Ne)return be;let{enoughTime:me}=uG({individualParticipantProfiles:N,matchUpNotBeforeTimes:O,matchUpDependencies:s,scheduleTime:we,details:J,matchUp:pe});if(!me)return g[R][ge]||(g[R][ge]=[]),g[R][ge].includes(we)||g[R][ge].push(we),be;let Ee=J.minutesMap?.[ge]?.averageMinutes||J.greatestAverageMinutes,{conflicts:Le}=lG({potentials:e,averageMatchUpMinutes:Ee,requestConflicts:T,personRequests:p,scheduleTime:we,scheduleDate:R,matchUp:pe});if(Le?.length)return ce.push(...Le),!1;A(Be,Me);let Q=J.minutesMap?.[ge]?.recoveryMinutes;return cw({matchUpPotentialParticipantIds:M,individualParticipantProfiles:N,matchUpNotBeforeTimes:O,averageMatchUpMinutes:Ee,matchUpDependencies:s,recoveryMinutes:Q,scheduleTime:we,matchUp:pe}),(!be.scheduleTime||Rt(we)<Rt(be.scheduleTime))&&(be.averageMatchUpMinutes=Ee,be.recoveryMinutes=Q,be.scheduleTime=we,be.courtName=Fe.courtName,be.courtId=Fe.courtId),be},{});if(ye.scheduleTime){let{averageMatchUpMinutes:be,recoveryMinutes:Fe,scheduleTime:we,courtId:Ne}=ye;y[ge]=we,w[ge]=Ne,te.push(ge),ne.push(Ne);let me=we,Ee=Zn(me,be);j({courtId:Ne,booking:{averageMatchUpMinutes:be,recoveryMinutes:Fe,periodLength:c,matchUpId:ge,startTime:me,courtId:Ne,endTime:Ee,venueId:Z}}),J.matchUpsToSchedule=J.matchUpsToSchedule.filter(Le=>Le.matchUpId!==ge)}else ce?.length&&(v[R]||(v[R]=[]),v[R].push(...ce))}(ne.length===J.courtsCount||te.length===J.courtsCount||!J.matchUpsToSchedule.length)&&(le=!0),J.matchUpsToSchedule.length&&te<J.courtsCount&&(Ji(G)<Ji(B.endTime)?G=Zn(G,c):(le=!0,J.complete=!0)),de+=1,!le&&de>=ae&&(le=!0)}J.matchUpsToSchedule?.length||(J.complete=!0)}Y+=1,X=C.every(({venueId:Z})=>x[Z].complete)||Y===K}for(let{venueId:Z}of C){let J=x[Z].matchUpMap;Object.keys(J).forEach(ae=>{let te=u[ae];te&&Object.keys(J[ae]).forEach(ne=>{let{drawDefinition:le}=ep({tournamentRecord:te,drawId:ne});le&&J[ae][ne].forEach(({matchUpId:de})=>{let pe=y[de],ge=w[de];if(pe){let Me=pe.split(":").map(as).join(":"),Pe=`${Ze(R)}T${Me}`;h||(tp({drawDefinition:le,scheduledTime:Pe,matchUpId:de}),rg({courtDayDate:R,tournamentRecords:u,tournamentRecord:te,drawDefinition:le,matchUpId:de,courtId:ge})),b[R].push(de)}})})}),U[R]=x[Z].matchUpsToSchedule.map(vr)}!h&&k?.length&&lT({matchUpDetails:k,scheduleByeMatchUps:!0,removePriorValues:!0,tournamentRecords:u,schedule:{scheduledDate:"",scheduledTime:"",courtOrder:"",courtId:"",venueId:""}});for(let Z of E.venues)for(let J of Z.rounds){let ae=(J.matchUps??[]).map(({matchUpId:ne})=>ne)?.filter(ne=>b[R].includes(ne));J.canScheduledMatchUpIds=ae;let te=Math.round((ae?.length||0)/J.matchUpsCount*1e4)/100;(te===1/0||isNaN(te))&&(te=void 0),J.possibleToSchedulePct=te,J.matchUpsCount===ae?.length&&(J.possibleToSchedule=!0)}}let P=(n??[]).map(({scheduleDate:E})=>E),D={timeStamp:Date.now(),overLimitMatchUpIds:S,scheduledMatchUpIds:b,schedulingProfile:d,noTimeMatchUpIds:U,requestConflicts:T,scheduledDates:P};return que({tournamentRecords:u,autoSchedulingAudit:D}),{...W,schedulingProfileModifications:t,schedulingProfileIssues:r,dateSchedulingProfiles:n,recoveryTimeDeferredMatchUpIds:g,dependencyDeferredMatchUpIds:I,matchUpScheduleTimes:y,overLimitMatchUpIds:S,scheduledMatchUpIds:b,noTimeMatchUpIds:U,requestConflicts:T,scheduledDates:P}}function sA(t){let{scheduleAttributes:e=["scheduledDate","scheduledTime","courtOrder"],ignoreMatchUpStatuses:i=Ki,scheduledDates:r,venueIds:n}=t,a=ws(t),s=wt(a)?Object.values(a).map(({tournamentId:l})=>l).filter(Boolean):[];if(!s?.length)return{error:Mi};let o=0;for(let l of s){let u=a[l],c=PWe({ignoreMatchUpStatuses:i,scheduleAttributes:e,tournamentRecord:u,scheduledDates:r,venueIds:n});if(c.error)return c;o+=c.clearedScheduleCount??0}return{...W,clearedScheduleCount:o}}function PWe({scheduleAttributes:t=["scheduledDate","scheduledTime","courtOrder"],ignoreMatchUpStatuses:e=Ki,tournamentRecord:i,scheduledDates:r,venueIds:n=[]}){if(typeof i!="object")return{error:ve};if(!Array.isArray(e)||!Array.isArray(n))return{error:re};n.length&&t.push("venueId");let a=Ur({matchUpFilters:{scheduledDates:r},tournamentRecord:i}).matchUps??[],s={};a.forEach(({matchUpStatus:u,schedule:c,drawId:d,matchUpId:p})=>{(!u||!e.includes(u))&&tT({schedule:c,scheduleAttributes:t})&&(!n?.length||n.includes(c.venueId))&&(s[d]||(s[d]=[]),s[d].push(p))});let o=i.tournamentId,l=0;for(let u in s){let{event:c,drawDefinition:d}=Wn({tournamentRecord:i,drawId:u}),p=An({drawDefinition:d,matchUpFilters:{matchUpIds:s[u]}}).matchUps??[];for(let f of p){let m=!1;f.timeItems=(f.timeItems??[]).filter(h=>{let g=h?.itemType&&![wu,Ed,jh,KM,Gh,Hh].includes(h?.itemType);return g||(m=!0),g}),m&&(Ut({context:"clear schedules",eventId:c?.eventId,drawDefinition:d,tournamentId:o,matchUp:f}),l+=1)}}return{...W,clearedScheduleCount:l}}function oA(t){let{checkPotentialRequestConflicts:e=!0,scheduleCompletedMatchUps:i,clearScheduleDates:r,scheduleDates:n=[],tournamentRecords:a,periodLength:s,useGarman:o,dryRun:l,pro:u}=t,c=He(t,[{[pn]:!0},{[qr]:P=>!P||Array.isArray(P)&&P.every(Mn),[qre]:!1,[qn]:sn}]);if(c.error)return c;let d=zc({tournamentRecords:a});if(d.error)return d;if(!d.schedulingProfile.length)return{...W};let{modifications:p,issues:f=[],schedulingProfile:m=[]}=d,h=Object.assign({},...Object.values(a).map(P=>jv({tournamentRecord:P}).containedStructures)),g=new Set(n.map(P=>{if(Mn(P))return Ze(P)}).filter(Boolean)),I=m.map(P=>P.scheduleDate).map(P=>Mn(P)&&Ze(P)).filter(P=>P&&(!n.length||g.has(P)));if(!I.length)return{error:Yte};if(r&&!l){let P=Array.isArray(r)?r:[];sA({tournamentRecords:a,scheduledDates:P})}let v=Fu({ignoreDisabled:!1,tournamentRecords:a}).courts,{matchUps:w}=No({matchUpFilters:{matchUpTypes:[zt,Bt]},afterRecoveryTimes:!0,nextMatchUps:!0,tournamentRecords:a}),{matchUpDependencies:y}=co({includeParticipantDependencies:!0,tournamentRecords:a,matchUps:w}),{matchUpDailyLimits:b}=zN({tournamentRecords:a}),{personRequests:S}=Ef({requestType:oT,tournamentRecords:a}),U=m.filter(P=>{let D=Ze(P?.scheduleDate);return I.includes(D)}).sort((P,D)=>new Date(P.scheduleDate).getTime()-new Date(D.scheduleDate).getTime()),T={schedulingProfileModifications:p,checkPotentialRequestConflicts:e,scheduleCompletedMatchUps:i,schedulingProfileIssues:f,dateSchedulingProfiles:U,containedStructureIds:h,matchUpDependencies:y,matchUpDailyLimits:b,clearScheduleDates:r,tournamentRecords:a,schedulingProfile:m,personRequests:S,periodLength:s,matchUps:w,dryRun:l,courts:v};return u?DWe(T):TWe(T)}function lA(t){if(!t||typeof t!="string")return!1;try{return Intl.DateTimeFormat(void 0,{timeZone:t}),!0}catch{return!1}}function e1(t,e){let i=e??new Date,r=new Intl.DateTimeFormat("en-US",{timeZone:t,timeZoneName:"longOffset"}).formatToParts(i).find(l=>l.type==="timeZoneName")?.value??"";if(r==="GMT")return 0;let n=r.match(/GMT([+-])(\d{2}):(\d{2})/);if(!n)return 0;let a=n[1]==="+"?1:-1,s=Number.parseInt(n[2],10),o=Number.parseInt(n[3],10);return a*(s*60+o)}function Yue(t,e,i){if(!lA(i))return{error:dM};let[r,n]=e.split(":").map(Number),[a,s,o]=t.split("-").map(Number),l=new Date(Date.UTC(a,s-1,o,r,n,0,0)),u=e1(i,l),c=l.getTime()-u*60*1e3,d=new Date(c),p=e1(i,d);if(p!==u){let f=l.getTime()-p*60*1e3;return new Date(f).toISOString()}return d.toISOString()}function EWe(t,e){if(!lA(e))return{error:dM};let i=new Date(t),r=new Intl.DateTimeFormat("en-CA",{timeZone:e,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!1}).formatToParts(i),n=o=>r.find(l=>l.type===o)?.value??"",a=`${n("year")}-${n("month")}-${n("day")}`,s=`${n("hour")==="24"?"00":n("hour")}:${n("minute")}`;return{date:a,time:s}}function RWe(t,e,i){let r=Yue(t,e,i);return typeof r!="string"||nd(r)?r:{error:dM}}var CWe={isValidIANATimeZone:lA,getTimeZoneOffsetMinutes:e1,wallClockToUTC:Yue,utcToWallClock:EWe,toEmbargoUTC:RWe};function uA(t){let{tournamentRecord:e,tournamentRecords:i,activeTournamentId:r,...n}=t||{};return n.tournamentId||(n.tournamentId=Ct()),n.startDate&&!yc(n.startDate)&&!OP.test(n.startDate)?{error:or}:n.endDate&&!yc(n.endDate)&&!OP.test(n.endDate)?{error:or}:n.localTimeZone&&!lA(n.localTimeZone)?{error:dM}:(n.extensions&&(n.extensions=n.extensions.filter(ml)),{...n})}function dG({addParticipants:t=!0,participantAttribute:e,tournamentRecord:i,personAttribute:r,teamNames:n,accessor:a,uuids:s}){if(!i)return{error:ve};let o={},l=(i.participants??[]).filter(({participantType:m,participantRole:h})=>m===It&&h===Jr),u=0;for(let m of l){let h=a&&bp({element:m,accessor:a})?.value||r&&m.person?.[r]||e&&m[e];if(h){if(!Object.keys(o).includes(h)){o[h]={participantName:n?.[u]??h,participantId:s?.pop()??Ct(),individualParticipantIds:[],participantRole:Jr,participantType:_t};let g={value:r??e,name:bx};Ft({element:o[h],extension:g}),u+=1}o[h].individualParticipantIds.push(m.participantId)}}let c=Object.keys(o),d=(i.participants??[]).map(m=>{if(m.participantType!==_t||m.participantRole!==Jr)return;let{extension:h}=ht({name:bx,element:m}),g=h?.value;if(c.includes(g))return m.participantId}).filter(Boolean),p=0,f=[];return Object.keys(o).forEach(m=>{let h=o[m],{participantId:g}=h;d.includes(g)||(i.participants||(i.participants=[]),t&&i.participants.push(h),f.push(h),p++)}),t&&p?(st({payload:{tournamentId:i.tournamentId,participants:f},topic:Td}),{...W,participantsAdded:p}):f.length?{...W,newParticipants:f}:{error:d1e}}var MWe=[{AA:"Annexia"},{BA:"Bacteria"},{BO:"Borduria"},{BM:"Bensalem"},{BS:"Basenji"},{BI:"Balnibarbi"},{BV:"Bartovia"},{BZ:"Berzerkistan"},{CA:"Caldonia"},{CC:"Concordia"},{CH:"Chula"},{DA:"Deltora"},{DW:"Discworld"},{EA:"Eastasia"},{EP:"Ecotopia"},{ER:"Erewhon"},{FA:"Freedonia"},{FN:"Florin"},{FG:"Fogg"},{FK:"Fourecks"},{GA:"Genovia"},{GL:"Gilead"},{GD:"Gilead"},{GL:"Gondal"},{GO:"Gondor"},{GR:"Gruzinia"},{GT:"Goritania"},{GU:"Guilder"},{HA:"Heldscalla"},{HO:"Hidalgo"},{IL:"Illyria"},{KA:"Kinakuta"},{KG:"Kangan"},{KN:"Kreplachistan"},{KS:"Kallipolis"},{LH:"Lugash"},{LI:"Listenbourg"},{LT:"Lilliput"},{LU:"Luggnagg"},{LV:"Lichtenslava"},{MR:"Moher"},{NA:"Narnia"},{NV:"Novaria"},{OA:"Oceania"},{OS:"Orsinia"},{OV:"Octavia"},{PA:"Palombia"},{PG:"Penguina"},{QA:"Qasha"},{PM:"Panem"},{SA:"Solymbria"},{SD:"Syldavia"},{SG:"San Glucose"},{SL:"San Lorenzo"},{SR:"Sontar"},{SY:"Sylvania"},{TF:"Tralfamadore"},{TH:"Themyscira"},{UA:"Utopia"},{VA:"Vespugia"},{WA:"Wakanda"},{WX:"Wessex"},{ZA:"Zamunda"},{ZK:"Zubrowka"}],NWe=["Amber","Ansul","Atlantis","Braavos","Busytown","Castle Rock","Centralia","Coober Pedy","Chefchaouen","Chronopolis","Damanhur","Diaspar","Dictionopolis","Diomira","El Dorado","Elista","Ephesus","Gotham","Hadleyburg","Hallstatt","Hierusalem","Ilium","Inverness","Kowloon","Laputa","Longyearbyen","Lys","Matmata","Maycomb","Metropolis","Miyake-jima","Monowi","Nagoro","Navarre","New New York","Nimbin","Pemberley","Pseudopolis","Rivendell","Roswell","Shangri-La","Springfield","Supilinn","Thneedville","Trantor","Wobegon","Yonwood","Xanadu","Xylar","Zion"];function Kue({count:t=1,participantsCount:e=32}={}){let i=Cn(NWe),r=i.slice(0,t);return{cities:Ce(0,e).map(n=>n<Math.min(t,i.length)?r[n]:Ns(r))}}function Xue({count:t=1,participantsCount:e=32}={}){let i=Cn(MWe),r=i.slice(0,t).map(n=>Object.keys(n)).flat();return{states:Ce(0,e).map(n=>n<Math.min(t,i.length)?r[n]:Ns(r))}}function Jue({count:t=1,participantsCount:e=32}={}){let i=Ce(0,t).map(()=>Ce(0,5).map(()=>is(0,9)).join(""));return{postalCodes:Ce(0,e).map(r=>r<t?i[r]:Ns(i))}}function uE({idPrefix:t,participantType:e,index:i,uuids:r}){let n=ni(e)?e[0]:"X";return t?`${t}-${n}-${i}`:r?.pop()||Ct()}function Que(t){let{cities:e,states:i,postalCodes:r,nationalityCode:n,participantIndex:a}=t;return{postalCode:r?.[a],state:i?.[a],city:e?.[a],countryCode:n}}var AWe={lastNames:["Abbey","Ahern","Ampleforth","Ananiadis","Andelic","Assange","Atreides","Austen","Bach","Banks","Barrington","Batty","Bauers","Beals","Beer","Bennett","Berry","Bonaparte","Brewer","Brockovich","Bukowski","Cassidy","Catton","Calvino","Carlin","Carson","Chip","Constant","Crane","Crowne","Cummings","Curie","Dallas","Diamond","Deckard","Drazic","Dunbar","Earhart","Eisenstein","Eldritch","Elliot","Ellul","Escher","Eyre","Faulkner","Fulcher","Fukuoka","Godel","Goldstein","Greer","Hedges","Herbert","Holmgren","Humperdinck","Huxley","Illich","Jeffers","Jensen","Jevons","Johnson","Johnstone","Jovovich","Kingsnorth","Langer","Fernwright","Fuller","Le Guin","Lem","Lovelace","Mander","McLuhan","Midgely","Mond","Montoya","Moore","Murry","Nagle","Nearing","Ogden","Ophuls","Parks","Paz","Peet","Perfect","Pendejo","Pevensie","Postman","Ripley","Rodda","Rumfoord","Runciter","Rugen","Sale","Schumacher","Shaftoe","Shelley","Shepard","Smith","Stratton","Stewart","Swift","Tillich","Turing","Tyrell","Twain","Yeats","Veblen","Yates","Vonnegut","Waterhouse","Watson","Wolin","Wirt","Waschuk","Wormwood","Zecic"],firstFemale:["Ada","Amelia","Amelie","America","Anne","Antonia","Aravis","Astrid","Beatrice","Brienne","Buttercup","Caitlin","Cimorene","Cordelia","Desdemona","Ellen","Elizabeth","Emily","Emmie","Erin","Eva","Evelyn","Heather","Helen","Hermia","Hypatia","Imogen","Jane","Jasmine","Juliana","Juliet","Katniss","Leeloo","Lenina","Lilith","Linda","Lizzie","Louise","Lucy","Marie","Mary","Martha","Matilda","Milla","Miranda","Meg","Melba","Nicole","Ola","Portia","Pris","Rachael","Rachel","Rebecca","River","Rosa","Rosalind","Scout","Sharn","Susanne","Titania","Uhura","Ursula","Valentina","Viola","Virginia","Xena","Zoe"],firstMale:["Alan","Aldous","August","Axel","Barda","Barry","Bill","Bruce","Charles","Chris","Constantine","Darwin","David","Derrick","Edward","Emmanuel","Ernst","Estlin","Fezzik","Filby","Frank","Frito","George","Glen","Helmholtz","Inigo","Italo","Ivan","Jacques","James","Jared","Jerry","Joe","Johann","Julian","John Michael","Jonathan","Korben","Kirkpatrick","Kurt","Lief","Malachi","Mark","Marhsall","Masanobu","Maurits","Michael","Miro","Mustapha","Neil","Nikola","Octavio","Palmer","Paul","Pierre","Robinson","Rick","Rincewind","Roy","Shannon","Sheldon","Stafford","Stanislaw","Stanley","Syme","Thorstein","Thomas","Tyrone","Vizzini","Walton","Walker","Warren","Wendell","Westley","William","Winston","Zoran"]};function bk(t){let{count:e=100,sex:i}=t||{};if(!e||i&&!cl(i))return{personData:[],error:re};let r=Math.ceil(e*1.3),{lastNames:n,firstFemale:a,firstMale:s}=AWe,o=cd.map(({iso:h})=>h).filter(Boolean),l=Math.ceil(r/n.length),u=Math.ceil(r/a.length),c=Math.ceil(r/s.length),d=Ce(0,l).flatMap(()=>{let h=Oe(n,!1,!0);return Ce(0,n.length).map(()=>ha(h))}),p=Ce(0,u).flatMap(()=>{let h=Oe(a,!1,!0);return Ce(0,a.length).map(()=>ha(h))}),f=Ce(0,c).flatMap(()=>{let h=Oe(s,!1,!0);return Ce(0,s.length).map(()=>ha(h))}),m={};for(let h=0;h<r;h++){let g=d.pop(),I=i||Ns([tr,zr]),v=I===tr?f.pop():p.pop(),w=Ns(o);m[`${v}${g}`]={nationalityCode:w,sex:I,firstName:v,lastName:g}}return{personData:Object.values(m).slice(0,e)}}function Zue(t){let e=t?.count||1,{personExtensions:i,consideredDate:r,isMock:n=!0,gendersCount:a,personData:s,category:o,sex:l}=t||{};if(Number.isNaN(Number(e)))return{error:re};let u=a?.[tr]||Kf(l)&&e||0,c=a?.[zr]||cp(l)&&e||0;e=Math.max(e,u+c);let d=e-(u+c),p=u&&bk({count:u,sex:tr}).personData||[],f=c&&bk({count:c,sex:zr}).personData||[],m=[...p,...f,...d&&bk({count:d}).personData||[]],h=m.filter(T=>!l||u&&c||T.sex===l),g=[];if(Array.isArray(s)){let T=s.filter(P=>typeof P.firstName!="string"||typeof P.lastName!="string"||P.sex&&![tr,zr].includes(P.sex)||P.nationalityCode&&(typeof P.nationalityCode!="string"||P.nationalityCode.length>3||!cd.some(({iso:D,ioc:E})=>[D,E].includes(P.nationalityCode)))?!1:(P.nationalityCode&&g.push(P.nationalityCode),!0));if(T.length)h=T;else return{error:re}}let I=s?h:Cn(h);if(I.length<e){let{maleFirstNames:T,maleLastNames:P,femaleFirstNames:D,femaleLastNames:E,nationalityCodes:R}=m.reduce((C,M)=>{let{firstName:N,lastName:A,nationalityCode:O}=M;return M.sex===tr?(C.maleFirstNames.includes(N)||C.maleFirstNames.push(N),C.maleLastNames.includes(A)||C.maleLastNames.push(A)):(C.femaleFirstNames.includes(N)||C.femaleFirstNames.push(N),C.femaleLastNames.includes(A)||C.femaleLastNames.push(A)),C.nationalityCodes.includes(O)||C.nationalityCodes.push(O),C},{maleFirstNames:[],maleLastNames:[],femaleFirstNames:[],femaleLastNames:[],nationalityCodes:[]});Ce(0,e-I.length).forEach(()=>{let C=l||Ns([tr,zr]),M=Ns(R),N=Ns(C===tr?T:D),A=Ns(C===tr?P:E),O={firstName:N,lastName:A,sex:C,nationalityCode:M};I.push(O)})}let{ageMinDate:v,ageMaxDate:w}=Bp({consideredDate:r,category:o}),y=Ke(v?.slice(0,4)||0)||Ke(w?.slice(0,4)||0)-3,b=Ke(w?.slice(0,4)||0)||Ke(v?.slice(0,4)||0)+3,S=(v||w)&&[y,b],U=I.slice(0,e).map((T,P)=>{let[D,E]=S||[],R=S&&ha(Ce(D,E)),C=ha(Ce(0,365)),M=R&&mFe(R,C);return Object.assign(je({extensions:i||[{name:"regionCode",value:P+1}],birthDate:M,isMock:n}),T)});return{persons:U.length&&U||I[0],nationalityCodes:g}}var kWe=["Ace Academy","Avengers","Ball Bouncers","Baseliners","Captivators","Civil Disobedients","Continentals","Court Royal","Court Sharks","Diamond Dogs","Danger Zone","Doubles Dominators","Double Faults","Tricksters","Eliminators","Court Crusaders","Fuzz Busters","Game Changers","Goal Gurus","Good Volley","Green Machine","Hawk Eyes","Inside Outers","Killer Instinct","Line Toers","Masters of Mayhem","Matter Catchers","Cheap Shot","Mean Machines","Mindspace Invaders","Net Centric","Net Positive","Smash Mullet","Over Your Head","Spin Meisters","Aggressors","Racket Machine","Slice Happy","Refs Nightmare","Sandeaters","Sun Seekers","Slicer Dicers","Stacked Deck","Cross Stringers","The Emergence","Total Demolition","Touch and Go","Unreturnables","Upside Downers","Vertically Challenged","Visual Spectacle"];function cE({nameRoot:t="TEAM",count:e=1}={}){let i=Cn(kWe).slice(0,e);return i.length<e&&Ce(0,e-i.length).forEach(r=>i.push(`${t} ${r+1}`)),{names:i}}function oy(t){let{scaledParticipantsCount:e,rankingRange:i}=t,{ratingsParameters:r=Pr,valuesInstanceLimit:n,ratingsValues:a=[],consideredDate:s,categories:o,category:l,nationalityCodesCount:u,nationalityCodeType:c,nationalityCodes:d,participantsCount:p=32,participantType:f,teamSize:m=8,personIds:h,idPrefix:g,uuids:I,personExtensions:v,addressProps:w,gendersCount:y,matchUpType:b,personData:S,sex:U,inContext:T,withISO2:P,withIOC:D,scaleAllParticipants:E}=t,R=f===ft||b===_p,C=f===_t||b===_t;i&&(!Array.isArray(i)||!i.every(fe=>Ai(fe))||i.length!==2)&&(i=void 0),e=E?p:e;let M=1e3,N=e&&e>M?e:M;i=i||[1,N],i[1]+=1;let A=p*(R&&2||C&&(m??8)||1),O=Zue({count:A,personExtensions:v,consideredDate:s,gendersCount:y,personData:S,category:l,sex:U});if(O.error)return O;let{nationalityCodes:k,persons:F}=O,x={},L={},$={},V={},_=fe=>{Object.assign(x,fe.doublesRankings),Object.assign(L,fe.singlesRankings),Object.assign(V,fe.doublesRatings),Object.assign($,fe.singlesRatings)};if(wt(l)){let fe=Xq({scaledParticipantsCount:e,ratingsParameters:r,participantType:f,ratingsValues:a,rankingRange:i,category:l});_(fe)}Array.isArray(o)&&o.forEach(fe=>{let Te=Xq({scaledParticipantsCount:e,ratingsParameters:r,participantType:f,ratingsValues:a,rankingRange:i,category:fe});_(Te)});let B=cd.filter(fe=>c==="IOC"&&fe.ioc||fe.iso);function G(fe){let Te=Math.ceil(A/fe);return n&&Te>n?Math.ceil(A/n):fe}let{postalCodesProfile:j,postalCodesCount:K,statesProfile:Y,citiesProfile:X,citiesCount:Z,statesCount:J}=w||{},ae=fe=>Object.keys(fe).flatMap(Te=>Ce(0,Y[Te]).map(()=>Te)),te=X&&ae(X)||w?.cities||Kue({count:Z||A,participantsCount:A}).cities,ne=Y&&ae(Y)||w?.states||Xue({count:J||A,participantsCount:A}).states,le=j&&ae(j)||w?.postalCodes||Jue({count:K||A,participantsCount:A}).postalCodes,de={cities:te,states:ne,postalCodes:le},pe=G(u),ge=pe?Cn(B).slice(0,u):d&&B.filter(fe=>d.includes(fe.iso))||B,Me=Cn(Ce(0,Math.ceil(A/(pe||1))).map(()=>ge).flat(1/0)),Pe=cE({count:p}).names;return{participants:Ce(0,p).flatMap(fe=>{let Te=R&&2||C&&(m??8)||1,ce=Ce(0,Te).map(Ne=>{let me=fe*Te+Ne;return Be(me)}),ye=ce.map(Ne=>Ne.participantId),be=ce.map(Ne=>Ne.person.standardFamilyName).join("/"),Fe=R?ft:_t,we={participantId:uE({participantType:Fe,index:fe,idPrefix:g,uuids:I}),participantName:R?be:Pe[fe],participantRole:Jr,individualParticipantIds:ye,participantType:Fe};return T&&(we.individualParticipants=ce),R||C?[we,...ce]:ce}),...W};function Be(fe){let Te=F[fe],{nationalityCode:ce,participantExtensions:ye,participantTimeItems:be,extensions:Fe,firstName:we,birthDate:Ne,lastName:me,personId:Ee,sex:Le}=Te||{},Q=we||"GivenName",se=me||"FamilyName",oe=`${Q} ${se}`,ue=Me[fe],ee=k?.length&&ce||ue&&(c==="IOC"?ue.ioc||ue.iso:ue.iso||ue.ioc)||ce;Me?.length&&!ee&&!ce&&console.log("%c Invalid Nationality Code",{participantIndex:fe,country:ue});let Se=Que({...de,participantIndex:fe,nationalityCode:ee}),De=je({participantId:uE({participantType:It,index:fe,idPrefix:g,uuids:I}),extensions:ye,timeItems:be,participantRole:Jr,participantType:It,participantName:oe,person:{personId:Ee||h?.length&&h[fe]||Ct(),birthDate:Mn(Ne)?Ne:void 0,addresses:[Se],standardFamilyName:se,standardGivenName:Q,nationalityCode:ee,extensions:Fe,sex:Le}});if(D&&ee){let Ue=cd.find(({iso:ut})=>ut===ee);Ue?.ioc&&(De.person.iocNationalityCode=Ue.ioc),Ue?.label&&(De.person.countryName=Ue.label)}if(P&&ee){let Ue=cd.find(({iso:ut})=>ut===ee);Ue?.iso2&&(De.person.iso2NationalityCode=Ue.iso2),Ue?.label&&(De.person.countryName=Ue.label)}let it=Ue=>{let ut=Ue.categoryName||Ue.ratingType||Ue.ageCategoryCode,yi=L[ut]?.[fe],qe=x[ut]?.[fe];AT({scaleValue:yi,eventType:Bm,scaleType:vu,participant:De,category:Ue}),AT({scaleValue:qe,eventType:wc,scaleType:vu,participant:De,category:Ue});let bi=$[ut]?.[fe],oi=V[ut]?.[fe];AT({scaleValue:bi,eventType:Bm,scaleType:ud,participant:De,category:Ue}),AT({scaleValue:oi,eventType:wc,scaleType:ud,participant:De,category:Ue})};return Array.isArray(o)?o.forEach(Ue=>it(Ue)):l&&it(l),De}}function AT({scaleValue:t,participant:e,eventType:i,scaleType:r,category:n}){let a=n.categoryName||n.ratingType||n.ageCategoryCode,s=[Sd,r,i,a].join("."),o={itemValue:t,itemType:s};a&&t&&(e.timeItems||(e.timeItems=[]),e.timeItems.push(o))}function Xq(t){let{category:e,scaledParticipantsCount:i,ratingsParameters:r,participantType:n,ratingsValues:a=[]}=t,s=e.rankingRange||t.rankingRange||[1,1e3],o={},l={},u={},c={},{categoryName:d,ageCategoryCode:p,ratingType:f}=e,m=e.categoryName||e.ratingType||e.ageCategoryCode;if((d||p)&&!f){let[h,g]=s||[];if(l[m]=Cn(Ce(h,g)).slice(0,i||is(20,30)),[ft,_t].includes(n)){let[I,v]=s||[];o[m]=Cn(Ce(I,v)).slice(0,i||is(20,30))}}if(f&&r[f]){let{ratingMax:h,ratingMin:g,ratingAttributes:I}=e,v={...r[f],...I||{}},{attributes:w={},decimalsCount:y,accessors:b,range:S,step:U}=v,T=C=>{let M={},N=Object.keys(C||{});for(let A of N){let O=C[A];if(typeof O=="object"&&O.generator){let{range:k}=O,[F,x]=k.slice().sort();M[A]=is(F,x)}else M[A]=O}return M},P=S[0]>S[1]?2:.7,[D,E]=S.slice().sort(),R=Ce(0,2e3).map(()=>ute(D,E,P,U,y)).filter(C=>(!h||C<=h)&&(!g||C>=g)).slice(0,i||is(20,30)).map(C=>b?Object.assign({},...b.map(M=>({[M]:C})),T(w)):C);u[m]=[...a,...R],[ft,_t].includes(n)&&(c[m]=[...a,...R])}return{singlesRankings:l,doublesRankings:o,singlesRatings:u,doublesRatings:c}}function pG(t){let{alternatesCount:e=0,tieFormatName:i,drawSize:r}=t,n=0,a=0,s=0,o=0,l={},u={[tr]:0,[zr]:0,[Fh]:0,[zu]:0,ANY:0};(wt(t.tieFormat)?t.tieFormat:bc({namedFormat:i}))?.collectionDefinitions?.filter(Boolean).forEach(f=>{let{category:m,collectionId:h,matchUpType:g,matchUpCount:I,gender:v}=f;if(cl(v)){let w=ln(v),y=I*(g===Bt?2:1);w&&u[w]<y&&(u[w]=y)}else Aa(v)&&(u[tr]<I&&(u[tr]=I),u[zr]<I&&(u[zr]=I));if(m){let w=JSON.stringify(m);l[w]=m}if(h||(f.collectionId=Ct()),Pi(Bt)(g)){let w=I;o+=I,n=Math.max(n,w)}if(Pi(zt)(g)){let w=I;s+=I,a=Math.max(a,w)}});let c=Object.keys(l).length?Math.max(s,o*2):Math.max(a,n*2),d=n*(r+e),p=a*(r+e);return{maxDoublesDraw:d,maxSinglesDraw:p,teamSize:c,genders:u}}function OWe({participantsProfile:t,eventProfiles:e,drawProfiles:i}){let{participantsCount:r,participantType:n=It}=t||{},a=r||0,s={[zr]:0,[Fh]:0,[zu]:0,[tr]:0,ANY:0},o=0,l=0,u=0,c=0,d=0,p=({alternatesCount:m=0,uniqueParticipants:h,tieFormatName:g,drawSize:I=0,eventType:v,tieFormat:w,category:y,gender:b,stage:S})=>{let U=v===fs,T=v===ar,P=!!(h||S===ze||y||b);if(T){c=Math.max(c,I+m),w=typeof w=="object"?w:bc({namedFormat:g});let{teamSize:D,maxDoublesDraw:E,maxSinglesDraw:R,genders:C}=pG({alternatesCount:m,tieFormatName:g,tieFormat:w,drawSize:I});u=Math.max(u,D),l=Math.max(l,R),P||(o=Math.max(o,E)),Object.keys(C).forEach(M=>s[M]+=C[M])}else if(U)if(P){let D=(I+m)*2;d+=D,b&&(s[b]+=D)}else I+m&&I+m>o&&(o=I+m);else if(P){let D=I+m;b&&(s[b]+=D),d+=D}else I&&I>l&&(l=I+m)};if(e?.forEach(m=>{let{tieFormatName:h,tieFormat:g,drawProfiles:I,eventType:v,category:w,gender:y}=m;if(I)for(let b of I){let{tieFormatName:S,tieFormat:U}=b;p({...b,tieFormatName:S||h,tieFormat:U||g,eventType:v,category:w,gender:y})}}),Array.isArray(i))for(let m of i)p(m);let f=Math.max(c*u,o*2,l);return o&&(n=ft),(r||a)<f&&(r=f),r&&o&&[ft,ar].includes(n)&&(l&&Math.floor(l/2)>o?r=Math.floor(l/2):(!l||o*2>=l)&&(r=Math.ceil(r/2))),r===void 0&&(r=!e?.length&&!i?.length?32:0),r<a&&(r=a),{uniqueParticipantsCount:d,participantsCount:r,largestTeamDraw:c,largestTeamSize:u,participantType:n,gendersCount:s}}function ece({participantsProfile:t,tournamentRecord:e,eventProfiles:i,drawProfiles:r,startDate:n,uuids:a}){if(t?.participantsCount===0)return{addedCount:0,...W};let{participantsCount:s,participantType:o,largestTeamDraw:l,largestTeamSize:u,gendersCount:c}=OWe({participantsProfile:t,eventProfiles:i,drawProfiles:r}),d=t?.teamKey,p=oy({consideredDate:n,...t,participantsCount:s,participantType:o,gendersCount:c,uuids:a}).participants,f=0,m=no({tournamentRecord:e,participants:p});if(m.error)return m;if(f+=m.addedCount,d){let v=dG({tournamentRecord:e,...d});if(v.error)return v}let h=p.filter(({participantType:v})=>v===It).map(yt),g=t?.idPrefix?`${_t}-${t.idPrefix}`:void 0,I=Ce(0,l).map(v=>{let w=h.slice(v*u,(v+1)*u),y=uE({index:v,participantType:o,idPrefix:g,uuids:a});return{participantName:`Team ${v+1}`,participantRole:Jr,individualParticipantIds:w,participantType:_t,participantId:y}});return m=no({participants:I,tournamentRecord:e}),m.error?m:(f+=m.addedCount,{addedCount:f,...W})}function tce({drawProfiles:t,category:e,gender:i}){let r={},n=t?.reduce((s,o)=>{let{qualifyingPositions:l=0,participantsCount:u=0,uniqueParticipants:c,stage:d=Ae,drawSize:p=0}=o||{};Object.keys(s).includes(d)||(s[d]=0);let f=(u||p)-l;return c||i||e||d===ze?(Object.keys(r).includes(d)||(r[d]=0),r[d]+=f):s[d]=Math.max(s[d],f),s},{}),a=Object.keys(r);return a.forEach(s=>n[s]+=r[s]),{stageParticipantsCount:n,uniqueParticipantsCount:r,uniqueParticipantStages:a}}function ice({allUniqueParticipantIds:t,stageParticipantsCount:e,eventParticipantType:i,targetParticipants:r}){let n=e[Ae]||0,a=e[ze]||0;return{stageParticipants:{QUALIFYING:r?.filter(({participantType:s})=>s===i).filter(({participantId:s})=>!t.includes(s)).slice(0,a),MAIN:r?.filter(({participantType:s})=>s===i).filter(({participantId:s})=>!t.includes(s)).slice(a,a+n)}}}var xWe={[ai]:2,[Si]:1,[Wi]:1,[Sr]:1,[qt]:4};function fG(t){let{defaultWithScorePercent:e=2,winningSide:i}=t,{matchUpStatusProfile:r=xWe,matchUpFormat:n=Vs,pointsPerMinute:a=1,sideWeight:s=4}=t;if(!$a({matchUpFormat:n}))return{error:Bte};if(typeof r!="object")return{error:re};if(e>100&&(e=100),Number.isNaN(Number(e))||Number.isNaN(Number(a))||Number.isNaN(Number(s)))return{error:re};let o=Object.keys(r).filter(D=>Object.keys(VM).includes(D)&&D!==Oi);if(Object.keys(o).reduce((D,E)=>D+r[E],0)>100)return{error:re,matchUpStatusProfile:r};let l=o.reduce((D,E)=>(D.pointer=D.pointer+r[E],D.valueMap.push([D.pointer,E]),D),{pointer:0,valueMap:[]}),u=is(1,100),c=(l.valueMap.find(D=>u<=D[0])??[100,Oi])[1],d={sets:[],scoreStringSide1:"",side2ScoreString:""};if(Lr(c)){i=i||is(1,2);let D={score:d,matchUpStatus:c,winningSide:i};if(!(c===qt&&is(1,100)>100-e))return{outcome:D}}else if([Si,Wi].includes(c))return{outcome:{score:d,matchUpStatus:c}};let p=qi(n),{bestOf:f=1,exactly:m,setFormat:h,finalSetFormat:g}=p??{},I=[],v=is(0,1),w=i?[i-1]:[...Ce(0,s).map(()=>v),1-v],y=[Sr,qt,Da,Kd].includes(c)&&(ha(Ce(1,m||f))||1),b,S=Ce(1,(m??f)+1);for(let D of S){let E=D===(m??f),{set:R,incomplete:C,winningSideNumber:M}=FWe({setFormat:E&&g||h,incomplete:y===D,pointsPerMinute:a,matchUpStatus:c,weightedRange:w,setNumber:D});if(I.push(R),C){b=M;break}if(uw({matchUp:{score:{sets:I},matchUpFormat:n}}).calculatedWinningSide)break}let U=uw({matchUp:{score:{sets:I},matchUpFormat:n,winningSide:i}}),T=b?i||b:U.calculatedWinningSide,{score:P}=_ue({winningSide:T,score:{sets:I},matchUpStatus:c});return{outcome:{winningSide:T,matchUpStatus:c,score:P}}}function FWe({weightedRange:t=[0,1],pointsPerMinute:e,matchUpStatus:i,incomplete:r,setFormat:n,setNumber:a}){let s={setNumber:a},{setTo:o,tiebreakFormat:l,tiebreakAt:u,tiebreakSet:c,timed:d,minutes:p}=n,f=is(0,t.length-1),m=t[f],h;if(d){let g=p*e,I=Math.round(g*.2),v=g+ha([1,-1])*I,w=Gxe(v,2),y=[w,v-w];m&&y.reverse(),h=t[f]+1;let b=y[0]>y[1]&&1||y[1]>y[0]&&2||0;if(r){let[T,P]=y;return Object.assign(s,{side1Score:T,side2Score:P}),Ki.includes(i)?{set:s,incomplete:r,winningSideNumber:h}:{set:s,incomplete:r}}b||(y[is(0,1)]+=1),b=y[0]>y[1]?1:2,b!==h&&y.reverse();let[S,U]=y;return Object.assign(s,{side1Score:S,side2Score:U,winningSide:h}),{set:s}}else{if(r)return s.side1Score=is(0,u),s.side2Score=is(0,u),Ki.includes(i)&&(h=t[f]+1),{set:s,incomplete:r,winningSideNumber:h};{let g=Ce(1,o+1).flatMap(U=>Ce(0,o+2-U).map(()=>U)),I=g[is(0,g.length-1)],v=o&&JV({isSide1:!0,tiebreakAt:u,lowValue:I,setTo:o}),w=!v,y=t.length===1&&t[f]+1;if(!w){y?(v[0]>v[1]?1:2)!==y&&v.reverse():m&&v.reverse();let[U,T]=v;Object.assign(s,{side1Score:U,side2Score:T})}let b=ow({matchUpScoringFormat:{setFormat:n},setObject:s}),S;if(b.hasTiebreakCondition||w){let{NoAD:U,tiebreakTo:T}=l||c||{},P=Ce(1,T+1).flatMap(R=>Ce(0,T+2-R).map(()=>R)),D=P[is(0,P.length-1)],E=NN({isSide1:!0,tiebreakNoAd:U,tiebreakTo:T,lowValue:D});if(E)if(w){let R=E[0]>E[1]?1:2;y?R!==y&&E.reverse():m&&E.reverse(),[s.side1TiebreakScore,s.side2TiebreakScore]=E,S=E[0]>E[1]&&1||E[1]>E[0]&&2||void 0}else b.leadingSide===2?[s.side1TiebreakScore,s.side2TiebreakScore]=E:[s.side2TiebreakScore,s.side1TiebreakScore]=E}s.winningSide=b.winningSide||b.leadingSide||y||S}}return{set:s}}function LWe({firstRoundDualMatchUps:t,event:e,tournamentRecord:i,drawDefinition:r}){let n=e?.category?.ageCategoryCode||e?.category?.categoryName;if(n){let d=mue({singlesOnly:!0,tournamentRecord:i,drawDefinition:r,scaleAccessor:{scaleName:n,sortOrder:"ASC",scaleType:vu},event:e});if(d.error)return d;let{lineUps:p,participantsToAdd:f}=d;no({tournamentRecord:i,participants:f}),Ft({element:r,extension:{name:Uc,value:p}});return}let a=t[0]?.structureId,{positionAssignments:s}=Kt({drawDefinition:r,structureId:a});if(!s?.length)return;let{participants:o}=Ri({participantFilters:{participantTypes:[ei]},tournamentRecord:i});function l(d){return o?.find(p=>{let{participantId:f}=p;return s.find(m=>m.participantId===f)?.drawPosition===d})}function u(d,p,f){d.sides.forEach(m=>{let{drawPosition:h}=m,g=l(h);if(g){let I=g.individualParticipantIds?.[p];I&&lE({teamParticipantId:g.participantId,participantId:I,tournamentRecord:i,drawDefinition:r,tieMatchUpId:f,event:e});return}})}function c(d,p,f){d.sides.forEach(m=>{let{drawPosition:h}=m,g=l(h);g&&g.individualParticipantIds?.slice(p*2,p*2+2)?.forEach(I=>{lE({teamParticipantId:g.participantId,participantId:I,tournamentRecord:i,drawDefinition:r,tieMatchUpId:f,event:e})})})}t.forEach(d=>{let p=d.tieMatchUps.filter(Pi(zt)),f=d.tieMatchUps.filter(Pi(Bt));p.forEach((m,h)=>{let g=m.matchUpId;u(m,h,g)}),f.forEach((m,h)=>{let g=m.matchUpId;c(m,h,g)})})}function _We({structure:t,matchUpsMap:e,drawDefinition:i,tournamentRecord:r,event:n,matchUpStatusProfile:a,matchUpFormat:s,matchUpStatus:o,scoreString:l,randomWinningSide:u,completionGoal:c,completedCount:d}){let p=At({contextFilters:{matchUpTypes:[Bt,zt]},afterRecoveryTimes:!1,tournamentRecord:r,inContext:!0,drawDefinition:i,matchUpsMap:e,structure:t,event:n}).matchUps.filter(({winningSide:f})=>!f).sort(zh).map(vr);for(let f of p){if(!Number.isNaN(Number(c))&&d.value>=c)break;let{matchUps:m}=At({matchUpFilters:{matchUpTypes:[Bt,zt]},afterRecoveryTimes:!1,tournamentRecord:r,inContext:!0,drawDefinition:i,matchUpsMap:e,structure:t,event:n}),h=m.find(I=>I.matchUpId===f),g=[Si,Wi].includes(h.matchUpStatus);if(h?.readyToScore&&!g){let I=$We({matchUpStatusProfile:a,tournamentRecord:r,drawDefinition:i,targetMatchUp:h,matchUpFormat:s,matchUpStatus:o,scoreString:l,winningSide:!u&&1,event:n});if(I?.error)return I;d.value+=1}}}function dE(t){let{matchUpStatusProfile:e,completeAllMatchUps:i,randomWinningSide:r,tournamentRecord:n,completionGoal:a,drawDefinition:s,event:o}=t;if(!s)return{error:$e};let l=t.matchUpFormat||s.matchUpFormat||o?.matchUpFormat,u=s.structures.slice().sort(Bh),c={value:0},{matchUps:d,matchUpsMap:p}=Zi({matchUpFilters:{matchUpTypes:[ei],roundNumbers:[1]},contextFilters:{stages:[Ae,ze]},inContext:!0,drawDefinition:s});if(d?.length){let I=LWe({firstRoundDualMatchUps:d,event:o,tournamentRecord:n,drawDefinition:s});if(I?.error)return I}let f=typeof i=="string"&&i,m=f&&Oi,h=u.length===2&&u[0].finishingPosition===Gp&&Li(u.map(({stage:I})=>I),[Ae,Ti]).length===2,g=u.map(({structureId:I})=>I);for(let I of g){if(c.value>=a)break;let v=s.structures.find(y=>y.structureId===I),w=_We({structure:v,matchUpsMap:p,drawDefinition:s,tournamentRecord:n,event:o,matchUpStatusProfile:e,matchUpFormat:l,matchUpStatus:m,scoreString:f,randomWinningSide:r,completionGoal:a,completedCount:c});if(w?.error)return w;h&&v.finishingPosition===Gp&&t.completeRoundRobinPlayoffs&&Kv({structureId:v.structureId,applyPositioning:!0,drawDefinition:s})}return{...W,completedCount:c.value}}function rce(t){let{matchUpStatusCodes:e,policyDefinitions:i,tournamentRecord:r,drawDefinition:n,targetMatchUp:a,matchUpStatus:s,matchUpFormat:o,scoreString:l,winningSide:u,event:c}=t;if(!a||a.matchUpStatus==="BYE")return;let{matchUpId:d}=a||{},{outcome:p}=sG({matchUpFormat:o,matchUpStatus:s,scoreString:l,winningSide:u});return e&&(p.matchUpStatusCodes=e),aT({tournamentRecord:r,policyDefinitions:i,drawDefinition:n,matchUpFormat:o,matchUpId:d,outcome:p,event:c})}function $We(t){let{matchUpStatusProfile:e={},tournamentRecord:i,policyDefinitions:r,drawDefinition:n,matchUpStatus:a,matchUpFormat:s,targetMatchUp:o,scoreString:l,winningSide:u,event:c}=t;if(l||a)return rce(t);let{matchUpId:d}=o||{},{outcome:p}=fG({matchUpStatusProfile:e,matchUpFormat:s,winningSide:u});return aT({policyDefinitions:r,tournamentRecord:i,drawDefinition:n,matchUpFormat:s,matchUpId:d,outcome:p,event:c})}function nce({matchUpStatusProfile:t,completeAllMatchUps:e,randomWinningSide:i,tournamentRecord:r,drawProfiles:n,isMock:a,event:s}){let o=Bi({event:s}).flightProfile,{eventName:l,eventType:u,category:c}=s,{startDate:d}=r,p=[],f=c?.categoryName||c?.ageCategoryCode||c?.ratingType,m=s.drawDefinitions?.map(({drawId:h})=>h);if(Array.isArray(o?.flights))for(let[h,g]of o.flights.entries()){let{drawId:I,stage:v,drawName:w,drawEntries:y}=g;p.push(g.drawId);let b=n[h],{seedsCount:S,generate:U=!0}=b||{};if(U){let T=y.filter(Pa(Iu)).map(Pa(Iu)),P=f||l;if(r&&S&&S<=T.length&&Ce(1,S+1).forEach((M,N)=>{let A={scaleValue:M,scaleName:P,scaleType:Yl,eventType:u,scaleDate:d},O=T[N];Jv({tournamentRecord:r,participantId:O,scaleItem:A})}),m?.includes(I))break;let D=rT({...b,matchUpType:u,seedingScaleName:P,tournamentRecord:r,drawEntries:y,drawName:w,drawId:I,isMock:a,event:s,stage:v});if(D.error)return{error:D.error,drawIds:[]};let{drawDefinition:E}=D;if(!E)return{error:_a};let R=n[h]?.drawExtensions;if(Array.isArray(R)&&R.filter(ml).forEach(M=>Ft({element:E,extension:M})),D=nT({suppressNotifications:!0,tournamentRecord:r,drawDefinition:E,event:s}),D.error)return{error:D.error,drawIds:[]};if(b?.withPlayoffs){let M=E.structures?.[0].structureId,N=mN({idPrefix:b.idPrefix,...b.withPlayoffs,tournamentRecord:r,drawDefinition:E,structureId:M,isMock:a,event:s});if(N?.error)return N}let C=b?.completionGoal;if(b?.automated!==!1&&(e||C)){let M=b?.matchUpFormat,N=dE({completeAllMatchUps:!C&&e,matchUpStatusProfile:t,randomWinningSide:i,tournamentRecord:r,completionGoal:C,drawDefinition:E,matchUpFormat:M,event:s});if(N.error)return{error:N.error,drawIds:[]};let A=N.completedCount;if(b?.drawType===gu){let O=E.structures?.find(x=>x.stage===Ae);if(!O)return{error:vi};let k=Kv({structureId:O.structureId,tournamentRecord:r,drawDefinition:E});if(k.error)return{error:k.error,drawIds:[]};let F=C?C-(A??0):void 0;if(k=dE({completeAllMatchUps:!C&&e,completionGoal:C?F:void 0,matchUpStatusProfile:t,randomWinningSide:i,tournamentRecord:r,drawDefinition:E,matchUpFormat:M,event:s}),k.error)return{error:k.error,drawIds:[]}}}}}return{...W,drawIds:p}}function ace(t){let{participantsProfile:e={},uniqueParticipantsCount:i,ratingsParameters:r,tournamentRecord:n,eventProfile:a,eventIndex:s,event:o,uuids:l}=t,{category:u,gender:c,eventType:d}=o,p=Pi(pl)(d)&&It||Pi(fs)(d)&&ft||d,f=i[Ae]||0,m=i[ze]||0,h=a.drawProfiles?.length?f+m:a.participantsProfile?.participantsCount??0,g=cl(c)?c:void 0,I=e?.idPrefix?`E-${s}-${e?.idPrefix}`:void 0,{participants:v}=oy({uuids:a.uuids||l,...e,scaledParticipantsCount:a.scaledParticipantsCount,consideredDate:n?.startDate,rankingRange:a.rankingRange,participantType:p,participantsCount:h,ratingsParameters:r,category:u,idPrefix:I,sex:g}),w=no({tournamentRecord:n,participants:v});if(w.error)return w;let y=v?.filter(({participantType:S})=>S===p),b=v?.map(yt);return{uniqueDrawParticipants:y,uniqueParticipantIds:b}}function BWe({autoEntryPositions:t,tournamentRecord:e,drawParticipants:i,drawProfile:r,event:n}){let{drawType:a=Jo,qualifyingPositions:s=0,stage:o=Ae,drawSize:l=0,drawName:u,drawId:c}=r,d=l-s,p=i.slice(0,d).map(yt);if(p.length){let h=Qo({participantIds:p,autoEntryPositions:t,entryStage:o,tournamentRecord:e,event:n});if(h.error)return h}let f=p.map(h=>({entryStatus:ca,entryStage:o,participantId:h})),m=XN({drawName:u||a,qualifyingPositions:s,drawEntries:f,drawId:c,event:n,stage:o});return m.error?m:{...W}}function sce({uniqueDrawParticipants:t,autoEntryPositions:e,stageParticipants:i,tournamentRecord:r,drawProfiles:n,category:a,gender:s,event:o}){let l=0;for(let u of n){let{qualifyingPositions:c=0,uniqueParticipants:d,stage:p=Ae,drawSize:f=0}=u,m=f-c,h=d||s||a||p===ze,g=h?t.slice(l,l+m):i[p||Ae]||[];h&&(l+=m);let I=BWe({autoEntryPositions:e,drawParticipants:g,tournamentRecord:r,drawProfile:u,event:o});if(I.error)return I}return{...W}}function oce(t){let{allUniqueParticipantIds:e,matchUpStatusProfile:i,participantsProfile:r,completeAllMatchUps:n,autoEntryPositions:a,hydrateCollections:s,randomWinningSide:o,ratingsParameters:l,tournamentRecord:u,eventProfile:c,eventIndex:d,publish:p,isMock:f,uuids:m}=t,h=c.gender,g=c.eventName,{eventType:I=pl,policyDefinitions:v,drawProfiles:w=[],eventExtensions:y,surfaceCategory:b,tieFormatName:S,processCodes:U,discipline:T,eventLevel:P,timeItems:D,ballType:E,category:R}=c,C=c.eventId||Ct(),M=c.tieFormat||(I===ar?bc({namedFormat:S,event:{eventId:C,category:R,gender:h},hydrateCollections:s,isMock:f}):void 0),N=u.participants;for(let Y of w)!h&&Y.gender&&(h=Y?.gender);let{stageParticipantsCount:A,uniqueParticipantsCount:O,uniqueParticipantStages:k}=tce({drawProfiles:w,category:R,gender:h}),F=Pi(pl)(I)&&It||Pi(fs)(I)&&ft||I,{uniqueDrawParticipants:x=[],uniqueParticipantIds:L=[]}=k?ace({event:{eventType:I,category:R,gender:h},uniqueParticipantsCount:O,participantsProfile:r,ratingsParameters:l,tournamentRecord:u,eventProfile:c,eventIndex:d,uuids:m}):{},{eventAttributes:$}=c;typeof $!="object"&&($={});let V=R?.categoryName||R?.ageCategoryCode||R?.ratingType;g=g||V||"Generated Event";let _={...$,surfaceCategory:b,processCodes:U,discipline:T,eventLevel:P,eventName:g,eventType:I,tieFormat:M,ballType:E,category:R,eventId:C,gender:h};if(y?.length&&Array.isArray(y)){let Y=y.filter(ml);Y?.length&&Object.assign(_,{extensions:Y})}if(Array.isArray(D)&&D.forEach(Y=>Zh({event:j,timeItem:Y})),typeof v=="object")for(let Y of Object.keys(v))Yp({policyDefinitions:{[Y]:v[Y]},event:_});_.category&&(_.category.categoryName=V);let B,G=ty({suppressNotifications:!1,internalUse:!0,tournamentRecord:u,event:_});if(G.error)return G;let j=G?.event,{stageParticipants:K}=ice({allUniqueParticipantIds:e,stageParticipantsCount:A,eventParticipantType:F,targetParticipants:N});if(w?.length){let Y=sce({uniqueDrawParticipants:x,autoEntryPositions:a,stageParticipants:K,tournamentRecord:u,drawProfiles:w,category:R,gender:h,event:j});if(Y.error)return Y;let X=nce({matchUpStatusProfile:i,completeAllMatchUps:n,randomWinningSide:o,tournamentRecord:u,drawProfiles:w,isMock:f,event:j});if(X.error)return X;B=X.drawIds}else if(c?.participantsProfile?.participantsCount){let Y=x.map(yt);if(Y.length){let X=Qo({participantIds:Y,autoEntryPositions:a,tournamentRecord:u,entryStage:Ae,event:j});if(X.error)return X}}return p&&ry({tournamentRecord:u,event:j}),{drawIds:B,eventId:C,uniqueParticipantIds:L}}function mG({tournamentRecords:t,scheduleDate:e,venueId:i,round:r}){if(!Mn(e))return{error:or};let n="addSchedulingProfileRound",{extension:a}=ht({name:Hm,tournamentRecords:t,discover:!0}),s=a?.value||[],o=s.find(p=>pu(e,p.scheduleDate));if(!o){let{startDate:p,endDate:f}=xN({tournamentRecords:t}),m=new Date(e);if(p&&m<new Date(p)||f&&m>new Date(f))return{error:or};o={scheduleDate:e,venues:[]},s.push(o)}let l=o.venues.find(p=>p.venueId===i);l||(l={venueId:i,rounds:[]},o.venues.push(l));let u=["notBeforeTime"],c=p=>Object.keys(p).filter(f=>!u.includes(f)).sort().map(f=>wt(p[f])?c(p[f]):p[f]).flat().join("|");if(l.rounds.find(p=>c(p)===c(r)))return q({result:{error:Nte},stack:n});l.rounds.push(r);let d=Zv({tournamentRecords:t,schedulingProfile:s});return d.error?d:{...W}}function VWe({schedulingProfile:t,tournamentRecord:e}){if(typeof t!="object")return{error:re};let i=jv({tournamentRecord:e}).containedStructures,r=Ur({tournamentRecord:e}).matchUps??[],{tournamentId:n}=e,a=[];for(let s of t){let{scheduleDate:o,venues:l=[]}=s;for(let u of l){let{rounds:c,venueId:d}=u;for(let p of c){let{drawId:f,winnerFinishingPositionRange:m,roundSegment:h}=p,g=r.filter(I=>{let v=m?.indexOf("-")>0&&m.split("-").map(y=>+y),w=I.finishingPositionRange?.winner;return I.drawId===f&&(!p.roundNumber||I.roundNumber===p.roundNumber)&&(!w||!v||Li(w,v).length===2||nt(w).length===nt(v).length&&Li(w,v).length===nt(w).length)})[0];if(g){let{eventId:I,roundNumber:v,drawName:w,structureName:y,roundName:b}=g,S=g.structureId;v&&!m&&(S=Object.keys(i).find(P=>i[P].includes(S))??S);let U={tournamentId:n,structureId:S,roundNumber:v,roundSegment:h,eventId:I,drawId:f},T=mG({tournamentRecords:{[n]:e},round:U,scheduleDate:o,venueId:d});if(T.error)return T;a.push({structureName:y,roundName:b,drawName:w,...U})}}}}return{scheduledRounds:a}}function cA(t){let e=He(t,[{drawProfile:!0,_ofType:Kn}]);if(e.error)return e;let{allUniqueParticipantIds:i=[],participantsProfile:r={},matchUpStatusProfile:n,completeAllMatchUps:a,autoEntryPositions:s,hydrateCollections:o,randomWinningSide:l,ratingsParameters:u,tournamentRecord:c,isMock:d=!0,drawProfile:p,startDate:f,drawIndex:m,uuids:h}=t,g=Oe(p,!1,!0),{excessParticipantAlternates:I=!0,matchUpFormat:v=Vs,drawType:w=Jo,tournamentAlternates:y=0,alternatesCount:b=0,qualifyingPositions:S,qualifyingProfiles:U,generate:T=!0,eventExtensions:P,drawExtensions:D,completionGoal:E,tieFormatName:R,buildTeams:C,seedsCount:M,timeItems:N,drawName:A,category:O,idPrefix:k,publish:F,gender:x,stage:L}=g,$=g.drawSize||(g.ignoreDefaults?void 0:32),V=g.eventId||Ct(),_=p.eventType||p.matchUpType||pl,B=_===fs?ft:It,G=wt(p.tieFormat)&&p.tieFormat||_===_t&&bc({event:{eventId:V,category:O,gender:x},namedFormat:R,hydrateCollections:o,isMock:d})||void 0,j=O?.categoryName||O?.ageCategoryCode||O?.ratingType,K=p.eventName||j||`Generated ${_}`,Y=c?.participants||[],X=(U?.flatMap(ce=>ce.structureProfiles||[]).reduce((ce,ye)=>{let be=!ye.participantsCount||ye.participantsCount>ye.drawSize?ye.drawSize:ye.participantsCount||0;return ce+be},0)||0)*(B===ft?2:1),Z=(!p.participantsCount||p.participantsCount>$?$:p.participantsCount)||0,J={eventName:K,eventType:_,tieFormat:G,category:O,eventId:V,gender:x};Array.isArray(N)&&N.forEach(ce=>Zh({event:J,timeItem:ce}));let{eventAttributes:ae}=p;if(typeof ae!="object"&&(ae={}),Object.assign(J,ae),P?.length&&Array.isArray(P)){let ce=P.filter(ml);ce?.length&&Object.assign(J,{extensions:ce})}let te=[];if(r?.participantsCount===0||p.uniqueParticipants||X||!c||x||O){let ce=(Z||0)+b+X,ye=ce,be={[tr]:0,[zr]:0},Fe,we;_===_t&&({teamSize:Fe,genders:we}=pG({alternatesCount:b,tieFormatName:R,tieFormat:G,drawSize:$}),Object.keys(we).forEach(Ee=>{let Le=ln(Ee);Le&&cl(Ee)&&we[Le]&&(be[Le]=$*we[Le])}),ye=Fe*(($||0)+X));let Ne=r?.idPrefix?`D-${m}-${r?.idPrefix}`:void 0,me=oy({...r,scaledParticipantsCount:p.scaledParticipantsCount||r.scaledParticipantsCount,participantsCount:ye,consideredDate:c?.startDate,sex:x||r?.sex,rankingRange:p.rankingRange,uuids:p.uuids||h,ratingsParameters:u,participantType:B,gendersCount:be,idPrefix:Ne,category:O}).participants;if(J.category&&(J.category.categoryName=j),c){let Ee=no({participants:me,tournamentRecord:c});if(Ee.error)return Ee}if(me.forEach(({participantId:Ee})=>te.push(Ee)),Y=me,_===_t){let Ee=we[tr]?me.filter(({participantType:Ue,person:ut})=>Ue===It&&ut?.sex===tr).map(yt):[],Le=we[zr]?me.filter(({participantType:Ue,person:ut})=>Ue===It&&cp(ut?.sex)).map(yt):[],Q=me.filter(({participantType:Ue})=>Ue===It).map(yt).filter(Ue=>!Ee.includes(Ue)&&!Le.includes(Ue)),se=[...g.teamNames??[],...cE({count:ce}).names],oe=Fe-(we[tr]+we[zr]),ue=0,ee=0,Se=0,De=Ce(0,ce).map(Ue=>{let ut=Le.slice(ue,ue+we[zr]),yi=Ee.slice(ee,ee+we[tr]),qe=Q.slice(Se,Se+oe);ue+=we[zr],ee+=we[tr],Se+=oe;let bi=C!==!1?[...ut,...yi,...qe]:[];return{participantName:se[Ue]||`Team ${Ue+1}`,participantOtherName:`TM${Ue+1}`,participantRole:Jr,individualParticipantIds:bi,participantType:_t,participantId:Ct()}}),it=no({participants:De,tournamentRecord:c});if(!it.success)return it;Y=De}}let ne=ce=>{let{participantType:ye}=ce;return Pi(pl)(_)&&ye===It||Pi(fs)(_)&&ye===ft?!0:_===_t&&ye===_t},le=ce=>!p.gender||ce.person?.sex===p.gender?!0:ce.individualParticipantIds?.some(ye=>{let be=Y.find(Fe=>Fe.participantId===ye);return be&&le(be)}),de=Y.filter(ne).filter(le).filter(({participantId:ce})=>!i.includes(ce)),pe=de.slice(0,Z).map(ce=>ce.participantId);if(d&&pe?.length){let ce=Qo({autoEntryPositions:s,entryStage:L,tournamentRecord:c,participantIds:pe,event:J});if(ce.error)return ce}let ge=X?de.slice(Z,Z+X).map(ce=>ce.participantId):0;if(d&&ge?.length){let ce=0,ye=1,be=(we,Ne)=>we.stageSequence-Ne.stageSequence,Fe=(we,Ne)=>we.roundTarget-Ne.roundTarget;for(let we of U.sort(Fe)){ye=we.roundTarget||ye;let Ne=1,me;for(let Ee of we.structureProfiles.sort(be)){let Le=(Ee.drawSize||q$(Ee.participantsCount))-(me||0),Q=ge.slice(ce,ce+Le),se=Qo({entryStage:ze,entryStageSequence:Ne,autoEntryPositions:s,tournamentRecord:c,participantIds:Q,roundTarget:ye,event:J});if(se.error)return se;me=Ee.qualifyingPositions,ce+=Le,Ne+=1}ye+=1}}let Me=I&&c?.participants?.filter(({participantId:ce})=>!pe.includes(ce)).filter(ne).filter(le).slice(0,b||$-Z||y).map(ce=>ce.participantId);if(d&&Me?.length){let ce=Qo({participantIds:Me,autoEntryPositions:!1,entryStatus:Gs,tournamentRecord:c,event:J});if(ce.error)return ce.error}let Pe=j||K;c&&M&&M<=pe.length&&Ce(1,M+1).forEach((ce,ye)=>{let be={scaleName:Pe,scaleDate:f,scaleType:D2,scaleValue:ce,eventType:_},Fe=pe[ye];Jv({tournamentRecord:c,participantId:Fe,scaleItem:be})});let Be=rT({...Oe(p,!1,!0),tournamentRecord:c,seedingScaleName:Pe,matchUpFormat:v,eventId:V,isMock:d,event:J});if(Be.error)return Be;if(!Be.drawDefinition)return{error:_a};let{drawDefinition:fe}=Be,Te=fe.drawId;if(Array.isArray(D)&&D.filter(ml).forEach(ce=>Ft({element:fe,extension:ce})),T){if(nT({drawDefinition:fe,event:J,suppressNotifications:!0}),p.withPlayoffs){let ye=fe.structures?.[0].structureId,be=mN({...p.withPlayoffs,tournamentRecord:c,drawDefinition:fe,structureId:ye,idPrefix:k,isMock:d,event:J});if(be?.error)return be}let ce=p.automated===!1;if(d&&!ce){let ye=be=>{let Fe=dE({completeAllMatchUps:be.completeAllMatchUps,completionGoal:be.completionGoal,matchUpStatusProfile:n,randomWinningSide:l,tournamentRecord:c,drawDefinition:fe,matchUpFormat:v,event:J});if(Fe.error)return Fe;let we=Fe.completedCount;if(w===gu){let Ne=fe.structures?.find(Le=>Le.stage===Ae);if(!Ne)return{error:vi};Kv({structureId:Ne.structureId,tournamentRecord:c,drawDefinition:fe});let me=E?E-(we??0):void 0,Ee=dE({completionGoal:E?me:void 0,matchUpStatusProfile:n,completeAllMatchUps:a,randomWinningSide:l,tournamentRecord:c,drawDefinition:fe,matchUpFormat:v,event:J});if(Ee.error)return Ee}};if(E&&ye({completionGoal:E}),p.outcomes){let{matchUps:be}=An({inContext:!0,drawDefinition:fe,event:J});for(let Fe of p.outcomes){let{matchUpStatus:we=Oi,matchUpStatusCodes:Ne,stageSequence:me=1,matchUpIndex:Ee=0,structureOrder:Le,matchUpFormat:Q,drawPositions:se,roundPosition:oe,stage:ue=Ae,roundNumber:ee,winningSide:Se,scoreString:De}=Fe,it=be?.reduce((qe,bi)=>{let{structureId:oi,matchUpId:nn}=bi;return qe[oi]?qe[oi].push(nn):qe[oi]=[nn],qe},{})??[],Ue=Object.assign({},...Object.keys(it).map((qe,bi)=>({[qe]:bi+1}))),ut=be?.filter(qe=>(!ue||qe.stage===ue)&&(!me||qe.stageSequence===me)&&(!ee||qe.roundNumber===ee)&&(!oe||qe.roundPosition===oe)&&(!Le||Ue[qe.structureId]===Le)&&(!se||Li(se,qe.drawPositions).length===2))?.[Ee],yi=rce({matchUpStatusCodes:Ne,tournamentRecord:c,drawDefinition:fe,targetMatchUp:ut,matchUpFormat:Q,matchUpStatus:we,scoreString:De,winningSide:Se});if(yi?.error)return yi}}a&&ye({completeAllMatchUps:a})}F&&ry({tournamentRecord:c,event:J})}else{let ce=XN({drawEntries:fe.entries,drawName:A||w,qualifyingPositions:S,drawId:Te,event:J,stage:L});if(ce.error)return ce}return{...W,event:je(J),uniqueParticipantIds:te,targetParticipants:Y,drawDefinition:fe,eventId:V,drawId:Te}}var lce=()=>({altitude:void 0,courtId:void 0,courtName:"",courtDimensions:void 0,latitude:void 0,longitude:void 0,surfaceCategory:void 0,surfaceType:void 0,surfacedDate:void 0,indoorOutdoor:void 0,floodlit:void 0,dateAvailability:[],onlineResources:[],pace:void 0,notes:void 0}),jWe=lce;function dA({tournamentRecord:t,disableNotice:e,venueId:i,courtId:r,court:n}){let{venue:a}=Ou({tournamentRecord:t,venueId:i});if(!a)return{error:If};a.courts||(a.courts=[]);let s={...lce(),venueId:i,courtId:r};if(s.courtId||(s.courtId=Ct()),a.courts.some(o=>o.courtId===s.courtId))return{error:fie};{let o=(n?.dateAvailability||[]).map(c=>({...c,date:Ze(c.date),startTime:pi(c.startTime),endTime:pi(c.endTime),bookings:c.bookings?.map(({startTime:d,endTime:p,bookingType:f})=>({startTime:pi(d),endTime:pi(p),bookingType:f}))})),l=Object.keys(s);for(let c of l)if(n?.[c])if(c==="dateAvailability"){let d=QM({dateAvailability:o});if(!d.valid&&d.error)return d;s.dateAvailability=o}else s[c]=n[c];let u=s;return a.courts.push(u),e||st({payload:{venue:a,tournamentId:t.tournamentId},topic:jc,key:a.venueId}),{...W,court:Oe(s),venueId:i}}}function hG(t){let{tournamentRecord:e,venueId:i}=t;if(typeof i!="string"||!i)return{error:zd};let r=t.tournamentRecords??(e&&{[e.tournamentId]:e})??{},n=[],a;for(let s of Object.values(r)){let{venue:o}=Ou({tournamentRecord:s,venueId:i});if(o){let l=GWe({...t,tournamentRecord:s});for(let u of l?.courts??[])n.push(u?.courtId);if(l.error)return l;a=!0}}return a?{...W,courtIds:n}:{error:If}}function GWe({courtNameRoot:t="Court",dateAvailability:e=[],venueAbbreviationRoot:i,tournamentRecord:r,courtNames:n=[],courtTimings:a,courtsCount:s,startTime:o,courtIds:l,endTime:u,idPrefix:c,venueId:d,dates:p}){if(!d)return{error:zd};let f=Ou({tournamentRecord:r,venueId:d});if(f.error)return f;let{venue:m}=f;if(!Ai(s)||!n)return{error:pie};s=s??n.length;let h=Ce(0,s).map(g=>{let I=a?.[g],v=I?p.map(w=>({date:Bs(w),startTime:o,endTime:u,...I})):e;return I&&o&&u&&v.push({startTime:o,endTime:u}),{courtName:n[g]||i&&m?.venueAbbreviation&&`${m?.venueAbbreviation} ${g+1}`||`${t} ${g+1}`,dateAvailability:v}}).map((g,I)=>{let v=l?.pop()||c&&`${c}-${I+1}`;return dA({disableNotice:!0,tournamentRecord:r,courtId:v,venueId:d,court:g})}).map(g=>g.court).filter(Boolean);return h.length!==s?q({info:"not all courts could be generated",result:{error:re}}):(m&&st({payload:{venue:m,tournamentId:r.tournamentId},topic:jc,key:m.venueId}),{...W,courts:Oe(h)})}function gG({tournamentRecord:t,ignoreExistingVenues:e,venueProfiles:i,uuids:r}){let{startDate:n,endDate:a}=t,s=[];for(let[o,l]of i.entries()){let{venueAbbreviation:u,venueId:c=r?.pop()??Ct(),dateAvailability:d,venueDateAvailability:p,defaultStartTime:f,defaultEndTime:m,startTime:h="07:00",endTime:g="19:00",courtTimings:I,courtsCount:v,courtNames:w,venueName:y,idPrefix:b,courtIds:S}=l,U={venueName:y||`Venue ${o+1}`,venueAbbreviation:u,venueId:c};f&&(U.defaultStartTime=f),m&&(U.defaultEndTime=m),l.isPrimary&&(U.isPrimary=!0),p&&(U.dateAvailability=p);let T=CU({tournamentRecord:t,venue:U});if(T.error){if(e)continue;return T}s.push(c);let P=UI(n,a),D=!Array.isArray(d)&&[{startTime:h,endTime:g}].concat(P.map(E=>({date:Bs(E),startTime:h,endTime:g})));if(v||w){let E=hG({dateAvailability:d||D,tournamentRecord:t,courtTimings:I,courtsCount:v,courtNames:w,startTime:h,idPrefix:b,courtIds:S,endTime:g,venueId:c,dates:P});if(E.error)return E}}return s}function HWe(t){let{tournamentRecord:e,leagueProfiles:i,eventIds:r,venueIds:n,drawIds:a,allUniqueParticipantIds:s,uuids:o}=t,l=0;for(let c of i){let d=[],{tieFormatName:p=VP,teamProfiles:f=[],teamsCount:m=0,category:h,idPrefix:g,gender:I}=c,v=c.leagueName??c.eventName??`League ${l+1}`,w=c.leagueId??c.eventId??o?.pop()??Ct();r.push(w);let y=wt(c.tieFormat)&&c.tieFormat||bc({event:{eventId:w,category:h,gender:I},namedFormat:p,isMock:t.isMock})||void 0;if(!y)return{error:Av};let b=Math.max(m,f.length),S=Ce(0,b),{genders:U,teamSize:T}=pG({tieFormat:y,drawSize:b}),P={[zr]:0,[Fh]:0,[zu]:0,[tr]:0,ANY:0};Object.keys(U).forEach(E=>P[E]+=U[E]);for(let E of S){let R=f?.[E]?.teamName??`Team ${E+1}`,C=f?.[E]?.teamId||o?.pop()||Ct(),M=c.startDate??t.startDate,N=oy({...c?.participantsProfile,participantsCount:T,consideredDate:M,gendersCount:P,category:h,uuids:o}).participants,A=N.map($=>$.participantId),O=_t,k=C??uE({participantType:O,idPrefix:g,index:E,uuids:o});d.push({participantId:k,entryStatus:ca,entryStage:Ae});let F=f?.[E]?.venueIds??[],x={participantId:k,participantRole:Jr,participantName:R,individualParticipantIds:A,participantType:O,homeVenueIds:F};F.forEach($=>!n.includes($)&&n.push($)),s.push(...A,k);let L=no({participants:[x,...N],tournamentRecord:e});if(L.error)return L}let D={eventName:v,entries:d,eventType:_t,tieFormat:y,category:h,eventId:w,gender:I};if(e.events||(e.events=[]),e.events.push(D),d.length){let E=(Ai(c.roundsCount)&&c.roundsCount)??c.roundsCount===xFe?(b-1)*2:b-1,R=rT({automated:c.automated,tournamentRecord:e,drawType:ua,roundsCount:E,drawSize:b,event:D});if(R.error)return R;let{drawDefinition:C}=R;if(C){let M=C?.drawId;nT({drawDefinition:C,event:D,suppressNotifications:!0}),a.push(M)}}l++}let u=n.map(c=>({venueId:c}));gG({tournamentRecord:e,ignoreExistingVenues:!0,venueProfiles:u,uuids:o})}var WWe=["Generated Tournament","CourtHive Challenge","Replication Crisis","Open Competition","Factory Follies","Mock Tournament","Atomic Culture","Racket Rally","Stats Fail"];function uce(t){let{startDate:e,endDate:i}=t??{},{tournamentName:r=ha(WWe),ratingsParameters:n=Pr,tournamentExtensions:a,policyDefinitions:s,schedulingProfile:o,venueProfiles:l,uuids:u}=t??{},c=t?.isMock===!1?void 0:!0;if(e&&!Mn(e)||i&&!Mn(i))return{error:or};if(t.leagueProfiles&&!Array.isArray(t.leagueProfiles)||t.eventProfiles&&!Array.isArray(t.eventProfiles)||t.drawProfiles&&!Array.isArray(t.drawProfiles))return{error:re};if(!e){let v=new Date;e=Bs(i??v),i=Bs(v.setDate(v.getDate()+7))}if(!i){let v=new Date(e);i=Bs(v.setDate(v.getDate()+7))}let d=uA({...t.tournamentAttributes??{},tournamentName:r,startDate:e,endDate:i,isMock:c}),p=l?.length?gG({tournamentRecord:d,venueProfiles:l,uuids:u}):[];if(a?.length&&Array.isArray(a)){let v=a.filter(w=>ml({extension:w}));v?.length&&Object.assign(d,{extensions:v,isMock:c})}if(typeof s=="object")for(let v of Object.keys(s))Yp({policyDefinitions:{[v]:s[v]},tournamentRecord:d});if(!t?.leagueProfiles?.length||t.eventProfiles?.length||t.drawProfiles?.length||t.participantsProfile){let v=ece({tournamentRecord:d,...t});if(!v.success)return v}let f=[],m=[],h=[];if(t.leagueProfiles){let v=HWe({allUniqueParticipantIds:f,tournamentRecord:d,...t,eventIds:m,venueIds:p,drawIds:h});if(v?.error)return v}if(t.drawProfiles){let v=zWe({allUniqueParticipantIds:f,ratingsParameters:n,tournamentRecord:d,...t,eventIds:m,drawIds:h});if(v?.error)return v}if(t.eventProfiles){let v=qWe({allUniqueParticipantIds:f,ratingsParameters:n,tournamentRecord:d,...t,eventIds:m,drawIds:h});if(v?.error)return v}let{scheduledRounds:g=void 0,schedulerResult:I={}}=o?YWe({...t,tournamentRecord:d}):{};return SB(),je({...W,tournamentRecord:d,scheduledRounds:g,schedulerResult:I,eventIds:m,venueIds:p,drawIds:h})}function zWe(t){let{tournamentRecord:e,drawProfiles:i,allUniqueParticipantIds:r,eventIds:n,drawIds:a}=t,s=0;for(let o of i){let l=cA({allUniqueParticipantIds:r,tournamentRecord:e,drawProfile:o,drawIndex:s,...t});if(l.error)return l;let{drawId:u,eventId:c,event:d,uniqueParticipantIds:p}=l;if(o?.addEvent!==!1){if(l=ty({suppressNotifications:!1,internalUse:!0,tournamentRecord:e,event:d}),l.error)return l;u&&a.push(u),n.push(c)}p?.length&&r.push(...p),s+=1}}function qWe(t){let{eventProfiles:e,allUniqueParticipantIds:i,eventIds:r,drawIds:n}=t,a=0;for(let s of e){let o=oce({...t,eventIndex:a,eventProfile:s});if(o.error)return o;let{eventId:l,drawIds:u,uniqueParticipantIds:c}=o;u&&n.push(...u),r.push(l),c?.length&&i.push(...c),a+=1}}function YWe(t){let{schedulingProfile:e,tournamentRecord:i,autoSchedule:r,periodLength:n,scheduleCompletedMatchUps:a}=t,s=VWe({schedulingProfile:e,tournamentRecord:i});if(s.error)return s;let o=s.scheduledRounds;if(r){let{tournamentId:l}=i,u={[l]:i};return{schedulerResult:oA({scheduleCompletedMatchUps:a,tournamentRecords:u,periodLength:n}),scheduledRounds:o}}return{scheduledRounds:o}}var cce={};dt(cce,{anonymizeTournamentRecord:()=>dce,modifyTournamentRecord:()=>fce});function dce({keepExtensions:t=[],anonymizeParticipantNames:e=!0,tournamentRecord:i,tournamentName:r,personIds:n=[],tournamentId:a}){if(!i)return{error:ve};let s=Array.isArray(t)?Zz.concat(...t):Zz,o=k=>Array.isArray(t)?k?.extensions?.filter(F=>s.includes(F.name)):k?.extensions,l={};i.extensions=o(i);let u=a||Ct();l[i.tournamentId]=u,i.tournamentId=u,i.createdAt=new Date().toISOString(),i.tournamentName=r||`Anonymized: ${Bs(new Date)}`,i.isMock=!0,delete i.parentOrganisation;for(let k of i.participants||[]){k.extensions=o(k),k.onlineResources=[];let F=Ct();l[k.participantId]=F,k.participantId=F}for(let k of i.participants||[])Array.isArray(k.individualParticipantIds)&&(k.individualParticipantIds=k.individualParticipantIds.map(F=>l[F]));let c=0;for(let k of i.venues||[]){k.venueAbbreviation=`V${c}`,k.extensions=o(k),k.venueName=`Venue #${c}`,k.onlineResources=[],k.addresses=[];let F=Ct();l[k.venueId]=F,k.isMock=!0,c+=1;let x=0;for(let L of k.courts||[])L.courtName=`V${c}C${x}`,L.extensions=o(L),L.onlineResources=[],L.isMock=!0,x+=1}let d=1;for(let k of i.events||[]){k.extensions=o(k),k.onlineResources=[],k.isMock=!0;let F=Ct();l[k.eventId]=F,k.eventId=F;let x=k.category?.categoryName||k.category?.ageCategoryCode||k.category?.ratingType||k.gender;if(k.eventName=`Event ${d} ${x}`,Array.isArray(k.entries))for(let $ of k.entries)$.participantId=l[$.participantId];for(let $ of k.drawDefinitions||[]){$.extensions=o($);let V=Ct();if(l[$.drawId]=V,$.drawId=V,$.isMock=!0,Array.isArray($.entries))for(let B of $.entries)B.participantId=l[B.participantId];let _=B=>{B.extensions=o(B);let G=Ct();l[B.structureId]=G,B.structureId=G;for(let j of B.positionAssignments||[])j.participantId&&(j.participantId=l[j.participantId]);for(let j of B.seedAssignments||[])j.participantId&&(j.participantId=l[j.participantId]);for(let j of B.matchUps||[]){j.isMock=!0;for(let K of j.sides||[])K.lineUp&&(K.lineUp=K.lineUp.map(({participantId:Y,collectionAssignments:X})=>({participantId:l[Y],collectionAssignments:X})))}};for(let B of $.structures||[])if(_(B),Array.isArray(B.structures))for(let G of B.structures)_(G);for(let B of $.links||[])B.source.structureId=l[B.source.structureId],B.target.structureId=l[B.target.structureId]}let{extension:L}=ht({name:to,element:k});Array.isArray(L?.value?.flights)&&L?.value.flights?.forEach($=>{if($.drawId=l[$.drawId],Array.isArray($.drawEntries))for(let V of $.drawEntries)V.participantId=l[V.participantId]}),d+=1}let p=i.startDate||Bs(new Date),f=(i.participants||[]).filter(({participantType:k})=>k===It),m=f.reduce((k,F)=>{let x=F.person?.sex,L=ln(x);return L&&cl(x)?k[L]+=1:k[zu]+=1,k},{[tr]:0,[zr]:0,[zu]:0}),h=Object.assign({},...Object.keys(m).map(k=>({[k]:Zue({category:{ageCategoryCode:"O18"},count:m[k],personExtensions:[],consideredDate:p,sex:k})?.persons||[]}))),g={[tr]:0,[zr]:0,[zu]:0},I=f.length,v=f.reduce((k,F)=>{let x=F.person?.addresses?.[0]||{},{city:L,state:$,postalCode:V}=x;return k.cities.includes(L)||k.cities.push(L),k.states.includes($)||k.states.push($),k.postalCodes.includes(V)||k.postalCodes.push(V),k},{cities:[],postalCodes:[],states:[]}),w=v.postalCodes.length,y=v.cities.length,b=v.states.length,{cities:S}=Kue({count:y||I,participantsCount:I}),{states:U}=Xue({count:b||I,participantsCount:I}),{postalCodes:T}=Jue({count:w||I,participantsCount:I}),P={cities:S,states:U,postalCodes:T};f.forEach((k,F)=>{let x=k?.person,L=x?.sex||zu,$=Ze(x?.birthDate)?.split("-")[0],V=g[L],_=h[L][V];if(g[L]+=1,$){let[,B,G]=_?.birthDate?.split("-")||[],j=[$,B,G].join("-");_.birthDate=j}if(x?.addresses){let B=Que({...P,participantIndex:F,nationalityCode:_.nationalityCode});_.addresses=[B]}_.personId=n?.[F]||Ct(),e?(_.standardFamilyName=_.lastName,_.standardGivenName=_.firstName,k.participantName=`${_.standardGivenName} ${_.standardFamilyName}`):(_.standardFamilyName=x?.standardFamilyName,_.standardGivenName=x?.standardGivenName),delete _.firstName,delete _.lastName,_.extensions=o(x),k.person=_,l[x?.personId]=_.personId}),(i.participants||[]).filter(({participantType:k})=>k===ft).forEach(k=>{let{individualParticipantIds:F}=k;k.participantName=KWe({individualParticipantIds:F,individualParticipants:f})});let D=(i.participants||[]).filter(({participantType:k})=>k===_t),E=D.length,R=cE({count:E}).names;D.forEach((k,F)=>{k.participantName=R[F]});let C=(i.participants||[]).filter(({participantType:k})=>k===Ya),M=C.length,N=cE({count:M,nameRoot:"Group"}).names;C.forEach((k,F)=>{k.participantName=N[F]});let{extension:A}=ht({element:i,name:Hm});Array.isArray(A?.value)&&A?.value.forEach(k=>{k.tournamentId=l[k.tournamentId],k.structureId=l[k.structureId],k.eventId=l[k.eventId],k.drawId=l[k.drawId]});let{extension:O}=ht({element:i,name:Bv});return Array.isArray(O?.value)&&O?.value.forEach(k=>{k.personId=l[k.personId]}),{...W}}function KWe({individualParticipantIds:t,individualParticipants:e}){let i=e.filter(({participantId:r})=>t.includes(r)).map(({person:r})=>r?.standardFamilyName).filter(Boolean).sort().join("/");return t.length===1&&(i+="/Unknown"),i}function XWe({event:t,eventProfile:e,tournamentRecord:i,allUniqueParticipantIds:r,drawIds:n}){let{gender:a,category:s,eventType:o}=t,{drawProfiles:l,publish:u}=e,c=Pi(pl)(o)&&It||Pi(fs)(o)&&ft||o;if(l){let{stageParticipantsCount:d,uniqueParticipantsCount:p,uniqueParticipantStages:f}=tce({drawProfiles:l,category:s,gender:a}),{uniqueDrawParticipants:m=[],uniqueParticipantIds:h=[]}=f?ace({event:{eventType:o,category:s,gender:a},uniqueParticipantsCount:p,participantsProfile:e.participantsProfile,ratingsParameters:e.ratingsParameters,tournamentRecord:i,eventProfile:e,uuids:e.uuids}):{};r.push(...h);let{stageParticipants:g}=ice({targetParticipants:i.participants||[],allUniqueParticipantIds:r,stageParticipantsCount:d,eventParticipantType:c}),I=sce({uniqueDrawParticipants:m,autoEntryPositions:e.autoEntryPositions,stageParticipants:g,tournamentRecord:i,drawProfiles:l,category:s,gender:a,event:t});if(I.error||(I=nce({matchUpStatusProfile:e.matchUpStatusProfile,completeAllMatchUps:e.completeAllMatchUps,randomWinningSide:e.randomWinningSide,tournamentRecord:i,drawProfiles:l,isMock:e.isMock,event:t}),I.error))return I;n.push(...I.drawIds)}return u&&ry({tournamentRecord:i,event:t}),W}function pce(t,e){return t?.find((i,r)=>e.eventIndex!==void 0&&r===e.eventIndex||e.eventName&&i.eventName===e.eventName||e.eventId&&i.eventId===e.eventId)}function JWe({event:t,eventProfile:e,tournamentRecord:i,allUniqueParticipantIds:r,drawIds:n,params:a}){return XWe({event:t,eventProfile:{...e,...a},tournamentRecord:i,allUniqueParticipantIds:r,drawIds:n})}function QWe({eventProfile:t,tournamentRecord:e,allUniqueParticipantIds:i,eventIds:r,drawIds:n,params:a,eventIndex:s}){let o=oce({startDate:e.startDate,allUniqueParticipantIds:i,matchUpStatusProfile:a.matchUpStatusProfile,participantsProfile:a.participantsProfile,completeAllMatchUps:a.completeAllMatchUps,autoEntryPositions:a.autoEntryPositions,randomWinningSide:a.randomWinningSide,ratingsParameters:t.ratingsParameters,tournamentRecord:e,eventProfile:t,eventIndex:s,uuids:a.uuids});if(o.error)return o;let{eventId:l,drawIds:u,uniqueParticipantIds:c}=o;return u&&n.push(...u),r.push(l),c?.length&&i.push(...c),{eventIndexIncrement:1}}function ZWe({eventProfiles:t,tournamentRecord:e,allUniqueParticipantIds:i,eventIds:r,drawIds:n,params:a}){let s=e.events?.length||0;for(let o of t){let l=pce(e.events,o);if(l){let u=JWe({event:l,eventProfile:o,tournamentRecord:e,allUniqueParticipantIds:i,drawIds:n,params:a});if(u?.error)return u}else{let u=QWe({eventProfile:o,tournamentRecord:e,allUniqueParticipantIds:i,eventIds:r,drawIds:n,params:a,eventIndex:s});if(u?.error)return u;s+=u?.eventIndexIncrement||1}}return W}function eze({drawProfiles:t,tournamentRecord:e,allUniqueParticipantIds:i,eventIds:r,drawIds:n,params:a}){let s=(e.events||[]).flatMap(o=>o.drawDefinitions?.map(()=>1)||[]).reduce((o,l)=>o+l,0);for(let o of t){let l=cA({startDate:e.startDate,allUniqueParticipantIds:i,matchUpStatusProfile:a.matchUpStatusProfile,participantsProfile:a.participantsProfile,completeAllMatchUps:a.completeAllMatchUps,autoEntryPositions:a.autoEntryPositions,hydrateCollections:a.hydrateCollections,randomWinningSide:a.randomWinningSide,ratingsParameters:a.ratingsParameters,tournamentRecord:e,drawProfile:o,drawIndex:s,uuids:a.uuids});if(l.error)return l;let{drawId:u,eventId:c,event:d,uniqueParticipantIds:p}=l;if(l=ty({tournamentRecord:e,event:d,internalUse:!0}),l.error)return l;u&&n.push(u),r.push(c),p?.length&&i.push(...p),s+=1}return W}function tze({schedulingProfile:t,autoSchedule:e,periodLength:i,tournamentRecord:r}){let n=[],a={};if(t?.length){let s={[r.tournamentId]:r},o=Zv({tournamentRecords:s,schedulingProfile:t});if(o.error)return o;if(e){let{tournamentId:l}=r,u={[l]:r};a=oA({tournamentRecords:u,periodLength:i})}}return{scheduledRounds:n,schedulerResult:a}}function fce(t){let{participantsProfile:e={},schedulingProfile:i,tournamentRecord:r,autoSchedule:n,eventProfiles:a,periodLength:s,venueProfiles:o,drawProfiles:l,uuids:u}=t;if(!r)return{error:ve};let c=[],d=[],p=[];a?.forEach(w=>{let y=pce(r.events,w);y?.gender&&(w.gender=y.gender)});let f=r.participants?.length||void 0;f&&e?.idPrefix&&(e.idPrefix=`${e.idPrefix}-${f}`);let m=ece({startDate:r.startDate,participantsProfile:e,tournamentRecord:r,eventProfiles:a,drawProfiles:l,uuids:u});if(!m.success)return m;if(a){let w=ZWe({eventProfiles:a,tournamentRecord:r,allUniqueParticipantIds:c,eventIds:d,drawIds:p,params:t});if(w.error)return w}if(l){let w=eze({drawProfiles:l,tournamentRecord:r,allUniqueParticipantIds:c,eventIds:d,drawIds:p,params:t});if(w.error)return w}let h=o?.length?gG({tournamentRecord:r,venueProfiles:o}):[],g=tze({tournamentRecord:r,schedulingProfile:i,autoSchedule:n,periodLength:s});if(g.error)return g;let{scheduledRounds:I,schedulerResult:v}=g;return{totalParticipantsCount:r.participants.length,scheduledRounds:I,schedulerResult:v,...W,eventIds:d,venueIds:h,drawIds:p}}var mce={};dt(mce,{addDynamicRatings:()=>RV,addIndividualParticipantIds:()=>eA,addParticipant:()=>Il,addParticipants:()=>no,addPenalty:()=>xce,addPersonRequests:()=>bce,addPersons:()=>Fce,createGroupParticipant:()=>Pce,createTeamsFromParticipantAttributes:()=>dG,deleteParticipants:()=>Kh,filterParticipants:()=>xU,findParticipant:()=>Dce,getCompetitionParticipants:()=>tj,getPairedParticipant:()=>ro,getParticipantEventDetails:()=>ij,getParticipantMembership:()=>rj,getParticipantScaleItem:()=>zm,getParticipantSchedules:()=>nj,getParticipantSignInStatus:()=>aj,getParticipantTimeItem:()=>g2,getParticipants:()=>Ri,getScaleValues:()=>_v,mergeParticipants:()=>Oce,modifyIndividualParticipantIds:()=>wce,modifyParticipant:()=>tA,modifyParticipantName:()=>Ece,modifyParticipantOtherName:()=>Uce,modifyParticipantsSignInStatus:()=>Sce,modifyPenalty:()=>Ace,modifyPersonRequests:()=>vce,mutate:()=>hce,participantScaleItem:()=>Xl,query:()=>yle,regenerateParticipantNames:()=>Tce,removeIndividualParticipantIds:()=>V2,removeParticipantIdsFromAllTeams:()=>nN,removePenalty:()=>Mce,removePersonRequests:()=>yce,removeRatings:()=>Cce,scaledTeamAssignment:()=>Rce,setParticipantScaleItem:()=>Jv,setParticipantScaleItems:()=>poe,validateLineUp:()=>sN});var hce={};dt(hce,{addDynamicRatings:()=>RV,addIndividualParticipantIds:()=>eA,addParticipant:()=>Il,addParticipants:()=>no,addPenalty:()=>xce,addPersonRequests:()=>bce,addPersons:()=>Fce,createGroupParticipant:()=>Pce,createTeamsFromParticipantAttributes:()=>dG,deleteParticipants:()=>Kh,findParticipant:()=>Dce,mergeParticipants:()=>Oce,modifyIndividualParticipantIds:()=>wce,modifyParticipant:()=>tA,modifyParticipantName:()=>Ece,modifyParticipantOtherName:()=>Uce,modifyParticipantsSignInStatus:()=>Sce,modifyPenalty:()=>Ace,modifyPersonRequests:()=>vce,regenerateParticipantNames:()=>Tce,removeIndividualParticipantIds:()=>V2,removeParticipantIdsFromAllTeams:()=>nN,removePenalty:()=>Mce,removePersonRequests:()=>yce,removeRatings:()=>Cce,scaledTeamAssignment:()=>Rce,setParticipantScaleItem:()=>Jv,setParticipantScaleItems:()=>poe});function gce(t=0){(typeof t!="number"||isNaN(t))&&(t=0);let e=new Date;return e.setHours(e.getHours()+t),e.getTime().toString(36).slice(-6).toUpperCase()}function Ice({personRequests:t,personId:e,requests:i}){t[e]||(t[e]=[]);let r=i.filter(({requestType:n})=>n).map(n=>{let{date:a,startTime:s,endTime:o}=n;return n.requestType===oT&&(a=Ze(a),s=pi(s),o=pi(o),a&&s&&o)?{date:a,startTime:s,endTime:o,requestType:n.requestType}:n}).filter(Boolean);for(let n of r)n.requestId=gce(),t[e].push(n);return{mergeCount:r.length}}function IG(t){let{tournamentRecords:e,personRequests:i}=t,r=He(t,[{[pn]:!0}]);if(r.error)return r;if(!i)return{...W};let n=Object.values(e);for(let a of n){let s=a.participants??[],o=[];for(let l of Object.keys(i))if(Ud({tournamentParticipants:s,personId:l})){let u=i[l];u.length&&o.push({personId:l,requests:u})}Object.keys(o).length&&Ft({element:a,extension:{value:o,name:Bv}})}return{...W}}function vce(t){let{tournamentRecords:e,requests:i,personId:r}=t,n=He(t,[{[pn]:!0},{requests:!0,[qn]:sn,[Ba]:re}]);if(n.error)return n;let a=i.map(({requestId:u})=>u).filter(Boolean),{personRequests:s}=Ef({tournamentRecords:e}),o=u=>{s&&(s[u]=s[u].map(c=>{if(!a.includes(c.requestId))return c;let d=i.find(p=>p.requestId===c.requestId);if(d.requestType)return Object.assign(c,d)}).filter(Boolean))};if(r&&s?.[r])o(r);else if(s)for(let u of Object.keys(s))o(u);let l=i.filter(u=>!u.requestId);return l.length&&Ice({personRequests:s,personId:r,requests:l}),IG({tournamentRecords:e,personRequests:s})}function yce(t){let{tournamentRecords:e,requestType:i,requestId:r,personId:n,date:a}=t,s=He(t,[{[pn]:!0}]);if(s.error)return s;let{personRequests:o}=Ef({tournamentRecords:e}),l=c=>{o&&(o[c]=o[c].filter(d=>(!i||d.requestType!==i)&&(!r||d.requestId!==r)&&(!a||d.date!==a)),o?.[c]?.length||delete o[c])},u=!i&&!r&&!n&&!a;if(!u){if(n&&o?.[n])l(n);else if(o)for(let c of Object.keys(o))l(c)}return u||!o||!Object.keys(o).length?Nn({name:Bv,tournamentRecords:e,discover:!0}):IG({tournamentRecords:e,personRequests:o})}function bce(t){let{tournamentRecords:e,personId:i,requests:r}=t,n=He(t,[{[pn]:!0,[jFe]:!0},{requests:!0,[qn]:sn,[Ba]:re}]);if(n.error)return n;let{personRequests:a}=Ef({tournamentRecords:e}),{mergeCount:s}=Ice({personRequests:a,personId:i,requests:r});return s&&a?IG({tournamentRecords:e,personRequests:a}):{error:re}}function wce({individualParticipantIds:t,groupingParticipantId:e,tournamentRecord:i}){let r="modifyIndividualParticipantIds";if(!i)return q({result:{error:ve},stack:r});if(!e||!t)return q({result:{error:Je},stack:r});let n=i.participants||[],a=n.find(f=>f.participantId===e);if(!a)return q({result:{error:ji},stack:r});if(![_t,Ya].includes(a.participantType))return q({result:{error:Mo},context:{participantType:a.participantType},stack:r});let s=t.filter(f=>n.find(m=>m.participantId===f)?.participantType!==It);if(s.length)return q({result:{error:Ia,invalidParticipantIds:s},stack:r});let o=a.individualParticipantIds||[],l=t.filter(f=>!o.includes(f)),u=o.filter(f=>!t.includes(f)),c=eA({individualParticipantIds:l,groupingParticipantId:e,tournamentRecord:i});if(c.error)return q({result:c,stack:r});let d=V2({individualParticipantIds:u,groupingParticipantId:e,tournamentRecord:i});if(d.error)return q({result:d,stack:r});let{topics:p}=bs();if(p.includes(rn)){let f=n.find(({participantId:m})=>m===e);st({topic:rn,payload:{tournamentId:i.tournamentId,participants:[f]}})}return{...c,...d}}function Sce({tournamentRecord:t,participantIds:e,signInState:i}){if(!t)return{error:ve};if(!Array.isArray(e))return{error:Je};if(![ew,Rne].includes(i))return{error:re,signInState:i};let r=t.participants||[];if(!r.length)return{error:tU};let n=r.map(yt),a=e.filter(u=>!n.includes(u));if(a.length)return{error:re,context:{invalidParticipantIds:a}};let s=[],o=new Date().toISOString();for(let u of r){let{participantId:c}=u;if(e.includes(c)){let d=hV({duplicateValues:!1,tournamentRecord:t,participantId:c,timeItem:{itemType:IU,itemValue:i,createdAt:o}});if(d.error)return d;s.push(u)}}let{topics:l}=bs();return s.length&&l.includes(rn)&&st({topic:rn,payload:{tournamentId:t.tournamentId,participants:s}}),{...W}}function Uce({tournamentRecord:t,participantId:e,participantOtherName:i}){if(!t)return{error:ve};if(!e)return{error:dr};let{participant:r}=Xd({tournamentRecord:t,participantId:e});if(!r)return{error:ji};r.participantOtherName=i;let{topics:n}=bs();return n.includes(rn)&&st({topic:rn,payload:{tournamentId:t.tournamentId,participants:[r]}}),{...W}}function Jq({personFormat:t,person:e}){let i=h=>h.replace(/\W/g,""),r=h=>/^[a-z]*$/.test(i(h)),n=h=>/^[A-Z]*$/.test(i(h)),a=h=>/^[LAST]{4}/.test(i(h)),s=h=>h.toLowerCase().indexOf("l")<h.toLowerCase().indexOf("f"),o=h=>h.indexOf(",")>=0,l=h=>h.toLowerCase().indexOf("f.")>=0,u=h=>h.toLowerCase().indexOf("f")<0,c=h=>h.indexOf(" ")>0;if(!e)return;let d=c(t)?" ":"",p=Mx(e?.standardGivenName??""),f=Mx(e?.standardFamilyName??"");if(!t)return`${p}${d}${f}`;l(t)&&!o(t)&&!s(t)&&(p=`${p[0]}.`),r(t)?(p=p.toLowerCase(),f=f.toLowerCase()):n(t)?(p=p.toUpperCase(),f=f.toUpperCase()):a(t)&&(f=f.toUpperCase());let m=`${p}${d}${f}`;return u(t)?m=f:s(t)&&(o(t)?m=`${f},${d}${p}`:m=`${f}${d}${p}`),m}function ize({participantMap:t,participant:e,formats:i}){let{participantType:r,individualParticipantIds:n,person:a}=e,s=r&&i[r];if(r!==$n&&s){let{personFormat:o,doublesJoiner:l}=s;r===It&&(e.participantName=Jq({person:a,personFormat:o})),r===ft&&(e.participantName=n?.map(u=>{let c=t[u]?.person;return Jq({person:c,personFormat:o})}).filter(Boolean).join(l??"/"))}}function Tce({tournamentRecord:t,formats:e}){if(!t)return{error:ve};if(!wt(e))return{error:Je};let i=t.participants??[],r=ote(i,"participantId");for(let n of i)ize({participant:n,participantMap:r,formats:e});return{...W}}function Dce(t){let{tournamentRecord:e,policyDefinitions:i,contextProfile:r,participantId:n,personId:a}=t,s=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(typeof n!="string"&&typeof a!="string")return{error:Je,stack:"publicFindParticipant"};let o,l;for(let u of Object.values(s)){l=u.tournamentId;let c=u.participants||[];if(o=Ud({tournamentParticipants:c,internalUse:!0,policyDefinitions:i,contextProfile:r,participantId:n,personId:a}),o)break}return{participant:o,tournamentId:l,...W}}function Pce({individualParticipantIds:t=[],participantRoleResponsibilities:e,participantRole:i=Oae,tournamentRecord:r,participantId:n,groupName:a}){if(!r)return{error:ve};if(!a)return{error:Je,info:"Missing groupName"};if(!Array.isArray(t))return{info:"Invalid individualParticipantIds",error:re};let s=(Ri({participantFilters:{participantTypes:[It]},tournamentRecord:r}).participants??[]).map(c=>c.participantId);for(let c of t)if(!s.includes(c))return{error:Mo,participantId:c};let o=je({participantId:n||Ct(),participantRoleResponsibilities:e,participantName:a,individualParticipantIds:t,participantType:Ya,participantRole:i}),l=Il({participant:o,tournamentRecord:r});if(l.error)return l;let{topics:u}=bs();return u.includes(Td)&&st({topic:Td,payload:{tournamentId:r.tournamentId,participants:[o]}}),{...W,participant:Oe(o)}}function Ece({tournamentRecord:t,participantName:e,participantId:i}){if(!t)return{error:ve};if(!i)return{error:dr};if(!e)return{error:Je,info:"Missing participantName"};let{participant:r}=Xd({tournamentRecord:t,participantId:i});if(!r)return{error:ji};r.participantName=e;let{topics:n}=bs();return n.includes(rn)&&st({topic:rn,payload:{tournamentId:t.tournamentId,participants:[r]}}),{...W}}function Rce({clearExistingAssignments:t=!0,individualParticipantIds:e,reverseAssignmentOrder:i,initialTeamIndex:r=0,scaledParticipants:n=[],teamParticipantIds:a,tournamentRecord:s,scaleAttributes:o,teamNameBase:l,teamsCount:u,eventId:c,event:d}){if(!s)return{error:ve};if(!Array.isArray(a)&&!lt(u)&&!c||!lt(r)||n&&!Array.isArray(n)||o&&(typeof o!="object"||!Object.keys(o).length))return{error:re};if(!o&&!n.length||!n&&!(e&&o))return{error:Je,info:"Missing scaling details"};if(c&&!a){if(d?.eventType!==Ua)return{error:cu};a=d?.entries?.filter(({entryStatus:I})=>I===ca).map(yt)}if(!a?.length&&!u)return{info:"Missing teamParticipantIds or teamsCount",error:Je};let p=e??n.map(({participantId:I})=>I);i&&(a?.reverse(),r+=1),r>(a?.length||0)-1&&(r=0);let f=a?.slice(r).concat(...a.slice(0,r))??[],m=[];for(let I of s.participants??[]){let{participantId:v,participantType:w}=I;if(f.includes(v)){if(w!==$n)return{error:Mo,participant:I};m.push(I)}}if(u&&m.length<u){let I=u-(m?.length||0),v=l??"Team",w=Ce(0,I).map(U=>({participantName:`${v} ${U+1}`,participantType:$n,participantRole:Jr})),{participants:y=[]}=no({participants:w,returnParticipants:!0,tournamentRecord:s}),b=y.map(yt),S=s.participants?.filter(({participantId:U})=>b.includes(U))??[];m.push(...S)}if(!m.length)return{error:hB};if(t)for(let I of m)I.individualParticipantIds=[];else{let I=m.map(v=>v).flat();e?.length?p=p.filter(v=>!I.includes(v)):n=n?.filter(({participantId:v})=>!I.includes(v))}if(!e?.length&&!n?.length)return{error:IM,info:"Nothing to be done"};if(!n.length){for(let I of s.participants??[]){let{participantId:v,participantType:w}=I;if(!p.includes(v))continue;if(w!==It)return{error:Mo,participant:I};let y=Xl({scaleAttributes:o,participant:I})?.scaleItem,b=o?.accessor?y?.scaleValue?.[o?.accessor]:y?.scaleValue,S={participantId:v,scaleValue:b};n.push(S)}if(!n.length)return{error:ji}}n.sort((I,v)=>o?.sortOrder?(v?.scaleValue||0)-(I?.scaleValue||0):(I?.scaleValue||1/0)-(v?.scaleValue||1/0));for(let I of n)if(!I.participantId)return{error:re,scaledParticipant:I};let h=0;for(;h<n.length;){for(let I of m){if(h+1>n.length)break;let v=n[h];I.individualParticipantIds.push(v.participantId),h++}m.reverse()}let g=m.map(yt);for(let I of s.events??[]){if(I.eventType!==Ua)continue;let v=(I.entries??[]).filter(w=>g.includes(w.participantId));for(let w of v){let y=w.participantId,b=m.find(U=>U.participantId===y)?.individualParticipantIds;I.entries=(I.entries??[]).filter(U=>!b.includes(U.participantId)),(I.drawDefinitions??[]).forEach(U=>{U.entries=(U.entries??[]).filter(T=>!b.includes(T.participantId))});let{flightProfile:S}=Bi({event:I});(S?.flights||[]).forEach(U=>{U.drawEntries=(U.drawEntries||[]).filter(T=>!b.includes(T.participantId))})}}return{...W,scaledParticipants:n}}function Cce(t){let e=He(t,[{[hr]:!0,[VB]:!0},{ratingType:!1,[qr]:s=>Pr[s]}]);if(e.error)return e;let i=`${t.ratingType}.${WB}`,r=t.asDynamic?i:t.ratingType,n=[Sd,ud,t.eventType,r].join("."),a=t.tournamentRecord.participants??[];for(let s of a)s.timeItems&&(s.timeItems=s.timeItems.filter(o=>o.itemType!==n));return{...W}}function Mce(t){let{tournamentRecords:e}=t;if(typeof e!="object"||!Object.keys(e).length)return{error:Mi};for(let i of Object.values(e)){let r=rze({...t,tournamentRecord:i});if(r.error&&r.error!==wI)return r}return{...W}}function rze({tournamentRecord:t,penaltyId:e}){if(!t)return{error:ve};if(!e)return{error:cB};let i=t?.participants??[],r=[],n=!1,a;return i.forEach(s=>{let o=!1;s.penalties=(s.penalties??[]).filter(l=>(l.penaltyId===e&&(o=!0,n||(a=l,n=!0)),o&&r.push(s),l.penaltyId!==e))}),a&&st({topic:rn,payload:{tournamentId:t.tournamentId,participants:r}}),a?{...W,penalty:a}:{error:wI}}var nze=({penaltyId:t=Ct()}={})=>({refereeParticipantId:void 0,penaltyCode:void 0,penaltyType:void 0,extensions:void 0,matchUpId:void 0,createdAt:void 0,issuedAt:void 0,notes:void 0,penaltyId:t}),Nce=nze;function Ace(t){let{tournamentRecords:e}=t;if(typeof e!="object"||!Object.keys(e).length)return{error:Mi};for(let i of Object.values(e)){let r=aze({...t,tournamentRecord:i});if(r.error&&r.error!==wI||r.success)return r}return{error:wI}}function aze({tournamentRecord:t,modifications:e,penaltyId:i}){if(!t)return{error:ve};if(!e)return{error:re,modifications:e};if(!i)return{error:cB};let r=t?.participants??[],n=Object.keys(Nce()).filter(l=>l!=="penaltyId"),a=Object.keys(e).filter(l=>n.includes(l));if(!a.length)return{error:vM};let s,o=[];return r.forEach(l=>{let u=!1;l.penalties=(l.penalties??[]).map(c=>(c.penaltyId===i&&(u=!0,a.forEach(d=>Object.assign(c,{[d]:e[d]})),s||(s=c)),c)),u&&o.push(l)}),s&&st({topic:rn,payload:{tournamentId:t.tournamentId,participants:o}}),s?{...W,penalty:s}:{error:wI}}function kce(t,e,i){return!t&&e?e:t&&!e||typeof t!="object"||typeof e!="object"?t:nt(Object.keys(t).concat(Object.keys(e))).reduce((r,n)=>{if(!e[n])r[n]=t[n];else if(!t[n])r[n]=e[n];else if(typeof t[n]!=typeof e[n])r[n]=e[n];else if(Array.isArray(t[n]))if(i===!0||Array.isArray(i)&&i.includes(n)){let a=nt(t[n].map(s=>JSON.stringify(s)).concat(e[n].map(s=>JSON.stringify(s)))).map(s=>JSON.parse(s));r[n]=a}else r[n]=e[n];else typeof t[n]=="object"?r[n]=kce(t[n],e[n],i):r[n]=e[n];return r},{})}function Oce({participants:t=[],tournamentRecord:e,arraysToMerge:i}){if(!e)return{error:ve};e.participants||(e.participants=[]);let r=t.filter(Pa(Iu)).map(u=>({[u.participantId]:u})),n=Object.assign({},...r),a=[];e.participants=e.participants.map(u=>{if(n[u.participantId]){let c=kce(u,n[u.participantId],i);return a.push(c),c}return u});let s=e.participants.map(Pa(Iu))||[],o=t.filter(({participantId:u})=>!s.includes(u)),{topics:l}=bs();return o.length&&(e.participants=e.participants.concat(...o),l.includes(Td)&&st({topic:Td,payload:{participants:o}})),a.length&&l.includes(rn)&&st({topic:rn,payload:{tournamentId:e.tournamentId,participants:a}}),{modifiedParticipantsCount:a.length,newParticipantsCount:o.length,...W}}function xce(t){let{tournamentRecord:e,participantIds:i}=t,r=t.tournamentRecords??(e&&{[e.tournamentId]:e})??{},n;for(let a of Object.values(r)){let s=(Ri({tournamentRecord:a}).participants??[])?.map(yt).filter(o=>i.includes(o));s.length&&(n=sze({...t,penaltyId:t.penaltyId??n,tournamentRecord:a,participantIds:s}).penaltyId)}return n?{...W,penaltyId:n}:{error:ji}}function sze({refereeParticipantId:t,tournamentRecord:e,participantIds:i,penaltyCode:r,penaltyType:n,extensions:a,penaltyId:s,matchUpId:o,issuedAt:l,notes:u}){if(!e)return{error:ve};if(!i)return{error:dr};if(!n)return{error:die};let c=(e?.participants??[]).filter(f=>i.includes(f.participantId));if(!c.length)return{error:ji};let d=new Date().toISOString(),p=Object.assign(Nce({penaltyId:s}),{refereeParticipantId:t,penaltyCode:r,penaltyType:n,matchUpId:o,createdAt:d,issuedAt:l,notes:u});return Array.isArray(a)&&a.forEach(f=>Ft({element:p,extension:f})),c.forEach(f=>{f.penalties??=[],f.penalties.push(p)}),st({topic:rn,payload:{tournamentId:e.tournamentId,participants:c}}),{...W,penaltyId:p.penaltyId}}function Fce({participantRole:t=Jr,tournamentRecord:e,persons:i}){if(!e)return{error:ve};if(!Array.isArray(i))return{error:re};if(!Object.keys(B2).includes(t))return{error:eie};let r=new Set((e.participants||[]).map(({person:m})=>m?.personId).filter(Boolean)),n=[],a=i.filter(m=>m&&(!m.personId||!r.has(m.personId))).map(m=>(m.personId||(m.personId=Ct()),n.push(m.personId),m)),s=(m,h)=>Object.assign({},...Object.keys(m).filter(g=>!h.includes(g)).map(g=>({[g]:m[g]}))),o=a.map(m=>je({extensions:m.participantExtensions,timeItems:m.participantTimeItems,participantType:It,participantRole:t,person:s(m,["participantExtensions","participantTimeItems","pairedPersons"])})),l=0,u,c=no({participants:o,tournamentRecord:e});if(c.error)return c;u=c.addedCount||0;let d=[],p=Ri({participantFilters:{participantTypes:[It]},tournamentRecord:e})?.participants??[];if(t===Jr&&i.filter(({pairedPersons:m})=>m).forEach(({personId:m,pairedPersons:h})=>{Array.isArray(h)&&h.forEach(g=>{let I=[m,g.personId].map(v=>Ud({tournamentParticipants:p,personId:v})).filter(Boolean);if(I.length===2){let v=I.map(yt);d.push(je({extensions:g.participantExtensions,timeItems:g.timeItems,participantRole:Jr,individualParticipantIds:v,participantType:ft}))}})}),d.length){if(c=no({participants:d,tournamentRecord:e}),c.error)return c;l=c.addedCount||0}let f=u+l;return{...W,addedCount:f,newPersonIds:n}}var Lce={};dt(Lce,{bulkUpdatePublishedEventIds:()=>mj,getAllEventData:()=>hj,getCourtInfo:()=>ZM,getDrawData:()=>IN,getEventData:()=>KU,getEventPublishStatus:()=>Qa,getPublishState:()=>Yh,getTournamentPublishStatus:()=>OU,getVenueData:()=>AI,mutate:()=>_ce,publishEvent:()=>ry,publishEventSeeding:()=>$ce,publishOrderOfPlay:()=>Hce,publishParticipants:()=>Gce,query:()=>Ple,setEventDisplay:()=>KN,unPublishEvent:()=>Wce,unPublishEventSeeding:()=>Bce,unPublishOrderOfPlay:()=>jce,unPublishParticipants:()=>Vce});var _ce={};dt(_ce,{publishEvent:()=>ry,publishEventSeeding:()=>$ce,publishOrderOfPlay:()=>Hce,publishParticipants:()=>Gce,setEventDisplay:()=>KN,unPublishEvent:()=>Wce,unPublishEventSeeding:()=>Bce,unPublishOrderOfPlay:()=>jce,unPublishParticipants:()=>Vce});function $ce({removePriorValues:t=!0,stageSeedingScaleNames:e,seedingScaleNames:i,tournamentRecord:r,status:n=Xa,drawIds:a=[],event:s}){if(!r)return{error:ve};if(!s)return{error:ui};let o=Qa({event:s,status:n}),l=(o?.seeding?.seedingScaleNames||i)&&{...o?.seeding?.seedingScaleNames,...i},u=(o?.seeding?.stageSeedingScaleNames||e)&&{...o?.seeding?.stageSeedingScaleNames,...e},c=je({stageSeedingScaleNames:u,seedingScaleNames:l,published:!0,drawIds:a});return iy({statusObject:{seeding:c},removePriorValues:t,status:n,event:s}),st({topic:Une,payload:{tournamentId:r.tournamentId,eventId:s.eventId,drawIds:a}}),{...W}}function Bce({removePriorValues:t=!0,seedingScaleNames:e,tournamentRecord:i,status:r=Xa,drawIds:n,stages:a,event:s}){if(!i)return{error:ve};if(!s)return{error:ui};let o=Qa({event:s});if(o){let l=o.seeding;if(Array.isArray(a)&&l.stageSeedingScaleNames)for(let u of a)l.stageSeedingScaleNames[u]&&delete l.stageSeedingScaleNames[u];Array.isArray(e)&&l?.seedingScaleNames&&(l.seedingScaleNames=l.seedingScaleNames.filter(u=>!e.includes(u))),Array.isArray(n)&&l?.drawIds&&(l.drawIds=l.drawIds.filter(u=>!n.includes(u))),(!Object.values(l.stageSeedingScaleNames??{}).length&&!l.seedingScaleNames?.length&&!l.drawIds?.length||!a&&!e&&!n?.length)&&(delete l.stageSeedingScaleNames,delete l.seedingScaleNames,delete l.drawIds,l.published=!1),iy({statusObject:{seeding:l},removePriorValues:t,status:r,event:s})}return st({topic:p2,payload:{tournamentId:i.tournamentId,eventId:s.eventId}}),{...W}}function Vce(t){let e=ws(t);if(!Object.keys(e).length)return{error:Mi};for(let i of Object.values(e)){let r=oze({tournamentRecord:i,...t});if(r.error)return r}return{...W}}function oze({removePriorValues:t=!0,tournamentRecord:e,status:i=Xa}){if(!e)return{error:ve};let r=`${Jd}.${Qd}`,{timeItem:n}=Ss({element:e,itemType:r}),a=n?.itemValue||{[i]:{}};return a[i]&&delete a[i].participants,Cl({timeItem:{itemValue:a,itemType:r},element:e,removePriorValues:t}),st({payload:{tournamentId:e.tournamentId},topic:ILe}),{...W}}function jce(t){let e=ws(t);if(!Object.keys(e).length)return{error:Mi};for(let i of Object.values(e)){let r=lze({tournamentRecord:i,...t});if(r.error)return r}return{...W}}function lze({removePriorValues:t=!0,tournamentRecord:e,status:i=Xa}){if(!e)return{error:ve};let r=`${Jd}.${Qd}`,{timeItem:n}=Ss({element:e,itemType:r}),a=n?.itemValue||{[i]:{}};return a[i]&&delete a[i].orderOfPlay,Cl({timeItem:{itemValue:a,itemType:r},element:e,removePriorValues:t}),st({topic:f2,payload:{tournamentId:e.tournamentId}}),{...W}}function Gce(t){let e=ws(t);if(!Object.keys(e).length)return{error:Mi};for(let i of Object.values(e)){let r=uze({tournamentRecord:i,...t});if(r.error)return r}return{...W}}function uze({removePriorValues:t,tournamentRecord:e,status:i=Xa,embargo:r}){if(!e)return{error:ve};let n=`${Jd}.${Qd}`,{timeItem:a}=Ss({element:e,itemType:n}),s=a?.itemValue||{[i]:{}},o={published:!0};return r&&!nd(r)?{error:kg}:(r&&(o.embargo=r),s[i].participants=o,Cl({timeItem:{itemValue:s,itemType:n},element:e,removePriorValues:t}),st({payload:{tournamentId:e.tournamentId},topic:Dne}),{...W})}function Hce(t){let e=ws(t);if(!Object.keys(e).length)return{error:Mi};for(let i of Object.values(e)){let r=cze({tournamentRecord:i,...t});if(r.error)return r}return{...W}}function cze({scheduledDates:t=[],removePriorValues:e,tournamentRecord:i,status:r=Xa,eventIds:n=[],embargo:a}){if(!i)return{error:ve};let s=`${Jd}.${Qd}`,{timeItem:o}=Ss({element:i,itemType:s}),l=o?.itemValue||{[r]:{}},u={published:!0,scheduledDates:t,eventIds:n};return a&&!nd(a)?{error:kg}:(a&&(u.embargo=a),l[r].orderOfPlay=u,Cl({timeItem:{itemValue:l,itemType:s},element:i,removePriorValues:e}),st({topic:Tne,payload:{tournamentId:i.tournamentId,scheduledDates:t,eventIds:n}}),{...W})}function Wce({removePriorValues:t=!0,tournamentRecord:e,status:i=Xa,event:r}){if(!e)return{error:ve};if(!r)return{error:ui};let n=`${Jd}.${Qd}`,{timeItem:a}=vU({itemType:n,event:r}),s=a?.itemValue||{[i]:{}};return delete s[i].structureIds,delete s[i].drawDetails,delete s[i].drawIds,Zh({event:r,timeItem:{itemValue:s,itemType:n},removePriorValues:t}),iy({statusObject:{structureIds:void 0,drawIds:void 0,seeding:void 0},removePriorValues:t,status:i,event:r}),st({topic:d2,payload:{tournamentId:e.tournamentId,eventId:r.eventId}}),{eventId:r.eventId,...W}}var vG={};dt(vG,{applyTournamentRankingPoints:()=>Xce,generateRankingList:()=>qce,getAwardPoints:()=>aE,getAwardProfile:()=>pj,getParticipantPoints:()=>Yce,getQualityWinPoints:()=>dj,getTournamentPoints:()=>Qv,mutate:()=>Kce,query:()=>zce});var zce={};dt(zce,{generateRankingList:()=>qce,getAwardPoints:()=>aE,getAwardProfile:()=>pj,getParticipantPoints:()=>Yce,getQualityWinPoints:()=>dj,getTournamentPoints:()=>Qv});function pE({awards:t,pointComponents:e,bestOfCount:i,maxResultsPerLevel:r,mandatoryRules:n}){let a=t.map(d=>{let p=0;for(let f of e)p+=typeof d[f]=="number"?d[f]:0;return{award:d,value:p}});a.sort((d,p)=>p.value-d.value);let s=a,o=[];if(r){let d={};s=[];for(let p of a){let f=p.award.level;f===void 0||!r[f]?s.push(p):(d[f]=(d[f]||0)+1,d[f]<=r[f]?s.push(p):o.push(p))}}if(n?.length)return dze(s,o,i,n);let l=i>0?s.slice(0,i):s,u=[...i>0?s.slice(i):[],...o],c=l.reduce((d,p)=>d+p.value,0);return{counting:l,dropped:u,bucketTotal:c}}function dze(t,e,i,r){let n=new Set;for(let p of r){let f=new Set(p.levels),m=[];for(let g=0;g<t.length;g++){let I=t[g].award.level;I!==void 0&&f.has(I)&&m.push(g)}let h=p.bestOfCount?m.slice(0,p.bestOfCount):m;for(let g of h)n.add(g)}let a=[],s=[];for(let p=0;p<t.length;p++)n.has(p)?a.push(t[p]):s.push(t[p]);let o,l;if(i>0){let p=Math.max(0,i-a.length);o=s.slice(0,p),l=s.slice(p)}else o=s,l=[];let u=[...a,...o],c=[...l,...e],d=u.reduce((p,f)=>p+f.value,0);return{counting:u,dropped:c,bucketTotal:d}}function qce({pointAwards:t,aggregationRules:e={},categoryFilter:i,asOfDate:r}){let{rollingPeriodDays:n,countingBuckets:a,tiebreakCriteria:s=[],minCountableResults:o=0,maxResultsPerLevel:l,bestOfCount:u}=e,c=t;if(i&&(c=c.filter(m=>{if(i.ageCategoryCodes?.length){let h=m.category?.ageCategoryCode;if(!h||!i.ageCategoryCodes.includes(h))return!1}if(i.genders?.length){let h=m.category?.gender||m.gender;if(!h||!i.genders.includes(h))return!1}return!(i.eventTypes?.length&&(!m.eventType||!i.eventTypes.includes(m.eventType)))})),n&&r){let m=new Date(r);m.setDate(m.getDate()-n);let h=m.getTime();c=c.filter(g=>g.endDate?new Date(g.endDate).getTime()>=h:!0)}let d={};for(let m of c){let h=m.personId;h&&(d[h]||(d[h]=[]),d[h].push(m))}let p=[];for(let[m,h]of Object.entries(d)){let g=0,I=[],v=[],w;if(a?.length){w=[];for(let S of a){let{bucketName:U,eventTypes:T,pointComponents:P,bestOfCount:D,maxResultsPerLevel:E,mandatoryRules:R}=S,C=h;T?.length&&(C=C.filter(O=>O.eventType&&T.includes(O.eventType)));let{counting:M,dropped:N,bucketTotal:A}=pE({awards:C,pointComponents:P,bestOfCount:D,maxResultsPerLevel:E,mandatoryRules:R});g+=A,I.push(...M.map(O=>O.award)),v.push(...N.map(O=>O.award)),w.push({bucketName:U,countingResults:M.map(O=>O.award),droppedResults:N.map(O=>O.award),bucketTotal:A})}}else{let{counting:S,dropped:U,bucketTotal:T}=pE({awards:h,pointComponents:["points","qualityWinPoints"],bestOfCount:u||0,maxResultsPerLevel:l});g=T,I=S.map(P=>P.award),v=U.map(P=>P.award)}let y=I.length>=o,b={personId:m,totalPoints:g,rank:0,meetsMinimum:y,countingResults:I,droppedResults:v};w&&(b.bucketBreakdown=w),p.push(b)}p.sort((m,h)=>h.totalPoints-m.totalPoints),s.length&&p.sort((m,h)=>{if(m.totalPoints!==h.totalPoints)return h.totalPoints-m.totalPoints;for(let g of s){let I=Qq(g,m,h);if(I!==0)return I}return 0});let f=1;for(let m=0;m<p.length;m++)m>0&&p[m].totalPoints===p[m-1].totalPoints?s.length>0&&s.some(h=>Qq(h,p[m-1],p[m])!==0)?p[m].rank=f:p[m].rank=p[m-1].rank:p[m].rank=f,f=m+2;return p}function Qq(t,e,i){switch(t){case"highestSingleResult":{let r=Math.max(0,...e.countingResults.map(n=>n.points||0));return Math.max(0,...i.countingResults.map(n=>n.points||0))-r}case"mostCountingResults":return i.countingResults.length-e.countingResults.length;case"mostWins":{let r=e.countingResults.reduce((n,a)=>n+(a.winCount||0),0);return i.countingResults.reduce((n,a)=>n+(a.winCount||0),0)-r}default:return 0}}function Yce({pointAwards:t,personId:e,aggregationRules:i={}}){let{countingBuckets:r,maxResultsPerLevel:n,bestOfCount:a}=i,s=t.filter(c=>c.personId===e);if(r?.length){let c=[],d=0;for(let p of r){let{bucketName:f,eventTypes:m,pointComponents:h,bestOfCount:g,maxResultsPerLevel:I,mandatoryRules:v}=p,w=s;m?.length&&(w=w.filter(U=>U.eventType&&m.includes(U.eventType)));let{counting:y,dropped:b,bucketTotal:S}=pE({awards:w,pointComponents:h,bestOfCount:g,maxResultsPerLevel:I,mandatoryRules:v});d+=S,c.push({bucketName:f,countingResults:y.map(U=>U.award),droppedResults:b.map(U=>U.award),bucketTotal:S})}return{buckets:c,totalPoints:d}}let{counting:o,dropped:l,bucketTotal:u}=pE({awards:s,pointComponents:["points","qualityWinPoints"],bestOfCount:a||0,maxResultsPerLevel:n});return{buckets:[{bucketName:"All",countingResults:o.map(c=>c.award),droppedResults:l.map(c=>c.award),bucketTotal:u}],totalPoints:u}}var Kce={};dt(Kce,{applyTournamentRankingPoints:()=>Xce});function Xce({tournamentRecord:t,policyDefinitions:e,participantFilters:i,scaleName:r="RANKING_POINTS",level:n,removePriorValues:a}){if(!t)return{error:ve};let s=Qv({tournamentRecord:t,policyDefinitions:e,participantFilters:i,level:n});if(s.error)return s;let{personPoints:o,pairPoints:l,teamPoints:u}=s,c={};for(let f of t.participants||[])f.person?.personId&&(c[f.person.personId]=f.participantId);let d=t.endDate,p=0;for(let[f,m]of Object.entries(o)){let h=c[f];if(!h)continue;let g={};for(let I of m){let v=I.eventType||"SINGLES";g[v]||(g[v]=[]),g[v].push(I)}for(let[I,v]of Object.entries(g)){let w=v.reduce((b,S)=>b+(S.points||0)+(S.qualityWinPoints||0)+(S.linePoints||0),0),y=Jv({tournamentRecord:t,participantId:h,scaleItem:{scaleType:vu,scaleName:r,eventType:I,scaleDate:d,scaleValue:{points:w,awards:v}},removePriorValues:a});if(y.error)return y;p++}}return{...W,personPoints:o,pairPoints:l,teamPoints:u,modificationsApplied:p}}var Jce={};dt(Jce,{getEntryStatusReports:()=>fze,getParticipantStats:()=>pze,getStructureReports:()=>hze,getVenuesReport:()=>wze});function pze({withCompetitiveProfiles:t,opponentParticipantId:e,withIndividualStats:i,teamParticipantId:r,tournamentRecord:n,withScaleValues:a,tallyPolicy:s,matchUps:o}){if(!n)return{error:ve};if(o&&!Array.isArray(o))return{error:oa};if(o=o??Ur({tournamentRecord:n,participantsProfile:a?{withScaleValues:a}:void 0}).matchUps,!o?.length)return{error:Nu};let l=[];e&&l.push(e),r&&l.push(r);let u=l.length?{participantIds:l}:{participantTypes:[$n]},c=Ri({participantFilters:u,tournamentRecord:n}).participants??[];if(!c.every(({participantType:U})=>U===$n))return{error:Ia};l.length||l.push(...c.map(yt));let d=new Map,p=new Map,f=new Map,m=new Map,h=(U,T="")=>p.get(U)||p.set(U,{participantName:T,participantId:U,competitorIds:[],competitiveness:{},matchUpStatuses:{},tiebreaks:[0,0],matchUps:[0,0],points:[0,0],games:[0,0],sets:[0,0]})&&p.get(U);for(let U of c){let{participantId:T,individualParticipantIds:P}=U;m.set(T,P??[]),h(T,U.participantName)}if(r&&!m.get(r))return q({result:{error:ji},context:{teamParticipantId:r}});if(e&&!m.get(e))return q({result:{error:ji},context:{opponentParticipantId:e}});let g=[],I=U=>{let T=[[],[]];for(let D of U){let E=D.participant;if(E?.participantName){d.set(E.participantId,{participantName:E.participantName,ratings:E.ratings});let R=p.get(E.participantId);R&&(R.participantName=E.participantName)}}let P=({side:D,individualParticipantIds:E})=>D.participantId&&(!E?.length||E.includes(D.participantId))&&[D.participantId]||D.participant?.individualParticipantIds?.length&&(!E?.length||Li(E,D.participant?.individualParticipantIds).length===D.participant?.individualParticipantIds?.length)&&D.participant.individualParticipantIds;if(m.size){let D=(E,R)=>{for(let C of U){if(!C.participant)continue;let M=P({individualParticipantIds:R,side:C});if(M?.length){let N=C.sideNumber;if(!N)continue;let A=[E];i&&A.push(...M),T[N-1]=A;let O=p.get(E);for(let k of M.filter(Boolean))O&&!O.competitorIds.includes(k)&&O.competitorIds.push(k)}}};if(r)(!e||U.every(E=>E.participant&&(P({individualParticipantIds:m.get(r),side:E})||P({individualParticipantIds:m.get(e),side:E}))))&&D(r,m.get(r));else for(let[E,R]of m)D(E,R)}else if(i)for(let D of U){if(!D.participant)continue;let E=P({individualParticipantIds:[],side:D}),R=D.sideNumber;R&&(T[R-1]=E)}return T};for(let U of o){if(!wt(U))return{error:oa};let{matchUpStatus:T,matchUpFormat:P,matchUpType:D,winningSide:E,score:R,sides:C}=U;if(!C||!R||D===La||T==="BYE")continue;let M=I(C);if(!M.filter(Boolean).length)continue;let N=t&&E&&EU({matchUp:U})?.competitiveness;g.push(U);let A=k2({matchUpStatus:T,matchUpFormat:P,tallyPolicy:s,winningSide:E,score:R}),O=bae({matchUpStatus:T,matchUpFormat:P,tallyPolicy:s,winningSide:E,score:R}),{pointsTally:k,tiebreaksTally:F}=wae({matchUpFormat:P,score:R});M.forEach((x,L)=>{for(let $ of x){let V=d.get($)?.participantName,_=h($,V);if(_){let B=(X,Z)=>Z.forEach((J,ae)=>_[X][ae]+=J),G=L?[...F].reverse():F,j=L?[...k].reverse():k,K=L?[...O].reverse():O,Y=L?[...A].reverse():A;if(B("tiebreaks",G),B("points",j),B("games",K),B("sets",Y),E){let X=E-1===L?0:1;_.matchUps[X]+=1}if(N){let X=N.toLowerCase();_.competitiveness[X]||(_.competitiveness[X]=[0,0]),_.competitiveness[X][L]+=1}if(T){let X=T.toLowerCase();_.matchUpStatuses[X]||(_.matchUpStatuses[X]=0),_.matchUpStatuses[X]+=1}}}})}let v=["tiebreaks","matchUps","points","games","sets"],w=["competitive","routine","decisive"],y=new Map,b=(U,T)=>(U??0)+(T??0);for(let[U,T]of p.entries()){for(let P of v){let D=T[P].reduce(b);if(D){let E=T[P][0]/D,R=`${P}Ratio`,C=parseFloat(E.toFixed(2));T[R]=C,f.set(U,!0),y.has(R)||y.set(R,[]),y.get(R)?.push(C)}}for(let P of w){let D=T.competitiveness?.[P]?.reduce(b);if(D){let E=T.competitiveness[P][0]/D,R=`${P}Ratio`,C=parseFloat(E.toFixed(2));T[R]=C}}}if(!r){let U=(T,P)=>P-T;for(let T of p.values())for(let P of v){let D=`${P}Ratio`;if(typeof T[D]=="number"){let E=y.get(D)?.sort(U).indexOf(T[D]);if(typeof E=="number"&&E>=0){let R=`${P}Rank`;T[R]=E+1}}}}let S={relevantMatchUps:g,...W};return r?(S.teamStats=p.get(r),e&&(S.opponentStats=p.get(e))):S.participatingTeamsCount=f.size,S.allParticipantStats=[...p.values()],S}function fE({participant:t,eventType:e}){let i=t?.person?.personId,r=t?.person?.personOtherIds?.[0],n=t?.person?.tennisId,a=t?.ratings?.[e]?.find(({scaleName:u})=>u==="WTN"),s=a?.scaleValue,{wtnRating:o,confidence:l}=s||{};return{timeStamp:a?.scaleDate,personOtherId:r,confidence:l,wtnRating:o,personId:i,tennisId:n}}function fze({tournamentRecord:t}){if(!t)return{error:ve};let e=t.tournamentId,{participantMap:i}=Ri({withScaleValues:!0,withEvents:!0,withSeeding:!0,tournamentRecord:t,withDraws:!0}),r=(Ur({matchUpFilters:{matchUpTypes:[pm,_p]},tournamentRecord:t}).matchUps??[]).flatMap(({sides:f,matchUpType:m})=>f?.flatMap(h=>m===_p?h?.participant?.individualParticipantIds:h?.participant?.participantId||h.participantId).filter(Boolean)).filter(Boolean),n=[],a={},s={},o={},l=0,u=({id:f,entry:m,eventId:h,eventType:g})=>{let{qualifyingSeeding:I,mainSeeding:v,entryStatus:w,entryStage:y,drawId:b}=m;a[f]||(a[f]=[]);let{participant:S,events:U}=i?.[f]??{},T=fE({participant:S,eventType:g}),P=U?.[h]?.ranking;w===aV&&n.push(f),a[f].push({participantType:S?.participantType,participantId:f,tournamentId:e,eventType:g,eventId:h,drawId:b,entryStatus:w,entryStage:y,...T,ranking:P,mainSeeding:v,qualifyingSeeding:I})};for(let f of t.events??[]){let m={},h=U=>{m[U]||(m[U]={count:0}),m[U].count+=1},{drawDefinitions:g=[],eventType:I,eventId:v}=f,w=g.flatMap(U=>{let{drawId:T,entries:P}=U;l+=1;let D=({stage:M,stageSequence:N})=>M===Ae&&N===1||M===ze,E=(U.structures??[]).filter(D).flatMap(({positionAssignments:M})=>M).filter(Boolean).map(({participantId:M})=>M),R=({participantId:M})=>E.includes(M),C=M=>{let{participantId:N,entryStatus:A,entryStage:O}=M;h(A);let k=i?.[N]?.draws?.[T]?.seedAssignments?.[Ae];return{qualifyingSeeding:i?.[N]?.draws?.[T]?.seedAssignments?.[ze],participantId:N,mainSeeding:k,entryStatus:A,entryStage:O,drawId:T}};return P?.filter(R).map(C)}),y=U=>{let T=U.participantId,P=i?.[T].participant.individualParticipantIds?.filter(D=>r.includes(D));return T&&{[T]:{individualParticipantIds:P}}};I===wc?(()=>{let U=Object.assign({},...w.map(y).filter(Boolean)),T=P=>{U[P.participantId].individualParticipantIds.forEach(D=>{u({id:D,eventType:I,eventId:v,entry:P})})};w.forEach(T)})():w.forEach(U=>{u({id:U?.participantId,eventType:I,eventId:v,entry:U})});let b=Object.values(m).reduce((U,T)=>U+T.count,0);Object.keys(m).forEach(U=>{m[U].pct=m[U].count/b*100}),o[v]={tournamentId:e,eventId:v,entries:w,entryStatuses:m};let S=Object.assign({},...uo.flatMap(U=>[{[U+"_count"]:m[U]?.count},{[U+"_pct"]:m[U]?.pct}]));s[v]={tournamentId:e,eventId:v,...S}}let c=Object.values(i??{}).filter(({participant:{participantType:f,participantRole:m}})=>f===It&&m===Jr),d=c.filter(({participant:f})=>!r.includes(f.participantId)).map(({participant:f})=>f.participantId),p={nonParticipatingEntriesCount:d.length,individualParticipantsCount:c.length,eventsCount:Object.values(o).length,nonParticipatingParticipantIds:d,drawDefinitionsCount:l,tournamentId:e};return{entryStatusReports:Object.values(s).flat(),participantEntryReports:Object.values(a).flat(),eventReports:Object.values(o).flat(),withDrawnParticipantIds:n,tournamentEntryReport:p}}function mze({eventType:t,matchUps:e,eventId:i,drawId:r}){let n={},a=m=>{let h=m?.matchUpFormat;h&&(n[h]||(n[h]=0),n[h]+=1)},s=e.filter(m=>i?m.eventId===i:m.drawId===r).reduce((m,h)=>(a(h),(h.sides??[]).flatMap(g=>(g?.participant?.individualParticipants||[g?.participant]).filter(Boolean)).forEach(g=>m[g.participantId]=g),m),{}),o=Object.values(s),l=o.map(m=>fE({participant:m,eventType:t})).filter(({wtnRating:m})=>m),u=(o.length-l.length)/o.length*100,c=l.reduce((m,h)=>{let{wtnRating:g,confidence:I}=h;return m.totalWTN+=g,m.totalConfidence+=I,m},{totalWTN:0,totalConfidence:0}),d=l?.length?c.totalWTN/l.length:0,p=l?.length?c.totalConfidence/l.length:0,f=Object.values(n).reduce((m,h)=>m+(h||0),0);return{matchUpFormatCounts:n,matchUpsCount:f,avgConfidence:p,pctNoRating:u,avgWTN:d}}function hze(t){let{tournamentRecord:e,extensionProfiles:i,firstFlightOnly:r,firstStageSequenceOnly:n=!0}=t;if(!e)return{error:yI};let a=[],s={},o={},l=[],u=g=>I=>I.structureId===g,c=Object.assign({},...(i??[]).map(({name:g,label:I,accessor:v})=>{let w=ht({element:e,name:g})?.extension?.value,y=v?bp({element:w,accessor:v})?.value:w;return{[I??g]:y}})),d=e?.tournamentId,p=Ur({participantsProfile:{withScaleValues:!0},tournamentRecord:e}).matchUps??[],f=g=>Ss({itemType:t2,itemSubTypes:[Yl],element:{timeItems:g}})?.timeItem?.itemValue?.scaleBasis,m=({positionManipulations:g})=>{g?.forEach(I=>{let{structureId:v,name:w}=I,y=I.drawPositions??[I.drawPosition];s[v]??=[],s[v].push(`${w}: ${y.join("/")}`)})},h=e?.events?.flatMap(({timeItems:g,drawDefinitions:I=[],extensions:v,eventType:w,eventName:y,eventId:b,category:S})=>{let U=v?.find(N=>N.name===to)?.value?.flights?.map(N=>({[N.drawId]:N.flightNumber})),T=U&&Object.assign({},...U),P=v?.find(N=>N.name===vp),D=g?.find(N=>N.itemType===vp),E=P?.value?.length??D?.itemValue??0,R=Object.values(T??{}),C=T&&Math.min(...R),M=f(g);return o[b]={seedingBasis:M?JSON.stringify(M):void 0,totalPositionManipulations:0,maxPositionManipulations:0,generatedDrawsCount:0,drawDeletionsCount:E,tournamentId:d,eventId:b},I.filter(N=>!r||!U||T[N.drawId]===C).flatMap(N=>{let{matchUpFormat:A,tieFormat:O,timeItems:k,extensions:F,structures:x,drawName:L,drawType:$,drawId:V}=N,{matchUpFormatCounts:_,matchUpsCount:B,avgConfidence:G,pctNoRating:j,avgWTN:K}=mze({eventType:w,matchUps:p,drawId:V}),Y=f(k)??M,X=gze({extensions:F}),Z=X?.length??0;return m({positionManipulations:X}),o[b].totalPositionManipulations+=Z,o[b].generatedDrawsCount+=1,Z>o[b].maxPositionManipulations&&(o[b].maxPositionManipulations=Z),x?.filter(J=>(J.stageSequence===1||!n)&&[ze,Ae,tn,Ti].includes(J.stage)).map(J=>{let ae=[Ae,Ti].includes(J.stage)?Ize(p,J.structureId):void 0;J.stage===Ae&&a.push({eventName:y,drawName:L,structureId:J.structureId});let te=vze(ae)?.participant,ne=yze(te),le=bze(te),de=fE({participant:le?.[0]??te,eventType:w}),{personId:pe,personOtherId:ge,tennisId:Me,confidence:Pe,wtnRating:Be}=de||{},fe=fE({participant:le?.[1],eventType:w}),{personId:Te,personOtherId:ce,tennisId:ye,confidence:be,wtnRating:Fe}=fe||{},{ageCategoryCode:we,categoryName:Ne,subType:me}=S??{},Ee=J.matchUpFormat??A,Le=(_[Ee]??0)/B*100,{tieFormatName:Q,tieFormatDesc:se}=sE(O),{tieFormatName:oe,tieFormatDesc:ue}=sE(J.tieFormat),ee=se===ue,Se=!ee&&oe,De=J.tieFormat&&!ee&&ue,it=X?.filter(u(J.structureId))?.length??0;return{...c,tournamentId:d,eventId:b,structureId:J.structureId,drawId:V,eventType:w,category:me,categoryName:Ne,ageCategoryCode:we,flightNumber:T?.[V],drawType:$,stage:J.stage,seedingBasis:Y?JSON.stringify(Y):void 0,winningPersonId:pe,winningPersonOtherId:ge,winningPersonTennisId:Me,winningPersonWTNrating:Be,winningPersonWTNconfidence:Pe,winningPerson2Id:Te,winningPerson2OtherId:ce,winningPerson2TennisId:ye,winningPerson2WTNrating:Fe,winningPerson2WTNconfidence:be,winningTeamId:ne,positionManipulations:it,pctNoRating:j,matchUpFormat:Ee,pctInitialMatchUpFormat:Le,matchUpsCount:B,drawTieFormatName:Q,drawTieFormatDesc:se,tieFormatName:Se,tieFormatDesc:De,avgConfidence:G,avgWTN:K}})})});return a.forEach(({eventName:g,drawName:I,structureId:v})=>{s[v]?.length&&l.push({eventName:g,drawName:I,actions:s[v]})}),{eventStructureReports:Object.values(o),structureReports:h,flightReports:l}}function gze({extensions:t}){return t?.find(({name:e})=>e===Gg)?.value?.slice(1)}function Ize(t,e){return t.find(i=>i.structureId===e&&i.finishingRound===1&&i.winningSide)}function vze(t){if(t?.sides)return t.sides.find(e=>e.sideNumber===t.winningSide)}function yze(t){return t?.participantType===$n?t.participantId:void 0}function bze(t){return t?.participantType===ft?t.individualParticipants??[]:[]}function wze({ignoreDisabled:t=!0,tournamentRecords:e,tournamentId:i,venueIds:r=[],dates:n=[]}){if(!Array.isArray(n))return{error:re,dates:n};if(!Array.isArray(r))return{error:re,venueIds:r};if(!(e&&Object.keys(e).filter(c=>!i||c===i)||[]).length)return{error:Mi};if(!n.every(Mn))return{error:or};let a=Fu({tournamentRecords:e,ignoreDisabled:t,dates:n});if(a.error)return a;let s=a?.venues?.filter(({venueId:c})=>!r?.length||r.includes(c)),o=a.courts?.reduce((c,d)=>(d.dateAvailability?.forEach(p=>{let f=p.date;c.includes(f)||c.push(f)}),c),[]).filter(c=>!n.length||n.includes(c)),l={venueIds:s?.map(({venueId:c})=>c)},{matchUps:u}=No({afterRecoveryTimes:!0,tournamentRecords:e,matchUpFilters:l});return{venuesReport:s?.map(c=>Sze(o,c,u))}}function Sze(t,e,i){let{venueId:r,courts:n,venueName:a}=e,s={};return t.forEach(o=>{let l=0,u=0,c=0;for(let f of n){let m=f.dateAvailability.find(g=>g.date===o),h=(m&&ny({courtDate:m}).timeSlots)?.reduce((g,I)=>{let{startTime:v,endTime:w}=I,y=Rt(w)-Rt(v);return g+y},0);h&&(c+=1),l+=h}let d=i.filter(({schedule:f})=>f.venueId===r&&pu(o,f.scheduledDate));d.forEach(({schedule:f})=>{let m=pi(f.scheduledTime),h=Zn(m,f.averageMinutes),g=Rt(h)-Rt(m);u+=g});let p=l?(u/l*100).toFixed(2):"100";s[o]={scheduledMatchUpsCount:d.length,availableCourts:c,availableMinutes:l,scheduledMinutes:u,percentUtilization:p}}),{venueId:r,venueName:a,venueReport:s}}var Qce={};dt(Qce,{addCourtGridBooking:()=>cde,addMatchUpCourtOrder:()=>Jj,addMatchUpEndTime:()=>Zj,addMatchUpOfficial:()=>Nue,addMatchUpResumeTime:()=>tG,addMatchUpScheduleItems:()=>nA,addMatchUpScheduledDate:()=>iA,addMatchUpScheduledTime:()=>tp,addMatchUpStartTime:()=>Qj,addMatchUpStopTime:()=>eG,addSchedulingProfileRound:()=>mG,allocateTeamMatchUpCourts:()=>rA,assignMatchUpCourt:()=>rg,assignMatchUpVenue:()=>sy,bulkRescheduleMatchUps:()=>sde,bulkScheduleMatchUps:()=>lT,bulkScheduleTournamentMatchUps:()=>dw,bulkUpdateCourtAssignments:()=>ide,calculateScheduleTimes:()=>yG,clearMatchUpSchedule:()=>lde,clearScheduledMatchUps:()=>sA,courtGridRows:()=>VN,findMatchUpFormatTiming:()=>_N,findVenue:()=>Ou,generateBookings:()=>aA,generateVirtualCourts:()=>JN,getMatchUpsToSchedule:()=>LN,getPersonRequests:()=>Ef,getProfileRounds:()=>BN,getScheduledRoundsDetails:()=>ZU,getSchedulingProfile:()=>zc,getSchedulingProfileIssues:()=>gj,matchUpScheduleChange:()=>ode,modifyMatchUpFormatTiming:()=>xj,mutate:()=>Zce,proAutoSchedule:()=>tde,proConflicts:()=>nde,publicFindCourt:()=>R2,query:()=>Ele,removeCourtGridBooking:()=>dde,removeEventMatchUpFormatTiming:()=>YN,removeMatchUpCourtAssignment:()=>ede,reorderUpcomingMatchUps:()=>ade,scheduleMatchUps:()=>rde,scheduleProfileRounds:()=>oA,setMatchUpDailyLimits:()=>ude,setMatchUpHomeParticipantId:()=>Xj,setSchedulingProfile:()=>Zv,toggleParticipantCheckInState:()=>ZN,validateSchedulingProfile:()=>$N});var Zce={};dt(Zce,{addCourtGridBooking:()=>cde,addMatchUpCourtOrder:()=>Jj,addMatchUpEndTime:()=>Zj,addMatchUpOfficial:()=>Nue,addMatchUpResumeTime:()=>tG,addMatchUpScheduleItems:()=>nA,addMatchUpScheduledDate:()=>iA,addMatchUpScheduledTime:()=>tp,addMatchUpStartTime:()=>Qj,addMatchUpStopTime:()=>eG,addSchedulingProfileRound:()=>mG,allocateTeamMatchUpCourts:()=>rA,assignMatchUpCourt:()=>rg,assignMatchUpVenue:()=>sy,bulkRescheduleMatchUps:()=>sde,bulkScheduleMatchUps:()=>lT,bulkScheduleTournamentMatchUps:()=>dw,bulkUpdateCourtAssignments:()=>ide,calculateScheduleTimes:()=>yG,clearMatchUpSchedule:()=>lde,clearScheduledMatchUps:()=>sA,findMatchUpFormatTiming:()=>_N,generateBookings:()=>aA,generateVirtualCourts:()=>JN,matchUpScheduleChange:()=>ode,modifyMatchUpFormatTiming:()=>xj,proAutoSchedule:()=>tde,proConflicts:()=>nde,removeCourtGridBooking:()=>dde,removeEventMatchUpFormatTiming:()=>YN,removeMatchUpCourtAssignment:()=>ede,reorderUpcomingMatchUps:()=>ade,scheduleMatchUps:()=>rde,scheduleProfileRounds:()=>oA,setMatchUpDailyLimits:()=>ude,setMatchUpHomeParticipantId:()=>Xj,setSchedulingProfile:()=>Zv,toggleParticipantCheckInState:()=>ZN,validateSchedulingProfile:()=>$N});function yG({calculateStartTimeFromCourts:t=!0,defaultRecoveryMinutes:e=0,averageMatchUpMinutes:i=90,remainingScheduleTimes:r,clearScheduleDates:n,tournamentRecords:a,periodLength:s,scheduleDate:o,startTime:l,venueIds:u,endTime:c}){if(typeof a!="object"||!Object.keys(a).length)return{error:Mi};s=s??QN({recoveryMinutes:e,averageMatchUpMinutes:i});let{courts:d,venues:p}=Fu({dates:[o],ignoreDisabled:!0,tournamentRecords:a}),f=d?.filter(D=>!u||u.includes(D.venueId));l||(l=f?.reduce((D,E)=>{let R=E.dateAvailability?.find(C=>!C.date||pu(o,C.date))?.startTime??E.startTime;return R&&(!D||Rt(R)<Rt(D))?R:D},void 0)),c||(c=f?.reduce((D,E)=>{let R=E.dateAvailability?.find(C=>!C.date||pu(o,C.date))?.endTime??E.endTime;return R&&(!D||Rt(R)>Rt(D))?R:D},void 0));let m=Object.values(a),h=Object.assign({},...m.map(D=>(D.events??[]).map(E=>{let{scheduleTiming:R}=yU({tournamentRecord:D,event:E});return{[E.eventId]:{event:E,scheduleTiming:R}}})).flat()),g=iT({sortDateMatchUps:!1,tournamentRecords:a,matchUpFilters:{scheduledDate:o,venueIds:u}}),I=g?.dateMatchUps??[],v=g?.completedMatchUps??[],w=[];w.push(...I),w.push(...v);let y={averageTimes:[{minutes:{default:i}}],recoveryTimes:[{minutes:{default:e}}]},b=w?.map(({eventId:D,schedule:E,matchUpFormat:R})=>{let{event:C,scheduleTiming:M}=h[D],N=C?.eventType,A={...M,defaultTiming:y,matchUpFormat:R},{averageMinutes:O,recoveryMinutes:k}=JM({eventType:N,timingDetails:A}),{courtId:F,venueId:x}=E,L=pi(E.scheduledTime),$=Zn(L,O);return{recoveryMinutes:k,averageMinutes:O,periodLength:s,startTime:L,endTime:$,courtId:F,venueId:x}}),S={calculateStartTimeFromCourts:t,remainingScheduleTimes:r,averageMatchUpMinutes:i,date:o,clearScheduleDates:n,periodLength:s,startTime:l,endTime:c,bookings:b,courts:f},{scheduleTimes:U}=Hj(S),T=u?.length===1&&u[0]||p?.length===1&&p[0].venueId||void 0,P=w.map(vr);return{venueId:T,scheduleTimes:U,dateScheduledMatchUpIds:P}}function ede(t){let e=He(t,[{[pn]:!0}]);if(e.error)return e;let{removePriorValues:i,tournamentRecords:r,tournamentId:n,courtDayDate:a,matchUpId:s,courtId:o,drawId:l}=t,u=r[n];if(!u)return{error:ve};let{drawDefinition:c,event:d}=ep({tournamentRecord:u,drawId:l});if(!c)return{error:$e};let p=fi({drawDefinition:c,event:d,matchUpId:s});if(p.error)return p;if(p?.matchUp?.matchUpType===La){let{itemValue:f}=Tf({timeItems:p.matchUp.timeItems??[],itemType:wu}),m=o&&f.filter(h=>h.courtId!==o);return Ea({duplicateValues:!1,removePriorValues:i,tournamentRecord:u,drawDefinition:c,matchUpId:s,timeItem:{itemType:wu,itemValue:m}})}else return rg({tournamentRecord:u,drawDefinition:c,courtDayDate:a,courtId:"",matchUpId:s})}function tde({scheduleCompletedMatchUps:t,minCourtGridRows:e=10,tournamentRecords:i,scheduledDate:r,matchUps:n}){if(!Ka(n))return{error:re};if(n.some(({hasContext:m})=>!m))return{info:"matchUps must have { inContext: true, nextMatchUps: true }",error:gM};let a=iT({courtCompletedMatchUps:!0,withCourtGridRows:!0,minCourtGridRows:e,tournamentRecords:i,matchUpFilters:{localPerspective:!0,scheduledDate:r}});if(a.error)return a;let{rows:s}=a,o=[],l=m=>[(m.sides||[]).map(h=>[h.participantId,h.participant?.individualParticipantIds]),(m.potentialParticipants||[]).flat().map(h=>[h.participantId,h.individualParticipantIds])].flat(1/0).filter(Boolean),u=s?.reduce((m,h)=>{let g=[],I=[];Object.values(h).forEach(w=>{if(wt(w)&&(w.matchUpId&&(g.push(w.matchUpId),o.push(w)),w.sides)){let y=l(w);I.push(...y)}});let v=Object.values(h).filter(w=>wt(w)&&!w.matchUpId&&!w.isBlocked);return m.concat({matchUpIds:g,availableCourts:v,rowId:h.rowId,participantIds:I})},[]);n.filter(({matchUpStatus:m})=>m&&m!=="BYE"&&(t||!Ki.includes(m))).sort(zh);let c=co({matchUps:n.concat(o),includeParticipantDependencies:!0,tournamentRecords:i}).matchUpDependencies,d=[],p=[];for(;n.length&&u.length;){let m=u.shift(),h=[];for(;n.length&&m.availableCourts.length;){let g=n.concat(h).map(P=>P.matchUpId),I=n.shift(),v=I?.matchUpId,w=v&&c[v].matchUpIds.concat(c[v].dependentMatchUpIds),y=v&&g.some(P=>c[v].matchUpIds.includes(P)),b=v&&p.some(P=>c[v].dependentMatchUpIds.includes(P)),S=m.matchUpIds.some(P=>w.includes(P)),U=l(I),T=m.participantIds.some(P=>U.includes(P));if(I&&!S&&!y&&!T&&!b){let P=m.availableCourts.shift();Object.assign(I.schedule,P.schedule),Object.assign(P,I),d.push(I),m.participantIds.push(...U),m.matchUpIds.push(v)}else I&&h.push(I)}n.push(...h),p.push(...m.matchUpIds)}let f=d.map(({matchUpId:m,tournamentId:h,schedule:g,drawId:I})=>({tournamentId:h,matchUpId:m,drawId:I,schedule:{...g,scheduledDate:r}}));return a=lT({tournamentRecords:i,matchUpDetails:f}),{...a,scheduled:d,notScheduled:n}}function ide(t){let{courtDayDate:e}=t,i=He(t,[{courtAssignments:!0,[qn]:sn,[Ba]:Je},{[pn]:!0}]);if(i.error)return i;let r=t.courtAssignments.reduce((a,s)=>{let{tournamentId:o}=s;return a[o]||(a[o]=[]),a[o].push(s),a},{}),n;return Object.keys(r).every(a=>{let s=t[pn][a];if(!s)return n={error:ve},!1;let o=r[a].reduce((l,u)=>{let{drawId:c}=u;return l[c]||(l[c]=[]),l[c].push(u),l},{});Object.keys(o).every(l=>{let{drawDefinition:u}=Wn({tournamentRecord:s,drawId:l});return u?(o[l].every(c=>{let{matchUpId:d,courtId:p}=c,f=rg({tournamentRecord:s,drawDefinition:u,courtDayDate:e,matchUpId:d,courtId:p});if(f.success)return f?.success;n={error:Sie}}),!0):(n={error:$e},!1)})}),n||W}function rde(t){let{tournamentRecords:e,allDateMatchUpIds:i=[],averageMatchUpMinutes:r=90,recoveryMinutes:n=0,recoveryMinutesMap:a,matchUpPotentialParticipantIds:s={},individualParticipantProfiles:o={},matchUpNotBeforeTimes:l={},matchUpDailyLimits:u={},checkPotentialRequestConflicts:c=!0,remainingScheduleTimes:d,clearScheduleDates:p,periodLength:f=30,scheduleDate:m,matchUpIds:h,venueIds:g,startTime:I,endTime:v,dryRun:w}=t,y=He(t,[{[pn]:!0,[dU]:!0},{[qr]:Mn,[Ba]:or,[$Fe]:!0},{[qr]:B=>!B||!isNaN(B),[GFe]:!1,[Ba]:re,[HFe]:!1,[WFe]:!1}]);if(y.error)return y;let b=t.competitionMatchUps??No({nextMatchUps:!0,tournamentRecords:e}).matchUps??[],S=t.matchUpDependencies??co({includeParticipantDependencies:!0,matchUps:b,tournamentRecords:e}).matchUpDependencies;b.forEach(B=>{B.schedule?.scheduledDate&&pu(m,Ze(B.schedule.scheduledDate))&&FI({matchUpPotentialParticipantIds:s,matchUpNotBeforeTimes:l,matchUp:B})});let U=h.map(B=>b.find(G=>G.matchUpId===B)).filter(Boolean),{venueId:T,scheduleTimes:P,dateScheduledMatchUpIds:D}=yG({tournamentRecords:e,remainingScheduleTimes:d,startTime:pi(I),endTime:pi(v),scheduleDate:Ze(m),averageMatchUpMinutes:r,clearScheduleDates:p,periodLength:f,venueIds:g}),E={},R=[],C={},M={},N={};b.filter(({matchUpId:B})=>D?.includes(B)).forEach(B=>{Zx({matchUpPotentialParticipantIds:s,individualParticipantProfiles:o,matchUp:B,value:1});let G=B.schedule?.scheduledTime;if(G){C[B.matchUpId]=G;let j=a?.[B.matchUpId];cw({recoveryMinutes:j||n,matchUpPotentialParticipantIds:s,individualParticipantProfiles:o,matchUpNotBeforeTimes:l,averageMatchUpMinutes:r,matchUpDependencies:S,scheduleTime:G,matchUp:B})}});let A=U.filter(B=>{let G=D?.includes(B.matchUpId),j=["BYE",qt,Oi,Ta,Sr,ai].includes(B?.matchUpStatus);return!G&&!B.winningSide&&!j}),{matchUpMap:O,overLimitMatchUpIds:k,participantIdsAtLimit:F}=A.reduce((B,G)=>{let{drawId:j,tournamentId:K,matchUpType:Y}=G,{participantIdsAtLimit:X,relevantParticipantIds:Z}=cG({individualParticipantProfiles:o,matchUpPotentialParticipantIds:s,matchUpDailyLimits:u,matchUp:G});return X?.length?(B.overLimitMatchUpIds.push(G.matchUpId),B.participantIdsAtLimit.push(...X),B):(Z.forEach(J=>{sT({individualParticipantProfiles:o,participantId:J});let ae=o[J].counters;ae[Y]?ae[Y]+=1:ae[Y]=1,ae[Hs]?ae[Hs]+=1:ae[Hs]=1}),B.matchUpMap[K]||(B.matchUpMap[K]={}),B.matchUpMap[K][j]?B.matchUpMap[K][j].push(G):B.matchUpMap[K][j]=[G],FI({matchUpPotentialParticipantIds:s,matchUpNotBeforeTimes:l,matchUp:G}),B)},{matchUpMap:{},overLimitMatchUpIds:[],participantIdsAtLimit:[]});A=A.filter(({matchUpId:B})=>!k.includes(B));let x=0,L=P?.length??0,{personRequests:$}=Ef({tournamentRecords:e,requestType:oT});for(;P?.length&&A.length&&x<=L;){x++;let{scheduleTime:B}=P.shift(),G=A.find(j=>{let{matchUpId:K}=j,{dependenciesScheduled:Y,remainingDependencies:X}=oG({matchUpScheduleTimes:C,matchUpDependencies:S,allDateMatchUpIds:i,matchUp:j});if(!Y)return N[K]||(N[K]=[]),N[K].push({scheduleTime:B,remainingDependencies:X}),!1;let{enoughTime:Z}=uG({individualParticipantProfiles:o,matchUpNotBeforeTimes:l,matchUpDependencies:S,scheduleTime:B,matchUp:j});if(!Z)return M[K]||(M[K]=[]),M[K].push({scheduleTime:B}),!1;let{conflicts:J}=lG({potentials:c,averageMatchUpMinutes:r,requestConflicts:E,personRequests:$,scheduleTime:B,scheduleDate:m,matchUp:j});if(J?.length)return!1;let ae=a?.[j.matchUpId];return cw({recoveryMinutes:ae||n,matchUpPotentialParticipantIds:s,individualParticipantProfiles:o,matchUpNotBeforeTimes:l,averageMatchUpMinutes:r,matchUpDependencies:S,scheduleTime:B,matchUp:j}),C[j.matchUpId]=B,!0});A=A.filter(({matchUpId:j})=>j!==G?.matchUpId),G||R.push(B)}A.forEach(B=>{Zx({individualParticipantProfiles:o,matchUpPotentialParticipantIds:s,value:-1,matchUp:B})});let V=[];Object.keys(O).forEach(B=>{let G=e[B];G&&Object.keys(O[B]).forEach(j=>{let{drawDefinition:K}=ep({tournamentRecord:G,drawId:j});K&&O[B][j].forEach(({matchUpId:Y})=>{let X=C[Y];if(X){let Z=X.split(":").map(as).join(":"),J=`${Ze(m)}T${Z}`;w?V.push(Y):(tp({drawDefinition:K,matchUpId:Y,scheduledTime:J}).success&&V.push(Y),T&&sy({tournamentRecords:e,tournamentRecord:G,drawDefinition:K,matchUpId:Y,venueId:T}))}})})});let _=JB(A);return{...W,requestConflicts:Object.values(E),remainingScheduleTimes:P?.map(({scheduleTime:B})=>B),individualParticipantProfiles:o,matchUpNotBeforeTimes:l,participantIdsAtLimit:F,skippedScheduleTimes:R,overLimitMatchUpIds:k,scheduledMatchUpIds:V,noTimeMatchUpIds:_,recoveryTimeDeferred:M,dependencyDeferred:N}}function nde({useDeepDependencies:t=!1,tournamentRecords:e,matchUps:i}){if(!Ka(i))return{error:Nu};if(i.some(({matchUpId:b,hasContext:S})=>b&&!S))return{info:"matchUps must have { inContext: true, nextMatchUps: true }",error:gM};let r=Math.max(...i.map(({schedule:b})=>b?.courtOrder||1).map(b=>Ke(b))),n=Ce(1,r+1).map(b=>i.filter(S=>Ke(S.schedule?.courtOrder)===b)),a={},s={},o={};n.flat().filter(Boolean).sort(zh).forEach(({schedule:b})=>delete b[ID]);let l=nt(i.map(({drawId:b})=>b)),u=co({includeParticipantDependencies:!0,tournamentRecords:e,drawIds:l}),c=u.matchUpDependencies,d=t?u.positionDependencies??{}:{},p=n.map((b,S)=>b.reduce((U,T)=>{if(!T.matchUpId)return U;let{matchUpId:P,winnerMatchUpId:D,loserMatchUpId:E,schedule:R,sides:C,potentialParticipants:M}=T,N=R?.courtId;a[P]=S,s[N]=[],U.matchUpIds.push(P),o[P]=T;let A=c[P].matchUpIds;A.length&&U.sourceMatchUpIds.push(...A);let O=C?.flatMap(F=>[F.participant?.individualParticipantIds,F.participantId]).flat().filter(Boolean)??[],k=M?.flat().flatMap(({individualParticipantIds:F,participantId:x})=>[F,x]).flat().filter(Boolean)||[];return U.participantIds.push(...k,...O),D&&U.targetMatchUpIds.push(D),E&&U.targetMatchUpIds.push(E),U},{sourceMatchUpIds:[],targetMatchUpIds:[],participantIds:[],matchUpIds:[]})),f=(b,S)=>c[b].sources.reduce((U,T,P)=>T.includes(S)&&P+1||U,0),m=p.map(()=>[]),h=(b,S,U)=>{U[b]||(U[b]={}),U[b][Fl]||(U[b][Fl]=S.filter(T=>T!==b))},g=(b,S,U)=>{S.participantIds.filter(T=>b.participantIds.includes(T)).forEach(T=>{let P=S.matchUpIds.concat(b.matchUpIds).filter(D=>c[D].participantIds.includes(T));P.forEach(D=>{h(D,P,U)})})},I=(b,S,U)=>{U[b]||(U[b]={}),U[b][xl]||(U[b][xl]=S.filter(T=>T!==b))},v=b=>{let S={},U=Sa(b.participantIds),T=new Set(Object.keys(U).filter(D=>U[D]>1)),P=b.matchUpIds.filter(D=>c[D].participantIds.some(E=>T.has(E)));return P.forEach(D=>{I(D,P,S)}),S},w=b=>{let S={},U={};return b.forEach(T=>{let{matchUpId:P,schedule:D}=T;if(!P||!D?.courtId||!D?.scheduledDate)return;let E=`${D.courtId}|${D.scheduledDate}`;U[E]||(U[E]=[]),U[E].push(P)}),Object.values(U).forEach(T=>{T.length>1&&T.forEach(P=>{S[P]=T.filter(D=>D!==P)})}),S},y=(b,S,U,T)=>{if(!o[b].schedule[ID]){o[b].schedule[ID]=S,o[b].schedule[iae]=T,m[a[b]].push({matchUpId:b,issueType:U,issueIds:T,issue:S});let P=o[b].schedule.courtId;s[P]||(s[P]=[]),s[P].push({matchUpId:b,issue:S,issueType:U,issueIds:T})}};if(p.forEach((b,S)=>{let U=S?p[S-1]:void 0,T=p.slice(S+1),P=v(b),D=w(n[S].filter(E=>b.matchUpIds.includes(E.matchUpId)));U&&g(U,b,P),b.matchUpIds.forEach(E=>{let R=c[E].matchUpIds;for(let M of T){let N=M.matchUpIds.filter(A=>R.includes(A));N?.length&&(N.forEach(A=>y(A,Dy,es,[E])),y(E,Dy,es,N))}if(D[E]&&y(E,xl,eae,D[E]),P[E]?.[xl]&&y(E,xl,Px,P[E][xl]),b.sourceMatchUpIds.includes(E)){let M=b.matchUpIds.filter(N=>c[N].matchUpIds.includes(E));y(E,xl,es,M),b.matchUpIds.filter(N=>c[N].matchUpIds.includes(E)).forEach(N=>y(N,xl,es,[E]))}let C=U?.matchUpIds?.filter(M=>f(E,M)>1);if(C?.length&&(y(E,Py,es,C),C.forEach(M=>y(M,Py,es,[E]))),P[E]?.[Fl]&&y(E,Fl,Px,P[E][Fl]),U?.targetMatchUpIds?.includes(E)){let M=o[E].schedule.courtId,N=R.filter(A=>U.matchUpIds.includes(A));N.some(A=>o[A].schedule.courtId===M)||(N.forEach(A=>y(A,Fl,es,[E])),y(E,Fl,es,N))}})}),t){let b=new Set(Object.keys(a)),S={};for(let P of b)S[P]=new Set(c[P]?.dependentMatchUpIds??[]);let U=0;for(let P of b){let D=c[P]?.sources?.length??0;D>U&&(U=D)}let T=P=>{let D=new Set(P.participantIds),E={};for(let R of P.matchUpIds){let C=c[R]?.participantIds??[];for(let M of C)D.has(M)||(E[M]||(E[M]=new Set),E[M].add(R))}return E};if(p.forEach((P,D)=>{let E=T(P);for(let[,R]of Object.entries(E))if(R.size>1){let C=[...R];for(let M of C)y(M,Fl,Ex,C.filter(N=>N!==M))}if(D>0){let R=p[D-1],C=T(R);for(let[M,N]of Object.entries(E))if(C[M]){let A=[...new Set([...N,...C[M]])];for(let O of A)y(O,Fl,Ex,A.filter(k=>k!==O))}}}),p.forEach((P,D)=>{for(let E of P.matchUpIds)for(let R=2;R<=Math.min(D,U);R++){let C=p[D-R];for(let M of C.matchUpIds){let N=f(E,M);N>0&&R<N&&(y(E,Py,es,[M]),y(M,Py,es,[E]))}}}),p.forEach((P,D)=>{for(let E of P.matchUpIds){let R=S[E];if(!R?.size)continue;for(let M=0;M<D;M++){let N=p[M].matchUpIds.filter(A=>R.has(A));if(N.length){for(let A of N)y(A,Dy,es,[E]);y(E,Dy,es,N)}}let C=P.matchUpIds.filter(M=>M!==E&&R.has(M));if(C.length){for(let M of C)y(M,xl,es,[E]);y(E,xl,es,C)}}}),Object.keys(d).length){let P=new Set(Object.values(d).flat());p.forEach(D=>{for(let E of D.matchUpIds){let R=(c[E]?.matchUpIds??[]).filter(C=>P.has(C)).filter(C=>!b.has(C));R.length&&y(E,Fl,tae,R)}})}}return{courtIssues:s,rowIssues:m}}function ade(t){let e="reorderUpcomingMatchUps",{tournamentRecords:i}=t;if(typeof i!="object"||!Object.keys(i).length)return q({result:{error:Mi},stack:e});let{matchUpsContextIds:r,firstToLast:n}=t;if(!r)return q({result:{error:Je},stack:e});let a=r?.length;if(!a)return{...W};let s=0;return r.forEach((l,u)=>{let{tournamentId:c,drawId:d,matchUpId:p}=l,f=u+(n?-1:1);f<0&&(f=a-1),f===a&&(f=0);let m=r[f].schedule.scheduledTime,h=o({tournamentId:c,scheduledTime:m,matchUpId:p,drawId:d});if(h.success)s++;else return h}),s===a?W:q({result:{error:wie},stack:e});function o({tournamentId:l,scheduledTime:u,matchUpId:c,drawId:d}){let p=i[l],{drawDefinition:f}=ep({tournamentRecord:p,drawId:d});return f?tp({drawDefinition:f,scheduledTime:u,matchUpId:c}):{error:_a}}}function sde(t){let{scheduleChange:e,matchUpIds:i,dryRun:r}=t;if(!i||!Array.isArray(i))return{error:Nh};if(typeof e!="object")return{error:re};let n=ws(t),a=[],s=[];for(let l of Object.values(n)){let u=Uze({tournamentRecord:l,scheduleChange:e,matchUpIds:i,dryRun:r});if(u.error)return u;Array.isArray(u.notRescheduled)&&s.push(...u.notRescheduled);let c=JB(u.notRescheduled),d=[];u.rescheduled?.forEach(p=>{let{matchUpId:f}=p;c.includes(f)&&d.push(f),a.push(p)}),d.length&&(s=u?.notRescheduled?.filter(({matchUpId:p})=>!d.includes(p))||[])}let o=!!(a.length&&!s.length);return{...W,rescheduled:a,notRescheduled:s,allRescheduled:o}}function Uze({tournamentRecord:t,scheduleChange:e,matchUpIds:i,dryRun:r}){if(!t)return{error:ve};if(!i||!Array.isArray(i))return{error:Nh};if(typeof e!="object")return{error:re};let n=[],a=[],{minutesChange:s,daysChange:o}=e;if(!s&&!o)return{...W};if(s&&isNaN(s))return{error:re};if(o&&isNaN(o))return{error:re};let{matchUps:l}=Ur({matchUpFilters:{matchUpIds:i},tournamentRecord:t}),u=({matchUpStatus:y})=>!Ki.includes(y),c=l?.filter(y=>tT({schedule:y.schedule})).filter(y=>u({matchUpStatus:y.matchUpStatus}));if(!c?.length)return{...W};let{tournamentInfo:d}=eg({tournamentRecord:t}),{startDate:p,endDate:f}=d,m=c?.reduce((y,b)=>{let{matchUpId:S,drawId:U}=b;return y[U]?y[U].push(S):y[U]=[S],y},{}),h=1440;for(let y of Object.keys(m)){let b=ep({tournamentRecord:t,drawId:y});if(b.error)return b;let S=b.drawDefinition,U=m[y].filter(T=>i.includes(T));for(let T of U)if(T&&S){let P=c.find(N=>N.matchUpId===T)?.schedule,{scheduledTime:D,scheduledDate:E}=P,R,C,M;if(!R&&o&&E){let N=Ze(E);M=Ty(N,o),R=new Date(M)<new Date(p)||new Date(M)>new Date(f)}if(s&&D){let N=Ze(D),A=Rt(pi(D))+s;if(R=A<0||A>h,!R){let O=Zn(D,s),k=N&&M||E===N&&N;C=k?`${k}T${O}`:O}}if(R)a.push(T);else{if(!r){if(C){let N=tp({scheduledTime:C,drawDefinition:S,matchUpId:T});if(N.error)return N}if(M){let N=iA({scheduledDate:M,drawDefinition:S,matchUpId:T});if(N.error)return N}}(C||M)&&n.push(T)}}}let g=Ur({matchUpFilters:{matchUpIds:i},tournamentRecord:t}).matchUps??[],I=g.filter(({matchUpId:y})=>n.includes(y)),v=g.filter(({matchUpId:y})=>a.includes(y)),w=I.length&&!v.length;return{...W,rescheduled:I,notRescheduled:v,allRescheduled:w}}function ode(t){let e="matchUpScheduleChange",{tournamentRecords:i}=t;if(typeof i!="object"||!Object.keys(i).length)return{error:Mi};let{sourceMatchUpContextIds:r,targetMatchUpContextIds:n,sourceCourtId:a,targetCourtId:s,courtDayDate:o}=t||{},{drawId:l,matchUpId:u,tournamentId:c}=r||{},{drawId:d,matchUpId:p,tournamentId:f}=n||{};if(!u&&!p)return q({result:{error:Je},stack:e});let{matchUps:m}=No({matchUpFilters:{matchUpIds:[u,p].filter(Boolean),drawIds:[l,d].filter(Boolean)},tournamentRecords:t.tournamentRecords}),h=m?.find(({matchUpId:y})=>y===u),g=m?.find(({matchUpId:y})=>y===p),I=0;if(s&&u&&!p){let y=v({tournamentId:c,matchUpId:u,courtId:s,matchUp:h,drawId:l,tournamentRecords:i,sourceCourtId:a,courtDayDate:o});if(y?.success&&I++,y.error)return q({result:y,stack:e})}else if(a&&s&&u&&p){let y=v({tournamentId:c,matchUpId:u,courtId:s,matchUp:h,drawId:l,tournamentRecords:i,sourceCourtId:a,courtDayDate:o});if(y.success&&I++,y.error)return q({result:y,stack:e,info:"source"});let b=v({tournamentId:f,sourceCourtId:s,matchUpId:p,matchUp:g,courtId:a,drawId:d,tournamentRecords:i,courtDayDate:o});if(b.success&&I++,b.error)return q({result:b,stack:e,info:"target"})}else return{error:Je};return I?W:q({result:{error:Ov},stack:e});function v(y){let{tournamentRecords:b,tournamentId:S,matchUp:U,drawId:T}=y,P=b[S],{drawDefinition:D}=ep({tournamentRecord:P,drawId:T});return U.matchUpType===ei?w({...y,tournamentRecord:P,drawDefinition:D}):rg({...y,tournamentRecord:P,drawDefinition:D})}function w({removePriorValues:y,tournamentRecords:b,tournamentRecord:S,drawDefinition:U,sourceCourtId:T,courtDayDate:P,matchUpId:D,matchUp:E,courtId:R}){let C=[R].concat(E.schedule.allocatedCourts.map(({courtId:M})=>M).filter(M=>M!==T));return rA({removePriorValues:y,tournamentRecords:b,tournamentRecord:S,drawDefinition:U,courtDayDate:P,matchUpId:D,courtIds:C})}}function lde({scheduleAttributes:t=[wu,Ed,jh,Gh,Hh,go,Rc,Kl,tc],tournamentRecord:e,drawDefinition:i,matchUpId:r}){let n="clearMatchUpSchedule",a=i?An({matchUpFilters:{matchUpIds:[r]},inContext:!1,drawDefinition:i}).matchUps?.[0]:Ur({matchUpFilters:{matchUpIds:[r]},tournamentRecord:e,inContext:!1}).matchUps?.[0];if(!a)return{error:dn};let s=(a.timeItems??[]).filter(o=>o?.itemType&&!t.includes(o?.itemType));return a.timeItems=s,Ut({tournamentId:e.tournamentId,context:n,drawDefinition:i,matchUp:a}),{...W}}function ude(t){let{tournamentRecord:e,tournamentId:i,dailyLimits:r}=t,n=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(typeof n!="object"||!Object.keys(n).length)return{error:Mi};if(typeof r!="object")return{error:Bc};let a=Object.keys(n).filter(s=>!i||i===s);if(i&&!a.includes(i))return{error:re};for(let s of a){let o=n[s],l=Ft({extension:{name:fU,value:{dailyLimits:r}},element:o});if(l.error)return l}return{...W}}function cde(t){let{tournamentRecord:e,disableNotice:i,scheduledDate:r,bookingType:n,courtOrder:a,rowCount:s=1,courtId:o,notes:l}=t;if(!e)return q({result:{error:re},info:"tournamentRecord is required"});if(!o)return{error:vc};if(!r)return q({result:{error:re},info:"scheduledDate is required"});if(!n)return q({result:{error:re},info:"bookingType is required"});if(a==null)return q({result:{error:re},info:"courtOrder is required"});if(!Number.isInteger(a)||a<1)return q({result:{error:re},info:"courtOrder must be a positive integer"});if(!Number.isInteger(s)||s<1)return q({result:{error:re},info:"rowCount must be a positive integer"});let{court:u,venue:c}=Zd({tournamentRecord:e,courtId:o});if(!u)return{error:vc};if(!Md({court:u,date:r})){u.dateAvailability||(u.dateAvailability=[]);let f={date:r,bookings:[]};u.dateAvailability.push(f)}let d=Md({court:u,date:r});if(d.bookings){for(let f of d.bookings)if(typeof f.courtOrder=="number"){let m=f.courtOrder,h=m+(f.rowCount||1)-1,g=a,I=a+s-1;if(g<=h&&I>=m)return q({result:{error:mie},info:`Booking conflicts with existing booking at rows ${m}-${h}`})}}let p={courtOrder:a,rowCount:s,bookingType:n,notes:l,createdAt:new Date().toISOString()};return d.bookings||(d.bookings=[]),d.bookings.push(p),!i&&c&&st({payload:{venue:c,tournamentId:e.tournamentId},topic:jc,key:c.venueId}),{...W,booking:p}}function dde(t){let{tournamentRecord:e,disableNotice:i,scheduledDate:r,courtOrder:n,courtId:a}=t;if(!e)return q({result:{error:re},info:"tournamentRecord is required"});if(!a)return{error:vc};if(!r)return q({result:{error:re},info:"scheduledDate is required"});if(n==null)return q({result:{error:re},info:"courtOrder is required"});let{court:s,venue:o}=Zd({tournamentRecord:e,courtId:a});if(!s)return{error:vc};let l=Md({court:s,date:r});if(!l?.bookings)return q({result:{error:px},info:"No bookings found for this date"});let u=l.bookings.findIndex(d=>d.courtOrder===n);if(u===-1)return q({result:{error:px},info:`No booking found at row ${n}`});let c=l.bookings.splice(u,1)[0];return!i&&o&&st({payload:{venue:o,tournamentId:e.tournamentId},topic:jc,key:o.venueId}),{...W,booking:c}}var pde={};dt(pde,{addCollectionDefinition:()=>SG,addCollectionGroup:()=>vde,aggregateTieFormats:()=>bde,compareTieFormats:()=>Cc,getTieFormat:()=>FN,modifyCollectionDefinition:()=>bG,modifyTieFormat:()=>yde,mutate:()=>fde,orderCollectionDefinitions:()=>gde,query:()=>Tle,removeCollectionDefinition:()=>wG,removeCollectionGroup:()=>hde,tieFormatGenderValidityCheck:()=>TM,validateCollectionDefinition:()=>sU});var fde={};dt(fde,{addCollectionDefinition:()=>SG,addCollectionGroup:()=>vde,aggregateTieFormats:()=>bde,modifyCollectionDefinition:()=>bG,modifyTieFormat:()=>yde,orderCollectionDefinitions:()=>gde,removeCollectionDefinition:()=>wG,removeCollectionGroup:()=>hde});function Jp({drawDefinition:t,structureId:e,matchUpId:i,structure:r,matchUp:n,eventId:a,event:s}){let o="getTieFormat",l;if(e=r?.structureId??e,i=n?.matchUpId??i,(i||e)&&!t)return{error:$e};if(a&&s)l=Vo(s);else if(i){if(t&&(!n||!r)){let u=fi({drawDefinition:t,matchUpId:i});if(u.error)return u;if(u.matchUp?.matchUpType!==La)return q({result:{error:oa},stack:o});r||(r=u.structure),n||(n=u.matchUp)}l=Ky({item:n,drawDefinition:t,structure:r,event:s})||Ky({item:r,drawDefinition:t,structure:r,event:s})||Vo(t)||Vo(s)}else if(t&&e){if(!r){let u=tt({drawDefinition:t,structureId:e});if(u.error)return u;r=u?.structure}l=Ky({item:r,drawDefinition:t,structure:r,event:s})||Vo(t)||Vo(s)}else l=Vo(t)||Vo(s);return l?{...W,structure:r,tieFormat:l,matchUp:n}:q({result:{error:Av},stack:o})}function mE({matchUp:t,updateInProgressMatchUps:e}){return!t.winningSide&&![Ki].includes(t.matchUpStatus)&&(e||t.matchUpStatus!==lo&&!fr(t))}function wk({from:t,to:e}){let i=Object.keys(t),r=Li(i,Object.keys(e)).length===i.length,n=i.filter(s=>t[s]!==e[s]).map(s=>({countChange:e[s]-t[s],collectionId:s})),a=i.every(s=>t[s]===e[s]);return{equivalent:r&&a,matchUpsCountChanges:n}}function Tze({updateInProgressMatchUps:t,tournamentRecord:e,drawDefinition:i,structure:r,tieFormat:n,eventId:a,matchUp:s,event:o,uuids:l}){let u="updateTieFormat",c=e?.tournamentId,d=0,p=0,f=0,m=0,h=n?.collectionDefinitions.reduce((S,U)=>(S[U.collectionId]=(S[U.collectionId]||0)+U.matchUpCount,S),{}),g=({tieFormat:S})=>{let U=S?.collectionDefinitions.reduce((T,P)=>(T[P.collectionId]=(T[P.collectionId]||0)+P.matchUpCount,T),{});return wk({from:U,to:h}).equivalent},I=Jp({drawDefinition:i})?.tieFormat,v=Jp({event:o})?.tieFormat;if(o&&a){for(let S of o.drawDefinitions??[])w({drawDefinition:S});o.tieFormat=Gr(n),m+=1}else if(s){if(!s.tieMatchUps)return q({result:{error:oa},stack:u});let S=Sa(s.tieMatchUps?.map(({collectionId:E})=>E)),U=wk({to:h,from:S}),{changes:T,changesArePossible:P,cannotChangeReaon:D}=Zq({matchUp:s,check:U});if(U.equivalent)if(mE({matchUp:s,updateInProgressMatchUps:t}))s.tieFormat=Gr(n),m+=1;else return q({result:{error:sB},info:"matchUp is IN_PROGRESS or COMPLETE",stack:u});else if(P)b({tieFormat:n,matchUp:s,changes:T,uuids:l});else return q({context:{collectionMap:h,matchUpMap:S},result:{error:ql},info:D||"specified changes not possible",stack:u});p+=1,Ut({eventId:o?.eventId,context:u,drawDefinition:i,tournamentId:c,matchUp:s})}else if(r){let S=y({inheritedTieFormat:I??v,structure:r})?.modifiedMatchUpsCount;S&&(p+=S,d+=1,m+=1);let U=!r.tieFormat||Cc({ancestor:r.tieFormat,descendant:n}).different;U&&(r.tieFormat=Gr(n),d+=1,m+=1),(S||U)&&i&&ii({structureIds:[r.structureId],eventId:o?.eventId,drawDefinition:i})}else if(i)w({drawDefinition:i}),i.tieFormat=Gr(n),m+=1;else return{error:$e};return{modifiedStructuresCount:d,modifiedMatchUpsCount:p,addedMatchUpsCount:f,modifiedCount:m,...W,tieFormat:n};function w({drawDefinition:S}){let U=S.structures||[],T=[];for(let P of U){if(P.tieFormat)continue;let D=y({inheritedTieFormat:v,structure:P})?.modifiedMatchUpsCount;if(D){d+=1,p+=D;let E=P.structureId;T.push(E)}}return ii({structureIds:T,eventId:o?.eventId,drawDefinition:S}),T.length}function y({inheritedTieFormat:S,structure:U}){let T=0,P=At({matchUpFilters:{matchUpTypes:[ei]},structure:U})?.matchUps||[];for(let D of P){let E=mE({matchUp:D,updateInProgressMatchUps:t}),R=!1,C=Sa(D.tieMatchUps?.map(({collectionId:N})=>N)),M=wk({from:C,to:h});if(M.equivalent)D.tieFormat&&g(D)&&E&&(D.tieFormat=Gr(n),R=!0);else{let{changes:N,changesArePossible:A}=Zq({matchUp:D,check:M});if(A&&!D.tieFormat)b({changes:N,matchUp:D,tieFormat:n,uuids:l});else if(S)(!D.tieFormat||Cc({ancestor:S,descendant:D.tieFormat}).different)&&(D.tieFormat=S,R=!0);else return q({result:{error:Av},stack:u})}R&&(T+=1,Ut({tournamentId:e?.tournamentId,drawDefinition:i,context:u,eventId:a,matchUp:D}))}return{modifiedMatchUpsCount:T}}function b({uuids:S,matchUp:U,tieFormat:T,changes:P}){U.tieFormat=Gr(T);let D=[],E=[];return P.forEach(R=>{if(R.countChange>0){let C=Math.max(0,...U.tieMatchUps.filter(A=>A.collectionId===R.collectionId).map(Pa("collectionPosition"))),M=T.collectionDefinitions.find(A=>A.collectionId===R.collectionId),N=jU({matchUpsLimit:R.countChange,collectionPositionOffset:C,collectionDefinition:M,matchUp:U,uuids:S});E.push(...Oe(N,!1,!0)),f+=E.length,U.tieMatchUps.push(...N)}else{let C=R.toBePlayedTieMatchUpIds.slice(0,Math.abs(R.countChange));console.log("remove",C.length),D.push(...C),U.tieMatchUps=U.tieMatchUps.filter(({matchUpId:M})=>!C.includes(M))}}),E.length&&Dd({matchUps:E,drawDefinition:i,tournamentId:c,eventId:a}),D.length&&ku({matchUpIds:D,action:"updateTieFormat",drawDefinition:i,tournamentId:c,eventId:a}),{matchUpIdsRemoved:D,matchUpsAdded:E}}}function Zq({check:t,matchUp:e}){let i="",r=[];return{changesArePossible:t.matchUpsCountChanges.every(({collectionId:n,countChange:a})=>{let s=e.tieMatchUps.filter(l=>l.collectionId===n&&l.matchUpStatus===_i).map(Pa("matchUpId")),o=s.length+a>=0||a>0;return!o&&a<0&&(i="Insufficient TO_BE_PLAYED matchUps"),r.push({toBePlayedTieMatchUpIds:s,collectionId:n,countChange:a}),o}),changes:r,cannotChangeReaon:i}}function pA({appliedPolicies:t,drawDefinition:e,auditData:i}){if(!t?.audit?.[qy])return;let{extension:r}=ht({name:qy,element:e}),n={value:Array.isArray(r?.value)?r?.value.concat(i):[i],name:qy};Ft({element:e,extension:n})}function bG({updateInProgressMatchUps:t=!1,tournamentRecord:e,collectionOrder:i,collectionName:r,tieFormatName:n,drawDefinition:a,matchUpFormat:s,matchUpCount:o,collectionId:l,matchUpType:u,structureId:c,matchUpId:d,category:p,eventId:f,gender:m,event:h,collectionValueProfiles:g,collectionValue:I,matchUpValue:v,scoreValue:w,setValue:y}){let b="modifyCollectionDefinition";if(s&&!$a({matchUpFormat:s}))return q({result:{error:re},context:{matchUpFormat:s},stack:b});if(r&&typeof r!="string")return q({result:{error:re},context:{collectionName:r},stack:b});if(m&&!Object.values(DB).includes(m))return q({result:{error:re},context:{gender:m},stack:b});if(p&&typeof p!="object")return q({result:{error:re},context:{category:p},stack:b});let S={collectionValueProfiles:g,collectionValue:I,matchUpValue:v,scoreValue:w,setValue:y};if(!Object.values(S).filter(Boolean).length&&!i&&!r&&!s&&!o&&!u)return q({result:{error:Je},stack:b});if(Object.values(S).filter(Boolean).length>1)return q({info:"Only one value assignment allowed per collectionDefinition",result:{error:re},stack:b});let U=Jp({drawDefinition:a,structureId:c,matchUpId:d,eventId:f,event:h});if(U.error)return q({result:U,stack:b});let{matchUp:T,structure:P,tieFormat:D}=U,E=Gr(D),R=D?.collectionDefinitions.find(V=>V.collectionId===l),C=E?.collectionDefinitions.find(V=>V.collectionId===l);if(!R)return q({info:"source collectionDefinition",result:{error:Br},context:{collectionId:l},stack:b});let M=I??v??w??y;if(g?.length){let V=gte({matchUpCount:o??R?.matchUpCount??0,collectionValueProfiles:g});if(V.errors)return q({result:{error:re},info:V.errors,stack:b})}else if(M&&!lt(M))return q({result:{error:re},info:"value is not an integer",context:{value:M},stack:b});let N=(V,_)=>Li(Object.keys(V),Object.keys(_)).length===Object.keys(V).length&&Li(Object.values(V),Object.values(_)).length===Object.values(V).length,A=g&&(!R.collectionValueProfiles||!N(R.collectionValueProfiles,g)),O=lt(I)&&R.collectionValue!==I||lt(v)&&R.matchUpValue!==v||lt(w)&&R.scoreValue!==w||lt(y)&&R.setValue!==y||A,k=[];if(O&&(C.collectionValueProfiles=void 0,C.collectionValue=void 0,C.matchUpValue=void 0,C.scoreValue=void 0,C.setValue=void 0,Object.assign(C,S),k.push({collectionId:l,...je(S)})),(lt(w)||lt(y))&&C.collectionGroupNumber){let V=C.collectionGroupNumber;E.collectionDefinitions=E.collectionDefinitions.map(_=>{let{collectionGroupNumber:B,...G}=_;return B===V?G:_}),E.collectionGroups=E.collectionGroups.filter(({groupNumber:_})=>_!==V),k.push({collectionId:l,change:"collectionGroupNumber removed"})}let{aggregateValue:F,valueGoal:x}=ig(E),L=je({aggregateValue:F,valueGoal:x});if((L.aggregateValue!==D?.winCriteria.aggregateValue||L.valueGoal!==D?.winCriteria.valueGoal)&&(E.winCriteria=L,k.push({collectionId:l,winCriteria:L})),lt(i)&&R.collectionOrder!==i&&(C.collectionOrder=i,k.push({collectionId:l,collectionOrder:i})),r&&R.collectionName!==r&&(C.collectionName=r,k.push({collectionId:l,collectionName:r})),s&&R.matchUpFormat!==s&&(C.matchUpFormat=s,k.push({collectionId:l,matchUpFormat:s})),lt(o)&&R.matchUpCount!==o&&(C.matchUpCount=o,k.push({collectionId:l,matchUpCount:o})),u&&R.matchUpType!==u)return q({result:{error:IB},context:{matchUpType:u},stack:b});p&&R.category!==p&&(C.category=p,k.push({collectionId:l,category:p})),m&&R.gender!==m&&(C.gender=m,k.push({collectionId:l,gender:m}));let $=je(E);if(U=Gn({tieFormat:$}),U.error)return q({result:U,stack:b});if(!k.length)return q({result:{...W,modifications:k}});if(D?.tieFormatName!==n?($.tieFormatName=n,k.push({tieFormatName:n})):k.length&&(delete $.tieFormatName,k.push("tieFormatName removed: modifications without new tieFormatName")),U=Tze({tieFormat:$,updateInProgressMatchUps:t,tournamentRecord:e,drawDefinition:a,structure:P,eventId:f,matchUp:T,event:h}),!U.error){let{appliedPolicies:V}=Dt({tournamentRecord:e}),_=je({collectionDefinition:C,drawId:a?.drawId,action:b,structureId:c,matchUpId:d,eventId:f});pA({appliedPolicies:V,drawDefinition:a,auditData:_})}return q({result:{...U,modifications:k},stack:b})}function Dze({updateInProgressMatchUps:t,drawDefinition:e,structureId:i,structure:r,matchUpId:n,matchUp:a}){let s=[];return n&&a?s=[a]:i&&r?s=At({matchUpFilters:{matchUpTypes:[ei]},structure:r})?.matchUps??[]:e&&(s=An({matchUpFilters:{matchUpTypes:[ei]},drawDefinition:e})?.matchUps??[]),{targetMatchUps:s.filter(o=>!o.winningSide&&o.matchUpStatus!==Oi&&(t||o.matchUpStatus!==lo&&!fr(o)))}}function Pze({updateInProgressMatchUps:t,tournamentRecord:e,drawDefinition:i,targetMatchUps:r,tieFormat:n,event:a}){for(let s of r){let o=!!s.tieFormat;o&&(s.tieFormat=Gr(n));let l;if(t){let u=Dt({tournamentRecord:e,drawDefinition:i,event:a}).appliedPolicies,c=Wc({matchUpId:s.matchUpId,exitWhenNoValues:!0,tournamentRecord:e,appliedPolicies:u,drawDefinition:i,event:a});if(c.error)return c;l=c.score}o&&!l&&Ut({tournamentId:e?.tournamentId,context:"updateTargetTeamMatchUps",eventId:a?.eventId,matchUp:s,drawDefinition:i})}return{...W}}function mde({updateInProgressMatchUps:t,originalValueGoal:e,tournamentRecord:i,wasAggregateValue:r,tieFormatName:n,drawDefinition:a,structureId:s,structure:o,tieFormat:l,matchUpId:u,matchUp:c,eventId:d,event:p}){let{aggregateValue:f,valueGoal:m}=ig(l);l.winCriteria=je({aggregateValue:f,valueGoal:m}),(e&&e!==m||f&&!r)&&(n?l.tieFormatName=n:delete l.tieFormatName);let{targetMatchUps:h}=Dze({updateInProgressMatchUps:t,drawDefinition:a,structureId:s,structure:o,matchUpId:u,matchUp:c});Pze({updateInProgressMatchUps:t,tournamentRecord:i,targetMatchUps:h,drawDefinition:a,tieFormat:l,event:p});let g=je(l),I=Gn({tieFormat:g});if(I.error)return I;if(d&&p)p.tieFormat=g;else if(u&&c)c.tieFormat=l;else if(o)o.tieFormat=g;else if(a)a.tieFormat=g;else if(!c||!a)return{error:$e};return ii({drawDefinition:a,eventId:p?.eventId}),{...W}}function hde({updateInProgressMatchUps:t=!0,collectionGroupNumber:e,tournamentRecord:i,drawDefinition:r,tieFormatName:n,structureId:a,matchUpId:s,matchUp:o,eventId:l,event:u}){if(!e)return{error:Je};if(isNaN(e))return{error:re};let c="removeCollectionGroup",d=o?void 0:Jp({drawDefinition:r,structureId:a,matchUpId:s,eventId:l,event:u});if(d?.error)return q({result:d,stack:c});let p=d?.structure;o=o??d?.matchUp;let f=d?.tieFormat,m=f?.winCriteria.valueGoal,h=f?.winCriteria.aggregateValue,g=Gr(f);if(d=Gn({tieFormat:g}),d.error)return q({result:d,stack:c});let I=[];if(g.collectionDefinitions=g.collectionDefinitions.map(v=>{let{collectionGroupNumber:w,...y}=v;return w!==e?v:(I.push(v.collectionId),y)}),g.collectionGroups=g.collectionGroups.filter(({groupNumber:v})=>v!==e),d=mde({updateInProgressMatchUps:t,originalValueGoal:m,wasAggregateValue:h,tournamentRecord:i,drawDefinition:r,tieFormatName:n,structureId:a,structure:p,tieFormat:g,matchUpId:s,matchUp:o,eventId:l,event:u}),!d.error){let{appliedPolicies:v}=Dt({tournamentRecord:i}),w=je({drawId:r?.drawId,collectionGroupNumber:e,action:c,structureId:a,matchUpId:s,eventId:l});pA({appliedPolicies:v,drawDefinition:r,auditData:w})}return q({result:{...d,modifiedCollectionIds:I},stack:c})}function _I({tieFormat:t,orderMap:e}){let i=Gr(t);return i.collectionDefinitions?.forEach(r=>{let n=e[r.collectionId];n&&(r.collectionOrder=n)}),i.collectionDefinitions?.sort((r,n)=>vI(r.collectionOrder)-vI(n.collectionOrder)),i}function gde({tournamentRecord:t,drawDefinition:e,structureId:i,matchUpId:r,orderMap:n,eventId:a,matchUp:s,event:o}){if(typeof n!="object"||!Object.values(n).every(c=>lt(c)))return q({result:{error:re},context:{orderMap:n}});let l=i?tt({drawDefinition:e,structureId:i}):void 0;if(l?.error)return l;let u=l?.structure;if(a&&o?.tieFormat)e3({tournamentRecord:t,event:o,orderMap:n});else if(r){let c=e&&fi({drawDefinition:e,matchUpId:r});if(c?.error)return c;if(s=c.matchUp,!s)return{error:sa};let d=FN({tournamentRecord:t,matchUpId:r,structure:u,drawDefinition:e,event:o})?.tieFormat;s.tieFormat=_I({tieFormat:d,orderMap:n}),Ut({tournamentId:t?.tournamentId,eventId:o?.eventId,drawDefinition:e,matchUp:s})}else if(i)if(u?.tieFormat)u.tieFormat=_I({tieFormat:u.tieFormat,orderMap:n}),Ide({eventId:o?.eventId,tournamentRecord:t,drawDefinition:e,structure:u,orderMap:n}),ii({drawDefinition:e,structureIds:[u.structureId]});else if(e.tieFormat)t1({structureIds:[i],tournamentRecord:t,drawDefinition:e,orderMap:n,event:o});else if(o?.tieFormat)e3({structureIds:[i],tournamentRecord:t,orderMap:n,event:o});else return{error:Br};else if(e?.tieFormat)t1({tournamentRecord:t,drawDefinition:e,orderMap:n,event:o});else return{error:Br};return{...W}}function e3({tournamentRecord:t,structureIds:e,orderMap:i,event:r}){let n=_I({tieFormat:r.tieFormat,orderMap:i});e?.length||(r.tieFormat=n);for(let a of r.drawDefinitions??[])t1({tournamentRecord:t,drawDefinition:a,structureIds:e,orderMap:i,event:r})}function t1({tournamentRecord:t,drawDefinition:e,structureIds:i,orderMap:r,event:n}){let a=e.tieFormat??n?.tieFormat,s=_I({tieFormat:a,orderMap:r});i?.length||(e.tieFormat=s);let o=[];for(let l of e.structures??[])i?.length&&!i.includes(l.structureId)||((l.tieFormat||i?.includes(l.structureId))&&(l.tieFormat=_I({tieFormat:l.tieFormat??e.tieFormat??n?.tieFormat,orderMap:r})),Ide({eventId:n?.eventId,tournamentRecord:t,drawDefinition:e,structure:l,orderMap:r}),o.push(l.structureId));ii({drawDefinition:e,structureIds:o})}function Ide({tournamentRecord:t,drawDefinition:e,structure:i,orderMap:r,eventId:n}){let a=At({matchUpFilters:{matchUpTypes:[ei]},structure:i})?.matchUps;for(let s of a)s.tieFormat&&(s.tieFormat=_I({tieFormat:s.tieFormat,orderMap:r}),Ut({tournamentId:t?.tournamentId,drawDefinition:e,eventId:n,matchUp:s}))}function wG({updateInProgressMatchUps:t=!0,tieFormatComparison:e,tournamentRecord:i,drawDefinition:r,tieFormatName:n,collectionId:a,structureId:s,matchUpId:o,eventId:l,matchUp:u,event:c}){let d="removeCollectionDefinition",p=u?void 0:Jp({drawDefinition:r,structureId:s,matchUpId:o,eventId:l,event:c});if(p?.error)return q({result:p,stack:d});let f=p?.structure;u=u??p?.matchUp;let m=p?.tieFormat,h=Gr(m);if(p=Gn({tieFormat:h}),p.error)return q({result:p,stack:d});let g=h?.collectionDefinitions?.find(E=>E.collectionId===a);if(!g)return q({result:{error:Br,collectionId:a}});h.collectionDefinitions=h.collectionDefinitions.filter(E=>E.collectionId!==a),g.collectionGroupNumber&&(h.collectionDefinitions=h.collectionDefinitions.map(E=>{let{collectionGroupNumber:R,...C}=E;return C}),h.collectionGroups=h.collectionGroups.filter(({groupNumber:E})=>E!==g.collectionGroupNumber));let{aggregateValue:I,valueGoal:v}=ig(h);h.winCriteria=je({aggregateValue:I,valueGoal:v});let w=m?.winCriteria.valueGoal,y=m?.winCriteria.aggregateValue;(w&&w!==v||I&&!y)&&(n?h.tieFormatName=n:delete h.tieFormatName);let b=[];o&&u?b=[u]:s&&f?b=At({matchUpFilters:{matchUpTypes:[ei]},structure:f})?.matchUps??[]:r?b=An({matchUpFilters:{matchUpTypes:[ei]},drawDefinition:r})?.matchUps??[]:c&&(b=xu({matchUpFilters:{matchUpTypes:[ei]}})?.matchUps??[]);let S=(b||[]).filter(E=>{let R=E.tieMatchUps?.filter(M=>M.collectionId===a)?.some(fr),C=e&&E.tieFormat?Cc({descendant:E.tieFormat,ancestor:h})?.different:!1;return t&&!R||!E.winningSide&&E.matchUpStatus!==Oi&&(t||E.matchUpStatus!==lo&&!fr(E)&&!C)});if(!S.length)return{error:Ov};let{appliedPolicies:U}=Dt({tournamentRecord:i});if(o&&u&&t){let E=u.tieMatchUps?.filter(R=>R.collectionId===a);for(let R of E??[]){let C=Rf({matchUpId:R.matchUpId,tieMatchUpId:u?.matchUpId,winningSide:void 0,removeScore:!0,tournamentRecord:i,appliedPolicies:U,drawDefinition:r,event:c});if(C.error||(C=fi({drawDefinition:r,matchUpId:o}),C.error))return C;u=C?.matchUp}}let T=[];for(let E of S){for(let R of E?.sides??[])R.lineUp=(R.lineUp??[]).map(C=>({participantId:C.participantId,collectionAssignments:(C?.collectionAssignments??[]).filter(M=>M.collectionId!==a)}));if(E.tieMatchUps=(E.tieMatchUps??[]).filter(R=>{let C=R.collectionId===a;return C&&T.push(R.matchUpId),!C}),E.tieFormat&&(E.tieFormat=Gr(h)),t){let R=Wc({matchUpId:E.matchUpId,exitWhenNoValues:!0,tournamentRecord:i,appliedPolicies:U,drawDefinition:r,event:c});if(R.error)return R}Ut({tournamentId:i?.tournamentId,eventId:c?.eventId,drawDefinition:r,context:d,matchUp:E})}T.length&&ku({tournamentId:i?.tournamentId,matchUpIds:T,eventId:c?.eventId,drawDefinition:r});let P=je(h);if(p=Gn({tieFormat:P}),p.error)return q({result:p,stack:d});if(l&&c)c.tieFormat=P;else if(o&&u)u.tieFormat=P;else if(f)f.tieFormat=P;else if(r)r.tieFormat=P;else if(!u||!r)return{error:$e};ii({drawDefinition:r,eventId:c?.eventId});let D=je({drawId:r?.drawId,action:d,collectionId:a,structureId:s,matchUpId:o,eventId:l});return pA({appliedPolicies:U,drawDefinition:r,auditData:D}),{tieFormat:P,deletedMatchUpIds:T,targetMatchUps:S,...W}}function vde({updateInProgressMatchUps:t=!0,tournamentRecord:e,groupDefinition:i,drawDefinition:r,collectionIds:n,tieFormatName:a,structureId:s,matchUpId:o,matchUp:l,eventId:u,event:c}){let d="addCollectionGroup";if(!Array.isArray(n))return q({result:{error:Je},stack:d});let p=l?void 0:Jp({drawDefinition:r,structureId:s,matchUpId:o,eventId:u,event:c});if(p?.error)return q({result:p,stack:d});let f=p?.structure;l=l||p?.matchUp;let m=p?.tieFormat,h=m?.winCriteria.valueGoal,g=Gr(m);if(p=Gn({tieFormat:g}),p.error)return q({result:p,stack:d});for(let v of g.collectionDefinitions){let{collectionId:w,collectionGroupNumber:y}=v;if(y&&n.includes(w))return q({info:"collectionIds cannot be part of other collectionGroups",result:{error:re},stack:d})}let I=(g.collectionGroups||[]).reduce((v,w)=>w.groupNumber>v?w.groupNumber:v,0)+1;return i.groupNumber=I,g.collectionDefinitions=g.collectionDefinitions.map(v=>n.includes(v.collectionId)?{...v,collectionGroupNumber:I}:v),g.collectionGroups=[...g.collecitonGroups||[],i],mde({updateInProgressMatchUps:t,originalValueGoal:h,tournamentRecord:e,drawDefinition:r,tieFormatName:a,structureId:s,structure:f,tieFormat:g,matchUpId:o,matchUp:l,eventId:u,event:c})}function SG({updateInProgressMatchUps:t=!0,collectionDefinition:e,referenceCategory:i,tournamentRecord:r,policyDefinitions:n,enforceCategory:a,referenceGender:s,drawDefinition:o,tieFormatName:l,enforceGender:u,structureId:c,matchUpId:d,matchUp:p,eventId:f,uuids:m,event:h}){let g="addCollectionDefinition",I=Dt({tournamentRecord:r,drawDefinition:o,event:h}).appliedPolicies??{},v=n?.[Mr]??I?.[Mr];a=a??v?.participants?.enforceCategory;let w=(u??v?.participants?.enforceGender)!==!1,y=!!((i??h?.category)&&a!==!1),b=!!((s??h?.gender)&&w),S=sU({referenceCategory:i??h?.category,collectionDefinition:e,referenceGender:s,checkCategory:y,checkGender:b,event:h});if(S.error)return q({result:S,stack:g});let U=p?.tieFormat?void 0:Jp({drawDefinition:o,structureId:c,matchUpId:d,eventId:f,event:h});if(U?.error)return q({result:{error:U.error},stack:g});let T=U?.structure;p=p??U?.matchUp;let P=p?.tieFormat??U?.tieFormat,D=Gr(P);if(U=Gn({tieFormat:D}),U?.error)return q({result:{error:U.error},stack:g});if(!e.collectionId)e.collectionId=Ct();else if(D.collectionDefinitions.map(({collectionId:x})=>x).includes(e.collectionId))return q({context:{collectionId:e.collectionId},result:{error:Die}});D.collectionDefinitions.push(e),D.collectionDefinitions.sort((x,L)=>(x.collectionOrder||0)-(L.collectionOrder||0)).forEach((x,L)=>x.collectionOrder=L+1);let{aggregateValue:E,valueGoal:R}=ig(D);D.winCriteria=je({aggregateValue:E,valueGoal:R});let C=P?.winCriteria.valueGoal,M=P?.winCriteria.aggregateValue;(C&&C!==R||E&&!M)&&(l?D.tieFormatName=l:delete D.tieFormatName);let N=[],A=[],O=[],k=je(D);if(U=Gn({tieFormat:k}),U?.error)return q({result:{error:U.error},stack:g});if(f&&h){h.tieFormat=k;for(let x of h.drawDefinitions??[])if(!x.tieFormat)for(let L of x.structures??[]){if(L.tieFormat)continue;let $=Sk({updateInProgressMatchUps:t,collectionDefinition:e,structure:L,uuids:m});A.push(...$.newMatchUps),O.push(...$.targetMatchUps),N.push(L.structureId)}kT({modifiedMatchUps:O,eventId:h?.eventId,modifiedStructureIds:N,tournamentRecord:r,drawDefinition:o,addedMatchUps:A,stack:g})}else if(c&&T){T.tieFormat=k;let x=Sk({updateInProgressMatchUps:t,collectionDefinition:e,structure:T,uuids:m});A.push(...x.newMatchUps),O=x.targetMatchUps,kT({modifiedMatchUps:O,eventId:h?.eventId,modifiedStructureIds:N,tournamentRecord:r,drawDefinition:o,addedMatchUps:A,stack:g})}else if(d&&p){if(!mE({matchUp:p,updateInProgressMatchUps:t}))return q({result:{error:sB},stack:g});p.tieFormat=k;let x=jU({collectionDefinition:e,matchUp:p,uuids:m});Array.isArray(p.tieMatchUps)||(p.tieMatchUps=[]),p.tieMatchUps.push(...x),A.push(...x),kT({modifiedMatchUps:[p],eventId:h?.eventId,modifiedStructureIds:N,tournamentRecord:r,drawDefinition:o,addedMatchUps:A,stack:g})}else if(o){o.tieFormat=k;for(let x of o.structures??[]){let L=Sk({updateInProgressMatchUps:t,collectionDefinition:e,structure:x,uuids:m});N.push(x.structureId),A.push(...L.newMatchUps),O.push(...L.targetMatchUps)}kT({modifiedMatchUps:O,eventId:h?.eventId,tournamentRecord:r,drawDefinition:o,addedMatchUps:A,stack:g})}else return{error:$e};let F=je({drawId:o?.drawId,collectionDefinition:e,action:g,structureId:c,matchUpId:d,eventId:f});return pA({appliedPolicies:I,drawDefinition:o,auditData:F}),{tieFormat:k,targetMatchUps:O,addedMatchUps:A,...W}}function Sk({updateInProgressMatchUps:t,collectionDefinition:e,structure:i,uuids:r}){let n=[],a=(At({matchUpFilters:{matchUpTypes:[ei]},structure:i})?.matchUps).filter(s=>mE({matchUp:s,updateInProgressMatchUps:t})&&!s.tieFormat);for(let s of a){let o=jU({collectionDefinition:e,matchUp:s,uuids:r});Array.isArray(s.tieMatchUps)||(s.tieMatchUps=[]),s.tieMatchUps.push(...o),n.push(...o)}return{newMatchUps:n,targetMatchUps:a}}function kT({modifiedStructureIds:t,tournamentRecord:e,modifiedMatchUps:i,drawDefinition:r,addedMatchUps:n,eventId:a,stack:s}){Dd({tournamentId:e?.tournamentId,matchUps:n,drawDefinition:r,eventId:a}),i?.forEach(o=>{Ut({tournamentId:e?.tournamentId,drawDefinition:r,context:s,matchUp:o,eventId:a})}),ii({structureIds:t,drawDefinition:r,eventId:a})}function yde({updateInProgressMatchUps:t=!1,tieFormatComparison:e,modifiedTieFormat:i,tournamentRecord:r,considerations:n,drawDefinition:a,structureId:s,matchUpId:o,eventId:l,uuids:u,event:c}){let d="modifyTieFormat";if(!Gn({tieFormat:i}).valid)return q({result:{error:ql},info:"falied validation",stack:d});let p=Jp({drawDefinition:a,structureId:s,matchUpId:o,eventId:l,event:c});if(p.error)return q({result:p,stack:d});let{matchUp:f,tieFormat:m}=p,h=Gr(m),g=Cc({descendant:i,ancestor:h,considerations:n});if(g.invalid)return q({context:{invalid:g.invalid},result:{error:ql},stack:d});if(!g?.different)return q({result:{...W},info:"Nothing to do",stack:d});let I=h.collectionDefinitions.map(({collectionId:P})=>P),v=i.collectionDefinitions.map(({collectionId:P})=>P),w=I.filter(P=>!v.includes(P)),y=i.collectionDefinitions.filter(({collectionId:P})=>!I.includes(P)),b=y.map(Pa("collectionId")),S=[],U,T=i.tieFormatName;for(let P of i.collectionDefinitions){if(b.includes(P.collectionId))continue;let D=bG({updateInProgressMatchUps:t,...P,tournamentRecord:r,tieFormatName:T,drawDefinition:a,structureId:s,matchUpId:o,eventId:l,event:c});if(D.modifications&&S.push(...D.modifications),D.error)return q({result:D,stack:d});D.tieFormat&&(U=D.tieFormat)}for(let P of y){let D=SG({updateInProgressMatchUps:t,collectionDefinition:P,tournamentRecord:r,drawDefinition:a,tieFormatName:T,structureId:s,matchUpId:o,matchUp:f,eventId:l,uuids:u,event:c});if(D.error)return q({result:D,stack:d});D.tieFormat&&(U=D.tieFormat)}for(let P of w){let D=wG({updateInProgressMatchUps:t,tieFormatComparison:e,tournamentRecord:r,drawDefinition:a,tieFormatName:T,collectionId:P,structureId:s,matchUpId:o,eventId:l,matchUp:f,event:c});if(D.error)return q({result:D,stack:d});D.tieFormat&&(U=D.tieFormat)}return m?.tieFormatName!==T?(U.tieFormatName=T,S.push({tieFormatName:T})):(S.length||b.length||w.length)&&(delete U.tieFormatName,S.push("tieFormatName removed: modifications without new tieFormatName")),U.collectionDefinitions=U.collectionDefinitions.sort((P,D)=>vI(P.collectionOrder)-vI(D.collectionOrder)).map((P,D)=>({...P,collectionOrder:D+1})),{processedTieFormat:Gr(U),modifications:S,...W}}function bde({tournamentRecord:t}){if(!t)return{error:ve};let e=0;for(let i of t.events??[]){let r=i.tieFormats??[],n=u=>{if(!u.tieFormat)return;let c;for(let d of r)Cc({descendant:u.tieFormat,ancestor:d}).different||(c=d.tieFormatId);if(c)u.tieFormatId=c,delete u.tieFormat;else{let d=Oe(u.tieFormat,void 0,!0);d.tieFormatId||(d.tieFormatId=Ct()),u.tieFormatId=d.tieFormatId,delete u.tieFormat,r.push(d),e+=1}};i.eventType,n({tieFormat:i.tieFormat});for(let u of i.drawDefinitions??[]){n({tieFormat:u.tieFormat});for(let c of u.structures??[])n({tieFormat:c.tieFormat})}let a=(u,c)=>{let d=o.matchUps?.find(p=>p.matchUpId===u);d&&(d.tieFormatId=c,delete d.tieFormat,Ut({tournamentId:t?.tournamentId,eventId:i.eventId,matchUp:d}))},s=u=>{let c=Oe(u.tieFormat,void 0,!0);c.tieFormatId||(c.tieFormatId=Ct()),r.push(c),e+=1,a(u.matchUpId,c.tieFormatId)},o=xu({matchUpFilters:{matchUpTypes:[La]},event:i}),l=o.matchUps??[];for(let u of l){let c;for(let d of r)u.tieFormat&&Cc({descendant:u.tieFormat,ancestor:d}).different||(c=d.tieFormatId);c?a(u.matchUpId,c):s(u)}r.length&&(i.tieFormats=r)}return{...W,addedCount:e}}var wde={};dt(wde,{addDrawDefinitionExtension:()=>LM,addEventExtension:()=>Yd,addEventTimeItem:()=>Zh,addExtension:()=>Ft,addNotes:()=>dN,addOnlineResource:()=>Rde,addParticipantExtension:()=>tne,addParticipantTimeItem:()=>hV,addTimeItem:()=>Cl,addTournamentExtension:()=>qB,addTournamentTimeItem:()=>zU,analyzeDraws:()=>qU,analyzeTournament:()=>cj,copyTournamentRecord:()=>Ude,createTournamentRecord:()=>uA,generate:()=>Sde,getAggregateTeamResults:()=>uj,getAllowedDrawTypes:()=>kN,getAllowedMatchUpFormats:()=>sj,getAppliedPolicies:()=>Dt,getCompetitionDateRange:()=>xN,getCompetitionPenalties:()=>oj,getPolicyDefinitions:()=>Gc,getTournamentInfo:()=>eg,getTournamentPenalties:()=>ON,getTournamentPersons:()=>lj,getTournamentPoints:()=>Qv,getTournamentStructures:()=>Q2,getTournamentTimeItem:()=>qM,hydrateTournamentRecord:()=>Dde,mutate:()=>Tde,query:()=>ble,removeDrawDefinitionExtension:()=>ine,removeEventExtension:()=>_M,removeExtension:()=>Nn,removeNotes:()=>dV,removeOnlineResource:()=>Ede,removeParticipantExtension:()=>rne,removeTournamentExtension:()=>YB,setTournamentCategories:()=>Nde,setTournamentDates:()=>fA,setTournamentEndDate:()=>kde,setTournamentName:()=>Cde,setTournamentNotes:()=>Mde,setTournamentStartDate:()=>Ade,setTournamentStatus:()=>Pde});var Sde={};dt(Sde,{copyTournamentRecord:()=>Ude,createTournamentRecord:()=>uA});function Ude(t){let e=He(t,[{tournamentRecord:!0,startDate:!0,endDate:!1,tournamentName:!0}]);if(e.error)return e;let{startDate:i,endDate:r}=t.tournamentRecord,n=1440*60*1e3,a=(i&&r?new Date(Ze(r)).getTime()-new Date(Ze(i)).getTime():0)/n,s=t.endDate||CB(t.startDate,a),o=p=>p?.filter(({itemType:f})=>t.itemTypeList?.includes(f)),l=p=>p?.filter(({name:f})=>t.extensionList?.includes(f)),u=p=>{let{timeItems:f,extensions:m,...h}=p;return Oe({...h,timeItems:o(f),extensions:l(m)},!1,!0)},c=p=>{let{drawDefinitions:f,timeItems:m,extensions:h,startDate:g,endDate:I,...v}=p;return Oe({extensions:l(h),timeItems:o(m),startDate:t.startDate,endDate:s,...v},!1,!0)},d={participants:t.copyParticipants?t.tournamentRecord.participants?.map(u)??[]:[],parentOrganisation:Oe({...t.tournamentRecord.parentOrganisation},!1,!0),venues:Oe(t.tournamentRecord.venues??[],!1,!0),extensions:l(t.tournamentRecord.extensions),timeItems:o(t.tournamentRecord.timeItems),events:t.tournamentRecord.events?.map(c)??[],weekdays:[...t.tournamentRecord.weekdays??[]],tournamentName:t.tournamentName,startDate:t.startDate,tournamentId:Ct(),endDate:s};return{...W,tournamentRecord:d}}var Tde={};dt(Tde,{addDrawDefinitionExtension:()=>LM,addEventExtension:()=>Yd,addEventTimeItem:()=>Zh,addExtension:()=>Ft,addNotes:()=>dN,addOnlineResource:()=>Rde,addParticipantExtension:()=>tne,addParticipantTimeItem:()=>hV,addTimeItem:()=>Cl,addTournamentExtension:()=>qB,addTournamentTimeItem:()=>zU,hydrateTournamentRecord:()=>Dde,removeDrawDefinitionExtension:()=>ine,removeEventExtension:()=>_M,removeExtension:()=>Nn,removeNotes:()=>dV,removeOnlineResource:()=>Ede,removeParticipantExtension:()=>rne,removeTournamentExtension:()=>YB,setTournamentCategories:()=>Nde,setTournamentDates:()=>fA,setTournamentEndDate:()=>kde,setTournamentName:()=>Cde,setTournamentNotes:()=>Mde,setTournamentStartDate:()=>Ade,setTournamentStatus:()=>Pde});function Dde(t){let{tournamentRecord:e,eventProfiles:i=[],directives:r,policyDefinitions:n}=t;return e?((e.events||[]).forEach(a=>{let s=i.find(o=>o.eventId&&o.eventId===a.eventId);(s?.directives?.hydrateRoundNames||r?.hydrateRoundNames)&&a.drawDefinitions?.forEach(o=>{(s?.policyDefinitions?.[Sc]||n?.[Sc])&&Lle({drawDefinition:o,appliedPolicies:n})})}),{tournamentRecord:e}):{error:ve}}function Pde({tournamentRecord:t,status:e}){return t?e&&!Object.keys(Yse).includes(e)?{error:re,info:"Unknown status"}:(t.tournamentStatus=e,{...W}):{error:ve}}function Ede(t){let e=He(t,[{tournamentRecord:!0,onlineResource:!0}]);if(e.error)return e;let{tournamentRecord:i,onlineResource:r,organisationId:n,participantId:a,personId:s,courtId:o,venueId:l}=t;if(n){if(i.parentOrganisation?.parentOrganisationId!==n)return q({result:{error:Br}});fg({element:i.parentOrganisation,onlineResource:r})}else if(a||s){let u=(i.participants??[]).find(c=>s&&c.person?.personId===s||c.participantId===a);if(!u)return q(s?{result:{error:Br}}:{result:{error:ji}});if(s){if(u.person?.personId!==s)return q({result:{error:$p}});fg({element:u.person,onlineResource:r})}else fg({element:u,onlineResource:r})}else if(o){let u=(i.venues??[]).filter(c=>!l||c.venueId===l).flatMap(c=>(c.courts??[]).filter(d=>d.courtId===o))?.[0];if(!u)return q({result:{error:vc}});fg({element:u,onlineResource:r})}else if(l){let u=(i.venues??[]).find(c=>c.venueId===l);if(!u)return q({result:{error:If}});fg({element:u,onlineResource:r})}else fg({element:i,onlineResource:r}),st({payload:{parentOrganisation:i.parentOrganisation,onlineResources:i.onlineResources,tournamentId:i.tournamentId},topic:yf});return{...W}}function fg({element:t,onlineResource:e}){let i=(t.onlineResources??[]).filter(r=>!(r?.[$P]===e[$P]&&r?.[BP]===e[BP]&&r?.[TI]===e[TI]));t.onlineResources=i}function Rde(t){let e=He(t,[{tournamentRecord:!0,onlineResource:!0}]);if(e.error)return e;let{tournamentRecord:i,onlineResource:r,organisationId:n,participantId:a,personId:s,courtId:o,venueId:l}=t;if(n){if(i.parentOrganisation?.parentOrganisationId!==n)return q({result:{error:Br}});mg({element:i.parentOrganisation,onlineResource:r})}else{if(a&&s&&a!==s)return q({result:{error:$p}});if(a||s){let u=(i.participants??[]).find(c=>s&&c.person?.personId===s||c.participantId===a);if(!u)return q(s?{result:{error:Br}}:{result:{error:ji}});if(s){if(u.person?.personId!==s)return q({result:{error:$p}});mg({element:u.person,onlineResource:r})}else mg({element:u,onlineResource:r})}else if(o){let u=(i.venues??[]).filter(c=>!l||c.venueId===l).flatMap(c=>(c.courts??[]).filter(d=>d.courtId===o))?.[0];if(!u)return q({result:{error:vc}});mg({element:u,onlineResource:r})}else if(l){let u=(i.venues??[]).find(c=>c.venueId===l);if(!u)return q({result:{error:If}});mg({element:u,onlineResource:r})}else mg({element:i,onlineResource:r}),st({payload:{parentOrganisation:i.parentOrganisation,onlineResources:i.onlineResources,tournamentId:i.tournamentId},topic:yf})}return{...W}}function mg({element:t,onlineResource:e}){let i=(t.onlineResources??[]).filter(r=>r?.[gx]!==e[gx]&&r?.[TI]!==e[TI]);return i.push(e),t.onlineResources=i,{...W}}function Cde({tournamentRecord:t,promotionalName:e,tournamentName:i,formalName:r}){if(!t)return{error:ve};let n=t.tournamentId,a={tournamentId:n};return i&&i!==t.tournamentName&&(t.tournamentName=i,a.tournamentName=i),e&&e!==t.promotionalName&&(t.promotionalName=e,a.promotionalName=e),r&&r!==t.formalName&&(t.formalName=r,a.formalName=r),t.promotionalName===t.tournamentName&&(delete t.promotionalName,a.promotionalName=""),t.formalName===t.tournamentName&&(delete t.formalName,a.formalName=""),Object.keys(a).length>1&&st({topic:yf,payload:{parentOrganisation:t.parentOrganisation,tournamentId:n,...a}}),{...W}}function Mde({tournamentRecord:t,notes:e}){if(!t)return{error:ve};let i=e?dN({element:t,notes:e}):dV({element:t});return i.error?i:(st({topic:yf,payload:{parentOrganisation:t.parentOrganisation,tournamentId:t.tournamentId,notes:e??""}}),{...W})}function Nde({tournamentRecord:t,categories:e}){return t?(e=(e||[]).filter(i=>i.categoryName&&i.type),t.tournamentCategories=e,st({topic:yf,payload:{parentOrganisation:t.parentOrganisation,tournamentId:t.tournamentId,categories:e}}),{...W}):{error:ve}}function Eze({tournamentRecord:t}){if(!t)return{error:ve};let{startDate:e,endDate:i}=t,r=UI(e,i),n=[];for(let a of t.venues||[])a?.courts?.length&&n.push(...a.courts);for(let a of n){let{startTime:s,endTime:o}=(a.dateAvailability??[]).reduce((c,d)=>{let p=Rt(c.startTime),f=Rt(c.endTime);return d.startTime&&Rt(d.startTime)<p&&(c.startTime=d.startTime),d.endTime&&Rt(d.endTime)>f&&(c.endTime=d.endTime),c},{startTime:"08:00",endTime:"18:00"}),l=r.map(c=>a.dateAvailability?.find(d=>d.date===c)??{date:c,startTime:s,endTime:o}),u=a.dateAvailability?.find(c=>!c.date);u&&l.unshift(u),a.dateAvailability=l}return{...W}}function fA(t){let{tournamentRecord:e,startDate:i,endDate:r,weekdays:n}=t,a=t.activeDates?.filter(Boolean),s=He(t,[{tournamentRecord:!0},{[qr]:f=>dl.test(f),[Ba]:or,startDate:!1,endDate:!1},{[qr]:f=>f.filter(Boolean).every(m=>dl.test(m)),[Ba]:or,activeDates:!1},{[qr]:tue,weekdays:!1}]);if(s.error)return s;if(r&&i&&new Date(r)<new Date(i))return{error:re};if(r&&i&&new Date(i)>new Date(r))return{error:re};if(a?.length){let f=i||e.startDate,m=r||e.endDate,h=!f||a.every(I=>new Date(I)>=new Date(f)),g=!m||a.every(I=>new Date(I)<=new Date(m));if(!h||!g)return{error:or}}let o;(i&&e.startDate&&new Date(i)>new Date(e.startDate)||r&&e.endDate&&new Date(r)<new Date(e.endDate))&&(o=!0);let l=UI(e.startDate,e.endDate);i&&(e.startDate=i),r&&(e.endDate=r);let u=UI(e.startDate,e.endDate),c=l.filter(f=>!u.includes(f)),d=u.filter(f=>!l.includes(f));for(let f of e.events??[])i&&f.startDate&&new Date(f.startDate)<new Date(i)&&(f.startDate=i),r&&f.startDate&&new Date(f.startDate)>new Date(r)&&(f.startDate=i??r),r&&f.endDate&&new Date(f.endDate)>new Date(r)&&(f.endDate=r),i&&f.endDate&&new Date(f.endDate)<new Date(i)&&(f.endDate=r??i);i&&e.endDate&&new Date(i)>new Date(e.endDate)&&(e.endDate=i),r&&e.startDate&&new Date(r)<new Date(e.startDate)&&(e.startDate=r),a&&(e.activeDates=a),n&&(e.weekdays=n);let p=o&&Rze({tournamentRecord:e})?.unscheduledMatchUpIds;return Eze({tournamentRecord:e}),st({payload:je({parentOrganisation:e.parentOrganisation,tournamentId:e.tournamentId,activeDates:a,startDate:i,weekdays:n,endDate:r}),topic:yf}),{...W,unscheduledMatchUpIds:p,datesAdded:d,datesRemoved:c}}function Ade({tournamentRecord:t,startDate:e}){return e?fA({tournamentRecord:t,startDate:e}):{error:or}}function kde({tournamentRecord:t,endDate:e}){return e?fA({tournamentRecord:t,endDate:e}):{error:or}}function Rze({tournamentRecord:t}){let e=Ur({tournamentRecord:t}).matchUps??[],i=t.startDate&&new Date(t.startDate),r=t.endDate&&new Date(t.endDate),n=[],a=[];for(let s of e){let{schedule:o,matchUpId:l}=s;if(o&&o.scheduledDate){let u=new Date(o.scheduledDate);(i&&u<i||r&&u>r)&&(a.push(l),n.includes(o.scheduledDate)||n.push(o.scheduledDate))}}return n.length&&!sA({scheduledDates:n,tournamentRecord:t}).clearedScheduleCount?{error:yte}:{unscheduledMatchUpIds:a}}var Ode={};dt(Ode,{BLOCK_TYPES:()=>Ot,EvaluatorRegistry:()=>Yde,adjacentBlockEvaluator:()=>kG,applyTemporalAvailabilityToTournamentRecord:()=>ipe,blockDurationEvaluator:()=>xG,buildDayRange:()=>Lde,buildEdges:()=>DG,buildSchedulingProfileFromUISelections:()=>rpe,calculateCapacityStats:()=>$de,calculateCourtHours:()=>lpe,clampDragToCollisions:()=>Wde,clampToDayRange:()=>UG,compareCapacityCurves:()=>jde,computePlanItemId:()=>gE,courtDayKey:()=>eb,courtKey:()=>Lg,courtOverlapEvaluator:()=>NG,createFollowByEvaluator:()=>Kde,dayBoundaryEvaluator:()=>FG,defaultEvaluators:()=>qde,deriveRailSegments:()=>EG,diffMinutes:()=>uT,extractDay:()=>np,filterCapacityCurve:()=>Bde,findBlocksContainingTime:()=>Hde,formatConflicts:()=>Qde,generateCapacityCurve:()=>CG,getHighestSeverity:()=>Jde,groupConflictsBySeverity:()=>Xde,hhmmToMinutes:()=>pw,intervalsOverlap:()=>Gde,iterateDayTicks:()=>epe,lightingEvaluator:()=>OG,maintenanceWindowEvaluator:()=>LG,matchWindowEvaluator:()=>AG,mergeAdjacentSegments:()=>RG,mergeOverlappingAvailability:()=>ope,minutesToHhmm:()=>mA,overlappingRange:()=>Fde,railsToDateAvailability:()=>$G,rangesOverlap:()=>TG,resolveCourtId:()=>Xf,resolveStatus:()=>hE,resolveVenueId:()=>bm,runValidationPipeline:()=>tpe,sampleCapacityCurve:()=>Vde,snapIsoToGranularity:()=>Zde,snapToGranularity:()=>_G,sortBlocksByStart:()=>zde,sortEdges:()=>PG,timeInsideBlock:()=>MG,todsAvailabilityToBlocks:()=>npe,validateDateAvailability:()=>spe,validateSchedulingProfileFormat:()=>ape,validateSegments:()=>_de,venueDayKey:()=>xde,venueKey:()=>Wf});var Ot={MAINTENANCE:"MAINTENANCE",PRACTICE:"PRACTICE",RESERVED:"RESERVED",BLOCKED:"BLOCKED",CLOSED:"CLOSED",SCHEDULED:"SCHEDULED",SOFT_BLOCK:"SOFT_BLOCK",HARD_BLOCK:"HARD_BLOCK",LOCKED:"LOCKED",AVAILABLE:"AVAILABLE",UNSPECIFIED:"UNSPECIFIED"};function eb(t,e){return`${t.tournamentId}|${t.venueId}|${t.courtId}|${e}`}function Lg(t){return`${t.tournamentId}|${t.venueId}|${t.courtId}`}function Wf(t,e){return`${t}|${e}`}function xde(t,e,i){return`${t}|${e}|${i}`}function bm(t){return t.venueId||t.venueName||"unknown-venue"}function Xf(t){return t.courtId||t.courtName||"unknown-court"}function UG(t,e){let i=t.start,r=t.end,n=e?.start,a=e?.end;if(r<=n||i>=a)return null;let s=i<n?n:i,o=r>a?a:r;return{...t,start:s,end:o}}function TG(t,e){return t?.start<e?.end&&e?.start<t?.end}function Fde(t,e){let i=t?.start>e?.start?t?.start:e?.start,r=t?.end<e?.end?t?.end:e?.end;return{start:i,end:r}}function uT(t,e){let i=new Date(t),r=(new Date(e).getTime()-i.getTime())/(1e3*60);return Number.isNaN(r)?0:r}function hE(t,e,i){if(t.length===0||!i||i.length===0)return Ot.AVAILABLE;let r=new Map(i.map((s,o)=>[s,o])),n=Ot.AVAILABLE,a=1/0;for(let s of t){let o=e.get(s);if(!o)continue;let l=r.get(o.type);l!==void 0&&l<a&&(a=l,n=o.type)}return n}function DG(t){let e=[];if(!Array.isArray(t))return e;for(let i of t)e.push({time:i.start,type:"START",blockId:i.id}),e.push({time:i.end,type:"END",blockId:i.id});return e}function PG(t){return Array.isArray(t)?t.slice().sort((e,i)=>{let r=e.time.localeCompare(i.time);return r!==0?r:e.type==="END"&&i.type==="START"?-1:e.type==="START"&&i.type==="END"?1:0}):[]}function EG(t,e,i){if(!Array.isArray(t)||!e||!i)return[];let r=t.map(u=>UG(u,e)).filter(u=>u!==null);if(r.length===0)return[{start:e.start,end:e.end,status:Ot.AVAILABLE,contributingBlocks:[]}];let n=new Map(r.map(u=>[u.id,u])),a=PG(DG(r)),s=new Set,o=[],l=e.start;for(let u of a){let c=u.time;if(c>l){let d=Array.from(s),p=hE(d,n,i.typePrecedence);o.push({start:l,end:c,status:p,contributingBlocks:d})}u.type==="START"?s.add(u.blockId):s.delete(u.blockId),l=c}if(l<e.end){let u=Array.from(s),c=hE(u,n,i.typePrecedence);o.push({start:l,end:e.end,status:c,contributingBlocks:u})}return RG(o)}function RG(t){if(t.length===0)return t;let e=[],i={...t[0]};for(let r=1;r<t.length;r++){let n=t[r],a=i.status===n.status,s=i.contributingBlocks.length===n.contributingBlocks.length&&i.contributingBlocks.every(l=>n.contributingBlocks.includes(l)),o=i.end===n.start;a&&s&&o?i.end=n.end:(e.push(i),i={...n})}return e.push(i),e}function np(t){return Ze(t)}function Lde(t,e){return{start:`${t}T${e?.dayStartTime}:00`,end:`${t}T${e?.dayEndTime}:00`}}function _de(t){for(let e=0;e<t.length;e++){let i=t[e];if(i.start>=i.end)return!1;if(e<t.length-1){let r=t[e+1];if(i.end>r.start||i.end!==r.start)return!1}}return!0}function CG(t,e){let i=new Set;if(!Array.isArray(e))return{day:t,points:[]};for(let a of e)for(let s of a.rails)for(let o of s.segments)i.add(o.start),i.add(o.end);let r=Array.from(i).sort(),n=r.map(a=>({time:a,courtsAvailable:0,courtsSoftBlocked:0,courtsHardBlocked:0}));for(let a of e)for(let s of a.rails)for(let o=0;o<r.length;o++){let l=r[o],u=Cze(s.segments,l);if(u){let c=n[o];Mze(u,c)}}return{day:t,points:n}}function Cze(t,e){for(let i of t)if(e>=i.start&&e<i.end)return i;return null}function Mze(t,e){switch(t.status){case Ot.AVAILABLE:e.courtsAvailable++;break;case Ot.RESERVED:case Ot.SOFT_BLOCK:e.courtsSoftBlocked++;break;case Ot.BLOCKED:case Ot.PRACTICE:case Ot.MAINTENANCE:case Ot.CLOSED:e.courtsSoftBlocked++;break;case Ot.SCHEDULED:case Ot.HARD_BLOCK:case Ot.LOCKED:e.courtsHardBlocked++;break}}function $de(t){if(!t.points||t.points.length===0)return{peakAvailable:0,peakTime:"",minAvailable:0,minTime:"",avgAvailable:0,totalCourtHours:0,utilizationPercent:0,peakUnavailable:0,peakUnavailableTime:"",totalCourts:0,totalAvailableHours:0,totalUnavailableHours:0,availablePercent:0,avgBlockedHoursPerCourt:0};let e=0,i=t.points[0].time,r=1/0,n=t.points[0].time,a=0,s=t.points[0].time,o=0,l=0,u=0;for(let g=0;g<t.points.length-1;g++){let I=t.points[g],v=t.points[g+1],w=(new Date(v.time).getTime()-new Date(I.time).getTime())/(1e3*60*60),y=I.courtsAvailable+I.courtsSoftBlocked+I.courtsHardBlocked;u=Math.max(u,y);let b=I.courtsSoftBlocked+I.courtsHardBlocked;I.courtsAvailable>e&&(e=I.courtsAvailable,i=I.time),I.courtsAvailable<r&&(r=I.courtsAvailable,n=I.time),b>a&&(a=b,s=I.time),o+=I.courtsAvailable*w,l+=b*w}let c=(new Date(t.points.at(-1).time).getTime()-new Date(t.points[0].time).getTime())/(1e3*60*60),d=u*c,p=d>0?o/d*100:0,f=d>0?l/d*100:0,m=u>0?l/u:0,h=t.points.length>1?t.points.slice(0,-1).reduce((g,I)=>g+I.courtsAvailable,0)/(t.points.length-1):0;return{peakAvailable:e,peakTime:i,minAvailable:r===1/0?0:r,minTime:n,avgAvailable:h,totalCourtHours:d,utilizationPercent:f,peakUnavailable:a,peakUnavailableTime:s,totalCourts:u,totalAvailableHours:o,totalUnavailableHours:l,availablePercent:p,avgBlockedHoursPerCourt:m}}function Bde(t,e){let i=t.points?.filter(r=>r.time>=e.start&&r.time<=e.end);return{...t,points:i}}function Vde(t,e){if(!t.points||t.points.length===0)return t;let i=[],r=new Date(t.points[0].time),n=new Date(t.points.at(-1).time),a=new Date(r);for(;a<=n;){let s=a.toISOString(),o=Nze(t.points,s);o&&i.push(o),a=new Date(a.getTime()+e*60*1e3)}return{...t,points:i}}function Nze(t,e){for(let i=t.length-1;i>=0;i--)if(t[i].time<=e)return{time:e,courtsAvailable:t[i].courtsAvailable,courtsSoftBlocked:t[i].courtsSoftBlocked,courtsHardBlocked:t[i].courtsHardBlocked};return null}function jde(t,e){let i=[],r=new Set;t.points?.forEach(a=>r.add(a.time)),e?.points?.forEach(a=>r.add(a.time));let n=Array.from(r).sort();for(let a of n){let s=t.points?.find(l=>l.time===a)||{courtsAvailable:0,courtsSoftBlocked:0,courtsHardBlocked:0},o=e.points?.find(l=>l.time===a)||{courtsAvailable:0,courtsSoftBlocked:0,courtsHardBlocked:0};i.push({time:a,availableDelta:o.courtsAvailable-s.courtsAvailable,softBlockedDelta:o.courtsSoftBlocked-s.courtsSoftBlocked,hardBlockedDelta:o.courtsHardBlocked-s.courtsHardBlocked})}return i}function Gde(t,e){let i=new Date(t.start?.endsWith("Z")?t.start:t.start+"Z").getTime(),r=new Date(t.end?.endsWith("Z")?t.end:t.end+"Z").getTime(),n=new Date(e?.start?.endsWith("Z")?e?.start:e?.start+"Z").getTime(),a=new Date(e?.end?.endsWith("Z")?e?.end:e?.end+"Z").getTime();return i<a&&r>n}function MG(t,e){let i=new Date(e?.start?.endsWith("Z")?e?.start:e?.start+"Z").getTime(),r=new Date(e?.end?.endsWith("Z")?e?.end:e?.end+"Z").getTime();return i<=t&&t<r}function Hde(t,e){return Array.isArray(e)?e.filter(i=>MG(t,i)):[]}function Wde(t,e,i){let r=e>=t?"forward":"backward",n=Math.min(t,e),a=Math.max(t,e),s,o,l=!1,u;if(r==="forward"){let c=a;for(let d of i){let p=new Date(d.start.endsWith("Z")?d.start:d.start+"Z").getTime(),f=new Date(d.end.endsWith("Z")?d.end:d.end+"Z").getTime();p>t&&p<a&&p<c&&(c=p,l=!0,u=d),p<a&&f>t&&p<c&&p>t&&(c=p,l=!0,u=d)}s=t,o=c}else{let c=n;if(Array.isArray(i))for(let d of i){let p=new Date(d.start.endsWith("Z")?d.start:d.start+"Z").getTime(),f=new Date(d.end.endsWith("Z")?d.end:d.end+"Z").getTime();f<t&&f>n&&f>c&&(c=f,l=!0,u=d),p<t&&f>n&&f>c&&f<t&&(c=f,l=!0,u=d)}s=c,o=t}return{start:s,end:o,clamped:l,clampedBy:u,direction:r}}function zde(t){Array.isArray(t)&&t.sort((e,i)=>{let r=new Date(e.start.endsWith("Z")?e.start:e.start+"Z").getTime(),n=new Date(i.start.endsWith("Z")?i.start:i.start+"Z").getTime();return r-n})}var NG={id:"COURT_OVERLAP",description:"Prevent double-booking courts or overriding hard blocks",evaluate:(t,e)=>{let i=[];for(let r of e){if(r.kind==="REMOVE_BLOCK")continue;let n=r.block,a=Ze(n.start),s=`${n.court.tournamentId}|${n.court.venueId}|${n.court.courtId}|${a}`,o=t.blocksByCourtDay.get(s)||[];for(let l of o){if(l===n.id)continue;let u=t.blocksById.get(l);if(u&&TG(n,u)){let c=u.type===Ot.HARD_BLOCK||u.type===Ot.LOCKED||n.type===Ot.HARD_BLOCK||n.type===Ot.LOCKED?"ERROR":"WARN",d=n.start>u.start?n.start:u.start,p=n.end<u.end?n.end:u.end;i.push({code:"COURT_OVERLAP",message:`Block overlaps existing ${u.type.toLowerCase()} (${u.reason||"no reason"}) on court ${n.court.courtId}`,severity:c,timeRange:{start:d,end:p},courts:[n.court]})}}}return i}},AG={id:"MATCH_WINDOW",description:"Ensure availability windows are large enough for typical matches",evaluate:(t,e)=>{let i=[],r=new Set;for(let n of e){let a=n.block,s=Ze(a.start),o=`${a.court.tournamentId}|${a.court.venueId}|${a.court.courtId}|${s}`;r.add(o)}for(let n of r){let a=(t.blocksByCourtDay.get(n)||[]).map(o=>t.blocksById.get(o)).filter(Boolean).slice().sort((o,l)=>o.start.localeCompare(l.start)),s=null;for(let o of a)if(o.type!==Ot.AVAILABLE&&o.type!==Ot.SOFT_BLOCK&&o.type!==Ot.RESERVED){if(s){let l=uT(s,o.start);l>0&&l<60&&i.push({code:"MATCH_WINDOW_TOO_SMALL",message:`Availability window (${l} minutes) is smaller than typical match duration (60 minutes)`,severity:"WARN",timeRange:{start:s,end:o.start},courts:[o.court]})}s=o.end}}return i}},kG={id:"ADJACENT_BLOCK",description:"Warn about blocks with no transition time",evaluate:(t,e)=>{let i=[];for(let r of e){if(r.kind==="REMOVE_BLOCK")continue;let n=r.block,a=Ze(n.start),s=`${n.court.tournamentId}|${n.court.venueId}|${n.court.courtId}|${a}`,o=t.blocksByCourtDay.get(s)||[];for(let l of o){if(l===n.id)continue;let u=t.blocksById.get(l);u&&(u.end===n.start||n.end===u.start)&&u.type!==n.type&&i.push({code:"NO_TRANSITION_TIME",message:`${n.type} immediately follows ${u.type} with no transition time (recommended: 15 minutes)`,severity:"INFO",timeRange:{start:u.end,end:n.start},courts:[n.court]})}}return i}},OG={id:"LIGHTING",description:"Prevent scheduling on unlit courts after sunset",evaluate:(t,e)=>{let i=[],r="19:00";for(let n of e){if(n.kind==="REMOVE_BLOCK")continue;let a=n.block;a.end.slice(11,16)>r&&(a.type===Ot.AVAILABLE||a.type===Ot.RESERVED)&&i.push({code:"AFTER_SUNSET",message:`Court scheduled after sunset (${r}). Verify court has adequate lighting.`,severity:"WARN",timeRange:{start:`${a.start.slice(0,11)}${r}:00`,end:a.end},courts:[a.court]})}return i}},xG={id:"BLOCK_DURATION",description:"Validate block durations are reasonable",evaluate:(t,e)=>{let i=[];for(let r of e){if(r.kind==="REMOVE_BLOCK")continue;let n=r.block,a=uT(n.start,n.end);a<15?i.push({code:"BLOCK_TOO_SHORT",message:`Block duration (${a} minutes) is unusually short. Minimum recommended: 15 minutes.`,severity:"WARN",timeRange:n,courts:[n.court]}):a>720&&i.push({code:"BLOCK_TOO_LONG",message:`Block duration (${a/60} hours) is unusually long. Maximum recommended: ${720/60} hours.`,severity:"WARN",timeRange:n,courts:[n.court]})}return i}},FG={id:"DAY_BOUNDARY",description:"Ensure blocks do not span multiple days",evaluate:(t,e)=>{let i=[];for(let r of e){if(r.kind==="REMOVE_BLOCK")continue;let n=r.block,a=Ze(n.start),s=Ze(n.end);a!==s&&i.push({code:"SPANS_MULTIPLE_DAYS",message:`Block spans from ${a} to ${s}. Blocks should be contained within a single day.`,severity:"ERROR",timeRange:n,courts:[n.court]})}return i}},LG={id:"MAINTENANCE_WINDOW",description:"Validate maintenance scheduling practices",evaluate:(t,e)=>{let i=[],r="09:00",n="17:00";for(let a of e){if(a.kind==="REMOVE_BLOCK")continue;let s=a.block;if(s.type===Ot.MAINTENANCE){let o=s.start.slice(11,16),l=s.end.slice(11,16),u=uT(s.start,s.end);(o>=r&&o<n||l>r&&l<=n)&&i.push({code:"MAINTENANCE_DURING_PEAK",message:`Maintenance scheduled during peak hours (${r}-${n}). Consider scheduling during off-peak times.`,severity:"INFO",timeRange:s,courts:[s.court]}),u<30&&i.push({code:"MAINTENANCE_TOO_SHORT",message:`Maintenance duration (${u} minutes) may be insufficient. Recommended minimum: 30 minutes.`,severity:"INFO",timeRange:s,courts:[s.court]})}}return i}},qde=[NG,FG,xG,AG,kG,OG,LG],Yde=class{constructor(){this.evaluators=new Map}register(t){this.evaluators.set(t.id,t)}unregister(t){this.evaluators.delete(t)}get(t){return this.evaluators.get(t)}getAll(){return Array.from(this.evaluators.values())}clear(){this.evaluators.clear()}},Kde=t=>({id:"FOLLOW_BY",description:"Player rest and follow-by conflicts using Competition Factory",evaluate:(e,i)=>[]});function Xde(t){return Array.isArray(t)?{errors:t?.filter(e=>e.severity==="ERROR"),warnings:t.filter(e=>e.severity==="WARN"),info:t.filter(e=>e.severity==="INFO")}:{errors:[],warnings:[],info:[]}}function Jde(t){return Array.isArray(t)?t.some(e=>e.severity==="ERROR")?"ERROR":t.some(e=>e.severity==="WARN")?"WARN":t.some(e=>e.severity==="INFO")?"INFO":null:null}function Qde(t){return Array.isArray(t)?t.map(e=>{let i=e.courts.map(n=>n.courtId).join(", "),r=`${e.timeRange.start.slice(11,16)}-${e.timeRange.end.slice(11,16)}`;return`[${e.severity}] ${e.code}: ${e.message} (${i} @ ${r})`}):[]}function pw(t){if(typeof t!="string")return 0;let[e,i]=t.split(":").map(Number);return e*60+i}function mA(t){let e=Math.max(0,Math.min(1439,Math.round(t))),i=Math.floor(e/60),r=e%60;return`${String(i).padStart(2,"0")}:${String(r).padStart(2,"0")}`}function _G(t,e,i="round"){if(e<=0)return t;switch(i){case"floor":return Math.floor(t/e)*e;case"ceil":return Math.ceil(t/e)*e;case"round":return Math.round(t/e)*e}}function Zde(t,e,i="round"){if(!t||typeof t!="string")return t;let r=t.slice(0,10),n=t.slice(11,16),a=pw(n),s=_G(a,e,i),o=mA(s);return`${r}T${o}:00`}function*epe(t,e,i){if(i<=0)return;let r=pw(t),n=pw(e);for(let a=r;a<n;a+=i)yield mA(a)}function gE(t){let e=[t.day,t.venueId,t.eventId];return t.drawId&&e.push(t.drawId),e.push(`R${t.roundNumber}`),e.join("|")}function Aze(t,e){let i=[],r=new Set(t.getTournamentDays()),n=t.listCourtMeta(),a=new Set(n.map(s=>s.ref.venueId));for(let s of e){r.has(s.day)||i.push({ruleId:"PRECHECK_INVALID_DAY",phase:"PRECHECK",severity:"ERROR",message:`Day '${s.day}' is not within the tournament date range`,context:{day:s.day}});for(let o of s.items)a.has(o.venueId)||i.push({ruleId:"PRECHECK_INVALID_VENUE",phase:"PRECHECK",severity:"ERROR",message:`Venue '${o.venueId}' does not exist in the tournament record`,context:{day:s.day,venueId:o.venueId,planItemId:o.planItemId}}),o.notBeforeTime&&!/^\d{2}:\d{2}$/.test(o.notBeforeTime)&&i.push({ruleId:"PRECHECK_INVALID_TIME_FORMAT",phase:"PRECHECK",severity:"ERROR",message:`notBeforeTime '${o.notBeforeTime}' is not valid HH:MM format`,context:{day:s.day,planItemId:o.planItemId}}),o.roundNumber<1&&i.push({ruleId:"PRECHECK_INVALID_ROUND",phase:"PRECHECK",severity:"ERROR",message:`roundNumber must be >= 1, got ${o.roundNumber}`,context:{day:s.day,planItemId:o.planItemId}})}return i}function kze(t,e){let i=[],r=new Set;for(let n of e)for(let a of n.items)r.has(a.planItemId)&&i.push({ruleId:"INTEGRITY_DUPLICATE_PLAN_ITEM",phase:"INTEGRITY",severity:"ERROR",message:`Duplicate plan item '${a.planItemId}'`,context:{day:n.day,planItemId:a.planItemId}}),r.add(a.planItemId);return i}function Oze(t,e){let i=[],r=new Map;for(let n of e)for(let a of n.items){let s=`${a.eventId}|${a.drawId||""}`,o=r.get(s)||[];o.push({day:n.day,roundNumber:a.roundNumber,planItemId:a.planItemId}),r.set(s,o)}for(let[n,a]of r.entries()){if(a.length<2)continue;let s=[...a].sort((o,l)=>o.roundNumber-l.roundNumber);for(let o=1;o<s.length;o++){let l=s[o-1],u=s[o];u.day<l.day&&i.push({ruleId:"ORDERING_ROUND_DAY_SEQUENCE",phase:"ORDERING",severity:"WARN",message:`Round ${u.roundNumber} is scheduled on ${u.day} which is before round ${l.roundNumber} on ${l.day} (event: ${n.split("|")[0]})`,context:{day:u.day,planItemId:u.planItemId},fixAction:{type:"MOVE_PLAN_ITEM",description:`Move round ${u.roundNumber} to ${l.day} or later`,payload:{planItemId:u.planItemId,suggestedDay:l.day}}})}}return i}function xze(t,e){let i=[];for(let r of e){let n=0,a=r.items.filter(p=>p.estimatedDurationMinutes);for(let p of a)n+=p.estimatedDurationMinutes;if(n===0)continue;let s=t.getVisibleTimeRange(r.day),o=t3(s.startTime),l=t3(s.endTime)-o,u=t.listCourtMeta(),c=new Set(r.items.map(p=>p.venueId)),d=(c.size===1?u.filter(p=>p.ref.venueId===[...c][0]):u).length*l;n>d?i.push({ruleId:"CAPACITY_DEMAND_EXCEEDS_SUPPLY",phase:"CAPACITY",severity:"WARN",message:`Estimated demand (${Math.round(n/60)}h) exceeds available court-hours (${Math.round(d/60)}h) on ${r.day}`,context:{day:r.day}}):n>d*.9&&i.push({ruleId:"CAPACITY_NEAR_LIMIT",phase:"CAPACITY",severity:"INFO",message:`Demand is at ${Math.round(n/d*100)}% of capacity on ${r.day}`,context:{day:r.day}})}return i}function t3(t){let[e,i]=t.split(":").map(Number);return e*60+i}var i3=["PRECHECK","INTEGRITY","ORDERING","CAPACITY"],Fze={PRECHECK:Aze,INTEGRITY:kze,ORDERING:Oze,CAPACITY:xze};function tpe(t){let{engine:e,day:i,phases:r}=t,n;if(i){let l=e.getDayPlan(i);n=l?[l]:[]}else n=e?.getAllPlans();let a=r?i3.filter(l=>r.includes(l)):i3,s=[];for(let l of a){let u=Fze[l],c=u(e,n);if(s.push(...c),l==="PRECHECK"&&c.some(d=>d.severity==="ERROR"))break}let o=new Map;for(let l of s){let u=l.context?.planItemId||"__global__",c=o.get(u)||[];c.push(l),o.set(u,c)}return{results:s,issueIndex:o}}var Lze={courtToCourtId:t=>t.courtId,isSchedulableStatus:t=>t===Ot.AVAILABLE||t===Ot.SOFT_BLOCK||t===Ot.RESERVED,aggregateByVenue:!1};function $G(t,e={}){let i={...Lze,...e},r=[];for(let n of t){let{day:a,venueId:s,rails:o}=n;for(let l of o){let{court:u,segments:c}=l,d=i.courtToCourtId(u),p=_ze(c,i);for(let f of p)r.push({date:a,startTime:r3(f.start),endTime:r3(f.end),venueId:s,courtIds:[d]})}}return i.aggregateByVenue?$ze(r):r}function _ze(t,e){let i=[],r=null,n=null;for(let a of t)e.isSchedulableStatus(a.status)?(r||(r=a.start),n=a.end):(r&&n&&i.push({start:r,end:n}),r=null,n=null);return r&&n&&i.push({start:r,end:n}),i}function r3(t){return t.slice(11,16)}function $ze(t){let e=new Map;for(let i of t){let r=`${i.venueId}|${i.date}|${i.startTime}|${i.endTime}`;if(e.has(r)){let n=e.get(r);i.courtIds&&(n.courtIds=[...n.courtIds||[],...i.courtIds])}else e.set(r,{...i})}return Array.from(e.values())}function ipe(t){let{tournamentRecord:e,timelines:i,config:r={},engine:n}=t,a=$G(i,r),s=structuredClone(e),o=new Map;for(let l of a){let u=o.get(l.venueId)||[];u.push(l),o.set(l.venueId,u)}if(s.venues&&Array.isArray(s.venues)){let l=n?.getConfig()?.tournamentId;for(let u of s.venues){let c=bm(u),d=o.get(c);if(d&&(u.dateAvailability=d),n&&l){let p=n.getVenueAvailability(l,c);p&&(u.defaultStartTime=p.startTime,u.defaultEndTime=p.endTime)}}}return s}function rpe(t){let e=[];for(let i of t)!i.scheduleDate||!i.venueIds.length||e.push({scheduleDate:i.scheduleDate,venueIds:i.venueIds,rounds:i.rounds||[]});return e}function npe(t){let{venue:e,tournamentId:i,blockType:r=Ot.AVAILABLE}=t,n=[];if(!e.dateAvailability)return n;let a=bm(e);for(let s of e.dateAvailability){let{date:o,startTime:l,endTime:u,courtIds:c}=s;if(c&&c.length>0)for(let d of c)n.push({court:{tournamentId:i,venueId:a,courtId:d},start:`${o}T${l}:00`,end:`${o}T${u}:00`,type:r});else if(e.courts&&e.courts.length>0)for(let d of e.courts){let p=Xf(d);n.push({court:{tournamentId:i,venueId:a,courtId:p},start:`${o}T${l}:00`,end:`${o}T${u}:00`,type:r})}}return n}function ape(t){let e=[];if(!Array.isArray(t))return e.push("Profile must be an array"),{valid:!1,errors:e};for(let i=0;i<t.length;i++){let r=t[i];if(r.scheduleDate?/^\d{4}-\d{2}-\d{2}$/.test(r.scheduleDate)||e.push(`Item ${i}: invalid scheduleDate format (expected YYYY-MM-DD)`):e.push(`Item ${i}: missing scheduleDate`),(!r.venueIds||!Array.isArray(r.venueIds)||r.venueIds.length===0)&&e.push(`Item ${i}: missing or empty venueIds array`),r.rounds)if(!Array.isArray(r.rounds))e.push(`Item ${i}: rounds must be an array`);else for(let n=0;n<r.rounds.length;n++)r.rounds[n].eventId||e.push(`Item ${i}, round ${n}: missing eventId`)}return{valid:e.length===0,errors:e}}function spe(t){let e=[];if(!Array.isArray(t))return e.push("Entries must be an array"),{valid:!1,errors:e};for(let i=0;i<t.length;i++){let r=t[i];(!r.date||!/^\d{4}-\d{2}-\d{2}$/.test(r.date))&&e.push(`Entry ${i}: invalid or missing date`),(!r.startTime||!/^\d{2}:\d{2}$/.test(r.startTime))&&e.push(`Entry ${i}: invalid or missing startTime (expected HH:MM)`),(!r.endTime||!/^\d{2}:\d{2}$/.test(r.endTime))&&e.push(`Entry ${i}: invalid or missing endTime (expected HH:MM)`),r.startTime&&r.endTime&&r.startTime>=r.endTime&&e.push(`Entry ${i}: startTime must be before endTime`),r.venueId||e.push(`Entry ${i}: missing venueId`)}return{valid:e.length===0,errors:e}}function ope(t){if(t.length===0)return t;let e=new Map;for(let r of t){let n=`${r.venueId}|${r.date}`,a=e.get(n)||[];a.push(r),e.set(n,a)}let i=[];for(let r of e.values()){r.sort((a,s)=>a.startTime.localeCompare(s.startTime));let n={...r[0]};for(let a=1;a<r.length;a++){let s=r[a];s.startTime<=n.endTime?(n.endTime=s.endTime>n.endTime?s.endTime:n.endTime,n.courtIds&&s.courtIds&&(n.courtIds=[...new Set([...n.courtIds,...s.courtIds])])):(i.push(n),n={...s})}i.push(n)}return i}function lpe(t){let e=0;for(let i of t){let r=n3(i.startTime),n=(n3(i.endTime)-r)/60,a=i.courtIds?.length||1;e+=n*a}return e}function n3(t){let[e,i]=t.split(":").map(Number);return e*60+i}var upe={};dt(upe,{addCourt:()=>dA,addCourts:()=>hG,addVenue:()=>CU,deleteCourt:()=>vpe,deleteVenue:()=>GG,deleteVenues:()=>fpe,disableCourts:()=>mpe,disableVenues:()=>hpe,enableCourts:()=>gpe,enableVenues:()=>Ipe,generate:()=>cpe,generateCourts:()=>Gj,getCompetitionVenues:()=>YU,getCourts:()=>Cj,getVenuesAndCourts:()=>Fu,modifyCourt:()=>HG,modifyCourtAvailability:()=>VG,modifyVenue:()=>ype,mutate:()=>dpe,publicFindVenue:()=>E2,query:()=>Ole});var cpe={};dt(cpe,{generateCourts:()=>Gj});var dpe={};dt(dpe,{addCourt:()=>dA,addCourts:()=>hG,addVenue:()=>CU,deleteCourt:()=>vpe,deleteVenue:()=>GG,deleteVenues:()=>fpe,disableCourts:()=>mpe,disableVenues:()=>hpe,enableCourts:()=>gpe,enableVenues:()=>Ipe,modifyCourt:()=>HG,modifyCourtAvailability:()=>VG,modifyVenue:()=>ype});function BG(t){if(!t?.tournamentRecord&&!Array.isArray(t?.venueMatchUps))return{error:ve};if(!t?.courtId)return{error:Ah};let{scheduleVisibilityFilters:e,tournamentRecord:i,matchUpFilters:r,venueMatchUps:n,courtId:a}=t,{schedulingProfile:s}=zc({tournamentRecord:i});if(Array.isArray(n))return{matchUps:l({matchUps:n,courtId:a})};let{matchUps:o}=Ur({scheduleVisibilityFilters:e,tournamentRecord:i,matchUpFilters:r});return{matchUps:l({matchUps:o,courtId:a})};function l({matchUps:u,courtId:c}){let d=u.filter(p=>{let f=p.schedule?.allocatedCourts?.map(({courtId:m})=>m);return p.schedule?.courtId===c||f?.includes(c)});return oE({matchUps:d,schedulingProfile:s})}}function Bze({scheduleVisibilityFilters:t,tournamentRecord:e,matchUpFilters:i,venueId:r}){if(!e)return{error:ve};if(!r)return{error:zd};let{schedulingProfile:n}=zc({tournamentRecord:e}),{matchUps:a}=Ur({scheduleVisibilityFilters:t,tournamentRecord:e,matchUpFilters:i});return{matchUps:s({matchUps:a,venueId:r})};function s({matchUps:o,venueId:l}){let u=o.filter(c=>{let d=c.schedule?.allocatedCourts?.map(({venueId:p})=>p);return c.schedule?.venueId===l||d?.includes(l)});return oE({matchUps:u,schedulingProfile:n})}}function VG({tournamentRecord:t,dateAvailability:e,disableNotice:i,venueMatchUps:r,courtId:n,force:a}){if(!t)return{error:ve};if(!n)return{error:Ah};let s=QM({dateAvailability:e});if(s.error)return s;let{updatedDateAvailability:o,totalMergeCount:l}=Vze(e);e=o;let u=Zd({tournamentRecord:t,courtId:n});if(u.error)return u;let{court:c,venue:d}=u,{matchUps:p}=BG({tournamentRecord:t,venueMatchUps:r,courtId:n});if(p?.length){let f=Dt({tournamentRecord:t})?.appliedPolicies,m=a??f?.[qd]?.allowDeletionWithScoresPresent?.courts,h=[];h.length&&(m||console.log("throw error: scheduled court matchUps",h.length))}return c&&(c.dateAvailability=e,!i&&d&&st({payload:{venue:d,tournamentId:t.tournamentId},topic:jc,key:d.venueId})),{...W,totalMergeCount:l}}function Vze(t){let e=0,i=t.reduce((n,a)=>{let{date:s,startTime:o,endTime:l,bookings:u}=a;return n[s]||(n[s]=[]),n[s].push({startTime:o,endTime:l,bookings:u}),n},{}),r=[];return Object.keys(i).forEach(n=>{i[n].sort(c0e);let{mergedAvailability:a,mergeCount:s}=jze(i[n]);r.push(...a.map(o=>({date:n,...o}))),e+=s}),{updatedDateAvailability:r,totalMergeCount:e}}function jze(t){let e,i,r,n=t.length,a=0,s=[];for(;t.length&&n;){let l=t.shift(),{startTime:u,endTime:c,bookings:d}=l;if(n-=1,!e)e=u,r=d,i=c;else if(nU(Ji(i),Ji(u),!1)>0){let p={startTime:e,endTime:i};r?.length&&(p.bookings=r),s.push(p),e=u,r=d,i=c}else d&&(r?r.push(d):r=d),i=c,a+=1}let o={startTime:e,endTime:i};return r?.length&&(o.bookings=r),s.push(o),{mergedAvailability:s,mergeCount:a}}function jG({matchUpsCount:t=0}){let e=`Schedule would be deleted from ${t} ${t===1?"matchUp":"matchUps"}; use { force: true }`;return{error:Mie,info:e}}function ppe({tournamentRecord:t,drawDefinition:e,matchUpId:i,drawId:r}){let n="removeCourtAssignment";if(!i)return{error:Tn};if(!e&&!r)return{error:xo};let a;if(!e){if(!t)return{error:ve};({drawDefinition:e}=Wn({tournamentRecord:t,drawId:r}))}if(e)({matchUp:a}=fi({drawDefinition:e,matchUpId:i}));else{if(!t)return{error:ve};let s=Ur({tournamentRecord:t,inContext:!1}).matchUps??[];({matchUp:a}=Cse({matchUps:s,matchUpId:i}))}return a?(a.timeItems&&a.timeItems.find(s=>[Ed,wu].includes(s.itemType))&&(a.timeItems=a.timeItems.filter(({itemType:s})=>![Ed,wu].includes(s)),Ut({tournamentId:t?.tournamentId,context:n,drawDefinition:e,matchUp:a})),{...W}):{error:dn}}function GG(t){if(typeof t?.venueId!="string")return{error:zd};let{tournamentRecord:e,venueId:i,force:r}=t,n=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(!Object.keys(n).length)return{error:ve};let a=No({tournamentRecords:n,contextFilters:{venueIds:[i]}}).matchUps??[],s=Dt({tournamentRecord:e})?.appliedPolicies,o=r??s?.[qd]?.allowDeletionWithScoresPresent?.venues;if(!a.length||o)for(let l of Object.values(n)){for(let c of a){let d=ppe({matchUpId:c.matchUpId,drawId:c.drawId,tournamentRecord:l});if(d.error)return d}let u;l.venues=(l.venues??[]).filter(c=>c?.venueId!==i?!0:(u=!0,!1)),u&&st({payload:{venueId:i,tournamentId:l.tournamentId},topic:n2,key:i})}else return jG({matchUpsCount:a.length});return eT({tournamentRecords:n}),{...W}}function fpe({tournamentRecord:t,venueIds:e,force:i}){if(!t)return{error:ve};if(!Array.isArray(e))return{error:re};for(let r of t.venues||[]){let{venueId:n}=r;if(e.includes(n)){let{venueId:a}=r,s=GG({tournamentRecord:t,venueId:a,force:i});if(s.error)return s}}return{...W}}function mpe(t){let{courtIds:e,dates:i}=t,r=ws(t),n=[{[pn]:!0,[xM]:!0}],a=He(t,n);if(a.error)return a;for(let s of Object.values(r))Gze({tournamentRecord:s,courtIds:e,dates:i});return{...W}}function Gze({tournamentRecord:t,courtIds:e,dates:i}){let r=Array.isArray(i)&&i.length?{dates:i}:!0,n=a=>Ft({extension:{value:r,name:bo},creationTime:!1,element:a});for(let a of t.venues||[])for(let s of a.courts||[])if(e?.includes(s.courtId)){let o=n(s);if(o.error)return o}return{...W}}function hpe(t){let{tournamentRecords:e,tournamentId:i,venueIds:r}=t,n=[{[pn]:!0,[FM]:!0}],a=He(t,n);if(a.error)return a;let s=Object.keys(e).filter(o=>!i||o===i);for(let o of s){let l=e[o];Hze({tournamentRecord:l,venueIds:r})}return{...W}}function Hze({tournamentRecord:t,venueIds:e}){for(let i of t.venues||[])if(e?.includes(i.venueId)){let r=Ft({creationTime:!1,element:i,extension:{name:bo,value:!0}});if(r.error)return r}return{...W}}function gpe(t){let e=ws(t),i=[{[pn]:!0}];!t.enableAll&&i.push({[xM]:!0});let r=He(t,i);if(r.error)return r;let{enableAll:n,courtIds:a,dates:s}=t;for(let o of Object.values(e))Wze({tournamentRecord:o,courtIds:a,enableAll:n,dates:s});return{...W}}function Wze({tournamentRecord:t,courtIds:e,enableAll:i,dates:r}){for(let n of t.venues||[])for(let a of n.courts||[])if(i||e?.includes(a.courtId))if(Array.isArray(r)){let{extension:s}=ht({element:a,name:bo});if(s){let o=s.value;Array.isArray(o.dates)&&(o.dates=o.dates.filter(l=>!r.includes(l))),Ft({extension:{name:bo,value:o},creationTime:!1,element:a})}}else Nn({element:a,name:bo});return{...W}}function Ipe(t){let e=ws(t),i=[{[pn]:!0}];!t.enableAll&&i.push({[FM]:!0});let r=He(t,i);if(r.error)return r;let{venueIds:n,enableAll:a}=t;for(let s of Object.values(e))for(let o of s.venues||[])(a||n?.includes(o.venueId))&&Nn({element:o,name:bo});return{...W}}function vpe(t){let{courtId:e,disableNotice:i,force:r}=t,n=ws(t),a=He(t,[{[pn]:!0,[Xre]:!0}]);if(a.error)return a;let s,o;for(let l of Object.values(n)){if(o=zze({tournamentRecord:l,disableNotice:i,courtId:e,force:r}),o.error&&o.error!==vc)return o;o.success&&(s=!0)}return s?{...W}:o}function zze({tournamentRecord:t,disableNotice:e,courtId:i,force:r}){let n=Zd({tournamentRecord:t,courtId:i});if(n.error)return n;let a=n.venue,{matchUps:s}=BG({tournamentRecord:t,courtId:i}),o=Dt({tournamentRecord:t})?.appliedPolicies,l=r??o?.[qd]?.allowDeletionWithScoresPresent?.courts;if(!s?.length||l){for(let u of s??[]){let c=ppe({matchUpId:u.matchUpId,drawId:u.drawId,tournamentRecord:t});if(c.error)return c}a&&(a.courts=(a.courts??[]).filter(u=>u.courtId!==i),e||st({payload:{venue:a,tournamentId:t.tournamentId},topic:jc,key:a.venueId}))}else return jG({matchUpsCount:s.length});return{...W}}function HG(t){let{disableNotice:e,modifications:i,courtId:r,force:n,venueMatchUps:a}=t,s=ws(t);if(!Object.keys(s).length)return{error:Mi};let o;for(let l of Object.values(s)){let u=qze({tournamentRecord:l,disableNotice:e,venueMatchUps:a,modifications:i,courtId:r,force:n});if(u?.error)return u;o=!0}return o?{...W}:void 0}function qze({tournamentRecord:t,disableNotice:e,venueMatchUps:i,modifications:r,courtId:n,force:a}){if(!t)return{error:ve};if(!n)return{error:Ah};if(!r||typeof r!="object")return{error:Bc};let s=Zd({tournamentRecord:t,courtId:n});if(s.error)return s;let{venue:o,court:l}=s,u=Object.keys(jWe()).filter(p=>p!=="courtId");if(!Object.keys(r).filter(p=>u.includes(p)).length)return{error:vM};let c=new Set(u.filter(p=>!["dateAvailability"].includes(p))),d=Object.keys(r).filter(p=>c.has(p));if(l&&d.forEach(p=>Object.assign(l,{[p]:r[p]})),r.dateAvailability){let p=VG({dateAvailability:r.dateAvailability,tournamentRecord:t,venueMatchUps:i,disableNotice:e,courtId:n,force:a});if(p.error)return p}return e||st({payload:{venue:o,tournamentId:t.tournamentId},topic:jc,key:o?.venueId}),{...W,court:Oe(l)}}var Yze=()=>({venueId:void 0,venueName:"",venueAbbreviation:"",onlineResources:[],venueType:void 0,defaultStartTime:void 0,defaultEndTime:void 0,isPrimary:void 0,dateAvailability:[],addresses:[],contacts:[],courts:[],roles:[]}),Kze=Yze;function ype(t){let{modifications:e,venueId:i,force:r}=t,n=ws(t);if(!Object.keys(n).length)return{error:Mi};if(typeof i!="string")return{error:zd};let a,s;for(let o of Object.values(n)){let l=Qze({tournamentRecord:o,modifications:e,venueId:i,force:r});if(l.success&&(s=!0),l.error&&(a=l.error),l.error&&l.error!==If)return l}return eT({tournamentRecords:n}),s?{...W}:{error:a}}function Xze({venue:t,modifications:e,tournamentRecord:i,venueMatchUps:r,allowModificationWhenMatchUpsScheduled:n}){let a=t?.courts?.map(u=>u.courtId)??[],s=e.courts?.map(u=>u.courtId)||[],o=s.length?a.filter(u=>!s.includes(u)):e?.courts&&a,l=[];if(o?.length){let u=t?.courts?.filter(c=>o.includes(c.courtId))?.map(c=>{let d=BG({courtId:c.courtId,tournamentRecord:i,venueMatchUps:r});for(let p of d.matchUps??[])l.push({matchUpId:p.matchUpId,drawId:p.drawId});return d.matchUps?.length??0}).reduce((c,d)=>c+d);return t&&(!u||n)?(t.courts=t.courts?.filter(c=>s.includes(c.courtId)),dw({schedule:{courtId:"",scheduledDate:""},matchUpDetails:l,removePriorValues:!0,tournamentRecord:i}),{success:!0}):jG({matchUpsCount:u})}return{success:!0}}function Jze({modifications:t,tournamentRecord:e,venueMatchUps:i,venueId:r,force:n}){if(t.courts)for(let a of t.courts){let{courtId:s}=a||{},o=HG({modifications:a,disableNotice:!0,tournamentRecord:e,venueMatchUps:i,courtId:s,force:n});if(o?.error===vc&&(o=dA({disableNotice:!0,tournamentRecord:e,venueId:r,court:a})),o?.error)return o}return{success:!0}}function Qze({tournamentRecord:t,modifications:e,venueId:i,force:r}){if(!t)return{error:ve};if(!e||typeof e!="object")return{error:Bc};if(!i)return{error:zd};let n=Dt({tournamentRecord:t})?.appliedPolicies,a=r??n?.[qd]?.allowDeletionWithScoresPresent?.venues,{matchUps:s}=Bze({tournamentRecord:t,venueId:i}),o=Ou({tournamentRecord:t,venueId:i});if(o.error)return o;let l=o.venue,u=Object.keys(Kze()).filter(g=>g!=="venueId");if(!Object.keys(e).filter(g=>u.includes(g)).length)return{error:vM};let c=new Set(u.filter(g=>!["courts","onlineResources","dateAvailability","isPrimary"].includes(g))),d=Object.keys(e).filter(g=>c.has(g));if(!l)return{error:If};let p=e.defaultStartTime??l.defaultStartTime,f=e.defaultEndTime??l.defaultEndTime;if(p||f){if(!p||!f)return{error:re,info:"both defaultStartTime and defaultEndTime are required"};if(!KP({startTime:p,endTime:f}))return{error:re,info:"defaultEndTime must be after defaultStartTime"}}if(d.forEach(g=>Object.assign(l,{[g]:e[g]})),"isPrimary"in e&&(e.isPrimary?(rae({tournamentRecord:t}),l.isPrimary=!0):delete l.isPrimary),e.dateAvailability!==void 0){if(Array.isArray(e.dateAvailability)&&e.dateAvailability.length){let g=QM({dateAvailability:e.dateAvailability});if(g.error)return g}l.dateAvailability=e.dateAvailability}let m=Xze({venue:l,modifications:e,tournamentRecord:t,venueMatchUps:s,allowModificationWhenMatchUpsScheduled:a});if("error"in m&&m.error)return m;let h=Jze({modifications:e,tournamentRecord:t,venueMatchUps:s,venueId:i,force:r});return h?.error?h:(eT({tournamentRecord:t}),l&&st({payload:{venue:l,tournamentId:t.tournamentId},topic:jc,key:l?.venueId}),{...W,venue:Oe(l)})}var WG={};dt(WG,{JSON2CSV:()=>aqe,UUID:()=>Ct,UUIDS:()=>ere,allNumeric:()=>fte,attributeFilter:()=>jm,chunkArray:()=>wr,chunkByNth:()=>nx,chunkSizeProfile:()=>pte,constantToString:()=>Qr,countValues:()=>zxe,createMap:()=>ote,dateTime:()=>Zie,definedAttributes:()=>je,dehydrateMatchUps:()=>tqe,extractAttributes:()=>sae,flattenJSON:()=>zG,generateDateRange:()=>UI,generateHashCode:()=>Vxe,generateRange:()=>Ce,generateTimeCode:()=>gce,groupValues:()=>cte,hasAttributeValues:()=>Bxe,instanceCount:()=>Sa,intersection:()=>Li,isConvertableInteger:()=>lt,isNumeric:()=>Ai,isOdd:()=>lte,isPowerOf2:()=>Ro,isValidEmbargoDate:()=>nd,makeDeepCopy:()=>Oe,matchUpScheduleSort:()=>eqe,matchUpSort:()=>zh,nearestPowerOf2:()=>Y$,nextPowerOf2:()=>Cv,noNulls:()=>Wxe,noNumeric:()=>mte,numericSort:()=>nr,occurrences:()=>Yxe,overlap:()=>xn,randomMember:()=>Ns,randomPop:()=>ha,shuffleArray:()=>Cn,structureSort:()=>Bh,subSort:()=>Kxe,timeZone:()=>CWe,undefinedToNull:()=>ix,unique:()=>nt,visualizeScheduledMatchUps:()=>Zze});function Zze({scheduledMatchUps:t,showGlobalLog:e}){N0e();let i=t?.reduce((n,{structureId:a})=>n.includes(a)?n:n.concat(a),[]),r=Array.isArray(i)&&{...i.map(n=>{let{structureName:a,matchUpType:s}=t.find(o=>o.structureId===n);return{[n]:`${a} ${s}`}})};i?.forEach(n=>{Ht({color:"blue",method:"draw",structure:r[n],keyColors:{structure:"magenta"}},!0);let a=t.filter(o=>o.structureId===n),s=Sn({matchUps:a})?.roundMatchUps||[];Object.keys(s).forEach(o=>{Ht({roundNumber:o,keyColors:{roundNumber:"brightcyan"}},!0),s[o].forEach(({matchUpId:l,schedule:u})=>{let c=pi(u.scheduledTime);Ht({matchUpId:l,time:c,date:u.scheduledDate,venue:u.venueId,keyColors:{time:"brightcyan",date:"brightcyan",matchUpId:"yellow",venue:"magenta"}},!0)})})}),e&&M0e()}var{extractTime:a3,timeStringMinutes:s3}=Zie;function eqe(t,e){let i=t.schedule??{},r=e.schedule??{};if(i.scheduledDate&&!r.scheduledDate)return 1;if(r.scheduledDate&&!i.scheduledDate)return-1;if(i.scheduledDate&&r.scheduledDate){if(i.scheduledDate===r.scheduledDate){if(i.scheduledTime&&!r.scheduledTime)return 1;if(r.scheduledTime&&!i.scheduledTime)return-1;if(i.scheduledTime&&r.scheduledTime){let n=s3(a3(i.scheduledTime)),a=s3(a3(r.scheduledTime));return n-a}}return new Date(i.scheduledDate).getTime()-new Date(r.scheduledDate).getTime()}return 0}function tqe({tournamentRecord:t}){if(!t)return{error:ve};if(typeof t!="object"||!t.tournamentId)return{error:re};let{matchUps:e}=Ur({tournamentRecord:t,inContext:!1});if(e?.length){let i=iqe({tournamentRecord:t});nqe(e,i)}return{...W}}function iqe({tournamentRecord:t}){let e={};for(let i of t.events||[]){i.matchUpFormat&&(e[i.eventId]=i.matchUpFormat);for(let r of i.drawDefinitions||[]){r.matchUpFormat&&(e[r.drawId]=r.matchUpFormat);for(let n of r.structures||[]){n.matchUpFormat&&(e[n.structureId]=n.matchUpFormat);for(let a of n.structures||[])a.matchUpFormat&&(e[a.structureId]=a.matchUpFormat)}}}return e}var rqe=["collectionId","collectionPosition","drawPositions","extensions","finishingPositionRange","finishingRound","isMock","matchUpId","matchUpStatus","matchUpStatusCodes","orderOfFinish","processCodes","roundNumber","tieFormat","tieMatchUps","roundPosition","score","sides","winnerMatchUpId","loserMatchUpId","matchUpDuration","winningSide"];function nqe(t,e={}){for(let i of t){let{structureId:r,drawId:n,eventId:a}=i,s=e[r]||e[n]||e[a],o=i.matchUpFormat===s?void 0:i.matchUpFormat;for(let l of Object.keys(i))rqe.includes(l)||delete i[l];i.sides&&i.drawPositions&&!i.tieMatchUps&&delete i.sides,o&&(i.matchUpFormat=o)}}function aqe(t,e){if(e&&typeof e!="object")return{error:re};let{columnTransform:i={}}=e||{},{includeTransformAccessors:r,includeHeaderRow:n=!0,returnTransformedJSON:a,removeEmptyColumns:s,onlyHeaderRow:o,columnAccessors:l=[],functionMap:u={},columnMap:c={},valuesMap:d={},context:p={},delimiter:f='"',columnJoiner:m=",",rowJoiner:h=`\r
`,keyJoiner:g="."}=e||{};if(!Array.isArray(t)||!Array.isArray(l)||typeof p!="object"||typeof c!="object"||typeof i!="object"||typeof u!="object"||typeof d!="object"||typeof m!="string"||typeof h!="string"||typeof g!="string"||typeof f!="string")return{error:re};i=Object.assign({},...Object.keys(i).reverse().map(M=>({[M]:Array.isArray(i[M])?i[M]:[typeof i[M]=="string"&&i[M]].filter(Boolean)})));let I=t.filter(Boolean).map(M=>zG(M,g)),v=Object.values(i).flat();r&&l.push(...v);let w=I.reduce((M,N)=>Object.keys(N).every(A=>!M.includes(A)&&M.push(A)||!0)&&M,[]).filter(M=>!l?.length||l.includes(M)),y=Object.assign({},...Object.keys(i).reverse().map(M=>i[M].map(N=>({[N]:M})).flat()).flat()),b=(M,N)=>e?.sortOrder?e.sortOrder.includes(M)&&e.sortOrder.includes(N)&&e.sortOrder.indexOf(M)-e.sortOrder.indexOf(N)||!e.sortOrder.includes(N)&&-1:0,S=w.reduce((M,N)=>{let A=y[N];return A?M.includes(A)||M.push(A):M.push(N),M},[]).sort(b);Object.keys(c).forEach(M=>!S.includes(M)&&S.unshift(M)),Object.keys(i).forEach(M=>!S.includes(M)&&S.unshift(M)),typeof p=="object"&&Object.keys(p).forEach(M=>!S.includes(M)&&S.unshift(M));let U=S.map(M=>c[M]||M);if(o)return[U];let T=M=>`${f}${M}${f}`,P=[],D=M=>Object.values(S.reduce((N,A,O)=>{let k=i[A],F=(k?.length?M[k.find($=>M[$])]:M[A])||p?.[A]||"",x=d[A]?.[F]||F,L=fa(u[A])?u[A](x):x;return N[A]=T(L),L&&(P[O]=(P[O]||0)+1),N},{})),E=I.map(D),R=s&&[...P].map((M,N)=>!M&&N).filter(Ai).reverse();if(R){let M=N=>N.filter((A,O)=>!R.includes(O));E=E.map(M),U=M(U)}let C=E.map(M=>M.join(m));return a?C.map(M=>{let N=M.split(m);return Object.assign({},...N.map((A,O)=>({[U[O]]:A})))}):n?[U.map(T).join(m),...C].join(h):C.join(h)}function zG(t,e=".",i=[]){return typeof t=="object"&&Object.keys(t).reduce((r,n)=>typeof t[n]!="object"?(r[i.concat(n).join(e)]=t[n],r):Object.assign(r,zG(t[n],e,i.concat(n))),{})}var{FACTORY:o3}=ane;function sqe({tournamentRecord:t,value:e}){let{extension:i}=ht({element:t,name:o3}),r={name:o3,value:{...i?.value,...e}};Ft({element:t,extension:r})}function bpe({timeStamp:t}){let e=xh(),i=SB();return i&&Object.values(e).forEach(r=>{sqe({tournamentRecord:r,value:{version:oM(),timeStamp:t}})}),i}function wpe({engineType:t,methodName:e,elapsed:i,params:r,result:n}){let a=la();if(typeof a!="object")return;let s={method:e},o=n?.error&&(a.errors===!0||Array.isArray(a.errors)&&a.errors.includes(e)),l=Array.isArray(a.params)&&a.params?.includes(e),u=a.params&&!Array.isArray(a.params)||l,c=Array.isArray(a.exclude)&&a.exclude.includes(e);!c&&![void 0,!1].includes(a.perf)&&!isNaN(a.perf)&&i>=a.perf&&(s.elapsed=i),!c&&(o||u)&&(s.params=r),!c&&(o||a.result&&!Array.isArray(a.result)&&(!Array.isArray(a.params)||l)||Array.isArray(a.result)&&a.result?.includes(e))&&(s.result=n),Object.keys(s).length>1&&Vie(s,t)}function qG({methodName:t,params:e,start:i}){let r={error:yM,methodName:t},n=i?Date.now()-i:0;return wpe({result:r,methodName:t,elapsed:n,params:e,engineType:"sync"}),r}function oqe(t,e){if(e._middleware===!1)return e;if(e.tournamentId&&!t[e.tournamentId])return{error:ve};let i=e.drawId||e.matchUp?.drawId;if(i){let{event:a,drawDefinition:s,tournamentId:o}=Wn({tournamentRecords:t,drawId:i});s&&(e.drawDefinition=s),o&&(e.tournamentId=o),a&&(e.event=a)}if(e.eventId&&!e.event){let{event:a,tournamentId:s}=Wn({eventId:e.eventId,tournamentRecords:t});if(!a)return{error:ps};e.tournamentId=s,e.event=a}let r=e.tournamentId??Oh();if(!r&&e)return e;let n=t[r];return r&&!n?{error:ve}:(n&&(e.tournamentRecord=n),e)}function YG(t,e,i,r,n){delete t.success,delete t.error;let a=Date.now(),s=Oh();i&&(i.activeTournamentId=s);let o=i?.tournamentRecord||TB(s),l=typeof i?.tournamentRecord=="object"&&{[i?.tournamentRecord.tournamentId]:i.tournamentRecord}||xh(),u=i?Oe(i,void 0,!0):void 0,c=i?oqe(l,i):void 0;if(c?.error)return c;let d=lqe({params:c,tournamentRecords:l,tournamentRecord:o,methodName:r,method:e}),p=Date.now()-a;return wpe({result:d,methodName:r,elapsed:p,params:u,engineType:n}),d}function lqe({tournamentRecords:t,tournamentRecord:e,params:i,methodName:r,method:n}){if(la())return n({tournamentRecords:t,tournamentRecord:e,...i});try{return n({tournamentRecords:t,tournamentRecord:e,...i})}catch(a){return UM({engineName:"engine",methodName:r,params:i,err:a})}}function hA(t){let{mutationStatus:e,tournamentId:i,directives:r,timeStamp:n}=t||{},{topics:a}=bs();for(let s of[...a].sort(uqe)){let o=_ie({topic:s});o?.length&&mx({topic:s,notices:o})}e&&n&&a.includes(Sx)&&mx({notices:[{tournamentId:i,directives:r,timeStamp:n}],topic:Sx})}var l3={[p2]:5,[d2]:5,[f2]:5,[c2]:5,[u2]:5,[o2]:5,[wne]:5,[Sne]:5,[l2]:1,[GM]:1,[rn]:5,[jc]:5,[s2]:4,[r2]:4,[n2]:4,[a2]:4,[jM]:3,[e2]:2};function uqe(t,e){return(l3[e]||0)-(l3[t]||0)}function cqe({convertExtensions:t,removeExtensions:e}){let i=xh();return{tournamentId:Oh(),tournamentRecords:Oe(i,t,!1,e)}}function dqe(t){let{convertExtensions:e=!1,removeExtensions:i=!1}=t??{},r=t?.tournamentId??Oh();if(typeof r!="string")return{};let n=TB(r);return{tournamentRecord:Oe(n,e,!1,i)}}function pqe(){let t=xh(),{extension:e}=ht({name:Hp,tournamentRecords:t,discover:!0}),i=e?.value?.tournamentIds||[];return Object.keys(t).forEach(r=>{i.includes(r)||delete t[r]}),SM(t)}function u3(t,e=!0){return typeof t!="object"||Array.isArray(t)?{error:Bc}:t?.tournamentId?$ie(e?Oe(t):t):{error:re}}function fw(t,e=!0){if(typeof t!="object")return{error:Bc};if(jb(),Array.isArray(t)){if(t.filter(i=>i?.tournamentId).length!==t.length)return{error:sx};t=Object.assign({},...t.map(i=>({[i.tournamentId]:i})))}else if(t?.tournamentId)t={[t.tournamentId]:t},jb(t.tournamentId);else if(!Object.keys(t).every(i=>t[i].tournamentId===i))return{error:sx};return SM(e?Oe(t):t)}function fqe(t,e,i,r,n,a){let s=jie(i,r,n,a);if(s.error)return s;let o=s.methods??[];return Object.keys(o).filter(l=>fa(o[l])).forEach(l=>{t[l]=u=>{let c=()=>e(t,{[l]:o[l],...u});if(la())return c();try{return c()}catch(d){UM({engineName:"engine",methodName:l,params:u,err:d})}}}),{...W,...t}}function hg(t,e){return e?.error?(t.error=e.error,t.success=!1):(t.error=void 0,t.success=!0),t}function Spe(t,e){t.importMethods=(i,r,n,a)=>fqe(t,e,i,r,n,a),t.getTournament=i=>dqe(i),t.getState=i=>cqe({convertExtensions:i?.convertExtensions,removeExtensions:i?.removeExtensions}),t.version=()=>oM(),t.reset=()=>(SM({}),hg(t)),t.devContext=i=>(Bb(i),hg(t)),t.getDevContext=i=>la(i),t.newTournamentRecord=(i={})=>{let r=uA(i),n=r.tournamentId;return r.error?r:(u3(r),jb(n),{...W,tournamentId:n})},t.setState=(i,r,n)=>{Vb(r,n);let a=fw(i,r);return hg(t,a)},t.setTournamentId=i=>jb(i),t.getTournamentId=()=>Oh(),t.setTournamentRecord=(i,r,n)=>{Vb(r,n);let a=u3(i,r);return hg(t,a)},t.removeTournamentRecord=i=>{let r=Bie(i);return hg(t,r)},t.removeUnlinkedTournamentRecords=()=>{let i=pqe();return hg(t,i)}}function mqe(t,e,i){if(!Array.isArray(e))return{error:re,message:"directives must be an array"};let r=Lie(),n=Date.now(),a=i&&Oe(xh(),!1,!0),s=[];for(let u of e){if(typeof u!="object")return{error:re,message:"directive must be an object"};if(u.params&&typeof u.params!="object")return{error:re,message:"params must be an object"};let{method:c,pipe:d}=u,p=u.params?{...u.params}:{};if(!r[c])return qG({methodName:c,start:n,params:p});if(d){let m=s.at(-1),h=Object.keys(d);for(let g of h)m[g]&&(p[g]=m[g])}let f=YG(t,r[c],p,c,"sync");if(f?.error)return a&&fw(a),{...f,rolledBack:!!a};s.push({...f,methodName:c})}let o=Date.now(),l=bpe({timeStamp:o});return hA({directives:e,mutationStatus:l,timeStamp:o}),rU(),{success:s.every(u=>u.success),results:s}}function c3(t,e){if(!wt(e))return{error:re,message:"args must be an object"};let i=Object.values(e).filter(fa).length;if(i>1)return{message:"there must be only one arg with typeof function",error:re};let r=i?Object.keys(e).find(f=>fa(e[f])):ni(e.method)&&e.method;if(!r)return{error:yM};let{[r]:n,...a}=e,s=e?.params?{...e.params}:{...a},o=s.rollbackOnError&&Oe(xh(),!1,!0),l=n||t[r]||bB()[r];if(!l)return qG({methodName:r,params:s});let u=YG(t,l,s,r,"sync")??{};u?.error&&o&&fw(o);let c=Date.now(),d=bpe({timeStamp:c}),p=u?.success&&s?.delayNotify!==!0&&s?.doNotNotify!==!0;return p&&hA({directives:[{method:l,params:s}],mutationStatus:d,timeStamp:c}),(p||!u?.success||s?.doNotNotify)&&rU(),u}var hqe=(()=>{let t={executionQueue:(e,i)=>mqe(t,e,i),execute:e=>c3(t,e)};return Spe(t,c3),t})(),KG=hqe;function d3(t,e){if(!wt(e))return{error:re,message:"args must be an object"};let i=Object.values(e).filter(fa).length;if(i>1)return{message:"there must be only one arg with typeof function",error:re};let r=i?Object.keys(e).find(l=>fa(e[l])):ni(e.method)&&e.method;if(!r)return{error:yM};let{[r]:n,...a}=e,s=e?.params?{...e.params}:{...a},o=n||t[r]||bB()[r];return o?YG(t,o,s,r,"ask"):qG({methodName:r,params:s})}(()=>{let t={execute:e=>d3(t,e)};return Spe(t,d3),t})();var wm={},td;function Upe(t,e=!0){if(!t)return{error:Je};if(typeof t!="object")return{error:Bc};if(t.matchUpId)td=t.matchUpId,wm[td]=e?Oe(t):t;else if(Array.isArray(t))for(let i of t.reverse())i.matchUpId&&(wm[i.matchUpId]=e?Oe(i):i,td||(td=i.matchUpId));else for(let i of Object.values(t))i.matchUpId&&(wm[i.matchUpId]=e?Oe(i):i,td||(td=i.matchUpId));return e?Oe(t):t}function gqe(){return wm[td]}function Iqe(){return Object.values(wm)}function vqe(){td=void 0,wm={}}function yqe(t){return Oe(wm[td],t?.convertExtensions,!1,t?.removeExtensions)}(()=>{let t={getState:i=>yqe(i),version:()=>oM(),reset:()=>(vqe(),{...W}),drawId:void 0,error:void 0,success:!1,devContext:i=>(Bb(i),t),setState:(i,r,n)=>{Vb(r,n);let a=Upe(i);return e(a)}};function e(i){return i?.error?(t.error=i.error,t.success=!1):(t.error=void 0,t.success=!0,t.drawId=i.drawId),t}return bqe(t,[MV]),t})();function bqe(t,e){e.forEach(i=>{Object.keys(i).forEach(r=>{t[r]=n=>{if(la())return p3(t,{params:n,governor:i,methodName:r});try{return p3(t,{params:n,governor:i,methodName:r})}catch(a){UM({engineName:"matchUpEngine",methodName:r,params:n,err:a})}}})})}function p3(t,{params:e,governor:i,methodName:r}){t.error=void 0,t.success=!1;let n=e?.matchUp||gqe(),a=e?.matchUps||Iqe(),s=e?.rollbackOnError&&Oe(n,!1,!0);e={...e,matchUpId:n?.matchUpId,matchUps:a,matchUp:n};let o=i[r](e);if(o?.error)return s&&Upe(s),{...o,rolledBack:!!s};let l=o?.success&&e?.delayNotify!==!0&&e?.doNotNotify!==!0;return l&&hA(),(l||!o?.success||e?.doNotNotify)&&rU(),o}var Uk=!1;(()=>{let t={version:()=>oM(),setDeepCopy:(n,a)=>(Vb(n,a),t),devContext:n=>(Bb(n),Uk=!0,t)};return i([aG]),t;function e(n,a){let s=n({...a});return s?.error||hA(),rU(),Uk&&(Bb(!1),Uk=!1),s}function i(n){n.forEach(a=>{Object.keys(a).forEach(s=>{t[s]=r(a,s)})})}function r(n,a){return s=>{if(la()){let o=e(n[a],s);return!o?.error&&s?.setState&&o?.tournamentRecord&&fw(o.tournamentRecord),o}else try{let o=e(n[a],s);return!o?.error&&s?.setState&&o?.tournamentRecord&&fw(o.tournamentRecord),o}catch(o){let l;typeof o=="string"?l=o.toUpperCase():o instanceof Error&&(l=o.message),console.log("ERROR",{params:JSON.stringify(s),method:a,error:l})}}}})();var wqe={};dt(wqe,{BLOCK_TYPES:()=>Ot,EvaluatorRegistry:()=>Yde,TemporalEngine:()=>Sqe,adjacentBlockEvaluator:()=>kG,applyTemporalAvailabilityToTournamentRecord:()=>ipe,blockDurationEvaluator:()=>xG,buildDayRange:()=>Lde,buildEdges:()=>DG,buildSchedulingProfileFromUISelections:()=>rpe,calculateCapacityStats:()=>$de,calculateCourtHours:()=>lpe,clampDragToCollisions:()=>Wde,clampToDayRange:()=>UG,compareCapacityCurves:()=>jde,computePlanItemId:()=>gE,courtDayKey:()=>eb,courtKey:()=>Lg,courtOverlapEvaluator:()=>NG,createFollowByEvaluator:()=>Kde,dayBoundaryEvaluator:()=>FG,defaultEvaluators:()=>qde,deriveRailSegments:()=>EG,diffMinutes:()=>uT,extractDay:()=>np,filterCapacityCurve:()=>Bde,findBlocksContainingTime:()=>Hde,formatConflicts:()=>Qde,generateCapacityCurve:()=>CG,getHighestSeverity:()=>Jde,groupConflictsBySeverity:()=>Xde,hhmmToMinutes:()=>pw,intervalsOverlap:()=>Gde,iterateDayTicks:()=>epe,lightingEvaluator:()=>OG,maintenanceWindowEvaluator:()=>LG,matchWindowEvaluator:()=>AG,mergeAdjacentSegments:()=>RG,mergeOverlappingAvailability:()=>ope,minutesToHhmm:()=>mA,overlappingRange:()=>Fde,railsToDateAvailability:()=>$G,rangesOverlap:()=>TG,resolveCourtId:()=>Xf,resolveStatus:()=>hE,resolveVenueId:()=>bm,runValidationPipeline:()=>tpe,sampleCapacityCurve:()=>Vde,snapIsoToGranularity:()=>Zde,snapToGranularity:()=>_G,sortBlocksByStart:()=>zde,sortEdges:()=>PG,timeInsideBlock:()=>MG,todsAvailabilityToBlocks:()=>npe,validateDateAvailability:()=>spe,validateSchedulingProfileFormat:()=>ape,validateSegments:()=>_de,venueDayKey:()=>xde,venueKey:()=>Wf});var gg,Sqe=(gg=class{constructor(){this.tournamentRecord=null,this.blocksById=new Map,this.blocksByCourtDay=new Map,this.courtDayAvailability=new Map,this.venueDayAvailability=new Map,this.templates=new Map,this.rules=new Map,this.plans=new Map,this.subscribers=[],this.resolvedGranularity=15,this.nextBlockId=1}init(t,e){this.tournamentRecord=t,this.config={tournamentId:e?.tournamentId||t?.tournamentId||"tournament-1",dayStartTime:e?.dayStartTime||"06:00",dayEndTime:e?.dayEndTime||"23:00",slotMinutes:e?.slotMinutes||15,granularityMinutes:e?.granularityMinutes,typePrecedence:e?.typePrecedence||[Ot.HARD_BLOCK,Ot.LOCKED,Ot.MAINTENANCE,Ot.BLOCKED,Ot.PRACTICE,Ot.RESERVED,Ot.SOFT_BLOCK,Ot.AVAILABLE,Ot.UNSPECIFIED],conflictEvaluators:e?.conflictEvaluators||[]},this.resolvedGranularity=this.config.granularityMinutes??this.config.slotMinutes??15,this.plans.clear(),this.loadBlocksFromTournamentRecord(),this.emit({type:"STATE_CHANGED",payload:{reason:"INIT"}})}updateTournamentRecord(t){this.tournamentRecord=t,this.loadBlocksFromTournamentRecord(),this.emit({type:"STATE_CHANGED",payload:{reason:"TOURNAMENT_RECORD_UPDATED"}})}getConfig(){return{...this.config}}getResolvedGranularityMinutes(){return this.resolvedGranularity}getCourtAvailability(t,e){let i=Lg(t),r=this.courtDayAvailability.get(`${i}|${e}`)??this.courtDayAvailability.get(`${i}|DEFAULT`)??null,n=Wf(t.tournamentId,t.venueId),a=this.venueDayAvailability.get(`${n}|${e}`)??this.venueDayAvailability.get(`${n}|DEFAULT`)??null;if(r&&a){let s=r.startTime>a.startTime?r.startTime:a.startTime,o=r.endTime<a.endTime?r.endTime:a.endTime;return s>=o?a:{startTime:s,endTime:o}}return r||a||this.courtDayAvailability.get("GLOBAL|DEFAULT")||{startTime:this.config.dayStartTime,endTime:this.config.dayEndTime}}setCourtAvailability(t,e,i){let r=Lg(t);this.courtDayAvailability.set(`${r}|${e}`,i),this.emit({type:"AVAILABILITY_CHANGED",payload:{court:t,day:e,avail:i}})}setCourtAvailabilityAllDays(t,e){let i=Lg(t);this.courtDayAvailability.set(`${i}|DEFAULT`,e),this.emit({type:"AVAILABILITY_CHANGED",payload:{court:t,scope:"all-days",avail:e}})}setAllCourtsDefaultAvailability(t){this.courtDayAvailability.set("GLOBAL|DEFAULT",t),this.emit({type:"AVAILABILITY_CHANGED",payload:{scope:"global",avail:t}})}getVenueAvailability(t,e,i){let r=Wf(t,e);if(i){let n=this.venueDayAvailability.get(`${r}|${i}`);if(n)return n}return this.venueDayAvailability.get(`${r}|DEFAULT`)??null}setVenueDefaultAvailability(t,e,i){let r=Wf(t,e);this.venueDayAvailability.set(`${r}|DEFAULT`,i),this.emit({type:"AVAILABILITY_CHANGED",payload:{tournamentId:t,venueId:e,scope:"venue",avail:i}})}setVenueDayAvailability(t,e,i,r){let n=Wf(t,e);this.venueDayAvailability.set(`${n}|${i}`,r),this.emit({type:"AVAILABILITY_CHANGED",payload:{tournamentId:t,venueId:e,day:i,scope:"venue-day",avail:r}})}getVisibleTimeRange(t,e){let i=e&&e.length>0?e:this.getAllCourtsFromTournamentRecord(),r="23:59",n="00:00";for(let a of i){let s=this.getCourtAvailability(a,t);s.startTime<r&&(r=s.startTime),s.endTime>n&&(n=s.endTime)}return i.length===0?{startTime:this.config.dayStartTime,endTime:this.config.dayEndTime}:{startTime:r,endTime:n}}getTournamentDays(){if(!this.tournamentRecord?.startDate)return[];let t=this.tournamentRecord.startDate,e=this.tournamentRecord.endDate||t,i=[],r=new Date(t),n=new Date(e);for(;r<=n;)i.push(r.toISOString().slice(0,10)),r.setDate(r.getDate()+1);return i}getDayTimeline(t){let e=this.getAllCourtsFromTournamentRecord(),i=new Map;for(let n of e){let a=i.get(n.venueId)||[];a.push(n),i.set(n.venueId,a)}let r=[];for(let[n,a]of i.entries()){let s=[];for(let o of a){let l=this.getCourtRail(t,o);l&&s.push(l)}r.push({day:t,venueId:n,rails:s})}return r}getVenueTimeline(t,e){return this.getDayTimeline(t).find(i=>i.venueId===e)||null}getCourtRail(t,e){let i=this.getCourtAvailability(e,t),r={start:`${t}T${i.startTime}:00`,end:`${t}T${i.endTime}:00`},n=eb(e,t),a=(this.blocksByCourtDay.get(n)||[]).map(o=>this.blocksById.get(o)).filter(o=>!!o),s=EG(a,r,this.config);return{court:e,segments:s}}getCapacityCurve(t){let e=this.getDayTimeline(t);return CG(t,e)}getDayBlocks(t){let e=[];for(let i of this.blocksById.values())np(i.start)===t&&e.push(i);return e}getAllBlocks(){return Array.from(this.blocksById.values())}getTemplates(){return Array.from(this.templates.values())}getTemplate(t){return this.templates.get(t)||null}getRules(){return Array.from(this.rules.values())}getRule(t){return this.rules.get(t)||null}addPlanItem(t){let e=gE(t),i={...t,planItemId:e},r=this.plans.get(t.day)||{day:t.day,items:[]};return r.items=r.items.filter(n=>n.planItemId!==e),r.items.push(i),this.plans.set(t.day,r),this.emit({type:"PLAN_CHANGED",payload:{action:"ADD",planItem:i}}),this.emit({type:"STATE_CHANGED",payload:{reason:"PLAN_CHANGED"}}),i}removePlanItem(t){for(let[e,i]of this.plans.entries()){let r=i.items.findIndex(n=>n.planItemId===t);if(r!==-1){let n=i.items.splice(r,1)[0];return i.items.length===0&&this.plans.delete(e),this.emit({type:"PLAN_CHANGED",payload:{action:"REMOVE",planItem:n}}),this.emit({type:"STATE_CHANGED",payload:{reason:"PLAN_CHANGED"}}),!0}}return!1}updatePlanItem(t,e){for(let i of this.plans.values()){let r=i.items.find(n=>n.planItemId===t);if(r)return Object.assign(r,e),this.emit({type:"PLAN_CHANGED",payload:{action:"UPDATE",planItem:r}}),this.emit({type:"STATE_CHANGED",payload:{reason:"PLAN_CHANGED"}}),r}return null}movePlanItem(t,e){let i=null;for(let[a,s]of this.plans.entries()){let o=s.items.findIndex(l=>l.planItemId===t);if(o!==-1){i=s.items.splice(o,1)[0],s.items.length===0&&this.plans.delete(a);break}}if(!i)return null;let r={...i,day:e};r.planItemId=gE(r);let n=this.plans.get(e)||{day:e,items:[]};return n.items=n.items.filter(a=>a.planItemId!==r.planItemId),n.items.push(r),this.plans.set(e,n),this.emit({type:"PLAN_CHANGED",payload:{action:"MOVE",planItem:r,fromDay:i.day}}),this.emit({type:"STATE_CHANGED",payload:{reason:"PLAN_CHANGED"}}),r}getDayPlan(t){return this.plans.get(t)||null}getAllPlans(){return Array.from(this.plans.values())}applyBlock(t){let e=[];for(let i of t.courts){let r=np(t.timeRange.start),n=this.clampToAvailability(i,r,t.timeRange.start,t.timeRange.end);if(!n)continue;let a={id:this.generateBlockId(),court:i,start:n.start,end:n.end,type:t.type,reason:t.reason,hardSoft:t.hardSoft,source:t.source||"USER"};e.push({kind:"ADD_BLOCK",block:a})}return this.applyMutations(e)}moveBlock(t){let e=this.blocksById.get(t.blockId);if(!e)return{applied:[],rejected:[],warnings:[{code:"BLOCK_NOT_FOUND",message:`Block ${t.blockId} not found`}],conflicts:[]};let i=t.newCourt||e.court,r=np(t.newTimeRange.start),n=this.clampToAvailability(i,r,t.newTimeRange.start,t.newTimeRange.end);if(!n)return{applied:[],rejected:[],warnings:[{code:"OUTSIDE_AVAILABILITY",message:"Block falls outside court availability"}],conflicts:[]};let a={...e,start:n.start,end:n.end,court:i};return this.applyMutations([{kind:"UPDATE_BLOCK",block:a,previousBlock:e}])}resizeBlock(t){let e=this.blocksById.get(t.blockId);if(!e)return{applied:[],rejected:[],warnings:[{code:"BLOCK_NOT_FOUND",message:`Block ${t.blockId} not found`}],conflicts:[]};let i=np(t.newTimeRange.start),r=this.clampToAvailability(e.court,i,t.newTimeRange.start,t.newTimeRange.end);if(!r)return{applied:[],rejected:[],warnings:[{code:"OUTSIDE_AVAILABILITY",message:"Block falls outside court availability"}],conflicts:[]};let n={...e,start:r.start,end:r.end};return this.applyMutations([{kind:"UPDATE_BLOCK",block:n,previousBlock:e}])}removeBlock(t){let e=this.blocksById.get(t);return e?this.applyMutations([{kind:"REMOVE_BLOCK",block:e}]):{applied:[],rejected:[],warnings:[{code:"BLOCK_NOT_FOUND",message:`Block ${t} not found`}],conflicts:[]}}applyTemplate(t){return this.templates.get(t.templateId)?{applied:[],rejected:[],warnings:[],conflicts:[]}:{applied:[],rejected:[],warnings:[{code:"TEMPLATE_NOT_FOUND",message:`Template ${t.templateId} not found`}],conflicts:[]}}importScheduledMatchUps(t){let e=[];for(let n of this.blocksById.values())n.type===Ot.SCHEDULED&&n.source==="SYSTEM"&&e.push({kind:"REMOVE_BLOCK",block:n});for(let n of e)this.applyMutation(n);let i=[];for(let n of t){let a=n.startTime.length===5?`${n.startTime}:00`:n.startTime,s=this.timeToMinutes(a)+n.durationMinutes,o=Math.floor(s/60),l=s%60,u=`${String(o).padStart(2,"0")}:${String(l).padStart(2,"0")}:00`,c={id:this.generateBlockId(),court:{tournamentId:this.config.tournamentId,venueId:n.venueId,courtId:n.courtId},start:`${n.date}T${a}`,end:`${n.date}T${u}`,type:Ot.SCHEDULED,source:"SYSTEM",matchUpId:n.matchUpId,reason:"Scheduled Match"};i.push({kind:"ADD_BLOCK",block:c})}let r=this.applyMutations(i);return{...r,applied:[...e,...r.applied]}}timeToMinutes(t){let e=t.split(":").map(Number);return e[0]*60+e[1]}simulateBlocks(t,e){let i=this.createSnapshot(),r=i.applyMutations(t),n=e||this.getFirstAvailableDay(),a=n?i.getDayTimeline(n):[],s=n?i.getCapacityCurve(n):void 0;return{previewRails:a,capacityImpact:s,conflicts:r.conflicts}}subscribe(t){return this.subscribers.push(t),()=>{let e=this.subscribers.indexOf(t);e>-1&&this.subscribers.splice(e,1)}}emit(t){for(let e of this.subscribers)try{e(t)}catch(i){console.error("Error in event listener:",i)}}applyMutations(t){let e=this.evaluateConflicts(t);if(e.filter(r=>r.severity==="ERROR").length>0)return{applied:[],rejected:t,warnings:[],conflicts:e};let i=[];for(let r of t)this.applyMutation(r),i.push(r);return this.emit({type:"BLOCKS_CHANGED",payload:{mutations:i}}),this.emit({type:"STATE_CHANGED",payload:{reason:"BLOCKS_MUTATED"}}),e.length>0&&this.emit({type:"CONFLICTS_CHANGED",payload:{conflicts:e}}),{applied:i,rejected:[],warnings:e.filter(r=>r.severity==="WARN").map(r=>({code:r.code,message:r.message})),conflicts:e}}applyMutation(t){let{kind:e,block:i,previousBlock:r}=t;switch(e){case"ADD_BLOCK":this.blocksById.set(i.id,i),this.indexBlock(i);break;case"UPDATE_BLOCK":r&&this.unindexBlock(r),this.blocksById.set(i.id,i),this.indexBlock(i);break;case"REMOVE_BLOCK":this.unindexBlock(i),this.blocksById.delete(i.id);break}}indexBlock(t){let e=np(t.start),i=eb(t.court,e),r=this.blocksByCourtDay.get(i)||[];r.includes(t.id)||(r.push(t.id),this.blocksByCourtDay.set(i,r))}unindexBlock(t){let e=np(t.start),i=eb(t.court,e),r=(this.blocksByCourtDay.get(i)||[]).filter(n=>n!==t.id);r.length>0?this.blocksByCourtDay.set(i,r):this.blocksByCourtDay.delete(i)}evaluateConflicts(t){let e=this.createContext(),i=[];for(let r of this.config.conflictEvaluators||[])try{let n=r.evaluate(e,t);i.push(...n)}catch(n){console.error(`Error in evaluator ${r.id}:`,n)}return i}createContext(){return{config:this.config,tournamentRecord:this.tournamentRecord,blocksById:new Map(this.blocksById),blocksByCourtDay:new Map(this.blocksByCourtDay),templates:new Map(this.templates),rules:new Map(this.rules)}}createSnapshot(){let t=new gg;return t.config={...this.config},t.tournamentRecord=this.tournamentRecord,t.blocksById=new Map(this.blocksById),t.blocksByCourtDay=new Map(this.blocksByCourtDay),t.courtDayAvailability=new Map(this.courtDayAvailability),t.venueDayAvailability=new Map(this.venueDayAvailability),t.templates=new Map(this.templates),t.rules=new Map(this.rules),t.plans=new Map([...this.plans.entries()].map(([e,i])=>[e,{...i,items:[...i.items]}])),t.nextBlockId=this.nextBlockId,t.resolvedGranularity=this.resolvedGranularity,t}loadBlocksFromTournamentRecord(){if(this.blocksById.clear(),this.blocksByCourtDay.clear(),this.courtDayAvailability.clear(),this.venueDayAvailability.clear(),!!this.tournamentRecord?.venues)for(let t of this.tournamentRecord.venues){let e=bm(t),i=Wf(this.config.tournamentId,e);if(t.defaultStartTime&&t.defaultEndTime&&this.venueDayAvailability.set(`${i}|DEFAULT`,{startTime:t.defaultStartTime,endTime:t.defaultEndTime}),t.dateAvailability?.length){for(let r of t.dateAvailability)if(r.date?r.startTime&&r.endTime&&this.venueDayAvailability.set(`${i}|${r.date}`,{startTime:r.startTime,endTime:r.endTime}):r.startTime&&r.endTime&&this.venueDayAvailability.set(`${i}|DEFAULT`,{startTime:r.startTime,endTime:r.endTime}),r.bookings?.length&&t.courts?.length){let n=r.date||this.tournamentRecord.startDate;for(let a of r.bookings){if(!a.startTime||!a.endTime)continue;let s=a.startTime.length===5?`${a.startTime}:00`:a.startTime,o=a.endTime.length===5?`${a.endTime}:00`:a.endTime,l=gg.BOOKING_TYPE_MAP[(a.bookingType||"").toUpperCase()]||Ot.RESERVED;for(let u of t.courts){let c={tournamentId:this.config.tournamentId,venueId:e,courtId:Xf(u)},d=this.generateBlockId(),p={id:d,court:c,start:`${n}T${s}`,end:`${n}T${o}`,type:l,reason:a.bookingType||"Booking",source:"SYSTEM"};this.blocksById.set(d,p),this.indexBlock(p)}}}}for(let r of t.courts||[]){if(!r.dateAvailability?.length)continue;let n={tournamentId:this.config.tournamentId,venueId:e,courtId:Xf(r)};for(let a of r.dateAvailability){let s=a.date||this.tournamentRecord.startDate;if(a.startTime&&a.endTime){let o=Lg(n);this.courtDayAvailability.set(`${o}|${s}`,{startTime:a.startTime,endTime:a.endTime})}if(a.bookings?.length)for(let o of a.bookings){if(!o.startTime||!o.endTime)continue;let l=o.startTime.length===5?`${o.startTime}:00`:o.startTime,u=o.endTime.length===5?`${o.endTime}:00`:o.endTime,c=gg.BOOKING_TYPE_MAP[(o.bookingType||"").toUpperCase()]||Ot.RESERVED,d=this.generateBlockId(),p={id:d,court:n,start:`${s}T${l}`,end:`${s}T${u}`,type:c,reason:o.bookingType||"Booking",source:"SYSTEM"};this.blocksById.set(d,p),this.indexBlock(p)}}}}}getAllCourtsFromTournamentRecord(){if(!this.tournamentRecord?.venues)return[];let t=[];for(let e of this.tournamentRecord.venues){let i=bm(e);if(e.courts)for(let r of e.courts)t.push({tournamentId:this.config.tournamentId,venueId:i,courtId:Xf(r)})}return t}getFirstAvailableDay(){return this.tournamentRecord?.startDate?Ze(this.tournamentRecord.startDate):null}generateBlockId(){return`block-${this.nextBlockId++}`}clampToAvailability(t,e,i,r){let n=this.getCourtAvailability(t,e),a=`${e}T${n.startTime}:00`,s=`${e}T${n.endTime}:00`,o=i<a?a:i,l=r>s?s:r;return o>=l?null:{start:o,end:l}}listCourtMeta(){return this.getAllCourtsFromTournamentRecord().map(t=>this.getCourtMeta(t))}getCourtMeta(t){if(this.tournamentRecord?.venues){for(let e of this.tournamentRecord.venues)if(bm(e)===t.venueId)for(let i of e.courts||[]){if(Xf(i)!==t.courtId)continue;let r=this.getFirstAvailableDay(),n=r?this.getCourtAvailability(t,r):void 0;return{ref:t,name:i.courtName||i.courtId,surface:i.surfaceCategory||i.surfaceType||"hard",indoor:i.indoorOutdoor==="INDOOR"||i.indoor||!1,hasLights:i.hasLights||!1,tags:[],openTime:n?.startTime,closeTime:n?.endTime}}}return{ref:t,name:t.courtId,surface:"hard",indoor:!1,hasLights:!1,tags:[]}}},gg.BOOKING_TYPE_MAP={MAINTENANCE:Ot.MAINTENANCE,PRACTICE:Ot.PRACTICE,RESERVED:Ot.RESERVED,MATCH:Ot.SCHEDULED,SCHEDULED:Ot.SCHEDULED},gg),Uqe={calculateNewRatings:hoe,generateDynamicRatings:goe};KG.importMethods({...vG,...Uqe});KG.importMethods(z$,!0,1);var Tpe=KG,Tqe={competitionFormatName:"INTENNSE_STANDARD",matchUpFormat:"SET7XA-S:T10P",sport:"INTENNSE",timerProfile:{shotClockSeconds:14,segmentTimers:[{segmentType:"set",direction:"down",minutes:10}],changeoverSeconds:0,setBreakSeconds:120},timeoutRules:{count:5,per:"MATCHUP",durationSeconds:60},substitutionRules:{allowed:!0,allowedMatchUpTypes:["SINGLES","DOUBLES"],timing:"BETWEEN_POINTS"},playerRules:{maxMinutesPerSegment:6,matchUpTypes:["SINGLES"]},penaltyProfile:{sport:"INTENNSE",penaltyTypes:[{penaltyType:"UNSPORTSMANLIKE_CONDUCT",label:"Unsportsmanlike",category:"conduct"},{penaltyType:"BALL_ABUSE",label:"Ball Abuse",category:"conduct"},{penaltyType:"RACKET_ABUSE",label:"Racket Abuse",category:"conduct"}],escalation:[{step:1,consequence:"warning"},{step:2,consequence:"point"},{step:3,consequence:"game"},{step:4,consequence:"default"}]},pointProfile:{sport:"INTENNSE",pointResults:[{result:"Ace",label:"Ace",isServe:!0},{result:"Winner",label:"Winner"},{result:"Serve Winner",label:"Serve Winner",isServe:!0},{result:"Forced Error",label:"Forced Error",isError:!0},{result:"Unforced Error",label:"Unforced Error",isError:!0},{result:"Double Fault",label:"Double Fault",isServe:!0,isError:!0},{result:"Touch",label:"Touch"},{result:"Penalty",label:"Penalty"}]},pointMultipliers:[{condition:{results:["Ace"]},value:2},{condition:{results:["Winner"]},value:2}]},Dqe={competitionFormatName:"TENNIS_STANDARD",matchUpFormat:"SET3-S:6/TB7",sport:"TENNIS",timerProfile:{changeoverSeconds:90,setBreakSeconds:120},timeoutRules:{count:0,per:"MATCHUP"},substitutionRules:{allowed:!1},penaltyProfile:{sport:"TENNIS",penaltyTypes:[{penaltyType:"TIME_VIOLATION",label:"Time Violation",category:"time_violation"},{penaltyType:"COACHING",label:"Coaching",category:"code_violation"},{penaltyType:"UNSPORTSMANLIKE_CONDUCT",label:"Unsportsmanlike",category:"conduct"},{penaltyType:"BALL_ABUSE",label:"Ball Abuse",category:"conduct"},{penaltyType:"RACKET_ABUSE",label:"Racket Abuse",category:"conduct"},{penaltyType:"VERBAL_ABUSE",label:"Verbal Abuse",category:"conduct"},{penaltyType:"AUDIBLE_OBSCENITY",label:"Audible Obscenity",category:"conduct"},{penaltyType:"VISIBLE_OBSCENITY",label:"Visible Obscenity",category:"conduct"}],escalation:[{step:1,consequence:"warning"},{step:2,consequence:"point"},{step:3,consequence:"game"},{step:4,consequence:"default"}]},pointProfile:{sport:"TENNIS",pointResults:[{result:"Ace",label:"Ace",isServe:!0},{result:"Winner",label:"Winner"},{result:"Serve Winner",label:"Serve Winner",isServe:!0},{result:"Forced Error",label:"Forced Error",isError:!0},{result:"Unforced Error",label:"Unforced Error",isError:!0},{result:"Double Fault",label:"Double Fault",isServe:!0,isError:!0},{result:"Penalty",label:"Penalty"}]},pointMultipliers:[]},Pqe={INTENNSE_STANDARD:Tqe,TENNIS_STANDARD:Dqe},Eqe={[Jb]:{roundsToSeparate:void 0,policyName:"Nationality Code",policyAttributes:[{key:"person.nationalityCode"},{key:"individualParticipants.person.nationalityCode"}]}},Rqe={[yu]:{policyName:"positionActionsUnrestricted",enabledStructures:[],otherFlightEntries:!0,disableRoundRestrictions:!0,activePositionOverrides:[Im,Qy]}},Cqe={[yu]:{policyName:"positionActionsNoMovement",enabledStructures:[{stages:[],stageSequences:[],enabledActions:[Im,aw,Ym],disabledActions:[]}]}},Mqe={[yu]:{policyName:"positionActionsDisabled",enabledStructures:!1}},Nqe={[$v]:{policyName:"Participant Privacy Policy",participant:{contacts:!1,individualParticipants:{onlineResources:!1,participantName:!0,participantOtherName:!0,participantId:!0,participantRole:!0,participantStatus:!0,penalties:!1,rankings:!0,ratings:!0,representing:!0,participantRoleResponsibilities:!1,participantType:!0,person:{addresses:!1,biographicalInformation:!1,birthDate:!1,contacts:!1,nationalityCode:!0,nativeFamilyName:!1,nativeGivenName:!1,onlineResources:!1,otherNames:!0,parentOrganisationId:!1,passportFamilyName:!1,passportGivenName:!1,personId:!1,personOtherIds:!1,previousNames:!1,sex:!1,standardFamilyName:!0,standardGivenName:!0,status:!1,tennisId:!1,wheelchair:!0}},individualParticipantIds:!0,onlineResources:!1,participantName:!0,participantOtherName:!0,participantId:!0,participantRole:!0,participantStatus:!0,penalties:!1,rankings:!0,ratings:!0,representing:!0,participantRoleResponsibilities:!1,participantType:!0,person:{addresses:!1,biographicalInformation:!1,birthDate:!1,contacts:!1,nationalityCode:!0,nativeFamilyName:!1,nativeGivenName:!1,onlineResources:!1,otherNames:!0,parentOrganisationId:!1,passportFamilyName:!1,passportGivenName:!1,personId:!1,personOtherIds:!1,previousNames:!1,sex:!1,standardFamilyName:!0,standardGivenName:!0,status:!1,tennisId:!1,wheelchair:!0}}}},Aqe={[ms]:{processCodes:{incompleteAssignmentsOnDefault:["RANKING.IGNORE"]},defaultMatchUpFormat:Vs,allowDeletionWithScoresPresent:{drawDefinitions:!1,structures:!1},requireParticipantsForScoring:!1,requireAllPositionsAssigned:void 0,allowChangePropagation:!1,stage:{[Ae]:{stageSequence:{1:{requireAllPositionsAssigned:!0}}}},matchUpFormats:[],matchUpStatusCodes:{[Ta]:[],[Rl]:[],[qt]:[],[Da]:[],[Sr]:[],[ai]:[]}}},Tk="Personal circumstance",kqe={[ms]:{requireAllPositionsAssigned:!1,stage:{[Ae]:{stageSequence:{1:{requireAllPositionsAssigned:!0}}}},defaultMatchUpFormat:Vs,matchUpFormats:[{description:"Best of 3 tiebreak sets",matchUpFormat:Vs,categoryNames:[],categoryTypes:[]},{description:"Two tiebreak sets, 7-point match tiebreak at one set all",matchUpFormat:"SET3-S:6/TB7-F:TB7"},{description:"Two tiebreak sets, 10-point match tiebreak at one set all",matchUpFormat:"SET3-S:6/TB7-F:TB10"},{description:"One standard tiebreak set to 6, 7-point tiebreak at 6 games all",matchUpFormat:"SET1-S:6/TB7"},{description:"Best of 3 sets to 4",matchUpFormat:"SET3-S:4/TB7"},{description:"Two out of three short sets to 4 with 5-point tiebreak at 3 games all",matchUpFormat:"SET3-S:4/TB5@3"},{description:"One short set to 4, 7-point tiebreak at 4 games all",matchUpFormat:"SET1-S:4/TB7"},{description:"One short set to 4, 5-point tiebreak at 3 games all",matchUpFormat:"SET1-S:4/TB5@3"},{description:"Two short sets to 4, 10-point match tiebreak at one set all",matchUpFormat:"SET3-S:4/TB7-F:TB10"},{description:"Two short sets to 4, 7-point match tiebreak at one set all",matchUpFormat:"SET3-S:4/TB7-F:TB7"},{description:"One no advantage set to 5, tiebreak to 9 at 4-4",matchUpFormat:"SET1-S:5/TB9@4"},{description:"One set to 6 with deciding game at 5 games all",matchUpFormat:"SET1-S:6NOAD"},{description:"One short set to 4, deciding game is played at 3 games all",matchUpFormat:"SET1-S:4NOAD"},{description:"Two short sets to 4 with deciding game at 3-3, 7-point match tiebreak at one set all",matchUpFormat:"SET3-S:4NOAD-F:TB7"},{description:"8 game pro-set with 7 point tiebreak at 8 games all",matchUpFormat:"SET1-S:8/TB7"},{description:"8 game pro-set with 7 point tiebreak at 7 games all",matchUpFormat:"SET1-S:8/TB7@7"},{description:"Best of 3 10-point tiebreak games",matchUpFormat:"SET3-S:TB10"},{description:"One 10-point tiebreak game",matchUpFormat:"SET1-S:TB10"},{description:"Timed 20 minute game - game based",matchUpFormat:"SET1-S:T20"}],matchUpStatusCodes:{[Ta]:[{matchUpStatusCodeDisplay:"Abandoned",label:"Abandoned match",matchUpStatusCode:"OA"}],[Rl]:[{matchUpStatusCodeDisplay:"Unplayed or Cancelled",label:"Cancelled match",matchUpStatusCode:"OC"}],[Da]:[{matchUpStatusCodeDisplay:"Incomplete",label:"Incomplete match",matchUpStatusCode:"OI"}],[qt]:[{description:"Disqualification for cause or ineligibility",label:"Disqualification (ineligibility)",matchUpStatusCodeDisplay:"Def [dq]",matchUpStatusCode:"DQ"},{description:"Misconduct before or between matches",label:"Misconduct",matchUpStatusCodeDisplay:"Def [cond]",matchUpStatusCode:"DM"},{description:"Failure to start match because of adult discipline",label:"Fail. (adult discipline)",matchUpStatusCodeDisplay:"Def [ad]",matchUpStatusCode:"D5"},{description:"Refusal to start match for reason other than adult discipline, injury, illness, or personal circumstance. (After the Referee has conclusively confirmed that a player refuses to play a match, the Referee need not wait until the scheduled time of the match to records the result.)",label:"Refusal to start match",matchUpStatusCodeDisplay:"Def [refsl]",matchUpStatusCode:"D4"},{label:"Not showing up",matchUpStatusCodeDisplay:"Def [ns]",matchUpStatusCode:"D6"},{description:"Lateness for match including, but not limited to, intending to play but mistakenly arriving at the wrong time, location, or without proper equipment",label:"Lateness for match",matchUpStatusCodeDisplay:"Score + Def [late]",matchUpStatusCode:"D7"},{label:"Double default",matchUpStatusCodeDisplay:"Def/Def",matchUpStatusCode:"DD"},{description:"Refusal to continue playing a match for reason other than injury, illness, personal circumstance, or adult discipline",label:"Refusal to continue match",matchUpStatusCodeDisplay:"Def [refsl]",matchUpStatusCode:"D9"},{description:"Default for receiving an injection, IV, or supplemental oxygen",label:"Default (PEDs)",matchUpStatusCodeDisplay:"Def [med]",matchUpStatusCode:"DI"},{description:"Default under Point Penalty System",label:"Default (Point Penalty System)",matchUpStatusCodeDisplay:"Def [pps]",matchUpStatusCode:"DP"}],[ai]:[{matchUpStatusCodeDisplay:"Wo [inj]",matchUpStatusCode:"W1",label:"Injury"},{matchUpStatusCodeDisplay:"Wo [ill]",matchUpStatusCode:"W2",label:"Illness"},{matchUpStatusCodeDisplay:"Wo [pc]",label:Tk,matchUpStatusCode:"W3"},{matchUpStatusCodeDisplay:"Wo/Wo",matchUpStatusCode:"WOWO",label:"Double walkover"},{matchUpStatusCodeDisplay:"Wo [Tae]",label:"Tournament Administrative Error",matchUpStatusCode:"W4"},{matchUpStatusCodeDisplay:"Wo/Withdrawn",matchUpStatusCode:"W5",label:"Withdrawn"}],[Sr]:[{matchUpStatusCodeDisplay:"Ret [inj]",matchUpStatusCode:"RJ",label:"Injury"},{matchUpStatusCodeDisplay:"Ret [ill]",matchUpStatusCode:"RI",label:"Illness"},{matchUpStatusCodeDisplay:"Ret [pc]",label:Tk,matchUpStatusCode:"RC"},{description:"Retirement because of adult discipline",label:"Ret. (adult discipline)",matchUpStatusCodeDisplay:"Ret [ad]",matchUpStatusCode:"RD"},{description:"A player who retires from a match remains eligible for consolations, place playoffs, doubles and subsequent round robin matches",matchUpStatusCodeDisplay:"Ret [elg]",label:"Ret. (eligible)",matchUpStatusCode:"RU"}],[bu]:[{matchUpStatusCodeDisplay:"Wd [inj]",matchUpStatusCode:"WD.INJ",label:"Injury"},{matchUpStatusCodeDisplay:"Wd [ill]",matchUpStatusCode:"WD.ILL",label:"Illness"},{matchUpStatusCodeDisplay:"Wd [pc]",label:Tk,matchUpStatusCode:"WD.PC"},{matchUpStatusCodeDisplay:"Wd/Wd",matchUpStatusCode:"WD.WD",label:"Double withdrawal"},{label:"Tournament Administrative Error",matchUpStatusCodeDisplay:"Wd [Tae]",matchUpStatusCode:"WD.TAE"}]}}},Oqe={[Rs]:{seedingProfile:{positioning:oU},validSeedPositions:{ignore:!0},duplicateSeedNumbers:!0,drawSizeProgression:!0,policyName:"ITF SEEDING",seedsCountThresholds:[{drawSize:4,minimumParticipantCount:3,seedsCount:2},{drawSize:16,minimumParticipantCount:12,seedsCount:4},{drawSize:32,minimumParticipantCount:24,seedsCount:8},{drawSize:64,minimumParticipantCount:48,seedsCount:16},{drawSize:128,minimumParticipantCount:97,seedsCount:32},{drawSize:256,minimumParticipantCount:192,seedsCount:64}]}},xqe={POLICY_AVOIDANCE_COUNTRY:Eqe,POLICY_POSITION_ACTIONS_DEFAULT:Jse,POLICY_POSITION_ACTIONS_DISABLED:Mqe,POLICY_POSITION_ACTIONS_NO_MOVEMENT:Cqe,POLICY_POSITION_ACTIONS_UNRESTRICTED:Rqe,POLICY_PRIVACY_DEFAULT:Nqe,POLICY_ROUND_NAMING_DEFAULT:S2,POLICY_SCHEDULING_DEFAULT:Ale,POLICY_SCORING_DEFAULT:Aqe,POLICY_SCORING_USTA:kqe,POLICY_SEEDING_ITF:Oqe,POLICY_SEEDING_DEFAULT:Ile},i1={competitionFormats:Pqe,ratingsParameters:Pr,matchUpFormats:DFe,countryToFlag:Cne,tieFormats:Yle,countries:cd,policies:xqe,flagIOC:SLe},cT={};dt(cT,{activeMatchUpStatuses:()=>ZB,auditConstants:()=>pHe,competitionFormatConstants:()=>Gqe,completedMatchUpStatuses:()=>Ki,directingMatchUpStatuses:()=>hne,displayConstants:()=>LBe,drawDefinitionConstants:()=>Wre,entryStatusConstants:()=>NLe,errorConditionConstants:()=>g1e,eventConstants:()=>MFe,extensionConstants:()=>ane,flightConstants:()=>DHe,genderConstants:()=>DB,keyValueConstants:()=>EVe,matchUpActionConstants:()=>GBe,matchUpStatusConstants:()=>VM,matchUpTypes:()=>_xe,nonDirectingMatchUpStatuses:()=>gne,particicipantsRequiredMatchUpStatuses:()=>fne,participantConstants:()=>wLe,participantRoles:()=>B2,participantTypes:()=>Yy,penaltyConstants:()=>o3e,policyConstants:()=>nLe,positionActionConstants:()=>q$e,rankingConstants:()=>OGe,ratingConstants:()=>F0e,recoveryTimeRequiredMatchUpStatuses:()=>gLe,requestConstants:()=>yWe,resourceContants:()=>vFe,resultConstants:()=>Qxe,scaleConstants:()=>eLe,scheduleConstants:()=>s0e,sortingConstants:()=>AHe,surfaceConstants:()=>f3e,tieFormatConstants:()=>PFe,timeItemConstants:()=>e0e,topicConstants:()=>vLe,tournamentConstants:()=>Yse,upcomingMatchUpStatuses:()=>Ine,validMatchUpStatuses:()=>mne,venueConstants:()=>g3e,weekdayConstants:()=>eue});var Fqe="INTENNSE_STANDARD",Lqe="TENNIS_STANDARD",_qe="MATCHUP",$qe="HALF",Bqe="SEGMENT",Vqe="BETWEEN_GAMES",jqe="BETWEEN_POINTS",Gqe={INTENNSE_STANDARD:Fqe,TENNIS_STANDARD:Lqe,MATCHUP:_qe,SET:"SET",HALF:$qe,SEGMENT:Bqe,BETWEEN_GAMES:Vqe,BETWEEN_POINTS:jqe,ANY:"ANY"},Hqe="Coaching",Wqe="Ball Abuse",zqe="Racket Abuse",qqe="Verbal Abuse",Yqe="INELIGIBILITY",Kqe="Physical Abuse",Xqe="Unsportmanlike Conduct",Jqe="Dress Code Violation",Qqe="Equipment Violation",Zqe="Leaving the court",e3e="Failure to complete",t3e="No Show",i3e="Other",r3e="REFUSAL_TO_PLAY",n3e="PROHIBITED_SUBSTANCE",a3e="Puncuality",s3e="Failure to sign in",o3e={COACHING:Hqe,BALL_ABUSE:Wqe,RACKET_ABUSE:zqe,VERBAL_ABUSE:qqe,PHYSICAL_ABUSE:Kqe,INELIGIBILITY:Yqe,UNSPORTSMANLIKE_CONDUCT:Xqe,PROHIBITED_SUBSTANCE:n3e,DRESS_CODE_VIOLATION:Jqe,EQUIMENT_VIOLATION:Qqe,LEAVING_THE_COURT:Zqe,REFUSAL_TO_PLAY:r3e,FAILURE_TO_COMPLETE:e3e,NO_SHOW:t3e,OTHER:i3e,PUNCTUALITY:a3e,FAILUIRE_TO_SIGN_IN:s3e},l3e="CLAY",u3e="HARD",c3e="GRASS",d3e="CARPET",p3e="ARTIFICIAL",f3e={CLAY:l3e,HARD:u3e,GRASS:c3e,CARPET:d3e,ARTIFICIAL:p3e},m3e="INDOOR",h3e="OUTDOOR",g3e={INDOOR:m3e,OUTDOOR:h3e};const I3e=t=>hn("chc-flag",t?.variant&&`chc-flag--${t.variant}`);function v3e({matchUp:t,individualParticipant:e,spacer:i}){const r=e?.person?.iso2NationalityCode||"",n=r?i1.countryToFlag(r)?.slice(0,4):"",a=document.createElement("span"),s=t?.matchUpType?.toLowerCase();return i||(a.className=I3e({variant:s})),a.innerHTML=i?"":n,a}function Dk({individualParticipant:t,composition:e,className:i,matchUp:r,spacer:n,side:a,type:s}){if(s==="scale")return Fxe({individualParticipant:t,composition:e,className:i,matchUp:r,spacer:n});const o=e?.configuration||{},l=document.createElement("div");if(s==="flag"&&o.flags)return v3e({matchUp:r,individualParticipant:t,spacer:n});if(s==="seeding"){const u=Oxe({className:i,composition:e,side:a});return typeof u=="string"?l:u}return l}const y3e="Qualifier",b3e="BYE",w3e="TBD";function f3(t){const{isWinningSide:e,side:i,sideNumber:r,individualParticipant:n,matchUp:a,composition:s}=t||{},o=e?"winner":void 0,l=t.eventHandlers||{},u=s?.configuration,c={QUALIFIER:u?.placeHolders?.qualifier||y3e,BYE:u?.placeHolders?.bye||b3e,TBD:u?.placeHolders?.tbd||w3e},d=n?.participantName,p=U=>{Xn(l?.participantClick)&&(U.stopPropagation(),l.participantClick({individualParticipant:n,pointerEvent:U,matchUp:a,side:i}))},f=document.createElement("div");f.classList.add("tmx-i"),f.setAttribute("sideNumber",String(r)),f.setAttribute("id",n?.participantId),f.onclick=p;const m=document.createElement("div");m.className=kOe();const h=u?.flags&&Dk({...t,type:"flag"});if(h)m.appendChild(h);else{const U=Dk({type:"scale",...t});U&&m.appendChild(U)}const g=document.createElement("div");g.className=OOe({variant:o});const I=a?.roundNumber===1,v=a?.drawType==="FEED_IN"&&a?.roundNumber>1&&i?.drawPosition&&!i?.sourceMatchUp,w=I||v,y=u?.persistInputFields;if(u?.inlineAssignment&&Xn(l?.assignParticipant)&&Xn(u?.participantProvider)&&w&&(!i?.bye||y)&&(!i?.qualifier||y)&&a&&(!d||i?.bye||i?.qualifier||y)){let U;i?.bye?U={participantId:"__BYE__",participantName:" BYE "}:i?.qualifier?U={participantId:"__QUALIFIER__",participantName:" QUALIFIER "}:U=n;const T=Axe({matchUp:a,side:i,sideNumber:r,eventHandlers:l,composition:s,currentParticipant:U});g.appendChild(T)}else if(d){const U=document.createElement("span");if(e&&u?.winnerColor)U.style.color=typeof u.winnerColor=="string"?u.winnerColor:"green";else if(u?.genderColor){const T=n?.person?.sex,P=T==="MALE"&&"#2E86C1"||T==="FEMALE"&&"#AA336A"||"";U.style.color=typeof u.genderColor=="string"?u.genderColor:P}U.innerHTML=d,g.appendChild(U)}else{const U=document.createElement("abbr");U.className=AOe({variant:u?.showAddress?"showAddress":""}),U.innerHTML=i?.bye&&c.BYE||i?.qualifier&&c.QUALIFIER||c.TBD,g.appendChild(U)}const b=Dk({...t,className:kxe(),type:"seeding"});b&&g.appendChild(b),m.appendChild(g),f.appendChild(m);const S=GOe(t);return f.appendChild(S),{element:f}}const S3e=t=>hn("chc-pill",t?.variant&&`chc-pill--${t.variant}`),{WALKOVER:U3e,DEFAULTED:T3e,DOUBLE_WALKOVER:D3e,DOUBLE_DEFAULT:P3e,ABANDONED:E3e}=VM;function R3e({matchUpStatus:t}){const e=t?.toLowerCase(),i=["defaulted","retired","walkover","defaulted","double_walkover","double_default","cancelled","in_progress","awaiting_result","dead_rubber","incomplete","suspended","abandoned"].includes(e)?e:void 0,r=[U3e,D3e].includes(t||"")?"WO":[T3e,P3e].includes(t||"")?"DEF":t===E3e?"ABD":t?.split("_").join("").slice(0,3)||"",n=document.createElement("div");n.className=S3e(i?{variant:i}:{});const a=document.createElement("abbr");return a.setAttribute("title",t||""),a.style.textDecoration="none",a.style.borderBottom="none",a.innerHTML=r,n.appendChild(a),n}function C3e(t){return t instanceof Element||t}const M3e=()=>"chc-team-logo";function N3e({teamLogo:t}){console.log({teamLogo:t});const e=document.createElement("div");return e.className=M3e(),e}const A3e=()=>"chc-side-container",k3e=()=>"chc-side-row",O3e=()=>"chc-tick";function x3e({dim:t="20px"}={}){const e=O3e();return`
    <div style="line-height: 0;">
      <svg height="${t}" viewBox="0 0 18 24" width="${t}" xmlns="http://www.w3.org/2000/svg" class="${e}" style="fill: currentcolor;">
        <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"></path>
      </svg>
    </div>
  `}const{WALKOVER:F3e,DEFAULTED:L3e,DOUBLE_WALKOVER:_3e,DOUBLE_DEFAULT:$3e,RETIRED:B3e,SUSPENDED:V3e,CANCELLED:j3e,IN_PROGRESS:G3e,ABANDONED:H3e}=VM;function Dpe({initialRoundNumber:t=1,eventHandlers:e,sideContainer:i,composition:r,participant:n,placeholder:a,sideNumber:s,matchUp:o}){const{winningSide:l,matchUpType:u,isRoundRobin:c,matchUpStatus:d}=o||{},p=r?.configuration;let f;const m=s?o?.sides?.find(E=>E.sideNumber===s):void 0;n||(n=m?.participant,f=p?.allDrawPositions||p?.drawPositions&&m?.drawPosition&&(o?.roundNumber===t||m?.participantFed||c)?m?.drawPosition:"");const h=u==="DOUBLES",g=h?n?.individualParticipants?.[0]:n,I=h&&n?.individualParticipants?.[1],v=!!(s===l||d==="BYE"&&n),w=p?.winnerChevron&&v,y=p?.teamLogo,b=[B3e,F3e,L3e,_3e,$3e,V3e,j3e,G3e,H3e].includes(d)&&!v,S=p?.gameScoreOnly,U=document.createElement("div");if(i&&(U.className=FOe({drawPosition:f,sideNumber:s}),f&&(U.dataset.drawPosition=String(f))),U.classList.add("tmx-p"),U.setAttribute("id",n?.participantId||""),y){const E=N3e({teamLogo:y});U.appendChild(E)}const T=document.createElement("div");T.className=xOe(h?{variant:"doubles"}:{});const P=document.createElement("div");P.className=LOe({winnerChevron:w,isDoubles:h});const D=f3({individualParticipant:g,eventHandlers:e,isWinningSide:v,composition:r,sideNumber:s,matchUp:o,side:m}).element;if(P.appendChild(D),I){const E=f3({individualParticipant:I,eventHandlers:e,isWinningSide:v,composition:r,sideNumber:s,matchUp:o,side:m}).element;P.appendChild(E)}else h&&a&&C3e(a)&&P.appendChild(a);if(T.appendChild(P),U.appendChild(T),i){const E=document.createElement("div");if(v&&!S){const R=x3e();typeof R=="string"?E.innerHTML=R:E.appendChild(R)}else if(b){const R=R3e({matchUpStatus:d});E.appendChild(R)}U.appendChild(E)}return U}const W3e=()=>"chc-round-header";function z3e({eventHandlers:t,roundMatchUps:e,roundProfile:i,roundNumber:r,context:n}){const a=document.createElement("div");a.className=W3e(),a.classList.add("tmx-rh"),a.setAttribute("roundNumber",String(r));const s=Xn(t?.roundVisibilityClick),o=Xn(t?.roundHeaderClick);o&&(a.onclick=p=>t.roundHeaderClick({roundNumber:r,roundProfile:i,roundMatchUps:e,context:n,pointerEvent:p}));const l=i?.[r]?.roundName;if(!l)return a;const u=document.createElement("div");u.style.cssText="display:flex; flex-direction:row; justify-content:space-between;";const c=document.createElement("div");c.textContent=l,u.appendChild(c);const d=document.createElement("div");if(d.style.cssText="display:flex; align-items:center; gap:4px;",s){const p=document.createElement("i");p.className="fa-solid fa-eye tmx-rh-vis",p.style.cssText="cursor:pointer; font-size:0.85rem; color:inherit; opacity:0.7; transition:opacity 0.15s;",p.onmouseenter=()=>p.style.opacity="1",p.onmouseleave=()=>p.style.opacity="0.7",p.onclick=f=>{f.stopPropagation(),t.roundVisibilityClick({roundNumber:r,roundProfile:i,roundMatchUps:e,context:n,pointerEvent:f})},d.appendChild(p)}if(o){const p=document.createElement("span");p.style.cssText="font-weight:bold; cursor:pointer;",p.textContent="",d.appendChild(p)}return u.appendChild(d),a.appendChild(u),a}const Ppe=()=>"chc-round-container",q3e=()=>"chc-structure",Epe=t=>hn("chc-round",t?.variant==="adHoc"&&"chc-round--adhoc"),Y3e=t=>hn("chc-group-separator",t?.variant===0&&"chc-group-separator--0",t?.roundOrder==="first"&&"chc-group-separator--round-first",t?.roundOrder==="last"&&"chc-group-separator--round-last"),K3e=()=>"chc-group-name",m3=t=>hn("chc-results-item",t?.variant&&`chc-results-item--${t.variant}`),X3e=()=>"chc-results-info";function J3e(){return"chc-selected-matchup"}const Q3e=()=>"chc-matchup-container";function Z3e({configuration:t}){return t?.matchUpHover?"chc-matchup chc-matchup--custom-hover":"chc-matchup"}function eYe({variant:t}){return hn("chc-center-info",t!=null&&`chc-center-info--${t}`)}const tYe=()=>"chc-column",iYe=()=>"chc-entry",h3=()=>"chc-status";function rYe({eventHandlers:t,entryStatus:e,sideNumber:i,className:r,matchUp:n}){const a=document.createElement("div");Xn(t?.centerInfoClick)&&(a.onclick=c=>t.centerInfoClick({matchUp:n,sideNumber:i,pointerEvent:c})),a.className=hn(eYe({variant:i}),r),a.classList.add("tmx-ci"),a.setAttribute("sideNumber",String(i));const s=document.createElement("div");s.className=tYe();const o=document.createElement("div");o.className=iYe();const l=document.createElement("div");l.className=h3(),l.innerHTML=e?"Entry status:&nbsp;":"",o.appendChild(l);const u=document.createElement("div");return u.className=h3(),u.innerHTML=e||"",o.appendChild(u),s.appendChild(o),a.appendChild(s),{element:a}}const g3={scheduleInfo:1.8,centerInfo:1.5};function nYe({composition:t,isDoubles:e,roundFactor:i=1}){const r=parseInt(window.getComputedStyle(document.body).getPropertyValue("font-size")),n=t?.configuration||{},a=n?.connectorWidth||16,s=n.centerInfo?g3.centerInfo*r:0,o=n.scheduleInfo?g3.scheduleInfo*r:0,l=(60+(n.showAddress?r:0))*(e?1.3:1)+s,u=l*i,c=(l+o)*i;return d=>{const p=hn("chc-link",d.isFirstRound&&"chc-link--first-round",d.link==="mr"&&"chc-link--no-link",d.link==="m1"&&"chc-link--m1",d.link==="m2"&&"chc-link--m2",d.link==="m0"&&"chc-link--m0",d.link==="noProgression"&&"chc-link--no-progression");return{className:p,applyStyles(f){f.style.setProperty("--chc-connector-w",`${a}px`),f.style.setProperty("--chc-link-m1-h",`${u}px`),f.style.setProperty("--chc-link-m2-h",`${c}px`)},toString(){return p}}}}const Rpe=t=>e=>hn("chc-score-wrapper",(e?.sideNumber===1||String(e?.sideNumber)==="1")&&"chc-score-wrapper--side1",e?.fontSize==="small"&&"chc-score-wrapper--small"),aYe=()=>"chc-tiebreak",Cpe=t=>hn("chc-game-score",t?.variant&&`chc-game-score--${t.variant}`),sYe=()=>"chc-game-wrapper";function oYe({value:t}={}){const e=document.createElement("input");return e.onclick=i=>i.target.select(),e.className=Cpe(),e.value=String(t||""),e}function lYe({gameScoreOnly:t,scoreStripes:e,set:i,sideNumber:r}){const n=r===i?.winningSide||i?.winningSide?"loser":void 0,a=r===2?i.side2Score:i.side1Score,s=i.side2TiebreakScore||i.side1TiebreakScore,o=r===2?i.side2TiebreakScore:i.side1TiebreakScore,l=a===void 0&&o,u=l||a,c=e&&i.setNumber%2?"var(--chc-bg-secondary)":"transparent",d=i.editing?i.editing===r:void 0;let p;if(d)p=oYe({value:u});else if(p=document.createElement("p"),p.className=Cpe({variant:n}),p.classList.add("tmx-st"),p.setAttribute("setNumber",i.setNumber),p.style.backgroundColor=c,p.innerHTML=isNaN(u)?"":u,!t){const f=document.createElement("span");f.className=aYe(),f.innerHTML=s&&!l?String(o):"",p.appendChild(f)}return p}function uYe({participantHeight:t,eventHandlers:e,composition:i,sideNumber:r,matchUp:n}){const a=i?.configuration?.winnerChevron,s=i?.configuration?.gameScoreOnly,o=n?.score?.sets||[],l=i?.configuration?.scoreBox,u=t?r===2?t:t-1:void 0,c=f=>{Xn(e?.scoreClick)&&(f.stopPropagation(),e.scoreClick({pointerEvent:f,matchUp:n}))},d=document.createElement("div");d.className=Rpe()({...!l&&r===1&&{sideNumber:1},fontSize:"small"}),u&&(d.style.height=`${u}px`),d.classList.add("sideScore"),d.classList.add("tmx-scr"),d.onclick=c;const p=document.createElement("div");p.className=sYe();for(const f of o||[]){const m=lYe({gameScoreOnly:s,scoreStripes:a,sideNumber:r,set:f});p.appendChild(m)}return d.appendChild(p),d}const cYe=()=>"chc-scheduling";var r1={exports:{}},dYe=r1.exports,I3;function pYe(){return I3||(I3=1,(function(t,e){(function(i,r){t.exports=r()})(dYe,(function(){var i=1e3,r=6e4,n=36e5,a="millisecond",s="second",o="minute",l="hour",u="day",c="week",d="month",p="quarter",f="year",m="date",h="Invalid Date",g=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,I=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,v={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(M){var N=["th","st","nd","rd"],A=M%100;return"["+M+(N[(A-20)%10]||N[A]||N[0])+"]"}},w=function(M,N,A){var O=String(M);return!O||O.length>=N?M:""+Array(N+1-O.length).join(A)+M},y={s:w,z:function(M){var N=-M.utcOffset(),A=Math.abs(N),O=Math.floor(A/60),k=A%60;return(N<=0?"+":"-")+w(O,2,"0")+":"+w(k,2,"0")},m:function M(N,A){if(N.date()<A.date())return-M(A,N);var O=12*(A.year()-N.year())+(A.month()-N.month()),k=N.clone().add(O,d),F=A-k<0,x=N.clone().add(O+(F?-1:1),d);return+(-(O+(A-k)/(F?k-x:x-k))||0)},a:function(M){return M<0?Math.ceil(M)||0:Math.floor(M)},p:function(M){return{M:d,y:f,w:c,d:u,D:m,h:l,m:o,s,ms:a,Q:p}[M]||String(M||"").toLowerCase().replace(/s$/,"")},u:function(M){return M===void 0}},b="en",S={};S[b]=v;var U="$isDayjsObject",T=function(M){return M instanceof R||!(!M||!M[U])},P=function M(N,A,O){var k;if(!N)return b;if(typeof N=="string"){var F=N.toLowerCase();S[F]&&(k=F),A&&(S[F]=A,k=F);var x=N.split("-");if(!k&&x.length>1)return M(x[0])}else{var L=N.name;S[L]=N,k=L}return!O&&k&&(b=k),k||!O&&b},D=function(M,N){if(T(M))return M.clone();var A=typeof N=="object"?N:{};return A.date=M,A.args=arguments,new R(A)},E=y;E.l=P,E.i=T,E.w=function(M,N){return D(M,{locale:N.$L,utc:N.$u,x:N.$x,$offset:N.$offset})};var R=(function(){function M(A){this.$L=P(A.locale,null,!0),this.parse(A),this.$x=this.$x||A.x||{},this[U]=!0}var N=M.prototype;return N.parse=function(A){this.$d=(function(O){var k=O.date,F=O.utc;if(k===null)return new Date(NaN);if(E.u(k))return new Date;if(k instanceof Date)return new Date(k);if(typeof k=="string"&&!/Z$/i.test(k)){var x=k.match(g);if(x){var L=x[2]-1||0,$=(x[7]||"0").substring(0,3);return F?new Date(Date.UTC(x[1],L,x[3]||1,x[4]||0,x[5]||0,x[6]||0,$)):new Date(x[1],L,x[3]||1,x[4]||0,x[5]||0,x[6]||0,$)}}return new Date(k)})(A),this.init()},N.init=function(){var A=this.$d;this.$y=A.getFullYear(),this.$M=A.getMonth(),this.$D=A.getDate(),this.$W=A.getDay(),this.$H=A.getHours(),this.$m=A.getMinutes(),this.$s=A.getSeconds(),this.$ms=A.getMilliseconds()},N.$utils=function(){return E},N.isValid=function(){return this.$d.toString()!==h},N.isSame=function(A,O){var k=D(A);return this.startOf(O)<=k&&k<=this.endOf(O)},N.isAfter=function(A,O){return D(A)<this.startOf(O)},N.isBefore=function(A,O){return this.endOf(O)<D(A)},N.$g=function(A,O,k){return E.u(A)?this[O]:this.set(k,A)},N.unix=function(){return Math.floor(this.valueOf()/1e3)},N.valueOf=function(){return this.$d.getTime()},N.startOf=function(A,O){var k=this,F=!!E.u(O)||O,x=E.p(A),L=function(Y,X){var Z=E.w(k.$u?Date.UTC(k.$y,X,Y):new Date(k.$y,X,Y),k);return F?Z:Z.endOf(u)},$=function(Y,X){return E.w(k.toDate()[Y].apply(k.toDate("s"),(F?[0,0,0,0]:[23,59,59,999]).slice(X)),k)},V=this.$W,_=this.$M,B=this.$D,G="set"+(this.$u?"UTC":"");switch(x){case f:return F?L(1,0):L(31,11);case d:return F?L(1,_):L(0,_+1);case c:var j=this.$locale().weekStart||0,K=(V<j?V+7:V)-j;return L(F?B-K:B+(6-K),_);case u:case m:return $(G+"Hours",0);case l:return $(G+"Minutes",1);case o:return $(G+"Seconds",2);case s:return $(G+"Milliseconds",3);default:return this.clone()}},N.endOf=function(A){return this.startOf(A,!1)},N.$set=function(A,O){var k,F=E.p(A),x="set"+(this.$u?"UTC":""),L=(k={},k[u]=x+"Date",k[m]=x+"Date",k[d]=x+"Month",k[f]=x+"FullYear",k[l]=x+"Hours",k[o]=x+"Minutes",k[s]=x+"Seconds",k[a]=x+"Milliseconds",k)[F],$=F===u?this.$D+(O-this.$W):O;if(F===d||F===f){var V=this.clone().set(m,1);V.$d[L]($),V.init(),this.$d=V.set(m,Math.min(this.$D,V.daysInMonth())).$d}else L&&this.$d[L]($);return this.init(),this},N.set=function(A,O){return this.clone().$set(A,O)},N.get=function(A){return this[E.p(A)]()},N.add=function(A,O){var k,F=this;A=Number(A);var x=E.p(O),L=function(_){var B=D(F);return E.w(B.date(B.date()+Math.round(_*A)),F)};if(x===d)return this.set(d,this.$M+A);if(x===f)return this.set(f,this.$y+A);if(x===u)return L(1);if(x===c)return L(7);var $=(k={},k[o]=r,k[l]=n,k[s]=i,k)[x]||1,V=this.$d.getTime()+A*$;return E.w(V,this)},N.subtract=function(A,O){return this.add(-1*A,O)},N.format=function(A){var O=this,k=this.$locale();if(!this.isValid())return k.invalidDate||h;var F=A||"YYYY-MM-DDTHH:mm:ssZ",x=E.z(this),L=this.$H,$=this.$m,V=this.$M,_=k.weekdays,B=k.months,G=k.meridiem,j=function(X,Z,J,ae){return X&&(X[Z]||X(O,F))||J[Z].slice(0,ae)},K=function(X){return E.s(L%12||12,X,"0")},Y=G||function(X,Z,J){var ae=X<12?"AM":"PM";return J?ae.toLowerCase():ae};return F.replace(I,(function(X,Z){return Z||(function(J){switch(J){case"YY":return String(O.$y).slice(-2);case"YYYY":return E.s(O.$y,4,"0");case"M":return V+1;case"MM":return E.s(V+1,2,"0");case"MMM":return j(k.monthsShort,V,B,3);case"MMMM":return j(B,V);case"D":return O.$D;case"DD":return E.s(O.$D,2,"0");case"d":return String(O.$W);case"dd":return j(k.weekdaysMin,O.$W,_,2);case"ddd":return j(k.weekdaysShort,O.$W,_,3);case"dddd":return _[O.$W];case"H":return String(L);case"HH":return E.s(L,2,"0");case"h":return K(1);case"hh":return K(2);case"a":return Y(L,$,!0);case"A":return Y(L,$,!1);case"m":return String($);case"mm":return E.s($,2,"0");case"s":return String(O.$s);case"ss":return E.s(O.$s,2,"0");case"SSS":return E.s(O.$ms,3,"0");case"Z":return x}return null})(X)||x.replace(":","")}))},N.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},N.diff=function(A,O,k){var F,x=this,L=E.p(O),$=D(A),V=($.utcOffset()-this.utcOffset())*r,_=this-$,B=function(){return E.m(x,$)};switch(L){case f:F=B()/12;break;case d:F=B();break;case p:F=B()/3;break;case c:F=(_-V)/6048e5;break;case u:F=(_-V)/864e5;break;case l:F=_/n;break;case o:F=_/r;break;case s:F=_/i;break;default:F=_}return k?F:E.a(F)},N.daysInMonth=function(){return this.endOf(d).$D},N.$locale=function(){return S[this.$L]},N.locale=function(A,O){if(!A)return this.$L;var k=this.clone(),F=P(A,O,!0);return F&&(k.$L=F),k},N.clone=function(){return E.w(this.$d,this)},N.toDate=function(){return new Date(this.valueOf())},N.toJSON=function(){return this.isValid()?this.toISOString():null},N.toISOString=function(){return this.$d.toISOString()},N.toString=function(){return this.$d.toUTCString()},M})(),C=R.prototype;return D.prototype=C,[["$ms",a],["$s",s],["$m",o],["$H",l],["$W",u],["$M",d],["$y",f],["$D",m]].forEach((function(M){C[M[1]]=function(N){return this.$g(N,M[0],M[1])}})),D.extend=function(M,N){return M.$i||(M(N,R,D),M.$i=!0),D},D.locale=P,D.isDayjs=T,D.unix=function(M){return D(1e3*M)},D.en=S[b],D.Ls=S,D.p={},D}))})(r1)),r1.exports}var fYe=pYe();const mYe=$$(fYe);function hYe({matchUp:t,eventHandlers:e}){const{scheduledTime:i,scheduledDate:r,venueAbbreviation:n,courtName:a}=t?.schedule||{},{dateTime:{extractDate:s,extractTime:o}}=WG,l=o(i);let u=s(r),c="ddd D MMMM";l&&(c+=", hh:mm A",u+=`T${l}`);const d=r?mYe(u).format(c):"Not scheduled",p=n&&a?.toString().startsWith(n)&&a||n&&a&&`${n} ${a}`||a||n||"",f=document.createElement("div");f.className=cYe(),f.classList.add("tmx-sch"),Xn(e?.scheduleClick)&&(f.onclick=v=>e.scheduleClick({matchUp:t,pointerEvent:v}));const m=document.createElement("div");m.innerHTML=d,f.append(m);const h=v=>{Xn(e?.venueClick)&&(v.stopPropagation(),e.venueClick({pointerEvent:v,matchUp:t}))},g=document.createElement("div");g.style="display: flex; flex-direction: row";const I=document.createElement("div");if(I.style.paddingRight=".2rem",I.onclick=h,I.innerHTML=p,g.append(I),f.append(g),f.onclick){const v=document.createElement("div");v.innerHTML="",g.append(v)}return f}const{completedMatchUpStatuses:gYe}=cT;function v3({initialRoundNumber:t=1,eventHandlers:e,composition:i,sideNumber:r,className:n,matchUp:a}){const s=(i?.configuration||{})?.scheduleInfo,o=a?.score?.scoreStringSide1,l=i?.configuration?.scoreBox&&o,u=a?.matchUpStatus&&gYe.includes(a.matchUpStatus),c=a?.readyToScore&&e?.scoreClick&&!Tpe.checkScoreHasValue({matchUp:a})&&!u,d=document.createElement("div");if(d.className=hn(A3e(),n),d.classList.add("tmx-sd"),d.setAttribute("sideNumber",String(r)),s&&r===1){const m=hYe({matchUp:a,eventHandlers:e});d.appendChild(m)}const p=document.createElement("div");p.className=k3e();const f=Dpe({sideContainer:!0,initialRoundNumber:t,eventHandlers:e,composition:i,sideNumber:r,matchUp:a});if(p.appendChild(f),l){const m=document.createElement("div");m.style.border="1px solid var(--chc-border-secondary)",p.appendChild(m)}if(o){const m=uYe({eventHandlers:e,composition:i,sideNumber:r,matchUp:a});p.appendChild(m)}if(c){const m=g=>{Xn(e?.scoreClick)&&(g.stopPropagation(),e.scoreClick({pointerEvent:g,matchUp:a}))},h=document.createElement("div");h.className=Rpe()({...!l&&r===1&&{sideNumber:1},fontSize:"small"}),h.onclick=m,h.innerHTML="[Score]",p.appendChild(h)}return d.appendChild(p),d}function IYe(t){const{composition:e,initialRoundNumber:i=1,matchUp:r,moiety:n,selectedMatchUpId:a,searchActive:s}=t,{roundFactor:o,roundNumber:l,finishingRound:u,matchUpType:c,preFeedRound:d,stage:p}=r,f=t.isFinalRound||(u?Number.parseInt(String(u))===1:!1),m=p==="QUALIFYING"&&f,h=f,g=l?Number.parseInt(String(l))===i:!1,I=c==="DOUBLES",v=(s||r.isRoundRobin||r.collectionId||t.isLucky||t.isAdHoc)&&"mr"||h&&"noProgression"||(m||d)&&"m0"||n&&"m1"||"m2",w=nYe({composition:e,isDoubles:I,roundFactor:o})({isFirstRound:g,link:v}),y=w.className,b=e?.configuration||{},{resultsInfo:S,centerInfo:U}=b||{},T=t.eventHandlers||{},P=N=>{Xn(T?.matchUpClick)&&T.matchUpClick({pointerEvent:N,matchUp:r})},D=document.createElement("div");D.className=hn(e?.theme,t?.className,"matchup",Q3e()),D.classList.add("tmx-m"),D.setAttribute("id",r?.matchUpId),D.onclick=P;const E=document.createElement("div");E.className=Z3e({configuration:b});const R=({sideNumber:N})=>{const A=r?.sides?.find(O=>O.sideNumber===N)?.participant?.entryStatus?.replace("_"," ");return rYe({eventHandlers:T,entryStatus:A,sideNumber:N,className:N===2?y:void 0,matchUp:r})},C=v3({initialRoundNumber:i,eventHandlers:T,sideNumber:1,composition:e,matchUp:r}),M=v3({className:!U&&y,initialRoundNumber:i,eventHandlers:T,sideNumber:2,composition:e,matchUp:r});if(E.appendChild(C),U){const N=R({sideNumber:1}),A=R({sideNumber:2});E.appendChild(N.element),A.element&&w.applyStyles(A.element),E.appendChild(A.element)}if(E.appendChild(M),U||w.applyStyles(M),S){const N=vYe({score:r.score});E.appendChild(N)}if(D.appendChild(E),a===r.matchUpId){const N=document.createElement("div");N.className=J3e(),D.appendChild(N)}return D}function vYe({score:t}){const e=t?.sets?.filter(Boolean).sort((a,s)=>(a.setNumber||0)-(s.setNumber||0)),i=e?.at(-1),r=i?.side1PointsScore||i?.side2PointsScore,n=document.createElement("div");if(n.className=X3e(),r){const a=document.createElement("div");a.className=m3({variant:"points"}),a.innerHTML="PTS",n.appendChild(a)}for(const a of e||[]){const s=document.createElement("div");s.setAttribute("key",String(a.setNumber)),s.className=m3({variant:"set"}),s.innerHTML=String(a.setNumber),n.appendChild(s)}return n}function yYe({initialRoundNumber:t=1,selectedMatchUpId:e,eventHandlers:i,isFinalRound:r,isRoundRobin:n,searchActive:a,composition:s,roundFactor:o,roundNumber:l,roundProfile:u,minWidth:c,matchUps:d,context:p,isLucky:f}){const m=d.filter(D=>D.roundNumber===l).sort((D,E)=>(D.roundPosition||0)-(E.roundPosition||0)),h=m.every(({roundPosition:D,drawPositions:E})=>!D&&!E),g=s?.configuration||{},I=document.createElement("div");if(I.className=Ppe(),I.classList.add("tmx-rd"),I.setAttribute("roundNumber",String(l)),g.roundHeader){const D=z3e({roundProfile:u,roundMatchUps:m,roundNumber:l,eventHandlers:i,context:p});I.appendChild(D)}const v=document.createElement("div");v.className=Epe({variant:h?"adHoc":void 0}),c&&(v.style.minWidth=c);let w,y,b;if(n){const D=R=>(R||[]).reduce((C,M)=>M+C,0);m.sort((R,C)=>{const M=D(R.drawPositions)-D(C.drawPositions),N=R.drawPositions||[],A=C.drawPositions||[],O=(N.length?Math.min.apply(null,N):0)-(A.length?Math.min.apply(null,A):0);return M||O});const E=m.reduce((R,C)=>(R[C.structureId]=C.structureName,R),{});w=Object.values(E),y=Object.keys(E),b=Object.keys(WG.instanceCount(m.map(({structureId:R})=>R))).length}else h&&m.sort((D,E)=>(D.roundOrder??0)-(E.roundOrder??0));const S=b&&m.length/b,U=Object.keys(u).map(D=>parseInt(D)),T=U.indexOf(l),P=T===0&&"first"||T===U.length-1&&"last";return m.forEach((D,E)=>{const R=S&&!(E%S),C=S&&Math.floor(E/S),M=S&&w[C];if(R){const O=document.createElement("div");O.className=Y3e({...C===0&&{variant:0},...P&&{roundOrder:P}}),v.appendChild(O);const k=document.createElement("div");if(k.className=K3e(),Xn(i?.groupHeaderClick)){const{drawId:F,containerStructureId:x}=m[0];v.onclick=L=>i.groupHeaderClick({structureId:y[C],containerStructureId:x,pointerEvent:L,drawId:F})}l===t&&(k.innerHTML=M),v.appendChild(k)}const N=E%2===0;o?D.roundFactor=o:t>1&&(D.roundFactor=Math.pow(2,l-t));const A=IYe({initialRoundNumber:t,selectedMatchUpId:e,eventHandlers:i,isFinalRound:r,searchActive:a,composition:s,isAdHoc:h,isLucky:f,matchUp:D,moiety:N});v.appendChild(A)}),I.appendChild(v),I}function bYe({initialRoundNumber:t=1,selectedMatchUpId:e,eventHandlers:i,searchActive:r,composition:n,structureId:a,finalColumn:s,matchUps:o,minWidth:l,context:u}){const{roundNumbers:c,roundProfile:d,hasOddMatchUpsCount:p,isNotEliminationStructure:f}=Tpe.getRoundMatchUps({matchUps:o});a=a||u?.structureId||o?.[0]?.structureId;const m=o.some(({isRoundRobin:v})=>v),h=p||f,g=document.createElement("div");g.className=q3e(),g.classList.add("tmx-str"),g.setAttribute("id",a||"");const I=c.length?Math.max.apply(null,c):0;for(const v of c){if(v<t)continue;const w=yYe({initialRoundNumber:t,selectedMatchUpId:e,eventHandlers:i,isFinalRound:v===I,isRoundRobin:m,searchActive:r,composition:n,roundNumber:v,roundProfile:d,matchUps:o,minWidth:l,context:u,isLucky:h});g.appendChild(w)}if(s&&typeof s!="boolean"){const v=document.createElement("div");v.className=Ppe();const w=document.createElement("div");w.className=Epe(),w.appendChild(s),v.appendChild(w),g.appendChild(v)}return g}const y3=()=>"chc-container";function wYe({content:t,theme:e}){const i=document.createElement("div");return i.className=e?hn(y3(),e):y3(),e&&i.classList.add(e),typeof t=="string"?i.innerHTML=t:i.appendChild(t),i}function ly(t,e){return`chc-theme-${t.replace("-theme","")}`}const b3=ly("australian-theme"),SYe=ly("wimbledon-theme"),UYe=ly("french-theme"),TYe=ly("usopen-theme"),w3=ly("basic-theme"),DYe=ly("itf-theme"),PYe={Australian:{configuration:{flags:!0},theme:b3},Basic:{configuration:{gameScoreOnly:!0,teamLogo:!1,roundHeader:!0,placeHolders:{tbd:"-",bye:"Bye"}},theme:w3},DrawPositions:{configuration:{gameScoreOnly:!0,drawPositions:!0,teamLogo:!1},theme:w3},French:{configuration:{bracketedSeeds:!0,flags:!0},theme:UYe},Wimbledon:{configuration:{resultsInfo:!0,flags:!0},theme:SYe},"US Open":{configuration:{scoreBox:!0,flags:!0},theme:TYe},ITF:{configuration:{winnerChevron:!0,centerInfo:!0,flags:!0,roundHeader:!0},theme:DYe},National:{configuration:{bracketedSeeds:"square",allDrawPositions:!0,drawPositions:!0,scheduleInfo:!0,roundHeader:!0,showAddress:!0,scaleAttributes:{scaleColor:"red",scaleType:"RATING",scaleName:"WTN",accessor:"wtnRating"}},theme:b3}},{WTN:tZe,UTR:iZe}=cT.ratingConstants;new Date().toISOString().split("T")[0];new Date().toISOString().split("T")[0];const{WTN:rZe,UTR:nZe,TRN:aZe,NTRP:sZe,DUPR:oZe}=cT.ratingConstants,{RATING:lZe}=cT.scaleConstants,{validateMatchUpScore:uZe,validateSetScore:cZe}=z$.scoreGovernor;var Ws="top",vl="bottom",yl="right",zs="left",XG="auto",dT=[Ws,vl,yl,zs],$I="start",mw="end",EYe="clippingParents",Mpe="viewport",Iy="popper",RYe="reference",S3=dT.reduce(function(t,e){return t.concat([e+"-"+$I,e+"-"+mw])},[]),Npe=[].concat(dT,[XG]).reduce(function(t,e){return t.concat([e,e+"-"+$I,e+"-"+mw])},[]),CYe="beforeRead",MYe="read",NYe="afterRead",AYe="beforeMain",kYe="main",OYe="afterMain",xYe="beforeWrite",FYe="write",LYe="afterWrite",_Ye=[CYe,MYe,NYe,AYe,kYe,OYe,xYe,FYe,LYe];function Mc(t){return t?(t.nodeName||"").toLowerCase():null}function Ao(t){if(t==null)return window;if(t.toString()!=="[object Window]"){var e=t.ownerDocument;return e&&e.defaultView||window}return t}function Jm(t){var e=Ao(t).Element;return t instanceof e||t instanceof Element}function Zo(t){var e=Ao(t).HTMLElement;return t instanceof e||t instanceof HTMLElement}function JG(t){if(typeof ShadowRoot>"u")return!1;var e=Ao(t).ShadowRoot;return t instanceof e||t instanceof ShadowRoot}function $Ye(t){var e=t.state;Object.keys(e.elements).forEach(function(i){var r=e.styles[i]||{},n=e.attributes[i]||{},a=e.elements[i];!Zo(a)||!Mc(a)||(Object.assign(a.style,r),Object.keys(n).forEach(function(s){var o=n[s];o===!1?a.removeAttribute(s):a.setAttribute(s,o===!0?"":o)}))})}function BYe(t){var e=t.state,i={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(e.elements.popper.style,i.popper),e.styles=i,e.elements.arrow&&Object.assign(e.elements.arrow.style,i.arrow),function(){Object.keys(e.elements).forEach(function(r){var n=e.elements[r],a=e.attributes[r]||{},s=Object.keys(e.styles.hasOwnProperty(r)?e.styles[r]:i[r]),o=s.reduce(function(l,u){return l[u]="",l},{});!Zo(n)||!Mc(n)||(Object.assign(n.style,o),Object.keys(a).forEach(function(l){n.removeAttribute(l)}))})}}const Ape={name:"applyStyles",enabled:!0,phase:"write",fn:$Ye,effect:BYe,requires:["computeStyles"]};function ic(t){return t.split("-")[0]}var Sm=Math.max,IE=Math.min,BI=Math.round;function n1(){var t=navigator.userAgentData;return t!=null&&t.brands&&Array.isArray(t.brands)?t.brands.map(function(e){return e.brand+"/"+e.version}).join(" "):navigator.userAgent}function kpe(){return!/^((?!chrome|android).)*safari/i.test(n1())}function VI(t,e,i){e===void 0&&(e=!1),i===void 0&&(i=!1);var r=t.getBoundingClientRect(),n=1,a=1;e&&Zo(t)&&(n=t.offsetWidth>0&&BI(r.width)/t.offsetWidth||1,a=t.offsetHeight>0&&BI(r.height)/t.offsetHeight||1);var s=Jm(t)?Ao(t):window,o=s.visualViewport,l=!kpe()&&i,u=(r.left+(l&&o?o.offsetLeft:0))/n,c=(r.top+(l&&o?o.offsetTop:0))/a,d=r.width/n,p=r.height/a;return{width:d,height:p,top:c,right:u+d,bottom:c+p,left:u,x:u,y:c}}function QG(t){var e=VI(t),i=t.offsetWidth,r=t.offsetHeight;return Math.abs(e.width-i)<=1&&(i=e.width),Math.abs(e.height-r)<=1&&(r=e.height),{x:t.offsetLeft,y:t.offsetTop,width:i,height:r}}function Ope(t,e){var i=e.getRootNode&&e.getRootNode();if(t.contains(e))return!0;if(i&&JG(i)){var r=e;do{if(r&&t.isSameNode(r))return!0;r=r.parentNode||r.host}while(r)}return!1}function Nd(t){return Ao(t).getComputedStyle(t)}function VYe(t){return["table","td","th"].indexOf(Mc(t))>=0}function Cf(t){return((Jm(t)?t.ownerDocument:t.document)||window.document).documentElement}function gA(t){return Mc(t)==="html"?t:t.assignedSlot||t.parentNode||(JG(t)?t.host:null)||Cf(t)}function U3(t){return!Zo(t)||Nd(t).position==="fixed"?null:t.offsetParent}function jYe(t){var e=/firefox/i.test(n1()),i=/Trident/i.test(n1());if(i&&Zo(t)){var r=Nd(t);if(r.position==="fixed")return null}var n=gA(t);for(JG(n)&&(n=n.host);Zo(n)&&["html","body"].indexOf(Mc(n))<0;){var a=Nd(n);if(a.transform!=="none"||a.perspective!=="none"||a.contain==="paint"||["transform","perspective"].indexOf(a.willChange)!==-1||e&&a.willChange==="filter"||e&&a.filter&&a.filter!=="none")return n;n=n.parentNode}return null}function pT(t){for(var e=Ao(t),i=U3(t);i&&VYe(i)&&Nd(i).position==="static";)i=U3(i);return i&&(Mc(i)==="html"||Mc(i)==="body"&&Nd(i).position==="static")?e:i||jYe(t)||e}function ZG(t){return["top","bottom"].indexOf(t)>=0?"x":"y"}function tb(t,e,i){return Sm(t,IE(e,i))}function GYe(t,e,i){var r=tb(t,e,i);return r>i?i:r}function xpe(){return{top:0,right:0,bottom:0,left:0}}function Fpe(t){return Object.assign({},xpe(),t)}function Lpe(t,e){return e.reduce(function(i,r){return i[r]=t,i},{})}var HYe=function(t,e){return t=typeof t=="function"?t(Object.assign({},e.rects,{placement:e.placement})):t,Fpe(typeof t!="number"?t:Lpe(t,dT))};function WYe(t){var e,i=t.state,r=t.name,n=t.options,a=i.elements.arrow,s=i.modifiersData.popperOffsets,o=ic(i.placement),l=ZG(o),u=[zs,yl].indexOf(o)>=0,c=u?"height":"width";if(!(!a||!s)){var d=HYe(n.padding,i),p=QG(a),f=l==="y"?Ws:zs,m=l==="y"?vl:yl,h=i.rects.reference[c]+i.rects.reference[l]-s[l]-i.rects.popper[c],g=s[l]-i.rects.reference[l],I=pT(a),v=I?l==="y"?I.clientHeight||0:I.clientWidth||0:0,w=h/2-g/2,y=d[f],b=v-p[c]-d[m],S=v/2-p[c]/2+w,U=tb(y,S,b),T=l;i.modifiersData[r]=(e={},e[T]=U,e.centerOffset=U-S,e)}}function zYe(t){var e=t.state,i=t.options,r=i.element,n=r===void 0?"[data-popper-arrow]":r;n!=null&&(typeof n=="string"&&(n=e.elements.popper.querySelector(n),!n)||Ope(e.elements.popper,n)&&(e.elements.arrow=n))}const qYe={name:"arrow",enabled:!0,phase:"main",fn:WYe,effect:zYe,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function jI(t){return t.split("-")[1]}var YYe={top:"auto",right:"auto",bottom:"auto",left:"auto"};function KYe(t,e){var i=t.x,r=t.y,n=e.devicePixelRatio||1;return{x:BI(i*n)/n||0,y:BI(r*n)/n||0}}function T3(t){var e,i=t.popper,r=t.popperRect,n=t.placement,a=t.variation,s=t.offsets,o=t.position,l=t.gpuAcceleration,u=t.adaptive,c=t.roundOffsets,d=t.isFixed,p=s.x,f=p===void 0?0:p,m=s.y,h=m===void 0?0:m,g=typeof c=="function"?c({x:f,y:h}):{x:f,y:h};f=g.x,h=g.y;var I=s.hasOwnProperty("x"),v=s.hasOwnProperty("y"),w=zs,y=Ws,b=window;if(u){var S=pT(i),U="clientHeight",T="clientWidth";if(S===Ao(i)&&(S=Cf(i),Nd(S).position!=="static"&&o==="absolute"&&(U="scrollHeight",T="scrollWidth")),S=S,n===Ws||(n===zs||n===yl)&&a===mw){y=vl;var P=d&&S===b&&b.visualViewport?b.visualViewport.height:S[U];h-=P-r.height,h*=l?1:-1}if(n===zs||(n===Ws||n===vl)&&a===mw){w=yl;var D=d&&S===b&&b.visualViewport?b.visualViewport.width:S[T];f-=D-r.width,f*=l?1:-1}}var E=Object.assign({position:o},u&&YYe),R=c===!0?KYe({x:f,y:h},Ao(i)):{x:f,y:h};if(f=R.x,h=R.y,l){var C;return Object.assign({},E,(C={},C[y]=v?"0":"",C[w]=I?"0":"",C.transform=(b.devicePixelRatio||1)<=1?"translate("+f+"px, "+h+"px)":"translate3d("+f+"px, "+h+"px, 0)",C))}return Object.assign({},E,(e={},e[y]=v?h+"px":"",e[w]=I?f+"px":"",e.transform="",e))}function XYe(t){var e=t.state,i=t.options,r=i.gpuAcceleration,n=r===void 0?!0:r,a=i.adaptive,s=a===void 0?!0:a,o=i.roundOffsets,l=o===void 0?!0:o,u={placement:ic(e.placement),variation:jI(e.placement),popper:e.elements.popper,popperRect:e.rects.popper,gpuAcceleration:n,isFixed:e.options.strategy==="fixed"};e.modifiersData.popperOffsets!=null&&(e.styles.popper=Object.assign({},e.styles.popper,T3(Object.assign({},u,{offsets:e.modifiersData.popperOffsets,position:e.options.strategy,adaptive:s,roundOffsets:l})))),e.modifiersData.arrow!=null&&(e.styles.arrow=Object.assign({},e.styles.arrow,T3(Object.assign({},u,{offsets:e.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:l})))),e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-placement":e.placement})}const JYe={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:XYe,data:{}};var OT={passive:!0};function QYe(t){var e=t.state,i=t.instance,r=t.options,n=r.scroll,a=n===void 0?!0:n,s=r.resize,o=s===void 0?!0:s,l=Ao(e.elements.popper),u=[].concat(e.scrollParents.reference,e.scrollParents.popper);return a&&u.forEach(function(c){c.addEventListener("scroll",i.update,OT)}),o&&l.addEventListener("resize",i.update,OT),function(){a&&u.forEach(function(c){c.removeEventListener("scroll",i.update,OT)}),o&&l.removeEventListener("resize",i.update,OT)}}const ZYe={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:QYe,data:{}};var e6e={left:"right",right:"left",bottom:"top",top:"bottom"};function DD(t){return t.replace(/left|right|bottom|top/g,function(e){return e6e[e]})}var t6e={start:"end",end:"start"};function D3(t){return t.replace(/start|end/g,function(e){return t6e[e]})}function eH(t){var e=Ao(t),i=e.pageXOffset,r=e.pageYOffset;return{scrollLeft:i,scrollTop:r}}function tH(t){return VI(Cf(t)).left+eH(t).scrollLeft}function i6e(t,e){var i=Ao(t),r=Cf(t),n=i.visualViewport,a=r.clientWidth,s=r.clientHeight,o=0,l=0;if(n){a=n.width,s=n.height;var u=kpe();(u||!u&&e==="fixed")&&(o=n.offsetLeft,l=n.offsetTop)}return{width:a,height:s,x:o+tH(t),y:l}}function r6e(t){var e,i=Cf(t),r=eH(t),n=(e=t.ownerDocument)==null?void 0:e.body,a=Sm(i.scrollWidth,i.clientWidth,n?n.scrollWidth:0,n?n.clientWidth:0),s=Sm(i.scrollHeight,i.clientHeight,n?n.scrollHeight:0,n?n.clientHeight:0),o=-r.scrollLeft+tH(t),l=-r.scrollTop;return Nd(n||i).direction==="rtl"&&(o+=Sm(i.clientWidth,n?n.clientWidth:0)-a),{width:a,height:s,x:o,y:l}}function iH(t){var e=Nd(t),i=e.overflow,r=e.overflowX,n=e.overflowY;return/auto|scroll|overlay|hidden/.test(i+n+r)}function _pe(t){return["html","body","#document"].indexOf(Mc(t))>=0?t.ownerDocument.body:Zo(t)&&iH(t)?t:_pe(gA(t))}function ib(t,e){var i;e===void 0&&(e=[]);var r=_pe(t),n=r===((i=t.ownerDocument)==null?void 0:i.body),a=Ao(r),s=n?[a].concat(a.visualViewport||[],iH(r)?r:[]):r,o=e.concat(s);return n?o:o.concat(ib(gA(s)))}function a1(t){return Object.assign({},t,{left:t.x,top:t.y,right:t.x+t.width,bottom:t.y+t.height})}function n6e(t,e){var i=VI(t,!1,e==="fixed");return i.top=i.top+t.clientTop,i.left=i.left+t.clientLeft,i.bottom=i.top+t.clientHeight,i.right=i.left+t.clientWidth,i.width=t.clientWidth,i.height=t.clientHeight,i.x=i.left,i.y=i.top,i}function P3(t,e,i){return e===Mpe?a1(i6e(t,i)):Jm(e)?n6e(e,i):a1(r6e(Cf(t)))}function a6e(t){var e=ib(gA(t)),i=["absolute","fixed"].indexOf(Nd(t).position)>=0,r=i&&Zo(t)?pT(t):t;return Jm(r)?e.filter(function(n){return Jm(n)&&Ope(n,r)&&Mc(n)!=="body"}):[]}function s6e(t,e,i,r){var n=e==="clippingParents"?a6e(t):[].concat(e),a=[].concat(n,[i]),s=a[0],o=a.reduce(function(l,u){var c=P3(t,u,r);return l.top=Sm(c.top,l.top),l.right=IE(c.right,l.right),l.bottom=IE(c.bottom,l.bottom),l.left=Sm(c.left,l.left),l},P3(t,s,r));return o.width=o.right-o.left,o.height=o.bottom-o.top,o.x=o.left,o.y=o.top,o}function $pe(t){var e=t.reference,i=t.element,r=t.placement,n=r?ic(r):null,a=r?jI(r):null,s=e.x+e.width/2-i.width/2,o=e.y+e.height/2-i.height/2,l;switch(n){case Ws:l={x:s,y:e.y-i.height};break;case vl:l={x:s,y:e.y+e.height};break;case yl:l={x:e.x+e.width,y:o};break;case zs:l={x:e.x-i.width,y:o};break;default:l={x:e.x,y:e.y}}var u=n?ZG(n):null;if(u!=null){var c=u==="y"?"height":"width";switch(a){case $I:l[u]=l[u]-(e[c]/2-i[c]/2);break;case mw:l[u]=l[u]+(e[c]/2-i[c]/2);break}}return l}function hw(t,e){e===void 0&&(e={});var i=e,r=i.placement,n=r===void 0?t.placement:r,a=i.strategy,s=a===void 0?t.strategy:a,o=i.boundary,l=o===void 0?EYe:o,u=i.rootBoundary,c=u===void 0?Mpe:u,d=i.elementContext,p=d===void 0?Iy:d,f=i.altBoundary,m=f===void 0?!1:f,h=i.padding,g=h===void 0?0:h,I=Fpe(typeof g!="number"?g:Lpe(g,dT)),v=p===Iy?RYe:Iy,w=t.rects.popper,y=t.elements[m?v:p],b=s6e(Jm(y)?y:y.contextElement||Cf(t.elements.popper),l,c,s),S=VI(t.elements.reference),U=$pe({reference:S,element:w,placement:n}),T=a1(Object.assign({},w,U)),P=p===Iy?T:S,D={top:b.top-P.top+I.top,bottom:P.bottom-b.bottom+I.bottom,left:b.left-P.left+I.left,right:P.right-b.right+I.right},E=t.modifiersData.offset;if(p===Iy&&E){var R=E[n];Object.keys(D).forEach(function(C){var M=[yl,vl].indexOf(C)>=0?1:-1,N=[Ws,vl].indexOf(C)>=0?"y":"x";D[C]+=R[N]*M})}return D}function o6e(t,e){e===void 0&&(e={});var i=e,r=i.placement,n=i.boundary,a=i.rootBoundary,s=i.padding,o=i.flipVariations,l=i.allowedAutoPlacements,u=l===void 0?Npe:l,c=jI(r),d=c?o?S3:S3.filter(function(m){return jI(m)===c}):dT,p=d.filter(function(m){return u.indexOf(m)>=0});p.length===0&&(p=d);var f=p.reduce(function(m,h){return m[h]=hw(t,{placement:h,boundary:n,rootBoundary:a,padding:s})[ic(h)],m},{});return Object.keys(f).sort(function(m,h){return f[m]-f[h]})}function l6e(t){if(ic(t)===XG)return[];var e=DD(t);return[D3(t),e,D3(e)]}function u6e(t){var e=t.state,i=t.options,r=t.name;if(!e.modifiersData[r]._skip){for(var n=i.mainAxis,a=n===void 0?!0:n,s=i.altAxis,o=s===void 0?!0:s,l=i.fallbackPlacements,u=i.padding,c=i.boundary,d=i.rootBoundary,p=i.altBoundary,f=i.flipVariations,m=f===void 0?!0:f,h=i.allowedAutoPlacements,g=e.options.placement,I=ic(g),v=I===g,w=l||(v||!m?[DD(g)]:l6e(g)),y=[g].concat(w).reduce(function(_,B){return _.concat(ic(B)===XG?o6e(e,{placement:B,boundary:c,rootBoundary:d,padding:u,flipVariations:m,allowedAutoPlacements:h}):B)},[]),b=e.rects.reference,S=e.rects.popper,U=new Map,T=!0,P=y[0],D=0;D<y.length;D++){var E=y[D],R=ic(E),C=jI(E)===$I,M=[Ws,vl].indexOf(R)>=0,N=M?"width":"height",A=hw(e,{placement:E,boundary:c,rootBoundary:d,altBoundary:p,padding:u}),O=M?C?yl:zs:C?vl:Ws;b[N]>S[N]&&(O=DD(O));var k=DD(O),F=[];if(a&&F.push(A[R]<=0),o&&F.push(A[O]<=0,A[k]<=0),F.every(function(_){return _})){P=E,T=!1;break}U.set(E,F)}if(T)for(var x=m?3:1,L=function(_){var B=y.find(function(G){var j=U.get(G);if(j)return j.slice(0,_).every(function(K){return K})});if(B)return P=B,"break"},$=x;$>0;$--){var V=L($);if(V==="break")break}e.placement!==P&&(e.modifiersData[r]._skip=!0,e.placement=P,e.reset=!0)}}const c6e={name:"flip",enabled:!0,phase:"main",fn:u6e,requiresIfExists:["offset"],data:{_skip:!1}};function E3(t,e,i){return i===void 0&&(i={x:0,y:0}),{top:t.top-e.height-i.y,right:t.right-e.width+i.x,bottom:t.bottom-e.height+i.y,left:t.left-e.width-i.x}}function R3(t){return[Ws,yl,vl,zs].some(function(e){return t[e]>=0})}function d6e(t){var e=t.state,i=t.name,r=e.rects.reference,n=e.rects.popper,a=e.modifiersData.preventOverflow,s=hw(e,{elementContext:"reference"}),o=hw(e,{altBoundary:!0}),l=E3(s,r),u=E3(o,n,a),c=R3(l),d=R3(u);e.modifiersData[i]={referenceClippingOffsets:l,popperEscapeOffsets:u,isReferenceHidden:c,hasPopperEscaped:d},e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-reference-hidden":c,"data-popper-escaped":d})}const p6e={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:d6e};function f6e(t,e,i){var r=ic(t),n=[zs,Ws].indexOf(r)>=0?-1:1,a=typeof i=="function"?i(Object.assign({},e,{placement:t})):i,s=a[0],o=a[1];return s=s||0,o=(o||0)*n,[zs,yl].indexOf(r)>=0?{x:o,y:s}:{x:s,y:o}}function m6e(t){var e=t.state,i=t.options,r=t.name,n=i.offset,a=n===void 0?[0,0]:n,s=Npe.reduce(function(c,d){return c[d]=f6e(d,e.rects,a),c},{}),o=s[e.placement],l=o.x,u=o.y;e.modifiersData.popperOffsets!=null&&(e.modifiersData.popperOffsets.x+=l,e.modifiersData.popperOffsets.y+=u),e.modifiersData[r]=s}const h6e={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:m6e};function g6e(t){var e=t.state,i=t.name;e.modifiersData[i]=$pe({reference:e.rects.reference,element:e.rects.popper,placement:e.placement})}const I6e={name:"popperOffsets",enabled:!0,phase:"read",fn:g6e,data:{}};function v6e(t){return t==="x"?"y":"x"}function y6e(t){var e=t.state,i=t.options,r=t.name,n=i.mainAxis,a=n===void 0?!0:n,s=i.altAxis,o=s===void 0?!1:s,l=i.boundary,u=i.rootBoundary,c=i.altBoundary,d=i.padding,p=i.tether,f=p===void 0?!0:p,m=i.tetherOffset,h=m===void 0?0:m,g=hw(e,{boundary:l,rootBoundary:u,padding:d,altBoundary:c}),I=ic(e.placement),v=jI(e.placement),w=!v,y=ZG(I),b=v6e(y),S=e.modifiersData.popperOffsets,U=e.rects.reference,T=e.rects.popper,P=typeof h=="function"?h(Object.assign({},e.rects,{placement:e.placement})):h,D=typeof P=="number"?{mainAxis:P,altAxis:P}:Object.assign({mainAxis:0,altAxis:0},P),E=e.modifiersData.offset?e.modifiersData.offset[e.placement]:null,R={x:0,y:0};if(S){if(a){var C,M=y==="y"?Ws:zs,N=y==="y"?vl:yl,A=y==="y"?"height":"width",O=S[y],k=O+g[M],F=O-g[N],x=f?-T[A]/2:0,L=v===$I?U[A]:T[A],$=v===$I?-T[A]:-U[A],V=e.elements.arrow,_=f&&V?QG(V):{width:0,height:0},B=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:xpe(),G=B[M],j=B[N],K=tb(0,U[A],_[A]),Y=w?U[A]/2-x-K-G-D.mainAxis:L-K-G-D.mainAxis,X=w?-U[A]/2+x+K+j+D.mainAxis:$+K+j+D.mainAxis,Z=e.elements.arrow&&pT(e.elements.arrow),J=Z?y==="y"?Z.clientTop||0:Z.clientLeft||0:0,ae=(C=E?.[y])!=null?C:0,te=O+Y-ae-J,ne=O+X-ae,le=tb(f?IE(k,te):k,O,f?Sm(F,ne):F);S[y]=le,R[y]=le-O}if(o){var de,pe=y==="x"?Ws:zs,ge=y==="x"?vl:yl,Me=S[b],Pe=b==="y"?"height":"width",Be=Me+g[pe],fe=Me-g[ge],Te=[Ws,zs].indexOf(I)!==-1,ce=(de=E?.[b])!=null?de:0,ye=Te?Be:Me-U[Pe]-T[Pe]-ce+D.altAxis,be=Te?Me+U[Pe]+T[Pe]-ce-D.altAxis:fe,Fe=f&&Te?GYe(ye,Me,be):tb(f?ye:Be,Me,f?be:fe);S[b]=Fe,R[b]=Fe-Me}e.modifiersData[r]=R}}const b6e={name:"preventOverflow",enabled:!0,phase:"main",fn:y6e,requiresIfExists:["offset"]};function w6e(t){return{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}}function S6e(t){return t===Ao(t)||!Zo(t)?eH(t):w6e(t)}function U6e(t){var e=t.getBoundingClientRect(),i=BI(e.width)/t.offsetWidth||1,r=BI(e.height)/t.offsetHeight||1;return i!==1||r!==1}function T6e(t,e,i){i===void 0&&(i=!1);var r=Zo(e),n=Zo(e)&&U6e(e),a=Cf(e),s=VI(t,n,i),o={scrollLeft:0,scrollTop:0},l={x:0,y:0};return(r||!r&&!i)&&((Mc(e)!=="body"||iH(a))&&(o=S6e(e)),Zo(e)?(l=VI(e,!0),l.x+=e.clientLeft,l.y+=e.clientTop):a&&(l.x=tH(a))),{x:s.left+o.scrollLeft-l.x,y:s.top+o.scrollTop-l.y,width:s.width,height:s.height}}function D6e(t){var e=new Map,i=new Set,r=[];t.forEach(function(a){e.set(a.name,a)});function n(a){i.add(a.name);var s=[].concat(a.requires||[],a.requiresIfExists||[]);s.forEach(function(o){if(!i.has(o)){var l=e.get(o);l&&n(l)}}),r.push(a)}return t.forEach(function(a){i.has(a.name)||n(a)}),r}function P6e(t){var e=D6e(t);return _Ye.reduce(function(i,r){return i.concat(e.filter(function(n){return n.phase===r}))},[])}function E6e(t){var e;return function(){return e||(e=new Promise(function(i){Promise.resolve().then(function(){e=void 0,i(t())})})),e}}function R6e(t){var e=t.reduce(function(i,r){var n=i[r.name];return i[r.name]=n?Object.assign({},n,r,{options:Object.assign({},n.options,r.options),data:Object.assign({},n.data,r.data)}):r,i},{});return Object.keys(e).map(function(i){return e[i]})}var C3={placement:"bottom",modifiers:[],strategy:"absolute"};function M3(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return!e.some(function(r){return!(r&&typeof r.getBoundingClientRect=="function")})}function C6e(t){t===void 0&&(t={});var e=t,i=e.defaultModifiers,r=i===void 0?[]:i,n=e.defaultOptions,a=n===void 0?C3:n;return function(s,o,l){l===void 0&&(l=a);var u={placement:"bottom",orderedModifiers:[],options:Object.assign({},C3,a),modifiersData:{},elements:{reference:s,popper:o},attributes:{},styles:{}},c=[],d=!1,p={state:u,setOptions:function(h){var g=typeof h=="function"?h(u.options):h;m(),u.options=Object.assign({},a,u.options,g),u.scrollParents={reference:Jm(s)?ib(s):s.contextElement?ib(s.contextElement):[],popper:ib(o)};var I=P6e(R6e([].concat(r,u.options.modifiers)));return u.orderedModifiers=I.filter(function(v){return v.enabled}),f(),p.update()},forceUpdate:function(){if(!d){var h=u.elements,g=h.reference,I=h.popper;if(M3(g,I)){u.rects={reference:T6e(g,pT(I),u.options.strategy==="fixed"),popper:QG(I)},u.reset=!1,u.placement=u.options.placement,u.orderedModifiers.forEach(function(T){return u.modifiersData[T.name]=Object.assign({},T.data)});for(var v=0;v<u.orderedModifiers.length;v++){if(u.reset===!0){u.reset=!1,v=-1;continue}var w=u.orderedModifiers[v],y=w.fn,b=w.options,S=b===void 0?{}:b,U=w.name;typeof y=="function"&&(u=y({state:u,options:S,name:U,instance:p})||u)}}}},update:E6e(function(){return new Promise(function(h){p.forceUpdate(),h(u)})}),destroy:function(){m(),d=!0}};if(!M3(s,o))return p;p.setOptions(l).then(function(h){!d&&l.onFirstUpdate&&l.onFirstUpdate(h)});function f(){u.orderedModifiers.forEach(function(h){var g=h.name,I=h.options,v=I===void 0?{}:I,w=h.effect;if(typeof w=="function"){var y=w({state:u,name:g,instance:p,options:v}),b=function(){};c.push(y||b)}})}function m(){c.forEach(function(h){return h()}),c=[]}return p}}var M6e=[ZYe,I6e,JYe,Ape,h6e,c6e,b6e,qYe,p6e],N6e=C6e({defaultModifiers:M6e}),A6e="tippy-box",Bpe="tippy-content",k6e="tippy-backdrop",Vpe="tippy-arrow",jpe="tippy-svg-arrow",Vf={passive:!0,capture:!0},Gpe=function(){return document.body};function Pk(t,e,i){if(Array.isArray(t)){var r=t[e];return r??(Array.isArray(i)?i[e]:i)}return t}function rH(t,e){var i={}.toString.call(t);return i.indexOf("[object")===0&&i.indexOf(e+"]")>-1}function Hpe(t,e){return typeof t=="function"?t.apply(void 0,e):t}function N3(t,e){if(e===0)return t;var i;return function(r){clearTimeout(i),i=setTimeout(function(){t(r)},e)}}function O6e(t){return t.split(/\s+/).filter(Boolean)}function Sg(t){return[].concat(t)}function A3(t,e){t.indexOf(e)===-1&&t.push(e)}function x6e(t){return t.filter(function(e,i){return t.indexOf(e)===i})}function F6e(t){return t.split("-")[0]}function vE(t){return[].slice.call(t)}function k3(t){return Object.keys(t).reduce(function(e,i){return t[i]!==void 0&&(e[i]=t[i]),e},{})}function rb(){return document.createElement("div")}function IA(t){return["Element","Fragment"].some(function(e){return rH(t,e)})}function L6e(t){return rH(t,"NodeList")}function _6e(t){return rH(t,"MouseEvent")}function $6e(t){return!!(t&&t._tippy&&t._tippy.reference===t)}function B6e(t){return IA(t)?[t]:L6e(t)?vE(t):Array.isArray(t)?t:vE(document.querySelectorAll(t))}function Ek(t,e){t.forEach(function(i){i&&(i.style.transitionDuration=e+"ms")})}function O3(t,e){t.forEach(function(i){i&&i.setAttribute("data-state",e)})}function V6e(t){var e,i=Sg(t),r=i[0];return r!=null&&(e=r.ownerDocument)!=null&&e.body?r.ownerDocument:document}function j6e(t,e){var i=e.clientX,r=e.clientY;return t.every(function(n){var a=n.popperRect,s=n.popperState,o=n.props,l=o.interactiveBorder,u=F6e(s.placement),c=s.modifiersData.offset;if(!c)return!0;var d=u==="bottom"?c.top.y:0,p=u==="top"?c.bottom.y:0,f=u==="right"?c.left.x:0,m=u==="left"?c.right.x:0,h=a.top-r+d>l,g=r-a.bottom-p>l,I=a.left-i+f>l,v=i-a.right-m>l;return h||g||I||v})}function Rk(t,e,i){var r=e+"EventListener";["transitionend","webkitTransitionEnd"].forEach(function(n){t[r](n,i)})}function x3(t,e){for(var i=e;i;){var r;if(t.contains(i))return!0;i=i.getRootNode==null||(r=i.getRootNode())==null?void 0:r.host}return!1}var $u={isTouch:!1},F3=0;function G6e(){$u.isTouch||($u.isTouch=!0,window.performance&&document.addEventListener("mousemove",Wpe))}function Wpe(){var t=performance.now();t-F3<20&&($u.isTouch=!1,document.removeEventListener("mousemove",Wpe)),F3=t}function H6e(){var t=document.activeElement;if($6e(t)){var e=t._tippy;t.blur&&!e.state.isVisible&&t.blur()}}function W6e(){document.addEventListener("touchstart",G6e,Vf),window.addEventListener("blur",H6e)}var z6e=typeof window<"u"&&typeof document<"u",q6e=z6e?!!window.msCrypto:!1,Y6e={animateFill:!1,followCursor:!1,inlinePositioning:!1,sticky:!1},K6e={allowHTML:!1,animation:"fade",arrow:!0,content:"",inertia:!1,maxWidth:350,role:"tooltip",theme:"",zIndex:9999},$l=Object.assign({appendTo:Gpe,aria:{content:"auto",expanded:"auto"},delay:0,duration:[300,250],getReferenceClientRect:null,hideOnClick:!0,ignoreAttributes:!1,interactive:!1,interactiveBorder:2,interactiveDebounce:0,moveTransition:"",offset:[0,10],onAfterUpdate:function(){},onBeforeUpdate:function(){},onCreate:function(){},onDestroy:function(){},onHidden:function(){},onHide:function(){},onMount:function(){},onShow:function(){},onShown:function(){},onTrigger:function(){},onUntrigger:function(){},onClickOutside:function(){},placement:"top",plugins:[],popperOptions:{},render:null,showOnCreate:!1,touch:!0,trigger:"mouseenter focus",triggerTarget:null},Y6e,K6e),X6e=Object.keys($l),J6e=function(t){var e=Object.keys(t);e.forEach(function(i){$l[i]=t[i]})};function zpe(t){var e=t.plugins||[],i=e.reduce(function(r,n){var a=n.name,s=n.defaultValue;if(a){var o;r[a]=t[a]!==void 0?t[a]:(o=$l[a])!=null?o:s}return r},{});return Object.assign({},t,i)}function Q6e(t,e){var i=e?Object.keys(zpe(Object.assign({},$l,{plugins:e}))):X6e,r=i.reduce(function(n,a){var s=(t.getAttribute("data-tippy-"+a)||"").trim();if(!s)return n;if(a==="content")n[a]=s;else try{n[a]=JSON.parse(s)}catch{n[a]=s}return n},{});return r}function L3(t,e){var i=Object.assign({},e,{content:Hpe(e.content,[t])},e.ignoreAttributes?{}:Q6e(t,e.plugins));return i.aria=Object.assign({},$l.aria,i.aria),i.aria={expanded:i.aria.expanded==="auto"?e.interactive:i.aria.expanded,content:i.aria.content==="auto"?e.interactive?null:"describedby":i.aria.content},i}var Z6e=function(){return"innerHTML"};function s1(t,e){t[Z6e()]=e}function _3(t){var e=rb();return t===!0?e.className=Vpe:(e.className=jpe,IA(t)?e.appendChild(t):s1(e,t)),e}function $3(t,e){IA(e.content)?(s1(t,""),t.appendChild(e.content)):typeof e.content!="function"&&(e.allowHTML?s1(t,e.content):t.textContent=e.content)}function o1(t){var e=t.firstElementChild,i=vE(e.children);return{box:e,content:i.find(function(r){return r.classList.contains(Bpe)}),arrow:i.find(function(r){return r.classList.contains(Vpe)||r.classList.contains(jpe)}),backdrop:i.find(function(r){return r.classList.contains(k6e)})}}function qpe(t){var e=rb(),i=rb();i.className=A6e,i.setAttribute("data-state","hidden"),i.setAttribute("tabindex","-1");var r=rb();r.className=Bpe,r.setAttribute("data-state","hidden"),$3(r,t.props),e.appendChild(i),i.appendChild(r),n(t.props,t.props);function n(a,s){var o=o1(e),l=o.box,u=o.content,c=o.arrow;s.theme?l.setAttribute("data-theme",s.theme):l.removeAttribute("data-theme"),typeof s.animation=="string"?l.setAttribute("data-animation",s.animation):l.removeAttribute("data-animation"),s.inertia?l.setAttribute("data-inertia",""):l.removeAttribute("data-inertia"),l.style.maxWidth=typeof s.maxWidth=="number"?s.maxWidth+"px":s.maxWidth,s.role?l.setAttribute("role",s.role):l.removeAttribute("role"),(a.content!==s.content||a.allowHTML!==s.allowHTML)&&$3(u,t.props),s.arrow?c?a.arrow!==s.arrow&&(l.removeChild(c),l.appendChild(_3(s.arrow))):l.appendChild(_3(s.arrow)):c&&l.removeChild(c)}return{popper:e,onUpdate:n}}qpe.$$tippy=!0;var e4e=1,xT=[],Ck=[];function t4e(t,e){var i=L3(t,Object.assign({},$l,zpe(k3(e)))),r,n,a,s=!1,o=!1,l=!1,u=!1,c,d,p,f=[],m=N3(te,i.interactiveDebounce),h,g=e4e++,I=null,v=x6e(i.plugins),w={isEnabled:!0,isVisible:!1,isDestroyed:!1,isMounted:!1,isShown:!1},y={id:g,reference:t,popper:rb(),popperInstance:I,props:i,state:w,plugins:v,clearDelayTimeouts:ye,setProps:be,setContent:Fe,show:we,hide:Ne,hideWithInteractivity:me,enable:Te,disable:ce,unmount:Ee,destroy:Le};if(!i.render)return y;var b=i.render(y),S=b.popper,U=b.onUpdate;S.setAttribute("data-tippy-root",""),S.id="tippy-"+y.id,y.popper=S,t._tippy=y,S._tippy=y;var T=v.map(function(Q){return Q.fn(y)}),P=t.hasAttribute("aria-expanded");return Z(),x(),O(),k("onCreate",[y]),i.showOnCreate&&Be(),S.addEventListener("mouseenter",function(){y.props.interactive&&y.state.isVisible&&y.clearDelayTimeouts()}),S.addEventListener("mouseleave",function(){y.props.interactive&&y.props.trigger.indexOf("mouseenter")>=0&&M().addEventListener("mousemove",m)}),y;function D(){var Q=y.props.touch;return Array.isArray(Q)?Q:[Q,0]}function E(){return D()[0]==="hold"}function R(){var Q;return!!((Q=y.props.render)!=null&&Q.$$tippy)}function C(){return h||t}function M(){var Q=C().parentNode;return Q?V6e(Q):document}function N(){return o1(S)}function A(Q){return y.state.isMounted&&!y.state.isVisible||$u.isTouch||c&&c.type==="focus"?0:Pk(y.props.delay,Q?0:1,$l.delay)}function O(Q){Q===void 0&&(Q=!1),S.style.pointerEvents=y.props.interactive&&!Q?"":"none",S.style.zIndex=""+y.props.zIndex}function k(Q,se,oe){if(oe===void 0&&(oe=!0),T.forEach(function(ee){ee[Q]&&ee[Q].apply(ee,se)}),oe){var ue;(ue=y.props)[Q].apply(ue,se)}}function F(){var Q=y.props.aria;if(Q.content){var se="aria-"+Q.content,oe=S.id,ue=Sg(y.props.triggerTarget||t);ue.forEach(function(ee){var Se=ee.getAttribute(se);if(y.state.isVisible)ee.setAttribute(se,Se?Se+" "+oe:oe);else{var De=Se&&Se.replace(oe,"").trim();De?ee.setAttribute(se,De):ee.removeAttribute(se)}})}}function x(){if(!(P||!y.props.aria.expanded)){var Q=Sg(y.props.triggerTarget||t);Q.forEach(function(se){y.props.interactive?se.setAttribute("aria-expanded",y.state.isVisible&&se===C()?"true":"false"):se.removeAttribute("aria-expanded")})}}function L(){M().removeEventListener("mousemove",m),xT=xT.filter(function(Q){return Q!==m})}function $(Q){if(!($u.isTouch&&(l||Q.type==="mousedown"))){var se=Q.composedPath&&Q.composedPath()[0]||Q.target;if(!(y.props.interactive&&x3(S,se))){if(Sg(y.props.triggerTarget||t).some(function(oe){return x3(oe,se)})){if($u.isTouch||y.state.isVisible&&y.props.trigger.indexOf("click")>=0)return}else k("onClickOutside",[y,Q]);y.props.hideOnClick===!0&&(y.clearDelayTimeouts(),y.hide(),o=!0,setTimeout(function(){o=!1}),y.state.isMounted||G())}}}function V(){l=!0}function _(){l=!1}function B(){var Q=M();Q.addEventListener("mousedown",$,!0),Q.addEventListener("touchend",$,Vf),Q.addEventListener("touchstart",_,Vf),Q.addEventListener("touchmove",V,Vf)}function G(){var Q=M();Q.removeEventListener("mousedown",$,!0),Q.removeEventListener("touchend",$,Vf),Q.removeEventListener("touchstart",_,Vf),Q.removeEventListener("touchmove",V,Vf)}function j(Q,se){Y(Q,function(){!y.state.isVisible&&S.parentNode&&S.parentNode.contains(S)&&se()})}function K(Q,se){Y(Q,se)}function Y(Q,se){var oe=N().box;function ue(ee){ee.target===oe&&(Rk(oe,"remove",ue),se())}if(Q===0)return se();Rk(oe,"remove",d),Rk(oe,"add",ue),d=ue}function X(Q,se,oe){oe===void 0&&(oe=!1);var ue=Sg(y.props.triggerTarget||t);ue.forEach(function(ee){ee.addEventListener(Q,se,oe),f.push({node:ee,eventType:Q,handler:se,options:oe})})}function Z(){E()&&(X("touchstart",ae,{passive:!0}),X("touchend",ne,{passive:!0})),O6e(y.props.trigger).forEach(function(Q){if(Q!=="manual")switch(X(Q,ae),Q){case"mouseenter":X("mouseleave",ne);break;case"focus":X(q6e?"focusout":"blur",le);break;case"focusin":X("focusout",le);break}})}function J(){f.forEach(function(Q){var se=Q.node,oe=Q.eventType,ue=Q.handler,ee=Q.options;se.removeEventListener(oe,ue,ee)}),f=[]}function ae(Q){var se,oe=!1;if(!(!y.state.isEnabled||de(Q)||o)){var ue=((se=c)==null?void 0:se.type)==="focus";c=Q,h=Q.currentTarget,x(),!y.state.isVisible&&_6e(Q)&&xT.forEach(function(ee){return ee(Q)}),Q.type==="click"&&(y.props.trigger.indexOf("mouseenter")<0||s)&&y.props.hideOnClick!==!1&&y.state.isVisible?oe=!0:Be(Q),Q.type==="click"&&(s=!oe),oe&&!ue&&fe(Q)}}function te(Q){var se=Q.target,oe=C().contains(se)||S.contains(se);if(!(Q.type==="mousemove"&&oe)){var ue=Pe().concat(S).map(function(ee){var Se,De=ee._tippy,it=(Se=De.popperInstance)==null?void 0:Se.state;return it?{popperRect:ee.getBoundingClientRect(),popperState:it,props:i}:null}).filter(Boolean);j6e(ue,Q)&&(L(),fe(Q))}}function ne(Q){var se=de(Q)||y.props.trigger.indexOf("click")>=0&&s;if(!se){if(y.props.interactive){y.hideWithInteractivity(Q);return}fe(Q)}}function le(Q){y.props.trigger.indexOf("focusin")<0&&Q.target!==C()||y.props.interactive&&Q.relatedTarget&&S.contains(Q.relatedTarget)||fe(Q)}function de(Q){return $u.isTouch?E()!==Q.type.indexOf("touch")>=0:!1}function pe(){ge();var Q=y.props,se=Q.popperOptions,oe=Q.placement,ue=Q.offset,ee=Q.getReferenceClientRect,Se=Q.moveTransition,De=R()?o1(S).arrow:null,it=ee?{getBoundingClientRect:ee,contextElement:ee.contextElement||C()}:t,Ue={name:"$$tippy",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:function(yi){var qe=yi.state;if(R()){var bi=N(),oi=bi.box;["placement","reference-hidden","escaped"].forEach(function(nn){nn==="placement"?oi.setAttribute("data-placement",qe.placement):qe.attributes.popper["data-popper-"+nn]?oi.setAttribute("data-"+nn,""):oi.removeAttribute("data-"+nn)}),qe.attributes.popper={}}}},ut=[{name:"offset",options:{offset:ue}},{name:"preventOverflow",options:{padding:{top:2,bottom:2,left:5,right:5}}},{name:"flip",options:{padding:5}},{name:"computeStyles",options:{adaptive:!Se}},Ue];R()&&De&&ut.push({name:"arrow",options:{element:De,padding:3}}),ut.push.apply(ut,se?.modifiers||[]),y.popperInstance=N6e(it,S,Object.assign({},se,{placement:oe,onFirstUpdate:p,modifiers:ut}))}function ge(){y.popperInstance&&(y.popperInstance.destroy(),y.popperInstance=null)}function Me(){var Q=y.props.appendTo,se,oe=C();y.props.interactive&&Q===Gpe||Q==="parent"?se=oe.parentNode:se=Hpe(Q,[oe]),se.contains(S)||se.appendChild(S),y.state.isMounted=!0,pe()}function Pe(){return vE(S.querySelectorAll("[data-tippy-root]"))}function Be(Q){y.clearDelayTimeouts(),Q&&k("onTrigger",[y,Q]),B();var se=A(!0),oe=D(),ue=oe[0],ee=oe[1];$u.isTouch&&ue==="hold"&&ee&&(se=ee),se?r=setTimeout(function(){y.show()},se):y.show()}function fe(Q){if(y.clearDelayTimeouts(),k("onUntrigger",[y,Q]),!y.state.isVisible){G();return}if(!(y.props.trigger.indexOf("mouseenter")>=0&&y.props.trigger.indexOf("click")>=0&&["mouseleave","mousemove"].indexOf(Q.type)>=0&&s)){var se=A(!1);se?n=setTimeout(function(){y.state.isVisible&&y.hide()},se):a=requestAnimationFrame(function(){y.hide()})}}function Te(){y.state.isEnabled=!0}function ce(){y.hide(),y.state.isEnabled=!1}function ye(){clearTimeout(r),clearTimeout(n),cancelAnimationFrame(a)}function be(Q){if(!y.state.isDestroyed){k("onBeforeUpdate",[y,Q]),J();var se=y.props,oe=L3(t,Object.assign({},se,k3(Q),{ignoreAttributes:!0}));y.props=oe,Z(),se.interactiveDebounce!==oe.interactiveDebounce&&(L(),m=N3(te,oe.interactiveDebounce)),se.triggerTarget&&!oe.triggerTarget?Sg(se.triggerTarget).forEach(function(ue){ue.removeAttribute("aria-expanded")}):oe.triggerTarget&&t.removeAttribute("aria-expanded"),x(),O(),U&&U(se,oe),y.popperInstance&&(pe(),Pe().forEach(function(ue){requestAnimationFrame(ue._tippy.popperInstance.forceUpdate)})),k("onAfterUpdate",[y,Q])}}function Fe(Q){y.setProps({content:Q})}function we(){var Q=y.state.isVisible,se=y.state.isDestroyed,oe=!y.state.isEnabled,ue=$u.isTouch&&!y.props.touch,ee=Pk(y.props.duration,0,$l.duration);if(!(Q||se||oe||ue)&&!C().hasAttribute("disabled")&&(k("onShow",[y],!1),y.props.onShow(y)!==!1)){if(y.state.isVisible=!0,R()&&(S.style.visibility="visible"),O(),B(),y.state.isMounted||(S.style.transition="none"),R()){var Se=N(),De=Se.box,it=Se.content;Ek([De,it],0)}p=function(){var Ue;if(!(!y.state.isVisible||u)){if(u=!0,S.offsetHeight,S.style.transition=y.props.moveTransition,R()&&y.props.animation){var ut=N(),yi=ut.box,qe=ut.content;Ek([yi,qe],ee),O3([yi,qe],"visible")}F(),x(),A3(Ck,y),(Ue=y.popperInstance)==null||Ue.forceUpdate(),k("onMount",[y]),y.props.animation&&R()&&K(ee,function(){y.state.isShown=!0,k("onShown",[y])})}},Me()}}function Ne(){var Q=!y.state.isVisible,se=y.state.isDestroyed,oe=!y.state.isEnabled,ue=Pk(y.props.duration,1,$l.duration);if(!(Q||se||oe)&&(k("onHide",[y],!1),y.props.onHide(y)!==!1)){if(y.state.isVisible=!1,y.state.isShown=!1,u=!1,s=!1,R()&&(S.style.visibility="hidden"),L(),G(),O(!0),R()){var ee=N(),Se=ee.box,De=ee.content;y.props.animation&&(Ek([Se,De],ue),O3([Se,De],"hidden"))}F(),x(),y.props.animation?R()&&j(ue,y.unmount):y.unmount()}}function me(Q){M().addEventListener("mousemove",m),A3(xT,m),m(Q)}function Ee(){y.state.isVisible&&y.hide(),y.state.isMounted&&(ge(),Pe().forEach(function(Q){Q._tippy.unmount()}),S.parentNode&&S.parentNode.removeChild(S),Ck=Ck.filter(function(Q){return Q!==y}),y.state.isMounted=!1,k("onHidden",[y]))}function Le(){!y.state.isDestroyed&&(y.clearDelayTimeouts(),y.unmount(),J(),delete t._tippy,y.state.isDestroyed=!0,k("onDestroy",[y]))}}function vA(t,e){e===void 0&&(e={});var i=$l.plugins.concat(e.plugins||[]);W6e();var r=Object.assign({},e,{plugins:i}),n=B6e(t),a=n.reduce(function(s,o){var l=o&&t4e(o,r);return l&&s.push(l),s},[]);return IA(t)?a[0]:a}vA.defaultProps=$l;vA.setDefaultProps=J6e;vA.currentInput=$u;Object.assign({},Ape,{effect:function(t){var e=t.state,i={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};Object.assign(e.elements.popper.style,i.popper),e.styles=i,e.elements.arrow&&Object.assign(e.elements.arrow.style,i.arrow)}});vA.setDefaultProps({render:qpe});function PD(t,e){return t==null||e==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function i4e(t,e){return t==null||e==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function Ype(t){let e,i,r;t.length!==2?(e=PD,i=(o,l)=>PD(t(o),l),r=(o,l)=>t(o)-l):(e=t===PD||t===i4e?t:r4e,i=t,r=t);function n(o,l,u=0,c=o.length){if(u<c){if(e(l,l)!==0)return c;do{const d=u+c>>>1;i(o[d],l)<0?u=d+1:c=d}while(u<c)}return u}function a(o,l,u=0,c=o.length){if(u<c){if(e(l,l)!==0)return c;do{const d=u+c>>>1;i(o[d],l)<=0?u=d+1:c=d}while(u<c)}return u}function s(o,l,u=0,c=o.length){const d=n(o,l,u,c-1);return d>u&&r(o[d-1],l)>-r(o[d],l)?d-1:d}return{left:n,center:s,right:a}}function r4e(){return 0}function n4e(t){return t===null?NaN:+t}Ype(PD);Ype(n4e).center;var a4e={value:()=>{}};function Kpe(){for(var t=0,e=arguments.length,i={},r;t<e;++t){if(!(r=arguments[t]+"")||r in i||/[\s.]/.test(r))throw new Error("illegal type: "+r);i[r]=[]}return new ED(i)}function ED(t){this._=t}function s4e(t,e){return t.trim().split(/^|\s+/).map(function(i){var r="",n=i.indexOf(".");if(n>=0&&(r=i.slice(n+1),i=i.slice(0,n)),i&&!e.hasOwnProperty(i))throw new Error("unknown type: "+i);return{type:i,name:r}})}ED.prototype=Kpe.prototype={constructor:ED,on:function(t,e){var i=this._,r=s4e(t+"",i),n,a=-1,s=r.length;if(arguments.length<2){for(;++a<s;)if((n=(t=r[a]).type)&&(n=o4e(i[n],t.name)))return n;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++a<s;)if(n=(t=r[a]).type)i[n]=B3(i[n],t.name,e);else if(e==null)for(n in i)i[n]=B3(i[n],t.name,null);return this},copy:function(){var t={},e=this._;for(var i in e)t[i]=e[i].slice();return new ED(t)},call:function(t,e){if((n=arguments.length-2)>0)for(var i=new Array(n),r=0,n,a;r<n;++r)i[r]=arguments[r+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(a=this._[t],r=0,n=a.length;r<n;++r)a[r].value.apply(e,i)},apply:function(t,e,i){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var r=this._[t],n=0,a=r.length;n<a;++n)r[n].value.apply(e,i)}};function o4e(t,e){for(var i=0,r=t.length,n;i<r;++i)if((n=t[i]).name===e)return n.value}function B3(t,e,i){for(var r=0,n=t.length;r<n;++r)if(t[r].name===e){t[r]=a4e,t=t.slice(0,r).concat(t.slice(r+1));break}return i!=null&&t.push({name:e,value:i}),t}var l1="http://www.w3.org/1999/xhtml";const V3={svg:"http://www.w3.org/2000/svg",xhtml:l1,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function yA(t){var e=t+="",i=e.indexOf(":");return i>=0&&(e=t.slice(0,i))!=="xmlns"&&(t=t.slice(i+1)),V3.hasOwnProperty(e)?{space:V3[e],local:t}:t}function l4e(t){return function(){var e=this.ownerDocument,i=this.namespaceURI;return i===l1&&e.documentElement.namespaceURI===l1?e.createElement(t):e.createElementNS(i,t)}}function u4e(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function Xpe(t){var e=yA(t);return(e.local?u4e:l4e)(e)}function c4e(){}function nH(t){return t==null?c4e:function(){return this.querySelector(t)}}function d4e(t){typeof t!="function"&&(t=nH(t));for(var e=this._groups,i=e.length,r=new Array(i),n=0;n<i;++n)for(var a=e[n],s=a.length,o=r[n]=new Array(s),l,u,c=0;c<s;++c)(l=a[c])&&(u=t.call(l,l.__data__,c,a))&&("__data__"in l&&(u.__data__=l.__data__),o[c]=u);return new Uu(r,this._parents)}function p4e(t){return t==null?[]:Array.isArray(t)?t:Array.from(t)}function f4e(){return[]}function Jpe(t){return t==null?f4e:function(){return this.querySelectorAll(t)}}function m4e(t){return function(){return p4e(t.apply(this,arguments))}}function h4e(t){typeof t=="function"?t=m4e(t):t=Jpe(t);for(var e=this._groups,i=e.length,r=[],n=[],a=0;a<i;++a)for(var s=e[a],o=s.length,l,u=0;u<o;++u)(l=s[u])&&(r.push(t.call(l,l.__data__,u,s)),n.push(l));return new Uu(r,n)}function Qpe(t){return function(){return this.matches(t)}}function Zpe(t){return function(e){return e.matches(t)}}var g4e=Array.prototype.find;function I4e(t){return function(){return g4e.call(this.children,t)}}function v4e(){return this.firstElementChild}function y4e(t){return this.select(t==null?v4e:I4e(typeof t=="function"?t:Zpe(t)))}var b4e=Array.prototype.filter;function w4e(){return Array.from(this.children)}function S4e(t){return function(){return b4e.call(this.children,t)}}function U4e(t){return this.selectAll(t==null?w4e:S4e(typeof t=="function"?t:Zpe(t)))}function T4e(t){typeof t!="function"&&(t=Qpe(t));for(var e=this._groups,i=e.length,r=new Array(i),n=0;n<i;++n)for(var a=e[n],s=a.length,o=r[n]=[],l,u=0;u<s;++u)(l=a[u])&&t.call(l,l.__data__,u,a)&&o.push(l);return new Uu(r,this._parents)}function efe(t){return new Array(t.length)}function D4e(){return new Uu(this._enter||this._groups.map(efe),this._parents)}function yE(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}yE.prototype={constructor:yE,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};function P4e(t){return function(){return t}}function E4e(t,e,i,r,n,a){for(var s=0,o,l=e.length,u=a.length;s<u;++s)(o=e[s])?(o.__data__=a[s],r[s]=o):i[s]=new yE(t,a[s]);for(;s<l;++s)(o=e[s])&&(n[s]=o)}function R4e(t,e,i,r,n,a,s){var o,l,u=new Map,c=e.length,d=a.length,p=new Array(c),f;for(o=0;o<c;++o)(l=e[o])&&(p[o]=f=s.call(l,l.__data__,o,e)+"",u.has(f)?n[o]=l:u.set(f,l));for(o=0;o<d;++o)f=s.call(t,a[o],o,a)+"",(l=u.get(f))?(r[o]=l,l.__data__=a[o],u.delete(f)):i[o]=new yE(t,a[o]);for(o=0;o<c;++o)(l=e[o])&&u.get(p[o])===l&&(n[o]=l)}function C4e(t){return t.__data__}function M4e(t,e){if(!arguments.length)return Array.from(this,C4e);var i=e?R4e:E4e,r=this._parents,n=this._groups;typeof t!="function"&&(t=P4e(t));for(var a=n.length,s=new Array(a),o=new Array(a),l=new Array(a),u=0;u<a;++u){var c=r[u],d=n[u],p=d.length,f=N4e(t.call(c,c&&c.__data__,u,r)),m=f.length,h=o[u]=new Array(m),g=s[u]=new Array(m),I=l[u]=new Array(p);i(c,d,h,g,I,f,e);for(var v=0,w=0,y,b;v<m;++v)if(y=h[v]){for(v>=w&&(w=v+1);!(b=g[w])&&++w<m;);y._next=b||null}}return s=new Uu(s,r),s._enter=o,s._exit=l,s}function N4e(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function A4e(){return new Uu(this._exit||this._groups.map(efe),this._parents)}function k4e(t,e,i){var r=this.enter(),n=this,a=this.exit();return typeof t=="function"?(r=t(r),r&&(r=r.selection())):r=r.append(t+""),e!=null&&(n=e(n),n&&(n=n.selection())),i==null?a.remove():i(a),r&&n?r.merge(n).order():n}function O4e(t){for(var e=t.selection?t.selection():t,i=this._groups,r=e._groups,n=i.length,a=r.length,s=Math.min(n,a),o=new Array(n),l=0;l<s;++l)for(var u=i[l],c=r[l],d=u.length,p=o[l]=new Array(d),f,m=0;m<d;++m)(f=u[m]||c[m])&&(p[m]=f);for(;l<n;++l)o[l]=i[l];return new Uu(o,this._parents)}function x4e(){for(var t=this._groups,e=-1,i=t.length;++e<i;)for(var r=t[e],n=r.length-1,a=r[n],s;--n>=0;)(s=r[n])&&(a&&s.compareDocumentPosition(a)^4&&a.parentNode.insertBefore(s,a),a=s);return this}function F4e(t){t||(t=L4e);function e(d,p){return d&&p?t(d.__data__,p.__data__):!d-!p}for(var i=this._groups,r=i.length,n=new Array(r),a=0;a<r;++a){for(var s=i[a],o=s.length,l=n[a]=new Array(o),u,c=0;c<o;++c)(u=s[c])&&(l[c]=u);l.sort(e)}return new Uu(n,this._parents).order()}function L4e(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function _4e(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this}function $4e(){return Array.from(this)}function B4e(){for(var t=this._groups,e=0,i=t.length;e<i;++e)for(var r=t[e],n=0,a=r.length;n<a;++n){var s=r[n];if(s)return s}return null}function V4e(){let t=0;for(const e of this)++t;return t}function j4e(){return!this.node()}function G4e(t){for(var e=this._groups,i=0,r=e.length;i<r;++i)for(var n=e[i],a=0,s=n.length,o;a<s;++a)(o=n[a])&&t.call(o,o.__data__,a,n);return this}function H4e(t){return function(){this.removeAttribute(t)}}function W4e(t){return function(){this.removeAttributeNS(t.space,t.local)}}function z4e(t,e){return function(){this.setAttribute(t,e)}}function q4e(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function Y4e(t,e){return function(){var i=e.apply(this,arguments);i==null?this.removeAttribute(t):this.setAttribute(t,i)}}function K4e(t,e){return function(){var i=e.apply(this,arguments);i==null?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,i)}}function X4e(t,e){var i=yA(t);if(arguments.length<2){var r=this.node();return i.local?r.getAttributeNS(i.space,i.local):r.getAttribute(i)}return this.each((e==null?i.local?W4e:H4e:typeof e=="function"?i.local?K4e:Y4e:i.local?q4e:z4e)(i,e))}function tfe(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function J4e(t){return function(){this.style.removeProperty(t)}}function Q4e(t,e,i){return function(){this.style.setProperty(t,e,i)}}function Z4e(t,e,i){return function(){var r=e.apply(this,arguments);r==null?this.style.removeProperty(t):this.style.setProperty(t,r,i)}}function e5e(t,e,i){return arguments.length>1?this.each((e==null?J4e:typeof e=="function"?Z4e:Q4e)(t,e,i??"")):GI(this.node(),t)}function GI(t,e){return t.style.getPropertyValue(e)||tfe(t).getComputedStyle(t,null).getPropertyValue(e)}function t5e(t){return function(){delete this[t]}}function i5e(t,e){return function(){this[t]=e}}function r5e(t,e){return function(){var i=e.apply(this,arguments);i==null?delete this[t]:this[t]=i}}function n5e(t,e){return arguments.length>1?this.each((e==null?t5e:typeof e=="function"?r5e:i5e)(t,e)):this.node()[t]}function ife(t){return t.trim().split(/^|\s+/)}function aH(t){return t.classList||new rfe(t)}function rfe(t){this._node=t,this._names=ife(t.getAttribute("class")||"")}rfe.prototype={add:function(t){var e=this._names.indexOf(t);e<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};function nfe(t,e){for(var i=aH(t),r=-1,n=e.length;++r<n;)i.add(e[r])}function afe(t,e){for(var i=aH(t),r=-1,n=e.length;++r<n;)i.remove(e[r])}function a5e(t){return function(){nfe(this,t)}}function s5e(t){return function(){afe(this,t)}}function o5e(t,e){return function(){(e.apply(this,arguments)?nfe:afe)(this,t)}}function l5e(t,e){var i=ife(t+"");if(arguments.length<2){for(var r=aH(this.node()),n=-1,a=i.length;++n<a;)if(!r.contains(i[n]))return!1;return!0}return this.each((typeof e=="function"?o5e:e?a5e:s5e)(i,e))}function u5e(){this.textContent=""}function c5e(t){return function(){this.textContent=t}}function d5e(t){return function(){var e=t.apply(this,arguments);this.textContent=e??""}}function p5e(t){return arguments.length?this.each(t==null?u5e:(typeof t=="function"?d5e:c5e)(t)):this.node().textContent}function f5e(){this.innerHTML=""}function m5e(t){return function(){this.innerHTML=t}}function h5e(t){return function(){var e=t.apply(this,arguments);this.innerHTML=e??""}}function g5e(t){return arguments.length?this.each(t==null?f5e:(typeof t=="function"?h5e:m5e)(t)):this.node().innerHTML}function I5e(){this.nextSibling&&this.parentNode.appendChild(this)}function v5e(){return this.each(I5e)}function y5e(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function b5e(){return this.each(y5e)}function w5e(t){var e=typeof t=="function"?t:Xpe(t);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function S5e(){return null}function U5e(t,e){var i=typeof t=="function"?t:Xpe(t),r=e==null?S5e:typeof e=="function"?e:nH(e);return this.select(function(){return this.insertBefore(i.apply(this,arguments),r.apply(this,arguments)||null)})}function T5e(){var t=this.parentNode;t&&t.removeChild(this)}function D5e(){return this.each(T5e)}function P5e(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function E5e(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function R5e(t){return this.select(t?E5e:P5e)}function C5e(t){return arguments.length?this.property("__data__",t):this.node().__data__}function M5e(t){return function(e){t.call(this,e,this.__data__)}}function N5e(t){return t.trim().split(/^|\s+/).map(function(e){var i="",r=e.indexOf(".");return r>=0&&(i=e.slice(r+1),e=e.slice(0,r)),{type:e,name:i}})}function A5e(t){return function(){var e=this.__on;if(e){for(var i=0,r=-1,n=e.length,a;i<n;++i)a=e[i],(!t.type||a.type===t.type)&&a.name===t.name?this.removeEventListener(a.type,a.listener,a.options):e[++r]=a;++r?e.length=r:delete this.__on}}}function k5e(t,e,i){return function(){var r=this.__on,n,a=M5e(e);if(r){for(var s=0,o=r.length;s<o;++s)if((n=r[s]).type===t.type&&n.name===t.name){this.removeEventListener(n.type,n.listener,n.options),this.addEventListener(n.type,n.listener=a,n.options=i),n.value=e;return}}this.addEventListener(t.type,a,i),n={type:t.type,name:t.name,value:e,listener:a,options:i},r?r.push(n):this.__on=[n]}}function O5e(t,e,i){var r=N5e(t+""),n,a=r.length,s;if(arguments.length<2){var o=this.node().__on;if(o){for(var l=0,u=o.length,c;l<u;++l)for(n=0,c=o[l];n<a;++n)if((s=r[n]).type===c.type&&s.name===c.name)return c.value}return}for(o=e?k5e:A5e,n=0;n<a;++n)this.each(o(r[n],e,i));return this}function sfe(t,e,i){var r=tfe(t),n=r.CustomEvent;typeof n=="function"?n=new n(e,i):(n=r.document.createEvent("Event"),i?(n.initEvent(e,i.bubbles,i.cancelable),n.detail=i.detail):n.initEvent(e,!1,!1)),t.dispatchEvent(n)}function x5e(t,e){return function(){return sfe(this,t,e)}}function F5e(t,e){return function(){return sfe(this,t,e.apply(this,arguments))}}function L5e(t,e){return this.each((typeof e=="function"?F5e:x5e)(t,e))}function*_5e(){for(var t=this._groups,e=0,i=t.length;e<i;++e)for(var r=t[e],n=0,a=r.length,s;n<a;++n)(s=r[n])&&(yield s)}var $5e=[null];function Uu(t,e){this._groups=t,this._parents=e}function fT(){return new Uu([[document.documentElement]],$5e)}function B5e(){return this}Uu.prototype=fT.prototype={constructor:Uu,select:d4e,selectAll:h4e,selectChild:y4e,selectChildren:U4e,filter:T4e,data:M4e,enter:D4e,exit:A4e,join:k4e,merge:O4e,selection:B5e,order:x4e,sort:F4e,call:_4e,nodes:$4e,node:B4e,size:V4e,empty:j4e,each:G4e,attr:X4e,style:e5e,property:n5e,classed:l5e,text:p5e,html:g5e,raise:v5e,lower:b5e,append:w5e,insert:U5e,remove:D5e,clone:R5e,datum:C5e,on:O5e,dispatch:L5e,[Symbol.iterator]:_5e};function sH(t,e,i){t.prototype=e.prototype=i,i.constructor=t}function ofe(t,e){var i=Object.create(t.prototype);for(var r in e)i[r]=e[r];return i}function mT(){}var gw=.7,bE=1/gw,zg="\\s*([+-]?\\d+)\\s*",Iw="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",rc="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",V5e=/^#([0-9a-f]{3,8})$/,j5e=new RegExp(`^rgb\\(${zg},${zg},${zg}\\)$`),G5e=new RegExp(`^rgb\\(${rc},${rc},${rc}\\)$`),H5e=new RegExp(`^rgba\\(${zg},${zg},${zg},${Iw}\\)$`),W5e=new RegExp(`^rgba\\(${rc},${rc},${rc},${Iw}\\)$`),z5e=new RegExp(`^hsl\\(${Iw},${rc},${rc}\\)$`),q5e=new RegExp(`^hsla\\(${Iw},${rc},${rc},${Iw}\\)$`),j3={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};sH(mT,vw,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:G3,formatHex:G3,formatHex8:Y5e,formatHsl:K5e,formatRgb:H3,toString:H3});function G3(){return this.rgb().formatHex()}function Y5e(){return this.rgb().formatHex8()}function K5e(){return lfe(this).formatHsl()}function H3(){return this.rgb().formatRgb()}function vw(t){var e,i;return t=(t+"").trim().toLowerCase(),(e=V5e.exec(t))?(i=e[1].length,e=parseInt(e[1],16),i===6?W3(e):i===3?new ks(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):i===8?FT(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):i===4?FT(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=j5e.exec(t))?new ks(e[1],e[2],e[3],1):(e=G5e.exec(t))?new ks(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=H5e.exec(t))?FT(e[1],e[2],e[3],e[4]):(e=W5e.exec(t))?FT(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=z5e.exec(t))?Y3(e[1],e[2]/100,e[3]/100,1):(e=q5e.exec(t))?Y3(e[1],e[2]/100,e[3]/100,e[4]):j3.hasOwnProperty(t)?W3(j3[t]):t==="transparent"?new ks(NaN,NaN,NaN,0):null}function W3(t){return new ks(t>>16&255,t>>8&255,t&255,1)}function FT(t,e,i,r){return r<=0&&(t=e=i=NaN),new ks(t,e,i,r)}function X5e(t){return t instanceof mT||(t=vw(t)),t?(t=t.rgb(),new ks(t.r,t.g,t.b,t.opacity)):new ks}function u1(t,e,i,r){return arguments.length===1?X5e(t):new ks(t,e,i,r??1)}function ks(t,e,i,r){this.r=+t,this.g=+e,this.b=+i,this.opacity=+r}sH(ks,u1,ofe(mT,{brighter(t){return t=t==null?bE:Math.pow(bE,t),new ks(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=t==null?gw:Math.pow(gw,t),new ks(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new ks(Um(this.r),Um(this.g),Um(this.b),wE(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:z3,formatHex:z3,formatHex8:J5e,formatRgb:q3,toString:q3}));function z3(){return`#${Jf(this.r)}${Jf(this.g)}${Jf(this.b)}`}function J5e(){return`#${Jf(this.r)}${Jf(this.g)}${Jf(this.b)}${Jf((isNaN(this.opacity)?1:this.opacity)*255)}`}function q3(){const t=wE(this.opacity);return`${t===1?"rgb(":"rgba("}${Um(this.r)}, ${Um(this.g)}, ${Um(this.b)}${t===1?")":`, ${t})`}`}function wE(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function Um(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function Jf(t){return t=Um(t),(t<16?"0":"")+t.toString(16)}function Y3(t,e,i,r){return r<=0?t=e=i=NaN:i<=0||i>=1?t=e=NaN:e<=0&&(t=NaN),new _l(t,e,i,r)}function lfe(t){if(t instanceof _l)return new _l(t.h,t.s,t.l,t.opacity);if(t instanceof mT||(t=vw(t)),!t)return new _l;if(t instanceof _l)return t;t=t.rgb();var e=t.r/255,i=t.g/255,r=t.b/255,n=Math.min(e,i,r),a=Math.max(e,i,r),s=NaN,o=a-n,l=(a+n)/2;return o?(e===a?s=(i-r)/o+(i<r)*6:i===a?s=(r-e)/o+2:s=(e-i)/o+4,o/=l<.5?a+n:2-a-n,s*=60):o=l>0&&l<1?0:s,new _l(s,o,l,t.opacity)}function Q5e(t,e,i,r){return arguments.length===1?lfe(t):new _l(t,e,i,r??1)}function _l(t,e,i,r){this.h=+t,this.s=+e,this.l=+i,this.opacity=+r}sH(_l,Q5e,ofe(mT,{brighter(t){return t=t==null?bE:Math.pow(bE,t),new _l(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=t==null?gw:Math.pow(gw,t),new _l(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+(this.h<0)*360,e=isNaN(t)||isNaN(this.s)?0:this.s,i=this.l,r=i+(i<.5?i:1-i)*e,n=2*i-r;return new ks(Mk(t>=240?t-240:t+120,n,r),Mk(t,n,r),Mk(t<120?t+240:t-120,n,r),this.opacity)},clamp(){return new _l(K3(this.h),LT(this.s),LT(this.l),wE(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=wE(this.opacity);return`${t===1?"hsl(":"hsla("}${K3(this.h)}, ${LT(this.s)*100}%, ${LT(this.l)*100}%${t===1?")":`, ${t})`}`}}));function K3(t){return t=(t||0)%360,t<0?t+360:t}function LT(t){return Math.max(0,Math.min(1,t||0))}function Mk(t,e,i){return(t<60?e+(i-e)*t/60:t<180?i:t<240?e+(i-e)*(240-t)/60:e)*255}const ufe=t=>()=>t;function Z5e(t,e){return function(i){return t+i*e}}function eKe(t,e,i){return t=Math.pow(t,i),e=Math.pow(e,i)-t,i=1/i,function(r){return Math.pow(t+r*e,i)}}function tKe(t){return(t=+t)==1?cfe:function(e,i){return i-e?eKe(e,i,t):ufe(isNaN(e)?i:e)}}function cfe(t,e){var i=e-t;return i?Z5e(t,i):ufe(isNaN(t)?e:t)}const X3=(function t(e){var i=tKe(e);function r(n,a){var s=i((n=u1(n)).r,(a=u1(a)).r),o=i(n.g,a.g),l=i(n.b,a.b),u=cfe(n.opacity,a.opacity);return function(c){return n.r=s(c),n.g=o(c),n.b=l(c),n.opacity=u(c),n+""}}return r.gamma=t,r})(1);function ap(t,e){return t=+t,e=+e,function(i){return t*(1-i)+e*i}}var c1=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Nk=new RegExp(c1.source,"g");function iKe(t){return function(){return t}}function rKe(t){return function(e){return t(e)+""}}function nKe(t,e){var i=c1.lastIndex=Nk.lastIndex=0,r,n,a,s=-1,o=[],l=[];for(t=t+"",e=e+"";(r=c1.exec(t))&&(n=Nk.exec(e));)(a=n.index)>i&&(a=e.slice(i,a),o[s]?o[s]+=a:o[++s]=a),(r=r[0])===(n=n[0])?o[s]?o[s]+=n:o[++s]=n:(o[++s]=null,l.push({i:s,x:ap(r,n)})),i=Nk.lastIndex;return i<e.length&&(a=e.slice(i),o[s]?o[s]+=a:o[++s]=a),o.length<2?l[0]?rKe(l[0].x):iKe(e):(e=l.length,function(u){for(var c=0,d;c<e;++c)o[(d=l[c]).i]=d.x(u);return o.join("")})}var J3=180/Math.PI,dfe={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function pfe(t,e,i,r,n,a){var s,o,l;return(s=Math.sqrt(t*t+e*e))&&(t/=s,e/=s),(l=t*i+e*r)&&(i-=t*l,r-=e*l),(o=Math.sqrt(i*i+r*r))&&(i/=o,r/=o,l/=o),t*r<e*i&&(t=-t,e=-e,l=-l,s=-s),{translateX:n,translateY:a,rotate:Math.atan2(e,t)*J3,skewX:Math.atan(l)*J3,scaleX:s,scaleY:o}}var _T;function aKe(t){const e=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(t+"");return e.isIdentity?dfe:pfe(e.a,e.b,e.c,e.d,e.e,e.f)}function sKe(t){return t==null||(_T||(_T=document.createElementNS("http://www.w3.org/2000/svg","g")),_T.setAttribute("transform",t),!(t=_T.transform.baseVal.consolidate()))?dfe:(t=t.matrix,pfe(t.a,t.b,t.c,t.d,t.e,t.f))}function ffe(t,e,i,r){function n(u){return u.length?u.pop()+" ":""}function a(u,c,d,p,f,m){if(u!==d||c!==p){var h=f.push("translate(",null,e,null,i);m.push({i:h-4,x:ap(u,d)},{i:h-2,x:ap(c,p)})}else(d||p)&&f.push("translate("+d+e+p+i)}function s(u,c,d,p){u!==c?(u-c>180?c+=360:c-u>180&&(u+=360),p.push({i:d.push(n(d)+"rotate(",null,r)-2,x:ap(u,c)})):c&&d.push(n(d)+"rotate("+c+r)}function o(u,c,d,p){u!==c?p.push({i:d.push(n(d)+"skewX(",null,r)-2,x:ap(u,c)}):c&&d.push(n(d)+"skewX("+c+r)}function l(u,c,d,p,f,m){if(u!==d||c!==p){var h=f.push(n(f)+"scale(",null,",",null,")");m.push({i:h-4,x:ap(u,d)},{i:h-2,x:ap(c,p)})}else(d!==1||p!==1)&&f.push(n(f)+"scale("+d+","+p+")")}return function(u,c){var d=[],p=[];return u=t(u),c=t(c),a(u.translateX,u.translateY,c.translateX,c.translateY,d,p),s(u.rotate,c.rotate,d,p),o(u.skewX,c.skewX,d,p),l(u.scaleX,u.scaleY,c.scaleX,c.scaleY,d,p),u=c=null,function(f){for(var m=-1,h=p.length,g;++m<h;)d[(g=p[m]).i]=g.x(f);return d.join("")}}}var oKe=ffe(aKe,"px, ","px)","deg)"),lKe=ffe(sKe,", ",")",")"),HI=0,Ey=0,vy=0,mfe=1e3,SE,Ry,UE=0,Qm=0,bA=0,yw=typeof performance=="object"&&performance.now?performance:Date,hfe=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function oH(){return Qm||(hfe(uKe),Qm=yw.now()+bA)}function uKe(){Qm=0}function TE(){this._call=this._time=this._next=null}TE.prototype=gfe.prototype={constructor:TE,restart:function(t,e,i){if(typeof t!="function")throw new TypeError("callback is not a function");i=(i==null?oH():+i)+(e==null?0:+e),!this._next&&Ry!==this&&(Ry?Ry._next=this:SE=this,Ry=this),this._call=t,this._time=i,d1()},stop:function(){this._call&&(this._call=null,this._time=1/0,d1())}};function gfe(t,e,i){var r=new TE;return r.restart(t,e,i),r}function cKe(){oH(),++HI;for(var t=SE,e;t;)(e=Qm-t._time)>=0&&t._call.call(void 0,e),t=t._next;--HI}function Q3(){Qm=(UE=yw.now())+bA,HI=Ey=0;try{cKe()}finally{HI=0,pKe(),Qm=0}}function dKe(){var t=yw.now(),e=t-UE;e>mfe&&(bA-=e,UE=t)}function pKe(){for(var t,e=SE,i,r=1/0;e;)e._call?(r>e._time&&(r=e._time),t=e,e=e._next):(i=e._next,e._next=null,e=t?t._next=i:SE=i);Ry=t,d1(r)}function d1(t){if(!HI){Ey&&(Ey=clearTimeout(Ey));var e=t-Qm;e>24?(t<1/0&&(Ey=setTimeout(Q3,t-yw.now()-bA)),vy&&(vy=clearInterval(vy))):(vy||(UE=yw.now(),vy=setInterval(dKe,mfe)),HI=1,hfe(Q3))}}function Z3(t,e,i){var r=new TE;return e=e==null?0:+e,r.restart(n=>{r.stop(),t(n+e)},e,i),r}var fKe=Kpe("start","end","cancel","interrupt"),mKe=[],Ife=0,eY=1,p1=2,RD=3,tY=4,f1=5,CD=6;function wA(t,e,i,r,n,a){var s=t.__transition;if(!s)t.__transition={};else if(i in s)return;hKe(t,i,{name:e,index:r,group:n,on:fKe,tween:mKe,time:a.time,delay:a.delay,duration:a.duration,ease:a.ease,timer:null,state:Ife})}function lH(t,e){var i=Lu(t,e);if(i.state>Ife)throw new Error("too late; already scheduled");return i}function qc(t,e){var i=Lu(t,e);if(i.state>RD)throw new Error("too late; already running");return i}function Lu(t,e){var i=t.__transition;if(!i||!(i=i[e]))throw new Error("transition not found");return i}function hKe(t,e,i){var r=t.__transition,n;r[e]=i,i.timer=gfe(a,0,i.time);function a(u){i.state=eY,i.timer.restart(s,i.delay,i.time),i.delay<=u&&s(u-i.delay)}function s(u){var c,d,p,f;if(i.state!==eY)return l();for(c in r)if(f=r[c],f.name===i.name){if(f.state===RD)return Z3(s);f.state===tY?(f.state=CD,f.timer.stop(),f.on.call("interrupt",t,t.__data__,f.index,f.group),delete r[c]):+c<e&&(f.state=CD,f.timer.stop(),f.on.call("cancel",t,t.__data__,f.index,f.group),delete r[c])}if(Z3(function(){i.state===RD&&(i.state=tY,i.timer.restart(o,i.delay,i.time),o(u))}),i.state=p1,i.on.call("start",t,t.__data__,i.index,i.group),i.state===p1){for(i.state=RD,n=new Array(p=i.tween.length),c=0,d=-1;c<p;++c)(f=i.tween[c].value.call(t,t.__data__,i.index,i.group))&&(n[++d]=f);n.length=d+1}}function o(u){for(var c=u<i.duration?i.ease.call(null,u/i.duration):(i.timer.restart(l),i.state=f1,1),d=-1,p=n.length;++d<p;)n[d].call(t,c);i.state===f1&&(i.on.call("end",t,t.__data__,i.index,i.group),l())}function l(){i.state=CD,i.timer.stop(),delete r[e];for(var u in r)return;delete t.__transition}}function gKe(t,e){var i=t.__transition,r,n,a=!0,s;if(i){e=e==null?null:e+"";for(s in i){if((r=i[s]).name!==e){a=!1;continue}n=r.state>p1&&r.state<f1,r.state=CD,r.timer.stop(),r.on.call(n?"interrupt":"cancel",t,t.__data__,r.index,r.group),delete i[s]}a&&delete t.__transition}}function IKe(t){return this.each(function(){gKe(this,t)})}function vKe(t,e){var i,r;return function(){var n=qc(this,t),a=n.tween;if(a!==i){r=i=a;for(var s=0,o=r.length;s<o;++s)if(r[s].name===e){r=r.slice(),r.splice(s,1);break}}n.tween=r}}function yKe(t,e,i){var r,n;if(typeof i!="function")throw new Error;return function(){var a=qc(this,t),s=a.tween;if(s!==r){n=(r=s).slice();for(var o={name:e,value:i},l=0,u=n.length;l<u;++l)if(n[l].name===e){n[l]=o;break}l===u&&n.push(o)}a.tween=n}}function bKe(t,e){var i=this._id;if(t+="",arguments.length<2){for(var r=Lu(this.node(),i).tween,n=0,a=r.length,s;n<a;++n)if((s=r[n]).name===t)return s.value;return null}return this.each((e==null?vKe:yKe)(i,t,e))}function uH(t,e,i){var r=t._id;return t.each(function(){var n=qc(this,r);(n.value||(n.value={}))[e]=i.apply(this,arguments)}),function(n){return Lu(n,r).value[e]}}function vfe(t,e){var i;return(typeof e=="number"?ap:e instanceof vw?X3:(i=vw(e))?(e=i,X3):nKe)(t,e)}function wKe(t){return function(){this.removeAttribute(t)}}function SKe(t){return function(){this.removeAttributeNS(t.space,t.local)}}function UKe(t,e,i){var r,n=i+"",a;return function(){var s=this.getAttribute(t);return s===n?null:s===r?a:a=e(r=s,i)}}function TKe(t,e,i){var r,n=i+"",a;return function(){var s=this.getAttributeNS(t.space,t.local);return s===n?null:s===r?a:a=e(r=s,i)}}function DKe(t,e,i){var r,n,a;return function(){var s,o=i(this),l;return o==null?void this.removeAttribute(t):(s=this.getAttribute(t),l=o+"",s===l?null:s===r&&l===n?a:(n=l,a=e(r=s,o)))}}function PKe(t,e,i){var r,n,a;return function(){var s,o=i(this),l;return o==null?void this.removeAttributeNS(t.space,t.local):(s=this.getAttributeNS(t.space,t.local),l=o+"",s===l?null:s===r&&l===n?a:(n=l,a=e(r=s,o)))}}function EKe(t,e){var i=yA(t),r=i==="transform"?lKe:vfe;return this.attrTween(t,typeof e=="function"?(i.local?PKe:DKe)(i,r,uH(this,"attr."+t,e)):e==null?(i.local?SKe:wKe)(i):(i.local?TKe:UKe)(i,r,e))}function RKe(t,e){return function(i){this.setAttribute(t,e.call(this,i))}}function CKe(t,e){return function(i){this.setAttributeNS(t.space,t.local,e.call(this,i))}}function MKe(t,e){var i,r;function n(){var a=e.apply(this,arguments);return a!==r&&(i=(r=a)&&CKe(t,a)),i}return n._value=e,n}function NKe(t,e){var i,r;function n(){var a=e.apply(this,arguments);return a!==r&&(i=(r=a)&&RKe(t,a)),i}return n._value=e,n}function AKe(t,e){var i="attr."+t;if(arguments.length<2)return(i=this.tween(i))&&i._value;if(e==null)return this.tween(i,null);if(typeof e!="function")throw new Error;var r=yA(t);return this.tween(i,(r.local?MKe:NKe)(r,e))}function kKe(t,e){return function(){lH(this,t).delay=+e.apply(this,arguments)}}function OKe(t,e){return e=+e,function(){lH(this,t).delay=e}}function xKe(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?kKe:OKe)(e,t)):Lu(this.node(),e).delay}function FKe(t,e){return function(){qc(this,t).duration=+e.apply(this,arguments)}}function LKe(t,e){return e=+e,function(){qc(this,t).duration=e}}function _Ke(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?FKe:LKe)(e,t)):Lu(this.node(),e).duration}function $Ke(t,e){if(typeof e!="function")throw new Error;return function(){qc(this,t).ease=e}}function BKe(t){var e=this._id;return arguments.length?this.each($Ke(e,t)):Lu(this.node(),e).ease}function VKe(t,e){return function(){var i=e.apply(this,arguments);if(typeof i!="function")throw new Error;qc(this,t).ease=i}}function jKe(t){if(typeof t!="function")throw new Error;return this.each(VKe(this._id,t))}function GKe(t){typeof t!="function"&&(t=Qpe(t));for(var e=this._groups,i=e.length,r=new Array(i),n=0;n<i;++n)for(var a=e[n],s=a.length,o=r[n]=[],l,u=0;u<s;++u)(l=a[u])&&t.call(l,l.__data__,u,a)&&o.push(l);return new Ad(r,this._parents,this._name,this._id)}function HKe(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,i=t._groups,r=e.length,n=i.length,a=Math.min(r,n),s=new Array(r),o=0;o<a;++o)for(var l=e[o],u=i[o],c=l.length,d=s[o]=new Array(c),p,f=0;f<c;++f)(p=l[f]||u[f])&&(d[f]=p);for(;o<r;++o)s[o]=e[o];return new Ad(s,this._parents,this._name,this._id)}function WKe(t){return(t+"").trim().split(/^|\s+/).every(function(e){var i=e.indexOf(".");return i>=0&&(e=e.slice(0,i)),!e||e==="start"})}function zKe(t,e,i){var r,n,a=WKe(e)?lH:qc;return function(){var s=a(this,t),o=s.on;o!==r&&(n=(r=o).copy()).on(e,i),s.on=n}}function qKe(t,e){var i=this._id;return arguments.length<2?Lu(this.node(),i).on.on(t):this.each(zKe(i,t,e))}function YKe(t){return function(){var e=this.parentNode;for(var i in this.__transition)if(+i!==t)return;e&&e.removeChild(this)}}function KKe(){return this.on("end.remove",YKe(this._id))}function XKe(t){var e=this._name,i=this._id;typeof t!="function"&&(t=nH(t));for(var r=this._groups,n=r.length,a=new Array(n),s=0;s<n;++s)for(var o=r[s],l=o.length,u=a[s]=new Array(l),c,d,p=0;p<l;++p)(c=o[p])&&(d=t.call(c,c.__data__,p,o))&&("__data__"in c&&(d.__data__=c.__data__),u[p]=d,wA(u[p],e,i,p,u,Lu(c,i)));return new Ad(a,this._parents,e,i)}function JKe(t){var e=this._name,i=this._id;typeof t!="function"&&(t=Jpe(t));for(var r=this._groups,n=r.length,a=[],s=[],o=0;o<n;++o)for(var l=r[o],u=l.length,c,d=0;d<u;++d)if(c=l[d]){for(var p=t.call(c,c.__data__,d,l),f,m=Lu(c,i),h=0,g=p.length;h<g;++h)(f=p[h])&&wA(f,e,i,h,p,m);a.push(p),s.push(c)}return new Ad(a,s,e,i)}var QKe=fT.prototype.constructor;function ZKe(){return new QKe(this._groups,this._parents)}function e7e(t,e){var i,r,n;return function(){var a=GI(this,t),s=(this.style.removeProperty(t),GI(this,t));return a===s?null:a===i&&s===r?n:n=e(i=a,r=s)}}function yfe(t){return function(){this.style.removeProperty(t)}}function t7e(t,e,i){var r,n=i+"",a;return function(){var s=GI(this,t);return s===n?null:s===r?a:a=e(r=s,i)}}function i7e(t,e,i){var r,n,a;return function(){var s=GI(this,t),o=i(this),l=o+"";return o==null&&(l=o=(this.style.removeProperty(t),GI(this,t))),s===l?null:s===r&&l===n?a:(n=l,a=e(r=s,o))}}function r7e(t,e){var i,r,n,a="style."+e,s="end."+a,o;return function(){var l=qc(this,t),u=l.on,c=l.value[a]==null?o||(o=yfe(e)):void 0;(u!==i||n!==c)&&(r=(i=u).copy()).on(s,n=c),l.on=r}}function n7e(t,e,i){var r=(t+="")=="transform"?oKe:vfe;return e==null?this.styleTween(t,e7e(t,r)).on("end.style."+t,yfe(t)):typeof e=="function"?this.styleTween(t,i7e(t,r,uH(this,"style."+t,e))).each(r7e(this._id,t)):this.styleTween(t,t7e(t,r,e),i).on("end.style."+t,null)}function a7e(t,e,i){return function(r){this.style.setProperty(t,e.call(this,r),i)}}function s7e(t,e,i){var r,n;function a(){var s=e.apply(this,arguments);return s!==n&&(r=(n=s)&&a7e(t,s,i)),r}return a._value=e,a}function o7e(t,e,i){var r="style."+(t+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(e==null)return this.tween(r,null);if(typeof e!="function")throw new Error;return this.tween(r,s7e(t,e,i??""))}function l7e(t){return function(){this.textContent=t}}function u7e(t){return function(){var e=t(this);this.textContent=e??""}}function c7e(t){return this.tween("text",typeof t=="function"?u7e(uH(this,"text",t)):l7e(t==null?"":t+""))}function d7e(t){return function(e){this.textContent=t.call(this,e)}}function p7e(t){var e,i;function r(){var n=t.apply(this,arguments);return n!==i&&(e=(i=n)&&d7e(n)),e}return r._value=t,r}function f7e(t){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(t==null)return this.tween(e,null);if(typeof t!="function")throw new Error;return this.tween(e,p7e(t))}function m7e(){for(var t=this._name,e=this._id,i=bfe(),r=this._groups,n=r.length,a=0;a<n;++a)for(var s=r[a],o=s.length,l,u=0;u<o;++u)if(l=s[u]){var c=Lu(l,e);wA(l,t,i,u,s,{time:c.time+c.delay+c.duration,delay:0,duration:c.duration,ease:c.ease})}return new Ad(r,this._parents,t,i)}function h7e(){var t,e,i=this,r=i._id,n=i.size();return new Promise(function(a,s){var o={value:s},l={value:function(){--n===0&&a()}};i.each(function(){var u=qc(this,r),c=u.on;c!==t&&(e=(t=c).copy(),e._.cancel.push(o),e._.interrupt.push(o),e._.end.push(l)),u.on=e}),n===0&&a()})}var g7e=0;function Ad(t,e,i,r){this._groups=t,this._parents=e,this._name=i,this._id=r}function bfe(){return++g7e}var Xc=fT.prototype;Ad.prototype={constructor:Ad,select:XKe,selectAll:JKe,selectChild:Xc.selectChild,selectChildren:Xc.selectChildren,filter:GKe,merge:HKe,selection:ZKe,transition:m7e,call:Xc.call,nodes:Xc.nodes,node:Xc.node,size:Xc.size,empty:Xc.empty,each:Xc.each,on:qKe,attr:EKe,attrTween:AKe,style:n7e,styleTween:o7e,text:c7e,textTween:f7e,remove:KKe,tween:bKe,delay:xKe,duration:_Ke,ease:BKe,easeVarying:jKe,end:h7e,[Symbol.iterator]:Xc[Symbol.iterator]};function I7e(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}var v7e={time:null,delay:0,duration:250,ease:I7e};function y7e(t,e){for(var i;!(i=t.__transition)||!(i=i[e]);)if(!(t=t.parentNode))throw new Error(`transition ${e} not found`);return i}function b7e(t){var e,i;t instanceof Ad?(e=t._id,t=t._name):(e=bfe(),(i=v7e).time=oH(),t=t==null?null:t+"");for(var r=this._groups,n=r.length,a=0;a<n;++a)for(var s=r[a],o=s.length,l,u=0;u<o;++u)(l=s[u])&&wA(l,t,e,u,s,i||y7e(l,e));return new Ad(r,this._parents,t,e)}fT.prototype.interrupt=IKe;fT.prototype.transition=b7e;function w7e(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)}function DE(t,e){if(!isFinite(t)||t===0)return null;var i=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"),r=t.slice(0,i);return[r.length>1?r[0]+r.slice(2):r,+t.slice(i+1)]}function S7e(t){return t=DE(Math.abs(t)),t?t[1]:NaN}function U7e(t,e){return function(i,r){for(var n=i.length,a=[],s=0,o=t[0],l=0;n>0&&o>0&&(l+o+1>r&&(o=Math.max(1,r-l)),a.push(i.substring(n-=o,n+o)),!((l+=o+1)>r));)o=t[s=(s+1)%t.length];return a.reverse().join(e)}}function T7e(t){return function(e){return e.replace(/[0-9]/g,function(i){return t[+i]})}}var D7e=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function m1(t){if(!(e=D7e.exec(t)))throw new Error("invalid format: "+t);var e;return new cH({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}m1.prototype=cH.prototype;function cH(t){this.fill=t.fill===void 0?" ":t.fill+"",this.align=t.align===void 0?">":t.align+"",this.sign=t.sign===void 0?"-":t.sign+"",this.symbol=t.symbol===void 0?"":t.symbol+"",this.zero=!!t.zero,this.width=t.width===void 0?void 0:+t.width,this.comma=!!t.comma,this.precision=t.precision===void 0?void 0:+t.precision,this.trim=!!t.trim,this.type=t.type===void 0?"":t.type+""}cH.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function P7e(t){e:for(var e=t.length,i=1,r=-1,n;i<e;++i)switch(t[i]){case".":r=n=i;break;case"0":r===0&&(r=i),n=i;break;default:if(!+t[i])break e;r>0&&(r=0);break}return r>0?t.slice(0,r)+t.slice(n+1):t}var PE;function E7e(t,e){var i=DE(t,e);if(!i)return PE=void 0,t.toPrecision(e);var r=i[0],n=i[1],a=n-(PE=Math.max(-8,Math.min(8,Math.floor(n/3)))*3)+1,s=r.length;return a===s?r:a>s?r+new Array(a-s+1).join("0"):a>0?r.slice(0,a)+"."+r.slice(a):"0."+new Array(1-a).join("0")+DE(t,Math.max(0,e+a-1))[0]}function iY(t,e){var i=DE(t,e);if(!i)return t+"";var r=i[0],n=i[1];return n<0?"0."+new Array(-n).join("0")+r:r.length>n+1?r.slice(0,n+1)+"."+r.slice(n+1):r+new Array(n-r.length+2).join("0")}const rY={"%":(t,e)=>(t*100).toFixed(e),b:t=>Math.round(t).toString(2),c:t=>t+"",d:w7e,e:(t,e)=>t.toExponential(e),f:(t,e)=>t.toFixed(e),g:(t,e)=>t.toPrecision(e),o:t=>Math.round(t).toString(8),p:(t,e)=>iY(t*100,e),r:iY,s:E7e,X:t=>Math.round(t).toString(16).toUpperCase(),x:t=>Math.round(t).toString(16)};function nY(t){return t}var aY=Array.prototype.map,sY=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function R7e(t){var e=t.grouping===void 0||t.thousands===void 0?nY:U7e(aY.call(t.grouping,Number),t.thousands+""),i=t.currency===void 0?"":t.currency[0]+"",r=t.currency===void 0?"":t.currency[1]+"",n=t.decimal===void 0?".":t.decimal+"",a=t.numerals===void 0?nY:T7e(aY.call(t.numerals,String)),s=t.percent===void 0?"%":t.percent+"",o=t.minus===void 0?"":t.minus+"",l=t.nan===void 0?"NaN":t.nan+"";function u(d,p){d=m1(d);var f=d.fill,m=d.align,h=d.sign,g=d.symbol,I=d.zero,v=d.width,w=d.comma,y=d.precision,b=d.trim,S=d.type;S==="n"?(w=!0,S="g"):rY[S]||(y===void 0&&(y=12),b=!0,S="g"),(I||f==="0"&&m==="=")&&(I=!0,f="0",m="=");var U=(p&&p.prefix!==void 0?p.prefix:"")+(g==="$"?i:g==="#"&&/[boxX]/.test(S)?"0"+S.toLowerCase():""),T=(g==="$"?r:/[%p]/.test(S)?s:"")+(p&&p.suffix!==void 0?p.suffix:""),P=rY[S],D=/[defgprs%]/.test(S);y=y===void 0?6:/[gprs]/.test(S)?Math.max(1,Math.min(21,y)):Math.max(0,Math.min(20,y));function E(R){var C=U,M=T,N,A,O;if(S==="c")M=P(R)+M,R="";else{R=+R;var k=R<0||1/R<0;if(R=isNaN(R)?l:P(Math.abs(R),y),b&&(R=P7e(R)),k&&+R==0&&h!=="+"&&(k=!1),C=(k?h==="("?h:o:h==="-"||h==="("?"":h)+C,M=(S==="s"&&!isNaN(R)&&PE!==void 0?sY[8+PE/3]:"")+M+(k&&h==="("?")":""),D){for(N=-1,A=R.length;++N<A;)if(O=R.charCodeAt(N),48>O||O>57){M=(O===46?n+R.slice(N+1):R.slice(N))+M,R=R.slice(0,N);break}}}w&&!I&&(R=e(R,1/0));var F=C.length+R.length+M.length,x=F<v?new Array(v-F+1).join(f):"";switch(w&&I&&(R=e(x+R,x.length?v-M.length:1/0),x=""),m){case"<":R=C+R+M+x;break;case"=":R=C+x+R+M;break;case"^":R=x.slice(0,F=x.length>>1)+C+R+M+x.slice(F);break;default:R=x+C+R+M;break}return a(R)}return E.toString=function(){return d+""},E}function c(d,p){var f=Math.max(-8,Math.min(8,Math.floor(S7e(p)/3)))*3,m=Math.pow(10,-f),h=u((d=m1(d),d.type="f",d),{suffix:sY[8+f/3]});return function(g){return h(m*g)}}return{format:u,formatPrefix:c}}var $T;C7e({thousands:",",grouping:[3],currency:["$",""]});function C7e(t){return $T=R7e(t),$T.format,$T.formatPrefix,$T}function M7e(t){var e=0,i=t.children,r=i&&i.length;if(!r)e=1;else for(;--r>=0;)e+=i[r].value;t.value=e}function N7e(){return this.eachAfter(M7e)}function A7e(t,e){let i=-1;for(const r of this)t.call(e,r,++i,this);return this}function k7e(t,e){for(var i=this,r=[i],n,a,s=-1;i=r.pop();)if(t.call(e,i,++s,this),n=i.children)for(a=n.length-1;a>=0;--a)r.push(n[a]);return this}function O7e(t,e){for(var i=this,r=[i],n=[],a,s,o,l=-1;i=r.pop();)if(n.push(i),a=i.children)for(s=0,o=a.length;s<o;++s)r.push(a[s]);for(;i=n.pop();)t.call(e,i,++l,this);return this}function x7e(t,e){let i=-1;for(const r of this)if(t.call(e,r,++i,this))return r}function F7e(t){return this.eachAfter(function(e){for(var i=+t(e.data)||0,r=e.children,n=r&&r.length;--n>=0;)i+=r[n].value;e.value=i})}function L7e(t){return this.eachBefore(function(e){e.children&&e.children.sort(t)})}function _7e(t){for(var e=this,i=$7e(e,t),r=[e];e!==i;)e=e.parent,r.push(e);for(var n=r.length;t!==i;)r.splice(n,0,t),t=t.parent;return r}function $7e(t,e){if(t===e)return t;var i=t.ancestors(),r=e.ancestors(),n=null;for(t=i.pop(),e=r.pop();t===e;)n=t,t=i.pop(),e=r.pop();return n}function B7e(){for(var t=this,e=[t];t=t.parent;)e.push(t);return e}function V7e(){return Array.from(this)}function j7e(){var t=[];return this.eachBefore(function(e){e.children||t.push(e)}),t}function G7e(){var t=this,e=[];return t.each(function(i){i!==t&&e.push({source:i.parent,target:i})}),e}function*H7e(){var t=this,e,i=[t],r,n,a;do for(e=i.reverse(),i=[];t=e.pop();)if(yield t,r=t.children)for(n=0,a=r.length;n<a;++n)i.push(r[n]);while(i.length)}function wfe(t,e){t instanceof Map?(t=[void 0,t],e===void 0&&(e=q7e)):e===void 0&&(e=z7e);for(var i=new EE(t),r,n=[i],a,s,o,l;r=n.pop();)if((s=e(r.data))&&(l=(s=Array.from(s)).length))for(r.children=s,o=l-1;o>=0;--o)n.push(a=s[o]=new EE(s[o])),a.parent=r,a.depth=r.depth+1;return i.eachBefore(K7e)}function W7e(){return wfe(this).eachBefore(Y7e)}function z7e(t){return t.children}function q7e(t){return Array.isArray(t)?t[1]:null}function Y7e(t){t.data.value!==void 0&&(t.value=t.data.value),t.data=t.data.data}function K7e(t){var e=0;do t.height=e;while((t=t.parent)&&t.height<++e)}function EE(t){this.data=t,this.depth=this.height=0,this.parent=null}EE.prototype=wfe.prototype={constructor:EE,count:N7e,each:A7e,eachAfter:O7e,eachBefore:k7e,find:x7e,sum:F7e,sort:L7e,path:_7e,ancestors:B7e,descendants:V7e,leaves:j7e,links:G7e,copy:W7e,[Symbol.iterator]:H7e};function Cy(t,e,i){this.k=t,this.x=e,this.y=i}Cy.prototype={constructor:Cy,scale:function(t){return t===1?this:new Cy(this.k*t,this.x,this.y)},translate:function(t,e){return t===0&e===0?this:new Cy(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};Cy.prototype;Object.assign({},...i1.countries.filter(t=>t.ioc).map(t=>({[t.ioc]:t.iso2})),...i1.countries.filter(t=>t.iso).map(t=>({[t.iso]:t.iso2})));const{MALE:X7e,FEMALE:J7e}=rR,{PAIR:Q7e}=wK,Z7e="utr",e8e={utr:{accessor:"utrRating",scaleType:"RATING",scaleColor:"blue",scaleName:"UTR",fallback:!0},wtn:{accessor:"wtnRating",scaleType:"RATING",scaleColor:"red",scaleName:"WTN",fallback:!0}},Sfe=t=>(e,i,r)=>{const n=e.getColumn().getDefinition(),a=n.field==="side1"&&1||n.field==="side2"&&2,s=document.createElement("div"),o=e.getRow().getData(),l=o.winningSide,u=e.getValue(),c=o.participant||u.participant||o.person&&o;if(c){const d=e8e[Z7e],p=m=>Dpe({eventHandlers:{participantClick:h=>Wu(t)&&t({...h,event:h.pointerEvent,cell:e})},composition:{configuration:{participantDetail:"TEAM",winnerColor:!0,genderColor:!0,scaleAttributes:d,flag:!1},theme:""},matchUp:o.matchUp,participant:m,placeholder:i,sideNumber:a}),f=m=>{const h=document.createElement("div");return h.className="flexrow flexjustifystart",m.individualParticipants.forEach((g,I)=>{if(h.appendChild(p(g)),!I){const v=document.createElement("span");v.style.width="1em",v.innerHTML="&nbsp;",h.appendChild(v)}}),h};return r==="sideBySide"&&c.participantType===Q7e?f(c):p(c)}if(l){const d=n.field===o.winningSide;s.style.color=d?"green":"red"}else{const d=u?.sex||o?.person?.sex,p=d===X7e&&"#2E86C1"||d===J7e&&"#AA336A"||"";s.style.color=p}return s.innerHTML=(qO(u)?u.participantName:u)||"",s};function t8e(t){const e=t.getRow().getData();if(!e.competitiveProfile?.competitiveness)return"";const{competitiveProfile:i,score:r}=e,n=document.createElement("span"),a={COMPETITIVE:"green",DECISIVE:"magenta",ROUTINE:"blue"};if(r){const{competitiveness:s}=i;n.style.fontSize="smaller",n.style.color=a[s],n.innerHTML=s}return n}function i8e(t){const e=t.getRow().getData();if(!e.readyToScore)return"";const i=e.matchUp.matchUpStatus==="WALKOVER",r=document.createElement("span");return r.classList.add("scoreCell"),e.score?(r.style.fontSize="smaller",r.innerHTML=e.score):i?r.innerHTML="WO":(r.style.fontSize="smaller",r.style.color="blue",r.innerHTML="--- --- ---"),r}function r8e(t,e){if(!t.score&&!e.score){if(t.readyToScore&&!e.readyToScore)return-1;if(e.readyToScore&&!t.readyToScore)return 1}return t.score&&!e.score?-1:e.score&&!t.score?1:0}function n8e({data:t}){const e=t.some(r=>r.courtName),i=r=>{const n=document.createElement("div");n.className="has-text-warning-dark",n.innerHTML="Select participant";const a=()=>console.log("boo");return r.getValue().participantName&&Sfe(a)(r,n)};return[{formatter:"responsiveCollapse",headerSort:!1,resizable:!1,hozAlign:Gi,minWidth:50,width:50},{formatter:"rownum",headerSort:!1,hozAlign:Lp,width:55},{title:"Flight",visible:!1,minWidth:150,field:"flight",widthGrow:1},{field:"scheduledDate",title:"Date",width:110},{visible:!!e,field:"courtName",title:"Court",width:100},{field:"scheduleTime",headerSort:!1,visible:!1,title:"Time",width:70},{formatter:i,sorter:DP,responsive:!1,title:"Side 1",minWidth:180,field:"side1",widthGrow:1},{formatter:i,sorter:DP,responsive:!1,title:"Side 2",minWidth:180,field:"side2",widthGrow:1},{formatter:i8e,sorter:r8e,field:"scoreDetail",responsive:!1,title:"Score",width:140},{sorter:COe,formatter:t8e,field:"competitiveProfile",responsive:!1,title:"Profile",visible:!1,width:140},{title:"<div class='fa-solid fa-check' style='color: green' />",formatter:"tickCross",field:"complete",hozAlign:Lp,tooltip:!1,width:40},{field:"matchUp.matchUpStatus",title:"Status",width:150},{title:"<div class='fa-solid fa-clock' style='color: blue' />",headerSort:!1,field:"duration",visible:!1,width:70}]}var a8e=function(t){return String.prototype.normalize?t.normalize("NFKD").replace(/[\u0300-\u036F]/g,""):t};const{TEAM:s8e}=gF,oY=t=>{const{potentialParticipants:e,structureName:i,matchUpType:r,roundNumber:n,matchUpId:a,roundName:s,schedule:o,eventId:l,drawId:u,sides:c,...d}=t,{scheduledDate:p,scheduleTime:f,courtName:m}=o||{},h=N=>N.person?.standardFamilyName||N.participantName,g=e?.map(N=>({participantName:N.map(h).filter(Boolean).join(" or ")}))||[],I=c?.[0]?.participant||g.shift(),v=c?.[1]?.participant||g.shift(),w={participantName:I?.participantName,sex:I?.person?.sex,participant:I},y={participantName:v?.participantName,sex:v?.person?.sex,participant:v},b=c.flatMap(({participant:N})=>N?.individualParticipantIds?.length?N.individualParticipantIds:N?.participantId).filter(Boolean),S=d.winningSide===1&&"side1"||d.winningSide===2&&"side2"||void 0,U=!!d.winningSide,T=!!(d.winningSide||d.readyToScore),P=d.score?.scoreStringSide1,D=c.flatMap(N=>{const A=N.participant?.person;return A?[A.standardGivenName,A.standardFamilyName]:N.participant?.individualParticipants?.map(({person:O})=>[O.standardGivenName,O.standardFamilyName])}).filter(Boolean).join(" ").toLowerCase(),E=a8e([D,I?.participantName,v?.participantName].filter(Boolean).join(" ")).toLowerCase(),R=t.collectionId?s8e:r,C=t.competitiveness?{competitiveness:t.competitiveness}:t.competitiveProfile,M={score:P,matchUpStatus:t.matchUpStatus,readyToScore:T,complete:U,winningSide:S};return{matchUpStatus:t.matchUpStatus,individualParticipantIds:b,flight:t.drawName,competitiveProfile:C,structureName:i,scheduledDate:p,readyToScore:T,scheduleTime:f,matchUpType:r,scoreDetail:M,winningSide:S,roundNumber:n,searchText:E,courtName:m,eventType:R,matchUpId:a,roundName:s,complete:U,eventId:l,matchUp:t,drawId:u,side1:w,side2:y,score:P}},{CONTAINER:o8e}=pR;async function l8e(t){const{drawId:e,structureId:i,eventData:r}=t;let n,a,s,o,l=t.matchUps;const u=()=>{a=r?.drawsData?.find(y=>y.drawId===e)?.structures?.find(y=>y.structureId===i),o=a?.structureType===o8e;const v=a?.roundMatchUps?Object.values(a?.roundMatchUps||{}).flat():[],w=v.flatMap(y=>y.tieMatchUps||[]);return w.length&&v.push(...w),v.filter(({matchUpStatus:y})=>y!=="BYE").filter(({sides:y})=>!s||y.find(b=>b.participant?.participantName?.toLowerCase().includes(s?.toLowerCase())))};l||(l=await u()),r&&l.forEach(I=>I.eventName=r.eventInfo.eventName);const c=()=>l.map(oY),d=()=>u().map(oY),p=I=>{I.participantFilter&&(s=I.participantFilter),n.replaceData(d())},f=c(),m=n8e({data:f}),h=o?["roundName","structureName"]:["roundName"];return(I=>{VS({anchorId:"flightDisplay"});const v=document.getElementById("flightDisplay");n=new KI(v,{groupHeader:[ROe,w=>w],headerSortElement:Bee(["complete","duration","score"]),responsiveLayoutCollapseStartOpen:!1,height:window.innerHeight*.85,responsiveLayout:"collapse",placeholder:"No matches",layout:"fitColumns",reactiveData:!0,index:"matchUpId",groupBy:h,columns:m,data:I})})(f),{table:n,replaceTableData:p}}const u8e=t=>t.reduce((e,i)=>e+parseFloat(i),0),lY=t=>parseFloat((u8e(t)/t.length).toFixed(2));function uY(t){const{participantResult:e,drawPosition:i,participantId:r,participantMap:n}=t,a=e?.ratingVariation?.length?lY(e.ratingVariation):0,s=e?.pressureScores?.length?lY(e.pressureScores):0,o=`${e?.pointsWon||0}/${e?.pointsLost||0}`,l=`${e?.gamesWon||0}/${e?.gamesLost||0}`,u=`${e?.setsWon||0}/${e?.setsLost||0}`,c=e?.groupOrder||e?.provisionalOrder,d=n[r];return{participantName:d.participantName,groupName:d.groupName,...e,averageVariation:a,averagePressure:s,participantId:r,pointsResult:o,drawPosition:i,participant:d,gamesResult:l,setsResult:u,order:c}}function RE(t,e){return!t&&!e||t&&!e?-1:e&&!t?1:t-e}function Ig(t){const e=t.getValue();return e&&`${(parseFloat(e)*100).toFixed(0)}%`}function cY(t,e){return!t&&!e||t&&!e?-1:e&&!t?1:e-t}function c8e({isAdHoc:t}){return[{formatter:Sfe(({event:e,cell:i,...r})=>console.log("cell clicked",{event:e,cell:i,undefined:void 0,params:r})),sorter:DP,field:"participantName",responsive:!1,resizable:!1,maxWidth:400,minWidth:200,title:"Name",widthGrow:2,frozen:!0},{headerHozAlign:Gi,headerWordWrap:!0,title:"Match W/L",hozAlign:Gi,maxWidth:80,field:"result"},{formatter:Ig,headerHozAlign:Gi,headerWordWrap:!0,field:"matchUpsPct",title:"Match Win%",hozAlign:Gi,maxWidth:80},{headerHozAlign:Gi,headerWordWrap:!0,field:"setsResult",title:"Sets W/L",hozAlign:Gi,maxWidth:80},{formatter:Ig,headerHozAlign:Gi,headerWordWrap:!0,title:"Set Win%",hozAlign:Gi,field:"setsPct",maxWidth:80},{headerHozAlign:Gi,headerWordWrap:!0,field:"gamesResult",title:"Games W/L",hozAlign:Gi,maxWidth:80},{formatter:Ig,headerHozAlign:Gi,headerWordWrap:!0,title:"Game Win%",hozAlign:Gi,field:"gamesPct",maxWidth:80},{headerHozAlign:Gi,headerWordWrap:!0,field:"pointsResult",title:"Points W/L",hozAlign:Gi,maxWidth:80},{formatter:Ig,headerHozAlign:Gi,headerWordWrap:!0,title:"Points Win%",field:"pointsPct",hozAlign:Gi,maxWidth:80},{formatter:Ig,field:"averagePressure",headerHozAlign:Gi,sorter:cY,hozAlign:Gi,maxWidth:70,title:"PS"},{formatter:Ig,field:"averageVariation",headerHozAlign:Gi,sorter:cY,hozAlign:Gi,maxWidth:70,title:"RV"},{headerHozAlign:Gi,field:"pressureOrder",sorter:RE,hozAlign:Gi,visible:t,title:"Order",maxWidth:80},{headerHozAlign:Gi,sorter:RE,visible:!t,hozAlign:Gi,title:"Order",field:"order",maxWidth:80},{field:"groupName",visible:!1,title:"Group"}]}async function d8e({drawId:t,structureId:e,eventData:i,participants:r=[]}){let n,a,s,l=i?.drawsData?.find(y=>y.drawId===t)?.structures?.find(y=>y.structureId===e);const u=UR.isAdHoc({structure:l}),c=y=>(y??[]).reduce((b,S)=>(b[S.participantId]=S,b),{}),d={},p=()=>(l=i?.drawsData?.find(S=>S.drawId===t)?.structures?.find(S=>S.structureId===e),s||(s=c(r)),(l?.roundMatchUps?Object.values(l.roundMatchUps).flat():[]).forEach(({sides:S,structureName:U,structureId:T})=>{d[T]=U,S.forEach(P=>{P.participantId&&(s[P.participantId].groupName=U)})}),(l?.participantResults??[]).filter(S=>{const U=s[S.participantId];return!a||U?.participantName?.toLowerCase().includes(a?.toLowerCase())})),f=p(),m=()=>f?.map(y=>uY({...y,participantMap:s})).sort((y,b)=>u?RE(y.pressureOrder,b.pressureOrder):RE(y.order,b.order)),h=()=>p()?.map(y=>uY({...y,participantMap:s})),g=y=>{y?.participantFilter!==void 0&&(a=y.participantFilter),n.replaceData(h())},I=m(),v=c8e({isAdHoc:u});return(y=>{VS({anchorId:"flightDisplay"});const b=document.getElementById("flightDisplay"),S=Object.values(d).length>1?["groupName"]:void 0;n=new KI(b,{headerSortElement:Bee(["averageVariation","averagePressure","participantName","gamesResult","matchUpsPct","setsResult","gamesPct","setsPct","result","order"]),height:window.innerHeight*.85,groupHeader:[U=>U],placeholder:"No participants",renderHorizontal:"virtual",index:"matchUpId",groupBy:S,columns:v,data:y})})(I),{table:n,replaceTableData:g}}const{CONTAINER:p8e}=pR;function f8e(t){const{callback:e,structure:i,existingView:r}=t,n=l=>r!==l&&Wu(e)&&e({refresh:!0,view:l}),a=i?.structureType===p8e,s=_Ne.isAdHoc({structure:i}),o=[];return r!==iz&&o.push({onClick:()=>n(iz),label:s?"Columns":"Draw",close:!0}),r!==nz&&o.push({onClick:()=>n(nz),label:"Table view",close:!0}),(s||a)&&r!==rz&&o.push({onClick:()=>n(rz),label:"Statistics",close:!0}),{label:"Display",id:"roundDisplayButton",options:o,selection:!1,location:Fm,align:Fm}}function dY({tournamentId:t,eventId:e,header:i,flightDisplay:r,displayFormat:n,drawId:a,structureId:s}){const o=()=>document.getElementById("structureButton")?.remove(),l=()=>document.getElementById("roundDisplayButton")?.remove();$ee({tournamentId:t,eventId:e,hydrateParticipants:!1}).then(c=>{const d=c?.data?.eventData||c?.data,p=c?.data?.participants||[];window?.dev&&(window.dev.eventData=d);const f=b=>Object.values(b.roundMatchUps||{}).flat(),m=b=>b.structures?.some(S=>f(S).length>0),h=d?.drawsData.filter(m);{const b=new Map(p.map(U=>[U.participantId,U])),S=U=>{for(const T of U.sides||[])T.participantId&&(T.participant=b.get(T.participantId),T.participant?.individualParticipantIds&&(T.participant.individualParticipants=T.participant.individualParticipantIds.map(P=>b.get(P))))};for(const U of h)for(const T of U.structures)Object.values(T.roundMatchUps||{}).flat().forEach(P=>{S(P),P.tieMatchUps?.forEach(S)})}const g=b=>{const S=h[b];if(!S)return;const U=S.drawId,T=({view:R})=>{R&&(n=R),g(b)},P=R=>{const C=S.structures?.[R];l();const M=f8e({callback:T,structure:C}),N=um({button:M});i.appendChild(N);const A=C.structureId,O=Object.values(C.roundMatchUps||{}).flat();UR.isAdHoc({structure:C})&&O.sort(JC.matchUpScheduleSort),r.innerHTML=S.drawName,sp(r);const F={...d?.eventInfo?.display,...S?.display,...C?.display},x=F?.compositionName,L=F?.configuration,$=PYe[x??"National"];if(Object.assign($.configuration,L),$.configuration.genderColor=!0,n==="roundsColumns"){const V=wYe({content:bYe({context:{drawId:U,structureId:A},matchUps:O,composition:$,structureId:A}),theme:$.theme});r.appendChild(V)}else n==="roundsStats"?d8e({drawId:U,structureId:A,eventData:d,participants:p}):l8e({drawId:U,structureId:A,eventData:d})},D=s?Math.max(S.structures?.findIndex(R=>R.structureId===s)??-1,0):0;if(s=void 0,S.structures?.length>1){const R=S.structures.map(({structureName:N,structureId:A},O)=>({onClick:()=>{Qf({tournamentId:t,eventId:e,drawId:U,structureId:A}),P(O)},isActive:O===D,label:N,close:!0})),C={label:S.structures[D].structureName,options:R,id:"structureButton",modifyLabel:!0,selection:!0,location:Lp},M=um({button:C});i.appendChild(M)}S.structures?.[D]&&P(D)},I=a?Math.max(h.findIndex(b=>b.drawId===a),0):0;a=void 0;const v=h.map(({drawName:b,drawId:S},U)=>({onClick:()=>{Qf({tournamentId:t,eventId:e,drawId:S}),g(U)},isActive:U===I,label:b,close:!0})),w={label:h?.[I]?.drawName,options:v,modifyLabel:!0,id:"flightButton",selection:!0,location:Lp},y=um({button:w,stateChange:o});i.appendChild(y),g(I)})}function sp(t){if(t)for(;t.firstChild;)t.removeChild(t.firstChild)}function m8e(t,e,i,r,n){if(n){const a=e.target.value;n(a)?(r.innerHTML="",r.classList.remove("is-danger"),i.classList.remove("is-danger"),i.classList.add("is-success")):(r.innerHTML=t.error||"Invalid",i.classList.remove("is-success"),i.classList.add("is-danger"),r.classList.add("is-danger"))}}var qs="top",bl="bottom",wl="right",Ys="left",dH="auto",hT=[qs,bl,wl,Ys],WI="start",bw="end",h8e="clippingParents",Ufe="viewport",yy="popper",g8e="reference",pY=hT.reduce(function(t,e){return t.concat([e+"-"+WI,e+"-"+bw])},[]),Tfe=[].concat(hT,[dH]).reduce(function(t,e){return t.concat([e,e+"-"+WI,e+"-"+bw])},[]),I8e="beforeRead",v8e="read",y8e="afterRead",b8e="beforeMain",w8e="main",S8e="afterMain",U8e="beforeWrite",T8e="write",D8e="afterWrite",P8e=[I8e,v8e,y8e,b8e,w8e,S8e,U8e,T8e,D8e];function Nc(t){return t?(t.nodeName||"").toLowerCase():null}function ko(t){if(t==null)return window;if(t.toString()!=="[object Window]"){var e=t.ownerDocument;return e&&e.defaultView||window}return t}function Zm(t){var e=ko(t).Element;return t instanceof e||t instanceof Element}function el(t){var e=ko(t).HTMLElement;return t instanceof e||t instanceof HTMLElement}function pH(t){if(typeof ShadowRoot>"u")return!1;var e=ko(t).ShadowRoot;return t instanceof e||t instanceof ShadowRoot}function E8e(t){var e=t.state;Object.keys(e.elements).forEach(function(i){var r=e.styles[i]||{},n=e.attributes[i]||{},a=e.elements[i];!el(a)||!Nc(a)||(Object.assign(a.style,r),Object.keys(n).forEach(function(s){var o=n[s];o===!1?a.removeAttribute(s):a.setAttribute(s,o===!0?"":o)}))})}function R8e(t){var e=t.state,i={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(e.elements.popper.style,i.popper),e.styles=i,e.elements.arrow&&Object.assign(e.elements.arrow.style,i.arrow),function(){Object.keys(e.elements).forEach(function(r){var n=e.elements[r],a=e.attributes[r]||{},s=Object.keys(e.styles.hasOwnProperty(r)?e.styles[r]:i[r]),o=s.reduce(function(l,u){return l[u]="",l},{});!el(n)||!Nc(n)||(Object.assign(n.style,o),Object.keys(a).forEach(function(l){n.removeAttribute(l)}))})}}const Dfe={name:"applyStyles",enabled:!0,phase:"write",fn:E8e,effect:R8e,requires:["computeStyles"]};function nc(t){return t.split("-")[0]}var Tm=Math.max,CE=Math.min,zI=Math.round;function h1(){var t=navigator.userAgentData;return t!=null&&t.brands&&Array.isArray(t.brands)?t.brands.map(function(e){return e.brand+"/"+e.version}).join(" "):navigator.userAgent}function Pfe(){return!/^((?!chrome|android).)*safari/i.test(h1())}function qI(t,e,i){e===void 0&&(e=!1),i===void 0&&(i=!1);var r=t.getBoundingClientRect(),n=1,a=1;e&&el(t)&&(n=t.offsetWidth>0&&zI(r.width)/t.offsetWidth||1,a=t.offsetHeight>0&&zI(r.height)/t.offsetHeight||1);var s=Zm(t)?ko(t):window,o=s.visualViewport,l=!Pfe()&&i,u=(r.left+(l&&o?o.offsetLeft:0))/n,c=(r.top+(l&&o?o.offsetTop:0))/a,d=r.width/n,p=r.height/a;return{width:d,height:p,top:c,right:u+d,bottom:c+p,left:u,x:u,y:c}}function fH(t){var e=qI(t),i=t.offsetWidth,r=t.offsetHeight;return Math.abs(e.width-i)<=1&&(i=e.width),Math.abs(e.height-r)<=1&&(r=e.height),{x:t.offsetLeft,y:t.offsetTop,width:i,height:r}}function Efe(t,e){var i=e.getRootNode&&e.getRootNode();if(t.contains(e))return!0;if(i&&pH(i)){var r=e;do{if(r&&t.isSameNode(r))return!0;r=r.parentNode||r.host}while(r)}return!1}function kd(t){return ko(t).getComputedStyle(t)}function C8e(t){return["table","td","th"].indexOf(Nc(t))>=0}function Mf(t){return((Zm(t)?t.ownerDocument:t.document)||window.document).documentElement}function SA(t){return Nc(t)==="html"?t:t.assignedSlot||t.parentNode||(pH(t)?t.host:null)||Mf(t)}function fY(t){return!el(t)||kd(t).position==="fixed"?null:t.offsetParent}function M8e(t){var e=/firefox/i.test(h1()),i=/Trident/i.test(h1());if(i&&el(t)){var r=kd(t);if(r.position==="fixed")return null}var n=SA(t);for(pH(n)&&(n=n.host);el(n)&&["html","body"].indexOf(Nc(n))<0;){var a=kd(n);if(a.transform!=="none"||a.perspective!=="none"||a.contain==="paint"||["transform","perspective"].indexOf(a.willChange)!==-1||e&&a.willChange==="filter"||e&&a.filter&&a.filter!=="none")return n;n=n.parentNode}return null}function gT(t){for(var e=ko(t),i=fY(t);i&&C8e(i)&&kd(i).position==="static";)i=fY(i);return i&&(Nc(i)==="html"||Nc(i)==="body"&&kd(i).position==="static")?e:i||M8e(t)||e}function mH(t){return["top","bottom"].indexOf(t)>=0?"x":"y"}function nb(t,e,i){return Tm(t,CE(e,i))}function N8e(t,e,i){var r=nb(t,e,i);return r>i?i:r}function Rfe(){return{top:0,right:0,bottom:0,left:0}}function Cfe(t){return Object.assign({},Rfe(),t)}function Mfe(t,e){return e.reduce(function(i,r){return i[r]=t,i},{})}var A8e=function(e,i){return e=typeof e=="function"?e(Object.assign({},i.rects,{placement:i.placement})):e,Cfe(typeof e!="number"?e:Mfe(e,hT))};function k8e(t){var e,i=t.state,r=t.name,n=t.options,a=i.elements.arrow,s=i.modifiersData.popperOffsets,o=nc(i.placement),l=mH(o),u=[Ys,wl].indexOf(o)>=0,c=u?"height":"width";if(!(!a||!s)){var d=A8e(n.padding,i),p=fH(a),f=l==="y"?qs:Ys,m=l==="y"?bl:wl,h=i.rects.reference[c]+i.rects.reference[l]-s[l]-i.rects.popper[c],g=s[l]-i.rects.reference[l],I=gT(a),v=I?l==="y"?I.clientHeight||0:I.clientWidth||0:0,w=h/2-g/2,y=d[f],b=v-p[c]-d[m],S=v/2-p[c]/2+w,U=nb(y,S,b),T=l;i.modifiersData[r]=(e={},e[T]=U,e.centerOffset=U-S,e)}}function O8e(t){var e=t.state,i=t.options,r=i.element,n=r===void 0?"[data-popper-arrow]":r;n!=null&&(typeof n=="string"&&(n=e.elements.popper.querySelector(n),!n)||Efe(e.elements.popper,n)&&(e.elements.arrow=n))}const x8e={name:"arrow",enabled:!0,phase:"main",fn:k8e,effect:O8e,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function YI(t){return t.split("-")[1]}var F8e={top:"auto",right:"auto",bottom:"auto",left:"auto"};function L8e(t,e){var i=t.x,r=t.y,n=e.devicePixelRatio||1;return{x:zI(i*n)/n||0,y:zI(r*n)/n||0}}function mY(t){var e,i=t.popper,r=t.popperRect,n=t.placement,a=t.variation,s=t.offsets,o=t.position,l=t.gpuAcceleration,u=t.adaptive,c=t.roundOffsets,d=t.isFixed,p=s.x,f=p===void 0?0:p,m=s.y,h=m===void 0?0:m,g=typeof c=="function"?c({x:f,y:h}):{x:f,y:h};f=g.x,h=g.y;var I=s.hasOwnProperty("x"),v=s.hasOwnProperty("y"),w=Ys,y=qs,b=window;if(u){var S=gT(i),U="clientHeight",T="clientWidth";if(S===ko(i)&&(S=Mf(i),kd(S).position!=="static"&&o==="absolute"&&(U="scrollHeight",T="scrollWidth")),S=S,n===qs||(n===Ys||n===wl)&&a===bw){y=bl;var P=d&&S===b&&b.visualViewport?b.visualViewport.height:S[U];h-=P-r.height,h*=l?1:-1}if(n===Ys||(n===qs||n===bl)&&a===bw){w=wl;var D=d&&S===b&&b.visualViewport?b.visualViewport.width:S[T];f-=D-r.width,f*=l?1:-1}}var E=Object.assign({position:o},u&&F8e),R=c===!0?L8e({x:f,y:h},ko(i)):{x:f,y:h};if(f=R.x,h=R.y,l){var C;return Object.assign({},E,(C={},C[y]=v?"0":"",C[w]=I?"0":"",C.transform=(b.devicePixelRatio||1)<=1?"translate("+f+"px, "+h+"px)":"translate3d("+f+"px, "+h+"px, 0)",C))}return Object.assign({},E,(e={},e[y]=v?h+"px":"",e[w]=I?f+"px":"",e.transform="",e))}function _8e(t){var e=t.state,i=t.options,r=i.gpuAcceleration,n=r===void 0?!0:r,a=i.adaptive,s=a===void 0?!0:a,o=i.roundOffsets,l=o===void 0?!0:o,u={placement:nc(e.placement),variation:YI(e.placement),popper:e.elements.popper,popperRect:e.rects.popper,gpuAcceleration:n,isFixed:e.options.strategy==="fixed"};e.modifiersData.popperOffsets!=null&&(e.styles.popper=Object.assign({},e.styles.popper,mY(Object.assign({},u,{offsets:e.modifiersData.popperOffsets,position:e.options.strategy,adaptive:s,roundOffsets:l})))),e.modifiersData.arrow!=null&&(e.styles.arrow=Object.assign({},e.styles.arrow,mY(Object.assign({},u,{offsets:e.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:l})))),e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-placement":e.placement})}const $8e={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:_8e,data:{}};var BT={passive:!0};function B8e(t){var e=t.state,i=t.instance,r=t.options,n=r.scroll,a=n===void 0?!0:n,s=r.resize,o=s===void 0?!0:s,l=ko(e.elements.popper),u=[].concat(e.scrollParents.reference,e.scrollParents.popper);return a&&u.forEach(function(c){c.addEventListener("scroll",i.update,BT)}),o&&l.addEventListener("resize",i.update,BT),function(){a&&u.forEach(function(c){c.removeEventListener("scroll",i.update,BT)}),o&&l.removeEventListener("resize",i.update,BT)}}const V8e={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:B8e,data:{}};var j8e={left:"right",right:"left",bottom:"top",top:"bottom"};function MD(t){return t.replace(/left|right|bottom|top/g,function(e){return j8e[e]})}var G8e={start:"end",end:"start"};function hY(t){return t.replace(/start|end/g,function(e){return G8e[e]})}function hH(t){var e=ko(t),i=e.pageXOffset,r=e.pageYOffset;return{scrollLeft:i,scrollTop:r}}function gH(t){return qI(Mf(t)).left+hH(t).scrollLeft}function H8e(t,e){var i=ko(t),r=Mf(t),n=i.visualViewport,a=r.clientWidth,s=r.clientHeight,o=0,l=0;if(n){a=n.width,s=n.height;var u=Pfe();(u||!u&&e==="fixed")&&(o=n.offsetLeft,l=n.offsetTop)}return{width:a,height:s,x:o+gH(t),y:l}}function W8e(t){var e,i=Mf(t),r=hH(t),n=(e=t.ownerDocument)==null?void 0:e.body,a=Tm(i.scrollWidth,i.clientWidth,n?n.scrollWidth:0,n?n.clientWidth:0),s=Tm(i.scrollHeight,i.clientHeight,n?n.scrollHeight:0,n?n.clientHeight:0),o=-r.scrollLeft+gH(t),l=-r.scrollTop;return kd(n||i).direction==="rtl"&&(o+=Tm(i.clientWidth,n?n.clientWidth:0)-a),{width:a,height:s,x:o,y:l}}function IH(t){var e=kd(t),i=e.overflow,r=e.overflowX,n=e.overflowY;return/auto|scroll|overlay|hidden/.test(i+n+r)}function Nfe(t){return["html","body","#document"].indexOf(Nc(t))>=0?t.ownerDocument.body:el(t)&&IH(t)?t:Nfe(SA(t))}function ab(t,e){var i;e===void 0&&(e=[]);var r=Nfe(t),n=r===((i=t.ownerDocument)==null?void 0:i.body),a=ko(r),s=n?[a].concat(a.visualViewport||[],IH(r)?r:[]):r,o=e.concat(s);return n?o:o.concat(ab(SA(s)))}function g1(t){return Object.assign({},t,{left:t.x,top:t.y,right:t.x+t.width,bottom:t.y+t.height})}function z8e(t,e){var i=qI(t,!1,e==="fixed");return i.top=i.top+t.clientTop,i.left=i.left+t.clientLeft,i.bottom=i.top+t.clientHeight,i.right=i.left+t.clientWidth,i.width=t.clientWidth,i.height=t.clientHeight,i.x=i.left,i.y=i.top,i}function gY(t,e,i){return e===Ufe?g1(H8e(t,i)):Zm(e)?z8e(e,i):g1(W8e(Mf(t)))}function q8e(t){var e=ab(SA(t)),i=["absolute","fixed"].indexOf(kd(t).position)>=0,r=i&&el(t)?gT(t):t;return Zm(r)?e.filter(function(n){return Zm(n)&&Efe(n,r)&&Nc(n)!=="body"}):[]}function Y8e(t,e,i,r){var n=e==="clippingParents"?q8e(t):[].concat(e),a=[].concat(n,[i]),s=a[0],o=a.reduce(function(l,u){var c=gY(t,u,r);return l.top=Tm(c.top,l.top),l.right=CE(c.right,l.right),l.bottom=CE(c.bottom,l.bottom),l.left=Tm(c.left,l.left),l},gY(t,s,r));return o.width=o.right-o.left,o.height=o.bottom-o.top,o.x=o.left,o.y=o.top,o}function Afe(t){var e=t.reference,i=t.element,r=t.placement,n=r?nc(r):null,a=r?YI(r):null,s=e.x+e.width/2-i.width/2,o=e.y+e.height/2-i.height/2,l;switch(n){case qs:l={x:s,y:e.y-i.height};break;case bl:l={x:s,y:e.y+e.height};break;case wl:l={x:e.x+e.width,y:o};break;case Ys:l={x:e.x-i.width,y:o};break;default:l={x:e.x,y:e.y}}var u=n?mH(n):null;if(u!=null){var c=u==="y"?"height":"width";switch(a){case WI:l[u]=l[u]-(e[c]/2-i[c]/2);break;case bw:l[u]=l[u]+(e[c]/2-i[c]/2);break}}return l}function ww(t,e){e===void 0&&(e={});var i=e,r=i.placement,n=r===void 0?t.placement:r,a=i.strategy,s=a===void 0?t.strategy:a,o=i.boundary,l=o===void 0?h8e:o,u=i.rootBoundary,c=u===void 0?Ufe:u,d=i.elementContext,p=d===void 0?yy:d,f=i.altBoundary,m=f===void 0?!1:f,h=i.padding,g=h===void 0?0:h,I=Cfe(typeof g!="number"?g:Mfe(g,hT)),v=p===yy?g8e:yy,w=t.rects.popper,y=t.elements[m?v:p],b=Y8e(Zm(y)?y:y.contextElement||Mf(t.elements.popper),l,c,s),S=qI(t.elements.reference),U=Afe({reference:S,element:w,placement:n}),T=g1(Object.assign({},w,U)),P=p===yy?T:S,D={top:b.top-P.top+I.top,bottom:P.bottom-b.bottom+I.bottom,left:b.left-P.left+I.left,right:P.right-b.right+I.right},E=t.modifiersData.offset;if(p===yy&&E){var R=E[n];Object.keys(D).forEach(function(C){var M=[wl,bl].indexOf(C)>=0?1:-1,N=[qs,bl].indexOf(C)>=0?"y":"x";D[C]+=R[N]*M})}return D}function K8e(t,e){e===void 0&&(e={});var i=e,r=i.placement,n=i.boundary,a=i.rootBoundary,s=i.padding,o=i.flipVariations,l=i.allowedAutoPlacements,u=l===void 0?Tfe:l,c=YI(r),d=c?o?pY:pY.filter(function(m){return YI(m)===c}):hT,p=d.filter(function(m){return u.indexOf(m)>=0});p.length===0&&(p=d);var f=p.reduce(function(m,h){return m[h]=ww(t,{placement:h,boundary:n,rootBoundary:a,padding:s})[nc(h)],m},{});return Object.keys(f).sort(function(m,h){return f[m]-f[h]})}function X8e(t){if(nc(t)===dH)return[];var e=MD(t);return[hY(t),e,hY(e)]}function J8e(t){var e=t.state,i=t.options,r=t.name;if(!e.modifiersData[r]._skip){for(var n=i.mainAxis,a=n===void 0?!0:n,s=i.altAxis,o=s===void 0?!0:s,l=i.fallbackPlacements,u=i.padding,c=i.boundary,d=i.rootBoundary,p=i.altBoundary,f=i.flipVariations,m=f===void 0?!0:f,h=i.allowedAutoPlacements,g=e.options.placement,I=nc(g),v=I===g,w=l||(v||!m?[MD(g)]:X8e(g)),y=[g].concat(w).reduce(function(_,B){return _.concat(nc(B)===dH?K8e(e,{placement:B,boundary:c,rootBoundary:d,padding:u,flipVariations:m,allowedAutoPlacements:h}):B)},[]),b=e.rects.reference,S=e.rects.popper,U=new Map,T=!0,P=y[0],D=0;D<y.length;D++){var E=y[D],R=nc(E),C=YI(E)===WI,M=[qs,bl].indexOf(R)>=0,N=M?"width":"height",A=ww(e,{placement:E,boundary:c,rootBoundary:d,altBoundary:p,padding:u}),O=M?C?wl:Ys:C?bl:qs;b[N]>S[N]&&(O=MD(O));var k=MD(O),F=[];if(a&&F.push(A[R]<=0),o&&F.push(A[O]<=0,A[k]<=0),F.every(function(_){return _})){P=E,T=!1;break}U.set(E,F)}if(T)for(var x=m?3:1,L=function(B){var G=y.find(function(j){var K=U.get(j);if(K)return K.slice(0,B).every(function(Y){return Y})});if(G)return P=G,"break"},$=x;$>0;$--){var V=L($);if(V==="break")break}e.placement!==P&&(e.modifiersData[r]._skip=!0,e.placement=P,e.reset=!0)}}const Q8e={name:"flip",enabled:!0,phase:"main",fn:J8e,requiresIfExists:["offset"],data:{_skip:!1}};function IY(t,e,i){return i===void 0&&(i={x:0,y:0}),{top:t.top-e.height-i.y,right:t.right-e.width+i.x,bottom:t.bottom-e.height+i.y,left:t.left-e.width-i.x}}function vY(t){return[qs,wl,bl,Ys].some(function(e){return t[e]>=0})}function Z8e(t){var e=t.state,i=t.name,r=e.rects.reference,n=e.rects.popper,a=e.modifiersData.preventOverflow,s=ww(e,{elementContext:"reference"}),o=ww(e,{altBoundary:!0}),l=IY(s,r),u=IY(o,n,a),c=vY(l),d=vY(u);e.modifiersData[i]={referenceClippingOffsets:l,popperEscapeOffsets:u,isReferenceHidden:c,hasPopperEscaped:d},e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-reference-hidden":c,"data-popper-escaped":d})}const e9e={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:Z8e};function t9e(t,e,i){var r=nc(t),n=[Ys,qs].indexOf(r)>=0?-1:1,a=typeof i=="function"?i(Object.assign({},e,{placement:t})):i,s=a[0],o=a[1];return s=s||0,o=(o||0)*n,[Ys,wl].indexOf(r)>=0?{x:o,y:s}:{x:s,y:o}}function i9e(t){var e=t.state,i=t.options,r=t.name,n=i.offset,a=n===void 0?[0,0]:n,s=Tfe.reduce(function(c,d){return c[d]=t9e(d,e.rects,a),c},{}),o=s[e.placement],l=o.x,u=o.y;e.modifiersData.popperOffsets!=null&&(e.modifiersData.popperOffsets.x+=l,e.modifiersData.popperOffsets.y+=u),e.modifiersData[r]=s}const r9e={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:i9e};function n9e(t){var e=t.state,i=t.name;e.modifiersData[i]=Afe({reference:e.rects.reference,element:e.rects.popper,placement:e.placement})}const a9e={name:"popperOffsets",enabled:!0,phase:"read",fn:n9e,data:{}};function s9e(t){return t==="x"?"y":"x"}function o9e(t){var e=t.state,i=t.options,r=t.name,n=i.mainAxis,a=n===void 0?!0:n,s=i.altAxis,o=s===void 0?!1:s,l=i.boundary,u=i.rootBoundary,c=i.altBoundary,d=i.padding,p=i.tether,f=p===void 0?!0:p,m=i.tetherOffset,h=m===void 0?0:m,g=ww(e,{boundary:l,rootBoundary:u,padding:d,altBoundary:c}),I=nc(e.placement),v=YI(e.placement),w=!v,y=mH(I),b=s9e(y),S=e.modifiersData.popperOffsets,U=e.rects.reference,T=e.rects.popper,P=typeof h=="function"?h(Object.assign({},e.rects,{placement:e.placement})):h,D=typeof P=="number"?{mainAxis:P,altAxis:P}:Object.assign({mainAxis:0,altAxis:0},P),E=e.modifiersData.offset?e.modifiersData.offset[e.placement]:null,R={x:0,y:0};if(S){if(a){var C,M=y==="y"?qs:Ys,N=y==="y"?bl:wl,A=y==="y"?"height":"width",O=S[y],k=O+g[M],F=O-g[N],x=f?-T[A]/2:0,L=v===WI?U[A]:T[A],$=v===WI?-T[A]:-U[A],V=e.elements.arrow,_=f&&V?fH(V):{width:0,height:0},B=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:Rfe(),G=B[M],j=B[N],K=nb(0,U[A],_[A]),Y=w?U[A]/2-x-K-G-D.mainAxis:L-K-G-D.mainAxis,X=w?-U[A]/2+x+K+j+D.mainAxis:$+K+j+D.mainAxis,Z=e.elements.arrow&&gT(e.elements.arrow),J=Z?y==="y"?Z.clientTop||0:Z.clientLeft||0:0,ae=(C=E?.[y])!=null?C:0,te=O+Y-ae-J,ne=O+X-ae,le=nb(f?CE(k,te):k,O,f?Tm(F,ne):F);S[y]=le,R[y]=le-O}if(o){var de,pe=y==="x"?qs:Ys,ge=y==="x"?bl:wl,Me=S[b],Pe=b==="y"?"height":"width",Be=Me+g[pe],fe=Me-g[ge],Te=[qs,Ys].indexOf(I)!==-1,ce=(de=E?.[b])!=null?de:0,ye=Te?Be:Me-U[Pe]-T[Pe]-ce+D.altAxis,be=Te?Me+U[Pe]+T[Pe]-ce-D.altAxis:fe,Fe=f&&Te?N8e(ye,Me,be):nb(f?ye:Be,Me,f?be:fe);S[b]=Fe,R[b]=Fe-Me}e.modifiersData[r]=R}}const l9e={name:"preventOverflow",enabled:!0,phase:"main",fn:o9e,requiresIfExists:["offset"]};function u9e(t){return{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}}function c9e(t){return t===ko(t)||!el(t)?hH(t):u9e(t)}function d9e(t){var e=t.getBoundingClientRect(),i=zI(e.width)/t.offsetWidth||1,r=zI(e.height)/t.offsetHeight||1;return i!==1||r!==1}function p9e(t,e,i){i===void 0&&(i=!1);var r=el(e),n=el(e)&&d9e(e),a=Mf(e),s=qI(t,n,i),o={scrollLeft:0,scrollTop:0},l={x:0,y:0};return(r||!r&&!i)&&((Nc(e)!=="body"||IH(a))&&(o=c9e(e)),el(e)?(l=qI(e,!0),l.x+=e.clientLeft,l.y+=e.clientTop):a&&(l.x=gH(a))),{x:s.left+o.scrollLeft-l.x,y:s.top+o.scrollTop-l.y,width:s.width,height:s.height}}function f9e(t){var e=new Map,i=new Set,r=[];t.forEach(function(a){e.set(a.name,a)});function n(a){i.add(a.name);var s=[].concat(a.requires||[],a.requiresIfExists||[]);s.forEach(function(o){if(!i.has(o)){var l=e.get(o);l&&n(l)}}),r.push(a)}return t.forEach(function(a){i.has(a.name)||n(a)}),r}function m9e(t){var e=f9e(t);return P8e.reduce(function(i,r){return i.concat(e.filter(function(n){return n.phase===r}))},[])}function h9e(t){var e;return function(){return e||(e=new Promise(function(i){Promise.resolve().then(function(){e=void 0,i(t())})})),e}}function g9e(t){var e=t.reduce(function(i,r){var n=i[r.name];return i[r.name]=n?Object.assign({},n,r,{options:Object.assign({},n.options,r.options),data:Object.assign({},n.data,r.data)}):r,i},{});return Object.keys(e).map(function(i){return e[i]})}var yY={placement:"bottom",modifiers:[],strategy:"absolute"};function bY(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return!e.some(function(r){return!(r&&typeof r.getBoundingClientRect=="function")})}function I9e(t){t===void 0&&(t={});var e=t,i=e.defaultModifiers,r=i===void 0?[]:i,n=e.defaultOptions,a=n===void 0?yY:n;return function(o,l,u){u===void 0&&(u=a);var c={placement:"bottom",orderedModifiers:[],options:Object.assign({},yY,a),modifiersData:{},elements:{reference:o,popper:l},attributes:{},styles:{}},d=[],p=!1,f={state:c,setOptions:function(I){var v=typeof I=="function"?I(c.options):I;h(),c.options=Object.assign({},a,c.options,v),c.scrollParents={reference:Zm(o)?ab(o):o.contextElement?ab(o.contextElement):[],popper:ab(l)};var w=m9e(g9e([].concat(r,c.options.modifiers)));return c.orderedModifiers=w.filter(function(y){return y.enabled}),m(),f.update()},forceUpdate:function(){if(!p){var I=c.elements,v=I.reference,w=I.popper;if(bY(v,w)){c.rects={reference:p9e(v,gT(w),c.options.strategy==="fixed"),popper:fH(w)},c.reset=!1,c.placement=c.options.placement,c.orderedModifiers.forEach(function(D){return c.modifiersData[D.name]=Object.assign({},D.data)});for(var y=0;y<c.orderedModifiers.length;y++){if(c.reset===!0){c.reset=!1,y=-1;continue}var b=c.orderedModifiers[y],S=b.fn,U=b.options,T=U===void 0?{}:U,P=b.name;typeof S=="function"&&(c=S({state:c,options:T,name:P,instance:f})||c)}}}},update:h9e(function(){return new Promise(function(g){f.forceUpdate(),g(c)})}),destroy:function(){h(),p=!0}};if(!bY(o,l))return f;f.setOptions(u).then(function(g){!p&&u.onFirstUpdate&&u.onFirstUpdate(g)});function m(){c.orderedModifiers.forEach(function(g){var I=g.name,v=g.options,w=v===void 0?{}:v,y=g.effect;if(typeof y=="function"){var b=y({state:c,name:I,instance:f,options:w}),S=function(){};d.push(b||S)}})}function h(){d.forEach(function(g){return g()}),d=[]}return f}}var v9e=[V8e,a9e,$8e,Dfe,r9e,Q8e,l9e,x8e,e9e],y9e=I9e({defaultModifiers:v9e}),b9e="tippy-box",kfe="tippy-content",w9e="tippy-backdrop",Ofe="tippy-arrow",xfe="tippy-svg-arrow",jf={passive:!0,capture:!0},Ffe=function(){return document.body};function Ak(t,e,i){if(Array.isArray(t)){var r=t[e];return r??(Array.isArray(i)?i[e]:i)}return t}function vH(t,e){var i={}.toString.call(t);return i.indexOf("[object")===0&&i.indexOf(e+"]")>-1}function Lfe(t,e){return typeof t=="function"?t.apply(void 0,e):t}function wY(t,e){if(e===0)return t;var i;return function(r){clearTimeout(i),i=setTimeout(function(){t(r)},e)}}function S9e(t){return t.split(/\s+/).filter(Boolean)}function Ug(t){return[].concat(t)}function SY(t,e){t.indexOf(e)===-1&&t.push(e)}function U9e(t){return t.filter(function(e,i){return t.indexOf(e)===i})}function T9e(t){return t.split("-")[0]}function ME(t){return[].slice.call(t)}function UY(t){return Object.keys(t).reduce(function(e,i){return t[i]!==void 0&&(e[i]=t[i]),e},{})}function sb(){return document.createElement("div")}function UA(t){return["Element","Fragment"].some(function(e){return vH(t,e)})}function D9e(t){return vH(t,"NodeList")}function P9e(t){return vH(t,"MouseEvent")}function E9e(t){return!!(t&&t._tippy&&t._tippy.reference===t)}function R9e(t){return UA(t)?[t]:D9e(t)?ME(t):Array.isArray(t)?t:ME(document.querySelectorAll(t))}function kk(t,e){t.forEach(function(i){i&&(i.style.transitionDuration=e+"ms")})}function TY(t,e){t.forEach(function(i){i&&i.setAttribute("data-state",e)})}function C9e(t){var e,i=Ug(t),r=i[0];return r!=null&&(e=r.ownerDocument)!=null&&e.body?r.ownerDocument:document}function M9e(t,e){var i=e.clientX,r=e.clientY;return t.every(function(n){var a=n.popperRect,s=n.popperState,o=n.props,l=o.interactiveBorder,u=T9e(s.placement),c=s.modifiersData.offset;if(!c)return!0;var d=u==="bottom"?c.top.y:0,p=u==="top"?c.bottom.y:0,f=u==="right"?c.left.x:0,m=u==="left"?c.right.x:0,h=a.top-r+d>l,g=r-a.bottom-p>l,I=a.left-i+f>l,v=i-a.right-m>l;return h||g||I||v})}function Ok(t,e,i){var r=e+"EventListener";["transitionend","webkitTransitionEnd"].forEach(function(n){t[r](n,i)})}function DY(t,e){for(var i=e;i;){var r;if(t.contains(i))return!0;i=i.getRootNode==null||(r=i.getRootNode())==null?void 0:r.host}return!1}var Bu={isTouch:!1},PY=0;function N9e(){Bu.isTouch||(Bu.isTouch=!0,window.performance&&document.addEventListener("mousemove",_fe))}function _fe(){var t=performance.now();t-PY<20&&(Bu.isTouch=!1,document.removeEventListener("mousemove",_fe)),PY=t}function A9e(){var t=document.activeElement;if(E9e(t)){var e=t._tippy;t.blur&&!e.state.isVisible&&t.blur()}}function k9e(){document.addEventListener("touchstart",N9e,jf),window.addEventListener("blur",A9e)}var O9e=typeof window<"u"&&typeof document<"u",x9e=O9e?!!window.msCrypto:!1,F9e={animateFill:!1,followCursor:!1,inlinePositioning:!1,sticky:!1},L9e={allowHTML:!1,animation:"fade",arrow:!0,content:"",inertia:!1,maxWidth:350,role:"tooltip",theme:"",zIndex:9999},Bl=Object.assign({appendTo:Ffe,aria:{content:"auto",expanded:"auto"},delay:0,duration:[300,250],getReferenceClientRect:null,hideOnClick:!0,ignoreAttributes:!1,interactive:!1,interactiveBorder:2,interactiveDebounce:0,moveTransition:"",offset:[0,10],onAfterUpdate:function(){},onBeforeUpdate:function(){},onCreate:function(){},onDestroy:function(){},onHidden:function(){},onHide:function(){},onMount:function(){},onShow:function(){},onShown:function(){},onTrigger:function(){},onUntrigger:function(){},onClickOutside:function(){},placement:"top",plugins:[],popperOptions:{},render:null,showOnCreate:!1,touch:!0,trigger:"mouseenter focus",triggerTarget:null},F9e,L9e),_9e=Object.keys(Bl),$9e=function(e){var i=Object.keys(e);i.forEach(function(r){Bl[r]=e[r]})};function $fe(t){var e=t.plugins||[],i=e.reduce(function(r,n){var a=n.name,s=n.defaultValue;if(a){var o;r[a]=t[a]!==void 0?t[a]:(o=Bl[a])!=null?o:s}return r},{});return Object.assign({},t,i)}function B9e(t,e){var i=e?Object.keys($fe(Object.assign({},Bl,{plugins:e}))):_9e,r=i.reduce(function(n,a){var s=(t.getAttribute("data-tippy-"+a)||"").trim();if(!s)return n;if(a==="content")n[a]=s;else try{n[a]=JSON.parse(s)}catch{n[a]=s}return n},{});return r}function EY(t,e){var i=Object.assign({},e,{content:Lfe(e.content,[t])},e.ignoreAttributes?{}:B9e(t,e.plugins));return i.aria=Object.assign({},Bl.aria,i.aria),i.aria={expanded:i.aria.expanded==="auto"?e.interactive:i.aria.expanded,content:i.aria.content==="auto"?e.interactive?null:"describedby":i.aria.content},i}var V9e=function(){return"innerHTML"};function I1(t,e){t[V9e()]=e}function RY(t){var e=sb();return t===!0?e.className=Ofe:(e.className=xfe,UA(t)?e.appendChild(t):I1(e,t)),e}function CY(t,e){UA(e.content)?(I1(t,""),t.appendChild(e.content)):typeof e.content!="function"&&(e.allowHTML?I1(t,e.content):t.textContent=e.content)}function v1(t){var e=t.firstElementChild,i=ME(e.children);return{box:e,content:i.find(function(r){return r.classList.contains(kfe)}),arrow:i.find(function(r){return r.classList.contains(Ofe)||r.classList.contains(xfe)}),backdrop:i.find(function(r){return r.classList.contains(w9e)})}}function Bfe(t){var e=sb(),i=sb();i.className=b9e,i.setAttribute("data-state","hidden"),i.setAttribute("tabindex","-1");var r=sb();r.className=kfe,r.setAttribute("data-state","hidden"),CY(r,t.props),e.appendChild(i),i.appendChild(r),n(t.props,t.props);function n(a,s){var o=v1(e),l=o.box,u=o.content,c=o.arrow;s.theme?l.setAttribute("data-theme",s.theme):l.removeAttribute("data-theme"),typeof s.animation=="string"?l.setAttribute("data-animation",s.animation):l.removeAttribute("data-animation"),s.inertia?l.setAttribute("data-inertia",""):l.removeAttribute("data-inertia"),l.style.maxWidth=typeof s.maxWidth=="number"?s.maxWidth+"px":s.maxWidth,s.role?l.setAttribute("role",s.role):l.removeAttribute("role"),(a.content!==s.content||a.allowHTML!==s.allowHTML)&&CY(u,t.props),s.arrow?c?a.arrow!==s.arrow&&(l.removeChild(c),l.appendChild(RY(s.arrow))):l.appendChild(RY(s.arrow)):c&&l.removeChild(c)}return{popper:e,onUpdate:n}}Bfe.$$tippy=!0;var j9e=1,VT=[],xk=[];function G9e(t,e){var i=EY(t,Object.assign({},Bl,$fe(UY(e)))),r,n,a,s=!1,o=!1,l=!1,u=!1,c,d,p,f=[],m=wY(te,i.interactiveDebounce),h,g=j9e++,I=null,v=U9e(i.plugins),w={isEnabled:!0,isVisible:!1,isDestroyed:!1,isMounted:!1,isShown:!1},y={id:g,reference:t,popper:sb(),popperInstance:I,props:i,state:w,plugins:v,clearDelayTimeouts:ye,setProps:be,setContent:Fe,show:we,hide:Ne,hideWithInteractivity:me,enable:Te,disable:ce,unmount:Ee,destroy:Le};if(!i.render)return y;var b=i.render(y),S=b.popper,U=b.onUpdate;S.setAttribute("data-tippy-root",""),S.id="tippy-"+y.id,y.popper=S,t._tippy=y,S._tippy=y;var T=v.map(function(Q){return Q.fn(y)}),P=t.hasAttribute("aria-expanded");return Z(),x(),O(),k("onCreate",[y]),i.showOnCreate&&Be(),S.addEventListener("mouseenter",function(){y.props.interactive&&y.state.isVisible&&y.clearDelayTimeouts()}),S.addEventListener("mouseleave",function(){y.props.interactive&&y.props.trigger.indexOf("mouseenter")>=0&&M().addEventListener("mousemove",m)}),y;function D(){var Q=y.props.touch;return Array.isArray(Q)?Q:[Q,0]}function E(){return D()[0]==="hold"}function R(){var Q;return!!((Q=y.props.render)!=null&&Q.$$tippy)}function C(){return h||t}function M(){var Q=C().parentNode;return Q?C9e(Q):document}function N(){return v1(S)}function A(Q){return y.state.isMounted&&!y.state.isVisible||Bu.isTouch||c&&c.type==="focus"?0:Ak(y.props.delay,Q?0:1,Bl.delay)}function O(Q){Q===void 0&&(Q=!1),S.style.pointerEvents=y.props.interactive&&!Q?"":"none",S.style.zIndex=""+y.props.zIndex}function k(Q,se,oe){if(oe===void 0&&(oe=!0),T.forEach(function(ee){ee[Q]&&ee[Q].apply(ee,se)}),oe){var ue;(ue=y.props)[Q].apply(ue,se)}}function F(){var Q=y.props.aria;if(Q.content){var se="aria-"+Q.content,oe=S.id,ue=Ug(y.props.triggerTarget||t);ue.forEach(function(ee){var Se=ee.getAttribute(se);if(y.state.isVisible)ee.setAttribute(se,Se?Se+" "+oe:oe);else{var De=Se&&Se.replace(oe,"").trim();De?ee.setAttribute(se,De):ee.removeAttribute(se)}})}}function x(){if(!(P||!y.props.aria.expanded)){var Q=Ug(y.props.triggerTarget||t);Q.forEach(function(se){y.props.interactive?se.setAttribute("aria-expanded",y.state.isVisible&&se===C()?"true":"false"):se.removeAttribute("aria-expanded")})}}function L(){M().removeEventListener("mousemove",m),VT=VT.filter(function(Q){return Q!==m})}function $(Q){if(!(Bu.isTouch&&(l||Q.type==="mousedown"))){var se=Q.composedPath&&Q.composedPath()[0]||Q.target;if(!(y.props.interactive&&DY(S,se))){if(Ug(y.props.triggerTarget||t).some(function(oe){return DY(oe,se)})){if(Bu.isTouch||y.state.isVisible&&y.props.trigger.indexOf("click")>=0)return}else k("onClickOutside",[y,Q]);y.props.hideOnClick===!0&&(y.clearDelayTimeouts(),y.hide(),o=!0,setTimeout(function(){o=!1}),y.state.isMounted||G())}}}function V(){l=!0}function _(){l=!1}function B(){var Q=M();Q.addEventListener("mousedown",$,!0),Q.addEventListener("touchend",$,jf),Q.addEventListener("touchstart",_,jf),Q.addEventListener("touchmove",V,jf)}function G(){var Q=M();Q.removeEventListener("mousedown",$,!0),Q.removeEventListener("touchend",$,jf),Q.removeEventListener("touchstart",_,jf),Q.removeEventListener("touchmove",V,jf)}function j(Q,se){Y(Q,function(){!y.state.isVisible&&S.parentNode&&S.parentNode.contains(S)&&se()})}function K(Q,se){Y(Q,se)}function Y(Q,se){var oe=N().box;function ue(ee){ee.target===oe&&(Ok(oe,"remove",ue),se())}if(Q===0)return se();Ok(oe,"remove",d),Ok(oe,"add",ue),d=ue}function X(Q,se,oe){oe===void 0&&(oe=!1);var ue=Ug(y.props.triggerTarget||t);ue.forEach(function(ee){ee.addEventListener(Q,se,oe),f.push({node:ee,eventType:Q,handler:se,options:oe})})}function Z(){E()&&(X("touchstart",ae,{passive:!0}),X("touchend",ne,{passive:!0})),S9e(y.props.trigger).forEach(function(Q){if(Q!=="manual")switch(X(Q,ae),Q){case"mouseenter":X("mouseleave",ne);break;case"focus":X(x9e?"focusout":"blur",le);break;case"focusin":X("focusout",le);break}})}function J(){f.forEach(function(Q){var se=Q.node,oe=Q.eventType,ue=Q.handler,ee=Q.options;se.removeEventListener(oe,ue,ee)}),f=[]}function ae(Q){var se,oe=!1;if(!(!y.state.isEnabled||de(Q)||o)){var ue=((se=c)==null?void 0:se.type)==="focus";c=Q,h=Q.currentTarget,x(),!y.state.isVisible&&P9e(Q)&&VT.forEach(function(ee){return ee(Q)}),Q.type==="click"&&(y.props.trigger.indexOf("mouseenter")<0||s)&&y.props.hideOnClick!==!1&&y.state.isVisible?oe=!0:Be(Q),Q.type==="click"&&(s=!oe),oe&&!ue&&fe(Q)}}function te(Q){var se=Q.target,oe=C().contains(se)||S.contains(se);if(!(Q.type==="mousemove"&&oe)){var ue=Pe().concat(S).map(function(ee){var Se,De=ee._tippy,it=(Se=De.popperInstance)==null?void 0:Se.state;return it?{popperRect:ee.getBoundingClientRect(),popperState:it,props:i}:null}).filter(Boolean);M9e(ue,Q)&&(L(),fe(Q))}}function ne(Q){var se=de(Q)||y.props.trigger.indexOf("click")>=0&&s;if(!se){if(y.props.interactive){y.hideWithInteractivity(Q);return}fe(Q)}}function le(Q){y.props.trigger.indexOf("focusin")<0&&Q.target!==C()||y.props.interactive&&Q.relatedTarget&&S.contains(Q.relatedTarget)||fe(Q)}function de(Q){return Bu.isTouch?E()!==Q.type.indexOf("touch")>=0:!1}function pe(){ge();var Q=y.props,se=Q.popperOptions,oe=Q.placement,ue=Q.offset,ee=Q.getReferenceClientRect,Se=Q.moveTransition,De=R()?v1(S).arrow:null,it=ee?{getBoundingClientRect:ee,contextElement:ee.contextElement||C()}:t,Ue={name:"$$tippy",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:function(qe){var bi=qe.state;if(R()){var oi=N(),nn=oi.box;["placement","reference-hidden","escaped"].forEach(function(Fo){Fo==="placement"?nn.setAttribute("data-placement",bi.placement):bi.attributes.popper["data-popper-"+Fo]?nn.setAttribute("data-"+Fo,""):nn.removeAttribute("data-"+Fo)}),bi.attributes.popper={}}}},ut=[{name:"offset",options:{offset:ue}},{name:"preventOverflow",options:{padding:{top:2,bottom:2,left:5,right:5}}},{name:"flip",options:{padding:5}},{name:"computeStyles",options:{adaptive:!Se}},Ue];R()&&De&&ut.push({name:"arrow",options:{element:De,padding:3}}),ut.push.apply(ut,se?.modifiers||[]),y.popperInstance=y9e(it,S,Object.assign({},se,{placement:oe,onFirstUpdate:p,modifiers:ut}))}function ge(){y.popperInstance&&(y.popperInstance.destroy(),y.popperInstance=null)}function Me(){var Q=y.props.appendTo,se,oe=C();y.props.interactive&&Q===Ffe||Q==="parent"?se=oe.parentNode:se=Lfe(Q,[oe]),se.contains(S)||se.appendChild(S),y.state.isMounted=!0,pe()}function Pe(){return ME(S.querySelectorAll("[data-tippy-root]"))}function Be(Q){y.clearDelayTimeouts(),Q&&k("onTrigger",[y,Q]),B();var se=A(!0),oe=D(),ue=oe[0],ee=oe[1];Bu.isTouch&&ue==="hold"&&ee&&(se=ee),se?r=setTimeout(function(){y.show()},se):y.show()}function fe(Q){if(y.clearDelayTimeouts(),k("onUntrigger",[y,Q]),!y.state.isVisible){G();return}if(!(y.props.trigger.indexOf("mouseenter")>=0&&y.props.trigger.indexOf("click")>=0&&["mouseleave","mousemove"].indexOf(Q.type)>=0&&s)){var se=A(!1);se?n=setTimeout(function(){y.state.isVisible&&y.hide()},se):a=requestAnimationFrame(function(){y.hide()})}}function Te(){y.state.isEnabled=!0}function ce(){y.hide(),y.state.isEnabled=!1}function ye(){clearTimeout(r),clearTimeout(n),cancelAnimationFrame(a)}function be(Q){if(!y.state.isDestroyed){k("onBeforeUpdate",[y,Q]),J();var se=y.props,oe=EY(t,Object.assign({},se,UY(Q),{ignoreAttributes:!0}));y.props=oe,Z(),se.interactiveDebounce!==oe.interactiveDebounce&&(L(),m=wY(te,oe.interactiveDebounce)),se.triggerTarget&&!oe.triggerTarget?Ug(se.triggerTarget).forEach(function(ue){ue.removeAttribute("aria-expanded")}):oe.triggerTarget&&t.removeAttribute("aria-expanded"),x(),O(),U&&U(se,oe),y.popperInstance&&(pe(),Pe().forEach(function(ue){requestAnimationFrame(ue._tippy.popperInstance.forceUpdate)})),k("onAfterUpdate",[y,Q])}}function Fe(Q){y.setProps({content:Q})}function we(){var Q=y.state.isVisible,se=y.state.isDestroyed,oe=!y.state.isEnabled,ue=Bu.isTouch&&!y.props.touch,ee=Ak(y.props.duration,0,Bl.duration);if(!(Q||se||oe||ue)&&!C().hasAttribute("disabled")&&(k("onShow",[y],!1),y.props.onShow(y)!==!1)){if(y.state.isVisible=!0,R()&&(S.style.visibility="visible"),O(),B(),y.state.isMounted||(S.style.transition="none"),R()){var Se=N(),De=Se.box,it=Se.content;kk([De,it],0)}p=function(){var ut;if(!(!y.state.isVisible||u)){if(u=!0,S.offsetHeight,S.style.transition=y.props.moveTransition,R()&&y.props.animation){var yi=N(),qe=yi.box,bi=yi.content;kk([qe,bi],ee),TY([qe,bi],"visible")}F(),x(),SY(xk,y),(ut=y.popperInstance)==null||ut.forceUpdate(),k("onMount",[y]),y.props.animation&&R()&&K(ee,function(){y.state.isShown=!0,k("onShown",[y])})}},Me()}}function Ne(){var Q=!y.state.isVisible,se=y.state.isDestroyed,oe=!y.state.isEnabled,ue=Ak(y.props.duration,1,Bl.duration);if(!(Q||se||oe)&&(k("onHide",[y],!1),y.props.onHide(y)!==!1)){if(y.state.isVisible=!1,y.state.isShown=!1,u=!1,s=!1,R()&&(S.style.visibility="hidden"),L(),G(),O(!0),R()){var ee=N(),Se=ee.box,De=ee.content;y.props.animation&&(kk([Se,De],ue),TY([Se,De],"hidden"))}F(),x(),y.props.animation?R()&&j(ue,y.unmount):y.unmount()}}function me(Q){M().addEventListener("mousemove",m),SY(VT,m),m(Q)}function Ee(){y.state.isVisible&&y.hide(),y.state.isMounted&&(ge(),Pe().forEach(function(Q){Q._tippy.unmount()}),S.parentNode&&S.parentNode.removeChild(S),xk=xk.filter(function(Q){return Q!==y}),y.state.isMounted=!1,k("onHidden",[y]))}function Le(){y.state.isDestroyed||(y.clearDelayTimeouts(),y.unmount(),J(),delete t._tippy,y.state.isDestroyed=!0,k("onDestroy",[y]))}}function IT(t,e){e===void 0&&(e={});var i=Bl.plugins.concat(e.plugins||[]);k9e();var r=Object.assign({},e,{plugins:i}),n=R9e(t),a=n.reduce(function(s,o){var l=o&&G9e(o,r);return l&&s.push(l),s},[]);return UA(t)?a[0]:a}IT.defaultProps=Bl;IT.setDefaultProps=$9e;IT.currentInput=Bu;Object.assign({},Dfe,{effect:function(e){var i=e.state,r={popper:{position:i.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};Object.assign(i.elements.popper.style,r.popper),i.styles=r,i.elements.arrow&&Object.assign(i.elements.arrow.style,r.arrow)}});IT.setDefaultProps({render:Bfe});function MY(t){const e=document.createElement("button");return e.className="button font-medium",t.disabled&&(e.disabled=!0),t.class&&e.classList.add(t.class),t.id&&(e.id=t.id),t.location===Fm?e.style.marginLeft="1em":e.style.marginRight="1em",t.intent&&e.classList.add(t.intent),t.toolTip?.content&&IT(e,t.toolTip),e.innerHTML=t.label,t.visible===!1&&(e.style.display=Go),e}const H9e=({target:t})=>(e=[])=>{t.style.backgroundColor=e?.length?"var(--chc-active-bg)":zO;const i=(r,n,a)=>{const s=t.getElementsByClassName(`options_${r}`)[0];s&&(s.style.display=e?.length?n:a)};i(WO,TT,Go),i(Lp,Go,TT),i(Gi,Go,TT),i(Fm,Go,TT)};function W9e(t){const{table:e,targetClassName:i,items:r=[],onSelection:n}=t,a=!!t.target,s=t.target||i&&document.getElementsByClassName(i)?.[0];if(!s)return{};let o=0,l=0;const u={},c={};let d;if(a){sp(s);const I=z9e();Object.assign(u,I.elements),s.appendChild(I.anchor)}const p=Object.assign({},...[WO,Lp,Gi,Fm,ez].map(I=>{const v=s.getElementsByClassName(`options_${I}`)?.[0];return sp(v),{[I]:v}}).filter(Boolean)),f=H9e({target:s}),m=(I,v)=>{Wu(v.onClick)&&(I.stopPropagation(),!v.disabled&&v.onClick(I,e),v.stateChange&&f())},h={onClick:()=>{},location:Fm};for(const I of r){const v={...h};qO(I)&&Object.assign(v,I);const w=p[v.location];if(!w){console.log(v.location,p);continue}if(v.location===WO&&(o+=1),v.location===ez){if(Wu(v.headerClick)){const y=s.getElementsByClassName("panelHeader")[0];y&&(y.onclick=v.headerClick)}l+=1}if(!v.hide&&(v.input||v.placeholder||v.search)){const y=document.createElement("p");y.style.marginRight="1em",y.className=`control ${v.search?"has-icons-left has-icons-right":""}`;const b=document.createElement("input");if(v.focus&&(d=b),b.className="input font-medium",b.setAttribute("type","text"),b.setAttribute("autocomplete","cc-number"),b.setAttribute("placeholder",I.placeholder||zO),v.id&&(c[v.id]=b),v.id&&b.setAttribute("id",v.id),v.onKeyDown&&b.addEventListener("keydown",S=>v.onKeyDown(S,v)),v.onChange&&b.addEventListener("change",S=>v.onChange(S,v)),v.onKeyUp&&b.addEventListener("keyup",S=>{v.clearSearch&&S.key==="Escape"&&(S.stopPropagation(),b.value="",v.clearSearch()),v.onKeyUp(S,v)}),v.class&&b.classList.add(v.class),v.visible===!1&&(y.style.display=Go),v.value&&(b.value=v.value),y.appendChild(b),v.search){const S=document.createElement("span");if(S.className="icon is-small is-left font-medium",S.innerHTML='<i class="fa-solid fa-magnifying-glass"></i>',y.appendChild(S),Wu(v.clearSearch)){const U=document.createElement("span");U.className="icon is-small is-right font-medium",U.innerHTML='<i class="fa-solid fa-circle-xmark" style="color: #dddada; pointer-events: all; cursor: pointer"></i>',U.onclick=T=>{T.stopPropagation(),b.value="",v.clearSearch()},y.appendChild(U)}}if(I.validator){const S=document.createElement("p");S.className="help font-medium",y.appendChild(S),b.addEventListener("input",U=>m8e(I,U,b,S,I.validator))}v.id&&(u[v.id]=y,y.id=v.id),w?.appendChild(y);continue}if(!v.hide&&v.text){const y=document.createElement("div");y.className="font-medium",v.id&&(u[v.id]=y,y.id=v.id),y.innerHTML=v.text,y.onclick=b=>m(b,v),w?.appendChild(y);continue}if(!(!v.id&&(!v?.label||v.hide))){if(v.options){const y=um({target:w,button:v,stateChange:f});v.visible===!1&&(y.style.display=Go),v.id&&(u[v.id]=y)}else if(qO(v.selection)){const{selection:{options:y,actions:b},actionPlacement:S,threshold:U=8,...T}=v;if(y?.length<U){y.length&&(S===tz?y.unshift({divider:!0}):y.push({divider:!0})),b.forEach(E=>{const{label:R,...C}=E,M={...C,label:`<p style="font-weight: bold">${R}</p>`};S===tz?y.unshift(M):y.push(M)});const P={...T,options:y},D=um({target:w,button:P,stateChange:f});P.visible===!1&&(D.style.display=Go),P.id&&(u[v.id]=D)}else{const P=MY(v);P.onclick=D=>{D.stopPropagation()},v.id&&(u[v.id]=P),w?.appendChild(P)}}else{const y=MY(v);y.onclick=b=>m(b,v),v.id&&(u[v.id]=y),w?.appendChild(y)}(!v?.label||v.hide)&&(u[v.id].style.display=Go)}}const g=s.getElementsByClassName("panelHeader")[0];return g&&(g.style.display=l?zO:Go),e?.on("rowSelectionChanged",(I,v)=>{Wu(n)&&n(v),o&&f(v)}),f(),d&&setTimeout(()=>d.focus(),200),{elements:u,inputs:c}}function z9e(){const t=document.createElement("div");t.className="panel_container flexcol flexcenter";const e=document.createElement("div");e.className="panelHeader options_header",e.style.display=Go,t.appendChild(e);const i=document.createElement("div");i.className=EAe,i.style.flexWrap="wrap-reverse;";const r={optionsOverlay:document.createElement("div"),optionsLeft:document.createElement("div"),optionsCenter:document.createElement("div"),optionsRight:document.createElement("div")};r.optionsOverlay.className="options_overlay",r.optionsCenter.className="options_center",r.optionsRight.className="options_right",r.optionsLeft.className="options_left";for(const n of Object.values(r))i.appendChild(n);return t.appendChild(i),{elements:r,anchor:t,header:e}}function q9e(t){const e=EOe(t),i=[{onKeyDown:n=>n.keyCode===8&&n.target.value.length===1&&e(""),onChange:n=>e(n.target.value),onKeyUp:n=>e(n.target.value),clearSearch:()=>e(""),placeholder:"Search tournaments",location:Lp,search:!0}],r=document.getElementById(jY);W9e({target:r,items:i})}function Y9e(t){const e=document.createElement("span"),i=document.createElement("table"),r=t.getValue();i.style.width="400px";const n="4em",a=document.createElement("tr"),s=r.tournamentImageURL||r.onlineResources?.find(({name:u,resourceType:c})=>u==="tournamentImage"&&c==="URL")?.identifier,o=s?`<img src='${s}' style='width: ${n}' alt=''>`:"",l=`<td style='min-width: ${n}'>${o}</td><td><div style='margin-left: 1em'><strong style='font-size: 1.5em'>${r.tournamentName}</strong></div><div style='margin-left: 1em'>${r.startDate} / ${r.endDate}</div></td>`;return a.innerHTML=l,i.appendChild(a),e.appendChild(i),e}const Ku={};function K9e(){return[{formatter:Y9e,cellClick:(e,i)=>{const r=i.getRow().getData().tournamentId;if(r){const n=`/${FE}/${r}`;Ku.router.navigate(n)}},field:"tournament",headerSort:!1,resizable:!0,minWidth:250,widthGrow:3}]}function X9e({providerAbbr:t}){const e=o=>console.log("Network error",{error:o});let i;const r=({providerAbbr:o})=>{setTimeout(()=>{const u=c=>c?.data?.calendar&&i.replaceData(c.data.calendar);QO({providerAbbr:o}).then(u,e)},1e3)},n=K9e(),a=o=>{VS({anchorId:jk});const l=document.getElementById(jk);i=new KI(l,{height:window.innerHeight*.9,placeholder:"No tournaments",index:"tournament.tournamentId",headerVisible:!1,layout:"fitColumns",reactiveData:!0,data:o,columns:n}),i.on("tableBuilt",()=>{q9e(i)})},s=o=>{o.tournaments.sort((l,u)=>new Date(u.tournament.startDate).getTime()-new Date(l.tournament.startDate).getTime()),a(o.tournaments)};if(t){const o=l=>{l?.data?.calendar&&s(l.data.calendar)};QO({providerAbbr:t}).then(o,e)}return{table:i,replaceTableData:r}}function _g(t){return`tournament_${t.toLowerCase()}`}function yH(t){return`tab_tournament_${t.toLowerCase()}`}function J9e({startDate:t,endDate:e}){const i=new Date(t),r=new Date(e),n=["January","February","March","April","May","June","July","August","September","October","November","December"],a=i.getDate()===r.getDate(),s=i.getFullYear()===r.getFullYear(),o=s&&i.getMonth()===r.getMonth(),l=u=>[u.getFullYear(),u.getMonth()+1,u.getDate()].join("/");return a&&s&&o?`${n[i.getMonth()]} ${i.getDate()}, ${i.getFullYear()}`:s&&o?`${n[i.getMonth()]} ${i.getDate()}-${r.getDate()}, ${i.getFullYear()}`:s?`${n[i.getMonth()]} ${i.getDate()} - ${n[r.getMonth()]} ${r.getDate()}, ${i.getFullYear()}`:`${l(i)} - ${l(r)}`}async function Q9e(t,e){const i=document.getElementById(mme);sp(i);const r=t?.data?.tournamentInfo??{},n=r.onlineResources?.find(p=>p.name==="tournamentImage"),a=document.getElementById(GY);if(n?.identifier?a.innerHTML=`<img src="${n.identifier}" alt="${r.name}" style="max-height: 20em" />`:sp(a),r.tournamentName){const p=document.getElementById(VY),f=`<h1>${r.tournamentName}</h1>`,m=`<h2>${J9e(r)}</h2>`;p.innerHTML=`${f}${m}`}const s=document.getElementById(_g("Info")),o=!!r.notes;o?(s.innerHTML=r.notes,jT("Info")):(sp(s),GT("Info"));const l=!!r.eventInfo?.length;if(l){const p=r.tournamentId,f=document.getElementById(_g("Events"));sp(f);const m=document.createElement("div"),h=document.createElement("div");h.id="flightDisplay";const g=e?.eventId,I=g?Math.max(r.eventInfo.findIndex(U=>U.eventId===g),0):0,v=r.eventInfo.map(({eventId:U,eventName:T},P)=>({onClick:()=>{Qf({tournamentId:p,eventId:U}),dY({tournamentId:p,eventId:U,header:m,flightDisplay:h,displayFormat:"roundsColumns"})},isActive:P===I,label:T,close:!0})),w={label:r.eventInfo[I].eventName,options:v,id:"eventButton",modifyLabel:!0,selection:!0,location:Lp},b=um({button:w,stateChange:()=>{document.getElementById("structureButton")?.remove(),document.getElementById("flightButton")?.remove()}}),S=r.eventInfo[I].eventId;m.className="block",m.appendChild(b),f.appendChild(m),f.appendChild(h),dY({tournamentId:p,eventId:S,header:m,flightDisplay:h,displayFormat:"roundsColumns",drawId:e?.drawId,structureId:e?.structureId}),jT("Events")}else GT("Events");const u=!!r.publishState?.orderOfPlay?.published;if(u){const p=document.getElementById(_g("Schedule")),f=document.createElement("div");f.style.width="100%",f.className="block",f.id="scheduleHeader",p.appendChild(f);const m=document.createElement("div");m.id="tournamentSchedule",p.appendChild(m),jT("Schedule")}else GT("Schedule");const c=!!r.publishState?.participants?.published;if(c){const p=document.getElementById(_g("Players"));sp(p);const f=document.createElement("div");f.style.width="100%",f.className="block",p.appendChild(f);const m=document.createElement("div");m.id="playersTable",p.appendChild(m),jT("Players")}else GT("Players");let d;e?.tab==="Players"&&c?d="Players":e?.tab==="Schedule"&&u?d="Schedule":e?.tab==="Events"&&l||e?.eventId&&l?d="Events":o?d="Info":l&&(d="Events"),d&&rme(d)}var y1="http://www.w3.org/1999/xhtml";const NY={svg:"http://www.w3.org/2000/svg",xhtml:y1,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Vfe(t){var e=t+="",i=e.indexOf(":");return i>=0&&(e=t.slice(0,i))!=="xmlns"&&(t=t.slice(i+1)),NY.hasOwnProperty(e)?{space:NY[e],local:t}:t}function Z9e(t){return function(){var e=this.ownerDocument,i=this.namespaceURI;return i===y1&&e.documentElement.namespaceURI===y1?e.createElement(t):e.createElementNS(i,t)}}function eXe(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function bH(t){var e=Vfe(t);return(e.local?eXe:Z9e)(e)}function tXe(){}function jfe(t){return t==null?tXe:function(){return this.querySelector(t)}}function iXe(t){typeof t!="function"&&(t=jfe(t));for(var e=this._groups,i=e.length,r=new Array(i),n=0;n<i;++n)for(var a=e[n],s=a.length,o=r[n]=new Array(s),l,u,c=0;c<s;++c)(l=a[c])&&(u=t.call(l,l.__data__,c,a))&&("__data__"in l&&(u.__data__=l.__data__),o[c]=u);return new Sl(r,this._parents)}function rXe(t){return t==null?[]:Array.isArray(t)?t:Array.from(t)}function nXe(){return[]}function aXe(t){return t==null?nXe:function(){return this.querySelectorAll(t)}}function sXe(t){return function(){return rXe(t.apply(this,arguments))}}function oXe(t){typeof t=="function"?t=sXe(t):t=aXe(t);for(var e=this._groups,i=e.length,r=[],n=[],a=0;a<i;++a)for(var s=e[a],o=s.length,l,u=0;u<o;++u)(l=s[u])&&(r.push(t.call(l,l.__data__,u,s)),n.push(l));return new Sl(r,n)}function lXe(t){return function(){return this.matches(t)}}function Gfe(t){return function(e){return e.matches(t)}}var uXe=Array.prototype.find;function cXe(t){return function(){return uXe.call(this.children,t)}}function dXe(){return this.firstElementChild}function pXe(t){return this.select(t==null?dXe:cXe(typeof t=="function"?t:Gfe(t)))}var fXe=Array.prototype.filter;function mXe(){return Array.from(this.children)}function hXe(t){return function(){return fXe.call(this.children,t)}}function gXe(t){return this.selectAll(t==null?mXe:hXe(typeof t=="function"?t:Gfe(t)))}function IXe(t){typeof t!="function"&&(t=lXe(t));for(var e=this._groups,i=e.length,r=new Array(i),n=0;n<i;++n)for(var a=e[n],s=a.length,o=r[n]=[],l,u=0;u<s;++u)(l=a[u])&&t.call(l,l.__data__,u,a)&&o.push(l);return new Sl(r,this._parents)}function Hfe(t){return new Array(t.length)}function vXe(){return new Sl(this._enter||this._groups.map(Hfe),this._parents)}function NE(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}NE.prototype={constructor:NE,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};function yXe(t){return function(){return t}}function bXe(t,e,i,r,n,a){for(var s=0,o,l=e.length,u=a.length;s<u;++s)(o=e[s])?(o.__data__=a[s],r[s]=o):i[s]=new NE(t,a[s]);for(;s<l;++s)(o=e[s])&&(n[s]=o)}function wXe(t,e,i,r,n,a,s){var o,l,u=new Map,c=e.length,d=a.length,p=new Array(c),f;for(o=0;o<c;++o)(l=e[o])&&(p[o]=f=s.call(l,l.__data__,o,e)+"",u.has(f)?n[o]=l:u.set(f,l));for(o=0;o<d;++o)f=s.call(t,a[o],o,a)+"",(l=u.get(f))?(r[o]=l,l.__data__=a[o],u.delete(f)):i[o]=new NE(t,a[o]);for(o=0;o<c;++o)(l=e[o])&&u.get(p[o])===l&&(n[o]=l)}function SXe(t){return t.__data__}function UXe(t,e){if(!arguments.length)return Array.from(this,SXe);var i=e?wXe:bXe,r=this._parents,n=this._groups;typeof t!="function"&&(t=yXe(t));for(var a=n.length,s=new Array(a),o=new Array(a),l=new Array(a),u=0;u<a;++u){var c=r[u],d=n[u],p=d.length,f=TXe(t.call(c,c&&c.__data__,u,r)),m=f.length,h=o[u]=new Array(m),g=s[u]=new Array(m),I=l[u]=new Array(p);i(c,d,h,g,I,f,e);for(var v=0,w=0,y,b;v<m;++v)if(y=h[v]){for(v>=w&&(w=v+1);!(b=g[w])&&++w<m;);y._next=b||null}}return s=new Sl(s,r),s._enter=o,s._exit=l,s}function TXe(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function DXe(){return new Sl(this._exit||this._groups.map(Hfe),this._parents)}function PXe(t,e,i){var r=this.enter(),n=this,a=this.exit();return typeof t=="function"?(r=t(r),r&&(r=r.selection())):r=r.append(t+""),e!=null&&(n=e(n),n&&(n=n.selection())),i==null?a.remove():i(a),r&&n?r.merge(n).order():n}function EXe(t){for(var e=t.selection?t.selection():t,i=this._groups,r=e._groups,n=i.length,a=r.length,s=Math.min(n,a),o=new Array(n),l=0;l<s;++l)for(var u=i[l],c=r[l],d=u.length,p=o[l]=new Array(d),f,m=0;m<d;++m)(f=u[m]||c[m])&&(p[m]=f);for(;l<n;++l)o[l]=i[l];return new Sl(o,this._parents)}function RXe(){for(var t=this._groups,e=-1,i=t.length;++e<i;)for(var r=t[e],n=r.length-1,a=r[n],s;--n>=0;)(s=r[n])&&(a&&s.compareDocumentPosition(a)^4&&a.parentNode.insertBefore(s,a),a=s);return this}function CXe(t){t||(t=MXe);function e(d,p){return d&&p?t(d.__data__,p.__data__):!d-!p}for(var i=this._groups,r=i.length,n=new Array(r),a=0;a<r;++a){for(var s=i[a],o=s.length,l=n[a]=new Array(o),u,c=0;c<o;++c)(u=s[c])&&(l[c]=u);l.sort(e)}return new Sl(n,this._parents).order()}function MXe(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function NXe(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this}function AXe(){return Array.from(this)}function kXe(){for(var t=this._groups,e=0,i=t.length;e<i;++e)for(var r=t[e],n=0,a=r.length;n<a;++n){var s=r[n];if(s)return s}return null}function OXe(){let t=0;for(const e of this)++t;return t}function xXe(){return!this.node()}function FXe(t){for(var e=this._groups,i=0,r=e.length;i<r;++i)for(var n=e[i],a=0,s=n.length,o;a<s;++a)(o=n[a])&&t.call(o,o.__data__,a,n);return this}function LXe(t){return function(){this.removeAttribute(t)}}function _Xe(t){return function(){this.removeAttributeNS(t.space,t.local)}}function $Xe(t,e){return function(){this.setAttribute(t,e)}}function BXe(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function VXe(t,e){return function(){var i=e.apply(this,arguments);i==null?this.removeAttribute(t):this.setAttribute(t,i)}}function jXe(t,e){return function(){var i=e.apply(this,arguments);i==null?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,i)}}function GXe(t,e){var i=Vfe(t);if(arguments.length<2){var r=this.node();return i.local?r.getAttributeNS(i.space,i.local):r.getAttribute(i)}return this.each((e==null?i.local?_Xe:LXe:typeof e=="function"?i.local?jXe:VXe:i.local?BXe:$Xe)(i,e))}function Wfe(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function HXe(t){return function(){this.style.removeProperty(t)}}function WXe(t,e,i){return function(){this.style.setProperty(t,e,i)}}function zXe(t,e,i){return function(){var r=e.apply(this,arguments);r==null?this.style.removeProperty(t):this.style.setProperty(t,r,i)}}function qXe(t,e,i){return arguments.length>1?this.each((e==null?HXe:typeof e=="function"?zXe:WXe)(t,e,i??"")):YXe(this.node(),t)}function YXe(t,e){return t.style.getPropertyValue(e)||Wfe(t).getComputedStyle(t,null).getPropertyValue(e)}function KXe(t){return function(){delete this[t]}}function XXe(t,e){return function(){this[t]=e}}function JXe(t,e){return function(){var i=e.apply(this,arguments);i==null?delete this[t]:this[t]=i}}function QXe(t,e){return arguments.length>1?this.each((e==null?KXe:typeof e=="function"?JXe:XXe)(t,e)):this.node()[t]}function zfe(t){return t.trim().split(/^|\s+/)}function wH(t){return t.classList||new qfe(t)}function qfe(t){this._node=t,this._names=zfe(t.getAttribute("class")||"")}qfe.prototype={add:function(t){var e=this._names.indexOf(t);e<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};function Yfe(t,e){for(var i=wH(t),r=-1,n=e.length;++r<n;)i.add(e[r])}function Kfe(t,e){for(var i=wH(t),r=-1,n=e.length;++r<n;)i.remove(e[r])}function ZXe(t){return function(){Yfe(this,t)}}function eJe(t){return function(){Kfe(this,t)}}function tJe(t,e){return function(){(e.apply(this,arguments)?Yfe:Kfe)(this,t)}}function iJe(t,e){var i=zfe(t+"");if(arguments.length<2){for(var r=wH(this.node()),n=-1,a=i.length;++n<a;)if(!r.contains(i[n]))return!1;return!0}return this.each((typeof e=="function"?tJe:e?ZXe:eJe)(i,e))}function rJe(){this.textContent=""}function nJe(t){return function(){this.textContent=t}}function aJe(t){return function(){var e=t.apply(this,arguments);this.textContent=e??""}}function sJe(t){return arguments.length?this.each(t==null?rJe:(typeof t=="function"?aJe:nJe)(t)):this.node().textContent}function oJe(){this.innerHTML=""}function lJe(t){return function(){this.innerHTML=t}}function uJe(t){return function(){var e=t.apply(this,arguments);this.innerHTML=e??""}}function cJe(t){return arguments.length?this.each(t==null?oJe:(typeof t=="function"?uJe:lJe)(t)):this.node().innerHTML}function dJe(){this.nextSibling&&this.parentNode.appendChild(this)}function pJe(){return this.each(dJe)}function fJe(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function mJe(){return this.each(fJe)}function hJe(t){var e=typeof t=="function"?t:bH(t);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function gJe(){return null}function IJe(t,e){var i=typeof t=="function"?t:bH(t),r=e==null?gJe:typeof e=="function"?e:jfe(e);return this.select(function(){return this.insertBefore(i.apply(this,arguments),r.apply(this,arguments)||null)})}function vJe(){var t=this.parentNode;t&&t.removeChild(this)}function yJe(){return this.each(vJe)}function bJe(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function wJe(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function SJe(t){return this.select(t?wJe:bJe)}function UJe(t){return arguments.length?this.property("__data__",t):this.node().__data__}function TJe(t){return function(e){t.call(this,e,this.__data__)}}function DJe(t){return t.trim().split(/^|\s+/).map(function(e){var i="",r=e.indexOf(".");return r>=0&&(i=e.slice(r+1),e=e.slice(0,r)),{type:e,name:i}})}function PJe(t){return function(){var e=this.__on;if(e){for(var i=0,r=-1,n=e.length,a;i<n;++i)a=e[i],(!t.type||a.type===t.type)&&a.name===t.name?this.removeEventListener(a.type,a.listener,a.options):e[++r]=a;++r?e.length=r:delete this.__on}}}function EJe(t,e,i){return function(){var r=this.__on,n,a=TJe(e);if(r){for(var s=0,o=r.length;s<o;++s)if((n=r[s]).type===t.type&&n.name===t.name){this.removeEventListener(n.type,n.listener,n.options),this.addEventListener(n.type,n.listener=a,n.options=i),n.value=e;return}}this.addEventListener(t.type,a,i),n={type:t.type,name:t.name,value:e,listener:a,options:i},r?r.push(n):this.__on=[n]}}function RJe(t,e,i){var r=DJe(t+""),n,a=r.length,s;if(arguments.length<2){var o=this.node().__on;if(o){for(var l=0,u=o.length,c;l<u;++l)for(n=0,c=o[l];n<a;++n)if((s=r[n]).type===c.type&&s.name===c.name)return c.value}return}for(o=e?EJe:PJe,n=0;n<a;++n)this.each(o(r[n],e,i));return this}function Xfe(t,e,i){var r=Wfe(t),n=r.CustomEvent;typeof n=="function"?n=new n(e,i):(n=r.document.createEvent("Event"),i?(n.initEvent(e,i.bubbles,i.cancelable),n.detail=i.detail):n.initEvent(e,!1,!1)),t.dispatchEvent(n)}function CJe(t,e){return function(){return Xfe(this,t,e)}}function MJe(t,e){return function(){return Xfe(this,t,e.apply(this,arguments))}}function NJe(t,e){return this.each((typeof e=="function"?MJe:CJe)(t,e))}function*AJe(){for(var t=this._groups,e=0,i=t.length;e<i;++e)for(var r=t[e],n=0,a=r.length,s;n<a;++n)(s=r[n])&&(yield s)}var kJe=[null];function Sl(t,e){this._groups=t,this._parents=e}function OJe(){return this}Sl.prototype={constructor:Sl,select:iXe,selectAll:oXe,selectChild:pXe,selectChildren:gXe,filter:IXe,data:UXe,enter:vXe,exit:DXe,join:PXe,merge:EXe,selection:OJe,order:RXe,sort:CXe,call:NXe,nodes:AXe,node:kXe,size:OXe,empty:xXe,each:FXe,attr:GXe,style:qXe,property:QXe,classed:iJe,text:sJe,html:cJe,raise:pJe,lower:mJe,append:hJe,insert:IJe,remove:yJe,clone:SJe,datum:UJe,on:RJe,dispatch:NJe,[Symbol.iterator]:AJe};function xJe(t){return typeof t=="string"?new Sl([[document.querySelector(t)]],[document.documentElement]):new Sl([[t]],kJe)}function FJe(t){return xJe(bH(t).call(document.documentElement))}function LJe(t={}){const{maxWidth:e="450px",color:i="#000000",strokeWidth:r=5,lineWidth:n=5,fill:a="none",className:s="courthive-logo",serviceLinePosition:o=.3,centerMarkLength:l=12}=t,u=n??r,c=100,d=Math.sqrt(3),p=c*d/2,f=c*d,m=c/2,h=r,g=`M 0,${-m} L ${-p},${-c} L ${-f},${-m} L ${-f},${m} L ${-p},${c} L 0,${m}`,I=`M 0,${-m} L ${p},${-c} L ${f},${-m} L ${f},${m} L ${p},${c} L 0,${m}`,v=o*p,w=-p-v,y=p+v,b=-c+v/d,S=c-v/d,U=FJe("svg").attr("viewBox",`${-f-h} ${-c-h} ${2*f+2*h} ${2*c+2*h}`).attr("xmlns","http://www.w3.org/2000/svg").attr("class",s).style("width","100%").style("max-width",e),T=U.append("g").attr("class","logo-group"),P="stroke-width",D="court-marking";return T.append("path").attr("d",g).attr("fill",a).attr("stroke",i).attr(P,r).attr("stroke-linejoin","miter").attr("stroke-linecap","round"),T.append("path").attr("d",I).attr("fill",a).attr("stroke",i).attr(P,r).attr("stroke-linejoin","miter").attr("stroke-linecap","round"),T.append("line").attr("class",D).attr("x1",0).attr("y1",-m).attr("x2",0).attr("y2",m).attr("stroke",i).attr(P,r),T.append("line").attr("class",D).attr("x1",w).attr("y1",b).attr("x2",w).attr("y2",S).attr("stroke",i).attr(P,u),T.append("line").attr("class",D).attr("x1",y).attr("y1",b).attr("x2",y).attr("y2",S).attr("stroke",i).attr(P,u),T.append("line").attr("class",D).attr("x1",w).attr("y1",0).attr("x2",y).attr("y2",0).attr("stroke",i).attr(P,u),T.append("line").attr("class",D).attr("x1",-f).attr("y1",0).attr("x2",-f+l).attr("y2",0).attr("stroke",i).attr(P,u),T.append("line").attr("class",D).attr("x1",f-l).attr("y1",0).attr("x2",f).attr("y2",0).attr("stroke",i).attr(P,u),U.node()}function _Je(){const t=document.querySelector(`#${Tw}`);t.innerHTML="";const e=document.createElement("div"),i=document.createElement("a");i.href="https://courthive.com",i.target="_blank";const r=LJe({color:"#000000",maxWidth:"300px"});i.appendChild(r),e.appendChild(i);const n=document.createElement("h1");n.className="name",n.textContent="CourtHive",e.appendChild(n),t.appendChild(e)}function AE(t){hme.forEach(e=>{const i=document.querySelector(`#${e}`);i&&(i.style.display=e===t?"block":"none")})}var $Je=/([:*])(\w+)/g,BJe="([^/]+)",VJe=/\*/g,jJe="?(?:.*)",GJe=/\/\?/g,HJe="/?([^/]+|)",WJe="(?:/^|^)",zJe="";function Jfe(t){return t===void 0&&(t="/"),UH()?location.pathname+location.search+location.hash:t}function Vr(t){return t.replace(/\/+$/,"").replace(/^\/+/,"")}function kE(t){return typeof t=="string"}function qJe(t){return typeof t=="function"}function OE(t){return t&&t.indexOf("#")>=0&&t.split("#").pop()||""}function YJe(t,e){return e.length===0||!t?null:t.slice(1,t.length).reduce(function(i,r,n){return i===null&&(i={}),i[e[n]]=decodeURIComponent(r),i},null)}function xE(t){var e=Vr(t).split(/\?(.*)?$/);return[Vr(e[0]),e.slice(1).join("")]}function SH(t){for(var e={},i=t.split("&"),r=0;r<i.length;r++){var n=i[r].split("=");if(n[0]!==""){var a=decodeURIComponent(n[0]);e[a]?(Array.isArray(e[a])||(e[a]=[e[a]]),e[a].push(decodeURIComponent(n[1]||""))):e[a]=decodeURIComponent(n[1]||"")}}return e}function Qfe(t,e){var i=xE(Vr(t.currentLocationPath)),r=i[0],n=i[1],a=n===""?null:SH(n),s=[],o;if(kE(e.path)){if(o=WJe+Vr(e.path).replace($Je,function(d,p,f){return s.push(f),BJe}).replace(VJe,jJe).replace(GJe,HJe)+"$",Vr(e.path)===""&&Vr(r)==="")return{url:r,queryString:n,hashString:OE(t.to),route:e,data:null,params:a}}else o=e.path;var l=new RegExp(o,zJe),u=r.match(l);if(u){var c=kE(e.path)?YJe(u,s):u.groups?u.groups:u.slice(1);return{url:Vr(r.replace(new RegExp("^"+t.instance.root),"")),queryString:n,hashString:OE(t.to),route:e,data:c,params:a}}return!1}function Zfe(){return!!(typeof window<"u"&&window.history&&window.history.pushState)}function ng(t,e){return typeof t[e]>"u"||t[e]===!0}function KJe(t){if(!t)return{};var e=t.split(","),i={},r;return e.forEach(function(n){var a=n.split(":").map(function(s){return s.replace(/(^ +| +$)/g,"")});switch(a[0]){case"historyAPIMethod":i.historyAPIMethod=a[1];break;case"resolveOptionsStrategy":r||(r={}),r.strategy=a[1];break;case"resolveOptionsHash":r||(r={}),r.hash=a[1]==="true";break;case"updateBrowserURL":case"callHandler":case"updateState":case"force":i[a[0]]=a[1]==="true";break}}),r&&(i.resolveOptions=r),i}function UH(){return typeof window<"u"}function XJe(t,e){return t===void 0&&(t=[]),e===void 0&&(e={}),t.filter(function(i){return i}).forEach(function(i){["before","after","already","leave"].forEach(function(r){i[r]&&(e[r]||(e[r]=[]),e[r].push(i[r]))})}),e}function Xu(t,e,i){var r=e||{},n=0;(function a(){if(!t[n]){i&&i(r);return}Array.isArray(t[n])?(t.splice.apply(t,[n,1].concat(t[n][0](r)?t[n][1]:t[n][2])),a()):t[n](r,function(s){typeof s>"u"||s===!0?(n+=1,a()):i&&i(r)})})()}Xu.if=function(t,e,i){return Array.isArray(e)||(e=[e]),Array.isArray(i)||(i=[i]),[t,e,i]};function AY(t,e){typeof t.currentLocationPath>"u"&&(t.currentLocationPath=t.to=Jfe(t.instance.root)),t.currentLocationPath=t.instance._checkForAHash(t.currentLocationPath),e()}function Fk(t,e){for(var i=0;i<t.instance.routes.length;i++){var r=t.instance.routes[i],n=Qfe(t,r);if(n&&(t.matches||(t.matches=[]),t.matches.push(n),t.resolveOptions.strategy==="ONE")){e();return}}e()}function JJe(t,e){t.navigateOptions&&(typeof t.navigateOptions.shouldResolve<"u"&&console.warn('"shouldResolve" is deprecated. Please check the documentation.'),typeof t.navigateOptions.silent<"u"&&console.warn('"silent" is deprecated. Please check the documentation.')),e()}function QJe(t,e){t.navigateOptions.force===!0?(t.instance._setCurrent([t.instance._pathToMatchObject(t.to)]),e(!1)):e()}var kY=UH(),ZJe=Zfe();function eQe(t,e){if(ng(t.navigateOptions,"updateBrowserURL")){var i=("/"+t.to).replace(/\/\//g,"/"),r=kY&&t.resolveOptions&&t.resolveOptions.hash===!0;ZJe?(history[t.navigateOptions.historyAPIMethod||"pushState"](t.navigateOptions.stateObj||{},t.navigateOptions.title||"",r?"#"+i:i),location&&location.hash&&(t.instance.__freezeListening=!0,setTimeout(function(){if(!r){var n=location.hash;location.hash="",location.hash=n}t.instance.__freezeListening=!1},1))):kY&&(window.location.href=t.to)}e()}function eme(t,e){var i=t.instance;if(!i.lastResolved()){e();return}Xu(i.lastResolved().map(function(r){return function(n,a){if(!r.route.hooks||!r.route.hooks.leave){a();return}var s=!1,o=t.instance.matchLocation(r.route.path,t.currentLocationPath,!1);if(r.route.path!=="*")s=!o;else{var l=t.matches?t.matches.find(function(u){return r.route.path===u.route.path}):!1;s=!l}if(ng(t.navigateOptions,"callHooks")&&s){Xu(r.route.hooks.leave.map(function(u){return function(c,d){return u(function(p){p===!1?t.instance.__markAsClean(t):d()},t.matches&&t.matches.length>0?t.matches.length===1?t.matches[0]:t.matches:void 0)}}).concat([function(){return a()}]));return}else a()}}),{},function(){return e()})}function tQe(t,e){t.match.route.hooks&&t.match.route.hooks.before&&ng(t.navigateOptions,"callHooks")?Xu(t.match.route.hooks.before.map(function(i){return function(n,a){return i(function(s){s===!1?t.instance.__markAsClean(t):a()},t.match)}}).concat([function(){return e()}])):e()}function iQe(t,e){ng(t.navigateOptions,"callHandler")&&t.match.route.handler(t.match),t.instance.updatePageLinks(),e()}function rQe(t,e){t.match.route.hooks&&t.match.route.hooks.after&&ng(t.navigateOptions,"callHooks")&&t.match.route.hooks.after.forEach(function(i){return i(t.match)}),e()}function nQe(t,e){var i=t.instance.lastResolved();if(i&&i[0]&&i[0].route===t.match.route&&i[0].url===t.match.url&&i[0].queryString===t.match.queryString){i.forEach(function(r){r.route.hooks&&r.route.hooks.already&&ng(t.navigateOptions,"callHooks")&&r.route.hooks.already.forEach(function(n){return n(t.match)})}),e(!1);return}e()}function aQe(t,e){var i=t.instance._notFoundRoute;if(i){t.notFoundHandled=!0;var r=xE(t.currentLocationPath),n=r[0],a=r[1],s=OE(t.to);i.path=Vr(n);var o={url:i.path,queryString:a,hashString:s,data:null,route:i,params:a!==""?SH(a):null};t.matches=[o],t.match=o}e()}function sQe(t,e){(!t.resolveOptions||t.resolveOptions.noMatchWarning===!1||typeof t.resolveOptions.noMatchWarning>"u")&&console.warn('Navigo: "'+t.currentLocationPath+`" didn't match any of the registered routes.`),e()}function oQe(t,e){t.instance._setCurrent(null),e()}function tme(t,e){ng(t.navigateOptions,"updateState")&&t.instance._setCurrent(t.matches),e()}var ime=[nQe,tQe,iQe,rQe],OY=[eme,aQe,Xu.if(function(t){var e=t.notFoundHandled;return e},ime.concat([tme]),[sQe,oQe])];function b1(){return b1=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(t[r]=i[r])}return t},b1.apply(this,arguments)}function xY(t,e){var i=0;function r(){if(i===t.matches.length){tme(t,e);return}Xu(ime,b1({},t,{match:t.matches[i]}),function(){i+=1,r()})}eme(t,r)}function Lk(t){t.instance.__markAsClean(t)}function w1(){return w1=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(t[r]=i[r])}return t},w1.apply(this,arguments)}var FY="[data-navigo]";function lQe(t,e){var i=e||{strategy:"ONE",hash:!1,noMatchWarning:!1,linksSelector:FY},r=this,n="/",a=null,s=[],o=!1,l,u=Zfe(),c=UH();t?n=Vr(t):console.warn('Navigo requires a root path in its constructor. If not provided will use "/" as default.');function d(x){return x.indexOf("#")>=0&&(i.hash===!0?x=x.split("#")[1]||"/":x=x.split("#")[0]),x}function p(x){return Vr(n+"/"+Vr(x))}function f(x,L,$,V){return x=kE(x)?p(x):x,{name:V||Vr(String(x)),path:x,handler:L,hooks:XJe($)}}function m(x,L,$){var V=this;return typeof x=="object"&&!(x instanceof RegExp)?(Object.keys(x).forEach(function(_){if(typeof x[_]=="function")V.on(_,x[_]);else{var B=x[_],G=B.uses,j=B.as,K=B.hooks;s.push(f(_,G,[l,K],j))}}),this):(typeof x=="function"&&($=L,L=x,x=n),s.push(f(x,L,[l,$])),this)}function h(x,L){if(r.__dirty){r.__waiting.push(function(){return r.resolve(x,L)});return}else r.__dirty=!0;x=x?Vr(n)+"/"+Vr(x):void 0;var $={instance:r,to:x,currentLocationPath:x,navigateOptions:{},resolveOptions:w1({},i,L)};return Xu([AY,Fk,Xu.if(function(V){var _=V.matches;return _&&_.length>0},xY,OY)],$,Lk),$.matches?$.matches:!1}function g(x,L){if(r.__dirty){r.__waiting.push(function(){return r.navigate(x,L)});return}else r.__dirty=!0;x=Vr(n)+"/"+Vr(x);var $={instance:r,to:x,navigateOptions:L||{},resolveOptions:L&&L.resolveOptions?L.resolveOptions:i,currentLocationPath:d(x)};Xu([JJe,QJe,Fk,Xu.if(function(V){var _=V.matches;return _&&_.length>0},xY,OY),eQe,Lk],$,Lk)}function I(x,L,$){var V=E(x,L);return V!==null?(g(V.replace(new RegExp("^/?"+n),""),$),!0):!1}function v(x){return this.routes=s=s.filter(function(L){return kE(x)?Vr(L.path)!==Vr(x):qJe(x)?x!==L.handler:String(L.path)!==String(x)}),this}function w(){u&&(this.__popstateListener=function(){r.__freezeListening||h()},window.addEventListener("popstate",this.__popstateListener))}function y(){this.routes=s=[],u&&window.removeEventListener("popstate",this.__popstateListener),this.destroyed=o=!0}function b(x,L){return r._notFoundRoute=f("*",x,[l,L],"__NOT_FOUND__"),this}function S(){if(c)return U().forEach(function(x){if(x.getAttribute("data-navigo")==="false"||x.getAttribute("target")==="_blank"){x.hasListenerAttached&&x.removeEventListener("click",x.navigoHandler);return}x.hasListenerAttached||(x.hasListenerAttached=!0,x.navigoHandler=function(L){if((L.ctrlKey||L.metaKey)&&L.target.tagName.toLowerCase()==="a")return!1;var $=x.getAttribute("href");if(typeof $>"u"||$===null)return!1;if($.match(/^(http|https)/)&&typeof URL<"u")try{var V=new URL($);$=V.pathname+V.search}catch{}var _=KJe(x.getAttribute("data-navigo-options"));o||(L.preventDefault(),L.stopPropagation(),r.navigate(Vr($),_))},x.addEventListener("click",x.navigoHandler))}),r}function U(){return c?[].slice.call(document.querySelectorAll(i.linksSelector||FY)):[]}function T(x){return"/"+n+"/"+Vr(x)}function P(x){return l=x,this}function D(){return a}function E(x,L,$){var V=s.find(function(G){return G.name===x}),_=null;if(V){if(_=V.path,L)for(var B in L)_=_.replace(":"+B,L[B]);_=_.match(/^\//)?_:"/"+_}return _&&$&&!$.includeRoot&&(_=_.replace(new RegExp("^/"+n),"")),_}function R(x){return x.getAttribute("href")}function C(x){var L=xE(Vr(x)),$=L[0],V=L[1],_=V===""?null:SH(V),B=OE(x),G=f($,function(){},[l],$);return{url:$,queryString:V,hashString:B,route:G,data:null,params:_}}function M(){return C(Vr(Jfe(n)).replace(new RegExp("^"+n),""))}function N(x){var L={instance:r,currentLocationPath:x,to:x,resolveOptions:i};return Fk(L,function(){}),L.matches?L.matches:!1}function A(x,L,$){typeof L<"u"&&(typeof $>"u"||$)&&(L=p(L));var V={instance:r,to:L,currentLocationPath:L};AY(V,function(){}),typeof x=="string"&&(x=typeof $>"u"||$?p(x):x);var _=Qfe(V,{name:String(x),path:x,handler:function(){},hooks:{}});return _||!1}function O(x,L,$){return typeof L=="string"&&(L=k(L)),L?(L.hooks[x]||(L.hooks[x]=[]),L.hooks[x].push($),function(){L.hooks[x]=L.hooks[x].filter(function(V){return V!==$})}):(console.warn("Route doesn't exists: "+L),function(){})}function k(x){return typeof x=="string"?s.find(function(L){return L.name===p(x)}):s.find(function(L){return L.handler===x})}function F(x){x.instance.__dirty=!1,x.instance.__waiting.length>0&&x.instance.__waiting.shift()()}this.root=n,this.routes=s,this.destroyed=o,this.current=a,this.__freezeListening=!1,this.__waiting=[],this.__dirty=!1,this.__markAsClean=F,this.on=m,this.off=v,this.resolve=h,this.navigate=g,this.navigateByName=I,this.destroy=y,this.notFound=b,this.updatePageLinks=S,this.link=T,this.hooks=P,this.extractGETParameters=function(x){return xE(d(x))},this.lastResolved=D,this.generate=E,this.getLinkPath=R,this.match=N,this.matchLocation=A,this.getCurrentLocation=M,this.addBeforeHook=O.bind(this,"before"),this.addAfterHook=O.bind(this,"after"),this.addAlreadyHook=O.bind(this,"already"),this.addLeaveHook=O.bind(this,"leave"),this.getRoute=k,this._pathToMatchObject=C,this._clean=Vr,this._checkForAHash=d,this._setCurrent=function(x){return a=r.current=x},w.call(this),S.call(this)}function vg({tournamentId:t,eventId:e,drawId:i,structureId:r,tab:n}){const a=document.getElementById("back");a.style.display="block",Ku.tournamentId=t,delete Ku.tab,AE(FE),_ee({tournamentId:t}).then(s=>Q9e(s,{eventId:e,drawId:i,structureId:r,tab:n}))}function Qf({tournamentId:t,eventId:e,drawId:i,structureId:r,tab:n}){let a=`/tournament/${t}`;n==="Schedule"?a+="/schedule":n==="Events"?a+="/events":(e&&(a+=`/event/${e}`),i&&(a+=`/draw/${i}`),r&&(a+=`/structure/${r}`)),history.pushState(null,"",`#${a}`)}function uQe(){const e=new lQe("/",{hash:!0});Ku.router=e;const i=document.getElementById("back");return e.on("/",()=>{console.log("[router] matched: / (splash)"),i.style.display="none",AE(Tw),_Je()}),e.on("/tournaments/:providerAbbr",r=>{console.log("[router] matched: /tournaments/:providerAbbr",r?.data),i.style.display="none";const n=r?.data?.providerAbbr?.toUpperCase();AE(D1),X9e({providerAbbr:n})}),e.on("/tournament/:tournamentId/event/:eventId/draw/:drawId/structure/:structureId",r=>{console.log("[router] matched: /tournament/.../structure/:structureId",r?.data),vg({tournamentId:r?.data?.tournamentId,eventId:r?.data?.eventId,drawId:r?.data?.drawId,structureId:r?.data?.structureId})}),e.on("/tournament/:tournamentId/event/:eventId/draw/:drawId",r=>{console.log("[router] matched: /tournament/.../draw/:drawId",r?.data),vg({tournamentId:r?.data?.tournamentId,eventId:r?.data?.eventId,drawId:r?.data?.drawId})}),e.on("/tournament/:tournamentId/event/:eventId",r=>{console.log("[router] matched: /tournament/.../event/:eventId",r?.data),vg({tournamentId:r?.data?.tournamentId,eventId:r?.data?.eventId})}),e.on("/tournament/:tournamentId/events",r=>{vg({tournamentId:r?.data?.tournamentId,tab:"Events"})}),e.on("/tournament/:tournamentId/schedule",r=>{vg({tournamentId:r?.data?.tournamentId,tab:"Schedule"})}),e.on("/tournament/:tournamentId",r=>{vg({tournamentId:r?.data?.tournamentId})}),e.notFound(r=>{console.log("[router] notFound  url:",r?.url,"hashString:",r?.hashString,"data:",r?.data),e.navigate("/")}),e.resolve(),window.addEventListener("hashchange",()=>e.resolve()),e}const S1=["Info","Events","Schedule","Matches","Players","Stats"];let _k=!1;function rme(t,e){if(e?.updateUrl){if(_k)return;_k=!0,requestAnimationFrame(()=>{_k=!1})}if(t==="Schedule"?TOe({tournamentId:Ku.tournamentId,hydrateParticipants:!1}).then(r=>{VAe({data:r?.data})}):t==="Players"&&DOe({tournamentId:Ku.tournamentId}).then(i=>{wAe({participants:i?.data?.participants||[]})}),Ku.tab=t,S1.forEach(i=>{const r=document.getElementById(_g(i));r.style.display=i===t?"block":"none"}),e?.updateUrl){const i=Ku.tournamentId;Qf(t==="Schedule"?{tournamentId:i,tab:"Schedule"}:t==="Events"?{tournamentId:i,tab:"Events"}:t==="Players"?{tournamentId:i,tab:"Players"}:{tournamentId:i})}}function jT(t){const e=document.getElementById(yH(t));e.style.display="block"}function GT(t){const e=document.getElementById(yH(t));e.style.display=Go}const cQe=()=>{const t=document.createElement("div");t.className="container";const e=document.createElement("section");e.className="hero";const i=document.createElement("div");i.className="hero-body",i.id="tournament-hero";const r=document.createElement("div");r.className="columns";const n=document.createElement("div");n.className="column is-one-quarter has-text-centered",n.id=GY,r.appendChild(n);const a=document.createElement("div");a.className="column has-text-centered",a.id=VY,r.appendChild(a),i.appendChild(r),e.appendChild(i),t.appendChild(e);const s=document.createElement("div"),o=document.createElement("div");t.appendChild(s),t.appendChild(o),S1.forEach(u=>{const c=document.createElement("section");c.className="section is-fluid is-centered",c.style.display="none",c.style.width="100%",c.id=_g(u),o.appendChild(c)}),s.className="tabs is-centered";const l=document.createElement("ul");return S1.forEach(u=>{const c=document.createElement("li");c.id=yH(u),c.style.display="none",c.className="menu";const d=document.createElement("a");d.textContent=u,d.onclick=()=>rme(u,{updateUrl:!0}),c.appendChild(d),l.appendChild(c)}),s.appendChild(l),t},nme="chp_theme";let LY=null;function ame(t){return t==="system"?globalThis.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light":t}function U1(t){const e=ame(t);document.documentElement.dataset.theme=e,localStorage.setItem(nme,t)}function dQe(){const t=T1();U1(t),LY=globalThis.matchMedia("(prefers-color-scheme: dark)"),LY.addEventListener("change",()=>{T1()==="system"&&U1("system")})}function pQe(){const t=ame(T1());U1(t==="light"?"dark":"light")}function T1(){return localStorage.getItem(nme)??"light"}function fQe(){const t=document.createElement("div");t.className="main noselect";const e=document.createElement("nav");e.className="navbar";const i=document.createElement("div");i.className="navbar-brand";const r=document.createElement("div");r.onclick=()=>globalThis.history.back(),r.className="navbar-item",r.innerHTML="<<",r.id="back";const n=document.createElement("div");n.className="navbar-end";const a=document.createElement("button");a.className="navbar-item theme-toggle",a.title="Toggle dark mode";const s=()=>{const p=document.documentElement.dataset.theme==="dark";a.textContent=p?"":""};s(),a.onclick=()=>{pQe(),s()},n.appendChild(a),i.appendChild(r),e.appendChild(i),e.appendChild(n),t.appendChild(e);const o=document.createElement("div");o.style.display="none",o.id=Tw;const l=document.createElement("div");l.style.display="none",l.id=D1;const u=document.createElement("div");u.className="controlBar flexcol flexgrow flexcenter",u.id=jY,l.appendChild(u);const c=document.createElement("div");c.className="flexcol flexgrow flexcenter box",c.id=jk,l.appendChild(c);const d=document.createElement("div");return d.style.display="none",d.id=FE,d.appendChild(cQe()),t.appendChild(l),t.appendChild(d),t.appendChild(o),t}function mQe(t){for(const e of Array.from(document.querySelectorAll(".tmx-tm")).filter(i=>i.innerHTML===t.innerHTML)){const i=e;i.style.fontWeight="bold",i.style.color="#ed0c76"}}function hQe(t){for(const e of Array.from(document.querySelectorAll(".tmx-tm")).filter(i=>i.innerHTML===t.innerHTML)){const i=e;i.style.fontWeight="",i.style.color=""}}const _Y=(function(){let t,e={elapsed:1e5,held:void 0,touched:void 0,holdTime:800,holdAction:void 0,holdActions:{}};const i={};let r={};const n=(d,p)=>d.filter(f=>p.indexOf(f)!==-1).filter((f,m,h)=>h.indexOf(f)===m);e.reset=()=>(r={},e),e.register=(d,p,f,m)=>(typeof f=="function"&&(r[p]||(r[p]={},i[p]=[]),r[p][d]={fx:f,delay:m},i[p]=Object.keys(r[p])),e),e.deRegister=(d,p)=>(r[p]&&(delete r[p][d],i[p]=Object.keys(r[p])),e),e.call=(d,p,...f)=>r?.[p]?.[d]?.fx(...f),e.trigger=(d,p,f,m)=>r[p][d].fx(f,m,p),e.list=()=>console.log(r);const a="ontouchstart"in document.documentElement?"touchstart":"click";document.addEventListener(a,d=>o({evt:d,evnt:"tap"})),document.addEventListener("change",d=>o({evt:d,evnt:"change"})),document.addEventListener("click",d=>o({evt:d,evnt:"click"})),document.addEventListener("mouseover",d=>o({evt:d,evnt:"mouseover",stopPropagation:!1})),document.addEventListener("mouseout",d=>o({evt:d,evnt:"mouseout",stopPropagation:!1})),document.addEventListener("keyup",d=>o({evt:d,evnt:"keyup",stopPropagation:!1}));let s=0;function o({evt:d,evnt:p,stopPropagation:f=!0}){f&&d.stopPropagation();const m={x:d.clientX,y:d.clientY,pageX:d.pageX,pageY:d.pageY};let h=Array.from(d.target.classList),g=h.length&&i[p]?n(h,i[p]):[];if(g.length){let I=new Date().getTime();e.elapsed=I-s,s=I,g.forEach(v=>{l({cls:v,evt:d,evnt:p,mouse:m})})}}function l({cls:d,evt:p,evnt:f,mouse:m}){let h=p.target;r[f][d].fx(h,m,f,p)}document.addEventListener("touchstart",d=>{e.touched=d.target,e.coords=[d.touches[0].clientX,d.touches[0].clientY],e.touched&&(t=setTimeout(function(){c()},e.holdTime))},!1),document.addEventListener("touchend",function(){u()},!1),document.addEventListener("touchmove",function(d){e.touched!==d.target&&u()},!1);function u(){clearTimeout(t)}function c(){typeof e.holdAction=="function"&&(e.held=e.touched,e.holdAction(e.held,e.coords))}return(function(){let d=!1,p,f="";function m(){clearTimeout(p),d=!0,f!=="can-touch"&&(f="can-touch",document.documentElement.classList.add(f)),p=setTimeout(function(){d=!1},500)}function h(){!d&&f==="can-touch"&&(d=!1,f="",document.documentElement.classList.remove("can-touch"))}document.addEventListener("touchstart",m,!1),document.addEventListener("mouseover",h,!1)})(),e})();function gQe(){if(!window.dev)console.log("%c dev initialized","color: yellow"),window.dev={};else return;const t=i=>r=>i(r).then(n=>console.log(n.data),n=>console.log(n));IQe({...{getServerFactoryVersion:i=>t(POe)(i),getProviderCalendar:i=>t(QO)(i),getTournamentInfo:i=>t(_ee)(i),getEventData:i=>t($ee(i))},baseApi:Rh,context:Ku})}function IQe(t){if(typeof window?.dev=="object")try{Object.keys(t).forEach(e=>window.dev[e]=t[e])}catch{console.log("production environment")}}function vQe(){document.oncontextmenu=()=>!1,window.addEventListener("contextmenu",t=>{t.preventDefault()},!1),window.onunhandledrejection=t=>{t.preventDefault();const e=t.reason,i=e&&(e.stack||e);i&&i.indexOf("blocked")>0?console.warn("popup blocked"):console.warn("Unhandled rejection:",e&&(e.stack||e))}}const yQe="@VERSION@";const $k=typeof navigator<"u"?navigator.userAgent.toLowerCase().indexOf("firefox")>0:!1;function Bk(t,e,i,r){t.addEventListener?t.addEventListener(e,i,r):t.attachEvent&&t.attachEvent(`on${e}`,i)}function by(t,e,i,r){t&&(t.removeEventListener?t.removeEventListener(e,i,r):t.detachEvent&&t.detachEvent(`on${e}`,i))}function sme(t,e){const i=e.slice(0,e.length-1),r=[];for(let n=0;n<i.length;n++)r.push(t[i[n].toLowerCase()]);return r}function ome(t){typeof t!="string"&&(t=""),t=t.replace(/\s/g,"");const e=t.split(",");let i=e.lastIndexOf("");for(;i>=0;)e[i-1]+=",",e.splice(i,1),i=e.lastIndexOf("");return e}function bQe(t,e){const i=t.length>=e.length?t:e,r=t.length>=e.length?e:t;let n=!0;for(let a=0;a<i.length;a++)r.indexOf(i[a])===-1&&(n=!1);return n}function lme(t){let e=t.keyCode||t.which||t.charCode;return t.code&&/^Key[A-Z]$/.test(t.code)&&(e=t.code.charCodeAt(3)),e}const Sw={backspace:8,"":8,tab:9,clear:12,enter:13,"":13,return:13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,arrowup:38,arrowdown:40,arrowleft:37,arrowright:39,del:46,delete:46,ins:45,insert:45,home:36,end:35,pageup:33,pagedown:34,capslock:20,num_0:96,num_1:97,num_2:98,num_3:99,num_4:100,num_5:101,num_6:102,num_7:103,num_8:104,num_9:105,num_multiply:106,num_add:107,num_enter:108,num_subtract:109,num_decimal:110,num_divide:111,"":20,",":188,".":190,"/":191,"`":192,"-":$k?173:189,"=":$k?61:187,";":$k?59:186,"'":222,"{":219,"}":221,"[":219,"]":221,"\\":220},tl={"":16,shift:16,"":18,alt:18,option:18,"":17,ctrl:17,control:17,"":91,cmd:91,meta:91,command:91},My={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey",shiftKey:16,ctrlKey:17,altKey:18,metaKey:91},Ln={16:!1,18:!1,17:!1,91:!1},Yr={};for(let t=1;t<20;t++)Sw[`f${t}`]=111+t;let Tr=[],ob=null,$g=null,ume="all";const Zc=new Map,uy=t=>Sw[t.toLowerCase()]||tl[t.toLowerCase()]||t.toUpperCase().charCodeAt(0),wQe=t=>Object.keys(Sw).find(e=>Sw[e]===t),SQe=t=>Object.keys(tl).find(e=>tl[e]===t),cme=t=>{ume=t||"all"},Uw=()=>ume||"all",UQe=()=>Tr.slice(0),TQe=()=>Tr.map(t=>wQe(t)||SQe(t)||String.fromCharCode(t)),DQe=()=>{const t=[];return Object.keys(Yr).forEach(e=>{Yr[e].forEach(({key:i,scope:r,mods:n,shortcut:a})=>{t.push({scope:r,shortcut:a,mods:n,keys:i.split("+").map(s=>uy(s))})})}),t},dme=t=>{const e=t.target||t.srcElement,{tagName:i}=e;let r=!0;const n=i==="INPUT"&&!["checkbox","radio","range","button","file","reset","submit","color"].includes(e.type);return(e.isContentEditable||(n||i==="TEXTAREA"||i==="SELECT")&&!e.readOnly)&&(r=!1),r},PQe=t=>(typeof t=="string"&&(t=uy(t)),Tr.indexOf(t)!==-1),EQe=(t,e)=>{let i,r;t||(t=Uw());for(const n in Yr)if(Object.prototype.hasOwnProperty.call(Yr,n))for(i=Yr[n],r=0;r<i.length;)i[r].scope===t?i.splice(r,1).forEach(({element:s})=>TH(s)):r++;Uw()===t&&cme(e||"all")};function RQe(t){let e=lme(t);t.key&&t.key.toLowerCase()==="capslock"&&(e=uy(t.key));const i=Tr.indexOf(e);if(i>=0&&Tr.splice(i,1),t.key&&t.key.toLowerCase()==="meta"&&Tr.splice(0,Tr.length),(e===93||e===224)&&(e=91),e in Ln){Ln[e]=!1;for(const r in tl)tl[r]===e&&(zo[r]=!1)}}const pme=(t,...e)=>{if(typeof t>"u")Object.keys(Yr).forEach(i=>{Array.isArray(Yr[i])&&Yr[i].forEach(r=>HT(r)),delete Yr[i]}),TH(null);else if(Array.isArray(t))t.forEach(i=>{i.key&&HT(i)});else if(typeof t=="object")t.key&&HT(t);else if(typeof t=="string"){let[i,r]=e;typeof i=="function"&&(r=i,i=""),HT({key:t,scope:i,method:r,splitKey:"+"})}},HT=({key:t,scope:e,method:i,splitKey:r="+"})=>{ome(t).forEach(a=>{const s=a.split(r),o=s.length,l=s[o-1],u=l==="*"?"*":uy(l);if(!Yr[u])return;e||(e=Uw());const c=o>1?sme(tl,s):[],d=[];Yr[u]=Yr[u].filter(p=>{const m=(i?p.method===i:!0)&&p.scope===e&&bQe(p.mods,c);return m&&d.push(p.element),!m}),d.forEach(p=>TH(p))})};function $Y(t,e,i,r){if(e.element!==r)return;let n;if(e.scope===i||e.scope==="all"){n=e.mods.length>0;for(const a in Ln)Object.prototype.hasOwnProperty.call(Ln,a)&&(!Ln[a]&&e.mods.indexOf(+a)>-1||Ln[a]&&e.mods.indexOf(+a)===-1)&&(n=!1);(e.mods.length===0&&!Ln[16]&&!Ln[18]&&!Ln[17]&&!Ln[91]||n||e.shortcut==="*")&&(e.keys=[],e.keys=e.keys.concat(Tr),e.method(t,e)===!1&&(t.preventDefault?t.preventDefault():t.returnValue=!1,t.stopPropagation&&t.stopPropagation(),t.cancelBubble&&(t.cancelBubble=!0)))}}function BY(t,e){const i=Yr["*"];let r=lme(t);if(t.key&&t.key.toLowerCase()==="capslock"||!(zo.filter||dme).call(this,t))return;if((r===93||r===224)&&(r=91),Tr.indexOf(r)===-1&&r!==229&&Tr.push(r),["metaKey","ctrlKey","altKey","shiftKey"].forEach(l=>{const u=My[l];t[l]&&Tr.indexOf(u)===-1?Tr.push(u):!t[l]&&Tr.indexOf(u)>-1?Tr.splice(Tr.indexOf(u),1):l==="metaKey"&&t[l]&&(Tr=Tr.filter(c=>c in My||c===r))}),r in Ln){Ln[r]=!0;for(const l in tl)if(Object.prototype.hasOwnProperty.call(tl,l)){const u=My[tl[l]];zo[l]=t[u]}if(!i)return}for(const l in Ln)Object.prototype.hasOwnProperty.call(Ln,l)&&(Ln[l]=t[My[l]]);t.getModifierState&&!(t.altKey&&!t.ctrlKey)&&t.getModifierState("AltGraph")&&(Tr.indexOf(17)===-1&&Tr.push(17),Tr.indexOf(18)===-1&&Tr.push(18),Ln[17]=!0,Ln[18]=!0);const a=Uw();if(i)for(let l=0;l<i.length;l++)i[l].scope===a&&(t.type==="keydown"&&i[l].keydown||t.type==="keyup"&&i[l].keyup)&&$Y(t,i[l],a,e);if(!(r in Yr))return;const s=Yr[r],o=s.length;for(let l=0;l<o;l++)if((t.type==="keydown"&&s[l].keydown||t.type==="keyup"&&s[l].keyup)&&s[l].key){const u=s[l],{splitKey:c}=u,d=u.key.split(c),p=[];for(let f=0;f<d.length;f++)p.push(uy(d[f]));p.sort().join("")===Tr.sort().join("")&&$Y(t,u,a,e)}}const zo=function t(e,i,r){Tr=[];const n=ome(e);let a=[],s="all",o=document,l=0,u=!1,c=!0,d="+",p=!1,f=!1;if(r===void 0&&typeof i=="function"&&(r=i),Object.prototype.toString.call(i)==="[object Object]"){const m=i;m.scope&&(s=m.scope),m.element&&(o=m.element),m.keyup&&(u=m.keyup),m.keydown!==void 0&&(c=m.keydown),m.capture!==void 0&&(p=m.capture),typeof m.splitKey=="string"&&(d=m.splitKey),m.single===!0&&(f=!0)}for(typeof i=="string"&&(s=i),f&&pme(e,s);l<n.length;l++){const m=n[l].split(d);a=[],m.length>1&&(a=sme(tl,m));let h=m[m.length-1];h=h==="*"?"*":uy(h),h in Yr||(Yr[h]=[]),Yr[h].push({keyup:u,keydown:c,scope:s,mods:a,shortcut:n[l],method:r,key:n[l],splitKey:d,element:o})}if(typeof o<"u"&&typeof window<"u"){if(!Zc.has(o)){const m=(g=window.event)=>BY(g,o),h=(g=window.event)=>{BY(g,o),RQe(g)};Zc.set(o,{keydownListener:m,keyupListenr:h,capture:p}),Bk(o,"keydown",m,p),Bk(o,"keyup",h,p)}if(!ob){const m=()=>{Tr=[]};ob={listener:m,capture:p},Bk(window,"focus",m,p)}if(!$g&&typeof document<"u"){const m=()=>{Tr=[];for(const I in Ln)Ln[I]=!1;for(const I in tl)t[I]=!1},h=m,g=m;document.addEventListener("fullscreenchange",h),document.addEventListener("webkitfullscreenchange",g),$g={fullscreen:h,webkit:g}}}};function CQe(t,e="all"){Object.keys(Yr).forEach(i=>{Yr[i].filter(n=>n.scope===e&&n.shortcut===t).forEach(n=>{n&&n.method&&n.method({},n)})})}function TH(t){const e=Object.values(Yr).flat();if(e.findIndex(({element:r})=>r===t)<0&&t){const{keydownListener:r,keyupListenr:n,capture:a}=Zc.get(t)||{};r&&n&&(by(t,"keyup",n,a),by(t,"keydown",r,a),Zc.delete(t))}if(e.length<=0||Zc.size<=0){if(Array.from(Zc.keys()).forEach(n=>{const{keydownListener:a,keyupListenr:s,capture:o}=Zc.get(n)||{};a&&s&&(by(n,"keyup",s,o),by(n,"keydown",a,o),Zc.delete(n))}),Zc.clear(),Object.keys(Yr).forEach(n=>delete Yr[n]),ob){const{listener:n,capture:a}=ob;by(window,"focus",n,a),ob=null}$g&&typeof document<"u"&&(document.removeEventListener("fullscreenchange",$g.fullscreen),document.removeEventListener("webkitfullscreenchange",$g.webkit),$g=null)}}const Vk={getPressedKeyString:TQe,setScope:cme,getScope:Uw,deleteScope:EQe,getPressedKeyCodes:UQe,getAllKeyCodes:DQe,isPressed:PQe,filter:dme,trigger:CQe,unbind:pme,keyMap:Sw,modifier:tl,modifierMap:My};for(const t in Vk){const e=t;Object.prototype.hasOwnProperty.call(Vk,e)&&(zo[e]=Vk[e])}if(typeof window<"u"){const t=window.hotkeys;zo.noConflict=e=>(e&&window.hotkeys===zo&&(window.hotkeys=t),zo),window.hotkeys=zo}typeof Ny<"u"&&Ny.exports&&(Ny.exports=zo,Ny.exports.default=zo);const WT=[];function MQe(){dQe(),console.log(`%cversion: ${yQe}`,"color: lightblue"),zo("shift+1,shift+3,esc,/",(t,e)=>{t.preventDefault();const r=zo.shift?e.key.split(e.splitKey)[1]:e.key;r==="/"&&WT.splice(0,WT.length),WT.push(r),WT.join("")==="esc13"&&gQe()}),AE(Tw),vQe(),_Y.register("tmx-tm","mouseover",mQe),_Y.register("tmx-tm","mouseout",hQe)}const NQe=document.body;NQe.appendChild(fQe());MQe();Ku.router=uQe()});export default AQe();
//# sourceMappingURL=index-Dw4jKYj1.js.map
