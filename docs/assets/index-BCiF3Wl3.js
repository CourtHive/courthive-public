var sne=Object.defineProperty;var lne=(t,e,i)=>e in t?sne(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i;var Ve=(t,e,i)=>(lne(t,typeof e!="symbol"?e+"":e,i),i);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function i(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerPolicy&&(a.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?a.credentials="include":n.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(n){if(n.ep)return;n.ep=!0;const a=i(n);fetch(n.href,a)}})();const oG="tournament_title_block",sG="tournaments_control",pC="tournaments_table",une="tournament_events",lG="tournament_logo",sN="tournaments",_0="tournament",Dy="splash",cne=[sN,_0,Dy];var dne=Object.defineProperty,yt=(t,e)=>{for(var i in e)dne(t,i,{get:e[i],enumerable:!0})};function $0(){return"2.2.1"}var uG={};yt(uG,{competitionGovernor:()=>cG,drawsGovernor:()=>ST,entriesGovernor:()=>d4,eventGovernor:()=>I4,generationGovernor:()=>k4,matchUpFormatGovernor:()=>z4,matchUpGovernor:()=>W4,mocksGovernor:()=>ix,participantGovernor:()=>$Y,policyGovernor:()=>$6,publishingGovernor:()=>l5,queryGovernor:()=>G6,reportGovernor:()=>v5,scheduleGovernor:()=>fx,scoreGovernor:()=>VO,tieFormatGovernor:()=>C5,tournamentGovernor:()=>_5,venueGovernor:()=>J5});var cG={};yt(cG,{getLinkedTournamentIds:()=>Gy,getTournamentIds:()=>Vy,linkTournaments:()=>Zz,mutate:()=>dG,query:()=>iW,unlinkTournament:()=>tW,unlinkTournaments:()=>eW});var dG={};yt(dG,{linkTournaments:()=>Zz,unlinkTournament:()=>tW,unlinkTournaments:()=>eW});var qp="SINGLES",ti="SINGLES",Md="DOUBLES",Zt="DOUBLES",ka="TEAM",hi="TEAM",pne={SINGLES_MATCHUP:qp,SINGLES:ti,DOUBLES_MATCHUP:Md,DOUBLES:Zt,TEAM_MATCHUP:ka,TEAM:hi},pG={[ti]:[ti,"S"],[Zt]:[Zt,"D"],[hi]:[hi,"T"],S:[ti,"S"],D:[Zt,"D"],T:[hi,"T"]};function or(t,e){return(t??0)-(e??0)}function Qe(t){return typeof t=="number"?parseInt(t.toString()):typeof t=="string"?parseInt(t):0}function Ss(t){return isNaN(t)?!1:t&&(t&t-1)===0}function wB(t){if(!t.length)return;let e=[...t].sort(or),i=Math.floor(e.length/2);return e.length%2?e[i]:(e[i-1]+e[i])/2}function mne(t){if(!Ss(t))return!1;let e=t,i=1;for(;e!==2;)i+=1,e=e/2;return i}function lN(t){return isNaN(t)?0:t%2&&t+1||t}function uN(t){return Math.pow(2,Math.round(Math.log(t)/Math.log(2)))}function Li(t){return!isNaN(parseFloat(t))}function mG(t){let e=Qe(t);if(!isNaN(e))return e===0?!1:(e&-e)===1}function Sg(t){if(isNaN(t))return!1;for(;!Ss(t);)t++;return t}function to(t,e){return t=Math.ceil(t),e=Math.floor(e),Math.floor(Math.random()*(e-t+1))+t}function ot(t){return Number.isSafeInteger(typeof t=="string"?+t:t)}function hne(t=1,e=3,i=!0){let r=0;for(let n=0;n<e;n++)r+=Math.random()*(t/e);return i&&t>1?Math.round(r):r}function fne(t,e){e||(e=1);let i=1/e;return Math.round(t*i)/i}function hG(t,e,i,r,n=2){let a=1-Math.random(),o=1-Math.random(),s=Math.sqrt(-2*Math.log(a))*Math.cos(2*Math.PI*o);return s=s/10+.5,s>1||s<0?s=hG(t,e,i):(s=Math.pow(s,i),s*=e-t,s+=t),r&&(s=fne(s,r)),parseFloat(s.toFixed(n))}function uS(t,e=2){return parseFloat(Number(Math.round(t*1e3)/1e3).toFixed(e))}function ct(t){return Array.isArray(t)?t==null?void 0:t.filter((e,i,r)=>r.lastIndexOf(e)===i):[]}function gne(t){return Array.isArray(t)?t==null?void 0:t.map(e=>e===null?void 0:e):t}function wn(t){return Array.isArray(t)?t.map(e=>[Math.random(),e]).sort((e,i)=>e[0]-i[0]).map(e=>e[1]):[]}function Sf(t){return ot(t)?t:1/0}function wa(t){return Array.isArray(t)?t.reduce((e,i)=>(e[i]||(e[i]=0),e[i]++,e),{}):{}}function vne(t){return fG(wa(t))}function fG(t){return Object.keys(t).reduce((e,i)=>{let r=t[i];return e[r]?e[r].push(i):e[r]=[i],e},{})}function Ine(t,e,i){return i.indexOf(t)===e}function gG(t){return t.filter(Ine)}function fa(t){return Array.isArray(t)&&t.length?t.splice(Math.floor(Math.random()*t.length),1)[0]:void 0}function pa(t){let e=Math.floor(Math.random()*t.length);return t[e]}function Se(t,e){return Array.from({length:e-t},(i,r)=>r+t)}function Gs(t,e){return e.reduce((i,r,n)=>(r===t&&i.push(n),i),[])}function Vi(t,e){return!Array.isArray(t)||!Array.isArray(e)?[]:t.filter(i=>e.indexOf(i)!==-1).filter((i,r,n)=>n.indexOf(i)===r)}function UB(t,e){return!Array.isArray(t)||!Array.isArray(e)?[]:t.filter(i=>!e.includes(i))}function Rn(t,e){return!Array.isArray(t)||!Array.isArray(e)?!1:t.some(i=>e.includes(i))}function yne(t,e){return Array.isArray(e)&&e.reduce((i,r)=>(i[r]=1+i[r]||1,i),{})[t]||0}function bne(t,e,i,r){return Array.isArray(t)?[].concat(...t.slice(0,e),...t.slice(e,e+i).sort(r),...t.slice(e+i,t.length)):[]}function Rr(t,e){return Array.isArray(t)?t.reduce((i,r,n)=>{let a=Math.floor(n/e);return i[a]=[].concat(i[a]||[],r),i},[]):[]}function vG(t,[e,...i]){return t.length?[t.slice(0,e),...vG(t.slice(e),[...i,e])]:[]}function wne(t){return t.reduce((e,i)=>{let r=e[e.length-1];return(!r||r[r.length-1]!==i-1)&&e.push([]),e[e.length-1].push(i),e},[])}function IG(t){return Array.isArray(t)?t.reduce((e,i)=>!isNaN(parseInt(i))&&e,!0):!1}function yG(t){return Array.isArray(t)?t.reduce((e,i)=>isNaN(parseInt(i))&&e,!0):!1}function mC(t,e,i){return Array.isArray(t)?t.reduce((r,n,a)=>{let o=i?!!(Math.floor(a/e)%2):!1,s=a%e,l=o?e-1-s:s;return r[l]||(r[l]=[]),r[l].push(n),r},[]):[]}function Une(t,e=1){if(!Array.isArray(t)||!t.every(ot))return[];let i=Math.min(...t,e),r=Math.max(...t);return Se(i,r+1).filter(n=>!t.includes(n))}function ma(t){return typeof t=="function"}function Ti(t){return typeof t=="string"}function Nt(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)}function Sne(t,e){if(!Nt(t)||!Nt(e))return!1;let i=Object.keys(t),r=Object.keys(e);if(i.length!==r.length)return!1;for(let n of i)if(t[n]!==e[n])return!1;return!0}function bG(t,e){return Array.isArray(t)?Object.assign({},...(t??[]).filter(Nt).map(i=>i[e]&&{[i[e]]:i}).filter(Boolean)):{}}var Tne=t=>e=>Object.keys(t).every(i=>e[i]===t[i]);function hC(t,e){if(t===void 0)return null;if(!Nt(t)||t===null)return t;let i=Object.keys(t),r=n=>n===void 0?null:n;return Object.assign({},...i.map(n=>Array.isArray(t[n])?{[n]:e?t[n]:t[n].map(a=>hC(a))}:{[n]:e?r(t[n]):hC(t[n])}))}function fC(t){return Array.isArray(t)?t.length+t.map(fC).reduce((e,i)=>e+i,0):Nt(t)&&t!==null?Object.keys(t).length+Object.keys(t).map(e=>fC(t[e])).reduce((e,i)=>e+i,0):0}function Dne(t){if(t===null||typeof t!="object")return;let e=JSON.stringify(t),i=fC(t),r=e.split("").reduce((n,a)=>n+a.charCodeAt(0),0);return[e.length,i,r].map(n=>n.toString(36)).join("")}function B0(t,e){return!Array.isArray(t)||!Ti(e)?!1:Vi(t,pG[e]).length}var J={success:!0},wG="error",Pne={SUCCESS:J,ERROR:wG};function UG({collectionValueProfiles:t,matchUpCount:e}){let i=[];if(!Array.isArray(t))return i.push(`collectionValueProfiles is not an array: ${t}`),{errors:i};if(t.length&&t.length!==e)return i.push("collectionValueProfiles do not align with matchUpsCount"),{errors:i};for(let n of t){if(typeof n!="object")return i.push(`valueProfile is not type object: ${n}`),{errors:i};let{matchUpValue:a,collectionPosition:o}=n;if(typeof a!="number"||typeof o!="number"||o>e||o<1)return i.push("Invalid value profile: value and collectionPosition must be numeric. collectionPosition cannot be greater than matchUpCount"),{errors:i}}let r=t.map(n=>n.collectionPosition);return r.length!==ct(r).length?(i.push("collectionPositions are not unique"),{errors:i}):{...J}}var Rne={};yt(Rne,{addNotice:()=>lt,callListener:()=>DC,createInstanceState:()=>lae,cycleMutationStatus:()=>_N,deepCopyEnabled:()=>LN,deleteNotice:()=>$N,deleteNotices:()=>Ny,disableNotifications:()=>OH,enableNotifications:()=>PU,getDevContext:()=>Fa,getMethods:()=>FH,getNotices:()=>LH,getProvider:()=>PC,getTopics:()=>vo,getTournamentId:()=>qm,getTournamentRecord:()=>BN,getTournamentRecords:()=>Ym,globalLog:()=>BH,handleCaughtError:()=>rT,hasTopic:()=>tT,removeTournamentRecord:()=>$H,setDeepCopy:()=>wI,setDevContext:()=>bI,setGlobalLog:()=>AH,setGlobalMethods:()=>kH,setGlobalSubscriptions:()=>cae,setMethods:()=>xH,setStateMethods:()=>VH,setStateProvider:()=>sae,setSubscriptions:()=>dae,setTournamentId:()=>UI,setTournamentRecord:()=>_H,setTournamentRecords:()=>iT,timeKeeper:()=>uae});var gC={message:"Chronological error; time violation.",code:"ANACHRONISM"},II={message:"Duplicate entry",code:"DUPLICATE_ENTRY"},SG={message:"Cannot remove main structure",code:"ERR_CANNOT_REMOVE_MAIN_STRUCTURE"},vC={message:"records must be an object with tournamentId keys",code:"ERR_INVALID_TOURNAMENTS"},ki={message:"Missing tournamentRecords",code:"ERR_MISSING_TOURNAMENTS"},ge={message:"Missing tournamentRecord",code:"ERR_MISSING_TOURNAMENT"},Py={message:"Invalid tournamentRecord",code:"ERR_INVALID_TOURNAMENT"},Tf={message:"Missing tournamentId",code:"ERR_MISSING_TOURNAMENT_ID"},Yp={message:"Invalid drawDefinition",code:"ERR_INVALID_DRAWDEF"},_e={message:"Missing drawDefinition",code:"ERR_MISSING_DRAWDEF"},TG={message:"Existing drawDefinition(s)",code:"ERR_EXISTING_DRAWDEFS"},xa={message:"drawDefinition not found",code:"ERR_NOT_FOUND_DRAWDEF"},sp={message:"Invalid structure",code:"ERR_INVALID_STRUCTURE"},cN={message:"Incomplete source structure",code:"ERR_INCOMPLETE_STRUCTURE"},dN={message:"Invalid drawPosition for seedAssignment",code:"ERR_INVALID_SEEDING_POSITION"},Df={message:"drawPosition already assigned",code:"ERR_EXISTING_POSITION_ASSIGNMENT"},DG={message:"Schedule not cleared",code:"ERR_UNCHANGED_SCHEDULE_NOT_CLEARED"},PG={message:"drawPosition not cleared",code:"ERR_FAILURE_POSITION_NOT_CLEARED"},Ene={message:"drawPosition not found",code:"ERR_NOT_FOUND_DRAW_POSITION"},pN={message:"Unrecognized drawType",code:"ERR_UNRECOGNIZED_DRAW_TYPE"},Ry={message:"Missing drawPositions",code:"ERR_MISSING_DRAW_POSITIONS"},V0={message:"drawPosition is active",code:"ERR_ACTIVE_DRAW_POSITION"},Cne={message:"drawPosition is occupied",code:"ERR_OCCUPIED_DRAW_POSITION"},Tg={message:"Invlid drawPosition",code:"ERR_INVALID_DRAW_POSITION"},Dg={message:"Missing drawPosition",code:"ERR_MISSING_DRAW_POSITION"},mN={message:"Invalid drawType",code:"ERR_INVALID_DRAW_TYPE"},j0={message:"Invalid drawSize",code:"ERR_INVALID_DRAW_SIZE"},hN={message:"Cannot set drawSize to be less than existing entries",code:"ERR_INVALID_DRAW_SIZE_MISMATCH"},Ey={message:"Missing drawSize",code:"ERR_MISSING_DRAW_SIZE"},xs={message:"Missing drawId",code:"ERR_MISSING_DRAW_ID"},RG={message:"drawId exists",code:"ERR_EXISTING_DRAW_ID"},EG={message:"participantId cannot be assigned to multiple seedNumbers",code:"INVALID_PARTICIPANT_SEEDING"},CG={message:"seedsCount greater than drawSize",code:"ERR_INVALID_SEED_COUNT"},MG={message:"Missing seedCountThresholds",code:"ERR_MISSING_SEED_COUNT_THRESHOLD"},NG={message:"Invalid action",code:"ERR_INVALID_ACTION"},IC={message:"Invalid assignment",code:"ERR_INVALID_ASSIGNMENT"},AG={message:"Missing seedAssignments",code:"ERR_MISSING_SEED_ASSIGNMENTS"},OG={message:"Invalid seedNumber",code:"ERR_INVALID_SEED_NUMBER"},kG={message:"Invalid seedPosition",code:"ERR_INVALID_SEED_POSITION"},fN={message:"Missing targetLink",code:"ERR_MISSING_LINK_TARGET"},xG={message:"Existing round",code:"ERR_EXISTING_ROUND"},Mne={message:"Missing roundNumber",code:"ERR_MISSING_ROUND_NUMBER"},za={message:"Missing structureId",code:"ERR_MISSING_STRUCTURE_ID"},Mi={message:"structure not found",code:"ERR_NOT_FOUND_STRUCTURE"},gN={message:"Missing structures",code:"ERR_MISSING_STRUCTURES"},lp={message:"Missing structure",code:"ERR_MISSING_STRUCTURE"},FG={message:"drawDefinition contains unlinked structures",code:"ERR_MISSING_STRUCTURE_LINKS"},Bl={message:"Invalid eventType",code:"ERR_INVALID_EVENT_TYPE"},gi={message:"Missing event / eventId",code:"ERR_MISSING_EVENT_ID"},lo={message:"Event not found",code:"ERR_NOT_FOUND_EVENT"},LG={message:"Event exists",code:"ERR_EXISTING_EVENT"},_G={message:"Missing entries",code:"ERR_MISSING_ENTRIES"},$G={message:"Invalid entries",code:"ERR_INVALID_ENTRIES"},vN={message:"Missing assignments",code:"ERR_MISSING_ASSIGNMENTS"},BG={message:"Missing stage",code:"ERR_MISSING_STAGE"},up={message:"Invalid stage",code:"ERR_INVALID_STAGE"},VG={message:"stageSequence limit",code:"ERR_LIMIT_STAGE_SEQUENCE"},jG={message:"Missing positionAssignments",code:"ERR_MISSING_POSITION_ASSIGNMENTS"},GG={message:"Cannot Assign BYE status if no assignment: { bye: true }",code:"ERR_UNCHANGED_CANNOT_ASSIGN_BYE"},yC={message:"Unrecognized matchUpStatus",code:"ERR_UNRECOGNIZED_MATCHUP_STATUS"},Cy={message:"Unrecognized matchUpFormat",code:"ERR_UNRECOGNIZED_MATCHUP_FORMAT"},TU={message:"Incompatible matchUpStatus",code:"ERR_INCOMPATIBLE_MATCHUP_STATUS"},Pg={message:"Invalid matchUpStatus",code:"ERR_INVALID_MATCHUP_STATUS"},Pl={message:"Invalid tieFormat",code:"ERR_INVALID_TIE_FORMAT"},IN={message:"Invalid matchUpFormat",code:"ERR_INVALID_MATCHUP_FORMAT"},yN={message:"Missing matchUpFormat",code:"ERR_MISSING_MATCHUP_FORMAT"},HG={message:"Missing collectionDefinition",code:"ERR_MISSING_COLLECTION_DEFINITION"},Rg={message:"Missing tieFormat",code:"ERR_MISSING_TIE_FORMAT"},yn={message:"Missing matchUpId",code:"ERR_MISSING_MATCHUP_ID"},jm={message:"Missing matchUpIds",code:"ERR_MISSING_MATCHUP_IDS"},dn={message:"matchUp not found",code:"ERR_NOT_FOUND_MATCHUP"},ju={message:"Missing matchUps",code:"ERR_MISSING_MATCHUPS"},na={message:"Missing matchUp",code:"ERR_MISSING_MATCHUP"},aa={message:"Invalid matchUp",code:"ERR_INVALID_MATCHUP"},bN={message:"Missing policyType",code:"ERR_MISSING_POLICY_TYPE"},G0={message:"Missing policyDefinitions",code:"ERR_MISSING_POLICY_DEFINITIONS"},Nne={message:"Missing seeding policy",code:"ERR_MISSING_POLICY_SEEDING"},zG={message:"Missing avoidance policy",code:"ERR_MISSING_POLICY_AVOIDANCE"},wN={message:"Missing policy attributes",code:"ERR_MISSING_POLICY_ATTRIBUTES"},WG={message:"Invalid policyDefinitions",code:"ERR_INVALID_POLICY_DEFINITIONS"},UN={message:"existing policyType",code:"ERR_EXISTING_POLICY_TYPE"},Ane={message:"Policy not attached",code:"ERR_FAILURE_POLICY_NOT_ATTACHED"},Kp={message:"Policy not found",code:"ERR_NOT_FOUND_POLICY"},One={message:"Missing scoring policy / matchUpFormats",code:"ERR_MISSING_POLICY_SCORING_MATCHUP_FORMATS"},SN={message:"Invalid sideNumber",code:"ERR_INVALID_SIDE_NUMBER"},kne={message:"Invalid setNumber",code:"ERR_INVALID_SET_NUMBER"},H0={message:"Missing setObject",code:"ERR_MISSING_SET_ATTRIBUTE"},xne={message:"Missing setNumber",code:"ERR_MISSING_SET_NUMBER"},Fne={message:"Missing sideNumber",code:"ERR_MISSING_SIDE_NUMBER"},Gm={message:"Missing courtId",code:"ERR_MISSING_COURT_ID"},Xe={message:"Missing value",code:"ERR_MISSING_VALUE"},qG={message:"Missing birthdate",code:"ERR_MISSING_BIRTH_DATE"},YG={message:"Missing date",code:"ERR_MISSING_DATE"},KG={message:"No valid dates",code:"ERR_NO_VALID_DATES"},cS={message:"Invalid bookings",code:"ERR_INVALID_BOOKINGS"},DU={message:"Invalid dateAvailability",code:"ERR_INVALID_DATE_AVAILABILITY"},XG={message:"Missing dateAvailability",code:"ERR_MISSING_DATE_AVAILABILITY"},Ar={message:"Invalid Date",code:"ERR_INVALID_DATE"},No={message:"Invalid time",code:"ERR_INVALID_TIME"},JG={message:"Invalid tournament dates",code:"ERR_INVALID_DATES_TOURNAMENT"},bC={message:"Invalid game scores",code:"ERR_INVALID_SCORES_GAME"},QG={message:"Invalid score",code:"ERR_INVALID_SCORE"},z0={message:"Invalid winningSide",code:"ERR_INVALID_WINNING_SIDE"},Lne={message:"No participants generated",code:"ERR_NO_PARTICIPANTS_GENERATED"},TN={message:"Cannot modify tieFormat",code:"ERR_UNCHANGED_CANNOT_MODIFY_TIEFORMAT"},ZG={message:"Cannot modify participantType",code:"ERR_UNCHANGED_CANNOT_MODIFY_PARTICIPANT_TYPE"},W0={message:"Cannot remove participants",code:"ERR_UNCHANGED_CANNOT_REMOVE_PARTICIPANTS"},wC={message:"Participant category mismatch",code:"ERR_CATEGORY_MISMATCH"},q0={message:"Cannot change winningSide",code:"ERR_UNCHANGED_CANNOT_CHANGE_WINNING_SIDE"},Hm={message:"Invalid participant",code:"ERR_INVALID_PARTICIPANT"},Ts={message:"Invalid participantId",code:"ERR_INVALID_PARTICIPANT_ID"},va={message:"Invalid participantIds",code:"ERR_INVALID_PARTICIPANT_IDS"},eH={message:"Invalid participantRole",code:"ERR_INVALID_PARTICIPANT_ROLE"},Ds={message:"Invalid participantType",code:"ERR_INVALID_PARTICIPANT_TYPE"},tH={message:"Missing participantRole",code:"ERR_MISSING_PARTICIPANT_ROLE"},zm={message:"Missing participant",code:"ERR_MISSING_PARTICIPANT"},My={message:"Missing participants",code:"ERR_MISSING_PARTICIPANTS"},pr={message:"Missing participantId",code:"ERR_MISSING_PARTICIPANT_ID"},zi={message:"Participant Not Found",code:"ERR_NOT_FOUND_PARTICIPANT"},iH={message:"participantId exists",code:"ERR_EXISTING_PARTICIPANT_ID"},_ne={message:"participant pair exists",code:"ERR_EXISTING_PARTICIPANT_PAIR"},rH={message:"No participant removed",code:"ERR_UNCHANGED_NO_PARTICIPANT_REMOVED"},Vc={message:"Missing participantIds",code:"ERR_MISSING_PARTICIPANT_IDS"},nH={message:"Missing participantsCount",code:"ERR_MISSING_PARTICIPANT_COUNT"},aH={message:"Participant not checked in",code:"ERR_UNCHANGED_PARTICIPANT_NOT_CHECKED_IN"},oH={message:"Missing person details",code:"ERR_MISSING_PERSON_DETAILS"},Eg={message:"Existing participant drawPosition assignment",code:"ERR_EXISTING_PARTICIPANT_DRAW_POSITION_ASSIGNMENT"},Y0={message:"Existing participant",code:"ERR_EXISTING_PARTICIPANT"},DN={message:"participantsCount exceeds drawSize",code:"ERR_INVALID_PARTICIPANT_COUNT"},UC={message:"Invalid entry status",code:"ERR_INVALID_ENTRY_STATUS"},sH={message:"Participant Entry Not Found",code:"ERR_NOT_FOUND_PARTICIPANT_ENTRY"},$ne={message:"Participant not entered in stage",code:"ERR_UNCHANGED_PARTICIPANT_NOT_ENTERED"},Bne={message:"Participant not found in stageSequence",code:"ERR_NOT_FOUND_PARTICIPANT_IN_STAGE"},lH={message:"entryStatus not allowed in stage",code:"ERR_INVALID_ENTRY_STATUS_IN_STAGE"},uH={message:"entryStatus not allowed for event",code:"ERR_INVALID_ENTRY_STATUS_IN_EVENT"},SC={message:"No stage space available for entryStatus",code:"ERR_UNCHANGED_NO_AVAILABLE_STAGE_SPACE"},cH={message:"Insufficient drawPositions to accommodate qualifiers",code:"ERR_UNCHANGED_NO_DRAW_POSITIONS_FOR_QUALIFIERS"},PN={message:"Insufficient drawPositions to accommodate entries",code:"ERR_INSUFFICIENT_DRAW_POSITIONS"},dH={message:"Missing penaltyType",code:"ERR_MISSING_PENALTY_TYPE"},RN={message:"Missing penaltyId",code:"ERR_MISSING_PENALTY_ID"},Pf={message:"Penalty not found",code:"ERR_NOT_FOUND_PENALTY"},pH={message:"Missing courtsCount/courtNames",code:"ERR_MISSING_COURTS_INFO"},Cg={message:"Court not found",code:"ERR_NOT_FOUND_COURT"},mH={message:"Court exists",code:"ERR_EXISTING_COURT"},hH={message:"Venue exists",code:"ERR_EXISTING_VENUE"},Wm={message:"Venue not found",code:"ERR_NOT_FOUND_VENUE"},jc={message:"Missing venueId",code:"ERR_MISSING_VENUE_ID"},fH={message:"Invalid endTime",code:"ERR_INVALID_END_TIME"},EN={message:"Existing endTime",code:"ERR_EXISTING_END_TIME"},gH={message:"Invalid stopTime",code:"ERR_INVALID_STOP_TIME"},vH={message:"Invalid startTime",code:"ERR_INVALID_START_TIME"},Vne={message:"Invalid resumeTime",code:"ERR_INVALID_RESUME_TIME"},CN={message:"Invalid timeItem",code:"ERR_INVALID_TIME_ITEMS"},IH={message:"Missing async state provider",code:"ERR_MISSING_ASYNC_STATE_PROVIDER"},MN={message:"Missing timeItem",code:"ERR_MISSING_TIME_ITEM"},NN={message:"Missing timeItems",code:"ERR_MISSING_TIME_ITEMS"},K0={message:"Missing context",code:"ERR_MISSING_CONTEXT"},yH={message:"Missing schedule",code:"ERR_MISSING_SCHEDULE"},gm={message:"Invalid scaleItem",code:"ERR_INVALID_SCALE_ITEM"},bH={message:"Modifications failed",code:"ERR_FAILURE_MODIFICATIONS"},Mg={message:"No modifications applied",code:"ERR_UNCHANGED_NO_MODIFICATIONS_APPLIED"},wH={message:"Unable to assign court",code:"ERR_UNCHANGED_COURT_NOT_ASSIGNED"},X0={message:"No Candidates",code:"ERR_UNCHANGED_NO_CANDIDATES"},UH={message:"Invalid configuration",code:"ERR_INVALID_CONFIG"},SH={message:"Invalid collectionDefinition",code:"ERR_INVALID_COLLECTION_DEFINITION"},Gu={message:"Invalid object",code:"ERR_INVALID_OBJECT"},zv={message:"Invalid gender",code:"ERR_INVALID_GENDER"},yI={message:"Invalid category",code:"ERR_INVALID_CATEGORY"},oe={message:"Invalid values",code:"ERR_INVALID_VALUES"},TH={message:"Duplicate value",code:"ERR_DUPLICATE_VALUE"},AN={message:"Team not found",code:"ERR_NOT_FOUND_TEAM"},DH={message:"No valid actions",code:"ERR_NO_VALID_ACTIONS"},J0={message:"No valid attributes",code:"ERR_NO_VALID_ATTRIBUTES"},ON={message:"Value unchanged",code:"ABORT_UNCHANGED"},$r={message:"Not found",code:"ERR_NOT_FOUND"},Q0={message:"Not implemented",code:"ERR_NOT_IMPLEMENTED"},PH={message:"Existing flight",code:"ERR_EXISTING_FLIGHT"},kN={message:"Existing flight profile",code:"ERR_EXISTING_FLIGHT_PROFILE"},RH={message:"Existing outcome",code:"ERR_EXISTING_OUTCOME"},EH={message:"Existing matchUpId",code:"ERR_EXISTING_MATCHUP_ID"},TC={message:"Existing stage",code:"ERR_EXISTING_STAGE"},xN={message:"Existing structure",code:"ERR_EXISTING_STRUCTURE"},Z0={message:"Method not found",code:"ERR_NOT_FOUND_METHOD"},CH={message:"Scheduled matchUps",code:"ERR_SCHEDULED_MATCHUPS"},eT={message:"Scores present",code:"ERR_SCORES_PRESENT"},jne={ANACHRONISM:gC,CANNOT_CHANGE_WINNING_SIDE:q0,CANNOT_MODIFY_TIEFORMAT:TN,CANNOT_MODIFY_PARTICIPANT_TYPE:ZG,CANNOT_REMOVE_MAIN_STRUCTURE:SG,CANNOT_REMOVE_PARTICIPANTS:W0,CATEGORY_MISMATCH:wC,COURT_EXISTS:mH,COURT_NOT_FOUND:Cg,DRAW_DEFINITION_NOT_FOUND:xa,DRAW_ID_EXISTS:RG,DRAW_POSITION_ACTIVE:V0,DRAW_POSITION_ASSIGNED:Df,DRAW_POSITION_NOT_CLEARED:PG,DRAW_POSITION_NOT_FOUND:Ene,DRAW_SIZE_MISMATCH:hN,DUPLICATE_ENTRY:II,DUPLICATE_VALUE:TH,ENTRY_STATUS_NOT_ALLOWED_FOR_EVENT:uH,ENTRY_STATUS_NOT_ALLOWED_IN_STAGE:lH,EVENT_EXISTS:LG,EVENT_NOT_FOUND:lo,EXISTING_DRAW_DEFINITIONS:TG,EXISTING_END_TIME:EN,EXISTING_FLIGHT:PH,EXISTING_MATCHUP_ID:EH,EXISTING_OUTCOME:RH,EXISTING_PARTICIPANT_DRAW_POSITION_ASSIGNMENT:Eg,EXISTING_PARTICIPANT:Y0,EXISTING_POLICY_TYPE:UN,EXISTING_PROFILE:kN,EXISTING_ROUND:xG,EXISTING_STAGE:TC,EXISTING_STRUCTURE:xN,INCOMPATIBLE_MATCHUP_STATUS:TU,INCOMPLETE_SOURCE_STRUCTURE:cN,INSUFFICIENT_DRAW_POSITIONS:PN,INVALID_ACTION:NG,INVALID_ASSIGNMENT:IC,INVALID_BOOKINGS:cS,INVALID_CATEGORY:yI,INVALID_COLLECTION_DEFINITION:SH,INVALID_CONFIGURATION:UH,INVALID_DATE_AVAILABILITY:DU,INVALID_DATE:Ar,INVALID_DRAW_DEFINITION:Yp,INVALID_DRAW_POSITION_FOR_SEEDING:dN,INVALID_DRAW_POSITION:Tg,INVALID_DRAW_SIZE:j0,INVALID_END_TIME:fH,INVALID_ENTRIES:$G,INVALID_EVENT_TYPE:Bl,INVALID_GAME_SCORES:bC,INVALID_GENDER:zv,INVALID_MATCHUP_FORMAT:IN,INVALID_MATCHUP_STATUS:Pg,INVALID_MATCHUP_STATUS_BYE:GG,INVALID_MATCHUP:aa,INVALID_OBJECT:Gu,INVALID_PARTICIPANT_ID:Ts,INVALID_PARTICIPANT_IDS:va,INVALID_PARTICIPANT_ROLE:eH,INVALID_PARTICIPANT_SEEDING:EG,INVALID_PARTICIPANT_TYPE:Ds,INVALID_PARTICIPANT:Hm,INVALID_POLICY_DEFINITION:WG,INVALID_RECORDS:vC,INVALID_SCALE_ITEM:gm,INVALID_SEED_NUMBER:OG,INVALID_SEED_POSITION:kG,INVALID_SET_NUMBER:kne,INVALID_SIDE_NUMBER:SN,INVALID_SCORE:QG,INVALID_STAGE:up,INVALID_START_TIME:vH,INVALID_STRUCTURE:sp,INVALID_STOP_TIME:gH,INVALID_TIE_FORMAT:Pl,INVALID_TIME:No,INVALID_TIME_ITEM:CN,INVALID_TOURNAMENT_DATES:JG,INVALID_TOURNAMENT_RECORD:Py,INVALID_VALUES:oe,INVALID_WINNING_SIDE:z0,MATCHUP_NOT_FOUND:dn,METHOD_NOT_FOUND:Z0,MISSING_ASSIGNMENTS:vN,MISSING_ASYNC_STATE_PROVIDER:IH,MISSING_AVOIDANCE_POLICY:zG,MISSING_BIRTH_DATE:qG,MISSING_COLLECTION_DEFINITION:HG,MISSING_COURT_ID:Gm,MISSING_COURTS_INFO:pH,MISSING_DATE_AVAILABILITY:XG,MISSING_DATE:YG,MISSING_DRAW_DEFINITION:_e,MISSING_DRAW_ID:xs,MISSING_DRAW_POSITION:Dg,MISSING_DRAW_POSITIONS:Ry,MISSING_DRAW_SIZE:Ey,MISSING_ENTRIES:_G,MISSING_EVENT:gi,MISSING_MATCHUP_FORMAT:yN,MISSING_MATCHUP_ID:yn,MISSING_MATCHUP_IDS:jm,MISSING_MATCHUP:na,MISSING_MATCHUPS:ju,MISSING_PARTICIPANT_COUNT:nH,MISSING_PARTICIPANT_ID:pr,MISSING_PARTICIPANT_IDS:Vc,MISSING_PARTICIPANT_ROLE:tH,MISSING_PARTICIPANT:zm,MISSING_PARTICIPANTS:My,MISSING_PENALTY_ID:RN,MISSING_PENALTY_TYPE:dH,MISSING_PERSON_DETAILS:oH,MISSING_POLICY_ATTRIBUTES:wN,MISSING_POLICY_DEFINITION:G0,MISSING_POLICY_TYPE:bN,MISSING_POSITION_ASSIGNMENTS:jG,MISSING_ROUND_NUMBER:Mne,MISSING_SCHEDULE:yH,MISSING_SCORING_POLICY:One,MISSING_SEED_ASSIGNMENTS:AG,MISSING_SEEDCOUNT_THRESHOLDS:MG,MISSING_SEEDING_POLICY:Nne,MISSING_SET_NUMBER:xne,MISSING_SET_OBJECT:H0,MISSING_SIDE_NUMBER:Fne,MISSING_STAGE:BG,MISSING_STRUCTURE_ID:za,MISSING_STRUCTURE:lp,MISSING_STRUCTURES:gN,MISSING_TARGET_LINK:fN,MISSING_TIE_FORMAT:Rg,MISSING_TIME_ITEM:MN,MISSING_TIME_ITEMS:NN,MISSING_TOURNAMENT_ID:Tf,MISSING_TOURNAMENT_RECORD:ge,MISSING_TOURNAMENT_RECORDS:ki,MISSING_VALUE:Xe,MISSING_VENUE_ID:jc,MODIFICATIONS_FAILED:bH,NO_CANDIDATES:X0,NO_DRAW_POSITIONS_AVAILABLE_FOR_QUALIFIERS:cH,NO_MODIFICATIONS_APPLIED:Mg,NO_STAGE_SPACE_AVAILABLE_FOR_ENTRY_STATUS:SC,NO_PARTICIPANT_REMOVED:rH,NO_VALID_ACTIONS:DH,NO_VALID_ATTRIBUTES:J0,NO_VALID_DATES:KG,NOT_FOUND:$r,NOT_IMPLEMENTED:Q0,PARTICIPANT_COUNT_EXCEEDS_DRAW_SIZE:DN,PARTICIPANT_ID_EXISTS:iH,PARTICIPANT_NOT_CHECKED_IN:aH,PARTICIPANT_NOT_FOUND:zi,PARTICIPANT_PAIR_EXISTS:_ne,PENALTY_NOT_FOUND:Pf,POLICY_NOT_ATTACHED:Ane,POLICY_NOT_FOUND:Kp,SCHEDULE_NOT_CLEARED:DG,SCHEDULED_MATCHUPS:CH,SCORES_PRESENT:eT,SEEDSCOUNT_GREATER_THAN_DRAW_SIZE:CG,STAGE_SEQUENCE_LIMIT:VG,STRUCTURE_NOT_FOUND:Mi,TEAM_NOT_FOUND:AN,UNABLE_TO_ASSIGN_COURT:wH,UNLINKED_STRUCTURES:FG,UNRECOGNIZED_DRAW_TYPE:pN,UNRECOGNIZED_MATCHUP_FORMAT:Cy,UNRECOGNIZED_MATCHUP_STATUS:yC,VALUE_UNCHANGED:ON,VENUE_EXISTS:hH},Pi={disableNotifications:!1,tournamentId:void 0,tournamentRecords:{},subscriptions:{},modified:!1,methods:{},notices:[]},MH={addNotice:eae,callListener:aae,cycleMutationStatus:Zne,deleteNotice:rae,deleteNotices:iae,disableNotifications:Gne,enableNotifications:Hne,getMethods:FN,getNotices:tae,getTopics:nae,getTournamentId:NH,getTournamentRecord:zne,getTournamentRecords:Wne,removeTournamentRecord:Xne,setMethods:Qne,setSubscriptions:Jne,setTournamentId:Yne,setTournamentRecord:qne,setTournamentRecords:Kne,handleCaughtError:oae};function Gne(){Pi.disableNotifications=!0}function Hne(){Pi.disableNotifications=!1}function NH(){return Pi.tournamentId}function zne(t){return Pi.tournamentRecords[t]}function Wne(){return Pi.tournamentRecords}function qne(t){let e=t==null?void 0:t.tournamentId;return e?(Pi.tournamentRecords[e]=t,{success:!0}):{error:Py}}function Yne(t){return t?Pi.tournamentRecords[t]?(Pi.tournamentId=t,{success:!0}):{error:ge}:(Pi.tournamentId=void 0,{success:!0})}function Kne(t){Pi.tournamentRecords=t;let e=Object.keys(t);e.length===1?Pi.tournamentId=e[0]:e.length||(Pi.tournamentId=void 0)}function Xne(t){if(typeof t!="string")return{error:oe};if(!Pi.tournamentRecords[t])return{error:$r};delete Pi.tournamentRecords[t];let e=Object.keys(Pi.tournamentRecords);return e.length===1?Pi.tournamentId=e[0]:e.length||(Pi.tournamentId=void 0),{success:!0}}function Jne(t){return typeof t.subscriptions!="object"?{error:oe}:(Object.keys(t.subscriptions).forEach(e=>{typeof t.subscriptions[e]=="function"?Pi.subscriptions[e]=t.subscriptions[e]:delete Pi.subscriptions[e]}),{...J})}function Qne(t){return typeof t!="object"?{error:oe}:(Object.keys(t).forEach(e=>{typeof t[e]=="function"&&(Pi.methods[e]=t[e])}),{...J})}function Zne(){let t=Pi.modified;return Pi.modified=!1,t}function eae({topic:t,payload:e,key:i},r){if(!(typeof t!="string"||typeof e!="object")&&(Pi.disableNotifications||(Pi.modified=!0),!(Pi.disableNotifications||!Pi.subscriptions[t]&&!r)))return i&&(Pi.notices=Pi.notices.filter(n=>!(n.topic===t&&n.key===i))),Pi.notices.push({topic:t,payload:e,key:i}),{...J}}function FN(){return Pi.methods??{}}function tae({topic:t}){return Pi.notices.filter(e=>e.topic===t).map(e=>e.payload)}function iae(){Pi.notices=[]}function rae({topic:t,key:e}){Pi.notices=Pi.notices.filter(i=>(!t||i.topic===t)&&i.key!==e)}function nae(){return{topics:Object.keys(Pi.subscriptions)}}function aae({topic:t,notices:e},i){let r=Pi.subscriptions[t];r&&typeof r=="function"&&r(e);let n=i==null?void 0:i[t];n&&typeof n=="function"&&n(e)}function oae({engineName:t,methodName:e,params:i,err:r}){let n;return typeof r=="string"?n=r.toUpperCase():r instanceof Error&&(n=r.message),console.log("ERROR",{tournamentId:NH(),params:JSON.stringify(i),engine:t,methodName:e,error:n}),{error:n}}var ni={timers:{default:{elapsedTime:0}},globalSubscriptions:{},deepCopyAttributes:{stringify:[],ignore:[],toJSON:[]},globalMethods:[],deepCopy:!0},Br=MH,SB=["addNotice","callListener","cycleMutationStatus","deleteNotice","deleteNotices","disableNotifications","enableNotifications","getMethods","getNotices","getTopics","getTournamentId","getTournamentRecord","getTournamentRecords","removeTournamentRecord","setSubscriptions","setTournamentId","setTournamentRecord","setTournamentRecords"];function sae(t){if(typeof t!="object")throw new Error("Global state provider can not be undefined or null");if(Vi(Object.keys(t),SB).length!==SB.length)throw new Error("Global state provider is missing required methods");return Br=t,{success:!0}}function lae(){if(Br.createInstanceState){try{Br.createInstanceState()}catch(t){return{error:t}}return{success:!0}}else return{error:IH}}function Fa(t){return!t||typeof t!="object"?ni.devContext??!1:typeof ni.devContext!="object"?!1:Object.keys(t).every(e=>{var i;return((i=ni.devContext)==null?void 0:i[e])===t[e]})&&ni.devContext}function uae(t="reset",e="default"){var r,n;let i=Date.now();if(t==="report"){if(e==="allTimers")return Object.keys(ni.timers).filter(a=>a!=="default"||ni.timers[a].startTime).map(a=>{let o=ni.timers[a],s=o.state==="stopped"?0:(i-((o==null?void 0:o.startTime)??0))/1e3,l=o.elapsedTime+s;return{state:ni.timers[a].state,elapsedTime:l.toFixed(2),timer:a}});{let a=ni.timers[e].state==="stopped"?0:(i-(((r=ni.timers[e])==null?void 0:r.startTime)??0))/1e3,o=ni.timers[e].elapsedTime+a;return{state:ni.timers[e].state,elapsedTime:o.toFixed(2),timer:e}}}if(!ni.timers[e]||t==="reset"){if(e==="allTimers")return ni.timers={default:{elapsedTime:0}},!0;ni.timers[e]={startTime:i,state:"active",elapsedTime:0}}return ni.timers[e].elapsedTime||(ni.timers[e].elapsedTime=0),t==="stop"&&ni.timers[e].state!=="stopped"&&(ni.timers[e].state="stopped")&&(ni.timers[e].elapsedTime+=(i-(((n=ni.timers[e])==null?void 0:n.startTime)??0))/1e3),t==="start"&&(ni.timers[e].startTime=i)&&(ni.timers[e].state="active"),ni.timers[e]}function AH(t){ma(t)?ni.globalLog=t:delete ni.globalLog}function bI(t){ni.devContext=t}function OH(){Br.disableNotifications()}function PU(){Br.enableNotifications()}function wI(t,e){typeof t=="boolean"&&(ni.deepCopy=t),typeof e=="object"&&(Array.isArray(e.ignore)&&(ni.deepCopyAttributes.ignore=e.ignore),Array.isArray(e.toJSON)&&(ni.deepCopyAttributes.toJSON=e.toJSON),Array.isArray(e.stringify)&&(ni.deepCopyAttributes.stringify=e.stringify),e.threshold&&(ni.deepCopyAttributes.threshold=e.threshold))}function LN(){return{enabled:ni.deepCopy,...ni.deepCopyAttributes}}function cae(t){return t!=null&&t.subscriptions?(Object.keys(t.subscriptions).forEach(e=>{ni.globalSubscriptions[e]=t.subscriptions[e]}),{...J}):{error:Xe,info:"missing subscriptions"}}function dae(t){return t!=null&&t.subscriptions?Br.setSubscriptions({subscriptions:t.subscriptions}):{error:Xe,info:"missing subscriptions"}}function kH(t){return t?typeof t!="object"?{error:oe}:(Object.keys(t).forEach(e=>{ma(t[e])&&(ni.globalMethods[e]=t[e])}),{...J}):{error:Xe,info:"missing method declarations"}}function xH(t){return t?typeof t!="object"?{error:oe}:Br.setMethods(t):{error:Xe,info:"missing method declarations"}}function _N(){return Br.cycleMutationStatus()}function lt(t){if(typeof(t==null?void 0:t.topic)!="string")return;let e=ni.globalSubscriptions[t.topic];return Br.addNotice(t,e)}function FH(){return{...ni.globalMethods,...Br.getMethods()}}function LH(t){return Br.getNotices(t)}function $N({key:t,topic:e}){return Br.deleteNotice({key:t,topic:e})}function Ny(){return Br.deleteNotices()}function vo(){return Br.getTopics()}function tT(t){var e,i;return(i=(e=vo())==null?void 0:e.topics)==null?void 0:i.includes(t)}async function DC(t){return Br.callListener(t,ni.globalSubscriptions)}function qm(){return Br.getTournamentId()}function BN(t){return Br.getTournamentRecord(t)}function Ym(){return Br.getTournamentRecords()}function _H(t){return Br.setTournamentRecord(t)}function iT(t){return Br.setTournamentRecords(t)}function UI(t){return Br.setTournamentId(t)}function $H(t){return Br.removeTournamentRecord(t)}function PC(){return Br}function rT({engineName:t,methodName:e,params:i,err:r}){let n=ma(Br.handleCaughtError)&&Br.handleCaughtError||MH.handleCaughtError,{tournamentRecord:a,...o}=i;return n({params:o,engineName:t,methodName:e,err:r})}function BH(t,e){if(ni.globalLog)try{ni.globalLog({log:t,engine:e})}catch(i){console.log("globalLog error",i),console.log(e,t),AH()}else console.log(e,t)}function VH(t,e,i,r){if(!Nt(t))return{error:oe};Li||(i=1);let n=Array.isArray(e)?e:[],a={},o=(s,l=0)=>{Object.keys(s).forEach(u=>{ma(s[u])?a[u]=s[u]:Nt(s[u])&&(e===!0||n!=null&&n.includes(u))&&(i===void 0||l<i)&&o(s[u],l+1)})};return o(t),r?kH(a):xH(a),{methods:a}}function pae(t,e,i){return Object.keys(t).filter(r=>!e.includes(t[r])&&(!i||(Array.isArray(t[r])?t[r].length:!0)))}function Ge(t,e,i,r){var o;if(typeof t!="object"||t===null)return t;(o=LN())!=null&&o.enabled||(r=!0);let n=["",void 0,null];e&&n.push(!1);let a=pae(t,n,i);return Object.assign({},...a.map(s=>Array.isArray(t[s])?{[s]:r?t[s]:t[s].map(l=>Ge(l))}:{[s]:r?t[s]:Ge(t[s])}))}function ee({context:t,result:e,stack:i,info:r}){return e&&!Array.isArray(e==null?void 0:e.stack)&&(e.stack=[]),e&&Array.isArray(e==null?void 0:e.stack)&&typeof i=="string"&&e.stack.push(i),e&&r&&(e.info=r),e&&typeof t=="object"&&Object.keys(t).length&&Object.assign(e,Ge(t)),e&&!(e!=null&&e.error)&&!(e!=null&&e.success)&&Object.assign(e,{...J}),e??{success:!0}}var Ps="ANY",Jt="MALE",Bn="MIXED",Ud="OTHER",pi="FEMALE",nT={ANY:Ps,MALE:Jt,FEMALE:pi,MIXED:Bn,OTHER:Ud},mae="MIXED events can not contain mixed singles or { gender: ANY } collections",hae="events with { gender: ANY } can not contain MIXED singles collections";function aT(t){let e="tieFormatGenderValidityCheck",{referenceGender:i,matchUpType:r,gender:n}=t;return i&&n&&[Jt,pi].includes(i)&&i!==n?ee({result:{valid:!1,error:zv},context:{gender:n},stack:e}):i===Bn&&(n===Ps||n===Bn&&r!==Zt)?ee({result:{error:zv,valid:!1},info:mae,stack:e}):i===Ps&&n===Bn&&r!==Zt?ee({result:{error:zv,valid:!1},info:hae,stack:e}):{valid:!0}}var fae="normal",TB="timed",gae="final",VN="NOAD",RU="SET",vae={S:fae,F:gae};function oT(t,e){if((t!=null&&t.bestOf||t!=null&&t.exactly)&&(t!=null&&t.setFormat))return Iae(t,e)}function SI(t){return!isNaN(Number(t))&&Number(t)}function jH(t){let e=`T${t.minutes}`;return t.based&&(e+=t.based),t.modifier&&(e+=`@${t.modifier}`),e}function Iae(t,e){var c;let i=SI(t.bestOf)||void 0,r=SI(t.exactly)||void 0,n=i||r;if((c=t.setFormat)!=null&&c.timed&&t.simplified&&n===1)return jH(t.setFormat);let a=n&&`${RU}${n}`||"",o=DB(t.setFormat,e),s=o&&`S:${o}`||"",l=DB(t.finalSetFormat,e),u=n&&n>1&&l&&o!==l&&`F:${l}`||"";if(a&&o)return[a,s,u].filter(d=>d).join("-")}function DB(t,e){if(typeof t=="object"&&Object.keys(t).length){if(t.timed)return jH(t);if(t.tiebreakSet)return PB(t.tiebreakSet);let i=SI(t.setTo);if(i){let r=t.NoAD&&VN||"",n=PB(t.tiebreakFormat),a=n&&`/${n}`||"",o=SI(t.tiebreakAt),s=o&&(o!==i||e)&&`@${o}`||"";if(n!==!1)return`${i}${r}${a}${s}`}}}function PB(t){if(t){if(typeof t=="object"&&!t.tiebreakTo)return"";if(typeof t=="object"&&SI(t.tiebreakTo)){let e=`TB${t.tiebreakTo}${t.NoAD?VN:""}`;return t.modifier&&(e+=`@${t.modifier}`),e}else return!1}}function kn(t){if(Ti(t)){let e=t.startsWith("T")&&TB||t.startsWith(RU)&&RU||"";if(e===TB){let i=HH(t),r={simplified:!0,setFormat:i,bestOf:1};if(i)return r}if(e===RU)return yae(t)}}function yae(t){let e=t.split("-"),i=Ay(e[0].slice(3)),r=i===1||i%2!==0?i:void 0,n=i!==1&&i%2===0?i:void 0,a=e&&RB(e[1]),o=e&&RB(e[2]),s=a&&a.timed||o&&o.timed,l=r&&r<6||s&&n,u=!e[2]||o,c=a,d=Ge({setFormat:a,exactly:n,bestOf:r});if(o&&(d.finalSetFormat=o),l&&c&&u)return d}function RB(t){if((t==null?void 0:t[1])===":"){let e=t.split(":"),i=vae[e[0]],r=e[1];if(i&&r){if(r.startsWith("TB")){let h=EB(r);return h===!1?!1:typeof h=="object"?{tiebreakSet:h}:void 0}if(r.startsWith("T"))return HH(r);let n=t.match(/^[FS]:(\d+)([A-Za-z]*)/),a=n&&zH(n[2])||!1,o=!(n!=null&&n[2])||a,s=n?Ay(n[1]):void 0,l=GH(r),u=l!==!1,c=u&&l||s,d=EB(r.split("/")[1]),p=d!==!1,m={setTo:s};return a&&(m.NoAD=!0),d?(m.tiebreakFormat=d,m.tiebreakAt=c):m.noTiebreak=!0,s&&o&&p&&u&&m||!1}}}function GH(t,e=!0){let i=(t==null?void 0:t.indexOf("@"))>0&&t.split("@");if(i)return(e?Ay(i[1]):i[1])||!1}function EB(t){if(t)if(t.startsWith("TB")){let e=GH(t,!1),i=t.match(/^TB(\d+)([A-Za-z]*)/),r=i==null?void 0:i[1],n=i&&zH(i[2]),a=!(i!=null&&i[2])||n,o=Ay(r);if(o&&a){let s={tiebreakTo:o};return e&&typeof e=="string"&&!ot(e)&&(s.modifier=e),n&&(s.NoAD=!0),s}else return!1}else return!1}function HH(t){var s;let e=t.slice(1),i=e.match(/^(\d+)(@?[A-Za-z]*)/),r=Ay(i==null?void 0:i[1]);if(!r)return;let n={timed:!0,minutes:r},a=i==null?void 0:i[2],o=[void 0,"P","G"].includes(a);if(a&&!o){let l=(s=e.match(/^(\d+)(@)([A-Za-z]+)$/))==null?void 0:s[3];return l?(n.modifier=l,n):void 0}return a&&(n.based=i[2]),n}function zH(t){return t&&t.indexOf(VN)>=0}function Ay(t){return isNaN(Number(t))?0:Number(t)}function Ua({matchUpFormat:t}){if(!Ti(t)||t==="")return!1;let e=kn(t),i=t.match(/-S:([1-9])+\/TB([0-9]{1,2})@?([1-9]?)*/),r=i==null?void 0:i[1],n=i==null?void 0:i[2],a=i==null?void 0:i[3],o=t.match(/-F:([1-9])+\/TB([0-9]{1,2})@?([1-9]?)*/),s=o==null?void 0:o[1],l=o==null?void 0:o[2],u=o==null?void 0:o[3];return oT(e,!!(i&&n&&r===a||o&&l&&s===u))===t}var dS=/^[\d]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][\d]|3[0-1])$/,WH=/^((0[\d]|1[\d]|2[0-3]):[0-5][\d](:[0-5][\d])?)([.,][0-9]{3})?$/,Zs=/^([\d]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][\d]|3[0-1]))([ T](0[\d]|1[\d]|2[0-3]):[0-5][\d](:[0-5][\d])?)?([.,][\d]{3})?Z?$/,Sd=/^([\d]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][\d]|3[0-1]))?([ T]?(0[\d]|1[\d]|2[0-3]):[0-5][\d](:[0-5][\d])?)?([.,][\d]{3})?Z?$/;function pS(t){let{scheduledDate:e}=t;if(!e&&t.scheduledTime&&(e=pt(t.scheduledTime)),!e)return;let i=bi(t.scheduledTime),r=pt(e);return r&&i&&(r+=`T${i}`),r}function bae(t){return typeof t!="object"||Array.isArray(t)?!1:Object.prototype.toString.call(t)==="[object Date]"}function Ng(t){let e=typeof t=="string"?t==null?void 0:t.split(" "):[];return t&&(e==null?void 0:e.length)>1&&!["AM","PM"].includes(e[1].toUpperCase())?!1:!!(!t||Sd.test(Km(t,!0,!0)))}function Ia(t){return Nd(t)||dS.test(t)}function wae(t){let e=new Date(t),i=e.getSeconds()+60*e.getMinutes()+60*60*e.getHours();return Uae(i,{displaySeconds:!1})}function Uae(t,e){let i=parseInt(t,10),r=Math.floor(i/3600),n=Math.floor((i-r*3600)/60),a=i-r*3600-n*60;return(!e||e!=null&&e.displaySeconds?r+":"+n+":"+a:r+":"+n).split(":").map(no).join(":")}var jN=t=>{let e=TI(t)||Nd(t)?new Date(t):new Date,i=e.getUTCMonth()+1,r=i<10?`0${i}`:`${i}`;return`${e.getUTCFullYear()}-${no(r)}-${no(e.getUTCDate())}`};function Sae(t){let e=TI(t)||Nd(t)?new Date(t):new Date;return Date.UTC(e.getFullYear(),e.getMonth(),e.getDate())}function Bo(t,e="-",i="YMD"){if(!t)return"";typeof t=="string"&&t.indexOf("T")<0&&(t=t+"T00:00");let r=new Date(t),n=""+(r.getMonth()+1),a=""+r.getDate(),o=r.getFullYear();return n.length<2&&(n="0"+n),a.length<2&&(a="0"+a),i==="DMY"?[a,n,o].join(e):i==="MDY"?[n,a,o].join(e):i==="YDM"?[o,a,n].join(e):i==="DYM"?[a,o,n].join(e):i==="MYD"?[n,o,a].join(e):[o,n,a].join(e)}function mS(t){let e=t?new Date(t):new Date,i=e.getTimezoneOffset();return new Date(e.getTime()-i*60*1e3)}function Tae(t){return mS(t).getTime()}function TI(t){if(typeof t=="boolean")return!1;let e=t instanceof Date&&t||!isNaN(t)&&new Date(t)||!1;return e&&!isNaN(e.valueOf())}function Rf(t,e){if(!Ia(t)||!Ia(e))return[];let i=pt(t)+"T00:00",r=pt(e)+"T00:00",n=new Date(i),a=new Date(r),o=TI(a)&&TI(n)&&u(n,a),s=[],l=0;if(o){let c=n,d=c.getTime();for(;d<=a.getTime()&&l<300;)l+=1,s.push(new Date(c)),d=c.setDate(c.getDate()+1)}return s.map(c=>Bo(c));function u(c,d){return c<=d}}var Dae=/^([+-]?\d{4}(?!\d{2}\b))((-?)((0[1-9]|1[0-2])(\3([12]\d|0[1-9]|3[01]))?|W([0-4]\d|5[0-2])(-?[1-7])?|(00[1-9]|0[1-9]\d|[12]\d{2}|3([0-5]\d|6[1-6])))([T\s]((([01]\d|2[0-3])((:?)[0-5]\d)?|24:?00)([.,]\d+(?!:))?)?(\17[0-5]\d([.,]\d+)?)?([zZ]|([+-])([01]\d|2[0-3]):?([0-5]\d)?)?)?)?$/;function Nd(t){return typeof t!="string"?!1:Dae.test(t)}function GN(t){if(typeof t!="string")return!1;let e=t.split("Z")[0].split(":"),i=e.every(r=>!isNaN(parseInt(r)));return!(e.length<2||!i||parseInt(e[0])>23||parseInt(e[1])>60)}function kt(t){let e=bi(t);if(!e)return 0;let[i,r]=e.split(":").map(n=>parseInt(n));return i*60+r}function Pae(t){let e=Math.floor(t/60),i=t-e*60;return e>23&&(e=e%24),[no(e),no(i)].join(":")}function hS(t){return GN(t)?t.split(":").slice(0,2).map(no).join(":"):void 0}function bi(t){return Nd(t)&&t.indexOf("T")>0?hS(t.split("T").reverse()[0]):hS(t)}function pt(t){return Nd(t)||Zs.test(t)?t.split("T")[0]:void 0}function jv(t,e){let i=new Date(t);return i.setDate(i.getDate()+e),pt(i.toISOString())}function fS(t){t=typeof t!="string"?"00:00":t;let e={},i={};return{0:e.time,1:e.ampm}=t.split(" ")||[],{0:i.hours,1:i.minutes}=e.time.split(":")||[],i.ampm=e.ampm,isNaN(i.hours)||isNaN(i.minutes)||i.ampm&&!["AM","PM"].includes(i.ampm.toUpperCase())?{}:i}function Rae(t){let e=fS(t);return e.ampm&&e.hours&&(e.ampm.toLowerCase()==="pm"&&parseInt(e.hours)<12&&(e.hours=(e.hours&&parseInt(e.hours)||0)+12),e.ampm.toLowerCase()==="am"&&e.hours==="12"&&(e.hours="00")),`${e.hours||"12"}:${e.minutes||"00"}`.split(":").map(no).join(":")}function Eae(t){var i;let e=fS(t);if(!(typeof e=="object"&&!Object.keys(e).length))return e.ampm?t:(e.hours>12?(e.hours-=12,e.ampm="PM"):e.hours==="12"?e.ampm="PM":(e.hours==="00"&&(e.hours="12"),e.ampm="AM"),((i=e.hours)==null?void 0:i[0])==="0"&&(e.hours=e.hours.slice(1)),`${e.hours||"12"}:${e.minutes||"00"} ${e.ampm}`)}function Km(t,e,i){let r=pt(t),n=bi(t),a=r?n:t;return t?e&&(r&&i&&t||Rae(a))||Eae(a):void 0}function qH(t,e){let i=fS(t),r=fS(e);if(parseInt(i.hours)<parseInt(r.hours))return-1;if(parseInt(i.hours)>parseInt(r.hours))return 1;if(i.hours===r.hours){if(parseInt(i.minutes)<parseInt(r.minutes))return-1;if(parseInt(i.minutes)>parseInt(r.minutes))return 1}return 0}function HN(t,e=7){let i=pt(t)+"T00:00",r=new Date(i),n=new Date(r.setDate(r.getDate()+e));return Bo(n)}function Cae(t){return HN(t)}function Mae(t,e,i,r=!1){let n=new Date(e,0,1+(t-1)*7),a=r?0:1;return n.setDate(n.getDate()+(a-n.getDay())),Bo(n,i)}function Nae(t,e,i){let r=new Date(t,0);return Bo(new Date(r.setDate(e)),i)}function ir(t,e=void 0){let[i,r]=(t||"00:00").split(":").map(no),n=mS(e).setHours(i,r,0,0);return mS(n)}function Oy(t,e,i=!0){let r=new Date(t),n=(new Date(e).getTime()-r.getTime())/1e3/60;return i?Math.abs(Math.round(n)):Math.round(n)}function ia(t,e){let i=bi(t);if(!i)return"00:00";let r=isNaN(e)?0:e;return bi(zN(ir(i),r).toISOString())}function zN(t,e){let i=new Date(t);return new Date(i.getTime()+e*6e4)}function no(t){return t.toString()[1]?t:"0"+t}function Vl(t,e){let i=new Date(t),r=new Date(e);return i.getFullYear()===r.getFullYear()&&i.getMonth()===r.getMonth()&&i.getDate()===r.getDate()}var YH={addDays:HN,addWeek:Cae,addMinutesToTimeString:ia,convertTime:Km,getIsoDateString:pS,getUTCdateString:jN,DateHHMM:wae,extractDate:pt,extractTime:bi,formatDate:Bo,getDateByWeek:Mae,isISODateString:Nd,isDate:TI,isTimeString:GN,offsetDate:mS,offsetTime:Tae,sameDay:Vl,timeStringMinutes:kt,timeToDate:ir,timeUTC:Sae,validTimeValue:Ng,validDateString:dS,timeValidation:Sd,dateValidation:Zs},Aae=(t,e)=>t.filter(Boolean).every(i=>typeof i===e),Oae=t=>t.filter(Boolean).every(Li);function vm(t){let e=t.category;if(typeof e!="object")return{error:yI};let{ageCategoryCode:i,ageMaxDate:r,ageMinDate:n,ageMax:a,ageMin:o}=e,s=e.categoryName,l;if(!Aae([i,r,n,s],"string")||!Oae([a,o]))return{error:yI};let u=t.consideredDate??pt(new Date().toLocaleDateString("sv"));if(!Ia(u))return{error:Ar};let[c]=u.split("-").slice(0,3).map(x=>parseInt(x)),d=jv(u,-1),[p,m]=d.split("-").slice(1,3).map(x=>parseInt(x)),h=`${no(p)}-${no(m)}`,f=jv(u,1),[g,v]=f.split("-").slice(1,3).map(x=>parseInt(x)),y=`${no(g)}-${no(v)}`,I=o&&jv(u,-1*365*o),b=a&&jv(u,-1*365*a),S=[],w=x=>!S.includes(x)&&S.push(x);i=i??s;let U=/^([UO]?)(\d{1,2})([UO]?)$/,T=/^C(\d{1,2})-(\d{1,2})$/,D=i==null?void 0:i.includes("-"),P=D&&(i==null?void 0:i.match(T)),E=i==null?void 0:i.match(U),R=(x,F)=>`${x}-${F}`,N=x=>{let F=c-x,$=R(F,y);e.ageMinDate&&e.ageMinDate!==$&&w(`Invalid submitted ageMinDate: ${n}`),n=$,i&&(e.ageMax&&e.ageMax!==x-1&&(w(`Invalid submitted ageMax: ${a}`),b=void 0),a=x-1)},A=x=>{let F=c-x-1,$=R(F,y);e.ageMin&&e.ageMin>x&&w(`Invalid submitted ageMin: ${o}`),e.ageMax&&e.ageMax>x&&w(`Invalid submitted ageMax: ${a}`),e.ageMinDate&&e.ageMinDate!==$&&w(`Invalid submitted ageMinDate: ${n}`),n=$,i&&(e.ageMax&&e.ageMax!==x&&(w(`Invalid submitted ageMax: ${a}`),I=void 0),a=x)},M=x=>{let F=c-x,$=R(F,h);e.ageMaxDate&&e.ageMaxDate!==$&&w(`Invalid submitted ageMaxDate: ${r}`),r=$,i&&(e.ageMin&&e.ageMin!==x+1&&(w(`Invalid submitted ageMin: ${o}`),I=void 0),o=x+1)},C=x=>{let F=c-x-1,$=R(F,h);e.ageMaxDate&&e.ageMaxDate!==$&&w(`Invalid submitted ageMaxDate: ${r}`),r=$,i&&(e.ageMin&&e.ageMin!==x&&(w(`Invalid submitted ageMin: ${o}`),I=void 0),o=x)},O=x=>{let[F,$,_]=(x.match(U)||[]).slice(1),L=parseInt($);F==="U"?(e.ageMaxDate&&e.ageMaxDate!==r&&w(`Invalid submitted ageMaxDate: ${e.ageMaxDate}`),N(L)):F==="O"&&M(L),_==="U"?(e.ageMaxDate&&e.ageMaxDate!==r&&w(`Invalid submitted ageMaxDate: ${e.ageMaxDate}`),A(L)):_==="O"&&C(L),r=r??I,n=n??b};if(P){if(r=void 0,n=void 0,a=void 0,o=void 0,e.ageMin){let $=c-e.ageMin;r=R($,h)}if(e.ageMax){let $=c-e.ageMax-1;n=R($,y)}let[x,F]=((i==null?void 0:i.match(T))??[]).slice(1).map($=>parseInt($));x<=F?(o=x,a=F,l=!0):w(`Invalid combined age range ${i}`)}else D?i==null||i.split("-").forEach(O):E?O(i):(o&&M(o),a&&A(a));a&&e.ageMin&&e.ageMin>a&&(w(`Invalid submitted ageMin: ${e.ageMin}`),o=void 0);let k=Ge({consideredDate:u,combinedAge:l,ageMaxDate:r,ageMinDate:n,ageMax:a,ageMin:o});return S.length&&(k.errors=S),k}function DI({category:t}){if(!Nt(t))return{error:oe};let e=vm({category:t});if(e.error)return{error:e};let{ratingMax:i,ratingMin:r}=t;return i&&!Li(i)?ee({result:{error:oe},context:{ratingMax:i}}):r&&!Li(r)?ee({result:{error:oe},context:{ratingMin:r}}):{...e}}function ky({childCategory:t,withDetails:e,category:i}){let r=DI({category:i}),n=DI({category:t}),a=n.ageMin&&(r.ageMin&&n.ageMin<r.ageMin||r.ageMax&&n.ageMin>r.ageMax),o=n.ageMax&&(r.ageMax&&n.ageMax>r.ageMax||r.ageMin&&n.ageMax<r.ageMin),s=n.ageMinDate&&r.ageMaxDate&&new Date(n.ageMinDate)>new Date(r.ageMaxDate),l=n.ageMaxDate&&r.ageMinDate&&new Date(n.ageMaxDate)<new Date(r.ageMinDate),u=(i==null?void 0:i.ratingType)&&(t==null?void 0:t.ratingType)&&i.ratingType===t.ratingType&&(i.ratingMin&&t.ratingMin&&t.ratingMin<i.ratingMin||i.ratingMax&&t.ratingMax&&t.ratingMax>i.ratingMax||i.ratingMin&&t.ratingMax&&t.ratingMax<i.ratingMin||i.ratingMax&&t.ratingMin&&t.ratingMin>i.ratingMax),c=(i==null?void 0:i.ballType)&&(t==null?void 0:t.ballType)&&i.ballType!==t.ballType,d=Ge({invalidRatingRange:u,invalidAgeMinDate:s,invalidAgeMaxDate:l,invalidBallType:c,invalidAgeMax:o,invalidAgeMin:a,valid:!u&&!s&&!l&&!c&&!o&&!a},!0);return e&&Object.assign(d,{categoryDetails:r,childCategoryDetails:n}),d}function xy({checkCategory:t=!0,collectionDefinition:e,checkCollectionIds:i,checkGender:r=!0,referenceCategory:n,referenceGender:a,event:o}){a=a??(o==null?void 0:o.gender);let s="validateCollectionDefinition",l=[];if(typeof e!="object")return l.push(`collectionDefinition must be an object: ${e}`),ee({result:{errors:l,error:Gu},stack:s});let{collectionValueProfiles:u,collectionGroupNumber:c,collectionValue:d,collectionId:p,matchUpCount:m,matchUpFormat:h,matchUpValue:f,matchUpType:g,scoreValue:v,setValue:y,category:I,gender:b}=e;if(i&&typeof p!="string"&&l.push(`collectionId is not type string: ${p}`),typeof m!="number"&&l.push(`matchUpCount is not type number: ${m}`),g&&!B0([ti,Zt],g)&&l.push(`matchUpType must be SINGLES or DOUBLES: ${g}`),[!!(u!=null&&u.length)].concat([f,d,v,y].map(ot)).filter(Boolean).length!==1&&l.push("Missing value definition for matchUps: matchUpValue, collectionValue, or collectionValueProfiles"),f&&typeof f!="number"&&l.push(`matchUpValue is not type number: ${f}`),d&&typeof d!="number"&&l.push(`collectionValue is not type number: ${d}`),u&&m){let S=UG({collectionValueProfiles:u,matchUpCount:m});S.errors&&l.push(...S.errors)}if(c&&typeof c!="number"&&l.push(`collectionGroupNumber is not type number: ${d}`),h&&!Ua({matchUpFormat:h})&&l.push(`Invalid matchUpFormat: ${h}`),r){let S=aT({referenceGender:a,matchUpType:g,gender:b});if(S.error)return ee({context:{referenceGender:a,gender:b},result:S,stack:s})}if(t&&n&&I){let S=ky({category:n,childCategory:I});if(!S.valid)return ee({result:{error:yI},context:S,stack:s})}return l.length?ee({result:{errors:l,error:SH},stack:s}):{valid:!0}}function Hn(t){var g,v,y,I;let e=!!((t==null?void 0:t.enforceCategory)!==!1&&(t!=null&&t.category)),i=!!((t==null?void 0:t.enforceGender)!==!1&&(t!=null&&t.gender)),r=t==null?void 0:t.checkCollectionIds,n=t==null?void 0:t.tieFormat,a=t==null?void 0:t.event,o="validateTieFormat",s=[],l=kae({...t,stack:o});if(l!=null&&l.error)return l;let u,c=n.collectionDefinitions.every(b=>{let{setValue:S,scoreValue:w,collectionValue:U}=b;(S||w)&&!U&&(u=!0);let{valid:T,errors:D}=xy({referenceCategory:t.category,referenceGender:t.gender,collectionDefinition:b,checkCollectionIds:r,checkCategory:e,checkGender:i,event:a});return T?!0:(Array.isArray(D)&&s.push(...D),!1)}),d=typeof((g=n.winCriteria)==null?void 0:g.valueGoal)=="number"&&((v=n.winCriteria)==null?void 0:v.valueGoal)>0&&!u||((y=n.winCriteria)==null?void 0:y.aggregateValue);if(!(d||(I=n.winCriteria)!=null&&I.aggregateValue))return u?s.push("aggregateValue is required"):s.push("Either non-zero valueGoal, or { aggregateValue: true } must be specified in winCriteria"),ee({context:{tieFormat:n,errors:s,aggregateValueImperative:u},result:{error:Pl},stack:o});let p=n.collectionDefinitions.map(({collectionId:b})=>b),m=!r||p.length===ct(p).length,h=c&&d&&m;return h?{valid:h,errors:s}:ee({result:{error:Pl},context:{tieFormat:n,errors:s},stack:o})}function kae(t){let{tieFormat:e,stack:i}=t;return!t||!e||!Nt(e)?ee({result:{error:Pl},context:{tieFormat:e,message:"tieformat must be an object"},stack:i}):Nt(e.winCriteria)?Array.isArray(e.collectionDefinitions)?{...J}:ee({result:{error:Pl},context:{tieFormat:e,message:"collectionDefinitions must be an array"},stack:i}):ee({result:{error:Pl},context:{tieFormat:e,message:"tieformat.winCritiera must be an object"},stack:i})}var Ef="resourceSubType",Cf="resourceType",Mf="identifier",xae={RESOURCE_SUB_TYPE:Ef,RESOURCE_TYPE:Cf,IDENTIFIER:Mf};function Me(t,e,i,r,n=0){if(PC().makeDeepCopy)return PC().makeDeepCopy(t,e,i,r);let a=LN(),{stringify:o,toJSON:s,ignore:l,modulate:u}=a||{};if(!(a!=null&&a.enabled)&&!i||typeof t!="object"||ma(t)||t===null||typeof(a==null?void 0:a.threshold)=="number"&&n>=a.threshold)return t;let c=Array.isArray(t)?[]:{},d=Object.keys(t).filter(m=>!i||!l||Array.isArray(l)&&!l.includes(m)||ma(l)&&!l(m)),p=(m,h)=>{c[m]=ma(h==null?void 0:h.toString)?h.toString():JSON.stringify(h)};for(let m of d){let h=t[m],f=ma(u)?u(h):void 0;if(f!==void 0)c[m]=f;else if(e&&m==="extensions"&&Array.isArray(h)){let g=WN(h);Object.assign(c,...g)}else r&&m==="extensions"?c[m]=[]:Array.isArray(o)&&o.includes(m)?p(m,h):Array.isArray(s)&&s.includes(m)&&ma(h==null?void 0:h.toJSON)?c[m]=h.toJSON():h===null?c[m]=void 0:bae(h)?c[m]=new Date(h).toISOString():c[m]=Me(h,e,i,r,n+1)}return c}function WN(t){return t==null?void 0:t.map(e=>{let{name:i,value:r}=e;return i&&r&&{[`_${i}`]:r}}).filter(Boolean)}function KH(t=1,e){return Se(0,t).map(()=>Gt(e))}function Gt(t){let e=[];for(let s=0;s<256;s++)e[s]=(s<16?"0":"")+s.toString(16);let i=Math.random()*4294967295|0,r=Math.random()*4294967295|0,n=Math.random()*4294967295|0,a=Math.random()*4294967295|0,o=e[i&255]+e[i>>8&255]+e[i>>16&255]+e[i>>24&255]+"-"+e[r&255]+e[r>>8&255]+"-"+e[r>>16&15|64]+e[r>>24&255]+"-"+e[n&63|128]+e[n>>8&255]+"-"+e[n>>16&255]+e[n>>24&255]+e[a&255]+e[a>>8&255]+e[a>>16&255]+e[a>>24&255];return typeof t=="string"?`${t}_${o.replace(/-/g,"")}`:o}var XH={collectionDefinitions:[{collectionName:"Male Singles",matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpCount:4,matchUpValue:1,gender:"MALE"},{collectionName:"Female Singles",matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:4,matchUpValue:1},{collectionName:"Male Doubles",matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpCount:2,matchUpValue:1,gender:"MALE"},{collectionName:"Female Doubles",matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:2,matchUpValue:1},{collectionName:"Mixed Doubles",matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpCount:4,matchUpValue:1,gender:"MIXED"}],tieFormatName:"USTA_GOLD_TEAM_CHALLENGE",winCriteria:{valueGoal:9}},JH={collectionDefinitions:[{collectionName:"Round 1",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Round 2",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Round 3",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"Doubles Shuffle",unrestrictedSelections:!0,winCriteria:{aggregateValue:!0}},QH={collectionDefinitions:[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_SOUTHERN_LEVEL_5",winCriteria:{valueGoal:8}},ZH={collectionDefinitions:[{category:{ageCategoryCode:"16U"},collectionName:"16U Singles",matchUpCount:4,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Singles",matchUpCount:4,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Doubles",matchUpCount:2,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Doubles",matchUpCount:2,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Tiebreak Doubles",matchUpCount:1,matchUpFormat:"SET1-S:TB10",matchUpType:"DOUBLES",matchUpValue:1,processCodes:["RANKING.IGNORE"]}],tieFormatName:"USTA_SECTION_BATTLE",winCriteria:{valueGoal:9}},ez={collectionDefinitions:[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_INTERSECTIONAL",winCriteria:{valueGoal:8}},tz={collectionDefinitions:[{scoreValue:1,matchUpType:"SINGLES",collectionName:"Men's Singles",matchUpFormat:"SET1-S:T60",gender:"MALE",matchUpCount:1},{scoreValue:1,matchUpType:"SINGLES",collectionName:"Women's Singles",matchUpFormat:"SET1-S:T60",gender:"FEMALE",matchUpCount:1},{matchUpValue:1,matchUpType:"DOUBLES",collectionName:"Mixed Doubles",matchUpFormat:"SET1-S:T60",gender:"MIXED",matchUpCount:1}],tieFormatName:"Time Tennis Pro Circuit",winCriteria:{aggregateValue:!0}},iz={collectionDefinitions:[{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"DOMINANT_DUO_MIXED",winCriteria:{valueGoal:2}},rz={collectionDefinitions:[{scoreValue:1,matchUpType:"SINGLES",collectionName:"Men's Singles",matchUpFormat:"SET1-S:T60",gender:"MALE",matchUpCount:3},{scoreValue:1,matchUpType:"SINGLES",collectionName:"Women's Singles",matchUpFormat:"SET1-S:T60",gender:"FEMALE",matchUpCount:3},{scoreValue:1,matchUpType:"DOUBLES",collectionName:"Men's Doubles",matchUpFormat:"SET1-S:T60",gender:"MALE",matchUpCount:1},{matchUpValue:1,matchUpType:"DOUBLES",collectionName:"Women's Doubles",matchUpFormat:"SET1-S:T60",gender:"FEMALE",matchUpCount:1},{matchUpValue:1,matchUpType:"DOUBLES",collectionName:"Mixed Doubles",matchUpFormat:"SET1-S:T60",gender:"MIXED",matchUpCount:1}],tieFormatName:"Time Tennis Dual",winCriteria:{aggregateValue:!0}},nz={collectionDefinitions:[{category:{ageCategoryCode:"14U"},collectionName:"14U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],collectionGroups:[{groupNumber:1,groupName:"Doubles",groupValue:1,winCriteria:{valueGoal:2}}],tieFormatName:"USTA_BREWER_CUP",winCriteria:{valueGoal:4}},az={winCriteria:{valueGoal:23},tieFormatName:"USTA_OZAKI_CUP",collectionDefinitions:[{category:{ageCategoryCode:"18U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"18U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"18U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"18U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"18U"},collectionName:"18U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"16U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"16U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"16U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"16U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"16U"},collectionName:"16U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"14U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"14U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"14U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"14U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"14U"},collectionName:"14U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"12U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"12U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"12U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"12U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"12U"},collectionName:"12U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"12U"},collectionName:"12U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"12U"},collectionName:"12U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1}]},hu="SET3-S:6/TB7",Fae="SET3-S:6/TB7-F:TB10",oz={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"DOMINANT_DUO",winCriteria:{valueGoal:2}},sz={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",collectionValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"USTA_COLLEGE",winCriteria:{valueGoal:4}},lz={collectionDefinitions:[{collectionName:"Male Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_LEVEL_1",winCriteria:{valueGoal:10}},uz={collectionDefinitions:[{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Overtime",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"USTA_WTT_ITT",winCriteria:{aggregateValue:!0}},cz={collectionDefinitions:[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_ZONAL",winCriteria:{valueGoal:10}},dz={collectionDefinitions:[{collectionGroupNumber:1,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:1},{collectionGroupNumber:1,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:1},{collectionGroupNumber:2,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:2},{collectionGroupNumber:2,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:2},{collectionGroupNumber:3,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:3},{collectionGroupNumber:3,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:3}],collectionGroups:[{groupNumber:1,groupName:"Day 1"},{groupNumber:2,groupName:"Day 2"},{groupNumber:3,groupName:"Day 3"}],tieFormatName:"LAVER_CUP",winCriteria:{valueGoal:13}},pz={collectionDefinitions:[{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Overtime",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"USTA_TOC",winCriteria:{aggregateValue:!0}},gS="COLLEGE_DEFAULT",RC="COLLEGE_JUCO",EC="COLLEGE_D3",mz="DOMINANT_DUO",hz="DOMINANT_DUO_MIXED",fz="LAVER_CUP",gz="TEAM_DOUBLES_3_AGGREGATION",vz="TIME_TENNIS_DUAL",Iz="TIME_TENNIS_PRO_CIRCUIT",yz="USTA_BREWER_CUP",bz="USTA_OZAKI_CUP",wz="USTA_COLLEGE",Uz="USTA_GOLD_TEAM_CHALLENGE",Sz="USTA_LEVEL_1",Tz="USTA_INTERSECTIONAL",Dz="USTA_SECTION_BATTLE",Pz="USTA_SOUTHERN_LEVEL_5",Rz="USTA_TOC",Ez="USTA_WTT_ITT",Cz="USTA_ZONAL",Lae={COLLEGE_D3:EC,COLLEGE_DEFAULT:gS,COLLEGE_JUCO:RC,DOMINANT_DUO:mz,DOMINANT_DUO_MIXED:hz,LAVER_CUP:fz,TEAM_DOUBLES_3_AGGREGATION:gz,TIME_TENNIS_DUAL:vz,TIME_TENNIS_PRO_CIRCUIT:Iz,USTA_BREWER_CUP:yz,USTA_OZAKI_CUP:bz,USTA_COLLEGE:wz,USTA_GOLD_TEAM_CHALLENGE:Uz,USTA_INTERSECTIONAL:Tz,USTA_LEVEL_1:Sz,USTA_SECTION_BATTLE:Dz,USTA_SOUTHERN_LEVEL_5:Pz,USTA_TOC:Rz,USTA_WTT_ITT:Ez,USTA_ZONAL:Cz},Mz="STANDARD",CB={[Mz]:{hydrate:!0,doubles:{matchUpCount:3,matchUpValue:1},singles:{matchUpCount:6,matchUpValue:1},valueGoal:5},[EC]:{hydrate:!0,doubles:{matchUpFormat:"SET1-S:8/TB7@7",matchUpCount:3,matchUpValue:1},singles:{matchUpFormat:hu,matchUpCount:6,matchUpValue:1},tieFormatName:EC,valueGoal:5},[gS]:{hydrate:!0,doubles:{matchUpFormat:"SET1-S:6/TB7",collectionValue:1,matchUpCount:3},singles:{matchUpFormat:hu,matchUpCount:6,matchUpValue:1},tieFormatName:gS,valueGoal:4},[RC]:{hydrate:!0,doubles:{matchUpFormat:"SET1-S:8/TB7",matchUpCount:3,matchUpValue:1},singles:{matchUpFormat:hu,matchUpCount:6,matchUpValue:1},tieFormatName:RC,valueGoal:5},[fz]:dz,[mz]:oz,[hz]:iz,[gz]:JH,[vz]:rz,[Iz]:tz,[yz]:nz,[bz]:az,[wz]:sz,[Uz]:XH,[Tz]:ez,[Sz]:lz,[Dz]:ZH,[Pz]:QH,[Ez]:uz,[Rz]:pz,[Cz]:cz},_ae=t=>{let e=t!=null&&t.namedFormat&&Object.keys(CB).includes(t.namedFormat)?t.namedFormat:Mz,i=Array.isArray(t==null?void 0:t.uuids)?t==null?void 0:t.uuids:[],r,{category:n,gender:a}=(t==null?void 0:t.event)??{},o=Me(CB[e],!1,!0),s=l=>{var c,d;if(!(t!=null&&t.isMock)&&!((c=t==null?void 0:t.event)!=null&&c.isMock)||!t.event)return(i==null?void 0:i.pop())??Gt();let u=(d=t==null?void 0:t.event)==null?void 0:d.eventId;return i.pop()??`${u}-COL-${l+1}`};return o.hydrate?(r={winCriteria:{valueGoal:o.valueGoal},collectionDefinitions:[{collectionId:s(0),matchUpFormat:Fae,collectionName:"Doubles",matchUpType:Zt,...o.doubles},{collectionId:s(1),matchUpFormat:hu,collectionName:"Singles",matchUpType:ti,...o.singles}]},o.tieFormatName&&(r.tieFormatName=o.tieFormatName)):(o.collectionDefinitions.forEach((l,u)=>l.collectionId=s(u)),r=o),t!=null&&t.hydrateCollections&&r.collectionDefinitions.forEach(l=>{n&&!l.category&&(l.category=n),a&&!l.gender&&(l.gender=a)}),r},bu=_ae,el="SINGLES",Im="SINGLES",uo="DOUBLES",wu="DOUBLES",sr="TEAM",Sa="TEAM",$ae="AGE",Bae="RATING",Vae="BOTH",Nz={AGE:$ae,BOTH:Vae,DOUBLES:uo,DOUBLES_EVENT:wu,RATING:Bae,SINGLES:el,SINGLES_EVENT:Im,TEAM_EVENT:Sa,TEAM:sr},Oe="MAIN",Ye="QUALIFYING",rn="CONSOLATION",Or="VOLUNTARY_CONSOLATION",$i="PLAY_OFF",sT=[Oe,Ye,rn,$i,Or],ym={[Ye]:1,[Oe]:2,[$i]:3,[rn]:3,[Or]:4},Az="finishingPositions",Oz="aggregateEventStructures",kz={[Oe]:1,[$i]:2,[rn]:3,[Ye]:4,[Or]:5},jae={[$i]:1,[Oe]:2,[rn]:3,[Ye]:4,[Or]:5},qN="CLUSTER",Gae="SEPARATE",Ad="WATERFALL",lT="ITEM",xn="CONTAINER",ko="DRAW",uT="RANDOM",Lo="TOP_DOWN",Od="BOTTOM_UP",Uu="POSITION",Su="WINNER",jl="LOSER",tl="FIRST_MATCHUP",La="AD_HOC",Hae="AD_HOC",Ag="FEED_IN",Nf="COMPASS",Af="OLYMPIC",zae="SINGLE_ELIMINATION",Hs="SINGLE_ELIMINATION",Fy="DOUBLE_ELIMINATION",Of="FIRST_MATCH_LOSER_CONSOLATION",Ly="FIRST_ROUND_LOSER_CONSOLATION",cp="LUCKY_DRAW",cT="CURTIS_CONSOLATION",Wae="CURTIS_CONSOLATION",YN="FEED_IN_CHAMPIONSHIP_TO_SF",PI="FEED_IN_CHAMPIONSHIP_TO_SF",KN="FEED_IN_CHAMPIONSHIP_TO_QF",RI="FEED_IN_CHAMPIONSHIP_TO_QF",XN="FEED_IN_CHAMPIONSHIP_TO_R16",EI="FEED_IN_CHAMPIONSHIP_TO_R16",xz="MODIFIED_FEED_IN_CHAMPIONSHIP",CI="MODIFIED_FEED_IN_CHAMPIONSHIP",_y="FEED_IN_CHAMPIONSHIP",qae="DOUBLE_ROUND_ROBIN",Jo="ROUND_ROBIN",Gl="ROUND_ROBIN_WITH_PLAYOFF",Fz="DECIDER",Lz="BACKDRAW",JN={0:{name:"East",abbreviation:"E"},"0-1":{name:"West",abbreviation:"W"},"0-2":{name:"North",abbreviation:"N"},"0-3":{name:"Northeast",abbreviation:"NE"},"0-1-1":{name:"South",abbreviation:"S"},"0-1-2":{name:"Southwest",abbreviation:"SW"},"0-2-1":{name:"Northwest",abbreviation:"NW"},"0-1-1-1":{name:"Southeast",abbreviation:"SE"}},QN={0:{name:"East",abbreviation:"E"},"0-1":{name:"West",abbreviation:"W"},"0-2":{name:"North",abbreviation:"N"},"0-1-1":{name:"South",abbreviation:"S"}},kd="WIN_RATIO",Xm="ROUND_OUTCOME",_z=[Nf,cT,RI,EI,PI,_y,KN,XN,YN,Of,Ly,cp,CI,Af,$i,Gl],Yae=[La,Nf,cT,Fy,RI,EI,PI,_y,Ag,Of,Ly,cp,CI,Af,$i,Jo,Gl,Hs],dT={MAIN:Oe,QUALIFYING:Ye,CONSOLATION:rn,ITEM:lT,CONTAINER:xn,FIRST_MATCHUP:tl,WINNER:Su,LOSER:jl,AD_HOC:La,FEED_IN:Ag,FLEX_ROUNDS:Hae,COMPASS:Nf,PLAY_OFF:$i,OLYMPIC:Af,KNOCKOUT:zae,SINGLE_ELIMINATION:Hs,DOUBLE_ELIMINATION:Fy,CURTIS:cT,FICSF:YN,FICQF:KN,FICR16:XN,MFIC:xz,VOLUNTARY_CONSOLATION:Or,FIRST_MATCH_LOSER_CONSOLATION:Of,FIRST_ROUND_LOSER_CONSOLATION:Ly,MODIFIED_FEED_IN_CHAMPIONSHIP:CI,FEED_IN_CHAMPIONSHIP_TO_R16:EI,FEED_IN_CHAMPIONSHIP_TO_QF:RI,FEED_IN_CHAMPIONSHIP_TO_SF:PI,FEED_IN_CHAMPIONSHIP:_y,LUCKY_DRAW:cp,ROUND_ROBIN_WITH_PLAYOFF:Gl,ROUND_ROBIN:Jo,DECIDER:Fz,BACKDRAW:Lz,COMPASS_ATTRIBUTES:JN,OLYMPIC_ATTRIBUTES:QN,DRAW:ko,RANDOM:uT,TOP_DOWN:Lo,BOTTOM_UP:Od,WATERFALL:Ad,WIN_RATIO:kd,ROUND_OUTCOME:Xm,MULTI_STRUCTURE_DRAWS:_z,generatedDrawTypes:Yae,stageOrder:ym,finishOrder:kz,AGGREGATE_EVENT_STRUCTURES:Oz,FINISHING_POSITIONS:Az},Kae=dT,pn="tournamentRecords",ZN="policyDefinitions",wr="tournamentRecord",eA="onlineResource",Fn="drawDefinition",$z="tieFormatName",tA="matchUpFormat",Hl="participantId",Bz="scheduleDates",Xae="tournamentId",Jae="scheduleDate",Qae="roundNumber",pT="structureId",iA="participant",$y="matchUpIds",Vz="entryStage",Zae="policyType",jz="structures",rA="eventType",fl="matchUpId",mT="tieFormat",hT="inContext",fT="structure",gT="courtIds",eoe="personId",vT="venueIds",nA="matchUps",Gz="courtId",Hz="eventId",Zl="matchUp",zz="drawId",Vo="error",Gc="event",Og="param",aA="uuids",toe="averageMatchUpMinutes",ioe="recoveryMinutes",roe="periodLength",noe="number",ea="object",un="array",Kr="_validate",Wz="_message",_a="_invalid",Xn="_ofType",oA="_anyOf",kf="_oneOf",MB={[eA]:t=>Vi(Object.keys(t),[Ef,Cf,Mf]).length===3,[$z]:t=>t&&bu({namedFormat:t}),[aA]:t=>!t||Array.isArray(t)&&t.every(Ti),[mT]:t=>!Hn({tieFormat:t}).error,[rA]:t=>[el,uo,sr].includes(t),[Vz]:t=>sT.includes(t)},aoe={[pn]:ki,[wr]:ge,[ZN]:G0,[Fn]:_e,[Hl]:pr,[tA]:yN,[Xae]:Tf,[pT]:za,[$y]:jm,[iA]:zm,[eA]:Gu,[rA]:Bl,[jz]:gN,[fl]:yn,[mT]:Pl,[fT]:lp,[Gz]:Gm,[nA]:ju,[Hz]:lo,[Zl]:na,[gT]:Xe,[vT]:Xe,[zz]:xs,[Gc]:gi},ooe={[pn]:ea,[ZN]:ea,[wr]:ea,[Fn]:ea,[eA]:ea,[Bz]:un,[iA]:ea,[$y]:un,[jz]:un,[mT]:ea,[fT]:ea,[gT]:un,[vT]:un,[nA]:un,[Zl]:ea,[Gc]:ea,[aA]:un};function ze(t,e,i){if(!t&&!Nt(t))return{error:oe};if(!(e!=null&&e.length)||t!=null&&t._bypassParamCheck)return{valid:!0};if(!Array.isArray(e))return{error:oe};let{paramError:r,errorParam:n}=uoe(t,e);if(!r)return{valid:!0};let a=r[Kr]&&(r[Vo]||r[_a])||(t==null?void 0:t[n])===void 0&&(r[Vo]||r[_a]||aoe[n]||oe)||oe,o=n??(r[kf]&&Object.keys(r[kf]).join(", "));return ee({info:{param:o,message:r[Wz]},result:{error:a},stack:i})}function qz(t,e){let i=Object.keys(t),r=Object.keys(e);return Vi(i,r)}function soe(t,e){if(!e)return;let i=qz(t,e);return i.length!==1?{error:oe}:i.reduce((r,n)=>({...r,[n]:!0}),{})}function loe(t,e){if(!e)return;let i=qz(t,e).filter(r=>t[r]);return i.length<1?{error:oe}:i.reduce((r,n)=>({...r,[n]:!0}),{})}function uoe(t,e){let i,r;return{paramError:e.find(({_ofType:n,_oneOf:a,_anyOf:o,_validate:s,_info:l,...u})=>{let c=a&&soe(t,a);if(c!=null&&c.error)return c.error;c&&Object.assign(u,c);let d=o&&loe(t,o);if(d!=null&&d.error)return d.error;d&&Object.assign(u,d);let p=Object.keys(u).filter(h=>typeof u[h]=="boolean"),m=p.find(h=>{let f=s&&!ma(s),g=t[h]!==void 0&&!s&&coe(t,h,n),v=u[h]&&[void 0,null].includes(t[h]),y=f||g||v||s&&t[h]!==void 0&&!doe(t[h],s)||MB[h]&&!MB[h](t[h]);return y&&(i=h,r=l),y});return!p.length||m}),errorParam:i,paramInfo:r}}function coe(t,e,i){return i=i||ooe[e]||"string",i==="array"?!Array.isArray(t[e]):typeof t[e]!==i}function doe(t,e){return ma(e)?e(t):!0}var sA="DYNAMIC",wc="RANKING",gc="RATING",xd="SCALE",Rl="SEEDING",poe={RANKING:wc,RATING:gc,SCALE:xd,SEEDING:Rl};function kg(t){var n;let e=ze(t,[{[iA]:!0}]);if(e.error)return e;let i=(n=t.participant.timeItems)==null?void 0:n.filter(({itemType:a})=>(a==null?void 0:a.startsWith(xd))&&[wc,gc,Rl].includes(a.split(".")[1])),r={ratings:{},rankings:{},seedings:{}};if(i!=null&&i.length){let a=s=>i.filter(l=>(l==null?void 0:l.itemType)===s).sort((l,u)=>new Date(l.createdAt||void 0).getTime()-new Date(u.createdAt||void 0).getTime()).pop(),o=ct(i.map(({itemType:s})=>s));for(let s of o){let l=a(s);if(l){let[,u,c,d,p]=l.itemType.split("."),m=p?`${d}.${p}`:d,h=u===Rl&&"seedings"||u===wc&&"rankings"||"ratings";r[h][c]||(r[h][c]=[]),r[h][c].push({scaleValue:l.itemValue,scaleDate:l.itemDate,scaleName:m})}}}return{...J,...r}}function bm(t){if(t===null)return{};let{source:e,template:i}=t||{};if(!i)return e;let r={};return n(e,i,r),r;function n(a,o,s){if(!a||!o)return;let l=Object.keys(a),u=Object.keys(o),c=Object.assign({},...u.filter(m=>m.indexOf("||")).map(m=>m.split("||").map(h=>({[h]:m}))).flat()),d=u.concat(...Object.keys(c)),p=d.includes("*");for(let m of l)if(d.indexOf(m)>=0||p){let h=c[m]||m,f=o[h]||p,g=a[m];if(typeof f=="object"&&typeof g!="function"&&!Array.isArray(f))if(Array.isArray(g)){let v=g.map(y=>{let I={};return n(y,f,I)!==!1?I:void 0}).filter(Boolean);s[m]=v}else g&&(s[m]={},n(g,f,s[m]));else{let v=a[m];if(Array.isArray(f)&&!f.includes(v))return!1;(o[m]||p&&o[m]!==!1)&&(s[m]=v)}}}}var CC="voluntaryConsolation",su="competitiveBands",lA="roundRobinTally",wm="positionActions",kr="matchUpActions",EU="rankingPoints",xf="roundNaming",By="participant",MI="progression",Hc="scheduling",vS="avoidance",moe="participant",hoe="display",Rs="scoring",hs="seeding",Ff="feedIn",foe="audit",IS="draws",goe={POLICY_TYPE_VOLUNTARY_CONSOLATION:CC,POLICY_TYPE_COMPETITIVE_BANDS:su,POLICY_TYPE_ROUND_ROBIN_TALLY:lA,POLICY_TYPE_POSITION_ACTIONS:wm,POLICY_TYPE_MATCHUP_ACTIONS:kr,POLICY_TYPE_RANKING_POINTS:EU,POLICY_TYPE_ROUND_NAMING:xf,POLICY_TYPE_PARTICIPANT:By,POLICY_TYPE_PROGRESSION:MI,POLICY_TYPE_SCHEDULING:Hc,POLICY_TYPE_AVOIDANCE:vS,POLICY_TYPE_DISPLAY:hoe,POLICY_TYPE_PRIVACY:moe,POLICY_TYPE_FEED_IN:Ff,POLICY_TYPE_SCORING:Rs,POLICY_TYPE_SEEDING:hs,POLICY_TYPE_AUDIT:foe,POLICY_TYPE_DRAWS:IS};function Uc({tournamentParticipants:t=[],policyDefinitions:e={},contextProfile:i,participantId:r,internalUse:n,personId:a}){let o=t.find(l=>r&&l.participantId===r||a&&l.person&&l.person.personId===a),s=Me(o,!1,n);if(s){let l=e==null?void 0:e[By];if(i!=null&&i.withScaleValues){let{ratings:u,rankings:c}=kg({participant:s});s.rankings=c,s.ratings=u}if(l!=null&&l.participant)return bm({template:l.participant,source:s})}return s}var voe="element required",Ioe="missing name";function Un(t){if(!t||typeof t!="object")return{error:Xe};if(t.element&&typeof(t==null?void 0:t.element)!="object")return{error:oe};if(!(t!=null&&t.name))return{error:Xe,info:Ioe};if(!(t!=null&&t.element)){if(t.discover&&t.tournamentRecords){for(let e of Object.keys(t.tournamentRecords)){let i=t.tournamentRecords[e],r=Un({element:i,name:t.name});if(r.error)return ee({result:r,stack:"removeExtension"})}return{...J}}return{error:Xe,info:voe}}return t!=null&&t.element.extensions?(t.element.extensions=t.element.extensions.filter(e=>(e==null?void 0:e.name)!==t.name),{...J}):{...J,info:$r}}function il({requiredAttributes:t=["name","value"],extension:e}){if(!e||typeof e!="object"||typeof e.name!="string")return!1;let i=Object.keys(e);return t.filter(r=>i.includes(r)).length===t.length}function Lt(t){if(typeof t!="object")return{error:Xe};let e="addExtension";if(t!=null&&t.element&&typeof t.element!="object")return ee({result:{error:oe},stack:e});if(!il({extension:t.extension}))return ee({result:{error:oe,info:"invalid extension"},stack:e});if(!t.element)if(t.discover&&!t.tournamentId&&t.tournamentRecords){for(let r of Object.values(t.tournamentRecords)){let n=Lt({extension:t.extension,element:r});if(n.error)return ee({result:n,stack:e})}return{...J}}else return ee({result:{error:Xe},stack:e});if(t.element.extensions||(t.element.extensions=[]),(t==null?void 0:t.creationTime)??!0){let r=new Date().toISOString();Object.assign(t.extension,{createdAt:r})}let i=t.element.extensions.find(({name:r})=>r===t.extension.name);return i?i.value=t.extension.value:t.extension.value&&t.element.extensions.push(t.extension),{...J}}function uA(t){return!t||typeof t!="object"?{error:Xe}:t.tournamentRecord?Lt({creationTime:t.creationTime,element:t.tournamentRecord,extension:t.extension}):{error:ge}}function IT(t){return!t||typeof t!="object"?{error:Xe}:t.drawDefinition?Lt({creationTime:t.creationTime,element:t.drawDefinition,extension:t.extension}):{error:xa}}function zc(t){return!t||typeof t!="object"?{error:Xe}:t.event?Lt({creationTime:t.creationTime,extension:t.extension,element:t.event}):{error:lo}}function Yz(t){var r;if(!t||typeof t!="object")return{error:Xe};if(!t.participantId)return{error:pr};let e=((r=t.tournamentRecord)==null?void 0:r.participants)||[],i=Uc({participantId:t.participantId,tournamentParticipants:e});return i?Lt({creationTime:t.creationTime,extension:t.extension,element:i}):{error:zi}}function cA(t){return!t||typeof t!="object"?{error:Xe}:t.tournamentRecord?Un({element:t.tournamentRecord,name:t.name}):{error:ge}}function Kz(t){return!t||typeof t!="object"?{error:Xe}:t.drawDefinition?Un({element:t.drawDefinition,name:t.name}):{error:xa}}function yT(t){return!t||typeof t!="object"?{error:Xe}:t!=null&&t.event?Un({element:t.event,name:t.name}):{error:lo}}function Xz(t){var r;if(!t||typeof t!="object")return{error:Xe};if(!t.participantId)return{error:pr};let e=((r=t.tournamentRecord)==null?void 0:r.participants)||[],i=Uc({participantId:t.participantId,tournamentParticipants:e});return i?Un({element:i,name:t.name}):{error:zi}}function Vy({tournamentRecords:t}){return{tournamentIds:Nt(t)?Object.keys(t):[],...J}}var yoe="extensionQueries";function gt({discover:t,element:e,name:i,...r}){var a;if(!e||!i){if(t&&r){let o=Object.keys(r).filter(u=>typeof t=="boolean"||Array.isArray(t)&&t.includes(u)).find(u=>{var c;return Array.isArray((c=r[u])==null?void 0:c.extensions)?r[u].extensions.find(d=>(d==null?void 0:d.name)===i):!1}),s=o&&r[o];!s&&r.tournamentRecords&&(s=Object.values(r.tournamentRecords).find(u=>{var c;return(c=u.extensions)==null?void 0:c.length}));let l=(a=s==null?void 0:s.extensions)==null?void 0:a.find(u=>(u==null?void 0:u.name)===i);return{extension:l,info:l?void 0:$r}}return ee({result:{error:Xe},stack:yoe})}if(!Array.isArray(e.extensions))return{info:"no extensions"};let n=e.extensions.find(o=>(o==null?void 0:o.name)===i);return{extension:n,info:n?void 0:$r}}var boe="activeSuspension",NI="appliedPolicies",Jz="context",bT="delegatedOutcome",ys="disabled",Um="disableAutoCalc",wT="disableLinks",yS="display",Pd="drawDeletions",woe="drawProfile",bS="entryProfile",Uoe="eventProfile",Soe="eventWithdrawalRequests",Toe="factory",Qo="flightProfile",MC="groupingAttribute",Tu="lineUps",Fd="linkedTournamentsIds",UT="matchUpHistory",dA="participantRepresentatives",xg="personRequests",vf="positionActions",Doe="rankingPoints",Poe="registration",gl="roundTarget",jy="scheduleLimits",Du="scheduleTiming",Sm="schedulingProfile",Roe="statusDetail",Lf="subOrder",Sc="tally",Wv="tieFormatModification",Qz={ACTIVE_SUSPENSION:boe,APPLIED_POLICIES:NI,CONTEXT:Jz,DELEGATED_OUTCOME:bT,DISABLED:ys,DISABLE_LINKS:wT,DISABLE_AUTO_CALC:Um,DISPLAY:yS,DRAW_DELETIONS:Pd,DRAW_PROFILE:woe,ENTRY_PROFILE:bS,EVENT_PROFILE:Uoe,EVENT_WITHDRAWAL_REQUESTS:Soe,FLIGHT_PROFILE:Qo,GROUPING_ATTRIBUTE:MC,LINEUPS:Tu,LINKED_TOURNAMENTS:Fd,MATCHUP_HISTORY:UT,PARTICIPANT_REPRESENTATIVES:dA,PERSON_REQUESTS:xg,POSITION_ACTIONS:vf,RANKING_POINTS:Doe,REGISTRATION:Poe,ROUND_TARGET:gl,SCHEDULE_LIMITS:jy,SCHEDULE_TIMING:Du,SCHEDULING_PROFILE:Sm,STATUS_DETAIL:Roe,SUB_ORDER:Lf,TALLY:Sc,TIE_FORMAT_MODIFICATIONS:Wv,FACTORY:Toe},NB=[bT,ys,Um,wT,Qo,Tu,Fd,UT,dA,xg,gl,jy,Du,Sm,Lf,Sc,Wv];function Zz({tournamentRecords:t}){if(typeof t!="object"||!Object.keys(t).length)return{error:ki};let e=Vy({tournamentRecords:t}),{tournamentIds:i}=e;return(i==null?void 0:i.length)>1?Lt({tournamentRecords:t,discover:!0,extension:{name:Fd,value:{tournamentIds:i}}}):{...J}}function eW({tournamentRecords:t}){if(typeof t!="object"||!Object.keys(t).length)return{error:ki};let e=Un({name:Fd,tournamentRecords:t,discover:!0});return ee({result:e,stack:"unlinkTournaments"})}function tW({tournamentRecords:t,tournamentId:e}){if(typeof t!="object")return{error:oe};if(!e)return{error:Tf};let i=Vy({tournamentRecords:t}),{tournamentIds:r}=i;if(!r.includes(e))return{error:Tf};let n;return r.every(a=>{var d;let o=t[a],{extension:s}=gt({element:o,name:Fd});if(!s)return!0;let l=((d=s==null?void 0:s.value)==null?void 0:d.tournamentIds)||[];if(!(l!=null&&l.length)||l.length===1&&l.includes(e)||a===e){let p=cA({name:Fd,tournamentRecord:o});return p.error&&(n=p.error),p.success}let u=l.filter(p=>p!==e);s.value={tournamentIds:u};let c=uA({tournamentRecord:o,extension:s});return c.error&&(n=c.error),c.success}),n?{error:n}:{...J}}var iW={};yt(iW,{getLinkedTournamentIds:()=>Gy,getTournamentIds:()=>Vy});function Gy({tournamentRecords:t}){return typeof t!="object"||!Object.keys(t).length?{error:ki}:{linkedTournamentIds:Object.assign({},...Object.keys(t).map(e=>{var o;let i=t[e],r=i==null?void 0:i.tournamentId,{extension:n}=gt({element:i,name:Fd}),a=(((o=n==null?void 0:n.value)==null?void 0:o.tournamentIds)||[]).filter(s=>s!==r);return{[e]:a}}))}}var ST={};yt(ST,{adHocPositionSwap:()=>qq,addAdHocMatchUps:()=>JT,addDrawDefinitionTimeItem:()=>dO,addFinishingRounds:()=>nb,addGoesTo:()=>$d,addPlayoffStructures:()=>XT,addQualifyingStructure:()=>Wq,addVoluntaryConsolationStage:()=>Bq,addVoluntaryConsolationStructure:()=>ZA,allPlayoffPositionsFilled:()=>uO,alternateDrawPositionAssignment:()=>Cq,assignDrawPosition:()=>y3,assignDrawPositionBye:()=>Ya,attachConsolationStructures:()=>f3,attachPlayoffStructures:()=>EO,attachQualifyingStructure:()=>cO,attachStructures:()=>KT,autoSeeding:()=>Rpe,automatedPlayoffPositioning:()=>Gg,automatedPositioning:()=>hb,checkValidEntries:()=>eD,deleteAdHocMatchUps:()=>w3,drawMatic:()=>JO,findDrawDefinition:()=>OO,generateAdHocMatchUps:()=>tD,generateAdHocRounds:()=>XO,generateAndPopulatePlayoffStructures:()=>PO,generateDrawDefinition:()=>Ab,generateDrawMaticRound:()=>BO,generateDrawStructuresAndLinks:()=>LO,generateDrawTypeAndModifyDrawDefinition:()=>_O,generateQualifyingStructure:()=>vO,generateVoluntaryConsolation:()=>z3,getAssignedParticipantIds:()=>Ip,getAvailableMatchUpsCount:()=>QT,getAvailablePlayoffProfiles:()=>gb,getDrawDefinitionTimeItem:()=>AA,getDrawParticipantRepresentativeIds:()=>NO,getDrawStructures:()=>Zo,getDrawTypeCoercion:()=>Tb,getEligibleVoluntaryConsolationParticipants:()=>MO,getMatchUpsMap:()=>sn,getParticipantIdFinishingPositions:()=>AO,getPositionAssignments:()=>LI,getPositionsPlayedOff:()=>Hg,getSeedingThresholds:()=>rO,getSeedsCount:()=>Db,getStructureSeedAssignments:()=>po,getTeamLineUp:()=>_d,getValidGroupSizes:()=>pb,isAdHoc:()=>zn,isCompletedStructure:()=>Ec,isValidForQualifying:()=>FO,luckyLoserDrawPositionAssignment:()=>Uq,modifyDrawDefinition:()=>g3,modifyDrawName:()=>CO,modifySeedAssignment:()=>Mq,mutate:()=>rW,positionActions:()=>xO,pruneDrawDefinition:()=>I3,qualifierDrawPositionAssignment:()=>Eq,query:()=>T3,removeDrawPositionAssignment:()=>FI,removeRoundMatchUps:()=>U3,removeSeededParticipant:()=>zq,removeStructure:()=>_q,renameStructures:()=>Lq,resetDrawDefinition:()=>v3,resetVoluntaryConsolationStructure:()=>yW,setDrawParticipantRepresentativeIds:()=>nW,setPositionAssignments:()=>Pq,setStructureOrder:()=>xq,setSubOrder:()=>S3,shiftAdHocRounds:()=>Dq,swapAdHocRounds:()=>Rq,swapDrawPositionAssignments:()=>Gq,updateTeamLineUp:()=>ch,withdrawParticipantAtDrawPosition:()=>hq});var rW={};yt(rW,{adHocPositionSwap:()=>qq,addAdHocMatchUps:()=>JT,addDrawDefinitionTimeItem:()=>dO,addPlayoffStructures:()=>XT,addQualifyingStructure:()=>Wq,addVoluntaryConsolationStage:()=>Bq,addVoluntaryConsolationStructure:()=>ZA,alternateDrawPositionAssignment:()=>Cq,assignDrawPosition:()=>y3,assignDrawPositionBye:()=>Ya,attachConsolationStructures:()=>f3,attachPlayoffStructures:()=>EO,attachQualifyingStructure:()=>cO,attachStructures:()=>KT,automatedPlayoffPositioning:()=>Gg,automatedPositioning:()=>hb,deleteAdHocMatchUps:()=>w3,luckyLoserDrawPositionAssignment:()=>Uq,modifyDrawDefinition:()=>g3,modifyDrawName:()=>CO,modifySeedAssignment:()=>Mq,pruneDrawDefinition:()=>I3,qualifierDrawPositionAssignment:()=>Eq,removeDrawPositionAssignment:()=>FI,removeRoundMatchUps:()=>U3,removeSeededParticipant:()=>zq,removeStructure:()=>_q,renameStructures:()=>Lq,resetDrawDefinition:()=>v3,resetVoluntaryConsolationStructure:()=>yW,setDrawParticipantRepresentativeIds:()=>nW,setPositionAssignments:()=>Pq,setStructureOrder:()=>xq,setSubOrder:()=>S3,shiftAdHocRounds:()=>Dq,swapAdHocRounds:()=>Rq,swapDrawPositionAssignments:()=>Gq,updateTeamLineUp:()=>ch,withdrawParticipantAtDrawPosition:()=>hq});var pA=t=>e=>t[e],mA=(t=[])=>t.map(Dr).filter(Boolean),NC=(t=[])=>t.map(Ut).filter(Boolean),Ut=(t={})=>pA(t)("participantId"),Dr=(t={})=>pA(t)("matchUpId"),AI=(t={})=>pA(t)("drawId");function nW({representativeParticipantIds:t,drawDefinition:e}){if(!e)return{error:xa};if(!Array.isArray(t))return{error:oe};let i=NC((e==null?void 0:e.entries)||[]);return t.length&&Vi(t,i).length<t.length?{error:oe}:IT({drawDefinition:e,extension:{name:dA,value:t}})}var $a="ABANDONED",Jm="AWAITING_RESULT",Vt="BYE",Hu="CANCELLED",qi="COMPLETED",Fg="DEAD_RUBBER",Mt="DEFAULTED",cr="DOUBLE_DEFAULT",er="DOUBLE_WALKOVER",ss="IN_PROGRESS",co="INCOMPLETE",hA="NOT_PLAYED",mn="RETIRED",Wc="SUSPENDED",Ji="TO_BE_PLAYED",zt="WALKOVER",Eoe=[Jm,qi,Mt,ss,co,mn,Wc],aW=[Jm,qi,Mt,er,cr,ss,co,mn,Wc,zt],oW=[$a,Jm,Vt,Hu,qi,Fg,Mt,er,cr,ss,co,hA,mn,Wc,Ji,zt],sW=[Vt,er,cr,qi,Mt,mn,zt],lW=[$a,Jm,Hu,Fg,ss,co,hA,Wc,Ji,void 0],vr=[Hu,$a,qi,Fg,Mt,er,cr,mn,zt],fA=[$a,qi,Mt,er,cr,ss,mn,zt],uW=[ss,co,Wc,Ji],cW={ABANDONED:$a,AWAITING_RESULT:Jm,BYE:Vt,CANCELLED:Hu,COMPLETED:qi,DEAD_RUBBER:Fg,DEFAULTED:Mt,DOUBLE_WALKOVER:er,DOUBLE_DEFAULT:cr,IN_PROGRESS:ss,INCOMPLETE:co,NOT_PLAYED:hA,RETIRED:mn,SUSPENDED:Wc,TO_BE_PLAYED:Ji,WALKOVER:zt};function Qm(t,e,i){var d,p;let r=m=>{var h,f;return(f=(h=gt({element:m,name:gl}))==null?void 0:h.extension)==null?void 0:f.value},n=i==null?void 0:i.deprioritizeCompleted,a=(i==null?void 0:i.mode)===Oz&&jae,o=(i==null?void 0:i.mode)===Az&&kz,s=o||a||ym,l=m=>(m==null?void 0:m.stage)===Oe&&(m==null?void 0:m.stageSequence)===1,u=m=>l(m)?-1:s[m==null?void 0:m.stage],c=m=>m==null?void 0:m.matchUps.every(({matchUpStatus:h})=>vr.includes(h)?1:-1);return n&&c(t)-c(e)||a&&u(t)-u(e)||((t==null?void 0:t.stage)&&s[t.stage]||0)-((e==null?void 0:e.stage)&&s[e.stage]||0)||(r(t)||0)-(r(e)||0)||!o&&!a&&(((d=e==null?void 0:e.positionAssignments)==null?void 0:d.length)??1/0)-(((p=t==null?void 0:t.positionAssignments)==null?void 0:p.length)??1/0)||((t==null?void 0:t.stageSequence)??0)-((e==null?void 0:e.stageSequence)??0)||(wS(t)||0)-(wS(e)||0)}function wS(t){return((t==null?void 0:t.matchUps)||[]).reduce((e,i)=>{var n;let r=(((n=i.finishingPositionRange)==null?void 0:n.winner)||[]).reduce((a,o)=>a+o,0);return!e||r<e?r:e},void 0)}function et(t){let e=ze(t,[{[Fn]:!0,[pT]:!0}]);if(e.error)return e;let{drawDefinition:i,structureId:r}=t,{structures:n}=Zo({drawDefinition:i}),a=n==null?void 0:n.map(l=>l.structures?[...l.structures].concat(l):l).flat(),o=a==null?void 0:a.find(l=>l.structureId===r);if(!o)return{error:Mi};let s=o.structureType===lT?a==null?void 0:a.find(l=>{var u;return(u=l.structures)==null?void 0:u.some(c=>c.structureId===r)}):void 0;return{structure:o,containingStructure:s}}function Zo({withStageGrouping:t,drawDefinition:e,stageSequences:i,stageSequence:r,roundTarget:n,sortConfig:a,stages:o,stage:s}){var h;let l=!e&&_e||!(e!=null&&e.structures)&&gN||void 0;if(l)return{error:l,structures:[],stageStructures:{}};let u=f=>{var v,y;let g=(y=(v=gt({element:f,name:gl}))==null?void 0:v.extension)==null?void 0:y.value;return!n||n===g},c=((h=e==null?void 0:e.structures)==null?void 0:h.filter(p).filter(m).filter(u).sort((f,g)=>Qm(f,g,a)))??[],d=t?Object.assign({},...sT.map(f=>{let g=c==null?void 0:c.filter(v=>v.stage===f);return(g==null?void 0:g.length)&&{[f]:g}}).filter(Boolean)):{};return{structures:c,stageStructures:d};function p(f){return!s&&!Array.isArray(o)||s&&f.stage===s||Array.isArray(o)&&o.includes(f.stage)}function m(f){return!r&&!Array.isArray(i)||r&&f.stageSequence===r||Array.isArray(i)&&i.includes(f.stageSequence)}}function dW({drawDefinition:t}){if(!t)return{error:_e};let e={};return{allPositionedParticipantIds:(t.structures||[]).map(i=>{let r=i.stage;e[r]||(e[r]=[]);let{positionAssignments:n}=oi({structure:i}),a=(n==null?void 0:n.map(Ut).filter(Boolean))??[];return e[r].push(...a),a}).flat(),stagePositionedParticipantIds:e}}function oi({drawDefinition:t,structureId:e,structure:i}){let r,n=[];if(!i){if(!t)return{positionAssignments:n,error:_e};if({structure:i,error:r}=et({drawDefinition:t,structureId:e}),r)return{positionAssignments:n,error:r}}return i.structures?n=[].concat(...i.structures.map(a=>oi({structure:a}).positionAssignments)):i.positionAssignments?n=i.positionAssignments:r=jG,{positionAssignments:n,error:r}}function Er({drawDefinition:t,structureId:e,structure:i}){var u;let r=((u=oi({drawDefinition:t,structureId:e,structure:i}))==null?void 0:u.positionAssignments)||[],n=r==null?void 0:r.filter(c=>c.participantId??c.bye??c.qualifier),a=r&&(r==null?void 0:r.length)===(n==null?void 0:n.length),o=r==null?void 0:r.filter(c=>!c.participantId&&!c.bye&&!c.qualifier),s=r==null?void 0:r.filter(c=>!c.participantId&&c.bye),l=r==null?void 0:r.filter(c=>!c.participantId&&c.qualifier);return{allPositionsAssigned:a,positionAssignments:r,unassignedPositions:o,assignedPositions:n,qualifierPositions:l,byePositions:s}}var gA="addDrawDefinition",TT="addMatchUps",Tc="addParticipants",vA="addScaleItems",pW="addEvent",IA="addVenue",fu="audit",yA="dataIssue",bA="deleteParticipants",wA="deleteVenue",UA="deletedDrawIds",SA="deletedMatchUpIds",TA="modifyDrawDefinition",mW="modifyDrawEntries",hW="modifyEventEntries",DA="modifyMatchUp",nn="modifyParticipants",PA="modifyPositionAssignments",RA="modifySeedAssignments",dp="modifyTournamentDetail",pp="modifyVenue",AC="mutations",OC="publishEvent",fW="publishEventSeeding",gW="publishOrderOfPlay",vW="publishParticipants",EA="unPublishEvent",CA="unPublishEventSeeding",MA="unPublishOrderOfPlay",Coe="unPublishParticipants",DT="updateInContextMatchUp",Moe={ADD_DRAW_DEFINITION:gA,ADD_MATCHUPS:TT,ADD_PARTICIPANTS:Tc,ADD_SCALE_ITEMS:vA,ADD_EVENT:pW,ADD_VENUE:IA,AUDIT:fu,DATA_ISSUE:yA,DELETE_PARTICIPANTS:bA,DELETE_VENUE:wA,DELETED_DRAW_IDS:UA,DELETED_MATCHUP_IDS:SA,MODIFY_DRAW_DEFINITION:TA,MODIFY_DRAW_ENTRIES:mW,MODIFY_EVENT_ENTRIES:hW,MODIFY_MATCHUP:DA,MODIFY_PARTICIPANTS:nn,MODIFY_POSITION_ASSIGNMENTS:PA,MODIFY_SEED_ASSIGNMENTS:RA,MODIFY_TOURNAMENT_DETAIL:dp,MODIFY_VENUE:pp,MUTATIONS:AC,PUBLISH_EVENT_SEEDING:fW,PUBLISH_EVENT:OC,PUBLISH_ORDER_OF_PLAY:gW,PUBLISH_PARTICIPANTS:vW,UNPUBLISH_EVENT_SEEDING:CA,UNPUBLISH_EVENT:EA,UNPUBLISH_ORDER_OF_PLAY:MA,UPDATE_INCONTEXT_MATCHUP:DT};function PT(t,e){var a;if(!t)return{error:_e};let i=Date.now();t.updatedAt&&i===new Date(t.updatedAt).getTime()&&(i+=1);let r=new Date(i).toISOString(),n=e==null?void 0:e.filter(Boolean);return t.updatedAt=r,(a=t.structures)==null||a.filter(Boolean).forEach(o=>{(!(n!=null&&n.length)||n!=null&&n.includes(o.structureId))&&(o.updatedAt=r)}),{...J}}function Dc({drawDefinition:t,tournamentId:e,matchUps:i,eventId:r}){return t&&PT(t),lt({payload:{matchUps:i,tournamentId:e,eventId:r},topic:TT}),{...J}}function zu({drawDefinition:t,tournamentId:e,matchUpIds:i,eventId:r,action:n}){t&&PT(t),lt({topic:SA,payload:{tournamentId:e,matchUpIds:i,eventId:r,action:n}});for(let a of i)$N({key:a});return{...J}}function Rt({drawDefinition:t,tournamentId:e,structureId:i,context:r,eventId:n,matchUp:a}){return a?(t&&li({drawDefinition:t,structureIds:i?[i]:void 0,tournamentId:e,eventId:n}),lt({topic:DA,payload:{matchUp:a,tournamentId:e,context:r},key:a.matchUpId}),{...J}):(console.log(na),{error:na})}function Noe({tournamentId:t,inContextMatchUp:e}){return e?(lt({payload:{inContextMatchUp:e,tournamentId:t},topic:DT,key:e.matchUpId}),{...J}):{error:na}}function Hy({tournamentId:t,eventId:e,drawDefinition:i}){return i?(PT(i),lt({payload:{drawDefinition:i,tournamentId:t,eventId:e},topic:gA,key:i.drawId}),{...J}):(console.log(_e),{error:_e})}function Aoe({tournamentId:t,eventId:e,drawId:i}){return lt({payload:{drawId:i,tournamentId:t,eventId:e},topic:UA,key:i}),$N({key:i}),{...J}}function li({drawDefinition:t,tournamentId:e,structureIds:i,eventId:r}){return t?(PT(t,i),lt({payload:{tournamentId:e,eventId:r,drawDefinition:t},topic:TA,key:t.drawId}),{...J}):{error:_e}}function IW({drawDefinition:t,tournamentId:e,structure:i,eventId:r}){if(!t)return{error:_e};if(!i)return{error:lp};let n=i.seedAssignments,a=i.structureId,o=t.drawId;return lt({payload:{tournamentId:e,eventId:r,drawId:o,structureId:a,seedAssignments:n},topic:RA,key:t.drawId}),li({structureIds:[a],drawDefinition:t,tournamentId:e,eventId:r}),{...J}}function Pc({drawDefinition:t,tournamentId:e,structure:i,event:r}){if(!t)return{error:_e};if(!i)return{error:lp};let n=oi({structure:i}),a=i.structureId,o=t.drawId,s=r==null?void 0:r.eventId;return lt({topic:PA,payload:{positionAssignments:n,tournamentId:e,structureId:a,eventId:s,drawId:o},key:a}),li({structureIds:[a],drawDefinition:t,tournamentId:e,eventId:s}),{...J}}function yW({tournamentRecord:t,drawDefinition:e,resetEntries:i,event:r}){var o,s;if(!e)return{error:_e};let n=(o=e.structures)==null?void 0:o.find(l=>l.stage===Or);if(!n)return{error:Mi};let a=((s=n.matchUps)==null?void 0:s.map(({matchUpId:l})=>l))||[];return n.positionAssignments=[],n.seedAssignments=[],n.matchUps=[],zu({tournamentId:t==null?void 0:t.tournamentId,action:"resetVoluntaryConsolationStructure",matchUpIds:a,drawDefinition:e}),i&&(e.entries=e.entries.filter(l=>l.entryStage!==Or)),li({tournamentId:t==null?void 0:t.tournamentId,eventId:r==null?void 0:r.eventId,drawDefinition:e,structureIds:[n.structureId]}),{...J}}function NA({drawPositions:t,structure:e}){var r;if([Ye,Oe].includes(e.stage)&&e.stageSequence===1)return;let{positionAssignments:i}=oi({structure:e});(r=i==null?void 0:i.filter(({drawPosition:n})=>t==null?void 0:t.includes(n)))==null||r.forEach(n=>{Lt({element:n,extension:{name:wT,value:!0}})})}function RT(t){var s,l;let{appliedPolicies:e,positionAction:i,drawDefinition:r}=t;if(((s=e==null?void 0:e.audit)==null?void 0:s[vf])===!1)return;let{extension:n}=gt({name:vf,element:r}),a=Array.isArray(n==null?void 0:n.value)?(n==null?void 0:n.value)??[]:[];if(!(a!=null&&a.length)){let u=r.structures.find(c=>c.stage===Oe);if(u){let c=(l=oi({structure:u}).positionAssignments)==null?void 0:l.map(({drawPosition:d,participantId:p,bye:m,qualifier:h})=>({drawPosition:d,participantId:p,qualifier:h,bye:m}));a.push({name:"initialMainAssignments",initialAssignments:c})}}let o={value:a.concat(i),name:vf};Lt({element:r,extension:o})}function Lg({tournamentRecord:t,drawDefinition:e,event:i}){var s;let r=((s=(t==null?void 0:t.events)||i&&[i])==null?void 0:s.map(l=>l==null?void 0:l.drawDefinitions).flat().filter(Boolean))||e&&[e]||[],n={},a={},o=r.map(l=>{var u;return(u=l==null?void 0:l.structures)==null?void 0:u.filter(c=>c==null?void 0:c.structures)}).flat().filter(Boolean);for(let l of o){let{structures:u,structureId:c}=l??{};u&&c&&(n[c]=u==null?void 0:u.map(d=>d.structureId))&&u.forEach(d=>a[d.structureId]=l==null?void 0:l.structureId)}return{containedStructures:n,containerStructures:a}}function ET(t){var a;let{sides:e,matchUpType:i}=t||{},r=(a=t.potentialParticipants)!=null&&a.length?t.potentialParticipants.flat().map(o=>i===Zt?(o==null?void 0:o.individualParticipantIds)||[]:o.participantId).flat():[],n=(e||[]).map(o=>{var s;return i===Zt&&(((s=o==null?void 0:o.participant)==null?void 0:s.individualParticipantIds)||[])||(o==null?void 0:o.participantId)&&[o.participantId]||[]}).flat();return{individualParticipantIds:n.concat(r).flat(),enteredIndividualParticipantIds:n,potentialIndividualParticipantIds:r}}function Io(t){return(t==null?void 0:t.tournamentRecords)??((t==null?void 0:t.tournamentRecord)&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord})??{}}var zy="SIGN_IN_STATUS",bW="SIGNED_OUT",OI="SIGNED_IN",Vn="TEAM",St="INDIVIDUAL",Wa="GROUP",ht="PAIR",Kt="TEAM",qv={TEAM_PARTICIPANT:Vn,INDIVIDUAL:St,GROUP:Wa,TEAM:Kt,PAIR:ht},wW={INDIVIDUAL:St,GROUP:Wa,PAIR:ht,TEAM:Kt,SIGN_IN_STATUS:zy,SIGNED_OUT:bW,SIGNED_IN:OI};function CT({participantsProfile:t,participants:e=[],deepCopy:i}){let r=new Map,n=i!==!1?Me(e,t==null?void 0:t.convertExtensions,!0):e,a=n.filter(l=>l.participantType===Kt),o=n.filter(l=>l.participantType===Wa),s=n.filter(l=>l.participantType===ht);return n.forEach(l=>{if(l.participantType===St){let{participantId:u}=l;l.groupParticipantIds=[],l.teamParticipantIds=[],l.pairParticipantIds=[],l.groups=[],l.teams=[],a.forEach(c=>{((c==null?void 0:c.individualParticipantIds)||[]).forEach(d=>{var p;d===u&&!((p=l.teamParticipantIds)!=null&&p.includes(c.participantId))&&(l.teamParticipantIds.push(c.participantId),r.get(c.participantId)||r.set(c.participantId,{participantName:c.participantName,participantId:c.participantId}),l.teams.push({participantRoleResponsibilities:c.participantRoleResponsibilities,participantOtherName:c.participantOtherName,participantName:c.participantName,participantId:c.participantId,teamId:c.teamId}))})}),s.forEach(c=>{((c==null?void 0:c.individualParticipantIds)||[]).forEach(d=>{d===u&&!l.pairParticipantIds.includes(c.participantId)&&l.pairParticipantIds.push(c.participantId)})}),o.forEach(c=>{((c==null?void 0:c.individualParticipantIds)||[]).forEach(d=>{d===u&&!l.groupParticipantIds.includes(c.participantId)&&(l.groupParticipantIds.push(c.participantId),l.groups.push({participantRoleResponsibilities:c.participantRoleResponsibilities,participantOtherName:c.participantOtherName,participantName:c.participantName,participantId:c.participantId}))})})}}),{participantsWithGroupings:n,groupInfo:Object.fromEntries(r)}}var Xp=[{ioc:"",iso2:"",iso:"",label:"NONE",phone:""},{ioc:"AND",iso2:"AD",iso:"AND",label:"Andorra",phone:"376"},{ioc:"UAE",iso2:"AE",iso:"ARE",label:"United Arab Emirates",phone:"971"},{ioc:"AFG",iso2:"AF",iso:"AFG",label:"Afghanistan",phone:"93"},{ioc:"ANT",iso2:"AG",iso:"ATG",label:"Antigua and Barbuda",phone:"1-268"},{ioc:"AIA",iso2:"AI",iso:"AIA",label:"Anguilla",phone:"1-264"},{ioc:"ALB",iso2:"AL",iso:"ALB",label:"Albania",phone:"355"},{ioc:"ARM",iso2:"AM",iso:"ARM",label:"Armenia",phone:"374"},{ioc:"ANG",iso2:"AO",iso:"AGO",label:"Angola",phone:"244"},{ioc:"",iso2:"AQ",iso:"ATA",label:"Antarctica",phone:"672"},{ioc:"ARG",iso2:"AR",iso:"ARG",label:"Argentina",phone:"54"},{ioc:"ASA",iso2:"AS",iso:"ASM",label:"American Samoa",phone:"1-684"},{ioc:"AUT",iso2:"AT",iso:"AUT",label:"Austria",phone:"43"},{ioc:"AUS",iso2:"AU",iso:"AUS",label:"Australia",phone:"61",suggested:!0},{ioc:"ARU",iso2:"AW",iso:"ABW",label:"Aruba",phone:"297"},{ioc:"AZE",iso2:"AZ",iso:"AZE",label:"Azerbaijan",phone:"994"},{ioc:"BIH",iso2:"BA",iso:"BIH",label:"Bosnia and Herzegovina",phone:"387"},{ioc:"BAR",iso2:"BB",iso:"BRB",label:"Barbados",phone:"1-246"},{ioc:"BAN",iso2:"BD",iso:"BGD",label:"Bangladesh",phone:"880"},{ioc:"BEL",iso2:"BE",iso:"BEL",label:"Belgium",phone:"32"},{ioc:"BUR",iso2:"BF",iso:"BFA",label:"Burkina Faso",phone:"226"},{ioc:"BUL",iso2:"BG",iso:"BGR",label:"Bulgaria",phone:"359"},{ioc:"BRN",iso2:"BH",iso:"BHR",label:"Bahrain",phone:"973"},{ioc:"BDI",iso2:"BI",iso:"BDI",label:"Burundi",phone:"257"},{ioc:"BEN",iso2:"BJ",iso:"BEN",label:"Benin",phone:"229"},{ioc:"",iso2:"BL",iso:"BLM",label:"Saint Barthelemy",phone:"590"},{ioc:"BER",iso2:"BM",iso:"BMU",label:"Bermuda",phone:"1-441"},{ioc:"BRU",iso2:"BN",iso:"BRN",label:"Brunei Darussalam",phone:"673"},{ioc:"BOL",iso2:"BO",iso:"BOL",label:"Bolivia",phone:"591"},{ioc:"BRA",iso2:"BR",iso:"BRA",label:"Brazil",phone:"55"},{ioc:"BAH",iso2:"BS",iso:"BHS",label:"Bahamas",phone:"1-242"},{ioc:"BHU",iso2:"BT",iso:"BTN",label:"Bhutan",phone:"975"},{ioc:"",iso2:"BV",iso:"BVT",label:"Bouvet Island",phone:"47"},{ioc:"BOT",iso2:"BW",iso:"BWA",label:"Botswana",phone:"267"},{ioc:"BLR",iso2:"BY",iso:"BLR",label:"Belarus",phone:"375"},{ioc:"BIZ",iso2:"BZ",iso:"BLZ",label:"Belize",phone:"501"},{ioc:"CAN",iso2:"CA",iso:"CAN",label:"Canada",phone:"1",suggested:!0},{ioc:"",iso2:"CC",iso:"CCK",label:"Cocos (Keeling) Islands",phone:"61"},{ioc:"CGO",iso2:"CD",iso:"COG",label:"Congo, Republic of the",phone:"242"},{ioc:"CAF",iso2:"CF",iso:"CAF",label:"Central African Republic",phone:"236"},{ioc:"COD",iso2:"CG",iso:"CGD",label:"Congo, Democratic Republic of the",phone:"243"},{ioc:"SUI",iso2:"CH",iso:"CHE",label:"Switzerland",phone:"41"},{ioc:"CIV",iso2:"CI",iso:"CIV",label:"Cote d'Ivoire",phone:"225"},{ioc:"COK",iso2:"CK",iso:"COK",label:"Cook Islands",phone:"682"},{ioc:"CHI",iso2:"CL",iso:"CHL",label:"Chile",phone:"56"},{ioc:"CMR",iso2:"CM",iso:"CMR",label:"Cameroon",phone:"237"},{ioc:"CHN",iso2:"CN",iso:"CHN",label:"China",phone:"86"},{ioc:"COL",iso2:"CO",iso:"COL",label:"Colombia",phone:"57"},{ioc:"CRC",iso2:"CR",iso:"CRI",label:"Costa Rica",phone:"506"},{ioc:"CUB",iso2:"CU",iso:"CUB",label:"Cuba",phone:"53"},{ioc:"CPV",iso2:"CV",iso:"CPV",label:"Cape Verde",phone:"238"},{ioc:"CUW",iso2:"CW",iso:"CUW",label:"Curacao",phone:"599"},{ioc:"CXR",iso2:"CX",iso:"CXR",label:"Christmas Island",phone:"61"},{ioc:"CYP",iso2:"CY",iso:"CYP",label:"Cyprus",phone:"357"},{ioc:"CZE",iso2:"CZ",iso:"CZE",label:"Czech Republic",phone:"420"},{ioc:"GER",iso2:"DE",iso:"DEU",label:"Germany",phone:"49",suggested:!0},{ioc:"DJI",iso2:"DJ",iso:"DJI",label:"Djibouti",phone:"253"},{ioc:"DEN",iso2:"DK",iso:"DNK",label:"Denmark",phone:"45"},{ioc:"DMA",iso2:"DM",iso:"DMA",label:"Dominica",phone:"1-767"},{ioc:"DOM",iso2:"DO",iso:"DOM",label:"Dominican Republic",phone:"1-809"},{ioc:"ALG",iso2:"DZ",iso:"DZA",label:"Algeria",phone:"213"},{ioc:"ECU",iso2:"EC",iso:"ECU",label:"Ecuador",phone:"593"},{ioc:"EST",iso2:"EE",iso:"ESE",label:"Estonia",phone:"372"},{ioc:"EGY",iso2:"EG",iso:"EGY",label:"Egypt",phone:"20"},{ioc:"",iso2:"EH",iso:"ESH",label:"Western Sahara",phone:"212"},{ioc:"ERI",iso2:"ER",iso:"ERI",label:"Eritrea",phone:"291"},{ioc:"ESP",iso2:"ES",iso:"ESP",label:"Spain",phone:"34"},{ioc:"ETH",iso2:"ET",iso:"ETH",label:"Ethiopia",phone:"251"},{ioc:"FIN",iso2:"FI",iso:"FIN",label:"Finland",phone:"358"},{ioc:"FIJ",iso2:"FJ",iso:"FJI",label:"Fiji",phone:"679"},{ioc:"FLK",iso2:"FK",iso:"FLK",label:"Falkland Islands (Malvinas)",phone:"500"},{ioc:"FSM",iso2:"FM",iso:"FSM",label:"Micronesia, Federated States of",phone:"691"},{ioc:"FAR",iso2:"FO",iso:"FRO",label:"Faroe Islands",phone:"298"},{ioc:"FRA",iso2:"FR",iso:"FRA",label:"France",phone:"33",suggested:!0},{ioc:"GAB",iso2:"GA",iso:"GAB",label:"Gabon",phone:"241"},{ioc:"GBR",iso2:"GB",iso:"GBR",label:"United Kingdom",phone:"44"},{ioc:"GRN",iso2:"GD",iso:"GRD",label:"Grenada",phone:"1-473"},{ioc:"GEO",iso2:"GE",iso:"GEO",label:"Georgia",phone:"995"},{ioc:"FGU",iso2:"GF",iso:"GUF",label:"French Guiana",phone:"594"},{ioc:"",iso2:"GG",iso:"GGY",label:"Guernsey",phone:"44"},{ioc:"",iso2:"GH",iso:"GHA",label:"Ghana",phone:"233"},{ioc:"GIB",iso2:"GI",iso:"GIB",label:"Gibraltar",phone:"350"},{ioc:"GRL",iso2:"GL",iso:"GRL",label:"Greenland",phone:"299"},{ioc:"GAM",iso2:"GM",iso:"GMB",label:"Gambia",phone:"220"},{ioc:"GUI",iso2:"GN",iso:"GIN",label:"Guinea",phone:"224"},{ioc:"GUD",iso2:"GP",iso:"GLP",label:"Guadeloupe",phone:"590"},{ioc:"GEQ",iso2:"GQ",iso:"GNQ",label:"Equatorial Guinea",phone:"240"},{ioc:"GRE",iso2:"GR",iso:"GRC",label:"Greece",phone:"30"},{ioc:"",iso2:"GS",iso:"SGS",label:"South Georgia and the South Sandwich Islands",phone:"500"},{ioc:"GUA",iso2:"GT",iso:"GTM",label:"Guatemala",phone:"502"},{ioc:"GUM",iso2:"GU",iso:"GUM",label:"Guam",phone:"1-671"},{ioc:"GBS",iso2:"GW",iso:"GNB",label:"Guinea-Bissau",phone:"245"},{ioc:"GUY",iso2:"GY",iso:"GUY",label:"Guyana",phone:"592"},{ioc:"HKG",iso2:"HK",iso:"HKG",label:"Hong Kong",phone:"852"},{ioc:"",iso2:"HM",iso:"HMD",label:"Heard Island and McDonald Islands",phone:"672"},{ioc:"HON",iso2:"HN",iso:"HND",label:"Honduras",phone:"504"},{ioc:"CRO",iso2:"HR",iso:"HRV",label:"Croatia",phone:"385"},{ioc:"HAI",iso2:"HT",iso:"HTI",label:"Haiti",phone:"509"},{ioc:"HUN",iso2:"HU",iso:"HUN",label:"Hungary",phone:"36"},{ioc:"INA",iso2:"ID",iso:"IDN",label:"Indonesia",phone:"62"},{ioc:"IRL",iso2:"IE",iso:"IRL",label:"Ireland",phone:"353"},{ioc:"ISR",iso2:"IL",iso:"ISR",label:"Israel",phone:"972"},{ioc:"",iso2:"IM",iso:"IMN",label:"Isle of Man",phone:"44"},{ioc:"IND",iso2:"IN",iso:"IND",label:"India",phone:"91"},{ioc:"",iso2:"IO",iso:"IOT",label:"British Indian Ocean Territory",phone:"246"},{ioc:"IRQ",iso2:"IQ",iso:"IRQ",label:"Iraq",phone:"964"},{ioc:"IRI",iso2:"IR",iso:"IRN",label:"Iran, Islamic Republic of",phone:"98"},{ioc:"ISL",iso2:"IS",iso:"ISL",label:"Iceland",phone:"354"},{ioc:"ITA",iso2:"IT",iso:"ITA",label:"Italy",phone:"39"},{ioc:"",iso2:"JE",iso:"JEY",label:"Jersey",phone:"44"},{ioc:"JAM",iso2:"JM",iso:"JAM",label:"Jamaica",phone:"1-876"},{ioc:"JOR",iso2:"JO",iso:"JOR",label:"Jordan",phone:"962"},{ioc:"JPN",iso2:"JP",iso:"JPN",label:"Japan",phone:"81",suggested:!0},{ioc:"KEN",iso2:"KE",iso:"KEN",label:"Kenya",phone:"254"},{ioc:"KGZ",iso2:"KG",iso:"KGZ",label:"Kyrgyzstan",phone:"996"},{ioc:"CAM",iso2:"KH",iso:"KHM",label:"Cambodia",phone:"855"},{ioc:"KIR",iso2:"KI",iso:"KIR",label:"Kiribati",phone:"686"},{ioc:"COM",iso2:"KM",iso:"COM",label:"Comoros",phone:"269"},{ioc:"SKN",iso2:"KN",iso:"KNA",label:"Saint Kitts and Nevis",phone:"1-869"},{ioc:"KOR",iso2:"KP",iso:"KOR",label:"Korea, Democratic People's Republic of",phone:"850"},{ioc:"PRK",iso2:"KR",iso:"PRK",label:"Korea, Republic of",phone:"82"},{ioc:"KUW",iso2:"KW",iso:"KWT",label:"Kuwait",phone:"965"},{ioc:"CAY",iso2:"KY",iso:"CYM",label:"Cayman Islands",phone:"1-345"},{ioc:"KAZ",iso2:"KZ",iso:"KAZ",label:"Kazakhstan",phone:"7"},{ioc:"LAO",iso2:"LA",iso:"LAO",label:"Lao People's Democratic Republic",phone:"856"},{ioc:"LIB",iso2:"LB",iso:"LBN",label:"Lebanon",phone:"961"},{ioc:"LCA",iso2:"LC",iso:"LCA",label:"Saint Lucia",phone:"1-758"},{ioc:"LIE",iso2:"LI",iso:"LIE",label:"Liechtenstein",phone:"423"},{ioc:"SRI",iso2:"LK",iso:"LKA",label:"Sri Lanka",phone:"94"},{ioc:"LBR",iso2:"LR",iso:"LBR",label:"Liberia",phone:"231"},{ioc:"LES",iso2:"LS",iso:"LSO",label:"Lesotho",phone:"266"},{ioc:"LTU",iso2:"LT",iso:"LTU",label:"Lithuania",phone:"370"},{ioc:"LUX",iso2:"LU",iso:"LUX",label:"Luxembourg",phone:"352"},{ioc:"LAT",iso2:"LV",iso:"LVA",label:"Latvia",phone:"371"},{ioc:"LBA",iso2:"LY",iso:"LBY",label:"Libya",phone:"218"},{ioc:"MAR",iso2:"MA",iso:"MAR",label:"Morocco",phone:"212"},{ioc:"MON",iso2:"MC",iso:"MCO",label:"Monaco",phone:"377"},{ioc:"MDA",iso2:"MD",iso:"MDA",label:"Moldova, Republic of",phone:"373"},{ioc:"MNE",iso2:"ME",iso:"MNE",label:"Montenegro",phone:"382"},{ioc:"",iso2:"MF",iso:"MAF",label:"Saint Martin (French part)",phone:"590"},{ioc:"MAD",iso2:"MG",iso:"MDG",label:"Madagascar",phone:"261"},{ioc:"MSH",iso2:"MH",iso:"MHL",label:"Marshall Islands",phone:"692"},{ioc:"MKD",iso2:"MK",iso:"MKD",label:"Macedonia, the Former Yugoslav Republic of",phone:"389"},{ioc:"MLI",iso2:"ML",iso:"MLI",label:"Mali",phone:"223"},{ioc:"MYA",iso2:"MM",iso:"MMR",label:"Myanmar",phone:"95"},{ioc:"MGL",iso2:"MN",iso:"MNG",label:"Mongolia",phone:"976"},{ioc:"MAC",iso2:"MO",iso:"MAC",label:"Macao",phone:"853"},{ioc:"NMA",iso2:"MP",iso:"NMP",label:"Northern Mariana Islands",phone:"1-670"},{ioc:"MRT",iso2:"MQ",iso:"MTQ",label:"Martinique",phone:"596"},{ioc:"MTN",iso2:"MR",iso:"MRT",label:"Mauritania",phone:"222"},{ioc:"MNT",iso2:"MS",iso:"MSR",label:"Montserrat",phone:"1-664"},{ioc:"MLT",iso2:"MT",iso:"MLT",label:"Malta",phone:"356"},{ioc:"MRI",iso2:"MU",iso:"MUS",label:"Mauritius",phone:"230"},{ioc:"MDV",iso2:"MV",iso:"MDV",label:"Maldives",phone:"960"},{ioc:"MAW",iso2:"MW",iso:"MWI",label:"Malawi",phone:"265"},{ioc:"MEX",iso2:"MX",iso:"MEX",label:"Mexico",phone:"52"},{ioc:"MAS",iso2:"MY",iso:"MYS",label:"Malaysia",phone:"60"},{ioc:"MOZ",iso2:"MZ",iso:"MOZ",label:"Mozambique",phone:"258"},{ioc:"NAM",iso2:"NA",iso:"NAM",label:"Namibia",phone:"264"},{ioc:"NCL",iso2:"NC",iso:"NCL",label:"New Caledonia",phone:"687"},{ioc:"NIG",iso2:"NE",iso:"NER",label:"Niger",phone:"227"},{ioc:"NFI",iso2:"NF",iso:"NFK",label:"Norfolk Island",phone:"672"},{ioc:"NGR",iso2:"NG",iso:"NGA",label:"Nigeria",phone:"234"},{ioc:"NCA",iso2:"NI",iso:"NIC",label:"Nicaragua",phone:"505"},{ioc:"NED",iso2:"NL",iso:"NLD",label:"Netherlands",phone:"31"},{ioc:"NOR",iso2:"NO",iso:"NOR",label:"Norway",phone:"47"},{ioc:"NEP",iso2:"NP",iso:"NPL",label:"Nepal",phone:"977"},{ioc:"NRU",iso2:"NR",iso:"NRU",label:"Nauru",phone:"674"},{ioc:"NIU",iso2:"NU",iso:"NIU",label:"Niue",phone:"683"},{ioc:"NZL",iso2:"NZ",iso:"NZL",label:"New Zealand",phone:"64"},{ioc:"OMA",iso2:"OM",iso:"OMN",label:"Oman",phone:"968"},{ioc:"PAN",iso2:"PA",iso:"PAN",label:"Panama",phone:"507"},{ioc:"PER",iso2:"PE",iso:"PER",label:"Peru",phone:"51"},{ioc:"FPO",iso2:"PF",iso:"PYF",label:"French Polynesia",phone:"689"},{ioc:"PNG",iso2:"PG",iso:"PNG",label:"Papua New Guinea",phone:"675"},{ioc:"PHI",iso2:"PH",iso:"PHL",label:"Philippines",phone:"63"},{ioc:"PAK",iso2:"PK",iso:"PAK",label:"Pakistan",phone:"92"},{ioc:"POL",iso2:"PL",iso:"POL",label:"Poland",phone:"48"},{ioc:"SPM",iso2:"PM",iso:"SPM",label:"Saint Pierre and Miquelon",phone:"508"},{ioc:"",iso2:"PN",iso:"PCN",label:"Pitcairn",phone:"870"},{ioc:"PUR",iso2:"PR",iso:"PRI",label:"Puerto Rico",phone:"1"},{ioc:"PLE",iso2:"PS",iso:"PSE",label:"Palestine, State of",phone:"970"},{ioc:"POR",iso2:"PT",iso:"PRT",label:"Portugal",phone:"351"},{ioc:"PLW",iso2:"PW",iso:"PLW",label:"Palau",phone:"680"},{ioc:"PAR",iso2:"PY",iso:"PRY",label:"Paraguay",phone:"595"},{ioc:"QAT",iso2:"QA",iso:"QAT",label:"Qatar",phone:"974"},{ioc:"REU",iso2:"RE",iso:"REU",label:"Reunion",phone:"262"},{ioc:"ROU",iso2:"RO",iso:"ROU",label:"Romania",phone:"40"},{ioc:"SRB",iso2:"RS",iso:"SRB",label:"Serbia",phone:"381"},{ioc:"RUS",iso2:"RU",iso:"RUS",label:"Russia",phone:"7"},{ioc:"RWA",iso2:"RW",iso:"RWA",label:"Rwanda",phone:"250"},{ioc:"KSA",iso2:"SA",iso:"SAU",label:"Saudi Arabia",phone:"966"},{ioc:"SOL",iso2:"SB",iso:"SLB",label:"Solomon Islands",phone:"677"},{ioc:"SEY",iso2:"SC",iso:"SYC",label:"Seychelles",phone:"248"},{ioc:"SUD",iso2:"SD",iso:"SDN",label:"Sudan",phone:"249"},{ioc:"SWE",iso2:"SE",iso:"SWE",label:"Sweden",phone:"46"},{ioc:"SIN",iso2:"SG",iso:"SGP",label:"Singapore",phone:"65"},{ioc:"HEL",iso2:"SH",iso:"SHN",label:"Saint Helena",phone:"290"},{ioc:"SLO",iso2:"SI",iso:"SVN",label:"Slovenia",phone:"386"},{ioc:"",iso2:"SJ",iso:"SJM",label:"Svalbard and Jan Mayen",phone:"47"},{ioc:"SVK",iso2:"SK",iso:"SVK",label:"Slovakia",phone:"421"},{ioc:"SLE",iso2:"SL",iso:"SLE",label:"Sierra Leone",phone:"232"},{ioc:"SMR",iso2:"SM",iso:"SMR",label:"San Marino",phone:"378"},{ioc:"SEN",iso2:"SN",iso:"SEN",label:"Senegal",phone:"221"},{ioc:"SOM",iso2:"SO",iso:"SOM",label:"Somalia",phone:"252"},{ioc:"SUR",iso2:"SR",iso:"SUR",label:"Suriname",phone:"597"},{ioc:"",iso2:"SS",iso:"SSD",label:"South Sudan",phone:"211"},{ioc:"STP",iso2:"ST",iso:"STP",label:"Sao Tome and Principe",phone:"239"},{ioc:"ESA",iso2:"SV",iso:"SLV",label:"El Salvador",phone:"503"},{ioc:"",iso2:"SX",iso:"SMX",label:"Sint Maarten",phone:"1-721"},{ioc:"SYR",iso2:"SY",iso:"SYR",label:"Syria",phone:"963"},{ioc:"",iso2:"SZ",iso:"SWZ",label:"Swaziland",phone:"268"},{ioc:"TKS",iso2:"TC",iso:"TCA",label:"Turks and Caicos Islands",phone:"1-649"},{ioc:"CHA",iso2:"TD",iso:"TCD",label:"Chad",phone:"235"},{ioc:"",iso2:"TF",iso:"ATF",label:"French Southern Territories",phone:"262"},{ioc:"TOG",iso2:"TG",iso:"TGO",label:"Togo",phone:"228"},{ioc:"THA",iso2:"TH",iso:"THA",label:"Thailand",phone:"66"},{ioc:"TJK",iso2:"TJ",iso:"TJK",label:"Tajikistan",phone:"992"},{ioc:"",iso2:"TK",iso:"TKL",label:"Tokelau",phone:"690"},{ioc:"TLS",iso2:"TL",iso:"TLS",label:"Timor-Leste",phone:"670"},{ioc:"TKM",iso2:"TM",iso:"TKM",label:"Turkmenistan",phone:"993"},{ioc:"TUN",iso2:"TN",iso:"TUN",label:"Tunisia",phone:"216"},{ioc:"TGA",iso2:"TO",iso:"TON",label:"Tonga",phone:"676"},{ioc:"TUR",iso2:"TR",iso:"TUR",label:"Turkey",phone:"90"},{ioc:"TTO",iso2:"TT",iso:"TTO",label:"Trinidad and Tobago",phone:"1-868"},{ioc:"TUV",iso2:"TV",iso:"TUV",label:"Tuvalu",phone:"688"},{ioc:"TPE",iso2:"TW",iso:"TWN",label:"Taiwan",phone:"886"},{ioc:"TAN",iso2:"TZ",iso:"TZA",label:"United Republic of Tanzania",phone:"255"},{ioc:"UKR",iso2:"UA",iso:"UKR",label:"Ukraine",phone:"380"},{ioc:"UGA",iso2:"UG",iso:"UGA",label:"Uganda",phone:"256"},{ioc:"USA",iso2:"US",label:"United States",phone:"1",suggested:!0,iso:"USA"},{ioc:"URU",iso2:"UY",iso:"URY",label:"Uruguay",phone:"598"},{ioc:"UZB",iso2:"UZ",iso:"UZB",label:"Uzbekistan",phone:"998"},{ioc:"",iso2:"VA",iso:"VAT",label:"Holy See (Vatican City State)",phone:"379"},{ioc:"VIN",iso2:"VC",iso:"VCT",label:"Saint Vincent and the Grenadines",phone:"1-784"},{ioc:"VEN",iso2:"VE",iso:"VEN",label:"Venezuela",phone:"58"},{ioc:"IVB",iso2:"VG",iso:"VGB",label:"British Virgin Islands",phone:"1-284"},{ioc:"ISV",iso2:"VI",iso:"VIR",label:"US Virgin Islands",phone:"1-340"},{ioc:"VIE",iso2:"VN",iso:"VNM",label:"Vietnam",phone:"84"},{ioc:"VAN",iso2:"VU",iso:"VUT",label:"Vanuatu",phone:"678"},{ioc:"WAF",iso2:"WF",iso:"WLF",label:"Wallis and Futuna",phone:"681"},{ioc:"SAM",iso2:"WS",iso:"WSM",label:"Samoa",phone:"685"},{ioc:"KOS",iso2:"XK",iso:"KOS",label:"Kosovo",phone:"383"},{ioc:"YEM",iso2:"YE",iso:"YEM",label:"Yemen",phone:"967"},{ioc:"MAY",iso2:"YT",iso:"MYT",label:"Mayotte",phone:"262"},{ioc:"RSA",iso2:"ZA",iso:"ZAF",label:"South Africa",phone:"27"},{ioc:"ZAM",iso2:"ZM",iso:"ZMB",label:"Zambia",phone:"260"},{ioc:"ZIM",iso2:"ZW",iso:"ZWE",label:"Zimbabwe",phone:"263"}];function UW({participant:t,withISO2:e,withIOC:i}){let{person:r,individualParticipants:n}=t,a=[r,n==null?void 0:n.map(({person:s})=>s)].flat().filter(Boolean);function o(s){let{nationalityCode:l}=s||{};if(l){let u=Xp.find(({iso:c})=>c===l);i&&(u!=null&&u.ioc)&&!s.iocNationalityCode&&(s.iocNationalityCode=u.ioc),e&&(u!=null&&u.iso2)&&!s.iso2NationalityCode&&(s.iso2NationalityCode=u.iso2),u!=null&&u.label&&!s.countryName&&(s.countryName=u.label)}}a.forEach(o)}function Ooe({participantMap:t,template:e}){var r;let i=Object.values(t);for(let n of i){let a=n.participant;if((r=a.individualParticipantIds)!=null&&r.length){a.individualParticipants=[];for(let o of a.individualParticipantIds){let s=t[o].participant;a.individualParticipants.push(e?bm({template:e,source:s}):s)}}}}function qc(t){var n;let{tournamentRecord:e,participantId:i}=t,r=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};for(let a of Object.values(r)){let o=(n=a.participants)==null?void 0:n.find(s=>s.participantId===i);if(o)return{participant:o,tournamentId:a.tournamentId}}return{error:zi}}function SW(t){let{tournamentRecord:e,participantId:i}=t;if(i){let n=qc({tournamentRecord:e,participantId:i});return n.participant??n}return t.element||t.drawDefinition||t.event||t.tournamentRecord||{error:Xe}}function yo(t){let{returnPreviousValues:e,itemSubTypes:i,itemType:r}=t,n=SW(t);if(n.error)return n;if(i&&!Array.isArray(i))return{error:oe,context:{itemSubTypes:i}};if(!Array.isArray(n.timeItems))return{error:NN};let a=n.timeItems.filter(s=>(s==null?void 0:s.itemType)===r).filter(s=>!(i!=null&&i.length)||i.some(l=>{var u;return(u=s==null?void 0:s.itemSubTypes)==null?void 0:u.includes(l)})).sort((s,l)=>{let u=new Date(s.createdAt||void 0).getTime(),c=new Date(l.createdAt||void 0).getTime();return u-c}),o=Me(a.pop(),!1,!0);if(o){let s={timeItem:o,...J};return e&&Object.assign(s,{previousItems:a}),s}else return{info:$r}}function AA({returnPreviousValues:t,drawDefinition:e,itemSubTypes:i,itemType:r}){if(!e)return{error:xs};if(!e.timeItems)return{info:$r};let{timeItem:n,previousItems:a,info:o}=yo({element:e,returnPreviousValues:t,itemSubTypes:i,itemType:r});return n&&{timeItem:n,previousItems:a}||{info:o}}function Wy({returnPreviousValues:t,itemSubTypes:e,itemType:i,event:r}){if(!r)return{error:gi};if(!r.timeItems)return{info:$r};let{timeItem:n,previousItems:a,info:o}=yo({returnPreviousValues:t,element:r,itemSubTypes:e,itemType:i});return n&&{timeItem:n,previousItems:a}||{info:o}}function MT({returnPreviousValues:t,tournamentRecord:e,itemSubTypes:i,itemType:r}){if(!e)return{error:ge};if(!e.timeItems)return{info:$r};let{timeItem:n,previousItems:a,info:o}=yo({element:e,returnPreviousValues:t,itemSubTypes:i,itemType:r});return n&&{timeItem:n,previousItems:a}||{info:o}}function OA({returnPreviousValues:t,tournamentRecord:e,participantId:i,itemSubTypes:r,itemType:n}){if(!e)return{error:ge};if(!i)return{error:pr};let a=qc({tournamentRecord:e,participantId:i});if(a.error)return a;let{participant:o}=a;if(!(o!=null&&o.timeItems))return{info:$r};let{timeItem:s,previousItems:l,info:u}=yo({element:a.participant,returnPreviousValues:t,itemSubTypes:r,itemType:n});return s&&{timeItem:s,previousItems:l}||{info:u}}var koe={[Wa]:"groupParticipantIds",[ht]:"pairParticipantIds",[Kt]:"teamParticipantIds"},xoe={[Wa]:"groups",[Kt]:"teams"};function TW({withIndividualParticipants:t,convertExtensions:e,tournamentRecord:i,withSignInStatus:r,withScaleValues:n,withGroupings:a,internalUse:o,withISO2:s,withIOC:l}){let u=[],c={};for(let p of i.participants??[]){let m=p==null?void 0:p.participantId;m&&_oe({participantMap:c,participantId:m})}for(let p of i.participants??[]){let m=Me(p,e,o),{participantId:h,individualParticipantIds:f,participantType:g}=m;if(!c[h]){u.push(h);continue}if(Object.assign(c[h].participant,m),f){let v=Loe({individualParticipantIds:f,participantCopy:m,participantMap:c,participantType:g,participantId:h});v.missingParticipantIds.length&&u.push(...v.missingParticipantIds)}if(r&&(c[h].participant.signedIn=Foe(m)),n){let{ratings:v,rankings:y,seedings:I}=kg({participant:m});c[h].participant.seedings=I,c[h].participant.rankings=y,c[h].participant.ratings=v}(l||s)&&UW({participant:c[h].participant,withISO2:s,withIOC:l})}if(t){let p=Nt(t)?t:void 0;Ooe({participantMap:c,template:p})}let d;return a&&(d=CT({participants:Object.values(c).map(({participant:p})=>p),participantsProfile:{convertExtensions:e},deepCopy:!1}).groupInfo),{missingParticipantIds:u,participantMap:c,groupInfo:d}}function Foe(t){let{timeItem:e}=yo({itemType:zy,element:t});return(e==null?void 0:e.itemValue)===OI}function Loe({individualParticipantIds:t,participantCopy:e,participantMap:i,participantType:r,participantId:n}){var o;let a=[];for(let s of t){let l=(o=i[s])==null?void 0:o.participant;if(!l){a.push(s);continue}if(l[koe[r]].push(n),[Kt,Wa].includes(r)){let{participantRoleResponsibilities:u,participantOtherName:c,participantName:d,participantId:p,teamId:m}=e,h=xoe[r];l[h].push({participantRoleResponsibilities:u,participantOtherName:c,participantName:d,participantId:p,teamId:m})}if(r===ht){let u=t.find(c=>c!==s);i[s].pairIdMap[n]=u,i[s].pairIdMap[u]=n}}return{missingParticipantIds:a}}function _oe({participantMap:t,participantId:e}){if(t[e])return;let i={walkoverWins:0,defaultWins:0,walkovers:0,defaults:0,losses:0,wins:0};t[e]={structureParticipation:{},potentialMatchUps:{},scheduleConflicts:{},scheduleItems:[],participant:{groupParticipantIds:[],pairParticipantIds:[],teamParticipantIds:[],seedings:{},rankings:{},ratings:{},groups:[],teams:[]},statistics:{},opponents:{},pairIdMap:{},matchUps:{},events:{},draws:{},counters:{[ti]:{...i},[Zt]:{...i},[Kt]:{...i},...i}}}function mp({participantsProfile:t,useParticipantMap:e,tournamentRecord:i,contextProfile:r,inContext:n}){if(e)return TW({...t,...r,tournamentRecord:i});let a=Me(i.participants,!1,!0)||[];(t!=null&&t.withIOC||t!=null&&t.withISO2)&&a.forEach(s=>UW({participant:s,...t}));let o;if((n||t!=null&&t.withGroupings)&&(a!=null&&a.length)&&({participantsWithGroupings:a,groupInfo:o}=CT({participantsProfile:t,deepCopy:!1,participants:a})),(t==null?void 0:t.withScaleValues)&&(a==null?void 0:a.length))for(let s of a){let{ratings:l,rankings:u}=kg({participant:s});s.rankings=u,s.ratings=l}return{participants:a,groupInfo:o}}function $t({onlySpecifiedPolicyTypes:t=!1,policyTypes:e=[],tournamentRecord:i,drawDefinition:r,structure:n,event:a}){if(!Array.isArray(e))return{error:bN};let o={};return i&&s(i),a&&s(a),r&&s(r),n&&s(n),{appliedPolicies:o,...J};function s(l){var c,d;let u=(d=(c=l==null?void 0:l.extensions)==null?void 0:c.find(p=>p.name===NI))==null?void 0:d.value;if(u)for(let p of Object.keys(u))(t?e.includes(p):!e.length||e.includes(p))&&(o[p]=Me(u[p],!1,!0))}}function Wu({policyTypes:t=[],tournamentRecord:e,drawDefinition:i,structure:r,event:n}){if(!Array.isArray(t))return{error:bN};let{appliedPolicies:a}=$t({tournamentRecord:e,drawDefinition:i,structure:r,event:n}),o={};for(let s of t){let l=a==null?void 0:a[s];l&&(o[s]=l)}return Object.keys(o).length?{policyDefinitions:o}:{info:Kp.message}}var DW="WALKOVER",AB="RETIRED",kA="COMPETITIVE",kI="ROUTINE",xI="DECISIVE",CU="winRatio",$oe={[su]:{policyName:"Competitive Bands Default",profileBands:{[xI]:20,[kI]:50}}},xA=$oe;function qu({policyDefinitions:t,tournamentRecord:e,contextProfile:i,drawDefinition:r,event:n}){let a={policies:{}};if(!i)return a;let o=Wu({tournamentRecord:e,drawDefinition:r,event:n}).policyDefinitions;if(i.withCompetitiveness){let s=(t==null?void 0:t[su])??(o==null?void 0:o[su])??xA[su];a.policies[su]=s}return a}function hp({tournamentRecord:t,drawDefinition:e,policyType:i,structure:r,event:n}){if(!t)return{error:ge};let{appliedPolicies:a}=$t({tournamentRecord:t,drawDefinition:e,structure:r,event:n});return a!=null&&a[i]?{policy:a[i]}:{info:Kp==null?void 0:Kp.message}}function qy({tournamentRecord:t,categoryName:e,categoryType:i,event:r}){var s,l,u,c,d,p;e=e??((s=r==null?void 0:r.category)==null?void 0:s.categoryName)??((l=r==null?void 0:r.category)==null?void 0:l.ageCategoryCode),i=i??((u=r==null?void 0:r.category)==null?void 0:u.categoryType)??((c=r==null?void 0:r.category)==null?void 0:c.subType);let{policy:n}=hp({policyType:Hc,tournamentRecord:t,event:r}),a=(d=t?gt({element:t,name:Du}).extension:void 0)==null?void 0:d.value,o=(p=r&&gt({name:Du,element:r}).extension)==null?void 0:p.value;return{scheduleTiming:{tournamentScheduling:a,eventScheduling:o,categoryName:e,categoryType:i,policy:n}}}function FA({drawDefinition:t,attributes:e}){let{extension:i}=gt({element:t,name:bS}),r=(i==null?void 0:i.value)||{};return e.forEach(n=>{Object.keys(n).forEach(a=>{r[a]?Object.assign(r[a],n[a]):r[a]=n[a]})}),i={name:bS,value:r},IT({drawDefinition:t,extension:i}),{entryProfile:r}}function Yy({drawDefinition:t}){let{extension:e}=gt({element:t,name:bS});return{entryProfile:(e==null?void 0:e.value)||{}}}var jo="ALTERNATE",Ky="CONFIRMED",oa="DIRECT_ACCEPTANCE",Xy="FEED_IN",Jy="JUNIOR_EXEMPT",Pu="LUCKY_LOSER",Qy="ORGANISER_ACCEPTANCE",Zy="QUALIFIER",Boe="REGISTERED",eb="SPECIAL_EXEMPT",bo="UNGROUPED",fp="UNPAIRED",_f="WILDCARD",Ru="WITHDRAWN",MU=[Ky,oa,Jy,Qy,eb],PW=[Xy,Pu,Zy],gp=[Ky,oa,Xy,Jy,Qy,eb,_f],ls=[Ky,oa,Jy,Pu,Zy,Qy,eb,_f],RW=[jo,Ky,oa,Xy,Jy,Pu,Qy,Zy,Boe,eb,bo,fp,_f,Ru],Voe={ALTERNATE:jo,CONFIRMED:Ky,DIRECT_ACCEPTANCE:oa,DIRECT_ENTRY_STATUSES:gp,DRAW_SPECIFIC_STATUSES:PW,EQUIVALENT_ACCEPTANCE_STATUSES:MU,FEED_IN:Xy,JUNIOR_EXEMPT:Jy,LUCKY_LOSER:Pu,ORGANISER_ACCEPTANCE:Qy,QUALIFIER:Zy,SPECIAL_EXEMPT:eb,STRUCTURE_SELECTED_STATUSES:ls,UNGROUPED:bo,UNPAIRED:fp,VALID_ENTRY_STATUSES:RW,WILDCARD:_f,WITHDRAWN:Ru};function LA({stage:t,drawDefinition:e}){let{entryProfile:i}=Yy({drawDefinition:e}),r=Object.keys(i).includes(t);if(!r&&sT.includes(t)){let n=[{[t]:{drawSize:void 0,alternates:!0}}];return FA({drawDefinition:e,attributes:n}),!0}return r}function joe({stage:t,drawDefinition:e}){var r;let{entryProfile:i}=Yy({drawDefinition:e});return((r=i[t])==null?void 0:r.alternates)||0}function Goe({stage:t,drawDefinition:e}){var r;let{entryProfile:i}=Yy({drawDefinition:e});return((r=i[t])==null?void 0:r.wildcardsCount)||0}function kC({stage:t,drawDefinition:e,entryStatus:i}){return e.entries.reduce((r,n)=>n.entryStage===t&&n.entryStatus===i?r+1:r,0)}function Zm({provisionalPositioning:t,placementGroup:e,drawDefinition:i,stageSequence:r,entryStatuses:n,structureId:a,roundTarget:o,stages:s,stage:l}){var c;let u=((c=i.entries)==null?void 0:c.reduce((d,p)=>{var v,y;let m=(y=(v=gt({name:gl,element:p}))==null?void 0:v.extension)==null?void 0:y.value,h=l&&p.entryStage===l||(s==null?void 0:s.length)&&p.entryStage&&s.includes(p.entryStage),f=!n||p.entryStatus&&n.includes(p.entryStatus),g=p.entryStageSequence??1;return h&&(!r||g===r)&&f&&(!o||!m||o===m)?d.concat(p):d},[]))??[];if(a&&l===$i){let{playoffEntries:d,error:p}=Hoe({provisionalPositioning:t,drawDefinition:i,structureId:a});return p&&console.log("playoff entries error"),(d!=null&&d.length?d:u).filter(m=>!e||m.placementGroup===e)}return u}function Hoe({provisionalPositioning:t,drawDefinition:e,structureId:i}){let r=[],n=(e.links??[]).find(a=>a.linkType===Uu&&a.target.structureId===i);if(n){let{finishingPositions:a,structureId:o}=n.source,{structure:s}=et({drawDefinition:e,structureId:o});(s==null?void 0:s.structureType)===xn&&(s.structures??[]).forEach(l=>{let u=l.positionAssignments??[],{structureId:c}=l,d=c,p=Object.assign({},...u.map(f=>{var y;let{participantId:g}=f,v=(y=gt({element:f,name:Sc}).extension)==null?void 0:y.value;return v&&g?{[g]:v}:void 0}).filter(Boolean)),m=Object.keys(p).reduce((f,g)=>{let v=p[g],y=v.groupOrder||t&&v.provisionalOrder;return f.includes(y)||f.push(y),f},[]).length===Object.keys(p).length,h=Object.keys(p).filter(f=>{let g=p[f],v=g.groupOrder||t&&g.provisionalOrder;return a==null?void 0:a.includes(v)});(!t||m)&&h.forEach(f=>{let g=p[f],{groupOrder:v,provisionalOrder:y,GEMscore:I}=g,b=v||t&&y,S=[...a??[]].sort(or).indexOf(b)+1;r.push({entryStage:$i,entryStatus:Xy,placementGroup:S,groupingValue:d,participantId:f,GEMscore:I})})})}return{playoffEntries:r}}function zoe({stage:t,drawDefinition:e}){return gp.reduce((i,r)=>(kC({drawDefinition:e,entryStatus:r,stage:t})||0)+i,0)}function po({provisionalPositioning:t,returnAllProxies:e,drawDefinition:i,structureId:r,structure:n}){var h;let a,o=[];n||({structure:n,error:a}=et({drawDefinition:i,structureId:r}));let s=oi({structure:n}).positionAssignments;if(a||!n)return{seedAssignments:[],error:Mi};r||(r=n.structureId);let{stage:l,stageSequence:u}=n,c=l===$i&&i&&Zm({provisionalPositioning:t,drawDefinition:i,stageSequence:u,structureId:r,stage:l}),d=c?c.filter(f=>f.placementGroup===1).sort((f,g)=>f.GEMscore<g.GEMscore&&1||f.GEMscore>g.GEMscore&&-1||0).map((f,g)=>{let v=g+1;return{participantId:f.participantId,seedValue:v,seedProxy:!0,seedNumber:v}}):[],p=d==null?void 0:d.slice(0,e?d.length:s.length/2);p.length?o=p:n.seedAssignments?o=n.seedAssignments:a=AG;let m=n.seedLimit??((h=n==null?void 0:n.positionAssignments)==null?void 0:h.length);return{seedAssignments:o,stageSequence:u,seedLimit:m,stage:l,error:a}}function _s(t){if(!t)return;let{tieFormatId:e,tieFormats:i}=t;if(t.tieFormat)return t.tieFormat;if(e&&Array.isArray(i))return i.find(r=>r.tieFormatId===e)}function Yv({item:t,drawDefinition:e,structure:i,event:r}){var n,a,o;if(t){if(t.tieFormat)return t.tieFormat;if(t.tieFormatId)return e.tieFormat?e.tieFormat:((n=e.tieFormats)==null?void 0:n.find(l=>t.tieFormatId===l.tieFormatId))||(r.tieFormat?r.tieFormat:(a=r.tieFormats)==null?void 0:a.find(l=>t.tieFormatId===l.tieFormatId));if(i.tieFormat)return i.tieFormat;if(i.tieFormatId){let s=(o=e.tieFormats)==null?void 0:o.find(l=>i.tieFormatId===l.tieFormatId);if(s)return s}}}function vn({drawDefinition:t,structure:e,matchUp:i,event:r}){return{tieFormat:Yv({item:i,drawDefinition:t,structure:e,event:r})||Yv({item:e,drawDefinition:t,structure:e,event:r})||_s(t)||_s(r)}}function Woe({matchUps:t}){let e=t.reduce((i,r)=>!r.collectionPosition||i.includes(r.collectionPosition)?i:i.concat(r.collectionPosition),[]).map(i=>({[i]:t.filter(r=>r.collectionPosition===i)}));return{collectionPositionMatchUps:Object.assign({},...e)}}function sn({drawDefinition:t,structure:e}){let i={},r=[];return((t==null?void 0:t.structures)??[e]).filter(n=>n&&typeof n=="object").forEach(n=>{if(!n)return;let{structureId:a,matchUps:o,structures:s}=n,l=Array.isArray(s);if(l)l&&s.forEach(u=>{let{structureName:c}=u,d=u.matchUps;i[u.structureId]={matchUps:d,itemStructureIds:[],structureName:c},d&&(r.push(...d),d.forEach(p=>{p.tieMatchUps&&r.push(...p.tieMatchUps)})),i[a]||(i[a]={itemStructureIds:[],matchUps:[]}),i[a].itemStructureIds||(i[a].itemStructureIds=[]),i[a].itemStructureIds.push(u.structureId)});else{let u=o;i[a]={matchUps:u,itemStructureIds:[]},u==null||u.forEach(c=>{r.push(c),c.tieMatchUps&&r.push(...c.tieMatchUps)})}}),{mappedMatchUps:i,drawMatchUps:r}}function Ld({mappedMatchUps:t,matchUpsMap:e,structureId:i,inContext:r}){t=(e==null?void 0:e.mappedMatchUps)??t;let n=t[i],a=((n==null?void 0:n.itemStructureIds)||[]).map(o=>{let{matchUps:s,structureName:l}=t[o];return r?s.map(u=>Object.assign(Me(u,!0,!0),{containerStructureId:i,structureId:o,structureName:l})):s}).flat();return((n==null?void 0:n.matchUps)||[]).concat(...a)}function EW({groupedOrder:t,roundPositionsCount:e}){if(!t||(t==null?void 0:t.length)<=e)return t;let i=Rr(t,t.length/e).map(n=>n.reduce((a,o)=>a+o)),r=i.slice().sort(or);return i.map(n=>r.indexOf(n)+1)}function NT(t){if(!Nt(t))return!1;let{matchUpId:e,drawPositions:i}=t,r=typeof e=="string",n=!i||Array.isArray(i)&&i.length<=2&&i.every(a=>ot(a)||a===void 0||a===null);return r&&n}function wo(t){return Array.isArray(t)?t.every(NT):!1}function En({matchUps:t=[],interpolate:e}){var d;if(!wo(t))return{roundMatchUps:[],error:oe};let i=t.reduce((p,m)=>{let h=typeof m.roundNumber=="string"?Qe(m.roundNumber):m.roundNumber;return!m.roundNumber||p.includes(h)?p:p.concat(h)},[]).sort(or).map(p=>{let m=t.filter(g=>g.roundNumber===p),h=m.find(({matchUpType:g})=>g===hi)?m.filter(({matchUpType:g})=>g===hi):m,f=g=>g.sort((v,y)=>or(v.roundPosition,y.roundPosition));return{[p]:f(h)}}),r=t.reduce((p,m)=>{let h=typeof m.roundNumber=="string"?Qe(m.roundNumber):m.roundNumber;return p[h]||(p[h]=Ge({abbreviatedRoundName:m.abbreviatedRoundName,finishingRound:m.finishingRound,roundName:m.roundName})),p},{}),n=Object.assign({},...i);if(e){let p=Math.max(...Object.keys(n).map(h=>Qe(h)).filter(h=>!isNaN(h))),m=(d=n[p])==null?void 0:d.length;if(m>1&&Ss(m)){let h=p+1,f=h+m/2;Se(h,f).forEach((g,v)=>{n[g]=Se(0,m/(2+v*2)).map(()=>({}))})}}let a=0,o=Object.assign({},...Object.keys(n).map(p=>{var g,v,y;let m=(g=n[p])==null?void 0:g.length,h=(y=(v=n[p])==null?void 0:v.filter(I=>{var b;return!vr.includes(I.matchUpStatus)&&!((b=I.score)!=null&&b.scoreStringSide1)}))==null?void 0:y.length,f=m&&m===h;return a=Math.max(a,m),{[p]:{matchUpsCount:m,inactiveCount:h,inactiveRound:f}}})),s=0,l=0,u=Object.keys(n).map(p=>Qe(p)).filter(p=>!isNaN(p));u.forEach(p=>{var f,g,v,y,I;let m=n[p].sort((b,S)=>b.roundPosition-S.roundPosition),h=m.map(b=>(b==null?void 0:b.drawPositions)||[]).flat();if(o[p].roundNumber=p,o[p].roundFactor=o[p].matchUpsCount?a/o[p].matchUpsCount:1,o[p].finishingRound=(f=r[p])==null?void 0:f.finishingRound,o[p].roundName=(g=r[p])==null?void 0:g.roundName,o[p].abbreviatedRoundName=(v=r[p])==null?void 0:v.abbreviatedRoundName,o[p].finishingPositionRange=(I=(y=n[p])==null?void 0:y[0])==null?void 0:I.finishingPositionRange,p===1||!o[p-1]){let b=h.sort(or),S=Rr(b,2);o[p].drawPositions=b,o[p].pairedDrawPositions=S}else{let b=o[p-1],S=b.drawPositions,w=b.matchUpsCount/o[p].matchUpsCount,U=Rr(S,w),T=m.map(D=>{let{roundPosition:P}=D,E=[...D.drawPositions||[],void 0,void 0].slice(0,2);if(!P)return E;let R=(E==null?void 0:E.filter(Boolean))||[];if(!(R!=null&&R.length))return[void 0,void 0];if(p<3&&(R==null?void 0:R.length)===2)return E==null?void 0:E.slice().sort(or);let N=Vi(S,R).length!==(R==null?void 0:R.length);if(R!=null&&R.length&&N)return(R==null?void 0:R.length)===1?[R[0],void 0]:E==null?void 0:E.slice().sort(or);let A=(P-1)*2;return U.slice(A,A+2).map(M=>R==null?void 0:R.find(C=>M.includes(C)))});o[p].drawPositions=T==null?void 0:T.flat(),o[p].pairedDrawPositions=T}o[p+1]&&o[p+1].matchUpsCount===o[p].matchUpsCount&&(o[p+1].feedRound=!0,o[p+1].feedRoundIndex=l,o[p].preFeedRound=!0,l+=1),o[p]&&!o[p].feedRound&&(o[p].roundIndex=s,s+=1)});let c=!!Object.values(o).find(({matchUpsCount:p})=>!Ss(p));return{hasNoRoundPositions:t.some(p=>!p.roundPosition),roundsNotPowerOf2:c,maxMatchUpsCount:a,roundMatchUps:n,roundNumbers:u,roundProfile:o,...J}}function NU(t){if(!Array.isArray(t))return"";let e=t.filter(Li);return e.length?ct([Math.min(...e),Math.max(...e)]).join("-"):""}function qoe({drawDefinition:t,structureId:e,matchUpsMap:i}){if(!t)return{error:_e};if(!e)return{error:za};let{structure:r}=et({drawDefinition:t,structureId:e});if((r==null?void 0:r.stage)!==rn)return{error:up,info:"Structure is not CONSOLATION stage"};let{links:n}=t,a=(n==null?void 0:n.filter(d=>d.target.structureId===e))||[],o=(a==null?void 0:a.reduce((d,p)=>{let{structureId:m}=p.source;return d.includes(m)?d:d.concat(m)},[]))||[],s=Object.assign({},...o.map(d=>{let p=Ld({structureId:d,matchUpsMap:i}),m=En({matchUps:p}).roundProfile;return{[d]:m}})),l=Ld({matchUpsMap:i,structureId:e}),{roundProfile:u}=En({matchUps:l}),c={};return a==null||a.forEach(d=>{var R,N,A;let{structureId:p,roundNumber:m}=d.source,{feedProfile:h,groupedOrder:f,positionInterleave:g,roundNumber:v}=d.target,y=s[p],I=(R=y[1])==null?void 0:R.drawPositions,b=(N=y[m])==null?void 0:N.matchUpsCount;if(!b)return;let S=b?I.length/b:0,w=I.length/S,U=I.slice(),T=EW({roundPositionsCount:w,groupedOrder:f}),D=(T==null?void 0:T.length)||1;if(D<=w){let M=I.length/D,C=Rr(U,M);h===Od&&C.forEach(O=>O.reverse()),U=(T==null?void 0:T.length)&&(T==null?void 0:T.map(O=>C[O-1]).flat())||U}let P=Rr(U,S);if(g){let M=Se(0,g.interleave).map(()=>{}),C=Se(0,g.offset).map(()=>{});P=P.map(k=>[k,...M]),P.unshift(C),P=P.flat(1);let O=P.length-g.offset;P=P.slice(0,O)}c[v]||(c[v]={});let E=(A=u==null?void 0:u[v])!=null&&A.feedRound?2:1;P.forEach((M,C)=>{let O=1+C*E;c[v][O]||(c[v][O]=NU(M))})}),{sourceDrawPositionRanges:c}}function CW({drawDefinition:t}){if(typeof t!="object")return{error:Yp};let e={},{structures:i=[],links:r=[]}=t||{},n=i.reduce((o,s)=>{let{stage:l}=s;return o[l]?o[l].push(s):o[l]=[s],o},{});for(let o of Object.keys(n)){let s=n[o].find(({stageSequence:u})=>u===1);if(!s)continue;let{structureId:l}=s;a({aggregator:{},targetRound:0,exitProfiles:e,exitProfile:"0",structureId:l,stage:o})}return{exitProfiles:e};function a({exitProfiles:o,exitProfile:s,structureId:l,targetRound:u,aggregator:c,stage:d}){o[l]||(o[l]=[]),s==="0"&&[rn,$i].includes(d)||o[l].push(s);let p=r.filter(m=>m.source.structureId===l&&m.source.roundNumber>=u);for(let m of p){let h=m.source.roundNumber,f=m.target.roundNumber,g=m.target.structureId,v=i.find(I=>I.structureId===g).stage,y=[v,g,f,h].join("|");if(c[y])return;c[y]=!0,a({exitProfile:`${s}-${h}`,structureId:g,exitProfiles:o,targetRound:f,aggregator:c,stage:v})}}}function Yoe({drawDefinition:t,roundProfile:e,structureId:i,matchUpsMap:r}){var o;if(!t)return{error:_e};if(!i)return{error:za};if(!e){let s=Ld({matchUpsMap:r,structureId:i});if({roundProfile:e}=En({matchUps:s}),!e)return{error:Xe}}let n=(Math.min(...((o=e==null?void 0:e[1])==null?void 0:o.drawPositions)??[])||1)-1,a=Object.keys(e);return{drawPositionsRanges:Object.assign({},...(a||[]).map(s=>{var v,y;let l=(v=e==null?void 0:e[s])==null?void 0:v.matchUpsCount,u=((y=e==null?void 0:e[1])==null?void 0:y.drawPositions)??[],c=Rr(u,u.length/l),d=c.map(NU),p=c.map(I=>I.map(b=>b-n)).map(NU),m=a.map(I=>{var S;if(I>s)return;let b=((S=e==null?void 0:e[I])==null?void 0:S.drawPositions)??[];return Rr(b,b.length/l)}).filter(Boolean),h=Se(0,l).map(I=>m.map(b=>b[I]).flat().filter(Boolean).sort(or)).map(I=>ct(I)),f=h.map(I=>wne(I).map(NU).join(", ")),g=Object.assign({},...Se(0,l).map(I=>({[I+1]:{firstRoundDrawPositionsRange:d[I],firstRoundOffsetDrawPositionsRange:p[I],possibleDrawPositions:h[I],drawPositionsRange:f[I]}})));return{[s]:g}}))}}function _A({roundsNotPowerOf2:t,drawDefinition:e,structure:i,matchUps:r}){var a;if(!i)return!1;r=r??i.matchUps??[],t=t??En({matchUps:r}).roundsNotPowerOf2;let n=!!((a=i.positionAssignments)!=null&&a.find(({drawPosition:o})=>o))||!!(r!=null&&r.find(({drawPositions:o})=>o==null?void 0:o.length));return(!(e!=null&&e.drawType)||e.drawType!==cp)&&!(i!=null&&i.structures)&&t&&n}function zn({structure:t}){if(!t)return!1;let e=t.matchUps||t.roundMatchUps&&Object.values(t.roundMatchUps).flat(),i=!!(e!=null&&e.find(n=>n==null?void 0:n.roundPosition)),r=!!(e!=null&&e.find(n=>{var a;return(a=n==null?void 0:n.drawPositions)==null?void 0:a.length}));return!(t!=null&&t.structures)&&(t==null?void 0:t.stage)!==Or&&(!e.length||!i&&!r)}var MW={[xf]:{policyName:"Round Naming Default",namingConventions:{round:"Round",pre:"Pre"},qualifyingFinishMap:{1:"Final"},abbreviatedRoundNamingMap:{1:"F",2:"SF",4:"QF"},roundNamingMap:{1:"Final",2:"Semifinal",4:"Quarterfinal"},affixes:{roundNumber:"R",preFeedRound:"Q",preQualifying:"P"},stageConstants:{[Oe]:"",[$i]:"P",[Ye]:"Q",[rn]:"C"}}},Koe=MW;function Xoe({roundNamingPolicy:t,drawDefinition:e,structure:i,matchUps:r}){var R,N,A;let{roundProfile:n,roundMatchUps:a}=En({matchUps:r}),{structureAbbreviation:o,stage:s}=i,l=zn({structure:i}),u=_A({structure:i}),c=i.structures,d={},p=MW[xf],m=i.stage===Ye,h=m?Math.max(...((e==null?void 0:e.structures)??[]).filter(M=>M.stage===Ye).map(({stageSequence:M})=>M??1),0):0,f=(i.stageSequence??1)<h?i.stageSequence??1:"",g=f&&(((R=t==null?void 0:t.affixes)==null?void 0:R.preQualifying)||p.affixes.preQualifying)||"",v=(t==null?void 0:t.roundNamingMap)||p.roundNamingMap||{},y=(t==null?void 0:t.abbreviatedRoundNamingMap)||p.abbreviatedRoundNamingMap||{},I=((N=t==null?void 0:t.affixes)==null?void 0:N.preFeedRound)||p.affixes.preFeedRound,b=((A=t==null?void 0:t.affixes)==null?void 0:A.roundNumber)||p.affixes.roundNumber,S=((t==null?void 0:t.namingConventions)||p.namingConventions).round,w=s&&s!==Oe?s[0]:"",U=(t==null?void 0:t.stageConstants)||p.stageConstants,T=s&&(U==null?void 0:U[s])||w,D=`${g}${T}${f}`,P=n?Object.keys(n):[],E=m&&(U!=null&&U[Ye])?`${U==null?void 0:U[Ye]}-`:"";if(c||l||u)Object.assign(d,...P.map(M=>{let C=`${E}${S} ${M}`,O=`${b}${M}`;return{[M]:{roundName:C,abbreviatedRoundName:O}}}));else{let M=m&&((t==null?void 0:t.qualifyingFinishMap)||(p==null?void 0:p.qualifyingFinishMap)||{});Object.assign(d,...P.map(C=>{if(!(n!=null&&n[C]))return;let{matchUpsCount:O,preFeedRound:k}=n[C],x=O*2,F=(M==null?void 0:M[n==null?void 0:n[C].finishingRound])||M&&`${b}${x}`||v[O]||`${b}${x}`,$=k?`-${I}`:"",_=`${F}${$}`,L=[D,o,_].filter(Boolean).join("-"),B=`${y[O]||`${b}${x}`}${$}`,V=[D,o,B].filter(Boolean).join("-");return{[C]:{abbreviatedRoundName:V,roundName:L}}}))}return{roundNamingProfile:d,roundProfile:n,roundMatchUps:a}}var Joe=(t,e)=>(t||0)+(e||0);function NW(t,e){let i=Array.isArray(t)?t[0]:t;return isNaN(i)&&DW||i<=e[xI]&&xI||i<=e[kI]&&kI||kA}function AW({score:t}){let e=(t==null?void 0:t.sets)||[],i=e.reduce((n,a)=>(n[0]+=a.side1Score||0,n[1]+=a.side2Score||0,n),[0,0]),r=e.reduce((n,a)=>(n[0]+=a.side1TiebreakScore||0,n[1]+=a.side2TiebreakScore||0,n),[0,0]);return r.reduce(Joe)&&(i[r[0]>r[1]?0:1]+=1),{sets:e,games:i,score:t}}function Qoe(t){let e=Math.min(...t.games),i=Math.max(...t.games);return Math.round(e/i*100)}function OW(t){return t.map(Qoe).sort().map(e=>parseFloat(e.toFixed(2)))}function tb({tournamentRecord:t,profileBands:e,matchUp:i}){if(!i)return{error:na};let{score:r,winningSide:n}=i;if(!n)return{error:oe};let a=!e&&t&&hp({policyType:su,tournamentRecord:t}).policy,o=e||(a==null?void 0:a.profileBands)||xA[su].profileBands,s=AW({score:r}),l=OW([s]),u=NW(l,o),c=Array.isArray(l)?l[0]:l;return{...J,competitiveness:u,pctSpread:c}}function kW({matchUp:t}){var o,s,l;if(!t)return{error:na};if(t&&!t.sides)return{error:aa};if(t&&!t.hasContext)return{error:K0};let e=(o=t.sides??[])==null?void 0:o.map(u=>u==null?void 0:u.participantId).filter(Boolean),i=((s=t.sides)==null?void 0:s.filter(u=>{var c;return((c=u.participant)==null?void 0:c.participantType)===St}).map(u=>u.participantId).filter(Boolean))??[],r=(((l=t.sides??[])==null?void 0:l.map(u=>{var c;return(c=u.participant)==null?void 0:c.individualParticipants}).filter(Boolean))??[]).map(u=>(u??[]).map(c=>c==null?void 0:c.participantId).filter(Boolean)),n=[...i,...r.flat()].filter(Boolean)??[],a=ct(n.concat(e)).filter(Boolean)??[];return{nestedIndividualParticipantIds:r,allRelevantParticipantIds:a,individualParticipantIds:n,sideParticipantIds:e,...J}}var US="CHECK_IN",SS="CHECK_OUT",Zoe="SCHEDULE",eh="SCHEDULE.ASSIGNMENT.VENUE",zl="SCHEDULE.ALLOCATION.COURTS",Rc="SCHEDULE.ASSIGNMENT.COURT",AT="SCHEDULE.COURT.ORDER",th="SCHEDULE.DATE",ese="COMPLETED.DATE",$A="HOME_PARTICIPANT_ID",BA="SCHEDULE.ASSIGN.OFFICIAL",ih="SCHEDULE.TIME.SCHEDULED",fs="SCHEDULE.TIME.START",gu="SCHEDULE.TIME.STOP",El="SCHEDULE.TIME.RESUME",Eu="SCHEDULE.TIME.END",OT="SCHEDULE.TIME.MODIFIERS",xW="TO_BE_ANNOUNCED",FW="NEXT_AVAILABLE",LW="FOLLOWED_BY",_W="AFTER_REST",$W="RAIN_DELAY",tse="NOT_BEFORE",xC=[xW,FW,LW,_W,$W],ise="ELIGIBILITY",rse="REGISTRATION",nse="SUSPENSION",ase="MEDICAL",ose="PENALTY",BW="SCALE",VW="RATING",jW="RANKING",VA="SEEDING",Yc="PUBLISH",qa="PUBLIC",Kc="STATUS",sse="MODIFICATION",lse="RETRIEVAL",use="other",cse={MUTUALLY_EXCLUSIVE_TIME_MODIFIERS:xC,AFTER_REST:_W,ALLOCATE_COURTS:zl,ASSIGN_COURT:Rc,ASSIGN_OFFICIAL:BA,ASSIGN_VENUE:eh,CHECK_IN:US,CHECK_OUT:SS,COMPLETED_DATE:ese,COURT_ORDER:AT,ELIGIBILITY:ise,END_TIME:Eu,FOLLOWED_BY:LW,MEDICAL:ase,MODIFICATION:sse,NEXT_AVAILABLE:FW,NOT_BEFORE:tse,OTHER:use,PENALTY:ose,PUBLIC:qa,PUBLISH:Yc,RANKING:jW,RATING:VW,RAIN_DELAY:$W,REGISTRATION:rse,RESUME_TIME:El,RETRIEVAL:lse,SCALE:BW,SCHEDULE:Zoe,SCHEDULED_DATE:th,SCHEDULED_TIME:ih,SEEDING:VA,START_TIME:fs,STATUS:Kc,STOP_TIME:gu,SUSPENSION:nse,TIME_MODIFIERS:OT,TO_BE_ANNOUNCED:xW};function rh({matchUp:t}){if(!t)return{error:na};if(!t.hasContext)return{error:K0};if(!t.sides||t.sides.filter(Boolean).length!==2)return{error:aa};let{nestedIndividualParticipantIds:e,allRelevantParticipantIds:i,sideParticipantIds:r}=kW({matchUp:t}),n=(t.timeItems??[]).filter(s=>(s==null?void 0:s.itemType)&&[US,SS].includes(s.itemType)).sort((s,l)=>(s.createdAt?new Date(s.createdAt).getTime():0)-(l.createdAt?new Date(l.createdAt).getTime():0)),a=n.map(s=>s.itemValue).filter(s=>n.filter(l=>(l==null?void 0:l.itemValue)===s).reverse()[0].itemType===US);e==null||e.forEach((s,l)=>{let u=r==null?void 0:r[l],c=(s==null?void 0:s.length)&&s.every(d=>a.includes(d));u&&c&&!a.includes(u)&&a.push(u)}),r==null||r.forEach((s,l)=>{a.includes(s)&&((e==null?void 0:e[l])??[]).forEach(u=>{u&&!a.includes(u)&&a.push(u)})});let o=r==null?void 0:r.reduce((s,l)=>a.includes(l)&&s,!0);return{allRelevantParticipantIds:i,allParticipantsCheckedIn:o,checkedInParticipantIds:a,...J}}var Yi=t=>e=>{let i=Nt(e)&&(e==null?void 0:e.matchUpType)||Ti(e)&&e;return i&&pG[t].includes(i)};function Kv(t){var a;let{matchUpAverageTimes:e,matchUpFormat:i}=t||{},r=(e==null?void 0:e.map(({matchUpFormatCodes:o})=>o==null?void 0:o.filter(s=>s===i)).flat().filter(Boolean).sort((o,s)=>((o==null?void 0:o.length)||0)-((s==null?void 0:s.length)||0)))||[],n=r.includes(i)?i:r[0];return(a=e==null?void 0:e.find(({matchUpFormatCodes:o,averageTimes:s})=>(o==null?void 0:o.find(l=>n===l))&&s))==null?void 0:a.averageTimes}function Xv(t){var n;let{matchUpRecoveryTimes:e,averageMinutes:i,matchUpFormat:r}=t||{};return(n=e==null?void 0:e.find(({matchUpFormatCodes:a,averageTimes:o,recoveryTimes:s})=>{if(o&&i){let{greaterThan:l=0,lessThan:u=360}=o;if(i>l&&i<u)return!0}return(a==null?void 0:a.find(l=>l===r))&&s}))==null?void 0:n.recoveryTimes}function GW({timesBlockArray:t,categoryName:e,categoryType:i}){return t.filter(r=>Array.isArray(r)).map(r=>r.sort((n,a)=>{var o,s;return(((o=a.categoryNames)==null?void 0:o.length)||0)-(((s=n.categoryNames)==null?void 0:s.length)||0)}).find(({categoryTypes:n,categoryNames:a})=>!(a!=null&&a.length)&&!(n!=null&&n.length)||(a==null?void 0:a.includes(e))||(n==null?void 0:n.includes(i)))).find(Boolean)}function dse({tournamentScheduling:t,eventScheduling:e,averageMinutes:i,defaultTiming:r,matchUpFormat:n,categoryName:a,categoryType:o,policy:s}){var p;let l=(e==null?void 0:e.matchUpRecoveryTimes)&&Xv({...e,averageMinutes:i,matchUpFormat:n}),u=(t==null?void 0:t.matchUpRecoveryTimes)&&Xv({...t,averageMinutes:i,matchUpFormat:n}),c=(s==null?void 0:s.matchUpRecoveryTimes)&&Xv({...s,averageMinutes:i,matchUpFormat:n}),d=[l,u,c,(p=s==null?void 0:s.defaultTimes)==null?void 0:p.recoveryTimes,r==null?void 0:r.recoveryTimes];return GW({categoryName:a,categoryType:o,timesBlockArray:d})}function pse({matchUpFormat:t,categoryName:e,categoryType:i,defaultTiming:r,tournamentScheduling:n,eventScheduling:a,policy:o}){var d;let s=(a==null?void 0:a.matchUpAverageTimes)&&Kv({...a,matchUpFormat:t}),l=(n==null?void 0:n.matchUpAverageTimes)&&Kv({...n,matchUpFormat:t}),u=(o==null?void 0:o.matchUpAverageTimes)&&Kv({...o,matchUpFormat:t}),c=[s,l,u,(d=o==null?void 0:o.defaultTimes)==null?void 0:d.averageTimes,r==null?void 0:r.averageTimes];return GW({categoryName:e,categoryType:i,timesBlockArray:c})}var HW="DOUBLES_SINGLES",zW="SINGLES_DOUBLES",Go="total",FC="participantConflict",sc="matchUpConflict",WW="ISSUE_IDS",dd="CONFLICT",pd="WARNING",LC="ERROR",_C="ISSUE",AU="STATE",mse={SINGLES_DOUBLES:zW,DOUBLES_SINGLES:HW,TOTAL:Go,CONFLICT_MATCHUP_ORDER:sc,CONFLICT_PARTICIPANTS:FC,SCHEDULE_ISSUE_IDS:WW,SCHEDULE_CONFLICT:dd,SCHEDULE_WARNING:pd,SCHEDULE_ERROR:LC,SCHEDULE_ISSUE:_C,SCHEDULE_STATE:AU};function ib({defaultAverageMinutes:t=90,defaultRecoveryMinutes:e=0,tournamentRecord:i,matchUpFormat:r,categoryName:n,categoryType:a,eventType:o,event:s}){if(!i)return{error:ge};o=o??(s==null?void 0:s.eventType)??Im;let l={averageTimes:[{minutes:{default:t}}],recoveryTimes:[{minutes:{default:e}}]},{scheduleTiming:u}=qy({tournamentRecord:i,categoryName:n,categoryType:a,event:s}),c={...u,matchUpFormat:r,categoryType:a,defaultTiming:l};return kT({eventType:o,timingDetails:c})}function kT({timingDetails:t,eventType:e}){let i=pse(t),r=Object.keys((i==null?void 0:i.minutes)||{}),n=(i==null?void 0:i.minutes)&&((r==null?void 0:r.includes(e))&&i.minutes[e]||i.minutes.default),a=dse({...t,averageMinutes:n}),o=Object.keys((a==null?void 0:a.minutes)||{}),s=(a==null?void 0:a.minutes)&&((o==null?void 0:o.includes(e))&&a.minutes[e]||a.minutes.default),l=Yi(Im)(e)?zW:HW,u=(a==null?void 0:a.minutes)&&((o==null?void 0:o.includes(l))&&a.minutes[l]||s);return{averageMinutes:n,recoveryMinutes:s,typeChangeRecoveryMinutes:u}}function cE(t){return t.createdAt?new Date(t.createdAt).getTime():0}function vp({timeItems:t,itemType:e}){let i=t.filter(n=>n&&n.itemType===e).sort((n,a)=>cE(n)-cE(a)).pop(),r=i&&cE(i);return{itemValue:i==null?void 0:i.itemValue,timeStamp:r}}function qW({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:r,timeStamp:n}=vp({timeItems:(i==null?void 0:i.timeItems)||[],itemType:ih});return!e||n&&t&&new Date(n).getTime()>new Date(t).getTime()?{scheduledTime:r}:e}function nh({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:r,timeStamp:n}=vp({timeItems:(i==null?void 0:i.timeItems)||[],itemType:th});return!e||n&&t&&new Date(n).getTime()>new Date(t).getTime()?{scheduledDate:r}:e}function _p(t){if(WH.test(t)){let e=jN();return new Date(`${e}T${t}`)}else return new Date(t)}function hse({matchUp:t}){if(!t)return{error:na};if(!t.timeItems)return{error:NN};let e=t.timeItems.filter(r=>[fs,gu,El,Eu].includes(r==null?void 0:r.itemType)).sort((r,n)=>_p(r.itemValue).getTime()-_p(n.itemValue).getTime()),i=e.reduce((r,n)=>{var l,u;let a,o=(l=n==null?void 0:n.itemType)==null?void 0:l.split("."),s=`SCHEDULE.TIME.${((u=n==null?void 0:n.itemType)==null?void 0:u.startsWith("SCHEDULE.TIME"))&&o[2]}`;switch(s){case fs:a=0;break;case Eu:if(r.lastValue&&[fs,El].includes(r.lastType)){let c=_p(n.itemValue).getTime()-_p(r.lastValue).getTime();a=r.milliseconds+c}else a=r.milliseconds;break;case gu:if([fs,"SCHECULE.TIME.RESUME"].includes(r.lastType)){let c=_p(n.itemValue).getTime()-_p(r.lastValue).getTime();a=r.milliseconds+c}else a=r.milliseconds;break;default:a=r.milliseconds;break}return{milliseconds:a,lastType:s,lastValue:n.itemValue}},{milliseconds:0,lastType:void 0,lastValue:void 0});if([fs,El].includes(i.lastType)){let r=new Date().getTime()-_p(i.lastValue).getTime();i.milliseconds+=r}return{milliseconds:i.milliseconds,time:fse(i.milliseconds),relevantTimeItems:e}}function fse(t){let e=(i,r=2)=>("00"+i).slice(-r);return e(t/36e5|0)+":"+e(t%36e5/6e4|0)+":"+e(t%6e4/1e3|0)}function gse({matchUp:t}){var r;let e=(t==null?void 0:t.timeItems)||[],i=n=>n.createdAt?new Date(n.createdAt).getTime():0;return{startTime:(r=e.reduce((n,a)=>{let o=a.itemType===fs&&a;return o&&(!n||i(o)<i(n))?o:n},void 0))==null?void 0:r.itemValue}}function rb(t){let{disableNotice:e,venue:i,context:r}=t;if(typeof i!="object")return{error:oe};let n=Io(t);i.venueId||(i.venueId=Gt());let a;for(let o of Object.values(n)){let s=vse({disableNotice:!0,tournamentRecord:o,context:r,venue:i});if(s!=null&&s.error)return s;a=s.venue}return e||lt({topic:IA,payload:{venue:i}}),Ge({...J,venue:a})}function vse({tournamentRecord:t,disableNotice:e,context:i,venue:r}){return t?r?(t.venues||(t.venues=[]),r.venueId||(r.venueId=Gt()),t.venues.reduce((n,a)=>n||a.venueId===r.venueId,void 0)?{error:hH}:(i&&Lt({element:r,extension:{value:i,name:Jz}}),t.venues.push(r),e||lt({payload:{venue:r,tournamentId:t.tournamentId},topic:IA}),{...J,venue:Me(r)})):{error:Xe,info:"missing venue"}:{error:ge}}function eu({tournamentRecords:t,tournamentRecord:e,venueId:i}){if(!e)return{error:ge};if(!i)return{error:jc};let r=(e.venues??[]).reduce((n,a)=>a.venueId===i?a:n,void 0);if(!r&&t){let n=(Gy({tournamentRecords:t}).linkedTournamentIds??[])[e.tournamentId];for(let a of n){let o=t[a],s=eu({tournamentRecord:o,venueId:i});if(s.success&&s.venue)return rb({tournamentRecord:e,venue:s.venue}),{...J,venue:r}}}return r?{...J,venue:r}:{error:Wm}}function jA({convertExtensions:t,...e}){let{tournamentRecords:i,tournamentRecord:r,venueId:n}=e,a=eu({tournamentRecords:i,tournamentRecord:r,venueId:n});return Me(a,t,!0)}function ah({tournamentRecords:t,tournamentRecord:e,courtId:i}){if(!e)return{error:ge};if(!i)return{error:Gm};let r="findCourt",n,a;if((e.venues??[]).forEach(o=>{(o.courts??[]).forEach(s=>{s.courtId===i&&(n=s,a=o)})}),n)return{...J,court:n,venue:a};if(t){let o=(Gy({tournamentRecords:t}).linkedTournamentIds??[])[e.tournamentId];for(let s of o){let l=t[s],u=ah({tournamentRecord:l,courtId:i});if(u.success)return u.venue&&rb({tournamentRecord:e,venue:u.venue}),{...J,court:n,venue:a}}}return ee({result:{error:Cg},stack:r})}function GA(t){return Me(ah(t),!1,!0)}function xT({tournamentRecord:t,internalUse:e,courtId:i}){if(!t)return{error:ge};if(!i)return{error:Gm};let r=ah({tournamentRecord:t,courtId:i});if(r.error)return r;let n=r.court&&(({altitude:a,courtId:o,courtName:s,courtDimensions:l,latitude:u,longitude:c,surfaceCategory:d,surfaceType:p,surfacedDate:m,pace:h,notes:f})=>({altitude:a,courtId:o,courtName:s,courtDimensions:l,latitude:u,longitude:c,surfaceCategory:d,surfaceType:p,surfacedDate:m,pace:h,notes:f}))(r.court);return{...J,courtInfo:Me(n,!1,e)}}function $f(t){var l;let e=ze(t,[{[wr]:!0},{venueId:!0,[Vo]:jc}]);if(e.error)return e;let{tournamentRecord:i,venueId:r}=t,n=eu({tournamentRecord:i,venueId:r});if(n.error)return n;let a=(((l=n.venue)==null?void 0:l.courts)??[]).map(u=>(({courtInfo:c})=>({...c}))(xT({courtId:u.courtId,internalUse:!0,tournamentRecord:i}))),o=n.venue&&(({venueId:u,venueName:c,venueAbbreviation:d})=>({venueAbbreviation:d,venueName:c,venueId:u}))(n.venue),s=o&&{...o,courtsInfo:a};return{...J,venueData:Me(s,!1,!0)}}function Ise({matchUp:t}){var r;let e=(t==null?void 0:t.timeItems)||[],i=n=>n.createdAt?new Date(n.createdAt).getTime():0;return{endTime:(r=e.reduce((n,a)=>{let o=a.itemType===Eu&&a;return o&&(!n||i(o)>i(n))?o:n},void 0))==null?void 0:r.itemValue}}function Gi({event:t,eventId:e}){var n,a;if(!t)return{error:gi};let i=(n=gt({name:Qo,element:t}))==null?void 0:n.extension,r=e?Me(i==null?void 0:i.value,!1,!0):i==null?void 0:i.value;return e&&((a=t.drawDefinitions)==null||a.forEach(o=>{var s;(s=r==null?void 0:r.flights)==null||s.forEach(l=>{l.drawId===o.drawId&&Object.assign(l,{drawDefinition:o})})})),{flightProfile:r}}function Wn(t){let{tournamentRecord:e,eventId:i,drawId:r}=t,n="findEvent",a={},o=t.tournamentRecords??(e&&{[e.tournamentId]:e})??{},s=Object.values(o).map(({events:u,tournamentId:c})=>(u&&u.forEach(d=>{a[d.eventId]={tournamentId:c}}),u??[])).flat(),l;if(r){let u,c=s.find(d=>{var m,h,f;let p=((d==null?void 0:d.drawDefinitions)??[]).find(g=>g.drawId===r);if(p)u=p,l=a[d.eventId].tournamentId;else{let g=(f=(h=d&&((m=Gi({event:d}))==null?void 0:m.flightProfile))==null?void 0:h.flights)==null?void 0:f.find(v=>v.drawId===r);if(g)return l=a[d.eventId].tournamentId,{entries:g.drawEntries,drawName:g.drawName,tournamentId:l,drawId:r}}return p});if(c)return{event:c,drawDefinition:u,tournamentId:l}}if(i){let u=s.find(c=>(c==null?void 0:c.eventId)===i);if(u)l=a[u.eventId].tournamentId;else return{event:void 0,drawDefinition:void 0,...ee({result:{error:lo},stack:n})};return{event:u,drawDefinition:void 0,tournamentId:l}}return{event:void 0,drawDefinition:void 0,...ee({result:{error:xa},context:{drawId:r,eventId:i},stack:n})}}function FT(t){var S,w,U,T,D,P,E,R,N,A;let e=t.event,i=t.matchUpType,{scheduleVisibilityFilters:r,afterRecoveryTimes:n,tournamentRecord:a,usePublishState:o,scheduleTiming:s,matchUpFormat:l,publishStatus:u,matchUp:c}=t;if(!c)return{error:na};if(n&&!c.matchUpType&&!t.matchUpType&&(e||a)&&c.drawId){let M=t.drawDefinition||((S=e==null?void 0:e.drawDefinitions)==null?void 0:S.find(O=>O.drawId===c.drawId));!M&&a&&({drawDefinition:M,event:e}=Wn({drawId:c.drawId,tournamentRecord:a}));let C=c.structureId&&((w=M==null?void 0:M.structures)==null?void 0:w.find(({structureId:O})=>O===c.structureId));i=t.matchUpType||(C==null?void 0:C.matchUpType)||(M==null?void 0:M.matchUpType)||(e==null?void 0:e.eventType)!==sr&&(e==null?void 0:e.eventType)}let{milliseconds:d,time:p}=hse({matchUp:c}),{startTime:m}=gse({matchUp:c}),{endTime:h}=Ise({matchUp:c}),f,{eventIds:g,drawIds:v}=r??{};if((!g||g.includes(c.eventId))&&(!v||v.includes(c.drawId))){let M=ne=>ne.createdAt?new Date(ne.createdAt).getTime():0,C=new Map,O=((U=c.timeItems)==null?void 0:U.toSorted((ne,de)=>M(ne)-M(de)))??[];for(let ne of O)C.set(ne.itemType,ne.itemValue);let k=C.get($A),x=C.get(zl),F=C.get(ih),$=C.get(OT),_=C.get(th),L=C.get(BA),B=C.get(AT),V=C.get(eh),G=C.get(Rc),j,z,W,q,Y,re=c.matchUpType??i;if(s&&F&&n&&re){let ne={matchUpFormat:c.matchUpFormat??l,...s};({averageMinutes:z=0,recoveryMinutes:W=0,typeChangeRecoveryMinutes:q=0}=kT({timingDetails:ne,eventType:re})),(z||W)&&(j=h?ia(bi(h),W):ia(F,z+W)),q&&(Y=h?ia(bi(h),q):ia(F,z+q))}!_&&F&&(_=pt(F));let K=pS({scheduledDate:_,scheduledTime:F}),H={},Z=((T=a&&V&&$f({tournamentRecord:a,venueId:V}))==null?void 0:T.venueData)||{};V&&(H[V]=Z);let{venueName:X,venueAbbreviation:ie,courtsInfo:ae}=Z,le=(D=G&&(ae==null?void 0:ae.find(ne=>ne.courtId===G)))==null?void 0:D.courtName;for(let ne of x||[]){if(!a)break;ne.venueId&&!H[ne.venueid]&&(H[ne.venueId]=(P=$f({venueId:ne.venueId,tournamentRecord:a}))==null?void 0:P.venueData);let de=H[ne.venueId];ne.venueName=de==null?void 0:de.venueName;let ye=(E=de==null?void 0:de.courtsInfo)==null?void 0:E.find(ce=>ce.courtId===ne.courtId);ne.courtName=ye==null?void 0:ye.courtName}f=Ge({typeChangeTimeAfterRecovery:Y,timeAfterRecovery:j,scheduledDate:_,scheduledTime:F,isoDateString:K,homeParticipantId:k,venueAbbreviation:ie,allocatedCourts:x,timeModifiers:$,venueName:X,venueId:V,courtOrder:B,courtName:le,courtId:G,official:L,typeChangeRecoveryMinutes:q,recoveryMinutes:W,averageMinutes:z,milliseconds:d,startTime:m,endTime:h,time:p})}else f=Ge({milliseconds:d,startTime:m,endTime:h,time:p});let{scheduledDate:y}=nh({matchUp:c}),{scheduledTime:I}=qW({matchUp:c});if(o&&((R=u==null?void 0:u.displaySettings)!=null&&R.draws)){let M=u.displaySettings.draws,C=(N=(M==null?void 0:M[c.drawId])??(M==null?void 0:M.default))==null?void 0:N.scheduleDetails;if(C){let O=(A=C.find(k=>{var x;return y&&((x=k.dates)==null?void 0:x.includes(y))})??C.find(k=>{var x;return!((x=k.dates)!=null&&x.length)}))==null?void 0:A.attributes;if(O){let k=Object.assign({},...Object.keys(f).map(x=>({[x]:!0})),O);f=bm({source:f,template:k})}}}let b=c.matchUpStatus&&vr.includes(c.matchUpStatus)&&(pt(h)||pt(y)||pt(I))||void 0;return{schedule:f,endDate:b}}function yse({drawPositions:t,roundProfile:e,roundNumber:i}){var s;let r=[void 0,void 0];if(yG(t))return{orderedDrawPositions:r,displayOrder:r};let n=e==null?void 0:e[i],a=((s=n==null?void 0:n.pairedDrawPositions)==null?void 0:s.find(l=>Rn(l||[],t.filter(Boolean))))??r,o=n==null?void 0:n.feedRound;if(IG(t)){let l=[...t].sort(or);return{orderedDrawPositions:l.length===2?l:a,displayOrder:o?l:a}}if(o){let l=[t.find(u=>!isNaN(Qe(u))),void 0];return{orderedDrawPositions:l,displayOrder:l}}return{orderedDrawPositions:a,displayOrder:a}}function TS({collectionPosition:t,collectionId:e,lineUp:i}){let r=[],n=[];if(i){let a=s=>s===void 0?-1:s,o=i.map(s=>{let{collectionAssignments:l,participantId:u}=s,c=l==null?void 0:l.find(d=>d.collectionPosition===t&&d.collectionId===e);return c&&{participantId:u,...c}}).filter(Boolean).sort((s,l)=>a(s.substitutionOrder)-a(l.substitutionOrder));for(let s of o){let{participantId:l,previousParticipantId:u,substitutionOrder:c}=s;r.includes(l)||(u&&n.push({previousParticipantId:u,substitutionOrder:c,participantId:l}),r=r.filter(d=>d!==u),r.push(l))}}return{assignedParticipantIds:r,substitutions:n}}function es({tournamentParticipants:t,tournamentRecord:e,participantIds:i}){let r="getPairedParticipant";if(!t&&!e)return{error:ge};if(!Array.isArray(i)||i.length>2)return{error:va};if(!i.length)return ee({result:{error:Vc},stack:r});t=t??(e==null?void 0:e.participants)??[];let n=t.filter(s=>s.participantType===ht&&Vi(i,s.individualParticipantIds).length===i.length&&s.individualParticipantIds.length===i.length),a=n[0];if(!a)return ee({result:{error:zi},stack:r});let o=Me(n.slice(1),!1,!0);return{participant:Me(a),duplicatedPairParticipants:o,...J}}function _d({drawDefinition:t,participantId:e}){if(typeof t!="object")return{error:_e};if(typeof e!="string")return{error:pr};let{extension:i}=gt({element:t,name:Tu});return{lineUp:((i==null?void 0:i.value)||{})[e]}}function bse({tournamentParticipants:t,positionAssignments:e,collectionPosition:i,drawPositions:r=[],participantMap:n,drawDefinition:a,collectionId:o,sideLineUps:s,matchUpType:l}){if(!o||!i)return{};let u=({attribute:d,lineUp:p,teamParticipant:m})=>{var g,v,y,I;let{assignedParticipantIds:h,substitutions:f}=TS({collectionPosition:i,collectionId:o,lineUp:p});if(l===Zt){if((h==null?void 0:h.length)<=2){let b=(v=(g=n==null?void 0:n[h[0]])==null?void 0:g.pairIdMap)==null?void 0:v[h[1]],S=(I=b&&((y=n[b])==null?void 0:y.participant)||es({participantIds:h,tournamentParticipants:t}).participant)==null?void 0:I.participantId;return{[d]:{participantId:S,teamParticipant:m,substitutions:f}}}else if((h==null?void 0:h.length)>2)return{[d]:{teamParticipant:m,substitutions:f}}}else{let b=h==null?void 0:h[0];return b&&{[d]:{participantId:b,teamParticipant:m,substitutions:f}}}};if(!(r!=null&&r.length)){let d=(s==null?void 0:s.map(p=>{var g;let{teamParticipant:m,sideNumber:h}=p,f=p.lineUp||((g=_d({participantId:m.teamParticipantId,drawDefinition:a}))==null?void 0:g.lineUp);return u({attribute:h,lineUp:f,teamParticipant:m})}).filter(Boolean))||{};return{sideNumberCollectionAssignment:Object.assign({},...d)}}let c=(r==null?void 0:r.map(d=>{var g,v,y;let p=(g=e.find(I=>I.drawPosition===d))==null?void 0:g.participantId,m=s==null?void 0:s.find(I=>(I==null?void 0:I.drawPosition)===d),h=(m==null?void 0:m.teamParticipant)||p&&((v=n==null?void 0:n[p])==null?void 0:v.participant)||(t==null?void 0:t.find(({participantId:I})=>I===p)),f=(m==null?void 0:m.lineUp)||((y=_d({participantId:p,drawDefinition:a}))==null?void 0:y.lineUp);return u({attribute:d,lineUp:f,teamParticipant:h})}).filter(Boolean))||{};return{drawPositionCollectionAssignment:Object.assign({},...c)}}function LT(t){var n,a,o;let e=ze(t,[{[Zl]:!0}]);if(e.error)return e;let i=t==null?void 0:t.matchUp,r=i==null?void 0:i.matchUpType;if(!r&&((n=i==null?void 0:i.sides)!=null&&n.length)){let s=(o=(a=i.sides.find(({participant:l})=>l))==null?void 0:a.participant)==null?void 0:o.participantType;r=s===St&&ti||s===ht&&Zt||s===Kt&&Kt||void 0}return{matchUpType:r}}function wse({drawPositionCollectionAssignment:t,sideNumberCollectionAssignment:e,positionAssignments:i,displaySideNumber:r,seedAssignments:n,drawPosition:a,isFeedRound:o,sideNumber:s}){var m,h,f,g;let l=i.find(v=>v.drawPosition&&v.drawPosition===a),u=a&&t,c=s&&e,d=u?(m=u[a])==null?void 0:m.participantId:l==null?void 0:l.participantId,p=l?Use({displaySideNumber:r,seedAssignments:n,participantId:d,assignment:l,sideNumber:s}):{...c==null?void 0:c[s]};if(o&&(s===1?Object.assign(p,{participantFed:!0}):Object.assign(p,{participantAdvanced:!0})),a&&u){let v=(h=u[a])==null?void 0:h.teamParticipant,y=(f=u[a])==null?void 0:f.participant,I=(g=u[a])==null?void 0:g.substitutions;y&&(p.participant=y),I&&(p.substitutions=I),v&&(p.teamParticipant=v)}return p}function Use({displaySideNumber:t,seedAssignments:e,participantId:i,assignment:r,sideNumber:n}){let a={drawPosition:r.drawPosition,displaySideNumber:t,sideNumber:n};if(i){let o=Sse({seedAssignments:e,participantId:i});Object.assign(a,o,{participantId:i}),o!=null&&o.seedNumber&&(o==null?void 0:o.seedValue)===""&&(a.seedValue="~")}else r.bye&&Object.assign(a,{bye:!0});return r.qualifier&&Object.assign(a,{qualifier:!0}),a}function Sse({seedAssignments:t,participantId:e}){return t==null?void 0:t.find(i=>!i.seedProxy&&i.participantId===e)}function YW({scheduleVisibilityFilters:t,sourceDrawPositionRanges:e,tournamentParticipants:i,positionAssignments:r,drawPositionsRanges:n,hydrateParticipants:a,afterRecoveryTimes:o,initialRoundOfPlay:s,additionalContext:l,roundNamingProfile:u,tournamentRecord:c,tieDrawPositions:d,appliedPolicies:p,isCollectionBye:m,seedAssignments:h,usePublishState:f,participantMap:g,contextContent:v,scheduleTiming:y,contextProfile:I,drawDefinition:b,publishStatus:S,scoringActive:w,matchUpTieId:U,isRoundRobin:T,roundProfile:D,sideLineUps:P,structure:E,context:R,matchUp:N,event:A}){var je,ue,he,Re,xe,Ee,we,Ue,wt,Le,rt,Ei,Be,nt,Ii;l=l??{};let M=(je=vn({drawDefinition:b,structure:E,matchUp:N,event:A}))==null?void 0:je.tieFormat,{roundOffset:C,structureId:O,structureName:k,stage:x,stageSequence:F}=E,{drawId:$,drawName:_,drawType:L}=b??{},B=M==null?void 0:M.collectionDefinitions,V=N.collectionId&&(B==null?void 0:B.find(be=>be.collectionId===N.collectionId)),G=N.collectionId?V==null?void 0:V.matchUpFormat:N.matchUpFormat??(E==null?void 0:E.matchUpFormat)??(b==null?void 0:b.matchUpFormat)??(A==null?void 0:A.matchUpFormat),j=N.matchUpType||(V==null?void 0:V.matchUpType)||(E==null?void 0:E.matchUpType)||(b==null?void 0:b.matchUpType)||!Yi(sr)(A==null?void 0:A.eventType)&&(A==null?void 0:A.eventType),z=m?Vt:N.matchUpStatus,{schedule:W,endDate:q}=FT({scheduleVisibilityFilters:t,afterRecoveryTimes:o,tournamentRecord:c,usePublishState:f,scheduleTiming:y,drawDefinition:b,matchUpFormat:G,publishStatus:S,matchUpType:j,matchUp:N,event:A}),Y=d??N.drawPositions??[],{collectionPosition:re,collectionId:K,roundPosition:H}=N,Z=N.roundNumber??l.roundNumber,X=K?bse({tournamentParticipants:i,positionAssignments:r,collectionPosition:re,participantMap:g,drawDefinition:b,drawPositions:Y,collectionId:K,sideLineUps:P,matchUpType:j}):void 0,ie=((ue=u==null?void 0:u[Z])==null?void 0:ue.roundName)||l.roundName,ae=((he=u==null?void 0:u[Z])==null?void 0:he.abbreviatedRoundName)||l.abbreviatedRoundName,le=(Re=D==null?void 0:D[Z])==null?void 0:Re.feedRound,ne=(xe=D==null?void 0:D[Z])==null?void 0:xe.preFeedRound,de=(Ee=D==null?void 0:D[Z])==null?void 0:Ee.roundFactor,ye=n==null?void 0:n[Z],ce=H?ye==null?void 0:ye[H]:void 0,ke=e==null?void 0:e[Z],Pe=V!=null&&V.category?{...(R==null?void 0:R.category)||{},...V.category}:(R==null?void 0:R.category)??(A==null?void 0:A.category),it=((we=N.processCodes)==null?void 0:we.length)&&N.processCodes||((Ue=V==null?void 0:V.processCodes)==null?void 0:Ue.length)&&(V==null?void 0:V.processCodes)||((wt=E==null?void 0:E.processCodes)==null?void 0:wt.length)&&(E==null?void 0:E.processCodes)||((Le=b==null?void 0:b.processCodes)==null?void 0:Le.length)&&(b==null?void 0:b.processCodes)||((rt=A==null?void 0:A.processCodes)==null?void 0:rt.length)&&(A==null?void 0:A.processCodes)||(c==null?void 0:c.processCodes),It=(I==null?void 0:I.withCompetitiveness)&&tb({...v,matchUp:N}),me=N.finishingPositionRange??l.finishingPositionRange,fe=be=>Ge(be,void 0,!0),pe={...fe(R),...fe({matchUpFormat:N.matchUpType===sr?void 0:G,tieFormat:N.matchUpType!==sr?void 0:M,gender:(V==null?void 0:V.gender)??(A==null?void 0:A.gender),roundOfPlay:x!==Ye&&ot(s)&&s+(Z||0),endDate:N.endDate??q,discipline:A==null?void 0:A.discipline,category:Pe,finishingPositionRange:me,abbreviatedRoundName:ae,drawPositionsRange:ce,competitiveProfile:It,structureName:k,stageSequence:F,drawPositions:Y,matchUpStatus:z,processCodes:it,isRoundRobin:T,matchUpTieId:U,preFeedRound:ne,matchUpType:j,roundFactor:de,roundOffset:C,structureId:O,roundNumber:Z,feedRound:le,roundName:ie,drawName:_,drawType:L,schedule:W,drawId:$,stage:x}),...Me(fe(N),!0,!0)};if(G&&((Ei=N.score)!=null&&Ei.scoreStringSide1)){let be=kn(G),{bestOf:Ct,finalSetFormat:Ce,setFormat:qe}=be??{};(Ce!=null&&Ce.tiebreakSet||qe!=null&&qe.tiebreakSet||qe!=null&&qe.timed)&&(pe.score.sets=pe.score.sets.sort((Ot,di)=>Ot.setNumber-di.setNumber).map((Ot,di)=>(di+1===Ct?(Ce!=null&&Ce.tiebreakSet||Ce!=null&&Ce.timed)&&(Ot.tiebreakSet=!0):(qe!=null&&qe.tiebreakSet||qe!=null&&qe.timed)&&(Ot.tiebreakSet=!0),Ot)))}if(Array.isArray(Y)){let{orderedDrawPositions:be,displayOrder:Ct}=yse({drawPositions:Y,roundProfile:D,roundNumber:Z}),Ce=(Be=D==null?void 0:D[Z])==null?void 0:Be.feedRound,qe=Ct[0]!==be[0],Ot=be.concat(void 0,void 0).slice(0,2).map((di,yi)=>{var lU;let Fi=yi+1,Ci=qe?3-Fi:Fi,gn=wse({...X,positionAssignments:r,displaySideNumber:Ci,seedAssignments:h,drawPosition:di,isFeedRound:Ce,sideNumber:Fi}),gr=(lU=N.sides)==null?void 0:lU.find(uE=>uE.sideNumber===Fi),Co=H?(H-1)*2+yi+1:void 0,ud=Co?ke==null?void 0:ke[Co]:void 0;return fe({sourceDrawPositionRange:ud,...gr,...gn})});Object.assign(pe,Me({sides:Ot},!0,!0))}if(i&&pe.sides){let be=p==null?void 0:p[By],Ct=Ce=>{var Ot;let qe=(Ot=g==null?void 0:g[Ce])==null?void 0:Ot.participant;return qe&&bm({template:be==null?void 0:be.participant,source:qe})};if(pe.sides.filter(Boolean).forEach(Ce=>{var qe,Ot,di,yi;if(Ce.participantId){let Fi=Me(Ct(Ce.participantId)||(i?Uc({policyDefinitions:p,participantId:Ce.participantId,tournamentParticipants:i,internalUse:!0,contextProfile:I}):void 0),void 0,!0);if(Fi){let Ci,gn;if(b!=null&&b.entries){let gr=b.entries.find(ud=>ud.participantId===Ce.participantId),Co=(qe=A==null?void 0:A.entries)==null?void 0:qe.find(ud=>ud.participantId===Ce.participantId);Ci=(gr==null?void 0:gr.entryStatus)||(Co==null?void 0:Co.entryStatus),Fi.entryStatus=Ci,gr!=null&&gr.entryStage&&(gn=gr.entryStage,Fi.entryStage=gn)}a!==!1?Object.assign(Ce,{participant:Fi}):Object.assign(Ce,{participant:{entryStage:gn,entryStatus:Ci}})}}if((di=(Ot=Ce==null?void 0:Ce.participant)==null?void 0:Ot.individualParticipantIds)!=null&&di.length&&!((yi=Ce.participant.individualParticipants)!=null&&yi.length)){let Fi=Ce.participant.individualParticipantIds.map(Ci=>Ct(Ci)||(i?Uc({policyDefinitions:p,tournamentParticipants:i,internalUse:!0,contextProfile:I,participantId:Ci}):void 0));a!==!1&&Object.assign(Ce.participant,{individualParticipants:Fi})}}),!pe.matchUpType){let{matchUpType:Ce}=LT({matchUp:pe});Ce&&Object.assign(pe,{matchUpType:Ce})}if(I!=null&&I.inferGender&&(!pe.gender||pe.gender===Bn)&&((nt=pe.sides)==null?void 0:nt.length)===2&&pe.matchUpType!==sr){let Ce=pe.sides.map(qe=>{var Ot,di,yi,Fi;if(Yi(ti)(pe.matchUpType))return(di=(Ot=qe.participant)==null?void 0:Ot.person)==null?void 0:di.sex;if(((Fi=(yi=qe.participant)==null?void 0:yi.individualParticipants)==null?void 0:Fi.length)===2){let Ci=ct(qe.participant.individualParticipants.map(gn=>{var gr;return(gr=gn.person)==null?void 0:gr.sex})).filter(Boolean);if(Ci.length===1)return Ci[0]}});if(Ce.filter(Boolean).length===2&&ct(Ce).length===1){let qe=Ce[0];pe.inferredGender=qe}}}if(pe.tieMatchUps){let be=pe.matchUpStatus===Vt,Ct=(Ii=pe.sides)==null?void 0:Ii.map(({participant:Ce,drawPosition:qe,sideNumber:Ot,lineUp:di})=>{let yi=(Ce==null?void 0:Ce.participantType)===sr&&Ce;return{teamParticipant:yi&&Ge({participantRoleResponsibilities:yi.participantRoleResponsibilities,participantOtherName:yi.participanOthertName,participantName:yi.participantName,participantId:yi.participantId,teamId:yi.teamId}),drawPosition:qe,sideNumber:Ot,lineUp:di}});pe.tieMatchUps=pe.tieMatchUps.map(Ce=>{let qe=pe.matchUpId,Ot={finishingPositionRange:pe.finishingPositionRange,abbreviatedRoundName:ae,roundNumber:Z,roundName:ie};return YW({tieDrawPositions:Y,scheduleVisibilityFilters:t,sourceDrawPositionRanges:e,sideLineUps:Ct,drawPositionsRanges:n,initialRoundOfPlay:s,roundNamingProfile:u,additionalContext:Ot,appliedPolicies:p,isCollectionBye:be,usePublishState:f,publishStatus:S,matchUpTieId:qe,isRoundRobin:T,roundProfile:D,matchUp:Ce,event:A,tournamentParticipants:i,positionAssignments:r,tournamentRecord:c,seedAssignments:h,participantMap:g,contextContent:v,scheduleTiming:y,contextProfile:I,drawDefinition:b,scoringActive:w,structure:E,context:R})})}let Fe=pe.sides&&pe.sides.filter(be=>be==null?void 0:be.participantId).length===2,De=!pe.winningSide;if(Object.assign(pe,{readyToScore:w&&Fe&&De,hasContext:!0}),Fe){let{allParticipantsCheckedIn:be,checkedInParticipantIds:Ct}=rh({matchUp:pe});Object.assign(pe,{allParticipantsCheckedIn:be,checkedInParticipantIds:Ct})}return Array.isArray(I==null?void 0:I.exclude)&&(I==null||I.exclude.forEach(be=>delete pe[be])),pe}function Tse({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:r,timeStamp:n}=vp({timeItems:(i==null?void 0:i.timeItems)||[],itemType:zl});return!e||n&&t&&new Date(n).getTime()>new Date(t).getTime()?{allocatedCourts:Me(r,!1,!0)}:e}function Dse({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:r,timeStamp:n}=vp({timeItems:(i==null?void 0:i.timeItems)||[],itemType:Rc});return!e||n&&t&&new Date(n).getTime()>new Date(t).getTime()?{courtId:r}:e}function Pse({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:r,timeStamp:n}=vp({timeItems:(i==null?void 0:i.timeItems)||[],itemType:eh});return!e||n&&t&&new Date(n).getTime()>new Date(t).getTime()?{venueId:r}:e}function lu(t){if(!Array.isArray(t.matchUps))return[];let{matchUps:e,excludeMatchUpStatuses:i,hasParticipantsCount:r,isCollectionMatchUp:n,matchUpStatuses:a,hasWinningSide:o,matchUpFormats:s,roundPositions:l,matchUpFormat:u,collectionIds:c,isMatchUpTie:d,roundNumbers:p,matchUpIds:m,roundNames:h,filterMatchUpTypes:f=!0,filterMatchUpIds:g=!0,stageSequences:v,scheduledDates:y,scheduledDate:I,participantIds:b,processContext:S,tournamentIds:w,matchUpTypes:U,structureIds:T,readyToScore:D,courtIds:P,eventIds:E,venueIds:R,drawIds:N,stages:A}=t,M=Array.isArray(b)?b.filter(Boolean):[],C=Array.isArray(a)?a.filter(Boolean):[],O=Array.isArray(i)?i.filter(Boolean):[],k=Array.isArray(A)?A.filter(Boolean):[],x=Array.isArray(v)?v.filter(Boolean):[],F=Array.isArray(c)?c.filter(Boolean):[],$=Array.isArray(h)?h.filter(Boolean):[],_=Array.isArray(p)?p.filter(Boolean):[],L=Array.isArray(l)?l.filter(Boolean):[],B=Array.isArray(m)&&g?m.filter(Boolean):[],V=Array.isArray(U)&&f?U.filter(Boolean):[],G=Array.isArray(P)?P.filter(Boolean):[],j=Array.isArray(R)?R.filter(Boolean):[],z=Array.isArray(s)&&s.filter(Boolean)||typeof u=="string"&&[u]||[],W=Array.isArray(y)&&y.filter(Boolean)||typeof I=="string"&&I.length&&[I]||[],q=Array.isArray(w)?w.filter(Boolean):[],Y=Array.isArray(E)?E.filter(Boolean):[],re=Array.isArray(N)?N.filter(Boolean):[],K=Array.isArray(T)?T.filter(Boolean):[];return e.filter(H=>{var Z;if(D&&!Yi(ka)(H)&&!H.readyToScore||H.winningSide&&o&&![1,2].includes(H.winningSide)||d!==void 0&&(d&&!H.tieMatchUps||!d&&H.tieMatchUps)||n!==void 0&&(n&&!H.collectionId||!n&&H.collectionId)||k.length&&!k.includes(H.stage)||x.length&&!x.includes(H.stageSequence)||F.length&&(!H.collectionId||!F.includes(H.collectionId))||$.length&&(!H.roundName||!$.includes(H.roundName))||_.length&&(!H.roundNumber||!_.includes(H.roundNumber))||L.length&&(!H.roundPosition||!L.includes(H.roundPosition))||C.length&&(!H.matchUpStatus||!C.includes(H.matchUpStatus))||O.length&&H.matchUpStatus&&O.includes(H.matchUpStatus)||B.length&&!B.includes(H.matchUpId)||V.length&&(!H.matchUpType||!B0(V,H.matchUpType))||z.length&&(!H.matchUpFormat||!z.includes(H.matchUpFormat)))return!1;if(W!=null&&W.length){let{scheduledTime:X}=qW({matchUp:H}),{scheduledDate:ie}=nh({matchUp:H}),ae=pt(X)||ie;if(!W.find(le=>Vl(le,ae)))return!1}if(G.length){let{courtId:X}=Dse({matchUp:H}),{allocatedCourts:ie}=Tse({matchUp:H}),ae=ie==null?void 0:ie.map(({courtId:le})=>le);if(!G.filter(Boolean).includes(X)||ae!=null&&ae.includes(X))return!1}if(j.length){let{venueId:X}=Pse({matchUp:H});if(!j.filter(Boolean).includes(X))return!1}if(S){if(q.length&&!q.includes(H.tournamentId)||Y.length&&!Y.includes(H.eventId)||re.length&&!re.includes(H.drawId)||K.length&&!K.includes(H.structureId))return!1;let X=((Z=H.sides)==null?void 0:Z.map(({participantId:ie})=>ie).filter(Boolean))??[];if(r&&X.length<r||M.length&&!M.some(ie=>X.includes(ie)))return!1}return!0})}function Wt(t){var G,j,z,W,q,Y,re;let{provisionalPositioning:e,tournamentRecord:i,contextFilters:r,matchUpFilters:n,contextProfile:a,drawDefinition:o,context:s={},structure:l,inContext:u,event:c}=t,{seedAssignments:d,contextContent:p,exitProfiles:m,matchUpsMap:h}=t,f={},g={};if(!l)return{collectionPositionMatchUps:f,error:lp,roundMatchUps:g,matchUps:[]};let v=Array.isArray(n==null?void 0:n.eventIds)?n==null?void 0:n.eventIds.filter(Boolean):[],y=Array.isArray(n==null?void 0:n.structureIds)?n==null?void 0:n.structureIds.filter(Boolean):[],I=Array.isArray(n==null?void 0:n.drawIds)?n==null?void 0:n.drawIds.filter(Boolean):[],b=!(s!=null&&s.eventId)||!(v!=null&&v.length)&&!((G=r==null?void 0:r.eventIds)!=null&&G.filter(Boolean).length)||(v==null?void 0:v.includes(s.eventId))||((j=r==null?void 0:r.eventIds)==null?void 0:j.includes(s.eventId)),S=!(y!=null&&y.length)||y.includes(l.structureId),w=!o||!(I!=null&&I.length)||I.includes(o.drawId);if(!b||!S||!w)return{collectionPositionMatchUps:f,roundMatchUps:g,matchUps:[]};a&&!p&&(p=qu({tournamentRecord:i,contextProfile:a,drawDefinition:o}));let{appliedPolicies:U}=$t({drawDefinition:o}),T={...t.tournamentAppliedPolicies,...U,...t.policyDefinitions},D=(z=T==null?void 0:T.scoring)==null?void 0:z.structures,P=l.stage&&((W=D==null?void 0:D.stage)==null?void 0:W[l.stage]),E=l.stageSequence&&((q=P==null?void 0:P.stageSequence)==null?void 0:q[l.stageSequence]),R=((Y=T==null?void 0:T.scoring)==null?void 0:Y.requireAllPositionsAssigned)||(P==null?void 0:P.requireAllPositionsAssigned)||(E==null?void 0:E.requireAllPositionsAssigned);h||(h=sn({drawDefinition:o,structure:l}));let{positionAssignments:N,allPositionsAssigned:A}=Er({structure:l}),M=!R||A,{seedAssignments:C}=po({provisionalPositioning:e,drawDefinition:o,structure:l});d=d??C;let{structureId:O}=l;m=m||o&&CW({drawDefinition:o}).exitProfiles;let k=m==null?void 0:m[O],x=(k==null?void 0:k.length)&&(k[0].split("-").map(K=>parseInt(K)).reduce((K,H)=>K+H)||0),F=!!l.structures,$=Ld({matchUpsMap:h,structureId:O,inContext:u}),_=T==null?void 0:T[xf],L=Xoe({roundNamingPolicy:_,drawDefinition:o,structure:l,matchUps:$}),{roundNamingProfile:B,roundProfile:V}=L;if(g=(L==null?void 0:L.roundMatchUps)??[],n&&($=lu({matchUps:$,...n,filterMatchUpTypes:!1,filterMatchUpIds:!1})),u){let{sourceDrawPositionRanges:K}=qoe({drawDefinition:o,matchUpsMap:h,structureId:O}),H=o?Yoe({drawDefinition:o,roundProfile:V,matchUpsMap:h,structureId:O}).drawPositionsRanges:void 0,Z=t.tournamentParticipants,X=t.participantMap;!(Z!=null&&Z.length)&&!X&&i&&({participants:Z=[],participantMap:X}=mp({participantsProfile:t.participantsProfile,useParticipantMap:t.useParticipantMap,policyDefinitions:t.policyDefinitions,tournamentRecord:i,contextProfile:a,inContext:u})),$=$.map(ie=>YW({scheduleVisibilityFilters:t.scheduleVisibilityFilters,hydrateParticipants:t.hydrateParticipants,afterRecoveryTimes:t.afterRecoveryTimes,usePublishState:t.usePublishState,scheduleTiming:t.scheduleTiming,publishStatus:t.publishStatus,sourceDrawPositionRanges:K,tournamentParticipants:Z,positionAssignments:N,drawPositionsRanges:H,initialRoundOfPlay:x,roundNamingProfile:B,tournamentRecord:i,appliedPolicies:T,seedAssignments:d,contextContent:p,participantMap:X,contextProfile:a,drawDefinition:o,scoringActive:M,isRoundRobin:F,roundProfile:V,structure:l,context:s,matchUp:ie,event:c})),($==null?void 0:$.filter(ie=>Array.isArray(ie.tieMatchUps))).forEach(ie=>{let ae=ie.tieMatchUps;$=$.concat(...ae)}),r&&($=lu({processContext:!0,...r,matchUps:$}))}else($==null?void 0:$.filter(K=>Array.isArray(K.tieMatchUps))).forEach(K=>{let H=K.tieMatchUps;$=$.concat(...H)});return n&&($=lu({matchUps:$,...n,filterMatchUpTypes:!1,filterMatchUpIds:!1})),(n!=null&&n.matchUpTypes||n!=null&&n.matchUpIds)&&($=lu({matchUpTypes:n.matchUpTypes,matchUpIds:n.matchUpIds,matchUps:$})),(n!=null&&n.matchUpTypes||n!=null&&n.matchUpIds||u)&&(g=En({matchUps:$}).roundMatchUps??[]),(re=vn({drawDefinition:o,structure:l,event:c}))!=null&&re.tieFormat&&({collectionPositionMatchUps:f}=Woe({matchUps:$})),{collectionPositionMatchUps:f,roundMatchUps:g,isRoundRobin:F,roundProfile:V,matchUpsMap:h,matchUps:$}}function Rd({matchUp:t}){return t?vr.includes(t==null?void 0:t.matchUpStatus)||(t==null?void 0:t.winningSide):!1}function _T({requireParticipants:t=!0,scheduleVisibilityFilters:e,tournamentAppliedPolicies:i,tournamentParticipants:r,hydrateParticipants:n,afterRecoveryTimes:a,policyDefinitions:o,tournamentRecord:s,usePublishState:l,matchUpFilters:u,contextFilters:c,contextContent:d,participantMap:p,scheduleTiming:m,publishStatus:h,contextProfile:f,drawDefinition:g,exitProfiles:v,matchUpsMap:y,structureId:I,inContext:b,structure:S,context:w,event:U}){!S&&I&&({structure:S}=et({drawDefinition:g,structureId:I}));let T=Wt({tournamentAppliedPolicies:i,scheduleVisibilityFilters:e,tournamentParticipants:r,hydrateParticipants:n,afterRecoveryTimes:a,policyDefinitions:o,tournamentRecord:s,usePublishState:l,matchUpFilters:u,contextFilters:c,contextContent:d,participantMap:p,scheduleTiming:m,publishStatus:h,contextProfile:f,drawDefinition:g,exitProfiles:v,matchUpsMap:y,structure:S,inContext:b,context:w,event:U}),D=[],P=[],E=[],R=[],N=[];if(T.error)return T;let{matchUps:A}=T,{assignedPositions:M}=Er({structure:S}),C=M==null?void 0:M.filter(k=>k.participantId).map(k=>k.drawPosition),O;return A.filter(k=>{var F;let x=((F=u==null?void 0:u.matchUpTypes)==null?void 0:F.length)===1&&u.matchUpTypes[0]===hi;return!(k.matchUpType!==hi&&x)}).forEach(k=>{var G,j,z,W;if(k.matchUpStatus===$a){D.push(k);return}k.matchUpType===hi&&(O=!0);let x=k.collectionId,F=x&&((G=k.sides)==null?void 0:G.every(q=>q.participantId)),$=!x&&((j=k.drawPositions)==null?void 0:j.filter(Boolean).length)===2,_=!x&&((z=k.drawPositions)==null?void 0:z.every(q=>C==null?void 0:C.includes(q))),L=M==null?void 0:M.filter(q=>q.bye).map(q=>q.drawPosition),B=!x&&((W=k.drawPositions)==null?void 0:W.find(q=>L==null?void 0:L.includes(q))),V=uW.includes(k.matchUpStatus)&&(F||$&&(!t||_));return B?N.push(k):Rd({matchUp:k})?P.push(k):V?E.push(k):R.push(k)}),{includesTeamMatchUps:O,abandonedMatchUps:D,completedMatchUps:P,upcomingMatchUps:E,pendingMatchUps:R,byeMatchUps:N,structure:S}}function Rse({drawDefinition:t,roundNumber:e,structureId:i}){if(!t)return{error:_e};if(!i)return{error:za};let{links:r}=_g({drawDefinition:t,structureId:i}),n=r.source.reduce((o,s)=>!s.source.roundNumber||s.source.roundNumber===e?o.concat(s):o,[]),a=r.target.reduce((o,s)=>!s.target.roundNumber||s.target.roundNumber===e?o.concat(s):o,[]);return{links:{source:n,target:a}}}function dE({finishingPositions:t,linkCondition:e,linkType:i,source:r}){var a;let n=r.find(o=>{var l,u;let s=!((l=o.source)!=null&&l.finishingPositions)||!t||Rn(t,(u=o.source)==null?void 0:u.finishingPositions);return e===o.linkCondition&&s&&o.linkType===i});return[Su,jl].includes(n==null?void 0:n.linkType)&&!((a=n==null?void 0:n.source)!=null&&a.roundNumber)?ee({result:{error:oe},stack:"getTargetLink",context:n}):n}function _g({drawDefinition:t,structureId:e,roundNumber:i}){return t?e?{links:(t.links||[]).filter(Boolean).reduce((r,n)=>{var a,o;return((a=n.source)==null?void 0:a.structureId)===e&&(!i||n.source.roundNumber===i)&&(r.source=r.source.concat(n)),((o=n.target)==null?void 0:o.structureId)===e&&(!i||n.target.roundNumber===i)&&(r.target=r.target.concat(n)),r},{source:[],target:[]})}:{error:za}:{error:_e}}function Ese({structureMatchUps:t,matchUp:e}){let{roundNumber:i,roundPosition:r}=e,n=t.filter(o=>o.roundNumber===i&&!o.matchUpTieId),a=t.filter(o=>o.roundNumber===i+1&&!o.matchUpTieId);if(a.length){let o;return a.length===n.length?o=a.find(s=>s.roundPosition===r):a.length===n.length/2&&(o=a.find(s=>s.roundPosition===Math.ceil(r/2))),{matchUp:o}}return{message:"no progression found"}}function pE({sourceRoundMatchUpCount:t,inContextDrawMatchUps:e,sourceRoundPosition:i,drawDefinition:r,targetLink:n}){var D;if(!n)return{error:fN};let{target:{structureId:a,feedProfile:o,groupedOrder:s,roundNumber:l,positionInterleave:u}}=n,{structure:c}=et({drawDefinition:r,structureId:a}),{positionAssignments:d}=oi({structure:c}),p=(e==null?void 0:e.filter(P=>P.structureId===(c==null?void 0:c.structureId))).filter(P=>P.roundNumber===l&&!P.matchUpTieId),m=p.length,h=Se(1,m+1),f=m/t,g=Math.ceil(f*i),v=1-i%2;if(u!=null&&u.interleave&&f!==.5){let P=u.offset+(i-1)*u.interleave,E=i+P;g=Math.ceil(E/2),v=1-E%2}let y=h,I=h[g-1],b=EW({roundPositionsCount:h.length,groupedOrder:s}),S=(b==null?void 0:b.length)||1;if(S<=h.length){let P=m/S,E=Rr(h,P);o===Od&&E.forEach(R=>R.reverse()),y=(b==null?void 0:b.length)&&(b==null?void 0:b.map(R=>E[R-1]).flat())||y}o===Lo?I=y[g-1]:o===Od?((!(b!=null&&b.length)||S>h.length)&&(g=p.length+1-g),I=y[g-1]):o===uT&&Fa()&&console.log(Q0,{feedProfile:o});let w=I&&p.reduce((P,E)=>E.roundPosition===I?E:P,void 0),U;w!=null&&w.feedRound?(v=0,U=Math.min(...(w.drawPositions||[]).filter(Boolean))):U=((D=w==null?void 0:w.drawPositions)==null?void 0:D.length)===2&&(w==null?void 0:w.drawPositions[v]);let T=d==null?void 0:d.find(({drawPosition:P})=>P===U);if(T){let{extension:P}=gt({element:T,name:wT});if(P!=null&&P.value)return{disabledDrawPosition:U}}return{matchUp:w,targetDrawPosition:U,matchUpDrawPositionIndex:v}}function Cn({inContextDrawMatchUps:t=[],useTargetMatchUpIds:e,inContextMatchUp:i,drawDefinition:r,matchUpId:n}){let a=i;t.length&&!a&&(a=t.find(s=>s.matchUpId===n));let{structure:o}=et({structureId:a==null?void 0:a.structureId,drawDefinition:r});return(o==null?void 0:o.finishingPosition)===Xm?Cse({inContextDrawMatchUps:t,useTargetMatchUpIds:e,drawDefinition:r,structure:o,matchUp:a}):Mse({matchUp:a})}function Cse({inContextDrawMatchUps:t,useTargetMatchUpIds:e,drawDefinition:i,structure:r,matchUp:n}){var R,N,A;let{winnerMatchUpId:a,loserMatchUpId:o}=n,{links:s}=Rse({roundNumber:n.roundNumber,structureId:r.structureId,drawDefinition:i}),l=s==null?void 0:s.source,u=dE({source:l,linkType:Su}),c=dE({linkCondition:tl,linkType:jl,source:l}),d=dE({source:l,linkType:jl}),p=c&&d;d||(d=c);let m=(R=u==null?void 0:u.target)==null?void 0:R.feedProfile,h=(N=d==null?void 0:d.target)==null?void 0:N.feedProfile,f=(A=c==null?void 0:c.target)==null?void 0:A.feedProfile,g,v,y,I,b,S,w,U,T,D;if(e&&(a||o)&&(w=a&&m!==ko&&t.find(({matchUpId:M})=>M===a),I=o&&h!==ko&&t.find(({matchUpId:M})=>M===o),w||I))return{matchUp:n,targetLinks:{loserTargetLink:d,winnerTargetLink:u},targetMatchUps:{loserMatchUp:I,winnerMatchUp:w}};let{roundPosition:P}=n;D=D||t.filter(M=>M.structureId===r.structureId);let E=D.reduce((M,C)=>C.roundNumber===n.roundNumber&&!C.matchUpTieId?M+1:M,0);return d&&!I&&h!==ko&&({matchUpDrawPositionIndex:S,targetDrawPosition:b,matchUp:I}=pE({targetLink:d,sourceRoundMatchUpCount:E,inContextDrawMatchUps:t,sourceRoundPosition:P,drawDefinition:i})),p&&f!==ko&&({matchUpDrawPositionIndex:y,targetDrawPosition:v,matchUp:g}=pE({targetLink:c,sourceRoundMatchUpCount:E,inContextDrawMatchUps:t,sourceRoundPosition:P,drawDefinition:i})),u&&!w&&m!==ko&&({matchUpDrawPositionIndex:T,targetDrawPosition:U,matchUp:w}=pE({targetLink:u,sourceRoundMatchUpCount:E,inContextDrawMatchUps:t,sourceRoundPosition:P,drawDefinition:i})),w||(D=D||t.filter(M=>M.structureId===r.structureId),{matchUp:w}=Ese({structureMatchUps:D,matchUp:n})),Ge({matchUp:n,targetLinks:{loserTargetLink:d,winnerTargetLink:u,byeTargetLink:c},targetMatchUps:{winnerMatchUpDrawPositionIndex:T,loserMatchUpDrawPositionIndex:S,byeMatchUpDrawPositionIndex:y,winnerTargetDrawPosition:U,loserTargetDrawPosition:b,byeTargetDrawPosition:v,winnerMatchUp:w,loserMatchUp:I,byeMatchUp:g},targetMatchUpIds:!!(a||o)})}function Mse({matchUp:t}){return{targetLinks:{loserTargetLink:void 0,winnerTargetLink:void 0},targetMatchUps:{loserMatchUp:void 0,winnerMatchUp:void 0},matchUp:t}}function Nse({drawDefinition:t,inContextDrawMatchUps:e}){let i={};return e.forEach(r=>{var l,u,c,d,p,m;let{matchUpId:n,structureId:a,drawPositions:o=[]}=r,{structure:s}=et({drawDefinition:t,structureId:a});if((s==null?void 0:s.finishingPosition)===kd){let{roundNumber:h}=r,f=h&&Qe(h)+1,g=s.matchUps??[],{roundMatchUps:v}=En({matchUps:g});if(f&&(v!=null&&v[f])){let y=[...o].sort(or).map((I,b)=>{let S=v[f].find(w=>{var U;return(U=w.drawPositions)==null?void 0:U.includes(I)});return{matchUpId:S==null?void 0:S.matchUpId,roundNumber:f,schedule:S==null?void 0:S.schedule,sideNumber:b+1,structureName:s.structureName}});Object.assign(r,{sidesTo:y})}}else{let h=Cn({useTargetMatchUpIds:!0,inContextDrawMatchUps:e,inContextMatchUp:r,drawDefinition:t,matchUpId:n}),{winnerMatchUp:f}=h.targetMatchUps,{loserMatchUp:g}=h.targetMatchUps;!r.winnerMatchUpId&&f&&(r.winnerMatchUpId=f.matchUpId),!r.loserMatchUpId&&g&&(r.loserMatchUpId=g.matchUpId);let v=mE({upcomingMatchUp:f}),y=mE({upcomingMatchUp:g});if(r.matchUpStatus!==Vt&&(g==null?void 0:g.matchUpStatus)===Vt){let{matchUp:b}=KW({matchUp:g,drawDefinition:t,inContextDrawMatchUps:e})||{};y=b&&mE({upcomingMatchUp:b})||y}let I=(l=r.schedule)==null?void 0:l.timeAfterRecovery;if(I&&((u=v==null?void 0:v.schedule)!=null&&u.scheduledTime&&kt(v.schedule.scheduledTime)<kt(I)&&(i[v.matchUpId]=r.matchUpId,v.schedule.scheduleConflict=r.matchUpId),(c=y==null?void 0:y.schedule)!=null&&c.scheduledTime&&kt(y.schedule.scheduledTime)<kt(I)&&(i[y.matchUpId]=r.matchUpId,y.schedule.scheduleConflict=r.matchUpId)),Object.assign(r,{winnerTo:v,loserTo:y}),(d=r.drawPositions)==null?void 0:d.filter(Boolean).length){let b=((m=(p=h.targetLinks)==null?void 0:p.loserTargetLink)==null?void 0:m.linkCondition)===tl,S=Ase(r);if(S.length){let w=NC(f==null?void 0:f.sides),U=NC(g==null?void 0:g.sides),T=S.find(({participantId:P})=>w.includes(P))?[]:S,D=S.find(({participantId:P})=>U.includes(P))?[]:S;g&&b&&D.length<2&&D.push({bye:!0,tbd:!0}),T!=null&&T.length&&f&&(!h.targetMatchUpIds&&f&&(f=e.find(({matchUpId:P})=>P===f.matchUpId)),f.potentialParticipants||(f.potentialParticipants=[]),f.potentialParticipants.push(T)),D!=null&&D.length&&g&&(h.targetMatchUpIds||(f=e.find(({matchUpId:P})=>P===g.matchUpId)),g.potentialParticipants||(g.potentialParticipants=[]),g.potentialParticipants.push(D))}}}}),Object.keys(i).length&&e.forEach(r=>{Object.keys(i).includes(r.matchUpId)&&(r.schedule.scheduleConflict=i[r.matchUpId])}),{scheduleConflictMatchUpIds:i}}function Ase(t){var e;return((e=t==null?void 0:t.sides)==null?void 0:e.map(({participant:i,participantId:r,qualifier:n})=>i||r&&{participantId:r}||n&&{qualifier:n}).filter(Boolean))||[]}function KW({matchUp:t,drawDefinition:e,inContextDrawMatchUps:i}){var o;let{matchUpId:r,matchUpStatus:n,structureId:a}=t||{};if(!t||!a||(t==null?void 0:t.matchUpStatus)===Ji)return{matchUp:t};if(n===Vt){let s;return t.winnerMatchUpId?s=i.find(({matchUpId:l})=>l===t.winnerMatchUpId):{winnerMatchUp:s}=((o=Cn({inContextDrawMatchUps:i,drawDefinition:e,matchUpId:r}))==null?void 0:o.targetMatchUps)||{},KW({matchUp:s,drawDefinition:e,inContextDrawMatchUps:i})}return{matchUp:void 0}}function mE(t){if(t!=null&&t.upcomingMatchUp)return(({matchUpId:e,structureId:i,schedule:r,roundNumber:n,roundPosition:a,structureName:o})=>({matchUpId:e,structureId:i,schedule:r,roundNumber:n,roundPosition:a,structureName:o}))(t.upcomingMatchUp)}function mr(t){let e="getAllDrawMatchUps";Object.assign(t,{requireParticipants:!1});let i=$g(t);if(i.error)return ee({result:i,stack:e});let{abandonedMatchUps:r,completedMatchUps:n,upcomingMatchUps:a,pendingMatchUps:o,byeMatchUps:s,matchUpsMap:l}=i;return{matchUps:(r??[]).concat(...n??[],...a??[],...o??[],...s??[]),matchUpsMap:l}}function $g(t){if(!(t!=null&&t.drawDefinition))return{error:_e};let{tournamentParticipants:e,contextContent:i,matchUpsMap:r}=t,{scheduleVisibilityFilters:n,tournamentAppliedPolicies:a,requireParticipants:o,participantsProfile:s,afterRecoveryTimes:l,policyDefinitions:u,tournamentRecord:c,usePublishState:d,contextFilters:p,matchUpFilters:m,scheduleTiming:h,participantMap:f,publishStatus:g,contextProfile:v,drawDefinition:y,nextMatchUps:I,inContext:b,context:S,event:w}=t,U=[],T=[],D=[],P=[],E=[];v&&!i&&(i=qu({policyDefinitions:u,tournamentRecord:c,contextProfile:v,event:w}));let R;!(e!=null&&e.length)&&c&&(e=c==null?void 0:c.participants,(b||s!=null&&s.withGroupings)&&(e!=null&&e.length)&&({participantsWithGroupings:e,groupInfo:R}=CT({participants:e,participantsProfile:s})));let{structures:N}=Zo({drawDefinition:y});if(!N)return{error:Mi};r||(r=sn({drawDefinition:y}));let A=y&&CW({drawDefinition:y}).exitProfiles;N.forEach(O=>{let{byeMatchUps:k=[],pendingMatchUps:x=[],upcomingMatchUps:F=[],completedMatchUps:$=[],abandonedMatchUps:_=[]}=_T({matchUpFilters:I?void 0:m,contextFilters:I?void 0:p,inContext:b||I||p,hydrateParticipants:t.hydrateParticipants,tournamentAppliedPolicies:a,scheduleVisibilityFilters:n,tournamentParticipants:e,requireParticipants:o,afterRecoveryTimes:l,policyDefinitions:u,tournamentRecord:c,usePublishState:d,contextContent:i,participantMap:f,scheduleTiming:h,publishStatus:g,contextProfile:v,drawDefinition:y,exitProfiles:A,matchUpsMap:r,structure:O,context:S,event:w});U=U.concat(..._),T=T.concat(...$),D=D.concat(...F),P=P.concat(...x),E=E.concat(...k)});let M=O=>(!m&&!I&&!p||(m&&(O=lu({matchUps:O,...m})),p&&(O=lu({matchUps:O,...p,processContext:!0}))),O),C={abandonedMatchUps:M(U),completedMatchUps:M(T),upcomingMatchUps:M(D),pendingMatchUps:M(P),byeMatchUps:M(E),matchUpsMap:r,...J,groupInfo:R};if(I){let O=typeof I=="object"||{abandoned:!0,completed:!0,upcoming:!0,pending:!0,bye:!0},{abandoned:k,completed:x,upcoming:F,pending:$,bye:_}=O,L=[].concat(...k&&U||[],...x&&T||[],...F&&D||[],...$&&P||[],..._&&E||[]);Nse({inContextDrawMatchUps:L,drawDefinition:y})}return C}function tu(t){let{participants:e=[],contextContent:i,participantMap:r}=t,{scheduleVisibilityFilters:n,tournamentAppliedPolicies:a,participantsProfile:o,afterRecoveryTimes:s,policyDefinitions:l,useParticipantMap:u,tournamentRecord:c,contextFilters:d,contextProfile:p,matchUpFilters:m,nextMatchUps:h,inContext:f,context:g,event:v}=t;if(!v)return{error:gi};let{eventId:y,eventName:I,endDate:b,eventType:S,category:w,gender:U,matchUpFormat:T}=v??{},D={...g,...Ge({indoorOutDoor:v.indoorOutdoor??(c==null?void 0:c.indoorOutdoor),surfaceCategory:v.surfaceCategory??(c==null?void 0:c.surfaceCategory),endDate:v.endDate??(c==null?void 0:c.endDate),tournamentId:c==null?void 0:c.tournamentId,matchUpFormat:T,eventName:I,eventType:S,category:w,eventId:y,gender:U})};b&&(D.endDate=b),p&&!i&&(i=qu({policyDefinitions:l,tournamentRecord:c,contextProfile:p,event:v}));let P;if(!(e!=null&&e.length)&&!r&&c){let N=mp({participantsProfile:o,useParticipantMap:u,policyDefinitions:l,tournamentRecord:c,contextProfile:p,inContext:f});r=N.participantMap,e=N.participants??[],P=N.groupInfo}let E=v.drawDefinitions??[],R=qy({tournamentRecord:c,event:v}).scheduleTiming;return{matchUps:E.flatMap(N=>{let{matchUps:A}=mr({tournamentParticipants:e,tournamentAppliedPolicies:a,scheduleVisibilityFilters:n,context:D,participantsProfile:o,afterRecoveryTimes:s,policyDefinitions:l,tournamentRecord:c,contextFilters:d,contextProfile:p,drawDefinition:N,contextContent:i,matchUpFilters:m,participantMap:r,scheduleTiming:R,nextMatchUps:h,inContext:f,event:v});return A??[]}),groupInfo:P}}function Vr(t){let e=ze(t,[{tournamentRecord:!0}]);if(e.error)return e;if(!(t!=null&&t.tournamentRecord))return{error:ge};let{participantMap:i,participants:r}=t,{scheduleVisibilityFilters:n,participantsProfile:a,afterRecoveryTimes:o,useParticipantMap:s,policyDefinitions:l,tournamentRecord:u,inContext:c=!0,contextProfile:d,matchUpFilters:p,contextFilters:m,nextMatchUps:h,context:f}=t,g=t.tournamentId??u.tournamentId,v=(u==null?void 0:u.events)??[];r||({participants:r,participantMap:i}=mp({participantsProfile:a,useParticipantMap:s,policyDefinitions:l,tournamentRecord:u,contextProfile:d,inContext:c}));let{appliedPolicies:y}=$t({tournamentRecord:u}),I={...f,tournamentId:g,indoorOutDoor:u.indoorOutdoor,surfaceCategory:u.surfaceCategory,endDate:u.endDate},b=qu({policyDefinitions:l,tournamentRecord:u,contextProfile:d});return{matchUps:v.flatMap(S=>{var w;return I.eventDrawsCount=((w=S.drawDefinitions)==null?void 0:w.length)??0,tu({context:I,scheduleVisibilityFilters:n,tournamentAppliedPolicies:y,participantsProfile:a,afterRecoveryTimes:o,policyDefinitions:l,tournamentRecord:u,contextContent:b,contextFilters:m,contextProfile:d,matchUpFilters:p,participantMap:i,nextMatchUps:h,participants:r,inContext:c,event:S}).matchUps??[]}).concat(...u.matchUps??[])}}function Es({scheduleVisibilityFilters:t,afterRecoveryTimes:e,participantsProfile:i,tournamentRecords:r,policyDefinitions:n,matchUpFilters:a,contextFilters:o,nextMatchUps:s,inContext:l}){if(typeof r!="object"||!Object.keys(r).length)return{error:ki};let u=Object.keys(r).map(c=>{let d=r[c];return Vr({scheduleVisibilityFilters:t,afterRecoveryTimes:e,participantsProfile:i,policyDefinitions:n,tournamentRecord:d,matchUpFilters:a,contextFilters:o,nextMatchUps:s,inContext:l}).matchUps??[]}).flat();return{...J,matchUps:u}}function oh(t,e){return Ose(t,e)||((t==null?void 0:t.stageSequence)||0)-((e==null?void 0:e.stageSequence)||0)||(t==null?void 0:t.roundNumber)&&e.roundNumber&&(t==null?void 0:t.roundNumber)-(e==null?void 0:e.roundNumber)||((t==null?void 0:t.roundPosition)??0)-((e==null?void 0:e.roundPosition)??0)}function Ose(t,e){return(ym[t==null?void 0:t.stage]||0)-(ym[e==null?void 0:e.stage]||0)}function Sn(t){let{participants:e,participantMap:i,contextContent:r}=t,{scheduleVisibilityFilters:n,tournamentAppliedPolicies:a,participantsProfile:o,afterRecoveryTimes:s,policyDefinitions:l,useParticipantMap:u,tournamentRecord:c,matchUpFilters:d,contextFilters:p,contextProfile:m,drawDefinition:h,nextMatchUps:f,inContext:g,context:v,event:y}=t,{eventId:I,eventName:b,endDate:S,eventType:w,category:U,gender:T,matchUpFormat:D}=y??{},P={...v,surfaceCategory:(y==null?void 0:y.surfaceCategory)??(c==null?void 0:c.surfaceCategory),indoorOutDoor:(y==null?void 0:y.indoorOutdoor)??(c==null?void 0:c.indoorOutdoor),matchUpFormat:D,eventType:w,eventName:b,category:U,eventId:I,endDate:S,gender:T},E;return!(e!=null&&e.length)&&!i&&c&&({participants:e=[],participantMap:i,groupInfo:E}=mp({participantsProfile:o,useParticipantMap:u,policyDefinitions:l,tournamentRecord:c,contextProfile:m,inContext:g})),m&&!r&&(r=qu({policyDefinitions:l,tournamentRecord:c,contextProfile:m,drawDefinition:h,event:y})),{...mr({context:P,tournamentAppliedPolicies:a,scheduleVisibilityFilters:n,tournamentParticipants:e,participantsProfile:o,afterRecoveryTimes:s,policyDefinitions:l,tournamentRecord:c,drawDefinition:h,contextContent:r,contextFilters:p,contextProfile:m,matchUpFilters:d,participantMap:i,nextMatchUps:f,inContext:g,event:y}),groupInfo:E}}function Jp({element:t,accessor:e}){if(typeof e!="string")return{values:[]};let i=Me(t),r=e.split("."),n=[],a;s({targetElement:i,attributes:r});let o={value:a};return n.length&&(o.values=n),o;function s({targetElement:l,attributes:u=[],significantCharacters:c}){for(let[p,m]of u.entries())if(l!=null&&l[m]){let h=u.slice(p+1);h.length?Array.isArray(l[m])?l[m].forEach(f=>s({targetElement:f,attributes:h})):(l=l[m],d({targetElement:l,index:p})):(a||(a=l[m]),n.includes(l[m])||n.push(l[m]))}function d({targetElement:p,index:m}){if(p&&m===u.length-1&&["string","number"].includes(typeof p)){let h=c?p.slice(0,c):p;a?n.includes(h)||n.push(h):(a=h,n.push(h))}}}}var XW=t=>e=>{var i;return!t||typeof e!="object"?void 0:Array.isArray(t)&&t.map(r=>{var n;return{[r]:(n=Jp({element:e,accessor:r}))==null?void 0:n.value}})||typeof t=="object"&&Object.keys(t).map(r=>{var n;return{[r]:(n=Jp({element:e,accessor:r}))==null?void 0:n.value}})||((i=typeof t=="string"&&Jp({element:e,accessor:t}))==null?void 0:i.value)},Ta=XW;function nb({finishingPositionOffset:t=0,finishingPositionLimit:e,positionsFed:i,roundsCount:r,roundLimit:n,matchUps:a,lucky:o,fmlc:s}){var g;if(!wo(a))return[];let{roundProfile:l,roundNumbers:u=[]}=En({interpolate:!0,matchUps:a});r=r??Math.max(...u,0);let c=n?r-n:0,d=c&&((g=l==null?void 0:l[r-c])==null?void 0:g.matchUpsCount),p=l&&Object.values(l).map(Ta("matchUpsCount")),m=(v,y)=>{let I=Math.min(...v);d&&y&&I===1&&(I=d);let b=Math.max(...v);return e&&b>e&&(b=e),[I,b]},h=l&&Object.assign({},...u.map(v=>{let y=(r??0)+1-v-c,I=l[v].matchUpsCount,b={finishingPositionRange:{},finishingRound:y},S=p==null?void 0:p.slice(v-1).reduce((N,A)=>N+(A||0),0),w=s&&v!==1,U=1+t+(w?i??0:0),T=1,D=Se(U,o?U+I*2:S+U+T),P=S+T-I,E=m(D.slice(P)),R=m(D.slice(0,P),!0);return b.finishingPositionRange={loser:E,winner:R},{[v]:b}})),f=Fa({finishingRound:!0});return a.filter(Boolean).forEach(v=>{let y=v.roundNumber&&h[v.roundNumber];f&&!y&&console.log({roundFinishingData:h,matchUp:v}),v.finishingRound=y==null?void 0:y.finishingRound,v.finishingPositionRange=y==null?void 0:y.finishingPositionRange}),a}function $d({inContextDrawMatchUps:t,drawDefinition:e,matchUpsMap:i}){var n;if(!e)return{error:_e};let r={loserMatchUpIds:{},winnerMatchUpIds:{}};if(t||({matchUps:t,matchUpsMap:i}=mr({inContext:!0,drawDefinition:e,matchUpsMap:i})),!(i!=null&&i.drawMatchUps.some(a=>a.finishingPositionRange))&&((n=e==null?void 0:e.structures)==null?void 0:n.length)===1&&!(e!=null&&e.structures[0].structures)){let a=(i==null?void 0:i.drawMatchUps)??[];nb({matchUps:a})}return(t??[]).filter(({collectionId:a})=>!a).forEach(a=>{let{matchUpId:o,structureId:s}=a,l=Cn({inContextDrawMatchUps:t,drawDefinition:e,matchUpId:o}),{winnerMatchUp:u,loserMatchUp:c}=l.targetMatchUps,d=u==null?void 0:u.matchUpId,p=c==null?void 0:c.matchUpId,m=Ld({matchUpsMap:i,structureId:s}).find(h=>h.matchUpId===o);if(m&&(d&&(r.winnerMatchUpIds[m.matchUpId]=d,Object.assign(m,{winnerMatchUpId:d}),Object.assign(a,{winnerMatchUpId:d})),p&&(r.loserMatchUpIds[m.matchUpId]=p,a.loserMatchUpId=p,m.loserMatchUpId=p,a.finishingPositionRange))){let h=c.finishingPositionRange&&[...a.finishingPositionRange.loser,...c.finishingPositionRange.loser],f=h&&[Math.min(...h),Math.max(...h)];a.finishingPositionRange.loser=f,m.finishingPositionRange.loser=f}}),{inContextDrawMatchUps:t,goesToMap:r}}function us(t){var y;let e=Io(t),i=t.matchUps??[],r=t.drawIds??[],{includeParticipantDependencies:n,tournamentRecord:a,drawDefinition:o}=t;if(!Array.isArray(i))return{error:ju};if(!Array.isArray(r))return{error:xs};let s=(y=t.matchUpIds)!=null&&y.length?t.matchUpIds:i.map(I=>I.matchUpId);if(!Array.isArray(s))return{error:jm};let l={},u={},c={},d={};a&&!Object.keys(e).length&&(e={[a.tournamentId]:a});let p=Object.values(e),m=p.reduce((I,b)=>I.concat(b.events??[]).map(S=>(S.drawDefinitions||[]).map(w=>w.links||[])).flat(1/0),[]).filter(({linkType:I})=>I===Uu),h=i;if(m.length){h=Es({nextMatchUps:!0,tournamentRecords:e}).matchUps;let I=m.reduce((b,S)=>{var T,D;let w=(T=S.source)==null?void 0:T.structureId,U=(D=S.target)==null?void 0:D.structureId;return w&&U&&(c[U]=w),w&&!b.includes(w)&&b.push(w),b},[]);for(let b of I)l[b]=[];for(let b of h??[]){let S=b.containerStructureId||b.structureId;I.includes(S)&&l[S].push(b.matchUpId)}}let f=I=>{u[I]||(u[I]={dependentMatchUpIds:[],participantIds:[],matchUpIds:[],sources:[]},d[I]=[])},g=(I,b)=>{u[I].matchUpIds.forEach(S=>{u[b].matchUpIds.push(S)}),u[b].matchUpIds.push(I),u[I].dependentMatchUpIds.push(b),n&&u[I].participantIds.forEach(S=>u[b].participantIds.push(S))},v=I=>{let b=Object.keys(l).length;for(let S of I||[]){let{matchUpId:w,winnerMatchUpId:U,loserMatchUpId:T}=S;if(!s.length||s.includes(w)){if(f(w),n){let{individualParticipantIds:E}=ET(S);u[w].participantIds=E}U&&(f(U),g(w,U),d[U].push(w)),T&&(f(T),g(w,T),d[T].push(w)),u[w].sources.push(d[w]);let D=d[w].map(E=>u[E].sources[0]).flat(),P=d[w].map(E=>u[E].sources[1]).flat();if(u[w].sources.push(D,P),b){let E=S.containerStructureId||S.structureId,R=c[E];if(l[R])for(let N of l[R])f(N),g(N,w),d[N].push(w)}}}};if(o)$d({drawDefinition:o}),h!=null&&h.length||(h=Sn({drawDefinition:o}).matchUps),v(h);else{if(h!=null&&h.length||(h=Es({nextMatchUps:!0,tournamentRecords:e}).matchUps),!r.length){let I=p!=null&&p.length?p.map(({events:b=[]})=>b.map(({drawDefinitions:S=[]})=>S.map(({drawId:w})=>w))).flat(1/0):[];I&&(r=I)}for(let I of r){let b=h==null?void 0:h.filter(S=>S.drawId===I).sort(oh);if(!(b!=null&&b.find(({roundPosition:S})=>!S))){let S=b==null?void 0:b.find(({tournamentId:U})=>U),{drawDefinition:w}=Wn({tournamentRecord:e[S==null?void 0:S.tournamentId],drawId:I});w&&$d({drawDefinition:w})}v(b)}}return{positionDependencies:l,matchUpDependencies:u,sourceMatchUpIds:d,matchUps:h,...J}}function Ir(t){var d,p;let e=t==null?void 0:t.matchUp,i=(t==null?void 0:t.score)||(e==null?void 0:e.score),r=(d=i==null?void 0:i.sets)==null?void 0:d[0],{side1Score:n,side2Score:a,side1TiebreakScore:o,side2TiebreakScore:s,side1PointScore:l,side2PointScore:u}=r||{},c=n||a||o||s||l||u;return!!(((p=i==null?void 0:i.sets)==null?void 0:p.length)>1||c)}function ab({matchUpStatus:t}){return sW.includes(t)}function kse({matchUpStatus:t}){return fA.includes(t)}function $C({matchUpStatus:t}){return lW.includes(t)}function HA({matchUpStatus:t,winningSide:e,tieMatchUps:i,sides:r,score:n}){var s;let a=r==null?void 0:r.find(({participantId:l})=>l),o=(s=i==null?void 0:i.filter(HA))==null?void 0:s.length;return Ir({score:n})||o||e&&a||t&&kse({matchUpStatus:t})&&![Mt,zt,ss].includes(t)}function ob(t){var U;let{drawDefinition:e,findContainer:i,structureId:r,event:n}=t,a=t.structure,o={isCollectionMatchUp:!1},{containedStructures:s}=Lg({drawDefinition:e}),l=r?s[r]||[]:[];if(!a){let T=et({drawDefinition:e,structureId:r});if(T.error)return T;a=i?T.containingStructure??T.structure:T.structure}if(zn({structure:a}))return{structure:a,isAdHoc:!0,error:Tg};let{matchUps:u}=mr({inContext:!0,matchUpFilters:o,drawDefinition:e,event:n}),c=u==null?void 0:u.filter(T=>T.structureId===r||l.includes(T.structureId)),{matchUpDependencies:d}=us({drawIds:[e.drawId],matchUps:u,drawDefinition:e}),p=[],m=[],h={},f=[];for(let T of u??[]){if(T.structureId===r||l.includes(T.structureId)){m.push(...T.drawPositions??[]);let D=T.roundNumber;for(let P of(T.drawPositions??[]).filter(Boolean))(!h[P]||D&&h[P]>D)&&(h[P]=D)}HA(T)&&(f.push(T),p.push(T.matchUpId,...((U=d==null?void 0:d[T==null?void 0:T.matchUpId])==null?void 0:U.matchUpIds)||[]))}let g=ct(m.filter(Boolean)).sort(or),v=ct(p),y=ct(c==null?void 0:c.map(({matchUpId:T,drawPositions:D})=>v.includes(T)?D:[]).flat().filter(Boolean)).sort(or),{positionAssignments:I}=oi({drawDefinition:e,structure:a}),b=I==null?void 0:I.filter(T=>T.bye).map(T=>T.drawPosition),S=I==null?void 0:I.filter(T=>T.qualifier).map(T=>T.drawPosition),w=(g==null?void 0:g.filter(T=>!y.includes(T)))||[];return{allDrawPositions:g,inContextStructureMatchUps:c,drawPositionInitialRounds:h,activeDependentMatchUpIds:v,qualifyingDrawPositions:S,inactiveDrawPositions:w,positionAssignments:I,activeDrawPositions:y,byeDrawPositions:b,activeMatchUps:f,structure:a}}function Tm({drawPosition:t,matchUps:e=[]}){return{initialRoundNumber:e.filter(({drawPositions:i})=>t&&(i==null?void 0:i.includes(t))).map(({roundNumber:i})=>i).sort(or)[0]}}var ac={reset:"\x1B[0m",bright:"\x1B[1m",dim:"\x1B[2m",red:"\x1B[31m",brightred:"\x1B[91m",green:"\x1B[32m",brightgreen:"\x1B[92m",yellow:"\x1B[33m",brightyellow:"\x1B[93m",blue:"\x1B[34m",brightblue:"\x1B[94m",lightblue:"\x1B[105m",magenta:"\x1B[35m",brightmagenta:"\x1B[95m",cyan:"\x1B[36m",brightcyan:"\x1B[96m",white:"\x1B[37m",brightwhite:"\x1B[97m"},DS=[];function Aa(t,e){Ti(t)&&(t={method:t}),(e||Fa())&&DS.push(t)}function xse(t){let e=DS.slice();return t&&(DS.length=0),e}function Fse(t){let e=xse(t).map(i=>{let{color:r,keyColors:n,method:a,newline:o}=i,s=Object.keys(ac).includes(r)?ac[r]:ac.cyan,l=Object.keys(i).filter(c=>!["color","keyColors","method","newline"].includes(c)).map(c=>{let d=n&&Object.keys(n).includes(c)&&ac[n[c]]?ac[n[c]]:ac.brightwhite;return`${ac.white}${c}: ${d}${i[c]}`}).join(", "),u=(a==null?void 0:a.length)<15?"		":"	";return[o?`
`:"",s,a,u,ac.white,l,ac.reset,`
`].join("")});e!=null&&e.length&&console.log(...e)}function Lse(){DS.length=0}function Ya({provisionalPositioning:t,isPositionAction:e,tournamentRecord:i,drawDefinition:r,drawPosition:n,matchUpsMap:a,structureId:o,structure:s,event:l}){var D,P,E;if(!r)return{error:_e};if(s||({structure:s}=et({drawDefinition:r,structureId:o})),!s)return{error:Mi};o||({structureId:o}=s);let u="assignDrawPositionBye";Aa({method:u,color:"cyan",drawPosition:n}),a||(a=sn({drawDefinition:r}));let{positionAssignments:c}=oi({structure:s}),{activeDrawPositions:d}=ob({drawDefinition:r,structureId:o});if((D=c==null?void 0:c.find(R=>R.drawPosition===n))!=null&&D.bye)return{...J};if(d!=null&&d.includes(n))return{error:V0};let p=c==null?void 0:c.find(R=>R.drawPosition===n);if(!p)return{error:Tg};let{filled:m,containsBye:h,assignedParticipantId:f}=_se(p);if(h)return{...J};if(m&&!h)return ee({result:{error:Df},stack:u});let g=$t({tournamentRecord:i,drawDefinition:r,event:l}).appliedPolicies??{},v=mr({inContext:!0,drawDefinition:r,matchUpsMap:a}).matchUps??[],y={isCollectionMatchUp:!1},{matchUps:I}=Wt({provisionalPositioning:t,drawDefinition:r,matchUpFilters:y,matchUpsMap:a,structure:s});if(c==null||c.forEach(R=>{R.drawPosition===n&&(R.bye=!0)}),s.structureType===xn)return $se({tournamentRecord:i,drawDefinition:r,drawPosition:n,matchUps:I}),Pc({tournamentId:i==null?void 0:i.tournamentId,drawDefinition:r,structure:s,event:l}),OB({assignedParticipantId:f,isPositionAction:e,appliedPolicies:g,drawDefinition:r,drawPosition:n,structureId:o,stack:u});let{roundProfile:b,roundMatchUps:S}=En({matchUps:I}),w=(P=b&&Object.keys(b).map(R=>parseInt(R)).reverse())==null?void 0:P.find(R=>{var N;return(N=b==null?void 0:b[R].drawPositions)==null?void 0:N.includes(n)}),U=w?S==null?void 0:S[w].find(({drawPositions:R})=>R==null?void 0:R.includes(n)):void 0;U&&JW({tournamentRecord:i,drawDefinition:r,matchUp:U,event:l});let T=(E=U==null?void 0:U.drawPositions)==null?void 0:E.find(R=>R!==n);if(U&&T){let R=zA({sourceDrawPositions:U.drawPositions,matchUpId:U.matchUpId,inContextDrawMatchUps:v,drawPositionToAdvance:T,tournamentRecord:i,drawDefinition:r,matchUpsMap:a});if(R.error)return R}return Pc({tournamentId:i==null?void 0:i.tournamentId,drawDefinition:r,structure:s,event:l}),OB({assignedParticipantId:f,isPositionAction:e,appliedPolicies:g,drawDefinition:r,drawPosition:n,structureId:o,stack:u})}function OB({assignedParticipantId:t,isPositionAction:e,appliedPolicies:i,drawDefinition:r,drawPosition:n,structureId:a,stack:o}){return e&&RT({appliedPolicies:i,drawDefinition:r,positionAction:{removedParticipantId:t,drawPosition:n,structureId:a,name:o}}),ee({result:{...J},stack:o})}function _se(t){let e=t.bye,i=t.qualifier,r=t.participantId;return{containsBye:e,containsQualifier:i,assignedParticipantId:r,filled:e||i||r}}function JW({tournamentRecord:t,drawDefinition:e,eventId:i,matchUp:r,event:n}){Object.assign(r,{matchUpStatus:Vt,score:void 0,winningSide:void 0}),Rt({tournamentId:t==null?void 0:t.tournamentId,eventId:i??(n==null?void 0:n.eventId),context:"setMatchUpStatusBye",drawDefinition:e,matchUp:r})}function $se({tournamentRecord:t,drawDefinition:e,drawPosition:i,matchUps:r,event:n}){r.forEach(a=>{var o;(o=a.drawPositions)!=null&&o.includes(i)&&JW({eventId:n==null?void 0:n.eventId,tournamentRecord:t,drawDefinition:e,matchUp:a})})}function zA({drawPositionToAdvance:t,inContextDrawMatchUps:e,sourceDrawPositions:i,tournamentRecord:r,drawDefinition:n,matchUpsMap:a,matchUpId:o,event:s}){var I,b;Aa({method:"advanceDrawPosition",color:"cyan",drawPositionToAdvance:t});let l=a.drawMatchUps.find(S=>S.matchUpId===o),u=(I=e.find(S=>S.matchUpId===o))==null?void 0:I.structureId,{structure:c}=et({drawDefinition:n,structureId:u}),{positionAssignments:d}=oi({structure:c}),p=d==null?void 0:d.filter(S=>S.bye).map(S=>S.drawPosition),m=(b=l==null?void 0:l.drawPositions)==null?void 0:b.find(S=>S!==t),h=m&&(p==null?void 0:p.includes(m)),{targetLinks:{loserTargetLink:f},targetMatchUps:{loserMatchUp:g,winnerMatchUp:v,loserTargetDrawPosition:y}}=Cn({inContextDrawMatchUps:e,drawDefinition:n,matchUpId:o});if(v&&v.structureId===(c==null?void 0:c.structureId)&&Bse({drawPositionToAdvance:t,inContextDrawMatchUps:e,sourceDrawPositions:i,tournamentRecord:r,drawDefinition:n,winnerMatchUp:v,matchUpsMap:a,event:s}),g&&h&&g.structureId!==(c==null?void 0:c.structureId)){let{roundNumber:S}=g;if(S===1){let w=Ya({structureId:f.target.structureId,drawPosition:y,tournamentRecord:r,drawDefinition:n,event:s});if(w.error)return w}else QW({loserTargetDrawPosition:y,tournamentRecord:r,loserTargetLink:f,drawDefinition:n,loserMatchUp:g,matchUpsMap:a,event:s})}return{...J}}function Bse({drawPositionToAdvance:t,inContextDrawMatchUps:e,sourceDrawPositions:i,tournamentRecord:r,drawDefinition:n,winnerMatchUp:a,matchUpsMap:o,event:s}){var A,M,C,O,k,x;let l="advanceWinner",u=o.drawMatchUps.find(F=>F.matchUpId===a.matchUpId),c=(A=e.find(F=>F.matchUpId===a.matchUpId))==null?void 0:A.structureId,{structure:d}=et({drawDefinition:n,structureId:c}),{positionAssignments:p}=oi({structure:d}),m=(M=p==null?void 0:p.find(({drawPosition:F})=>F===t))==null?void 0:M.bye,h=(C=u.drawPositions)==null?void 0:C.filter(Boolean),f=p==null?void 0:p.filter(F=>h==null?void 0:h.includes(F.drawPosition)),g=p==null?void 0:p.find(({drawPosition:F})=>F===t),v=i==null?void 0:i.find(F=>F!==t),y=(O=v&&(f==null?void 0:f.find(({drawPosition:F})=>F===v)))==null?void 0:O.bye,I=m&&y;if(I&&console.log({isByeAdvancedBye:I}),(h==null?void 0:h.length)>1&&m&&!y)return ee({result:{error:Df},stack:l});let b=h==null?void 0:h.find(F=>F!==t),S=I,w=[...(u.drawPositions||[]).filter(Boolean),void 0,void 0].slice(0,2),U=w.map(F=>!F&&!S||F===t?(S=!0,t):F).sort(or);if(!S)return console.log("@@@@@@@",{advancingAssignmentIsBye:g,drawPositionToAdvance:t,existingAssignments:f}),ee({result:{error:Df},stack:l});let T=(k=p==null?void 0:p.find(({drawPosition:F})=>F===b))==null?void 0:k.bye,D=(x=p==null?void 0:p.find(({drawPosition:F})=>F===t))==null?void 0:x.bye;Object.assign(u,{matchUpStatus:D||T?Vt:Ji,score:void 0,winningSide:void 0,drawPositions:U});let P=u.drawPositions.find(F=>!w.includes(F));Aa({method:l,color:"brightyellow",changedDrawPosition:P,pairedDrawPositionIsBye:T,drawPositionIsBye:D}),Rt({tournamentId:r==null?void 0:r.tournamentId,matchUp:u,eventId:s==null?void 0:s.eventId,context:l,drawDefinition:n});let{targetLinks:{loserTargetLink:E},targetMatchUps:{loserMatchUp:R,loserTargetDrawPosition:N}}=Cn({matchUpId:a.matchUpId,inContextDrawMatchUps:e,drawDefinition:n});if(T||D){let F=T?t:b;if(F)zA({drawPositionToAdvance:F,matchUpId:a.matchUpId,inContextDrawMatchUps:e,tournamentRecord:r,drawDefinition:n,matchUpsMap:o});else if(D&&E&&R)if(R.feedRound)QW({loserTargetDrawPosition:N,tournamentRecord:r,loserTargetLink:E,drawDefinition:n,loserMatchUp:R,matchUpsMap:o});else{let $=1-a.roundPosition%2,_=R.drawPositions[$],L=Ya({structureId:E.target.structureId,drawPosition:_,tournamentRecord:r,drawDefinition:n,event:s});if(L.error)return L}}}function QW({loserTargetDrawPosition:t,tournamentRecord:e,loserTargetLink:i,drawDefinition:r,loserMatchUp:n,matchUpsMap:a,event:o}){let{roundNumber:s}=n;Aa({method:"assignFedDrawPositionBye",color:"cyan",loserTargetDrawPosition:t});let l=((a==null?void 0:a.mappedMatchUps)||{})[n.structureId].matchUps,{initialRoundNumber:u}=Tm({drawPosition:t,matchUps:l});if(u===s){let c=Ya({structureId:i.target.structureId,drawPosition:t,tournamentRecord:e,drawDefinition:r,event:o});if(c.error)return c}}function ZW({positionAssignments:t,tournamentRecord:e,drawDefinition:i,matchUpsMap:r,structure:n,event:a}){let{matchUps:o}=Wt({drawDefinition:i,matchUpsMap:r,structure:n,event:a});o.forEach(s=>{let l=t.filter(({drawPosition:u})=>{var c;return(c=s.drawPositions)==null?void 0:c.includes(u)}).filter(u=>u.bye).length;s.winningSide||(Object.assign(s,{matchUpStatus:l?Vt:Ji}),Rt({tournamentId:e==null?void 0:e.tournamentId,context:"modifyRoundRobinMatchUpsStatus",eventId:a==null?void 0:a.eventId,drawDefinition:i,matchUp:s}))})}function sb(t){let{inContextDrawMatchUps:e,participantId:i,drawPosition:r}=t,{tournamentRecord:n,drawDefinition:a,structureId:o,matchUpsMap:s,event:l}=t,{structure:u}=et({drawDefinition:a,structureId:o}),c=(Er({drawDefinition:a,structure:u}).positionAssignments||[]).find(p=>i&&p.participantId===i||r&&p.drawPosition===r);if(c&&i&&!r&&(r=c==null?void 0:c.drawPosition),!r)return{error:Dg};i||(i=c==null?void 0:c.participantId);let{activeDrawPositions:d}=ob({drawDefinition:a,structureId:o});return d.includes(r)?{error:V0}:(e||({matchUps:e}=mr({inContext:!0,drawDefinition:a,matchUpsMap:s})),BC({inContextDrawMatchUps:e,tournamentRecord:n,drawDefinition:a,structureId:o,drawPosition:r,matchUpsMap:s,event:l}).drawPositionCleared?(Pc({tournamentId:n==null?void 0:n.tournamentId,drawDefinition:a,structure:u,event:l}),{...J,participantId:i}):{error:PG})}function BC({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,matchUpsMap:n,structureId:a,event:o}){var v,y;let{structure:s}=et({drawDefinition:i,structureId:a});if(!s)return{error:Mi};let l=Er({drawDefinition:i,structure:s}).positionAssignments||[],u=l.some(I=>{if(I.drawPosition===r)return delete I.participantId,delete I.qualifier,delete I.bye,!0});if(s.structureType===xn)return ZW({positionAssignments:l,tournamentRecord:e,drawDefinition:i,matchUpsMap:n,structure:s}),{drawPositionCleared:u,...J};let c={isCollectionMatchUp:!1},{matchUps:d}=Wt({drawDefinition:i,matchUpFilters:c,matchUpsMap:n,structure:s,event:o}),{roundProfile:p,roundMatchUps:m}=En({matchUps:d}),h=(v=p&&Object.keys(p))==null?void 0:v.map(I=>Qe(I)),f=r,g=(y=h==null?void 0:h.map(I=>{var R,N,A,M;let b=(N=(R=p==null?void 0:p[I])==null?void 0:R.pairedDrawPositions)==null?void 0:N.find(C=>C.includes(f)),S=b==null?void 0:b.find(C=>C!==f),w=l.find(C=>C.drawPosition===S),U=p==null?void 0:p[I+1],T=w==null?void 0:w.bye,D=(A=U==null?void 0:U.pairedDrawPositions)==null?void 0:A.find(C=>C.includes(S)),P=T&&D&&U&&((M=U.drawPositions)==null?void 0:M.includes(S)),E=b&&{pairedDrawPositionByeAdvancedPair:!P&&D,pairedDrawPosition:S,targetDrawPosition:f,relevantPair:b,roundNumber:I};return P&&(f=S),E}).filter(I=>I==null?void 0:I.targetDrawPosition))==null?void 0:y.reduce((I,b)=>{let{roundNumber:S,relevantPair:w,targetDrawPosition:U,pairedDrawPosition:T,pairedDrawPositionByeAdvancedPair:D}=b,P={roundNumber:S,targetDrawPosition:U,relevantPair:w},E=D&&{roundNumber:S+1,targetDrawPosition:T,relevantPair:D,subsequentRoundRemoval:!0},R=[P,E].filter(Boolean);return I.concat(...R)},[]);return g==null||g.forEach(({roundNumber:I,targetDrawPosition:b,relevantPair:S})=>{let w=m==null?void 0:m[I].find(U=>{var T;return Rn((T=U.drawPositions)==null?void 0:T.filter(Boolean),S.filter(Boolean))});w&&(Vse({inContextDrawMatchUps:t,targetDrawPosition:b,tournamentRecord:e,drawDefinition:i,structureId:a,roundNumber:I,matchUpsMap:n}),eq({inContextDrawMatchUps:t,positionAssignments:l,tournamentRecord:e,drawDefinition:i,targetMatchUp:w,drawPosition:r,matchUpsMap:n,structure:s,event:o}))}),{tasks:g,drawPositionCleared:u,positionAssignments:l}}function Vse({inContextDrawMatchUps:t,targetDrawPosition:e,tournamentRecord:i,drawDefinition:r,matchUpsMap:n,roundNumber:a,structureId:o}){let{structure:s}=et({drawDefinition:r,structureId:o});if(!s)return{error:Mi};if(s.structureType===xn)return;n=n||sn({drawDefinition:r});let l=((n==null?void 0:n.mappedMatchUps)||{})[o].matchUps,{initialRoundNumber:u}=Tm({drawPosition:e,matchUps:l}),c=l==null?void 0:l.filter(p=>{var m;return p.roundNumber>=a&&p.roundNumber!==u&&((m=p.drawPositions)==null?void 0:m.includes(e))}),d=oi({drawDefinition:r,structureId:o}).positionAssignments??[];return c==null||c.forEach(p=>eq({drawPosition:e,targetMatchUp:p,inContextDrawMatchUps:t,positionAssignments:d,tournamentRecord:i,drawDefinition:r,matchUpsMap:n,structure:s})),{...J}}function eq({inContextDrawMatchUps:t,positionAssignments:e,tournamentRecord:i,drawDefinition:r,targetMatchUp:n,drawPosition:a,matchUpsMap:o,structure:s,event:l}){var U,T,D,P,E;let u="removeDrawPosition",c=(U=n.drawPositions)==null?void 0:U.slice(),d=n.matchUpStatus,p=n.winningSide;o=o??sn({drawDefinition:r});let m=o.mappedMatchUps[s.structureId].matchUps,{initialRoundNumber:h}=Tm({drawPosition:a,matchUps:m});if(n.roundNumber&&h&&n.roundNumber>h){let R=(n.drawPositions??[]).map(N=>N===a?void 0:N);n.drawPositions=R}if(n.matchUpType===hi){let R=(((T=t==null?void 0:t.find(N=>N.matchUpId===n.matchUpId))==null?void 0:T.sides)??[]).reduce((N,A,M)=>A.drawPosition===a?M:N,void 0);R!==void 0&&((P=(D=n.sides)==null?void 0:D[R])!=null&&P.lineUp)&&((E=n.sides)==null||delete E[R].lineUp,Rt({tournamentId:i==null?void 0:i.tournamentId,context:`${u}-TEAM`,eventId:l==null?void 0:l.eventId,matchUp:n,drawDefinition:r}))}let f=Cn({matchUpId:n.matchUpId,inContextDrawMatchUps:t,drawDefinition:r}),{targetLinks:{winnerTargetLink:g},targetMatchUps:{loserMatchUp:v,winnerMatchUp:y,loserMatchUpDrawPositionIndex:I}}=f,b=e.filter(({drawPosition:R})=>{var N;return(N=n.drawPositions)==null?void 0:N.includes(R)}).filter(R=>R.bye).length,S=b&&Vt||n.matchUpStatus&&[Mt,zt].includes(n.matchUpStatus)&&n.matcHUpStatus||Ji;n.matchUpStatus=S,n.matchUpStatus&&[zt,Mt].includes(n.matchUpStatus)&&(n.winningSide=void 0);let w=c==null?void 0:c.find(R=>{var N;return!((N=n.drawPositions)!=null&&N.includes(R))});if(c!=null&&c.includes(a)&&d===n.matchUpStatus&&p===n.winningSide||(w&&Aa({method:u,color:"brightyellow",removedDrawPosition:w}),Rt({tournamentId:i==null?void 0:i.tournamentId,context:`${u}-${a}`,eventId:l==null?void 0:l.eventId,matchUp:n,drawDefinition:r})),v&&v.structureId!==f.matchUp.structureId&&!b){let{drawPositions:R,roundNumber:N}=v;if(N===1){let A=R[I];BC({structureId:v.structureId,drawPosition:A,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:r,matchUpsMap:o})}else{let A=Math.min(...R.filter(Boolean)),M=jse({loserMatchUpDrawPosition:A,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:r,loserMatchUp:v,matchUpsMap:o,event:l});if(M.error)return ee({result:M,stack:u});let C=((o==null?void 0:o.mappedMatchUps)||{})[v.structureId].matchUps,{initialRoundNumber:O}=Tm({drawPosition:A,matchUps:C});O===1&&(Aa({method:u,color:"brightyellow",loserMatchUpDrawPosition:A}),BC({structureId:v.structureId,drawPosition:A,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:r,matchUpsMap:o}))}}return y&&y.structureId!==f.matchUp.structureId&&g.target.feedProfile,{...J}}function jse({loserMatchUpDrawPosition:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:r,loserMatchUp:n,matchUpsMap:a,event:o}){var u;let{structure:s}=et({structureId:n.structureId,drawDefinition:r}),{positionAssignments:l}=oi({structure:s});if((u=l==null?void 0:l.find(c=>c.drawPosition===t))!=null&&u.bye){let c=sb({drawPosition:t,structureId:n.structureId,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:r,matchUpsMap:a,event:o});if(c.error)return c}return{...J}}function Ip({drawDefinition:t,stages:e}){if(!t)return{error:_e};let i=((t==null?void 0:t.structures)??[]).filter(n=>!(e!=null&&e.length)||n.stage&&e.includes(n.stage)),r=ct(i.map(n=>{let{positionAssignments:a}=oi({structure:n});return a?a.map(Ut):[]}).flat().filter(Boolean));return{...J,assignedParticipantIds:r}}function bs(t){let e=((t==null?void 0:t.entries)??[]).filter(Boolean).reduce((r,n)=>{let{entryStage:a,entryStatus:o}=n,s=`_${a||Oe}${o||""}`;return r[s]||(r[s]=[]),r[s].push(n),r},{}),i=r=>isNaN(r)?1/0:r;return Object.keys(e).map(r=>e[r].sort((n,a)=>i(n.entryPosition)-i(a.entryPosition)).map((n,a)=>{let o=a+1;return{...n,entryPosition:o}})).flat()}function fd(t){return[fp,bo].includes(t)}function PS({autoEntryPositions:t=!0,ignoreAssignment:e,tournamentRecord:i,drawDefinition:r,participantIds:n,entryStatus:a,entryStage:o,extension:s,eventSync:l,drawId:u,stage:c,event:d}){var D,P,E,R,N,A,M,C,O,k,x,F;if(!n||!Array.isArray(n))return{error:Ts,method:"modifyEntriesStatus",participantIds:n};if(!r&&!d)return{error:gi};if(a&&!RW.includes(a))return{error:UC};if(o&&!sT.includes(o))return{error:up};let p="modifyEntriesStatus",m=[];if(!a&&!s)return ee({result:{error:Xe},info:"Missing entryStatus",stack:p});if(s&&!il({extension:s,requiredAttributes:["name"]}))return ee({result:{error:oe},info:"Invalid extension",context:{extension:s},stack:p});let h=[];(D=d==null?void 0:d.drawDefinitions)==null||D.forEach($=>{let _=Ip({stages:c&&[c],drawDefinition:$}).assignedParticipantIds??[];h.push(..._)});let f=(i==null?void 0:i.participants)??[];if(!n.every($=>{var L;let _=(L=Uc({tournamentParticipants:f,participantId:$}))==null?void 0:L.participantType;return!(_&&[ht,Vn].includes(_)&&fd(a))&&!(a&&(d!=null&&d.eventType)&&_===St&&[uo,Sa].includes(d.eventType)&&[jo,...MU].includes(a))}))return{error:UC};let g=d&&Gi({event:d}).flightProfile,v=(P=g==null?void 0:g.flights)==null?void 0:P.find($=>$.drawId===u),y=$=>{let _=($||[]).filter(B=>!c||!B.entryStage||c===B.entryStage).filter(({participantId:B})=>n.includes(B)),L=B=>a&&h.includes(B.participantId)&&!(MU.includes(B.entryStatus)&&MU.includes(a));return _.every(B=>L(B)&&!e?!1:(a&&(B.entryStatus=a,delete B.entryPosition),o&&(B.entryStage=o,delete B.entryPosition),s&&(s.value?Lt({element:B,extension:s}):Un({element:B,name:s.name})),!0))?{...J}:{error:Eg}},I=({flight:$,drawDefinition:_})=>{d&&(d.entries=bs({entries:d.entries??[]})),$&&($.drawEntries=bs({entries:$.drawEntries})),_&&(_.entries=bs({entries:_.entries}))},b=$=>{let{flight:_,drawDefinition:L}=$,B="updateDrawEntries";if(_){let V=y(_.drawEntries);if(V.error)return ee({result:V,stack:B})}if(L){let V=y(L.entries);if(V.error)return ee({result:V,stack:B});m.includes(L.drawId)||m.push(L.drawId)}return{...J}},S=((E=d==null?void 0:d.entries)==null?void 0:E.find(({entryPosition:$})=>$))??(((R=v==null?void 0:v.drawEntries)==null?void 0:R.find(({entryPosition:$})=>$))||((N=r==null?void 0:r.entries)==null?void 0:N.find(({entryPosition:$})=>$)));if(t&&!S&&I({flight:v,drawDefinition:r}),v||r){let $=b({flight:v,drawDefinition:r});if($.error)return ee({result:$,stack:p})}let w=((A=d==null?void 0:d.drawDefinitions)==null?void 0:A.map(({drawId:$})=>$))??[],U=((M=g==null?void 0:g.flights)==null?void 0:M.filter($=>!w.includes($.drawId)))||[];for(let $ of U){let _=$&&b({flight:$});if(_!=null&&_.error)return ee({result:_,stack:p})}let T=((C=g==null?void 0:g.flights)==null?void 0:C.length)===1&&(((O=d==null?void 0:d.drawDefinitions)==null?void 0:O.length)??0)<=((k=g==null?void 0:g.flights)==null?void 0:k.length);if(!v&&!r&&a&&PW.includes(a))return{error:uH};if(!v&&!r||a===Ru||l&&T){let $=y(d==null?void 0:d.entries);if($!=null&&$.error)return ee({result:$,stack:p});let _;if(a===Ru&&((x=g==null?void 0:g.flights)==null||x.every(L=>{let B=y(L.drawEntries);return B.error?(_=B.error,!1):(L.drawEntries=L.drawEntries.filter(({participantId:V})=>!n.includes(V)),!0)}),(F=d==null?void 0:d.drawDefinitions)==null||F.every(L=>{var V;let B=y(L.entries);return B.error?(_=B.error,!1):(L.entries=(V=L.entries)==null?void 0:V.filter(({participantId:G})=>!n.includes(G)),!0)})),_)return ee({result:{error:_},stack:p})}t&&I({flight:v,drawDefinition:r});for(let $ of(d==null?void 0:d.drawDefinitions)??[])m.length&&!m.includes($.drawId)||li({tournamentId:i.tournamentId,eventId:d==null?void 0:d.eventId,drawDefinition:$});return{...J}}function Cl({requireTimeStamp:t,scaleAttributes:e,participant:i}){var r,n;if(!i)return{error:zm};if(!Nt(e))return{error:oe};if(i.timeItems||(i.timeItems=[]),Array.isArray(i.timeItems)){let{accessor:a,scaleType:o,eventType:s,scaleName:l}=e,u=[xd,o,s,l].join("."),c=i.timeItems.filter(d=>(d==null?void 0:d.itemType)===u).filter(d=>!t||(d==null?void 0:d.itemDate)).sort((d,p)=>(d.createdAt?new Date(d.createdAt).getTime():0)-(p.createdAt?new Date(p.createdAt).getTime():0)).pop();if(c){let[d,p,m,h]=((r=c.itemType)==null?void 0:r.split("."))??[];if(d!==xd)return{error:gm};let f=((n=a&&Jp({element:c.itemValue,accessor:a}))==null?void 0:n.value)||c.itemValue,g={eventType:m,scaleDate:c.itemDate,scaleValue:f,scaleName:h,scaleType:p};return{...J,scaleItem:g}}}return{...J,scaleItem:void 0}}function Gse({publishedSeeding:t,usePublishState:e,withSeeding:i,participant:r,event:n}){var c,d,p;let a={},o=m=>[xd,Rl,n.eventType,m].join("."),s=Object.assign({},...(r.timeItems||[]).filter(({itemType:m})=>m.split(".")[1]===Rl).map(({itemType:m,itemValue:h})=>({[m]:h}))),l=((t==null?void 0:t.stageSeedingScaleNames)&&Object.values(t==null?void 0:t.stageSeedingScaleNames)||Array.isArray(t==null?void 0:t.seedingScaleNames)&&t.seedingScaleNames||[]).map(o),u=Vi(Object.keys(s),l);if((!e||!Object.keys(s).length&&!((c=t==null?void 0:t.drawIds)!=null&&c.length)||u.length)&&u.length){if(t!=null&&t.stageSeedingScaleNames){let m=Object.keys(t.stageSeedingScaleNames).map(f=>{let g=o(t.stageSeedingScaleNames[f]),v=s[g];return[f,v]}).filter(f=>f[1]).map(f=>({[f[0]]:{seedValue:f[1]}})),h=Object.assign({},...m);a.seedAssignments=h}else if(u){let m=u.map(h=>s[h]);a.seedValue=m.pop()}}else if(!e&&typeof i=="object"){let m=Object.keys(i).map(f=>{let g=o(i[f]),v=s[g];return[f,v]}).filter(f=>f[1]).map(f=>({[f[0]]:{seedValue:f[1]}})),h=Object.assign({},...m);a.seedAssignments=h}else{let{categoryName:m,ageCategoryCode:h}=n.category||{},f=[h,n.eventId,m].filter(Boolean),g;for(let v of f){let y={eventType:n.eventType,scaleType:Rl,scaleName:v},I=Cl({scaleAttributes:y,participant:r});if(I.scaleItem){g=I.scaleItem;break}}if(g&&(!e||t!=null&&t.published&&!((p=(d=t==null?void 0:t.published)==null?void 0:d.drawIds)!=null&&p.length))){let v=g.scaleValue;a.seedValue=v}}return a}function Hse({convertExtensions:t,seedAssignments:e,participant:i,withSeeding:r,seedValue:n,eventId:a,ranking:o,entry:s}){let{entryStatus:l,entryStage:u,entryPosition:c,extensions:d}=s,p=d!=null&&d.length&&t?Object.assign({},...WN(d??[])):{},m=Object.assign(p,{entryPosition:c,entryStatus:l,entryStage:u,ranking:o,eventId:a});i.events[a]=Ge(m,!1,!1,!0),r&&(e&&(i.events[a].seedAssignments=e),n&&(i.events[a].seedValue=n))}function tq(t){let{participantMap:e,participantId:i,matchUpStatus:r,roundPosition:n,structureId:a,matchUpType:o,roundNumber:s,matchUpId:l,potential:u,schedule:c,drawId:d,score:p}=t;!c||!Object.keys(c).length||r===Vt||e[i].scheduleItems.push({...c,scheduledDate:pt(c==null?void 0:c.scheduledDate),scheduledTime:bi(c==null?void 0:c.scheduledTime),checkScoreHasValue:Ir({score:p}),matchUpStatus:r,roundPosition:n,structureId:a,matchUpType:o,roundNumber:s,matchUpId:l,potential:u,drawId:d})}function lb(t){var a,o,s;let e=ze(t,[{[wr]:!0}]);if(e.error)return e;let{tournamentRecord:i,status:r=qa}=t,n=`${Yc}.${Kc}`;return Me((s=(o=(a=MT({tournamentRecord:i,itemType:n}))==null?void 0:a.timeItem)==null?void 0:o.itemValue)==null?void 0:s[r],!1,!0)}function zse(t){let{tournamentId:e}=t??{};return!!e}function Uo({event:t,status:e=qa}){var r,n,a;let i=`${Yc}.${Kc}`;return(a=(n=(r=Wy({itemType:i,event:t}))==null?void 0:r.timeItem)==null?void 0:n.itemValue)==null?void 0:a[e]}function WA({drawDetails:t,drawId:e}){var i,r;return(r=(i=t==null?void 0:t[e])==null?void 0:i.publishingDetail)==null?void 0:r.published}function sh(t){var d,p,m,h,f,g,v,y,I;let{tournamentRecord:e,drawDefinition:i,eventIds:r,eventId:n,drawIds:a,drawId:o,event:s}=t??{};if(e&&!zse(e))return{error:oe};if(n&&!s)return{error:lo};if(Array.isArray(r)&&(r!=null&&r.length)){let b={};for(let S of r){if(!Ti(S))return{error:oe};let w=(d=Wn({tournamentRecord:e,eventId:S}))==null?void 0:d.event;if(!w)return{error:lo};let U=hE({event:w});b[S]=U}return{...J,publishState:b}}if(s){let b=hE({event:s}),S={};if(o)return i?{publishState:{status:{published:!!((p=b.status.publishedDrawIds)!=null&&p.includes(o)),drawDetail:(m=b.status.drawDetails)==null?void 0:m[o]},...J}}:{error:xa};if(Array.isArray(a)&&(a!=null&&a.length)){let w=((h=s.drawDefinitions)==null?void 0:h.map(AI))??[];for(let U of a){if(!Ti(U))return{error:oe};if(!w.includes(U))return{error:xa};S[U]={status:{published:!!b.status.publishedDrawIds.includes(U),drawDetail:(f=b.status.drawDetails)==null?void 0:f[U]}}}}else S=b;return{...J,publishState:S}}let l=[],u=!1,c={};for(let b of(e==null?void 0:e.events)??[]){let S=hE({event:b});c[b.eventId]=S,S.status.published&&(l.push(b.eventId),u=!0);for(let{drawId:w}of b.drawDefinitions??[]){let U=(v=(g=S.status)==null?void 0:g.publishedDrawIds)==null?void 0:v.includes(w);U&&(c[w]={status:{published:U}})}}if(e){let b=lb({tournamentRecord:e});c.tournament=b??{},((y=b==null?void 0:b.orderOfPlay)!=null&&y.published||(I=b==null?void 0:b.participants)!=null&&I.published)&&(u=!0),c.tournament.status={published:u,publishedEventIds:l}}return{...J,publishState:c}}function hE({event:t}){var s;let e=Uo({event:t});if(!e)return{status:{published:!1}};let i={published:void 0,seedingScaleNames:[],drawIds:[]};e.seeding&&Object.assign(i,e.seeding);let r=e.drawDetails??{};for(let l of((s=t.drawDefinitions)==null?void 0:s.map(AI))||[])r[l]||(r[l]={publishingDetail:{published:!1}});let n=r&&Object.keys(r).length&&Object.keys(r).filter(l=>WA({drawDetails:r,drawId:l})),a=n!=null&&n.length?n:e.drawIds??[];if(a!=null&&a.length&&!(n!=null&&n.length))for(let l of a)r[l]={publishingDetail:{published:!0}};let o=(a==null?void 0:a.length)>0;return{status:{publishedDrawIds:a,publishedSeeding:i,drawDetails:r,published:o}}}function $T(t,e){return(t||"").localeCompare(e||"")}function Wse({finishingPositionRange:t={},participantMap:e,finishingRound:i,participantWon:r,matchUpStatus:n,participantId:a,stageSequence:o,roundNumber:s,structureId:l,matchUpId:u,drawId:c,stage:d}){let p=e[a],m=y=>Math.abs(y[0]-y[1]);p.structureParticipation[l]||(p.structureParticipation[l]={rankingStage:d,walkoverWinCount:0,defaultWinCount:0,stageSequence:o,winCount:0,structureId:l,drawId:c});let h=p.structureParticipation[l],{winner:f,loser:g}=t,v=r?f:g;r&&(h.winCount+=1,n===zt&&(h.walkoverWinCount+=1),n===Mt&&(h.defaultWinCount+=1)),v&&(!h.finishingPositionRange||m(v)<m(h.finishingPositionRange))&&(h.finishingPositionRange=v),i&&((!h.finishingRound||i<h.finishingRound)&&(h.finishingMatchUpId=u,h.finishingRound=i,h.roundNumber=s),i===1&&(h.participantWon=r))}function kB(t){var M,C,O,k,x,F,$,_,L,B;let{withScheduleItems:e,scheduleAnalysis:i,withTeamMatchUps:r,participantMap:n,withOpponents:a,withMatchUps:o,withEvents:s,withDraws:l,finishingPositionRange:u,finishingRound:c,matchUpStatus:d,stageSequence:p,roundNumber:m,structureId:h,score:f,stage:g,withRankingProfile:v,tieWinningSide:y,roundPosition:I,matchUpTieId:b,matchUpSides:S,collectionId:w,matchUpType:U,winningSide:T,matchUpId:D,schedule:P,eventId:E,drawId:R,sides:N}=t,A=a&&(N==null?void 0:N.length)===2&&Object.assign({},...N.map(({sideNumber:V},G)=>{let j=N[1-G].participantId;return V&&{[V]:j}}).filter(Boolean));for(let V of N){let{participantId:G,sideNumber:j,bye:z}=V;if(z)continue;let W=T===j,q=K=>{var ie,ae;let H=(ie=n[K])==null?void 0:ie.participant,Z=H==null?void 0:H.participantType,X=[{participantId:K,participantType:Z}];if(Z!==Vn)for(let le of(H==null?void 0:H.individualParticipantIds)||[]){let ne=(ae=n[le])==null?void 0:ae.participant;X.push({participantType:ne==null?void 0:ne.participantType,participantId:le})}return X},Y=(K,H)=>{if(o){if(n[K].matchUps[D]={participantWon:W,matchUpType:U,structureId:h,sideNumber:j,matchUpId:D,eventId:E,drawId:R,stage:g},a){let Z=q(H);n[K].matchUps[D].opponentParticipantInfo=Z}w&&(n[K].matchUps[D].collectionId=w)}a&&H&&(n[K].opponents[H]={participantId:H,matchUpId:D,eventId:E,drawId:R}),v&&Wse({finishingPositionRange:u,participantMap:n,participantWon:W,finishingRound:c,matchUpStatus:d,participantId:K,stageSequence:p,roundNumber:m,structureId:h,matchUpId:D,drawId:R,stage:g}),(i||e)&&tq({participantMap:n,participantId:K,matchUpStatus:d,roundPosition:I,matchUpType:U,roundNumber:m,structureId:h,matchUpId:D,schedule:P,drawId:R,score:f})},re=({participant:K,partnerParticipantId:H})=>{var X,ie,ae;let Z=(le,ne)=>{le&&(le.partnerParticipantIds||(le.partnerParticipantIds=[]),le.partnerParticipantIds.includes(ne)||le.partnerParticipantIds.push(ne))};l&&Z((X=K==null?void 0:K.draws)==null?void 0:X[R],H),s&&Z((ie=K==null?void 0:K.events)==null?void 0:ie[E],H),o&&Z((ae=K==null?void 0:K.matchUps)==null?void 0:ae[D],H)};if(G&&n[G]){let K=A==null?void 0:A[j];Y(G,K);let H=((M=n[G])==null?void 0:M.participant.participantType)===ht,Z=((C=n[G])==null?void 0:C.participant.individualParticipantIds)||[];if(b){if(r){let X=ie=>n[ie].matchUps[b]={participantWon:y===j,matchUpId:b,matchUpType:hi,sideNumber:j};X(G),Z.forEach(X)}if(l&&!n[G].draws[R]){let X=(k=(O=S.find(le=>le.sideNumber===j))==null?void 0:O.participant)==null?void 0:k.participantId,ie=($=(F=(x=n[X])==null?void 0:x.draws)==null?void 0:F[R])==null?void 0:$.entryStatus,ae=le=>n[le].draws[R]={entryStatus:ie,eventId:E,drawId:R};ae(G),Z.forEach(ae)}}if(H&&(Z.forEach(X=>n[X]&&Y(X,K)),Z.forEach((X,ie)=>{let ae=Z[1-ie],le=n[X];le&&re({participant:le,partnerParticipantId:ae})}),s&&S)){let X=(L=(_=S.find(ie=>ie.sideNumber===j))==null?void 0:_.participant)==null?void 0:L.participantId;if(X){let ie=(B=n[X])==null?void 0:B.events[E];ie?(n[G].events[E]={...ie},Z.forEach(ae=>n[ae].events[E]={...ie})):console.log("Missing teamEntry",{eventId:E,teamParticipantId:X})}}if(T){let X=ie=>{W?(n[ie].counters[U].wins+=1,n[ie].counters.wins+=1,d===zt&&(n[ie].counters[U].walkoverWins+=1,n[ie].counters.walkoverWins+=1),d===Mt&&(n[ie].counters[U].defaultWins+=1,n[ie].counters.defaultWins+=1)):(n[ie].counters[U].losses+=1,n[ie].counters.losses+=1,d===zt&&(n[ie].counters[U].walkovers+=1,n[ie].counters.walkovers+=1),d===Mt&&(n[ie].counters[U].defaults+=1,n[ie].counters.defaults+=1))};X(G),Z.forEach(X)}}}}function qse(t){var N,A,M,C,O,k,x;let{participantFilters:e,convertExtensions:i,policyDefinitions:r,tournamentRecord:n,usePublishState:a,participantMap:o,contextProfile:s,withPotentialMatchUps:l,withRankingProfile:u,withScheduleItems:c,scheduleAnalysis:d,withTeamMatchUps:p,withStatistics:m,withOpponents:h,withMatchUps:f,withSeeding:g,withEvents:v,withDraws:y}=t,I=e==null?void 0:e.participantIds,b=F=>{var _,L;let $=[F];return(L=(_=o[F])==null?void 0:_.participant.individualParticipantIds)==null||L.forEach(B=>$.push(B)),$.some(B=>!(I!=null&&I.length)||I.includes(B))?$:[]},S={withMatchUps:f||u,withEvents:v||u,withDraws:y||u,withPotentialMatchUps:l,withRankingProfile:u,withScheduleItems:c,scheduleAnalysis:d,withTeamMatchUps:p,withStatistics:m,participantMap:o,withOpponents:h,withSeeding:g},w=[],U={},T=[],D={},P={},E={},R=({eventType:F,scaleNames:$,participantId:_})=>{var L,B,V,G,j;return(j=(G=(V=(B=(L=o[_])==null?void 0:L.participant)==null?void 0:B.rankings)==null?void 0:V[F])==null?void 0:G.find(z=>$.includes(z.scaleName)))==null?void 0:j.scaleValue};for(let F of(n==null?void 0:n.events)||[]){if(e!=null&&e.eventIds&&!e.eventIds.includes(F.eventId))continue;let{drawDefinitions:$=[],extensions:_=[],eventType:L,eventName:B,category:V,entries:G,eventId:j,gender:z}=F,{flightProfile:W}=Gi({event:F}),q=(W==null?void 0:W.flights)??[],Y=sh({event:F}).publishState;Y&&(D[j]=Y);let re=(N=Y==null?void 0:Y.status)==null?void 0:N.publishedSeeding;if(v||g||u){let H=i?Object.assign({},...WN(_??[])):{};P[j]={...H,eventName:B,eventType:L,category:V,eventId:j,gender:z};let Z=[V==null?void 0:V.categoryName,V==null?void 0:V.ageCategoryCode].filter(Boolean);for(let X of G){let{participantId:ie}=X;if(!ie||!o[ie])continue;let ae=R({eventType:L,scaleNames:Z,participantId:ie}),le,ne;if(g){let ye=o[ie].participant;({seedAssignments:le,seedValue:ne}=Gse({publishedSeeding:re,usePublishState:a,withSeeding:g,participant:ye,event:F}))}let de=ye=>{var ke,Pe;if((Pe=(ke=o[ye])==null?void 0:ke.events)!=null&&Pe[j])return;let ce=o[ye];Hse({convertExtensions:i,seedAssignments:le,participant:ce,withSeeding:g,seedValue:ne,eventId:j,ranking:ae,entry:X})};de(ie),(o[ie].participant.individualParticipantIds||[]).forEach(de)}}let K=(A=D==null?void 0:D[j])==null?void 0:A.publishedSeeding;if(y||u||g){let H=X=>X?Object.assign({},...X.map(({participantId:ie,seedValue:ae,seedNumber:le})=>({[ie]:{seedValue:ae,seedNumber:le}}))):void 0,Z=ct([...$.map(AI),...q.map(AI)]);for(let X of Z){let ie=$.find(we=>we.drawId===X),ae=[V==null?void 0:V.categoryName,V==null?void 0:V.ageCategoryCode].filter(Boolean),{structures:le=[],drawOrder:ne,drawName:de,drawType:ye}=ie??{},ce=q==null?void 0:q.find(we=>we.drawId===X),ke=(ie==null?void 0:ie.entries)||(ce==null?void 0:ce.drawEntries),Pe=ce==null?void 0:ce.flightNumber,it=((ie==null?void 0:ie.structures)||[]).sort((we,Ue)=>Qm(we,Ue)).map(({structureId:we,structures:Ue})=>[we,...(Ue||[]).map(({structureId:wt})=>wt)]).flat(1/0),It,me,fe,pe,Fe=0,De=le.filter(({stage:we,stageSequence:Ue})=>we===Oe&&Ue===1||we===Ye).flatMap(we=>{let{positionAssignments:Ue}=oi({structure:we}),{seedAssignments:wt,stageSequence:Le,stage:rt}=we;return rt===Oe?(Fe=(Ue==null?void 0:Ue.length)??0,fe=Ue,pe=wt):Le===1&&(It=Ue,me=wt),Ue}).map(({participantId:we})=>we).filter(Boolean),je=H(pe),ue=H(me),he=ie?ke.filter(({participantId:we})=>De.includes(we)):ke,Re=!a||(K==null?void 0:K.published)&&(((M=K==null?void 0:K.drawIds)==null?void 0:M.length)===0||((C=K==null?void 0:K.drawIds)==null?void 0:C.includes(X)));for(let we of he){if(!o[we.participantId])continue;let{entryStatus:Ue,entryStage:wt,entryPosition:Le,participantId:rt}=we,Ei=R({participantId:rt,scaleNames:ae,eventType:L}),Be=nt=>{var yi,Fi,Ci,gn,gr;if(!o[nt]||(yi=o[nt].draws)!=null&&yi[X])return;let Ii=g&&Re,be=Ii?{}:void 0,Ct=Ii?((Fi=je==null?void 0:je[rt])==null?void 0:Fi.seedValue)||((Ci=je==null?void 0:je[rt])==null?void 0:Ci.seedNumber):void 0,Ce=Ct?je==null?void 0:je[rt]:void 0,qe=Ii?((gn=ue==null?void 0:ue[rt])==null?void 0:gn.seedValue)||((gr=ue==null?void 0:ue[rt])==null?void 0:gr.seedNumber):void 0,Ot=qe?ue==null?void 0:ue[rt]:void 0;be&&Ct&&(be[Oe]=Ce),be&&qe&&(be[Ye]=Ot);let di=Ct||qe;di&&(o[nt].participant.seedings[L]||(o[nt].participant.seedings[L]=[]),Ce&&o[nt].participant.seedings[L].push({...Ce,scaleName:X}),Ot&&o[nt].participant.seedings[L].push({...Ot,scaleName:X}),be&&(o[nt].events[j].seedAssignments||(o[nt].events[j].seedAssignments={}),Object.keys(be).forEach(Co=>o[nt].events[j].seedAssignments[Co]=be[Co]))),(y||u)&&(o[nt].draws[X]=Ge({seedAssignments:be,entryPosition:Le,entryStatus:Ue,entryStage:wt,seedValue:di,eventId:j,ranking:Ei,drawId:X},!1,!1,!0))};[bo,fp].includes(Ue)||(Be(rt),(O=o[rt].participant.individualParticipantIds||[])==null||O.forEach(Be))}let xe=((ie==null?void 0:ie.structures)??[]).reduce((we,Ue)=>(we.includes(Ue.stage)||we.push(Ue.stage),we),[]),Ee=((ie==null?void 0:ie.links)??[]).length;E[X]={qualifyingPositionAssignments:It,qualifyingSeedAssignments:me,mainPositionAssignments:fe,qualifyingSeedingMap:ue,mainSeedAssignments:pe,orderedStructureIds:it,mainSeedingMap:je,flightNumber:Pe,linksCount:Ee,drawOrder:ne,drawName:de,drawType:ye,drawSize:Fe,drawId:X,stages:xe}}}if(u||d||p||m||h||f||y){let H=!!d||l,Z=((k=tu({afterRecoveryTimes:!!d,policyDefinitions:r,tournamentRecord:n,inContext:!0,contextProfile:s,participantMap:o,nextMatchUps:H,event:F}))==null?void 0:k.matchUps)??[];for(let X of Z){let{finishingPositionRange:ie,potentialParticipants:ae,tieMatchUps:le=[],sides:ne=[],winningSide:de,matchUpType:ye,matchUpId:ce,eventId:ke,drawId:Pe,collectionId:it,stageSequence:It,finishingRound:me,matchUpStatus:fe,roundPosition:pe,roundNumber:Fe,structureId:De,schedule:je,score:ue,stage:he}=X;U[ce]=X;let Re={finishingPositionRange:ie,finishingRound:me,stageSequence:It,roundPosition:pe,collectionId:it,roundNumber:Fe,structureId:De,schedule:je,eventId:ke,drawId:Pe,score:ue,stage:he};kB({...Re,...S,matchUpStatus:fe,winningSide:de,matchUpType:ye,matchUpId:ce,sides:ne});for(let xe of le){let{winningSide:Ee,sides:we=[],matchUpId:Ue,matchUpStatus:wt,matchUpType:Le}=xe;kB({...Re,...S,winningSide:Ee,tieWinningSide:de,matchUpTieId:ce,matchUpId:Ue,sides:we,matchUpSides:ne,matchUpStatus:wt,matchUpType:Le})}Array.isArray(ae)&&(H||d||c)&&((x=ae.flat().map(Ut).filter(Boolean))==null||x.forEach(xe=>{var Ee;(Ee=b(xe))==null||Ee.forEach(we=>{o[we]&&(o[we].potentialMatchUps[ce]=Ge({tournamentId:n==null?void 0:n.tournamentId,matchUpId:ce,eventId:ke,drawId:Pe}))}),(d||c)&&tq({potential:!0,participantMap:o,participantId:xe,matchUpStatus:fe,roundPosition:pe,structureId:De,matchUpType:ye,roundNumber:Fe,matchUpId:ce,schedule:je,drawId:Pe,score:ue})}))}T.push(...Z)}}if(m||u||d){let F=Object.values(o);for(let $ of F){let{wins:_,losses:L,[ti]:{wins:B,losses:V},[Zt]:{wins:G,losses:j}}=$.counters,z=(W,q,Y)=>{let re=q+Y,K=q,H=re&&K/re;$.statistics[W]={denominator:re,numerator:K,statValue:H,statCode:W}};if(m&&(z(CU,_,L),z(`${CU}.${ti}`,B,V),z(`${CU}.${Zt}`,G,j)),u){let W=(q=[])=>Math.abs(q[0]-q[1]);for(let q of Object.keys($.draws)){let{orderedStructureIds:Y=[],flightNumber:re}=E[q]||{};if($.structureParticipation&&Y.length){let K,H=0,Z=Y.map(X=>{let ie=$.structureParticipation[X];if(!ie)return;K||(K=ie==null?void 0:ie.finishingPositionRange),W(K)>W(ie==null?void 0:ie.finishingPositionRange)&&(K=ie==null?void 0:ie.finishingPositionRange);let ae=ie.stage!==Ye;return ae&&(H+=1),Ge({...ie,participationOrder:ae?H:void 0,flightNumber:re})}).filter(Boolean);$.draws[q]&&($.draws[q].finishingPositionRange=K,$.draws[q].structureParticipation=Z)}}}if(d){let W=Nt(d)?d.scheduledMinutesDifference:0,q=$.scheduleItems||[],Y=$.potentialMatchUps||{},re=q.reduce((H,Z)=>{let{scheduledDate:X,scheduledTime:ie}=Z;return H[X]||(H[X]=[]),ie&&H[X].push(Z),H},{});Object.values(re).forEach(H=>H.sort(qH));for(let H of q){let{typeChangeTimeAfterRecovery:Z,timeAfterRecovery:X,scheduledDate:ie,scheduledTime:ae}=H,le=re[ie],ne=kt(ae);for(let de of le){if(de.matchUpId===H.matchUpId||[zt,Mt].includes(de.matchUpStatus)&&!de.checkScoreHasValue)continue;let ye=H.matchUpType!==de.matchUpType&&Z||X,ce=H.drawId===de.drawId,ke=Y[H.matchUpId]&&Y[de.matchUpId],Pe=kt(de.scheduledTime),it=Math.abs(Pe-ne),It=Pe>=ne;if((W&&!isNaN(W)?it<=W:It&&kt(de.scheduledTime)<kt(ye))&&!(ke&&ce)&&It){let me=[H.matchUpId,de.matchUpId].sort($T).join("|");$.scheduleConflicts[me]={priorScheduledMatchUpId:H.matchUpId,matchUpIdWithConflict:de.matchUpId}}}}let K=$.participant.participantId;Object.keys($.scheduleConflicts).length&&w.push(K),o[K].scheduleConflicts=$.scheduleConflicts}}}return{participantIdsWithConflicts:w,eventsPublishStatuses:D,derivedEventInfo:P,derivedDrawInfo:E,mappedMatchUps:U,participantMap:o,matchUps:T}}function ub({participantFilters:t={},tournamentRecord:e,participants:i=[]}){var b;if(!Object.keys(t).length)return i;let{accessorValues:r,drawEntryStatuses:n,positionedParticipants:a,eventEntryStatuses:o,participantRoles:s,participantRoleResponsibilities:l,participantTypes:u,participantIds:c,signInStatus:d,enableOrFiltering:p,eventIds:m,genders:h}=t,f=Ul(m)&&((b=e==null?void 0:e.events)==null?void 0:b.filter(S=>m==null?void 0:m.includes(S.eventId)))||(e==null?void 0:e.events)||[],g=n&&Yse({drawEntryStatuses:n,tournamentEvents:f}),v=o&&Kse({eventEntryStatuses:o,tournamentEvents:f}),y=a!==void 0&&[!0,!1].includes(a)&&f.reduce((S,w)=>S.concat(...(w.drawDefinitions||[]).map(U=>dW({drawDefinition:U}).allPositionedParticipantIds).filter(Boolean)),[]),I=S=>r==null?void 0:r.reduce((w,U)=>{let{accessor:T,value:D}=U,{values:P}=Jp({element:S,accessor:T});return w&&(P==null?void 0:P.includes(D))},!0);if(i=i==null?void 0:i.filter(S=>{var N,A;let w=(A=(N=yo({element:S,itemType:zy}))==null?void 0:N.timeItem)==null?void 0:A.itemValue,{participantRoleResponsibilities:U,participantType:T,participantRole:D,participantId:P,person:E}=S,R=Array.isArray(h)&&(h==null?void 0:h.length)&&(E==null?void 0:E.sex)&&h.includes(E.sex);return p?h&&R||a&&y.includes(P)||a===!1&&!y.includes(P)||(g==null?void 0:g.includes(P))||(v==null?void 0:v.includes(P))||(c==null?void 0:c.includes(P))||d&&w===d||u&&T&&Ul(u)&&u.includes(T)||s&&D&&Ul(s)&&s.includes(D)||l&&Ul(U)&&Ul(l)&&l.find(M=>U==null?void 0:U.includes(M))||(r==null?void 0:r.length)&&Ul(r)&&I(S):(!h||R)&&(a===void 0||a&&y.includes(P)||a===!1&&!y.includes(P))&&(!g||g.includes(P))&&(!v||v.includes(P))&&(!c||c.includes(P))&&(!d||w===d)&&(!u||T&&Ul(u)&&u.includes(T))&&(!s||D&&Ul(s)&&s.includes(D))&&(!l||Ul(U)&&Ul(l)&&l.find(M=>U==null?void 0:U.includes(M)))&&(!(r!=null&&r.length)||Ul(r)&&I(S))}),f.length&&m){let S=f.filter(w=>m.includes(w.eventId)).map(w=>{let U=(w.entries||[]).map(D=>D.participantId);if(Yi(el)(w.eventType))return U;let T=((e==null?void 0:e.participants)??[]).filter(D=>U.includes(D.participantId)).map(D=>D.individualParticipantIds).flat(1);return U.concat(...T)}).flat(1);i=i==null?void 0:i.filter(w=>S.includes(w.participantId))}return i}function Ul(t){return t&&Array.isArray(t)&&t.length}function Yse({drawEntryStatuses:t,tournamentEvents:e}){let i=({entryStatus:r})=>Array.isArray(t)?t.includes(r):!0;return ct(e.reduce((r,n)=>{var l,u;let{flightProfile:a}=Gi({event:n}),o=((l=a==null?void 0:a.flights)==null?void 0:l.map(({drawEntries:c})=>Array.isArray(c)?c.filter(i).map(Ut):[]).flat())||[],s=((u=n.drawDefinitions)==null?void 0:u.map(({entries:c})=>c?c.filter(i).map(Ut):[]))||[];return r.concat(...o,...s)},[]))}function Kse({eventEntryStatuses:t,tournamentEvents:e}){return ct(e.reduce((i,r)=>{let n=(r.entries||[]).filter(({entryStatus:a})=>Array.isArray(t)?t.includes(a):!0).map(Ut);return i.concat(...n)},[]))}function Ni(t){var B;let{withIndividualParticipants:e,participantFilters:i={},withPotentialMatchUps:r,withRankingProfile:n,convertExtensions:a,policyDefinitions:o,withScheduleItems:s,tournamentRecord:l,scheduleAnalysis:u,withSignInStatus:c,withTeamMatchUps:d,withScaleValues:p,usePublishState:m,contextProfile:h,withStatistics:f,withOpponents:g,withMatchUps:v,internalUse:y,withSeeding:I,withEvents:b,withDraws:S,withISO2:w,withIOC:U}=t;if(!l)return{error:ge};(v||n)&&us({tournamentRecord:l});let T=TW({convertExtensions:a,tournamentRecord:l,withSignInStatus:c,withScaleValues:p,internalUse:y,withISO2:w,withIOC:U}),{participantMap:D}=T,P=qse({withMatchUps:v??n,withEvents:b??n,withDraws:S??n,withPotentialMatchUps:r,participantFilters:i,withRankingProfile:n,convertExtensions:a,withScheduleItems:s,policyDefinitions:o,tournamentRecord:l,scheduleAnalysis:u,withTeamMatchUps:d,usePublishState:m,withStatistics:f,participantMap:D,withOpponents:g,contextProfile:h,withSeeding:I}),{participantIdsWithConflicts:E,eventsPublishStatuses:R,derivedEventInfo:N,derivedDrawInfo:A,mappedMatchUps:M}=P,C=P.matchUps;D=P.participantMap;let O=u??r,k=({potentialMatchUps:V,scheduleConflicts:G,scheduleItems:j,participant:z,statistics:W,opponents:q,matchUps:Y,events:re,draws:K})=>{let H=Object.values(K),Z=Object.values(q);return g&&(H==null||H.forEach(X=>{X.opponents=Z.filter(ie=>ie.drawId===X.drawId)})),Ge({...z,scheduleConflicts:u?Object.values(G):void 0,draws:S||n?H:void 0,events:b||n?Object.values(re):void 0,matchUps:v||n?Object.values(Y):void 0,opponents:g?Z:void 0,potentialMatchUps:O?Object.values(V):void 0,statistics:f?Object.values(W):void 0,scheduleItems:s?j:void 0},!1,!1,!0)},x=new Map;for(let V of Object.keys(D))x.set(V,k(D[V]));let F=[...x.values()],$=(B=o==null?void 0:o[By])==null?void 0:B.participant,_=ub({participants:F,participantFilters:i,tournamentRecord:l});if(e){let V=Nt(e)?e:void 0;for(let G of _)for(let j of G.individualParticipantIds??[]){G.individualParticipants||(G.individualParticipants=[]);let z=x.get(j),W=V?bm({template:V,source:z}):z;G.individualParticipants.push(W)}}let L=$?_.map(V=>bm({source:V,template:$})):_;return{participantMap:t.returnParticipantMap!==!1?D:void 0,mappedMatchUps:t.returnMatchUps!==!1?M:void 0,matchUps:t.returnMatchUps!==!1?C:void 0,missingParticipantIds:T.missingParticipantIds,participantIdsWithConflicts:E,eventsPublishStatuses:R,derivedEventInfo:N,derivedDrawInfo:A,participants:L,...J}}function Qp({participantId:t,drawDefinition:e,entryStatus:i,entryStage:r}){var a;if(!e)return{error:_e};let n=(a=e.entries)==null?void 0:a.find(o=>o.participantId===t&&(!i||i===o.entryStatus)&&(!r||r===o.entryStage));return t&&n}function Bg(t){var m,h,f,g,v,y,I,b,S;let{provisionalPositioning:e,drawDefinition:i,stageSequence:r,structureId:n,stage:a}=t;if(!i)return{error:_e};let{entryProfile:o}=Yy({drawDefinition:i}),s=a&&r&&((f=(h=(m=o==null?void 0:o[a])==null?void 0:m.stageSequence)==null?void 0:h[r])==null?void 0:f.qualifiersCount)||a&&((g=o==null?void 0:o[a])==null?void 0:g.qualifiersCount)||0,l={};if(!n)return{qualifiersCount:s,roundQualifiersCounts:l};let{structure:u}=et({drawDefinition:i,structureId:n}),c=(v=i.links)==null?void 0:v.filter(w=>{var U;return((U=w==null?void 0:w.target)==null?void 0:U.structureId)===(u==null?void 0:u.structureId)}),d=0;if(c!=null&&c.length)for(let w of c){let U=(y=et({structureId:w.source.structureId,drawDefinition:i}))==null?void 0:y.structure;if((U==null?void 0:U.stage)===Ye){let T=w.source.roundNumber,D=w.target.roundNumber,P=0;if(U.structureType===xn){let E=((I=U.structures)==null?void 0:I.length)??0,R=((b=w.source.finishingPositions)==null?void 0:b.length)??0;P=E*R}else P=((S=Wt({matchUpFilters:{roundNumbers:[T]},structure:U,afterRecoveryTimes:!1,provisionalPositioning:e,inContext:!1}).matchUps)==null?void 0:S.length)||0;l[D]||(l[D]=0),l[D]+=P,d+=P}}let p=Object.keys(l);if(p.length<=1){let w=p[0]||1;l[w]=Math.max(l[w]||0,s)}return d=Math.max(d,s),{qualifiersCount:d,roundQualifiersCounts:l}}function RS({stage:t,drawDefinition:e}){var r;let{entryProfile:i}=Yy({drawDefinition:e});return((r=i==null?void 0:i[t])==null?void 0:r.drawSize)||0}function Xse(t){let{provisionalPositioning:e,drawDefinition:i,stageSequence:r,stage:n}=t,a=RS({stage:n,drawDefinition:i}),{qualifiersCount:o}=Bg({provisionalPositioning:e,drawDefinition:i,stageSequence:r,stage:n});return a&&a-o}function iq({stage:t,drawDefinition:e}){return!!(t===Or||LA({stage:t,drawDefinition:e})&&RS({stage:t,drawDefinition:e}))}function rq({entryStatus:t=oa,drawDefinition:e,stageSequence:i,stage:r}){if(t===jo)return joe({stage:r,drawDefinition:e})?{positionsAvailable:1/0,...J}:{error:lH};let n=Xse({drawDefinition:e,stageSequence:i,stage:r}),a=Goe({drawDefinition:e,stage:r}),o=kC({entryStatus:_f,drawDefinition:e,stage:r}),s=kC({entryStatus:oa,drawDefinition:e,stage:r}),l=o+s,u=l>=n,c=n-l;return r!==Or&&u?{error:SC}:t===_f?o<a?{...J}:{error:SC}:{positionsAvailable:c,...J}}function qA(t){let e=ze(t,[{[Fn]:!0,[Vz]:!0}]);if(e.error)return e;let{suppressDuplicateEntries:i=!0,entryStatus:r=oa,entryStageSequence:n,entryStage:a=Oe,ignoreStageSpace:o,drawDefinition:s,entryPosition:l,participant:u,roundTarget:c,extensions:d,extension:p,drawType:m,event:h}=t,f="addDrawEntry";if(m!==La&&!iq({stage:a,drawDefinition:s}))return ee({result:{error:up},stack:f});let g=rq({stageSequence:n,stage:a,drawDefinition:s,entryStatus:r});if(!o&&!g.success&&(!m||m!==La))return{error:g.error};if(p&&!il({extension:p}))return ee({result:{error:oe},info:"Invalid extension",context:{extension:p},stack:f});let v=t.participantId||(u==null?void 0:u.participantId);if(!v)return ee({result:{error:pr},stack:f});let y=r===Pu&&Qp({participantId:v,drawDefinition:s,entryStatus:r}),I=a===Or&&Qp({participantId:v,drawDefinition:s,entryStage:a}),b=Qp({participantId:v,drawDefinition:s}),S=r!==Pu&&a!==Or&&b;if(S)return i?(lt({payload:{drawId:s.drawId,eventId:h==null?void 0:h.eventId,error:II,participantId:v},topic:yA}),{...J}):ee({result:{error:II},context:{participantId:v},stack:f});if(y||I)return ee({context:{invalidEntry:S,invalidLuckyLoser:y,invalidVoluntaryConsolation:I},result:{error:Y0},stack:f});let w=Ge({entryStageSequence:n,participantId:v,entryPosition:l,entryStatus:r,entryStage:a,extensions:d});return p&&Lt({element:w,extension:p}),c&&Lt({extension:{name:"roundEntry",value:c},element:w}),s.entries||(s.entries=[]),s.entries.push(w),li({drawDefinition:s}),{...J}}function Jse(t){let e="addDrawEntries",{suppressDuplicateEntries:i=!0,entryStatus:r=oa,autoEntryPositions:n=!0,ignoreStageSpace:a,participantIds:o,drawDefinition:s,stageSequence:l,stage:u=Oe,roundTarget:c,extension:d,event:p}=t;if(!u)return{error:BG};if(!s)return{error:_e};if(!Array.isArray(o))return{error:va};if(!iq({stage:u,drawDefinition:s}))return{error:up};if(d&&!il({extension:d}))return ee({result:{error:oe},info:"Invalid extension",context:{extension:d},stack:e});let m=rq({drawDefinition:s,stageSequence:l,entryStatus:r,stage:u});if(!a&&!m.success)return{error:m.error};let h=m.positionsAvailable??0;if(!a&&u!==Or&&h<o.length)return{error:DN};let f=[],g=s.drawId,v=p==null?void 0:p.eventId,y=o.reduce((I,b)=>{let S=r===Pu&&Qp({participantId:b,drawDefinition:s,entryStatus:r}),w=u===Or&&Qp({entryStage:u,drawDefinition:s,participantId:b}),U=Qp({participantId:b,drawDefinition:s});return r!==Pu&&u!==Or&&U&&(f.push(b),i&&lt({payload:{error:II,participantId:b,eventId:v,drawId:g},topic:yA})),S||w?I.concat(b):I},[]);return f.length&&!i?ee({context:{eventId:v,drawId:g,duplicateEntries:f},result:{error:II},stack:e}):(o.filter(I=>I&&!y.includes(I)).forEach(I=>{let b={entryStageSequence:l,entryStage:u,participantId:I,entryStatus:r};d&&Lt({element:b,extension:d}),c&&Lt({extension:{name:gl,value:c},element:b}),s.entries||(s.entries=[]),s.entries.push(b)}),n&&(s.entries=bs({entries:s.entries})),li({drawDefinition:s}),y!=null&&y.length||f!=null&&f.length?{info:"some participantIds could not be added",participantIdsNotAdded:y,duplicateEntries:f,...J}:{...J})}function YA({suppressDuplicateEntries:t=!0,autoEntryPositions:e=!0,entryStageSequence:i,ignoreStageSpace:r,participantIds:n,drawDefinition:a,entryStatus:o,roundTarget:s,entryStage:l,extension:u,drawId:c,event:d}){if(!(n!=null&&n.length))return{error:Vc};if(!d)return{error:lo};if(!c)return{error:xs};let p=(d.entries||[]).map(Ut);if(n.filter(f=>!p.includes(f)).length)return{error:_G};if(a){let f=Jse({stageSequence:i,suppressDuplicateEntries:t,autoEntryPositions:e,stage:l,ignoreStageSpace:r,participantIds:n,drawDefinition:a,entryStatus:o,roundTarget:s,extension:u});if(f.error)return f}let{flightProfile:m}=Gi({event:d}),h=m==null?void 0:m.flights.find(f=>f.drawId===c);return h!=null&&h.drawEntries&&(n.forEach(f=>{let g=o===Pu&&fE({participantId:f,entryStatus:o,flight:h}),v=l===Or&&fE({participantId:f,entryStage:l,flight:h});!(o!==Pu&&l!==Or&&fE({flight:h,participantId:f}))&&!g&&!v&&h.drawEntries.push({participantId:f,entryStatus:o,entryStage:l})}),e&&(h.drawEntries=bs({entries:h.drawEntries}))),{...J}}function fE({participantId:t,entryStatus:e,entryStage:i,flight:r}){var a;let n=(a=r.drawEntries)==null?void 0:a.find(o=>o.participantId===t&&(!e||e===o.entryStatus)&&(!i||i===o.entryStage));return t&&n}function cb({autoEntryPositions:t=!0,participantIds:e=[],entryStatuses:i,stage:r,event:n}){var d,p,m,h;let a="removeEventEntries";if(!(n!=null&&n.eventId))return{error:gi};if(!Array.isArray(e)||e.some(f=>!Ti(f)))return ee({result:{error:Ts},stack:a});let o=(n.drawDefinitions??[]).flatMap(f=>Ip({drawDefinition:f}).assignedParticipantIds??[]),s=((i==null?void 0:i.length)&&((d=n.entries)==null?void 0:d.filter(f=>f.entryStatus&&i.includes(f.entryStatus)))||[]).map(Ut).filter(f=>!o.includes(f)),l=(r&&((p=n.entries)==null?void 0:p.filter(f=>f.entryStage&&f.entryStage===r))||[]).map(Ut).filter(f=>!o.includes(f));if(e.length?e=e.filter(f=>(!(i!=null&&i.length)||s.includes(f))&&(!r||l.includes(f))):s.length&&l.length?e=Vi(s,l):s.length?e=s:l.length&&(e=l),(e==null?void 0:e.length)&&o.some(f=>e.includes(f)))return ee({result:{error:Eg},stack:a});if(!(e!=null&&e.length))return{...J,participantIdsRemoved:[]};let u=[];n.entries=(n.entries??[]).filter(f=>{let g=!e.includes(f==null?void 0:f.participantId);return g||u.push(f.participantId),g}),t&&(n.entries=bs({entries:n.entries}));let{flightProfile:c}=Gi({event:n});return(m=c==null?void 0:c.flights)==null||m.forEach(f=>{f.drawEntries=(f.drawEntries||[]).filter(g=>!e.includes(g.participantId))}),(h=n.drawDefinitions)==null||h.forEach(f=>{f.entries=(f.entries??[]).filter(g=>!e.includes(g.participantId))}),{...J,participantIdsRemoved:u}}var nq={[kr]:{policyName:"matchUpActionsDefault",enabledStructures:[{stages:[],stageSequences:[],enabledActions:[],disabledActions:[]}],participants:{enforceCategory:!0,enforceGender:!0},processCodes:{substitution:["RANKING.IGNORE","RATING.IGNORE"]},substituteAfterCompleted:!1,substituteWithoutScore:!1}},Vg=nq;function zs(t){var M,C;let{suppressDuplicateEntries:e=!0,entryStatus:i=oa,autoEntryPositions:r=!0,enforceGender:n=!0,entryStageSequence:a,policyDefinitions:o,entryStage:s=Oe,tournamentRecord:l,ignoreStageSpace:u,drawDefinition:c,roundTarget:d,extensions:p,extension:m,drawId:h,event:f}=t,g="addEventEntries";if(!Array.isArray(t.participantIds))return ee({result:{error:va},stack:g});let v=ct(t.participantIds??[]);if(!f)return{error:gi};if(!(v!=null&&v.length))return ee({result:{error:Vc},stack:g});if(!(f!=null&&f.eventId))return{error:lo};let y=$t({tournamentRecord:l,event:f}).appliedPolicies??{},I=(o==null?void 0:o[kr])??(y==null?void 0:y[kr])??Vg[kr],b=(n??((M=I==null?void 0:I.participants)==null?void 0:M.enforceGender))!==!1,S=[],w=[];if(p&&(!Array.isArray(p)||!p.every(O=>il({extension:O})))||m&&!il({extension:m}))return ee({context:Ge({extension:m,extensions:p}),result:{error:oe},info:"Invalid extension(s)",stack:g});let U=!!l,T=[],D,P=((C=l==null?void 0:l.participants)==null?void 0:C.filter(O=>{var F,$,_;if(!v.includes(O.participantId))return!1;let k=Yi(ti)(f.eventType)&&O.participantType===St&&!fd(i),x=f.eventType===Zt&&O.participantType===ht;return k&&(!f.gender||!b||[Bn,Ps].includes(f.gender)||f.gender===((F=O.person)==null?void 0:F.sex))||x&&!fd(i)||f.eventType===Zt&&O.participantType===St&&fd(i)?!0:k&&f.gender&&b&&![Bn,Ps].includes(f.gender)&&f.gender!==(($=O.person)==null?void 0:$.sex)?(T.push({participantId:O.participantId,sex:(_=O.person)==null?void 0:_.sex}),!1):f.eventType===Kt&&(O.participantType===Kt||fd(i)&&O.participantType===St)}).map(O=>O.participantId))??[],E=v.filter(O=>!U||P.includes(O));f.entries||(f.entries=[]);let R=f.entries.map(O=>{var k;return O.participantId||((k=O.participant)==null?void 0:k.participantId)});if(E.forEach(O=>{var k;if(!R.includes(O)){let x=Ge({participantId:O,entryStatus:i,entryStage:s,extensions:p});m&&Lt({element:x,extension:m}),d&&Lt({extension:{name:gl,value:d},element:x}),a&&(x.entryStageSequence=a),S.push(x.participantId),(k=f.entries)==null||k.push(x)}}),h&&!fd(s)){let O=YA({participantIds:E,suppressDuplicateEntries:e,autoEntryPositions:r,entryStageSequence:a,ignoreStageSpace:u,drawDefinition:c,entryStatus:i,roundTarget:d,entryStage:s,extension:m,drawId:h,event:f});O.error&&(D=O.error)}if(f.eventType&&[wu,Sa].includes(f.eventType)){let O=(f.entries||[]).map($=>$.participantId),k=(f.entries||[]).filter($=>fd($.entryStatus)).map($=>$.participantId),x=((l==null?void 0:l.participants)??[]).filter($=>O.includes($.participantId)&&$.participantType&&[ht,Kt].includes($.participantType)).map($=>$.individualParticipantIds).flat(1/0),F=k.filter($=>x.includes($));F.length&&(w.push(...F),cb({participantIds:F,autoEntryPositions:!1,event:f}))}if(E.length!==v.length)return ee({context:{mismatchedGender:T,gender:f.gender},result:{error:va},stack:g});r&&(f.entries=bs({entries:f.entries||[]}));let N=S.length,A=w.length;return ee({result:{...J,addedEntriesCount:N,removedEntriesCount:A},stack:g,info:D})}var aq="ADMINISTRATION",Qse="CAPTAIN",Zse="COACH",Qr="COMPETITOR",oq="MEDIA",sq="MEDICAL",KA="OFFICIAL",lq="OTHER",uq="SECURITY",XA={ADMINISTRATION:aq,CAPTAIN:Qse,COACH:Zse,COMPETITOR:Qr,MEDIA:oq,MEDICAL:sq,OFFICIAL:KA,OTHER:lq,SECURITY:uq};function JA({addIndividualParticipantsToEvents:t,individualParticipantIds:e,groupingParticipantId:i,tournamentRecord:r,suppressErrors:n}){let a="removeIndividualParticipantIds";if(!r)return ee({result:{error:ge},stack:a});if(!i||!e)return ee({result:{error:Xe},stack:a});let o=(r.participants??[]).find(c=>c.participantId===i);if(!o)return ee({result:{error:zi},stack:a});if(![Kt,Wa].includes(o.participantType))return ee({result:{participantType:o.participantType,error:Ds},stack:a});let s=cq({individualParticipantIds:e,groupingParticipant:o,tournamentRecord:r,suppressErrors:n}),{removed:l,error:u}=s;if(u)return ee({result:s,stack:a});if(t)for(let c of r.events??[]){let d=(c.entries??[]).map(({participantId:p})=>p).filter(Boolean);if(d.includes(i)){let p=l==null?void 0:l.filter(m=>!d.includes(m));zs({participantIds:p,entryStatus:bo,tournamentRecord:r,event:c})}}return l&&lt({topic:nn,payload:{tournamentId:r.tournamentId,participants:[o]}}),{...J,...s}}function cq({individualParticipantIds:t=[],groupingParticipant:e,tournamentRecord:i,suppressErrors:r,mappedMatchUps:n,participants:a}){var p,m;let o=[];if(!e)return{removed:o};let s=[],l=[];a||({participants:a,mappedMatchUps:n}=Ni({withMatchUps:!0,tournamentRecord:i,withEvents:!0}));let u=(m=(p=a==null?void 0:a.find(({participantId:h})=>h===e.participantId))==null?void 0:p.events)==null?void 0:m.map(({eventId:h})=>h),c=(e.individualParticipantIds??[]).filter(h=>{var y;let f=t==null?void 0:t.includes(h),g=f&&((y=a==null?void 0:a.find(I=>I.participantId===h))==null?void 0:y.matchUps.filter(({eventId:I})=>u.includes(I)).map(({matchUpId:I})=>n==null?void 0:n[I]).filter(({winningSide:I,score:b})=>I||Ir({score:b}))),v=f&&!(g!=null&&g.length);if(f&&!v&&l.push(h),v){o.push(h);for(let I of i.events??[])for(let b of I.drawDefinitions??[]){let{extension:S}=gt({element:b,name:Tu}),w=S==null?void 0:S.value[e.participantId];S&&w&&(S.value[e.participantId]=w.filter(T=>T.participantId!==h),Lt({element:b,extension:S}),Hy({drawDefinition:b}));let U=Sn({drawDefinition:b,inContext:!1}).matchUps??[];for(let T of U){let D=T.sides??[];for(let P of D){let E=P.lineUp??[];E.find(R=>R.participantId===h)&&(P.lineUp=E.filter(R=>R.participantId!==h),Rt({tournamentId:i==null?void 0:i.tournamentId,drawDefinition:b,matchUp:T}))}}}}else s.push(h);return!v});e.individualParticipantIds=c;let d={groupingParticipantId:e.participantId,cannotRemove:l,notRemoved:s,removed:o};return l.length&&!r&&{...d,cannotRemove:l,error:W0}||d}function BT({participantRole:t=Qr,individualParticipantIds:e=[],groupingTypes:i=[Vn,Wa],tournamentRecord:r}){if(!r)return{error:ge};let n=r.participants??[],{participants:a,mappedMatchUps:o}=Ni({withMatchUps:!0,tournamentRecord:r,withEvents:!0}),s=0;return n.filter(l=>(l.participantRole===t||!l.participantRole)&&l.participantType&&i.includes(l.participantType)).forEach(l=>{let{removed:u}=cq({groupingParticipant:l,individualParticipantIds:e,tournamentRecord:r,mappedMatchUps:o,participants:a});u&&s++}),s?J:{error:rH}}function lh(t){var h,f;let e=ze(t,[{[wr]:!0},{participantIds:!0,[Xn]:un,[Vo]:Vc}]);if(e.error)return e;let{addIndividualParticipantsToEvents:i,tournamentRecord:r,participantIds:n}=t,a=((h=r.participants)==null?void 0:h.length)||0;if(!a)return{...J};let o=(f=r.events||[])==null?void 0:f.filter(({eventType:g})=>g===sr).map(g=>{var v;return(v=g==null?void 0:g.drawDefinitions)==null?void 0:v.map(({drawId:y})=>y)}).flat(1/0),s=Ni({participantFilters:{participantIds:n},tournamentRecord:r,withDraws:!0}).participants??[],l=g=>{let v=(Vr({matchUpFilters:{drawIds:g,matchUpTypes:[Zt]},tournamentRecord:r}).matchUps??[]).flatMap(({sides:y})=>y==null?void 0:y.map(({participantId:I})=>I||[])).filter(Boolean);return Vi(v,n)},u=o!=null&&o.length?l(o):[],c=s.filter(g=>{var v;return(v=g.draws)==null?void 0:v.filter(y=>(!(o!=null&&o.length)||!(o!=null&&o.includes(y.drawId)))&&y.positionAssignments).length});if(u!=null&&u.length||c.length)return{error:Eg};let d={},p={};for(let g of r.events||[]){let v=cb({participantIds:n,event:g});if(v.error)return v;d[g.eventId]=v.participantIdsRemoved}r.participants=(r.participants??[]).filter(g=>{var y,I;let v=n.includes(g.participantId)||g.participantType===ht&&((y=g.individualParticipantIds)==null?void 0:y.some(b=>n.includes(b)));if(!v&&g.participantType===sr&&((I=g.individualParticipantIds)!=null&&I.some(b=>n.includes(b)))&&(g.individualParticipantIds=g.individualParticipantIds.filter(b=>!n.includes(b))),v&&i&&g.participantType&&[ht,Kt].includes(g.participantType))for(let b of g.individualParticipantIds||[])n.includes(b)||(p[g.participantId]||(p[g.participantId]=[]),p[g.participantId].push(b));return!v});let m=a-r.participants.length;if(BT({individualParticipantIds:n,tournamentRecord:r}),i)for(let g of r.events||[]){let v=d[g.eventId].map(y=>p[y]||[]).flat();zs({participantIds:v,entryStatus:bo,tournamentRecord:r,event:g})}return m&&lt({payload:{participantIds:n,tournamentId:r.tournamentId},topic:bA}),m?{...J,participantsRemovedCount:m}:{error:W0}}function dq({selected:t=!0,drawDefinition:e,entryStatuses:i,drawId:r,event:n,stage:a}){var l;let o=n.entries??[];if(r){let{flightProfile:u}=Gi({event:n}),c=(l=u==null?void 0:u.flights)==null?void 0:l.find(d=>d.drawId===r);c?o=c.drawEntries:e.entries&&(o=e==null?void 0:e.entries)}let s=o.filter(u=>(!(i!=null&&i.length)||!u.entryStatus||i.includes(u.entryStatus))&&(!a||!u.entryStage||u.entryStage===a)&&(!t||u.entryStatus&&ls.includes(u.entryStatus)));return{entries:o,stageEntries:s}}function pq({removeGroupParticipant:t,tournamentRecord:e,drawDefinition:i,participantId:r,drawId:n,stage:a,event:o}){var v;let s="destroyGroupEntry";if(!e)return{error:ge};if(!r)return ee({result:{error:pr},stack:s});if(!o)return{error:gi};if(!o.eventType||![wu,Sa].includes(o.eventType))return ee({result:{error:Bl},stack:s});let l=e.participants??[],u=l.find(y=>y.participantId===r);if(!u)return ee({result:{error:zi},stack:s});if(!u.participantType||![ht,Vn].includes(u.participantType)||u.participantType===Vn&&o.eventType!==Sa||u.participantType===ht&&o.eventType!==wu)return{error:Ds};let c=(o.entries??[]).find(y=>y.participantId===r);if(!c)return{error:sH};let{stageEntries:d}=dq({selected:!1,drawDefinition:i,drawId:n,event:o,stage:a}),p=d.map(Ut),m=l.filter(({participantId:y})=>p.includes(y)).map(({individualParticipantIds:y})=>y).flat().filter(Boolean),h=(v=u.individualParticipantIds)==null?void 0:v.filter(y=>Gs(y,m).length===1),f=cb({participantIds:[r],event:o});if(f.error||h!=null&&h.length&&(f=zs({participantIds:h,entryStatus:bo,entryStage:c.entryStage,tournamentRecord:e,drawDefinition:i,drawId:n,event:o}),f.error))return f;let g;return t&&lh({participantIds:[r],tournamentRecord:e}).success&&(g=!0),{...J,participantRemoved:g}}function QA({removeGroupParticipant:t,tournamentRecord:e,drawDefinition:i,participantId:r,drawId:n,event:a}){return pq({removeGroupParticipant:t,tournamentRecord:e,drawDefinition:i,participantId:r,drawId:n,event:a})}function mq(t){if(!t.tournamentRecord)return{error:ge};let{participantIds:e,...i}=t,r=0,n=[];for(let a of e){let o=pq({participantId:a,...i});o.success&&(r+=1),o.error&&n.push(o.error)}return r?{destroyedCount:r,...J}:{error:n}}function FI(t){let{tournamentRecord:e,replaceWithBye:i,drawDefinition:r,destroyPair:n,entryStatus:a,matchUpsMap:o,drawId:s}=t,l="removeDrawPositionAssignment",u=sb(t);if(u.error)return ee({result:u,stack:l});let{participantId:c}=u,{drawPosition:d,event:p,structureId:m}=t,h=$t({tournamentRecord:e,drawDefinition:r,event:p}).appliedPolicies??{};if([jo,Ru].includes(a)&&c){let{tournamentRecord:g}=t,{participant:v}=qc({tournamentRecord:g,participantId:c}),{participantType:y,individualParticipantIds:I}=v??{};if(n&&y===ht){let b=QA({tournamentRecord:g,drawDefinition:r,participantId:c,event:p});if(b.error)return ee({result:b,stack:l});I&&PS({participantIds:I,tournamentRecord:g,drawDefinition:r,entryStatus:a,drawId:s,event:p})}else PS({participantIds:[c],tournamentRecord:g,drawDefinition:r,entryStatus:a,drawId:s,event:p})}if(i){let g=Ya({tournamentRecord:e,drawDefinition:r,drawPosition:d,structureId:m,matchUpsMap:o,event:p});if(g.error)return ee({result:g,stack:l})}let{structure:f}=et({drawDefinition:r,structureId:m});return NA({structure:f,drawPositions:[d]}),RT({appliedPolicies:h,drawDefinition:r,positionAction:{name:"removeDrawPositionAssignment",replaceWithBye:i,drawPosition:d,entryStatus:a,structureId:m}}),u}function hq(t){return Object.assign(t,{entryStatus:Ru}),FI(t)}function VC(t){return Ti(t)?t.split(" ").map(e=>e.split("").map((i,r)=>r?i.toLowerCase():i.toUpperCase()).join("")).join(" "):t}function Zr(t){return Ti(t)?VC(t.replace(/_/g," ")):""}var vc=({finishingPosition:t=Xm,qualifyingRoundNumber:e,structureAbbreviation:i,seedAssignments:r=[],stageSequence:n=1,structureOrder:a,seedingProfile:o,matchUpFormat:s,structureType:l,structureName:u,matchUpType:c,matchUps:d=[],structureId:p,roundOffset:m,roundLimit:h,stageOrder:f,structures:g,stage:v})=>{let y={structureId:p??Gt(),structureAbbreviation:i,finishingPosition:t,seedAssignments:r,matchUpFormat:s,stageSequence:n,structureName:u};a&&(y.structureOrder=a),l&&(y.structureType=l),o&&(typeof o=="string"?y.seedingProfile=o:typeof o=="object"&&typeof o.positioning=="string"&&(y.seedingProfile=o.positioning)),c&&(y.matchUpType=c),m&&(y.roundOffset=m),f&&(y.stageOrder=f),h&&(y.roundLimit=h),v&&(y.stage=v),e&&(y.qualifyingRoundNumber=e);let I=d.flatMap(({drawPositions:b})=>b).filter(Boolean);return g?y.structures=g:(y.matchUps=d,y.positionAssignments=ct(I).sort((b,S)=>b-S).map(b=>({drawPosition:b}))),y},ao=vc;function ZA({structureName:t=Zr(Or),structureAbbreviation:e,drawDefinition:i,matchUpType:r,structureId:n}){if(!i)return{error:_e};let a=ao({stage:Or,structureAbbreviation:e,structureName:t,matchUps:[],structureId:n,matchUpType:r});return i.structures||(i.structures=[]),i.structures.push(a),li({drawDefinition:i,structureIds:[a.structureId]}),{...J}}function eO({drawPositions:t}){if(!(t!=null&&t.length))return{error:Ry};let e=n=>t.filter(a=>a!==n).map(a=>[n,a]),i=[].concat(...(t??[]).map(e)),r=ct(i.map(VT)).map(n=>n.split("|").map(a=>+a));return{groupMatchUps:i,uniqueMatchUpGroupings:r}}function VT(t=[]){return!Array.isArray(t)||!t.length?"":[...t].sort(or).join("|")}function fq({groupSize:t,drawPositionOffset:e}){if(!t)return[];let i=d=>[...Array(d)].map((p,m)=>m),r=i(2*Math.round(t/2)+1).slice(1),n=i(r.length-1).map(()=>[]),a=r.slice(0,r.length/2),o=r.slice(r.length/2);r.slice(1).forEach((d,p)=>{a.forEach((g,v)=>{n[p].push([a[v],o[v]])});let m=a.shift(),h=a.pop(),f=o.shift();a=[m,f,...a].filter(Boolean),o=[...o,h].filter(Boolean)});let s=a.shift(),l=a.pop(),u=o.shift();a=[s,u,...a].filter(Boolean),o=[...o,l].filter(Boolean);let c=d=>d[0].reduce((p,m)=>p+m);return[...n].reverse().sort((d,p)=>c(d)-c(p)).map(d=>d.filter(p=>p.every(m=>m<=t)).map(p=>{let m=p.map(h=>h+e);return VT(m)}))}function ele({rounds:t,hash:e}){return t!=null&&t.length?t==null?void 0:t.reduce((i,r,n)=>r.includes(e)?n+1:i,void 0):{error:Xe}}var tle={getRoundRobinGroupMatchUps:eO,determineRoundNumber:ele,drawPositionsHash:VT,groupRounds:fq};function db(t){var U;let{groupNameBase:e="Group",playoffAttributes:i,stageSequence:r=1,structureOptions:n,appliedPolicies:a,seedingProfile:o,stage:s=Oe,matchUpType:l,roundTarget:u,structureId:c,groupNames:d,drawSize:p,idPrefix:m,isMock:h,uuids:f}=t,g=t.structureName??((U=i==null?void 0:i["0"])==null?void 0:U.name)??Zr(Oe),{groupCount:v,groupSize:y}=ile({structureOptions:n,appliedPolicies:a,drawSize:p}),I=kd,b,S=Se(1,v+1).map(T=>{let D=rle({groupSize:y,structureOrder:T,matchUpType:l,drawSize:p,idPrefix:m,isMock:h});b=Array.isArray(D)?Math.max(...D.map(({roundNumber:E})=>E??0)):0;let P=(d==null?void 0:d[T-1])??`${e} ${T}`;return vc({structureId:f==null?void 0:f.pop(),structureType:lT,finishingPosition:I,structureOrder:T,structureName:P,matchUps:D})}),w=vc({structureId:c??(f==null?void 0:f.pop()),structureType:xn,finishingPosition:I,seedingProfile:o,structureName:g,stageSequence:r,structures:S,stage:s});return u&&Lt({extension:{name:gl,value:u},element:w}),{structures:[w],maxRoundNumber:b,groupCount:v,links:[],groupSize:y,...J}}function ile({appliedPolicies:t,structureOptions:e,drawSize:i}){let r=e==null?void 0:e.groupSize,n=(e==null?void 0:e.groupSizeLimit)||8,{validGroupSizes:a}=pb({groupSizeLimit:n,drawSize:i}),o=a&&Math.max(...a);r&&(a!=null&&a.includes(r))||(r&&r>4||!(a!=null&&a.includes(4))?r=o:r=4);let s=Math.ceil(i/r);return{groupSize:r,groupCount:s}}function pb(t){let{groupSizeLimit:e=10,drawSize:i=0}=t??{},r=Se(3,e+1).filter(n=>{let a=Math.ceil(i/n),o=a*n-i,s=Math.ceil(i/a),l=Math.ceil(o/a);return(!o||o<n)&&s===n&&s>=3&&l<2});return{...J,validGroupSizes:r}}function rle({structureOrder:t,matchUpType:e,groupSize:i,drawSize:r,idPrefix:n,isMock:a,uuids:o}){let s=(t-1)*i,l=Se(1+s,i+1+s),u=eO({drawPositions:l}).uniqueMatchUpGroupings??[],c=fq({groupSize:i,drawPositionOffset:s});return u.map(p).sort((m,h)=>(m.roundNumber??1/0)-(h.roundNumber??1/0));function d(m){return c.reduce((h,f,g)=>f.includes(m)?g+1:h,void 0)}function p(m){let h=VT(m),f=d(h),g=[1,r],v=nle({structureOrder:t,drawPositions:m,roundNumber:f,idPrefix:n,uuids:o}),y={matchUpStatus:f?Ji:Vt,matchUpType:e,finishingPositionRange:{winner:g,loser:g},drawPositions:m,roundNumber:f,matchUpId:v};return a&&(y.isMock=!0),y}}function nle({structureOrder:t,drawPositions:e,roundNumber:i,idPrefix:r,uuids:n}){return r?`${r}-${t}-${i}-DP-${e.join("-")}`:(n==null?void 0:n.pop())||Gt()}function tO(t){let{roundRobinGroupsCount:e,participantsCount:i,cluster:r}=t;if(!ot(i))return{seedBlocks:void 0,...ee({result:{error:oe},context:{participantsCount:i},stack:"getSeedBlocks"})};let n=Sg(i);if(e){let m=Math.min(e,n),h=[],f=1;for(Se(0,m).forEach(()=>{h.push([f]),f++});f<n;){let g=Se(f,f+m);f+=m,h.push(g)}return{...J,seedBlocks:h}}let a=Se(1,n+1),o=[],s=n/2;for(;s>1;){let m=Rr(a,s),h=m.length;m.forEach((f,g)=>{let v,y=g<h/2,I=g%2===0,b=f[0],S=f[f.length-1];r&&h>4?h===8?v=y?S:b:v=I?b:S:v=y?b:S,Rn(f,o)||o.push(v)}),s=s/2}let l=a.filter(m=>!o.includes(m));for(;l.length;)l.length%2===0?o.push(l.pop()):o.push(l.shift());let u=Se(0,20).map(m=>Math.pow(2,m));u.unshift(1);let c=u.indexOf(n),d=0,p=[];return Se(0,c).forEach(m=>{p.push(o.slice(d,d+u[m])),d+=u[m]}),{...J,seedBlocks:p}}function iO({roundRobinGroupsCount:t,drawSize:e}){let i="getSeedGroups";if(!ot(e))return{seedGroups:void 0,...ee({result:{error:oe},context:{drawSize:e},stack:i})};if(t){if(!ot(t))return{seedGroups:void 0,...ee({context:{roundRobinGroupsCount:t},result:{error:oe},stack:i})};let r=1,n=Math.floor(e/t);return{seedGroups:Se(0,n).map(()=>{let a=Se(r,r+t);return r+=t,a})}}else{let{seedBlocks:r}=tO({participantsCount:e,roundRobinGroupsCount:t}),n=0;return{seedGroups:(r||[]).map(a=>(a||[]).map(()=>(n+=1,n)))}}}function rO({roundRobinGroupsCount:t,participantsCount:e}){var n;if(t){let{validGroupSizes:a}=pb({drawSize:e});if(!((n=a==null?void 0:a.map(o=>Math.ceil(e/o)))!=null&&n.includes(t)))return ee({context:{roundRobinGroupsCount:t},result:{error:oe}})}let{seedGroups:i}=iO({drawSize:e,roundRobinGroupsCount:t}),r=(i==null?void 0:i.map(a=>Math.min(...a)))||[];return{...J,seedingThresholds:r}}function Bf(t){if(!t)return 1/0;if(ot(t))return Qe(t);let e=t.split("-")[0];return ot(e)?Qe(e):1/0}function ale({size:t}){let e=[t],i=t;for(;i/2===Math.floor(i/2);)i=i/2,e.push(i);return e.includes(1)||e.push(1),e.sort(or),e.reverse(),e}function ole({blockPattern:t,index:e}){let i=0;for(let r of t){if(i===e)return r;let n=0;for(;n<r.length;){if(i===e)return r;i+=1,n++}}}function sle({positioning:t,size:e}){let i=ale({size:e}),r=[],n=[],a=p=>p[0],o=p=>p[p.length-1],s=(p,m)=>(t&&[qN,Ad].includes(t)&&m%2?o(p):a(p))||a(p),l=(p,m)=>{if(p.every(h=>!n.includes(h))){let h=s(p,m);return n.push(h),h}},u=p=>{let m=p.filter(h=>!n.includes(h));if(m.length)return n.push(...m),m},c=(p,m)=>{let h=s(p,m);if(!n.includes(h))return n.push(h),h},d=Se(1,e+1);for(let p of i)if(p===1){let m=Rr(d,2),h=m.map(l).filter(Boolean);h.length&&r.push(h);let f=m.flatMap(u).filter(Boolean);f.length&&r.push(f)}else{let m=Rr(d,p).map(c).filter(Boolean);m.length&&r.push(m)}return{divisions:i,divisionGroupings:r}}function uh({provisionalPositioning:t,returnAllProxies:e,appliedPolicies:i,seedingProfile:r,drawDefinition:n,allPositions:a,structure:o}){var C;let s=[];if(!o)return{error:lp};let{matchUps:l,roundMatchUps:u}=Wt({matchUpFilters:{roundNumbers:[1]},provisionalPositioning:t,structure:o}),{seedAssignments:c}=po({provisionalPositioning:t,returnAllProxies:e,drawDefinition:n,structure:o}),{positionAssignments:d}=Er({structure:o}),p=d==null?void 0:d.length,m=(c==null?void 0:c.length)??0,h=[],f=Object.keys(u).map(O=>parseInt(O)).sort((O,k)=>O-k).map(O=>{let k=u[O].map(F=>F.drawPositions).flat(1/0).filter(Boolean),x=k.filter(F=>!h.includes(F));return h=h.concat(...k),x}).filter(O=>O.length).reverse(),g=f.pop()??[],v=g&&Math.min(...g)-1||0;r=r??((C=i==null?void 0:i.seeding)==null?void 0:C.seedingProfile);let y=(g==null?void 0:g.length)||0,I=f.filter(O=>O.filter(k=>k<=m).length),{stage:b,structureType:S,roundLimit:w}=o,U=S===xn,T=!U&&(f==null?void 0:f.length),D=!U&&b===Ye&&w,P=I.flat(1/0),E=T?P==null?void 0:P.length:0,R=a?p:m,N=_A({drawDefinition:n,structure:o,matchUps:l}),A=N?0:!T&&R||R&&P.length<R&&R-P.length||0;if(D){let O=o!=null&&o.matchUps?o.matchUps.filter(({roundNumber:x})=>x===o.roundLimit).length:0,k=g.length/O;if(!T){let x=mb(r),F=Rr(g,k),$=1,_=Se(0,F[0].length).map(()=>{let L=Se($,$+F.length);return $+=F.length,L});({validSeedBlocks:s}=gq({drawPositionBlocks:F,nonRandom:r==null?void 0:r.nonRandom,positioning:x,seedGroups:_}))}}else U?{validSeedBlocks:s}=lle({nonRandom:r==null?void 0:r.nonRandom,seedingProfile:r,structure:o}):T?s=I.map(O=>({seedNumbers:O,drawPositions:O})):N&&Rr(g,2).map((O,k)=>({drawPositions:[O[0]],seedNumbers:[k+1]})).forEach(O=>s.push(O));if(!U&&!N&&!D){let{blocks:O}=ule({drawPositionOffset:v,seedNumberOffset:E,seedCountGoal:A,seedingProfile:r,baseDrawSize:y});O.forEach(k=>s.push(k))}let M=s.flatMap(O=>O.drawPositions).reduce((O,k)=>(g==null?void 0:g.includes(k))&&O,!0);return!N&&!T&&!U&&!M?{error:kG,validSeedBlocks:[],isContainer:U,isFeedIn:T}:{isLuckyStructure:N,validSeedBlocks:s,isContainer:U,isFeedIn:T}}function lle({seedingProfile:t,structure:e,nonRandom:i}){var c;let r=e.structures||[],n=r.length,a=(c=oi({structure:e}))==null?void 0:c.positionAssignments,o=mb(t),s=(a==null?void 0:a.length)??0,{seedGroups:l}=iO({roundRobinGroupsCount:n,drawSize:s}),u=r.map(d=>{var p;return(p=oi({structure:d}).positionAssignments)==null?void 0:p.map(m=>m.drawPosition)});return gq({drawPositionBlocks:u,positioning:o,seedGroups:l,nonRandom:i})}function gq({drawPositionBlocks:t,positioning:e,seedGroups:i,nonRandom:r}){let n=[],{divisionGroupings:a}=sle({size:i.length,positioning:e}),o=[];return i.forEach((s,l)=>{let u=ole({blockPattern:a,index:l});s.forEach((c,d)=>{let p=l%2?t.length-d-1:d,m=t[p].slice().filter((f,g)=>u.includes(g+1)&&f);e!==Ad?m=r?m:wn(m):l%2&&m.reverse();let h=m.find(f=>!o.includes(f));h&&(o.push(h),n.push({drawPositions:[h],seedNumbers:[c]}))})}),{validSeedBlocks:n}}function ule(t){let{drawPositionOffset:e=0,roundRobinGroupsCount:i,seedNumberOffset:r=0,seedingProfile:n,seedCountGoal:a,baseDrawSize:o}=t,s=1,l=[],{seedBlocks:u}=tO({cluster:mb(n)===qN,participantsCount:o,roundRobinGroupsCount:i});s=0;for(let d of u){if(s+1>a)break;let p=d.map(h=>h+e),m=c(s+1,d.length).map(h=>+h+r);s+=d.length,l.push({drawPositions:p,seedNumbers:m})}return{blocks:l};function c(d,p){return Array.from(new Array(p),(m,h)=>h+d)}}function ES({appliedPolicies:t,drawDefinition:e,seedBlockInfo:i,drawPosition:r,structureId:n,seedNumber:a}){var l,u,c,d,p,m;let{structure:o}=et({drawDefinition:e,structureId:n});t||(t=$t({drawDefinition:e}).appliedPolicies);let s=i==null?void 0:i.validSeedBlocks;return!s&&o&&(s=(l=uh({appliedPolicies:t,drawDefinition:e,structure:o}))==null?void 0:l.validSeedBlocks),(c=(u=t==null?void 0:t.seeding)==null?void 0:u.validSeedPositions)!=null&&c.ignore?!0:(p=(d=t==null?void 0:t.seeding)==null?void 0:d.validSeedPositions)!=null&&p.strict?(((m=s.find(h=>h.seedNumbers.includes(a)))==null?void 0:m.drawPositions)||[]).includes(r):[].concat(...s.map(h=>h.drawPositions)).includes(r)}function vq(t){var R,N,A;let{provisionalPositioning:e,drawDefinition:i,seedingProfile:r,seedBlockInfo:n,structureId:a,randomize:o}=t,{structure:s}=et({drawDefinition:i,structureId:a}),{seedAssignments:l}=po({returnAllProxies:t.returnAllProxies,provisionalPositioning:e,drawDefinition:i,structure:s}),{positionAssignments:u}=Er({structure:s}),c=(R=u==null?void 0:u.filter(M=>M.participantId??M.bye??M.qualifier))==null?void 0:R.map(M=>M.drawPosition).filter(Boolean),{appliedPolicies:d}=$t({drawDefinition:i}),p=((n==null?void 0:n.validSeedBlocks)||s&&((N=uh({returnAllProxies:t.returnAllProxies,provisionalPositioning:e,appliedPolicies:d,drawDefinition:i,seedingProfile:r,structure:s}))==null?void 0:N.validSeedBlocks)||[]).filter(M=>M.drawPositions.filter(C=>!(c!=null&&c.includes(C))).length)[0],m=l==null?void 0:l.map(M=>M.participantId).filter(Boolean),h=u==null?void 0:u.map(M=>M.participantId).filter(Boolean),f=m==null?void 0:m.filter(M=>h==null?void 0:h.includes(M)),g=m==null?void 0:m.filter(M=>!(h!=null&&h.includes(M))),v=l==null?void 0:l.filter(M=>g==null?void 0:g.includes(M.participantId)),y=l==null?void 0:l.filter(M=>!M.participantId),I=(v!=null&&v.length&&v.length>0?v.length:(y==null?void 0:y.length)??0)&&(p==null?void 0:p.drawPositions.filter(M=>!(c!=null&&c.includes(M))))||[],b=o?wn(I):I,S=[],w=b.map(()=>{var C;let M=(C=E(v,S))==null?void 0:C.participantId;return M&&S.push(M),M}).filter(Boolean),U=l==null?void 0:l.filter(M=>f==null?void 0:f.includes(M.participantId)).map(M=>M.seedNumber),T=((p==null?void 0:p.seedNumbers)||[]).filter(M=>!(U!=null&&U.includes(M))),D=l==null?void 0:l.filter(M=>T.includes(M.seedNumber)).map(M=>M.participantId),P=(A=d==null?void 0:d.seeding)==null?void 0:A.duplicateSeedNumbers;return{nextSeedBlock:p,unplacedSeedParticipantIds:P===void 0||P?w:D,unplacedSeedNumbers:T,unfilledPositions:b,unplacedSeedAssignments:v};function E(M,C){let O=M.filter(F=>!C.includes(F.participantId)),k=Math.min(...O.map(F=>Bf(F.seedValue))),x=O.filter(F=>Bf(F.seedValue)===k);return wn(x).pop()}}function mb(t){if(typeof t=="string")return t;if(typeof t=="object")return t.positioning}function jg({provisionalPositioning:t,tournamentRecord:e,drawDefinition:i,seedingProfile:r,participantId:n,seedBlockInfo:a,structureId:o,seedNumber:s,seedValue:l,eventId:u,event:c}){var S,w,U;let d="assignSeed",{structure:p}=et({drawDefinition:i,structureId:o}),{positionAssignments:m}=Er({structure:p}),h=po({provisionalPositioning:t,drawDefinition:i,structure:p}).seedAssignments,f=h.map(T=>T.seedNumber),g=Qp({drawDefinition:i,participantId:n});if(n&&!g)return ee({result:{error:Ts},context:{participantId:n},stack:d});let v=c?(w=(S=Gi({event:c}).flightProfile)==null?void 0:S.flights)==null?void 0:w.length:0,y=v&&v>1,I=(U=m==null?void 0:m.find(T=>T.participantId===n))==null?void 0:U.drawPosition;if(I&&!ES({drawPosition:I,drawDefinition:i,seedBlockInfo:a,structureId:o,seedNumber:s}))return ee({result:{error:dN},context:{assignedDrawPosition:I},info:"invalid seed position",stack:d});f.includes(s)||h.push({seedNumber:s,seedValue:l});let b;return h.forEach(T=>{T.participantId===n&&T.seedNumber!==s&&(T.participantId=void 0),T.seedNumber===s&&(T.participantId=n,!(r!=null&&r.groupSeedingThreshold)&&!y&&(T.seedValue=l??s),b=!0)}),b?(IW({tournamentId:e==null?void 0:e.tournamentId,drawDefinition:i,structure:p,eventId:u}),{...J}):ee({result:{error:OG},stack:d})}function nO({inContextTargetMatchUp:t,drawPositionSideIndex:e,teamParticipantId:i,tournamentRecord:r,drawDefinition:n,matchUp:a,event:o}){var p,m,h,f;let s=(m=(p=t==null?void 0:t.sides)==null?void 0:p[e])==null?void 0:m.sideNumber,l=s&&((h=a.sides)==null?void 0:h.find(g=>g.sideNumber===s)),{extension:u}=gt({element:n,name:Tu}),c=(u==null?void 0:u.value)||{},d=Me(c[i],!1,!0);if(l)(f=a==null?void 0:a.sides)==null||f.forEach(g=>{g.sideNumber===s&&(g.lineUp=d)});else{a.sides=[1,2].map(v=>{var y;return{...((y=a.sides)==null?void 0:y.find(I=>I.sideNumber===v))??{},sideNumber:v}});let g=a.sides.find(v=>v.sideNumber===s);g&&(g.lineUp=d)}Rt({tournamentId:r==null?void 0:r.tournamentId,context:"updateSidLineUp",eventId:o==null?void 0:o.eventId,drawDefinition:n,matchUp:a})}function Iq(t){let{sourceMatchUp:e}=t,{targetMatchUp:i,structure:r,matchUpsMap:n,drawPosition:a}=t,o=i.roundNumber>1&&i.roundNumber-1,s=Ld({structureId:r.structureId,matchUpsMap:n});!e&&a&&(e=s.find(({drawPositions:h,roundNumber:f})=>f===o&&(h==null?void 0:h.includes(a))));let l=e==null?void 0:e.roundPosition,u=l%2?1:-1,c=l+u,d=o&&s.find(({roundNumber:h,roundPosition:f})=>h===o&&f===c),p=d==null?void 0:d.matchUpStatus,m=[er,cr].includes(p);return{pairedPreviousMatchUp:d,pairedPreviousMatchUpIsDoubleExit:m}}function cle({drawPosition:t,drawPositions:e}){let i=!1,r=!!(e!=null&&e.includes(t));return{updatedDrawPositions:r?e||[]:[...e,void 0,void 0].slice(0,2).map(n=>!n&&!r?(r=!0,i=!0,t):n).sort(or).filter(Boolean),positionAdded:i,positionAssigned:r}}function yq({structureId:t,matchUpsMap:e,matchUp:i}){let r=i==null?void 0:i.roundPosition,n=r%2?1:-1,a=r+n;return{pairedPreviousMatchUp:Ld({matchUpsMap:e,structureId:t}).find(({roundNumber:o,roundPosition:s})=>o===(i==null?void 0:i.roundNumber)&&s===a)}}function bq({inContextDrawMatchUps:t,sourceMatchUpStatus:e,sourceMatchUpId:i,matchUpsMap:r,matchUp:n}){let a=t.find(s=>s.matchUpId===i),{pairedPreviousMatchUp:o}=yq({structureId:a==null?void 0:a.structureId,matchUp:a,matchUpsMap:r});if(a&&o){let s=o==null?void 0:o.matchUpId,l=t.find(c=>c.matchUpId===s),u=(a==null?void 0:a.structureId)===(l==null?void 0:l.structureId)?(a==null?void 0:a.roundPosition)<(l==null?void 0:l.roundPosition)&&1||2:a.structureId===(l==null?void 0:l.structureId)&&2||1;n.matchUpStatusCodes=(n.matchUpStatusCodes??[]).map(c=>{let d=Ti(c)||!isNaN(c)?{code:c}:c;return d.sideNumber===u?{...d,previousMatchUpStatus:e}:d})}}function OU({inContextDrawMatchUps:t,drawPosition:e,matchUpId:i}){let r=t.filter(({winnerMatchUpId:n,loserMatchUpId:a})=>a===i||n===i).sort((n,a)=>n.roundPosition-a.roundPosition);return t.find(n=>n.matchUpId===i).feedRound?1:r.reduce((n,a,o)=>{var s;return(s=a.drawPositions)!=null&&s.includes(e)?o+1:n},void 0)}function Vf({inContextDrawMatchUps:t,sourceMatchUpStatus:e,tournamentRecord:i,sourceMatchUpId:r,drawDefinition:n,matchUpStatus:a,drawPosition:o,matchUpsMap:s,matchUpId:l,event:u}){var R,N,A,M;let c="assignMatchUpDrawPosition";s||(s=sn({drawDefinition:n})),t||(t=mr({inContext:!0,drawDefinition:n,matchUpsMap:s}).matchUps??[]);let d=t.find(C=>C.matchUpId===l),p=d==null?void 0:d.structureId,m=(R=n==null?void 0:n.structures)==null?void 0:R.find(C=>C.structureId===p);if(!m)return{error:Mi};let h=(N=s==null?void 0:s.drawMatchUps)==null?void 0:N.find(C=>C.matchUpId===l),f=(h==null?void 0:h.drawPositions)??[],{positionAdded:g,positionAssigned:v,updatedDrawPositions:y}=cle({drawPositions:f,drawPosition:o}),{positionAssignments:I}=oi({drawDefinition:n,structure:m}),b=(A=I==null?void 0:I.filter(C=>y.includes(C.drawPosition)))==null?void 0:A.find(({bye:C})=>C),S=(h==null?void 0:h.matchUpStatus)&&[zt,Mt].includes(h.matchUpStatus)&&y.filter(Boolean).length<2;if(a=b&&Vt||a||S&&h.matchUpStatus||(h==null?void 0:h.matchUpStatus)&&[er,cr].includes(h.matchUpStatus)&&h.matchUpStatus||Ji,h&&g){t=mr({inContext:!0,drawDefinition:n,matchUpsMap:s}).matchUps??[];let C=S&&OU({inContextDrawMatchUps:t,drawPosition:o,matchUpId:l})||void 0;h!=null&&h.matchUpStatusCodes&&bq({inContextDrawMatchUps:t,sourceMatchUpStatus:e,sourceMatchUpId:r,matchUpsMap:s,matchUp:h}),Object.assign(h,{drawPositions:y,winningSide:C,matchUpStatus:a}),Rt({tournamentId:i==null?void 0:i.tournamentId,eventId:d==null?void 0:d.eventId,context:c,drawDefinition:n,matchUp:h})}let w=Cn({inContextDrawMatchUps:t,inContextMatchUp:d,drawDefinition:n,matchUpId:l}),{targetMatchUps:{winnerMatchUp:U,loserMatchUp:T,loserTargetDrawPosition:D},targetLinks:{loserTargetLink:P}}=w,E=Ld({structureId:m.structureId,matchUpsMap:s});if(v&&b){if(U)if([Vt,er,cr].includes(a)){let C=Vf({matchUpId:U.matchUpId,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:n,drawPosition:o,matchUpsMap:s});if(C.error)return C}else{let{structureId:C}=U;C!==m.structureId&&console.log("winnerMatchUp in different structure... participant is in different targetDrawPosition")}}else if(U&&d&&!d.feedRound){let{pairedPreviousMatchUpIsDoubleExit:C}=Iq({targetMatchUp:h,drawPosition:o,matchUpsMap:s,structure:m});if(C){let O=Vf({matchUpId:U.matchUpId,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:n,drawPosition:o,matchUpsMap:s});if(O.error)return O}}if((h==null?void 0:h.matchUpType)===hi){let C=t==null?void 0:t.find(({matchUpId:x})=>x===h.matchUpId),O=((C==null?void 0:C.sides)??[]).reduce((x,F,$)=>F.drawPosition===o?$:x,void 0),k=(M=I==null?void 0:I.find(x=>x.drawPosition===o))==null?void 0:M.participantId;k&&O!==void 0&&nO({inContextTargetMatchUp:C,drawPositionSideIndex:O,teamParticipantId:k,tournamentRecord:i,drawDefinition:n,matchUp:h})}if((P==null?void 0:P.linkCondition)===tl&&y.filter(Boolean).length===2&&!b&&E.filter(({drawPositions:C,roundNumber:O})=>O===1&&Rn(C,y)).every(({matchUpStatus:C})=>[qi,mn].includes(C))&&T){let{structureId:C}=T,O=Ya({drawPosition:D,tournamentRecord:i,drawDefinition:n,structureId:C,matchUpsMap:s,event:u});if(O.error)return O}return v?{...J}:ee({result:{error:Df},context:{drawPosition:o},stack:c})}function wq({inContextDrawMatchUps:t,drawDefinition:e,assignments:i,matchUpsMap:r,structure:n}){var c,d,p,m;let a=((p=(d=(c=Lg({drawDefinition:e}))==null?void 0:c.containedStructures)==null?void 0:d[n.structureId])==null?void 0:p.map(({structureId:h})=>h))||[];a.push(n==null?void 0:n.structureId);let o=(i==null?void 0:i.map(({drawPosition:h})=>h))||[],s=(t==null?void 0:t.filter(h=>a.includes(h.structureId)&&Vi(h.drawPositions??[],o).length))??[],l=s.map(({matchUpId:h})=>h),u=((m=r==null?void 0:r.drawMatchUps)==null?void 0:m.filter(h=>l.includes(h.matchUpId)))??[];return{drawPositions:o,matchUps:u,targetMatchUps:s}}function aO({lineUp:t}){if(!Array.isArray(t))return;let e={};return ct(t.flatMap(({collectionAssignments:i})=>i==null?void 0:i.map(({collectionId:r,collectionPosition:n})=>[r,n].join("|"))).filter(Boolean)).forEach(i=>{let[r,n]=i.split("|"),a=parseInt(n),{assignedParticipantIds:o}=TS({collectionPosition:a,collectionId:r,lineUp:t});o.forEach(s=>{e[s]||(e[s]=[]),e[s].push({collectionId:r,collectionPosition:a})})}),Object.keys(e).map(i=>({participantId:i,collectionAssignments:e[i]}))}function Bd(t){return`${t} must be an array`}function jT({lineUp:t,tieFormat:e}){let i=[];if(!Array.isArray(t))return i.push(Bd("lineUp")),{valid:!1,errors:i,error:oe};let r=t.every(a=>{if(typeof a!="object")return i.push("lineUp entries must be objects"),!1;let{participantId:o,collectionAssignments:s}=a;return o?typeof o!="string"?(i.push("participantIds must be strings"),!1):Array.isArray(s)?s.every(l=>{if(typeof l!="object")return i.push("collectionAssignments must be objects"),!1;let{collectionPosition:u}=l;return typeof u!="number"?(i.push("collectionPosition must be a number"),!1):!0}):(i.push(Bd("collectionAssignments")),!1):(i.push("Missing participantId"),!1)}),n=ct(t.map(Ut)).length===t.length;return n||i.push("Duplicated participantId(s)"),{valid:r&&n,errors:i,error:i.length?oe:void 0}}function ch({drawDefinition:t,participantId:e,tieFormat:i,lineUp:r}){if(typeof t!="object")return{error:_e};if(typeof e!="string")return{error:pr};let n=jT({lineUp:r,tieFormat:i});if(!n.valid)return n;let{extension:a}=gt({element:t,name:Tu}),o=(a==null?void 0:a.value)||{};return o[e]=aO({lineUp:r}),Lt({element:t,extension:{name:Tu,value:o}}),Hy({drawDefinition:t}),{...J}}function oO({inContextDrawMatchUps:t,inheritance:e=!0,tournamentRecord:i,drawDefinition:r,matchUpsMap:n,assignments:a,structure:o,event:s}){if(!r)return{error:_e};let{drawPositions:l,matchUps:u,targetMatchUps:c}=wq({inContextDrawMatchUps:t,matchUpsMap:n,assignments:a,structure:o});for(let d of c)d.matchUpType===ka&&(d.sides??[]).forEach((p,m)=>{var h;if(p!=null&&p.drawPosition&&(l!=null&&l.includes(p.drawPosition))){let f=u.find(({matchUpId:g})=>g===d.matchUpId);if((h=f==null?void 0:f.sides)!=null&&h[m]){if(delete f.sides[m].lineUp,e===!1){let g=d.tieFormat,v=p.participantId;g&&v&&ch({drawDefinition:r,participantId:v,lineUp:[],tieFormat:g})}Rt({tournamentId:i==null?void 0:i.tournamentId,context:"resetLineUps",eventId:s==null?void 0:s.eventId,drawDefinition:r,matchUp:f})}}});return{...J}}function rl({provisionalPositioning:t,inContextDrawMatchUps:e,isQualifierPosition:i,sourceMatchUpStatus:r,tournamentRecord:n,drawDefinition:a,seedingProfile:o,participantId:s,seedBlockInfo:l,drawPosition:u,matchUpsMap:c,structureId:d,event:p}){var P,E,R,N,A;let m="assignDrawPosition";if(!s&&!i)return ee({result:{error:pr},stack:m});c=c??sn({drawDefinition:a}),e||({matchUps:e}=mr({inContext:!0,drawDefinition:a,matchUpsMap:c}));let h=et({drawDefinition:a,structureId:d});if(h.error)return ee({result:h,stack:m});let{structure:f}=h;if(!f)return{error:Mi};if(zn({structure:f}))return ee({result:{error:aa},stack:m});let{seedAssignments:g}=po({provisionalPositioning:t,drawDefinition:a,structure:f}),v=(P=g==null?void 0:g.find(M=>M.participantId===s))==null?void 0:P.seedNumber,{appliedPolicies:y}=$t({tournamentRecord:n,drawDefinition:a,structure:f,event:p});if(v&&!ES({seedNumber:v,appliedPolicies:y,drawDefinition:a,seedBlockInfo:l,drawPosition:u,structureId:d}))return ee({result:{error:dN},context:{drawPosition:u},stack:m});let I=Er({structure:f}).positionAssignments||[],b=I==null?void 0:I.find(M=>M.drawPosition===u);if(!b)return ee({result:{error:Tg},context:{drawPosition:u},stack:m});if(I!=null&&I.map(Ut).includes(s))return ee({result:{error:Eg},context:{drawPosition:u},stack:m});let{containsParticipant:S,containsBye:w}=D(b);if(w){let M=sb({inContextDrawMatchUps:e,tournamentRecord:n,drawDefinition:a,drawPosition:u,structureId:d,matchUpsMap:c,event:p});if(M.error)return ee({result:M,stack:m})}if(S&&b.participantId!==s){let{activeDrawPositions:M}=ob({drawDefinition:a,structureId:d});if(M.includes(u))return ee({result:{error:V0},stack:m});oO({assignments:[b],inContextDrawMatchUps:e,tournamentRecord:n,drawDefinition:a,matchUpsMap:c,structure:f})}if(b.participantId=s,i&&(b.qualifier=!0),f.stage===Oe&&(!f.stageSequence||f.stageSequence>1)||f.stage&&[rn,$i].includes(f.stage)){let M=f.stage===Ye?Ye:Oe,C=(((R=(E=a.structures)==null?void 0:E.find(O=>(O==null?void 0:O.stage)===M&&(O==null?void 0:O.stageSequence)===1))==null?void 0:R.seedAssignments)??[]).find(O=>O.participantId===s);if(C!=null&&C.participantId){let{participantId:O,seedNumber:k,seedValue:x}=C;jg({eventId:p==null?void 0:p.eventId,provisionalPositioning:t,tournamentRecord:n,drawDefinition:a,seedingProfile:o,participantId:O,seedNumber:k,seedValue:x,structureId:d,event:p})}}if(f.structureType!==xn)dle({provisionalPositioning:t,inContextDrawMatchUps:e,sourceMatchUpStatus:r,tournamentRecord:n,drawDefinition:a,drawPosition:u,matchUpsMap:c,structure:f,event:p});else{ZW({positionAssignments:I,tournamentRecord:n,drawDefinition:a,matchUpsMap:c,structure:f});let{drawPositions:M,matchUps:C,targetMatchUps:O}=wq({assignments:[b],inContextDrawMatchUps:e,drawDefinition:a,matchUpsMap:c,structure:f});if(M&&(C==null?void 0:C.length)===1&&C[0].matchUpType===hi){let k=((O==null?void 0:O[0].sides)??[]).reduce((x,F,$)=>M!=null&&M.includes(F.drawPosition)?$:x,void 0);nO({inContextTargetMatchUp:O[0],teamParticipantId:s,matchUp:C[0],drawPositionSideIndex:k,tournamentRecord:n,drawDefinition:a})}}let U=(N=a.entries)==null?void 0:N.find(M=>M.participantId===s),T=(A=p==null?void 0:p.entries)==null?void 0:A.find(M=>M.participantId===s);return!U&&T&&qA({entryStatus:T.entryStatus,entryStage:f.stage,ignoreStageSpace:!0,drawDefinition:a,participantId:s,event:p}),Pc({tournamentId:n==null?void 0:n.tournamentId,drawDefinition:a,structure:f,event:p}),{positionAssignments:I,...J};function D(M){let C=M.bye,O=M.qualifier,k=M.participantId;return{containsBye:C,containsQualifier:O,containsParticipant:k,filled:C||O||k}}}function dle({provisionalPositioning:t,inContextDrawMatchUps:e,sourceMatchUpStatus:i,tournamentRecord:r,drawDefinition:n,drawPosition:a,matchUpsMap:o,structure:s,event:l}){let u={isCollectionMatchUp:!1},{matchUps:c}=Wt({provisionalPositioning:t,matchUpFilters:u,drawDefinition:n,matchUpsMap:o,structure:s,event:l}),{roundMatchUps:d}=En({matchUps:c}),{initialRoundNumber:p}=Tm({drawPosition:a,matchUps:c}),m=p&&(d==null?void 0:d[p].find(h=>{var f;return(f=h.drawPositions)==null?void 0:f.includes(a)}));if(m){let h=Vf({matchUpId:m.matchUpId,inContextDrawMatchUps:e,sourceMatchUpStatus:i,tournamentRecord:r,drawDefinition:n,drawPosition:a,matchUpsMap:o});if(h.error)return ee({stack:"assignDrawPositionToMatchUps",context:{drawPosition:a},result:h})}return{...J}}function sO(t){let{participantIdAttributeName:e="participantId",isQualifierPosition:i,positionActionName:r,tournamentRecord:n,drawDefinition:a,participantId:o,drawPosition:s,structureId:l,event:u}=t,c="positionParticipantAction";if(!a)return{error:_e};let d=$t({tournamentRecord:n,drawDefinition:a,event:u}).appliedPolicies??{},{inContextDrawMatchUps:p,matchUpsMap:m}=t;m||(m=sn({drawDefinition:a}),Object.assign(t,{matchUpsMap:m})),p||({matchUps:p}=mr({inContext:!0,drawDefinition:a,matchUpsMap:m}),Object.assign(t,{inContextDrawMatchUps:p}));let{positionAssignments:h}=oi({drawDefinition:a,structureId:l}),f=h==null?void 0:h.find(b=>b.drawPosition===s);if(f!=null&&f.participantId){let b=f.participantId,S=rl({inContextDrawMatchUps:p,tournamentRecord:n,drawDefinition:a,participantId:o,drawPosition:s,structureId:l,matchUpsMap:m,event:u});return S.success?I({appliedPolicies:d,removedParticipantId:b}):ee({result:S,stack:c})}let g=sb({inContextDrawMatchUps:p,tournamentRecord:n,drawDefinition:a,drawPosition:s,structureId:l,matchUpsMap:m,event:u});if(g.error)return ee({result:g,stack:c});let v=g.participantId,y=rl({inContextDrawMatchUps:p,isQualifierPosition:i,tournamentRecord:n,drawDefinition:a,participantId:o,drawPosition:s,structureId:l,matchUpsMap:m,event:u});if(!y.success)return ee({result:y,stack:c});return I({appliedPolicies:d,removedParticipantId:v});function I({appliedPolicies:b,removedParticipantId:S}){let{structure:w}=et({drawDefinition:a,structureId:l});NA({drawPositions:[s],structure:w});let U={[e]:o,name:r,drawPosition:s,structureId:l};return RT({appliedPolicies:b,drawDefinition:a,positionAction:U}),ee({context:{removedParticipantId:S},result:{...J},stack:c})}}function ple({luckyLoserParticipantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,structureId:n}){return sO({positionActionName:"luckyLoserDrawPositionAssignment",participantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,structureId:n})}function Uq(t){return ple(t)}function Sq({params:t,modMap:e,structure:i}){let{tournamentRecord:r,drawDefinition:n,event:a}=t;for(let o of i.matchUps)e[o.matchUpId]&&(o.roundNumber=e[o.matchUpId],Rt({tournamentId:r==null?void 0:r.tournamentId,eventId:a==null?void 0:a.eventId,drawDefinition:n,matchUp:o}))}function Tq(t,e){let i=[{drawDefinition:!0,structureId:!0}];Array.isArray(e)&&i.push(...e);let r=ze(t,i);if(r.error)return r;let n=et(t);if(n.error)return n;let a=n.structure;if(!zn({structure:a}))return ee({result:{error:sp,message:"structure must be adHoc"}});let{roundMatchUps:o=[],roundNumbers:s}=En({matchUps:a==null?void 0:a.matchUps});return s!=null&&s.length?{valid:!0,structure:a,roundMatchUps:o,roundNumbers:s}:{error:ju}}function Dq(t){var c;let e=Tq(t,[{targetRoundNumber:!0,roundNumber:!0,[Xn]:noe}]);if(e.error)return e;let{structure:i,roundMatchUps:r,roundNumbers:n}=e,{targetRoundNumber:a,roundNumber:o}=t;if(!(n!=null&&n.includes(o))||!(n!=null&&n.includes(a)))return ee({result:{error:oe},info:"roundNumbers must be valid rounds"});let s=a>o,l=s?Se(o+1,a+1):Se(a,o),u={};return l.forEach(d=>((r==null?void 0:r[d])??[]).forEach(({matchUpId:p})=>{u[p]=d-(s?1:-1)})),(c=r==null?void 0:r[o])==null||c.forEach(({matchUpId:d})=>u[d]=a),Sq({params:t,modMap:u,structure:i}),{...J}}function Pq({structurePositionAssignments:t,provisionalPositioning:e,tournamentRecord:i,drawDefinition:r,event:n}){var s;if(!r)return{error:_e};if(!Array.isArray(t))return{error:oe};let a="setPositionAssignments";for(let l of t){let{structureId:u,positionAssignments:c}=l;if(!c)continue;let d=et({drawDefinition:r,structureId:u});if(d.error)return d;let p=d.structure;if(!p)return{error:Mi};let m=(s=oi({structure:p}).positionAssignments)==null?void 0:s.map(({drawPosition:v})=>v),h=c==null?void 0:c.map(({drawPosition:v})=>v);if(Vi(m,h).length!==(m==null?void 0:m.length))return ee({result:{error:oe},info:"drawPositions do not match",stack:a});let f=sn({drawDefinition:r}),{matchUps:g}=mr({inContext:!0,drawDefinition:r,matchUpsMap:f});for(let v of c||[]){let{drawPosition:y,participantId:I,bye:b,qualifier:S}=v;if(b){let w=Ya({tournamentRecord:i,drawDefinition:r,drawPosition:y,matchUpsMap:f,structureId:u,structure:p,event:n});if(w!=null&&w.error)return w}else if(S)c.forEach(w=>{w.drawPosition===y&&(w.qualifier=!0,delete w.participantId,delete w.bye)});else if(I){let w=rl({provisionalPositioning:e,inContextDrawMatchUps:g,tournamentRecord:i,drawDefinition:r,participantId:I,drawPosition:y,matchUpsMap:f,structureId:u,event:n});if(w!=null&&w.error)return w}}Pc({tournamentId:i==null?void 0:i.tournamentId,drawDefinition:r,structure:p,event:n})}let o=t.map(({structureId:l})=>l);return li({tournamentId:i==null?void 0:i.tournamentId,eventId:n==null?void 0:n.eventId,drawDefinition:r,structureIds:o}),{...J}}function Rq(t){let e=Tq(t,[{roundNumbers:!0,[Xn]:un,[Kr]:o=>o.length===2&&o.every(Li)}]);if(e.error)return e;let{structure:i,roundMatchUps:r,roundNumbers:n}=e;if(!t.roundNumbers.every(o=>n==null?void 0:n.includes(o)))return ee({result:{error:oe,message:"roundNumbers must be valid rounds"}});let a={};return t.roundNumbers.forEach((o,s)=>((r==null?void 0:r[o])??[]).forEach(({matchUpId:l})=>{a[l]=t.roundNumbers[1-s]})),Sq({params:t,modMap:a,structure:i}),{...J}}function mle({qualifyingParticipantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,structureId:n}){return sO({positionActionName:"qualifierDrawPositionAssignment",participantId:t,isQualifierPosition:!0,tournamentRecord:e,drawDefinition:i,drawPosition:r,structureId:n})}function Eq(t){return mle(t)}function Cq({alternateParticipantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,structureId:n,event:a}){return sO({positionActionName:"alternateDrawPositionAssignment",participantIdAttributeName:"alternateParticipantid",participantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,structureId:n,event:a})}function Mq({validation:t=!0,tournamentRecord:e,drawDefinition:i,participantId:r,structureId:n,seedValue:a,event:o}){if(!i)return{error:_e};if(!n)return{error:za};let s=((e==null?void 0:e.participants)??[]).find(p=>p.participantId===r);if(e&&!s)return{error:Ts};let{structure:l}=et({drawDefinition:i,structureId:n});if(!l)return{error:Mi};if(!(!t||Li(a)||a===void 0||a===""||typeof a=="string"&&a.split("-").every(p=>Li(p)&&Qe(p)>0)))return{error:oe};let{seedAssignments:u}=po({drawDefinition:i,structure:l}),c=u==null?void 0:u.map(p=>p.seedNumber),d=u==null?void 0:u.find(p=>p.participantId===r);if(d){let p=typeof a=="string"?a.includes("-")&&a.split("-").map(m=>parseInt(m)).join("-")||parseInt(a)>0&&parseInt(a)||"":a&&a>0&&a||"";d.seedValue=p}else{let p={seedNumber:Math.max(0,...c||[])+1,participantId:r};a&&(p.seedValue=a),l.seedAssignments||(l.seedAssignments=[]),l.seedAssignments.push(p)}return IW({tournamentId:e==null?void 0:e.tournamentId,eventId:o==null?void 0:o.eventId,drawDefinition:i,structure:l}),{...J}}function Nq({drawDefinition:t,structureId:e}){if(!t)return{error:_e};let{structure:i}=et({drawDefinition:t,structureId:e}),r=((t==null?void 0:t.links)||[]).filter(n=>{var a;return((a=n.source)==null?void 0:a.structureId)===e}).map(n=>{var a;return(a=n.target)==null?void 0:a.structureId});return{playoffStructures:((t==null?void 0:t.structures)||[]).filter(n=>r.includes(n.structureId)),structure:i}}function GT({withStageGrouping:t,stageSequences:e,stageSequence:i,roundTarget:r,stages:n,event:a,stage:o}){if(!a)return{error:gi};let s={},l=[];for(let u of a.drawDefinitions||[]){let{structures:c,stageStructures:d}=Zo({withStageGrouping:t,stageSequences:e,drawDefinition:u,stageSequence:i,roundTarget:r,stages:n,stage:o});if(l.push(...c),d)for(let p of Object.keys(d))s[p]||(s[p]=[]),s[p].push(...d[p])}return{structures:l,stageStructures:s}}function lO({withStageGrouping:t,tournamentRecord:e,stageSequences:i,stageSequence:r,roundTarget:n,stages:a,stage:o}){if(!e)return{error:ge};let s={},l=[];for(let u of e.events||[]){let{structures:c,stageStructures:d}=GT({withStageGrouping:t,stageSequences:i,stageSequence:r,roundTarget:n,stages:a,event:u,stage:o});if(c&&l.push(...c),d)for(let p of Object.keys(d))s[p]||(s[p]=[]),s[p].push(...d[p])}return{structures:l,stageStructures:s}}function Ec(t){if(!(t!=null&&t.drawDefinition))return!1;let e=_T(t),i=e==null?void 0:e.includesTeamMatchUps,{completedMatchUps:r,pendingMatchUps:n,upcomingMatchUps:a}=e||{};return i&&(r=r==null?void 0:r.filter(({matchUpType:o})=>o===hi),n=n==null?void 0:n.filter(({matchUpType:o})=>o===hi),a=a==null?void 0:a.filter(({matchUpType:o})=>o===hi)),!!(r!=null&&r.length&&!(n!=null&&n.length)&&!(a!=null&&a.length))}function uO(t){var o,s;let{drawDefinition:e,structureId:i}=t;if(!e)return{error:_e};let{playoffStructures:r}=Nq({drawDefinition:e,structureId:i});if(!(r!=null&&r.length))return!1;let n=((s=(o=e==null?void 0:e.entries)==null?void 0:o.filter(l=>(l==null?void 0:l.entryStatus)&&ls.includes(l.entryStatus)))==null?void 0:s.length)??0,a=0;return(r||[]).reduce((l,u)=>{var c;return!!((c=oi({structure:u}).positionAssignments??[])!=null&&c.filter(d=>(d.participantId&&a++,(d==null?void 0:d.bye)??(d==null?void 0:d.participantId))).length&&l)},!!r.length)||a===n}function jC({significantCharacters:t,accessors:e=[],value:i}){let r=[],n=e[0];if(i!=null&&i[n]){let o=e.slice(1);if(Array.isArray(i[n]))i[n].forEach(s=>{let l=jC({accessors:o,significantCharacters:t,value:s});r.push(...l)});else if(i=i[n],o.length){let s=jC({accessors:o,significantCharacters:t,value:i});r.push(...s)}else a({value:i})}function a({value:o}){if(o&&["string","number"].includes(typeof o)){let s=t?o.slice(0,t):o;r.push(s)}}return r}function hle({targetParticipantIds:t,policyAttributes:e,idCollections:i,participants:r}){if(!Array.isArray(e))return{error:wN};if(!Array.isArray(r))return{error:My};let n={};return t.forEach(a=>{let o=r.find(l=>l.participantId===a),{values:s}=Aq({policyAttributes:e,idCollections:i,participants:r,participant:o});s&&s.forEach(l=>{n[l]||(n[l]=[]),n[l].includes(a)||n[l].push(a)})}),n}function Aq({policyAttributes:t,idCollections:e,participants:i,participant:r}){if(!Array.isArray(t))return{error:wN};if(!r)return{error:zm};let n=[];return t.forEach(a=>{let{directive:o,groupings:s,key:l,significantCharacters:u}=a||{};if(l){let c=l.split(".");n.push(...jC({significantCharacters:u,value:r,accessors:c}))}else if(o){let c=a==null?void 0:a.includeIds,d=((e==null?void 0:e[o])||[]).filter(p=>!c||c.includes(p));d!=null&&d.length&&(i!=null&&i.length)&&d.forEach(p=>{var h;let m=i.find(f=>f.participantId===p);if((h=m==null?void 0:m.individualParticipantIds)!=null&&h.includes(r.participantId)){let f=m==null?void 0:m.participantId;n.push(f)}})}else s&&Object.keys(s).forEach(c=>{s[c].includes(r.participantId)&&n.push(c)})}),{values:ct(n)}}function xB({candidatePositionAssignments:t,participantsWithGroupings:e,policyAttributes:i,idCollections:r}){let n=Object.assign({},...e.map(a=>({[a.participantId]:a})));return t.map(a=>{let o=n[a.participantId],{values:s}=Aq({participants:e,policyAttributes:i,idCollections:r,participant:o});return{...a,values:s}})}function Oq({participantIdGroups:t,positionAssignments:e,groupsToAvoid:i}){return Object.assign({},...e.filter(r=>r==null?void 0:r.participantId).map(r=>{let{drawPosition:n,participantId:a}=r,o=t?t[a]||[]:[],s=!!i.some(l=>o.includes(l));return{[n]:{participantGroups:o,includesGroupsToAvoid:s}}}))}function fle(t){let{unfilledPositions:e,chunkedDrawPositions:i}=t,r=Oq(t);return i.map(a=>{let o=e.filter(u=>a.includes(u)),s=n(o),l=o.filter(u=>!s.includes(u)).filter(u=>{var d;let c=FB(u);return!((d=r[c])!=null&&d.includesGroupsToAvoid)});return{unassigned:o,unpaired:s,pairedNoConflict:l}});function n(a){return a.filter(s=>!o(s));function o(s){let l=FB(s);return!a.includes(l)}}}function gle(t){let{unfilledPositions:e,chunkedDrawPositions:i}=t,r=Oq(t);return i.map(n=>{let a=e.filter(l=>n.includes(l)),o=a.length===n.length?a:[],s=n.filter(l=>{var u;return(u=r[l])==null?void 0:u.includesGroupsToAvoid}).length;return{unassigned:a,unpaired:o,pairedNoConflict:s?[]:a,conflictsCount:s}})}function FB(t){return Number(t%2?t+1:t-1)}function vle({allGroups:t,participantId:e}){return Object.keys(t).filter(i=>t[i].includes(e))}function Ile({selectedParticipantGroups:t,participantIdGroups:e,positionAssignments:i,drawPositionChunks:r,unfilledPositions:n,isRoundRobin:a}){let o=r.map(s=>a?gle({groupsToAvoid:t,chunkedDrawPositions:s,participantIdGroups:e,positionAssignments:i,unfilledPositions:n}):fle({groupsToAvoid:t,chunkedDrawPositions:s,participantIdGroups:e,positionAssignments:i,unfilledPositions:n}));if(a){let s=o.map(c=>c.map(d=>d.unassigned).filter(d=>d==null?void 0:d.length)).filter(c=>c==null?void 0:c.length).sort((c,d)=>(d.length||0)-(c.length||0)),l=o.map(c=>c.map(d=>d.unpaired).filter(d=>d==null?void 0:d.length)).filter(c=>c==null?void 0:c.length),u=o.map(c=>c.map(d=>d.pairedNoConflict).filter(d=>d==null?void 0:d.length)).filter(c=>c==null?void 0:c.length).sort((c,d)=>(d.length||0)-(c.length||0));return{unassigned:s,unpaired:l,pairedNoConflict:u}}else{let s=o.map(c=>c.map(d=>d.unassigned).filter(d=>d==null?void 0:d.length)).filter(c=>c==null?void 0:c.length),l=o.map(c=>c.map(d=>d.unpaired).filter(d=>d==null?void 0:d.length)).filter(c=>c==null?void 0:c.length),u=o.map(c=>c.map(d=>d.pairedNoConflict).filter(d=>d==null?void 0:d.length)).filter(c=>c==null?void 0:c.length);return{unassigned:s,unpaired:l,pairedNoConflict:u}}}function kq({positionAssignments:t,participantIds:e}){let i=t.map(r=>r.participantId);return e.filter(r=>!i.includes(r))}function yle({useSpecifiedGroupKey:t=!1,targetParticipantIds:e,largestFirst:i=!0,allGroups:r,groupKey:n}){var u;let a=Object.assign({},...Object.keys(r).map(c=>[c,r[c].filter(d=>e.includes(d))]).filter(c=>c[1].length).map(([c,d])=>({[c]:d}))),o=Object.keys(a).reduce((c,d)=>a[d].length>c?a[d].length:c,0),s=Object.keys(a).filter(c=>a[c].length===o),l=pa(i?s:Object.keys(a));return n=t&&((u=a[n])!=null&&u.length)?n:l,{participantId:n&&a[n]?pa(a[n]):pa(e),groupKey:n}}function ble({drawPositionGroups:t,positionAssignments:e}){let i=Object.assign({},...e.map(r=>({[r.drawPosition]:r})));return t.map(r=>r.filter(Boolean).map(n=>i[n]).filter(Boolean).filter(n=>!n.participantId&&!n.bye).map(n=>n.drawPosition)).flat().filter(Boolean)}function wle({candidatePositionAssignments:t,unseededParticipantIds:e,participantIdGroups:i,drawPositionChunks:r,drawPositionGroups:n,pairedPriority:a,allGroups:o,groupKey:s}){let l=n.reduce((T,D)=>D.length>T?D.length:T,0)<=2,u=kq({positionAssignments:t,participantIds:e}),c=ble({positionAssignments:t,drawPositionGroups:n}),{participantId:d,groupKey:p}=yle({targetParticipantIds:u,useSpecifiedGroupKey:l,allGroups:o,groupKey:s}),m=vle({participantId:d,allGroups:o}),h=Ile({positionAssignments:t,isRoundRobin:l,selectedParticipantGroups:m,participantIdGroups:i,drawPositionChunks:r,unfilledPositions:c}),{unassigned:f,unpaired:g,pairedNoConflict:v}=h,y=(v==null?void 0:v.length)&&v[0],I=(g==null?void 0:g.length)&&g[0],b=a&&y?y:I,S=a?I:y,w=(b==null?void 0:b.length)&&b||(S==null?void 0:S.length)&&S,U;if(w!=null&&w.length){let T=fa(w);U=fa(T)}else{let T=fa(f[0]);U=fa(T)}return{newGroupKey:p,selectedParticipantId:d,targetDrawPosition:U}}function CS({isRoundRobin:t,groupedParticipants:e}){let i=[];return t?e.forEach(r=>{let n=r.map(s=>s.drawPosition),a=eO({drawPositions:n}).uniqueMatchUpGroupings??[],o=Object.assign({},...r.map(s=>({[s.drawPosition]:s})));a.forEach(s=>{Rn(o[s[0]].values||[],o[s[1]].values||[])&&(i.push(s),r.conflict=!0)})}):e.forEach(r=>{var n,a;Rn(((n=r[0])==null?void 0:n.values)||[],((a=r[1])==null?void 0:a.values)||[])&&(i.push(r),r.conflict=!0)}),i}function Ule({positionedParticipants:t,potentialDrawPositions:e,drawPositionGroups:i,avoidanceConflicts:r,isRoundRobin:n}){return r.map(a=>{let o=a.map(s=>s.drawPosition);return a.filter(s=>e.includes(s.drawPosition)).map(s=>{let l=e.filter(u=>!(o!=null&&o.includes(u))).filter(u=>{let c=i.find(f=>f.includes(u)).find(f=>f!==u),d=t.find(f=>f.drawPosition===c),p=CS({isRoundRobin:n,groupedParticipants:[[s,d]]}),m=[t.find(f=>f.drawPosition===u),d],h=CS({isRoundRobin:n,groupedParticipants:[m]});return!p.length&&!h.length});if(l.length)return{drawPosition:s.drawPosition,possibleDrawPositions:l}}).filter(Boolean)}).flat(1)}function LB(t){let{initialPositionAssignments:e,participantsWithGroupings:i,opponentsToPlaceCount:r,unseededByePositions:n,drawPositionGroups:a,policyAttributes:o,idCollections:s,allGroups:l}=t,u=[],c,d=Math.min(...(a||[]).map(I=>I==null?void 0:I.length).filter(Boolean)),p=d>2,m=Me(e,!1,!0).filter(I=>!I.qualifier),h=e.filter(I=>!I.participantId&&(!I.bye||(n==null?void 0:n.includes(I.drawPosition)))).map(I=>I.drawPosition);Se(0,r).forEach(()=>{let{newGroupKey:I,selectedParticipantId:b,targetDrawPosition:S}=wle({...t,candidatePositionAssignments:m,allGroups:l,groupKey:c});c=I,m.forEach(w=>{w.drawPosition===S&&(w.participantId=b)})});let f=xB({candidatePositionAssignments:m,participantsWithGroupings:i,policyAttributes:o,idCollections:s}),g=Rr(f,d),v=CS({groupedParticipants:g,isRoundRobin:p}),y=0;for(;y<20&&v.length;){let I=Ule({positionedParticipants:f,potentialDrawPositions:h,avoidanceConflicts:v,drawPositionGroups:a,isRoundRobin:p});if(I.length){let b=Sle({candidatePositionAssignments:m,swapOptions:I});b.error&&console.log({result:b}),f=xB({candidatePositionAssignments:m,participantsWithGroupings:i,policyAttributes:o,idCollections:s}),g=Rr(f,d),v=CS({groupedParticipants:g,isRoundRobin:p}),y++}else y=20}return m.forEach(I=>{if(I.bye&&I.participantId){let b=IC;u.push(b)}if(I.qualifier&&I.participantId){let b=IC;u.push(b)}}),{positionAssignments:m,conflicts:v.length,groupedParticipants:g,errors:u}}function Sle({candidatePositionAssignments:t,swapOptions:e}){let i=fa(e);if(!i)return{error:{message:"No swap options"}};let r=i.drawPosition,n=fa(i.possibleDrawPositions),a=t.find(u=>u.drawPosition===r),o=t.find(u=>u.drawPosition===n)??{},s={participantId:o==null?void 0:o.participantId,qualifier:o==null?void 0:o.qualifier,bye:o==null?void 0:o.bye},l={participantId:a.participantId,qualifier:a.qualifier,bye:a.bye};return Object.assign(a,s),Object.assign(o,l),{...J}}function Tle({provisionalPositioning:t,unseededParticipantIds:e,inContextDrawMatchUps:i,unseededByePositions:r,tournamentRecord:n,drawDefinition:a,seedBlockInfo:o,participants:s,matchUpsMap:l,structureId:u,avoidance:c,drawSize:d,event:p}){var $;if(!c)return{error:zG};let{candidatesCount:m=1,policyAttributes:h,targetDivisions:f}=c,{roundsToSeparate:g}=c,v="randomUnseededSeparation",{structure:y}=et({drawDefinition:a,structureId:u}),{matchUps:I}=Wt({provisionalPositioning:t,matchUpsMap:l,structure:y,event:p});if(f&&Ss(f)&&!g){let _=mne(f)||0,L=I.reduce((B,V)=>V.roundNumber>B?V.roundNumber:B,0);g=L<_?1:L-_+1}let{positionAssignments:b}=Er({structure:y}),S=CT({participantsProfile:{convertExtensions:!0},deepCopy:!1,participants:s}).participantsWithGroupings,w=b==null?void 0:b.filter(_=>!_.participantId),U=b==null?void 0:b.map(_=>_.drawPosition),T=(y==null?void 0:y.structureType)===xn,D=T?{structure:y,matchUps:I,allDrawPositions:U,roundsToSeparate:g}:{matchUps:I,allDrawPositions:U,roundsToSeparate:g},{drawPositionGroups:P,drawPositionChunks:E}=T?Dle(D):Ple(D),R={groupParticipants:s.filter(_=>_.participantType===Wa).map(_=>_.participantId),teamParticipants:s.filter(_=>_.participantType===Kt).map(_=>_.participantId),pairParticipants:s.filter(_=>_.participantType===ht).map(_=>_.participantId)},N=hle({targetParticipantIds:e,policyAttributes:h,idCollections:R,participants:s});if(N.error)return ee({result:N,stack:v});let A=Object.assign({},...e.map(_=>{let L=Object.keys(N).filter(B=>(N[B]??[]).includes(_));return{[_]:L}})),M=kq({participantIds:e,positionAssignments:b});if(M.length>((w==null?void 0:w.length)||0))return{error:PN};let C,O=M.length,k=Se(0,m).map(()=>LB({initialPositionAssignments:b,participantsWithGroupings:S,unseededParticipantIds:e,opponentsToPlaceCount:O,pairedPriority:!1,unseededByePositions:r,participantIdGroups:A,drawPositionChunks:E,drawPositionGroups:P,policyAttributes:h,idCollections:R,allGroups:N,drawSize:d}));if(C=k.reduce((_,L)=>!_||(L.conflicts||0)<(_.conflicts||0)?L:_,void 0),!C||C.conflicts){let _=Se(0,m).map(()=>LB({initialPositionAssignments:b,participantsWithGroupings:S,unseededParticipantIds:e,opponentsToPlaceCount:O,pairedPriority:!0,unseededByePositions:r,participantIdGroups:A,drawPositionChunks:E,drawPositionGroups:P,policyAttributes:h,idCollections:R,allGroups:N,drawSize:d}));C=k.concat(..._).filter(L=>{var B;return!((B=L.errors)!=null&&B.length)}).reduce((L,B)=>!L||(B.conflicts||0)<(L.conflicts||0)?B:L,void 0)}if(!C)return{error:X0};let x=((($=oi({structure:y}))==null?void 0:$.positionAssignments)??[]).filter(_=>_.participantId).map(_=>_.participantId),F=C.positionAssignments.filter(_=>!x.includes(_.participantId));for(let _ of F)if(_.bye){let L=Ya({tournamentRecord:n,drawDefinition:a,seedBlockInfo:o,structureId:u,matchUpsMap:l,event:p,..._});if(L.error)return ee({result:L,stack:v})}else if(_.participantId){let L=rl({automaticPlacement:!0,inContextDrawMatchUps:i,tournamentRecord:n,drawDefinition:a,seedBlockInfo:o,structureId:u,matchUpsMap:l,event:p,..._});if(L.error)return ee({result:L,stack:v,context:{assignment:_}})}return{...J}}function Dle(t){let{structure:{structures:e}}=t,i=e.map(r=>r.positionAssignments.map(n=>n.drawPosition));return{drawPositionGroups:i,drawPositionChunks:[i]}}function Ple({allDrawPositions:t,roundsToSeparate:e,matchUps:i}){let r=i.filter(c=>c.roundNumber===1).map(c=>c.drawPositions),n=r.flat().sort(or),a=Math.max(...n),o=t.filter(c=>c>a),s=n.length,l=Se(s===2?1:2,s).filter(c=>c===uN(c)),u=l.slice(0,e||l.length).reverse().map(c=>Rr(n,c));return o.length&&console.log({fedDrawPositions:o}),{drawPositionGroups:r,drawPositionChunks:u}}function Rle({provisionalPositioning:t,inContextDrawMatchUps:e,unseededByePositions:i,multipleStructures:r,tournamentRecord:n,drawDefinition:a,seedBlockInfo:o,participants:s,matchUpsMap:l,structureId:u,structure:c,drawSize:d,event:p}){var D,P;let m="positionUnseededParticipants";c||({structure:c}=et({drawDefinition:a,structureId:u})),u||({structureId:u}=c);let{positionAssignments:h}=Er({structure:c}),{seedAssignments:f}=po({provisionalPositioning:t,drawDefinition:a,structure:c}),g=f==null?void 0:f.map(E=>E.participantId).filter(Boolean),{stage:v,stageSequence:y}=c,I=v===Ye?(P=(D=gt({element:c,name:gl}))==null?void 0:D.extension)==null?void 0:P.value:void 0,b=Zm({provisionalPositioning:t,drawDefinition:a,stageSequence:y,entryStatuses:gp,structureId:u,roundTarget:I,stage:v}),S=b.filter(E=>!(g!=null&&g.includes(E.participantId))).map(E=>E.participantId),w=h==null?void 0:h.filter(E=>!E.participantId&&!E.bye&&!E.qualifier).map(E=>E.drawPosition);if(!r&&S.length>((w==null?void 0:w.length)||0))return ee({result:{error:PN},context:{unseededParticipantsCount:S.length,unfilledDrawPositionsCount:w==null?void 0:w.length},stack:m});let{appliedPolicies:U}=$t({tournamentRecord:n,drawDefinition:a,event:p}),T=U==null?void 0:U[vS];if(c.stage===$i){let E=b.reduce((R,N)=>(R[N.groupingValue]||(R[N.groupingValue]=[]),R[N.groupingValue].push(N.participantId),R),{});Object.keys(E).length&&(T||(T={policyName:"Playoff Avoidance"}),T.policyAttributes||(T.policyAttributes=[]),T.policyAttributes.push({groupings:E}))}return T&&s?Tle({provisionalPositioning:t,unseededParticipantIds:S,inContextDrawMatchUps:e,unseededByePositions:i,tournamentRecord:n,drawDefinition:a,seedBlockInfo:o,participants:s,matchUpsMap:l,structureId:u,avoidance:T,drawSize:d,entries:b}):Ele({provisionalPositioning:t,unseededParticipantIds:S,inContextDrawMatchUps:e,unfilledDrawPositions:w,multipleStructures:r,tournamentRecord:n,drawDefinition:a,seedBlockInfo:o,structureId:u,matchUpsMap:l,drawSize:d,event:p})}function Ele({provisionalPositioning:t,unseededParticipantIds:e,inContextDrawMatchUps:i,unfilledDrawPositions:r,multipleStructures:n,tournamentRecord:a,drawDefinition:o,seedBlockInfo:s,matchUpsMap:l,structureId:u,drawSize:c,event:d}){let p=c>2?wn(r):r.reverse();for(let m of e){let h=p.pop();if(!n||h){let f=rl({provisionalPositioning:t,inContextDrawMatchUps:i,tournamentRecord:a,drawDefinition:o,seedBlockInfo:s,participantId:m,drawPosition:h,matchUpsMap:l,structureId:u,event:d});if(f!=null&&f.error&&console.log("!!!!!",{result:f}),f==null?void 0:f.error)return ee({result:f,stack:"randomUnseededDistribution"})}}return{...J}}function Cle(t){let e=t.structure??et(t).structure,i="positionQualifiers",r=[];if(e.stage===rn)return ee({result:{error:up},stack:i});let{unplacedRoundQualifierCounts:n,positionAssignments:a,roundDrawPositions:o}=Mle(t);for(let s of Object.keys(n)){let l=a==null?void 0:a.filter(u=>o[s].includes(u.drawPosition)&&!u.participantId&&!u.qualifier&&!u.bye).map(u=>u.drawPosition);if(n[s]>(l||0))return ee({result:{error:cH},context:{unfilledDrawPositions:l},stack:i});Se(0,n[s]).forEach(()=>{let u=fa(l);r.push(u),a==null||a.forEach(c=>{c.drawPosition===u&&(c.qualifier=!0,delete c.participantId,delete c.bye)})})}return{...J,qualifierDrawPositions:r}}function Mle({drawDefinition:t,structure:e,structureId:i}){e||({structure:e}=et({drawDefinition:t,structureId:i})),i||({structureId:i}=e);let{positionAssignments:r}=Er({structure:e}),{stage:n,stageSequence:a}=e,{qualifiersCount:o,roundQualifiersCounts:s}=Bg({drawDefinition:t,stageSequence:a,structureId:i,stage:n}),l=(s?Object.keys(s):[]).map(f=>Qe(f)),{matchUps:u}=Wt({structure:e}),{roundProfile:c}=En({matchUps:u}),d=Object.assign({},...l.filter(f=>c==null?void 0:c[f]).map(f=>{var g,v;return{[f]:((v=(g=c==null?void 0:c[f])==null?void 0:g.drawPositions)==null?void 0:v.filter(Boolean))??[]}})),p=r==null?void 0:r.filter(f=>f.qualifier).map(f=>f.drawPosition),m=o-((p==null?void 0:p.length)??0),h=p==null?void 0:p.length;return{unplacedRoundQualifierCounts:Object.assign({},...l.map(f=>{let g=r==null?void 0:r.filter(v=>{var y,I;return v.qualifier&&((I=(y=d[f])==null?void 0:y.drawPositions)==null?void 0:I.includes(v.drawPosition))}).map(v=>v.drawPosition);return{[f]:((s==null?void 0:s[f])??0)-((g==null?void 0:g.length)??0)}})),unplacedQualifiersCount:m,placedQualifiersCount:h,roundQualifiersCounts:s,positionAssignments:r,roundDrawPositions:d,qualifiersCount:o}}function _B({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,appliedPolicies:r,validSeedBlocks:n,drawDefinition:a,seedingProfile:o,seedBlockInfo:s,participants:l,groupsCount:u,structureId:c,matchUpsMap:d,structure:p,event:m}){let h=[],f=[],g=0;if(p||({structure:p}=et({drawDefinition:a,structureId:c})),c||(c=p==null?void 0:p.structureId),r||(r=$t({drawDefinition:a}).appliedPolicies),!n){let v=p&&uh({provisionalPositioning:t,appliedPolicies:r,drawDefinition:a,seedingProfile:o,structure:p});v!=null&&v.error&&f.push(v.error),n=v==null?void 0:v.validSeedBlocks}return u=u??(n==null?void 0:n.length)??0,Se(0,u).forEach(()=>{if(g<(u||0)){let v=Nle({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:a,seedingProfile:o,seedBlockInfo:s,participants:l,structureId:c,matchUpsMap:d,event:m});v!=null&&v.success&&(g++,h.push(...v.seedPositions??[])),v.error&&f.push({seedPositionError:v.error})}}),f.length?{error:f}:{...J,seedPositions:h}}function Nle({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:r,seedingProfile:n,seedBlockInfo:a,participants:o,structureId:s,matchUpsMap:l,event:u}){let{unplacedSeedParticipantIds:c,unfilledPositions:d}=vq({provisionalPositioning:t,randomize:!0,drawDefinition:r,seedingProfile:n,seedBlockInfo:a,structureId:s,event:u}),{appliedPolicies:p}=$t({drawDefinition:r}),{avoidance:m}=p??{};m&&o&&(c==null?void 0:c.length)>2;let h=[];for(let f of c){let g=d.pop();if(!g)return{error:Dg};h.push(g);let v=rl({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:r,seedingProfile:n,participantId:f,seedBlockInfo:a,drawPosition:g,matchUpsMap:l,structureId:s,event:u});if(!v.success)return v}return{...J,seedPositions:h}}function Ale({provisionalPositioning:t,drawDefinition:e,structure:i}){let{positionAssignments:r}=Er({structure:i}),{seedAssignments:n}=po({provisionalPositioning:t,drawDefinition:e,structure:i}),a=Object.assign({},...(n||[]).filter(o=>o.participantId).map(o=>({[o.participantId]:o})));return r==null?void 0:r.map(o=>a[o.participantId]?{...o,seedNumber:a[o.participantId].seedNumber,seedValue:a[o.participantId].seedValue}:"").filter(Boolean)}function Ole({orderedSortedFirstRoundSeededDrawPositions:t,validSeedBlocks:e,byesToPlace:i}){let r=[];e.forEach(a=>{if(i-r.length>a.drawPositions.length)r.push(...a.drawPositions);else{let o=GC(Rr(a.drawPositions,2)),s,l=t[r.length];for(;s=kU(o,l);)r.push(s),l=t[r.length]}});let n=r.map(a=>Array.isArray(a)?wn(a):a).flat(1/0);return mG(i)&&e.map(a=>a.seedNumbers[0]).includes(i)?t:n}function kU(t,e){if(Array.isArray(t)&&t.length!==2)return t.pop();if(!Array.isArray(t[0]))return t.includes(e)?t.indexOf(e)?t.pop():t.shift():Math.round(Math.random())?t.pop():t.shift();let i=t[0].flat(1/0).length,r=t[1].flat(1/0).length;if(i===r){let n=t[0].flat(1/0).includes(e)?t[0]:t[1];return kU(e?n:t[Math.round(Math.random())],e)}return i<r?kU(t[1],e):kU(t[0],e)}function GC(t){let e=Math.floor(t.length/2);return t.length>2?[GC(t.slice(0,e)),GC(t.slice(e))]:t}function kle({provisionalPositioning:t,relevantMatchUps:e,appliedPolicies:i,drawDefinition:r,seedingProfile:n,seedBlockInfo:a,byesToPlace:o,structure:s}){var b;a||(a=uh({provisionalPositioning:t,appliedPolicies:i,drawDefinition:r,seedingProfile:n,structure:s}));let{isFeedIn:l,isLuckyStructure:u,isContainer:c}=a,{validSeedBlocks:d}=a;(b=i==null?void 0:i.seeding)!=null&&b.containerByesIgnoreSeeding&&(d=[]);let p=Ale({provisionalPositioning:t,drawDefinition:r,structure:s})??[],m=ct([].concat(...e.map(S=>S.drawPositions))),h=p.filter(S=>m.includes(S.drawPosition)),f=(S,w)=>Bf(S.seedValue)-Bf(w.seedValue),g=d.reduce((S,w)=>{let U=h.filter(T=>{var D;return(D=w.drawPositions)==null?void 0:D.includes(T.drawPosition)}).sort(f);return S.concat(...U)},[]).map(S=>S.drawPosition),v=Ole({orderedSortedFirstRoundSeededDrawPositions:g,validSeedBlocks:d,byesToPlace:o}),y=$B({orderedSeedDrawPositions:g,relevantMatchUps:e}).slice(0,o),I=$B({orderedSeedDrawPositions:v,relevantMatchUps:e}).slice(0,o);return{strictSeedOrderByePositions:y,blockSeedOrderByePositions:I,isLuckyStructure:u,positionedSeeds:p,isContainer:c,isFeedIn:l}}function $B({orderedSeedDrawPositions:t,relevantMatchUps:e}){let i=e.map(r=>r.drawPositions).map(r=>r==null?void 0:r.sort((n,a)=>n-a)).filter(r=>(r==null?void 0:r[0])+1===(r==null?void 0:r[1]));return t.map(r=>i.find(n=>n==null?void 0:n.includes(r))).filter(Boolean).map(r=>r==null?void 0:r.reduce((n,a)=>t.includes(a)?n:a,void 0)).filter(Boolean)}function xle({provisionalPositioning:t,seedOrderByePositions:e,isLuckyStructure:i,appliedPolicies:r,drawDefinition:n,seedLimit:a,structure:o,isFeedIn:s}){var M,C;let l=(M=r==null?void 0:r.seeding)==null?void 0:M.seedingProfile,u=o.stage===Ye,{positionAssignments:c}=Er({structure:o}),d=c==null?void 0:c.filter(O=>O.participantId).map(O=>O.drawPosition),p={isCollectionMatchUp:!1},{matchUps:m,roundMatchUps:h}=Wt({provisionalPositioning:t,matchUpFilters:p,structure:o}),f=(h==null?void 0:h[1])||[],g=o.structureType===xn?m:f,v=ct([].concat(...g.map(O=>O.drawPositions))),y=Math.min(...v)-1,I=d==null?void 0:d.filter(O=>v.includes(O)),b=O=>{let k=Math.ceil(O.length/2),x=[O.slice(0,k),O.slice(k)],F=x.map(z=>[].concat(...z.flat(1/0)).length),$=Math.min(...F.flat(1/0)),_=Math.max(...F.flat(1/0)),L=F.indexOf(_),B=$!==_,V=wn(x),[G,j]=!$||B?[x[L],x[1-L]]:[V[0],V[1]];return{greaterHalf:G,lesserHalf:j}},S=O=>{let{greaterHalf:k,lesserHalf:x}=b(O),{greaterHalf:F,lesserHalf:$}=b(k),_=wn(F.flat(1/0)).pop(),L=F.flat().filter(B=>B!==_);return{newlyFilteredChunks:[...x,...$,L],drawPosition:_}},w=O=>!e.includes(O),U=O=>!(I!=null&&I.includes(O)),T=O=>{let k=Rr(O.sort(or),Math.ceil(O.length/4)).map($=>$.filter(U)),x=[].concat(...k.flat(1/0)).length,F=[];for(let $=0;$<x;$++){let{newlyFilteredChunks:_,drawPosition:L}=S(k);F.push(L),k=_}return F},{validSeedBlocks:D}=uh({provisionalPositioning:t,allPositions:!0,appliedPolicies:r,drawDefinition:n,structure:o}),P=D==null?void 0:D.map(O=>{var k;return(k=O.drawPositions)==null?void 0:k.map(x=>x+y)}),E;if(s){let O=v.length,{seedBlocks:k}=tO({cluster:mb(l)===qN,participantsCount:O});E=k.map(x=>x.map(F=>F+y)).map(T).filter(x=>x.length)}else u?E=P==null?void 0:P.map(O=>O.filter(U)):E=P==null?void 0:P.map(T).filter(O=>O.length);let R=g.map(O=>O.drawPositions).map(O=>O==null?void 0:O.sort((k,x)=>k-x)).filter(O=>(O==null?void 0:O[0])+1===(O==null?void 0:O[1])),N=O=>R.reduce((k,x)=>x.includes(O)?x.reduce((F,$)=>$!==O?$:F,void 0):k,void 0),A=E.map(O=>O.map(N)).flat(1/0).filter(U).filter(w).filter(Boolean);if(u&&!o.structures){let O=a%4,k=A.slice(0,O),x=(C=h[o.roundLimit])==null?void 0:C.length,F=Rr(A.slice(O),x).map(wn).flat();A=k.concat(F)}return{unseededByePositions:A}}function Fle({provisionalPositioning:t,drawDefinition:e,matchUpsMap:i,structure:r,event:n}){var P;let a={isCollectionMatchUp:!1},{matchUps:o,roundMatchUps:s}=Wt({afterRecoveryTimes:!1,provisionalPositioning:t,drawDefinition:e,matchUpFilters:a,matchUpsMap:i,structure:r,event:n}),l=(s==null?void 0:s[1])||[],u=(r==null?void 0:r.structureType)===xn,c=u?o:l,d=u?((P=r==null?void 0:r.structures)==null?void 0:P.length)||0:o.length,{structureId:p,stage:m,stageSequence:h}=r,f=Zm({entryStatuses:ls,provisionalPositioning:t,drawDefinition:e,stageSequence:h,structureId:p,stage:m}),{qualifiersCount:g}=Bg({provisionalPositioning:t,drawDefinition:e,stageSequence:h,structureId:p,stage:m}),v=f.length+g,{positionAssignments:y,unassignedPositions:I}=Er({structure:r}),b=I==null?void 0:I.map(E=>E.drawPosition),S=y==null?void 0:y.filter(E=>E.bye).length,w=y==null?void 0:y.filter(E=>E.bye).map(E=>E.drawPosition),U=c.map(E=>E.drawPositions).filter(E=>E==null?void 0:E.reduce((R,N)=>!(w!=null&&w.includes(N))&&R,!0)).flat(1/0).filter(E=>b==null?void 0:b.includes(E)),T=y==null?void 0:y.length,D=T?T-v:0;return D>d&&r.stageSequence===1&&r.stage!==rn&&(D=d),{placedByes:S,byesCount:D,relevantMatchUps:c,placedByePositions:w,roundMatchUps:s,positionsToAvoidDoubleBye:U}}function BB({provisionalPositioning:t,tournamentRecord:e,appliedPolicies:i,drawDefinition:r,seedBlockInfo:n,seedingProfile:a,matchUpsMap:o,structureId:s,structure:l,seedLimit:u,seedsOnly:c,event:d}){var R;l||({structure:l}=et({drawDefinition:r,structureId:s})),s||(s=l==null?void 0:l.structureId);let p=!((l==null?void 0:l.structures)??(l==null?void 0:l.stage)===Ye),{byesCount:m,placedByes:h,relevantMatchUps:f}=Fle({provisionalPositioning:t,drawDefinition:r,matchUpsMap:o,structure:l,event:d}),g=m-(h||0);if(g<=0)return{...J};let{strictSeedOrderByePositions:v,blockSeedOrderByePositions:y,isLuckyStructure:I,isFeedIn:b}=kle({provisionalPositioning:t,relevantMatchUps:f,appliedPolicies:i,drawDefinition:r,seedingProfile:a,seedBlockInfo:n,byesToPlace:g,structure:l}),S=(l==null?void 0:l.structureType)&&[xn,lT].includes(l.structureType)&&((R=i==null?void 0:i.seeding)==null?void 0:R.containerByesIgnoreSeeding),w=p&&(y!=null&&y.length)?y:v,{unseededByePositions:U}=xle({provisionalPositioning:t,seedOrderByePositions:w,isLuckyStructure:I,appliedPolicies:i,drawDefinition:r,seedLimit:u,structure:l,isFeedIn:b}),T=N=>N%2,D=(N,A)=>(N||[]).every(M=>T(M)?A!==M+1:A!==M-1),P=[].concat(...w);if(!c)for(;U.length;){let N=U.find(A=>D(P,A));N?(P.push(N),U=U.filter(A=>A!==N)):(P.push(...U),U=[])}S&&(P=wn(P),Fa({ignoreSeededByes:S})&&console.log({byePositions:P}));let E=P.slice(0,g);for(let N of E){let A=Ya({provisionalPositioning:t,tournamentRecord:e,drawDefinition:r,drawPosition:N,matchUpsMap:o,structureId:s,structure:l,event:d});if(A!=null&&A.error)return A}return{...J,unseededByePositions:U,byeDrawPositions:E}}function hb(t){var M,C,O,k;let{drawDefinition:e}=t,{applyPositioning:i=!0,provisionalPositioning:r,multipleStructures:n,placeByes:a=!0,tournamentRecord:o,placementGroup:s,seedingProfile:l,structureId:u,seedLimit:c,seedsOnly:d,drawType:p,drawSize:m,event:h}=t,f=[];i||(OH(),e=Me(e,!1,!0));let g=x=>(i||PU(),ee({result:x,stack:"automatedPositioning"})),v=x=>(i||PU(),x),y=et({drawDefinition:e,structureId:u});if(y.error)return g(y);let I=y.structure;if(!I)return{error:Mi};let b=t.appliedPolicies||((M=$t({drawDefinition:e,structure:I,event:h}))==null?void 0:M.appliedPolicies),{qualifiersCount:S}=Bg({stageSequence:I.stageSequence,provisionalPositioning:r,stage:I.stage,drawDefinition:e,structureId:u}),w=gp;if(!((C=Zm({stageSequence:I.stageSequence,provisionalPositioning:r,stage:I.stage,placementGroup:s,drawDefinition:e,entryStatuses:w,structureId:u}))!=null&&C.length)&&!S)return v({...J});let U=t.matchUpsMap??sn({drawDefinition:e}),T=t.inContextDrawMatchUps??((O=mr({inContext:!0,drawDefinition:e,matchUpsMap:U}))==null?void 0:O.matchUps),D=[],P=uh({provisionalPositioning:r,appliedPolicies:b,drawDefinition:e,seedingProfile:l,structure:I});if(P.error)return P;let{validSeedBlocks:E}=P;f.push({validSeedBlocks:E});let R=t.participants||(o?(k=Ni({withIndividualParticipants:!0,convertExtensions:!0,tournamentRecord:o}))==null?void 0:k.participants:[]);if(mb(I.seedingProfile||l)===Ad){let x=a?BB({provisionalPositioning:r,tournamentRecord:o,appliedPolicies:b,drawDefinition:e,seedBlockInfo:P,matchUpsMap:U,structure:I,seedLimit:c,seedsOnly:d,event:h}):void 0;if(x!=null&&x.error)return g(x);D=x.unseededByePositions,f.push({action:"positionByes",unseededByePositions:D});let F=I.seedingProfile?{positioning:I.seedingProfile}:l;if(x=_B({seedingProfile:F,provisionalPositioning:r,inContextDrawMatchUps:T,tournamentRecord:o,appliedPolicies:b,validSeedBlocks:E,drawDefinition:e,seedBlockInfo:P,participants:R,matchUpsMap:U,structure:I,event:h}),x.error)return g(x);f.push({seedPositions:x.seedPositions,action:"positionSeedBlocks"})}else{if(p!==cp){let F=I.seedingProfile?{positioning:I.seedingProfile}:l,$=_B({seedingProfile:F,provisionalPositioning:r,inContextDrawMatchUps:T,tournamentRecord:o,appliedPolicies:b,validSeedBlocks:E,drawDefinition:e,seedBlockInfo:P,participants:R,matchUpsMap:U,structure:I,event:h});if($.error)return g($);f.push({action:"positionSeedBlocks",seedPositions:$.seedPositions})}let x=a?BB({provisionalPositioning:r,tournamentRecord:o,appliedPolicies:b,drawDefinition:e,seedBlockInfo:P,matchUpsMap:U,structure:I,seedLimit:c,seedsOnly:d,event:h}):void 0;if(x!=null&&x.error)return g(x);D=x==null?void 0:x.unseededByePositions,f.push({action:"positionByes",byeDrawPositions:x==null?void 0:x.byeDrawPositions,unseededByePositions:D})}let N={};if(!d){let x=Cle({inContextDrawMatchUps:T,tournamentRecord:o,appliedPolicies:b,validSeedBlocks:E,drawDefinition:e,seedBlockInfo:P,participants:R,matchUpsMap:U,structure:I});if(x.error||(x.conflicts&&(N.qualifierConflicts=x.conflicts),f.push({action:"positionQualifiers",qualifierDrawPositions:x.qualifierDrawPositions}),x=Rle({provisionalPositioning:r,inContextDrawMatchUps:T,unseededByePositions:D,multipleStructures:n,tournamentRecord:o,drawDefinition:e,seedBlockInfo:P,participants:R,matchUpsMap:U,structureId:u,structure:I,drawSize:m,event:h}),x.error))return g(x);x.conflicts&&(N.unseededConflicts=x.conflicts),f.push({action:"positionUnseededParticipants"})}let{positionAssignments:A}=oi({drawDefinition:e,structure:I});return li({drawDefinition:e,structureIds:[u]}),i||PU(),{positionAssignments:A,conflicts:N,...J,positioningReport:f}}function Gg(t){var p;let{applyPositioning:e=!0,provisionalPositioning:i,tournamentRecord:r,drawDefinition:n,seedingProfile:a,structureId:o,placeByes:s,seedsOnly:l}=t;if(!n)return{error:xa};if(!Ec({drawDefinition:n,structureId:o})&&!i)return{error:cN};let u=(p=Nq({drawDefinition:n,structureId:o}).playoffStructures)==null?void 0:p.sort((m,h)=>wS(m)-wS(h)),c=[],d=[];if(u)for(let m of u){let{structureId:h}=m,f=hb({structureId:h,provisionalPositioning:i,applyPositioning:e,tournamentRecord:r,drawDefinition:n,seedingProfile:a,placeByes:s,seedsOnly:l});if(f.error)return f;f.positionAssignments&&c.push({positionAssignments:f.positionAssignments,structureId:h}),f.positioningReport&&d.push(f.positioningReport)}return{...J,structurePositionAssignments:c,positioningReports:d}}function xq({drawDefinition:t,orderMap:e}){return t?((typeof e!="object"||!Object.values(e).every(i=>ot(i)))&&ee({result:{error:oe},context:{orderMap:e}}),t.structures||(t.structures=[]),t.structures.forEach(i=>{let r=e[i.structureId];r&&(i.structureOrder=r)}),t.structures.sort((i,r)=>Sf(i.structureOrder)-Sf(r.structureOrder)),{...J}):{error:_e}}function HT({drawDefinition:t}){var g,v,y,I,b,S,w;let e=t.structures??[],i=t.links??[],r=new Map,n=U=>{let T=r.get(U)||r.set(U,{drawSources:[],drawTargets:[],progeny:[],sources:[],targets:[]})&&r.get(U);if(T&&!(T!=null&&T.stage)){let D=e.find(P=>P.structureId===U);T.stage=D==null?void 0:D.stage}return T},a={},o={},s=i.map(U=>{let T=U.source.structureId,D=U.target.structureId,P=n(T),E=n(D);return[Od,Lo,uT,Ad].includes(U.target.feedProfile)?(P==null||P.targets.push(D),E==null||E.sources.push(T)):U.target.feedProfile===ko&&(E==null||E.drawSources.push(T),P==null||P.drawTargets.push(D)),o[D]=o[D]||U.target.feedProfile===ko,a[D]=ct([...a[D]||[],T]).filter(Boolean),[U.source.structureId,U.target.structureId]});for(let U of r.keys()){let T=r.get(U);if(T){let D=T.targets??[];for(;D.length;){let P=D.pop(),E=P&&r[P];(g=E==null?void 0:E.targets)!=null&&g.length?D.push(...E.targets):E&&(T.rootStage=E.stage)}if(T.rootStage||(T.rootStage=T.stage),!((v=T.targets)!=null&&v.length)){let P=T.sources??[];for(;P.length;){let E=P.pop(),R=E&&r[E];if((y=R==null?void 0:R.sources)!=null&&y.length){for(let N of R.sources)(I=T.progeny)!=null&&I.includes(N)||((b=T.progeny)==null||b.push(N));P.push(...R.sources)}}}}}let l=0;for(let U of r.keys()){let T=r.get(U);if(T&&T.rootStage===Ye){let D=[(S=T.drawTargets)==null?void 0:S[0]],P=0;for(;D.length;){P+=1;let E=D.pop(),R=E?r.get(E):void 0;(w=R==null?void 0:R.drawTargets)!=null&&w.length&&D.push(R.drawTargets[0])}T.distanceFromMain=P,P>l&&(l=P)}}let u=s.length;Se(0,Math.ceil(u/2)).forEach(()=>{s=Se(0,u).map(U=>{let T=s[U],D=s.reduce((P,E)=>Rn(T,E)?P.concat(...E):P,[])||[];return ct(T.concat(...D))})});let c=s[0],d=(U,T)=>Vi(U,T).length===U.length,p=s.slice(1).reduce((U,T)=>U&&d(T,c),!0),m=[c].filter(Boolean),h=[c].filter(Boolean);e.forEach(U=>{let{structureId:T,stage:D}=U;m.find(P=>P.includes(T))||(m.push([T]),D!==Or&&h.push([T]))});let f=p&&h.length===1;return!(i!=null&&i.length)&&e.length===1&&n(e[0].structureId),{structureProfiles:Object.fromEntries(r),allStructuresLinked:f,maxQualifyingDepth:l,sourceStructureIds:a,hasDrawFeedProfile:o,structureGroups:m}}function Fq({drawDefinition:t}){let{maxQualifyingDepth:e,structureProfiles:i}=HT({drawDefinition:t});for(let r of t.structures){let n=i[r.structureId];n.distanceFromMain&&(r.stageSequence=e+1-n.distanceFromMain)}return{...J}}function cO(t){let e=ze(t,[{[wr]:!0,[Fn]:!0}]);if(e.error)return e;let{tournamentRecord:i,drawDefinition:r,structure:n,link:a}=t;return Lle({tournamentId:i.tournamentId,drawDefinition:r,structure:n,link:a})}function Lle(t){var c;let e=ze(t,[{[Fn]:!0,[fT]:!0},{link:!0,[Xn]:ea,[wG]:fN}]);if(e.error)return e;let{drawDefinition:i,tournamentId:r,structure:n,eventId:a,link:o}=t,s=o.target.structureId,l=et({drawDefinition:i,structureId:s});if(l.error)return ee({stack:"attachQualifyingStructure",context:{targetStructureId:s},result:l});i.structures||(i.structures=[]),i.links||(i.links=[]),i.structures.push(n),i.links.push(o),Fq({drawDefinition:i});let u=((c=Wt({structure:n}))==null?void 0:c.matchUps)||[];return Dc({drawDefinition:i,tournamentId:r,matchUps:u,eventId:a}),li({drawDefinition:i,structureIds:[n.structureId]}),{...J}}function Lq({drawDefinition:t,structureDetails:e}){if(!Array.isArray(e))return{error:oe};if(!t)return{error:_e};let i=Object.assign({},...e.map(r=>{if(!Nt(r))return;let{structureId:n,structureName:a}=r||{};if(!(!n||!a))return{[n]:a}}).filter(Boolean));if(!Object.values(i).length)return{error:Xe};for(let r of t.structures||[]){let n=i[r.structureId];if(n&&(r.structureName=n),r.structures)for(let a of r.structures){let o=i[a.structureId];o&&(a.structureName=o)}}return{...J}}function dO({drawDefinition:t,timeItem:e}){if(!t)return{error:xa};if(!e)return{error:MN};let i=e&&Object.keys(e),r=["itemType","itemValue"];if(r.filter(a=>i.includes(a)).length!==r.length)return{error:CN};t.timeItems||(t.timeItems=[]);let n=new Date().toISOString();return Object.assign(e,{createdAt:n}),t.timeItems.push(e),Hy({drawDefinition:t}),{...J}}function _q(t){var v;let{tournamentRecord:e,drawDefinition:i,structureId:r,event:n}=t,a=ze(t,[{drawDefinition:!0,structureId:!0}]);if(a.error)return a;let o=i.structures??[],s=o.find(y=>y.structureId===r);if(!s)return{error:Mi};let l=o.find(({stage:y,stageSequence:I})=>y===Oe&&I===1),u=r===(l==null?void 0:l.structureId),c=o.filter(({stage:y})=>y===Ye).map(Ta("structureId"));if(u&&!c.length)return{error:SG};let d=c.includes(r),p=_le({isQualifyingStructure:d,structure:s,...t});if(p!=null&&p.error)return p;let{structureIdsToRemove:m,relatedStructureIdsMap:h}=Ble({qualifyingStructureIds:c,isQualifyingStructure:d,isMainStageSequence1:u,mainStageSequence1:l,drawDefinition:i,structureId:r}),{removedMatchUpIds:f,removedStructureIds:g}=Vle({relatedStructureIdsMap:h,qualifyingStructureIds:c,isMainStageSequence1:u,mainStageSequence1:l,drawDefinition:i,structureIdsToRemove:m,structureId:r});if($le({removedMatchUpIds:f,drawDefinition:i}),u){let y=(v=l.matchUps??[])==null?void 0:v.map(Ta("matchUpId"));f.push(...y),l.positionAssignments=[],l.seedAssignments=[],l.matchUps=[],l.extensions&&(l.extensions=[])}return d&&Fq({drawDefinition:i}),zu({tournamentId:e==null?void 0:e.tournamentId,matchUpIds:f,action:"removeStructure",eventId:n==null?void 0:n.eventId,drawDefinition:i}),li({drawDefinition:i,eventId:n==null?void 0:n.eventId}),{...J,removedMatchUpIds:f,removedStructureIds:g}}function _le({isQualifyingStructure:t,tournamentRecord:e,drawDefinition:i,structureId:r,structure:n,event:a,force:o}){var l,u,c,d,p,m;let s=[r];if(t){let h=g=>{var v;return(v=i.links)==null?void 0:v.find(y=>y.target.structureId===g)},f=(l=h(r))==null?void 0:l.source.structureId;for(;f;)s.push(f),f=(u=h(f))==null?void 0:u.source.structureId}if((c=mr({matchUpFilters:{structureIds:s},drawDefinition:i}).matchUps)!=null&&c.some(({score:h})=>Ir({score:h}))){let h=(d=$t({tournamentRecord:e,drawDefinition:i,structure:n,event:a}))==null?void 0:d.appliedPolicies;if(!(o??((m=(p=h==null?void 0:h[Rs])==null?void 0:p.allowDeletionWithScoresPresent)==null?void 0:m.structures)))return{error:eT}}return{...J}}function $le({removedMatchUpIds:t,drawDefinition:e}){let{matchUps:i}=mr({drawDefinition:e});i==null||i.forEach(r=>{r.winnerMatchUpId&&t.includes(r.winnerMatchUpId)&&delete r.winnerMatchUpId,r.loserMatchUpId&&t.includes(r.loserMatchUpId)&&delete r.loserMatchUpId})}function Ble({qualifyingStructureIds:t,isQualifyingStructure:e,isMainStageSequence1:i,mainStageSequence1:r,drawDefinition:n,structureId:a}){let o=(n.structures??[]).map(Ta("structureId")),s=c=>{var d;return((d=n.links)==null?void 0:d.map(p=>p.source.structureId===c&&p.target.structureId!==(r==null?void 0:r.structureId)&&p.target.structureId).filter(Boolean))??[]},l=c=>{var d;return((d=n.links)==null?void 0:d.map(p=>t.includes(p.source.structureId)&&p.target.structureId===c&&p.source.structureId).filter(Boolean))??[]},u=new Map;return o.forEach(c=>u.set(c,e?l(c):s(c))),{structureIdsToRemove:i?u.get(a):[a],relatedStructureIdsMap:u}}function Vle({relatedStructureIdsMap:t,qualifyingStructureIds:e,isMainStageSequence1:i,mainStageSequence1:r,drawDefinition:n,structureIdsToRemove:a,structureId:o}){let s=[],l=[];for(;a!=null&&a.length;){let u=a.pop();l.push(...Hle({idBeingRemoved:u,drawDefinition:n}));let c=Gle({qualifyingStructureIds:e,isMainStageSequence1:i,idBeingRemoved:u,drawDefinition:n,structureId:o});s.push(...c.removedStructureIds);let d=jle({relatedStructureIdsMap:t,mainStageSequence1:r,idBeingRemoved:u,structureId:o});d!=null&&d.length&&a.push(...d)}return{removedMatchUpIds:l,removedStructureIds:s}}function jle({idBeingRemoved:t,relatedStructureIdsMap:e,mainStageSequence1:i,structureId:r}){var n;return t&&((n=e.get(t))==null?void 0:n.filter(a=>a!==(i==null?void 0:i.structureId)||r===i.structureId))}function Gle({qualifyingStructureIds:t,isMainStageSequence1:e,idBeingRemoved:i,drawDefinition:r,structureId:n}){var o;let a=[];return r.links=((o=r.links)==null?void 0:o.filter(s=>s.source.structureId!==i&&s.target.structureId!==i))??[],(!e||e&&t.length||i!==n)&&(r.structures=(r.structures??[]).filter(s=>(i&&i===s.structureId&&a.push(i),s.structureId!==i))),{removedStructureIds:a}}function Hle({idBeingRemoved:t,drawDefinition:e}){let{structure:i}=et({structureId:t,drawDefinition:e}),r=Wt({structure:i}).matchUps;return mA(r)}function MS({stageSequence:t=1,drawDefinition:e,drawSize:i,stage:r}){if(!e)return{error:_e};if(!LA({drawDefinition:e,stage:r}))return{error:up};let n=zoe({drawDefinition:e,stage:r}),{qualifiersCount:a}=Bg({drawDefinition:e,stageSequence:t,stage:r}),o=n+a;if(i<o)return{error:hN};let{entryProfile:s}=FA({attributes:[{[r]:{drawSize:i}}],drawDefinition:e});return li({drawDefinition:e}),{...J,entryProfile:s}}function $q({qualifiersCount:t=0,drawDefinition:e,stage:i}){return e?LA({drawDefinition:e,stage:i})?i!==Oe?{error:hN,info:"qualifiersCount can only be set for main stage"}:(FA({attributes:[{[i]:{qualifiersCount:t}}],drawDefinition:e}),li({drawDefinition:e}),{...J}):{error:up}:{error:_e}}function zle({drawDefinition:t,drawSize:e}){if(!t)return{error:_e};let i=MS({stage:Or,stageSequence:1,drawDefinition:t,drawSize:e});return i.error?i:(li({drawDefinition:t}),{...J})}function Bq(t){return zle(t)}var Wle="qualifierDrawPositionAssignment",qle="withdrawParticipantAtDrawPosition",Yle="alternateDrawPositionAssignment",Kle="luckyLoserDrawPositionAssignment",VB="removeDrawPositionAssignment",Vq="swapDrawPositionAssignments",Xle="modifyPairAssignment",Jle="adHocPositionSwap",Qle="modifyParticipantOtherName",jB="assignDrawPosition",Zle="removeSeededParticipant",eue="assignDrawPositionBye",tue="modifySeedAssignment",jq="addPenalty",pO="MODIFY_PAIR",zT="QUALIFIER",mO="ALTERNATE",hO="WITHDRAW",Dm="ASSIGN",HC="REMOVE",fO="LUCKY",xU="REMOVE_SEED",WT="SWAP",NS="NICKNAME",Jv="SEED_VALUE",jf="PENALTY",AS="BYE",iue={MODIFY_PAIR_ASSIGNMENT:pO,QUALIFYING_PARTICIPANT:zT,ALTERNATE_PARTICIPANT:mO,WITHDRAW_PARTICIPANT:hO,ASSIGN_PARTICIPANT:Dm,LUCKY_PARTICIPANT:fO,REMOVE_ASSIGNMENT:HC,SWAP_PARTICIPANTS:WT,ADD_NICKNAME:NS,REMOVE_SEED:xU,ADD_PENALTY:jf,ASSIGN_BYE:AS,SEED_VALUE:Jv};function Gq({tournamentRecord:t,drawDefinition:e,drawPositions:i,structureId:r,event:n}){if(!e)return{error:_e};if(!r)return{error:za};if((i==null?void 0:i.length)!==2)return{error:oe,drawPositions:i};let a=sn({drawDefinition:e}),{matchUps:o}=mr({inContext:!0,drawDefinition:e,matchUpsMap:a}),{structure:s}=et({drawDefinition:e,structureId:r});if(!s)return{error:Mi};let l=$t({tournamentRecord:t,drawDefinition:e,event:n}).appliedPolicies??{},u;if(s.structureType===xn?u=aue({inContextDrawMatchUps:o,tournamentRecord:t,drawDefinition:e,drawPositions:i,matchUpsMap:a,structure:s,event:n}):u=rue({inContextDrawMatchUps:o,tournamentRecord:t,drawDefinition:e,drawPositions:i,matchUpsMap:a,structure:s,event:n}),u.error)return u;if(NA({structure:s,drawPositions:i}),RT({appliedPolicies:l,drawDefinition:e,positionAction:{name:Vq,drawPositions:i,structureId:r}}),Pc({tournamentId:t==null?void 0:t.tournamentId,drawDefinition:e,structure:s,event:n}),n.eventType===Sa){let c=Wt({matchUpFilters:{matchUpTypes:[ka]},inContext:!0,structure:s}).matchUps.filter(p=>{var m;return(m=p.drawPositions)==null?void 0:m.some(h=>i.includes(h))}),d=Wt({matchUpFilters:{matchUpTypes:[ka]},structure:s}).matchUps;c.forEach(p=>{(p.sides||[]).forEach(m=>{var f;let h=m==null?void 0:m.drawPosition;if(i.includes(h)){let g=m.participantId,v=d.find(({matchUpId:I})=>I===p.matchUpId),y=(f=p==null?void 0:p.sides)==null?void 0:f.reduce((I,b,S)=>b.drawPosition===h?S:I,void 0);nO({inContextTargetMatchUp:p,drawPositionSideIndex:y,teamParticipantId:g,tournamentRecord:t,drawDefinition:e,matchUp:v,event:n})}})})}return li({drawDefinition:e,structureIds:[r]}),{...J}}function rue({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPositions:r,matchUpsMap:n,structure:a,event:o}){let s=a==null?void 0:a.positionAssignments.filter(u=>r==null?void 0:r.includes(u.drawPosition));if(!s)return{error:oe,structure:a,info:"Missing positionAssignments"};if(s.filter(({bye:u})=>u).length===2)return{...J};if(s.filter(({qualifier:u})=>u).length===2)return{...J};let l=s.some(({qualifier:u})=>u);return s.some(({bye:u})=>u)&&!l?Hq({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:s,matchUpsMap:n,structure:a,event:o}):nue({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:s,matchUpsMap:n,structure:a,event:o})}function Hq({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:r,matchUpsMap:n,structure:a,event:o}){let s=r.find(({bye:h})=>h),l=r.find(({participantId:h})=>h),u=s.drawPosition,{participantId:c,drawPosition:d}=l,{structureId:p}=a,m=FI({drawPosition:u,inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:p,matchUpsMap:n});return m.error||(m=FI({drawPosition:d,inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:p,matchUpsMap:n}),m.error)||(Ya({drawPosition:d,tournamentRecord:e,drawDefinition:i,structureId:p,matchUpsMap:n,event:o}),m=rl({drawPosition:u,inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:p,participantId:c,matchUpsMap:n,event:o}),m.error)?m:{...J}}function nue({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:r,matchUpsMap:n,structure:a,event:o}){let s=Object.assign({},...r.map((l,u)=>{let{drawPosition:c}=l,d={...r[1-u],drawPosition:c};return{[c]:d}}));return a.positionAssignments=a.positionAssignments.map(l=>s[l.drawPosition]||l),oO({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,matchUpsMap:n,assignments:r,structure:a,event:o}),{...J}}function aue({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPositions:r,matchUpsMap:n,structure:a,event:o}){var u;let s=(u=a.structures)==null?void 0:u.reduce((c,d)=>{let p=d==null?void 0:d.positionAssignments.filter(m=>r==null?void 0:r.includes(m.drawPosition));return p&&c.push(...p),c},[]);if(s.filter(({bye:c})=>c).length===2)return{...J};if(s.filter(({qualifier:c})=>c).length===2)return{...J};oO({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,matchUpsMap:n,assignments:s,structure:a,event:o});let l=s.some(({qualifier:c})=>c);if(s.some(({bye:c})=>c)&&!l)Hq({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:s,matchUpsMap:n,structure:a,event:o});else{let c=Me(s,!1,!0);s.forEach((d,p)=>{let m=c[1-p].participantId;d.qualifier=c[1-p].qualifier,d.participantId=m})}return{...J}}function zq({tournamentRecord:t,drawDefinition:e,participantId:i,structureId:r}){var o;let n="removeSeededParticipant";if(!t)return{error:ge};if(!e)return{error:_e};let a=(e.structures??[]).find(s=>s.structureId===r);return a?!a.stage||![Oe,Ye].includes(a.stage)||a.stage===Oe&&a.stageSequence!==1?ee({result:{error:sp},stack:n}):(o=a.seedAssignments)!=null&&o.find(s=>s.participantId===i)?{...J}:ee({info:"participant not seeded",result:{error:$r},context:{participantId:i}}):ee({result:{error:Mi},stack:n})}function fb({targetEntryRound:t=1,finishingPositions:e,sourceRoundNumber:i,sourceStructureId:r,targetStructureId:n,linkType:a=Su}){return!r||!n?{error:za}:{link:Ge({linkType:a,source:{roundNumber:i,structureId:r,finishingPositions:e},target:{feedProfile:ko,roundNumber:t,structureId:n}})}}function gO({roundPosition:t,roundNumber:e,idPrefix:i,uuids:r}){return i?`${i}-${e}-${t}`:(r==null?void 0:r.pop())||Gt()}function OS({includeMatchUpType:t,matchUpType:e,roundNumber:i,matchUps:r,idPrefix:n,isMock:a,uuids:o,nodes:s}){let l=0,u=[],c=1,d=i-1,p=s==null?void 0:s.length;for(;l<(p||0);){let m=s==null?void 0:s[l],h=s==null?void 0:s[l+1];d&&(m.roundNumber=d),h&&d&&(h.roundNumber=d);let f=gO({roundPosition:c,roundNumber:i,idPrefix:n,uuids:o}),g={roundPosition:c,children:[m,h],matchUpId:f};u.push(g);let v={drawPositions:g.children.map(y=>y==null?void 0:y.drawPosition).filter(Boolean),matchUpStatus:Ji,matchUpId:g.matchUpId,roundPosition:c,roundNumber:i};t&&e&&(v.matchUpType=e),a&&(v.isMock=!0),r.push(v),c++,l+=2}return{roundNodes:u,matchUps:r}}function nl({finishingPositionOffset:t,finishingPositionLimit:e,qualifyingRoundNumber:i,qualifyingPositions:r,matchUpType:n,roundLimit:a,idPrefix:o,drawSize:s,isMock:l,uuids:u}){if(isNaN(s)||s<2||r&&s<=r)return{matchUps:[],roundsCount:0};if(r&&(!Ss(s)||s%r)){let g=r;for(;g<s;)g=2*g;s=g}let c=r&&!(s%2)&&(!isNaN(r)||i&&!isNaN(i))&&(s/r===Math.round(s/r)||i&&s/i===Math.round(s/i));if(!Ss(s)&&!c)return{matchUps:[],roundsCount:0};let d=Se(1,s+1).map(g=>({drawPosition:g})),p,m=[],h=1;for({roundNodes:p,matchUps:m}=OS({matchUpType:n,roundNumber:h,idPrefix:o,matchUps:m,isMock:l,nodes:d,uuids:u}),h++,a=a??i;p.length>1;)r&&p.length===r&&(a=h-1),{roundNodes:p,matchUps:m}=OS({nodes:p,matchUpType:n,roundNumber:h,idPrefix:o,matchUps:m,isMock:l,uuids:u}),h++;let f=h-1;return m=nb({finishingPositionOffset:t,finishingPositionLimit:e,roundsCount:f,roundLimit:a,matchUps:m}),a?m=m.filter(g=>a&&(g.roundNumber??0)<=a):a=h-1,{drawSize:s,matchUps:m,roundsCount:f,roundLimit:a}}function vO(t){var k,x,F,$,_,L;let e="generateQualifyingStructure";if(!t.drawDefinition)return ee({result:{error:_e},stack:e});if(t.drawSize&&!ot(t.drawSize)||t.participantsCount&&!ot(t.participantsCount)||t.qualifyingPositions&&!ot(t.qualifyingPositions))return ee({result:{error:oe},stack:e});let i=t.drawSize??lN(t.participantsCount),{qualifyingRoundNumber:r,qualifyingPositions:n,targetStructureId:a,structureOptions:o,appliedPolicies:s,drawDefinition:l,matchUpFormat:u,structureName:c,structureId:d,roundTarget:p,drawType:m,idPrefix:h,isMock:f,uuids:g}=t;if(!t.drawSize)return ee({result:{error:Ey},context:{drawSize:i},stack:e});if(n&&n>=t.drawSize)return ee({result:{error:oe},context:{drawSize:i,qualifyingPositions:n},stack:e});let v,y,I,b,S=0,w,U=1,{structureProfiles:T}=HT({drawDefinition:l}),D=T[a];if(!D)return ee({result:{error:Mi},context:{targetStructureId:a},stack:e});let P=l.matchUpType,E=p?`${p}-`:"",R=D.stage===Ye,N=((x=(k=s==null?void 0:s[xf])==null?void 0:k.namingConventions)==null?void 0:x.pre)??(($=(F=Koe[xf])==null?void 0:F.namingConventions)==null?void 0:$.pre),A=R&&N?`${N}-`:"",M=c??(E?`${A}${Zr(Ye)} ${E}`:`${A}${Zr(Ye)}`);if(m===Jo){let{maxRoundNumber:B,structures:V,groupCount:G}=db({structureName:c??M,structureId:d??(g==null?void 0:g.pop()),stage:Ye,structureOptions:o,appliedPolicies:s,stageSequence:U,matchUpType:P,roundTarget:p,idPrefix:h,drawSize:i,isMock:f,uuids:g});S=G,v=B,I=V[0],w=[1]}else({drawSize:i,matchUps:b,roundLimit:v,roundsCount:y}=nl({qualifyingRoundNumber:r,qualifyingPositions:n,matchUpType:P,idPrefix:h,drawSize:i,isMock:f,uuids:g})),v||(v=y),I=ao({structureName:c??M,structureId:d??(g==null?void 0:g.pop()),qualifyingRoundNumber:v,stage:Ye,matchUpFormat:u,stageSequence:U,matchUpType:P,roundLimit:v,matchUps:b}),p&&Lt({extension:{name:gl,value:p},element:I}),S=(_=b==null?void 0:b.filter(B=>B.roundNumber===v))==null?void 0:_.length;let C=m===Jo?Uu:Su,O=I&&v&&((L=fb({sourceStructureId:I.structureId,sourceRoundNumber:v,targetStructureId:a,finishingPositions:w,linkType:C}))==null?void 0:L.link);return{qualifyingDrawPositionsCount:i,qualifiersCount:S,...J,structure:I,link:O}}function Wq(t){if(!t.tournamentRecord)return{error:ge};let e=oue(t);return e.error,e}function oue(t){if(!t.drawDefinition)return{error:_e};if(!t.targetStructureId)return{error:za};let e=vO(t);if(e.error)return e;let{structure:i,link:r}=e;return!i||!r?{error:oe}:cO({tournamentRecord:t.tournamentRecord,drawDefinition:t.drawDefinition,structure:i,link:r})}function qq(t){var d;let e=ze(t,[{[Fn]:!0,[pT]:!0,[fl]:!0},{[Qae]:!0,[Kr]:p=>Number.isInteger(p)&&p>0},{[Kr]:p=>Array.isArray(p)&&p.length===2&&p.every(Ti),[_a]:va,participantIds:!0}]);if(e.error)return e;let{drawDefinition:i,structureId:r,tournamentRecord:n,event:a}=t,{structure:o}=et({drawDefinition:i,structureId:r});if(!o)return{error:Mi};if(!zn({structure:o}))return{error:sp};let s=p=>{var m;return(m=p.sides)==null?void 0:m.map(h=>h.participantId).some(h=>t.participantIds.includes(h))},l=p=>p.roundNumber===t.roundNumber,u=p=>!Ir(p),c=((o==null?void 0:o.matchUps)??[]).filter(l).filter(u).filter(s);if(c.length!==2)return{error:va};for(let p of c){let m=(d=p==null?void 0:p.sides)==null?void 0:d.find(h=>t.participantIds.includes(h==null?void 0:h.participantId));if(m){let h=t.participantIds.find(f=>f!==(m==null?void 0:m.participantId));m.participantId=h,Rt({tournamentId:n==null?void 0:n.tournamentId,eventId:a==null?void 0:a.eventId,drawDefinition:i,matchUp:p})}}return li({drawDefinition:i,structureIds:[r]}),{...J}}function sue({includeMatchUpType:t,drawPosition:e,roundNumber:i,matchUpType:r,idPrefix:n,matchUps:a,isMock:o,uuids:s,nodes:l,fed:u}){let c=l.length,d=e?e-c:void 0,p=Se(0,c).map(f=>d?d+f:void 0),m=[];for(let f=0;f<c;f++){let g=p.shift(),v={drawPosition:g,fed:u+1,feed:!0},y=l[f];y.roundNumber=i-1;let I=gO({roundPosition:y.roundPosition,roundNumber:i,idPrefix:n,uuids:s}),b={roundPosition:y.roundPosition,drawPositions:[g],matchUpStatus:Ji,roundNumber:i,matchUpId:I};t&&(b.matchUpType=r),o&&(b.isMock=!0),a.push(b);let S={children:[y,v]};m.push(S)}let h=e?e-c:void 0;return{roundNodes:m,matchUps:a,drawPosition:h}}function Cc(t){let e=t.drawSize,{feedRoundsProfile:i,feedRounds:r=0,skipRounds:n=0,baseDrawSize:a}=t,{linkFedFinishingRoundNumbers:o,finishingPositionOffset:s,linkFedRoundNumbers:l,feedsFromFinal:u,isConsolation:c,matchUpType:d,idPrefix:p,isMock:m,uuids:h,fmlc:f}=t;a=a??A(e);let g=lue({drawSize:a}),v=g.length,y=0;if(i!=null&&i.length)y=i.reduce((M,C)=>M+C,0);else if(e){let M=e-a;i=g.filter(C=>C<=M?(M-=C,!0):!1),y=i.reduce((C,O)=>C+O,0),r=i.length}else n>=v?r=0:u&&(r=v-u,n=0),i=g.filter((M,C)=>u&&!r||r&&C>=n+r||C<n?0:M),y=i.reduce((M,C)=>M+C,0),r=i.length;let I=[...g,...i].sort((M,C)=>C-M),b=I.length,S=[...(l??[]).map(M=>M-1),...(o??[]).map(M=>b-M)].map(M=>I[M]).reduce((M,C)=>M+C,0);y=y-S;let w=0,U=[],T,D=1,P=Se(0,a).map((M,C)=>({drawPosition:C+1+y})),E=y+1;for(let M of g){if({roundNodes:T,matchUps:U}=OS({matchUpType:d,roundNumber:D,idPrefix:p,matchUps:U,isMock:m,nodes:P,uuids:h}),D++,i.includes(M)){let C=wa(i)[M],O=Se(0,C),k=b+1-D,x=(o==null?void 0:o.includes(k))??(l==null?void 0:l.includes(D));O.forEach(()=>{({roundNodes:T,matchUps:U,drawPosition:E}=sue({drawPosition:!x&&E||void 0,nodes:T,matchUpType:d,roundNumber:D,idPrefix:p,matchUps:U,isMock:m,uuids:h,fed:w})),D++,w+=1})}P=T}b!==D-1&&console.log("ERROR");let R=a-y;U=nb({finishingPositionOffset:c?R:s,positionsFed:y,roundsCount:b,matchUps:U,fmlc:f});let N=T!=null&&T.length?T[0]:T;return N&&(N.roundNumber=D-1,N.matchUps=U),{draw:N,matchUps:U,roundsCount:b};function A(M){let C=uN(M);return C>M?C/2:C}}function lue({drawSize:t}){let e=Math.ceil(Math.log(t)/Math.log(2));return Se(0,e).reverse().map(i=>Math.pow(2,i))}function If(t){let{finishingPositionOffset:e=0,addNameBaseToAttributeName:i,playoffStructureNameBase:r,finishingPositionNaming:n,finishingPositionLimit:a,playoffAttributes:o,stageSequence:s=1,exitProfile:l="0",exitProfileLimit:u,roundOffsetLimit:c,roundOffset:d=0,drawDefinition:p,staggeredEntry:m,sequenceLimit:h,stage:f=Oe,drawSize:g,idPrefix:v,isMock:y,uuids:I}=t;if(!(!o||!u||o!=null&&o[l])||g<2||h&&s>h)return{};let b=[],S=[],w=[],U=t.matchUpType??(p==null?void 0:p.matchUpType),T=e+1,D=e+g,P=`${T}-${D}`,E=o==null?void 0:o[l],R=r&&`${r} `||"",N=(o==null?void 0:o[P])??(n==null?void 0:n[P]),A=t.structureName||(N==null?void 0:N.name)||(E==null?void 0:E.name)&&(i?`${R}${E==null?void 0:E.name}`:E.name)||`${R}${P}`,M=(N==null?void 0:N.abbreviation)??(E==null?void 0:E.abbreviation),C=t.structureId??(E==null?void 0:E.structureId)??(I==null?void 0:I.pop()),O={idPrefix:v&&`${v}-${A}-RP`,finishingPositionOffset:e,matchUpType:U,drawSize:g,isMock:y,uuids:I},{matchUps:k}=m?Cc(O):nl(O),x=ao({structureAbbreviation:M,stageSequence:s,structureName:A,matchUpType:U,roundOffset:d,structureId:C,matchUps:k,stage:f});b.push(...k),S.push(x);let F=Math.ceil(Math.log(g)/Math.log(2)),$=c?Math.min(c-d,F):(!a||T<a)&&F||0;return g>2&&Se(1,$+1).forEach(L=>_(L)),{structureId:x.structureId,matchUps:b,structureName:A,structures:S,links:w,...J};function _(L){let B=g/Math.pow(2,L);if(B<2)return;let V=g/Math.pow(2,L)+e;if(a&&V+1>a)return;let{structures:G,structureId:j,matchUps:z,links:W}=If({finishingPositionOffset:V,exitProfile:`${l}-${L}`,roundOffset:d+L,stageSequence:s+1,drawSize:B,addNameBaseToAttributeName:i,playoffStructureNameBase:r,finishingPositionNaming:n,finishingPositionLimit:a,playoffAttributes:o,exitProfileLimit:u,roundOffsetLimit:c,drawDefinition:p,sequenceLimit:h,matchUpType:U,idPrefix:v,uuids:I,stage:f});if(x.structureId&&j){let q={linkType:jl,source:{roundNumber:L,structureId:x.structureId},target:{roundNumber:1,feedProfile:Lo,structureId:j}};W&&x&&W.push(q),W!=null&&W.length&&w.push(...W)}return G!=null&&G.length&&S.push(...G),z!=null&&z.length&&b.push(...z),{structureId:j,childLinks:W,structures:S}}}function IO({drawDefinition:t,matchUpsMap:e,structureId:i}){let r=et({drawDefinition:t,structureId:i});if(r.error)return ee({result:r});let{matchUps:n}=Wt({structure:r.structure,matchUpsMap:e});return{...En({matchUps:n}),matchUps:n,matchUpsMap:e}}function GB({finishingPositions:t,drawDefinition:e,structureId:i}){var n;let{roundProfile:r}=IO({drawDefinition:e,structureId:i});return(n=r&&Object.keys(r))==null?void 0:n.reduce((a,o)=>(Yq(r==null?void 0:r[o]).forEach(s=>{t.forEach(l=>{uue({position:l,rangeDefinition:s})&&(a[l]={roundNumber:o})})}),a),{})}function uue({position:t,rangeDefinition:e}){if(!Array.isArray(e)||e.reduce((n,a)=>n||isNaN(a),!1))return!1;let[i,r]=e;return Se(i,(r||i)+1).includes(t)}function Yq(t){var e,i;return[ct(((e=t==null?void 0:t.finishingPositionRange)==null?void 0:e.loser)||[]),ct(((i=t==null?void 0:t.finishingPositionRange)==null?void 0:i.winner)||[])]}function cue(t){return Yq(t).map(e=>Se(e[0],e[1]&&e[1]+1||e[0]+1))}function Hg({drawDefinition:t,structureIds:e,matchUpsMap:i}){if(e&&!Array.isArray(e))return{error:oe,context:{structureIds:e}};if(!t)return{error:_e};e=e??(t.structures??[]).filter(a=>a.stage!==Ye).map(({structureId:a})=>a);let r=e.map(a=>{var s;let{roundProfile:o}=IO({drawDefinition:t,matchUpsMap:i,structureId:a});return(s=o&&Object.values(o))==null?void 0:s.map(cue).flat()}).flat(),n=r.filter(a=>(a==null?void 0:a.length)===1).sort(or).flat();return{positionsNotPlayedOff:ct(r.flat()).filter(a=>!n.includes(a)),positionsPlayedOff:n}}function Kq({excludeRoundNumbers:t=[],playoffPositions:e=[],drawDefinition:i,structureId:r}){if(!i)return{error:_e};if(!r)return{error:za};if(!e)return{error:Xe,info:"missing playoffPositions"};let n=Hg({drawDefinition:i});if(n.error)return n;let a=n.positionsPlayedOff,o=e.filter(v=>!a.includes(v)),s=GB({finishingPositions:o,drawDefinition:i,structureId:r}),l=Object.values(s).reduce((v,y)=>v.includes(y.roundNumber)?v:v.concat(y.roundNumber),[]).map(v=>Qe(v)).filter(v=>!t.includes(v)),u=GB({finishingPositions:a,drawDefinition:i,structureId:r}),c=u?Object.values(u):[],d=u?c.reduce((v,y)=>v.includes(y.roundNumber)?v:v.concat(y.roundNumber),[]).map(v=>Qe(v)):[],p=l.filter(v=>!d.includes(v)).sort(or),{roundProfile:m}=IO({drawDefinition:i,structureId:r}),h=p.map(v=>{let y=m==null?void 0:m[v].finishingPositionRange.loser,[I,b]=y??[0,0];return Se(I,(b||I)+1)}).flat().sort(or),{playoffRoundsRanges:f}=due({playoffSourceRounds:p,roundProfile:m}),g=[...p,...d];return{playoffPositionsReturned:h,playedOffSourceRounds:d,playoffRoundsRanges:f,playoffSourceRounds:p,sourceRounds:g,roundProfile:m}}function due({playoffSourceRounds:t,roundProfile:e}){return{playoffRoundsRanges:t.map(i=>{let r=e[i].finishingPositionRange.loser,[n,a]=r,o=Se(n,(a||n)+1);return{finishingPositionRange:r.join("-"),finishingPositions:o,roundNumber:i}})}}function gb({drawDefinition:t,structureId:e}){if(!t)return{error:_e};let{matchUps:i,matchUpsMap:r}=Sn({inContext:!0,drawDefinition:t}),{positionsNotPlayedOff:n,positionsPlayedOff:a}=Hg({drawDefinition:t,matchUpsMap:r}),{structures:o}=Zo({drawDefinition:t}),s=o.filter(u=>!e&&u.stage!==Or||u.structureId===e),l={};for(let u of s){let c=u==null?void 0:u.structureId,d=pue({playoffPositions:n,drawDefinition:t,structure:u,matchUps:i}),{error:p,...m}=d;if(p)return d;l[c]={structureId:c,...m}}return e?{positionsPlayedOff:a,...l[e]}:{availablePlayoffProfiles:Object.values(l),availablePlayoffRounds:Object.values(l),positionsPlayedOff:a}}function pue({playoffPositions:t,drawDefinition:e,structure:i,matchUps:r}){var m,h,f,g,v,y,I,b,S;let n=i==null?void 0:i.structureId,{links:a}=_g({drawDefinition:e,structureId:n});if(i.structureType===xn||i.structures){let w=(h=(m=oi({structure:i}))==null?void 0:m.positionAssignments)==null?void 0:h.length,U=i.structures.length,T=(w??0)/U,D=((f=a.source)==null?void 0:f.flatMap(({source:x})=>(x==null?void 0:x.finishingPositions)||[]))||[],P=Se(1,T+1).filter(x=>!D.includes(x)),E=((v=(g=r.find(x=>x.containerStructureId===n&&x.finishingPositionRange))==null?void 0:g.finishingPositionRange)==null?void 0:v.winner)||[0,1],R=a==null?void 0:a.source.map(({target:x})=>x.structureId),{positionsPlayedOff:N=[],positionsNotPlayedOff:A=[]}=Hg({structureIds:R,drawDefinition:e}),M=[...N,...A],C=Se(E[0],E[1]+1).filter(x=>!M.includes(x)),O=Rr(C,C.length/P.length),k=P.map((x,F)=>{let $=O[F],_=[Math.min(...$||[]),Math.max(...$||[])].join("-");return{finishingPosition:x,finishingPositions:$,finishingPositionRange:_}});return{positionsNotPlayedOff:C,playoffFinishingPositionRanges:k,finishingPositionsAvailable:P,finishingPositionsPlayedOff:D,positionsPlayedOff:N,groupCount:U,groupSize:T}}let o=((y=a==null?void 0:a.source)==null?void 0:y.filter(w=>w.linkCondition!==tl).map(w=>{var U;return(U=w.source)==null?void 0:U.roundNumber}))||[],s=((I=a==null?void 0:a.source)==null?void 0:I.filter(w=>w.linkCondition===tl).map(w=>{var U;return(U=w.source)==null?void 0:U.roundNumber}))||[],l=Kq({excludeRoundNumbers:o,playoffPositions:t,drawDefinition:e,structureId:n}),u=l!=null&&l.playoffSourceRounds?[...(l==null?void 0:l.playoffSourceRounds)||[]]:void 0,c=[...(l==null?void 0:l.playoffRoundsRanges)||[]],{roundProfile:d,error:p}=l;for(let w of s){let U=a==null?void 0:a.source.find(R=>R.source.roundNumber===w),T=U==null?void 0:U.target.roundNumber,D=U==null?void 0:U.target.structureId,P=r.filter(({roundNumber:R,structureId:N})=>N===D&&R===T),E=P.filter(({sides:R})=>R.find(N=>N.participantFed&&!N.participantId)).length;if(u&&E===P.length){u.push(w);let R=(S=(b=d==null?void 0:d[w])==null?void 0:b.finishingPositionRange)==null?void 0:S.loser;if(R){let N=Math.min(...R),A=N+E,M=Se(N,A),C={finishingPositionRange:[N,A-1].join("-"),finishingPositions:M,roundNumber:w};c.push(C)}}}return u&&u.sort(or),c.sort((w,U)=>w.roundNumber-U.roundNumber),{playoffRounds:u,playoffRoundsRanges:c,error:p}}function mue({playoffGroups:t,drawDefinition:e,structureId:i}){var n,a;if(!e)return{error:_e};if(!Ti(i)||!Array.isArray(t))return{error:oe};let r=t.map(({finishingPositions:o})=>o).flat();return{positionRangeMap:(a=(n=gb({drawDefinition:e,structureId:i}).playoffFinishingPositionRanges)==null?void 0:n.filter(o=>r.includes(o.finishingPosition)))==null?void 0:a.reduce((o,s)=>(o[s.finishingPosition]=s,o),{})}}function Xq(t){var y,I;let{finishingPositionOffset:e=0,playoffAttributes:i,stageSequence:r=1,staggeredEntry:n,structureName:a,stage:o=Oe,matchUpType:s,structureId:l,idPrefix:u,drawSize:c,isMock:d,uuids:p}=t,m={finishingPositionOffset:e,matchUpType:s,drawSize:c,idPrefix:u,isMock:d,uuids:p},{matchUps:h}=n?Cc(m):nl(m),f=ao({structureName:a||((y=i==null?void 0:i["0"])==null?void 0:y.name)||Zr(Oe),structureId:l||(p==null?void 0:p.pop()),stageSequence:r,matchUpType:s,matchUps:h,stage:o}),g=[f],v=[];if(c>2){let b=c/2,{matchUps:S}=nl({finishingPositionOffset:e+b,idPrefix:u&&`${u}-c`,drawSize:b,matchUpType:s,isMock:d}),w=Zr(rn),U=((I=i==null?void 0:i["0-1"])==null?void 0:I.name)??t.consolationStructureName??(a?`${a} ${w}`:w),T=ao({structureName:U,matchUps:S,structureId:p==null?void 0:p.pop(),stage:rn,stageSequence:1,matchUpType:s});g.push(T);let D={linkType:jl,source:{roundNumber:1,structureId:f.structureId},target:{roundNumber:1,feedProfile:Lo,structureId:T.structureId}};v.push(D)}return{...J,structures:g,links:v}}function Jq({consolationStructure:t,roundOffset:e=0,mainStructure:i,roundsCount:r,feedPolicy:n,fmlc:a}){let o=t.matchUps.reduce((u,c)=>(c.drawPositions||[]).filter(Boolean).length&&!u.includes(c.roundNumber)?u.concat(c.roundNumber):u,[]),s=(n==null?void 0:n.roundGroupedOrder)||[],l=n==null?void 0:n.roundFeedProfiles;return Se(1+e,r+1+e).map(u=>{let c=l!=null&&l[u-1]?l[u-1]:u%2&&Lo||Od,d=u-e<=2?u-e:(u-e-2)*2+2,p={linkType:jl,source:{roundNumber:u,structureId:i.structureId},target:{feedProfile:c,roundNumber:d,structureId:t.structureId}},m=s[u-1];return m&&(p.target.groupedOrder=m),Fa()&&(p.source.structureName=i.structureName,p.target.structureName=t.structureName),u===2&&a&&(p.linkCondition=tl,p.target.feedProfile=Lo),o.includes(d)?p:void 0}).filter(Boolean)}function Qq(t){var S,w;let{playoffStructureNameBase:e,finishingPositionOffset:i,stageSequence:r=1,playoffAttributes:n,structureNameMap:a,staggeredEntry:o,stage:s=Oe,matchUpType:l,structureId:u,drawSize:c,idPrefix:d,isMock:p,uuids:m}=t,h={finishingPositionOffset:i,matchUpType:l,drawSize:c,idPrefix:d,isMock:p,uuids:m},{matchUps:f,roundsCount:g}=o?Cc(h):nl(h),v=t.structureName??((S=n==null?void 0:n["0"])==null?void 0:S.name)??Zr(Oe),y=vc({structureId:u||(m==null?void 0:m.pop()),structureName:v,stageSequence:r,matchUpType:l,matchUps:f,stage:s}),I=[y],b=[];if(c>2){let U=[0,2].slice(0,c/16).map((T,D)=>{let P=D+1,{consolationStructure:E}=hue({idPrefix:d&&`${d}-c${D}`,structureId:m==null?void 0:m.pop(),playoffStructureNameBase:e,playoffAttributes:n,structureNameMap:a,stageSequence:P,roundOffset:T,matchUpType:l,drawSize:c,isMock:p,index:D,uuids:m});I.push(E);let R=Jq({consolationStructure:E,roundsCount:2,mainStructure:y,roundOffset:T});return{consolationStructure:E,links:R}}).map(T=>T.links).flat();if(b.push(...U),c>=4&&c<=16||c>32){let{matchUps:T}=nl({idPrefix:d&&`${d}-p3t4`,finishingPositionOffset:2,drawSize:2,matchUpType:l,isMock:p}),D=((w=n==null?void 0:n["3-4"])==null?void 0:w.name)??Zr($i),P=(a==null?void 0:a[D])||D,E=e?`${e} ${P}`:P,R=vc({structureId:m==null?void 0:m.pop(),matchUps:T,stageSequence:2,stage:$i,structureName:E,matchUpType:l}),N={linkType:jl,source:{roundNumber:g-1,structureId:y.structureId},target:{structureId:R.structureId,feedProfile:Lo,roundNumber:1}};I.push(R),b.push(N)}}return{structures:I,links:b,...J}}function hue({playoffStructureNameBase:t,stageSequence:e=1,playoffAttributes:i,structureNameMap:r,roundOffset:n=0,matchUpType:a,structureId:o,idPrefix:s,drawSize:l,isMock:u,index:c,uuids:d}){var y,I;let p=l/(2*Math.pow(2,n)),{matchUps:m,roundsCount:h}=Cc({finishingPositionOffset:p,baseDrawSize:p,isConsolation:!0,feedRounds:1,matchUpType:a,idPrefix:s,isMock:u,uuids:d}),f=c===0&&((y=i==null?void 0:i["0-1"])==null?void 0:y.name)||c===1&&((I=i==null?void 0:i["0-3"])==null?void 0:I.name)||`${Zr(rn)} ${c+1}`,g=(r==null?void 0:r[f])||f,v=t?`${t} ${g}`:g;return{consolationStructure:vc({matchUps:m,stage:rn,structureName:v,stageSequence:e,matchUpType:a,structureId:o}),consolationRoundsCount:h}}function Bp(t){var P,E,R,N;let{finishingPositionOffset:e,stageSequence:i=1,playoffAttributes:r,feedsFromFinal:n,staggeredEntry:a,structureName:o,stage:s=Oe,structureId:l,matchUpType:u,skipRounds:c,feedRounds:d,idPrefix:p,drawSize:m,isMock:h,uuids:f,fmlc:g}=t,v=t.feedPolicy||((P=t.policyDefinitions)==null?void 0:P[Ff])||((E=t.appliedPolicies)==null?void 0:E[Ff]),y={finishingPositionOffset:e,matchUpType:u,skipRounds:c,drawSize:m,idPrefix:p,isMock:h,uuids:f},{matchUps:I}=a?Cc(y):nl(y),b=ao({structureName:o||((R=r==null?void 0:r["0"])==null?void 0:R.name)||Zr(Oe),structureId:l||(f==null?void 0:f.pop()),stageSequence:i,matchUpType:u,matchUps:I,stage:s}),S=[b],w=[],U=m/2,{matchUps:T,roundsCount:D}=Cc({finishingPositionOffset:U,idPrefix:p&&`${p}-c`,isConsolation:!0,feedsFromFinal:n,baseDrawSize:U,matchUpType:u,feedRounds:d,skipRounds:c,isMock:h,uuids:f,fmlc:g});if(m>2){let A=((N=r==null?void 0:r["0-1"])==null?void 0:N.name)??Zr(rn),M=t.playoffStructureNameBase?`${t.playoffStructureNameBase} ${A}`:A,C=ao({matchUps:T,structureId:f==null?void 0:f.pop(),stage:rn,stageSequence:1,structureName:M,matchUpType:u});S.push(C);let O=Jq({consolationStructure:C,mainStructure:b,roundsCount:D,feedPolicy:v,fmlc:g});w.push(...O)}return{...J,structures:S,links:w}}function Zq({requireSequential:t=!0,playoffMatchUpFormat:e,playoffAttributes:i,sourceStructureId:r,policyDefinitions:n,stageSequence:a,drawDefinition:o,playoffGroups:s,matchUpType:l,feedPolicy:u,groupCount:c,idPrefix:d,isMock:p,uuids:m}){var S,w,U,T,D,P;u=u||(n==null?void 0:n[Ff]);let h="processPlayoffGroups",f=0,g=[],v=[],y=[],{error:I,positionRangeMap:b}=mue({structureId:r,drawDefinition:o,playoffGroups:s});if(I)return ee({result:{error:I},stack:h});if(!(!b||s!=null&&s.every(E=>{let{finishingPositions:R=[]}=E;if(!R.length)return!1;let N=[...R].sort(or).map((A,M)=>(R[M+1]||A)-A).every(A=>A<2);return(!t||N)&&R.every(A=>b[A])})))return ee({context:{validFinishingPositions:Object.values(b)},result:{error:oe},stack:h});for(let E of s){let R=E.finishingPositions,N=b&&R.map($=>{var _;return(_=b[$])==null?void 0:_.finishingPositions}).flat(),A=c*R.length,M=Sg(A),C=M===2&&Hs||E.drawType||Hs;N&&(f=Math.min(...N)-1);let O=N&&`${Math.min(...N)}-${Math.max(...N)}`,k=E.structureName||O&&((w=(S=E.playoffAttributes)==null?void 0:S[O])==null?void 0:w.name)||((T=(U=E.playoffAttributes)==null?void 0:U["0"])==null?void 0:T.name),x={addNameBaseToAttributeName:E.addNameBaseToAttributeName,playoffStructureNameBase:E.playoffStructureNameBase,finishingPositionNaming:E.finishingPositionNaming,finishingPositionLimit:E.finishingPositionLimit,structureId:E.structureId??(m==null?void 0:m.pop()),playoffAttributes:E.playoffAttributes,structureNameMap:E.structureNameMap,sequenceLimit:E.sequenceLimit,structureName:k,idPrefix:d&&`${d}-po`,appliedPolicies:n,finishingPositionOffset:f,stage:$i,stageSequence:a,matchUpType:l,drawSize:M,isMock:p,uuids:m},F=({playoffStructures:$,playoffLinks:_})=>{let[L]=$,B=uU({playoffStructureId:L.structureId,finishingPositions:R,sourceStructureId:r});y.push(B),y.push(..._),v.push(...$),g.push({structureId:L.structureId,finishingPositions:R}),f+=A};if(C===Hs){let{matchUps:$}=nl({finishingPositionLimit:f+A,idPrefix:d&&`${d}-po`,finishingPositionOffset:f,matchUpType:l,drawSize:M,isMock:p,uuids:m}),_=ao({structureId:E.structureId??(m==null?void 0:m.pop()),matchUpFormat:e,stage:$i,structureName:k,stageSequence:a,matchUps:$});v.push(_);let L=uU({playoffStructureId:_.structureId,finishingPositions:R,sourceStructureId:r});y.push(L),f+=A,g.push({structureId:_.structureId,finishingPositions:R})}else if([Nf,Af,$i].includes(C)){let $={playoffAttributes:E.playoffAttributes??i,playoffStructureNameBase:E.playoffStructureNameBase,structureId:E.structureId??(m==null?void 0:m.pop()),structureName:E.structureName,idPrefix:d&&`${d}-po`,addNameBaseToAttributeName:!0,finishingPositionOffset:f,stage:$i,roundOffset:0,stageSequence:a,drawSize:M,isMock:p,uuids:m};C===Nf?Object.assign($,{playoffAttributes:(E==null?void 0:E.playoffAttributes)??i??JN,roundOffsetLimit:3}):C===Af&&Object.assign($,{playoffAttributes:(E==null?void 0:E.playoffAttributes)??i??QN,roundOffsetLimit:2});let _=If($);if(_.error)return _;if((D=_.links)!=null&&D.length&&y.push(..._.links),(P=_.structures)!=null&&P.length&&v.push(..._.structures),v.sort(Qm),_.structureId){let L=uU({playoffStructureId:_.structureId,finishingPositions:R,sourceStructureId:r});y.push(L),g.push({structureId:_.structureId,finishingPositions:R})}f+=A}else if([Of,_y,EI,RI,PI,CI].includes(C)){let $=[m==null?void 0:m.pop(),m==null?void 0:m.pop()],_={playoffStructureNameBase:E.playoffStructureNameBase,structureId:E.structureId??(m==null?void 0:m.pop()),playoffAttributes:E.playoffAttributes,idPrefix:d&&`${d}-po`,finishingPositionOffset:f,uuids:$,stage:$i,structureName:k,matchUpType:l,feedPolicy:u,drawSize:M,isMock:p},L={[Of]:{fmlc:!0,feedRounds:1},[CI]:{feedRounds:1},[EI]:{feedsFromFinal:3},[RI]:{feedsFromFinal:2},[PI]:{feedsFromFinal:1}};Object.assign(_,L[C]||{});let{structures:B,links:V}=Bp(_),[G]=B,j=uU({playoffStructureId:G.structureId,finishingPositions:R,sourceStructureId:r});y.push(j),y.push(...V),v.push(...B),g.push({structureId:G.structureId,finishingPositions:R}),f+=A}else if([Jo].includes(C)){let{structures:$,links:_}=db({...x,structureOptions:E.structureOptions||{groupSize:4}});F({playoffStructures:$,playoffLinks:_})}else if([Ly].includes(C)){let{structures:$,links:_}=Xq(x);F({playoffStructures:$,playoffLinks:_})}else if([Wae].includes(C)){let{structures:$,links:_}=Qq(x);F({playoffStructures:$,playoffLinks:_})}else if([La].includes(C)){let $=ao({structureId:E.structureId??(m==null?void 0:m.pop()),structureName:E.structureName,finishingPosition:CU,stage:$i,stageSequence:a,matchUps:[]});F({playoffStructures:[$],playoffLinks:[]})}}return{finishingPositionTargets:g,positionRangeMap:b,structures:v,links:y}}function uU({playoffStructureId:t,finishingPositions:e,sourceStructureId:i}){return{linkType:Uu,source:{structureId:i,finishingPositions:e},target:{structureId:t,feedProfile:ko,roundNumber:1}}}function vb({matchUp:t,tieFormat:e,isMock:i,uuids:r}){let{collectionDefinitions:n}=e??{};return{tieMatchUps:(n??[]).map(a=>Ib({matchUp:t,collectionDefinition:a,uuids:r,isMock:i})).filter(Boolean).flat()}}function Ib({collectionPositionOffset:t=0,collectionDefinition:e,matchUpsLimit:i,matchUp:r,isMock:n,uuids:a}){let{matchUpCount:o,matchUpType:s,collectionId:l,processCodes:u}=e||{},c=i??o??0,d=p=>{if(!n&&!(r!=null&&r.isMock))return(a==null?void 0:a.pop())??Gt();let m=e==null?void 0:e.collectionId;return(a==null?void 0:a.pop())??`${r==null?void 0:r.matchUpId}-${m}-TMU-${p+1}`};return Se(0,c).map(p=>{let m=t+p+1;return{sides:[{sideNumber:1},{sideNumber:2}],matchUpId:d(p),matchUpStatus:Ji,collectionPosition:m,collectionId:l,processCodes:u,matchUpType:s,isMock:n}})}function fue(t){var T,D,P;let e="generateAndPopulateRRplayoffStructures";if(!t.playoffGroups)return ee({result:{error:Xe},info:"playoffGroups required",stack:e});let{sourceStructureId:i,requireSequential:r,tournamentRecord:n,drawDefinition:a,playoffGroups:o,groupCount:s,groupSize:l,event:u}=t,c=Zq({requireSequential:r,sourceStructureId:i,playoffGroups:o,groupCount:s,groupSize:l,...t});if(c.error)return ee({result:c,stack:e});let{structures:d=[],links:p=[],finishingPositionTargets:m,positionRangeMap:h}=c,f=m==null?void 0:m.map(({finishingPositions:E})=>E).flat().map(E=>h[E].finishingPositions).flat();a.structures.push(...d),a.links.push(...p);let{matchUps:g,matchUpsMap:v}=mr({inContext:!0,drawDefinition:a}),y=d.map(({structureId:E})=>E),I=g==null?void 0:g.filter(({structureId:E})=>y.includes(E)).map(Dr),b=(T=v==null?void 0:v.drawMatchUps)==null?void 0:T.filter(({matchUpId:E})=>I==null?void 0:I.includes(E));if(b!=null&&b.length){let E=(D=vn({drawDefinition:a,event:u}))==null?void 0:D.tieFormat;E&&b.forEach(R=>{let{tieMatchUps:N}=vb({isMock:t.isMock,tieFormat:E,matchUp:R});Object.assign(R,{tieMatchUps:N,matchUpType:ka})})}let{positionAssignments:S}=oi({structureId:i,drawDefinition:a}),w={};S==null||S.forEach(E=>{var N,A,M;let R=(M=(A=(N=gt({element:E,name:Sc}))==null?void 0:N.extension)==null?void 0:A.value)==null?void 0:M.groupOrder;R&&(w[R]||(w[R]=[]),w[R].push(E.participantId))});let U=Gg({provisionalPositioning:t.provisionalPositioning,structureId:i,applyPositioning:!0,event:t.event,tournamentRecord:n,drawDefinition:a});return U.error&&((P=U.error)==null?void 0:P.code)!==cN.code?ee({result:U,stack:e}):{structures:d,links:p,positionsPlayedOff:f,drawDefinition:a,...J}}function sf({value:t,sourceRange:e,targetRange:i}){let r=Math.min(...e),n=Math.max(...e),a=Math.min(...i),o=Math.max(...i);return(t-r)*(o-a)/(n-r)+a}var xo="ELO",e3="NTRP",gue="TRN",t3="UTR",yO="WTN",vue={ELO:xo,NTRP:e3,TRN:gue,UTR:t3,WTN:yO},Iue={[xo]:{defaultInitialization:1500,decimalsCount:0,range:[0,3e3],ascending:!0},[e3]:{accessors:["ntrpRating","dntrpRatingHundredths"],attributes:{ustaRatingType:""},accessor:"dntrpRatingHundredths",defaultInitialization:3,decimalsCount:1,ascending:!0,range:[1,7]},[t3]:{defaultInitialization:6,accessors:["utrRating"],accessor:"utrRating",decimalsCount:2,ascending:!0,range:[1,16]},[yO]:{attributes:{confidence:{generator:!0,range:[60,100]}},accessors:["wtnRating","confidence"],defaultInitialization:23,accessor:"wtnRating",ascending:!1,decimalsCount:2,range:[40,1]}},Nr=Iue;function yue({sourceRatingType:t,sourceRating:e}){let i=Nr[t].range,r=i[0]>i[1],n=Nr[xo].range;return sf({value:r?i[0]-e:e,sourceRange:i,targetRange:n})}function bue({targetRatingType:t,sourceRating:e}){let i=Nr[t].decimalsCount||0,r=Nr[t].range,n=r[0]>r[1],a=Math.max(...r),o=Nr[xo].range,s=sf({targetRange:r,sourceRange:o,value:e}),l=parseFloat(s.toFixed(i));return n?a-l:l}function HB(t){var d;let e=ze(t,[{ratings:!0,[Xn]:ea}]);if(e.error)return e;let i=t.matchUpType&&[ti,Zt].includes(t.matchUpType)?t.matchUpType:ti,r=Object.keys(Nr),n=t.targetRatingType&&r.includes(t.targetRatingType)?t.targetRatingType:xo,a=t.ratings[i]?t.ratings[i].reduce((p,m)=>p.includes(m.scaleName)?p:p.concat(m.scaleName),[]):[];if(!a)return{error:$r};let o=((d=t.ratings[i])==null?void 0:d.find(p=>p.scaleName===n))??t.ratings[i][0];if(a[0]===n)return o;let s=o.scaleName,l=Nr[o.scaleName].accessor,u=l?o.scaleValue[l]:o.scaleValue,c=yue({sourceRatingType:s,sourceRating:u});return{convertedRating:bue({targetRatingType:n,sourceRating:c}),sourceRating:u}}function wue({participantResults:t,sides:e,score:i}){var s,l;let r=e.find(({sideNumber:u})=>u===1),n=e.find(({sideNumber:u})=>u===2),a=(s=r==null?void 0:r.participant)==null?void 0:s.ratings,o=(l=n==null?void 0:n.participant)==null?void 0:l.ratings;if(a!=null&&a[ti]&&(o!=null&&o[ti])){let u=xo,{convertedRating:c}=HB({ratings:a,targetRatingType:u}),{convertedRating:d}=HB({ratings:o,targetRatingType:u}),{side1pressure:p,side2pressure:m}=Uue({side1ConvertedRating:c,side2ConvertedRating:d,score:i});p&&t[r==null?void 0:r.participantId].pressureScores.push(p),m&&t[n==null?void 0:n.participantId].pressureScores.push(m);let h=Math.max(...Nr[xo].range),f=uS((d-c)/h),g=uS((c-d)/h);t[r==null?void 0:r.participantId].ratingVariation.push(f),t[n==null?void 0:n.participantId].ratingVariation.push(g)}}function Uue({side1ConvertedRating:t,side2ConvertedRating:e,score:i}){var y,I;let r=t>e?t:e,n=t>e?e:t,a=Math.abs(t-e),o=Nr[xo].range,s=Math.max(...o),l=(s-r)*0,u=(r+l)/s*a,c=(y=i==null?void 0:i.sets)==null?void 0:y.reduce((b,S)=>b+((S==null?void 0:S.side1Score)??0),0),d=(I=i==null?void 0:i.sets)==null?void 0:I.reduce((b,S)=>b+(S.side2Score??0),0),p=t>e?2:1,m=(c||0)*(n+(p===1?u:0)),h=(d||0)*(n+(p===2?u:0)),f=m+h,g=f?uS(m/f):0,v=f?uS(h/f):0;return{side1pressure:g,side2pressure:v}}function bO({winningSide:t,matchUpFormat:e=hu,matchUpStatus:i,tallyPolicy:r,score:n}){let a=[0,0],o=n==null?void 0:n.sets,s=typeof t=="number"&&t-1,l=kn(e),u=wO((l==null?void 0:l.bestOf)??1);if(typeof s=="number"&&(i===Mt&&(r!=null&&r.setsCreditForDefaults)||i===zt&&(r!=null&&r.setsCreditForWalkovers)))a[s]=u;else for(let c of o||[]){let{winningSide:d}=c;d&&(a[d-1]+=1)}return typeof s=="number"&&i===mn&&(+a[1-s]===u&&(a[1-s]-=1),r!=null&&r.setsCreditForRetirements&&(a[s]=u)),a}function i3({matchUpFormat:t=hu,winningSide:e,matchUpStatus:i,tallyPolicy:r,score:n}){var p,m;let{sets:a}=n||{};if(!a)return[0,0];let o=typeof e=="number"&&e-1,s=kn(t),l=(s==null?void 0:s.bestOf)??1,u=wO(l),c=((p=s==null?void 0:s.setFormat)==null?void 0:p.tiebreakAt)||0,d=[[],[]];if(typeof o=="number"&&(i===Mt&&(r!=null&&r.gamesCreditForDefaults)||i===zt&&(r!=null&&r.gamesCreditForWalkovers))){let h=((m=s==null?void 0:s.setFormat)==null?void 0:m.setTo)||0,f=u*h;d[o].push(f)}else a.forEach((h,f)=>{var S;let g=(h.setNumber||f+1)>u&&(s!=null&&s.finalSetFormat)?"finalSetFormat":"setFormat",v=(S=s==null?void 0:s[g])==null?void 0:S.based,y=s==null?void 0:s[g].tiebreakSet,{side1Score:I,side2Score:b}=h;zB(v)&&(d[0].push(Qe(I||0)),d[1].push(Qe(b||0))),y&&h.winningSide&&(r==null?void 0:r.gamesCreditForTiebreakSets)!==!1&&d[h.winningSide-1].push(1)});if(i===mn&&typeof o=="number"){let h=a.length>u&&(s!=null&&s.finalSetFormat)?"finalSetFormat":"setFormat",f=s==null?void 0:s[h];if(zB(f.based)){let g=(f==null?void 0:f.setTo)||0,v=I=>{if(!(!s||I===""))return+I===c-1||+I===c?Qe(c||0)+1:+I<c?g:c},y=bO({winningSide:e,score:{sets:a},matchUpStatus:i,matchUpFormat:t,tallyPolicy:r});if(d.map(I=>I[o]<=I[1-o]).reduce((I,b)=>I+(b?1:0),0)>y[1-o]){let I=d[o].length,b=v(d[1-o][I-1]);b&&(d[o][I-1]=b)}u>d[o].length&&(r!=null&&r.gamesCreditForRetirements)&&d[o].push(g)}}return[d[0].reduce((h,f)=>h+f,0),d[1].reduce((h,f)=>h+f,0)]}function r3({matchUpFormat:t,score:e}){var s;let i=t?kn(t):void 0,r=(i==null?void 0:i.bestOf)??1,n=wO(r),a=[0,0],o=[0,0];return(s=e==null?void 0:e.sets)==null||s.forEach((l,u)=>{var p;let c=(l.setNumber||u+1)>n&&(i!=null&&i.finalSetFormat)?"finalSetFormat":"setFormat",d=(p=i==null?void 0:i[c])==null?void 0:p.based;if(n3(d)){let{side1Score:m,side2Score:h}=l;m&&(o[0]+=Qe(m||0)),h&&(o[1]+=Qe(h||0))}else l.side1TiebreakScore&&(o[0]+=Qe(l.side1TiebreakScore||0)),l.side2TiebreakScore&&(o[1]+=Qe(l.side2TiebreakScore||0)),(l.side1TiebreakScore||l.side2TiebreakScore)&&l.winningSide&&(a[l.winningSide-1]+=1)}),{pointsTally:o,tiebreaksTally:a}}function wO(t){return t&&Math.ceil(t/2)||1}function n3(t){return t==="P"}function zB(t){return!n3(t)}function Sue({participantResults:t,matchUpFormat:e,tallyPolicy:i,perPlayer:r,totalSets:n}){var u;let a=e&&kn(e)||{},o=a.bestOf,s=o&&Math.ceil(o/2)||1,l=(u=a.setFormat)==null?void 0:u.setTo;Object.keys(t).forEach(c=>{let d=t[c].setsWon,p=t[c].setsLost,m=i!=null&&i.groupTotalSetsPlayed?n:r*(s||0)||d+p,h=Math.round(d/m*1e3)/1e3;(h===1/0||isNaN(h))&&(h=m);let f=t[c].tieMatchUpsWon,g=t[c].tieMatchUpsLost,v=f+g,y=Math.round(f/v*1e3)/1e3;(y===1/0||isNaN(y))&&(y=f);let I=t[c].matchUpsWon,b=t[c].matchUpsLost,S=I+b,w=Math.round(I/S*1e3)/1e3;(w===1/0||isNaN(w))&&(w=I);let U=t[c].gamesWon||0,T=t[c].gamesLost||0,D=(r||0)*(s||0)*(l||0),P=Math.max(D,U+T),E=Math.round(U/P*1e3)/1e3;(E===1/0||isNaN(E))&&(E=0);let R=t[c].pointsWon+t[c].pointsLost,N=Math.round(t[c].pointsWon/R*1e3)/1e3;(N===1/0||isNaN(N))&&(N=0),t[c].setsWon=d,t[c].setsLost=p,t[c].setsPct=h,t[c].tieMatchUpsWon=f,t[c].tieMatchUpsPct=y,t[c].matchUpsPct=w,t[c].gamesWon=U,t[c].gamesLost=T,t[c].gamesPct=E,t[c].pointsPct=N,t[c].result=`${t[c].matchUpsWon}/${t[c].matchUpsLost}`})}function yb({participantIds:t,pressureRating:e,matchUpFormat:i,tallyPolicy:r,perPlayer:n,matchUps:a}){var c,d,p,m,h,f,g;let o={},s=(r==null?void 0:r.excludeMatchUpStatuses)||[],l=a==null?void 0:a.filter(v=>(v.tieMatchUps||!s.includes(v.matchUpStatus))&&(!(t!=null&&t.length)||Vi(t,[lf(v,0),lf(v,1)]).length===2)),u=(c=l==null?void 0:l.flatMap(({score:v,tieMatchUps:y})=>{var I;return y?y.filter(({matchUpStatus:b})=>!s.includes(b)).flatMap(({score:b})=>{var S;return((S=b==null?void 0:b.sets)==null?void 0:S.length)??0}):((I=v==null?void 0:v.sets)==null?void 0:I.length)??0}))==null?void 0:c.reduce((v,y)=>v+y,0);for(let v of l??[]){let{matchUpStatus:y,tieMatchUps:I,tieFormat:b,score:S,winningSide:w,sides:U}=v,T=b&&v._disableAutoCalc&&b.collectionDefinitions.every(({scoreValue:N})=>N),D=w&&Tue(v),P=w&&Due(v);if(!D&&!P)if(y&&vr.includes(y)){let N=lf(v,0),A=lf(v,1);N&&(lc(o,N),o[N].matchUpsCancelled+=1),A&&(lc(o,A),o[A].matchUpsCancelled+=1)}else if(I!=null&&I.length){n=0;for(let N of I){if(N.winningSide){let A=(d=U==null?void 0:U.find(({sideNumber:C})=>C===N.winningSide))==null?void 0:d.participantId,M=(p=U==null?void 0:U.find(({sideNumber:C})=>C===N.winningSide))==null?void 0:p.participantId;A&&M&&(lc(o,A),lc(o,M),o[A].tieMatchUpsWon+=1,o[M].tieMatchUpsLost+=1,Yi(ti)(N.matchUpType)?(o[A].tieSinglesWon+=1,o[M].tieSinglesLost+=1):Yi(Zt)(N.matchUpType)&&(o[A].tieDoublesWon+=1,o[M].tieDoublesLost+=1))}WB({score:N.score,manualGamesOverride:T,participantResults:o,sides:U})}}else WB({manualGamesOverride:T,participantResults:o,score:S,sides:U});else if(lc(o,D),lc(o,P),I==null?void 0:I.length){n=0;for(let N of I){let{matchUpType:A}=N,M=Yi(Zt)(A),C=Yi(ti)(A);N.winningSide&&(N.winningSide===w?(D&&(o[D].tieMatchUpsWon+=1,C&&(o[D].tieSinglesWon+=1),M&&(o[D].tieDoublesWon+=1)),P&&(o[P].tieMatchUpsLost+=1,C&&(o[P].tieSinglesLost+=1),M&&(o[P].tieDoublesLost+=1))):N.winningSide!==w&&(P&&(o[P].tieMatchUpsWon+=1,C&&(o[P].tieSinglesWon+=1),M&&(o[P].tieDoublesWon+=1)),D&&(o[D].tieMatchUpsLost+=1,C&&(o[D].tieSinglesLost+=1),M&&(o[D].tieDoublesLost+=1)))),qB({matchUpFormat:N.matchUpFormat,matchUpStatus:N.matchUpStatus,matchUpType:N.matchUpType,score:N.score,sides:N.sides,winningParticipantId:D,losingParticipantId:P,manualGamesOverride:T,participantResults:o,isTieMatchUp:!0,pressureRating:e,tallyPolicy:r,winningSide:w})}a3({winningParticipantId:D,losingParticipantId:P,participantResults:o,matchUpStatus:y})}else qB({matchUpFormat:v.matchUpFormat??i,matchUpType:v.matchUpType,isTieMatchUp:void 0,winningParticipantId:D,manualGamesOverride:T,losingParticipantId:P,participantResults:o,pressureRating:e,matchUpStatus:y,tallyPolicy:r,winningSide:w,score:S,sides:U});let E=(m=S==null?void 0:S.sets)==null?void 0:m.reduce((N,A)=>N+((A==null?void 0:A.side1Score)??0),0),R=(h=S==null?void 0:S.sets)==null?void 0:h.reduce((N,A)=>N+(A.side2Score??0),0);if(T){let N=(f=U==null?void 0:U.find(({sideNumber:M})=>M===1))==null?void 0:f.participantId,A=(g=U==null?void 0:U.find(({sideNumber:M})=>M===2))==null?void 0:g.participantId;lc(o,N),lc(o,A),N&&(o[N].gamesWon+=E,o[N].gamesLost+=R),A&&(o[A].gamesWon+=R,o[A].gamesLost+=E)}}return Sue({participantResults:o,matchUpFormat:i,tallyPolicy:r,perPlayer:n,totalSets:u}),{participantResults:o}}function Tue(t){let e=t.winningSide-1;return lf(t,e)}function Due(t){let e=1-(t.winningSide-1);return lf(t,e)}function lf(t,e){if(!(t!=null&&t.sides))return console.log("no sides:",{matchUp:t}),"foo";let i=t.sides[e];return i?i.participantId:(console.log("No Side",{matchUp:t,index:e}),"foo")}function lc(t,e){e&&!t[e]&&(t[e]={allDefaults:0,defaults:0,defeats:[],gamesLost:0,gamesWon:0,matchUpsCancelled:0,matchUpsLost:0,matchUpsWon:0,pointsLost:0,pointsWon:0,pressureScores:[],ratingVariation:[],retirements:0,setsLost:0,setsWon:0,tieSinglesWon:0,tieSinglesLost:0,tieDoublesWon:0,tieDoublesLost:0,tieMatchUpsLost:0,tieMatchUpsWon:0,victories:[],walkovers:0})}function WB({manualGamesOverride:t,participantResults:e,score:i,sides:r}){let{sets:n}=i||{},a=[[],[]],o=[0,0];for(let l of n||[]){let{winningSide:u,side1Score:c,side2Score:d}=l;u&&(o[u-1]+=1),a[0].push(Qe(c||0)),a[1].push(Qe(d||0))}let s=[a[0].reduce((l,u)=>l+u,0),a[1].reduce((l,u)=>l+u,0)];r.forEach((l,u)=>{let{participantId:c}=l;c&&(lc(e,c),e[c].setsWon+=o[u],e[c].setsLost+=o[1-u],t||(e[c].gamesWon+=s[u],e[c].gamesLost+=s[1-u]))})}function qB({winningParticipantId:t,manualGamesOverride:e,losingParticipantId:i,participantResults:r,pressureRating:n,matchUpFormat:a,matchUpStatus:o,isTieMatchUp:s,matchUpType:l,tallyPolicy:u,winningSide:c,score:d,sides:p}){let m=c&&c-1,h=1-m;n&&l===ti&&wue({participantResults:r,sides:p,score:d}),s||a3({winningParticipantId:t,losingParticipantId:i,participantResults:r,matchUpStatus:o});let f=bO({matchUpStatus:o,matchUpFormat:a,tallyPolicy:u,winningSide:c,score:d}),g=i3({matchUpStatus:o,matchUpFormat:a,tallyPolicy:u,winningSide:c,score:d}),{pointsTally:v}=r3({score:d,matchUpFormat:a});t&&(r[t].setsWon+=f[m],r[t].setsLost+=f[h],e||(r[t].gamesWon+=g[m],r[t].gamesLost+=g[h]),r[t].pointsWon+=v[m],r[t].pointsLost+=v[h]),i&&(r[i].setsWon+=f[h],r[i].setsLost+=f[m],e||(r[i].gamesWon+=g[h],r[i].gamesLost+=g[m]),r[i].pointsWon+=v[h],r[i].pointsLost+=v[m])}function a3({winningParticipantId:t,losingParticipantId:e,participantResults:i,matchUpStatus:r}){e&&(r===zt&&(i[e].walkovers+=1),r===Mt&&(i[e].defaults+=1),r===mn&&(i[e].retirements+=1),[Mt,mn,zt].includes(r)&&(i[e].allDefaults+=1),i[e].matchUpsLost+=1),t&&(i[t].matchUpsWon+=1),e&&t&&(i[e].defeats.push(t),i[t].victories.push(e))}function Pue({matchUps:t,order:e,report:i}){let r={};t.forEach(({sides:a})=>{a.forEach(o=>{o.participantId&&o.participant&&(r[o.participantId]=o.participant.participantName)})});let n=[];return Array.isArray(i)&&i.forEach((a,o)=>{var s,l;if((s=a.excludedDirectives)!=null&&s.length){let u=a.excludedDirectives.map(({attribute:p})=>p).join(", "),c=`${u.length} directives were excluded due to participants limit}`;n.push(c);let d=`Excluded: ${u}`;n.push(d)}else{let u=(f,g)=>parseFloat(a.reversed?f:g)-parseFloat(a.reversed?g:f),c=a.groups?Object.values(a.groups).flat(1/0).length:((l=a.participantIds)==null?void 0:l.length)??0,d=f=>{f.groups&&Object.keys(f.groups).sort(u).forEach(g=>{let v=f.groups[g].map(I=>r[I]).join(", "),y=`${g} ${f.attribute}: ${v}`;n.push(y)})},p=a.reversed?" in reverse order":"",m=a.groups?"grouped":"separated",h=`Step ${o+1}: ${c} particiants were ${m}${p} by ${a.attribute}`;if(n.push(h),a.idsFilter){let f=`${a.attribute} was calculated considering ONLY TIED PARTICIPANTS`;n.push(f)}d(a)}n.push("----------------------")}),n.push("Final Order:"),e.forEach(a=>{let{participantId:o,resolved:s}=a,l=a.groupOrder||a.provisionalOrder;n.push(`${l}: ${r[o]} => resolved: ${!!s}`)}),n.join(`\r
`)}function o3({participantResults:t,participantIds:e,attribute:i}){return s3({participantResults:t,participantIds:e}).reduce((r,n)=>{let{participantId:a,results:o}=n,s=o==null?void 0:o[i];return!isNaN(s)&&a&&(r[s]?r[s].push(a):r[s]=[a]),r},{})}function s3(t){return(t.participantIds||Object.keys(t.participantResults)).reduce((e,i,r)=>(e.push({participantId:i,i:r,results:t.participantResults[i]}),e),[])}var Rue=[{attribute:"matchUpsPct",idsFilter:!1},{attribute:"allDefaults",reversed:!0,idsFilter:!1},{attribute:"defaults",reversed:!0,idsFilter:!1},{attribute:"walkovers",reversed:!0,idsFilter:!1},{attribute:"retirements",reversed:!0,idsFilter:!1},{attribute:"setsPct",idsFilter:!1},{attribute:"gamesPct",idsFilter:!1},{attribute:"pointsPct",idsFilter:!1},{attribute:"matchUpsPct",idsFilter:!0},{attribute:"setsPct",idsFilter:!0},{attribute:"gamesPct",idsFilter:!0},{attribute:"pointsPct",idsFilter:!0}],gE={matchUpsPct:20,tieMatchUpsPct:16,pointsPct:4,gamesPct:8,setsPct:12};function YB(t){let{requireCompletion:e=!0,participantResults:i,subOrderMap:r,tallyPolicy:n}=t,a=[];if(e&&!Eue(t))return{};let o=["tieMatchUpsWon","tieSinglesWon","tieDoublesWon","matchUpsWon","pointsWon","gamesWon","setsWon","gamesPct","setsPct","pointsPct","matchUpsPct"].includes(n==null?void 0:n.groupOrderKey)?n.groupOrderKey:"matchUpsWon",s=o3({participantResults:i,attribute:o});a.push({attribute:o,groups:s});let l=Object.keys(s).map(g=>parseFloat(g)).sort((g,v)=>v-g).map(g=>s[g]).map(g=>{let v=l3({participantIds:g,...t});return a.push(...v.report??[]),v.order}).map((g,v)=>g.map(y=>y.resolved?y:{...y,subGroup:[v].concat(...y.subGroup??[])})).flat(),u,c=0,d=1,p;l.forEach((g,v)=>{var I;v&&(g.resolved||p&&!g.resolved)&&(d+=1),p=g.resolved;let y=parseInt(((I=g.subGroup)==null?void 0:I.join(""))||0);g.resolved?(g.position=v+1,d=g.position):(u&&y>u&&(d+=c,c=0),g.position=d,c+=1),u=y});let m=l.map(({position:g})=>g),h=wa(m);return l.forEach(g=>{let{participantId:v,position:y}=g||{},I=i[v];g.GEMscore=f(I);let b=h[y];(g==null?void 0:g.position)!==void 0&&(b>1&&(g.ties=b,r&&(g.subOrder=r[v])),g.rankOrder=y,g.groupOrder=y+(g.subOrder||1)-1)}),{groupOrder:l,report:a.flat(1/0).filter(Boolean)};function f(g){return(Array.isArray(n==null?void 0:n.GEMscore)?Object.keys(gE).filter(v=>n.GEMscore.includes(v)):Object.keys(gE)).map(v=>(g[v]||0)*Math.pow(10,gE[v].toFixed(3))).reduce((v,y)=>v+y,0)}}function Eue({participantResults:t,participantsCount:e}){let i=s3({participantResults:t}).filter(r=>e-1===r.results.matchUpsWon+r.results.matchUpsLost+r.results.matchUpsCancelled);return e===i.length}function Cue({disableHeadToHead:t,participantIds:e,matchUpFormat:i,tallyPolicy:r,attribute:n,idsFilter:a,matchUps:o,reversed:s}){let{participantResults:l}=yb({participantIds:a&&e,matchUpFormat:i,tallyPolicy:r,matchUps:o}),u=o3({participantResults:l,participantIds:e,attribute:n}),c=[{attribute:n,reversed:s,groups:u,idsFilter:a}],d;return Object.keys(u).length>1&&e.length&&(d=Object.keys(u).map(p=>parseFloat(p)).sort((p,m)=>s?p-m:m-p).map(p=>u[p]).map(p=>{let m=l3({participantResults:l,disableHeadToHead:t,participantIds:p,matchUpFormat:i,tallyPolicy:r,matchUps:o});return c.push(...m.report??[]),m.order}).map((p,m)=>p.map(h=>h.resolved?h:{...h,subGroup:[m].concat(...h.subGroup??[])})).flat()),{order:d,report:c}}function l3({participantResults:t,disableHeadToHead:e,participantIds:i,matchUpFormat:r,tallyPolicy:n,matchUps:a}){let o=[],s=[],l;if((i==null?void 0:i.length)===1)return{order:[{resolved:!0,participantId:i[0]}]};if((i==null?void 0:i.length)===2&&(!(n!=null&&n.headToHead)||!n.headToHead.disabled&&!e)){let c=Mue({participantIds:i,participantResults:t});if(c){let d=c[0].participantId;return s.push({attribute:"head2Head",participantIds:i,headToHeadWinner:d}),{order:c,headToHeadWinner:d,report:s}}}let u=((n==null?void 0:n.tallyDirectives)||Rue).filter(c=>{let d=!(Li(c.maxParticipants)&&(i==null?void 0:i.length)>c.maxParticipants);return d||o.push(c),d});return o.length&&s.push({excludedDirectives:o,participantIds:i}),u.every(({attribute:c,reversed:d,idsFilter:p,disableHeadToHead:m})=>(l=Cue({disableHeadToHead:m,participantIds:i,matchUpFormat:r,tallyPolicy:n,attribute:c,idsFilter:p,matchUps:a,reversed:d}),s.push(l.report),!l.order)),l.order?{order:l.order,report:s}:{order:i==null?void 0:i.map(c=>({participantId:c})),report:s}}function Mue({participantIds:t,participantResults:e}){if(t){if(e[t[0]].victories.includes(t[1]))return t.map(i=>({resolved:!0,participantId:i}));if(e[t[1]].victories.includes(t[0]))return t.reverse().map(i=>({resolved:!0,participantId:i}))}}function zg({policyDefinitions:t,generateReport:e,pressureRating:i,matchUpFormat:r,matchUps:n=[],subOrderMap:a,perPlayer:o}){if(!(n!=null&&n.length)||!wo(n))return{error:ju};let s=ct(n.map(({structureId:b})=>b));if(s.length!==1)return ee({result:{error:oe,info:"Maximum one structureId"},stack:"tallyParticipantResults",context:{structureIds:s}});let l=n.filter(b=>b&&b.matchUpStatus!==Vt),u=l.length&&ct(l.map(({drawPositions:b})=>b).flat()).length,c=l.filter(b=>Rd({matchUp:b})).length===l.length;c||(o=0);let d=n.every(({matchUpType:b,tieMatchUps:S})=>b===hi&&(S==null?void 0:S.every(w=>Rd({matchUp:w})))),p=t==null?void 0:t[lA],m=n.filter(b=>Rd({matchUp:b})||b.matchUpType===hi),{participantResults:h}=yb({matchUps:m,pressureRating:i,matchUpFormat:r,tallyPolicy:p,perPlayer:o}),f,g,{groupOrder:v,report:y}=YB({matchUps:m,participantResults:h,participantsCount:u,matchUpFormat:r,tallyPolicy:p,subOrderMap:a});if(i&&Nue({participantResults:h}),c&&v)f=y,g=v,v.forEach(b=>{let{participantId:S,groupOrder:w,rankOrder:U,subOrder:T,ties:D,GEMscore:P}=b,E=h[S];Object.assign(E,{groupOrder:w,rankOrder:U,GEMscore:P,subOrder:T,ties:D})});else{let{groupOrder:b,report:S}=YB({requireCompletion:!1,participantResults:h,participantsCount:u,matchUpFormat:r,tallyPolicy:p,subOrderMap:a,matchUps:n});f=S,g=b,b&&b.forEach(w=>{let{participantId:U,groupOrder:T,GEMscore:D}=w,P=h[U];Object.assign(P,{provisionalOrder:T,GEMscore:D})})}let I={completedTieMatchUps:d,readableReport:"",participantResults:h,bracketComplete:c,order:[],report:f};if((c||d)&&(I.order=g),e||Fa({tally:!0})){let b=Pue({matchUps:n,report:f,order:g});Fa({tally:!0})&&console.log(b),I.readableReport=b}return I}function Nue({participantResults:t}){let e=n=>n.reduce((a,o)=>a+parseFloat(o),0),i=n=>parseFloat((e(n)/n.length).toFixed(2)),r=Object.keys(t).map(n=>{let a=t[n],{pressureScores:o}=a,s=o!=null&&o.length?i(o):0;return{participantId:n,averagePressure:s}}).sort((n,a)=>(a.averagePressure||0)-(n.averagePressure||0)).map((n,a)=>({...n,order:a+1}));for(let n of r)t[n.participantId].pressureOrder=n.order}function u3({positionAssignments:t}){let e=(t||[]).filter(Ta(Hl)).map(n=>{let{extension:a}=gt({element:n,name:Lf}),o=Qe(a==null?void 0:a.value),s=!isNaN(o)&&o;return s&&{participantId:n.participantId,subOrder:s}}).filter(Boolean),i=e.map(({subOrder:n})=>n),r=wa(i);return{subOrderMap:Object.assign({},...e.filter(({subOrder:n})=>r[n]===1).map(({participantId:n,subOrder:a})=>({[n]:a})))}}function UO({positionAssignments:t,tournamentRecord:e,drawDefinition:i,matchUpFormat:r,matchUps:n,event:a}){if(!wo(n))return{error:oe};if(!t)return{error:oe};let{policyDefinitions:o}=Wu({policyTypes:[lA],tournamentRecord:e,drawDefinition:i,event:a}),{subOrderMap:s}=u3({positionAssignments:t}),l=n.length?zg({policyDefinitions:o,matchUpFormat:r,subOrderMap:s,matchUps:n}):void 0;if(l!=null&&l.error)return l;let{participantResults:u={},bracketComplete:c,report:d}=l??{},p=Object.keys(u);return t.forEach(m=>{let{participantId:h}=m;if(p.includes(h)){let f={value:u[h],name:Sc};Lt({element:m,extension:f}),u[h].ties||Un({element:m,name:Lf})}else Un({element:m,name:Sc}),Un({element:m,name:Lf})}),li({drawDefinition:i}),{...J,participantResults:u,bracketComplete:c,report:d}}function c3({matchUps:t,matchUpId:e}){return{matchUp:(t||[]).find(i=>i.matchUpId===e)}}function wi(t){let e=ze(t,[{[Fn]:!0,[fl]:!0}]);if(e.error)return e;let{tournamentParticipants:i,afterRecoveryTimes:r,contextProfile:n,drawDefinition:a,matchUpsMap:o,matchUpId:s,inContext:l,context:u,event:c}=t,{structures:d=[]}=Zo({drawDefinition:a}),p=t.contextContent||n&&qu({contextProfile:n,drawDefinition:a});for(let m of d){let{matchUps:h}=Wt({tournamentParticipants:i,afterRecoveryTimes:r,contextContent:p,drawDefinition:a,contextProfile:n,matchUpsMap:o,inContext:l,structure:m,context:u,event:c}),{matchUp:f}=c3({matchUps:h,matchUpId:s});if(f)return{matchUp:f,structure:m}}return{error:dn}}function qT(t){var e;return!Nt(t)||!t.notes?{error:Xe}:Nt(t.element)?!Ti(t.notes)&&!((e=t.notes)!=null&&e.testing)?{error:oe}:(Object.assign(t.element,{notes:t.notes}),{...J}):{error:oe}}function SO(t){return Nt(t)?Nt(t.element)?(t.element.notes&&delete t.element.notes,{...J}):{error:oe}:{error:Xe}}var YT={matchUpStatus:Ji,matchUpStatusCodes:[],score:{scoreStringSide1:"",scoreStringSide2:"",sets:void 0},matchUpFormat:void 0,winningSide:void 0};function Ws(t){var U,T,D,P,E,R,N,A;let e="modifyMatchUpScore",i=t.matchUpFormat,r=t.matchUp,n,{matchUpStatusCodes:a,tournamentRecord:o,drawDefinition:s,matchUpStatus:l,removeScore:u,winningSide:c,matchUpId:d,event:p,notes:m,score:h}=t,f=t.appliedPolicies&&Object.keys(t.appliedPolicies).length?t.appliedPolicies:(U=$t({policyTypes:[Rs],tournamentRecord:o,drawDefinition:s,structure:n,event:p}))==null?void 0:U.appliedPolicies,g=r.matchUpType===hi;if(g&&s){if(d&&r.matchUpId!==d){let M=wi({drawDefinition:s,matchUpId:d,event:p});if(!M.matchUp)return{error:dn};({matchUp:r,structure:n}=M)}}else r.matchUpId!==d&&console.log("!!!!!");l&&[zt,er].includes(l)||u?Object.assign(r,{...YT}):h&&(r.score=h);let v=l&&(r==null?void 0:r.matchUpStatus)===Mt&&l!==Mt;l&&(r.matchUpStatus=l),i&&(r.matchUpFormat=i),a&&(r.matchUpStatusCodes=a),c&&(r.winningSide=c),t.removeWinningSide&&(r.winningSide=void 0),!n&&s&&({structure:n}=wi({drawDefinition:s,matchUpId:d,event:p})),l&&!r.winningSide&&Ir(r)&&!vr.includes(l)&&![Jm,Wc,co].includes(l)&&(r.matchUpStatus=ss);let y;if((v&&((T=r==null?void 0:r.processCodes)!=null&&T.length)||l===Mt)&&(y=(P=(D=f==null?void 0:f[Rs])==null?void 0:D.processCodes)==null?void 0:P.incompleteAssignmentsOnDefault),!r.collectionId){let M=(n==null?void 0:n.structureType)===xn,C=zn({structure:n});if(_A({drawDefinition:s,structure:n})||C||M){let O=F=>{i=g?"SET1-S:T100":i??r.matchUpFormat??(F==null?void 0:F.matchUpFormat)??(s==null?void 0:s.matchUpFormat)??(p==null?void 0:p.matchUpFormat);let $=g?{matchUpTypes:[hi]}:void 0,{matchUps:_}=Wt({afterRecoveryTimes:!1,tournamentRecord:o,inContext:!0,matchUpFilters:$,drawDefinition:s,structure:F,event:p});return C&&(F.positionAssignments=ct(_.flatMap(L=>(L.sides??[]).map(B=>B.participantId)).filter(Boolean)).map(L=>({participantId:L}))),UO({positionAssignments:F.positionAssignments,tournamentRecord:o,drawDefinition:s,matchUpFormat:i,matchUps:_,event:p})},k=M&&n.structures.find(F=>F==null?void 0:F.matchUps.find($=>$.matchUpId===d)),x=O(k||n);if(x.error)return ee({result:x,stack:e})}}if(m){let M=qT({element:r,notes:m});if(M.error)return ee({result:M,stack:e})}let I=o==null?void 0:o.tournamentId,b=vo().topics.includes(DT),S=(b||y)&&sn({drawDefinition:s}),w=S&&((E=mr({matchUpFilters:{matchUpIds:[d]},nextMatchUps:!0,tournamentRecord:o,inContext:!0,drawDefinition:s,matchUpsMap:S}).matchUps)==null?void 0:E[0]);if(b&&w&&Noe({tournamentId:I,inContextMatchUp:w}),Array.isArray(y)&&w&&!((R=w.sides)!=null&&R.every(({participantId:M})=>M)))if(l===Mt)r.processCodes=ct([...r.processCodes??[],...y]);else for(let M of y||[]){let C=M&&((N=r==null?void 0:r.processCodes)==null?void 0:N.lastIndexOf(M));(A=r==null?void 0:r.processCodes)==null||A.splice(C,1)}return Rt({eventId:p==null?void 0:p.eventId,context:e,drawDefinition:s,tournamentId:I,matchUp:r}),{...J}}function TO(t){var h,f,g,v;let{matchUpStatusCodes:e,matchUpStatus:i,structure:r,matchUp:n,dualMatchUp:a,inContextMatchUp:o,autoCalcDisabled:s}=t,l=ab({matchUpStatus:i})||[Hu,$a].includes(i)&&a||s,u=((h=n==null?void 0:n.sides)==null?void 0:h.map(y=>y.participantId).filter(Boolean).length)||((f=o==null?void 0:o.sides)==null?void 0:f.map(y=>y.participantId).filter(Boolean).length),c="attemptToModifyScore";if(!(zn({structure:r})&&u===1||i===Mt&&u||Aue({structure:r,matchUp:n,inContextMatchUp:o})||((v=(g=t.appliedPolicies)==null?void 0:g[Rs])==null?void 0:v.requireParticipantsForScoring)===!1))return ee({result:{error:vN},stack:c});let d=[zt].includes(i),p=l?i:t.winningSide&&qi||co,m=Ws({...t,matchUpStatusCodes:l&&e||[],matchUpStatus:p,context:c,removeScore:d});return ee({result:m,stack:c})}function Aue({structure:t,matchUp:e,inContextMatchUp:i}){var s;let{drawPositions:r}=e,{positionAssignments:n}=Er({structure:t}),a=n==null?void 0:n.filter(l=>(r==null?void 0:r.includes(l.drawPosition))&&l.participantId),o=(s=i==null?void 0:i.sides)==null?void 0:s.every(l=>l.participantId);return(a==null?void 0:a.length)===2||o}function d3({collectionGroups:t=[]}){let e=Object.assign({},...t.filter(r=>ot(r==null?void 0:r.groupValue)&&(r==null?void 0:r.groupNumber)).map(r=>({[r.groupNumber]:{...r,allGroupMatchUpsCompleted:!0,matchUpsCount:0,sideWins:[0,0],values:[0,0]}}))),i=Object.keys(e).map(r=>Qe(r));return{groupValueGroups:e,groupValueNumbers:i}}function Oue({collectionDefinition:t,groupValueNumbers:e,groupValueGroups:i,sideTieValues:r,tieMatchUps:n}){let a=n.filter(y=>y.collectionId===t.collectionId),o=[0,0],s=[0,0],l=a.every(y=>vr.includes(y.matchUpStatus)),{collectionValueProfiles:u,collectionGroupNumber:c,collectionValue:d,matchUpValue:p,winCriteria:m,scoreValue:h,setValue:f}=t,g=c&&e.includes(c),v=[0,0];if(a.forEach(y=>{y.winningSide&&(v[y.winningSide-1]+=1)}),ot(p)?a.forEach(y=>{y.winningSide&&(o[y.winningSide-1]+=p)}):ot(f)?a.forEach(y=>{var I,b;(b=(I=y.score)==null?void 0:I.sets)==null||b.forEach(S=>{S.winningSide&&(o[S.winningSide-1]+=f)})}):ot(h)?a.forEach(y=>{var I,b;(b=(I=y.score)==null?void 0:I.sets)==null||b.forEach(S=>{let{side1TiebreakScore:w=0,side2TiebreakScore:U=0,side1Score:T=0,side2Score:D=0}=S;(y.matchUpStatus===qi||y.winningSide||S.winningSide)&&(T||D?(o[0]+=T,o[1]+=D):(w||U)&&S.winningSide&&(o[S.winningSide-1]+=1))})}):Array.isArray(u)&&a.forEach(y=>{if(y.winningSide){let I=y.collectionPosition,b=kue({collectionDefinition:t,collectionPosition:I});ot(b)&&(o[y.winningSide-1]+=b)}}),ot(d)){let y;if(m!=null&&m.aggregateValue)l&&(ot(p||f||h)&&o[0]!==o[1]?y=o[0]>o[1]?1:2:v[0]!==v[1]&&(y=v[0]>v[1]?1:2));else if(m!=null&&m.valueGoal)y=o.reduce((I,b,S)=>b>=m.valueGoal?S+1:I,0);else{let I=Math.floor(t.matchUpCount/2)+1;y=v.reduce((b,S,w)=>S>=I?w+1:b,0)}y&&(g?i[c].values[y-1]+=d:s[y-1]+=d)}else g?(i[c].values[0]+=o[0]||0,i[c].values[1]+=o[1]||0):s=o;g?(i[c].sideWins[0]+=v[0]||0,i[c].sideWins[1]+=v[1]||0,i[c].allGroupMatchUpsCompleted=i[c].allGroupMatchUpsCompleted&&l,i[c].matchUpsCount+=a.length):s.forEach((y,I)=>r[I]+=y||0)}function kue({collectionDefinition:t,collectionPosition:e}){var i,r;return(r=(i=t.collectionValueProfiles||[])==null?void 0:i.find(n=>n.collectionPosition===e))==null?void 0:r.matchUpValue}function bb(t){var b,S,w,U,T;let{sideAdjustments:e=[0,0],separator:i="-",drawDefinition:r,matchUpsMap:n,structure:a,matchUp:o,event:s}=t;if(!Array.isArray(e)||e.length!==2||isNaN(e.reduce((D,P)=>D+P)))return{error:oe};if(!o)return{error:na};let l=((b=vn({matchUp:o,drawDefinition:r,structure:a,event:s}))==null?void 0:b.tieFormat)||(t==null?void 0:t.tieFormat);if(!l)return{error:Rg};let u=Hn({tieFormat:l});if(u.error)return u;let c=(l==null?void 0:l.collectionDefinitions)||[],d=(o==null?void 0:o.tieMatchUps)??[],p=[0,0],{groupValueGroups:m,groupValueNumbers:h}=d3(l);for(let D of c)Oue({collectionDefinition:D,groupValueNumbers:h,groupValueGroups:m,sideTieValues:p,tieMatchUps:d});for(let D of h){let P=m[D],{allGroupMatchUpsCompleted:E,matchUpCount:R,winCriteria:N,groupValue:A,sideWins:M,values:C}=P,O;if(N!=null&&N.aggregateValue)E&&C[0]!==C[1]&&(O=C[0]>C[1]?1:2);else if(N!=null&&N.valueGoal)O=C.reduce((k,x,F)=>x>=N.valueGoal?F+1:k,void 0);else{let k=Math.floor(R/2)+1;O=M.reduce((x,F,$)=>F>=k?$+1:x,void 0)}O&&(p[O-1]+=A||0)}let f=p.map((D,P)=>(D||0)+e[P]),g={side1Score:f[0],side2Score:f[1],winningSide:void 0},v=f.join(i),y=f.slice().reverse().join(i),I;if(l!=null&&l.winCriteria){let{valueGoal:D,aggregateValue:P,tallyDirectives:E}=l.winCriteria;if(D?I=(S=f.map((R,N)=>({sideNumber:N+1,points:R})).find(({points:R})=>R>=D))==null?void 0:S.sideNumber:P&&d.every(R=>R.matchUpStatus&&vr.includes(R.matchUpStatus)||R.winningSide)&&f[0]!==f[1]&&(I=f[0]>f[1]?1:2),!I&&E){let R=o.matchUpId,N=o.hasContext?o:((w=n==null?void 0:n.drawMatchUps)==null?void 0:w[R])||r&&((U=wi({inContext:!0,drawDefinition:r,matchUpId:R}))==null?void 0:U.matchUp);if(N){let{completedTieMatchUps:A,order:M}=zg({matchUps:[N]});if(A&&(M!=null&&M.length)){let C=M[0].participantId;I=(T=N.sides.find(({participantId:O})=>O===C))==null?void 0:T.sideNumber}}}}return I&&(g.winningSide=I),{scoreStringSide1:v,scoreStringSide2:y,winningSide:I,set:g}}function wb({inContextDualMatchUp:t,drawDefinition:e,tournamentId:i,dualMatchUp:r,eventId:n}){var a,o;if(r){t||(t=(a=wi({matchUpId:r.matchUpId,inContext:!0,drawDefinition:e}))==null?void 0:a.matchUp);let{extension:s}=gt({element:e,name:Tu}),l=Me((s==null?void 0:s.value)||{},!1,!0),u=({displaySideNumber:c,drawPosition:d,sideNumber:p})=>({drawPosition:d,sideNumber:p,displaySideNumber:c});r.sides=(o=t==null?void 0:t.sides)==null?void 0:o.map(c=>{var g;let d=c.participantId,p=d&&l[d]||void 0,{lineUp:m,...h}=((g=r.sides)==null?void 0:g.find(({sideNumber:v})=>v===c.sideNumber))??{},f=m!=null&&m.length?m:p;return{...u(c),...h,lineUp:f}}),Rt({context:"ensureSidLineUps",matchUp:r,drawDefinition:e,tournamentId:i,eventId:n})}}function qr(t){if(t)return Me(t,!1,!0)}function DO(t){let e=ze(t,[{[pn]:!0}]);return e.error?e:Object.keys(t.tournamentRecords).reduce((i,r)=>{i.tournamentIdMap[r]=[];let n=t.tournamentRecords[r].events??[],a=n.map(({eventId:s})=>s),o=n.map(s=>(s.drawDefinitions??[]).map(({drawId:l})=>l)).flat();return i.tournamentIdMap[r].push(...a,...o),i.eventIds.push(...a),i.drawIds.push(...o),i},{eventIds:[],drawIds:[],tournamentIdMap:{}})}function p3({tournamentRecords:t,eventId:e,drawId:i}){let{tournamentIdMap:r}=DO({tournamentRecords:t});return(r?Object.keys(r):[]).find(n=>e&&(r==null?void 0:r[n].includes(e))||i&&(r==null?void 0:r[n].includes(i)))}function Yu(t){var R,N,A,M;let{exitWhenNoValues:e,drawDefinition:i,matchUpStatus:r,removeScore:n,matchUpsMap:a,matchUpId:o,event:s}=t,l=t.tournamentRecords||t.tournamentRecord&&{[(R=t.tournamentRecord)==null?void 0:R.tournamentId]:t.tournamentRecord}||{},u=t.tournamentId||((N=t.tournamentRecord)==null?void 0:N.tournamentId);l&&p3({tournamentRecords:l,...t});let c=u&&l[u];if(!c)return{error:ge};let d=wi({drawDefinition:i,event:s,matchUpId:o});if(d.error)return d;if(!d.matchUp)return{error:dn};let{matchUp:p,structure:m}=d;if(!p.tieMatchUps)return{error:aa};wb({tournamentId:c==null?void 0:c.tournamentId,eventId:s==null?void 0:s.eventId,dualMatchUp:p,drawDefinition:i});let{extension:h}=gt({name:Um,element:p});if(h!=null&&h.value)if(n)Un({element:p,name:Um});else return{...J,score:p.score};let f=(A=vn({drawDefinition:i,structure:m,matchUp:p,event:s}))==null?void 0:A.tieFormat;p.tieFormat=qr(f);let g=bb({drawDefinition:i,matchUpsMap:a,structure:m,matchUp:p,event:s}),{winningSide:v,set:y,scoreStringSide1:I,scoreStringSide2:b}=g,S=(y==null?void 0:y.side1Score)||(y==null?void 0:y.side2Score);if(e&&!p.score&&!S)return{...J};let w={scoreStringSide1:I,scoreStringSide2:b,sets:y?[y]:[]},U=v&&[1,2].includes(v),T=U&&qi||HA({matchUpStatus:r??p.matchUpStatus,tieMatchUps:p.tieMatchUps,winningSide:p.winningSide,score:w})&&ss||Ji,D=!!(p.winningSide&&!U),P=p.tieMatchUps.find(({score:C,winningSide:O,matchUpStatus:k})=>{var x;return((x=C==null?void 0:C.sets)==null?void 0:x.length)&&(C.sets[0].side1Score||C.sets[0].side2Score)||k&&vr.includes(k)||O}),E;if(p.tieFormat&&!U&&!P){let C=(M=vn({drawDefinition:i,structure:m,event:s}))==null?void 0:M.tieFormat;C&&JSON.stringify(f)===JSON.stringify(C)&&(p.tieFormatId=void 0,p.tieFormat=void 0,E=!0)}return Ws({appliedPolicies:t.appliedPolicies,matchUpStatus:T,score:w,removeWinningSide:D,tournamentRecord:c,drawDefinition:i,removeScore:n,winningSide:v,matchUpId:o,matchUp:p,event:s}),{...J,score:w,removeWinningSide:D,tieFormatRemoved:E,winningSide:v}}function xue({winnerMatchUpDrawPositionIndex:t,inContextDrawMatchUps:e,projectedWinningSide:i,sourceMatchUpStatus:r,winningDrawPosition:n,tournamentRecord:a,winnerTargetLink:o,sourceMatchUpId:s,drawDefinition:l,winnerMatchUp:u,dualMatchUp:c,matchUpsMap:d,event:p}){var h,f,g,v,y;let m="directWinner";if(o){let I=u.drawPositions||[],b=I[t],S=o.source.structureId,w=et({structureId:S,drawDefinition:l});if(w.error)return w;let{structure:U}=w,{positionAssignments:T}=Er({structureId:S,drawDefinition:l}),D=(h=T==null?void 0:T.find(M=>M.drawPosition===n))==null?void 0:h.participantId,P=o.target.structureId,{positionAssignments:E}=Er({structureId:P,drawDefinition:l}),R=(f=E==null?void 0:E.find(M=>M.participantId===D))==null?void 0:f.drawPosition,N=E==null?void 0:E.filter(M=>{let C=I.includes(M.drawPosition),O=!M.participantId&&!M.bye&&!M.qualifier;return C&&O}).map(M=>M.drawPosition),A=N==null?void 0:N.includes(b);if(D&&o.target.roundNumber===1&&A)rl({drawPosition:b,participantId:D,structureId:P,inContextDrawMatchUps:e,sourceMatchUpStatus:r,tournamentRecord:a,drawDefinition:l,matchUpsMap:d,event:p});else if(D&&(N!=null&&N.length)){let M=N.pop();M&&rl({participantId:D,structureId:P,inContextDrawMatchUps:e,sourceMatchUpStatus:r,tournamentRecord:a,drawDefinition:l,drawPosition:M,matchUpsMap:d,event:p})}else if(R){let M=Vf({drawPosition:R,matchUpId:u.matchUpId,inContextDrawMatchUps:e,sourceMatchUpStatus:r,tournamentRecord:a,sourceMatchUpId:s,drawDefinition:l,matchUpsMap:d});if(M.error)return ee({result:M,stack:m})}else if((U==null?void 0:U.stage)!==Ye){let M="winner target position unavaiallble";return console.log(M),{error:M}}if(U!=null&&U.seedAssignments&&U.structureId!==P){let M=U.seedAssignments.find(({participantId:O})=>O===D),C=M==null?void 0:M.participantId;M&&C&&jg({eventId:u==null?void 0:u.eventId,structureId:P,...M,tournamentRecord:a,drawDefinition:l,participantId:C})}}else{let I=Vf({matchUpId:u.matchUpId,drawPosition:n,inContextDrawMatchUps:e,sourceMatchUpStatus:r,tournamentRecord:a,sourceMatchUpId:s,drawDefinition:l,matchUpsMap:d});if(I.error)return I}if(c&&i){let I=(g=c.sides)==null?void 0:g.find(b=>b.sideNumber===i);if(I!=null&&I.lineUp){let b=c.roundPosition,S=u.roundPosition,w=b===S&&b!==1||Math.floor(b/2)===S?2:1,U=(v=d==null?void 0:d.drawMatchUps)==null?void 0:v.find(({matchUpId:P})=>P===u.matchUpId),T=[1,2].map(P=>{var E;return{...((E=U.sides)==null?void 0:E.find(R=>R.sideNumber===P))||{},sideNumber:P}});U.sides=T;let D=U.sides.find(P=>P.sideNumber===w);if(D){let P=(y=I.lineUp)==null?void 0:y.filter(E=>E==null?void 0:E.participantId);D.lineUp=aO({lineUp:P}),Rt({tournamentId:a==null?void 0:a.tournamentId,eventId:u==null?void 0:u.eventId,matchUp:U,context:m,drawDefinition:l})}}}return{...J}}function Fue(t){var F,$,_;let{loserMatchUpDrawPositionIndex:e,inContextDrawMatchUps:i,projectedWinningSide:r,sourceMatchUpStatus:n,loserDrawPosition:a,tournamentRecord:o,loserTargetLink:s,drawDefinition:l,loserMatchUp:u,dualMatchUp:c,matchUpsMap:d,event:p}=t,m="directLoser",h=s.linkCondition,f=u.drawPositions||[],g=h===tl&&u.roundNumber===2&&Math.min(...f.filter(Boolean)),v=g||f[e],y=g||f[1-e],I=s.source.structureId,{structure:b}=et({structureId:I,drawDefinition:l}),{matchUps:S}=Wt({afterRecoveryTimes:!1,inContext:!0,drawDefinition:l,structure:b,event:p}),w=S.filter(L=>{var B;return(B=L.drawPositions)==null?void 0:B.includes(a)}).filter(L=>{let B=L.sides.find(G=>G.drawPosition===a),V=L.matchUpStatus===zt||L.matchUpStatus===Mt&&!Ir(L);return(B==null?void 0:B.sideNumber)===L.winningSide&&!V}),U=h===tl&&w.length===0,{positionAssignments:T}=Er({structureId:I,drawDefinition:l}),D=(F=T==null?void 0:T.find(L=>L.drawPosition===a))==null?void 0:F.participantId,P=s.target.structureId,{positionAssignments:E}=Er({structureId:P,drawDefinition:l}),R=E==null?void 0:E.filter(({drawPosition:L})=>f.includes(L));if(R!=null&&R.some(L=>L.participantId===D))return{...J};let N=R==null?void 0:R.filter(L=>{let B=f.includes(L.drawPosition),V=!L.participantId&&!L.bye&&!L.qualifier;return B&&V}).map(L=>L.drawPosition),A=N==null?void 0:N.includes(v),M=s.target.roundNumber>1&&(N==null?void 0:N.length),C=s.target.roundNumber===1&&A;if(g){let L=O();if(L.error)return ee({result:L,stack:m})}else if(C){let L=x();if(L.error)return ee({result:L,stack:m})}else if(D&&M){N.sort(or);let L=N[0],B=rl({participantId:D,structureId:P,drawPosition:L,inContextDrawMatchUps:i,sourceMatchUpStatus:n,tournamentRecord:o,drawDefinition:l,matchUpsMap:d,event:p});if(B.error)return ee({result:B,stack:m})}else return ee({context:{loserDrawPosition:a,loserTargetLink:s,targetDrawPositionIsUnfilled:A},result:{error:A?Tg:Cne},stack:m});if(b!=null&&b.seedAssignments&&b.structureId!==P){let L=b.seedAssignments.find(({participantId:V})=>V===D),B=L==null?void 0:L.participantId;L&&B&&jg({eventId:u==null?void 0:u.eventId,structureId:P,...L,tournamentRecord:o,drawDefinition:l,participantId:B})}if(c&&r){let L=($=c.sides)==null?void 0:$.find(B=>B.sideNumber===3-r);if(L!=null&&L.lineUp){let{roundNumber:B,eventId:V}=u,{roundPosition:G}=c,j=B===1?2-G%2:1,z=(_=d==null?void 0:d.drawMatchUps)==null?void 0:_.find(({matchUpId:Y})=>Y===u.matchUpId),W=[1,2].map(Y=>{var re;return{...((re=z.sides)==null?void 0:re.find(K=>K.sideNumber===Y))||{},sideNumber:Y}});z.sides=W;let q=z.sides.find(Y=>Y.sideNumber===j);q&&(q.lineUp=aO({lineUp:L.lineUp}),Rt({tournamentId:o==null?void 0:o.tournamentId,matchUp:z,context:m,drawDefinition:l,eventId:V}))}}return{...J};function O(){let L="loserLinkFedFMLC";return ee(U?{result:x(),stack:L}:{result:k(),stack:L})}function k(){let L=Ya({drawPosition:y,structureId:P,tournamentRecord:o,drawDefinition:l,event:p});return ee({result:L,stack:"assignLoserPositionBye"})}function x(){let L=D?rl({drawPosition:v,participantId:D,structureId:P,inContextDrawMatchUps:i,sourceMatchUpStatus:n,tournamentRecord:o,drawDefinition:l,matchUpsMap:d,event:p}):{error:pr};return ee({result:L,stack:"assignLoserDrawPosition"})}}function m3(t){var w;let e="directParticipants",i=TO(t);if(i.error)return ee({result:i,stack:e});let r=ab({matchUpStatus:t.matchUpStatus}),{dualWinningSideChange:n,projectedWinningSide:a,inContextDrawMatchUps:o,tournamentRecord:s,drawDefinition:l,matchUpStatus:u,dualMatchUp:c,matchUpsMap:d,winningSide:p,targetData:m,matchUpId:h,structure:f,matchUp:g,event:v}=t,y=!!g.collectionId,I=zn({structure:f}),b=g.drawPositions,S;if(y){let{matchUpTieId:U,matchUpsMap:T}=t,D=Yu({appliedPolicies:t.appliedPolicies,matchUpId:U,tournamentRecord:s,drawDefinition:l,matchUpsMap:T,event:v});if(S=D&&{tieMatchUpResult:D},b=(w=o.find(({matchUpId:P})=>P===U))==null?void 0:w.drawPositions,!n)return ee({result:{...J,...S},stack:e})}if(I)return ee({result:{...J,...S},stack:e});if(b){let U=a?a-1:p-1,T=1-U,D=b[U],P=b[T],{targetLinks:{loserTargetLink:E,winnerTargetLink:R,byeTargetLink:N},targetMatchUps:{winnerMatchUpDrawPositionIndex:A,loserMatchUpDrawPositionIndex:M,winnerMatchUp:C,loserMatchUp:O,byeMatchUp:k}}=m;if(C){let x=xue({sourceMatchUpStatus:r&&u||qi,winnerMatchUpDrawPositionIndex:A,sourceMatchUpId:h,inContextDrawMatchUps:o,projectedWinningSide:a,winningDrawPosition:D,tournamentRecord:s,winnerTargetLink:R,drawDefinition:l,winnerMatchUp:C,dualMatchUp:c,matchUpsMap:d,event:v});if(x.error)return ee({result:x,stack:e})}if(O){let x=Fue({sourceMatchUpStatus:r&&u||qi,loserMatchUpDrawPositionIndex:M,sourceMatchUpId:h,inContextDrawMatchUps:o,projectedWinningSide:a,loserDrawPosition:P,tournamentRecord:s,loserTargetLink:E,drawDefinition:l,loserMatchUp:O,winningSide:p,matchUpsMap:d,dualMatchUp:c,event:v});if(x.error)return ee({result:x,stack:e})}if(k){let x=k.drawPositions||[],F=Math.min(...x.filter(Boolean)),$=N.target.structureId,_=Ya({drawPosition:F,structureId:$,tournamentRecord:s,drawDefinition:l,event:v});if(_.error)return ee({result:_,stack:e})}}else return ee({result:{error:Ry},stack:e});return ee({result:{...J,...S},stack:e})}function PO(t){var j,z,W,q;let e="genPlayoffStructure";if(!t.drawDefinition)return ee({result:{error:_e},stack:e});let i=gb(t);if(i.error)return ee({result:i,stack:e});let{structureId:r,addNameBaseToAttributeName:n,playoffStructureNameBase:a,finishingPositionNaming:o,finishingPositionLimit:s,playoffAttributes:l,playoffPositions:u,roundOffsetLimit:c,tournamentRecord:d,exitProfileLimit:p,roundProfiles:m,roundNumbers:h,idPrefix:f,isMock:g,event:v,uuids:y}=t,I=Me(t.drawDefinition,!1,!0),{structure:b}=et({structureId:r,drawDefinition:I});if(!b)return ee({result:{error:Mi},stack:e});if(b.structureType===xn||b.structures)return fue({sourceStructureId:b.structureId,...t,...i,drawDefinition:I});let{playoffRoundsRanges:S,playoffRounds:w}=i,{playoffPositionsReturned:U,error:T,playoffSourceRounds:D,playoffRoundsRanges:P}=Kq(t);if(T)return ee({result:{error:T},stack:e});let E=(m==null?void 0:m.length)&&Object.assign({},...m),R=h||typeof m=="object"&&m.map(Y=>Object.keys(Y)).flat(),N=Array.isArray(R)&&R.map(Y=>!isNaN(Y)&&Qe(Y)).filter(Boolean);if(N){if(!Array.isArray(N))return ee({result:{error:oe},context:{validRoundNumbers:N},stack:e});N.forEach(Y=>{if(!(w!=null&&w.includes(Y)))return ee({result:{error:oe},context:{roundNumber:Y},stack:e})})}u&&u.forEach(Y=>{if(!(U!=null&&U.includes(Y)))return ee({result:{error:oe},context:{playoffPosition:Y},stack:e})});let A=N||D,M=N?S:P,C=[],O=[];for(let Y of A??[]){let re=M==null?void 0:M.find(ne=>ne.roundNumber===Y);if(!re)return ee({result:{error:oe},context:{roundNumber:Y},stack:e});let K=re.finishingPositions.length,H=Math.min(...re.finishingPositions)-1,Z=2,X=Y&&(E==null?void 0:E[Y])&&Z+E[Y]-1,ie=If({exitProfile:`0-${Y}`,addNameBaseToAttributeName:n,playoffStructureNameBase:a,finishingPositionOffset:H,playoffAttributes:l,exitProfileLimit:p,stage:$i,roundOffset:0,drawDefinition:I,sequenceLimit:X,stageSequence:Z,drawSize:K,idPrefix:f,isMock:g,uuids:y,finishingPositionNaming:o,finishingPositionLimit:s,roundOffsetLimit:c});if(ie.error)return ee({result:ie,stack:e});let{structures:ae,links:le}=ie;if(ae!=null&&ae.length&&C.push(...ae),le!=null&&le.length&&O.push(...le),ie.structureId&&Y){let ne={linkType:jl,source:{structureId:r,roundNumber:Y},target:{structureId:ie.structureId,feedProfile:Lo,roundNumber:1}};O.push(ne)}}if(!C.length)return ee({result:{error:oe},info:"No structures generated",stack:e});I.structures.push(...C),I.links.push(...O);let{matchUps:k,matchUpsMap:x}=mr({inContext:!0,drawDefinition:I}),F=C.map(({structureId:Y})=>Y),$=k==null?void 0:k.filter(({structureId:Y})=>F.includes(Y)).map(Dr),_=(j=x==null?void 0:x.drawMatchUps)==null?void 0:j.filter(({matchUpId:Y})=>$==null?void 0:$.includes(Y));if(_!=null&&_.length){let Y=(z=vn({drawDefinition:I,event:v}))==null?void 0:z.tieFormat;Y&&_.forEach(re=>{let{tieMatchUps:K}=vb({matchUp:re,tieFormat:Y,isMock:g});Object.assign(re,{tieMatchUps:K,matchUpType:hi})})}(W=k==null?void 0:k.filter(Y=>Rd({matchUp:Y})&&Y.structureId===r))==null||W.forEach(Y=>{let{matchUpId:re,score:K,winningSide:H}=Y,Z=Cn({inContextDrawMatchUps:k,drawDefinition:I,matchUpId:re}),X=m3({inContextDrawMatchUps:k,tournamentRecord:d,drawDefinition:I,matchUpsMap:x,winningSide:H,targetData:Z,matchUpId:re,structure:b,matchUp:Y,score:K,event:v});X.error&&console.log(X.error)}),(q=k==null?void 0:k.filter(Y=>Y.matchUpStatus===Vt&&Y.structureId===r))==null||q.forEach(Y=>{let{matchUpId:re}=Y,K=Cn({inContextDrawMatchUps:k,drawDefinition:I,matchUpId:re}),{targetLinks:{loserTargetLink:H},targetMatchUps:{loserMatchUpDrawPositionIndex:Z,loserMatchUp:X}}=K;if(H&&X){let ie=H.target.structureId,ae=X.drawPositions[Z],le=Ya({drawPosition:ae,structureId:ie,tournamentRecord:d,drawDefinition:I,event:v});le.error&&console.log(le.error)}});let L=[],B=$d({inContextDrawMatchUps:k,drawDefinition:I,matchUpsMap:x}).goesToMap,{structure:V}=et({drawDefinition:t.drawDefinition,structureId:r}),{matchUps:G}=Wt({structure:V});return G.forEach(Y=>{var H,Z;let re=B==null?void 0:B.loserMatchUpIds[Y.matchUpId];if(re&&Y.loserMatchUpId!==re){Y.loserMatchUpId=re;let X={tournamentId:d==null?void 0:d.tournamentId,eventId:(H=t.event)==null?void 0:H.eventId,context:e,matchUp:Y};L.push(X)}let K=B==null?void 0:B.winnerMatchUpIds[Y.matchUpId];if(K&&Y.winnerMatchUpId!==K){Y.winnerMatchUpId=K;let X={tournamentId:d==null?void 0:d.tournamentId,eventId:(Z=t.event)==null?void 0:Z.eventId,context:e,matchUp:Y};L.push(X)}}),{structures:C,matchUpModifications:L,links:O,drawDefinition:I,...J}}function h3({element:t}){if(!t)return{error:oe};if(!t.timeItems)return{};if(!Array.isArray(t.timeItems))return{error:oe};let e=(i,r)=>(n,a)=>(a[i]&&(n[a[i]]=a[r]),n);return t.timeItems.reduce(e("itemType","itemValue"),{})}function vl(t){let{duplicateValues:e=!0,creationTime:i=!0,removePriorValues:r,timeItem:n}=t;if(!n)return{error:MN};let a=SW(t);if(a.error)return a;if(!(Nt(n)&&Ti(n.itemType)&&Object.keys(n).includes("itemValue")))return{error:CN};if(!a.timeItems)a.timeItems=[];else if(Lue({element:a,duplicateValues:e,timeItem:n}))return{...J};if(n.itemSubTypes&&!n.itemSubTypes.length&&delete n.itemSubTypes,i){let o=new Date().toISOString();Object.assign(n,{createdAt:o})}return r&&(a.timeItems=a.timeItems.filter(({itemType:o})=>n.itemType!==o)),r&&!n.itemValue||a.timeItems.push(n),{...J}}function Lue({element:t,duplicateValues:e,timeItem:i}){var s;let{itemType:r,itemSubTypes:n,itemValue:a}=i,o=r&&((s=yo({itemSubTypes:n,itemType:r,element:t}))==null?void 0:s.timeItem);return o&&JSON.stringify(o==null?void 0:o.itemValue)===JSON.stringify(a)&&!e}function RO({creationTime:t=!0,removePriorValues:e,tournamentRecord:i,duplicateValues:r,participantId:n,timeItem:a}){if(!i)return{error:ge};if(!n)return{error:pr};let o=qc({tournamentRecord:i,participantId:n});return o.error?o:vl({element:o.participant,removePriorValues:e,duplicateValues:r,creationTime:t,timeItem:a})}function Ub(t){let{removePriorValues:e,tournamentRecord:i,duplicateValues:r,creationTime:n,timeItem:a}=t;if(!i)return{error:ge};let o=vl({element:i,removePriorValues:e,duplicateValues:r,creationTime:n,timeItem:a});if(o.error)return o;let s=h3({element:i});return lt({payload:{parentOrganisation:i.parentOrganisation,tournamentId:i.tournamentId,timeItemValues:s},topic:dp}),o}function dh(t){let{removePriorValues:e,duplicateValues:i,creationTime:r,timeItem:n,event:a}=t;return a?vl({removePriorValues:e,duplicateValues:i,element:a,creationTime:r,timeItem:n}):{error:lo}}function f3(t){return KT({...t,itemType:"attachConsolationStructures"})}function EO(t){return KT({...t,itemType:"attachPlayoffStructures"})}function KT({itemType:t="attachStructures",matchUpModifications:e,tournamentRecord:i,drawDefinition:r,structures:n,links:a=[],event:o}){var g,v,y;let s="attachStructures";if(!r)return{error:_e};if(!Array.isArray(n)||!Array.isArray(a))return ee({result:{error:oe},stack:s});let l=I=>{var b;return[I.source.structureId,I.source.roundNumber||((b=I.source.finishingPositions)==null?void 0:b.join("|")),I.target.roundNumber].join("|")},u=(g=r.links)==null?void 0:g.map(l);if(a.some(I=>{let b=l(I);return u==null?void 0:u.includes(b)}))return ee({result:{error:xN},info:"playoff structure exists",stack:s});a.length&&((v=r.links)==null||v.push(...a));let c=n.map(({structureId:I})=>I),d=(y=r.structures)==null?void 0:y.map(({structureId:I})=>I);r.structures=(r.structures??[]).map(I=>c.includes(I.structureId)?n.find(({structureId:b})=>b===I.structureId):I);let p=n==null?void 0:n.filter(({structureId:I})=>!(d!=null&&d.includes(I)));p.length&&r.structures.push(...p),$d({drawDefinition:r});let m=n.map(I=>{var b;return((b=Wt({structure:I}))==null?void 0:b.matchUps)||[]}).flat();Dc({tournamentId:i==null?void 0:i.tournamentId,eventId:o==null?void 0:o.eventId,drawDefinition:r,matchUps:m});let h=n.map(({structureId:I})=>I);if(li({drawDefinition:r,structureIds:h}),e==null?void 0:e.length){let I={};e.forEach(S=>{var U;let w=(U=S.matchUp)==null?void 0:U.matchUpId;w&&(I[w]=S)});let b=S=>{S.matchUps.forEach(w=>{if(I[w.matchUpId]){let{tieMatchUps:U,...T}=I[w.matchUpId].matchUp;if(Object.assign(w,T),U==null?void 0:U.length){let D={};U.forEach(P=>I[P.matchUpId]=P),w.tieMatchUps.forEach(P=>Object.assign(P,D[P.matchUpId]))}I[w.matchUpId].matchUp=w,Rt(I[w.matchUpId])}})};r.structures.forEach(S=>{if(d!=null&&d.includes(S.structureId))if(S.structures)for(let w of S.structures)b(w);else b(S)})}let f=p.map(Ta("structureId"));if(i){let I={itemValue:{structureIds:h,drawId:r.drawId},itemType:t};vl({element:i,timeItem:I})}return{...J,addedStructureIds:f}}function XT(t){var o,s;let{structures:e,links:i,matchUpModifications:r,error:n}=PO(t);if(n)return{error:n};let a=t.drawDefinition;return EO({tournamentId:(o=t.tournamentRecord)==null?void 0:o.tournamentId,eventId:((s=t.event)==null?void 0:s.eventId)||t.eventId,matchUpModifications:r,drawDefinition:a,structures:e,links:i})}function Vd(t){let e=ze(t,[{_anyOf:{[pn]:!1,[wr]:!1,[Fn]:!1,[Gc]:!1},[ZN]:!0}]);if(e.error)return e;let i=[],r=t.drawDefinition??t.event??((t.tournamentId||!t.tournamentRecords)&&t.tournamentRecord);if(r){let n=KB(t,r);if(n.error)return n;i.push(...(n==null?void 0:n.applied)??[]),t.drawDefinition&&li({drawDefinition:t.drawDefinition,tournamentId:t.tournamentId})}else if(t.tournamentRecords){let n=Object.keys(t.tournamentRecords);if(!n.length)return{error:ge};for(let a of n){let o=t.tournamentRecords[a],s=KB(t,o);if(s.error)return s;i.push(...(s==null?void 0:s.applied)??[])}}else return{error:ge};return i.length?{...J,applied:i}:{error:UN}}function KB(t,e){let i=$t(t).appliedPolicies??{};e.extensions||(e.extensions=[]);let r=[],n=Object.keys(t.policyDefinitions);if(!n.length)return{error:G0};for(let a of n)if(!i[a]||t.allowReplacement){let o=t.policyDefinitions[a];if(!o)continue;if(!Nt(o))return{error:oe};let{policyName:s,...l}=o;if(!l||!Object.keys(l).length||s&&!Ti(s))return{error:oe};i[a]=t.policyDefinitions[a],r.push(a)}return r!=null&&r.length?{...Lt({element:e,extension:{name:NI,value:i}}),applied:r}:{applied:r,error:UN}}function CO({tournamentRecord:t,drawDefinition:e,flightProfile:i,drawName:r,drawId:n,event:a}){var s;if(!r||typeof r!="string")return ee({result:{error:oe},context:{drawName:r}});i||(i=Gi({event:a}).flightProfile);let o=(s=i==null?void 0:i.flights)==null?void 0:s.find(l=>l.drawId===n);if(o){o.drawName=r;let l={name:Qo,value:{...i,flights:i.flights}};zc({event:a,extension:l})}return e&&(e.drawName=r,li({tournamentId:t==null?void 0:t.tournamentId,drawDefinition:e})),!o&&!e?{error:_e}:{...J,flight:o}}function g3({tournamentRecord:t,drawDefinition:e,drawUpdates:i,drawId:r,event:n}){var l;if(!Nt(i))return{error:oe};let a=Gi({event:n}).flightProfile,o=i.drawName&&CO({drawName:i.drawName,tournamentRecord:t,drawDefinition:e,flightProfile:a,drawId:r,event:n});if(o!=null&&o.error)return o==null?void 0:o.error;let s=(o==null?void 0:o.flight)||((l=a==null?void 0:a.flights)==null?void 0:l.find(u=>u.drawId===r));if(!s&&!e)return{error:_e};if(s){let u={name:Qo,value:{...a,flights:a.flights}};zc({event:n,extension:u})}return e&&(i.policyDefinitions&&Vd({policyDefinitions:i.policyDefinitions,drawDefinition:e}),li({tournamentId:t==null?void 0:t.tournamentId,drawDefinition:e})),{...J}}function v3({tournamentRecord:t,removeScheduling:e,drawDefinition:i}){var o,s;if(!i)return{error:_e};let r=sn({drawDefinition:i}),n=l=>{var u;return(u=r==null?void 0:r.drawMatchUps)==null?void 0:u.find(c=>c.matchUpId===l)};for(let l of i.structures||[]){let{positionAssignments:u,stage:c,stageSequence:d}=l;u&&(d!==1||![Ye,Oe].includes(c))&&(l.positionAssignments=u.map(h=>(delete h.participantId,h)),l.seedAssignments=[]);let{matchUps:p,isRoundRobin:m}=Wt({afterRecoveryTimes:!1,inContext:!0,matchUpsMap:r,structure:l});for(let h of p){let{matchUpId:f,roundNumber:g}=h,v=h.sides||[],y=n(f);if(y){if(delete y.extensions,delete y.notes,y.matchUpStatus!==Vt&&Object.assign(y,YT),g&&g>1&&((o=y.drawPositions)==null?void 0:o.length)&&!m){let I=v==null?void 0:v.map(({drawPosition:S,participantFed:w})=>!w&&S).filter(Boolean),b=y.drawPositions.map(S=>I.includes(S)?void 0:S);y.drawPositions=b}e?delete y.timeItems:(s=y.timeItems)!=null&&s.length&&(y.timeItems=y.timeItems.filter(I=>I.itemType&&![zl,Rc,eh,BA,th,ih].includes(I.itemType))),Rt({tournamentId:t==null?void 0:t.tournamentId,context:"resetDrawDefiniton",drawDefinition:i,matchUp:y})}}}i.extensions=i.extensions.filter(l=>l.name!==vf);let a=(i.structures||[]).map(({structureId:l})=>l);return li({drawDefinition:i,structureIds:a}),{...J}}function Sb({tournamentRecord:t}){var r;if(!t)return{error:ge};let e={positionsNoOutcomes:[],canBePruned:[],matchPlay:[],inactive:[],drawAnalysis:{}},i={};return((r=t.events)==null?void 0:r.map(n=>{let a=n.eventId;return i[a]=n,((n==null?void 0:n.drawDefinitions)||[]).map(o=>({drawDefinition:o,eventId:a}))}).flat().filter(Boolean)).forEach(({drawDefinition:n,eventId:a})=>{let o=0,s=0,l=0,{allStructuresLinked:u}=HT({drawDefinition:n}),c=i[a],d=((n==null?void 0:n.structures)||[]).map(b=>{let{stage:S,stageSequence:w,structureId:U}=b,T=ym[S],{inContextStructureMatchUps:D}=ob({drawDefinition:n,structure:b,event:c}),P=D==null?void 0:D.filter(({winningSide:L})=>L),E=P.filter(Boolean).length||0;s+=E,l+=D.length-s;let R=Math.max(P.filter(({roundNumber:L})=>L===1).map(({roundPosition:L})=>L)),{positionAssignments:N}=oi({structure:b}),A=N==null?void 0:N.filter(({participantId:L})=>L);o+=(A==null?void 0:A.length)??0;let M=((N==null?void 0:N.length)??0)-((A==null?void 0:A.length)??0),{roundMatchUps:C,roundProfile:O,roundNumbers:k,maxMatchUpsCount:x}=En({matchUps:D}),F=O&&Object.keys(O).filter(L=>!O[L].inactiveRound).map(L=>parseInt(L)),$=O&&Object.keys(O).filter(L=>O[L].inactiveRound).map(L=>parseInt(L)),_=O&&Object.values(O).every(L=>L.inactiveRound);return{positionsAssignedCount:(A==null?void 0:A.length)??0,maxWinningSideFirstRoundPosition:R,unassignedPositionsCount:M,inactiveStructure:_,maxMatchUpsCount:x,inactiveRounds:$,roundMatchUps:C,activeRounds:F,roundNumbers:k,roundProfile:O,structureId:U,stageSequence:w,orderNumber:T,stage:S}}),p=d.find(b=>b.orderNumber===2&&b.stageSequence===1),m=d.filter(({inactiveStructure:b})=>!b).length,{links:h}=_g({structureId:p.structureId,drawDefinition:n}),f=Qe(p.activeRounds[0])===1&&p.activeRounds.length===1&&m===1,g=d==null?void 0:d.every(({inactiveStructure:b})=>b),v=!h.length&&p.activeRounds.length&&(p.roundProfile[1].inactiveCount||p.inactiveRounds.length),y=n.drawId;o&&!s&&e.positionsNoOutcomes.push(y),g&&e.inactive.push(y),f&&e.matchPlay.push(y),v&&e.canBePruned.push(y);let I={matchUpsWithWinningSideCount:s,matchUpsNoOutcomeCount:l,positionsAssignedCount:o,allStructuresLinked:u,structuresData:d,inactiveDraw:g,isMatchPlay:f,drawId:y};e.drawAnalysis[y]=I}),{...J,drawsAnalysis:e}}function I3({matchPlayDrawPositions:t=!0,tournamentRecord:e,drawDefinition:i,drawId:r}){var o;if(!e)return{error:ge};if(!i)return{error:_e};let n=[],{drawsAnalysis:a}=Sb({tournamentRecord:e});if(a.canBePruned.includes(r)){let s=a.matchPlay.includes(r),l=a.drawAnalysis[r],{structures:[u]}=Zo({stageSequence:1,drawDefinition:i,stage:Oe}),c=l.structuresData.find(({structureId:h})=>u.structureId===h),d=(u.matchUps??[]).sort((h,f)=>h.roundPosition-f.roundPosition);n=d.filter(({roundNumber:h})=>!c.inactiveRounds.includes(h));let p=n.map(Dr),m=d.map(Dr).filter(h=>!p.includes(h));if(s){let h=n.filter(({roundNumber:I})=>!c.inactiveRounds.includes(I)).filter(({winningSide:I})=>I),f=h.map(Dr),g=p.filter(I=>!f.includes(I));m.push(...g);let v=h.flatMap(I=>I.drawPositions??[]).filter(Boolean).flat(),y=Object.assign({},...v.map((I,b)=>({[I]:b+1})));if(h.forEach(I=>{t?I.drawPositions=I.drawPositions.map(b=>y[b]):delete I.drawPositions}),t){let I=(o=u==null?void 0:u.positionAssignments)==null?void 0:o.filter(b=>v.includes(b.drawPosition)).map(b=>(b.drawPosition=y[b.drawPosition],b));u.positionAssignments=I}else u.positionAssignments=[];u.matchUps=h,n=h}zu({tournamentId:e==null?void 0:e.tournamentId,matchUpIds:m,drawDefinition:i}),li({drawDefinition:i})}return{...J,matchUps:n}}function y3({tournamentRecord:t,drawDefinition:e,participantId:i,drawPosition:r,structureId:n,qualifier:a,event:o,bye:s}){if(!e)return{error:_e};if(!r)return{error:Dg};if(!n)return{error:za};if(s){let l=Ya({tournamentRecord:t,drawDefinition:e,drawPosition:r,structureId:n,event:o});if(l.error)return l}else{if(a)return{error:Q0};{let l=rl({tournamentRecord:t,drawDefinition:e,participantId:i,drawPosition:r,structureId:n,event:o});if(l.error)return l}}return{...J}}function b3(t){var l,u,c,d,p;let e=t.matchUpIds??[],{drawDefinition:i}=t,r=t.structureId??((u=(l=i==null?void 0:i.structures)==null?void 0:l.find(m=>{var h;return(h=m.matchUps)==null?void 0:h.some(({matchUpId:f})=>e.includes(f))}))==null?void 0:u.structureId)??((d=(c=i==null?void 0:i.structures)==null?void 0:c[0])==null?void 0:d.structureId);if(!r)return{error:Mi};let n=(p=i.structures)==null?void 0:p.find(m=>m.structureId===r);if(!n)return{error:Mi};let a=n==null?void 0:n.matchUps,o=a==null?void 0:a.find(m=>!!m.roundPosition);if(n.structures||o||n.finishingPosition===Xm)return{error:sp};let s=a.filter(({roundNumber:m})=>{var h;return(h=t.roundNumbers)==null?void 0:h.includes(m)}).map(Dr);return e=e.filter(m=>!s.includes(m)),t.roundNumbers&&!e.length&&(e=s),{existingMatchUps:a,matchUpIds:e,structureId:r,structure:n}}function w3(t){let e=ze(t,[{[Fn]:!0},{[kf]:{[$y]:!1,roundNumbers:!1},[_a]:oe,[Xn]:un}]);if(e.error)return e;let{removeIncomplete:i=!1,removeUnAssigned:r=!0,removeCompleted:n=!1,tournamentRecord:a,drawDefinition:o,event:s}=t,l=b3(t);if(l.error)return l;let{structure:u,structureId:c,existingMatchUps:d,matchUpIds:p}=l,m=[],h=(d==null?void 0:d.filter(({matchUpId:v,score:y,winningSide:I})=>{if(I&&!n)return!1;if(I||Ir({score:y})){if(!I&&!i)return!1;m.push(v)}else if(!r)return!1;return p==null?void 0:p.includes(v)}))??[],f=h.map(Dr),g=h.map(({tieMatchUps:v})=>v==null?void 0:v.map(Dr)).filter(Boolean).flat();if(f.length){u.matchUps=(u.matchUps??[]).filter(({matchUpId:I})=>!f.includes(I)),zu({tournamentId:a==null?void 0:a.tournamentId,matchUpIds:[...g,...f],action:"deleteAdHocMatchUps",eventId:s==null?void 0:s.eventId,drawDefinition:o});let v=ct(u.matchUps.map(Ta("roundNumber"))),y=Une(v);if(y.length){y.reverse();for(let I of y)u.matchUps.forEach(b=>{b.roundNumber&&b.roundNumber>I&&(b.roundNumber-=1,Rt({tournamentId:a==null?void 0:a.tournamentId,context:["adHoc round deletion"],eventId:s==null?void 0:s.eventId,drawDefinition:o,matchUp:b}))})}if(m.length){u.positionAssignments=ct(u.matchUps.flatMap(U=>(U.sides??[]).map(T=>T.participantId)).filter(Boolean)).map(U=>({participantId:U}));let I=(u==null?void 0:u.matchUpFormat)??(o==null?void 0:o.matchUpFormat)??(s==null?void 0:s.matchUpFormat),b=l.existingMatchUps.some(U=>U.matchUpType===ka)?{matchUpTypes:[ka]}:void 0,{matchUps:S}=Wt({afterRecoveryTimes:!1,inContext:!0,matchUpFilters:b,structure:u,event:s});zn({structure:u})&&(u.positionAssignments=ct(S.flatMap(U=>(U.sides??[]).map(T=>T.participantId)).filter(Boolean)).map(U=>({participantId:U})));let w=UO({positionAssignments:u.positionAssignments,tournamentRecord:a,drawDefinition:o,matchUpFormat:I,matchUps:S,event:s});w.error&&console.log(w)}li({structureIds:[c],eventId:s==null?void 0:s.eventId,drawDefinition:o})}return!f.length&&p.length?{error:eT}:{...J,deletedMatchUpsCount:[...f,...g].length}}function U3({removeCompletedMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:r,roundNumber:n,event:a}){if(!e)return{error:ge};if(!i)return{error:_e};if(!n)return ee({result:{error:Xe},info:"roundNumber required"});let o=et({drawDefinition:i,structureId:r});if(o.error)return o;let s=o.structure;return s!=null&&s.structures?{error:sp}:zn({structure:s})?_ue({tournamentId:e.tournamentId,removeCompletedMatchUps:t,eventId:a.eventId,drawDefinition:i,roundNumber:n,structure:s}):(console.log("not implemented"),{...J})}function _ue({removeCompletedMatchUps:t,drawDefinition:e,tournamentId:i,roundNumber:r,structure:n,eventId:a}){let o=(n==null?void 0:n.matchUps)??[],s=[],l=[],u=!1;if(o.reduce((c,d)=>{let p=d==null?void 0:d.roundNumber;return p?c.includes(p)?c:c.concat(p):c},[]).sort(or).includes(r)){let c=o.filter(d=>{let p=d.roundNumber===r&&(!vr.includes(d.matchUpStatus)||t);return p&&(l.push(d.matchUpId),d.tieMatchUps&&s.push(...d.tieMatchUps.map(Dr))),!p});l.length&&(zu({matchUpIds:[...s,...l],drawDefinition:e,tournamentId:i,eventId:a}),c.some(d=>d.roundNumber===r)||(c.forEach(d=>{d.roundNumber>r&&(d.roundNumber-=1,Rt({drawDefinition:e,tournamentId:i,eventId:a,matchUp:d}))}),u=!0),n.matchUps=c)}return{deletedMatchUpsCount:l.length,roundRemoved:u,...J}}function JT(t){var p,m,h,f,g,v;let{suppressNotifications:e,tournamentRecord:i,drawDefinition:r,matchUps:n,event:a}=t;if(typeof r!="object")return{error:_e};let o=t==null?void 0:t.structureId;if(!o&&((p=r.structures)==null?void 0:p.length)===1&&(o=(h=(m=r.structures)==null?void 0:m[0])==null?void 0:h.structureId),typeof o!="string")return{error:za};if(!wo(n))return{error:oe,info:Bd("matchUps")};let s=(f=r.structures)==null?void 0:f.find(y=>y.structureId===o);if(!s)return{error:Mi};let l=(s==null?void 0:s.matchUps).find(y=>!!y.roundPosition);if(s.structures||l||s.finishingPosition===Xm)return{error:sp};let u=((v=(g=Vr({tournamentRecord:i,inContext:!1}))==null?void 0:g.matchUps)==null?void 0:v.map(Dr))??[],c=n.map(Dr);if(Rn(u,c))return{error:EH,info:"One or more matchUpIds already present in tournamentRecord"};s.matchUps.push(...n);let d=n.map(({tieMatchUps:y})=>y).filter(Boolean).flat();return e||(Dc({tournamentId:i==null?void 0:i.tournamentId,matchUps:[...d,...n],eventId:a==null?void 0:a.eventId,drawDefinition:r}),li({drawDefinition:r,structureIds:[o]})),{...J}}function S3({tournamentRecord:t,drawDefinition:e,drawPosition:i,structureId:r,subOrder:n,event:a}){var m;if(!e)return{error:_e};if(!r)return{error:za};if(!i)return{error:Dg};let{structure:o}=et({drawDefinition:e,structureId:r});if(!o)return{error:Mi};let s=o;o.structures&&o.structureType===xn&&(s=(m=o.structures)==null?void 0:m.find(h=>{var f;return(f=h.positionAssignments)==null?void 0:f.find(g=>g.drawPosition===i)}));let l=s==null?void 0:s.positionAssignments,u=l==null?void 0:l.find(h=>h.drawPosition===i);u&&Lt({element:u,extension:{name:Lf,value:n}});let c=((a==null?void 0:a.eventType)===hi||e.matchUpType===hi||((a==null?void 0:a.tieFormat)??(e==null?void 0:e.tieFormat)??(o==null?void 0:o.tieFormat)))&&{matchUpTypes:[hi]},{matchUps:d}=Wt({structure:s,afterRecoveryTimes:!1,inContext:!0,matchUpFilters:c,event:a}),p=(o==null?void 0:o.matchUpFormat)??e.matchUpFormat;return UO({positionAssignments:l,tournamentRecord:t,drawDefinition:e,matchUpFormat:p,matchUps:d,event:a}),li({drawDefinition:e,structureIds:[r]}),{...J}}var T3={};yt(T3,{addGoesTo:()=>$d,allPlayoffPositionsFilled:()=>uO,checkValidEntries:()=>eD,findDrawDefinition:()=>OO,getAssignedParticipantIds:()=>Ip,getAvailableMatchUpsCount:()=>QT,getAvailablePlayoffProfiles:()=>gb,getDrawDefinitionTimeItem:()=>AA,getDrawParticipantRepresentativeIds:()=>NO,getDrawStructures:()=>Zo,getDrawTypeCoercion:()=>Tb,getEligibleVoluntaryConsolationParticipants:()=>MO,getMatchUpsMap:()=>sn,getParticipantIdFinishingPositions:()=>AO,getPositionAssignments:()=>LI,getPositionsPlayedOff:()=>Hg,getSeedingThresholds:()=>rO,getSeedsCount:()=>Db,getStructureSeedAssignments:()=>po,getTeamLineUp:()=>_d,getValidGroupSizes:()=>pb,isAdHoc:()=>zn,isCompletedStructure:()=>Ec,isValidForQualifying:()=>FO,positionActions:()=>xO});function MO({excludedMatchUpStatuses:t=[],includeEventParticipants:e,includeQualifyingStage:i,finishingRoundLimit:r,policyDefinitions:n,roundNumberLimit:a,tournamentRecord:o,drawDefinition:s,matchUpsLimit:l,requirePlay:u,requireLoss:c,allEntries:d,winsLimit:p,event:m}){var O,k,x,F,$;if(!s)return{error:_e};let h=[Oe,$i];i&&h.push(Ye);let f=m!=null&&m.eventType?{matchUpTypes:[m.eventType]}:void 0,g=s!=null&&s.matchUpType?{matchUpTypes:[s.matchUpType]}:void 0,v=e&&m?((O=tu({contextFilters:{stages:h},matchUpFilters:f,tournamentRecord:o,inContext:!0,event:m}))==null?void 0:O.matchUps)??[]:((k=Sn({contextFilters:{stages:h},matchUpFilters:g,tournamentRecord:o,inContext:!0,drawDefinition:s}))==null?void 0:k.matchUps)??[],y=Zm({stage:Or,drawDefinition:s}).map(({participantId:_})=>_),I={},b={},S={},w={};n||(n=Wu({policyTypes:[CC],tournamentRecord:o,drawDefinition:s,event:m}).policyDefinitions);let U=n==null?void 0:n[CC];t=t.length&&t||(U==null?void 0:U.excludedMatchUpStatuses)||[],e=e??(U==null?void 0:U.includeEventParticipants),d=d??(U==null?void 0:U.allEntries),r=r??(U==null?void 0:U.finishingRoundLimit),a=a??(U==null?void 0:U.roundNumberLimit),l=l??(U==null?void 0:U.matchUpsLimit),u===void 0&&(u=(U==null?void 0:U.requirePlay)!==void 0?U.requirePlay:!0),c===void 0&&(c=(U==null?void 0:U.requireLoss)!==void 0?U.requireLoss:!0),p=p??(U==null?void 0:U.winsLimit);for(let _ of v){if(u&&_.winningSide&&![1,2].includes(_.winningSide)&&_.matchUpStatus!==er||_.finishingRound&&r&&_.finishingRound>=r||_.finishingRound&&a&&_.finishingRound<=a)continue;let L=(x=_.sides)==null?void 0:x.find(({sideNumber:V})=>_.winningSide&&V===3-_.winningSide),B=(F=_.sides)==null?void 0:F.find(({sideNumber:V})=>_.winningSide&&V===_.winningSide);if(($=_.sides)==null||$.forEach(V=>{var j;let G=(j=V==null?void 0:V.participant)==null?void 0:j.participantId;G&&(S[G]=V.participant,_.matchUpStatus===er&&!u&&(b[G]=V.participant,I[G]||(I[G]=0),(!_.matchUpStatus||!t.includes(_.matchUpStatus))&&(I[G]+=1)))}),L==null?void 0:L.participant){let V=L.participant.participantId;b[V]=L.participant,I[V]||(I[V]=0),_.matchUpStatus&&!t.includes(_.matchUpStatus)&&(I[V]+=1)}if(B!=null&&B.participant){let V=B.participant.participantId;w[V]||(w[V]=0),w[V]+=1,I[V]||(I[V]=0),_.matchUpStatus&&!t.includes(_.matchUpStatus)&&(I[V]+=1)}}let T=(o==null?void 0:o.participants)&&!u&&!c&&d,D=T?((e&&m?m.entries:s.entries)??[]).filter(_=>![Ru,bo].includes(_.entryStatus)).map(({participantId:_})=>_):[],P=Object.keys(b),E=T?((o==null?void 0:o.participants)??[]).filter(({participantId:_})=>D.includes(_)):c&&Object.values(b)||Object.values(S),R=_=>!c||P.includes(_),N=_=>!u||(I[_]||0)>=0,A=_=>!p||(w[_]||0)<=p,M=_=>!l||I[_]<=l,C=_=>!y.includes(_);return{eligibleParticipants:E.filter(_=>R(_.participantId)&&N(_.participantId)&&A(_.participantId)&&M(_.participantId)&&C(_.participantId)).map(_=>{var L;return{..._,individualParticipants:(L=_.individualParticipantIds)==null?void 0:L.map(B=>{var V;return(V=o==null?void 0:o.participants)==null?void 0:V.find(G=>G.participantId===B)})}}),losingParticipantIds:P,...J}}function QT(t){var h,f,g,v,y,I,b,S;let e=ze(t,[{drawDefinition:!0}]);if(e.error)return e;let{drawDefinition:i,roundNumber:r}=t,n=t.structureId??(((h=i.structures)==null?void 0:h.length)===1&&((g=(f=i.structures)==null?void 0:f[0])==null?void 0:g.structureId));if(typeof n!="string")return{error:za};let a=(v=i.structures)==null?void 0:v.find(w=>w.structureId===n);if(!a)return{error:Mi};let o,s=(y=a.matchUps??[])==null?void 0:y.reduce((w,U)=>(U.roundPosition&&(o=!0),((U==null?void 0:U.roundNumber)||0)>w?U.roundNumber:w),0);if(a.structures||o||a.finishingPosition===Xm)return{error:sp};let l=((I=i==null?void 0:i.entries)==null?void 0:I.filter(w=>{let U=w.entryStatus;return ls.includes(U)}))??[],u=Math.floor((l==null?void 0:l.length)/2)||1,c=r??s??1,d=((S=(b=a.matchUps)==null?void 0:b.filter(w=>w.roundNumber===c))==null?void 0:S.length)??0,p=u-d,m=p>0?p:0;return{...J,availableMatchUpsCount:m,lastRoundNumber:s,roundMatchUpsCount:u}}function NO({drawDefinition:t}){var i;let e=gt({name:"participantRepresentatives",element:t});return e.error?e:{representativeParticipantIds:((i=e.extension)==null?void 0:i.value)||[]}}function $ue({tournamentParticipants:t,drawDefinition:e,event:i}){if(!e)return{error:_e};let r=mr({tournamentParticipants:t,inContext:!0,drawDefinition:e,event:i}),n=Me(r.matchUps,!1,!0),a=ct(n.reduce((s,l)=>s.concat(...l.sides.map(u=>u.participantId).filter(Boolean)),[])),o=Object.assign({},...a.map(s=>{let l=n.filter(u=>u.sides.map(c=>c.participantId).filter(Boolean).includes(s));return{[s]:l}}));return{participantIds:a,participantIdMatchUps:o}}function AO({byeAdvancements:t=!1,tournamentRecord:e,drawDefinition:i}){if(!i)return{error:_e};let{participantIds:r,participantIdMatchUps:n}=$ue({tournamentParticipants:e==null?void 0:e.participants,drawDefinition:i}),a=(r==null?void 0:r.map(o=>{let s=n[o].filter(d=>[qi,Vt].includes(d.matchUpStatus)||d.winningSide),l=s.map(d=>{let p=d.sides.find(h=>h.bye),m=d.sides.find(h=>h.participantId===o).sideNumber;return(d.winningSide||t&&p&&m)===m?d.finishingPositionRange.winner:d.finishingPositionRange.loser}),u=d=>Math.abs(d[0]-d[1]),c=l.reduce((d,p)=>d&&u(d)<u(p)?d:p,void 0);return{[o]:{relevantMatchUps:s,finishingPositionRanges:l,finishingPositionRange:c}}}))||[];return Object.assign({},...a)}function Xc({tournamentRecords:t,tournamentRecord:e,tournamentId:i,drawId:r}){if(!e&&!t)return{error:ge};if(!r)return{error:xs};if(!e&&t){if(typeof i!="string"&&(i=p3({tournamentRecords:t,drawId:r}),!i))return{error:Tf};if(e=t[i],!e)return{error:ge}}let n=e&&Wn({tournamentRecord:e,drawId:r});return n!=null&&n.drawDefinition?{drawDefinition:n.drawDefinition,event:n.event,tournamentRecord:e,...J}:ee({result:{error:xa},stack:"findDrawDefinition"})}function OO(t){let{drawDefinition:e,error:i}=Xc(t);return i?{error:i}:{drawDefinition:Me(e)}}function zC({targetRoundNumber:t,finishingPosition:e,drawDefinition:i,structureId:r,linkType:n}){let{links:a}=_g({drawDefinition:i,structureId:r})||{},o=((a==null?void 0:a.target)||[]).filter(({linkType:s})=>s===n).filter(({target:s})=>!t||t===s.roundNumber).map(s=>{let l=s.source.structureId,{structure:u}=et({structureId:l,drawDefinition:i});if(!(e&&(u==null?void 0:u.finishingPosition)!==e))return s}).filter(Boolean);return{sourceStructureIds:o.map(({source:s})=>s.structureId),relevantLinks:o}}function Bue({tournamentParticipants:t,returnParticipants:e,drawPosition:i,participant:r,drawId:n,event:a}){var s;let o=((s=a==null?void 0:a.entries)==null?void 0:s.filter(({entryStatus:l})=>[bo,fp].includes(l)).map(({participantId:l})=>l))||[];if(o.length){let l=r.individualParticipantIds,u=e?t.filter(({participantId:d})=>o.includes(d)):void 0,c=e?t.filter(({participantId:d})=>l.includes(d)):void 0;return{validModifyAssignedPairAction:Ge({payload:{participantId:r.participantId,replacementIndividualParticipantId:void 0,existingIndividualParticipantId:void 0,drawPosition:i,drawId:n},method:Xle,availableIndividualParticipantIds:o,availableIndividualParticipants:u,existingIndividualParticipantIds:l,existingIndividualParticipants:c,type:pO},!1,!1,!0)}}return{}}function jd(t){var g,v,y,I,b;let{inContextDrawMatchUps:e,targetData:i,drawDefinition:r,relevantLink:n}=t;if((n==null?void 0:n.linkCondition)===tl&&((g=i==null?void 0:i.matchUp)==null?void 0:g.matchUpStatus)===Vt)return!1;let{targetMatchUps:{loserMatchUp:a,winnerMatchUp:o},targetLinks:s}=i,l=a&&Cn({matchUpId:a.matchUpId,inContextDrawMatchUps:e,drawDefinition:r}),u=(v=l==null?void 0:l.targetMatchUps)==null?void 0:v.loserMatchUp,c=(y=l==null?void 0:l.targetMatchUps)==null?void 0:y.loserMatchUpDrawPositionIndex,d=(I=u==null?void 0:u.sides[c])==null?void 0:I.participant,p=[Mt,zt].includes(a==null?void 0:a.matchUpStatus)&&!d,m=((b=o==null?void 0:o.drawPositions)==null?void 0:b.filter(Boolean).length)||0;if(a!=null&&a.winningSide&&!p||o!=null&&o.winningSide&&m===2&&(!o.feedRound||![zt,Mt].includes(o==null?void 0:o.matchUpStatus)))return!0;let h=o&&Cn({matchUpId:o.matchUpId,inContextDrawMatchUps:e,drawDefinition:r}),f=l&&jd({relevantLink:s==null?void 0:s.loserTargetLink,targetData:l,inContextDrawMatchUps:e,drawDefinition:r});return!!(h&&jd({targetData:h,inContextDrawMatchUps:e,drawDefinition:r})||f)}var Vue={[wm]:{policyName:"positionActionsDefault",enabledStructures:[{stages:[Ye,Oe],stageSequences:[1],enabledActions:[],disabledActions:[]},{stages:[],stageSequences:[],enabledActions:[NS,jf,zT,Jv],disabledActions:[]}],disbledStructures:[],otherFlightEntries:!1,activePositionOverrides:[]}},FU="positionAction",WC="matchUpAction";function D3({actionType:t=FU,appliedPolicies:e,drawDefinition:i,structure:r}){var d,p;let n=t===FU&&wm||t===WC&&kr,a=t===FU&&Vue||t===WC&&nq,o=n&&((e==null?void 0:e[n])||(a==null?void 0:a[n])),s=((p=(d=i.links)==null?void 0:d.filter(m=>{var h;return((h=m==null?void 0:m.target)==null?void 0:h.structureId)===(r==null?void 0:r.structureId)}))==null?void 0:p.map(({target:m})=>m.feedProfile))??[],{enabledStructures:l,disabledStructures:u}=o||{},c=u==null?void 0:u.find(m=>{let{stages:h,stageSequences:f,structureTypes:g,feedProfiles:v}=m;return(!(v!=null&&v.length)||Array.isArray(v)&&v.some(y=>s.includes(y)))&&(!(h!=null&&h.length)||Array.isArray(h)&&(h==null?void 0:h.includes(r==null?void 0:r.stage)))&&(!(g!=null&&g.length)||Array.isArray(g)&&(g==null?void 0:g.includes(r==null?void 0:r.structureType)))&&(!(f!=null&&f.length)||Array.isArray(f)&&f.includes(r==null?void 0:r.stageSequence))});return{enabledStructures:l,actionsDisabled:c,actionsPolicy:o}}function XB({activePositionOverrides:t,activeDrawPositions:e,action:i}){return i&&t.includes(i)?!0:!e.length}function P3({enabledStructures:t,drawDefinition:e,structure:i}){var s,l;if(t===!1)return{};if(!(t!=null&&t.length))return{policyActions:{enabledActions:[],disabledActions:[]}};let{stage:r,stageSequence:n,structureType:a}=i||{},o=((l=(s=e.links)==null?void 0:s.filter(u=>{var c;return((c=u==null?void 0:u.target)==null?void 0:c.structureId)===(i==null?void 0:i.structureId)}))==null?void 0:l.map(({target:u})=>u.feedProfile))||[];return{policyActions:t.find(u=>{let{stages:c,stageSequences:d,structureTypes:p,feedProfiles:m}=u||{},h=!(c!=null&&c.length)||Array.isArray(c)&&c.includes(r),f=!(d!=null&&d.length)||Array.isArray(d)&&d.includes(n),g=!(p!=null&&p.length)||Array.isArray(p)&&p.includes(a),v=!(m!=null&&m.length)||Array.isArray(m)&&m.some(y=>o.includes(y));return f&&g&&v&&u&&h})}}function Qn({action:t,policyActions:e}){var r;let i=!(e!=null&&e.enabledActions)||((r=e==null?void 0:e.disabledActions)==null?void 0:r.length)&&e.disabledActions.includes(t);return i?!1:((e==null?void 0:e.enabledActions.length)===0||(e==null?void 0:e.enabledActions.includes(t)))&&!i}var R3="replaceTieMatchUpParticipantId",E3="assignTieMatchUpParticipantId",qC="removeTieMatchUpParticipantId",JB="assignMatchUpSideParticipant",jue="removeMatchUpSideParticipant",C3="substituteParticipant",YC="REMOVE_SUBSTITUTION",M3="REPLACE_PARTICIPANT",kO="REMOVE_PARTICIPANT",KC="setMatchUpStatus",XC="SUBSTITUTION",N3="SCHEDULE",Gue="PENALTY",JC="REFEREE",A3="STATUS",QC="START",O3="SCORE",ZC="END",Hue={REPLACE_TEAM_POSITION_METHOD:R3,ASSIGN_TEAM_POSITION_METHOD:E3,REMOVE_TEAM_POSITION_METHOD:qC,REPLACE_PARTICIPANT:M3,SUBSTITUTION_METHOD:C3,REMOVE_SUBSTITUTION:YC,REMOVE_PARTICIPANT:kO,SCHEDULE_METHOD:KC,SUBSTITUTION:XC,SCHEDULE:N3,PENALTY:Gue,REFEREE:JC,STATUS:A3,SCORE:O3,START:QC,END:ZC};function zue({specifiedPolicyDefinitions:t,inContextDrawMatchUps:e,matchUpParticipantIds:i,matchUpActionsPolicy:r,inContextMatchUp:n,policyActions:a,enforceGender:o,participantId:s,sideNumber:l,matchUpId:u,matchUp:c,drawId:d,side:p}){var A,M,C,O,k,x,F,$,_,L,B,V,G,j,z;let m=[],h=(A=n.sides)==null?void 0:A.find(W=>W.participant),f=n.gender===Bn&&n.sideNumber&&((M=n.sides)==null?void 0:M.filter(W=>W.particiapntId).length)===1&&((O=(C=h==null?void 0:h.participant)==null?void 0:C.person)==null?void 0:O.sex),g=n.matchUpType,v=(o??((k=r==null?void 0:r.participants)==null?void 0:k.enforceGender))!==!1?n.gender:void 0,y=(F=(x=n.sides)==null?void 0:x.flatMap(W=>{var q;return((q=W.participant)==null?void 0:q.individualParticipants)||W.participant}).filter(Boolean))==null?void 0:F.map(Ut),I=($=n.sides)==null?void 0:$.filter(W=>!l||W.sideNumber===l).flatMap(W=>{var q;return((q=W.participant)==null?void 0:q.individualParticipants)||W.participant}).filter(Boolean),b=I==null?void 0:I.map(Ut),S=(L=(_=e==null?void 0:e.find(W=>W.matchUpId===n.matchUpTieId))==null?void 0:_.sides)==null?void 0:L.map(W=>{var q,Y;return(Y=(q=W==null?void 0:W.participant)==null?void 0:q.individualParticipants)==null?void 0:Y.filter(({participantId:re,person:K})=>!(b!=null&&b.includes(re))&&(!v||v===Ps||K.sex===v||v===Bn&&!f||f&&K.sex!==f))}),w=l?S==null?void 0:S[l-1]:S==null?void 0:S.map((W,q)=>({participants:W,sideNumber:q+1})),U=l?(B=S==null?void 0:S[l-1])==null?void 0:B.map(Ut):S==null?void 0:S.map((W,q)=>({participants:W==null?void 0:W.map(Ut),sideNumber:q+1})),T=l&&(Yi(qp)(g)&&!(b!=null&&b.length)||Yi(Md)(g)&&((b==null?void 0:b.length)??0)<2)||!l&&(Yi(qp)(g)&&((b==null?void 0:b.length)??0)<2||Yi(Md)(g)&&((b==null?void 0:b.length)??0)<4),D=U==null?void 0:U.filter(W=>!(y!=null&&y.includes(W))),P=w==null?void 0:w.filter(({participantId:W})=>D.includes(W));if(T&&(D!=null&&D.length)&&m.push({availableParticipantIds:D,method:E3,availableParticipants:P,type:Dm,payload:{participantId:void 0,tieMatchUpId:u,sideNumber:l,drawId:d}}),b!=null&&b.length&&(!Ir(c)||(V=p==null?void 0:p.substitutions)!=null&&V.length)&&m.push({method:qC,type:kO,existingParticipantIds:b,payload:{participantId:void 0,tieMatchUpId:u,drawId:d}}),P!=null&&P.length&&(!l&&(b!=null&&b.length)||l&&(p!=null&&p.participant))&&m.push({availableParticipantIds:D,method:R3,availableParticipants:P,type:M3,existingParticipantIds:b,payload:{existingParticipantId:void 0,participantId:void 0,tieMatchUpId:u,drawId:d}}),Qn({policyActions:a,action:YC})&&((G=p==null?void 0:p.substitutions)==null?void 0:G.length)){let W=((j=p.participant)==null?void 0:j.participantType)===St&&[p.participantId]||((z=p.participant)==null?void 0:z.participantType)===ht&&p.participant.individualParticipantIds||[],q=p.substitutions.map(Y=>Y.participantId).filter(Y=>W.includes(Y));(!s||q.includes(s))&&m.push({method:qC,type:YC,substitutedParticipantIds:q,payload:{participantId:void 0,tieMatchUpId:u,drawId:d}})}let E=t==null?void 0:t[kr],R=E==null?void 0:E.substituteWithoutScore,N=E==null?void 0:E.substituteAfterCompleted;if(Qn({policyActions:a,action:XC})&&i.length===2&&(!l&&(b!=null&&b.length)||l&&(p!=null&&p.participant))&&(R||Ir(c))&&(N||c.matchUpStatus&&!vr.includes(c.matchUpStatus))&&(I!=null&&I.length)&&w.length){let W=I.map(Ut);m.push({info:"list of team players available for substitution",method:C3,availableParticipantIds:U,existingParticipantIds:W,availableParticipants:w,existingParticipants:I,type:XC,payload:{substituteParticipantId:void 0,existingParticipantId:void 0,sideNumber:l,matchUpId:u,drawId:d}})}return m}function Wue({tournamentParticipants:t=[],possiblyDisablingAction:e,activeDrawPositions:i,positionAssignments:r,returnParticipants:n,appliedPolicies:a,drawDefinition:o,drawPosition:s,validActions:l,structureId:u,structure:c,drawId:d,event:p}){var U,T,D,P,E;if(i.includes(s))return{};let m=(U=l.find(R=>R.type===Dm))==null?void 0:U.availableParticipantIds,h=(T=a==null?void 0:a[wm])==null?void 0:T.otherFlightEntries,f=(D=a==null?void 0:a[wm])==null?void 0:D.restrictQualifyingAlternates,g=(o.entries??[]).filter(({entryStage:R})=>!f||(c.stage===Ye?R===Ye:R!==Ye)).sort((R,N)=>(R.entryPosition??1/0)-(N.entryPosition??1/0)).map(({participantId:R})=>R).filter(Boolean),{allPositionedParticipantIds:v}=dW({drawDefinition:o}),y=r.map(R=>R.participantId).filter(Boolean),I=g.filter(R=>c.stage&&[Ye,Oe,$i].includes(c.stage)?!(v!=null&&v.includes(R)):!y.includes(R)),b=((p==null?void 0:p.entries)??[]).filter(R=>R.entryStatus===jo&&k3({restrictQualifyingAlternates:f,structure:c,entry:R})&&(c.stage&&[Ye,Oe,$i].includes(c.stage)?!(v!=null&&v.includes(R.participantId)):!y.includes(R.participantId))).sort((R,N)=>(R.entryPosition??1/0)-(N.entryPosition??1/0)).map(R=>R.participantId),S=ct(I.concat(b));if(h){let R=(E=(P=p?Gi({event:p}).flightProfile:void 0)==null?void 0:P.flights)==null?void 0:E.filter(N=>N.drawId!==d).map(N=>N.drawEntries.filter(A=>A.participantId&&![Ru,bo,fp].includes(A.entryStatus)&&!g.includes(A.participantId)).map(({participantId:A})=>A)).flat().filter(Boolean);R!=null&&R.length&&S.push(...R)}m!=null&&m.length&&(S=S.filter(R=>!m.includes(R)));let w=n?t==null?void 0:t.filter(R=>S.includes(R.participantId)):void 0;return w==null||w.forEach(R=>{let N=(o.entries??[]).find(A=>A.participantId===R.participantId);R.entryPosition=N==null?void 0:N.entryPosition}),w==null||w.sort((R,N)=>(R.entryPosition||1/0)-(N.entryPosition||1/0)),S.length?{validAlternatesAction:Ge({payload:{drawId:d,structureId:u,drawPosition:s},willDisableLinks:e,method:Yle,availableAlternatesParticipantIds:S,type:mO,availableAlternates:w})}:{}}function k3({restrictQualifyingAlternates:t,structure:e,entry:i}){let{stage:r}=e;if(!i.entryStage||i.entryStage===r||r===Ye&&!t||i.entryStage===Oe&&r===rn)return!0}function que({eventEntries:t,structure:e}){let i=n=>n.entryStatus===jo&&k3({structure:e,entry:n}),r=(n,a)=>(n.entryPosition||1/0)-(a.entryPosition||1/0);return t.filter(i).sort(r).map(Ut)}function Yue({restrictAdHocRoundParticipants:t,tournamentParticipants:e,matchUpParticipantIds:i,otherFlightEntries:r,drawDefinition:n,structureId:a,sideNumber:o,matchUpId:s,structure:l,matchUp:u,drawId:c,event:d}){var T,D,P,E,R,N,A;let p=[],m=(l==null?void 0:l.matchUps)??[],h=(D=(T=u.sides)==null?void 0:T.find(M=>M.sideNumber===o))==null?void 0:D.participantId,f=m.filter(({roundNumber:M})=>M===u.roundNumber),g=((P=n==null?void 0:n.entries)==null?void 0:P.filter(({entryStatus:M})=>M&&gp.includes(M)).map(Ut))??[],v=f.map(M=>(M.sides??[]).flatMap(Ut)).flat().filter(Boolean),y=g.filter(M=>!i.includes(M)&&(!t||!v.includes(M))),I=e==null?void 0:e.filter(M=>y==null?void 0:y.includes(M.participantId)).map(M=>Me(M,void 0,!0));I==null||I.forEach(M=>{let C=(n.entries??[]).find(O=>O.participantId===M.participantId);M.entryPosition=C==null?void 0:C.entryPosition}),y.length&&p.push({payload:{drawId:c,matchUpId:s,structureId:a,sideNumber:o},method:JB,type:Dm,availableParticipantIds:y,participantsAvailable:I});let b=(d==null?void 0:d.entries)??[],S=que({eventEntries:b,structure:l}),w=ct(g.concat(S));if(r){let M=(R=(E=d?Gi({event:d}):void 0)==null?void 0:E.flights)==null?void 0:R.filter(C=>C.drawId!==c).flatMap(C=>C.drawEntries.filter(O=>O.participantId&&![Ru,bo,fp].includes(O.entryStatus)).map(({participantId:O})=>O)).filter(Boolean);M!=null&&M.length&&w.push(...M)}w=w.filter(M=>!i.includes(M)&&!y.includes(M)&&(!t||!v.includes(M)));let U=e==null?void 0:e.filter(M=>w.includes(M.participantId)).map(M=>Me(M,void 0,!0));if(U==null||U.forEach(M=>{let C=(n.entries??[]).find(O=>O.participantId===M.participantId);M.entryPosition=C==null?void 0:C.entryPosition}),U==null||U.sort((M,C)=>(M.entryPosition||1/0)-(C.entryPosition||1/0)),w.length&&p.push({payload:{drawId:c,matchUpId:s,structureId:a,sideNumber:o},availableParticipantIds:w,participantsAvailable:U,method:JB,type:jo}),!Ir(u)&&o&&h){p.push({payload:{drawId:c,matchUpId:s,structureId:a,sideNumber:o},method:jue,type:kO});let M=L=>L.sides.map(Ut),C=({matchUpId:L})=>L!==u.matchUpId,O=L=>!Ir(L),k=(A=(N=u.sides)==null?void 0:N.find(L=>L.sideNumber!==o))==null?void 0:A.participantId,x=m.filter(({roundNumber:L})=>L!==u.roundNumber).filter(C).map(M),F=[k,...x.filter(L=>L.includes(h)).flat()].filter(Boolean),$=L=>!F.flat().includes(L),_=f.filter(O).filter(C).map(M).flat().filter($);if(_.length){let L=e==null?void 0:e.filter(B=>_.includes(B.participantId)).map(B=>Me(B,void 0,!0));p.push({payload:{participantIds:[h],roundNumber:u.roundNumber,structureId:a,sideNumber:o,matchUpId:s,drawId:c},swappableParticipantIds:_,method:Jle,type:WT,swappableParticipants:L})}}return p}function ZT(t){var W,q,Y,re,K,H,Z,X,ie;if(!t)return{error:oe};let{drawDefinition:e,event:i}=t,{restrictAdHocRoundParticipants:r=!0,policyDefinitions:n,enforceGender:a,participantId:o,sideNumber:s,matchUpId:l}=t,u=t.tournamentRecord??(t.tournamentId&&Ti(t.tournamentId)&&((W=t.tournamentRecords)==null?void 0:W[t.tournamentId]));if(!u)return{error:ge};if(!l||!Ti(l))return{error:yn};if(s&&![1,2].includes(s))return ee({result:{error:oe},context:{sideNumber:s}});if(!e){let ae=(Vr({tournamentRecord:u}).matchUps??[]).find(ne=>ne.matchUpId===l);i=((u==null?void 0:u.events)??[]).find(ne=>ne.eventId===(ae==null?void 0:ae.eventId));let le=((i==null?void 0:i.drawDefinitions)??[]).find(ne=>ne.drawId===(ae==null?void 0:ae.drawId));le&&(e=le)}if(!e)return{error:_e};let c=Ni({withIndividualParticipants:!0,tournamentRecord:u}).participants,{drawId:d}=e,{matchUp:p,structure:m}=wi({drawDefinition:e,matchUpId:l,event:i});if(!p)return{error:dn};let h=$t({tournamentRecord:u,drawDefinition:e,structure:m,event:i}).appliedPolicies??{};Object.assign(h,n??{});let f=(q=h==null?void 0:h[wm])==null?void 0:q.otherFlightEntries,g=(h==null?void 0:h[kr])??Vg[kr],{enabledStructures:v}=D3({actionType:WC,appliedPolicies:h,drawDefinition:e,structure:m}),{policyActions:y}=P3({enabledStructures:v,drawDefinition:e,structure:m}),I=t.matchUpsMap??sn({drawDefinition:e}),b=t.inContextDrawMatchUps??mr({tournamentParticipants:c,inContext:!0,drawDefinition:e,matchUpsMap:I,event:i}).matchUps,S=b==null?void 0:b.find(ae=>ae.matchUpId===l),w=s&&((Y=S==null?void 0:S.sides)==null?void 0:Y.find(ae=>ae.sideNumber===s)),U=((re=S==null?void 0:S.sides)==null?void 0:re.map(ae=>{var le;return ae.participantId||((le=ae.participant)==null?void 0:le.participantid)}).filter(Boolean))??[],{assignedPositions:T,allPositionsAssigned:D}=Er({structure:m}),{structureId:P}=m??{},E=[];if(!P)return{validActions:E};let R=zn({structure:m}),N=p.collectionId;if(R&&!N){let ae=Yue({restrictAdHocRoundParticipants:r,tournamentParticipants:c,matchUpParticipantIds:U,otherFlightEntries:f,drawDefinition:e,structureId:P,sideNumber:s,matchUpId:l,structure:m,matchUp:p,drawId:d,event:i});E.push(...ae)}let A=Ec({drawDefinition:e,structure:m}),M=T==null?void 0:T.filter(ae=>ae.participantId).map(ae=>ae.drawPosition),C=T==null?void 0:T.filter(ae=>ae.bye).map(ae=>ae.drawPosition),O=p.matchUpStatus===Vt||!N&&((K=p.drawPositions)==null?void 0:K.reduce((ae,le)=>(C==null?void 0:C.includes(le))||ae,!1));if(O)return{validActions:E,isByeMatchUp:O};Qn({policyActions:y,action:JC})&&E.push({type:JC,payload:{matchUpId:l}});let k=!ab({matchUpStatus:p.matchUpStatus}),x=(H=h==null?void 0:h.scoring)==null?void 0:H.structures,F=(m==null?void 0:m.stage)&&(x==null?void 0:x.stage)&&(x==null?void 0:x.stage[m.stage]),$=(m==null?void 0:m.stageSequence)&&(F==null?void 0:F.stageSequence)&&F.stageSequence[m.stageSequence],_=!((Z=h==null?void 0:h.scoring)!=null&&Z.requireAllPositionsAssigned||F!=null&&F.requireAllPositionsAssigned||$!=null&&$.requireAllPositionsAssigned)||D,L=p.sides&&p.sides.filter(ae=>ae==null?void 0:ae.participantId).length===2,B=p.matchUpStatus&&[er,cr].includes(p.matchUpStatus),V=Cn({inContextDrawMatchUps:b,drawDefinition:e,matchUpId:l}),G=jd({inContextDrawMatchUps:b,drawDefinition:e,targetData:V}),j=(((X=S==null?void 0:S.drawPositions)==null?void 0:X.length)===2&&S.drawPositions.every(ae=>M==null?void 0:M.includes(ae))&&((ie=S==null?void 0:S.sides)==null?void 0:ie.length)===2&&S.sides.every(({participantId:ae})=>ae)||L)&&!(B&&G),z={method:jq,type:jf,payload:{drawId:d,matchUpId:l,penaltyCode:void 0,penaltyType:void 0,participantIds:[],notes:void 0}};if(k&&E.push({payload:{drawId:d,matchUpId:l,schedule:{}},method:KC,type:N3}),Qn({policyActions:y,action:jf})&&(w!=null&&w.participant||!s&&(U!=null&&U.length))&&E.push(z),k&&j&&E.push({type:A3}),_&&j){let{matchUpId:ae,matchUpFormat:le}=p,ne={drawId:d,matchUpId:ae,matchUpFormat:le,outcome:{scoreStringSide1:void 0,scoreStringSide2:void 0,sets:[]},winningSide:void 0};E.push({info:"set outcome and winningSide",method:KC,type:O3,payload:ne}),Qn({policyActions:y,action:QC})&&E.push({type:QC}),Qn({policyActions:y,action:ZC})&&E.push({type:ZC})}if(N&&S){let ae=zue({specifiedPolicyDefinitions:n,inContextDrawMatchUps:b,matchUpParticipantIds:U,matchUpActionsPolicy:g,inContextMatchUp:S,policyActions:y,enforceGender:a,participantId:o,sideNumber:s,matchUpId:l,matchUp:p,drawId:d,side:w});E.push(...ae)}return{structureIsComplete:A,validActions:E,isDoubleExit:B,...J}}function Kue({tournamentParticipants:t=[],sourceStructuresComplete:e,possiblyDisablingAction:i,isWinRatioFedStructure:r,activeDrawPositions:n,positionAssignments:a,drawDefinition:o,drawPosition:s,structureId:l,structure:u,drawId:c,event:d}){var v,y,I,b,S,w,U;if(n.includes(s)||r&&!e)return{};let{sourceStructureIds:p,targetStructureIds:m}=((v=o.links)==null?void 0:v.reduce((T,D)=>{var R,N;let P=(R=D.source)==null?void 0:R.structureId,E=(N=D.target)==null?void 0:N.structureId;return T.sourceStructureIds.includes(P)||T.sourceStructureIds.push(P),T.targetStructureIds.includes(E)||T.targetStructureIds.push(E),T},{sourceStructureIds:[],targetStructureIds:[]}))||{},h=[],f=((y=o.links)==null?void 0:y.filter(T=>{var D;return((D=T.target)==null?void 0:D.structureId)===u.structureId}))??[];for(let T of f){let D=(I=T==null?void 0:T.source)==null?void 0:I.structureId,{structure:P}=et({structureId:D,drawDefinition:o}),E=(P==null?void 0:P.finishingPosition)===Xm&&((p==null?void 0:p.length)!==1||(m==null?void 0:m.length)!==1),R={};if(E){let{matchUps:M}=Wt({drawDefinition:o,structure:u,event:d}),{initialRoundNumber:C}=Tm({drawPosition:s,matchUps:M}),O=(w=(S=(b=o.links)==null?void 0:b.find(k=>{var x;return((x=k.target)==null?void 0:x.structureId)===(u==null?void 0:u.structureId)&&k.target.roundNumber===C}))==null?void 0:S.source)==null?void 0:w.roundNumber;R.roundNumbers=[O]}let{completedMatchUps:N}=_T({structureId:D,inContext:!0,matchUpFilters:R,drawDefinition:o}),A=a.map(M=>M.participantId).filter(Boolean);(U=N==null?void 0:N.filter(({matchUpType:M,winningSide:C})=>C&&((d==null?void 0:d.eventType)!==sr||M===sr)).map(({winningSide:M,sides:C})=>M&&(C==null?void 0:C[1-(M-1)])).map(Ut).filter(M=>M&&!A.includes(M)))==null||U.forEach(M=>{h.includes(M)||h.push(M)})}let g=t==null?void 0:t.filter(T=>h==null?void 0:h.includes(T.participantId));return g==null||g.forEach(T=>{let D=(o.entries??[]).find(P=>P.participantId===T.participantId);T.entryPosition=D==null?void 0:D.entryPosition}),h!=null&&h.length?{validLuckyLosersAction:{type:fO,method:Kle,availableLuckyLosers:g,availableLuckyLoserParticipantIds:h,willDisableLinks:i,payload:{drawId:c,structureId:l,drawPosition:s}}}:{}}function Xue({positionSourceStructureIds:t,unassignedParticipantIds:e,possiblyDisablingAction:i,provisionalPositioning:r,tournamentParticipants:n,isWinRatioFedStructure:a,positionAssignments:o,returnParticipants:s,appliedPolicies:l,drawDefinition:u,seedingProfile:c,isByePosition:d,drawPosition:p,structureId:m,event:h}){var S,w,U;let{drawId:f}=u,g=[],v,y,I=[],b=(w=(S=l==null?void 0:l[hs])==null?void 0:S.validSeedPositions)==null?void 0:w.ignore;if(b||({unplacedSeedParticipantIds:v,unplacedSeedAssignments:y,unfilledPositions:I}=vq({provisionalPositioning:r,returnAllProxies:!0,randomize:!0,drawDefinition:u,seedingProfile:c,structureId:m,event:h})),I!=null&&I.length||(I=o.filter(T=>!T.participantId&&!T.bye&&!T.qualifier).map(T=>T.drawPosition)),d||g.push({payload:{drawId:f,structureId:m,drawPosition:p,isPositionAction:!0},willDisableLinks:i,method:eue,type:AS}),a&&b){let T=o.map(N=>N.participantId).filter(Boolean),D={structureIds:t},{completedMatchUps:P}=$g({inContext:!0,matchUpFilters:D,drawDefinition:u}),E=ct((U=(P??[]).filter(({matchUpType:N})=>(h==null?void 0:h.eventType)!==sr||N===sr))==null?void 0:U.map(({sides:N})=>N==null?void 0:N.map(Ut)).flat().filter(N=>N&&!T.includes(N))),R=s?n==null?void 0:n.filter(N=>E==null?void 0:E.includes(N.participantId)).map(N=>Me(N,void 0,!0)):void 0;return R==null||R.forEach(N=>{let A=(u.entries??[]).find(M=>M.participantId===N.participantId);N.entryPosition=A==null?void 0:A.entryPosition}),R!=null&&R.length&&g.push(Ge({payload:{drawId:f,structureId:m,drawPosition:p},willDisableLinks:i,method:jB,type:Dm,availableParticipantIds:E,participantsAvailable:R})),{validAssignmentActions:g}}if(I.includes(p)||d){let T;if(y!=null&&y.length){let P=y.filter(E=>v==null?void 0:v.includes(E.participantId));P.sort(Jue),T=P.map(E=>E.participantId)}else T=e;let D=s?n==null?void 0:n.filter(P=>T.includes(P.participantId)).map(P=>Me(P,void 0,!0)):void 0;D!=null&&D.length&&g.push(Ge({payload:{drawId:f,structureId:m,drawPosition:p},willDisableLinks:i,method:jB,type:Dm,availableParticipantIds:T,participantsAvailable:D}))}return{validAssignmentActions:g}}function Jue(t,e){return t.bye||Bf(t.seedValue)<Bf(e.seedValue)||t.seedValue&&!e.seedValue?-1:(t.seedNumber||0)-(e.seedNumber||0)}function Que({drawPositionInitialRounds:t,tournamentParticipants:e,positionAssignments:i,returnParticipants:r,appliedPolicies:n,drawDefinition:a,drawPosition:o,structureId:s,drawId:l}){var S,w,U;let u=[],c=[],d=[],p=[],m=i.map(T=>T.participantId).filter(Boolean),h=n==null?void 0:n[wm],f=!(h!=null&&h.disableRoundRestrictions)&&t[o],g=h==null?void 0:h.requireCompletedStructures,{sourceStructureIds:v,relevantLinks:y}=zC({targetRoundNumber:f,linkType:Su,drawDefinition:a,structureId:s})||{};v!=null&&v.length&&p.push(...v);let{sourceStructureIds:I,relevantLinks:b}=zC({targetRoundNumber:f,linkType:Uu,drawDefinition:a,structureId:s})||{};I!=null&&I.length&&p.push(...I);for(let T of y){let D=(S=a.structures)==null?void 0:S.find(E=>E.structureId===T.source.structureId);if((D==null?void 0:D.stage)!==Ye)continue;let P=Ec({structureId:T.source.structureId,drawDefinition:a});if(!g||P){let E=D.qualifyingRoundNumber,{matchUps:R}=Wt({matchUpFilters:{roundNumbers:[E],hasWinningSide:!0},afterRecoveryTimes:!1,tournamentParticipants:e,inContext:!0,structure:D});for(let N of R){let A=N.sides.find(C=>(C==null?void 0:C.sideNumber)===N.winningSide),M=N.matchUpStatus===Vt&&((w=N.sides)==null?void 0:w.find(({participantId:C})=>C));if(A||M){let{participantId:C,participant:O}=A||M||{};C&&!m.includes(C)&&(O&&r&&u.push(O),c.push(C))}}}}for(let T of b){let D=(U=a.structures)==null?void 0:U.find(E=>E.structureId===T.source.structureId);if((D==null?void 0:D.stage)!==Ye)continue;let P=Ec({structureId:T.source.structureId,drawDefinition:a});if(!g||P){let{positionAssignments:E}=oi({structure:D}),R=(E==null?void 0:E.map(N=>{var C;let A=N.participantId,M=(C=gt({element:N,name:Sc}).extension)==null?void 0:C.value;return M?{participantId:A,groupOrder:M==null?void 0:M.groupOrder}:{}}).filter(({groupOrder:N,participantId:A})=>N===1&&!m.includes(A)).map(({participantId:N})=>N))??[];if(R&&c.push(...R),r){let N=e.filter(({participantId:A})=>R.includes(A));u.push(...N)}}}return c.length&&d.push(Ge({qualifyingParticipants:r?u:void 0,method:Wle,type:zT,qualifyingParticipantIds:c,payload:{qualifyingParticipantId:void 0,drawPosition:o,structureId:s,drawId:l}})),{validAssignmentActions:d,sourceStructureIds:p}}function Zue({onlyAssignedPositions:t=!0,possiblyDisablingAction:e,tournamentParticipants:i,inactiveDrawPositions:r,activeDrawPositions:n,positionAssignments:a,returnParticipants:o,byeDrawPositions:s,drawDefinition:l,isByePosition:u,drawPosition:c,structureId:d,structure:p,drawId:m,event:h}){if(n.includes(c))return{};let f=P=>!t||P.participantId||P.qualifier||P.bye,g=r==null?void 0:r.filter(P=>P!==c&&!(u&&s.includes(P))),v=(a==null?void 0:a.filter(P=>f(P)&&(g==null?void 0:g.includes(P.drawPosition))))??[],y=v.map(({drawPosition:P})=>P),{matchUps:I}=Wt({afterRecoveryTimes:!1,inContext:!0,drawDefinition:l,structure:p,event:h}),b=I.filter(({drawPositions:P})=>Rn(P,y)),S=Object.assign({},...b.map(P=>{var E;return(E=P.sides)==null?void 0:E.filter(({sourceDrawPositionRange:R})=>R).map(({drawPosition:R,sourceDrawPositionRange:N})=>({[R]:N}))}).flat()),w=v.map(P=>P.participantId).filter(Boolean),U=(i??[]).filter(P=>w.includes(P.participantId)),T=Object.assign({},...U.map(P=>({[P.participantId]:P}))),D=v.map(P=>{let E=T==null?void 0:T[P.participantId],R=S[P.drawPosition];return Ge({...P,participant:o?Me(E,!1,!0):void 0,sourceDrawPositionRange:R})});return D.length?{validSwapAction:{payload:{drawId:m,structureId:d,drawPositions:[c]},willDisableLinks:e,method:Vq,type:WT,availableAssignments:D}}:{}}function xO(t){var z;let e=ze(t,[{event:!0,drawDefinition:!0,structureId:!0}]);if(e.error)return e;let{policyDefinitions:i,returnParticipants:r=!0,provisionalPositioning:n,tournamentRecord:a,drawDefinition:o,drawPosition:s,event:l}=t,u=t.tournamentParticipants??(a&&Ni({withIndividualParticipants:!0,tournamentRecord:a}).participants)??[],c=et({structureId:t.structureId,drawDefinition:o});if(c.error)return c;let d=c.containingStructure||c.structure;if(!d)return{error:Mi};let p=d.structureId;if(c=ob({drawDefinition:o,structureId:p}),s===void 0&&!c.isAdHoc)return{error:Dg};if(c.isAdHoc)return ZT(t);if(c.error)return c;let{drawPositionInitialRounds:m,inactiveDrawPositions:h,activeDrawPositions:f,byeDrawPositions:g}=c,v=$t({tournamentRecord:a,drawDefinition:o,structure:d,event:l}).appliedPolicies??{};Object.assign(v,i??{});let{actionsPolicy:y,enabledStructures:I,actionsDisabled:b}=D3({actionType:FU,appliedPolicies:v,drawDefinition:o,structure:d}),S=(y==null?void 0:y.activePositionOverrides)||[],{sourceStructureIds:w}=zC({finishingPosition:kd,targetRoundNumber:1,linkType:Uu,drawDefinition:o,structureId:p})||{},U;w!=null&&w.length&&(U=w.every(W=>Ec({structureId:W,drawDefinition:o})));let T=w.length,D=w.length&&!U,{policyActions:P}=P3({enabledStructures:I,drawDefinition:o,structure:d}),E=![Ye,Oe].includes(d.stage)||d.stageSequence!==1,{drawId:R}=o,N=[],{assignedPositions:A,positionAssignments:M}=Er({structure:d}),C=A==null?void 0:A.find(W=>W.drawPosition===s),O=!!C;if(!((z=M==null?void 0:M.map(W=>W.drawPosition))!=null&&z.includes(s)))return{error:Tg};let{stage:k,stageSequence:x}=d,F=[k];k===rn&&F.push(Oe),k===Oe&&F.push(rn);let $=Zm({entryStatuses:gp,provisionalPositioning:n,drawDefinition:o,stageSequence:x,structureId:p,stages:F}),_=Ip({drawDefinition:o,stages:F}).assignedParticipantIds??[],L=$.filter(W=>!_.includes(W.participantId)).map(W=>W.participantId),B=g.includes(s),V=f.includes(s);if(b)return{info:"Actions Disabled for structure",isActiveDrawPosition:V,isDrawPosition:!0,hasPositionAssigned:O,validActions:[],isByePosition:B};if(Qn({policyActions:P,action:Dm})&&!V&&M&&!D&&(!C||B)){let{validAssignmentActions:W}=Xue({positionSourceStructureIds:w,unassignedParticipantIds:L,possiblyDisablingAction:E,isWinRatioFedStructure:T,tournamentParticipants:u,positionAssignments:M,returnParticipants:r,appliedPolicies:v,drawDefinition:o,isByePosition:B,drawPosition:s,structureId:p,event:l});W==null||W.forEach(q=>N.push(q))}if(Qn({policyActions:P,action:zT})&&!V){let{validAssignmentActions:W}=Que({drawPositionInitialRounds:m,tournamentParticipants:u,positionAssignments:M,returnParticipants:r,appliedPolicies:v,drawDefinition:o,drawPosition:s,structureId:p,drawId:R});W==null||W.forEach(q=>N.push(q))}let{participantId:G}=C||{},j=G&&u.find(W=>W.participantId===G);if(C){Qn({policyActions:P,action:HC})&&!V&&(N.push({type:HC,method:VB,payload:{drawId:R,structureId:p,drawPosition:s},willDisableLinks:E}),B||N.push({type:hO,method:qle,payload:{drawId:R,structureId:p,drawPosition:s},willDisableLinks:E}),Qn({policyActions:P,action:AS})&&!B&&N.push({type:AS,method:VB,payload:{drawId:R,structureId:p,drawPosition:s,replaceWithBye:!0},willDisableLinks:E}));let W=d.stage===Ye||d.stage===Oe&&d.stageSequence===1;if(!B&&XB({activePositionOverrides:S,activeDrawPositions:f,action:Jv})&&Qn({policyActions:P,action:Jv})&&ES({drawDefinition:o,structureId:p,drawPosition:s})&&W){let{seedAssignments:q}=po({returnAllProxies:!0,drawDefinition:o,structure:d}),{seedNumber:Y,seedValue:re}=(q==null?void 0:q.find(K=>K.participantId===G))??{};N.push({type:Jv,method:tue,participant:j,seedNumber:Y,payload:{drawId:R,structureId:p,participantId:G,seedValue:re}})}if(!B&&XB({activePositionOverrides:S,activeDrawPositions:f,action:xU})&&Qn({policyActions:P,action:xU})&&ES({drawDefinition:o,structureId:p,drawPosition:s})&&W){let{seedAssignments:q}=po({returnAllProxies:!0,drawDefinition:o,structure:d}),{seedNumber:Y}=(q==null?void 0:q.find(re=>re.participantId===G))??{};N.push({method:Zle,type:xU,participant:j,seedNumber:Y,payload:{participantId:G,structureId:p,drawId:R}})}if(!B&&G){if(Qn({policyActions:P,action:jf})){let q={type:jf,method:jq,participant:j,payload:{penaltyCode:void 0,penaltyType:void 0,participantIds:[],notes:void 0,drawId:R}};N.push(q)}if(Qn({policyActions:P,action:NS})){let q={type:NS,method:Qle,participant:j,payload:{participantId:G,otherName:void 0}};N.push(q)}}if(Qn({policyActions:P,action:WT})){let{validSwapAction:q}=Zue({possiblyDisablingAction:E,tournamentParticipants:u,inactiveDrawPositions:h,activeDrawPositions:f,positionAssignments:M,returnParticipants:r,byeDrawPositions:g,drawDefinition:o,isByePosition:B,drawPosition:s,structureId:p,structure:d,drawId:R});q&&N.push(q)}}if(Qn({policyActions:P,action:mO})&&!D){let{validAlternatesAction:W}=Wue({possiblyDisablingAction:E,tournamentParticipants:u,positionAssignments:M,activeDrawPositions:f,returnParticipants:r,appliedPolicies:v,drawDefinition:o,drawPosition:s,validActions:N,structureId:p,structure:d,drawId:R,event:l});W&&N.push(W)}if(Qn({policyActions:P,action:fO})&&!D&&!V&&M){let{validLuckyLosersAction:W}=Kue({sourceStructuresComplete:U,possiblyDisablingAction:E,isWinRatioFedStructure:T,tournamentParticipants:u,activeDrawPositions:f,positionAssignments:M,drawDefinition:o,drawPosition:s,structureId:p,structure:d,drawId:R});W&&N.push(W)}if((j==null?void 0:j.participantType)===ht&&Qn({policyActions:P,action:pO})){let{validModifyAssignedPairAction:W}=Bue({tournamentParticipants:u,returnParticipants:r,drawPosition:s,participant:j,drawId:R,event:l});W&&N.push(W)}return{isActiveDrawPosition:V,isDrawPosition:!0,hasPositionAssigned:O,isByePosition:B,validActions:N,...J}}function Tb({policyDefinitions:t,appliedPolicies:e,drawType:i}){var a,o;let r=(a=t==null?void 0:t[IS])==null?void 0:a.drawTypeCoercion,n=(o=e==null?void 0:e[IS])==null?void 0:o.drawTypeCoercion;return(typeof r=="boolean"?r:void 0)??(i&&(r==null?void 0:r[i]))??(typeof n=="boolean"?n:void 0)??(i&&(n==null?void 0:n[i]))??!0}function LI({tournamentRecord:t,drawDefinition:e,stage:i=Oe,structureId:r,structure:n}){var s;if(!t)return{error:ge};if(!n&&!e)return{error:_e};if(!n&&!r&&((s=e==null?void 0:e.structures)==null?void 0:s.filter(l=>l.stage===i).length)===1&&(n=e.structures.find(l=>l.stage===i)),!n&&!r)return{error:za};let{error:a,positionAssignments:o}=oi({drawDefinition:e,structureId:r,structure:n});return{positionAssignments:o??[],structureId:n==null?void 0:n.structureId,error:a}}function FO({structureId:t,drawDefinition:e}){if(!e)return{error:_e};if(!Ti(t))return{error:oe};let i=_g({drawDefinition:e,structureId:t});if(i.error)return i;let r=i.links.target.flatMap(a=>a.target.feedProfile).filter(Boolean),n=!Vi([Od,Lo,uT,Ad],r).length;return{...J,valid:n}}function x3({participantsCount:t,participantCount:e}){if(t=t??e,!t)return{error:oe};let i=Sg(t);return i?{drawSize:i}:ee({result:{error:oe},stack:"getEliminationDrawSize",context:{participantsCount:t}})}function Db(t){let{drawSizeProgression:e=!1,policyDefinitions:i,drawSize:r}=t||{},{requireParticipantCount:n=!0,tournamentRecord:a,drawDefinition:o,event:s}=t||{},l="getSeedsCount",u=(t==null?void 0:t.participantsCount)??(t==null?void 0:t.participantCount);if(!i){let h=Wu({tournamentRecord:a,drawDefinition:o,event:s});if(h.error)return ee({result:h,stack:l});i=h.policyDefinitions}let c=ot(u);if(u&&!c)return ee({result:{error:oe},context:{participantsCount:u},stack:l});if(n&&!c)return ee({result:{error:nH},stack:l});if(isNaN(r))if(u)({drawSize:r}=x3({participantsCount:u}));else return ee({result:{error:Ey},stack:l});let d=n&&u||r;if(d&&d>r)return{error:DN};let p=i==null?void 0:i[hs];if(!p)return{error:WG};let m=p.seedsCountThresholds;return m?(p.drawSizeProgression!==void 0&&(e=p.drawSizeProgression),{seedsCount:m.filter(h=>e?h.drawSize<=r:r===h.drawSize).reduce((h,f)=>u&&u>=f.minimumParticipantCount?f.seedsCount:h,0)}):{error:MG}}function eD({consideredEntries:t,policyDefinitions:e,tournamentRecord:i,appliedPolicies:r,participantMap:n,enforceGender:a,participants:o,event:s}){var v;if((!o||!n)&&i&&({participants:o,participantMap:n}=Ni({tournamentRecord:i})),!o)return{error:My};if(!Array.isArray(o))return{error:oe};if(!s)return{error:gi};let l=(e==null?void 0:e[kr])??(r==null?void 0:r[kr])??Vg[kr],u=(a??((v=l==null?void 0:l.participants)==null?void 0:v.enforceGender))!==!1,{eventType:c,gender:d}=s,p=c===wu,m=c===Sa&&Kt||p&&ht||St,h=Object.assign({},...(t??s.entries??[]).map(y=>({[y.participantId]:y.entryStatus}))),f=Object.keys(h),g=o.filter(y=>f.includes(y.participantId)).filter(y=>{let I=ece({participant:y,participantType:m,eventType:c,entryStatusMap:h}),b=tce({genderEnforced:u,participantMap:n,eventGender:d,participant:y,isDoubles:p,mismatch:I});return I||!b});if(g.length){let y=g.map(I=>I.participantId);return{error:$G,invalidParticipantIds:y}}return{...J,valid:!0}}function ece({participant:t,participantType:e,eventType:i,entryStatusMap:r}){let n=r[t.participantId],a=i&&[wu,Sa].includes(i)&&t.participantType===St&&(fd(n)||n===Ru);return t.participantType!==e&&!a}function tce(t){var d,p,m;let{participant:e,participantMap:i,eventGender:r,mismatch:n,isDoubles:a,genderEnforced:o}=t,s=!n&&a&&ct(((d=e==null?void 0:e.individualParticipantIds)==null?void 0:d.map(h=>{var f,g,v;return(v=(g=(f=i==null?void 0:i[h])==null?void 0:f.participant)==null?void 0:g.person)==null?void 0:v.sex}).filter(Boolean))??[])||[],l=!r||!(s!=null&&s.length)||Ps===r||[Jt,pi].includes(r)&&s[0]===r||Bn===r&&(s.length===1&&((p=e.individualParticipantIds)==null?void 0:p.length)===1||s.length===2),u=(m=e==null?void 0:e.person)==null?void 0:m.sex,c=!(e!=null&&e.person)||!r||[Ps,Bn].includes(r)||[Jt,pi].includes(r)&&u===r;return!o||l&&c}function F3({qualifyingProfiles:t,appliedPolicies:e,idPrefix:i,isMock:r,uuids:n}){var f;let a="generateQualifyingSTructures",o=[],s=[],l=[],u=(g,v)=>g.stageSequence-v.stageSequence,c=(g,v)=>g.roundTarget-v.roundTarget,d=0,p=0,m,h=1;for(let g of t.sort(c)){let v=g.structureProfiles||[];h=g.roundTarget||h;let y=1,I=0,b,S,w;for(let U of(v||[]).sort(u)){let T=lN(U.drawSize||U.participantsCount),{qualifyingRoundNumber:D,structureOptions:P,matchUpFormat:E,structureName:R,structureId:N,drawType:A}=U,M=U.matchUpType,C=U.qualifyingPositions||ice({drawSize:T,qualifyingRoundNumber:D}),O,k,x;if(!ot(T))return ee({result:{error:Ey},stack:a});let F=t.length>1?`${h}-`:"",$=v.length>1||F?y:"",_=R||(F||$?`${Zr(Ye)} ${F}${$}`:Zr(Ye));if(A===Jo){let{structures:L,groupCount:B,maxRoundNumber:V}=db({structureName:U.structureName||_,structureId:N||(n==null?void 0:n.pop()),stage:Ye,structureOptions:P,appliedPolicies:e,stageSequence:y,matchUpType:M,roundTarget:h,drawSize:T,idPrefix:i,isMock:r,uuids:n});I=B,O=V,k=L[0],m=[1]}else({drawSize:T,matchUps:x,roundLimit:O}=nl({qualifyingRoundNumber:D,qualifyingPositions:C,matchUpType:M,drawSize:T,idPrefix:i,isMock:r,uuids:n})),k=ao({structureName:U.structureName||_,structureId:N||(n==null?void 0:n.pop()),qualifyingRoundNumber:O,stage:Ye,matchUpFormat:E,stageSequence:y,matchUpType:M,roundLimit:O,matchUps:x}),h&&Lt({extension:{name:gl,value:h},element:k}),I=((f=x==null?void 0:x.filter(L=>L.roundNumber===O))==null?void 0:f.length)||0;if(y>1){let{link:L}=fb({sourceStructureId:S,sourceRoundNumber:b,targetStructureId:k.structureId,finishingPositions:w===Uu?[1]:void 0,linkType:w});l.push(L),d+=(T||0)-I}else d+=T||0;w=A===Jo?Uu:Su,S=k.structureId,b=O,s.push(k),y+=1}p+=I,o.push({qualifiersCount:I,finalQualifyingRoundNumber:b,finalQualifyingStructureId:S,finishingPositions:m,roundTarget:h,linkType:w}),h+=1}return{qualifiersCount:p,qualifyingDrawPositionsCount:d,qualifyingDetails:o,structures:s,...J,links:l}}function ice({drawSize:t,qualifyingRoundNumber:e}){let i=t,r=0;for(;r<e;)i=Math.floor(i/2),r+=1;return i}function L3(t){let{drawTypeCoercion:e,enforceMinimumDrawSize:i}=t,r=Qe(t.drawSize),n=e&&t.drawType!==La&&(typeof e=="boolean"||e<=2)&&r===2&&Hs||t.drawType||Hs,a=_z.includes(n);if(r&&a){if(e&&(typeof e=="boolean"&&r<4||r<=e))n=Hs;else if(r<4&&i)return{...ee({context:{enforceMinimumDrawSize:i,drawSize:r,drawType:n},result:{error:j0},stack:"getCoercedDrawType"}),drawType:n}}return{drawType:n}}function rce(t){let{drawDefinition:e,structureOptions:i,requireSequential:r}=t,n={structureName:Zr(Oe),...t,stage:Oe},{structures:a,groupCount:o,groupSize:s}=db(n);if(o<1)return{error:UH};let l=(i==null?void 0:i.playoffGroups)||[{finishingPositions:[1],structureName:Zr($i)}],[u]=a,{structures:c,links:d}=Zq({sourceStructureId:u.structureId,requireSequential:r,drawDefinition:e,playoffGroups:l,groupCount:o,groupSize:s,...t});return c&&a.push(...c),{...J,structures:a,links:d}}function nce({mainStructure:t,consolationStructure:e,deciderStructure:i}){let r=e.matchUps.reduce((u,c)=>(c.drawPositions||[]).filter(Boolean).length&&!u.includes(c.roundNumber)?u.concat(c.roundNumber):u,[]),n=t.matchUps.reduce((u,c)=>!u||c.roundNumber>u?c.roundNumber:u,void 0),a=e.matchUps.reduce((u,c)=>!u||c.roundNumber>u?c.roundNumber:u,void 0),o=r.map((u,c)=>{let d=r.indexOf(u)%2?Lo:Od,p=1+c;return{linkType:jl,source:{roundNumber:p,structureId:t.structureId},target:{feedProfile:d,roundNumber:u,structureId:e.structureId}}}),s={linkType:Su,source:{roundNumber:a,structureId:e.structureId},target:{feedProfile:Lo,roundNumber:n,structureId:t.structureId}},l=[{linkType:Su,source:{roundNumber:n,structureId:t.structureId},target:{feedProfile:Lo,roundNumber:1,structureId:i.structureId}},{linkType:jl,source:{roundNumber:n,structureId:t.structureId},target:{feedProfile:Lo,roundNumber:1,structureId:i.structureId}}];return[...o,s,...l]}function ace({structureName:t,matchUpType:e,idPrefix:i,drawSize:r,isMock:n,uuids:a}){let o=[],{matchUps:s}=Cc({linkFedFinishingRoundNumbers:[1],drawSize:r+1,matchUpType:e,idPrefix:i,isMock:n}),l=vc({structureName:t||Zr(Oe),structureId:a==null?void 0:a.pop(),stageSequence:1,stage:Oe,matchUpType:e,matchUps:s});o.push(l);let u=r/2,{matchUps:c}=Cc({finishingPositionOffset:u,idPrefix:i&&`${i}-c`,drawSize:r-1,isConsolation:!0,matchUpType:e,isMock:n,uuids:a}),d=vc({structureName:Zr(Lz),matchUps:c,structureId:a==null?void 0:a.pop(),stage:rn,stageSequence:2,matchUpType:e});o.push(d);let{matchUps:p}=nl({idPrefix:i&&`${i}-p1t2`,drawSize:2,matchUpType:e,isMock:n}),m=vc({structureName:Zr(Fz),matchUps:p,structureId:a==null?void 0:a.pop(),stageSequence:3,stage:$i,matchUpType:e});o.push(m);let h=nce({mainStructure:l,consolationStructure:d,deciderStructure:m});return{structures:o,links:h,...J}}function oce(t){let{qualifyingRoundNumber:e,finishingPositionOffset:i,qualifyingPositions:r,matchUpType:n,idPrefix:a,drawSize:o,isMock:s,uuids:l}=t;if(!ot(o)||o<2)return{matchUps:[],roundsCount:0};if(Ss(o))return nl(t);let u=sce(o),c=u.shift(),d=Se(1,((c==null?void 0:c.participantsCount)||0)+1).map(g=>({drawPosition:g})),p=[],m=1;({matchUps:p}=OS({roundNumber:m,matchUpType:n,idPrefix:a,matchUps:p,isMock:s,nodes:d,uuids:l})),m++;let h=t.roundLimit||e;for(let g of u){let v=g.participantsCount/2,y=Se(1,v+1);r&&v===r&&(h=m-1);let I=y.map(b=>{let S=gO({roundPosition:b,roundNumber:m,idPrefix:a,uuids:l});return{roundPosition:b,roundNumber:m,matchUpId:S}});p.push(...I),m++}let f=m-1;return p=nb({finishingPositionOffset:i,lucky:!0,roundsCount:f,roundLimit:h,matchUps:p}),h&&(p=p.filter(g=>g.roundNumber<=h)),{matchUps:p,roundsCount:f,roundLimit:h}}function sce(t){let e=Qe(t),i=e%2?e+1:e,r=!!(Math.ceil(i/2)%2),n=[{participantsCount:i,preFeedRound:r}];for(;i>2;){let a=Math.ceil(i/2),o=a===1,s=!!(!o&&a%2);i=!o&&s?a+1:a;let l=!!(i!==2&&Math.ceil(i/2)%2);n.push({participantsCount:i,preFeedRound:l,feedRound:s})}return n}function _3(t){var m,h;let{playoffAttributes:e,stageSequence:i=1,stage:r=Oe,matchUpType:n,drawSize:a,uuids:o}=t,s=()=>!t.isMock&&!t.idPrefix?void 0:`${t.drawDefinition.drawId}-s-0`,l=t.structureId||s()||(o==null?void 0:o.pop()),u=t.appliedPolicies??$t(t),c=((m=t.policyDefinitions)==null?void 0:m[Ff])||(u==null?void 0:u[Ff]);t.skipRounds=t.skipRounds||a<=4&&(c!=null&&c.feedFromMainFinal?0:1)||0;let d=t.structureName??((h=e==null?void 0:e["0"])==null?void 0:h.name)??Zr(Oe),p=()=>{let{matchUps:f}=nl(t);return{structures:[ao({stageSequence:i,structureName:d,matchUpType:n,structureId:l,matchUps:f,stage:r})],links:[],...J}};return{generators:{[La]:()=>({structures:[ao({finishingPosition:kd,stageSequence:i,structureName:d,matchUps:[],matchUpType:n,structureId:l,stage:r})],links:[],...J}),[cp]:()=>{let{matchUps:f}=oce(t);return{structures:[ao({stageSequence:i,structureName:d,matchUpType:n,structureId:l,matchUps:f,stage:r})],links:[],...J}},[Hs]:()=>p(),[Fy]:()=>ace(t),[Nf]:()=>If({...t,roundOffsetLimit:3,playoffAttributes:e??JN}),[Af]:()=>If({...t,roundOffsetLimit:2,playoffAttributes:e??QN}),[$i]:()=>If(t),[Ag]:()=>{let{matchUps:f}=Cc({drawSize:a,uuids:o,matchUpType:n});return{structures:[ao({stageSequence:i,structureName:d,matchUpType:n,structureId:l,stage:Oe,matchUps:f})],links:[],...J}},[Ly]:()=>Xq(t),[Of]:()=>Bp({...t,feedRounds:1,fmlc:!0}),[xz]:()=>Bp({...t,feedRounds:1}),[YN]:()=>Bp({...t,feedsFromFinal:1}),[KN]:()=>Bp({...t,feedsFromFinal:2}),[XN]:()=>Bp({...t,feedsFromFinal:3}),[_y]:()=>Bp(t),[cT]:()=>Qq(t),[Jo]:()=>db(t),[Gl]:()=>rce(t)}}}function LO(t){var _,L,B,V,G;let{enforceMinimumDrawSize:e=!0,overwriteExisting:i,appliedPolicies:r,staggeredEntry:n,drawDefinition:a,tieFormat:o,isMock:s,uuids:l}=t||{},u=Qe(t.drawSize),c=t.drawTypeCoercion??Tb({appliedPolicies:r,drawType:t.drawType}),d="generateDrawStructuresAndLinks",p=L3({drawType:t.drawType,enforceMinimumDrawSize:e,drawTypeCoercion:c,drawSize:u});if(p.error)return p;let m=p.drawType,h=[],f=[],g=(t==null?void 0:t.matchUpType)??ti,v=(_=a==null?void 0:a.structures)==null?void 0:_.filter(({stage:j})=>j===Ye);v&&h.push(...v);let y=v==null?void 0:v.map(({structureId:j})=>j),I=(L=a==null?void 0:a.structures)==null?void 0:L.find(({stage:j,stageSequence:z})=>j===Oe&&z===1),b=(B=a==null?void 0:a.links)==null?void 0:B.filter(j=>j.target.structureId===(I==null?void 0:I.structureId)&&(y==null?void 0:y.includes(j.source.structureId))),S=(j,z)=>{var W;if(j.linkType===Uu&&(z!=null&&z.structures)){let q=j.source.finishingPositions||[];return z.structures.length*q.length}else if(j.linkType===Su&&((W=z==null?void 0:z.matchUps)!=null&&W.length)){let q=j.source.roundNumber;return z.matchUps.filter(({roundNumber:Y})=>Y===q).length}},w=v==null?void 0:v.map(j=>{var K,H,Z;let z=b==null?void 0:b.find(X=>X.target.structureId===j.structureId),W=((H=(K=oi({structure:j}))==null?void 0:K.positionAssignments)==null?void 0:H.length)??0;if(!z)return W;let q=z==null?void 0:z.source.structureId,Y=(Z=a.structures)==null?void 0:Z.find(X=>X.structureId===q),re=S(z,Y)||0;return W-re}).filter(Boolean).reduce((j,z)=>j+z,0),U=b==null?void 0:b.map(j=>{let z=j.source.structureId,W=v==null?void 0:v.find(q=>q.structureId===z);return S(j,W)}).filter(Boolean).reduce((j,z)=>j+z,0),T=!!(I&&!((V=I==null?void 0:I.matchUps)!=null&&V.length));if(v!=null&&v.length&&!T)return{error:TC};let D=!(v!=null&&v.length)&&t.qualifyingProfiles,P=(D==null?void 0:D.length)&&F3({idPrefix:t.idPrefix,qualifyingProfiles:D,appliedPolicies:r,isMock:s,uuids:l});if(P!=null&&P.error)return P;let{qualifyingDrawPositionsCount:E,qualifyingDetails:R,qualifiersCount:N}=P||{qualifyingDrawPositionsCount:w,qualifiersCount:U};E&&(P!=null&&P.structures&&h.push(...P.structures),P!=null&&P.links&&f.push(...P.links)),Object.assign(t,Ge({drawSize:u,matchUpType:g,tieFormat:o}));let A=m!==La&&(!u||u<2||!n&&![Ag,cp].includes(m)&&([Gl,Jo].includes(m)&&u<3||![Jo,Gl].includes(m)&&!Ss(u)));if(A&&!E)return ee({context:{drawSize:u,invalidDrawSize:A},result:{error:j0},stack:d});let{generators:M,error:C}=_3(t);if(C)return{error:C};let O=M[m];if(!O)return{error:pN};let k=O==null?void 0:O();if(k.error)return k;let{structures:x,links:F}=k;if(x!=null&&x.length){let j=x.find(({stage:z,stageSequence:W})=>z===Oe&&W===1);if(I&&j){if(T){let z=j.structureId;if(j.structureId=I.structureId,F==null?void 0:F.length)for(let W of F)W.source.structureId===z&&(W.source.structureId=I.structureId),W.target.structureId===z&&(W.target.structureId=I.structureId)}else if(!i)return{error:TC}}h.push(...x)}h.sort(Qm),F!=null&&F.length&&f.push(...F);let $=k.structures.find(({stage:j,stageSequence:z})=>j===Oe&&z===1);for(let j of R||[]){let{finalQualifyingRoundNumber:z,finalQualifyingStructureId:W,roundTarget:q,finishingPositions:Y,linkType:re}=j,K=$&&((G=fb({targetStructureId:$.structureId,sourceStructureId:W,sourceRoundNumber:z,finishingPositions:Y,targetEntryRound:q,linkType:re}))==null?void 0:G.link);if(K!=null&&K.error)return K;K&&f.push(K)}return b&&f.push(...b),{...J,qualifyingResult:{qualifyingDrawPositionsCount:E,qualifiersCount:N},structures:h,links:f}}function _O(t){var I,b;let{modifyOriginal:e=!0,stageSequence:i=1,isMock:r}=t||{},n="generateDrawTypeAndModifyDrawDefinition";if(!t.drawDefinition)return ee({result:{error:_e},stack:n});let a=e?t.drawDefinition:Me(t.drawDefinition,!1,!0),{tieFormat:o,matchUpType:s}=t;if(o){let S=Hn({tieFormat:o});if(S.error)return S}o=qr(o??((I=vn({drawDefinition:a}))==null?void 0:I.tieFormat)),s=s??(a.matchUpType||ti),t.tieFormat=o,t.matchUpType=s;let l=RS({drawDefinition:a,stage:Oe});t.drawSize=t.drawSize??l,!l&&t.drawSize&&MS({drawSize:t.drawSize,drawDefinition:a,stageSequence:i,stage:Oe});let u=sn({drawDefinition:a}).drawMatchUps.map(Dr),c=LO(t);if(c.error)return ee({result:c,stack:n});let{structures:d,links:p,qualifyingResult:m}=c;a.structures=d,a.links=p;let h=Math.max(t.qualifiersCount??0,(m==null?void 0:m.qualifiersCount)||0);if(m!=null&&m.qualifyingDrawPositionsCount&&!RS({stage:Ye,drawDefinition:a})){let S=MS({drawSize:m.qualifyingDrawPositionsCount,stage:Ye,drawDefinition:a});if(S.error)return S}if(h){let S=$q({qualifiersCount:h,drawDefinition:a,stage:Oe});if(S.error)return S}let f=t.drawSize??l;Object.assign(t,Ge({drawSize:f,matchUpType:s,tieFormat:o}));let{matchUps:g,matchUpsMap:v}=mr({drawDefinition:a});o&&(g==null||g.forEach(S=>{if(!u.includes(S.matchUpId)){let{tieMatchUps:w}=vb({tieFormat:o,matchUp:S,isMock:r});Object.assign(S,{tieMatchUps:w,matchUpType:s})}}));let{inContextDrawMatchUps:y}=$d({drawDefinition:a,matchUpsMap:v});return li({tournamentId:(b=t.tournamentRecord)==null?void 0:b.tournamentId,drawDefinition:a}),{inContextDrawMatchUps:y,drawDefinition:a,matchUpsMap:v,...J,structures:d,matchUps:g,links:p}}function Pb(t){let{removePriorValues:e,tournamentRecord:i,participantId:r,scaleItem:n}=t,a,o;if(!B3({scaleItem:n}))return{error:gm};if(r&&Array.isArray(i.participants)&&(o=i.participants.find(s=>s.participantId===r),o)){if(o.participantType===Vn&&(n==null?void 0:n.eventType)!==Sa)return{error:gm};let s=V3({removePriorValues:e,participant:o,scaleItem:n});if(s.error)return s;a=!s.valueChanged;let{topics:l}=vo();l.includes(nn)&&lt({topic:nn,payload:{tournamentId:i.tournamentId,participants:[o]}})}return a&&{...J,info:ON,existingValue:n==null?void 0:n.scaleValue}||o&&{...J,newValue:n==null?void 0:n.scaleValue}||{error:zi}}function $3(t){var d;let{scaleItemsWithParticipantIds:e=[],removePriorValues:i,tournamentRecord:r,auditData:n,context:a}=t;if(!r)return{error:ge};if(!r.participants)return{error:My};let o=0,s={},l=[];for(let p of e){let m=p==null?void 0:p.participantId;if(Array.isArray(p==null?void 0:p.scaleItems))for(let h of p.scaleItems)if(B3({scaleItem:h}))Array.isArray(s[m])||(s[m]=[]),s[m].push(h);else return{error:gm}}for(let p of r.participants){let{participantId:m}=p||{};if(Array.isArray(s[m]))for(let h of s[m]){if(p.participantType===Vn&&(h==null?void 0:h.eventType)!==Sa)return ee({context:{participantId:m,scaleItem:h,participantType:p.participantType},info:"Invalid participantType for eventType",result:{error:gm}});V3({participant:p,scaleItem:h,removePriorValues:i}),l.push(p),o++}}let u=o?void 0:Mg,{topics:c}=vo();if(c.includes(nn)&&o&&lt({topic:nn,payload:{tournamentId:r.tournamentId,participants:l}}),a){let{eventId:p,drawId:m,...h}=a,f=((d=h.scaleAttributes)==null?void 0:d.scaleType)&&[h.scaleAttributes.scaleType];if(Object.keys(h).length){let g={itemType:vA,itemValue:h};if(f&&(g.itemSubTypes=f),m||p){let{drawDefinition:v,event:y}=Wn({tournamentRecord:r,eventId:p,drawId:m});m&&dO({drawDefinition:v,timeItem:g}),p&&dh({event:y,timeItem:g})}else Ub({tournamentRecord:r,timeItem:g})}}return n&&c.includes(fu)&&lt({topic:fu,payload:n}),Ge({...J,modificationsApplied:o,info:u})}function B3({scaleItem:t}){let e=t&&Object.keys(t),i=["scaleType","eventType","scaleName"];return i.filter(r=>e==null?void 0:e.includes(r)).length===i.length}function V3({removePriorValues:t,participant:e,scaleItem:i}){if(!e)return{error:zm};let r=i&&Object.keys(i),n=["scaleType","eventType","scaleName"];if(n.filter(u=>r.includes(u)&&i[u]).length!==n.length)return{error:gm};let a=new Date().toISOString();e.timeItems||(e.timeItems=[]);let{scaleItem:o}=Cl({scaleAttributes:i,participant:e}),s=u=>[void 0,null,""].includes(u),l=!(s(o==null?void 0:o.scaleValue)&&s(i.scaleValue))&&JSON.stringify(o==null?void 0:o.scaleValue)!==JSON.stringify(i.scaleValue);if(l){let{scaleType:u,eventType:c,scaleName:d}=i,p=[xd,u,c,d].join("."),m=Ge({itemValue:i.scaleValue,itemDate:i.scaleDate,createdAt:a,itemType:p});i.scaleId&&(m.itemSubTypes=[i.scaleId]),t&&(e.timeItems=e.timeItems.filter(h=>h.itemType!==p)),e.timeItems.push(m)}return{...J,valueChanged:l,newValue:i.scaleValue}}function $O(t){let{tournamentRecord:e,modifiedScaleValues:i,removePriorValues:r}=t,n=ze(t,[{[wr]:!0},{modifiedScaleValues:!0,[Xn]:ea}]);if(n.error)return n;for(let a in i){let o=Pb({scaleItem:i[a],removePriorValues:r,tournamentRecord:e,participantId:a});if(o.error)return o}return{...J}}function Gf(t){let{tournamentRecord:e,scaleAttributes:i,participantId:r}=t,n=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(!r)return{error:pr};let{participant:a,tournamentId:o}=qc({tournamentRecords:n,tournamentRecord:e,participantId:r});return a?{...Cl({participant:a,scaleAttributes:i}),tournamentId:o}:{error:zi}}var lce=(t=0)=>250/Math.pow(t+5,.4),uce=()=>1;function cce(t=3,e=2){let i=t/e;return isNaN(i)?nf.kDefault():i}var nf={nSpread:400,diffThreshold:.125,kCalc:lce,kMultiplier:cce,kDefault:uce};function j3(t){let{winnerRating:e,loserRating:i}=t,{ratings:r=Nr,winnerCountables:n=1,loserCountables:a=0,ratingType:o=xo,maxCountables:s,countables:l}=t||{},u=r==null?void 0:r[o];if(!u)return{error:Xe};let c=u.range||t.ratingRange;e=e||u.defaultInitialization,i=i||u.defaultInitialization;let d=c[0]>c[1],p=u.decimalsCount||0,m=d?c.slice().reverse():c,h=(C,O)=>parseFloat(O)>=Math.min(...C)&&parseFloat(O)<=Math.max(...C);(!h(c,e)||!h(c,i))&&(h(c,e)||(e=u.defaultInitialization),h(c,i)||(i=u.defaultInitialization));let f=sf({targetRange:Nr[xo].range,sourceRange:m,value:d?c[0]-e:e}),g=sf({targetRange:Nr[xo].range,sourceRange:m,value:d?c[0]-i:i}),v=(C,O)=>1/(1+Math.pow(10,(O-C)/nf.nSpread)),y=v(f,g),I=v(g,f),b=nf.kCalc(n),S=nf.kCalc(a),w=nf.kMultiplier(s,l),U=f+w*b*(1-y),T=g+w*S*(0-I),D=sf({sourceRange:Nr[xo].range,value:U,targetRange:m}),P=sf({sourceRange:Nr[xo].range,value:T,targetRange:m}),E=d?c[0]-D:D,R=parseFloat(E.toFixed(p)),N=d?c[0]-P:P,A=parseFloat(N.toFixed(p)),M=Math.max(...c)?Math.abs(e-i)/Math.max(...c):0;return(D>P&&M>nf.diffThreshold||R<0||A<0)&&(R=e,A=i),{newWinnerRating:R,newLoserRating:A}}var dce=t=>(t==null?void 0:t.reduce((e,i)=>(i.winningSide&&(e[i.winningSide-1]+=1),e),[0,0]))||[0,0];function G3(t){var y,I;let e=ze(t,[{[wr]:!0},{matchUpIds:!0,[Xn]:un,[Vo]:jm},{ratingType:!1,[Kr]:b=>Nr[b]}]);if(e.error)return e;let{updateParticipantRatings:i,removePriorValues:r=!0,tournamentRecord:n,ratingType:a=xo,refreshDynamic:o,considerGames:s,drawDefinition:l,matchUpIds:u,asDynamic:c}=t,d=Nr[a],{accessor:p}=d,m={},h=(t.matchUps||o&&Sn({drawDefinition:l,tournamentRecord:n,inContext:!0,matchUpFilters:{matchUpStatuses:vr}}).matchUps||Vr({matchUpFilters:{matchUpIds:u,matchUpStatuses:vr},tournamentRecord:n,inContext:!0}).matchUps)??[],f=`${a}.${sA}`,g=c?f:a;h.sort(oh);for(let b of h){let{endDate:S,matchUpFormat:w,score:U,sides:T,winningSide:D}=b,P=b.matchUpType,E={eventType:P,scaleName:a,scaleType:gc},R={scaleName:f,eventType:P,scaleType:gc},N=Object.assign({},...(T??[]).map(_=>{let{sideNumber:L,participant:B}=_;return L&&{[L]:[B==null?void 0:B.participantId,...(B==null?void 0:B.individualParticipantIds)??[]].filter(Boolean).flat()}})),A=Object.assign({},...Object.values(N).flat().map(_=>{let L=m[_],B=!o||L?Gf({scaleAttributes:R,tournamentRecord:n,participantId:_}).scaleItem:void 0,V=Gf({tournamentRecord:n,scaleAttributes:E,participantId:_}).scaleItem,G=p?{[p]:void 0}:void 0;return _&&{[_]:B??V??{scaleName:g,eventType:P,scaleDate:S,scaleType:gc,scaleValue:G}}})),M=w?kn(w):{},C=(M==null?void 0:M.bestOf)||1,O=(M==null?void 0:M.setsTo)||1,k=s?C&O:C,x=(U==null?void 0:U.sets)&&dce(U.sets)||D===1&&[1,0]||[0,1],F=D?N[D]:[],$=D?N[3-D]:[];for(let _ of F){let L=(y=A[_])==null?void 0:y.scaleValue,B=typeof L=="object"?L[p]:L;for(let V of $){let G=(I=A[V])==null?void 0:I.scaleValue,j=typeof G=="object"?G[p]:G,z=D?x[D]:[0,0],W=D?x[3-D]:[0,0],{newWinnerRating:q,newLoserRating:Y}=j3({winnerCountables:z,loserCountables:W,maxCountables:k,winnerRating:B,loserRating:j,ratingType:a}),re=p?{...L,[p]:q}:q,K=p?{...G,[p]:Y}:Y;A[_].scaleValue=re,A[V].scaleValue=K,A[_].scaleName=g,A[V].scaleName=g}}Object.assign(m,A),i&&$O({tournamentRecord:n,modifiedScaleValues:m,removePriorValues:r})}let v=h.map(({matchUpId:b})=>b);return{...J,modifiedScaleValues:m,outputScaleName:g,processedMatchUpIds:v}}function tD(t){var g;let{matchUpIds:e=[],drawDefinition:i,roundNumber:r,newRound:n,isMock:a,event:o}=t;if(typeof i!="object")return{error:_e};let{participantIdPairings:s,matchUpsCount:l}=t,u=QT(t);if(u.error)return ee({result:u});let{lastRoundNumber:c,availableMatchUpsCount:d=0,roundMatchUpsCount:p=0}=u;if(!l)n?l=p:d>0&&(l=d);else if(l>p&&t.restrictMatchUpsCount!==!1)return ee({result:{error:oe,info:"matchUpsCount error",context:{roundMatchUpsCount:p}}});if(s&&!Array.isArray(s)||l&&!ot(l)||e&&!Array.isArray(e)||!s&&!l)return{error:oe,info:"matchUpsCount or pairings error"};if(l&&t.restrictMatchUpsCount!==!1&&l>32)return{error:oe,info:"matchUpsCount must be less than 33"};if(r&&!t.ignoreLastRoundNumber&&r-1>(c||0))return{error:oe,info:"roundNumber error"};let m=r??(n&&(c??0)+1||c||1);s=s??Se(0,l).map(()=>({participantIds:[void 0,void 0]}));let h=v=>{if(!t.idPrefix)return;let y=i.drawId,I=t.idPrefix??"ah";return`${y}-${I}-${m}-${v}`},f=s==null?void 0:s.map((v,y)=>{let I=(v==null?void 0:v.participantIds)??[void 0,void 0];I.push(void 0,void 0);let b=I.slice(0,2).map((w,U)=>Ge({sideNumber:U+1,participantId:w})),S=e[y]??h(y)??Gt();return{roundNumber:m,matchUpStatus:Ji,matchUpId:S,sides:b}});if(f!=null&&f.length){let v=(g=vn({drawDefinition:i,event:o}))==null?void 0:g.tieFormat;v&&f.forEach(y=>{let{tieMatchUps:I}=vb({tieFormat:v,matchUp:y,isMock:a});Object.assign(y,{tieMatchUps:I,matchUpType:hi})})}return{roundNumber:m,matchUpsCount:(f==null?void 0:f.length)??0,matchUps:f,...J}}function pce({maxIterations:t=4e3,valueSortedPairings:e,pairingValues:i,valueObjects:r,deltaObjects:n}){let a=Object.assign({},...e.map(y=>({[y.pairing]:y.value}))),o=Object.keys(i),s=[],l=QB({actorsCount:o.length,valueSortedPairings:e,pairingValueMap:a,deltaObjects:n,valueObjects:r}),u=[vE(l)];s.push(l);let c=l.value,d=l,p=1,m=0,h=o.length,f;do h-=1,f=o.length*i[o[0]].length;while(f>t&&h>5);let g=[];o.forEach(y=>{i[y].slice(0,h).forEach(I=>{m+=1;let b=Zp(y,I.opponent);if(!g.includes(b)){let S=QB({stipulated:[[y,I.opponent]],actorsCount:o.length,valueSortedPairings:e,pairingValueMap:a,deltaObjects:n,valueObjects:r});if(!u.includes(vE(S))){u.push(vE(S)),s.push(S);let{maxDelta:w,value:U}=S;w<d.maxDelta&&(d=S),(U<c||U===c&&Math.round(Math.random()))&&(c=U),g.push(b),p+=1}}}),s=s.filter(I=>Math.abs(I.value-c)<5)}),s.sort((y,I)=>y.maxDiff-I.maxDiff);let v=fa(s);return{candidatesCount:p,deltaCandidate:d,maxIterations:t,iterations:m,candidate:v}}function vE(t){return t.participantIdPairings.map(({participantIds:e})=>e.sort().join("|")).sort().join("/")}function QB({valueSortedPairings:t,stipulated:e=[],pairingValueMap:i,deltaObjects:r,valueObjects:n,actorsCount:a}){let o=[].concat(...e),s=[],l=0;e.filter(Boolean).forEach(d=>{let[p,m]=d,h=Zp(p,m),f=i[h];s.push({participantIds:d,value:f}),l+=i[h]}),Rr(t,a).map(d=>wn(d).map(p=>({...p,value:p.value+Math.random()*Math.round(Math.random())}))).flat().forEach(d=>{let p=d.pairing.split("|");if(!p.reduce((m,h)=>o.includes(h)||m,!1)){o.push(...p);let m=d.value;l+=m,s.push({participantIds:p,value:m})}}),s.sort((d,p)=>d.value-p.value);let u=s.reduce((d,p)=>{let[m,h]=p.participantIds,f=Zp(m,h),g=r[f];return g>d?g:d},0),c=s.reduce((d,p)=>{let[m,h]=p.participantIds,f=Zp(m,h),g=n[f];return g>d?g:d},0);return{value:l,participantIdPairings:s,maxDelta:u,maxDiff:c}}function Zp(t,e){return[t,e].sort($T).join("|")}function H3({participantIds:t}){let e={},i=[];t.forEach(n=>{e[n]=t.filter(a=>a!==n),e[n].forEach(a=>{let o=Zp(a,n);i.includes(o)||i.push(o)})});let r=Object.assign({},...i.map(n=>({[n]:0})));return{uniquePairings:i,possiblePairings:e,deltaObjects:r}}function mce({matchUps:t}){let e=[];for(let i of t){let r=i.sides.map(Ut);if(r.length===2){let[n,a]=r,o=Zp(n,a);e.includes(o)||e.push(o)}}return{encounters:e}}function hce({possiblePairings:t,valueObjects:e}){let i={};for(let n of Object.keys(t)){let a=t[n].map(o=>r(n,o));i[n]=a.sort((o,s)=>o.value-s.value)}function r(n,a){let o=Zp(n,a);return{opponent:a,value:e[o]}}return{pairingValues:i}}var fce=0;function gce({tournamentParticipants:t,adHocRatings:e,eventType:i,scaleName:r,pairing:n}){var o;let a=((o=Nr[r])==null?void 0:o.defaultInitialization)??fce;return n.split("|").map(s=>{var l;if(i===uo){let u=(l=t==null?void 0:t.find(c=>c.participantId===s))==null?void 0:l.individualParticipantIds;return u?u==null?void 0:u.map(c=>e[c]||a):a*2}else return e[s]||a})}function vce(t){let{tournamentParticipants:e,adHocRatings:i={},possiblePairings:r,uniquePairings:n,maxIterations:a,minimizeDelta:o,deltaObjects:s,valueObjects:l,eventType:u,scaleName:c,salted:d}=t;n.forEach(I=>{let b=gce({tournamentParticipants:e,adHocRatings:i,scaleName:c,eventType:u,pairing:I}),S=typeof d=="number"&&d||.5,w=d&&(Math.round(Math.random())?S:S*-1)||0,U=Math.abs(b[0]-b[1])+w,T=Math.abs(b[0]-b[1]);s[I]=T,l[I]||(l[I]=0),l[I]+=U?Math.pow(U,2):0});let p=n.map(I=>({pairing:I,value:l[I]})).sort((I,b)=>I.value-b.value),{pairingValues:m}=hce({possiblePairings:r,valueObjects:l}),{candidate:h,candidatesCount:f,deltaCandidate:g,iterations:v}=pce({valueSortedPairings:p,maxIterations:a,pairingValues:m,deltaObjects:s,valueObjects:l}),{participantIdPairings:y}=o?g:h;return{participantIdPairings:y,candidatesCount:f,deltaCandidate:g,iterations:v,candidate:h}}var Ice=100,yce=100,bce=4e3;function BO(t){var G,j;let{encounterValue:e=Ice,sameTeamValue:i=yce,maxIterations:r=bce,updateParticipantRatings:n,generateMatchUps:a=!0,ignoreLastRoundNumber:o,iterationMatchUps:s,tournamentRecord:l,dynamicRatings:u,refreshDynamic:c,participantIds:d,drawDefinition:p,roundNumber:m,structureId:h,matchUpIds:f,eventType:g,scaleName:v,idPrefix:y,isMock:I,salted:b,event:S}=t;if(!p)return{error:_e};if(!t.structure&&!h)return{error:Mi};let w=t.structure||et({drawDefinition:p,structureId:h}).structure;if(!Nt(w))return{error:lp};if(!(d!=null&&d.length))return{error:Vc};let U=[...s??[],...(w==null?void 0:w.matchUps)??[]],{encounters:T}=mce({matchUps:U}),D=(l==null?void 0:l.participants)??[],P={};if(u){let z=ct(w!=null&&w.matchUps?w.matchUps.map(({roundNumber:q})=>q):[]),W=Math.max(...z,0);if(W){let q=(G=w==null?void 0:w.matchUps)==null?void 0:G.filter(({roundNumber:re})=>re===W).map(({matchUpId:re})=>re),Y=G3({ratingType:v??((j=S==null?void 0:S.category)==null?void 0:j.ratingType),updateParticipantRatings:n,tournamentRecord:l,asDynamic:!0,refreshDynamic:c,drawDefinition:p,matchUpIds:q});if(Y.error)return Y;Y.modifiedScaleValues&&(P=Y.modifiedScaleValues)}}let{valueObjects:E}=wce({tournamentParticipants:D,encounterValue:e,sameTeamValue:i,encounters:T}),{uniquePairings:R,possiblePairings:N,deltaObjects:A}=H3({participantIds:d}),M=Object.values(P).length?P:t.adHocRatings,C={tournamentParticipants:D,possiblePairings:N,participantIds:d,uniquePairings:R,drawDefinition:p,maxIterations:r,adHocRatings:M,deltaObjects:A,valueObjects:E,eventType:g,scaleName:v,structure:w,salted:b},{candidatesCount:O,participantIdPairings:k,deltaCandidate:x,iterations:F,candidate:$}=vce(C);if(!O)return{error:X0};let _,L;if(a){let z=tD({structureId:w==null?void 0:w.structureId,ignoreLastRoundNumber:o,participantIdPairings:k,newRound:!0,drawDefinition:p,roundNumber:m,matchUpIds:f,idPrefix:y,isMock:I,event:S});if(z.error)return z;_=z.roundNumber,L=z.matchUps}let{maxDelta:B,maxDiff:V}=$;return{roundNumber:_,participantIdPairings:k,modifiedScaleValues:P,candidatesCount:O,deltaCandidate:x,...J,iterations:F,matchUps:L,maxDelta:B,maxDiff:V}}function wce({encounters:t,tournamentParticipants:e,encounterValue:i,sameTeamValue:r}){let n={};for(let o of t)n[o]||(n[o]=0),n[o]+=i;let a=e==null?void 0:e.filter(({participantType:o})=>o===Kt);if(a)for(let o of a){let s=o.individualParticipantIds??[],{uniquePairings:l}=H3({participantIds:s});for(let u of l)n[u]||(n[u]=0),n[u]+=r}return{valueObjects:n}}function z3(t){var E,R,N,A;let{drawType:e=Hs,attachConsolation:i=!0,applyPositioning:r=!0,tournamentRecord:n,staggeredEntry:a,automated:o,placeByes:s,isMock:l,event:u}=t,c=t==null?void 0:t.drawDefinition;if(!c)return{error:_e};let d=Or,p=Zm({stageSequence:1,drawDefinition:c,stage:d}),m=[Jo,Fy,Gl].includes(e)?p.length:Sg(p.length);if(!a&&e===Ag&&p.length<2||e===Jo&&p.length<3)return{error:j0};let{tieFormat:h,matchUpType:f}=t;if(h){let M=Hn({tieFormat:h});if(M.error)return M}h=qr(h??((E=vn({drawDefinition:c}))==null?void 0:E.tieFormat)),f=f??c.matchUpType??ti;let{structures:g}=Zo({stageSequence:1,drawDefinition:c,stage:d});if(g.length>1)return{error:VG};if((N=(R=g==null?void 0:g[0])==null?void 0:R.matchUps)!=null&&N.length)return{error:xN};let v=(A=g==null?void 0:g[0])==null?void 0:A.structureId;Object.assign(t,Ge({structureName:t.structureName??Zr(Or),structureId:v,matchUpType:f,tieFormat:h,drawSize:m,stage:d}));let y=_3(t);if(y.error)return y;let I=y.generators[e];if(!I)return{error:pN};let b=I==null?void 0:I();if(b.error)return b;let{structures:S,links:w}=b,U=S.map(M=>Wt({structure:M}).matchUps).flat();h&&U.forEach(M=>{let{tieMatchUps:C}=vb({matchUp:M,tieFormat:h,isMock:l});Object.assign(M,{tieMatchUps:C,matchUpType:f})}),(!r||!i)&&(c=Me(c,!1,!0)),c.links||(c.links=[]),w.length&&c.links.push(...w);let T=S.map(({structureId:M})=>M);c.structures||(c.structures=[]);let D=c.structures.map(({structureId:M})=>M);c.structures=c.structures.map(M=>T.includes(M.structureId)?S.find(({structureId:C})=>C===M.structureId):M);let P=S.filter(({structureId:M})=>!D.includes(M));return P.length&&c.structures.push(...P),o&&hb({seedingProfile:t.seedingProfile,applyPositioning:r,tournamentRecord:n,drawDefinition:c,structureId:v,placeByes:s,drawSize:m,event:u}),i&&li({drawDefinition:c}),{links:w,structures:S,...J}}var VO={};yt(VO,{addGame:()=>Z3,addPoint:()=>Q3,addSet:()=>t6,addShot:()=>e6,analyzeScore:()=>qO,analyzeSet:()=>$I,calculateHistoryScore:()=>K3,checkScoreHasValue:()=>Ir,checkSetIsComplete:()=>nD,clearHistory:()=>J3,generate:()=>W3,generateScoreString:()=>Ml,generateTieMatchUpScore:()=>bb,getSetComplement:()=>KO,getTiebreakComplement:()=>lD,helpers:()=>a6,isValidMatchUpFormat:()=>Ua,keyValueScore:()=>N6,mutate:()=>Y3,parseMatchUpFormat:()=>kn,parseScoreString:()=>LS,query:()=>F6,redo:()=>i6,reverseScore:()=>q3,setServingSide:()=>X3,stringifyMatchUpFormat:()=>oT,tidyScore:()=>x6,umo:()=>n6,undo:()=>r6,validateScore:()=>YO,validateTieFormat:()=>Hn});var W3={};yt(W3,{generateScoreString:()=>Ml,generateTieMatchUpScore:()=>bb,reverseScore:()=>q3});function Ml(t){let{winnerFirst:e=!0,addOutcomeString:i,reversed:r=!1,matchUpStatus:n,matchUpFormat:a,autoComplete:o,winningSide:s,sets:l}=t;if(!l)return{error:Xe,info:"missing sets"};let u=a&&kn(a),{bestOf:c,finalSetFormat:d,setFormat:p}=u??{},m=r||!(!e||!s||s===1),h=i?Uce({matchUpStatus:n}):"",f=(l==null?void 0:l.sort(Sce).map(g).filter(Boolean).join(" "))||"";if(!h)return f;if(s===2)return`${h} ${f}`;return`${f} ${h}`;function g(v){let y=c&&v.setNumber===c&&d?d:p,I=$=>Li($==null?void 0:$.side1Score)||Li($==null?void 0:$.side2Score),b=$=>Li($==null?void 0:$.side1TiebreakScore)||Li($==null?void 0:$.side2TiebreakScore),S=(y==null?void 0:y.tiebreakSet)||!I(v)&&b(v),{side1Score:w,side2Score:U,side1TiebreakScore:T,side2TiebreakScore:D}=v,P=T||(Li(T)||o?0:""),E=D||(Li(D)||o?0:"");if(S)return`[${(m?[E,P]:[P,E]).join("-")}]`;let R=Math.min(P,E),N=R===P?1:2,A=R?`(${R})`:"",M=w||(Li(w)||o?0:""),C=U||(Li(U)||o?0:""),O=$=>N===$?A:"",k=`${M}${O(1)}`,x=`${C}${O(2)}`,F=m?`${[x,k].join("-")}`:`${[k,x].join("-")}`;return["-"," "].includes(F)&&(F=""),F}}function Uce({matchUpStatus:t}){let e={[mn]:"RET",[zt]:"WO",[cr]:"DF/DF",[er]:"WO/WO",[Wc]:"SUS",[$a]:"ABN",[Mt]:"DEF",[Fg]:"DR"};return t&&e[t]||""}function Sce(t,e){return t.setNumber-e.setNumber}function q3(t){if(!(t!=null&&t.score))return{error:Xe};let{sets:e}=t.score,i=e.map(a=>{let{side1TiebreakScore:o,side2TiebreakScore:s,winningSide:l,side1Score:u,side2Score:c,setNumber:d}=a;return Ge({winningSide:l?3-l:void 0,side1TiebreakScore:s,side2TiebreakScore:o,side1Score:c,side2Score:u,setNumber:d})}),r=Ml({sets:i}),n=Ml({sets:i,reversed:!0});return{reversedScore:{sets:i,scoreStringSide1:r,scoreStringSide2:n},...J}}var Y3={};yt(Y3,{addGame:()=>Z3,addPoint:()=>Q3,addSet:()=>t6,addShot:()=>e6,calculateHistoryScore:()=>K3,clearHistory:()=>J3,redo:()=>i6,setServingSide:()=>X3,umo:()=>n6,undo:()=>r6});function yp({matchUp:t}){let{extension:e}=gt({name:UT,element:t});if(!e)return{error:$r};let{history:i=[],undoHistory:r=[]}=e.value;return{history:i,undoHistory:r,...J}}function K3(t){var P,E;if(!t)return{error:Xe};let{matchUp:e,updateScore:i}=t;if(!e)return{error:na};let r=((P=yp({matchUp:e}))==null?void 0:P.history)||[];if(!Array.isArray(r))return{error:oe,info:"history is not an array"};let{matchUpFormat:n}=e;if(!n)return{error:yN};if(!Ua({matchUpFormat:n}))return{error:IN};let a=kn(n),{bestOf:o,finalSetFormat:s,setFormat:l}=a,u=["0","15","30","40","A","G"],c={sets:[]},d=[],p,m=[0,0],h=1,f=0,g,v=0,y=R=>[1,2].includes(R),I=()=>(f+=1,{winningSide:void 0,side1Score:0,side2Score:0,setNumber:f,games:[]}),b=()=>({winningSide:void 0,points:[]}),S=()=>({winningSide:void 0,side1Score:"",side2Score:"",shots:[]}),w=S(),U=b(),T=I(),D=0;for(let R of r){D+=1,g=c.sets.length+1===o;let N=g&&s?s:l,{tiebreakAt:A,setTo:M,NoAD:C,tiebbreakFormat:O}=N,k=T.side1Score===A&&T.side1Score===T.side2Score,x=!!N.tiebreakSet,F=x?N.tiebreakSet:O,{tiebreakTo:$,NoAD:_}=F||{},L=()=>{p=void 0,m=[0,0],h=3-h,T.side1TiebreakScore=0,T.side2TiebreakScore=0,T.side1PointScore="",T.side2PointScore="",v=0},B=j=>{T.winningSide=j;let{s:z,...W}=T;c.sets.push(W),w=S(),U=b(),T=I(),L()},V=j=>{U.winningSide=j;let{g:z,...W}=U;T.games.push(W),w=S(),U=b(),L();let q=`side${j}Score`;T[q]+=1},G=j=>{w.winningSide=j;let{p:z,...W}=w;U.points.push(W),w=S(),v=0;let q=()=>m.reduce((re,K)=>re+K)%4/4>.5?h:3-h,Y=j-1;if(k||x){m[Y]+=1,p=q(),T[`side${j}TiebreakScore`]=m[Y],T[`side${3-j}TiebreakScore`]=m[1-Y];let re=_?1:2;if(m[Y]>=$&&m[Y]>=m[1-Y]+re)return V(j),{gameCompleted:!0}}else if(m[1-Y]===4&&m[Y]===3?m[1-Y]-=1:m[Y]+=1,T.side1PointScore=u[m[0]],T.side2PointScore=u[m[1]],m[Y]===5||m[Y]===4&&m[1-Y]<3||C&&m[Y]===4)return V(j),{gameCompleted:!0}};if(y(R.srv)&&(h=R.srv),["p","s","g","o"].includes(R.u)&&d.push(R.u),R.shotOutcome&&(w.shots.push(R),R.shotType==="SERVE"&&["OUT","NET"].includes(R.shotOutcome)&&(v+=1),v===2)){let j=3-h;G(j)}if(y(R.p)||ot(R.pointNumber)){let j=R.winningSide||R.p;if((E=G(j))!=null&&E.gameCompleted)continue}if(y(R.g)||ot(R.gameNumber)){let j=R.winningSide||R.g;U.winningSide=j;let z=`side${j}Score`,W=`side${3-j}Score`;if(d.length&&(d.includes("p"),d=[]),V(j),T[z]===M&&T[z]-T[W]>=(C?1:2)&&(B(j),g))break}if(y(R.s)||ot(R.setNumber)){let j=R.winningSide||R.s;if(B(j),d.length&&(d.includes("p"),d.includes("g"),d=[]),g)break}}return D!==r.length&&console.log({error:"Match completed with excess history"}),(T.side1Score||T.side2Score||T.games.length||T.side1TiebreakScore||T.side2TiebreakScore)&&c.sets.push(T),c.scoreStringSide1=Ml({...c,matchUpFormat:n}),c.scoreStringSide2=Ml({...c,matchUpFormat:n,reversed:!0}),h=p||h,i&&(e.score=c),{...J,servingSide:h,score:c}}function bp({undoHistory:t,history:e,matchUp:i}){return Lt({element:i,extension:{value:{history:e,undoHistory:t},name:UT}})}function X3({matchUp:t,sideNumber:e}){if(![1,2].includes(e))return{error:SN};let{history:i=[]}=yp({matchUp:t});return i.push({srv:e}),bp({matchUp:t,history:i})}function J3({matchUp:t}){return bp({matchUp:t})}function Q3({matchUp:t,point:e}){if(!e||!t)return{error:Xe};if(typeof e!="object")return{error:oe,context:{point:e}};let{history:i=[]}=yp({matchUp:t});return i.push(e),bp({matchUp:t,history:i})}function Z3({matchUp:t,game:e}){if(typeof e!="object")return{error:oe,context:{game:e}};let{history:i=[]}=yp({matchUp:t});return i.push(e),bp({matchUp:t,history:i})}function e6({matchUp:t,shot:e}){if(typeof e!="object")return{error:Xe};let{history:i=[]}=yp({matchUp:t});return i.push(e),bp({matchUp:t,history:i})}function t6({matchUp:t,set:e}){if(typeof e!="object")return{error:Xe};let{history:i=[]}=yp({matchUp:t});return i.push(e),bp({matchUp:t,history:i})}function i6({matchUp:t}){let{history:e=[],undoHistory:i=[]}=yp({matchUp:t});return i.length&&e.push(i.pop()),bp({matchUp:t,history:e,undoHistory:i})}function r6({matchUp:t}){let{history:e=[],undoHistory:i=[]}=yp({matchUp:t});return i.push(e.pop()),bp({matchUp:t,history:e,undoHistory:i})}var n6={},a6={};yt(a6,{keyValueScore:()=>N6,parseMatchUpFormat:()=>kn,stringifyMatchUpFormat:()=>oT,tidyScore:()=>x6});var em=" ",e1="DEF",Tce="COMPLETED",o6="WO",Dce="WO/WO",s6="ABN",l6="SUS",u6="RET",c6="INT",d6=[u6,e1,o6,Dce,s6,l6,c6],t1="DEFAULTED",p6="WALKOVER",m6="ABANDONED",h6="SUSPENDED",f6="RETIRED",g6="INTERRUPTED",Pce=[f6,t1,p6],Rce="Enter Score",Pm="()",Gd="[]",jO=["up","left","shift+tab"],GO=["enter","down","tab","right"],kS="backspace",v6="r",I6="s",y6="a",b6="d",w6="w",U6="i",iD=[v6,b6,w6,y6,I6,U6],rD="space",IE=["[","("],xS=[...jO,...GO,rD,"]"],S6="-",Ece="/",tm=S6,Nl=S6,T6=[Ece],Cce=0,Mce=["=","+","num_1","num_2","shift+=","shift+-"],HO=["0","1","2","3","4","5","6","7","8","9"].concat(iD),D6=HO.map(t=>`shift+${t}`),P6=[tm,kS].concat(xS,T6),R6=[HO,D6,P6].join(","),Nce=[R6,jO,GO,Mce].join(","),Ace={OUTCOMEKEYS:iD,SIDE1KEYS:HO,SIDE2KEYS:D6,MODIFIERS:P6,PROMPT:Rce,MOVEUP:jO,MOVEDOWN:GO,HOTKEYS:Nce};function qh({scoreString:t,lowSide:e,outcome:i}){if({scoreString:t}=E6({scoreString:t}),e===2){let r=(t&&t[t.length-1])!==em?em:"";return t+r+i}else return i+em+t}function E6({scoreString:t}){if(!t)return{scoreString:""};let e=!1;for(let i of d6){let r=t==null?void 0:t.indexOf(i);r===0?t=t.slice(i.length+1).trim()+em:r>0&&(t=t.slice(0,r)),r>=0&&(e=!0)}return t!=null&&t.trim()||(t=""),{scoreString:t,removed:e}}function i1({analysis:t,scoreString:e,sets:i,lowSide:r}){var f,g,v;let n,a;if(!e)return{scoreString:e,sets:i};let{scoreString:o,removed:s}=E6({scoreString:e});if(e=o,s)return{scoreString:e,sets:i,outcomeRemoved:!0};let l=i[i.length-1]||{},u=Object.values(l).filter(y=>y!==void 0).length;l.setNumber&&u===1&&(i=i.slice(0,i.length-1),l=i[i.length-1]||{});let{tiebreakSet:c}=t.setFormat,{tiebreakTo:d,NoAD:p}=c||{},{isTiebreakEntry:m}=yf({brackets:Gd,scoreString:e}),h=kce(e);if(h>=0){n=e.slice(0,h);let{isTiebreakEntry:y}=yf({brackets:Pm,scoreString:n}),{lastOpenBracketIndex:I,isTiebreakEntry:b}=yf({brackets:Gd,scoreString:n}),S=n&&n[n.length-1].trim(),w=n&&!isNaN(S),U=t.isIncompleteSetScore;if(m&&b){let T=n.slice(I+1).split(Nl),D=(T==null?void 0:T.length)>0&&T[0]!==void 0&&!isNaN(parseInt(T[0]))&&parseInt(T[0])||void 0,P=(T==null?void 0:T.length)>1&&T[1]!==void 0&&parseInt(T[1])||void 0,E=[D,P];if(P){let R=r===1?1:0;E[R]=((E==null?void 0:E[1-R])||0)+(p?1:2),(E[R]||0)<d&&(E[R]=d),n=e.slice(0,I+1),n+=E.join(Nl)}else D!==void 0?(n=e.slice(0,I+1),n+=D):(n=e.slice(0,I),U=!0);l.side1TiebreakScore=E[0]||0,l.side2TiebreakScore=E[1]||0}if(n.length||(n=void 0),U){let T=(f=l.side1Score)==null?void 0:f.toString();if(T){let D=T==null?void 0:T.slice(0,T.length-1);l.side1Score=!isNaN(D)&&parseInt(D)||void 0,l.side1Score===void 0&&(l.side2Score=void 0)}t.isTimedSet?(a=l.side1Score?i:(i==null?void 0:i.slice(0,i.length-1))||[],a[i.length-1]=l):a=(i==null?void 0:i.slice(0,i.length-1))||[]}else if(w){let T=(g=l.side2Score)==null?void 0:g.toString(),D=(v=l.side1Score)==null?void 0:v.toString();if(!t.isTiebreakEntry&&!t.isMatchTiebreak)if(l.side2Score){let P=T==null?void 0:T.slice(0,T.length-1);l.side2Score=!isNaN(P)&&parseInt(P)||void 0}else{let P=D==null?void 0:D.slice(0,D.length-1);l.side1Score=!isNaN(P)&&parseInt(P)||void 0}t.isTimedSet?l.side1Score?(a=i||[],a[i.length-1]=l):a=(i==null?void 0:i.slice(0,i.length-1))||[]:(a=i||[],a[i.length-1]=l),a[a.length-1]&&Object.assign(a[a.length-1],{winningSide:void 0})}else y?(a=i||[],Object.assign(a[a.length-1]||{},{winningSide:void 0,side1TiebreakScore:void 0,side2TiebreakScore:void 0})):(m&&!b?a=(i==null?void 0:i.slice(0,i.length-1))||[]:(a=i,a[i.length-1]=l),m||(a[a.length-1].side2Score=0,a[a.length-1].winningSide=void 0));return{scoreString:n,sets:a}}return{scoreString:e,sets:i}}function yf({brackets:t=Pm,scoreString:e}){if(!e)return{};let[i,r]=t.split(""),n=e.split(""),a=Math.max(...Gs(i,n)),o=Math.max(...Gs(r,n));return{isTiebreakEntry:a>o,lastOpenBracketIndex:a}}function Oce({scoreString:t}){if(!t)return!1;let e=t&&t[t.length-1].trim(),i=t&&!isNaN(e),[r,n]=Gd.split(""),a=t.split(""),o=Math.max(...Gs(r,a)),s=Math.max(...Gs(n,a)),l=Math.max(...Gs(Nl,a));return i&&o>s&&l>o}function kce(t){return t.split("").reduce((e,i,r)=>(i.match(/\d+/g)&&e.push(r),e),[]).pop()}function C6(t){let{lowValue:e=0,NoAD:i=!1,tiebreakTo:r}=t||{},n=i?1:2;return e+1>=r?e+n:parseInt(r)}function ZB({matchUpFormat:t,matchUpStatus:e,winningSide:i,sets:r}){var l;let n=kn(t),{bestOf:a}=n,o=Math.ceil(a/2),s=((l=r==null?void 0:r.reduce((u,c)=>{let{winningSide:d}=c;return d&&u[d-1]++,u},[0,0]))==null?void 0:l.indexOf(o))+1||void 0;return Pce.includes(e)&&i&&(s=i),{matchUpWinningSide:s}}function nD({ignoreTiebreak:t=!1,matchUpScoringFormat:e,matchUpFormat:i,isTiebreakSet:r,isDecidingSet:n,isTimedSet:a,set:o}){var b;if(!o)return{error:Xe,info:"missing set"};e=e||i&&kn(i);let s=n&&e.finalSetFormat||(e==null?void 0:e.setFormat)||{},{side1Score:l,side2Score:u}=o,{setTo:c,tiebreakAt:d}=s,p=l||u,m=aD({set:o}),h=Math.abs(l-u),f=l>=c||u>=c,g=r||l>=c&&u>=c||d&&d<c&&(l===d||u===d),v=t||g&&(m===1&&o.side1TiebreakScore>o.side2TiebreakScore||m===2&&o.side2TiebreakScore>o.side1TiebreakScore),y=!g&&s.NoAD||g||r&&((b=s.tiebreakFormat)!=null&&b.NoAD)?1:2,I=h>=y;return!!((a&&p||f&&(I||g)||r)&&(!g||v))}function aD({set:t}){if(t.side1Score||t.side2Score){if(t.side1Score>t.side2Score)return 1;if(t.side2Score>t.side1Score)return 2}else if(t.side1TiebreakScore||t.side2TiebreakScore){if(t.side1TiebreakScore>t.side2TiebreakScore)return 1;if(t.side2TiebreakScore>t.side1TiebreakScore)return 2}}function zO({analysis:t,set:e}){let i=aD({set:e}),{isDecidingSet:r,isTiebreakSet:n,matchUpScoringFormat:a}=t;return nD({matchUpScoringFormat:a,isDecidingSet:r,isTiebreakSet:n,set:e})&&i}function xce({analysis:t,scoreString:e,sets:i,value:r}){let n;if(!(i!=null&&i.length))return{sets:[]};let a=i[i.length-1];r=Qe(r);let{validSide2Score:o,requiresTiebreak:s}=Fce({analysis:t,set:a,value:r});if(o){n=!0,e=(e||"")+r,a.side2Score=r;let l=zO({analysis:t,set:i[i.length-1]});if(a.winningSide=l||void 0,s){let u=Pm.split("")[0];e+=u}else t.isDecidingSet||(e+=em)}return{sets:i,scoreString:e,updated:n}}function Fce({analysis:t,set:e={},value:i}){let r=t.isDecidingSet&&t.matchUpScoringFormat.finalSetFormat||t.matchUpScoringFormat.setFormat,{tiebreakAt:n,setTo:a,NoAD:o}=r,{side1Score:s}=e,l,u;return n&&n<a?s===n?l=i<=a:l=i<=n:s===a?o?l=i<a:l=i<=a+1:s===a-1?o?l=i<=a:l=i<=a+1:s===a+1?l=i===a||i===a-1:l=i<=a,l&&(n&&n<a?u=s===a&&i===n||s===n&&i===a:u=s>=a&&i>=a&&s!==i),{validSide2Score:l,requiresTiebreak:u}}function M6({lowSide:t,value:e,sets:i,scoreString:r,winningSide:n,matchUpStatus:a}){let o;return e===v6?r?(o=!0,r=qh({scoreString:r,lowSide:t,outcome:u6}),n=t===2?1:2,a=f6):(o=!0,r=qh({scoreString:r,lowSide:t,outcome:e1}),n=t===2?1:2,a=t1):e===b6?(o=!0,r=qh({scoreString:r,lowSide:t,outcome:e1}),n=t===2?1:2,a=t1):e===w6?(o=!0,i=[],r=o6,n=t===2?1:2,a=p6):e===I6&&r?(o=!0,r=qh({scoreString:r,lowSide:t,outcome:l6}),a=h6,n=void 0):e===y6?(o=!0,r=qh({scoreString:r,lowSide:t,outcome:s6}),a=m6,n=void 0):e===U6&&r&&(o=!0,r=qh({scoreString:r,lowSide:t,outcome:c6}),a=g6,n=void 0),{updated:o,sets:i,scoreString:r,matchUpStatus:a,winningSide:n}}function Lce(t){let{sets:e,info:i,scoreString:r,winningSide:n,matchUpStatus:a}=t,{analysis:o,lowSide:s,value:l}=t,u,c;!(e!=null&&e.length)&&l!==kS&&(e=[{setNumber:1}]);let d=e.length-1;if(iD.includes(l)){let p=e[e.length-1]||{},{side1Score:m,side2Score:h}=p;m&&!h?i="missing side2Score":o.finalSetIsComplete||n?i="final set is already complete":o.isIncompleteSetScore?i="incomplete set scoreString":o.isIncompleteSetScore||({sets:e,scoreString:r,winningSide:n,matchUpStatus:a,updated:u}=M6({lowSide:s,value:l,sets:e,scoreString:r,matchUpStatus:a,winningSide:n}))}else if(l===kS){if({scoreString:r,sets:e,outcomeRemoved:c}=i1({analysis:o,scoreString:r,sets:e}),(r==null?void 0:r.trim())===""&&(r=r.trim()),r||(e=[]),c){let p=e[e.length-1]||{},{side1Score:m,side2Score:h}=p;if(m&&h){let f=m>h&&1||h>m&&2||void 0;f&&(p.winningSide=f,e.push({setNumber:e.length+1}))}}a=void 0,n=void 0,u=!0}else if(o.hasOutcome)i="has outcome";else{if(n)return{sets:e,scoreString:r,winningSide:n,matchUpStatus:a,updated:!1,info:"matchUp is complete"};if(l===rD){let p=e[e.length-1]||{},{side1Score:m,side2Score:h}=p,f=m>h&&1||h>m&&2||void 0;f&&!n&&!o.isIncompleteSetScore&&(e[e.length-1].winningSide=f,e.push({setNumber:e.length+1}),r+=" ",u=!0)}else if(l===tm&&e[d].side1Score!==void 0&&e[d].side2Score===void 0&&r&&o.isNumericEnding)r+="-",e[d].side2Score=0,a=void 0,n=void 0,u=!0;else if(!isNaN(l)){let p;if(e[d].side2Score===void 0){let m=Qe((e[d].side1Score||0).toString()+l).toString().slice(0,2);e[d].side1Score=Qe(m),p=e[d].side1Score.toString(),u=!0}else{let m=Qe((e[d].side2Score||0).toString()+l).toString().slice(0,2);e[d].side2Score=Qe(m),p=[e[d].side1Score,e[d].side2Score].join("-"),u=!0}if(u){let m=(e.slice(0,d)||[]).filter(h=>h).map(h=>{let{side1Score:f,side2Score:g}=h;return[f,g].join("-")}).join(" ");m?r=m+" "+p:r=p}}}return{sets:e,scoreString:r,winningSide:n,matchUpStatus:a,info:i,updated:u}}function _ce({analysis:t,auto:e,lowSide:i,scoreString:r="",sets:n,value:a}){var d;let o,s,{tiebreakSet:{tiebreakTo:l,NoAD:u}}=t.setFormat,[c]=Gd.split("");if(t.isMatchTiebreakEntry||(r+=c),n[t.setNumber-1]){let{lastOpenBracketIndex:p}=yf({brackets:Gd,scoreString:r}),m=(r.slice((p??0)+1)+(e?"":a)).split(Nl);if((((d=m[i-1])==null?void 0:d.length)||0)>=2)s="tiebreak digit limit";else if(e){i===1&&(m[0]=(m[0]||"")+a),i===2&&(m[1]=(m[1]||"")+a);let h=[m[0]||0,m[1]||0].map(v=>Qe(v)),f=i===1?1:0;h[f]=h[1-f]+(u?1:2),h[f]<l&&(h[f]=l);let g=n[n.length-1];g.side1TiebreakScore=h[0],g.side2TiebreakScore=h[1],r=r.slice(0,(p??0)+1),r+=h.join(Nl),o=!0}else{let h=[m[0]||0,m[1]||0].map(g=>Qe(g)),f=n[n.length-1];f.side1TiebreakScore=h[0],f.side2TiebreakScore=h[1],r+=a,o=!0}}else{let p=C6({lowValue:Qe(a||0),tiebreakTo:l,NoAD:u}),m=[Qe(a),p];i===2&&m.reverse();let h={side1TiebreakScore:m[0],side2TiebreakScore:m[1],setNumber:(n==null?void 0:n.length)+1||1};n.push(h),r+=m.join(Nl),o=!0}return{info:s,scoreString:r,sets:n,updated:o}}function $ce({analysis:t,lowSide:e,scoreString:i,value:r}){let{setTo:n,tiebreakAt:a,NoAD:o}=(t==null?void 0:t.setFormat)||{},s=r===parseInt(a||n);if(a&&a<n&&r>a)return{scoreString:i};if(o&&r===n||r>n)return{scoreString:i};let l=h(),u=[r,l];e===2&&u.reverse();let c=Pm.split("")[0],d=u.join(tm)+(s?c:em);i=(i||"")+d;let p={side1Score:u[0],side2Score:u[1]},m=zO({analysis:t,set:p});return p.winningSide=m||void 0,{scoreString:i,set:p};function h(){return s?r+1:r+1===n?r+(o?1:2):n}}function Bce({matchUpFormat:t,scoreString:e,winningSide:i,value:r,sets:n}){var x,F,$;let a=(((x=n==null?void 0:n.filter(_=>_==null?void 0:_.winningSide))==null?void 0:x.length)||0)+(i?0:1),o=kn(t),s=a===(o==null?void 0:o.bestOf),l=s&&(o==null?void 0:o.finalSetFormat)||(o==null?void 0:o.setFormat)||{},u=l==null?void 0:l.timed,c=s&&n[(o==null?void 0:o.bestOf)-1],d=c==null?void 0:c.winningSide,{isTiebreakEntry:p}=yf({brackets:Pm,scoreString:e}),{isTiebreakEntry:m}=yf({brackets:Gd,scoreString:e}),h=p||m,f=!!l.tiebreakSet,g=(F=e==null?void 0:e[e.length-1])==null?void 0:F.trim(),v=e&&!isNaN(g),y=!h&&g===tm,I=p&&IE.includes(g),b=m&&IE.includes(g),S=m&&g===Nl,w=e==null?void 0:e.split(""),[U]=Gd.split(""),T=w&&Math.max(...Gs(U,w)),D=w&&Math.max(...Gs(Nl,w)),P=w&&D>T,E=($=n[n.length-1])==null?void 0:$.winningSide,R=(n==null?void 0:n.length)&&!E,N=d6.find(_=>(e==null?void 0:e.indexOf(_))>=0),A=!isNaN(r),M=r===rD,C=xS.includes(r),O=e==null?void 0:e.split("").find(_=>IE.includes(_)),k=C&&m&&!b&&(S||!Oce({scoreString:e}));return{isTiebreakSetValue:f&&A,matchUpScoringFormat:o,setNumber:a,setFormat:l,matchTiebreakHasJoiner:P,isGameScoreEntry:R,isSpace:M,isCloser:C,isTiebreakCloser:C&&O&&h&&v,isDecidingSet:s,isTiebreakSet:f,isTimedSet:u,isNumericEnding:v,isNumericValue:A,hasOpener:O,hasOutcome:N,finalSet:c,finalSetIsComplete:d,lastSetIsComplete:E,isInvalidSetTiebreakValue:M&&h&&I,isInvalidMatchTiebreakValue:k,isTiebreakEntry:h,isSetTiebreakEntry:p,isMatchTiebreakEntry:m,isIncompleteSetScore:y,isIncompleteSetTiebreak:I,isIncompleteMatchTiebreak:b,isPartialMatchTiebreakValue:S}}function N6(t){let{lowSide:e=1,value:i}=t,{scoreString:r,sets:n,winningSide:a,matchUpStatus:o}=t,{matchUpFormat:s,shiftFirst:l,auto:u=!0}=t,c,d,p=l&&e===2||!l&&e===1;if(!R6.includes(i))return{updated:!1,info:"invalid key"};l&&(e=3-e);let{matchUpWinningSide:m}=ZB({sets:n,winningSide:a,matchUpStatus:o,matchUpFormat:s});a=m;let h=Bce({value:i,winningSide:a,scoreString:r,sets:n,matchUpFormat:s});if(T6.includes(i)&&(i=tm),h.hasOpener&&h.isTiebreakEntry&&!h.isTiebreakSet&&p&&Qe(i)===0&&(h.isTiebreakCloser=!0),xS.includes(i)&&h.hasOpener&&(i=""),xS.includes(i)&&(i=rD),h.lastSetIsComplete){let f=(r==null?void 0:r.length)&&r[r.length-1];r&&f!==" "&&(r+=" ")}if(h.isTimedSet)({info:d,sets:n,scoreString:r,updated:c,matchUpStatus:o,winningSide:a}=Lce({analysis:h,lowSide:e,scoreString:r,sets:n,matchUpStatus:o,winningSide:a,value:i}));else if(iD.includes(i))h.finalSetIsComplete||a?d="final set is already complete":!h.isTiebreakEntry&&!h.isIncompleteSetScore?{sets:n,scoreString:r,matchUpStatus:o,winningSide:a,updated:c}=M6({lowSide:e,sets:n,scoreString:r,matchUpStatus:o,winningSide:a,value:i}):h.isTiebreakEntry||h.isIncompleteSetScore?d="incomplete set scoreString or tiebreak entry":console.log("handle case",{value:i});else if(i===kS)c=!0,{scoreString:r,sets:n}=i1({analysis:h,scoreString:r,sets:n,lowSide:e}),r||(n=[]),o=void 0,a=void 0;else if(h.hasOutcome)d="has outcome";else if(i===tm&&!h.isMatchTiebreakEntry)(!h.isSetTiebreakEntry||h.isSetTiebreakEntry&&!h.isNumericEnding)&&(c=!0,{scoreString:r,sets:n}=i1({analysis:h,scoreString:r,sets:n,lowSide:e}),o=void 0);else if(i===Nl&&h.isMatchTiebreakEntry&&!h.isSetTiebreakEntry)h.matchTiebreakHasJoiner?d="existing joiner":h.isNumericEnding&&(c=!0,r+=Nl);else if([tm,Nl].includes(i))d="invalid location for joiner";else{if(a)return{updated:!1,info:"matchUp is complete"};if(h.isIncompleteSetScore)h.isNumericValue&&({sets:n,scoreString:r,updated:c}=xce({analysis:h,scoreString:r,sets:n,value:i}));else if(h.isInvalidMatchTiebreakValue)d="invalid matchUp tiebreak character";else if(h.isInvalidSetTiebreakValue)d="invalid set tiebreak character";else if(h.isTiebreakCloser){let f=h.isSetTiebreakEntry?Pm:Gd,g=f.split("").reverse()[0],v=f.split("")[0],y=n[n.length-1],{tiebreakFormat:I}=h.setFormat,{tiebreakTo:b,NoAD:S}=I||{},w=aD({set:y});if(!h.isTiebreakSet){let T=parseInt(r.split(v).reverse()[0]),D=C6({lowValue:T,tiebreakTo:b,NoAD:S});w===1?(y.side1TiebreakScore=D,y.side2TiebreakScore=T):(y.side1TiebreakScore=T,y.side2TiebreakScore=D)}r=(r||"")+g,h.isDecidingSet||(r+=em);let U=zO({analysis:h,set:y});y.winningSide=U||void 0,c=!0}else if(h.isTiebreakSetValue)({info:d,scoreString:r,sets:n,updated:c}=_ce({analysis:h,auto:u,lowSide:e,scoreString:r,sets:n,value:i}));else if(h.isSetTiebreakEntry){let[f]=Pm.split(""),g=Math.max(...Gs(f,r.split(""))),v=r.slice(g+1),y=v&&Qe(v)===Cce,I=Qe(v?v+i:i),{tiebreakFormat:b}=h.setFormat,{tiebreakTo:S,NoAD:w}=b||{};!y&&v.length<2?w&&I>S-1?d="invalid low value for NoAD tiebreak":(c=!0,r=(r||"")+i):d=y?"tiebreak begins with zero":"tiebreak digit limit"}else if(h.isCloser)d=`invalid key: ${i}`;else if(h.isGameScoreEntry)d="game scoreString entry";else if(h.lastSetIsComplete||!n.length){c=!0;let{scoreString:f,set:g}=$ce({analysis:h,lowSide:e,scoreString:r,value:Qe(i)});g&&(g.setNumber=(n==null?void 0:n.length)+1||1),n=(n==null?void 0:n.concat(g).filter(Boolean))||[g],r=f||void 0}else console.log("error: unknown outcome")}if(c){n=n==null?void 0:n.filter(Boolean);let{matchUpWinningSide:f}=ZB({sets:n,winningSide:a,matchUpStatus:o,matchUpFormat:s});return a=f,f&&(!o||[Ji,co].includes(o))?(o=Tce,n=n.filter(g=>{let{side1Score:v,side2Score:y,side1TiebreakScore:I,side2TiebreakScore:b}=g;return v||y||I||b})):r&&!a&&![h6,m6,g6].includes(o)&&(o=void 0),{updated:c,scoreString:r,sets:n,winningSide:a,matchUpStatus:o,info:d}}return{updated:c,scoreString:r,sets:n,winningSide:a,matchUpStatus:o,info:d}}var oD="\\d+-\\d+",_I="\\d+-\\d+\\(\\d+\\)",WO="\\[\\d+-\\d+\\]",Vce="\\d+-\\d+\\(\\d+-\\d+\\)",jce=new RegExp(`(${oD}),`,"g"),Gce=new RegExp(`(${_I}),`,"g"),Hce=[oD,_I,WO,Vce],zce=["0","1","2","00","01","10","11","002","012","102","112","000","001","010","100","011","101","110","111","002","012","102","112","0002","0012","0102","1002","0112","1012","1102","1112","3","03","13","013","103"],Wce=zce.map(t=>{let e=t.split("").map(i=>Hce[i]).join(" ");return new RegExp(`^${e}$`)});function eV(t){return!t||Wce.some(e=>e.test(t))}function qce(t){let e="[];",i="()",r=e+i,n=[e[0],i[0]],a=Object.assign({},...r.split("").map(l=>({[l]:0}))),o="",s=t.split("").map(l=>{let u=r.includes(l)&&l,c=n.includes(u);if(c&&u)return a[u]+=1,o=u,l;if(!c&&u&&o&&u!==o){a[o]-=1;let d=e.includes(o)&&e||i.includes(o)&&i||"",p=d.split("").find(m=>m!==o);if(d.includes(u))a[o]||(o="");else return a[u]||(o=""),p}return l}).join("");return t!==s?s:t}function LU(t){return/^\(\d+\)$/.test(t)||/^\(\d+$/.test(t)}function Yce(t){return/^\(\d+-\d+\)$/.test(t)||/^\[\d+-\d+\]$/.test(t)}function Hf(t){let e=(i=>i==null?void 0:i.split("-").join("").split("/").join(""))(t);if(/^\d+$/.test(e)&&e.length===2){let i=e.split("");return Math.abs(i.reduce((r,n)=>+r-+n))===1}return!1}function FS(t,e){let i=[t.slice(e,e+2),e?t.slice(0,1):t.slice(2)].map(n=>parseInt(n.join("")));e&&i.reverse();let r=i;if(Math.abs(r.reduce((n,a)=>+n-+a))>=2)return r.join("-")}function tV(t){return t.length===2?t.split("").join("-"):([", ",",","/"," "].forEach(e=>t=t.split(e).join("-")),t=t.replace(/-{2,}/,"-"),t)}function Kce(t){return t.startsWith("(")&&t.endsWith(")")}function Xce({score:t,applied:e}){t=qce(t);let i=/\)(\d+)/g;if(i.test(t))for(let w of t.match(i)){let U=w.replace(")",") ");t=t.replace(w,U)}t=t.replace(/\)\//g,") / "),t=t.replace(/\/\)/g,")");let r=/\(([\d- ]+)\)/g,n=/\(([\d- ]+)\)/,a=t.match(r);for(let w of a||[]){let[U]=w.match(n).slice(1),T=U.replace(/ /g,"");t=t.replace(w,`(${T})`)}let o=/\(\(\d-\d\)\)/g;if(o.test(t)){let w=t.match(o);w.length&&w.forEach(U=>{let T=U.match(/\((\(\d-\d\))\)/).slice(1)[0];t=t.replace(U,T)})}if(o=/\(\((\d)\)\)/g,o.test(t)){let w=t.match(o);w.length&&w.forEach(U=>{let T=U.match(/\((\(\d\))\)/).slice(1)[0];t=t.replace(U,T)})}/(^|\s)6-,/.test(t)&&(t=t.replace(/(^|\s)6-,/g,"6-0,"));let s=new RegExp(/[-,]{2,}/g);t=t.replace(s,"-"),["- "," -"].forEach(w=>{let U=new RegExp(`(\\d+)${w}(\\d+)`,"g"),T=t.match(U);T&&T.forEach(D=>t=t.replace(D,D.split(w).join("-")))}),/^[(-/,]+$/.test(t)&&(t=""),/\)[-/,]+$/.test(t)&&(t=t.slice(0,t.length-1)),/\d \/\d/.test(t)&&(t=t.replace(/ \//g,"/")),t.includes(" /")&&(t=t.replace(/ \//g," "));let l=/\(\d+, \)/g;l.test(t)&&t.match(l).forEach(w=>{let[U]=w.match(/\((\d+), \)/).slice(1);U.length===2?t=t.replace(w,`(${U})`):U.length===1&&U==="6"&&(t=t.replace(w,"(6-0)"))});let u=/\((\d+)\/\)/g;u.test(t)&&t.match(u).forEach(w=>{let[U]=w.match(/\((\d+)\/\)/).slice(1);U.length===2?t=t.replace(w,`(${U})`):U.length===1&&U==="6"?t=t.replace(w,"(6-0)"):t=t.replace(w,`(${U})`)});let c=/\d\/\d\/,/g;c.test(t)&&t.match(c).forEach(w=>{let[U]=w.match(/(\d\/\d)\/,/).slice(1);t=t.replace(w,`${U},`),e.push("slashComma")});let d=/\(\/(\d+)\)/g;d.test(t)&&t.match(d).forEach(w=>{let[U]=w.match(/\(\/(\d+)\)/).slice(1);U.length===2?t=t.replace(w,`(${U})`):U.length===1&&parseInt(U)<6?t=t.replace(w,`(6-${U})`):t=t.replace(w,`(${U})`)});let p,m,h,f,g,v=()=>{g=wa(t.split("")),m=g["("]===(g[")"]||0)+1,p=(g["("]||0)+1===g[")"],h=g["["]===g["]"]+1,f=m&&!h};v();let y=/(\d+-\d+\(\d+)0,/;if(y.test(t)){let[w]=t.match(y).slice(1);t=t.replace(y,w+")")}if(g["("]===g[")"]&&g["("]>1){let w=t.split(")(").join(") (").split(" ");w.every(Kce)?t=w.map(U=>{let T=U.slice(1,U.length-1);return T.length>2?T:U}).join(" "):t=w.join(" ")}v();let I=/[A-Za-z]+/.test(t),b=/\d+/.test(t);if(!I&&!b)return{score:""};if(/^\[.+\]$/.test(t)&&"()/,- ".split("").some(w=>g[w])&&(t=t.slice(1,t.length-1)),/^\(.+\)$/.test(t)&&g["("]===1&&g[")"]===1&&"[]/,".split("").some(w=>g[w]>1)&&(t=t.slice(1,t.length-1)),t.startsWith("(")&&t.endsWith("))")&&(t=t.slice(1,t.length-1)),g["("]>(g[")"]||0)&&t[t.length-1]==="("&&(t=t.slice(0,t.length-1)+")",v()),g["("]===1&&!g[")"]&&t[0]==="("&&(t=t+")",v()),g["("]>(g[")"]||0)&&t.slice(0,2)==="(("&&(t=t.slice(1)),p){if(/^9\d/.test(t))t="("+t.slice(1);else if(t[0]!=="(")t="("+t;else{let w=[],U=0;for(let T of t.split("").reverse())T===")"&&(U?w.push("("):U+=1),T==="("&&(U-=1),w.push(T);w.reverse(),t=w.join("")}v()}if(g[")"]>(g["("]||0)&&t[0]===")"&&(t="("+t.slice(1),v()),f&&(t.endsWith(9)||/\d+0$/.test(t))&&(t=t.slice(0,t.length-1)+")",v()),f&&(!t.endsWith(")")||t.startsWith("(("))&&(t=t+")",v()),f){let w="",U=0;for(let T of t.split(""))T==="("&&(U?w+=")":U+=1),T===")"&&(U-=1),w+=T;t=w}v(),h&&!m&&(t=t+"]"),t.includes("([")&&t.includes("])")&&(t=t.split("([").join("[").split("])").join("]"),v()),/\(\d+0$/.test(t)&&(t=t.slice(0,t.length-1)+")"),v(),g[")"]===1&&!g["("]&&t.endsWith(")")&&(t=t.slice(0,t.length-1)),t.startsWith("(")&&t.endsWith(")")&&g["("]===1&&g[")"]===1&&(t=t.slice(1,t.length-1),v());let S=w=>{let U=w.indexOf("("),T=w.indexOf(")");return U>=0&&T>=0&&U<T};if(/^\([\d ]+.*[\d ]+\)$/.test(t)&&g["("]===g[")"]){let w=t.slice(1,t.length-1);S(w)&&(t=w,v())}return{score:t,applied:e}}function sD(t){if(!/^[\d-]+(\(\d\))*$/.test(t))return t;let e=Gs("-",t.split(""));if(!e.length)return t;let i=t.split("-"),r=!(i.length%2),n=!!(e.length%2);return r&&n&&e.length>i.length/2&&e.filter((a,o)=>o%2).forEach(a=>{t=t.substring(0,a)+" "+t.substring(a+1)}),t}function Jce({score:t,applied:e}){return t.includes("( ")&&(e.push("removeParenSpacingAfterOpen"),t=t.split("( ").map(i=>i.trim()).join("(")),t.includes(" )")&&(e.push("removeParenSpacingBeforeClose"),t=t.split(" )").map(i=>i.trim()).join(")")),[jce,Gce].forEach(i=>{let r=t.match(i);r!=null&&r.length&&(r.forEach(n=>{t=t.replace(n,n.slice(0,n.length-1)+" ")}),e.push("setsEndComma"))}),t=t.split(" ").filter(Boolean).map(sD).join(" "),{score:t,applied:e}}function Qce({score:t}){if(typeof t!="string")return{score:t};let e=p=>p==null?void 0:p.split("-").join("").split("/").join(""),i=p=>p.split("[").join("(").split("]").join(")");t=t.split(", ").join(" ");let r=t.split(" ");t=r.map(p=>{let m=/^-(\d+)$/;if(m.test(p)){let[h]=p.match(m).slice(1);if(h.length===2)return h.split("").join("-")}return p}).join(" "),r=t.split(" ");let n=r.filter(LU),a=0,o="";for(let p of n){let m=Gs(p,r).filter(v=>!a||v>a)[0],h=r.slice(a,m-1),f=r[m-1],g=e(f);if(/^\d+$/.test(g)&&g.length===2){let v=g.split(""),y=Math.abs(v.reduce((I,b)=>+I-+b));if(y===1){let I=[h.join(" "),[f,p].join("")].join(" ");o+=I,a=m+1}else if(y===0){let I=Math.max(...v);if([4,5,6,7,8,9].includes(I)){let b=[6,4].includes(I)?I+1:I-1,S=[I,b].sort().reverse().join("-"),w=[h.join(" "),[S,p].join("")].join(" ");o+=w,a=m+1}}}}if(n.length&&o.length){let p=r.slice(a).join(" ");return o=[o,p].join(" "),{score:o.trim()}}if(r.length===2&&["(","["].some(p=>r[1].includes(p))){let p=e(r[0]).split("");if(Math.abs(p.reduce((m,h)=>+m-+h,0))===1)return r[1]=i(r[1]),{score:r.join("")}}let s=r.map(p=>Yce(p)&&"bracket"||Hf(p)&&"set");if(s.includes("set")&&s.includes("bracket")){let p,m="";return r.forEach((h,f)=>{s[f]==="bracket"&&p==="set"?(h=i(h),m+=h):m+=` ${h}`,p=s[f]}),{score:m.trim()}}r=t.split(" ");let l,u=r.map(p=>{let m=new RegExp(/^(\d+)-(\d+)$/);if(m.test(p)){let[h,f]=p.match(m).slice(1),g=Math.abs([h,f].reduce((y,I)=>+y-+I)),v=Math.max(h,f);if(g===1)return l="tiebreakSet",l;if(g>=2&&v>=7&&l==="tiebreakSet")return l="tiebreak",l}}),c=Gs("tiebreak",u);if(c.length){let p="";r.forEach((m,h)=>{c.includes(h)?p+=`(${m}) `:c.includes(h+1)?p+=`${m}`:p+=`${m} `}),t=p.trim()}let d=/(\d+-\d+)\((\d+)-(\d+)\)$/;if(d.test(t)){let[p,m,h]=t.match(d).slice(1),f=Math.max(m,h)>=10;!Hf(p)&&f&&(t=t.replace(d,`${p} [${m}-${h}]`))}return u=[],t=t.split(" ").map(p=>{let m=/^\((.*)\)$/,h=m.test(p),f=new RegExp(WO).test(p)&&"super"||new RegExp(_I).test(p)&&"tiebreak"||new RegExp(oD).test(p)&&"standard"||"unknown";return u.push(f),f==="standard"&&h?p.match(m)[1]:p}).join(" "),{score:t}}function Zce({score:t,applied:e}){for(let T of[".",","," ","/"]){let D=new RegExp(`^(\\d+)\\${T}(\\d+)$`);if(D.test(t)){let P=t.match(D).slice(1).map(R=>parseInt(R)),E=Math.abs(P[0]-P[1]);E<=10&&E>=2&&(t=t.split(T).join("-"),e.push("variedJoinerPattern"))}}t.includes(";")&&(t=t.split(";").join(" "),e.push("semicolon set separation"));let i=/(^|\s)(\d)\/(\d)(\d)\/(\d)(\(|$)/;if(i.test(t)){let[T,D,P,E,R,N]=t.match(i).slice(1);t=t.replace(i,`${T}${D}-${P} ${E}-${R}${N}`),e.push("smashSlashPattern")}/.*\s6[/-]+$/.test(t)&&(t+="0",e.push("incompleteFinalSetPattern"));let r=/\(6,\)/g;r.test(t)&&(t=t.replace(r,"(6, 0)"),e.push("missingZeroPattern1"));let n=/^\d{3,}\(/,a=/\(\d+\)\d+/;[n,a].forEach(()=>{t=t.split(" ").map(T=>(n.test(T)&&(T=T.replace("("," (")),a.test(T)&&(T=T.replace(")",") ")),T)).join(" "),e.push("spaceConsiderationPatterns")});let o=sD(t);o!==t&&(t=o,e.push("deDashMash"));let s=/^(\d)[-/,]+(\d{2})[-/,]+(\d)$/;if(s.test(t)){let[T,D,P]=t.match(s).slice(1),[E,R]=D.split("");t=`${T}-${E} ${R}-${P}`,e.push("smashSetPattern")}let l=/^(\d+)[ -](\d+)$/,u=/^([\d -]+)\/([\d -]+)$/;if(u.test(t)){let[T,D]=t.match(u).slice(1),P=T.trim(),E=D.trim();if(l.test(P)&&l.test(E)){let R=P.match(l).slice(1,3).join("-"),N=E.match(l).slice(1,3).join("-");t=`${R} ${N}`,e.push("slashSeparationPattern")}}let c=/^([\d -]+),([\d -]+)$/;if(c.test(t)){let[T,D]=t.match(c).slice(1),P=T.trim(),E=D.trim();if(l.test(P)&&l.test(E)){let R=P.match(l).slice(1,3).join("-"),N=E.match(l).slice(1,3).join("-");t=`${R} ${N}`,e.push("commaSeparationPattern")}}let d=/^\d \d,/;if(d.test(t)){let T=t.match(d)[0],D=T.slice(0,T.length-1).split(" ").join("-");t=t.replace(T,D),e.push("singleSetCommaSeparationPattern")}let p=0,m=/(\d+)-(\d{2})-(\d+)/;for(;m.test(t)&&p<3;){let[T,D,P]=t.match(m).slice(1),E=D.split(""),R=`${T}-${E[0]} ${E[1]}-${P}`;t=t.replace(m,R),e.push("noSetSeparationPattern"),p+=1}let h=/(^|\s)7-6\s(\d+)\s/g,f=t.match(h);if(f!=null&&f.length){let T=/(^|\s)7-6\s(\d+)\s/;f.forEach(D=>{let P=D.match(T).slice(2)[0];t=t.replace(D,`7-6(${P}) `),e.push("floatingTiebreakPattern1")})}let g=t.match(/\d \d /);g==null||g.forEach(T=>{let D=T.slice(0,T.length-1).split(" ").join("-");t=t.replace(T,D),e.push("spaceSeparatedSetPattern1")}),g=t.match(/ \d \d$/),g==null||g.forEach(T=>{let D=" "+T.slice(1).split(" ").join("-");t=t.replace(T,D),e.push("spaceSeparatedSetPattern2")});let v=/^\d, *\d\/\d, *\d/;if(v.test(t)){let T=t.match(v)[0],D=T.split("/").map(P=>`(${P})`).join(" ")+" ";t=t.replace(T,D),e.push("slashCommaSetPattern")}let y=/\(6-\)/g;y.test(t)&&(t=t.replace(y,"(6-0)"),e.push("missingZeroPattern2"));let I=new RegExp("(?<!-)(\\d+)\\/(\\d+)(?!-)","g");if(I.test(t)){let T=t.match(I),D=new RegExp("(?<!-)(\\d+)\\/(\\d+)(?!-)"),P=t;T.forEach(E=>{let[R,N]=E.match(D).slice(1),A=`${R}-${N}`;P=P.replace(E,A)}),t=P,e.push("slashSetPattern")}let b=/(.*)\s(1\d)\s(\d+)$/;if(b.test(t)){let[T,D,P]=t.match(b).slice(1);T.replace(/\D/g,"").length>=4&&(t=T+` ${D}${P}`,e.push("spaceSeparatedSuperPattern"))}let S=/(^|\s)(\d+-\d+)\s(\d+)(\s|$)/g;for(let T of t.match(S)||[]){let[D,P,E,R]=T.match(/(^|\s)(\d+-\d+)\s(\d+)(\s|$)/).slice(1),[N,A]=P.split("-").map(M=>parseInt(M));Math.abs(N-A)===1&&(t=t.replace(T,`${D}${P}(${E})${R}`),e.push("spaceSeparatedSetPattern"))}let w=/\d-\d \(\d{1,2}\)(\s|$|,)/g;for(let T of t.match(w)||[]){let D=/(\d-\d) \((\d{1,2})\)(\s|$|,)/,[P,E,R]=T.match(D).slice(1),[N,A]=P.split("-").map(M=>parseInt(M));Math.abs(N-A)===1&&(t=t.replace(T,`${P}(${E})${R}`),e.push("floatingTiebreakPattern2"))}let U=/(^|\s)(\d \d)\(/g;for(let T of t.match(U)||[]){let D=/(^|\s)(\d \d)\(/,[P,E]=T.match(D).slice(1);t=t.replace(T,`${P}${E.split(" ").join("-")}(`),e.push("spacedTiebreakPattern")}return{score:t,applied:e}}function ede({score:t,matchUpStatus:e}){var s;let i=t==null?void 0:t.split(" ");t=i.map(l=>{if(l.endsWith("]")){let u=l.split("[");if(Hf(u[0]))return u[0]+`(${u[1].slice(0,u[1].length-1)})`}return l}).join(" ");let r=new RegExp(/(\([\d ]+\))/g);if(r.test(t))for(let l of t.match(r)){let u=(s=l.replace(" ","-").match(/\((.*)\)/))==null?void 0:s[1];if(Li(u)&&(u==null?void 0:u[0])>2){if([2,4].includes(u.length))u=u.split("").join("-");else if(u.length===3){let c=u.indexOf("1");u=FS(u.split(""),c)}}t=t.replace(l,`(${u})`)}i=t==null?void 0:t.split(" ");let n=new RegExp(/^(\d[-/]+\d)\((\d+)[-/]+(\d+)\)$/),a=i.length-1;t=i.map((l,u)=>{let c=[void 0,"","COMPLETED"].includes(e)||u!==a;if(n.test(l)&&c){let[d,p,m]=Array.from(l.match(n)).slice(1),h=Math.min(p,m);return`${d}(${h})`}return l}).join(" "),i=t==null?void 0:t.split(" "),n=new RegExp(/^(\d{2})\((\d+)\)$/),t=i.map(l=>{if(n.test(l)){let[u,c]=Array.from(l.match(n)).slice(1),d=u.split("");return`${d[0]}-${d[1]}(${c})`}return l}).join(" "),i=t==null?void 0:t.split(" "),n=new RegExp(/^\((\d[-/]+\d)\)(\d+)$/),t=i.map(l=>{if(n.test(l)){let[u,c]=Array.from(l.match(n)).slice(1);return Hf(u)?`${u}(${c})`:u}return l}).join(" "),i=t==null?void 0:t.split(" "),n=new RegExp(/^1-0\((\d+)\)$/),t=i.map(l=>{if(n.test(l)){let[u]=l.match(n).slice(1);return`[${u<9?10:parseInt(u)+2}-${u}]`}return l}).join(" ");let o=/\((\d)+0 /;if(o.test(t)){let l=t.match(o)[1];t=t.replace(o,`(${l}) `)}return{score:t}}function tde({score:t,attributes:e,identifier:i}){var c,d,p;if(typeof t!="string")return{score:t,identifier:i};let r=new RegExp(/\([\d,/ ]+\)/g),n=t.match(r);for(let m of n||[]){let h=(d=(c=m.match(/^\((.*)\)$/))==null?void 0:c.slice(1))==null?void 0:d[0],f=t.split(m)[0].split(")").reverse()[0].replace(/\D/g,"");if((h==null?void 0:h.length)===2&&(f==null?void 0:f.length)>=2){let y=f.slice(f.length-2).split("").map(I=>parseInt(I));if(Math.abs(y[0]-y[1])===1)continue}let g=tV(h),v=sD(g);t=t.replace(m,`(${v})`).trim()}let a=new RegExp(/\[[\d,/ ]+\]/g);(p=t.match(a))==null||p.forEach(m=>{let h=tV(m.match(/^\[(.*)\]$/)[1]);t=t.replace(m,`(${h}) `).trim()});let o=[")","]"],s=[")(","), (",") (",")[",") [","](","] ("];if(t.startsWith("(")&&o.some(m=>t.endsWith(m))&&s.some(m=>t.includes(m))){let m="",h=t.split(/[)\]]/).filter(Boolean).map(I=>(I.startsWith(",")&&(I=I.slice(1)),I.trim())),f=h.every(I=>I.includes(",")||LU(I)),g=h.every(I=>I.includes("/")||LU(I)),v=h.every(I=>I.includes("-")||LU(I)),y=f&&","||v&&"-"||g&&"/";if(y){let I;h.forEach(b=>{if(b.startsWith("("))if(I==="set"&&(m+=" "),b.includes(y))m+=b.slice(1).split(y).map(S=>S.trim()).join("-"),I="set";else{let S=b.slice(1);m+=`(${S}) `,I="tiebreak"}else if(b.startsWith("[")){let S=b.slice(1).split(y).map(U=>parseInt(U.trim())),w=Math.min(...S);I==="set"?m+=`(${w}) `:m+=`[${S.join("-")}] `,I="tiebreak"}}),t=m.trim()}}let l=wa(t.split(""));l["("]===1&&l[")"]===1&&t.startsWith("(")&&t.endsWith(")")&&(t=t.slice(1,t.length-1),l["-"]===1&&Hf(t)&&Li(e==null?void 0:e.removed)&&(t=t+`(${e.removed})`,e.removed=void 0));let u=/\(\)/g;return u.test(t)&&(t=t.replace(u,"").trim()),{score:t}}function A6({score:t}){let e=t.split(""),i=[],r,n=()=>r=[void 0,void 0,void 0],a=()=>{let s=`${r[0]}-${r[1]}`;return r[2]&&(s+=` (${r[2]})`),n(),r.push(r),s};n();let o=()=>r[0]!==void 0&&r[1]!==void 0&&Math.abs(parseInt(r[0])-parseInt(r[1]));for(;e.length;){let s=e.shift(),l=Li(s)&&parseInt(s),u=r[0]!==void 0&&r[1]!==void 0;if(Li(l)){if(r[0]===void 0){r[0]=l;continue}if(r[1]===void 0&&(r[1]=l,o())){i.push(a()),r=[void 0,void 0];continue}if(u&&e.length===1&&Li(e[0])){let c=e.pop();r[0]=r[0].toString()+r[1].toString(),r[1]=c,i.push(a()),r=[void 0,void 0]}u&&o()}}return{sets:i}}function r1(t){let e=t.indexOf("1"),i=t.split(""),r=i.every(n=>!isNaN(n));if(r&&t.length===3&&e===0){let n=FS(i,e);if(n)return n}if(r&&t.length===7&&e>3){let n=i.slice(4),a=FS(n,e-4);if(a)return`${i[0]}-${i[1]} ${i[2]}-${i[3]} ${a}`}}function O6(t){let{score:e}=t,{applied:i,matchUpStatus:r}=t,n=e==null?void 0:e.toString().split(""),a=n==null?void 0:n.every(s=>Li(s)),o=s=>Math.abs(s[0]-s[1]);if(typeof e=="number"||a){e=e.toString().toLowerCase(),a&&(e=n.join(""));let s=a?n.map(l=>parseInt(l)):e.split("").map(l=>parseInt(l));if(A6({score:e}),s.length,e.length===3&&o(s.slice(0,2))===1){let[l,u,c]=s;e=`${l}-${u}(${c})`,i.push("numericTiebreakPattern1")}else if(e.length===3&&s[0]===1){let[l,u,c]=s;e=`[${l}${u}-${c}]`,i.push("numericTiebreakPattern2")}else if(e.length===4&&o(s.slice(0,2))===1&&"987654".split("").includes(s[0].toString())){let[l,u,c,d]=s,p=Math.min(c,d);e=`${l}-${u}(${p})`,i.push("numericTiebreakPattern3")}else if(e.length===4&&s[0]===1&&s[2]===1){let[l,u,c,d]=s;e=`[${l}${u}-${c}${d}]`,i.push("bigSuper")}else if(e.length===4){let[l,u,c,d]=s;e=`${l}${u} ${c}${d}`,i.push("split4")}else if(e.length===5&&o(s.slice(0,2))===1){let[l,u,c,d,p]=s;e=`${l}-${u}(${c}) ${d}-${p}`,i.push("numericTiebreakPattern4")}else if(e.length===5&&o(s.slice(3))===1){let[l,u,c,d,p]=s;e=`${l}-${u} ${c}-${d}(${p})`,i.push("numericTiebreakPattern5")}else if(s.length===7)if(o(s.slice(0,2))>1&&o(s.slice(2,4))>1&&s[4]===1){let[l,u,c,d,p,m,h]=s;e=`${l}-${u} ${c}-${d} [${p}${m}-${h}]`,i.push("numericTiebreakPattern6")}else if(o(s.slice(0,2))===1&&o(s.slice(3,5))>1&&o(s.slice(5,7))>1){let[l,u,c,d,p,m,h]=s;e=`${l}-${u}(${c}) ${d}-${p} ${m}-${h}`,i.push("numericTiebreakPattern7")}else if(o(s.slice(0,2))>1&&o(s.slice(2,4))===1&&o(s.slice(5,7))>1){let[l,u,c,d,p,m,h]=s;e=`${l}-${u} ${c}-${d}(${p}) ${m}-${h}`,i.push("numericTiebreakPattern8")}else if(o(s.slice(0,2))>1&&o(s.slice(2,4))>1&&o(s.slice(4,6))===1){let[l,u,c,d,p,m,h]=s;e=`${l}-${u} ${c}-${d} ${p}-${m}(${h})`,i.push("numericTiebreakPattern9")}else e=e.slice(0,2)+" "+e.slice(2,4)+" "+e.slice(4),i.push("numericMatchTiebreakPattern");else if(e.length%2){let l=r1(e);l&&e!==l&&i.push("parsedSuperPattern"),e=l??e}else{let l=Rr(e.split(""),2).map(g=>g.join("")),u=l.map(g=>{let[v,y]=g.split("").map(S=>parseInt(S)),I=Math.abs(v-y),b=v>y?1:2;return I>1&&b||b*-1}),c=u.reduce((g,v)=>g>0&&v>0,1),d=wa(u),p=u.map(g=>Math.abs(g)),m=wa(p),h=u[0]<0,f=!h&&u[1]<0;if(u[0]>0&&u[1]>0&&u[0]!==u[1])e=[l.slice(0,2).join(" "),l.slice(2).join("-")].join(" "),i.push("numeric3rdSetTiebreakPattern");else if(c)e=l.join(" "),i.push("chunkSplit");else if(s.length===6){if(d[1]===2||d[2]===2)if(!Object.values(m).includes(3))e=l.join(" "),i.push("chunkSplit");else{let[g,v,y,I,b,S]=s,w=u.reduce((U,T,D)=>T<0?D:U,void 0);if(w===0){let U=Math.min(y,I);e=`${g}-${v}(${U}) ${b}-${S}`,i.push("chunkSplitTiebreak1")}else if(w===1){let U=Math.min(b,S);e=`${g}-${v} ${y}-${I}(${U})`,i.push("chunkSplitTiebreak2")}else e=`${g}-${v} ${y}-${I}`,i.push("chunkSplitTrimExtraneous")}}else if(s.length===8){let[g,v,y,I,b,S,w,U]=s;h||f?s[5]===1&&(h?e=`${g}-${v}(${y}) ${I}-${b} [${S}${w}-${U}]`:e=`${g}-${v} ${y}-${I}(${b}) [${S}${w}-${U}]`):(u[0],u[1])}}}return{score:e,applied:i,matchUpStatus:r}}function k6(t){let e=[0,0],i=[],r=t.split(" "),n=/(\d+)-(\d+)/;r.forEach(l=>{if(n.test(l)){let u=l.match(n).slice(1).map(d=>parseInt(d)),c=u[0]>u[1]&&1||u[1]>u[0]&&2;c&&(e[c-1]+=1,i.push(c))}});let a=e[0]>e[1]&&1||e[1]>e[0]&&2,o=e[0]>0&&e[0]===e[1],s=e.reduce((l,u)=>l+u,0);return{setsWon:e,setsTied:o,setWinners:i,totalSets:s,winningSide:a}}function ide({score:t,matchUpStatus:e,attributes:i}){let r=[],n,a=t.split(" "),o=a.length;t=a.map((c,d)=>{if(new RegExp(_I).test(c)){let m=c.slice(3),h=c.slice(0,3),f=h.split("-");if(!Hf(h)&&!e){let g=Math.max(...f),v=h.indexOf(g),y=[g,g-1];return v&&y.reverse(),y.join("-")+m}}else if(c.length===2&&Li(c))return c.split("").join("-");c=sD(c);let p=new RegExp(`^${WO}$`).test(c)&&"super"||new RegExp(`^${_I}$`).test(c)&&"tiebreak"||new RegExp(`^${oD}$`).test(c)&&"standard"||"unknown";if(r.push(p),o>1&&p==="standard"&&d<2){let[m,h]=c.split("-"),f=Math.abs(parseInt(m)-parseInt(h)),g=Math.max(m,h),v=Math.min(m,h),y=[parseInt(m),parseInt(h)].indexOf(v);if(g>9&&f>2){let I=g.toString().split(""),b=I.find(S=>parseInt(S)>v||d&&parseInt(S)<=n)??I[0];b&&(c=y?[b,v].join("-"):[v,b].join("-"))}g>(n||0)&&(n=g)}if(p==="standard"){let[m,h]=c.split("-");if(!Math.abs(parseInt(m)-parseInt(h))&&e!=="RETIRED")return""}return c}).filter(Boolean).join(" ");let{setsWon:s,setWinners:l,totalSets:u}=k6(t);if(u===1&&(i==null?void 0:i.removed)==="6"&&(t+=" 6-0"),t.split(" ").length>2&&Math.max(...s)>=2&&l[0]===l[1]&&(t=t.split(" ").slice(0,2).join(" ")),Math.max(...s)>2){let c=[0,0];t=t.split(" ").map((d,p)=>(c[l[p]]+=1,Math.max(...c)>2?void 0:d)).filter(Boolean).join(" ")}return{score:t,profile:r}}function rde({score:t}){let{setsTied:e,winningSide:i}=k6(t),r=/\s\((\d+)\)$/;if(!i&&e&&r.test(t)){let s=t.match(r).slice(1)[0],l=s<=8?10:s+2;t=t.replace(r,` [${l}-${s}]`)}let n=t.split(" "),a=n[n.length-1];if(!a.includes("-")||a.indexOf("(")>0)return{score:t};let o=a.split("(").join("").split(")").join("").split("-");if(!o.every(s=>Li(s)))return{score:t};if(o[0]==="76"){let s=o[1].length===2?Math.min(...o[1].split("").map(l=>parseInt(l))):o[1];t=[...n.slice(0,n.length-1),`7-6(${s})`].join(" ")}else{o=o.map(u=>parseInt(u));let s=Math.max(...o),l=Math.abs(o[0]-o[1]);if(s>=10){if(l>2&&o.every(u=>+u>=10)){let u=o.map(c=>c===s?c-10:10).sort();l=Math.abs(u[0]-u[1]),l>2&&(o=u)}t=[...n.slice(0,n.length-1),`[${o.join("-")}]`].join(" ")}else n.length===3&&s>=7&&l>2&&(t=[...n.slice(0,n.length-1),`[${o.join("-")}]`].join(" "))}return{score:t}}function nde({score:t}){return t=(t==null?void 0:t.toString().toLowerCase())||"",{score:t}}function ade({score:t,applied:e}){return typeof t!="string"?{score:t}:(t.toLowerCase().includes("o")&&(t=t.toLowerCase().split(" ").map(i=>i.split("o").join("0")).join(" "),e.push("replaceOh")),{score:t,applied:e})}function ode({score:t,applied:e}){return typeof t!="string"?{score:t}:(t=t.toLowerCase().split(" ").map(i=>{if(/^\d+$/.test(i)&&i.length>2){let r=i.indexOf("1");if(i.length%2){if(i.length===3&&r===0){let n=FS(i.split(""),r);return e.push("getSuper"),n}}else{let{score:n,applied:a}=O6({score:i,applied:[]});n!==i&&(i=n,e.push(...a))}}return i}).join(" "),{score:t,applied:e})}function sde({score:t,applied:e}){return typeof t!="string"?{score:t}:[3,4].includes(t.length)&&r1(t)?{score:r1(t)}:(t=t.toLowerCase().split(" ").map(i=>{if(/^\d+$/.test(i)&&i.length===1){e.push("removeErroneous1");return}return i}).filter(Boolean).join(" "),{score:t,applied:e})}function lde({score:t,applied:e}){return["walkover","wo","w/o","w-o"].includes(t==null?void 0:t.toString().toLowerCase())?(e.push("handleWalkover"),{matchUpStatus:"walkover",score:"",applied:e}):{score:t}}function ude({score:t,profile:e,applied:i}){var o;t=t==null?void 0:t.toString().toLowerCase();let r=/^(.*\d+.*)(ret|con)+[A-Za-z ]*$/;if(r.test(t)){let[s]=t.match(r).slice(1);return i.push("handleRetired"),{score:s.trim(),matchUpStatus:"retired",applied:i}}let n=(o=e==null?void 0:e.matchUpStatuses)==null?void 0:o.retired,a=["rtd",...Array.isArray(n)?n:[n].filter(Boolean)].find(s=>t==null?void 0:t.endsWith(s));return a?(i.push("handleRetired"),{matchUpStatus:"retired",score:t==null?void 0:t.replace(a,"").trim(),applied:i}):{score:t}}function cde({score:t,attributes:e}){(t.endsWith(" am")||t.endsWith(" pm"))&&(t=""),t=t.replace(/[A-Za-z]+/g,"").trim(),[".",","].some(n=>t.endsWith(n))&&(t=t.slice(0,t.length-1));let i="()/-".split("").some(n=>t.includes(n));/ \d$/.test(t)&&i&&(e={removed:t.slice(t.length-2).trim()},t=t.slice(0,t.length-2));let r=/(.*)[A-Za-z]+$/;return r.test(t)&&(t=t.match(r).slice(1)[0].trim()),{score:t,attributes:e}}function dde({score:t}){return new RegExp(/-\d+\/\d+-/).test(t)&&(t=t.split("/").join(" ")),{score:t}}function pde({score:t}){let e=new RegExp(/^\d+\/\d+/),i=t.split(" ");i.some(n=>e.test(n))&&(t=i.map(n=>e.test(n)?n.replace("/","-"):n).join(" "));let r=/^(\d+), *(\d+)$/;if(r.test(t)){let[n,a]=t.match(r).slice(1);t=[n,a].join("-")}return{score:t}}function mde({score:t}){let e=new RegExp(/\(\d+\/\d+\)/g),i=t.match(e);for(let r of i||[]){let n=r.replace("/","-");t=t.replace(r,n)}return{score:t}}function hde({score:t}){if(t.includes(",")){let e=t.split(",").map(r=>r.trim()),i=r=>/\d \d/.test(r);e.every(i)&&(t=e.map(r=>{let n=/\d+ \d+/g;for(let a of r.match(n)){let[o,s]=a.match(/(\d+) (\d+)/).slice(1);r=r.replace(a,`${o}-${s}`)}return r}).join(" "))}if(t.includes(" ")){let e=t.replace(/[ ,]/g,"");e.split("").every(i=>Li(i))&&e.length===4&&(t=e)}return{score:t}}function fde({score:t}){let e=new RegExp(/^\[\d+\](.*)$/);e.test(t)&&(t=t.match(e).slice(1)[0].trim());let i=/\(,/g;return i.test(t)&&(t=t.replace(i,"(")),{score:t}}var gde={handleTiebreakSlashSeparation:mde,handleSetSlashSeparation:dde,punctuationAdjustments:Xce,handleGameSeparation:pde,joinFloatingTiebreak:Qce,handleBracketSpacing:Jce,handleSpaceSeparator:hde,separateScoreBlocks:ode,matchKnownPatterns:Zce,removeDanglingBits:cde,removeErroneous:sde,handleWalkover:lde,properTiebreak:ede,handleNumeric:O6,handleRetired:ude,containedSets:tde,sensibleSets:ide,stringScore:nde,superSquare:rde,setBuilder:A6,excisions:fde,replaceOh:ade},yE={},vde=["handleNumeric","handleWalkover","handleRetired","replaceOh","stringScore","punctuationAdjustments","excisions","handleSpaceSeparator","matchKnownPatterns","removeDanglingBits","handleBracketSpacing","matchKnownPatterns","containedSets","separateScoreBlocks","handleGameSeparation","removeErroneous","joinFloatingTiebreak","handleSetSlashSeparation","handleTiebreakSlashSeparation","properTiebreak","sensibleSets","superSquare"],Ide=["handleNumeric","separateScoreBlocks","sensibleSets","superSquare"];function x6(t){if(!t.score)return{error:oe};let{score:e,sheetName:i,identifier:r,fileName:n,stepLog:a,fullLog:o,profile:s}=t,l=[],u,c=[],d,p,m=e,h=g=>{g.forEach(v=>{p=gde[v]({profile:s,identifier:r,matchUpStatus:u,attributes:d,applied:c,score:m});let y=p.score!==m;y&&l.push({method:v,score:p.score}),a&&(o||y||p.matchUpStatus!==u)&&console.log(u?{score:p.score,matchUpStatus:u}:{score:p.score},v),p.matchUpStatus&&(u=p.matchUpStatus),p.attributes&&(d=p.attributes),p.applied&&(c=p.applied),m=p.score})};h(vde);let f=eV(m);return f||(m=e.toString().replace(/\D/g,""),d!=null&&d.removed&&(d.removed=void 0),h(Ide),f=eV(m),f||(m="")),c.forEach(g=>{yE[g]||(yE[g]=0),yE[g]+=1}),{matchUpStatus:u==null?void 0:u.toUpperCase(),modifications:l,attributes:d,isValid:f,score:m}}var F6={};yt(F6,{analyzeScore:()=>qO,analyzeSet:()=>$I,checkScoreHasValue:()=>Ir,checkSetIsComplete:()=>nD,getSetComplement:()=>KO,getTiebreakComplement:()=>lD,isValidMatchUpFormat:()=>Ua,parseScoreString:()=>LS,validateScore:()=>YO,validateTieFormat:()=>Hn});function qO({existingMatchUpStatus:t,matchUpFormat:e,matchUpStatus:i,winningSide:r,score:n}){var S,w;let a=(n==null?void 0:n.sets)??[],o=((a==null?void 0:a.filter(U=>U==null?void 0:U.winningSide))||[]).reduce((U,T)=>{let{winningSide:D}=T;if(!D)return U;let P=D-1;return U[P]++,U},[0,0]),s=r?r-1:void 0,l=s!==void 0?1-s:void 0,u=s!==void 0&&o[s],c=l!==void 0&&o[l],d=e?kn(e):void 0,p=Math.max(...o),m=wa(o)[p],h=((S=d==null?void 0:d.setFormat)==null?void 0:S.timed)||((w=d==null?void 0:d.finalSetFormat)==null?void 0:w.timed),f=d==null?void 0:d.bestOf,g=f&&Math.ceil(f/2)||1,v=i??t,y=v&&[Mt,mn,zt].includes(v),I=!d||!a.length||a.every((U,T)=>{let D=T+1,P=D===f,E=D===a.length,{side1Score:R,side2Score:N,side1TiebreakScore:A,side2TiebreakScore:M,winningSide:C}=U,O=Math.max(R??0,N??0),k=A??M,{finalSetFormat:x,setFormat:F}=d,$=P&&x||F;if(k){let{tiebreakTo:_,NoAD:L}=($==null?void 0:$.tiebreakFormat)||{},B=Math.max(A??0,M??0);if(L&&B>_||B<_&&C&&(E&&!y||!E))return!1}return $.setTo?!(!$.noTiebreak&&O>$.setTo+1):!0}),b=(!e||p===g)&&m===1&&o.indexOf(p)+1||void 0;return{valid:!!(I&&(r&&u>c&&r===b||r&&y||!r&&!b&&(![qi,Mt,mn,zt].includes(v)||h&&v===qi)))}}function YO({existingMatchUpStatus:t,matchUpFormat:e,matchUpStatus:i,winningSide:r,score:n}){if(typeof n!="object")return{error:oe};let{sets:a,scoreStringSide1:o,scoreStringSide2:s}=n,l="scoreString must be a string!";if(o!==void 0&&typeof o!="string")return{error:oe,info:l};if(s!==void 0&&typeof s!="string")return{error:oe,info:l};if(a!==void 0&&!Array.isArray(a))return{error:oe,info:Bd("sets")};if(a!=null&&a.length){let u=a.map(d=>d==null?void 0:d.setNumber).filter(Boolean);if(u.length!==ct(u).length)return{error:oe,info:"setNumbers not unique"};for(let d of a){let{side1Score:p,side2Score:m,side1TiebreakScore:h,side2TiebreakScore:f,side1PointScore:g,side2PointScore:v,winningSide:y,setNumber:I}=d;if(![[p,m],[h,f],[g,v]].filter(b=>b.some(S=>![void 0,null].includes(S))).every(b=>b.every(S=>ot(S))))return{error:oe,info:"non-numeric values"};if(![I,y].filter(b=>![void 0,null].includes(b)).every(b=>ot(b)))return{error:oe,info:"non-numeric values"};if(y&&![1,2].includes(y))return{error:oe,info:"winningSide must be 1 or 2"}}let{valid:c}=qO({existingMatchUpStatus:t,matchUpStatus:i,matchUpFormat:e,winningSide:r,score:n});if(!c)return{error:QG,info:"score is invalid for matchUpFormat or winningSide does not match calculated winningSide"}}return{valid:!0}}var KO=t=>{let{isSide1:e,lowValue:i,setTo:r,tiebreakAt:n,NoAD:a}=t;if(i===void 0)return!1;let o=Qe(i);(o==null?void 0:o.toString().length)>2&&(o=parseInt(o.toString().slice(0,2))),n&&n<r&&o>n&&(o=n);let s;return a&&!n?(o>r&&(s=r),s=o<r?r:r-1):s=o+1<r&&r||n&&n<r&&o===n&&r||!n&&o+2||r+1,[e?o:s,e?s:o]},lD=t=>{let{isSide1:e,lowValue:i,tiebreakTo:r,tiebreakNoAd:n}=t;if(i===void 0)return!1;let a=typeof i=="string"?parseInt(i):i;(a==null?void 0:a.toString().length)>2&&(a=parseInt(a.toString().slice(0,2))),n&&a>r-1&&(a=r-1);let o=yde({lowValue:a,NoAD:n,tiebreakTo:r});return[e?a:o,e?o:a]};function yde(t){let{lowValue:e,NoAD:i,tiebreakTo:r}=t,n=i?1:2;return e+1>=r?e+n:r}function LS({tiebreakTo:t=7,scoreString:e=""}){return e==null?void 0:e.split(" ").filter(Boolean).map((r,n)=>i({set:r,setNumber:n+1}));function i({set:r,setNumber:n}){let a=/\(([^)]+)\)/,o=/\[([^)]+)\]/,s=a.exec(r),l=o.exec(r),u=(r==null?void 0:r.startsWith("["))&&l&&l[1].split("-").map(I=>parseInt(I)),c=s&&r.replace(s[0],"")||l&&r.replace(l[0],"")||r,d=!u&&c.split("-").map(I=>parseInt(I)),p=u?u[0]>u[1]&&1||u[0]<u[1]&&2||void 0:d[0]>d[1]&&1||d[0]<d[1]&&2||void 0,m=s?s[1]:void 0,h=(m&&lD({lowValue:m,isSide1:p===2,tiebreakTo:t}))??[],[f,g]=d||[],[v,y]=u||h||[];return{side1Score:f,side2Score:g,side1TiebreakScore:v,side2TiebreakScore:y,winningSide:p,setNumber:n}}}function bde({matchUpScoringFormat:t,isDecidingSet:e,isTiebreakSet:i,isTimedSet:r,setObject:n}){if(!n)return;let a=aD({set:n});return nD({matchUpScoringFormat:t,set:n,isDecidingSet:e,isTiebreakSet:i,isTimedSet:r})&&a||void 0}function $I(t){let{setObject:e,matchUpScoringFormat:i}=t;if(!e)return{error:H0};let{setNumber:r}=e||{},{bestOf:n,exactly:a}=i||{},o=n||a,s=!!(r&&o&&r===o),l=s&&(i==null?void 0:i.finalSetFormat)||(i==null?void 0:i.setFormat),u=!!(l!=null&&l.tiebreakSet),c=!!(l!=null&&l.timed),d=!u&&!c,p=!!(r&&o&&r<=o),m=[e==null?void 0:e.side1Score,e==null?void 0:e.side2Score],h=[e==null?void 0:e.side1PointScore,e==null?void 0:e.side2PointScore],f=[e==null?void 0:e.side1TiebreakScore,e==null?void 0:e.side2TiebreakScore],g=m.filter(k=>k!==void 0).length,v=h.filter(k=>k!==void 0).length,y=f.filter(k=>k!==void 0).length,I=m==null?void 0:m.filter(k=>!isNaN(k)).length,b=f==null?void 0:f.filter(k=>!isNaN(k)).length,{tiebreakAt:S}=l||{},w=S&&m.filter(k=>k>=S).length===2,U=w&&(m[0]>m[1]&&1||m[1]>m[0]&&2||void 0),T=!!(b&&!I),D=!!(e!=null&&e.winningSide),{error:P,result:E}=wde({sideTiebreakScores:f,sideGameScores:m,setFormat:l,setObject:e}),{error:R,result:N}=Ude({sideTiebreakScores:f,setObject:e,setFormat:l}),A=d&&!T&&E||u&&T&&N||c,M=p&&!(u&&!T)&&!(d&&T)&&(!D||A),C=bde({isTimedSet:c,matchUpScoringFormat:i,isDecidingSet:s,isTiebreakSet:T,setObject:e}),O={expectTiebreakSet:u,expectTimedSet:c,hasTiebreakCondition:w,isCompletedSet:D,isDecidingSet:s,isTiebreakSet:T,isValidSet:M,isValidSetNumber:p,isValidSetOutcome:A,leadingSide:U,setFormat:l,sideGameScores:m,sideGameScoresCount:g,sidePointScores:h,sidePointScoresCount:v,sideTiebreakScores:f,sideTiebreakScoresCount:y,winningSide:C};return(e==null?void 0:e.winningSide)!==void 0&&(T?(O.isValidTiebreakSetOutcome=N,N||(O.tiebreakSetError=R)):(O.isValidStandardSetOutcome=E,E||(O.standardSetError=P))),O}function wde({setObject:t,setFormat:e,sideGameScores:i,sideTiebreakScores:r}){if(!t)return{result:!1,error:H0};let n=!!(e!=null&&e.tiebreakSet),a=!!(e!=null&&e.timed);if(!e||n||a)return{result:!1,error:oe};if((i==null?void 0:i.filter(U=>!isNaN(U)).length)!==2)return{result:!1,error:bC};let{setTo:o,tiebreakAt:s,tiebreakFormat:l,NoAD:u}=e||{};if(!(o&&(i!=null&&i.find(U=>U>=o))))return{result:!1,error:bC};let c=[1,2].includes(t==null?void 0:t.winningSide);if(!t||!c)return{result:!1,error:z0};let d=(t==null?void 0:t.winningSide)-1,p=1-d,m=i[d],h=i[p],f=m-h;if(!(m>h))return{result:!1,error:{message:"winningSide game scoreString is not high"}};let g=s&&l,v=(r==null?void 0:r.filter(U=>!isNaN(U)).length)===2,y=r==null?void 0:r[d],I=r==null?void 0:r[p],b=s&&i.filter(U=>U>=s).length===2;if(g){let{NoAD:U,tiebreakTo:T}=l;if(b){if(f>1)return{result:!1,error:{message:"invalid winning game scoreString (5)"}};if(!v)return{result:!1,error:{message:"invalid tiebreak scores (1)"}};if(isNaN(T))return{result:!1,error:{message:"tiebreakTo error"}};if(!(T&&(r!=null&&r.find(N=>N>=T))))return{result:!1,error:{message:"invalid tiebreak scores (2)"}};let D=s<o?o:o+1;if(m>D)return{result:!1,error:{message:"invalid winning game scoreString (1)"}};if(!y||!I||y<I)return{result:!1,error:{message:"winningSide tiebreak value is not high"}};let P=U?1:2,E=y-I,R=I>=T-1;if(E&&R&&E<P)return{result:!1,error:{message:"invalid tiebreak scores (3)"}}}if(m>o&&!b)return{result:!1,error:{message:"invalid winning game scoreString (2)"}}}let S=u?1:2,w=h>=o-1;return f&&w&&!b&&f<S?{result:!1,error:{message:"invalid winning game scoreString (3)"}}:f>S&&m>o?{result:!1,error:{message:"invalid winning game scoreString (4)"}}:{result:!0}}function Ude({setObject:t,setFormat:e,sideTiebreakScores:i}){if(!t)return{result:!1,error:H0};let r=!!(e!=null&&e.tiebreakSet),n=!!(e!=null&&e.timed);if(!e||!r||n)return{result:!1,error:{message:"not tiebreak set"}};let a=[1,2].includes(t==null?void 0:t.winningSide);if(!t||!a)return{result:!1,error:z0};let{tiebreakSet:o}=e||{},{NoAD:s,tiebreakTo:l}=o||{};if((i==null?void 0:i.filter(g=>!isNaN(g)).length)!==2)return{result:!1,error:{message:"invalid tiebreak scores (1)"}};if(isNaN(l))return{result:!1,error:{message:"tiebreakTo error"}};if(!(i!=null&&i.find(g=>g>=l)))return{result:!1,error:{message:"invalid tiebreak scores (2)"}};let u=(t==null?void 0:t.winningSide)-1,c=1-u,d=i[u],p=i[c];if(!d||!p||d<p)return{result:!1,error:{message:"winningSide tiebreak value is not high"}};let m=s?1:2,h=d-p,f=p>=l-1;return h&&f&&h<m?{result:!1,error:{message:"invalid tiebreak scores (3)"}}:{result:!0}}function Sde(t){var d,p,m;let{existingDrawDefinition:e,hydrateCollections:i,enforceGender:r,tieFormatName:n,matchUpType:a,eventType:o,isMock:s,event:l}=t,{tieFormat:u,matchUpFormat:c}=t;if(a===sr&&o===sr){let h=(p=(d=e==null?void 0:e.structures)==null?void 0:d.find(({stage:f})=>f===Oe))==null?void 0:p.tieFormat;u=u||h||n&&((m=l==null?void 0:l.tieFormat)==null?void 0:m.tieFormatName)===n&&l.tieFormat||n&&bu({namedFormat:n,hydrateCollections:i,isMock:s,event:l})||(l==null?void 0:l.tieFormat)||bu({event:l,isMock:s,hydrateCollections:i}),c=void 0}else c||(u=void 0,l!=null&&l.matchUpFormat||(c=hu));if(u){let h=Hn({gender:l==null?void 0:l.gender,enforceGender:r,tieFormat:u});if(h.error)return h}return{tieFormat:u,matchUpFormat:c}}function Tde(t){var I,b,S,w,U;let e=t.drawDefinition,{existingQualifyingPlaceholderStructureId:i,appliedPolicies:r,drawEntries:n,structureId:a,idPrefix:o,isMock:s,event:l}=t,u=t.qualifyingProfiles,c=u!=null&&u.length?F3({uuids:t.uuids,qualifyingProfiles:u,appliedPolicies:r,idPrefix:o,isMock:s}):void 0;if(c!=null&&c.error)return c;e.structures=(I=e.structures)==null?void 0:I.filter(({structureId:T})=>T!==i),e.links=(b=e.links)==null?void 0:b.filter(({source:T})=>T.structureId!==i);let{qualifiersCount:d,qualifyingDrawPositionsCount:p,qualifyingDetails:m}=c??{};p&&(c!=null&&c.structures&&((S=e.structures)==null||S.push(...c.structures)),c!=null&&c.links&&((w=e.links)==null||w.push(...c.links)));let h=(U=e.structures)==null?void 0:U.find(({stage:T,stageSequence:D})=>T===Oe&&D===1),{qualifiersCount:f}=Bg({stageSequence:1,drawDefinition:e,structureId:a,stage:Oe}),g=Math.max(d??0,f??0),v=$q({qualifiersCount:g,drawDefinition:e,stage:Oe});if(v.error||(v=MS({drawSize:p,stage:Ye,drawDefinition:e}),v.error))return v;Dde({drawDefinition:e,drawEntries:n,event:l});let y=Pde({mainStructure:h,qualifyingDetails:m,drawDefinition:e});return y.error?y:{drawDefinition:e,structureId:a}}function Dde({drawDefinition:t,drawEntries:e,event:i}){for(let r of(e??[]).filter(({entryStage:n})=>n===Ye)){let n={...r,entryStage:r.entryStage??Oe,drawDefinition:t,event:i};qA(n)}}function Pde({mainStructure:t,qualifyingDetails:e,drawDefinition:i}){var r;for(let n of e||[]){let{finalQualifyingRoundNumber:a,finalQualifyingStructureId:o,roundTarget:s,finishingPositions:l,linkType:u}=n,c=t&&((r=fb({targetStructureId:t.structureId,sourceStructureId:o,sourceRoundNumber:a,finishingPositions:l,targetEntryRound:s,linkType:u}))==null?void 0:r.link);if(c!=null&&c.error)return c;c&&(i.links||(i.links=[]),i.links.push(c))}return{error:void 0}}function L6(t){var r,n;let{participantIds:e}=t,i=((n=(r=t.drawDefinition)==null?void 0:r.entries)==null?void 0:n.filter(a=>{let o=a.entryStatus;return!t.restrictEntryStatus||ls.includes(o)}).map(Ut))??[];if(e){let a=e.filter(o=>!(i!=null&&i.includes(o)));if(a!=null&&a.length)return ee({result:{error:Ts},info:{invalidParticipantIds:a}})}else e=i;return t.roundsCount&&t.restrictRoundsCount!==!1&&t.roundsCount>e.length-1&&(!t.enableDoubleRobin||t.roundsCount>(e.length-1)*2)?{error:oe,info:"Not enough participants for roundsCount"}:t.roundsCount&&t.restrictRoundsCount!==!1&&t.roundsCount>31?{error:oe,info:"roundsCount must be less than 32"}:{participantIds:e}}function XO(t){var d;let e=[],{roundsCount:i=1,drawDefinition:r,matchUpsCount:n,structureId:a,idPrefix:o,isMock:s,event:l}=t,u,c=L6(t);if(c.error)return c;for(let p of Se(1,i+1)){let m=tD({restrictMatchUpsCount:t.restrictMatchUpsCount,ignoreLastRoundNumber:!!u,newRound:!u,drawDefinition:r,matchUpsCount:n,structureId:a,roundNumber:u,idPrefix:o,isMock:s,event:l});if(m.error)return ee({result:m,info:{iteration:p}});(d=m.matchUps)!=null&&d.length&&e.push(...m.matchUps),u=((m==null?void 0:m.roundNumber)??1)+1}return{matchUps:e}}function Rde(t){var l;let{tournamentRecord:e,participantIds:i,scaleName:r,eventType:n,adHocRatings:a={}}=t,o=t.scaleAccessor??((l=Nr[r])==null?void 0:l.accessor),s=e.participants??[];for(let u of i??[]){let c=s==null?void 0:s.find(p=>p.participantId===u),d=iV({scaleName:`${r}.${sA}`,participant:c,eventType:n});!d&&r&&(d=iV({scaleAccessor:o,participant:c,scaleName:r,eventType:n})),d&&!a[u]&&(a[u]=d)}return a}function iV({scaleType:t=gc,scaleAccessor:e,participant:i,scaleName:r,eventType:n}){var o,s;let a=(s=(o=i&&Cl({scaleAttributes:{eventType:n??Im,scaleType:t,scaleName:r},participant:i}))==null?void 0:o.scaleItem)==null?void 0:s.scaleValue;return e&&Nt(a)?a[e]:a}function JO(t){var c,d;let e=Cde(t);if(e!=null&&e.error)return e;let i=L6(t);if(i.error)return i;let r=Ede(t);if(r.error)return r;let n=Rde(t),a=((c=t.tournamentRecord)==null?void 0:c.isMock)??t.isMock,o=t.eventType??((d=t.event)==null?void 0:d.eventType),s=[],l=[],u;for(let p of Se(1,(t.roundsCount??1)+1)){let m=BO({...t,participantIds:i.participantIds,structure:r.structure,ignoreLastRoundNumber:!0,iterationMatchUps:s,adHocRatings:n,roundNumber:u,eventType:o,isMock:a});if(m.error)return m;let{matchUps:h,...f}=m;f.modifiedScaleValues&&(n=f.modifiedScaleValues),l.push({...f,iteration:p,matchUpsCount:h==null?void 0:h.length}),u=((f==null?void 0:f.roundNumber)??1)+1,h!=null&&h.length&&s.push(...h)}return{...J,matchUps:s,roundResults:l}}function Ede(t){var n,a,o;if(t.structureId)return t.structureId;let e=t.drawDefinition,i=(a=(n=e==null?void 0:e.structures)==null?void 0:n.filter(s=>s.stageSequence===1))==null?void 0:a.reduce((s,l)=>{let u=l.stage&&ym[l.stage];return zn({structure:l})&&u>(ym[s==null?void 0:s.stage]||1)?l:s},void 0),r=(o=e==null?void 0:e.structures)==null?void 0:o.find(s=>s.structureId===(i==null?void 0:i.structureId));return r?zn({structure:r})?{structure:r}:{error:Yp}:{error:Mi}}function Cde(t){var e;return t.roundsCount&&typeof t.roundsCount!="number"?{error:oe,info:"roundsCount must be a number"}:typeof t.drawDefinition!="object"||t.drawDefinition.drawType&&t.drawDefinition.drawType!==La?{error:Yp}:!Array.isArray((e=t.drawDefinition)==null?void 0:e.entries)&&t.participantIds&&!Array.isArray(t.participantIds)?{error:oe,info:"Missing Entries"}:{error:void 0}}function Mde(t){var c,d;let{tournamentRecord:e,drawDefinition:i,structureId:r,idPrefix:n,isMock:a,event:o}=t,s=(c=o==null?void 0:o.entries)==null?void 0:c.filter(({entryStage:p,entryStatus:m})=>(!p||p===Oe)&&m&&ls.includes(m)),l=s==null?void 0:s.map(Ut),u=s?Math.floor(s.length/2):0;if(t.automated)return Nde({...t,participantIds:l});{let p=XO({roundsCount:t.roundsCount,drawDefinition:i,matchUpsCount:u,idPrefix:n,isMock:a,event:o});if(p.error)return p;(d=p.matchUps)!=null&&d.length&&JT({matchUps:p.matchUps,suppressNotifications:!0,tournamentRecord:e,drawDefinition:i,structureId:r,event:o})}return{...J}}function Nde(t){var l,u;let{restrictEntryStatus:e,generateMatchUps:i,structureId:r,matchUpIds:n,scaleName:a,scaleAccessor:o}=t.drawMatic??{},s=JO({...t,eventType:((l=t.drawMatic)==null?void 0:l.eventType)??t.matchUpType,generateMatchUps:i??!0,scaleAccessor:o??t.scaleAccessor,scaleName:a??t.scaleName,participantIds:t.participantIds,roundsCount:t.roundsCount,restrictEntryStatus:e,structureId:r,matchUpIds:n});return s.error?s:((u=s==null?void 0:s.matchUps)!=null&&u.length&&JT({tournamentRecord:t.tournamentRecord,drawDefinition:t.drawDefinition,suppressNotifications:!0,matchUps:s.matchUps,event:t.event,structureId:r}),{...J})}function Ade({requireParticipantCount:t=!0,enforcePolicyLimits:e=!0,drawSizeProgression:i,participantsCount:r,participantCount:n,appliedPolicies:a,drawDefinition:o,seedingProfile:s,structureId:l,seedsCount:u}){var y,I;r=r??n;let c=et({drawDefinition:o,structureId:l});if(c.error)return c;let d=c.structure;if(!d)return{error:Mi};let{positionAssignments:p}=Er({structure:d}),m=(p==null?void 0:p.length)||0;if(u>m)return{error:CG};let h=(y=d.structures)==null?void 0:y.length,f=ot(s==null?void 0:s.groupSeedingThreshold)&&(s==null?void 0:s.groupSeedingThreshold),g=(I=iO({roundRobinGroupsCount:h,drawSize:m}))==null?void 0:I.seedGroups,{seedsCount:v}=Db({policyDefinitions:a,requireParticipantCount:t,drawSizeProgression:i,participantsCount:r,drawSize:m});return v&&(a!=null&&a[hs])&&u>v&&e&&(u=v),d.seedLimit=u,d.seedAssignments=Se(1,u+1).map(b=>{let S=g==null?void 0:g.find(T=>T.includes(b)),w=S&&Math.min(...S),U=f&&b>=f?w:b;return{participantId:void 0,seedNumber:b,seedValue:U}}),li({drawDefinition:o,structureIds:[l]}),{...J,seedLimit:u}}function ph({sortDescending:t=!1,tournamentRecord:e,scaleAttributes:i,scaleSortMethod:r,stageSequence:n,entries:a,event:o,stage:s}){if(!e)return{error:ge};return a=a??(o==null?void 0:o.entries)??[],{scaledEntries:a.filter(c=>(!s||!c.entryStage||c.entryStage===s)&&(!n||!c.entryStageSequence||c.entryStageSequence===n)&&ls.includes(c.entryStatus)).map(c=>{let{participantId:d}=c,{scaleItem:p}=Gf({tournamentRecord:e,scaleAttributes:i,participantId:d});return{...c,...p}}).filter(c=>{let d=c.scaleValue;return!r&&(isNaN(d)||!parseFloat(d))?!1:d}).sort(r||l)};function l(c,d){return t?u(d)-u(c):u(c)-u(d)}function u(c){return parseFloat(c.scaleValue||(t?-1:1e5))}}function _6(t){let e="prepareStage",{drawDefinition:i}=t,{structures:r}=Zo({stageSequence:t.stageSequence||1,roundTarget:t.roundTarget,stage:t.stage,drawDefinition:i}),n=t.preparedStructureIds||[],a=r==null?void 0:r.find(({structureId:m})=>!n.includes(m));if(!a)return ee({result:{error:Mi},stack:e});let o=a==null?void 0:a.structureId,{seedsCount:s,stageEntries:l,seedLimit:u}=Bde({...t,structureId:o});(t.seededParticipants||t.event||t.seedingScaleName)&&xde({...t,seedsCount:s,structure:a,structureId:o});let c=t.automated!==!1&&t.drawType!==La&&!(t.qualifyingOnly&&t.stage!==Ye),d=((r==null?void 0:r.length)||0)>1,p=c?kde({...t,multipleStructures:d,seedLimit:u,structureId:o}):{};return p!=null&&p.error?ee({result:p,stack:e}):{...p,stageEntries:l,structureId:o,seedsCount:s}}function Ode({entries:t,stage:e,stageSequence:i,roundTarget:r}){return t.filter(n=>{var o,s;let a=(s=(o=gt({name:gl,element:n}))==null?void 0:o.extension)==null?void 0:s.value;return(!n.entryStage||n.entryStage===e)&&(!i||!n.entryStageSequence||n.entryStageSequence===i)&&(!r||!a||a===r)&&gp.includes(n.entryStatus)})}function kde(t){let e=typeof t.automated=="object"&&t.automated.seedsOnly,i=hb({...t,seedsOnly:e});if(i.error)return i;let r=i==null?void 0:i.positionAssignments,n=i==null?void 0:i.positioningReport;return{conflicts:i.conflicts,positionAssignments:r,positioningReport:n}}function xde(t){let{seededParticipants:e,seedingScaleName:i,entries:r,event:n}=t,a=r.map(Ut);e?Fde({...t,enteredParticipantIds:a}):(n||i)&&Lde({...t,enteredParticipantIds:a})}function Fde(t){let{provisionalPositioning:e,enteredParticipantIds:i,seededParticipants:r,tournamentRecord:n,appliedPolicies:a,drawDefinition:o,seedingProfile:s,structureId:l,structure:u,event:c}=t,d=u?uh({provisionalPositioning:e,appliedPolicies:a,drawDefinition:o,seedingProfile:s,structure:u}):void 0;r.filter(({participantId:p})=>i.includes(p)).filter(p=>!p.seedNumber||p.seedNumber<=r.length).sort((p,m)=>p.seedNumber<m.seedNumber?-1:p.seedNumber<m.seedNumber?1:0).forEach(p=>{let{participantId:m,seedNumber:h,seedValue:f}=p;jg({provisionalPositioning:e,tournamentRecord:n,drawDefinition:o,seedingProfile:s,participantId:m,seedBlockInfo:d,structureId:l,seedNumber:h,seedValue:f,event:c})})}function Lde(t){let e=t.seedsCount,{provisionalPositioning:i,enteredParticipantIds:r,seedAssignmentProfile:n,assignSeedsCount:a,tournamentRecord:o,drawDefinition:s,seedByRanking:l,seedingProfile:u,structureId:c,event:d}=t,{categoryName:p,ageCategoryCode:m}=(d==null?void 0:d.category)||{},h=d==null?void 0:d.eventType,f=_de({...t,ageCategoryCode:m,categoryName:p,eventType:h})||l&&$de({...t,ageCategoryCode:m,categoryName:p,eventType:h}),g=(f==null?void 0:f.length)??0;g<e&&(e=g),f==null||f.filter(({participantId:v})=>r.includes(v)).slice(0,a||e).forEach((v,y)=>{let I=y+1,{participantId:b,scaleValue:S}=v,w=(n==null?void 0:n[I])||S||I;jg({provisionalPositioning:i,tournamentRecord:o,drawDefinition:s,seedingProfile:u,participantId:b,structureId:c,seedNumber:I,seedValue:w,event:d})})}function _de(t){let{tournamentRecord:e,seedingScaleName:i,stageSequence:r,entries:n,stage:a,event:o}=t,{categoryName:s,ageCategoryCode:l}=(o==null?void 0:o.category)||{},u=o==null?void 0:o.eventType,c={scaleName:i||s||l||o.eventId,scaleType:Rl,eventType:u};return ph({scaleAttributes:c,tournamentRecord:e,stageSequence:r,entries:n,stage:a}).scaledEntries}function $de(t){let{tournamentRecord:e,stageSequence:i,event:r,entries:n,stage:a}=t,{categoryName:o,ageCategoryCode:s}=(r==null?void 0:r.category)||{},l=r==null?void 0:r.eventType;return ph({scaleAttributes:{scaleName:o||s,scaleType:wc,eventType:l},tournamentRecord:e,stageSequence:i,entries:n,stage:a}).scaledEntries}function Bde(t){let{seedsCount:e}=t;t.seededParticipants&&(e=t.seededParticipants.length),e>t.drawSize&&(e=t.drawSize);let i=Ode(t);e>i.length&&(e=i.length);let{seedLimit:r}=Ade({enforcePolicyLimits:t.enforcePolicyLimits??!0,appliedPolicies:t.appliedPolicies,participantsCount:i.length,seedingProfile:t.seedingProfile,drawDefinition:t.drawDefinition,structureId:t.structureId,seedsCount:e});return r&&r<e&&(e=r),{seedsCount:e,stageEntries:i,seedLimit:r}}function Vde(t){var b;let e=_O({...t,modifyOriginal:!1});if(e.error)return e;let i=e.drawDefinition,{suppressDuplicateEntries:r=!0,ignoreStageSpace:n,appliedPolicies:a,qualifyingOnly:o,seedingProfile:s,participants:l,drawEntries:u,placeByes:c,drawSize:d,drawType:p,entries:m}=t,h=[],f=[],g=jde({suppressDuplicateEntries:r,ignoreStageSpace:n,drawDefinition:i,drawEntries:u,drawType:p,entries:m});if(g.error)return g;let v=p===cp?0:Qe(t.seedsCount??0),y=_6({...t,qualifyingOnly:!d||o,appliedPolicies:a,drawDefinition:i,seedingProfile:s,participants:l,stage:Oe,seedsCount:v,placeByes:c,drawSize:d,entries:m});if(y.error&&!y.conflicts)return y;(b=y.positioningReport)!=null&&b.length&&h.push({[Oe]:y.positioningReport});let I=y.structureId;return y.conflicts&&(f=y.conflicts),p===La&&t.roundsCount&&Mde({...t,drawDefinition:i,structureId:I}),{drawDefinition:i,positioningReports:h,conflicts:f,structureId:I}}function jde(t){let{ignoreStageSpace:e,drawDefinition:i,drawEntries:r,drawType:n,entries:a}=t;for(let o of a){if(r&&o.entryStage&&o.entryStage!==Oe)continue;let s={...o,ignoreStageSpace:e??n===La,entryStage:o.entryStage??Oe,event:t.event,drawDefinition:i,drawType:n},l=qA(s);if(r&&l.error)return l}return{error:void 0}}var Gde=()=>({matchUpType:void 0,drawName:void 0,drawId:void 0,structures:[],entries:[],links:[]}),Hde=Gde;function zde(t){let{drawId:e=Gt(),processCodes:i,matchUpType:r,drawType:n}=t??{},a=Hde();return Object.assign(a,{processCodes:i,matchUpType:r,drawType:n,drawId:e})}function QO(t){let e=t.structureIds,{tournamentRecord:i,drawDefinition:r,matchUpFormat:n,structureId:a,matchUpId:o,event:s}=t,l=ze(t,[{[Fn]:!0,[tA]:!0}]);if(l.error)return l;if(!Ua({matchUpFormat:n}))return{error:Cy};let u="setMatchUpFormat";if(o){let c=wi({drawDefinition:r,matchUpId:o,event:s});if(c.error)return c;let d=c.matchUp;if((d==null?void 0:d.matchUpType)===sr)return{info:"Cannot set matchUpFormat when { matchUpType: TEAM }",error:aa};d&&(d.matchUpFormat=n,Rt({tournamentId:i==null?void 0:i.tournamentId,eventId:s==null?void 0:s.eventId,context:u,drawDefinition:r,matchUp:d}))}else if(Array.isArray(e)){if((s==null?void 0:s.eventType)===sr)return{error:Bl};for(let c of e){let d=et({drawDefinition:r,structureId:c});if(d.error)return d;d.structure&&(d.structure.matchUpFormat=n)}}else if(a){if((s==null?void 0:s.eventType)===sr)return{error:Bl};let c=et({drawDefinition:r,structureId:a});if(c.error)return c;c.structure&&(c.structure.matchUpFormat=n)}else r&&(r.matchUpFormat=n);return e=e??(a?[a]:void 0),li({drawDefinition:r,structureIds:e}),{...J}}function Wde({tieFormat:t}){let e=Hn({checkCollectionIds:!1,tieFormat:t});if(e.error)return e;for(let i of t.collectionDefinitions)i.collectionId||(i.collectionId=Gt());return{tieFormat:t}}function qde({tournamentRecord:t,drawDefinition:e,matchUpFormat:i,matchUpType:r,tieFormat:n,event:a}){if((i||n)&&!(i&&(a==null?void 0:a.matchUpFormat)===i||a!=null&&a.tieFormat&&n&&JSON.stringify(a.tieFormat)===JSON.stringify(n))){if(n){let o=Wde({tieFormat:n});if(o.error)return o;e.tieFormat=o.tieFormat??n}else if(i){let o=QO({tournamentRecord:t,drawDefinition:e,matchUpFormat:i,event:a});if(o.error)return{info:"matchUpFormat or tieFormat error",error:o.error}}r&&(e.matchUpType=r)}return{error:void 0}}var $6={};yt($6,{attachPolicies:()=>Vd,findPolicy:()=>hp,getAppliedPolicies:()=>$t,getPolicyDefinitions:()=>Wu,mutate:()=>B6,query:()=>j6,removePolicy:()=>V6});var B6={};yt(B6,{attachPolicies:()=>Vd,removePolicy:()=>V6});function V6(t){let e=ze(t,[{[Zae]:!0,_anyOf:{[pn]:!1,[wr]:!1,[Fn]:!1,[Gc]:!1}}]);if(e.error)return e;let i,r=t.drawDefinition??t.event??((t.tournamentId||!t.tournamentRecords)&&t.tournamentRecord);if(r)return rV(t,r);if(t.tournamentRecords){let n=Object.keys(t.tournamentRecords);if(!n.length)return{error:ge};for(let a of n){let o=t.tournamentRecords[a],s=rV(t,o);if(s.error)return s;i=!0}}else return{error:ge};return i?{...J}:{error:Kp}}function rV(t,e){let i=$t(t).appliedPolicies??{};return i[t.policyType]?(delete i[t.policyType],Object.keys(i).length?Lt({element:e,extension:{name:NI,value:i}}):Un({element:e,name:NI}),{...J}):{error:Kp}}var j6={};yt(j6,{findPolicy:()=>hp,getAppliedPolicies:()=>$t,getPolicyDefinitions:()=>Wu});var Yde={[hs]:{validSeedPositions:{ignore:!0},duplicateSeedNumbers:!0,drawSizeProgression:!0,seedingProfile:{drawTypes:{[Gl]:{positioning:Ad},[Jo]:{positioning:Ad}},positioning:Gae},policyName:"USTA SEEDING",seedsCountThresholds:[{drawSize:4,minimumParticipantCount:3,seedsCount:2},{drawSize:16,minimumParticipantCount:12,seedsCount:4},{drawSize:32,minimumParticipantCount:24,seedsCount:8},{drawSize:64,minimumParticipantCount:48,seedsCount:16},{drawSize:128,minimumParticipantCount:96,seedsCount:32},{drawSize:256,minimumParticipantCount:192,seedsCount:64}]}},n1=Yde;function Kde({appliedPolicies:t,policyDefinitions:e,drawDefinition:i,stack:r}){if(e&&typeof e!="object")return ee({info:"policyDefinitions must be an object",result:{error:oe},stack:r});let n={[vS]:t==null?void 0:t[vS]};return e?Xde({policyDefinitions:e,appliedPolicies:t,policiesToAttach:n,drawDefinition:i}):n.avoidance&&Vd({drawDefinition:i,policyDefinitions:n}),!(t!=null&&t[hs])&&!(e!=null&&e[hs])&&(Vd({policyDefinitions:n1,drawDefinition:i}),t&&Object.assign(t,n1)),{error:void 0}}function Xde({policyDefinitions:t,appliedPolicies:e,policiesToAttach:i,drawDefinition:r}){for(let n of Object.keys(t))JSON.stringify(e==null?void 0:e[n])!==JSON.stringify(t[n])&&(i[n]=t[n]);Object.keys(i).length&&(Vd({policyDefinitions:i,drawDefinition:r}),e&&Object.assign(e,i))}function Jde(t){var v,y,I,b,S;let{tournamentRecord:e,matchUpFormat:i,appliedPolicies:r,policyDefinitions:n,matchUpType:a,tieFormat:o,drawType:s,stack:l,event:u}=t,c=t.drawId?(v=u==null?void 0:u.drawDefinitions)==null?void 0:v.find(w=>w.drawId===t.drawId):void 0;c&&s!==c.drawType&&(c.drawType=s);let d=c??zde({processCodes:t.processCodes,drawId:t.drawId,drawType:s}),p=qde({tournamentRecord:e,drawDefinition:d,matchUpFormat:i,matchUpType:a,tieFormat:o,event:u});if(p.error)return ee({result:p,stack:l});let m=Kde({appliedPolicies:r,policyDefinitions:n,drawDefinition:d,stack:l});if(m.error)return m;let h=(I=(y=c==null?void 0:c.structures)==null?void 0:y.find(w=>w.stage===Oe&&w.stageSequence===1))==null?void 0:I.structureId,f=c?(b=c.structures)==null?void 0:b.filter(w=>w.stage===Ye):[],g=(f==null?void 0:f.length)===1&&!((S=f[0].matchUps)!=null&&S.length)&&f[0].structureId;return{drawDefinition:d,structureId:h,existingDrawDefinition:c,existingQualifyingPlaceholderStructureId:g}}function Qde(t){var c,d;let e="generateOrGetExisting",i=[],r=[],n=Jde(t);if(n.error)return ee({result:n,stack:e});let a=n.existingDrawDefinition,o=n.drawDefinition??{},s=n.structureId,l=t.drawEntries??t.eventEntries??[],u=n.existingQualifyingPlaceholderStructureId&&Tde({...t,...n})||Vde({...t,...n,entries:l});return u.error?ee({result:u,stack:e}):((c=u.positioningReports)!=null&&c.length&&i.push(...u.positioningReports??[]),(d=u.conflicts)!=null&&d.length&&r.push(...u.conflicts??[]),o=u.drawDefinition,s=u.structureId,{existingDrawDefinition:a,positioningReports:i,drawDefinition:o,structureId:s,conflicts:r,entries:l})}function Zde(t){var f,g,v;let{qualifyingPlaceholder:e,qualifyingProfiles:i,existingDrawDefinition:r,positioningReports:n,appliedPolicies:a,qualifyingOnly:o,drawDefinition:s,seedingProfile:l,participants:u,structureId:c,entries:d,stack:p}=t,m=e&&!(i!=null&&i.length)&&!r,h=[];if(i){let y=(w,U)=>w.stageSequence-U.stageSequence,I=(w,U)=>w.roundTarget-U.roundTarget,b=[],S=1;i.sort(I);for(let w of i){if(!Array.isArray(w.structureProfiles))return ee({info:Bd("structureProfiles"),result:{error:Xe},stack:p});S=w.roundTarget||S;let U=((f=w.structureProfiles)==null?void 0:f.sort(y))||[],T=1;for(let D of U){let{qualifyingRoundNumber:P,qualifyingPositions:E,seededParticipants:R,seedingScaleName:N,seedsCount:A=0,seedByRanking:M,placeByes:C,drawSize:O}=D,k=_6({...t,seedingProfile:D.seedingProfile??l,stageSequence:T,qualifyingRoundNumber:P,preparedStructureIds:b,qualifyingPositions:E,seededParticipants:R,stage:Ye,seedingScaleName:N,appliedPolicies:a,drawDefinition:s,qualifyingOnly:o,seedByRanking:M,participants:u,roundTarget:S,seedsCount:A,placeByes:C,drawSize:O,entries:d});if(k.error)return k;k.structureId&&b.push(k.structureId),T+=1,(g=k.conflicts)!=null&&g.length&&h.push(...k.conflicts),(v=k.positioningReport)!=null&&v.length&&n.push({[Ye]:k.positioningReport})}S+=1}}else if(c&&m){let y=ao({structureName:Zr(Ye),stage:Ye}),{link:I}=fb({sourceStructureId:y.structureId,targetStructureId:c,sourceRoundNumber:0,linkType:Uu});s.structures||(s.structures=[]),s.structures.push(y),s.links||(s.links=[]),s.links.push(I)}return{qualifyingConflicts:h,error:void 0}}var G6={};yt(G6,{addGoesTo:()=>$d,allCompetitionMatchUps:()=>Es,allDrawMatchUps:()=>Sn,allEventMatchUps:()=>tu,allPlayoffPositionsFilled:()=>uO,allTournamentMatchUps:()=>Vr,analyzeDraws:()=>Sb,analyzeMatchUp:()=>VI,analyzeTournament:()=>lk,bulkUpdatePublishedEventIds:()=>dk,calculateWinCriteria:()=>hh,categoryCanContain:()=>ky,checkMatchUpIsComplete:()=>Rd,checkValidEntries:()=>eD,compareTieFormats:()=>Cu,competitionScheduleMatchUps:()=>Nb,courtGridRows:()=>yD,credits:()=>epe,drawMatchUps:()=>Dk,eventMatchUps:()=>UD,filterMatchUps:()=>lu,filterParticipants:()=>ub,findDrawDefinition:()=>OO,findExtension:()=>gt,findVenue:()=>eu,getAggregateTeamResults:()=>sk,getAllDrawMatchUps:()=>mr,getAllEventData:()=>pk,getAllStructureMatchUps:()=>Wt,getAllowedDrawTypes:()=>uD,getAllowedMatchUpFormats:()=>nk,getAppliedPolicies:()=>$t,getAssignedParticipantIds:()=>Ip,getAvailableMatchUpsCount:()=>QT,getAvailablePlayoffProfiles:()=>gb,getCategoryAgeDetails:()=>vm,getCheckedInParticipantIds:()=>rh,getCompetitionDateRange:()=>dD,getCompetitionMatchUps:()=>BI,getCompetitionParticipants:()=>ZO,getCompetitionPenalties:()=>ak,getCompetitionVenues:()=>Rb,getCourtInfo:()=>xT,getCourts:()=>Pk,getDrawData:()=>mD,getDrawDefinitionTimeItem:()=>AA,getDrawParticipantRepresentativeIds:()=>NO,getDrawStructures:()=>Zo,getDrawTypeCoercion:()=>Tb,getEligibleVoluntaryConsolationParticipants:()=>MO,getEntriesAndSeedsCount:()=>bD,getEvent:()=>Ck,getEventData:()=>hD,getEventMatchUpFormatTiming:()=>gk,getEventProperties:()=>Rk,getEventPublishStatus:()=>Uo,getEventStructures:()=>GT,getEventTimeItem:()=>Wy,getEvents:()=>Ek,getFlightProfile:()=>Gi,getHomeParticipantId:()=>bk,getLinkedTournamentIds:()=>Gy,getMatchUpCompetitiveProfile:()=>tb,getMatchUpContextIds:()=>wk,getMatchUpDailyLimits:()=>TD,getMatchUpDailyLimitsUpdate:()=>vk,getMatchUpDependencies:()=>us,getMatchUpFormat:()=>Uk,getMatchUpFormatTiming:()=>ib,getMatchUpFormatTimingUpdate:()=>fk,getMatchUpScheduleDetails:()=>FT,getMatchUpType:()=>LT,getMatchUpsMap:()=>sn,getMatchUpsStats:()=>Sk,getMatchUpsToSchedule:()=>fD,getMaxEntryPosition:()=>hk,getModifiedMatchUpFormatTiming:()=>wD,getPairedParticipant:()=>es,getParticipantEventDetails:()=>ek,getParticipantIdFinishingPositions:()=>AO,getParticipantMembership:()=>tk,getParticipantResults:()=>yb,getParticipantScaleItem:()=>Gf,getParticipantSchedules:()=>ik,getParticipantSignInStatus:()=>rk,getParticipantTimeItem:()=>OA,getParticipants:()=>Ni,getPersonRequests:()=>wp,getPolicyDefinitions:()=>Wu,getPositionAssignments:()=>LI,getPositionsPlayedOff:()=>Hg,getPredictiveAccuracy:()=>yk,getProfileRounds:()=>ID,getPublishState:()=>sh,getRoundMatchUps:()=>En,getRounds:()=>Tk,getScaleValues:()=>kg,getScaledEntries:()=>ph,getScheduledRoundsDetails:()=>Eb,getSchedulingProfile:()=>Xu,getSchedulingProfileIssues:()=>mk,getSeedingThresholds:()=>rO,getSeedsCount:()=>Db,getStructureSeedAssignments:()=>po,getTeamLineUp:()=>_d,getTieFormat:()=>ck,getTimeItem:()=>yo,getTournamentIds:()=>Vy,getTournamentInfo:()=>mh,getTournamentPenalties:()=>cD,getTournamentPersons:()=>ok,getTournamentPoints:()=>pD,getTournamentPublishStatus:()=>lb,getTournamentStructures:()=>lO,getTournamentTimeItem:()=>MT,getValidGroupSizes:()=>pb,getVenueData:()=>$f,getVenuesAndCourts:()=>Ku,isAdHoc:()=>zn,isCompletedStructure:()=>Ec,isValidForQualifying:()=>FO,isValidMatchUpFormat:()=>Ua,matchUpActions:()=>ZT,participantScaleItem:()=>Cl,participantScheduledMatchUps:()=>Ik,positionActions:()=>xO,publicFindCourt:()=>GA,publicFindVenue:()=>jA,tallyParticipantResults:()=>zg,tieFormatGenderValidityCheck:()=>aT,tournamentMatchUps:()=>SD,validMatchUp:()=>NT,validMatchUps:()=>wo,validateCollectionDefinition:()=>xy,validateLineUp:()=>jT});function epe(){return`
    This project would not have been possible without the generous input and patience
    of tournament organizers and directors who worked with early versions of CourtHive/TMX.

    Thanks to Pavel, Ivan, Mladen, Zdenko, Antonia, Jakov, Kreso, Barry, Jeff, Bobby... to name just a few. 

    The project would not have even begun without the support of Miro, or the introduction by Sretchko.
    The project would not have succeeded without the enthusiasm of Randy and Bruce.
    Thanks to serendipity and Luca and the ensuing TODS conversations with ITF.
    Thanks to Scott and Jake for sanity checks, suggestions, and camaraderie.
    Thanks to Zoran for inspiring the async support and getting into the weeds with subscriptions.
    Thanks to Dave for backing the conversion of TMX 1.x source into the factory repository.
    Thanks to Vuk and Pavle and Rich and Chris and Deepa for the direct engagement with the APIs.
    Thanks to Joe for repeatedly challenging me and the many pointers to useful tooling.
    Thanks to Shannon for the validation of the approach from his deep domain experience.
    Thanks to Nikola for the ongoing camaraderie and explorations of what we can do with TODS.

    And a special thanks to my family for putting up with the long days and weeks and months of coding
    and conversations at all hours.
  `}var H6={};yt(H6,{filterParticipants:()=>ub,getCompetitionParticipants:()=>ZO,getPairedParticipant:()=>es,getParticipantEventDetails:()=>ek,getParticipantMembership:()=>tk,getParticipantScaleItem:()=>Gf,getParticipantSchedules:()=>ik,getParticipantSignInStatus:()=>rk,getParticipantTimeItem:()=>OA,getParticipants:()=>Ni,getScaleValues:()=>kg,participantScaleItem:()=>Cl,validateLineUp:()=>jT});function ZO(t){let{tournamentRecords:e}=t||{};if(typeof e!="object"||!Object.keys(e).length)return{error:ki};let i=[],r={},n={},a={},o=[],s={},l=[];for(let u of Object.values(e)){let{participantIdsWithConflicts:c,mappedMatchUps:d,participantMap:p,participants:m,matchUps:h,derivedEventInfo:f,derivedDrawInfo:g}=Ni({...t,tournamentRecord:u});Object.assign(s,d),Object.assign(r,p),Object.assign(n,f),Object.assign(a,g),i.push(...m??[]),o.push(...h??[]),c==null||c.forEach(v=>{l.includes(v)||l.push(v)})}return{participantIdsWithConflicts:l,derivedEventInfo:n,derivedDrawInfo:a,participantMap:r,mappedMatchUps:s,participants:i,...J,matchUps:o}}function ek({tournamentRecord:t,participantId:e}){if(!t)return{error:ge};if(!e)return{error:pr};let i=[e].concat((t.participants??[]).filter(r=>{var n;return(r==null?void 0:r.participantType)&&[Kt,ht].includes(r.participantType)&&((n=r.individualParticipantIds)==null?void 0:n.includes(e))}).map(r=>r.participantId));return{eventDetails:(t.events??[]).filter(r=>{let n=((r==null?void 0:r.entries)??[]).map(a=>a.participantId);return Rn(n,i)}).map(r=>({eventName:r.eventName,eventId:r.eventId}))}}function tk({tournamentRecord:t,participantId:e}){if(!t)return{error:ge};if(!e)return{error:pr};let{participants:i}=Ni({participantFilters:{participantTypes:[Kt,ht,Wa]},tournamentRecord:t});return(i??[]).filter(r=>{var n;return(n=r.individualParticipantIds)==null?void 0:n.includes(e)}).reduce((r,n)=>{let a=n.participantType;return a&&(r[a]||(r[a]=[]),r[a].push(n)),r},{})}function ik({participantFilters:t={},tournamentRecord:e}){if(!e)return{error:ge};if(typeof t!="object")return{error:Gu,context:{participantFilters:t}};let i={eventIds:t.eventIds},r=Vr({tournamentRecord:e,contextFilters:i}).matchUps??[],n=Object.assign({},...r.map(l=>({[l.matchUpId]:l}))),a=r.filter(({schedule:l})=>l&&Object.keys(l).length),o=us({tournamentRecord:e,matchUps:r}).sourceMatchUpIds??[],s={};for(let l of a){let{sides:u}=l,c,d=(u==null?void 0:u.map(m=>{if(m.participant)return[m.participant].concat(...m.participant.individualParticipants||[]);o[l.matchUpId]&&!c&&(c=(o[l.matchUpId]||[]).map(h=>n[h]).filter(({winningSide:h,bye:f})=>!h&&!f))}).filter(Boolean).flat())??[];for(let m of d){let{participantId:h}=m;s[h]||(s[h]={potentialMatchUps:[],participant:m,matchUps:[]}),s[h].matchUps.push(l)}let p=(c==null?void 0:c.map(({sides:m})=>m).flat().map(({participant:m})=>m&&[m].concat(...m.individualParticipants||[])).filter(Boolean).flat())||[];for(let m of p){let{participantId:h}=m;s[h]||(s[h]={potentialMatchUps:[],participant:m,matchUps:[]}),s[h].potentialMatchUps.push(l)}}return{participantSchedules:Object.values(s).filter(({participant:l})=>!(t.participantIds&&!t.participantIds.includes(l.participantId)||t.participantTypes&&!t.participantTypes.includes(l.participantType))),...J}}function rk({tournamentRecord:t,participantId:e}){if(!t)return{error:ge};if(!e)return{error:pr};let{participant:i}=qc({tournamentRecord:t,participantId:e});if(!i)return{error:zi};let{timeItem:r}=yo({itemType:zy,element:i});return r&&r.itemValue===OI&&OI}var z6={};yt(z6,{analyzeDraws:()=>Sb,analyzeTournament:()=>lk,getAggregateTeamResults:()=>sk,getAllowedDrawTypes:()=>uD,getAllowedMatchUpFormats:()=>nk,getAppliedPolicies:()=>$t,getCompetitionDateRange:()=>dD,getCompetitionPenalties:()=>ak,getPolicyDefinitions:()=>Wu,getTournamentInfo:()=>mh,getTournamentPenalties:()=>cD,getTournamentPersons:()=>ok,getTournamentPoints:()=>pD,getTournamentStructures:()=>lO,getTournamentTimeItem:()=>MT});function nk({tournamentRecord:t,categoryName:e,categoryType:i}){var n;if(!t)return{error:ge};let{appliedPolicies:r}=$t({tournamentRecord:t});return(((n=r==null?void 0:r[Rs])==null?void 0:n.matchUpFormats)||[]).filter(({categoryNames:a,categoryTypes:o})=>!e&&!o||e&&(a==null?void 0:a.includes(e))||i&&(o==null?void 0:o.includes(i)))}function uD({tournamentRecord:t,categoryName:e,categoryType:i}){var n;if(!t)return{error:ge};let{appliedPolicies:r}=$t({tournamentRecord:t});return(((n=r==null?void 0:r[IS])==null?void 0:n.allowedDrawTypes)||[]).filter(({categoryNames:a,categoryTypes:o})=>!e&&!o||e&&(a==null?void 0:a.includes(e))||i&&(o==null?void 0:o.includes(i)))}function cD({tournamentRecord:t}){if(!t)return{error:ge};let e=((t==null?void 0:t.participants)??[]).reduce((i,r)=>{let{participantId:n}=r;return(r.penalties??[]).forEach(a=>{let{penaltyId:o}=a||{};i[o]?i[o].participants.push(n):i[o]={...a,participantIds:[n]}}),i},{});return{penalties:Object.values(e)}}function ak({tournamentRecords:t}){if(typeof t!="object"||!Object.keys(t).length)return{error:ki};let e=[];for(let i of Object.values(t)){let{penalties:r}=cD({tournamentRecord:i});e.push(...r??[])}return{penalties:e}}function W6({event:t}){return{eventInfo:(({eventId:e,eventName:i,eventType:r,eventLevel:n,surfaceCategory:a,matchUpFormat:o,category:s,gender:l,startDate:u,endDate:c,ballType:d,discipline:p,onlineResources:m,notes:h})=>({eventId:e,eventName:i,eventType:r,eventLevel:n,surfaceCategory:a,matchUpFormat:o,category:s,gender:l,startDate:u,endDate:c,ballType:d,discipline:p,onlineResources:m,notes:h}))(t)}}var tpe={[By]:{policyName:"Staff Privacy Policy",participant:{contacts:!1,individualParticipants:!1,individualParticipantIds:!1,onlineResources:!1,participantName:!0,participantOtherName:!0,participantId:!0,participantRole:!0,participantRoleResponsibilities:!0,participantStatus:!0,penalties:!1,representing:!0,participantType:!0,person:{addresses:!1,biographicalInformation:!1,birthDate:!1,contacts:!1,nationalityCode:!0,nativeFamilyName:!1,nativeGivenName:!1,onlineResources:!1,otherNames:!0,parentOrganisationId:!1,passportFamilyName:!1,passportGivenName:!1,personId:!1,personOtherIds:!1,previousNames:!1,sex:!1,standardFamilyName:!0,standardGivenName:!0,status:!1,tennisId:!1,wheelchair:!0}}}},ipe=tpe;function mh(t){var s,l,u,c;let{tournamentRecord:e}=t??{};if(!e)return{error:ge};let i=(({tournamentId:d,tournamentRank:p,tournamentStatus:m,formalName:h,tournamentName:f,promotionalName:g,onlineResources:v,localTimeZone:y,activeDates:I,startDate:b,endDate:S,hostCountryCode:w,venues:U,notes:T,updatedAt:D})=>({tournamentId:d,tournamentRank:p,tournamentStatus:m,formalName:h,tournamentName:f,promotionalName:g,onlineResources:v,localTimeZone:y,activeDates:I,startDate:b,endDate:S,hostCountryCode:w,venues:U,notes:T,updatedAt:D}))(e),r=((s=Ni({participantFilters:{participantRoles:[aq,KA,oq,sq,uq]},policyDefinitions:ipe,tournamentRecord:e}))==null?void 0:s.participants)??[];r&&(i.tournamentContacts=r);let n=(l=sh({tournamentRecord:e}))==null?void 0:l.publishState,a=((c=(u=n==null?void 0:n.tournament)==null?void 0:u.status)==null?void 0:c.publishedEventIds)||[],o=[];for(let d of e.events??[])if(!(t!=null&&t.usePublishState)||a.includes(d.eventId)){let p=W6({event:d}).eventInfo;p&&o.push(p)}return i.timeItemValues=h3({element:e}),i.publishState=n==null?void 0:n.tournament,i.eventInfo=o,{tournamentInfo:Me(Ge(i),!1,!0),...J}}function dD({tournamentRecords:t}){if(!Nt(t))return{error:ki};let e=Object.keys(t??{}).reduce((n,a)=>{let o=t[a],{tournamentInfo:{startDate:s,endDate:l}}=mh({tournamentRecord:o}),u=s&&new Date(pt(s));(!n.startDate||u&&u<n.startDate)&&(n.startDate=u);let c=l&&new Date(pt(l));return(!n.endDate||c&&c>n.endDate)&&(n.endDate=c),n},{startDate:void 0,endDate:void 0}),i=e.startDate&&pt(e.startDate.toISOString()),r=e.endDate&&pt(e.endDate.toISOString());return!i||!r?{error:YG}:{startDate:i,endDate:r}}function ok({tournamentRecord:t,participantFilters:e}){if(!t)return{error:ge};let i=t.participants||[];e&&(i=ub({participants:i,participantFilters:e,tournamentRecord:t}));let r={},n=a=>{if(a.person){let{personId:o}=a.person;r[o]?r[o].participantIds.push(a.participantId):r[o]={...a.person,participantIds:[a.participantId]}}};return i.forEach(a=>{a.person&&n(a)}),{tournamentPersons:Object.values(r)}}function sk(t){var d,p,m,h,f,g,v,y;let e=ze(t,[{[wr]:!0}]);if(e.error)return e;let i=t.finishingPositionRangeBounsPoints||{},r={},n=I=>{var S,w,U;let b=(S=I==null?void 0:I.individualParticipants)==null?void 0:S.map(T=>{var D;return((D=T.teams)==null?void 0:D.length)===1&&T.teams[0]});return((w=I==null?void 0:I.teams)==null?void 0:w.length)===1&&((U=I==null?void 0:I.teams)==null?void 0:U[0])||(b==null?void 0:b[0].participantId)===(b==null?void 0:b[1].participantId)&&(b==null?void 0:b[0])},{matchUps:a,participants:o}=Ni({participantFilters:{participantTypes:[St]},withRankingProfile:!0,withStatistics:!0,...t});for(let I of o??[]){if(I.participantType===Vn)continue;((p=(d=I.draws)==null?void 0:d[0])==null?void 0:p.drawId)==="draw-0-3"&&console.log(I.participantType,I.draws[0].finishingPositionRange);let b=n(I);if(b)for(let S of(I==null?void 0:I.draws)??[]){let w=(m=S==null?void 0:S.finishingPositionRange)==null?void 0:m.join("-");if(w&&(i!=null&&i[w])){let U=b==null?void 0:b.participantId,T=S==null?void 0:S.drawId,D=`${U}|${T}|${w}`;r[D]=i[w]}}}let s=I=>({teamName:I,standingPoints:0,pointsPlayed:0,pointsPct:0,points:0,bonus:0,diff:0,loss:0,win:0}),l=(I,b,S)=>{I[b]===void 0&&(I[b]=0),I[b]+=S},u={},c={};for(let I of a??[]){let{sides:b,matchUpFormat:S}=I,w=S&&kn(S);if((b==null?void 0:b.length)===2&&((h=w.setFormat)!=null&&h.timed)&&(!w.finalSetFormat||(f=w.finalSetFormat)!=null&&f.timed))for(let U of b){let T=n(U.participant),D=T==null?void 0:T.participantId,P=(g=U.participant)==null?void 0:g.participantId,E=T==null?void 0:T.participantName,R=U.sideNumber,N=((v=U.participant)==null?void 0:v.individualParticipantIds)||P&&[P]||[];if(N.forEach(A=>{A&&!u[A]&&(u[A]=s(E))}),D&&R){c[D]||(c[D]=s(E));let A=[...N.map(C=>u[C]),c[D]];I.winningSide&&(R===I.winningSide?A.forEach(C=>l(C,"win",1)):A.forEach(C=>l(C,"loss",1)));let M=((y=I.score)==null?void 0:y.sets)||[];for(let C of M){let O=(C==null?void 0:C[`side${3-R}Score`])||0,k=(C==null?void 0:C[`side${R}Score`])||0,x=k-O;A.forEach(F=>l(F,"pointsPlayed",k+O)),A.forEach(F=>l(F,"points",k)),A.forEach(F=>l(F,"diff",x))}}}}for(let I of Object.keys(r)){let[b]=I.split("|");c[b]&&(c[b].bonus+=r[I],c[b].pointsPct=parseFloat((c[b].points/c[b].pointsPlayed).toFixed(2)),c[b].standingPoints=c[b].win+c[b].bonus)}for(let I of Object.keys(u))u[I].pointsPct=parseFloat((u[I].points/u[I].pointsPlayed).toFixed(2));return{...J,individualResults:u,teamResults:c}}function rpe(t){var a,o,s,l,u,c,d;let e=((o=(a=t.participants)==null?void 0:a.filter(({participantType:p})=>p===Kt))==null?void 0:o.length)===2,i=((s=t.events)==null?void 0:s.length)===1&&t.events[0],r=((l=i==null?void 0:i.drawDefinitions)==null?void 0:l.length)===1&&i.drawDefinitions[0],n=((d=(c=((u=r==null?void 0:r.structures)==null?void 0:u.length)===1&&r.structures[0])==null?void 0:c.positionAssignments)==null?void 0:d.length)===2;return!!(i.tieFormat&&e&&n)}function lk({tournamentRecord:t}){var n;if(!t)return{error:ge};let{drawsAnalysis:e}=Sb({tournamentRecord:t}),i={isDual:rpe(t),drawsAnalysis:e},r=Ni({tournamentRecord:t});return(n=r.missingParticipantIds)!=null&&n.length&&(i.missingParticipantIds=r.missingParticipantIds),{...J,analysis:i}}function q6(t,e){return t&&e&&Array.isArray(e)&&e[t-1]||typeof e=="object"&&e[t]}function npe(t){let{participation:e={},awardProfiles:i,startDate:r,eventType:n,drawSize:a,drawType:o,category:s,endDate:l,level:u}=t,{participationOrder:c,flightNumber:d,rankingStage:p}=e,m=h=>!r&&!l||!h.dateRanges?!0:h.dateRanges.some(f=>{let g=!r||!f.startDate||new Date(r)>new Date(f.startDate),v=!l||!f.endDate||new Date(l)<=new Date(f.endDate);return g&&v});return{awardProfile:i.find(h=>{var f,g,v,y,I,b,S,w,U,T;return m(h)&&(!h.maxFlightNumber||d<=h.maxFlightNumber)&&(!((f=h.drawTypes)!=null&&f.length)||((g=h.drawTypes)==null?void 0:g.includes(o)))&&(!((v=h.drawSizes)!=null&&v.length)||h.drawSizes.includes(a))&&(!((y=h.stages)!=null&&y.length)||h.stages.includes(p))&&(!((I=h.levels)!=null&&I.length)||h.levels.includes(u))&&(!h.maxDrawSize||a<=h.maxDrawSize)&&(!h.drawSize||h.drawSize===a)&&(!h.maxLevel||u<=h.maxLevel)&&(!d||!((S=(b=h.flights)==null?void 0:b.flightNumbers)!=null&&S.length)||h.flights.flightNumbers.includes(d))&&(!h.participationOrder||h.participationOrder===c)&&(!((w=h.category)!=null&&w.ageCategoryCodes)||h.category.ageCategoryCodes.includes(s==null?void 0:s.ageCategoryCode))&&(!((U=h.eventTypes)!=null&&U.length)||((T=h.eventTypes)==null?void 0:T.includes(n)))})}}function nV({participantWon:t,flightNumber:e,valueObj:i,drawSize:r,flights:n,level:a}){var h,f;let o=(g,v)=>{if(g){if(Array.isArray(v)){let y=v.find(I=>I.flight===g||I.f===g);return y.value||y.v}if(typeof v=="object"){let y=v.flights||v.f;if(Array.isArray(y))return y[g-1]}}},s=(g,v)=>{let y=(g==null?void 0:g.value)||(g==null?void 0:g.v)||(ot(g)?g:0),I=q6(a,g==null?void 0:g.level);return{value:o(v,I)||ot(I)&&I||y}},l=0,u,c,d,p,m=t&&"won"||t===!1&&"lost"||void 0;if(Array.isArray(i)){let g=i.find(I=>{var b;return I.drawSize===r||((b=I.drawSizes)==null?void 0:b.includes(r))}),v=i.find(I=>I.drawSize&&I.threshold&&r>I.drawSize),y=i.find(I=>{var b;return!I.drawSize&&!((b=I.drawSizes)!=null&&b.length)});m!==void 0&&(g=g==null?void 0:g[m],v=v==null?void 0:v[m],y=y==null?void 0:y[m]),c=s(g,e).value,d=s(v,e).value,p=s(y,e).value,l=c||d||p,u=c&&g.requireWin||d&&v.requireWin||(y==null?void 0:y.requireWin)}else if(typeof i=="object"){let g=(h=i==null?void 0:i.drawSizes)==null?void 0:h[r],v=i;m!==void 0&&(g=g==null?void 0:g[m],v=v==null?void 0:v[m]),c=s(g,e).value,p=s(v,e).value,l=c||p,u=c?g.requireWin:v==null?void 0:v.requireWin}else ot(i)&&m===void 0&&(l=i);return e&&((f=n==null?void 0:n.pct)!=null&&f[e])&&(l=Math.round(l*n.pct[e])),{awardPoints:l,requireWin:u}}function pD({participantFilters:t,policyDefinitions:e,tournamentRecord:i,level:r}){var v;if(!i)return{error:ge};let{policyDefinitions:n}=Wu({policyTypes:[EU],tournamentRecord:i}),a=(e==null?void 0:e[EU])??(n==null?void 0:n[EU]);if(!a)return{error:G0};let o=a.awardProfiles,s=a.requireWinFirstRound,l=a.requireWinForPoints,{participants:u,derivedEventInfo:c,derivedDrawInfo:d,mappedMatchUps:p}=Ni({withRankingProfile:!0,participantFilters:t,tournamentRecord:i}),m=u==null?void 0:u.filter(y=>{var I;return(I=y.draws)==null?void 0:I.length}),h={},f={},g={};for(let y of m??[]){let{participantType:I,participantId:b,person:S,draws:w}=y;for(let U of w){let{drawId:T,structureParticipation:D,eventId:P}=U,E=c[P],R=d[T],N=R==null?void 0:R.drawType,{category:A,eventType:M}=E||{},C=U.startDate||E.startDate||i.startDate,O=U.endDate||E.endDate||i.endDate;if(M===Sa&&b!==Vn)continue;let k;if(o){let x=l,F=0,$=0,_=0,L;for(let B of D){let{finishingPositionRange:V,participationOrder:G,participantWon:j,flightNumber:z,rankingStage:W,winCount:q}=B;F+=q||0;let Y=R==null?void 0:R.drawSize,{awardProfile:re}=npe({awardProfiles:o,participation:B,eventType:M,startDate:C,category:A,drawSize:Y,drawType:N,endDate:O,level:r});if(re){if(!Y)continue;let K=Array.isArray(V)&&Math.max(...V),H=ct(V||[]).join("-"),Z=K&&W!==Ye&&(V==null?void 0:V.includes(Y));re.requireWinForPoints!==void 0&&(x=re.requireWinForPoints),re.requireWinFirstRound!==void 0&&(s=re.requireWinFirstRound);let{finishingPositionPoints:X={},finishingPositionRanges:ie,finishingRound:ae,pointsPerWin:le,flights:ne}=re,de=Array.isArray(re.perWinPoints)?(v=re.perWinPoints)==null?void 0:v.find(Pe=>{var it;return(it=Pe.participationOrders)==null?void 0:it.includes(G)}):re.perWinPoints,ye=X.participationOrders,ce=0,ke;if((!ye||ye.includes(G))&&ie&&K){let Pe=ie[K];Pe&&({awardPoints:ce,requireWin:ke}=nV({flightNumber:z,valueObj:Pe,drawSize:Y,flights:ne,level:r}))}if(!ce&&ae&&G===1&&K){let Pe=ae[K];Pe&&({awardPoints:ce,requireWin:ke}=nV({participantWon:j,flightNumber:z,valueObj:Pe,drawSize:Y,flights:ne,level:r}))}if(Z&&s!==void 0&&(x=s),ke!==void 0&&(x=ke),ce>$&&(!x||q)&&($=ce,L=K),!ce&&le&&q&&(_+=q*le,L=H),!ce&&q&&de){let Pe=q6(r,de==null?void 0:de.level);Pe?_+=q*Pe:de.value&&(_+=q*de.value)}}if(k=$+_,I===Vn){let K=(y.matchUps||[]).filter(({structureId:H})=>H===B.structureId);for(let{matchUpId:H}of K){let Z=p[H],X=Z.sides.find(ie=>ie.participantId===b).sideNumber;if(Z.winningSice===X)for(let ie of Z.tieMatchUps)ie.winningSide}}}if(_||$){let B={winCount:F,positionPoints:$,rangeAccessor:L,perWinPoints:_,eventType:M,drawId:T,points:k},V=S==null?void 0:S.personId;V?(h[V]||(h[V]=[]),h[V].push(B)):I===ht?(g[b]||(g[b]=[]),g[b].push(B)):I===Vn&&(f[b]||(f[b]=[]),f[b].push(B))}}}}return{participantsWithOutcomes:m,personPoints:h,pairPoints:g,teamPoints:f,...J}}var Y6={};yt(Y6,{compareTieFormats:()=>Cu,getTieFormat:()=>ck,tieFormatGenderValidityCheck:()=>aT,validateCollectionDefinition:()=>xy});function _S(t){var n;if(!t)return{};let e=[],i=t.tieFormatName,r=(n=t.collectionDefinitions)==null?void 0:n.map(a=>{let{matchUpType:o,matchUpFormat:s,matchUpCount:l,category:u,gender:c}=a;e.includes(s)||e.push(s);let d=u==null?void 0:u.ageCategoryCode;return[l,o===Md?"D":"S",d,s,c].join(";")}).join("|");return{tieFormatName:t&&i||"UNNAMED",matchUpFormats:e,tieFormatDesc:r}}function Cu({considerations:t={},descendant:e,ancestor:i}){var S,w;let r={},n={},{matchUpFormats:a,tieFormatDesc:o}=_S(e),{matchUpFormats:s,tieFormatDesc:l}=_S(i),u=ct((a??[]).filter(U=>!(s??[]).includes(U)).concat((s??[]).filter(U=>!(a??[]).includes(U)))),c=!!(t!=null&&t.collectionName&&e.collectionDefinitions.map(({collectionName:U})=>U).join("|")!==i.collectionDefinitions.map(({collectionName:U})=>U).join("|")),d=!!(t!=null&&t.collectionOrder&&e.collectionDefinitions.map(({collectionOrder:U})=>U).join("|")!==i.collectionDefinitions.map(({collectionOrder:U})=>U).join("|")),p=Object.assign({},...((e==null?void 0:e.collectionDefinitions)||[]).map(U=>({[U.collectionId]:U}))),m=Object.assign({},...((i==null?void 0:i.collectionDefinitions)||[]).map(U=>({[U.collectionId]:U})));r.collectionIds=UB(Object.keys(p),Object.keys(m)),n.collectionIds=UB(Object.keys(m),Object.keys(p)),r.collectionsValue=aV(p),n.collectionsValue=aV(m),r.groupsCount=((S=i==null?void 0:i.collectionGroups)==null?void 0:S.length)??(0-(((w=e==null?void 0:e.collectionGroups)==null?void 0:w.length)??0)||0),n.groupsCount=r.groupsCount?-1*r.groupsCount:0;let h=r.collectionsValue.totalValue-n.collectionsValue.totalValue,f=r.collectionsValue.totalMatchUps-n.collectionsValue.totalMatchUps,g=n.collectionsValue.assignmentValues.length!==r.collectionsValue.assignmentValues.length,v=n.collectionsValue.assignmentValues.some((U,T)=>{let D=r.collectionsValue.assignmentValues[T];return!D||U.valueKey!==D.valueKey||U.value!==D.value?!0:Array.isArray(U.value)?U.value.every((P,E)=>D.value[E]===P):!1}),y=c||d||l!==o||g||v||h!==0,I=[...n.collectionsValue.invalidValues,...r.collectionsValue.invalidValues],b=I.length&&I;return{matchUpFormatDifferences:u,matchUpCountDifference:f,descendantDifferences:r,ancestorDifferences:n,orderDifference:d,valueDifference:h,nameDifference:c,descendantDesc:o,ancestorDesc:l,...J,different:y,invalid:b}}function aV(t){let e=[],i=[],r=0;return{totalValue:Object.keys(t).sort($T).reduce((n,a)=>{let o=t[a],{collectionValueProfiles:s,collectionValue:l,matchUpCount:u,matchUpValue:c,scoreValue:d,setValue:p}=o,m={collectionValueProfiles:s,collectionValue:l,matchUpValue:c,scoreValue:d,setValue:p},h=Object.keys(m).filter(g=>![void 0,null].includes(m[g])&&(!Array.isArray(m[g])||m[g].length>0));h.length!==1&&e.push({collectionId:a});let f=h[0];if(f){let g=f==="collectionValueProfiles"?Object.values(s):m[f];i.push({valueKey:f,value:g})}return r+=u,s!=null&&s.length?n+s.reduce((g,v)=>g+v.value,0):u?ot(c)?n+c*u:ot(d)?n+d*u:ot(p)?n+p*u:n+l:n},0),totalMatchUps:r,invalidValues:e,assignmentValues:i}}function uk(t){Object.assign(t,{inContext:!0});let{matchUp:e,error:i}=K6(t);return{matchUp:Me(e,!0,!0),error:i}}function K6({participantsProfile:t,afterRecoveryTimes:e,tournamentRecord:i,contextContent:r,contextProfile:n,drawDefinition:a,nextMatchUps:o,matchUpId:s,inContext:l,eventId:u,drawId:c,event:d}){var h;if(!i)return{error:ge};if(typeof s!="string")return{error:yn};if(!a||!d){let f=(Vr({tournamentRecord:i,nextMatchUps:o}).matchUps??[]).find(g=>g.matchUpId===s);if(!f)return{error:dn};({eventId:u,drawId:c}=f),{event:d,drawDefinition:a}=Wn({tournamentRecord:i,eventId:u,drawId:c})}if(!a)return{error:xa};n&&!r&&(r=qu({tournamentRecord:i,contextProfile:n}));let p={surfaceCategory:(d==null?void 0:d.surfaceCategory)??i.surfaceCategory,indoorOutDoor:(d==null?void 0:d.indoorOutdoor)??i.indoorOutdoor,endDate:(d==null?void 0:d.endDate)??i.endDate,tournamentId:i.tournamentId,eventId:u??(d==null?void 0:d.eventId),drawId:c},{participants:m=[]}=mp({participantsProfile:t,tournamentRecord:i,contextProfile:n,inContext:l});if(o){let f=(Sn({context:l?p:void 0,participants:m,afterRecoveryTimes:e,contextContent:r,contextProfile:n,drawDefinition:a,nextMatchUps:o,inContext:l,event:d}).matchUps??[]).find(v=>v.matchUpId===s);if(!f)return{error:dn};let g=(h=a==null?void 0:a.structures)==null?void 0:h.find(v=>v.structureId===f.structureId);return{drawDefinition:a,structure:g,matchUp:f}}else{let{matchUp:f,structure:g}=wi({context:l?p:void 0,tournamentParticipants:m,afterRecoveryTimes:e,contextContent:r,drawDefinition:a,contextProfile:n,matchUpId:s,inContext:l,event:d});return{matchUp:f,structure:g,drawDefinition:a}}}function ck({tournamentRecord:t,drawDefinition:e,structureId:i,matchUpId:r,structure:n,eventId:a,drawId:o,event:s}){var m,h,f,g,v;if(!t)return{error:ge};if(!o&&!s&&!i&&!r)return ee({result:{error:Xe},stack:"getTieFormat"});a&&!s&&(s=(m=t.events)==null?void 0:m.find(y=>y.eventId===a));let l=uk({tournamentRecord:t,drawDefinition:e,matchUpId:r,drawId:o,event:s});if(r&&(l!=null&&l.error))return l;if(!e&&(l!=null&&l.drawDefinition)&&(e=l==null?void 0:l.drawDefinition),n=n??(l==null?void 0:l.structure),!n&&i&&!r){if(!e)return{error:xs};let y=et({drawDefinition:e,structureId:i});if(y.error)return y;n=y.structure}let u=((n==null?void 0:n.tieFormat)||(n==null?void 0:n.tieFormatId))&&((h=vn({structure:n,drawDefinition:e,event:s}))==null?void 0:h.tieFormat),c=((e==null?void 0:e.tieFormat)||(e==null?void 0:e.tieFormatId))&&((f=vn({drawDefinition:e,event:s}))==null?void 0:f.tieFormat),d=(g=vn({event:s}))==null?void 0:g.tieFormat,p=(v=vn({matchUp:l==null?void 0:l.matchUp,drawDefinition:e,structure:n,event:s}))==null?void 0:v.tieFormat;return{...J,matchUp:l==null?void 0:l.matchUp,structureDefaultTieFormat:qr(u),eventDefaultTieFormat:qr(d),drawDefaultTieFormat:qr(c),tieFormat:qr(p),structure:n}}var X6={};yt(X6,{bulkUpdatePublishedEventIds:()=>dk,getAllEventData:()=>pk,getCourtInfo:()=>xT,getDrawData:()=>mD,getEventData:()=>hD,getEventPublishStatus:()=>Uo,getPublishState:()=>sh,getTournamentPublishStatus:()=>lb,getVenueData:()=>$f});function dk({tournamentRecord:t,outcomes:e}){var n;if(!t)return{error:ge};if(!(e!=null&&e.length))return{error:Xe,info:"Missing outcomes"};let i=e.reduce((a,o)=>{let{drawId:s,eventId:l}=o;return l&&s&&(a[l]?a[l].includes(s)||a[l].push(s):a[l]=[s]),a},{}),r=Object.keys(i);return{publishedEventIds:((n=t.events)==null?void 0:n.filter(a=>r.includes(a.eventId))).filter(a=>{let o=Uo({event:a}),{drawDetails:s,drawIds:l}=o??{},{eventId:u}=a;return i[u].filter(c=>{let d=s?Object.keys(o.drawDetails).filter(p=>WA({drawId:p,drawDetails:s})):[];return(l==null?void 0:l.includes(c))||d.includes(c)}).length}).map(a=>a.eventId),eventIdPublishedDrawIdsMap:i}}function J6({dates:t=[],extension:e}){var r;if(!e)return!1;if(typeof e.value=="boolean"&&e.value)return!0;if(!t.length)return!1;let i=Nt(e.value)?(r=e.value)==null?void 0:r.dates:void 0;if(Array.isArray(i))return i!=null&&i.length?!!i.filter(n=>!t.length||t.includes(n)).length:!1}function Q6({convertExtensions:t,ignoreDisabled:e,venue:i,court:r}){var o;let n={...Me(r,t,!0),venueId:i.venueId},{extension:a}=gt({name:ys,element:r});if(e&&a){let s=Nt(a.value)?(o=a.value)==null?void 0:o.dates:void 0,l=(a==null?void 0:a.value)===!0?[]:n.dateAvailability.map(u=>{let c=u.date;if(!(!c||s.includes(c)))return u}).filter(Boolean);n.dateAvailability=l}return{inContextCourt:n}}function Ku(t){let{convertExtensions:e,ignoreDisabled:i,venueIds:r=[],dates:n}=t,a=t.tournamentRecords||t.tournamentRecord&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord}||{},o=[],s=[],l=[],u=[];return Object.keys(a).filter(c=>!t.tournamentId||c===t.tournamentId).forEach(c=>{let d=a[c];for(let p of d.venues??[])if(!(r.length&&!r.includes(p.venueId))){if(i){let{extension:m}=gt({name:ys,element:p});if(m!=null&&m.value)continue}o.includes(p.venueId)||(u.push(Me(p,e,!0)),o.push(p.venueId));for(let m of p.courts??[])if(!s.includes(m.courtId)){if(i){let{extension:f}=gt({name:ys,element:m});if(J6({extension:f,dates:n}))continue}let{inContextCourt:h}=Q6({convertExtensions:e,ignoreDisabled:i,venue:p,court:m});l.push(h),s.push(m.courtId)}}}),{courts:l,venues:u,...J}}function ape({convertExtensions:t,tournamentRecord:e,ignoreDisabled:i,dates:r}){if(!e)return{error:ki};let n=Me(e.venues??[],t).filter(o=>{if(!i)return o;let{extension:s}=gt({name:ys,element:o});return!(s!=null&&s.value)&&o}).filter(Boolean),a=n.reduce((o,s)=>{let l=((s==null?void 0:s.courts)||[]).filter(u=>{if(!i&&!(r!=null&&r.length))return u;let{extension:c}=gt({name:ys,element:u});return J6({extension:c,dates:r})}).filter(Boolean).map(u=>{let{inContextCourt:c}=Q6({convertExtensions:t,ignoreDisabled:i,venue:s,court:u});return c});return l.length?o.concat(l):o},[]);return{venues:n,courts:a}}function Rb({tournamentRecords:t,requireCourts:e,dates:i}){return typeof t!="object"||!Object.keys(t).length?{error:ki}:Object.keys(t).reduce((r,n)=>{let a=t[n],{venues:o}=ape({tournamentRecord:a,dates:i});return o==null||o.forEach(s=>{let{venueId:l,courts:u}=s;(!e||u!=null&&u.length)&&!r.venueIds.includes(l)&&(r.venues.push(s),r.venueIds.push(l))}),r},{venues:[],venueIds:[]})}function pk({tournamentRecord:t,policyDefinitions:e}){if(!t)return{error:ge};let i=t.events||[],r=(t==null?void 0:t.participants)||[],{tournamentInfo:n}=mh({tournamentRecord:t}),{venues:a}=Ku({tournamentRecord:t}),o=i.map(s=>{let{eventId:l}=s,u=W6({event:s}).eventInfo,c=qy({tournamentRecord:t,event:s}).scheduleTiming,d=(s.drawDefinitions||[]).map(m=>{let h=(({drawId:I,drawName:b,matchUpFormat:S,updatedAt:w})=>({matchUpFormat:S,updatedAt:w,drawName:b,drawId:I}))(m),{abandonedMatchUps:f,completedMatchUps:g,upcomingMatchUps:v,pendingMatchUps:y}=$g({requireParticipants:!0,tournamentParticipants:r,context:{eventId:l},policyDefinitions:e,tournamentRecord:t,inContext:!0,scheduleTiming:c,drawDefinition:m,event:s});return{drawInfo:h,matchUps:{abandonedMatchUps:f,completedMatchUps:g,upcomingMatchUps:v,pendingMatchUps:y}}}),p=Uo({event:s});return Object.assign(u,{drawsData:d,publish:p}),u});return{allEventData:{tournamentInfo:n,venuesData:a,eventsData:o}}}function Z6({publishStatus:t,drawId:e}){var i,r,n;return t!=null&&t.drawDetails?(n=(r=(i=t.drawDetails)==null?void 0:i[e])==null?void 0:r.publishingDetail)==null?void 0:n.published:t!=null&&t.drawIds?t.drawIds.includes(e):!0}var e4="PUBLIC",ope="ADMIN",spe={PUBLIC_DISPLAY:e4,ADMIN_DISPLAY:ope};function mD(t){var R,N,A;let{tournamentParticipants:e=[],includePositionAssignments:i,policyDefinitions:r,tournamentRecord:n,inContext:a=!0,usePublishState:o,status:s=qa,pressureRating:l,refreshResults:u,contextProfile:c,drawDefinition:d,noDeepCopy:p,sortConfig:m,context:h,event:f}=t;if(!d)return{error:_e};let g=(({matchUpFormat:M,updatedAt:C,drawType:O,drawName:k,drawId:x})=>({matchUpFormat:M,updatedAt:C,drawName:k,drawType:O,drawId:x}))(d);g.display=(R=gt({element:d,name:yS}).extension)==null?void 0:R.value;let v={},y,{allStructuresLinked:I,sourceStructureIds:b,hasDrawFeedProfile:S,structureGroups:w}=HT({drawDefinition:d});if(!I)return{error:FG};let U=(t==null?void 0:t.publishStatus)??Uo({event:f,status:s}),T=t.eventPublished??!!((A=(N=sh({event:f}).publishState)==null?void 0:N.status)!=null&&A.published),D=!1,P=!1,E=w.map(M=>{let C={},O=M.map(k=>{let{structure:x}=et({drawDefinition:d,structureId:k}),{seedAssignments:F}=po({drawDefinition:d,structure:x});return(x==null?void 0:x.stage)===Oe&&x.stageSequence===1&&(y=F),(x==null?void 0:x.stage)===Ye&&(v[x.stageSequence??0]=F),x}).sort((k,x)=>Qm(k,x,m)).map(k=>{var W,q;if(!k)return;let x=k==null?void 0:k.structureId,F=[];k.stage&&[Oe,rn,$i].includes(k.stage)&&(F=y),(k==null?void 0:k.stage)===Ye&&(F=v[k.stageSequence??0]);let{matchUps:$,roundMatchUps:_,roundProfile:L}=Wt({seedAssignments:(W=k==null?void 0:k.seedAssignments)!=null&&W.length?void 0:F,context:{drawId:g.drawId,...h},hydrateParticipants:t.hydrateParticipants,participantsProfile:t.participantsProfile,tournamentParticipants:e,policyDefinitions:r,tournamentRecord:n,usePublishState:o,publishStatus:U,contextProfile:c,drawDefinition:d,inContext:a,structure:k,event:f}),{positionAssignments:B}=oi({structure:k}),V=B==null?void 0:B.filter(Ta(Hl)).map(Y=>{var Z,X;let re=(X=(Z=gt({element:Y,name:Sc}))==null?void 0:Z.extension)==null?void 0:X.value,{drawPosition:K,participantId:H}=Y;return P=!0,{participantResult:re,participantId:H,drawPosition:K}});if($.length&&(!(V!=null&&V.length)&&t.allParticipantResults||u&&!k.structures)){let{subOrderMap:Y}=u3({positionAssignments:B}),re=$.some(H=>H.matchUpType===ka)?$.filter(H=>H.matchUpType===ka):$,K=zg({matchUpFormat:k.matchUpFormat,matchUps:re,policyDefinitions:r,pressureRating:l,subOrderMap:Y});V=B==null?void 0:B.filter(Ta(Hl)).map(H=>{var ie;let{drawPosition:Z,participantId:X}=H;return P=!0,{participantResult:X&&((ie=K==null?void 0:K.participantResults)==null?void 0:ie[X]),participantId:X,drawPosition:Z}})}let G=k?(({stageSequence:Y,structureName:re,structureType:K,matchUpFormat:H,stage:Z})=>({stageSequence:Y,structureName:re,structureType:K,matchUpFormat:H,stage:Z}))(k):{},j=(q=gt({element:k,name:yS}).extension)==null?void 0:q.value;G.display=(j==null?void 0:j[e4])??j,G.sourceStructureIds=b[x],G.hasDrawFeedProfile=S[x],G.positionAssignments=B,G.structureActive=$.reduce((Y,re)=>{var H;let K=[er,cr,ss,qi,Hu,Mt,mn,zt].includes(re.matchUpStatus);return Y||K||!!re.winningSide||!!((H=re.score)!=null&&H.scoreStringSide1)},!1);let z=$.reduce((Y,re)=>Y&&[Vt,qi,mn,zt,Mt,$a].includes(re.matchUpStatus),!!$.length);return G.structureCompleted=z,C[x]=z,G.structureActive&&(D=!0),{...G,participantResults:V,seedAssignments:F,roundMatchUps:_,roundProfile:L,structureId:x}});return O.forEach(k=>{var x;i||delete k.positionAssignments,k.sourceStructuresComplete=(x=k.sourceStructureIds)==null?void 0:x.every(F=>C[F])}),O}).flat();return g.drawActive=D,g.participantPlacements=P,g.drawGenerated=E==null?void 0:E.reduce((M,C)=>M||!!(C!=null&&C.roundMatchUps),!1),g.drawCompleted=E==null?void 0:E.reduce((M,C)=>M&&C.structureCompleted,!0),g.drawPublished=o?T&&Z6({publishStatus:U,drawId:g.drawId}):void 0,{structures:!o||g.drawPublished?p&&E||Me(E,!1,!0):void 0,drawInfo:p?g:Me(g,!1,!0),...J}}function hD(t){var N,A,M;let{includePositionAssignments:e,participantsProfile:i,policyDefinitions:r,usePublishState:n,status:a=qa,contextProfile:o,sortConfig:s}=t,l=ze(t,[{tournamentRecord:!0},{[oA]:{event:!1,eventId:!1}}]);if(l.error)return l;let u=Me(t.tournamentRecord,!1,!0),c=t.event?void 0:Wn({tournamentRecord:u,eventId:t.eventId}).event,d=t.event?Me(t.event,!1,!0):c&&Me(c,!1,!0)||void 0;if(!d)return{error:lo};let{eventId:p}=d,{tournamentId:m,endDate:h}=u,f=Uo({event:d,status:a}),g=sh({event:d}).publishState??{},v=!!((N=g==null?void 0:g.status)!=null&&N.published),{participants:y}=Ni({withGroupings:!0,withEvents:!1,withDraws:!1,policyDefinitions:r,...i,tournamentRecord:u}),I=({stage:C,drawId:O})=>{var x,F,$;if(!n)return!0;let k=(F=(x=f==null?void 0:f.drawDetails)==null?void 0:x[O])==null?void 0:F.stageDetails;return!k||!Object.keys(k).length?!0:($=k[C])==null?void 0:$.published},b=({structureId:C,drawId:O})=>{var x,F,$;if(!n)return!0;let k=(F=(x=f==null?void 0:f.drawDetails)==null?void 0:x[O])==null?void 0:F.structureDetails;return!k||!Object.keys(k).length?!0:($=k[C])==null?void 0:$.published},S=({drawId:C})=>n?Z6({publishStatus:f,drawId:C}):!0,w=({drawId:C,structure:O})=>{var x,F,$,_;if(!n)return O;let k=(_=($=(F=(x=f==null?void 0:f.drawDetails)==null?void 0:x[C])==null?void 0:F.structureDetails)==null?void 0:$[O.structureId])==null?void 0:_.roundLimit;if(ot(k)){let L=Se(1,k+1),B={},V={};for(let G of L)O.roundMatchUps[G]&&(B[G]=O.roundMatchUps[G],V[G]=O.roundProfile[G]);O.roundMatchUps=B,O.roundProfile=V}return O},U=d.drawDefinitions||[],T=!n||v?U.filter(S).map(C=>(({drawInfo:O,structures:k})=>({...O,structures:k}))(mD({allParticipantResults:t.allParticipantResults,hydrateParticipants:t.hydrateParticipants,context:{eventId:p,tournamentId:m,endDate:h},pressureRating:t.pressureRating,refreshResults:t.refreshResults,includePositionAssignments:e,tournamentParticipants:y,noDeepCopy:!0,policyDefinitions:r,tournamentRecord:u,usePublishState:n,contextProfile:o,drawDefinition:C,publishStatus:f,sortConfig:s,event:d}))).map(({structures:C,...O})=>{let k=C==null?void 0:C.filter(({stage:x,structureId:F})=>b({structureId:F,drawId:O.drawId})&&I({stage:x,drawId:O.drawId})).map(x=>w({drawId:O.drawId,structure:x}));return{...O,structures:k}}).filter(C=>{var O;return(O=C.structures)==null?void 0:O.length}):void 0,D=(Array.isArray(u.venues)?u.venues:[]).map(C=>(({venueData:O})=>({...O}))($f({venueId:C.venueId,tournamentRecord:u}))),P=(({eventId:C,eventName:O,eventType:k,eventLevel:x,surfaceCategory:F,matchUpFormat:$,category:_,gender:L,startDate:B,endDate:V,ballType:G,discipline:j})=>({eventId:C,eventName:O,eventType:k,eventLevel:x,surfaceCategory:F,matchUpFormat:$,category:_,gender:L,startDate:B,endDate:V,ballType:G,discipline:j}))(d);P.display=(A=gt({element:d,name:yS}).extension)==null?void 0:A.value;let{tournamentInfo:E}=mh({tournamentRecord:u}),R={tournamentInfo:E,venuesData:D,eventInfo:P,drawsData:T};return R.eventInfo.publishState=g,R.eventInfo.published=(M=g==null?void 0:g.status)==null?void 0:M.published,{...J,eventData:R,participants:y}}var t4={};yt(t4,{courtGridRows:()=>yD,findVenue:()=>eu,getMatchUpsToSchedule:()=>fD,getPersonRequests:()=>wp,getProfileRounds:()=>ID,getScheduledRoundsDetails:()=>Eb,getSchedulingProfile:()=>Xu,getSchedulingProfileIssues:()=>mk,publicFindCourt:()=>GA});function zf({matchUpPotentialParticipantIds:t,matchUpNotBeforeTimes:e,timeAfterRecovery:i,matchUp:r}){var u,c,d,p;let{individualParticipantIds:n}=ET(r);i=i??((u=r.schedule)==null?void 0:u.timeAfterRecovery);let a=m=>{t[m]||(t[m]=[]),t[m]=ct(t[m].concat(...n))},o=m=>{i&&(!e[m]||i>e[m])&&(e[m]=i)},s=((c=r.winnerTo)==null?void 0:c.matchUpId)||r.winnerMatchUpId;s&&(i&&o(s),a(s));let l=((d=r.loserTo)==null?void 0:d.matchUpId)||r.loserMatchUpId;l&&(i&&o(l),a(l)),(p=r.sidesTo)!=null&&p.length&&r.sidesTo.forEach(({matchUpId:m})=>{m&&(i&&o(m),a(m))})}function fD(t){let e=ze(t,[{[nA]:!0}]);if(e.error)return e;let{matchUpPotentialParticipantIds:i,dateScheduledMatchUpIds:r=[],scheduleCompletedMatchUps:n,matchUpNotBeforeTimes:a,matchUpScheduleTimes:o,orderedMatchUpIds:s,clearDate:l,matchUps:u}=t,c=o?Object.keys(o):[],d=(s??[]).map(m=>u.find(h=>h.matchUpId===m)).filter(Boolean).filter(m=>{let h=!l&&(r.includes(m.matchUpId)||c.includes(m.matchUpId)),f=[Vt,Mt,qi,$a,mn,zt,er,cr].includes(m==null?void 0:m.matchUpStatus);return n||!h&&!m.winningSide&&!f}),p=i&&a?d.reduce((m,h)=>{let{drawId:f,tournamentId:g}=h;return m.matchUpMap[g]||(m.matchUpMap[g]={}),m.matchUpMap[g][f]?m.matchUpMap[g][f].push(h):m.matchUpMap[g][f]=[h],zf({matchUpPotentialParticipantIds:i,matchUpNotBeforeTimes:a,matchUp:h}),m},{matchUpMap:{}}).matchUpMap:{};return{matchUpsToSchedule:d,matchUpMap:p}}function gD({defaultRecoveryMinutes:t=0,defaultAverageMinutes:e,tournamentRecords:i,matchUpFormat:r,categoryName:n,categoryType:a,tournamentId:o,eventType:s,eventId:l}){if(!Ua({matchUpFormat:r}))return{error:Cy};let u=Object.keys(i).filter(d=>!o||d===o),c;return u.forEach(d=>{var h;if(c)return;let p=i[d],m=l?(h=Wn({tournamentRecord:p,eventId:l}))==null?void 0:h.event:void 0;return c=ib({tournamentRecord:p,matchUpFormat:r,categoryName:n,categoryType:a,eventType:s,event:m}),(c==null?void 0:c.averageMinutes)||(c==null?void 0:c.recoveryMinutes)}),{recoveryMinutes:(c==null?void 0:c.recoveryMinutes)||t,averageMinutes:(c==null?void 0:c.averageMinutes)||e,typeChangeRecoveryMinutes:(c==null?void 0:c.typeChangeRecoveryMinutes)||(c==null?void 0:c.recoveryMinutes)||t}}function Eb(t){let e=ze(t,[{[oA]:{tournamentRecords:!1,tournamentRecord:!1}},{rounds:!0,[Xn]:un}]);if(e.error)return e;let{scheduleCompletedMatchUps:i,periodLength:r=30}=t,n=t.tournamentRecords||t.tournamentRecord&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord}||{};if(typeof n!="object")return{error:ki};let a={},o=[],s=t.rounds.toSorted((h,f)=>(h.sortOrder??0)-(f.sortOrder??0)),l=t.containedStructureIds??Object.assign({},...Object.values(n).map(h=>Lg({tournamentRecord:h}).containedStructures)),u=t.matchUps??Es({nextMatchUps:!0,tournamentRecords:n}).matchUps,c=0,d={},p={},m={};return{scheduledRoundsDetails:s.flatMap(h=>{var U;let f=h.periodLength||r,g=[];l!=null&&l[h.structureId]?g.push(...l[h.structureId]):g.push(h.structureId);let v=u?lu({tournamentIds:[h.tournamentId],roundNumbers:[h.roundNumber],matchUpIds:h.matchUpIds,eventIds:[h.eventId],drawIds:[h.drawId],processContext:!0,structureIds:g,matchUps:u}).sort(oh):[],{segmentNumber:y,segmentsCount:I}=h.roundSegment||{};if(ot(y)&&Ss(v==null?void 0:v.length)&&Ss(I)&&y>0&&y<=I&&I<(v==null?void 0:v.length)&&!((U=h.matchUpIds)!=null&&U.length)){let T=v.length/I,D=T*(y-1);v=v.slice(D,D+T)}let b=n[h.tournamentId],S=Wn({drawId:h.drawId,tournamentRecord:b}).event,w=[];for(let T of v){let D=T.matchUpFormat;D&&(a[D]||(a[D]=[],a[D].push(T)),w.push(D))}for(let T of w){let{eventType:D,category:P}=S??{},{categoryName:E,ageCategoryCode:R}=P??{},{typeChangeRecoveryMinutes:N,recoveryMinutes:A,averageMinutes:M,error:C}=gD({categoryName:E??R,categoryType:P==null?void 0:P.categoryType,tournamentId:h.tournamentId,eventId:h.eventId,tournamentRecords:n,matchUpFormat:T,eventType:D});if(C)return{error:C,round:h};let O=v.filter(x=>(i||!vr.includes(x.matchUpStatus))&&x.matchUpStatus!==Vt).map(Dr);O.forEach(x=>{m[x]={typeChangeRecoveryMinutes:N,recoveryMinutes:A,averageMinutes:M},d[x]=A,p[x]=M}),o.push(...O),c=Math.max(M||0,c);let k=`${M}|${f}`;return{roundPeriodLength:f,recoveryMinutes:A,averageMinutes:M,matchUpIds:O,hash:k}}}),greatestAverageMinutes:c,matchUpFormatCohorts:a,recoveryMinutesMap:d,averageMinutesMap:p,orderedMatchUpIds:o,minutesMap:m,...J}}function i4({schedulingProfile:t,venueIds:e,eventIds:i,drawIds:r}){let n=[],a=t==null?void 0:t.map(s=>{let l=pt(s==null?void 0:s.scheduleDate);if(!l){n.push(`Invalid date: ${s==null?void 0:s.scheduledDate}`);return}let u=((s==null?void 0:s.venues)||[]).map(c=>{let{rounds:d,venueId:p}=c;if(!(e!=null&&e.includes(p))){n.push(`Missing venueId: ${p}`);return}let m=d.filter(h=>{let f=i.includes(h.eventId)&&r.includes(h.drawId);return f||n.push(`Invalid eventId: ${h.eventId} or drawId: ${h.drawId}`),f});if(m.length)return{venueId:p,rounds:m}}).filter(Boolean);return u.length&&l&&{...s,venues:u}}).filter(Boolean),o=n.length;return{updatedSchedulingProfile:a,modifications:o,issues:n}}function vD({tournamentRecords:t,schedulingProfile:e}){if(!e)return{valid:!0};if(!Array.isArray(e))return{valid:!1,error:oe};let{venueIds:i,tournamentsMap:r}=upe({tournamentRecords:t}),n,a,o=e.every(s=>{let{scheduleDate:l,venues:u}=s;return Ia(l)?u.every(c=>{let{venueId:d,rounds:p}=c;return typeof d!="string"?(a="venueId should be a string",!1):Array.isArray(p)?i.includes(d)?!!p.every(m=>{var T,D,P,E;if(!m)return a="empty round",!1;let{roundSegment:h,tournamentId:f,structureId:g,roundNumber:v,eventId:y,drawId:I}=m,b=(E=(P=(D=(T=r==null?void 0:r[f])==null?void 0:T[y])==null?void 0:D[I])==null?void 0:P[g])==null?void 0:E.includes(v);b||(a="Invalid rounds");let{segmentNumber:S,segmentsCount:w}=h||{},U=!h||ot(S)&&Ss(w)&&S<=w;return U||(a="Invalid segment"),b&&U}):(n=Wm,!1):(a="rounds should be an array",!1)}):!1});return!o&&!n&&(n=oe),{valid:!!o,error:n,info:a}}function lpe(t){let{tournamentRecord:e={},tournamentMap:i={},requireCourts:r}=t,n=[],a=[],o=[],s=[],l=((e==null?void 0:e.venues)||[]).map(({venueId:c,courts:d})=>(!r||(d==null?void 0:d.length))&&c),u=e==null?void 0:e.tournamentId;return u&&(n.push(u),i[u]={},((e==null?void 0:e.events)||[]).forEach(c=>{let d=c.eventId;o.push(d),i[u][d]={},(c.drawDefinitions||[]).forEach(p=>{let m=p.drawId;s.push(m),i[u][d][m]={};let{structures:h}=Zo({drawDefinition:p});(h||[]).forEach(f=>{var b;let g=f.structureId,{matchUps:v}=Wt({structure:f}),{roundMatchUps:y}=En({matchUps:v}),I=y&&Object.keys(y).map(S=>parseInt(S));i[u][d][m][g]=I,a.push(g),(b=f.structures)!=null&&b.length&&f.structures.forEach(S=>{a.push(S.structureId),i[u][d][m][S.structureId]=I})})})})),{tournamentMap:i,tournamentIds:n,structureIds:a,venueIds:l,eventIds:o,drawIds:s}}function upe(t){let e=(t==null?void 0:t.tournamentRecords)&&Object.values(t==null?void 0:t.tournamentRecords)||[],i={},{venueIds:r,eventIds:n,drawIds:a,structureIds:o,tournamentIds:s}=e.reduce((l,u)=>{let{tournamentIds:c,tournamentMap:d,structureIds:p,venueIds:m,eventIds:h,drawIds:f}=lpe({tournamentRecord:u});return m.forEach(g=>{l.venueIds.includes(g)||l.venueIds.push(g)}),l.tournamentIds.push(...c),l.structureIds.push(...p),l.eventIds.push(...h),l.drawIds.push(...f),Object.assign(i,d),l},{tournamentIds:[],structureIds:[],venueIds:[],eventIds:[],drawIds:[]});return{tournamentsMap:i,tournamentIds:s,structureIds:o,venueIds:r,eventIds:n,drawIds:a}}function Xu({tournamentRecords:t,tournamentRecord:e}){if(typeof t!="object"||!Object.keys(t).length)return{error:ki};let{extension:i}=gt({element:e,name:Sm,tournamentRecords:t,discover:!0}),r=(i==null?void 0:i.value)||[];if(r.length){let{venueIds:n}=Rb({requireCourts:!0,tournamentRecords:t}),{eventIds:a,drawIds:o}=DO({tournamentRecords:t}),{updatedSchedulingProfile:s,modifications:l,issues:u}=i4({schedulingProfile:r,venueIds:n,eventIds:a,drawIds:o});if(l){r=s;let c=Wg({tournamentRecords:t,tournamentRecord:e,schedulingProfile:r});return c.error?c:{schedulingProfile:r,modifications:l,issues:u}}}return{schedulingProfile:r,modifications:0}}function Wg({tournamentRecords:t,tournamentRecord:e,schedulingProfile:i}){let r=vD({tournamentRecords:t,schedulingProfile:i});return r.error?r:i?Lt({tournamentRecords:t,discover:!0,extension:{name:Sm,value:i}}):Un({element:e,name:Sm,tournamentRecords:t,discover:!0})}function Cb(t){let{tournamentRecord:e}=t,i=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(!t.schedulingProfile){let{modifications:u,issues:c}=Xu({tournamentRecords:i,tournamentRecord:e});return{success:!u,modifications:u,issues:c}}let{venueIds:r}=Rb({tournamentRecords:i}),{eventIds:n,drawIds:a}=DO({tournamentRecords:i}),{updatedSchedulingProfile:o,modifications:s,issues:l}=i4({schedulingProfile:t.schedulingProfile,venueIds:r,eventIds:n,drawIds:a});return s?{...Wg({schedulingProfile:o,tournamentRecords:i}),modifications:s,issues:l}:{...J,modifications:s,issues:l}}function mk(t){let{scheduleDates:e=[],tournamentRecords:i,periodLength:r=30}=t??{};if(typeof i!="object")return{error:Py};if(!Array.isArray(e))return{error:oe};if(!e.every(Ia))return{error:Ar};let n=[],a=0,o={},{schedulingProfile:s}=Xu({tournamentRecords:i});if(!s)return{issues:n,...J};let{matchUps:l}=Es({nextMatchUps:!0,tournamentRecords:i});for(let c of s){let{scheduleDate:d,venues:p=[]}=c;if(!(e!=null&&e.length)||e.includes(d)){for(let m of p||[])if(m){let{rounds:h}=m,f=[],{orderedMatchUpIds:g,scheduledRoundsDetails:v}=Eb({tournamentRecords:i,periodLength:r,matchUps:l,rounds:h}),{matchUpDependencies:y}=us({tournamentRecords:i,matchUps:l}),I=b=>{let S;return v==null||v.find((w,U)=>{let T=w.matchUpIds.includes(b);return T&&(S=U),T}),S};if(g==null||g.forEach((b,S)=>{var T;let w=g.slice(S+1),U=Vi(w,((T=y==null?void 0:y[b])==null?void 0:T.matchUpIds)||[]);U.length&&f.push({matchUpId:b,shouldBeAfter:U})}),f.length){a+=f.length;let b=f.map(({matchUpId:S,shouldBeAfter:w})=>{let U=I(S),T=ct(w.map(I));return o[d]||(o[d]={}),o[d][U]||(o[d][U]=[]),T.forEach(D=>{o[d][U].includes(D)||o[d][U].push(D)}),{matchUpId:S,matchUpRoundIndex:U,earlierRoundIndices:T,shouldBeAfter:w}});n.push(...b)}}}}let u={matchUpIdShouldBeAfter:Object.assign({},...n.map(c=>{let{matchUpId:d,shouldBeAfter:p,earlierRoundIndices:m}=c;return{[d]:{earlierRoundIndices:m,shouldBeAfter:p}}}))};return{issuesCount:a,profileIssues:u,roundIndexShouldBeAfter:o,...J}}function wp(t){let{tournamentRecords:e,requestType:i}=t,r=ze(t,[{[pn]:!0}]);if(r.error)return r;let n={};for(let a of Object.values(e)){let{extension:o}=gt({element:a,name:xg}),s=(o==null?void 0:o.value)||[];for(let l of s){let{personId:u,requests:c}=l||{};n[u]||(n[u]=[]);for(let d of c)i&&d.requestType!==i||n[u].push(d)}}return{personRequests:n,...J}}function a1(t){let{containerStructureId:e,roundSegment:i,isRoundRobin:r,tournamentId:n,roundNumber:a,structureId:o,eventId:s,drawId:l}=t,u=r?e:o,c=[n,s,l,u,a].join("|");return Ge({structureId:u,roundSegment:i,tournamentId:n,roundNumber:a,eventId:s,drawId:l,id:c})}function oV({round:t,matchUps:e,events:i,tournamentRecords:r}){let n=i.find(p=>p.eventId===t.eventId),{eventType:a,category:o,categoryType:s}=n||{},{categoryName:l,ageCategoryCode:u}=o||{},c=wa(e.map(({matchUpFormat:p})=>p)),d=0;return Object.keys(c).forEach(p=>{let m=c[p],h=gD({categoryName:l||u,tournamentId:t.tournamentId,eventId:t.eventId,tournamentRecords:r,matchUpFormat:p,categoryType:s,eventType:a});if(h.error)return h;let f=h.averageMinutes*m;isNaN(d)||(d+=f)}),{roundMinutes:d}}function cpe(t){return(t||[]).reduce((e,i)=>{var a,o;let r=(((a=i.finishingPositionRange)==null?void 0:a.winner)||[]).reduce((s,l)=>s+l,0),n=(((o=i.finishingPositionRange)==null?void 0:o.winner)||[]).join("-")||"";return!e.minFinishingSum||r<e.minFinishingSum?{minFinishingSum:r,winnerFinishingPositionRange:n}:e},{minFinishingSum:0,winnerFinishingPositionRange:""})}function sV(t){let e=t.length,i=t.filter(({sides:u})=>u==null?void 0:u.some(({bye:c})=>c)).length||0,r=t.filter(({winningSide:u,matchUpStatus:c})=>u||vr.includes(c)).length||0,n=t.filter(({schedule:u,matchUpStatus:c})=>(u==null?void 0:u.scheduledDate)&&(u==null?void 0:u.scheduledTime)&&c!==Vt).length||0,a=e-i,o=a===r,s=a-n,l=a-n;return{unscheduledCount:s,incompleteCount:l,scheduledCount:n,completedCount:r,matchUpsCount:e,isScheduled:a===n,isComplete:o,byeCount:i}}function ID({tournamentRecords:t,schedulingProfile:e,tournamentRecord:i,withRoundId:r}){if(i&&!t){if(typeof i!="object")return{error:Py};t={[i.tournamentId]:i}}if(e){let a=vD({tournamentRecords:t,schedulingProfile:e});if(a.error)return a}if(!e&&t){let a=Xu({tournamentRecords:t});if(a.error)return a;e=a.schedulingProfile}if(!e)return{error:$r};let n={};return{profileRounds:e.map(({venues:a,scheduleDate:o})=>a.map(({rounds:s})=>s.map(l=>{var c;let u=a1(l);return(c=u.roundSegment)!=null&&c.segmentsCount&&(n[u.id]=u.roundSegment.segmentsCount),Ge({id:r?u.id:void 0,scheduleDate:o,...u})}))).flat(1/0),segmentedRounds:n}}function yD({courtPrefix:t="C|",minRowsCount:e,courtsData:i}){if(!Array.isArray(i))return{error:oe};let r=i==null?void 0:i.reduce((o,s)=>{let l=s.matchUps||[],u=Math.max(0,...l.map(c=>c.schedule.courtOrder||0));return u>o?u:o},1),n=e?Math.max(e,r):r,a=Se(0,n).map(o=>({matchUps:Se(0,i.length).map(s=>{let l=i[s],{courtId:u,venueId:c}=l;return{schedule:{courtOrder:o+1,venueId:c,courtId:u}}})}));return i.forEach((o,s)=>{var l;for(let u of o.matchUps){let c=(l=u.schedule)==null?void 0:l.courtOrder;c&&(a[c-1].matchUps[s]=u)}}),{courtPrefix:t,rows:a.map((o,s)=>Object.assign({rowId:`rowId-${s+1}`},...o.matchUps.map((l,u)=>({[`${t}${u}`]:l}))))}}var r4={};yt(r4,{getEntriesAndSeedsCount:()=>bD,getMaxEntryPosition:()=>hk});function bD({policyDefinitions:t,drawDefinition:e,drawSize:i,drawId:r,event:n,stage:a}){if(!n)return{error:gi};let{entries:o,stageEntries:s}=dq({drawDefinition:e,drawId:r,stage:a,event:n}),l=s.length,{drawSize:u}=x3({participantsCount:l}),c=Db({drawSize:i??u,participantsCount:l,policyDefinitions:t});if(c.error)return ee({result:c,stack:"getEntriesAndSeedsCount"});let{seedsCount:d}=c;return{entries:o,seedsCount:d,stageEntries:s}}function hk(t){let{entries:e=[],entryStatus:i,stage:r}=t;return Math.max(...e.filter(n=>(!r||r===n.entryStage)&&(!i||n.entryStatus===i)&&!isNaN(n.entryPosition)).map(({entryPosition:n})=>Qe(n||0)),0)}var n4={};yt(n4,{allCompetitionMatchUps:()=>Es,allDrawMatchUps:()=>Sn,allEventMatchUps:()=>tu,allTournamentMatchUps:()=>Vr,analyzeMatchUp:()=>VI,calculateWinCriteria:()=>hh,checkMatchUpIsComplete:()=>Rd,competitionScheduleMatchUps:()=>Nb,drawMatchUps:()=>Dk,eventMatchUps:()=>UD,filterMatchUps:()=>lu,getAllDrawMatchUps:()=>mr,getAllStructureMatchUps:()=>Wt,getCheckedInParticipantIds:()=>rh,getCompetitionMatchUps:()=>BI,getEventMatchUpFormatTiming:()=>gk,getHomeParticipantId:()=>bk,getMatchUpCompetitiveProfile:()=>tb,getMatchUpContextIds:()=>wk,getMatchUpDailyLimits:()=>TD,getMatchUpDailyLimitsUpdate:()=>vk,getMatchUpDependencies:()=>us,getMatchUpFormat:()=>Uk,getMatchUpFormatTiming:()=>ib,getMatchUpFormatTimingUpdate:()=>fk,getMatchUpScheduleDetails:()=>FT,getMatchUpType:()=>LT,getMatchUpsStats:()=>Sk,getModifiedMatchUpFormatTiming:()=>wD,getParticipantResults:()=>yb,getPredictiveAccuracy:()=>yk,getRoundMatchUps:()=>En,getRounds:()=>Tk,isValidMatchUpFormat:()=>Ua,matchUpActions:()=>ZT,participantScheduledMatchUps:()=>Ik,tallyParticipantResults:()=>zg,tournamentMatchUps:()=>SD,validMatchUp:()=>NT,validMatchUps:()=>wo});function a4({tournamentRecords:t,extensionName:e}){if(typeof t!="object"||!Object.keys(t).length)return{error:ki};let i=[],r;for(let n of Object.values(t)){let{extension:a}=gt({element:n,name:e});a&&!r&&(i.push({params:{extension:a,discover:!0},method:"addExtension"}),r=!0);let o=n.events??[];for(let s of o){let{eventId:l}=s,{extension:u}=gt({name:e,element:s});u&&i.push({params:{eventId:l,extension:u},method:"addEventExtension"})}}return{methods:i}}function fk({tournamentRecords:t}){return a4({extensionName:Du,tournamentRecords:t})}var bE="ADULT",wE="JUNIOR",cU="WHEELCHAIR",dpe={[Hc]:{allowModificationWhenMatchUpsScheduled:{courts:!1,venues:!1},defaultTimes:{averageTimes:[{categoryNames:[],minutes:{default:90}}],recoveryTimes:[{minutes:{[Zt]:30,default:60}}]},defaultDailyLimits:{[ti]:2,[Zt]:2,total:3},matchUpAverageTimes:[{matchUpFormatCodes:[hu],averageTimes:[{categoryNames:[],minutes:{default:90}},{categoryTypes:[cU],minutes:{default:120}}]},{matchUpFormatCodes:["SET3-S:6/TB7-F:TB10"],averageTimes:[{categoryNames:[],minutes:{default:85}}]},{matchUpFormatCodes:["SET3-S:6/TB7-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:70}}]},{matchUpFormatCodes:["SET3-S:4NOAD-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:55}}]},{matchUpFormatCodes:["SET3-S:4/TB7"],averageTimes:[{categoryNames:[],minutes:{default:60}}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:50}}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB10"],averageTimes:[{categoryNames:[],minutes:{default:55}}]},{matchUpFormatCodes:["SET3-S:4/TB5@3"],averageTimes:[{categoryNames:[],minutes:{default:45}}]},{matchUpFormatCodes:["SET1-S:8/TB7","SET1-S:8/TB7@7"],averageTimes:[{categoryNames:[],minutes:{default:40}}]},{matchUpFormatCodes:["SET1-S:5/TB9@4"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:6/TB7"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:6NOAD"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:4/TB7","SET1-S:4/TB5@3","SET3-S:TB10","SET1-S:T20"],averageTimes:[{categoryNames:[],minutes:{default:20}}]},{matchUpFormatCodes:["SET1-S:4NOAD"],averageTimes:[{categoryNames:[],minutes:{default:20}}]},{matchUpFormatCodes:["SET1-S:TB10"],averageTimes:[{categoryNames:[],minutes:{default:10}}]}],matchUpRecoveryTimes:[{matchUpFormatCodes:["SET3-S:6/TB7","SET3-S:6/TB7-F:TB10","SET3-S:6/TB7-F:TB7"],recoveryTimes:[{categoryTypes:[bE,cU],minutes:{default:60,[Zt]:30}},{categoryTypes:[wE],minutes:{default:60,[Zt]:60}}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB7","SET3-S:4/TB7-F:TB10","SET3-S:4NOAD-F:TB7","SET3-S:4/TB7","SET3-S:4/TB5@3"],recoveryTimes:[{categoryTypes:[bE,cU],minutes:{default:30}},{categoryTypes:[wE],minutes:{default:60}}]},{matchUpFormatCodes:["SET1-S:8/TB7","SET1-S:8/TB7@7","SET1-S:5/TB9@4","SET1-S:6/TB7","SET1-S:6NOAD","SET1-S:4/TB7","SET1-S:4NOAD","SET3-S:TB10","SET1-S:T20"],recoveryTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:4/TB5@3"],recoveryTimes:[{categoryTypes:[bE,wE],minutes:{default:30}},{categoryTypes:[cU],minutes:{default:15}}]},{matchUpFormatCodes:["SET1-S:TB10"],recoveryTimes:[{categoryNames:[],minutes:{default:15}}]}],matchUpDailyLimits:[]}},ppe=dpe;function gk({tournamentRecord:t,matchUpFormats:e,categoryType:i,event:r}){if(!r)return{error:gi};let n=[],a;if(e!=null&&e.length){let d=[];n=e.map(p=>{let m=typeof p=="string"?{matchUpFormat:p}:p;if(!d.includes(m==null?void 0:m.matchUpFormat)&&Ua({matchUpFormat:m==null?void 0:m.matchUpFormat}))return d.push(m.matchUpFormat),m}).filter(Boolean)}else{let{policy:d}=hp({policyType:Rs,tournamentRecord:t,event:r});if(d!=null&&d.matchUpFormats)n=d==null?void 0:d.matchUpFormats;else{let{extension:p}=gt({name:Du,element:r}),m,h;p!=null&&p.value?{matchUpAverageTimes:m,matchUpRecoveryTimes:h}=p.value:{matchUpAverageTimes:m,matchUpRecoveryTimes:h}=ppe[Hc],n=ct([...(m||[]).map(f=>f.matchUpFormatCodes),...(h||[]).map(f=>f.matchUpFormatCodes)].flat()).map(f=>({matchUpFormat:f})),a="default scheduling policy in use"}}let{eventType:o,eventId:s,category:l}=r,u=(l==null?void 0:l.categoryName)??(l==null?void 0:l.ageCategoryCode)??s;if(!s)return{error:gi};let c=n.map(({matchUpFormat:d,description:p})=>{let m=ib({tournamentRecord:t,matchUpFormat:d,categoryName:u,categoryType:i,eventType:o,event:r});return{matchUpFormat:d,description:p,...m}});return Ge({eventMatchUpFormatTiming:c,info:a})}function wD(t){let e=ze(t,[{[wr]:!0},{[Kr]:f=>Ua({matchUpFormat:f}),[_a]:Cy,[tA]:!0}]);if(e.error)return e;let{tournamentRecord:i,matchUpFormat:r,event:n}=t,{extension:a}=gt({name:Du,element:n}),o=a==null?void 0:a.value,{extension:s}=gt({element:i,name:Du}),l=s==null?void 0:s.value,u=(o==null?void 0:o.matchUpAverageTimes)&&Kv({...o,matchUpFormat:r}),c=(l==null?void 0:l.matchUpAverageTimes)&&Kv({...l,matchUpFormat:r}),d=[u,c].find(f=>f),p=(o==null?void 0:o.matchUpRecoveryTimes)&&Xv({...o,matchUpFormat:r}),m=(l==null?void 0:l.matchUpRecoveryTimes)&&Xv({...l,matchUpFormat:r}),h=[p,m].find(f=>f);return{matchUpFormat:r,recoveryTimes:h,averageTimes:d}}function vk({tournamentRecords:t}){return a4({extensionName:jy,tournamentRecords:t})}var Mb=({scheduleAttributes:t=["scheduledDate","scheduledTime"],schedule:e={}})=>!!Object.keys(e).filter(i=>t.includes(i)).filter(i=>e[i]).length;function Ik({scheduleAttributes:t=["scheduledDate","scheduledTime"],matchUps:e=[]}){if(!wo(e))return{error:ju};if(!Array.isArray(t))return{error:oe};let i=e.filter(Boolean).filter(({schedule:r})=>Mb({schedule:r,scheduleAttributes:t})).reduce((r,n)=>{let{schedule:a}=n,o=pt(a==null?void 0:a.scheduledDate),s=bi(a==null?void 0:a.scheduledTime);return o&&s&&(r[o]?r[o].push(n):r[o]=[n]),r},{});return Object.keys(i).forEach(r=>{i[r].sort((n,a)=>{var o,s;return qH(bi((o=n.schedule)==null?void 0:o.scheduledTime),bi((s=a.schedule)==null?void 0:s.scheduledTime))})}),{...J,scheduledMatchUps:i}}function mpe({tournamentRecords:t}){var r;let e={},i=[];for(let n of Object.values(t))for(let a of n.events??[]){let o=Uo({event:a}),s=o==null?void 0:o.drawDetails;Nt(s)?(Object.assign(e,s),i.push(...Object.keys(s).filter(l=>WA({drawId:l,drawDetails:s})))):(r=o==null?void 0:o.drawIds)!=null&&r.length&&i.push(...o.drawIds)}return{drawIds:i,detailsMap:e}}function $S({schedulingProfile:t,matchUps:e=[]}){let i={},r=({eventId:s,drawId:l,structureId:u,roundNumber:c})=>`${s}|${l}|${u}${c}`;t!=null&&t.length&&t.map(({venues:s})=>s.map(({rounds:l})=>l)).flat().forEach(s=>{s.sort((l,u)=>(l.sortOrder||0)-(u.sortOrder||0)).forEach(({eventId:l,drawId:u,structureId:c,roundNumber:d},p)=>{let m=r({eventId:l,drawId:u,structureId:c,roundNumber:d});i[m]=p})});let n=[],a={noScheduledDate:[]};for(let s of e){let l=s.schedule||{},u=l.scheduledDate&&pt(l.scheduledDate)||l.scheduledTime&&pt(l.scheduledTime)||"noScheduledDate";a[u]||(a[u]=[]),a[u].push(s)}let o=Object.keys(a).sort();for(let s of o){let l=a[s],u={noScheduledTime:[]};for(let d of l){let p=d.schedule||{},m=p.scheduledTime&&bi(p.scheduledTime)||"noScheduledTime";u[m]||(u[m]=[]),u[m].push(d)}let c=Object.keys(u).sort();for(let d of c){let p=u[d];p.sort((m,h)=>{let f=i[r(m)]||0,g=i[r(h)]||0;return f-g}),n.push(...p)}}return n}function UD(t){let{participants:e,contextContent:i,participantMap:r}=t,{tournamentAppliedPolicies:n,scheduleVisibilityFilters:a,participantsProfile:o,afterRecoveryTimes:s,policyDefinitions:l,useParticipantMap:u,tournamentRecord:c,usePublishState:d,contextFilters:p,matchUpFilters:m,contextProfile:h,nextMatchUps:f,tournamentId:g,inContext:v,context:y,event:I}=t;if(!I)return{error:gi};let{eventId:b,eventName:S,endDate:w,eventType:U,category:T,gender:D}=I??{},P={...y,...Ge({surfaceCategory:I.surfaceCategory??(c==null?void 0:c.surfaceCategory),indoorOutDoor:I.indoorOutdoor??(c==null?void 0:c.indoorOutdoor),tournamentId:g??(c==null?void 0:c.tournamentId),endDate:w??(c==null?void 0:c.endDate),eventName:S,eventType:U,category:T,eventId:b,gender:D})},E;!e&&c&&({participants:e,participantMap:r,groupInfo:E}=mp({participantsProfile:o,policyDefinitions:l,useParticipantMap:u,tournamentRecord:c,contextProfile:h,inContext:v})),h&&!i&&(i=qu({policyDefinitions:l,tournamentRecord:c,contextProfile:h,event:I}));let R=Uo({event:I});return{...(I.drawDefinitions??[]).reduce((N,A)=>{var C;let M=$g({hydrateParticipants:t.hydrateParticipants,context:P,tournamentAppliedPolicies:n,scheduleVisibilityFilters:a,tournamentParticipants:e,participantsProfile:o,afterRecoveryTimes:s,policyDefinitions:l,tournamentRecord:c,usePublishState:d,contextContent:i,contextFilters:p,matchUpFilters:m,participantMap:r,publishStatus:R,contextProfile:h,drawDefinition:A,nextMatchUps:f,inContext:v,event:I});return(C=Object.keys(M))==null||C.forEach(O=>{Array.isArray(M[O])&&(N[O]||(N[O]=[]),N[O]=N[O].concat(M[O]))}),N},{}),...J,groupInfo:E}}function SD(t){if(!(t!=null&&t.tournamentRecord))return{error:ge};let e=t.contextContent,{scheduleVisibilityFilters:i,participantsProfile:r,afterRecoveryTimes:n,policyDefinitions:a,tournamentRecord:o,inContext:s=!0,usePublishState:l,contextFilters:u,matchUpFilters:c,contextProfile:d,nextMatchUps:p,context:m}=t,h=t.tournamentId??o.tournamentId,f=(o==null?void 0:o.events)??[],{participants:g,participantMap:v,groupInfo:y}=mp({participantsProfile:r,policyDefinitions:a,tournamentRecord:o,contextProfile:d,inContext:s});d&&!e&&(e=qu({policyDefinitions:a,tournamentRecord:o,contextProfile:d}));let{appliedPolicies:I}=$t({tournamentRecord:o}),b=(u==null?void 0:u.eventIds)??[];return{...f.filter(S=>!b.includes(S.eventId)).map(S=>{var U,T,D;let w={eventDrawsCount:((T=(U=Gi({event:S}).flightProfile)==null?void 0:U.flights)==null?void 0:T.length)||((D=S.drawDefinitions)==null?void 0:D.length)||0,...m};return UD({hydrateParticipants:t.hydrateParticipants,context:w,tournamentAppliedPolicies:I,scheduleVisibilityFilters:i,participantsProfile:r,afterRecoveryTimes:n,policyDefinitions:a,tournamentRecord:o,usePublishState:l,contextFilters:u,contextProfile:d,contextContent:e,matchUpFilters:c,participantMap:v,participants:g,tournamentId:h,nextMatchUps:p,inContext:s,event:S})}).reduce((S,w)=>{var U;return(U=w&&Object.keys(w).filter(T=>!["success","matchUpsMap"].includes(T)))==null||U.forEach(T=>{Array.isArray(w[T])&&(S[T]||(S[T]=[]),S[T]=S[T].concat(w[T]),S.matchUpsCount+=w[T].length)}),S},{matchUpsCount:0}),groupInfo:y,participants:g}}function BI({scheduleVisibilityFilters:t,hydrateParticipants:e,participantsProfile:i,tournamentRecords:r,useParticipantMap:n,policyDefinitions:a,usePublishState:o,matchUpFilters:s,contextFilters:l,nextMatchUps:u,inContext:c}){if(typeof r!="object"||!Object.keys(r).length)return{error:ki};let d=Object.keys(r).map(h=>{let f=r[h];return SD({scheduleVisibilityFilters:t,hydrateParticipants:e,participantsProfile:i,useParticipantMap:n,policyDefinitions:a,tournamentRecord:f,usePublishState:o,matchUpFilters:s,contextFilters:l,nextMatchUps:u,inContext:c})}),p={},m={};return{...d.reduce((h,f)=>(Object.keys(f).forEach(g=>{if(g==="groupInfo")Object.assign(m,f[g]);else if(g==="participants")for(let v of f[g]??[])p[v.participantId]=v;else Array.isArray(f[g])&&(h[g]||(h[g]=[]),h[g]=h[g].concat(f[g]))}),h),{}),groupInfo:m,mappedParticipants:p}}function Nb(t){var N,A,M,C,O,k,x;if(typeof(t==null?void 0:t.tournamentRecords)!="object"||!Object.keys(t==null?void 0:t.tournamentRecords).length)return{error:ki};let{courts:e,venues:i}=Ku(t),r=Xu(t).schedulingProfile,{sortDateMatchUps:n=!0,courtCompletedMatchUps:a,alwaysReturnCompleted:o,activeTournamentId:s,tournamentRecords:l,withCourtGridRows:u,minCourtGridRows:c,usePublishState:d,status:p=qa,sortCourtsData:m}=t,h=s??qm()??Object.keys(l)[0],f=d?lb({tournamentRecord:l[h],status:p}):void 0,g=o?BI({...t,matchUpFilters:{...t.matchUpFilters,matchUpStatuses:[qi]},contextFilters:t.contextFilters}).completedMatchUps:[];if(d&&!((N=f==null?void 0:f.orderOfPlay)!=null&&N.published))return{completedMatchUps:g,dateMatchUps:[],courtsData:[],venues:i};let v,y;d&&({drawIds:v,detailsMap:y}=mpe({tournamentRecords:l})),v!=null&&v.length&&(t.contextFilters||(t.contextFilters={}),(A=t.contextFilters)!=null&&A.drawIds?t.contextFilters.drawIds=t.contextFilters.drawIds.filter(F=>v.includes(F)):t.contextFilters.drawIds=v),(M=f==null?void 0:f.eventIds)!=null&&M.length&&(t.matchUpFilters||(t.matchUpFilters={}),(C=t.matchUpFilters)!=null&&C.eventIds&&t.matchUpFilters.eventIds.length?t.matchUpFilters.eventIds=t.matchUpFilters.eventIds.filter(F=>f.eventIds.includes(F)):t.matchUpFilters.eventIds=f.eventIds),(O=f==null?void 0:f.scheduledDates)!=null&&O.length&&(t.matchUpFilters||(t.matchUpFilters={}),t.matchUpFilters.scheduledDates&&t.matchUpFilters.scheduledDates.length?t.matchUpFilters.scheduledDates=t.matchUpFilters.scheduledDates.filter(F=>f.scheduledDates.includes(F)):t.matchUpFilters.scheduledDates=f.scheduledDates),o&&(t.matchUpFilters||(t.matchUpFilters={}),(x=(k=t.matchUpFilters)==null?void 0:k.excludeMatchUpStatuses)!=null&&x.length?t.matchUpFilters.excludeMatchUpStatuses.includes(qi)||t.matchUpFilters.excludeMatchUpStatuses.push(qi):t.matchUpFilters.excludeMatchUpStatuses=[qi]);let{completedMatchUps:I,upcomingMatchUps:b,pendingMatchUps:S,groupInfo:w,mappedParticipants:U}=BI({...t,matchUpFilters:t.matchUpFilters,contextFilters:t.contextFilters}),T=[...b??[],...S??[]];y&&(!(v!=null&&v.length)||Object.keys(y).length)&&(T=T.filter(F=>{var B,V;let{drawId:$,structureId:_,stage:L}=F;if(!((V=(B=y==null?void 0:y[$])==null?void 0:B.publishingDetail)!=null&&V.published))return!1;if(y[$].stageDetails){let G=Object.keys(y[$].stageDetails),j=G.filter(W=>!y[$].stageDetails[W].published),z=G.filter(W=>y[$].stageDetails[W].published);return j.length&&j.includes(L)?!1:z.length&&z.includes(L)?!0:j.length&&!j.includes(L)&&!z.length}if(y[$].structureDetails){let G=Object.keys(y[$].structureDetails),j=G.filter(W=>!y[$].structureDetails[W].published),z=G.filter(W=>y[$].structureDetails[W].published);return j.length&&j.includes(_)?!1:z.length&&z.includes(_)?!0:j.length&&!j.includes(_)&&!z.length}return!0}));let D=n?$S({matchUps:T,schedulingProfile:r}):T,P=e==null?void 0:e.map(F=>{let $=R(F);return{surfaceCategory:(F==null?void 0:F.surfaceCategory)??"",matchUps:$,...F}}),E={completedMatchUps:o?g:I,mappedParticipants:t.hydrateParticipants?void 0:U,dateMatchUps:D,courtsData:P,groupInfo:w,venues:i};if(u){let{rows:F,courtPrefix:$}=yD({minRowsCount:c,courtsData:P});E.courtPrefix=$,E.rows=F}return{...E,...J};function R({courtId:F}){let $=(a?D.concat(I??[]):D).filter(_=>{var L,B,V;return((L=_.schedule)==null?void 0:L.courtId)===F||((V=(B=_.schedule)==null?void 0:B.allocatedCourts)==null?void 0:V.map(({courtId:G})=>G).includes(F))});return m?$S({matchUps:$,schedulingProfile:r}):$}}function TD({tournamentRecords:t,tournamentId:e}){if(typeof t!="object"||!Object.keys(t).length)return{error:ki};let i=Object.keys(t).filter(n=>!e||n===e),r;return i.forEach(n=>{let a=t[n],{matchUpDailyLimits:o}=hpe({tournamentRecord:a});r=o}),{matchUpDailyLimits:r}}function hpe(t){var s;let e=ze(t,[{[wr]:!0}]);if(e.error)return e;let{tournamentRecord:i}=t,{policy:r}=hp({policyType:Hc,tournamentRecord:i}),{extension:n}=gt({element:i,name:jy}),a=(s=n==null?void 0:n.value)==null?void 0:s.dailyLimits,o=r==null?void 0:r.defaultDailyLimits;return{matchUpDailyLimits:a||o}}function yk(t){var A,M,C,O;let{matchUps:e}=t,{singlesForDoubles:i,tournamentRecord:r,drawDefinition:n,excludeMargin:a,exclusionRule:o,zoneDoubling:s,matchUpType:l,scaleName:u,eventId:c,zonePct:d,drawId:p,event:m}=t;if(!r&&!e)return{error:ge};if(l&&![ti,Zt].includes(l))return{error:oe,info:{matchUpType:l}};if(e&&!wo(e))return{error:oe,context:{matchUps:e}};let h=Nr[u],f=(h==null?void 0:h.ascending)??t.ascending??!1,g=(h==null?void 0:h.accessor)??t.valueAccessor,v=Array.isArray(h==null?void 0:h.range)?Math.abs(h.range[0]-h.range[1]):0,y=ot(d)&&v?(d??0/100)*v:t.zoneMargin??v,I={withScaleValues:!0,withCompetitiveness:!0},b={matchUpTypes:l?[l]:[ti,Zt]},S=r==null?void 0:r.participants;(A=e==null?void 0:e[0])!=null&&A.hasContext?p?e=e.filter(k=>k.drawId===p):c&&(e=e.filter(k=>k.eventId===c)):e===void 0&&(e=p&&!n&&[]||!p&&c&&!m&&[]||p&&((M=Sn({inContext:!0,drawDefinition:n,contextFilters:b,contextProfile:I,participants:S}))==null?void 0:M.matchUps)||!p&&c&&((C=tu({inContext:!0,contextFilters:b,contextProfile:I,participants:S,event:m}))==null?void 0:C.matchUps)||((O=Vr({tournamentRecord:r,contextFilters:b,contextProfile:I}))==null?void 0:O.matchUps)||[]),l&&(e=e.filter(k=>k.matchUpType===l));let w=e.filter(({winningSide:k,score:x,sides:F,matchUpStatus:$})=>![mn,Mt,zt,Fg,$a].includes($??"")&&Ir({score:x})&&(F==null?void 0:F.length)===2&&k),U=gpe({matchUps:w,excludeMargin:a,exclusionRule:o,valueAccessor:g,ascending:f,scaleName:u}),T=!s||Yi(ti)(l)?y:(y||0)*2,D=y?w.map(({competitiveProfile:k,matchUpType:x,score:F,sides:$})=>{let _=o4({singlesForDoubles:i,valueAccessor:g,matchUpType:x,scaleName:u,sides:$}),L=Math.abs(_[0].value-_[1].value);return{competitiveness:k==null?void 0:k.competitiveness,valuesGap:L,score:F}}).filter(({valuesGap:k})=>k<=T):[],P=fpe({zoneData:D}),E=P&&[].concat(Object.values(P)).flat().length,R=E&&Object.assign({},...Object.keys(P).map(k=>({[k]:Math.round(1e4*P[k].length/E)/100}))),N=w.length-((D==null?void 0:D.length)||0);return{...J,relevantMatchUps:w,zoneDistribution:R,zoneData:D,accuracy:U,nonZone:N}}function fpe({zoneData:t}){let e={[kA]:[],[kI]:[],[xI]:[]};for(let i of t){let{competitiveness:r,score:n,valuesGap:a}=i;e[r]&&e[r].push({score:n,valuesGap:a})}return e}function o4({singlesForDoubles:t,exclusionRule:e,valueAccessor:i,matchUpType:r,scaleName:n,sides:a}){let o=e==null?void 0:e.range.sort(),s=l=>{let u=l==null?void 0:l[e==null?void 0:e.valueAccessor];return{exclude:e&&u>=o[0]&&u<=o[1],exclusionValue:u}};return a.sort((l,u)=>l.sideNumber-u.sideNumber).map(({participant:l})=>{let u=[],c=l==null?void 0:l.individualParticipants;if(c!=null&&c.length){let d=[],p=0;for(let m of c){let{scaleValue:h,value:f}=lV({singlesForDoubles:t,valueAccessor:i,participant:m,matchUpType:r,scaleName:n}),{exclude:g,exclusionValue:v}=s(h);g&&u.push(v),d.push(h),f&&!isNaN(p)?p+=f:p=void 0}return{participantName:l.participantName,exclusionValues:u,scaleValues:d,value:p}}else if(l){let{scaleValue:d,value:p}=lV({singlesForDoubles:t,valueAccessor:i,matchUpType:r,participant:l,scaleName:n}),{exclude:m,exclusionValue:h}=s(d);return m&&u.push(h),{participantName:l.participantName,exclusionValues:u,scaleValue:d,value:p}}else return{}})}function lV({singlesForDoubles:t,valueAccessor:e,matchUpType:i,participant:r,scaleName:n}){var u,c,d,p,m;let a=t?ti:i,o=(c=(u=r==null?void 0:r.rankings)==null?void 0:u[a])==null?void 0:c.find(h=>h.scaleName===n),s=(m=((p=(d=r==null?void 0:r.ratings)==null?void 0:d[a])==null?void 0:p.find(h=>h.scaleName===n))||o)==null?void 0:m.scaleValue,l=e?s==null?void 0:s[e]:s;return{scaleValue:s,value:l}}function gpe({excludeMargin:t,exclusionRule:e,valueAccessor:i,ascending:r,scaleName:n,matchUps:a}){let o={affirmative:[],negative:[],excluded:[]};for(let u of a){let{matchUpType:c,sides:d,score:p,winningSide:m}=u;if(!m)continue;if(e&&(!e.valueAccessor||!e.range))return{info:"exclusionRule requires valueAccessor and range",error:Xe};let h=m-1,f=o4({exclusionRule:e,valueAccessor:i,matchUpType:c,scaleName:n,sides:d});if(e){let S=f.map(({exclusionValues:w})=>w).flat();if(S.length){o.excluded.push({scoreString:p==null?void 0:p.scoreStringSide1,exclusionValues:S,winningSide:m,sideValues:f});continue}}if(f.filter(S=>![void 0,"",null].includes(S.value)).length<2){o.excluded.push({scoreString:p==null?void 0:p.scoreStringSide1,missingValues:!0,winningSide:m,sideValues:f});continue}let g=f[h].value-f[1-h].value,v=parseFloat(t||0),y=v&&Math.abs(g)<v;if(y){o.excluded.push({scoreString:p==null?void 0:p.scoreStringSide1,excludeMargin:t,winningSide:m,excludeGap:y,sideValues:f,valuesGap:g});continue}let I=r?g:g*-1,b=m===1?p==null?void 0:p.scoreStringSide1:p==null?void 0:p.scoreStringSide2;I>0?o.affirmative.push({winningScoreString:b,winningSide:m,sideValues:f,valuesGap:g,score:p}):o.negative.push({winningScoreString:b,winningSide:m,sideValues:f,valuesGap:g,score:p})}let s=o.affirmative.length+o.negative.length,l=s&&o.affirmative.length/s*100;return o.percent=l?Math.round(100*l)/100:0,o}function hh({collectionDefinitions:t=[],collectionGroups:e=[]}){let i=0,{groupValueNumbers:r}=d3({collectionGroups:e}),n;for(let a of t||[]){let{collectionValueProfiles:o,collectionGroupNumber:s,collectionValue:l,matchUpCount:u,matchUpValue:c,scoreValue:d,setValue:p}=a,m=s&&r.includes(s);if(ot(p||d))n=!0;else{if(m)continue;if(typeof l=="number"&&ot(l))i+=l;else if(Array.isArray(o)&&(o!=null&&o.length))for(let h of o)i+=h.matchUpValue;else typeof c=="number"&&ot(c)&&(i+=(u??0)*c)}}for(let a of e)i+=a.groupValue??0;return n||!i?{aggregateValue:!0,...J}:{valueGoal:Math.floor(i/2)+1,...J}}function bk(t){let{timeStamp:e,schedule:i,matchUp:r}=t,n=ze(t,[{[Zl]:!0}]);if(n.error)return n;let{itemValue:a,timeStamp:o}=vp({timeItems:(r==null?void 0:r.timeItems)||[],itemType:$A});return!i||o&&e&&new Date(o).getTime()>new Date(e).getTime()?{homeParticipantId:a}:i}function wk({matchUps:t,matchUpId:e}){if(!wo(t))return{error:oe};let i=t.find(s=>s.matchUpId===e),{drawId:r,eventId:n,structureId:a,tournamentId:o}=i||{};return{matchUpId:e,drawId:r,eventId:n,structureId:a,tournamentId:o}}function qg(t,e){if(!Nt(t))return{error:oe};if(!Array.isArray(e))return{error:oe};let i={};for(let{param:r,error:n,attr:a}of e){let o=vpe({params:t,param:r,attr:a,error:n});if(o!=null&&o.error)return o;i[r]=o}return i}function vpe({params:t,param:e,attr:i,error:r}){if(e===fT&&Nt(t.drawDefinition)&&Ti(t.structureId)){let n=(t.drawDefinition.structures??[]).find(({structureId:a})=>a===t.structureId);return!n.length&&r?{error:r}:{structure:n}}if(e===Zl){let n=K6({...t,...i});return n.error&&r?{...n,error:r}:n}return{error:$r,info:{param:e}}}function Uk(t){var p,m;let{structureId:e,matchUpId:i,event:r}=t,n=t.drawDefinition,a=ze(t,[{[wr]:!0},{[oA]:{[pT]:!1,[fl]:!1,[zz]:!1,[Gc]:!1}}]);if(a[Vo])return a;let o=(p=qg(t,[{[Og]:Zl,[Vo]:Xe}]))==null?void 0:p.matchUp;if(i&&(o!=null&&o.error))return o;!n&&(o!=null&&o.drawDefinition)&&(n=o==null?void 0:o.drawDefinition);let s=o==null?void 0:o.structure;if(!s&&e&&!i){if(!n)return{error:xs};let h=et({drawDefinition:n,structureId:e});if(h.error)return h;s=h.structure}let l=s==null?void 0:s.matchUpFormat,u=n==null?void 0:n.matchUpFormat,c=r==null?void 0:r.matchUpFormat,d=((m=o==null?void 0:o.matchUp)==null?void 0:m.matchUpFormat)||l||u||c;return{structureDefaultMatchUpFormat:l,eventDefaultMatchUpFormat:c,drawDefaultMatchUpFormat:u,matchUpFormat:d}}function Sk({profileBands:t,tournamentRecord:e,matchUps:i}){if(!wo(i))return{error:ju};let r=!t&&hp({policyType:su,tournamentRecord:e}).policy,n=t||(r==null?void 0:r.profileBands)||xA[su].profileBands,a=i.filter(({winningSide:p})=>p),o=a.map(AW),s=(p,m)=>{let h=NW(m,n);return p[h]+=1,p},l=OW(o).reduce((p,m)=>s(p,m),{[kA]:0,[kI]:0,[xI]:0,[DW]:0}),u=Object.keys(l).reduce((p,m)=>(l[m]||0)+p,0),c=Object.keys(l).map(p=>{let m=parseFloat((l[p]/u).toFixed(4));return{[p]:m*100}}),d=a.filter(({matchUpStatus:p})=>p===AB).length;return c.push({[AB]:parseFloat((d/u).toFixed(4))*100}),{competitiveBands:Object.assign({},...c),...J}}var{stageOrder:uV}=Kae;function Ipe(t,e){return t.eventName.localeCompare(e.eventName)||t.eventId.localeCompare(e.eventId)||(uV[t==null?void 0:t.stage]||0)-(uV[e==null?void 0:e.stage]||0)||e.matchUpsCount-t.matchUpsCount||`${t.stageSequence}-${t.roundNumber}-${t.minFinishingSum}`.localeCompare(`${e.stageSequence}-${e.roundNumber}-${e.minFinishingSum}`)}function Tk({excludeScheduleDateProfileRounds:t,excludeScheduledRounds:e,excludeCompletedRounds:i,inContextMatchUps:r,tournamentRecords:n,schedulingProfile:a,tournamentRecord:o,withSplitRounds:s,matchUpFilters:l,scheduleDate:u,withRoundId:c,venueId:d,context:p}){var w;if(r&&!Array.isArray(r||typeof r[0]!="object"))return{error:oe,inContextMatchUps:r};if(o&&!n){if(typeof o!="object")return{error:Py};n={[o.tournamentId]:o}}let m=typeof n!="object"||!Object.keys(n).length;if((d||u||!r||!a&&(t||i||a||s))&&m)return{error:ki};let h=Object.assign({},...Object.values(n??{}).map(({venues:U=[],tournamentId:T})=>({[T]:U==null?void 0:U.map(({venueId:D})=>D)}))),f=Object.values(n??{}).map(({events:U=[],tournamentId:T,startDate:D,endDate:P})=>U.map(E=>({...E,validVenueIds:h[T],startDate:E.startDate??D,endDate:E.endDate??P}))).flat(),{segmentedRounds:g,profileRounds:v}=n&&(t||i||a||s)&&ID({tournamentRecords:n,schedulingProfile:a})||{},y=t&&Object.assign({},...v.map(U=>({[U.id]:U}))),I=r||n&&((w=Es({tournamentRecords:n,matchUpFilters:l}))==null?void 0:w.matchUps)||[],b=[],S=I&&Object.values(I.reduce((U,T)=>{var j;let D=a1(T).id,P=g==null?void 0:g[D],E=[...((j=U[D])==null?void 0:j.matchUps)??[],T],{containerStructureId:R,stageSequence:N,structureName:A,tournamentId:M,isRoundRobin:C,matchUpType:O,roundNumber:k,roundOffset:x,structureId:F,eventName:$,roundName:_,drawName:L,eventId:B,drawId:V}=T,G=C?R:F;return{...U,[D]:{id:c?D:void 0,structureId:G,stageSequence:N,segmentsCount:P,structureName:A,tournamentId:M,matchUpType:O,roundNumber:k,roundOffset:x,eventName:$,roundName:_,drawName:L,matchUps:E,eventId:B,drawId:V}}},{})).map(U=>{let{minFinishingSum:T,winnerFinishingPositionRange:D}=cpe(U.matchUps),P=U.segmentsCount;if(P){let k=U.matchUps.length/P;return Rr(U.matchUps.sort((x,F)=>x.roundPosition-F.roundPosition),k).map((x,F)=>{let{unscheduledCount:$,incompleteCount:_,matchUpsCount:L,isScheduled:B,isComplete:V,byeCount:G}=sV(x),j=oV({matchUps:U.matchUps,tournamentRecords:n,events:f,round:U});return Ge({...U,...p,roundSegment:{segmentsCount:P,segmentNumber:F+1},winnerFinishingPositionRange:D,unscheduledCount:$,incompleteCount:_,minFinishingSum:T,matchUpsCount:L,isScheduled:B,roundTiming:j,isComplete:V,byeCount:G,matchUps:x})})}let{unscheduledCount:E,incompleteCount:R,matchUpsCount:N,isScheduled:A,isComplete:M,byeCount:C}=sV(U.matchUps),O=oV({matchUps:U.matchUps,tournamentRecords:n,events:f,round:U});return Ge({...U,...p,winnerFinishingPositionRange:D,unscheduledCount:E,incompleteCount:R,minFinishingSum:T,matchUpsCount:N,isScheduled:A,roundTiming:O,isComplete:M,byeCount:C})}).flat().filter(U=>{if(t){let F=pt(t),$=c?U.id:a1(U).id;if(F&&y[$]&&pt(y[$].scheduleDate)===F)return!1}let{isComplete:T,isScheduled:D}=U,P=!i||!T,E=!e||!D,R=d||u?f==null?void 0:f.find(({eventId:F})=>F===U.eventId):void 0,N=(R==null?void 0:R.startDate)??(o==null?void 0:o.startDate),A=(R==null?void 0:R.endDate)??(o==null?void 0:o.endDate),M=!u||!N||new Date(u)>=new Date(N),C=!u||!A||new Date(u)<=new Date(A),O=M&&C,k=!d||(R==null?void 0:R.validVenueIds.includes(d)),x=P&&E&&k&&O;return x||b.push(U),x}).sort(Ipe)||[];return{...J,rounds:S,excludedRounds:b}}function VI(t){var V;let{matchUp:e,sideNumber:i,setNumber:r,isTiebreakValue:n,isPointValue:a}=t||{},{matchUpFormat:o}=t||{};if(!e)return{error:na};o=o||(e==null?void 0:e.matchUpFormat);let s=kn(o),l=!!(e!=null&&e.winningSide),u=(V=e.score)==null?void 0:V.sets,c=u==null?void 0:u.length,d=r&&r-1,p=!!(u!=null&&u.find((G,j)=>G.setNumber===r&&j===d)),m=(u==null?void 0:u.filter(G=>G==null?void 0:G.winningSide))||[],h=(m==null?void 0:m.length)||0,f=r&&(u==null?void 0:u.slice(r))||[],g=!!(c&&r&&(f!=null&&f.reduce((G,j)=>(!j||!j.side1Score&&!j.side2Score&&!j.side1TiebreakScore&&!j.side2TiebreakScore&&!j.side1PointScore&&!j.side2PointScore)&&G,!0))),v=r<=c&&u.find(G=>G.setNumber===r),y=v&&$I({setObject:v,matchUpScoringFormat:s}),{isCompletedSet:I,sideGameScores:b,sideTiebreakScores:S}=y||{},w=!!(v&&!I&&g||r&&r===c+1&&!l),U=[1,2].includes(i),T=U?i-1:0,D=v&&U&&(!n&&!a&&b[T]!==void 0&&b[T]||n&&S[T]!==void 0&&S[T]),P=!!D,E=m==null?void 0:m.map(G=>$I({setObject:G,matchUpScoringFormat:s}).isValidSetOutcome).reduce((G,j)=>G&&j,!0),R=m.reduce((G,j)=>{let{winningSide:z}=j,W=z-1;return G[W]++,G},[0,0]),N=e==null?void 0:e.winningSide,A=N&&N-1,M=1-A,C=R[A],O=R[M],k=Math.max(...R),x=wa(R)[k],{bestOf:F,exactly:$}=s??{},_=F&&Math.ceil(F/2)||$||1,L=k===_&&x===1&&R.indexOf(k)+1||void 0,B=C>O&&N===L;return{completedSetsHaveValidOutcomes:E,validMatchUpWinningSide:B,calculatedWinningSide:L,matchUpScoringFormat:s,validMatchUpOutcome:L&&E&&B,isLastSetWithValues:g,completedSetsCount:h,isCompletedMatchUp:l,isValidSideNumber:U,hasExistingValue:P,existingValue:D,isExistingSet:p,isActiveSet:w,...y}}function Dk({participants:t,tournamentAppliedPolicies:e,scheduleVisibilityFilters:i,participantsProfile:r,afterRecoveryTimes:n,policyDefinitions:a,useParticipantMap:o,tournamentRecord:s,usePublishState:l,contextFilters:u,contextContent:c,matchUpFilters:d,participantMap:p,publishStatus:m,contextProfile:h,drawDefinition:f,nextMatchUps:g,tournamentId:v,inContext:y,context:I,event:b}){let{eventId:S,eventName:w,endDate:U,eventType:T,category:D,gender:P}=b??{},E={...I,...Ge({surfaceCategory:(b==null?void 0:b.surfaceCategory)??(s==null?void 0:s.surfaceCategory),indoorOutDoor:(b==null?void 0:b.indoorOutdoor)??(s==null?void 0:s.indoorOutdoor),endDate:U??(b==null?void 0:b.endDate)??(s==null?void 0:s.endDate),tournamentId:v??(s==null?void 0:s.tournamentId),eventName:w,eventType:T,category:D,eventId:S,gender:P})},R;return!(t!=null&&t.length)&&s&&({participants:t,participantMap:p,groupInfo:R}=mp({participantsProfile:r,policyDefinitions:a,useParticipantMap:o,tournamentRecord:s,contextProfile:h,inContext:y})),b&&h&&!c&&(c=qu({policyDefinitions:a,tournamentRecord:s,contextProfile:h,drawDefinition:f,event:b})),{...$g({context:E,tournamentAppliedPolicies:e,scheduleVisibilityFilters:i,tournamentParticipants:t,participantsProfile:r,afterRecoveryTimes:n,policyDefinitions:a,tournamentRecord:s,usePublishState:l,participantMap:p,contextContent:c,contextFilters:u,matchUpFilters:d,publishStatus:m,contextProfile:h,drawDefinition:f,nextMatchUps:g,inContext:y,event:b}),groupInfo:R}}var s4={};yt(s4,{getCompetitionVenues:()=>Rb,getCourts:()=>Pk,getVenuesAndCourts:()=>Ku,publicFindVenue:()=>jA});function Pk({tournamentRecord:t,venueId:e,venueIds:i}){return t?{courts:(t.venues||[]).filter(r=>e?r.venueId===e:i?i.includes(r.venueId):!0).map(r=>{let{venueId:n}=r,a=Me(r.courts||[]);return a.forEach(o=>Object.assign(o,{venueId:n})),a}).flat()}:{error:ge}}var l4={};yt(l4,{categoryCanContain:()=>ky,getCategoryAgeDetails:()=>vm,getEvent:()=>Ck,getEventProperties:()=>Rk,getEventStructures:()=>GT,getEventTimeItem:()=>Wy,getEvents:()=>Ek,getFlightProfile:()=>Gi,getScaledEntries:()=>ph});function Rk({tournamentRecord:t,event:e}){var d,p;if(!t)return{error:ge};if(!e)return{error:gi};let i=e.entries||[],r=t.participants||[],n=((d=e.category)==null?void 0:d.categoryName)||((p=e.category)==null?void 0:p.ageCategoryCode),{eventType:a}=e,o=i.map(m=>m.participantId),s=r.filter(m=>o.includes(m.participantId)),l,u,c;return{entryScaleAttributes:s.map(m=>{var S,w,U,T,D,P;let{participantId:h,participantName:f,name:g}=m,v={scaleType:VA,eventType:a,scaleName:n},y=(w=(S=Cl({participant:m,scaleAttributes:v}))==null?void 0:S.scaleItem)==null?void 0:w.scaleValue;v={scaleType:jW,eventType:a,scaleName:n};let I=(T=(U=Cl({participant:m,scaleAttributes:v}))==null?void 0:U.scaleItem)==null?void 0:T.scaleValue;v={scaleType:VW,eventType:a,scaleName:n};let b=(P=(D=Cl({participant:m,scaleAttributes:v}))==null?void 0:D.scaleItem)==null?void 0:P.scaleValue;return l=!!(l||y),u=!!(u||I),c=!!(c||b),{participantId:h,participantName:f||g,seed:y,ranking:I,rating:b}}),hasSeededParticipants:l,hasRankedParticipants:u,hasRatedParticipants:c}}function Ek({tournamentRecord:t,withScaleValues:e,scaleEventType:i,inContext:r,eventIds:n,drawIds:a,context:o}){var c,d,p,m;if(!t)return{error:ge};let{tournamentId:s}=t,l=(t.events??[]).filter(({eventId:h})=>!n||Array.isArray(n)&&n.includes(h)).map(h=>{var v;let f=(v=h.drawDefinitions)==null?void 0:v.map(AI);if(a!=null&&a.length&&!Vi(a,f).length)return;let g=Me(h);return r&&Object.assign(g,{tournamentId:s}),o&&Object.assign(g,o),g}).filter(Boolean),u={};if(e){let h=Ni({withScaleValues:!0,tournamentRecord:t}).participantMap,f=g=>g.reduce((v,y)=>v+parseFloat(y),0);for(let g of l){let v=i??g.eventType,y=g.eventId;u[y]||(u[y]={ratingsStats:{},ratings:{},ranking:{},draws:{}});let I=(g.entries??[]).filter(({entryStatus:P})=>ls.includes(P)).map(Ut),b=P=>{var E,R,N,A,M,C;if((E=P==null?void 0:P.ratings)!=null&&E[v])for(let O of((R=P==null?void 0:P.ratings)==null?void 0:R[v])??[]){let k=O.scaleName;u[y].ratings[k]||(u[y].ratings[k]=[]);let x=(N=Nr[k])==null?void 0:N.accessor;if(x){let F=parseFloat((A=O.scaleValue)==null?void 0:A[x]);F&&u[y].ratings[k].push(F)}}if((M=P==null?void 0:P.rankings)!=null&&M[v])for(let O of((C=P==null?void 0:P.rankings)==null?void 0:C[v])??[]){let k=O.scaleName;u[y].ranking[k]||(u[y].ranking[k]=[]),O.scaleValue&&u[y].ranking[k].push(O.scaleValue)}};for(let P of I){let E=(c=h==null?void 0:h[P])==null?void 0:c.participant;if((E==null?void 0:E.participantType)!==St)for(let R of(E==null?void 0:E.individualParticipantIds)??[]){let N=(d=h==null?void 0:h[R])==null?void 0:d.participant;b(N)}else b(E)}let S=u[y].ratings;for(let P of Object.keys(S)){let E=S[P];if(!E.length)continue;let R=(p=wB(E))==null?void 0:p.toFixed(2);u[y].ratingsStats[P]={avg:parseFloat((f(E)/E.length).toFixed(2)),median:R?parseFloat(R):void 0,max:Math.max(...E),min:Math.min(...E)}}let w=(P,E)=>{var N,A;let R=M=>{var C,O,k,x,F,$,_,L,B,V;if((C=u[y].draws)!=null&&C[P]&&((O=M==null?void 0:M.ratings)!=null&&O[v]))for(let G of((k=M==null?void 0:M.ratings)==null?void 0:k[v])??[]){let j=G.scaleName;(x=u[y].draws[P])!=null&&x.ratings[j]||(u[y].draws[P].ratings[j]=[]);let z=(F=Nr[j])==null?void 0:F.accessor;if(z){let W=parseFloat(($=G.scaleValue)==null?void 0:$[z]);W&&u[y].draws[P].ratings[j].push(W)}}if((_=u[y].draws)!=null&&_[P]&&((L=M==null?void 0:M.rankings)!=null&&L[v]))for(let G of((B=M==null?void 0:M.rankings)==null?void 0:B[v])??[]){let j=G.scaleName;(V=u[y].draws[P])!=null&&V.ranking[j]||(u[y].draws[P].ranking[j]=[]);let z=G.scaleValue;z&&u[y].draws[P].ranking[j].push(z)}};for(let M of E.filter(Boolean)){let C=(N=h==null?void 0:h[M])==null?void 0:N.participant;if((C==null?void 0:C.participantType)!==St)for(let O of(C==null?void 0:C.individualParticipantIds)??[]){let k=(A=h==null?void 0:h[O])==null?void 0:A.participant;R(k)}else R(C)}},U=[],T=P=>(a==null?void 0:a.length)&&a.includes(P)||U.includes(P);for(let P of g.drawDefinitions??[]){let E=P.drawId;if(T(E))continue;let R=Ip({drawDefinition:P}).assignedParticipantIds??[];u[y].draws[E]||(u[y].draws[E]={ratingsStats:{},ratings:{},ranking:{}}),U.push(E),w(E,R)}let D=Gi({event:g}).flightProfile;for(let P of(D==null?void 0:D.flights)??[]){let E=P.drawId;if(T(E))continue;let R=P.drawEntries.map(Ut);w(E,R)}for(let P of U){let E=u[y].draws[P].ratings;for(let R of Object.keys(E)){let N=E[R];if(!N.length)continue;let A=(m=wB(N))==null?void 0:m.toFixed(2);u[y].draws[P].ratingsStats[R]={avg:parseFloat((f(N)/N.length).toFixed(2)),median:A?parseFloat(A):void 0,max:Math.max(...N),min:Math.min(...N)}}}}}return Ge({eventScaleValues:u,events:l,...J})}function Ck({tournamentRecord:t,drawDefinition:e,context:i,event:r}){var o;if(!t)return{error:ge};if(!r)return{error:gi};let n=Me(r);i&&Object.assign(n,i);let a=e&&((o=n.drawDefinitions)==null?void 0:o.find(({drawId:s})=>e.drawId===s));return Ge({drawDefinition:a,event:n})}function ype(t){var m,h;let e="validateAndDeriveDrawValues",{appliedPolicies:i,policyDefinitions:r}=Upe(t),n=Spe({...t,policyDefinitions:r,appliedPolicies:i}),a=wpe(t),o=Tpe({...t,consideredEntries:a,appliedPolicies:i});if(o!=null&&o.error)return ee({result:o,stack:e});let s=Dpe({...t,consideredEntries:a}),l=bpe({...t,appliedPolicies:i,policyDefinitions:r,drawSize:s});if(l.error)return ee({result:l,stack:e});let u=l.drawType;if(isNaN(s)&&u!==La)return ee({result:{error:Ey},stack:e});let c=(r==null?void 0:r[hs])??(i==null?void 0:i[hs]),d=t.seedingProfile??((h=(m=c==null?void 0:c.seedingProfile)==null?void 0:m.drawTypes)==null?void 0:h[u??""])??(c==null?void 0:c.seedingProfile);t.seedingProfile&&(r[hs]||(r[hs]={...n1[hs]}),r[hs].seedingProfile=d);let p=Ppe({...t,drawType:u});return p!=null&&p.error?ee({result:p,stack:e}):{drawSize:s,drawType:u,enforceGender:n,seedingProfile:d,appliedPolicies:i,policyDefinitions:r}}function bpe(t){let{policyDefinitions:e,appliedPolicies:i,enforceMinimumDrawSize:r=!0,drawSize:n}=t,a=t.drawTypeCoercion??Tb({drawType:t.drawType,policyDefinitions:e,appliedPolicies:i}),o=L3({drawType:t.drawType,enforceMinimumDrawSize:r,drawTypeCoercion:a,drawSize:n});return o.error?o:{drawType:o.drawType}}function u4(t){return t==null?void 0:t.filter(e=>e.entryStatus&&[...ls,Zy].includes(e.entryStatus))}function wpe({considerEventEntries:t=!0,drawEntries:e,eventEntries:i,qualifyingOnly:r}){return(r&&[]||u4(e)||(t?i:[])).filter(({entryStage:n})=>!n||n===Oe)}function Upe(t){let{tournamentRecord:e,event:i}=t,r=$t({tournamentRecord:e,event:i}).appliedPolicies??{},n=Me(t.policyDefinitions??{},!1,!0);return{appliedPolicies:r,policyDefinitions:n}}function Spe({enforceGender:t,policyDefinitions:e,appliedPolicies:i}){var r,n,a,o;return t??((n=(r=e==null?void 0:e[kr])==null?void 0:r.participants)==null?void 0:n.enforceGender)??((o=(a=i==null?void 0:i[kr])==null?void 0:a.participants)==null?void 0:o.enforceGender)}function Tpe(t){let{consideredEntries:e,appliedPolicies:i,policyDefinitions:r,enforceGender:n,participantMap:a,participants:o,event:s}=t;return s&&o&&eD({consideredEntries:e,policyDefinitions:r,appliedPolicies:i,participantMap:a,enforceGender:n,participants:o,event:s})}function Dpe(t){return!t.drawSize&&t.consideredEntries.length&&![La,Fy,Ag,Jo,Gl].includes(t.drawType??"")&&Sg(t.consideredEntries.length)||t.drawSize&&Qe(t.drawSize)||!1}function Ppe(t){var o,s;let{tournamentRecord:e,event:i,ignoreAllowedDrawTypes:r,drawType:n}=t,a=!r&&e&&uD({tournamentRecord:e,categoryType:(o=i==null?void 0:i.category)==null?void 0:o.categoryType,categoryName:(s=i==null?void 0:i.category)==null?void 0:s.categoryName});return a!=null&&a.length&&!a.includes(n)?{error:mN}:{...J}}function Ab(t){let{voluntaryConsolation:e,tournamentRecord:i,event:r}=t,n="generateDrawDefinition",{participants:a,participantMap:o}=Ni({withIndividualParticipants:!0,convertExtensions:!0,internalUse:!0,tournamentRecord:i}),s=u4(r==null?void 0:r.entries)??[],l=ype({...t,participantMap:o,participants:a,eventEntries:s});if(l.error)return ee({result:l,stack:n});let{appliedPolicies:u,policyDefinitions:c,drawSize:d,drawType:p,enforceGender:m,seedingProfile:h}=l,f=r==null?void 0:r.eventType,g=t.matchUpType??f,v=Sde({...t,enforceGender:m,eventType:f,matchUpType:g});if(v.error)return ee({result:v,stack:n});let{matchUpFormat:y,tieFormat:I}=v;if(t.drawId&&typeof t.drawId!="string")return ee({result:{error:oe},stack:n});let b=Qde({...t,policyDefinitions:c,tournamentRecord:i,appliedPolicies:u,matchUpFormat:y,seedingProfile:h,participants:a,eventEntries:s,matchUpType:g,tieFormat:I,drawSize:d,drawType:p,event:r});if(b.error)return ee({result:b,stack:n});let{existingDrawDefinition:S,positioningReports:w,drawDefinition:U,structureId:T,conflicts:D,entries:P}=b;if(!U)return ee({result:{error:oe},stack:n});let E=Zde({...t,existingDrawDefinition:S,positioningReports:w,appliedPolicies:u,drawDefinition:U,seedingProfile:h,participants:a,structureId:T,entries:P,params:t,stack:n});if(E.error)return E;let{qualifyingConflicts:R}=E;return U.drawName=t.drawName??(p&&Zr(p)),d&&typeof e=="object"&&d>=4&&ZA({...e,drawDefinition:U,matchUpType:g}),{existingDrawDefinition:!!S,qualifyingConflicts:R,positioningReports:w,drawDefinition:U,structureId:T,...J,conflicts:D}}function c4({scaleAttributes:t,scaledEntries:e,stageEntries:i,seedsCount:r,scaleName:n}){if(!t)return{error:Xe,info:"missing scaleAttributes"};let a=Object.assign({},...(e||[]).slice(0,r).map(({participantId:s},l)=>({[s]:l+1})));n=n||t.scaleName;let o=new Date().toISOString();return{scaleItemsWithParticipantIds:i.map(({participantId:s})=>({scaleItems:[{scaleValue:a[s],eventType:t.eventType,scaleType:Rl,scaleName:n,scaleDate:o}],participantId:s}))}}function Rpe({tournamentRecord:t,drawDefinition:e,policyDefinitions:i,scaleAttributes:r,scaleName:n,drawSize:a,drawId:o,event:s,stage:l,sortDescending:u,scaleSortMethod:c}){let d=bD({policyDefinitions:i,drawDefinition:e,drawSize:a,drawId:o,event:s,stage:l});if(d.error)return d;let{entries:p,seedsCount:m,stageEntries:h}=d;if(!h||!m)return{error:oe};let f=ph({tournamentRecord:t,scaleAttributes:r,scaleSortMethod:c,sortDescending:u,entries:p,stage:l}).scaledEntries??[],{scaleItemsWithParticipantIds:g}=c4({scaleAttributes:r,scaledEntries:f,stageEntries:h,seedsCount:m,scaleName:n});return{scaleItemsWithParticipantIds:g}}var d4={};yt(d4,{addDrawEntries:()=>YA,addEventEntries:()=>zs,addEventEntryPairs:()=>g4,destroyPairEntries:()=>mq,destroyPairEntry:()=>QA,getEntriesAndSeedsCount:()=>bD,getMaxEntryPosition:()=>hk,modifyEntriesStatus:()=>PS,modifyEventEntries:()=>v4,mutate:()=>p4,promoteAlternate:()=>h4,promoteAlternates:()=>Nk,query:()=>r4,removeDrawEntries:()=>f4,removeEventEntries:()=>cb,setEntryPosition:()=>Mk,setEntryPositions:()=>m4});var p4={};yt(p4,{addDrawEntries:()=>YA,addEventEntries:()=>zs,addEventEntryPairs:()=>g4,destroyPairEntries:()=>mq,destroyPairEntry:()=>QA,modifyEntriesStatus:()=>PS,modifyEventEntries:()=>v4,promoteAlternate:()=>h4,promoteAlternates:()=>Nk,removeDrawEntries:()=>f4,removeEventEntries:()=>cb,setEntryPosition:()=>Mk,setEntryPositions:()=>m4});function Mk({tournamentRecord:t,drawDefinition:e,participantId:i,entryPosition:r,skipRefresh:n,event:a}){let o="setEntryPositions";if(!t)return{error:ge};if(!i)return ee({result:{error:pr},stack:o});if(r!==void 0&&!Number.isSafeInteger(r))return{error:oe,entryPosition:r};((a==null?void 0:a.entries)||[]).forEach(l=>{l.participantId===i&&(l.entryPosition=r)}),((e==null?void 0:e.entries)||[]).forEach(l=>{l.participantId===i&&(l.entryPosition=r)});let s=l=>{l.entries.forEach(u=>{u.entryPosition===r&&u.participantId!==i&&(u.entryPosition+=.1)})};return n||(a!=null&&a.entries&&(s(a),a.entries=bs({entries:a.entries})),e!=null&&e.entries&&(s(e),e.entries=bs({entries:e.entries}))),{...J}}function m4({tournamentRecord:t,entryPositions:e,drawDefinition:i,event:r}){if(!t)return{error:ge};if(!Array.isArray(e))return{error:oe};for(let n of e){let{participantId:a,entryPosition:o}=n,s=Mk({skipRefresh:!0,tournamentRecord:t,drawDefinition:i,participantId:a,entryPosition:o,event:r});if(s.error)return s}return r!=null&&r.entries&&(r.entries=bs({entries:r.entries})),i!=null&&i.entries&&(i.entries=bs({entries:i.entries})),{...J}}function h4(t){let{participantId:e}=t;return e&&typeof e!="string"?{error:oe,participantId:e}:Nk({...t,participantIds:[e].filter(Boolean)})}function Nk({tournamentRecord:t,drawDefinition:e,participantIds:i,stageSequence:r,stage:n=Oe,eventId:a,event:o}){if(!t)return{error:ge};if(!Array.isArray(i))return{error:oe,participantIds:i};if(!o)return{error:gi};let s="promoteAlternates";if(o){let l=cV({element:o,participantIds:i,stageSequence:r,stage:n});if(l.error)return l}if(e){let l=cV({element:e,participantIds:i,stageSequence:r,stage:n});if(l.error)return a?ee({context:{drawPromotionError:l.error,drawId:e.drawId},result:{...J},stack:s}):l}return{...J}}function cV({participantIds:t,stageSequence:e,element:i,stage:r}){let n=(i.entries||[]).filter(d=>d.entryStatus===jo),a=(i.entries||[]).filter(d=>t.includes(d.participantId)),o=n.reduce((d,p)=>{let{entryPosition:m}=p;return isNaN(m)&&d||(!d||m<d.entryPosition)&&p||d},void 0),s=a.length?a:[o].filter(Boolean);if(!(s!=null&&s.length))return{error:sH};let l=s.filter(({entryStatus:d})=>d!==jo);if(l.length)return{error:UC,invalidEntryStatus:l};let u=s.filter(({entryStage:d})=>d&&d!==r);if(u.length)return{error:$ne,invalidStage:u};let c=e&&s.filter(d=>d.stageSequence!==e);if(c!=null&&c.length)return{error:Bne,invalidStageSequence:c};for(let d of s){d.entryStatus=oa;let p=d==null?void 0:d.entryPosition;isNaN(p)||i.entries.forEach(h=>{h.entryStatus===jo&&h.entryPosition>p&&(h.entryPosition=h.entryPosition-1)});let m=Math.max(...i.entries.filter(h=>h.entryStatus===oa&&!isNaN(h.entryPosition)).map(({entryPosition:h})=>Qe(h||0)),0);d.entryPosition=m||0}return{...J}}function f4({autoEntryPositions:t=!0,participantIds:e,drawDefinition:i,drawId:r,stages:n,event:a}){var c;if(!a)return{error:gi};if(!r)return{error:xs};if(!(e!=null&&e.length))return{error:Vc};let o=Ip({drawDefinition:i,stages:n}).assignedParticipantIds??[];if(Rn(o,e))return{error:Eg};let s=d=>{let p=d.participantId;return!e.includes(p)},{flightProfile:l}=Gi({event:a}),u=(c=l==null?void 0:l.flights)==null?void 0:c.find(d=>d.drawId===r);return u!=null&&u.drawEntries&&(u.drawEntries=u.drawEntries.filter(s),t&&(u.drawEntries=bs({entries:u.drawEntries}))),i!=null&&i.entries&&(i.entries=i.entries.filter(s),t&&(i.entries=bs({entries:i.entries}))),{...J}}function al(t){var f,g,v,y,I;let e="addParticipant",{allowDuplicateParticipantIdPairs:i,returnParticipant:r,disableNotice:n,pairOverride:a,participant:o}=t,s=t.tournamentId?(f=t.tournamentRecords)==null?void 0:f[t.tournamentId]:t.tournamentRecord??(t.activeTournamentId&&((g=t.tournamentRecords)==null?void 0:g[t.activeTournamentId]));if(!s)return{error:ge};if(!o)return ee({result:{error:zm},stack:e});o.participantId||(o.participantId=Gt()),s.participants||(s.participants=[]);let{participantId:l,individualParticipantIds:u}=o;if(s.participants.reduce((b,S)=>S.participantId===l||b,!1))return{error:iH};let{participantType:c,participantRole:d}=o;if(!c||!Object.keys(qv).includes(c))return{error:Ds,participantType:c};if(!d)return{error:tH};let p=s.participants||[],m=p.filter(b=>b.participantType===St).map(b=>b.participantId);if(c!==St&&o.person)return{error:oe,person:o.person};if(u&&!Array.isArray(u))return{error:oe,individualParticipantIds:u};if(c===ht){if(o.person)return{error:oe,person:o.person};if(o.individualParticipantIds){if(o.individualParticipantIds.length!==2&&!a)return ee({info:"PAIR must be 2 individualParticipantIds",result:{error:va},stack:e});{let w=p.filter(U=>U.participantType===St).map(U=>U.participantId);if(!Array.isArray(o.individualParticipantIds))return ee({result:{error:va},stack:e});if(!o.individualParticipantIds.reduce((U,T)=>w.includes(T)&&U,!0))return ee({result:{error:va},stack:e})}}else return ee({result:{error:Vc},stack:e});let b=p.filter(w=>w.participantType===ht).map(w=>({individualParticipantIds:w.individualParticipantIds,participant:w})),S=o.participantType===ht&&b.find(w=>Vi(w.individualParticipantIds,o.individualParticipantIds).length===2);if(S&&!i)return{...J,existingParticipant:!0,participant:r&&Me(S.participant)};if(!o.participantName){let w=p.filter(T=>{var D;return(D=o.individualParticipantIds)==null?void 0:D.includes(T.participantId)}),U=w.map(T=>{var D;return(D=T.person)==null?void 0:D.standardFamilyName}).filter(Boolean).join("/");w.length===1&&(U+="/Unknown"),o.participantName=U}}else if(c===St){if(!((v=o.person)!=null&&v.standardFamilyName)||!((y=o.person)!=null&&y.standardGivenName))return{error:oH};if(!o.participantName){let b=`${o.person.standardFamilyName.toUpperCase()}, ${o.person.standardGivenName}`;o.participantName=b}}else if(c&&[Kt,Wa].includes(c)){if(u||(o.individualParticipantIds=[]),(I=o.individualParticipantIds)==null?void 0:I.length)for(let b of o.individualParticipantIds){if(typeof b!="string")return ee({result:{participantId:b,error:oe},stack:e});if(!m.includes(b))return ee({result:{participantId:b,error:zi},stack:e})}}else return{error:Ds};s.participants.push(o),n||lt({payload:{tournamentId:s.tournamentId,participants:[o]},topic:Tc});let h={participant:r&&Me(o),...J};return Ge(h)}function ts({allowDuplicateParticipantIdPairs:t,returnParticipants:e,tournamentRecord:i,participants:r=[]}){if(!i)return{error:ge};i.participants||(i.participants=[]);let n=i.participants.map(d=>d.participantId)||[];r.forEach(d=>{d.participantId||(d.participantId=Gt())});let a=r.filter(d=>!n.includes(d.participantId)),o=r.filter(d=>n.includes(d.participantId)),s=a.filter(d=>d.participantType===St),l=a.filter(d=>d.participantType!==St),u=s.concat(...l),c=[];if(u.length){for(let p of u){let m=al({allowDuplicateParticipantIdPairs:t,returnParticipant:!0,disableNotice:!0,tournamentRecord:i,participant:p});if(m.error)return m;m.success&&!m.existingParticipant&&c.push(m.participant)}c.length&&lt({topic:Tc,payload:{tournamentId:i.tournamentId,participants:c}});let d={participants:e&&Me(c),addedCount:c.length,...J};return o.length&&Object.assign(d,{notAdded:o,info:Y0}),Ge(d)}else return{info:"No new participants to add",addedCount:0,...J}}function g4(t){let e=ze(t,[{[wr]:!0,[Gc]:!0}]);if(e.error)return e;let{allowDuplicateParticipantIdPairs:i,entryStatus:r=jo,participantIdPairs:n=[],entryStage:a=Oe,tournamentRecord:o,drawDefinition:s,event:l,uuids:u}=t;if(l.eventType!==Zt)return{error:Bl};let c=[],d=new Map;for(let b of o.participants??[]){let{participantType:S,participantId:w,person:U,individualParticipantIds:T}=b;S===St&&(U!=null&&U.sex)?d.set(w,U.sex):S===ht&&T&&c.push(T)}let p=n.filter(b=>{if(b.length!==2)return!0;if(!l.gender||l.gender===Ps)return!1;if(!d.has(b[0])||!d.has(b[1]))return!0;let S=b.map(U=>d.get(U)),w=l.gender===Jt&&(S[0]!==Jt||S[1]!==Jt)||l.gender===pi&&(S[0]!==pi||S[1]!==pi);return l.gender===Bn&&(S.sort($T),(S[0]!==pi||S[1]!==Jt)&&(w=!0)),w});if(p.length)return{error:va,invalidParticipantIdPairs:p};let m=n.map(b=>({participantId:(u==null?void 0:u.pop())??Gt(),participantRole:Qr,individualParticipantIds:b,participantType:ht})),h=i?m:m.filter(b=>!c.find(S=>Vi(S,b.individualParticipantIds).length===2)),f,g=[];if(h){let b=ts({allowDuplicateParticipantIdPairs:i,participants:h,returnParticipants:!0,tournamentRecord:o});if(b.error)return b;g=b.participants||[],f=b.info}let v=n.map(b=>{let S=g.find(U=>Vi(U.individualParticipantIds,b).length===2);if(S)return S;let{participant:w}=es({tournamentRecord:o,participantIds:b});return w}).map(b=>b.participantId),y=zs({participantIds:v,tournamentRecord:o,drawDefinition:s,entryStatus:r,entryStage:a,event:l});h.length&&lt({payload:{participants:h},topic:Tc});let I=h.map(Ut);return{...y,info:f,newParticipantIds:I}}function v4({entryStatus:t=oa,unpairedParticipantIds:e=[],participantIdPairs:i=[],entryStage:r=Oe,tournamentRecord:n,event:a}){if(!n)return{error:ge};if(!a)return{error:gi};let o=n.participants??[],s=o.filter(f=>f.participantType===St).map(f=>f.participantId),l=e.concat(...i).flat(1/0).filter(f=>!s.includes(f));if(l.length)return{error:va,invalidParticipantIds:l};let u=i.filter(f=>f.length!==2);if(u.length)return{error:va,invalidParticipantIdPairs:u};let c=o.filter(f=>f.participantType===ht).map(f=>f.individualParticipantIds),d=i.filter(f=>!c.find(g=>Vi(g,f).length===2)).map(f=>({participantType:ht,participantRole:Qr,individualParticipantIds:f})),p=ts({participants:d,tournamentRecord:n});if(p.error)return p;let m=i.map(f=>{let{participant:g}=es({tournamentRecord:n,participantIds:f});return g}).map(f=>({participantId:f,entryStatus:t,entryStage:r})),h=e.map(f=>({entryStatus:bo,participantId:f,entryStage:r}));return a.entries=(a.entries??[]).filter(f=>f.entryStage===r),a.entries=a.entries.concat(...m,...h),{...J}}var I4={};yt(I4,{addDrawDefinition:()=>Ob,addEvent:()=>Yg,addFlight:()=>ED,assignSeedPositions:()=>M4,attachFlightProfile:()=>_k,categoryCanContain:()=>ky,deleteDrawDefinitions:()=>DD,deleteEvents:()=>A4,deleteFlightAndFlightDraw:()=>E4,deleteFlightProfileAndFlightDraws:()=>S4,generate:()=>y4,generateEventsFromTieFormat:()=>b4,getCategoryAgeDetails:()=>vm,getEvent:()=>Ck,getEventProperties:()=>Rk,getEventStructures:()=>GT,getEventTimeItem:()=>Wy,getEvents:()=>Ek,getFlightProfile:()=>Gi,getScaledEntries:()=>ph,modifyEvent:()=>O4,modifyEventMatchUpFormatTiming:()=>T4,modifyPairAssignment:()=>C4,mutate:()=>w4,query:()=>l4,refreshEventDrawOrder:()=>Lk,removeEventMatchUpFormatTiming:()=>PD,removeScaleValues:()=>$k,removeSeeding:()=>N4,setEventDates:()=>xk,setEventDisplay:()=>RD,setEventEndDate:()=>kk,setEventStartDate:()=>Ok,updateDrawIdsOrder:()=>Fk,validateCategory:()=>DI});var y4={};yt(y4,{generateEventsFromTieFormat:()=>b4});function Epe({tournamentId:t,event:e}){return e?(lt({payload:{tournamentId:t,event:e},key:e.eventId,topic:pW}),{...J}):{error:gi}}var Cpe={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_D3",winCriteria:{valueGoal:5}},Mpe={collectionDefinitions:[{collectionName:"Doubles",collectionValue:1,matchUpCount:3,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES"},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_DEFAULT",winCriteria:{valueGoal:5}},Npe={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_JUCO",winCriteria:{valueGoal:5}},Ape={COLLEGE_D3:Cpe,COLLEGE_DEFAULT:Mpe,COLLEGE_JUCO:Npe,DOMINANT_DUO:oz,DOMINANT_DUO_MIXED:iz,LAVER_CUP:dz,TEAM_DOUBLES_3_AGGREGATION:JH,TIME_TENNIS_DUAL:rz,TIME_TENNIS_PRO_CIRCUIT:tz,USTA_BREWER_CUP:nz,USTA_OZAKI_CUP:az,USTA_COLLEGE:sz,USTA_GOLD_TEAM_CHALLENGE:XH,USTA_INTERSECTIONAL:ez,USTA_LEVEL_1:lz,USTA_SECTION_BATTLE:ZH,USTA_SOUTHERN_LEVEL_5:QH,USTA_TOC:pz,USTA_WTT_ITT:uz,USTA_ZONAL:cz};function Yg({suppressNotifications:t,tournamentRecord:e,internalUse:i,event:r}){var s,l,u,c;if(!e)return{error:ge};if(e.events||(e.events=[]),!r)return{error:gi};let{startDate:n,endDate:a}=e;if(!i&&((s=r.entries)!=null&&s.length||(l=r.drawDefinitions)!=null&&l.length)){let d=Ge({drawDefinitions:!!((u=r.drawDefinitions)!=null&&u.length),entries:!!((c=r.entries)!=null&&c.length)});return{info:"entries/drawDefinitions cannot exist",error:oe,context:d}}let o={eventType:Im,drawDefinitions:[],entries:[],startDate:n,endDate:a,...r};if(r.eventType===Sa){if(r.tieFormat){let d=Hn({tieFormat:r.tieFormat});if(d.error)return d}else if(r.tieFormatName){if(!Ape[r.tieFormatName])return{context:{tieFormatName:r.tieFormatName},error:oe};let d=bu({isMock:e==null?void 0:e.isMock,namedFormat:r.tieFormatName,event:r});o.tieFormat=d}}if(o.eventId||(o.eventId=Gt()),e.events.reduce((d,p)=>d||p.eventId===o.eventId,void 0))return{error:LG};{let d=o;if(e.events.push(d),!t){let{topics:p}=vo();if(p.includes(TT)){let f=tu({event:r}).matchUps??[];Dc({tournamentId:e==null?void 0:e.tournamentId,eventId:r.eventId,matchUps:f})}let{drawDefinitions:m,...h}=r;for(let f of m||[])Hy({drawDefinition:f});Epe({tournamentId:e==null?void 0:e.tournamentId,event:h})}return{...J,event:o}}}function b4(t){var o,s,l,u;let e=ze(t,[{[kf]:{[mT]:!0,[$z]:!0}},{[wr]:!0}]);if(e.error)return e;let i=t.tieFormat||bu({namedFormat:t.tieFormatName}),r=t.uuids||[KH(i.collectionDefinitions.length)],n={[Jt]:[],[pi]:[]};if(t.addEntriesFromTeams){let c=(s=(o=t.tournamentRecord.participants)==null?void 0:o.filter(d=>d.participantType===Vn))==null?void 0:s.flatMap(d=>d.individualParticipantIds??[]);for(let d of t.tournamentRecord.participants??[])if(c!=null&&c.includes(d.participantId)){let p=(l=d.person)==null?void 0:l.sex;p&&[Jt,pi].includes(p)&&n[p].push(d.participantId)}}let a=[];for(let c of i.collectionDefinitions??[]){let d=((u=r==null?void 0:r.pop())==null?void 0:u.toString())||Gt(),p=c.matchUpType,m=c.gender,h={matchUpFormat:c.matchUpFormat,eventName:c.collectionName,category:c.category,gender:m,eventType:p,eventId:d};if(t.addEntriesFromTeams){let f=p===wu?bo:t.entryStatus||oa,g=m===Bn?[...n[Jt],...n[pi]]:n[m]??[];if(g.length){let v=zs({participantIds:g,entryStatus:f,event:h});if(v.error)return v}}if(a.push(h),t.addEvents!==!1){let f=Yg({internalUse:!0,tournamentRecord:t.tournamentRecord,event:h});if(f.error)return f}}return{...J,events:a}}var w4={};yt(w4,{addDrawDefinition:()=>Ob,addEvent:()=>Yg,addFlight:()=>ED,assignSeedPositions:()=>M4,attachFlightProfile:()=>_k,deleteDrawDefinitions:()=>DD,deleteEvents:()=>A4,deleteFlightAndFlightDraw:()=>E4,deleteFlightProfileAndFlightDraws:()=>S4,modifyEvent:()=>O4,modifyEventMatchUpFormatTiming:()=>T4,modifyPairAssignment:()=>C4,refreshEventDrawOrder:()=>Lk,removeEventMatchUpFormatTiming:()=>PD,removeScaleValues:()=>$k,removeSeeding:()=>N4,setEventDates:()=>xk,setEventDisplay:()=>RD,setEventEndDate:()=>kk,setEventStartDate:()=>Ok,updateDrawIdsOrder:()=>Fk,validateCategory:()=>DI});function Kg({removePriorValues:t=!0,status:e=qa,statusObject:i,event:r}){if(!Nt(i))return{error:oe};let n=Uo({event:r,status:e}),a=`${Yc}.${Kc}`,o={itemValue:{[e]:{...n,...i}},itemType:a};return dh({timeItem:o,removePriorValues:t,event:r})}function Xg(t){var S,w,U,T,D,P,E;let e=ze(t,[{[wr]:!0,[Gc]:!0},{eventDataParams:!1,[Xn]:ea}]);if(e.error)return e;let{includePositionAssignments:i,removePriorValues:r,tournamentRecord:n,status:a=qa,event:o,drawIdsToRemove:s,drawIdsToAdd:l}=t,{appliedPolicies:u}=$t({tournamentRecord:n,event:o}),c={...u,...t.policyDefinitions},d=((S=o==null?void 0:o.drawDefinitions)==null?void 0:S.map(({drawId:R})=>R))??[],p=t.drawDetails?Object.keys(t.drawDetails):[],m=p.length?[]:t.drawIds,h=(l??[]).concat(...s??[],...m??[],...p),f=h.filter(R=>!d.includes(R));if(f.length)return ee({result:{error:xa},context:{invalidDrawIds:f}});let g=Uo({event:o,status:a}),v=Object.keys((g==null?void 0:g.drawDetails)||{}).filter(R=>d.includes(R)).reduce((R,N)=>(R[N]=g.drawDetails[N],R),{});for(let R of d)if((!h.length||h.includes(R))&&(s!=null&&s.includes(R)||m!=null&&m.length&&!m.includes(R)?v[R]={...v[R],publishingDetail:{published:!1}}:(l!=null&&l.includes(R)||m!=null&&m.includes(R)||!(m!=null&&m.length))&&(v[R]={...v[R],publishingDetail:{published:!0}})),(w=t.drawDetails)==null?void 0:w[R]){let N=t.drawDetails[R],A=N.structureDetails??v[R].structureDetails,M=N.stageDetails??v[R].stageDetails??{},{structureIdsToRemove:C=[],structureIdsToAdd:O=[],publishingDetail:k={},stagesToRemove:x=[],stagesToAdd:F=[]}=N;if((O||F)&&(k.published=!0),v[R]={publishingDetail:k,structureDetails:A,stageDetails:M},O.length||C.length){let _=(((T=(U=o==null?void 0:o.drawDefinitions)==null?void 0:U.find(B=>B.drawId===R))==null?void 0:T.structures)??[]).map(({structureId:B})=>B),L=(O??[]).concat(C??[]).filter(B=>!_.includes(B));if(L.length)return ee({result:{error:Mi},context:{invalidStructureIds:L}});A=A??{};for(let B of _)C.includes(B)?A[B]={published:!1}:A[B]={published:!0};v[R].structureDetails=A}let $=(((P=(D=o==null?void 0:o.drawDefinitions)==null?void 0:D.find(_=>_.drawId===R))==null?void 0:P.structures)??[]).map(({stage:_})=>_);if(F.length){for(let _ of F)M[_]={published:!0};for(let _ of $)M[_]||(M[_]={published:!1})}if(F.length||x.length){for(let _ of x)M[_]={published:!1};for(let _ of $)M[_]||(M[_]={published:!0})}(F.length||x.length)&&(v[R].stageDetails=M)}Kg({statusObject:{drawDetails:v},removePriorValues:r,status:a,event:o});let{topics:y}=vo(),I=y.includes(OC),b=I||t.returnEventData?(E=hD({includePositionAssignments:i,...t.eventDataParams,usePublishState:!0,tournamentRecord:n,policyDefinitions:c,event:o}))==null?void 0:E.eventData:void 0;return I&&lt({payload:{eventData:b,tournamentId:n.tournamentId},topic:OC}),{...J,eventData:b}}var U4="deleteDrawDefinitions",o1="autoSchedulingAudit",_U="deleteEvents",Ope={AUTO_SCHEDULING_AUDIT:o1,DELETE_EVENTS:_U,DELETE_DRAW_DEFINITIONS:U4};function DD(t){var T,D,P,E,R;if(!t.tournamentRecord)return{error:ge};let e="deleteDrawDefinitions",i=t.drawIds??[],r=t.event,{autoPublish:n=!0,tournamentRecord:a,auditData:o,eventId:s,force:l}=t,{appliedPolicies:u}=$t({tournamentRecord:a,event:r}),c={...u,...t.policyDefinitions},d=Array.isArray(i)?i[0]:void 0;if(!r){let N=Wn({tournamentRecord:a,eventId:s,drawId:d});if(N.error)return N;r=N.event}let p=[],m=[],h=[];if(!(r!=null&&r.drawDefinitions))return ee({info:"event has no drawDefinition",result:{...J},stack:e});let f=r.drawDefinitions.map(({drawId:N})=>N);if(i.length||(i=f),i=i.filter(N=>f.includes(N)),!i.length)return ee({info:"nothing to do; no matching drawIds in event.",result:{...J},stack:e});let g=Me(Gi({event:r}).flightProfile,!1,!0),v=({participantId:N,drawPosition:A,qualifier:M,bye:C})=>({bye:C,qualifier:M,drawPosition:A,participantId:N}),y=l??((D=(T=u==null?void 0:u[Rs])==null?void 0:T.allowDeletionWithScoresPresent)==null?void 0:D.drawDefinitions),I=Uo({event:r})??{},b=I.drawIds??(I.drawDetails&&Object.keys(I.drawDetails))??[],S,w=[],U=r.drawDefinitions.filter(N=>{var A,M,C,O,k,x,F,$;if(i.includes(N.drawId)){let _=((A=Sn({event:r,drawDefinition:N}))==null?void 0:A.matchUps)??[];if(_.some(({score:re})=>Ir({score:re}))&&!y)return w.push(N.drawId),!0;let{drawId:L,drawType:B,drawName:V}=N,G=(M=g==null?void 0:g.flights)==null?void 0:M.find(re=>re.drawId===N.drawId);G&&(G.drawEntries=(C=G.drawEntries)==null?void 0:C.filter(re=>ls.includes(re.entryStatus))),b.includes(L)&&(b=b.filter(re=>re!==L),S=!0);let j=(k=(O=Zo({stageSequence:1,drawDefinition:N,stage:Oe}))==null?void 0:O.structures)==null?void 0:k[0],z=(F=(x=j?LI({structureId:j.structureId,tournamentRecord:a,drawDefinition:N}):void 0)==null?void 0:x.positionAssignments)==null?void 0:F.map(v),W=($=Zo({stage:Ye,drawDefinition:N}))==null?void 0:$.structures,q=W!=null&&W.length?W.map(re=>{var H;let K=re.stageSequence;return{positionAssignments:(H=LI({structureId:re.structureId,tournamentRecord:a,drawDefinition:N}))==null?void 0:H.positionAssignments.map(v),stageSequence:K}}):void 0,Y={action:U4,payload:{drawDefinitions:[N],eventId:s??(r==null?void 0:r.eventId),auditData:o}};h.push(Y),p.push(Ge({tournamentId:a.tournamentId,eventId:s??(r==null?void 0:r.eventId),qualifyingPositionAssignments:q,positionAssignments:z,auditData:o,drawType:B,drawName:V,drawId:L})),_==null||_.forEach(({matchUpId:re})=>m.push(re))}return!i.includes(N.drawId)});if(w.length&&!l)return ee({context:{drawIdsWithScoresPresent:w},result:{error:eT},stack:e});if(r.drawDefinitions=U,g&&zc({event:r,extension:{name:Qo,value:g}}),Cb({tournamentRecord:a}),S){let N={};for(let M of b)N[M]=((P=I.drawDetails)==null?void 0:P[M])??{published:!0};let A=Kg({statusObject:{drawDetails:N},event:r});if(A.error)return{error:A.error}}if(h.length)if(tT(fu)){let N=a.tournamentId;lt({topic:fu,payload:{tournamentId:N,detail:h}});let A=(((R=(E=yo({element:r,itemType:Pd}))==null?void 0:E.timeItem)==null?void 0:R.itemValue)||0)+1;vl({element:r,timeItem:{itemType:Pd,itemValue:A},removePriorValues:!0})}else kpe({appliedPolicies:u,event:r,deletedDrawsDetail:p,auditData:o});if(m.length&&zu({tournamentId:a==null?void 0:a.tournamentId,matchUpIds:m}),i.forEach(N=>Aoe({drawId:N})),n&&S){let N=Xg({...t.eventDataParams,drawIdsToRemove:i,policyDefinitions:c,tournamentRecord:a,event:r});if(N.error)return{...J,info:N.error}}return{...J}}function kpe({appliedPolicies:t,event:e,deletedDrawsDetail:i,auditData:r}){var s;if(((s=t==null?void 0:t.audit)==null?void 0:s[Pd])===!1)return;let{extension:n}=gt({name:Pd,element:e}),a={...r,deletedDrawsDetail:i},o={value:Array.isArray(n==null?void 0:n.value)?n==null?void 0:n.value.concat(a):[a],name:Pd};Lt({element:e,extension:o})}function S4({autoPublish:t=!0,tournamentRecord:e,auditData:i,event:r,force:n}){var o;if(!e)return{error:ge};if(!r)return{error:gi};let{flightProfile:a}=Gi({event:r});if(a){let s=(o=a.flights)==null?void 0:o.map(({drawId:u})=>u).filter(Boolean),l=DD({eventId:r.eventId,tournamentRecord:e,autoPublish:t,auditData:i,drawIds:s,event:r,force:n});return l.error?l:yT({event:r,name:Qo})}return{...J}}function Ak(t){let{matchUpFormat:e,recoveryTimes:i,averageTimes:r,tournamentId:n,eventId:a}=t,o=(t==null?void 0:t.tournamentRecords)??((t==null?void 0:t.tournamentRecord)&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord})??{};if(!Object.keys(o).length)return{error:ki};let s=Object.keys(o).filter(u=>!n||n===u);if(n&&!s.includes(n))return{error:oe};let l;for(let u of s){let c=o[u],{event:d}=Wn({tournamentRecord:c,eventId:a});a&&d&&(l=!0);let p=xpe({tournamentRecord:c,event:d,matchUpFormat:e,averageTimes:r,recoveryTimes:i});if(p.error)return p}return!a||l?{...J}:{error:lo}}function xpe({tournamentRecord:t,recoveryTimes:e,matchUpFormat:i,averageTimes:r,event:n}){if(!t)return{error:ge};if(r&&!Array.isArray(r))return{error:oe};if(e&&!Array.isArray(e))return{error:oe};let a=Du;if(n){let{extension:o}=gt({element:n,name:a}),s=(o==null?void 0:o.value)||{},l=dV({...s,matchUpFormat:i,averageTimes:r,recoveryTimes:e});Lt({element:n,extension:{name:a,value:l}})}else{let{extension:o}=gt({element:t,name:a}),s=(o==null?void 0:o.value)||{},l=dV({...s,matchUpFormat:i,averageTimes:r,recoveryTimes:e});Lt({extension:{name:a,value:l},element:t})}return{...J}}function dV(t){let{matchUpRecoveryTimes:e=[],matchUpAverageTimes:i=[],matchUpFormat:r}=t,{averageTimes:n,recoveryTimes:a}=t;n=(n||[]).filter(l=>{var u,c;return((u=l==null?void 0:l.categoryNames)==null?void 0:u.length)||((c=l==null?void 0:l.categoryTypes)==null?void 0:c.length)});let o=(n==null?void 0:n.length)&&i.map(l=>{var u;return l!=null&&l.matchUpFormatCodes.includes(r)?{...l,matchUpFormatCodes:(u=l.matchUpFormatCodes)==null?void 0:u.filter(c=>c!==r)}:l}).filter(({matchUpFormatCodes:l})=>l==null?void 0:l.length).concat({matchUpFormatCodes:[r],averageTimes:n});a=(a||[]).filter(l=>{var u,c;return((u=l==null?void 0:l.categoryNames)==null?void 0:u.length)||((c=l==null?void 0:l.categoryTypes)==null?void 0:c.length)});let s=(a==null?void 0:a.length)&&e.map(l=>{var u;return l!=null&&l.matchUpFormatCodes.includes(r)?{...l,matchUpFormatCodes:(u=l.matchUpFormatCodes)==null?void 0:u.filter(c=>c!==r)}:l}).filter(({matchUpFormatCodes:l,averageTimes:u})=>(l==null?void 0:l.length)||u).concat({matchUpFormatCodes:[r],recoveryTimes:a});return{matchUpAverageTimes:(o==null?void 0:o.length)&&o||i,matchUpRecoveryTimes:(s==null?void 0:s.length)&&s||e}}function T4(t){let{tournamentRecord:e,recoveryMinutes:i,averageMinutes:r,matchUpFormat:n,categoryType:a,eventId:o,event:s}=t;if(!e)return{error:ge};if(!Ua({matchUpFormat:n}))return{error:oe};if(!s)return{error:gi};let{averageTimes:l=[],recoveryTimes:u=[]}=wD({tournamentRecord:e,matchUpFormat:n,event:s}),c=s.category,d=(c==null?void 0:c.categoryName)||(c==null?void 0:c.ageCategoryCode)||(s==null?void 0:s.eventId),p={categoryNames:[d],minutes:{}},m={categoryNames:[d],minutes:{}},h=I=>{var b,S;if((b=I.categoryTypes)!=null&&b.includes(a)&&console.log("encountered:",{categoryType:a}),!((S=I.categoryNames)!=null&&S.includes(d)&&(I.categoryNames=I.categoryNames.filter(w=>w!==d),p={minutes:I.minutes,categoryNames:[d]},!I.categoryNames.length)))return I},f=r&&!isNaN(Qe(r)),g=i&&!isNaN(Qe(i)),v=l.map(h).filter(I=>{var b;return(b=I==null?void 0:I.categoryNames)==null?void 0:b.length}),y=u.map(h).filter(I=>{var b;return(b=I==null?void 0:I.categoryNames)==null?void 0:b.length});return f&&(Object.assign(p.minutes,{[(s==null?void 0:s.eventType)||ti]:r}),v.push(p)),g&&(Object.assign(m.minutes,{[(s==null?void 0:s.eventType)||ti]:i}),y.push(m)),!f&&!g?{error:oe}:Ak({averageTimes:f&&v,recoveryTimes:g&&y,tournamentRecord:e,matchUpFormat:n,eventId:o,event:s})}function PD(t){if(t.event)return pV({event:t.event});{t.tournamentRecord&&!t.tournamentRecords&&(t.tournamentRecords={[t.tournamentRecord.tournamentId]:t.tournamentRecord});let e=ze(t,[{[pn]:!0,[Hz]:!0}]);if(e.error)return e;let{tournamentRecords:i,eventId:r}=t;for(let n of Object.values(i??{})){let{event:a}=Wn({tournamentRecord:n,eventId:r});if(a)return pV({event:a})}}return{error:lo}}function pV({event:t}){return yT({event:t,name:Du})}var Fpe="MON",Lpe="TUE",_pe="WED",$pe="THU",Bpe="FRI",Vpe="SAT",jpe="SUN",D4={MON:Fpe,TUE:Lpe,WED:_pe,THU:$pe,FRI:Bpe,SAT:Vpe,SUN:jpe};function P4(t){return!Array.isArray(t)||ct(t).length!==t.length?!1:t.every(e=>Object.keys(D4).includes(e))}function Ok({tournamentRecord:t,event:e,startDate:i}){if(!t)return{error:ge};if(!e)return{error:gi};if(!Zs.test(i))return{error:Ar};let r=R4(t);if(r.error)return r;let{tournamentStartDate:n,tournamentEndDate:a}=r,o=new Date(pt(i)).getTime();if(!n||!a||o<n||o>a)return{error:Ar};let s=e.endDate&&new Date(pt(e.endDate)).getTime();return s&&o>s&&(e.endDate=i),e.startDate=i,{...J}}function kk(t){let{tournamentRecord:e,event:i,endDate:r}=t;if(!e)return{error:ge};if(!i)return{error:gi};if(!Zs.test(r))return{error:Ar};let n=R4(e);if(n.error)return n;let{tournamentStartDate:a,tournamentEndDate:o}=n,s=new Date(pt(r)).getTime();if(!a||!o||s<a||s>o)return{error:Ar};let l=i.startDate&&new Date(pt(i.startDate)).getTime();return l&&s<l&&(i.startDate=r),i.endDate=r,{...J}}function xk(t){var l;let e=ze(t,[{tournamentRecord:!0,event:!0},{[Kr]:u=>Zs.test(u),[_a]:Ar,startDate:!1,endDate:!1},{[Kr]:u=>u.filter(Boolean).every(c=>Zs.test(c)),[_a]:Ar,activeDates:!1},{[Kr]:P4,weekdays:!1}]);if(e.error)return e;let{tournamentRecord:i,weekdays:r,event:n,startDate:a,endDate:o}=t,s=(l=t.activeDates)==null?void 0:l.filter(Boolean);if(a&&o){let u=new Date(pt(a)).getTime(),c=new Date(pt(o)).getTime();if(u>c)return{error:oe}}if(s){let u=a||i.startDate,c=o||i.endDate,d=!u||s.every(m=>new Date(m)>=new Date(u)),p=!c||s.every(m=>new Date(m)<=new Date(c));if(!d||!p)return{error:Ar}}if(a){let u=Ok({tournamentRecord:i,event:n,startDate:a});if(u.error)return u}if(o){let u=kk({tournamentRecord:i,event:n,endDate:o});if(u.error)return u}return s&&(n.activeDates=s),r&&(n.weekdays=r),{...J}}function R4(t){let{startDate:e,endDate:i}=t;return!Zs.test(e)||!Zs.test(i)?ee({result:{error:JG},context:{startDate:e,endDate:i}}):{tournamentStartDate:new Date(pt(e)).getTime(),tournamentEndDate:new Date(pt(i)).getTime()}}function Fk({event:t,orderedDrawIdsMap:e}){var n,a;if(typeof t!="object")return{error:gi};if(!e)return{error:Xe,info:"Missing drawIdsOrderMap"};if(typeof e!="object")return{error:oe,info:"orderedDrawIdsMap must be an object"};let i=Object.values(e);if(!i.every(o=>!isNaN(o)))return{error:oe,info:"drawOrder must be numeric"};if(ct(i).length!==i.length)return{error:oe,info:"drawOrder values must be unique"};if((n=t.drawDefinitions)!=null&&n.length){let o=(t.drawDefinitions||[]).map(({drawId:l})=>l),s=Object.keys(e);if(s!=null&&s.length&&Vi(o,s).length!==o.length)return{error:oe,info:"Missing drawIds"};t.drawDefinitions.forEach(l=>{l.drawOrder=e[l.drawId]})}let{flightProfile:r}=Gi({event:t});return(a=r==null?void 0:r.flights)==null||a.forEach(o=>{o.flightNumber=e[o.drawId]}),{...J}}function Lk({tournamentRecord:t,event:e}){var n;if(!t)return{error:ge};if(!e)return{error:gi};let{flightProfile:i}=Gi({event:e}),r=(i==null?void 0:i.flights)&&Object.assign({},...i.flights.sort((a,o)=>a.flightNumber-o.flightNumber).map((a,o)=>({[a.drawId]:o+1})))||((n=e.drawDefinitions)==null?void 0:n.length)&&Object.assign({},...e.drawDefinitions.sort((a,o)=>a.drawOrder-o.drawOrder).map((a,o)=>({[a.drawId]:o+1})))||void 0;return r?Fk({event:e,orderedDrawIdsMap:r}):{...J}}function E4({autoPublish:t=!0,tournamentRecord:e,auditData:i,drawId:r,event:n,force:a}){var s,l;if(!e)return{error:ge};if(!r)return{error:xs};if(!n)return{error:gi};let{flightProfile:o}=Gi({event:n});if(o&&((s=o.flights)!=null&&s.find(u=>u.drawId===r))){let u=o.flights.filter(d=>d.drawId!==r),c={name:Qo,value:{...o,flights:u}};zc({event:n,extension:c})}if((l=n.drawDefinitions)!=null&&l.find(u=>u.drawId===r)){let u=DD({drawIds:[r],eventId:n.eventId,tournamentRecord:e,autoPublish:t,auditData:i,event:n,force:a});if(u.error)return u}return Lk({tournamentRecord:e,event:n})}function C4(t){var g,v;let e=ze(t,[{[Gc]:!0,[wr]:!0,[aA]:!1},{replacementIndividualParticipantId:!0,[Kr]:y=>Ti(y),existingIndividualParticipantId:!0,[Vo]:pr,participantId:!0}]),{replacementIndividualParticipantId:i,existingIndividualParticipantId:r,tournamentRecord:n,drawDefinition:a,participantId:o,event:s,uuids:l}=t;if(e.error)return e;if((s==null?void 0:s.eventType)!==uo)return{error:Bl};if(!(((g=s==null?void 0:s.entries)==null?void 0:g.filter(({entryStatus:y})=>[bo,fp].includes(y)).map(({participantId:y})=>y))||[]).includes(i))return{error:Ts};let u=(n.participants||[]).find(y=>y.participantId===o);if((u==null?void 0:u.participantType)!==ht)return{error:Hm,participant:u};let c=u.individualParticipantIds,d=[i,...c.filter(y=>y!==r)],{participant:p}=es({participantIds:d,tournamentRecord:n}),m;if(p)m=p.participantId;else{let y={participantId:l==null?void 0:l.pop(),participantRole:Qr,individualParticipantIds:d,participantType:ht},I=al({participant:y,returnParticipant:!0,tournamentRecord:n});if(I.error)return I;m=I.participant.participantId}let{flightProfile:h}=Gi({event:s});if(a){let y=(v=h==null?void 0:h.flights)==null?void 0:v.find(({drawId:I})=>I===a.drawId);y&&(y.drawEntries=y.drawEntries.map(I=>I.participantId===o?{...I,participantId:m}:I)),a.entries=a.entries.map(I=>I.participantId===o?{...I,participantId:m}:I);for(let I of a.structures||[])if(I.structures){I.positionAssignments=void 0;for(let b of I.structures)b.positionAssignments=b.positionAssignments.map(S=>S.participantId===o?{...S,participantId:m}:S)}else I.positionAssignments&&(I.positionAssignments=I.positionAssignments.map(b=>b.participantId===o?{...b,participantId:m}:b))}s.entries=s.entries.map(y=>y.participantId===o&&{...y,participantId:m}||y.participantId===i&&{...y,participantId:r}||y);let f=n.events.some(({entries:y,eventId:I,drawDefinitions:b})=>s.eventId===I?b.some(({drawId:S,entries:w})=>S===(a==null?void 0:a.drawId)?!1:w==null?void 0:w.find(U=>U.participantId===o)):y==null?void 0:y.find(S=>S.participantId===o));if(!f){let y=lh({addIndividualParticipantsToEvents:!1,participantIds:[o],tournamentRecord:n});if(y.error)return y}return{...J,participantOtherEntries:f,newPairParticipantId:m}}function Ob(t){var R,N,A,M,C,O,k,x,F,$,_,L;let{flight:e,suppressNotifications:i,modifyEventEntries:r,existingDrawCount:n,allowReplacement:a,checkEntryStatus:o,tournamentRecord:s,drawDefinition:l,event:u}=t;if(!l)return{error:_e};if(!u)return{error:gi};u.drawDefinitions||(u.drawDefinitions=[]);let{drawId:c,drawName:d,entries:p}=l,{entries:m}=u,h=0;if(n!==void 0&&n!==u.drawDefinitions.length)return{error:oe,info:"drawDefintions count mismatch"};let{flightProfile:f}=Gi({event:u}),g=e&&((R=f==null?void 0:f.flights)==null?void 0:R.find(B=>B.flightNumber===e.flightNumber)),v=(M=(A=(N=f==null?void 0:f.links)==null?void 0:N.find(B=>{var V;return((V=B==null?void 0:B.target)==null?void 0:V.drawId)===c}))==null?void 0:A.source)==null?void 0:M.drawId;if(v&&!u.drawDefinitions.find(B=>B.drawId===v))return ee({result:{error:_e},info:{sourceDrawId:v}});if(g&&g.drawId!==l.drawId)return ee({result:{error:Yp},info:{relevantFlight:g}});let y=p==null?void 0:p.every(({participantId:B,entryStatus:V})=>{let G=g==null?void 0:g.drawEntries.find(j=>j.participantId===B);return!V||(G==null?void 0:G.entryStatus)===V}),I=!o||m&&(p==null?void 0:p.every(({participantId:B,entryStatus:V,entryStage:G})=>{var j;return((j=m.find(z=>z.participantId===B&&(!z.entryStage||z.entryStage===G)))==null?void 0:j.entryStatus)===V}));if(g&&!y)return ee({result:{error:Yp},context:{drawEntriesPresentInFlight:y,matchingEventEntries:I,relevantFlight:g},info:"Draw entries are not present in flight or do not match entryStatuses"});if(r&&(p==null||p.filter(Boolean).forEach(B=>{if(B!=null&&B.entryStatus&&ls.includes(B==null?void 0:B.entryStatus)){let V=m==null?void 0:m.filter(Boolean).find(G=>G.participantId===B.participantId);V&&B.entryStatus&&(V==null?void 0:V.entryStatus)!==B.entryStatus&&(V.entryStatus=B.entryStatus,h+=1)}})),m&&!I)return ee({result:{info:"Draw entries do not match event entryStatuses",context:{matchingEventEntries:I,eventEntries:m},error:Yp}});let b=((O=(C=f==null?void 0:f.flights)==null?void 0:C.map(({flightNumber:B})=>!isNaN(B)&&Qe(B)))==null?void 0:O.filter(Boolean))||[],S=((k=u.drawDefinitions.map(({drawOrder:B})=>B&&Qe(B)))==null?void 0:k.filter(Boolean))||[],w=Math.max(0,...S,...b)+1,U=(x=f==null?void 0:f.flights)==null?void 0:x.find(B=>B.drawId===c),T;if(U){U.drawName=l.drawName,T={name:Qo,value:{...f,flights:f.flights}};let B=U.flightNumber;B&&!S.includes(B)?w=B:U.flightNumber=w}else{let B=(f==null?void 0:f.flights)||[];B.push({manuallyAdded:!0,flightNumber:w,drawEntries:p,drawName:d,drawId:c}),T={name:Qo,value:{...f||{},flights:B}}}zc({event:u,extension:T}),Object.assign(l,{drawOrder:w});let D=u.drawDefinitions.find(B=>B.drawId===c),P=s==null?void 0:s.tournamentId,E=u.eventId;if(D){if(!a)return{error:RG};let B=(($=(F=Sn({drawDefinition:D}))==null?void 0:F.matchUps)==null?void 0:$.map(Dr))??[],V=(_=Sn({drawDefinition:l}))==null?void 0:_.matchUps;if(!i){B!=null&&B.length&&zu({matchUpIds:B,action:"modifyDrawDefinition",tournamentId:P,eventId:E}),V!=null&&V.length&&Dc({matchUps:V,tournamentId:P,eventId:E}),u.drawDefinitions=u.drawDefinitions.map(j=>j.drawId===c?l:j);let G=(L=l.structures)==null?void 0:L.map(({structureId:j})=>j);li({drawDefinition:l,tournamentId:P,structureIds:G,eventId:E})}}else if(u.drawDefinitions.push(l),!i){let{matchUps:B}=Sn({drawDefinition:l,event:u});B&&Dc({tournamentId:s==null?void 0:s.tournamentId,matchUps:B}),Hy({drawDefinition:l,tournamentId:P,eventId:E})}return{...J,modifiedEventEntryStatusCount:h}}function M4(t){let{provisionalPositioning:e,useExistingSeedLimit:i,tournamentRecord:r,drawDefinition:n,seedingProfile:a,structureId:o,assignments:s,drawId:l,event:u}=t,c=0;if(!(s!=null&&s.length))return{error:vN};if(!r)return{error:ge};if(!l)return{error:xs};let d=po({provisionalPositioning:e,drawDefinition:n,structureId:o});if(d.error)return d;let{seedAssignments:p,seedLimit:m}=d,h=Object.assign({},...(p??[]).filter(v=>v.seedNumber).map(v=>({[v.seedNumber]:v})));s.forEach(v=>{let{seedNumber:y}=v;m&&y<=m&&(!i||h[y])&&(h[y]=v)});let f=Object.values(h),g=f.map(v=>v==null?void 0:v.participantId).filter(Boolean);if(g.length!==gG(g).length)return{error:EG};for(let v of f){let y=jg({...v,provisionalPositioning:e,tournamentRecord:r,drawDefinition:n,seedingProfile:a,structureId:o,event:u});if(y!=null&&y.error)return y;y!=null&&y.success&&c++}return c?{...J,modifications:c}:{error:Mg}}function _k({deleteExisting:t,event:e,flightProfile:i}){var a;let r="attachFlightProfile";if(!i)return ee({result:{error:Xe},stack:r});if(!e)return ee({result:{error:gi},stack:r});let{flightProfile:n}=Gi({event:e});return n&&!t?ee({result:{error:kN},stack:r}):(a=e.drawDefinitions)!=null&&a.length?ee({result:{error:TG},stack:r}):(zc({event:e,extension:{name:Qo,value:i}}),{flightProfile:Me(i,!1,!0),...J})}function Gpe({tournamentRecord:t,scaleAttributes:e,participantIds:i}){var s;if(!t)return{error:ge};if(!i)return{error:Vc};if(!e)return{error:Xe,info:"scaleAttributes required"};let{scaleType:r,eventType:n,scaleName:a}=e,o=[BW,r,n,a].join(".");return(s=t.participants)==null||s.forEach(l=>{i.includes(l.participantId)&&l.timeItems&&(l.timeItems=l.timeItems.filter(u=>u&&(u==null?void 0:u.itemType)!==o))}),{...J}}function $k({tournamentRecord:t,scaleAttributes:e,drawDefinition:i,entryStatuses:r,drawId:n,event:a,stage:o}){var u;if(!a)return{error:gi};if(r&&!Array.isArray(r))return ee({result:{error:oe},info:Bd("entryStatus"),stack:"removeScaleValues"});let s=a.entries;if(n){let{flightProfile:c}=Gi({event:a}),d=(u=c==null?void 0:c.flights)==null?void 0:u.find(p=>p.drawId===n);d?s=d.drawEntries:s=i==null?void 0:i.entries}let l=(s||[]).filter(c=>(!o||!c.entryStage||c.entryStage===o)&&(!r||r.includes(c.entryStatus))).map(Ut);return Gpe({tournamentRecord:t,scaleAttributes:e,participantIds:l})}function RD({removePriorValues:t,tournamentRecord:e,displaySettings:i,status:r=qa,event:n}){if(!e)return ee({result:{error:ge}});if(!n)return ee({result:{error:gi}});if(!Nt(i))return ee({result:{error:Xe}});if(Nt(i.draws))for(let o of Object.keys(i.draws)){let s=i.draws[o].scheduleDetails??[];if(s.length){let l=[];for(let u of s){let c=l.find(d=>Sne(d.attributes,u.attributes));c!=null&&c.dates&&u.dates?c.dates.push(...u.dates):l.push(u)}i.draws[o].scheduleDetails=l}}let a=Kg({statusObject:{displaySettings:i},removePriorValues:t,status:r,event:n});return a.error?a:{...J}}function N4({tournamentRecord:t,drawDefinition:e,entryStatuses:i,scaleName:r,drawId:n,event:a,stage:o}){var l,u;if(!t)return{error:ge};if(!a)return{error:gi};r=r||((l=a.category)==null?void 0:l.categoryName)||((u=a.category)==null?void 0:u.ageCategoryCode);let s={eventType:a.eventType,scaleType:Rl,scaleName:r};return $k({tournamentRecord:t,scaleAttributes:s,drawDefinition:e,entryStatuses:i,drawId:n,event:a,stage:o})}function A4(t){let e=ze(t,[{[wr]:!0},{eventIds:!0,[Xn]:un}]);if(e.error)return e;let{removePairParticipants:i,tournamentRecord:r,eventIds:n}=t,a=[],o=[],s=[],l=[];if(r.events=(r.events||[]).filter(u=>{if(n.includes(u.eventId)){let p={action:_U,payload:{events:[u]}};a.push(p),o.push({tournamentId:r.tournamentId,eventName:u.eventName,eventType:u.eventType,category:u.category,eventId:u.eventId,gender:u.gender})}let c=u.eventType===uo?(u.entries||[]).map(({entryStatus:p,participantId:m})=>p!==bo&&m).filter(Boolean):[],d=n.includes(u.eventId);return d?l.push(...c):s.push(...c),!d}),i){let u=l.filter(c=>!s.includes(c));r.participants=r.participants.filter(({participantId:c})=>!u.includes(c))}if(Cb({tournamentRecord:r}),a.length)if(tT(fu)){let u=r.tournamentId;lt({topic:fu,payload:{type:_U,tournamentId:u,detail:a}})}else Ub({tournamentRecord:r,timeItem:{itemValue:o,itemType:_U}});return{...J}}function O4(t){var f,g,v;let e=ze(t,[{tournamentRecord:!0,eventId:!0,event:!0},{eventUpdates:!0,_ofType:ea}]);if(e.error)return e;let{eventUpdates:i,event:r}=t,n="modifyEvent",a=Wpe(t),o=qpe({enteredParticipants:a}),{enteredParticipantGenders:s,enteredParticipantTypes:l}=o,u=(g=(f=Gi({event:r}))==null?void 0:f.flightProfile)==null?void 0:g.flights,c=!((v=r.drawDefinitions)!=null&&v.length)&&!(u!=null&&u.length),d=Ype({noFlightsNoDraws:c,enteredParticipantGenders:s,eventUpdates:i,stack:n});if(d.error)return d;let p=Kpe({enteredParticipantTypes:l,eventUpdates:i,stack:n});if(p.error)return p;let m=Hpe({...t,...o,enteredParticipants:a,stack:n});if(m.error)return m;let h=zpe({...t,stack:n});return h.error?h:(i.eventType&&(r.eventType=i.eventType),i.eventName&&(r.eventName=i.eventName),i.gender&&(r.gender=i.gender),{...J})}function Hpe(t){var r,n,a,o,s,l;let e=(r=t.eventUpdates)==null?void 0:r.category;if(!e)return{...J};let i=DI({category:e});if(i.error)return i;if(t.event.eventType===sr){let u=((a=(n=t.event)==null?void 0:n.drawDefinitions)==null?void 0:a.map(p=>_s(p)))??[],c=_s(t.event),d=(((o=tu(t))==null?void 0:o.matchUps)??[]).map(p=>_s(p))??[];if(![c,...u,...d].filter(Boolean).every(p=>p.collectionDefinitions.every(m=>!m.category||ky({category:t.eventUpdates.category,childCategory:m.category}))))return ee({result:{error:yI},stack:t.stack})}if((s=t.enteredParticipants)!=null&&s.length){let u=t.eventUpdates.startDate||t.event.startDate||t.tournamentRecord.startDate,c=t.eventUpdates.endDate||t.event.endDate||t.tournamentRecord.endDate,d=t.enteredParticipants.map(h=>h.participantType===St?h:h.individualParticpants??[]).flat(),p=vm({category:e,consideredDate:u}),m=vm({category:e,consideredDate:c});if(p!=null&&p.ageMinDate||p!=null&&p.ageMaxDate||m!=null&&m.ageMinDate||m!=null&&m.ageMaxDate)for(let h of d){let f=(l=h.person)==null?void 0:l.birthDate;if(!f)return ee({result:{error:qG},stack:t.stack});let g=new Date(f).getTime();if(p.ageMinDate||p.ageMaxDate){let v=new Date(p.ageMinDate).getTime(),y=new Date(p.ageMaxDate).getTime();if(g<v||g>y)return ee({result:{error:wC},stack:t.stack})}if(m.ageMin||m.ageMax){let v=new Date(m.ageMinDate).getTime(),y=new Date(m.ageMaxDate).getTime();if(g<v||g>y)return ee({result:{error:wC},stack:t.stack})}}}return{...J}}function zpe(t){let{tournamentRecord:e,eventUpdates:i,event:r,stack:n}=t;if(i.startDate||i.endDate){let a=xk({startDate:i.startDate,endDate:i.endDate,tournamentRecord:e,event:r});if(a.error)return ee({result:a,stack:n})}return{...J}}function Wpe(t){var n;let{tournamentRecord:e,event:i}=t,r=((n=i==null?void 0:i.entries)==null?void 0:n.filter(({entryStatus:a})=>{let o=a;return[...ls,jo].includes(o)}).map(({participantId:a})=>a))??[];return r?Ni({participantFilters:{participantIds:r},withIndividualParticipants:!0,tournamentRecord:e}).participants??[]:[]}function qpe({enteredParticipants:t}){let e=[],i=t.reduce((n,a)=>{var s,l;let o=(s=a.person)!=null&&s.sex?[a.person.sex]:((l=a.individualParticpants)==null?void 0:l.map(u=>{var c;return(c=u.person)==null?void 0:c.sex}))||[];return e.push(...o),n.includes(a.participantType)?n:n.concat(a.participantType)},[]),r=ct(e);return{enteredParticipantTypes:i,enteredParticipantGenders:r}}function Ype({noFlightsNoDraws:t,enteredParticipantGenders:e,eventUpdates:i,stack:r}){let n=!e.length||!i.gender||i.gender===Ps||e.length===1&&e[0]===i.gender||t&&i.gender===Bn;return i.gender&&!n?ee({context:{gender:i.gender,validGender:n},result:{error:zv},stack:r}):{...J}}function Kpe({enteredParticipantTypes:t,eventUpdates:e,stack:i}){let r=(t.includes(sr)&&[sr]||t.includes(St)&&[el]||t.includes(ht)&&[uo]||[uo,el,sr]).includes(e.eventType??"");return e.eventType&&!r?ee({context:{participantType:e.eventType,validEventType:r},result:{error:Bl},stack:i}):{...J}}function ED({qualifyingPositions:t,drawEntries:e=[],drawName:i,drawId:r,event:n,stage:a}){var m,h,f;let o="addFlight";if(!n)return ee({result:{error:gi},stack:o});if(!i)return ee({result:{error:Xe},stack:o});if(e!=null&&e.length){let g=(n.entries??[]).map(Ut),v=e.map(Ut);if(Vi(v,g).length!==v.length)return ee({result:{error:oe},stack:o})}let s=(m=Gi({event:n}))==null?void 0:m.flightProfile,l=((f=(h=s==null?void 0:s.flights)==null?void 0:h.map(({flightNumber:g})=>!isNaN(g)&&Qe(g)))==null?void 0:f.filter(Boolean))||[],u=Math.max(0,...l)+1,c={drawId:r||Gt(),flightNumber:u,drawEntries:e,drawName:i};if(a&&(c.stage=a),t&&(c.qualifyingPositions=t),((s==null?void 0:s.flights)||[]).find(({drawId:g})=>g===c.drawId))return ee({result:{error:PH},stack:o});let d=((s==null?void 0:s.flights)||[]).concat(c),p={name:Qo,value:{...s||{},flights:d}};return zc({event:n,extension:p})}var k4={};yt(k4,{drawMatic:()=>JO,garman:()=>V4,generateAdHocMatchUps:()=>tD,generateAdHocRounds:()=>XO,generateAndPopulatePlayoffStructures:()=>PO,generateCourts:()=>Bk,generateDrawDefinition:()=>Ab,generateDrawMaticRound:()=>BO,generateDrawStructuresAndLinks:()=>LO,generateDrawTypeAndModifyDrawDefinition:()=>_O,generateFlightProfile:()=>Qpe,generateLineUps:()=>B4,generateQualifyingStructure:()=>vO,generateSeedingScaleItems:()=>c4,generateStatCrew:()=>Zpe,generateVoluntaryConsolation:()=>z3,roundRobinGroups:()=>tle});var Xpe="splitLevelBased",x4="splitWaterfall",F4="splitShuttle",Jpe={SPLIT_LEVEL_BASED:Xpe,SPLIT_WATERFALL:x4,SPLIT_SHUTTLE:F4};function Qpe(t){let{drawNameRoot:e="Flight",attachFlightProfile:i,tournamentRecord:r,scaleAttributes:n,scaleSortMethod:a,deleteExisting:o,sortDescending:s,drawNames:l=[],flightsCount:u,splitMethod:c,uuids:d=[],event:p,stage:m}=t;if(!p)return{error:gi};let h=p.entries??[],{flightProfile:f}=Gi({event:p});if(f&&i&&!o)return{error:kN};let g=t.scaledEntries??ph({tournamentRecord:r,scaleAttributes:n,scaleSortMethod:a,sortDescending:s,event:p,stage:m}).scaledEntries,v=g.map(Ut),y=wn(h.filter(({participantId:P})=>!v.includes(P)).filter(P=>(!m||!P.entryStage||P.entryStage===m)&&(!P.entryStatus||gp.includes(P.entryStatus)))),I=g.concat(...y),b=I.length,S=Math.ceil(b/u),w=Rr(I,S);c===x4?w=mC(I,u):c===F4&&(w=mC(I,u,!0));function U(P){return(P||[]).map(({participantId:E,scaleValue:R})=>{let N=h.find(A=>A.participantId===E);return N!=null&&N.scaleValue&&R&&(N.scaleValue=R),N}).sort((E,R)=>E.scaleValue-R.scaleValue).map((E,R)=>(E.scaleValue&&(E.seedNumber=R+1),E))}let T=Se(0,u).map(P=>{let E=P+1;return{flightNumber:E,drawId:(d==null?void 0:d.pop())??Gt(),drawEntries:U(w[P]),drawName:(l==null?void 0:l.length)&&l[P]||`${e} ${E}`}}),D={scaleAttributes:n,splitMethod:c,flights:T};if(i){let P=_k({flightProfile:D,deleteExisting:o,event:p});return{splitEntries:Fa()&&w||void 0,...P}}else return{flightProfile:D,...J}}function L4({json:t,tagName:e}){let i=Object.keys(t).filter(a=>Array.isArray(t[a])).map(a=>({key:a,value:t[a].filter(o=>typeof o=="object"&&Object.keys(o).length===1)})),r=Object.keys(t).filter(a=>typeof t[a]=="object"&&!Array.isArray(t[a])).map(a=>({key:a,value:t[a]})),n=Object.keys(t).filter(a=>["string","number"].includes(typeof t[a])).map(a=>({key:a,value:t[a]}));return _4({tagName:e,attributes:n,childArrays:i,childObjects:r})}function _4(t){let{tagName:e,attributes:i=[],childArrays:r=[],childObjects:n}=t,a=`\r
`,o=m=>{let h=Object.keys(m)[0],f=m[h];return{key:h,value:f}},s=r==null?void 0:r.map(({key:m,value:h})=>_4({tagName:m,childObjects:h.map(o)})).join(`\r
`),l=n==null?void 0:n.map(({key:m,value:h})=>L4({tagName:m,json:h??[]})).join(`\r
`),u=i==null?void 0:i.map(({key:m,value:h})=>`${m}="${h}"`).join(" "),c=u?` ${u}`:"";if(e==="childArray")return l;let d=l!=null&&l.length?`${a}${l}${a}`:"",p=s!=null&&s.length?`${a}${s}${a}`:"";return`<${e}${c}>${d}${p}</${e}>`}function Zpe(t){var I,b,S;let e=ze(t,[{[wr]:!0}]);if(e.error)return e;let{tournamentRecord:i}=t,{startDate:r,tournamentId:n,tournamentName:a}=i,{participantMap:o,matchUps:s,mappedMatchUps:l}=Ni({withMatchUps:!0,withEvents:!0,tournamentRecord:i}),u=i.participants.filter(w=>w.participantType===Kt),c=(s==null?void 0:s.filter(w=>w.matchUpType===Kt))??[],d=(c==null?void 0:c.reduce((w,U)=>{let T=(U==null?void 0:U.tieMatchUps)??[];return T&&[...w,...T]},[]))??[],p=(s==null?void 0:s.filter(w=>w.matchUpType===ti))??[],m=(s==null?void 0:s.filter(w=>w.matchUpType===Zt))??[],h=d.length===p.length+m.length,f=c.length===1&&h,g={mappedMatchUps:l,participantMap:o,tournamentName:a,tournamentId:n,tournament:h?"N":"Y",startDate:r},v=[],y=[];if(f){let w=c[0],{json:U,xml:T}=mV({teamParticipants:u,teamMatchUp:w,...g,doubles:m,singles:p});y.push(U),v.push(T)}else for(let w of c){let U=(I=w==null?void 0:w.sides)==null?void 0:I.map(({participant:E})=>E==null?void 0:E.participantId).filter(Boolean);if((U==null?void 0:U.length)!==2)continue;let T=U.map(E=>{var R;return E&&((R=o==null?void 0:o[E])==null?void 0:R.participant)}),{xml:D,json:P}=mV({doubles:(b=w.tieMatchUps)==null?void 0:b.filter(E=>E.matchUpType===Zt),singles:(S=w.tieMatchUps)==null?void 0:S.filter(E=>E.matchUpType===ti),teamParticipants:T,teamMatchUp:w,...g});y.push(P),v.push(D)}return{json:y,xml:v,...J}}function mV({teamParticipants:t,mappedMatchUps:e,participantMap:i,tournamentName:r,tournamentId:n,teamMatchUp:a,tournament:o,startDate:s,doubles:l,singles:u}){var b,S,w,U;let c=t==null?void 0:t.find(T=>{var D;return(D=T.participantRoleResponsibilities)==null?void 0:D.includes("Home")}),d=t==null?void 0:t.filter(T=>T.participantId!==(c==null?void 0:c.participantId)),p=Bo(s,"/","MDY"),m=(c==null?void 0:c.participantName)||((b=d==null?void 0:d[1])==null?void 0:b.participantName),h=(c==null?void 0:c.participantId)||((S=d==null?void 0:d[1])==null?void 0:S.participantId),f=(w=d==null?void 0:d[0])==null?void 0:w.participantName,g=(U=d==null?void 0:d[0])==null?void 0:U.participantId,v={},y=t.map(T=>({team:{...ime({teamParticipant:T,teamMatchUp:a,uniValues:v,participantMap:i,mappedMatchUps:e,homeid:h})}})),I=Ge({venue:{tournamentname:o?r:void 0,neutralgame:c?"N":"Y",gameid:n,officials:{},tournament:o,rules:{},homename:m,visname:f,homeid:h,visid:g,date:p},childArray:y,singles_matches:u==null?void 0:u.map(T=>hV({matchUp:T,homeid:h,uniValues:v})),doubles_matches:l==null?void 0:l.map(T=>hV({matchUp:T,homeid:h,uniValues:v}))});return{json:I,xml:L4({json:I,tagName:"tngame"})}}function eme({homeid:t,uniValues:e,participant:i}){var f,g,v,y,I,b,S,w,U,T,D,P,E,R,N;if(!i)return{};let r=((f=i.individualParticipants)==null?void 0:f.length)===2,n=r?ct((g=i.individualParticipants)==null?void 0:g.map(A=>{var M,C;return(C=(M=A.teams)==null?void 0:M[0])==null?void 0:C.participantId})):[],a=r?ct((v=i.individualParticipants)==null?void 0:v.map(A=>{var M,C;return(C=(M=A.teams)==null?void 0:M[0])==null?void 0:C.teamId})):[],o=!r&&((I=(y=i.teams)==null?void 0:y[0])==null?void 0:I.participantId)||(n==null?void 0:n.length)===1&&n[0]||void 0,s=!r&&((S=(b=i.teams)==null?void 0:b[0])==null?void 0:S.teamId)||(a==null?void 0:a.length)===1&&a[0]||o,l=r?void 0:i.participantName,u=(U=(w=i.individualParticipants)==null?void 0:w[0])==null?void 0:U.participantName,c=(D=(T=i.individualParticipants)==null?void 0:T[1])==null?void 0:D.participantName,d=t&&(o===t?"H":"V")||"",p=r?void 0:e[o][i.participantId],m=e[o][(E=(P=i.individualParticipants)==null?void 0:P[0])==null?void 0:E.participantId],h=e[o][(N=(R=i.individualParticipants)==null?void 0:R[1])==null?void 0:N.participantId];return Ge({vh:d,uni:p,uni_1:m,uni_2:h,team:s,name:l,name_1:u,name_2:c})}function tme({sets:t,sideNumber:e}){return Object.assign({},...(t==null?void 0:t.map(i=>{let{setNumber:r,side1Score:n,side2Score:a,side1TiebreakScore:o,side2TiebreakScore:s}=i,l=`set_${r}`,u=`tie_${r}`,c=e===1?n:a,d=e===1?o:s;return{[l]:c,[u]:d}}))??[])}function ime({teamParticipant:t,teamMatchUp:e,participantMap:i,mappedMatchUps:r,homeid:n,uniValues:a}){var b,S,w,U,T,D,P,E,R,N,A,M,C,O;let{participantId:o,participantName:s}=t,l=n&&(o===n?"H":"V")||"",u=(b=i==null?void 0:i[o])==null?void 0:b.matchUps,c=u&&Object.keys(u),d=(w=(S=e==null?void 0:e.sides)==null?void 0:S.find(({participant:k})=>k.participantId===o))==null?void 0:w.sideNumber,p=((D=(T=(U=e==null?void 0:e.score)==null?void 0:U.sets)==null?void 0:T[0])==null?void 0:D[`side${d}Score`])??0;a[o]={};let m={SINGLES:{w:0,l:0},DOUBLES:{w:0,l:0}},h=[],f=[],g=0;for(let k of c??[]){let x=r==null?void 0:r[k],F=(P=x.sides.find(({participant:_})=>_.participantId===o))==null?void 0:P.sideNumber,$=((N=(R=(E=x.score)==null?void 0:E.sets)==null?void 0:R[0])==null?void 0:N[`side${F}Score`])??0;g+=$;for(let _ of x.tieMatchUps??[]){let{matchUpType:L,winningSide:B}=_,V=B&&(B===F?"w":"l")||"";V&&(m[L][V]+=1);let G=V==="w"?"1":"0",j=V==="l"?"1":"0";if(L===ti){let z=f.length+1;f.push({singles_pair:{pair:z,won:G,lost:j,tied:"0"}})}else if(L===Zt){let z=h.length+1;h.push({doubles_pair:{pair:z,won:G,lost:j,tied:"0"}})}}}let v=[{singles:{childArray:f,won:m.SINGLES.w,lost:m.SINGLES.l}},{doubles:{childArray:h,won:m.DOUBLES.w,lost:m.DOUBLES.l}}],y=[],I=1;for(let k of t.individualParticipantIds){let x=i==null?void 0:i[k];if(x){let{participant:F,counters:$}=x,_={won:((A=$==null?void 0:$.DOUBLES)==null?void 0:A.wins)||0,lost:((M=$==null?void 0:$.DOUBLES)==null?void 0:M.losses)||0},L={won:((C=$==null?void 0:$.SINGLES)==null?void 0:C.wins)||0,lost:((O=$==null?void 0:$.SINGLES)==null?void 0:O.losses)||0},{participantName:B,participantId:V}=F;a[o][V]=I,y.push({player:{name:B,uni:I,singles:L,doubles:_}})}I+=1}return{vh:l,id:o,name:s,score:p||g,totals:v,childArray:y}}function hV({matchUp:t,homeid:e,uniValues:i}){let{collectionPosition:r,orderOfFinish:n,matchUpType:a,sides:o}=t??{},s=o==null?void 0:o.map(l=>{var p;let{sideNumber:u,participant:c}=l,d=tme({sets:(p=t.score)==null?void 0:p.sets,sideNumber:u});return{[a===ti?"singles_score":"doubles_score"]:{...eme({homeid:e,uniValues:i,participant:c}),...d}}});return{[a===ti?"singles_match":"doubles_match"]:{match:r,order:n,childArray:s}}}var rme="ASC",$4="ASC",nme="DESC",s1="DESC",ame={ASC:rme,ASCENDING:$4,DESC:nme,DESCENDING:s1};function B4(t){var E,R,N,A,M;let{tieFormat:e}=t,{useDefaultEventRanking:i,tournamentRecord:r,drawDefinition:n,scaleAccessor:a,singlesOnly:o,attach:s,event:l}=t;if((l==null?void 0:l.eventType)!==Sa)return{error:Bl};if(!r)return{error:ge};if(!e&&!n)return{error:xa};if(e=e??((E=vn({drawDefinition:n,event:l}))==null?void 0:E.tieFormat),Hn({tieFormat:e}).error)return{error:Pl};if(typeof a!="object"&&!i)return{error:oe,context:{scaleAccessor:a}};let u={},c=((n==null?void 0:n.entries)??(l==null?void 0:l.entries)??[]).filter(C=>(C==null?void 0:C.entryStatus)===oa).map(Ut),{participants:d=[]}=Ni({withIndividualParticipants:!0,withScaleValues:!0,tournamentRecord:r}),p=d.filter(({participantId:C})=>c.includes(C)),m=C=>C===wc?"rankings":"ratings",h=((R=l==null?void 0:l.category)==null?void 0:R.categoryName)??((N=l==null?void 0:l.category)==null?void 0:N.ageCategoryCode),{scaleName:f=h,scaleType:g=wc,sortOrder:v,accessor:y}=a||{},I=m(g),b=(C,O)=>{var x,F,$;let k=(x=C[I])==null?void 0:x[O];if(!k&&i&&(k=(F=C[I])==null?void 0:F[qp]),Array.isArray(k)){let _=($=k.find(L=>L.scaleName===f))==null?void 0:$.scaleValue;if(Li(_))return _;if(y&&typeof _=="object")return _[y]}return 0},S=(C,O,k)=>{let x=v===s1?O:C,F=v===s1?C:O;return b(x,k)-b(F,k)},w=(C,O)=>S(C,O,qp),U=(C,O)=>S(C,O,Md),T=[],D=(e==null?void 0:e.collectionDefinitions)??[];for(let C of p){let O=((A=C.individualParticipants)==null?void 0:A.sort(w))??[],k=o?O:((M=C.individualParticipants)==null?void 0:M.sort(U))??[],x={};for(let $ of D){let _=[],{collectionId:L,matchUpCount:B,matchUpType:V,gender:G}=$,j=Yi(qp)(V);Se(0,B).forEach(z=>{let W=j?O:k??[],q=z+1,Y=[];Se(0,j?1:2).forEach(re=>{var H;let K=(H=W==null?void 0:W.find(Z=>{var ie;let X=G&&([Jt,pi].includes(G)&&G||G===Bn&&[Jt,pi][re]);return(!X||X===((ie=Z.person)==null?void 0:ie.sex))&&!_.includes(Z.participantId)}))==null?void 0:H.participantId;K&&(Y.push(K),_.push(K),x[K]||(x[K]=[]),x[K].push({collectionPosition:q,collectionId:L}))}),j||T.push(Y)})}let F=Object.keys(x).map($=>({collectionAssignments:x[$],participantId:$}));u[C.participantId]=F}let P=[];for(let C of T){let{participant:O}=es({tournamentParticipants:d,participantIds:C});if(!O){let k={individualParticipantIds:C,participantRole:Qr,participantType:ht};P.push(k)}}if(s){for(;P.length;)al({participant:P.pop(),tournamentRecord:r});Lt({element:n,extension:{name:Tu,value:u}})}return{...J,lineUps:u,participantsToAdd:P}}function Bk(t){if(!t)return{error:Xe};let e=ze(t,[{dates:!1,[Kr]:o=>Array.isArray(o)&&o.every(Ia)},{uuids:!1,[Kr]:o=>Array.isArray(o)&&o.every(Ti)},{startTime:!1,endTime:!1,[Kr]:GN},{idPrefix:!1,namePrefix:!1,[Kr]:Ti},{count:!0,[Kr]:Li}]);if(e.error)return e;let{startDate:i,endDate:r}=t.tournamentRecord??{},n=t.dates||i&&r&&Rf(i,r)||[],a=Se(1,t.count+1).map(o=>{var s,l;return Ge({courtId:((s=t.uuids)==null?void 0:s.pop())??(t.idPrefix&&`${t.idPrefix}-${o}`)??Gt(),courtName:((l=t.courtNames)==null?void 0:l.pop())??(t.namePrefix&&`${t.namePrefix} ${o}`),dateAvailability:n.map(u=>({startTime:t.startTime??"08:00",endTime:t.endTime??"20:00",date:u}))})});return{...J,courts:a}}var V4={};yt(V4,{default:()=>lme,garman:()=>H4});function kb({court:t,date:e}){let i=e&&t.dateAvailability.find(n=>Vl(n.date,e)),r=t.dateAvailability.find(n=>!n.date);return i||r}function Jg(t){let e=ze(t,[{courtDate:!0,_ofType:ea}]);if(e.error)return e;let{includeBookingTypes:i=[],courtDate:r}=t,n=[],a=ir(r.startTime);(r.bookings||[]).filter(s=>!s.bookingType||!i.includes(s.bookingType)).sort((s,l)=>hS(s.startTime).localeCompare(hS(l.startTime))).forEach(s=>{let l={startTime:bi(a.toISOString()),endTime:s.startTime};ir(s.startTime)>a&&n.push(l),ir(s.endTime)>a&&(a=ir(s.endTime))});let o={startTime:bi(a.toISOString()),endTime:r.endTime};return ir(r.endTime)>a&&n.push(o),{timeSlots:n}}function ome({averageMatchUpMinutes:t,includeBookingTypes:e,periodStartTime:i,periodEndTime:r}){let n=o=>{var l;let{timeSlots:s}=Jg({includeBookingTypes:e,courtDate:o});return!!((l=s==null?void 0:s.filter(a))!=null&&l.length)};function a(o){let s=ir(o.startTime),l=ir(o.endTime);return s>i||l<r?!1:Oy(i,l)>=t}return{enoughTime:n}}function j4(t){let e=ze(t,[{periodStart:!0,date:!0},{courts:!0,_ofType:un}]);if(e.error)return e;let{averageMatchUpMinutes:i,includeBookingTypes:r,periodStart:n,date:a}=t,o=t.courts,s=ir(n),l=zN(s,i),{enoughTime:u}=ome({averageMatchUpMinutes:i,includeBookingTypes:r,periodStartTime:s,periodEndTime:l});return{availableToScheduleCount:((o==null?void 0:o.filter(c=>{if(!Array.isArray(c.dateAvailability))return!1;let d=kb({date:a,court:c});return!!(d&&u(d))}))||[]).length,...J}}function CD(t){var p;let{remainingScheduleTimes:e=[],clearScheduleDates:i,periodLength:r=30,scheduleDate:n,courts:a=[]}=t,{bookings:o=[]}=t;if(!Array.isArray(a)||!a.length)return{error:oe,courts:a};if(!Array.isArray(o))return{error:cS};if(!Ia(n))return{error:Ar};i&&(Array.isArray(i)?i.includes(n)&&(o=[]):o=[]);let{courtBookings:s,unassignedBookings:l}=o.reduce((m,h)=>{let{courtId:f}=h;return f?m.courtBookings[f]?m.courtBookings[f].push(h):m.courtBookings[f]=[h]:m.unassignedBookings.push(h),m},{courtBookings:{},unassignedBookings:[]}),u=a.map((m,h)=>{let{courtId:f,courtName:g}=m,v=s[f]||[],y=kb({date:n,court:m})||{},{bookings:I=[],startTime:b,endTime:S,date:w}=y,U=[e[h]&&{startTime:b,endTime:e[h]},...Me(I,!1,!0),...v].filter(Boolean);return{courtId:f,courtName:g,dateAvailability:{bookings:U,startTime:b,endTime:S,date:w}}});l.sort((m,h)=>kt(m.startTime)-kt(h.startTime));let c=()=>u.map(m=>{let h=m.dateAvailability,{timeSlots:f=[]}=Jg({courtDate:h});return{courtName:m.courtName,courtId:m.courtId,timeSlots:f}}).flat(),d=[];for(let m of l){let{startTime:h,endTime:f,averageMinutes:g,recoveryMinutes:v,matchUpId:y}=m,I=kt(h),b=kt(f),S=c().reduce((w,{courtId:U,courtName:T,timeSlots:D})=>{let P;return D.find(({startTime:E,endTime:R})=>{P=kt(E)-I;let N=I>=kt(E);return b<=kt(R)&&w.startDifference!==0&&((P===0||P+r>=0)&&(w.startDifference===void 0||P<w.startDifference)||N)})?{courtName:T,courtId:U,startDifference:P}:w},{});if(S.courtId){let w={averageMinutes:g,recoveryMinutes:v,matchUpId:y,startTime:h,endTime:f};d.push(w),(p=u.find(({courtId:U})=>U===S.courtId))==null||p.dateAvailability.bookings.push(w)}else console.log({unassignedBooking:m})}return{virtualCourts:u.map(({courtId:m,courtName:h,dateAvailability:f})=>({dateAvailability:[f],courtName:h,courtId:m})),assignedBookings:d}}function MD({averageMatchUpMinutes:t,periodLength:e=30,recoveryMinutes:i}){let r=(t||90)+(i||0);return e>r?r:e||30}function G4(t){let{startTime:e="8:00",endTime:i="20:30",count:r=10,date:n}=t??{};return Se(0,r).map(()=>({dateAvailability:[{date:n,startTime:e,endTime:i}]}))}function Wf({scheduleDate:t,startTime:e,endTime:i,courts:r}){let n=e&&"startTime"||i&&"endTime"||void 0;return r.reduce((a,o)=>{let s=kb({date:t,court:o}),l=n&&((s==null?void 0:s[n])||o[n]);return l&&(!a||e&&kt(l)<kt(a)||i&&kt(l)>kt(a))?l:a},void 0)}function sme({averageMinutes:t,startTime:e,endTime:i,courts:r,date:n}){e=e||Wf({courts:r,scheduleDate:n,startTime:!0}),i=i||Wf({courts:r,scheduleDate:n,endTime:!0});let a;if(e&&i){let o=ir(e),s=ir(i);for(let l of r||[]){if(!Array.isArray(l.dateAvailability))continue;let u=kb({court:l,date:n}),{timeSlots:c}=Jg({courtDate:u});c==null||c.forEach(d=>{let p=ir(d.startTime),m=ir(d.endTime);if(p>s||p<o||m<o)return!1;if(Oy(p,m)>=t){let h=bi(p.toISOString());(!a||h<a)&&(a=h)}})}}return{firstTimeSlotStartTime:a}}function Vk(t){let e=ze(t,[{courts:!0,_ofType:un}]);if(e.error)return e;let{date:i=jN(),startTime:r="08:00",endTime:n="19:00",periodLength:a,courts:o}=t,{calculateStartTimeFromCourts:s=!0,remainingScheduleTimes:l,averageMatchUpMinutes:u,clearScheduleDates:c,courtsCount:d,bookings:p}=t;a=a||MD({averageMatchUpMinutes:u}),i=pt(i),r=bi(r),n=bi(n);let m=0,h=0,f=0,g=0,v=0;!o&&d&&(o=G4({startTime:r,endTime:n,count:d,date:i}));let{virtualCourts:y}=CD({remainingScheduleTimes:l,clearScheduleDates:c,scheduleDate:i,periodLength:a,bookings:p,courts:o}),{firstTimeSlotStartTime:I}=sme({averageMinutes:u,courts:y,startTime:r,endTime:n,date:i});s&&I&&(r=I||r);let b=kt(r),S=kt(n)-b,w=Math.floor(S/a),U=Se(0,w+1).map(T=>{let D=b+T*a,P=Pae(D),E=j4({courts:y??[],averageMatchUpMinutes:u,periodStart:P,date:i});if(E.error)return{error:E.error};let{availableToScheduleCount:R=0}=E,N=R>h?R-h:0;v+=T?R:0;let A=T?v/T:R,M=a*A/u,C=T?M*(T-1)+A:A,O=R?h&&C-m||N:0;m=C,h=R,f+=O;let k=Qe(f)-g;return g+=k,{periodStart:P,add:k,availableToScheduleCount:R,newCourts:N,totalMatchUps:g}});return{scheduleTimes:U.reduce((T,D)=>{let P=Se(0,D.add).map(()=>({scheduleTime:D.periodStart}));return T.concat(...P)},[]).flat(),timingProfile:U,totalMatchUps:g}}var H4={getCourtsAvailableAtPeriodStart:j4,generateTimeSlots:Jg,getScheduleTimes:Vk,courtGenerator:G4},lme=H4,z4={};yt(z4,{isValid:()=>Ua,isValidMatchUpFormat:()=>Ua,parse:()=>kn,stringify:()=>oT});var W4={};yt(W4,{allCompetitionMatchUps:()=>Es,allDrawMatchUps:()=>Sn,allEventMatchUps:()=>tu,allTournamentMatchUps:()=>Vr,analyzeMatchUp:()=>VI,applyLineUps:()=>fY,assignMatchUpSideParticipant:()=>Y4,assignTieMatchUpParticipantId:()=>BS,bulkMatchUpStatusUpdate:()=>dY,calculateWinCriteria:()=>hh,checkInParticipant:()=>Gk,checkMatchUpIsComplete:()=>Rd,checkOutParticipant:()=>jk,competitionScheduleMatchUps:()=>Nb,disableTieAutoCalc:()=>lY,drawMatchUps:()=>Dk,enableTieAutoCalc:()=>aY,eventMatchUps:()=>UD,filterMatchUps:()=>lu,findMatchUp:()=>uk,getAllDrawMatchUps:()=>mr,getAllStructureMatchUps:()=>Wt,getCheckedInParticipantIds:()=>rh,getCompetitionMatchUps:()=>BI,getEventMatchUpFormatTiming:()=>gk,getHomeParticipantId:()=>bk,getMatchUpCompetitiveProfile:()=>tb,getMatchUpContextIds:()=>wk,getMatchUpDailyLimits:()=>TD,getMatchUpDailyLimitsUpdate:()=>vk,getMatchUpDependencies:()=>us,getMatchUpFormat:()=>Uk,getMatchUpFormatTiming:()=>ib,getMatchUpFormatTimingUpdate:()=>fk,getMatchUpScheduleDetails:()=>FT,getMatchUpType:()=>LT,getMatchUpsStats:()=>Sk,getModifiedMatchUpFormatTiming:()=>wD,getParticipantResults:()=>yb,getPredictiveAccuracy:()=>yk,getRoundMatchUps:()=>En,getRounds:()=>Tk,isValidMatchUpFormat:()=>Ua,matchUpActions:()=>ZT,mutate:()=>q4,participantScheduledMatchUps:()=>Ik,query:()=>n4,removeDelegatedOutcome:()=>oY,removeMatchUpSideParticipant:()=>Wk,removeTieMatchUpParticipantId:()=>X4,replaceTieMatchUpParticipantId:()=>zk,resetAdHocMatchUps:()=>mY,resetMatchUpLineUps:()=>Zk,resetScorecard:()=>tx,resetTieFormat:()=>ex,setDelegatedOutcome:()=>pY,setMatchUpFormat:()=>uY,setMatchUpStatus:()=>Fb,setOrderOfFinish:()=>hY,substituteParticipant:()=>sY,tallyParticipantResults:()=>zg,toggleParticipantCheckInState:()=>ND,tournamentMatchUps:()=>SD,updateTieMatchUpScore:()=>Yu,validMatchUp:()=>NT,validMatchUps:()=>wo});var q4={};yt(q4,{applyLineUps:()=>fY,assignMatchUpSideParticipant:()=>Y4,assignTieMatchUpParticipantId:()=>BS,bulkMatchUpStatusUpdate:()=>dY,checkInParticipant:()=>Gk,checkOutParticipant:()=>jk,disableTieAutoCalc:()=>lY,enableTieAutoCalc:()=>aY,findMatchUp:()=>uk,removeDelegatedOutcome:()=>oY,removeMatchUpSideParticipant:()=>Wk,removeTieMatchUpParticipantId:()=>X4,replaceTieMatchUpParticipantId:()=>zk,resetAdHocMatchUps:()=>mY,resetMatchUpLineUps:()=>Zk,resetScorecard:()=>tx,resetTieFormat:()=>ex,setDelegatedOutcome:()=>pY,setMatchUpFormat:()=>uY,setMatchUpStatus:()=>Fb,setOrderOfFinish:()=>hY,substituteParticipant:()=>sY,toggleParticipantCheckInState:()=>ND,updateTieMatchUpScore:()=>Yu});function Y4({tournamentRecord:t,drawDefinition:e,participantId:i,sideNumber:r,matchUpId:n,event:a}){var u,c;if(i&&typeof i!="string")return{error:Ts};if(!e)return{error:_e};if(!n)return{error:yn};let o=r===void 0;if(o&&(r=1),![1,2].includes(r))return ee({result:{error:oe,context:{sideNumber:r}}});let{matchUp:s,structure:l}=wi({drawDefinition:e,matchUpId:n,event:a});if(!s)return{error:dn};if(!(!(l!=null&&l.structures)&&!(e.drawType&&e.drawType!==La)&&!((u=l==null?void 0:l.matchUps)!=null&&u.find(({roundPosition:d})=>!!d))))return{error:mN};if(!i&&((c=s==null?void 0:s.score)!=null&&c.scoreStringSide1||vr.includes(s==null?void 0:s.matchUpstatus)||s!=null&&s.matchUpStatus&&[er,cr].includes(s.matchUpStatus)))return{error:W0,info:"matchUp has completed status or score"};if(s){if(s.sides=[1,2].map(d=>{var m;let p=((m=s.sides)==null?void 0:m.find(h=>h.sideNumber===d))??{sideNumber:d};return r===d?{...p,participantId:i}:p}),o)for(let d of s.sides)d.sideNumber&&(d.sideNumber=3-d.sideNumber);Rt({tournamentId:t==null?void 0:t.tournamentId,context:"assignSideParticipant",drawDefinition:e,matchUp:s})}return{...J,sidesSwapped:o}}function Da({removePriorValues:t,tournamentRecord:e,duplicateValues:i,drawDefinition:r,disableNotice:n,matchUpId:a,timeItem:o,event:s}){let{matchUp:l}=wi({drawDefinition:r,event:s,matchUpId:a});if(!l)return{error:dn};let u=vl({removePriorValues:t,element:l,duplicateValues:i,timeItem:o});return n||Rt({tournamentId:e==null?void 0:e.tournamentId,eventId:s==null?void 0:s.eventId,context:"addTimeItem",drawDefinition:r,matchUp:l}),u}function jk(t){var y;let e=[{[wr]:!0},{[Fn]:!0},{[Hl]:!0},{[fl]:!0}],i=ze(t,e);if(i.error)return i;let r=qg(t,[{[Og]:Zl,attr:{[hT]:!0}}]);if(r.error)return r;let{tournamentRecord:n,drawDefinition:a,participantId:o,matchUpId:s}=t,l=(y=r==null?void 0:r.matchUp)==null?void 0:y.matchUp,{matchUpStatus:u,score:c}=l??{};if(u&&fA.includes(u)||u&&vr.includes(u)||Ir({score:c}))return{error:NG};let d=rh({matchUp:l});if(d!=null&&d.error)return d;let{checkedInParticipantIds:p,allRelevantParticipantIds:m}=d??{};if(!(m!=null&&m.includes(o)))return{error:Ts};if(!(p!=null&&p.includes(o)))return{error:aH};let h=kW({matchUp:l});if(h!=null&&h.error)return h;let{sideParticipantIds:f,nestedIndividualParticipantIds:g}=h??{},v=f==null?void 0:f.indexOf(o);return v!==void 0&&[0,1].includes(v)&&((g==null?void 0:g[v])??[]).forEach(I=>{Da({drawDefinition:a,matchUpId:s,timeItem:{itemType:SS,itemValue:I}})}),Da({tournamentRecord:n,drawDefinition:a,matchUpId:s,timeItem:{itemValue:o,itemType:SS}}),{...J,checkedOut:!0}}function Gk(t){var p;let e=[{[wr]:!0},{[Fn]:!0},{[Hl]:!0},{[fl]:!0}],i=ze(t,e);if(i[Vo])return i;let r=qg(t,[{[Og]:Zl,attr:{[hT]:!0}}]);if(r[Vo])return r;let{tournamentRecord:n,drawDefinition:a,participantId:o,matchUpId:s}=t,l=rh({matchUp:(p=r==null?void 0:r.matchUp)==null?void 0:p.matchUp});if(l!=null&&l.error)return l;let{checkedInParticipantIds:u,allRelevantParticipantIds:c}=l??{};if(!(c!=null&&c.includes(o)))return{[Vo]:Ts};let d={...J,checkedIn:!0};return u!=null&&u.includes(o)||Da({tournamentRecord:n,drawDefinition:a,matchUpId:s,timeItem:{itemValue:o,itemType:US}}),d}function ND(t){var u,c;let e=ze(t,[{[Hl]:!0,[Fn]:!0,[fl]:!0}]);if(e.error)return e;let i=t.tournamentId??t.activeTournamentId,r=t.tournamentRecord??(i&&((u=t.tournamentRecords)==null?void 0:u[i]));if(!r)return{error:ge};let n=(c=qg(t,[{[Og]:Zl,attr:{[hT]:!0},[Vo]:dn}]).matchUp)==null?void 0:c.matchUp;if(!n)return{error:dn};let{checkedInParticipantIds:a=[]}=rh({matchUp:n}),{participantId:o,matchUpId:s,drawDefinition:l}=t;return o&&a.includes(o)?jk({tournamentRecord:r,drawDefinition:l,participantId:o,matchUpId:s,matchUp:n}):Gk({tournamentRecord:r,drawDefinition:l,participantId:o,matchUpId:s,matchUp:n})}function Hk({tournamentRecord:t,drawDefinition:e,tieMatchUpId:i,event:r}){var w,U;if(!t)return{error:ge};if(!e)return{error:xs};if(!r)return{error:lo};let n=sn({drawDefinition:e}),{matchUp:a}=wi({matchUpId:i,drawDefinition:e,matchUpsMap:n});if(!a)return{error:dn};let{matchUp:o,structure:s}=wi({tournamentParticipants:t.participants,matchUpId:i,inContext:!0,drawDefinition:e,matchUpsMap:n,event:r});if(!o)return{error:dn};let{collectionPosition:l,drawPositions:u,collectionId:c,matchUpTieId:d,matchUpType:p}=o;if(p&&!B0([ti,Zt],p))return{error:aa};let{positionAssignments:m}=oi({structure:s}),h=m==null?void 0:m.filter(T=>u==null?void 0:u.includes(T.drawPosition)),{matchUp:f}=wi({matchUpId:d,drawDefinition:e,matchUpsMap:n}),g=((w=f==null?void 0:f.sides)==null?void 0:w.map(Ut))??[],v=(h==null?void 0:h.map(Ut))??[],y=[...g,...v],{participants:I}=Ni({tournamentRecord:t,participantFilters:{participantTypes:[Kt],participantIds:y}}),{matchUp:b}=wi({matchUpId:d,inContext:!0,drawDefinition:e,matchUpsMap:n}),S=(U=vn({matchUp:f,drawDefinition:e,structure:s,event:r}))==null?void 0:U.tieFormat;return{inContextDualMatchUp:b,inContextTieMatchUp:o,relevantAssignments:h,collectionPosition:l,teamParticipants:I,collectionId:c,matchUpType:p,dualMatchUp:f,tieMatchUp:a,tieFormat:S,structure:s,...J}}function zk(t){var k,x,F,$,_,L,B,V,G,j,z,W,q,Y,re,K;let e=Hk(t);if(e.error)return e;let i="replaceTieMatchUpParticipantid",{existingParticipantId:r,tournamentRecord:n,newParticipantId:a,drawDefinition:o,substitution:s,event:l}=t;if(!r||!a)return ee({result:{error:pr},stack:i});if(r===a)return{...J};let{inContextDualMatchUp:u,inContextTieMatchUp:c,collectionPosition:d,collectionId:p,dualMatchUp:m,tieMatchUp:h,tieFormat:f}=e,g=c==null?void 0:c.matchUpType,v=(k=c==null?void 0:c.sides)==null?void 0:k.find(H=>{var Z,X,ie;return((Z=H.participant)==null?void 0:Z.participantId)===r||((ie=(X=H.participant)==null?void 0:X.individualParticipantIds)==null?void 0:ie.includes(r))});if(!v)return{error:zi};let y=((x=Ni({tournamentRecord:n,participantFilters:{participantIds:[r,a]}}))==null?void 0:x.participants)??[];if(y.length!==2)return ee({result:{error:pr},stack:i});if(y[0].participantType!==y[1].participantType)return ee({result:{error:Ds},stack:i});let{appliedPolicies:I}=$t({tournamentRecord:n,drawDefinition:o,event:l}),b=((F=t.policyDefinitions)==null?void 0:F[kr])??(I==null?void 0:I[kr])??Vg[kr],S=y.find(({participantId:H})=>H===a);if((t.enforceGender??(($=b==null?void 0:b.participants)==null?void 0:$.enforceGender))!==!1&&[Jt,pi].includes(c==null?void 0:c.gender)&&(c==null?void 0:c.gender)!==((_=S==null?void 0:S.person)==null?void 0:_.sex))return{error:Hm,info:"Gender mismatch"};let w=(L=b==null?void 0:b.processCodes)==null?void 0:L.substitution;wb({tournamentId:n.tournamentId,eventId:l.eventId,inContextDualMatchUp:u,drawDefinition:o,dualMatchUp:m});let U=(B=m==null?void 0:m.sides)==null?void 0:B.find(({sideNumber:H})=>H===v.sideNumber);if(!U)return ee({result:{sideNumber:v.sideNumber,existingParticipantId:r,error:$r},stack:i});if((G=(V=c==null?void 0:c.sides)==null?void 0:V.flatMap(H=>{var Z,X;return((Z=H.participant)==null?void 0:Z.individualParticipantIds)||((X=H.participant)==null?void 0:X.participantId)||[]}))!=null&&G.includes(a))return ee({result:{error:Y0},stack:i});let T=(z=(j=u==null?void 0:u.sides)==null?void 0:j.find(({sideNumber:H})=>H===v.sideNumber))==null?void 0:z.participantId,D=U.lineUp,P=D==null?void 0:D.find(({participantId:H})=>a===H),E=D==null?void 0:D.reduce((H,Z)=>Z.substitutionOrder>H?Z.substitutionOrder:H,0),R=(D==null?void 0:D.map(H=>{var X;let Z=Me(H,!1,!0);if(![r,a].includes(Z.participantId))return Z;if(!s&&[r,a].includes(Z.participantId)&&(Z.collectionAssignments=(X=Z.collectionAssignments)==null?void 0:X.filter(ie=>!(ie.collectionPosition===d&&ie.collectionId===p))),s&&r===Z.participantId&&(Z.collectionAssignments=Z.collectionAssignments.map(ie=>ie.collectionPosition===d&&ie.collectionId===p&&ie.substitutionOrder===void 0?{...ie,substitutionOrder:E}:ie)),Z.participantId===a){Z.collectionAssignments||(Z.collectionAssignments=[]);let ie={collectionId:p,collectionPosition:d};s&&(ie.previousParticipantId=r,ie.substitutionOrder=(E??0)+1),Z.collectionAssignments.push(ie)}return Z}))??[];if(!P){let H={collectionId:p,collectionPosition:d};s&&(H.substitutionOrder=(E??0)+1,H.previousParticipantId=r);let Z={collectionAssignments:[H],participantId:a};R.push(Z)}let N=g===Zt,{assignedParticipantIds:A}=TS({lineUp:D,collectionPosition:d,collectionId:p}),{assignedParticipantIds:M}=TS({lineUp:R,collectionPosition:d,collectionId:p});if(U.lineUp=R,T&&f){let H=ch({participantId:T,lineUp:R,drawDefinition:o,tieFormat:f});if(H.error)return ee({result:H,stack:i})}else console.log("team participantId not found");let C,O;if(N){let{tournamentRecord:H}=t,Z=es({participantIds:M,tournamentRecord:H});if(!Z.participant){let ie=al({returnParticipant:!0,pairOverride:!0,tournamentRecord:H,participant:{participantRole:Qr,individualParticipantIds:M,participantType:ht}});if(ie.error)return ee({result:ie,stack:i});C=(W=ie.participant)==null?void 0:W.participantId}Z=es({participantIds:A,tournamentRecord:H});let X=(q=Z.participant)==null?void 0:q.participantId;X&&lh({participantIds:[X],tournamentRecord:H}).success&&(O=X)}if(s||((Y=v.substitutions)==null?void 0:Y.length)===1){if(s)w&&h&&(h.processCodes=ct([...(h==null?void 0:h.processCodes)??[],...w]));else for(let H of w||[]){let Z=(re=h==null?void 0:h.processCodes)==null?void 0:re.lastIndexOf(H);Z!==void 0&&((K=h==null?void 0:h.processCodes)==null||K.splice(Z,1))}h&&Rt({tournamentId:n==null?void 0:n.tournamentId,matchUp:h,context:i,drawDefinition:o})}return m&&Rt({tournamentId:n==null?void 0:n.tournamentId,matchUp:m,context:i,drawDefinition:o}),{...J,modifiedLineUp:R,participantRemoved:O,participantAdded:C}}function K4({collectionPosition:t,teamParticipantId:e,dualMatchUpSide:i,drawDefinition:r,participantIds:n,collectionId:a}){var u;if(!a||!t||!Array.isArray(n))return{modifiedLineUp:(i==null?void 0:i.lineUp)||[],error:oe};let o=(i==null?void 0:i.lineUp)||((u=_d({participantId:e,drawDefinition:r}))==null?void 0:u.lineUp),s=[],l=[];return{modifiedLineUp:(o==null?void 0:o.map(c=>{var p;if(!n.includes(c.participantId))return c;let d=(p=c.collectionAssignments)==null?void 0:p.filter(m=>{let h=m.collectionId===a&&m.collectionPosition===t;return h&&(m.previousParticipantId&&s.push(m.previousParticipantId),l.push({participantId:c.participantId,...m})),!h});return{participantId:c.participantId,collectionAssignments:d}}).filter(Boolean))||[],assignmentsRemoved:l,previousParticipantIds:s}}function ume({individualParticipantIds:t,groupingParticipantId:e,tournamentRecord:i}){var a,o;let r=(i.events||[]).filter(s=>{var l;return(s==null?void 0:s.eventType)===sr&&((l=s==null?void 0:s.entries)==null?void 0:l.some(u=>u.participantId===e))}),n=s=>!t.includes(s.participantId);for(let s of r){s.entries=(s.entries||[]).filter(n);let{flightProfile:l}=Gi({event:s});(a=l==null?void 0:l.flights)==null||a.forEach(u=>{u.drawEntries=(u.drawEntries||[]).filter(n)}),(o=s==null?void 0:s.drawDefinitions)==null||o.forEach(u=>{u.entries=(u.entries||[]).filter(n)})}return{...J}}function AD({individualParticipantIds:t,groupingParticipantId:e,removeFromOtherTeams:i,tournamentRecord:r}){let n="addIndividualParticipantIds";if(!r)return ee({result:{error:ge},stack:n});if(!e||!t)return ee({result:{error:Xe},stack:n});let a=r.participants??[],o=a.find(d=>d.participantId===e);if(!o)return ee({result:{error:zi},stack:n});if(o!=null&&o.participantType&&![Kt,Wa].includes(o.participantType))return ee({context:{participantType:o.participantType},result:{error:Ds},stack:n});let s=t.filter(d=>{var p;return((p=a.find(m=>m.participantId===d))==null?void 0:p.participantType)!==St});if(s.length)return ee({result:{error:va,invalidParticipantIds:s},stack:n});o.individualParticipantIds||(o.individualParticipantIds=[]);let l=o.individualParticipantIds,u=t.filter(d=>!l.includes(d));u.length&&(i&&BT({individualParticipantIds:u,tournamentRecord:r}),o.individualParticipantIds=o.individualParticipantIds.concat(...u));let{topics:c}=vo();if(c.includes(nn)){let d=a.find(({participantId:p})=>p===e);lt({topic:nn,payload:{participants:[d]}})}return ume({individualParticipantIds:t,groupingParticipantId:e,tournamentRecord:r}),{groupingParticipant:Me(o,!1,!0),added:u.length,...J}}function OD(t){let{updateParticipantName:e=!0,groupingParticipantId:i,removeFromOtherTeams:r,tournamentRecord:n,pairOverride:a,participant:o}=t;if(!n)return{error:ge};if(!o)return{error:zm};if(!o.participantId)return al({tournamentRecord:n,participant:o});let{participant:s}=qc({participantId:o.participantId,tournamentRecord:n});if(!s)return al({tournamentRecord:n,participant:o});let{participantRoleResponsibilties:l,individualParticipantIds:u,participantOtherName:c,participantName:d,participantRole:p,participantType:m,onlineResources:h,contacts:f,person:g}=o;if(m&&s.participantType!==m)return{error:ZG};let v={};if(f&&(v.contacts=f),h&&(v.onlineResources=h),c&&Ti(c)&&(v.participantOtherName=c),d&&Ti(d)&&(v.participantName=d),Array.isArray(u)){let{participants:y}=Ni({participantFilters:{participantTypes:[St]},tournamentRecord:n}),I=y==null?void 0:y.map(Ut);if(I){let b=u.filter(S=>Ti(S)&&I.includes(S));([Wa,hi].includes(m||s.participantType)||m===ht&&(b.length===2||a))&&(v.individualParticipantIds=b),s.participantType===qv.PAIR&&e&&(v.participantName=cme({individualParticipants:y,newValues:v}))}}return Object.keys(XA).includes(p)&&(v.participantRole=p),Object.keys(qv).includes(m)&&(v.participantType=m),Array.isArray(l)&&(v.participantRoleResponsibilties=l),s.participantType===qv.INDIVIDUAL&&g&&dme({updateParticipantName:e,existingParticipant:s,newValues:v,person:g}),Object.assign(s,Ge(v)),i&&AD({individualParticipantIds:[s.participantId],groupingParticipantId:i,removeFromOtherTeams:r,tournamentRecord:n}),lt({topic:nn,payload:{tournamentId:n.tournamentId,participants:[s]}}),{participant:Me(s),...J}}function cme({individualParticipants:t,newValues:e}){let i=e.individualParticipantIds,r=t.filter(({participantId:n})=>i.includes(n)).map(({person:n})=>n==null?void 0:n.standardFamilyName).filter(Boolean).sort().join("/");return i.length===1&&(r+="/Unknown"),r}function dme({updateParticipantName:t,existingParticipant:e,newValues:i,person:r}){let n={},{standardFamilyName:a,standardGivenName:o,nationalityCode:s,personId:l,birthdate:u,tennisId:c,sex:d}=r;d&&Object.keys(nT).includes(d)&&(n.sex=d);let p;if(Ti(l)&&(n.personId=l),s&&Ti(s)&&(pme(s)||s==="")&&(n.nationalityCode=s),a&&typeof Ti(a)&&a.length>1&&(n.standardFamilyName=a,p=!0),o&&typeof Ti(o)&&o.length>1&&(n.standardGivenName=o,p=!0),p&&t){let m=`${n.standardGivenName} ${n.standardFamilyName}`;i.participantName=m}u&&Ia(u)&&(n.birthdate=u),c&&Ti(c)&&(n.tennisId=c),Object.assign(e.person,n)}function pme(t){return Xp.flatMap(({iso:e,ioc:i})=>[e,i]).filter(Boolean).includes(t)}function BS(t){var F,$,_,L,B,V,G,j,z,W,q,Y,re,K,H,Z,X,ie,ae,le;let e=Hk(t);if(e.error)return e;let i="assignTieMatchUpParticipantId",r=t.teamParticipantId,{tournamentRecord:n,drawDefinition:a,participantId:o,event:s}=t;if(!o)return ee({result:{error:pr},stack:i});if(t.sideNumber&&![1,2].includes(t.sideNumber))return ee({result:{error:SN},stack:i});let{inContextDualMatchUp:l,inContextTieMatchUp:u,relevantAssignments:c,collectionPosition:d,teamParticipants:p,collectionId:m,matchUpType:h,dualMatchUp:f,tieFormat:g}=e;if(($=(F=u==null?void 0:u.sides)==null?void 0:F.flatMap(ne=>{var de,ye;return((de=ne.participant)==null?void 0:de.individualParticipantIds)||((ye=ne.participant)==null?void 0:ye.participantId)||[]}))!=null&&$.includes(o))return ee({result:{...J},stack:i});r=r??(t.sideNumber?(L=(_=l==null?void 0:l.sides)==null?void 0:_.find(ne=>ne.sideNumber===t.sideNumber))==null?void 0:L.participantId:void 0);let v=(V=(B=Ni({participantFilters:{participantIds:[o]},tournamentRecord:n}))==null?void 0:B.participants)==null?void 0:V[0];if(!v)return ee({result:{error:zi},stack:i});let{appliedPolicies:y}=$t({tournamentRecord:n,drawDefinition:a,event:s}),I=((G=t.policyDefinitions)==null?void 0:G[kr])??(y==null?void 0:y[kr])??Vg[kr];if((t.enforceGender??((j=I==null?void 0:I.participants)==null?void 0:j.enforceGender))!==!1&&[Jt,pi].includes(u==null?void 0:u.gender)&&(u==null?void 0:u.gender)!==((z=v.person)==null?void 0:z.sex))return{error:Hm,info:"Gender mismatch"};let{individualParticipantIds:b,participantType:S}=v;if(Yi(ti)(h)&&S!==St)return{error:Ds};let w=S===St?[o]:b,U=r&&(p==null?void 0:p.find(({participantId:ne})=>ne===r))||(p==null?void 0:p.find(({individualParticipantIds:ne})=>Rn(w,ne)));if(!U)return{error:AN};if(r||(r=U.participantId),!r)return{error:zi};let T=(W=c==null?void 0:c.find(ne=>ne.participantId===(U==null?void 0:U.participantId)))==null?void 0:W.drawPosition,D=(Y=(q=f==null?void 0:f.sides)==null?void 0:q.find(ne=>ne.participantId===r))==null?void 0:Y.sideNumber,P=(K=(re=u==null?void 0:u.sides)==null?void 0:re.find(ne=>T&&ne.drawPosition===T))==null?void 0:K.sideNumber,E=D??P??t.sideNumber;if(!g)return{error:Rg};if(!((H=g.collectionDefinitions)!=null&&H.find(ne=>ne.collectionId===m)))return{error:HG};wb({tournamentId:n.tournamentId,eventId:s.eventId,inContextDualMatchUp:l,drawDefinition:a,dualMatchUp:f});let R=(Z=f==null?void 0:f.sides)==null?void 0:Z.find(ne=>ne.sideNumber===E),N=(X=u==null?void 0:u.sides)==null?void 0:X.find(ne=>ne.sideNumber===E),A=(le=(ae=(R==null?void 0:R.lineUp)??((ie=_d({participantId:r,drawDefinition:a}))==null?void 0:ie.lineUp))==null?void 0:ae.filter(ne=>{var de;return(de=ne.collectionAssignments)==null?void 0:de.find(ye=>ye.collectionPosition===d&&ye.collectionId===m&&!ye.previousParticipantId)}))==null?void 0:le.map(ne=>ne==null?void 0:ne.participantId),M=(A==null?void 0:A.length)>1&&A||(S===ht?v.individualParticipantIds:[o]),C=K4({collectionPosition:d,teamParticipantId:r,dualMatchUpSide:R,drawDefinition:a,participantIds:M,collectionId:m});if(C.error)return ee({result:C,stack:i});let{modifiedLineUp:O}=C,k;if(h===Zt){if(S!==ht){let ne=UE({collectionPosition:d,teamParticipantId:r,drawDefinition:a,modifiedLineUp:O,participantId:o,collectionId:m,tieFormat:g});if(ne!=null&&ne.error)return ee({result:ne,stack:i});if(ne=x({side:N}),ne.error)return ne;k=ne.deletedParticipantId,R&&(R.lineUp=O),f&&Rt({tournamentId:n==null?void 0:n.tournamentId,matchUp:f,context:i,drawDefinition:a})}else if(S===ht)for(let ne of M)UE({collectionPosition:d,teamParticipantId:r,drawDefinition:a,modifiedLineUp:O,participantId:ne,collectionId:m,tieFormat:g})}else{let ne=UE({collectionPosition:d,teamParticipantId:r,drawDefinition:a,modifiedLineUp:O,participantId:o,collectionId:m,tieFormat:g});if(ne!=null&&ne.error)return ne}if(R&&(R.lineUp=O),f&&Rt({tournamentId:n==null?void 0:n.tournamentId,matchUp:f,context:i,drawDefinition:a}),k){let{error:ne}=lh({participantIds:[k],tournamentRecord:n});ne&&console.log("cleanup")}return{...J,modifiedLineUp:O};function x({side:ne}){let de;if(ne.participant){let ye=ne.participant.individualParticipantIds||[];if(ye.filter(Boolean).length===1){let{participant:ce}=es({participantIds:ye,tournamentRecord:n});ye.push(o);let{participant:ke}=es({participantIds:ye,tournamentRecord:n});if(!ke&&ce){ce.individualParticipantIds=ye;let Pe=OD({pairOverride:!0,tournamentRecord:n,participant:ce});if(Pe.error)return Pe}else de=ce==null?void 0:ce.participantId}}else{let ye=al({participant:{individualParticipantIds:[o],participantRole:Qr,participantType:ht},pairOverride:!0,tournamentRecord:n});if(ye.error)return ye}return{...J,deletedParticipantId:de}}}function UE({collectionPosition:t,teamParticipantId:e,drawDefinition:i,modifiedLineUp:r,participantId:n,collectionId:a,tieFormat:o}){var c,d;let s=(c=_d({participantId:e,drawDefinition:i}))==null?void 0:c.lineUp,l=(d=r||s)==null?void 0:d.find(p=>(p==null?void 0:p.participantId)===n),u={collectionId:a,collectionPosition:t};if(l)l.collectionAssignments.push(u);else{let p={collectionAssignments:[u],participantId:n};r.push(p)}return ch({participantId:e,lineUp:r,drawDefinition:i,tieFormat:o})}function X4(t){var E,R,N,A,M,C,O,k,x,F,$,_,L,B,V,G,j,z,W,q,Y,re,K;let{tournamentRecord:e,drawDefinition:i,participantId:r,event:n}=t,a="removeTieMatchUpParticiapantId";if(!r)return ee({result:{error:pr},stack:a});let o=Hk(t);if(o.error)return o;let{appliedPolicies:s}=$t({tournamentRecord:e,drawDefinition:i,event:n}),l=(N=(R=((E=t.policyDefinitions)==null?void 0:E[kr])??(s==null?void 0:s[kr])??Vg[kr])==null?void 0:R.processCodes)==null?void 0:N.substitution,{inContextDualMatchUp:u,inContextTieMatchUp:c,relevantAssignments:d,collectionPosition:p,teamParticipants:m,collectionId:h,matchUpType:f,dualMatchUp:g,tieMatchUp:v,tieFormat:y}=o;if(!g)return ee({result:{error:na},stack:a});let I=(A=c==null?void 0:c.sides)==null?void 0:A.find(H=>{var Z,X,ie;return((Z=H.participant)==null?void 0:Z.participantId)===r||((ie=(X=H.participant)==null?void 0:X.individualParticipantIds)==null?void 0:ie.includes(r))});if(!I)return ee({result:{error:zi},stack:a});let b=((M=t.policyDefinitions)==null?void 0:M[Rs])??(s==null?void 0:s[Rs]);if(!((C=I.substitutions)!=null&&C.length)&&(Ir({score:c==null?void 0:c.score})||c!=null&&c.winningSide)&&(b==null?void 0:b.requireParticipantsForScoring)!==!1)return ee({result:{error:RH},stack:a});let S=(k=(O=u==null?void 0:u.sides)==null?void 0:O.find(({sideNumber:H})=>H===I.sideNumber))==null?void 0:k.participantId;if(!S)return ee({result:{error:zi},stack:a});let w=(F=(x=Ni({participantFilters:{participantIds:[r]},tournamentRecord:e}))==null?void 0:x.participants)==null?void 0:F[0];if(!w)return ee({result:{error:zi},stack:a});if(f===ti&&w.participantType===ht)return ee({result:{error:Hm},stack:a});let U=w.participantType===St?[r]:w.individualParticipantIds;wb({tournamentId:e.tournamentId,eventId:n.eventId,inContextDualMatchUp:u,drawDefinition:i,dualMatchUp:g});let T=($=g.sides)==null?void 0:$.find(({sideNumber:H})=>H===I.sideNumber);if(!T&&(((_=g.sides)==null?void 0:_.filter(({lineUp:H})=>!H).length)||0)<2){let H=m==null?void 0:m.map(({participantId:Z})=>{var X;return{drawPosition:(X=d==null?void 0:d.find(ie=>ie.participantId===Z))==null?void 0:X.drawPosition,teamParticipantId:Z}});T=(L=g.sides)==null?void 0:L.find(Z=>{var X;return((X=H==null?void 0:H.find(({drawPosition:ie})=>ie===Z.drawPosition))==null?void 0:X.teamParticipantId)===S})}if(!T)return ee({result:{error:zi,context:{participantId:r}}});let{modifiedLineUp:D,previousParticipantIds:P}=K4({collectionPosition:p,teamParticipantId:S,dualMatchUpSide:T,participantIds:U,drawDefinition:i,collectionId:h});if(T.lineUp=D,S&&y&&ch({participantId:S,lineUp:D,drawDefinition:i,tieFormat:y}),f===Zt&&w.participantType===St){let H=(B=c==null?void 0:c.sides)==null?void 0:B.find(ie=>ie.sideNumber===(T==null?void 0:T.sideNumber)),{participantId:Z}=H??{},X=Z&&((G=(V=Ni({participantFilters:{participantIds:[Z]},tournamentRecord:e,withDraws:!0}))==null?void 0:V.participants)==null?void 0:G[0]);if(X){let ie=((j=X==null?void 0:X.individualParticipantIds)==null?void 0:j.filter(ae=>ae!==r))??[];if(P&&ie.push(...P),ie.length>2)return ee({result:{error:va},stack:a});if((z=X.draws)!=null&&z.length){if(ie.length===1){let{participant:ae}=es({participantIds:ie,tournamentRecord:e});if(!ae){let le=al({participant:{participantRole:Qr,individualParticipantIds:ie,participantType:ht},pairOverride:!0,tournamentRecord:e});if(le.error)return ee({result:le,stack:a})}}}else if(ie.length){X.individualParticipantIds=ie;let ae=OD({participant:X,pairOverride:!0,tournamentRecord:e});if(ae.error)return ee({result:ae,stack:a})}else{let ae=lh({participantIds:[Z],tournamentRecord:e});ae.error&&console.log("cleanup",{result:ae})}}else return ee({result:{error:zi},stack:a})}if(((W=I.substitutions)==null?void 0:W.length)===1&&!((re=(Y=(q=c==null?void 0:c.sides)==null?void 0:q.find(H=>H.sideNumber!==I.sideNumber))==null?void 0:Y.substitutions)!=null&&re.length)&&((K=v==null?void 0:v.processCodes)!=null&&K.length)){for(let H of l||[]){let Z=v.processCodes.lastIndexOf(H);v.processCodes.splice(Z,1)}Rt({tournamentId:e==null?void 0:e.tournamentId,matchUp:v,context:a,drawDefinition:i})}return Rt({tournamentId:e==null?void 0:e.tournamentId,matchUp:g,context:a,drawDefinition:i}),{...J,modifiedLineUp:D}}function Wk(t){var l,u;let e=ze(t,[{[wr]:!0,[Fn]:!0,[fl]:!0}]);if(e.error)return e;let{drawDefinition:i,sideNumber:r,matchUpId:n,event:a}=t;if(r&&![1,2].includes(r))return{error:oe,sideNumber:r};let{matchUp:o,structure:s}=wi({drawDefinition:i,matchUpId:n,event:a});return o?zn({structure:s})?((l=o.sides)==null||l.forEach(c=>{(!r||c.sideNumber===r)&&delete c.participantId}),Rt({tournamentId:(u=t.tournamentRecord)==null?void 0:u.tournamentId,context:"assignSideParticipant",drawDefinition:i,matchUp:o}),{...J}):{error:mN}:{error:dn}}function mme({matchUpStatuses:t=[Vt,zt,Mt],drawPositionMatchUps:e,loserDrawPosition:i,sourceMatchUps:r}){var c;let n=e==null?void 0:e.reduce((d,p)=>!d||p.roundNumber>d.roundNumber?p:d,void 0),a=(c=n==null?void 0:n.drawPositions)==null?void 0:c.find(d=>d!==i),o=r.filter(d=>{var p;return(p=d==null?void 0:d.drawPositions)==null?void 0:p.includes(a)}).map(d=>d.matchUpStatus),s=r.filter(d=>{var p;return(p=d==null?void 0:d.drawPositions)==null?void 0:p.includes(i)}).map(d=>d.matchUpStatus),l=Rn(o||[],t),u=Rn(s||[],t);return{sourceMatchUp:n,winnerHadMatchUpStatus:l,winnerMatchUpStatuses:o,loserHadMatchUpStatus:u,loserMatchUpStatuses:s}}function hme({inContextDrawMatchUps:t,sourceMatchUpStatus:e,targetDrawPosition:i,tournamentRecord:r,sourceMatchUpId:n,drawDefinition:a,structureId:o,dualMatchUp:s,roundNumber:l,matchUpsMap:u,event:c}){let{structure:d}=et({drawDefinition:a,structureId:o});if((d==null?void 0:d.structureType)===xn)return{...J};u=u??sn({drawDefinition:a});let p=((u==null?void 0:u.mappedMatchUps)||{})[o].matchUps,{initialRoundNumber:m}=Tm({drawPosition:i,matchUps:p}),h=p==null?void 0:p.filter(g=>{var v;return g.roundNumber>=l&&g.roundNumber!==m&&((v=g.drawPositions)==null?void 0:v.includes(i))}),{positionAssignments:f}=oi({drawDefinition:a,structureId:o});for(let g of h??[])fme({inContextDrawMatchUps:t,sourceMatchUpStatus:e,positionAssignments:f,targetDrawPosition:i,tournamentRecord:r,sourceMatchUpId:n,drawDefinition:a,dualMatchUp:s,matchUpsMap:u,matchUp:g,event:c});return{...J}}function fme({inContextDrawMatchUps:t,positionAssignments:e,sourceMatchUpStatus:i,targetDrawPosition:r,tournamentRecord:n,sourceMatchUpId:a,drawDefinition:o,dualMatchUp:s,matchUpsMap:l,matchUp:u,event:c}){var m,h,f;let d="removeSubsequentDrawPosition";if(s){let g=(h=(m=t.find(({matchUpId:y})=>u.matchUpId===y).sides)==null?void 0:m.find(y=>y.drawPosition===r))==null?void 0:h.sideNumber,v=(f=u.sides)==null?void 0:f.find(y=>y.sideNumber===g);v&&delete v.lineUp}u.drawPositions=(u.drawPositions||[]).map(g=>g===r?void 0:g).filter(Boolean);let p=e.filter(({drawPosition:g})=>{var v;return(v=u.drawPositions)==null?void 0:v.includes(g)}).filter(g=>g.bye).length;return u.matchUpStatus=p&&Vt||[Mt,zt].includes(u.matchUpStatus)&&u.matchUpStatus||Ji,[zt,Mt].includes(u.matchUpStatus)&&(u.winningSide=void 0),u.matchUpStatusCodes&&bq({inContextDrawMatchUps:t,sourceMatchUpStatus:i,sourceMatchUpId:a,matchUpsMap:l,matchUp:u}),Rt({tournamentId:n==null?void 0:n.tournamentId,eventId:c==null?void 0:c.eventId,context:`${d}-${r}`,drawDefinition:o,matchUp:u}),{...J}}function Qg(t){let{dualWinningSideChange:e,inContextDrawMatchUps:i,tournamentRecord:r,drawDefinition:n,matchUpStatus:a,matchUpsMap:o,dualMatchUp:s,targetData:l,matchUpId:u,structure:c,event:d}=t,p=!!t.matchUp.collectionId,m=zn({structure:c}),{drawPositions:h,winningSide:f}=l.matchUp||{};if(!m&&!h)return{error:Ry};let{targetLinks:{loserTargetLink:g,winnerTargetLink:v,byeTargetLink:y},targetMatchUps:{loserMatchUp:I,winnerMatchUp:b,byeMatchUp:S}}=l,w=Ws({...t,matchUpStatus:a||Ji,removeWinningSide:!0});if(w.error)return w;let U;if(p){let{matchUpTieId:O,matchUpsMap:k}=t;if(U=Yu({appliedPolicies:t.appliedPolicies,matchUpId:O,tournamentRecord:r,drawDefinition:n,matchUpsMap:k,event:d}),!e&&!U.removeWinningSide)return{...J}}if(m)return{...J};let{matchUps:T}=Wt({afterRecoveryTimes:!1,inContext:!0,drawDefinition:n,matchUpsMap:o,structure:c}),{positionAssignments:D}=Er({structure:c}),P=f-1,E=1-P,R=h[P],N=h[E],{winnerParticipantId:A,loserParticipantId:M}=(D==null?void 0:D.reduce((O,k)=>(k.drawPosition===N&&(O.loserParticipantId=k.participantId),k.drawPosition===R&&(O.winnerParticipantId=k.participantId),O),{winnerParticipantId:void 0,loserParticipantId:void 0}))||{},C=T.filter(O=>{var k;return(k=O.drawPositions)==null?void 0:k.includes(N)});if(b&&J4({sourceMatchUpStatus:a,sourceMatchUpId:u,inContextDrawMatchUps:i,winningDrawPosition:R,winnerParticipantId:A,tournamentRecord:r,winnerTargetLink:v,drawDefinition:n,winnerMatchUp:b,dualMatchUp:s,matchUpsMap:o}),I){let{winnerHadMatchUpStatus:O}=mme({drawPositionMatchUps:C,loserDrawPosition:N,sourceMatchUps:T}),k=g.linkCondition===tl;if(O&&k){let F=Math.min(...I.drawPositions);l1({targetLink:g,inContextDrawMatchUps:i,drawDefinition:n,drawPosition:F,matchUpsMap:o,event:d})}let x=gme({sourceMatchUpStatus:a,sourceMatchUpId:u,loserParticipantId:M,tournamentRecord:r,loserTargetLink:g,drawDefinition:n,loserMatchUp:I,dualMatchUp:s,matchUpsMap:o,event:d});if(x.error)return x}if(S){let O=Math.min(...S.drawPositions);l1({sourceMatchUpId:u,targetLink:y,inContextDrawMatchUps:i,drawDefinition:n,drawPosition:O,matchUpsMap:o,event:d})}return{...J,...U&&{tieMatchUpResult:U}}}function J4({inContextDrawMatchUps:t,winningDrawPosition:e,sourceMatchUpStatus:i,winnerParticipantId:r,tournamentRecord:n,winnerTargetLink:a,sourceMatchUpId:o,drawDefinition:s,winnerMatchUp:l,matchUpsMap:u,dualMatchUp:c,event:d}){var f,g;let{structureId:p,roundNumber:m}=l,h="removeDirectedWinner";if(a){let v=a.target.structureId,{structure:y}=et({drawDefinition:s,structureId:v});if(!y)return{error:Mi};let{positionAssignments:I}=Er({structure:y});y.seedAssignments=(y.seedAssignments??[]).filter(D=>D.participantId!==r);let b=(f=I==null?void 0:I.find(D=>D.participantId===r))==null?void 0:f.drawPosition,{matchUps:S}=Wt({drawDefinition:s,structure:y,event:d}),w=S.map(D=>D.drawPositions).flat(1/0).filter(Boolean),U=wa(w);if((b?U[b]:void 0)===1)I==null||I.forEach(D=>{D.participantId===r&&delete D.participantId});else{let D=S.filter(({drawPositions:P})=>P.includes(b));console.log("not removing from position assignments since instances > 1",{drawPositionMatchUps:D,winnerTargetLink:a})}let T=(g=u==null?void 0:u.drawMatchUps)==null?void 0:g.find(({matchUpId:D})=>D===l.matchUpId);T&&Rt({tournamentId:n==null?void 0:n.tournamentId,eventId:d==null?void 0:d.eventId,matchUp:T,context:h,drawDefinition:s})}return m&&hme({targetDrawPosition:e,inContextDrawMatchUps:t,sourceMatchUpStatus:i,tournamentRecord:n,sourceMatchUpId:o,drawDefinition:s,dualMatchUp:c,matchUpsMap:u,roundNumber:m,structureId:p}),{...J}}function gme({sourceMatchUpStatus:t,loserParticipantId:e,tournamentRecord:i,loserTargetLink:r,sourceMatchUpId:n,drawDefinition:a,loserMatchUp:o,matchUpsMap:s,dualMatchUp:l,event:u}){var f,g,v;let c="removeDirectedLoser",d=r.target.structureId,{structure:p}=et({drawDefinition:a,structureId:d});if(!p)return{error:Mi};let{positionAssignments:m}=Er({structure:p}),h=(f=m==null?void 0:m.find(y=>y.participantId===e))==null?void 0:f.drawPosition;if(m==null||m.forEach(y=>{y.participantId===e&&delete y.participantId}),p.seedAssignments=(p.seedAssignments??[]).filter(y=>y.participantId!==e),l){let y=o==null?void 0:o.sides.reduce((S,w,U)=>w.drawPosition===h?U:S,void 0),I=(g=s==null?void 0:s.drawMatchUps)==null?void 0:g.find(({matchUpId:S})=>S===o.matchUpId),b=(v=I==null?void 0:I.sides)==null?void 0:v[y];b&&(delete b.lineUp,Rt({tournamentId:i==null?void 0:i.tournamentId,eventId:u==null?void 0:u.eventId,matchUp:I,context:c,drawDefinition:a}))}return{...J}}function l1({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,matchUpsMap:n,targetLink:a,event:o}){let s=a.target.structureId,l="removeDirectedBye";Aa({color:"brightyellow",method:l,drawPosition:r});let u=sb({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,matchUpsMap:n,structureId:s,event:o});return ee({result:u,stack:l})}function vme(t){var l,u;let{matchUpFormat:e,score:i}=t,r=(l=i==null?void 0:i.sets)==null?void 0:l.length,n=e&&kn(e),{setFormat:a,finalSetFormat:o,bestOf:s}=n??{};return((u=s&&r===s&&o||a)==null?void 0:u.timed)||!1}function Ime({tournamentRecord:t,drawDefinition:e,structure:i,matchUp:r}){var s;let n="attemptToSetMatchUpStatusBYE";if(r!=null&&r.winningSide)return ee({result:{error:Pg},context:{matchUpStatus:Vt},stack:n});let{positionAssignments:a}=Er({structure:i}),o=a==null?void 0:a.filter(l=>l.bye).map(l=>l.drawPosition);return(s=r.drawPositions)!=null&&s.some(l=>o==null?void 0:o.includes(l))?(r.matchUpStatus=Vt,r.matchUpStatusCodes=[],Rt({tournamentId:t==null?void 0:t.tournamentId,context:n,drawDefinition:e,matchUp:r}),{...J}):ee({result:{error:GG},info:"matchUp does not include BYE",stack:n})}function Qv(t){var g,v;let{tournamentRecord:e,appliedPolicies:i,drawDefinition:r,matchUpsMap:n,targetData:a,structure:o,event:s}=t,l="doubleExitAdvancement";if(o.structureType===xn)return ee({result:{...J},stack:l});let{matchUp:u,targetMatchUps:c,targetLinks:d}=a,{loserMatchUp:p,winnerMatchUp:m,loserTargetDrawPosition:h}=c,f=[zt,Mt].includes(p==null?void 0:p.matchUpStatus)&&!((g=p.sides)!=null&&g.map(y=>y.participantId??y.participant).filter(Boolean).length);if(p&&p.matchUpStatus!==Vt){let{loserTargetLink:y}=d;if((v=i==null?void 0:i.progression)!=null&&v.doubleExitPropagateBye){let I=Q4({loserTargetDrawPosition:h,tournamentRecord:e,loserTargetLink:y,drawDefinition:r,loserMatchUp:p,matchUpsMap:n,event:s});if(I.error)return ee({result:I,stack:l})}else if(!f){let{feedRound:I,drawPositions:b,matchUpId:S}=p,w=I?2:2-b.indexOf(h),U=fV({...t,targetMatchUp:p,walkoverWinningSide:w,tournamentRecord:e,sourceMatchUp:u,matchUpId:S});if(U.error)return ee({result:U,stack:l})}}if(m){let y=fV({...t,matchUpId:m.matchUpId,targetMatchUp:m,tournamentRecord:e,sourceMatchUp:u});if(y.error)return ee({result:y,stack:l})}return ee({result:{...J},stack:l})}function fV(t){var V,G,j;let{inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:r,sourceMatchUp:n,targetMatchUp:a,matchUpsMap:o}=t,s=r.structures.find(({structureId:z})=>z===a.structureId),l=t.matchUpStatus===cr?cr:er,u=t.matchUpStatus===cr?Mt:zt,c="conditionallyAdvanceDrawPosition",d=o.drawMatchUps.find(z=>z.matchUpId===a.matchUpId);if(!d)return{error:na};let p=(n==null?void 0:n.drawPositions)||[],m=(V=d.drawPositions)==null?void 0:V.filter(Boolean),h=(n==null?void 0:n.structureId)===a.structureId;if(h&&Rn(p,m)&&(m=m.filter(z=>!p.includes(z))),h&&m.length>1)return ee({result:{error:Df},stack:c});let{pairedPreviousMatchUpIsDoubleExit:f,pairedPreviousMatchUp:g}=Iq(t),v=Cn({matchUpId:a.matchUpId,inContextDrawMatchUps:e,drawDefinition:r}),{targetMatchUps:y,targetLinks:I}=v,{loserTargetDrawPosition:b,winnerMatchUp:S,loserMatchUp:w}=y;if(w){let{loserTargetLink:z}=I,W=Q4({loserTargetDrawPosition:b,loserMatchUp:w,tournamentRecord:i,loserTargetLink:z,drawDefinition:r,matchUpsMap:o});if(W.error)return ee({result:W,stack:c})}let U=((G=d.drawPositions)==null?void 0:G.filter(Boolean))||[],T=U.length===1,D=t.walkoverWinningSide||T&&OU({drawPosition:U[0],matchUpId:a.matchUpId,inContextDrawMatchUps:e})||void 0,P=[zt,Mt].includes(d.matchUpStatus)&&!U.length,E=d.finishingRound===1,R=P&&!E?l:u,N=e.find(z=>z.matchUpId===g.matchUpId),A=[],M;n&&((n==null?void 0:n.structureId)===(N==null?void 0:N.structureId)?n.roundPosition<(g==null?void 0:g.roundPosition)?M=1:M=2:a.feedRound?n.structureId===a.structureId?M=2:M=1:D&&(M=3-D));let C=t.matchUpStatus,O=g==null?void 0:g.matchUpStatus;M===1?A=[{matchUpStatus:dU(C),previousMatchUpStatus:C,sideNumber:1},{matchUpStatus:dU(O),previousMatchUpStatus:O,sideNumber:2}]:M===2&&(A=[{matchUpStatus:dU(O),previousMatchUpStatus:O,sideNumber:1},{matchUpStatus:dU(C),previousMatchUpStatus:C,sideNumber:2}]),A.length&&(A=A.map(z=>Ge(z)));let k=Ws({...t,winningSide:D,matchUp:d,matchUpStatusCodes:A,context:c,matchUpStatus:R});if(k.error)return ee({result:k,stack:c});if(P)return Qv({...t,matchUpStatus:R,targetData:v});if(!S)return ee({result:{...J},stack:c});let x=m.length===2?m[D-1]:m[0],{positionAssignments:F}=oi({structure:s}),$=F==null?void 0:F.find(z=>z.drawPosition===x),_=o.drawMatchUps.find(z=>z.matchUpId===S.matchUpId),L=(j=_==null?void 0:_.drawPositions)==null?void 0:j.filter(Boolean),B=L.length===1;if(x){if($!=null&&$.bye){let z=Cn({matchUpId:_.matchUpId,inContextDrawMatchUps:e,drawDefinition:r});if(B){let W=L.filter(Boolean)[0],q=OU({drawPosition:W,matchUpId:_.matchUpId,inContextDrawMatchUps:e}),Y=Ws({appliedPolicies:t.appliedPolicies,matchUpId:_.matchUpId,matchUp:_,matchUpStatus:u,matchUpStatusCodes:[],removeScore:!0,context:c,drawDefinition:r,winningSide:q});return Y.error?ee({result:Y,stack:c}):zA({drawPositionToAdvance:W,matchUpId:_.matchUpId,inContextDrawMatchUps:e,drawDefinition:r,matchUpsMap:o})}else if([zt,Mt].includes(S.matchUpStatus)){let W=Qv({...t,matchUpId:_.matchUpId,matchUpStatus:R,targetData:z});if(W.error)return ee({result:W,stack:c})}return ee({result:{...J},stack:c})}return Vf({matchUpId:S.matchUpId,drawPosition:x,inContextDrawMatchUps:e,drawDefinition:r})}else if(f){if(!_)return{error:na};if(B){let q=L[0],Y=OU({matchUpId:a.matchUpId,inContextDrawMatchUps:e,drawPosition:q});console.log("existing drawPosition is winningSide",{walkoverWinningSide:Y})}let z=[zt,Mt].includes(_.matchUpStatus)?u:l,W=Ws({matchUpId:_.matchUpId,appliedPolicies:t.appliedPolicies,matchUp:_,matchUpStatusCodes:[],removeScore:!0,context:c,drawDefinition:r,matchUpStatus:z});if(W.error)return ee({result:W,stack:c});if(z===l){let q=Qv({...t,matchUpId:a.matchUpId,matchUpStatus:z,targetData:v});if(q.error)return q}}return ee({result:{...J},stack:c})}function Q4(t){var u;let{loserTargetDrawPosition:e,tournamentRecord:i,loserTargetLink:r,drawDefinition:n,matchUpsMap:a,event:o}=t,s=(u=r==null?void 0:r.target)==null?void 0:u.structureId,{structure:l}=et({drawDefinition:n,structureId:s});return l?Ya({drawPosition:e,tournamentRecord:i,drawDefinition:n,structureId:s,matchUpsMap:a,event:o}):{error:lp}}function dU(t){return t===er?zt:t===cr?Mt:t}function yme(t){let{tournamentRecord:e,drawDefinition:i,matchUpStatus:r,structure:n,matchUp:a}=t,o=!!(a.tieMatchUps&&!a.rondPosition&&t.inContextDrawMatchUps.find(v=>v.matchUpId===a.matchUpId).containerStructureId),s="attemptToSetMatchUpStatus",l=r===Vt,u=a.winningSide,c=[er,cr].includes(r),d=ab({matchUpStatus:r}),p=$C({matchUpStatus:r}),m=!d&&!p,h=t.matchUpTieId||u&&d&&!c,f=u&&c,g=()=>Ws({...t,removeScore:[Hu,zt].includes(r),matchUpStatus:r||Ji});return m&&{error:yC}||h&&u1(t)||f&&bme(t)||u&&Qg(t)||p&&g()||l&&Ime({tournamentRecord:e,drawDefinition:i,structure:n,matchUp:a})||!d&&{error:yC}||c&&wme(t)||o&&u1(t)||ee({result:{error:Pg},stack:s})}function bme(t){let e=Qg(t);return e.error?e:Qv(t)}function wme(t){let e=u1({...t,removeScore:!0});return e.error?e:Qv(t)}function u1(t){var n;let e="scoreModification";if(t.isCollectionMatchUp&&((n=t.dualMatchUp)!=null&&n.winningSide)&&!t.projectedWinningSide){let a=Qg(t);if(a.error)return ee({result:a,stack:e})}let i=!!t.matchUp.collectionId,r=Ws({...t,context:e});if(i){let{matchUpTieId:a,drawDefinition:o,matchUpsMap:s}=t,l=Yu({tournamentRecord:t.tournamentRecord,appliedPolicies:t.appliedPolicies,matchUpId:a,event:t.event,drawDefinition:o,matchUpsMap:s});if(l.error)return ee({result:l,stack:e});Object.assign(r,{tieMatchUpResult:l})}return ee({result:r,stack:e})}function Ume({drawDefinition:t,structure:e,matchUp:i}){var l,u,c,d;let{drawPositions:r}=i,{positionAssignments:n}=oi({drawDefinition:t,structure:e}),a=(l=n==null?void 0:n.filter(({drawPosition:p})=>r==null?void 0:r.includes(p)))==null?void 0:l.map(p=>{var h;let{extension:m}=gt({element:p,name:Sc});return(h=m==null?void 0:m.value)==null?void 0:h.groupOrder}),{containerStructures:o}=Lg({drawDefinition:t}),s=o[e.structureId];return{structureIds:(d=(c=(u=_g({drawDefinition:t,structureId:s}))==null?void 0:u.links)==null?void 0:c.source)==null?void 0:d.filter(p=>{var m;return Rn(a,((m=p.source)==null?void 0:m.finishingPositions)||[])}).map(p=>p.source.structureId)}}function Z4({drawDefinition:t,structure:e,matchUp:i}){let r=[];if(e.finishingPosition===kd&&Ec({drawDefinition:t,structure:e})){let{structureIds:n}=Ume({drawDefinition:t,structure:e,matchUp:i});n!=null&&n.length&&r.push(...n)}return{connectedStructureIds:r}}function Sme(t){var s,l,u;let e,{inContextDrawMatchUps:i,inContextMatchUp:r,drawDefinition:n,winningSide:a}=t,o=(s=t.targetData.targetLinks)==null?void 0:s.winnerTargetLink;if(o.target.feedProfile===ko){let c=r.sides.find(({sideNumber:p})=>p!==a).participantId,d=i.find(p=>p.structureId===o.target.structureId&&p.roundNumber===o.target.roundNumber&&p.sides.some(({participantId:m})=>m===c));if((d==null?void 0:d.matchUpStatus)===Ji){let p=Cn({matchUpId:d.matchUpId,inContextDrawMatchUps:i,drawDefinition:n});if(!jd({inContextDrawMatchUps:i,drawDefinition:n,targetData:p})){let{structure:m}=et({structureId:d.structureId,drawDefinition:n}),h=oi({structure:m}).positionAssignments;for(let f of h||[])if(f.participantId===c){let g=r.sides.find(({sideNumber:v})=>v===a).participantId;if(f.participantId=g,m==null?void 0:m.positionAssignments)m.positionAssignments=h;else if(m!=null&&m.structures){let v=Object.assign({},...(h||[]).map(y=>({[y.drawPosition]:y.participantId})));for(let y of m.structures)(l=y.positionAssignments)==null||l.forEach(I=>I.participantId=v[I.drawPosition])}Pc({tournamentId:(u=t.tournamentRecord)==null?void 0:u.tournamentId,event:t.event,drawDefinition:n,structure:m}),e=!0}}}}return{...J,qualifierReplaced:e}}function Tme(t){var s,l,u,c,d;let e,{inContextDrawMatchUps:i,inContextMatchUp:r,drawDefinition:n,winningSide:a}=t,o=(s=t.targetData.targetLinks)==null?void 0:s.winnerTargetLink;if(o.target.feedProfile===ko){let p=(l=r.sides.find(({sideNumber:f})=>f===a))==null?void 0:l.participantId,m=i.filter(f=>f.structureId===o.target.structureId&&f.roundNumber===o.target.roundNumber&&f.sides.some(({participantId:g,qualifier:v})=>v&&!g)),h=pa(m);if((h==null?void 0:h.matchUpStatus)===Ji){let f=Cn({matchUpId:h.matchUpId,inContextDrawMatchUps:i,drawDefinition:n});if(!jd({inContextDrawMatchUps:i,drawDefinition:n,targetData:f})){let g=(u=h.sides.find(I=>I.qualifier&&!I.participantId))==null?void 0:u.drawPosition,{structure:v}=et({structureId:h.structureId,drawDefinition:n});if(!v)return{error:Mi};let y=oi({structure:v}).positionAssignments;for(let I of y||[])if(I.drawPosition===g&&!I.participantId){if(I.participantId=p,v.positionAssignments)v.positionAssignments=y;else if(v.structures){let b=Object.assign({},...(y||[]).map(S=>({[S.drawPosition]:S.participantId})));for(let S of v.structures)(c=S.positionAssignments)==null||c.forEach(w=>w.participantId=b[w.drawPosition])}Pc({tournamentId:(d=t.tournamentRecord)==null?void 0:d.tournamentId,event:t.event,drawDefinition:n,structure:v}),e=!0}}}}return{...J,qualifierPlaced:e}}function Dme(t){var m,h;let e="attemptToSetWinningSide",i,{appliedPolicies:r,disableAutoCalc:n,drawDefinition:a,dualMatchUp:o,winningSide:s,structure:l,matchUp:u}=t;if(o!=null&&o._disableAutoCalc&&n!==!1)return TO(t);if(u.winningSide&&u.winningSide!==s){let{connectedStructureIds:f}=Z4({drawDefinition:a,structure:l,matchUp:u});f.length&&(console.log({connectedStructureIds:f}),i=!0);let g=Qg(t);if(g.error)return g}let c=m3(t);if(c.error)return ee({result:c,stack:e});let d,p;return t.qualifierChanging&&((m=r==null?void 0:r[MI])!=null&&m.autoReplaceQualifiers)&&(d=Sme(t).qualifierReplaced),t.qualifierAdvancing&&((h=r==null?void 0:r[MI])!=null&&h.autoPlaceQualifiers)&&(p=Tme(t).qualifierPlaced),ee({result:Ge({...J,...c,connectedStructures:i,qualifierReplaced:d,qualifierPlaced:p}),stack:e})}var $U={drawPositionToRemove:"green",iteration:"brightred",winner:"green",loser:"brightred"};function eY(t){var g,v,y,I;let{inContextDrawMatchUps:e,appliedPolicies:i,drawDefinition:r,matchUpsMap:n,targetData:a,matchUp:o}=t,{matchUpId:s}=o,{iteration:l=0}=t;l+=1;let u="removeDoubleExit";Aa({color:"brightyellow",method:u,matchUpId:s,iteration:l,keyColors:$U});let{targetMatchUps:{loserMatchUp:c,winnerMatchUp:d,loserTargetDrawPosition:p},targetLinks:{loserTargetLink:m}}=a;if(d&&d.matchUpStatus!==Vt){let{stage:b,roundNumber:S,roundPosition:w,structureName:U}=d;Aa({winner:"winner",roundPosition:w,structureName:U,roundNumber:S,keyColors:$U,stage:b}),gV({...t,targetMatchUp:d,sourceMatchUp:o,iteration:l})}let h=(c==null?void 0:c.matchUpStatus)===Vt&&((c==null?void 0:c.feedRound)||(c==null?void 0:c.roundNumber)===1),f=((v=(g=a==null?void 0:a.targetLinks)==null?void 0:g.loserTargetLink)==null?void 0:v.linkCondition)===tl;if(h&&f){let b=e.filter(({roundNumber:U,structureId:T})=>T===o.structureId&&U===1),S=b.map(({roundPosition:U})=>U),w=Rr(S.sort(),2).find(U=>U.includes(o.roundPosition));if(((y=b.filter(({roundPosition:U})=>w.includes(U)))==null?void 0:y.map(({matchUpStatus:U})=>U)).every(U=>[cr,er].includes(U)))return ee({result:{...J},stack:u})}if(c&&(c.matchUpStatus!==Vt||h)){let b=e.find(({matchUpId:E})=>E===c.matchUpId),{structure:S}=et({drawDefinition:r,structureId:b.structureId}),{stage:w,roundNumber:U,roundPosition:T,feedRound:D,structureName:P}=c;if(Aa({loser:"loser",roundPosition:T,structureName:P,roundNumber:U,keyColors:$U,feedRound:D,stage:w}),((I=i==null?void 0:i.progression)==null?void 0:I.doubleExitPropagateBye)||h)l1({drawPosition:p,targetLink:m,inContextDrawMatchUps:e,drawDefinition:r,matchUpsMap:n});else{let E=gV({...t,targetMatchUp:c,structure:S,iteration:l});if(E.error)return ee({result:E,stack:u})}}return ee({result:{...J},stack:u})}function gV(t){var b,S,w,U,T,D;let{inContextDrawMatchUps:e,appliedPolicies:i,drawDefinition:r,sourceMatchUp:n,targetMatchUp:a,matchUpsMap:o,structure:s,iteration:l}=t,u="conditionallyRemoveDrawPosition";Aa({method:u,structureName:s==null?void 0:s.structureName,iteration:l});let c=Cn({matchUpId:a.matchUpId,inContextDrawMatchUps:e,drawDefinition:r}),{targetMatchUps:{winnerMatchUp:d}}=c,p=o==null?void 0:o.drawMatchUps.find(P=>P.matchUpId===a.matchUpId),m=[],h,f,g;if(a.feedRound)g=(S=(b=d==null?void 0:d.drawPositions)==null?void 0:b.filter(Boolean))==null?void 0:S.find(P=>a.drawPositions.includes(P));else if(!n)g=(w=Vi((a==null?void 0:a.drawPositions)||[],(d==null?void 0:d.drawPositions)||[]))==null?void 0:w[0];else if(f=(U=yq({structureId:s.structureId,matchUp:n,matchUpsMap:o}))==null?void 0:U.pairedPreviousMatchUp,h=[er,cr].includes(f==null?void 0:f.matchUpStatus),m=((T=f==null?void 0:f.drawPositions)==null?void 0:T.filter(Boolean))||[],[...vr,Vt].includes(f==null?void 0:f.matchUpStatus)||(f==null?void 0:f.winningSide)){let P=n.drawPositions||[],E=(D=a.drawPositions)==null?void 0:D.filter(Boolean);Rn(P,E)&&(E=E==null?void 0:E.filter(R=>!P.includes(R))),g=P.concat(m).find(R=>E==null?void 0:E.includes(R))}if(d&&g){let{stage:P,roundNumber:E,roundPosition:R,structureName:N}=d;Aa({method:"removeDirectedWinner",drawPositionToRemove:g,color:"brightgreen",roundPosition:R,structureName:N,roundNumber:E,keyColors:$U,stage:P}),J4({winningDrawPosition:g,winnerMatchUp:d,inContextDrawMatchUps:e,drawDefinition:r,matchUpsMap:o})}let v=eY({targetData:c,matchUp:a,inContextDrawMatchUps:e,appliedPolicies:i,drawDefinition:r,matchUpsMap:o,structure:s,iteration:l});if(v.error)return ee({result:v,stack:u});let y=Pme({pairedPreviousDoubleExit:h,noContextTargetMatchUp:p}),I=!h;return v=Ws({...t,matchUpId:a.matchUpId,matchUp:p,removeWinningSide:!0,matchUpStatusCodes:[],context:u,matchUpStatus:y,removeScore:I,score:{scoreStringSide1:"",scoreStringSide2:"",sets:void 0}}),v.error?ee({result:v,stack:u}):{...J}}function Pme({pairedPreviousDoubleExit:t,noContextTargetMatchUp:e}){return e.matchUpStatus===Vt?Vt:t?[cr,Mt].includes(e==null?void 0:e.matchUpStatus)?Mt:zt:Ji}function Rme(t){var o,s,l,u,c;let e,{inContextDrawMatchUps:i,inContextMatchUp:r,drawDefinition:n}=t,a=(o=t.targetData.targetLinks)==null?void 0:o.winnerTargetLink;if(a.target.feedProfile===ko){let d=(l=(s=r.sides)==null?void 0:s.find(({sideNumber:m})=>m===r.winningSide))==null?void 0:l.participantId,p=i.find(m=>{var h;return m.structureId===a.target.structureId&&m.roundNumber===a.target.roundNumber&&((h=m.sides)==null?void 0:h.some(({participantId:f})=>f===d))});if(p&&p.matchUpStatus===Ji){let m=Cn({matchUpId:p.matchUpId,inContextDrawMatchUps:i,drawDefinition:n});if(!jd({inContextDrawMatchUps:i,drawDefinition:n,targetData:m})){let{structure:h}=et({structureId:p.structureId,drawDefinition:n}),f=oi({structure:h}).positionAssignments;for(let g of f||[])if(g.participantId===d){if(g.participantId=void 0,h==null?void 0:h.positionAssignments)h.positionAssignments=f;else if(h!=null&&h.structures){let v=Object.assign({},...(f||[]).map(y=>({[y.drawPosition]:y.participantId})));for(let y of(h==null?void 0:h.structures)||[])(u=y.positionAssignments)==null||u.forEach(I=>I.participantId=v[I.drawPosition])}Pc({tournamentId:(c=t.tournamentRecord)==null?void 0:c.tournamentId,event:t.event,drawDefinition:n,structure:h}),e=!0}}}}return{qualifierRemoved:e}}function Eme(t){var f;let{matchUp:e,matchUpStatus:i,score:r,winningSide:n}=t,a="noDownStreamDependencies";if([er,cr].includes(e==null?void 0:e.matchUpStatus)&&![er,cr].includes(i)){let g=eY(t);if(g.error)return ee({result:g,stack:a})}let o=i===er,s=Ir({score:r})&&!o&&(t.isCollectionMatchUp&&!t.projectedWinningSide||!n),l=((f=t==null?void 0:t.inContextMatchUp)==null?void 0:f.collectionId)&&vme(t.inContextMatchUp),u=t.removeScore||!l&&![co,$a].includes(i||co),c=t.isCollectionMatchUp&&t.dualMatchUp.winningSide&&!t.projectedWinningSide||e.winningSide&&!n&&!Ir({score:r}),d=i&&i!==Ji,p=g=>{var T,D;let v,{structure:y,drawDefinition:I,dualMatchUp:b,disableAutoCalc:S}=t;if(b!=null&&b._disableAutoCalc&&S!==!1)return TO({...t,removeWinningSide:c});let{connectedStructureIds:w}=Z4({drawDefinition:I,structure:y,matchUp:e});w.length&&(console.log({connectedStructureIds:w}),v=!0),Object.assign(t,{removeScore:g});let U=Qg(t);if(U.error)return U;if(t.removingQualifier&&((D=(T=t.appliedPolicies)==null?void 0:T[MI])!=null&&D.autoRemoveQualifiers)){let P=Rme(t);return{...J,connectedStructures:v,...P}}return{...J,connectedStructures:v}};if(c&&n&&t.isCollectionMatchUp)return vV(t);let m=[Hu,$a].includes(i)&&t.dualWinningSideChange,h=(n||m)&&Dme(t)||s&&p(u)||d&&yme(t)||c&&p(u)||e&&vV({...t,removeScore:!0})||{...J};return ee({result:h,stack:a})}function vV(t){var r;let e="ndd:scoreModification";if(t.isCollectionMatchUp&&((r=t.dualMatchUp)!=null&&r.winningSide)&&!t.projectedWinningSide&&!t.autoCalcDisabled){let n=Qg(t);if(n.error)return n}let i=Ws({...t,context:e});if(t.isCollectionMatchUp){let{matchUpTieId:n,drawDefinition:a,event:o,matchUpsMap:s}=t,{removeWinningSide:l}=Yu({tournamentRecord:t.tournamentRecord,appliedPolicies:t.appliedPolicies,matchUpId:n,drawDefinition:a,matchUpsMap:s,event:o});l&&console.log("REMOVE WINNING SIDE")}return ee({result:i,stack:e})}function qk(t){var c,d,p;let e=ze(t,[{[wr]:!0,[Fn]:!0,[fl]:!0},{homeParticipantId:!0,[Vo]:pr}]);if(e.error)return e;let i=qg(t,[{[Og]:Zl,attr:{[hT]:!0}}]);if(i.error)return i;let r=(p=(d=(c=i==null?void 0:i.matchUp)==null?void 0:c.matchUp)==null?void 0:d.sides)==null?void 0:p.map(m=>m==null?void 0:m.participantId);if(t.homeParticipantId&&!(r!=null&&r.includes(t.homeParticipantId)))return{error:Ts};let{disableNotice:n=!0,homeParticipantId:a,removePriorValues:o,tournamentRecord:s,drawDefinition:l,matchUpId:u}=t;return Da({duplicateValues:!1,removePriorValues:o,tournamentRecord:s,drawDefinition:l,disableNotice:n,matchUpId:u,timeItem:{itemType:$A,itemValue:a}})}function tY({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:r,timeStamp:n}=vp({timeItems:(i==null?void 0:i.timeItems)||[],itemType:OT});return!e||n&&t&&new Date(n).getTime()>new Date(t).getTime()?{timeModifiers:r}:e}function Jc(t){var m;let e="addMatchUpScheduledTime",i=t.matchUp,{removePriorValues:r,tournamentRecord:n,drawDefinition:a,disableNotice:o,scheduledTime:s,matchUpId:l}=t;if(!l)return ee({result:{error:yn},stack:e});if(!Ng(s))return ee({result:{error:No},stack:e});if(!i){let h=wi({drawDefinition:a,matchUpId:l});if(h.error)return ee({result:h,stack:e});i=h.matchUp}let u=pt(s),c=nh({matchUp:i}).scheduledDate,d=u&&!c;if((m=tY({matchUp:i}).timeModifiers||[])!=null&&m.length){let h=iY({disableNotice:!0,removePriorValues:r,tournamentRecord:n,timeModifiers:[],drawDefinition:a,matchUpId:l,matchUp:i});if(h!=null&&h.error)return ee({result:h,stack:e})}let p=Km(s,!0,d);return Da({duplicateValues:!1,removePriorValues:r,tournamentRecord:n,drawDefinition:a,disableNotice:o,matchUpId:l,timeItem:{itemType:ih,itemValue:p}})}function iY({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,timeModifiers:n,matchUpId:a,matchUp:o}){let s="addMatchUpTimeModifiers";if(!a)return ee({result:{error:yn},stack:s});if(n!==void 0&&!Array.isArray(n))return ee({info:Bd("timeModifiers"),result:{error:oe},stack:s});if(!o){let d=wi({drawDefinition:i,matchUpId:a});if(d.error)return ee({result:d,stack:s});o=d.matchUp}let l=tY({matchUp:o}).timeModifiers||[],u=n.filter(d=>!l.includes(d));if(n.length&&!u.length)return{...J};if(u.some(d=>xC.includes(d))){l=l.filter(p=>!xC.includes(p));let d=Jc({disableNotice:!0,removePriorValues:t,scheduledTime:"",tournamentRecord:e,drawDefinition:i,matchUpId:a});if(d.error)return ee({result:d,stack:s})}let c=n!=null&&n.length?[...u,...l]:void 0;return Da({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:a,timeItem:{itemType:OT,itemValue:c}})}function kD({scheduledDate:t,removePriorValues:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:a}){if(!a)return{error:yn};let o=t&&Zs.test(t);if(t&&!o)return{error:Ar};let s={itemValue:pt(t),itemType:th};return Da({duplicateValues:!1,removePriorValues:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:a,timeItem:s})}function xD({removePriorValues:t,tournamentRecords:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,courtDayDate:a,matchUpId:o,courtIds:s}){var c,d;if(!i&&!e)return{error:ge};if(!o)return{error:yn};let l=wi({drawDefinition:r,matchUpId:o});if(l.error)return l;if(((c=l==null?void 0:l.matchUp)==null?void 0:c.matchUpType)!==ka)return{error:aa};if(!(s===void 0||Array.isArray(s)&&s.length&&s.every(p=>typeof p=="string")))return{error:oe,context:{courtIds:s}};let u;if(s){let p=e||i&&{[i.tournamentId]:i},m=Ku({tournamentRecords:p});if(m.error)return m;let h=(d=m.courts)==null?void 0:d.filter(f=>s.includes(f.courtId));if((h==null?void 0:h.length)!==s.length)return{error:oe,context:{courtIds:s}};u=h==null?void 0:h.map(f=>({venueId:f.venueId,courtId:f.courtId}))}return Da({duplicateValues:!1,removePriorValues:t,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:o,timeItem:{itemType:zl,itemDate:a,itemValue:u}})}function Zg({removePriorValues:t,tournamentRecords:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:a,venueId:o}){if(!i)return{error:ge};if(!a)return{error:yn};if(o){let s=eu({tournamentRecords:e,tournamentRecord:i,venueId:o});if(s.error)return s}return Da({duplicateValues:!1,removePriorValues:t,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:a,timeItem:{itemType:eh,itemValue:o}})}function fh({removePriorValues:t,tournamentRecords:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,courtDayDate:a,matchUpId:o,courtId:s}){var l;if(!i&&!e)return{error:ge};if(!o)return{error:yn};if(s){let u=ah({tournamentRecords:e,tournamentRecord:i,courtId:s});if(u.error)return u;let c=(l=u.venue)==null?void 0:l.venueId;Zg({tournamentRecords:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:o,venueId:c})}return Da({duplicateValues:!1,removePriorValues:t,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:o,timeItem:{itemType:Rc,itemDate:a,itemValue:s}})}function Vs(t,e){let i=WH.test(t)?t:bi(t),r=pt(t)||pt(e)||Bo(new Date);return new Date(`${r}T${i}`).getTime()}function FD(t){var M;let e="addMatchUpScheduleItems",i=ze(t,[{drawDefinition:!0,matchUpId:!0},{schedule:!0,[Xn]:ea}],e);if(i.error)return i;let{matchUpDependencies:r,inContextMatchUps:n}=t,{errorOnAnachronism:a=!1,checkChronology:o=!0,removePriorValues:s,tournamentRecords:l,tournamentRecord:u,drawDefinition:c,disableNotice:d,drawMatchUps:p,matchUpId:m,schedule:h,event:f}=t,g,v;if(p)g=p.find(C=>C.matchUpId===m);else{let C=wi({drawDefinition:c,event:f,matchUpId:m});if(C.error)return C;g=C.matchUp}let{endTime:y,courtId:I,courtIds:b,courtOrder:S,resumeTime:w,homeParticipantId:U,scheduledDate:T,scheduledTime:D,startTime:P,stopTime:E,timeModifiers:R,venueId:N}=h;o&&(!r||!n)&&({matchUpDependencies:r,matchUps:n}=us({drawDefinition:c}));let A=(M=r==null?void 0:r[m])==null?void 0:M.matchUpIds;if(h.scheduledDate&&o&&A){let C=n==null?void 0:n.filter(O=>{var k,x;return(((k=O.schedule)==null?void 0:k.scheduledDate)||pt((x=O.schedule)==null?void 0:x.scheduledTime))&&A.includes(O.matchUpId)}).map(({schedule:O})=>{let k=pS(O);return new Date(k).getTime()});if(C!=null&&C.length){let O=pS(h),k=new Date(O).getTime();if(Math.max(...C)>=k){if(a)return ee({result:{error:gC},stack:e});v=gC}}}if(T!==void 0){let C=kD({disableNotice:!0,removePriorValues:s,tournamentRecord:u,drawDefinition:c,scheduledDate:T,matchUpId:m});if(C!=null&&C.error)return ee({result:C,stack:e,context:{scheduledDate:T}})}if(D!==void 0){let C=Jc({disableNotice:!0,removePriorValues:s,tournamentRecord:u,drawDefinition:c,scheduledTime:D,matchUpId:m,matchUp:g});if(C!=null&&C.error)return ee({result:C,stack:e,context:{scheduledTime:D}})}if(P!==void 0){let C=Kk({disableNotice:!0,removePriorValues:s,tournamentRecord:u,drawDefinition:c,matchUpId:m,startTime:P,event:f});if(C!=null&&C.error)return ee({result:C,stack:e,context:{startTime:P}})}if(E!==void 0){let C=Jk({disableNotice:!0,removePriorValues:s,tournamentRecord:u,drawDefinition:c,matchUpId:m,stopTime:E,event:f});if(C!=null&&C.error)return ee({result:C,stack:e,context:{stopTime:E}})}if(w!==void 0){let C=Qk({disableNotice:!0,removePriorValues:s,tournamentRecord:u,drawDefinition:c,resumeTime:w,matchUpId:m,event:f});if(C!=null&&C.error)return ee({result:C,stack:e,context:{resumeTime:w}})}if(y!==void 0){let C=Xk({disableNotice:!0,removePriorValues:s,tournamentRecord:u,drawDefinition:c,matchUpId:m,endTime:y,event:f});if(C!=null&&C.error)return ee({result:C,stack:e,context:{endTime:y}})}if(b!==void 0){let C=xD({disableNotice:!0,removePriorValues:s,tournamentRecord:u,drawDefinition:c,matchUpId:m,courtIds:b});if(C!=null&&C.error)return ee({result:C,stack:e,context:{courtIds:b}})}if(I!==void 0&&T!==void 0){let C=fh({courtDayDate:T,disableNotice:!0,removePriorValues:s,tournamentRecords:l,tournamentRecord:u,drawDefinition:c,matchUpId:m,courtId:I});if(C!=null&&C.error)return ee({result:C,stack:e,context:{courtId:I}})}if(N!==void 0){let C=Zg({disableNotice:!0,removePriorValues:s,tournamentRecords:l,tournamentRecord:u,drawDefinition:c,matchUpId:m,venueId:N});if(C!=null&&C.error)return ee({result:C,stack:e,context:{venueId:N}})}if(S!==void 0&&ot(S)){let C=Yk({disableNotice:!0,removePriorValues:s,tournamentRecord:u,drawDefinition:c,courtOrder:S,matchUpId:m});if(C!=null&&C.error)return ee({result:C,stack:e,context:{courtOrder:S}})}if(R!==void 0){let C=iY({disableNotice:!0,removePriorValues:s,tournamentRecord:u,drawDefinition:c,timeModifiers:R,matchUpId:m,matchUp:g});if(C!=null&&C.error)return ee({result:C,stack:e,context:{timeModifiers:R}})}return Ti(U)&&qk({disableNotice:!0,homeParticipantId:U,removePriorValues:s,tournamentRecord:u,drawDefinition:c,matchUpId:m}),d||Rt({tournamentId:u==null?void 0:u.tournamentId,eventId:f==null?void 0:f.eventId,context:e,drawDefinition:c,matchUp:g}),v?{...J,warnings:[v]}:{...J}}function Yk({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,courtOrder:n,matchUpId:a}){if(!a)return{error:yn};if(n&&!ot(n))return{error:oe,info:"courtOrder must be numeric"};let o=n&&Qe(n);return Da({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:a,timeItem:{itemType:AT,itemValue:o}})}function rY({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,participantId:n,officialType:a,matchUpId:o}){if(!o)return{error:yn};if(!n)return{error:pr};if(e){let l=Ni({tournamentRecord:e,participantFilters:{participantTypes:[St],participantRoles:[KA]}}).participants??[];if(!Uc({tournamentParticipants:l,participantId:n}))return{error:zi}}let s={itemType:"SCHEDULE.ASSIGNMENT.OFFICIAL",itemValue:n};return a&&(s.itemSubTypes=[a]),Da({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:o,timeItem:s})}function Kk({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:n,startTime:a,event:o}){if(!n)return{error:yn};if(!Ng(a))return{error:No};let{matchUp:s}=wi({drawDefinition:i,event:o,matchUpId:n}),{scheduledDate:l}=nh({matchUp:s}),u=((s==null?void 0:s.timeItems)??[]).filter(c=>[gu,El,Eu].includes(c==null?void 0:c.itemType)).map(c=>Vs(c.itemValue,l)).reduce((c,d)=>!c||d<c?d:c,void 0);if(!u||Vs(a,l)<u){s!=null&&s.timeItems&&(s.timeItems=s.timeItems.filter(d=>d.itemType!==fs));let c=Km(a,!0,!0);return Da({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:n,timeItem:{itemType:fs,itemValue:c}})}else return{error:vH}}function Xk({validateTimeSeries:t=!0,removePriorValues:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:a,endTime:o,event:s}){if(!a)return{error:yn};if(!Ng(o))return{error:No};let{matchUp:l}=wi({drawDefinition:r,event:s,matchUpId:a}),{scheduledDate:u}=nh({matchUp:l}),c=((l==null?void 0:l.timeItems)??[]).filter(d=>[fs,El,gu].includes(d==null?void 0:d.itemType)).map(d=>Vs(d.itemValue,u)).reduce((d,p)=>!d||p>d?p:d,void 0);if(!t||!c||Vs(o,u)>c){l!=null&&l.timeItems&&(l.timeItems=l.timeItems.filter(p=>p.itemType!==Eu));let d=Km(o,!0,!0);return Da({duplicateValues:!1,removePriorValues:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:a,timeItem:{itemType:Eu,itemValue:d}})}else return{error:fH}}function Jk({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:n,stopTime:a,event:o}){if(!n)return{error:yn};if(!Ng(a))return{error:No};let{matchUp:s}=wi({drawDefinition:i,event:o,matchUpId:n}),{scheduledDate:l}=nh({matchUp:s}),u=(s==null?void 0:s.timeItems)??[];if(u.reduce((h,f)=>f.itemType===Eu||h,void 0))return{error:EN};let c=u.filter(h=>[fs,El,gu].includes(h==null?void 0:h.itemType)).sort((h,f)=>Vs(h.itemValue,l)-Vs(f.itemValue,l)),d=c[c.length-1],p=d&&d.itemType===gu,m=c.filter(h=>!p||h.createdAt!==d.createdAt).map(h=>Vs(h.itemValue,l)).reduce((h,f)=>!h||f>h?f:h,void 0);if(Vs(a,l)>m){if(s!=null&&s.timeItems&&p){let f=d.createdAt;s.timeItems=s.timeItems.filter(g=>g.createdAt!==f)}let h={itemValue:Km(a,!0,!0),itemType:gu};return Da({duplicateValues:!0,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:n,timeItem:h})}else return{error:gH}}function Qk({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,resumeTime:n,matchUpId:a,event:o}){if(!a)return{error:yn};if(!Ng(n))return{error:No};let{matchUp:s}=wi({drawDefinition:i,event:o,matchUpId:a}),{scheduledDate:l}=nh({matchUp:s}),u=(s==null?void 0:s.timeItems)??[];if(u.reduce((h,f)=>f.itemType===Eu||h,void 0))return{error:EN};let c=u.filter(h=>[fs,El,gu].includes(h==null?void 0:h.itemType)).sort((h,f)=>Vs(h.itemValue,l)-Vs(f.itemValue,l)),d=c[c.length-1],p=d&&d.itemType===El,m=c.filter(h=>!p||h.createdAt!==d.createdAt).map(h=>Vs(h.itemValue,l)).reduce((h,f)=>!h||f>h?f:h,void 0);if(Vs(n,l)>m){if(s!=null&&s.timeItems&&p){let f=d.createdAt;s.timeItems=s.timeItems.filter(g=>g.createdAt!==f)}let h={itemValue:Km(n,!0,!0),itemType:El};return Da({duplicateValues:!0,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:a,timeItem:h})}else return{error:Vne}}function Cme({drawDefinition:t,matchUpStatus:e,matchUpsMap:i,winningSide:r,dualMatchUp:n,tieFormat:a,structure:o,matchUp:s,event:l,score:u}){var p;let c=Me(n,void 0,!0);for(let m of(c==null?void 0:c.tieMatchUps)||[])m.matchUpId===s.matchUpId&&(m.winningSide=r,m.score=u,!Ir({score:u})&&!e?Object.assign(m,{...YT}):e&&(m.matchUpStatus=e));a=a??((p=vn({matchUp:s,structure:o,drawDefinition:t,event:l}))==null?void 0:p.tieFormat);let{winningSide:d}=bb({matchUp:c,drawDefinition:t,matchUpsMap:i,structure:o,tieFormat:a,event:l});return{projectedWinningSide:d}}function Mme(t){var S;let{tournamentRecord:e,inContextMatchUp:i,structure:r,drawDefinition:n}=t,a=i.roundNumber,o=i.sides.find(w=>w.sideNumber===i.winningSide),s=i.sides.find(w=>w.sideNumber!==i.winningSide),{drawPosition:l,participantId:u}=o,{drawPosition:c,participantId:d}=s,p="swapWinnerLoser",{matchUps:m}=Wt(t),h=m.filter(({drawPositions:w,roundNumber:U})=>(w==null?void 0:w.includes(l))&&U>a);Fa({changeWinner:!0})&&console.log({existingWinnerSubsequentMatchUps:h}),h.forEach(w=>{var U,T;w.drawPositions=((U=w.drawPositions)==null?void 0:U.map(D=>D===l?c:D))||[],Rt({tournamentId:e==null?void 0:e.tournamentId,eventId:(T=t.event)==null?void 0:T.eventId,context:p,drawDefinition:n,matchUp:w})});let{stage:f,stageSequence:g}=r,v=n.structures.filter(({stage:w,stageSequence:U})=>w===f&&U>g).map(({structureId:w})=>w),{targetLinks:{loserTargetLink:y,winnerTargetLink:I}}=t.targetData,b=[y==null?void 0:y.target.structureId,(S=I==null?void 0:I.target)==null?void 0:S.structureId].filter(Boolean);return n.structures.filter(({stage:w,structureId:U})=>w!==f&&b.includes(U)).forEach(({stage:w,stageSequence:U,structureId:T})=>{v.includes(T)||v.push(T),n.structures.filter(({stage:D,stageSequence:P})=>D===w&&P>U).forEach(({structureId:D})=>{v.includes(D)||v.push(D)})}),n.structures.filter(({structureId:w})=>v.includes(w)).forEach(w=>{let{positionAssignments:U}=oi({structure:w}),T=U==null?void 0:U.find(({participantId:P})=>P===u),D=U==null?void 0:U.find(({participantId:P})=>P===d);T&&(T.participantId=d),D&&(D.participantId=u)}),Ws({...t,context:p})}function xb(t){var $,_,L;let e="setMatchUpStatus";t.matchUpStatus&&[zt,er].includes(t.matchUpStatus)&&(t.score=void 0);let{allowChangePropagation:i,disableScoreValidation:r,tournamentRecords:n,tournamentRecord:a,disableAutoCalc:o,enableAutoCalc:s,drawDefinition:l,matchUpStatus:u,winningSide:c,matchUpId:d,event:p,score:m}=t;if(!l)return{error:_e};if(u&&[Hu,co,$a,Ji].includes(u)&&c)return{error:oe,winningSide:c,matchUpStatus:u};if(![void 0,...oW].includes(u))return ee({result:{error:Pg},info:"matchUpStatus does not exist",stack:"setMatchUpStatus"});let h=sn({drawDefinition:l}),{matchUps:f}=mr({nextMatchUps:!0,tournamentRecord:a,inContext:!0,drawDefinition:l,matchUpsMap:h,event:p}),g=h.drawMatchUps.find(B=>B.matchUpId===d),v=f==null?void 0:f.find(B=>B.matchUpId===d);if(!g||!f)return{error:dn};if((g.winningSide||c)&&u===Vt)return{context:"Cannot have Bye with winningSide",error:TU,matchUpStatus:u};let y=v==null?void 0:v.structureId,{structure:I}=et({drawDefinition:l,structureId:y}),b=Yi(hi)(g.matchUpType),S=($=v==null?void 0:v.drawPositions)==null?void 0:$.filter(Boolean),w=v==null?void 0:v.matchUpTieId,U=Cn({matchUpId:w||d,inContextDrawMatchUps:f,drawDefinition:l});Object.assign(t,{inContextDrawMatchUps:f,inContextMatchUp:v,matchUpTieId:w,matchUpsMap:h,targetData:U,structure:I,matchUp:g});let T=jd(t),D;if(b){if(o)Lt({extension:{name:Um,value:!0},element:g});else if(s){let B=g.winningSide,{winningSide:V,scoreStringSide1:G,scoreStringSide2:j,set:z}=bb({drawDefinition:l,matchUpsMap:h,structure:I,matchUp:g,event:p}),W={scoreStringSide1:G,scoreStringSide2:j,sets:z?[z]:[]};if(D=V!==B,T&&D)return ee({stack:"winningSideWithDownstreamDependencies",result:{error:q0},context:{winningSide:c,matchUp:g}});Un({name:Um,element:g}),Object.assign(t,{winningSide:V,dualWinningSideChange:D,projectedWinningSide:V,score:W})}wb({tournamentId:a==null?void 0:a.tournamentId,inContextDualMatchUp:v,eventId:p==null?void 0:p.eventId,dualMatchUp:g,drawDefinition:l})}if(b&&u&&[Jm].includes(u))return{info:"Not supported for matchUpType: TEAM",error:oe};if(m&&!b&&!r){let B=g.matchUpFormat??(I==null?void 0:I.matchUpFormat)??(l==null?void 0:l.matchUpFormat)??(p==null?void 0:p.matchUpFormat),V=YO({existingMatchUpStatus:g.matchUpStatus,matchUpFormat:B,matchUpStatus:u,winningSide:c,score:m});if(V.error)return V}let P=((_=$t({policyTypes:[MI,Rs],tournamentRecord:a,drawDefinition:l,event:p}))==null?void 0:_.appliedPolicies)??{};Nt(t.policyDefinitions)&&Object.assign(P,t.policyDefinitions);let E=Ame({assignedDrawPositions:S,inContextMatchUp:v,appliedPolicies:P,drawDefinition:l,matchUpStatus:u,structure:I,matchUp:g});if(E!=null&&E.error)return E;let R=(v==null?void 0:v.stage)===Ye&&v.finishingRound===1,N=R&&c,A=R&&g.winningSide&&!c&&(!t.matchUpStatus||t.matchUpStatus&&$C({matchUpStatus:t.matchUpStatus}))&&(!t.outcome||!Ir({outcome:t.outcome})),M=N&&c!==g.winningSide&&g.winningSide;if(Object.assign(t,{qualifierAdvancing:N,qualifierChanging:M,removingQualifier:A,appliedPolicies:P}),w){let{matchUp:B}=wi({matchUpId:w,inContext:!0,drawDefinition:l,matchUpsMap:h,event:p});if(B){let V=(L=vn({matchUp:B,drawDefinition:l,structure:I,event:p}))==null?void 0:L.tieFormat,{projectedWinningSide:G}=Cme({drawDefinition:l,matchUpStatus:u,dualMatchUp:B,matchUpsMap:h,winningSide:c,tieFormat:V,structure:I,matchUp:g,event:p,score:m}),j=B.winningSide;D=G!==j;let z=B._disableAutoCalc;Object.assign(t,{isCollectionMatchUp:!0,dualWinningSideChange:D,projectedWinningSide:G,autoCalcDisabled:z,matchUpTieId:w,dualMatchUp:B,tieFormat:V})}}let C=ab({matchUpStatus:u});if(!w){if(T&&!c&&(u&&$C({matchUpStatus:u})||u&&[er,cr].includes(u)))return{error:TU,activeDownstream:T,winningSide:c};if(c&&c===g.winningSide&&u&&!C)return{context:"winningSide must include directing matchUpStatus",error:TU,directingMatchUpStatus:C,matchUpStatus:u}}let{schedule:O}=t;if(O){let B=FD({disableNotice:!0,tournamentRecords:n,tournamentRecord:a,drawDefinition:l,matchUpId:d,schedule:O});if(B.error)return B}let k=!b&&!D&&c&&g.winningSide&&g.winningSide!==c;if(i&&k&&g.roundPosition)return Mme(t);let x=c&&!w||t.projectedWinningSide;Aa({activeDownstream:T,matchUpWinner:x,method:e,winningSide:c});let F=!T&&Eme(t)||x&&Nme(t)||(C||t.autoCalcDisabled)&&nY(t)||{error:DH};return ee({result:F,stack:e})}function Nme(t){let{matchUp:e,winningSide:i,matchUpTieId:r,dualWinningSideChange:n}=t;return i===e.winningSide||r&&!n?nY(t):ee({stack:"winningSideWithDownstreamDependencies",result:{error:q0},context:{winningSide:i,matchUp:e}})}function nY(t){let{tournamentRecord:e,matchUp:i,event:r}=t,n=t.isCollectionMatchUp&&i.winningSide&&!t.winningSide&&!Ir({score:t.score}),a=t.isCollectionMatchUp?t.matchUpStatus||n&&Ji||t.winningSide&&qi||co:t.matchUpStatus||qi,o=t.removeScore||[Hu,zt].includes(a)&&![co,$a].includes(a),s=Ws({...t,matchUpStatus:a,removeWinningSide:n,context:"sms",removeScore:o});if(s.error)return s;if(t.isCollectionMatchUp){let{matchUpTieId:l,drawDefinition:u,matchUpsMap:c}=t,d=Yu({appliedPolicies:t.appliedPolicies,matchUpId:l,tournamentRecord:e,drawDefinition:u,matchUpsMap:c,event:r});if(d.error)return d;Object.assign(s,{tieMatchUpResult:d})}return s}function Ame({assignedDrawPositions:t,inContextMatchUp:e,appliedPolicies:i,drawDefinition:r,matchUpStatus:n,structure:a,matchUp:o}){var c,d;if(((c=i==null?void 0:i[Rs])==null?void 0:c.requireParticipantsForScoring)===!1)return{...J};let s=(d=e==null?void 0:e.sides)==null?void 0:d.map(p=>p.participantId).filter(Boolean).length,l=o!=null&&o.sides?[]:oi({structureId:a==null?void 0:a.structureId,drawDefinition:r}).positionAssignments,u=s&&s===2||o.collectionId&&zn({structure:a})&&s&&s>=1||(t==null?void 0:t.length)===2&&(l==null?void 0:l.filter(p=>t.includes(p.drawPosition)).every(p=>p.participantId));return n&&aW.includes(n)&&!u?ee({info:"matchUpStatus requires assigned participants",context:{matchUpStatus:n,requiredParticipants:u},result:{error:Pg}}):{...J}}function aY({tournamentRecord:t,drawDefinition:e,matchUpId:i,event:r}){if(!e)return{error:_e};let{matchUp:n}=wi({drawDefinition:e,matchUpId:i,event:r});return(n==null?void 0:n.matchUpType)!==ka?{error:aa}:xb({enableAutoCalc:!0,tournamentRecord:t,drawDefinition:e,matchUpId:i,event:r})}function oY({drawDefinition:t,event:e,matchUpId:i}){if(!t)return{error:_e};if(!i)return{error:yn};let{matchUp:r}=wi({drawDefinition:t,event:e,matchUpId:i});return r?Un({name:bT,element:r}):{error:dn}}function Ome({substituteParticipantId:t,existingParticipantId:e,tournamentRecord:i,drawDefinition:r,sideNumber:n,matchUpId:a,event:o}){var m,h,f,g,v;let s="substituteParticipant";if(!r)return{error:_e};if(!a)return{error:yn};if(!e||!t)return ee({result:{error:pr},stack:s});let{matchUp:l}=wi({drawDefinition:r,matchUpId:a,event:o});if(!l)return{error:dn};if(!l.collectionId)return ee({result:{error:aa},stack:s});let u=sn({drawDefinition:r}),{matchUps:c}=mr({tournamentParticipants:i==null?void 0:i.participants,inContext:!0,drawDefinition:r,matchUpsMap:u}),d=c==null?void 0:c.find(y=>y.matchUpId===a),p=(h=(m=c==null?void 0:c.find(y=>y.matchUpId===(d==null?void 0:d.matchUpTieId)))==null?void 0:m.sides)==null?void 0:h.find(y=>y.participant.individualParticipants.some(({participantId:I})=>I===e));return!p||n&&p.sideNumber!==n?{error:Ts}:(v=(g=(f=p.participant)==null?void 0:f.individualParticipants)==null?void 0:g.map(Ut).filter(y=>y!==e))!=null&&v.includes(t)?zk({newParticipantId:t,tieMatchUpId:a,existingParticipantId:e,substitution:!0,tournamentRecord:i,drawDefinition:r,event:o}):ee({result:{error:Ts},stack:s})}function sY(t){return Ome(t)}function lY({drawDefinition:t,matchUpId:e,event:i}){if(!t)return{error:_e};let{matchUp:r}=wi({drawDefinition:t,matchUpId:e,event:i});return Lt({extension:{name:Um,value:!0},element:r})}function uY(t){let e="setMatchUpFormat",i=ze(t,[{tournamentRecord:!0},{[Kr]:S=>Ua({matchUpFormat:S}),[_a]:Cy,matchUpFormat:!0}]);if(i.error)return ee({result:i,stack:e});let{tournamentRecord:r,drawDefinition:n,scheduledDates:a,stageSequences:o,matchUpFormat:s,structureId:l,eventType:u,matchUpId:c,eventId:d,stages:p,drawId:m,event:h,force:f}=t;if(a&&!Array.isArray(a))return ee({result:{error:oe,scheduledDates:a},stack:e});if(u&&!B0([el,uo],u))return ee({result:{error:Bl},stack:e});let g=0,v=t.structureIds||l&&[l].filter(Boolean)||[],y=t.eventIds||d&&[d].filter(Boolean)||[],I=t.drawIds||m&&[m].filter(Boolean)||[];if((l||v!=null&&v.length)&&!n)return ee({result:{error:_e},stack:e});if(m&&c&&n){let S=QO({tournamentRecord:r,drawDefinition:n,matchUpFormat:s,structureIds:v,structureId:l,matchUpId:c});if(S.error)return S;g+=1}let b=S=>{let w=[];for(let U of S.structures||[]){if(Array.isArray(p)&&!p.includes(U.stage)||Array.isArray(o)&&!o.includes(U.stageSequence)||v!=null&&v.length&&!v.includes(U.structureId))continue;v!=null&&v.length&&U.matchUpFormat!==s&&(U.matchUpFormat=s,w.push(U.structureId),g+=1);let T=((f||a)&&Wt({matchUpFilters:{matchUpStatuses:[Ji]},structure:U}).matchUps)??[],D=(a&&Wt({matchUpFilters:{matchUpStatuses:[Ji]},contextFilters:{scheduledDates:a},afterRecoveryTimes:!1,inContext:!0,structure:U}).matchUps)??[];if(T!=null&&T.length){let P=D?D.map(Dr):T.map(Dr);for(let E of T)P.includes(E.matchUpId)&&(E.matchUpFormat=a!=null&&a.length?s:void 0,Rt({tournamentId:r==null?void 0:r.tournamentId,eventId:h==null?void 0:h.eventId,context:e,drawDefinition:S,matchUp:E}))}}return!w.length&&S.matchUpFormat!==s&&(S.matchUpFormat=s,g+=1),w};for(let S of(r==null?void 0:r.events)||[])if(!(y!=null&&y.length&&!y.includes(S.eventId)||u&&u!==S.eventType||u===sr))if(Array.isArray(o)||Array.isArray(p)||v!=null&&v.length||I!=null&&I.length)for(let w of S.drawDefinitions||[]){if(Array.isArray(I)&&!I.includes(w.drawId))continue;let U=b(w);li({structureIds:U,drawDefinition:w})}else S.matchUpFormat!==s&&(S.matchUpFormat=s,g+=1);return g?{...J,modificationsCount:g}:{...J,info:Mg}}function Zk({inheritance:t=!0,tournamentRecord:e,drawDefinition:i,matchUpId:r,event:n}){var l,u;if(!i)return{error:_e};let a=(l=wi({drawDefinition:i,matchUpId:r}))==null?void 0:l.matchUp;if(!(a!=null&&a.tieMatchUps))return{error:aa};let o=(u=wi({inContext:!0,drawDefinition:i,matchUpId:r,event:n}))==null?void 0:u.matchUp,s=0;return((a==null?void 0:a.sides)||[]).forEach(c=>{c.lineUp&&delete c.lineUp}),((o==null?void 0:o.sides)||[]).forEach(c=>{if(s+=1,t===!1){let d=o==null?void 0:o.tieFormat,p=c.participantId;d&&p&&ch({drawDefinition:i,participantId:p,lineUp:[],tieFormat:d})}Rt({tournamentId:e==null?void 0:e.tournamentId,context:"resetMatchUpLineUps",eventId:n==null?void 0:n.eventId,drawDefinition:i,matchUp:a})}),{...J,modificationsCount:s}}function cY(t){let{matchUpFormat:e,matchUpStatus:i,winningSide:r,score:n}=t;if(!n)return{sets:[]};let a=n.sets||[],o=Ml({winnerFirst:!1,matchUpFormat:e,matchUpStatus:i,sets:a}),s=Ml({winnerFirst:!1,reversed:!0,matchUpFormat:e,matchUpStatus:i,sets:a}),l=Ml({matchUpFormat:e,matchUpStatus:i,winningSide:r,sets:a}),u=o===l?s:o;return r&&(o=r===1?l:u,s=r===2?l:u),{score:{sets:a,scoreStringSide1:o,scoreStringSide2:s}}}function Fb(t){var v,y;let e=ze(t,[{[fl]:!0,[Fn]:!0}]);if(e.error)return e;let i=Io(t);if(!t.drawDefinition){let I=t.tournamentRecord??(t.tournamentId&&i[t.tournamentId]);t.tournamentRecord||(t.tournamentRecord=I);let b=Wn({eventId:t.eventId,drawId:t.drawId,tournamentRecord:I});if(b.error)return b;b.drawDefinition&&(t.drawDefinition=b.drawDefinition),t.event=b.event}let{disableScoreValidation:r,policyDefinitions:n,tournamentRecord:a,disableAutoCalc:o,enableAutoCalc:s,drawDefinition:l,matchUpId:u,schedule:c,event:d,notes:p}=t,m=t.matchUpFormat||((v=t.outcome)==null?void 0:v.matchUpFormat),{policy:h}=hp({policyType:Rs,tournamentRecord:a,event:d}),f=t.allowChangePropagation!==void 0&&t.allowChangePropagation||(h==null?void 0:h.allowChangePropagation)!==void 0&&h.allowChangePropagation||void 0,{outcome:g}=t;if(g!=null&&g.winningSide&&![1,2].includes(g.winningSide))return{error:z0};if(m){let I=QO({tournamentRecord:a,drawDefinition:l,matchUpFormat:m,matchUpId:u,event:d});if(I.error)return I}if((y=g==null?void 0:g.score)!=null&&y.sets&&!g.score.scoreStringSide1){let{score:I}=cY(g);g.score=I,g.score.sets=g.score.sets.filter(b=>b.side1Score||b.side2Score||b.side1TiebreakScore||b.side2TiebreakScore)}return xb({matchUpStatusCodes:g==null?void 0:g.matchUpStatusCodes,matchUpStatus:g==null?void 0:g.matchUpStatus,winningSide:g==null?void 0:g.winningSide,allowChangePropagation:f,disableScoreValidation:r,score:g==null?void 0:g.score,tournamentRecords:i,policyDefinitions:n,tournamentRecord:a,disableAutoCalc:o,enableAutoCalc:s,drawDefinition:l,matchUpFormat:m,matchUpId:u,schedule:c,event:d,notes:p})}function dY(t){if(!(t!=null&&t.outcomes))return{error:Xe};if(!Array.isArray(t.outcomes))return{error:Xe,info:{outcomes:t.outcomes}};let e=t.tournamentRecords||t.tournamentRecord&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord}||{},i=t.outcomes??[],r=i.reduce((n,a)=>n.includes(a.tournamentId)?n:n.concat(a.tournamentId),[]);for(let n of r){let a=e[n];if(!a)return{error:ge};let o=i.filter(s=>s.tournamentId===n);if(o.length){let s=kme({outcomes:o,tournamentRecord:a});if(s.error)return s}}return{...J}}function kme(t){var o;let{tournamentRecords:e,tournamentRecord:i,outcomes:r,policyDefinitions:n}=t,a={};r.forEach(s=>{let{eventId:l}=s;a[l]||(a[l]=[]),a[l].push(s)});for(let s of Object.keys(a)){let{event:l}=Wn({tournamentRecord:i,eventId:s});for(let u of a[s]){let{drawId:c}=u,d=(o=l==null?void 0:l.drawDefinitions)==null?void 0:o.find(p=>p.drawId===c);if(d&&c){let{matchUpFormat:p,matchUpId:m}=u,h=Fb({schedule:u==null?void 0:u.schedule,tournamentRecords:e,policyDefinitions:n,tournamentRecord:i,drawDefinition:d,matchUpFormat:p,matchUpId:m,outcome:u,drawId:c,event:l});if(h.error)return h}}}return{...J}}function xme({drawDefinition:t,matchUpId:e,outcome:i,matchUp:r}){var n,a;if(!r&&!t)return{error:_e};if(!i)return{error:Xe,info:"missing outcome"};if(!r&&!e)return{error:na};if(!r){let o=wi({drawDefinition:t,matchUpId:e});if(o.error)return o;r=o.matchUp}return typeof i!="object"||!((n=i.score)!=null&&n.scoreStringSide1)||!((a=i.score)!=null&&a.scoreStringSide2)?{error:oe}:Lt({element:r,extension:{name:bT,value:i}})}function pY(t){return xme(t)}function ex(t){var f,g;let e="resetTieFormat",{drawDefinition:i,event:r,uuids:n}=t,a=ze(t,[{[wr]:!0,[fl]:!0}],e);if(a.error)return a;let o=qg(t,[{[Og]:Zl}]);if(o[Vo])return o;let s=(f=t.tournamentRecord)==null?void 0:f.tournamentId,{matchUp:l,structure:u}=(o==null?void 0:o.matchUp)??{};if(!(l!=null&&l.tieMatchUps))return ee({result:{error:aa},info:"Must be a TEAM matchUp",stack:e});if(!l.tieFormat)return{...J};let c=(g=vn({structure:u,drawDefinition:i,event:r}))==null?void 0:g.tieFormat;if(!c)return ee({result:{error:$r},info:"No inherited tieFormat",stack:e});let d=[],p=[],m=[],h=[];for(let v of c.collectionDefinitions){let{matchUpCount:y,collectionId:I}=v;p.push(I);let b=(l.tieMatchUps||[]).filter(S=>S.collectionId===I);if(b.length>y)b.sort((S,w)=>(S.matchUpStatus===Ji?1:0)-(w.matchUpStatus===Ji?1:0)),m.push(...b.slice(0,y)),d.push(...b.slice(3).map(Dr));else if(m.push(...b),b.length<y){let S=y-b.length,w=Ib({collectionDefinition:v,matchUpsLimit:S,matchUp:l,uuids:n});h.push(...w)}}for(let v of(l==null?void 0:l.tieMatchUps)||[])v.collectionId&&!p.includes(v.collectionId)&&d.push(v.matchUpId);return h.length&&(m.push(...h),Dc({eventId:r==null?void 0:r.eventId,matchUps:h,drawDefinition:i,tournamentId:s})),d.length&&zu({matchUpIds:d,eventId:r==null?void 0:r.eventId,drawDefinition:i,tournamentId:s}),l&&(l.tieMatchUps=m,l.tieFormatId=void 0,l.tieFormat=void 0,Rt({structureId:u==null?void 0:u.structureId,eventId:r==null?void 0:r.eventId,context:e,drawDefinition:i,tournamentId:s,matchUp:l})),{...J,newMatchUps:h,deletedMatchUpIds:d}}function tx(t){var f,g,v;let{tournamentRecord:e,drawDefinition:i,matchUpId:r,event:n}=t,a="resetScorecard";if(!i)return ee({result:{error:_e},stack:a});if(!r)return ee({result:{error:yn},stack:a});if(!Ti(r))return ee({result:{error:oe,matchUpId:r},stack:a});let o=sn({drawDefinition:i}),{matchUps:s}=mr({nextMatchUps:!0,inContext:!0,drawDefinition:i,matchUpsMap:o}),l=o.drawMatchUps.find(y=>y.matchUpId===r),u=s==null?void 0:s.find(y=>y.matchUpId===r);if(!l||!s)return{error:dn};if(l.matchUpType!==Sa)return{error:aa};let c=Cn({inContextDrawMatchUps:s,drawDefinition:i,matchUpId:r}),d=u==null?void 0:u.structureId,{structure:p}=et({drawDefinition:i,structureId:d});if(Object.assign(t,{inContextDrawMatchUps:s,inContextMatchUp:u,matchUpsMap:o,targetData:c,structure:p,matchUp:l}),jd(t))return{error:q0};if((f=l.tieMatchUps)!=null&&f.length)for(let y of l.tieMatchUps){let I=xb({matchUpId:y.matchUpId,matchUpTieId:r,winningSide:void 0,removeScore:!0,tournamentRecord:e,drawDefinition:i,event:n});if(I.error)return ee({result:I,stack:a})}let m=(g=$t({tournamentRecord:e,drawDefinition:i,event:n}))==null?void 0:g.appliedPolicies,h=Yu({event:t.event,removeScore:!0,tournamentRecord:e,appliedPolicies:m,drawDefinition:i,matchUpsMap:o,matchUpId:r});if(h.error)return ee({result:h,stack:a});if(t.tiebreakReset&&!h.tieFormatRemoved){let y=(v=vn({drawDefinition:i,structure:p,event:n}))==null?void 0:v.tieFormat;if(l.tieFormat&&y){let{matchUpCountDifference:I,descendantDifferences:b,ancestorDifferences:S,valueDifference:w}=Cu({descendant:l.tieFormat,ancestor:y});if(b.collectionIds.length===1&&!S.collectionIds.length&&!S.groupsCount&&I===1&&w===1){let U=ex({tournamentRecord:e,drawDefinition:i,matchUpId:r,event:n});if(U.error)return U}}}return{...J}}function mY(t){let e=ze(t,[{[Fn]:!0,[Gc]:!0},{[kf]:{[$y]:!1,roundNumbers:!1},[Wz]:"At least one must be provided",[Xn]:un}]);if(e.error)return e;let i=b3(t);if(i.error)return i;let{matchUpIds:r}=i,n=Yi(Sa)(t.event.eventType),{tournamentRecord:a,drawDefinition:o,event:s}=t;for(let l of r){if(n){let c=tx({tiebreakReset:!0,tournamentRecord:a,drawDefinition:o,matchUpId:l,event:s});if(c.error||t.removeAssignments&&Zk({inheritance:!1,drawDefinition:o,matchUpId:l}).error)return c}let u=xb({winningSide:void 0,removeScore:!0,tournamentRecord:a,drawDefinition:o,matchUpId:l,event:s});if(u.error)return u;if(t.removeAssignments){let c=Wk({...t,matchUpId:l});if(c.error)return c}}return{...J}}function Fme({tournamentRecord:t,drawDefinition:e,finishingOrder:i}){var y;if(!e)return{error:_e};let r="setOrderOfFinish";if(!Array.isArray(i))return ee({info:Bd("finishingOrder"),result:{error:oe},stack:r});let{completedMatchUps:n,matchUpsMap:a}=$g({inContext:!0,drawDefinition:e}),o=(n==null?void 0:n.map(Dr))??[],s=i.map(Dr),{matchUpTypes:l,roundNumbers:u,structureIds:c,matchUpTieIds:d}=(n??[]).filter(({matchUpId:I})=>s.includes(I)).reduce((I,b)=>{let{matchUpTieId:S,matchUpType:w,roundNumber:U,structureId:T}=b;return I.matchUpTypes.includes(w)||I.matchUpTypes.push(w),I.roundNumbers.includes(U)||I.roundNumbers.push(U),I.structureIds.includes(T)||I.structureIds.push(T),I.matchUpTieIds.includes(S)||I.matchUpTieIds.push(S),I},{matchUpTypes:[],roundNumbers:[],structureIds:[],matchUpTieIds:[]});if(l.length>1||d.length>1||u.length>1||c.length>1)return ee({info:"matchUpType, structureId and roundNumber must be equivalent",result:{error:oe},stack:r});let p,m,h={},f=[],g=[];if(!i.every(({orderOfFinish:I,matchUpId:b})=>(f.push(b),I&&g.push(I),h[b]=I,p=o.includes(b),m=I===void 0||ot(I)&&Math.floor(I)>0,p&&m)))return ee({result:{error:p?oe:Pg},info:!p&&"matchUps must be completed"||!m&&"orderOfFinish must be integer > 0 or undefined"||void 0,stack:r});let v=n==null?void 0:n.filter(I=>I.structureId===c[0]&&I.roundNumber===u[0]&&I.matchUpType===l[0]&&I.matchUpTieId===d[0]&&!f.includes(I.matchUpId));for(let I of v??[]){let{orderOfFinish:b}=I||{};if(b){if(!ot(b))return ee({context:{orderOfFinish:b,matchUp:I},result:{error:oe},stack:r});g.push(b)}}if(gG(g).length!==g.length||Math.max(...g)>g.length)return ee({info:"Values not unique or greater than expected number of values",result:{error:oe},stack:r});if(c.length){let I=_T({matchUpFilters:{matchUpIds:s},structureId:c[0],drawDefinition:e,matchUpsMap:a});if(I.error)return ee({result:I,stack:r});(y=I.completedMatchUps)==null||y.forEach(b=>{b.orderOfFinish=h[b.matchUpId],Rt({tournamentId:t.tournamentId,context:"setOrderOfFinish",drawDefinition:e,matchUp:b})})}return{...J}}function hY(t){return Fme(t)}function fY(t){var v,y,I,b;let{tournamentRecord:e,drawDefinition:i,matchUpId:r,lineUps:n,event:a}=t,o="applyLineUps",s=ze(t,[{[wr]:!0,[Fn]:!0,[fl]:!0},{lineUps:!0,[Xn]:un}],o);if(s.error)return s;let l=e.participants||[],u=wi({tournamentParticipants:l,inContext:!0,drawDefinition:i,matchUpId:r});if(u.error)return u;if(!u.matchUp)return{error:dn};let{matchUp:c,structure:d}=u,{drawPositions:p,matchUpType:m}=c;if(m!==hi)return{error:aa};if(!(p!=null&&p.length))return{error:Ry};let h=(v=vn({matchUp:c,drawDefinition:i,structure:d,event:a}))==null?void 0:v.tieFormat,f={};for(let S of n){if(!Array.isArray(S))return{error:oe,lineUp:S};let w={},U=[];for(let R of S){if(typeof R!="object")return{error:oe,lineUpAssignment:R};let{participantId:N,collectionAssignments:A=[]}=R;if(!Array.isArray(A))return{error:oe,collectionAssignments:A};let M=l.find(O=>O.participantId===N);if(!M)return{error:zi};if(M.participantType!==St)return{error:Ds};let C=(I=(y=c.sides)==null?void 0:y.find(O=>{var k,x;return(x=(k=O.participant)==null?void 0:k.individualParticipantIds)==null?void 0:x.includes(N)}))==null?void 0:I.sideNumber;C&&U.push(C);for(let O of A){if(typeof O!="object")return{error:oe,collectionAssignment:O};let{collectionId:k,collectionPosition:x}=O,F=(b=h==null?void 0:h.collectionDefinitions)==null?void 0:b.find(L=>L.collectionId===k);if(!F)return{error:oe,collectionId:k};let $=`${k}-${x}`;w[$]||(w[$]=[]);let _=w[$].length;if(Yi(ti)(F.matchUpType)&&_||F.matchUpType===Zt&&_>1)return{info:"Excessive collectionPosition assignments",error:oe};w[$].push(N)}}let T=Object.values(w);for(let R of T)if(R.length===2){let{participant:N}=es({tournamentParticipants:l,participantIds:R});if(!N){let A=al({participant:{participantType:ht,participantRole:Qr,individualParticipantIds:R},pairOverride:!0,tournamentRecord:e});if(A.error)return A}}let D=wa(U),P=(D[1]||0)>(D[2]||0)&&1||(D[2]||0)>(D[1]||0)&&2||void 0,E=Object.keys(f).map(R=>parseInt(R));P&&!E.includes(P)&&(f[P]=S)}if(!Object.keys(f).length)return{error:ON};if(u=wi({drawDefinition:i,matchUpId:r}),u.error)return u;if(!u.matchUp)return{error:dn};let{matchUp:g}=u;g.sides||(g.sides=[]);for(let S of[1,2]){let w=g.sides.find(T=>T.sideNumber===S),U=f[S];if(U)w?w.lineUp=U:g.sides.push({lineUp:U,sideNumber:S});else continue}return Rt({tournamentId:e==null?void 0:e.tournamentId,context:o,drawDefinition:i,matchUp:g}),{...J}}var ix={};yt(ix,{anonymizeTournamentRecord:()=>LY,generate:()=>gY,generateEventWithDraw:()=>VD,generateOutcome:()=>cx,generateOutcomeFromScoreString:()=>rx,generateParticipants:()=>ev,generateTournamentRecord:()=>xY,modifyTournamentRecord:()=>_Y,mutate:()=>FY});var gY={};yt(gY,{generateEventWithDraw:()=>VD,generateOutcome:()=>cx,generateOutcomeFromScoreString:()=>rx,generateParticipants:()=>ev,generateTournamentRecord:()=>xY});function rx(t){let{matchUpFormat:e,matchUpStatus:i,winningSide:r,scoreString:n}=t;if(!n)return{outcome:{...YT,winningSide:r,matchUpStatus:i}};if(r&&![1,2,void 0].includes(r))return{error:oe,winningSide:r};let a=n&&LS({scoreString:n}),o={},s=Ml({sets:a,matchUpFormat:e}),l=Ml({sets:a,reversed:!0,matchUpFormat:e});return r===2?(o.scoreStringSide1=l,o.scoreStringSide2=s):(o.scoreStringSide1=s,o.scoreStringSide2=l),o.sets=LS({scoreString:o.scoreStringSide1}),Ge({outcome:{matchUpStatus:i,winningSide:r,score:o}})}function nx({matchUpScheduleTimes:t,matchUpDependencies:e,allDateMatchUpIds:i,matchUp:r}){var a;let n=(((a=e==null?void 0:e[r.matchUpId])==null?void 0:a.matchUpIds)||[]).filter(o=>i.includes(o)).filter(o=>!t[o]);return{dependenciesScheduled:!(n!=null&&n.length),remainingDependencies:n}}function Lb({individualParticipantProfiles:t,participantId:e}){t[e]||(t[e]={typeChangeTimeAfterRecovery:void 0,timeAfterRecovery:void 0,priorMatchUpType:void 0,potentialRecovery:{},potentialCounted:{},potentialBookings:{},bookings:[],counters:{}})}function Lme({individualParticipantProfiles:t,recoveryValue:e,participantId:i,scheduleTime:r,drawId:n}){t[i].potentialRecovery[n]||(t[i].potentialRecovery[n]=[]),t[i].potentialRecovery[n].push(e),t[i].potentialBookings[n]||(t[i].potentialBookings[n]=[]),t[i].potentialBookings[n].push({timeAfterRecovery:e,scheduleTime:r})}function jI({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,typeChangeRecoveryMinutes:i,averageMatchUpMinutes:r=0,matchUpNotBeforeTimes:n,matchUpDependencies:a,recoveryMinutes:o=0,scheduleTime:s,matchUp:l}){var h,f;let u=bi((h=l==null?void 0:l.schedule)==null?void 0:h.endTime),c=u?ia(u,Qe(o)):ia(s,Qe(r)+Qe(o)),d=i&&(u?ia(bi(u),i):ia(s,Qe(r)+Qe(i))),p=((f=a==null?void 0:a[l.matchUpId])==null?void 0:f.participantIds)||[],m=(l.roundPosition&&t[l.matchUpId]||[]).flat();p.forEach(g=>{Lb({individualParticipantProfiles:e,participantId:g});let v=e[g].priorMatchUpType!==l.matchUpType&&d||c;m.includes(g)?Lme({individualParticipantProfiles:e,drawId:l.drawId,recoveryValue:v,participantId:g,scheduleTime:s}):(e[g].timeAfterRecovery=v,e[g].bookings.push({scheduleTime:s,timeAfterRecovery:v}))}),zf({matchUpPotentialParticipantIds:t,matchUpNotBeforeTimes:n,timeAfterRecovery:c,matchUp:l})}function vY({matchUpScheduleTimes:t,matchUpDependencies:e,scheduleTime:i,matchUpId:r,details:n}){var c,d,p,m,h;let a,o=(d=(c=n.minutesMap)==null?void 0:c[r])==null?void 0:d.recoveryMinutes,s=(((m=(p=n.minutesMap)==null?void 0:p[r])==null?void 0:m.averageMinutes)||0)+(o||0),l=ia(i,s),u=((h=e==null?void 0:e[r])==null?void 0:h.dependentMatchUpIds)||[];if(u.length){let f=u.reduce((g,v)=>{let y=t[v];if(!y)return g;let I={scheduleTime:y,matchUpId:v};return y&&!g.matchUpId||kt(y)<kt(g.scheduleTime)?I:g},{});f.scheduleTime&&kt(l)>kt(f.scheduleTime)&&(a=f)}return{scheduledDependent:a}}function _me(t){let{sides:e,matchUpType:i}=t||{};return(e||[]).map(r=>{var n;return i===Zt&&(((n=r==null?void 0:r.participant)==null?void 0:n.individualParticipants)||[])||(r==null?void 0:r.participant)&&[r.participant]||[]}).flat()}var _b="DO_NOT_SCHEDULE",$me={DO_NOT_SCHEDULE:_b};function ax({averageMatchUpMinutes:t=90,requestConflicts:e={},potentials:i=!0,personRequests:r,scheduleTime:n,scheduleDate:a,matchUp:o}){let s=_me(o).map(({person:m})=>m==null?void 0:m.personId);if(i){let m=((o==null?void 0:o.potentialParticipants)||[]).flat().map(({person:h})=>h==null?void 0:h.personId);s.push(...m)}let l=s.map(m=>{var h;return(h=r[m])==null?void 0:h.map(f=>({...f,personId:m}))}).filter(Boolean).flat().filter(m=>m.requestType===_b&&Vl(a,m.date)),u=[],c=o==null?void 0:o.matchUpId,d=ir(bi(n),pt(a)),p=bi(zN(d,t).toISOString());for(let m of l){let{requestId:h,startTime:f,endTime:g}=m;(n>f&&n<g||p>f&&p<g)&&(u.push({matchUpId:c,request:m,scheduleTime:n}),e[h]?(e[h].scheduleTimes.includes(n)||e[h].scheduleTimes.push(n),e[h].matchUpIds.includes(c)||e[h].matchUpIds.push(c)):e[h]={request:m,scheduleTimes:[n],matchUpIds:[c]})}return{conflicts:u}}function c1({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,matchUp:i,value:r}){let{matchUpType:n}=i,{individualParticipantIds:a}=ET(i),o=(t[i.matchUpId]||[]).filter(s=>!Rn(s,a)).flat();[...a,...o].forEach(s=>{if(Lb({individualParticipantProfiles:e,participantId:s}),!e[s].potentialCounted[i.drawId]){let l=e[s].counters;l[n]?l[n]+=r:r>0&&(l[n]=r),l[Go]?l[Go]+=r:r>0&&(l[Go]=r),o.includes(s)&&(e[s].potentialCounted[i.drawId]=!0)}})}function Bme({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,dateScheduledMatchUpIds:i,greatestAverageMinutes:r,dateScheduledMatchUps:n,matchUpNotBeforeTimes:a,matchUpScheduleTimes:o,matchUpDependencies:s,clearScheduleDates:l,scheduleDate:u,minutesMap:c,matchUps:d}){var f,g;let p=[];i||(n=d==null?void 0:d.filter(v=>{let y=v.schedule||{},I=v.matchUpStatus===Vt;return I&&p.push({tournamentId:v.tournamentId,matchUpId:v.matchUpId}),!I&&Mb({schedule:y})&&(!u||v.schedule.scheduledDate===u)}),i=n.map(Dr));let m=Array.isArray(l)?l.includes(u):l,h=m?[]:d.filter(({matchUpId:v})=>i.includes(v));for(let v of h){c1({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,value:1,matchUp:v});let y=(f=v.schedule)==null?void 0:f.scheduledTime;if(y){o[v.matchUpId]=y;let I=(g=c==null?void 0:c[v.matchUpId])==null?void 0:g.recoveryMinutes;jI({individualParticipantProfiles:e,matchUpPotentialParticipantIds:t,matchUpNotBeforeTimes:a,matchUpDependencies:s,averageMatchUpMinutes:r,recoveryMinutes:I,scheduleTime:y,matchUp:v})}}return{dateScheduledMatchUpIds:i,byeScheduledMatchUpDetails:p,dateScheduledMatchUps:n,clearDate:m}}function LD({defaultRecoveryMinutes:t=0,averageMatchUpMinutes:e=90,dateScheduledMatchUps:i,tournamentRecords:r,venueIds:n=[],periodLength:a,scheduleDate:o,matchUps:s}){if(typeof r!="object")return{error:ki};if(!wo(s)&&!Array.isArray(i))return{error:ju};a=a??MD({recoveryMinutes:t,averageMatchUpMinutes:e});let l=Object.assign({},...Object.values(r).map(d=>(d.events??[]).map(p=>{let{scheduleTiming:m}=qy({tournamentRecord:d,event:p});return{[p.eventId]:{event:p,scheduleTiming:m}}})).flat()),u={averageTimes:[{minutes:{default:e}}],recoveryTimes:[{minutes:{default:t}}]};i||(i=s==null?void 0:s.filter(d=>{let p=d.schedule;return Mb({schedule:p})&&(!o||d.schedule.scheduledDate===o)}));let c=i==null?void 0:i.filter(d=>(!n.length||n.includes(d.schedule.venueId))&&d.matchUpStatus!==Vt);return{bookings:c==null?void 0:c.map(({eventId:d,schedule:p,matchUpFormat:m})=>{let{event:h,scheduleTiming:f}=l[d],g=h==null?void 0:h.eventType,v={...f,defaultTiming:u,matchUpFormat:m},{averageMinutes:y,recoveryMinutes:I}=kT({timingDetails:v,eventType:g}),{courtId:b,venueId:S}=p,w=bi(p.scheduledTime),U=ia(w,y);return{recoveryMinutes:I,averageMinutes:y,periodLength:a,startTime:w,courtId:b,endTime:U,venueId:S}}).filter(Boolean),relevantMatchUps:c,dateScheduledMatchUps:i}}function Vme({calculateStartTimeFromCourts:t=!0,remainingScheduleTimes:e,defaultRecoveryMinutes:i,averageMatchUpMinutes:r,clearScheduleDates:n,tournamentRecords:a,tournamentRecord:o,periodLength:s,scheduleDate:l,startTime:u,venueIds:c,matchUps:d,endTime:p}){if(o&&!a&&(a={[o.tournamentId]:o}),typeof a!="object"||!Object.keys(a).length)return{error:ki};s=s??MD({recoveryMinutes:i,averageMatchUpMinutes:r});let{courts:m,venues:h}=Ku({dates:[l],ignoreDisabled:!0,tournamentRecords:a}),f=(m==null?void 0:m.filter(S=>!c||c.includes(S.venueId)))??[];u=u??Wf({courts:f,scheduleDate:l,startTime:!0}),p=p??Wf({courts:f,scheduleDate:l,endTime:!0});let{bookings:g,dateScheduledMatchUps:v}=LD({defaultRecoveryMinutes:i,averageMatchUpMinutes:r,tournamentRecords:a,scheduleDate:l,periodLength:s,venueIds:c,matchUps:d}),y={calculateStartTimeFromCourts:t,remainingScheduleTimes:e,averageMatchUpMinutes:r,clearScheduleDates:n,date:l,periodLength:s,startTime:u,bookings:g,endTime:p,courts:f},{scheduleTimes:I}=Vk(y),b=(c==null?void 0:c.length)===1&&c[0]||(h==null?void 0:h.length)===1&&h[0].venueId||void 0;return{dateScheduledMatchUpIds:v==null?void 0:v.map(Ta("matchUpId")),dateScheduledMatchUps:v,scheduleTimes:I,venueId:b}}function jme({scheduledRoundsDetails:t,greatestAverageMinutes:e,garmanSinglePass:i}){let r=[],n=[],a,o,s,l;for(let u of t.filter(Boolean))l||(l=u.hash),(u.hash===l||i)&&(n=n.concat(u.matchUpIds)),u.hash!==l&&!i&&(l=u.hash,r.push({averageMinutes:s,recoveryMinutes:o,roundPeriodLength:a,matchUpIds:n}),n=u.matchUpIds),s=i?e:u.averageMinutes,o=u.recoveryMinutes,a=u.roundPeriodLength;return n.length&&r.push({matchUpIds:n,roundPeriodLength:a,recoveryMinutes:o,averageMinutes:s}),{groupedRounds:r}}function IY({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,scheduleCompletedMatchUps:i,containedStructureIds:r,matchUpNotBeforeTimes:n,matchUpScheduleTimes:a,matchUpDependencies:o,clearScheduleDates:s,tournamentRecords:l,periodLength:u,scheduleDate:c,useGarman:d,matchUps:p,courts:m,venues:h}){var I;let f={},g=[],v=[],y=[];for(let b of h){let{rounds:S=[],venueId:w}=b,{scheduledRoundsDetails:U,greatestAverageMinutes:T,orderedMatchUpIds:D,minutesMap:P}=Eb({scheduleCompletedMatchUps:i,containedStructureIds:r,tournamentRecords:l,periodLength:u,matchUps:p,rounds:S});y.push(...D??[]);let{groupedRounds:E}=jme({scheduledRoundsDetails:U,greatestAverageMinutes:T,garmanSinglePass:!0}),R,N=[];d&&({scheduleTimes:N,dateScheduledMatchUpIds:R}=Vme({averageMatchUpMinutes:(I=E[0])==null?void 0:I.averageMinutes,scheduleDate:pt(c),venueIds:[b.venueId],clearScheduleDates:s,tournamentRecords:l,periodLength:u,matchUps:p}));let A=Bme({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,dateScheduledMatchUpIds:R,greatestAverageMinutes:T,matchUpNotBeforeTimes:n,matchUpScheduleTimes:a,matchUpDependencies:o,clearScheduleDates:s,scheduleDate:c,minutesMap:P,matchUps:p});({dateScheduledMatchUpIds:R}=A);let M=A,{byeScheduledMatchUpDetails:C,clearDate:O}=A;C!=null&&C.length&&v.push(...C);let{matchUpsToSchedule:k,matchUpMap:x}=fD({matchUpPotentialParticipantIds:t,scheduleCompletedMatchUps:i,dateScheduledMatchUpIds:R,matchUpNotBeforeTimes:n,matchUpScheduleTimes:a,orderedMatchUpIds:D,clearDate:O,matchUps:p}),F=m.filter($=>$.venueId===w);f[w]={previousRemainingScheduleTimes:[],courtsCount:F.length,greatestAverageMinutes:T,scheduledRoundsDetails:U,dateScheduledMatchUps:M,matchUpsToSchedule:k,scheduleTimes:N,groupedRounds:E,venueCourts:F,minutesMap:P,matchUpMap:x},s||g.push(...R)}return{allDateScheduledByeMatchUpDetails:v,allDateScheduledMatchUpIds:g,venueScheduledRoundDetails:f,allDateMatchUpIds:y}}function Gme(t,e){let i=kt(t.scheduleTime),r=kt(t.timeAfterRecovery),n=kt(e.scheduleTime),a=kt(e.timeAfterRecovery),o=i===n||r===a,s=i>n&&i<a,l=n>i&&n<r,u=r>n&&r<a,c=a>i&&a<r;return Ge({hasOverlap:o||s||u||l||c,startAisContained:s,endAisContained:u,startBisContained:l,endBisContained:c},!0)}function ox({individualParticipantProfiles:t,matchUpNotBeforeTimes:e,matchUpDependencies:i,scheduleTime:r,matchUp:n,details:a}){var p,m,h,f,g;let o=(((p=i==null?void 0:i[n.matchUpId])==null?void 0:p.participantIds)||[]).flat(),s=((h=(m=a==null?void 0:a.minutesMap)==null?void 0:m[n.matchUpId])==null?void 0:h.averageMinutes)||0,l=((g=(f=a==null?void 0:a.minutesMap)==null?void 0:f[n.matchUpId])==null?void 0:g.recoveryMinutes)||0,u=o.every(v=>{var S;Lb({individualParticipantProfiles:t,participantId:v});let y=t[v];if(!y.timeAfterRecovery)return!0;let I=bi((S=n==null?void 0:n.schedule)==null?void 0:S.endTime),b=I?ia(I,Qe(l)):ia(r,Qe(s)+Qe(l));return![...Object.keys(y.potentialBookings).filter(w=>w!==n.drawId).map(w=>y.potentialBookings[w]).flat(),...y.bookings].find(w=>Gme({scheduleTime:r,timeAfterRecovery:b},w).hasOverlap)}),c=e[n.matchUpId],d=(c?Oy(ir(c),ir(r),!1):0)>=0;return{enoughTime:u&&d}}function yY({autoSchedulingAudit:t,tournamentRecords:e}){var o;lt({topic:fu,payload:t});let i=s=>s?Object.values(s).reduce((l,u)=>l+u.length||0,0):0,r=((t==null?void 0:t.schedulingProfile)||[]).reduce((s,l)=>s+l.venues.reduce((u,c)=>u+c.rounds.length,0),0),n={scheduledDatesCount:(o=t.scheduledDates)==null?void 0:o.length,noTimeMatchUpIdsCount:i(t==null?void 0:t.noTimeMatchUpIds),scheduledMatchUpIdsCount:i(t==null?void 0:t.scheduledMatchUpIds),overLimitMatchUpIdsCount:i(t==null?void 0:t.overLimitMatchUpIds),requestConflictsCount:i(t==null?void 0:t.requestConflicts),profileRoundsCount:r},a={itemType:o1,itemValue:n};for(let s of Object.values(e)){let l=s.tournamentId;tT(fu)?lt({payload:{type:o1,tournamentId:l,detail:n},topic:fu}):Ub({tournamentRecord:s,timeItem:a})}}function sx({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,matchUpDailyLimits:i={},matchUp:r}){let{enteredIndividualParticipantIds:n}=ET(r),{matchUpId:a,matchUpType:o}=r,s=(r.roundPosition&&t[a]||[]).flat(),l=ct(n.concat(...s));return l.forEach(u=>{Lb({individualParticipantProfiles:e,participantId:u})}),{participantIdsAtLimit:l.filter(u=>{let c=e[u];if(c)return[o,Go].find(d=>{var h;let p=((h=c.counters)==null?void 0:h[d])||0,m=i[d]||0;return p&&m&&p>=m})}),relevantParticipantIds:l}}function GI({scheduleCompletedMatchUps:t=!1,scheduleByeMatchUps:e=!1,errorOnAnachronism:i=!1,checkChronology:r=!0,matchUpDependencies:n,removePriorValues:a,tournamentRecords:o,tournamentRecord:s,matchUpDetails:l,matchUpIds:u,schedule:c}){var g,v,y;if(!s)return{error:ge};if(!l&&(!u||!Array.isArray(u)))return{error:jm};if(!l&&(!c||typeof c!="object"))return{error:yH};let d,p=[],m=0;if(r&&!n){let I=us({tournamentRecords:o,tournamentRecord:s});n=I.matchUpDependencies,d=I.matchUps}d||(d=((g=Vr({tournamentRecord:s}))==null?void 0:g.matchUps)??[]);let h=d.reduce((I,b)=>{let{matchUpId:S,drawId:w,matchUpStatus:U}=b;return(e||U!==Vt)&&(t||!vr.includes(U))&&(I[w]?I[w].push(S):I[w]=[S]),I},{}),f=l==null?void 0:l.map(I=>I.matchUpId);for(let I of Object.keys(h)){let{drawDefinition:b}=Xc({tournamentRecord:s,drawId:I});if(!b)continue;let S=h[I].filter(U=>(u==null?void 0:u.includes(U))??(f==null?void 0:f.includes(U))),w=Sn({inContext:!1,drawDefinition:b}).matchUps;for(let U of S){let T=((v=l==null?void 0:l.find(P=>P.matchUpId===U))==null?void 0:v.schedule)||c,D=FD({schedule:T,matchUpDependencies:n,errorOnAnachronism:i,removePriorValues:a,inContextMatchUps:d,tournamentRecords:o,tournamentRecord:s,checkChronology:r,drawDefinition:b,drawMatchUps:w,matchUpId:U});if((y=D==null?void 0:D.warnings)!=null&&y.length&&p.push(...D.warnings),D!=null&&D.success&&(m+=1),D.error)return D}}return p.length?{...J,scheduled:m,warnings:p}:{...J,scheduled:m}}function $b(t){var h;let{scheduleCompletedMatchUps:e=!1,scheduleByeMatchUps:i=!1,errorOnAnachronism:r,matchUpContextIds:n,removePriorValues:a,tournamentRecords:o,checkChronology:s,matchUpDetails:l,schedule:u}=t;if(t.matchUpIds&&!n)return GI(t);let c=ze(t,[{[pn]:!0},{[kf]:{matchUpContextIds:!1,matchUpDetails:!1},[_a]:oe,[Xn]:un}]);if(c.error)return c;if((!l||n)&&!u)return{error:Xe,info:"schedule is required"};let d=[],p=0,{matchUpDependencies:m}=us({tournamentRecords:o});for(let f of Object.values(o)){let{tournamentId:g}=f,v=n==null?void 0:n.filter(I=>I.tournamentId===g).map(Dr),y=l==null?void 0:l.filter(I=>(I==null?void 0:I.tournamentId)===g);if(v!=null&&v.length||y!=null&&y.length){let I=GI({matchUpDetails:y,scheduleCompletedMatchUps:e,scheduleByeMatchUps:i,matchUpDependencies:m,errorOnAnachronism:r,removePriorValues:a,tournamentRecords:o,tournamentRecord:f,checkChronology:s,matchUpIds:v,schedule:u});if((h=I.warnings)!=null&&h.length&&d.push(...I.warnings),I.scheduled&&(p+=I.scheduled),I.error)return I}}return d.length?{...J,scheduled:p,warnings:d}:{...J,scheduled:p}}function Hme({schedulingProfileModifications:t,checkPotentialRequestConflicts:e,scheduleCompletedMatchUps:i,schedulingProfileIssues:r,dateSchedulingProfiles:n,containedStructureIds:a,matchUpDependencies:o,matchUpDailyLimits:s,clearScheduleDates:l,tournamentRecords:u,schedulingProfile:c,personRequests:d,periodLength:p,matchUps:m,courts:h,dryRun:f}){var R,N,A,M,C,O,k;let g={},v={},y={},I={},b={},S={},w={},U={},T={},D={};for(let x of n){let F=pt(x==null?void 0:x.scheduleDate),$=(x==null?void 0:x.venues)||[],_={},L={},B=(K,H)=>{K.forEach(Z=>{let X=L[Z].counters;X[H]?X[H]+=1:X[H]=1,X[Go]?X[Go]+=1:X[Go]=1})};y[F]={},I[F]={},g[F]={},v[F]={},w[F]=[],U[F]=[],T[F]=[],D[F]=[];let V={};m.forEach(K=>{var H;(H=K.schedule)!=null&&H.scheduledDate&&Vl(F,pt(K.schedule.scheduledDate))&&zf({matchUpPotentialParticipantIds:_,matchUpNotBeforeTimes:V,matchUp:K})});let{allDateScheduledByeMatchUpDetails:G,venueScheduledRoundDetails:j,allDateMatchUpIds:z}=IY({matchUpPotentialParticipantIds:_,individualParticipantProfiles:L,scheduleCompletedMatchUps:i,containedStructureIds:a,matchUpNotBeforeTimes:V,matchUpScheduleTimes:S,matchUpDependencies:o,clearScheduleDates:l,tournamentRecords:u,useGarman:!0,periodLength:p,scheduleDate:F,matchUps:m,courts:h,venues:$}),W=10,q=0,Y,re=10;for(;!Y;){for(let{venueId:K}of $){let H=0,Z=j[K];for(;Z.courtsCount&&((R=Z.scheduleTimes)!=null&&R.length)&&((N=Z.matchUpsToSchedule)!=null&&N.length)&&H<=Z.courtsCount;){let{scheduleTime:X,attempts:ie=0}=Z.scheduleTimes.shift(),ae=Z.matchUpsToSchedule.find(le=>{var Fe,De;let{matchUpId:ne,matchUpType:de}=le,{participantIdsAtLimit:ye,relevantParticipantIds:ce}=sx({matchUpPotentialParticipantIds:_,individualParticipantProfiles:L,matchUpDailyLimits:s,matchUp:le});if(ye.length)return U[F].includes(ne)||U[F].push(ne),!1;let{scheduledDependent:ke}=vY({matchUpScheduleTimes:S,matchUpDependencies:o,scheduleTime:X,matchUpId:ne,details:Z});if(ke)return!1;let{dependenciesScheduled:Pe,remainingDependencies:it}=nx({matchUpScheduleTimes:S,matchUpDependencies:o,allDateMatchUpIds:z,matchUp:le});if(!Pe)return I[F][ne]||(I[F][ne]=[]),I[F][ne].push({scheduleTime:X,remainingDependencies:it}),!1;let{enoughTime:It}=ox({individualParticipantProfiles:L,matchUpNotBeforeTimes:V,matchUpDependencies:o,scheduleTime:X,details:Z,matchUp:le});if(!It)return y[F][ne]||(y[F][ne]=[]),y[F][ne].push({scheduleTime:X}),!1;let me=Z.greatestAverageMinutes,{conflicts:fe}=ax({potentials:e,averageMatchUpMinutes:me,requestConflicts:D,personRequests:d,scheduleTime:X,scheduleDate:F,matchUp:le});if(fe!=null&&fe.length)return b[F]||(b[F]=[]),b[F].push(...fe),!1;B(ce,de);let pe=(De=(Fe=Z.minutesMap)==null?void 0:Fe[ne])==null?void 0:De.recoveryMinutes;return jI({matchUpPotentialParticipantIds:_,individualParticipantProfiles:L,matchUpNotBeforeTimes:V,averageMatchUpMinutes:me,matchUpDependencies:o,recoveryMinutes:pe,scheduleTime:X,matchUp:le}),S[ne]=X,!0});Z.matchUpsToSchedule=Z.matchUpsToSchedule.filter(({matchUpId:le})=>le!==(ae==null?void 0:ae.matchUpId)),ae?H+=1:(v[F][K]||(v[F][K]=[]),v[F][K].push({scheduleTime:X,attempts:ie+1}))}(A=Z.matchUpsToSchedule)!=null&&A.length&&(v[F][K]=(M=v[F][K])==null?void 0:M.filter(X=>{let ie=X.attempts<W;return ie&&Z.scheduleTimes.push(X),!ie})),(!((C=Z.scheduleTimes)!=null&&C.length)||!((O=Z.matchUpsToSchedule)!=null&&O.length))&&(Z.complete=!0)}q+=1,Y=$.every(({venueId:K})=>j[K].complete)||q===re}for(let{venueId:K}of $){let H=j[K].matchUpMap;Object.keys(H).forEach(Z=>{let X=u[Z];X&&Object.keys(H[Z]).forEach(ie=>{let{drawDefinition:ae}=Xc({tournamentRecord:X,drawId:ie});ae&&H[Z][ie].forEach(({matchUpId:le})=>{let ne=S[le];if(ne){let de=ne.split(":").map(no).join(":"),ye=`${pt(F)}T${de}`;f?w[F].push(le):(Jc({drawDefinition:ae,scheduledTime:ye,matchUpId:le}).success&&w[F].push(le),K&&Zg({tournamentRecord:X,drawDefinition:ae,matchUpId:le,venueId:K}))}})})}),T[F]=j[K].matchUpsToSchedule.map(Dr),g[F][K]=j[K].scheduleTimes.sort((Z,X)=>kt(Z.scheduleTime)-kt(X.scheduleTime))}!f&&(G!=null&&G.length)&&$b({matchUpDetails:G,scheduleByeMatchUps:!0,removePriorValues:!0,tournamentRecords:u,schedule:{scheduledDate:"",scheduledTime:"",courtOrder:"",courtId:"",venueId:""}});for(let K of x.venues)for(let H of K.rounds){let Z=(((k=H.matchUps)==null?void 0:k.map(({matchUpId:ie})=>ie))||[]).filter(ie=>w[F].includes(ie));H.canScheduledMatchUpIds=Z;let X=Math.round(Z.length/H.matchUpsCount*1e4)/100;(X===1/0||isNaN(X))&&(X=0),H.possibleToSchedulePct=X,H.matchUpsCount===Z.length&&(H.possibleToSchedule=!0)}}let P=n.map(({scheduleDate:x})=>x),E={timeStamp:Date.now(),overLimitMatchUpIds:U,scheduledMatchUpIds:w,schedulingProfile:c,noTimeMatchUpIds:T,requestConflicts:D,scheduledDates:P};return yY({tournamentRecords:u,autoSchedulingAudit:E}),{...J,schedulingProfileModifications:t,schedulingProfileIssues:r,scheduleTimesRemaining:g,dateSchedulingProfiles:n,skippedScheduleTimes:v,recoveryTimeDeferredMatchUpIds:y,dependencyDeferredMatchUpIds:I,matchUpScheduleTimes:S,overLimitMatchUpIds:U,scheduledMatchUpIds:w,noTimeMatchUpIds:T,requestConflicts:D,scheduledDates:P}}function IV({averageMinutes:t,startTime:e,endTime:i,court:r,date:n}){if(!Array.isArray(r.dateAvailability))return{error:Xe,stack:"getEarliestCourtTime"};let a=Wf({scheduleDate:n,courts:[r],startTime:!0}),o=Wf({scheduleDate:n,courts:[r],endTime:!0});e=e||a,i=i||o;let s=kb({court:r,date:n}),{timeSlots:l}=Jg({courtDate:s}),u=ir(e),c=ir(i);return{earliestCourtTime:l==null?void 0:l.reduce((d,p)=>{let m=ir(p.startTime),h=ir(p.endTime);if(m>c||h<u)return d;let f=u>m?u:m;if(Oy(f,h)>=t){let g=bi(f.toISOString());(!d||g<d)&&(d=g)}return d},void 0),courtStartTime:a,courtEndTime:o}}function zme({schedulingProfileModifications:t,checkPotentialRequestConflicts:e,scheduleCompletedMatchUps:i,schedulingProfileIssues:r,dateSchedulingProfiles:n,containedStructureIds:a,matchUpDependencies:o,matchUpDailyLimits:s,clearScheduleDates:l,tournamentRecords:u,periodLength:c=30,schedulingProfile:d,personRequests:p,matchUps:m=[],courts:h,dryRun:f}){var E,R;let g={},v={},y={},I={},b={},S={},w={},U={},T={};for(let N of n??[]){let A=pt(N==null?void 0:N.scheduleDate),M=(N==null?void 0:N.venues)||[],C={},O={},k=(K,H)=>{K.forEach(Z=>{let X=O[Z].counters;X[H]?X[H]+=1:X[H]=1,X[Go]?X[Go]+=1:X[Go]=1})};g[A]={},v[A]={},S[A]=[],w[A]=[],U[A]=[],T[A]=[];let x={};m==null||m.forEach(K=>{var H;(H=K.schedule)!=null&&H.scheduledDate&&Vl(A,pt(K.schedule.scheduledDate))&&zf({matchUpPotentialParticipantIds:C,matchUpNotBeforeTimes:x,matchUp:K})});let{allDateScheduledByeMatchUpDetails:F,allDateScheduledMatchUpIds:$,venueScheduledRoundDetails:_,allDateMatchUpIds:L}=IY({matchUpPotentialParticipantIds:C,individualParticipantProfiles:O,scheduleCompletedMatchUps:i,containedStructureIds:a,matchUpNotBeforeTimes:x,matchUpScheduleTimes:b,matchUpDependencies:o,clearScheduleDates:l,tournamentRecords:u,periodLength:c,scheduleDate:A,matchUps:m,courts:h,venues:M}),B=m==null?void 0:m.filter(({matchUpId:K})=>$.includes(K)),{bookings:V}=LD({dateScheduledMatchUps:B,tournamentRecords:u,scheduleDate:A,periodLength:c}),{virtualCourts:G}=CD({scheduleDate:A,periodLength:c,bookings:V,courts:h}),j=G==null?void 0:G.reduce((K,H)=>{let{earliestCourtTime:Z,courtEndTime:X}=IV({date:A,averageMinutes:0,court:H});return(!K.startTime||ir(Z)<ir(K.startTime))&&(K.startTime=Z),(!K.endTime||ir(X)>ir(K.endTime))&&(K.endTime=X),K},{}),z=j.startTime,W=({courtId:K,booking:H})=>{var Z;return(Z=G==null?void 0:G.find(X=>X.courtId===K))==null?void 0:Z.dateAvailability[0].bookings.push(H)},q=10,Y=0,re;for(;!re;){for(let{venueId:K}of M){let H=_[K],Z=H.matchUpsToSchedule.length,X=[],ie=[],ae,le=0;for(;!ae;){for(let ne of H.matchUpsToSchedule){if(ie.length===H.courtsCount||X.length===H.courtsCount){ae=!0;break}let{matchUpId:de,matchUpType:ye}=ne,{participantIdsAtLimit:ce,relevantParticipantIds:ke}=sx({matchUpPotentialParticipantIds:C,individualParticipantProfiles:O,matchUpDailyLimits:s,matchUp:ne});if(ce.length){w[A].includes(de)||w[A].push(de);continue}let{dependenciesScheduled:Pe,remainingDependencies:it}=nx({matchUpScheduleTimes:b,matchUpDependencies:o,allDateMatchUpIds:L,matchUp:ne});if(!Pe){v[A][de]||(v[A][de]=[]),v[A][de].push({remainingDependencies:it});continue}let It=[],me=G==null?void 0:G.reduce((fe,pe)=>{var xe,Ee,we,Ue;if(ie.includes(pe.courtId))return fe;let{earliestCourtTime:Fe}=IV({averageMinutes:H.greatestAverageMinutes,startTime:z,date:A,court:pe});if(fe.scheduleTime&&kt(Fe)>=kt(fe.scheduleTime))return fe;let{scheduledDependent:De}=vY({matchUpScheduleTimes:b,matchUpDependencies:o,scheduleTime:Fe,matchUpId:de,details:H});if(De)return fe;let{enoughTime:je}=ox({individualParticipantProfiles:O,matchUpNotBeforeTimes:x,matchUpDependencies:o,scheduleTime:Fe,details:H,matchUp:ne});if(!je)return g[A][de]||(g[A][de]=[]),g[A][de].includes(Fe)||g[A][de].push(Fe),fe;let ue=((Ee=(xe=H.minutesMap)==null?void 0:xe[de])==null?void 0:Ee.averageMinutes)||H.greatestAverageMinutes,{conflicts:he}=ax({potentials:e,averageMatchUpMinutes:ue,requestConflicts:T,personRequests:p,scheduleTime:Fe,scheduleDate:A,matchUp:ne});if(he!=null&&he.length)return It.push(...he),!1;k(ke,ye);let Re=(Ue=(we=H.minutesMap)==null?void 0:we[de])==null?void 0:Ue.recoveryMinutes;return jI({matchUpPotentialParticipantIds:C,individualParticipantProfiles:O,matchUpNotBeforeTimes:x,averageMatchUpMinutes:ue,matchUpDependencies:o,recoveryMinutes:Re,scheduleTime:Fe,matchUp:ne}),(!fe.scheduleTime||kt(Fe)<kt(fe.scheduleTime))&&(fe.averageMatchUpMinutes=ue,fe.recoveryMinutes=Re,fe.scheduleTime=Fe,fe.courtName=pe.courtName,fe.courtId=pe.courtId),fe},{});if(me.scheduleTime){let{averageMatchUpMinutes:fe,recoveryMinutes:pe,scheduleTime:Fe,courtId:De}=me;b[de]=Fe,I[de]=De,X.push(de),ie.push(De);let je=Fe,ue=ia(je,fe);W({courtId:De,booking:{averageMatchUpMinutes:fe,recoveryMinutes:pe,periodLength:c,matchUpId:de,startTime:je,courtId:De,endTime:ue,venueId:K}}),H.matchUpsToSchedule=H.matchUpsToSchedule.filter(he=>he.matchUpId!==de)}else It!=null&&It.length&&(y[A]||(y[A]=[]),y[A].push(...It))}(ie.length===H.courtsCount||X.length===H.courtsCount||!H.matchUpsToSchedule.length)&&(ae=!0),H.matchUpsToSchedule.length&&X<H.courtsCount&&(ir(z)<ir(j.endTime)?z=ia(z,c):(ae=!0,H.complete=!0)),le+=1,!ae&&le>=Z&&(ae=!0)}(E=H.matchUpsToSchedule)!=null&&E.length||(H.complete=!0)}Y+=1,re=M.every(({venueId:K})=>_[K].complete)||Y===q}for(let{venueId:K}of M){let H=_[K].matchUpMap;Object.keys(H).forEach(Z=>{let X=u[Z];X&&Object.keys(H[Z]).forEach(ie=>{let{drawDefinition:ae}=Xc({tournamentRecord:X,drawId:ie});ae&&H[Z][ie].forEach(({matchUpId:le})=>{let ne=b[le],de=I[le];if(ne){let ye=ne.split(":").map(no).join(":"),ce=`${pt(A)}T${ye}`;f||(Jc({drawDefinition:ae,scheduledTime:ce,matchUpId:le}),fh({courtDayDate:A,tournamentRecords:u,tournamentRecord:X,drawDefinition:ae,matchUpId:le,courtId:de})),S[A].push(le)}})})}),U[A]=_[K].matchUpsToSchedule.map(Dr)}!f&&(F!=null&&F.length)&&$b({matchUpDetails:F,scheduleByeMatchUps:!0,removePriorValues:!0,tournamentRecords:u,schedule:{scheduledDate:"",scheduledTime:"",courtOrder:"",courtId:"",venueId:""}});for(let K of N.venues)for(let H of K.rounds){let Z=(R=(H.matchUps??[]).map(({matchUpId:ie})=>ie))==null?void 0:R.filter(ie=>S[A].includes(ie));H.canScheduledMatchUpIds=Z;let X=Math.round(((Z==null?void 0:Z.length)||0)/H.matchUpsCount*1e4)/100;(X===1/0||isNaN(X))&&(X=void 0),H.possibleToSchedulePct=X,H.matchUpsCount===(Z==null?void 0:Z.length)&&(H.possibleToSchedule=!0)}}let D=(n??[]).map(({scheduleDate:N})=>N),P={timeStamp:Date.now(),overLimitMatchUpIds:w,scheduledMatchUpIds:S,schedulingProfile:d,noTimeMatchUpIds:U,requestConflicts:T,scheduledDates:D};return yY({tournamentRecords:u,autoSchedulingAudit:P}),{...J,schedulingProfileModifications:t,schedulingProfileIssues:r,dateSchedulingProfiles:n,recoveryTimeDeferredMatchUpIds:g,dependencyDeferredMatchUpIds:v,matchUpScheduleTimes:b,overLimitMatchUpIds:w,scheduledMatchUpIds:S,noTimeMatchUpIds:U,requestConflicts:T,scheduledDates:D}}function _D(t){let{scheduleAttributes:e=["scheduledDate","scheduledTime","courtOrder"],ignoreMatchUpStatuses:i=vr,scheduledDates:r,venueIds:n}=t,a=Io(t),o=Nt(a)?Object.values(a).map(({tournamentId:l})=>l).filter(Boolean):[];if(!(o!=null&&o.length))return{error:ki};let s=0;for(let l of o){let u=a[l],c=Wme({ignoreMatchUpStatuses:i,scheduleAttributes:e,tournamentRecord:u,scheduledDates:r,venueIds:n});if(c.error)return c;s+=c.clearedScheduleCount??0}return{...J,clearedScheduleCount:s}}function Wme({scheduleAttributes:t=["scheduledDate","scheduledTime","courtOrder"],ignoreMatchUpStatuses:e=vr,tournamentRecord:i,scheduledDates:r,venueIds:n=[]}){if(typeof i!="object")return{error:ge};if(!Array.isArray(e)||!Array.isArray(n))return{error:oe};n.length&&t.push("venueId");let a=Vr({matchUpFilters:{scheduledDates:r},tournamentRecord:i}).matchUps??[],o={};a.forEach(({matchUpStatus:u,schedule:c,drawId:d,matchUpId:p})=>{(!u||!e.includes(u))&&Mb({schedule:c,scheduleAttributes:t})&&(!(n!=null&&n.length)||n.includes(c.venueId))&&(o[d]||(o[d]=[]),o[d].push(p))});let s=i.tournamentId,l=0;for(let u in o){let{event:c,drawDefinition:d}=Wn({tournamentRecord:i,drawId:u}),p=Sn({drawDefinition:d,matchUpFilters:{matchUpIds:o[u]}}).matchUps??[];for(let m of p){let h=!1;m.timeItems=(m.timeItems??[]).filter(f=>{let g=(f==null?void 0:f.itemType)&&![zl,Rc,eh,AT,th,ih].includes(f==null?void 0:f.itemType);return g||(h=!0),g}),h&&(Rt({context:"clear schedules",eventId:c==null?void 0:c.eventId,drawDefinition:d,tournamentId:s,matchUp:m}),l+=1)}}return{...J,clearedScheduleCount:l}}function $D(t){let{checkPotentialRequestConflicts:e=!0,scheduleCompletedMatchUps:i,clearScheduleDates:r,scheduleDates:n=[],tournamentRecords:a,periodLength:o,useGarman:s,dryRun:l,pro:u}=t,c=ze(t,[{[pn]:!0},{[Kr]:D=>!D||Array.isArray(D)&&D.every(Ia),[Bz]:!1,[Xn]:un}]);if(c.error)return c;let d=Xu({tournamentRecords:a});if(d.error)return d;if(!d.schedulingProfile.length)return{...J};let{modifications:p,issues:m=[],schedulingProfile:h=[]}=d,f=Object.assign({},...Object.values(a).map(D=>Lg({tournamentRecord:D}).containedStructures)),g=n.map(D=>{if(Ia(D))return pt(D)}).filter(Boolean),v=h.map(D=>D.scheduleDate).map(D=>Ia(D)&&pt(D)).filter(D=>D&&(!n.length||g.includes(D)));if(!v.length)return{error:KG};if(r&&!l){let D=Array.isArray(r)?r:[];_D({tournamentRecords:a,scheduledDates:D})}let y=Ku({ignoreDisabled:!1,tournamentRecords:a}).courts,{matchUps:I}=Es({matchUpFilters:{matchUpTypes:[ti,Zt]},afterRecoveryTimes:!0,nextMatchUps:!0,tournamentRecords:a}),{matchUpDependencies:b}=us({includeParticipantDependencies:!0,tournamentRecords:a,matchUps:I}),{matchUpDailyLimits:S}=TD({tournamentRecords:a}),{personRequests:w}=wp({requestType:_b,tournamentRecords:a}),U=h.filter(D=>{let P=pt(D==null?void 0:D.scheduleDate);return v.includes(P)}).sort((D,P)=>new Date(D.scheduleDate).getTime()-new Date(P.scheduleDate).getTime()),T={schedulingProfileModifications:p,checkPotentialRequestConflicts:e,scheduleCompletedMatchUps:i,schedulingProfileIssues:m,dateSchedulingProfiles:U,containedStructureIds:f,matchUpDependencies:b,matchUpDailyLimits:S,clearScheduleDates:r,tournamentRecords:a,schedulingProfile:h,personRequests:w,periodLength:o,useGarman:s,matchUps:I,dryRun:l,courts:y};return u?zme(T):Hme(T)}function BD(t){let{tournamentRecord:e,tournamentRecords:i,activeTournamentId:r,...n}=t||{};return n.tournamentId||(n.tournamentId=Gt()),n.startDate&&!Nd(n.startDate)&&!dS.test(n.startDate)?{error:Ar}:n.endDate&&!Nd(n.endDate)&&!dS.test(n.endDate)?{error:Ar}:(n.extensions&&(n.extensions=n.extensions.filter(il)),{...n})}function lx({addParticipants:t=!0,participantAttribute:e,tournamentRecord:i,personAttribute:r,teamNames:n,accessor:a,uuids:o}){var h,f;if(!i)return{error:ge};let s={},l=(i.participants??[]).filter(({participantType:g,participantRole:v})=>g===St&&v===Qr),u=0;for(let g of l){let v=a&&((h=Jp({element:g,accessor:a}))==null?void 0:h.value)||r&&((f=g.person)==null?void 0:f[r])||e&&g[e];if(v){if(!Object.keys(s).includes(v)){s[v]={participantName:(n==null?void 0:n[u])??v,participantId:(o==null?void 0:o.pop())??Gt(),individualParticipantIds:[],participantRole:Qr,participantType:Kt};let y={value:r??e,name:MC};Lt({element:s[v],extension:y}),u+=1}s[v].individualParticipantIds.push(g.participantId)}}let c=Object.keys(s),d=(i.participants??[]).map(g=>{if(g.participantType!==Kt||g.participantRole!==Qr)return;let{extension:v}=gt({name:MC,element:g}),y=v==null?void 0:v.value;if(c.includes(y))return g.participantId}).filter(Boolean),p=0,m=[];return Object.keys(s).forEach(g=>{let v=s[g],{participantId:y}=v;d.includes(y)||(i.participants||(i.participants=[]),t&&i.participants.push(v),m.push(v),p++)}),t&&p?(lt({payload:{tournamentId:i.tournamentId,participants:m},topic:Tc}),{...J,participantsAdded:p}):m.length?{...J,newParticipants:m}:{error:Lne}}var qme=[{AA:"Annexia"},{BA:"Bacteria"},{BO:"Borduria"},{BM:"Bensalem"},{BS:"Basenji"},{BI:"Balnibarbi"},{BV:"Bartovia"},{BZ:"Berzerkistan"},{CA:"Caldonia"},{CC:"Concordia"},{CH:"Chula"},{DA:"Deltora"},{DW:"Discworld"},{EA:"Eastasia"},{EP:"Ecotopia"},{ER:"Erewhon"},{FA:"Freedonia"},{FN:"Florin"},{FG:"Fogg"},{FK:"Fourecks"},{GA:"Genovia"},{GL:"Gilead"},{GD:"Gilead"},{GL:"Gondal"},{GO:"Gondor"},{GR:"Gruzinia"},{GT:"Goritania"},{GU:"Guilder"},{HA:"Heldscalla"},{HO:"Hidalgo"},{IL:"Illyria"},{KA:"Kinakuta"},{KG:"Kangan"},{KN:"Kreplachistan"},{KS:"Kallipolis"},{LH:"Lugash"},{LI:"Listenbourg"},{LT:"Lilliput"},{LU:"Luggnagg"},{LV:"Lichtenslava"},{MR:"Moher"},{NA:"Narnia"},{NV:"Novaria"},{OA:"Oceania"},{OS:"Orsinia"},{OV:"Octavia"},{PA:"Palombia"},{PG:"Penguina"},{QA:"Qasha"},{PM:"Panem"},{SA:"Solymbria"},{SD:"Syldavia"},{SG:"San Glucose"},{SL:"San Lorenzo"},{SR:"Sontar"},{SY:"Sylvania"},{TF:"Tralfamadore"},{TH:"Themyscira"},{UA:"Utopia"},{VA:"Vespugia"},{WA:"Wakanda"},{WX:"Wessex"},{ZA:"Zamunda"},{ZK:"Zubrowka"}],Yme=["Amber","Ansul","Atlantis","Braavos","Busytown","Castle Rock","Centralia","Coober Pedy","Chefchaouen","Chronopolis","Damanhur","Diaspar","Dictionopolis","Diomira","El Dorado","Elista","Ephesus","Gotham","Hadleyburg","Hallstatt","Hierusalem","Ilium","Inverness","Kowloon","Laputa","Longyearbyen","Lys","Matmata","Maycomb","Metropolis","Miyake-jima","Monowi","Nagoro","Navarre","New New York","Nimbin","Pemberley","Pseudopolis","Rivendell","Roswell","Shangri-La","Springfield","Supilinn","Thneedville","Trantor","Wobegon","Yonwood","Xanadu","Xylar","Zion"];function bY({count:t=1,participantsCount:e=32}={}){let i=wn(Yme),r=i.slice(0,t);return{cities:Se(0,e).map(n=>n<Math.min(t,i.length)?r[n]:pa(r))}}function wY({count:t=1,participantsCount:e=32}={}){let i=wn(qme),r=i.slice(0,t).map(n=>Object.keys(n)).flat();return{states:Se(0,e).map(n=>n<Math.min(t,i.length)?r[n]:pa(r))}}function UY({count:t=1,participantsCount:e=32}={}){let i=Se(0,t).map(()=>Se(0,5).map(()=>to(0,9)).join(""));return{postalCodes:Se(0,e).map(r=>r<t?i[r]:pa(i))}}function VS({idPrefix:t,participantType:e,index:i,uuids:r}){let n=Ti(e)?e[0]:"X";return t?`${t}-${n}-${i}`:(r==null?void 0:r.pop())||Gt()}function SY(t){let{cities:e,states:i,postalCodes:r,nationalityCode:n,participantIndex:a}=t;return{postalCode:r==null?void 0:r[a],state:i==null?void 0:i[a],city:e==null?void 0:e[a],countryCode:n}}var Kme={lastNames:["Abbey","Ahern","Ampleforth","Ananiadis","Andelic","Assange","Atreides","Austen","Bach","Banks","Barrington","Batty","Bauers","Beals","Beer","Bennett","Berry","Bonaparte","Brewer","Brockovich","Bukowski","Cassidy","Catton","Calvino","Carlin","Carson","Chip","Constant","Crane","Crowne","Cummings","Curie","Dallas","Diamond","Deckard","Drazic","Dunbar","Earhart","Eisenstein","Eldritch","Elliot","Ellul","Escher","Eyre","Faulkner","Fulcher","Fukuoka","Godel","Goldstein","Greer","Hedges","Herbert","Holmgren","Humperdinck","Huxley","Illich","Jeffers","Jensen","Jevons","Johnson","Johnstone","Jovovich","Kingsnorth","Langer","Fernwright","Fuller","Le Guin","Lem","Lovelace","Mander","McLuhan","Midgely","Mond","Montoya","Moore","Murry","Nagle","Nearing","Ogden","Ophuls","Parks","Paz","Peet","Perfect","Pendejo","Pevensie","Postman","Ripley","Rodda","Rumfoord","Runciter","Rugen","Sale","Schumacher","Shaftoe","Shelley","Shepard","Smith","Stratton","Stewart","Swift","Tillich","Turing","Tyrell","Twain","Yeats","Veblen","Yates","Vonnegut","Waterhouse","Watson","Wolin","Wirt","Waschuk","Wormwood"],firstFemale:["Ada","Amelia","Amelie","America","Anne","Antonia","Aravis","Astrid","Beatrice","Brienne","Buttercup","Caitlin","Cimorene","Cordelia","Desdemona","Ellen","Elizabeth","Emily","Emmie","Erin","Eva","Evelyn","Heather","Helen","Hermia","Hypatia","Imogen","Jane","Jasmine","Juliana","Juliet","Katniss","Leeloo","Lenina","Lilith","Linda","Lizzie","Louise","Lucy","Marie","Mary","Martha","Matilda","Milla","Miranda","Meg","Melba","Nicole","Ola","Portia","Pris","Rachael","Rachel","Rebecca","River","Rosa","Rosalind","Scout","Sharn","Susanne","Titania","Uhura","Ursula","Valentina","Viola","Virginia","Xena","Zoe"],firstMale:["Alan","Aldous","August","Axel","Barda","Barry","Bill","Bruce","Charles","Chris","Constantine","Darwin","David","Derrick","Edward","Emmanuel","Ernst","Estlin","Fezzik","Filby","Frank","Frito","George","Glen","Helmholtz","Inigo","Italo","Ivan","Jacques","James","Jared","Jerry","Joe","Johann","Julian","John Michael","Jonathan","Korben","Kirkpatrick","Kurt","Lief","Malachi","Mark","Marhsall","Masanobu","Maurits","Michael","Mustapha","Neil","Nikola","Octavio","Palmer","Paul","Pierre","Robinson","Rick","Rincewind","Roy","Shannon","Sheldon","Stafford","Stanislaw","Stanley","Syme","Thorstein","Thomas","Tyrone","Vizzini","Walton","Walker","Warren","Wendell","Westley","William","Winston","Zoran"]};function SE(t){let{count:e=100,sex:i}=t||{};if(!e||i&&![Jt,pi].includes(i))return{personData:[],error:oe};let r=Math.ceil(e*1.3),{lastNames:n,firstFemale:a,firstMale:o}=Kme,s=Xp.map(({iso:f})=>f).filter(Boolean),l=Math.ceil(r/n.length),u=Math.ceil(r/a.length),c=Math.ceil(r/o.length),d=Se(0,l).flatMap(()=>{let f=Me(n,!1,!0);return Se(0,n.length).map(()=>fa(f))}),p=Se(0,u).flatMap(()=>{let f=Me(a,!1,!0);return Se(0,a.length).map(()=>fa(f))}),m=Se(0,c).flatMap(()=>{let f=Me(o,!1,!0);return Se(0,o.length).map(()=>fa(f))}),h={};for(let f=0;f<r;f++){let g=d.pop(),v=i||pa([Jt,pi]),y=v===Jt?m.pop():p.pop(),I=pa(s);h[`${y}${g}`]={nationalityCode:I,sex:v,firstName:y,lastName:g}}return{personData:Object.values(h).slice(0,e)}}function TY(t){let e=(t==null?void 0:t.count)||1,{personExtensions:i,consideredDate:r,isMock:n=!0,gendersCount:a,personData:o,category:s,sex:l}=t||{};if(isNaN(e))return{error:oe};let u=(a==null?void 0:a[Jt])||l===Jt&&e||0,c=(a==null?void 0:a[pi])||l===pi&&e||0;e=Math.max(e,u+c);let d=e-(u+c),p=u&&SE({count:u,sex:Jt}).personData||[],m=c&&SE({count:c,sex:pi}).personData||[],h=[...p,...m,...d&&SE({count:d}).personData||[]],f=h.filter(T=>!l||u&&c||T.sex===l),g=[];if(Array.isArray(o)){let T=o.filter(D=>typeof D.firstName!="string"||typeof D.lastName!="string"||D.sex&&![Jt,pi].includes(D.sex)||D.nationalityCode&&(typeof D.nationalityCode!="string"||D.nationalityCode.length>3||!Xp.find(({iso:P,ioc:E})=>[P,E].includes(D.nationalityCode)))?!1:(D.nationalityCode&&g.push(D.nationalityCode),!0));if(T.length)f=T;else return{error:oe}}let v=o?f:wn(f);if(v.length<e){let{maleFirstNames:T,maleLastNames:D,femaleFirstNames:P,femaleLastNames:E,nationalityCodes:R}=h.reduce((N,A)=>{let{firstName:M,lastName:C,nationalityCode:O}=A;return A.sex===Jt?(N.maleFirstNames.includes(M)||N.maleFirstNames.push(M),N.maleLastNames.includes(C)||N.maleLastNames.push(C)):(N.femaleFirstNames.includes(M)||N.femaleFirstNames.push(M),N.femaleLastNames.includes(C)||N.femaleLastNames.push(C)),N.nationalityCodes.includes(O)||N.nationalityCodes.push(O),N},{maleFirstNames:[],maleLastNames:[],femaleFirstNames:[],femaleLastNames:[],nationalityCodes:[]});Se(0,e-v.length).forEach(()=>{let N=l||pa([Jt,pi]),A=pa(R),M=pa(N===Jt?T:P),C=pa(N===Jt?D:E),O={firstName:M,lastName:C,sex:N,nationalityCode:A};v.push(O)})}let{ageMinDate:y,ageMaxDate:I}=vm({consideredDate:r,category:s}),b=Qe((y==null?void 0:y.slice(0,4))||0)||Qe((I==null?void 0:I.slice(0,4))||0)-3,S=Qe((I==null?void 0:I.slice(0,4))||0)||Qe((y==null?void 0:y.slice(0,4))||0)+3,w=(y||I)&&[b,S],U=v.slice(0,e).map((T,D)=>{let[P,E]=w||[],R=w&&fa(Se(P,E)),N=fa(Se(0,365)),A=R&&Nae(R,N);return Object.assign(Ge({extensions:i||[{name:"regionCode",value:D+1}],birthDate:A,isMock:n}),T)});return{persons:U.length&&U||v[0],nationalityCodes:g}}var Xme=["Ace Academy","Avengers","Ball Bouncers","Baseliners","Captivators","Civil Disobedients","Continentals","Court Royal","Court Sharks","Diamond Dogs","Danger Zone","Doubles Dominators","Double Faults","Tricksters","Eliminators","Court Crusaders","Fuzz Busters","Game Changers","Goal Gurus","Good Volley","Green Machine","Hawk Eyes","Inside Outers","Killer Instinct","Line Toers","Masters of Mayhem","Matter Catchers","Cheap Shot","Mean Machines","Mindspace Invaders","Net Centric","Net Positive","Smash Mullet","Over Your Head","Spin Meisters","Aggressors","Racket Machine","Slice Happy","Refs Nightmare","Sandeaters","Sun Seekers","Slicer Dicers","Stacked Deck","Cross Stringers","The Emergence","Total Demolition","Touch and Go","Unreturnables","Upside Downers","Vertically Challenged","Visual Spectacle"];function jS({nameRoot:t="TEAM",count:e=1}={}){let i=wn(Xme).slice(0,e);return i.length<e&&Se(0,e-i.length).forEach(r=>i.push(`${t} ${r+1}`)),{names:i}}function ev(t){let{scaledParticipantsCount:e,rankingRange:i}=t,{ratingsParameters:r=Nr,valuesInstanceLimit:n,ratingsValues:a=[],consideredDate:o,categories:s,category:l,nationalityCodesCount:u,nationalityCodeType:c,nationalityCodes:d,participantsCount:p=32,participantType:m,teamSize:h=8,personIds:f,idPrefix:g,uuids:v,personExtensions:y,addressProps:I,gendersCount:b,matchUpType:S,personData:w,sex:U,inContext:T,withISO2:D,withIOC:P,scaleAllParticipants:E}=t,R=m===ht||S===Md,N=m===Kt||S===Kt;i&&(!Array.isArray(i)||!i.every(ce=>Li(ce))||i.length!==2)&&(i=void 0),e=E?p:e;let A=1e3,M=e&&e>A?e:A;i=i||[1,M],i[1]+=1;let C=p*(R&&2||N&&(h??8)||1),O=TY({count:C,personExtensions:y,consideredDate:o,gendersCount:b,personData:w,category:l,sex:U});if(O.error)return O;let{nationalityCodes:k,persons:x}=O,F={},$={},_={},L={},B=ce=>{Object.assign(F,ce.doublesRankings),Object.assign($,ce.singlesRankings),Object.assign(L,ce.doublesRatings),Object.assign(_,ce.singlesRatings)};if(Nt(l)){let ce=yV({scaledParticipantsCount:e,ratingsParameters:r,participantType:m,ratingsValues:a,rankingRange:i,category:l});B(ce)}Array.isArray(s)&&s.forEach(ce=>{let ke=yV({scaledParticipantsCount:e,ratingsParameters:r,participantType:m,ratingsValues:a,rankingRange:i,category:ce});B(ke)});let V=Xp.filter(ce=>c==="IOC"&&ce.ioc||ce.iso);function G(ce){let ke=Math.ceil(C/ce);return n&&ke>n?Math.ceil(C/n):ce}let{postalCodesProfile:j,postalCodesCount:z,statesProfile:W,citiesProfile:q,citiesCount:Y,statesCount:re}=I||{},K=ce=>Object.keys(ce).map(ke=>Se(0,W[ke]).map(()=>ke)).flat(),H=q&&K(q)||(I==null?void 0:I.cities)||bY({count:Y||C,participantsCount:C}).cities,Z=W&&K(W)||(I==null?void 0:I.states)||wY({count:re||C,participantsCount:C}).states,X=j&&K(j)||(I==null?void 0:I.postalCodes)||UY({count:z||C,participantsCount:C}).postalCodes,ie={cities:H,states:Z,postalCodes:X},ae=G(u),le=ae?wn(V).slice(0,u):d&&V.filter(ce=>d.includes(ce.iso))||V,ne=wn(Se(0,Math.ceil(C/(ae||1))).map(()=>le).flat(1/0)),de=jS({count:p}).names;return{participants:Se(0,p).map(ce=>{let ke=R&&2||N&&(h??8)||1,Pe=Se(0,ke).map(pe=>{let Fe=ce*ke+pe;return ye(Fe)}),it=Pe.map(pe=>pe.participantId),It=Pe.map(pe=>pe.person.standardFamilyName).join("/"),me=R?ht:Kt,fe={participantId:VS({participantType:me,index:ce,idPrefix:g,uuids:v}),participantName:R?It:de[ce],participantRole:Qr,individualParticipantIds:it,participantType:me};return T&&(fe.individualParticipants=Pe),R||N?[fe,...Pe]:Pe}).flat(),...J};function ye(ce){let ke=x[ce],{nationalityCode:Pe,participantExtensions:it,participantTimeItems:It,extensions:me,firstName:fe,birthDate:pe,lastName:Fe,personId:De,sex:je}=ke||{},ue=fe||"GivenName",he=Fe||"FamilyName",Re=`${ue} ${he}`,xe=ne[ce],Ee=(k==null?void 0:k.length)&&Pe||xe&&(c==="IOC"?xe.ioc||xe.iso:xe.iso||xe.ioc)||Pe;ne!=null&&ne.length&&!Ee&&!Pe&&console.log("%c Invalid Nationality Code",{participantIndex:ce,country:xe});let we=SY({...ie,participantIndex:ce,nationalityCode:Ee}),Ue=Ge({participantId:VS({participantType:St,index:ce,idPrefix:g,uuids:v}),extensions:it,timeItems:It,participantRole:Qr,participantType:St,participantName:Re,person:{personId:De||(f==null?void 0:f.length)&&f[ce]||Gt(),birthDate:Ia(pe)?pe:void 0,addresses:[we],standardFamilyName:he,standardGivenName:ue,nationalityCode:Ee,extensions:me,sex:je}});if(P&&Ee){let Le=Xp.find(({iso:rt})=>rt===Ee);Le!=null&&Le.ioc&&(Ue.person.iocNationalityCode=Le.ioc),Le!=null&&Le.label&&(Ue.person.countryName=Le.label)}if(D&&Ee){let Le=Xp.find(({iso:rt})=>rt===Ee);Le!=null&&Le.iso2&&(Ue.person.iso2NationalityCode=Le.iso2),Le!=null&&Le.label&&(Ue.person.countryName=Le.label)}let wt=Le=>{var be,Ct,Ce,qe;let rt=Le.categoryName||Le.ratingType||Le.ageCategoryCode,Ei=(be=$[rt])==null?void 0:be[ce],Be=(Ct=F[rt])==null?void 0:Ct[ce];pU({scaleValue:Ei,eventType:Im,scaleType:wc,participant:Ue,category:Le}),pU({scaleValue:Be,eventType:wu,scaleType:wc,participant:Ue,category:Le});let nt=(Ce=_[rt])==null?void 0:Ce[ce],Ii=(qe=L[rt])==null?void 0:qe[ce];pU({scaleValue:nt,eventType:Im,scaleType:gc,participant:Ue,category:Le}),pU({scaleValue:Ii,eventType:wu,scaleType:gc,participant:Ue,category:Le})};return Array.isArray(s)?s.forEach(Le=>wt(Le)):l&&wt(l),Ue}}function pU({scaleValue:t,participant:e,eventType:i,scaleType:r,category:n}){let a=n.categoryName||n.ratingType||n.ageCategoryCode,o=[xd,r,i,a].join("."),s={itemValue:t,itemType:o};a&&t&&(e.timeItems||(e.timeItems=[]),e.timeItems.push(s))}function yV(t){let{category:e,scaledParticipantsCount:i,ratingsParameters:r,participantType:n,ratingsValues:a=[]}=t,o=e.rankingRange||t.rankingRange||[1,1e3],s={},l={},u={},c={},{categoryName:d,ageCategoryCode:p,ratingType:m}=e,h=e.categoryName||e.ratingType||e.ageCategoryCode;if((d||p)&&!m){let[f,g]=o||[];if(l[h]=wn(Se(f,g)).slice(0,i||to(20,30)),[ht,Kt].includes(n)){let[v,y]=o||[];s[h]=wn(Se(v,y)).slice(0,i||to(20,30))}}if(m&&r[m]){let{ratingMax:f,ratingMin:g,ratingAttributes:v}=e,y={...r[m],...v||{}},{attributes:I={},decimalsCount:b,accessors:S,range:w,step:U}=y,T=N=>{let A={},M=Object.keys(N||{});for(let C of M){let O=N[C];if(typeof O=="object"&&O.generator){let{range:k}=O,[x,F]=k.slice().sort();A[C]=to(x,F)}else A[C]=O}return A},D=w[0]>w[1]?2:.7,[P,E]=w.slice().sort(),R=Se(0,2e3).map(()=>hG(P,E,D,U,b)).filter(N=>(!f||N<=f)&&(!g||N>=g)).slice(0,i||to(20,30)).map(N=>S?Object.assign({},...S.map(A=>({[A]:N})),T(I)):N);u[h]=[...a,...R],[ht,Kt].includes(n)&&(c[h]=[...a,...R])}return{singlesRankings:l,doublesRankings:s,singlesRatings:u,doublesRatings:c}}function ux(t){var m,h;let{alternatesCount:e=0,tieFormatName:i,drawSize:r}=t,n=0,a=0,o=0,s=0,l={},u={[Jt]:0,[pi]:0,[Bn]:0,[Ud]:0,[Ps]:0};(h=(m=Nt(t.tieFormat)?t.tieFormat:bu({namedFormat:i}))==null?void 0:m.collectionDefinitions)==null||h.filter(Boolean).forEach(f=>{let{category:g,collectionId:v,matchUpType:y,matchUpCount:I,gender:b}=f;if([Jt,pi].includes(b)){let S=I*(y===Zt?2:1);u[b]<S&&(u[b]=S)}else b===Bn&&(u[Jt]<I&&(u[Jt]=I),u[pi]<I&&(u[pi]=I));if(g){let S=JSON.stringify(g);l[S]=g}if(v||(f.collectionId=Gt()),Yi(Zt)(y)){let S=I;s+=I,n=Math.max(n,S)}if(Yi(ti)(y)){let S=I;o+=I,a=Math.max(a,S)}});let c=Object.keys(l).length?Math.max(o,s*2):Math.max(a,n*2),d=n*(r+e),p=a*(r+e);return{maxDoublesDraw:d,maxSinglesDraw:p,teamSize:c,genders:u}}function Jme({participantsProfile:t,eventProfiles:e,drawProfiles:i}){let{participantsCount:r,participantType:n=St}=t||{},a=r||0,o={[pi]:0,[Bn]:0,[Ud]:0,[Jt]:0,[Ps]:0},s=0,l=0,u=0,c=0,d=0,p=({alternatesCount:h=0,uniqueParticipants:f,tieFormatName:g,drawSize:v=0,eventType:y,tieFormat:I,category:b,gender:S,stage:w})=>{let U=y===uo,T=y===sr,D=!!(f||w===Ye||b||S);if(T){c=Math.max(c,v+h),I=typeof I=="object"?I:bu({namedFormat:g});let{teamSize:P,maxDoublesDraw:E,maxSinglesDraw:R,genders:N}=ux({alternatesCount:h,tieFormatName:g,tieFormat:I,drawSize:v});u=Math.max(u,P),l=Math.max(l,R),D||(s=Math.max(s,E)),Object.keys(N).forEach(A=>o[A]+=N[A])}else if(U)if(D){let P=(v+h)*2;d+=P,S&&(o[S]+=P)}else v+h&&v+h>s&&(s=v+h);else if(D){let P=v+h;S&&(o[S]+=P),d+=P}else v&&v>l&&(l=v+h)};if(e==null||e.forEach(h=>{let{tieFormatName:f,tieFormat:g,drawProfiles:v,eventType:y,category:I,gender:b}=h;if(v)for(let S of v){let{tieFormatName:w,tieFormat:U}=S;p({...S,tieFormatName:w||f,tieFormat:U||g,eventType:y,category:I,gender:b})}}),Array.isArray(i))for(let h of i)p(h);let m=Math.max(c*u,s*2,l);return s&&(n=ht),(r||a)<m&&(r=m),r&&s&&[ht,sr].includes(n)&&(l&&Math.floor(l/2)>s?r=Math.floor(l/2):(!l||s*2>=l)&&(r=Math.ceil(r/2))),r===void 0&&(r=!(e!=null&&e.length)&&!(i!=null&&i.length)?32:0),r<a&&(r=a),{uniqueParticipantsCount:d,participantsCount:r,largestTeamDraw:c,largestTeamSize:u,participantType:n,gendersCount:o}}function DY({participantsProfile:t,tournamentRecord:e,eventProfiles:i,drawProfiles:r,startDate:n,uuids:a}){if((t==null?void 0:t.participantsCount)===0)return{addedCount:0,...J};let{participantsCount:o,participantType:s,largestTeamDraw:l,largestTeamSize:u,gendersCount:c}=Jme({participantsProfile:t,eventProfiles:i,drawProfiles:r}),d=t==null?void 0:t.teamKey,p=ev({consideredDate:n,...t,participantsCount:o,participantType:s,gendersCount:c,uuids:a}).participants,m=0,h=ts({tournamentRecord:e,participants:p});if(h.error)return h;if(m+=h.addedCount,d){let y=lx({tournamentRecord:e,...d});if(y.error)return y}let f=p.filter(({participantType:y})=>y===St).map(Ut),g=t!=null&&t.idPrefix?`${Kt}-${t.idPrefix}`:void 0,v=Se(0,l).map(y=>{let I=f.slice(y*u,(y+1)*u),b=VS({index:y,participantType:s,idPrefix:g,uuids:a});return{participantName:`Team ${y+1}`,participantRole:Qr,individualParticipantIds:I,participantType:Kt,participantId:b}});return h=ts({participants:v,tournamentRecord:e}),h.error?h:(m+=h.addedCount,{addedCount:m,...J})}function PY({drawProfiles:t,category:e,gender:i}){let r={},n=t==null?void 0:t.reduce((o,s)=>{let{qualifyingPositions:l=0,participantsCount:u=0,uniqueParticipants:c,stage:d=Oe,drawSize:p=0}=s||{};Object.keys(o).includes(d)||(o[d]=0);let m=(u||p)-l;return c||i||e||d===Ye?(Object.keys(r).includes(d)||(r[d]=0),r[d]+=m):o[d]=Math.max(o[d],m),o},{}),a=Object.keys(r);return a.forEach(o=>n[o]+=r[o]),{stageParticipantsCount:n,uniqueParticipantsCount:r,uniqueParticipantStages:a}}function RY({allUniqueParticipantIds:t,stageParticipantsCount:e,eventParticipantType:i,targetParticipants:r}){let n=e[Oe]||0,a=e[Ye]||0;return{stageParticipants:{QUALIFYING:r==null?void 0:r.filter(({participantType:o})=>o===i).filter(({participantId:o})=>!t.includes(o)).slice(0,a),MAIN:r==null?void 0:r.filter(({participantType:o})=>o===i).filter(({participantId:o})=>!t.includes(o)).slice(a,a+n)}}}var Qme={[zt]:2,[er]:1,[cr]:1,[mn]:1,[Mt]:4};function cx(t){let{defaultWithScorePercent:e=2,winningSide:i}=t,{matchUpStatusProfile:r=Qme,matchUpFormat:n=hu,pointsPerMinute:a=1,sideWeight:o=4}=t;if(!Ua({matchUpFormat:n}))return{error:IN};if(typeof r!="object")return{error:oe};if(e>100&&(e=100),isNaN(e)||isNaN(a)||isNaN(o))return{error:oe};let s=Object.keys(r).filter(P=>Object.keys(cW).includes(P)&&P!==qi);if(Object.keys(s).reduce((P,E)=>P+r[E],0)>100)return{error:oe,matchUpStatusProfile:r};let l=s.reduce((P,E)=>(P.pointer=P.pointer+r[E],P.valueMap.push([P.pointer,E]),P),{pointer:0,valueMap:[]}),u=to(1,100),c=(l.valueMap.find(P=>u<=P[0])??[100,qi])[1],d={sets:[],scoreStringSide1:"",side2ScoreString:""};if([zt,Mt].includes(c)){i=i||to(1,2);let P={score:d,matchUpStatus:c,winningSide:i};if(!(c===Mt&&to(1,100)>100-e))return{outcome:P}}else if([er,cr].includes(c))return{outcome:{score:d,matchUpStatus:c}};let p=kn(n),{bestOf:m=1,exactly:h,setFormat:f,finalSetFormat:g}=p??{},v=[],y=to(0,1),I=i?[i-1]:[...Se(0,o).map(()=>y),1-y],b=[mn,Mt,co,Wc].includes(c)&&(fa(Se(1,h||m))||1),S,w=Se(1,(h??m)+1);for(let P of w){let E=P===(h??m),{set:R,incomplete:N,winningSideNumber:A}=Zme({setFormat:E&&g||f,incomplete:b===P,pointsPerMinute:a,matchUpStatus:c,weightedRange:I,setNumber:P});if(v.push(R),N){S=A;break}if(VI({matchUp:{score:{sets:v},matchUpFormat:n}}).calculatedWinningSide)break}let U=VI({matchUp:{score:{sets:v},matchUpFormat:n,winningSide:i}}),T=S?i||S:U.calculatedWinningSide,{score:D}=cY({winningSide:T,score:{sets:v},matchUpStatus:c});return{outcome:{winningSide:T,matchUpStatus:c,score:D}}}function Zme({weightedRange:t=[0,1],pointsPerMinute:e,matchUpStatus:i,incomplete:r,setFormat:n,setNumber:a}){let o={setNumber:a},{setTo:s,tiebreakFormat:l,tiebreakAt:u,tiebreakSet:c,timed:d,minutes:p}=n,m=to(0,t.length-1),h=t[m],f;if(d){let g=p*e,v=Math.round(g*.2),y=g+fa([1,-1])*v,I=hne(y,2),b=[I,y-I];h&&b.reverse(),f=t[m]+1;let S=b[0]>b[1]&&1||b[1]>b[0]&&2||0;if(r){let[T,D]=b;return Object.assign(o,{side1Score:T,side2Score:D}),vr.includes(i)?{set:o,incomplete:r,winningSideNumber:f}:{set:o,incomplete:r}}S||(b[to(0,1)]+=1),S=b[0]>b[1]?1:2,S!==f&&b.reverse();let[w,U]=b;return Object.assign(o,{side1Score:w,side2Score:U,winningSide:f}),{set:o}}else{if(r)return o.side1Score=to(0,u),o.side2Score=to(0,u),vr.includes(i)&&(f=t[m]+1),{set:o,incomplete:r,winningSideNumber:f};{let g=Se(1,s+1).map(U=>Se(0,s+2-U).map(()=>U)).flat(),v=g[to(0,g.length-1)],y=s&&KO({isSide1:!0,tiebreakAt:u,lowValue:v,setTo:s}),I=!y,b=t.length===1&&t[m]+1;if(!I){b?(y[0]>y[1]?1:2)!==b&&y.reverse():h&&y.reverse();let[U,T]=y;Object.assign(o,{side1Score:U,side2Score:T})}let S=$I({matchUpScoringFormat:{setFormat:n},setObject:o}),w;if(S.hasTiebreakCondition||I){let{NoAD:U,tiebreakTo:T}=l||c||{},D=Se(1,T+1).map(R=>Se(0,T+2-R).map(()=>R)).flat(),P=D[to(0,D.length-1)],E=lD({isSide1:!0,tiebreakNoAd:U,tiebreakTo:T,lowValue:P});if(E)if(I){let R=E[0]>E[1]?1:2;b?R!==b&&E.reverse():h&&E.reverse(),[o.side1TiebreakScore,o.side2TiebreakScore]=E,w=E[0]>E[1]&&1||E[1]>E[0]&&2||void 0}else S.leadingSide===2?[o.side1TiebreakScore,o.side2TiebreakScore]=E:[o.side2TiebreakScore,o.side1TiebreakScore]=E}o.winningSide=S.winningSide||S.leadingSide||b||w}}return{set:o}}function GS(t){var v,y,I;let{matchUpStatusProfile:e,completeAllMatchUps:i,randomWinningSide:r,tournamentRecord:n,completionGoal:a,drawDefinition:o,event:s}=t;if(!o)return{error:_e};let l=t.matchUpFormat||o.matchUpFormat||(s==null?void 0:s.matchUpFormat),u=o.structures.slice().sort(Qm),c=0,{matchUps:d,matchUpsMap:p}=mr({matchUpFilters:{matchUpTypes:[hi],roundNumbers:[1]},contextFilters:{stages:[Oe,Ye]},inContext:!0,drawDefinition:o});if(d!=null&&d.length){let b=((v=s==null?void 0:s.category)==null?void 0:v.ageCategoryCode)||((y=s==null?void 0:s.category)==null?void 0:y.categoryName);if(b){let S=B4({singlesOnly:!0,tournamentRecord:n,drawDefinition:o,scaleAccessor:{scaleName:b,sortOrder:$4,scaleType:wc},event:s});if(S.error)return S;let{lineUps:w,participantsToAdd:U}=S;ts({tournamentRecord:n,participants:U}),Lt({element:o,extension:{name:Tu,value:w}})}else{let S=(I=d[0])==null?void 0:I.structureId,{positionAssignments:w}=oi({drawDefinition:o,structureId:S});if(w!=null&&w.length){let{participants:U}=Ni({participantFilters:{participantTypes:[hi]},tournamentRecord:n}),T=D=>{let P=D.tieMatchUps.filter(Yi(ti)),E=D.tieMatchUps.filter(Yi(Zt));P.forEach((R,N)=>{let A=R.matchUpId;R.sides.forEach(M=>{var k;let{drawPosition:C}=M,O=U==null?void 0:U.find(x=>{var $;let{participantId:F}=x;return(($=w.find(_=>_.participantId===F))==null?void 0:$.drawPosition)===C});if(O){let x=(k=O.individualParticipantIds)==null?void 0:k[N];x&&BS({teamParticipantId:O.participantId,participantId:x,tournamentRecord:n,drawDefinition:o,tieMatchUpId:A,event:s})}})}),E.forEach((R,N)=>{let A=R.matchUpId;R.sides.forEach(M=>{var k,x;let{drawPosition:C}=M,O=U==null?void 0:U.find(F=>{var _;let{participantId:$}=F;return((_=w.find(L=>L.participantId===$))==null?void 0:_.drawPosition)===C});O&&((x=(k=O.individualParticipantIds)==null?void 0:k.slice(N*2,N*2+2))==null||x.forEach(F=>{BS({teamParticipantId:O.participantId,participantId:F,tournamentRecord:n,drawDefinition:o,tieMatchUpId:A,event:s})}))})})};d.forEach(T)}}}let m=typeof i=="string"&&i,h=m&&qi,f=u.length===2&&u[0].finishingPosition===kd&&Vi(u.map(({stage:b})=>b),[Oe,$i]).length===2,g=u.map(({structureId:b})=>b);for(let b of g){if(c>=a)break;let S=o.structures.find(T=>T.structureId===b),w=Wt({contextFilters:{matchUpTypes:[Zt,ti]},afterRecoveryTimes:!1,tournamentRecord:n,inContext:!0,drawDefinition:o,matchUpsMap:p,structure:S,event:s}).matchUps;w.length;let U=w.filter(({winningSide:T})=>!T).sort(oh).map(Dr);for(let T of U){if(!isNaN(a)&&c>=a)break;let{matchUps:D}=Wt({matchUpFilters:{matchUpTypes:[Zt,ti]},afterRecoveryTimes:!1,tournamentRecord:n,inContext:!0,drawDefinition:o,matchUpsMap:p,structure:S,event:s}),P=D.find(R=>R.matchUpId===T),E=[er,cr].includes(P.matchUpStatus);if(P!=null&&P.readyToScore&&!E){let R=ehe({matchUpStatusProfile:e,tournamentRecord:n,drawDefinition:o,targetMatchUp:P,matchUpFormat:l,matchUpStatus:h,scoreString:m,winningSide:!r&&1,event:s});if(R!=null&&R.error)return R;c+=1}}f&&S.finishingPosition===kd&&t.completeRoundRobinPlayoffs&&Gg({structureId:S.structureId,applyPositioning:!0,drawDefinition:o})}return{...J,completedCount:c}}function EY(t){let{matchUpStatusCodes:e,policyDefinitions:i,tournamentRecord:r,drawDefinition:n,targetMatchUp:a,matchUpStatus:o,matchUpFormat:s,scoreString:l,winningSide:u,event:c}=t;if(!a||a.matchUpStatus===Vt)return;let{matchUpId:d}=a||{},{outcome:p}=rx({matchUpFormat:s,matchUpStatus:o,scoreString:l,winningSide:u});return e&&(p.matchUpStatusCodes=e),Fb({tournamentRecord:r,policyDefinitions:i,drawDefinition:n,matchUpFormat:s,matchUpId:d,outcome:p,event:c})}function ehe(t){let{matchUpStatusProfile:e={},tournamentRecord:i,policyDefinitions:r,drawDefinition:n,matchUpStatus:a,matchUpFormat:o,targetMatchUp:s,scoreString:l,winningSide:u,event:c}=t;if(l||a)return EY(t);let{matchUpId:d}=s||{},{outcome:p}=cx({matchUpStatusProfile:e,matchUpFormat:o,winningSide:u});return Fb({policyDefinitions:r,tournamentRecord:i,drawDefinition:n,matchUpFormat:o,matchUpId:d,outcome:p,event:c})}function CY({matchUpStatusProfile:t,completeAllMatchUps:e,randomWinningSide:i,tournamentRecord:r,drawProfiles:n,isMock:a,event:o}){var f,g,v,y;let s=Gi({event:o}).flightProfile,{eventName:l,eventType:u,category:c}=o,{startDate:d}=r,p=[],m=(c==null?void 0:c.categoryName)||(c==null?void 0:c.ageCategoryCode)||(c==null?void 0:c.ratingType),h=(f=o.drawDefinitions)==null?void 0:f.map(({drawId:I})=>I);if(Array.isArray(s==null?void 0:s.flights))for(let[I,b]of s.flights.entries()){let{drawId:S,stage:w,drawName:U,drawEntries:T}=b;p.push(b.drawId);let D=n[I],{seedsCount:P,generate:E=!0}=D||{};if(E){let R=T.filter(Ta(Hl)).map(Ta(Hl)),N=m||l;if(r&&P&&P<=R.length&&Se(1,P+1).forEach((k,x)=>{let F={scaleValue:k,scaleName:N,scaleType:Rl,eventType:u,scaleDate:d},$=R[x];Pb({tournamentRecord:r,participantId:$,scaleItem:F})}),h==null?void 0:h.includes(S))break;let A=Ab({...D,matchUpType:u,seedingScaleName:N,tournamentRecord:r,drawEntries:T,drawName:U,drawId:S,isMock:a,event:o,stage:w});if(A.error)return{error:A.error,drawIds:[]};let{drawDefinition:M}=A;if(!M)return{error:xa};let C=(g=n[I])==null?void 0:g.drawExtensions;if(Array.isArray(C)&&C.filter(il).forEach(k=>Lt({element:M,extension:k})),A=Ob({suppressNotifications:!0,tournamentRecord:r,drawDefinition:M,event:o}),A.error)return{error:A.error,drawIds:[]};if(D!=null&&D.withPlayoffs){let k=(v=M.structures)==null?void 0:v[0].structureId,x=XT({idPrefix:D.idPrefix,...D.withPlayoffs,tournamentRecord:r,drawDefinition:M,structureId:k,isMock:a,event:o});if(x!=null&&x.error)return x}let O=D==null?void 0:D.completionGoal;if((D==null?void 0:D.automated)!==!1&&(e||O)){let k=D==null?void 0:D.matchUpFormat,x=GS({completeAllMatchUps:!O&&e,matchUpStatusProfile:t,randomWinningSide:i,tournamentRecord:r,completionGoal:O,drawDefinition:M,matchUpFormat:k,event:o});if(x.error)return{error:x.error,drawIds:[]};let F=x.completedCount;if((D==null?void 0:D.drawType)===Gl){let $=(y=M.structures)==null?void 0:y.find(B=>B.stage===Oe);if(!$)return{error:Mi};let _=Gg({structureId:$.structureId,tournamentRecord:r,drawDefinition:M,event:o});if(_.error)return{error:_.error,drawIds:[]};let L=O?O-(F??0):void 0;if(_=GS({completeAllMatchUps:!O&&e,completionGoal:O?L:void 0,matchUpStatusProfile:t,randomWinningSide:i,tournamentRecord:r,drawDefinition:M,matchUpFormat:k,event:o}),_.error)return{error:_.error,drawIds:[]}}}}}return{...J,drawIds:p}}function MY(t){var w,U;let{participantsProfile:e={},uniqueParticipantsCount:i,ratingsParameters:r,tournamentRecord:n,eventProfile:a,eventIndex:o,event:s,uuids:l}=t,{category:u,gender:c,eventType:d}=s,p=Yi(el)(d)&&St||Yi(uo)(d)&&ht||d,m=i[Oe]||0,h=i[Ye]||0,f=(w=a.drawProfiles)!=null&&w.length?m+h:((U=a.participantsProfile)==null?void 0:U.participantsCount)??0,g=[Jt,pi].includes(c)?c:void 0,v=e!=null&&e.idPrefix?`E-${o}-${e==null?void 0:e.idPrefix}`:void 0,{participants:y}=ev({uuids:a.uuids||l,...e,scaledParticipantsCount:a.scaledParticipantsCount,consideredDate:n==null?void 0:n.startDate,rankingRange:a.rankingRange,participantType:p,participantsCount:f,ratingsParameters:r,category:u,idPrefix:v,sex:g}),I=ts({tournamentRecord:n,participants:y});if(I.error)return I;let b=y==null?void 0:y.filter(({participantType:T})=>T===p),S=y==null?void 0:y.map(Ut);return{uniqueDrawParticipants:b,uniqueParticipantIds:S}}function the({autoEntryPositions:t,tournamentRecord:e,drawParticipants:i,drawProfile:r,event:n}){let{drawType:a=Hs,qualifyingPositions:o=0,stage:s=Oe,drawSize:l=0,drawName:u,drawId:c}=r,d=l-o,p=i.slice(0,d).map(Ut);if(p.length){let f=zs({participantIds:p,autoEntryPositions:t,entryStage:s,tournamentRecord:e,event:n});if(f.error)return f}let m=p.map(f=>({entryStatus:oa,entryStage:s,participantId:f})),h=ED({drawName:u||a,qualifyingPositions:o,drawEntries:m,drawId:c,event:n,stage:s});return h.error?h:{...J}}function NY({uniqueDrawParticipants:t,autoEntryPositions:e,stageParticipants:i,tournamentRecord:r,drawProfiles:n,category:a,gender:o,event:s}){let l=0;for(let u of n){let{qualifyingPositions:c=0,uniqueParticipants:d,stage:p=Oe,drawSize:m=0}=u,h=m-c,f=d||o||a||p===Ye,g=f?t.slice(l,l+h):i[p||Oe]||[];f&&(l+=h);let v=the({autoEntryPositions:e,drawParticipants:g,tournamentRecord:r,drawProfile:u,event:s});if(v.error)return v}return{...J}}function AY(t){var W;let{allUniqueParticipantIds:e,matchUpStatusProfile:i,participantsProfile:r,completeAllMatchUps:n,autoEntryPositions:a,hydrateCollections:o,randomWinningSide:s,ratingsParameters:l,tournamentRecord:u,eventProfile:c,eventIndex:d,publish:p,isMock:m,uuids:h}=t,f=c.gender,g=c.eventName,{eventType:v=el,policyDefinitions:y,drawProfiles:I=[],eventExtensions:b,surfaceCategory:S,tieFormatName:w,processCodes:U,discipline:T,eventLevel:D,timeItems:P,ballType:E,category:R}=c,N=c.eventId||Gt(),A=c.tieFormat||(v===sr?bu({namedFormat:w,event:{eventId:N,category:R,gender:f},hydrateCollections:o,isMock:m}):void 0),M=u.participants;for(let q of I)!f&&q.gender&&(f=q==null?void 0:q.gender);let{stageParticipantsCount:C,uniqueParticipantsCount:O,uniqueParticipantStages:k}=PY({drawProfiles:I,category:R,gender:f}),x=Yi(el)(v)&&St||Yi(uo)(v)&&ht||v,{uniqueDrawParticipants:F=[],uniqueParticipantIds:$=[]}=k?MY({event:{eventType:v,category:R,gender:f},uniqueParticipantsCount:O,participantsProfile:r,ratingsParameters:l,tournamentRecord:u,eventProfile:c,eventIndex:d,uuids:h}):{},{eventAttributes:_}=c;typeof _!="object"&&(_={});let L=(R==null?void 0:R.categoryName)||(R==null?void 0:R.ageCategoryCode)||(R==null?void 0:R.ratingType);g=g||L||"Generated Event";let B={..._,surfaceCategory:S,processCodes:U,discipline:T,eventLevel:D,eventName:g,eventType:v,tieFormat:A,ballType:E,category:R,eventId:N,gender:f};if(b!=null&&b.length&&Array.isArray(b)){let q=b.filter(il);q!=null&&q.length&&Object.assign(B,{extensions:q})}if(Array.isArray(P)&&P.forEach(q=>dh({event:j,timeItem:q})),typeof y=="object")for(let q of Object.keys(y))Vd({policyDefinitions:{[q]:y[q]},event:B});B.category&&(B.category.categoryName=L);let V,G=Yg({suppressNotifications:!1,internalUse:!0,tournamentRecord:u,event:B});if(G.error)return G;let j=G==null?void 0:G.event,{stageParticipants:z}=RY({allUniqueParticipantIds:e,stageParticipantsCount:C,eventParticipantType:x,targetParticipants:M});if(I!=null&&I.length){let q=NY({uniqueDrawParticipants:F,autoEntryPositions:a,stageParticipants:z,tournamentRecord:u,drawProfiles:I,category:R,gender:f,event:j});if(q.error)return q;let Y=CY({matchUpStatusProfile:i,completeAllMatchUps:n,randomWinningSide:s,tournamentRecord:u,drawProfiles:I,isMock:m,event:j});if(Y.error)return Y;V=Y.drawIds}else if((W=c==null?void 0:c.participantsProfile)!=null&&W.participantsCount){let q=F.map(Ut);if(q.length){let Y=zs({participantIds:q,autoEntryPositions:a,tournamentRecord:u,entryStage:Oe,event:j});if(Y.error)return Y}}return p&&Xg({tournamentRecord:u,event:j}),{drawIds:V,eventId:N,uniqueParticipantIds:$}}function dx({tournamentRecords:t,scheduleDate:e,venueId:i,round:r}){if(!Ia(e))return{error:Ar};let n="addSchedulingProfileRound",{extension:a}=gt({name:Sm,tournamentRecords:t,discover:!0}),o=(a==null?void 0:a.value)||[],s=o.find(p=>Vl(e,p.scheduleDate));if(!s){let{startDate:p,endDate:m}=dD({tournamentRecords:t}),h=new Date(e);if(p&&h<new Date(p)||m&&h>new Date(m))return{error:Ar};s={scheduleDate:e,venues:[]},o.push(s)}let l=s.venues.find(p=>p.venueId===i);l||(l={venueId:i,rounds:[]},s.venues.push(l));let u=["notBeforeTime"],c=p=>Object.keys(p).filter(m=>!u.includes(m)).sort().map(m=>Nt(p[m])?c(p[m]):p[m]).flat().join("|");if(l.rounds.find(p=>c(p)===c(r)))return ee({result:{error:xG},stack:n});l.rounds.push(r);let d=Wg({tournamentRecords:t,schedulingProfile:o});return d.error?d:{...J}}function ihe({schedulingProfile:t,tournamentRecord:e}){if(typeof t!="object")return{error:oe};let i=Lg({tournamentRecord:e}).containedStructures,r=Vr({tournamentRecord:e}).matchUps??[],{tournamentId:n}=e,a=[];for(let o of t){let{scheduleDate:s,venues:l=[]}=o;for(let u of l){let{rounds:c,venueId:d}=u;for(let p of c){let{drawId:m,winnerFinishingPositionRange:h,roundSegment:f}=p,g=r.filter(v=>{var b;let y=(h==null?void 0:h.indexOf("-"))>0&&h.split("-").map(S=>+S),I=(b=v.finishingPositionRange)==null?void 0:b.winner;return v.drawId===m&&(!p.roundNumber||v.roundNumber===p.roundNumber)&&(!I||!y||Vi(I,y).length===2||ct(I).length===ct(y).length&&Vi(I,y).length===ct(I).length)})[0];if(g){let{eventId:v,roundNumber:y,drawName:I,structureName:b,roundName:S}=g,w=g.structureId;y&&!h&&(w=Object.keys(i).find(D=>i[D].includes(w))??w);let U={tournamentId:n,structureId:w,roundNumber:y,roundSegment:f,eventId:v,drawId:m},T=dx({tournamentRecords:{[n]:e},round:U,scheduleDate:s,venueId:d});if(T.error)return T;a.push({structureName:b,roundName:S,drawName:I,...U})}}}}return{scheduledRounds:a}}function VD(t){var Pe,it,It;let e=ze(t,[{drawProfile:!0,_ofType:ea}]);if(e.error)return e;let{allUniqueParticipantIds:i=[],participantsProfile:r={},matchUpStatusProfile:n,completeAllMatchUps:a,autoEntryPositions:o,hydrateCollections:s,randomWinningSide:l,ratingsParameters:u,tournamentRecord:c,isMock:d=!0,drawProfile:p,startDate:m,drawIndex:h,uuids:f}=t,g=Me(p,!1,!0),{excessParticipantAlternates:v=!0,matchUpFormat:y=hu,drawType:I=Hs,tournamentAlternates:b=0,alternatesCount:S=0,qualifyingPositions:w,qualifyingProfiles:U,generate:T=!0,eventExtensions:D,drawExtensions:P,completionGoal:E,tieFormatName:R,buildTeams:N,seedsCount:A,timeItems:M,drawName:C,category:O,idPrefix:k,publish:x,gender:F,stage:$}=g,_=g.drawSize||(g.ignoreDefaults?void 0:32),L=g.eventId||Gt(),B=p.eventType||p.matchUpType||el,V=B===uo?ht:St,G=Nt(p.tieFormat)&&p.tieFormat||B===Kt&&bu({event:{eventId:L,category:O,gender:F},namedFormat:R,hydrateCollections:s,isMock:d})||void 0,j=(O==null?void 0:O.categoryName)||(O==null?void 0:O.ageCategoryCode)||(O==null?void 0:O.ratingType),z=p.eventName||j||`Generated ${B}`,W=(c==null?void 0:c.participants)||[],q=((U==null?void 0:U.map(me=>me.structureProfiles||[]).flat().reduce((me,fe)=>{let pe=!fe.participantsCount||fe.participantsCount>fe.drawSize?fe.drawSize:fe.participantsCount||0;return me+pe},0))||0)*(V===ht?2:1),Y=(!p.participantsCount||p.participantsCount>_?_:p.participantsCount)||0,re={eventName:z,eventType:B,tieFormat:G,category:O,eventId:L,gender:F};Array.isArray(M)&&M.forEach(me=>dh({event:re,timeItem:me}));let{eventAttributes:K}=p;if(typeof K!="object"&&(K={}),Object.assign(re,K),(D==null?void 0:D.length)&&Array.isArray(D)){let me=D.filter(il);me!=null&&me.length&&Object.assign(re,{extensions:me})}let H=[];if((r==null?void 0:r.participantsCount)===0||p.uniqueParticipants||q||!c||F||O){let me=(Y||0)+S+q,fe=me,pe={[Jt]:0,[pi]:0},Fe,De;B===Kt&&({teamSize:Fe,genders:De}=ux({alternatesCount:S,tieFormatName:R,tieFormat:G,drawSize:_}),Object.keys(De).forEach(he=>{[Jt,pi].includes(he)&&De[he]&&(pe[he]=_*De[he])}),fe=Fe*((_||0)+q));let je=r!=null&&r.idPrefix?`D-${h}-${r==null?void 0:r.idPrefix}`:void 0,ue=ev({...r,scaledParticipantsCount:p.scaledParticipantsCount||r.scaledParticipantsCount,participantsCount:fe,consideredDate:c==null?void 0:c.startDate,sex:F||(r==null?void 0:r.sex),rankingRange:p.rankingRange,uuids:p.uuids||f,ratingsParameters:u,participantType:V,gendersCount:pe,idPrefix:je,category:O}).participants;if(re.category&&(re.category.categoryName=j),c){let he=ts({participants:ue,tournamentRecord:c});if(he.error)return he}if(ue.forEach(({participantId:he})=>H.push(he)),W=ue,B===Kt){let he=De[Jt]?ue.filter(({participantType:Be,person:nt})=>Be===St&&(nt==null?void 0:nt.sex)===Jt).map(Ut):[],Re=De[pi]?ue.filter(({participantType:Be,person:nt})=>Be===St&&(nt==null?void 0:nt.sex)===pi).map(Ut):[],xe=ue.filter(({participantType:Be})=>Be===St).map(Ut).filter(Be=>!he.includes(Be)&&!Re.includes(Be)),Ee=[...g.teamNames??[],...jS({count:me}).names],we=Fe-(De[Jt]+De[pi]),Ue=0,wt=0,Le=0,rt=Se(0,me).map(Be=>{let nt=Re.slice(Ue,Ue+De[pi]),Ii=he.slice(wt,wt+De[Jt]),be=xe.slice(Le,Le+we);Ue+=De[pi],wt+=De[Jt],Le+=we;let Ct=N!==!1?[...nt,...Ii,...be]:[];return{participantName:Ee[Be]||`Team ${Be+1}`,participantOtherName:`TM${Be+1}`,participantRole:Qr,individualParticipantIds:Ct,participantType:Kt,participantId:Gt()}}),Ei=ts({participants:rt,tournamentRecord:c});if(!Ei.success)return Ei;W=rt}}let Z=me=>{let{participantType:fe}=me;return Yi(el)(B)&&fe===St||Yi(uo)(B)&&fe===ht?!0:B===Kt&&fe===Kt},X=me=>{var fe,pe;return!p.gender||((fe=me.person)==null?void 0:fe.sex)===p.gender?!0:(pe=me.individualParticipantIds)==null?void 0:pe.some(Fe=>{let De=W.find(je=>je.participantId===Fe);return De&&X(De)})},ie=W.filter(Z).filter(X).filter(({participantId:me})=>!i.includes(me)),ae=ie.slice(0,Y).map(me=>me.participantId);if(d&&(ae!=null&&ae.length)){let me=zs({autoEntryPositions:o,entryStage:$,tournamentRecord:c,participantIds:ae,event:re});if(me.error)return me}let le=q?ie.slice(Y,Y+q).map(me=>me.participantId):0;if(d&&(le!=null&&le.length)){let me=0,fe=1,pe=(De,je)=>De.stageSequence-je.stageSequence,Fe=(De,je)=>De.roundTarget-je.roundTarget;for(let De of U.sort(Fe)){fe=De.roundTarget||fe;let je=1,ue;for(let he of De.structureProfiles.sort(pe)){let Re=(he.drawSize||lN(he.participantsCount))-(ue||0),xe=le.slice(me,me+Re),Ee=zs({entryStage:Ye,entryStageSequence:je,autoEntryPositions:o,tournamentRecord:c,participantIds:xe,roundTarget:fe,event:re});if(Ee.error)return Ee;ue=he.qualifyingPositions,me+=Re,je+=1}fe+=1}}let ne=v&&((Pe=c==null?void 0:c.participants)==null?void 0:Pe.filter(({participantId:me})=>!ae.includes(me)).filter(Z).filter(X).slice(0,S||_-Y||b).map(me=>me.participantId));if(d&&(ne!=null&&ne.length)){let me=zs({participantIds:ne,autoEntryPositions:!1,entryStatus:jo,tournamentRecord:c,event:re});if(me.error)return me.error}let de=j||z;c&&A&&A<=ae.length&&Se(1,A+1).forEach((me,fe)=>{let pe={scaleName:de,scaleDate:m,scaleType:VA,scaleValue:me,eventType:B},Fe=ae[fe];Pb({tournamentRecord:c,participantId:Fe,scaleItem:pe})});let ye=Ab({...Me(p,!1,!0),tournamentRecord:c,seedingScaleName:de,matchUpFormat:y,eventId:L,isMock:d,event:re});if(ye.error)return ye;if(!ye.drawDefinition)return{error:xa};let{drawDefinition:ce}=ye,ke=ce.drawId;if(Array.isArray(P)&&P.filter(il).forEach(me=>Lt({element:ce,extension:me})),T){if(Ob({drawDefinition:ce,event:re,suppressNotifications:!0}),p.withPlayoffs){let fe=(it=ce.structures)==null?void 0:it[0].structureId,pe=XT({...p.withPlayoffs,tournamentRecord:c,drawDefinition:ce,structureId:fe,idPrefix:k,isMock:d,event:re});if(pe!=null&&pe.error)return pe}let me=p.automated===!1;if(d&&!me){let fe=pe=>{var je;let Fe=GS({completeAllMatchUps:pe.completeAllMatchUps,completionGoal:pe.completionGoal,matchUpStatusProfile:n,randomWinningSide:l,tournamentRecord:c,drawDefinition:ce,matchUpFormat:y,event:re});if(Fe.error)return Fe;let De=Fe.completedCount;if(I===Gl){let ue=(je=ce.structures)==null?void 0:je.find(xe=>xe.stage===Oe);if(!ue)return{error:Mi};Gg({structureId:ue.structureId,tournamentRecord:c,drawDefinition:ce,event:re});let he=E?E-(De??0):void 0,Re=GS({completionGoal:E?he:void 0,matchUpStatusProfile:n,completeAllMatchUps:a,randomWinningSide:l,tournamentRecord:c,drawDefinition:ce,matchUpFormat:y,event:re});if(Re.error)return Re}};if(E&&fe({completionGoal:E}),p.outcomes){let{matchUps:pe}=Sn({inContext:!0,drawDefinition:ce,event:re});for(let Fe of p.outcomes){let{matchUpStatus:De=qi,matchUpStatusCodes:je,stageSequence:ue=1,matchUpIndex:he=0,structureOrder:Re,matchUpFormat:xe,drawPositions:Ee,roundPosition:we,stage:Ue=Oe,roundNumber:wt,winningSide:Le,scoreString:rt}=Fe,Ei=(pe==null?void 0:pe.reduce((be,Ct)=>{let{structureId:Ce,matchUpId:qe}=Ct;return be[Ce]?be[Ce].push(qe):be[Ce]=[qe],be},{}))??[],Be=Object.assign({},...Object.keys(Ei).map((be,Ct)=>({[be]:Ct+1}))),nt=(It=pe==null?void 0:pe.filter(be=>(!Ue||be.stage===Ue)&&(!ue||be.stageSequence===ue)&&(!wt||be.roundNumber===wt)&&(!we||be.roundPosition===we)&&(!Re||Be[be.structureId]===Re)&&(!Ee||Vi(Ee,be.drawPositions).length===2)))==null?void 0:It[he],Ii=EY({matchUpStatusCodes:je,tournamentRecord:c,drawDefinition:ce,targetMatchUp:nt,matchUpFormat:xe,matchUpStatus:De,scoreString:rt,winningSide:Le});if(Ii!=null&&Ii.error)return Ii}}a&&fe({completeAllMatchUps:a})}x&&Xg({tournamentRecord:c,event:re})}else{let me=ED({drawEntries:ce.entries,drawName:C||I,qualifyingPositions:w,drawId:ke,event:re,stage:$});if(me.error)return me}return{...J,event:Ge(re),uniqueParticipantIds:H,targetParticipants:W,drawDefinition:ce,eventId:L,drawId:ke}}var OY=()=>({altitude:void 0,courtId:void 0,courtName:"",courtDimensions:void 0,latitude:void 0,longitude:void 0,surfaceCategory:void 0,surfaceType:void 0,surfacedDate:void 0,dateAvailability:[],onlineResources:[],pace:void 0,notes:void 0}),rhe=OY;function HS(t){return parseInt(t)}function bV({startTime:t="",endTime:e=""}={}){if(!t||!e||!Sd.test(t)||!Sd.test(e))return!1;let[i,r]=t.split(":").map(HS),[n,a]=e.split(":").map(HS);return n<i?!1:!(i===n&&a<r)}function nhe(t,e){let[i,r]=t.startTime.split(":").map(HS),[n,a]=e.startTime.split(":").map(HS);return i<n?-1:i>n?1:r<a?-1:r>a?1:0}function kY({dateAvailability:t}){if(!t)return{error:XG};if(!Array.isArray(t))return{error:DU};let e="Dates must be formated => YYYY-MM-DD",i="Times must be 24 hour => 00:00";for(let r of t){if(typeof r!="object")return{error:DU};let{date:n,startTime:a,endTime:o,bookings:s=[]}=r;if(!a||!o)return{error:DU};if(n&&!Zs.test(n))return{error:Ar,dateAvailability:{date:n},info:e};if(!Sd.test(a))return{error:No,dateAvailability:{startTime:a},info:i};if(!Sd.test(o))return{error:No,dateAvailability:{endTime:o},info:i};if(a===o)return{error:No,dateAvailability:{startTime:a,endTime:o},info:"startTime and endTime are equivalent"};if(!bV({startTime:a,endTime:o}))return{error:No,dateAvailability:{startTime:a,endTime:o},info:"endTime must be after startTime"};if(s){if(!Array.isArray(s))return{error:cS};for(let l of s){if(typeof l!="object")return{error:cS};let{startTime:u,endTime:c}=l;if(!Sd.test(u))return{error:No,booking:{startTime:u},info:i};if(!Sd.test(c))return{error:No,booking:{endTime:c},info:i};if(u===c)return{error:No,dateAvailability:{startTime:u,endTime:c},info:"startTime and endTime are equivalent"};if(!bV({startTime:u,endTime:c}))return{error:No,dateAvailability:{startTime:u,endTime:c},info:"endTime must be after startTime"}}}}return{valid:!0}}function jD({tournamentRecord:t,disableNotice:e,venueId:i,courtId:r,court:n}){let{venue:a}=eu({tournamentRecord:t,venueId:i});if(!a)return{error:Wm};a.courts||(a.courts=[]);let o={...OY(),venueId:i,courtId:r};if(o.courtId||(o.courtId=Gt()),a.courts.some(s=>s.courtId===o.courtId))return{error:mH};{let s=((n==null?void 0:n.dateAvailability)||[]).map(c=>{var d;return{...c,date:pt(c.date),startTime:bi(c.startTime),endTime:bi(c.endTime),bookings:(d=c.bookings)==null?void 0:d.map(({startTime:p,endTime:m,bookingType:h})=>({startTime:bi(p),endTime:bi(m),bookingType:h}))}}),l=Object.keys(o);for(let c of l)if(n!=null&&n[c])if(c==="dateAvailability"){let d=kY({dateAvailability:s});if(!d.valid&&d.error)return d;o.dateAvailability=s}else o[c]=n[c];let u=o;return a.courts.push(u),e||lt({payload:{venue:a,tournamentId:t.tournamentId},topic:pp,key:a.venueId}),{...J,court:Me(o),venueId:i}}}function px(t){let{tournamentRecord:e,venueId:i}=t;if(typeof i!="string"||!i)return{error:jc};let r=t.tournamentRecords??(e&&{[e.tournamentId]:e})??{},n=[],a;for(let o of Object.values(r)){let{venue:s}=eu({tournamentRecord:o,venueId:i});if(s){let l=ahe({...t,tournamentRecord:o});for(let u of(l==null?void 0:l.courts)??[])n.push(u==null?void 0:u.courtId);if(l.error)return l;a=!0}}return a?{...J,courtIds:n}:{error:Wm}}function ahe({courtNameRoot:t="Court",dateAvailability:e=[],venueAbbreviationRoot:i,tournamentRecord:r,courtNames:n=[],courtTimings:a,courtsCount:o,startTime:s,courtIds:l,endTime:u,idPrefix:c,venueId:d,dates:p}){if(!d)return{error:jc};let m=eu({tournamentRecord:r,venueId:d});if(m.error)return m;let{venue:h}=m;if(!Li(o)||!n)return{error:pH};o=o??n.length;let f=Se(0,o).map(g=>{let v=a==null?void 0:a[g],y=v?p.map(I=>({date:Bo(I),startTime:s,endTime:u,...v})):e;return v&&s&&u&&y.push({startTime:s,endTime:u}),{courtName:n[g]||i&&(h==null?void 0:h.venueAbbreviation)&&`${h==null?void 0:h.venueAbbreviation} ${g+1}`||`${t} ${g+1}`,dateAvailability:y}}).map((g,v)=>{let y=(l==null?void 0:l.pop())||c&&`${c}-${v+1}`;return jD({disableNotice:!0,tournamentRecord:r,courtId:y,venueId:d,court:g})}).map(g=>g.court).filter(Boolean);return f.length!==o?ee({info:"not all courts could be generated",result:{error:oe}}):(h&&lt({payload:{venue:h,tournamentId:r.tournamentId},topic:pp,key:h.venueId}),{...J,courts:Me(f)})}function mx({tournamentRecord:t,ignoreExistingVenues:e,venueProfiles:i,uuids:r}){let{startDate:n,endDate:a}=t,o=[];for(let[s,l]of i.entries()){let{venueAbbreviation:u,venueId:c=(r==null?void 0:r.pop())??Gt(),dateAvailability:d,startTime:p="07:00",endTime:m="19:00",courtTimings:h,courtsCount:f,courtNames:g,venueName:v,idPrefix:y,courtIds:I}=l,b={venueName:v||`Venue ${s+1}`,venueAbbreviation:u,venueId:c},S=rb({tournamentRecord:t,venue:b});if(S.error){if(e)continue;return S}o.push(c);let w=Rf(n,a),U=!Array.isArray(d)&&[{startTime:p,endTime:m}].concat(w.map(T=>({date:Bo(T),startTime:p,endTime:m})));if(f||g){let T=px({dateAvailability:d||U,tournamentRecord:t,courtTimings:h,courtsCount:f,courtNames:g,startTime:p,idPrefix:y,courtIds:I,endTime:m,venueId:c,dates:w});if(T.error)return T}}return o}function ohe(t){var c,d,p;let{tournamentRecord:e,leagueProfiles:i,eventIds:r,venueIds:n,drawIds:a,allUniqueParticipantIds:o,uuids:s}=t,l=0;for(let m of i){let h=[],{tieFormatName:f=gS,teamProfiles:g=[],teamsCount:v=0,category:y,idPrefix:I,gender:b}=m,S=m.leagueName??m.eventName??`League ${l+1}`,w=m.leagueId??m.eventId??(s==null?void 0:s.pop())??Gt();r.push(w);let U=Nt(m.tieFormat)&&m.tieFormat||bu({event:{eventId:w,category:y,gender:b},namedFormat:f,isMock:t.isMock})||void 0;if(!U)return{error:Rg};let T=Math.max(v,g.length),D=Se(0,T),{genders:P,teamSize:E}=ux({tieFormat:U,drawSize:T}),R={[pi]:0,[Bn]:0,[Ud]:0,[Jt]:0,[Ps]:0};Object.keys(P).forEach(A=>R[A]+=P[A]);for(let A of D){let M=((c=g==null?void 0:g[A])==null?void 0:c.teamName)??`Team ${A+1}`,C=((d=g==null?void 0:g[A])==null?void 0:d.teamId)||(s==null?void 0:s.pop())||Gt(),O=m.startDate??t.startDate,k=ev({...m==null?void 0:m.participantsProfile,participantsCount:E,consideredDate:O,gendersCount:R,category:y,gender:b,uuids:s}).participants,x=k.map(V=>V.participantId),F=Kt,$=C??VS({participantType:F,idPrefix:I,index:A,uuids:s});h.push({participantId:$,entryStatus:oa,entryStage:Oe});let _=((p=g==null?void 0:g[A])==null?void 0:p.venueIds)??[],L={participantId:$,participantRole:Qr,participantName:M,individualParticipantIds:x,participantType:F,homeVenueIds:_};_.forEach(V=>!n.includes(V)&&n.push(V)),o.push(...x),o.push($);let B=ts({participants:[L,...k],tournamentRecord:e});if(B.error)return B}let N={eventName:S,entries:h,eventType:Kt,tieFormat:U,category:y,eventId:w,gender:b};if(e.events||(e.events=[]),e.events.push(N),h.length){let A=(Li(m.roundsCount)&&m.roundsCount)??m.roundsCount===qae?(T-1)*2:T-1,M=Ab({automated:m.automated,tournamentRecord:e,drawType:La,roundsCount:A,drawSize:T,event:N});if(M.error)return M;let{drawDefinition:C}=M;if(C){let O=C==null?void 0:C.drawId;Ob({drawDefinition:C,event:N,suppressNotifications:!0}),a.push(O)}}l++}let u=n.map(m=>({venueId:m}));mx({tournamentRecord:e,ignoreExistingVenues:!0,venueProfiles:u,uuids:s})}var she=["Generated Tournament","CourtHive Challenge","Replication Crisis","Open Competition","Factory Follies","Mock Tournament","Atomic Culture","Racket Rally","Stats Fail"];function xY(t){var y,I,b;let{startDate:e,endDate:i}=t??{},{tournamentName:r=fa(she),ratingsParameters:n=Nr,tournamentExtensions:a,policyDefinitions:o,schedulingProfile:s,venueProfiles:l,uuids:u}=t??{},c=(t==null?void 0:t.isMock)===!1?void 0:!0;if(e&&!Ia(e)||i&&!Ia(i))return{error:Ar};if(t.leagueProfiles&&!Array.isArray(t.leagueProfiles)||t.eventProfiles&&!Array.isArray(t.eventProfiles)||t.drawProfiles&&!Array.isArray(t.drawProfiles))return{error:oe};if(!e){let S=new Date;e=Bo(i??S),i=Bo(S.setDate(S.getDate()+7))}if(!i){let S=new Date(e);i=Bo(S.setDate(S.getDate()+7))}let d=BD({...t.tournamentAttributes??{},tournamentName:r,startDate:e,endDate:i,isMock:c}),p=l!=null&&l.length?mx({tournamentRecord:d,venueProfiles:l,uuids:u}):[];if(a!=null&&a.length&&Array.isArray(a)){let S=a.filter(w=>il({extension:w}));S!=null&&S.length&&Object.assign(d,{extensions:S,isMock:c})}if(typeof o=="object")for(let S of Object.keys(o))Vd({policyDefinitions:{[S]:o[S]},tournamentRecord:d});if(!((y=t==null?void 0:t.leagueProfiles)!=null&&y.length)||(I=t.eventProfiles)!=null&&I.length||(b=t.drawProfiles)!=null&&b.length||t.participantsProfile){let S=DY({tournamentRecord:d,...t});if(!S.success)return S}let m=[],h=[],f=[];if(t.leagueProfiles){let S=ohe({allUniqueParticipantIds:m,tournamentRecord:d,...t,eventIds:h,venueIds:p,drawIds:f});if(S!=null&&S.error)return S}if(t.drawProfiles){let S=lhe({allUniqueParticipantIds:m,ratingsParameters:n,tournamentRecord:d,...t,eventIds:h,drawIds:f});if(S!=null&&S.error)return S}if(t.eventProfiles){let S=uhe({allUniqueParticipantIds:m,ratingsParameters:n,tournamentRecord:d,...t,eventIds:h,drawIds:f});if(S!=null&&S.error)return S}let{scheduledRounds:g=void 0,schedulerResult:v={}}=s?che({...t,tournamentRecord:d}):{};return _N(),Ge({...J,tournamentRecord:d,scheduledRounds:g,schedulerResult:v,eventIds:h,venueIds:p,drawIds:f})}function lhe(t){let{tournamentRecord:e,drawProfiles:i,allUniqueParticipantIds:r,eventIds:n,drawIds:a}=t,o=0;for(let s of i){let l=VD({allUniqueParticipantIds:r,tournamentRecord:e,drawProfile:s,drawIndex:o,...t});if(l.error)return l;let{drawId:u,eventId:c,event:d,uniqueParticipantIds:p}=l;if((s==null?void 0:s.addEvent)!==!1){if(l=Yg({suppressNotifications:!1,internalUse:!0,tournamentRecord:e,event:d}),l.error)return l;u&&a.push(u),n.push(c)}p!=null&&p.length&&r.push(...p),o+=1}}function uhe(t){let{eventProfiles:e,allUniqueParticipantIds:i,eventIds:r,drawIds:n}=t,a=0;for(let o of e){let s=AY({...t,eventIndex:a,eventProfile:o});if(s.error)return s;let{eventId:l,drawIds:u,uniqueParticipantIds:c}=s;u&&n.push(...u),r.push(l),c!=null&&c.length&&i.push(...c),a+=1}}function che(t){let{schedulingProfile:e,tournamentRecord:i,autoSchedule:r,periodLength:n,scheduleCompletedMatchUps:a}=t,o=ihe({schedulingProfile:e,tournamentRecord:i});if(o.error)return o;let s=o.scheduledRounds;if(r){let{tournamentId:l}=i,u={[l]:i};return{schedulerResult:$D({scheduleCompletedMatchUps:a,tournamentRecords:u,periodLength:n}),scheduledRounds:s}}return{scheduledRounds:s}}var FY={};yt(FY,{anonymizeTournamentRecord:()=>LY,modifyTournamentRecord:()=>_Y});function LY({keepExtensions:t=[],anonymizeParticipantNames:e=!0,tournamentRecord:i,tournamentName:r,personIds:n=[],tournamentId:a}){var k,x,F,$,_;if(!i)return{error:ge};let o=Array.isArray(t)?NB.concat(...t):NB,s=L=>{var B;return Array.isArray(t)?(B=L==null?void 0:L.extensions)==null?void 0:B.filter(V=>o.includes(V.name)):L==null?void 0:L.extensions},l={};i.extensions=s(i);let u=a||Gt();l[i.tournamentId]=u,i.tournamentId=u,i.createdAt=new Date().toISOString(),i.tournamentName=r||`Anonymized: ${Bo(new Date)}`,i.isMock=!0,delete i.parentOrganisation;for(let L of i.participants||[]){L.extensions=s(L),L.onlineResources=[];let B=Gt();l[L.participantId]=B,L.participantId=B}for(let L of i.participants||[])Array.isArray(L.individualParticipantIds)&&(L.individualParticipantIds=L.individualParticipantIds.map(B=>l[B]));let c=0;for(let L of i.venues||[]){L.venueAbbreviation=`V${c}`,L.extensions=s(L),L.venueName=`Venue #${c}`,L.onlineResources=[],L.addresses=[];let B=Gt();l[L.venueId]=B,L.isMock=!0,c+=1;let V=0;for(let G of L.courts||[])G.courtName=`V${c}C${V}`,G.extensions=s(G),G.onlineResources=[],G.isMock=!0,V+=1}let d=1;for(let L of i.events||[]){L.extensions=s(L),L.onlineResources=[],L.isMock=!0;let B=Gt();l[L.eventId]=B,L.eventId=B;let V=((k=L.category)==null?void 0:k.categoryName)||((x=L.category)==null?void 0:x.ageCategoryCode)||((F=L.category)==null?void 0:F.ratingType)||L.gender;if(L.eventName=`Event ${d} ${V}`,Array.isArray(L.entries))for(let j of L.entries)j.participantId=l[j.participantId];for(let j of L.drawDefinitions||[]){j.extensions=s(j);let z=Gt();if(l[j.drawId]=z,j.drawId=z,j.isMock=!0,Array.isArray(j.entries))for(let q of j.entries)q.participantId=l[q.participantId];let W=q=>{q.extensions=s(q);let Y=Gt();l[q.structureId]=Y,q.structureId=Y;for(let re of q.positionAssignments||[])re.participantId&&(re.participantId=l[re.participantId]);for(let re of q.seedAssignments||[])re.participantId&&(re.participantId=l[re.participantId]);for(let re of q.matchUps||[]){re.isMock=!0;for(let K of re.sides||[])K.lineUp&&(K.lineUp=K.lineUp.map(({participantId:H,collectionAssignments:Z})=>({participantId:l[H],collectionAssignments:Z})))}};for(let q of j.structures||[])if(W(q),Array.isArray(q.structures))for(let Y of q.structures)W(Y);for(let q of j.links||[])q.source.structureId=l[q.source.structureId],q.target.structureId=l[q.target.structureId]}let{extension:G}=gt({name:Qo,element:L});Array.isArray(($=G==null?void 0:G.value)==null?void 0:$.flights)&&((_=G==null?void 0:G.value.flights)==null||_.forEach(j=>{if(j.drawId=l[j.drawId],Array.isArray(j.drawEntries))for(let z of j.drawEntries)z.participantId=l[z.participantId]})),d+=1}let p=i.startDate||Bo(new Date),m=(i.participants||[]).filter(({participantType:L})=>L===St),h=m.reduce((L,B)=>{var G;let V=(G=B.person)==null?void 0:G.sex;return[Jt,pi].includes(V)?L[V]+=1:L[Ud]+=1,L},{[Jt]:0,[pi]:0,[Ud]:0}),f=Object.assign({},...Object.keys(h).map(L=>{var B;return{[L]:((B=TY({category:{ageCategoryCode:"O18"},count:h[L],addressProps:{citiesCount:10},personExtensions:[],consideredDate:p,sex:L}))==null?void 0:B.persons)||[]}})),g={[Jt]:0,[pi]:0,[Ud]:0},v=m.length,y=m.reduce((L,B)=>{var W,q;let V=((q=(W=B.person)==null?void 0:W.addresses)==null?void 0:q[0])||{},{city:G,state:j,postalCode:z}=V;return L.cities.includes(G)||L.cities.push(G),L.states.includes(j)||L.states.push(j),L.postalCodes.includes(z)||L.postalCodes.push(z),L},{cities:[],postalCodes:[],states:[]}),I=y.postalCodes.length,b=y.cities.length,S=y.states.length,{cities:w}=bY({count:b||v,participantsCount:v}),{states:U}=wY({count:S||v,participantsCount:v}),{postalCodes:T}=UY({count:I||v,participantsCount:v}),D={cities:w,states:U,postalCodes:T};m.forEach((L,B)=>{var q,Y;let V=L==null?void 0:L.person,G=(V==null?void 0:V.sex)||Ud,j=(q=pt(V==null?void 0:V.birthDate))==null?void 0:q.split("-")[0],z=g[G],W=f[G][z];if(g[G]+=1,j){let[,re,K]=((Y=W==null?void 0:W.birthDate)==null?void 0:Y.split("-"))||[],H=[j,re,K].join("-");W.birthDate=H}if(V!=null&&V.addresses){let re=SY({...D,participantIndex:B,nationalityCode:W.nationalityCode});W.addresses=[re]}W.personId=(n==null?void 0:n[B])||Gt(),e?(W.standardFamilyName=W.lastName,W.standardGivenName=W.firstName,L.participantName=`${W.standardGivenName} ${W.standardFamilyName}`):(W.standardFamilyName=V==null?void 0:V.standardFamilyName,W.standardGivenName=V==null?void 0:V.standardGivenName),delete W.firstName,delete W.lastName,W.extensions=s(V),L.person=W,l[V==null?void 0:V.personId]=W.personId}),(i.participants||[]).filter(({participantType:L})=>L===ht).forEach(L=>{let{individualParticipantIds:B}=L;L.participantName=dhe({individualParticipantIds:B,individualParticipants:m})});let P=(i.participants||[]).filter(({participantType:L})=>L===Kt),E=P.length,R=jS({count:E}).names;P.forEach((L,B)=>{L.participantName=R[B]});let N=(i.participants||[]).filter(({participantType:L})=>L===Wa),A=N.length,M=jS({count:A,nameRoot:"Group"}).names;N.forEach((L,B)=>{L.participantName=M[B]});let{extension:C}=gt({element:i,name:Sm});Array.isArray(C==null?void 0:C.value)&&(C==null||C.value.forEach(L=>{L.tournamentId=l[L.tournamentId],L.structureId=l[L.structureId],L.eventId=l[L.eventId],L.drawId=l[L.drawId]}));let{extension:O}=gt({element:i,name:xg});return Array.isArray(O==null?void 0:O.value)&&(O==null||O.value.forEach(L=>{L.personId=l[L.personId]})),{...J}}function dhe({individualParticipantIds:t,individualParticipants:e}){let i=e.filter(({participantId:r})=>t.includes(r)).map(({person:r})=>r==null?void 0:r.standardFamilyName).filter(Boolean).sort().join("/");return t.length===1&&(i+="/Unknown"),i}function _Y(t){var D,P,E;let{ratingsParameters:e=Nr,participantsProfile:i={},matchUpStatusProfile:r,completeAllMatchUps:n,autoEntryPositions:a,hydrateCollections:o,randomWinningSide:s,schedulingProfile:l,tournamentRecord:u,autoSchedule:c,eventProfiles:d,periodLength:p,venueProfiles:m,drawProfiles:h,isMock:f,uuids:g}=t;if(!u)return{error:ge};let v=[],y=[],I=[];d==null||d.forEach(R=>{var A;let N=(A=u.events)==null?void 0:A.find((M,C)=>R.eventIndex!==void 0&&C===R.eventIndex||R.eventName&&M.eventName===R.eventName||R.eventId&&M.eventId===R.eventId);N!=null&&N.gender&&(R.gender=N.gender)});let b=((D=u.participants)==null?void 0:D.length)||void 0;b&&(i!=null&&i.idPrefix)&&(i.idPrefix=`${i.idPrefix}-${b}`);let S=DY({startDate:u.startDate,participantsProfile:i,tournamentRecord:u,eventProfiles:d,drawProfiles:h,uuids:g});if(!S.success)return S;if(d){let R=((P=u.events)==null?void 0:P.length)||0;for(let N of d){let{ratingsParameters:A}=N,M=(E=u.events)==null?void 0:E.find((C,O)=>N.eventIndex!==void 0&&O===N.eventIndex||N.eventName&&C.eventName===N.eventName||N.eventId&&C.eventId===N.eventId);if(M){let{gender:C,category:O,eventType:k}=M,{drawProfiles:x,publish:F}=N,$=Yi(el)(k)&&St||Yi(uo)(k)&&ht||k;if(x){let{stageParticipantsCount:_,uniqueParticipantsCount:L,uniqueParticipantStages:B}=PY({drawProfiles:x,category:O,gender:C}),{uniqueDrawParticipants:V=[],uniqueParticipantIds:G=[]}=B?MY({event:{eventType:k,category:O,gender:C},uniqueParticipantsCount:L,participantsProfile:i,ratingsParameters:A,tournamentRecord:u,eventProfile:N,uuids:g}):{};v.push(...G);let{stageParticipants:j}=RY({targetParticipants:u.participants||[],allUniqueParticipantIds:v,stageParticipantsCount:_,eventParticipantType:$}),z=NY({uniqueDrawParticipants:V,autoEntryPositions:a,stageParticipants:j,tournamentRecord:u,drawProfiles:x,category:O,gender:C,event:M});if(z.error||(z=CY({matchUpStatusProfile:r,completeAllMatchUps:n,randomWinningSide:s,tournamentRecord:u,drawProfiles:x,isMock:f,event:M}),z.error))return z;I.push(...z.drawIds)}F&&Xg({tournamentRecord:u,event:M})}else{let C=AY({startDate:u.startDate,allUniqueParticipantIds:v,matchUpStatusProfile:r,participantsProfile:i,completeAllMatchUps:n,autoEntryPositions:a,randomWinningSide:s,ratingsParameters:A,tournamentRecord:u,eventProfile:N,eventIndex:R,uuids:g});if(C.error)return C;let{eventId:O,drawIds:k,uniqueParticipantIds:x}=C;k&&I.push(...k),y.push(O),x!=null&&x.length&&v.push(...x),R+=1}}}if(h){let R=(u.events||[]).map(N=>{var A;return((A=N.drawDefinitions)==null?void 0:A.map(()=>1))||[]}).flat().reduce((N,A)=>N+A,0);for(let N of h){let A=VD({startDate:u.startDate,allUniqueParticipantIds:v,matchUpStatusProfile:r,participantsProfile:i,completeAllMatchUps:n,autoEntryPositions:a,hydrateCollections:o,randomWinningSide:s,ratingsParameters:e,tournamentRecord:u,drawProfile:N,drawIndex:R,uuids:g});if(A.error)return A;let{drawId:M,eventId:C,event:O,uniqueParticipantIds:k}=A;if(A=Yg({tournamentRecord:u,event:O,internalUse:!0}),A.error)return A;M&&I.push(M),y.push(C),k!=null&&k.length&&v.push(...k),R+=1}}let w=m!=null&&m.length?mx({tournamentRecord:u,venueProfiles:m}):[],U,T={};if(l!=null&&l.length){let R={[u.tournamentId]:u},N=Wg({tournamentRecords:R,schedulingProfile:l});if(N.error)return N;if(c){let{tournamentId:A}=u,M={[A]:u};T=$D({tournamentRecords:M,periodLength:p})}}return{totalParticipantsCount:u.participants.length,scheduledRounds:U,schedulerResult:T,...J,eventIds:y,venueIds:w,drawIds:I}}var $Y={};yt($Y,{addDynamicRatings:()=>$O,addIndividualParticipantIds:()=>AD,addParticipant:()=>al,addParticipants:()=>ts,addPenalty:()=>o5,addPersonRequests:()=>zY,addPersons:()=>s5,createGroupParticipant:()=>JY,createTeamsFromParticipantAttributes:()=>lx,deleteParticipants:()=>lh,filterParticipants:()=>ub,findParticipant:()=>XY,getCompetitionParticipants:()=>ZO,getPairedParticipant:()=>es,getParticipantEventDetails:()=>ek,getParticipantMembership:()=>tk,getParticipantScaleItem:()=>Gf,getParticipantSchedules:()=>ik,getParticipantSignInStatus:()=>rk,getParticipantTimeItem:()=>OA,getParticipants:()=>Ni,getScaleValues:()=>kg,mergeParticipants:()=>a5,modifyIndividualParticipantIds:()=>WY,modifyParticipant:()=>OD,modifyParticipantName:()=>QY,modifyParticipantOtherName:()=>YY,modifyParticipantsSignInStatus:()=>qY,modifyPenalty:()=>r5,modifyPersonRequests:()=>GY,mutate:()=>BY,participantScaleItem:()=>Cl,query:()=>H6,regenerateParticipantNames:()=>KY,removeIndividualParticipantIds:()=>JA,removeParticipantIdsFromAllTeams:()=>BT,removePenalty:()=>t5,removePersonRequests:()=>HY,removeRatings:()=>e5,scaledTeamAssignment:()=>ZY,setParticipantScaleItem:()=>Pb,setParticipantScaleItems:()=>$3,validateLineUp:()=>jT});var BY={};yt(BY,{addDynamicRatings:()=>$O,addIndividualParticipantIds:()=>AD,addParticipant:()=>al,addParticipants:()=>ts,addPenalty:()=>o5,addPersonRequests:()=>zY,addPersons:()=>s5,createGroupParticipant:()=>JY,createTeamsFromParticipantAttributes:()=>lx,deleteParticipants:()=>lh,findParticipant:()=>XY,mergeParticipants:()=>a5,modifyIndividualParticipantIds:()=>WY,modifyParticipant:()=>OD,modifyParticipantName:()=>QY,modifyParticipantOtherName:()=>YY,modifyParticipantsSignInStatus:()=>qY,modifyPenalty:()=>r5,modifyPersonRequests:()=>GY,regenerateParticipantNames:()=>KY,removeIndividualParticipantIds:()=>JA,removeParticipantIdsFromAllTeams:()=>BT,removePenalty:()=>t5,removePersonRequests:()=>HY,removeRatings:()=>e5,scaledTeamAssignment:()=>ZY,setParticipantScaleItem:()=>Pb,setParticipantScaleItems:()=>$3});function VY(t=0){(typeof t!="number"||isNaN(t))&&(t=0);let e=new Date;return e.setHours(e.getHours()+t),e.getTime().toString(36).slice(-6).toUpperCase()}function jY({personRequests:t,personId:e,requests:i}){t[e]||(t[e]=[]);let r=i.filter(({requestType:n})=>n).map(n=>{let{date:a,startTime:o,endTime:s}=n;return n.requestType===_b&&(a=pt(a),o=bi(o),s=bi(s),a&&o&&s)?{date:a,startTime:o,endTime:s,requestType:n.requestType}:n}).filter(Boolean);for(let n of r)n.requestId=VY(),t[e].push(n);return{mergeCount:r.length}}function hx(t){let{tournamentRecords:e,personRequests:i}=t,r=ze(t,[{[pn]:!0}]);if(r.error)return r;if(!i)return{...J};let n=Object.values(e);for(let a of n){let o=a.participants??[],s=[];for(let l of Object.keys(i))if(Uc({tournamentParticipants:o,personId:l})){let u=i[l];u.length&&s.push({personId:l,requests:u})}Object.keys(s).length&&Lt({element:a,extension:{value:s,name:xg}})}return{...J}}function GY(t){let{tournamentRecords:e,requests:i,personId:r}=t,n=ze(t,[{[pn]:!0},{requests:!0,[Xn]:un,[_a]:oe}]);if(n.error)return n;let a=i.map(({requestId:u})=>u).filter(Boolean),{personRequests:o}=wp({tournamentRecords:e}),s=u=>{o&&(o[u]=o[u].map(c=>{if(!a.includes(c.requestId))return c;let d=i.find(p=>p.requestId===c.requestId);if(d.requestType)return Object.assign(c,d)}).filter(Boolean))};if(r&&(o!=null&&o[r]))s(r);else if(o)for(let u of Object.keys(o))s(u);let l=i.filter(u=>!u.requestId);return l.length&&jY({personRequests:o,personId:r,requests:l}),hx({tournamentRecords:e,personRequests:o})}function HY(t){let{tournamentRecords:e,requestType:i,requestId:r,personId:n,date:a}=t,o=ze(t,[{[pn]:!0}]);if(o.error)return o;let{personRequests:s}=wp({tournamentRecords:e}),l=c=>{var d;s&&(s[c]=s[c].filter(p=>(!i||p.requestType!==i)&&(!r||p.requestId!==r)&&(!a||p.date!==a)),(d=s==null?void 0:s[c])!=null&&d.length||delete s[c])},u=!i&&!r&&!n&&!a;if(!u){if(n&&(s!=null&&s[n]))l(n);else if(s)for(let c of Object.keys(s))l(c)}return u||!s||!Object.keys(s).length?Un({name:xg,tournamentRecords:e,discover:!0}):hx({tournamentRecords:e,personRequests:s})}function zY(t){let{tournamentRecords:e,personId:i,requests:r}=t,n=ze(t,[{[pn]:!0,[eoe]:!0},{requests:!0,[Xn]:un,[_a]:oe}]);if(n.error)return n;let{personRequests:a}=wp({tournamentRecords:e}),{mergeCount:o}=jY({personRequests:a,personId:i,requests:r});return o&&a?hx({tournamentRecords:e,personRequests:a}):{error:oe}}function WY({individualParticipantIds:t,groupingParticipantId:e,tournamentRecord:i}){let r="modifyIndividualParticipantIds";if(!i)return ee({result:{error:ge},stack:r});if(!e||!t)return ee({result:{error:Xe},stack:r});let n=i.participants||[],a=n.find(m=>m.participantId===e);if(!a)return ee({result:{error:zi},stack:r});if(![Kt,Wa].includes(a.participantType))return ee({result:{error:Ds},context:{participantType:a.participantType},stack:r});let o=t.filter(m=>{var h;return((h=n.find(f=>f.participantId===m))==null?void 0:h.participantType)!==St});if(o.length)return ee({result:{error:va,invalidParticipantIds:o},stack:r});let s=a.individualParticipantIds||[],l=t.filter(m=>!s.includes(m)),u=s.filter(m=>!t.includes(m)),c=AD({individualParticipantIds:l,groupingParticipantId:e,tournamentRecord:i});if(c.error)return ee({result:c,stack:r});let d=JA({individualParticipantIds:u,groupingParticipantId:e,tournamentRecord:i});if(d.error)return ee({result:d,stack:r});let{topics:p}=vo();if(p.includes(nn)){let m=n.find(({participantId:h})=>h===e);lt({topic:nn,payload:{tournamentId:i.tournamentId,participants:[m]}})}return{...c,...d}}function qY({tournamentRecord:t,participantIds:e,signInState:i}){if(!t)return{error:ge};if(!Array.isArray(e))return{error:Xe};if(![OI,bW].includes(i))return{error:oe,signInState:i};let r=t.participants||[];if(!r.length)return{error:My};let n=r.map(Ut),a=e.filter(u=>!n.includes(u));if(a.length)return{error:oe,context:{invalidParticipantIds:a}};let o=[],s=new Date().toISOString();for(let u of r){let{participantId:c}=u;if(e.includes(c)){let d=RO({duplicateValues:!1,tournamentRecord:t,participantId:c,timeItem:{itemType:zy,itemValue:i,createdAt:s}});if(d.error)return d;o.push(u)}}let{topics:l}=vo();return o.length&&l.includes(nn)&&lt({topic:nn,payload:{tournamentId:t.tournamentId,participants:o}}),{...J}}function YY({tournamentRecord:t,participantId:e,participantOtherName:i}){if(!t)return{error:ge};if(!e)return{error:pr};let{participant:r}=qc({tournamentRecord:t,participantId:e});if(!r)return{error:zi};r.participantOtherName=i;let{topics:n}=vo();return n.includes(nn)&&lt({topic:nn,payload:{tournamentId:t.tournamentId,participants:[r]}}),{...J}}function wV({personFormat:t,person:e}){let i=f=>f.replace(/\W/g,""),r=f=>/^[a-z]*$/.test(i(f)),n=f=>/^[A-Z]*$/.test(i(f)),a=f=>/^[LAST]{4}/.test(i(f)),o=f=>f.toLowerCase().indexOf("l")<f.toLowerCase().indexOf("f"),s=f=>f.indexOf(",")>=0,l=f=>f.toLowerCase().indexOf("f.")>=0,u=f=>f.toLowerCase().indexOf("f")<0,c=f=>f.indexOf(" ")>0;if(!e)return;let d=c(t)?" ":"",p=VC((e==null?void 0:e.standardGivenName)??""),m=VC((e==null?void 0:e.standardFamilyName)??"");if(!t)return`${p}${d}${m}`;l(t)&&!s(t)&&!o(t)&&(p=`${p[0]}.`),r(t)?(p=p.toLowerCase(),m=m.toLowerCase()):n(t)?(p=p.toUpperCase(),m=m.toUpperCase()):a(t)&&(m=m.toUpperCase());let h=`${p}${d}${m}`;return u(t)?h=m:o(t)&&(s(t)?h=`${m},${d}${p}`:h=`${m}${d}${p}`),h}function phe({participantMap:t,participant:e,formats:i}){let{participantType:r,individualParticipantIds:n,person:a}=e,o=r&&i[r];if(r!==Vn&&o){let{personFormat:s,doublesJoiner:l}=o;r===St&&(e.participantName=wV({person:a,personFormat:s})),r===ht&&(e.participantName=n==null?void 0:n.map(u=>{var d;let c=(d=t[u])==null?void 0:d.person;return wV({person:c,personFormat:s})}).filter(Boolean).join(l??"/"))}}function KY({tournamentRecord:t,formats:e}){if(!t)return{error:ge};if(!Nt(e))return{error:Xe};let i=t.participants??[],r=bG(i,"participantId");for(let n of i)phe({participant:n,participantMap:r,formats:e});return{...J}}function XY(t){let{tournamentRecord:e,policyDefinitions:i,contextProfile:r,participantId:n,personId:a}=t,o=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(typeof n!="string"&&typeof a!="string")return{error:Xe,stack:"publicFindParticipant"};let s,l;for(let u of Object.values(o)){l=u.tournamentId;let c=u.participants||[];if(s=Uc({tournamentParticipants:c,internalUse:!0,policyDefinitions:i,contextProfile:r,participantId:n,personId:a}),s)break}return{participant:s,tournamentId:l,...J}}function JY({individualParticipantIds:t=[],participantRoleResponsibilities:e,participantRole:i=lq,tournamentRecord:r,participantId:n,groupName:a}){if(!r)return{error:ge};if(!a)return{error:Xe,info:"Missing groupName"};if(!Array.isArray(t))return{info:"Invalid individualParticipantIds",error:oe};let o=(Ni({participantFilters:{participantTypes:[St]},tournamentRecord:r}).participants??[]).map(c=>c.participantId);for(let c of t)if(!o.includes(c))return{error:Ds,participantId:c};let s=Ge({participantId:n||Gt(),participantRoleResponsibilities:e,participantName:a,individualParticipantIds:t,participantType:Wa,participantRole:i}),l=al({participant:s,tournamentRecord:r});if(l.error)return l;let{topics:u}=vo();return u.includes(Tc)&&lt({topic:Tc,payload:{tournamentId:r.tournamentId,participants:[s]}}),{...J,participant:Me(s)}}function QY({tournamentRecord:t,participantName:e,participantId:i}){if(!t)return{error:ge};if(!i)return{error:pr};if(!e)return{error:Xe,info:"Missing participantName"};let{participant:r}=qc({tournamentRecord:t,participantId:i});if(!r)return{error:zi};r.participantName=e;let{topics:n}=vo();return n.includes(nn)&&lt({topic:nn,payload:{tournamentId:t.tournamentId,participants:[r]}}),{...J}}function ZY({clearExistingAssignments:t=!0,individualParticipantIds:e,reverseAssignmentOrder:i,initialTeamIndex:r=0,scaledParticipants:n=[],teamParticipantIds:a,tournamentRecord:o,scaleAttributes:s,teamNameBase:l,teamsCount:u,eventId:c,event:d}){var v,y,I,b,S;if(!o)return{error:ge};if(!Array.isArray(a)&&!ot(u)&&!c||!ot(r)||n&&!Array.isArray(n)||s&&(typeof s!="object"||!Object.keys(s).length))return{error:oe};if(!s&&!n.length||!n&&!(e&&s))return{error:Xe,info:"Missing scaling details"};if(c&&!a){if((d==null?void 0:d.eventType)!==Sa)return{error:Bl};a=(v=d==null?void 0:d.entries)==null?void 0:v.filter(({entryStatus:w})=>w===oa).map(Ut)}if(!(a!=null&&a.length)&&!u)return{info:"Missing teamParticipantIds or teamsCount",error:Xe};let p=e??n.map(({participantId:w})=>w);i&&(a==null||a.reverse(),r+=1),r>((a==null?void 0:a.length)||0)-1&&(r=0);let m=(a==null?void 0:a.slice(r).concat(...a.slice(0,r)))??[],h=[];for(let w of o.participants??[]){let{participantId:U,participantType:T}=w;if(m.includes(U)){if(T!==Vn)return{error:Ds,participant:w};h.push(w)}}if(u&&h.length<u){let w=u-((h==null?void 0:h.length)||0),U=l??"Team",T=Se(0,w).map(R=>({participantName:`${U} ${R+1}`,participantType:Vn,participantRole:Qr})),{participants:D=[]}=ts({participants:T,returnParticipants:!0,tournamentRecord:o}),P=D.map(Ut),E=((y=o.participants)==null?void 0:y.filter(({participantId:R})=>P.includes(R)))??[];h.push(...E)}if(!h.length)return{error:AN};if(t)for(let w of h)w.individualParticipantIds=[];else{let w=h.map(U=>U).flat();e!=null&&e.length?p=p.filter(U=>!w.includes(U)):n=n==null?void 0:n.filter(({participantId:U})=>!w.includes(U))}if(!(e!=null&&e.length)&&!(n!=null&&n.length))return{error:X0,info:"Nothing to be done"};if(!n.length){for(let w of o.participants??[]){let{participantId:U,participantType:T}=w;if(!p.includes(U))continue;if(T!==St)return{error:Ds,participant:w};let D=(I=Cl({scaleAttributes:s,participant:w}))==null?void 0:I.scaleItem,P=s!=null&&s.accessor?(b=D==null?void 0:D.scaleValue)==null?void 0:b[s==null?void 0:s.accessor]:D==null?void 0:D.scaleValue,E={participantId:U,scaleValue:P};n.push(E)}if(!n.length)return{error:zi}}n.sort((w,U)=>s!=null&&s.sortOrder?((U==null?void 0:U.scaleValue)||0)-((w==null?void 0:w.scaleValue)||0):((w==null?void 0:w.scaleValue)||1/0)-((U==null?void 0:U.scaleValue)||1/0));for(let w of n)if(!w.participantId)return{error:oe,scaledParticipant:w};let f=0;for(;f<n.length;){for(let w of h){if(f+1>n.length)break;let U=n[f];w.individualParticipantIds.push(U.participantId),f++}h.reverse()}let g=h.map(Ut);for(let w of o.events??[]){if(w.eventType!==Sa)continue;let U=(w.entries??[]).filter(T=>g.includes(T.participantId));for(let T of U){let D=T.participantId,P=(S=h.find(R=>R.participantId===D))==null?void 0:S.individualParticipantIds;w.entries=(w.entries??[]).filter(R=>!P.includes(R.participantId)),(w.drawDefinitions??[]).forEach(R=>{R.entries=(R.entries??[]).filter(N=>!P.includes(N.participantId))});let{flightProfile:E}=Gi({event:w});((E==null?void 0:E.flights)||[]).forEach(R=>{R.drawEntries=(R.drawEntries||[]).filter(N=>!P.includes(N.participantId))})}}return{...J,scaledParticipants:n}}function e5(t){let e=ze(t,[{[wr]:!0,[rA]:!0},{ratingType:!1,[Kr]:o=>Nr[o]}]);if(e.error)return e;let i=`${t.ratingType}.${sA}`,r=t.asDynamic?i:t.ratingType,n=[xd,gc,t.eventType,r].join("."),a=t.tournamentRecord.participants??[];for(let o of a)o.timeItems&&(o.timeItems=o.timeItems.filter(s=>s.itemType!==n));return{...J}}function t5(t){let{tournamentRecords:e}=t;if(typeof e!="object"||!Object.keys(e).length)return{error:ki};for(let i of Object.values(e)){let r=mhe({...t,tournamentRecord:i});if(r.error&&r.error!==Pf)return r}return{...J}}function mhe({tournamentRecord:t,penaltyId:e}){if(!t)return{error:ge};if(!e)return{error:RN};let i=(t==null?void 0:t.participants)??[],r=[],n=!1,a;return i.forEach(o=>{let s=!1;o.penalties=(o.penalties??[]).filter(l=>(l.penaltyId===e&&(s=!0,n||(a=l,n=!0)),s&&r.push(o),l.penaltyId!==e))}),a&&lt({topic:nn,payload:{tournamentId:t.tournamentId,participants:r}}),a?{...J,penalty:a}:{error:Pf}}var hhe=({penaltyId:t=Gt()}={})=>({refereeParticipantId:void 0,penaltyCode:void 0,penaltyType:void 0,extensions:void 0,matchUpId:void 0,createdAt:void 0,issuedAt:void 0,notes:void 0,penaltyId:t}),i5=hhe;function r5(t){let{tournamentRecords:e}=t;if(typeof e!="object"||!Object.keys(e).length)return{error:ki};for(let i of Object.values(e)){let r=fhe({...t,tournamentRecord:i});if(r.error&&r.error!==Pf||r.success)return r}return{error:Pf}}function fhe({tournamentRecord:t,modifications:e,penaltyId:i}){if(!t)return{error:ge};if(!e)return{error:oe,modifications:e};if(!i)return{error:RN};let r=(t==null?void 0:t.participants)??[],n=Object.keys(i5()).filter(l=>l!=="penaltyId"),a=Object.keys(e).filter(l=>n.includes(l));if(!a.length)return{error:J0};let o,s=[];return r.forEach(l=>{let u=!1;l.penalties=(l.penalties??[]).map(c=>(c.penaltyId===i&&(u=!0,a.forEach(d=>Object.assign(c,{[d]:e[d]})),o||(o=c)),c)),u&&s.push(l)}),o&&lt({topic:nn,payload:{tournamentId:t.tournamentId,participants:s}}),o?{...J,penalty:o}:{error:Pf}}function n5(t,e,i){return!t&&e?e:t&&!e||typeof t!="object"||typeof e!="object"?t:ct(Object.keys(t).concat(Object.keys(e))).reduce((r,n)=>{if(!e[n])r[n]=t[n];else if(!t[n])r[n]=e[n];else if(typeof t[n]!=typeof e[n])r[n]=e[n];else if(Array.isArray(t[n]))if(i===!0||Array.isArray(i)&&i.includes(n)){let a=ct(t[n].map(o=>JSON.stringify(o)).concat(e[n].map(o=>JSON.stringify(o)))).map(o=>JSON.parse(o));r[n]=a}else r[n]=e[n];else typeof t[n]=="object"?r[n]=n5(t[n],e[n],i):r[n]=e[n];return r},{})}function a5({participants:t=[],tournamentRecord:e,arraysToMerge:i}){if(!e)return{error:ge};e.participants||(e.participants=[]);let r=t.filter(Ta(Hl)).map(u=>({[u.participantId]:u})),n=Object.assign({},...r),a=[];e.participants=e.participants.map(u=>{if(n[u.participantId]){let c=n5(u,n[u.participantId],i);return a.push(c),c}return u});let o=e.participants.map(Ta(Hl))||[],s=t.filter(({participantId:u})=>!o.includes(u)),{topics:l}=vo();return s.length&&(e.participants=e.participants.concat(...s),l.includes(Tc)&&lt({topic:Tc,payload:{participants:s}})),a.length&&l.includes(nn)&&lt({topic:nn,payload:{tournamentId:e.tournamentId,participants:a}}),{modifiedParticipantsCount:a.length,newParticipantsCount:s.length,...J}}function o5(t){var a;let{tournamentRecord:e,participantIds:i}=t,r=t.tournamentRecords??(e&&{[e.tournamentId]:e})??{},n;for(let o of Object.values(r)){let s=(a=Ni({tournamentRecord:o}).participants??[])==null?void 0:a.map(Ut).filter(l=>i.includes(l));s.length&&(n=ghe({...t,penaltyId:t.penaltyId??n,tournamentRecord:o,participantIds:s}).penaltyId)}return n?{...J,penaltyId:n}:{error:zi}}function ghe({refereeParticipantId:t,tournamentRecord:e,participantIds:i,penaltyCode:r,penaltyType:n,extensions:a,penaltyId:o,matchUpId:s,issuedAt:l,notes:u}){if(!e)return{error:ge};if(!i)return{error:pr};if(!n)return{error:dH};let c=((e==null?void 0:e.participants)??[]).filter(m=>i.includes(m.participantId));if(!c.length)return{error:zi};let d=new Date().toISOString(),p=Object.assign(i5({penaltyId:o}),{refereeParticipantId:t,penaltyCode:r,penaltyType:n,matchUpId:s,createdAt:d,issuedAt:l,notes:u});return Array.isArray(a)&&a.forEach(m=>Lt({element:p,extension:m})),c.forEach(m=>{m.penalties||(m.penalties=[]),m.penalties.push(p)}),lt({topic:nn,payload:{tournamentId:e.tournamentId,participants:c}}),{...J,penaltyId:p.penaltyId}}function s5({participantRole:t=Qr,tournamentRecord:e,persons:i}){var h;if(!e)return{error:ge};if(!Array.isArray(i))return{error:oe};if(!Object.keys(XA).includes(t))return{error:eH};let r=(e.participants||[]).map(({person:f})=>f==null?void 0:f.personId).filter(Boolean),n=[],a=i.filter(f=>f&&(!f.personId||!r.includes(f.personId))).map(f=>(f.personId||(f.personId=Gt()),n.push(f.personId),f)),o=(f,g)=>Object.assign({},...Object.keys(f).filter(v=>!g.includes(v)).map(v=>({[v]:f[v]}))),s=a.map(f=>Ge({extensions:f.participantExtensions,timeItems:f.participantTimeItems,participantType:St,participantRole:t,person:o(f,["participantExtensions","participantTimeItems","pairedPersons"])})),l=0,u=0,c=ts({participants:s,tournamentRecord:e});if(c.error)return c;u=c.addedCount||0;let d=[],p=((h=Ni({participantFilters:{participantTypes:[St]},tournamentRecord:e}))==null?void 0:h.participants)??[];if(t===Qr&&i.filter(({pairedPersons:f})=>f).forEach(({personId:f,pairedPersons:g})=>{Array.isArray(g)&&g.forEach(v=>{let y=[f,v.personId].map(I=>Uc({tournamentParticipants:p,personId:I})).filter(Boolean);if(y.length===2){let I=y.map(Ut);d.push(Ge({extensions:v.participantExtensions,timeItems:v.timeItems,participantRole:Qr,individualParticipantIds:I,participantType:ht}))}})}),d.length){if(c=ts({participants:d,tournamentRecord:e}),c.error)return c;l=c.addedCount||0}let m=u+l;return{...J,addedCount:m,newPersonIds:n}}var l5={};yt(l5,{bulkUpdatePublishedEventIds:()=>dk,getAllEventData:()=>pk,getCourtInfo:()=>xT,getDrawData:()=>mD,getEventData:()=>hD,getEventPublishStatus:()=>Uo,getPublishState:()=>sh,getTournamentPublishStatus:()=>lb,getVenueData:()=>$f,mutate:()=>u5,publishEvent:()=>Xg,publishEventSeeding:()=>c5,publishOrderOfPlay:()=>f5,publishParticipants:()=>h5,query:()=>X6,setEventDisplay:()=>RD,unPublishEvent:()=>g5,unPublishEventSeeding:()=>d5,unPublishOrderOfPlay:()=>m5,unPublishParticipants:()=>p5});var u5={};yt(u5,{publishEvent:()=>Xg,publishEventSeeding:()=>c5,publishOrderOfPlay:()=>f5,publishParticipants:()=>h5,setEventDisplay:()=>RD,unPublishEvent:()=>g5,unPublishEventSeeding:()=>d5,unPublishOrderOfPlay:()=>m5,unPublishParticipants:()=>p5});function c5({removePriorValues:t=!0,stageSeedingScaleNames:e,seedingScaleNames:i,tournamentRecord:r,status:n=qa,drawIds:a=[],event:o}){var d,p,m,h;if(!r)return{error:ge};if(!o)return{error:gi};let s=Uo({event:o,status:n}),l=(((d=s==null?void 0:s.seeding)==null?void 0:d.seedingScaleNames)||i)&&{...(p=s==null?void 0:s.seeding)==null?void 0:p.seedingScaleNames,...i},u=(((m=s==null?void 0:s.seeding)==null?void 0:m.stageSeedingScaleNames)||e)&&{...(h=s==null?void 0:s.seeding)==null?void 0:h.stageSeedingScaleNames,...e},c=Ge({stageSeedingScaleNames:u,seedingScaleNames:l,published:!0,drawIds:a});return Kg({statusObject:{seeding:c},removePriorValues:t,status:n,event:o}),lt({topic:fW,payload:{tournamentId:r.tournamentId,eventId:o.eventId,drawIds:a}}),{...J}}function d5({removePriorValues:t=!0,seedingScaleNames:e,tournamentRecord:i,status:r=qa,drawIds:n,stages:a,event:o}){var l,u;if(!i)return{error:ge};if(!o)return{error:gi};let s=Uo({event:o});if(s){let c=s.seeding;if(Array.isArray(a)&&c.stageSeedingScaleNames)for(let d of a)c.stageSeedingScaleNames[d]&&delete c.stageSeedingScaleNames[d];Array.isArray(e)&&(c!=null&&c.seedingScaleNames)&&(c.seedingScaleNames=c.seedingScaleNames.filter(d=>!e.includes(d))),Array.isArray(n)&&(c!=null&&c.drawIds)&&(c.drawIds=c.drawIds.filter(d=>!n.includes(d))),(!Object.values(c.stageSeedingScaleNames??{}).length&&!((l=c.seedingScaleNames)!=null&&l.length)&&!((u=c.drawIds)!=null&&u.length)||!a&&!e&&!(n!=null&&n.length))&&(delete c.stageSeedingScaleNames,delete c.seedingScaleNames,delete c.drawIds,c.published=!1),Kg({statusObject:{seeding:c},removePriorValues:t,status:r,event:o})}return lt({topic:CA,payload:{tournamentId:i.tournamentId,eventId:o.eventId}}),{...J}}function p5(t){let e=Io(t);if(!Object.keys(e).length)return{error:ki};for(let i of Object.values(e)){let r=vhe({tournamentRecord:i,...t});if(r.error)return r}return{...J}}function vhe({removePriorValues:t=!0,tournamentRecord:e,status:i=qa}){if(!e)return{error:ge};let r=`${Yc}.${Kc}`,{timeItem:n}=yo({element:e,itemType:r}),a=(n==null?void 0:n.itemValue)||{[i]:{}};return a[i]&&delete a[i].participants,vl({timeItem:{itemValue:a,itemType:r},element:e,removePriorValues:t}),lt({payload:{tournamentId:e.tournamentId},topic:Coe}),{...J}}function m5(t){let e=Io(t);if(!Object.keys(e).length)return{error:ki};for(let i of Object.values(e)){let r=Ihe({tournamentRecord:i,...t});if(r.error)return r}return{...J}}function Ihe({removePriorValues:t=!0,tournamentRecord:e,status:i=qa}){if(!e)return{error:ge};let r=`${Yc}.${Kc}`,{timeItem:n}=yo({element:e,itemType:r}),a=(n==null?void 0:n.itemValue)||{[i]:{}};return a[i]&&delete a[i].orderOfPlay,vl({timeItem:{itemValue:a,itemType:r},element:e,removePriorValues:t}),lt({topic:MA,payload:{tournamentId:e.tournamentId}}),{...J}}function h5(t){let e=Io(t);if(!Object.keys(e).length)return{error:ki};for(let i of Object.values(e)){let r=yhe({tournamentRecord:i,...t});if(r.error)return r}return{...J}}function yhe({removePriorValues:t,tournamentRecord:e,status:i=qa}){if(!e)return{error:ge};let r=`${Yc}.${Kc}`,{timeItem:n}=yo({element:e,itemType:r}),a=(n==null?void 0:n.itemValue)||{[i]:{}};return a[i].participants={published:!0},vl({timeItem:{itemValue:a,itemType:r},element:e,removePriorValues:t}),lt({payload:{tournamentId:e.tournamentId},topic:vW}),{...J}}function f5(t){let e=Io(t);if(!Object.keys(e).length)return{error:ki};for(let i of Object.values(e)){let r=bhe({tournamentRecord:i,...t});if(r.error)return r}return{...J}}function bhe({scheduledDates:t=[],removePriorValues:e,tournamentRecord:i,status:r=qa,eventIds:n=[]}){if(!i)return{error:ge};let a=`${Yc}.${Kc}`,{timeItem:o}=yo({element:i,itemType:a}),s=(o==null?void 0:o.itemValue)||{[r]:{}};return s[r].orderOfPlay={published:!0,scheduledDates:t,eventIds:n},vl({timeItem:{itemValue:s,itemType:a},element:i,removePriorValues:e}),lt({topic:gW,payload:{tournamentId:i.tournamentId,scheduledDates:t,eventIds:n}}),{...J}}function g5({removePriorValues:t=!0,tournamentRecord:e,status:i=qa,event:r}){if(!e)return{error:ge};if(!r)return{error:gi};let n=`${Yc}.${Kc}`,{timeItem:a}=Wy({itemType:n,event:r}),o=(a==null?void 0:a.itemValue)||{[i]:{}};return delete o[i].structureIds,delete o[i].drawDetails,delete o[i].drawIds,dh({event:r,timeItem:{itemValue:o,itemType:n},removePriorValues:t}),Kg({statusObject:{structureIds:void 0,drawIds:void 0,seeding:void 0},removePriorValues:t,status:i,event:r}),lt({topic:EA,payload:{tournamentId:e.tournamentId,eventId:r.eventId}}),{eventId:r.eventId,...J}}var v5={};yt(v5,{getEntryStatusReports:()=>Uhe,getParticipantStats:()=>whe,getStructureReports:()=>The,getVenuesReport:()=>Phe});function whe({withCompetitiveProfiles:t,opponentParticipantId:e,withIndividualStats:i,teamParticipantId:r,tournamentRecord:n,withScaleValues:a,tallyPolicy:o,matchUps:s}){var U,T,D,P,E;if(!n)return{error:ge};if(s&&!Array.isArray(s))return{error:aa};if(s=s??Vr({tournamentRecord:n,participantsProfile:a?{withScaleValues:a}:void 0}).matchUps,!(s!=null&&s.length))return{error:ju};let l=[];e&&l.push(e),r&&l.push(r);let u=l.length?{participantIds:l}:{participantTypes:[Vn]},c=Ni({participantFilters:u,tournamentRecord:n}).participants??[];if(!c.every(({participantType:R})=>R===Vn))return{error:va};l.length||l.push(...c.map(Ut));let d=new Map,p=new Map,m=new Map,h=new Map,f=(R,N="")=>p.get(R)||p.set(R,{participantName:N,participantId:R,competitorIds:[],competitiveness:{},matchUpStatuses:{},tiebreaks:[0,0],matchUps:[0,0],points:[0,0],games:[0,0],sets:[0,0]})&&p.get(R);for(let R of c){let{participantId:N,individualParticipantIds:A}=R;h.set(N,A??[]),f(N,R.participantName)}if(r&&!h.get(r))return ee({result:{error:zi},context:{teamParticipantId:r}});if(e&&!h.get(e))return ee({result:{error:zi},context:{opponentParticipantId:e}});let g=[],v=R=>{let N=[[],[]];for(let M of R){let C=M.participant;if(C!=null&&C.participantName){d.set(C.participantId,{participantName:C.participantName,ratings:C.ratings});let O=p.get(C.participantId);O&&(O.participantName=C.participantName)}}let A=({side:M,individualParticipantIds:C})=>{var O,k,x,F,$;return M.participantId&&(!(C!=null&&C.length)||C.includes(M.participantId))&&[M.participantId]||((k=(O=M.participant)==null?void 0:O.individualParticipantIds)==null?void 0:k.length)&&(!(C!=null&&C.length)||Vi(C,(x=M.participant)==null?void 0:x.individualParticipantIds).length===(($=(F=M.participant)==null?void 0:F.individualParticipantIds)==null?void 0:$.length))&&M.participant.individualParticipantIds};if(h.size){let M=(C,O)=>{for(let k of R){if(!k.participant)continue;let x=A({individualParticipantIds:O,side:k});if(x!=null&&x.length){let F=k.sideNumber;if(!F)continue;let $=[C];i&&$.push(...x),N[F-1]=$;let _=p.get(C);for(let L of x.filter(Boolean))_&&!_.competitorIds.includes(L)&&_.competitorIds.push(L)}}};if(r)(!e||R.every(C=>C.participant&&(A({individualParticipantIds:h.get(r),side:C})||A({individualParticipantIds:h.get(e),side:C}))))&&M(r,h.get(r));else for(let[C,O]of h)M(C,O)}else if(i)for(let M of R){if(!M.participant)continue;let C=A({individualParticipantIds:[],side:M}),O=M.sideNumber;O&&(N[O-1]=C)}return N};for(let R of s){if(!Nt(R))return{error:aa};let{matchUpStatus:N,matchUpFormat:A,matchUpType:M,winningSide:C,score:O,sides:k}=R;if(!k||!O||M===ka||N===Vt)continue;let x=v(k);if(!x.filter(Boolean).length)continue;let F=t&&C&&((U=tb({matchUp:R}))==null?void 0:U.competitiveness);g.push(R);let $=bO({matchUpStatus:N,matchUpFormat:A,tallyPolicy:o,winningSide:C,score:O}),_=i3({matchUpStatus:N,matchUpFormat:A,tallyPolicy:o,winningSide:C,score:O}),{pointsTally:L,tiebreaksTally:B}=r3({matchUpFormat:A,score:O});x.forEach((V,G)=>{var j;for(let z of V){let W=(j=d.get(z))==null?void 0:j.participantName,q=f(z,W);if(q){let Y=(X,ie)=>ie.forEach((ae,le)=>q[X][le]+=ae),re=G?[...B].reverse():B,K=G?[...L].reverse():L,H=G?[..._].reverse():_,Z=G?[...$].reverse():$;if(Y("tiebreaks",re),Y("points",K),Y("games",H),Y("sets",Z),C){let X=C-1===G?0:1;q.matchUps[X]+=1}if(F){let X=F.toLowerCase();q.competitiveness[X]||(q.competitiveness[X]=[0,0]),q.competitiveness[X][G]+=1}if(N){let X=N.toLowerCase();q.matchUpStatuses[X]||(q.matchUpStatuses[X]=0),q.matchUpStatuses[X]+=1}}}})}let y=["tiebreaks","matchUps","points","games","sets"],I=["competitive","routine","decisive"],b=new Map,S=(R,N)=>(R??0)+(N??0);for(let[R,N]of p.entries()){for(let A of y){let M=N[A].reduce(S);if(M){let C=N[A][0]/M,O=`${A}Ratio`,k=parseFloat(C.toFixed(2));N[O]=k,m.set(R,!0),b.has(O)||b.set(O,[]),(T=b.get(O))==null||T.push(k)}}for(let A of I){let M=(P=(D=N.competitiveness)==null?void 0:D[A])==null?void 0:P.reduce(S);if(M){let C=N.competitiveness[A][0]/M,O=`${A}Ratio`,k=parseFloat(C.toFixed(2));N[O]=k}}}if(!r){let R=(N,A)=>A-N;for(let N of p.values())for(let A of y){let M=`${A}Ratio`;if(typeof N[M]=="number"){let C=(E=b.get(M))==null?void 0:E.sort(R).indexOf(N[M]);if(typeof C=="number"&&C>=0){let O=`${A}Rank`;N[O]=C+1}}}}let w={relevantMatchUps:g,...J};return r?(w.teamStats=p.get(r),e&&(w.opponentStats=p.get(e))):w.participatingTeamsCount=m.size,w.allParticipantStats=[...p.values()],w}function zS({participant:t,eventType:e}){var u,c,d,p,m,h;let i=(u=t==null?void 0:t.person)==null?void 0:u.personId,r=(d=(c=t==null?void 0:t.person)==null?void 0:c.personOtherIds)==null?void 0:d[0],n=(p=t==null?void 0:t.person)==null?void 0:p.tennisId,a=(h=(m=t==null?void 0:t.ratings)==null?void 0:m[e])==null?void 0:h.find(({scaleName:f})=>f===yO),o=a==null?void 0:a.scaleValue,{wtnRating:s,confidence:l}=o||{};return{timeStamp:a==null?void 0:a.scaleDate,personOtherId:r,confidence:l,wtnRating:s,personId:i,tennisId:n}}function Uhe({tournamentRecord:t}){if(!t)return{error:ge};let e=t.tournamentId,{participantMap:i}=Ni({withScaleValues:!0,withEvents:!0,withSeeding:!0,tournamentRecord:t,withDraws:!0}),r=(Vr({matchUpFilters:{matchUpTypes:[qp,Md]},tournamentRecord:t}).matchUps??[]).flatMap(({sides:m,matchUpType:h})=>m==null?void 0:m.flatMap(f=>{var g,v;return h===Md?(g=f==null?void 0:f.participant)==null?void 0:g.individualParticipantIds:((v=f==null?void 0:f.participant)==null?void 0:v.participantId)||f.participantId}).filter(Boolean)).filter(Boolean),n=[],a={},o={},s={},l=0,u=({id:m,entry:h,eventId:f,eventType:g})=>{var P;let{qualifyingSeeding:v,mainSeeding:y,entryStatus:I,entryStage:b,drawId:S}=h;a[m]||(a[m]=[]);let{participant:w,events:U}=(i==null?void 0:i[m])??{},T=zS({participant:w,eventType:g}),D=(P=U==null?void 0:U[f])==null?void 0:P.ranking;I===hO&&n.push(m),a[m].push({participantType:w==null?void 0:w.participantType,participantId:m,tournamentId:e,eventType:g,eventId:f,drawId:S,entryStatus:I,entryStage:b,...T,ranking:D,mainSeeding:y,qualifyingSeeding:v})};for(let m of t.events??[]){let h={},f=U=>{h[U]||(h[U]={count:0}),h[U].count+=1},{drawDefinitions:g=[],eventType:v,eventId:y}=m,I=g.flatMap(U=>{let{drawId:T,entries:D}=U;l+=1;let P=({stage:A,stageSequence:M})=>A===Oe&&M===1||A===Ye,E=(U.structures??[]).filter(P).flatMap(({positionAssignments:A})=>A).filter(Boolean).map(({participantId:A})=>A),R=({participantId:A})=>E.includes(A),N=A=>{var x,F,$,_,L,B,V,G;let{participantId:M,entryStatus:C,entryStage:O}=A;f(C);let k=(_=($=(F=(x=i==null?void 0:i[M])==null?void 0:x.draws)==null?void 0:F[T])==null?void 0:$.seedAssignments)==null?void 0:_[Oe];return{qualifyingSeeding:(G=(V=(B=(L=i==null?void 0:i[M])==null?void 0:L.draws)==null?void 0:B[T])==null?void 0:V.seedAssignments)==null?void 0:G[Ye],participantId:M,mainSeeding:k,entryStatus:C,entryStage:O,drawId:T}};return D==null?void 0:D.filter(R).map(N)}),b=U=>{var P;let T=U.participantId,D=(P=i==null?void 0:i[T].participant.individualParticipantIds)==null?void 0:P.filter(E=>r.includes(E));return T&&{[T]:{individualParticipantIds:D}}};v===wu?(()=>{let U=Object.assign({},...I.map(b).filter(Boolean)),T=D=>{U[D.participantId].individualParticipantIds.forEach(P=>{u({id:P,eventType:v,eventId:y,entry:D})})};I.forEach(T)})():I.forEach(U=>{u({id:U==null?void 0:U.participantId,eventType:v,eventId:y,entry:U})});let S=Object.values(h).reduce((U,T)=>U+T.count,0);Object.keys(h).forEach(U=>{h[U].pct=h[U].count/S*100}),s[y]={tournamentId:e,eventId:y,entries:I,entryStatuses:h};let w=Object.assign({},...ls.flatMap(U=>{var T,D;return[{[U+"_count"]:(T=h[U])==null?void 0:T.count},{[U+"_pct"]:(D=h[U])==null?void 0:D.pct}]}));o[y]={tournamentId:e,eventId:y,...w}}let c=Object.values(i??{}).filter(({participant:{participantType:m,participantRole:h}})=>m===St&&h===Qr),d=c.filter(({participant:m})=>!r.includes(m.participantId)).map(({participant:m})=>m.participantId),p={nonParticipatingEntriesCount:d.length,individualParticipantsCount:c.length,eventsCount:Object.values(s).length,nonParticipatingParticipantIds:d,drawDefinitionsCount:l,tournamentId:e};return{entryStatusReports:Object.values(o).flat(),participantEntryReports:Object.values(a).flat(),eventReports:Object.values(s).flat(),withDrawnParticipantIds:n,tournamentEntryReport:p}}function She({eventType:t,matchUps:e,eventId:i,drawId:r}){let n={},a=h=>{let f=h==null?void 0:h.matchUpFormat;f&&(n[f]||(n[f]=0),n[f]+=1)},o=e.filter(h=>i?h.eventId===i:h.drawId===r).reduce((h,f)=>(a(f),(f.sides??[]).flatMap(g=>{var v;return(((v=g==null?void 0:g.participant)==null?void 0:v.individualParticipants)||[g==null?void 0:g.participant]).filter(Boolean)}).forEach(g=>h[g.participantId]=g),h),{}),s=Object.values(o),l=s.map(h=>zS({participant:h,eventType:t})).filter(({wtnRating:h})=>h),u=(s.length-l.length)/s.length*100,c=l.reduce((h,f)=>{let{wtnRating:g,confidence:v}=f;return h.totalWTN+=g,h.totalConfidence+=v,h},{totalWTN:0,totalConfidence:0}),d=l!=null&&l.length?c.totalWTN/l.length:0,p=l!=null&&l.length?c.totalConfidence/l.length:0,m=Object.values(n).reduce((h,f)=>h+(f||0),0);return{matchUpFormatCounts:n,matchUpsCount:m,avgConfidence:p,pctNoRating:u,avgWTN:d}}function The(t){var h;let{tournamentRecord:e,extensionProfiles:i,firstFlightOnly:r}=t;if(!e)return{error:Tf};let n=[],a={},o={},s=[],l=Object.assign({},...(i??[]).map(({name:f,label:g,accessor:v})=>{var b,S,w;let y=(S=(b=gt({element:e,name:f}))==null?void 0:b.extension)==null?void 0:S.value,I=v?(w=Jp({element:y,accessor:v}))==null?void 0:w.value:y;return{[g||f]:I}})),u=e==null?void 0:e.tournamentId,c=Vr({participantsProfile:{withScaleValues:!0},tournamentRecord:e}).matchUps??[],d=f=>{var g,v,y;return(y=(v=(g=yo({itemType:vA,itemSubTypes:[Rl],element:{timeItems:f}}))==null?void 0:g.timeItem)==null?void 0:v.itemValue)==null?void 0:y.scaleBasis},p=({positionManipulations:f})=>{f==null||f.forEach(g=>{let{structureId:v,name:y}=g,I=g.drawPositions||[g.drawPosition];a[v]||(a[v]=[]),a[v].push(`${y}: ${I.join("/")}`)})},m=(h=e==null?void 0:e.events)==null?void 0:h.flatMap(({timeItems:f,drawDefinitions:g=[],extensions:v,eventType:y,eventName:I,eventId:b,category:S})=>{var A,M,C,O;let w=(C=(M=(A=v==null?void 0:v.find(k=>k.name===Qo))==null?void 0:A.value)==null?void 0:M.flights)==null?void 0:C.map(k=>({[k.drawId]:k.flightNumber})),U=w&&Object.assign({},...w),T=v==null?void 0:v.find(k=>k.name===Pd),D=f==null?void 0:f.find(k=>k.itemType===Pd),P=((O=T==null?void 0:T.value)==null?void 0:O.length)||(D==null?void 0:D.itemValue)||0,E=Object.values(U??{}),R=U&&Math.min(...E),N=d(f);return o[b]={seedingBasis:N?JSON.stringify(N):void 0,totalPositionManipulations:0,maxPositionManipulations:0,generatedDrawsCount:0,drawDeletionsCount:P,tournamentId:u,eventId:b},g.filter(k=>!r||!w||U[k.drawId]===R).flatMap(k=>{let{matchUpFormat:x,tieFormat:F,timeItems:$,extensions:_,structures:L,drawName:B,drawType:V,drawId:G}=k,{matchUpFormatCounts:j,matchUpsCount:z,avgConfidence:W,pctNoRating:q,avgWTN:Y}=She({eventType:y,matchUps:c,drawId:G}),re=d($)||N,K=Dhe({extensions:_}),H=(K==null?void 0:K.length)||0;return p({positionManipulations:K}),o[b].totalPositionManipulations+=H,o[b].generatedDrawsCount+=1,H>o[b].maxPositionManipulations&&(o[b].maxPositionManipulations=H),L==null?void 0:L.filter(Z=>Z.stageSequence===1&&[Ye,Oe,rn,$i].includes(Z.stage)).map(Z=>{var Be,nt,Ii;let X=[Oe,$i].includes(Z.stage)?c.find(be=>be.structureId===Z.structureId&&be.finishingRound===1&&be.winningSide):void 0;Z.stage===Oe&&n.push({eventName:I,drawName:B,structureId:Z.structureId});let ie=(nt=(Be=X==null?void 0:X.sides)==null?void 0:Be.find(be=>be.sideNumber===X.winningSide))==null?void 0:nt.participant,ae=(ie==null?void 0:ie.participantType)===Vn&&ie.participantId,le=(ie==null?void 0:ie.participantType)===ht?ie.individualParticipants:[],ne=zS({participant:(le==null?void 0:le[0])||ie,eventType:y}),{personId:de,personOtherId:ye,tennisId:ce,confidence:ke,wtnRating:Pe}=ne||{},it=zS({participant:le==null?void 0:le[1],eventType:y}),{personId:It,personOtherId:me,tennisId:fe,confidence:pe,wtnRating:Fe}=it||{},{ageCategoryCode:De,categoryName:je,subType:ue}=S??{},he=Z.matchUpFormat||x,Re=(j[he]||0)/z*100,{tieFormatName:xe,tieFormatDesc:Ee}=_S(F),{tieFormatName:we,tieFormatDesc:Ue}=_S(Z.tieFormat),wt=Ee===Ue,Le=!wt&&we,rt=Z.tieFormat&&!wt&&Ue,Ei=((Ii=K==null?void 0:K.filter(be=>be.structureId===Z.structureId))==null?void 0:Ii.length)||0;return{...l,tournamentId:u,eventId:b,structureId:Z.structureId,drawId:G,eventType:y,category:ue,categoryName:je,ageCategoryCode:De,flightNumber:U==null?void 0:U[G],drawType:V,stage:Z.stage,seedingBasis:re?JSON.stringify(re):void 0,winningPersonId:de,winningPersonOtherId:ye,winningPersonTennisId:ce,winningPersonWTNrating:Pe,winningPersonWTNconfidence:ke,winningPerson2Id:It,winningPerson2OtherId:me,winningPerson2TennisId:fe,winningPerson2WTNrating:Fe,winningPerson2WTNconfidence:pe,winningTeamId:ae,positionManipulations:Ei,pctNoRating:q,matchUpFormat:he,pctInitialMatchUpFormat:Re,matchUpsCount:z,drawTieFormatName:xe,drawTieFormatDesc:Ee,tieFormatName:Le,tieFormatDesc:rt,avgConfidence:W,avgWTN:Y}})})});return n.forEach(({eventName:f,drawName:g,structureId:v})=>{var y;(y=a[v])!=null&&y.length&&s.push({eventName:f,drawName:g,actions:a[v]})}),{eventStructureReports:Object.values(o),structureReports:m,flightReports:s}}function Dhe({extensions:t}){var e,i;return(i=(e=t==null?void 0:t.find(({name:r})=>r===vf))==null?void 0:e.value)==null?void 0:i.slice(1)}function Phe({ignoreDisabled:t=!0,tournamentRecords:e,tournamentId:i,venueIds:r=[],dates:n=[]}){var c,d;if(!Array.isArray(n))return{error:oe,dates:n};if(!Array.isArray(r))return{error:oe,venueIds:r};if(!(e&&Object.keys(e).filter(p=>!i||p===i)||[]).length)return{error:ki};if(!n.every(Ia))return{error:Ar};let a=Ku({tournamentRecords:e,ignoreDisabled:t,dates:n});if(a.error)return a;let o=(c=a==null?void 0:a.venues)==null?void 0:c.filter(({venueId:p})=>!(r!=null&&r.length)||r.includes(p)),s=(d=a.courts)==null?void 0:d.reduce((p,m)=>{var h;return(h=m.dateAvailability)==null||h.forEach(f=>{let g=f.date;p.includes(g)||p.push(g)}),p},[]).filter(p=>!n.length||n.includes(p)),l={venueIds:o==null?void 0:o.map(({venueId:p})=>p)},{matchUps:u}=Es({afterRecoveryTimes:!0,tournamentRecords:e,matchUpFilters:l});return{venuesReport:o==null?void 0:o.map(p=>Rhe(s,p,u))}}function Rhe(t,e,i){let{venueId:r,courts:n,venueName:a}=e,o={};return t.forEach(s=>{var m;let l=0,u=0,c=0;for(let h of n){let f=h.dateAvailability.find(v=>v.date===s),g=(m=f&&Jg({courtDate:f}).timeSlots)==null?void 0:m.reduce((v,y)=>{let{startTime:I,endTime:b}=y,S=kt(b)-kt(I);return v+S},0);g&&(c+=1),l+=g}let d=i.filter(({schedule:h})=>h.venueId===r&&Vl(s,h.scheduledDate));d.forEach(({schedule:h})=>{let f=bi(h.scheduledTime),g=ia(f,h.averageMinutes),v=kt(g)-kt(f);u+=v});let p=l?(u/l*100).toFixed(2):"100";o[s]={scheduledMatchUpsCount:d.length,availableCourts:c,availableMinutes:l,scheduledMinutes:u,percentUtilization:p}}),{venueId:r,venueName:a,venueReport:o}}var fx={};yt(fx,{addMatchUpCourtOrder:()=>Yk,addMatchUpEndTime:()=>Xk,addMatchUpOfficial:()=>rY,addMatchUpResumeTime:()=>Qk,addMatchUpScheduleItems:()=>FD,addMatchUpScheduledDate:()=>kD,addMatchUpScheduledTime:()=>Jc,addMatchUpStartTime:()=>Kk,addMatchUpStopTime:()=>Jk,addSchedulingProfileRound:()=>dx,allocateTeamMatchUpCourts:()=>xD,assignMatchUpCourt:()=>fh,assignMatchUpVenue:()=>Zg,bulkRescheduleMatchUps:()=>D5,bulkScheduleMatchUps:()=>$b,bulkScheduleTournamentMatchUps:()=>GI,bulkUpdateCourtAssignments:()=>w5,calculateScheduleTimes:()=>gx,clearMatchUpSchedule:()=>R5,clearScheduledMatchUps:()=>_D,courtGridRows:()=>yD,findMatchUpFormatTiming:()=>gD,findVenue:()=>eu,generateBookings:()=>LD,generateVirtualCourts:()=>CD,getMatchUpsToSchedule:()=>fD,getPersonRequests:()=>wp,getProfileRounds:()=>ID,getScheduledRoundsDetails:()=>Eb,getSchedulingProfile:()=>Xu,getSchedulingProfileIssues:()=>mk,matchUpScheduleChange:()=>P5,modifyMatchUpFormatTiming:()=>Ak,mutate:()=>I5,proAutoSchedule:()=>b5,proConflicts:()=>S5,publicFindCourt:()=>GA,query:()=>t4,removeEventMatchUpFormatTiming:()=>PD,removeMatchUpCourtAssignment:()=>y5,reorderUpcomingMatchUps:()=>T5,scheduleMatchUps:()=>U5,scheduleProfileRounds:()=>$D,setMatchUpDailyLimits:()=>E5,setMatchUpHomeParticipantId:()=>qk,setSchedulingProfile:()=>Wg,toggleParticipantCheckInState:()=>ND,validateSchedulingProfile:()=>vD});var I5={};yt(I5,{addMatchUpCourtOrder:()=>Yk,addMatchUpEndTime:()=>Xk,addMatchUpOfficial:()=>rY,addMatchUpResumeTime:()=>Qk,addMatchUpScheduleItems:()=>FD,addMatchUpScheduledDate:()=>kD,addMatchUpScheduledTime:()=>Jc,addMatchUpStartTime:()=>Kk,addMatchUpStopTime:()=>Jk,addSchedulingProfileRound:()=>dx,allocateTeamMatchUpCourts:()=>xD,assignMatchUpCourt:()=>fh,assignMatchUpVenue:()=>Zg,bulkRescheduleMatchUps:()=>D5,bulkScheduleMatchUps:()=>$b,bulkScheduleTournamentMatchUps:()=>GI,bulkUpdateCourtAssignments:()=>w5,calculateScheduleTimes:()=>gx,clearMatchUpSchedule:()=>R5,clearScheduledMatchUps:()=>_D,findMatchUpFormatTiming:()=>gD,generateBookings:()=>LD,generateVirtualCourts:()=>CD,matchUpScheduleChange:()=>P5,modifyMatchUpFormatTiming:()=>Ak,proAutoSchedule:()=>b5,proConflicts:()=>S5,removeEventMatchUpFormatTiming:()=>PD,removeMatchUpCourtAssignment:()=>y5,reorderUpcomingMatchUps:()=>T5,scheduleMatchUps:()=>U5,scheduleProfileRounds:()=>$D,setMatchUpDailyLimits:()=>E5,setMatchUpHomeParticipantId:()=>qk,setSchedulingProfile:()=>Wg,toggleParticipantCheckInState:()=>ND,validateSchedulingProfile:()=>vD});function gx({calculateStartTimeFromCourts:t=!0,defaultRecoveryMinutes:e=0,averageMatchUpMinutes:i=90,remainingScheduleTimes:r,clearScheduleDates:n,tournamentRecords:a,periodLength:o,scheduleDate:s,startTime:l,venueIds:u,endTime:c}){if(typeof a!="object"||!Object.keys(a).length)return{error:ki};o=o??MD({recoveryMinutes:e,averageMatchUpMinutes:i});let{courts:d,venues:p}=Ku({dates:[s],ignoreDisabled:!0,tournamentRecords:a}),m=d==null?void 0:d.filter(P=>!u||u.includes(P.venueId));l||(l=m==null?void 0:m.reduce((P,E)=>{var N,A;let R=((A=(N=E.dateAvailability)==null?void 0:N.find(M=>!M.date||Vl(s,M.date)))==null?void 0:A.startTime)??E.startTime;return R&&(!P||kt(R)<kt(P))?R:P},void 0)),c||(c=m==null?void 0:m.reduce((P,E)=>{var N,A;let R=((A=(N=E.dateAvailability)==null?void 0:N.find(M=>!M.date||Vl(s,M.date)))==null?void 0:A.endTime)??E.endTime;return R&&(!P||kt(R)>kt(P))?R:P},void 0));let h=Object.values(a),f=Object.assign({},...h.map(P=>(P.events??[]).map(E=>{let{scheduleTiming:R}=qy({tournamentRecord:P,event:E});return{[E.eventId]:{event:E,scheduleTiming:R}}})).flat()),g=Nb({sortDateMatchUps:!1,tournamentRecords:a,matchUpFilters:{scheduledDate:s,venueIds:u}}),v=(g==null?void 0:g.dateMatchUps)??[],y=(g==null?void 0:g.completedMatchUps)??[],I=[];I.push(...v),I.push(...y);let b={averageTimes:[{minutes:{default:i}}],recoveryTimes:[{minutes:{default:e}}]},S=I==null?void 0:I.map(({eventId:P,schedule:E,matchUpFormat:R})=>{let{event:N,scheduleTiming:A}=f[P],M=N==null?void 0:N.eventType,C={...A,defaultTiming:b,matchUpFormat:R},{averageMinutes:O,recoveryMinutes:k}=kT({eventType:M,timingDetails:C}),{courtId:x,venueId:F}=E,$=bi(E.scheduledTime),_=ia($,O);return{recoveryMinutes:k,averageMinutes:O,periodLength:o,startTime:$,endTime:_,courtId:x,venueId:F}}),w={calculateStartTimeFromCourts:t,remainingScheduleTimes:r,averageMatchUpMinutes:i,date:s,clearScheduleDates:n,periodLength:o,startTime:l,endTime:c,bookings:S,courts:m},{scheduleTimes:U}=Vk(w),T=(u==null?void 0:u.length)===1&&u[0]||(p==null?void 0:p.length)===1&&p[0].venueId||void 0,D=I.map(Dr);return{venueId:T,scheduleTimes:U,dateScheduledMatchUpIds:D}}function y5(t){var m;let e=ze(t,[{[pn]:!0}]);if(e.error)return e;let{removePriorValues:i,tournamentRecords:r,tournamentId:n,courtDayDate:a,matchUpId:o,courtId:s,drawId:l}=t,u=r[n];if(!u)return{error:ge};let{drawDefinition:c,event:d}=Xc({tournamentRecord:u,drawId:l});if(!c)return{error:_e};let p=wi({drawDefinition:c,event:d,matchUpId:o});if(p.error)return p;if(((m=p==null?void 0:p.matchUp)==null?void 0:m.matchUpType)===ka){let{itemValue:h}=vp({timeItems:p.matchUp.timeItems??[],itemType:zl}),f=s&&h.filter(g=>g.courtId!==s);return Da({duplicateValues:!1,removePriorValues:i,tournamentRecord:u,drawDefinition:c,matchUpId:o,timeItem:{itemType:zl,itemValue:f}})}else return fh({tournamentRecord:u,drawDefinition:c,courtDayDate:a,courtId:"",matchUpId:o})}function b5({scheduleCompletedMatchUps:t,tournamentRecords:e,scheduledDate:i,matchUps:r}){if(!wo(r))return{error:oe};if(r.some(({hasContext:m})=>!m))return{info:"matchUps must have { inContext: true, nextMatchUps: true }",error:K0};let n=Nb({courtCompletedMatchUps:!0,withCourtGridRows:!0,minCourtGridRows:10,tournamentRecords:e,matchUpFilters:{localPerspective:!0,scheduledDate:i}});if(n.error)return n;let{rows:a}=n,o=[],s=m=>[(m.sides||[]).map(h=>{var f;return[h.participantId,(f=h.participant)==null?void 0:f.individualParticipantIds]}),(m.potentialParticipants||[]).flat().map(h=>[h.participantId,h.individualParticipantIds])].flat(1/0).filter(Boolean),l=a==null?void 0:a.reduce((m,h)=>{let f=[],g=[];Object.values(h).forEach(y=>{if(Nt(y)&&(y.matchUpId&&(f.push(y.matchUpId),o.push(y)),y.sides)){let I=s(y);g.push(...I)}});let v=Object.values(h).filter(y=>Nt(y)&&!y.matchUpId);return m.concat({matchUpIds:f,availableCourts:v,rowId:h.rowId,participantIds:g})},[]);r.filter(({matchUpStatus:m})=>m&&m!==Vt&&(t||!vr.includes(m))).sort(oh);let u=us({matchUps:r.concat(o),includeParticipantDependencies:!0,tournamentRecords:e}).matchUpDependencies,c=[],d=[];for(;r.length&&l.length;){let m=l.shift(),h=[];for(;r.length&&m.availableCourts.length;){let f=r.concat(h).map(T=>T.matchUpId),g=r.shift(),v=g==null?void 0:g.matchUpId,y=v&&u[v].matchUpIds.concat(u[v].dependentMatchUpIds),I=v&&f.some(T=>u[v].matchUpIds.includes(T)),b=v&&d.some(T=>u[v].dependentMatchUpIds.includes(T)),S=m.matchUpIds.some(T=>y.includes(T)),w=s(g),U=m.participantIds.some(T=>w.includes(T));if(g&&!S&&!I&&!U&&!b){let T=m.availableCourts.shift();Object.assign(g.schedule,T.schedule),Object.assign(T,g),c.push(g),m.participantIds.push(...w),m.matchUpIds.push(v)}else g&&h.push(g)}r.push(...h),d.push(...m.matchUpIds)}let p=c.map(({matchUpId:m,tournamentId:h,schedule:f,drawId:g})=>({tournamentId:h,matchUpId:m,drawId:g,schedule:{...f,scheduledDate:i}}));return n=$b({tournamentRecords:e,matchUpDetails:p}),{...n,scheduled:c,notScheduled:r}}function w5(t){let{courtDayDate:e}=t,i=ze(t,[{courtAssignments:!0,[Xn]:un,[_a]:Xe},{[pn]:!0}]);if(i.error)return i;let r=t.courtAssignments.reduce((a,o)=>{let{tournamentId:s}=o;return a[s]||(a[s]=[]),a[s].push(o),a},{}),n;return Object.keys(r).every(a=>{let o=t[pn][a];if(!o)return n={error:ge},!1;let s=r[a].reduce((l,u)=>{let{drawId:c}=u;return l[c]||(l[c]=[]),l[c].push(u),l},{});Object.keys(s).every(l=>{let{drawDefinition:u}=Wn({tournamentRecord:o,drawId:l});return u?(s[l].every(c=>{let{matchUpId:d,courtId:p}=c,m=fh({tournamentRecord:o,drawDefinition:u,courtDayDate:e,matchUpId:d,courtId:p});if(m.success)return m==null?void 0:m.success;n={error:wH}}),!0):(n={error:_e},!1)})}),n||J}function U5(t){let{tournamentRecords:e,allDateMatchUpIds:i=[],averageMatchUpMinutes:r=90,recoveryMinutes:n=0,recoveryMinutesMap:a,matchUpPotentialParticipantIds:o={},individualParticipantProfiles:s={},matchUpNotBeforeTimes:l={},matchUpDailyLimits:u={},checkPotentialRequestConflicts:c=!0,remainingScheduleTimes:d,clearScheduleDates:p,periodLength:m=30,scheduleDate:h,matchUpIds:f,venueIds:g,startTime:v,endTime:y,dryRun:I}=t,b=ze(t,[{[pn]:!0,[$y]:!0},{[Kr]:Ia,[_a]:Ar,[Jae]:!0},{[Kr]:V=>!V||!isNaN(V),[toe]:!1,[_a]:oe,[ioe]:!1,[roe]:!1}]);if(b.error)return b;let S=t.competitionMatchUps??Es({nextMatchUps:!0,tournamentRecords:e}).matchUps??[],w=t.matchUpDependencies??us({includeParticipantDependencies:!0,matchUps:S,tournamentRecords:e}).matchUpDependencies;S.forEach(V=>{var G;(G=V.schedule)!=null&&G.scheduledDate&&Vl(h,pt(V.schedule.scheduledDate))&&zf({matchUpPotentialParticipantIds:o,matchUpNotBeforeTimes:l,matchUp:V})});let U=f.map(V=>S.find(G=>G.matchUpId===V)).filter(Boolean),{venueId:T,scheduleTimes:D,dateScheduledMatchUpIds:P}=gx({tournamentRecords:e,remainingScheduleTimes:d,startTime:bi(v),endTime:bi(y),scheduleDate:pt(h),averageMatchUpMinutes:r,clearScheduleDates:p,periodLength:m,venueIds:g}),E={},R=[],N={},A={},M={};S.filter(({matchUpId:V})=>P==null?void 0:P.includes(V)).forEach(V=>{var j;c1({matchUpPotentialParticipantIds:o,individualParticipantProfiles:s,matchUp:V,value:1});let G=(j=V.schedule)==null?void 0:j.scheduledTime;if(G){N[V.matchUpId]=G;let z=a==null?void 0:a[V.matchUpId];jI({recoveryMinutes:z||n,matchUpPotentialParticipantIds:o,individualParticipantProfiles:s,matchUpNotBeforeTimes:l,averageMatchUpMinutes:r,matchUpDependencies:w,scheduleTime:G,matchUp:V})}});let C=U.filter(V=>{let G=P==null?void 0:P.includes(V.matchUpId),j=[Vt,Mt,qi,$a,mn,zt].includes(V==null?void 0:V.matchUpStatus);return!G&&!V.winningSide&&!j}),{matchUpMap:O,overLimitMatchUpIds:k,participantIdsAtLimit:x}=C.reduce((V,G)=>{let{drawId:j,tournamentId:z,matchUpType:W}=G,{participantIdsAtLimit:q,relevantParticipantIds:Y}=sx({individualParticipantProfiles:s,matchUpPotentialParticipantIds:o,matchUpDailyLimits:u,matchUp:G});return q!=null&&q.length?(V.overLimitMatchUpIds.push(G.matchUpId),V.participantIdsAtLimit.push(...q),V):(Y.forEach(re=>{Lb({individualParticipantProfiles:s,participantId:re});let K=s[re].counters;K[W]?K[W]+=1:K[W]=1,K[Go]?K[Go]+=1:K[Go]=1}),V.matchUpMap[z]||(V.matchUpMap[z]={}),V.matchUpMap[z][j]?V.matchUpMap[z][j].push(G):V.matchUpMap[z][j]=[G],zf({matchUpPotentialParticipantIds:o,matchUpNotBeforeTimes:l,matchUp:G}),V)},{matchUpMap:{},overLimitMatchUpIds:[],participantIdsAtLimit:[]});C=C.filter(({matchUpId:V})=>!k.includes(V));let F=0,$=(D==null?void 0:D.length)??0,{personRequests:_}=wp({tournamentRecords:e,requestType:_b});for(;D!=null&&D.length&&C.length&&F<=$;){F++;let{scheduleTime:V}=D.shift(),G=C.find(j=>{let{matchUpId:z}=j,{dependenciesScheduled:W,remainingDependencies:q}=nx({matchUpScheduleTimes:N,matchUpDependencies:w,allDateMatchUpIds:i,matchUp:j});if(!W)return M[z]||(M[z]=[]),M[z].push({scheduleTime:V,remainingDependencies:q}),!1;let{enoughTime:Y}=ox({individualParticipantProfiles:s,matchUpNotBeforeTimes:l,matchUpDependencies:w,scheduleTime:V,matchUp:j});if(!Y)return A[z]||(A[z]=[]),A[z].push({scheduleTime:V}),!1;let{conflicts:re}=ax({potentials:c,averageMatchUpMinutes:r,requestConflicts:E,personRequests:_,scheduleTime:V,scheduleDate:h,matchUp:j});if(re!=null&&re.length)return!1;let K=a==null?void 0:a[j.matchUpId];return jI({recoveryMinutes:K||n,matchUpPotentialParticipantIds:o,individualParticipantProfiles:s,matchUpNotBeforeTimes:l,averageMatchUpMinutes:r,matchUpDependencies:w,scheduleTime:V,matchUp:j}),N[j.matchUpId]=V,!0});C=C.filter(({matchUpId:j})=>j!==(G==null?void 0:G.matchUpId)),G||R.push(V)}C.forEach(V=>{c1({individualParticipantProfiles:s,matchUpPotentialParticipantIds:o,value:-1,matchUp:V})});let L=[];Object.keys(O).forEach(V=>{let G=e[V];G&&Object.keys(O[V]).forEach(j=>{let{drawDefinition:z}=Xc({tournamentRecord:G,drawId:j});z&&O[V][j].forEach(({matchUpId:W})=>{let q=N[W];if(q){let Y=q.split(":").map(no).join(":"),re=`${pt(h)}T${Y}`;I?L.push(W):(Jc({drawDefinition:z,matchUpId:W,scheduledTime:re}).success&&L.push(W),T&&Zg({tournamentRecords:e,tournamentRecord:G,drawDefinition:z,matchUpId:W,venueId:T}))}})})});let B=mA(C);return{...J,requestConflicts:Object.values(E),remainingScheduleTimes:D==null?void 0:D.map(({scheduleTime:V})=>V),individualParticipantProfiles:s,matchUpNotBeforeTimes:l,participantIdsAtLimit:x,skippedScheduleTimes:R,overLimitMatchUpIds:k,scheduledMatchUpIds:L,noTimeMatchUpIds:B,recoveryTimeDeferred:A,dependencyDeferred:M}}function S5({tournamentRecords:t,matchUps:e}){if(!wo(e))return{error:ju};if(e.some(({matchUpId:m,hasContext:h})=>m&&!h))return{info:"matchUps must have { inContext: true, nextMatchUps: true }",error:K0};let i=Math.max(...e.map(({schedule:m})=>(m==null?void 0:m.courtOrder)||1).map(m=>Qe(m))),r=Se(1,i+1).map(m=>e.filter(h=>{var f;return Qe((f=h.schedule)==null?void 0:f.courtOrder)===m})),n={},a={},o={};r.flat().filter(Boolean).sort(oh).forEach(({schedule:m})=>delete m[AU]);let s=ct(e.map(({drawId:m})=>m)),l=us({includeParticipantDependencies:!0,tournamentRecords:t,drawIds:s}).matchUpDependencies,u=r.map((m,h)=>m.reduce((f,g)=>{if(!g.matchUpId)return f;let{matchUpId:v,winnerMatchUpId:y,loserMatchUpId:I,schedule:b,sides:S,potentialParticipants:w}=g,U=b==null?void 0:b.courtId;n[v]=h,a[U]=[],f.matchUpIds.push(v),o[v]=g;let T=l[v].matchUpIds;T.length&&f.sourceMatchUpIds.push(...T);let D=(S==null?void 0:S.map(E=>{var R;return[(R=E.participant)==null?void 0:R.individualParticipantIds,E.participantId]}).flat().filter(Boolean))??[],P=(w==null?void 0:w.flat().map(({individualParticipantIds:E,participantId:R})=>[E,R]).flat().filter(Boolean))||[];return f.participantIds.push(...P,...D),y&&f.targetMatchUpIds.push(y),I&&f.targetMatchUpIds.push(I),f},{sourceMatchUpIds:[],targetMatchUpIds:[],participantIds:[],matchUpIds:[]})),c=(m,h)=>l[m].sources.reduce((f,g,v)=>g.includes(h)&&v+1||f,0),d=u.map(()=>[]),p=(m,h,f,g)=>{if(!o[m].schedule[AU]){o[m].schedule[AU]=h,o[m].schedule[WW]=g,d[n[m]].push({matchUpId:m,issueType:f,issueIds:g,issue:h});let v=o[m].schedule.courtId;a[v]||(a[v]=[]),a[v].push({matchUpId:m,issue:h,issueType:f,issueIds:g})}};return u.forEach((m,h)=>{let f=h?u[h-1]:void 0,g=u.slice(h+1),v={},y=wa(m.participantIds),I=Object.keys(y).filter(w=>y[w]>1),b=m.matchUpIds.filter(w=>l[w].participantIds.some(U=>I.includes(U)));b.forEach(w=>{v[w]||(v[w]={}),v[w][dd]||(v[w][dd]=b.filter(U=>U!==w))});let S=f&&m.participantIds.filter(w=>f.participantIds.includes(w));S&&S.forEach(w=>{let U=m.matchUpIds.concat(f.matchUpIds).filter(T=>l[T].participantIds.includes(w));U.forEach(T=>{v[T]||(v[T]={}),v[T][pd]||(v[T][pd]=U.filter(D=>D!==T))})}),m.matchUpIds.forEach(w=>{var D,P,E,R;let U=l[w].matchUpIds;for(let N of g){let A=N.matchUpIds.filter(M=>U.includes(M));A!=null&&A.length&&(A.forEach(M=>p(M,LC,sc,[w])),p(w,LC,sc,A))}if((D=v[w])!=null&&D[dd]&&p(w,dd,FC,v[w][dd]),m.sourceMatchUpIds.includes(w)){let N=m.matchUpIds.filter(A=>l[A].matchUpIds.includes(w));p(w,dd,sc,N),m.matchUpIds.filter(A=>l[A].matchUpIds.includes(w)).forEach(A=>p(A,dd,sc,[w]))}let T=(P=f==null?void 0:f.matchUpIds)==null?void 0:P.filter(N=>c(w,N)>1);if(T!=null&&T.length&&(p(w,_C,sc,T),T.forEach(N=>p(N,_C,sc,[w]))),(E=v[w])!=null&&E[pd]&&p(w,pd,FC,v[w][pd]),(R=f==null?void 0:f.targetMatchUpIds)==null?void 0:R.includes(w)){let N=o[w].schedule.courtId,A=U.filter(M=>f.matchUpIds.includes(M));A.some(M=>o[M].schedule.courtId===N)||(A.forEach(M=>p(M,pd,sc,[w])),p(w,pd,sc,A))}})}),{courtIssues:a,rowIssues:d}}function T5(t){let e="reorderUpcomingMatchUps",{tournamentRecords:i}=t;if(typeof i!="object"||!Object.keys(i).length)return ee({result:{error:ki},stack:e});let{matchUpsContextIds:r,firstToLast:n}=t;if(!r)return ee({result:{error:Xe},stack:e});let a=r==null?void 0:r.length;if(!a)return{...J};let o=0;return r.forEach((l,u)=>{let{tournamentId:c,drawId:d,matchUpId:p}=l,m=u+(n?-1:1);m<0&&(m=a-1),m===a&&(m=0);let h=r[m].schedule.scheduledTime,f=s({tournamentId:c,scheduledTime:h,matchUpId:p,drawId:d});if(f.success)o++;else return f}),o===a?J:ee({result:{error:bH},stack:e});function s({tournamentId:l,scheduledTime:u,matchUpId:c,drawId:d}){let p=i[l],{drawDefinition:m}=Xc({tournamentRecord:p,drawId:d});return m?Jc({drawDefinition:m,scheduledTime:u,matchUpId:c}):{error:xa}}}function D5(t){var l,u;let{scheduleChange:e,matchUpIds:i,dryRun:r}=t;if(!i||!Array.isArray(i))return{error:jm};if(typeof e!="object")return{error:oe};let n=Io(t),a=[],o=[];for(let c of Object.values(n)){let d=Ehe({tournamentRecord:c,scheduleChange:e,matchUpIds:i,dryRun:r});if(d.error)return d;Array.isArray(d.notRescheduled)&&o.push(...d.notRescheduled);let p=mA(d.notRescheduled),m=[];(l=d.rescheduled)==null||l.forEach(h=>{let{matchUpId:f}=h;p.includes(f)&&m.push(f),a.push(h)}),m.length&&(o=((u=d==null?void 0:d.notRescheduled)==null?void 0:u.filter(({matchUpId:h})=>!m.includes(h)))||[])}let s=!!(a.length&&!o.length);return{...J,rescheduled:a,notRescheduled:o,allRescheduled:s}}function Ehe({tournamentRecord:t,scheduleChange:e,matchUpIds:i,dryRun:r}){var b;if(!t)return{error:ge};if(!i||!Array.isArray(i))return{error:jm};if(typeof e!="object")return{error:oe};let n=[],a=[],{minutesChange:o,daysChange:s}=e;if(!o&&!s)return{...J};if(o&&isNaN(o))return{error:oe};if(s&&isNaN(s))return{error:oe};let{matchUps:l}=Vr({matchUpFilters:{matchUpIds:i},tournamentRecord:t}),u=({matchUpStatus:S})=>!vr.includes(S),c=l==null?void 0:l.filter(S=>Mb({schedule:S.schedule})).filter(S=>u({matchUpStatus:S.matchUpStatus}));if(!(c!=null&&c.length))return{...J};let{tournamentInfo:d}=mh({tournamentRecord:t}),{startDate:p,endDate:m}=d,h=c==null?void 0:c.reduce((S,w)=>{let{matchUpId:U,drawId:T}=w;return S[T]?S[T].push(U):S[T]=[U],S},{}),f=1440;for(let S of Object.keys(h)){let w=Xc({tournamentRecord:t,drawId:S});if(w.error)return w;let U=w.drawDefinition,T=h[S].filter(D=>i.includes(D));for(let D of T)if(D&&U){let P=(b=c.find(C=>C.matchUpId===D))==null?void 0:b.schedule,{scheduledTime:E,scheduledDate:R}=P,N,A,M;if(!N&&s&&R){let C=pt(R);M=jv(C,s),N=new Date(M)<new Date(p)||new Date(M)>new Date(m)}if(o&&E){let C=pt(E),O=kt(bi(E))+o;if(N=O<0||O>f,!N){let k=ia(E,o),x=C&&M||R===C&&C;A=x?`${x}T${k}`:k}}if(N)a.push(D);else{if(!r){if(A){let C=Jc({scheduledTime:A,drawDefinition:U,matchUpId:D});if(C.error)return C}if(M){let C=kD({scheduledDate:M,drawDefinition:U,matchUpId:D});if(C.error)return C}}(A||M)&&n.push(D)}}}let g=Vr({matchUpFilters:{matchUpIds:i},tournamentRecord:t}).matchUps??[],v=g.filter(({matchUpId:S})=>n.includes(S)),y=g.filter(({matchUpId:S})=>a.includes(S)),I=v.length&&!y.length;return{...J,rescheduled:v,notRescheduled:y,allRescheduled:I}}function P5(t){let e="matchUpScheduleChange",{tournamentRecords:i}=t;if(typeof i!="object"||!Object.keys(i).length)return{error:ki};let{sourceMatchUpContextIds:r,targetMatchUpContextIds:n,sourceCourtId:a,targetCourtId:o,courtDayDate:s}=t||{},{drawId:l,matchUpId:u,tournamentId:c}=r||{},{drawId:d,matchUpId:p,tournamentId:m}=n||{};if(!u&&!p)return ee({result:{error:Xe},stack:e});let{matchUps:h}=Es({matchUpFilters:{matchUpIds:[u,p].filter(Boolean),drawIds:[l,d].filter(Boolean)},tournamentRecords:t.tournamentRecords}),f=h==null?void 0:h.find(({matchUpId:b})=>b===u),g=h==null?void 0:h.find(({matchUpId:b})=>b===p),v=0;if(o&&u&&!p){let b=y({tournamentId:c,matchUpId:u,courtId:o,matchUp:f,drawId:l,tournamentRecords:i,sourceCourtId:a,courtDayDate:s});if(b!=null&&b.success&&v++,b.error)return ee({result:b,stack:e})}else if(a&&o&&u&&p){let b=y({tournamentId:c,matchUpId:u,courtId:o,matchUp:f,drawId:l,tournamentRecords:i,sourceCourtId:a,courtDayDate:s});if(b.success&&v++,b.error)return ee({result:b,stack:e,info:"source"});let S=y({tournamentId:m,sourceCourtId:o,matchUpId:p,matchUp:g,courtId:a,drawId:d,tournamentRecords:i,courtDayDate:s});if(S.success&&v++,S.error)return ee({result:S,stack:e,info:"target"})}else return{error:Xe};return v?J:ee({result:{error:Mg},stack:e});function y(b){let{tournamentRecords:S,tournamentId:w,matchUp:U,drawId:T}=b,D=S[w],{drawDefinition:P}=Xc({tournamentRecord:D,drawId:T});return U.matchUpType===hi?I({...b,tournamentRecord:D,drawDefinition:P}):fh({...b,tournamentRecord:D,drawDefinition:P})}function I({removePriorValues:b,tournamentRecords:S,tournamentRecord:w,drawDefinition:U,sourceCourtId:T,courtDayDate:D,matchUpId:P,matchUp:E,courtId:R}){let N=[R].concat(E.schedule.allocatedCourts.map(({courtId:A})=>A).filter(A=>A!==T));return xD({removePriorValues:b,tournamentRecords:S,tournamentRecord:w,drawDefinition:U,courtDayDate:D,matchUpId:P,courtIds:N})}}function R5({scheduleAttributes:t=[zl,Rc,eh,th,ih,fs,Eu,El,gu],tournamentRecord:e,drawDefinition:i,matchUpId:r}){var s,l;let n="clearMatchUpSchedule",a=i?(s=Sn({matchUpFilters:{matchUpIds:[r]},inContext:!1,drawDefinition:i}).matchUps)==null?void 0:s[0]:(l=Vr({matchUpFilters:{matchUpIds:[r]},tournamentRecord:e,inContext:!1}).matchUps)==null?void 0:l[0];if(!a)return{error:dn};let o=(a.timeItems??[]).filter(u=>(u==null?void 0:u.itemType)&&!t.includes(u==null?void 0:u.itemType));return a.timeItems=o,Rt({tournamentId:e.tournamentId,context:n,drawDefinition:i,matchUp:a}),{...J}}function E5(t){let{tournamentRecord:e,tournamentId:i,dailyLimits:r}=t,n=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(typeof n!="object"||!Object.keys(n).length)return{error:ki};if(typeof r!="object")return{error:Gu};let a=Object.keys(n).filter(o=>!i||i===o);if(i&&!a.includes(i))return{error:oe};for(let o of a){let s=n[o],l=Lt({extension:{name:jy,value:{dailyLimits:r}},element:s});if(l.error)return l}return{...J}}var C5={};yt(C5,{addCollectionDefinition:()=>yx,addCollectionGroup:()=>x5,aggregateTieFormats:()=>L5,compareTieFormats:()=>Cu,getTieFormat:()=>ck,modifyCollectionDefinition:()=>vx,modifyTieFormat:()=>F5,mutate:()=>M5,orderCollectionDefinitions:()=>O5,query:()=>Y6,removeCollectionDefinition:()=>Ix,removeCollectionGroup:()=>A5,tieFormatGenderValidityCheck:()=>aT,validateCollectionDefinition:()=>xy});var M5={};yt(M5,{addCollectionDefinition:()=>yx,addCollectionGroup:()=>x5,aggregateTieFormats:()=>L5,modifyCollectionDefinition:()=>vx,modifyTieFormat:()=>F5,orderCollectionDefinitions:()=>O5,removeCollectionDefinition:()=>Ix,removeCollectionGroup:()=>A5});function Hd({drawDefinition:t,structureId:e,matchUpId:i,structure:r,matchUp:n,eventId:a,event:o}){var u;let s="getTieFormat",l;if(e=(r==null?void 0:r.structureId)??e,i=(n==null?void 0:n.matchUpId)??i,(i||e)&&!t)return{error:_e};if(a&&o)l=_s(o);else if(i){if(t&&(!n||!r)){let c=wi({drawDefinition:t,matchUpId:i});if(c.error)return c;if(((u=c.matchUp)==null?void 0:u.matchUpType)!==ka)return ee({result:{error:aa},stack:s});r||(r=c.structure),n||(n=c.matchUp)}l=Yv({item:n,drawDefinition:t,structure:r,event:o})||Yv({item:r,drawDefinition:t,structure:r,event:o})||_s(t)||_s(o)}else if(t&&e){if(!r){let c=et({drawDefinition:t,structureId:e});if(c.error)return c;r=c==null?void 0:c.structure}l=Yv({item:r,drawDefinition:t,structure:r,event:o})||_s(t)||_s(o)}else l=_s(t)||_s(o);return l?{...J,structure:r,tieFormat:l,matchUp:n}:ee({result:{error:Rg},stack:s})}function WS({matchUp:t,updateInProgressMatchUps:e}){return!t.winningSide&&![vr].includes(t.matchUpStatus)&&(e||t.matchUpStatus!==ss&&!Ir(t))}function TE({from:t,to:e}){let i=Object.keys(t),r=Vi(i,Object.keys(e)).length===i.length,n=i.filter(o=>t[o]!==e[o]).map(o=>({countChange:e[o]-t[o],collectionId:o})),a=i.every(o=>t[o]===e[o]);return{equivalent:r&&a,matchUpsCountChanges:n}}function Che({updateInProgressMatchUps:t,tournamentRecord:e,drawDefinition:i,structure:r,tieFormat:n,eventId:a,matchUp:o,event:s,uuids:l}){var w,U,T,D;let u="updateTieFormat",c=e==null?void 0:e.tournamentId,d=0,p=0,m=0,h=0,f=n==null?void 0:n.collectionDefinitions.reduce((P,E)=>(P[E.collectionId]=(P[E.collectionId]||0)+E.matchUpCount,P),{}),g=({tieFormat:P})=>{let E=P==null?void 0:P.collectionDefinitions.reduce((R,N)=>(R[N.collectionId]=(R[N.collectionId]||0)+N.matchUpCount,R),{});return TE({from:E,to:f}).equivalent},v=(w=Hd({drawDefinition:i}))==null?void 0:w.tieFormat,y=(U=Hd({event:s}))==null?void 0:U.tieFormat;if(s&&a){for(let P of s.drawDefinitions??[])I({drawDefinition:P});s.tieFormat=qr(n),h+=1}else if(o){if(!o.tieMatchUps)return ee({result:{error:aa},stack:u});let P=wa((T=o.tieMatchUps)==null?void 0:T.map(({collectionId:M})=>M)),E=TE({to:f,from:P}),{changes:R,changesArePossible:N,cannotChangeReaon:A}=UV({matchUp:o,check:E});if(E.equivalent)if(WS({matchUp:o,updateInProgressMatchUps:t}))o.tieFormat=qr(n),h+=1;else return ee({result:{error:TN},info:"matchUp is IN_PROGRESS or COMPLETE",stack:u});else if(N)S({tieFormat:n,matchUp:o,changes:R,uuids:l});else return ee({context:{collectionMap:f,matchUpMap:P},result:{error:Pl},info:A||"specified changes not possible",stack:u});p+=1,Rt({eventId:s==null?void 0:s.eventId,context:u,drawDefinition:i,tournamentId:c,matchUp:o})}else if(r){let P=(D=b({inheritedTieFormat:v??y,structure:r}))==null?void 0:D.modifiedMatchUpsCount;P&&(p+=P,d+=1,h+=1);let E=!r.tieFormat||Cu({ancestor:r.tieFormat,descendant:n}).different;E&&(r.tieFormat=qr(n),d+=1,h+=1),(P||E)&&i&&li({structureIds:[r.structureId],eventId:s==null?void 0:s.eventId,drawDefinition:i})}else if(i)I({drawDefinition:i}),i.tieFormat=qr(n),h+=1;else return{error:_e};return{modifiedStructuresCount:d,modifiedMatchUpsCount:p,addedMatchUpsCount:m,modifiedCount:h,...J,tieFormat:n};function I({drawDefinition:P}){var N;let E=P.structures||[],R=[];for(let A of E){if(A.tieFormat)continue;let M=(N=b({inheritedTieFormat:y,structure:A}))==null?void 0:N.modifiedMatchUpsCount;if(M){d+=1,p+=M;let C=A.structureId;R.push(C)}}return li({structureIds:R,eventId:s==null?void 0:s.eventId,drawDefinition:P}),R.length}function b({inheritedTieFormat:P,structure:E}){var A,M;let R=0,N=((A=Wt({matchUpFilters:{matchUpTypes:[hi]},structure:E}))==null?void 0:A.matchUps)||[];for(let C of N){let O=WS({matchUp:C,updateInProgressMatchUps:t}),k=!1,x=wa((M=C.tieMatchUps)==null?void 0:M.map(({collectionId:$})=>$)),F=TE({from:x,to:f});if(F.equivalent)C.tieFormat&&g(C)&&O&&(C.tieFormat=qr(n),k=!0);else{let{changes:$,changesArePossible:_}=UV({matchUp:C,check:F});if(_&&!C.tieFormat)S({changes:$,matchUp:C,tieFormat:n,uuids:l});else if(P)(!C.tieFormat||Cu({ancestor:P,descendant:C.tieFormat}).different)&&(C.tieFormat=P,k=!0);else return ee({result:{error:Rg},stack:u})}k&&(R+=1,Rt({tournamentId:e==null?void 0:e.tournamentId,drawDefinition:i,context:u,eventId:a,matchUp:C}))}return{modifiedMatchUpsCount:R}}function S({uuids:P,matchUp:E,tieFormat:R,changes:N}){E.tieFormat=qr(R);let A=[],M=[];return N.forEach(C=>{if(C.countChange>0){let O=Math.max(0,...E.tieMatchUps.filter(F=>F.collectionId===C.collectionId).map(Ta("collectionPosition"))),k=R.collectionDefinitions.find(F=>F.collectionId===C.collectionId),x=Ib({matchUpsLimit:C.countChange,collectionPositionOffset:O,collectionDefinition:k,matchUp:E,uuids:P});M.push(...Me(x,!1,!0)),m+=M.length,E.tieMatchUps.push(...x)}else{let O=C.toBePlayedTieMatchUpIds.slice(0,Math.abs(C.countChange));console.log("remove",O.length),A.push(...O),E.tieMatchUps=E.tieMatchUps.filter(({matchUpId:k})=>!O.includes(k))}}),M.length&&Dc({matchUps:M,drawDefinition:i,tournamentId:c,eventId:a}),A.length&&zu({matchUpIds:A,action:"updateTieFormat",drawDefinition:i,tournamentId:c,eventId:a}),{matchUpIdsRemoved:A,matchUpsAdded:M}}}function UV({check:t,matchUp:e}){let i="",r=[];return{changesArePossible:t.matchUpsCountChanges.every(({collectionId:n,countChange:a})=>{let o=e.tieMatchUps.filter(l=>l.collectionId===n&&l.matchUpStatus===Ji).map(Ta("matchUpId")),s=o.length+a>=0||a>0;return!s&&a<0&&(i="Insufficient TO_BE_PLAYED matchUps"),r.push({toBePlayedTieMatchUpIds:o,collectionId:n,countChange:a}),s}),changes:r,cannotChangeReaon:i}}function GD({appliedPolicies:t,drawDefinition:e,auditData:i}){var a;if(!((a=t==null?void 0:t.audit)!=null&&a[Wv]))return;let{extension:r}=gt({name:Wv,element:e}),n={value:Array.isArray(r==null?void 0:r.value)?r==null?void 0:r.value.concat(i):[i],name:Wv};Lt({element:e,extension:n})}function vx({updateInProgressMatchUps:t=!1,tournamentRecord:e,collectionOrder:i,collectionName:r,tieFormatName:n,drawDefinition:a,matchUpFormat:o,matchUpCount:s,collectionId:l,matchUpType:u,structureId:c,matchUpId:d,category:p,eventId:m,gender:h,event:f,collectionValueProfiles:g,collectionValue:v,matchUpValue:y,scoreValue:I,setValue:b}){let S="modifyCollectionDefinition";if(o&&!Ua({matchUpFormat:o}))return ee({result:{error:oe},context:{matchUpFormat:o},stack:S});if(r&&typeof r!="string")return ee({result:{error:oe},context:{collectionName:r},stack:S});if(h&&!Object.values(nT).includes(h))return ee({result:{error:oe},context:{gender:h},stack:S});if(p&&typeof p!="object")return ee({result:{error:oe},context:{category:p},stack:S});let w={collectionValueProfiles:g,collectionValue:v,matchUpValue:y,scoreValue:I,setValue:b};if(!Object.values(w).filter(Boolean).length&&!i&&!r&&!o&&!s&&!u)return ee({result:{error:Xe},stack:S});if(Object.values(w).filter(Boolean).length>1)return ee({info:"Only one value assignment allowed per collectionDefinition",result:{error:oe},stack:S});let U=Hd({drawDefinition:a,structureId:c,matchUpId:d,eventId:m,event:f});if(U.error)return ee({result:U,stack:S});let{matchUp:T,structure:D,tieFormat:P}=U,E=qr(P),R=P==null?void 0:P.collectionDefinitions.find(L=>L.collectionId===l),N=E==null?void 0:E.collectionDefinitions.find(L=>L.collectionId===l);if(!R)return ee({info:"source collectionDefinition",result:{error:$r},context:{collectionId:l},stack:S});let A=v??y??I??b;if(g!=null&&g.length){let L=UG({matchUpCount:s??(R==null?void 0:R.matchUpCount)??0,collectionValueProfiles:g});if(L.errors)return ee({result:{error:oe},info:L.errors,stack:S})}else if(A&&!ot(A))return ee({result:{error:oe},info:"value is not an integer",context:{value:A},stack:S});let M=(L,B)=>Vi(Object.keys(L),Object.keys(B)).length===Object.keys(L).length&&Vi(Object.values(L),Object.values(B)).length===Object.values(L).length,C=g&&(!R.collectionValueProfiles||!M(R.collectionValueProfiles,g)),O=ot(v)&&R.collectionValue!==v||ot(y)&&R.matchUpValue!==y||ot(I)&&R.scoreValue!==I||ot(b)&&R.setValue!==b||C,k=[];if(O&&(N.collectionValueProfiles=void 0,N.collectionValue=void 0,N.matchUpValue=void 0,N.scoreValue=void 0,N.setValue=void 0,Object.assign(N,w),k.push({collectionId:l,...Ge(w)})),(ot(I)||ot(b))&&N.collectionGroupNumber){let L=N.collectionGroupNumber;E.collectionDefinitions=E.collectionDefinitions.map(B=>{let{collectionGroupNumber:V,...G}=B;return V===L?G:B}),E.collectionGroups=E.collectionGroups.filter(({groupNumber:B})=>B!==L),k.push({collectionId:l,change:"collectionGroupNumber removed"})}let{aggregateValue:x,valueGoal:F}=hh(E),$=Ge({aggregateValue:x,valueGoal:F});if(($.aggregateValue!==(P==null?void 0:P.winCriteria.aggregateValue)||$.valueGoal!==(P==null?void 0:P.winCriteria.valueGoal))&&(E.winCriteria=$,k.push({collectionId:l,winCriteria:$})),ot(i)&&R.collectionOrder!==i&&(N.collectionOrder=i,k.push({collectionId:l,collectionOrder:i})),r&&R.collectionName!==r&&(N.collectionName=r,k.push({collectionId:l,collectionName:r})),o&&R.matchUpFormat!==o&&(N.matchUpFormat=o,k.push({collectionId:l,matchUpFormat:o})),ot(s)&&R.matchUpCount!==s&&(N.matchUpCount=s,k.push({collectionId:l,matchUpCount:s})),u&&R.matchUpType!==u)return ee({result:{error:Q0},context:{matchUpType:u},stack:S});p&&R.category!==p&&(N.category=p,k.push({collectionId:l,category:p})),h&&R.gender!==h&&(N.gender=h,k.push({collectionId:l,gender:h}));let _=Ge(E);if(U=Hn({tieFormat:_}),U.error)return ee({result:U,stack:S});if(!k.length)return ee({result:{...J,modifications:k}});if((P==null?void 0:P.tieFormatName)!==n?(_.tieFormatName=n,k.push({tieFormatName:n})):k.length&&(delete _.tieFormatName,k.push("tieFormatName removed: modifications without new tieFormatName")),U=Che({tieFormat:_,updateInProgressMatchUps:t,tournamentRecord:e,drawDefinition:a,structure:D,eventId:m,matchUp:T,event:f}),!U.error){let{appliedPolicies:L}=$t({tournamentRecord:e}),B=Ge({collectionDefinition:N,drawId:a==null?void 0:a.drawId,action:S,structureId:c,matchUpId:d,eventId:m});GD({appliedPolicies:L,drawDefinition:a,auditData:B})}return ee({result:{...U,modifications:k},stack:S})}function Mhe({updateInProgressMatchUps:t,drawDefinition:e,structureId:i,structure:r,matchUpId:n,matchUp:a}){var s,l;let o=[];return n&&a?o=[a]:i&&r?o=((s=Wt({matchUpFilters:{matchUpTypes:[hi]},structure:r}))==null?void 0:s.matchUps)??[]:e&&(o=((l=Sn({matchUpFilters:{matchUpTypes:[hi]},drawDefinition:e}))==null?void 0:l.matchUps)??[]),{targetMatchUps:o.filter(u=>!u.winningSide&&u.matchUpStatus!==qi&&(t||u.matchUpStatus!==ss&&!Ir(u)))}}function Nhe({updateInProgressMatchUps:t,tournamentRecord:e,drawDefinition:i,targetMatchUps:r,tieFormat:n,event:a}){for(let o of r){let s=!!o.tieFormat;s&&(o.tieFormat=qr(n));let l;if(t){let u=$t({tournamentRecord:e,drawDefinition:i,event:a}).appliedPolicies,c=Yu({matchUpId:o.matchUpId,exitWhenNoValues:!0,tournamentRecord:e,appliedPolicies:u,drawDefinition:i,event:a});if(c.error)return c;l=c.score}s&&!l&&Rt({tournamentId:e==null?void 0:e.tournamentId,context:"updateTargetTeamMatchUps",eventId:a==null?void 0:a.eventId,matchUp:o,drawDefinition:i})}return{...J}}function N5({updateInProgressMatchUps:t,originalValueGoal:e,tournamentRecord:i,wasAggregateValue:r,tieFormatName:n,drawDefinition:a,structureId:o,structure:s,tieFormat:l,matchUpId:u,matchUp:c,eventId:d,event:p}){let{aggregateValue:m,valueGoal:h}=hh(l);l.winCriteria=Ge({aggregateValue:m,valueGoal:h}),(e&&e!==h||m&&!r)&&(n?l.tieFormatName=n:delete l.tieFormatName);let{targetMatchUps:f}=Mhe({updateInProgressMatchUps:t,drawDefinition:a,structureId:o,structure:s,matchUpId:u,matchUp:c});Nhe({updateInProgressMatchUps:t,tournamentRecord:i,targetMatchUps:f,drawDefinition:a,tieFormat:l,event:p});let g=Ge(l),v=Hn({tieFormat:g});if(v.error)return v;if(d&&p)p.tieFormat=g;else if(u&&c)c.tieFormat=l;else if(s)s.tieFormat=g;else if(a)a.tieFormat=g;else if(!c||!a)return{error:_e};return li({drawDefinition:a,eventId:p==null?void 0:p.eventId}),{...J}}function A5({updateInProgressMatchUps:t=!0,collectionGroupNumber:e,tournamentRecord:i,drawDefinition:r,tieFormatName:n,structureId:a,matchUpId:o,matchUp:s,eventId:l,event:u}){if(!e)return{error:Xe};if(isNaN(e))return{error:oe};let c="removeCollectionGroup",d=s?void 0:Hd({drawDefinition:r,structureId:a,matchUpId:o,eventId:l,event:u});if(d!=null&&d.error)return ee({result:d,stack:c});let p=d==null?void 0:d.structure;s=s??(d==null?void 0:d.matchUp);let m=d==null?void 0:d.tieFormat,h=m==null?void 0:m.winCriteria.valueGoal,f=m==null?void 0:m.winCriteria.aggregateValue,g=qr(m);if(d=Hn({tieFormat:g}),d.error)return ee({result:d,stack:c});let v=[];if(g.collectionDefinitions=g.collectionDefinitions.map(y=>{let{collectionGroupNumber:I,...b}=y;return I!==e?y:(v.push(y.collectionId),b)}),g.collectionGroups=g.collectionGroups.filter(({groupNumber:y})=>y!==e),d=N5({updateInProgressMatchUps:t,originalValueGoal:h,wasAggregateValue:f,tournamentRecord:i,drawDefinition:r,tieFormatName:n,structureId:a,structure:p,tieFormat:g,matchUpId:o,matchUp:s,eventId:l,event:u}),!d.error){let{appliedPolicies:y}=$t({tournamentRecord:i}),I=Ge({drawId:r==null?void 0:r.drawId,collectionGroupNumber:e,action:c,structureId:a,matchUpId:o,eventId:l});GD({appliedPolicies:y,drawDefinition:r,auditData:I})}return ee({result:{...d,modifiedCollectionIds:v},stack:c})}function qf({tieFormat:t,orderMap:e}){var r;let i=qr(t);return i.collectionDefinitions.forEach(n=>{let a=e[n.collectionId];a&&(n.collectionOrder=a)}),(r=i.collectionDefinitions)==null||r.sort((n,a)=>Sf(n.collectionOrder)-Sf(a.collectionOrder)),i}function O5({tournamentRecord:t,drawDefinition:e,structureId:i,matchUpId:r,orderMap:n,eventId:a,matchUp:o,event:s}){if(typeof n!="object"||!Object.values(n).every(l=>ot(l)))return ee({result:{error:oe},context:{orderMap:n}});if(a&&(s!=null&&s.tieFormat))SV({tournamentRecord:t,event:s,orderMap:n});else if(r){let l=e&&wi({drawDefinition:e,matchUpId:r});if(l!=null&&l.error)return l;if(o=l.matchUp,!o)return{error:na};o!=null&&o.tieFormat&&(o.tieFormat=qf({tieFormat:o.tieFormat,orderMap:n}),Rt({tournamentId:t==null?void 0:t.tournamentId,eventId:s==null?void 0:s.eventId,drawDefinition:e,matchUp:o}))}else if(i){let l=et({drawDefinition:e,structureId:i});if(l.error)return l;let u=l.structure;if(u!=null&&u.tieFormat)u.tieFormat=qf({tieFormat:u.tieFormat,orderMap:n}),k5({eventId:s==null?void 0:s.eventId,tournamentRecord:t,drawDefinition:e,structure:u,orderMap:n}),li({drawDefinition:e,structureIds:[u.structureId]});else if(e.tieFormat)d1({structureIds:[i],tournamentRecord:t,drawDefinition:e,orderMap:n,event:s});else if(s!=null&&s.tieFormat)SV({structureIds:[i],tournamentRecord:t,orderMap:n,event:s});else return{error:$r}}else if(e!=null&&e.tieFormat)d1({tournamentRecord:t,drawDefinition:e,orderMap:n,event:s});else return{error:$r};return{...J}}function SV({tournamentRecord:t,structureIds:e,orderMap:i,event:r}){let n=qf({tieFormat:r.tieFormat,orderMap:i});e!=null&&e.length||(r.tieFormat=n);for(let a of r.drawDefinitions??[])d1({tournamentRecord:t,drawDefinition:a,structureIds:e,orderMap:i,event:r})}function d1({tournamentRecord:t,drawDefinition:e,structureIds:i,orderMap:r,event:n}){let a=e.tieFormat??(n==null?void 0:n.tieFormat),o=qf({tieFormat:a,orderMap:r});i!=null&&i.length||(e.tieFormat=o);let s=[];for(let l of e.structures??[])i!=null&&i.length&&!i.includes(l.structureId)||((l.tieFormat||i!=null&&i.includes(l.structureId))&&(l.tieFormat=qf({tieFormat:l.tieFormat??e.tieFormat??(n==null?void 0:n.tieFormat),orderMap:r})),k5({eventId:n==null?void 0:n.eventId,tournamentRecord:t,drawDefinition:e,structure:l,orderMap:r}),s.push(l.structureId));li({drawDefinition:e,structureIds:s})}function k5({tournamentRecord:t,drawDefinition:e,structure:i,orderMap:r,eventId:n}){var o;let a=(o=Wt({matchUpFilters:{matchUpTypes:[hi]},structure:i}))==null?void 0:o.matchUps;for(let s of a)s.tieFormat&&(s.tieFormat=qf({tieFormat:s.tieFormat,orderMap:r}),Rt({tournamentId:t==null?void 0:t.tournamentId,drawDefinition:e,eventId:n,matchUp:s}))}function Ix({updateInProgressMatchUps:t=!0,tieFormatComparison:e,tournamentRecord:i,drawDefinition:r,tieFormatName:n,collectionId:a,structureId:o,matchUpId:s,eventId:l,matchUp:u,event:c}){var E,R,N,A,M;let d="removeCollectionDefinition",p=u?void 0:Hd({drawDefinition:r,structureId:o,matchUpId:s,eventId:l,event:c});if(p!=null&&p.error)return ee({result:p,stack:d});let m=p==null?void 0:p.structure;u=u??(p==null?void 0:p.matchUp);let h=p==null?void 0:p.tieFormat,f=qr(h);if(p=Hn({tieFormat:f}),p.error)return ee({result:p,stack:d});let g=(E=f==null?void 0:f.collectionDefinitions)==null?void 0:E.find(C=>C.collectionId===a);if(!g)return ee({result:{error:$r,collectionId:a}});f.collectionDefinitions=f.collectionDefinitions.filter(C=>C.collectionId!==a),g.collectionGroupNumber&&(f.collectionDefinitions=f.collectionDefinitions.map(C=>{let{collectionGroupNumber:O,...k}=C;return k}),f.collectionGroups=f.collectionGroups.filter(({groupNumber:C})=>C!==g.collectionGroupNumber));let{aggregateValue:v,valueGoal:y}=hh(f);f.winCriteria=Ge({aggregateValue:v,valueGoal:y});let I=h==null?void 0:h.winCriteria.valueGoal,b=h==null?void 0:h.winCriteria.aggregateValue;(I&&I!==y||v&&!b)&&(n?f.tieFormatName=n:delete f.tieFormatName);let S=[];s&&u?S=[u]:o&&m?S=((R=Wt({matchUpFilters:{matchUpTypes:[hi]},structure:m}))==null?void 0:R.matchUps)??[]:r?S=((N=Sn({matchUpFilters:{matchUpTypes:[hi]},drawDefinition:r}))==null?void 0:N.matchUps)??[]:c&&(S=((A=tu({matchUpFilters:{matchUpTypes:[hi]},drawDefinition:r}))==null?void 0:A.matchUps)??[]);let w=(S||[]).filter(C=>{var x,F,$;let O=(F=(x=C.tieMatchUps)==null?void 0:x.filter(_=>_.collectionId===a))==null?void 0:F.some(Ir),k=e&&C.tieFormat?($=Cu({descendant:C.tieFormat,ancestor:f}))==null?void 0:$.different:!1;return t&&!O||!C.winningSide&&C.matchUpStatus!==qi&&(t||C.matchUpStatus!==ss&&!Ir(C)&&!k)});if(!w.length)return{error:Mg};let{appliedPolicies:U}=$t({tournamentRecord:i});if(s&&u&&t){let C=(M=u.tieMatchUps)==null?void 0:M.filter(O=>O.collectionId===a);for(let O of C??[]){let k=xb({matchUpId:O.matchUpId,tieMatchUpId:u==null?void 0:u.matchUpId,winningSide:void 0,removeScore:!0,tournamentRecord:i,appliedPolicies:U,drawDefinition:r,event:c});if(k.error||(k=wi({drawDefinition:r,matchUpId:s}),k.error))return k;u=k==null?void 0:k.matchUp}}let T=[];for(let C of w){for(let O of(C==null?void 0:C.sides)??[])O.lineUp=(O.lineUp??[]).map(k=>({participantId:k.participantId,collectionAssignments:((k==null?void 0:k.collectionAssignments)??[]).filter(x=>x.collectionId!==a)}));if(C.tieMatchUps=(C.tieMatchUps??[]).filter(O=>{let k=O.collectionId===a;return k&&T.push(O.matchUpId),!k}),C.tieFormat&&(C.tieFormat=qr(f)),t){let O=Yu({matchUpId:C.matchUpId,exitWhenNoValues:!0,tournamentRecord:i,appliedPolicies:U,drawDefinition:r,event:c});if(O.error)return O}Rt({tournamentId:i==null?void 0:i.tournamentId,eventId:c==null?void 0:c.eventId,drawDefinition:r,context:d,matchUp:C})}T.length&&zu({tournamentId:i==null?void 0:i.tournamentId,matchUpIds:T,eventId:c==null?void 0:c.eventId,drawDefinition:r});let D=Ge(f);if(p=Hn({tieFormat:D}),p.error)return ee({result:p,stack:d});if(l&&c)c.tieFormat=D;else if(s&&u)u.tieFormat=D;else if(m)m.tieFormat=D;else if(r)r.tieFormat=D;else if(!u||!r)return{error:_e};li({drawDefinition:r,eventId:c==null?void 0:c.eventId});let P=Ge({drawId:r==null?void 0:r.drawId,action:d,collectionId:a,structureId:o,matchUpId:s,eventId:l});return GD({appliedPolicies:U,drawDefinition:r,auditData:P}),{tieFormat:D,deletedMatchUpIds:T,targetMatchUps:w,...J}}function x5({updateInProgressMatchUps:t=!0,tournamentRecord:e,groupDefinition:i,drawDefinition:r,collectionIds:n,tieFormatName:a,structureId:o,matchUpId:s,matchUp:l,eventId:u,event:c}){let d="addCollectionGroup";if(!Array.isArray(n))return ee({result:{error:Xe},stack:d});let p=l?void 0:Hd({drawDefinition:r,structureId:o,matchUpId:s,eventId:u,event:c});if(p!=null&&p.error)return ee({result:p,stack:d});let m=p==null?void 0:p.structure;l=l||(p==null?void 0:p.matchUp);let h=p==null?void 0:p.tieFormat,f=h==null?void 0:h.winCriteria.valueGoal,g=qr(h);if(p=Hn({tieFormat:g}),p.error)return ee({result:p,stack:d});for(let y of g.collectionDefinitions){let{collectionId:I,collectionGroupNumber:b}=y;if(b&&n.includes(I))return ee({info:"collectionIds cannot be part of other collectionGroups",result:{error:oe},stack:d})}let v=(g.collectionGroups||[]).reduce((y,I)=>I.groupNumber>y?I.groupNumber:y,0)+1;return i.groupNumber=v,g.collectionDefinitions=g.collectionDefinitions.map(y=>n.includes(y.collectionId)?{...y,collectionGroupNumber:v}:y),g.collectionGroups=[...g.collecitonGroups||[],i],N5({updateInProgressMatchUps:t,originalValueGoal:f,tournamentRecord:e,drawDefinition:r,tieFormatName:a,structureId:o,structure:m,tieFormat:g,matchUpId:s,matchUp:l,eventId:u,event:c})}function yx({updateInProgressMatchUps:t=!0,collectionDefinition:e,referenceCategory:i,tournamentRecord:r,policyDefinitions:n,enforceCategory:a,referenceGender:o,drawDefinition:s,tieFormatName:l,enforceGender:u,structureId:c,matchUpId:d,matchUp:p,eventId:m,uuids:h,event:f}){var F,$;let g="addCollectionDefinition",v=$t({tournamentRecord:r,drawDefinition:s,event:f}).appliedPolicies??{},y=(n==null?void 0:n[kr])??(v==null?void 0:v[kr]);a=a??((F=y==null?void 0:y.participants)==null?void 0:F.enforceCategory);let I=(u??(($=y==null?void 0:y.participants)==null?void 0:$.enforceGender))!==!1,b=!!((i??(f==null?void 0:f.category))&&a!==!1),S=!!((o??(f==null?void 0:f.gender))&&I),w=xy({referenceCategory:i??(f==null?void 0:f.category),collectionDefinition:e,referenceGender:o,checkCategory:b,checkGender:S,event:f});if(w.error)return ee({result:w,stack:g});let U=p!=null&&p.tieFormat?void 0:Hd({drawDefinition:s,structureId:c,matchUpId:d,eventId:m,event:f});if(U!=null&&U.error)return ee({result:{error:U.error},stack:g});let T=U==null?void 0:U.structure;p=p??(U==null?void 0:U.matchUp);let D=(p==null?void 0:p.tieFormat)??(U==null?void 0:U.tieFormat),P=qr(D);if(U=Hn({tieFormat:P}),U==null?void 0:U.error)return ee({result:{error:U.error},stack:g});if(!e.collectionId)e.collectionId=Gt();else if(P.collectionDefinitions.map(({collectionId:_})=>_).includes(e.collectionId))return ee({context:{collectionId:e.collectionId},result:{error:TH}});P.collectionDefinitions.push(e),P.collectionDefinitions.sort((_,L)=>(_.collectionOrder||0)-(L.collectionOrder||0)).forEach((_,L)=>_.collectionOrder=L+1);let{aggregateValue:E,valueGoal:R}=hh(P);P.winCriteria=Ge({aggregateValue:E,valueGoal:R});let N=D==null?void 0:D.winCriteria.valueGoal,A=D==null?void 0:D.winCriteria.aggregateValue;(N&&N!==R||E&&!A)&&(l?P.tieFormatName=l:delete P.tieFormatName);let M=[],C=[],O=[],k=Ge(P);if(U=Hn({tieFormat:k}),U==null?void 0:U.error)return ee({result:{error:U.error},stack:g});if(m&&f){f.tieFormat=k;for(let _ of f.drawDefinitions??[])if(!_.tieFormat)for(let L of _.structures??[]){if(L.tieFormat)continue;let B=DE({updateInProgressMatchUps:t,collectionDefinition:e,structure:L,uuids:h});C.push(...B.newMatchUps),O.push(...B.targetMatchUps),M.push(L.structureId)}mU({modifiedMatchUps:O,eventId:f==null?void 0:f.eventId,modifiedStructureIds:M,tournamentRecord:r,drawDefinition:s,addedMatchUps:C,stack:g})}else if(c&&T){T.tieFormat=k;let _=DE({updateInProgressMatchUps:t,collectionDefinition:e,structure:T,uuids:h});C.push(..._.newMatchUps),O=_.targetMatchUps,mU({modifiedMatchUps:O,eventId:f==null?void 0:f.eventId,modifiedStructureIds:M,tournamentRecord:r,drawDefinition:s,addedMatchUps:C,stack:g})}else if(d&&p){if(!WS({matchUp:p,updateInProgressMatchUps:t}))return ee({result:{error:TN},stack:g});p.tieFormat=k;let _=Ib({collectionDefinition:e,matchUp:p,uuids:h});Array.isArray(p.tieMatchUps)||(p.tieMatchUps=[]),p.tieMatchUps.push(..._),C.push(..._),mU({modifiedMatchUps:[p],eventId:f==null?void 0:f.eventId,modifiedStructureIds:M,tournamentRecord:r,drawDefinition:s,addedMatchUps:C,stack:g})}else if(s){s.tieFormat=k;for(let _ of s.structures??[]){let L=DE({updateInProgressMatchUps:t,collectionDefinition:e,structure:_,uuids:h});M.push(_.structureId),C.push(...L.newMatchUps),O.push(...L.targetMatchUps)}mU({modifiedMatchUps:O,eventId:f==null?void 0:f.eventId,tournamentRecord:r,drawDefinition:s,addedMatchUps:C,stack:g})}else return{error:_e};let x=Ge({drawId:s==null?void 0:s.drawId,collectionDefinition:e,action:g,structureId:c,matchUpId:d,eventId:m});return GD({appliedPolicies:v,drawDefinition:s,auditData:x}),{tieFormat:k,targetMatchUps:O,addedMatchUps:C,...J}}function DE({updateInProgressMatchUps:t,collectionDefinition:e,structure:i,uuids:r}){var o;let n=[],a=((o=Wt({matchUpFilters:{matchUpTypes:[hi]},structure:i}))==null?void 0:o.matchUps).filter(s=>WS({matchUp:s,updateInProgressMatchUps:t})&&!s.tieFormat);for(let s of a){let l=Ib({collectionDefinition:e,matchUp:s,uuids:r});Array.isArray(s.tieMatchUps)||(s.tieMatchUps=[]),s.tieMatchUps.push(...l),n.push(...l)}return{newMatchUps:n,targetMatchUps:a}}function mU({modifiedStructureIds:t,tournamentRecord:e,modifiedMatchUps:i,drawDefinition:r,addedMatchUps:n,eventId:a,stack:o}){Dc({tournamentId:e==null?void 0:e.tournamentId,matchUps:n,drawDefinition:r,eventId:a}),i==null||i.forEach(s=>{Rt({tournamentId:e==null?void 0:e.tournamentId,drawDefinition:r,context:o,matchUp:s,eventId:a})}),li({structureIds:t,drawDefinition:r,eventId:a})}function F5({updateInProgressMatchUps:t=!1,tieFormatComparison:e,modifiedTieFormat:i,tournamentRecord:r,considerations:n,drawDefinition:a,structureId:o,matchUpId:s,eventId:l,uuids:u,event:c}){let d="modifyTieFormat";if(!Hn({tieFormat:i}).valid)return ee({result:{error:Pl},info:"falied validation",stack:d});let p=Hd({drawDefinition:a,structureId:o,matchUpId:s,eventId:l,event:c});if(p.error)return ee({result:p,stack:d});let{matchUp:m,tieFormat:h}=p,f=qr(h),g=Cu({descendant:i,ancestor:f,considerations:n});if(g.invalid)return ee({context:{invalid:g.invalid},result:{error:Pl},stack:d});if(!(g!=null&&g.different))return ee({result:{...J},info:"Nothing to do",stack:d});let v=f.collectionDefinitions.map(({collectionId:D})=>D),y=i.collectionDefinitions.map(({collectionId:D})=>D),I=v.filter(D=>!y.includes(D)),b=i.collectionDefinitions.filter(({collectionId:D})=>!v.includes(D)),S=b.map(Ta("collectionId")),w=[],U,T=i.tieFormatName;for(let D of i.collectionDefinitions){if(S.includes(D.collectionId))continue;let P=vx({updateInProgressMatchUps:t,...D,tournamentRecord:r,tieFormatName:T,drawDefinition:a,structureId:o,matchUpId:s,eventId:l,event:c});if(P.modifications&&w.push(...P.modifications),P.error)return ee({result:P,stack:d});P.tieFormat&&(U=P.tieFormat)}for(let D of b){let P=yx({updateInProgressMatchUps:t,collectionDefinition:D,tournamentRecord:r,drawDefinition:a,tieFormatName:T,structureId:o,matchUpId:s,matchUp:m,eventId:l,uuids:u,event:c});if(P.error)return ee({result:P,stack:d});P.tieFormat&&(U=P.tieFormat)}for(let D of I){let P=Ix({updateInProgressMatchUps:t,tieFormatComparison:e,tournamentRecord:r,drawDefinition:a,tieFormatName:T,collectionId:D,structureId:o,matchUpId:s,eventId:l,matchUp:m,event:c});if(P.error)return ee({result:P,stack:d});P.tieFormat&&(U=P.tieFormat)}return(h==null?void 0:h.tieFormatName)!==T?(U.tieFormatName=T,w.push({tieFormatName:T})):(w.length||S.length||I.length)&&(delete U.tieFormatName,w.push("tieFormatName removed: modifications without new tieFormatName")),U.collectionDefinitions=U.collectionDefinitions.sort((D,P)=>Sf(D.collectionOrder)-Sf(P.collectionOrder)).map((D,P)=>({...D,collectionOrder:P+1})),{processedTieFormat:qr(U),modifications:w,...J}}function L5({tournamentRecord:t}){if(!t)return{error:ge};let e=0;for(let i of t.events??[]){let r=i.tieFormats??[],n=c=>{if(!c.tieFormat)return;let d;for(let p of r)Cu({descendant:c.tieFormat,ancestor:p}).different||(d=p.tieFormatId);if(d)c.tieFormatId=d,delete c.tieFormat;else{let p=Me(c.tieFormat,void 0,!0);p.tieFormatId||(p.tieFormatId=Gt()),c.tieFormatId=p.tieFormatId,delete c.tieFormat,r.push(p),e+=1}},a=i.eventType;n({tieFormat:i.tieFormat,eventType:a});for(let c of i.drawDefinitions??[]){n({tieFormat:c.tieFormat,eventType:a});for(let d of c.structures??[])n({tieFormat:d.tieFormat,eventType:a})}let o=(c,d)=>{var m;let p=(m=l.matchUps)==null?void 0:m.find(h=>h.matchUpId===c);p&&(p.tieFormatId=d,delete p.tieFormat,Rt({tournamentId:t==null?void 0:t.tournamentId,eventId:i.eventId,matchUp:p}))},s=c=>{let d=Me(c.tieFormat,void 0,!0);d.tieFormatId||(d.tieFormatId=Gt()),r.push(d),e+=1,o(c.matchUpId,d.tieFormatId)},l=tu({matchUpFilters:{matchUpTypes:[ka]},event:i}),u=l.matchUps??[];for(let c of u){let d;for(let p of r)c.tieFormat&&Cu({descendant:c.tieFormat,ancestor:p}).different||(d=p.tieFormatId);d?o(c.matchUpId,d):s(c)}r.length&&(i.tieFormats=r)}return{...J,addedCount:e}}var _5={};yt(_5,{addDrawDefinitionExtension:()=>IT,addEventExtension:()=>zc,addEventTimeItem:()=>dh,addExtension:()=>Lt,addNotes:()=>qT,addOnlineResource:()=>z5,addParticipantExtension:()=>Yz,addParticipantTimeItem:()=>RO,addTimeItem:()=>vl,addTournamentExtension:()=>uA,addTournamentTimeItem:()=>Ub,analyzeDraws:()=>Sb,analyzeTournament:()=>lk,copyTournamentRecord:()=>B5,createTournamentRecord:()=>BD,generate:()=>$5,getAggregateTeamResults:()=>sk,getAllowedDrawTypes:()=>uD,getAllowedMatchUpFormats:()=>nk,getAppliedPolicies:()=>$t,getCompetitionDateRange:()=>dD,getCompetitionPenalties:()=>ak,getPolicyDefinitions:()=>Wu,getTournamentInfo:()=>mh,getTournamentPenalties:()=>cD,getTournamentPersons:()=>ok,getTournamentPoints:()=>pD,getTournamentStructures:()=>lO,getTournamentTimeItem:()=>MT,mutate:()=>V5,query:()=>z6,removeDrawDefinitionExtension:()=>Kz,removeEventExtension:()=>yT,removeExtension:()=>Un,removeNotes:()=>SO,removeOnlineResource:()=>H5,removeParticipantExtension:()=>Xz,removeTournamentExtension:()=>cA,setTournamentCategories:()=>Y5,setTournamentDates:()=>HD,setTournamentEndDate:()=>X5,setTournamentName:()=>W5,setTournamentNotes:()=>q5,setTournamentStartDate:()=>K5,setTournamentStatus:()=>G5});var $5={};yt($5,{copyTournamentRecord:()=>B5,createTournamentRecord:()=>BD});function B5(t){var p,m;let e=ze(t,[{tournamentRecord:!0,startDate:!0,endDate:!1,tournamentName:!0}]);if(e.error)return e;let{startDate:i,endDate:r}=t.tournamentRecord,n=24*60*60*1e3,a=(i&&r?new Date(pt(r)).getTime()-new Date(pt(i)).getTime():0)/n,o=t.endDate||HN(t.startDate,a),s=h=>h==null?void 0:h.filter(({itemType:f})=>{var g;return(g=t.itemTypeList)==null?void 0:g.includes(f)}),l=h=>h==null?void 0:h.filter(({name:f})=>{var g;return(g=t.extensionList)==null?void 0:g.includes(f)}),u=h=>{let{timeItems:f,extensions:g,...v}=h;return Me({...v,timeItems:s(f),extensions:l(g)},!1,!0)},c=h=>{let{drawDefinitions:f,timeItems:g,extensions:v,startDate:y,endDate:I,...b}=h;return Me({extensions:l(v),timeItems:s(g),startDate:t.startDate,endDate:o,...b},!1,!0)},d={participants:t.copyParticipants?((p=t.tournamentRecord.participants)==null?void 0:p.map(u))??[]:[],parentOrganisation:Me({...t.tournamentRecord.parentOrganisation},!1,!0),venues:Me(t.tournamentRecord.venues??[],!1,!0),extensions:l(t.tournamentRecord.extensions),timeItems:s(t.tournamentRecord.timeItems),events:((m=t.tournamentRecord.events)==null?void 0:m.map(c))??[],weekdays:[...t.tournamentRecord.weekdays??[]],tournamentName:t.tournamentName,startDate:t.startDate,tournamentId:Gt(),endDate:o};return{...J,tournamentRecord:d}}var V5={};yt(V5,{addDrawDefinitionExtension:()=>IT,addEventExtension:()=>zc,addEventTimeItem:()=>dh,addExtension:()=>Lt,addNotes:()=>qT,addOnlineResource:()=>z5,addParticipantExtension:()=>Yz,addParticipantTimeItem:()=>RO,addTimeItem:()=>vl,addTournamentExtension:()=>uA,addTournamentTimeItem:()=>Ub,removeDrawDefinitionExtension:()=>Kz,removeEventExtension:()=>yT,removeExtension:()=>Un,removeNotes:()=>SO,removeOnlineResource:()=>H5,removeParticipantExtension:()=>Xz,removeTournamentExtension:()=>cA,setTournamentCategories:()=>Y5,setTournamentDates:()=>HD,setTournamentEndDate:()=>X5,setTournamentName:()=>W5,setTournamentNotes:()=>q5,setTournamentStartDate:()=>K5,setTournamentStatus:()=>G5});var Ahe="ABANDONED",Ohe="ACTIVE",khe="CANCELLED",xhe="COMPLETED",Fhe="IN_PROGRESS",j5={ABANDONED:Ahe,ACTIVE:Ohe,CANCELLED:khe,COMPLETED:xhe,IN_PROGRESS:Fhe};function G5({tournamentRecord:t,status:e}){return t?e&&!Object.keys(j5).includes(e)?{error:oe,info:"Unknown status"}:(t.tournamentStatus=e,{...J}):{error:ge}}function H5(t){var u,c,d;let e=ze(t,[{tournamentRecord:!0,onlineResource:!0}]);if(e.error)return e;let{tournamentRecord:i,onlineResource:r,organisationId:n,participantId:a,personId:o,courtId:s,venueId:l}=t;if(n){if(((u=i.parentOrganisation)==null?void 0:u.parentOrganisationId)!==n)return ee({result:{error:$r}});Yh({element:i.parentOrganisation,onlineResource:r})}else if(a||o){let p=(i.participants??[]).find(m=>{var h;return o&&((h=m.person)==null?void 0:h.personId)===o||m.participantId===a});if(!p)return ee(o?{result:{error:$r}}:{result:{error:zi}});if(o){if(((c=p.person)==null?void 0:c.personId)!==o)return ee({result:{error:Hm}});Yh({element:p.person,onlineResource:r})}else Yh({element:p,onlineResource:r})}else if(s){let p=(d=(i.venues??[]).filter(m=>!l||m.venueId===l).flatMap(m=>(m.courts??[]).filter(h=>h.courtId===s)))==null?void 0:d[0];if(!p)return ee({result:{error:Cg}});Yh({element:p,onlineResource:r})}else if(l){let p=(i.venues??[]).find(m=>m.venueId===l);if(!p)return ee({result:{error:Wm}});Yh({element:p,onlineResource:r})}else Yh({element:i,onlineResource:r}),lt({payload:{parentOrganisation:i.parentOrganisation,onlineResources:i.onlineResources,tournamentId:i.tournamentId},topic:dp});return{...J}}function Yh({element:t,onlineResource:e}){let i=(t.onlineResources??[]).filter(r=>!((r==null?void 0:r[Ef])===e[Ef]&&(r==null?void 0:r[Cf])===e[Cf]&&(r==null?void 0:r[Mf])===e[Mf]));t.onlineResources=i}function z5(t){var u,c,d;let e=ze(t,[{tournamentRecord:!0,onlineResource:!0}]);if(e.error)return e;let{tournamentRecord:i,onlineResource:r,organisationId:n,participantId:a,personId:o,courtId:s,venueId:l}=t;if(n){if(((u=i.parentOrganisation)==null?void 0:u.parentOrganisationId)!==n)return ee({result:{error:$r}});Kh({element:i.parentOrganisation,onlineResource:r})}else if(a||o){let p=(i.participants??[]).find(m=>{var h;return o&&((h=m.person)==null?void 0:h.personId)===o||m.participantId===a});if(!p)return ee(o?{result:{error:$r}}:{result:{error:zi}});if(o){if(((c=p.person)==null?void 0:c.personId)!==o)return ee({result:{error:Hm}});Kh({element:p.person,onlineResource:r})}else Kh({element:p,onlineResource:r})}else if(s){let p=(d=(i.venues??[]).filter(m=>!l||m.venueId===l).flatMap(m=>(m.courts??[]).filter(h=>h.courtId===s)))==null?void 0:d[0];if(!p)return ee({result:{error:Cg}});Kh({element:p,onlineResource:r})}else if(l){let p=(i.venues??[]).find(m=>m.venueId===l);if(!p)return ee({result:{error:Wm}});Kh({element:p,onlineResource:r})}else Kh({element:i,onlineResource:r}),lt({payload:{parentOrganisation:i.parentOrganisation,onlineResources:i.onlineResources,tournamentId:i.tournamentId},topic:dp});return{...J}}function Kh({element:t,onlineResource:e}){let i=(t.onlineResources??[]).filter(r=>(r==null?void 0:r[Ef])!==e[Ef]&&(r==null?void 0:r[Cf])!==e[Cf]&&(r==null?void 0:r[Mf])!==e[Mf]);return i.push(e),t.onlineResources=i,{...J}}function W5({tournamentRecord:t,promotionalName:e,tournamentName:i,formalName:r}){if(!t)return{error:ge};let n=t.tournamentId,a={tournamentId:n};return i&&i!==t.tournamentName&&(t.tournamentName=i,a.tournamentName=i),e&&e!==t.promotionalName&&(t.promotionalName=e,a.promotionalName=e),r&&r!==t.formalName&&(t.formalName=r,a.formalName=r),t.promotionalName===t.tournamentName&&(delete t.promotionalName,a.promotionalName=""),t.formalName===t.tournamentName&&(delete t.formalName,a.formalName=""),Object.keys(a).length>1&&lt({topic:dp,payload:{parentOrganisation:t.parentOrganisation,tournamentId:n,...a}}),{...J}}function q5({tournamentRecord:t,notes:e}){if(!t)return{error:ge};let i=e?qT({element:t,notes:e}):SO({element:t});return i.error?i:(lt({topic:dp,payload:{parentOrganisation:t.parentOrganisation,tournamentId:t.tournamentId,notes:e??""}}),{...J})}function Y5({tournamentRecord:t,categories:e}){return t?(e=(e||[]).filter(i=>i.categoryName&&i.type),t.tournamentCategories=e,lt({topic:dp,payload:{parentOrganisation:t.parentOrganisation,tournamentId:t.tournamentId,categories:e}}),{...J}):{error:ge}}function Lhe({tournamentRecord:t}){var a,o;if(!t)return{error:ge};let{startDate:e,endDate:i}=t,r=Rf(e,i),n=[];for(let s of t.venues||[])(a=s==null?void 0:s.courts)!=null&&a.length&&n.push(...s.courts);for(let s of n){let{startTime:l,endTime:u}=(s.dateAvailability??[]).reduce((p,m)=>{let h=kt(p.startTime),f=kt(p.endTime);return m.startTime&&kt(m.startTime)<h&&(p.startTime=m.startTime),m.endTime&&kt(m.endTime)>f&&(p.endTime=m.endTime),p},{startTime:"08:00",endTime:"18:00"}),c=r.map(p=>{var m;return((m=s.dateAvailability)==null?void 0:m.find(h=>h.date===p))??{date:p,startTime:l,endTime:u}}),d=(o=s.dateAvailability)==null?void 0:o.find(p=>!p.date);d&&c.unshift(d),s.dateAvailability=c}return{...J}}function HD(t){var m,h;let{tournamentRecord:e,startDate:i,endDate:r,weekdays:n}=t,a=(m=t.activeDates)==null?void 0:m.filter(Boolean),o=ze(t,[{tournamentRecord:!0},{[Kr]:f=>Zs.test(f),[_a]:Ar,startDate:!1,endDate:!1},{[Kr]:f=>f.filter(Boolean).every(g=>Zs.test(g)),[_a]:Ar,activeDates:!1},{[Kr]:P4,weekdays:!1}]);if(o.error)return o;if(r&&i&&new Date(r)<new Date(i))return{error:oe};if(r&&i&&new Date(i)>new Date(r))return{error:oe};if(a!=null&&a.length){let f=i||e.startDate,g=r||e.endDate,v=!f||a.every(I=>new Date(I)>=new Date(f)),y=!g||a.every(I=>new Date(I)<=new Date(g));if(!v||!y)return{error:Ar}}let s;(i&&e.startDate&&new Date(i)>new Date(e.startDate)||r&&e.endDate&&new Date(r)<new Date(e.endDate))&&(s=!0);let l=Rf(e.startDate,e.endDate);i&&(e.startDate=i),r&&(e.endDate=r);let u=Rf(e.startDate,e.endDate),c=l.filter(f=>!u.includes(f)),d=u.filter(f=>!l.includes(f));for(let f of e.events??[])i&&f.startDate&&new Date(f.startDate)<new Date(i)&&(f.startDate=i),r&&f.startDate&&new Date(f.startDate)>new Date(r)&&(f.startDate=i??r),r&&f.endDate&&new Date(f.endDate)>new Date(r)&&(f.endDate=r),i&&f.endDate&&new Date(f.endDate)<new Date(i)&&(f.endDate=r??i);i&&e.endDate&&new Date(i)>new Date(e.endDate)&&(e.endDate=i),r&&e.startDate&&new Date(r)<new Date(e.startDate)&&(e.startDate=r),a&&(e.activeDates=a),n&&(e.weekdays=n);let p=s&&((h=_he({tournamentRecord:e}))==null?void 0:h.unscheduledMatchUpIds);return Lhe({tournamentRecord:e}),lt({payload:Ge({parentOrganisation:e.parentOrganisation,tournamentId:e.tournamentId,activeDates:a,startDate:i,weekdays:n,endDate:r}),topic:dp}),{...J,unscheduledMatchUpIds:p,datesAdded:d,datesRemoved:c}}function K5({tournamentRecord:t,startDate:e}){return e?HD({tournamentRecord:t,startDate:e}):{error:Ar}}function X5({tournamentRecord:t,endDate:e}){return e?HD({tournamentRecord:t,endDate:e}):{error:Ar}}function _he({tournamentRecord:t}){let e=Vr({tournamentRecord:t}).matchUps??[],i=t.startDate&&new Date(t.startDate),r=t.endDate&&new Date(t.endDate),n=[],a=[];for(let o of e){let{schedule:s,matchUpId:l}=o;if(s&&s.scheduledDate){let u=new Date(s.scheduledDate);(i&&u<i||r&&u>r)&&(a.push(l),n.includes(s.scheduledDate)||n.push(s.scheduledDate))}}return n.length&&!_D({scheduledDates:n,tournamentRecord:t}).clearedScheduleCount?{error:DG}:{unscheduledMatchUpIds:a}}var J5={};yt(J5,{addCourt:()=>jD,addCourts:()=>px,addVenue:()=>rb,deleteCourt:()=>o7,deleteVenue:()=>Sx,deleteVenues:()=>t7,disableCourts:()=>i7,disableVenues:()=>r7,enableCourts:()=>n7,enableVenues:()=>a7,generate:()=>Q5,generateCourts:()=>Bk,getCompetitionVenues:()=>Rb,getCourts:()=>Pk,getVenuesAndCourts:()=>Ku,modifyCourt:()=>Tx,modifyCourtAvailability:()=>wx,modifyVenue:()=>s7,mutate:()=>Z5,publicFindVenue:()=>jA,query:()=>s4});var Q5={};yt(Q5,{generateCourts:()=>Bk});var Z5={};yt(Z5,{addCourt:()=>jD,addCourts:()=>px,addVenue:()=>rb,deleteCourt:()=>o7,deleteVenue:()=>Sx,deleteVenues:()=>t7,disableCourts:()=>i7,disableVenues:()=>r7,enableCourts:()=>n7,enableVenues:()=>a7,modifyCourt:()=>Tx,modifyCourtAvailability:()=>wx,modifyVenue:()=>s7});function bx(t){if(!(t!=null&&t.tournamentRecord)&&!Array.isArray(t==null?void 0:t.venueMatchUps))return{error:ge};if(!(t!=null&&t.courtId))return{error:Gm};let{scheduleVisibilityFilters:e,tournamentRecord:i,matchUpFilters:r,venueMatchUps:n,courtId:a}=t,{schedulingProfile:o}=Xu({tournamentRecord:i});if(Array.isArray(n))return{matchUps:l({matchUps:n,courtId:a})};let{matchUps:s}=Vr({scheduleVisibilityFilters:e,tournamentRecord:i,matchUpFilters:r});return{matchUps:l({matchUps:s,courtId:a})};function l({matchUps:u,courtId:c}){let d=u.filter(p=>{var h,f,g;let m=(f=(h=p.schedule)==null?void 0:h.allocatedCourts)==null?void 0:f.map(({courtId:v})=>v);return((g=p.schedule)==null?void 0:g.courtId)===c||(m==null?void 0:m.includes(c))});return $S({matchUps:d,schedulingProfile:o})}}function $he({scheduleVisibilityFilters:t,tournamentRecord:e,matchUpFilters:i,venueId:r}){if(!e)return{error:ge};if(!r)return{error:jc};let{schedulingProfile:n}=Xu({tournamentRecord:e}),{matchUps:a}=Vr({scheduleVisibilityFilters:t,tournamentRecord:e,matchUpFilters:i});return{matchUps:o({matchUps:a,venueId:r})};function o({matchUps:s,venueId:l}){let u=s.filter(c=>{var p,m,h;let d=(m=(p=c.schedule)==null?void 0:p.allocatedCourts)==null?void 0:m.map(({venueId:f})=>f);return((h=c.schedule)==null?void 0:h.venueId)===l||(d==null?void 0:d.includes(l))});return $S({matchUps:u,schedulingProfile:n})}}function wx({tournamentRecord:t,dateAvailability:e,disableNotice:i,venueMatchUps:r,courtId:n,force:a}){var m,h,f;if(!t)return{error:ge};if(!n)return{error:Gm};let o=kY({dateAvailability:e});if(o.error)return o;let{updatedDateAvailability:s,totalMergeCount:l}=Bhe(e);e=s;let u=ah({tournamentRecord:t,courtId:n});if(u.error)return u;let{court:c,venue:d}=u,{matchUps:p}=bx({tournamentRecord:t,venueMatchUps:r,courtId:n});if(p!=null&&p.length){let g=(m=$t({tournamentRecord:t}))==null?void 0:m.appliedPolicies,v=a??((f=(h=g==null?void 0:g[Hc])==null?void 0:h.allowDeletionWithScoresPresent)==null?void 0:f.courts),y=[];y.length&&(v||console.log("throw error: scheduled court matchUps",y.length))}return c&&(c.dateAvailability=e,!i&&d&&lt({payload:{venue:d,tournamentId:t.tournamentId},topic:pp,key:d.venueId})),{...J,totalMergeCount:l}}function Bhe(t){let e=0,i=t.reduce((n,a)=>{let{date:o,startTime:s,endTime:l,bookings:u}=a;return n[o]||(n[o]=[]),n[o].push({startTime:s,endTime:l,bookings:u}),n},{}),r=[];return Object.keys(i).forEach(n=>{i[n].sort(nhe);let{mergedAvailability:a,mergeCount:o}=Vhe(i[n]);r.push(...a.map(s=>({date:n,...s}))),e+=o}),{updatedDateAvailability:r,totalMergeCount:e}}function Vhe(t){let e,i,r,n=t.length,a=0,o=[];for(;t.length&&n;){let l=t.shift(),{startTime:u,endTime:c,bookings:d}=l;if(n-=1,!e)e=u,r=d,i=c;else if(Oy(ir(i),ir(u),!1)>0){let p={startTime:e,endTime:i};r!=null&&r.length&&(p.bookings=r),o.push(p),e=u,r=d,i=c}else d&&(r?r.push(d):r=d),i=c,a+=1}let s={startTime:e,endTime:i};return r!=null&&r.length&&(s.bookings=r),o.push(s),{mergedAvailability:o,mergeCount:a}}function Ux({matchUpsCount:t=0}){let e=`Schedule would be deleted from ${t} ${t===1?"matchUp":"matchUps"}; use { force: true }`;return{error:CH,info:e}}function e7({tournamentRecord:t,drawDefinition:e,matchUpId:i,drawId:r}){let n="removeCourtAssignment";if(!i)return{error:yn};if(!e&&!r)return{error:xs};let a;if(!e){if(!t)return{error:ge};({drawDefinition:e}=Wn({tournamentRecord:t,drawId:r}))}if(e)({matchUp:a}=wi({drawDefinition:e,matchUpId:i}));else{if(!t)return{error:ge};let o=Vr({tournamentRecord:t,inContext:!1}).matchUps??[];({matchUp:a}=c3({matchUps:o,matchUpId:i}))}return a?(a.timeItems&&a.timeItems.find(o=>[Rc,zl].includes(o.itemType))&&(a.timeItems=a.timeItems.filter(({itemType:o})=>![Rc,zl].includes(o)),Rt({tournamentId:t==null?void 0:t.tournamentId,context:n,drawDefinition:e,matchUp:a})),{...J}):{error:dn}}function Sx(t){var l,u,c;if(typeof(t==null?void 0:t.venueId)!="string")return{error:jc};let{tournamentRecord:e,venueId:i,force:r}=t,n=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(!Object.keys(n).length)return{error:ge};let a=Es({tournamentRecords:n,contextFilters:{venueIds:[i]}}).matchUps??[],o=(l=$t({tournamentRecord:e}))==null?void 0:l.appliedPolicies,s=r??((c=(u=o==null?void 0:o[Hc])==null?void 0:u.allowDeletionWithScoresPresent)==null?void 0:c.venues);if(!a.length||s)for(let d of Object.values(n)){for(let m of a){let h=e7({matchUpId:m.matchUpId,drawId:m.drawId,tournamentRecord:d});if(h.error)return h}let p;d.venues=(d.venues??[]).filter(m=>(m==null?void 0:m.venueId)!==i?!0:(p=!0,!1)),p&&lt({payload:{venueId:i,tournamentId:d.tournamentId},topic:wA,key:i})}else return Ux({matchUpsCount:a.length});return Cb({tournamentRecords:n}),{...J}}function t7({tournamentRecord:t,venueIds:e,force:i}){if(!t)return{error:ge};if(!Array.isArray(e))return{error:oe};for(let r of t.venues||[]){let{venueId:n}=r;if(e.includes(n)){let{venueId:a}=r,o=Sx({tournamentRecord:t,venueId:a,force:i});if(o.error)return o}}return{...J}}function i7(t){let{courtIds:e,dates:i}=t,r=Io(t),n=[{[pn]:!0,[gT]:!0}],a=ze(t,n);if(a.error)return a;for(let o of Object.values(r))jhe({tournamentRecord:o,courtIds:e,dates:i});return{...J}}function jhe({tournamentRecord:t,courtIds:e,dates:i}){let r=Array.isArray(i)&&i.length?{dates:i}:!0,n=a=>Lt({extension:{value:r,name:ys},creationTime:!1,element:a});for(let a of t.venues||[])for(let o of a.courts||[])if(e!=null&&e.includes(o.courtId)){let s=n(o);if(s.error)return s}return{...J}}function r7(t){let{tournamentRecords:e,tournamentId:i,venueIds:r}=t,n=[{[pn]:!0,[vT]:!0}],a=ze(t,n);if(a.error)return a;let o=Object.keys(e).filter(s=>!i||s===i);for(let s of o){let l=e[s];Ghe({tournamentRecord:l,venueIds:r})}return{...J}}function Ghe({tournamentRecord:t,venueIds:e}){for(let i of t.venues||[])if(e!=null&&e.includes(i.venueId)){let r=Lt({creationTime:!1,element:i,extension:{name:ys,value:!0}});if(r.error)return r}return{...J}}function n7(t){let e=Io(t),i=[{[pn]:!0}];!t.enableAll&&i.push({[gT]:!0});let r=ze(t,i);if(r.error)return r;let{enableAll:n,courtIds:a,dates:o}=t;for(let s of Object.values(e))Hhe({tournamentRecord:s,courtIds:a,enableAll:n,dates:o});return{...J}}function Hhe({tournamentRecord:t,courtIds:e,enableAll:i,dates:r}){for(let n of t.venues||[])for(let a of n.courts||[])if(i||e!=null&&e.includes(a.courtId))if(Array.isArray(r)){let{extension:o}=gt({element:a,name:ys});if(o){let s=o.value;Array.isArray(s.dates)&&(s.dates=s.dates.filter(l=>!r.includes(l))),Lt({extension:{name:ys,value:s},creationTime:!1,element:a})}}else Un({element:a,name:ys});return{...J}}function a7(t){let e=Io(t),i=[{[pn]:!0}];!t.enableAll&&i.push({[vT]:!0});let r=ze(t,i);if(r.error)return r;let{venueIds:n,enableAll:a}=t;for(let o of Object.values(e))for(let s of o.venues||[])(a||n!=null&&n.includes(s.venueId))&&Un({element:s,name:ys});return{...J}}function o7(t){let{courtId:e,disableNotice:i,force:r}=t,n=Io(t),a=ze(t,[{[pn]:!0,[Gz]:!0}]);if(a.error)return a;let o,s;for(let l of Object.values(n)){if(s=zhe({tournamentRecord:l,disableNotice:i,courtId:e,force:r}),s.error&&s.error!==Cg)return s;s.success&&(o=!0)}return o?{...J}:s}function zhe({tournamentRecord:t,disableNotice:e,courtId:i,force:r}){var u,c,d;let n=ah({tournamentRecord:t,courtId:i});if(n.error)return n;let a=n.venue,{matchUps:o}=bx({tournamentRecord:t,courtId:i}),s=(u=$t({tournamentRecord:t}))==null?void 0:u.appliedPolicies,l=r??((d=(c=s==null?void 0:s[Hc])==null?void 0:c.allowDeletionWithScoresPresent)==null?void 0:d.courts);if(!(o!=null&&o.length)||l){for(let p of o??[]){let m=e7({matchUpId:p.matchUpId,drawId:p.drawId,tournamentRecord:t});if(m.error)return m}a&&(a.courts=(a.courts??[]).filter(p=>p.courtId!==i),e||lt({payload:{venue:a,tournamentId:t.tournamentId},topic:pp,key:a.venueId}))}else return Ux({matchUpsCount:o.length});return{...J}}function Tx(t){let{disableNotice:e,modifications:i,courtId:r,force:n,venueMatchUps:a}=t,o=Io(t);if(!Object.keys(o).length)return{error:ki};let s,l;for(let u of Object.values(o)){let c=Whe({tournamentRecord:u,disableNotice:e,venueMatchUps:a,modifications:i,courtId:r,force:n});if(c!=null&&c.error)return c;s=!0}return s?{...J}:l}function Whe({tournamentRecord:t,disableNotice:e,venueMatchUps:i,modifications:r,courtId:n,force:a}){if(!t)return{error:ge};if(!n)return{error:Gm};if(!r||typeof r!="object")return{error:Gu};let o=ah({tournamentRecord:t,courtId:n});if(o.error)return o;let{venue:s,court:l}=o,u=Object.keys(rhe()).filter(p=>p!=="courtId");if(!Object.keys(r).filter(p=>u.includes(p)).length)return{error:J0};let c=u.filter(p=>!["dateAvailability"].includes(p)),d=Object.keys(r).filter(p=>c.includes(p));if(l&&d.forEach(p=>Object.assign(l,{[p]:r[p]})),r.dateAvailability){let p=wx({dateAvailability:r.dateAvailability,tournamentRecord:t,venueMatchUps:i,disableNotice:e,courtId:n,force:a});if(p.error)return p}return e||lt({payload:{venue:s,tournamentId:t.tournamentId},topic:pp,key:s==null?void 0:s.venueId}),{...J,court:Me(l)}}var qhe=()=>({venueId:void 0,venueName:"",venueAbbreviation:"",onlineResources:[],venueType:void 0,addresses:[],contacts:[],courts:[],roles:[]}),Yhe=qhe;function s7(t){let{modifications:e,venueId:i,force:r}=t,n=Io(t);if(!Object.keys(n).length)return{error:ki};if(typeof i!="string")return{error:jc};let a,o;for(let s of Object.values(n)){let l=Khe({tournamentRecord:s,modifications:e,venueId:i,force:r});if(l.success&&(o=!0),l.error&&(a=l.error),l.error&&l.error!==Wm)return l}return Cb({tournamentRecords:n}),o?{...J}:{error:a}}function Khe({tournamentRecord:t,modifications:e,venueId:i,force:r}){var g,v,y,I,b,S,w,U;if(!t)return{error:ge};if(!e||typeof e!="object")return{error:Gu};if(!i)return{error:jc};let n=(g=$t({tournamentRecord:t}))==null?void 0:g.appliedPolicies,a=r??((y=(v=n==null?void 0:n[Hc])==null?void 0:v.allowDeletionWithScoresPresent)==null?void 0:y.venues),{matchUps:o}=$he({tournamentRecord:t,venueId:i}),s=eu({tournamentRecord:t,venueId:i});if(s.error)return s;let l=s.venue,u=Object.keys(Yhe()).filter(T=>T!=="venueId");if(!Object.keys(e).filter(T=>u.includes(T)).length)return{error:J0};let c=u.filter(T=>!["courts","onlineResources"].includes(T)),d=Object.keys(e).filter(T=>c.includes(T));l&&d.forEach(T=>Object.assign(l,{[T]:e[T]}));let p=((I=l==null?void 0:l.courts)==null?void 0:I.map(T=>T.courtId))??[],m=((b=e.courts)==null?void 0:b.map(T=>T.courtId))||[],h=m.length?p.filter(T=>!m.includes(T)):(e==null?void 0:e.courts)&&p,f=[];if(h!=null&&h.length){let T=(w=(S=l==null?void 0:l.courts)==null?void 0:S.filter(D=>h.includes(D.courtId)))==null?void 0:w.map(D=>{var E;let P=bx({courtId:D.courtId,tournamentRecord:t,venueMatchUps:o});for(let R of P.matchUps??[])f.push({matchUpId:R.matchUpId,drawId:R.drawId});return((E=P.matchUps)==null?void 0:E.length)??0}).reduce((D,P)=>D+P);if(l&&(!T||a))l.courts=(U=l.courts)==null?void 0:U.filter(D=>m.includes(D.courtId)),GI({schedule:{courtId:"",scheduledDate:""},matchUpDetails:f,removePriorValues:!0,tournamentRecord:t});else return Ux({matchUpsCount:T})}if(e.courts)for(let T of e.courts){let{courtId:D}=T||{},P=Tx({modifications:T,disableNotice:!0,tournamentRecord:t,venueMatchUps:o,courtId:D,force:r});if(P.error===Cg&&(P=jD({disableNotice:!0,tournamentRecord:t,venueId:i,court:T})),P.error)return P}return Cb({tournamentRecord:t}),l&&lt({payload:{venue:l,tournamentId:t.tournamentId},topic:pp,key:l==null?void 0:l.venueId}),{...J,venue:Me(l)}}var zD={};yt(zD,{JSON2CSV:()=>ife,UUID:()=>Gt,UUIDS:()=>KH,allNumeric:()=>IG,attributeFilter:()=>bm,chunkArray:()=>Rr,chunkByNth:()=>mC,chunkSizeProfile:()=>vG,constantToString:()=>Zr,countValues:()=>vne,createMap:()=>bG,dateTime:()=>YH,definedAttributes:()=>Ge,dehydrateMatchUps:()=>Qhe,extractAttributes:()=>XW,flattenJSON:()=>Dx,generateDateRange:()=>Rf,generateHashCode:()=>Dne,generateRange:()=>Se,generateTimeCode:()=>VY,groupValues:()=>fG,hasAttributeValues:()=>Tne,instanceCount:()=>wa,intersection:()=>Vi,isConvertableInteger:()=>ot,isNumeric:()=>Li,isOdd:()=>mG,isPowerOf2:()=>Ss,makeDeepCopy:()=>Me,matchUpScheduleSort:()=>Jhe,matchUpSort:()=>oh,nearestPowerOf2:()=>uN,nextPowerOf2:()=>Sg,noNulls:()=>gne,noNumeric:()=>yG,numericSort:()=>or,occurrences:()=>yne,overlap:()=>Rn,randomMember:()=>pa,randomPop:()=>fa,shuffleArray:()=>wn,structureSort:()=>Qm,subSort:()=>bne,undefinedToNull:()=>hC,unique:()=>ct,visualizeScheduledMatchUps:()=>Xhe});function Xhe({scheduledMatchUps:t,showGlobalLog:e}){Lse();let i=t==null?void 0:t.reduce((n,{structureId:a})=>n.includes(a)?n:n.concat(a),[]),r=Array.isArray(i)&&{...i.map(n=>{let{structureName:a,matchUpType:o}=t.find(s=>s.structureId===n);return{[n]:`${a} ${o}`}})};i==null||i.forEach(n=>{var s;Aa({color:"blue",method:"draw",structure:r[n],keyColors:{structure:"magenta"}},!0);let a=t.filter(l=>l.structureId===n),o=((s=En({matchUps:a}))==null?void 0:s.roundMatchUps)||[];Object.keys(o).forEach(l=>{Aa({roundNumber:l,keyColors:{roundNumber:"brightcyan"}},!0),o[l].forEach(({matchUpId:u,schedule:c})=>{let d=bi(c.scheduledTime);Aa({matchUpId:u,time:d,date:c.scheduledDate,venue:c.venueId,keyColors:{time:"brightcyan",date:"brightcyan",matchUpId:"yellow",venue:"magenta"}},!0)})})}),e&&Fse()}var{extractTime:TV,timeStringMinutes:DV}=YH;function Jhe(t,e){let i=t.schedule??{},r=e.schedule??{};if(i.scheduledDate&&!r.scheduledDate)return 1;if(r.scheduledDate&&!i.scheduledDate)return-1;if(i.scheduledDate&&r.scheduledDate){if(i.scheduledDate===r.scheduledDate){if(i.scheduledTime&&!r.scheduledTime)return 1;if(r.scheduledTime&&!i.scheduledTime)return-1;if(i.scheduledTime&&r.scheduledTime){let n=DV(TV(i.scheduledTime)),a=DV(TV(r.scheduledTime));return n-a}}return new Date(i.scheduledDate).getTime()-new Date(r.scheduledDate).getTime()}return 0}function Qhe({tournamentRecord:t}){if(!t)return{error:ge};if(typeof t!="object"||!t.tournamentId)return{error:oe};let{matchUps:e}=Vr({tournamentRecord:t,inContext:!1});if(e!=null&&e.length){let i=Zhe({tournamentRecord:t});tfe(e,i)}return{...J}}function Zhe({tournamentRecord:t}){let e={};for(let i of t.events||[]){i.matchUpFormat&&(e[i.eventId]=i.matchUpFormat);for(let r of i.drawDefinitions||[]){r.matchUpFormat&&(e[r.drawId]=r.matchUpFormat);for(let n of r.structures||[]){n.matchUpFormat&&(e[n.structureId]=n.matchUpFormat);for(let a of n.structures||[])a.matchUpFormat&&(e[a.structureId]=a.matchUpFormat)}}}return e}var efe=["collectionId","collectionPosition","drawPositions","extensions","finishingPositionRange","finishingRound","isMock","matchUpId","matchUpStatus","matchUpStatusCodes","orderOfFinish","processCodes","roundNumber","tieFormat","tieMatchUps","roundPosition","score","sides","winnerMatchUpId","loserMatchUpId","matchUpDuration","winningSide"];function tfe(t,e={}){for(let i of t){let{structureId:r,drawId:n,eventId:a}=i,o=e[r]||e[n]||e[a],s=i.matchUpFormat===o?void 0:i.matchUpFormat;for(let l of Object.keys(i))efe.includes(l)||delete i[l];i.sides&&i.drawPositions&&!i.tieMatchUps&&delete i.sides,s&&(i.matchUpFormat=s)}}function ife(t,e){if(e&&typeof e!="object")return{error:oe};let{columnTransform:i={}}=e||{},{includeTransformAccessors:r,includeHeaderRow:n=!0,returnTransformedJSON:a,removeEmptyColumns:o,onlyHeaderRow:s,columnAccessors:l=[],functionMap:u={},columnMap:c={},valuesMap:d={},context:p={},delimiter:m='"',columnJoiner:h=",",rowJoiner:f=`\r
`,keyJoiner:g="."}=e||{};if(!Array.isArray(t)||!Array.isArray(l)||typeof p!="object"||typeof c!="object"||typeof i!="object"||typeof u!="object"||typeof d!="object"||typeof h!="string"||typeof f!="string"||typeof g!="string"||typeof m!="string")return{error:oe};i=Object.assign({},...Object.keys(i).reverse().map(A=>({[A]:Array.isArray(i[A])?i[A]:[typeof i[A]=="string"&&i[A]].filter(Boolean)})));let v=t.filter(Boolean).map(A=>Dx(A,g)),y=Object.values(i).flat();r&&l.push(...y);let I=v.reduce((A,M)=>Object.keys(M).every(C=>!A.includes(C)&&A.push(C)||!0)&&A,[]).filter(A=>!(l!=null&&l.length)||l.includes(A)),b=Object.assign({},...Object.keys(i).reverse().map(A=>i[A].map(M=>({[M]:A})).flat()).flat()),S=(A,M)=>e!=null&&e.sortOrder?e.sortOrder.includes(A)&&e.sortOrder.includes(M)&&e.sortOrder.indexOf(A)-e.sortOrder.indexOf(M)||!e.sortOrder.includes(M)&&-1:0,w=I.reduce((A,M)=>{let C=b[M];return C?A.includes(C)||A.push(C):A.push(M),A},[]).sort(S);Object.keys(c).forEach(A=>!w.includes(A)&&w.unshift(A)),Object.keys(i).forEach(A=>!w.includes(A)&&w.unshift(A)),typeof p=="object"&&Object.keys(p).forEach(A=>!w.includes(A)&&w.unshift(A));let U=w.map(A=>c[A]||A);if(s)return[U];let T=A=>`${m}${A}${m}`,D=[],P=A=>Object.values(w.reduce((M,C,O)=>{var _;let k=i[C],x=(k!=null&&k.length?A[k.find(L=>A[L])]:A[C])||(p==null?void 0:p[C])||"",F=((_=d[C])==null?void 0:_[x])||x,$=ma(u[C])?u[C](F):F;return M[C]=T($),$&&(D[O]=(D[O]||0)+1),M},{})),E=v.map(P),R=o&&[...D].map((A,M)=>!A&&M).filter(Li).reverse();if(R){let A=M=>M.filter((C,O)=>!R.includes(O));E=E.map(A),U=A(U)}let N=E.map(A=>A.join(h));return a?N.map(A=>{let M=A.split(h);return Object.assign({},...M.map((C,O)=>({[U[O]]:C})))}):n?[U.map(T).join(h),...N].join(f):N.join(f)}function Dx(t,e=".",i=[]){return typeof t=="object"&&Object.keys(t).reduce((r,n)=>typeof t[n]!="object"?(r[i.concat(n).join(e)]=t[n],r):Object.assign(r,Dx(t[n],e,i.concat(n))),{})}var{FACTORY:PV}=Qz;function rfe({tournamentRecord:t,value:e}){let{extension:i}=gt({element:t,name:PV}),r={name:PV,value:{...i==null?void 0:i.value,...e}};Lt({element:t,extension:r})}function l7({timeStamp:t}){let e=Ym(),i=_N();return i&&Object.values(e).forEach(r=>{rfe({tournamentRecord:r,value:{version:$0(),timeStamp:t}})}),i}function u7({engineType:t,methodName:e,elapsed:i,params:r,result:n}){var d,p;let a=Fa();if(typeof a!="object")return;let o={method:e},s=(n==null?void 0:n.error)&&(a.errors===!0||Array.isArray(a.errors)&&a.errors.includes(e)),l=Array.isArray(a.params)&&((d=a.params)==null?void 0:d.includes(e)),u=a.params&&!Array.isArray(a.params)||l,c=Array.isArray(a.exclude)&&a.exclude.includes(e);!c&&![void 0,!1].includes(a.perf)&&!isNaN(a.perf)&&i>=a.perf&&(o.elapsed=i),!c&&(s||u)&&(o.params=r),!c&&(s||a.result&&!Array.isArray(a.result)&&(!Array.isArray(a.params)||l)||Array.isArray(a.result)&&((p=a.result)!=null&&p.includes(e)))&&(o.result=n),Object.keys(o).length>1&&BH(o,t)}function Px({methodName:t,params:e,start:i}){let r={error:Z0,methodName:t},n=i?Date.now()-i:0;return u7({result:r,methodName:t,elapsed:n,params:e,engineType:"sync"}),r}function nfe(t,e){var a;if(e._middleware===!1)return e;if(e.tournamentId&&!t[e.tournamentId])return{error:ge};let i=e.drawId||((a=e.matchUp)==null?void 0:a.drawId);if(i){let{event:o,drawDefinition:s,tournamentId:l}=Wn({tournamentRecords:t,drawId:i});s&&(e.drawDefinition=s),l&&(e.tournamentId=l),o&&(e.event=o)}if(e.eventId&&!e.event){let{event:o,tournamentId:s}=Wn({eventId:e.eventId,tournamentRecords:t});if(!o)return{error:lo};e.tournamentId=s,e.event=o}let r=e.tournamentId??qm();if(!r&&e)return e;let n=t[r];return r&&!n?{error:ge}:(n&&(e.tournamentRecord=n),e)}function Rx(t,e,i,r,n){delete t.success,delete t.error;let a=Date.now(),o=qm();i&&(i.activeTournamentId=o);let s=(i==null?void 0:i.tournamentRecord)||BN(o),l=typeof(i==null?void 0:i.tournamentRecord)=="object"&&{[i==null?void 0:i.tournamentRecord.tournamentId]:i.tournamentRecord}||Ym(),u=i?Me(i,void 0,!0):void 0,c=i?nfe(l,i):void 0;if(c!=null&&c.error)return c;let d=afe({params:c,tournamentRecords:l,tournamentRecord:s,methodName:r,method:e}),p=Date.now()-a;return u7({result:d,methodName:r,elapsed:p,params:u,engineType:n}),d}function afe({tournamentRecords:t,tournamentRecord:e,params:i,methodName:r,method:n}){if(Fa())return n({tournamentRecords:t,tournamentRecord:e,...i});try{return n({tournamentRecords:t,tournamentRecord:e,...i})}catch(a){return rT({engineName:"engine",methodName:r,params:i,err:a})}}function WD(t){let{mutationStatus:e,tournamentId:i,directives:r,timeStamp:n}=t||{},{topics:a}=vo();for(let o of[...a].sort(ofe)){let s=LH({topic:o});s!=null&&s.length&&DC({topic:o,notices:s})}e&&n&&a.includes(AC)&&DC({notices:[{tournamentId:i,directives:r,timeStamp:n}],topic:AC})}var RV={[CA]:5,[EA]:5,[MA]:5,[RA]:5,[PA]:5,[TA]:5,[mW]:5,[hW]:5,[DA]:1,[DT]:1,[nn]:5,[pp]:5,[SA]:4,[bA]:4,[wA]:4,[UA]:4,[TT]:3,[gA]:2};function ofe(t,e){return(RV[e]||0)-(RV[t]||0)}function sfe({convertExtensions:t,removeExtensions:e}){let i=Ym();return{tournamentId:qm(),tournamentRecords:Me(i,t,!1,e)}}function lfe(t){let{convertExtensions:e=!1,removeExtensions:i=!1}=t??{},r=(t==null?void 0:t.tournamentId)??qm();if(typeof r!="string")return{};let n=BN(r);return{tournamentRecord:Me(n,e,!1,i)}}function ufe(){var r;let t=Ym(),{extension:e}=gt({name:Fd,tournamentRecords:t,discover:!0}),i=((r=e==null?void 0:e.value)==null?void 0:r.tournamentIds)||[];return Object.keys(t).forEach(n=>{i.includes(n)||delete t[n]}),iT(t)}function EV(t,e=!0){return typeof t!="object"||Array.isArray(t)?{error:Gu}:t!=null&&t.tournamentId?_H(e?Me(t):t):{error:oe}}function HI(t,e=!0){if(typeof t!="object")return{error:Gu};if(UI(),Array.isArray(t)){if(t.filter(i=>i==null?void 0:i.tournamentId).length!==t.length)return{error:vC};t=Object.assign({},...t.map(i=>({[i.tournamentId]:i})))}else if(t!=null&&t.tournamentId)t={[t.tournamentId]:t},UI(t.tournamentId);else if(!Object.keys(t).every(i=>t[i].tournamentId===i))return{error:vC};return iT(e?Me(t):t)}function cfe(t,e,i,r,n,a){let o=VH(i,r,n,a);if(o.error)return o;let s=o.methods??[];return Object.keys(s).filter(l=>ma(s[l])).forEach(l=>{t[l]=u=>{let c=()=>e(t,{[l]:s[l],...u});if(Fa())return c();try{return c()}catch(d){rT({engineName:"engine",methodName:l,params:u,err:d})}}}),{...J,...t}}function Xh(t,e){return e!=null&&e.error?(t.error=e.error,t.success=!1):(t.error=void 0,t.success=!0),t}function c7(t,e){t.importMethods=(i,r,n,a)=>cfe(t,e,i,r,n,a),t.getTournament=i=>lfe(i),t.getState=i=>sfe({convertExtensions:i==null?void 0:i.convertExtensions,removeExtensions:i==null?void 0:i.removeExtensions}),t.version=()=>$0(),t.reset=()=>(iT({}),Xh(t)),t.devContext=i=>(bI(i),Xh(t)),t.getDevContext=i=>Fa(i),t.newTournamentRecord=(i={})=>{let r=BD(i),n=r.tournamentId;return r.error?r:(EV(r),UI(n),{...J,tournamentId:n})},t.setState=(i,r,n)=>{wI(r,n);let a=HI(i,r);return Xh(t,a)},t.setTournamentId=i=>UI(i),t.getTournamentId=()=>qm(),t.setTournamentRecord=(i,r,n)=>{wI(r,n);let a=EV(i,r);return Xh(t,a)},t.removeTournamentRecord=i=>{let r=$H(i);return Xh(t,r)},t.removeUnlinkedTournamentRecords=()=>{let i=ufe();return Xh(t,i)}}function dfe(t,e,i){if(!Array.isArray(e))return{error:oe,message:"directives must be an array"};let r=FH(),n=Date.now(),a=i&&Me(Ym(),!1,!0),o=[];for(let u of e){if(typeof u!="object")return{error:oe,message:"directive must be an object"};if(u.params&&typeof u.params!="object")return{error:oe,message:"params must be an object"};let{method:c,pipe:d}=u,p=u.params?{...u.params}:{};if(!r[c])return Px({methodName:c,start:n,params:p});if(d){let h=o[o.length-1],f=Object.keys(d);for(let g of f)h[g]&&(p[g]=h[g])}let m=Rx(t,r[c],p,c,"sync");if(m!=null&&m.error)return a&&HI(a),{...m,rolledBack:!!a};o.push({...m,methodName:c})}let s=Date.now(),l=l7({timeStamp:s});return WD({directives:e,mutationStatus:l,timeStamp:s}),Ny(),{success:o.every(u=>u.success),results:o}}function CV(t,e){if(!Nt(e))return{error:oe,message:"args must be an object"};let i=Object.values(e).filter(ma).length;if(i>1)return{message:"there must be only one arg with typeof function",error:oe};let r=i?Object.keys(e).find(m=>ma(e[m])):Ti(e.method)&&e.method;if(!r)return{error:Z0};let{[r]:n,...a}=e,o=e!=null&&e.params?{...e.params}:{...a},s=o.rollbackOnError&&Me(Ym(),!1,!0),l=n||t[r]||FN()[r];if(!l)return Px({methodName:r,params:o});let u=Rx(t,l,o,r,"sync")??{};u!=null&&u.error&&s&&HI(s);let c=Date.now(),d=l7({timeStamp:c}),p=(u==null?void 0:u.success)&&(o==null?void 0:o.delayNotify)!==!0&&(o==null?void 0:o.doNotNotify)!==!0;return p&&WD({directives:[{method:l,params:o}],mutationStatus:d,timeStamp:c}),(p||!(u!=null&&u.success)||o!=null&&o.doNotNotify)&&Ny(),u}var pfe=(()=>{let t={executionQueue:(e,i)=>dfe(t,e,i),execute:e=>CV(t,e)};return c7(t,CV),t})(),Ex=pfe;function MV(t,e){if(!Nt(e))return{error:oe,message:"args must be an object"};let i=Object.values(e).filter(ma).length;if(i>1)return{message:"there must be only one arg with typeof function",error:oe};let r=i?Object.keys(e).find(l=>ma(e[l])):Ti(e.method)&&e.method;if(!r)return{error:Z0};let{[r]:n,...a}=e,o=e!=null&&e.params?{...e.params}:{...a},s=n||t[r]||FN()[r];return s?Rx(t,s,o,r,"ask"):Px({methodName:r,params:o})}(()=>{let t={execute:e=>MV(t,e)};return c7(t,MV),t})();var im={},hc;function NV(t,e=!0){if(!t)return{error:Xe};if(typeof t!="object")return{error:Gu};if(t.matchUpId)hc=t.matchUpId,im[hc]=e?Me(t):t;else if(Array.isArray(t))for(let i of t.reverse())i.matchUpId&&(im[i.matchUpId]=e?Me(i):i,hc||(hc=i.matchUpId));else for(let i of Object.values(t))i.matchUpId&&(im[i.matchUpId]=e?Me(i):i,hc||(hc=i.matchUpId));return e?Me(t):t}function mfe(){return im[hc]}function hfe(){return Object.values(im)}function ffe(){hc=void 0,im={}}function gfe(t){return Me(im[hc],t==null?void 0:t.convertExtensions,!1,t==null?void 0:t.removeExtensions)}(()=>{let t={getState:n=>gfe(n),version:()=>$0(),reset:()=>(ffe(),{...J}),drawId:void 0,error:void 0,success:!1,devContext:n=>(bI(n),t),setState:(n,a,o)=>{wI(a,o);let s=NV(n);return e(s)}};function e(n){return n!=null&&n.error?(t.error=n.error,t.success=!1):(t.error=void 0,t.success=!0,t.drawId=n.drawId),t}return i([VO]),t;function i(n){n.forEach(a=>{Object.keys(a).forEach(o=>{t[o]=s=>{if(Fa())return r({params:s,governor:a,methodName:o});try{return r({params:s,governor:a,methodName:o})}catch(l){rT({engineName:"matchUpEngine",methodName:o,params:s,err:l})}}})})}function r({params:n,governor:a,methodName:o}){t.error=void 0,t.success=!1;let s=(n==null?void 0:n.matchUp)||mfe(),l=(n==null?void 0:n.matchUps)||hfe(),u=(n==null?void 0:n.rollbackOnError)&&Me(s,!1,!0);n={...n,matchUpId:s==null?void 0:s.matchUpId,matchUps:l,matchUp:s};let c=a[o](n);if(c!=null&&c.error)return u&&NV(u),{...c,rolledBack:!!u};let d=(c==null?void 0:c.success)&&(n==null?void 0:n.delayNotify)!==!0&&(n==null?void 0:n.doNotNotify)!==!0;return d&&WD(),(d||!(c!=null&&c.success)||n!=null&&n.doNotNotify)&&Ny(),c}})();var PE=!1;(()=>{let t={version:()=>$0(),setDeepCopy:(r,n)=>(wI(r,n),t),devContext:r=>(bI(r),PE=!0,t)};return i([ix]),t;function e(r,n){let a=r({...n});return a!=null&&a.error||WD(),Ny(),PE&&(bI(!1),PE=!1),a}function i(r){r.forEach(n=>{Object.keys(n).forEach(a=>{t[a]=o=>{if(Fa()){let s=e(n[a],o);return!(s!=null&&s.error)&&(o!=null&&o.setState)&&(s!=null&&s.tournamentRecord)&&HI(s.tournamentRecord),s}else try{let s=e(n[a],o);return!(s!=null&&s.error)&&(o!=null&&o.setState)&&(s!=null&&s.tournamentRecord)&&HI(s.tournamentRecord),s}catch(s){let l;typeof s=="string"?l=s.toUpperCase():s instanceof Error&&(l=s.message),console.log("ERROR",{params:JSON.stringify(o),method:a,error:l})}}})})}})();Ex.importMethods(uG,!0,1);var vfe=Ex,Ife={getTournamentPoints:pD},yfe=Ife,bfe={calculateNewRatings:j3,generateDynamicRatings:G3},wfe=bfe,Ufe={...yfe,...wfe};Ex.importMethods(Ufe);var d7={};yt(d7,{activeMatchUpStatuses:()=>fA,auditConstants:()=>Ope,completedMatchUpStatuses:()=>vr,directingMatchUpStatuses:()=>sW,displayConstants:()=>spe,drawDefinitionConstants:()=>dT,entryStatusConstants:()=>Voe,errorConditionConstants:()=>jne,eventConstants:()=>Nz,extensionConstants:()=>Qz,flightConstants:()=>Jpe,genderConstants:()=>nT,keyValueConstants:()=>Ace,matchUpActionConstants:()=>Hue,matchUpStatusConstants:()=>cW,matchUpTypes:()=>pne,nonDirectingMatchUpStatuses:()=>lW,particicipantsRequiredMatchUpStatuses:()=>aW,participantConstants:()=>wW,participantRoles:()=>XA,participantTypes:()=>qv,penaltyConstants:()=>Bfe,policyConstants:()=>goe,positionActionConstants:()=>iue,ratingConstants:()=>vue,recoveryTimeRequiredMatchUpStatuses:()=>Eoe,requestConstants:()=>$me,resourceContants:()=>xae,resultConstants:()=>Pne,scaleConstants:()=>poe,scheduleConstants:()=>mse,sortingConstants:()=>ame,surfaceConstants:()=>Wfe,tieFormatConstants:()=>Lae,timeItemConstants:()=>cse,topicConstants:()=>Moe,tournamentConstants:()=>j5,upcomingMatchUpStatuses:()=>uW,validMatchUpStatuses:()=>oW,venueConstants:()=>Kfe,weekdayConstants:()=>D4});var Sfe="Coaching",Tfe="Ball Abuse",Dfe="Racket Abuse",Pfe="Verbal Abuse",Rfe="INELIGIBILITY",Efe="Physical Abuse",Cfe="Unsportmanlike Conduct",Mfe="Dress Code Violation",Nfe="Equipment Violation",Afe="Leaving the court",Ofe="Failure to complete",kfe="No Show",xfe="Other",Ffe="REFUSAL_TO_PLAY",Lfe="PROHIBITED_SUBSTANCE",_fe="Puncuality",$fe="Failure to sign in",Bfe={COACHING:Sfe,BALL_ABUSE:Tfe,RACKET_ABUSE:Dfe,VERBAL_ABUSE:Pfe,PHYSICAL_ABUSE:Efe,INELIGIBILITY:Rfe,UNSPORTSMANLIKE_CONDUCT:Cfe,PROHIBITED_SUBSTANCE:Lfe,DRESS_CODE_VIOLATION:Mfe,EQUIMENT_VIOLATION:Nfe,LEAVING_THE_COURT:Afe,REFUSAL_TO_PLAY:Ffe,FAILURE_TO_COMPLETE:Ofe,NO_SHOW:kfe,OTHER:xfe,PUNCTUALITY:_fe,FAILUIRE_TO_SIGN_IN:$fe},Vfe="CLAY",jfe="HARD",Gfe="GRASS",Hfe="CARPET",zfe="ARTIFICIAL",Wfe={CLAY:Vfe,HARD:jfe,GRASS:Gfe,CARPET:Hfe,ARTIFICIAL:zfe},qfe="INDOOR",Yfe="OUTDOOR",Kfe={INDOOR:qfe,OUTDOOR:Yfe};const{AFTER_REST:Xfe,FOLLOWED_BY:Jfe,NEXT_AVAILABLE:Qfe,NOT_BEFORE:Zfe,TO_BE_ANNOUNCED:ege}=d7.timeItemConstants,p1="overlay",Zi="center",AV="header",Rm="right",zd="left",OV="top",m1="",hU="flex",Bs="none",tge="buttonBar",kV="roundsColumns",ige=8,xV="roundsStats",FV="roundsTable",rge={[Xfe]:"After rest",[Jfe]:"Followed by",[ege]:"TBA",[Qfe]:"Next available",[Zfe]:"NB"};function uu(t){return typeof t=="function"}function h1(t){return typeof t=="object"&&!Array.isArray(t)}const RE="font-medium";function rm(t){var y;const{target:e,button:i,stateChange:r}=t;let n=0;const a=()=>(n+=1,`Item${n}`),o=document.createElement("div");i.class&&o.classList.add(i.class),o.classList.add("dropdown"),i.id&&(o.id=i.id),i.align===Rm?(o.classList.add("is-right"),o.style.marginLeft="1em"):o.style.marginRight="1em";const s=I=>I.classList.contains("is-active"),l=()=>{s(o)&&o.classList.remove("is-active")},u=I=>{s(I)?I.classList.remove("is-active"):I.classList.add("is-active")};o.onmouseleave=l,o.onclick=()=>u(o);const c=document.createElement("div");c.classList.add("dropdown-trigger");const d=document.createElement("button");d.className="button font-medium",i.intent&&d.classList.add(i.intent),d.setAttribute("aria-haspopup","true");const p=document.createElement("span");uu(i.onClick)&&(p.onclick=i.onClick),p.style.marginRight="1em",p.innerHTML=i.label,d.appendChild(p);const m=document.createElement("span");uu(i.onClick)&&(m.onclick=i.onClick),m.innerHTML=`
      <span class="icon is-small font-medium">
        <i class="fas fa-angle-down font-medium" aria-hidden="true"></i>
      </span>
  `,d.appendChild(m),c.appendChild(d),o.appendChild(c);const h=document.createElement("div");h.classList.add("dropdown-menu"),h.style.zIndex="99998";const f=document.createElement("div");f.classList.add("dropdown-content");const g=()=>{const I=h.querySelectorAll(".dropdown-item");for(const b of Array.from(I))b.classList.remove("is-active")},v=I=>{const b=document.createElement("a");b.className=RE;const S=I.disabled?"0.4":"1";return b.style.textDecoration="none",b.style.opacity=S,I.color&&(b.style.color=I.color),b.classList.add("dropdown-item"),I.isActive&&b.classList.add("is-active"),I.value&&b.setAttribute("value",I.value),I.class&&b.classList.add(I.class),b.onclick=w=>{if(I.disabled)return;I.value&&(d.value=I.value,o.setAttribute("value",I.value)),w.stopPropagation(),uu(I.onClick)&&(uu(r)&&r(),I.onClick(w)),I.close&&l();const U=s(b);g(),U?p.innerHTML=i.label:(i.selection&&u(b),i.modifyLabel&&I.modifyLabel!==!1&&(p.innerHTML=`${i.append?i.label+": ":""}${(I==null?void 0:I.label)||a()}`))},b.innerHTML=(I==null?void 0:I.label)||a(),b};for(const I of i.options||[])if(I.heading){const b=document.createElement("div");b.style.fontWeight="bold",b.classList.add("dropdown-item"),b.classList.add(RE),b.innerHTML=I.heading,f.appendChild(b)}else if(I.divider){const b=document.createElement("hr");b.classList.add("dropdown-divider"),b.classList.add(RE),f.appendChild(b)}else I.hide||f.appendChild(v(I));return(y=i.options)!=null&&y.length&&(i.options[0].value&&o.setAttribute("value",i.options[0].value),h.appendChild(f)),o.appendChild(h),e&&e.appendChild(o),o}function nge(t){if(t)for(;t.firstChild;)t.removeChild(t.firstChild)}class Ka{constructor(e){this.table=e}reloadData(e,i,r){return this.table.dataLoader.load(e,void 0,void 0,void 0,i,r)}langText(){return this.table.modules.localize.getText(...arguments)}langBind(){return this.table.modules.localize.bind(...arguments)}langLocale(){return this.table.modules.localize.getLocale(...arguments)}commsConnections(){return this.table.modules.comms.getConnections(...arguments)}commsSend(){return this.table.modules.comms.send(...arguments)}layoutMode(){return this.table.modules.layout.getMode()}layoutRefresh(e){return this.table.modules.layout.layout(e)}subscribe(){return this.table.eventBus.subscribe(...arguments)}unsubscribe(){return this.table.eventBus.unsubscribe(...arguments)}subscribed(e){return this.table.eventBus.subscribed(e)}subscriptionChange(){return this.table.eventBus.subscriptionChange(...arguments)}dispatch(){return this.table.eventBus.dispatch(...arguments)}chain(){return this.table.eventBus.chain(...arguments)}confirm(){return this.table.eventBus.confirm(...arguments)}dispatchExternal(){return this.table.externalEvents.dispatch(...arguments)}subscribedExternal(e){return this.table.externalEvents.subscribed(e)}subscriptionChangeExternal(){return this.table.externalEvents.subscriptionChange(...arguments)}options(e){return this.table.options[e]}setOption(e,i){return typeof i<"u"&&(this.table.options[e]=i),this.table.options[e]}deprecationCheck(e,i,r){return this.table.deprecationAdvisor.check(e,i,r)}deprecationCheckMsg(e,i){return this.table.deprecationAdvisor.checkMsg(e,i)}deprecationMsg(e){return this.table.deprecationAdvisor.msg(e)}module(e){return this.table.module(e)}}class xr{static elVisible(e){return!(e.offsetWidth<=0&&e.offsetHeight<=0)}static elOffset(e){var i=e.getBoundingClientRect();return{top:i.top+window.pageYOffset-document.documentElement.clientTop,left:i.left+window.pageXOffset-document.documentElement.clientLeft}}static retrieveNestedData(e,i,r){var n=e?i.split(e):[i],a=n.length,o;for(let s=0;s<a&&(r=r[n[s]],o=r,!!r);s++);return o}static deepClone(e,i,r=[]){var n={}.__proto__,a=[].__proto__;i||(i=Object.assign(Array.isArray(e)?[]:{},e));for(var o in e){let s=e[o],l,u;s!=null&&typeof s=="object"&&(s.__proto__===n||s.__proto__===a)&&(l=r.findIndex(c=>c.subject===s),l>-1?i[o]=r[l].copy:(u=Object.assign(Array.isArray(s)?[]:{},s),r.unshift({subject:s,copy:u}),i[o]=this.deepClone(s,u,r)))}return i}}let age=class p7 extends Ka{constructor(e,i,r){super(e),this.element=i,this.container=this._lookupContainer(),this.parent=r,this.reversedX=!1,this.childPopup=null,this.blurable=!1,this.blurCallback=null,this.blurEventsBound=!1,this.renderedCallback=null,this.visible=!1,this.hideable=!0,this.element.classList.add("tabulator-popup-container"),this.blurEvent=this.hide.bind(this,!1),this.escEvent=this._escapeCheck.bind(this),this.destroyBinding=this.tableDestroyed.bind(this),this.destroyed=!1}tableDestroyed(){this.destroyed=!0,this.hide(!0)}_lookupContainer(){var e=this.table.options.popupContainer;return typeof e=="string"?(e=document.querySelector(e),e||console.warn("Menu Error - no container element found matching selector:",this.table.options.popupContainer,"(defaulting to document body)")):e===!0&&(e=this.table.element),e&&!this._checkContainerIsParent(e)&&(e=!1,console.warn("Menu Error - container element does not contain this table:",this.table.options.popupContainer,"(defaulting to document body)")),e||(e=document.body),e}_checkContainerIsParent(e,i=this.table.element){return e===i?!0:i.parentNode?this._checkContainerIsParent(e,i.parentNode):!1}renderCallback(e){this.renderedCallback=e}containerEventCoords(e){var i=!(e instanceof MouseEvent),r=i?e.touches[0].pageX:e.pageX,n=i?e.touches[0].pageY:e.pageY;if(this.container!==document.body){let a=xr.elOffset(this.container);r-=a.left,n-=a.top}return{x:r,y:n}}elementPositionCoords(e,i="right"){var r=xr.elOffset(e),n,a,o;switch(this.container!==document.body&&(n=xr.elOffset(this.container),r.left-=n.left,r.top-=n.top),i){case"right":a=r.left+e.offsetWidth,o=r.top-1;break;case"bottom":a=r.left,o=r.top+e.offsetHeight;break;case"left":a=r.left,o=r.top-1;break;case"top":a=r.left,o=r.top;break;case"center":a=r.left+e.offsetWidth/2,o=r.top+e.offsetHeight/2;break}return{x:a,y:o,offset:r}}show(e,i){var r,n,a,o,s;return this.destroyed||this.table.destroyed?this:(e instanceof HTMLElement?(a=e,s=this.elementPositionCoords(e,i),o=s.offset,r=s.x,n=s.y):typeof e=="number"?(o={top:0,left:0},r=e,n=i):(s=this.containerEventCoords(e),r=s.x,n=s.y,this.reversedX=!1),this.element.style.top=n+"px",this.element.style.left=r+"px",this.container.appendChild(this.element),typeof this.renderedCallback=="function"&&this.renderedCallback(),this._fitToScreen(r,n,a,o,i),this.visible=!0,this.subscribe("table-destroy",this.destroyBinding),this.element.addEventListener("mousedown",l=>{l.stopPropagation()}),this)}_fitToScreen(e,i,r,n,a){var o=this.container===document.body?document.documentElement.scrollTop:this.container.scrollTop;(e+this.element.offsetWidth>=this.container.offsetWidth||this.reversedX)&&(this.element.style.left="",r?this.element.style.right=this.container.offsetWidth-n.left+"px":this.element.style.right=this.container.offsetWidth-e+"px",this.reversedX=!0);let s=Math.max(this.container.offsetHeight,o?this.container.scrollHeight:0);if(i+this.element.offsetHeight>s)if(r)switch(a){case"bottom":this.element.style.top=parseInt(this.element.style.top)-this.element.offsetHeight-r.offsetHeight-1+"px";break;default:this.element.style.top=parseInt(this.element.style.top)-this.element.offsetHeight+r.offsetHeight+1+"px"}else this.element.style.height=s+"px"}isVisible(){return this.visible}hideOnBlur(e){return this.blurable=!0,this.visible&&(setTimeout(()=>{this.visible&&(this.table.rowManager.element.addEventListener("scroll",this.blurEvent),this.subscribe("cell-editing",this.blurEvent),document.body.addEventListener("click",this.blurEvent),document.body.addEventListener("contextmenu",this.blurEvent),document.body.addEventListener("mousedown",this.blurEvent),window.addEventListener("resize",this.blurEvent),document.body.addEventListener("keydown",this.escEvent),this.blurEventsBound=!0)},100),this.blurCallback=e),this}_escapeCheck(e){e.keyCode==27&&this.hide()}blockHide(){this.hideable=!1}restoreHide(){this.hideable=!0}hide(e=!1){return this.visible&&this.hideable&&(this.blurable&&this.blurEventsBound&&(document.body.removeEventListener("keydown",this.escEvent),document.body.removeEventListener("click",this.blurEvent),document.body.removeEventListener("contextmenu",this.blurEvent),document.body.removeEventListener("mousedown",this.blurEvent),window.removeEventListener("resize",this.blurEvent),this.table.rowManager.element.removeEventListener("scroll",this.blurEvent),this.unsubscribe("cell-editing",this.blurEvent),this.blurEventsBound=!1),this.childPopup&&this.childPopup.hide(),this.parent&&(this.parent.childPopup=null),this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.visible=!1,this.blurCallback&&!e&&this.blurCallback(),this.unsubscribe("table-destroy",this.destroyBinding)),this}child(e){return this.childPopup&&this.childPopup.hide(),this.childPopup=new p7(this.table,e,this),this.childPopup}};class ci extends Ka{constructor(e,i){super(e),this._handler=null}initialize(){}registerTableOption(e,i){this.table.optionsList.register(e,i)}registerColumnOption(e,i){this.table.columnManager.optionsList.register(e,i)}registerTableFunction(e,i){typeof this.table[e]>"u"?this.table[e]=(...r)=>(this.table.initGuard(e),i(...r)):console.warn("Unable to bind table function, name already in use",e)}registerComponentFunction(e,i,r){return this.table.componentFunctionBinder.bind(e,i,r)}registerDataHandler(e,i){this.table.rowManager.registerDataPipelineHandler(e,i),this._handler=e}registerDisplayHandler(e,i){this.table.rowManager.registerDisplayPipelineHandler(e,i),this._handler=e}displayRows(e){var i=this.table.rowManager.displayRows.length-1,r;if(this._handler&&(r=this.table.rowManager.displayPipeline.findIndex(n=>n.handler===this._handler),r>-1&&(i=r)),e&&(i=i+e),this._handler)return i>-1?this.table.rowManager.getDisplayRows(i):this.activeRows()}activeRows(){return this.table.rowManager.activeRows}refreshData(e,i){i||(i=this._handler),i&&this.table.rowManager.refreshActiveData(i,!1,e)}footerAppend(e){return this.table.footerManager.append(e)}footerPrepend(e){return this.table.footerManager.prepend(e)}footerRemove(e){return this.table.footerManager.remove(e)}popup(e,i){return new age(this.table,e,i)}alert(e,i){return this.table.alertManager.alert(e,i)}clearAlert(){return this.table.alertManager.clear()}}var oge={rownum:function(t,e,i,r,n,a){return a.getPosition()}};const mf=class mf extends ci{constructor(e){super(e),this.allowedTypes=["","data","download","clipboard","print","htmlOutput"],this.registerColumnOption("accessor"),this.registerColumnOption("accessorParams"),this.registerColumnOption("accessorData"),this.registerColumnOption("accessorDataParams"),this.registerColumnOption("accessorDownload"),this.registerColumnOption("accessorDownloadParams"),this.registerColumnOption("accessorClipboard"),this.registerColumnOption("accessorClipboardParams"),this.registerColumnOption("accessorPrint"),this.registerColumnOption("accessorPrintParams"),this.registerColumnOption("accessorHtmlOutput"),this.registerColumnOption("accessorHtmlOutputParams")}initialize(){this.subscribe("column-layout",this.initializeColumn.bind(this)),this.subscribe("row-data-retrieve",this.transformRow.bind(this))}initializeColumn(e){var i=!1,r={};this.allowedTypes.forEach(n=>{var a="accessor"+(n.charAt(0).toUpperCase()+n.slice(1)),o;e.definition[a]&&(o=this.lookupAccessor(e.definition[a]),o&&(i=!0,r[a]={accessor:o,params:e.definition[a+"Params"]||{}}))}),i&&(e.modules.accessor=r)}lookupAccessor(e){var i=!1;switch(typeof e){case"string":mf.accessors[e]?i=mf.accessors[e]:console.warn("Accessor Error - No such accessor found, ignoring: ",e);break;case"function":i=e;break}return i}transformRow(e,i){var r="accessor"+(i.charAt(0).toUpperCase()+i.slice(1)),n=e.getComponent(),a=xr.deepClone(e.data||{});return this.table.columnManager.traverse(function(o){var s,l,u,c;o.modules.accessor&&(l=o.modules.accessor[r]||o.modules.accessor.accessor||!1,l&&(s=o.getFieldValue(a),s!="undefined"&&(c=o.getComponent(),u=typeof l.params=="function"?l.params(s,a,i,c,n):l.params,o.setFieldValue(a,l.accessor(s,a,i,u,c,n)))))}),a}};Ve(mf,"moduleName","accessor"),Ve(mf,"accessors",oge);let f1=mf;var sge={method:"GET"};function g1(t,e){var i=[];if(e=e||"",Array.isArray(t))t.forEach((n,a)=>{i=i.concat(g1(n,e?e+"["+a+"]":a))});else if(typeof t=="object")for(var r in t)i=i.concat(g1(t[r],e?e+"["+r+"]":r));else i.push({key:e,value:t});return i}function lge(t){var e=g1(t),i=[];return e.forEach(function(r){i.push(encodeURIComponent(r.key)+"="+encodeURIComponent(r.value))}),i.join("&")}function m7(t,e,i){return t&&i&&Object.keys(i).length&&(!e.method||e.method.toLowerCase()=="get")&&(e.method="get",t+=(t.includes("?")?"&":"?")+lge(i)),t}function uge(t,e,i){var r;return new Promise((n,a)=>{if(t=this.urlGenerator.call(this.table,t,e,i),e.method.toUpperCase()!="GET")if(r=typeof this.table.options.ajaxContentType=="object"?this.table.options.ajaxContentType:this.contentTypeFormatters[this.table.options.ajaxContentType],r){for(var o in r.headers)e.headers||(e.headers={}),typeof e.headers[o]>"u"&&(e.headers[o]=r.headers[o]);e.body=r.body.call(this,t,e,i)}else console.warn("Ajax Error - Invalid ajaxContentType value:",this.table.options.ajaxContentType);t?(typeof e.headers>"u"&&(e.headers={}),typeof e.headers.Accept>"u"&&(e.headers.Accept="application/json"),typeof e.headers["X-Requested-With"]>"u"&&(e.headers["X-Requested-With"]="XMLHttpRequest"),typeof e.mode>"u"&&(e.mode="cors"),e.mode=="cors"?(typeof e.headers.Origin>"u"&&(e.headers.Origin=window.location.origin),typeof e.credentials>"u"&&(e.credentials="same-origin")):typeof e.credentials>"u"&&(e.credentials="include"),fetch(t,e).then(s=>{s.ok?s.json().then(l=>{n(l)}).catch(l=>{a(l),console.warn("Ajax Load Error - Invalid JSON returned",l)}):(console.error("Ajax Load Error - Connection Error: "+s.status,s.statusText),a(s))}).catch(s=>{console.error("Ajax Load Error - Connection Error: ",s),a(s)})):(console.warn("Ajax Load Error - No URL Set"),n([]))})}function v1(t,e){var i=[];if(e=e||"",Array.isArray(t))t.forEach((n,a)=>{i=i.concat(v1(n,e?e+"["+a+"]":a))});else if(typeof t=="object")for(var r in t)i=i.concat(v1(t[r],e?e+"["+r+"]":r));else i.push({key:e,value:t});return i}var cge={json:{headers:{"Content-Type":"application/json"},body:function(t,e,i){return JSON.stringify(i)}},form:{headers:{},body:function(t,e,i){var r=v1(i),n=new FormData;return r.forEach(function(a){n.append(a.key,a.value)}),n}}};const Tl=class Tl extends ci{constructor(e){super(e),this.config={},this.url="",this.urlGenerator=!1,this.params=!1,this.loaderPromise=!1,this.registerTableOption("ajaxURL",!1),this.registerTableOption("ajaxURLGenerator",!1),this.registerTableOption("ajaxParams",{}),this.registerTableOption("ajaxConfig","get"),this.registerTableOption("ajaxContentType","form"),this.registerTableOption("ajaxRequestFunc",!1),this.registerTableOption("ajaxRequesting",function(){}),this.registerTableOption("ajaxResponse",!1),this.contentTypeFormatters=Tl.contentTypeFormatters}initialize(){this.loaderPromise=this.table.options.ajaxRequestFunc||Tl.defaultLoaderPromise,this.urlGenerator=this.table.options.ajaxURLGenerator||Tl.defaultURLGenerator,this.table.options.ajaxURL&&this.setUrl(this.table.options.ajaxURL),this.setDefaultConfig(this.table.options.ajaxConfig),this.registerTableFunction("getAjaxUrl",this.getUrl.bind(this)),this.subscribe("data-loading",this.requestDataCheck.bind(this)),this.subscribe("data-params",this.requestParams.bind(this)),this.subscribe("data-load",this.requestData.bind(this))}requestParams(e,i,r,n){var a=this.table.options.ajaxParams;return a&&(typeof a=="function"&&(a=a.call(this.table)),n=Object.assign(Object.assign({},a),n)),n}requestDataCheck(e,i,r,n){return!!(!e&&this.url||typeof e=="string")}requestData(e,i,r,n,a){var o;return!a&&this.requestDataCheck(e)?(e&&this.setUrl(e),o=this.generateConfig(r),this.sendRequest(this.url,i,o)):a}setDefaultConfig(e={}){this.config=Object.assign({},Tl.defaultConfig),typeof e=="string"?this.config.method=e:Object.assign(this.config,e)}generateConfig(e={}){var i=Object.assign({},this.config);return typeof e=="string"?i.method=e:Object.assign(i,e),i}setUrl(e){this.url=e}getUrl(){return this.url}sendRequest(e,i,r){return this.table.options.ajaxRequesting.call(this.table,e,i)!==!1?this.loaderPromise(e,r,i).then(n=>(this.table.options.ajaxResponse&&(n=this.table.options.ajaxResponse.call(this.table,e,i,n)),n)):Promise.reject()}};Ve(Tl,"moduleName","ajax"),Ve(Tl,"defaultConfig",sge),Ve(Tl,"defaultURLGenerator",m7),Ve(Tl,"defaultLoaderPromise",uge),Ve(Tl,"contentTypeFormatters",cge);let I1=Tl;var dge={replace:function(t){return this.table.setData(t)},update:function(t){return this.table.updateOrAddData(t)},insert:function(t){return this.table.addData(t)}},pge={table:function(t){var e=[],i=!0,r=this.table.columnManager.columns,n=[],a=[];return t=t.split(`
`),t.forEach(function(o){e.push(o.split("	"))}),e.length&&!(e.length===1&&e[0].length<2)?(e[0].forEach(function(o){var s=r.find(function(l){return o&&l.definition.title&&o.trim()&&l.definition.title.trim()===o.trim()});s?n.push(s):i=!1}),i||(i=!0,n=[],e[0].forEach(function(o){var s=r.find(function(l){return o&&l.field&&o.trim()&&l.field.trim()===o.trim()});s?n.push(s):i=!1}),i||(n=this.table.columnManager.columnsByIndex)),i&&e.shift(),e.forEach(function(o){var s={};o.forEach(function(l,u){n[u]&&(s[n[u].field]=l)}),a.push(s)}),a):!1}},mge={copyToClipboard:["ctrl + 67","meta + 67"]},hge={copyToClipboard:function(t){this.table.modules.edit.currentCell||this.table.modExists("clipboard",!0)&&this.table.modules.clipboard.copy(!1,!0)}},fge={keybindings:{bindings:mge,actions:hge}};const vd=class vd extends ci{constructor(e){super(e),this.mode=!0,this.pasteParser=function(){},this.pasteAction=function(){},this.customSelection=!1,this.rowRange=!1,this.blocked=!0,this.registerTableOption("clipboard",!1),this.registerTableOption("clipboardCopyStyled",!0),this.registerTableOption("clipboardCopyConfig",!1),this.registerTableOption("clipboardCopyFormatter",!1),this.registerTableOption("clipboardCopyRowRange","active"),this.registerTableOption("clipboardPasteParser","table"),this.registerTableOption("clipboardPasteAction","insert"),this.registerColumnOption("clipboard"),this.registerColumnOption("titleClipboard")}initialize(){this.mode=this.table.options.clipboard,this.rowRange=this.table.options.clipboardCopyRowRange,(this.mode===!0||this.mode==="copy")&&this.table.element.addEventListener("copy",e=>{var i,r,n;this.blocked||(e.preventDefault(),this.customSelection?(i=this.customSelection,this.table.options.clipboardCopyFormatter&&(i=this.table.options.clipboardCopyFormatter("plain",i))):(n=this.table.modules.export.generateExportList(this.table.options.clipboardCopyConfig,this.table.options.clipboardCopyStyled,this.rowRange,"clipboard"),r=this.table.modules.export.generateHTMLTable(n),i=r?this.generatePlainContent(n):"",this.table.options.clipboardCopyFormatter&&(i=this.table.options.clipboardCopyFormatter("plain",i),r=this.table.options.clipboardCopyFormatter("html",r))),window.clipboardData&&window.clipboardData.setData?window.clipboardData.setData("Text",i):e.clipboardData&&e.clipboardData.setData?(e.clipboardData.setData("text/plain",i),r&&e.clipboardData.setData("text/html",r)):e.originalEvent&&e.originalEvent.clipboardData.setData&&(e.originalEvent.clipboardData.setData("text/plain",i),r&&e.originalEvent.clipboardData.setData("text/html",r)),this.dispatchExternal("clipboardCopied",i,r),this.reset())}),(this.mode===!0||this.mode==="paste")&&this.table.element.addEventListener("paste",e=>{this.paste(e)}),this.setPasteParser(this.table.options.clipboardPasteParser),this.setPasteAction(this.table.options.clipboardPasteAction),this.registerTableFunction("copyToClipboard",this.copy.bind(this))}reset(){this.blocked=!0,this.customSelection=!1}generatePlainContent(e){var i=[];return e.forEach(r=>{var n=[];r.columns.forEach(a=>{var o="";if(a)if(r.type==="group"&&(a.value=a.component.getKey()),a.value===null)o="";else switch(typeof a.value){case"object":o=JSON.stringify(a.value);break;case"undefined":o="";break;default:o=a.value}n.push(o)}),i.push(n.join("	"))}),i.join(`
`)}copy(e,i){var r,n;this.blocked=!1,this.customSelection=!1,(this.mode===!0||this.mode==="copy")&&(this.rowRange=e||this.table.options.clipboardCopyRowRange,typeof window.getSelection<"u"&&typeof document.createRange<"u"?(e=document.createRange(),e.selectNodeContents(this.table.element),r=window.getSelection(),r.toString()&&i&&(this.customSelection=r.toString()),r.removeAllRanges(),r.addRange(e)):typeof document.selection<"u"&&typeof document.body.createTextRange<"u"&&(n=document.body.createTextRange(),n.moveToElementText(this.table.element),n.select()),document.execCommand("copy"),r&&r.removeAllRanges())}setPasteAction(e){switch(typeof e){case"string":this.pasteAction=vd.pasteActions[e],this.pasteAction||console.warn("Clipboard Error - No such paste action found:",e);break;case"function":this.pasteAction=e;break}}setPasteParser(e){switch(typeof e){case"string":this.pasteParser=vd.pasteParsers[e],this.pasteParser||console.warn("Clipboard Error - No such paste parser found:",e);break;case"function":this.pasteParser=e;break}}paste(e){var i,r,n;this.checkPasteOrigin(e)&&(i=this.getPasteData(e),r=this.pasteParser.call(this,i),r?(e.preventDefault(),this.table.modExists("mutator")&&(r=this.mutateData(r)),n=this.pasteAction.call(this,r),this.dispatchExternal("clipboardPasted",i,r,n)):this.dispatchExternal("clipboardPasteError",i))}mutateData(e){var i=[];return Array.isArray(e)?e.forEach(r=>{i.push(this.table.modules.mutator.transformRow(r,"clipboard"))}):i=e,i}checkPasteOrigin(e){var i=!0,r=this.confirm("clipboard-paste",[e]);return(r||!["DIV","SPAN"].includes(e.target.tagName))&&(i=!1),i}getPasteData(e){var i;return window.clipboardData&&window.clipboardData.getData?i=window.clipboardData.getData("Text"):e.clipboardData&&e.clipboardData.getData?i=e.clipboardData.getData("text/plain"):e.originalEvent&&e.originalEvent.clipboardData.getData&&(i=e.originalEvent.clipboardData.getData("text/plain")),i}};Ve(vd,"moduleName","clipboard"),Ve(vd,"moduleExtensions",fge),Ve(vd,"pasteActions",dge),Ve(vd,"pasteParsers",pge);let y1=vd;class gge{constructor(e){return this._row=e,new Proxy(this,{get:function(i,r,n){return typeof i[r]<"u"?i[r]:i._row.table.componentFunctionBinder.handle("row",i._row,r)}})}getData(e){return this._row.getData(e)}getElement(){return this._row.getElement()}getTable(){return this._row.table}getCells(){var e=[];return this._row.getCells().forEach(function(i){e.push(i.getComponent())}),e}getCell(e){var i=this._row.getCell(e);return i?i.getComponent():!1}_getSelf(){return this._row}}class h7{constructor(e){return this._cell=e,new Proxy(this,{get:function(i,r,n){return typeof i[r]<"u"?i[r]:i._cell.table.componentFunctionBinder.handle("cell",i._cell,r)}})}getValue(){return this._cell.getValue()}getOldValue(){return this._cell.getOldValue()}getInitialValue(){return this._cell.initialValue}getElement(){return this._cell.getElement()}getRow(){return this._cell.row.getComponent()}getData(e){return this._cell.row.getData(e)}getType(){return"cell"}getField(){return this._cell.column.getField()}getColumn(){return this._cell.column.getComponent()}setValue(e,i){typeof i>"u"&&(i=!0),this._cell.setValue(e,i)}restoreOldValue(){this._cell.setValueActual(this._cell.getOldValue())}restoreInitialValue(){this._cell.setValueActual(this._cell.initialValue)}checkHeight(){this._cell.checkHeight()}getTable(){return this._cell.table}_getSelf(){return this._cell}}class Bb extends Ka{constructor(e,i){super(e.table),this.table=e.table,this.column=e,this.row=i,this.element=null,this.value=null,this.initialValue,this.oldValue=null,this.modules={},this.height=null,this.width=null,this.minWidth=null,this.component=null,this.loaded=!1,this.build()}build(){this.generateElement(),this.setWidth(),this._configureCell(),this.setValueActual(this.column.getFieldValue(this.row.data)),this.initialValue=this.value}generateElement(){this.element=document.createElement("div"),this.element.className="tabulator-cell",this.element.setAttribute("role","gridcell"),this.column.isRowHeader&&this.element.classList.add("tabulator-row-header")}_configureCell(){var e=this.element,i=this.column.getField(),r={top:"flex-start",bottom:"flex-end",middle:"center"},n={left:"flex-start",right:"flex-end",center:"center"};if(e.style.textAlign=this.column.hozAlign,this.column.vertAlign&&(e.style.display="inline-flex",e.style.alignItems=r[this.column.vertAlign]||"",this.column.hozAlign&&(e.style.justifyContent=n[this.column.hozAlign]||"")),i&&e.setAttribute("tabulator-field",i),this.column.definition.cssClass){var a=this.column.definition.cssClass.split(" ");a.forEach(o=>{e.classList.add(o)})}this.dispatch("cell-init",this),this.column.visible||this.hide()}_generateContents(){var e;switch(e=this.chain("cell-format",this,null,()=>this.element.innerHTML=this.value),typeof e){case"object":if(e instanceof Node){for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.element.appendChild(e)}else this.element.innerHTML="",e!=null&&console.warn("Format Error - Formatter has returned a type of object, the only valid formatter object return is an instance of Node, the formatter returned:",e);break;case"undefined":this.element.innerHTML="";break;default:this.element.innerHTML=e}}cellRendered(){this.dispatch("cell-rendered",this)}getElement(e){return this.loaded||(this.loaded=!0,e||this.layoutElement()),this.element}getValue(){return this.value}getOldValue(){return this.oldValue}setValue(e,i,r){var n=this.setValueProcessData(e,i,r);n&&(this.dispatch("cell-value-updated",this),this.cellRendered(),this.column.definition.cellEdited&&this.column.definition.cellEdited.call(this.table,this.getComponent()),this.dispatchExternal("cellEdited",this.getComponent()),this.subscribedExternal("dataChanged")&&this.dispatchExternal("dataChanged",this.table.rowManager.getData()))}setValueProcessData(e,i,r){var n=!1;return(this.value!==e||r)&&(n=!0,i&&(e=this.chain("cell-value-changing",[this,e],null,e))),this.setValueActual(e),n&&this.dispatch("cell-value-changed",this),n}setValueActual(e){this.oldValue=this.value,this.value=e,this.dispatch("cell-value-save-before",this),this.column.setFieldValue(this.row.data,e),this.dispatch("cell-value-save-after",this),this.loaded&&this.layoutElement()}layoutElement(){this._generateContents(),this.dispatch("cell-layout",this)}setWidth(){this.width=this.column.width,this.element.style.width=this.column.widthStyled}clearWidth(){this.width="",this.element.style.width=""}getWidth(){return this.width||this.element.offsetWidth}setMinWidth(){this.minWidth=this.column.minWidth,this.element.style.minWidth=this.column.minWidthStyled}setMaxWidth(){this.maxWidth=this.column.maxWidth,this.element.style.maxWidth=this.column.maxWidthStyled}checkHeight(){this.row.reinitializeHeight()}clearHeight(){this.element.style.height="",this.height=null,this.dispatch("cell-height",this,"")}setHeight(){this.height=this.row.height,this.element.style.height=this.row.heightStyled,this.dispatch("cell-height",this,this.row.heightStyled)}getHeight(){return this.height||this.element.offsetHeight}show(){this.element.style.display=this.column.vertAlign?"inline-flex":""}hide(){this.element.style.display="none"}delete(){this.dispatch("cell-delete",this),!this.table.rowManager.redrawBlock&&this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.element=!1,this.column.deleteCell(this),this.row.deleteCell(this),this.calcs={}}getIndex(){return this.row.getCellIndex(this)}getComponent(){return this.component||(this.component=new h7(this)),this.component}}class f7{constructor(e){return this._column=e,this.type="ColumnComponent",new Proxy(this,{get:function(i,r,n){return typeof i[r]<"u"?i[r]:i._column.table.componentFunctionBinder.handle("column",i._column,r)}})}getElement(){return this._column.getElement()}getDefinition(){return this._column.getDefinition()}getField(){return this._column.getField()}getTitleDownload(){return this._column.getTitleDownload()}getCells(){var e=[];return this._column.cells.forEach(function(i){e.push(i.getComponent())}),e}isVisible(){return this._column.visible}show(){this._column.isGroup?this._column.columns.forEach(function(e){e.show()}):this._column.show()}hide(){this._column.isGroup?this._column.columns.forEach(function(e){e.hide()}):this._column.hide()}toggle(){this._column.visible?this.hide():this.show()}delete(){return this._column.delete()}getSubColumns(){var e=[];return this._column.columns.length&&this._column.columns.forEach(function(i){e.push(i.getComponent())}),e}getParentColumn(){return this._column.getParentComponent()}_getSelf(){return this._column}scrollTo(e,i){return this._column.table.columnManager.scrollToColumn(this._column,e,i)}getTable(){return this._column.table}move(e,i){var r=this._column.table.columnManager.findColumn(e);r?this._column.table.columnManager.moveColumn(this._column,r,i):console.warn("Move Error - No matching column found:",r)}getNextColumn(){var e=this._column.nextColumn();return e?e.getComponent():!1}getPrevColumn(){var e=this._column.prevColumn();return e?e.getComponent():!1}updateDefinition(e){return this._column.updateDefinition(e)}getWidth(){return this._column.getWidth()}setWidth(e){var i;return e===!0?i=this._column.reinitializeWidth(!0):i=this._column.setWidth(e),this._column.table.columnManager.rerenderColumns(!0),i}}var g7={title:void 0,field:void 0,columns:void 0,visible:void 0,hozAlign:void 0,vertAlign:void 0,width:void 0,minWidth:40,maxWidth:void 0,maxInitialWidth:void 0,cssClass:void 0,variableHeight:void 0,headerVertical:void 0,headerHozAlign:void 0,headerWordWrap:!1,editableTitle:void 0};const Gp=class Gp extends Ka{constructor(e,i,r){super(i.table),this.definition=e,this.parent=i,this.type="column",this.columns=[],this.cells=[],this.isGroup=!1,this.isRowHeader=r,this.element=this.createElement(),this.contentElement=!1,this.titleHolderElement=!1,this.titleElement=!1,this.groupElement=this.createGroupElement(),this.hozAlign="",this.vertAlign="",this.field="",this.fieldStructure="",this.getFieldValue="",this.setFieldValue="",this.titleDownload=null,this.titleFormatterRendered=!1,this.mapDefinitions(),this.setField(this.definition.field),this.modules={},this.width=null,this.widthStyled="",this.maxWidth=null,this.maxWidthStyled="",this.maxInitialWidth=null,this.minWidth=null,this.minWidthStyled="",this.widthFixed=!1,this.visible=!0,this.component=null,this.definition.columns?(this.isGroup=!0,this.definition.columns.forEach((n,a)=>{var o=new Gp(n,this);this.attachColumn(o)}),this.checkColumnVisibility()):i.registerColumnField(this),this._initialize()}createElement(){var e=document.createElement("div");switch(e.classList.add("tabulator-col"),e.setAttribute("role","columnheader"),e.setAttribute("aria-sort","none"),this.isRowHeader&&e.classList.add("tabulator-row-header"),this.table.options.columnHeaderVertAlign){case"middle":e.style.justifyContent="center";break;case"bottom":e.style.justifyContent="flex-end";break}return e}createGroupElement(){var e=document.createElement("div");return e.classList.add("tabulator-col-group-cols"),e}mapDefinitions(){var e=this.table.options.columnDefaults;if(e)for(let i in e)typeof this.definition[i]>"u"&&(this.definition[i]=e[i]);this.definition=this.table.columnManager.optionsList.generate(Gp.defaultOptionList,this.definition)}checkDefinition(){Object.keys(this.definition).forEach(e=>{Gp.defaultOptionList.indexOf(e)===-1&&console.warn("Invalid column definition option in '"+(this.field||this.definition.title)+"' column:",e)})}setField(e){this.field=e,this.fieldStructure=e?this.table.options.nestedFieldSeparator?e.split(this.table.options.nestedFieldSeparator):[e]:[],this.getFieldValue=this.fieldStructure.length>1?this._getNestedData:this._getFlatData,this.setFieldValue=this.fieldStructure.length>1?this._setNestedData:this._setFlatData}registerColumnPosition(e){this.parent.registerColumnPosition(e)}registerColumnField(e){this.parent.registerColumnField(e)}reRegisterPosition(){this.isGroup?this.columns.forEach(function(e){e.reRegisterPosition()}):this.registerColumnPosition(this)}_initialize(){for(var e=this.definition;this.element.firstChild;)this.element.removeChild(this.element.firstChild);e.headerVertical&&(this.element.classList.add("tabulator-col-vertical"),e.headerVertical==="flip"&&this.element.classList.add("tabulator-col-vertical-flip")),this.contentElement=this._buildColumnHeaderContent(),this.element.appendChild(this.contentElement),this.isGroup?this._buildGroupHeader():this._buildColumnHeader(),this.dispatch("column-init",this)}_buildColumnHeader(){var e=this.definition;if(this.dispatch("column-layout",this),typeof e.visible<"u"&&(e.visible?this.show(!0):this.hide(!0)),e.cssClass){var i=e.cssClass.split(" ");i.forEach(r=>{this.element.classList.add(r)})}e.field&&this.element.setAttribute("tabulator-field",e.field),this.setMinWidth(parseInt(e.minWidth)),e.maxInitialWidth&&(this.maxInitialWidth=parseInt(e.maxInitialWidth)),e.maxWidth&&this.setMaxWidth(parseInt(e.maxWidth)),this.reinitializeWidth(),this.hozAlign=this.definition.hozAlign,this.vertAlign=this.definition.vertAlign,this.titleElement.style.textAlign=this.definition.headerHozAlign}_buildColumnHeaderContent(){var e=document.createElement("div");return e.classList.add("tabulator-col-content"),this.titleHolderElement=document.createElement("div"),this.titleHolderElement.classList.add("tabulator-col-title-holder"),e.appendChild(this.titleHolderElement),this.titleElement=this._buildColumnHeaderTitle(),this.titleHolderElement.appendChild(this.titleElement),e}_buildColumnHeaderTitle(){var e=this.definition,i=document.createElement("div");if(i.classList.add("tabulator-col-title"),e.headerWordWrap&&i.classList.add("tabulator-col-title-wrap"),e.editableTitle){var r=document.createElement("input");r.classList.add("tabulator-title-editor"),r.addEventListener("click",n=>{n.stopPropagation(),r.focus()}),r.addEventListener("mousedown",n=>{n.stopPropagation()}),r.addEventListener("change",()=>{e.title=r.value,this.dispatchExternal("columnTitleChanged",this.getComponent())}),i.appendChild(r),e.field?this.langBind("columns|"+e.field,n=>{r.value=n||e.title||"&nbsp;"}):r.value=e.title||"&nbsp;"}else e.field?this.langBind("columns|"+e.field,n=>{this._formatColumnHeaderTitle(i,n||e.title||"&nbsp;")}):this._formatColumnHeaderTitle(i,e.title||"&nbsp;");return i}_formatColumnHeaderTitle(e,i){var r=this.chain("column-format",[this,i,e],null,()=>i);switch(typeof r){case"object":r instanceof Node?e.appendChild(r):(e.innerHTML="",console.warn("Format Error - Title formatter has returned a type of object, the only valid formatter object return is an instance of Node, the formatter returned:",r));break;case"undefined":e.innerHTML="";break;default:e.innerHTML=r}}_buildGroupHeader(){if(this.element.classList.add("tabulator-col-group"),this.element.setAttribute("role","columngroup"),this.element.setAttribute("aria-title",this.definition.title),this.definition.cssClass){var e=this.definition.cssClass.split(" ");e.forEach(i=>{this.element.classList.add(i)})}this.titleElement.style.textAlign=this.definition.headerHozAlign,this.element.appendChild(this.groupElement)}_getFlatData(e){return e[this.field]}_getNestedData(e){var i=e,r=this.fieldStructure,n=r.length,a;for(let o=0;o<n&&(i=i[r[o]],a=i,!!i);o++);return a}_setFlatData(e,i){this.field&&(e[this.field]=i)}_setNestedData(e,i){var r=e,n=this.fieldStructure,a=n.length;for(let o=0;o<a;o++)if(o==a-1)r[n[o]]=i;else{if(!r[n[o]])if(typeof i<"u")r[n[o]]={};else break;r=r[n[o]]}}attachColumn(e){this.groupElement?(this.columns.push(e),this.groupElement.appendChild(e.getElement()),e.columnRendered()):console.warn("Column Warning - Column being attached to another column instead of column group")}verticalAlign(e,i){var r=this.parent.isGroup?this.parent.getGroupElement().clientHeight:i||this.parent.getHeadersElement().clientHeight;this.element.style.height=r+"px",this.dispatch("column-height",this,this.element.style.height),this.isGroup&&(this.groupElement.style.minHeight=r-this.contentElement.offsetHeight+"px"),this.columns.forEach(function(n){n.verticalAlign(e)})}clearVerticalAlign(){this.element.style.paddingTop="",this.element.style.height="",this.element.style.minHeight="",this.groupElement.style.minHeight="",this.columns.forEach(function(e){e.clearVerticalAlign()}),this.dispatch("column-height",this,"")}getElement(){return this.element}getGroupElement(){return this.groupElement}getField(){return this.field}getTitleDownload(){return this.titleDownload}getFirstColumn(){return this.isGroup?this.columns.length?this.columns[0].getFirstColumn():!1:this}getLastColumn(){return this.isGroup?this.columns.length?this.columns[this.columns.length-1].getLastColumn():!1:this}getColumns(e){var i=[];return e?this.columns.forEach(r=>{i.push(r),i=i.concat(r.getColumns(!0))}):i=this.columns,i}getCells(){return this.cells}getTopColumn(){return this.parent.isGroup?this.parent.getTopColumn():this}getDefinition(e){var i=[];return this.isGroup&&e&&(this.columns.forEach(function(r){i.push(r.getDefinition(!0))}),this.definition.columns=i),this.definition}checkColumnVisibility(){var e=!1;this.columns.forEach(function(i){i.visible&&(e=!0)}),e?(this.show(),this.dispatchExternal("columnVisibilityChanged",this.getComponent(),!1)):this.hide()}show(e,i){this.visible||(this.visible=!0,this.element.style.display="",this.parent.isGroup&&this.parent.checkColumnVisibility(),this.cells.forEach(function(r){r.show()}),!this.isGroup&&this.width===null&&this.reinitializeWidth(),this.table.columnManager.verticalAlignHeaders(),this.dispatch("column-show",this,i),e||this.dispatchExternal("columnVisibilityChanged",this.getComponent(),!0),this.parent.isGroup&&this.parent.matchChildWidths(),this.silent||this.table.columnManager.rerenderColumns())}hide(e,i){this.visible&&(this.visible=!1,this.element.style.display="none",this.table.columnManager.verticalAlignHeaders(),this.parent.isGroup&&this.parent.checkColumnVisibility(),this.cells.forEach(function(r){r.hide()}),this.dispatch("column-hide",this,i),e||this.dispatchExternal("columnVisibilityChanged",this.getComponent(),!1),this.parent.isGroup&&this.parent.matchChildWidths(),this.silent||this.table.columnManager.rerenderColumns())}matchChildWidths(){var e=0;this.contentElement&&this.columns.length&&(this.columns.forEach(function(i){i.visible&&(e+=i.getWidth())}),this.contentElement.style.maxWidth=e-1+"px",this.parent.isGroup&&this.parent.matchChildWidths())}removeChild(e){var i=this.columns.indexOf(e);i>-1&&this.columns.splice(i,1),this.columns.length||this.delete()}setWidth(e){this.widthFixed=!0,this.setWidthActual(e)}setWidthActual(e){isNaN(e)&&(e=Math.floor(this.table.element.clientWidth/100*parseInt(e))),e=Math.max(this.minWidth,e),this.maxWidth&&(e=Math.min(this.maxWidth,e)),this.width=e,this.widthStyled=e?e+"px":"",this.element.style.width=this.widthStyled,this.isGroup||this.cells.forEach(function(i){i.setWidth()}),this.parent.isGroup&&this.parent.matchChildWidths(),this.dispatch("column-width",this),this.subscribedExternal("columnWidth")&&this.dispatchExternal("columnWidth",this.getComponent())}checkCellHeights(){var e=[];this.cells.forEach(function(i){i.row.heightInitialized&&(i.row.getElement().offsetParent!==null?(e.push(i.row),i.row.clearCellHeight()):i.row.heightInitialized=!1)}),e.forEach(function(i){i.calcHeight()}),e.forEach(function(i){i.setCellHeight()})}getWidth(){var e=0;return this.isGroup?this.columns.forEach(function(i){i.visible&&(e+=i.getWidth())}):e=this.width,e}getLeftOffset(){var e=this.element.offsetLeft;return this.parent.isGroup&&(e+=this.parent.getLeftOffset()),e}getHeight(){return Math.ceil(this.element.getBoundingClientRect().height)}setMinWidth(e){this.maxWidth&&e>this.maxWidth&&(e=this.maxWidth,console.warn("the minWidth ("+e+"px) for column '"+this.field+"' cannot be bigger that its maxWidth ("+this.maxWidthStyled+")")),this.minWidth=e,this.minWidthStyled=e?e+"px":"",this.element.style.minWidth=this.minWidthStyled,this.cells.forEach(function(i){i.setMinWidth()})}setMaxWidth(e){this.minWidth&&e<this.minWidth&&(e=this.minWidth,console.warn("the maxWidth ("+e+"px) for column '"+this.field+"' cannot be smaller that its minWidth ("+this.minWidthStyled+")")),this.maxWidth=e,this.maxWidthStyled=e?e+"px":"",this.element.style.maxWidth=this.maxWidthStyled,this.cells.forEach(function(i){i.setMaxWidth()})}delete(){return new Promise((e,i)=>{this.isGroup&&this.columns.forEach(function(n){n.delete()}),this.dispatch("column-delete",this);var r=this.cells.length;for(let n=0;n<r;n++)this.cells[0].delete();this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.element=!1,this.contentElement=!1,this.titleElement=!1,this.groupElement=!1,this.parent.isGroup&&this.parent.removeChild(this),this.table.columnManager.deregisterColumn(this),this.table.columnManager.rerenderColumns(!0),this.dispatch("column-deleted",this),e()})}columnRendered(){this.titleFormatterRendered&&this.titleFormatterRendered(),this.dispatch("column-rendered",this)}generateCell(e){var i=new Bb(this,e);return this.cells.push(i),i}nextColumn(){var e=this.table.columnManager.findColumnIndex(this);return e>-1?this._nextVisibleColumn(e+1):!1}_nextVisibleColumn(e){var i=this.table.columnManager.getColumnByIndex(e);return!i||i.visible?i:this._nextVisibleColumn(e+1)}prevColumn(){var e=this.table.columnManager.findColumnIndex(this);return e>-1?this._prevVisibleColumn(e-1):!1}_prevVisibleColumn(e){var i=this.table.columnManager.getColumnByIndex(e);return!i||i.visible?i:this._prevVisibleColumn(e-1)}reinitializeWidth(e){this.widthFixed=!1,typeof this.definition.width<"u"&&!e&&this.setWidth(this.definition.width),this.dispatch("column-width-fit-before",this),this.fitToData(e),this.dispatch("column-width-fit-after",this)}fitToData(e){if(!this.isGroup){this.widthFixed||(this.element.style.width="",this.cells.forEach(n=>{n.clearWidth()}));var i=this.element.offsetWidth;if((!this.width||!this.widthFixed)&&(this.cells.forEach(n=>{var a=n.getWidth();a>i&&(i=a)}),i)){var r=i+1;this.maxInitialWidth&&!e&&(r=Math.min(r,this.maxInitialWidth)),this.setWidthActual(r)}}}updateDefinition(e){var i;return this.isGroup||this.parent.isGroup?(console.error("Column Update Error - The updateDefinition function is only available on ungrouped columns"),Promise.reject("Column Update Error - The updateDefinition function is only available on columns, not column groups")):(i=Object.assign({},this.getDefinition()),i=Object.assign(i,e),this.table.columnManager.addColumn(i,!1,this).then(r=>(i.field==this.field&&(this.field=!1),this.delete().then(()=>r.getComponent()))))}deleteCell(e){var i=this.cells.indexOf(e);i>-1&&this.cells.splice(i,1)}getComponent(){return this.component||(this.component=new f7(this)),this.component}getPosition(){return this.table.columnManager.getVisibleColumnsByIndex().indexOf(this)+1}getParentComponent(){return this.parent instanceof Gp?this.parent.getComponent():!1}};Ve(Gp,"defaultOptionList",g7);let nm=Gp;class qD{constructor(e){return this._row=e,new Proxy(this,{get:function(i,r,n){return typeof i[r]<"u"?i[r]:i._row.table.componentFunctionBinder.handle("row",i._row,r)}})}getData(e){return this._row.getData(e)}getElement(){return this._row.getElement()}getCells(){var e=[];return this._row.getCells().forEach(function(i){e.push(i.getComponent())}),e}getCell(e){var i=this._row.getCell(e);return i?i.getComponent():!1}getIndex(){return this._row.getData("data")[this._row.table.options.index]}getPosition(){return this._row.getPosition()}watchPosition(e){return this._row.watchPosition(e)}delete(){return this._row.delete()}scrollTo(e,i){return this._row.table.rowManager.scrollToRow(this._row,e,i)}move(e,i){this._row.moveToRow(e,i)}update(e){return this._row.updateData(e)}normalizeHeight(){this._row.normalizeHeight(!0)}_getSelf(){return this._row}reformat(){return this._row.reinitialize()}getTable(){return this._row.table}getNextRow(){var e=this._row.nextRow();return e&&e.getComponent()}getPrevRow(){var e=this._row.prevRow();return e&&e.getComponent()}}class io extends Ka{constructor(e,i,r="row"){super(i.table),this.parent=i,this.data={},this.type=r,this.element=!1,this.modules={},this.cells=[],this.height=0,this.heightStyled="",this.manualHeight=!1,this.outerHeight=0,this.initialized=!1,this.heightInitialized=!1,this.position=0,this.positionWatchers=[],this.component=null,this.created=!1,this.setData(e)}create(){this.created||(this.created=!0,this.generateElement())}createElement(){var e=document.createElement("div");e.classList.add("tabulator-row"),e.setAttribute("role","row"),this.element=e}getElement(){return this.create(),this.element}detachElement(){this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element)}generateElement(){this.createElement(),this.dispatch("row-init",this)}generateCells(){this.cells=this.table.columnManager.generateCells(this)}initialize(e,i){if(this.create(),!this.initialized||e){for(this.deleteCells();this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.dispatch("row-layout-before",this),this.generateCells(),this.initialized=!0,this.table.columnManager.renderer.renderRowCells(this,i),e&&this.normalizeHeight(),this.dispatch("row-layout",this),this.table.options.rowFormatter&&this.table.options.rowFormatter(this.getComponent()),this.dispatch("row-layout-after",this)}else this.table.columnManager.renderer.rerenderRowCells(this,i)}rendered(){this.cells.forEach(e=>{e.cellRendered()})}reinitializeHeight(){this.heightInitialized=!1,this.element&&this.element.offsetParent!==null&&this.normalizeHeight(!0)}deinitialize(){this.initialized=!1}deinitializeHeight(){this.heightInitialized=!1}reinitialize(e){this.initialized=!1,this.heightInitialized=!1,this.manualHeight||(this.height=0,this.heightStyled=""),this.element&&this.element.offsetParent!==null&&this.initialize(!0),this.dispatch("row-relayout",this)}calcHeight(e){var i=0,r=0;this.table.options.rowHeight?this.height=this.table.options.rowHeight:(r=this.calcMinHeight(),i=this.calcMaxHeight(),e?this.height=Math.max(i,r):this.height=this.manualHeight?this.height:Math.max(i,r)),this.heightStyled=this.height?this.height+"px":"",this.outerHeight=this.element.offsetHeight}calcMinHeight(){return this.table.options.resizableRows?this.element.clientHeight:0}calcMaxHeight(){var e=0;return this.cells.forEach(function(i){var r=i.getHeight();r>e&&(e=r)}),e}setCellHeight(){this.cells.forEach(function(e){e.setHeight()}),this.heightInitialized=!0}clearCellHeight(){this.cells.forEach(function(e){e.clearHeight()})}normalizeHeight(e){e&&!this.table.options.rowHeight&&this.clearCellHeight(),this.calcHeight(e),this.setCellHeight()}setHeight(e,i){(this.height!=e||i)&&(this.manualHeight=!0,this.height=e,this.heightStyled=e?e+"px":"",this.setCellHeight(),this.outerHeight=this.element.offsetHeight,this.subscribedExternal("rowHeight")&&this.dispatchExternal("rowHeight",this.getComponent()))}getHeight(){return this.outerHeight}getWidth(){return this.element.offsetWidth}deleteCell(e){var i=this.cells.indexOf(e);i>-1&&this.cells.splice(i,1)}setData(e){this.data=this.chain("row-data-init-before",[this,e],void 0,e),this.dispatch("row-data-init-after",this)}updateData(e){var i=this.element&&xr.elVisible(this.element),r={},n;return new Promise((a,o)=>{typeof e=="string"&&(e=JSON.parse(e)),this.dispatch("row-data-save-before",this),this.subscribed("row-data-changing")&&(r=Object.assign(r,this.data),r=Object.assign(r,e)),n=this.chain("row-data-changing",[this,r,e],null,e);for(let s in n)this.data[s]=n[s];this.dispatch("row-data-save-after",this);for(let s in e)this.table.columnManager.getColumnsByFieldRoot(s).forEach(u=>{let c=this.getCell(u.getField());if(c){let d=u.getFieldValue(n);c.getValue()!==d&&(c.setValueProcessData(d),i&&c.cellRendered())}});i?(this.normalizeHeight(!0),this.table.options.rowFormatter&&this.table.options.rowFormatter(this.getComponent())):(this.initialized=!1,this.height=0,this.heightStyled=""),this.dispatch("row-data-changed",this,i,e),this.dispatchExternal("rowUpdated",this.getComponent()),this.subscribedExternal("dataChanged")&&this.dispatchExternal("dataChanged",this.table.rowManager.getData()),a()})}getData(e){return e?this.chain("row-data-retrieve",[this,e],null,this.data):this.data}getCell(e){var i=!1;return e=this.table.columnManager.findColumn(e),!this.initialized&&this.cells.length===0&&this.generateCells(),i=this.cells.find(function(r){return r.column===e}),i}getCellIndex(e){return this.cells.findIndex(function(i){return i===e})}findCell(e){return this.cells.find(i=>i.element===e)}getCells(){return!this.initialized&&this.cells.length===0&&this.generateCells(),this.cells}nextRow(){var e=this.table.rowManager.nextDisplayRow(this,!0);return e||!1}prevRow(){var e=this.table.rowManager.prevDisplayRow(this,!0);return e||!1}moveToRow(e,i){var r=this.table.rowManager.findRow(e);r?(this.table.rowManager.moveRowActual(this,r,!i),this.table.rowManager.refreshActiveData("display",!1,!0)):console.warn("Move Error - No matching row found:",e)}delete(){return this.dispatch("row-delete",this),this.deleteActual(),Promise.resolve()}deleteActual(e){this.detachModules(),this.table.rowManager.deleteRow(this,e),this.deleteCells(),this.initialized=!1,this.heightInitialized=!1,this.element=!1,this.dispatch("row-deleted",this)}detachModules(){this.dispatch("row-deleting",this)}deleteCells(){var e=this.cells.length;for(let i=0;i<e;i++)this.cells[0].delete()}wipe(){if(this.detachModules(),this.deleteCells(),this.element){for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.element.parentNode&&this.element.parentNode.removeChild(this.element)}this.element=!1,this.modules={}}isDisplayed(){return this.table.rowManager.getDisplayRows().includes(this)}getPosition(){return this.isDisplayed()?this.position:!1}setPosition(e){e!=this.position&&(this.position=e,this.positionWatchers.forEach(i=>{i(this.position)}))}watchPosition(e){this.positionWatchers.push(e),e(this.position)}getGroup(){return this.modules.group||!1}getComponent(){return this.component||(this.component=new qD(this)),this.component}}var vge={avg:function(t,e,i){var r=0,n=typeof i.precision<"u"?i.precision:2;return t.length&&(r=t.reduce(function(a,o){return Number(a)+Number(o)}),r=r/t.length,r=n!==!1?r.toFixed(n):r),parseFloat(r).toString()},max:function(t,e,i){var r=null,n=typeof i.precision<"u"?i.precision:!1;return t.forEach(function(a){a=Number(a),(a>r||r===null)&&(r=a)}),r!==null?n!==!1?r.toFixed(n):r:""},min:function(t,e,i){var r=null,n=typeof i.precision<"u"?i.precision:!1;return t.forEach(function(a){a=Number(a),(a<r||r===null)&&(r=a)}),r!==null?n!==!1?r.toFixed(n):r:""},sum:function(t,e,i){var r=0,n=typeof i.precision<"u"?i.precision:!1;return t.length&&t.forEach(function(a){a=Number(a),r+=isNaN(a)?0:Number(a)}),n!==!1?r.toFixed(n):r},concat:function(t,e,i){var r=0;return t.length&&(r=t.reduce(function(n,a){return String(n)+String(a)})),r},count:function(t,e,i){var r=0;return t.length&&t.forEach(function(n){n&&r++}),r},unique:function(t,e,i){var r=t.filter((n,a)=>(t||n===0)&&t.indexOf(n)===a);return r.length}};const Id=class Id extends ci{constructor(e){super(e),this.topCalcs=[],this.botCalcs=[],this.genColumn=!1,this.topElement=this.createElement(),this.botElement=this.createElement(),this.topRow=!1,this.botRow=!1,this.topInitialized=!1,this.botInitialized=!1,this.blocked=!1,this.recalcAfterBlock=!1,this.registerTableOption("columnCalcs",!0),this.registerColumnOption("topCalc"),this.registerColumnOption("topCalcParams"),this.registerColumnOption("topCalcFormatter"),this.registerColumnOption("topCalcFormatterParams"),this.registerColumnOption("bottomCalc"),this.registerColumnOption("bottomCalcParams"),this.registerColumnOption("bottomCalcFormatter"),this.registerColumnOption("bottomCalcFormatterParams")}createElement(){var e=document.createElement("div");return e.classList.add("tabulator-calcs-holder"),e}initialize(){this.genColumn=new nm({field:"value"},this),this.subscribe("cell-value-changed",this.cellValueChanged.bind(this)),this.subscribe("column-init",this.initializeColumnCheck.bind(this)),this.subscribe("row-deleted",this.rowsUpdated.bind(this)),this.subscribe("scroll-horizontal",this.scrollHorizontal.bind(this)),this.subscribe("row-added",this.rowsUpdated.bind(this)),this.subscribe("column-moved",this.recalcActiveRows.bind(this)),this.subscribe("column-add",this.recalcActiveRows.bind(this)),this.subscribe("data-refreshed",this.recalcActiveRowsRefresh.bind(this)),this.subscribe("table-redraw",this.tableRedraw.bind(this)),this.subscribe("rows-visible",this.visibleRows.bind(this)),this.subscribe("scrollbar-vertical",this.adjustForScrollbar.bind(this)),this.subscribe("redraw-blocked",this.blockRedraw.bind(this)),this.subscribe("redraw-restored",this.restoreRedraw.bind(this)),this.subscribe("table-redrawing",this.resizeHolderWidth.bind(this)),this.subscribe("column-resized",this.resizeHolderWidth.bind(this)),this.subscribe("column-show",this.resizeHolderWidth.bind(this)),this.subscribe("column-hide",this.resizeHolderWidth.bind(this)),this.registerTableFunction("getCalcResults",this.getResults.bind(this)),this.registerTableFunction("recalc",this.userRecalc.bind(this)),this.resizeHolderWidth()}resizeHolderWidth(){this.topElement.style.minWidth=this.table.columnManager.headersElement.offsetWidth+"px"}tableRedraw(e){this.recalc(this.table.rowManager.activeRows),e&&this.redraw()}blockRedraw(){this.blocked=!0,this.recalcAfterBlock=!1}restoreRedraw(){this.blocked=!1,this.recalcAfterBlock&&(this.recalcAfterBlock=!1,this.recalcActiveRowsRefresh())}userRecalc(){this.recalc(this.table.rowManager.activeRows)}blockCheck(){return this.blocked&&(this.recalcAfterBlock=!0),this.blocked}visibleRows(e,i){return this.topRow&&i.unshift(this.topRow),this.botRow&&i.push(this.botRow),i}rowsUpdated(e){this.table.options.groupBy?this.recalcRowGroup(e):this.recalcActiveRows()}recalcActiveRowsRefresh(){this.table.options.groupBy&&this.table.options.dataTreeStartExpanded&&this.table.options.dataTree?this.recalcAll():this.recalcActiveRows()}recalcActiveRows(){this.recalc(this.table.rowManager.activeRows)}cellValueChanged(e){(e.column.definition.topCalc||e.column.definition.bottomCalc)&&(this.table.options.groupBy?((this.table.options.columnCalcs=="table"||this.table.options.columnCalcs=="both")&&this.recalcActiveRows(),this.table.options.columnCalcs!="table"&&this.recalcRowGroup(e.row)):this.recalcActiveRows())}initializeColumnCheck(e){(e.definition.topCalc||e.definition.bottomCalc)&&this.initializeColumn(e)}initializeColumn(e){var i=e.definition,r={topCalcParams:i.topCalcParams||{},botCalcParams:i.bottomCalcParams||{}};if(i.topCalc){switch(typeof i.topCalc){case"string":Id.calculations[i.topCalc]?r.topCalc=Id.calculations[i.topCalc]:console.warn("Column Calc Error - No such calculation found, ignoring: ",i.topCalc);break;case"function":r.topCalc=i.topCalc;break}r.topCalc&&(e.modules.columnCalcs=r,this.topCalcs.push(e),this.table.options.columnCalcs!="group"&&this.initializeTopRow())}if(i.bottomCalc){switch(typeof i.bottomCalc){case"string":Id.calculations[i.bottomCalc]?r.botCalc=Id.calculations[i.bottomCalc]:console.warn("Column Calc Error - No such calculation found, ignoring: ",i.bottomCalc);break;case"function":r.botCalc=i.bottomCalc;break}r.botCalc&&(e.modules.columnCalcs=r,this.botCalcs.push(e),this.table.options.columnCalcs!="group"&&this.initializeBottomRow())}}registerColumnField(){}removeCalcs(){var e=!1;this.topInitialized&&(this.topInitialized=!1,this.topElement.parentNode.removeChild(this.topElement),e=!0),this.botInitialized&&(this.botInitialized=!1,this.footerRemove(this.botElement),e=!0),e&&this.table.rowManager.adjustTableSize()}reinitializeCalcs(){this.topCalcs.length&&this.initializeTopRow(),this.botCalcs.length&&this.initializeBottomRow()}initializeTopRow(){var e=document.createDocumentFragment();this.topInitialized||(e.appendChild(document.createElement("br")),e.appendChild(this.topElement),this.table.columnManager.getContentsElement().insertBefore(e,this.table.columnManager.headersElement.nextSibling),this.topInitialized=!0)}initializeBottomRow(){this.botInitialized||(this.footerPrepend(this.botElement),this.botInitialized=!0)}scrollHorizontal(e){this.botInitialized&&this.botRow&&(this.botElement.scrollLeft=e)}recalc(e){var i,r;if(!this.blockCheck()&&(this.topInitialized||this.botInitialized)){if(i=this.rowsToData(e),this.topInitialized){for(this.topRow&&this.topRow.deleteCells(),r=this.generateRow("top",i),this.topRow=r;this.topElement.firstChild;)this.topElement.removeChild(this.topElement.firstChild);this.topElement.appendChild(r.getElement()),r.initialize(!0)}if(this.botInitialized){for(this.botRow&&this.botRow.deleteCells(),r=this.generateRow("bottom",i),this.botRow=r;this.botElement.firstChild;)this.botElement.removeChild(this.botElement.firstChild);this.botElement.appendChild(r.getElement()),r.initialize(!0)}this.table.rowManager.adjustTableSize(),this.table.modExists("frozenColumns")&&this.table.modules.frozenColumns.layout()}}recalcRowGroup(e){this.recalcGroup(this.table.modules.groupRows.getRowGroup(e))}recalcAll(){if((this.topCalcs.length||this.botCalcs.length)&&(this.table.options.columnCalcs!=="group"&&this.recalcActiveRows(),this.table.options.groupBy&&this.table.options.columnCalcs!=="table")){var e=this.table.modules.groupRows.getChildGroups();e.forEach(i=>{this.recalcGroup(i)})}}recalcGroup(e){var i,r;this.blockCheck()||e&&e.calcs&&(e.calcs.bottom&&(i=this.rowsToData(e.rows),r=this.generateRowData("bottom",i),e.calcs.bottom.updateData(r),e.calcs.bottom.reinitialize()),e.calcs.top&&(i=this.rowsToData(e.rows),r=this.generateRowData("top",i),e.calcs.top.updateData(r),e.calcs.top.reinitialize()))}generateTopRow(e){return this.generateRow("top",this.rowsToData(e))}generateBottomRow(e){return this.generateRow("bottom",this.rowsToData(e))}rowsToData(e){var i=[],r=this.table.options.dataTree&&this.table.options.dataTreeChildColumnCalcs,n=this.table.modules.dataTree;return e.forEach(a=>{var o;i.push(a.getData()),r&&((o=a.modules.dataTree)!=null&&o.open)&&this.rowsToData(n.getFilteredTreeChildren(a)).forEach(s=>{i.push(a)})}),i}generateRow(e,i){var r=this.generateRowData(e,i),n;return this.table.modExists("mutator")&&this.table.modules.mutator.disable(),n=new io(r,this,"calc"),this.table.modExists("mutator")&&this.table.modules.mutator.enable(),n.getElement().classList.add("tabulator-calcs","tabulator-calcs-"+e),n.component=!1,n.getComponent=()=>(n.component||(n.component=new gge(n)),n.component),n.generateCells=()=>{var a=[];this.table.columnManager.columnsByIndex.forEach(o=>{this.genColumn.setField(o.getField()),this.genColumn.hozAlign=o.hozAlign,o.definition[e+"CalcFormatter"]&&this.table.modExists("format")?this.genColumn.modules.format={formatter:this.table.modules.format.getFormatter(o.definition[e+"CalcFormatter"]),params:o.definition[e+"CalcFormatterParams"]||{}}:this.genColumn.modules.format={formatter:this.table.modules.format.getFormatter("plaintext"),params:{}},this.genColumn.definition.cssClass=o.definition.cssClass;var s=new Bb(this.genColumn,n);s.getElement(),s.column=o,s.setWidth(),o.cells.push(s),a.push(s),o.visible||s.hide()}),n.cells=a},n}generateRowData(e,i){var r={},n=e=="top"?this.topCalcs:this.botCalcs,a=e=="top"?"topCalc":"botCalc",o,s;return n.forEach(function(l){var u=[];l.modules.columnCalcs&&l.modules.columnCalcs[a]&&(i.forEach(function(c){u.push(l.getFieldValue(c))}),s=a+"Params",o=typeof l.modules.columnCalcs[s]=="function"?l.modules.columnCalcs[s](u,i):l.modules.columnCalcs[s],l.setFieldValue(r,l.modules.columnCalcs[a](u,i,o)))}),r}hasTopCalcs(){return!!this.topCalcs.length}hasBottomCalcs(){return!!this.botCalcs.length}redraw(){this.topRow&&this.topRow.normalizeHeight(!0),this.botRow&&this.botRow.normalizeHeight(!0)}getResults(){var e={},i;return this.table.options.groupBy&&this.table.modExists("groupRows")?(i=this.table.modules.groupRows.getGroups(!0),i.forEach(r=>{e[r.getKey()]=this.getGroupResults(r)})):e={top:this.topRow?this.topRow.getData():{},bottom:this.botRow?this.botRow.getData():{}},e}getGroupResults(e){var i=e._getSelf(),r=e.getSubGroups(),n={},a={};return r.forEach(o=>{n[o.getKey()]=this.getGroupResults(o)}),a={top:i.calcs.top?i.calcs.top.getData():{},bottom:i.calcs.bottom?i.calcs.bottom.getData():{},groups:n},a}adjustForScrollbar(e){this.botRow&&(this.table.rtl?this.botElement.style.paddingLeft=e+"px":this.botElement.style.paddingRight=e+"px")}};Ve(Id,"moduleName","columnCalcs"),Ve(Id,"calculations",vge);let b1=Id;class v7 extends ci{constructor(e){super(e),this.indent=10,this.field="",this.collapseEl=null,this.expandEl=null,this.branchEl=null,this.elementField=!1,this.startOpen=function(){},this.registerTableOption("dataTree",!1),this.registerTableOption("dataTreeFilter",!0),this.registerTableOption("dataTreeSort",!0),this.registerTableOption("dataTreeElementColumn",!1),this.registerTableOption("dataTreeBranchElement",!0),this.registerTableOption("dataTreeChildIndent",9),this.registerTableOption("dataTreeChildField","_children"),this.registerTableOption("dataTreeCollapseElement",!1),this.registerTableOption("dataTreeExpandElement",!1),this.registerTableOption("dataTreeStartExpanded",!1),this.registerTableOption("dataTreeChildColumnCalcs",!1),this.registerTableOption("dataTreeSelectPropagate",!1),this.registerComponentFunction("row","treeCollapse",this.collapseRow.bind(this)),this.registerComponentFunction("row","treeExpand",this.expandRow.bind(this)),this.registerComponentFunction("row","treeToggle",this.toggleRow.bind(this)),this.registerComponentFunction("row","getTreeParent",this.getTreeParent.bind(this)),this.registerComponentFunction("row","getTreeChildren",this.getRowChildren.bind(this)),this.registerComponentFunction("row","addTreeChild",this.addTreeChildRow.bind(this)),this.registerComponentFunction("row","isTreeExpanded",this.isRowExpanded.bind(this))}initialize(){if(this.table.options.dataTree){var e=null,i=this.table.options;switch(this.field=i.dataTreeChildField,this.indent=i.dataTreeChildIndent,this.options("movableRows")&&console.warn("The movableRows option is not available with dataTree enabled, moving of child rows could result in unpredictable behavior"),i.dataTreeBranchElement?i.dataTreeBranchElement===!0?(this.branchEl=document.createElement("div"),this.branchEl.classList.add("tabulator-data-tree-branch")):typeof i.dataTreeBranchElement=="string"?(e=document.createElement("div"),e.innerHTML=i.dataTreeBranchElement,this.branchEl=e.firstChild):this.branchEl=i.dataTreeBranchElement:(this.branchEl=document.createElement("div"),this.branchEl.classList.add("tabulator-data-tree-branch-empty")),i.dataTreeCollapseElement?typeof i.dataTreeCollapseElement=="string"?(e=document.createElement("div"),e.innerHTML=i.dataTreeCollapseElement,this.collapseEl=e.firstChild):this.collapseEl=i.dataTreeCollapseElement:(this.collapseEl=document.createElement("div"),this.collapseEl.classList.add("tabulator-data-tree-control"),this.collapseEl.tabIndex=0,this.collapseEl.innerHTML="<div class='tabulator-data-tree-control-collapse'></div>"),i.dataTreeExpandElement?typeof i.dataTreeExpandElement=="string"?(e=document.createElement("div"),e.innerHTML=i.dataTreeExpandElement,this.expandEl=e.firstChild):this.expandEl=i.dataTreeExpandElement:(this.expandEl=document.createElement("div"),this.expandEl.classList.add("tabulator-data-tree-control"),this.expandEl.tabIndex=0,this.expandEl.innerHTML="<div class='tabulator-data-tree-control-expand'></div>"),typeof i.dataTreeStartExpanded){case"boolean":this.startOpen=function(r,n){return i.dataTreeStartExpanded};break;case"function":this.startOpen=i.dataTreeStartExpanded;break;default:this.startOpen=function(r,n){return i.dataTreeStartExpanded[n]};break}this.subscribe("row-init",this.initializeRow.bind(this)),this.subscribe("row-layout-after",this.layoutRow.bind(this)),this.subscribe("row-deleted",this.rowDelete.bind(this),0),this.subscribe("row-data-changed",this.rowDataChanged.bind(this),10),this.subscribe("cell-value-updated",this.cellValueChanged.bind(this)),this.subscribe("edit-cancelled",this.cellValueChanged.bind(this)),this.subscribe("column-moving-rows",this.columnMoving.bind(this)),this.subscribe("table-built",this.initializeElementField.bind(this)),this.subscribe("table-redrawing",this.tableRedrawing.bind(this)),this.registerDisplayHandler(this.getRows.bind(this),30)}}tableRedrawing(e){var i;e&&(i=this.table.rowManager.getRows(),i.forEach(r=>{this.reinitializeRowChildren(r)}))}initializeElementField(){var e=this.table.columnManager.getFirstVisibleColumn();this.elementField=this.table.options.dataTreeElementColumn||(e?e.field:!1)}getRowChildren(e){return this.getTreeChildren(e,!0)}columnMoving(){var e=[];return this.table.rowManager.rows.forEach(i=>{e=e.concat(this.getTreeChildren(i,!1,!0))}),e}rowDataChanged(e,i,r){this.redrawNeeded(r)&&(this.initializeRow(e),i&&(this.layoutRow(e),this.refreshData(!0)))}cellValueChanged(e){var i=e.column.getField();i===this.elementField&&this.layoutRow(e.row)}initializeRow(e){var i=e.getData()[this.field],r=Array.isArray(i),n=r||!r&&typeof i=="object"&&i!==null;!n&&e.modules.dataTree&&e.modules.dataTree.branchEl&&e.modules.dataTree.branchEl.parentNode.removeChild(e.modules.dataTree.branchEl),!n&&e.modules.dataTree&&e.modules.dataTree.controlEl&&e.modules.dataTree.controlEl.parentNode.removeChild(e.modules.dataTree.controlEl),e.modules.dataTree={index:e.modules.dataTree?e.modules.dataTree.index:0,open:n?e.modules.dataTree?e.modules.dataTree.open:this.startOpen(e.getComponent(),0):!1,controlEl:e.modules.dataTree&&n?e.modules.dataTree.controlEl:!1,branchEl:e.modules.dataTree&&n?e.modules.dataTree.branchEl:!1,parent:e.modules.dataTree?e.modules.dataTree.parent:!1,children:n}}reinitializeRowChildren(e){var i=this.getTreeChildren(e,!1,!0);i.forEach(function(r){r.reinitialize(!0)})}layoutRow(e){var i=this.elementField?e.getCell(this.elementField):e.getCells()[0],r=i.getElement(),n=e.modules.dataTree;n.branchEl&&(n.branchEl.parentNode&&n.branchEl.parentNode.removeChild(n.branchEl),n.branchEl=!1),n.controlEl&&(n.controlEl.parentNode&&n.controlEl.parentNode.removeChild(n.controlEl),n.controlEl=!1),this.generateControlElement(e,r),e.getElement().classList.add("tabulator-tree-level-"+n.index),n.index&&(this.branchEl?(n.branchEl=this.branchEl.cloneNode(!0),r.insertBefore(n.branchEl,r.firstChild),this.table.rtl?n.branchEl.style.marginRight=(n.branchEl.offsetWidth+n.branchEl.style.marginLeft)*(n.index-1)+n.index*this.indent+"px":n.branchEl.style.marginLeft=(n.branchEl.offsetWidth+n.branchEl.style.marginRight)*(n.index-1)+n.index*this.indent+"px"):this.table.rtl?r.style.paddingRight=parseInt(window.getComputedStyle(r,null).getPropertyValue("padding-right"))+n.index*this.indent+"px":r.style.paddingLeft=parseInt(window.getComputedStyle(r,null).getPropertyValue("padding-left"))+n.index*this.indent+"px")}generateControlElement(e,i){var r=e.modules.dataTree,n=r.controlEl;i=i||e.getCells()[0].getElement(),r.children!==!1&&(r.open?(r.controlEl=this.collapseEl.cloneNode(!0),r.controlEl.addEventListener("click",a=>{a.stopPropagation(),this.collapseRow(e)})):(r.controlEl=this.expandEl.cloneNode(!0),r.controlEl.addEventListener("click",a=>{a.stopPropagation(),this.expandRow(e)})),r.controlEl.addEventListener("mousedown",a=>{a.stopPropagation()}),n&&n.parentNode===i?n.parentNode.replaceChild(r.controlEl,n):i.insertBefore(r.controlEl,i.firstChild))}getRows(e){var i=[];return e.forEach((r,n)=>{var a,o;i.push(r),r instanceof io&&(r.create(),a=r.modules.dataTree,!a.index&&a.children!==!1&&(o=this.getChildren(r,!1,!0),o.forEach(s=>{s.create(),i.push(s)})))}),i}getChildren(e,i,r){var n=e.modules.dataTree,a=[],o=[];return n.children!==!1&&(n.open||i)&&(Array.isArray(n.children)||(n.children=this.generateChildren(e)),this.table.modExists("filter")&&this.table.options.dataTreeFilter?a=this.table.modules.filter.filter(n.children):a=n.children,this.table.modExists("sort")&&this.table.options.dataTreeSort&&this.table.modules.sort.sort(a,r),a.forEach(s=>{o.push(s);var l=this.getChildren(s,!1,!0);l.forEach(u=>{o.push(u)})})),o}generateChildren(e){var i=[],r=e.getData()[this.field];return Array.isArray(r)||(r=[r]),r.forEach(n=>{var a=new io(n||{},this.table.rowManager);a.create(),a.modules.dataTree.index=e.modules.dataTree.index+1,a.modules.dataTree.parent=e,a.modules.dataTree.children&&(a.modules.dataTree.open=this.startOpen(a.getComponent(),a.modules.dataTree.index)),i.push(a)}),i}expandRow(e,i){var r=e.modules.dataTree;r.children!==!1&&(r.open=!0,e.reinitialize(),this.refreshData(!0),this.dispatchExternal("dataTreeRowExpanded",e.getComponent(),e.modules.dataTree.index))}collapseRow(e){var i=e.modules.dataTree;i.children!==!1&&(i.open=!1,e.reinitialize(),this.refreshData(!0),this.dispatchExternal("dataTreeRowCollapsed",e.getComponent(),e.modules.dataTree.index))}toggleRow(e){var i=e.modules.dataTree;i.children!==!1&&(i.open?this.collapseRow(e):this.expandRow(e))}isRowExpanded(e){return e.modules.dataTree.open}getTreeParent(e){return e.modules.dataTree.parent?e.modules.dataTree.parent.getComponent():!1}getTreeParentRoot(e){return e.modules.dataTree&&e.modules.dataTree.parent?this.getTreeParentRoot(e.modules.dataTree.parent):e}getFilteredTreeChildren(e){var i=e.modules.dataTree,r=[],n;return i.children&&(Array.isArray(i.children)||(i.children=this.generateChildren(e)),this.table.modExists("filter")&&this.table.options.dataTreeFilter?n=this.table.modules.filter.filter(i.children):n=i.children,n.forEach(a=>{a instanceof io&&r.push(a)})),r}rowDelete(e){var i=e.modules.dataTree.parent,r;i&&(r=this.findChildIndex(e,i),r!==!1&&i.data[this.field].splice(r,1),i.data[this.field].length||delete i.data[this.field],this.initializeRow(i),this.layoutRow(i)),this.refreshData(!0)}addTreeChildRow(e,i,r,n){var a=!1;typeof i=="string"&&(i=JSON.parse(i)),Array.isArray(e.data[this.field])||(e.data[this.field]=[],e.modules.dataTree.open=this.startOpen(e.getComponent(),e.modules.dataTree.index)),typeof n<"u"&&(a=this.findChildIndex(n,e),a!==!1&&e.data[this.field].splice(r?a:a+1,0,i)),a===!1&&(r?e.data[this.field].unshift(i):e.data[this.field].push(i)),this.initializeRow(e),this.layoutRow(e),this.refreshData(!0)}findChildIndex(e,i){var r=!1;return typeof e=="object"?e instanceof io?r=e.data:e instanceof qD?r=e._getSelf().data:typeof HTMLElement<"u"&&e instanceof HTMLElement?i.modules.dataTree&&(r=i.modules.dataTree.children.find(n=>n instanceof io?n.element===e:!1),r&&(r=r.data)):e===null&&(r=!1):typeof e>"u"?r=!1:r=i.data[this.field].find(n=>n.data[this.table.options.index]==e),r&&(Array.isArray(i.data[this.field])&&(r=i.data[this.field].indexOf(r)),r==-1&&(r=!1)),r}getTreeChildren(e,i,r){var n=e.modules.dataTree,a=[];return n&&n.children&&(Array.isArray(n.children)||(n.children=this.generateChildren(e)),n.children.forEach(o=>{o instanceof io&&(a.push(i?o.getComponent():o),r&&this.getTreeChildren(o,i,r).forEach(s=>{a.push(s)}))})),a}getChildField(){return this.field}redrawNeeded(e){return(this.field?typeof e[this.field]<"u":!1)||(this.elementField?typeof e[this.elementField]<"u":!1)}}Ve(v7,"moduleName","dataTree");function Ige(t,e={},i){var r=e.delimiter?e.delimiter:",",n=[],a=[];t.forEach(o=>{var s=[];switch(o.type){case"group":console.warn("Download Warning - CSV downloader cannot process row groups");break;case"calc":console.warn("Download Warning - CSV downloader cannot process column calculations");break;case"header":o.columns.forEach((l,u)=>{l&&l.depth===1&&(a[u]=typeof l.value>"u"||l.value===null?"":'"'+String(l.value).split('"').join('""')+'"')});break;case"row":o.columns.forEach(l=>{if(l){switch(typeof l.value){case"object":l.value=l.value!==null?JSON.stringify(l.value):"";break;case"undefined":l.value="";break}s.push('"'+String(l.value).split('"').join('""')+'"')}}),n.push(s.join(r));break}}),a.length&&n.unshift(a.join(r)),n=n.join(`
`),e.bom&&(n="\uFEFF"+n),i(n,"text/csv")}function yge(t,e,i){var r=[];t.forEach(n=>{var a={};switch(n.type){case"header":break;case"group":console.warn("Download Warning - JSON downloader cannot process row groups");break;case"calc":console.warn("Download Warning - JSON downloader cannot process column calculations");break;case"row":n.columns.forEach(o=>{o&&(a[o.component.getTitleDownload()||o.component.getField()]=o.value)}),r.push(a);break}}),r=JSON.stringify(r,null,"	"),i(r,"application/json")}function bge(t,e={},i){var r=[],n=[],a={},o=e.rowGroupStyles||{fontStyle:"bold",fontSize:12,cellPadding:6,fillColor:220},s=e.rowCalcStyles||{fontStyle:"bold",fontSize:10,cellPadding:4,fillColor:232},l=e.jsPDF||{},u=e.title?e.title:"";l.orientation||(l.orientation=e.orientation||"landscape"),l.unit||(l.unit="pt"),t.forEach(p=>{switch(p.type){case"header":r.push(c(p));break;case"group":n.push(c(p,o));break;case"calc":n.push(c(p,s));break;case"row":n.push(c(p));break}});function c(p,m){var h=[];return p.columns.forEach(f=>{var g;if(f){switch(typeof f.value){case"object":f.value=f.value!==null?JSON.stringify(f.value):"";break;case"undefined":f.value="";break}g={content:f.value,colSpan:f.width,rowSpan:f.height},m&&(g.styles=m),h.push(g)}}),h}var d=new jspdf.jsPDF(l);e.autoTable&&(typeof e.autoTable=="function"?a=e.autoTable(d)||{}:a=e.autoTable),u&&(a.didDrawPage=function(p){d.text(u,40,30)}),a.head=r,a.body=n,d.autoTable(a),e.documentProcessing&&e.documentProcessing(d),i(d.output("arraybuffer"),"application/pdf")}function wge(t,e,i){var r=this,n=e.sheetName||"Sheet1",a=XLSX.utils.book_new(),o=new Ka(this),s="compress"in e?e.compress:!0,l=e.writeOptions||{bookType:"xlsx",bookSST:!0,compression:s},u;l.type="binary",a.SheetNames=[],a.Sheets={};function c(){var m=[],h=[],f={},g={s:{c:0,r:0},e:{c:t[0]?t[0].columns.reduce((v,y)=>v+(y&&y.width?y.width:1),0):0,r:t.length}};return t.forEach((v,y)=>{var I=[];v.columns.forEach(function(b,S){b?(I.push(!(b.value instanceof Date)&&typeof b.value=="object"?JSON.stringify(b.value):b.value),(b.width>1||b.height>-1)&&(b.height>1||b.width>1)&&h.push({s:{r:y,c:S},e:{r:y+b.height-1,c:S+b.width-1}})):I.push("")}),m.push(I)}),XLSX.utils.sheet_add_aoa(f,m),f["!ref"]=XLSX.utils.encode_range(g),h.length&&(f["!merges"]=h),f}if(e.sheetOnly){i(c());return}if(e.sheets)for(var d in e.sheets)e.sheets[d]===!0?(a.SheetNames.push(d),a.Sheets[d]=c()):(a.SheetNames.push(d),o.commsSend(e.sheets[d],"download","intercept",{type:"xlsx",options:{sheetOnly:!0},active:r.active,intercept:function(m){a.Sheets[d]=m}}));else a.SheetNames.push(n),a.Sheets[n]=c();e.documentProcessing&&(a=e.documentProcessing(a));function p(m){for(var h=new ArrayBuffer(m.length),f=new Uint8Array(h),g=0;g!=m.length;++g)f[g]=m.charCodeAt(g)&255;return h}u=XLSX.write(a,l),i(p(u),"application/octet-stream")}function Uge(t,e,i){this.modExists("export",!0)&&i(this.modules.export.generateHTMLTable(t),"text/html")}function Sge(t,e,i){const r=[];t.forEach(n=>{const a={};switch(n.type){case"header":break;case"group":console.warn("Download Warning - JSON downloader cannot process row groups");break;case"calc":console.warn("Download Warning - JSON downloader cannot process column calculations");break;case"row":n.columns.forEach(o=>{o&&(a[o.component.getTitleDownload()||o.component.getField()]=o.value)}),r.push(JSON.stringify(a));break}}),i(r.join(`
`),"application/x-ndjson")}var Tge={csv:Ige,json:yge,jsonLines:Sge,pdf:bge,xlsx:wge,html:Uge};const hf=class hf extends ci{constructor(e){super(e),this.registerTableOption("downloadEncoder",function(i,r){return new Blob([i],{type:r})}),this.registerTableOption("downloadConfig",{}),this.registerTableOption("downloadRowRange","active"),this.registerColumnOption("download"),this.registerColumnOption("titleDownload")}initialize(){this.deprecatedOptionsCheck(),this.registerTableFunction("download",this.download.bind(this)),this.registerTableFunction("downloadToTab",this.downloadToTab.bind(this))}deprecatedOptionsCheck(){}downloadToTab(e,i,r,n){this.download(e,i,r,n,!0)}download(e,i,r,n,a){var o=!1;function s(u,c){a?a===!0?this.triggerDownload(u,c,e,i,!0):a(u):this.triggerDownload(u,c,e,i)}if(typeof e=="function"?o=e:hf.downloaders[e]?o=hf.downloaders[e]:console.warn("Download Error - No such download type found: ",e),o){var l=this.generateExportList(n);o.call(this.table,l,r||{},s.bind(this))}}generateExportList(e){var i=this.table.modules.export.generateExportList(this.table.options.downloadConfig,!1,e||this.table.options.downloadRowRange,"download"),r=this.table.options.groupHeaderDownload;return r&&!Array.isArray(r)&&(r=[r]),i.forEach(n=>{var a;n.type==="group"&&(a=n.columns[0],r&&r[n.indent]&&(a.value=r[n.indent](a.value,n.component._group.getRowCount(),n.component._group.getData(),n.component)))}),i}triggerDownload(e,i,r,n,a){var o=document.createElement("a"),s=this.table.options.downloadEncoder(e,i);s&&(a?window.open(window.URL.createObjectURL(s)):(n=n||"Tabulator."+(typeof r=="function"?"txt":r),navigator.msSaveOrOpenBlob?navigator.msSaveOrOpenBlob(s,n):(o.setAttribute("href",window.URL.createObjectURL(s)),o.setAttribute("download",n),o.style.display="none",document.body.appendChild(o),o.click(),document.body.removeChild(o))),this.dispatchExternal("downloadComplete"))}commsReceived(e,i,r){switch(i){case"intercept":this.download(r.type,"",r.options,r.active,r.intercept);break}}};Ve(hf,"moduleName","download"),Ve(hf,"downloaders",Tge);let w1=hf;function YD(t,e){var i=e.mask,r=typeof e.maskLetterChar<"u"?e.maskLetterChar:"A",n=typeof e.maskNumberChar<"u"?e.maskNumberChar:"9",a=typeof e.maskWildcardChar<"u"?e.maskWildcardChar:"*";function o(s){var l=i[s];typeof l<"u"&&l!==a&&l!==r&&l!==n&&(t.value=t.value+""+l,o(s+1))}t.addEventListener("keydown",s=>{var l=t.value.length,u=s.key;if(s.keyCode>46&&!s.ctrlKey&&!s.metaKey){if(l>=i.length)return s.preventDefault(),s.stopPropagation(),!1;switch(i[l]){case r:if(u.toUpperCase()==u.toLowerCase())return s.preventDefault(),s.stopPropagation(),!1;break;case n:if(isNaN(u))return s.preventDefault(),s.stopPropagation(),!1;break;case a:break;default:if(u!==i[l])return s.preventDefault(),s.stopPropagation(),!1}}}),t.addEventListener("keyup",s=>{s.keyCode>46&&e.maskAutoFill&&o(t.value.length)}),t.placeholder||(t.placeholder=i),e.maskAutoFill&&o(t.value.length)}function Dge(t,e,i,r,n){var a=t.getValue(),o=document.createElement("input");if(o.setAttribute("type",n.search?"search":"text"),o.style.padding="4px",o.style.width="100%",o.style.boxSizing="border-box",n.elementAttributes&&typeof n.elementAttributes=="object")for(let l in n.elementAttributes)l.charAt(0)=="+"?(l=l.slice(1),o.setAttribute(l,o.getAttribute(l)+n.elementAttributes["+"+l])):o.setAttribute(l,n.elementAttributes[l]);o.value=typeof a<"u"?a:"",e(function(){t.getType()==="cell"&&(o.focus({preventScroll:!0}),o.style.height="100%",n.selectContents&&o.select())});function s(l){(a===null||typeof a>"u")&&o.value!==""||o.value!==a?i(o.value)&&(a=o.value):r()}return o.addEventListener("change",s),o.addEventListener("blur",s),o.addEventListener("keydown",function(l){switch(l.keyCode){case 13:s();break;case 27:r();break;case 35:case 36:l.stopPropagation();break}}),n.mask&&YD(o,n),o}function Pge(t,e,i,r,n){var a=t.getValue(),o=n.verticalNavigation||"hybrid",s=String(a!==null&&typeof a<"u"?a:""),l=document.createElement("textarea"),u=0;if(l.style.display="block",l.style.padding="2px",l.style.height="100%",l.style.width="100%",l.style.boxSizing="border-box",l.style.whiteSpace="pre-wrap",l.style.resize="none",n.elementAttributes&&typeof n.elementAttributes=="object")for(let d in n.elementAttributes)d.charAt(0)=="+"?(d=d.slice(1),l.setAttribute(d,l.getAttribute(d)+n.elementAttributes["+"+d])):l.setAttribute(d,n.elementAttributes[d]);l.value=s,e(function(){t.getType()==="cell"&&(l.focus({preventScroll:!0}),l.style.height="100%",l.scrollHeight,l.style.height=l.scrollHeight+"px",t.getRow().normalizeHeight(),n.selectContents&&l.select())});function c(d){(a===null||typeof a>"u")&&l.value!==""||l.value!==a?(i(l.value)&&(a=l.value),setTimeout(function(){t.getRow().normalizeHeight()},300)):r()}return l.addEventListener("change",c),l.addEventListener("blur",c),l.addEventListener("keyup",function(){l.style.height="";var d=l.scrollHeight;l.style.height=d+"px",d!=u&&(u=d,t.getRow().normalizeHeight())}),l.addEventListener("keydown",function(d){switch(d.keyCode){case 13:d.shiftKey&&n.shiftEnterSubmit&&c();break;case 27:r();break;case 38:(o=="editor"||o=="hybrid"&&l.selectionStart)&&(d.stopImmediatePropagation(),d.stopPropagation());break;case 40:(o=="editor"||o=="hybrid"&&l.selectionStart!==l.value.length)&&(d.stopImmediatePropagation(),d.stopPropagation());break;case 35:case 36:d.stopPropagation();break}}),n.mask&&YD(l,n),l}function Rge(t,e,i,r,n){var a=t.getValue(),o=n.verticalNavigation||"editor",s=document.createElement("input");if(s.setAttribute("type","number"),typeof n.max<"u"&&s.setAttribute("max",n.max),typeof n.min<"u"&&s.setAttribute("min",n.min),typeof n.step<"u"&&s.setAttribute("step",n.step),s.style.padding="4px",s.style.width="100%",s.style.boxSizing="border-box",n.elementAttributes&&typeof n.elementAttributes=="object")for(let c in n.elementAttributes)c.charAt(0)=="+"?(c=c.slice(1),s.setAttribute(c,s.getAttribute(c)+n.elementAttributes["+"+c])):s.setAttribute(c,n.elementAttributes[c]);s.value=a;var l=function(c){u()};e(function(){t.getType()==="cell"&&(s.removeEventListener("blur",l),s.focus({preventScroll:!0}),s.style.height="100%",s.addEventListener("blur",l),n.selectContents&&s.select())});function u(){var c=s.value;!isNaN(c)&&c!==""&&(c=Number(c)),c!==a?i(c)&&(a=c):r()}return s.addEventListener("keydown",function(c){switch(c.keyCode){case 13:u();break;case 27:r();break;case 38:case 40:o=="editor"&&(c.stopImmediatePropagation(),c.stopPropagation());break;case 35:case 36:c.stopPropagation();break}}),n.mask&&YD(s,n),s}function Ege(t,e,i,r,n){var a=t.getValue(),o=document.createElement("input");if(o.setAttribute("type","range"),typeof n.max<"u"&&o.setAttribute("max",n.max),typeof n.min<"u"&&o.setAttribute("min",n.min),typeof n.step<"u"&&o.setAttribute("step",n.step),o.style.padding="4px",o.style.width="100%",o.style.boxSizing="border-box",n.elementAttributes&&typeof n.elementAttributes=="object")for(let l in n.elementAttributes)l.charAt(0)=="+"?(l=l.slice(1),o.setAttribute(l,o.getAttribute(l)+n.elementAttributes["+"+l])):o.setAttribute(l,n.elementAttributes[l]);o.value=a,e(function(){t.getType()==="cell"&&(o.focus({preventScroll:!0}),o.style.height="100%")});function s(){var l=o.value;!isNaN(l)&&l!==""&&(l=Number(l)),l!=a?i(l)&&(a=l):r()}return o.addEventListener("blur",function(l){s()}),o.addEventListener("keydown",function(l){switch(l.keyCode){case 13:s();break;case 27:r();break}}),o}function Cge(t,e,i,r,n){var a=n.format,o=n.verticalNavigation||"editor",s=a?window.DateTime||luxon.DateTime:null,l=t.getValue(),u=document.createElement("input");function c(p){var m;return s.isDateTime(p)?m=p:a==="iso"?m=s.fromISO(String(p)):m=s.fromFormat(String(p),a),m.toFormat("yyyy-MM-dd")}if(u.type="date",u.style.padding="4px",u.style.width="100%",u.style.boxSizing="border-box",n.max&&u.setAttribute("max",a?c(n.max):n.max),n.min&&u.setAttribute("min",a?c(n.min):n.min),n.elementAttributes&&typeof n.elementAttributes=="object")for(let p in n.elementAttributes)p.charAt(0)=="+"?(p=p.slice(1),u.setAttribute(p,u.getAttribute(p)+n.elementAttributes["+"+p])):u.setAttribute(p,n.elementAttributes[p]);l=typeof l<"u"?l:"",a&&(s?l=c(l):console.error("Editor Error - 'date' editor 'format' param is dependant on luxon.js")),u.value=l,e(function(){t.getType()==="cell"&&(u.focus({preventScroll:!0}),u.style.height="100%",n.selectContents&&u.select())});function d(){var p=u.value,m;if((l===null||typeof l>"u")&&p!==""||p!==l){if(p&&a)switch(m=s.fromFormat(String(p),"yyyy-MM-dd"),a){case!0:p=m;break;case"iso":p=m.toISO();break;default:p=m.toFormat(a)}i(p)&&(l=u.value)}else r()}return u.addEventListener("blur",function(p){(p.relatedTarget||p.rangeParent||p.explicitOriginalTarget!==u)&&d()}),u.addEventListener("keydown",function(p){switch(p.keyCode){case 13:d();break;case 27:r();break;case 35:case 36:p.stopPropagation();break;case 38:case 40:o=="editor"&&(p.stopImmediatePropagation(),p.stopPropagation());break}}),u}function Mge(t,e,i,r,n){var a=n.format,o=n.verticalNavigation||"editor",s=a?window.DateTime||luxon.DateTime:null,l,u=t.getValue(),c=document.createElement("input");if(c.type="time",c.style.padding="4px",c.style.width="100%",c.style.boxSizing="border-box",n.elementAttributes&&typeof n.elementAttributes=="object")for(let p in n.elementAttributes)p.charAt(0)=="+"?(p=p.slice(1),c.setAttribute(p,c.getAttribute(p)+n.elementAttributes["+"+p])):c.setAttribute(p,n.elementAttributes[p]);u=typeof u<"u"?u:"",a&&(s?(s.isDateTime(u)?l=u:a==="iso"?l=s.fromISO(String(u)):l=s.fromFormat(String(u),a),u=l.toFormat("HH:mm")):console.error("Editor Error - 'date' editor 'format' param is dependant on luxon.js")),c.value=u,e(function(){t.getType()=="cell"&&(c.focus({preventScroll:!0}),c.style.height="100%",n.selectContents&&c.select())});function d(){var p=c.value,m;if((u===null||typeof u>"u")&&p!==""||p!==u){if(p&&a)switch(m=s.fromFormat(String(p),"hh:mm"),a){case!0:p=m;break;case"iso":p=m.toISO();break;default:p=m.toFormat(a)}i(p)&&(u=c.value)}else r()}return c.addEventListener("blur",function(p){(p.relatedTarget||p.rangeParent||p.explicitOriginalTarget!==c)&&d()}),c.addEventListener("keydown",function(p){switch(p.keyCode){case 13:d();break;case 27:r();break;case 35:case 36:p.stopPropagation();break;case 38:case 40:o=="editor"&&(p.stopImmediatePropagation(),p.stopPropagation());break}}),c}function Nge(t,e,i,r,n){var a=n.format,o=n.verticalNavigation||"editor",s=a?window.DateTime||luxon.DateTime:null,l,u=t.getValue(),c=document.createElement("input");if(c.type="datetime-local",c.style.padding="4px",c.style.width="100%",c.style.boxSizing="border-box",n.elementAttributes&&typeof n.elementAttributes=="object")for(let p in n.elementAttributes)p.charAt(0)=="+"?(p=p.slice(1),c.setAttribute(p,c.getAttribute(p)+n.elementAttributes["+"+p])):c.setAttribute(p,n.elementAttributes[p]);u=typeof u<"u"?u:"",a&&(s?(s.isDateTime(u)?l=u:a==="iso"?l=s.fromISO(String(u)):l=s.fromFormat(String(u),a),u=l.toFormat("yyyy-MM-dd")+"T"+l.toFormat("HH:mm")):console.error("Editor Error - 'date' editor 'format' param is dependant on luxon.js")),c.value=u,e(function(){t.getType()==="cell"&&(c.focus({preventScroll:!0}),c.style.height="100%",n.selectContents&&c.select())});function d(){var p=c.value,m;if((u===null||typeof u>"u")&&p!==""||p!==u){if(p&&a)switch(m=s.fromISO(String(p)),a){case!0:p=m;break;case"iso":p=m.toISO();break;default:p=m.toFormat(a)}i(p)&&(u=c.value)}else r()}return c.addEventListener("blur",function(p){(p.relatedTarget||p.rangeParent||p.explicitOriginalTarget!==c)&&d()}),c.addEventListener("keydown",function(p){switch(p.keyCode){case 13:d();break;case 27:r();break;case 35:case 36:p.stopPropagation();break;case 38:case 40:o=="editor"&&(p.stopImmediatePropagation(),p.stopPropagation());break}}),c}let Age=class{constructor(e,i,r,n,a,o){this.edit=e,this.table=e.table,this.cell=i,this.params=this._initializeParams(o),this.data=[],this.displayItems=[],this.currentItems=[],this.focusedItem=null,this.input=this._createInputElement(),this.listEl=this._createListElement(),this.initialValues=null,this.isFilter=i.getType()==="header",this.filterTimeout=null,this.filtered=!1,this.typing=!1,this.values=[],this.popup=null,this.listIteration=0,this.lastAction="",this.filterTerm="",this.blurable=!0,this.actions={success:n,cancel:a},this._deprecatedOptionsCheck(),this._initializeValue(),r(this._onRendered.bind(this))}_deprecatedOptionsCheck(){}_initializeValue(){var e=this.cell.getValue();typeof e>"u"&&typeof this.params.defaultValue<"u"&&(e=this.params.defaultValue),this.initialValues=this.params.multiselect?e:[e],this.isFilter&&(this.input.value=this.initialValues?this.initialValues.join(","):"",this.headerFilterInitialListGen())}_onRendered(){var e=this.cell.getElement();function i(r){r.stopPropagation()}this.isFilter||(this.input.style.height="100%",this.input.focus({preventScroll:!0})),e.addEventListener("click",i),setTimeout(()=>{e.removeEventListener("click",i)},1e3),this.input.addEventListener("mousedown",this._preventPopupBlur.bind(this))}_createListElement(){var e=document.createElement("div");return e.classList.add("tabulator-edit-list"),e.addEventListener("mousedown",this._preventBlur.bind(this)),e.addEventListener("keydown",this._inputKeyDown.bind(this)),e}_setListWidth(){var e=this.isFilter?this.input:this.cell.getElement();this.listEl.style.minWidth=e.offsetWidth+"px",this.params.maxWidth&&(this.params.maxWidth===!0?this.listEl.style.maxWidth=e.offsetWidth+"px":typeof this.params.maxWidth=="number"?this.listEl.style.maxWidth=this.params.maxWidth+"px":this.listEl.style.maxWidth=this.params.maxWidth)}_createInputElement(){var e=this.params.elementAttributes,i=document.createElement("input");if(i.setAttribute("type",this.params.clearable?"search":"text"),i.style.padding="4px",i.style.width="100%",i.style.boxSizing="border-box",this.params.autocomplete||(i.style.cursor="default",i.style.caretColor="transparent"),e&&typeof e=="object")for(let r in e)r.charAt(0)=="+"?(r=r.slice(1),i.setAttribute(r,i.getAttribute(r)+e["+"+r])):i.setAttribute(r,e[r]);return this.params.mask&&YD(i,this.params),this._bindInputEvents(i),i}_initializeParams(e){var i=["values","valuesURL","valuesLookup"],r;return e=Object.assign({},e),e.verticalNavigation=e.verticalNavigation||"editor",e.placeholderLoading=typeof e.placeholderLoading>"u"?"Searching ...":e.placeholderLoading,e.placeholderEmpty=typeof e.placeholderEmpty>"u"?"No Results Found":e.placeholderEmpty,e.filterDelay=typeof e.filterDelay>"u"?300:e.filterDelay,e.emptyValue=Object.keys(e).includes("emptyValue")?e.emptyValue:"",r=Object.keys(e).filter(n=>i.includes(n)).length,r?r>1&&console.warn("list editor config error - only one of the values, valuesURL, or valuesLookup options can be set on the same editor"):console.warn("list editor config error - either the values, valuesURL, or valuesLookup option must be set"),e.autocomplete?e.multiselect&&(e.multiselect=!1,console.warn("list editor config error - multiselect option is not available when autocomplete is enabled")):(e.freetext&&(e.freetext=!1,console.warn("list editor config error - freetext option is only available when autocomplete is enabled")),e.filterFunc&&(e.filterFunc=!1,console.warn("list editor config error - filterFunc option is only available when autocomplete is enabled")),e.filterRemote&&(e.filterRemote=!1,console.warn("list editor config error - filterRemote option is only available when autocomplete is enabled")),e.mask&&(e.mask=!1,console.warn("list editor config error - mask option is only available when autocomplete is enabled")),e.allowEmpty&&(e.allowEmpty=!1,console.warn("list editor config error - allowEmpty option is only available when autocomplete is enabled")),e.listOnEmpty&&(e.listOnEmpty=!1,console.warn("list editor config error - listOnEmpty option is only available when autocomplete is enabled"))),e.filterRemote&&!(typeof e.valuesLookup=="function"||e.valuesURL)&&(e.filterRemote=!1,console.warn("list editor config error - filterRemote option should only be used when values list is populated from a remote source")),e}_bindInputEvents(e){e.addEventListener("focus",this._inputFocus.bind(this)),e.addEventListener("click",this._inputClick.bind(this)),e.addEventListener("blur",this._inputBlur.bind(this)),e.addEventListener("keydown",this._inputKeyDown.bind(this)),e.addEventListener("search",this._inputSearch.bind(this)),this.params.autocomplete&&e.addEventListener("keyup",this._inputKeyUp.bind(this))}_inputFocus(e){this.rebuildOptionsList()}_filter(){this.params.filterRemote?(clearTimeout(this.filterTimeout),this.filterTimeout=setTimeout(()=>{this.rebuildOptionsList()},this.params.filterDelay)):this._filterList()}_inputClick(e){e.stopPropagation()}_inputBlur(e){this.blurable&&(this.popup?this.popup.hide():this._resolveValue(!0))}_inputSearch(){this._clearChoices()}_inputKeyDown(e){switch(e.keyCode){case 38:this._keyUp(e);break;case 40:this._keyDown(e);break;case 37:case 39:this._keySide(e);break;case 13:this._keyEnter();break;case 27:this._keyEsc();break;case 36:case 35:this._keyHomeEnd(e);break;case 9:this._keyTab(e);break;default:this._keySelectLetter(e)}}_inputKeyUp(e){switch(e.keyCode){case 38:case 37:case 39:case 40:case 13:case 27:break;default:this._keyAutoCompLetter(e)}}_preventPopupBlur(){this.popup&&this.popup.blockHide(),setTimeout(()=>{this.popup&&this.popup.restoreHide()},10)}_preventBlur(){this.blurable=!1,setTimeout(()=>{this.blurable=!0},10)}_keyTab(e){this.params.autocomplete&&this.lastAction==="typing"?this._resolveValue(!0):this.focusedItem&&this._chooseItem(this.focusedItem,!0)}_keyUp(e){var i=this.displayItems.indexOf(this.focusedItem);(this.params.verticalNavigation=="editor"||this.params.verticalNavigation=="hybrid"&&i)&&(e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault(),i>0&&this._focusItem(this.displayItems[i-1]))}_keyDown(e){var i=this.displayItems.indexOf(this.focusedItem);(this.params.verticalNavigation=="editor"||this.params.verticalNavigation=="hybrid"&&i<this.displayItems.length-1)&&(e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault(),i<this.displayItems.length-1&&(i==-1?this._focusItem(this.displayItems[0]):this._focusItem(this.displayItems[i+1])))}_keySide(e){this.params.autocomplete||(e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault())}_keyEnter(e){this.params.autocomplete&&this.lastAction==="typing"?this._resolveValue(!0):this.focusedItem&&this._chooseItem(this.focusedItem)}_keyEsc(e){this._cancel()}_keyHomeEnd(e){this.params.autocomplete&&e.stopImmediatePropagation()}_keySelectLetter(e){this.params.autocomplete||(e.preventDefault(),e.keyCode>=38&&e.keyCode<=90&&this._scrollToValue(e.keyCode))}_keyAutoCompLetter(e){this._filter(),this.lastAction="typing",this.typing=!0}_scrollToValue(e){clearTimeout(this.filterTimeout);var i=String.fromCharCode(e).toLowerCase();this.filterTerm+=i.toLowerCase();var r=this.displayItems.find(n=>typeof n.label<"u"&&n.label.toLowerCase().startsWith(this.filterTerm));r&&this._focusItem(r),this.filterTimeout=setTimeout(()=>{this.filterTerm=""},800)}_focusItem(e){this.lastAction="focus",this.focusedItem&&this.focusedItem.element&&this.focusedItem.element.classList.remove("focused"),this.focusedItem=e,e&&e.element&&(e.element.classList.add("focused"),e.element.scrollIntoView({behavior:"smooth",block:"nearest",inline:"start"}))}headerFilterInitialListGen(){this._generateOptions(!0)}rebuildOptionsList(){this._generateOptions().then(this._sortOptions.bind(this)).then(this._buildList.bind(this)).then(this._showList.bind(this)).catch(e=>{Number.isInteger(e)||console.error("List generation error",e)})}_filterList(){this._buildList(this._filterOptions()),this._showList()}_generateOptions(e){var i=[],r=++this.listIteration;return this.filtered=!1,this.params.values?i=this.params.values:this.params.valuesURL?i=this._ajaxRequest(this.params.valuesURL,this.input.value):typeof this.params.valuesLookup=="function"?i=this.params.valuesLookup(this.cell,this.input.value):this.params.valuesLookup&&(i=this._uniqueColumnValues(this.params.valuesLookupField)),i instanceof Promise?(e||this._addPlaceholder(this.params.placeholderLoading),i.then().then(n=>this.listIteration===r?this._parseList(n):Promise.reject(r))):Promise.resolve(this._parseList(i))}_addPlaceholder(e){var i=document.createElement("div");typeof e=="function"&&(e=e(this.cell.getComponent(),this.listEl)),e&&(this._clearList(),e instanceof HTMLElement?i=e:(i.classList.add("tabulator-edit-list-placeholder"),i.innerHTML=e),this.listEl.appendChild(i),this._showList())}_ajaxRequest(e,i){var r=this.params.filterRemote?{term:i}:{};return e=m7(e,{},r),fetch(e).then(n=>n.ok?n.json().catch(a=>(console.warn("List Ajax Load Error - Invalid JSON returned",a),Promise.reject(a))):(console.error("List Ajax Load Error - Connection Error: "+n.status,n.statusText),Promise.reject(n))).catch(n=>(console.error("List Ajax Load Error - Connection Error: ",n),Promise.reject(n)))}_uniqueColumnValues(e){var i={},r=this.table.getData(this.params.valuesLookup),n;return e?n=this.table.columnManager.getColumnByField(e):n=this.cell.getColumn()._getSelf(),n?r.forEach(a=>{var o=n.getFieldValue(a);o!==null&&typeof o<"u"&&o!==""&&(i[o]=!0)}):(console.warn("unable to find matching column to create select lookup list:",e),i=[]),Object.keys(i)}_parseList(e){var i=[];return Array.isArray(e)||(e=Object.entries(e).map(([r,n])=>({label:n,value:r}))),e.forEach(r=>{typeof r!="object"&&(r={label:r,value:r}),this._parseListItem(r,i,0)}),!this.currentItems.length&&this.params.freetext&&(this.input.value=this.initialValues,this.typing=!0,this.lastAction="typing"),this.data=i,i}_parseListItem(e,i,r){var n={};e.options?n=this._parseListGroup(e,r+1):(n={label:e.label,value:e.value,itemParams:e.itemParams,elementAttributes:e.elementAttributes,element:!1,selected:!1,visible:!0,level:r,original:e},this.initialValues&&this.initialValues.indexOf(e.value)>-1&&this._chooseItem(n,!0)),i.push(n)}_parseListGroup(e,i){var r={label:e.label,group:!0,itemParams:e.itemParams,elementAttributes:e.elementAttributes,element:!1,visible:!0,level:i,options:[],original:e};return e.options.forEach(n=>{this._parseListItem(n,r.options,i)}),r}_sortOptions(e){var i;return this.params.sort&&(i=typeof this.params.sort=="function"?this.params.sort:this._defaultSortFunction.bind(this),this._sortGroup(i,e)),e}_sortGroup(e,i){i.sort((r,n)=>e(r.label,n.label,r.value,n.value,r.original,n.original)),i.forEach(r=>{r.group&&this._sortGroup(e,r.options)})}_defaultSortFunction(e,i){var r,n,a,o,s=0,l,u=/(\d+)|(\D+)/g,c=/\d/,d=0;if(this.params.sort==="desc"&&([e,i]=[i,e]),!e&&e!==0)d=!i&&i!==0?0:-1;else if(!i&&i!==0)d=1;else{if(isFinite(e)&&isFinite(i))return e-i;if(r=String(e).toLowerCase(),n=String(i).toLowerCase(),r===n)return 0;if(!(c.test(r)&&c.test(n)))return r>n?1:-1;for(r=r.match(u),n=n.match(u),l=r.length>n.length?n.length:r.length;s<l;)if(a=r[s],o=n[s++],a!==o)return isFinite(a)&&isFinite(o)?(a.charAt(0)==="0"&&(a="."+a),o.charAt(0)==="0"&&(o="."+o),a-o):a>o?1:-1;return r.length>n.length}return d}_filterOptions(){var e=this.params.filterFunc||this._defaultFilterFunc,i=this.input.value;return i?(this.filtered=!0,this.data.forEach(r=>{this._filterItem(e,i,r)})):this.filtered=!1,this.data}_filterItem(e,i,r){var n=!1;return r.group?(r.options.forEach(a=>{this._filterItem(e,i,a)&&(n=!0)}),r.visible=n):r.visible=e(i,r.label,r.value,r.original),r.visible}_defaultFilterFunc(e,i,r,n){return e=String(e).toLowerCase(),i!==null&&typeof i<"u"&&(String(i).toLowerCase().indexOf(e)>-1||String(r).toLowerCase().indexOf(e)>-1)}_clearList(){for(;this.listEl.firstChild;)this.listEl.removeChild(this.listEl.firstChild);this.displayItems=[]}_buildList(e){this._clearList(),e.forEach(i=>{this._buildItem(i)}),this.displayItems.length||this._addPlaceholder(this.params.placeholderEmpty)}_buildItem(e){var i=e.element,r;if(!this.filtered||e.visible){if(!i){if(i=document.createElement("div"),i.tabIndex=0,r=this.params.itemFormatter?this.params.itemFormatter(e.label,e.value,e.original,i):e.label,r instanceof HTMLElement?i.appendChild(r):i.innerHTML=r,e.group?i.classList.add("tabulator-edit-list-group"):i.classList.add("tabulator-edit-list-item"),i.classList.add("tabulator-edit-list-group-level-"+e.level),e.elementAttributes&&typeof e.elementAttributes=="object")for(let n in e.elementAttributes)n.charAt(0)=="+"?(n=n.slice(1),i.setAttribute(n,this.input.getAttribute(n)+e.elementAttributes["+"+n])):i.setAttribute(n,e.elementAttributes[n]);e.group?i.addEventListener("click",this._groupClick.bind(this,e)):i.addEventListener("click",this._itemClick.bind(this,e)),i.addEventListener("mousedown",this._preventBlur.bind(this)),e.element=i}this._styleItem(e),this.listEl.appendChild(i),e.group?e.options.forEach(n=>{this._buildItem(n)}):this.displayItems.push(e)}}_showList(){var e=this.popup&&this.popup.isVisible();if(this.input.parentNode){if(this.params.autocomplete&&this.input.value===""&&!this.params.listOnEmpty){this.popup&&this.popup.hide(!0);return}this._setListWidth(),this.popup||(this.popup=this.edit.popup(this.listEl)),this.popup.show(this.cell.getElement(),"bottom"),e||setTimeout(()=>{this.popup.hideOnBlur(this._resolveValue.bind(this,!0))},10)}}_styleItem(e){e&&e.element&&(e.selected?e.element.classList.add("active"):e.element.classList.remove("active"))}_itemClick(e,i){i.stopPropagation(),this._chooseItem(e)}_groupClick(e,i){i.stopPropagation()}_cancel(){this.popup.hide(!0),this.actions.cancel()}_clearChoices(){this.typing=!0,this.currentItems.forEach(e=>{e.selected=!1,this._styleItem(e)}),this.currentItems=[],this.focusedItem=null}_chooseItem(e,i){var r;this.typing=!1,this.params.multiselect?(r=this.currentItems.indexOf(e),r>-1?(this.currentItems.splice(r,1),e.selected=!1):(this.currentItems.push(e),e.selected=!0),this.input.value=this.currentItems.map(n=>n.label).join(","),this._styleItem(e)):(this.currentItems=[e],e.selected=!0,this.input.value=e.label,this._styleItem(e),i||this._resolveValue()),this._focusItem(e)}_resolveValue(e){var i,r;if(this.popup&&this.popup.hide(!0),this.params.multiselect)i=this.currentItems.map(n=>n.value);else if(e&&this.params.autocomplete&&this.typing)if(this.params.freetext||this.params.allowEmpty&&this.input.value==="")i=this.input.value;else{this.actions.cancel();return}else this.currentItems[0]?i=this.currentItems[0].value:(r=Array.isArray(this.initialValues)?this.initialValues[0]:this.initialValues,r===null||typeof r>"u"||r===""?i=r:i=this.params.emptyValue);i===""&&(i=this.params.emptyValue),this.actions.success(i),this.isFilter&&(this.initialValues=i&&!Array.isArray(i)?[i]:i,this.currentItems=[])}};function Oge(t,e,i,r,n){var a=new Age(this,t,e,i,r,n);return a.input}function kge(t,e,i,r,n){var a=this,o=t.getElement(),s=t.getValue(),l=o.getElementsByTagName("svg").length||5,u=o.getElementsByTagName("svg")[0]?o.getElementsByTagName("svg")[0].getAttribute("width"):14,c=[],d=document.createElement("div"),p=document.createElementNS("http://www.w3.org/2000/svg","svg");function m(v){c.forEach(function(y,I){I<v?(a.table.browser=="ie"?y.setAttribute("class","tabulator-star-active"):y.classList.replace("tabulator-star-inactive","tabulator-star-active"),y.innerHTML='<polygon fill="#488CE9" stroke="#014AAE" stroke-width="37.6152" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" points="259.216,29.942 330.27,173.919 489.16,197.007 374.185,309.08 401.33,467.31 259.216,392.612 117.104,467.31 144.25,309.08 29.274,197.007 188.165,173.919 "/>'):(a.table.browser=="ie"?y.setAttribute("class","tabulator-star-inactive"):y.classList.replace("tabulator-star-active","tabulator-star-inactive"),y.innerHTML='<polygon fill="#010155" stroke="#686868" stroke-width="37.6152" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" points="259.216,29.942 330.27,173.919 489.16,197.007 374.185,309.08 401.33,467.31 259.216,392.612 117.104,467.31 144.25,309.08 29.274,197.007 188.165,173.919 "/>')})}function h(v){var y=document.createElement("span"),I=p.cloneNode(!0);c.push(I),y.addEventListener("mouseenter",function(b){b.stopPropagation(),b.stopImmediatePropagation(),m(v)}),y.addEventListener("mousemove",function(b){b.stopPropagation(),b.stopImmediatePropagation()}),y.addEventListener("click",function(b){b.stopPropagation(),b.stopImmediatePropagation(),i(v),o.blur()}),y.appendChild(I),d.appendChild(y)}function f(v){s=v,m(v)}if(o.style.whiteSpace="nowrap",o.style.overflow="hidden",o.style.textOverflow="ellipsis",d.style.verticalAlign="middle",d.style.display="inline-block",d.style.padding="4px",p.setAttribute("width",u),p.setAttribute("height",u),p.setAttribute("viewBox","0 0 512 512"),p.setAttribute("xml:space","preserve"),p.style.padding="0 1px",n.elementAttributes&&typeof n.elementAttributes=="object")for(let v in n.elementAttributes)v.charAt(0)=="+"?(v=v.slice(1),d.setAttribute(v,d.getAttribute(v)+n.elementAttributes["+"+v])):d.setAttribute(v,n.elementAttributes[v]);for(var g=1;g<=l;g++)h(g);return s=Math.min(parseInt(s),l),m(s),d.addEventListener("mousemove",function(v){m(0)}),d.addEventListener("click",function(v){i(0)}),o.addEventListener("blur",function(v){r()}),o.addEventListener("keydown",function(v){switch(v.keyCode){case 39:f(s+1);break;case 37:f(s-1);break;case 13:i(s);break;case 27:r();break}}),d}function xge(t,e,i,r,n){var a=t.getElement(),o=typeof n.max>"u"?a.getElementsByTagName("div")[0]&&a.getElementsByTagName("div")[0].getAttribute("max")||100:n.max,s=typeof n.min>"u"?a.getElementsByTagName("div")[0]&&a.getElementsByTagName("div")[0].getAttribute("min")||0:n.min,l=(o-s)/100,u=t.getValue()||0,c=document.createElement("div"),d=document.createElement("div"),p,m;function h(){var f=window.getComputedStyle(a,null),g=l*Math.round(d.offsetWidth/((a.clientWidth-parseInt(f.getPropertyValue("padding-left"))-parseInt(f.getPropertyValue("padding-right")))/100))+s;i(g),a.setAttribute("aria-valuenow",g),a.setAttribute("aria-label",u)}if(c.style.position="absolute",c.style.right="0",c.style.top="0",c.style.bottom="0",c.style.width="5px",c.classList.add("tabulator-progress-handle"),d.style.display="inline-block",d.style.position="relative",d.style.height="100%",d.style.backgroundColor="#488CE9",d.style.maxWidth="100%",d.style.minWidth="0%",n.elementAttributes&&typeof n.elementAttributes=="object")for(let f in n.elementAttributes)f.charAt(0)=="+"?(f=f.slice(1),d.setAttribute(f,d.getAttribute(f)+n.elementAttributes["+"+f])):d.setAttribute(f,n.elementAttributes[f]);return a.style.padding="4px 4px",u=Math.min(parseFloat(u),o),u=Math.max(parseFloat(u),s),u=Math.round((u-s)/l),d.style.width=u+"%",a.setAttribute("aria-valuemin",s),a.setAttribute("aria-valuemax",o),d.appendChild(c),c.addEventListener("mousedown",function(f){p=f.screenX,m=d.offsetWidth}),c.addEventListener("mouseover",function(){c.style.cursor="ew-resize"}),a.addEventListener("mousemove",function(f){p&&(d.style.width=m+f.screenX-p+"px")}),a.addEventListener("mouseup",function(f){p&&(f.stopPropagation(),f.stopImmediatePropagation(),p=!1,m=!1,h())}),a.addEventListener("keydown",function(f){switch(f.keyCode){case 39:f.preventDefault(),d.style.width=d.clientWidth+a.clientWidth/100+"px";break;case 37:f.preventDefault(),d.style.width=d.clientWidth-a.clientWidth/100+"px";break;case 9:case 13:h();break;case 27:r();break}}),a.addEventListener("blur",function(){r()}),d}function Fge(t,e,i,r,n){var a=t.getValue(),o=document.createElement("input"),s=n.tristate,l=typeof n.indeterminateValue>"u"?null:n.indeterminateValue,u=!1,c=Object.keys(n).includes("trueValue"),d=Object.keys(n).includes("falseValue");if(o.setAttribute("type","checkbox"),o.style.marginTop="5px",o.style.boxSizing="border-box",n.elementAttributes&&typeof n.elementAttributes=="object")for(let m in n.elementAttributes)m.charAt(0)=="+"?(m=m.slice(1),o.setAttribute(m,o.getAttribute(m)+n.elementAttributes["+"+m])):o.setAttribute(m,n.elementAttributes[m]);o.value=a,s&&(typeof a>"u"||a===l||a==="")&&(u=!0,o.indeterminate=!0),this.table.browser!="firefox"&&this.table.browser!="safari"&&e(function(){t.getType()==="cell"&&o.focus({preventScroll:!0})}),o.checked=c?a===n.trueValue:a===!0||a==="true"||a==="True"||a===1;function p(m){var h=o.checked;return c&&h?h=n.trueValue:d&&!h&&(h=n.falseValue),s?m?u?l:h:o.checked&&!u?(o.checked=!1,o.indeterminate=!0,u=!0,l):(u=!1,h):h}return o.addEventListener("change",function(m){i(p())}),o.addEventListener("blur",function(m){i(p(!0))}),o.addEventListener("keydown",function(m){m.keyCode==13&&i(p()),m.keyCode==27&&r()}),o}var Lge={input:Dge,textarea:Pge,number:Rge,range:Ege,date:Cge,time:Mge,datetime:Nge,list:Oge,star:kge,progress:xge,tickCross:Fge};const mI=class mI extends ci{constructor(e){super(e),this.currentCell=!1,this.mouseClick=!1,this.recursionBlock=!1,this.invalidEdit=!1,this.editedCells=[],this.convertEmptyValues=!1,this.editors=mI.editors,this.registerTableOption("editTriggerEvent","focus"),this.registerTableOption("editorEmptyValue"),this.registerTableOption("editorEmptyValueFunc",this.emptyValueCheck.bind(this)),this.registerColumnOption("editable"),this.registerColumnOption("editor"),this.registerColumnOption("editorParams"),this.registerColumnOption("editorEmptyValue"),this.registerColumnOption("editorEmptyValueFunc"),this.registerColumnOption("cellEditing"),this.registerColumnOption("cellEdited"),this.registerColumnOption("cellEditCancelled"),this.registerTableFunction("getEditedCells",this.getEditedCells.bind(this)),this.registerTableFunction("clearCellEdited",this.clearCellEdited.bind(this)),this.registerTableFunction("navigatePrev",this.navigatePrev.bind(this)),this.registerTableFunction("navigateNext",this.navigateNext.bind(this)),this.registerTableFunction("navigateLeft",this.navigateLeft.bind(this)),this.registerTableFunction("navigateRight",this.navigateRight.bind(this)),this.registerTableFunction("navigateUp",this.navigateUp.bind(this)),this.registerTableFunction("navigateDown",this.navigateDown.bind(this)),this.registerComponentFunction("cell","isEdited",this.cellIsEdited.bind(this)),this.registerComponentFunction("cell","clearEdited",this.clearEdited.bind(this)),this.registerComponentFunction("cell","edit",this.editCell.bind(this)),this.registerComponentFunction("cell","cancelEdit",this.cellCancelEdit.bind(this)),this.registerComponentFunction("cell","navigatePrev",this.navigatePrev.bind(this)),this.registerComponentFunction("cell","navigateNext",this.navigateNext.bind(this)),this.registerComponentFunction("cell","navigateLeft",this.navigateLeft.bind(this)),this.registerComponentFunction("cell","navigateRight",this.navigateRight.bind(this)),this.registerComponentFunction("cell","navigateUp",this.navigateUp.bind(this)),this.registerComponentFunction("cell","navigateDown",this.navigateDown.bind(this))}initialize(){this.subscribe("cell-init",this.bindEditor.bind(this)),this.subscribe("cell-delete",this.clearEdited.bind(this)),this.subscribe("cell-value-changed",this.updateCellClass.bind(this)),this.subscribe("column-layout",this.initializeColumnCheck.bind(this)),this.subscribe("column-delete",this.columnDeleteCheck.bind(this)),this.subscribe("row-deleting",this.rowDeleteCheck.bind(this)),this.subscribe("row-layout",this.rowEditableCheck.bind(this)),this.subscribe("data-refreshing",this.cancelEdit.bind(this)),this.subscribe("clipboard-paste",this.pasteBlocker.bind(this)),this.subscribe("keybinding-nav-prev",this.navigatePrev.bind(this,void 0)),this.subscribe("keybinding-nav-next",this.keybindingNavigateNext.bind(this)),this.subscribe("keybinding-nav-up",this.navigateUp.bind(this,void 0)),this.subscribe("keybinding-nav-down",this.navigateDown.bind(this,void 0)),Object.keys(this.table.options).includes("editorEmptyValue")&&(this.convertEmptyValues=!0)}pasteBlocker(e){if(this.currentCell)return!0}keybindingNavigateNext(e){var i=this.currentCell,r=this.options("tabEndNewRow");i&&(this.navigateNext(i,e)||r&&(i.getElement().firstChild.blur(),this.invalidEdit||(r===!0?r=this.table.addRow({}):typeof r=="function"?r=this.table.addRow(r(i.row.getComponent())):r=this.table.addRow(Object.assign({},r)),r.then(()=>{setTimeout(()=>{i.getComponent().navigateNext()})}))))}cellIsEdited(e){return!!e.modules.edit&&e.modules.edit.edited}cellCancelEdit(e){e===this.currentCell?this.table.modules.edit.cancelEdit():console.warn("Cancel Editor Error - This cell is not currently being edited ")}updateCellClass(e){this.allowEdit(e)?e.getElement().classList.add("tabulator-editable"):e.getElement().classList.remove("tabulator-editable")}clearCellEdited(e){e||(e=this.table.modules.edit.getEditedCells()),Array.isArray(e)||(e=[e]),e.forEach(i=>{this.table.modules.edit.clearEdited(i._getSelf())})}navigatePrev(e=this.currentCell,i){var r,n;if(e){if(i&&i.preventDefault(),r=this.navigateLeft(),r)return!0;if(n=this.table.rowManager.prevDisplayRow(e.row,!0),n&&(r=this.findPrevEditableCell(n,n.cells.length),r))return r.getComponent().edit(),!0}return!1}navigateNext(e=this.currentCell,i){var r,n;if(e){if(i&&i.preventDefault(),r=this.navigateRight(),r)return!0;if(n=this.table.rowManager.nextDisplayRow(e.row,!0),n&&(r=this.findNextEditableCell(n,-1),r))return r.getComponent().edit(),!0}return!1}navigateLeft(e=this.currentCell,i){var r,n;return e&&(i&&i.preventDefault(),r=e.getIndex(),n=this.findPrevEditableCell(e.row,r),n)?(n.getComponent().edit(),!0):!1}navigateRight(e=this.currentCell,i){var r,n;return e&&(i&&i.preventDefault(),r=e.getIndex(),n=this.findNextEditableCell(e.row,r),n)?(n.getComponent().edit(),!0):!1}navigateUp(e=this.currentCell,i){var r,n;return e&&(i&&i.preventDefault(),r=e.getIndex(),n=this.table.rowManager.prevDisplayRow(e.row,!0),n)?(n.cells[r].getComponent().edit(),!0):!1}navigateDown(e=this.currentCell,i){var r,n;return e&&(i&&i.preventDefault(),r=e.getIndex(),n=this.table.rowManager.nextDisplayRow(e.row,!0),n)?(n.cells[r].getComponent().edit(),!0):!1}findNextEditableCell(e,i){var r=!1;if(i<e.cells.length-1)for(var n=i+1;n<e.cells.length;n++){let a=e.cells[n];if(a.column.modules.edit&&xr.elVisible(a.getElement())&&this.allowEdit(a)){r=a;break}}return r}findPrevEditableCell(e,i){var r=!1;if(i>0)for(var n=i-1;n>=0;n--){let a=e.cells[n];if(a.column.modules.edit&&xr.elVisible(a.getElement())&&this.allowEdit(a)){r=a;break}}return r}initializeColumnCheck(e){typeof e.definition.editor<"u"&&this.initializeColumn(e)}columnDeleteCheck(e){this.currentCell&&this.currentCell.column===e&&this.cancelEdit()}rowDeleteCheck(e){this.currentCell&&this.currentCell.row===e&&this.cancelEdit()}rowEditableCheck(e){e.getCells().forEach(i=>{i.column.modules.edit&&typeof i.column.modules.edit.check=="function"&&this.updateCellClass(i)})}initializeColumn(e){var i=Object.keys(e.definition).includes("editorEmptyValue"),r={editor:!1,blocked:!1,check:e.definition.editable,params:e.definition.editorParams||{},convertEmptyValues:i,editorEmptyValue:e.definition.editorEmptyValue,editorEmptyValueFunc:e.definition.editorEmptyValueFunc};switch(typeof e.definition.editor){case"string":this.editors[e.definition.editor]?r.editor=this.editors[e.definition.editor]:console.warn("Editor Error - No such editor found: ",e.definition.editor);break;case"function":r.editor=e.definition.editor;break;case"boolean":e.definition.editor===!0&&(typeof e.definition.formatter!="function"?this.editors[e.definition.formatter]?r.editor=this.editors[e.definition.formatter]:r.editor=this.editors.input:console.warn("Editor Error - Cannot auto lookup editor for a custom formatter: ",e.definition.formatter));break}r.editor&&(e.modules.edit=r)}getCurrentCell(){return this.currentCell?this.currentCell.getComponent():!1}clearEditor(e){var i=this.currentCell,r;if(this.invalidEdit=!1,i){for(this.currentCell=!1,r=i.getElement(),this.dispatch("edit-editor-clear",i,e),r.classList.remove("tabulator-editing");r.firstChild;)r.removeChild(r.firstChild);i.row.getElement().classList.remove("tabulator-editing"),i.table.element.classList.remove("tabulator-editing")}}cancelEdit(){if(this.currentCell){var e=this.currentCell,i=this.currentCell.getComponent();this.clearEditor(!0),e.setValueActual(e.getValue()),e.cellRendered(),(e.column.definition.editor=="textarea"||e.column.definition.variableHeight)&&e.row.normalizeHeight(!0),e.column.definition.cellEditCancelled&&e.column.definition.cellEditCancelled.call(this.table,i),this.dispatch("edit-cancelled",e),this.dispatchExternal("cellEditCancelled",i)}}bindEditor(e){if(e.column.modules.edit){var i=this,r=e.getElement(!0);this.updateCellClass(e),r.setAttribute("tabindex",0),r.addEventListener("mousedown",function(n){n.button===2?n.preventDefault():i.mouseClick=!0}),this.options("editTriggerEvent")==="dblclick"&&r.addEventListener("dblclick",function(n){r.classList.contains("tabulator-editing")||(r.focus({preventScroll:!0}),i.edit(e,n,!1))}),(this.options("editTriggerEvent")==="focus"||this.options("editTriggerEvent")==="click")&&r.addEventListener("click",function(n){r.classList.contains("tabulator-editing")||(r.focus({preventScroll:!0}),i.edit(e,n,!1))}),this.options("editTriggerEvent")==="focus"&&r.addEventListener("focus",function(n){i.recursionBlock||i.edit(e,n,!1)})}}focusCellNoEvent(e,i){this.recursionBlock=!0,i&&this.table.browser==="ie"||e.getElement().focus({preventScroll:!0}),this.recursionBlock=!1}editCell(e,i){this.focusCellNoEvent(e),this.edit(e,!1,i)}focusScrollAdjust(e){if(this.table.rowManager.getRenderMode()=="virtual"){var i=this.table.rowManager.element.scrollTop,r=this.table.rowManager.element.clientHeight+this.table.rowManager.element.scrollTop,n=e.row.getElement();n.offsetTop<i?this.table.rowManager.element.scrollTop-=i-n.offsetTop:n.offsetTop+n.offsetHeight>r&&(this.table.rowManager.element.scrollTop+=n.offsetTop+n.offsetHeight-r);var a=this.table.rowManager.element.scrollLeft,o=this.table.rowManager.element.clientWidth+this.table.rowManager.element.scrollLeft,s=e.getElement();this.table.modExists("frozenColumns")&&(a+=parseInt(this.table.modules.frozenColumns.leftMargin||0),o-=parseInt(this.table.modules.frozenColumns.rightMargin||0)),this.table.options.renderHorizontal==="virtual"&&(a-=parseInt(this.table.columnManager.renderer.vDomPadLeft),o-=parseInt(this.table.columnManager.renderer.vDomPadLeft)),s.offsetLeft<a?this.table.rowManager.element.scrollLeft-=a-s.offsetLeft:s.offsetLeft+s.offsetWidth>o&&(this.table.rowManager.element.scrollLeft+=s.offsetLeft+s.offsetWidth-o)}}allowEdit(e){var i=!!e.column.modules.edit;if(e.column.modules.edit)switch(typeof e.column.modules.edit.check){case"function":e.row.initialized&&(i=e.column.modules.edit.check(e.getComponent()));break;case"string":i=!!e.row.data[e.column.modules.edit.check];break;case"boolean":i=e.column.modules.edit.check;break}return i}edit(e,i,r){var n=this,a=!0,o=function(){},s=e.getElement(),l=!1,u,c,d;if(this.currentCell){!this.invalidEdit&&this.currentCell!==e&&this.cancelEdit();return}function p(v){if(n.currentCell===e&&!l){var y=n.chain("edit-success",[e,v],!0,!0);return y===!0||n.table.options.validationMode==="highlight"?(l=!0,n.clearEditor(),e.modules.edit||(e.modules.edit={}),e.modules.edit.edited=!0,n.editedCells.indexOf(e)==-1&&n.editedCells.push(e),v=n.transformEmptyValues(v,e),e.setValue(v,!0),y===!0):(l=!0,n.invalidEdit=!0,n.focusCellNoEvent(e,!0),o(),setTimeout(()=>{l=!1},10),!1)}}function m(){n.currentCell===e&&!l&&n.cancelEdit()}function h(v){o=v}if(e.column.modules.edit.blocked)return this.mouseClick=!1,this.blur(s),!1;if(i&&i.stopPropagation(),a=this.allowEdit(e),a||r){if(n.cancelEdit(),n.currentCell=e,this.focusScrollAdjust(e),c=e.getComponent(),this.mouseClick&&(this.mouseClick=!1,e.column.definition.cellClick&&e.column.definition.cellClick.call(this.table,i,c)),e.column.definition.cellEditing&&e.column.definition.cellEditing.call(this.table,c),this.dispatch("cell-editing",e),this.dispatchExternal("cellEditing",c),d=typeof e.column.modules.edit.params=="function"?e.column.modules.edit.params(c):e.column.modules.edit.params,u=e.column.modules.edit.editor.call(n,c,h,p,m,d),this.currentCell&&u!==!1)if(u instanceof Node){for(s.classList.add("tabulator-editing"),e.row.getElement().classList.add("tabulator-editing"),e.table.element.classList.add("tabulator-editing");s.firstChild;)s.removeChild(s.firstChild);s.appendChild(u),o();for(var f=s.children,g=0;g<f.length;g++)f[g].addEventListener("click",function(v){v.stopPropagation()})}else return console.warn("Edit Error - Editor should return an instance of Node, the editor returned:",u),this.blur(s),!1;else return this.blur(s),!1;return!0}else return this.mouseClick=!1,this.blur(s),!1}emptyValueCheck(e){return e===""||e===null||typeof e>"u"}transformEmptyValues(e,i){var r=i.column.modules.edit,n=r.convertEmptyValues||this.convertEmptyValues,a;return n&&(a=r.editorEmptyValueFunc||this.options("editorEmptyValueFunc"),a&&a(e)&&(e=r.convertEmptyValues?r.editorEmptyValue:this.options("editorEmptyValue"))),e}blur(e){this.confirm("edit-blur",[e])||e.blur()}getEditedCells(){var e=[];return this.editedCells.forEach(i=>{e.push(i.getComponent())}),e}clearEdited(e){var i;e.modules.edit&&e.modules.edit.edited&&(e.modules.edit.edited=!1,this.dispatch("edit-edited-clear",e)),i=this.editedCells.indexOf(e),i>-1&&this.editedCells.splice(i,1)}};Ve(mI,"moduleName","edit"),Ve(mI,"editors",Lge);let U1=mI;class LV{constructor(e,i,r,n){this.type=e,this.columns=i,this.component=r||!1,this.indent=n||0}}class EE{constructor(e,i,r,n,a){this.value=e,this.component=i||!1,this.width=r,this.height=n,this.depth=a}}var _ge={},$ge={visible:function(){return this.rowManager.getVisibleRows(!1,!0)},all:function(){return this.rowManager.rows},selected:function(){return this.modules.selectRow.selectedRows},active:function(){return this.options.pagination?this.rowManager.getDisplayRows(this.rowManager.displayRows.length-2):this.rowManager.getDisplayRows()}};const yd=class yd extends ci{constructor(e){super(e),this.config={},this.cloneTableStyle=!0,this.colVisProp="",this.colVisPropAttach="",this.registerTableOption("htmlOutputConfig",!1),this.registerColumnOption("htmlOutput"),this.registerColumnOption("titleHtmlOutput")}initialize(){this.registerTableFunction("getHtml",this.getHtml.bind(this))}generateExportList(e,i,r,n){var a,o,s,l;return this.cloneTableStyle=i,this.config=e||{},this.colVisProp=n,this.colVisPropAttach=this.colVisProp.charAt(0).toUpperCase()+this.colVisProp.slice(1),l=yd.columnLookups[r],l&&(s=l.call(this.table),s=s.filter(u=>this.columnVisCheck(u))),a=this.config.columnHeaders!==!1?this.headersToExportRows(this.generateColumnGroupHeaders(s)):[],s&&(s=s.map(u=>u.getComponent())),o=this.bodyToExportRows(this.rowLookup(r),s),a.concat(o)}generateTable(e,i,r,n){var a=this.generateExportList(e,i,r,n);return this.generateTableElement(a)}rowLookup(e){var i=[],r;return typeof e=="function"?e.call(this.table).forEach(n=>{n=this.table.rowManager.findRow(n),n&&i.push(n)}):(r=yd.rowLookups[e]||yd.rowLookups.active,i=r.call(this.table)),Object.assign([],i)}generateColumnGroupHeaders(e){var i=[];return e||(e=this.config.columnGroups!==!1?this.table.columnManager.columns:this.table.columnManager.columnsByIndex),e.forEach(r=>{var n=this.processColumnGroup(r);n&&i.push(n)}),i}processColumnGroup(e){var i=e.columns,r=0,n=e.definition["title"+this.colVisPropAttach]||e.definition.title,a={title:n,column:e,depth:1};if(i.length){if(a.subGroups=[],a.width=0,i.forEach(o=>{var s=this.processColumnGroup(o);s&&(a.width+=s.width,a.subGroups.push(s),s.depth>r&&(r=s.depth))}),a.depth+=r,!a.width)return!1}else if(this.columnVisCheck(e))a.width=1;else return!1;return a}columnVisCheck(e){var i=e.definition[this.colVisProp];return this.config.rowHeaders===!1&&e.isRowHeader?!1:(typeof i=="function"&&(i=i.call(this.table,e.getComponent())),i===!1||i===!0?i:e.visible&&e.field)}headersToExportRows(e){var i=[],r=0,n=[];function a(o,s){var l=r-s;if(typeof i[s]>"u"&&(i[s]=[]),o.height=o.subGroups?1:l-o.depth+1,i[s].push(o),o.height>1)for(let u=1;u<o.height;u++)typeof i[s+u]>"u"&&(i[s+u]=[]),i[s+u].push(!1);if(o.width>1)for(let u=1;u<o.width;u++)i[s].push(!1);o.subGroups&&o.subGroups.forEach(function(u){a(u,s+1)})}return e.forEach(function(o){o.depth>r&&(r=o.depth)}),e.forEach(function(o){a(o,0)}),i.forEach(o=>{var s=[];o.forEach(l=>{if(l){let u=typeof l.title>"u"?"":l.title;s.push(new EE(u,l.column.getComponent(),l.width,l.height,l.depth))}else s.push(null)}),n.push(new LV("header",s))}),n}bodyToExportRows(e,i=[]){var r=[];return i.length===0&&this.table.columnManager.columnsByIndex.forEach(n=>{this.columnVisCheck(n)&&i.push(n.getComponent())}),this.config.columnCalcs!==!1&&this.table.modExists("columnCalcs")&&(this.table.modules.columnCalcs.topInitialized&&e.unshift(this.table.modules.columnCalcs.topRow),this.table.modules.columnCalcs.botInitialized&&e.push(this.table.modules.columnCalcs.botRow)),e=e.filter(n=>{switch(n.type){case"group":return this.config.rowGroups!==!1;case"calc":return this.config.columnCalcs!==!1;case"row":return!(this.table.options.dataTree&&this.config.dataTree===!1&&n.modules.dataTree.parent)}return!0}),e.forEach((n,a)=>{var o=n.getData(this.colVisProp),s=[],l=0;switch(n.type){case"group":l=n.level,s.push(new EE(n.key,n.getComponent(),i.length,1));break;case"calc":case"row":i.forEach(u=>{s.push(new EE(u._column.getFieldValue(o),u,1,1))}),this.table.options.dataTree&&this.config.dataTree!==!1&&(l=n.modules.dataTree.index);break}r.push(new LV(n.type,s,n.getComponent(),l))}),r}generateTableElement(e){var i=document.createElement("table"),r=document.createElement("thead"),n=document.createElement("tbody"),a=this.lookupTableStyles(),o=this.table.options["rowFormatter"+this.colVisPropAttach],s={};return s.rowFormatter=o!==null?o:this.table.options.rowFormatter,this.table.options.dataTree&&this.config.dataTree!==!1&&this.table.modExists("columnCalcs")&&(s.treeElementField=this.table.modules.dataTree.elementField),s.groupHeader=this.table.options["groupHeader"+this.colVisPropAttach],s.groupHeader&&!Array.isArray(s.groupHeader)&&(s.groupHeader=[s.groupHeader]),i.classList.add("tabulator-print-table"),this.mapElementStyles(this.table.columnManager.getHeadersElement(),r,["border-top","border-left","border-right","border-bottom","background-color","color","font-weight","font-family","font-size"]),e.length>1e3&&console.warn("It may take a long time to render an HTML table with more than 1000 rows"),e.forEach((l,u)=>{let c;switch(l.type){case"header":r.appendChild(this.generateHeaderElement(l,s,a));break;case"group":n.appendChild(this.generateGroupElement(l,s,a));break;case"calc":n.appendChild(this.generateCalcElement(l,s,a));break;case"row":c=this.generateRowElement(l,s,a),this.mapElementStyles(u%2&&a.evenRow?a.evenRow:a.oddRow,c,["border-top","border-left","border-right","border-bottom","color","font-weight","font-family","font-size","background-color"]),n.appendChild(c);break}}),r.innerHTML&&i.appendChild(r),i.appendChild(n),this.mapElementStyles(this.table.element,i,["border-top","border-left","border-right","border-bottom"]),i}lookupTableStyles(){var e={};return this.cloneTableStyle&&window.getComputedStyle&&(e.oddRow=this.table.element.querySelector(".tabulator-row-odd:not(.tabulator-group):not(.tabulator-calcs)"),e.evenRow=this.table.element.querySelector(".tabulator-row-even:not(.tabulator-group):not(.tabulator-calcs)"),e.calcRow=this.table.element.querySelector(".tabulator-row.tabulator-calcs"),e.firstRow=this.table.element.querySelector(".tabulator-row:not(.tabulator-group):not(.tabulator-calcs)"),e.firstGroup=this.table.element.getElementsByClassName("tabulator-group")[0],e.firstRow&&(e.styleCells=e.firstRow.getElementsByClassName("tabulator-cell"),e.styleRowHeader=e.firstRow.getElementsByClassName("tabulator-row-header")[0],e.firstCell=e.styleCells[0],e.lastCell=e.styleCells[e.styleCells.length-1])),e}generateHeaderElement(e,i,r){var n=document.createElement("tr");return e.columns.forEach(a=>{if(a){var o=document.createElement("th"),s=a.component._column.definition.cssClass?a.component._column.definition.cssClass.split(" "):[];o.colSpan=a.width,o.rowSpan=a.height,o.innerHTML=a.value,this.cloneTableStyle&&(o.style.boxSizing="border-box"),s.forEach(function(l){o.classList.add(l)}),this.mapElementStyles(a.component.getElement(),o,["text-align","border-left","border-right","background-color","color","font-weight","font-family","font-size"]),this.mapElementStyles(a.component._column.contentElement,o,["padding-top","padding-left","padding-right","padding-bottom"]),a.component._column.visible?this.mapElementStyles(a.component.getElement(),o,["width"]):a.component._column.definition.width&&(o.style.width=a.component._column.definition.width+"px"),a.component._column.parent&&a.component._column.parent.isGroup?this.mapElementStyles(a.component._column.parent.groupElement,o,["border-top"]):this.mapElementStyles(a.component.getElement(),o,["border-top"]),a.component._column.isGroup?this.mapElementStyles(a.component.getElement(),o,["border-bottom"]):this.mapElementStyles(this.table.columnManager.getElement(),o,["border-bottom"]),n.appendChild(o)}}),n}generateGroupElement(e,i,r){var n=document.createElement("tr"),a=document.createElement("td"),o=e.columns[0];return n.classList.add("tabulator-print-table-row"),i.groupHeader&&i.groupHeader[e.indent]?o.value=i.groupHeader[e.indent](o.value,e.component._group.getRowCount(),e.component._group.getData(),e.component):i.groupHeader!==!1&&(o.value=e.component._group.generator(o.value,e.component._group.getRowCount(),e.component._group.getData(),e.component)),a.colSpan=o.width,a.innerHTML=o.value,n.classList.add("tabulator-print-table-group"),n.classList.add("tabulator-group-level-"+e.indent),o.component.isVisible()&&n.classList.add("tabulator-group-visible"),this.mapElementStyles(r.firstGroup,n,["border-top","border-left","border-right","border-bottom","color","font-weight","font-family","font-size","background-color"]),this.mapElementStyles(r.firstGroup,a,["padding-top","padding-left","padding-right","padding-bottom"]),n.appendChild(a),n}generateCalcElement(e,i,r){var n=this.generateRowElement(e,i,r);return n.classList.add("tabulator-print-table-calcs"),this.mapElementStyles(r.calcRow,n,["border-top","border-left","border-right","border-bottom","color","font-weight","font-family","font-size","background-color"]),n}generateRowElement(e,i,r){var n=document.createElement("tr");if(n.classList.add("tabulator-print-table-row"),e.columns.forEach((a,o)=>{if(a){var s=document.createElement("td"),l=a.component._column,u=this.table,c=u.columnManager.findColumnIndex(l),d=a.value,p,m,h={modules:{},getValue:function(){return d},getField:function(){return l.definition.field},getElement:function(){return s},getType:function(){return"cell"},getColumn:function(){return l.getComponent()},getData:function(){return e.component.getData()},getRow:function(){return e.component},getTable:function(){return u},getComponent:function(){return h},column:l},f=l.definition.cssClass?l.definition.cssClass.split(" "):[];if(f.forEach(function(g){s.classList.add(g)}),this.table.modExists("format")&&this.config.formatCells!==!1)d=this.table.modules.format.formatExportValue(h,this.colVisProp);else switch(typeof d){case"object":d=d!==null?JSON.stringify(d):"";break;case"undefined":d="";break}d instanceof Node?s.appendChild(d):s.innerHTML=d,m=["padding-top","padding-left","padding-right","padding-bottom","border-top","border-left","border-right","border-bottom","color","font-weight","font-family","font-size","text-align"],l.isRowHeader?(p=r.styleRowHeader,m.push("background-color")):p=r.styleCells&&r.styleCells[c]?r.styleCells[c]:r.firstCell,p&&(this.mapElementStyles(p,s,m),l.definition.align&&(s.style.textAlign=l.definition.align)),this.table.options.dataTree&&this.config.dataTree!==!1&&(i.treeElementField&&i.treeElementField==l.field||!i.treeElementField&&o==0)&&(e.component._row.modules.dataTree.controlEl&&s.insertBefore(e.component._row.modules.dataTree.controlEl.cloneNode(!0),s.firstChild),e.component._row.modules.dataTree.branchEl&&s.insertBefore(e.component._row.modules.dataTree.branchEl.cloneNode(!0),s.firstChild)),n.appendChild(s),h.modules.format&&h.modules.format.renderedCallback&&h.modules.format.renderedCallback()}}),i.rowFormatter&&e.type==="row"&&this.config.formatCells!==!1){let a=Object.assign(e.component);a.getElement=function(){return n},i.rowFormatter(e.component)}return n}generateHTMLTable(e){var i=document.createElement("div");return i.appendChild(this.generateTableElement(e)),i.innerHTML}getHtml(e,i,r,n){var a=this.generateExportList(r||this.table.options.htmlOutputConfig,i,e,n||"htmlOutput");return this.generateHTMLTable(a)}mapElementStyles(e,i,r){if(this.cloneTableStyle&&e&&i){var n={"background-color":"backgroundColor",color:"fontColor",width:"width","font-weight":"fontWeight","font-family":"fontFamily","font-size":"fontSize","text-align":"textAlign","border-top":"borderTop","border-left":"borderLeft","border-right":"borderRight","border-bottom":"borderBottom","padding-top":"paddingTop","padding-left":"paddingLeft","padding-right":"paddingRight","padding-bottom":"paddingBottom"};if(window.getComputedStyle){var a=window.getComputedStyle(e);r.forEach(function(o){i.style[n[o]]||(i.style[n[o]]=a.getPropertyValue(o))})}}}};Ve(yd,"moduleName","export"),Ve(yd,"columnLookups",_ge),Ve(yd,"rowLookups",$ge);let S1=yd;var Bge={"=":function(t,e,i,r){return e==t},"<":function(t,e,i,r){return e<t},"<=":function(t,e,i,r){return e<=t},">":function(t,e,i,r){return e>t},">=":function(t,e,i,r){return e>=t},"!=":function(t,e,i,r){return e!=t},regex:function(t,e,i,r){return typeof t=="string"&&(t=new RegExp(t)),t.test(e)},like:function(t,e,i,r){return t===null||typeof t>"u"?e===t:typeof e<"u"&&e!==null?String(e).toLowerCase().indexOf(t.toLowerCase())>-1:!1},keywords:function(t,e,i,r){var n=t.toLowerCase().split(typeof r.separator>"u"?" ":r.separator),a=String(e===null||typeof e>"u"?"":e).toLowerCase(),o=[];return n.forEach(s=>{a.includes(s)&&o.push(!0)}),r.matchAll?o.length===n.length:!!o.length},starts:function(t,e,i,r){return t===null||typeof t>"u"?e===t:typeof e<"u"&&e!==null?String(e).toLowerCase().startsWith(t.toLowerCase()):!1},ends:function(t,e,i,r){return t===null||typeof t>"u"?e===t:typeof e<"u"&&e!==null?String(e).toLowerCase().endsWith(t.toLowerCase()):!1},in:function(t,e,i,r){return Array.isArray(t)?t.length?t.indexOf(e)>-1:!0:(console.warn("Filter Error - filter value is not an array:",t),!1)}};const pc=class pc extends ci{constructor(e){super(e),this.filterList=[],this.headerFilters={},this.headerFilterColumns=[],this.prevHeaderFilterChangeCheck="",this.prevHeaderFilterChangeCheck="{}",this.changed=!1,this.tableInitialized=!1,this.registerTableOption("filterMode","local"),this.registerTableOption("initialFilter",!1),this.registerTableOption("initialHeaderFilter",!1),this.registerTableOption("headerFilterLiveFilterDelay",300),this.registerTableOption("placeholderHeaderFilter",!1),this.registerColumnOption("headerFilter"),this.registerColumnOption("headerFilterPlaceholder"),this.registerColumnOption("headerFilterParams"),this.registerColumnOption("headerFilterEmptyCheck"),this.registerColumnOption("headerFilterFunc"),this.registerColumnOption("headerFilterFuncParams"),this.registerColumnOption("headerFilterLiveFilter"),this.registerTableFunction("searchRows",this.searchRows.bind(this)),this.registerTableFunction("searchData",this.searchData.bind(this)),this.registerTableFunction("setFilter",this.userSetFilter.bind(this)),this.registerTableFunction("refreshFilter",this.userRefreshFilter.bind(this)),this.registerTableFunction("addFilter",this.userAddFilter.bind(this)),this.registerTableFunction("getFilters",this.getFilters.bind(this)),this.registerTableFunction("setHeaderFilterFocus",this.userSetHeaderFilterFocus.bind(this)),this.registerTableFunction("getHeaderFilterValue",this.userGetHeaderFilterValue.bind(this)),this.registerTableFunction("setHeaderFilterValue",this.userSetHeaderFilterValue.bind(this)),this.registerTableFunction("getHeaderFilters",this.getHeaderFilters.bind(this)),this.registerTableFunction("removeFilter",this.userRemoveFilter.bind(this)),this.registerTableFunction("clearFilter",this.userClearFilter.bind(this)),this.registerTableFunction("clearHeaderFilter",this.userClearHeaderFilter.bind(this)),this.registerComponentFunction("column","headerFilterFocus",this.setHeaderFilterFocus.bind(this)),this.registerComponentFunction("column","reloadHeaderFilter",this.reloadHeaderFilter.bind(this)),this.registerComponentFunction("column","getHeaderFilterValue",this.getHeaderFilterValue.bind(this)),this.registerComponentFunction("column","setHeaderFilterValue",this.setHeaderFilterValue.bind(this))}initialize(){this.subscribe("column-init",this.initializeColumnHeaderFilter.bind(this)),this.subscribe("column-width-fit-before",this.hideHeaderFilterElements.bind(this)),this.subscribe("column-width-fit-after",this.showHeaderFilterElements.bind(this)),this.subscribe("table-built",this.tableBuilt.bind(this)),this.subscribe("placeholder",this.generatePlaceholder.bind(this)),this.table.options.filterMode==="remote"&&this.subscribe("data-params",this.remoteFilterParams.bind(this)),this.registerDataHandler(this.filter.bind(this),10)}tableBuilt(){this.table.options.initialFilter&&this.setFilter(this.table.options.initialFilter),this.table.options.initialHeaderFilter&&this.table.options.initialHeaderFilter.forEach(e=>{var i=this.table.columnManager.findColumn(e.field);if(i)this.setHeaderFilterValue(i,e.value);else return console.warn("Column Filter Error - No matching column found:",e.field),!1}),this.tableInitialized=!0}remoteFilterParams(e,i,r,n){return n.filter=this.getFilters(!0,!0),n}generatePlaceholder(e){if(this.table.options.placeholderHeaderFilter&&Object.keys(this.headerFilters).length)return this.table.options.placeholderHeaderFilter}userSetFilter(e,i,r,n){this.setFilter(e,i,r,n),this.refreshFilter()}userRefreshFilter(){this.refreshFilter()}userAddFilter(e,i,r,n){this.addFilter(e,i,r,n),this.refreshFilter()}userSetHeaderFilterFocus(e){var i=this.table.columnManager.findColumn(e);if(i)this.setHeaderFilterFocus(i);else return console.warn("Column Filter Focus Error - No matching column found:",e),!1}userGetHeaderFilterValue(e){var i=this.table.columnManager.findColumn(e);if(i)return this.getHeaderFilterValue(i);console.warn("Column Filter Error - No matching column found:",e)}userSetHeaderFilterValue(e,i){var r=this.table.columnManager.findColumn(e);if(r)this.setHeaderFilterValue(r,i);else return console.warn("Column Filter Error - No matching column found:",e),!1}userRemoveFilter(e,i,r){this.removeFilter(e,i,r),this.refreshFilter()}userClearFilter(e){this.clearFilter(e),this.refreshFilter()}userClearHeaderFilter(){this.clearHeaderFilter(),this.refreshFilter()}searchRows(e,i,r){return this.search("rows",e,i,r)}searchData(e,i,r){return this.search("data",e,i,r)}initializeColumnHeaderFilter(e){var i=e.definition;i.headerFilter&&this.initializeColumn(e)}initializeColumn(e,i){var r=this,n=e.getField();function a(o){var s=e.modules.filter.tagType=="input"&&e.modules.filter.attrType=="text"||e.modules.filter.tagType=="textarea"?"partial":"match",l="",u="",c;if(typeof e.modules.filter.prevSuccess>"u"||e.modules.filter.prevSuccess!==o){if(e.modules.filter.prevSuccess=o,e.modules.filter.emptyFunc(o))delete r.headerFilters[n];else{switch(e.modules.filter.value=o,typeof e.definition.headerFilterFunc){case"string":pc.filters[e.definition.headerFilterFunc]?(l=e.definition.headerFilterFunc,c=function(d){var p=e.definition.headerFilterFuncParams||{},m=e.getFieldValue(d);return p=typeof p=="function"?p(o,m,d):p,pc.filters[e.definition.headerFilterFunc](o,m,d,p)}):console.warn("Header Filter Error - Matching filter function not found: ",e.definition.headerFilterFunc);break;case"function":c=function(d){var p=e.definition.headerFilterFuncParams||{},m=e.getFieldValue(d);return p=typeof p=="function"?p(o,m,d):p,e.definition.headerFilterFunc(o,m,d,p)},l=c;break}if(!c)switch(s){case"partial":c=function(d){var p=e.getFieldValue(d);return typeof p<"u"&&p!==null?String(p).toLowerCase().indexOf(String(o).toLowerCase())>-1:!1},l="like";break;default:c=function(d){return e.getFieldValue(d)==o},l="="}r.headerFilters[n]={value:o,func:c,type:l}}e.modules.filter.value=o,u=JSON.stringify(r.headerFilters),r.prevHeaderFilterChangeCheck!==u&&(r.prevHeaderFilterChangeCheck=u,r.trackChanges(),r.refreshFilter())}return!0}e.modules.filter={success:a,attrType:!1,tagType:!1,emptyFunc:!1},this.generateHeaderFilterElement(e)}generateHeaderFilterElement(e,i,r){var n=this,a=e.modules.filter.success,o=e.getField(),s,l,u,c,d,p,m,h;e.modules.filter.value=i;function f(){}function g(v){h=v}if(e.modules.filter.headerElement&&e.modules.filter.headerElement.parentNode&&e.contentElement.removeChild(e.modules.filter.headerElement.parentNode),o){switch(e.modules.filter.emptyFunc=e.definition.headerFilterEmptyCheck||function(v){return!v&&v!==0},s=document.createElement("div"),s.classList.add("tabulator-header-filter"),typeof e.definition.headerFilter){case"string":n.table.modules.edit.editors[e.definition.headerFilter]?(l=n.table.modules.edit.editors[e.definition.headerFilter],(e.definition.headerFilter==="tick"||e.definition.headerFilter==="tickCross")&&!e.definition.headerFilterEmptyCheck&&(e.modules.filter.emptyFunc=function(v){return v!==!0&&v!==!1})):console.warn("Filter Error - Cannot build header filter, No such editor found: ",e.definition.editor);break;case"function":l=e.definition.headerFilter;break;case"boolean":e.modules.edit&&e.modules.edit.editor?l=e.modules.edit.editor:e.definition.formatter&&n.table.modules.edit.editors[e.definition.formatter]?(l=n.table.modules.edit.editors[e.definition.formatter],(e.definition.formatter==="tick"||e.definition.formatter==="tickCross")&&!e.definition.headerFilterEmptyCheck&&(e.modules.filter.emptyFunc=function(v){return v!==!0&&v!==!1})):l=n.table.modules.edit.editors.input;break}if(l){if(c={getValue:function(){return typeof i<"u"?i:""},getField:function(){return e.definition.field},getElement:function(){return s},getColumn:function(){return e.getComponent()},getTable:()=>this.table,getType:()=>"header",getRow:function(){return{normalizeHeight:function(){}}}},m=e.definition.headerFilterParams||{},m=typeof m=="function"?m.call(n.table,c):m,u=l.call(this.table.modules.edit,c,g,a,f,m),!u){console.warn("Filter Error - Cannot add filter to "+o+" column, editor returned a value of false");return}if(!(u instanceof Node)){console.warn("Filter Error - Cannot add filter to "+o+" column, editor should return an instance of Node, the editor returned:",u);return}n.langBind("headerFilters|columns|"+e.definition.field,function(v){u.setAttribute("placeholder",typeof v<"u"&&v?v:e.definition.headerFilterPlaceholder||n.langText("headerFilters|default"))}),u.addEventListener("click",function(v){v.stopPropagation(),u.focus()}),u.addEventListener("focus",v=>{var y=this.table.columnManager.contentsElement.scrollLeft,I=this.table.rowManager.element.scrollLeft;y!==I&&(this.table.rowManager.scrollHorizontal(y),this.table.columnManager.scrollHorizontal(y))}),d=!1,p=function(v){d&&clearTimeout(d),d=setTimeout(function(){a(u.value)},n.table.options.headerFilterLiveFilterDelay)},e.modules.filter.headerElement=u,e.modules.filter.attrType=u.hasAttribute("type")?u.getAttribute("type").toLowerCase():"",e.modules.filter.tagType=u.tagName.toLowerCase(),e.definition.headerFilterLiveFilter!==!1&&(e.definition.headerFilter==="autocomplete"||e.definition.headerFilter==="tickCross"||(e.definition.editor==="autocomplete"||e.definition.editor==="tickCross")&&e.definition.headerFilter===!0||(u.addEventListener("keyup",p),u.addEventListener("search",p),e.modules.filter.attrType=="number"&&u.addEventListener("change",function(v){a(u.value)}),e.modules.filter.attrType=="text"&&this.table.browser!=="ie"&&u.setAttribute("type","search")),(e.modules.filter.tagType=="input"||e.modules.filter.tagType=="select"||e.modules.filter.tagType=="textarea")&&u.addEventListener("mousedown",function(v){v.stopPropagation()})),s.appendChild(u),e.contentElement.appendChild(s),r||n.headerFilterColumns.push(e),h&&h()}}else console.warn("Filter Error - Cannot add header filter, column has no field set:",e.definition.title)}hideHeaderFilterElements(){this.headerFilterColumns.forEach(function(e){e.modules.filter&&e.modules.filter.headerElement&&(e.modules.filter.headerElement.style.display="none")})}showHeaderFilterElements(){this.headerFilterColumns.forEach(function(e){e.modules.filter&&e.modules.filter.headerElement&&(e.modules.filter.headerElement.style.display="")})}setHeaderFilterFocus(e){e.modules.filter&&e.modules.filter.headerElement?e.modules.filter.headerElement.focus():console.warn("Column Filter Focus Error - No header filter set on column:",e.getField())}getHeaderFilterValue(e){if(e.modules.filter&&e.modules.filter.headerElement)return e.modules.filter.value;console.warn("Column Filter Error - No header filter set on column:",e.getField())}setHeaderFilterValue(e,i){e&&(e.modules.filter&&e.modules.filter.headerElement?(this.generateHeaderFilterElement(e,i,!0),e.modules.filter.success(i)):console.warn("Column Filter Error - No header filter set on column:",e.getField()))}reloadHeaderFilter(e){e&&(e.modules.filter&&e.modules.filter.headerElement?this.generateHeaderFilterElement(e,e.modules.filter.value,!0):console.warn("Column Filter Error - No header filter set on column:",e.getField()))}refreshFilter(){this.tableInitialized&&(this.table.options.filterMode==="remote"?this.reloadData(null,!1,!1):this.refreshData(!0))}trackChanges(){this.changed=!0,this.dispatch("filter-changed")}hasChanged(){var e=this.changed;return this.changed=!1,e}setFilter(e,i,r,n){this.filterList=[],Array.isArray(e)||(e=[{field:e,type:i,value:r,params:n}]),this.addFilter(e)}addFilter(e,i,r,n){var a=!1;Array.isArray(e)||(e=[{field:e,type:i,value:r,params:n}]),e.forEach(o=>{o=this.findFilter(o),o&&(this.filterList.push(o),a=!0)}),a&&this.trackChanges()}findFilter(e){var i;if(Array.isArray(e))return this.findSubFilters(e);var r=!1;return typeof e.field=="function"?r=function(n){return e.field(n,e.type||{})}:pc.filters[e.type]?(i=this.table.columnManager.getColumnByField(e.field),i?r=function(n){return pc.filters[e.type](e.value,i.getFieldValue(n),n,e.params||{})}:r=function(n){return pc.filters[e.type](e.value,n[e.field],n,e.params||{})}):console.warn("Filter Error - No such filter type found, ignoring: ",e.type),e.func=r,e.func?e:!1}findSubFilters(e){var i=[];return e.forEach(r=>{r=this.findFilter(r),r&&i.push(r)}),i.length?i:!1}getFilters(e,i){var r=[];return e&&(r=this.getHeaderFilters()),i&&r.forEach(function(n){typeof n.type=="function"&&(n.type="function")}),r=r.concat(this.filtersToArray(this.filterList,i)),r}filtersToArray(e,i){var r=[];return e.forEach(n=>{var a;Array.isArray(n)?r.push(this.filtersToArray(n,i)):(a={field:n.field,type:n.type,value:n.value},i&&typeof a.type=="function"&&(a.type="function"),r.push(a))}),r}getHeaderFilters(){var e=[];for(var i in this.headerFilters)e.push({field:i,type:this.headerFilters[i].type,value:this.headerFilters[i].value});return e}removeFilter(e,i,r){Array.isArray(e)||(e=[{field:e,type:i,value:r}]),e.forEach(n=>{var a=-1;typeof n.field=="object"?a=this.filterList.findIndex(o=>n===o):a=this.filterList.findIndex(o=>n.field===o.field&&n.type===o.type&&n.value===o.value),a>-1?this.filterList.splice(a,1):console.warn("Filter Error - No matching filter type found, ignoring: ",n.type)}),this.trackChanges()}clearFilter(e){this.filterList=[],e&&this.clearHeaderFilter(),this.trackChanges()}clearHeaderFilter(){this.headerFilters={},this.prevHeaderFilterChangeCheck="{}",this.headerFilterColumns.forEach(e=>{typeof e.modules.filter.value<"u"&&delete e.modules.filter.value,e.modules.filter.prevSuccess=void 0,this.reloadHeaderFilter(e)}),this.trackChanges()}search(e,i,r,n){var a=[],o=[];return Array.isArray(i)||(i=[{field:i,type:r,value:n}]),i.forEach(s=>{s=this.findFilter(s),s&&o.push(s)}),this.table.rowManager.rows.forEach(s=>{var l=!0;o.forEach(u=>{this.filterRecurse(u,s.getData())||(l=!1)}),l&&a.push(e==="data"?s.getData("data"):s.getComponent())}),a}filter(e,i){var r=[],n=[];return this.subscribedExternal("dataFiltering")&&this.dispatchExternal("dataFiltering",this.getFilters(!0)),this.table.options.filterMode!=="remote"&&(this.filterList.length||Object.keys(this.headerFilters).length)?e.forEach(a=>{this.filterRow(a)&&r.push(a)}):r=e.slice(0),this.subscribedExternal("dataFiltered")&&(r.forEach(a=>{n.push(a.getComponent())}),this.dispatchExternal("dataFiltered",this.getFilters(!0),n)),r}filterRow(e,i){var r=!0,n=e.getData();this.filterList.forEach(o=>{this.filterRecurse(o,n)||(r=!1)});for(var a in this.headerFilters)this.headerFilters[a].func(n)||(r=!1);return r}filterRecurse(e,i){var r=!1;return Array.isArray(e)?e.forEach(n=>{this.filterRecurse(n,i)&&(r=!0)}):r=e.func(i),r}};Ve(pc,"moduleName","filter"),Ve(pc,"filters",Bge);let T1=pc;function Vge(t,e,i){return this.emptyToSpace(this.sanitizeHTML(t.getValue()))}function jge(t,e,i){return t.getValue()}function Gge(t,e,i){return t.getElement().style.whiteSpace="pre-wrap",this.emptyToSpace(this.sanitizeHTML(t.getValue()))}function Hge(t,e,i){var r=parseFloat(t.getValue()),n="",a,o,s,l,u,c=e.decimal||".",d=e.thousand||",",p=e.negativeSign||"-",m=e.symbol||"",h=!!e.symbolAfter,f=typeof e.precision<"u"?e.precision:2;if(isNaN(r))return this.emptyToSpace(this.sanitizeHTML(t.getValue()));if(r<0&&(r=Math.abs(r),n=p),a=f!==!1?r.toFixed(f):r,a=String(a).split("."),o=a[0],s=a.length>1?c+a[1]:"",e.thousand!==!1)for(l=/(\d+)(\d{3})/;l.test(o);)o=o.replace(l,"$1"+d+"$2");return u=o+s,n===!0?(u="("+u+")",h?u+m:m+u):h?n+u+m:n+m+u}function zge(t,e,i){var r=t.getValue(),n=e.urlPrefix||"",a=e.download,o=r,s=document.createElement("a"),l;function u(c,d){var p=c.shift(),m=d[p];return c.length&&typeof m=="object"?u(c,m):m}if(e.labelField&&(l=t.getData(),o=u(e.labelField.split(this.table.options.nestedFieldSeparator),l)),e.label)switch(typeof e.label){case"string":o=e.label;break;case"function":o=e.label(t);break}if(o){if(e.urlField&&(l=t.getData(),r=xr.retrieveNestedData(this.table.options.nestedFieldSeparator,e.urlField,l)),e.url)switch(typeof e.url){case"string":r=e.url;break;case"function":r=e.url(t);break}return s.setAttribute("href",n+r),e.target&&s.setAttribute("target",e.target),e.download&&(typeof a=="function"?a=a(t):a=a===!0?"":a,s.setAttribute("download",a)),s.innerHTML=this.emptyToSpace(this.sanitizeHTML(o)),s}else return"&nbsp;"}function Wge(t,e,i){var r=document.createElement("img"),n=t.getValue();switch(e.urlPrefix&&(n=e.urlPrefix+t.getValue()),e.urlSuffix&&(n=n+e.urlSuffix),r.setAttribute("src",n),typeof e.height){case"number":r.style.height=e.height+"px";break;case"string":r.style.height=e.height;break}switch(typeof e.width){case"number":r.style.width=e.width+"px";break;case"string":r.style.width=e.width;break}return r.addEventListener("load",function(){t.getRow().normalizeHeight()}),r}function qge(t,e,i){var r=t.getValue(),n=t.getElement(),a=e.allowEmpty,o=e.allowTruthy,s=Object.keys(e).includes("trueValue"),l=typeof e.tickElement<"u"?e.tickElement:'<svg enable-background="new 0 0 24 24" height="14" width="14" viewBox="0 0 24 24" xml:space="preserve" ><path fill="#2DC214" clip-rule="evenodd" d="M21.652,3.211c-0.293-0.295-0.77-0.295-1.061,0L9.41,14.34  c-0.293,0.297-0.771,0.297-1.062,0L3.449,9.351C3.304,9.203,3.114,9.13,2.923,9.129C2.73,9.128,2.534,9.201,2.387,9.351  l-2.165,1.946C0.078,11.445,0,11.63,0,11.823c0,0.194,0.078,0.397,0.223,0.544l4.94,5.184c0.292,0.296,0.771,0.776,1.062,1.07  l2.124,2.141c0.292,0.293,0.769,0.293,1.062,0l14.366-14.34c0.293-0.294,0.293-0.777,0-1.071L21.652,3.211z" fill-rule="evenodd"/></svg>',u=typeof e.crossElement<"u"?e.crossElement:'<svg enable-background="new 0 0 24 24" height="14" width="14"  viewBox="0 0 24 24" xml:space="preserve" ><path fill="#CE1515" d="M22.245,4.015c0.313,0.313,0.313,0.826,0,1.139l-6.276,6.27c-0.313,0.312-0.313,0.826,0,1.14l6.273,6.272  c0.313,0.313,0.313,0.826,0,1.14l-2.285,2.277c-0.314,0.312-0.828,0.312-1.142,0l-6.271-6.271c-0.313-0.313-0.828-0.313-1.141,0  l-6.276,6.267c-0.313,0.313-0.828,0.313-1.141,0l-2.282-2.28c-0.313-0.313-0.313-0.826,0-1.14l6.278-6.269  c0.313-0.312,0.313-0.826,0-1.14L1.709,5.147c-0.314-0.313-0.314-0.827,0-1.14l2.284-2.278C4.308,1.417,4.821,1.417,5.135,1.73  L11.405,8c0.314,0.314,0.828,0.314,1.141,0.001l6.276-6.267c0.312-0.312,0.826-0.312,1.141,0L22.245,4.015z"/></svg>';return s&&r===e.trueValue||!s&&(o&&r||r===!0||r==="true"||r==="True"||r===1||r==="1")?(n.setAttribute("aria-checked",!0),l||""):a&&(r==="null"||r===""||r===null||typeof r>"u")?(n.setAttribute("aria-checked","mixed"),""):(n.setAttribute("aria-checked",!1),u||"")}function Yge(t,e,i){var r=window.DateTime||luxon.DateTime,n=e.inputFormat||"yyyy-MM-dd HH:mm:ss",a=e.outputFormat||"dd/MM/yyyy HH:mm:ss",o=typeof e.invalidPlaceholder<"u"?e.invalidPlaceholder:"",s=t.getValue();if(typeof r<"u"){var l;return r.isDateTime(s)?l=s:n==="iso"?l=r.fromISO(String(s)):l=r.fromFormat(String(s),n),l.isValid?(e.timezone&&(l=l.setZone(e.timezone)),l.toFormat(a)):o===!0||!s?s:typeof o=="function"?o(s):o}else console.error("Format Error - 'datetime' formatter is dependant on luxon.js")}function Kge(t,e,i){var r=window.DateTime||luxon.DateTime,n=e.inputFormat||"yyyy-MM-dd HH:mm:ss",a=typeof e.invalidPlaceholder<"u"?e.invalidPlaceholder:"",o=typeof e.suffix<"u"?e.suffix:!1,s=typeof e.unit<"u"?e.unit:"days",l=typeof e.humanize<"u"?e.humanize:!1,u=typeof e.date<"u"?e.date:r.now(),c=t.getValue();if(typeof r<"u"){var d;return r.isDateTime(c)?d=c:n==="iso"?d=r.fromISO(String(c)):d=r.fromFormat(String(c),n),d.isValid?l?d.diff(u,s).toHuman()+(o?" "+o:""):parseInt(d.diff(u,s)[s])+(o?" "+o:""):a===!0?c:typeof a=="function"?a(c):a}else console.error("Format Error - 'datetimediff' formatter is dependant on luxon.js")}function Xge(t,e,i){var r=t.getValue();return typeof e[r]>"u"?(console.warn("Missing display value for "+r),r):e[r]}function Jge(t,e,i){var r=t.getValue(),n=t.getElement(),a=e&&e.stars?e.stars:5,o=document.createElement("span"),s=document.createElementNS("http://www.w3.org/2000/svg","svg"),l='<polygon fill="#FFEA00" stroke="#C1AB60" stroke-width="37.6152" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" points="259.216,29.942 330.27,173.919 489.16,197.007 374.185,309.08 401.33,467.31 259.216,392.612 117.104,467.31 144.25,309.08 29.274,197.007 188.165,173.919 "/>',u='<polygon fill="#D2D2D2" stroke="#686868" stroke-width="37.6152" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" points="259.216,29.942 330.27,173.919 489.16,197.007 374.185,309.08 401.33,467.31 259.216,392.612 117.104,467.31 144.25,309.08 29.274,197.007 188.165,173.919 "/>';o.style.verticalAlign="middle",s.setAttribute("width","14"),s.setAttribute("height","14"),s.setAttribute("viewBox","0 0 512 512"),s.setAttribute("xml:space","preserve"),s.style.padding="0 1px",r=r&&!isNaN(r)?parseInt(r):0,r=Math.max(0,Math.min(r,a));for(var c=1;c<=a;c++){var d=s.cloneNode(!0);d.innerHTML=c<=r?l:u,o.appendChild(d)}return n.style.whiteSpace="nowrap",n.style.overflow="hidden",n.style.textOverflow="ellipsis",n.setAttribute("aria-label",r),o}function Qge(t,e,i){var r=this.sanitizeHTML(t.getValue())||0,n=document.createElement("span"),a=e&&e.max?e.max:100,o=e&&e.min?e.min:0,s=e&&typeof e.color<"u"?e.color:["red","orange","green"],l="#666666",u,c;if(!(isNaN(r)||typeof t.getValue()>"u")){switch(n.classList.add("tabulator-traffic-light"),c=parseFloat(r)<=a?parseFloat(r):a,c=parseFloat(c)>=o?parseFloat(c):o,u=(a-o)/100,c=Math.round((c-o)/u),typeof s){case"string":l=s;break;case"function":l=s(r);break;case"object":if(Array.isArray(s)){var d=100/s.length,p=Math.floor(c/d);p=Math.min(p,s.length-1),p=Math.max(p,0),l=s[p];break}}return n.style.backgroundColor=l,n}}function Zge(t,e={},i){var r=this.sanitizeHTML(t.getValue())||0,n=t.getElement(),a=e.max?e.max:100,o=e.min?e.min:0,s=e.legendAlign?e.legendAlign:"center",l,u,c,d,p;switch(u=parseFloat(r)<=a?parseFloat(r):a,u=parseFloat(u)>=o?parseFloat(u):o,l=(a-o)/100,u=Math.round((u-o)/l),typeof e.color){case"string":c=e.color;break;case"function":c=e.color(r);break;case"object":if(Array.isArray(e.color)){let g=100/e.color.length,v=Math.floor(u/g);v=Math.min(v,e.color.length-1),v=Math.max(v,0),c=e.color[v];break}default:c="#2DC214"}switch(typeof e.legend){case"string":d=e.legend;break;case"function":d=e.legend(r);break;case"boolean":d=r;break;default:d=!1}switch(typeof e.legendColor){case"string":p=e.legendColor;break;case"function":p=e.legendColor(r);break;case"object":if(Array.isArray(e.legendColor)){let g=100/e.legendColor.length,v=Math.floor(u/g);v=Math.min(v,e.legendColor.length-1),v=Math.max(v,0),p=e.legendColor[v]}break;default:p="#000"}n.style.minWidth="30px",n.style.position="relative",n.setAttribute("aria-label",u);var m=document.createElement("div");m.style.display="inline-block",m.style.width=u+"%",m.style.backgroundColor=c,m.style.height="100%",m.setAttribute("data-max",a),m.setAttribute("data-min",o);var h=document.createElement("div");if(h.style.position="relative",h.style.width="100%",h.style.height="100%",d){var f=document.createElement("div");f.style.position="absolute",f.style.top=0,f.style.left=0,f.style.textAlign=s,f.style.width="100%",f.style.color=p,f.innerHTML=d}return i(function(){if(!(t instanceof h7)){var g=document.createElement("div");g.style.position="absolute",g.style.top="4px",g.style.bottom="4px",g.style.left="4px",g.style.right="4px",n.appendChild(g),n=g}n.appendChild(h),h.appendChild(m),d&&h.appendChild(f)}),""}function eve(t,e,i){return t.getElement().style.backgroundColor=this.sanitizeHTML(t.getValue()),""}function tve(t,e,i){return'<svg enable-background="new 0 0 24 24" height="14" width="14" viewBox="0 0 24 24" xml:space="preserve" ><path fill="#2DC214" clip-rule="evenodd" d="M21.652,3.211c-0.293-0.295-0.77-0.295-1.061,0L9.41,14.34  c-0.293,0.297-0.771,0.297-1.062,0L3.449,9.351C3.304,9.203,3.114,9.13,2.923,9.129C2.73,9.128,2.534,9.201,2.387,9.351  l-2.165,1.946C0.078,11.445,0,11.63,0,11.823c0,0.194,0.078,0.397,0.223,0.544l4.94,5.184c0.292,0.296,0.771,0.776,1.062,1.07  l2.124,2.141c0.292,0.293,0.769,0.293,1.062,0l14.366-14.34c0.293-0.294,0.293-0.777,0-1.071L21.652,3.211z" fill-rule="evenodd"/></svg>'}function ive(t,e,i){return'<svg enable-background="new 0 0 24 24" height="14" width="14" viewBox="0 0 24 24" xml:space="preserve" ><path fill="#CE1515" d="M22.245,4.015c0.313,0.313,0.313,0.826,0,1.139l-6.276,6.27c-0.313,0.312-0.313,0.826,0,1.14l6.273,6.272  c0.313,0.313,0.313,0.826,0,1.14l-2.285,2.277c-0.314,0.312-0.828,0.312-1.142,0l-6.271-6.271c-0.313-0.313-0.828-0.313-1.141,0  l-6.276,6.267c-0.313,0.313-0.828,0.313-1.141,0l-2.282-2.28c-0.313-0.313-0.313-0.826,0-1.14l6.278-6.269  c0.313-0.312,0.313-0.826,0-1.14L1.709,5.147c-0.314-0.313-0.314-0.827,0-1.14l2.284-2.278C4.308,1.417,4.821,1.417,5.135,1.73  L11.405,8c0.314,0.314,0.828,0.314,1.141,0.001l6.276-6.267c0.312-0.312,0.826-0.312,1.141,0L22.245,4.015z"/></svg>'}function rve(t,e,i){var r=t.getValue(),n=e.size||15,a=n+"px",o,s,l=e.hasOwnProperty("onValue")?e.onValue:!0,u=e.hasOwnProperty("offValue")?e.offValue:!1,c=e.onTruthy?r:r===l;return o=document.createElement("div"),o.classList.add("tabulator-toggle"),c?(o.classList.add("tabulator-toggle-on"),o.style.flexDirection="row-reverse",e.onColor&&(o.style.background=e.onColor)):e.offColor&&(o.style.background=e.offColor),o.style.width=2.5*n+"px",o.style.borderRadius=a,e.clickable&&o.addEventListener("click",d=>{t.setValue(c?u:l)}),s=document.createElement("div"),s.classList.add("tabulator-toggle-switch"),s.style.height=a,s.style.width=a,s.style.borderRadius=a,o.appendChild(s),o}function nve(t,e,i){var r=document.createElement("span"),n=t.getRow(),a=t.getTable();return n.watchPosition(o=>{e.relativeToPage&&(o+=a.modules.page.getPageSize()*(a.modules.page.getPage()-1)),r.innerText=o}),r}function ave(t,e,i){return t.getElement().classList.add("tabulator-row-handle"),"<div class='tabulator-row-handle-box'><div class='tabulator-row-handle-bar'></div><div class='tabulator-row-handle-bar'></div><div class='tabulator-row-handle-bar'></div></div>"}var ove={plaintext:Vge,html:jge,textarea:Gge,money:Hge,link:zge,image:Wge,tickCross:qge,datetime:Yge,datetimediff:Kge,lookup:Xge,star:Jge,traffic:Qge,progress:Zge,color:eve,buttonTick:tve,buttonCross:ive,toggle:rve,rownum:nve,handle:ave};const Ls=class Ls extends ci{constructor(e){super(e),this.registerColumnOption("formatter"),this.registerColumnOption("formatterParams"),this.registerColumnOption("formatterPrint"),this.registerColumnOption("formatterPrintParams"),this.registerColumnOption("formatterClipboard"),this.registerColumnOption("formatterClipboardParams"),this.registerColumnOption("formatterHtmlOutput"),this.registerColumnOption("formatterHtmlOutputParams"),this.registerColumnOption("titleFormatter"),this.registerColumnOption("titleFormatterParams")}initialize(){this.subscribe("cell-format",this.formatValue.bind(this)),this.subscribe("cell-rendered",this.cellRendered.bind(this)),this.subscribe("column-layout",this.initializeColumn.bind(this)),this.subscribe("column-format",this.formatHeader.bind(this))}initializeColumn(e){e.modules.format=this.lookupFormatter(e,""),typeof e.definition.formatterPrint<"u"&&(e.modules.format.print=this.lookupFormatter(e,"Print")),typeof e.definition.formatterClipboard<"u"&&(e.modules.format.clipboard=this.lookupFormatter(e,"Clipboard")),typeof e.definition.formatterHtmlOutput<"u"&&(e.modules.format.htmlOutput=this.lookupFormatter(e,"HtmlOutput"))}lookupFormatter(e,i){var r={params:e.definition["formatter"+i+"Params"]||{}},n=e.definition["formatter"+i];switch(typeof n){case"string":Ls.formatters[n]?r.formatter=Ls.formatters[n]:(console.warn("Formatter Error - No such formatter found: ",n),r.formatter=Ls.formatters.plaintext);break;case"function":r.formatter=n;break;default:r.formatter=Ls.formatters.plaintext;break}return r}cellRendered(e){e.modules.format&&e.modules.format.renderedCallback&&!e.modules.format.rendered&&(e.modules.format.renderedCallback(),e.modules.format.rendered=!0)}formatHeader(e,i,r){var n,a,o,s;return e.definition.titleFormatter?(n=this.getFormatter(e.definition.titleFormatter),o=l=>{e.titleFormatterRendered=l},s={getValue:function(){return i},getElement:function(){return r},getType:function(){return"header"},getColumn:function(){return e.getComponent()},getTable:()=>this.table},a=e.definition.titleFormatterParams||{},a=typeof a=="function"?a():a,n.call(this,s,a,o)):i}formatValue(e){var i=e.getComponent(),r=typeof e.column.modules.format.params=="function"?e.column.modules.format.params(i):e.column.modules.format.params;function n(a){e.modules.format||(e.modules.format={}),e.modules.format.renderedCallback=a,e.modules.format.rendered=!1}return e.column.modules.format.formatter.call(this,i,r,n)}formatExportValue(e,i){var r=e.column.modules.format[i],n;if(r){let a=function(o){e.modules.format||(e.modules.format={}),e.modules.format.renderedCallback=o,e.modules.format.rendered=!1};return n=typeof r.params=="function"?r.params(e.getComponent()):r.params,r.formatter.call(this,e.getComponent(),n,a)}else return this.formatValue(e)}sanitizeHTML(e){if(e){var i={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};return String(e).replace(/[&<>"'`=/]/g,function(r){return i[r]})}else return e}emptyToSpace(e){return e===null||typeof e>"u"||e===""?"&nbsp;":e}getFormatter(e){switch(typeof e){case"string":Ls.formatters[e]?e=Ls.formatters[e]:(console.warn("Formatter Error - No such formatter found: ",e),e=Ls.formatters.plaintext);break;case"function":break;default:e=Ls.formatters.plaintext;break}return e}};Ve(Ls,"moduleName","format"),Ve(Ls,"formatters",ove);let D1=Ls;class I7 extends ci{constructor(e){super(e),this.leftColumns=[],this.rightColumns=[],this.initializationMode="left",this.active=!1,this.blocked=!0,this.registerColumnOption("frozen")}reset(){this.initializationMode="left",this.leftColumns=[],this.rightColumns=[],this.active=!1}initialize(){this.subscribe("cell-layout",this.layoutCell.bind(this)),this.subscribe("column-init",this.initializeColumn.bind(this)),this.subscribe("column-width",this.layout.bind(this)),this.subscribe("row-layout-after",this.layoutRow.bind(this)),this.subscribe("table-layout",this.layout.bind(this)),this.subscribe("columns-loading",this.reset.bind(this)),this.subscribe("column-add",this.reinitializeColumns.bind(this)),this.subscribe("column-deleted",this.reinitializeColumns.bind(this)),this.subscribe("column-hide",this.reinitializeColumns.bind(this)),this.subscribe("column-show",this.reinitializeColumns.bind(this)),this.subscribe("columns-loaded",this.reinitializeColumns.bind(this)),this.subscribe("table-redraw",this.layout.bind(this)),this.subscribe("layout-refreshing",this.blockLayout.bind(this)),this.subscribe("layout-refreshed",this.unblockLayout.bind(this)),this.subscribe("scrollbar-vertical",this.adjustForScrollbar.bind(this))}blockLayout(){this.blocked=!0}unblockLayout(){this.blocked=!1}layoutCell(e){this.layoutElement(e.element,e.column)}reinitializeColumns(){this.reset(),this.table.columnManager.columnsByIndex.forEach(e=>{this.initializeColumn(e)}),this.layout()}initializeColumn(e){var i={margin:0,edge:!1};e.isGroup||(this.frozenCheck(e)?(i.position=this.initializationMode,this.initializationMode=="left"?this.leftColumns.push(e):this.rightColumns.unshift(e),this.active=!0,e.modules.frozen=i):this.initializationMode="right")}frozenCheck(e){return e.parent.isGroup&&e.definition.frozen&&console.warn("Frozen Column Error - Parent column group must be frozen, not individual columns or sub column groups"),e.parent.isGroup?this.frozenCheck(e.parent):e.definition.frozen}layoutCalcRows(){this.table.modExists("columnCalcs")&&(this.table.modules.columnCalcs.topInitialized&&this.table.modules.columnCalcs.topRow&&this.layoutRow(this.table.modules.columnCalcs.topRow),this.table.modules.columnCalcs.botInitialized&&this.table.modules.columnCalcs.botRow&&this.layoutRow(this.table.modules.columnCalcs.botRow),this.table.modExists("groupRows")&&this.layoutGroupCalcs(this.table.modules.groupRows.getGroups()))}layoutGroupCalcs(e){e.forEach(i=>{i.calcs.top&&this.layoutRow(i.calcs.top),i.calcs.bottom&&this.layoutRow(i.calcs.bottom),i.groupList&&i.groupList.length&&this.layoutGroupCalcs(i.groupList)})}layoutColumnPosition(e){var i=[],r=0,n=0;this.leftColumns.forEach((a,o)=>{if(a.modules.frozen.marginValue=r,a.modules.frozen.margin=a.modules.frozen.marginValue+"px",a.visible&&(r+=a.getWidth()),o==this.leftColumns.length-1?a.modules.frozen.edge=!0:a.modules.frozen.edge=!1,a.parent.isGroup){var s=this.getColGroupParentElement(a);i.includes(s)||(this.layoutElement(s,a),i.push(s)),s.classList.toggle("tabulator-frozen-left",a.modules.frozen.edge&&a.modules.frozen.position==="left"),s.classList.toggle("tabulator-frozen-right",a.modules.frozen.edge&&a.modules.frozen.position==="right")}else this.layoutElement(a.getElement(),a);e&&a.cells.forEach(l=>{this.layoutElement(l.getElement(!0),a)})}),this.rightColumns.forEach((a,o)=>{a.modules.frozen.marginValue=n,a.modules.frozen.margin=a.modules.frozen.marginValue+"px",a.visible&&(n+=a.getWidth()),o==this.rightColumns.length-1?a.modules.frozen.edge=!0:a.modules.frozen.edge=!1,a.parent.isGroup?this.layoutElement(this.getColGroupParentElement(a),a):this.layoutElement(a.getElement(),a),e&&a.cells.forEach(s=>{this.layoutElement(s.getElement(!0),a)})})}getColGroupParentElement(e){return e.parent.isGroup?this.getColGroupParentElement(e.parent):e.getElement()}layout(){this.active&&!this.blocked&&(this.layoutColumnPosition(),this.reinitializeRows(),this.layoutCalcRows())}reinitializeRows(){var e=this.table.rowManager.getVisibleRows(!0),i=this.table.rowManager.getRows().filter(r=>!e.includes(r));i.forEach(r=>{r.deinitialize()}),e.forEach(r=>{r.type==="row"&&this.layoutRow(r)})}layoutRow(e){this.table.options.layout==="fitDataFill"&&this.rightColumns.length&&(this.table.rowManager.getTableElement().style.minWidth="calc(100% - "+this.rightMargin+")"),this.leftColumns.forEach(i=>{var r=e.getCell(i);r&&this.layoutElement(r.getElement(!0),i)}),this.rightColumns.forEach(i=>{var r=e.getCell(i);r&&this.layoutElement(r.getElement(!0),i)})}layoutElement(e,i){var r;i.modules.frozen&&e&&(e.style.position="sticky",this.table.rtl?r=i.modules.frozen.position==="left"?"right":"left":r=i.modules.frozen.position,e.style[r]=i.modules.frozen.margin,e.classList.add("tabulator-frozen"),e.classList.toggle("tabulator-frozen-left",i.modules.frozen.edge&&i.modules.frozen.position==="left"),e.classList.toggle("tabulator-frozen-right",i.modules.frozen.edge&&i.modules.frozen.position==="right"))}adjustForScrollbar(e){this.rightColumns.length&&(this.table.columnManager.getContentsElement().style.width="calc(100% - "+e+"px)")}getFrozenColumns(){return this.leftColumns.concat(this.rightColumns)}_calcSpace(e,i){var r=0;for(let n=0;n<i;n++)e[n].visible&&(r+=e[n].getWidth());return r}}Ve(I7,"moduleName","frozenColumns");class y7 extends ci{constructor(e){super(e),this.topElement=document.createElement("div"),this.rows=[],this.registerComponentFunction("row","freeze",this.freezeRow.bind(this)),this.registerComponentFunction("row","unfreeze",this.unfreezeRow.bind(this)),this.registerComponentFunction("row","isFrozen",this.isRowFrozen.bind(this)),this.registerTableOption("frozenRowsField","id"),this.registerTableOption("frozenRows",!1)}initialize(){var e=document.createDocumentFragment();this.rows=[],this.topElement.classList.add("tabulator-frozen-rows-holder"),e.appendChild(document.createElement("br")),e.appendChild(this.topElement),this.table.columnManager.getContentsElement().insertBefore(e,this.table.columnManager.headersElement.nextSibling),this.subscribe("row-deleting",this.detachRow.bind(this)),this.subscribe("rows-visible",this.visibleRows.bind(this)),this.registerDisplayHandler(this.getRows.bind(this),10),this.table.options.frozenRows&&(this.subscribe("data-processed",this.initializeRows.bind(this)),this.subscribe("row-added",this.initializeRow.bind(this)),this.subscribe("table-redrawing",this.resizeHolderWidth.bind(this)),this.subscribe("column-resized",this.resizeHolderWidth.bind(this)),this.subscribe("column-show",this.resizeHolderWidth.bind(this)),this.subscribe("column-hide",this.resizeHolderWidth.bind(this))),this.resizeHolderWidth()}resizeHolderWidth(){this.topElement.style.minWidth=this.table.columnManager.headersElement.offsetWidth+"px"}initializeRows(){this.table.rowManager.getRows().forEach(e=>{this.initializeRow(e)})}initializeRow(e){var i=this.table.options.frozenRows,r=typeof i;r==="number"?e.getPosition()&&e.getPosition()+this.rows.length<=i&&this.freezeRow(e):r==="function"?i.call(this.table,e.getComponent())&&this.freezeRow(e):Array.isArray(i)&&i.includes(e.data[this.options("frozenRowsField")])&&this.freezeRow(e)}isRowFrozen(e){var i=this.rows.indexOf(e);return i>-1}isFrozen(){return!!this.rows.length}visibleRows(e,i){return this.rows.forEach(r=>{i.push(r)}),i}getRows(e){var i=e.slice(0);return this.rows.forEach(function(r){var n=i.indexOf(r);n>-1&&i.splice(n,1)}),i}freezeRow(e){e.modules.frozen?console.warn("Freeze Error - Row is already frozen"):(e.modules.frozen=!0,this.topElement.appendChild(e.getElement()),e.initialize(),e.normalizeHeight(),this.rows.push(e),this.refreshData(!1,"display"),this.table.rowManager.adjustTableSize(),this.styleRows())}unfreezeRow(e){e.modules.frozen?(e.modules.frozen=!1,this.detachRow(e),this.table.rowManager.adjustTableSize(),this.refreshData(!1,"display"),this.rows.length&&this.styleRows()):console.warn("Freeze Error - Row is already unfrozen")}detachRow(e){var i=this.rows.indexOf(e);if(i>-1){var r=e.getElement();r.parentNode&&r.parentNode.removeChild(r),this.rows.splice(i,1)}}styleRows(e){this.rows.forEach((i,r)=>{this.table.rowManager.styleRow(i,r)})}}Ve(y7,"moduleName","frozenRows");class sve{constructor(e){return this._group=e,this.type="GroupComponent",new Proxy(this,{get:function(i,r,n){return typeof i[r]<"u"?i[r]:i._group.groupManager.table.componentFunctionBinder.handle("group",i._group,r)}})}getKey(){return this._group.key}getField(){return this._group.field}getElement(){return this._group.element}getRows(){return this._group.getRows(!0)}getSubGroups(){return this._group.getSubGroups(!0)}getParentGroup(){return this._group.parent?this._group.parent.getComponent():!1}isVisible(){return this._group.visible}show(){this._group.show()}hide(){this._group.hide()}toggle(){this._group.toggleVisibility()}scrollTo(e,i){return this._group.groupManager.table.rowManager.scrollToRow(this._group,e,i)}_getSelf(){return this._group}getTable(){return this._group.groupManager.table}}class uf{constructor(e,i,r,n,a,o,s){this.groupManager=e,this.parent=i,this.key=n,this.level=r,this.field=a,this.hasSubGroups=r<e.groupIDLookups.length-1,this.addRow=this.hasSubGroups?this._addRowToGroup:this._addRow,this.type="group",this.old=s,this.rows=[],this.groups=[],this.groupList=[],this.generator=o,this.element=!1,this.elementContents=!1,this.height=0,this.outerHeight=0,this.initialized=!1,this.calcs={},this.initialized=!1,this.modules={},this.arrowElement=!1,this.visible=s?s.visible:typeof e.startOpen[r]<"u"?e.startOpen[r]:e.startOpen[0],this.component=null,this.createElements(),this.addBindings(),this.createValueGroups()}wipe(e){e||(this.groupList.length?this.groupList.forEach(function(i){i.wipe()}):this.rows.forEach(i=>{i.modules&&delete i.modules.group})),this.element=!1,this.arrowElement=!1,this.elementContents=!1}createElements(){var e=document.createElement("div");e.classList.add("tabulator-arrow"),this.element=document.createElement("div"),this.element.classList.add("tabulator-row"),this.element.classList.add("tabulator-group"),this.element.classList.add("tabulator-group-level-"+this.level),this.element.setAttribute("role","rowgroup"),this.arrowElement=document.createElement("div"),this.arrowElement.classList.add("tabulator-group-toggle"),this.arrowElement.appendChild(e),this.groupManager.table.options.movableRows!==!1&&this.groupManager.table.modExists("moveRow")&&this.groupManager.table.modules.moveRow.initializeGroupHeader(this)}createValueGroups(){var e=this.level+1;this.groupManager.allowedValues&&this.groupManager.allowedValues[e]&&this.groupManager.allowedValues[e].forEach(i=>{this._createGroup(i,e)})}addBindings(){var e;this.groupManager.table.options.groupToggleElement&&(e=this.groupManager.table.options.groupToggleElement=="arrow"?this.arrowElement:this.element,e.addEventListener("click",i=>{this.groupManager.table.options.groupToggleElement==="arrow"&&(i.stopPropagation(),i.stopImmediatePropagation()),setTimeout(()=>{this.toggleVisibility()})}))}_createGroup(e,i){var r=i+"_"+e,n=new uf(this.groupManager,this,i,e,this.groupManager.groupIDLookups[i].field,this.groupManager.headerGenerator[i]||this.groupManager.headerGenerator[0],this.old?this.old.groups[r]:!1);this.groups[r]=n,this.groupList.push(n)}_addRowToGroup(e){var i=this.level+1;if(this.hasSubGroups){var r=this.groupManager.groupIDLookups[i].func(e.getData()),n=i+"_"+r;this.groupManager.allowedValues&&this.groupManager.allowedValues[i]?this.groups[n]&&this.groups[n].addRow(e):(this.groups[n]||this._createGroup(r,i),this.groups[n].addRow(e))}}_addRow(e){this.rows.push(e),e.modules.group=this}insertRow(e,i,r){var n=this.conformRowData({});e.updateData(n);var a=this.rows.indexOf(i);a>-1?r?this.rows.splice(a+1,0,e):this.rows.splice(a,0,e):r?this.rows.push(e):this.rows.unshift(e),e.modules.group=this,this.groupManager.table.modExists("columnCalcs")&&this.groupManager.table.options.columnCalcs!="table"&&this.groupManager.table.modules.columnCalcs.recalcGroup(this),this.groupManager.updateGroupRows(!0)}scrollHeader(e){this.arrowElement&&(this.arrowElement.style.marginLeft=e,this.groupList.forEach(function(i){i.scrollHeader(e)}))}getRowIndex(e){}conformRowData(e){return this.field?e[this.field]=this.key:console.warn("Data Conforming Error - Cannot conform row data to match new group as groupBy is a function"),this.parent&&(e=this.parent.conformRowData(e)),e}removeRow(e){var i=this.rows.indexOf(e),r=e.getElement();i>-1&&this.rows.splice(i,1),!this.groupManager.table.options.groupValues&&!this.rows.length?(this.parent?this.parent.removeGroup(this):this.groupManager.removeGroup(this),this.groupManager.updateGroupRows(!0)):(r.parentNode&&r.parentNode.removeChild(r),this.groupManager.blockRedraw||(this.generateGroupHeaderContents(),this.groupManager.table.modExists("columnCalcs")&&this.groupManager.table.options.columnCalcs!="table"&&this.groupManager.table.modules.columnCalcs.recalcGroup(this)))}removeGroup(e){var i=e.level+"_"+e.key,r;this.groups[i]&&(delete this.groups[i],r=this.groupList.indexOf(e),r>-1&&this.groupList.splice(r,1),this.groupList.length||(this.parent?this.parent.removeGroup(this):this.groupManager.removeGroup(this)))}getHeadersAndRows(){var e=[];return e.push(this),this._visSet(),this.calcs.top&&(this.calcs.top.detachElement(),this.calcs.top.deleteCells()),this.calcs.bottom&&(this.calcs.bottom.detachElement(),this.calcs.bottom.deleteCells()),this.visible?this.groupList.length?this.groupList.forEach(function(i){e=e.concat(i.getHeadersAndRows())}):(this.groupManager.table.options.columnCalcs!="table"&&this.groupManager.table.modExists("columnCalcs")&&this.groupManager.table.modules.columnCalcs.hasTopCalcs()&&(this.calcs.top=this.groupManager.table.modules.columnCalcs.generateTopRow(this.rows),e.push(this.calcs.top)),e=e.concat(this.rows),this.groupManager.table.options.columnCalcs!="table"&&this.groupManager.table.modExists("columnCalcs")&&this.groupManager.table.modules.columnCalcs.hasBottomCalcs()&&(this.calcs.bottom=this.groupManager.table.modules.columnCalcs.generateBottomRow(this.rows),e.push(this.calcs.bottom))):!this.groupList.length&&this.groupManager.table.options.columnCalcs!="table"&&this.groupManager.table.modExists("columnCalcs")&&(this.groupManager.table.modules.columnCalcs.hasTopCalcs()&&this.groupManager.table.options.groupClosedShowCalcs&&(this.calcs.top=this.groupManager.table.modules.columnCalcs.generateTopRow(this.rows),e.push(this.calcs.top)),this.groupManager.table.modules.columnCalcs.hasBottomCalcs()&&this.groupManager.table.options.groupClosedShowCalcs&&(this.calcs.bottom=this.groupManager.table.modules.columnCalcs.generateBottomRow(this.rows),e.push(this.calcs.bottom))),e}getData(e,i){var r=[];return this._visSet(),(!e||e&&this.visible)&&this.rows.forEach(n=>{r.push(n.getData(i||"data"))}),r}getRowCount(){var e=0;return this.groupList.length?this.groupList.forEach(i=>{e+=i.getRowCount()}):e=this.rows.length,e}toggleVisibility(){this.visible?this.hide():this.show()}hide(){this.visible=!1,this.groupManager.table.rowManager.getRenderMode()=="basic"&&!this.groupManager.table.options.pagination?(this.element.classList.remove("tabulator-group-visible"),this.groupList.length?this.groupList.forEach(e=>{var i=e.getHeadersAndRows();i.forEach(r=>{r.detachElement()})}):this.rows.forEach(e=>{var i=e.getElement();i.parentNode.removeChild(i)}),this.groupManager.updateGroupRows(!0)):this.groupManager.updateGroupRows(!0),this.groupManager.table.externalEvents.dispatch("groupVisibilityChanged",this.getComponent(),!1)}show(){if(this.visible=!0,this.groupManager.table.rowManager.getRenderMode()=="basic"&&!this.groupManager.table.options.pagination){this.element.classList.add("tabulator-group-visible");var e=this.generateElement();this.groupList.length?this.groupList.forEach(i=>{var r=i.getHeadersAndRows();r.forEach(n=>{var a=n.getElement();e.parentNode.insertBefore(a,e.nextSibling),n.initialize(),e=a})}):this.rows.forEach(i=>{var r=i.getElement();e.parentNode.insertBefore(r,e.nextSibling),i.initialize(),e=r}),this.groupManager.updateGroupRows(!0)}else this.groupManager.updateGroupRows(!0);this.groupManager.table.externalEvents.dispatch("groupVisibilityChanged",this.getComponent(),!0)}_visSet(){var e=[];typeof this.visible=="function"&&(this.rows.forEach(function(i){e.push(i.getData())}),this.visible=this.visible(this.key,this.getRowCount(),e,this.getComponent()))}getRowGroup(e){var i=!1;return this.groupList.length?this.groupList.forEach(function(r){var n=r.getRowGroup(e);n&&(i=n)}):this.rows.find(function(r){return r===e})&&(i=this),i}getSubGroups(e){var i=[];return this.groupList.forEach(function(r){i.push(e?r.getComponent():r)}),i}getRows(e,i){var r=[];return i&&this.groupList.length?this.groupList.forEach(n=>{r=r.concat(n.getRows(e,i))}):this.rows.forEach(function(n){r.push(e?n.getComponent():n)}),r}generateGroupHeaderContents(){var e=[],i=this.getRows(!1,!0);for(i.forEach(function(r){e.push(r.getData())}),this.elementContents=this.generator(this.key,this.getRowCount(),e,this.getComponent());this.element.firstChild;)this.element.removeChild(this.element.firstChild);typeof this.elementContents=="string"?this.element.innerHTML=this.elementContents:this.element.appendChild(this.elementContents),this.element.insertBefore(this.arrowElement,this.element.firstChild)}getPath(e=[]){return e.unshift(this.key),this.parent&&this.parent.getPath(e),e}getElement(){return this.elementContents?this.element:this.generateElement()}generateElement(){this.addBindings=!1,this._visSet(),this.visible?this.element.classList.add("tabulator-group-visible"):this.element.classList.remove("tabulator-group-visible");for(var e=0;e<this.element.childNodes.length;++e)this.element.childNodes[e].parentNode.removeChild(this.element.childNodes[e]);return this.generateGroupHeaderContents(),this.element}detachElement(){this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element)}normalizeHeight(){this.setHeight(this.element.clientHeight)}initialize(e){(!this.initialized||e)&&(this.normalizeHeight(),this.initialized=!0)}reinitialize(){this.initialized=!1,this.height=0,xr.elVisible(this.element)&&this.initialize(!0)}setHeight(e){this.height!=e&&(this.height=e,this.outerHeight=this.element.offsetHeight)}getHeight(){return this.outerHeight}getGroup(){return this}reinitializeHeight(){}calcHeight(){}setCellHeight(){}clearCellHeight(){}deinitializeHeight(){}rendered(){}getComponent(){return this.component||(this.component=new sve(this)),this.component}}class b7 extends ci{constructor(e){super(e),this.groupIDLookups=!1,this.startOpen=[function(){return!1}],this.headerGenerator=[function(){return""}],this.groupList=[],this.allowedValues=!1,this.groups={},this.displayHandler=this.getRows.bind(this),this.blockRedraw=!1,this.registerTableOption("groupBy",!1),this.registerTableOption("groupStartOpen",!0),this.registerTableOption("groupValues",!1),this.registerTableOption("groupUpdateOnCellEdit",!1),this.registerTableOption("groupHeader",!1),this.registerTableOption("groupHeaderPrint",null),this.registerTableOption("groupHeaderClipboard",null),this.registerTableOption("groupHeaderHtmlOutput",null),this.registerTableOption("groupHeaderDownload",null),this.registerTableOption("groupToggleElement","arrow"),this.registerTableOption("groupClosedShowCalcs",!1),this.registerTableFunction("setGroupBy",this.setGroupBy.bind(this)),this.registerTableFunction("setGroupValues",this.setGroupValues.bind(this)),this.registerTableFunction("setGroupStartOpen",this.setGroupStartOpen.bind(this)),this.registerTableFunction("setGroupHeader",this.setGroupHeader.bind(this)),this.registerTableFunction("getGroups",this.userGetGroups.bind(this)),this.registerTableFunction("getGroupedData",this.userGetGroupedData.bind(this)),this.registerComponentFunction("row","getGroup",this.rowGetGroup.bind(this))}initialize(){this.subscribe("table-destroy",this._blockRedrawing.bind(this)),this.subscribe("rows-wipe",this._blockRedrawing.bind(this)),this.subscribe("rows-wiped",this._restore_redrawing.bind(this)),this.table.options.groupBy&&(this.table.options.groupUpdateOnCellEdit&&(this.subscribe("cell-value-updated",this.cellUpdated.bind(this)),this.subscribe("row-data-changed",this.reassignRowToGroup.bind(this),0)),this.subscribe("table-built",this.configureGroupSetup.bind(this)),this.subscribe("row-deleting",this.rowDeleting.bind(this)),this.subscribe("row-deleted",this.rowsUpdated.bind(this)),this.subscribe("scroll-horizontal",this.scrollHeaders.bind(this)),this.subscribe("rows-wipe",this.wipe.bind(this)),this.subscribe("rows-added",this.rowsUpdated.bind(this)),this.subscribe("row-moving",this.rowMoving.bind(this)),this.subscribe("row-adding-index",this.rowAddingIndex.bind(this)),this.subscribe("rows-sample",this.rowSample.bind(this)),this.subscribe("render-virtual-fill",this.virtualRenderFill.bind(this)),this.registerDisplayHandler(this.displayHandler,20),this.initialized=!0)}_blockRedrawing(){this.blockRedraw=!0}_restore_redrawing(){this.blockRedraw=!1}configureGroupSetup(){if(this.table.options.groupBy){var e=this.table.options.groupBy,i=this.table.options.groupStartOpen,r=this.table.options.groupHeader;if(this.allowedValues=this.table.options.groupValues,Array.isArray(e)&&Array.isArray(r)&&e.length>r.length&&console.warn("Error creating group headers, groupHeader array is shorter than groupBy array"),this.headerGenerator=[function(){return""}],this.startOpen=[function(){return!1}],this.langBind("groups|item",(a,o)=>{this.headerGenerator[0]=(s,l,u)=>(typeof s>"u"?"":s)+"<span>("+l+" "+(l===1?a:o.groups.items)+")</span>"}),this.groupIDLookups=[],e)this.table.modExists("columnCalcs")&&this.table.options.columnCalcs!="table"&&this.table.options.columnCalcs!="both"&&this.table.modules.columnCalcs.removeCalcs();else if(this.table.modExists("columnCalcs")&&this.table.options.columnCalcs!="group"){var n=this.table.columnManager.getRealColumns();n.forEach(a=>{a.definition.topCalc&&this.table.modules.columnCalcs.initializeTopRow(),a.definition.bottomCalc&&this.table.modules.columnCalcs.initializeBottomRow()})}Array.isArray(e)||(e=[e]),e.forEach((a,o)=>{var s,l;typeof a=="function"?s=a:(l=this.table.columnManager.getColumnByField(a),l?s=function(u){return l.getFieldValue(u)}:s=function(u){return u[a]}),this.groupIDLookups.push({field:typeof a=="function"?!1:a,func:s,values:this.allowedValues?this.allowedValues[o]:!1})}),i&&(Array.isArray(i)||(i=[i]),i.forEach(a=>{}),this.startOpen=i),r&&(this.headerGenerator=Array.isArray(r)?r:[r])}else this.groupList=[],this.groups={}}rowSample(e,i){if(this.table.options.groupBy){var r=this.getGroups(!1)[0];i.push(r.getRows(!1)[0])}return i}virtualRenderFill(){var e=this.table.rowManager.tableElement,i=this.table.rowManager.getVisibleRows();if(this.table.options.groupBy)i=i.filter(r=>r.type!=="group"),e.style.minWidth=i.length?"":this.table.columnManager.getWidth()+"px";else return i}rowAddingIndex(e,i,r){if(this.table.options.groupBy){this.assignRowToGroup(e);var n=e.modules.group.rows;return n.length>1&&(!i||i&&n.indexOf(i)==-1?r?n[0]!==e&&(i=n[0],this.table.rowManager.moveRowInArray(e.modules.group.rows,e,i,!r)):n[n.length-1]!==e&&(i=n[n.length-1],this.table.rowManager.moveRowInArray(e.modules.group.rows,e,i,!r)):this.table.rowManager.moveRowInArray(e.modules.group.rows,e,i,!r)),i}}trackChanges(){this.dispatch("group-changed")}setGroupBy(e){this.table.options.groupBy=e,this.initialized||this.initialize(),this.configureGroupSetup(),!e&&this.table.modExists("columnCalcs")&&this.table.options.columnCalcs===!0&&this.table.modules.columnCalcs.reinitializeCalcs(),this.refreshData(),this.trackChanges()}setGroupValues(e){this.table.options.groupValues=e,this.configureGroupSetup(),this.refreshData(),this.trackChanges()}setGroupStartOpen(e){this.table.options.groupStartOpen=e,this.configureGroupSetup(),this.table.options.groupBy?(this.refreshData(),this.trackChanges()):console.warn("Grouping Update - cant refresh view, no groups have been set")}setGroupHeader(e){this.table.options.groupHeader=e,this.configureGroupSetup(),this.table.options.groupBy?(this.refreshData(),this.trackChanges()):console.warn("Grouping Update - cant refresh view, no groups have been set")}userGetGroups(e){return this.getGroups(!0)}userGetGroupedData(){return this.table.options.groupBy?this.getGroupedData():this.getData()}rowGetGroup(e){return e.modules.group?e.modules.group.getComponent():!1}rowMoving(e,i,r){if(this.table.options.groupBy){!r&&i instanceof uf&&(i=this.table.rowManager.prevDisplayRow(e)||i);var n=i instanceof uf?i:i.modules.group,a=e instanceof uf?e:e.modules.group;n===a?this.table.rowManager.moveRowInArray(n.rows,e,i,r):(a&&a.removeRow(e),n.insertRow(e,i,r))}}rowDeleting(e){this.table.options.groupBy&&e.modules.group&&e.modules.group.removeRow(e)}rowsUpdated(e){this.table.options.groupBy&&this.updateGroupRows(!0)}cellUpdated(e){this.table.options.groupBy&&this.reassignRowToGroup(e.row)}getRows(e){return this.table.options.groupBy&&this.groupIDLookups.length?(this.dispatchExternal("dataGrouping"),this.generateGroups(e),this.subscribedExternal("dataGrouped")&&this.dispatchExternal("dataGrouped",this.getGroups(!0)),this.updateGroupRows()):e.slice(0)}getGroups(e){var i=[];return this.groupList.forEach(function(r){i.push(e?r.getComponent():r)}),i}getChildGroups(e){var i=[];return e||(e=this),e.groupList.forEach(r=>{r.groupList.length?i=i.concat(this.getChildGroups(r)):i.push(r)}),i}wipe(){this.table.options.groupBy&&(this.groupList.forEach(function(e){e.wipe()}),this.groupList=[],this.groups={})}pullGroupListData(e){var i=[];return e.forEach(r=>{var n={};n.level=0,n.rowCount=0,n.headerContent="";var a=[];r.hasSubGroups?(a=this.pullGroupListData(r.groupList),n.level=r.level,n.rowCount=a.length-r.groupList.length,n.headerContent=r.generator(r.key,n.rowCount,r.rows,r),i.push(n),i=i.concat(a)):(n.level=r.level,n.headerContent=r.generator(r.key,r.rows.length,r.rows,r),n.rowCount=r.getRows().length,i.push(n),r.getRows().forEach(o=>{i.push(o.getData("data"))}))}),i}getGroupedData(){return this.pullGroupListData(this.groupList)}getRowGroup(e){var i=!1;return this.options("dataTree")&&(e=this.table.modules.dataTree.getTreeParentRoot(e)),this.groupList.forEach(r=>{var n=r.getRowGroup(e);n&&(i=n)}),i}countGroups(){return this.groupList.length}generateGroups(e){var i=this.groups;this.groups={},this.groupList=[],this.allowedValues&&this.allowedValues[0]?(this.allowedValues[0].forEach(r=>{this.createGroup(r,0,i)}),e.forEach(r=>{this.assignRowToExistingGroup(r,i)})):e.forEach(r=>{this.assignRowToGroup(r,i)}),Object.values(i).forEach(r=>{r.wipe(!0)})}createGroup(e,i,r){var n=i+"_"+e,a;r=r||[],a=new uf(this,!1,i,e,this.groupIDLookups[0].field,this.headerGenerator[0],r[n]),this.groups[n]=a,this.groupList.push(a)}assignRowToExistingGroup(e,i){var r=this.groupIDLookups[0].func(e.getData()),n="0_"+r;this.groups[n]&&this.groups[n].addRow(e)}assignRowToGroup(e,i){var r=this.groupIDLookups[0].func(e.getData()),n=!this.groups["0_"+r];return n&&this.createGroup(r,0,i),this.groups["0_"+r].addRow(e),!n}reassignRowToGroup(e){if(e.type==="row"){var i=e.modules.group,r=i.getPath(),n=this.getExpectedPath(e),a;a=r.length==n.length&&r.every((o,s)=>o===n[s]),a||(i.removeRow(e),this.assignRowToGroup(e,this.groups),this.refreshData(!0))}}getExpectedPath(e){var i=[],r=e.getData();return this.groupIDLookups.forEach(n=>{i.push(n.func(r))}),i}updateGroupRows(e){var i=[];return this.blockRedraw||(this.groupList.forEach(r=>{i=i.concat(r.getHeadersAndRows())}),e&&this.refreshData(!0)),i}scrollHeaders(e){this.table.options.groupBy&&(this.table.options.renderHorizontal==="virtual"&&(e-=this.table.columnManager.renderer.vDomPadLeft),e=e+"px",this.groupList.forEach(i=>{i.scrollHeader(e)}))}removeGroup(e){var i=e.level+"_"+e.key,r;this.groups[i]&&(delete this.groups[i],r=this.groupList.indexOf(e),r>-1&&this.groupList.splice(r,1))}checkBasicModeGroupHeaderWidth(){var e=this.table.rowManager.tableElement,i=!0;this.table.rowManager.getDisplayRows().forEach((r,n)=>{this.table.rowManager.styleRow(r,n),e.appendChild(r.getElement()),r.initialize(!0),r.type!=="group"&&(i=!1)}),i?e.style.minWidth=this.table.columnManager.getWidth()+"px":e.style.minWidth=""}}Ve(b7,"moduleName","groupRows");var lve={cellEdit:function(t){t.component.setValueProcessData(t.data.oldValue),t.component.cellRendered()},rowAdd:function(t){t.component.deleteActual(),this.table.rowManager.checkPlaceholder()},rowDelete:function(t){var e=this.table.rowManager.addRowActual(t.data.data,t.data.pos,t.data.index);this.table.options.groupBy&&this.table.modExists("groupRows")&&this.table.modules.groupRows.updateGroupRows(!0),this._rebindRow(t.component,e),this.table.rowManager.checkPlaceholder()},rowMove:function(t){var e=t.data.posFrom-t.data.posTo>0;this.table.rowManager.moveRowActual(t.component,this.table.rowManager.getRowFromPosition(t.data.posFrom),e),this.table.rowManager.regenerateRowPositions(),this.table.rowManager.reRenderInPosition()}},uve={cellEdit:function(t){t.component.setValueProcessData(t.data.newValue),t.component.cellRendered()},rowAdd:function(t){var e=this.table.rowManager.addRowActual(t.data.data,t.data.pos,t.data.index);this.table.options.groupBy&&this.table.modExists("groupRows")&&this.table.modules.groupRows.updateGroupRows(!0),this._rebindRow(t.component,e),this.table.rowManager.checkPlaceholder()},rowDelete:function(t){t.component.deleteActual(),this.table.rowManager.checkPlaceholder()},rowMove:function(t){this.table.rowManager.moveRowActual(t.component,this.table.rowManager.getRowFromPosition(t.data.posTo),t.data.after),this.table.rowManager.regenerateRowPositions(),this.table.rowManager.reRenderInPosition()}},cve={undo:["ctrl + 90","meta + 90"],redo:["ctrl + 89","meta + 89"]},dve={undo:function(t){var e=!1;this.table.options.history&&this.table.modExists("history")&&this.table.modExists("edit")&&(e=this.table.modules.edit.currentCell,e||(t.preventDefault(),this.table.modules.history.undo()))},redo:function(t){var e=!1;this.table.options.history&&this.table.modExists("history")&&this.table.modExists("edit")&&(e=this.table.modules.edit.currentCell,e||(t.preventDefault(),this.table.modules.history.redo()))}},pve={keybindings:{bindings:cve,actions:dve}};const bd=class bd extends ci{constructor(e){super(e),this.history=[],this.index=-1,this.registerTableOption("history",!1)}initialize(){this.table.options.history&&(this.subscribe("cell-value-updated",this.cellUpdated.bind(this)),this.subscribe("cell-delete",this.clearComponentHistory.bind(this)),this.subscribe("row-delete",this.rowDeleted.bind(this)),this.subscribe("rows-wipe",this.clear.bind(this)),this.subscribe("row-added",this.rowAdded.bind(this)),this.subscribe("row-move",this.rowMoved.bind(this))),this.registerTableFunction("undo",this.undo.bind(this)),this.registerTableFunction("redo",this.redo.bind(this)),this.registerTableFunction("getHistoryUndoSize",this.getHistoryUndoSize.bind(this)),this.registerTableFunction("getHistoryRedoSize",this.getHistoryRedoSize.bind(this)),this.registerTableFunction("clearHistory",this.clear.bind(this))}rowMoved(e,i,r){this.action("rowMove",e,{posFrom:e.getPosition(),posTo:i.getPosition(),to:i,after:r})}rowAdded(e,i,r,n){this.action("rowAdd",e,{data:i,pos:r,index:n})}rowDeleted(e){var i,r;this.table.options.groupBy?(r=e.getComponent().getGroup()._getSelf().rows,i=r.indexOf(e),i&&(i=r[i-1])):(i=e.table.rowManager.getRowIndex(e),i&&(i=e.table.rowManager.rows[i-1])),this.action("rowDelete",e,{data:e.getData(),pos:!i,index:i})}cellUpdated(e){this.action("cellEdit",e,{oldValue:e.oldValue,newValue:e.value})}clear(){this.history=[],this.index=-1}action(e,i,r){this.history=this.history.slice(0,this.index+1),this.history.push({type:e,component:i,data:r}),this.index++}getHistoryUndoSize(){return this.index+1}getHistoryRedoSize(){return this.history.length-(this.index+1)}clearComponentHistory(e){var i=this.history.findIndex(function(r){return r.component===e});i>-1&&(this.history.splice(i,1),i<=this.index&&this.index--,this.clearComponentHistory(e))}undo(){if(this.index>-1){let e=this.history[this.index];return bd.undoers[e.type].call(this,e),this.index--,this.dispatchExternal("historyUndo",e.type,e.component.getComponent(),e.data),!0}else return console.warn(this.options("history")?"History Undo Error - No more history to undo":"History module not enabled"),!1}redo(){if(this.history.length-1>this.index){this.index++;let e=this.history[this.index];return bd.redoers[e.type].call(this,e),this.dispatchExternal("historyRedo",e.type,e.component.getComponent(),e.data),!0}else return console.warn(this.options("history")?"History Redo Error - No more history to redo":"History module not enabled"),!1}_rebindRow(e,i){this.history.forEach(function(r){if(r.component instanceof io)r.component===e&&(r.component=i);else if(r.component instanceof Bb&&r.component.row===e){var n=r.component.column.getField();n&&(r.component=i.getCell(n))}})}};Ve(bd,"moduleName","history"),Ve(bd,"moduleExtensions",pve),Ve(bd,"undoers",lve),Ve(bd,"redoers",uve);let P1=bd;class w7 extends ci{constructor(e){super(e),this.fieldIndex=[],this.hasIndex=!1}initialize(){this.tableElementCheck()}tableElementCheck(){this.table.originalElement&&this.table.originalElement.tagName==="TABLE"&&(this.table.originalElement.childNodes.length?this.parseTable():console.warn("Unable to parse data from empty table tag, Tabulator should be initialized on a div tag unless importing data from a table element."))}parseTable(){var e=this.table.originalElement,i=this.table.options,r=e.getElementsByTagName("th"),n=e.getElementsByTagName("tbody")[0],a=[];this.hasIndex=!1,this.dispatchExternal("htmlImporting"),n=n?n.getElementsByTagName("tr"):[],this._extractOptions(e,i),r.length?this._extractHeaders(r,n):this._generateBlankHeaders(r,n);for(var o=0;o<n.length;o++){var s=n[o],l=s.getElementsByTagName("td"),u={};this.hasIndex||(u[i.index]=o);for(var c=0;c<l.length;c++){var d=l[c];typeof this.fieldIndex[c]<"u"&&(u[this.fieldIndex[c]]=d.innerHTML)}a.push(u)}i.data=a,this.dispatchExternal("htmlImported")}_extractOptions(e,i,r){var n=e.attributes,a=Object.keys(r||i),o={};a.forEach(c=>{o[c.toLowerCase()]=c});for(var s in n){var l=n[s],u;l&&typeof l=="object"&&l.name&&l.name.indexOf("tabulator-")===0&&(u=l.name.replace("tabulator-",""),typeof o[u]<"u"&&(i[o[u]]=this._attribValue(l.value)))}}_attribValue(e){return e==="true"?!0:e==="false"?!1:e}_findCol(e){var i=this.table.options.columns.find(r=>r.title===e);return i||!1}_extractHeaders(e,i){for(var r=0;r<e.length;r++){var n=e[r],a=!1,o=this._findCol(n.textContent),s;o?a=!0:o={title:n.textContent.trim()},o.field||(o.field=n.textContent.trim().toLowerCase().replaceAll(" ","_")),s=n.getAttribute("width"),s&&!o.width&&(o.width=s),this._extractOptions(n,o,this.table.columnManager.optionsList.registeredDefaults),this.fieldIndex[r]=o.field,o.field==this.table.options.index&&(this.hasIndex=!0),a||this.table.options.columns.push(o)}}_generateBlankHeaders(e,i){for(var r=0;r<e.length;r++){var n=e[r],a={title:"",field:"col"+r};this.fieldIndex[r]=a.field;var o=n.getAttribute("width");o&&(a.width=o),this.table.options.columns.push(a)}}}Ve(w7,"moduleName","htmlTableImport");function mve(t){var e=[],i=0,r=0,n=!1;for(let a=0;a<t.length;a++){let o=t[a],s=t[a+1];if(e[i]||(e[i]=[]),e[i][r]||(e[i][r]=""),o=='"'&&n&&s=='"'){e[i][r]+=o,a++;continue}if(o=='"'){n=!n;continue}if(o==","&&!n){r++;continue}if(o=="\r"&&s==`
`&&!n){r=0,i++,a++;continue}if((o=="\r"||o==`
`)&&!n){r=0,i++;continue}e[i][r]+=o}return e}function hve(t){try{return JSON.parse(t)}catch(e){return console.warn("JSON Import Error - File contents is invalid JSON",e),Promise.reject()}}function fve(t){return t}function gve(t,e){var i=XLSX.read(t),r=i.Sheets[i.SheetNames[0]];return XLSX.utils.sheet_to_json(r,{})}var vve={csv:mve,json:hve,array:fve,xlsx:gve};const hI=class hI extends ci{constructor(e){super(e),this.registerTableOption("importFormat"),this.registerTableOption("importReader","text")}initialize(){this.registerTableFunction("import",this.importFromFile.bind(this)),this.table.options.importFormat&&(this.subscribe("data-loading",this.loadDataCheck.bind(this),10),this.subscribe("data-load",this.loadData.bind(this),10))}loadDataCheck(e){return this.table.options.importFormat&&(typeof e=="string"||Array.isArray(e)&&e.length&&Array.isArray(e))}loadData(e,i,r,n,a){return this.importData(this.lookupImporter(),e).then(this.structureData.bind(this)).catch(o=>(console.error("Import Error:",o||"Unable to import data"),Promise.reject(o)))}lookupImporter(e){var i;return e||(e=this.table.options.importFormat),typeof e=="string"?i=hI.importers[e]:i=e,i||console.error("Import Error - Importer not found:",e),i}importFromFile(e,i,r){var n=this.lookupImporter(e);if(n)return this.pickFile(i,r).then(this.importData.bind(this,n)).then(this.structureData.bind(this)).then(this.setData.bind(this)).catch(a=>(this.dispatch("import-error",a),this.dispatchExternal("importError",a),console.error("Import Error:",a||"Unable to import file"),Promise.reject(a)))}pickFile(e,i){return new Promise((r,n)=>{var a=document.createElement("input");a.type="file",a.accept=e,a.addEventListener("change",o=>{var s=a.files[0],l=new FileReader;switch(this.dispatch("import-importing",a.files),this.dispatchExternal("importImporting",a.files),i||this.table.options.importReader){case"buffer":l.readAsArrayBuffer(s);break;case"binary":l.readAsBinaryString(s);break;case"url":l.readAsDataURL(s);break;case"text":default:l.readAsText(s)}l.onload=u=>{r(l.result)},l.onerror=u=>{console.warn("File Load Error - Unable to read file"),n()}}),this.dispatch("import-choose"),this.dispatchExternal("importChoose"),a.click()})}importData(e,i){var r=e.call(this.table,i);return r instanceof Promise?r:r?Promise.resolve(r):Promise.reject()}structureData(e){var i=[];return Array.isArray(e)&&e.length&&Array.isArray(e[0])?(this.table.options.autoColumns?i=this.structureArrayToObject(e):i=this.structureArrayToColumns(e),i):e}structureArrayToObject(e){var i=e.shift(),r=e.map(n=>{var a={};return i.forEach((o,s)=>{a[o]=n[s]}),a});return r}structureArrayToColumns(e){var i=[],r=this.table.getColumns();return r[0]&&e[0][0]&&r[0].getDefinition().title===e[0][0]&&e.shift(),e.forEach(n=>{var a={};n.forEach((o,s)=>{var l=r[s];l&&(a[l.getField()]=o)}),i.push(a)}),i}setData(e){return this.dispatch("import-imported",e),this.dispatchExternal("importImported",e),this.table.setData(e)}};Ve(hI,"moduleName","import"),Ve(hI,"importers",vve);let R1=hI;class U7 extends ci{constructor(e){super(e),this.eventMap={rowClick:"row-click",rowDblClick:"row-dblclick",rowContext:"row-contextmenu",rowMouseEnter:"row-mouseenter",rowMouseLeave:"row-mouseleave",rowMouseOver:"row-mouseover",rowMouseOut:"row-mouseout",rowMouseMove:"row-mousemove",rowMouseDown:"row-mousedown",rowMouseUp:"row-mouseup",rowTap:"row",rowDblTap:"row",rowTapHold:"row",cellClick:"cell-click",cellDblClick:"cell-dblclick",cellContext:"cell-contextmenu",cellMouseEnter:"cell-mouseenter",cellMouseLeave:"cell-mouseleave",cellMouseOver:"cell-mouseover",cellMouseOut:"cell-mouseout",cellMouseMove:"cell-mousemove",cellMouseDown:"cell-mousedown",cellMouseUp:"cell-mouseup",cellTap:"cell",cellDblTap:"cell",cellTapHold:"cell",headerClick:"column-click",headerDblClick:"column-dblclick",headerContext:"column-contextmenu",headerMouseEnter:"column-mouseenter",headerMouseLeave:"column-mouseleave",headerMouseOver:"column-mouseover",headerMouseOut:"column-mouseout",headerMouseMove:"column-mousemove",headerMouseDown:"column-mousedown",headerMouseUp:"column-mouseup",headerTap:"column",headerDblTap:"column",headerTapHold:"column",groupClick:"group-click",groupDblClick:"group-dblclick",groupContext:"group-contextmenu",groupMouseEnter:"group-mouseenter",groupMouseLeave:"group-mouseleave",groupMouseOver:"group-mouseover",groupMouseOut:"group-mouseout",groupMouseMove:"group-mousemove",groupMouseDown:"group-mousedown",groupMouseUp:"group-mouseup",groupTap:"group",groupDblTap:"group",groupTapHold:"group"},this.subscribers={},this.touchSubscribers={},this.columnSubscribers={},this.touchWatchers={row:{tap:null,tapDbl:null,tapHold:null},cell:{tap:null,tapDbl:null,tapHold:null},column:{tap:null,tapDbl:null,tapHold:null},group:{tap:null,tapDbl:null,tapHold:null}},this.registerColumnOption("headerClick"),this.registerColumnOption("headerDblClick"),this.registerColumnOption("headerContext"),this.registerColumnOption("headerMouseEnter"),this.registerColumnOption("headerMouseLeave"),this.registerColumnOption("headerMouseOver"),this.registerColumnOption("headerMouseOut"),this.registerColumnOption("headerMouseMove"),this.registerColumnOption("headerMouseDown"),this.registerColumnOption("headerMouseUp"),this.registerColumnOption("headerTap"),this.registerColumnOption("headerDblTap"),this.registerColumnOption("headerTapHold"),this.registerColumnOption("cellClick"),this.registerColumnOption("cellDblClick"),this.registerColumnOption("cellContext"),this.registerColumnOption("cellMouseEnter"),this.registerColumnOption("cellMouseLeave"),this.registerColumnOption("cellMouseOver"),this.registerColumnOption("cellMouseOut"),this.registerColumnOption("cellMouseMove"),this.registerColumnOption("cellMouseDown"),this.registerColumnOption("cellMouseUp"),this.registerColumnOption("cellTap"),this.registerColumnOption("cellDblTap"),this.registerColumnOption("cellTapHold")}initialize(){this.initializeExternalEvents(),this.subscribe("column-init",this.initializeColumn.bind(this)),this.subscribe("cell-dblclick",this.cellContentsSelectionFixer.bind(this)),this.subscribe("scroll-horizontal",this.clearTouchWatchers.bind(this)),this.subscribe("scroll-vertical",this.clearTouchWatchers.bind(this))}clearTouchWatchers(){var e=Object.values(this.touchWatchers);e.forEach(i=>{for(let r in i)i[r]=null})}cellContentsSelectionFixer(e,i){var r;if(!(this.table.modExists("edit")&&this.table.modules.edit.currentCell===i)){e.preventDefault();try{document.selection?(r=document.body.createTextRange(),r.moveToElementText(i.getElement()),r.select()):window.getSelection&&(r=document.createRange(),r.selectNode(i.getElement()),window.getSelection().removeAllRanges(),window.getSelection().addRange(r))}catch{}}}initializeExternalEvents(){for(let e in this.eventMap)this.subscriptionChangeExternal(e,this.subscriptionChanged.bind(this,e))}subscriptionChanged(e,i){i?this.subscribers[e]||(this.eventMap[e].includes("-")?(this.subscribers[e]=this.handle.bind(this,e),this.subscribe(this.eventMap[e],this.subscribers[e])):this.subscribeTouchEvents(e)):this.eventMap[e].includes("-")?this.subscribers[e]&&!this.columnSubscribers[e]&&!this.subscribedExternal(e)&&(this.unsubscribe(this.eventMap[e],this.subscribers[e]),delete this.subscribers[e]):this.unsubscribeTouchEvents(e)}subscribeTouchEvents(e){var i=this.eventMap[e];this.touchSubscribers[i+"-touchstart"]||(this.touchSubscribers[i+"-touchstart"]=this.handleTouch.bind(this,i,"start"),this.touchSubscribers[i+"-touchend"]=this.handleTouch.bind(this,i,"end"),this.subscribe(i+"-touchstart",this.touchSubscribers[i+"-touchstart"]),this.subscribe(i+"-touchend",this.touchSubscribers[i+"-touchend"])),this.subscribers[e]=!0}unsubscribeTouchEvents(e){var i=!0,r=this.eventMap[e];if(this.subscribers[e]&&!this.subscribedExternal(e)){delete this.subscribers[e];for(let n in this.eventMap)this.eventMap[n]===r&&this.subscribers[n]&&(i=!1);i&&(this.unsubscribe(r+"-touchstart",this.touchSubscribers[r+"-touchstart"]),this.unsubscribe(r+"-touchend",this.touchSubscribers[r+"-touchend"]),delete this.touchSubscribers[r+"-touchstart"],delete this.touchSubscribers[r+"-touchend"])}}initializeColumn(e){var i=e.definition;for(let r in this.eventMap)i[r]&&(this.subscriptionChanged(r,!0),this.columnSubscribers[r]||(this.columnSubscribers[r]=[]),this.columnSubscribers[r].push(e))}handle(e,i,r){this.dispatchEvent(e,i,r)}handleTouch(e,i,r,n){var a=this.touchWatchers[e];switch(e==="column"&&(e="header"),i){case"start":a.tap=!0,clearTimeout(a.tapHold),a.tapHold=setTimeout(()=>{clearTimeout(a.tapHold),a.tapHold=null,a.tap=null,clearTimeout(a.tapDbl),a.tapDbl=null,this.dispatchEvent(e+"TapHold",r,n)},1e3);break;case"end":a.tap&&(a.tap=null,this.dispatchEvent(e+"Tap",r,n)),a.tapDbl?(clearTimeout(a.tapDbl),a.tapDbl=null,this.dispatchEvent(e+"DblTap",r,n)):a.tapDbl=setTimeout(()=>{clearTimeout(a.tapDbl),a.tapDbl=null},300),clearTimeout(a.tapHold),a.tapHold=null;break}}dispatchEvent(e,i,r){var n=r.getComponent(),a;this.columnSubscribers[e]&&(r instanceof Bb?a=r.column.definition[e]:r instanceof nm&&(a=r.definition[e]),a&&a(i,n)),this.dispatchExternal(e,i,n)}}Ve(U7,"moduleName","interaction");var Ive={navPrev:"shift + 9",navNext:9,navUp:38,navDown:40,navLeft:37,navRight:39,scrollPageUp:33,scrollPageDown:34,scrollToStart:36,scrollToEnd:35},yve={keyBlock:function(t){t.stopPropagation(),t.preventDefault()},scrollPageUp:function(t){var e=this.table.rowManager,i=e.scrollTop-e.element.clientHeight;t.preventDefault(),e.displayRowsCount&&(i>=0?e.element.scrollTop=i:e.scrollToRow(e.getDisplayRows()[0])),this.table.element.focus()},scrollPageDown:function(t){var e=this.table.rowManager,i=e.scrollTop+e.element.clientHeight,r=e.element.scrollHeight;t.preventDefault(),e.displayRowsCount&&(i<=r?e.element.scrollTop=i:e.scrollToRow(e.getDisplayRows()[e.displayRowsCount-1])),this.table.element.focus()},scrollToStart:function(t){var e=this.table.rowManager;t.preventDefault(),e.displayRowsCount&&e.scrollToRow(e.getDisplayRows()[0]),this.table.element.focus()},scrollToEnd:function(t){var e=this.table.rowManager;t.preventDefault(),e.displayRowsCount&&e.scrollToRow(e.getDisplayRows()[e.displayRowsCount-1]),this.table.element.focus()},navPrev:function(t){this.dispatch("keybinding-nav-prev",t)},navNext:function(t){this.dispatch("keybinding-nav-next",t)},navLeft:function(t){this.dispatch("keybinding-nav-left",t)},navRight:function(t){this.dispatch("keybinding-nav-right",t)},navUp:function(t){this.dispatch("keybinding-nav-up",t)},navDown:function(t){this.dispatch("keybinding-nav-down",t)}};const wd=class wd extends ci{constructor(e){super(e),this.watchKeys=null,this.pressedKeys=null,this.keyupBinding=!1,this.keydownBinding=!1,this.registerTableOption("keybindings",{}),this.registerTableOption("tabEndNewRow",!1)}initialize(){var e=this.table.options.keybindings,i={};this.watchKeys={},this.pressedKeys=[],e!==!1&&(Object.assign(i,wd.bindings),Object.assign(i,e),this.mapBindings(i),this.bindEvents()),this.subscribe("table-destroy",this.clearBindings.bind(this))}mapBindings(e){for(let i in e)wd.actions[i]?e[i]&&(typeof e[i]!="object"&&(e[i]=[e[i]]),e[i].forEach(r=>{var n=Array.isArray(r)?r:[r];n.forEach(a=>{this.mapBinding(i,a)})})):console.warn("Key Binding Error - no such action:",i)}mapBinding(e,i){var r={action:wd.actions[e],keys:[],ctrl:!1,shift:!1,meta:!1},n=i.toString().toLowerCase().split(" ").join("").split("+");n.forEach(a=>{switch(a){case"ctrl":r.ctrl=!0;break;case"shift":r.shift=!0;break;case"meta":r.meta=!0;break;default:a=isNaN(a)?a.toUpperCase().charCodeAt(0):parseInt(a),r.keys.push(a),this.watchKeys[a]||(this.watchKeys[a]=[]),this.watchKeys[a].push(r)}})}bindEvents(){var e=this;this.keyupBinding=function(i){var r=i.keyCode,n=e.watchKeys[r];n&&(e.pressedKeys.push(r),n.forEach(function(a){e.checkBinding(i,a)}))},this.keydownBinding=function(i){var r=i.keyCode,n=e.watchKeys[r];if(n){var a=e.pressedKeys.indexOf(r);a>-1&&e.pressedKeys.splice(a,1)}},this.table.element.addEventListener("keydown",this.keyupBinding),this.table.element.addEventListener("keyup",this.keydownBinding)}clearBindings(){this.keyupBinding&&this.table.element.removeEventListener("keydown",this.keyupBinding),this.keydownBinding&&this.table.element.removeEventListener("keyup",this.keydownBinding)}checkBinding(e,i){var r=!0;return e.ctrlKey==i.ctrl&&e.shiftKey==i.shift&&e.metaKey==i.meta?(i.keys.forEach(n=>{var a=this.pressedKeys.indexOf(n);a==-1&&(r=!1)}),r&&i.action.call(this,e),!0):!1}};Ve(wd,"moduleName","keybindings"),Ve(wd,"bindings",Ive),Ve(wd,"actions",yve);let E1=wd;class S7 extends ci{constructor(e){super(e),this.menuContainer=null,this.nestedMenuBlock=!1,this.currentComponent=null,this.rootPopup=null,this.columnSubscribers={},this.registerTableOption("rowContextMenu",!1),this.registerTableOption("rowClickMenu",!1),this.registerTableOption("rowDblClickMenu",!1),this.registerTableOption("groupContextMenu",!1),this.registerTableOption("groupClickMenu",!1),this.registerTableOption("groupDblClickMenu",!1),this.registerColumnOption("headerContextMenu"),this.registerColumnOption("headerClickMenu"),this.registerColumnOption("headerDblClickMenu"),this.registerColumnOption("headerMenu"),this.registerColumnOption("headerMenuIcon"),this.registerColumnOption("contextMenu"),this.registerColumnOption("clickMenu"),this.registerColumnOption("dblClickMenu")}initialize(){this.deprecatedOptionsCheck(),this.initializeRowWatchers(),this.initializeGroupWatchers(),this.subscribe("column-init",this.initializeColumn.bind(this))}deprecatedOptionsCheck(){}initializeRowWatchers(){this.table.options.rowContextMenu&&(this.subscribe("row-contextmenu",this.loadMenuEvent.bind(this,this.table.options.rowContextMenu)),this.table.on("rowTapHold",this.loadMenuEvent.bind(this,this.table.options.rowContextMenu))),this.table.options.rowClickMenu&&this.subscribe("row-click",this.loadMenuEvent.bind(this,this.table.options.rowClickMenu)),this.table.options.rowDblClickMenu&&this.subscribe("row-dblclick",this.loadMenuEvent.bind(this,this.table.options.rowDblClickMenu))}initializeGroupWatchers(){this.table.options.groupContextMenu&&(this.subscribe("group-contextmenu",this.loadMenuEvent.bind(this,this.table.options.groupContextMenu)),this.table.on("groupTapHold",this.loadMenuEvent.bind(this,this.table.options.groupContextMenu))),this.table.options.groupClickMenu&&this.subscribe("group-click",this.loadMenuEvent.bind(this,this.table.options.groupClickMenu)),this.table.options.groupDblClickMenu&&this.subscribe("group-dblclick",this.loadMenuEvent.bind(this,this.table.options.groupDblClickMenu))}initializeColumn(e){var i=e.definition;i.headerContextMenu&&!this.columnSubscribers.headerContextMenu&&(this.columnSubscribers.headerContextMenu=this.loadMenuTableColumnEvent.bind(this,"headerContextMenu"),this.subscribe("column-contextmenu",this.columnSubscribers.headerContextMenu),this.table.on("headerTapHold",this.loadMenuTableColumnEvent.bind(this,"headerContextMenu"))),i.headerClickMenu&&!this.columnSubscribers.headerClickMenu&&(this.columnSubscribers.headerClickMenu=this.loadMenuTableColumnEvent.bind(this,"headerClickMenu"),this.subscribe("column-click",this.columnSubscribers.headerClickMenu)),i.headerDblClickMenu&&!this.columnSubscribers.headerDblClickMenu&&(this.columnSubscribers.headerDblClickMenu=this.loadMenuTableColumnEvent.bind(this,"headerDblClickMenu"),this.subscribe("column-dblclick",this.columnSubscribers.headerDblClickMenu)),i.headerMenu&&this.initializeColumnHeaderMenu(e),i.contextMenu&&!this.columnSubscribers.contextMenu&&(this.columnSubscribers.contextMenu=this.loadMenuTableCellEvent.bind(this,"contextMenu"),this.subscribe("cell-contextmenu",this.columnSubscribers.contextMenu),this.table.on("cellTapHold",this.loadMenuTableCellEvent.bind(this,"contextMenu"))),i.clickMenu&&!this.columnSubscribers.clickMenu&&(this.columnSubscribers.clickMenu=this.loadMenuTableCellEvent.bind(this,"clickMenu"),this.subscribe("cell-click",this.columnSubscribers.clickMenu)),i.dblClickMenu&&!this.columnSubscribers.dblClickMenu&&(this.columnSubscribers.dblClickMenu=this.loadMenuTableCellEvent.bind(this,"dblClickMenu"),this.subscribe("cell-dblclick",this.columnSubscribers.dblClickMenu))}initializeColumnHeaderMenu(e){var i=e.definition.headerMenuIcon,r;r=document.createElement("span"),r.classList.add("tabulator-header-popup-button"),i?(typeof i=="function"&&(i=i(e.getComponent())),i instanceof HTMLElement?r.appendChild(i):r.innerHTML=i):r.innerHTML="&vellip;",r.addEventListener("click",n=>{n.stopPropagation(),n.preventDefault(),this.loadMenuEvent(e.definition.headerMenu,n,e)}),e.titleElement.insertBefore(r,e.titleElement.firstChild)}loadMenuTableCellEvent(e,i,r){r._cell&&(r=r._cell),r.column.definition[e]&&this.loadMenuEvent(r.column.definition[e],i,r)}loadMenuTableColumnEvent(e,i,r){r._column&&(r=r._column),r.definition[e]&&this.loadMenuEvent(r.definition[e],i,r)}loadMenuEvent(e,i,r){r._group?r=r._group:r._row&&(r=r._row),e=typeof e=="function"?e.call(this.table,i,r.getComponent()):e,this.loadMenu(i,r,e)}loadMenu(e,i,r,n,a){var o=!(e instanceof MouseEvent),s=document.createElement("div"),l;if(s.classList.add("tabulator-menu"),o||e.preventDefault(),!(!r||!r.length)){if(n)l=a.child(s);else{if(this.nestedMenuBlock){if(this.rootPopup)return}else this.nestedMenuBlock=setTimeout(()=>{this.nestedMenuBlock=!1},100);this.rootPopup&&this.rootPopup.hide(),this.rootPopup=l=this.popup(s)}r.forEach(u=>{var c=document.createElement("div"),d=u.label,p=u.disabled;u.separator?c.classList.add("tabulator-menu-separator"):(c.classList.add("tabulator-menu-item"),typeof d=="function"&&(d=d.call(this.table,i.getComponent())),d instanceof Node?c.appendChild(d):c.innerHTML=d,typeof p=="function"&&(p=p.call(this.table,i.getComponent())),p?(c.classList.add("tabulator-menu-item-disabled"),c.addEventListener("click",m=>{m.stopPropagation()})):u.menu&&u.menu.length?c.addEventListener("click",m=>{m.stopPropagation(),this.loadMenu(m,i,u.menu,c,l)}):u.action&&c.addEventListener("click",m=>{u.action(m,i.getComponent())}),u.menu&&u.menu.length&&c.classList.add("tabulator-menu-item-submenu")),s.appendChild(c)}),s.addEventListener("click",u=>{this.rootPopup&&this.rootPopup.hide()}),l.show(n||e),l===this.rootPopup&&(this.rootPopup.hideOnBlur(()=>{this.rootPopup=null,this.currentComponent&&(this.dispatch("menu-closed",r,l),this.dispatchExternal("menuClosed",this.currentComponent.getComponent()),this.currentComponent=null)}),this.currentComponent=i,this.dispatch("menu-opened",r,l),this.dispatchExternal("menuOpened",i.getComponent()))}}}Ve(S7,"moduleName","menu");class T7 extends ci{constructor(e){super(e),this.placeholderElement=this.createPlaceholderElement(),this.hoverElement=!1,this.checkTimeout=!1,this.checkPeriod=250,this.moving=!1,this.toCol=!1,this.toColAfter=!1,this.startX=0,this.autoScrollMargin=40,this.autoScrollStep=5,this.autoScrollTimeout=!1,this.touchMove=!1,this.moveHover=this.moveHover.bind(this),this.endMove=this.endMove.bind(this),this.registerTableOption("movableColumns",!1)}createPlaceholderElement(){var e=document.createElement("div");return e.classList.add("tabulator-col"),e.classList.add("tabulator-col-placeholder"),e}initialize(){this.table.options.movableColumns&&(this.subscribe("column-init",this.initializeColumn.bind(this)),this.subscribe("alert-show",this.abortMove.bind(this)))}abortMove(){clearTimeout(this.checkTimeout)}initializeColumn(e){var i=this,r={},n;!e.modules.frozen&&!e.isGroup&&!e.isRowHeader&&(n=e.getElement(),r.mousemove=(function(a){e.parent===i.moving.parent&&((i.touchMove?a.touches[0].pageX:a.pageX)-xr.elOffset(n).left+i.table.columnManager.contentsElement.scrollLeft>e.getWidth()/2?(i.toCol!==e||!i.toColAfter)&&(n.parentNode.insertBefore(i.placeholderElement,n.nextSibling),i.moveColumn(e,!0)):(i.toCol!==e||i.toColAfter)&&(n.parentNode.insertBefore(i.placeholderElement,n),i.moveColumn(e,!1)))}).bind(i),n.addEventListener("mousedown",function(a){i.touchMove=!1,a.which===1&&(i.checkTimeout=setTimeout(function(){i.startMove(a,e)},i.checkPeriod))}),n.addEventListener("mouseup",function(a){a.which===1&&i.checkTimeout&&clearTimeout(i.checkTimeout)}),i.bindTouchEvents(e)),e.modules.moveColumn=r}bindTouchEvents(e){var i=e.getElement(),r=!1,n,a,o,s,l,u;i.addEventListener("touchstart",c=>{this.checkTimeout=setTimeout(()=>{this.touchMove=!0,n=e.nextColumn(),o=n?n.getWidth()/2:0,a=e.prevColumn(),s=a?a.getWidth()/2:0,l=0,u=0,r=!1,this.startMove(c,e)},this.checkPeriod)},{passive:!0}),i.addEventListener("touchmove",c=>{var d,p;this.moving&&(this.moveHover(c),r||(r=c.touches[0].pageX),d=c.touches[0].pageX-r,d>0?n&&d-l>o&&(p=n,p!==e&&(r=c.touches[0].pageX,p.getElement().parentNode.insertBefore(this.placeholderElement,p.getElement().nextSibling),this.moveColumn(p,!0))):a&&-d-u>s&&(p=a,p!==e&&(r=c.touches[0].pageX,p.getElement().parentNode.insertBefore(this.placeholderElement,p.getElement()),this.moveColumn(p,!1))),p&&(n=p.nextColumn(),l=o,o=n?n.getWidth()/2:0,a=p.prevColumn(),u=s,s=a?a.getWidth()/2:0))},{passive:!0}),i.addEventListener("touchend",c=>{this.checkTimeout&&clearTimeout(this.checkTimeout),this.moving&&this.endMove(c)})}startMove(e,i){var r=i.getElement(),n=this.table.columnManager.getContentsElement(),a=this.table.columnManager.getHeadersElement();this.table.modules.selectRange&&this.table.modules.selectRange.columnSelection&&this.table.modules.selectRange.mousedown&&this.table.modules.selectRange.selecting==="column"||(this.moving=i,this.startX=(this.touchMove?e.touches[0].pageX:e.pageX)-xr.elOffset(r).left,this.table.element.classList.add("tabulator-block-select"),this.placeholderElement.style.width=i.getWidth()+"px",this.placeholderElement.style.height=i.getHeight()+"px",r.parentNode.insertBefore(this.placeholderElement,r),r.parentNode.removeChild(r),this.hoverElement=r.cloneNode(!0),this.hoverElement.classList.add("tabulator-moving"),n.appendChild(this.hoverElement),this.hoverElement.style.left="0",this.hoverElement.style.bottom=n.clientHeight-a.offsetHeight+"px",this.touchMove||(this._bindMouseMove(),document.body.addEventListener("mousemove",this.moveHover),document.body.addEventListener("mouseup",this.endMove)),this.moveHover(e),this.dispatch("column-moving",e,this.moving))}_bindMouseMove(){this.table.columnManager.columnsByIndex.forEach(function(e){e.modules.moveColumn.mousemove&&e.getElement().addEventListener("mousemove",e.modules.moveColumn.mousemove)})}_unbindMouseMove(){this.table.columnManager.columnsByIndex.forEach(function(e){e.modules.moveColumn.mousemove&&e.getElement().removeEventListener("mousemove",e.modules.moveColumn.mousemove)})}moveColumn(e,i){var r=this.moving.getCells();this.toCol=e,this.toColAfter=i,i?e.getCells().forEach(function(n,a){var o=n.getElement(!0);o.parentNode&&r[a]&&o.parentNode.insertBefore(r[a].getElement(),o.nextSibling)}):e.getCells().forEach(function(n,a){var o=n.getElement(!0);o.parentNode&&r[a]&&o.parentNode.insertBefore(r[a].getElement(),o)})}endMove(e){(e.which===1||this.touchMove)&&(this._unbindMouseMove(),this.placeholderElement.parentNode.insertBefore(this.moving.getElement(),this.placeholderElement.nextSibling),this.placeholderElement.parentNode.removeChild(this.placeholderElement),this.hoverElement.parentNode.removeChild(this.hoverElement),this.table.element.classList.remove("tabulator-block-select"),this.toCol&&this.table.columnManager.moveColumnActual(this.moving,this.toCol,this.toColAfter),this.moving=!1,this.toCol=!1,this.toColAfter=!1,this.touchMove||(document.body.removeEventListener("mousemove",this.moveHover),document.body.removeEventListener("mouseup",this.endMove)))}moveHover(e){var i=this.table.columnManager.getContentsElement(),r=i.scrollLeft,n=(this.touchMove?e.touches[0].pageX:e.pageX)-xr.elOffset(i).left+r,a;this.hoverElement.style.left=n-this.startX+"px",n-r<this.autoScrollMargin&&(this.autoScrollTimeout||(this.autoScrollTimeout=setTimeout(()=>{a=Math.max(0,r-5),this.table.rowManager.getElement().scrollLeft=a,this.autoScrollTimeout=!1},1))),r+i.clientWidth-n<this.autoScrollMargin&&(this.autoScrollTimeout||(this.autoScrollTimeout=setTimeout(()=>{a=Math.min(i.clientWidth,r+5),this.table.rowManager.getElement().scrollLeft=a,this.autoScrollTimeout=!1},1)))}}Ve(T7,"moduleName","moveColumn");var bve={delete:function(t,e,i){t.delete()}},wve={insert:function(t,e,i){return this.table.addRow(t.getData(),void 0,e),!0},add:function(t,e,i){return this.table.addRow(t.getData()),!0},update:function(t,e,i){return e?(e.update(t.getData()),!0):!1},replace:function(t,e,i){return e?(this.table.addRow(t.getData(),void 0,e),e.delete(),!0):!1}};const Hp=class Hp extends ci{constructor(e){super(e),this.placeholderElement=this.createPlaceholderElement(),this.hoverElement=!1,this.checkTimeout=!1,this.checkPeriod=150,this.moving=!1,this.toRow=!1,this.toRowAfter=!1,this.hasHandle=!1,this.startY=0,this.startX=0,this.moveHover=this.moveHover.bind(this),this.endMove=this.endMove.bind(this),this.tableRowDropEvent=!1,this.touchMove=!1,this.connection=!1,this.connectionSelectorsTables=!1,this.connectionSelectorsElements=!1,this.connectionElements=[],this.connections=[],this.connectedTable=!1,this.connectedRow=!1,this.registerTableOption("movableRows",!1),this.registerTableOption("movableRowsConnectedTables",!1),this.registerTableOption("movableRowsConnectedElements",!1),this.registerTableOption("movableRowsSender",!1),this.registerTableOption("movableRowsReceiver","insert"),this.registerColumnOption("rowHandle")}createPlaceholderElement(){var e=document.createElement("div");return e.classList.add("tabulator-row"),e.classList.add("tabulator-row-placeholder"),e}initialize(){this.table.options.movableRows&&(this.connectionSelectorsTables=this.table.options.movableRowsConnectedTables,this.connectionSelectorsElements=this.table.options.movableRowsConnectedElements,this.connection=this.connectionSelectorsTables||this.connectionSelectorsElements,this.subscribe("cell-init",this.initializeCell.bind(this)),this.subscribe("column-init",this.initializeColumn.bind(this)),this.subscribe("row-init",this.initializeRow.bind(this)))}initializeGroupHeader(e){var i=this,r={};r.mouseup=(function(n){i.tableRowDrop(n,e)}).bind(i),r.mousemove=(function(n){var a;n.pageY-xr.elOffset(e.element).top+i.table.rowManager.element.scrollTop>e.getHeight()/2?(i.toRow!==e||!i.toRowAfter)&&(a=e.getElement(),a.parentNode.insertBefore(i.placeholderElement,a.nextSibling),i.moveRow(e,!0)):(i.toRow!==e||i.toRowAfter)&&(a=e.getElement(),a.previousSibling&&(a.parentNode.insertBefore(i.placeholderElement,a),i.moveRow(e,!1)))}).bind(i),e.modules.moveRow=r}initializeRow(e){var i=this,r={},n;r.mouseup=(function(a){i.tableRowDrop(a,e)}).bind(i),r.mousemove=(function(a){var o=e.getElement();a.pageY-xr.elOffset(o).top+i.table.rowManager.element.scrollTop>e.getHeight()/2?(i.toRow!==e||!i.toRowAfter)&&(o.parentNode.insertBefore(i.placeholderElement,o.nextSibling),i.moveRow(e,!0)):(i.toRow!==e||i.toRowAfter)&&(o.parentNode.insertBefore(i.placeholderElement,o),i.moveRow(e,!1))}).bind(i),this.hasHandle||(n=e.getElement(),n.addEventListener("mousedown",function(a){a.which===1&&(i.checkTimeout=setTimeout(function(){i.startMove(a,e)},i.checkPeriod))}),n.addEventListener("mouseup",function(a){a.which===1&&i.checkTimeout&&clearTimeout(i.checkTimeout)}),this.bindTouchEvents(e,e.getElement())),e.modules.moveRow=r}initializeColumn(e){e.definition.rowHandle&&this.table.options.movableRows!==!1&&(this.hasHandle=!0)}initializeCell(e){if(e.column.definition.rowHandle&&this.table.options.movableRows!==!1){var i=this,r=e.getElement(!0);r.addEventListener("mousedown",function(n){n.which===1&&(i.checkTimeout=setTimeout(function(){i.startMove(n,e.row)},i.checkPeriod))}),r.addEventListener("mouseup",function(n){n.which===1&&i.checkTimeout&&clearTimeout(i.checkTimeout)}),this.bindTouchEvents(e.row,r)}}bindTouchEvents(e,i){var r=!1,n,a,o,s,l,u;i.addEventListener("touchstart",c=>{this.checkTimeout=setTimeout(()=>{this.touchMove=!0,n=e.nextRow(),o=n?n.getHeight()/2:0,a=e.prevRow(),s=a?a.getHeight()/2:0,l=0,u=0,r=!1,this.startMove(c,e)},this.checkPeriod)},{passive:!0}),this.moving,this.toRow,this.toRowAfter,i.addEventListener("touchmove",c=>{var d,p;this.moving&&(c.preventDefault(),this.moveHover(c),r||(r=c.touches[0].pageY),d=c.touches[0].pageY-r,d>0?n&&d-l>o&&(p=n,p!==e&&(r=c.touches[0].pageY,p.getElement().parentNode.insertBefore(this.placeholderElement,p.getElement().nextSibling),this.moveRow(p,!0))):a&&-d-u>s&&(p=a,p!==e&&(r=c.touches[0].pageY,p.getElement().parentNode.insertBefore(this.placeholderElement,p.getElement()),this.moveRow(p,!1))),p&&(n=p.nextRow(),l=o,o=n?n.getHeight()/2:0,a=p.prevRow(),u=s,s=a?a.getHeight()/2:0))}),i.addEventListener("touchend",c=>{this.checkTimeout&&clearTimeout(this.checkTimeout),this.moving&&(this.endMove(c),this.touchMove=!1)})}_bindMouseMove(){this.table.rowManager.getDisplayRows().forEach(e=>{(e.type==="row"||e.type==="group")&&e.modules.moveRow&&e.modules.moveRow.mousemove&&e.getElement().addEventListener("mousemove",e.modules.moveRow.mousemove)})}_unbindMouseMove(){this.table.rowManager.getDisplayRows().forEach(e=>{(e.type==="row"||e.type==="group")&&e.modules.moveRow&&e.modules.moveRow.mousemove&&e.getElement().removeEventListener("mousemove",e.modules.moveRow.mousemove)})}startMove(e,i){var r=i.getElement();this.setStartPosition(e,i),this.moving=i,this.table.element.classList.add("tabulator-block-select"),this.placeholderElement.style.width=i.getWidth()+"px",this.placeholderElement.style.height=i.getHeight()+"px",this.connection?(this.table.element.classList.add("tabulator-movingrow-sending"),this.connectToTables(i)):(r.parentNode.insertBefore(this.placeholderElement,r),r.parentNode.removeChild(r)),this.hoverElement=r.cloneNode(!0),this.hoverElement.classList.add("tabulator-moving"),this.connection?(document.body.appendChild(this.hoverElement),this.hoverElement.style.left="0",this.hoverElement.style.top="0",this.hoverElement.style.width=this.table.element.clientWidth+"px",this.hoverElement.style.whiteSpace="nowrap",this.hoverElement.style.overflow="hidden",this.hoverElement.style.pointerEvents="none"):(this.table.rowManager.getTableElement().appendChild(this.hoverElement),this.hoverElement.style.left="0",this.hoverElement.style.top="0",this._bindMouseMove()),document.body.addEventListener("mousemove",this.moveHover),document.body.addEventListener("mouseup",this.endMove),this.dispatchExternal("rowMoving",i.getComponent()),this.moveHover(e)}setStartPosition(e,i){var r=this.touchMove?e.touches[0].pageX:e.pageX,n=this.touchMove?e.touches[0].pageY:e.pageY,a,o;a=i.getElement(),this.connection?(o=a.getBoundingClientRect(),this.startX=o.left-r+window.pageXOffset,this.startY=o.top-n+window.pageYOffset):this.startY=n-a.getBoundingClientRect().top}endMove(e){(!e||e.which===1||this.touchMove)&&(this._unbindMouseMove(),this.connection||(this.placeholderElement.parentNode.insertBefore(this.moving.getElement(),this.placeholderElement.nextSibling),this.placeholderElement.parentNode.removeChild(this.placeholderElement)),this.hoverElement.parentNode.removeChild(this.hoverElement),this.table.element.classList.remove("tabulator-block-select"),this.toRow?this.table.rowManager.moveRow(this.moving,this.toRow,this.toRowAfter):this.dispatchExternal("rowMoveCancelled",this.moving.getComponent()),this.moving=!1,this.toRow=!1,this.toRowAfter=!1,document.body.removeEventListener("mousemove",this.moveHover),document.body.removeEventListener("mouseup",this.endMove),this.connection&&(this.table.element.classList.remove("tabulator-movingrow-sending"),this.disconnectFromTables()))}moveRow(e,i){this.toRow=e,this.toRowAfter=i}moveHover(e){this.connection?this.moveHoverConnections.call(this,e):this.moveHoverTable.call(this,e)}moveHoverTable(e){var i=this.table.rowManager.getElement(),r=i.scrollTop,n=(this.touchMove?e.touches[0].pageY:e.pageY)-i.getBoundingClientRect().top+r;this.hoverElement.style.top=Math.min(n-this.startY,this.table.rowManager.element.scrollHeight-this.hoverElement.offsetHeight)+"px"}moveHoverConnections(e){this.hoverElement.style.left=this.startX+(this.touchMove?e.touches[0].pageX:e.pageX)+"px",this.hoverElement.style.top=this.startY+(this.touchMove?e.touches[0].pageY:e.pageY)+"px"}elementRowDrop(e,i,r){this.dispatchExternal("movableRowsElementDrop",e,i,r?r.getComponent():!1)}connectToTables(e){var i;this.connectionSelectorsTables&&(i=this.commsConnections(this.connectionSelectorsTables),this.dispatchExternal("movableRowsSendingStart",i),this.commsSend(this.connectionSelectorsTables,"moveRow","connect",{row:e})),this.connectionSelectorsElements&&(this.connectionElements=[],Array.isArray(this.connectionSelectorsElements)||(this.connectionSelectorsElements=[this.connectionSelectorsElements]),this.connectionSelectorsElements.forEach(r=>{typeof r=="string"?this.connectionElements=this.connectionElements.concat(Array.prototype.slice.call(document.querySelectorAll(r))):this.connectionElements.push(r)}),this.connectionElements.forEach(r=>{var n=a=>{this.elementRowDrop(a,r,this.moving)};r.addEventListener("mouseup",n),r.tabulatorElementDropEvent=n,r.classList.add("tabulator-movingrow-receiving")}))}disconnectFromTables(){var e;this.connectionSelectorsTables&&(e=this.commsConnections(this.connectionSelectorsTables),this.dispatchExternal("movableRowsSendingStop",e),this.commsSend(this.connectionSelectorsTables,"moveRow","disconnect")),this.connectionElements.forEach(i=>{i.classList.remove("tabulator-movingrow-receiving"),i.removeEventListener("mouseup",i.tabulatorElementDropEvent),delete i.tabulatorElementDropEvent})}connect(e,i){return this.connectedTable?(console.warn("Move Row Error - Table cannot accept connection, already connected to table:",this.connectedTable),!1):(this.connectedTable=e,this.connectedRow=i,this.table.element.classList.add("tabulator-movingrow-receiving"),this.table.rowManager.getDisplayRows().forEach(r=>{r.type==="row"&&r.modules.moveRow&&r.modules.moveRow.mouseup&&r.getElement().addEventListener("mouseup",r.modules.moveRow.mouseup)}),this.tableRowDropEvent=this.tableRowDrop.bind(this),this.table.element.addEventListener("mouseup",this.tableRowDropEvent),this.dispatchExternal("movableRowsReceivingStart",i,e),!0)}disconnect(e){e===this.connectedTable?(this.connectedTable=!1,this.connectedRow=!1,this.table.element.classList.remove("tabulator-movingrow-receiving"),this.table.rowManager.getDisplayRows().forEach(i=>{i.type==="row"&&i.modules.moveRow&&i.modules.moveRow.mouseup&&i.getElement().removeEventListener("mouseup",i.modules.moveRow.mouseup)}),this.table.element.removeEventListener("mouseup",this.tableRowDropEvent),this.dispatchExternal("movableRowsReceivingStop",e)):console.warn("Move Row Error - trying to disconnect from non connected table")}dropComplete(e,i,r){var n=!1;if(r){switch(typeof this.table.options.movableRowsSender){case"string":n=Hp.senders[this.table.options.movableRowsSender];break;case"function":n=this.table.options.movableRowsSender;break}n?n.call(this,this.moving?this.moving.getComponent():void 0,i?i.getComponent():void 0,e):this.table.options.movableRowsSender&&console.warn("Mover Row Error - no matching sender found:",this.table.options.movableRowsSender),this.dispatchExternal("movableRowsSent",this.moving.getComponent(),i?i.getComponent():void 0,e)}else this.dispatchExternal("movableRowsSentFailed",this.moving.getComponent(),i?i.getComponent():void 0,e);this.endMove()}tableRowDrop(e,i){var r=!1,n=!1;switch(e.stopImmediatePropagation(),typeof this.table.options.movableRowsReceiver){case"string":r=Hp.receivers[this.table.options.movableRowsReceiver];break;case"function":r=this.table.options.movableRowsReceiver;break}r?n=r.call(this,this.connectedRow.getComponent(),i?i.getComponent():void 0,this.connectedTable):console.warn("Mover Row Error - no matching receiver found:",this.table.options.movableRowsReceiver),n?this.dispatchExternal("movableRowsReceived",this.connectedRow.getComponent(),i?i.getComponent():void 0,this.connectedTable):this.dispatchExternal("movableRowsReceivedFailed",this.connectedRow.getComponent(),i?i.getComponent():void 0,this.connectedTable),this.commsSend(this.connectedTable,"moveRow","dropcomplete",{row:i,success:n})}commsReceived(e,i,r){switch(i){case"connect":return this.connect(e,r.row);case"disconnect":return this.disconnect(e);case"dropcomplete":return this.dropComplete(e,r.row,r.success)}}};Ve(Hp,"moduleName","moveRow"),Ve(Hp,"senders",bve),Ve(Hp,"receivers",wve);let C1=Hp;var Uve={};const ff=class ff extends ci{constructor(e){super(e),this.allowedTypes=["","data","edit","clipboard"],this.enabled=!0,this.registerColumnOption("mutator"),this.registerColumnOption("mutatorParams"),this.registerColumnOption("mutatorData"),this.registerColumnOption("mutatorDataParams"),this.registerColumnOption("mutatorEdit"),this.registerColumnOption("mutatorEditParams"),this.registerColumnOption("mutatorClipboard"),this.registerColumnOption("mutatorClipboardParams"),this.registerColumnOption("mutateLink")}initialize(){this.subscribe("cell-value-changing",this.transformCell.bind(this)),this.subscribe("cell-value-changed",this.mutateLink.bind(this)),this.subscribe("column-layout",this.initializeColumn.bind(this)),this.subscribe("row-data-init-before",this.rowDataChanged.bind(this)),this.subscribe("row-data-changing",this.rowDataChanged.bind(this))}rowDataChanged(e,i,r){return this.transformRow(i,"data",r)}initializeColumn(e){var i=!1,r={};this.allowedTypes.forEach(n=>{var a="mutator"+(n.charAt(0).toUpperCase()+n.slice(1)),o;e.definition[a]&&(o=this.lookupMutator(e.definition[a]),o&&(i=!0,r[a]={mutator:o,params:e.definition[a+"Params"]||{}}))}),i&&(e.modules.mutate=r)}lookupMutator(e){var i=!1;switch(typeof e){case"string":ff.mutators[e]?i=ff.mutators[e]:console.warn("Mutator Error - No such mutator found, ignoring: ",e);break;case"function":i=e;break}return i}transformRow(e,i,r){var n="mutator"+(i.charAt(0).toUpperCase()+i.slice(1)),a;return this.enabled&&this.table.columnManager.traverse(o=>{var s,l,u;o.modules.mutate&&(s=o.modules.mutate[n]||o.modules.mutate.mutator||!1,s&&(a=o.getFieldValue(typeof r<"u"?r:e),(i=="data"&&!r||typeof a<"u")&&(u=o.getComponent(),l=typeof s.params=="function"?s.params(a,e,i,u):s.params,o.setFieldValue(e,s.mutator(a,e,i,l,u)))))}),e}transformCell(e,i){if(e.column.modules.mutate){var r=e.column.modules.mutate.mutatorEdit||e.column.modules.mutate.mutator||!1,n={};if(r)return n=Object.assign(n,e.row.getData()),e.column.setFieldValue(n,i),r.mutator(i,n,"edit",r.params,e.getComponent())}return i}mutateLink(e){var i=e.column.definition.mutateLink;i&&(Array.isArray(i)||(i=[i]),i.forEach(r=>{var n=e.row.getCell(r);n&&n.setValue(n.getValue(),!0,!0)}))}enable(){this.enabled=!0}disable(){this.enabled=!1}};Ve(ff,"moduleName","mutator"),Ve(ff,"mutators",Uve);let M1=ff;function Sve(t,e,i,r,n){var a=document.createElement("span"),o=document.createElement("span"),s=document.createElement("span"),l=document.createElement("span"),u=document.createElement("span"),c=document.createElement("span");return this.table.modules.localize.langBind("pagination|counter|showing",d=>{o.innerHTML=d}),this.table.modules.localize.langBind("pagination|counter|of",d=>{l.innerHTML=d}),this.table.modules.localize.langBind("pagination|counter|rows",d=>{c.innerHTML=d}),r?(s.innerHTML=" "+e+"-"+Math.min(e+t-1,r)+" ",u.innerHTML=" "+r+" ",a.appendChild(o),a.appendChild(s),a.appendChild(l),a.appendChild(u),a.appendChild(c)):(s.innerHTML=" 0 ",a.appendChild(o),a.appendChild(s),a.appendChild(c)),a}function Tve(t,e,i,r,n){var a=document.createElement("span"),o=document.createElement("span"),s=document.createElement("span"),l=document.createElement("span"),u=document.createElement("span"),c=document.createElement("span");return this.table.modules.localize.langBind("pagination|counter|showing",d=>{o.innerHTML=d}),s.innerHTML=" "+i+" ",this.table.modules.localize.langBind("pagination|counter|of",d=>{l.innerHTML=d}),u.innerHTML=" "+n+" ",this.table.modules.localize.langBind("pagination|counter|pages",d=>{c.innerHTML=d}),a.appendChild(o),a.appendChild(s),a.appendChild(l),a.appendChild(u),a.appendChild(c),a}var Dve={rows:Sve,pages:Tve};const fI=class fI extends ci{constructor(e){super(e),this.mode="local",this.progressiveLoad=!1,this.element=null,this.pageCounterElement=null,this.pageCounter=null,this.size=0,this.page=1,this.count=5,this.max=1,this.remoteRowCountEstimate=null,this.initialLoad=!0,this.dataChanging=!1,this.pageSizes=[],this.registerTableOption("pagination",!1),this.registerTableOption("paginationMode","local"),this.registerTableOption("paginationSize",!1),this.registerTableOption("paginationInitialPage",1),this.registerTableOption("paginationCounter",!1),this.registerTableOption("paginationCounterElement",!1),this.registerTableOption("paginationButtonCount",5),this.registerTableOption("paginationSizeSelector",!1),this.registerTableOption("paginationElement",!1),this.registerTableOption("paginationAddRow","page"),this.registerTableOption("progressiveLoad",!1),this.registerTableOption("progressiveLoadDelay",0),this.registerTableOption("progressiveLoadScrollMargin",0),this.registerTableFunction("setMaxPage",this.setMaxPage.bind(this)),this.registerTableFunction("setPage",this.setPage.bind(this)),this.registerTableFunction("setPageToRow",this.userSetPageToRow.bind(this)),this.registerTableFunction("setPageSize",this.userSetPageSize.bind(this)),this.registerTableFunction("getPageSize",this.getPageSize.bind(this)),this.registerTableFunction("previousPage",this.previousPage.bind(this)),this.registerTableFunction("nextPage",this.nextPage.bind(this)),this.registerTableFunction("getPage",this.getPage.bind(this)),this.registerTableFunction("getPageMax",this.getPageMax.bind(this)),this.registerComponentFunction("row","pageTo",this.setPageToRow.bind(this))}initialize(){this.table.options.pagination?(this.subscribe("row-deleted",this.rowsUpdated.bind(this)),this.subscribe("row-added",this.rowsUpdated.bind(this)),this.subscribe("data-processed",this.initialLoadComplete.bind(this)),this.subscribe("table-built",this.calculatePageSizes.bind(this)),this.subscribe("footer-redraw",this.footerRedraw.bind(this)),this.table.options.paginationAddRow=="page"&&this.subscribe("row-adding-position",this.rowAddingPosition.bind(this)),this.table.options.paginationMode==="remote"&&(this.subscribe("data-params",this.remotePageParams.bind(this)),this.subscribe("data-loaded",this._parseRemoteData.bind(this))),this.table.options.progressiveLoad&&console.error("Progressive Load Error - Pagination and progressive load cannot be used at the same time"),this.registerDisplayHandler(this.restOnRenderBefore.bind(this),40),this.registerDisplayHandler(this.getRows.bind(this),50),this.createElements(),this.initializePageCounter(),this.initializePaginator()):this.table.options.progressiveLoad&&(this.subscribe("data-params",this.remotePageParams.bind(this)),this.subscribe("data-loaded",this._parseRemoteData.bind(this)),this.subscribe("table-built",this.calculatePageSizes.bind(this)),this.subscribe("data-processed",this.initialLoadComplete.bind(this)),this.initializeProgressive(this.table.options.progressiveLoad),this.table.options.progressiveLoad==="scroll"&&this.subscribe("scroll-vertical",this.scrollVertical.bind(this)))}rowAddingPosition(e,i){var r=this.table.rowManager,n=r.getDisplayRows(),a;return i?n.length?a=n[0]:r.activeRows.length&&(a=r.activeRows[r.activeRows.length-1],i=!1):n.length&&(a=n[n.length-1],i=!(n.length<this.size)),{index:a,top:i}}calculatePageSizes(){var e,i;this.table.options.paginationSize?this.size=this.table.options.paginationSize:(e=document.createElement("div"),e.classList.add("tabulator-row"),e.style.visibility="hidden",i=document.createElement("div"),i.classList.add("tabulator-cell"),i.innerHTML="Page Row Test",e.appendChild(i),this.table.rowManager.getTableElement().appendChild(e),this.size=Math.floor(this.table.rowManager.getElement().clientHeight/e.offsetHeight),this.table.rowManager.getTableElement().removeChild(e)),this.dispatchExternal("pageSizeChanged",this.size),this.generatePageSizeSelectList()}initialLoadComplete(){this.initialLoad=!1}remotePageParams(e,i,r,n){return this.initialLoad||(this.progressiveLoad&&!r||!this.progressiveLoad&&!this.dataChanging)&&this.reset(!0),n.page=this.page,this.size&&(n.size=this.size),n}userSetPageToRow(e){return this.table.options.pagination&&(e=this.table.rowManager.findRow(e),e)?this.setPageToRow(e):Promise.reject()}userSetPageSize(e){return this.table.options.pagination?(this.setPageSize(e),this.setPage(1)):!1}scrollVertical(e,i){var r,n,a;!i&&!this.table.dataLoader.loading&&(r=this.table.rowManager.getElement(),n=r.scrollHeight-r.clientHeight-e,a=this.table.options.progressiveLoadScrollMargin||r.clientHeight*2,n<a&&this.nextPage().catch(()=>{}))}restOnRenderBefore(e,i){return i||this.mode==="local"&&this.reset(),e}rowsUpdated(){this.refreshData(!0,"all")}createElements(){var e;this.element=document.createElement("span"),this.element.classList.add("tabulator-paginator"),this.pagesElement=document.createElement("span"),this.pagesElement.classList.add("tabulator-pages"),e=document.createElement("button"),e.classList.add("tabulator-page"),e.setAttribute("type","button"),e.setAttribute("role","button"),e.setAttribute("aria-label",""),e.setAttribute("title",""),this.firstBut=e.cloneNode(!0),this.firstBut.setAttribute("data-page","first"),this.prevBut=e.cloneNode(!0),this.prevBut.setAttribute("data-page","prev"),this.nextBut=e.cloneNode(!0),this.nextBut.setAttribute("data-page","next"),this.lastBut=e.cloneNode(!0),this.lastBut.setAttribute("data-page","last"),this.table.options.paginationSizeSelector&&(this.pageSizeSelect=document.createElement("select"),this.pageSizeSelect.classList.add("tabulator-page-size"))}generatePageSizeSelectList(){var e=[];if(this.pageSizeSelect){if(Array.isArray(this.table.options.paginationSizeSelector))e=this.table.options.paginationSizeSelector,this.pageSizes=e,this.pageSizes.indexOf(this.size)==-1&&e.unshift(this.size);else if(this.pageSizes.indexOf(this.size)==-1){e=[];for(let i=1;i<5;i++)e.push(this.size*i);this.pageSizes=e}else e=this.pageSizes;for(;this.pageSizeSelect.firstChild;)this.pageSizeSelect.removeChild(this.pageSizeSelect.firstChild);e.forEach(i=>{var r=document.createElement("option");r.value=i,i===!0?this.langBind("pagination|all",function(n){r.innerHTML=n}):r.innerHTML=i,this.pageSizeSelect.appendChild(r)}),this.pageSizeSelect.value=this.size}}initializePageCounter(){var e=this.table.options.paginationCounter,i=null;e&&(typeof e=="function"?i=e:i=fI.pageCounters[e],i?(this.pageCounter=i,this.pageCounterElement=document.createElement("span"),this.pageCounterElement.classList.add("tabulator-page-counter")):console.warn("Pagination Error - No such page counter found: ",e))}initializePaginator(e){var i,r;e||(this.langBind("pagination|first",n=>{this.firstBut.innerHTML=n}),this.langBind("pagination|first_title",n=>{this.firstBut.setAttribute("aria-label",n),this.firstBut.setAttribute("title",n)}),this.langBind("pagination|prev",n=>{this.prevBut.innerHTML=n}),this.langBind("pagination|prev_title",n=>{this.prevBut.setAttribute("aria-label",n),this.prevBut.setAttribute("title",n)}),this.langBind("pagination|next",n=>{this.nextBut.innerHTML=n}),this.langBind("pagination|next_title",n=>{this.nextBut.setAttribute("aria-label",n),this.nextBut.setAttribute("title",n)}),this.langBind("pagination|last",n=>{this.lastBut.innerHTML=n}),this.langBind("pagination|last_title",n=>{this.lastBut.setAttribute("aria-label",n),this.lastBut.setAttribute("title",n)}),this.firstBut.addEventListener("click",()=>{this.setPage(1)}),this.prevBut.addEventListener("click",()=>{this.previousPage()}),this.nextBut.addEventListener("click",()=>{this.nextPage()}),this.lastBut.addEventListener("click",()=>{this.setPage(this.max)}),this.table.options.paginationElement&&(this.element=this.table.options.paginationElement),this.pageSizeSelect&&(i=document.createElement("label"),this.langBind("pagination|page_size",n=>{this.pageSizeSelect.setAttribute("aria-label",n),this.pageSizeSelect.setAttribute("title",n),i.innerHTML=n}),this.element.appendChild(i),this.element.appendChild(this.pageSizeSelect),this.pageSizeSelect.addEventListener("change",n=>{this.setPageSize(this.pageSizeSelect.value=="true"?!0:this.pageSizeSelect.value),this.setPage(1)})),this.element.appendChild(this.firstBut),this.element.appendChild(this.prevBut),this.element.appendChild(this.pagesElement),this.element.appendChild(this.nextBut),this.element.appendChild(this.lastBut),this.table.options.paginationElement||(this.table.options.paginationCounter&&(this.table.options.paginationCounterElement?this.table.options.paginationCounterElement instanceof HTMLElement?this.table.options.paginationCounterElement.appendChild(this.pageCounterElement):typeof this.table.options.paginationCounterElement=="string"&&(r=document.querySelector(this.table.options.paginationCounterElement),r?r.appendChild(this.pageCounterElement):console.warn("Pagination Error - Unable to find element matching paginationCounterElement selector:",this.table.options.paginationCounterElement)):this.footerAppend(this.pageCounterElement)),this.footerAppend(this.element)),this.page=this.table.options.paginationInitialPage,this.count=this.table.options.paginationButtonCount),this.mode=this.table.options.paginationMode}initializeProgressive(e){this.initializePaginator(!0),this.mode="progressive_"+e,this.progressiveLoad=!0}trackChanges(){this.dispatch("page-changed")}setMaxRows(e){e?this.max=this.size===!0?1:Math.ceil(e/this.size):this.max=1,this.page>this.max&&(this.page=this.max)}reset(e){this.initialLoad||(this.mode=="local"||e)&&(this.page=1,this.trackChanges())}setMaxPage(e){e=parseInt(e),this.max=e||1,this.page>this.max&&(this.page=this.max,this.trigger())}setPage(e){switch(e){case"first":return this.setPage(1);case"prev":return this.previousPage();case"next":return this.nextPage();case"last":return this.setPage(this.max)}return e=parseInt(e),e>0&&e<=this.max||this.mode!=="local"?(this.page=e,this.trackChanges(),this.trigger()):(console.warn("Pagination Error - Requested page is out of range of 1 - "+this.max+":",e),Promise.reject())}setPageToRow(e){var i=this.displayRows(-1),r=i.indexOf(e);if(r>-1){var n=this.size===!0?1:Math.ceil((r+1)/this.size);return this.setPage(n)}else return console.warn("Pagination Error - Requested row is not visible"),Promise.reject()}setPageSize(e){e!==!0&&(e=parseInt(e)),e>0&&(this.size=e,this.dispatchExternal("pageSizeChanged",e)),this.pageSizeSelect&&this.generatePageSizeSelectList(),this.trackChanges()}_setPageCounter(e,i,r){var n;if(this.pageCounter)switch(this.mode==="remote"&&(i=this.size,r=(this.page-1)*this.size+1,e=this.remoteRowCountEstimate),n=this.pageCounter.call(this,i,r,this.page,e,this.max),typeof n){case"object":if(n instanceof Node){for(;this.pageCounterElement.firstChild;)this.pageCounterElement.removeChild(this.pageCounterElement.firstChild);this.pageCounterElement.appendChild(n)}else this.pageCounterElement.innerHTML="",n!=null&&console.warn("Page Counter Error - Page Counter has returned a type of object, the only valid page counter object return is an instance of Node, the page counter returned:",n);break;case"undefined":this.pageCounterElement.innerHTML="";break;default:this.pageCounterElement.innerHTML=n}}_setPageButtons(){let e=Math.floor((this.count-1)/2),i=Math.ceil((this.count-1)/2),r=this.max-this.page+e+1<this.count?this.max-this.count+1:Math.max(this.page-e,1),n=this.page<=i?Math.min(this.count,this.max):Math.min(this.page+i,this.max);for(;this.pagesElement.firstChild;)this.pagesElement.removeChild(this.pagesElement.firstChild);this.page==1?(this.firstBut.disabled=!0,this.prevBut.disabled=!0):(this.firstBut.disabled=!1,this.prevBut.disabled=!1),this.page==this.max?(this.lastBut.disabled=!0,this.nextBut.disabled=!0):(this.lastBut.disabled=!1,this.nextBut.disabled=!1);for(let a=r;a<=n;a++)a>0&&a<=this.max&&this.pagesElement.appendChild(this._generatePageButton(a));this.footerRedraw()}_generatePageButton(e){var i=document.createElement("button");return i.classList.add("tabulator-page"),e==this.page&&i.classList.add("active"),i.setAttribute("type","button"),i.setAttribute("role","button"),this.langBind("pagination|page_title",r=>{i.setAttribute("aria-label",r+" "+e),i.setAttribute("title",r+" "+e)}),i.setAttribute("data-page",e),i.textContent=e,i.addEventListener("click",r=>{this.setPage(e)}),i}previousPage(){return this.page>1?(this.page--,this.trackChanges(),this.trigger()):(console.warn("Pagination Error - Previous page would be less than page 1:",0),Promise.reject())}nextPage(){return this.page<this.max?(this.page++,this.trackChanges(),this.trigger()):(this.progressiveLoad||console.warn("Pagination Error - Next page would be greater than maximum page of "+this.max+":",this.max+1),Promise.reject())}getPage(){return this.page}getPageMax(){return this.max}getPageSize(e){return this.size}getMode(){return this.mode}getRows(e){var i=0,r,n,a,o,s=e.filter(l=>l.type==="row");if(this.mode=="local"){r=[],this.setMaxRows(e.length),this.size===!0?(n=0,a=e.length):(n=this.size*(this.page-1),a=n+parseInt(this.size)),this._setPageButtons();for(let l=n;l<a;l++){let u=e[l];u&&(r.push(u),u.type==="row"&&(o||(o=u),i++))}return this._setPageCounter(s.length,i,o?s.indexOf(o)+1:0),r}else return this._setPageButtons(),this._setPageCounter(s.length),e.slice(0)}trigger(){var e;switch(this.mode){case"local":return e=this.table.rowManager.scrollLeft,this.refreshData(),this.table.rowManager.scrollHorizontal(e),this.dispatchExternal("pageLoaded",this.getPage()),Promise.resolve();case"remote":return this.dataChanging=!0,this.reloadData(null).finally(()=>{this.dataChanging=!1});case"progressive_load":case"progressive_scroll":return this.reloadData(null,!0);default:return console.warn("Pagination Error - no such pagination mode:",this.mode),Promise.reject()}}_parseRemoteData(e){var i;if(typeof e.last_page>"u"&&console.warn("Remote Pagination Error - Server response missing '"+(this.options("dataReceiveParams").last_page||"last_page")+"' property"),e.data)if(this.max=parseInt(e.last_page)||1,this.remoteRowCountEstimate=typeof e.last_row<"u"?e.last_row:e.last_page*this.size-(this.page==e.last_page?this.size-e.data.length:0),this.progressiveLoad){switch(this.mode){case"progressive_load":this.page==1?this.table.rowManager.setData(e.data,!1,this.page==1):this.table.rowManager.addRows(e.data),this.page<this.max&&setTimeout(()=>{this.nextPage()},this.table.options.progressiveLoadDelay);break;case"progressive_scroll":e=this.page===1?e.data:this.table.rowManager.getData().concat(e.data),this.table.rowManager.setData(e,this.page!==1,this.page==1),i=this.table.options.progressiveLoadScrollMargin||this.table.rowManager.element.clientHeight*2,this.table.rowManager.element.scrollHeight<=this.table.rowManager.element.clientHeight+i&&this.page<this.max&&setTimeout(()=>{this.nextPage()});break}return!1}else this.dispatchExternal("pageLoaded",this.getPage());else console.warn("Remote Pagination Error - Server response missing '"+(this.options("dataReceiveParams").data||"data")+"' property");return e.data}footerRedraw(){var e=this.table.footerManager.containerElement;Math.ceil(e.clientWidth)-e.scrollWidth<0?this.pagesElement.style.display="none":(this.pagesElement.style.display="",Math.ceil(e.clientWidth)-e.scrollWidth<0&&(this.pagesElement.style.display="none"))}};Ve(fI,"moduleName","page"),Ve(fI,"pageCounters",Dve);let N1=fI;var Pve={local:function(t,e){var i=localStorage.getItem(t+"-"+e);return i?JSON.parse(i):!1},cookie:function(t,e){var i=document.cookie,r=t+"-"+e,n=i.indexOf(r+"="),a,o;return n>-1&&(i=i.slice(n),a=i.indexOf(";"),a>-1&&(i=i.slice(0,a)),o=i.replace(r+"=","")),o?JSON.parse(o):!1}},Rve={local:function(t,e,i){localStorage.setItem(t+"-"+e,JSON.stringify(i))},cookie:function(t,e,i){var r=new Date;r.setDate(r.getDate()+1e4),document.cookie=t+"-"+e+"="+JSON.stringify(i)+"; expires="+r.toUTCString()}};const Mo=class Mo extends ci{constructor(e){super(e),this.mode="",this.id="",this.defWatcherBlock=!1,this.config={},this.readFunc=!1,this.writeFunc=!1,this.registerTableOption("persistence",!1),this.registerTableOption("persistenceID",""),this.registerTableOption("persistenceMode",!0),this.registerTableOption("persistenceReaderFunc",!1),this.registerTableOption("persistenceWriterFunc",!1)}localStorageTest(){var e="_tabulator_test";try{return window.localStorage.setItem(e,e),window.localStorage.removeItem(e),!0}catch{return!1}}initialize(){if(this.table.options.persistence){var e=this.table.options.persistenceMode,i=this.table.options.persistenceID,r;this.mode=e!==!0?e:this.localStorageTest()?"local":"cookie",this.table.options.persistenceReaderFunc?typeof this.table.options.persistenceReaderFunc=="function"?this.readFunc=this.table.options.persistenceReaderFunc:Mo.readers[this.table.options.persistenceReaderFunc]?this.readFunc=Mo.readers[this.table.options.persistenceReaderFunc]:console.warn("Persistence Read Error - invalid reader set",this.table.options.persistenceReaderFunc):Mo.readers[this.mode]?this.readFunc=Mo.readers[this.mode]:console.warn("Persistence Read Error - invalid reader set",this.mode),this.table.options.persistenceWriterFunc?typeof this.table.options.persistenceWriterFunc=="function"?this.writeFunc=this.table.options.persistenceWriterFunc:Mo.writers[this.table.options.persistenceWriterFunc]?this.writeFunc=Mo.writers[this.table.options.persistenceWriterFunc]:console.warn("Persistence Write Error - invalid reader set",this.table.options.persistenceWriterFunc):Mo.writers[this.mode]?this.writeFunc=Mo.writers[this.mode]:console.warn("Persistence Write Error - invalid writer set",this.mode),this.id="tabulator-"+(i||this.table.element.getAttribute("id")||""),this.config={sort:this.table.options.persistence===!0||this.table.options.persistence.sort,filter:this.table.options.persistence===!0||this.table.options.persistence.filter,headerFilter:this.table.options.persistence===!0||this.table.options.persistence.headerFilter,group:this.table.options.persistence===!0||this.table.options.persistence.group,page:this.table.options.persistence===!0||this.table.options.persistence.page,columns:this.table.options.persistence===!0?["title","width","visible"]:this.table.options.persistence.columns},this.config.page&&(r=this.retrieveData("page"),r&&(typeof r.paginationSize<"u"&&(this.config.page===!0||this.config.page.size)&&(this.table.options.paginationSize=r.paginationSize),typeof r.paginationInitialPage<"u"&&(this.config.page===!0||this.config.page.page)&&(this.table.options.paginationInitialPage=r.paginationInitialPage))),this.config.group&&(r=this.retrieveData("group"),r&&(typeof r.groupBy<"u"&&(this.config.group===!0||this.config.group.groupBy)&&(this.table.options.groupBy=r.groupBy),typeof r.groupStartOpen<"u"&&(this.config.group===!0||this.config.group.groupStartOpen)&&(this.table.options.groupStartOpen=r.groupStartOpen),typeof r.groupHeader<"u"&&(this.config.group===!0||this.config.group.groupHeader)&&(this.table.options.groupHeader=r.groupHeader))),this.config.columns&&(this.table.options.columns=this.load("columns",this.table.options.columns),this.subscribe("column-init",this.initializeColumn.bind(this)),this.subscribe("column-show",this.save.bind(this,"columns")),this.subscribe("column-hide",this.save.bind(this,"columns")),this.subscribe("column-moved",this.save.bind(this,"columns"))),this.subscribe("table-built",this.tableBuilt.bind(this),0),this.subscribe("table-redraw",this.tableRedraw.bind(this)),this.subscribe("filter-changed",this.eventSave.bind(this,"filter")),this.subscribe("filter-changed",this.eventSave.bind(this,"headerFilter")),this.subscribe("sort-changed",this.eventSave.bind(this,"sort")),this.subscribe("group-changed",this.eventSave.bind(this,"group")),this.subscribe("page-changed",this.eventSave.bind(this,"page")),this.subscribe("column-resized",this.eventSave.bind(this,"columns")),this.subscribe("column-width",this.eventSave.bind(this,"columns")),this.subscribe("layout-refreshed",this.eventSave.bind(this,"columns"))}this.registerTableFunction("getColumnLayout",this.getColumnLayout.bind(this)),this.registerTableFunction("setColumnLayout",this.setColumnLayout.bind(this))}eventSave(e){this.config[e]&&this.save(e)}tableBuilt(){var e,i,r;this.config.sort&&(e=this.load("sort"),e&&(this.table.options.initialSort=e)),this.config.filter&&(i=this.load("filter"),i&&(this.table.options.initialFilter=i)),this.config.headerFilter&&(r=this.load("headerFilter"),r&&(this.table.options.initialHeaderFilter=r))}tableRedraw(e){e&&this.config.columns&&this.save("columns")}getColumnLayout(){return this.parseColumns(this.table.columnManager.getColumns())}setColumnLayout(e){return this.table.columnManager.setColumns(this.mergeDefinition(this.table.options.columns,e,!0)),!0}initializeColumn(e){var i,r;this.config.columns&&(this.defWatcherBlock=!0,i=e.getDefinition(),r=this.config.columns===!0?Object.keys(i):this.config.columns,r.forEach(n=>{var a=Object.getOwnPropertyDescriptor(i,n),o=i[n];a&&Object.defineProperty(i,n,{set:s=>{o=s,this.defWatcherBlock||this.save("columns"),a.set&&a.set(s)},get:()=>(a.get&&a.get(),o)})}),this.defWatcherBlock=!1)}load(e,i){var r=this.retrieveData(e);return i&&(r=r?this.mergeDefinition(i,r):i),r}retrieveData(e){return this.readFunc?this.readFunc(this.id,e):!1}mergeDefinition(e,i,r){var n=[];return i=i||[],i.forEach((a,o)=>{var s=this._findColumn(e,a),l;s&&(r?l=Object.keys(a):this.config.columns===!0||this.config.columns==null?(l=Object.keys(s),l.push("width")):l=this.config.columns,l.forEach(u=>{u!=="columns"&&typeof a[u]<"u"&&(s[u]=a[u])}),s.columns&&(s.columns=this.mergeDefinition(s.columns,a.columns)),n.push(s))}),e.forEach((a,o)=>{var s=this._findColumn(i,a);s||(n.length>o?n.splice(o,0,a):n.push(a))}),n}_findColumn(e,i){var r=i.columns?"group":i.field?"field":"object";return e.find(function(n){switch(r){case"group":return n.title===i.title&&n.columns.length===i.columns.length;case"field":return n.field===i.field;case"object":return n===i}})}save(e){var i={};switch(e){case"columns":i=this.parseColumns(this.table.columnManager.getColumns());break;case"filter":i=this.table.modules.filter.getFilters();break;case"headerFilter":i=this.table.modules.filter.getHeaderFilters();break;case"sort":i=this.validateSorters(this.table.modules.sort.getSort());break;case"group":i=this.getGroupConfig();break;case"page":i=this.getPageConfig();break}this.writeFunc&&this.writeFunc(this.id,e,i)}validateSorters(e){return e.forEach(function(i){i.column=i.field,delete i.field}),e}getGroupConfig(){var e={};return this.config.group&&((this.config.group===!0||this.config.group.groupBy)&&(e.groupBy=this.table.options.groupBy),(this.config.group===!0||this.config.group.groupStartOpen)&&(e.groupStartOpen=this.table.options.groupStartOpen),(this.config.group===!0||this.config.group.groupHeader)&&(e.groupHeader=this.table.options.groupHeader)),e}getPageConfig(){var e={};return this.config.page&&((this.config.page===!0||this.config.page.size)&&(e.paginationSize=this.table.modules.page.getPageSize()),(this.config.page===!0||this.config.page.page)&&(e.paginationInitialPage=this.table.modules.page.getPage())),e}parseColumns(e){var i=[],r=["headerContextMenu","headerMenu","contextMenu","clickMenu"];return e.forEach(n=>{var a={},o=n.getDefinition(),s;n.isGroup?(a.title=o.title,a.columns=this.parseColumns(n.getColumns())):(a.field=n.getField(),this.config.columns===!0||this.config.columns==null?(s=Object.keys(o),s.push("width"),s.push("visible")):s=this.config.columns,s.forEach(l=>{switch(l){case"width":a.width=n.getWidth();break;case"visible":a.visible=n.visible;break;default:typeof o[l]!="function"&&r.indexOf(l)===-1&&(a[l]=o[l])}})),i.push(a)}),i}};Ve(Mo,"moduleName","persistence"),Ve(Mo,"moduleInitOrder",-10),Ve(Mo,"readers",Pve),Ve(Mo,"writers",Rve);let A1=Mo;class D7 extends ci{constructor(e){super(e),this.columnSubscribers={},this.registerTableOption("rowContextPopup",!1),this.registerTableOption("rowClickPopup",!1),this.registerTableOption("rowDblClickPopup",!1),this.registerTableOption("groupContextPopup",!1),this.registerTableOption("groupClickPopup",!1),this.registerTableOption("groupDblClickPopup",!1),this.registerColumnOption("headerContextPopup"),this.registerColumnOption("headerClickPopup"),this.registerColumnOption("headerDblClickPopup"),this.registerColumnOption("headerPopup"),this.registerColumnOption("headerPopupIcon"),this.registerColumnOption("contextPopup"),this.registerColumnOption("clickPopup"),this.registerColumnOption("dblClickPopup"),this.registerComponentFunction("cell","popup",this._componentPopupCall.bind(this)),this.registerComponentFunction("column","popup",this._componentPopupCall.bind(this)),this.registerComponentFunction("row","popup",this._componentPopupCall.bind(this)),this.registerComponentFunction("group","popup",this._componentPopupCall.bind(this))}initialize(){this.initializeRowWatchers(),this.initializeGroupWatchers(),this.subscribe("column-init",this.initializeColumn.bind(this))}_componentPopupCall(e,i,r){this.loadPopupEvent(i,null,e,r)}initializeRowWatchers(){this.table.options.rowContextPopup&&(this.subscribe("row-contextmenu",this.loadPopupEvent.bind(this,this.table.options.rowContextPopup)),this.table.on("rowTapHold",this.loadPopupEvent.bind(this,this.table.options.rowContextPopup))),this.table.options.rowClickPopup&&this.subscribe("row-click",this.loadPopupEvent.bind(this,this.table.options.rowClickPopup)),this.table.options.rowDblClickPopup&&this.subscribe("row-dblclick",this.loadPopupEvent.bind(this,this.table.options.rowDblClickPopup))}initializeGroupWatchers(){this.table.options.groupContextPopup&&(this.subscribe("group-contextmenu",this.loadPopupEvent.bind(this,this.table.options.groupContextPopup)),this.table.on("groupTapHold",this.loadPopupEvent.bind(this,this.table.options.groupContextPopup))),this.table.options.groupClickPopup&&this.subscribe("group-click",this.loadPopupEvent.bind(this,this.table.options.groupClickPopup)),this.table.options.groupDblClickPopup&&this.subscribe("group-dblclick",this.loadPopupEvent.bind(this,this.table.options.groupDblClickPopup))}initializeColumn(e){var i=e.definition;i.headerContextPopup&&!this.columnSubscribers.headerContextPopup&&(this.columnSubscribers.headerContextPopup=this.loadPopupTableColumnEvent.bind(this,"headerContextPopup"),this.subscribe("column-contextmenu",this.columnSubscribers.headerContextPopup),this.table.on("headerTapHold",this.loadPopupTableColumnEvent.bind(this,"headerContextPopup"))),i.headerClickPopup&&!this.columnSubscribers.headerClickPopup&&(this.columnSubscribers.headerClickPopup=this.loadPopupTableColumnEvent.bind(this,"headerClickPopup"),this.subscribe("column-click",this.columnSubscribers.headerClickPopup)),i.headerDblClickPopup&&!this.columnSubscribers.headerDblClickPopup&&(this.columnSubscribers.headerDblClickPopup=this.loadPopupTableColumnEvent.bind(this,"headerDblClickPopup"),this.subscribe("column-dblclick",this.columnSubscribers.headerDblClickPopup)),i.headerPopup&&this.initializeColumnHeaderPopup(e),i.contextPopup&&!this.columnSubscribers.contextPopup&&(this.columnSubscribers.contextPopup=this.loadPopupTableCellEvent.bind(this,"contextPopup"),this.subscribe("cell-contextmenu",this.columnSubscribers.contextPopup),this.table.on("cellTapHold",this.loadPopupTableCellEvent.bind(this,"contextPopup"))),i.clickPopup&&!this.columnSubscribers.clickPopup&&(this.columnSubscribers.clickPopup=this.loadPopupTableCellEvent.bind(this,"clickPopup"),this.subscribe("cell-click",this.columnSubscribers.clickPopup)),i.dblClickPopup&&!this.columnSubscribers.dblClickPopup&&(this.columnSubscribers.dblClickPopup=this.loadPopupTableCellEvent.bind(this,"dblClickPopup"),this.subscribe("cell-click",this.columnSubscribers.dblClickPopup))}initializeColumnHeaderPopup(e){var i=e.definition.headerPopupIcon,r;r=document.createElement("span"),r.classList.add("tabulator-header-popup-button"),i?(typeof i=="function"&&(i=i(e.getComponent())),i instanceof HTMLElement?r.appendChild(i):r.innerHTML=i):r.innerHTML="&vellip;",r.addEventListener("click",n=>{n.stopPropagation(),n.preventDefault(),this.loadPopupEvent(e.definition.headerPopup,n,e)}),e.titleElement.insertBefore(r,e.titleElement.firstChild)}loadPopupTableCellEvent(e,i,r){r._cell&&(r=r._cell),r.column.definition[e]&&this.loadPopupEvent(r.column.definition[e],i,r)}loadPopupTableColumnEvent(e,i,r){r._column&&(r=r._column),r.definition[e]&&this.loadPopupEvent(r.definition[e],i,r)}loadPopupEvent(e,i,r,n){var a;function o(s){a=s}r._group?r=r._group:r._row&&(r=r._row),e=typeof e=="function"?e.call(this.table,i,r.getComponent(),o):e,this.loadPopup(i,r,e,a,n)}loadPopup(e,i,r,n,a){var o=!(e instanceof MouseEvent),s,l;r instanceof HTMLElement?s=r:(s=document.createElement("div"),s.innerHTML=r),s.classList.add("tabulator-popup"),s.addEventListener("click",u=>{u.stopPropagation()}),o||e.preventDefault(),l=this.popup(s),typeof n=="function"&&l.renderCallback(n),e?l.show(e):l.show(i.getElement(),a||"center"),l.hideOnBlur(()=>{this.dispatchExternal("popupClosed",i.getComponent())}),this.dispatchExternal("popupOpened",i.getComponent())}}Ve(D7,"moduleName","popup");class P7 extends ci{constructor(e){super(e),this.element=!1,this.manualBlock=!1,this.beforeprintEventHandler=null,this.afterprintEventHandler=null,this.registerTableOption("printAsHtml",!1),this.registerTableOption("printFormatter",!1),this.registerTableOption("printHeader",!1),this.registerTableOption("printFooter",!1),this.registerTableOption("printStyled",!0),this.registerTableOption("printRowRange","visible"),this.registerTableOption("printConfig",{}),this.registerColumnOption("print"),this.registerColumnOption("titlePrint")}initialize(){this.table.options.printAsHtml&&(this.beforeprintEventHandler=this.replaceTable.bind(this),this.afterprintEventHandler=this.cleanup.bind(this),window.addEventListener("beforeprint",this.beforeprintEventHandler),window.addEventListener("afterprint",this.afterprintEventHandler),this.subscribe("table-destroy",this.destroy.bind(this))),this.registerTableFunction("print",this.printFullscreen.bind(this))}destroy(){this.table.options.printAsHtml&&(window.removeEventListener("beforeprint",this.beforeprintEventHandler),window.removeEventListener("afterprint",this.afterprintEventHandler))}replaceTable(){this.manualBlock||(this.element=document.createElement("div"),this.element.classList.add("tabulator-print-table"),this.element.appendChild(this.table.modules.export.generateTable(this.table.options.printConfig,this.table.options.printStyled,this.table.options.printRowRange,"print")),this.table.element.style.display="none",this.table.element.parentNode.insertBefore(this.element,this.table.element))}cleanup(){document.body.classList.remove("tabulator-print-fullscreen-hide"),this.element&&this.element.parentNode&&(this.element.parentNode.removeChild(this.element),this.table.element.style.display="")}printFullscreen(e,i,r){var n=window.scrollX,a=window.scrollY,o=document.createElement("div"),s=document.createElement("div"),l=this.table.modules.export.generateTable(typeof r<"u"?r:this.table.options.printConfig,typeof i<"u"?i:this.table.options.printStyled,e||this.table.options.printRowRange,"print"),u,c;this.manualBlock=!0,this.element=document.createElement("div"),this.element.classList.add("tabulator-print-fullscreen"),this.table.options.printHeader&&(o.classList.add("tabulator-print-header"),u=typeof this.table.options.printHeader=="function"?this.table.options.printHeader.call(this.table):this.table.options.printHeader,typeof u=="string"?o.innerHTML=u:o.appendChild(u),this.element.appendChild(o)),this.element.appendChild(l),this.table.options.printFooter&&(s.classList.add("tabulator-print-footer"),c=typeof this.table.options.printFooter=="function"?this.table.options.printFooter.call(this.table):this.table.options.printFooter,typeof c=="string"?s.innerHTML=c:s.appendChild(c),this.element.appendChild(s)),document.body.classList.add("tabulator-print-fullscreen-hide"),document.body.appendChild(this.element),this.table.options.printFormatter&&this.table.options.printFormatter(this.element,l),window.print(),this.cleanup(),window.scrollTo(n,a),this.manualBlock=!1}}Ve(P7,"moduleName","print");class R7 extends ci{constructor(e){super(e),this.data=!1,this.blocked=!1,this.origFuncs={},this.currentVersion=0,this.registerTableOption("reactiveData",!1)}initialize(){this.table.options.reactiveData&&(this.subscribe("cell-value-save-before",this.block.bind(this,"cellsave")),this.subscribe("cell-value-save-after",this.unblock.bind(this,"cellsave")),this.subscribe("row-data-save-before",this.block.bind(this,"rowsave")),this.subscribe("row-data-save-after",this.unblock.bind(this,"rowsave")),this.subscribe("row-data-init-after",this.watchRow.bind(this)),this.subscribe("data-processing",this.watchData.bind(this)),this.subscribe("table-destroy",this.unwatchData.bind(this)))}watchData(e){var i=this,r;this.currentVersion++,r=this.currentVersion,this.unwatchData(),this.data=e,this.origFuncs.push=e.push,Object.defineProperty(this.data,"push",{enumerable:!1,configurable:!0,value:function(){var n=Array.from(arguments),a;return!i.blocked&&r===i.currentVersion&&(i.block("data-push"),n.forEach(o=>{i.table.rowManager.addRowActual(o,!1)}),a=i.origFuncs.push.apply(e,arguments),i.unblock("data-push")),a}}),this.origFuncs.unshift=e.unshift,Object.defineProperty(this.data,"unshift",{enumerable:!1,configurable:!0,value:function(){var n=Array.from(arguments),a;return!i.blocked&&r===i.currentVersion&&(i.block("data-unshift"),n.forEach(o=>{i.table.rowManager.addRowActual(o,!0)}),a=i.origFuncs.unshift.apply(e,arguments),i.unblock("data-unshift")),a}}),this.origFuncs.shift=e.shift,Object.defineProperty(this.data,"shift",{enumerable:!1,configurable:!0,value:function(){var n,a;return!i.blocked&&r===i.currentVersion&&(i.block("data-shift"),i.data.length&&(n=i.table.rowManager.getRowFromDataObject(i.data[0]),n&&n.deleteActual()),a=i.origFuncs.shift.call(e),i.unblock("data-shift")),a}}),this.origFuncs.pop=e.pop,Object.defineProperty(this.data,"pop",{enumerable:!1,configurable:!0,value:function(){var n,a;return!i.blocked&&r===i.currentVersion&&(i.block("data-pop"),i.data.length&&(n=i.table.rowManager.getRowFromDataObject(i.data[i.data.length-1]),n&&n.deleteActual()),a=i.origFuncs.pop.call(e),i.unblock("data-pop")),a}}),this.origFuncs.splice=e.splice,Object.defineProperty(this.data,"splice",{enumerable:!1,configurable:!0,value:function(){var n=Array.from(arguments),a=n[0]<0?e.length+n[0]:n[0],o=n[1],s=n[2]?n.slice(2):!1,l,u;if(!i.blocked&&r===i.currentVersion){if(i.block("data-splice"),s&&(l=e[a]?i.table.rowManager.getRowFromDataObject(e[a]):!1,l?s.forEach(d=>{i.table.rowManager.addRowActual(d,!0,l,!0)}):(s=s.slice().reverse(),s.forEach(d=>{i.table.rowManager.addRowActual(d,!0,!1,!0)}))),o!==0){var c=e.slice(a,typeof n[1]>"u"?n[1]:a+o);c.forEach((d,p)=>{var m=i.table.rowManager.getRowFromDataObject(d);m&&m.deleteActual(p!==c.length-1)})}(s||o!==0)&&i.table.rowManager.reRenderInPosition(),u=i.origFuncs.splice.apply(e,arguments),i.unblock("data-splice")}return u}})}unwatchData(){if(this.data!==!1)for(var e in this.origFuncs)Object.defineProperty(this.data,e,{enumerable:!0,configurable:!0,writable:!0,value:this.origFuncs.key})}watchRow(e){var i=e.getData();for(var r in i)this.watchKey(e,i,r);this.table.options.dataTree&&this.watchTreeChildren(e)}watchTreeChildren(e){var i=this,r=e.getData()[this.table.options.dataTreeChildField],n={};r&&(n.push=r.push,Object.defineProperty(r,"push",{enumerable:!1,configurable:!0,value:()=>{if(!i.blocked){i.block("tree-push");var a=n.push.apply(r,arguments);this.rebuildTree(e),i.unblock("tree-push")}return a}}),n.unshift=r.unshift,Object.defineProperty(r,"unshift",{enumerable:!1,configurable:!0,value:()=>{if(!i.blocked){i.block("tree-unshift");var a=n.unshift.apply(r,arguments);this.rebuildTree(e),i.unblock("tree-unshift")}return a}}),n.shift=r.shift,Object.defineProperty(r,"shift",{enumerable:!1,configurable:!0,value:()=>{if(!i.blocked){i.block("tree-shift");var a=n.shift.call(r);this.rebuildTree(e),i.unblock("tree-shift")}return a}}),n.pop=r.pop,Object.defineProperty(r,"pop",{enumerable:!1,configurable:!0,value:()=>{if(!i.blocked){i.block("tree-pop");var a=n.pop.call(r);this.rebuildTree(e),i.unblock("tree-pop")}return a}}),n.splice=r.splice,Object.defineProperty(r,"splice",{enumerable:!1,configurable:!0,value:()=>{if(!i.blocked){i.block("tree-splice");var a=n.splice.apply(r,arguments);this.rebuildTree(e),i.unblock("tree-splice")}return a}}))}rebuildTree(e){this.table.modules.dataTree.initializeRow(e),this.table.modules.dataTree.layoutRow(e),this.table.rowManager.refreshActiveData("tree",!1,!0)}watchKey(e,i,r){var n=this,a=Object.getOwnPropertyDescriptor(i,r),o=i[r],s=this.currentVersion;Object.defineProperty(i,r,{set:l=>{if(o=l,!n.blocked&&s===n.currentVersion){n.block("key");var u={};u[r]=l,e.updateData(u),n.unblock("key")}a.set&&a.set(l)},get:()=>(a.get&&a.get(),o)})}unwatchRow(e){var i=e.getData();for(var r in i)Object.defineProperty(i,r,{value:i[r]})}block(e){this.blocked||(this.blocked=e)}unblock(e){this.blocked===e&&(this.blocked=!1)}}Ve(R7,"moduleName","reactiveData");class E7 extends ci{constructor(e){super(e),this.startColumn=!1,this.startX=!1,this.startWidth=!1,this.latestX=!1,this.handle=null,this.initialNextColumn=null,this.nextColumn=null,this.initialized=!1,this.registerColumnOption("resizable",!0),this.registerTableOption("resizableColumnFit",!1),this.registerTableOption("resizableColumnGuide",!1)}initialize(){this.subscribe("column-rendered",this.layoutColumnHeader.bind(this))}initializeEventWatchers(){this.initialized||(this.subscribe("cell-rendered",this.layoutCellHandles.bind(this)),this.subscribe("cell-delete",this.deInitializeComponent.bind(this)),this.subscribe("cell-height",this.resizeHandle.bind(this)),this.subscribe("column-moved",this.columnLayoutUpdated.bind(this)),this.subscribe("column-hide",this.deInitializeColumn.bind(this)),this.subscribe("column-show",this.columnLayoutUpdated.bind(this)),this.subscribe("column-width",this.columnWidthUpdated.bind(this)),this.subscribe("column-delete",this.deInitializeComponent.bind(this)),this.subscribe("column-height",this.resizeHandle.bind(this)),this.initialized=!0)}layoutCellHandles(e){e.row.type==="row"&&(this.deInitializeComponent(e),this.initializeColumn("cell",e,e.column,e.element))}layoutColumnHeader(e){e.definition.resizable&&(this.initializeEventWatchers(),this.deInitializeComponent(e),this.initializeColumn("header",e,e,e.element))}columnLayoutUpdated(e){var i=e.prevColumn();this.reinitializeColumn(e),i&&this.reinitializeColumn(i)}columnWidthUpdated(e){e.modules.frozen&&(this.table.modules.frozenColumns.leftColumns.includes(e)?this.table.modules.frozenColumns.leftColumns.forEach(i=>{this.reinitializeColumn(i)}):this.table.modules.frozenColumns.rightColumns.includes(e)&&this.table.modules.frozenColumns.rightColumns.forEach(i=>{this.reinitializeColumn(i)}))}frozenColumnOffset(e){var i=!1;return e.modules.frozen&&(i=e.modules.frozen.marginValue,e.modules.frozen.position==="left"?i+=e.getWidth()-3:i&&(i-=3)),i!==!1?i+"px":!1}reinitializeColumn(e){var i=this.frozenColumnOffset(e);e.cells.forEach(r=>{r.modules.resize&&r.modules.resize.handleEl&&(i&&(r.modules.resize.handleEl.style[e.modules.frozen.position]=i,r.modules.resize.handleEl.style["z-index"]=11),r.element.after(r.modules.resize.handleEl))}),e.modules.resize&&e.modules.resize.handleEl&&(i&&(e.modules.resize.handleEl.style[e.modules.frozen.position]=i),e.element.after(e.modules.resize.handleEl))}initializeColumn(e,i,r,n){var a=this,o=!1,s=r.definition.resizable,l={},u=r.getLastColumn();if(e==="header"&&(o=r.definition.formatter=="textarea"||r.definition.variableHeight,l={variableHeight:o}),(s===!0||s==e)&&this._checkResizability(u)){var c=document.createElement("span");c.className="tabulator-col-resize-handle",c.addEventListener("click",function(p){p.stopPropagation()});var d=function(p){a.startColumn=r,a.initialNextColumn=a.nextColumn=u.nextColumn(),a._mouseDown(p,u,c)};c.addEventListener("mousedown",d),c.addEventListener("touchstart",d,{passive:!0}),c.addEventListener("dblclick",p=>{var m=u.getWidth();p.stopPropagation(),u.reinitializeWidth(!0),m!==u.getWidth()&&(a.dispatch("column-resized",u),a.dispatchExternal("columnResized",u.getComponent()))}),r.modules.frozen&&(c.style.position="sticky",c.style[r.modules.frozen.position]=this.frozenColumnOffset(r)),l.handleEl=c,n.parentNode&&r.visible&&n.after(c)}i.modules.resize=l}deInitializeColumn(e){this.deInitializeComponent(e),e.cells.forEach(i=>{this.deInitializeComponent(i)})}deInitializeComponent(e){var i;e.modules.resize&&(i=e.modules.resize.handleEl,i&&i.parentElement&&i.parentElement.removeChild(i))}resizeHandle(e,i){e.modules.resize&&e.modules.resize.handleEl&&(e.modules.resize.handleEl.style.height=i)}resize(e,i){var r=typeof e.clientX>"u"?e.touches[0].clientX:e.clientX,n=r-this.startX,a=r-this.latestX,o,s;if(this.latestX=r,this.table.rtl&&(n=-n,a=-a),o=i.width==i.minWidth||i.width==i.maxWidth,i.setWidth(this.startWidth+n),s=i.width==i.minWidth||i.width==i.maxWidth,a<0&&(this.nextColumn=this.initialNextColumn),this.table.options.resizableColumnFit&&this.nextColumn&&!(o&&s)){let l=this.nextColumn.getWidth();a>0&&l<=this.nextColumn.minWidth&&(this.nextColumn=this.nextColumn.nextColumn()),this.nextColumn&&this.nextColumn.setWidth(this.nextColumn.getWidth()-a)}this.table.columnManager.rerenderColumns(!0),!this.table.browserSlow&&i.modules.resize&&i.modules.resize.variableHeight&&i.checkCellHeights()}calcGuidePosition(e,i,r){var n=typeof e.clientX>"u"?e.touches[0].clientX:e.clientX,a=r.getBoundingClientRect().x-this.table.element.getBoundingClientRect().x,o=this.table.element.getBoundingClientRect().x,s=i.element.getBoundingClientRect().left-o,l=n-this.startX,u=Math.max(a+l,s+i.minWidth);return i.maxWidth&&(u=Math.min(u,s+i.maxWidth)),u}_checkResizability(e){return e.definition.resizable}_mouseDown(e,i,r){var n=this,a;this.dispatchExternal("columnResizing",i.getComponent()),n.table.options.resizableColumnGuide&&(a=document.createElement("span"),a.classList.add("tabulator-col-resize-guide"),n.table.element.appendChild(a),setTimeout(()=>{a.style.left=n.calcGuidePosition(e,i,r)+"px"})),n.table.element.classList.add("tabulator-block-select");function o(l){n.table.options.resizableColumnGuide?a.style.left=n.calcGuidePosition(l,i,r)+"px":n.resize(l,i)}function s(l){n.table.options.resizableColumnGuide&&(n.resize(l,i),a.remove()),n.startColumn.modules.edit&&(n.startColumn.modules.edit.blocked=!1),n.table.browserSlow&&i.modules.resize&&i.modules.resize.variableHeight&&i.checkCellHeights(),document.body.removeEventListener("mouseup",s),document.body.removeEventListener("mousemove",o),r.removeEventListener("touchmove",o),r.removeEventListener("touchend",s),n.table.element.classList.remove("tabulator-block-select"),n.startWidth!==i.getWidth()&&(n.table.columnManager.verticalAlignHeaders(),n.dispatch("column-resized",i),n.dispatchExternal("columnResized",i.getComponent()))}e.stopPropagation(),n.startColumn.modules.edit&&(n.startColumn.modules.edit.blocked=!0),n.startX=typeof e.clientX>"u"?e.touches[0].clientX:e.clientX,n.latestX=n.startX,n.startWidth=i.getWidth(),document.body.addEventListener("mousemove",o),document.body.addEventListener("mouseup",s),r.addEventListener("touchmove",o,{passive:!0}),r.addEventListener("touchend",s)}}Ve(E7,"moduleName","resizeColumns");class C7 extends ci{constructor(e){super(e),this.startColumn=!1,this.startY=!1,this.startHeight=!1,this.handle=null,this.prevHandle=null,this.registerTableOption("resizableRows",!1),this.registerTableOption("resizableRowGuide",!1)}initialize(){this.table.options.resizableRows&&this.subscribe("row-layout-after",this.initializeRow.bind(this))}initializeRow(e){var i=this,r=e.getElement(),n=document.createElement("div");n.className="tabulator-row-resize-handle";var a=document.createElement("div");a.className="tabulator-row-resize-handle prev",n.addEventListener("click",function(l){l.stopPropagation()});var o=function(l){i.startRow=e,i._mouseDown(l,e,n)};n.addEventListener("mousedown",o),n.addEventListener("touchstart",o,{passive:!0}),a.addEventListener("click",function(l){l.stopPropagation()});var s=function(l){var u=i.table.rowManager.prevDisplayRow(e);u&&(i.startRow=u,i._mouseDown(l,u,a))};a.addEventListener("mousedown",s),a.addEventListener("touchstart",s,{passive:!0}),r.appendChild(n),r.appendChild(a)}resize(e,i){i.setHeight(this.startHeight+((typeof e.screenY>"u"?e.touches[0].screenY:e.screenY)-this.startY))}calcGuidePosition(e,i,r){var n=typeof e.screenY>"u"?e.touches[0].screenY:e.screenY,a=r.getBoundingClientRect().y-this.table.element.getBoundingClientRect().y,o=this.table.element.getBoundingClientRect().y,s=i.element.getBoundingClientRect().top-o,l=n-this.startY;return Math.max(a+l,s)}_mouseDown(e,i,r){var n=this,a;n.dispatchExternal("rowResizing",i.getComponent()),n.table.options.resizableRowGuide&&(a=document.createElement("span"),a.classList.add("tabulator-row-resize-guide"),n.table.element.appendChild(a),setTimeout(()=>{a.style.top=n.calcGuidePosition(e,i,r)+"px"})),n.table.element.classList.add("tabulator-block-select");function o(l){n.table.options.resizableRowGuide?a.style.top=n.calcGuidePosition(l,i,r)+"px":n.resize(l,i)}function s(l){n.table.options.resizableRowGuide&&(n.resize(l,i),a.remove()),document.body.removeEventListener("mouseup",o),document.body.removeEventListener("mousemove",o),r.removeEventListener("touchmove",o),r.removeEventListener("touchend",s),n.table.element.classList.remove("tabulator-block-select"),n.dispatchExternal("rowResized",i.getComponent())}e.stopPropagation(),n.startY=typeof e.screenY>"u"?e.touches[0].screenY:e.screenY,n.startHeight=i.getHeight(),document.body.addEventListener("mousemove",o),document.body.addEventListener("mouseup",s),r.addEventListener("touchmove",o,{passive:!0}),r.addEventListener("touchend",s)}}Ve(C7,"moduleName","resizeRows");class M7 extends ci{constructor(e){super(e),this.binding=!1,this.visibilityObserver=!1,this.resizeObserver=!1,this.containerObserver=!1,this.tableHeight=0,this.tableWidth=0,this.containerHeight=0,this.containerWidth=0,this.autoResize=!1,this.visible=!1,this.initialized=!1,this.initialRedraw=!1,this.registerTableOption("autoResize",!0)}initialize(){if(this.table.options.autoResize){var e=this.table,i;this.tableHeight=e.element.clientHeight,this.tableWidth=e.element.clientWidth,e.element.parentNode&&(this.containerHeight=e.element.parentNode.clientHeight,this.containerWidth=e.element.parentNode.clientWidth),typeof IntersectionObserver<"u"&&typeof ResizeObserver<"u"&&e.rowManager.getRenderMode()==="virtual"?(this.initializeVisibilityObserver(),this.autoResize=!0,this.resizeObserver=new ResizeObserver(r=>{if(!e.browserMobile||e.browserMobile&&(!e.modules.edit||e.modules.edit&&!e.modules.edit.currentCell)){var n=Math.floor(r[0].contentRect.height),a=Math.floor(r[0].contentRect.width);(this.tableHeight!=n||this.tableWidth!=a)&&(this.tableHeight=n,this.tableWidth=a,e.element.parentNode&&(this.containerHeight=e.element.parentNode.clientHeight,this.containerWidth=e.element.parentNode.clientWidth),this.redrawTable())}}),this.resizeObserver.observe(e.element),i=window.getComputedStyle(e.element),this.table.element.parentNode&&!this.table.rowManager.fixedHeight&&(i.getPropertyValue("max-height")||i.getPropertyValue("min-height"))&&(this.containerObserver=new ResizeObserver(r=>{if(!e.browserMobile||e.browserMobile&&(!e.modules.edit||e.modules.edit&&!e.modules.edit.currentCell)){var n=Math.floor(r[0].contentRect.height),a=Math.floor(r[0].contentRect.width);(this.containerHeight!=n||this.containerWidth!=a)&&(this.containerHeight=n,this.containerWidth=a,this.tableHeight=e.element.clientHeight,this.tableWidth=e.element.clientWidth),this.redrawTable()}}),this.containerObserver.observe(this.table.element.parentNode)),this.subscribe("table-resize",this.tableResized.bind(this))):(this.binding=function(){(!e.browserMobile||e.browserMobile&&(!e.modules.edit||e.modules.edit&&!e.modules.edit.currentCell))&&(e.columnManager.rerenderColumns(!0),e.redraw())},window.addEventListener("resize",this.binding)),this.subscribe("table-destroy",this.clearBindings.bind(this))}}initializeVisibilityObserver(){this.visibilityObserver=new IntersectionObserver(e=>{this.visible=e[0].isIntersecting,this.initialized?this.visible&&(this.redrawTable(this.initialRedraw),this.initialRedraw=!1):(this.initialized=!0,this.initialRedraw=!this.visible)}),this.visibilityObserver.observe(this.table.element)}redrawTable(e){this.initialized&&this.visible&&(this.table.columnManager.rerenderColumns(!0),this.table.redraw(e))}tableResized(){this.table.rowManager.redraw()}clearBindings(){this.binding&&window.removeEventListener("resize",this.binding),this.resizeObserver&&this.resizeObserver.unobserve(this.table.element),this.visibilityObserver&&this.visibilityObserver.unobserve(this.table.element),this.containerObserver&&this.containerObserver.unobserve(this.table.element.parentNode)}}Ve(M7,"moduleName","resizeTable");function Eve(t,e,i){var r=document.createElement("div"),n=t.getRow()._row.modules.responsiveLayout;r.classList.add("tabulator-responsive-collapse-toggle"),r.innerHTML=`<svg class='tabulator-responsive-collapse-toggle-open' viewbox="0 0 24 24">
  <line x1="7" y1="12" x2="17" y2="12" fill="none" stroke-width="3" stroke-linecap="round" />
  <line y1="7" x1="12" y2="17" x2="12" fill="none" stroke-width="3" stroke-linecap="round" />
</svg>

<svg class='tabulator-responsive-collapse-toggle-close' viewbox="0 0 24 24">
  <line x1="7" y1="12" x2="17" y2="12"  fill="none" stroke-width="3" stroke-linecap="round" />
</svg>`,t.getElement().classList.add("tabulator-row-handle");function a(o){var s=n.element;n.open=o,s&&(n.open?(r.classList.add("open"),s.style.display=""):(r.classList.remove("open"),s.style.display="none"))}return r.addEventListener("click",function(o){o.stopImmediatePropagation(),a(!n.open),t.getTable().rowManager.adjustTableSize()}),a(n.open),r}var Cve={format:{formatters:{responsiveCollapse:Eve}}};class O1 extends ci{constructor(e){super(e),this.columns=[],this.hiddenColumns=[],this.mode="",this.index=0,this.collapseFormatter=[],this.collapseStartOpen=!0,this.collapseHandleColumn=!1,this.registerTableOption("responsiveLayout",!1),this.registerTableOption("responsiveLayoutCollapseStartOpen",!0),this.registerTableOption("responsiveLayoutCollapseUseFormatters",!0),this.registerTableOption("responsiveLayoutCollapseFormatter",!1),this.registerColumnOption("responsive")}initialize(){this.table.options.responsiveLayout&&(this.subscribe("column-layout",this.initializeColumn.bind(this)),this.subscribe("column-show",this.updateColumnVisibility.bind(this)),this.subscribe("column-hide",this.updateColumnVisibility.bind(this)),this.subscribe("columns-loaded",this.initializeResponsivity.bind(this)),this.subscribe("column-moved",this.initializeResponsivity.bind(this)),this.subscribe("column-add",this.initializeResponsivity.bind(this)),this.subscribe("column-delete",this.initializeResponsivity.bind(this)),this.subscribe("table-redrawing",this.tableRedraw.bind(this)),this.table.options.responsiveLayout==="collapse"&&(this.subscribe("row-data-changed",this.generateCollapsedRowContent.bind(this)),this.subscribe("row-init",this.initializeRow.bind(this)),this.subscribe("row-layout",this.layoutRow.bind(this))))}tableRedraw(e){["fitColumns","fitDataStretch"].indexOf(this.layoutMode())===-1&&(e||this.update())}initializeResponsivity(){var e=[];this.mode=this.table.options.responsiveLayout,this.collapseFormatter=this.table.options.responsiveLayoutCollapseFormatter||this.formatCollapsedData,this.collapseStartOpen=this.table.options.responsiveLayoutCollapseStartOpen,this.hiddenColumns=[],this.collapseFormatter&&(this.collapseFormatter=this.collapseFormatter.bind(this.table)),this.table.columnManager.columnsByIndex.forEach((i,r)=>{i.modules.responsive&&i.modules.responsive.order&&i.modules.responsive.visible&&(i.modules.responsive.index=r,e.push(i),!i.visible&&this.mode==="collapse"&&this.hiddenColumns.push(i))}),e=e.reverse(),e=e.sort((i,r)=>{var n=r.modules.responsive.order-i.modules.responsive.order;return n||r.modules.responsive.index-i.modules.responsive.index}),this.columns=e,this.mode==="collapse"&&this.generateCollapsedContent();for(let i of this.table.columnManager.columnsByIndex)if(i.definition.formatter=="responsiveCollapse"){this.collapseHandleColumn=i;break}this.collapseHandleColumn&&(this.hiddenColumns.length?this.collapseHandleColumn.show():this.collapseHandleColumn.hide())}initializeColumn(e){var i=e.getDefinition();e.modules.responsive={order:typeof i.responsive>"u"?1:i.responsive,visible:i.visible!==!1}}initializeRow(e){var i;e.type!=="calc"&&(i=document.createElement("div"),i.classList.add("tabulator-responsive-collapse"),e.modules.responsiveLayout={element:i,open:this.collapseStartOpen},this.collapseStartOpen||(i.style.display="none"))}layoutRow(e){var i=e.getElement();e.modules.responsiveLayout&&(i.appendChild(e.modules.responsiveLayout.element),this.generateCollapsedRowContent(e))}updateColumnVisibility(e,i){!i&&e.modules.responsive&&(e.modules.responsive.visible=e.visible,this.initializeResponsivity())}hideColumn(e){var i=this.hiddenColumns.length;e.hide(!1,!0),this.mode==="collapse"&&(this.hiddenColumns.unshift(e),this.generateCollapsedContent(),this.collapseHandleColumn&&!i&&this.collapseHandleColumn.show())}showColumn(e){var i;e.show(!1,!0),e.setWidth(e.getWidth()),this.mode==="collapse"&&(i=this.hiddenColumns.indexOf(e),i>-1&&this.hiddenColumns.splice(i,1),this.generateCollapsedContent(),this.collapseHandleColumn&&!this.hiddenColumns.length&&this.collapseHandleColumn.hide())}update(){for(var e=!0;e;){let i=this.table.modules.layout.getMode()=="fitColumns"?this.table.columnManager.getFlexBaseWidth():this.table.columnManager.getWidth(),r=(this.table.options.headerVisible?this.table.columnManager.element.clientWidth:this.table.element.clientWidth)-i;if(r<0){let n=this.columns[this.index];n?(this.hideColumn(n),this.index++):e=!1}else{let n=this.columns[this.index-1];n&&r>0&&r>=n.getWidth()?(this.showColumn(n),this.index--):e=!1}this.table.rowManager.activeRowsCount||this.table.rowManager.renderEmptyScroll()}}generateCollapsedContent(){var e=this.table.rowManager.getDisplayRows();e.forEach(i=>{this.generateCollapsedRowContent(i)})}generateCollapsedRowContent(e){var i,r;if(e.modules.responsiveLayout){for(i=e.modules.responsiveLayout.element;i.firstChild;)i.removeChild(i.firstChild);r=this.collapseFormatter(this.generateCollapsedRowData(e)),r&&i.appendChild(r),e.calcHeight(!0)}}generateCollapsedRowData(e){var i=e.getData(),r=[],n;return this.hiddenColumns.forEach(a=>{var o=a.getFieldValue(i);if(a.definition.title&&a.field)if(a.modules.format&&this.table.options.responsiveLayoutCollapseUseFormatters){let s=function(l){l()};n={value:!1,data:{},getValue:function(){return o},getData:function(){return i},getType:function(){return"cell"},getElement:function(){return document.createElement("div")},getRow:function(){return e.getComponent()},getColumn:function(){return a.getComponent()},getTable:()=>this.table},r.push({field:a.field,title:a.definition.title,value:a.modules.format.formatter.call(this.table.modules.format,n,a.modules.format.params,s)})}else r.push({field:a.field,title:a.definition.title,value:o})}),r}formatCollapsedData(e){var i=document.createElement("table");return e.forEach(r=>{var n=document.createElement("tr"),a=document.createElement("td"),o=document.createElement("td"),s,l=document.createElement("strong");a.appendChild(l),this.modules.localize.bind("columns|"+r.field,function(u){l.innerHTML=u||r.title}),r.value instanceof Node?(s=document.createElement("div"),s.appendChild(r.value),o.appendChild(s)):o.innerHTML=r.value,n.appendChild(a),n.appendChild(o),i.appendChild(n)}),Object.keys(e).length?i:""}}Ve(O1,"moduleName","responsiveLayout"),Ve(O1,"moduleExtensions",Cve);function Mve(t,e,i){var r=document.createElement("input"),n=!1;if(r.type="checkbox",r.setAttribute("aria-label","Select Row"),this.table.modExists("selectRow",!0))if(r.addEventListener("click",o=>{o.stopPropagation()}),typeof t.getRow=="function"){var a=t.getRow();a instanceof qD?(r.addEventListener("change",o=>{this.table.options.selectableRowsRangeMode==="click"&&n?n=!1:a.toggleSelect()}),this.table.options.selectableRowsRangeMode==="click"&&r.addEventListener("click",o=>{n=!0,this.table.modules.selectRow.handleComplexRowClick(a._row,o)}),r.checked=a.isSelected&&a.isSelected(),this.table.modules.selectRow.registerRowSelectCheckbox(a,r)):r=""}else r.addEventListener("change",o=>{this.table.modules.selectRow.selectedRows.length?this.table.deselectRow():this.table.selectRow(e.rowRange)}),this.table.modules.selectRow.registerHeaderSelectCheckbox(r);return r}var Nve={format:{formatters:{rowSelection:Mve}}};class k1 extends ci{constructor(e){super(e),this.selecting=!1,this.lastClickedRow=!1,this.selectPrev=[],this.selectedRows=[],this.headerCheckboxElement=null,this.registerTableOption("selectableRows","highlight"),this.registerTableOption("selectableRowsRangeMode","drag"),this.registerTableOption("selectableRowsRollingSelection",!0),this.registerTableOption("selectableRowsPersistence",!0),this.registerTableOption("selectableRowsCheck",function(i,r){return!0}),this.registerTableFunction("selectRow",this.selectRows.bind(this)),this.registerTableFunction("deselectRow",this.deselectRows.bind(this)),this.registerTableFunction("toggleSelectRow",this.toggleRow.bind(this)),this.registerTableFunction("getSelectedRows",this.getSelectedRows.bind(this)),this.registerTableFunction("getSelectedData",this.getSelectedData.bind(this)),this.registerComponentFunction("row","select",this.selectRows.bind(this)),this.registerComponentFunction("row","deselect",this.deselectRows.bind(this)),this.registerComponentFunction("row","toggleSelect",this.toggleRow.bind(this)),this.registerComponentFunction("row","isSelected",this.isRowSelected.bind(this))}initialize(){this.deprecatedOptionsCheck(),this.table.options.selectableRows==="highlight"&&this.table.options.selectableRange&&(this.table.options.selectableRows=!1),this.table.options.selectableRows!==!1&&(this.subscribe("row-init",this.initializeRow.bind(this)),this.subscribe("row-deleting",this.rowDeleted.bind(this)),this.subscribe("rows-wipe",this.clearSelectionData.bind(this)),this.subscribe("rows-retrieve",this.rowRetrieve.bind(this)),this.table.options.selectableRows&&!this.table.options.selectableRowsPersistence&&this.subscribe("data-refreshing",this.deselectRows.bind(this)))}deprecatedOptionsCheck(){}rowRetrieve(e,i){return e==="selected"?this.selectedRows:i}rowDeleted(e){this._deselectRow(e,!0)}clearSelectionData(e){var i=this.selectedRows.length;this.selecting=!1,this.lastClickedRow=!1,this.selectPrev=[],this.selectedRows=[],i&&e!==!0&&this._rowSelectionChanged()}initializeRow(e){var i=this,r=i.checkRowSelectability(e),n=e.getElement(),a=function(){setTimeout(function(){i.selecting=!1},50),document.body.removeEventListener("mouseup",a)};e.modules.select={selected:!1},n.classList.toggle("tabulator-selectable",r),n.classList.toggle("tabulator-unselectable",!r),i.checkRowSelectability(e)&&i.table.options.selectableRows&&i.table.options.selectableRows!="highlight"&&(i.table.options.selectableRowsRangeMode==="click"?n.addEventListener("click",this.handleComplexRowClick.bind(this,e)):(n.addEventListener("click",function(o){(!i.table.modExists("edit")||!i.table.modules.edit.getCurrentCell())&&i.table._clearSelection(),i.selecting||i.toggleRow(e)}),n.addEventListener("mousedown",function(o){if(o.shiftKey)return i.table._clearSelection(),i.selecting=!0,i.selectPrev=[],document.body.addEventListener("mouseup",a),document.body.addEventListener("keyup",a),i.toggleRow(e),!1}),n.addEventListener("mouseenter",function(o){i.selecting&&(i.table._clearSelection(),i.toggleRow(e),i.selectPrev[1]==e&&i.toggleRow(i.selectPrev[0]))}),n.addEventListener("mouseout",function(o){i.selecting&&(i.table._clearSelection(),i.selectPrev.unshift(e))})))}handleComplexRowClick(e,i){if(i.shiftKey){this.table._clearSelection(),this.lastClickedRow=this.lastClickedRow||e;var r=this.table.rowManager.getDisplayRowIndex(this.lastClickedRow),n=this.table.rowManager.getDisplayRowIndex(e),a=r<=n?r:n,o=r>=n?r:n,s=this.table.rowManager.getDisplayRows().slice(0),l=s.splice(a,o-a+1);i.ctrlKey||i.metaKey?(l.forEach(u=>{u!==this.lastClickedRow&&(this.table.options.selectableRows!==!0&&!this.isRowSelected(e)?this.selectedRows.length<this.table.options.selectableRows&&this.toggleRow(u):this.toggleRow(u))}),this.lastClickedRow=e):(this.deselectRows(void 0,!0),this.table.options.selectableRows!==!0&&l.length>this.table.options.selectableRows&&(l=l.slice(0,this.table.options.selectableRows)),this.selectRows(l)),this.table._clearSelection()}else i.ctrlKey||i.metaKey?(this.toggleRow(e),this.lastClickedRow=e):(this.deselectRows(void 0,!0),this.selectRows(e),this.lastClickedRow=e)}checkRowSelectability(e){return e&&e.type==="row"?this.table.options.selectableRowsCheck.call(this.table,e.getComponent()):!1}toggleRow(e){this.checkRowSelectability(e)&&(e.modules.select&&e.modules.select.selected?this._deselectRow(e):this._selectRow(e))}selectRows(e){var i=[],r,n;switch(typeof e){case"undefined":r=this.table.rowManager.rows;break;case"number":r=this.table.rowManager.findRow(e);break;case"string":r=this.table.rowManager.findRow(e),r||(r=this.table.rowManager.getRows(e));break;default:r=e;break}Array.isArray(r)?r.length&&(r.forEach(a=>{n=this._selectRow(a,!0,!0),n&&i.push(n)}),this._rowSelectionChanged(!1,i)):r&&this._selectRow(r,!1,!0)}_selectRow(e,i,r){if(!isNaN(this.table.options.selectableRows)&&this.table.options.selectableRows!==!0&&!r&&this.selectedRows.length>=this.table.options.selectableRows)if(this.table.options.selectableRowsRollingSelection)this._deselectRow(this.selectedRows[0]);else return!1;var n=this.table.rowManager.findRow(e);if(n){if(this.selectedRows.indexOf(n)==-1)return n.getElement().classList.add("tabulator-selected"),n.modules.select||(n.modules.select={}),n.modules.select.selected=!0,n.modules.select.checkboxEl&&(n.modules.select.checkboxEl.checked=!0),this.selectedRows.push(n),this.table.options.dataTreeSelectPropagate&&this.childRowSelection(n,!0),this.dispatchExternal("rowSelected",n.getComponent()),this._rowSelectionChanged(i,n),n}else i||console.warn("Selection Error - No such row found, ignoring selection:"+e)}isRowSelected(e){return this.selectedRows.indexOf(e)!==-1}deselectRows(e,i){var r=[],n,a;switch(typeof e){case"undefined":n=Object.assign([],this.selectedRows);break;case"number":n=this.table.rowManager.findRow(e);break;case"string":n=this.table.rowManager.findRow(e),n||(n=this.table.rowManager.getRows(e));break;default:n=e;break}Array.isArray(n)?n.length&&(n.forEach(o=>{a=this._deselectRow(o,!0,!0),a&&r.push(a)}),this._rowSelectionChanged(i,[],r)):n&&this._deselectRow(n,i,!0)}_deselectRow(e,i){var r=this,n=r.table.rowManager.findRow(e),a,o;if(n){if(a=r.selectedRows.findIndex(function(s){return s==n}),a>-1)return o=n.getElement(),o&&o.classList.remove("tabulator-selected"),n.modules.select||(n.modules.select={}),n.modules.select.selected=!1,n.modules.select.checkboxEl&&(n.modules.select.checkboxEl.checked=!1),r.selectedRows.splice(a,1),this.table.options.dataTreeSelectPropagate&&this.childRowSelection(n,!1),this.dispatchExternal("rowDeselected",n.getComponent()),r._rowSelectionChanged(i,void 0,n),n}else i||console.warn("Deselection Error - No such row found, ignoring selection:"+e)}getSelectedData(){var e=[];return this.selectedRows.forEach(function(i){e.push(i.getData())}),e}getSelectedRows(){var e=[];return this.selectedRows.forEach(function(i){e.push(i.getComponent())}),e}_rowSelectionChanged(e,i=[],r=[]){this.headerCheckboxElement&&(this.selectedRows.length===0?(this.headerCheckboxElement.checked=!1,this.headerCheckboxElement.indeterminate=!1):this.table.rowManager.rows.length===this.selectedRows.length?(this.headerCheckboxElement.checked=!0,this.headerCheckboxElement.indeterminate=!1):(this.headerCheckboxElement.indeterminate=!0,this.headerCheckboxElement.checked=!1)),e||(Array.isArray(i)||(i=[i]),i=i.map(n=>n.getComponent()),Array.isArray(r)||(r=[r]),r=r.map(n=>n.getComponent()),this.dispatchExternal("rowSelectionChanged",this.getSelectedData(),this.getSelectedRows(),i,r))}registerRowSelectCheckbox(e,i){e._row.modules.select||(e._row.modules.select={}),e._row.modules.select.checkboxEl=i}registerHeaderSelectCheckbox(e){this.headerCheckboxElement=e}childRowSelection(e,i){var r=this.table.modules.dataTree.getChildren(e,!0,!0);if(i)for(let n of r)this._selectRow(n,!0);else for(let n of r)this._deselectRow(n,!0)}}Ve(k1,"moduleName","selectRow"),Ve(k1,"moduleExtensions",Nve);class Ave{constructor(e){return this._range=e,new Proxy(this,{get:function(i,r,n){return typeof i[r]<"u"?i[r]:i._range.table.componentFunctionBinder.handle("range",i._range,r)}})}getElement(){return this._range.element}getData(){return this._range.getData()}getCells(){return this._range.getCells(!0,!0)}getStructuredCells(){return this._range.getStructuredCells()}getRows(){return this._range.getRows().map(e=>e.getComponent())}getColumns(){return this._range.getColumns().map(e=>e.getComponent())}getBounds(){return this._range.getBounds()}getTopEdge(){return this._range.top}getBottomEdge(){return this._range.bottom}getLeftEdge(){return this._range.left}getRightEdge(){return this._range.right}setBounds(e,i){this._range.destroyedGuard("setBounds")&&this._range.setBounds(e&&e._cell,i&&i._cell)}setStartBound(e){this._range.destroyedGuard("setStartBound")&&(this._range.setEndBound(e&&e._cell),this._range.rangeManager.layoutElement())}setEndBound(e){this._range.destroyedGuard("setEndBound")&&(this._range.setEndBound(e&&e._cell),this._range.rangeManager.layoutElement())}clearValues(){this._range.destroyedGuard("clearValues")&&this._range.clearValues()}remove(){this._range.destroyedGuard("remove")&&this._range.destroy(!0)}}class Ove extends Ka{constructor(e,i,r,n){super(e),this.rangeManager=i,this.element=null,this.initialized=!1,this.initializing={start:!1,end:!1},this.destroyed=!1,this.top=0,this.bottom=0,this.left=0,this.right=0,this.table=e,this.start={row:0,col:0},this.end={row:0,col:0},this.rangeManager.rowHeader&&(this.left=1,this.right=1,this.start.col=1,this.end.col=1),this.initElement(),setTimeout(()=>{this.initBounds(r,n)})}initElement(){this.element=document.createElement("div"),this.element.classList.add("tabulator-range")}initBounds(e,i){this._updateMinMax(),e&&this.setBounds(e,i||e)}setStart(e,i){(this.start.row!==e||this.start.col!==i)&&(this.start.row=e,this.start.col=i,this.initializing.start=!0,this._updateMinMax())}setEnd(e,i){(this.end.row!==e||this.end.col!==i)&&(this.end.row=e,this.end.col=i,this.initializing.end=!0,this._updateMinMax())}setBounds(e,i,r){e&&this.setStartBound(e),this.setEndBound(i||e),this.rangeManager.layoutElement(r)}setStartBound(e){var i,r;e.type==="column"?this.rangeManager.columnSelection&&this.setStart(0,e.getPosition()-1):(i=e.row.position-1,r=e.column.getPosition()-1,e.column===this.rangeManager.rowHeader?this.setStart(i,1):this.setStart(i,r))}setEndBound(e){var i=this._getTableRows().length,r,n,a;e.type==="column"?this.rangeManager.columnSelection&&(this.rangeManager.selecting==="column"?this.setEnd(i-1,e.getPosition()-1):this.rangeManager.selecting==="cell"&&this.setEnd(0,e.getPosition()-1)):(r=e.row.position-1,n=e.column.getPosition()-1,a=e.column===this.rangeManager.rowHeader,this.rangeManager.selecting==="row"?this.setEnd(r,this._getTableColumns().length-1):this.rangeManager.selecting!=="row"&&a?this.setEnd(r,0):this.rangeManager.selecting==="column"?this.setEnd(i-1,n):this.setEnd(r,n))}_updateMinMax(){this.top=Math.min(this.start.row,this.end.row),this.bottom=Math.max(this.start.row,this.end.row),this.left=Math.min(this.start.col,this.end.col),this.right=Math.max(this.start.col,this.end.col),this.initialized?this.dispatchExternal("rangeChanged",this.getComponent()):this.initializing.start&&this.initializing.end&&(this.initialized=!0,this.dispatchExternal("rangeAdded",this.getComponent()))}_getTableColumns(){return this.table.columnManager.getVisibleColumnsByIndex()}_getTableRows(){return this.table.rowManager.getDisplayRows().filter(e=>e.type==="row")}layout(){var e=this.table.rowManager.renderer.vDomTop,i=this.table.rowManager.renderer.vDomBottom,r=this.table.columnManager.renderer.leftCol,n=this.table.columnManager.renderer.rightCol,a,o,s,l,u,c,d,p,m,h;this.table.options.renderHorizontal==="virtual"&&this.rangeManager.rowHeader&&(n+=1),e==null&&(e=0),i==null&&(i=1/0),r==null&&(r=0),n==null&&(n=1/0),this.overlaps(r,e,n,i)&&(a=Math.max(this.top,e),o=Math.min(this.bottom,i),s=Math.max(this.left,r),l=Math.min(this.right,n),u=this.rangeManager.getCell(a,s),c=this.rangeManager.getCell(o,l),d=u.getElement(),p=c.getElement(),m=u.row.getElement(),h=c.row.getElement(),this.element.classList.add("tabulator-range-active"),this.table.rtl?(this.element.style.right=m.offsetWidth-d.offsetLeft-d.offsetWidth+"px",this.element.style.width=d.offsetLeft+d.offsetWidth-p.offsetLeft+"px"):(this.element.style.left=m.offsetLeft+d.offsetLeft+"px",this.element.style.width=p.offsetLeft+p.offsetWidth-d.offsetLeft+"px"),this.element.style.top=m.offsetTop+"px",this.element.style.height=h.offsetTop+h.offsetHeight-m.offsetTop+"px")}atTopLeft(e){return e.row.position-1===this.top&&e.column.getPosition()-1===this.left}atBottomRight(e){return e.row.position-1===this.bottom&&e.column.getPosition()-1===this.right}occupies(e){return this.occupiesRow(e.row)&&this.occupiesColumn(e.column)}occupiesRow(e){return this.top<=e.position-1&&e.position-1<=this.bottom}occupiesColumn(e){return this.left<=e.getPosition()-1&&e.getPosition()-1<=this.right}overlaps(e,i,r,n){return!(this.left>r||e>this.right||this.top>n||i>this.bottom)}getData(){var e=[],i=this.getRows(),r=this.getColumns();return i.forEach(n=>{var a=n.getData(),o={};r.forEach(s=>{o[s.field]=a[s.field]}),e.push(o)}),e}getCells(e,i){var r=[],n=this.getRows(),a=this.getColumns();return e?r=n.map(o=>{var s=[];return o.getCells().forEach(l=>{a.includes(l.column)&&s.push(i?l.getComponent():l)}),s}):n.forEach(o=>{o.getCells().forEach(s=>{a.includes(s.column)&&r.push(i?s.getComponent():s)})}),r}getStructuredCells(){return this.getCells(!0,!0)}getRows(){return this._getTableRows().slice(this.top,this.bottom+1)}getColumns(){return this._getTableColumns().slice(this.left,this.right+1)}clearValues(){var e=this.getCells(),i=this.table.options.selectableRangeClearCellsValue;this.table.blockRedraw(),e.forEach(r=>{r.setValue(i)}),this.table.restoreRedraw()}getBounds(e){var i=this.getCells(!1,e),r={start:null,end:null};return i.length?(r.start=i[0],r.end=i[i.length-1]):console.warn("No bounds defined on range"),r}getComponent(){return this.component||(this.component=new Ave(this)),this.component}destroy(e){this.destroyed=!0,this.element.remove(),e&&this.rangeManager.rangeRemoved(this),this.initialized&&this.dispatchExternal("rangeRemoved",this.getComponent())}destroyedGuard(e){return this.destroyed&&console.warn("You cannot call the "+e+" function on a destroyed range"),!this.destroyed}}var kve={rangeJumpUp:["ctrl + 38","meta + 38"],rangeJumpDown:["ctrl + 40","meta + 40"],rangeJumpLeft:["ctrl + 37","meta + 37"],rangeJumpRight:["ctrl + 39","meta + 39"],rangeExpandUp:"shift + 38",rangeExpandDown:"shift + 40",rangeExpandLeft:"shift + 37",rangeExpandRight:"shift + 39",rangeExpandJumpUp:["ctrl + shift + 38","meta + shift + 38"],rangeExpandJumpDown:["ctrl + shift + 40","meta + shift + 40"],rangeExpandJumpLeft:["ctrl + shift + 37","meta + shift + 37"],rangeExpandJumpRight:["ctrl + shift + 39","meta + shift + 39"]},xve={rangeJumpLeft:function(t){this.dispatch("keybinding-nav-range",t,"left",!0,!1)},rangeJumpRight:function(t){this.dispatch("keybinding-nav-range",t,"right",!0,!1)},rangeJumpUp:function(t){this.dispatch("keybinding-nav-range",t,"up",!0,!1)},rangeJumpDown:function(t){this.dispatch("keybinding-nav-range",t,"down",!0,!1)},rangeExpandLeft:function(t){this.dispatch("keybinding-nav-range",t,"left",!1,!0)},rangeExpandRight:function(t){this.dispatch("keybinding-nav-range",t,"right",!1,!0)},rangeExpandUp:function(t){this.dispatch("keybinding-nav-range",t,"up",!1,!0)},rangeExpandDown:function(t){this.dispatch("keybinding-nav-range",t,"down",!1,!0)},rangeExpandJumpLeft:function(t){this.dispatch("keybinding-nav-range",t,"left",!0,!0)},rangeExpandJumpRight:function(t){this.dispatch("keybinding-nav-range",t,"right",!0,!0)},rangeExpandJumpUp:function(t){this.dispatch("keybinding-nav-range",t,"up",!0,!0)},rangeExpandJumpDown:function(t){this.dispatch("keybinding-nav-range",t,"down",!0,!0)}},Fve={range:function(t){var e=[],i=this.table.modules.selectRange.activeRange,r=!1,n,a,o,s,l;return l=t.length,i&&(n=i.getBounds(),a=n.start,n.start===n.end&&(r=!0),a&&(e=this.table.rowManager.activeRows.slice(),o=e.indexOf(a.row),r?s=t.length:s=e.indexOf(n.end.row)-o+1,o>-1&&(this.table.blockRedraw(),e=e.slice(o,o+s),e.forEach((u,c)=>{u.updateData(t[c%l])}),this.table.restoreRedraw()))),e}},Lve={range:function(t){var e=[],i=[],r=this.table.modules.selectRange.activeRange,n=!1,a,o,s,l,u;return r&&(a=r.getBounds(),o=a.start,a.start===a.end&&(n=!0),o&&(t=t.split(`
`),t.forEach(function(c){e.push(c.split("	"))}),e.length&&(l=this.table.columnManager.getVisibleColumnsByIndex(),u=l.indexOf(o.column),u>-1)))?(n?s=e[0].length:s=l.indexOf(a.end.column)-u+1,l=l.slice(u,u+s),e.forEach(c=>{var d={},p=c.length;l.forEach(function(m,h){d[m.field]=c[h%p]}),i.push(d)}),i):!1}},_ve={range:function(){var t=this.modules.selectRange.selectedColumns();return this.columnManager.rowHeader&&t.unshift(this.columnManager.rowHeader),t}},$ve={range:function(){return this.modules.selectRange.selectedRows()}},Bve={keybindings:{bindings:kve,actions:xve},clipboard:{pasteActions:Fve,pasteParsers:Lve},export:{columnLookups:_ve,rowLookups:$ve}};class BU extends ci{constructor(e){super(e),this.selecting="cell",this.mousedown=!1,this.ranges=[],this.overlay=null,this.rowHeader=null,this.layoutChangeTimeout=null,this.columnSelection=!1,this.rowSelection=!1,this.maxRanges=0,this.activeRange=!1,this.blockKeydown=!1,this.keyDownEvent=this._handleKeyDown.bind(this),this.mouseUpEvent=this._handleMouseUp.bind(this),this.registerTableOption("selectableRange",!1),this.registerTableOption("selectableRangeColumns",!1),this.registerTableOption("selectableRangeRows",!1),this.registerTableOption("selectableRangeClearCells",!1),this.registerTableOption("selectableRangeClearCellsValue",void 0),this.registerTableFunction("getRangesData",this.getRangesData.bind(this)),this.registerTableFunction("getRanges",this.getRanges.bind(this)),this.registerTableFunction("addRange",this.addRangeFromComponent.bind(this)),this.registerComponentFunction("cell","getRanges",this.cellGetRanges.bind(this)),this.registerComponentFunction("row","getRanges",this.rowGetRanges.bind(this)),this.registerComponentFunction("column","getRanges",this.colGetRanges.bind(this))}initialize(){this.options("selectableRange")&&(this.options("selectableRows")?console.warn("SelectRange functionality cannot be used in conjunction with row selection"):(this.maxRanges=this.options("selectableRange"),this.initializeTable(),this.initializeWatchers()),this.options("columns").findIndex(e=>e.frozen)>0&&console.warn("Having frozen column in arbitrary position with selectRange option may result in unpredictable behavior."),this.options("columns").filter(e=>e.frozen)>1&&console.warn("Having multiple frozen columns with selectRange option may result in unpredictable behavior."))}initializeTable(){this.overlay=document.createElement("div"),this.overlay.classList.add("tabulator-range-overlay"),this.rangeContainer=document.createElement("div"),this.rangeContainer.classList.add("tabulator-range-container"),this.activeRangeCellElement=document.createElement("div"),this.activeRangeCellElement.classList.add("tabulator-range-cell-active"),this.overlay.appendChild(this.rangeContainer),this.overlay.appendChild(this.activeRangeCellElement),this.table.rowManager.element.addEventListener("keydown",this.keyDownEvent),this.resetRanges(),this.table.rowManager.element.appendChild(this.overlay),this.table.columnManager.element.setAttribute("tabindex",0),this.table.element.classList.add("tabulator-ranges")}initializeWatchers(){this.columnSelection=this.options("selectableRangeColumns"),this.rowSelection=this.options("selectableRangeRows"),this.subscribe("column-init",this.initializeColumn.bind(this)),this.subscribe("column-mousedown",this.handleColumnMouseDown.bind(this)),this.subscribe("column-mousemove",this.handleColumnMouseMove.bind(this)),this.subscribe("column-resized",this.handleColumnResized.bind(this)),this.subscribe("column-moving",this.handleColumnMoving.bind(this)),this.subscribe("column-moved",this.handleColumnMoved.bind(this)),this.subscribe("column-width",this.layoutChange.bind(this)),this.subscribe("column-height",this.layoutChange.bind(this)),this.subscribe("column-resized",this.layoutChange.bind(this)),this.subscribe("columns-loaded",this.updateHeaderColumn.bind(this)),this.subscribe("cell-height",this.layoutChange.bind(this)),this.subscribe("cell-rendered",this.renderCell.bind(this)),this.subscribe("cell-mousedown",this.handleCellMouseDown.bind(this)),this.subscribe("cell-mousemove",this.handleCellMouseMove.bind(this)),this.subscribe("cell-click",this.handleCellClick.bind(this)),this.subscribe("cell-editing",this.handleEditingCell.bind(this)),this.subscribe("page-changed",this.redraw.bind(this)),this.subscribe("scroll-vertical",this.layoutChange.bind(this)),this.subscribe("scroll-horizontal",this.layoutChange.bind(this)),this.subscribe("data-destroy",this.tableDestroyed.bind(this)),this.subscribe("data-processed",this.resetRanges.bind(this)),this.subscribe("table-layout",this.layoutElement.bind(this)),this.subscribe("table-redraw",this.redraw.bind(this)),this.subscribe("table-destroy",this.tableDestroyed.bind(this)),this.subscribe("edit-editor-clear",this.finishEditingCell.bind(this)),this.subscribe("edit-blur",this.restoreFocus.bind(this)),this.subscribe("keybinding-nav-prev",this.keyNavigate.bind(this,"left")),this.subscribe("keybinding-nav-next",this.keyNavigate.bind(this,"right")),this.subscribe("keybinding-nav-left",this.keyNavigate.bind(this,"left")),this.subscribe("keybinding-nav-right",this.keyNavigate.bind(this,"right")),this.subscribe("keybinding-nav-up",this.keyNavigate.bind(this,"up")),this.subscribe("keybinding-nav-down",this.keyNavigate.bind(this,"down")),this.subscribe("keybinding-nav-range",this.keyNavigateRange.bind(this))}initializeColumn(e){this.columnSelection&&e.definition.headerSort&&this.options("headerSortClickElement")!=="icon"&&console.warn("Using column headerSort with selectableRangeColumns option may result in unpredictable behavior. Consider using headerSortClickElement: 'icon'."),e.modules.edit}updateHeaderColumn(){var e;this.rowSelection&&(this.rowHeader=this.table.columnManager.getVisibleColumnsByIndex()[0],this.rowHeader&&(this.rowHeader.definition.cssClass=this.rowHeader.definition.cssClass+" tabulator-range-row-header",this.rowHeader.definition.headerSort&&console.warn("Using column headerSort with selectableRangeRows option may result in unpredictable behavior"),this.rowHeader.definition.editor&&console.warn("Using column editor with selectableRangeRows option may result in unpredictable behavior"))),this.table.modules.frozenColumns&&this.table.modules.frozenColumns.active&&(e=this.table.modules.frozenColumns.getFrozenColumns(),(e.length>1||e.length===1&&e[0]!==this.rowHeader)&&console.warn("Using frozen columns that are not the range header in combination with the selectRange option may result in unpredictable behavior"))}getRanges(){return this.ranges.map(e=>e.getComponent())}getRangesData(){return this.ranges.map(e=>e.getData())}addRangeFromComponent(e,i){return e=e?e._cell:null,i=i?i._cell:null,this.addRange(e,i)}cellGetRanges(e){var i=[];return e.column===this.rowHeader?i=this.ranges.filter(r=>r.occupiesRow(e.row)):i=this.ranges.filter(r=>r.occupies(e)),i.map(r=>r.getComponent())}rowGetRanges(e){var i=this.ranges.filter(r=>r.occupiesRow(e));return i.map(r=>r.getComponent())}colGetRanges(e){var i=this.ranges.filter(r=>r.occupiesColumn(e));return i.map(r=>r.getComponent())}_handleMouseUp(e){this.mousedown=!1,document.removeEventListener("mouseup",this.mouseUpEvent)}_handleKeyDown(e){if(!this.blockKeydown&&(!this.table.modules.edit||this.table.modules.edit&&!this.table.modules.edit.currentCell)){if(e.key==="Enter"){if(this.table.modules.edit&&this.table.modules.edit.currentCell)return;this.table.modules.edit.editCell(this.getActiveCell()),e.preventDefault()}(e.key==="Backspace"||e.key==="Delete")&&this.options("selectableRangeClearCells")&&this.activeRange&&this.activeRange.clearValues()}}initializeFocus(e){var i;this.restoreFocus();try{document.selection?(i=document.body.createTextRange(),i.moveToElementText(e.getElement()),i.select()):window.getSelection&&(i=document.createRange(),i.selectNode(e.getElement()),window.getSelection().removeAllRanges(),window.getSelection().addRange(i))}catch{}}restoreFocus(e){return this.table.rowManager.element.focus(),!0}handleColumnResized(e){var i;this.selecting!=="column"&&this.selecting!=="all"||(i=this.ranges.some(r=>r.occupiesColumn(e)),i&&this.ranges.forEach(r=>{var n=r.getColumns(!0);n.forEach(a=>{a!==e&&a.setWidth(e.width)})}))}handleColumnMoving(e,i){this.resetRanges().setBounds(i),this.overlay.style.visibility="hidden"}handleColumnMoved(e,i,r){this.activeRange.setBounds(e),this.layoutElement()}handleColumnMouseDown(e,i){e.button===2&&(this.selecting==="column"||this.selecting==="all")&&this.activeRange.occupiesColumn(i)||this.table.options.movableColumns&&this.selecting==="column"&&this.activeRange.occupiesColumn(i)||(this.mousedown=!0,document.addEventListener("mouseup",this.mouseUpEvent),this.newSelection(e,i))}handleColumnMouseMove(e,i){i===this.rowHeader||!this.mousedown||this.selecting==="all"||this.activeRange.setBounds(!1,i,!0)}renderCell(e){var i=e.getElement(),r=this.ranges.findIndex(n=>n.occupies(e));i.classList.toggle("tabulator-range-selected",r!==-1),i.classList.toggle("tabulator-range-only-cell-selected",this.ranges.length===1&&this.ranges[0].atTopLeft(e)&&this.ranges[0].atBottomRight(e)),i.dataset.range=r}handleCellMouseDown(e,i){e.button===2&&(this.activeRange.occupies(i)||(this.selecting==="row"||this.selecting==="all")&&this.activeRange.occupiesRow(i.row))||(this.mousedown=!0,document.addEventListener("mouseup",this.mouseUpEvent),this.newSelection(e,i))}handleCellMouseMove(e,i){!this.mousedown||this.selecting==="all"||this.activeRange.setBounds(!1,i,!0)}handleCellClick(e,i){this.initializeFocus(i)}handleEditingCell(e){this.activeRange&&this.activeRange.setBounds(e)}finishEditingCell(){this.blockKeydown=!0,this.table.rowManager.element.focus(),setTimeout(()=>{this.blockKeydown=!1},10)}keyNavigate(e,i){this.navigate(!1,!1,e),i.preventDefault()}keyNavigateRange(e,i,r,n){this.navigate(r,n,i),e.preventDefault()}navigate(e,i,r){var n=!1,a,o,s,l,u,c;if(this.table.modules.edit&&this.table.modules.edit.currentCell)return!1;if(this.ranges.length>1&&(this.ranges=this.ranges.filter(d=>d===this.activeRange?(d.setEnd(d.start.row,d.start.col),!0):(d.destroy(),!1))),a=this.activeRange,o=i?a.end:a.start,s=o.row,l=o.col,e)switch(r){case"left":l=this.findJumpCellLeft(a.start.row,o.col);break;case"right":l=this.findJumpCellRight(a.start.row,o.col);break;case"up":s=this.findJumpCellUp(o.row,a.start.col);break;case"down":s=this.findJumpCellDown(o.row,a.start.col);break}else{if(i&&(this.selecting==="row"&&(r==="left"||r==="right")||this.selecting==="column"&&(r==="up"||r==="down")))return;switch(r){case"left":l=Math.max(l-1,0);break;case"right":l=Math.min(l+1,this.getTableColumns().length-1);break;case"up":s=Math.max(s-1,0);break;case"down":s=Math.min(s+1,this.getTableRows().length-1);break}}if(this.rowHeader&&l===0&&(l=1),n=l!==o.col||s!==o.row,i||a.setStart(s,l),a.setEnd(s,l),i||(this.selecting="cell"),n)return u=this.getRowByRangePos(a.end.row),c=this.getColumnByRangePos(a.end.col),(r==="left"||r==="right")&&c.getElement().parentNode===null?c.getComponent().scrollTo(void 0,!1):(r==="up"||r==="down")&&u.getElement().parentNode===null?u.getComponent().scrollTo(void 0,!1):this.autoScroll(a,u.getElement(),c.getElement()),this.layoutElement(),!0}rangeRemoved(e){this.ranges=this.ranges.filter(i=>i!==e),this.activeRange===e&&(this.ranges.length?this.activeRange=this.ranges[this.ranges.length-1]:this.addRange()),this.layoutElement()}findJumpRow(e,i,r,n,a){return r&&(i=i.reverse()),this.findJumpItem(n,a,i,function(o){return o.getData()[e.getField()]})}findJumpCol(e,i,r,n,a){return r&&(i=i.reverse()),this.findJumpItem(n,a,i,function(o){return e.getData()[o.getField()]})}findJumpItem(e,i,r,n){var a;for(let o of r){let s=n(o);if(e){if(a=o,s)break}else if(i){if(a=o,s)break}else if(s)a=o;else break}return a}findJumpCellLeft(e,i){var r=this.getRowByRangePos(e),n=this.getTableColumns(),a=this.isEmpty(r.getData()[n[i].getField()]),o=n[i-1]?this.isEmpty(r.getData()[n[i-1].getField()]):!1,s=this.rowHeader?n.slice(1,i):n.slice(0,i),l=this.findJumpCol(r,s,!0,a,o);return l?l.getPosition()-1:i}findJumpCellRight(e,i){var r=this.getRowByRangePos(e),n=this.getTableColumns(),a=this.isEmpty(r.getData()[n[i].getField()]),o=n[i+1]?this.isEmpty(r.getData()[n[i+1].getField()]):!1,s=this.findJumpCol(r,n.slice(i+1,n.length),!1,a,o);return s?s.getPosition()-1:i}findJumpCellUp(e,i){var r=this.getColumnByRangePos(i),n=this.getTableRows(),a=this.isEmpty(n[e].getData()[r.getField()]),o=n[e-1]?this.isEmpty(n[e-1].getData()[r.getField()]):!1,s=this.findJumpRow(r,n.slice(0,e),!0,a,o);return s?s.position-1:e}findJumpCellDown(e,i){var r=this.getColumnByRangePos(i),n=this.getTableRows(),a=this.isEmpty(n[e].getData()[r.getField()]),o=n[e+1]?this.isEmpty(n[e+1].getData()[r.getField()]):!1,s=this.findJumpRow(r,n.slice(e+1,n.length),!1,a,o);return s?s.position-1:e}newSelection(e,i){var r;if(i.type==="column"){if(!this.columnSelection)return;if(i===this.rowHeader){r=this.resetRanges(),this.selecting="all";var n,a=this.getCell(-1,-1);this.rowHeader?n=this.getCell(0,1):n=this.getCell(0,0),r.setBounds(n,a);return}else this.selecting="column"}else i.column===this.rowHeader?this.selecting="row":this.selecting="cell";e.shiftKey?this.activeRange.setBounds(!1,i):e.ctrlKey?this.addRange().setBounds(i):this.resetRanges().setBounds(i)}autoScroll(e,i,r){var n=this.table.rowManager.element,a,o,s,l,u;typeof i>"u"&&(i=this.getRowByRangePos(e.end.row).getElement()),typeof r>"u"&&(r=this.getColumnByRangePos(e.end.col).getElement()),this.rowHeader&&(a=this.rowHeader.getElement()),o={left:r.offsetLeft,right:r.offsetLeft+r.offsetWidth,top:i.offsetTop,bottom:i.offsetTop+i.offsetHeight},s={left:n.scrollLeft,right:Math.ceil(n.scrollLeft+n.clientWidth),top:n.scrollTop,bottom:n.scrollTop+n.offsetHeight-this.table.rowManager.scrollbarWidth},a&&(s.left+=a.offsetWidth),l=s.left<o.left&&o.left<s.right&&s.left<o.right&&o.right<s.right,u=s.top<o.top&&o.top<s.bottom&&s.top<o.bottom&&o.bottom<s.bottom,l||(o.left<s.left?(n.scrollLeft=o.left,a&&(n.scrollLeft-=a.offsetWidth)):o.right>s.right&&(n.scrollLeft=o.right-n.clientWidth)),u||(o.top<s.top?n.scrollTop=o.top:o.bottom>s.bottom&&(n.scrollTop=o.bottom-n.clientHeight))}layoutChange(){this.overlay.style.visibility="hidden",clearTimeout(this.layoutChangeTimeout),this.layoutChangeTimeout=setTimeout(this.layoutRanges.bind(this),200)}redraw(e){e&&(this.selecting="cell",this.resetRanges(),this.layoutElement())}layoutElement(e){var i;e?i=this.table.rowManager.getVisibleRows(!0):i=this.table.rowManager.getRows(),i.forEach(r=>{r.type==="row"&&(this.layoutRow(r),r.cells.forEach(n=>this.renderCell(n)))}),this.getTableColumns().forEach(r=>{this.layoutColumn(r)}),this.layoutRanges()}layoutRow(e){var i=e.getElement(),r=!1,n=this.ranges.some(a=>a.occupiesRow(e));this.selecting==="row"?r=n:this.selecting==="all"&&(r=!0),i.classList.toggle("tabulator-range-selected",r),i.classList.toggle("tabulator-range-highlight",n)}layoutColumn(e){var i=e.getElement(),r=!1,n=this.ranges.some(a=>a.occupiesColumn(e));this.selecting==="column"?r=n:this.selecting==="all"&&(r=!0),i.classList.toggle("tabulator-range-selected",r),i.classList.toggle("tabulator-range-highlight",n)}layoutRanges(){var e,i,r;this.table.initialized&&(e=this.getActiveCell(),e&&(i=e.getElement(),r=e.row.getElement(),this.table.rtl?this.activeRangeCellElement.style.right=r.offsetWidth-i.offsetLeft-i.offsetWidth+"px":this.activeRangeCellElement.style.left=r.offsetLeft+i.offsetLeft+"px",this.activeRangeCellElement.style.top=r.offsetTop+"px",this.activeRangeCellElement.style.width=i.offsetWidth+"px",this.activeRangeCellElement.style.height=r.offsetHeight+"px",this.ranges.forEach(n=>n.layout()),this.overlay.style.visibility="visible"))}getCell(e,i){var r;return i<0&&(i=this.getTableColumns().length+i,i<0)?null:(e<0&&(e=this.getTableRows().length+e),r=this.table.rowManager.getRowFromPosition(e+1),r?r.getCells(!1,!0).filter(n=>n.column.visible)[i]:null)}getActiveCell(){return this.getCell(this.activeRange.start.row,this.activeRange.start.col)}getRowByRangePos(e){return this.getTableRows()[e]}getColumnByRangePos(e){return this.getTableColumns()[e]}getTableRows(){return this.table.rowManager.getDisplayRows().filter(e=>e.type==="row")}getTableColumns(){return this.table.columnManager.getVisibleColumnsByIndex()}addRange(e,i){var r;return this.maxRanges!==!0&&this.ranges.length>=this.maxRanges&&this.ranges.shift().destroy(),r=new Ove(this.table,this,e,i),this.activeRange=r,this.ranges.push(r),this.rangeContainer.appendChild(r.element),r}resetRanges(){var e,i,r;return this.ranges.forEach(n=>n.destroy()),this.ranges=[],e=this.addRange(),this.table.rowManager.activeRows.length&&(r=this.table.rowManager.activeRows[0].cells.filter(n=>n.column.visible),i=r[this.rowHeader?1:0],i&&(e.setBounds(i),this.initializeFocus(i))),e}tableDestroyed(){document.removeEventListener("mouseup",this.mouseUpEvent),this.table.rowManager.element.removeEventListener("keydown",this.keyDownEvent)}selectedRows(e){return e?this.activeRange.getRows().map(i=>i.getComponent()):this.activeRange.getRows()}selectedColumns(e){return e?this.activeRange.getColumns().map(i=>i.getComponent()):this.activeRange.getColumns()}isEmpty(e){return e==null||e===""}}Ve(BU,"moduleName","selectRange"),Ve(BU,"moduleInitOrder",1),Ve(BU,"moduleExtensions",Bve);function Vve(t,e,i,r,n,a,o){var s=o.alignEmptyValues,l=o.decimalSeparator,u=o.thousandSeparator,c=0;if(t=String(t),e=String(e),u&&(t=t.split(u).join(""),e=e.split(u).join("")),l&&(t=t.split(l).join("."),e=e.split(l).join(".")),t=parseFloat(t),e=parseFloat(e),isNaN(t))c=isNaN(e)?0:-1;else if(isNaN(e))c=1;else return t-e;return(s==="top"&&a==="desc"||s==="bottom"&&a==="asc")&&(c*=-1),c}function jve(t,e,i,r,n,a,o){var s=o.alignEmptyValues,l=0,u;if(!t)l=e?-1:0;else if(!e)l=1;else{switch(typeof o.locale){case"boolean":o.locale&&(u=this.langLocale());break;case"string":u=o.locale;break}return String(t).toLowerCase().localeCompare(String(e).toLowerCase(),u)}return(s==="top"&&a==="desc"||s==="bottom"&&a==="asc")&&(l*=-1),l}function Cx(t,e,i,r,n,a,o){var s=window.DateTime||luxon.DateTime,l=o.format||"dd/MM/yyyy HH:mm:ss",u=o.alignEmptyValues,c=0;if(typeof s<"u"){if(s.isDateTime(t)||(l==="iso"?t=s.fromISO(String(t)):t=s.fromFormat(String(t),l)),s.isDateTime(e)||(l==="iso"?e=s.fromISO(String(e)):e=s.fromFormat(String(e),l)),!t.isValid)c=e.isValid?-1:0;else if(!e.isValid)c=1;else return t-e;return(u==="top"&&a==="desc"||u==="bottom"&&a==="asc")&&(c*=-1),c}else console.error("Sort Error - 'datetime' sorter is dependant on luxon.js")}function Gve(t,e,i,r,n,a,o){return o.format||(o.format="dd/MM/yyyy"),Cx.call(this,t,e,i,r,n,a,o)}function Hve(t,e,i,r,n,a,o){return o.format||(o.format="HH:mm"),Cx.call(this,t,e,i,r,n,a,o)}function zve(t,e,i,r,n,a,o){var s=t===!0||t==="true"||t==="True"||t===1?1:0,l=e===!0||e==="true"||e==="True"||e===1?1:0;return s-l}function Wve(t,e,i,r,n,a,o){var s=o.type||"length",l=o.alignEmptyValues,u=0;function c(d){var p;switch(s){case"length":p=d.length;break;case"sum":p=d.reduce(function(m,h){return m+h});break;case"max":p=Math.max.apply(null,d);break;case"min":p=Math.min.apply(null,d);break;case"avg":p=d.reduce(function(m,h){return m+h})/d.length;break}return p}if(!Array.isArray(t))u=Array.isArray(e)?-1:0;else if(!Array.isArray(e))u=1;else return c(e)-c(t);return(l==="top"&&a==="desc"||l==="bottom"&&a==="asc")&&(u*=-1),u}function qve(t,e,i,r,n,a,o){var s=typeof t>"u"?0:1,l=typeof e>"u"?0:1;return s-l}function Yve(t,e,i,r,n,a,o){var s,l,u,c,d=0,p,m=/(\d+)|(\D+)/g,h=/\d/,f=o.alignEmptyValues,g=0;if(!t&&t!==0)g=!e&&e!==0?0:-1;else if(!e&&e!==0)g=1;else{if(isFinite(t)&&isFinite(e))return t-e;if(s=String(t).toLowerCase(),l=String(e).toLowerCase(),s===l)return 0;if(!(h.test(s)&&h.test(l)))return s>l?1:-1;for(s=s.match(m),l=l.match(m),p=s.length>l.length?l.length:s.length;d<p;)if(u=s[d],c=l[d++],u!==c)return isFinite(u)&&isFinite(c)?(u.charAt(0)==="0"&&(u="."+u),c.charAt(0)==="0"&&(c="."+c),u-c):u>c?1:-1;return s.length>l.length}return(f==="top"&&a==="desc"||f==="bottom"&&a==="asc")&&(g*=-1),g}var Kve={number:Vve,string:jve,date:Gve,time:Hve,datetime:Cx,boolean:zve,array:Wve,exists:qve,alphanum:Yve};const zp=class zp extends ci{constructor(e){super(e),this.sortList=[],this.changed=!1,this.registerTableOption("sortMode","local"),this.registerTableOption("initialSort",!1),this.registerTableOption("columnHeaderSortMulti",!0),this.registerTableOption("sortOrderReverse",!1),this.registerTableOption("headerSortElement","<div class='tabulator-arrow'></div>"),this.registerTableOption("headerSortClickElement","header"),this.registerColumnOption("sorter"),this.registerColumnOption("sorterParams"),this.registerColumnOption("headerSort",!0),this.registerColumnOption("headerSortStartingDir"),this.registerColumnOption("headerSortTristate")}initialize(){this.subscribe("column-layout",this.initializeColumn.bind(this)),this.subscribe("table-built",this.tableBuilt.bind(this)),this.registerDataHandler(this.sort.bind(this),20),this.registerTableFunction("setSort",this.userSetSort.bind(this)),this.registerTableFunction("getSorters",this.getSort.bind(this)),this.registerTableFunction("clearSort",this.clearSort.bind(this)),this.table.options.sortMode==="remote"&&this.subscribe("data-params",this.remoteSortParams.bind(this))}tableBuilt(){this.table.options.initialSort&&this.setSort(this.table.options.initialSort)}remoteSortParams(e,i,r,n){var a=this.getSort();return a.forEach(o=>{delete o.column}),n.sort=a,n}userSetSort(e,i){this.setSort(e,i),this.refreshSort()}clearSort(){this.clear(),this.refreshSort()}initializeColumn(e){var i=!1,r,n;switch(typeof e.definition.sorter){case"string":zp.sorters[e.definition.sorter]?i=zp.sorters[e.definition.sorter]:console.warn("Sort Error - No such sorter found: ",e.definition.sorter);break;case"function":i=e.definition.sorter;break}if(e.modules.sort={sorter:i,dir:"none",params:e.definition.sorterParams||{},startingDir:e.definition.headerSortStartingDir||"asc",tristate:e.definition.headerSortTristate},e.definition.headerSort!==!1){switch(r=e.getElement(),r.classList.add("tabulator-sortable"),n=document.createElement("div"),n.classList.add("tabulator-col-sorter"),this.table.options.headerSortClickElement){case"icon":n.classList.add("tabulator-col-sorter-element");break;case"header":r.classList.add("tabulator-col-sorter-element");break;default:r.classList.add("tabulator-col-sorter-element");break}switch(this.table.options.headerSortElement){case"function":break;case"object":n.appendChild(this.table.options.headerSortElement);break;default:n.innerHTML=this.table.options.headerSortElement}e.titleHolderElement.appendChild(n),e.modules.sort.element=n,this.setColumnHeaderSortIcon(e,"none"),this.table.options.headerSortClickElement==="icon"&&n.addEventListener("mousedown",a=>{a.stopPropagation()}),(this.table.options.headerSortClickElement==="icon"?n:r).addEventListener("click",a=>{var o="",s=[],l=!1;if(e.modules.sort){if(e.modules.sort.tristate)e.modules.sort.dir=="none"?o=e.modules.sort.startingDir:e.modules.sort.dir==e.modules.sort.startingDir?o=e.modules.sort.dir=="asc"?"desc":"asc":o="none";else switch(e.modules.sort.dir){case"asc":o="desc";break;case"desc":o="asc";break;default:o=e.modules.sort.startingDir}this.table.options.columnHeaderSortMulti&&(a.shiftKey||a.ctrlKey)?(s=this.getSort(),l=s.findIndex(u=>u.field===e.getField()),l>-1?(s[l].dir=o,l=s.splice(l,1)[0],o!="none"&&s.push(l)):o!="none"&&s.push({column:e,dir:o}),this.setSort(s)):o=="none"?this.clear():this.setSort(e,o),this.refreshSort()}})}}refreshSort(){this.table.options.sortMode==="remote"?this.reloadData(null,!1,!1):this.refreshData(!0)}hasChanged(){var e=this.changed;return this.changed=!1,e}getSort(){var e=this,i=[];return e.sortList.forEach(function(r){r.column&&i.push({column:r.column.getComponent(),field:r.column.getField(),dir:r.dir})}),i}setSort(e,i){var r=this,n=[];Array.isArray(e)||(e=[{column:e,dir:i}]),e.forEach(function(a){var o;o=r.table.columnManager.findColumn(a.column),o?(a.column=o,n.push(a),r.changed=!0):console.warn("Sort Warning - Sort field does not exist and is being ignored: ",a.column)}),r.sortList=n,this.dispatch("sort-changed")}clear(){this.setSort([])}findSorter(e){var i=this.table.rowManager.activeRows[0],r="string",n,a;if(i&&(i=i.getData(),n=e.getField(),n))switch(a=e.getFieldValue(i),typeof a){case"undefined":r="string";break;case"boolean":r="boolean";break;default:!isNaN(a)&&a!==""?r="number":a.match(/((^[0-9]+[a-z]+)|(^[a-z]+[0-9]+))+$/i)&&(r="alphanum");break}return zp.sorters[r]}sort(e,i){var r=this,n=this.table.options.sortOrderReverse?r.sortList.slice().reverse():r.sortList,a=[],o=[];return this.subscribedExternal("dataSorting")&&this.dispatchExternal("dataSorting",r.getSort()),i||r.clearColumnHeaders(),this.table.options.sortMode!=="remote"?(n.forEach(function(s,l){var u;s.column&&(u=s.column.modules.sort,u&&(u.sorter||(u.sorter=r.findSorter(s.column)),s.params=typeof u.params=="function"?u.params(s.column.getComponent(),s.dir):u.params,a.push(s)),i||r.setColumnHeader(s.column,s.dir))}),a.length&&r._sortItems(e,a)):i||n.forEach(function(s,l){r.setColumnHeader(s.column,s.dir)}),this.subscribedExternal("dataSorted")&&(e.forEach(s=>{o.push(s.getComponent())}),this.dispatchExternal("dataSorted",r.getSort(),o)),e}clearColumnHeaders(){this.table.columnManager.getRealColumns().forEach(e=>{e.modules.sort&&(e.modules.sort.dir="none",e.getElement().setAttribute("aria-sort","none"),this.setColumnHeaderSortIcon(e,"none"))})}setColumnHeader(e,i){e.modules.sort.dir=i,e.getElement().setAttribute("aria-sort",i==="asc"?"ascending":"descending"),this.setColumnHeaderSortIcon(e,i)}setColumnHeaderSortIcon(e,i){var r=e.modules.sort.element,n;if(e.definition.headerSort&&typeof this.table.options.headerSortElement=="function"){for(;r.firstChild;)r.removeChild(r.firstChild);n=this.table.options.headerSortElement.call(this.table,e.getComponent(),i),typeof n=="object"?r.appendChild(n):r.innerHTML=n}}_sortItems(e,i){var r=i.length-1;e.sort((n,a)=>{for(var o,s=r;s>=0;s--){let l=i[s];if(o=this._sortRow(n,a,l.column,l.dir,l.params),o!==0)break}return o})}_sortRow(e,i,r,n,a){var o,s,l=n=="asc"?e:i,u=n=="asc"?i:e;return e=r.getFieldValue(l.getData()),i=r.getFieldValue(u.getData()),e=typeof e<"u"?e:"",i=typeof i<"u"?i:"",o=l.getComponent(),s=u.getComponent(),r.modules.sort.sorter.call(this,e,i,o,s,r.getComponent(),n,a)}};Ve(zp,"moduleName","sort"),Ve(zp,"sorters",Kve);let x1=zp;class Xve{constructor(e,i){this.columnCount=e,this.rowCount=i,this.columnString=[],this.columns=[],this.rows=[]}genColumns(e){var i=Math.max(this.columnCount,Math.max(...e.map(r=>r.length)));this.columnString=[],this.columns=[];for(let r=1;r<=i;r++)this.incrementChar(this.columnString.length-1),this.columns.push(this.columnString.join(""));return this.columns}genRows(e){var i=Math.max(this.rowCount,e.length);this.rows=[];for(let r=1;r<=i;r++)this.rows.push(r);return this.rows}incrementChar(e){let i=this.columnString[e];i?i!=="Z"?this.columnString[e]=String.fromCharCode(this.columnString[e].charCodeAt(0)+1):(this.columnString[e]="A",e?this.incrementChar(e-1):this.columnString.push("A")):this.columnString.push("A")}setRowCount(e){this.rowCount=e}setColumnCount(e){this.columnCount=e}}class N7{constructor(e){return this._sheet=e,new Proxy(this,{get:function(i,r,n){return typeof i[r]<"u"?i[r]:i._sheet.table.componentFunctionBinder.handle("sheet",i._sheet,r)}})}getTitle(){return this._sheet.title}getKey(){return this._sheet.key}getDefinition(){return this._sheet.getDefinition()}getData(){return this._sheet.getData()}setData(e){return this._sheet.setData(e)}clear(){return this._sheet.clear()}remove(){return this._sheet.remove()}active(){return this._sheet.active()}setTitle(e){return this._sheet.setTitle(e)}setRows(e){return this._sheet.setRows(e)}setColumns(e){return this._sheet.setColumns(e)}}class _V extends Ka{constructor(e,i){super(e.table),this.spreadsheetManager=e,this.definition=i,this.title=this.definition.title||"",this.key=this.definition.key||this.definition.title,this.rowCount=this.definition.rows,this.columnCount=this.definition.columns,this.data=this.definition.data||[],this.element=null,this.isActive=!1,this.grid=new Xve(this.columnCount,this.rowCount),this.defaultColumnDefinition={width:100,headerHozAlign:"center",headerSort:!1},this.columnDefinition=Object.assign(this.defaultColumnDefinition,this.options("spreadsheetColumnDefinition")),this.columnDefs=[],this.rowDefs=[],this.columnFields=[],this.columns=[],this.rows=[],this.scrollTop=null,this.scrollLeft=null,this.initialize(),this.dispatchExternal("sheetAdded",this.getComponent())}initialize(){this.initializeElement(),this.initializeColumns(),this.initializeRows()}reinitialize(){this.initializeColumns(),this.initializeRows()}initializeElement(){this.element=document.createElement("div"),this.element.classList.add("tabulator-spreadsheet-tab"),this.element.innerText=this.title,this.element.addEventListener("click",()=>{this.spreadsheetManager.loadSheet(this)})}initializeColumns(){this.grid.setColumnCount(this.columnCount),this.columnFields=this.grid.genColumns(this.data),this.columnDefs=[],this.columnFields.forEach(e=>{var i=Object.assign({},this.columnDefinition);i.field=e,i.title=e,this.columnDefs.push(i)})}initializeRows(){var e;this.grid.setRowCount(this.rowCount),e=this.grid.genRows(this.data),this.rowDefs=[],e.forEach((i,r)=>{var n={_id:i},a=this.data[r];a&&a.forEach((o,s)=>{var l=this.columnFields[s];l&&(n[l]=o)}),this.rowDefs.push(n)})}unload(){this.isActive=!1,this.scrollTop=this.table.rowManager.scrollTop,this.scrollLeft=this.table.rowManager.scrollLeft,this.data=this.getData(!0),this.element.classList.remove("tabulator-spreadsheet-tab-active")}load(){var e=!this.isActive;this.isActive=!0,this.table.blockRedraw(),this.table.setData([]),this.table.setColumns(this.columnDefs),this.table.setData(this.rowDefs),this.table.restoreRedraw(),e&&this.scrollTop!==null&&(this.table.rowManager.element.scrollLeft=this.scrollLeft,this.table.rowManager.element.scrollTop=this.scrollTop),this.element.classList.add("tabulator-spreadsheet-tab-active"),this.dispatchExternal("sheetLoaded",this.getComponent())}getComponent(){return new N7(this)}getDefinition(){return{title:this.title,key:this.key,rows:this.rowCount,columns:this.columnCount,data:this.getData()}}getData(e){var i=[],r,n,a;return this.rowDefs.forEach(o=>{var s=[];this.columnFields.forEach(l=>{s.push(o[l])}),i.push(s)}),!e&&!this.options("spreadsheetOutputFull")&&(r=i.map(o=>o.findLastIndex(s=>typeof s<"u")+1),n=Math.max(...r),a=r.findLastIndex(o=>o>0)+1,i=i.slice(0,a),i=i.map(o=>o.slice(0,n))),i}setData(e){this.data=e,this.reinitialize(),this.dispatchExternal("sheetUpdated",this.getComponent()),this.isActive&&this.load()}clear(){this.setData([])}setTitle(e){this.title=e,this.element.innerText=e,this.dispatchExternal("sheetUpdated",this.getComponent())}setRows(e){this.rowCount=e,this.initializeRows(),this.dispatchExternal("sheetUpdated",this.getComponent()),this.isActive&&this.load()}setColumns(e){this.columnCount=e,this.reinitialize(),this.dispatchExternal("sheetUpdated",this.getComponent()),this.isActive&&this.load()}remove(){this.spreadsheetManager.removeSheet(this)}destroy(){this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.dispatchExternal("sheetRemoved",this.getComponent())}active(){this.spreadsheetManager.loadSheet(this)}}class A7 extends ci{constructor(e){super(e),this.sheets=[],this.element=null,this.registerTableOption("spreadsheet",!1),this.registerTableOption("spreadsheetRows",50),this.registerTableOption("spreadsheetColumns",50),this.registerTableOption("spreadsheetColumnDefinition",{}),this.registerTableOption("spreadsheetOutputFull",!1),this.registerTableOption("spreadsheetData",!1),this.registerTableOption("spreadsheetSheets",!1),this.registerTableOption("spreadsheetSheetTabs",!1),this.registerTableOption("spreadsheetSheetTabsElement",!1),this.registerTableFunction("setSheets",this.setSheets.bind(this)),this.registerTableFunction("addSheet",this.addSheet.bind(this)),this.registerTableFunction("getSheets",this.getSheets.bind(this)),this.registerTableFunction("getSheetDefinitions",this.getSheetDefinitions.bind(this)),this.registerTableFunction("setSheetData",this.setSheetData.bind(this)),this.registerTableFunction("getSheet",this.getSheet.bind(this)),this.registerTableFunction("getSheetData",this.getSheetData.bind(this)),this.registerTableFunction("clearSheet",this.clearSheet.bind(this)),this.registerTableFunction("removeSheet",this.removeSheetFunc.bind(this)),this.registerTableFunction("activeSheet",this.activeSheetFunc.bind(this))}initialize(){this.options("spreadsheet")&&(this.subscribe("table-initialized",this.tableInitialized.bind(this)),this.subscribe("data-loaded",this.loadRemoteData.bind(this)),this.table.options.index="_id",this.options("spreadsheetData")&&this.options("spreadsheetSheets")&&(console.warn("You cannot use spreadsheetData and spreadsheetSheets at the same time, ignoring spreadsheetData"),this.table.options.spreadsheetData=!1),this.compatibilityCheck(),this.options("spreadsheetSheetTabs")&&this.initializeTabset())}compatibilityCheck(){this.options("data")&&console.warn("Do not use the data option when working with spreadsheets, use either spreadsheetData or spreadsheetSheets to pass data into the table"),this.options("pagination")&&console.warn("The spreadsheet module is not compatible with the pagination module"),this.options("groupBy")&&console.warn("The spreadsheet module is not compatible with the row grouping module"),this.options("responsiveCollapse")&&console.warn("The spreadsheet module is not compatible with the responsive collapse module")}initializeTabset(){this.element=document.createElement("div"),this.element.classList.add("tabulator-spreadsheet-tabs");var e=this.options("spreadsheetSheetTabsElement");e&&!(e instanceof HTMLElement)&&(e=document.querySelector(e),e||console.warn("Unable to find element matching spreadsheetSheetTabsElement selector:",this.options("spreadsheetSheetTabsElement"))),e?e.appendChild(this.element):this.footerAppend(this.element)}tableInitialized(){this.sheets.length?this.loadSheet(this.sheets[0]):this.options("spreadsheetSheets")?this.loadSheets(this.options("spreadsheetSheets")):this.options("spreadsheetData")&&this.loadData(this.options("spreadsheetData"))}loadRemoteData(e,i,r){return console.log("data",e,i,r),Array.isArray(e)?(this.table.dataLoader.clearAlert(),this.dispatchExternal("dataLoaded",e),!e.length||Array.isArray(e[0])?this.loadData(e):this.loadSheets(e)):console.error(`Spreadsheet Loading Error - Unable to process remote data due to invalid data type 
Expecting: array 
Received: `,typeof e,`
Data:     `,e),!1}loadData(e){var i={data:e};this.loadSheet(this.newSheet(i))}destroySheets(){this.sheets.forEach(e=>{e.destroy()}),this.sheets=[],this.activeSheet=null}loadSheets(e){Array.isArray(e)||(e=[]),this.destroySheets(),e.forEach(i=>{this.newSheet(i)}),this.loadSheet(this.sheets[0])}loadSheet(e){this.activeSheet!==e&&(this.activeSheet&&this.activeSheet.unload(),this.activeSheet=e,e.load())}newSheet(e={}){var i;return e.rows||(e.rows=this.options("spreadsheetRows")),e.columns||(e.columns=this.options("spreadsheetColumns")),i=new _V(this,e),this.sheets.push(i),this.element&&this.element.appendChild(i.element),i}removeSheet(e){var i=this.sheets.indexOf(e),r;this.sheets.length>1?i>-1&&(this.sheets.splice(i,1),e.destroy(),this.activeSheet===e&&(r=this.sheets[i-1]||this.sheets[0],r?this.loadSheet(r):this.activeSheet=null)):console.warn("Unable to remove sheet, at least one sheet must be active")}lookupSheet(e){return e?e instanceof _V?e:e instanceof N7?e._sheet:this.sheets.find(i=>i.key===e)||!1:this.activeSheet}setSheets(e){return this.loadSheets(e),this.getSheets()}addSheet(e){return this.newSheet(e).getComponent()}getSheetDefinitions(){return this.sheets.map(e=>e.getDefinition())}getSheets(){return this.sheets.map(e=>e.getComponent())}getSheet(e){var i=this.lookupSheet(e);return i?i.getComponent():!1}setSheetData(e,i){e&&!i&&(i=e,e=!1);var r=this.lookupSheet(e);return r?r.setData(i):!1}getSheetData(e){var i=this.lookupSheet(e);return i?i.getData():!1}clearSheet(e){var i=this.lookupSheet(e);return i?i.clear():!1}removeSheetFunc(e){var i=this.lookupSheet(e);i&&this.removeSheet(i)}activeSheetFunc(e){var i=this.lookupSheet(e);return i?this.loadSheet(i):!1}}Ve(A7,"moduleName","spreadsheet");class O7 extends ci{constructor(e){super(e),this.tooltipSubscriber=null,this.headerSubscriber=null,this.timeout=null,this.popupInstance=null,this.registerTableOption("tooltipDelay",300),this.registerColumnOption("tooltip"),this.registerColumnOption("headerTooltip")}initialize(){this.deprecatedOptionsCheck(),this.subscribe("column-init",this.initializeColumn.bind(this))}deprecatedOptionsCheck(){}initializeColumn(e){e.definition.headerTooltip&&!this.headerSubscriber&&(this.headerSubscriber=!0,this.subscribe("column-mousemove",this.mousemoveCheck.bind(this,"headerTooltip")),this.subscribe("column-mouseout",this.mouseoutCheck.bind(this,"headerTooltip"))),e.definition.tooltip&&!this.tooltipSubscriber&&(this.tooltipSubscriber=!0,this.subscribe("cell-mousemove",this.mousemoveCheck.bind(this,"tooltip")),this.subscribe("cell-mouseout",this.mouseoutCheck.bind(this,"tooltip")))}mousemoveCheck(e,i,r){var n=e==="tooltip"?r.column.definition.tooltip:r.definition.headerTooltip;n&&(this.clearPopup(),this.timeout=setTimeout(this.loadTooltip.bind(this,i,r,n),this.table.options.tooltipDelay))}mouseoutCheck(e,i,r){this.popupInstance||this.clearPopup()}clearPopup(e,i,r){clearTimeout(this.timeout),this.timeout=null,this.popupInstance&&this.popupInstance.hide()}loadTooltip(e,i,r){var n,a,o;function s(l){a=l}typeof r=="function"&&(r=r(e,i.getComponent(),s)),r instanceof HTMLElement?n=r:(n=document.createElement("div"),r===!0&&(i instanceof Bb?r=i.value:i.definition.field?this.langBind("columns|"+i.definition.field,l=>{n.innerHTML=r=l||i.definition.title}):r=i.definition.title),n.innerHTML=r),(r||r===0||r===!1)&&(n.classList.add("tabulator-tooltip"),n.addEventListener("mousemove",l=>l.preventDefault()),this.popupInstance=this.popup(n),typeof a=="function"&&this.popupInstance.renderCallback(a),o=this.popupInstance.containerEventCoords(e),this.popupInstance.show(o.x+15,o.y+15).hideOnBlur(()=>{this.dispatchExternal("TooltipClosed",i.getComponent()),this.popupInstance=null}),this.dispatchExternal("TooltipOpened",i.getComponent()))}}Ve(O7,"moduleName","tooltip");var Jve={integer:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:(e=Number(e),!isNaN(e)&&isFinite(e)&&Math.floor(e)===e)},float:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:(e=Number(e),!isNaN(e)&&isFinite(e)&&e%1!==0)},numeric:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:!isNaN(e)},string:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:isNaN(e)},alphanumeric:function(t,e,i){if(e===""||e===null||typeof e>"u")return!0;var r=new RegExp(/^[a-z0-9]+$/i);return r.test(e)},max:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:parseFloat(e)<=i},min:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:parseFloat(e)>=i},starts:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:String(e).toLowerCase().startsWith(String(i).toLowerCase())},ends:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:String(e).toLowerCase().endsWith(String(i).toLowerCase())},minLength:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:String(e).length>=i},maxLength:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:String(e).length<=i},in:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:(typeof i=="string"&&(i=i.split("|")),i.indexOf(e)>-1)},regex:function(t,e,i){if(e===""||e===null||typeof e>"u")return!0;var r=new RegExp(i);return r.test(e)},unique:function(t,e,i){if(e===""||e===null||typeof e>"u")return!0;var r=!0,n=t.getData(),a=t.getColumn()._getSelf();return this.table.rowManager.rows.forEach(function(o){var s=o.getData();s!==n&&e==a.getFieldValue(s)&&(r=!1)}),r},required:function(t,e,i){return e!==""&&e!==null&&typeof e<"u"}};const gI=class gI extends ci{constructor(e){super(e),this.invalidCells=[],this.registerTableOption("validationMode","blocking"),this.registerColumnOption("validator"),this.registerTableFunction("getInvalidCells",this.getInvalidCells.bind(this)),this.registerTableFunction("clearCellValidation",this.userClearCellValidation.bind(this)),this.registerTableFunction("validate",this.userValidate.bind(this)),this.registerComponentFunction("cell","isValid",this.cellIsValid.bind(this)),this.registerComponentFunction("cell","clearValidation",this.clearValidation.bind(this)),this.registerComponentFunction("cell","validate",this.cellValidate.bind(this)),this.registerComponentFunction("column","validate",this.columnValidate.bind(this)),this.registerComponentFunction("row","validate",this.rowValidate.bind(this))}initialize(){this.subscribe("cell-delete",this.clearValidation.bind(this)),this.subscribe("column-layout",this.initializeColumnCheck.bind(this)),this.subscribe("edit-success",this.editValidate.bind(this)),this.subscribe("edit-editor-clear",this.editorClear.bind(this)),this.subscribe("edit-edited-clear",this.editedClear.bind(this))}editValidate(e,i,r){var n=this.table.options.validationMode!=="manual"?this.validate(e.column.modules.validate,e,i):!0;return n!==!0&&setTimeout(()=>{e.getElement().classList.add("tabulator-validation-fail"),this.dispatchExternal("validationFailed",e.getComponent(),i,n)}),n}editorClear(e,i){i&&e.column.modules.validate&&this.cellValidate(e),e.getElement().classList.remove("tabulator-validation-fail")}editedClear(e){e.modules.validate&&(e.modules.validate.invalid=!1)}cellIsValid(e){return e.modules.validate&&e.modules.validate.invalid||!0}cellValidate(e){return this.validate(e.column.modules.validate,e,e.getValue())}columnValidate(e){var i=[];return e.cells.forEach(r=>{this.cellValidate(r)!==!0&&i.push(r.getComponent())}),i.length?i:!0}rowValidate(e){var i=[];return e.cells.forEach(r=>{this.cellValidate(r)!==!0&&i.push(r.getComponent())}),i.length?i:!0}userClearCellValidation(e){e||(e=this.getInvalidCells()),Array.isArray(e)||(e=[e]),e.forEach(i=>{this.clearValidation(i._getSelf())})}userValidate(e){var i=[];return this.table.rowManager.rows.forEach(r=>{r=r.getComponent();var n=r.validate();n!==!0&&(i=i.concat(n))}),i.length?i:!0}initializeColumnCheck(e){typeof e.definition.validator<"u"&&this.initializeColumn(e)}initializeColumn(e){var i=this,r=[],n;e.definition.validator&&(Array.isArray(e.definition.validator)?e.definition.validator.forEach(a=>{n=i._extractValidator(a),n&&r.push(n)}):(n=this._extractValidator(e.definition.validator),n&&r.push(n)),e.modules.validate=r.length?r:!1)}_extractValidator(e){var i,r,n;switch(typeof e){case"string":return n=e.indexOf(":"),n>-1?(i=e.substring(0,n),r=e.substring(n+1)):i=e,this._buildValidator(i,r);case"function":return this._buildValidator(e);case"object":return this._buildValidator(e.type,e.parameters)}}_buildValidator(e,i){var r=typeof e=="function"?e:gI.validators[e];return r?{type:typeof e=="function"?"function":e,func:r,params:i}:(console.warn("Validator Setup Error - No matching validator found:",e),!1)}validate(e,i,r){var n=this,a=[],o=this.invalidCells.indexOf(i);return e&&e.forEach(s=>{s.func.call(n,i.getComponent(),r,s.params)||a.push({type:s.type,parameters:s.params})}),i.modules.validate||(i.modules.validate={}),a.length?(i.modules.validate.invalid=a,this.table.options.validationMode!=="manual"&&i.getElement().classList.add("tabulator-validation-fail"),o==-1&&this.invalidCells.push(i)):(i.modules.validate.invalid=!1,i.getElement().classList.remove("tabulator-validation-fail"),o>-1&&this.invalidCells.splice(o,1)),a.length?a:!0}getInvalidCells(){var e=[];return this.invalidCells.forEach(i=>{e.push(i.getComponent())}),e}clearValidation(e){var i;e.modules.validate&&e.modules.validate.invalid&&(e.getElement().classList.remove("tabulator-validation-fail"),e.modules.validate.invalid=!1,i=this.invalidCells.indexOf(e),i>-1&&this.invalidCells.splice(i,1))}};Ve(gI,"moduleName","validate"),Ve(gI,"validators",Jve);let F1=gI;var CE=Object.freeze({__proto__:null,AccessorModule:f1,AjaxModule:I1,ClipboardModule:y1,ColumnCalcsModule:b1,DataTreeModule:v7,DownloadModule:w1,EditModule:U1,ExportModule:S1,FilterModule:T1,FormatModule:D1,FrozenColumnsModule:I7,FrozenRowsModule:y7,GroupRowsModule:b7,HistoryModule:P1,HtmlTableImportModule:w7,ImportModule:R1,InteractionModule:U7,KeybindingsModule:E1,MenuModule:S7,MoveColumnsModule:T7,MoveRowsModule:C1,MutatorModule:M1,PageModule:N1,PersistenceModule:A1,PopupModule:D7,PrintModule:P7,ReactiveDataModule:R7,ResizeColumnsModule:E7,ResizeRowsModule:C7,ResizeTableModule:M7,ResponsiveLayoutModule:O1,SelectRangeModule:BU,SelectRowModule:k1,SortModule:x1,SpreadsheetModule:A7,TooltipModule:O7,ValidateModule:F1}),Qve={debugEventsExternal:!1,debugEventsInternal:!1,debugInvalidOptions:!0,debugInvalidComponentFuncs:!0,debugInitialization:!0,debugDeprecation:!0,height:!1,minHeight:!1,maxHeight:!1,columnHeaderVertAlign:"top",popupContainer:!1,columns:[],columnDefaults:{},rowHeader:!1,data:!1,autoColumns:!1,autoColumnsDefinitions:!1,nestedFieldSeparator:".",footerElement:!1,index:"id",textDirection:"auto",addRowPos:"bottom",headerVisible:!0,renderVertical:"virtual",renderHorizontal:"basic",renderVerticalBuffer:0,scrollToRowPosition:"top",scrollToRowIfVisible:!0,scrollToColumnPosition:"left",scrollToColumnIfVisible:!0,rowFormatter:!1,rowFormatterPrint:null,rowFormatterClipboard:null,rowFormatterHtmlOutput:null,rowHeight:null,placeholder:!1,dataLoader:!0,dataLoaderLoading:!1,dataLoaderError:!1,dataLoaderErrorTimeout:3e3,dataSendParams:{},dataReceiveParams:{}};class k7{constructor(e,i,r={}){this.table=e,this.msgType=i,this.registeredDefaults=Object.assign({},r)}register(e,i){this.registeredDefaults[e]=i}generate(e,i={}){var r=Object.assign({},this.registeredDefaults),n=this.table.options.debugInvalidOptions||i.debugInvalidOptions===!0;Object.assign(r,e);for(let a in i)r.hasOwnProperty(a)||(n&&console.warn("Invalid "+this.msgType+" option:",a),r[a]=i.key);for(let a in r)a in i?r[a]=i[a]:Array.isArray(r[a])?r[a]=Object.assign([],r[a]):typeof r[a]=="object"&&r[a]!==null?r[a]=Object.assign({},r[a]):typeof r[a]>"u"&&delete r[a];return r}}class KD extends Ka{constructor(e){super(e),this.elementVertical=e.rowManager.element,this.elementHorizontal=e.columnManager.element,this.tableElement=e.rowManager.tableElement,this.verticalFillMode="fit"}initialize(){}clearRows(){}clearColumns(){}reinitializeColumnWidths(e){}renderRows(){}renderColumns(){}rerenderRows(e){e&&e()}rerenderColumns(e,i){}renderRowCells(e){}rerenderRowCells(e,i){}scrollColumns(e,i){}scrollRows(e,i){}resize(){}scrollToRow(e){}scrollToRowNearestTop(e){}visibleRows(e){return[]}rows(){return this.table.rowManager.getDisplayRows()}styleRow(e,i){var r=e.getElement();i%2?(r.classList.add("tabulator-row-even"),r.classList.remove("tabulator-row-odd")):(r.classList.add("tabulator-row-odd"),r.classList.remove("tabulator-row-even"))}clear(){this.clearRows(),this.clearColumns()}render(){this.renderRows(),this.renderColumns()}rerender(e){this.rerenderRows(),this.rerenderColumns()}scrollToRowPosition(e,i,r){var n=this.rows().indexOf(e),a=e.getElement(),o=0;return new Promise((s,l)=>{if(n>-1){if(typeof r>"u"&&(r=this.table.options.scrollToRowIfVisible),!r&&xr.elVisible(a)&&(o=xr.elOffset(a).top-xr.elOffset(this.elementVertical).top,o>0&&o<this.elementVertical.clientHeight-a.offsetHeight))return s(),!1;switch(typeof i>"u"&&(i=this.table.options.scrollToRowPosition),i==="nearest"&&(i=this.scrollToRowNearestTop(e)?"top":"bottom"),this.scrollToRow(e),i){case"middle":case"center":this.elementVertical.scrollHeight-this.elementVertical.scrollTop==this.elementVertical.clientHeight?this.elementVertical.scrollTop=this.elementVertical.scrollTop+(a.offsetTop-this.elementVertical.scrollTop)-(this.elementVertical.scrollHeight-a.offsetTop)/2:this.elementVertical.scrollTop=this.elementVertical.scrollTop-this.elementVertical.clientHeight/2;break;case"bottom":this.elementVertical.scrollHeight-this.elementVertical.scrollTop==this.elementVertical.clientHeight?this.elementVertical.scrollTop=this.elementVertical.scrollTop-(this.elementVertical.scrollHeight-a.offsetTop)+a.offsetHeight:this.elementVertical.scrollTop=this.elementVertical.scrollTop-this.elementVertical.clientHeight+a.offsetHeight;break;case"top":this.elementVertical.scrollTop=a.offsetTop;break}s()}else console.warn("Scroll Error - Row not visible"),l("Scroll Error - Row not visible")})}}class Zve extends KD{constructor(e){super(e)}renderRowCells(e,i){const r=document.createDocumentFragment();e.cells.forEach(n=>{r.appendChild(n.getElement())}),e.element.appendChild(r),i||e.cells.forEach(n=>{n.cellRendered()})}reinitializeColumnWidths(e){e.forEach(function(i){i.reinitializeWidth()})}}class eIe extends KD{constructor(e){super(e),this.leftCol=0,this.rightCol=0,this.scrollLeft=0,this.vDomScrollPosLeft=0,this.vDomScrollPosRight=0,this.vDomPadLeft=0,this.vDomPadRight=0,this.fitDataColAvg=0,this.windowBuffer=200,this.visibleRows=null,this.initialized=!1,this.isFitData=!1,this.columns=[]}initialize(){this.compatibilityCheck(),this.layoutCheck(),this.vertScrollListen()}compatibilityCheck(){this.options("layout")=="fitDataTable"&&console.warn("Horizontal Virtual DOM is not compatible with fitDataTable layout mode"),this.options("responsiveLayout")&&console.warn("Horizontal Virtual DOM is not compatible with responsive columns"),this.options("rtl")&&console.warn("Horizontal Virtual DOM is not currently compatible with RTL text direction")}layoutCheck(){this.isFitData=this.options("layout").startsWith("fitData")}vertScrollListen(){this.subscribe("scroll-vertical",this.clearVisRowCache.bind(this)),this.subscribe("data-refreshed",this.clearVisRowCache.bind(this))}clearVisRowCache(){this.visibleRows=null}renderColumns(e,i){this.dataChange()}scrollColumns(e,i){this.scrollLeft!=e&&(this.scrollLeft=e,this.scroll(e-(this.vDomScrollPosLeft+this.windowBuffer)))}calcWindowBuffer(){var e=this.elementVertical.clientWidth;this.table.columnManager.columnsByIndex.forEach(i=>{if(i.visible){var r=i.getWidth();r>e&&(e=r)}}),this.windowBuffer=e*2}rerenderColumns(e,i){var r={cols:this.columns,leftCol:this.leftCol,rightCol:this.rightCol},n=0;e&&!this.initialized||(this.clear(),this.calcWindowBuffer(),this.scrollLeft=this.elementVertical.scrollLeft,this.vDomScrollPosLeft=this.scrollLeft-this.windowBuffer,this.vDomScrollPosRight=this.scrollLeft+this.elementVertical.clientWidth+this.windowBuffer,this.table.columnManager.columnsByIndex.forEach(a=>{var o={},s;a.visible&&(a.modules.frozen||(s=a.getWidth(),o.leftPos=n,o.rightPos=n+s,o.width=s,this.isFitData&&(o.fitDataCheck=a.modules.vdomHoz?a.modules.vdomHoz.fitDataCheck:!0),n+s>this.vDomScrollPosLeft&&n<this.vDomScrollPosRight?(this.leftCol==-1&&(this.leftCol=this.columns.length,this.vDomPadLeft=n),this.rightCol=this.columns.length):this.leftCol!==-1&&(this.vDomPadRight+=s),this.columns.push(a),a.modules.vdomHoz=o,n+=s))}),this.tableElement.style.paddingLeft=this.vDomPadLeft+"px",this.tableElement.style.paddingRight=this.vDomPadRight+"px",this.initialized=!0,i||(!e||this.reinitChanged(r))&&this.reinitializeRows(),this.elementVertical.scrollLeft=this.scrollLeft)}renderRowCells(e){if(this.initialized)this.initializeRow(e);else{const i=document.createDocumentFragment();e.cells.forEach(r=>{i.appendChild(r.getElement())}),e.element.appendChild(i),e.cells.forEach(r=>{r.cellRendered()})}}rerenderRowCells(e,i){this.reinitializeRow(e,i)}reinitializeColumnWidths(e){for(let i=this.leftCol;i<=this.rightCol;i++)this.columns[i].reinitializeWidth()}deinitialize(){this.initialized=!1}clear(){this.columns=[],this.leftCol=-1,this.rightCol=0,this.vDomScrollPosLeft=0,this.vDomScrollPosRight=0,this.vDomPadLeft=0,this.vDomPadRight=0}dataChange(){var e=!1,i,r;if(this.isFitData){if(this.table.columnManager.columnsByIndex.forEach(n=>{!n.definition.width&&n.visible&&(e=!0)}),e&&this.table.rowManager.getDisplayRows().length&&(this.vDomScrollPosRight=this.scrollLeft+this.elementVertical.clientWidth+this.windowBuffer,i=this.chain("rows-sample",[1],[],()=>this.table.rowManager.getDisplayRows())[0],i)){r=i.getElement(),i.generateCells(),this.tableElement.appendChild(r);for(let n=0;n<i.cells.length;n++){let a=i.cells[n];r.appendChild(a.getElement()),a.column.reinitializeWidth()}r.parentNode.removeChild(r),this.rerenderColumns(!1,!0)}}else this.options("layout")==="fitColumns"&&(this.layoutRefresh(),this.rerenderColumns(!1,!0))}reinitChanged(e){var i=!0;return e.cols.length!==this.columns.length||e.leftCol!==this.leftCol||e.rightCol!==this.rightCol?!0:(e.cols.forEach((r,n)=>{r!==this.columns[n]&&(i=!1)}),!i)}reinitializeRows(){var e=this.getVisibleRows(),i=this.table.rowManager.getRows().filter(r=>!e.includes(r));e.forEach(r=>{this.reinitializeRow(r,!0)}),i.forEach(r=>{r.deinitialize()})}getVisibleRows(){return this.visibleRows||(this.visibleRows=this.table.rowManager.getVisibleRows()),this.visibleRows}scroll(e){this.vDomScrollPosLeft+=e,this.vDomScrollPosRight+=e,Math.abs(e)>this.windowBuffer/2?this.rerenderColumns():e>0?(this.addColRight(),this.removeColLeft()):(this.addColLeft(),this.removeColRight())}colPositionAdjust(e,i,r){for(let n=e;n<i;n++){let a=this.columns[n];a.modules.vdomHoz.leftPos+=r,a.modules.vdomHoz.rightPos+=r}}addColRight(){for(var e=!1,i=!0;i;){let r=this.columns[this.rightCol+1];r&&r.modules.vdomHoz.leftPos<=this.vDomScrollPosRight?(e=!0,this.getVisibleRows().forEach(n=>{if(n.type!=="group"){var a=n.getCell(r);n.getElement().insertBefore(a.getElement(),n.getCell(this.columns[this.rightCol]).getElement().nextSibling),a.cellRendered()}}),this.fitDataColActualWidthCheck(r),this.rightCol++,this.getVisibleRows().forEach(n=>{n.type!=="group"&&(n.modules.vdomHoz.rightCol=this.rightCol)}),this.rightCol>=this.columns.length-1?this.vDomPadRight=0:this.vDomPadRight-=r.getWidth()):i=!1}e&&(this.tableElement.style.paddingRight=this.vDomPadRight+"px")}addColLeft(){for(var e=!1,i=!0;i;){let r=this.columns[this.leftCol-1];if(r)if(r.modules.vdomHoz.rightPos>=this.vDomScrollPosLeft){e=!0,this.getVisibleRows().forEach(a=>{if(a.type!=="group"){var o=a.getCell(r);a.getElement().insertBefore(o.getElement(),a.getCell(this.columns[this.leftCol]).getElement()),o.cellRendered()}}),this.leftCol--,this.getVisibleRows().forEach(a=>{a.type!=="group"&&(a.modules.vdomHoz.leftCol=this.leftCol)}),this.leftCol<=0?this.vDomPadLeft=0:this.vDomPadLeft-=r.getWidth();let n=this.fitDataColActualWidthCheck(r);n&&(this.scrollLeft=this.elementVertical.scrollLeft=this.elementVertical.scrollLeft+n,this.vDomPadRight-=n)}else i=!1;else i=!1}e&&(this.tableElement.style.paddingLeft=this.vDomPadLeft+"px")}removeColRight(){for(var e=!1,i=!0;i;){let r=this.columns[this.rightCol];r&&r.modules.vdomHoz.leftPos>this.vDomScrollPosRight?(e=!0,this.getVisibleRows().forEach(n=>{if(n.type!=="group"){var a=n.getCell(r);try{n.getElement().removeChild(a.getElement())}catch(o){console.warn("Could not removeColRight",o.message)}}}),this.vDomPadRight+=r.getWidth(),this.rightCol--,this.getVisibleRows().forEach(n=>{n.type!=="group"&&(n.modules.vdomHoz.rightCol=this.rightCol)})):i=!1}e&&(this.tableElement.style.paddingRight=this.vDomPadRight+"px")}removeColLeft(){for(var e=!1,i=!0;i;){let r=this.columns[this.leftCol];r&&r.modules.vdomHoz.rightPos<this.vDomScrollPosLeft?(e=!0,this.getVisibleRows().forEach(n=>{if(n.type!=="group"){var a=n.getCell(r);try{n.getElement().removeChild(a.getElement())}catch(o){console.warn("Could not removeColLeft",o.message)}}}),this.vDomPadLeft+=r.getWidth(),this.leftCol++,this.getVisibleRows().forEach(n=>{n.type!=="group"&&(n.modules.vdomHoz.leftCol=this.leftCol)})):i=!1}e&&(this.tableElement.style.paddingLeft=this.vDomPadLeft+"px")}fitDataColActualWidthCheck(e){var i,r;return e.modules.vdomHoz.fitDataCheck&&(e.reinitializeWidth(),i=e.getWidth(),r=i-e.modules.vdomHoz.width,r&&(e.modules.vdomHoz.rightPos+=r,e.modules.vdomHoz.width=i,this.colPositionAdjust(this.columns.indexOf(e)+1,this.columns.length,r)),e.modules.vdomHoz.fitDataCheck=!1),r}initializeRow(e){if(e.type!=="group"){e.modules.vdomHoz={leftCol:this.leftCol,rightCol:this.rightCol},this.table.modules.frozenColumns&&this.table.modules.frozenColumns.leftColumns.forEach(i=>{this.appendCell(e,i)});for(let i=this.leftCol;i<=this.rightCol;i++)this.appendCell(e,this.columns[i]);this.table.modules.frozenColumns&&this.table.modules.frozenColumns.rightColumns.forEach(i=>{this.appendCell(e,i)})}}appendCell(e,i){if(i&&i.visible){let r=e.getCell(i);e.getElement().appendChild(r.getElement()),r.cellRendered()}}reinitializeRow(e,i){if(e.type!=="group"&&(i||!e.modules.vdomHoz||e.modules.vdomHoz.leftCol!==this.leftCol||e.modules.vdomHoz.rightCol!==this.rightCol)){for(var r=e.getElement();r.firstChild;)r.removeChild(r.firstChild);this.initializeRow(e)}}}class tIe extends Ka{constructor(e){super(e),this.blockHozScrollEvent=!1,this.headersElement=null,this.contentsElement=null,this.rowHeader=null,this.element=null,this.columns=[],this.columnsByIndex=[],this.columnsByField={},this.scrollLeft=0,this.optionsList=new k7(this.table,"column definition",g7),this.redrawBlock=!1,this.redrawBlockUpdate=null,this.renderer=null}initialize(){this.initializeRenderer(),this.headersElement=this.createHeadersElement(),this.contentsElement=this.createHeaderContentsElement(),this.element=this.createHeaderElement(),this.contentsElement.insertBefore(this.headersElement,this.contentsElement.firstChild),this.element.insertBefore(this.contentsElement,this.element.firstChild),this.initializeScrollWheelWatcher(),this.subscribe("scroll-horizontal",this.scrollHorizontal.bind(this)),this.subscribe("scrollbar-vertical",this.padVerticalScrollbar.bind(this))}padVerticalScrollbar(e){this.table.rtl?this.headersElement.style.marginLeft=e+"px":this.headersElement.style.marginRight=e+"px"}initializeRenderer(){var e,i={virtual:eIe,basic:Zve};typeof this.table.options.renderHorizontal=="string"?e=i[this.table.options.renderHorizontal]:e=this.table.options.renderHorizontal,e?(this.renderer=new e(this.table,this.element,this.tableElement),this.renderer.initialize()):console.error("Unable to find matching renderer:",this.table.options.renderHorizontal)}createHeadersElement(){var e=document.createElement("div");return e.classList.add("tabulator-headers"),e.setAttribute("role","row"),e}createHeaderContentsElement(){var e=document.createElement("div");return e.classList.add("tabulator-header-contents"),e.setAttribute("role","rowgroup"),e}createHeaderElement(){var e=document.createElement("div");return e.classList.add("tabulator-header"),e.setAttribute("role","rowgroup"),this.table.options.headerVisible||e.classList.add("tabulator-header-hidden"),e}getElement(){return this.element}getContentsElement(){return this.contentsElement}getHeadersElement(){return this.headersElement}scrollHorizontal(e){this.contentsElement.scrollLeft=e,this.scrollLeft=e,this.renderer.scrollColumns(e)}initializeScrollWheelWatcher(){this.contentsElement.addEventListener("wheel",e=>{var i;e.deltaX&&(i=this.contentsElement.scrollLeft+e.deltaX,this.table.rowManager.scrollHorizontal(i),this.table.columnManager.scrollHorizontal(i))})}generateColumnsFromRowData(e){var i=[],r={},n=this.table.options.autoColumns==="full"?e:[e[0]],a=this.table.options.autoColumnsDefinitions;if(e&&e.length){if(n.forEach(o=>{Object.keys(o).forEach((s,l)=>{let u=o[s],c;r[s]?r[s]!==!0&&typeof u<"u"&&(r[s].sorter=this.calculateSorterFromValue(u),r[s]=!0):(c={field:s,title:s,sorter:this.calculateSorterFromValue(u)},i.splice(l,0,c),r[s]=typeof u>"u"?c:!0)})}),a)switch(typeof a){case"function":this.table.options.columns=a.call(this.table,i);break;case"object":Array.isArray(a)?i.forEach(o=>{var s=a.find(l=>l.field===o.field);s&&Object.assign(o,s)}):i.forEach(o=>{a[o.field]&&Object.assign(o,a[o.field])}),this.table.options.columns=i;break}else this.table.options.columns=i;this.setColumns(this.table.options.columns)}}calculateSorterFromValue(e){var i;switch(typeof e){case"undefined":i="string";break;case"boolean":i="boolean";break;case"number":i="number";break;case"object":Array.isArray(e)?i="array":i="string";break;default:!isNaN(e)&&e!==""?i="number":e.match(/((^[0-9]+[a-z]+)|(^[a-z]+[0-9]+))+$/i)?i="alphanum":i="string";break}return i}setColumns(e,i){for(;this.headersElement.firstChild;)this.headersElement.removeChild(this.headersElement.firstChild);this.columns=[],this.columnsByIndex=[],this.columnsByField={},this.dispatch("columns-loading"),this.dispatchExternal("columnsLoading"),this.table.options.rowHeader&&(this.rowHeader=new nm(this.table.options.rowHeader===!0?{}:this.table.options.rowHeader,this,!0),this.columns.push(this.rowHeader),this.headersElement.appendChild(this.rowHeader.getElement()),this.rowHeader.columnRendered()),e.forEach((r,n)=>{this._addColumn(r)}),this._reIndexColumns(),this.dispatch("columns-loaded"),this.subscribedExternal("columnsLoaded")&&this.dispatchExternal("columnsLoaded",this.getComponents()),this.rerenderColumns(!1,!0),this.redraw(!0)}_addColumn(e,i,r){var n=new nm(e,this),a=n.getElement(),o=r&&this.findColumnIndex(r);if(i&&this.rowHeader&&(!r||r===this.rowHeader)&&(i=!1,r=this.rowHeader,o=0),r&&o>-1){var s=r.getTopColumn(),l=this.columns.indexOf(s),u=s.getElement();i?(this.columns.splice(l,0,n),u.parentNode.insertBefore(a,u)):(this.columns.splice(l+1,0,n),u.parentNode.insertBefore(a,u.nextSibling))}else i?(this.columns.unshift(n),this.headersElement.insertBefore(n.getElement(),this.headersElement.firstChild)):(this.columns.push(n),this.headersElement.appendChild(n.getElement()));return n.columnRendered(),n}registerColumnField(e){e.definition.field&&(this.columnsByField[e.definition.field]=e)}registerColumnPosition(e){this.columnsByIndex.push(e)}_reIndexColumns(){this.columnsByIndex=[],this.columns.forEach(function(e){e.reRegisterPosition()})}verticalAlignHeaders(){var e=0;this.redrawBlock||(this.headersElement.style.height="",this.columns.forEach(i=>{i.clearVerticalAlign()}),this.columns.forEach(i=>{var r=i.getHeight();r>e&&(e=r)}),this.headersElement.style.height=e+"px",this.columns.forEach(i=>{i.verticalAlign(this.table.options.columnHeaderVertAlign,e)}),this.table.rowManager.adjustTableSize())}findColumn(e){var i;if(typeof e=="object"){if(e instanceof nm)return e;if(e instanceof f7)return e._getSelf()||!1;if(typeof HTMLElement<"u"&&e instanceof HTMLElement)return i=[],this.columns.forEach(n=>{i.push(n),i=i.concat(n.getColumns(!0))}),i.find(n=>n.element===e)||!1}else return this.columnsByField[e]||!1;return!1}getColumnByField(e){return this.columnsByField[e]}getColumnsByFieldRoot(e){var i=[];return Object.keys(this.columnsByField).forEach(r=>{var n=this.table.options.nestedFieldSeparator?r.split(this.table.options.nestedFieldSeparator)[0]:r;n===e&&i.push(this.columnsByField[r])}),i}getColumnByIndex(e){return this.columnsByIndex[e]}getFirstVisibleColumn(){var e=this.columnsByIndex.findIndex(i=>i.visible);return e>-1?this.columnsByIndex[e]:!1}getVisibleColumnsByIndex(){return this.columnsByIndex.filter(e=>e.visible)}getColumns(){return this.columns}findColumnIndex(e){return this.columnsByIndex.findIndex(i=>e===i)}getRealColumns(){return this.columnsByIndex}traverse(e){this.columnsByIndex.forEach((i,r)=>{e(i,r)})}getDefinitions(e){var i=[];return this.columnsByIndex.forEach(r=>{(!e||e&&r.visible)&&i.push(r.getDefinition())}),i}getDefinitionTree(){var e=[];return this.columns.forEach(i=>{e.push(i.getDefinition(!0))}),e}getComponents(e){var i=[],r=e?this.columns:this.columnsByIndex;return r.forEach(n=>{i.push(n.getComponent())}),i}getWidth(){var e=0;return this.columnsByIndex.forEach(i=>{i.visible&&(e+=i.getWidth())}),e}moveColumn(e,i,r){i.element.parentNode.insertBefore(e.element,i.element),r&&i.element.parentNode.insertBefore(i.element,e.element),this.moveColumnActual(e,i,r),this.verticalAlignHeaders(),this.table.rowManager.reinitialize()}moveColumnActual(e,i,r){e.parent.isGroup?this._moveColumnInArray(e.parent.columns,e,i,r):this._moveColumnInArray(this.columns,e,i,r),this._moveColumnInArray(this.columnsByIndex,e,i,r,!0),this.rerenderColumns(!0),this.dispatch("column-moved",e,i,r),this.subscribedExternal("columnMoved")&&this.dispatchExternal("columnMoved",e.getComponent(),this.table.columnManager.getComponents())}_moveColumnInArray(e,i,r,n,a){var o=e.indexOf(i),s,l=[];o>-1&&(e.splice(o,1),s=e.indexOf(r),s>-1?n&&(s=s+1):s=o,e.splice(s,0,i),a&&(l=this.chain("column-moving-rows",[i,r,n],null,[])||[],l=l.concat(this.table.rowManager.rows),l.forEach(function(u){if(u.cells.length){var c=u.cells.splice(o,1)[0];u.cells.splice(s,0,c)}})))}scrollToColumn(e,i,r){var n=0,a=e.getLeftOffset(),o=0,s=e.getElement();return new Promise((l,u)=>{if(typeof i>"u"&&(i=this.table.options.scrollToColumnPosition),typeof r>"u"&&(r=this.table.options.scrollToColumnIfVisible),e.visible){switch(i){case"middle":case"center":o=-this.element.clientWidth/2;break;case"right":o=s.clientWidth-this.headersElement.clientWidth;break}if(!r&&a>0&&a+s.offsetWidth<this.element.clientWidth)return!1;n=a+o,n=Math.max(Math.min(n,this.table.rowManager.element.scrollWidth-this.table.rowManager.element.clientWidth),0),this.table.rowManager.scrollHorizontal(n),this.scrollHorizontal(n),l()}else console.warn("Scroll Error - Column not visible"),u("Scroll Error - Column not visible")})}generateCells(e){var i=[];return this.columnsByIndex.forEach(r=>{i.push(r.generateCell(e))}),i}getFlexBaseWidth(){var e=this.table.element.clientWidth,i=0;return this.table.rowManager.element.scrollHeight>this.table.rowManager.element.clientHeight&&(e-=this.table.rowManager.element.offsetWidth-this.table.rowManager.element.clientWidth),this.columnsByIndex.forEach(function(r){var n,a,o;r.visible&&(n=r.definition.width||0,a=parseInt(r.minWidth),typeof n=="string"?n.indexOf("%")>-1?o=e/100*parseInt(n):o=parseInt(n):o=n,i+=o>a?o:a)}),i}addColumn(e,i,r){return new Promise((n,a)=>{var o=this._addColumn(e,i,r);this._reIndexColumns(),this.dispatch("column-add",e,i,r),this.layoutMode()!="fitColumns"&&o.reinitializeWidth(),this.redraw(!0),this.table.rowManager.reinitialize(),this.rerenderColumns(),n(o)})}deregisterColumn(e){var i=e.getField(),r;i&&delete this.columnsByField[i],r=this.columnsByIndex.indexOf(e),r>-1&&this.columnsByIndex.splice(r,1),r=this.columns.indexOf(e),r>-1&&this.columns.splice(r,1),this.verticalAlignHeaders(),this.redraw()}rerenderColumns(e,i){this.redrawBlock?(e===!1||e===!0&&this.redrawBlockUpdate===null)&&(this.redrawBlockUpdate=e):this.renderer.rerenderColumns(e,i)}blockRedraw(){this.redrawBlock=!0,this.redrawBlockUpdate=null}restoreRedraw(){this.redrawBlock=!1,this.verticalAlignHeaders(),this.renderer.rerenderColumns(this.redrawBlockUpdate)}redraw(e){xr.elVisible(this.element)&&this.verticalAlignHeaders(),e&&(this.table.rowManager.resetScroll(),this.table.rowManager.reinitialize()),this.confirm("table-redrawing",e)||this.layoutRefresh(e),this.dispatch("table-redraw",e),this.table.footerManager.redraw()}}class iIe extends KD{constructor(e){super(e),this.verticalFillMode="fill",this.scrollTop=0,this.scrollLeft=0,this.scrollTop=0,this.scrollLeft=0}clearRows(){for(var e=this.tableElement;e.firstChild;)e.removeChild(e.firstChild);e.scrollTop=0,e.scrollLeft=0,e.style.minWidth="",e.style.minHeight="",e.style.display="",e.style.visibility=""}renderRows(){var e=this.tableElement,i=!0,r=document.createDocumentFragment(),n=this.rows();n.forEach((a,o)=>{this.styleRow(a,o),a.initialize(!1,!0),a.type!=="group"&&(i=!1),r.appendChild(a.getElement())}),e.appendChild(r),n.forEach(a=>{a.rendered(),a.heightInitialized||a.calcHeight(!0)}),n.forEach(a=>{a.heightInitialized||a.setCellHeight()}),i?e.style.minWidth=this.table.columnManager.getWidth()+"px":e.style.minWidth=""}rerenderRows(e){this.clearRows(),e&&e(),this.renderRows(),this.rows().length||this.table.rowManager.tableEmpty()}scrollToRowNearestTop(e){var i=xr.elOffset(e.getElement()).top;return!(Math.abs(this.elementVertical.scrollTop-i)>Math.abs(this.elementVertical.scrollTop+this.elementVertical.clientHeight-i))}scrollToRow(e){var i=e.getElement();this.elementVertical.scrollTop=xr.elOffset(i).top-xr.elOffset(this.elementVertical).top+this.elementVertical.scrollTop}visibleRows(e){return this.rows()}}class rIe extends KD{constructor(e){super(e),this.verticalFillMode="fill",this.scrollTop=0,this.scrollLeft=0,this.vDomRowHeight=20,this.vDomTop=0,this.vDomBottom=0,this.vDomScrollPosTop=0,this.vDomScrollPosBottom=0,this.vDomTopPad=0,this.vDomBottomPad=0,this.vDomMaxRenderChain=90,this.vDomWindowBuffer=0,this.vDomWindowMinTotalRows=20,this.vDomWindowMinMarginRows=5,this.vDomTopNewRows=[],this.vDomBottomNewRows=[]}clearRows(){for(var e=this.tableElement;e.firstChild;)e.removeChild(e.firstChild);e.style.paddingTop="",e.style.paddingBottom="",e.style.minHeight="",e.style.display="",e.style.visibility="",this.elementVertical.scrollTop=0,this.elementVertical.scrollLeft=0,this.scrollTop=0,this.scrollLeft=0,this.vDomTop=0,this.vDomBottom=0,this.vDomTopPad=0,this.vDomBottomPad=0,this.vDomScrollPosTop=0,this.vDomScrollPosBottom=0}renderRows(){this._virtualRenderFill()}rerenderRows(e){for(var i=this.elementVertical.scrollTop,r=!1,n=!1,a=this.table.rowManager.scrollLeft,o=this.rows(),s=this.vDomTop;s<=this.vDomBottom;s++)if(o[s]){var l=i-o[s].getElement().offsetTop;if(n===!1||Math.abs(l)<n)n=l,r=s;else break}o.forEach(u=>{u.deinitializeHeight()}),e&&e(),this.rows().length?this._virtualRenderFill(r===!1?this.rows.length-1:r,!0,n||0):(this.clear(),this.table.rowManager.tableEmpty()),this.scrollColumns(a)}scrollColumns(e){this.table.rowManager.scrollHorizontal(e)}scrollRows(e,i){var r=e-this.vDomScrollPosTop,n=e-this.vDomScrollPosBottom,a=this.vDomWindowBuffer*2,o=this.rows();if(this.scrollTop=e,-r>a||n>a){var s=this.table.rowManager.scrollLeft;this._virtualRenderFill(Math.floor(this.elementVertical.scrollTop/this.elementVertical.scrollHeight*o.length)),this.scrollColumns(s)}else i?(r<0&&this._addTopRow(o,-r),n<0&&(this.vDomScrollHeight-this.scrollTop>this.vDomWindowBuffer?this._removeBottomRow(o,-n):this.vDomScrollPosBottom=this.scrollTop)):(n>=0&&this._addBottomRow(o,n),r>=0&&(this.scrollTop>this.vDomWindowBuffer?this._removeTopRow(o,r):this.vDomScrollPosTop=this.scrollTop))}resize(){this.vDomWindowBuffer=this.table.options.renderVerticalBuffer||this.elementVertical.clientHeight}scrollToRowNearestTop(e){var i=this.rows().indexOf(e);return!(Math.abs(this.vDomTop-i)>Math.abs(this.vDomBottom-i))}scrollToRow(e){var i=this.rows().indexOf(e);i>-1&&this._virtualRenderFill(i,!0)}visibleRows(e){var i=this.elementVertical.scrollTop,r=this.elementVertical.clientHeight+i,n=!1,a=0,o=0,s=this.rows();if(e)a=this.vDomTop,o=this.vDomBottom;else for(var l=this.vDomTop;l<=this.vDomBottom;l++)if(s[l])if(n)if(r-s[l].getElement().offsetTop>=0)o=l;else break;else if(i-s[l].getElement().offsetTop>=0)a=l;else if(n=!0,r-s[l].getElement().offsetTop>=0)o=l;else break;return s.slice(a,o+1)}_virtualRenderFill(e,i,r){var n=this.tableElement,a=this.elementVertical,o=0,s=0,l=0,u=0,c=0,d=0,p=this.rows(),m=p.length,h=0,f,g,v=[],y=0,I=0,b=this.table.rowManager.fixedHeight,S=this.elementVertical.clientHeight,w=this.table.options.rowHeight,U=!0;if(e=e||0,r=r||0,!e)this.clear();else{for(;n.firstChild;)n.removeChild(n.firstChild);u=(m-e+1)*this.vDomRowHeight,u<S&&(e-=Math.ceil((S-u)/this.vDomRowHeight),e<0&&(e=0)),o=Math.min(Math.max(Math.floor(this.vDomWindowBuffer/this.vDomRowHeight),this.vDomWindowMinMarginRows),e),e-=o}if(m&&xr.elVisible(this.elementVertical)){for(this.vDomTop=e,this.vDomBottom=e-1,b||this.table.options.maxHeight?(w&&(I=S/w+this.vDomWindowBuffer/w),I=Math.max(this.vDomWindowMinTotalRows,Math.ceil(I))):I=m;(I==m||s<=S+this.vDomWindowBuffer||y<this.vDomWindowMinTotalRows)&&this.vDomBottom<m-1;){for(v=[],g=document.createDocumentFragment(),d=0;d<I&&this.vDomBottom<m-1;)h=this.vDomBottom+1,f=p[h],this.styleRow(f,h),f.initialize(!1,!0),!f.heightInitialized&&!this.table.options.rowHeight&&f.clearCellHeight(),g.appendChild(f.getElement()),v.push(f),this.vDomBottom++,d++;if(!v.length)break;n.appendChild(g),v.forEach(T=>{T.rendered(),T.heightInitialized||T.calcHeight(!0)}),v.forEach(T=>{T.heightInitialized||T.setCellHeight()}),v.forEach(T=>{l=T.getHeight(),y<o?c+=l:s+=l,l>this.vDomWindowBuffer&&(this.vDomWindowBuffer=l*2),y++}),U=this.table.rowManager.adjustTableSize(),S=this.elementVertical.clientHeight,U&&(b||this.table.options.maxHeight)&&(w=s/y,I=Math.max(this.vDomWindowMinTotalRows,Math.ceil(S/w+this.vDomWindowBuffer/w)))}e?(this.vDomTopPad=i?this.vDomRowHeight*this.vDomTop+r:this.scrollTop-c,this.vDomBottomPad=this.vDomBottom==m-1?0:Math.max(this.vDomScrollHeight-this.vDomTopPad-s-c,0)):(this.vDomTopPad=0,this.vDomRowHeight=Math.floor((s+c)/y),this.vDomBottomPad=this.vDomRowHeight*(m-this.vDomBottom-1),this.vDomScrollHeight=c+s+this.vDomBottomPad-S),n.style.paddingTop=this.vDomTopPad+"px",n.style.paddingBottom=this.vDomBottomPad+"px",i&&(this.scrollTop=this.vDomTopPad+c+r-(this.elementVertical.scrollWidth>this.elementVertical.clientWidth?this.elementVertical.offsetHeight-S:0)),this.scrollTop=Math.min(this.scrollTop,this.elementVertical.scrollHeight-S),this.elementVertical.scrollWidth>this.elementVertical.clientWidth&&i&&(this.scrollTop+=this.elementVertical.offsetHeight-S),this.vDomScrollPosTop=this.scrollTop,this.vDomScrollPosBottom=this.scrollTop,a.scrollTop=this.scrollTop,this.dispatch("render-virtual-fill")}}_addTopRow(e,i){for(var r=this.tableElement,n=[],a=0,o=this.vDomTop-1,s=0,l=!0;l;)if(this.vDomTop){let u=e[o],c,d;u&&s<this.vDomMaxRenderChain?(c=u.getHeight()||this.vDomRowHeight,d=u.initialized,i>=c?(this.styleRow(u,o),r.insertBefore(u.getElement(),r.firstChild),(!u.initialized||!u.heightInitialized)&&n.push(u),u.initialize(),d||(c=u.getElement().offsetHeight,c>this.vDomWindowBuffer&&(this.vDomWindowBuffer=c*2)),i-=c,a+=c,this.vDomTop--,o--,s++):l=!1):l=!1}else l=!1;for(let u of n)u.clearCellHeight();this._quickNormalizeRowHeight(n),a&&(this.vDomTopPad-=a,this.vDomTopPad<0&&(this.vDomTopPad=o*this.vDomRowHeight),o<1&&(this.vDomTopPad=0),r.style.paddingTop=this.vDomTopPad+"px",this.vDomScrollPosTop-=a)}_removeTopRow(e,i){for(var r=[],n=0,a=0,o=!0;o;){let s=e[this.vDomTop],l;s&&a<this.vDomMaxRenderChain?(l=s.getHeight()||this.vDomRowHeight,i>=l?(this.vDomTop++,i-=l,n+=l,r.push(s),a++):o=!1):o=!1}for(let s of r){let l=s.getElement();l.parentNode&&l.parentNode.removeChild(l)}n&&(this.vDomTopPad+=n,this.tableElement.style.paddingTop=this.vDomTopPad+"px",this.vDomScrollPosTop+=this.vDomTop?n:n+this.vDomWindowBuffer)}_addBottomRow(e,i){for(var r=this.tableElement,n=[],a=0,o=this.vDomBottom+1,s=0,l=!0;l;){let u=e[o],c,d;u&&s<this.vDomMaxRenderChain?(c=u.getHeight()||this.vDomRowHeight,d=u.initialized,i>=c?(this.styleRow(u,o),r.appendChild(u.getElement()),(!u.initialized||!u.heightInitialized)&&n.push(u),u.initialize(),d||(c=u.getElement().offsetHeight,c>this.vDomWindowBuffer&&(this.vDomWindowBuffer=c*2)),i-=c,a+=c,this.vDomBottom++,o++,s++):l=!1):l=!1}for(let u of n)u.clearCellHeight();this._quickNormalizeRowHeight(n),a&&(this.vDomBottomPad-=a,(this.vDomBottomPad<0||o==e.length-1)&&(this.vDomBottomPad=0),r.style.paddingBottom=this.vDomBottomPad+"px",this.vDomScrollPosBottom+=a)}_removeBottomRow(e,i){for(var r=[],n=0,a=0,o=!0;o;){let s=e[this.vDomBottom],l;s&&a<this.vDomMaxRenderChain?(l=s.getHeight()||this.vDomRowHeight,i>=l?(this.vDomBottom--,i-=l,n+=l,r.push(s),a++):o=!1):o=!1}for(let s of r){let l=s.getElement();l.parentNode&&l.parentNode.removeChild(l)}n&&(this.vDomBottomPad+=n,this.vDomBottomPad<0&&(this.vDomBottomPad=0),this.tableElement.style.paddingBottom=this.vDomBottomPad+"px",this.vDomScrollPosBottom-=n)}_quickNormalizeRowHeight(e){for(let i of e)i.calcHeight();for(let i of e)i.setCellHeight()}}class nIe extends Ka{constructor(e){super(e),this.element=this.createHolderElement(),this.tableElement=this.createTableElement(),this.heightFixer=this.createTableElement(),this.placeholder=null,this.placeholderContents=null,this.firstRender=!1,this.renderMode="virtual",this.fixedHeight=!1,this.rows=[],this.activeRowsPipeline=[],this.activeRows=[],this.activeRowsCount=0,this.displayRows=[],this.displayRowsCount=0,this.scrollTop=0,this.scrollLeft=0,this.redrawBlock=!1,this.redrawBlockRestoreConfig=!1,this.redrawBlockRenderInPosition=!1,this.dataPipeline=[],this.displayPipeline=[],this.scrollbarWidth=0,this.renderer=null}createHolderElement(){var e=document.createElement("div");return e.classList.add("tabulator-tableholder"),e.setAttribute("tabindex",0),e}createTableElement(){var e=document.createElement("div");return e.classList.add("tabulator-table"),e.setAttribute("role","rowgroup"),e}initializePlaceholder(){var e=this.table.options.placeholder;if(typeof e=="function"&&(e=e.call(this.table)),e=this.chain("placeholder",[e],e,e)||e,e){let i=document.createElement("div");if(i.classList.add("tabulator-placeholder"),typeof e=="string"){let r=document.createElement("div");r.classList.add("tabulator-placeholder-contents"),r.innerHTML=e,i.appendChild(r),this.placeholderContents=r}else typeof HTMLElement<"u"&&e instanceof HTMLElement?(i.appendChild(e),this.placeholderContents=e):(console.warn("Invalid placeholder provided, must be string or HTML Element",e),this.el=null);this.placeholder=i}}getElement(){return this.element}getTableElement(){return this.tableElement}initialize(){this.initializePlaceholder(),this.initializeRenderer(),this.element.appendChild(this.tableElement),this.firstRender=!0,this.element.addEventListener("scroll",()=>{var e=this.element.scrollLeft,i=this.scrollLeft>e,r=this.element.scrollTop,n=this.scrollTop>r;this.scrollLeft!=e&&(this.scrollLeft=e,this.dispatch("scroll-horizontal",e,i),this.dispatchExternal("scrollHorizontal",e,i),this._positionPlaceholder()),this.scrollTop!=r&&(this.scrollTop=r,this.renderer.scrollRows(r,n),this.dispatch("scroll-vertical",r,n),this.dispatchExternal("scrollVertical",r,n))})}findRow(e){if(typeof e=="object"){if(e instanceof io)return e;if(e instanceof qD)return e._getSelf()||!1;if(typeof HTMLElement<"u"&&e instanceof HTMLElement)return this.rows.find(r=>r.getElement()===e)||!1;if(e===null)return!1}else return typeof e>"u"?!1:this.rows.find(r=>r.data[this.table.options.index]==e)||!1;return!1}getRowFromDataObject(e){var i=this.rows.find(r=>r.data===e);return i||!1}getRowFromPosition(e){return this.getDisplayRows().find(i=>i.type==="row"&&i.getPosition()===e&&i.isDisplayed())}scrollToRow(e,i,r){return this.renderer.scrollToRowPosition(e,i,r)}setData(e,i,r){return new Promise((n,a)=>{i&&this.getDisplayRows().length?this.table.options.pagination?this._setDataActual(e,!0):this.reRenderInPosition(()=>{this._setDataActual(e)}):(this.table.options.autoColumns&&r&&this.table.initialized&&this.table.columnManager.generateColumnsFromRowData(e),this.resetScroll(),this._setDataActual(e)),n()})}_setDataActual(e,i){this.dispatchExternal("dataProcessing",e),this._wipeElements(),Array.isArray(e)?(this.dispatch("data-processing",e),e.forEach((r,n)=>{if(r&&typeof r=="object"){var a=new io(r,this);this.rows.push(a)}else console.warn("Data Loading Warning - Invalid row data detected and ignored, expecting object but received:",r)}),this.refreshActiveData(!1,!1,i),this.dispatch("data-processed",e),this.dispatchExternal("dataProcessed",e)):console.error(`Data Loading Error - Unable to process data due to invalid data type 
Expecting: array 
Received: `,typeof e,`
Data:     `,e)}_wipeElements(){this.dispatch("rows-wipe"),this.destroy(),this.adjustTableSize(),this.dispatch("rows-wiped")}destroy(){this.rows.forEach(e=>{e.wipe()}),this.rows=[],this.activeRows=[],this.activeRowsPipeline=[],this.activeRowsCount=0,this.displayRows=[],this.displayRowsCount=0}deleteRow(e,i){var r=this.rows.indexOf(e),n=this.activeRows.indexOf(e);n>-1&&this.activeRows.splice(n,1),r>-1&&this.rows.splice(r,1),this.setActiveRows(this.activeRows),this.displayRowIterator(a=>{var o=a.indexOf(e);o>-1&&a.splice(o,1)}),i||this.reRenderInPosition(),this.regenerateRowPositions(),this.dispatchExternal("rowDeleted",e.getComponent()),this.displayRowsCount||this.tableEmpty(),this.subscribedExternal("dataChanged")&&this.dispatchExternal("dataChanged",this.getData())}addRow(e,i,r,n){var a=this.addRowActual(e,i,r,n);return a}addRows(e,i,r,n){var a=[];return new Promise((o,s)=>{i=this.findAddRowPos(i),Array.isArray(e)||(e=[e]),(typeof r>"u"&&i||typeof r<"u"&&!i)&&e.reverse(),e.forEach((l,u)=>{var c=this.addRow(l,i,r,!0);a.push(c),this.dispatch("row-added",c,l,i,r)}),this.refreshActiveData(n?"displayPipeline":!1,!1,!0),this.regenerateRowPositions(),this.displayRowsCount&&this._clearPlaceholder(),o(a)})}findAddRowPos(e){return typeof e>"u"&&(e=this.table.options.addRowPos),e==="pos"&&(e=!0),e==="bottom"&&(e=!1),e}addRowActual(e,i,r,n){var a=e instanceof io?e:new io(e||{},this),o=this.findAddRowPos(i),s=-1,l,u;return r||(u=this.chain("row-adding-position",[a,o],null,{index:r,top:o}),r=u.index,o=u.top),typeof r<"u"&&(r=this.findRow(r)),r=this.chain("row-adding-index",[a,r,o],null,r),r&&(s=this.rows.indexOf(r)),r&&s>-1?(l=this.activeRows.indexOf(r),this.displayRowIterator(function(c){var d=c.indexOf(r);d>-1&&c.splice(o?d:d+1,0,a)}),l>-1&&this.activeRows.splice(o?l:l+1,0,a),this.rows.splice(o?s:s+1,0,a)):o?(this.displayRowIterator(function(c){c.unshift(a)}),this.activeRows.unshift(a),this.rows.unshift(a)):(this.displayRowIterator(function(c){c.push(a)}),this.activeRows.push(a),this.rows.push(a)),this.setActiveRows(this.activeRows),this.dispatchExternal("rowAdded",a.getComponent()),this.subscribedExternal("dataChanged")&&this.dispatchExternal("dataChanged",this.table.rowManager.getData()),n||this.reRenderInPosition(),a}moveRow(e,i,r){this.dispatch("row-move",e,i,r),this.moveRowActual(e,i,r),this.regenerateRowPositions(),this.dispatch("row-moved",e,i,r),this.dispatchExternal("rowMoved",e.getComponent())}moveRowActual(e,i,r){this.moveRowInArray(this.rows,e,i,r),this.moveRowInArray(this.activeRows,e,i,r),this.displayRowIterator(n=>{this.moveRowInArray(n,e,i,r)}),this.dispatch("row-moving",e,i,r)}moveRowInArray(e,i,r,n){var a,o,s,l;if(i!==r&&(a=e.indexOf(i),a>-1&&(e.splice(a,1),o=e.indexOf(r),o>-1?n?e.splice(o+1,0,i):e.splice(o,0,i):e.splice(a,0,i)),e===this.getDisplayRows())){s=a<o?a:o,l=o>a?o:a+1;for(let u=s;u<=l;u++)e[u]&&this.styleRow(e[u],u)}}clearData(){this.setData([])}getRowIndex(e){return this.findRowIndex(e,this.rows)}getDisplayRowIndex(e){var i=this.getDisplayRows().indexOf(e);return i>-1?i:!1}nextDisplayRow(e,i){var r=this.getDisplayRowIndex(e),n=!1;return r!==!1&&r<this.displayRowsCount-1&&(n=this.getDisplayRows()[r+1]),n&&(!(n instanceof io)||n.type!="row")?this.nextDisplayRow(n,i):n}prevDisplayRow(e,i){var r=this.getDisplayRowIndex(e),n=!1;return r&&(n=this.getDisplayRows()[r-1]),i&&n&&(!(n instanceof io)||n.type!="row")?this.prevDisplayRow(n,i):n}findRowIndex(e,i){var r;return e=this.findRow(e),e&&(r=i.indexOf(e),r>-1)?r:!1}getData(e,i){var r=[],n=this.getRows(e);return n.forEach(function(a){a.type=="row"&&r.push(a.getData(i||"data"))}),r}getComponents(e){var i=[],r=this.getRows(e);return r.forEach(function(n){i.push(n.getComponent())}),i}getDataCount(e){var i=this.getRows(e);return i.length}scrollHorizontal(e){this.scrollLeft=e,this.element.scrollLeft=e,this.dispatch("scroll-horizontal",e)}registerDataPipelineHandler(e,i){typeof i<"u"?(this.dataPipeline.push({handler:e,priority:i}),this.dataPipeline.sort((r,n)=>r.priority-n.priority)):console.error("Data pipeline handlers must have a priority in order to be registered")}registerDisplayPipelineHandler(e,i){typeof i<"u"?(this.displayPipeline.push({handler:e,priority:i}),this.displayPipeline.sort((r,n)=>r.priority-n.priority)):console.error("Display pipeline handlers must have a priority in order to be registered")}refreshActiveData(e,i,r){var n=this.table,a="",o=0,s=["all","dataPipeline","display","displayPipeline","end"];if(!this.table.destroyed){if(typeof e=="function")if(o=this.dataPipeline.findIndex(l=>l.handler===e),o>-1)a="dataPipeline",i&&(o==this.dataPipeline.length-1?a="display":o++);else if(o=this.displayPipeline.findIndex(l=>l.handler===e),o>-1)a="displayPipeline",i&&(o==this.displayPipeline.length-1?a="end":o++);else{console.error("Unable to refresh data, invalid handler provided",e);return}else a=e||"all",o=0;if(this.redrawBlock){(!this.redrawBlockRestoreConfig||this.redrawBlockRestoreConfig&&(this.redrawBlockRestoreConfig.stage===a&&o<this.redrawBlockRestoreConfig.index||s.indexOf(a)<s.indexOf(this.redrawBlockRestoreConfig.stage)))&&(this.redrawBlockRestoreConfig={handler:e,skipStage:i,renderInPosition:r,stage:a,index:o});return}else xr.elVisible(this.element)?r?this.reRenderInPosition(this.refreshPipelines.bind(this,e,a,o,r)):(this.refreshPipelines(e,a,o,r),e||this.table.columnManager.renderer.renderColumns(),this.renderTable(),n.options.layoutColumnsOnNewData&&this.table.columnManager.redraw(!0)):this.refreshPipelines(e,a,o,r),this.dispatch("data-refreshed")}}refreshPipelines(e,i,r,n){switch(this.dispatch("data-refreshing"),(!e||!this.activeRowsPipeline[0])&&(this.activeRowsPipeline[0]=this.rows.slice(0)),i){case"all":case"dataPipeline":for(let a=r;a<this.dataPipeline.length;a++){let o=this.dataPipeline[a].handler(this.activeRowsPipeline[a].slice(0));this.activeRowsPipeline[a+1]=o||this.activeRowsPipeline[a].slice(0)}this.setActiveRows(this.activeRowsPipeline[this.dataPipeline.length]);case"display":r=0,this.resetDisplayRows();case"displayPipeline":for(let a=r;a<this.displayPipeline.length;a++){let o=this.displayPipeline[a].handler((a?this.getDisplayRows(a-1):this.activeRows).slice(0),n);this.setDisplayRows(o||this.getDisplayRows(a-1).slice(0),a)}case"end":this.regenerateRowPositions()}this.getDisplayRows().length&&this._clearPlaceholder()}regenerateRowPositions(){var e=this.getDisplayRows(),i=1;e.forEach(r=>{r.type==="row"&&(r.setPosition(i),i++)})}setActiveRows(e){this.activeRows=this.activeRows=Object.assign([],e),this.activeRowsCount=this.activeRows.length}resetDisplayRows(){this.displayRows=[],this.displayRows.push(this.activeRows.slice(0)),this.displayRowsCount=this.displayRows[0].length}setDisplayRows(e,i){this.displayRows[i]=e,i==this.displayRows.length-1&&(this.displayRowsCount=this.displayRows[this.displayRows.length-1].length)}getDisplayRows(e){return typeof e>"u"?this.displayRows.length?this.displayRows[this.displayRows.length-1]:[]:this.displayRows[e]||[]}getVisibleRows(e,i){var r=Object.assign([],this.renderer.visibleRows(!i));return e&&(r=this.chain("rows-visible",[i],r,r)),r}displayRowIterator(e){this.activeRowsPipeline.forEach(e),this.displayRows.forEach(e),this.displayRowsCount=this.displayRows[this.displayRows.length-1].length}getRows(e){var i=[];switch(e){case"active":i=this.activeRows;break;case"display":i=this.table.rowManager.getDisplayRows();break;case"visible":i=this.getVisibleRows(!1,!0);break;default:i=this.chain("rows-retrieve",e,null,this.rows)||this.rows}return i}reRenderInPosition(e){this.redrawBlock?e?e():this.redrawBlockRenderInPosition=!0:(this.dispatchExternal("renderStarted"),this.renderer.rerenderRows(e),this.fixedHeight||this.adjustTableSize(),this.scrollBarCheck(),this.dispatchExternal("renderComplete"))}scrollBarCheck(){var e=0;this.element.scrollHeight>this.element.clientHeight&&(e=this.element.offsetWidth-this.element.clientWidth),e!==this.scrollbarWidth&&(this.scrollbarWidth=e,this.dispatch("scrollbar-vertical",e))}initializeRenderer(){var e,i={virtual:rIe,basic:iIe};typeof this.table.options.renderVertical=="string"?e=i[this.table.options.renderVertical]:e=this.table.options.renderVertical,e?(this.renderMode=this.table.options.renderVertical,this.renderer=new e(this.table,this.element,this.tableElement),this.renderer.initialize(),(this.table.element.clientHeight||this.table.options.height)&&!(this.table.options.minHeight&&this.table.options.maxHeight)?this.fixedHeight=!0:this.fixedHeight=!1):console.error("Unable to find matching renderer:",this.table.options.renderVertical)}getRenderMode(){return this.renderMode}renderTable(){this.dispatchExternal("renderStarted"),this.element.scrollTop=0,this._clearTable(),this.displayRowsCount?(this.renderer.renderRows(),this.firstRender&&(this.firstRender=!1,this.fixedHeight||this.adjustTableSize(),this.layoutRefresh(!0))):this.renderEmptyScroll(),this.fixedHeight||this.adjustTableSize(),this.dispatch("table-layout"),this.displayRowsCount||this._showPlaceholder(),this.scrollBarCheck(),this.dispatchExternal("renderComplete")}renderEmptyScroll(){this.placeholder?this.tableElement.style.display="none":this.tableElement.style.minWidth=this.table.columnManager.getWidth()+"px"}_clearTable(){this._clearPlaceholder(),this.scrollTop=0,this.scrollLeft=0,this.renderer.clearRows()}tableEmpty(){this.renderEmptyScroll(),this._showPlaceholder()}checkPlaceholder(){this.displayRowsCount?this._clearPlaceholder():this.tableEmpty()}_showPlaceholder(){this.placeholder&&(this.placeholder&&this.placeholder.parentNode&&this.placeholder.parentNode.removeChild(this.placeholder),this.initializePlaceholder(),this.placeholder.setAttribute("tabulator-render-mode",this.renderMode),this.getElement().appendChild(this.placeholder),this._positionPlaceholder(),this.adjustTableSize())}_clearPlaceholder(){this.placeholder&&this.placeholder.parentNode&&this.placeholder.parentNode.removeChild(this.placeholder),this.tableElement.style.minWidth="",this.tableElement.style.display=""}_positionPlaceholder(){this.placeholder&&this.placeholder.parentNode&&(this.placeholder.style.width=this.table.columnManager.getWidth()+"px",this.placeholderContents.style.width=this.table.rowManager.element.clientWidth+"px",this.placeholderContents.style.marginLeft=this.scrollLeft+"px")}styleRow(e,i){var r=e.getElement();i%2?(r.classList.add("tabulator-row-even"),r.classList.remove("tabulator-row-odd")):(r.classList.add("tabulator-row-odd"),r.classList.remove("tabulator-row-even"))}normalizeHeight(){this.activeRows.forEach(function(e){e.normalizeHeight()})}adjustTableSize(){let e=this.element.clientHeight,i,r=!1;if(this.renderer.verticalFillMode==="fill"){let n=Math.floor(this.table.columnManager.getElement().getBoundingClientRect().height+(this.table.footerManager&&this.table.footerManager.active&&!this.table.footerManager.external?this.table.footerManager.getElement().getBoundingClientRect().height:0));if(this.fixedHeight){i=isNaN(this.table.options.minHeight)?this.table.options.minHeight:this.table.options.minHeight+"px";const a="calc(100% - "+n+"px)";this.element.style.minHeight=i||"calc(100% - "+n+"px)",this.element.style.height=a,this.element.style.maxHeight=a}else this.element.style.height="",this.element.style.height=this.table.element.clientHeight-n+"px",this.element.scrollTop=this.scrollTop;this.renderer.resize(),!this.fixedHeight&&e!=this.element.clientHeight&&(r=!0,this.subscribed("table-resize")?this.dispatch("table-resize"):this.redraw()),this.scrollBarCheck()}return this._positionPlaceholder(),r}reinitialize(){this.rows.forEach(function(e){e.reinitialize(!0)})}blockRedraw(){this.redrawBlock=!0,this.redrawBlockRestoreConfig=!1}restoreRedraw(){this.redrawBlock=!1,this.redrawBlockRestoreConfig?(this.refreshActiveData(this.redrawBlockRestoreConfig.handler,this.redrawBlockRestoreConfig.skipStage,this.redrawBlockRestoreConfig.renderInPosition),this.redrawBlockRestoreConfig=!1):this.redrawBlockRenderInPosition&&this.reRenderInPosition(),this.redrawBlockRenderInPosition=!1}redraw(e){this.adjustTableSize(),this.table.tableWidth=this.table.element.clientWidth,e?this.renderTable():(this.reRenderInPosition(),this.scrollHorizontal(this.scrollLeft))}resetScroll(){if(this.element.scrollLeft=0,this.element.scrollTop=0,this.table.browser==="ie"){var e=document.createEvent("Event");e.initEvent("scroll",!1,!0),this.element.dispatchEvent(e)}else this.element.dispatchEvent(new Event("scroll"))}}class aIe extends Ka{constructor(e){super(e),this.active=!1,this.element=this.createElement(),this.containerElement=this.createContainerElement(),this.external=!1}initialize(){this.initializeElement()}createElement(){var e=document.createElement("div");return e.classList.add("tabulator-footer"),e}createContainerElement(){var e=document.createElement("div");return e.classList.add("tabulator-footer-contents"),this.element.appendChild(e),e}initializeElement(){if(this.table.options.footerElement)switch(typeof this.table.options.footerElement){case"string":this.table.options.footerElement[0]==="<"?this.containerElement.innerHTML=this.table.options.footerElement:(this.external=!0,this.containerElement=document.querySelector(this.table.options.footerElement));break;default:this.element=this.table.options.footerElement;break}}getElement(){return this.element}append(e){this.activate(),this.containerElement.appendChild(e),this.table.rowManager.adjustTableSize()}prepend(e){this.activate(),this.element.insertBefore(e,this.element.firstChild),this.table.rowManager.adjustTableSize()}remove(e){e.parentNode.removeChild(e),this.deactivate()}deactivate(e){(!this.element.firstChild||e)&&(this.external||this.element.parentNode.removeChild(this.element),this.active=!1)}activate(){this.active||(this.active=!0,this.external||(this.table.element.appendChild(this.getElement()),this.table.element.style.display=""))}redraw(){this.dispatch("footer-redraw")}}class oIe extends Ka{constructor(e){super(e),this.el=null,this.abortClasses=["tabulator-headers","tabulator-table"],this.previousTargets={},this.listeners=["click","dblclick","contextmenu","mouseenter","mouseleave","mouseover","mouseout","mousemove","mouseup","mousedown","touchstart","touchend"],this.componentMap={"tabulator-cell":"cell","tabulator-row":"row","tabulator-group":"group","tabulator-col":"column"},this.pseudoTrackers={row:{subscriber:null,target:null},cell:{subscriber:null,target:null},group:{subscriber:null,target:null},column:{subscriber:null,target:null}},this.pseudoTracking=!1}initialize(){this.el=this.table.element,this.buildListenerMap(),this.bindSubscriptionWatchers()}buildListenerMap(){var e={};this.listeners.forEach(i=>{e[i]={handler:null,components:[]}}),this.listeners=e}bindPseudoEvents(){Object.keys(this.pseudoTrackers).forEach(e=>{this.pseudoTrackers[e].subscriber=this.pseudoMouseEnter.bind(this,e),this.subscribe(e+"-mouseover",this.pseudoTrackers[e].subscriber)}),this.pseudoTracking=!0}pseudoMouseEnter(e,i,r){this.pseudoTrackers[e].target!==r&&(this.pseudoTrackers[e].target&&this.dispatch(e+"-mouseleave",i,this.pseudoTrackers[e].target),this.pseudoMouseLeave(e,i),this.pseudoTrackers[e].target=r,this.dispatch(e+"-mouseenter",i,r))}pseudoMouseLeave(e,i){var r=Object.keys(this.pseudoTrackers),n={row:["cell"],cell:["row"]};r=r.filter(a=>{var o=n[e];return a!==e&&(!o||o&&!o.includes(a))}),r.forEach(a=>{var o=this.pseudoTrackers[a].target;this.pseudoTrackers[a].target&&(this.dispatch(a+"-mouseleave",i,o),this.pseudoTrackers[a].target=null)})}bindSubscriptionWatchers(){var e=Object.keys(this.listeners),i=Object.values(this.componentMap);for(let r of i)for(let n of e){let a=r+"-"+n;this.subscriptionChange(a,this.subscriptionChanged.bind(this,r,n))}this.subscribe("table-destroy",this.clearWatchers.bind(this))}subscriptionChanged(e,i,r){var n=this.listeners[i].components,a=n.indexOf(e),o=!1;r?a===-1&&(n.push(e),o=!0):this.subscribed(e+"-"+i)||a>-1&&(n.splice(a,1),o=!0),(i==="mouseenter"||i==="mouseleave")&&!this.pseudoTracking&&this.bindPseudoEvents(),o&&this.updateEventListeners()}updateEventListeners(){for(let e in this.listeners){let i=this.listeners[e];i.components.length?i.handler||(i.handler=this.track.bind(this,e),this.el.addEventListener(e,i.handler)):i.handler&&(this.el.removeEventListener(e,i.handler),i.handler=null)}}track(e,i){var r=i.composedPath&&i.composedPath()||i.path,n=this.findTargets(r);n=this.bindComponents(e,n),this.triggerEvents(e,i,n),this.pseudoTracking&&(e=="mouseover"||e=="mouseleave")&&!Object.keys(n).length&&this.pseudoMouseLeave("none",i)}findTargets(e){var i={};let r=Object.keys(this.componentMap);for(let n of e){let a=n.classList?[...n.classList]:[];if(a.filter(l=>this.abortClasses.includes(l)).length)break;let s=a.filter(l=>r.includes(l));for(let l of s)i[this.componentMap[l]]||(i[this.componentMap[l]]=n)}return i.group&&i.group===i.row&&delete i.row,i}bindComponents(e,i){var r=Object.keys(i).reverse(),n=this.listeners[e],a={},o={};for(let s of r){let l,u=i[s],c=this.previousTargets[s];if(c&&c.target===u)l=c.component;else switch(s){case"row":case"group":(n.components.includes("row")||n.components.includes("cell")||n.components.includes("group"))&&(l=this.table.rowManager.getVisibleRows(!0).find(p=>p.getElement()===u),i.row&&i.row.parentNode&&i.row.parentNode.closest(".tabulator-row")&&(i[s]=!1));break;case"column":n.components.includes("column")&&(l=this.table.columnManager.findColumn(u));break;case"cell":n.components.includes("cell")&&(a.row instanceof io?l=a.row.findCell(u):i.row&&console.warn("Event Target Lookup Error - The row this cell is attached to cannot be found, has the table been reinitialized without being destroyed first?"));break}l&&(a[s]=l,o[s]={target:u,component:l})}return this.previousTargets=o,a}triggerEvents(e,i,r){var n=this.listeners[e];for(let a in r)r[a]&&n.components.includes(a)&&this.dispatch(a+"-"+e,i,r[a])}clearWatchers(){for(let e in this.listeners){let i=this.listeners[e];i.handler&&(this.el.removeEventListener(e,i.handler),i.handler=null)}}}class sIe{constructor(e){this.table=e,this.bindings={}}bind(e,i,r){this.bindings[e]||(this.bindings[e]={}),this.bindings[e][i]?console.warn("Unable to bind component handler, a matching function name is already bound",e,i,r):this.bindings[e][i]=r}handle(e,i,r){if(this.bindings[e]&&this.bindings[e][r]&&typeof this.bindings[e][r].bind=="function")return this.bindings[e][r].bind(null,i);r!=="then"&&typeof r=="string"&&!r.startsWith("_")&&this.table.options.debugInvalidComponentFuncs&&console.error("The "+e+" component does not have a "+r+" function, have you checked that you have the correct Tabulator module installed?")}}class lIe extends Ka{constructor(e){super(e),this.requestOrder=0,this.loading=!1}initialize(){}load(e,i,r,n,a,o){var s=++this.requestOrder;if(this.table.destroyed)return Promise.resolve();if(this.dispatchExternal("dataLoading",e),e&&(e.indexOf("{")==0||e.indexOf("[")==0)&&(e=JSON.parse(e)),this.confirm("data-loading",[e,i,r,a])){this.loading=!0,a||this.alertLoader(),i=this.chain("data-params",[e,r,a],i||{},i||{}),i=this.mapParams(i,this.table.options.dataSendParams);var l=this.chain("data-load",[e,i,r,a],!1,Promise.resolve([]));return l.then(u=>{if(this.table.destroyed)console.warn("Data Load Response Blocked - Table has been destroyed");else{!Array.isArray(u)&&typeof u=="object"&&(u=this.mapParams(u,this.objectInvert(this.table.options.dataReceiveParams)));var c=this.chain("data-loaded",[u],null,u);s==this.requestOrder?(this.clearAlert(),c!==!1&&(this.dispatchExternal("dataLoaded",c),this.table.rowManager.setData(c,n,typeof o>"u"?!n:o))):console.warn("Data Load Response Blocked - An active data load request was blocked by an attempt to change table data while the request was being made")}}).catch(u=>{console.error("Data Load Error: ",u),this.dispatchExternal("dataLoadError",u),a||this.alertError(),setTimeout(()=>{this.clearAlert()},this.table.options.dataLoaderErrorTimeout)}).finally(()=>{this.loading=!1})}else return this.dispatchExternal("dataLoaded",e),e||(e=[]),this.table.rowManager.setData(e,n,typeof o>"u"?!n:o),Promise.resolve()}mapParams(e,i){var r={};for(let n in e)r[i.hasOwnProperty(n)?i[n]:n]=e[n];return r}objectInvert(e){var i={};for(let r in e)i[e[r]]=r;return i}blockActiveLoad(){this.requestOrder++}alertLoader(){var e=typeof this.table.options.dataLoader=="function"?this.table.options.dataLoader():this.table.options.dataLoader;e&&this.table.alertManager.alert(this.table.options.dataLoaderLoading||this.langText("data|loading"))}alertError(){this.table.alertManager.alert(this.table.options.dataLoaderError||this.langText("data|error"),"error")}clearAlert(){this.table.alertManager.clear()}}class uIe{constructor(e,i,r){this.table=e,this.events={},this.optionsList=i||{},this.subscriptionNotifiers={},this.dispatch=r?this._debugDispatch.bind(this):this._dispatch.bind(this),this.debug=r}subscriptionChange(e,i){this.subscriptionNotifiers[e]||(this.subscriptionNotifiers[e]=[]),this.subscriptionNotifiers[e].push(i),this.subscribed(e)&&this._notifySubscriptionChange(e,!0)}subscribe(e,i){this.events[e]||(this.events[e]=[]),this.events[e].push(i),this._notifySubscriptionChange(e,!0)}unsubscribe(e,i){var r;if(this.events[e])if(i)if(r=this.events[e].findIndex(n=>n===i),r>-1)this.events[e].splice(r,1);else{console.warn("Cannot remove event, no matching event found:",e,i);return}else delete this.events[e];else{console.warn("Cannot remove event, no events set on:",e);return}this._notifySubscriptionChange(e,!1)}subscribed(e){return this.events[e]&&this.events[e].length}_notifySubscriptionChange(e,i){var r=this.subscriptionNotifiers[e];r&&r.forEach(n=>{n(i)})}_dispatch(){var e=Array.from(arguments),i=e.shift(),r;return this.events[i]&&this.events[i].forEach((n,a)=>{let o=n.apply(this.table,e);a||(r=o)}),r}_debugDispatch(){var e=Array.from(arguments),i=e[0];return e[0]="ExternalEvent:"+e[0],(this.debug===!0||this.debug.includes(i))&&console.log(...e),this._dispatch(...arguments)}}class cIe{constructor(e){this.events={},this.subscriptionNotifiers={},this.dispatch=e?this._debugDispatch.bind(this):this._dispatch.bind(this),this.chain=e?this._debugChain.bind(this):this._chain.bind(this),this.confirm=e?this._debugConfirm.bind(this):this._confirm.bind(this),this.debug=e}subscriptionChange(e,i){this.subscriptionNotifiers[e]||(this.subscriptionNotifiers[e]=[]),this.subscriptionNotifiers[e].push(i),this.subscribed(e)&&this._notifySubscriptionChange(e,!0)}subscribe(e,i,r=1e4){this.events[e]||(this.events[e]=[]),this.events[e].push({callback:i,priority:r}),this.events[e].sort((n,a)=>n.priority-a.priority),this._notifySubscriptionChange(e,!0)}unsubscribe(e,i){var r;if(this.events[e]){if(i)if(r=this.events[e].findIndex(n=>n.callback===i),r>-1)this.events[e].splice(r,1);else{console.warn("Cannot remove event, no matching event found:",e,i);return}}else{console.warn("Cannot remove event, no events set on:",e);return}this._notifySubscriptionChange(e,!1)}subscribed(e){return this.events[e]&&this.events[e].length}_chain(e,i,r,n){var a=r;return Array.isArray(i)||(i=[i]),this.subscribed(e)?(this.events[e].forEach((o,s)=>{a=o.callback.apply(this,i.concat([a]))}),a):typeof n=="function"?n():n}_confirm(e,i){var r=!1;return Array.isArray(i)||(i=[i]),this.subscribed(e)&&this.events[e].forEach((n,a)=>{n.callback.apply(this,i)&&(r=!0)}),r}_notifySubscriptionChange(e,i){var r=this.subscriptionNotifiers[e];r&&r.forEach(n=>{n(i)})}_dispatch(){var e=Array.from(arguments),i=e.shift();this.events[i]&&this.events[i].forEach(r=>{r.callback.apply(this,e)})}_debugDispatch(){var e=Array.from(arguments),i=e[0];return e[0]="InternalEvent:"+i,(this.debug===!0||this.debug.includes(i))&&console.log(...e),this._dispatch(...arguments)}_debugChain(){var e=Array.from(arguments),i=e[0];return e[0]="InternalEvent:"+i,(this.debug===!0||this.debug.includes(i))&&console.log(...e),this._chain(...arguments)}_debugConfirm(){var e=Array.from(arguments),i=e[0];return e[0]="InternalEvent:"+i,(this.debug===!0||this.debug.includes(i))&&console.log(...e),this._confirm(...arguments)}}class dIe extends Ka{constructor(e){super(e)}_warnUser(){this.options("debugDeprecation")&&console.warn(...arguments)}check(e,i,r){var n="";return typeof this.options(e)<"u"?(n="Deprecated Setup Option - Use of the %c"+e+"%c option is now deprecated",i?(n=n+", Please use the %c"+i+"%c option instead",this._warnUser(n,"font-weight: bold;","font-weight: normal;","font-weight: bold;","font-weight: normal;"),r&&(this.table.options[i]=this.table.options[e])):this._warnUser(n,"font-weight: bold;","font-weight: normal;"),!1):!0}checkMsg(e,i){return typeof this.options(e)<"u"?(this._warnUser("%cDeprecated Setup Option - Use of the %c"+e+" %c option is now deprecated, "+i,"font-weight: normal;","font-weight: bold;","font-weight: normal;"),!1):!0}msg(e){this._warnUser(e)}}function pIe(t,e){e&&this.table.columnManager.renderer.reinitializeColumnWidths(t),this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&this.table.modules.responsiveLayout.update()}function $V(t,e){t.forEach(function(i){i.reinitializeWidth()}),this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&this.table.modules.responsiveLayout.update()}function mIe(t,e){var i=0,r=this.table.rowManager.element.clientWidth,n=0,a=!1;t.forEach((o,s)=>{o.widthFixed||o.reinitializeWidth(),(this.table.options.responsiveLayout?o.modules.responsive.visible:o.visible)&&(a=o),o.visible&&(i+=o.getWidth())}),a?(n=r-i+a.getWidth(),this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&(a.setWidth(0),this.table.modules.responsiveLayout.update()),n>0?a.setWidth(n):a.reinitializeWidth()):this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&this.table.modules.responsiveLayout.update()}function hIe(t,e){var i=this.table.rowManager.element.getBoundingClientRect().width,r=0,n=0,a=0,o=0,s=[],l=[],u=0,c=0,d=0;function p(h){var f;return typeof h=="string"?h.indexOf("%")>-1?f=i/100*parseInt(h):f=parseInt(h):f=h,f}function m(h,f,g,v){var y=[],I=0,b=0,S=0,w=a,U=0,T=0,D=[];function P(R){return g*(R.column.definition.widthGrow||1)}function E(R){return p(R.width)-g*(R.column.definition.widthShrink||0)}return h.forEach(function(R,N){var A=v?E(R):P(R);R.column.minWidth>=A?y.push(R):R.column.maxWidth&&R.column.maxWidth<A?(R.width=R.column.maxWidth,f-=R.column.maxWidth,w-=v?R.column.definition.widthShrink||1:R.column.definition.widthGrow||1,w&&(g=Math.floor(f/w))):(D.push(R),T+=v?R.column.definition.widthShrink||1:R.column.definition.widthGrow||1)}),y.length?(y.forEach(function(R){I+=v?R.width-R.column.minWidth:R.column.minWidth,R.width=R.column.minWidth}),b=f-I,S=T?Math.floor(b/T):b,U=m(D,b,S,v)):(U=T?f-Math.floor(f/T)*T:f,D.forEach(function(R){R.width=v?E(R):P(R)})),U}this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&this.table.modules.responsiveLayout.update(),this.table.rowManager.element.scrollHeight>this.table.rowManager.element.clientHeight&&(i-=this.table.rowManager.element.offsetWidth-this.table.rowManager.element.clientWidth),t.forEach(function(h){var f,g,v;h.visible&&(f=h.definition.width,g=parseInt(h.minWidth),f?(v=p(f),r+=v>g?v:g,h.definition.widthShrink&&(l.push({column:h,width:v>g?v:g}),u+=h.definition.widthShrink)):(s.push({column:h,width:0}),a+=h.definition.widthGrow||1))}),n=i-r,o=Math.floor(n/a),d=m(s,n,o,!1),s.length&&d>0&&(s[s.length-1].width+=d),s.forEach(function(h){n-=h.width}),c=Math.abs(d)+n,c>0&&u&&(d=m(l,c,Math.floor(c/u),!0)),d&&l.length&&(l[l.length-1].width-=d),s.forEach(function(h){h.column.setWidth(h.width)}),l.forEach(function(h){h.column.setWidth(h.width)})}var fIe={fitData:pIe,fitDataFill:$V,fitDataTable:$V,fitDataStretch:mIe,fitColumns:hIe};const gf=class gf extends ci{constructor(e){super(e,"layout"),this.mode=null,this.registerTableOption("layout","fitData"),this.registerTableOption("layoutColumnsOnNewData",!1),this.registerColumnOption("widthGrow"),this.registerColumnOption("widthShrink")}initialize(){var e=this.table.options.layout;gf.modes[e]?this.mode=e:(console.warn("Layout Error - invalid mode set, defaulting to 'fitData' : "+e),this.mode="fitData"),this.table.element.setAttribute("tabulator-layout",this.mode),this.subscribe("column-init",this.initializeColumn.bind(this))}initializeColumn(e){e.definition.widthGrow&&(e.definition.widthGrow=Number(e.definition.widthGrow)),e.definition.widthShrink&&(e.definition.widthShrink=Number(e.definition.widthShrink))}getMode(){return this.mode}layout(e){this.dispatch("layout-refreshing"),gf.modes[this.mode].call(this,this.table.columnManager.columnsByIndex,e),this.dispatch("layout-refreshed")}};Ve(gf,"moduleName","layout"),Ve(gf,"modes",fIe);let L1=gf;var gIe={default:{groups:{item:"item",items:"items"},columns:{},data:{loading:"Loading",error:"Error"},pagination:{page_size:"Page Size",page_title:"Show Page",first:"First",first_title:"First Page",last:"Last",last_title:"Last Page",prev:"Prev",prev_title:"Prev Page",next:"Next",next_title:"Next Page",all:"All",counter:{showing:"Showing",of:"of",rows:"rows",pages:"pages"}},headerFilters:{default:"filter column...",columns:{}}}};const vI=class vI extends ci{constructor(e){super(e),this.locale="default",this.lang=!1,this.bindings={},this.langList={},this.registerTableOption("locale",!1),this.registerTableOption("langs",{})}initialize(){this.langList=xr.deepClone(vI.langs),this.table.options.columnDefaults.headerFilterPlaceholder!==!1&&this.setHeaderFilterPlaceholder(this.table.options.columnDefaults.headerFilterPlaceholder);for(let e in this.table.options.langs)this.installLang(e,this.table.options.langs[e]);this.setLocale(this.table.options.locale),this.registerTableFunction("setLocale",this.setLocale.bind(this)),this.registerTableFunction("getLocale",this.getLocale.bind(this)),this.registerTableFunction("getLang",this.getLang.bind(this))}setHeaderFilterPlaceholder(e){this.langList.default.headerFilters.default=e}installLang(e,i){this.langList[e]?this._setLangProp(this.langList[e],i):this.langList[e]=i}_setLangProp(e,i){for(let r in i)e[r]&&typeof e[r]=="object"?this._setLangProp(e[r],i[r]):e[r]=i[r]}setLocale(e){e=e||"default";function i(r,n){for(var a in r)typeof r[a]=="object"?(n[a]||(n[a]={}),i(r[a],n[a])):n[a]=r[a]}if(e===!0&&navigator.language&&(e=navigator.language.toLowerCase()),e&&!this.langList[e]){let r=e.split("-")[0];this.langList[r]?(console.warn("Localization Error - Exact matching locale not found, using closest match: ",e,r),e=r):(console.warn("Localization Error - Matching locale not found, using default: ",e),e="default")}this.locale=e,this.lang=xr.deepClone(this.langList.default||{}),e!="default"&&i(this.langList[e],this.lang),this.dispatchExternal("localized",this.locale,this.lang),this._executeBindings()}getLocale(e){return this.locale}getLang(e){return e?this.langList[e]:this.lang}getText(e,i){var r=i?e+"|"+i:e,n=r.split("|"),a=this._getLangElement(n,this.locale);return a||""}_getLangElement(e,i){var r=this.lang;return e.forEach(function(n){var a;r&&(a=r[n],typeof a<"u"?r=a:r=!1)}),r}bind(e,i){this.bindings[e]||(this.bindings[e]=[]),this.bindings[e].push(i),i(this.getText(e),this.lang)}_executeBindings(){for(let e in this.bindings)this.bindings[e].forEach(i=>{i(this.getText(e),this.lang)})}};Ve(vI,"moduleName","localize"),Ve(vI,"langs",gIe);let _1=vI;class x7 extends ci{constructor(e){super(e)}initialize(){this.registerTableFunction("tableComms",this.receive.bind(this))}getConnections(e){var i=[],r;return r=this.table.constructor.registry.lookupTable(e),r.forEach(n=>{this.table!==n&&i.push(n)}),i}send(e,i,r,n){var a=this.getConnections(e);a.forEach(o=>{o.tableComms(this.table.element,i,r,n)}),!a.length&&e&&console.warn("Table Connection Error - No tables matching selector found",e)}receive(e,i,r,n){if(this.table.modExists(i))return this.table.modules[i].commsReceived(e,r,n);console.warn("Inter-table Comms Error - no such module:",i)}}Ve(x7,"moduleName","comms");var vIe=Object.freeze({__proto__:null,CommsModule:x7,LayoutModule:L1,LocalizeModule:_1});const ms=class ms{static findTable(e){var i=ms.registry.lookupTable(e,!0);return Array.isArray(i)&&!i.length?!1:i}};Ve(ms,"registry",{tables:[],register(e){ms.registry.tables.push(e)},deregister(e){var i=ms.registry.tables.indexOf(e);i>-1&&ms.registry.tables.splice(i,1)},lookupTable(e,i){var r=[],n,a;if(typeof e=="string"){if(n=document.querySelectorAll(e),n.length)for(var o=0;o<n.length;o++)a=ms.registry.matchElement(n[o]),a&&r.push(a)}else typeof HTMLElement<"u"&&e instanceof HTMLElement||e instanceof ms?(a=ms.registry.matchElement(e),a&&r.push(a)):Array.isArray(e)?e.forEach(function(s){r=r.concat(ms.registry.lookupTable(s))}):i||console.warn("Table Connection Error - Invalid Selector",e);return r},matchElement(e){return ms.registry.tables.find(function(i){return e instanceof ms?i===e:i.element===e})}});let $1=ms;const ar=class ar extends $1{constructor(){super()}static initializeModuleBinder(e){ar.modulesRegistered||(ar.modulesRegistered=!0,ar._registerModules(vIe,!0),e&&ar._registerModules(e))}static _extendModule(e,i,r){if(ar.moduleBindings[e]){var n=ar.moduleBindings[e][i];if(n)if(typeof r=="object")for(let a in r)n[a]=r[a];else console.warn("Module Error - Invalid value type, it must be an object");else console.warn("Module Error - property does not exist:",i)}else console.warn("Module Error - module does not exist:",e)}static _registerModules(e,i){var r=Object.values(e);i&&r.forEach(n=>{n.prototype.moduleCore=!0}),ar._registerModule(r)}static _registerModule(e){Array.isArray(e)||(e=[e]),e.forEach(i=>{ar._registerModuleBinding(i),ar._registerModuleExtensions(i)})}static _registerModuleBinding(e){e.moduleName?ar.moduleBindings[e.moduleName]=e:console.error("Unable to bind module, no moduleName defined",e.moduleName)}static _registerModuleExtensions(e){var i=e.moduleExtensions;if(e.moduleExtensions)for(let r in i){let n=i[r];if(ar.moduleBindings[r])for(let a in n)ar._extendModule(r,a,n[a]);else{ar.moduleExtensions[r]||(ar.moduleExtensions[r]={});for(let a in n)ar.moduleExtensions[r][a]||(ar.moduleExtensions[r][a]={}),Object.assign(ar.moduleExtensions[r][a],n[a])}}ar._extendModuleFromQueue(e)}static _extendModuleFromQueue(e){var i=ar.moduleExtensions[e.moduleName];if(i)for(let r in i)ar._extendModule(e.moduleName,r,i[r])}_bindModules(){var e=[],i=[],r=[];this.modules={};for(var n in ar.moduleBindings){let a=ar.moduleBindings[n],o=new a(this);this.modules[n]=o,a.prototype.moduleCore?this.modulesCore.push(o):a.moduleInitOrder?a.moduleInitOrder<0?e.push(o):i.push(o):r.push(o)}e.sort((a,o)=>a.moduleInitOrder>o.moduleInitOrder?1:-1),i.sort((a,o)=>a.moduleInitOrder>o.moduleInitOrder?1:-1),this.modulesRegular=e.concat(r.concat(i))}};Ve(ar,"moduleBindings",{}),Ve(ar,"moduleExtensions",{}),Ve(ar,"modulesRegistered",!1),Ve(ar,"defaultModules",!1);let B1=ar;class IIe extends Ka{constructor(e){super(e),this.element=this._createAlertElement(),this.msgElement=this._createMsgElement(),this.type=null,this.element.appendChild(this.msgElement)}_createAlertElement(){var e=document.createElement("div");return e.classList.add("tabulator-alert"),e}_createMsgElement(){var e=document.createElement("div");return e.classList.add("tabulator-alert-msg"),e.setAttribute("role","alert"),e}_typeClass(){return"tabulator-alert-state-"+this.type}alert(e,i="msg"){if(e){for(this.clear(),this.dispatch("alert-show",i),this.type=i;this.msgElement.firstChild;)this.msgElement.removeChild(this.msgElement.firstChild);this.msgElement.classList.add(this._typeClass()),typeof e=="function"&&(e=e()),e instanceof HTMLElement?this.msgElement.appendChild(e):this.msgElement.innerHTML=e,this.table.element.appendChild(this.element)}}clear(){this.dispatch("alert-hide",this.type),this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.msgElement.classList.remove(this._typeClass())}}const mc=class mc extends B1{static extendModule(){mc.initializeModuleBinder(),mc._extendModule(...arguments)}static registerModule(){mc.initializeModuleBinder(),mc._registerModule(...arguments)}constructor(e,i,r){super(),mc.initializeModuleBinder(r),this.options={},this.columnManager=null,this.rowManager=null,this.footerManager=null,this.alertManager=null,this.vdomHoz=null,this.externalEvents=null,this.eventBus=null,this.interactionMonitor=!1,this.browser="",this.browserSlow=!1,this.browserMobile=!1,this.rtl=!1,this.originalElement=null,this.componentFunctionBinder=new sIe(this),this.dataLoader=!1,this.modules={},this.modulesCore=[],this.modulesRegular=[],this.deprecationAdvisor=new dIe(this),this.optionsList=new k7(this,"table constructor"),this.initialized=!1,this.destroyed=!1,this.initializeElement(e)&&(this.initializeCoreSystems(i),setTimeout(()=>{this._create()})),this.constructor.registry.register(this)}initializeElement(e){return typeof HTMLElement<"u"&&e instanceof HTMLElement?(this.element=e,!0):typeof e=="string"?(this.element=document.querySelector(e),this.element?!0:(console.error("Tabulator Creation Error - no element found matching selector: ",e),!1)):(console.error("Tabulator Creation Error - Invalid element provided:",e),!1)}initializeCoreSystems(e){this.columnManager=new tIe(this),this.rowManager=new nIe(this),this.footerManager=new aIe(this),this.dataLoader=new lIe(this),this.alertManager=new IIe(this),this._bindModules(),this.options=this.optionsList.generate(mc.defaultOptions,e),this._clearObjectPointers(),this._mapDeprecatedFunctionality(),this.externalEvents=new uIe(this,this.options,this.options.debugEventsExternal),this.eventBus=new cIe(this.options.debugEventsInternal),this.interactionMonitor=new oIe(this),this.dataLoader.initialize(),this.footerManager.initialize()}_mapDeprecatedFunctionality(){}_clearSelection(){this.element.classList.add("tabulator-block-select"),window.getSelection?window.getSelection().empty?window.getSelection().empty():window.getSelection().removeAllRanges&&window.getSelection().removeAllRanges():document.selection&&document.selection.empty(),this.element.classList.remove("tabulator-block-select")}_create(){this.externalEvents.dispatch("tableBuilding"),this.eventBus.dispatch("table-building"),this._rtlCheck(),this._buildElement(),this._initializeTable(),this.initialized=!0,this._loadInitialData().finally(()=>{this.eventBus.dispatch("table-initialized"),this.externalEvents.dispatch("tableBuilt")})}_rtlCheck(){var e=window.getComputedStyle(this.element);switch(this.options.textDirection){case"auto":if(e.direction!=="rtl")break;case"rtl":this.element.classList.add("tabulator-rtl"),this.rtl=!0;break;case"ltr":this.element.classList.add("tabulator-ltr");default:this.rtl=!1}}_clearObjectPointers(){this.options.columns=this.options.columns.slice(0),Array.isArray(this.options.data)&&!this.options.reactiveData&&(this.options.data=this.options.data.slice(0))}_buildElement(){var e=this.element,i=this.options,r;if(e.tagName==="TABLE"){this.originalElement=this.element,r=document.createElement("div");var n=e.attributes;for(var a in n)typeof n[a]=="object"&&r.setAttribute(n[a].name,n[a].value);e.parentNode.replaceChild(r,e),this.element=e=r}for(e.classList.add("tabulator"),e.setAttribute("role","grid");e.firstChild;)e.removeChild(e.firstChild);i.height&&(i.height=isNaN(i.height)?i.height:i.height+"px",e.style.height=i.height),i.minHeight!==!1&&(i.minHeight=isNaN(i.minHeight)?i.minHeight:i.minHeight+"px",e.style.minHeight=i.minHeight),i.maxHeight!==!1&&(i.maxHeight=isNaN(i.maxHeight)?i.maxHeight:i.maxHeight+"px",e.style.maxHeight=i.maxHeight)}_initializeTable(){var e=this.element,i=this.options;this.interactionMonitor.initialize(),this.columnManager.initialize(),this.rowManager.initialize(),this._detectBrowser(),this.modulesCore.forEach(r=>{r.initialize()}),e.appendChild(this.columnManager.getElement()),e.appendChild(this.rowManager.getElement()),i.footerElement&&this.footerManager.activate(),i.autoColumns&&i.data&&this.columnManager.generateColumnsFromRowData(this.options.data),this.modulesRegular.forEach(r=>{r.initialize()}),this.columnManager.setColumns(i.columns),this.eventBus.dispatch("table-built")}_loadInitialData(){return this.dataLoader.load(this.options.data).finally(()=>{this.columnManager.verticalAlignHeaders()})}destroy(){var e=this.element;for(this.destroyed=!0,this.constructor.registry.deregister(this),this.eventBus.dispatch("table-destroy"),this.rowManager.destroy();e.firstChild;)e.removeChild(e.firstChild);e.classList.remove("tabulator"),this.externalEvents.dispatch("tableDestroyed")}_detectBrowser(){var e=navigator.userAgent||navigator.vendor||window.opera;e.indexOf("Trident")>-1?(this.browser="ie",this.browserSlow=!0):e.indexOf("Edge")>-1?(this.browser="edge",this.browserSlow=!0):e.indexOf("Firefox")>-1?(this.browser="firefox",this.browserSlow=!1):e.indexOf("Mac OS")>-1?(this.browser="safari",this.browserSlow=!1):(this.browser="other",this.browserSlow=!1),this.browserMobile=/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw-(n|u)|c55\/|capi|ccwa|cdm-|cell|chtm|cldc|cmd-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc-s|devi|dica|dmob|do(c|p)o|ds(12|-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(-|_)|g1 u|g560|gene|gf-5|g-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd-(m|p|t)|hei-|hi(pt|ta)|hp( i|ip)|hs-c|ht(c(-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i-(20|go|ma)|i230|iac( |-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|-[a-w])|libw|lynx|m1-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|-([1-8]|c))|phil|pire|pl(ay|uc)|pn-2|po(ck|rt|se)|prox|psio|pt-g|qa-a|qc(07|12|21|32|60|-[2-7]|i-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h-|oo|p-)|sdk\/|se(c(-|0|1)|47|mc|nd|ri)|sgh-|shar|sie(-|m)|sk-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h-|v-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl-|tdg-|tel(i|m)|tim-|t-mo|to(pl|sh)|ts(70|m-|m3|m5)|tx-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas-|your|zeto|zte-/i.test(e.slice(0,4))}initGuard(e,i){var r,n;return this.options.debugInitialization&&!this.initialized&&(e||(r=new Error().stack.split(`
`),n=r[0]=="Error"?r[2]:r[1],n[0]==" "?e=n.trim().split(" ")[1].split(".")[1]:e=n.trim().split("@")[0]),console.warn("Table Not Initialized - Calling the "+e+" function before the table is initialized may result in inconsistent behavior, Please wait for the `tableBuilt` event before calling this function."+(i?" "+i:""))),this.initialized}blockRedraw(){this.initGuard(),this.eventBus.dispatch("redraw-blocking"),this.rowManager.blockRedraw(),this.columnManager.blockRedraw(),this.eventBus.dispatch("redraw-blocked")}restoreRedraw(){this.initGuard(),this.eventBus.dispatch("redraw-restoring"),this.rowManager.restoreRedraw(),this.columnManager.restoreRedraw(),this.eventBus.dispatch("redraw-restored")}setData(e,i,r){return this.initGuard(!1,"To set initial data please use the 'data' property in the table constructor."),this.dataLoader.load(e,i,r,!1)}clearData(){this.initGuard(),this.dataLoader.blockActiveLoad(),this.rowManager.clearData()}getData(e){return this.rowManager.getData(e)}getDataCount(e){return this.rowManager.getDataCount(e)}replaceData(e,i,r){return this.initGuard(),this.dataLoader.load(e,i,r,!0,!0)}updateData(e){var i=0;return this.initGuard(),new Promise((r,n)=>{this.dataLoader.blockActiveLoad(),typeof e=="string"&&(e=JSON.parse(e)),e&&e.length>0?e.forEach(a=>{var o=this.rowManager.findRow(a[this.options.index]);o?(i++,o.updateData(a).then(()=>{i--,i||r()}).catch(s=>{n("Update Error - Unable to update row",a,s)})):n("Update Error - Unable to find row",a)}):(console.warn("Update Error - No data provided"),n("Update Error - No data provided"))})}addData(e,i,r){return this.initGuard(),new Promise((n,a)=>{this.dataLoader.blockActiveLoad(),typeof e=="string"&&(e=JSON.parse(e)),e?this.rowManager.addRows(e,i,r).then(o=>{var s=[];o.forEach(function(l){s.push(l.getComponent())}),n(s)}):(console.warn("Update Error - No data provided"),a("Update Error - No data provided"))})}updateOrAddData(e){var i=[],r=0;return this.initGuard(),new Promise((n,a)=>{this.dataLoader.blockActiveLoad(),typeof e=="string"&&(e=JSON.parse(e)),e&&e.length>0?e.forEach(o=>{var s=this.rowManager.findRow(o[this.options.index]);r++,s?s.updateData(o).then(()=>{r--,i.push(s.getComponent()),r||n(i)}):this.rowManager.addRows(o).then(l=>{r--,i.push(l[0].getComponent()),r||n(i)})}):(console.warn("Update Error - No data provided"),a("Update Error - No data provided"))})}getRow(e){var i=this.rowManager.findRow(e);return i?i.getComponent():(console.warn("Find Error - No matching row found:",e),!1)}getRowFromPosition(e){var i=this.rowManager.getRowFromPosition(e);return i?i.getComponent():(console.warn("Find Error - No matching row found:",e),!1)}deleteRow(e){var i=[];this.initGuard(),Array.isArray(e)||(e=[e]);for(let r of e){let n=this.rowManager.findRow(r,!0);if(n)i.push(n);else return console.error("Delete Error - No matching row found:",r),Promise.reject("Delete Error - No matching row found")}return i.sort((r,n)=>this.rowManager.rows.indexOf(r)>this.rowManager.rows.indexOf(n)?1:-1),i.forEach(r=>{r.delete()}),this.rowManager.reRenderInPosition(),Promise.resolve()}addRow(e,i,r){return this.initGuard(),typeof e=="string"&&(e=JSON.parse(e)),this.rowManager.addRows(e,i,r,!0).then(n=>n[0].getComponent())}updateOrAddRow(e,i){var r=this.rowManager.findRow(e);return this.initGuard(),typeof i=="string"&&(i=JSON.parse(i)),r?r.updateData(i).then(()=>r.getComponent()):this.rowManager.addRows(i).then(n=>n[0].getComponent())}updateRow(e,i){var r=this.rowManager.findRow(e);return this.initGuard(),typeof i=="string"&&(i=JSON.parse(i)),r?r.updateData(i).then(()=>Promise.resolve(r.getComponent())):(console.warn("Update Error - No matching row found:",e),Promise.reject("Update Error - No matching row found"))}scrollToRow(e,i,r){var n=this.rowManager.findRow(e);return n?this.rowManager.scrollToRow(n,i,r):(console.warn("Scroll Error - No matching row found:",e),Promise.reject("Scroll Error - No matching row found"))}moveRow(e,i,r){var n=this.rowManager.findRow(e);this.initGuard(),n?n.moveToRow(i,r):console.warn("Move Error - No matching row found:",e)}getRows(e){return this.rowManager.getComponents(e)}getRowPosition(e){var i=this.rowManager.findRow(e);return i?i.getPosition():(console.warn("Position Error - No matching row found:",e),!1)}setColumns(e){this.initGuard(!1,"To set initial columns please use the 'columns' property in the table constructor"),this.columnManager.setColumns(e)}getColumns(e){return this.columnManager.getComponents(e)}getColumn(e){var i=this.columnManager.findColumn(e);return i?i.getComponent():(console.warn("Find Error - No matching column found:",e),!1)}getColumnDefinitions(){return this.columnManager.getDefinitionTree()}showColumn(e){var i=this.columnManager.findColumn(e);if(this.initGuard(),i)i.show();else return console.warn("Column Show Error - No matching column found:",e),!1}hideColumn(e){var i=this.columnManager.findColumn(e);if(this.initGuard(),i)i.hide();else return console.warn("Column Hide Error - No matching column found:",e),!1}toggleColumn(e){var i=this.columnManager.findColumn(e);if(this.initGuard(),i)i.visible?i.hide():i.show();else return console.warn("Column Visibility Toggle Error - No matching column found:",e),!1}addColumn(e,i,r){var n=this.columnManager.findColumn(r);return this.initGuard(),this.columnManager.addColumn(e,i,n).then(a=>a.getComponent())}deleteColumn(e){var i=this.columnManager.findColumn(e);return this.initGuard(),i?i.delete():(console.warn("Column Delete Error - No matching column found:",e),Promise.reject())}updateColumnDefinition(e,i){var r=this.columnManager.findColumn(e);return this.initGuard(),r?r.updateDefinition(i):(console.warn("Column Update Error - No matching column found:",e),Promise.reject())}moveColumn(e,i,r){var n=this.columnManager.findColumn(e),a=this.columnManager.findColumn(i);this.initGuard(),n?a?this.columnManager.moveColumn(n,a,r):console.warn("Move Error - No matching column found:",a):console.warn("Move Error - No matching column found:",e)}scrollToColumn(e,i,r){return new Promise((n,a)=>{var o=this.columnManager.findColumn(e);return o?this.columnManager.scrollToColumn(o,i,r):(console.warn("Scroll Error - No matching column found:",e),Promise.reject("Scroll Error - No matching column found"))})}redraw(e){this.initGuard(),this.columnManager.redraw(e),this.rowManager.redraw(e)}setHeight(e){this.options.height=isNaN(e)?e:e+"px",this.element.style.height=this.options.height,this.rowManager.initializeRenderer(),this.rowManager.redraw(!0)}on(e,i){this.externalEvents.subscribe(e,i)}off(e,i){this.externalEvents.unsubscribe(e,i)}dispatchEvent(){var e=Array.from(arguments);e.shift(),this.externalEvents.dispatch(...arguments)}alert(e,i){this.initGuard(),this.alertManager.alert(e,i)}clearAlert(){this.initGuard(),this.alertManager.clear()}modExists(e,i){return this.modules[e]?!0:(i&&console.error("Tabulator Module Not Installed: "+e),!1)}module(e){var i=this.modules[e];return i||console.error("Tabulator module not installed: "+e),i}};Ve(mc,"defaultOptions",Qve);let V1=mc;var Lv=V1;class yIe extends Lv{static extendModule(){Lv.initializeModuleBinder(CE),Lv._extendModule(...arguments)}static registerModule(){Lv.initializeModuleBinder(CE),Lv._registerModule(...arguments)}constructor(e,i,r){super(e,i,CE)}}var Vb=yIe;function XD({anchorId:t}){const e=Vb.findTable(`#${t}`)[0];e&&e.destroy()}function bIe(t,e){return t?zD.dateTime.convertTime(t,e):""}function F7(t){var R;const e=document.createElement("span");if(!t.getColumn().getDefinition().field)return e.className="schedule-cell",e;const r=t.getValue(),{potentialParticipants:n,eventName:a="",roundName:o="",schedule:s={},winningSide:l,matchUpId:u,sides:c}=r||{},{courtOrder:d="",scheduledTime:p="",courtId:m="",timeModifiers:h,venueId:f=""}=s;if(e.setAttribute("courtOrder",d),e.setAttribute("courtId",m),e.setAttribute("venueId",f),e.className="schedule-cell dragdrop",e.ondragover=N=>N.preventDefault(),u&&(e.draggable=!0,e.id=u,l&&e.classList.add("matchup-complete")),!u)return e;const g=`${a} ${o}`,v=N=>{var A,M;return((M=(A=N.person)==null?void 0:A.standardFamilyName)==null?void 0:M.toUpperCase())||N.participantName},y=n==null?void 0:n.map(N=>N==null?void 0:N.map(A=>`<span class='potential nowrap'>${v(A)}</span>`).join('<span style="font-weight: bold">&nbsp;or&nbsp;</span>')),I=N=>{var M,C;const A=(C=(M=c==null?void 0:c.find(O=>N===O.sideNumber))==null?void 0:M.participant)==null?void 0:C.participantName;if(A)return l===N?`<span style='font-weight: bold'>${A}</span>`:A},b=I(1)||(y==null?void 0:y.shift())||"Unkown",S=I(2)||(y==null?void 0:y.shift())||"Unknown";e.id=u;const w=document.createElement("div");w.className="header flexrow",w.innerHTML=((h==null?void 0:h[0])&&rge[h[0]]+"&nbsp;"||"")+bIe(p,!1),e.appendChild(w);const U=document.createElement("div");U.className="catround",U.innerHTML=g,e.appendChild(U);const T=document.createElement("div");T.className="scheduled_teams";const D=document.createElement("div");D.className="scheduled_team",D.style.fontSize="1em",D.innerHTML=b,T.appendChild(D);const P=document.createElement("div");P.className="divider",P.innerHTML="vs.",T.appendChild(P);const E=document.createElement("div");if(E.className="scheduled_team",E.style.fontSize="1em",E.innerHTML=S,T.appendChild(E),l){const N=document.createElement("div");N.innerHTML=((R=r.score)==null?void 0:R.scoreStringSide1)||"",T.appendChild(N)}return e.appendChild(T),e}function wIe({count:t}){return t>0?zD.generateRange(0,t).map(()=>({headerHozAlign:Zi,formatter:F7,headerSort:!1,resizable:!1,minWidth:150})):[]}function UIe(){function t(e){e.getElement().style.backgroundColor="white";const i=document.createElement("span"),r=e.getRow().getData();return i.innerHTML=r.rowNumber,i}return{formatter:t,headerSort:!1,resizable:!1,hozAlign:Zi,frozen:!0,width:55}}function SIe({courtsData:t,courtPrefix:e}){const i=ige-(t==null?void 0:t.length)||0,r=i<=0?1:i,n=wIe({count:r}),a=UIe(),o=(s,l)=>({field:`${e}${l}`,title:s.courtName,headerHozAlign:Zi,formatter:F7,headerSort:!1,resizable:!1,hozAlign:Zi,minWidth:150});return[a].concat(t==null?void 0:t.map(o),n)}var TIe=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function DIe(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var L7={exports:{}};(function(t,e){(function(i,r){t.exports=r()})(TIe,function(){var i=1e3,r=6e4,n=36e5,a="millisecond",o="second",s="minute",l="hour",u="day",c="week",d="month",p="quarter",m="year",h="date",f="Invalid Date",g=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,v=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,y={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(A){var M=["th","st","nd","rd"],C=A%100;return"["+A+(M[(C-20)%10]||M[C]||M[0])+"]"}},I=function(A,M,C){var O=String(A);return!O||O.length>=M?A:""+Array(M+1-O.length).join(C)+A},b={s:I,z:function(A){var M=-A.utcOffset(),C=Math.abs(M),O=Math.floor(C/60),k=C%60;return(M<=0?"+":"-")+I(O,2,"0")+":"+I(k,2,"0")},m:function A(M,C){if(M.date()<C.date())return-A(C,M);var O=12*(C.year()-M.year())+(C.month()-M.month()),k=M.clone().add(O,d),x=C-k<0,F=M.clone().add(O+(x?-1:1),d);return+(-(O+(C-k)/(x?k-F:F-k))||0)},a:function(A){return A<0?Math.ceil(A)||0:Math.floor(A)},p:function(A){return{M:d,y:m,w:c,d:u,D:h,h:l,m:s,s:o,ms:a,Q:p}[A]||String(A||"").toLowerCase().replace(/s$/,"")},u:function(A){return A===void 0}},S="en",w={};w[S]=y;var U="$isDayjsObject",T=function(A){return A instanceof R||!(!A||!A[U])},D=function A(M,C,O){var k;if(!M)return S;if(typeof M=="string"){var x=M.toLowerCase();w[x]&&(k=x),C&&(w[x]=C,k=x);var F=M.split("-");if(!k&&F.length>1)return A(F[0])}else{var $=M.name;w[$]=M,k=$}return!O&&k&&(S=k),k||!O&&S},P=function(A,M){if(T(A))return A.clone();var C=typeof M=="object"?M:{};return C.date=A,C.args=arguments,new R(C)},E=b;E.l=D,E.i=T,E.w=function(A,M){return P(A,{locale:M.$L,utc:M.$u,x:M.$x,$offset:M.$offset})};var R=function(){function A(C){this.$L=D(C.locale,null,!0),this.parse(C),this.$x=this.$x||C.x||{},this[U]=!0}var M=A.prototype;return M.parse=function(C){this.$d=function(O){var k=O.date,x=O.utc;if(k===null)return new Date(NaN);if(E.u(k))return new Date;if(k instanceof Date)return new Date(k);if(typeof k=="string"&&!/Z$/i.test(k)){var F=k.match(g);if(F){var $=F[2]-1||0,_=(F[7]||"0").substring(0,3);return x?new Date(Date.UTC(F[1],$,F[3]||1,F[4]||0,F[5]||0,F[6]||0,_)):new Date(F[1],$,F[3]||1,F[4]||0,F[5]||0,F[6]||0,_)}}return new Date(k)}(C),this.init()},M.init=function(){var C=this.$d;this.$y=C.getFullYear(),this.$M=C.getMonth(),this.$D=C.getDate(),this.$W=C.getDay(),this.$H=C.getHours(),this.$m=C.getMinutes(),this.$s=C.getSeconds(),this.$ms=C.getMilliseconds()},M.$utils=function(){return E},M.isValid=function(){return this.$d.toString()!==f},M.isSame=function(C,O){var k=P(C);return this.startOf(O)<=k&&k<=this.endOf(O)},M.isAfter=function(C,O){return P(C)<this.startOf(O)},M.isBefore=function(C,O){return this.endOf(O)<P(C)},M.$g=function(C,O,k){return E.u(C)?this[O]:this.set(k,C)},M.unix=function(){return Math.floor(this.valueOf()/1e3)},M.valueOf=function(){return this.$d.getTime()},M.startOf=function(C,O){var k=this,x=!!E.u(O)||O,F=E.p(C),$=function(W,q){var Y=E.w(k.$u?Date.UTC(k.$y,q,W):new Date(k.$y,q,W),k);return x?Y:Y.endOf(u)},_=function(W,q){return E.w(k.toDate()[W].apply(k.toDate("s"),(x?[0,0,0,0]:[23,59,59,999]).slice(q)),k)},L=this.$W,B=this.$M,V=this.$D,G="set"+(this.$u?"UTC":"");switch(F){case m:return x?$(1,0):$(31,11);case d:return x?$(1,B):$(0,B+1);case c:var j=this.$locale().weekStart||0,z=(L<j?L+7:L)-j;return $(x?V-z:V+(6-z),B);case u:case h:return _(G+"Hours",0);case l:return _(G+"Minutes",1);case s:return _(G+"Seconds",2);case o:return _(G+"Milliseconds",3);default:return this.clone()}},M.endOf=function(C){return this.startOf(C,!1)},M.$set=function(C,O){var k,x=E.p(C),F="set"+(this.$u?"UTC":""),$=(k={},k[u]=F+"Date",k[h]=F+"Date",k[d]=F+"Month",k[m]=F+"FullYear",k[l]=F+"Hours",k[s]=F+"Minutes",k[o]=F+"Seconds",k[a]=F+"Milliseconds",k)[x],_=x===u?this.$D+(O-this.$W):O;if(x===d||x===m){var L=this.clone().set(h,1);L.$d[$](_),L.init(),this.$d=L.set(h,Math.min(this.$D,L.daysInMonth())).$d}else $&&this.$d[$](_);return this.init(),this},M.set=function(C,O){return this.clone().$set(C,O)},M.get=function(C){return this[E.p(C)]()},M.add=function(C,O){var k,x=this;C=Number(C);var F=E.p(O),$=function(B){var V=P(x);return E.w(V.date(V.date()+Math.round(B*C)),x)};if(F===d)return this.set(d,this.$M+C);if(F===m)return this.set(m,this.$y+C);if(F===u)return $(1);if(F===c)return $(7);var _=(k={},k[s]=r,k[l]=n,k[o]=i,k)[F]||1,L=this.$d.getTime()+C*_;return E.w(L,this)},M.subtract=function(C,O){return this.add(-1*C,O)},M.format=function(C){var O=this,k=this.$locale();if(!this.isValid())return k.invalidDate||f;var x=C||"YYYY-MM-DDTHH:mm:ssZ",F=E.z(this),$=this.$H,_=this.$m,L=this.$M,B=k.weekdays,V=k.months,G=k.meridiem,j=function(q,Y,re,K){return q&&(q[Y]||q(O,x))||re[Y].slice(0,K)},z=function(q){return E.s($%12||12,q,"0")},W=G||function(q,Y,re){var K=q<12?"AM":"PM";return re?K.toLowerCase():K};return x.replace(v,function(q,Y){return Y||function(re){switch(re){case"YY":return String(O.$y).slice(-2);case"YYYY":return E.s(O.$y,4,"0");case"M":return L+1;case"MM":return E.s(L+1,2,"0");case"MMM":return j(k.monthsShort,L,V,3);case"MMMM":return j(V,L);case"D":return O.$D;case"DD":return E.s(O.$D,2,"0");case"d":return String(O.$W);case"dd":return j(k.weekdaysMin,O.$W,B,2);case"ddd":return j(k.weekdaysShort,O.$W,B,3);case"dddd":return B[O.$W];case"H":return String($);case"HH":return E.s($,2,"0");case"h":return z(1);case"hh":return z(2);case"a":return W($,_,!0);case"A":return W($,_,!1);case"m":return String(_);case"mm":return E.s(_,2,"0");case"s":return String(O.$s);case"ss":return E.s(O.$s,2,"0");case"SSS":return E.s(O.$ms,3,"0");case"Z":return F}return null}(q)||F.replace(":","")})},M.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},M.diff=function(C,O,k){var x,F=this,$=E.p(O),_=P(C),L=(_.utcOffset()-this.utcOffset())*r,B=this-_,V=function(){return E.m(F,_)};switch($){case m:x=V()/12;break;case d:x=V();break;case p:x=V()/3;break;case c:x=(B-L)/6048e5;break;case u:x=(B-L)/864e5;break;case l:x=B/n;break;case s:x=B/r;break;case o:x=B/i;break;default:x=B}return k?x:E.a(x)},M.daysInMonth=function(){return this.endOf(d).$D},M.$locale=function(){return w[this.$L]},M.locale=function(C,O){if(!C)return this.$L;var k=this.clone(),x=D(C,O,!0);return x&&(k.$L=x),k},M.clone=function(){return E.w(this.$d,this)},M.toDate=function(){return new Date(this.valueOf())},M.toJSON=function(){return this.isValid()?this.toISOString():null},M.toISOString=function(){return this.$d.toISOString()},M.toString=function(){return this.$d.toUTCString()},A}(),N=R.prototype;return P.prototype=N,[["$ms",a],["$s",o],["$m",s],["$H",l],["$W",u],["$M",d],["$y",m],["$D",h]].forEach(function(A){N[A[1]]=function(M){return this.$g(M,A[0],A[1])}}),P.extend=function(A,M){return A.$i||(A(M,R,P),A.$i=!0),P},P.locale=D,P.isDayjs=T,P.unix=function(A){return P(1e3*A)},P.en=w[S],P.Ls=w,P.p={},P})})(L7);var PIe=L7.exports;const RIe=DIe(PIe);function EIe(t){const{dateMatchUps:e=[],completedMatchUps:i=[],groupInfo:r,mappedParticipants:n}=(t==null?void 0:t.data)??{},a=e.concat(...i),o=a.reduce((S,w)=>{var T;const U=(T=w==null?void 0:w.schedule)==null?void 0:T.scheduledDate;return U&&!S.includes(U)&&S.push(U),S},[]),s=o[0];let l;const u=S=>{var w;for(const U of S.sides||[])U.participantId&&(U.participant=n[U.participantId],(w=U.participant)!=null&&w.individualParticipantIds&&(U.participant.individualParticipants=U.participant.individualParticipantIds.map(T=>n[T])))},c=({scheduledDate:S})=>{var P;const w=(P=t==null?void 0:t.data)==null?void 0:P.courtsData.map(E=>{const{matchUps:R,...N}=E;return R.forEach(u),{...N,matchUps:R.filter(A=>{var M;return((M=A.schedule)==null?void 0:M.scheduledDate)===S})}}),U="C|",T=fx.courtGridRows({courtsData:w,courtPrefix:U,minRowsCount:10}).rows,D=SIe({courtsData:w,courtPrefix:U});return T==null||T.forEach((E,R)=>{E.rowId=`rowId-${R+1}`,E.rowNumber=R+1}),{rows:T,columns:D,courtsCount:(w==null?void 0:w.length)??0,courtsData:w,groupInfo:r}},d=({scheduledDate:S})=>{const{rows:w}=c({scheduledDate:S});l==null||l.replaceData(w),l.matchUps=a},p=S=>RIe(S).format("dddd MMM D"),m=o.map(S=>({onClick:()=>d({scheduledDate:S}),label:p(S),value:S,close:!0})),h={label:p(s),options:m,id:"dateSelector",modifyLabel:!0,selection:!0},f=document.getElementById("scheduleHeader");nge(f);const g=rm({button:h});f.appendChild(g),XD({anchorId:"tournamentSchedule"});const v=document.getElementById("tournamentSchedule"),{rows:y=[],columns:I=[],courtsCount:b}=c({scheduledDate:s});return l=new Vb(v,{height:window.innerHeight*.84,renderHorizontal:"virtual",placeholder:"No courts",index:"rowId",data:y,columns:I}),{table:l,courtsCount:b}}function CIe(){return"tmxToken"}function _7(t,e){return function(){return t.apply(e,arguments)}}const{toString:MIe}=Object.prototype,{getPrototypeOf:Mx}=Object,JD=(t=>e=>{const i=MIe.call(e);return t[i]||(t[i]=i.slice(8,-1).toLowerCase())})(Object.create(null)),iu=t=>(t=t.toLowerCase(),e=>JD(e)===t),QD=t=>e=>typeof e===t,{isArray:tv}=Array,zI=QD("undefined");function NIe(t){return t!==null&&!zI(t)&&t.constructor!==null&&!zI(t.constructor)&&qs(t.constructor.isBuffer)&&t.constructor.isBuffer(t)}const $7=iu("ArrayBuffer");function AIe(t){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(t):e=t&&t.buffer&&$7(t.buffer),e}const OIe=QD("string"),qs=QD("function"),B7=QD("number"),ZD=t=>t!==null&&typeof t=="object",kIe=t=>t===!0||t===!1,VU=t=>{if(JD(t)!=="object")return!1;const e=Mx(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)},xIe=iu("Date"),FIe=iu("File"),LIe=iu("Blob"),_Ie=iu("FileList"),$Ie=t=>ZD(t)&&qs(t.pipe),BIe=t=>{let e;return t&&(typeof FormData=="function"&&t instanceof FormData||qs(t.append)&&((e=JD(t))==="formdata"||e==="object"&&qs(t.toString)&&t.toString()==="[object FormData]"))},VIe=iu("URLSearchParams"),[jIe,GIe,HIe,zIe]=["ReadableStream","Request","Response","Headers"].map(iu),WIe=t=>t.trim?t.trim():t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function jb(t,e,{allOwnKeys:i=!1}={}){if(t===null||typeof t>"u")return;let r,n;if(typeof t!="object"&&(t=[t]),tv(t))for(r=0,n=t.length;r<n;r++)e.call(null,t[r],r,t);else{const a=i?Object.getOwnPropertyNames(t):Object.keys(t),o=a.length;let s;for(r=0;r<o;r++)s=a[r],e.call(null,t[s],s,t)}}function V7(t,e){e=e.toLowerCase();const i=Object.keys(t);let r=i.length,n;for(;r-- >0;)if(n=i[r],e===n.toLowerCase())return n;return null}const j7=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,G7=t=>!zI(t)&&t!==j7;function j1(){const{caseless:t}=G7(this)&&this||{},e={},i=(r,n)=>{const a=t&&V7(e,n)||n;VU(e[a])&&VU(r)?e[a]=j1(e[a],r):VU(r)?e[a]=j1({},r):tv(r)?e[a]=r.slice():e[a]=r};for(let r=0,n=arguments.length;r<n;r++)arguments[r]&&jb(arguments[r],i);return e}const qIe=(t,e,i,{allOwnKeys:r}={})=>(jb(e,(n,a)=>{i&&qs(n)?t[a]=_7(n,i):t[a]=n},{allOwnKeys:r}),t),YIe=t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),KIe=(t,e,i,r)=>{t.prototype=Object.create(e.prototype,r),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:e.prototype}),i&&Object.assign(t.prototype,i)},XIe=(t,e,i,r)=>{let n,a,o;const s={};if(e=e||{},t==null)return e;do{for(n=Object.getOwnPropertyNames(t),a=n.length;a-- >0;)o=n[a],(!r||r(o,t,e))&&!s[o]&&(e[o]=t[o],s[o]=!0);t=i!==!1&&Mx(t)}while(t&&(!i||i(t,e))&&t!==Object.prototype);return e},JIe=(t,e,i)=>{t=String(t),(i===void 0||i>t.length)&&(i=t.length),i-=e.length;const r=t.indexOf(e,i);return r!==-1&&r===i},QIe=t=>{if(!t)return null;if(tv(t))return t;let e=t.length;if(!B7(e))return null;const i=new Array(e);for(;e-- >0;)i[e]=t[e];return i},ZIe=(t=>e=>t&&e instanceof t)(typeof Uint8Array<"u"&&Mx(Uint8Array)),eye=(t,e)=>{const r=(t&&t[Symbol.iterator]).call(t);let n;for(;(n=r.next())&&!n.done;){const a=n.value;e.call(t,a[0],a[1])}},tye=(t,e)=>{let i;const r=[];for(;(i=t.exec(e))!==null;)r.push(i);return r},iye=iu("HTMLFormElement"),rye=t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(i,r,n){return r.toUpperCase()+n}),BV=(({hasOwnProperty:t})=>(e,i)=>t.call(e,i))(Object.prototype),nye=iu("RegExp"),H7=(t,e)=>{const i=Object.getOwnPropertyDescriptors(t),r={};jb(i,(n,a)=>{let o;(o=e(n,a,t))!==!1&&(r[a]=o||n)}),Object.defineProperties(t,r)},aye=t=>{H7(t,(e,i)=>{if(qs(t)&&["arguments","caller","callee"].indexOf(i)!==-1)return!1;const r=t[i];if(qs(r)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+i+"'")})}})},oye=(t,e)=>{const i={},r=n=>{n.forEach(a=>{i[a]=!0})};return tv(t)?r(t):r(String(t).split(e)),i},sye=()=>{},lye=(t,e)=>t!=null&&Number.isFinite(t=+t)?t:e,ME="abcdefghijklmnopqrstuvwxyz",VV="0123456789",z7={DIGIT:VV,ALPHA:ME,ALPHA_DIGIT:ME+ME.toUpperCase()+VV},uye=(t=16,e=z7.ALPHA_DIGIT)=>{let i="";const{length:r}=e;for(;t--;)i+=e[Math.random()*r|0];return i};function cye(t){return!!(t&&qs(t.append)&&t[Symbol.toStringTag]==="FormData"&&t[Symbol.iterator])}const dye=t=>{const e=new Array(10),i=(r,n)=>{if(ZD(r)){if(e.indexOf(r)>=0)return;if(!("toJSON"in r)){e[n]=r;const a=tv(r)?[]:{};return jb(r,(o,s)=>{const l=i(o,n+1);!zI(l)&&(a[s]=l)}),e[n]=void 0,a}}return r};return i(t,0)},pye=iu("AsyncFunction"),mye=t=>t&&(ZD(t)||qs(t))&&qs(t.then)&&qs(t.catch),Ie={isArray:tv,isArrayBuffer:$7,isBuffer:NIe,isFormData:BIe,isArrayBufferView:AIe,isString:OIe,isNumber:B7,isBoolean:kIe,isObject:ZD,isPlainObject:VU,isReadableStream:jIe,isRequest:GIe,isResponse:HIe,isHeaders:zIe,isUndefined:zI,isDate:xIe,isFile:FIe,isBlob:LIe,isRegExp:nye,isFunction:qs,isStream:$Ie,isURLSearchParams:VIe,isTypedArray:ZIe,isFileList:_Ie,forEach:jb,merge:j1,extend:qIe,trim:WIe,stripBOM:YIe,inherits:KIe,toFlatObject:XIe,kindOf:JD,kindOfTest:iu,endsWith:JIe,toArray:QIe,forEachEntry:eye,matchAll:tye,isHTMLForm:iye,hasOwnProperty:BV,hasOwnProp:BV,reduceDescriptors:H7,freezeMethods:aye,toObjectSet:oye,toCamelCase:rye,noop:sye,toFiniteNumber:lye,findKey:V7,global:j7,isContextDefined:G7,ALPHABET:z7,generateString:uye,isSpecCompliantForm:cye,toJSONObject:dye,isAsyncFn:pye,isThenable:mye};function ri(t,e,i,r,n){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=t,this.name="AxiosError",e&&(this.code=e),i&&(this.config=i),r&&(this.request=r),n&&(this.response=n)}Ie.inherits(ri,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Ie.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const W7=ri.prototype,q7={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(t=>{q7[t]={value:t}});Object.defineProperties(ri,q7);Object.defineProperty(W7,"isAxiosError",{value:!0});ri.from=(t,e,i,r,n,a)=>{const o=Object.create(W7);return Ie.toFlatObject(t,o,function(l){return l!==Error.prototype},s=>s!=="isAxiosError"),ri.call(o,t.message,e,i,r,n),o.cause=t,o.name=t.name,a&&Object.assign(o,a),o};const hye=null;function G1(t){return Ie.isPlainObject(t)||Ie.isArray(t)}function Y7(t){return Ie.endsWith(t,"[]")?t.slice(0,-2):t}function jV(t,e,i){return t?t.concat(e).map(function(n,a){return n=Y7(n),!i&&a?"["+n+"]":n}).join(i?".":""):e}function fye(t){return Ie.isArray(t)&&!t.some(G1)}const gye=Ie.toFlatObject(Ie,{},null,function(e){return/^is[A-Z]/.test(e)});function eP(t,e,i){if(!Ie.isObject(t))throw new TypeError("target must be an object");e=e||new FormData,i=Ie.toFlatObject(i,{metaTokens:!0,dots:!1,indexes:!1},!1,function(f,g){return!Ie.isUndefined(g[f])});const r=i.metaTokens,n=i.visitor||c,a=i.dots,o=i.indexes,l=(i.Blob||typeof Blob<"u"&&Blob)&&Ie.isSpecCompliantForm(e);if(!Ie.isFunction(n))throw new TypeError("visitor must be a function");function u(h){if(h===null)return"";if(Ie.isDate(h))return h.toISOString();if(!l&&Ie.isBlob(h))throw new ri("Blob is not supported. Use a Buffer instead.");return Ie.isArrayBuffer(h)||Ie.isTypedArray(h)?l&&typeof Blob=="function"?new Blob([h]):Buffer.from(h):h}function c(h,f,g){let v=h;if(h&&!g&&typeof h=="object"){if(Ie.endsWith(f,"{}"))f=r?f:f.slice(0,-2),h=JSON.stringify(h);else if(Ie.isArray(h)&&fye(h)||(Ie.isFileList(h)||Ie.endsWith(f,"[]"))&&(v=Ie.toArray(h)))return f=Y7(f),v.forEach(function(I,b){!(Ie.isUndefined(I)||I===null)&&e.append(o===!0?jV([f],b,a):o===null?f:f+"[]",u(I))}),!1}return G1(h)?!0:(e.append(jV(g,f,a),u(h)),!1)}const d=[],p=Object.assign(gye,{defaultVisitor:c,convertValue:u,isVisitable:G1});function m(h,f){if(!Ie.isUndefined(h)){if(d.indexOf(h)!==-1)throw Error("Circular reference detected in "+f.join("."));d.push(h),Ie.forEach(h,function(v,y){(!(Ie.isUndefined(v)||v===null)&&n.call(e,v,Ie.isString(y)?y.trim():y,f,p))===!0&&m(v,f?f.concat(y):[y])}),d.pop()}}if(!Ie.isObject(t))throw new TypeError("data must be an object");return m(t),e}function GV(t){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(r){return e[r]})}function Nx(t,e){this._pairs=[],t&&eP(t,this,e)}const K7=Nx.prototype;K7.append=function(e,i){this._pairs.push([e,i])};K7.toString=function(e){const i=e?function(r){return e.call(this,r,GV)}:GV;return this._pairs.map(function(n){return i(n[0])+"="+i(n[1])},"").join("&")};function vye(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function X7(t,e,i){if(!e)return t;const r=i&&i.encode||vye,n=i&&i.serialize;let a;if(n?a=n(e,i):a=Ie.isURLSearchParams(e)?e.toString():new Nx(e,i).toString(r),a){const o=t.indexOf("#");o!==-1&&(t=t.slice(0,o)),t+=(t.indexOf("?")===-1?"?":"&")+a}return t}class HV{constructor(){this.handlers=[]}use(e,i,r){return this.handlers.push({fulfilled:e,rejected:i,synchronous:r?r.synchronous:!1,runWhen:r?r.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){Ie.forEach(this.handlers,function(r){r!==null&&e(r)})}}const J7={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Iye=typeof URLSearchParams<"u"?URLSearchParams:Nx,yye=typeof FormData<"u"?FormData:null,bye=typeof Blob<"u"?Blob:null,wye={isBrowser:!0,classes:{URLSearchParams:Iye,FormData:yye,Blob:bye},protocols:["http","https","file","blob","url","data"]},Ax=typeof window<"u"&&typeof document<"u",Uye=(t=>Ax&&["ReactNative","NativeScript","NS"].indexOf(t)<0)(typeof navigator<"u"&&navigator.product),Sye=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",Tye=Ax&&window.location.href||"http://localhost",Dye=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:Ax,hasStandardBrowserEnv:Uye,hasStandardBrowserWebWorkerEnv:Sye,origin:Tye},Symbol.toStringTag,{value:"Module"})),Al={...Dye,...wye};function Pye(t,e){return eP(t,new Al.classes.URLSearchParams,Object.assign({visitor:function(i,r,n,a){return Al.isNode&&Ie.isBuffer(i)?(this.append(r,i.toString("base64")),!1):a.defaultVisitor.apply(this,arguments)}},e))}function Rye(t){return Ie.matchAll(/\w+|\[(\w*)]/g,t).map(e=>e[0]==="[]"?"":e[1]||e[0])}function Eye(t){const e={},i=Object.keys(t);let r;const n=i.length;let a;for(r=0;r<n;r++)a=i[r],e[a]=t[a];return e}function Q7(t){function e(i,r,n,a){let o=i[a++];if(o==="__proto__")return!0;const s=Number.isFinite(+o),l=a>=i.length;return o=!o&&Ie.isArray(n)?n.length:o,l?(Ie.hasOwnProp(n,o)?n[o]=[n[o],r]:n[o]=r,!s):((!n[o]||!Ie.isObject(n[o]))&&(n[o]=[]),e(i,r,n[o],a)&&Ie.isArray(n[o])&&(n[o]=Eye(n[o])),!s)}if(Ie.isFormData(t)&&Ie.isFunction(t.entries)){const i={};return Ie.forEachEntry(t,(r,n)=>{e(Rye(r),n,i,0)}),i}return null}function Cye(t,e,i){if(Ie.isString(t))try{return(e||JSON.parse)(t),Ie.trim(t)}catch(r){if(r.name!=="SyntaxError")throw r}return(i||JSON.stringify)(t)}const Ox={transitional:J7,adapter:["xhr","http","fetch"],transformRequest:[function(e,i){const r=i.getContentType()||"",n=r.indexOf("application/json")>-1,a=Ie.isObject(e);if(a&&Ie.isHTMLForm(e)&&(e=new FormData(e)),Ie.isFormData(e))return n?JSON.stringify(Q7(e)):e;if(Ie.isArrayBuffer(e)||Ie.isBuffer(e)||Ie.isStream(e)||Ie.isFile(e)||Ie.isBlob(e)||Ie.isReadableStream(e))return e;if(Ie.isArrayBufferView(e))return e.buffer;if(Ie.isURLSearchParams(e))return i.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let s;if(a){if(r.indexOf("application/x-www-form-urlencoded")>-1)return Pye(e,this.formSerializer).toString();if((s=Ie.isFileList(e))||r.indexOf("multipart/form-data")>-1){const l=this.env&&this.env.FormData;return eP(s?{"files[]":e}:e,l&&new l,this.formSerializer)}}return a||n?(i.setContentType("application/json",!1),Cye(e)):e}],transformResponse:[function(e){const i=this.transitional||Ox.transitional,r=i&&i.forcedJSONParsing,n=this.responseType==="json";if(Ie.isResponse(e)||Ie.isReadableStream(e))return e;if(e&&Ie.isString(e)&&(r&&!this.responseType||n)){const o=!(i&&i.silentJSONParsing)&&n;try{return JSON.parse(e)}catch(s){if(o)throw s.name==="SyntaxError"?ri.from(s,ri.ERR_BAD_RESPONSE,this,null,this.response):s}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Al.classes.FormData,Blob:Al.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Ie.forEach(["delete","get","head","post","put","patch"],t=>{Ox.headers[t]={}});const kx=Ox,Mye=Ie.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Nye=t=>{const e={};let i,r,n;return t&&t.split(`
`).forEach(function(o){n=o.indexOf(":"),i=o.substring(0,n).trim().toLowerCase(),r=o.substring(n+1).trim(),!(!i||e[i]&&Mye[i])&&(i==="set-cookie"?e[i]?e[i].push(r):e[i]=[r]:e[i]=e[i]?e[i]+", "+r:r)}),e},zV=Symbol("internals");function _v(t){return t&&String(t).trim().toLowerCase()}function jU(t){return t===!1||t==null?t:Ie.isArray(t)?t.map(jU):String(t)}function Aye(t){const e=Object.create(null),i=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let r;for(;r=i.exec(t);)e[r[1]]=r[2];return e}const Oye=t=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(t.trim());function NE(t,e,i,r,n){if(Ie.isFunction(r))return r.call(this,e,i);if(n&&(e=i),!!Ie.isString(e)){if(Ie.isString(r))return e.indexOf(r)!==-1;if(Ie.isRegExp(r))return r.test(e)}}function kye(t){return t.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,i,r)=>i.toUpperCase()+r)}function xye(t,e){const i=Ie.toCamelCase(" "+e);["get","set","has"].forEach(r=>{Object.defineProperty(t,r+i,{value:function(n,a,o){return this[r].call(this,e,n,a,o)},configurable:!0})})}class tP{constructor(e){e&&this.set(e)}set(e,i,r){const n=this;function a(s,l,u){const c=_v(l);if(!c)throw new Error("header name must be a non-empty string");const d=Ie.findKey(n,c);(!d||n[d]===void 0||u===!0||u===void 0&&n[d]!==!1)&&(n[d||l]=jU(s))}const o=(s,l)=>Ie.forEach(s,(u,c)=>a(u,c,l));if(Ie.isPlainObject(e)||e instanceof this.constructor)o(e,i);else if(Ie.isString(e)&&(e=e.trim())&&!Oye(e))o(Nye(e),i);else if(Ie.isHeaders(e))for(const[s,l]of e.entries())a(l,s,r);else e!=null&&a(i,e,r);return this}get(e,i){if(e=_v(e),e){const r=Ie.findKey(this,e);if(r){const n=this[r];if(!i)return n;if(i===!0)return Aye(n);if(Ie.isFunction(i))return i.call(this,n,r);if(Ie.isRegExp(i))return i.exec(n);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,i){if(e=_v(e),e){const r=Ie.findKey(this,e);return!!(r&&this[r]!==void 0&&(!i||NE(this,this[r],r,i)))}return!1}delete(e,i){const r=this;let n=!1;function a(o){if(o=_v(o),o){const s=Ie.findKey(r,o);s&&(!i||NE(r,r[s],s,i))&&(delete r[s],n=!0)}}return Ie.isArray(e)?e.forEach(a):a(e),n}clear(e){const i=Object.keys(this);let r=i.length,n=!1;for(;r--;){const a=i[r];(!e||NE(this,this[a],a,e,!0))&&(delete this[a],n=!0)}return n}normalize(e){const i=this,r={};return Ie.forEach(this,(n,a)=>{const o=Ie.findKey(r,a);if(o){i[o]=jU(n),delete i[a];return}const s=e?kye(a):String(a).trim();s!==a&&delete i[a],i[s]=jU(n),r[s]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const i=Object.create(null);return Ie.forEach(this,(r,n)=>{r!=null&&r!==!1&&(i[n]=e&&Ie.isArray(r)?r.join(", "):r)}),i}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,i])=>e+": "+i).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...i){const r=new this(e);return i.forEach(n=>r.set(n)),r}static accessor(e){const r=(this[zV]=this[zV]={accessors:{}}).accessors,n=this.prototype;function a(o){const s=_v(o);r[s]||(xye(n,o),r[s]=!0)}return Ie.isArray(e)?e.forEach(a):a(e),this}}tP.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);Ie.reduceDescriptors(tP.prototype,({value:t},e)=>{let i=e[0].toUpperCase()+e.slice(1);return{get:()=>t,set(r){this[i]=r}}});Ie.freezeMethods(tP);const Ol=tP;function AE(t,e){const i=this||kx,r=e||i,n=Ol.from(r.headers);let a=r.data;return Ie.forEach(t,function(s){a=s.call(i,a,n.normalize(),e?e.status:void 0)}),n.normalize(),a}function Z7(t){return!!(t&&t.__CANCEL__)}function iv(t,e,i){ri.call(this,t??"canceled",ri.ERR_CANCELED,e,i),this.name="CanceledError"}Ie.inherits(iv,ri,{__CANCEL__:!0});function eK(t,e,i){const r=i.config.validateStatus;!i.status||!r||r(i.status)?t(i):e(new ri("Request failed with status code "+i.status,[ri.ERR_BAD_REQUEST,ri.ERR_BAD_RESPONSE][Math.floor(i.status/100)-4],i.config,i.request,i))}function Fye(t){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(t);return e&&e[1]||""}function Lye(t,e){t=t||10;const i=new Array(t),r=new Array(t);let n=0,a=0,o;return e=e!==void 0?e:1e3,function(l){const u=Date.now(),c=r[a];o||(o=u),i[n]=l,r[n]=u;let d=a,p=0;for(;d!==n;)p+=i[d++],d=d%t;if(n=(n+1)%t,n===a&&(a=(a+1)%t),u-o<e)return;const m=c&&u-c;return m?Math.round(p*1e3/m):void 0}}function _ye(t,e){let i=0;const r=1e3/e;let n=null;return function(){const o=this===!0,s=Date.now();if(o||s-i>r)return n&&(clearTimeout(n),n=null),i=s,t.apply(null,arguments);n||(n=setTimeout(()=>(n=null,i=Date.now(),t.apply(null,arguments)),r-(s-i)))}}const qS=(t,e,i=3)=>{let r=0;const n=Lye(50,250);return _ye(a=>{const o=a.loaded,s=a.lengthComputable?a.total:void 0,l=o-r,u=n(l),c=o<=s;r=o;const d={loaded:o,total:s,progress:s?o/s:void 0,bytes:l,rate:u||void 0,estimated:u&&s&&c?(s-o)/u:void 0,event:a,lengthComputable:s!=null};d[e?"download":"upload"]=!0,t(d)},i)},$ye=Al.hasStandardBrowserEnv?function(){const e=/(msie|trident)/i.test(navigator.userAgent),i=document.createElement("a");let r;function n(a){let o=a;return e&&(i.setAttribute("href",o),o=i.href),i.setAttribute("href",o),{href:i.href,protocol:i.protocol?i.protocol.replace(/:$/,""):"",host:i.host,search:i.search?i.search.replace(/^\?/,""):"",hash:i.hash?i.hash.replace(/^#/,""):"",hostname:i.hostname,port:i.port,pathname:i.pathname.charAt(0)==="/"?i.pathname:"/"+i.pathname}}return r=n(window.location.href),function(o){const s=Ie.isString(o)?n(o):o;return s.protocol===r.protocol&&s.host===r.host}}():function(){return function(){return!0}}(),Bye=Al.hasStandardBrowserEnv?{write(t,e,i,r,n,a){const o=[t+"="+encodeURIComponent(e)];Ie.isNumber(i)&&o.push("expires="+new Date(i).toGMTString()),Ie.isString(r)&&o.push("path="+r),Ie.isString(n)&&o.push("domain="+n),a===!0&&o.push("secure"),document.cookie=o.join("; ")},read(t){const e=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(t){this.write(t,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function Vye(t){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)}function jye(t,e){return e?t.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):t}function tK(t,e){return t&&!Vye(e)?jye(t,e):e}const WV=t=>t instanceof Ol?{...t}:t;function Em(t,e){e=e||{};const i={};function r(u,c,d){return Ie.isPlainObject(u)&&Ie.isPlainObject(c)?Ie.merge.call({caseless:d},u,c):Ie.isPlainObject(c)?Ie.merge({},c):Ie.isArray(c)?c.slice():c}function n(u,c,d){if(Ie.isUndefined(c)){if(!Ie.isUndefined(u))return r(void 0,u,d)}else return r(u,c,d)}function a(u,c){if(!Ie.isUndefined(c))return r(void 0,c)}function o(u,c){if(Ie.isUndefined(c)){if(!Ie.isUndefined(u))return r(void 0,u)}else return r(void 0,c)}function s(u,c,d){if(d in e)return r(u,c);if(d in t)return r(void 0,u)}const l={url:a,method:a,data:a,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,withXSRFToken:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:s,headers:(u,c)=>n(WV(u),WV(c),!0)};return Ie.forEach(Object.keys(Object.assign({},t,e)),function(c){const d=l[c]||n,p=d(t[c],e[c],c);Ie.isUndefined(p)&&d!==s||(i[c]=p)}),i}const iK=t=>{const e=Em({},t);let{data:i,withXSRFToken:r,xsrfHeaderName:n,xsrfCookieName:a,headers:o,auth:s}=e;e.headers=o=Ol.from(o),e.url=X7(tK(e.baseURL,e.url),t.params,t.paramsSerializer),s&&o.set("Authorization","Basic "+btoa((s.username||"")+":"+(s.password?unescape(encodeURIComponent(s.password)):"")));let l;if(Ie.isFormData(i)){if(Al.hasStandardBrowserEnv||Al.hasStandardBrowserWebWorkerEnv)o.setContentType(void 0);else if((l=o.getContentType())!==!1){const[u,...c]=l?l.split(";").map(d=>d.trim()).filter(Boolean):[];o.setContentType([u||"multipart/form-data",...c].join("; "))}}if(Al.hasStandardBrowserEnv&&(r&&Ie.isFunction(r)&&(r=r(e)),r||r!==!1&&$ye(e.url))){const u=n&&a&&Bye.read(a);u&&o.set(n,u)}return e},Gye=typeof XMLHttpRequest<"u",Hye=Gye&&function(t){return new Promise(function(i,r){const n=iK(t);let a=n.data;const o=Ol.from(n.headers).normalize();let{responseType:s}=n,l;function u(){n.cancelToken&&n.cancelToken.unsubscribe(l),n.signal&&n.signal.removeEventListener("abort",l)}let c=new XMLHttpRequest;c.open(n.method.toUpperCase(),n.url,!0),c.timeout=n.timeout;function d(){if(!c)return;const m=Ol.from("getAllResponseHeaders"in c&&c.getAllResponseHeaders()),f={data:!s||s==="text"||s==="json"?c.responseText:c.response,status:c.status,statusText:c.statusText,headers:m,config:t,request:c};eK(function(v){i(v),u()},function(v){r(v),u()},f),c=null}"onloadend"in c?c.onloadend=d:c.onreadystatechange=function(){!c||c.readyState!==4||c.status===0&&!(c.responseURL&&c.responseURL.indexOf("file:")===0)||setTimeout(d)},c.onabort=function(){c&&(r(new ri("Request aborted",ri.ECONNABORTED,n,c)),c=null)},c.onerror=function(){r(new ri("Network Error",ri.ERR_NETWORK,n,c)),c=null},c.ontimeout=function(){let h=n.timeout?"timeout of "+n.timeout+"ms exceeded":"timeout exceeded";const f=n.transitional||J7;n.timeoutErrorMessage&&(h=n.timeoutErrorMessage),r(new ri(h,f.clarifyTimeoutError?ri.ETIMEDOUT:ri.ECONNABORTED,n,c)),c=null},a===void 0&&o.setContentType(null),"setRequestHeader"in c&&Ie.forEach(o.toJSON(),function(h,f){c.setRequestHeader(f,h)}),Ie.isUndefined(n.withCredentials)||(c.withCredentials=!!n.withCredentials),s&&s!=="json"&&(c.responseType=n.responseType),typeof n.onDownloadProgress=="function"&&c.addEventListener("progress",qS(n.onDownloadProgress,!0)),typeof n.onUploadProgress=="function"&&c.upload&&c.upload.addEventListener("progress",qS(n.onUploadProgress)),(n.cancelToken||n.signal)&&(l=m=>{c&&(r(!m||m.type?new iv(null,t,c):m),c.abort(),c=null)},n.cancelToken&&n.cancelToken.subscribe(l),n.signal&&(n.signal.aborted?l():n.signal.addEventListener("abort",l)));const p=Fye(n.url);if(p&&Al.protocols.indexOf(p)===-1){r(new ri("Unsupported protocol "+p+":",ri.ERR_BAD_REQUEST,t));return}c.send(a||null)})},zye=(t,e)=>{let i=new AbortController,r;const n=function(l){if(!r){r=!0,o();const u=l instanceof Error?l:this.reason;i.abort(u instanceof ri?u:new iv(u instanceof Error?u.message:u))}};let a=e&&setTimeout(()=>{n(new ri(`timeout ${e} of ms exceeded`,ri.ETIMEDOUT))},e);const o=()=>{t&&(a&&clearTimeout(a),a=null,t.forEach(l=>{l&&(l.removeEventListener?l.removeEventListener("abort",n):l.unsubscribe(n))}),t=null)};t.forEach(l=>l&&l.addEventListener&&l.addEventListener("abort",n));const{signal:s}=i;return s.unsubscribe=o,[s,()=>{a&&clearTimeout(a),a=null}]},Wye=function*(t,e){let i=t.byteLength;if(!e||i<e){yield t;return}let r=0,n;for(;r<i;)n=r+e,yield t.slice(r,n),r=n},qye=async function*(t,e,i){for await(const r of t)yield*Wye(ArrayBuffer.isView(r)?r:await i(String(r)),e)},qV=(t,e,i,r,n)=>{const a=qye(t,e,n);let o=0;return new ReadableStream({type:"bytes",async pull(s){const{done:l,value:u}=await a.next();if(l){s.close(),r();return}let c=u.byteLength;i&&i(o+=c),s.enqueue(new Uint8Array(u))},cancel(s){return r(s),a.return()}},{highWaterMark:2})},YV=(t,e)=>{const i=t!=null;return r=>setTimeout(()=>e({lengthComputable:i,total:t,loaded:r}))},iP=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",rK=iP&&typeof ReadableStream=="function",H1=iP&&(typeof TextEncoder=="function"?(t=>e=>t.encode(e))(new TextEncoder):async t=>new Uint8Array(await new Response(t).arrayBuffer())),Yye=rK&&(()=>{let t=!1;const e=new Request(Al.origin,{body:new ReadableStream,method:"POST",get duplex(){return t=!0,"half"}}).headers.has("Content-Type");return t&&!e})(),KV=64*1024,z1=rK&&!!(()=>{try{return Ie.isReadableStream(new Response("").body)}catch{}})(),YS={stream:z1&&(t=>t.body)};iP&&(t=>{["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!YS[e]&&(YS[e]=Ie.isFunction(t[e])?i=>i[e]():(i,r)=>{throw new ri(`Response type '${e}' is not supported`,ri.ERR_NOT_SUPPORT,r)})})})(new Response);const Kye=async t=>{if(t==null)return 0;if(Ie.isBlob(t))return t.size;if(Ie.isSpecCompliantForm(t))return(await new Request(t).arrayBuffer()).byteLength;if(Ie.isArrayBufferView(t))return t.byteLength;if(Ie.isURLSearchParams(t)&&(t=t+""),Ie.isString(t))return(await H1(t)).byteLength},Xye=async(t,e)=>{const i=Ie.toFiniteNumber(t.getContentLength());return i??Kye(e)},Jye=iP&&(async t=>{let{url:e,method:i,data:r,signal:n,cancelToken:a,timeout:o,onDownloadProgress:s,onUploadProgress:l,responseType:u,headers:c,withCredentials:d="same-origin",fetchOptions:p}=iK(t);u=u?(u+"").toLowerCase():"text";let[m,h]=n||a||o?zye([n,a],o):[],f,g;const v=()=>{!f&&setTimeout(()=>{m&&m.unsubscribe()}),f=!0};let y;try{if(l&&Yye&&i!=="get"&&i!=="head"&&(y=await Xye(c,r))!==0){let w=new Request(e,{method:"POST",body:r,duplex:"half"}),U;Ie.isFormData(r)&&(U=w.headers.get("content-type"))&&c.setContentType(U),w.body&&(r=qV(w.body,KV,YV(y,qS(l)),null,H1))}Ie.isString(d)||(d=d?"cors":"omit"),g=new Request(e,{...p,signal:m,method:i.toUpperCase(),headers:c.normalize().toJSON(),body:r,duplex:"half",withCredentials:d});let I=await fetch(g);const b=z1&&(u==="stream"||u==="response");if(z1&&(s||b)){const w={};["status","statusText","headers"].forEach(T=>{w[T]=I[T]});const U=Ie.toFiniteNumber(I.headers.get("content-length"));I=new Response(qV(I.body,KV,s&&YV(U,qS(s,!0)),b&&v,H1),w)}u=u||"text";let S=await YS[Ie.findKey(YS,u)||"text"](I,t);return!b&&v(),h&&h(),await new Promise((w,U)=>{eK(w,U,{data:S,headers:Ol.from(I.headers),status:I.status,statusText:I.statusText,config:t,request:g})})}catch(I){throw v(),I&&I.name==="TypeError"&&/fetch/i.test(I.message)?Object.assign(new ri("Network Error",ri.ERR_NETWORK,t,g),{cause:I.cause||I}):ri.from(I,I&&I.code,t,g)}}),W1={http:hye,xhr:Hye,fetch:Jye};Ie.forEach(W1,(t,e)=>{if(t){try{Object.defineProperty(t,"name",{value:e})}catch{}Object.defineProperty(t,"adapterName",{value:e})}});const XV=t=>`- ${t}`,Qye=t=>Ie.isFunction(t)||t===null||t===!1,nK={getAdapter:t=>{t=Ie.isArray(t)?t:[t];const{length:e}=t;let i,r;const n={};for(let a=0;a<e;a++){i=t[a];let o;if(r=i,!Qye(i)&&(r=W1[(o=String(i)).toLowerCase()],r===void 0))throw new ri(`Unknown adapter '${o}'`);if(r)break;n[o||"#"+a]=r}if(!r){const a=Object.entries(n).map(([s,l])=>`adapter ${s} `+(l===!1?"is not supported by the environment":"is not available in the build"));let o=e?a.length>1?`since :
`+a.map(XV).join(`
`):" "+XV(a[0]):"as no adapter specified";throw new ri("There is no suitable adapter to dispatch the request "+o,"ERR_NOT_SUPPORT")}return r},adapters:W1};function OE(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new iv(null,t)}function JV(t){return OE(t),t.headers=Ol.from(t.headers),t.data=AE.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),nK.getAdapter(t.adapter||kx.adapter)(t).then(function(r){return OE(t),r.data=AE.call(t,t.transformResponse,r),r.headers=Ol.from(r.headers),r},function(r){return Z7(r)||(OE(t),r&&r.response&&(r.response.data=AE.call(t,t.transformResponse,r.response),r.response.headers=Ol.from(r.response.headers))),Promise.reject(r)})}const aK="1.7.2",xx={};["object","boolean","number","function","string","symbol"].forEach((t,e)=>{xx[t]=function(r){return typeof r===t||"a"+(e<1?"n ":" ")+t}});const QV={};xx.transitional=function(e,i,r){function n(a,o){return"[Axios v"+aK+"] Transitional option '"+a+"'"+o+(r?". "+r:"")}return(a,o,s)=>{if(e===!1)throw new ri(n(o," has been removed"+(i?" in "+i:"")),ri.ERR_DEPRECATED);return i&&!QV[o]&&(QV[o]=!0,console.warn(n(o," has been deprecated since v"+i+" and will be removed in the near future"))),e?e(a,o,s):!0}};function Zye(t,e,i){if(typeof t!="object")throw new ri("options must be an object",ri.ERR_BAD_OPTION_VALUE);const r=Object.keys(t);let n=r.length;for(;n-- >0;){const a=r[n],o=e[a];if(o){const s=t[a],l=s===void 0||o(s,a,t);if(l!==!0)throw new ri("option "+a+" must be "+l,ri.ERR_BAD_OPTION_VALUE);continue}if(i!==!0)throw new ri("Unknown option "+a,ri.ERR_BAD_OPTION)}}const q1={assertOptions:Zye,validators:xx},cd=q1.validators;class KS{constructor(e){this.defaults=e,this.interceptors={request:new HV,response:new HV}}async request(e,i){try{return await this._request(e,i)}catch(r){if(r instanceof Error){let n;Error.captureStackTrace?Error.captureStackTrace(n={}):n=new Error;const a=n.stack?n.stack.replace(/^.+\n/,""):"";try{r.stack?a&&!String(r.stack).endsWith(a.replace(/^.+\n.+\n/,""))&&(r.stack+=`
`+a):r.stack=a}catch{}}throw r}}_request(e,i){typeof e=="string"?(i=i||{},i.url=e):i=e||{},i=Em(this.defaults,i);const{transitional:r,paramsSerializer:n,headers:a}=i;r!==void 0&&q1.assertOptions(r,{silentJSONParsing:cd.transitional(cd.boolean),forcedJSONParsing:cd.transitional(cd.boolean),clarifyTimeoutError:cd.transitional(cd.boolean)},!1),n!=null&&(Ie.isFunction(n)?i.paramsSerializer={serialize:n}:q1.assertOptions(n,{encode:cd.function,serialize:cd.function},!0)),i.method=(i.method||this.defaults.method||"get").toLowerCase();let o=a&&Ie.merge(a.common,a[i.method]);a&&Ie.forEach(["delete","get","head","post","put","patch","common"],h=>{delete a[h]}),i.headers=Ol.concat(o,a);const s=[];let l=!0;this.interceptors.request.forEach(function(f){typeof f.runWhen=="function"&&f.runWhen(i)===!1||(l=l&&f.synchronous,s.unshift(f.fulfilled,f.rejected))});const u=[];this.interceptors.response.forEach(function(f){u.push(f.fulfilled,f.rejected)});let c,d=0,p;if(!l){const h=[JV.bind(this),void 0];for(h.unshift.apply(h,s),h.push.apply(h,u),p=h.length,c=Promise.resolve(i);d<p;)c=c.then(h[d++],h[d++]);return c}p=s.length;let m=i;for(d=0;d<p;){const h=s[d++],f=s[d++];try{m=h(m)}catch(g){f.call(this,g);break}}try{c=JV.call(this,m)}catch(h){return Promise.reject(h)}for(d=0,p=u.length;d<p;)c=c.then(u[d++],u[d++]);return c}getUri(e){e=Em(this.defaults,e);const i=tK(e.baseURL,e.url);return X7(i,e.params,e.paramsSerializer)}}Ie.forEach(["delete","get","head","options"],function(e){KS.prototype[e]=function(i,r){return this.request(Em(r||{},{method:e,url:i,data:(r||{}).data}))}});Ie.forEach(["post","put","patch"],function(e){function i(r){return function(a,o,s){return this.request(Em(s||{},{method:e,headers:r?{"Content-Type":"multipart/form-data"}:{},url:a,data:o}))}}KS.prototype[e]=i(),KS.prototype[e+"Form"]=i(!0)});const GU=KS;class Fx{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let i;this.promise=new Promise(function(a){i=a});const r=this;this.promise.then(n=>{if(!r._listeners)return;let a=r._listeners.length;for(;a-- >0;)r._listeners[a](n);r._listeners=null}),this.promise.then=n=>{let a;const o=new Promise(s=>{r.subscribe(s),a=s}).then(n);return o.cancel=function(){r.unsubscribe(a)},o},e(function(a,o,s){r.reason||(r.reason=new iv(a,o,s),i(r.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const i=this._listeners.indexOf(e);i!==-1&&this._listeners.splice(i,1)}static source(){let e;return{token:new Fx(function(n){e=n}),cancel:e}}}const ebe=Fx;function tbe(t){return function(i){return t.apply(null,i)}}function ibe(t){return Ie.isObject(t)&&t.isAxiosError===!0}const Y1={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Y1).forEach(([t,e])=>{Y1[e]=t});const rbe=Y1;function oK(t){const e=new GU(t),i=_7(GU.prototype.request,e);return Ie.extend(i,GU.prototype,e,{allOwnKeys:!0}),Ie.extend(i,e,null,{allOwnKeys:!0}),i.create=function(n){return oK(Em(t,n))},i}const Mn=oK(kx);Mn.Axios=GU;Mn.CanceledError=iv;Mn.CancelToken=ebe;Mn.isCancel=Z7;Mn.VERSION=aK;Mn.toFormData=eP;Mn.AxiosError=ri;Mn.Cancel=Mn.CanceledError;Mn.all=function(e){return Promise.all(e)};Mn.spread=tbe;Mn.isAxiosError=ibe;Mn.mergeConfig=Em;Mn.AxiosHeaders=Ol;Mn.formToJSON=t=>Q7(Ie.isHTMLForm(t)?new FormData(t):t);Mn.getAdapter=nK.getAdapter;Mn.HttpStatusCode=rbe;Mn.default=Mn;const sK=CIe();window.location.host.includes("localhost")||window.location.hostname;var aG;const nbe=((aG=window.dev)==null?void 0:aG.baseURL)||"http://localhost:3123",Gb=Mn.create({baseURL:nbe});Gb.interceptors.request.use(t=>{const e=localStorage.getItem(sK);return e&&(t.headers.Authorization=`Bearer ${e}`),t},t=>Promise.reject(t));Gb.interceptors.response.use(t=>t,t=>{var e;if(t.message==="Network Error"&&console.log("network error"),t.response){((e=t.response)==null?void 0:e.status)===401&&lK();const i=t.response.data.message||t.response.data.error||t.response.data;console.log({message:i})}});const abe=()=>{const t=localStorage.getItem(sK);Gb.defaults.headers.common.Authorization=`Bearer ${t}`},lK=()=>{Gb.defaults.headers.common.Authorization=void 0},rv={...Gb,addAuthorization:abe,removeAuthorization:lK},Lx="Missing tournamentId";async function uK(t){if(!(t!=null&&t.tournamentId))throw new Error(Lx);return await rv.post("/factory/tournamentinfo",t)}async function K1({providerAbbr:t}){if(!t)throw new Error("missing provicerAbbr");return await rv.post("/provider/calendar",{providerAbbr:t})}async function cK(t){if(!(t!=null&&t.tournamentId))throw new Error(Lx);if(!(t!=null&&t.eventId))throw new Error("missing eventId");return await rv.post("/factory/eventdata",t)}async function obe(t){if(!(t!=null&&t.tournamentId))throw new Error(Lx);return Object.assign(t,{courtCompletedMatchUps:!0,withCourtGridRows:!0,usePublishState:!0,minCourtGridRows:10,nextMatchUps:!0}),await rv.post("/factory/scheduledmatchUps",{params:t})}async function sbe(){return await rv.get("/factory/version")}function Zv(t){return`tournament_${t.toLowerCase()}`}function _x(t){return`tab_tournament_${t.toLowerCase()}`}const Cm={},X1=["Info","Events","Schedule","Matches","Players","Stats"];function J1(t){t==="Schedule"&&obe({tournamentId:Cm.tournamentId,hydrateParticipants:!1}).then(i=>{EIe({data:i==null?void 0:i.data})}),Cm.tab=t,X1.forEach(e=>{const i=document.getElementById(Zv(e));i.style.display=e===t?"block":"none"})}function kE(t){const e=document.getElementById(_x(t));e.style.display="block"}function xE(t){const e=document.getElementById(_x(t));e.style.display=Bs}const lbe=()=>{const t=document.createElement("div");t.className="container";const e=document.createElement("section");e.className="hero";const i=document.createElement("div");i.className="hero-body",i.id="tournament-hero";const r=document.createElement("div");r.className="columns";const n=document.createElement("div");n.className="column is-one-quarter has-text-centered",n.id=lG,r.appendChild(n);const a=document.createElement("div");a.className="column has-text-centered",a.id=oG,r.appendChild(a),i.appendChild(r),e.appendChild(i),t.appendChild(e);const o=document.createElement("div"),s=document.createElement("div");t.appendChild(o),t.appendChild(s),X1.forEach(u=>{const c=document.createElement("section");c.className="section is-fluid is-centered",c.style.display="none",c.style.width="100%",c.id=Zv(u),s.appendChild(c)}),o.className="tabs is-centered";const l=document.createElement("ul");return X1.forEach(u=>{const c=document.createElement("li");c.id=_x(u),c.style.display="none",c.className="menu";const d=document.createElement("a");d.textContent=u,d.onclick=()=>J1(u),c.appendChild(d),l.appendChild(c)}),o.appendChild(l),t};function ube(){const t=document.createElement("div");t.className="main noselect";const e=document.createElement("nav");e.className="navbar";const i=document.createElement("div");i.className="navbar-brand";const r=document.createElement("div");r.onclick=()=>window.history.back(),r.className="navbar-item",r.innerHTML="<<",r.id="back",i.appendChild(r),e.appendChild(i),t.appendChild(e);const n=document.createElement("div");n.style.display="none",n.id=Dy;const a=document.createElement("div");a.style.display="none",a.id=sN;const o=document.createElement("div");o.className="controlBar flexcol flexgrow flexcenter",o.id=sG,a.appendChild(o);const s=document.createElement("div");s.className="flexcol flexgrow flexcenter box",s.id=pC,a.appendChild(s);const l=document.createElement("div");return l.style.backgroundColor="white",l.style.display="none",l.id=_0,l.appendChild(lbe()),t.appendChild(a),t.appendChild(l),t.appendChild(n),t}function cbe(t){for(const e of Array.from(document.querySelectorAll(".tmx-tm")).filter(i=>i.innerHTML===t.innerHTML)){const i=e;i.style.fontWeight="bold",i.style.color="#ed0c76"}}function dbe(t){for(const e of Array.from(document.querySelectorAll(".tmx-tm")).filter(i=>i.innerHTML===t.innerHTML)){const i=e;i.style.fontWeight="",i.style.color=""}}const ZV=function(){let t,e={elapsed:1e5,held:void 0,touched:void 0,holdTime:800,holdAction:void 0,holdActions:{}};const i={};let r={};const n=(d,p)=>d.filter(m=>p.indexOf(m)!==-1).filter((m,h,f)=>f.indexOf(m)===h);e.reset=()=>(r={},e),e.register=(d,p,m,h)=>(typeof m=="function"&&(r[p]||(r[p]={},i[p]=[]),r[p][d]={fx:m,delay:h},i[p]=Object.keys(r[p])),e),e.deRegister=(d,p)=>(r[p]&&(delete r[p][d],i[p]=Object.keys(r[p])),e),e.call=(d,p,...m)=>{var h,f;return(f=(h=r==null?void 0:r[p])==null?void 0:h[d])==null?void 0:f.fx(...m)},e.trigger=(d,p,m,h)=>r[p][d].fx(m,h,p),e.list=()=>console.log(r);const a="ontouchstart"in document.documentElement?"touchstart":"click";document.addEventListener(a,d=>s({evt:d,evnt:"tap"})),document.addEventListener("change",d=>s({evt:d,evnt:"change"})),document.addEventListener("click",d=>s({evt:d,evnt:"click"})),document.addEventListener("mouseover",d=>s({evt:d,evnt:"mouseover",stopPropagation:!1})),document.addEventListener("mouseout",d=>s({evt:d,evnt:"mouseout",stopPropagation:!1})),document.addEventListener("keyup",d=>s({evt:d,evnt:"keyup",stopPropagation:!1}));let o=0;function s({evt:d,evnt:p,stopPropagation:m=!0}){m&&d.stopPropagation();const h={x:d.clientX,y:d.clientY,pageX:d.pageX,pageY:d.pageY};let f=Array.from(d.target.classList),g=f.length&&i[p]?n(f,i[p]):[];if(g.length){let v=new Date().getTime();e.elapsed=v-o,o=v,g.forEach(y=>{l({cls:y,evt:d,evnt:p,mouse:h})})}}function l({cls:d,evt:p,evnt:m,mouse:h}){let f=p.target;r[m][d].fx(f,h,m,p)}document.addEventListener("touchstart",d=>{e.touched=d.target,e.coords=[d.touches[0].clientX,d.touches[0].clientY],e.touched&&(t=setTimeout(function(){c()},e.holdTime))},!1),document.addEventListener("touchend",function(){u()},!1),document.addEventListener("touchmove",function(d){e.touched!==d.target&&u()},!1);function u(){clearTimeout(t)}function c(){typeof e.holdAction=="function"&&(e.held=e.touched,e.holdAction(e.held,e.coords))}return function(){let d=!1,p,m="";function h(){clearTimeout(p),d=!0,m!=="can-touch"&&(m="can-touch",document.documentElement.classList.add(m)),p=setTimeout(function(){d=!1},500)}function f(){!d&&m==="can-touch"&&(d=!1,m="",document.documentElement.classList.remove("can-touch"))}document.addEventListener("touchstart",h,!1),document.addEventListener("mouseover",f,!1)}(),e}();function HU(t){cne.forEach(e=>{const i=document.querySelector(`#${e}`);i&&(i.style.display=e===t?"block":"none")})}function pbe(){if(!window.dev)console.log("%c dev initialized","color: yellow"),window.dev={};else return;const t=i=>r=>i(r).then(n=>console.log(n.data),n=>console.log(n));mbe({...{getServerFactoryVersion:i=>t(sbe)(i),getProviderCalendar:i=>t(K1)(i),getTournamentInfo:i=>t(uK)(i),getEventData:i=>t(cK(i))},baseApi:rv,context:Cm})}function mbe(t){if(typeof(window==null?void 0:window.dev)=="object")try{Object.keys(t).forEach(e=>window.dev[e]=t[e])}catch{console.log("production environment")}}function hbe(){document.oncontextmenu=()=>!1,window.addEventListener("contextmenu",t=>{t.preventDefault()},!1),window.onunhandledrejection=t=>{t.preventDefault();const e=t.reason,i=e&&(e.stack||e);i&&i.indexOf("blocked")>0?console.warn("popup blocked"):console.warn("Unhandled rejection:",e&&(e.stack||e))}}const fbe="1.2.3",FE=typeof navigator<"u"?navigator.userAgent.toLowerCase().indexOf("firefox")>0:!1;function LE(t,e,i,r){t.addEventListener?t.addEventListener(e,i,r):t.attachEvent&&t.attachEvent("on".concat(e),i)}function $v(t,e,i,r){t.removeEventListener?t.removeEventListener(e,i,r):t.detachEvent&&t.detachEvent("on".concat(e),i)}function dK(t,e){const i=e.slice(0,e.length-1);for(let r=0;r<i.length;r++)i[r]=t[i[r].toLowerCase()];return i}function pK(t){typeof t!="string"&&(t=""),t=t.replace(/\s/g,"");const e=t.split(",");let i=e.lastIndexOf("");for(;i>=0;)e[i-1]+=",",e.splice(i,1),i=e.lastIndexOf("");return e}function gbe(t,e){const i=t.length>=e.length?t:e,r=t.length>=e.length?e:t;let n=!0;for(let a=0;a<i.length;a++)r.indexOf(i[a])===-1&&(n=!1);return n}const WI={backspace:8,"":8,tab:9,clear:12,enter:13,"":13,return:13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,del:46,delete:46,ins:45,insert:45,home:36,end:35,pageup:33,pagedown:34,capslock:20,num_0:96,num_1:97,num_2:98,num_3:99,num_4:100,num_5:101,num_6:102,num_7:103,num_8:104,num_9:105,num_multiply:106,num_add:107,num_enter:108,num_subtract:109,num_decimal:110,num_divide:111,"":20,",":188,".":190,"/":191,"`":192,"-":FE?173:189,"=":FE?61:187,";":FE?59:186,"'":222,"[":219,"]":221,"\\":220},Mu={"":16,shift:16,"":18,alt:18,option:18,"":17,ctrl:17,control:17,"":91,cmd:91,command:91},Q1={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey",shiftKey:16,ctrlKey:17,altKey:18,metaKey:91},da={16:!1,18:!1,17:!1,91:!1},Jr={};for(let t=1;t<20;t++)WI["f".concat(t)]=111+t;let Sr=[],eI=null,mK="all";const dc=new Map,Hb=t=>WI[t.toLowerCase()]||Mu[t.toLowerCase()]||t.toUpperCase().charCodeAt(0),vbe=t=>Object.keys(WI).find(e=>WI[e]===t),Ibe=t=>Object.keys(Mu).find(e=>Mu[e]===t);function hK(t){mK=t||"all"}function qI(){return mK||"all"}function ybe(){return Sr.slice(0)}function bbe(){return Sr.map(t=>vbe(t)||Ibe(t)||String.fromCharCode(t))}function wbe(){const t=[];return Object.keys(Jr).forEach(e=>{Jr[e].forEach(i=>{let{key:r,scope:n,mods:a,shortcut:o}=i;t.push({scope:n,shortcut:o,mods:a,keys:r.split("+").map(s=>Hb(s))})})}),t}function Ube(t){const e=t.target||t.srcElement,{tagName:i}=e;let r=!0;const n=i==="INPUT"&&!["checkbox","radio","range","button","file","reset","submit","color"].includes(e.type);return(e.isContentEditable||(n||i==="TEXTAREA"||i==="SELECT")&&!e.readOnly)&&(r=!1),r}function Sbe(t){return typeof t=="string"&&(t=Hb(t)),Sr.indexOf(t)!==-1}function Tbe(t,e){let i,r;t||(t=qI());for(const n in Jr)if(Object.prototype.hasOwnProperty.call(Jr,n))for(i=Jr[n],r=0;r<i.length;)i[r].scope===t?i.splice(r,1).forEach(o=>{let{element:s}=o;return $x(s)}):r++;qI()===t&&hK(e||"all")}function Dbe(t){let e=t.keyCode||t.which||t.charCode;const i=Sr.indexOf(e);if(i>=0&&Sr.splice(i,1),t.key&&t.key.toLowerCase()==="meta"&&Sr.splice(0,Sr.length),(e===93||e===224)&&(e=91),e in da){da[e]=!1;for(const r in Mu)Mu[r]===e&&(cu[r]=!1)}}function fK(t){if(typeof t>"u")Object.keys(Jr).forEach(n=>{Array.isArray(Jr[n])&&Jr[n].forEach(a=>fU(a)),delete Jr[n]}),$x(null);else if(Array.isArray(t))t.forEach(n=>{n.key&&fU(n)});else if(typeof t=="object")t.key&&fU(t);else if(typeof t=="string"){for(var e=arguments.length,i=new Array(e>1?e-1:0),r=1;r<e;r++)i[r-1]=arguments[r];let[n,a]=i;typeof n=="function"&&(a=n,n=""),fU({key:t,scope:n,method:a,splitKey:"+"})}}const fU=t=>{let{key:e,scope:i,method:r,splitKey:n="+"}=t;pK(e).forEach(o=>{const s=o.split(n),l=s.length,u=s[l-1],c=u==="*"?"*":Hb(u);if(!Jr[c])return;i||(i=qI());const d=l>1?dK(Mu,s):[],p=[];Jr[c]=Jr[c].filter(m=>{const f=(r?m.method===r:!0)&&m.scope===i&&gbe(m.mods,d);return f&&p.push(m.element),!f}),p.forEach(m=>$x(m))})};function e2(t,e,i,r){if(e.element!==r)return;let n;if(e.scope===i||e.scope==="all"){n=e.mods.length>0;for(const a in da)Object.prototype.hasOwnProperty.call(da,a)&&(!da[a]&&e.mods.indexOf(+a)>-1||da[a]&&e.mods.indexOf(+a)===-1)&&(n=!1);(e.mods.length===0&&!da[16]&&!da[18]&&!da[17]&&!da[91]||n||e.shortcut==="*")&&(e.keys=[],e.keys=e.keys.concat(Sr),e.method(t,e)===!1&&(t.preventDefault?t.preventDefault():t.returnValue=!1,t.stopPropagation&&t.stopPropagation(),t.cancelBubble&&(t.cancelBubble=!0)))}}function t2(t,e){const i=Jr["*"];let r=t.keyCode||t.which||t.charCode;if(!cu.filter.call(this,t))return;if((r===93||r===224)&&(r=91),Sr.indexOf(r)===-1&&r!==229&&Sr.push(r),["ctrlKey","altKey","shiftKey","metaKey"].forEach(s=>{const l=Q1[s];t[s]&&Sr.indexOf(l)===-1?Sr.push(l):!t[s]&&Sr.indexOf(l)>-1?Sr.splice(Sr.indexOf(l),1):s==="metaKey"&&t[s]&&Sr.length===3&&(t.ctrlKey||t.shiftKey||t.altKey||(Sr=Sr.slice(Sr.indexOf(l))))}),r in da){da[r]=!0;for(const s in Mu)Mu[s]===r&&(cu[s]=!0);if(!i)return}for(const s in da)Object.prototype.hasOwnProperty.call(da,s)&&(da[s]=t[Q1[s]]);t.getModifierState&&!(t.altKey&&!t.ctrlKey)&&t.getModifierState("AltGraph")&&(Sr.indexOf(17)===-1&&Sr.push(17),Sr.indexOf(18)===-1&&Sr.push(18),da[17]=!0,da[18]=!0);const n=qI();if(i)for(let s=0;s<i.length;s++)i[s].scope===n&&(t.type==="keydown"&&i[s].keydown||t.type==="keyup"&&i[s].keyup)&&e2(t,i[s],n,e);if(!(r in Jr))return;const a=Jr[r],o=a.length;for(let s=0;s<o;s++)if((t.type==="keydown"&&a[s].keydown||t.type==="keyup"&&a[s].keyup)&&a[s].key){const l=a[s],{splitKey:u}=l,c=l.key.split(u),d=[];for(let p=0;p<c.length;p++)d.push(Hb(c[p]));d.sort().join("")===Sr.sort().join("")&&e2(t,l,n,e)}}function cu(t,e,i){Sr=[];const r=pK(t);let n=[],a="all",o=document,s=0,l=!1,u=!0,c="+",d=!1,p=!1;for(i===void 0&&typeof e=="function"&&(i=e),Object.prototype.toString.call(e)==="[object Object]"&&(e.scope&&(a=e.scope),e.element&&(o=e.element),e.keyup&&(l=e.keyup),e.keydown!==void 0&&(u=e.keydown),e.capture!==void 0&&(d=e.capture),typeof e.splitKey=="string"&&(c=e.splitKey),e.single===!0&&(p=!0)),typeof e=="string"&&(a=e),p&&fK(t,a);s<r.length;s++)t=r[s].split(c),n=[],t.length>1&&(n=dK(Mu,t)),t=t[t.length-1],t=t==="*"?"*":Hb(t),t in Jr||(Jr[t]=[]),Jr[t].push({keyup:l,keydown:u,scope:a,mods:n,shortcut:r[s],method:i,key:r[s],splitKey:c,element:o});if(typeof o<"u"&&window){if(!dc.has(o)){const m=function(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:window.event;return t2(f,o)},h=function(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:window.event;t2(f,o),Dbe(f)};dc.set(o,{keydownListener:m,keyupListenr:h,capture:d}),LE(o,"keydown",m,d),LE(o,"keyup",h,d)}if(!eI){const m=()=>{Sr=[]};eI={listener:m,capture:d},LE(window,"focus",m,d)}}}function Pbe(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"all";Object.keys(Jr).forEach(i=>{Jr[i].filter(n=>n.scope===e&&n.shortcut===t).forEach(n=>{n&&n.method&&n.method()})})}function $x(t){const e=Object.values(Jr).flat();if(e.findIndex(r=>{let{element:n}=r;return n===t})<0){const{keydownListener:r,keyupListenr:n,capture:a}=dc.get(t)||{};r&&n&&($v(t,"keyup",n,a),$v(t,"keydown",r,a),dc.delete(t))}if((e.length<=0||dc.size<=0)&&(Object.keys(dc).forEach(n=>{const{keydownListener:a,keyupListenr:o,capture:s}=dc.get(n)||{};a&&o&&($v(n,"keyup",o,s),$v(n,"keydown",a,s),dc.delete(n))}),dc.clear(),Object.keys(Jr).forEach(n=>delete Jr[n]),eI)){const{listener:n,capture:a}=eI;$v(window,"focus",n,a),eI=null}}const _E={getPressedKeyString:bbe,setScope:hK,getScope:qI,deleteScope:Tbe,getPressedKeyCodes:ybe,getAllKeyCodes:wbe,isPressed:Sbe,filter:Ube,trigger:Pbe,unbind:fK,keyMap:WI,modifier:Mu,modifierMap:Q1};for(const t in _E)Object.prototype.hasOwnProperty.call(_E,t)&&(cu[t]=_E[t]);if(typeof window<"u"){const t=window.hotkeys;cu.noConflict=e=>(e&&window.hotkeys===cu&&(window.hotkeys=t),cu),window.hotkeys=cu}const gU=[];function Rbe(){console.log(`%cversion: ${fbe}`,"color: lightblue"),cu("shift+1,shift+3,esc,/",(t,e)=>{t.preventDefault();const r=cu.shift?e.key.split(e.splitKey)[1]:e.key;r==="/"&&gU.splice(0,gU.length),gU.push(r),gU.join("")==="esc13"&&pbe()}),HU(Dy),hbe(),ZV.register("tmx-tm","mouseover",cbe),ZV.register("tmx-tm","mouseout",dbe)}const Ebe=t=>{let e;const i=Array.isArray(t)?t:[t];return r=>{if(e&&i.forEach(n=>n.removeFilter(e)),r){const n=r==null?void 0:r.toLowerCase();e=a=>{var o;return(o=a.searchText)==null?void 0:o.includes(n)},i.forEach(a=>a.addFilter(e))}else e=void 0}},gK=t=>(e,i)=>{const r=e.getDefinition();return t.includes(r.field)?"":i==="asc"&&"<div><i class='fas fa-sort-up'></div>"||i==="desc"&&"<div><i class=' fas fa-sort-down'></div>"||"<div><i class='fas fa-sort'></div>"};function Cbe(t,e,i,r){const n=e>1?"items":"item";return t+`<span style='color:blue; margin-left:10px;'>(${e} ${n})</span>`}function Mbe(t,e){return t.pctSpread&&!e.pctSpread?-1:e.pctSpread&&!t.pctSpread?1:!t.pctSpread&&!e.pctSpread?0:e.pctSpread-t.pctSpread}var i2,nr="colors",eo="sizes",at="space",Nbe={gap:at,gridGap:at,columnGap:at,gridColumnGap:at,rowGap:at,gridRowGap:at,inset:at,insetBlock:at,insetBlockEnd:at,insetBlockStart:at,insetInline:at,insetInlineEnd:at,insetInlineStart:at,margin:at,marginTop:at,marginRight:at,marginBottom:at,marginLeft:at,marginBlock:at,marginBlockEnd:at,marginBlockStart:at,marginInline:at,marginInlineEnd:at,marginInlineStart:at,padding:at,paddingTop:at,paddingRight:at,paddingBottom:at,paddingLeft:at,paddingBlock:at,paddingBlockEnd:at,paddingBlockStart:at,paddingInline:at,paddingInlineEnd:at,paddingInlineStart:at,top:at,right:at,bottom:at,left:at,scrollMargin:at,scrollMarginTop:at,scrollMarginRight:at,scrollMarginBottom:at,scrollMarginLeft:at,scrollMarginX:at,scrollMarginY:at,scrollMarginBlock:at,scrollMarginBlockEnd:at,scrollMarginBlockStart:at,scrollMarginInline:at,scrollMarginInlineEnd:at,scrollMarginInlineStart:at,scrollPadding:at,scrollPaddingTop:at,scrollPaddingRight:at,scrollPaddingBottom:at,scrollPaddingLeft:at,scrollPaddingX:at,scrollPaddingY:at,scrollPaddingBlock:at,scrollPaddingBlockEnd:at,scrollPaddingBlockStart:at,scrollPaddingInline:at,scrollPaddingInlineEnd:at,scrollPaddingInlineStart:at,fontSize:"fontSizes",background:nr,backgroundColor:nr,backgroundImage:nr,borderImage:nr,border:nr,borderBlock:nr,borderBlockEnd:nr,borderBlockStart:nr,borderBottom:nr,borderBottomColor:nr,borderColor:nr,borderInline:nr,borderInlineEnd:nr,borderInlineStart:nr,borderLeft:nr,borderLeftColor:nr,borderRight:nr,borderRightColor:nr,borderTop:nr,borderTopColor:nr,caretColor:nr,color:nr,columnRuleColor:nr,fill:nr,outline:nr,outlineColor:nr,stroke:nr,textDecorationColor:nr,fontFamily:"fonts",fontWeight:"fontWeights",lineHeight:"lineHeights",letterSpacing:"letterSpacings",blockSize:eo,minBlockSize:eo,maxBlockSize:eo,inlineSize:eo,minInlineSize:eo,maxInlineSize:eo,width:eo,minWidth:eo,maxWidth:eo,height:eo,minHeight:eo,maxHeight:eo,flexBasis:eo,gridTemplateColumns:eo,gridTemplateRows:eo,borderWidth:"borderWidths",borderTopWidth:"borderWidths",borderRightWidth:"borderWidths",borderBottomWidth:"borderWidths",borderLeftWidth:"borderWidths",borderStyle:"borderStyles",borderTopStyle:"borderStyles",borderRightStyle:"borderStyles",borderBottomStyle:"borderStyles",borderLeftStyle:"borderStyles",borderRadius:"radii",borderTopLeftRadius:"radii",borderTopRightRadius:"radii",borderBottomRightRadius:"radii",borderBottomLeftRadius:"radii",boxShadow:"shadows",textShadow:"shadows",transition:"transitions",zIndex:"zIndices"},Abe=(t,e)=>typeof e=="function"?{"()":Function.prototype.toString.call(e)}:e,zb=()=>{const t=Object.create(null);return(e,i,...r)=>{const n=(a=>JSON.stringify(a,Abe))(e);return n in t?t[n]:t[n]=i(e,...r)}},zU=Symbol.for("sxs.internal"),Bx=(t,e)=>Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)),r2=t=>{for(const e in t)return!0;return!1},{hasOwnProperty:Obe}=Object.prototype,Z1=t=>t.includes("-")?t:t.replace(/[A-Z]/g,e=>"-"+e.toLowerCase()),kbe=/\s+(?![^()]*\))/,Jh=t=>e=>t(...typeof e=="string"?String(e).split(kbe):[e]),n2={appearance:t=>({WebkitAppearance:t,appearance:t}),backfaceVisibility:t=>({WebkitBackfaceVisibility:t,backfaceVisibility:t}),backdropFilter:t=>({WebkitBackdropFilter:t,backdropFilter:t}),backgroundClip:t=>({WebkitBackgroundClip:t,backgroundClip:t}),boxDecorationBreak:t=>({WebkitBoxDecorationBreak:t,boxDecorationBreak:t}),clipPath:t=>({WebkitClipPath:t,clipPath:t}),content:t=>({content:t.includes('"')||t.includes("'")||/^([A-Za-z]+\([^]*|[^]*-quote|inherit|initial|none|normal|revert|unset)$/.test(t)?t:`"${t}"`}),hyphens:t=>({WebkitHyphens:t,hyphens:t}),maskImage:t=>({WebkitMaskImage:t,maskImage:t}),maskSize:t=>({WebkitMaskSize:t,maskSize:t}),tabSize:t=>({MozTabSize:t,tabSize:t}),textSizeAdjust:t=>({WebkitTextSizeAdjust:t,textSizeAdjust:t}),userSelect:t=>({WebkitUserSelect:t,userSelect:t}),marginBlock:Jh((t,e)=>({marginBlockStart:t,marginBlockEnd:e||t})),marginInline:Jh((t,e)=>({marginInlineStart:t,marginInlineEnd:e||t})),maxSize:Jh((t,e)=>({maxBlockSize:t,maxInlineSize:e||t})),minSize:Jh((t,e)=>({minBlockSize:t,minInlineSize:e||t})),paddingBlock:Jh((t,e)=>({paddingBlockStart:t,paddingBlockEnd:e||t})),paddingInline:Jh((t,e)=>({paddingInlineStart:t,paddingInlineEnd:e||t}))},$E=/([\d.]+)([^]*)/,xbe=(t,e)=>t.length?t.reduce((i,r)=>(i.push(...e.map(n=>n.includes("&")?n.replace(/&/g,/[ +>|~]/.test(r)&&/&.*&/.test(n)?`:is(${r})`:r):r+" "+n)),i),[]):e,Fbe=(t,e)=>t in Lbe&&typeof e=="string"?e.replace(/^((?:[^]*[^\w-])?)(fit-content|stretch)((?:[^\w-][^]*)?)$/,(i,r,n,a)=>r+(n==="stretch"?`-moz-available${a};${Z1(t)}:${r}-webkit-fill-available`:`-moz-fit-content${a};${Z1(t)}:${r}fit-content`)+a):String(e),Lbe={blockSize:1,height:1,inlineSize:1,maxBlockSize:1,maxHeight:1,maxInlineSize:1,maxWidth:1,minBlockSize:1,minHeight:1,minInlineSize:1,minWidth:1,width:1},Mc=t=>t?t+"-":"",vK=(t,e,i)=>t.replace(/([+-])?((?:\d+(?:\.\d*)?|\.\d+)(?:[Ee][+-]?\d+)?)?(\$|--)([$\w-]+)/g,(r,n,a,o,s)=>o=="$"==!!a?r:(n||o=="--"?"calc(":"")+"var(--"+(o==="$"?Mc(e)+(s.includes("$")?"":Mc(i))+s.replace(/\$/g,"-"):s)+")"+(n||o=="--"?"*"+(n||"")+(a||"1")+")":"")),_be=/\s*,\s*(?![^()]*\))/,$be=Object.prototype.toString,cf=(t,e,i,r,n)=>{let a,o,s;const l=(u,c,d)=>{let p,m;const h=f=>{for(p in f){const y=p.charCodeAt(0)===64,I=y&&Array.isArray(f[p])?f[p]:[f[p]];for(m of I){const b=/[A-Z]/.test(v=p)?v:v.replace(/-[^]/g,w=>w[1].toUpperCase()),S=typeof m=="object"&&m&&m.toString===$be&&(!r.utils[b]||!c.length);if(b in r.utils&&!S){const w=r.utils[b];if(w!==o){o=w,h(w(m)),o=null;continue}}else if(b in n2){const w=n2[b];if(w!==s){s=w,h(w(m)),s=null;continue}}if(y&&(g=p.slice(1)in r.media?"@media "+r.media[p.slice(1)]:p,p=g.replace(/\(\s*([\w-]+)\s*(=|<|<=|>|>=)\s*([\w-]+)\s*(?:(<|<=|>|>=)\s*([\w-]+)\s*)?\)/g,(w,U,T,D,P,E)=>{const R=$E.test(U),N=.0625*(R?-1:1),[A,M]=R?[D,U]:[U,D];return"("+(T[0]==="="?"":T[0]===">"===R?"max-":"min-")+A+":"+(T[0]!=="="&&T.length===1?M.replace($E,(C,O,k)=>Number(O)+N*(T===">"?1:-1)+k):M)+(P?") and ("+(P[0]===">"?"min-":"max-")+A+":"+(P.length===1?E.replace($E,(C,O,k)=>Number(O)+N*(P===">"?-1:1)+k):E):"")+")"})),S){const w=y?d.concat(p):[...d],U=y?[...c]:xbe(c,p.split(_be));a!==void 0&&n(a2(...a)),a=void 0,l(m,U,w)}else a===void 0&&(a=[[],c,d]),p=y||p.charCodeAt(0)!==36?p:`--${Mc(r.prefix)}${p.slice(1).replace(/\$/g,"-")}`,m=S?m:typeof m=="number"?m&&b in Bbe?String(m)+"px":String(m):vK(Fbe(b,m??""),r.prefix,r.themeMap[b]),a[0].push(`${y?`${p} `:`${Z1(p)}:`}${m}`)}}var g,v};h(u),a!==void 0&&n(a2(...a)),a=void 0};l(t,e,i)},a2=(t,e,i)=>`${i.map(r=>`${r}{`).join("")}${e.length?`${e.join(",")}{`:""}${t.join(";")}${e.length?"}":""}${Array(i.length?i.length+1:0).join("}")}`,Bbe={animationDelay:1,animationDuration:1,backgroundSize:1,blockSize:1,border:1,borderBlock:1,borderBlockEnd:1,borderBlockEndWidth:1,borderBlockStart:1,borderBlockStartWidth:1,borderBlockWidth:1,borderBottom:1,borderBottomLeftRadius:1,borderBottomRightRadius:1,borderBottomWidth:1,borderEndEndRadius:1,borderEndStartRadius:1,borderInlineEnd:1,borderInlineEndWidth:1,borderInlineStart:1,borderInlineStartWidth:1,borderInlineWidth:1,borderLeft:1,borderLeftWidth:1,borderRadius:1,borderRight:1,borderRightWidth:1,borderSpacing:1,borderStartEndRadius:1,borderStartStartRadius:1,borderTop:1,borderTopLeftRadius:1,borderTopRightRadius:1,borderTopWidth:1,borderWidth:1,bottom:1,columnGap:1,columnRule:1,columnRuleWidth:1,columnWidth:1,containIntrinsicSize:1,flexBasis:1,fontSize:1,gap:1,gridAutoColumns:1,gridAutoRows:1,gridTemplateColumns:1,gridTemplateRows:1,height:1,inlineSize:1,inset:1,insetBlock:1,insetBlockEnd:1,insetBlockStart:1,insetInline:1,insetInlineEnd:1,insetInlineStart:1,left:1,letterSpacing:1,margin:1,marginBlock:1,marginBlockEnd:1,marginBlockStart:1,marginBottom:1,marginInline:1,marginInlineEnd:1,marginInlineStart:1,marginLeft:1,marginRight:1,marginTop:1,maxBlockSize:1,maxHeight:1,maxInlineSize:1,maxWidth:1,minBlockSize:1,minHeight:1,minInlineSize:1,minWidth:1,offsetDistance:1,offsetRotate:1,outline:1,outlineOffset:1,outlineWidth:1,overflowClipMargin:1,padding:1,paddingBlock:1,paddingBlockEnd:1,paddingBlockStart:1,paddingBottom:1,paddingInline:1,paddingInlineEnd:1,paddingInlineStart:1,paddingLeft:1,paddingRight:1,paddingTop:1,perspective:1,right:1,rowGap:1,scrollMargin:1,scrollMarginBlock:1,scrollMarginBlockEnd:1,scrollMarginBlockStart:1,scrollMarginBottom:1,scrollMarginInline:1,scrollMarginInlineEnd:1,scrollMarginInlineStart:1,scrollMarginLeft:1,scrollMarginRight:1,scrollMarginTop:1,scrollPadding:1,scrollPaddingBlock:1,scrollPaddingBlockEnd:1,scrollPaddingBlockStart:1,scrollPaddingBottom:1,scrollPaddingInline:1,scrollPaddingInlineEnd:1,scrollPaddingInlineStart:1,scrollPaddingLeft:1,scrollPaddingRight:1,scrollPaddingTop:1,shapeMargin:1,textDecoration:1,textDecorationThickness:1,textIndent:1,textUnderlineOffset:1,top:1,transitionDelay:1,transitionDuration:1,verticalAlign:1,width:1,wordSpacing:1},o2=t=>String.fromCharCode(t+(t>25?39:97)),am=t=>(e=>{let i,r="";for(i=Math.abs(e);i>52;i=i/52|0)r=o2(i%52)+r;return o2(i%52)+r})(((e,i)=>{let r=i.length;for(;r;)e=33*e^i.charCodeAt(--r);return e})(5381,JSON.stringify(t))>>>0),Gv=["themed","global","styled","onevar","resonevar","allvar","inline"],Vbe=t=>{if(t.href&&!t.href.startsWith(location.origin))return!1;try{return!!t.cssRules}catch{return!1}},jbe=t=>{let e;const i=()=>{const{cssRules:n}=e.sheet;return[].map.call(n,(a,o)=>{const{cssText:s}=a;let l="";if(s.startsWith("--sxs"))return"";if(n[o-1]&&(l=n[o-1].cssText).startsWith("--sxs")){if(!a.cssRules.length)return"";for(const u in e.rules)if(e.rules[u].group===a)return`--sxs{--sxs:${[...e.rules[u].cache].join(" ")}}${s}`;return a.cssRules.length?`${l}${s}`:""}return s}).join("")},r=()=>{if(e){const{rules:s,sheet:l}=e;if(!l.deleteRule){for(;Object(Object(l.cssRules)[0]).type===3;)l.cssRules.splice(0,1);l.cssRules=[]}for(const u in s)delete s[u]}const n=Object(t).styleSheets||[];for(const s of n)if(Vbe(s)){for(let l=0,u=s.cssRules;u[l];++l){const c=Object(u[l]);if(c.type!==1)continue;const d=Object(u[l+1]);if(d.type!==4)continue;++l;const{cssText:p}=c;if(!p.startsWith("--sxs"))continue;const m=p.slice(14,-3).trim().split(/\s+/),h=Gv[m[0]];h&&(e||(e={sheet:s,reset:r,rules:{},toString:i}),e.rules[h]={group:d,index:l,cache:new Set(m)})}if(e)break}if(!e){const s=(l,u)=>({type:u,cssRules:[],insertRule(c,d){this.cssRules.splice(d,0,s(c,{import:3,undefined:1}[(c.toLowerCase().match(/^@([a-z]+)/)||[])[1]]||4))},get cssText(){return l==="@media{}"?`@media{${[].map.call(this.cssRules,c=>c.cssText).join("")}}`:l}});e={sheet:t?(t.head||t).appendChild(document.createElement("style")).sheet:s("","text/css"),rules:{},reset:r,toString:i}}const{sheet:a,rules:o}=e;for(let s=Gv.length-1;s>=0;--s){const l=Gv[s];if(!o[l]){const u=Gv[s+1],c=o[u]?o[u].index:a.cssRules.length;a.insertRule("@media{}",c),a.insertRule(`--sxs{--sxs:${s}}`,c),o[l]={group:a.cssRules[c+1],index:c,cache:new Set([s])}}Gbe(o[l])}};return r(),e},Gbe=t=>{const e=t.group;let i=e.cssRules.length;t.apply=r=>{try{e.insertRule(r,i),++i}catch{}}},Bv=Symbol(),Hbe=zb(),zbe=(t,e)=>Hbe(t,()=>(...i)=>{let r={type:null,composers:new Set};for(const n of i)if(n!=null)if(n[zU]){r.type==null&&(r.type=n[zU].type);for(const a of n[zU].composers)r.composers.add(a)}else n.constructor!==Object||n.$$typeof?r.type==null&&(r.type=n):r.composers.add(Wbe(n,t));return r.type==null&&(r.type="span"),r.composers.size||r.composers.add(["PJLV",{},[],[],{},[]]),qbe(t,r,e)}),Wbe=({variants:t,compoundVariants:e,defaultVariants:i,...r},n)=>{const a=`${Mc(n.prefix)}c-${am(r)}`,o=[],s=[],l=Object.create(null),u=[];for(const p in i)l[p]=String(i[p]);if(typeof t=="object"&&t)for(const p in t){c=l,d=p,Obe.call(c,d)||(l[p]="undefined");const m=t[p];for(const h in m){const f={[p]:String(h)};String(h)==="undefined"&&u.push(p);const g=m[h],v=[f,g,!r2(g)];o.push(v)}}var c,d;if(typeof e=="object"&&e)for(const p of e){let{css:m,...h}=p;m=typeof m=="object"&&m||{};for(const g in h)h[g]=String(h[g]);const f=[h,m,!r2(m)];s.push(f)}return[a,r,o,s,l,u]},qbe=(t,e,i)=>{const[r,n,a,o]=Ybe(e.composers),s=typeof e.type=="function"||e.type.$$typeof?(d=>{function p(){for(let m=0;m<p[Bv].length;m++){const[h,f]=p[Bv][m];d.rules[h].apply(f)}return p[Bv]=[],null}return p[Bv]=[],p.rules={},Gv.forEach(m=>p.rules[m]={apply:h=>p[Bv].push([m,h])}),p})(i):null,l=(s||i).rules,u=`.${r}${n.length>1?`:where(.${n.slice(1).join(".")})`:""}`,c=d=>{d=typeof d=="object"&&d||Kbe;const{css:p,...m}=d,h={};for(const v in a)if(delete m[v],v in d){let y=d[v];typeof y=="object"&&y?h[v]={"@initial":a[v],...y}:(y=String(y),h[v]=y!=="undefined"||o.has(v)?y:a[v])}else h[v]=a[v];const f=new Set([...n]);for(const[v,y,I,b]of e.composers){i.rules.styled.cache.has(v)||(i.rules.styled.cache.add(v),cf(y,[`.${v}`],[],t,U=>{l.styled.apply(U)}));const S=s2(I,h,t.media),w=s2(b,h,t.media,!0);for(const U of S)if(U!==void 0)for(const[T,D,P]of U){const E=`${v}-${am(D)}-${T}`;f.add(E);const R=(P?i.rules.resonevar:i.rules.onevar).cache,N=P?l.resonevar:l.onevar;R.has(E)||(R.add(E),cf(D,[`.${E}`],[],t,A=>{N.apply(A)}))}for(const U of w)if(U!==void 0)for(const[T,D]of U){const P=`${v}-${am(D)}-${T}`;f.add(P),i.rules.allvar.cache.has(P)||(i.rules.allvar.cache.add(P),cf(D,[`.${P}`],[],t,E=>{l.allvar.apply(E)}))}}if(typeof p=="object"&&p){const v=`${r}-i${am(p)}-css`;f.add(v),i.rules.inline.cache.has(v)||(i.rules.inline.cache.add(v),cf(p,[`.${v}`],[],t,y=>{l.inline.apply(y)}))}for(const v of String(d.className||"").trim().split(/\s+/))v&&f.add(v);const g=m.className=[...f].join(" ");return{type:e.type,className:g,selector:u,props:m,toString:()=>g,deferredInjector:s}};return Bx(c,{className:r,selector:u,[zU]:e,toString:()=>(i.rules.styled.cache.has(r)||c(),r)})},Ybe=t=>{let e="";const i=[],r={},n=[];for(const[a,,,,o,s]of t){e===""&&(e=a),i.push(a),n.push(...s);for(const l in o){const u=o[l];(r[l]===void 0||u!=="undefined"||s.includes(u))&&(r[l]=u)}}return[e,i,r,new Set(n)]},s2=(t,e,i,r)=>{const n=[];e:for(let[a,o,s]of t){if(s)continue;let l,u=0,c=!1;for(l in a){const d=a[l];let p=e[l];if(p!==d){if(typeof p!="object"||!p)continue e;{let m,h,f=0;for(const g in p){if(d===String(p[g])){if(g!=="@initial"){const v=g.slice(1);(h=h||[]).push(v in i?i[v]:g.replace(/^@media ?/,"")),c=!0}u+=f,m=!0}++f}if(h&&h.length&&(o={["@media "+h.join(", ")]:o}),!m)continue e}}}(n[u]=n[u]||[]).push([r?"cv":`${l}-${a[l]}`,o,c])}return n},Kbe={},Xbe=zb(),Jbe=(t,e)=>Xbe(t,()=>(...i)=>{const r=()=>{for(let n of i){n=typeof n=="object"&&n||{};let a=am(n);if(!e.rules.global.cache.has(a)){if(e.rules.global.cache.add(a),"@import"in n){let o=[].indexOf.call(e.sheet.cssRules,e.rules.themed.group)-1;for(let s of[].concat(n["@import"]))s=s.includes('"')||s.includes("'")?s:`"${s}"`,e.sheet.insertRule(`@import ${s};`,o++);delete n["@import"]}cf(n,[],[],t,o=>{e.rules.global.apply(o)})}}return""};return Bx(r,{toString:r})}),Qbe=zb(),Zbe=(t,e)=>Qbe(t,()=>i=>{const r=`${Mc(t.prefix)}k-${am(i)}`,n=()=>{if(!e.rules.global.cache.has(r)){e.rules.global.cache.add(r);const a=[];cf(i,[],[],t,s=>a.push(s));const o=`@keyframes ${r}{${a.join("")}}`;e.rules.global.apply(o)}return r};return Bx(n,{get name(){return n()},toString:n})}),ewe=class{constructor(t,e,i,r){this.token=t==null?"":String(t),this.value=e==null?"":String(e),this.scale=i==null?"":String(i),this.prefix=r==null?"":String(r)}get computedValue(){return"var("+this.variable+")"}get variable(){return"--"+Mc(this.prefix)+Mc(this.scale)+this.token}toString(){return this.computedValue}},twe=zb(),iwe=(t,e)=>twe(t,()=>(i,r)=>{r=typeof i=="object"&&i||Object(r);const n=`.${i=(i=typeof i=="string"?i:"")||`${Mc(t.prefix)}t-${am(r)}`}`,a={},o=[];for(const l in r){a[l]={};for(const u in r[l]){const c=`--${Mc(t.prefix)}${l}-${u}`,d=vK(String(r[l][u]),t.prefix,l);a[l][u]=new ewe(u,d,l,t.prefix),o.push(`${c}:${d}`)}}const s=()=>{if(o.length&&!e.rules.themed.cache.has(i)){e.rules.themed.cache.add(i);const l=`${r===t.theme?":root,":""}.${i}{${o.join(";")}}`;e.rules.themed.apply(l)}return i};return{...a,get className(){return s()},selector:n,toString:s}}),rwe=zb(),IK=t=>{let e=!1;const i=rwe(t,r=>{e=!0;const n="prefix"in(r=typeof r=="object"&&r||{})?String(r.prefix):"",a=typeof r.media=="object"&&r.media||{},o=typeof r.root=="object"?r.root||null:globalThis.document||null,s=typeof r.theme=="object"&&r.theme||{},l={prefix:n,media:a,theme:s,themeMap:typeof r.themeMap=="object"&&r.themeMap||{...Nbe},utils:typeof r.utils=="object"&&r.utils||{}},u=jbe(o),c={css:zbe(l,u),globalCss:Jbe(l,u),keyframes:Zbe(l,u),createTheme:iwe(l,u),reset(){u.reset(),c.theme.toString()},theme:{},sheet:u,config:l,prefix:n,getCssText:u.toString,toString:u.toString};return String(c.theme=c.createTheme(s)),c});return e||i.reset(),i},nwe=()=>i2||(i2=IK()),Yt=(...t)=>nwe().css(...t);function awe({variant:t}){return Yt({margin:"2.5px 0",variants:{variant:{showAddress:{lineHeight:"2.3em"}}}})({variant:t})}const owe=Yt({justifyContent:"flex-start",alignItems:"center",whiteSpace:"nowrap",fontWeight:500,display:"flex"}),swe=Yt({textTransform:"$participant$textTransform",fontSize:"0.875rem",fontWeight:500,variants:{variant:{winner:{fontWeight:700,color:"$winnerName"},loser:{fontWeight:500}}}}),lwe=Yt({"&::WebkitScrollbar":{display:"none"},justifyContent:"space-between",flexDirection:"column",marginInlineEnd:"0rem",scrollbarWidth:"none",overflowX:"scroll",fontWeight:500,display:"flex",width:"100%",variants:{variant:{doubles:{marginTop:"0.25rem",fontSize:"0.75rem",lineHeight:"1rem"}}}});function uwe({drawPosition:t,sideNumber:e}){return Yt({minHeight:"$participant$minHeight",justifyContent:"space-between",paddingInlineStart:"0.75rem",backgroundColor:"$matchUp",paddingInlineEnd:"0rem",boxSizing:"border-box",paddingBottom:".2rem",position:"relative",alignItems:"center",paddingTop:".2rem",minWidth:"15rem",cursor:"pointer",display:"flex",flexGrow:1,"& p":{fontFamily:"Sharp Sans, Arial, sans-serif",color:"$color"},variants:{sideNumber:{1:{borderBottom:"1px solid $internalDividers"}}}})({sideNumber:e,css:t&&{"&:before":{backgroundColor:"$backgroundColor",content:`${t}`,justifyContent:"center",alignContent:"center",insetInlineStart:-10,position:"absolute",color:"#55AFFE",display:"flex",width:20}}})}function cwe({winnerChevron:t,isDoubles:e}){const i=(e?.4:.3)*2;return Yt({variants:{variant:{winner:{"&::before":{borderTop:`${i}rem solid transparent`,borderBottom:`${i}rem solid transparent`,borderInlineStart:"8px solid #008f70",position:"absolute",insetInlineStart:0,display:"block",content:""}}}}})({variant:t?"winner":void 0})}const Vx=Yt({fontSize:"smaller",color:"gray"});var dwe=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function yK(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var bK={exports:{}};/*!
	Copyright (c) 2018 Jed Watson.
	Licensed under the MIT License (MIT), see
	http://jedwatson.github.io/classnames
*/(function(t){(function(){var e={}.hasOwnProperty;function i(){for(var a="",o=0;o<arguments.length;o++){var s=arguments[o];s&&(a=n(a,r(s)))}return a}function r(a){if(typeof a=="string"||typeof a=="number")return a;if(typeof a!="object")return"";if(Array.isArray(a))return i.apply(null,a);if(a.toString!==Object.prototype.toString&&!a.toString.toString().includes("[native code]"))return a.toString();var o="";for(var s in a)e.call(a,s)&&a[s]&&(o=n(o,s));return o}function n(a,o){return o?a?a+" "+o:a+o:a}t.exports?(i.default=i,t.exports=i):window.classNames=i})()})(bK);var pwe=bK.exports;const Up=yK(pwe);function mwe({individualParticipant:t,className:e}){var i,r;const{city:n,state:a,countryCode:o}=((r=(i=t==null?void 0:t.person)==null?void 0:i.addresses)==null?void 0:r[0])||{},s=[n,a,o].filter(Boolean).join(", ")||" ",l=document.createElement("div");return l.className=Up(Vx(),e),l.innerHTML=s,l}const hwe=Yt({willChange:"opacity",position:"fixed",zIndex:9998,bottom:0,right:0,left:0,top:0}),fwe=Yt({display:"block"}),gwe=Yt({position:"fixed",right:0,left:0}),vwe=Yt({paddingRight:"15px",alignItems:"center",margin:"30px auto",paddingLeft:"15px",position:"fixed",height:"100vh",display:"flex",width:"100%",zIndex:9999,bottom:0,right:0,left:0,top:0}),Iwe=Yt({boxShadow:"0 3px 6px rgba(0, 0, 0, 0.16), 0 3px 6px rgba(0, 0, 0, 0.23)",backgroundColor:"white",position:"relative",borderRadius:"3px",minHeight:"auto",width:"100%"}),ywe=Yt({borderBottom:"1px solid rgba(0, 0, 0, 0.1)",alignItems:"center",position:"relative",display:"flex"}),bwe=Yt({fontWeight:"600",fontSize:"20px"}),l2=Yt({borderTop:"1px solid rgba(0, 0, 0, 0.1)",justifyContent:"right",alignItems:"center",position:"relative",display:"flex"}),u2="Nothing to see here";function Is(t){return typeof t=="function"}function WU(t){return typeof t=="string"}function c2(t){return Array.isArray(t)}function BE(t){return typeof t=="object"&&!Array.isArray(t)}function wwe(t){if(t)for(;t.firstChild;)t.removeChild(t.firstChild)}const d2=(()=>{const t=gwe(),e={},i=".5";let r=[],n,a=[],o=[],s;const l=f=>{if(f){let g;o=o.filter(v=>(v.id===f&&(g=v),v.id!==f)),g&&document.body.removeChild(g)}else{const g=o.pop();g&&document.body.removeChild(g)}},u=()=>{s&&(s.style.opacity=0,s.style.display="none")},c=f=>{const g=o.length;if(f&&e[g]===!1)return;const v=a.pop(),y=r.pop();Is(v)&&v({content:y}),document.body.classList.remove(t),document.body.style.top=null,window.scrollTo({top:n,behavior:"instant"}),u(),l()},d=()=>{s=document.createElement("div"),s.className=hwe(),s.id="cmdl-backdrop",s.onclick=()=>c(!0),document.body.appendChild(s)},p=({config:f})=>{n=window.scrollY,document.body.classList.add(t),document.body.style.top=`-${n}px`,s||d(),s.style.display="",(f==null?void 0:f.backdrop)!==!1&&(s.style.backgroundColor="rgba(0, 0, 0, 0.2)",s.style.transition="opacity 0.15s linear",s.style.opacity=1)},m=({config:f,attr:g,attrs:v,unit:y="em",value:I})=>{var b;let S;return WU(g)?S=eM({element:f,attr:g}):c2(v)&&(S=(b=v.map(w=>eM({element:f,attr:w})).filter(Boolean))==null?void 0:b[0]),S!==void 0&&(I=S),isNaN(I)?I:`${I}${y}`},h=({buttons:f,config:g,modalNumber:v})=>{var y,I;const b=document.createElement("div");b.className=l2(),b.style.padding=m({config:g,attrs:["footer.padding","padding"],value:i});const S={label:((y=g==null?void 0:g.dictionary)==null?void 0:y.close)||"Close",onClick:d2.close,intent:"is-info"};for(const w of f){if(w.hide)continue;const U={...S};BE(w)&&Object.assign(U,w);const T=document.createElement("button");U.disabled!==void 0&&(T.disabled=U.disabled),U.id&&(T.id=U.id),T.className=((I=U==null?void 0:U.footer)==null?void 0:I.className)||"button font-medium",T.classList.add(U.intent),T.style="margin-right: .5em;",T.innerHTML=U.label||U.text,T.onclick=D=>{D.stopPropagation(),Is(U.onClick)&&U.onClick({e:D,content:r[v]}),U.close!==!1&&(Is(U.close)&&U.close(),d2.close())},b.appendChild(T)}return b};return{close:c,open:({title:f="",content:g,buttons:v,footer:y,config:I,onClose:b}={})=>{p({config:I}),a.push(b);const S=o.length+1;e[S]=I==null?void 0:I.clickAway;const w=document.createElement("section"),U=`cmdl-${S}`;w.className=fwe(),w.role="dialog",w.tabIndex=-1,w.id=U;const T=document.createElement("div");T.className=vwe(),T.style.maxWidth=`${(I==null?void 0:I.maxWidth)||450}px`,T.onclick=()=>c(!0);const D=document.createElement("div");D.className=Iwe(),D.onclick=k=>k.stopPropagation();const P=document.createElement("div"),E=document.createElement("div");P.appendChild(E),D.appendChild(P);const R=({title:k,config:x})=>{P.className=k?ywe():"",P.style.padding=m({config:x,attrs:["title.padding","padding"],value:i}),E.className=k?bwe():"",E.innerHTML=k};f&&R({title:f});const N=document.createElement("div");D.appendChild(N);const A=({content:k,config:x})=>{N.style.fontSize=m({config:x,attr:"fontSize",value:"15px"}),N.style.position="relative",N.style.padding=m({config:x,attrs:["content.padding","padding"],value:i}),Is(k)?r[S]=k(N):BE(k)?N.appendChild(k):WU(k)?N.innerHTML=k:N.innerHTML=u2};if(A({content:g,config:I}),c2(v))y=h({buttons:v,config:I,modalNumber:S}),D.appendChild(y);else if(y){const k=document.createElement("div");k.className=l2(),k.style.padding=m({config:I,attrs:["footer.padding","padding"]}),BE(y)?k.appendChild(y):WU(y)?k.innerHTML=y:k.innerHTML=u2,D.appendChild(k)}T.appendChild(D),w.appendChild(T),document.body.appendChild(w),o.push(w);const M=({content:k,config:x})=>{r[S]=void 0,wwe(N),A({content:k,config:x})},C=({buttons:k,config:x})=>{D.removeChild(y),y=h({buttons:k,config:x,modalNumber:S}),D.appendChild(y)},O=({onClose:k})=>{a.length=0,a.push(k)};return{setContent:M,setButtons:C,update:({content:k,buttons:x,title:F,config:$,onClose:_})=>{I=$||I,k&&M({content:k,config:I}),x&&C({buttons:x,config:I}),_&&O({onClose:_}),F&&R({title:F,config:I})}}}}})();function eM({element:t,attr:e}){if(!WU(e))return;const i=e.split(".");for(const r of i)if(t=t==null?void 0:t[r],!t)return;return t}function Uwe({individualParticipant:t,attribute:e,className:i}){const r=t==null?void 0:t.person,n=eM({element:r,attr:e});if(!n)return;const a=document.createElement("div");return a.className=Up(Vx(),i),a.innerHTML=n,a}function Swe({individualParticipant:t,className:e}){var i;const r=(i=t==null?void 0:t.teams)==null?void 0:i[0],n=(r==null?void 0:r.participantName)||" ",a=document.createElement("div");return a.className=Up(Vx(),e),a.classList.add("tmx-tm"),a.setAttribute("id",r==null?void 0:r.participantId),a.innerHTML=n,a}function Twe(t){var e,i,r,n;const a=(i=(e=t==null?void 0:t.composition)==null?void 0:e.configuration)==null?void 0:i.participantDetail;if(a==="TEAM")return Swe(t);if(((n=(r=t==null?void 0:t.composition)==null?void 0:r.configuration)==null?void 0:n.showAddress)??a==="ADDRESS")return mwe(t);if(a){const o=Uwe({...t,attribute:a});if(o)return o}return document.createElement("div")}const Dwe=Yt({color:"$participant$seed",marginInlineStart:".5rem",textTransform:"uppercase",fontSize:"0.75rem",lineHeight:"1rem"});function Pwe({className:t,composition:e,side:i}){const r=(i==null?void 0:i.seedValue)==="~"?"":(i==null?void 0:i.seedValue)!==void 0&&i.seedValue||(i==null?void 0:i.seedNumber);if(!r)return"";const n=(e==null?void 0:e.configuration)||{},{bracketedSeeds:a}=n,o=typeof a=="boolean"&&["(",")"]||a==="square"&&["[","]"]||["",""],s=`${o[0]}${r}${o[1]}`,l=n.seedingElement==="sup"?"sup":"span",u=document.createElement(l);return u.className=t,u.innerHTML=s,u}const Rwe=Yt({WebkitBoxSizing:"border-box",marginInlineEnd:".5em",boxSizing:"border-box",display:"inline-block",position:"relative",fontSize:"smaller",fontWeight:"bold",borderRadius:2,color:"blue",variants:{color:{green:{color:"green"},red:{color:"red"}}}});function Ewe({individualParticipant:t,composition:e,className:i,matchUp:r,spacer:n}){var a,o,s,l,u,c,d;const p=e==null?void 0:e.configuration,m=((a=p==null?void 0:p.scaleAttributes)==null?void 0:a.eventType)||(r==null?void 0:r.matchUpType)||"SINGLES",h=t==null?void 0:t.rankings,f=t==null?void 0:t.ratings,g=p==null?void 0:p.scaleAttributes,v=g==null?void 0:g.scaleType,y=g==null?void 0:g.scaleName,I=g==null?void 0:g.accessor,b=v==="RATING"?f:h,S=(s=(o=b==null?void 0:b.SINGLES)==null?void 0:o.find(N=>(N==null?void 0:N.scaleName)===y))==null?void 0:s.scaleValue,w=(u=(l=b==null?void 0:b.DOUBLES)==null?void 0:l.find(N=>(N==null?void 0:N.scaleName)===y))==null?void 0:u.scaleValue,U=S&&I?S[I]:S||"",T=w&&I?w[I]:w||"",D=m==="SINGLES"?U:T,P=(c=p==null?void 0:p.scaleAttributes)==null?void 0:c.fallback,E=!n&&(D||P&&(U||T)),R=document.createElement("span");return E&&(R.className=Up(i,Rwe({color:(d=p==null?void 0:p.scaleAttributes)==null?void 0:d.scaleColor}))),R.innerHTML=E||"",R}var Cwe=Object.defineProperty,bt=(t,e)=>{for(var i in e)Cwe(t,i,{get:e[i],enumerable:!0})};function rP(){return"2.1.29"}var wK={};bt(wK,{competitionGovernor:()=>UK,drawsGovernor:()=>gX,entriesGovernor:()=>Ree,eventGovernor:()=>kee,generationGovernor:()=>Jee,matchUpFormatGovernor:()=>lte,matchUpGovernor:()=>ute,mocksGovernor:()=>_$,participantGovernor:()=>iie,policyGovernor:()=>ZZ,publishingGovernor:()=>Die,queryGovernor:()=>nee,reportGovernor:()=>kie,scheduleGovernor:()=>xie,scoreGovernor:()=>S_,tieFormatGovernor:()=>qie,tournamentGovernor:()=>ire,venueGovernor:()=>fre});var UK={};bt(UK,{getLinkedTournamentIds:()=>lw,getTournamentIds:()=>ow,linkTournaments:()=>pX,mutate:()=>SK,query:()=>fX,unlinkTournament:()=>hX,unlinkTournaments:()=>mX});var SK={};bt(SK,{linkTournaments:()=>pX,unlinkTournament:()=>hX,unlinkTournaments:()=>mX});var om="SINGLES",ii="SINGLES",Wd="DOUBLES",ei="DOUBLES",Ba="TEAM",fi="TEAM",Mwe={SINGLES_MATCHUP:om,SINGLES:ii,DOUBLES_MATCHUP:Wd,DOUBLES:ei,TEAM_MATCHUP:Ba,TEAM:fi},TK={[ii]:[ii,"S"],[ei]:[ei,"D"],[fi]:[fi,"T"],S:[ii,"S"],D:[ei,"D"],T:[fi,"T"]};function lr(t,e){return(t??0)-(e??0)}function Ze(t){return typeof t=="number"?parseInt(t.toString()):typeof t=="string"?parseInt(t):0}function Cs(t){return isNaN(t)?!1:t&&(t&t-1)===0}function p2(t){if(!t.length)return;let e=[...t].sort(lr),i=Math.floor(e.length/2);return e.length%2?e[i]:(e[i-1]+e[i])/2}function Nwe(t){if(!Cs(t))return!1;let e=t,i=1;for(;e!==2;)i+=1,e=e/2;return i}function jx(t){return isNaN(t)?0:t%2&&t+1||t}function Gx(t){return Math.pow(2,Math.round(Math.log(t)/Math.log(2)))}function _i(t){return!isNaN(parseFloat(t))}function DK(t){let e=Ze(t);if(!isNaN(e))return e===0?!1:(e&-e)===1}function nv(t){if(isNaN(t))return!1;for(;!Cs(t);)t++;return t}function ro(t,e){return t=Math.ceil(t),e=Math.floor(e),Math.floor(Math.random()*(e-t+1))+t}function st(t){return Number.isSafeInteger(typeof t=="string"?+t:t)}function Awe(t=1,e=3,i=!0){let r=0;for(let n=0;n<e;n++)r+=Math.random()*(t/e);return i&&t>1?Math.round(r):r}function Owe(t,e){e||(e=1);let i=1/e;return Math.round(t*i)/i}function PK(t,e,i,r,n=2){let a=1-Math.random(),o=1-Math.random(),s=Math.sqrt(-2*Math.log(a))*Math.cos(2*Math.PI*o);return s=s/10+.5,s>1||s<0?s=PK(t,e,i):(s=Math.pow(s,i),s*=e-t,s+=t),r&&(s=Owe(s,r)),parseFloat(s.toFixed(n))}function XS(t,e=2){return parseFloat(Number(Math.round(t*1e3)/1e3).toFixed(e))}function dt(t){return Array.isArray(t)?t==null?void 0:t.filter((e,i,r)=>r.lastIndexOf(e)===i):[]}function kwe(t){return Array.isArray(t)?t==null?void 0:t.map(e=>e===null?void 0:e):t}function Tn(t){return Array.isArray(t)?t.map(e=>[Math.random(),e]).sort((e,i)=>e[0]-i[0]).map(e=>e[1]):[]}function Yf(t){return st(t)?t:1/0}function Pa(t){return Array.isArray(t)?t.reduce((e,i)=>(e[i]||(e[i]=0),e[i]++,e),{}):{}}function xwe(t){return RK(Pa(t))}function RK(t){return Object.keys(t).reduce((e,i)=>{let r=t[i];return e[r]?e[r].push(i):e[r]=[i],e},{})}function Fwe(t,e,i){return i.indexOf(t)===e}function EK(t){return t.filter(Fwe)}function ga(t){return Array.isArray(t)&&t.length?t.splice(Math.floor(Math.random()*t.length),1)[0]:void 0}function _o(t){let e=Math.floor(Math.random()*t.length);return t[e]}function Te(t,e){return Array.from({length:e-t},(i,r)=>r+t)}function Ys(t,e){return e.reduce((i,r,n)=>(r===t&&i.push(n),i),[])}function ji(t,e){return!Array.isArray(t)||!Array.isArray(e)?[]:t.filter(i=>e.indexOf(i)!==-1).filter((i,r,n)=>n.indexOf(i)===r)}function m2(t,e){return!Array.isArray(t)||!Array.isArray(e)?[]:t.filter(i=>!e.includes(i))}function Nn(t,e){return!Array.isArray(t)||!Array.isArray(e)?!1:t.some(i=>e.includes(i))}function Lwe(t,e){return Array.isArray(e)&&e.reduce((i,r)=>(i[r]=1+i[r]||1,i),{})[t]||0}function _we(t,e,i,r){return Array.isArray(t)?[].concat(...t.slice(0,e),...t.slice(e,e+i).sort(r),...t.slice(e+i,t.length)):[]}function Cr(t,e){return Array.isArray(t)?t.reduce((i,r,n)=>{let a=Math.floor(n/e);return i[a]=[].concat(i[a]||[],r),i},[]):[]}function CK(t,[e,...i]){return t.length?[t.slice(0,e),...CK(t.slice(e),[...i,e])]:[]}function $we(t){return t.reduce((e,i)=>{let r=e[e.length-1];return(!r||r[r.length-1]!==i-1)&&e.push([]),e[e.length-1].push(i),e},[])}function MK(t){return Array.isArray(t)?t.reduce((e,i)=>!isNaN(parseInt(i))&&e,!0):!1}function NK(t){return Array.isArray(t)?t.reduce((e,i)=>isNaN(parseInt(i))&&e,!0):!1}function tM(t,e,i){return Array.isArray(t)?t.reduce((r,n,a)=>{let o=i?!!(Math.floor(a/e)%2):!1,s=a%e,l=o?e-1-s:s;return r[l]||(r[l]=[]),r[l].push(n),r},[]):[]}function Bwe(t,e=1){if(!Array.isArray(t)||!t.every(st))return[];let i=Math.min(...t,e),r=Math.max(...t);return Te(i,r+1).filter(n=>!t.includes(n))}function ha(t){return typeof t=="function"}function Di(t){return typeof t=="string"}function At(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)}function Vwe(t,e){if(!At(t)||!At(e))return!1;let i=Object.keys(t),r=Object.keys(e);if(i.length!==r.length)return!1;for(let n of i)if(t[n]!==e[n])return!1;return!0}function AK(t,e){return Array.isArray(t)?Object.assign({},...(t??[]).filter(At).map(i=>i[e]&&{[i[e]]:i}).filter(Boolean)):{}}var jwe=t=>e=>Object.keys(t).every(i=>e[i]===t[i]);function iM(t,e){if(t===void 0)return null;if(!At(t)||t===null)return t;let i=Object.keys(t),r=n=>n===void 0?null:n;return Object.assign({},...i.map(n=>Array.isArray(t[n])?{[n]:e?t[n]:t[n].map(a=>iM(a))}:{[n]:e?r(t[n]):iM(t[n])}))}function rM(t){return Array.isArray(t)?t.length+t.map(rM).reduce((e,i)=>e+i,0):At(t)&&t!==null?Object.keys(t).length+Object.keys(t).map(e=>rM(t[e])).reduce((e,i)=>e+i,0):0}function Gwe(t){if(t===null||typeof t!="object")return;let e=JSON.stringify(t),i=rM(t),r=e.split("").reduce((n,a)=>n+a.charCodeAt(0),0);return[e.length,i,r].map(n=>n.toString(36)).join("")}function nP(t,e){return!Array.isArray(t)||!Di(e)?!1:ji(t,TK[e]).length}var Q={success:!0},OK="error",Hwe={SUCCESS:Q,ERROR:OK};function kK({collectionValueProfiles:t,matchUpCount:e}){let i=[];if(!Array.isArray(t))return i.push(`collectionValueProfiles is not an array: ${t}`),{errors:i};if(t.length&&t.length!==e)return i.push("collectionValueProfiles do not align with matchUpsCount"),{errors:i};for(let n of t){if(typeof n!="object")return i.push(`valueProfile is not type object: ${n}`),{errors:i};let{matchUpValue:a,collectionPosition:o}=n;if(typeof a!="number"||typeof o!="number"||o>e||o<1)return i.push("Invalid value profile: value and collectionPosition must be numeric. collectionPosition cannot be greater than matchUpCount"),{errors:i}}let r=t.map(n=>n.collectionPosition);return r.length!==dt(r).length?(i.push("collectionPositions are not unique"),{errors:i}):{...Q}}var zwe={};bt(zwe,{addNotice:()=>ut,callListener:()=>mM,createInstanceState:()=>PUe,cycleMutationStatus:()=>IF,deepCopyEnabled:()=>vF,deleteNotice:()=>yF,deleteNotices:()=>Jb,disableNotifications:()=>z9,enableNotifications:()=>KU,getDevContext:()=>ja,getMethods:()=>Y9,getNotices:()=>K9,getProvider:()=>hM,getTopics:()=>So,getTournamentId:()=>wh,getTournamentRecord:()=>bF,getTournamentRecords:()=>Uh,globalLog:()=>Q9,handleCaughtError:()=>wP,hasTopic:()=>yP,removeTournamentRecord:()=>J9,setDeepCopy:()=>JI,setDevContext:()=>XI,setGlobalLog:()=>H9,setGlobalMethods:()=>W9,setGlobalSubscriptions:()=>EUe,setMethods:()=>q9,setStateMethods:()=>Z9,setStateProvider:()=>DUe,setSubscriptions:()=>CUe,setTournamentId:()=>QI,setTournamentRecord:()=>X9,setTournamentRecords:()=>bP,timeKeeper:()=>RUe});var nM={message:"Chronological error; time violation.",code:"ANACHRONISM"},YI={message:"Duplicate entry",code:"DUPLICATE_ENTRY"},xK={message:"Cannot remove main structure",code:"ERR_CANNOT_REMOVE_MAIN_STRUCTURE"},aM={message:"records must be an object with tournamentId keys",code:"ERR_INVALID_TOURNAMENTS"},xi={message:"Missing tournamentRecords",code:"ERR_MISSING_TOURNAMENTS"},ve={message:"Missing tournamentRecord",code:"ERR_MISSING_TOURNAMENT"},Wb={message:"Invalid tournamentRecord",code:"ERR_INVALID_TOURNAMENT"},Kf={message:"Missing tournamentId",code:"ERR_MISSING_TOURNAMENT_ID"},sm={message:"Invalid drawDefinition",code:"ERR_INVALID_DRAWDEF"},$e={message:"Missing drawDefinition",code:"ERR_MISSING_DRAWDEF"},FK={message:"Existing drawDefinition(s)",code:"ERR_EXISTING_DRAWDEFS"},Va={message:"drawDefinition not found",code:"ERR_NOT_FOUND_DRAWDEF"},Sp={message:"Invalid structure",code:"ERR_INVALID_STRUCTURE"},Hx={message:"Incomplete source structure",code:"ERR_INCOMPLETE_STRUCTURE"},zx={message:"Invalid drawPosition for seedAssignment",code:"ERR_INVALID_SEEDING_POSITION"},Xf={message:"drawPosition already assigned",code:"ERR_EXISTING_POSITION_ASSIGNMENT"},LK={message:"Schedule not cleared",code:"ERR_UNCHANGED_SCHEDULE_NOT_CLEARED"},_K={message:"drawPosition not cleared",code:"ERR_FAILURE_POSITION_NOT_CLEARED"},Wwe={message:"drawPosition not found",code:"ERR_NOT_FOUND_DRAW_POSITION"},Wx={message:"Unrecognized drawType",code:"ERR_UNRECOGNIZED_DRAW_TYPE"},qb={message:"Missing drawPositions",code:"ERR_MISSING_DRAW_POSITIONS"},aP={message:"drawPosition is active",code:"ERR_ACTIVE_DRAW_POSITION"},qwe={message:"drawPosition is occupied",code:"ERR_OCCUPIED_DRAW_POSITION"},av={message:"Invlid drawPosition",code:"ERR_INVALID_DRAW_POSITION"},ov={message:"Missing drawPosition",code:"ERR_MISSING_DRAW_POSITION"},qx={message:"Invalid drawType",code:"ERR_INVALID_DRAW_TYPE"},oP={message:"Invalid drawSize",code:"ERR_INVALID_DRAW_SIZE"},Yx={message:"Cannot set drawSize to be less than existing entries",code:"ERR_INVALID_DRAW_SIZE_MISMATCH"},Yb={message:"Missing drawSize",code:"ERR_MISSING_DRAW_SIZE"},Fs={message:"Missing drawId",code:"ERR_MISSING_DRAW_ID"},$K={message:"drawId exists",code:"ERR_EXISTING_DRAW_ID"},BK={message:"participantId cannot be assigned to multiple seedNumbers",code:"INVALID_PARTICIPANT_SEEDING"},VK={message:"seedsCount greater than drawSize",code:"ERR_INVALID_SEED_COUNT"},jK={message:"Missing seedCountThresholds",code:"ERR_MISSING_SEED_COUNT_THRESHOLD"},GK={message:"Invalid action",code:"ERR_INVALID_ACTION"},oM={message:"Invalid assignment",code:"ERR_INVALID_ASSIGNMENT"},HK={message:"Missing seedAssignments",code:"ERR_MISSING_SEED_ASSIGNMENTS"},zK={message:"Invalid seedNumber",code:"ERR_INVALID_SEED_NUMBER"},WK={message:"Invalid seedPosition",code:"ERR_INVALID_SEED_POSITION"},Kx={message:"Missing targetLink",code:"ERR_MISSING_LINK_TARGET"},qK={message:"Existing round",code:"ERR_EXISTING_ROUND"},Ywe={message:"Missing roundNumber",code:"ERR_MISSING_ROUND_NUMBER"},Xa={message:"Missing structureId",code:"ERR_MISSING_STRUCTURE_ID"},Ai={message:"structure not found",code:"ERR_NOT_FOUND_STRUCTURE"},Xx={message:"Missing structures",code:"ERR_MISSING_STRUCTURES"},Tp={message:"Missing structure",code:"ERR_MISSING_STRUCTURE"},YK={message:"drawDefinition contains unlinked structures",code:"ERR_MISSING_STRUCTURE_LINKS"},Wl={message:"Invalid eventType",code:"ERR_INVALID_EVENT_TYPE"},vi={message:"Missing event / eventId",code:"ERR_MISSING_EVENT_ID"},mo={message:"Event not found",code:"ERR_NOT_FOUND_EVENT"},KK={message:"Event exists",code:"ERR_EXISTING_EVENT"},XK={message:"Missing entries",code:"ERR_MISSING_ENTRIES"},JK={message:"Invalid entries",code:"ERR_INVALID_ENTRIES"},Jx={message:"Missing assignments",code:"ERR_MISSING_ASSIGNMENTS"},QK={message:"Missing stage",code:"ERR_MISSING_STAGE"},Dp={message:"Invalid stage",code:"ERR_INVALID_STAGE"},ZK={message:"stageSequence limit",code:"ERR_LIMIT_STAGE_SEQUENCE"},e9={message:"Missing positionAssignments",code:"ERR_MISSING_POSITION_ASSIGNMENTS"},t9={message:"Cannot Assign BYE status if no assignment: { bye: true }",code:"ERR_UNCHANGED_CANNOT_ASSIGN_BYE"},sM={message:"Unrecognized matchUpStatus",code:"ERR_UNRECOGNIZED_MATCHUP_STATUS"},Kb={message:"Unrecognized matchUpFormat",code:"ERR_UNRECOGNIZED_MATCHUP_FORMAT"},qU={message:"Incompatible matchUpStatus",code:"ERR_INCOMPATIBLE_MATCHUP_STATUS"},sv={message:"Invalid matchUpStatus",code:"ERR_INVALID_MATCHUP_STATUS"},kl={message:"Invalid tieFormat",code:"ERR_INVALID_TIE_FORMAT"},Qx={message:"Invalid matchUpFormat",code:"ERR_INVALID_MATCHUP_FORMAT"},Zx={message:"Missing matchUpFormat",code:"ERR_MISSING_MATCHUP_FORMAT"},i9={message:"Missing collectionDefinition",code:"ERR_MISSING_COLLECTION_DEFINITION"},lv={message:"Missing tieFormat",code:"ERR_MISSING_TIE_FORMAT"},bn={message:"Missing matchUpId",code:"ERR_MISSING_MATCHUP_ID"},gh={message:"Missing matchUpIds",code:"ERR_MISSING_MATCHUP_IDS"},hn={message:"matchUp not found",code:"ERR_NOT_FOUND_MATCHUP"},Ju={message:"Missing matchUps",code:"ERR_MISSING_MATCHUPS"},sa={message:"Missing matchUp",code:"ERR_MISSING_MATCHUP"},la={message:"Invalid matchUp",code:"ERR_INVALID_MATCHUP"},eF={message:"Missing policyType",code:"ERR_MISSING_POLICY_TYPE"},sP={message:"Missing policyDefinitions",code:"ERR_MISSING_POLICY_DEFINITIONS"},Kwe={message:"Missing seeding policy",code:"ERR_MISSING_POLICY_SEEDING"},r9={message:"Missing avoidance policy",code:"ERR_MISSING_POLICY_AVOIDANCE"},tF={message:"Missing policy attributes",code:"ERR_MISSING_POLICY_ATTRIBUTES"},n9={message:"Invalid policyDefinitions",code:"ERR_INVALID_POLICY_DEFINITIONS"},iF={message:"existing policyType",code:"ERR_EXISTING_POLICY_TYPE"},Xwe={message:"Policy not attached",code:"ERR_FAILURE_POLICY_NOT_ATTACHED"},Jf={message:"Policy not found",code:"ERR_NOT_FOUND_POLICY"},Jwe={message:"Missing scoring policy / matchUpFormats",code:"ERR_MISSING_POLICY_SCORING_MATCHUP_FORMATS"},rF={message:"Invalid sideNumber",code:"ERR_INVALID_SIDE_NUMBER"},Qwe={message:"Invalid setNumber",code:"ERR_INVALID_SET_NUMBER"},lP={message:"Missing setObject",code:"ERR_MISSING_SET_ATTRIBUTE"},Zwe={message:"Missing setNumber",code:"ERR_MISSING_SET_NUMBER"},eUe={message:"Missing sideNumber",code:"ERR_MISSING_SIDE_NUMBER"},vh={message:"Missing courtId",code:"ERR_MISSING_COURT_ID"},Je={message:"Missing value",code:"ERR_MISSING_VALUE"},a9={message:"Missing birthdate",code:"ERR_MISSING_BIRTH_DATE"},o9={message:"Missing date",code:"ERR_MISSING_DATE"},s9={message:"No valid dates",code:"ERR_NO_VALID_DATES"},JS={message:"Invalid bookings",code:"ERR_INVALID_BOOKINGS"},YU={message:"Invalid dateAvailability",code:"ERR_INVALID_DATE_AVAILABILITY"},l9={message:"Missing dateAvailability",code:"ERR_MISSING_DATE_AVAILABILITY"},Fr={message:"Invalid Date",code:"ERR_INVALID_DATE"},Ao={message:"Invalid time",code:"ERR_INVALID_TIME"},u9={message:"Invalid tournament dates",code:"ERR_INVALID_DATES_TOURNAMENT"},lM={message:"Invalid game scores",code:"ERR_INVALID_SCORES_GAME"},c9={message:"Invalid score",code:"ERR_INVALID_SCORE"},uP={message:"Invalid winningSide",code:"ERR_INVALID_WINNING_SIDE"},tUe={message:"No participants generated",code:"ERR_NO_PARTICIPANTS_GENERATED"},nF={message:"Cannot modify tieFormat",code:"ERR_UNCHANGED_CANNOT_MODIFY_TIEFORMAT"},d9={message:"Cannot modify participantType",code:"ERR_UNCHANGED_CANNOT_MODIFY_PARTICIPANT_TYPE"},cP={message:"Cannot remove participants",code:"ERR_UNCHANGED_CANNOT_REMOVE_PARTICIPANTS"},uM={message:"Participant category mismatch",code:"ERR_CATEGORY_MISMATCH"},dP={message:"Cannot change winningSide",code:"ERR_UNCHANGED_CANNOT_CHANGE_WINNING_SIDE"},Ih={message:"Invalid participant",code:"ERR_INVALID_PARTICIPANT"},Ms={message:"Invalid participantId",code:"ERR_INVALID_PARTICIPANT_ID"},ya={message:"Invalid participantIds",code:"ERR_INVALID_PARTICIPANT_IDS"},p9={message:"Invalid participantRole",code:"ERR_INVALID_PARTICIPANT_ROLE"},Ns={message:"Invalid participantType",code:"ERR_INVALID_PARTICIPANT_TYPE"},m9={message:"Missing participantRole",code:"ERR_MISSING_PARTICIPANT_ROLE"},yh={message:"Missing participant",code:"ERR_MISSING_PARTICIPANT"},Xb={message:"Missing participants",code:"ERR_MISSING_PARTICIPANTS"},hr={message:"Missing participantId",code:"ERR_MISSING_PARTICIPANT_ID"},Wi={message:"Participant Not Found",code:"ERR_NOT_FOUND_PARTICIPANT"},h9={message:"participantId exists",code:"ERR_EXISTING_PARTICIPANT_ID"},iUe={message:"participant pair exists",code:"ERR_EXISTING_PARTICIPANT_PAIR"},f9={message:"No participant removed",code:"ERR_UNCHANGED_NO_PARTICIPANT_REMOVED"},Qc={message:"Missing participantIds",code:"ERR_MISSING_PARTICIPANT_IDS"},g9={message:"Missing participantsCount",code:"ERR_MISSING_PARTICIPANT_COUNT"},v9={message:"Participant not checked in",code:"ERR_UNCHANGED_PARTICIPANT_NOT_CHECKED_IN"},I9={message:"Missing person details",code:"ERR_MISSING_PERSON_DETAILS"},uv={message:"Existing participant drawPosition assignment",code:"ERR_EXISTING_PARTICIPANT_DRAW_POSITION_ASSIGNMENT"},pP={message:"Existing participant",code:"ERR_EXISTING_PARTICIPANT"},aF={message:"participantsCount exceeds drawSize",code:"ERR_INVALID_PARTICIPANT_COUNT"},cM={message:"Invalid entry status",code:"ERR_INVALID_ENTRY_STATUS"},y9={message:"Participant Entry Not Found",code:"ERR_NOT_FOUND_PARTICIPANT_ENTRY"},rUe={message:"Participant not entered in stage",code:"ERR_UNCHANGED_PARTICIPANT_NOT_ENTERED"},nUe={message:"Participant not found in stageSequence",code:"ERR_NOT_FOUND_PARTICIPANT_IN_STAGE"},b9={message:"entryStatus not allowed in stage",code:"ERR_INVALID_ENTRY_STATUS_IN_STAGE"},w9={message:"entryStatus not allowed for event",code:"ERR_INVALID_ENTRY_STATUS_IN_EVENT"},dM={message:"No stage space available for entryStatus",code:"ERR_UNCHANGED_NO_AVAILABLE_STAGE_SPACE"},U9={message:"Insufficient drawPositions to accommodate qualifiers",code:"ERR_UNCHANGED_NO_DRAW_POSITIONS_FOR_QUALIFIERS"},oF={message:"Insufficient drawPositions to accommodate entries",code:"ERR_INSUFFICIENT_DRAW_POSITIONS"},S9={message:"Missing penaltyType",code:"ERR_MISSING_PENALTY_TYPE"},sF={message:"Missing penaltyId",code:"ERR_MISSING_PENALTY_ID"},Qf={message:"Penalty not found",code:"ERR_NOT_FOUND_PENALTY"},T9={message:"Missing courtsCount/courtNames",code:"ERR_MISSING_COURTS_INFO"},cv={message:"Court not found",code:"ERR_NOT_FOUND_COURT"},D9={message:"Court exists",code:"ERR_EXISTING_COURT"},P9={message:"Venue exists",code:"ERR_EXISTING_VENUE"},bh={message:"Venue not found",code:"ERR_NOT_FOUND_VENUE"},Zc={message:"Missing venueId",code:"ERR_MISSING_VENUE_ID"},R9={message:"Invalid endTime",code:"ERR_INVALID_END_TIME"},lF={message:"Existing endTime",code:"ERR_EXISTING_END_TIME"},E9={message:"Invalid stopTime",code:"ERR_INVALID_STOP_TIME"},C9={message:"Invalid startTime",code:"ERR_INVALID_START_TIME"},aUe={message:"Invalid resumeTime",code:"ERR_INVALID_RESUME_TIME"},uF={message:"Invalid timeItem",code:"ERR_INVALID_TIME_ITEMS"},M9={message:"Missing async state provider",code:"ERR_MISSING_ASYNC_STATE_PROVIDER"},cF={message:"Missing timeItem",code:"ERR_MISSING_TIME_ITEM"},dF={message:"Missing timeItems",code:"ERR_MISSING_TIME_ITEMS"},mP={message:"Missing context",code:"ERR_MISSING_CONTEXT"},N9={message:"Missing schedule",code:"ERR_MISSING_SCHEDULE"},Mm={message:"Invalid scaleItem",code:"ERR_INVALID_SCALE_ITEM"},A9={message:"Modifications failed",code:"ERR_FAILURE_MODIFICATIONS"},dv={message:"No modifications applied",code:"ERR_UNCHANGED_NO_MODIFICATIONS_APPLIED"},O9={message:"Unable to assign court",code:"ERR_UNCHANGED_COURT_NOT_ASSIGNED"},hP={message:"No Candidates",code:"ERR_UNCHANGED_NO_CANDIDATES"},k9={message:"Invalid configuration",code:"ERR_INVALID_CONFIG"},x9={message:"Invalid collectionDefinition",code:"ERR_INVALID_COLLECTION_DEFINITION"},Qu={message:"Invalid object",code:"ERR_INVALID_OBJECT"},tI={message:"Invalid gender",code:"ERR_INVALID_GENDER"},KI={message:"Invalid category",code:"ERR_INVALID_CATEGORY"},se={message:"Invalid values",code:"ERR_INVALID_VALUES"},F9={message:"Duplicate value",code:"ERR_DUPLICATE_VALUE"},pF={message:"Team not found",code:"ERR_NOT_FOUND_TEAM"},L9={message:"No valid actions",code:"ERR_NO_VALID_ACTIONS"},fP={message:"No valid attributes",code:"ERR_NO_VALID_ATTRIBUTES"},mF={message:"Value unchanged",code:"ABORT_UNCHANGED"},jr={message:"Not found",code:"ERR_NOT_FOUND"},gP={message:"Not implemented",code:"ERR_NOT_IMPLEMENTED"},_9={message:"Existing flight",code:"ERR_EXISTING_FLIGHT"},hF={message:"Existing flight profile",code:"ERR_EXISTING_FLIGHT_PROFILE"},$9={message:"Existing outcome",code:"ERR_EXISTING_OUTCOME"},B9={message:"Existing matchUpId",code:"ERR_EXISTING_MATCHUP_ID"},pM={message:"Existing stage",code:"ERR_EXISTING_STAGE"},fF={message:"Existing structure",code:"ERR_EXISTING_STRUCTURE"},vP={message:"Method not found",code:"ERR_NOT_FOUND_METHOD"},V9={message:"Scheduled matchUps",code:"ERR_SCHEDULED_MATCHUPS"},IP={message:"Scores present",code:"ERR_SCORES_PRESENT"},oUe={ANACHRONISM:nM,CANNOT_CHANGE_WINNING_SIDE:dP,CANNOT_MODIFY_TIEFORMAT:nF,CANNOT_MODIFY_PARTICIPANT_TYPE:d9,CANNOT_REMOVE_MAIN_STRUCTURE:xK,CANNOT_REMOVE_PARTICIPANTS:cP,CATEGORY_MISMATCH:uM,COURT_EXISTS:D9,COURT_NOT_FOUND:cv,DRAW_DEFINITION_NOT_FOUND:Va,DRAW_ID_EXISTS:$K,DRAW_POSITION_ACTIVE:aP,DRAW_POSITION_ASSIGNED:Xf,DRAW_POSITION_NOT_CLEARED:_K,DRAW_POSITION_NOT_FOUND:Wwe,DRAW_SIZE_MISMATCH:Yx,DUPLICATE_ENTRY:YI,DUPLICATE_VALUE:F9,ENTRY_STATUS_NOT_ALLOWED_FOR_EVENT:w9,ENTRY_STATUS_NOT_ALLOWED_IN_STAGE:b9,EVENT_EXISTS:KK,EVENT_NOT_FOUND:mo,EXISTING_DRAW_DEFINITIONS:FK,EXISTING_END_TIME:lF,EXISTING_FLIGHT:_9,EXISTING_MATCHUP_ID:B9,EXISTING_OUTCOME:$9,EXISTING_PARTICIPANT_DRAW_POSITION_ASSIGNMENT:uv,EXISTING_PARTICIPANT:pP,EXISTING_POLICY_TYPE:iF,EXISTING_PROFILE:hF,EXISTING_ROUND:qK,EXISTING_STAGE:pM,EXISTING_STRUCTURE:fF,INCOMPATIBLE_MATCHUP_STATUS:qU,INCOMPLETE_SOURCE_STRUCTURE:Hx,INSUFFICIENT_DRAW_POSITIONS:oF,INVALID_ACTION:GK,INVALID_ASSIGNMENT:oM,INVALID_BOOKINGS:JS,INVALID_CATEGORY:KI,INVALID_COLLECTION_DEFINITION:x9,INVALID_CONFIGURATION:k9,INVALID_DATE_AVAILABILITY:YU,INVALID_DATE:Fr,INVALID_DRAW_DEFINITION:sm,INVALID_DRAW_POSITION_FOR_SEEDING:zx,INVALID_DRAW_POSITION:av,INVALID_DRAW_SIZE:oP,INVALID_END_TIME:R9,INVALID_ENTRIES:JK,INVALID_EVENT_TYPE:Wl,INVALID_GAME_SCORES:lM,INVALID_GENDER:tI,INVALID_MATCHUP_FORMAT:Qx,INVALID_MATCHUP_STATUS:sv,INVALID_MATCHUP_STATUS_BYE:t9,INVALID_MATCHUP:la,INVALID_OBJECT:Qu,INVALID_PARTICIPANT_ID:Ms,INVALID_PARTICIPANT_IDS:ya,INVALID_PARTICIPANT_ROLE:p9,INVALID_PARTICIPANT_SEEDING:BK,INVALID_PARTICIPANT_TYPE:Ns,INVALID_PARTICIPANT:Ih,INVALID_POLICY_DEFINITION:n9,INVALID_RECORDS:aM,INVALID_SCALE_ITEM:Mm,INVALID_SEED_NUMBER:zK,INVALID_SEED_POSITION:WK,INVALID_SET_NUMBER:Qwe,INVALID_SIDE_NUMBER:rF,INVALID_SCORE:c9,INVALID_STAGE:Dp,INVALID_START_TIME:C9,INVALID_STRUCTURE:Sp,INVALID_STOP_TIME:E9,INVALID_TIE_FORMAT:kl,INVALID_TIME:Ao,INVALID_TIME_ITEM:uF,INVALID_TOURNAMENT_DATES:u9,INVALID_TOURNAMENT_RECORD:Wb,INVALID_VALUES:se,INVALID_WINNING_SIDE:uP,MATCHUP_NOT_FOUND:hn,METHOD_NOT_FOUND:vP,MISSING_ASSIGNMENTS:Jx,MISSING_ASYNC_STATE_PROVIDER:M9,MISSING_AVOIDANCE_POLICY:r9,MISSING_BIRTH_DATE:a9,MISSING_COLLECTION_DEFINITION:i9,MISSING_COURT_ID:vh,MISSING_COURTS_INFO:T9,MISSING_DATE_AVAILABILITY:l9,MISSING_DATE:o9,MISSING_DRAW_DEFINITION:$e,MISSING_DRAW_ID:Fs,MISSING_DRAW_POSITION:ov,MISSING_DRAW_POSITIONS:qb,MISSING_DRAW_SIZE:Yb,MISSING_ENTRIES:XK,MISSING_EVENT:vi,MISSING_MATCHUP_FORMAT:Zx,MISSING_MATCHUP_ID:bn,MISSING_MATCHUP_IDS:gh,MISSING_MATCHUP:sa,MISSING_MATCHUPS:Ju,MISSING_PARTICIPANT_COUNT:g9,MISSING_PARTICIPANT_ID:hr,MISSING_PARTICIPANT_IDS:Qc,MISSING_PARTICIPANT_ROLE:m9,MISSING_PARTICIPANT:yh,MISSING_PARTICIPANTS:Xb,MISSING_PENALTY_ID:sF,MISSING_PENALTY_TYPE:S9,MISSING_PERSON_DETAILS:I9,MISSING_POLICY_ATTRIBUTES:tF,MISSING_POLICY_DEFINITION:sP,MISSING_POLICY_TYPE:eF,MISSING_POSITION_ASSIGNMENTS:e9,MISSING_ROUND_NUMBER:Ywe,MISSING_SCHEDULE:N9,MISSING_SCORING_POLICY:Jwe,MISSING_SEED_ASSIGNMENTS:HK,MISSING_SEEDCOUNT_THRESHOLDS:jK,MISSING_SEEDING_POLICY:Kwe,MISSING_SET_NUMBER:Zwe,MISSING_SET_OBJECT:lP,MISSING_SIDE_NUMBER:eUe,MISSING_STAGE:QK,MISSING_STRUCTURE_ID:Xa,MISSING_STRUCTURE:Tp,MISSING_STRUCTURES:Xx,MISSING_TARGET_LINK:Kx,MISSING_TIE_FORMAT:lv,MISSING_TIME_ITEM:cF,MISSING_TIME_ITEMS:dF,MISSING_TOURNAMENT_ID:Kf,MISSING_TOURNAMENT_RECORD:ve,MISSING_TOURNAMENT_RECORDS:xi,MISSING_VALUE:Je,MISSING_VENUE_ID:Zc,MODIFICATIONS_FAILED:A9,NO_CANDIDATES:hP,NO_DRAW_POSITIONS_AVAILABLE_FOR_QUALIFIERS:U9,NO_MODIFICATIONS_APPLIED:dv,NO_STAGE_SPACE_AVAILABLE_FOR_ENTRY_STATUS:dM,NO_PARTICIPANT_REMOVED:f9,NO_VALID_ACTIONS:L9,NO_VALID_ATTRIBUTES:fP,NO_VALID_DATES:s9,NOT_FOUND:jr,NOT_IMPLEMENTED:gP,PARTICIPANT_COUNT_EXCEEDS_DRAW_SIZE:aF,PARTICIPANT_ID_EXISTS:h9,PARTICIPANT_NOT_CHECKED_IN:v9,PARTICIPANT_NOT_FOUND:Wi,PARTICIPANT_PAIR_EXISTS:iUe,PENALTY_NOT_FOUND:Qf,POLICY_NOT_ATTACHED:Xwe,POLICY_NOT_FOUND:Jf,SCHEDULE_NOT_CLEARED:LK,SCHEDULED_MATCHUPS:V9,SCORES_PRESENT:IP,SEEDSCOUNT_GREATER_THAN_DRAW_SIZE:VK,STAGE_SEQUENCE_LIMIT:ZK,STRUCTURE_NOT_FOUND:Ai,TEAM_NOT_FOUND:pF,UNABLE_TO_ASSIGN_COURT:O9,UNLINKED_STRUCTURES:YK,UNRECOGNIZED_DRAW_TYPE:Wx,UNRECOGNIZED_MATCHUP_FORMAT:Kb,UNRECOGNIZED_MATCHUP_STATUS:sM,VALUE_UNCHANGED:mF,VENUE_EXISTS:P9},Ri={disableNotifications:!1,tournamentId:void 0,tournamentRecords:{},subscriptions:{},modified:!1,methods:{},notices:[]},j9={addNotice:IUe,callListener:SUe,cycleMutationStatus:vUe,deleteNotice:wUe,deleteNotices:bUe,disableNotifications:sUe,enableNotifications:lUe,getMethods:gF,getNotices:yUe,getTopics:UUe,getTournamentId:G9,getTournamentRecord:uUe,getTournamentRecords:cUe,removeTournamentRecord:hUe,setMethods:gUe,setSubscriptions:fUe,setTournamentId:pUe,setTournamentRecord:dUe,setTournamentRecords:mUe,handleCaughtError:TUe};function sUe(){Ri.disableNotifications=!0}function lUe(){Ri.disableNotifications=!1}function G9(){return Ri.tournamentId}function uUe(t){return Ri.tournamentRecords[t]}function cUe(){return Ri.tournamentRecords}function dUe(t){let e=t==null?void 0:t.tournamentId;return e?(Ri.tournamentRecords[e]=t,{success:!0}):{error:Wb}}function pUe(t){return t?Ri.tournamentRecords[t]?(Ri.tournamentId=t,{success:!0}):{error:ve}:(Ri.tournamentId=void 0,{success:!0})}function mUe(t){Ri.tournamentRecords=t;let e=Object.keys(t);e.length===1?Ri.tournamentId=e[0]:e.length||(Ri.tournamentId=void 0)}function hUe(t){if(typeof t!="string")return{error:se};if(!Ri.tournamentRecords[t])return{error:jr};delete Ri.tournamentRecords[t];let e=Object.keys(Ri.tournamentRecords);return e.length===1?Ri.tournamentId=e[0]:e.length||(Ri.tournamentId=void 0),{success:!0}}function fUe(t){return typeof t.subscriptions!="object"?{error:se}:(Object.keys(t.subscriptions).forEach(e=>{typeof t.subscriptions[e]=="function"?Ri.subscriptions[e]=t.subscriptions[e]:delete Ri.subscriptions[e]}),{...Q})}function gUe(t){return typeof t!="object"?{error:se}:(Object.keys(t).forEach(e=>{typeof t[e]=="function"&&(Ri.methods[e]=t[e])}),{...Q})}function vUe(){let t=Ri.modified;return Ri.modified=!1,t}function IUe({topic:t,payload:e,key:i},r){if(!(typeof t!="string"||typeof e!="object")&&(Ri.disableNotifications||(Ri.modified=!0),!(Ri.disableNotifications||!Ri.subscriptions[t]&&!r)))return i&&(Ri.notices=Ri.notices.filter(n=>!(n.topic===t&&n.key===i))),Ri.notices.push({topic:t,payload:e,key:i}),{...Q}}function gF(){return Ri.methods??{}}function yUe({topic:t}){return Ri.notices.filter(e=>e.topic===t).map(e=>e.payload)}function bUe(){Ri.notices=[]}function wUe({topic:t,key:e}){Ri.notices=Ri.notices.filter(i=>(!t||i.topic===t)&&i.key!==e)}function UUe(){return{topics:Object.keys(Ri.subscriptions)}}function SUe({topic:t,notices:e},i){let r=Ri.subscriptions[t];r&&typeof r=="function"&&r(e);let n=i==null?void 0:i[t];n&&typeof n=="function"&&n(e)}function TUe({engineName:t,methodName:e,params:i,err:r}){let n;return typeof r=="string"?n=r.toUpperCase():r instanceof Error&&(n=r.message),console.log("ERROR",{tournamentId:G9(),params:JSON.stringify(i),engine:t,methodName:e,error:n}),{error:n}}var ai={timers:{default:{elapsedTime:0}},globalSubscriptions:{},deepCopyAttributes:{stringify:[],ignore:[],toJSON:[]},globalMethods:[],deepCopy:!0},Gr=j9,h2=["addNotice","callListener","cycleMutationStatus","deleteNotice","deleteNotices","disableNotifications","enableNotifications","getMethods","getNotices","getTopics","getTournamentId","getTournamentRecord","getTournamentRecords","removeTournamentRecord","setSubscriptions","setTournamentId","setTournamentRecord","setTournamentRecords"];function DUe(t){if(typeof t!="object")throw new Error("Global state provider can not be undefined or null");if(ji(Object.keys(t),h2).length!==h2.length)throw new Error("Global state provider is missing required methods");return Gr=t,{success:!0}}function PUe(){if(Gr.createInstanceState){try{Gr.createInstanceState()}catch(t){return{error:t}}return{success:!0}}else return{error:M9}}function ja(t){return!t||typeof t!="object"?ai.devContext??!1:typeof ai.devContext!="object"?!1:Object.keys(t).every(e=>{var i;return((i=ai.devContext)==null?void 0:i[e])===t[e]})&&ai.devContext}function RUe(t="reset",e="default"){var i,r;let n=Date.now();if(t==="report"){if(e==="allTimers")return Object.keys(ai.timers).filter(a=>a!=="default"||ai.timers[a].startTime).map(a=>{let o=ai.timers[a],s=o.state==="stopped"?0:(n-((o==null?void 0:o.startTime)??0))/1e3,l=o.elapsedTime+s;return{state:ai.timers[a].state,elapsedTime:l.toFixed(2),timer:a}});{let a=ai.timers[e].state==="stopped"?0:(n-(((i=ai.timers[e])==null?void 0:i.startTime)??0))/1e3,o=ai.timers[e].elapsedTime+a;return{state:ai.timers[e].state,elapsedTime:o.toFixed(2),timer:e}}}if(!ai.timers[e]||t==="reset"){if(e==="allTimers")return ai.timers={default:{elapsedTime:0}},!0;ai.timers[e]={startTime:n,state:"active",elapsedTime:0}}return ai.timers[e].elapsedTime||(ai.timers[e].elapsedTime=0),t==="stop"&&ai.timers[e].state!=="stopped"&&(ai.timers[e].state="stopped")&&(ai.timers[e].elapsedTime+=(n-(((r=ai.timers[e])==null?void 0:r.startTime)??0))/1e3),t==="start"&&(ai.timers[e].startTime=n)&&(ai.timers[e].state="active"),ai.timers[e]}function H9(t){ha(t)?ai.globalLog=t:delete ai.globalLog}function XI(t){ai.devContext=t}function z9(){Gr.disableNotifications()}function KU(){Gr.enableNotifications()}function JI(t,e){typeof t=="boolean"&&(ai.deepCopy=t),typeof e=="object"&&(Array.isArray(e.ignore)&&(ai.deepCopyAttributes.ignore=e.ignore),Array.isArray(e.toJSON)&&(ai.deepCopyAttributes.toJSON=e.toJSON),Array.isArray(e.stringify)&&(ai.deepCopyAttributes.stringify=e.stringify),e.threshold&&(ai.deepCopyAttributes.threshold=e.threshold))}function vF(){return{enabled:ai.deepCopy,...ai.deepCopyAttributes}}function EUe(t){return t!=null&&t.subscriptions?(Object.keys(t.subscriptions).forEach(e=>{ai.globalSubscriptions[e]=t.subscriptions[e]}),{...Q}):{error:Je,info:"missing subscriptions"}}function CUe(t){return t!=null&&t.subscriptions?Gr.setSubscriptions({subscriptions:t.subscriptions}):{error:Je,info:"missing subscriptions"}}function W9(t){return t?typeof t!="object"?{error:se}:(Object.keys(t).forEach(e=>{ha(t[e])&&(ai.globalMethods[e]=t[e])}),{...Q}):{error:Je,info:"missing method declarations"}}function q9(t){return t?typeof t!="object"?{error:se}:Gr.setMethods(t):{error:Je,info:"missing method declarations"}}function IF(){return Gr.cycleMutationStatus()}function ut(t){if(typeof(t==null?void 0:t.topic)!="string")return;let e=ai.globalSubscriptions[t.topic];return Gr.addNotice(t,e)}function Y9(){return{...ai.globalMethods,...Gr.getMethods()}}function K9(t){return Gr.getNotices(t)}function yF({key:t,topic:e}){return Gr.deleteNotice({key:t,topic:e})}function Jb(){return Gr.deleteNotices()}function So(){return Gr.getTopics()}function yP(t){var e,i;return(i=(e=So())==null?void 0:e.topics)==null?void 0:i.includes(t)}async function mM(t){return Gr.callListener(t,ai.globalSubscriptions)}function wh(){return Gr.getTournamentId()}function bF(t){return Gr.getTournamentRecord(t)}function Uh(){return Gr.getTournamentRecords()}function X9(t){return Gr.setTournamentRecord(t)}function bP(t){return Gr.setTournamentRecords(t)}function QI(t){return Gr.setTournamentId(t)}function J9(t){return Gr.removeTournamentRecord(t)}function hM(){return Gr}function wP({engineName:t,methodName:e,params:i,err:r}){let n=ha(Gr.handleCaughtError)&&Gr.handleCaughtError||j9.handleCaughtError,{tournamentRecord:a,...o}=i;return n({params:o,engineName:t,methodName:e,err:r})}function Q9(t,e){if(ai.globalLog)try{ai.globalLog({log:t,engine:e})}catch(i){console.log("globalLog error",i),console.log(e,t),H9()}else console.log(e,t)}function Z9(t,e,i,r){if(!At(t))return{error:se};_i||(i=1);let n=Array.isArray(e)?e:[],a={},o=(s,l=0)=>{Object.keys(s).forEach(u=>{ha(s[u])?a[u]=s[u]:At(s[u])&&(e===!0||n!=null&&n.includes(u))&&(i===void 0||l<i)&&o(s[u],l+1)})};return o(t),r?W9(a):q9(a),{methods:a}}function MUe(t,e,i){return Object.keys(t).filter(r=>!e.includes(t[r])&&(!i||(Array.isArray(t[r])?t[r].length:!0)))}function He(t,e,i,r){var n;if(typeof t!="object"||t===null)return t;(n=vF())!=null&&n.enabled||(r=!0);let a=["",void 0,null];e&&a.push(!1);let o=MUe(t,a,i);return Object.assign({},...o.map(s=>Array.isArray(t[s])?{[s]:r?t[s]:t[s].map(l=>He(l))}:{[s]:r?t[s]:He(t[s])}))}function te({context:t,result:e,stack:i,info:r}){return e&&!Array.isArray(e==null?void 0:e.stack)&&(e.stack=[]),e&&Array.isArray(e==null?void 0:e.stack)&&typeof i=="string"&&e.stack.push(i),e&&r&&(e.info=r),e&&typeof t=="object"&&Object.keys(t).length&&Object.assign(e,He(t)),e&&!(e!=null&&e.error)&&!(e!=null&&e.success)&&Object.assign(e,{...Q}),e??{success:!0}}var As="ANY",Qt="MALE",jn="MIXED",Td="OTHER",mi="FEMALE",wF={ANY:As,MALE:Qt,FEMALE:mi,MIXED:jn,OTHER:Td},NUe="MIXED events can not contain mixed singles or { gender: ANY } collections",AUe="events with { gender: ANY } can not contain MIXED singles collections";function UP(t){let e="tieFormatGenderValidityCheck",{referenceGender:i,matchUpType:r,gender:n}=t;return i&&n&&[Qt,mi].includes(i)&&i!==n?te({result:{valid:!1,error:tI},context:{gender:n},stack:e}):i===jn&&(n===As||n===jn&&r!==ei)?te({result:{error:tI,valid:!1},info:NUe,stack:e}):i===As&&n===jn&&r!==ei?te({result:{error:tI,valid:!1},info:AUe,stack:e}):{valid:!0}}var OUe="normal",f2="timed",kUe="final",UF="NOAD",XU="SET",xUe={S:OUe,F:kUe};function SP(t,e){if((t!=null&&t.bestOf||t!=null&&t.exactly)&&t!=null&&t.setFormat)return FUe(t,e)}function ZI(t){return!isNaN(Number(t))&&Number(t)}function e8(t){let e=`T${t.minutes}`;return t.based&&(e+=t.based),t.modifier&&(e+=`@${t.modifier}`),e}function FUe(t,e){var i;let r=ZI(t.bestOf)||void 0,n=ZI(t.exactly)||void 0,a=r||n;if((i=t.setFormat)!=null&&i.timed&&t.simplified&&a===1)return e8(t.setFormat);let o=a&&`${XU}${a}`||"",s=g2(t.setFormat,e),l=s&&`S:${s}`||"",u=g2(t.finalSetFormat,e),c=a&&a>1&&u&&s!==u&&`F:${u}`||"";if(o&&s)return[o,l,c].filter(d=>d).join("-")}function g2(t,e){if(typeof t=="object"&&Object.keys(t).length){if(t.timed)return e8(t);if(t.tiebreakSet)return v2(t.tiebreakSet);let i=ZI(t.setTo);if(i){let r=t.NoAD&&UF||"",n=v2(t.tiebreakFormat),a=n&&`/${n}`||"",o=ZI(t.tiebreakAt),s=o&&(o!==i||e)&&`@${o}`||"";if(n!==!1)return`${i}${r}${a}${s}`}}}function v2(t){if(t){if(typeof t=="object"&&!t.tiebreakTo)return"";if(typeof t=="object"&&ZI(t.tiebreakTo)){let e=`TB${t.tiebreakTo}${t.NoAD?UF:""}`;return t.modifier&&(e+=`@${t.modifier}`),e}else return!1}}function Ln(t){if(Di(t)){let e=t.startsWith("T")&&f2||t.startsWith(XU)&&XU||"";if(e===f2){let i=i8(t),r={simplified:!0,setFormat:i,bestOf:1};if(i)return r}if(e===XU)return LUe(t)}}function LUe(t){let e=t.split("-"),i=Qb(e[0].slice(3)),r=i===1||i%2!==0?i:void 0,n=i!==1&&i%2===0?i:void 0,a=e&&I2(e[1]),o=e&&I2(e[2]),s=a&&a.timed||o&&o.timed,l=r&&r<6||s&&n,u=!e[2]||o,c=a,d=He({setFormat:a,exactly:n,bestOf:r});if(o&&(d.finalSetFormat=o),l&&c&&u)return d}function I2(t){if((t==null?void 0:t[1])===":"){let e=t.split(":"),i=xUe[e[0]],r=e[1];if(i&&r){if(r.startsWith("TB")){let h=y2(r);return h===!1?!1:typeof h=="object"?{tiebreakSet:h}:void 0}if(r.startsWith("T"))return i8(r);let n=t.match(/^[FS]:(\d+)([A-Za-z]*)/),a=n&&r8(n[2])||!1,o=!(n!=null&&n[2])||a,s=n?Qb(n[1]):void 0,l=t8(r),u=l!==!1,c=u&&l||s,d=y2(r.split("/")[1]),p=d!==!1,m={setTo:s};return a&&(m.NoAD=!0),d?(m.tiebreakFormat=d,m.tiebreakAt=c):m.noTiebreak=!0,s&&o&&p&&u&&m||!1}}}function t8(t,e=!0){let i=(t==null?void 0:t.indexOf("@"))>0&&t.split("@");if(i)return(e?Qb(i[1]):i[1])||!1}function y2(t){if(t)if(t.startsWith("TB")){let e=t8(t,!1),i=t.match(/^TB(\d+)([A-Za-z]*)/),r=i==null?void 0:i[1],n=i&&r8(i[2]),a=!(i!=null&&i[2])||n,o=Qb(r);if(o&&a){let s={tiebreakTo:o};return e&&typeof e=="string"&&!st(e)&&(s.modifier=e),n&&(s.NoAD=!0),s}else return!1}else return!1}function i8(t){var e;let i=t.slice(1),r=i.match(/^(\d+)(@?[A-Za-z]*)/),n=Qb(r==null?void 0:r[1]);if(!n)return;let a={timed:!0,minutes:n},o=r==null?void 0:r[2],s=[void 0,"P","G"].includes(o);if(o&&!s){let l=(e=i.match(/^(\d+)(@)([A-Za-z]+)$/))==null?void 0:e[3];return l?(a.modifier=l,a):void 0}return o&&(a.based=r[2]),a}function r8(t){return t&&t.indexOf(UF)>=0}function Qb(t){return isNaN(Number(t))?0:Number(t)}function Ra({matchUpFormat:t}){if(!Di(t)||t==="")return!1;let e=Ln(t),i=t.match(/-S:([1-9])+\/TB([0-9]{1,2})@?([1-9]?)*/),r=i==null?void 0:i[1],n=i==null?void 0:i[2],a=i==null?void 0:i[3],o=t.match(/-F:([1-9])+\/TB([0-9]{1,2})@?([1-9]?)*/),s=o==null?void 0:o[1],l=o==null?void 0:o[2],u=o==null?void 0:o[3];return SP(e,!!(i&&n&&r===a||o&&l&&s===u))===t}var QS=/^[\d]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][\d]|3[0-1])$/,n8=/^((0[\d]|1[\d]|2[0-3]):[0-5][\d](:[0-5][\d])?)([.,][0-9]{3})?$/,ol=/^([\d]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][\d]|3[0-1]))([ T](0[\d]|1[\d]|2[0-3]):[0-5][\d](:[0-5][\d])?)?([.,][\d]{3})?Z?$/,Dd=/^([\d]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][\d]|3[0-1]))?([ T]?(0[\d]|1[\d]|2[0-3]):[0-5][\d](:[0-5][\d])?)?([.,][\d]{3})?Z?$/;function ZS(t){let{scheduledDate:e}=t;if(!e&&t.scheduledTime&&(e=mt(t.scheduledTime)),!e)return;let i=Ui(t.scheduledTime),r=mt(e);return r&&i&&(r+=`T${i}`),r}function _Ue(t){return typeof t!="object"||Array.isArray(t)?!1:Object.prototype.toString.call(t)==="[object Date]"}function pv(t){let e=typeof t=="string"?t==null?void 0:t.split(" "):[];return t&&(e==null?void 0:e.length)>1&&!["AM","PM"].includes(e[1].toUpperCase())?!1:!!(!t||Dd.test(Sh(t,!0,!0)))}function ba(t){return qd(t)||QS.test(t)}function $Ue(t){let e=new Date(t),i=e.getSeconds()+60*e.getMinutes()+60*60*e.getHours();return BUe(i,{displaySeconds:!1})}function BUe(t,e){let i=parseInt(t,10),r=Math.floor(i/3600),n=Math.floor((i-r*3600)/60),a=i-r*3600-n*60;return(!e||e!=null&&e.displaySeconds?r+":"+n+":"+a:r+":"+n).split(":").map(oo).join(":")}var SF=t=>{let e=ey(t)||qd(t)?new Date(t):new Date,i=e.getUTCMonth()+1,r=i<10?`0${i}`:`${i}`;return`${e.getUTCFullYear()}-${oo(r)}-${oo(e.getUTCDate())}`};function VUe(t){let e=ey(t)||qd(t)?new Date(t):new Date;return Date.UTC(e.getFullYear(),e.getMonth(),e.getDate())}function Ho(t,e="-",i="YMD"){if(!t)return"";typeof t=="string"&&t.indexOf("T")<0&&(t=t+"T00:00");let r=new Date(t),n=""+(r.getMonth()+1),a=""+r.getDate(),o=r.getFullYear();return n.length<2&&(n="0"+n),a.length<2&&(a="0"+a),i==="DMY"?[a,n,o].join(e):i==="MDY"?[n,a,o].join(e):i==="YDM"?[o,a,n].join(e):i==="DYM"?[a,o,n].join(e):i==="MYD"?[n,o,a].join(e):[o,n,a].join(e)}function e0(t){let e=t?new Date(t):new Date,i=e.getTimezoneOffset();return new Date(e.getTime()-i*60*1e3)}function jUe(t){return e0(t).getTime()}function ey(t){if(typeof t=="boolean")return!1;let e=t instanceof Date&&t||!isNaN(t)&&new Date(t)||!1;return e&&!isNaN(e.valueOf())}function Zf(t,e){if(!ba(t)||!ba(e))return[];let i=mt(t)+"T00:00",r=mt(e)+"T00:00",n=new Date(i),a=new Date(r),o=ey(a)&&ey(n)&&u(n,a),s=[],l=0;if(o){let c=n,d=c.getTime();for(;d<=a.getTime()&&l<300;)l+=1,s.push(new Date(c)),d=c.setDate(c.getDate()+1)}return s.map(c=>Ho(c));function u(c,d){return c<=d}}var GUe=/^([+-]?\d{4}(?!\d{2}\b))((-?)((0[1-9]|1[0-2])(\3([12]\d|0[1-9]|3[01]))?|W([0-4]\d|5[0-2])(-?[1-7])?|(00[1-9]|0[1-9]\d|[12]\d{2}|3([0-5]\d|6[1-6])))([T\s]((([01]\d|2[0-3])((:?)[0-5]\d)?|24:?00)([.,]\d+(?!:))?)?(\17[0-5]\d([.,]\d+)?)?([zZ]|([+-])([01]\d|2[0-3]):?([0-5]\d)?)?)?)?$/;function qd(t){return typeof t!="string"?!1:GUe.test(t)}function TF(t){if(typeof t!="string")return!1;let e=t.split("Z")[0].split(":"),i=e.every(r=>!isNaN(parseInt(r)));return!(e.length<2||!i||parseInt(e[0])>23||parseInt(e[1])>60)}function xt(t){let e=Ui(t);if(!e)return 0;let[i,r]=e.split(":").map(n=>parseInt(n));return i*60+r}function HUe(t){let e=Math.floor(t/60),i=t-e*60;return e>23&&(e=e%24),[oo(e),oo(i)].join(":")}function t0(t){return TF(t)?t.split(":").slice(0,2).map(oo).join(":"):void 0}function Ui(t){return qd(t)&&t.indexOf("T")>0?t0(t.split("T").reverse()[0]):t0(t)}function mt(t){return qd(t)||ol.test(t)?t.split("T")[0]:void 0}function Hv(t,e){let i=new Date(t);return i.setDate(i.getDate()+e),mt(i.toISOString())}function i0(t){t=typeof t!="string"?"00:00":t;let e={},i={};return{0:e.time,1:e.ampm}=t.split(" ")||[],{0:i.hours,1:i.minutes}=e.time.split(":")||[],i.ampm=e.ampm,isNaN(i.hours)||isNaN(i.minutes)||i.ampm&&!["AM","PM"].includes(i.ampm.toUpperCase())?{}:i}function zUe(t){let e=i0(t);return e.ampm&&e.hours&&(e.ampm.toLowerCase()==="pm"&&parseInt(e.hours)<12&&(e.hours=(e.hours&&parseInt(e.hours)||0)+12),e.ampm.toLowerCase()==="am"&&e.hours==="12"&&(e.hours="00")),`${e.hours||"12"}:${e.minutes||"00"}`.split(":").map(oo).join(":")}function WUe(t){var e;let i=i0(t);if(!(typeof i=="object"&&!Object.keys(i).length))return i.ampm?t:(i.hours>12?(i.hours-=12,i.ampm="PM"):i.hours==="12"?i.ampm="PM":(i.hours==="00"&&(i.hours="12"),i.ampm="AM"),((e=i.hours)==null?void 0:e[0])==="0"&&(i.hours=i.hours.slice(1)),`${i.hours||"12"}:${i.minutes||"00"} ${i.ampm}`)}function Sh(t,e,i){let r=mt(t),n=Ui(t),a=r?n:t;return t?e&&(r&&i&&t||zUe(a))||WUe(a):void 0}function a8(t,e){let i=i0(t),r=i0(e);if(parseInt(i.hours)<parseInt(r.hours))return-1;if(parseInt(i.hours)>parseInt(r.hours))return 1;if(i.hours===r.hours){if(parseInt(i.minutes)<parseInt(r.minutes))return-1;if(parseInt(i.minutes)>parseInt(r.minutes))return 1}return 0}function DF(t,e=7){let i=mt(t)+"T00:00",r=new Date(i),n=new Date(r.setDate(r.getDate()+e));return Ho(n)}function qUe(t){return DF(t)}function YUe(t,e,i,r=!1){let n=new Date(e,0,1+(t-1)*7),a=r?0:1;return n.setDate(n.getDate()+(a-n.getDay())),Ho(n,i)}function KUe(t,e,i){let r=new Date(t,0);return Ho(new Date(r.setDate(e)),i)}function rr(t,e=void 0){let[i,r]=(t||"00:00").split(":").map(oo),n=e0(e).setHours(i,r,0,0);return e0(n)}function Zb(t,e,i=!0){let r=new Date(t),n=(new Date(e).getTime()-r.getTime())/1e3/60;return i?Math.abs(Math.round(n)):Math.round(n)}function ra(t,e){let i=Ui(t);if(!i)return"00:00";let r=isNaN(e)?0:e;return Ui(PF(rr(i),r).toISOString())}function PF(t,e){let i=new Date(t);return new Date(i.getTime()+e*6e4)}function oo(t){return t.toString()[1]?t:"0"+t}function ql(t,e){let i=new Date(t),r=new Date(e);return i.getFullYear()===r.getFullYear()&&i.getMonth()===r.getMonth()&&i.getDate()===r.getDate()}var o8={addDays:DF,addWeek:qUe,addMinutesToTimeString:ra,convertTime:Sh,getIsoDateString:ZS,getUTCdateString:SF,DateHHMM:$Ue,extractDate:mt,extractTime:Ui,formatDate:Ho,getDateByWeek:YUe,isISODateString:qd,isDate:ey,isTimeString:TF,offsetDate:e0,offsetTime:jUe,sameDay:ql,timeStringMinutes:xt,timeToDate:rr,timeUTC:VUe,validTimeValue:pv,validDateString:QS,timeValidation:Dd,dateValidation:ol},XUe=(t,e)=>t.filter(Boolean).every(i=>typeof i===e),JUe=t=>t.filter(Boolean).every(_i);function Nm(t){let e=t.category;if(typeof e!="object")return{error:KI};let{ageCategoryCode:i,ageMaxDate:r,ageMinDate:n,ageMax:a,ageMin:o}=e,s=e.categoryName,l;if(!XUe([i,r,n,s],"string")||!JUe([a,o]))return{error:KI};let u=t.consideredDate??mt(new Date().toLocaleDateString("sv"));if(!ba(u))return{error:Fr};let[c]=u.split("-").slice(0,3).map(x=>parseInt(x)),d=Hv(u,-1),[p,m]=d.split("-").slice(1,3).map(x=>parseInt(x)),h=`${oo(p)}-${oo(m)}`,f=Hv(u,1),[g,v]=f.split("-").slice(1,3).map(x=>parseInt(x)),y=`${oo(g)}-${oo(v)}`,I=o&&Hv(u,-1*365*o),b=a&&Hv(u,-1*365*a),S=[],w=x=>!S.includes(x)&&S.push(x);i=i??s;let U=/^([UO]?)(\d{1,2})([UO]?)$/,T=/^C(\d{1,2})-(\d{1,2})$/,D=i==null?void 0:i.includes("-"),P=D&&(i==null?void 0:i.match(T)),E=i==null?void 0:i.match(U),R=(x,F)=>`${x}-${F}`,N=x=>{let F=c-x,$=R(F,y);e.ageMinDate&&e.ageMinDate!==$&&w(`Invalid submitted ageMinDate: ${n}`),n=$,i&&(e.ageMax&&e.ageMax!==x-1&&(w(`Invalid submitted ageMax: ${a}`),b=void 0),a=x-1)},A=x=>{let F=c-x-1,$=R(F,y);e.ageMin&&e.ageMin>x&&w(`Invalid submitted ageMin: ${o}`),e.ageMax&&e.ageMax>x&&w(`Invalid submitted ageMax: ${a}`),e.ageMinDate&&e.ageMinDate!==$&&w(`Invalid submitted ageMinDate: ${n}`),n=$,i&&(e.ageMax&&e.ageMax!==x&&(w(`Invalid submitted ageMax: ${a}`),I=void 0),a=x)},M=x=>{let F=c-x,$=R(F,h);e.ageMaxDate&&e.ageMaxDate!==$&&w(`Invalid submitted ageMaxDate: ${r}`),r=$,i&&(e.ageMin&&e.ageMin!==x+1&&(w(`Invalid submitted ageMin: ${o}`),I=void 0),o=x+1)},C=x=>{let F=c-x-1,$=R(F,h);e.ageMaxDate&&e.ageMaxDate!==$&&w(`Invalid submitted ageMaxDate: ${r}`),r=$,i&&(e.ageMin&&e.ageMin!==x&&(w(`Invalid submitted ageMin: ${o}`),I=void 0),o=x)},O=x=>{let[F,$,_]=(x.match(U)||[]).slice(1),L=parseInt($);F==="U"?(e.ageMaxDate&&e.ageMaxDate!==r&&w(`Invalid submitted ageMaxDate: ${e.ageMaxDate}`),N(L)):F==="O"&&M(L),_==="U"?(e.ageMaxDate&&e.ageMaxDate!==r&&w(`Invalid submitted ageMaxDate: ${e.ageMaxDate}`),A(L)):_==="O"&&C(L),r=r??I,n=n??b};if(P){if(r=void 0,n=void 0,a=void 0,o=void 0,e.ageMin){let $=c-e.ageMin;r=R($,h)}if(e.ageMax){let $=c-e.ageMax-1;n=R($,y)}let[x,F]=((i==null?void 0:i.match(T))??[]).slice(1).map($=>parseInt($));x<=F?(o=x,a=F,l=!0):w(`Invalid combined age range ${i}`)}else D?i==null||i.split("-").forEach(O):E?O(i):(o&&M(o),a&&A(a));a&&e.ageMin&&e.ageMin>a&&(w(`Invalid submitted ageMin: ${e.ageMin}`),o=void 0);let k=He({consideredDate:u,combinedAge:l,ageMaxDate:r,ageMinDate:n,ageMax:a,ageMin:o});return S.length&&(k.errors=S),k}function ty({category:t}){if(!At(t))return{error:se};let e=Nm({category:t});if(e.error)return{error:e};let{ratingMax:i,ratingMin:r}=t;return i&&!_i(i)?te({result:{error:se},context:{ratingMax:i}}):r&&!_i(r)?te({result:{error:se},context:{ratingMin:r}}):{...e}}function ew({childCategory:t,withDetails:e,category:i}){let r=ty({category:i}),n=ty({category:t}),a=n.ageMin&&(r.ageMin&&n.ageMin<r.ageMin||r.ageMax&&n.ageMin>r.ageMax),o=n.ageMax&&(r.ageMax&&n.ageMax>r.ageMax||r.ageMin&&n.ageMax<r.ageMin),s=n.ageMinDate&&r.ageMaxDate&&new Date(n.ageMinDate)>new Date(r.ageMaxDate),l=n.ageMaxDate&&r.ageMinDate&&new Date(n.ageMaxDate)<new Date(r.ageMinDate),u=(i==null?void 0:i.ratingType)&&(t==null?void 0:t.ratingType)&&i.ratingType===t.ratingType&&(i.ratingMin&&t.ratingMin&&t.ratingMin<i.ratingMin||i.ratingMax&&t.ratingMax&&t.ratingMax>i.ratingMax||i.ratingMin&&t.ratingMax&&t.ratingMax<i.ratingMin||i.ratingMax&&t.ratingMin&&t.ratingMin>i.ratingMax),c=(i==null?void 0:i.ballType)&&(t==null?void 0:t.ballType)&&i.ballType!==t.ballType,d=He({invalidRatingRange:u,invalidAgeMinDate:s,invalidAgeMaxDate:l,invalidBallType:c,invalidAgeMax:o,invalidAgeMin:a,valid:!u&&!s&&!l&&!c&&!o&&!a},!0);return e&&Object.assign(d,{categoryDetails:r,childCategoryDetails:n}),d}function tw({checkCategory:t=!0,collectionDefinition:e,checkCollectionIds:i,checkGender:r=!0,referenceCategory:n,referenceGender:a,event:o}){a=a??(o==null?void 0:o.gender);let s="validateCollectionDefinition",l=[];if(typeof e!="object")return l.push(`collectionDefinition must be an object: ${e}`),te({result:{errors:l,error:Qu},stack:s});let{collectionValueProfiles:u,collectionGroupNumber:c,collectionValue:d,collectionId:p,matchUpCount:m,matchUpFormat:h,matchUpValue:f,matchUpType:g,scoreValue:v,setValue:y,category:I,gender:b}=e;if(i&&typeof p!="string"&&l.push(`collectionId is not type string: ${p}`),typeof m!="number"&&l.push(`matchUpCount is not type number: ${m}`),g&&!nP([ii,ei],g)&&l.push(`matchUpType must be SINGLES or DOUBLES: ${g}`),[!!(u!=null&&u.length)].concat([f,d,v,y].map(st)).filter(Boolean).length!==1&&l.push("Missing value definition for matchUps: matchUpValue, collectionValue, or collectionValueProfiles"),f&&typeof f!="number"&&l.push(`matchUpValue is not type number: ${f}`),d&&typeof d!="number"&&l.push(`collectionValue is not type number: ${d}`),u&&m){let S=kK({collectionValueProfiles:u,matchUpCount:m});S.errors&&l.push(...S.errors)}if(c&&typeof c!="number"&&l.push(`collectionGroupNumber is not type number: ${d}`),h&&!Ra({matchUpFormat:h})&&l.push(`Invalid matchUpFormat: ${h}`),r){let S=UP({referenceGender:a,matchUpType:g,gender:b});if(S.error)return te({context:{referenceGender:a,gender:b},result:S,stack:s})}if(t&&n&&I){let S=ew({category:n,childCategory:I});if(!S.valid)return te({result:{error:KI},context:S,stack:s})}return l.length?te({result:{errors:l,error:x9},stack:s}):{valid:!0}}function qn(t){var e,i,r,n;let a=!!((t==null?void 0:t.enforceCategory)!==!1&&t!=null&&t.category),o=!!((t==null?void 0:t.enforceGender)!==!1&&t!=null&&t.gender),s=t==null?void 0:t.checkCollectionIds,l=t==null?void 0:t.tieFormat,u=t==null?void 0:t.event,c="validateTieFormat",d=[],p=QUe({...t,stack:c});if(p!=null&&p.error)return p;let m,h=l.collectionDefinitions.every(I=>{let{setValue:b,scoreValue:S,collectionValue:w}=I;(b||S)&&!w&&(m=!0);let{valid:U,errors:T}=tw({referenceCategory:t.category,referenceGender:t.gender,collectionDefinition:I,checkCollectionIds:s,checkCategory:a,checkGender:o,event:u});return U?!0:(Array.isArray(T)&&d.push(...T),!1)}),f=typeof((e=l.winCriteria)==null?void 0:e.valueGoal)=="number"&&((i=l.winCriteria)==null?void 0:i.valueGoal)>0&&!m||((r=l.winCriteria)==null?void 0:r.aggregateValue);if(!(f||(n=l.winCriteria)!=null&&n.aggregateValue))return m?d.push("aggregateValue is required"):d.push("Either non-zero valueGoal, or { aggregateValue: true } must be specified in winCriteria"),te({context:{tieFormat:l,errors:d,aggregateValueImperative:m},result:{error:kl},stack:c});let g=l.collectionDefinitions.map(({collectionId:I})=>I),v=!s||g.length===dt(g).length,y=h&&f&&v;return y?{valid:y,errors:d}:te({result:{error:kl},context:{tieFormat:l,errors:d},stack:c})}function QUe(t){let{tieFormat:e,stack:i}=t;return!t||!e||!At(e)?te({result:{error:kl},context:{tieFormat:e,message:"tieformat must be an object"},stack:i}):At(e.winCriteria)?Array.isArray(e.collectionDefinitions)?{...Q}:te({result:{error:kl},context:{tieFormat:e,message:"collectionDefinitions must be an array"},stack:i}):te({result:{error:kl},context:{tieFormat:e,message:"tieformat.winCritiera must be an object"},stack:i})}var eg="resourceSubType",tg="resourceType",ig="identifier",ZUe={RESOURCE_SUB_TYPE:eg,RESOURCE_TYPE:tg,IDENTIFIER:ig};function Ne(t,e,i,r,n=0){if(hM().makeDeepCopy)return hM().makeDeepCopy(t,e,i,r);let a=vF(),{stringify:o,toJSON:s,ignore:l,modulate:u}=a||{};if(!(a!=null&&a.enabled)&&!i||typeof t!="object"||ha(t)||t===null||typeof(a==null?void 0:a.threshold)=="number"&&n>=a.threshold)return t;let c=Array.isArray(t)?[]:{},d=Object.keys(t).filter(m=>!i||!l||Array.isArray(l)&&!l.includes(m)||ha(l)&&!l(m)),p=(m,h)=>{c[m]=ha(h==null?void 0:h.toString)?h.toString():JSON.stringify(h)};for(let m of d){let h=t[m],f=ha(u)?u(h):void 0;if(f!==void 0)c[m]=f;else if(e&&m==="extensions"&&Array.isArray(h)){let g=RF(h);Object.assign(c,...g)}else r&&m==="extensions"?c[m]=[]:Array.isArray(o)&&o.includes(m)?p(m,h):Array.isArray(s)&&s.includes(m)&&ha(h==null?void 0:h.toJSON)?c[m]=h.toJSON():h===null?c[m]=void 0:_Ue(h)?c[m]=new Date(h).toISOString():c[m]=Ne(h,e,i,r,n+1)}return c}function RF(t){return t==null?void 0:t.map(e=>{let{name:i,value:r}=e;return i&&r&&{[`_${i}`]:r}}).filter(Boolean)}function s8(t=1,e){return Te(0,t).map(()=>Ht(e))}function Ht(t){let e=[];for(let s=0;s<256;s++)e[s]=(s<16?"0":"")+s.toString(16);let i=Math.random()*4294967295|0,r=Math.random()*4294967295|0,n=Math.random()*4294967295|0,a=Math.random()*4294967295|0,o=e[i&255]+e[i>>8&255]+e[i>>16&255]+e[i>>24&255]+"-"+e[r&255]+e[r>>8&255]+"-"+e[r>>16&15|64]+e[r>>24&255]+"-"+e[n&63|128]+e[n>>8&255]+"-"+e[n>>16&255]+e[n>>24&255]+e[a&255]+e[a>>8&255]+e[a>>16&255]+e[a>>24&255];return typeof t=="string"?`${t}_${o.replace(/-/g,"")}`:o}var l8={collectionDefinitions:[{collectionName:"Male Singles",matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpCount:4,matchUpValue:1,gender:"MALE"},{collectionName:"Female Singles",matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:4,matchUpValue:1},{collectionName:"Male Doubles",matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpCount:2,matchUpValue:1,gender:"MALE"},{collectionName:"Female Doubles",matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:2,matchUpValue:1},{collectionName:"Mixed Doubles",matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpCount:4,matchUpValue:1,gender:"MIXED"}],tieFormatName:"USTA_GOLD_TEAM_CHALLENGE",winCriteria:{valueGoal:9}},u8={collectionDefinitions:[{collectionName:"Round 1",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Round 2",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Round 3",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"Doubles Shuffle",unrestrictedSelections:!0,winCriteria:{aggregateValue:!0}},c8={collectionDefinitions:[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_SOUTHERN_LEVEL_5",winCriteria:{valueGoal:8}},d8={collectionDefinitions:[{category:{ageCategoryCode:"16U"},collectionName:"16U Singles",matchUpCount:4,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Singles",matchUpCount:4,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Doubles",matchUpCount:2,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Doubles",matchUpCount:2,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Tiebreak Doubles",matchUpCount:1,matchUpFormat:"SET1-S:TB10",matchUpType:"DOUBLES",matchUpValue:1,processCodes:["RANKING.IGNORE"]}],tieFormatName:"USTA_SECTION_BATTLE",winCriteria:{valueGoal:9}},p8={collectionDefinitions:[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_INTERSECTIONAL",winCriteria:{valueGoal:8}},m8={collectionDefinitions:[{scoreValue:1,matchUpType:"SINGLES",collectionName:"Men's Singles",matchUpFormat:"SET1-S:T60",gender:"MALE",matchUpCount:1},{scoreValue:1,matchUpType:"SINGLES",collectionName:"Women's Singles",matchUpFormat:"SET1-S:T60",gender:"FEMALE",matchUpCount:1},{matchUpValue:1,matchUpType:"DOUBLES",collectionName:"Mixed Doubles",matchUpFormat:"SET1-S:T60",gender:"MIXED",matchUpCount:1}],tieFormatName:"Time Tennis Pro Circuit",winCriteria:{aggregateValue:!0}},h8={collectionDefinitions:[{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"DOMINANT_DUO_MIXED",winCriteria:{valueGoal:2}},f8={collectionDefinitions:[{scoreValue:1,matchUpType:"SINGLES",collectionName:"Men's Singles",matchUpFormat:"SET1-S:T60",gender:"MALE",matchUpCount:3},{scoreValue:1,matchUpType:"SINGLES",collectionName:"Women's Singles",matchUpFormat:"SET1-S:T60",gender:"FEMALE",matchUpCount:3},{scoreValue:1,matchUpType:"DOUBLES",collectionName:"Men's Doubles",matchUpFormat:"SET1-S:T60",gender:"MALE",matchUpCount:1},{matchUpValue:1,matchUpType:"DOUBLES",collectionName:"Women's Doubles",matchUpFormat:"SET1-S:T60",gender:"FEMALE",matchUpCount:1},{matchUpValue:1,matchUpType:"DOUBLES",collectionName:"Mixed Doubles",matchUpFormat:"SET1-S:T60",gender:"MIXED",matchUpCount:1}],tieFormatName:"Time Tennis Dual",winCriteria:{aggregateValue:!0}},g8={collectionDefinitions:[{category:{ageCategoryCode:"14U"},collectionName:"14U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],collectionGroups:[{groupNumber:1,groupName:"Doubles",groupValue:1,winCriteria:{valueGoal:2}}],tieFormatName:"USTA_BREWER_CUP",winCriteria:{valueGoal:4}},v8={winCriteria:{valueGoal:23},tieFormatName:"USTA_OZAKI_CUP",collectionDefinitions:[{category:{ageCategoryCode:"18U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"18U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"18U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"18U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"18U"},collectionName:"18U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"16U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"16U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"16U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"16U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"16U"},collectionName:"16U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"14U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"14U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"14U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"14U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"14U"},collectionName:"14U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"12U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"12U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"12U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"12U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"12U"},collectionName:"12U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"12U"},collectionName:"12U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"12U"},collectionName:"12U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1}]},zo="SET3-S:6/TB7",eSe="SET3-S:6NOAD",I8="SET3-S:6/TB7-F:TB10",tSe="SET3-S:4/TB7",iSe="SET3-S:4/TB5@3",rSe="SET1-S:T20",nSe="SET1-S:8/TB7",aSe="SET1-S:8/TB7@7",oSe={FORMAT_STANDARD:zo,FORMAT_STANDARD_NOAD:eSe,FORMAT_ATP_DOUBLES:I8,FORMAT_SHORT_SETS:tSe,FORMAT_FAST4:iSe,FORMAT_PRO_SET:nSe,FORMAT_COLLEGE_PRO_SET:aSe,TIMED20:rSe},y8={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"DOMINANT_DUO",winCriteria:{valueGoal:2}},b8={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",collectionValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"USTA_COLLEGE",winCriteria:{valueGoal:4}},w8={collectionDefinitions:[{collectionName:"Male Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_LEVEL_1",winCriteria:{valueGoal:10}},U8={collectionDefinitions:[{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Overtime",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"USTA_WTT_ITT",winCriteria:{aggregateValue:!0}},S8={collectionDefinitions:[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_ZONAL",winCriteria:{valueGoal:10}},T8={collectionDefinitions:[{collectionGroupNumber:1,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:1},{collectionGroupNumber:1,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:1},{collectionGroupNumber:2,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:2},{collectionGroupNumber:2,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:2},{collectionGroupNumber:3,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:3},{collectionGroupNumber:3,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:3}],collectionGroups:[{groupNumber:1,groupName:"Day 1"},{groupNumber:2,groupName:"Day 2"},{groupNumber:3,groupName:"Day 3"}],tieFormatName:"LAVER_CUP",winCriteria:{valueGoal:13}},D8={collectionDefinitions:[{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Overtime",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"USTA_TOC",winCriteria:{aggregateValue:!0}},r0="COLLEGE_DEFAULT",fM="COLLEGE_JUCO",gM="COLLEGE_D3",P8="DOMINANT_DUO",R8="DOMINANT_DUO_MIXED",E8="LAVER_CUP",C8="TEAM_DOUBLES_3_AGGREGATION",M8="TIME_TENNIS_DUAL",N8="TIME_TENNIS_PRO_CIRCUIT",A8="USTA_BREWER_CUP",O8="USTA_OZAKI_CUP",k8="USTA_COLLEGE",x8="USTA_GOLD_TEAM_CHALLENGE",F8="USTA_LEVEL_1",L8="USTA_INTERSECTIONAL",_8="USTA_SECTION_BATTLE",$8="USTA_SOUTHERN_LEVEL_5",B8="USTA_TOC",V8="USTA_WTT_ITT",j8="USTA_ZONAL",sSe={COLLEGE_D3:gM,COLLEGE_DEFAULT:r0,COLLEGE_JUCO:fM,DOMINANT_DUO:P8,DOMINANT_DUO_MIXED:R8,LAVER_CUP:E8,TEAM_DOUBLES_3_AGGREGATION:C8,TIME_TENNIS_DUAL:M8,TIME_TENNIS_PRO_CIRCUIT:N8,USTA_BREWER_CUP:A8,USTA_OZAKI_CUP:O8,USTA_COLLEGE:k8,USTA_GOLD_TEAM_CHALLENGE:x8,USTA_INTERSECTIONAL:L8,USTA_LEVEL_1:F8,USTA_SECTION_BATTLE:_8,USTA_SOUTHERN_LEVEL_5:$8,USTA_TOC:B8,USTA_WTT_ITT:V8,USTA_ZONAL:j8},G8="STANDARD",b2={[G8]:{hydrate:!0,doubles:{matchUpCount:3,matchUpValue:1},singles:{matchUpCount:6,matchUpValue:1},valueGoal:5},[gM]:{hydrate:!0,doubles:{matchUpFormat:"SET1-S:8/TB7@7",matchUpCount:3,matchUpValue:1},singles:{matchUpFormat:zo,matchUpCount:6,matchUpValue:1},tieFormatName:gM,valueGoal:5},[r0]:{hydrate:!0,doubles:{matchUpFormat:"SET1-S:6/TB7",collectionValue:1,matchUpCount:3},singles:{matchUpFormat:zo,matchUpCount:6,matchUpValue:1},tieFormatName:r0,valueGoal:4},[fM]:{hydrate:!0,doubles:{matchUpFormat:"SET1-S:8/TB7",matchUpCount:3,matchUpValue:1},singles:{matchUpFormat:zo,matchUpCount:6,matchUpValue:1},tieFormatName:fM,valueGoal:5},[E8]:T8,[P8]:y8,[R8]:h8,[C8]:u8,[M8]:f8,[N8]:m8,[A8]:g8,[O8]:v8,[k8]:b8,[x8]:l8,[L8]:p8,[F8]:w8,[_8]:d8,[$8]:c8,[V8]:U8,[B8]:D8,[j8]:S8},lSe=t=>{let e=t!=null&&t.namedFormat&&Object.keys(b2).includes(t.namedFormat)?t.namedFormat:G8,i=Array.isArray(t==null?void 0:t.uuids)?t==null?void 0:t.uuids:[],r,{category:n,gender:a}=(t==null?void 0:t.event)??{},o=Ne(b2[e],!1,!0),s=l=>{var u,c;if(!(t!=null&&t.isMock)&&!((u=t==null?void 0:t.event)!=null&&u.isMock)||!t.event)return(i==null?void 0:i.pop())??Ht();let d=(c=t==null?void 0:t.event)==null?void 0:c.eventId;return i.pop()??`${d}-COL-${l+1}`};return o.hydrate?(r={winCriteria:{valueGoal:o.valueGoal},collectionDefinitions:[{collectionId:s(0),matchUpFormat:I8,collectionName:"Doubles",matchUpType:ei,...o.doubles},{collectionId:s(1),matchUpFormat:zo,collectionName:"Singles",matchUpType:ii,...o.singles}]},o.tieFormatName&&(r.tieFormatName=o.tieFormatName)):(o.collectionDefinitions.forEach((l,u)=>l.collectionId=s(u)),r=o),t!=null&&t.hydrateCollections&&r.collectionDefinitions.forEach(l=>{n&&!l.category&&(l.category=n),a&&!l.gender&&(l.gender=a)}),r},Nu=lSe,sl="SINGLES",Am="SINGLES",ho="DOUBLES",Au="DOUBLES",ur="TEAM",Ea="TEAM",uSe="AGE",cSe="RATING",dSe="BOTH",pSe={AGE:uSe,BOTH:dSe,DOUBLES:ho,DOUBLES_EVENT:Au,RATING:cSe,SINGLES:sl,SINGLES_EVENT:Am,TEAM_EVENT:Ea,TEAM:ur},Ae="MAIN",Ke="QUALIFYING",an="CONSOLATION",Lr="VOLUNTARY_CONSOLATION",Bi="PLAY_OFF",TP=[Ae,Ke,an,Bi,Lr],Om={[Ke]:1,[Ae]:2,[Bi]:3,[an]:3,[Lr]:4},H8="finishingPositions",z8="aggregateEventStructures",W8={[Ae]:1,[Bi]:2,[an]:3,[Ke]:4,[Lr]:5},mSe={[Bi]:1,[Ae]:2,[an]:3,[Ke]:4,[Lr]:5},DP="CLUSTER",hSe="SEPARATE",Yd="WATERFALL",PP="ITEM",_n="CONTAINER",gs="DRAW",RP="RANDOM",$o="TOP_DOWN",Kd="BOTTOM_UP",Ou="POSITION",ku="WINNER",Yl="LOSER",ll="FIRST_MATCHUP",Ga="AD_HOC",fSe="AD_HOC",mv="FEED_IN",rg="COMPASS",ng="OLYMPIC",gSe="SINGLE_ELIMINATION",Ks="SINGLE_ELIMINATION",iw="DOUBLE_ELIMINATION",ag="FIRST_MATCH_LOSER_CONSOLATION",rw="FIRST_ROUND_LOSER_CONSOLATION",Pp="LUCKY_DRAW",EP="CURTIS_CONSOLATION",vSe="CURTIS_CONSOLATION",EF="FEED_IN_CHAMPIONSHIP_TO_SF",iy="FEED_IN_CHAMPIONSHIP_TO_SF",CF="FEED_IN_CHAMPIONSHIP_TO_QF",ry="FEED_IN_CHAMPIONSHIP_TO_QF",MF="FEED_IN_CHAMPIONSHIP_TO_R16",ny="FEED_IN_CHAMPIONSHIP_TO_R16",q8="MODIFIED_FEED_IN_CHAMPIONSHIP",ay="MODIFIED_FEED_IN_CHAMPIONSHIP",nw="FEED_IN_CHAMPIONSHIP",ISe="DOUBLE_ROUND_ROBIN",is="ROUND_ROBIN",Kl="ROUND_ROBIN_WITH_PLAYOFF",Y8="DECIDER",K8="BACKDRAW",NF={0:{name:"East",abbreviation:"E"},"0-1":{name:"West",abbreviation:"W"},"0-2":{name:"North",abbreviation:"N"},"0-3":{name:"Northeast",abbreviation:"NE"},"0-1-1":{name:"South",abbreviation:"S"},"0-1-2":{name:"Southwest",abbreviation:"SW"},"0-2-1":{name:"Northwest",abbreviation:"NW"},"0-1-1-1":{name:"Southeast",abbreviation:"SE"}},AF={0:{name:"East",abbreviation:"E"},"0-1":{name:"West",abbreviation:"W"},"0-2":{name:"North",abbreviation:"N"},"0-1-1":{name:"South",abbreviation:"S"}},Xd="WIN_RATIO",Th="ROUND_OUTCOME",X8=[rg,EP,ry,ny,iy,nw,CF,MF,EF,ag,rw,Pp,ay,ng,Bi,Kl],ySe=[Ga,rg,EP,iw,ry,ny,iy,nw,mv,ag,rw,Pp,ay,ng,Bi,is,Kl,Ks],J8={MAIN:Ae,QUALIFYING:Ke,CONSOLATION:an,ITEM:PP,CONTAINER:_n,FIRST_MATCHUP:ll,WINNER:ku,LOSER:Yl,AD_HOC:Ga,FEED_IN:mv,FLEX_ROUNDS:fSe,COMPASS:rg,PLAY_OFF:Bi,OLYMPIC:ng,KNOCKOUT:gSe,SINGLE_ELIMINATION:Ks,DOUBLE_ELIMINATION:iw,CURTIS:EP,FICSF:EF,FICQF:CF,FICR16:MF,MFIC:q8,VOLUNTARY_CONSOLATION:Lr,FIRST_MATCH_LOSER_CONSOLATION:ag,FIRST_ROUND_LOSER_CONSOLATION:rw,MODIFIED_FEED_IN_CHAMPIONSHIP:ay,FEED_IN_CHAMPIONSHIP_TO_R16:ny,FEED_IN_CHAMPIONSHIP_TO_QF:ry,FEED_IN_CHAMPIONSHIP_TO_SF:iy,FEED_IN_CHAMPIONSHIP:nw,LUCKY_DRAW:Pp,ROUND_ROBIN_WITH_PLAYOFF:Kl,ROUND_ROBIN:is,DECIDER:Y8,BACKDRAW:K8,COMPASS_ATTRIBUTES:NF,OLYMPIC_ATTRIBUTES:AF,DRAW:gs,RANDOM:RP,TOP_DOWN:$o,BOTTOM_UP:Kd,WATERFALL:Yd,WIN_RATIO:Xd,ROUND_OUTCOME:Th,MULTI_STRUCTURE_DRAWS:X8,generatedDrawTypes:ySe,stageOrder:Om,finishOrder:W8,AGGREGATE_EVENT_STRUCTURES:z8,FINISHING_POSITIONS:H8},bSe=J8,fn="tournamentRecords",OF="policyDefinitions",Ur="tournamentRecord",kF="onlineResource",$n="drawDefinition",Q8="tieFormatName",xF="matchUpFormat",Xl="participantId",Z8="scheduleDates",wSe="tournamentId",USe="scheduleDate",SSe="roundNumber",CP="structureId",FF="participant",aw="matchUpIds",eX="entryStage",TSe="policyType",tX="structures",LF="eventType",Il="matchUpId",MP="tieFormat",NP="inContext",AP="structure",OP="courtIds",DSe="personId",kP="venueIds",_F="matchUps",iX="courtId",rX="eventId",ru="matchUp",nX="drawId",Wo="error",ed="event",hv="param",$F="uuids",PSe="averageMatchUpMinutes",RSe="recoveryMinutes",ESe="periodLength",CSe="number",ta="object",cn="array",Xr="_validate",aX="_message",Ha="_invalid",Jn="_ofType",BF="_anyOf",og="_oneOf",w2={[kF]:t=>ji(Object.keys(t),[eg,tg,ig]).length===3,[Q8]:t=>t&&Nu({namedFormat:t}),[$F]:t=>!t||Array.isArray(t)&&t.every(Di),[MP]:t=>!qn({tieFormat:t}).error,[LF]:t=>[sl,ho,ur].includes(t),[eX]:t=>TP.includes(t)},MSe={[fn]:xi,[Ur]:ve,[OF]:sP,[$n]:$e,[Xl]:hr,[xF]:Zx,[wSe]:Kf,[CP]:Xa,[aw]:gh,[FF]:yh,[kF]:Qu,[LF]:Wl,[tX]:Xx,[Il]:bn,[MP]:kl,[AP]:Tp,[iX]:vh,[_F]:Ju,[rX]:mo,[ru]:sa,[OP]:Je,[kP]:Je,[nX]:Fs,[ed]:vi},NSe={[fn]:ta,[OF]:ta,[Ur]:ta,[$n]:ta,[kF]:ta,[Z8]:cn,[FF]:ta,[aw]:cn,[tX]:cn,[MP]:ta,[AP]:ta,[OP]:cn,[kP]:cn,[_F]:cn,[ru]:ta,[ed]:ta,[$F]:cn};function We(t,e,i){if(!t&&!At(t))return{error:se};if(!(e!=null&&e.length)||t!=null&&t._bypassParamCheck)return{valid:!0};if(!Array.isArray(e))return{error:se};let{paramError:r,errorParam:n}=kSe(t,e);if(!r)return{valid:!0};let a=r[Xr]&&(r[Wo]||r[Ha])||(t==null?void 0:t[n])===void 0&&(r[Wo]||r[Ha]||MSe[n]||se)||se,o=n??(r[og]&&Object.keys(r[og]).join(", "));return te({info:{param:o,message:r[aX]},result:{error:a},stack:i})}function oX(t,e){let i=Object.keys(t),r=Object.keys(e);return ji(i,r)}function ASe(t,e){if(!e)return;let i=oX(t,e);return i.length!==1?{error:se}:i.reduce((r,n)=>({...r,[n]:!0}),{})}function OSe(t,e){if(!e)return;let i=oX(t,e).filter(r=>t[r]);return i.length<1?{error:se}:i.reduce((r,n)=>({...r,[n]:!0}),{})}function kSe(t,e){let i,r;return{paramError:e.find(({_ofType:n,_oneOf:a,_anyOf:o,_validate:s,_info:l,...u})=>{let c=a&&ASe(t,a);if(c!=null&&c.error)return c.error;c&&Object.assign(u,c);let d=o&&OSe(t,o);if(d!=null&&d.error)return d.error;d&&Object.assign(u,d);let p=Object.keys(u).filter(h=>typeof u[h]=="boolean"),m=p.find(h=>{let f=s&&!ha(s),g=t[h]!==void 0&&!s&&xSe(t,h,n),v=u[h]&&[void 0,null].includes(t[h]),y=f||g||v||s&&t[h]!==void 0&&!FSe(t[h],s)||w2[h]&&!w2[h](t[h]);return y&&(i=h,r=l),y});return!p.length||m}),errorParam:i,paramInfo:r}}function xSe(t,e,i){return i=i||NSe[e]||"string",i==="array"?!Array.isArray(t[e]):typeof t[e]!==i}function FSe(t,e){return ha(e)?e(t):!0}var VF="DYNAMIC",Nc="RANKING",Ic="RATING",Jd="SCALE",xl="SEEDING",LSe={RANKING:Nc,RATING:Ic,SCALE:Jd,SEEDING:xl};function fv(t){var e;let i=We(t,[{[FF]:!0}]);if(i.error)return i;let r=(e=t.participant.timeItems)==null?void 0:e.filter(({itemType:a})=>(a==null?void 0:a.startsWith(Jd))&&[Nc,Ic,xl].includes(a.split(".")[1])),n={ratings:{},rankings:{},seedings:{}};if(r!=null&&r.length){let a=s=>r.filter(l=>(l==null?void 0:l.itemType)===s).sort((l,u)=>new Date(l.createdAt||void 0).getTime()-new Date(u.createdAt||void 0).getTime()).pop(),o=dt(r.map(({itemType:s})=>s));for(let s of o){let l=a(s);if(l){let[,u,c,d,p]=l.itemType.split("."),m=p?`${d}.${p}`:d,h=u===xl&&"seedings"||u===Nc&&"rankings"||"ratings";n[h][c]||(n[h][c]=[]),n[h][c].push({scaleValue:l.itemValue,scaleDate:l.itemDate,scaleName:m})}}}return{...Q,...n}}function km(t){if(t===null)return{};let{source:e,template:i}=t||{};if(!i)return e;let r={};return n(e,i,r),r;function n(a,o,s){if(!a||!o)return;let l=Object.keys(a),u=Object.keys(o),c=Object.assign({},...u.filter(m=>m.indexOf("||")).map(m=>m.split("||").map(h=>({[h]:m}))).flat()),d=u.concat(...Object.keys(c)),p=d.includes("*");for(let m of l)if(d.indexOf(m)>=0||p){let h=c[m]||m,f=o[h]||p,g=a[m];if(typeof f=="object"&&typeof g!="function"&&!Array.isArray(f))if(Array.isArray(g)){let v=g.map(y=>{let I={};return n(y,f,I)!==!1?I:void 0}).filter(Boolean);s[m]=v}else g&&(s[m]={},n(g,f,s[m]));else{let v=a[m];if(Array.isArray(f)&&!f.includes(v))return!1;(o[m]||p&&o[m]!==!1)&&(s[m]=v)}}}}var vM="voluntaryConsolation",du="competitiveBands",jF="roundRobinTally",xu="positionActions",_r="matchUpActions",JU="rankingPoints",sg="roundNaming",gv="participant",oy="progression",td="scheduling",sy="avoidance",_Se="participant",$Se="display",fo="scoring",Oo="seeding",lg="feedIn",BSe="audit",n0="draws",VSe={POLICY_TYPE_VOLUNTARY_CONSOLATION:vM,POLICY_TYPE_COMPETITIVE_BANDS:du,POLICY_TYPE_ROUND_ROBIN_TALLY:jF,POLICY_TYPE_POSITION_ACTIONS:xu,POLICY_TYPE_MATCHUP_ACTIONS:_r,POLICY_TYPE_RANKING_POINTS:JU,POLICY_TYPE_ROUND_NAMING:sg,POLICY_TYPE_PARTICIPANT:gv,POLICY_TYPE_PROGRESSION:oy,POLICY_TYPE_SCHEDULING:td,POLICY_TYPE_AVOIDANCE:sy,POLICY_TYPE_DISPLAY:$Se,POLICY_TYPE_PRIVACY:_Se,POLICY_TYPE_FEED_IN:lg,POLICY_TYPE_SCORING:fo,POLICY_TYPE_SEEDING:Oo,POLICY_TYPE_AUDIT:BSe,POLICY_TYPE_DRAWS:n0};function Ac({tournamentParticipants:t=[],policyDefinitions:e={},contextProfile:i,participantId:r,internalUse:n,personId:a}){let o=t.find(l=>r&&l.participantId===r||a&&l.person&&l.person.personId===a),s=Ne(o,!1,n);if(s){let l=e==null?void 0:e[gv];if(i!=null&&i.withScaleValues){let{ratings:u,rankings:c}=fv({participant:s});s.rankings=c,s.ratings=u}if(l!=null&&l.participant)return km({template:l.participant,source:s})}return s}var jSe="element required",GSe="missing name";function Dn(t){if(!t||typeof t!="object")return{error:Je};if(t.element&&typeof(t==null?void 0:t.element)!="object")return{error:se};if(!(t!=null&&t.name))return{error:Je,info:GSe};if(!(t!=null&&t.element)){if(t.discover&&t.tournamentRecords){for(let e of Object.keys(t.tournamentRecords)){let i=t.tournamentRecords[e],r=Dn({element:i,name:t.name});if(r.error)return te({result:r,stack:"removeExtension"})}return{...Q}}return{error:Je,info:jSe}}return t!=null&&t.element.extensions?(t.element.extensions=t.element.extensions.filter(e=>(e==null?void 0:e.name)!==t.name),{...Q}):{...Q,info:jr}}function ul({requiredAttributes:t=["name","value"],extension:e}){if(!e||typeof e!="object"||typeof e.name!="string")return!1;let i=Object.keys(e);return t.filter(r=>i.includes(r)).length===t.length}function _t(t){if(typeof t!="object")return{error:Je};let e="addExtension";if(t!=null&&t.element&&typeof t.element!="object")return te({result:{error:se},stack:e});if(!ul({extension:t.extension}))return te({result:{error:se,info:"invalid extension"},stack:e});if(!t.element)if(t.discover&&!t.tournamentId&&t.tournamentRecords){for(let r of Object.values(t.tournamentRecords)){let n=_t({extension:t.extension,element:r});if(n.error)return te({result:n,stack:e})}return{...Q}}else return te({result:{error:Je},stack:e});if(t.element.extensions||(t.element.extensions=[]),(t==null?void 0:t.creationTime)??!0){let r=new Date().toISOString();Object.assign(t.extension,{createdAt:r})}let i=t.element.extensions.find(({name:r})=>r===t.extension.name);return i?i.value=t.extension.value:t.extension.value&&t.element.extensions.push(t.extension),{...Q}}function GF(t){return!t||typeof t!="object"?{error:Je}:t.tournamentRecord?_t({creationTime:t.creationTime,element:t.tournamentRecord,extension:t.extension}):{error:ve}}function xP(t){return!t||typeof t!="object"?{error:Je}:t.drawDefinition?_t({creationTime:t.creationTime,element:t.drawDefinition,extension:t.extension}):{error:Va}}function id(t){return!t||typeof t!="object"?{error:Je}:t.event?_t({creationTime:t.creationTime,extension:t.extension,element:t.event}):{error:mo}}function sX(t){var e;if(!t||typeof t!="object")return{error:Je};if(!t.participantId)return{error:hr};let i=((e=t.tournamentRecord)==null?void 0:e.participants)||[],r=Ac({participantId:t.participantId,tournamentParticipants:i});return r?_t({creationTime:t.creationTime,extension:t.extension,element:r}):{error:Wi}}function HF(t){return!t||typeof t!="object"?{error:Je}:t.tournamentRecord?Dn({element:t.tournamentRecord,name:t.name}):{error:ve}}function lX(t){return!t||typeof t!="object"?{error:Je}:t.drawDefinition?Dn({element:t.drawDefinition,name:t.name}):{error:Va}}function FP(t){return!t||typeof t!="object"?{error:Je}:t!=null&&t.event?Dn({element:t.event,name:t.name}):{error:mo}}function uX(t){var e;if(!t||typeof t!="object")return{error:Je};if(!t.participantId)return{error:hr};let i=((e=t.tournamentRecord)==null?void 0:e.participants)||[],r=Ac({participantId:t.participantId,tournamentParticipants:i});return r?Dn({element:r,name:t.name}):{error:Wi}}function ow({tournamentRecords:t}){return{tournamentIds:At(t)?Object.keys(t):[],...Q}}var HSe="extensionQueries";function vt({discover:t,element:e,name:i,...r}){var n;if(!e||!i){if(t&&r){let o=Object.keys(r).filter(u=>typeof t=="boolean"||Array.isArray(t)&&t.includes(u)).find(u=>{var c;return Array.isArray((c=r[u])==null?void 0:c.extensions)?r[u].extensions.find(d=>(d==null?void 0:d.name)===i):!1}),s=o&&r[o];!s&&r.tournamentRecords&&(s=Object.values(r.tournamentRecords).find(u=>{var c;return(c=u.extensions)==null?void 0:c.length}));let l=(n=s==null?void 0:s.extensions)==null?void 0:n.find(u=>(u==null?void 0:u.name)===i);return{extension:l,info:l?void 0:jr}}return te({result:{error:Je},stack:HSe})}if(!Array.isArray(e.extensions))return{info:"no extensions"};let a=e.extensions.find(o=>(o==null?void 0:o.name)===i);return{extension:a,info:a?void 0:jr}}var zSe="activeSuspension",ly="appliedPolicies",cX="context",LP="delegatedOutcome",ws="disabled",xm="disableAutoCalc",_P="disableLinks",a0="display",Ed="drawDeletions",WSe="drawProfile",o0="entryProfile",qSe="eventProfile",YSe="eventWithdrawalRequests",KSe="factory",rs="flightProfile",IM="groupingAttribute",Fu="lineUps",Qd="linkedTournamentsIds",$P="matchUpHistory",zF="participantRepresentatives",vv="personRequests",bf="positionActions",XSe="rankingPoints",JSe="registration",yl="roundTarget",sw="scheduleLimits",Lu="scheduleTiming",Fm="schedulingProfile",QSe="statusDetail",ug="subOrder",Oc="tally",iI="tieFormatModification",dX={ACTIVE_SUSPENSION:zSe,APPLIED_POLICIES:ly,CONTEXT:cX,DELEGATED_OUTCOME:LP,DISABLED:ws,DISABLE_LINKS:_P,DISABLE_AUTO_CALC:xm,DISPLAY:a0,DRAW_DELETIONS:Ed,DRAW_PROFILE:WSe,ENTRY_PROFILE:o0,EVENT_PROFILE:qSe,EVENT_WITHDRAWAL_REQUESTS:YSe,FLIGHT_PROFILE:rs,GROUPING_ATTRIBUTE:IM,LINEUPS:Fu,LINKED_TOURNAMENTS:Qd,MATCHUP_HISTORY:$P,PARTICIPANT_REPRESENTATIVES:zF,PERSON_REQUESTS:vv,POSITION_ACTIONS:bf,RANKING_POINTS:XSe,REGISTRATION:JSe,ROUND_TARGET:yl,SCHEDULE_LIMITS:sw,SCHEDULE_TIMING:Lu,SCHEDULING_PROFILE:Fm,STATUS_DETAIL:QSe,SUB_ORDER:ug,TALLY:Oc,TIE_FORMAT_MODIFICATIONS:iI,FACTORY:KSe},U2=[LP,ws,xm,_P,rs,Fu,Qd,$P,zF,vv,yl,sw,Lu,Fm,ug,Oc,iI];function pX({tournamentRecords:t}){if(typeof t!="object"||!Object.keys(t).length)return{error:xi};let e=ow({tournamentRecords:t}),{tournamentIds:i}=e;return(i==null?void 0:i.length)>1?_t({tournamentRecords:t,discover:!0,extension:{name:Qd,value:{tournamentIds:i}}}):{...Q}}function mX({tournamentRecords:t}){if(typeof t!="object"||!Object.keys(t).length)return{error:xi};let e=Dn({name:Qd,tournamentRecords:t,discover:!0});return te({result:e,stack:"unlinkTournaments"})}function hX({tournamentRecords:t,tournamentId:e}){if(typeof t!="object")return{error:se};if(!e)return{error:Kf};let i=ow({tournamentRecords:t}),{tournamentIds:r}=i;if(!r.includes(e))return{error:Kf};let n;return r.every(a=>{var o;let s=t[a],{extension:l}=vt({element:s,name:Qd});if(!l)return!0;let u=((o=l==null?void 0:l.value)==null?void 0:o.tournamentIds)||[];if(!(u!=null&&u.length)||u.length===1&&u.includes(e)||a===e){let p=HF({name:Qd,tournamentRecord:s});return p.error&&(n=p.error),p.success}let c=u.filter(p=>p!==e);l.value={tournamentIds:c};let d=GF({tournamentRecord:s,extension:l});return d.error&&(n=d.error),d.success}),n?{error:n}:{...Q}}var fX={};bt(fX,{getLinkedTournamentIds:()=>lw,getTournamentIds:()=>ow});function lw({tournamentRecords:t}){return typeof t!="object"||!Object.keys(t).length?{error:xi}:{linkedTournamentIds:Object.assign({},...Object.keys(t).map(e=>{var i;let r=t[e],n=r==null?void 0:r.tournamentId,{extension:a}=vt({element:r,name:Qd}),o=(((i=a==null?void 0:a.value)==null?void 0:i.tournamentIds)||[]).filter(s=>s!==n);return{[e]:o}}))}}var gX={};bt(gX,{adHocPositionSwap:()=>oQ,addAdHocMatchUps:()=>pR,addDrawDefinitionTimeItem:()=>qL,addFinishingRounds:()=>Sw,addGoesTo:()=>tp,addPlayoffStructures:()=>dR,addQualifyingStructure:()=>aQ,addVoluntaryConsolationStage:()=>ZJ,addVoluntaryConsolationStructure:()=>xL,allPlayoffPositionsFilled:()=>zL,alternateDrawPositionAssignment:()=>jJ,assignDrawPosition:()=>AQ,assignDrawPositionBye:()=>Za,attachConsolationStructures:()=>EQ,attachPlayoffStructures:()=>c_,attachQualifyingStructure:()=>WL,attachStructures:()=>cR,autoSeeding:()=>JEe,automatedPlayoffPositioning:()=>Dv,automatedPositioning:()=>Ow,checkValidEntries:()=>fR,deleteAdHocMatchUps:()=>kQ,drawMatic:()=>O_,findDrawDefinition:()=>f_,generateAdHocMatchUps:()=>gR,generateAdHocRounds:()=>A_,generateAndPopulatePlayoffStructures:()=>l_,generateDrawDefinition:()=>Jw,generateDrawMaticRound:()=>U_,generateDrawStructuresAndLinks:()=>y_,generateDrawTypeAndModifyDrawDefinition:()=>b_,generateQualifyingStructure:()=>ZL,generateVoluntaryConsolation:()=>aZ,getAssignedParticipantIds:()=>Op,getAvailableMatchUpsCount:()=>mR,getAvailablePlayoffProfiles:()=>xw,getDrawDefinitionTimeItem:()=>mL,getDrawParticipantRepresentativeIds:()=>m_,getDrawStructures:()=>ns,getDrawTypeCoercion:()=>Gw,getEligibleVoluntaryConsolationParticipants:()=>p_,getMatchUpsMap:()=>ln,getParticipantIdFinishingPositions:()=>h_,getPositionAssignments:()=>fy,getPositionsPlayedOff:()=>Pv,getSeedingThresholds:()=>$L,getSeedsCount:()=>Hw,getStructureSeedAssignments:()=>go,getTeamLineUp:()=>ep,getValidGroupSizes:()=>Nw,isAdHoc:()=>Yn,isCompletedStructure:()=>_c,isValidForQualifying:()=>I_,luckyLoserDrawPositionAssignment:()=>xJ,modifyDrawDefinition:()=>CQ,modifyDrawName:()=>d_,modifySeedAssignment:()=>GJ,mutate:()=>vX,positionActions:()=>v_,pruneDrawDefinition:()=>NQ,qualifierDrawPositionAssignment:()=>VJ,query:()=>LQ,removeDrawPositionAssignment:()=>my,removeRoundMatchUps:()=>xQ,removeSeededParticipant:()=>nQ,removeStructure:()=>JJ,renameStructures:()=>XJ,resetDrawDefinition:()=>MQ,resetVoluntaryConsolationStructure:()=>OX,setDrawParticipantRepresentativeIds:()=>IX,setPositionAssignments:()=>$J,setStructureOrder:()=>YJ,setSubOrder:()=>FQ,shiftAdHocRounds:()=>_J,swapAdHocRounds:()=>BJ,swapDrawPositionAssignments:()=>iQ,updateTeamLineUp:()=>$h,withdrawParticipantAtDrawPosition:()=>RJ});var vX={};bt(vX,{adHocPositionSwap:()=>oQ,addAdHocMatchUps:()=>pR,addDrawDefinitionTimeItem:()=>qL,addPlayoffStructures:()=>dR,addQualifyingStructure:()=>aQ,addVoluntaryConsolationStage:()=>ZJ,addVoluntaryConsolationStructure:()=>xL,alternateDrawPositionAssignment:()=>jJ,assignDrawPosition:()=>AQ,assignDrawPositionBye:()=>Za,attachConsolationStructures:()=>EQ,attachPlayoffStructures:()=>c_,attachQualifyingStructure:()=>WL,attachStructures:()=>cR,automatedPlayoffPositioning:()=>Dv,automatedPositioning:()=>Ow,deleteAdHocMatchUps:()=>kQ,luckyLoserDrawPositionAssignment:()=>xJ,modifyDrawDefinition:()=>CQ,modifyDrawName:()=>d_,modifySeedAssignment:()=>GJ,pruneDrawDefinition:()=>NQ,qualifierDrawPositionAssignment:()=>VJ,removeDrawPositionAssignment:()=>my,removeRoundMatchUps:()=>xQ,removeSeededParticipant:()=>nQ,removeStructure:()=>JJ,renameStructures:()=>XJ,resetDrawDefinition:()=>MQ,resetVoluntaryConsolationStructure:()=>OX,setDrawParticipantRepresentativeIds:()=>IX,setPositionAssignments:()=>$J,setStructureOrder:()=>YJ,setSubOrder:()=>FQ,shiftAdHocRounds:()=>_J,swapAdHocRounds:()=>BJ,swapDrawPositionAssignments:()=>iQ,updateTeamLineUp:()=>$h,withdrawParticipantAtDrawPosition:()=>RJ});var WF=t=>e=>t[e],qF=(t=[])=>t.map(Pr).filter(Boolean),yM=(t=[])=>t.map(Tt).filter(Boolean),Tt=(t={})=>WF(t)("participantId"),Pr=(t={})=>WF(t)("matchUpId"),uy=(t={})=>WF(t)("drawId");function IX({representativeParticipantIds:t,drawDefinition:e}){if(!e)return{error:Va};if(!Array.isArray(t))return{error:se};let i=yM((e==null?void 0:e.entries)||[]);return t.length&&ji(t,i).length<t.length?{error:se}:xP({drawDefinition:e,extension:{name:zF,value:t}})}var ua="ABANDONED",Dh="AWAITING_RESULT",jt="BYE",bl="CANCELLED",Ki="COMPLETED",Iv="DEAD_RUBBER",Pt="DEFAULTED",dr="DOUBLE_DEFAULT",tr="DOUBLE_WALKOVER",cs="IN_PROGRESS",Ca="INCOMPLETE",YF="NOT_PLAYED",zr="RETIRED",rd="SUSPENDED",Qi="TO_BE_PLAYED",Ft="WALKOVER",ZSe=[Dh,Ki,Pt,cs,Ca,zr,rd],yX=[Dh,Ki,Pt,tr,dr,cs,Ca,zr,rd,Ft],bX=[ua,Dh,jt,bl,Ki,Iv,Pt,tr,dr,cs,Ca,YF,zr,rd,Qi,Ft],wX=[jt,tr,dr,Ki,Pt,zr,Ft],UX=[ua,Dh,bl,Iv,cs,Ca,YF,rd,Qi,void 0],yr=[bl,ua,Ki,Iv,Pt,tr,dr,zr,Ft],KF=[ua,Ki,Pt,tr,dr,cs,zr,Ft],SX=[cs,Ca,rd,Qi],TX={ABANDONED:ua,AWAITING_RESULT:Dh,BYE:jt,CANCELLED:bl,COMPLETED:Ki,DEAD_RUBBER:Iv,DEFAULTED:Pt,DOUBLE_WALKOVER:tr,DOUBLE_DEFAULT:dr,IN_PROGRESS:cs,INCOMPLETE:Ca,NOT_PLAYED:YF,RETIRED:zr,SUSPENDED:rd,TO_BE_PLAYED:Qi,WALKOVER:Ft};function Ph(t,e,i){var r,n;let a=m=>{var h,f;return(f=(h=vt({element:m,name:yl}))==null?void 0:h.extension)==null?void 0:f.value},o=i==null?void 0:i.deprioritizeCompleted,s=(i==null?void 0:i.mode)===z8&&mSe,l=(i==null?void 0:i.mode)===H8&&W8,u=l||s||Om,c=m=>(m==null?void 0:m.stage)===Ae&&(m==null?void 0:m.stageSequence)===1,d=m=>c(m)?-1:u[m==null?void 0:m.stage],p=m=>m==null?void 0:m.matchUps.every(({matchUpStatus:h})=>yr.includes(h)?1:-1);return o&&p(t)-p(e)||s&&d(t)-d(e)||((t==null?void 0:t.stage)&&u[t.stage]||0)-((e==null?void 0:e.stage)&&u[e.stage]||0)||(a(t)||0)-(a(e)||0)||!l&&!s&&(((r=e==null?void 0:e.positionAssignments)==null?void 0:r.length)??1/0)-(((n=t==null?void 0:t.positionAssignments)==null?void 0:n.length)??1/0)||((t==null?void 0:t.stageSequence)??0)-((e==null?void 0:e.stageSequence)??0)||(s0(t)||0)-(s0(e)||0)}function s0(t){return((t==null?void 0:t.matchUps)||[]).reduce((e,i)=>{var r;let n=(((r=i.finishingPositionRange)==null?void 0:r.winner)||[]).reduce((a,o)=>a+o,0);return!e||n<e?n:e},void 0)}function tt(t){let e=We(t,[{[$n]:!0,[CP]:!0}]);if(e.error)return e;let{drawDefinition:i,structureId:r}=t,{structures:n}=ns({drawDefinition:i}),a=n==null?void 0:n.map(l=>l.structures?[...l.structures].concat(l):l).flat(),o=a==null?void 0:a.find(l=>l.structureId===r);if(!o)return{error:Ai};let s=o.structureType===PP?a==null?void 0:a.find(l=>{var u;return(u=l.structures)==null?void 0:u.some(c=>c.structureId===r)}):void 0;return{structure:o,containingStructure:s}}function ns({withStageGrouping:t,drawDefinition:e,stageSequences:i,stageSequence:r,roundTarget:n,sortConfig:a,stages:o,stage:s}){var l;let u=!e&&$e||!(e!=null&&e.structures)&&Xx||void 0;if(u)return{error:u,structures:[],stageStructures:{}};let c=f=>{var g,v;let y=(v=(g=vt({element:f,name:yl}))==null?void 0:g.extension)==null?void 0:v.value;return!n||n===y},d=((l=e==null?void 0:e.structures)==null?void 0:l.filter(m).filter(h).filter(c).sort((f,g)=>Ph(f,g,a)))??[],p=t?Object.assign({},...TP.map(f=>{let g=d==null?void 0:d.filter(v=>v.stage===f);return(g==null?void 0:g.length)&&{[f]:g}}).filter(Boolean)):{};return{structures:d,stageStructures:p};function m(f){return!s&&!Array.isArray(o)||s&&f.stage===s||Array.isArray(o)&&o.includes(f.stage)}function h(f){return!r&&!Array.isArray(i)||r&&f.stageSequence===r||Array.isArray(i)&&i.includes(f.stageSequence)}}function DX({drawDefinition:t}){if(!t)return{error:$e};let e={};return{allPositionedParticipantIds:(t.structures||[]).map(i=>{let r=i.stage;e[r]||(e[r]=[]);let{positionAssignments:n}=si({structure:i}),a=(n==null?void 0:n.map(Tt).filter(Boolean))??[];return e[r].push(...a),a}).flat(),stagePositionedParticipantIds:e}}function si({drawDefinition:t,structureId:e,structure:i}){let r,n=[];if(!i){if(!t)return{positionAssignments:n,error:$e};if({structure:i,error:r}=tt({drawDefinition:t,structureId:e}),r)return{positionAssignments:n,error:r}}return i.structures?n=[].concat(...i.structures.map(a=>si({structure:a}).positionAssignments)):i.positionAssignments?n=i.positionAssignments:r=e9,{positionAssignments:n,error:r}}function Mr({drawDefinition:t,structureId:e,structure:i}){var r;let n=((r=si({drawDefinition:t,structureId:e,structure:i}))==null?void 0:r.positionAssignments)||[],a=n==null?void 0:n.filter(c=>c.participantId??c.bye??c.qualifier),o=n&&(n==null?void 0:n.length)===(a==null?void 0:a.length),s=n==null?void 0:n.filter(c=>!c.participantId&&!c.bye&&!c.qualifier),l=n==null?void 0:n.filter(c=>!c.participantId&&c.bye),u=n==null?void 0:n.filter(c=>!c.participantId&&c.qualifier);return{allPositionsAssigned:o,positionAssignments:n,unassignedPositions:s,assignedPositions:a,qualifierPositions:u,byePositions:l}}var XF="addDrawDefinition",BP="addMatchUps",kc="addParticipants",JF="addScaleItems",PX="addEvent",QF="addVenue",vu="audit",ZF="dataIssue",eL="deleteParticipants",tL="deleteVenue",iL="deletedDrawIds",rL="deletedMatchUpIds",nL="modifyDrawDefinition",RX="modifyDrawEntries",EX="modifyEventEntries",aL="modifyMatchUp",on="modifyParticipants",oL="modifyPositionAssignments",sL="modifySeedAssignments",Rp="modifyTournamentDetail",Ep="modifyVenue",bM="mutations",wM="publishEvent",CX="publishEventSeeding",MX="publishOrderOfPlay",NX="publishParticipants",lL="unPublishEvent",uL="unPublishEventSeeding",cL="unPublishOrderOfPlay",e0e="unPublishParticipants",VP="updateInContextMatchUp",t0e={ADD_DRAW_DEFINITION:XF,ADD_MATCHUPS:BP,ADD_PARTICIPANTS:kc,ADD_SCALE_ITEMS:JF,ADD_EVENT:PX,ADD_VENUE:QF,AUDIT:vu,DATA_ISSUE:ZF,DELETE_PARTICIPANTS:eL,DELETE_VENUE:tL,DELETED_DRAW_IDS:iL,DELETED_MATCHUP_IDS:rL,MODIFY_DRAW_DEFINITION:nL,MODIFY_DRAW_ENTRIES:RX,MODIFY_EVENT_ENTRIES:EX,MODIFY_MATCHUP:aL,MODIFY_PARTICIPANTS:on,MODIFY_POSITION_ASSIGNMENTS:oL,MODIFY_SEED_ASSIGNMENTS:sL,MODIFY_TOURNAMENT_DETAIL:Rp,MODIFY_VENUE:Ep,MUTATIONS:bM,PUBLISH_EVENT_SEEDING:CX,PUBLISH_EVENT:wM,PUBLISH_ORDER_OF_PLAY:MX,PUBLISH_PARTICIPANTS:NX,UNPUBLISH_EVENT_SEEDING:uL,UNPUBLISH_EVENT:lL,UNPUBLISH_ORDER_OF_PLAY:cL,UPDATE_INCONTEXT_MATCHUP:VP};function jP(t,e){var i;if(!t)return{error:$e};let r=Date.now();t.updatedAt&&r===new Date(t.updatedAt).getTime()&&(r+=1);let n=new Date(r).toISOString(),a=e==null?void 0:e.filter(Boolean);return t.updatedAt=n,(i=t.structures)==null||i.filter(Boolean).forEach(o=>{(!(a!=null&&a.length)||a!=null&&a.includes(o.structureId))&&(o.updatedAt=n)}),{...Q}}function xc({drawDefinition:t,tournamentId:e,matchUps:i,eventId:r}){return t&&jP(t),ut({payload:{matchUps:i,tournamentId:e,eventId:r},topic:BP}),{...Q}}function Zu({drawDefinition:t,tournamentId:e,matchUpIds:i,eventId:r,action:n}){t&&jP(t),ut({topic:rL,payload:{tournamentId:e,matchUpIds:i,eventId:r,action:n}});for(let a of i)yF({key:a});return{...Q}}function Et({drawDefinition:t,tournamentId:e,structureId:i,context:r,eventId:n,matchUp:a}){return a?(t&&ui({drawDefinition:t,structureIds:i?[i]:void 0,tournamentId:e,eventId:n}),ut({topic:aL,payload:{matchUp:a,tournamentId:e,context:r},key:a.matchUpId}),{...Q}):(console.log(sa),{error:sa})}function i0e({tournamentId:t,inContextMatchUp:e}){return e?(ut({payload:{inContextMatchUp:e,tournamentId:t},topic:VP,key:e.matchUpId}),{...Q}):{error:sa}}function uw({tournamentId:t,eventId:e,drawDefinition:i}){return i?(jP(i),ut({payload:{drawDefinition:i,tournamentId:t,eventId:e},topic:XF,key:i.drawId}),{...Q}):(console.log($e),{error:$e})}function r0e({tournamentId:t,eventId:e,drawId:i}){return ut({payload:{drawId:i,tournamentId:t,eventId:e},topic:iL,key:i}),yF({key:i}),{...Q}}function ui({drawDefinition:t,tournamentId:e,structureIds:i,eventId:r}){return t?(jP(t,i),ut({payload:{tournamentId:e,eventId:r,drawDefinition:t},topic:nL,key:t.drawId}),{...Q}):{error:$e}}function AX({drawDefinition:t,tournamentId:e,structure:i,eventId:r}){if(!t)return{error:$e};if(!i)return{error:Tp};let n=i.seedAssignments,a=i.structureId,o=t.drawId;return ut({payload:{tournamentId:e,eventId:r,drawId:o,structureId:a,seedAssignments:n},topic:sL,key:t.drawId}),ui({structureIds:[a],drawDefinition:t,tournamentId:e,eventId:r}),{...Q}}function Fc({drawDefinition:t,tournamentId:e,structure:i,event:r}){if(!t)return{error:$e};if(!i)return{error:Tp};let n=si({structure:i}),a=i.structureId,o=t.drawId,s=r==null?void 0:r.eventId;return ut({topic:oL,payload:{positionAssignments:n,tournamentId:e,structureId:a,eventId:s,drawId:o},key:a}),ui({structureIds:[a],drawDefinition:t,tournamentId:e,eventId:s}),{...Q}}function OX({tournamentRecord:t,drawDefinition:e,resetEntries:i,event:r}){var n,a;if(!e)return{error:$e};let o=(n=e.structures)==null?void 0:n.find(l=>l.stage===Lr);if(!o)return{error:Ai};let s=((a=o.matchUps)==null?void 0:a.map(({matchUpId:l})=>l))||[];return o.positionAssignments=[],o.seedAssignments=[],o.matchUps=[],Zu({tournamentId:t==null?void 0:t.tournamentId,action:"resetVoluntaryConsolationStructure",matchUpIds:s,drawDefinition:e}),i&&(e.entries=e.entries.filter(l=>l.entryStage!==Lr)),ui({tournamentId:t==null?void 0:t.tournamentId,eventId:r==null?void 0:r.eventId,drawDefinition:e,structureIds:[o.structureId]}),{...Q}}function dL({drawPositions:t,structure:e}){var i;if([Ke,Ae].includes(e.stage)&&e.stageSequence===1)return;let{positionAssignments:r}=si({structure:e});(i=r==null?void 0:r.filter(({drawPosition:n})=>t==null?void 0:t.includes(n)))==null||i.forEach(n=>{_t({element:n,extension:{name:_P,value:!0}})})}function GP(t){var e,i;let{appliedPolicies:r,positionAction:n,drawDefinition:a}=t;if(((e=r==null?void 0:r.audit)==null?void 0:e[bf])===!1)return;let{extension:o}=vt({name:bf,element:a}),s=Array.isArray(o==null?void 0:o.value)?(o==null?void 0:o.value)??[]:[];if(!(s!=null&&s.length)){let u=a.structures.find(c=>c.stage===Ae);if(u){let c=(i=si({structure:u}).positionAssignments)==null?void 0:i.map(({drawPosition:d,participantId:p,bye:m,qualifier:h})=>({drawPosition:d,participantId:p,qualifier:h,bye:m}));s.push({name:"initialMainAssignments",initialAssignments:c})}}let l={value:s.concat(n),name:bf};_t({element:a,extension:l})}function yv({tournamentRecord:t,drawDefinition:e,event:i}){var r;let n=((r=(t==null?void 0:t.events)||i&&[i])==null?void 0:r.map(l=>l==null?void 0:l.drawDefinitions).flat().filter(Boolean))||e&&[e]||[],a={},o={},s=n.map(l=>{var u;return(u=l==null?void 0:l.structures)==null?void 0:u.filter(c=>c==null?void 0:c.structures)}).flat().filter(Boolean);for(let l of s){let{structures:u,structureId:c}=l??{};u&&c&&(a[c]=u==null?void 0:u.map(d=>d.structureId))&&u.forEach(d=>o[d.structureId]=l==null?void 0:l.structureId)}return{containedStructures:a,containerStructures:o}}function HP(t){var e;let{sides:i,matchUpType:r}=t||{},n=(e=t.potentialParticipants)!=null&&e.length?t.potentialParticipants.flat().map(o=>r===ei?(o==null?void 0:o.individualParticipantIds)||[]:o.participantId).flat():[],a=(i||[]).map(o=>{var s;return r===ei&&(((s=o==null?void 0:o.participant)==null?void 0:s.individualParticipantIds)||[])||(o==null?void 0:o.participantId)&&[o.participantId]||[]}).flat();return{individualParticipantIds:a.concat(n).flat(),enteredIndividualParticipantIds:a,potentialIndividualParticipantIds:n}}function To(t){return(t==null?void 0:t.tournamentRecords)??((t==null?void 0:t.tournamentRecord)&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord})??{}}var cw="SIGN_IN_STATUS",kX="SIGNED_OUT",cy="SIGNED_IN",Gn="TEAM",Dt="INDIVIDUAL",Ja="GROUP",ft="PAIR",Xt="TEAM",rI={TEAM_PARTICIPANT:Gn,INDIVIDUAL:Dt,GROUP:Ja,TEAM:Xt,PAIR:ft},n0e={INDIVIDUAL:Dt,GROUP:Ja,PAIR:ft,TEAM:Xt,SIGN_IN_STATUS:cw,SIGNED_OUT:kX,SIGNED_IN:cy};function pL({participantsProfile:t,participants:e=[],deepCopy:i}){let r=new Map,n=i!==!1?Ne(e,t==null?void 0:t.convertExtensions,!0):e,a=n.filter(l=>l.participantType===Xt),o=n.filter(l=>l.participantType===Ja),s=n.filter(l=>l.participantType===ft);return n.forEach(l=>{if(l.participantType===Dt){let{participantId:u}=l;l.groupParticipantIds=[],l.teamParticipantIds=[],l.pairParticipantIds=[],l.groups=[],l.teams=[],a.forEach(c=>{((c==null?void 0:c.individualParticipantIds)||[]).forEach(d=>{var p;d===u&&!((p=l.teamParticipantIds)!=null&&p.includes(c.participantId))&&(l.teamParticipantIds.push(c.participantId),r.get(c.participantId)||r.set(c.participantId,{participantName:c.participantName,participantId:c.participantId}),l.teams.push({participantRoleResponsibilities:c.participantRoleResponsibilities,participantOtherName:c.participantOtherName,participantName:c.participantName,participantId:c.participantId,teamId:c.teamId}))})}),s.forEach(c=>{((c==null?void 0:c.individualParticipantIds)||[]).forEach(d=>{d===u&&!l.pairParticipantIds.includes(c.participantId)&&l.pairParticipantIds.push(c.participantId)})}),o.forEach(c=>{((c==null?void 0:c.individualParticipantIds)||[]).forEach(d=>{d===u&&!l.groupParticipantIds.includes(c.participantId)&&(l.groupParticipantIds.push(c.participantId),l.groups.push({participantRoleResponsibilities:c.participantRoleResponsibilities,participantOtherName:c.participantOtherName,participantName:c.participantName,participantId:c.participantId}))})})}}),{participantsWithGroupings:n,groupInfo:Object.fromEntries(r)}}function xX(t){return t&&typeof String.fromCodePoint<"u"?t.toUpperCase().replace(/./g,e=>String.fromCodePoint(e.charCodeAt(0)+127397)):t}function a0e(t){let e=Object.assign({},...yc.filter(i=>i.ioc).map(i=>({[i.ioc]:i.iso})));return xX(e[t])}var yc=[{ioc:"",iso2:"",iso:"",label:"NONE",phone:""},{ioc:"AND",iso2:"AD",iso:"AND",label:"Andorra",phone:"376"},{ioc:"UAE",iso2:"AE",iso:"ARE",label:"United Arab Emirates",phone:"971"},{ioc:"AFG",iso2:"AF",iso:"AFG",label:"Afghanistan",phone:"93"},{ioc:"ANT",iso2:"AG",iso:"ATG",label:"Antigua and Barbuda",phone:"1-268"},{ioc:"AIA",iso2:"AI",iso:"AIA",label:"Anguilla",phone:"1-264"},{ioc:"ALB",iso2:"AL",iso:"ALB",label:"Albania",phone:"355"},{ioc:"ARM",iso2:"AM",iso:"ARM",label:"Armenia",phone:"374"},{ioc:"ANG",iso2:"AO",iso:"AGO",label:"Angola",phone:"244"},{ioc:"",iso2:"AQ",iso:"ATA",label:"Antarctica",phone:"672"},{ioc:"ARG",iso2:"AR",iso:"ARG",label:"Argentina",phone:"54"},{ioc:"ASA",iso2:"AS",iso:"ASM",label:"American Samoa",phone:"1-684"},{ioc:"AUT",iso2:"AT",iso:"AUT",label:"Austria",phone:"43"},{ioc:"AUS",iso2:"AU",iso:"AUS",label:"Australia",phone:"61",suggested:!0},{ioc:"ARU",iso2:"AW",iso:"ABW",label:"Aruba",phone:"297"},{ioc:"AZE",iso2:"AZ",iso:"AZE",label:"Azerbaijan",phone:"994"},{ioc:"BIH",iso2:"BA",iso:"BIH",label:"Bosnia and Herzegovina",phone:"387"},{ioc:"BAR",iso2:"BB",iso:"BRB",label:"Barbados",phone:"1-246"},{ioc:"BAN",iso2:"BD",iso:"BGD",label:"Bangladesh",phone:"880"},{ioc:"BEL",iso2:"BE",iso:"BEL",label:"Belgium",phone:"32"},{ioc:"BUR",iso2:"BF",iso:"BFA",label:"Burkina Faso",phone:"226"},{ioc:"BUL",iso2:"BG",iso:"BGR",label:"Bulgaria",phone:"359"},{ioc:"BRN",iso2:"BH",iso:"BHR",label:"Bahrain",phone:"973"},{ioc:"BDI",iso2:"BI",iso:"BDI",label:"Burundi",phone:"257"},{ioc:"BEN",iso2:"BJ",iso:"BEN",label:"Benin",phone:"229"},{ioc:"",iso2:"BL",iso:"BLM",label:"Saint Barthelemy",phone:"590"},{ioc:"BER",iso2:"BM",iso:"BMU",label:"Bermuda",phone:"1-441"},{ioc:"BRU",iso2:"BN",iso:"BRN",label:"Brunei Darussalam",phone:"673"},{ioc:"BOL",iso2:"BO",iso:"BOL",label:"Bolivia",phone:"591"},{ioc:"BRA",iso2:"BR",iso:"BRA",label:"Brazil",phone:"55"},{ioc:"BAH",iso2:"BS",iso:"BHS",label:"Bahamas",phone:"1-242"},{ioc:"BHU",iso2:"BT",iso:"BTN",label:"Bhutan",phone:"975"},{ioc:"",iso2:"BV",iso:"BVT",label:"Bouvet Island",phone:"47"},{ioc:"BOT",iso2:"BW",iso:"BWA",label:"Botswana",phone:"267"},{ioc:"BLR",iso2:"BY",iso:"BLR",label:"Belarus",phone:"375"},{ioc:"BIZ",iso2:"BZ",iso:"BLZ",label:"Belize",phone:"501"},{ioc:"CAN",iso2:"CA",iso:"CAN",label:"Canada",phone:"1",suggested:!0},{ioc:"",iso2:"CC",iso:"CCK",label:"Cocos (Keeling) Islands",phone:"61"},{ioc:"CGO",iso2:"CD",iso:"COG",label:"Congo, Republic of the",phone:"242"},{ioc:"CAF",iso2:"CF",iso:"CAF",label:"Central African Republic",phone:"236"},{ioc:"COD",iso2:"CG",iso:"CGD",label:"Congo, Democratic Republic of the",phone:"243"},{ioc:"SUI",iso2:"CH",iso:"CHE",label:"Switzerland",phone:"41"},{ioc:"CIV",iso2:"CI",iso:"CIV",label:"Cote d'Ivoire",phone:"225"},{ioc:"COK",iso2:"CK",iso:"COK",label:"Cook Islands",phone:"682"},{ioc:"CHI",iso2:"CL",iso:"CHL",label:"Chile",phone:"56"},{ioc:"CMR",iso2:"CM",iso:"CMR",label:"Cameroon",phone:"237"},{ioc:"CHN",iso2:"CN",iso:"CHN",label:"China",phone:"86"},{ioc:"COL",iso2:"CO",iso:"COL",label:"Colombia",phone:"57"},{ioc:"CRC",iso2:"CR",iso:"CRI",label:"Costa Rica",phone:"506"},{ioc:"CUB",iso2:"CU",iso:"CUB",label:"Cuba",phone:"53"},{ioc:"CPV",iso2:"CV",iso:"CPV",label:"Cape Verde",phone:"238"},{ioc:"CUW",iso2:"CW",iso:"CUW",label:"Curacao",phone:"599"},{ioc:"CXR",iso2:"CX",iso:"CXR",label:"Christmas Island",phone:"61"},{ioc:"CYP",iso2:"CY",iso:"CYP",label:"Cyprus",phone:"357"},{ioc:"CZE",iso2:"CZ",iso:"CZE",label:"Czech Republic",phone:"420"},{ioc:"GER",iso2:"DE",iso:"DEU",label:"Germany",phone:"49",suggested:!0},{ioc:"DJI",iso2:"DJ",iso:"DJI",label:"Djibouti",phone:"253"},{ioc:"DEN",iso2:"DK",iso:"DNK",label:"Denmark",phone:"45"},{ioc:"DMA",iso2:"DM",iso:"DMA",label:"Dominica",phone:"1-767"},{ioc:"DOM",iso2:"DO",iso:"DOM",label:"Dominican Republic",phone:"1-809"},{ioc:"ALG",iso2:"DZ",iso:"DZA",label:"Algeria",phone:"213"},{ioc:"ECU",iso2:"EC",iso:"ECU",label:"Ecuador",phone:"593"},{ioc:"EST",iso2:"EE",iso:"ESE",label:"Estonia",phone:"372"},{ioc:"EGY",iso2:"EG",iso:"EGY",label:"Egypt",phone:"20"},{ioc:"",iso2:"EH",iso:"ESH",label:"Western Sahara",phone:"212"},{ioc:"ERI",iso2:"ER",iso:"ERI",label:"Eritrea",phone:"291"},{ioc:"ESP",iso2:"ES",iso:"ESP",label:"Spain",phone:"34"},{ioc:"ETH",iso2:"ET",iso:"ETH",label:"Ethiopia",phone:"251"},{ioc:"FIN",iso2:"FI",iso:"FIN",label:"Finland",phone:"358"},{ioc:"FIJ",iso2:"FJ",iso:"FJI",label:"Fiji",phone:"679"},{ioc:"FLK",iso2:"FK",iso:"FLK",label:"Falkland Islands (Malvinas)",phone:"500"},{ioc:"FSM",iso2:"FM",iso:"FSM",label:"Micronesia, Federated States of",phone:"691"},{ioc:"FAR",iso2:"FO",iso:"FRO",label:"Faroe Islands",phone:"298"},{ioc:"FRA",iso2:"FR",iso:"FRA",label:"France",phone:"33",suggested:!0},{ioc:"GAB",iso2:"GA",iso:"GAB",label:"Gabon",phone:"241"},{ioc:"GBR",iso2:"GB",iso:"GBR",label:"United Kingdom",phone:"44"},{ioc:"GRN",iso2:"GD",iso:"GRD",label:"Grenada",phone:"1-473"},{ioc:"GEO",iso2:"GE",iso:"GEO",label:"Georgia",phone:"995"},{ioc:"FGU",iso2:"GF",iso:"GUF",label:"French Guiana",phone:"594"},{ioc:"",iso2:"GG",iso:"GGY",label:"Guernsey",phone:"44"},{ioc:"",iso2:"GH",iso:"GHA",label:"Ghana",phone:"233"},{ioc:"GIB",iso2:"GI",iso:"GIB",label:"Gibraltar",phone:"350"},{ioc:"GRL",iso2:"GL",iso:"GRL",label:"Greenland",phone:"299"},{ioc:"GAM",iso2:"GM",iso:"GMB",label:"Gambia",phone:"220"},{ioc:"GUI",iso2:"GN",iso:"GIN",label:"Guinea",phone:"224"},{ioc:"GUD",iso2:"GP",iso:"GLP",label:"Guadeloupe",phone:"590"},{ioc:"GEQ",iso2:"GQ",iso:"GNQ",label:"Equatorial Guinea",phone:"240"},{ioc:"GRE",iso2:"GR",iso:"GRC",label:"Greece",phone:"30"},{ioc:"",iso2:"GS",iso:"SGS",label:"South Georgia and the South Sandwich Islands",phone:"500"},{ioc:"GUA",iso2:"GT",iso:"GTM",label:"Guatemala",phone:"502"},{ioc:"GUM",iso2:"GU",iso:"GUM",label:"Guam",phone:"1-671"},{ioc:"GBS",iso2:"GW",iso:"GNB",label:"Guinea-Bissau",phone:"245"},{ioc:"GUY",iso2:"GY",iso:"GUY",label:"Guyana",phone:"592"},{ioc:"HKG",iso2:"HK",iso:"HKG",label:"Hong Kong",phone:"852"},{ioc:"",iso2:"HM",iso:"HMD",label:"Heard Island and McDonald Islands",phone:"672"},{ioc:"HON",iso2:"HN",iso:"HND",label:"Honduras",phone:"504"},{ioc:"CRO",iso2:"HR",iso:"HRV",label:"Croatia",phone:"385"},{ioc:"HAI",iso2:"HT",iso:"HTI",label:"Haiti",phone:"509"},{ioc:"HUN",iso2:"HU",iso:"HUN",label:"Hungary",phone:"36"},{ioc:"INA",iso2:"ID",iso:"IDN",label:"Indonesia",phone:"62"},{ioc:"IRL",iso2:"IE",iso:"IRL",label:"Ireland",phone:"353"},{ioc:"ISR",iso2:"IL",iso:"ISR",label:"Israel",phone:"972"},{ioc:"",iso2:"IM",iso:"IMN",label:"Isle of Man",phone:"44"},{ioc:"IND",iso2:"IN",iso:"IND",label:"India",phone:"91"},{ioc:"",iso2:"IO",iso:"IOT",label:"British Indian Ocean Territory",phone:"246"},{ioc:"IRQ",iso2:"IQ",iso:"IRQ",label:"Iraq",phone:"964"},{ioc:"IRI",iso2:"IR",iso:"IRN",label:"Iran, Islamic Republic of",phone:"98"},{ioc:"ISL",iso2:"IS",iso:"ISL",label:"Iceland",phone:"354"},{ioc:"ITA",iso2:"IT",iso:"ITA",label:"Italy",phone:"39"},{ioc:"",iso2:"JE",iso:"JEY",label:"Jersey",phone:"44"},{ioc:"JAM",iso2:"JM",iso:"JAM",label:"Jamaica",phone:"1-876"},{ioc:"JOR",iso2:"JO",iso:"JOR",label:"Jordan",phone:"962"},{ioc:"JPN",iso2:"JP",iso:"JPN",label:"Japan",phone:"81",suggested:!0},{ioc:"KEN",iso2:"KE",iso:"KEN",label:"Kenya",phone:"254"},{ioc:"KGZ",iso2:"KG",iso:"KGZ",label:"Kyrgyzstan",phone:"996"},{ioc:"CAM",iso2:"KH",iso:"KHM",label:"Cambodia",phone:"855"},{ioc:"KIR",iso2:"KI",iso:"KIR",label:"Kiribati",phone:"686"},{ioc:"COM",iso2:"KM",iso:"COM",label:"Comoros",phone:"269"},{ioc:"SKN",iso2:"KN",iso:"KNA",label:"Saint Kitts and Nevis",phone:"1-869"},{ioc:"KOR",iso2:"KP",iso:"KOR",label:"Korea, Democratic People's Republic of",phone:"850"},{ioc:"PRK",iso2:"KR",iso:"PRK",label:"Korea, Republic of",phone:"82"},{ioc:"KUW",iso2:"KW",iso:"KWT",label:"Kuwait",phone:"965"},{ioc:"CAY",iso2:"KY",iso:"CYM",label:"Cayman Islands",phone:"1-345"},{ioc:"KAZ",iso2:"KZ",iso:"KAZ",label:"Kazakhstan",phone:"7"},{ioc:"LAO",iso2:"LA",iso:"LAO",label:"Lao People's Democratic Republic",phone:"856"},{ioc:"LIB",iso2:"LB",iso:"LBN",label:"Lebanon",phone:"961"},{ioc:"LCA",iso2:"LC",iso:"LCA",label:"Saint Lucia",phone:"1-758"},{ioc:"LIE",iso2:"LI",iso:"LIE",label:"Liechtenstein",phone:"423"},{ioc:"SRI",iso2:"LK",iso:"LKA",label:"Sri Lanka",phone:"94"},{ioc:"LBR",iso2:"LR",iso:"LBR",label:"Liberia",phone:"231"},{ioc:"LES",iso2:"LS",iso:"LSO",label:"Lesotho",phone:"266"},{ioc:"LTU",iso2:"LT",iso:"LTU",label:"Lithuania",phone:"370"},{ioc:"LUX",iso2:"LU",iso:"LUX",label:"Luxembourg",phone:"352"},{ioc:"LAT",iso2:"LV",iso:"LVA",label:"Latvia",phone:"371"},{ioc:"LBA",iso2:"LY",iso:"LBY",label:"Libya",phone:"218"},{ioc:"MAR",iso2:"MA",iso:"MAR",label:"Morocco",phone:"212"},{ioc:"MON",iso2:"MC",iso:"MCO",label:"Monaco",phone:"377"},{ioc:"MDA",iso2:"MD",iso:"MDA",label:"Moldova, Republic of",phone:"373"},{ioc:"MNE",iso2:"ME",iso:"MNE",label:"Montenegro",phone:"382"},{ioc:"",iso2:"MF",iso:"MAF",label:"Saint Martin (French part)",phone:"590"},{ioc:"MAD",iso2:"MG",iso:"MDG",label:"Madagascar",phone:"261"},{ioc:"MSH",iso2:"MH",iso:"MHL",label:"Marshall Islands",phone:"692"},{ioc:"MKD",iso2:"MK",iso:"MKD",label:"Macedonia, the Former Yugoslav Republic of",phone:"389"},{ioc:"MLI",iso2:"ML",iso:"MLI",label:"Mali",phone:"223"},{ioc:"MYA",iso2:"MM",iso:"MMR",label:"Myanmar",phone:"95"},{ioc:"MGL",iso2:"MN",iso:"MNG",label:"Mongolia",phone:"976"},{ioc:"MAC",iso2:"MO",iso:"MAC",label:"Macao",phone:"853"},{ioc:"NMA",iso2:"MP",iso:"NMP",label:"Northern Mariana Islands",phone:"1-670"},{ioc:"MRT",iso2:"MQ",iso:"MTQ",label:"Martinique",phone:"596"},{ioc:"MTN",iso2:"MR",iso:"MRT",label:"Mauritania",phone:"222"},{ioc:"MNT",iso2:"MS",iso:"MSR",label:"Montserrat",phone:"1-664"},{ioc:"MLT",iso2:"MT",iso:"MLT",label:"Malta",phone:"356"},{ioc:"MRI",iso2:"MU",iso:"MUS",label:"Mauritius",phone:"230"},{ioc:"MDV",iso2:"MV",iso:"MDV",label:"Maldives",phone:"960"},{ioc:"MAW",iso2:"MW",iso:"MWI",label:"Malawi",phone:"265"},{ioc:"MEX",iso2:"MX",iso:"MEX",label:"Mexico",phone:"52"},{ioc:"MAS",iso2:"MY",iso:"MYS",label:"Malaysia",phone:"60"},{ioc:"MOZ",iso2:"MZ",iso:"MOZ",label:"Mozambique",phone:"258"},{ioc:"NAM",iso2:"NA",iso:"NAM",label:"Namibia",phone:"264"},{ioc:"NCL",iso2:"NC",iso:"NCL",label:"New Caledonia",phone:"687"},{ioc:"NIG",iso2:"NE",iso:"NER",label:"Niger",phone:"227"},{ioc:"NFI",iso2:"NF",iso:"NFK",label:"Norfolk Island",phone:"672"},{ioc:"NGR",iso2:"NG",iso:"NGA",label:"Nigeria",phone:"234"},{ioc:"NCA",iso2:"NI",iso:"NIC",label:"Nicaragua",phone:"505"},{ioc:"NED",iso2:"NL",iso:"NLD",label:"Netherlands",phone:"31"},{ioc:"NOR",iso2:"NO",iso:"NOR",label:"Norway",phone:"47"},{ioc:"NEP",iso2:"NP",iso:"NPL",label:"Nepal",phone:"977"},{ioc:"NRU",iso2:"NR",iso:"NRU",label:"Nauru",phone:"674"},{ioc:"NIU",iso2:"NU",iso:"NIU",label:"Niue",phone:"683"},{ioc:"NZL",iso2:"NZ",iso:"NZL",label:"New Zealand",phone:"64"},{ioc:"OMA",iso2:"OM",iso:"OMN",label:"Oman",phone:"968"},{ioc:"PAN",iso2:"PA",iso:"PAN",label:"Panama",phone:"507"},{ioc:"PER",iso2:"PE",iso:"PER",label:"Peru",phone:"51"},{ioc:"FPO",iso2:"PF",iso:"PYF",label:"French Polynesia",phone:"689"},{ioc:"PNG",iso2:"PG",iso:"PNG",label:"Papua New Guinea",phone:"675"},{ioc:"PHI",iso2:"PH",iso:"PHL",label:"Philippines",phone:"63"},{ioc:"PAK",iso2:"PK",iso:"PAK",label:"Pakistan",phone:"92"},{ioc:"POL",iso2:"PL",iso:"POL",label:"Poland",phone:"48"},{ioc:"SPM",iso2:"PM",iso:"SPM",label:"Saint Pierre and Miquelon",phone:"508"},{ioc:"",iso2:"PN",iso:"PCN",label:"Pitcairn",phone:"870"},{ioc:"PUR",iso2:"PR",iso:"PRI",label:"Puerto Rico",phone:"1"},{ioc:"PLE",iso2:"PS",iso:"PSE",label:"Palestine, State of",phone:"970"},{ioc:"POR",iso2:"PT",iso:"PRT",label:"Portugal",phone:"351"},{ioc:"PLW",iso2:"PW",iso:"PLW",label:"Palau",phone:"680"},{ioc:"PAR",iso2:"PY",iso:"PRY",label:"Paraguay",phone:"595"},{ioc:"QAT",iso2:"QA",iso:"QAT",label:"Qatar",phone:"974"},{ioc:"REU",iso2:"RE",iso:"REU",label:"Reunion",phone:"262"},{ioc:"ROU",iso2:"RO",iso:"ROU",label:"Romania",phone:"40"},{ioc:"SRB",iso2:"RS",iso:"SRB",label:"Serbia",phone:"381"},{ioc:"RUS",iso2:"RU",iso:"RUS",label:"Russia",phone:"7"},{ioc:"RWA",iso2:"RW",iso:"RWA",label:"Rwanda",phone:"250"},{ioc:"KSA",iso2:"SA",iso:"SAU",label:"Saudi Arabia",phone:"966"},{ioc:"SOL",iso2:"SB",iso:"SLB",label:"Solomon Islands",phone:"677"},{ioc:"SEY",iso2:"SC",iso:"SYC",label:"Seychelles",phone:"248"},{ioc:"SUD",iso2:"SD",iso:"SDN",label:"Sudan",phone:"249"},{ioc:"SWE",iso2:"SE",iso:"SWE",label:"Sweden",phone:"46"},{ioc:"SIN",iso2:"SG",iso:"SGP",label:"Singapore",phone:"65"},{ioc:"HEL",iso2:"SH",iso:"SHN",label:"Saint Helena",phone:"290"},{ioc:"SLO",iso2:"SI",iso:"SVN",label:"Slovenia",phone:"386"},{ioc:"",iso2:"SJ",iso:"SJM",label:"Svalbard and Jan Mayen",phone:"47"},{ioc:"SVK",iso2:"SK",iso:"SVK",label:"Slovakia",phone:"421"},{ioc:"SLE",iso2:"SL",iso:"SLE",label:"Sierra Leone",phone:"232"},{ioc:"SMR",iso2:"SM",iso:"SMR",label:"San Marino",phone:"378"},{ioc:"SEN",iso2:"SN",iso:"SEN",label:"Senegal",phone:"221"},{ioc:"SOM",iso2:"SO",iso:"SOM",label:"Somalia",phone:"252"},{ioc:"SUR",iso2:"SR",iso:"SUR",label:"Suriname",phone:"597"},{ioc:"",iso2:"SS",iso:"SSD",label:"South Sudan",phone:"211"},{ioc:"STP",iso2:"ST",iso:"STP",label:"Sao Tome and Principe",phone:"239"},{ioc:"ESA",iso2:"SV",iso:"SLV",label:"El Salvador",phone:"503"},{ioc:"",iso2:"SX",iso:"SMX",label:"Sint Maarten",phone:"1-721"},{ioc:"SYR",iso2:"SY",iso:"SYR",label:"Syria",phone:"963"},{ioc:"",iso2:"SZ",iso:"SWZ",label:"Swaziland",phone:"268"},{ioc:"TKS",iso2:"TC",iso:"TCA",label:"Turks and Caicos Islands",phone:"1-649"},{ioc:"CHA",iso2:"TD",iso:"TCD",label:"Chad",phone:"235"},{ioc:"",iso2:"TF",iso:"ATF",label:"French Southern Territories",phone:"262"},{ioc:"TOG",iso2:"TG",iso:"TGO",label:"Togo",phone:"228"},{ioc:"THA",iso2:"TH",iso:"THA",label:"Thailand",phone:"66"},{ioc:"TJK",iso2:"TJ",iso:"TJK",label:"Tajikistan",phone:"992"},{ioc:"",iso2:"TK",iso:"TKL",label:"Tokelau",phone:"690"},{ioc:"TLS",iso2:"TL",iso:"TLS",label:"Timor-Leste",phone:"670"},{ioc:"TKM",iso2:"TM",iso:"TKM",label:"Turkmenistan",phone:"993"},{ioc:"TUN",iso2:"TN",iso:"TUN",label:"Tunisia",phone:"216"},{ioc:"TGA",iso2:"TO",iso:"TON",label:"Tonga",phone:"676"},{ioc:"TUR",iso2:"TR",iso:"TUR",label:"Turkey",phone:"90"},{ioc:"TTO",iso2:"TT",iso:"TTO",label:"Trinidad and Tobago",phone:"1-868"},{ioc:"TUV",iso2:"TV",iso:"TUV",label:"Tuvalu",phone:"688"},{ioc:"TPE",iso2:"TW",iso:"TWN",label:"Taiwan",phone:"886"},{ioc:"TAN",iso2:"TZ",iso:"TZA",label:"United Republic of Tanzania",phone:"255"},{ioc:"UKR",iso2:"UA",iso:"UKR",label:"Ukraine",phone:"380"},{ioc:"UGA",iso2:"UG",iso:"UGA",label:"Uganda",phone:"256"},{ioc:"USA",iso2:"US",label:"United States",phone:"1",suggested:!0,iso:"USA"},{ioc:"URU",iso2:"UY",iso:"URY",label:"Uruguay",phone:"598"},{ioc:"UZB",iso2:"UZ",iso:"UZB",label:"Uzbekistan",phone:"998"},{ioc:"",iso2:"VA",iso:"VAT",label:"Holy See (Vatican City State)",phone:"379"},{ioc:"VIN",iso2:"VC",iso:"VCT",label:"Saint Vincent and the Grenadines",phone:"1-784"},{ioc:"VEN",iso2:"VE",iso:"VEN",label:"Venezuela",phone:"58"},{ioc:"IVB",iso2:"VG",iso:"VGB",label:"British Virgin Islands",phone:"1-284"},{ioc:"ISV",iso2:"VI",iso:"VIR",label:"US Virgin Islands",phone:"1-340"},{ioc:"VIE",iso2:"VN",iso:"VNM",label:"Vietnam",phone:"84"},{ioc:"VAN",iso2:"VU",iso:"VUT",label:"Vanuatu",phone:"678"},{ioc:"WAF",iso2:"WF",iso:"WLF",label:"Wallis and Futuna",phone:"681"},{ioc:"SAM",iso2:"WS",iso:"WSM",label:"Samoa",phone:"685"},{ioc:"KOS",iso2:"XK",iso:"KOS",label:"Kosovo",phone:"383"},{ioc:"YEM",iso2:"YE",iso:"YEM",label:"Yemen",phone:"967"},{ioc:"MAY",iso2:"YT",iso:"MYT",label:"Mayotte",phone:"262"},{ioc:"RSA",iso2:"ZA",iso:"ZAF",label:"South Africa",phone:"27"},{ioc:"ZAM",iso2:"ZM",iso:"ZMB",label:"Zambia",phone:"260"},{ioc:"ZIM",iso2:"ZW",iso:"ZWE",label:"Zimbabwe",phone:"263"}];function FX({participant:t,withISO2:e,withIOC:i}){let{person:r,individualParticipants:n}=t,a=[r,n==null?void 0:n.map(({person:s})=>s)].flat().filter(Boolean);function o(s){let{nationalityCode:l}=s||{};if(l){let u=yc.find(({iso:c})=>c===l);i&&u!=null&&u.ioc&&!s.iocNationalityCode&&(s.iocNationalityCode=u.ioc),e&&u!=null&&u.iso2&&!s.iso2NationalityCode&&(s.iso2NationalityCode=u.iso2),u!=null&&u.label&&!s.countryName&&(s.countryName=u.label)}}a.forEach(o)}function o0e({participantMap:t,template:e}){var i;let r=Object.values(t);for(let n of r){let a=n.participant;if((i=a.individualParticipantIds)!=null&&i.length){a.individualParticipants=[];for(let o of a.individualParticipantIds){let s=t[o].participant;a.individualParticipants.push(e?km({template:e,source:s}):s)}}}}function nd(t){var e;let{tournamentRecord:i,participantId:r}=t,n=t.tournamentRecords||i&&{[i.tournamentId]:i}||{};for(let a of Object.values(n)){let o=(e=a.participants)==null?void 0:e.find(s=>s.participantId===r);if(o)return{participant:o,tournamentId:a.tournamentId}}return{error:Wi}}function LX(t){let{tournamentRecord:e,participantId:i}=t;if(i){let r=nd({tournamentRecord:e,participantId:i});return r.participant??r}return t.element||t.drawDefinition||t.event||t.tournamentRecord||{error:Je}}function Do(t){let{returnPreviousValues:e,itemSubTypes:i,itemType:r}=t,n=LX(t);if(n.error)return n;if(i&&!Array.isArray(i))return{error:se,context:{itemSubTypes:i}};if(!Array.isArray(n.timeItems))return{error:dF};let a=n.timeItems.filter(s=>(s==null?void 0:s.itemType)===r).filter(s=>!(i!=null&&i.length)||i.some(l=>{var u;return(u=s==null?void 0:s.itemSubTypes)==null?void 0:u.includes(l)})).sort((s,l)=>{let u=new Date(s.createdAt||void 0).getTime(),c=new Date(l.createdAt||void 0).getTime();return u-c}),o=Ne(a.pop(),!1,!0);if(o){let s={timeItem:o,...Q};return e&&Object.assign(s,{previousItems:a}),s}else return{info:jr}}function mL({returnPreviousValues:t,drawDefinition:e,itemSubTypes:i,itemType:r}){if(!e)return{error:Fs};if(!e.timeItems)return{info:jr};let{timeItem:n,previousItems:a,info:o}=Do({element:e,returnPreviousValues:t,itemSubTypes:i,itemType:r});return n&&{timeItem:n,previousItems:a}||{info:o}}function dw({returnPreviousValues:t,itemSubTypes:e,itemType:i,event:r}){if(!r)return{error:vi};if(!r.timeItems)return{info:jr};let{timeItem:n,previousItems:a,info:o}=Do({returnPreviousValues:t,element:r,itemSubTypes:e,itemType:i});return n&&{timeItem:n,previousItems:a}||{info:o}}function zP({returnPreviousValues:t,tournamentRecord:e,itemSubTypes:i,itemType:r}){if(!e)return{error:ve};if(!e.timeItems)return{info:jr};let{timeItem:n,previousItems:a,info:o}=Do({element:e,returnPreviousValues:t,itemSubTypes:i,itemType:r});return n&&{timeItem:n,previousItems:a}||{info:o}}function hL({returnPreviousValues:t,tournamentRecord:e,participantId:i,itemSubTypes:r,itemType:n}){if(!e)return{error:ve};if(!i)return{error:hr};let a=nd({tournamentRecord:e,participantId:i});if(a.error)return a;let{participant:o}=a;if(!(o!=null&&o.timeItems))return{info:jr};let{timeItem:s,previousItems:l,info:u}=Do({element:a.participant,returnPreviousValues:t,itemSubTypes:r,itemType:n});return s&&{timeItem:s,previousItems:l}||{info:u}}var s0e={[Ja]:"groupParticipantIds",[ft]:"pairParticipantIds",[Xt]:"teamParticipantIds"},l0e={[Ja]:"groups",[Xt]:"teams"};function _X({withIndividualParticipants:t,convertExtensions:e,tournamentRecord:i,withSignInStatus:r,withScaleValues:n,internalUse:a,withISO2:o,withIOC:s}){let l=[],u={};for(let c of i.participants??[]){let d=c==null?void 0:c.participantId;d&&d0e({participantMap:u,participantId:d})}for(let c of i.participants??[]){let d=Ne(c,e,a),{participantId:p,individualParticipantIds:m,participantType:h}=d;if(!u[p]){l.push(p);continue}if(Object.assign(u[p].participant,d),m){let f=c0e({individualParticipantIds:m,participantCopy:d,participantMap:u,participantType:h,participantId:p});f.missingParticipantIds.length&&l.push(...f.missingParticipantIds)}if(r&&(u[p].participant.signedIn=u0e(d)),n){let{ratings:f,rankings:g,seedings:v}=fv({participant:d});u[p].participant.seedings=v,u[p].participant.rankings=g,u[p].participant.ratings=f}(s||o)&&FX({participant:u[p].participant,withISO2:o,withIOC:s})}if(t){let c=At(t)?t:void 0;o0e({participantMap:u,template:c})}return{missingParticipantIds:l,participantMap:u}}function u0e(t){let{timeItem:e}=Do({itemType:cw,element:t});return(e==null?void 0:e.itemValue)===cy}function c0e({individualParticipantIds:t,participantCopy:e,participantMap:i,participantType:r,participantId:n}){var a;let o=[];for(let s of t){let l=(a=i[s])==null?void 0:a.participant;if(!l){o.push(s);continue}if(l[s0e[r]].push(n),[Xt,Ja].includes(r)){let{participantRoleResponsibilities:u,participantOtherName:c,participantName:d,participantId:p,teamId:m}=e,h=l0e[r];l[h].push({participantRoleResponsibilities:u,participantOtherName:c,participantName:d,participantId:p,teamId:m})}if(r===ft){let u=t.find(c=>c!==s);i[s].pairIdMap[n]=u,i[s].pairIdMap[u]=n}}return{missingParticipantIds:o}}function d0e({participantMap:t,participantId:e}){if(t[e])return;let i={walkoverWins:0,defaultWins:0,walkovers:0,defaults:0,losses:0,wins:0};t[e]={structureParticipation:{},potentialMatchUps:{},scheduleConflicts:{},scheduleItems:[],participant:{groupParticipantIds:[],pairParticipantIds:[],teamParticipantIds:[],seedings:{},rankings:{},ratings:{},groups:[],teams:[]},statistics:{},opponents:{},pairIdMap:{},matchUps:{},events:{},draws:{},counters:{[ii]:{...i},[ei]:{...i},[Xt]:{...i},...i}}}function Rh({participantsProfile:t,useParticipantMap:e,tournamentRecord:i,contextProfile:r,inContext:n}){var a;if(e)return{participantMap:(a=_X({...t,...r,tournamentRecord:i}))==null?void 0:a.participantMap};let o=Ne(i.participants,!1,!0)||[];(t!=null&&t.withIOC||t!=null&&t.withISO2)&&o.forEach(l=>FX({participant:l,...t}));let s;if((n||t!=null&&t.withGroupings)&&o!=null&&o.length&&({participantsWithGroupings:o,groupInfo:s}=pL({participantsProfile:t,deepCopy:!1,participants:o})),(t==null?void 0:t.withScaleValues)&&(o==null?void 0:o.length))for(let l of o){let{ratings:u,rankings:c}=fv({participant:l});l.rankings=c,l.ratings=u}return{participants:o,groupInfo:s}}function Bt({onlySpecifiedPolicyTypes:t=!1,policyTypes:e=[],tournamentRecord:i,drawDefinition:r,structure:n,event:a}){if(!Array.isArray(e))return{error:eF};let o={};return i&&s(i),a&&s(a),r&&s(r),n&&s(n),{appliedPolicies:o,...Q};function s(l){var u,c;let d=(c=(u=l==null?void 0:l.extensions)==null?void 0:u.find(p=>p.name===ly))==null?void 0:c.value;if(d)for(let p of Object.keys(d))(t?e.includes(p):!e.length||e.includes(p))&&(o[p]=Ne(d[p],!1,!0))}}function ec({policyTypes:t=[],tournamentRecord:e,drawDefinition:i,structure:r,event:n}){if(!Array.isArray(t))return{error:eF};let{appliedPolicies:a}=Bt({tournamentRecord:e,drawDefinition:i,structure:r,event:n}),o={};for(let s of t){let l=a==null?void 0:a[s];l&&(o[s]=l)}return Object.keys(o).length?{policyDefinitions:o}:{info:Jf.message}}var $X="WALKOVER",S2="RETIRED",fL="COMPETITIVE",dy="ROUTINE",py="DECISIVE",QU="winRatio",p0e={[du]:{policyName:"Competitive Bands Default",profileBands:{[py]:20,[dy]:50}}},gL=p0e;function tc({policyDefinitions:t,tournamentRecord:e,contextProfile:i,drawDefinition:r,event:n}){let a={policies:{}};if(!i)return a;let o=ec({tournamentRecord:e,drawDefinition:r,event:n}).policyDefinitions;if(i.withCompetitiveness){let s=(t==null?void 0:t[du])??(o==null?void 0:o[du])??gL[du];a.policies[du]=s}return a}function Cp({tournamentRecord:t,drawDefinition:e,policyType:i,structure:r,event:n}){if(!t)return{error:ve};let{appliedPolicies:a}=Bt({tournamentRecord:t,drawDefinition:e,structure:r,event:n});return a!=null&&a[i]?{policy:a[i]}:{info:Jf==null?void 0:Jf.message}}function pw({tournamentRecord:t,categoryName:e,categoryType:i,event:r}){var n,a,o,s,l,u;e=e??((n=r==null?void 0:r.category)==null?void 0:n.categoryName)??((a=r==null?void 0:r.category)==null?void 0:a.ageCategoryCode),i=i??((o=r==null?void 0:r.category)==null?void 0:o.categoryType)??((s=r==null?void 0:r.category)==null?void 0:s.subType);let{policy:c}=Cp({policyType:td,tournamentRecord:t,event:r}),d=(l=t?vt({element:t,name:Lu}).extension:void 0)==null?void 0:l.value,p=(u=r&&vt({name:Lu,element:r}).extension)==null?void 0:u.value;return{scheduleTiming:{tournamentScheduling:d,eventScheduling:p,categoryName:e,categoryType:i,policy:c}}}function vL({drawDefinition:t,attributes:e}){let{extension:i}=vt({element:t,name:o0}),r=(i==null?void 0:i.value)||{};return e.forEach(n=>{Object.keys(n).forEach(a=>{r[a]?Object.assign(r[a],n[a]):r[a]=n[a]})}),i={name:o0,value:r},xP({drawDefinition:t,extension:i}),{entryProfile:r}}function mw({drawDefinition:t}){let{extension:e}=vt({element:t,name:o0});return{entryProfile:(e==null?void 0:e.value)||{}}}var qo="ALTERNATE",hw="CONFIRMED",ca="DIRECT_ACCEPTANCE",fw="FEED_IN",gw="JUNIOR_EXEMPT",_u="LUCKY_LOSER",vw="ORGANISER_ACCEPTANCE",Iw="QUALIFIER",m0e="REGISTERED",yw="SPECIAL_EXEMPT",Po="UNGROUPED",Mp="UNPAIRED",cg="WILDCARD",Jl="WITHDRAWN",ZU=[hw,ca,gw,vw,yw],BX=[fw,_u,Iw],Np=[hw,ca,fw,gw,vw,yw,cg],ds=[hw,ca,gw,_u,Iw,vw,yw,cg],VX=[qo,hw,ca,fw,gw,_u,vw,Iw,m0e,yw,Po,Mp,cg,Jl],h0e={ALTERNATE:qo,CONFIRMED:hw,DIRECT_ACCEPTANCE:ca,DIRECT_ENTRY_STATUSES:Np,DRAW_SPECIFIC_STATUSES:BX,EQUIVALENT_ACCEPTANCE_STATUSES:ZU,FEED_IN:fw,JUNIOR_EXEMPT:gw,LUCKY_LOSER:_u,ORGANISER_ACCEPTANCE:vw,QUALIFIER:Iw,SPECIAL_EXEMPT:yw,STRUCTURE_SELECTED_STATUSES:ds,UNGROUPED:Po,UNPAIRED:Mp,VALID_ENTRY_STATUSES:VX,WILDCARD:cg,WITHDRAWN:Jl};function IL({stage:t,drawDefinition:e}){let{entryProfile:i}=mw({drawDefinition:e}),r=Object.keys(i).includes(t);if(!r&&TP.includes(t)){let n=[{[t]:{drawSize:void 0,alternates:!0}}];return vL({drawDefinition:e,attributes:n}),!0}return r}function f0e({stage:t,drawDefinition:e}){var i;let{entryProfile:r}=mw({drawDefinition:e});return((i=r[t])==null?void 0:i.alternates)||0}function g0e({stage:t,drawDefinition:e}){var i;let{entryProfile:r}=mw({drawDefinition:e});return((i=r[t])==null?void 0:i.wildcardsCount)||0}function UM({stage:t,drawDefinition:e,entryStatus:i}){return e.entries.reduce((r,n)=>n.entryStage===t&&n.entryStatus===i?r+1:r,0)}function Eh({provisionalPositioning:t,placementGroup:e,drawDefinition:i,stageSequence:r,entryStatuses:n,structureId:a,roundTarget:o,stages:s,stage:l}){var u;let c=((u=i.entries)==null?void 0:u.reduce((d,p)=>{var m,h;let f=(h=(m=vt({name:yl,element:p}))==null?void 0:m.extension)==null?void 0:h.value,g=l&&p.entryStage===l||(s==null?void 0:s.length)&&p.entryStage&&s.includes(p.entryStage),v=!n||p.entryStatus&&n.includes(p.entryStatus),y=p.entryStageSequence??1;return g&&(!r||y===r)&&v&&(!o||!f||o===f)?d.concat(p):d},[]))??[];if(a&&l===Bi){let{playoffEntries:d,error:p}=v0e({provisionalPositioning:t,drawDefinition:i,structureId:a});return p&&console.log("playoff entries error"),(d!=null&&d.length?d:c).filter(m=>!e||m.placementGroup===e)}return c}function v0e({provisionalPositioning:t,drawDefinition:e,structureId:i}){let r=[],n=(e.links??[]).find(a=>a.linkType===Ou&&a.target.structureId===i);if(n){let{finishingPositions:a,structureId:o}=n.source,{structure:s}=tt({drawDefinition:e,structureId:o});(s==null?void 0:s.structureType)===_n&&(s.structures??[]).forEach(l=>{let u=l.positionAssignments??[],{structureId:c}=l,d=c,p=Object.assign({},...u.map(f=>{var g;let{participantId:v}=f,y=(g=vt({element:f,name:Oc}).extension)==null?void 0:g.value;return y&&v?{[v]:y}:void 0}).filter(Boolean)),m=Object.keys(p).reduce((f,g)=>{let v=p[g],y=v.groupOrder||t&&v.provisionalOrder;return f.includes(y)||f.push(y),f},[]).length===Object.keys(p).length,h=Object.keys(p).filter(f=>{let g=p[f],v=g.groupOrder||t&&g.provisionalOrder;return a==null?void 0:a.includes(v)});(!t||m)&&h.forEach(f=>{let g=p[f],{groupOrder:v,provisionalOrder:y,GEMscore:I}=g,b=v||t&&y,S=[...a??[]].sort(lr).indexOf(b)+1;r.push({entryStage:Bi,entryStatus:fw,placementGroup:S,groupingValue:d,participantId:f,GEMscore:I})})})}return{playoffEntries:r}}function I0e({stage:t,drawDefinition:e}){return Np.reduce((i,r)=>(UM({drawDefinition:e,entryStatus:r,stage:t})||0)+i,0)}function go({provisionalPositioning:t,returnAllProxies:e,drawDefinition:i,structureId:r,structure:n}){var a;let o,s=[];n||({structure:n,error:o}=tt({drawDefinition:i,structureId:r}));let l=si({structure:n}).positionAssignments;if(o||!n)return{seedAssignments:[],error:Ai};r||(r=n.structureId);let{stage:u,stageSequence:c}=n,d=u===Bi&&i&&Eh({provisionalPositioning:t,drawDefinition:i,stageSequence:c,structureId:r,stage:u}),p=d?d.filter(f=>f.placementGroup===1).sort((f,g)=>f.GEMscore<g.GEMscore&&1||f.GEMscore>g.GEMscore&&-1||0).map((f,g)=>{let v=g+1;return{participantId:f.participantId,seedValue:v,seedProxy:!0,seedNumber:v}}):[],m=p==null?void 0:p.slice(0,e?p.length:l.length/2);m.length?s=m:n.seedAssignments?s=n.seedAssignments:o=HK;let h=n.seedLimit??((a=n==null?void 0:n.positionAssignments)==null?void 0:a.length);return{seedAssignments:s,stageSequence:c,seedLimit:h,stage:u,error:o}}function $s(t){if(!t)return;let{tieFormatId:e,tieFormats:i}=t;if(t.tieFormat)return t.tieFormat;if(e&&Array.isArray(i))return i.find(r=>r.tieFormatId===e)}function nI({item:t,drawDefinition:e,structure:i,event:r}){var n,a,o;if(t){if(t.tieFormat)return t.tieFormat;if(t.tieFormatId)return e.tieFormat?e.tieFormat:((n=e.tieFormats)==null?void 0:n.find(s=>t.tieFormatId===s.tieFormatId))||(r.tieFormat?r.tieFormat:(a=r.tieFormats)==null?void 0:a.find(s=>t.tieFormatId===s.tieFormatId));if(i.tieFormat)return i.tieFormat;if(i.tieFormatId){let s=(o=e.tieFormats)==null?void 0:o.find(l=>i.tieFormatId===l.tieFormatId);if(s)return s}}}function In({drawDefinition:t,structure:e,matchUp:i,event:r}){return{tieFormat:nI({item:i,drawDefinition:t,structure:e,event:r})||nI({item:e,drawDefinition:t,structure:e,event:r})||$s(t)||$s(r)}}function y0e({matchUps:t}){let e=t.reduce((i,r)=>!r.collectionPosition||i.includes(r.collectionPosition)?i:i.concat(r.collectionPosition),[]).map(i=>({[i]:t.filter(r=>r.collectionPosition===i)}));return{collectionPositionMatchUps:Object.assign({},...e)}}function ln({drawDefinition:t,structure:e}){let i={},r=[];return((t==null?void 0:t.structures)??[e]).filter(n=>n&&typeof n=="object").forEach(n=>{if(!n)return;let{structureId:a,matchUps:o,structures:s}=n,l=Array.isArray(s);if(l)l&&s.forEach(u=>{let{structureName:c}=u,d=u.matchUps;i[u.structureId]={matchUps:d,itemStructureIds:[],structureName:c},d&&(r.push(...d),d.forEach(p=>{p.tieMatchUps&&r.push(...p.tieMatchUps)})),i[a]||(i[a]={itemStructureIds:[],matchUps:[]}),i[a].itemStructureIds||(i[a].itemStructureIds=[]),i[a].itemStructureIds.push(u.structureId)});else{let u=o;i[a]={matchUps:u,itemStructureIds:[]},u==null||u.forEach(c=>{r.push(c),c.tieMatchUps&&r.push(...c.tieMatchUps)})}}),{mappedMatchUps:i,drawMatchUps:r}}function Zd({mappedMatchUps:t,matchUpsMap:e,structureId:i,inContext:r}){t=(e==null?void 0:e.mappedMatchUps)??t;let n=t[i],a=((n==null?void 0:n.itemStructureIds)||[]).map(o=>{let{matchUps:s,structureName:l}=t[o];return r?s.map(u=>Object.assign(Ne(u,!0,!0),{containerStructureId:i,structureId:o,structureName:l})):s}).flat();return((n==null?void 0:n.matchUps)||[]).concat(...a)}function jX({groupedOrder:t,roundPositionsCount:e}){if(!t||(t==null?void 0:t.length)<=e)return t;let i=Cr(t,t.length/e).map(n=>n.reduce((a,o)=>a+o)),r=i.slice().sort(lr);return i.map(n=>r.indexOf(n)+1)}function WP(t){if(!At(t))return!1;let{matchUpId:e,drawPositions:i}=t,r=typeof e=="string",n=!i||Array.isArray(i)&&i.length<=2&&i.every(a=>st(a)||a===void 0||a===null);return r&&n}function Ro(t){return Array.isArray(t)?t.every(WP):!1}function An({matchUps:t=[],interpolate:e}){var i;if(!Ro(t))return{roundMatchUps:[],error:se};let r=t.reduce((p,m)=>{let h=typeof m.roundNumber=="string"?Ze(m.roundNumber):m.roundNumber;return!m.roundNumber||p.includes(h)?p:p.concat(h)},[]).sort(lr).map(p=>{let m=t.filter(g=>g.roundNumber===p),h=m.find(({matchUpType:g})=>g===fi)?m.filter(({matchUpType:g})=>g===fi):m,f=g=>g.sort((v,y)=>lr(v.roundPosition,y.roundPosition));return{[p]:f(h)}}),n=t.reduce((p,m)=>{let h=typeof m.roundNumber=="string"?Ze(m.roundNumber):m.roundNumber;return p[h]||(p[h]=He({abbreviatedRoundName:m.abbreviatedRoundName,finishingRound:m.finishingRound,roundName:m.roundName})),p},{}),a=Object.assign({},...r);if(e){let p=Math.max(...Object.keys(a).map(h=>Ze(h)).filter(h=>!isNaN(h))),m=(i=a[p])==null?void 0:i.length;if(m>1&&Cs(m)){let h=p+1,f=h+m/2;Te(h,f).forEach((g,v)=>{a[g]=Te(0,m/(2+v*2)).map(()=>({}))})}}let o=0,s=Object.assign({},...Object.keys(a).map(p=>{var m,h,f;let g=(m=a[p])==null?void 0:m.length,v=(f=(h=a[p])==null?void 0:h.filter(I=>{var b;return!yr.includes(I.matchUpStatus)&&!((b=I.score)!=null&&b.scoreStringSide1)}))==null?void 0:f.length,y=g&&g===v;return o=Math.max(o,g),{[p]:{matchUpsCount:g,inactiveCount:v,inactiveRound:y}}})),l=0,u=0,c=Object.keys(a).map(p=>Ze(p)).filter(p=>!isNaN(p));c.forEach(p=>{var m,h,f,g,v;let y=a[p].sort((b,S)=>b.roundPosition-S.roundPosition),I=y.map(b=>(b==null?void 0:b.drawPositions)||[]).flat();if(s[p].roundNumber=p,s[p].roundFactor=s[p].matchUpsCount?o/s[p].matchUpsCount:1,s[p].finishingRound=(m=n[p])==null?void 0:m.finishingRound,s[p].roundName=(h=n[p])==null?void 0:h.roundName,s[p].abbreviatedRoundName=(f=n[p])==null?void 0:f.abbreviatedRoundName,s[p].finishingPositionRange=(v=(g=a[p])==null?void 0:g[0])==null?void 0:v.finishingPositionRange,p===1||!s[p-1]){let b=I.sort(lr),S=Cr(b,2);s[p].drawPositions=b,s[p].pairedDrawPositions=S}else{let b=s[p-1],S=b.drawPositions,w=b.matchUpsCount/s[p].matchUpsCount,U=Cr(S,w),T=y.map(D=>{let{roundPosition:P}=D,E=[...D.drawPositions||[],void 0,void 0].slice(0,2);if(!P)return E;let R=(E==null?void 0:E.filter(Boolean))||[];if(!(R!=null&&R.length))return[void 0,void 0];if(p<3&&(R==null?void 0:R.length)===2)return E==null?void 0:E.slice().sort(lr);let N=ji(S,R).length!==(R==null?void 0:R.length);if(R!=null&&R.length&&N)return(R==null?void 0:R.length)===1?[R[0],void 0]:E==null?void 0:E.slice().sort(lr);let A=(P-1)*2;return U.slice(A,A+2).map(M=>R==null?void 0:R.find(C=>M.includes(C)))});s[p].drawPositions=T==null?void 0:T.flat(),s[p].pairedDrawPositions=T}s[p+1]&&s[p+1].matchUpsCount===s[p].matchUpsCount&&(s[p+1].feedRound=!0,s[p+1].feedRoundIndex=u,s[p].preFeedRound=!0,u+=1),s[p]&&!s[p].feedRound&&(s[p].roundIndex=l,l+=1)});let d=!!Object.values(s).find(({matchUpsCount:p})=>!Cs(p));return{hasNoRoundPositions:t.some(p=>!p.roundPosition),roundsNotPowerOf2:d,maxMatchUpsCount:o,roundMatchUps:a,roundNumbers:c,roundProfile:s,...Q}}function eS(t){if(!Array.isArray(t))return"";let e=t.filter(_i);return e.length?dt([Math.min(...e),Math.max(...e)]).join("-"):""}function b0e({drawDefinition:t,structureId:e,matchUpsMap:i}){if(!t)return{error:$e};if(!e)return{error:Xa};let{structure:r}=tt({drawDefinition:t,structureId:e});if((r==null?void 0:r.stage)!==an)return{error:Dp,info:"Structure is not CONSOLATION stage"};let{links:n}=t,a=(n==null?void 0:n.filter(d=>d.target.structureId===e))||[],o=(a==null?void 0:a.reduce((d,p)=>{let{structureId:m}=p.source;return d.includes(m)?d:d.concat(m)},[]))||[],s=Object.assign({},...o.map(d=>{let p=Zd({structureId:d,matchUpsMap:i}),m=An({matchUps:p}).roundProfile;return{[d]:m}})),l=Zd({matchUpsMap:i,structureId:e}),{roundProfile:u}=An({matchUps:l}),c={};return a==null||a.forEach(d=>{var p,m,h;let{structureId:f,roundNumber:g}=d.source,{feedProfile:v,groupedOrder:y,positionInterleave:I,roundNumber:b}=d.target,S=s[f],w=(p=S[1])==null?void 0:p.drawPositions,U=(m=S[g])==null?void 0:m.matchUpsCount;if(!U)return;let T=U?w.length/U:0,D=w.length/T,P=w.slice(),E=jX({roundPositionsCount:D,groupedOrder:y}),R=(E==null?void 0:E.length)||1;if(R<=D){let M=w.length/R,C=Cr(P,M);v===Kd&&C.forEach(O=>O.reverse()),P=(E==null?void 0:E.length)&&(E==null?void 0:E.map(O=>C[O-1]).flat())||P}let N=Cr(P,T);if(I){let M=Te(0,I.interleave).map(()=>{}),C=Te(0,I.offset).map(()=>{});N=N.map(k=>[k,...M]),N.unshift(C),N=N.flat(1);let O=N.length-I.offset;N=N.slice(0,O)}c[b]||(c[b]={});let A=(h=u==null?void 0:u[b])!=null&&h.feedRound?2:1;N.forEach((M,C)=>{let O=1+C*A;c[b][O]||(c[b][O]=eS(M))})}),{sourceDrawPositionRanges:c}}function GX({drawDefinition:t}){if(typeof t!="object")return{error:sm};let e={},{structures:i=[],links:r=[]}=t||{},n=i.reduce((o,s)=>{let{stage:l}=s;return o[l]?o[l].push(s):o[l]=[s],o},{});for(let o of Object.keys(n)){let s=n[o].find(({stageSequence:u})=>u===1);if(!s)continue;let{structureId:l}=s;a({aggregator:{},targetRound:0,exitProfiles:e,exitProfile:"0",structureId:l,stage:o})}return{exitProfiles:e};function a({exitProfiles:o,exitProfile:s,structureId:l,targetRound:u,aggregator:c,stage:d}){o[l]||(o[l]=[]),s==="0"&&[an,Bi].includes(d)||o[l].push(s);let p=r.filter(m=>m.source.structureId===l&&m.source.roundNumber>=u);for(let m of p){let h=m.source.roundNumber,f=m.target.roundNumber,g=m.target.structureId,v=i.find(I=>I.structureId===g).stage,y=[v,g,f,h].join("|");if(c[y])return;c[y]=!0,a({exitProfile:`${s}-${h}`,structureId:g,exitProfiles:o,targetRound:f,aggregator:c,stage:v})}}}function w0e({drawDefinition:t,roundProfile:e,structureId:i,matchUpsMap:r}){var n;if(!t)return{error:$e};if(!i)return{error:Xa};if(!e){let s=Zd({matchUpsMap:r,structureId:i});if({roundProfile:e}=An({matchUps:s}),!e)return{error:Je}}let a=(Math.min(...((n=e==null?void 0:e[1])==null?void 0:n.drawPositions)??[])||1)-1,o=Object.keys(e);return{drawPositionsRanges:Object.assign({},...(o||[]).map(s=>{var l,u;let c=(l=e==null?void 0:e[s])==null?void 0:l.matchUpsCount,d=((u=e==null?void 0:e[1])==null?void 0:u.drawPositions)??[],p=Cr(d,d.length/c),m=p.map(eS),h=p.map(I=>I.map(b=>b-a)).map(eS),f=o.map(I=>{var b;if(I>s)return;let S=((b=e==null?void 0:e[I])==null?void 0:b.drawPositions)??[];return Cr(S,S.length/c)}).filter(Boolean),g=Te(0,c).map(I=>f.map(b=>b[I]).flat().filter(Boolean).sort(lr)).map(I=>dt(I)),v=g.map(I=>$we(I).map(eS).join(", ")),y=Object.assign({},...Te(0,c).map(I=>({[I+1]:{firstRoundDrawPositionsRange:m[I],firstRoundOffsetDrawPositionsRange:h[I],possibleDrawPositions:g[I],drawPositionsRange:v[I]}})));return{[s]:y}}))}}function yL({roundsNotPowerOf2:t,drawDefinition:e,structure:i,matchUps:r}){var n;if(!i)return!1;r=r??i.matchUps??[],t=t??An({matchUps:r}).roundsNotPowerOf2;let a=!!((n=i.positionAssignments)!=null&&n.find(({drawPosition:o})=>o))||!!(r!=null&&r.find(({drawPositions:o})=>o==null?void 0:o.length));return(!(e!=null&&e.drawType)||e.drawType!==Pp)&&!(i!=null&&i.structures)&&t&&a}function Yn({structure:t}){if(!t)return!1;let e=t.matchUps||t.roundMatchUps&&Object.values(t.roundMatchUps).flat(),i=!!(e!=null&&e.find(n=>n==null?void 0:n.roundPosition)),r=!!(e!=null&&e.find(n=>{var a;return(a=n==null?void 0:n.drawPositions)==null?void 0:a.length}));return!(t!=null&&t.structures)&&(t==null?void 0:t.stage)!==Lr&&(!e.length||!i&&!r)}var bL={[sg]:{policyName:"Round Naming Default",namingConventions:{round:"Round",pre:"Pre"},qualifyingFinishMap:{1:"Final"},abbreviatedRoundNamingMap:{1:"F",2:"SF",4:"QF"},roundNamingMap:{1:"Final",2:"Semifinal",4:"Quarterfinal"},affixes:{roundNumber:"R",preFeedRound:"Q",preQualifying:"P"},stageConstants:{[Ae]:"",[Bi]:"P",[Ke]:"Q",[an]:"C"}}},U0e=bL;function S0e({roundNamingPolicy:t,drawDefinition:e,structure:i,matchUps:r}){var n,a,o;let{roundProfile:s,roundMatchUps:l}=An({matchUps:r}),{structureAbbreviation:u,stage:c}=i,d=Yn({structure:i}),p=yL({structure:i}),m=i.structures,h={},f=bL[sg],g=i.stage===Ke,v=g?Math.max(...((e==null?void 0:e.structures)??[]).filter(M=>M.stage===Ke).map(({stageSequence:M})=>M??1),0):0,y=(i.stageSequence??1)<v?i.stageSequence??1:"",I=y&&(((n=t==null?void 0:t.affixes)==null?void 0:n.preQualifying)||f.affixes.preQualifying)||"",b=(t==null?void 0:t.roundNamingMap)||f.roundNamingMap||{},S=(t==null?void 0:t.abbreviatedRoundNamingMap)||f.abbreviatedRoundNamingMap||{},w=((a=t==null?void 0:t.affixes)==null?void 0:a.preFeedRound)||f.affixes.preFeedRound,U=((o=t==null?void 0:t.affixes)==null?void 0:o.roundNumber)||f.affixes.roundNumber,T=((t==null?void 0:t.namingConventions)||f.namingConventions).round,D=c&&c!==Ae?c[0]:"",P=(t==null?void 0:t.stageConstants)||f.stageConstants,E=c&&(P==null?void 0:P[c])||D,R=`${I}${E}${y}`,N=s?Object.keys(s):[],A=g&&P!=null&&P[Ke]?`${P==null?void 0:P[Ke]}-`:"";if(m||d||p)Object.assign(h,...N.map(M=>{let C=`${A}${T} ${M}`,O=`${U}${M}`;return{[M]:{roundName:C,abbreviatedRoundName:O}}}));else{let M=g&&((t==null?void 0:t.qualifyingFinishMap)||(f==null?void 0:f.qualifyingFinishMap)||{});Object.assign(h,...N.map(C=>{if(!(s!=null&&s[C]))return;let{matchUpsCount:O,preFeedRound:k}=s[C],x=O*2,F=(M==null?void 0:M[s==null?void 0:s[C].finishingRound])||M&&`${U}${x}`||b[O]||`${U}${x}`,$=k?`-${w}`:"",_=`${F}${$}`,L=[R,u,_].filter(Boolean).join("-"),B=`${S[O]||`${U}${x}`}${$}`,V=[R,u,B].filter(Boolean).join("-");return{[C]:{abbreviatedRoundName:V,roundName:L}}}))}return{roundNamingProfile:h,roundProfile:s,roundMatchUps:l}}var T0e=(t,e)=>(t||0)+(e||0);function HX(t,e){let i=Array.isArray(t)?t[0]:t;return isNaN(i)&&$X||i<=e[py]&&py||i<=e[dy]&&dy||fL}function zX({score:t}){let e=(t==null?void 0:t.sets)||[],i=e.reduce((n,a)=>(n[0]+=a.side1Score||0,n[1]+=a.side2Score||0,n),[0,0]),r=e.reduce((n,a)=>(n[0]+=a.side1TiebreakScore||0,n[1]+=a.side2TiebreakScore||0,n),[0,0]);return r.reduce(T0e)&&(i[r[0]>r[1]?0:1]+=1),{sets:e,games:i,score:t}}function D0e(t){let e=Math.min(...t.games),i=Math.max(...t.games);return Math.round(e/i*100)}function WX(t){return t.map(D0e).sort().map(e=>parseFloat(e.toFixed(2)))}function bw({tournamentRecord:t,profileBands:e,matchUp:i}){if(!i)return{error:sa};let{score:r,winningSide:n}=i;if(!n)return{error:se};let a=!e&&t&&Cp({policyType:du,tournamentRecord:t}).policy,o=e||(a==null?void 0:a.profileBands)||gL[du].profileBands,s=zX({score:r}),l=WX([s]),u=HX(l,o),c=Array.isArray(l)?l[0]:l;return{...Q,competitiveness:u,pctSpread:c}}function qX({matchUp:t}){var e,i,r;if(!t)return{error:sa};if(t&&!t.sides)return{error:la};if(t&&!t.hasContext)return{error:mP};let n=(e=t.sides??[])==null?void 0:e.map(u=>u==null?void 0:u.participantId).filter(Boolean),a=((i=t.sides)==null?void 0:i.filter(u=>{var c;return((c=u.participant)==null?void 0:c.participantType)===Dt}).map(u=>u.participantId).filter(Boolean))??[],o=(((r=t.sides??[])==null?void 0:r.map(u=>{var c;return(c=u.participant)==null?void 0:c.individualParticipants}).filter(Boolean))??[]).map(u=>(u??[]).map(c=>c==null?void 0:c.participantId).filter(Boolean)),s=[...a,...o.flat()].filter(Boolean)??[],l=dt(s.concat(n)).filter(Boolean)??[];return{nestedIndividualParticipantIds:o,allRelevantParticipantIds:l,individualParticipantIds:s,sideParticipantIds:n,...Q}}var l0="CHECK_IN",u0="CHECK_OUT",P0e="SCHEDULE",Ch="SCHEDULE.ASSIGNMENT.VENUE",Ql="SCHEDULE.ALLOCATION.COURTS",Lc="SCHEDULE.ASSIGNMENT.COURT",qP="SCHEDULE.COURT.ORDER",Mh="SCHEDULE.DATE",R0e="COMPLETED.DATE",wL="HOME_PARTICIPANT_ID",UL="SCHEDULE.ASSIGN.OFFICIAL",Nh="SCHEDULE.TIME.SCHEDULED",vs="SCHEDULE.TIME.START",Iu="SCHEDULE.TIME.STOP",Fl="SCHEDULE.TIME.RESUME",$u="SCHEDULE.TIME.END",YP="SCHEDULE.TIME.MODIFIERS",YX="TO_BE_ANNOUNCED",KX="NEXT_AVAILABLE",XX="FOLLOWED_BY",JX="AFTER_REST",QX="RAIN_DELAY",E0e="NOT_BEFORE",SM=[YX,KX,XX,JX,QX],C0e="ELIGIBILITY",M0e="REGISTRATION",N0e="SUSPENSION",A0e="MEDICAL",O0e="PENALTY",ZX="SCALE",eJ="RATING",tJ="RANKING",SL="SEEDING",ad="PUBLISH",Qa="PUBLIC",od="STATUS",k0e="MODIFICATION",x0e="RETRIEVAL",F0e="other",L0e={MUTUALLY_EXCLUSIVE_TIME_MODIFIERS:SM,AFTER_REST:JX,ALLOCATE_COURTS:Ql,ASSIGN_COURT:Lc,ASSIGN_OFFICIAL:UL,ASSIGN_VENUE:Ch,CHECK_IN:l0,CHECK_OUT:u0,COMPLETED_DATE:R0e,COURT_ORDER:qP,ELIGIBILITY:C0e,END_TIME:$u,FOLLOWED_BY:XX,MEDICAL:A0e,MODIFICATION:k0e,NEXT_AVAILABLE:KX,NOT_BEFORE:E0e,OTHER:F0e,PENALTY:O0e,PUBLIC:Qa,PUBLISH:ad,RANKING:tJ,RATING:eJ,RAIN_DELAY:QX,REGISTRATION:M0e,RESUME_TIME:Fl,RETRIEVAL:x0e,SCALE:ZX,SCHEDULE:P0e,SCHEDULED_DATE:Mh,SCHEDULED_TIME:Nh,SEEDING:SL,START_TIME:vs,STATUS:od,STOP_TIME:Iu,SUSPENSION:N0e,TIME_MODIFIERS:YP,TO_BE_ANNOUNCED:YX};function Ah({matchUp:t}){if(!t)return{error:sa};if(!t.hasContext)return{error:mP};if(!t.sides||t.sides.filter(Boolean).length!==2)return{error:la};let{nestedIndividualParticipantIds:e,allRelevantParticipantIds:i,sideParticipantIds:r}=qX({matchUp:t}),n=(t.timeItems??[]).filter(s=>(s==null?void 0:s.itemType)&&[l0,u0].includes(s.itemType)).sort((s,l)=>(s.createdAt?new Date(s.createdAt).getTime():0)-(l.createdAt?new Date(l.createdAt).getTime():0)),a=n.map(s=>s.itemValue).filter(s=>n.filter(l=>(l==null?void 0:l.itemValue)===s).reverse()[0].itemType===l0);e==null||e.forEach((s,l)=>{let u=r==null?void 0:r[l],c=(s==null?void 0:s.length)&&s.every(d=>a.includes(d));u&&c&&!a.includes(u)&&a.push(u)}),r==null||r.forEach((s,l)=>{a.includes(s)&&((e==null?void 0:e[l])??[]).forEach(u=>{u&&!a.includes(u)&&a.push(u)})});let o=r==null?void 0:r.reduce((s,l)=>a.includes(l)&&s,!0);return{allRelevantParticipantIds:i,allParticipantsCheckedIn:o,checkedInParticipantIds:a,...Q}}var Xi=t=>e=>{let i=At(e)&&(e==null?void 0:e.matchUpType)||Di(e)&&e;return i&&TK[t].includes(i)};function aI(t){var e;let{matchUpAverageTimes:i,matchUpFormat:r}=t||{},n=(i==null?void 0:i.map(({matchUpFormatCodes:o})=>o==null?void 0:o.filter(s=>s===r)).flat().filter(Boolean).sort((o,s)=>((o==null?void 0:o.length)||0)-((s==null?void 0:s.length)||0)))||[],a=n.includes(r)?r:n[0];return(e=i==null?void 0:i.find(({matchUpFormatCodes:o,averageTimes:s})=>(o==null?void 0:o.find(l=>a===l))&&s))==null?void 0:e.averageTimes}function oI(t){var e;let{matchUpRecoveryTimes:i,averageMinutes:r,matchUpFormat:n}=t||{};return(e=i==null?void 0:i.find(({matchUpFormatCodes:a,averageTimes:o,recoveryTimes:s})=>{if(o&&r){let{greaterThan:l=0,lessThan:u=360}=o;if(r>l&&r<u)return!0}return(a==null?void 0:a.find(l=>l===n))&&s}))==null?void 0:e.recoveryTimes}function iJ({timesBlockArray:t,categoryName:e,categoryType:i}){return t.filter(r=>Array.isArray(r)).map(r=>r.sort((n,a)=>{var o,s;return(((o=a.categoryNames)==null?void 0:o.length)||0)-(((s=n.categoryNames)==null?void 0:s.length)||0)}).find(({categoryTypes:n,categoryNames:a})=>!(a!=null&&a.length)&&!(n!=null&&n.length)||(a==null?void 0:a.includes(e))||(n==null?void 0:n.includes(i)))).find(Boolean)}function _0e({tournamentScheduling:t,eventScheduling:e,averageMinutes:i,defaultTiming:r,matchUpFormat:n,categoryName:a,categoryType:o,policy:s}){var l;let u=(e==null?void 0:e.matchUpRecoveryTimes)&&oI({...e,averageMinutes:i,matchUpFormat:n}),c=(t==null?void 0:t.matchUpRecoveryTimes)&&oI({...t,averageMinutes:i,matchUpFormat:n}),d=(s==null?void 0:s.matchUpRecoveryTimes)&&oI({...s,averageMinutes:i,matchUpFormat:n}),p=[u,c,d,(l=s==null?void 0:s.defaultTimes)==null?void 0:l.recoveryTimes,r==null?void 0:r.recoveryTimes];return iJ({categoryName:a,categoryType:o,timesBlockArray:p})}function $0e({matchUpFormat:t,categoryName:e,categoryType:i,defaultTiming:r,tournamentScheduling:n,eventScheduling:a,policy:o}){var s;let l=(a==null?void 0:a.matchUpAverageTimes)&&aI({...a,matchUpFormat:t}),u=(n==null?void 0:n.matchUpAverageTimes)&&aI({...n,matchUpFormat:t}),c=(o==null?void 0:o.matchUpAverageTimes)&&aI({...o,matchUpFormat:t}),d=[l,u,c,(s=o==null?void 0:o.defaultTimes)==null?void 0:s.averageTimes,r==null?void 0:r.averageTimes];return iJ({categoryName:e,categoryType:i,timesBlockArray:d})}var rJ="DOUBLES_SINGLES",nJ="SINGLES_DOUBLES",Yo="total",TM="participantConflict",uc="matchUpConflict",aJ="ISSUE_IDS",md="CONFLICT",hd="WARNING",DM="ERROR",PM="ISSUE",tS="STATE",B0e={SINGLES_DOUBLES:nJ,DOUBLES_SINGLES:rJ,TOTAL:Yo,CONFLICT_MATCHUP_ORDER:uc,CONFLICT_PARTICIPANTS:TM,SCHEDULE_ISSUE_IDS:aJ,SCHEDULE_CONFLICT:md,SCHEDULE_WARNING:hd,SCHEDULE_ERROR:DM,SCHEDULE_ISSUE:PM,SCHEDULE_STATE:tS};function ww({defaultAverageMinutes:t=90,defaultRecoveryMinutes:e=0,tournamentRecord:i,matchUpFormat:r,categoryName:n,categoryType:a,eventType:o,event:s}){if(!i)return{error:ve};o=o??(s==null?void 0:s.eventType)??Am;let l={averageTimes:[{minutes:{default:t}}],recoveryTimes:[{minutes:{default:e}}]},{scheduleTiming:u}=pw({tournamentRecord:i,categoryName:n,categoryType:a,event:s}),c={...u,matchUpFormat:r,categoryType:a,defaultTiming:l};return KP({eventType:o,timingDetails:c})}function KP({timingDetails:t,eventType:e}){let i=$0e(t),r=Object.keys((i==null?void 0:i.minutes)||{}),n=(i==null?void 0:i.minutes)&&((r==null?void 0:r.includes(e))&&i.minutes[e]||i.minutes.default),a=_0e({...t,averageMinutes:n}),o=Object.keys((a==null?void 0:a.minutes)||{}),s=(a==null?void 0:a.minutes)&&((o==null?void 0:o.includes(e))&&a.minutes[e]||a.minutes.default),l=Xi(Am)(e)?nJ:rJ,u=(a==null?void 0:a.minutes)&&((o==null?void 0:o.includes(l))&&a.minutes[l]||s);return{averageMinutes:n,recoveryMinutes:s,typeChangeRecoveryMinutes:u}}function VE(t){return t.createdAt?new Date(t.createdAt).getTime():0}function Ap({timeItems:t,itemType:e}){let i=t.filter(n=>n&&n.itemType===e).sort((n,a)=>VE(n)-VE(a)).pop(),r=i&&VE(i);return{itemValue:i==null?void 0:i.itemValue,timeStamp:r}}function oJ({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:r,timeStamp:n}=Ap({timeItems:(i==null?void 0:i.timeItems)||[],itemType:Nh});return!e||n&&t&&new Date(n).getTime()>new Date(t).getTime()?{scheduledTime:r}:e}function Oh({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:r,timeStamp:n}=Ap({timeItems:(i==null?void 0:i.timeItems)||[],itemType:Mh});return!e||n&&t&&new Date(n).getTime()>new Date(t).getTime()?{scheduledDate:r}:e}function $p(t){if(n8.test(t)){let e=SF();return new Date(`${e}T${t}`)}else return new Date(t)}function V0e({matchUp:t}){if(!t)return{error:sa};if(!t.timeItems)return{error:dF};let e=t.timeItems.filter(r=>[vs,Iu,Fl,$u].includes(r==null?void 0:r.itemType)).sort((r,n)=>$p(r.itemValue).getTime()-$p(n.itemValue).getTime()),i=e.reduce((r,n)=>{var a,o;let s,l=(a=n==null?void 0:n.itemType)==null?void 0:a.split("."),u=`SCHEDULE.TIME.${((o=n==null?void 0:n.itemType)==null?void 0:o.startsWith("SCHEDULE.TIME"))&&l[2]}`;switch(u){case vs:s=0;break;case $u:if(r.lastValue&&[vs,Fl].includes(r.lastType)){let c=$p(n.itemValue).getTime()-$p(r.lastValue).getTime();s=r.milliseconds+c}else s=r.milliseconds;break;case Iu:if([vs,"SCHECULE.TIME.RESUME"].includes(r.lastType)){let c=$p(n.itemValue).getTime()-$p(r.lastValue).getTime();s=r.milliseconds+c}else s=r.milliseconds;break;default:s=r.milliseconds;break}return{milliseconds:s,lastType:u,lastValue:n.itemValue}},{milliseconds:0,lastType:void 0,lastValue:void 0});if([vs,Fl].includes(i.lastType)){let r=new Date().getTime()-$p(i.lastValue).getTime();i.milliseconds+=r}return{milliseconds:i.milliseconds,time:j0e(i.milliseconds),relevantTimeItems:e}}function j0e(t){let e=(i,r=2)=>("00"+i).slice(-r);return e(t/36e5|0)+":"+e(t%36e5/6e4|0)+":"+e(t%6e4/1e3|0)}function G0e({matchUp:t}){var e;let i=(t==null?void 0:t.timeItems)||[],r=n=>n.createdAt?new Date(n.createdAt).getTime():0;return{startTime:(e=i.reduce((n,a)=>{let o=a.itemType===vs&&a;return o&&(!n||r(o)<r(n))?o:n},void 0))==null?void 0:e.itemValue}}function Uw(t){let{disableNotice:e,venue:i,context:r}=t;if(typeof i!="object")return{error:se};let n=To(t);i.venueId||(i.venueId=Ht());let a;for(let o of Object.values(n)){let s=H0e({disableNotice:!0,tournamentRecord:o,context:r,venue:i});if(s!=null&&s.error)return s;a=s.venue}return e||ut({topic:QF,payload:{venue:i}}),He({...Q,venue:a})}function H0e({tournamentRecord:t,disableNotice:e,context:i,venue:r}){return t?r?(t.venues||(t.venues=[]),r.venueId||(r.venueId=Ht()),t.venues.reduce((n,a)=>n||a.venueId===r.venueId,void 0)?{error:P9}:(i&&_t({element:r,extension:{value:i,name:cX}}),t.venues.push(r),e||ut({payload:{venue:r,tournamentId:t.tournamentId},topic:QF}),{...Q,venue:Ne(r)})):{error:Je,info:"missing venue"}:{error:ve}}function nu({tournamentRecords:t,tournamentRecord:e,venueId:i}){if(!e)return{error:ve};if(!i)return{error:Zc};let r=(e.venues??[]).reduce((n,a)=>a.venueId===i?a:n,void 0);if(!r&&t){let n=(lw({tournamentRecords:t}).linkedTournamentIds??[])[e.tournamentId];for(let a of n){let o=t[a],s=nu({tournamentRecord:o,venueId:i});if(s.success&&s.venue)return Uw({tournamentRecord:e,venue:s.venue}),{...Q,venue:r}}}return r?{...Q,venue:r}:{error:bh}}function TL({convertExtensions:t,...e}){let{tournamentRecords:i,tournamentRecord:r,venueId:n}=e,a=nu({tournamentRecords:i,tournamentRecord:r,venueId:n});return Ne(a,t,!0)}function kh({tournamentRecords:t,tournamentRecord:e,courtId:i}){if(!e)return{error:ve};if(!i)return{error:vh};let r="findCourt",n,a;if((e.venues??[]).forEach(o=>{(o.courts??[]).forEach(s=>{s.courtId===i&&(n=s,a=o)})}),n)return{...Q,court:n,venue:a};if(t){let o=(lw({tournamentRecords:t}).linkedTournamentIds??[])[e.tournamentId];for(let s of o){let l=t[s],u=kh({tournamentRecord:l,courtId:i});if(u.success)return u.venue&&Uw({tournamentRecord:e,venue:u.venue}),{...Q,court:n,venue:a}}}return te({result:{error:cv},stack:r})}function DL(t){return Ne(kh(t),!1,!0)}function XP({tournamentRecord:t,internalUse:e,courtId:i}){if(!t)return{error:ve};if(!i)return{error:vh};let r=kh({tournamentRecord:t,courtId:i});if(r.error)return r;let n=r.court&&(({altitude:a,courtId:o,courtName:s,courtDimensions:l,latitude:u,longitude:c,surfaceCategory:d,surfaceType:p,surfacedDate:m,pace:h,notes:f})=>({altitude:a,courtId:o,courtName:s,courtDimensions:l,latitude:u,longitude:c,surfaceCategory:d,surfaceType:p,surfacedDate:m,pace:h,notes:f}))(r.court);return{...Q,courtInfo:Ne(n,!1,e)}}function dg(t){var e;let i=We(t,[{[Ur]:!0},{venueId:!0,[Wo]:Zc}]);if(i.error)return i;let{tournamentRecord:r,venueId:n}=t,a=nu({tournamentRecord:r,venueId:n});if(a.error)return a;let o=(((e=a.venue)==null?void 0:e.courts)??[]).map(u=>(({courtInfo:c})=>({...c}))(XP({courtId:u.courtId,internalUse:!0,tournamentRecord:r}))),s=a.venue&&(({venueId:u,venueName:c,venueAbbreviation:d})=>({venueAbbreviation:d,venueName:c,venueId:u}))(a.venue),l=s&&{...s,courtsInfo:o};return{...Q,venueData:Ne(l,!1,!0)}}function z0e({matchUp:t}){var e;let i=(t==null?void 0:t.timeItems)||[],r=n=>n.createdAt?new Date(n.createdAt).getTime():0;return{endTime:(e=i.reduce((n,a)=>{let o=a.itemType===$u&&a;return o&&(!n||r(o)>r(n))?o:n},void 0))==null?void 0:e.itemValue}}function Hi({event:t,eventId:e}){var i,r;if(!t)return{error:vi};let n=(i=vt({name:rs,element:t}))==null?void 0:i.extension,a=e?Ne(n==null?void 0:n.value,!1,!0):n==null?void 0:n.value;return e&&((r=t.drawDefinitions)==null||r.forEach(o=>{var s;(s=a==null?void 0:a.flights)==null||s.forEach(l=>{l.drawId===o.drawId&&Object.assign(l,{drawDefinition:o})})})),{flightProfile:a}}function Kn(t){let{tournamentRecord:e,eventId:i,drawId:r}=t,n="findEvent",a={},o=t.tournamentRecords??(e&&{[e.tournamentId]:e})??{},s=Object.values(o).map(({events:u,tournamentId:c})=>(u&&u.forEach(d=>{a[d.eventId]={tournamentId:c}}),u??[])).flat(),l;if(r){let u,c=s.find(d=>{var p,m,h;let f=((d==null?void 0:d.drawDefinitions)??[]).find(g=>g.drawId===r);if(f)u=f,l=a[d.eventId].tournamentId;else{let g=(h=(m=d&&((p=Hi({event:d}))==null?void 0:p.flightProfile))==null?void 0:m.flights)==null?void 0:h.find(v=>v.drawId===r);if(g)return l=a[d.eventId].tournamentId,{entries:g.drawEntries,drawName:g.drawName,tournamentId:l,drawId:r}}return f});if(c)return{event:c,drawDefinition:u,tournamentId:l}}if(i){let u=s.find(c=>(c==null?void 0:c.eventId)===i);if(u)l=a[u.eventId].tournamentId;else return{event:void 0,drawDefinition:void 0,...te({result:{error:mo},stack:n})};return{event:u,drawDefinition:void 0,tournamentId:l}}return{event:void 0,drawDefinition:void 0,...te({result:{error:Va},context:{drawId:r,eventId:i},stack:n})}}function JP(t){var e,i,r,n,a,o,s,l,u,c;let d=t.event,p=t.matchUpType,{scheduleVisibilityFilters:m,afterRecoveryTimes:h,tournamentRecord:f,usePublishState:g,scheduleTiming:v,matchUpFormat:y,publishStatus:I,matchUp:b}=t;if(!b)return{error:sa};if(h&&!b.matchUpType&&!t.matchUpType&&(d||f)&&b.drawId){let M=t.drawDefinition||((e=d==null?void 0:d.drawDefinitions)==null?void 0:e.find(O=>O.drawId===b.drawId));!M&&f&&({drawDefinition:M,event:d}=Kn({drawId:b.drawId,tournamentRecord:f}));let C=b.structureId&&((i=M==null?void 0:M.structures)==null?void 0:i.find(({structureId:O})=>O===b.structureId));p=t.matchUpType||(C==null?void 0:C.matchUpType)||(M==null?void 0:M.matchUpType)||(d==null?void 0:d.eventType)!==ur&&(d==null?void 0:d.eventType)}let{milliseconds:S,time:w}=V0e({matchUp:b}),{startTime:U}=G0e({matchUp:b}),{endTime:T}=z0e({matchUp:b}),D,{eventIds:P,drawIds:E}=m??{};if((!P||P.includes(b.eventId))&&(!E||E.includes(b.drawId))){let M=ne=>ne.createdAt?new Date(ne.createdAt).getTime():0,C=new Map,O=((r=b.timeItems)==null?void 0:r.toSorted((ne,de)=>M(ne)-M(de)))??[];for(let ne of O)C.set(ne.itemType,ne.itemValue);let k=C.get(wL),x=C.get(Ql),F=C.get(Nh),$=C.get(YP),_=C.get(Mh),L=C.get(UL),B=C.get(qP),V=C.get(Ch),G=C.get(Lc),j,z,W,q,Y,re=b.matchUpType??p;if(v&&F&&h&&re){let ne={matchUpFormat:b.matchUpFormat??y,...v};({averageMinutes:z=0,recoveryMinutes:W=0,typeChangeRecoveryMinutes:q=0}=KP({timingDetails:ne,eventType:re})),(z||W)&&(j=T?ra(Ui(T),W):ra(F,z+W)),q&&(Y=T?ra(Ui(T),q):ra(F,z+q))}!_&&F&&(_=mt(F));let K=ZS({scheduledDate:_,scheduledTime:F}),H={},Z=((n=f&&V&&dg({tournamentRecord:f,venueId:V}))==null?void 0:n.venueData)||{};V&&(H[V]=Z);let{venueName:X,venueAbbreviation:ie,courtsInfo:ae}=Z,le=(a=G&&(ae==null?void 0:ae.find(ne=>ne.courtId===G)))==null?void 0:a.courtName;for(let ne of x||[]){if(!f)break;ne.venueId&&!H[ne.venueid]&&(H[ne.venueId]=(o=dg({venueId:ne.venueId,tournamentRecord:f}))==null?void 0:o.venueData);let de=H[ne.venueId];ne.venueName=de==null?void 0:de.venueName;let ye=(s=de==null?void 0:de.courtsInfo)==null?void 0:s.find(ce=>ce.courtId===ne.courtId);ne.courtName=ye==null?void 0:ye.courtName}D=He({typeChangeTimeAfterRecovery:Y,timeAfterRecovery:j,scheduledDate:_,scheduledTime:F,isoDateString:K,homeParticipantId:k,venueAbbreviation:ie,allocatedCourts:x,timeModifiers:$,venueName:X,venueId:V,courtOrder:B,courtName:le,courtId:G,official:L,typeChangeRecoveryMinutes:q,recoveryMinutes:W,averageMinutes:z,milliseconds:S,startTime:U,endTime:T,time:w})}else D=He({milliseconds:S,startTime:U,endTime:T,time:w});let{scheduledDate:R}=Oh({matchUp:b}),{scheduledTime:N}=oJ({matchUp:b});if(g&&(l=I==null?void 0:I.displaySettings)!=null&&l.draws){let M=I.displaySettings.draws,C=(u=(M==null?void 0:M[b.drawId])??(M==null?void 0:M.default))==null?void 0:u.scheduleDetails;if(C){let O=(c=C.find(k=>{var x;return R&&((x=k.dates)==null?void 0:x.includes(R))})??C.find(k=>{var x;return!((x=k.dates)!=null&&x.length)}))==null?void 0:c.attributes;if(O){let k=Object.assign({},...Object.keys(D).map(x=>({[x]:!0})),O);D=km({source:D,template:k})}}}let A=b.matchUpStatus&&yr.includes(b.matchUpStatus)&&(mt(T)||mt(R)||mt(N))||void 0;return{schedule:D,endDate:A}}function W0e({drawPositions:t,roundProfile:e,roundNumber:i}){var r;let n=[void 0,void 0];if(NK(t))return{orderedDrawPositions:n,displayOrder:n};let a=e==null?void 0:e[i],o=((r=a==null?void 0:a.pairedDrawPositions)==null?void 0:r.find(l=>Nn(l||[],t.filter(Boolean))))??n,s=a==null?void 0:a.feedRound;if(MK(t)){let l=[...t].sort(lr);return{orderedDrawPositions:l.length===2?l:o,displayOrder:s?l:o}}if(s){let l=[t.find(u=>!isNaN(Ze(u))),void 0];return{orderedDrawPositions:l,displayOrder:l}}return{orderedDrawPositions:o,displayOrder:o}}function c0({collectionPosition:t,collectionId:e,lineUp:i}){let r=[],n=[];if(i){let a=s=>s===void 0?-1:s,o=i.map(s=>{let{collectionAssignments:l,participantId:u}=s,c=l==null?void 0:l.find(d=>d.collectionPosition===t&&d.collectionId===e);return c&&{participantId:u,...c}}).filter(Boolean).sort((s,l)=>a(s.substitutionOrder)-a(l.substitutionOrder));for(let s of o){let{participantId:l,previousParticipantId:u,substitutionOrder:c}=s;r.includes(l)||(u&&n.push({previousParticipantId:u,substitutionOrder:c,participantId:l}),r=r.filter(d=>d!==u),r.push(l))}}return{assignedParticipantIds:r,substitutions:n}}function as({tournamentParticipants:t,tournamentRecord:e,participantIds:i}){let r="getPairedParticipant";if(!t&&!e)return{error:ve};if(!Array.isArray(i)||i.length>2)return{error:ya};if(!i.length)return te({result:{error:Qc},stack:r});t=t??(e==null?void 0:e.participants)??[];let n=t.filter(s=>s.participantType===ft&&ji(i,s.individualParticipantIds).length===i.length&&s.individualParticipantIds.length===i.length),a=n[0];if(!a)return te({result:{error:Wi},stack:r});let o=Ne(n.slice(1),!1,!0);return{participant:Ne(a),duplicatedPairParticipants:o,...Q}}function ep({drawDefinition:t,participantId:e}){if(typeof t!="object")return{error:$e};if(typeof e!="string")return{error:hr};let{extension:i}=vt({element:t,name:Fu});return{lineUp:((i==null?void 0:i.value)||{})[e]}}function q0e({tournamentParticipants:t,positionAssignments:e,collectionPosition:i,drawPositions:r=[],participantMap:n,drawDefinition:a,collectionId:o,sideLineUps:s,matchUpType:l}){if(!o||!i)return{};let u=({attribute:d,lineUp:p,teamParticipant:m})=>{var h,f,g,v;let{assignedParticipantIds:y,substitutions:I}=c0({collectionPosition:i,collectionId:o,lineUp:p});if(l===ei){if((y==null?void 0:y.length)<=2){let b=(f=(h=n==null?void 0:n[y[0]])==null?void 0:h.pairIdMap)==null?void 0:f[y[1]],S=(v=b&&((g=n[b])==null?void 0:g.participant)||as({participantIds:y,tournamentParticipants:t}).participant)==null?void 0:v.participantId;return{[d]:{participantId:S,teamParticipant:m,substitutions:I}}}else if((y==null?void 0:y.length)>2)return{[d]:{teamParticipant:m,substitutions:I}}}else{let b=y==null?void 0:y[0];return b&&{[d]:{participantId:b,teamParticipant:m,substitutions:I}}}};if(!(r!=null&&r.length)){let d=(s==null?void 0:s.map(p=>{var m;let{teamParticipant:h,sideNumber:f}=p,g=p.lineUp||((m=ep({participantId:h.teamParticipantId,drawDefinition:a}))==null?void 0:m.lineUp);return u({attribute:f,lineUp:g,teamParticipant:h})}).filter(Boolean))||{};return{sideNumberCollectionAssignment:Object.assign({},...d)}}let c=(r==null?void 0:r.map(d=>{var p,m,h;let f=(p=e.find(I=>I.drawPosition===d))==null?void 0:p.participantId,g=s==null?void 0:s.find(I=>(I==null?void 0:I.drawPosition)===d),v=(g==null?void 0:g.teamParticipant)||f&&((m=n==null?void 0:n[f])==null?void 0:m.participant)||(t==null?void 0:t.find(({participantId:I})=>I===f)),y=(g==null?void 0:g.lineUp)||((h=ep({participantId:f,drawDefinition:a}))==null?void 0:h.lineUp);return u({attribute:d,lineUp:y,teamParticipant:v})}).filter(Boolean))||{};return{drawPositionCollectionAssignment:Object.assign({},...c)}}function QP(t){var e,i,r;let n=We(t,[{[ru]:!0}]);if(n.error)return n;let a=t==null?void 0:t.matchUp,o=a==null?void 0:a.matchUpType;if(!o&&(e=a==null?void 0:a.sides)!=null&&e.length){let s=(r=(i=a.sides.find(({participant:l})=>l))==null?void 0:i.participant)==null?void 0:r.participantType;o=s===Dt&&ii||s===ft&&ei||s===Xt&&Xt||void 0}return{matchUpType:o}}function Y0e({drawPositionCollectionAssignment:t,sideNumberCollectionAssignment:e,positionAssignments:i,displaySideNumber:r,seedAssignments:n,drawPosition:a,isFeedRound:o,sideNumber:s}){var l,u,c,d;let p=i.find(v=>v.drawPosition&&v.drawPosition===a),m=a&&t,h=s&&e,f=m?(l=m[a])==null?void 0:l.participantId:p==null?void 0:p.participantId,g=p?K0e({displaySideNumber:r,seedAssignments:n,participantId:f,assignment:p,sideNumber:s}):{...h==null?void 0:h[s]};if(o&&(s===1?Object.assign(g,{participantFed:!0}):Object.assign(g,{participantAdvanced:!0})),a&&m){let v=(u=m[a])==null?void 0:u.teamParticipant,y=(c=m[a])==null?void 0:c.participant,I=(d=m[a])==null?void 0:d.substitutions;y&&(g.participant=y),I&&(g.substitutions=I),v&&(g.teamParticipant=v)}return g}function K0e({displaySideNumber:t,seedAssignments:e,participantId:i,assignment:r,sideNumber:n}){let a={drawPosition:r.drawPosition,displaySideNumber:t,sideNumber:n};if(i){let o=X0e({seedAssignments:e,participantId:i});Object.assign(a,o,{participantId:i}),o!=null&&o.seedNumber&&(o==null?void 0:o.seedValue)===""&&(a.seedValue="~")}else r.bye&&Object.assign(a,{bye:!0});return r.qualifier&&Object.assign(a,{qualifier:!0}),a}function X0e({seedAssignments:t,participantId:e}){return t==null?void 0:t.find(i=>!i.seedProxy&&i.participantId===e)}function sJ({scheduleVisibilityFilters:t,sourceDrawPositionRanges:e,tournamentParticipants:i,positionAssignments:r,drawPositionsRanges:n,hydrateParticipants:a,afterRecoveryTimes:o,initialRoundOfPlay:s,additionalContext:l,roundNamingProfile:u,tournamentRecord:c,tieDrawPositions:d,appliedPolicies:p,isCollectionBye:m,seedAssignments:h,usePublishState:f,participantMap:g,contextContent:v,scheduleTiming:y,contextProfile:I,drawDefinition:b,publishStatus:S,scoringActive:w,matchUpTieId:U,isRoundRobin:T,roundProfile:D,sideLineUps:P,structure:E,context:R,matchUp:N,event:A}){var M,C,O,k,x,F,$,_,L,B,V,G,j,z,W;l=l??{};let q=(M=In({drawDefinition:b,structure:E,matchUp:N,event:A}))==null?void 0:M.tieFormat,{roundOffset:Y,structureId:re,structureName:K,stage:H,stageSequence:Z}=E,{drawId:X,drawName:ie,drawType:ae}=b??{},le=q==null?void 0:q.collectionDefinitions,ne=N.collectionId&&(le==null?void 0:le.find(be=>be.collectionId===N.collectionId)),de=N.collectionId?ne==null?void 0:ne.matchUpFormat:N.matchUpFormat??(E==null?void 0:E.matchUpFormat)??(b==null?void 0:b.matchUpFormat)??(A==null?void 0:A.matchUpFormat),ye=N.matchUpType||(ne==null?void 0:ne.matchUpType)||(E==null?void 0:E.matchUpType)||(b==null?void 0:b.matchUpType)||!Xi(ur)(A==null?void 0:A.eventType)&&(A==null?void 0:A.eventType),ce=m?jt:N.matchUpStatus,{schedule:ke,endDate:Pe}=JP({scheduleVisibilityFilters:t,afterRecoveryTimes:o,tournamentRecord:c,usePublishState:f,scheduleTiming:y,drawDefinition:b,matchUpFormat:de,publishStatus:S,matchUpType:ye,matchUp:N,event:A}),it=d??N.drawPositions??[],{collectionPosition:It,collectionId:me,roundPosition:fe}=N,pe=N.roundNumber??l.roundNumber,Fe=me?q0e({tournamentParticipants:i,positionAssignments:r,collectionPosition:It,participantMap:g,drawDefinition:b,drawPositions:it,collectionId:me,sideLineUps:P,matchUpType:ye}):void 0,De=((C=u==null?void 0:u[pe])==null?void 0:C.roundName)||l.roundName,je=((O=u==null?void 0:u[pe])==null?void 0:O.abbreviatedRoundName)||l.abbreviatedRoundName,ue=(k=D==null?void 0:D[pe])==null?void 0:k.feedRound,he=(x=D==null?void 0:D[pe])==null?void 0:x.preFeedRound,Re=(F=D==null?void 0:D[pe])==null?void 0:F.roundFactor,xe=n==null?void 0:n[pe],Ee=fe?xe==null?void 0:xe[fe]:void 0,we=e==null?void 0:e[pe],Ue=ne!=null&&ne.category?{...(R==null?void 0:R.category)||{},...ne.category}:(R==null?void 0:R.category)??(A==null?void 0:A.category),wt=(($=N.processCodes)==null?void 0:$.length)&&N.processCodes||((_=ne==null?void 0:ne.processCodes)==null?void 0:_.length)&&(ne==null?void 0:ne.processCodes)||((L=E==null?void 0:E.processCodes)==null?void 0:L.length)&&(E==null?void 0:E.processCodes)||((B=b==null?void 0:b.processCodes)==null?void 0:B.length)&&(b==null?void 0:b.processCodes)||((V=A==null?void 0:A.processCodes)==null?void 0:V.length)&&(A==null?void 0:A.processCodes)||(c==null?void 0:c.processCodes),Le=(I==null?void 0:I.withCompetitiveness)&&bw({...v,matchUp:N}),rt=N.finishingPositionRange??l.finishingPositionRange,Ei=be=>He(be,void 0,!0),Be={...Ei(R),...Ei({matchUpFormat:N.matchUpType===ur?void 0:de,tieFormat:N.matchUpType!==ur?void 0:q,gender:(ne==null?void 0:ne.gender)??(A==null?void 0:A.gender),roundOfPlay:H!==Ke&&st(s)&&s+(pe||0),endDate:N.endDate??Pe,discipline:A==null?void 0:A.discipline,category:Ue,finishingPositionRange:rt,abbreviatedRoundName:je,drawPositionsRange:Ee,competitiveProfile:Le,structureName:K,stageSequence:Z,drawPositions:it,matchUpStatus:ce,processCodes:wt,isRoundRobin:T,matchUpTieId:U,preFeedRound:he,matchUpType:ye,roundFactor:Re,roundOffset:Y,structureId:re,roundNumber:pe,feedRound:ue,roundName:De,drawName:ie,drawType:ae,schedule:ke,drawId:X,stage:H}),...Ne(Ei(N),!0,!0)};if(de&&(G=N.score)!=null&&G.scoreStringSide1){let be=Ln(de),{bestOf:Ct,finalSetFormat:Ce,setFormat:qe}=be??{};(Ce!=null&&Ce.tiebreakSet||qe!=null&&qe.tiebreakSet||qe!=null&&qe.timed)&&(Be.score.sets=Be.score.sets.sort((Ot,di)=>Ot.setNumber-di.setNumber).map((Ot,di)=>(di+1===Ct?(Ce!=null&&Ce.tiebreakSet||Ce!=null&&Ce.timed)&&(Ot.tiebreakSet=!0):(qe!=null&&qe.tiebreakSet||qe!=null&&qe.timed)&&(Ot.tiebreakSet=!0),Ot)))}if(Array.isArray(it)){let{orderedDrawPositions:be,displayOrder:Ct}=W0e({drawPositions:it,roundProfile:D,roundNumber:pe}),Ce=(j=D==null?void 0:D[pe])==null?void 0:j.feedRound,qe=Ct[0]!==be[0],Ot=be.concat(void 0,void 0).slice(0,2).map((di,yi)=>{var Fi;let Ci=yi+1,gn=qe?3-Ci:Ci,gr=Y0e({...Fe,positionAssignments:r,displaySideNumber:gn,seedAssignments:h,drawPosition:di,isFeedRound:Ce,sideNumber:Ci}),Co=(Fi=N.sides)==null?void 0:Fi.find(uE=>uE.sideNumber===Ci),ud=fe?(fe-1)*2+yi+1:void 0,lU=ud?we==null?void 0:we[ud]:void 0;return Ei({sourceDrawPositionRange:lU,...Co,...gr})});Object.assign(Be,Ne({sides:Ot},!0,!0))}if(i&&Be.sides&&a!==!1){let be=p==null?void 0:p[gv],Ct=Ce=>{var qe;let Ot=(qe=g==null?void 0:g[Ce])==null?void 0:qe.participant;return Ot&&km({template:be==null?void 0:be.participant,source:Ot})};if(Be.sides.filter(Boolean).forEach(Ce=>{var qe,Ot,di,yi;if(Ce.participantId){let Fi=Ne(Ct(Ce.participantId)||(i?Ac({policyDefinitions:p,participantId:Ce.participantId,tournamentParticipants:i,internalUse:!0,contextProfile:I}):void 0),void 0,!0);if(Fi){if(b!=null&&b.entries){let Ci=b.entries.find(gr=>gr.participantId===Ce.participantId),gn=(qe=A==null?void 0:A.entries)==null?void 0:qe.find(gr=>gr.participantId===Ce.participantId);Fi.entryStatus=(Ci==null?void 0:Ci.entryStatus)||(gn==null?void 0:gn.entryStatus),Ci!=null&&Ci.entryStage&&(Fi.entryStage=Ci.entryStage)}Object.assign(Ce,{participant:Fi})}}if((di=(Ot=Ce==null?void 0:Ce.participant)==null?void 0:Ot.individualParticipantIds)!=null&&di.length&&!((yi=Ce.participant.individualParticipants)!=null&&yi.length)){let Fi=Ce.participant.individualParticipantIds.map(Ci=>Ct(Ci)||(i?Ac({policyDefinitions:p,tournamentParticipants:i,internalUse:!0,contextProfile:I,participantId:Ci}):void 0));Object.assign(Ce.participant,{individualParticipants:Fi})}}),!Be.matchUpType){let{matchUpType:Ce}=QP({matchUp:Be});Ce&&Object.assign(Be,{matchUpType:Ce})}if(I!=null&&I.inferGender&&(!Be.gender||Be.gender===jn)&&((z=Be.sides)==null?void 0:z.length)===2&&Be.matchUpType!==ur){let Ce=Be.sides.map(qe=>{var Ot,di,yi,Fi;if(Xi(ii)(Be.matchUpType))return(di=(Ot=qe.participant)==null?void 0:Ot.person)==null?void 0:di.sex;if(((Fi=(yi=qe.participant)==null?void 0:yi.individualParticipants)==null?void 0:Fi.length)===2){let Ci=dt(qe.participant.individualParticipants.map(gn=>{var gr;return(gr=gn.person)==null?void 0:gr.sex})).filter(Boolean);if(Ci.length===1)return Ci[0]}});if(Ce.filter(Boolean).length===2&&dt(Ce).length===1){let qe=Ce[0];Be.inferredGender=qe}}}if(Be.tieMatchUps){let be=Be.matchUpStatus===jt,Ct=(W=Be.sides)==null?void 0:W.map(({participant:Ce,drawPosition:qe,sideNumber:Ot,lineUp:di})=>{let yi=(Ce==null?void 0:Ce.participantType)===ur&&Ce;return{teamParticipant:yi&&He({participantRoleResponsibilities:yi.participantRoleResponsibilities,participantOtherName:yi.participanOthertName,participantName:yi.participantName,participantId:yi.participantId,teamId:yi.teamId}),drawPosition:qe,sideNumber:Ot,lineUp:di}});Be.tieMatchUps=Be.tieMatchUps.map(Ce=>{let qe=Be.matchUpId,Ot={finishingPositionRange:Be.finishingPositionRange,abbreviatedRoundName:je,roundNumber:pe,roundName:De};return sJ({tieDrawPositions:it,scheduleVisibilityFilters:t,sourceDrawPositionRanges:e,sideLineUps:Ct,drawPositionsRanges:n,initialRoundOfPlay:s,roundNamingProfile:u,additionalContext:Ot,appliedPolicies:p,isCollectionBye:be,usePublishState:f,publishStatus:S,matchUpTieId:qe,isRoundRobin:T,roundProfile:D,matchUp:Ce,event:A,tournamentParticipants:i,positionAssignments:r,tournamentRecord:c,seedAssignments:h,participantMap:g,contextContent:v,scheduleTiming:y,contextProfile:I,drawDefinition:b,scoringActive:w,structure:E,context:R})})}let nt=Be.sides&&Be.sides.filter(be=>be==null?void 0:be.participantId).length===2,Ii=!Be.winningSide;if(Object.assign(Be,{readyToScore:w&&nt&&Ii,hasContext:!0}),nt){let{allParticipantsCheckedIn:be,checkedInParticipantIds:Ct}=Ah({matchUp:Be});Object.assign(Be,{allParticipantsCheckedIn:be,checkedInParticipantIds:Ct})}return Array.isArray(I==null?void 0:I.exclude)&&(I==null||I.exclude.forEach(be=>delete Be[be])),Be}function J0e({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:r,timeStamp:n}=Ap({timeItems:(i==null?void 0:i.timeItems)||[],itemType:Ql});return!e||n&&t&&new Date(n).getTime()>new Date(t).getTime()?{allocatedCourts:Ne(r,!1,!0)}:e}function Q0e({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:r,timeStamp:n}=Ap({timeItems:(i==null?void 0:i.timeItems)||[],itemType:Lc});return!e||n&&t&&new Date(n).getTime()>new Date(t).getTime()?{courtId:r}:e}function Z0e({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:r,timeStamp:n}=Ap({timeItems:(i==null?void 0:i.timeItems)||[],itemType:Ch});return!e||n&&t&&new Date(n).getTime()>new Date(t).getTime()?{venueId:r}:e}function pu(t){if(!Array.isArray(t.matchUps))return[];let{matchUps:e,excludeMatchUpStatuses:i,hasParticipantsCount:r,isCollectionMatchUp:n,matchUpStatuses:a,hasWinningSide:o,matchUpFormats:s,roundPositions:l,matchUpFormat:u,collectionIds:c,isMatchUpTie:d,roundNumbers:p,matchUpIds:m,roundNames:h,filterMatchUpTypes:f=!0,filterMatchUpIds:g=!0,stageSequences:v,scheduledDates:y,scheduledDate:I,participantIds:b,processContext:S,tournamentIds:w,matchUpTypes:U,structureIds:T,readyToScore:D,courtIds:P,eventIds:E,venueIds:R,drawIds:N,stages:A}=t,M=Array.isArray(b)?b.filter(Boolean):[],C=Array.isArray(a)?a.filter(Boolean):[],O=Array.isArray(i)?i.filter(Boolean):[],k=Array.isArray(A)?A.filter(Boolean):[],x=Array.isArray(v)?v.filter(Boolean):[],F=Array.isArray(c)?c.filter(Boolean):[],$=Array.isArray(h)?h.filter(Boolean):[],_=Array.isArray(p)?p.filter(Boolean):[],L=Array.isArray(l)?l.filter(Boolean):[],B=Array.isArray(m)&&g?m.filter(Boolean):[],V=Array.isArray(U)&&f?U.filter(Boolean):[],G=Array.isArray(P)?P.filter(Boolean):[],j=Array.isArray(R)?R.filter(Boolean):[],z=Array.isArray(s)&&s.filter(Boolean)||typeof u=="string"&&[u]||[],W=Array.isArray(y)&&y.filter(Boolean)||typeof I=="string"&&I.length&&[I]||[],q=Array.isArray(w)?w.filter(Boolean):[],Y=Array.isArray(E)?E.filter(Boolean):[],re=Array.isArray(N)?N.filter(Boolean):[],K=Array.isArray(T)?T.filter(Boolean):[];return e.filter(H=>{var Z;if(D&&!Xi(Ba)(H)&&!H.readyToScore||H.winningSide&&o&&![1,2].includes(H.winningSide)||d!==void 0&&(d&&!H.tieMatchUps||!d&&H.tieMatchUps)||n!==void 0&&(n&&!H.collectionId||!n&&H.collectionId)||k.length&&!k.includes(H.stage)||x.length&&!x.includes(H.stageSequence)||F.length&&(!H.collectionId||!F.includes(H.collectionId))||$.length&&(!H.roundName||!$.includes(H.roundName))||_.length&&(!H.roundNumber||!_.includes(H.roundNumber))||L.length&&(!H.roundPosition||!L.includes(H.roundPosition))||C.length&&(!H.matchUpStatus||!C.includes(H.matchUpStatus))||O.length&&H.matchUpStatus&&O.includes(H.matchUpStatus)||B.length&&!B.includes(H.matchUpId)||V.length&&(!H.matchUpType||!nP(V,H.matchUpType))||z.length&&(!H.matchUpFormat||!z.includes(H.matchUpFormat)))return!1;if(W!=null&&W.length){let{scheduledTime:X}=oJ({matchUp:H}),{scheduledDate:ie}=Oh({matchUp:H}),ae=mt(X)||ie;if(!W.find(le=>ql(le,ae)))return!1}if(G.length){let{courtId:X}=Q0e({matchUp:H}),{allocatedCourts:ie}=J0e({matchUp:H}),ae=ie==null?void 0:ie.map(({courtId:le})=>le);if(!G.filter(Boolean).includes(X)||ae!=null&&ae.includes(X))return!1}if(j.length){let{venueId:X}=Z0e({matchUp:H});if(!j.filter(Boolean).includes(X))return!1}if(S){if(q.length&&!q.includes(H.tournamentId)||Y.length&&!Y.includes(H.eventId)||re.length&&!re.includes(H.drawId)||K.length&&!K.includes(H.structureId))return!1;let X=((Z=H.sides)==null?void 0:Z.map(({participantId:ie})=>ie).filter(Boolean))??[];if(r&&X.length<r||M.length&&!M.some(ie=>X.includes(ie)))return!1}return!0})}function qt(t){var e,i,r,n,a,o,s;let{provisionalPositioning:l,tournamentRecord:u,contextFilters:c,matchUpFilters:d,contextProfile:p,drawDefinition:m,context:h={},structure:f,inContext:g,event:v}=t,{seedAssignments:y,contextContent:I,exitProfiles:b,matchUpsMap:S}=t,w={},U={};if(!f)return{collectionPositionMatchUps:w,error:Tp,roundMatchUps:U,matchUps:[]};let T=Array.isArray(d==null?void 0:d.eventIds)?d==null?void 0:d.eventIds.filter(Boolean):[],D=Array.isArray(d==null?void 0:d.structureIds)?d==null?void 0:d.structureIds.filter(Boolean):[],P=Array.isArray(d==null?void 0:d.drawIds)?d==null?void 0:d.drawIds.filter(Boolean):[],E=!(h!=null&&h.eventId)||!(T!=null&&T.length)&&!((e=c==null?void 0:c.eventIds)!=null&&e.filter(Boolean).length)||(T==null?void 0:T.includes(h.eventId))||((i=c==null?void 0:c.eventIds)==null?void 0:i.includes(h.eventId)),R=!(D!=null&&D.length)||D.includes(f.structureId),N=!m||!(P!=null&&P.length)||P.includes(m.drawId);if(!E||!R||!N)return{collectionPositionMatchUps:w,roundMatchUps:U,matchUps:[]};p&&!I&&(I=tc({tournamentRecord:u,contextProfile:p,drawDefinition:m}));let{appliedPolicies:A}=Bt({drawDefinition:m}),M={...t.tournamentAppliedPolicies,...A,...t.policyDefinitions},C=(r=M==null?void 0:M.scoring)==null?void 0:r.structures,O=f.stage&&((n=C==null?void 0:C.stage)==null?void 0:n[f.stage]),k=f.stageSequence&&((a=O==null?void 0:O.stageSequence)==null?void 0:a[f.stageSequence]),x=((o=M==null?void 0:M.scoring)==null?void 0:o.requireAllPositionsAssigned)||(O==null?void 0:O.requireAllPositionsAssigned)||(k==null?void 0:k.requireAllPositionsAssigned);S||(S=ln({drawDefinition:m,structure:f}));let{positionAssignments:F,allPositionsAssigned:$}=Mr({structure:f}),_=!x||$,{seedAssignments:L}=go({provisionalPositioning:l,drawDefinition:m,structure:f});y=y??L;let{structureId:B}=f;b=b||m&&GX({drawDefinition:m}).exitProfiles;let V=b==null?void 0:b[B],G=(V==null?void 0:V.length)&&(V[0].split("-").map(K=>parseInt(K)).reduce((K,H)=>K+H)||0),j=!!f.structures,z=Zd({matchUpsMap:S,structureId:B,inContext:g}),W=M==null?void 0:M[sg],q=S0e({roundNamingPolicy:W,drawDefinition:m,structure:f,matchUps:z}),{roundNamingProfile:Y,roundProfile:re}=q;if(U=(q==null?void 0:q.roundMatchUps)??[],d&&(z=pu({matchUps:z,...d,filterMatchUpTypes:!1,filterMatchUpIds:!1})),g){let{sourceDrawPositionRanges:K}=b0e({drawDefinition:m,matchUpsMap:S,structureId:B}),H=m?w0e({drawDefinition:m,roundProfile:re,matchUpsMap:S,structureId:B}).drawPositionsRanges:void 0;z=z.map(Z=>sJ({tournamentParticipants:t.tournamentParticipants??(u==null?void 0:u.participants),scheduleVisibilityFilters:t.scheduleVisibilityFilters,hydrateParticipants:t.hydrateParticipants,afterRecoveryTimes:t.afterRecoveryTimes,usePublishState:t.usePublishState,participantMap:t.participantMap,scheduleTiming:t.scheduleTiming,publishStatus:t.publishStatus,sourceDrawPositionRanges:K,positionAssignments:F,drawPositionsRanges:H,initialRoundOfPlay:G,roundNamingProfile:Y,tournamentRecord:u,appliedPolicies:M,seedAssignments:y,contextContent:I,contextProfile:p,drawDefinition:m,scoringActive:_,isRoundRobin:j,roundProfile:re,structure:f,context:h,matchUp:Z,event:v})),(z==null?void 0:z.filter(Z=>Array.isArray(Z.tieMatchUps))).forEach(Z=>{let X=Z.tieMatchUps;z=z.concat(...X)}),c&&(z=pu({processContext:!0,...c,matchUps:z}))}else(z==null?void 0:z.filter(K=>Array.isArray(K.tieMatchUps))).forEach(K=>{let H=K.tieMatchUps;z=z.concat(...H)});return d&&(z=pu({matchUps:z,...d,filterMatchUpTypes:!1,filterMatchUpIds:!1})),(d!=null&&d.matchUpTypes||d!=null&&d.matchUpIds)&&(z=pu({matchUpTypes:d.matchUpTypes,matchUpIds:d.matchUpIds,matchUps:z})),(d!=null&&d.matchUpTypes||d!=null&&d.matchUpIds||g)&&(U=An({matchUps:z}).roundMatchUps??[]),(s=In({drawDefinition:m,structure:f,event:v}))!=null&&s.tieFormat&&({collectionPositionMatchUps:w}=y0e({matchUps:z})),{collectionPositionMatchUps:w,roundMatchUps:U,isRoundRobin:j,roundProfile:re,matchUpsMap:S,matchUps:z}}function Cd({matchUp:t}){return t?yr.includes(t==null?void 0:t.matchUpStatus)||(t==null?void 0:t.winningSide):!1}function ZP({requireParticipants:t=!0,scheduleVisibilityFilters:e,tournamentAppliedPolicies:i,tournamentParticipants:r,hydrateParticipants:n,afterRecoveryTimes:a,policyDefinitions:o,tournamentRecord:s,usePublishState:l,matchUpFilters:u,contextFilters:c,contextContent:d,participantMap:p,scheduleTiming:m,publishStatus:h,contextProfile:f,drawDefinition:g,exitProfiles:v,matchUpsMap:y,structureId:I,inContext:b,structure:S,context:w,event:U}){!S&&I&&({structure:S}=tt({drawDefinition:g,structureId:I}));let T=qt({tournamentAppliedPolicies:i,scheduleVisibilityFilters:e,tournamentParticipants:r,hydrateParticipants:n,afterRecoveryTimes:a,policyDefinitions:o,tournamentRecord:s,usePublishState:l,matchUpFilters:u,contextFilters:c,contextContent:d,participantMap:p,scheduleTiming:m,publishStatus:h,contextProfile:f,drawDefinition:g,exitProfiles:v,matchUpsMap:y,structure:S,inContext:b,context:w,event:U}),D=[],P=[],E=[],R=[],N=[];if(T.error)return T;let{matchUps:A}=T,{assignedPositions:M}=Mr({structure:S}),C=M==null?void 0:M.filter(k=>k.participantId).map(k=>k.drawPosition),O;return A.filter(k=>{var x;let F=((x=u==null?void 0:u.matchUpTypes)==null?void 0:x.length)===1&&u.matchUpTypes[0]===fi;return!(k.matchUpType!==fi&&F)}).forEach(k=>{var x,F,$,_;if(k.matchUpStatus===ua){D.push(k);return}k.matchUpType===fi&&(O=!0);let L=k.collectionId,B=L&&((x=k.sides)==null?void 0:x.every(q=>q.participantId)),V=!L&&((F=k.drawPositions)==null?void 0:F.filter(Boolean).length)===2,G=!L&&(($=k.drawPositions)==null?void 0:$.every(q=>C==null?void 0:C.includes(q))),j=M==null?void 0:M.filter(q=>q.bye).map(q=>q.drawPosition),z=!L&&((_=k.drawPositions)==null?void 0:_.find(q=>j==null?void 0:j.includes(q))),W=SX.includes(k.matchUpStatus)&&(B||V&&(!t||G));return z?N.push(k):Cd({matchUp:k})?P.push(k):W?E.push(k):R.push(k)}),{includesTeamMatchUps:O,abandonedMatchUps:D,completedMatchUps:P,upcomingMatchUps:E,pendingMatchUps:R,byeMatchUps:N,structure:S}}function eTe({drawDefinition:t,roundNumber:e,structureId:i}){if(!t)return{error:$e};if(!i)return{error:Xa};let{links:r}=bv({drawDefinition:t,structureId:i}),n=r.source.reduce((o,s)=>!s.source.roundNumber||s.source.roundNumber===e?o.concat(s):o,[]),a=r.target.reduce((o,s)=>!s.target.roundNumber||s.target.roundNumber===e?o.concat(s):o,[]);return{links:{source:n,target:a}}}function jE({finishingPositions:t,linkCondition:e,linkType:i,source:r}){var n;let a=r.find(o=>{var s,l;let u=!((s=o.source)!=null&&s.finishingPositions)||!t||Nn(t,(l=o.source)==null?void 0:l.finishingPositions);return e===o.linkCondition&&u&&o.linkType===i});return[ku,Yl].includes(a==null?void 0:a.linkType)&&!((n=a==null?void 0:a.source)!=null&&n.roundNumber)?te({result:{error:se},stack:"getTargetLink",context:a}):a}function bv({drawDefinition:t,structureId:e,roundNumber:i}){return t?e?{links:(t.links||[]).filter(Boolean).reduce((r,n)=>{var a,o;return((a=n.source)==null?void 0:a.structureId)===e&&(!i||n.source.roundNumber===i)&&(r.source=r.source.concat(n)),((o=n.target)==null?void 0:o.structureId)===e&&(!i||n.target.roundNumber===i)&&(r.target=r.target.concat(n)),r},{source:[],target:[]})}:{error:Xa}:{error:$e}}function tTe({structureMatchUps:t,matchUp:e}){let{roundNumber:i,roundPosition:r}=e,n=t.filter(o=>o.roundNumber===i&&!o.matchUpTieId),a=t.filter(o=>o.roundNumber===i+1&&!o.matchUpTieId);if(a.length){let o;return a.length===n.length?o=a.find(s=>s.roundPosition===r):a.length===n.length/2&&(o=a.find(s=>s.roundPosition===Math.ceil(r/2))),{matchUp:o}}return{message:"no progression found"}}function GE({sourceRoundMatchUpCount:t,inContextDrawMatchUps:e,sourceRoundPosition:i,drawDefinition:r,targetLink:n}){var a;if(!n)return{error:Kx};let{target:{structureId:o,feedProfile:s,groupedOrder:l,roundNumber:u,positionInterleave:c}}=n,{structure:d}=tt({drawDefinition:r,structureId:o}),{positionAssignments:p}=si({structure:d}),m=(e==null?void 0:e.filter(P=>P.structureId===(d==null?void 0:d.structureId))).filter(P=>P.roundNumber===u&&!P.matchUpTieId),h=m.length,f=Te(1,h+1),g=h/t,v=Math.ceil(g*i),y=1-i%2;if(c!=null&&c.interleave&&g!==.5){let P=c.offset+(i-1)*c.interleave,E=i+P;v=Math.ceil(E/2),y=1-E%2}let I=f,b=f[v-1],S=jX({roundPositionsCount:f.length,groupedOrder:l}),w=(S==null?void 0:S.length)||1;if(w<=f.length){let P=h/w,E=Cr(f,P);s===Kd&&E.forEach(R=>R.reverse()),I=(S==null?void 0:S.length)&&(S==null?void 0:S.map(R=>E[R-1]).flat())||I}s===$o?b=I[v-1]:s===Kd?((!(S!=null&&S.length)||w>f.length)&&(v=m.length+1-v),b=I[v-1]):s===RP&&ja()&&console.log(gP,{feedProfile:s});let U=b&&m.reduce((P,E)=>E.roundPosition===b?E:P,void 0),T;U!=null&&U.feedRound?(y=0,T=Math.min(...(U.drawPositions||[]).filter(Boolean))):T=((a=U==null?void 0:U.drawPositions)==null?void 0:a.length)===2&&(U==null?void 0:U.drawPositions[y]);let D=p==null?void 0:p.find(({drawPosition:P})=>P===T);if(D){let{extension:P}=vt({element:D,name:_P});if(P!=null&&P.value)return{disabledDrawPosition:T}}return{matchUp:U,targetDrawPosition:T,matchUpDrawPositionIndex:y}}function On({inContextDrawMatchUps:t=[],useTargetMatchUpIds:e,inContextMatchUp:i,drawDefinition:r,matchUpId:n}){let a=i;t.length&&!a&&(a=t.find(s=>s.matchUpId===n));let{structure:o}=tt({structureId:a==null?void 0:a.structureId,drawDefinition:r});return(o==null?void 0:o.finishingPosition)===Th?iTe({inContextDrawMatchUps:t,useTargetMatchUpIds:e,drawDefinition:r,structure:o,matchUp:a}):rTe({matchUp:a})}function iTe({inContextDrawMatchUps:t,useTargetMatchUpIds:e,drawDefinition:i,structure:r,matchUp:n}){var a,o,s;let{winnerMatchUpId:l,loserMatchUpId:u}=n,{links:c}=eTe({roundNumber:n.roundNumber,structureId:r.structureId,drawDefinition:i}),d=c==null?void 0:c.source,p=jE({source:d,linkType:ku}),m=jE({linkCondition:ll,linkType:Yl,source:d}),h=jE({source:d,linkType:Yl}),f=m&&h;h||(h=m);let g=(a=p==null?void 0:p.target)==null?void 0:a.feedProfile,v=(o=h==null?void 0:h.target)==null?void 0:o.feedProfile,y=(s=m==null?void 0:m.target)==null?void 0:s.feedProfile,I,b,S,w,U,T,D,P,E,R;if(e&&(l||u)&&(D=l&&g!==gs&&t.find(({matchUpId:M})=>M===l),w=u&&v!==gs&&t.find(({matchUpId:M})=>M===u),D||w))return{matchUp:n,targetLinks:{loserTargetLink:h,winnerTargetLink:p},targetMatchUps:{loserMatchUp:w,winnerMatchUp:D}};let{roundPosition:N}=n;R=R||t.filter(M=>M.structureId===r.structureId);let A=R.reduce((M,C)=>C.roundNumber===n.roundNumber&&!C.matchUpTieId?M+1:M,0);return h&&!w&&v!==gs&&({matchUpDrawPositionIndex:T,targetDrawPosition:U,matchUp:w}=GE({targetLink:h,sourceRoundMatchUpCount:A,inContextDrawMatchUps:t,sourceRoundPosition:N,drawDefinition:i})),f&&y!==gs&&({matchUpDrawPositionIndex:S,targetDrawPosition:b,matchUp:I}=GE({targetLink:m,sourceRoundMatchUpCount:A,inContextDrawMatchUps:t,sourceRoundPosition:N,drawDefinition:i})),p&&!D&&g!==gs&&({matchUpDrawPositionIndex:E,targetDrawPosition:P,matchUp:D}=GE({targetLink:p,sourceRoundMatchUpCount:A,inContextDrawMatchUps:t,sourceRoundPosition:N,drawDefinition:i})),D||(R=R||t.filter(M=>M.structureId===r.structureId),{matchUp:D}=tTe({structureMatchUps:R,matchUp:n})),He({matchUp:n,targetLinks:{loserTargetLink:h,winnerTargetLink:p,byeTargetLink:m},targetMatchUps:{winnerMatchUpDrawPositionIndex:E,loserMatchUpDrawPositionIndex:T,byeMatchUpDrawPositionIndex:S,winnerTargetDrawPosition:P,loserTargetDrawPosition:U,byeTargetDrawPosition:b,winnerMatchUp:D,loserMatchUp:w,byeMatchUp:I},targetMatchUpIds:!!(l||u)})}function rTe({matchUp:t}){return{targetLinks:{loserTargetLink:void 0,winnerTargetLink:void 0},targetMatchUps:{loserMatchUp:void 0,winnerMatchUp:void 0},matchUp:t}}function nTe({drawDefinition:t,inContextDrawMatchUps:e}){let i={};return e.forEach(r=>{var n,a,o,s,l,u;let{matchUpId:c,structureId:d,drawPositions:p=[]}=r,{structure:m}=tt({drawDefinition:t,structureId:d});if((m==null?void 0:m.finishingPosition)===Xd){let{roundNumber:h}=r,f=h&&Ze(h)+1,g=m.matchUps??[],{roundMatchUps:v}=An({matchUps:g});if(f&&v!=null&&v[f]){let y=[...p].sort(lr).map((I,b)=>{let S=v[f].find(w=>{var U;return(U=w.drawPositions)==null?void 0:U.includes(I)});return{matchUpId:S==null?void 0:S.matchUpId,roundNumber:f,schedule:S==null?void 0:S.schedule,sideNumber:b+1,structureName:m.structureName}});Object.assign(r,{sidesTo:y})}}else{let h=On({useTargetMatchUpIds:!0,inContextDrawMatchUps:e,inContextMatchUp:r,drawDefinition:t,matchUpId:c}),{winnerMatchUp:f}=h.targetMatchUps,{loserMatchUp:g}=h.targetMatchUps;!r.winnerMatchUpId&&f&&(r.winnerMatchUpId=f.matchUpId),!r.loserMatchUpId&&g&&(r.loserMatchUpId=g.matchUpId);let v=HE({upcomingMatchUp:f}),y=HE({upcomingMatchUp:g});if(r.matchUpStatus!==jt&&(g==null?void 0:g.matchUpStatus)===jt){let{matchUp:b}=lJ({matchUp:g,drawDefinition:t,inContextDrawMatchUps:e})||{};y=b&&HE({upcomingMatchUp:b})||y}let I=(n=r.schedule)==null?void 0:n.timeAfterRecovery;if(I&&((a=v==null?void 0:v.schedule)!=null&&a.scheduledTime&&xt(v.schedule.scheduledTime)<xt(I)&&(i[v.matchUpId]=r.matchUpId,v.schedule.scheduleConflict=r.matchUpId),(o=y==null?void 0:y.schedule)!=null&&o.scheduledTime&&xt(y.schedule.scheduledTime)<xt(I)&&(i[y.matchUpId]=r.matchUpId,y.schedule.scheduleConflict=r.matchUpId)),Object.assign(r,{winnerTo:v,loserTo:y}),(s=r.drawPositions)==null?void 0:s.filter(Boolean).length){let b=((u=(l=h.targetLinks)==null?void 0:l.loserTargetLink)==null?void 0:u.linkCondition)===ll,S=aTe(r);if(S.length){let w=yM(f==null?void 0:f.sides),U=yM(g==null?void 0:g.sides),T=S.find(({participantId:P})=>w.includes(P))?[]:S,D=S.find(({participantId:P})=>U.includes(P))?[]:S;g&&b&&D.length<2&&D.push({bye:!0,tbd:!0}),T!=null&&T.length&&f&&(!h.targetMatchUpIds&&f&&(f=e.find(({matchUpId:P})=>P===f.matchUpId)),f.potentialParticipants||(f.potentialParticipants=[]),f.potentialParticipants.push(T)),D!=null&&D.length&&g&&(h.targetMatchUpIds||(f=e.find(({matchUpId:P})=>P===g.matchUpId)),g.potentialParticipants||(g.potentialParticipants=[]),g.potentialParticipants.push(D))}}}}),Object.keys(i).length&&e.forEach(r=>{Object.keys(i).includes(r.matchUpId)&&(r.schedule.scheduleConflict=i[r.matchUpId])}),{scheduleConflictMatchUpIds:i}}function aTe(t){var e;return((e=t==null?void 0:t.sides)==null?void 0:e.map(({participant:i,participantId:r,qualifier:n})=>i||r&&{participantId:r}||n&&{qualifier:n}).filter(Boolean))||[]}function lJ({matchUp:t,drawDefinition:e,inContextDrawMatchUps:i}){var r;let{matchUpId:n,matchUpStatus:a,structureId:o}=t||{};if(!t||!o||(t==null?void 0:t.matchUpStatus)===Qi)return{matchUp:t};if(a===jt){let s;return t.winnerMatchUpId?s=i.find(({matchUpId:l})=>l===t.winnerMatchUpId):{winnerMatchUp:s}=((r=On({inContextDrawMatchUps:i,drawDefinition:e,matchUpId:n}))==null?void 0:r.targetMatchUps)||{},lJ({matchUp:s,drawDefinition:e,inContextDrawMatchUps:i})}return{matchUp:void 0}}function HE(t){if(t!=null&&t.upcomingMatchUp)return(({matchUpId:e,structureId:i,schedule:r,roundNumber:n,roundPosition:a,structureName:o})=>({matchUpId:e,structureId:i,schedule:r,roundNumber:n,roundPosition:a,structureName:o}))(t.upcomingMatchUp)}function fr(t){let e="getAllDrawMatchUps";Object.assign(t,{requireParticipants:!1});let i=wv(t);if(i.error)return te({result:i,stack:e});let{abandonedMatchUps:r,completedMatchUps:n,upcomingMatchUps:a,pendingMatchUps:o,byeMatchUps:s,matchUpsMap:l}=i;return{matchUps:(r??[]).concat(...n??[],...a??[],...o??[],...s??[]),matchUpsMap:l}}function wv(t){if(!(t!=null&&t.drawDefinition))return{error:$e};let{tournamentParticipants:e,contextContent:i,matchUpsMap:r}=t,{scheduleVisibilityFilters:n,tournamentAppliedPolicies:a,requireParticipants:o,participantsProfile:s,afterRecoveryTimes:l,policyDefinitions:u,tournamentRecord:c,usePublishState:d,contextFilters:p,matchUpFilters:m,scheduleTiming:h,participantMap:f,publishStatus:g,contextProfile:v,drawDefinition:y,nextMatchUps:I,inContext:b,context:S,event:w}=t,U=[],T=[],D=[],P=[],E=[];v&&!i&&(i=tc({policyDefinitions:u,tournamentRecord:c,contextProfile:v,event:w}));let R;!(e!=null&&e.length)&&c&&(e=c==null?void 0:c.participants,(b||s!=null&&s.withGroupings)&&e!=null&&e.length&&({participantsWithGroupings:e,groupInfo:R}=pL({participants:e,participantsProfile:s})));let{structures:N}=ns({drawDefinition:y});if(!N)return{error:Ai};r||(r=ln({drawDefinition:y}));let A=y&&GX({drawDefinition:y}).exitProfiles;N.forEach(O=>{let{byeMatchUps:k=[],pendingMatchUps:x=[],upcomingMatchUps:F=[],completedMatchUps:$=[],abandonedMatchUps:_=[]}=ZP({matchUpFilters:I?void 0:m,contextFilters:I?void 0:p,inContext:b||I||p,hydrateParticipants:t.hydrateParticipants,tournamentAppliedPolicies:a,scheduleVisibilityFilters:n,tournamentParticipants:e,requireParticipants:o,afterRecoveryTimes:l,policyDefinitions:u,tournamentRecord:c,usePublishState:d,contextContent:i,participantMap:f,scheduleTiming:h,publishStatus:g,contextProfile:v,drawDefinition:y,exitProfiles:A,matchUpsMap:r,structure:O,context:S,event:w});U=U.concat(..._),T=T.concat(...$),D=D.concat(...F),P=P.concat(...x),E=E.concat(...k)});let M=O=>(!m&&!I&&!p||(m&&(O=pu({matchUps:O,...m})),p&&(O=pu({matchUps:O,...p,processContext:!0}))),O),C={abandonedMatchUps:M(U),completedMatchUps:M(T),upcomingMatchUps:M(D),pendingMatchUps:M(P),byeMatchUps:M(E),matchUpsMap:r,...Q,groupInfo:R};if(I){let O=typeof I=="object"||{abandoned:!0,completed:!0,upcoming:!0,pending:!0,bye:!0},{abandoned:k,completed:x,upcoming:F,pending:$,bye:_}=O,L=[].concat(...k&&U||[],...x&&T||[],...F&&D||[],...$&&P||[],..._&&E||[]);nTe({inContextDrawMatchUps:L,drawDefinition:y})}return C}function au(t){let{participants:e=[],contextContent:i,participantMap:r}=t,{scheduleVisibilityFilters:n,tournamentAppliedPolicies:a,participantsProfile:o,afterRecoveryTimes:s,policyDefinitions:l,useParticipantMap:u,tournamentRecord:c,contextFilters:d,contextProfile:p,matchUpFilters:m,nextMatchUps:h,inContext:f,context:g,event:v}=t;if(!v)return{error:vi};let{eventId:y,eventName:I,endDate:b,eventType:S,category:w,gender:U,matchUpFormat:T}=v??{},D={...g,...He({indoorOutDoor:v.indoorOutdoor??(c==null?void 0:c.indoorOutdoor),surfaceCategory:v.surfaceCategory??(c==null?void 0:c.surfaceCategory),endDate:v.endDate??(c==null?void 0:c.endDate),tournamentId:c==null?void 0:c.tournamentId,matchUpFormat:T,eventName:I,eventType:S,category:w,eventId:y,gender:U})};b&&(D.endDate=b),p&&!i&&(i=tc({policyDefinitions:l,tournamentRecord:c,contextProfile:p,event:v}));let P;if(!(e!=null&&e.length)&&!r&&c){let N=Rh({participantsProfile:o,useParticipantMap:u,policyDefinitions:l,tournamentRecord:c,contextProfile:p,inContext:f});r=N.participantMap,e=N.participants??[],P=N.groupInfo}let E=v.drawDefinitions??[],R=pw({tournamentRecord:c,event:v}).scheduleTiming;return{matchUps:E.flatMap(N=>{let{matchUps:A}=fr({tournamentParticipants:e,tournamentAppliedPolicies:a,scheduleVisibilityFilters:n,context:D,participantsProfile:o,afterRecoveryTimes:s,policyDefinitions:l,tournamentRecord:c,contextFilters:d,contextProfile:p,drawDefinition:N,contextContent:i,matchUpFilters:m,participantMap:r,scheduleTiming:R,nextMatchUps:h,inContext:f,event:v});return A??[]}),groupInfo:P}}function Hr(t){let e=We(t,[{tournamentRecord:!0}]);if(e.error)return e;if(!(t!=null&&t.tournamentRecord))return{error:ve};let{participantMap:i,participants:r}=t,{scheduleVisibilityFilters:n,participantsProfile:a,afterRecoveryTimes:o,useParticipantMap:s,policyDefinitions:l,tournamentRecord:u,inContext:c=!0,contextProfile:d,matchUpFilters:p,contextFilters:m,nextMatchUps:h,context:f}=t,g=t.tournamentId??u.tournamentId,v=(u==null?void 0:u.events)??[];r||({participants:r,participantMap:i}=Rh({participantsProfile:a,useParticipantMap:s,policyDefinitions:l,tournamentRecord:u,contextProfile:d,inContext:c}));let{appliedPolicies:y}=Bt({tournamentRecord:u}),I={...f,tournamentId:g,indoorOutDoor:u.indoorOutdoor,surfaceCategory:u.surfaceCategory,endDate:u.endDate},b=tc({policyDefinitions:l,tournamentRecord:u,contextProfile:d});return{matchUps:v.flatMap(S=>{var w;return I.eventDrawsCount=((w=S.drawDefinitions)==null?void 0:w.length)??0,au({context:I,scheduleVisibilityFilters:n,tournamentAppliedPolicies:y,participantsProfile:a,afterRecoveryTimes:o,policyDefinitions:l,tournamentRecord:u,contextContent:b,contextFilters:m,contextProfile:d,matchUpFilters:p,participantMap:i,nextMatchUps:h,participants:r,inContext:c,event:S}).matchUps??[]}).concat(...u.matchUps??[])}}function Os({scheduleVisibilityFilters:t,afterRecoveryTimes:e,participantsProfile:i,tournamentRecords:r,policyDefinitions:n,matchUpFilters:a,contextFilters:o,nextMatchUps:s,inContext:l}){if(typeof r!="object"||!Object.keys(r).length)return{error:xi};let u=Object.keys(r).map(c=>{let d=r[c];return Hr({scheduleVisibilityFilters:t,afterRecoveryTimes:e,participantsProfile:i,policyDefinitions:n,tournamentRecord:d,matchUpFilters:a,contextFilters:o,nextMatchUps:s,inContext:l}).matchUps??[]}).flat();return{...Q,matchUps:u}}function xh(t,e){return oTe(t,e)||((t==null?void 0:t.stageSequence)||0)-((e==null?void 0:e.stageSequence)||0)||(t==null?void 0:t.roundNumber)&&e.roundNumber&&(t==null?void 0:t.roundNumber)-(e==null?void 0:e.roundNumber)||((t==null?void 0:t.roundPosition)??0)-((e==null?void 0:e.roundPosition)??0)}function oTe(t,e){return(Om[t==null?void 0:t.stage]||0)-(Om[e==null?void 0:e.stage]||0)}function Pn(t){let{participants:e,participantMap:i,contextContent:r}=t,{scheduleVisibilityFilters:n,tournamentAppliedPolicies:a,participantsProfile:o,afterRecoveryTimes:s,policyDefinitions:l,useParticipantMap:u,tournamentRecord:c,matchUpFilters:d,contextFilters:p,contextProfile:m,drawDefinition:h,nextMatchUps:f,inContext:g,context:v,event:y}=t,{eventId:I,eventName:b,endDate:S,eventType:w,category:U,gender:T,matchUpFormat:D}=y??{},P={...v,surfaceCategory:(y==null?void 0:y.surfaceCategory)??(c==null?void 0:c.surfaceCategory),indoorOutDoor:(y==null?void 0:y.indoorOutdoor)??(c==null?void 0:c.indoorOutdoor),matchUpFormat:D,eventType:w,eventName:b,category:U,eventId:I,endDate:S,gender:T},E;return!(e!=null&&e.length)&&!i&&c&&({participants:e=[],participantMap:i,groupInfo:E}=Rh({participantsProfile:o,useParticipantMap:u,policyDefinitions:l,tournamentRecord:c,contextProfile:m,inContext:g})),m&&!r&&(r=tc({policyDefinitions:l,tournamentRecord:c,contextProfile:m,drawDefinition:h,event:y})),{...fr({context:P,tournamentAppliedPolicies:a,scheduleVisibilityFilters:n,tournamentParticipants:e,participantsProfile:o,afterRecoveryTimes:s,policyDefinitions:l,tournamentRecord:c,drawDefinition:h,contextContent:r,contextFilters:p,contextProfile:m,matchUpFilters:d,participantMap:i,nextMatchUps:f,inContext:g,event:y}),groupInfo:E}}function lm({element:t,accessor:e}){if(typeof e!="string")return{values:[]};let i=Ne(t),r=e.split("."),n=[],a;s({targetElement:i,attributes:r});let o={value:a};return n.length&&(o.values=n),o;function s({targetElement:l,attributes:u=[],significantCharacters:c}){for(let[p,m]of u.entries())if(l!=null&&l[m]){let h=u.slice(p+1);h.length?Array.isArray(l[m])?l[m].forEach(f=>s({targetElement:f,attributes:h})):(l=l[m],d({targetElement:l,index:p})):(a||(a=l[m]),n.includes(l[m])||n.push(l[m]))}function d({targetElement:p,index:m}){if(p&&m===u.length-1&&["string","number"].includes(typeof p)){let h=c?p.slice(0,c):p;a?n.includes(h)||n.push(h):(a=h,n.push(h))}}}}var uJ=t=>e=>{var i;return!t||typeof e!="object"?void 0:Array.isArray(t)&&t.map(r=>{var n;return{[r]:(n=lm({element:e,accessor:r}))==null?void 0:n.value}})||typeof t=="object"&&Object.keys(t).map(r=>{var n;return{[r]:(n=lm({element:e,accessor:r}))==null?void 0:n.value}})||((i=typeof t=="string"&&lm({element:e,accessor:t}))==null?void 0:i.value)},Ma=uJ;function Sw({finishingPositionOffset:t=0,finishingPositionLimit:e,positionsFed:i,roundsCount:r,roundLimit:n,matchUps:a,lucky:o,fmlc:s}){var l;if(!Ro(a))return[];let{roundProfile:u,roundNumbers:c=[]}=An({interpolate:!0,matchUps:a});r=r??Math.max(...c,0);let d=n?r-n:0,p=d&&((l=u==null?void 0:u[r-d])==null?void 0:l.matchUpsCount),m=u&&Object.values(u).map(Ma("matchUpsCount")),h=(v,y)=>{let I=Math.min(...v);p&&y&&I===1&&(I=p);let b=Math.max(...v);return e&&b>e&&(b=e),[I,b]},f=u&&Object.assign({},...c.map(v=>{let y=(r??0)+1-v-d,I=u[v].matchUpsCount,b={finishingPositionRange:{},finishingRound:y},S=m==null?void 0:m.slice(v-1).reduce((N,A)=>N+(A||0),0),w=s&&v!==1,U=1+t+(w?i??0:0),T=1,D=Te(U,o?U+I*2:S+U+T),P=S+T-I,E=h(D.slice(P)),R=h(D.slice(0,P),!0);return b.finishingPositionRange={loser:E,winner:R},{[v]:b}})),g=ja({finishingRound:!0});return a.filter(Boolean).forEach(v=>{let y=v.roundNumber&&f[v.roundNumber];g&&!y&&console.log({roundFinishingData:f,matchUp:v}),v.finishingRound=y==null?void 0:y.finishingRound,v.finishingPositionRange=y==null?void 0:y.finishingPositionRange}),a}function tp({inContextDrawMatchUps:t,drawDefinition:e,matchUpsMap:i}){var r;if(!e)return{error:$e};let n={loserMatchUpIds:{},winnerMatchUpIds:{}};if(t||({matchUps:t,matchUpsMap:i}=fr({inContext:!0,drawDefinition:e,matchUpsMap:i})),!(i!=null&&i.drawMatchUps.some(a=>a.finishingPositionRange))&&((r=e==null?void 0:e.structures)==null?void 0:r.length)===1&&!(e!=null&&e.structures[0].structures)){let a=(i==null?void 0:i.drawMatchUps)??[];Sw({matchUps:a})}return(t??[]).filter(({collectionId:a})=>!a).forEach(a=>{let{matchUpId:o,structureId:s}=a,l=On({inContextDrawMatchUps:t,drawDefinition:e,matchUpId:o}),{winnerMatchUp:u,loserMatchUp:c}=l.targetMatchUps,d=u==null?void 0:u.matchUpId,p=c==null?void 0:c.matchUpId,m=Zd({matchUpsMap:i,structureId:s}).find(h=>h.matchUpId===o);if(m&&(d&&(n.winnerMatchUpIds[m.matchUpId]=d,Object.assign(m,{winnerMatchUpId:d}),Object.assign(a,{winnerMatchUpId:d})),p&&(n.loserMatchUpIds[m.matchUpId]=p,a.loserMatchUpId=p,m.loserMatchUpId=p,a.finishingPositionRange))){let h=c.finishingPositionRange&&[...a.finishingPositionRange.loser,...c.finishingPositionRange.loser],f=h&&[Math.min(...h),Math.max(...h)];a.finishingPositionRange.loser=f,m.finishingPositionRange.loser=f}}),{inContextDrawMatchUps:t,goesToMap:n}}function ps(t){var e;let i=To(t),r=t.matchUps??[],n=t.drawIds??[],{includeParticipantDependencies:a,tournamentRecord:o,drawDefinition:s}=t;if(!Array.isArray(r))return{error:Ju};if(!Array.isArray(n))return{error:Fs};let l=(e=t.matchUpIds)!=null&&e.length?t.matchUpIds:r.map(I=>I.matchUpId);if(!Array.isArray(l))return{error:gh};let u={},c={},d={},p={};o&&!Object.keys(i).length&&(i={[o.tournamentId]:o});let m=Object.values(i),h=m.reduce((I,b)=>I.concat(b.events??[]).map(S=>(S.drawDefinitions||[]).map(w=>w.links||[])).flat(1/0),[]).filter(({linkType:I})=>I===Ou),f=r;if(h.length){f=Os({nextMatchUps:!0,tournamentRecords:i}).matchUps;let I=h.reduce((b,S)=>{var w,U;let T=(w=S.source)==null?void 0:w.structureId,D=(U=S.target)==null?void 0:U.structureId;return T&&D&&(d[D]=T),T&&!b.includes(T)&&b.push(T),b},[]);for(let b of I)u[b]=[];for(let b of f??[]){let S=b.containerStructureId||b.structureId;I.includes(S)&&u[S].push(b.matchUpId)}}let g=I=>{c[I]||(c[I]={dependentMatchUpIds:[],participantIds:[],matchUpIds:[],sources:[]},p[I]=[])},v=(I,b)=>{c[I].matchUpIds.forEach(S=>{c[b].matchUpIds.push(S)}),c[b].matchUpIds.push(I),c[I].dependentMatchUpIds.push(b),a&&c[I].participantIds.forEach(S=>c[b].participantIds.push(S))},y=I=>{let b=Object.keys(u).length;for(let S of I||[]){let{matchUpId:w,winnerMatchUpId:U,loserMatchUpId:T}=S;if(!l.length||l.includes(w)){if(g(w),a){let{individualParticipantIds:E}=HP(S);c[w].participantIds=E}U&&(g(U),v(w,U),p[U].push(w)),T&&(g(T),v(w,T),p[T].push(w)),c[w].sources.push(p[w]);let D=p[w].map(E=>c[E].sources[0]).flat(),P=p[w].map(E=>c[E].sources[1]).flat();if(c[w].sources.push(D,P),b){let E=S.containerStructureId||S.structureId,R=d[E];if(u[R])for(let N of u[R])g(N),v(N,w),p[N].push(w)}}}};if(s)tp({drawDefinition:s}),f!=null&&f.length||(f=Pn({drawDefinition:s}).matchUps),y(f);else{if(f!=null&&f.length||(f=Os({nextMatchUps:!0,tournamentRecords:i}).matchUps),!n.length){let I=m!=null&&m.length?m.map(({events:b=[]})=>b.map(({drawDefinitions:S=[]})=>S.map(({drawId:w})=>w))).flat(1/0):[];I&&(n=I)}for(let I of n){let b=f==null?void 0:f.filter(S=>S.drawId===I).sort(xh);if(!(b!=null&&b.find(({roundPosition:S})=>!S))){let S=b==null?void 0:b.find(({tournamentId:U})=>U),{drawDefinition:w}=Kn({tournamentRecord:i[S==null?void 0:S.tournamentId],drawId:I});w&&tp({drawDefinition:w})}y(b)}}return{positionDependencies:u,matchUpDependencies:c,sourceMatchUpIds:p,matchUps:f,...Q}}function br(t){var e,i;let r=t==null?void 0:t.matchUp,n=(t==null?void 0:t.score)||(r==null?void 0:r.score),a=(e=n==null?void 0:n.sets)==null?void 0:e[0],{side1Score:o,side2Score:s,side1TiebreakScore:l,side2TiebreakScore:u,side1PointScore:c,side2PointScore:d}=a||{},p=o||s||l||u||c||d;return!!(((i=n==null?void 0:n.sets)==null?void 0:i.length)>1||p)}function Tw({matchUpStatus:t}){return wX.includes(t)}function sTe({matchUpStatus:t}){return KF.includes(t)}function RM({matchUpStatus:t}){return UX.includes(t)}function PL({matchUpStatus:t,winningSide:e,tieMatchUps:i,sides:r,score:n}){var a;let o=r==null?void 0:r.find(({participantId:l})=>l),s=(a=i==null?void 0:i.filter(PL))==null?void 0:a.length;return br({score:n})||s||e&&o||t&&sTe({matchUpStatus:t})&&![Pt,Ft,cs].includes(t)}function Dw(t){var e;let{drawDefinition:i,findContainer:r,structureId:n,event:a}=t,o=t.structure,s={isCollectionMatchUp:!1},{containedStructures:l}=yv({drawDefinition:i}),u=n?l[n]||[]:[];if(!o){let T=tt({drawDefinition:i,structureId:n});if(T.error)return T;o=r?T.containingStructure??T.structure:T.structure}if(Yn({structure:o}))return{structure:o,isAdHoc:!0,error:av};let{matchUps:c}=fr({inContext:!0,matchUpFilters:s,drawDefinition:i,event:a}),d=c==null?void 0:c.filter(T=>T.structureId===n||u.includes(T.structureId)),{matchUpDependencies:p}=ps({drawIds:[i.drawId],matchUps:c,drawDefinition:i}),m=[],h=[],f={},g=[];for(let T of c??[]){if(T.structureId===n||u.includes(T.structureId)){h.push(...T.drawPositions??[]);let D=T.roundNumber;for(let P of(T.drawPositions??[]).filter(Boolean))(!f[P]||D&&f[P]>D)&&(f[P]=D)}PL(T)&&(g.push(T),m.push(T.matchUpId,...((e=p==null?void 0:p[T==null?void 0:T.matchUpId])==null?void 0:e.matchUpIds)||[]))}let v=dt(h.filter(Boolean)).sort(lr),y=dt(m),I=dt(d==null?void 0:d.map(({matchUpId:T,drawPositions:D})=>y.includes(T)?D:[]).flat().filter(Boolean)).sort(lr),{positionAssignments:b}=si({drawDefinition:i,structure:o}),S=b==null?void 0:b.filter(T=>T.bye).map(T=>T.drawPosition),w=b==null?void 0:b.filter(T=>T.qualifier).map(T=>T.drawPosition),U=(v==null?void 0:v.filter(T=>!I.includes(T)))||[];return{allDrawPositions:v,inContextStructureMatchUps:d,drawPositionInitialRounds:f,activeDependentMatchUpIds:y,qualifyingDrawPositions:w,inactiveDrawPositions:U,positionAssignments:b,activeDrawPositions:I,byeDrawPositions:S,activeMatchUps:g,structure:o}}function Lm({drawPosition:t,matchUps:e=[]}){return{initialRoundNumber:e.filter(({drawPositions:i})=>t&&(i==null?void 0:i.includes(t))).map(({roundNumber:i})=>i).sort(lr)[0]}}var oc={reset:"\x1B[0m",bright:"\x1B[1m",dim:"\x1B[2m",red:"\x1B[31m",brightred:"\x1B[91m",green:"\x1B[32m",brightgreen:"\x1B[92m",yellow:"\x1B[33m",brightyellow:"\x1B[93m",blue:"\x1B[34m",brightblue:"\x1B[94m",lightblue:"\x1B[105m",magenta:"\x1B[35m",brightmagenta:"\x1B[95m",cyan:"\x1B[36m",brightcyan:"\x1B[96m",white:"\x1B[37m",brightwhite:"\x1B[97m"},d0=[];function Oa(t,e){Di(t)&&(t={method:t}),(e||ja())&&d0.push(t)}function lTe(t){let e=d0.slice();return t&&(d0.length=0),e}function uTe(t){let e=lTe(t).map(i=>{let{color:r,keyColors:n,method:a,newline:o}=i,s=Object.keys(oc).includes(r)?oc[r]:oc.cyan,l=Object.keys(i).filter(c=>!["color","keyColors","method","newline"].includes(c)).map(c=>{let d=n&&Object.keys(n).includes(c)&&oc[n[c]]?oc[n[c]]:oc.brightwhite;return`${oc.white}${c}: ${d}${i[c]}`}).join(", "),u=(a==null?void 0:a.length)<15?"		":"	";return[o?`
`:"",s,a,u,oc.white,l,oc.reset,`
`].join("")});e!=null&&e.length&&console.log(...e)}function cTe(){d0.length=0}function Za({provisionalPositioning:t,isPositionAction:e,tournamentRecord:i,drawDefinition:r,drawPosition:n,matchUpsMap:a,structureId:o,structure:s,event:l}){var u,c,d;if(!r)return{error:$e};if(s||({structure:s}=tt({drawDefinition:r,structureId:o})),!s)return{error:Ai};o||({structureId:o}=s);let p="assignDrawPositionBye";Oa({method:p,color:"cyan",drawPosition:n}),a||(a=ln({drawDefinition:r}));let{positionAssignments:m}=si({structure:s}),{activeDrawPositions:h}=Dw({drawDefinition:r,structureId:o});if((u=m==null?void 0:m.find(R=>R.drawPosition===n))!=null&&u.bye)return{...Q};if(h!=null&&h.includes(n))return{error:aP};let f=m==null?void 0:m.find(R=>R.drawPosition===n);if(!f)return{error:av};let{filled:g,containsBye:v,assignedParticipantId:y}=dTe(f);if(v)return{...Q};if(g&&!v)return te({result:{error:Xf},stack:p});let I=Bt({tournamentRecord:i,drawDefinition:r,event:l}).appliedPolicies??{},b=fr({inContext:!0,drawDefinition:r,matchUpsMap:a}).matchUps??[],S={isCollectionMatchUp:!1},{matchUps:w}=qt({provisionalPositioning:t,drawDefinition:r,matchUpFilters:S,matchUpsMap:a,structure:s});if(m==null||m.forEach(R=>{R.drawPosition===n&&(R.bye=!0)}),s.structureType===_n)return pTe({tournamentRecord:i,drawDefinition:r,drawPosition:n,matchUps:w}),Fc({tournamentId:i==null?void 0:i.tournamentId,drawDefinition:r,structure:s,event:l}),T2({assignedParticipantId:y,isPositionAction:e,appliedPolicies:I,drawDefinition:r,drawPosition:n,structureId:o,stack:p});let{roundProfile:U,roundMatchUps:T}=An({matchUps:w}),D=(c=U&&Object.keys(U).map(R=>parseInt(R)).reverse())==null?void 0:c.find(R=>{var N;return(N=U==null?void 0:U[R].drawPositions)==null?void 0:N.includes(n)}),P=D?T==null?void 0:T[D].find(({drawPositions:R})=>R==null?void 0:R.includes(n)):void 0;P&&cJ({tournamentRecord:i,drawDefinition:r,matchUp:P,event:l});let E=(d=P==null?void 0:P.drawPositions)==null?void 0:d.find(R=>R!==n);if(P&&E){let R=RL({sourceDrawPositions:P.drawPositions,matchUpId:P.matchUpId,inContextDrawMatchUps:b,drawPositionToAdvance:E,tournamentRecord:i,drawDefinition:r,matchUpsMap:a});if(R.error)return R}return Fc({tournamentId:i==null?void 0:i.tournamentId,drawDefinition:r,structure:s,event:l}),T2({assignedParticipantId:y,isPositionAction:e,appliedPolicies:I,drawDefinition:r,drawPosition:n,structureId:o,stack:p})}function T2({assignedParticipantId:t,isPositionAction:e,appliedPolicies:i,drawDefinition:r,drawPosition:n,structureId:a,stack:o}){return e&&GP({appliedPolicies:i,drawDefinition:r,positionAction:{removedParticipantId:t,drawPosition:n,structureId:a,name:o}}),te({result:{...Q},stack:o})}function dTe(t){let e=t.bye,i=t.qualifier,r=t.participantId;return{containsBye:e,containsQualifier:i,assignedParticipantId:r,filled:e||i||r}}function cJ({tournamentRecord:t,drawDefinition:e,eventId:i,matchUp:r,event:n}){Object.assign(r,{matchUpStatus:jt,score:void 0,winningSide:void 0}),Et({tournamentId:t==null?void 0:t.tournamentId,eventId:i??(n==null?void 0:n.eventId),context:"setMatchUpStatusBye",drawDefinition:e,matchUp:r})}function pTe({tournamentRecord:t,drawDefinition:e,drawPosition:i,matchUps:r,event:n}){r.forEach(a=>{var o;(o=a.drawPositions)!=null&&o.includes(i)&&cJ({eventId:n==null?void 0:n.eventId,tournamentRecord:t,drawDefinition:e,matchUp:a})})}function RL({drawPositionToAdvance:t,inContextDrawMatchUps:e,sourceDrawPositions:i,tournamentRecord:r,drawDefinition:n,matchUpsMap:a,matchUpId:o,event:s}){var l,u;Oa({method:"advanceDrawPosition",color:"cyan",drawPositionToAdvance:t});let c=a.drawMatchUps.find(S=>S.matchUpId===o),d=(l=e.find(S=>S.matchUpId===o))==null?void 0:l.structureId,{structure:p}=tt({drawDefinition:n,structureId:d}),{positionAssignments:m}=si({structure:p}),h=m==null?void 0:m.filter(S=>S.bye).map(S=>S.drawPosition),f=(u=c==null?void 0:c.drawPositions)==null?void 0:u.find(S=>S!==t),g=f&&(h==null?void 0:h.includes(f)),{targetLinks:{loserTargetLink:v},targetMatchUps:{loserMatchUp:y,winnerMatchUp:I,loserTargetDrawPosition:b}}=On({inContextDrawMatchUps:e,drawDefinition:n,matchUpId:o});if(I&&I.structureId===(p==null?void 0:p.structureId)&&mTe({drawPositionToAdvance:t,inContextDrawMatchUps:e,sourceDrawPositions:i,tournamentRecord:r,drawDefinition:n,winnerMatchUp:I,matchUpsMap:a,event:s}),y&&g&&y.structureId!==(p==null?void 0:p.structureId)){let{roundNumber:S}=y;if(S===1){let w=Za({structureId:v.target.structureId,drawPosition:b,tournamentRecord:r,drawDefinition:n,event:s});if(w.error)return w}else dJ({loserTargetDrawPosition:b,tournamentRecord:r,loserTargetLink:v,drawDefinition:n,loserMatchUp:y,matchUpsMap:a,event:s})}return{...Q}}function mTe({drawPositionToAdvance:t,inContextDrawMatchUps:e,sourceDrawPositions:i,tournamentRecord:r,drawDefinition:n,winnerMatchUp:a,matchUpsMap:o,event:s}){var l,u,c,d,p,m;let h="advanceWinner",f=o.drawMatchUps.find(F=>F.matchUpId===a.matchUpId),g=(l=e.find(F=>F.matchUpId===a.matchUpId))==null?void 0:l.structureId,{structure:v}=tt({drawDefinition:n,structureId:g}),{positionAssignments:y}=si({structure:v}),I=(u=y==null?void 0:y.find(({drawPosition:F})=>F===t))==null?void 0:u.bye,b=(c=f.drawPositions)==null?void 0:c.filter(Boolean),S=y==null?void 0:y.filter(F=>b==null?void 0:b.includes(F.drawPosition)),w=y==null?void 0:y.find(({drawPosition:F})=>F===t),U=i==null?void 0:i.find(F=>F!==t),T=(d=U&&(S==null?void 0:S.find(({drawPosition:F})=>F===U)))==null?void 0:d.bye,D=I&&T;if(D&&console.log({isByeAdvancedBye:D}),(b==null?void 0:b.length)>1&&I&&!T)return te({result:{error:Xf},stack:h});let P=b==null?void 0:b.find(F=>F!==t),E=D,R=[...(f.drawPositions||[]).filter(Boolean),void 0,void 0].slice(0,2),N=R.map(F=>!F&&!E||F===t?(E=!0,t):F).sort(lr);if(!E)return console.log("@@@@@@@",{advancingAssignmentIsBye:w,drawPositionToAdvance:t,existingAssignments:S}),te({result:{error:Xf},stack:h});let A=(p=y==null?void 0:y.find(({drawPosition:F})=>F===P))==null?void 0:p.bye,M=(m=y==null?void 0:y.find(({drawPosition:F})=>F===t))==null?void 0:m.bye;Object.assign(f,{matchUpStatus:M||A?jt:Qi,score:void 0,winningSide:void 0,drawPositions:N});let C=f.drawPositions.find(F=>!R.includes(F));Oa({method:h,color:"brightyellow",changedDrawPosition:C,pairedDrawPositionIsBye:A,drawPositionIsBye:M}),Et({tournamentId:r==null?void 0:r.tournamentId,matchUp:f,eventId:s==null?void 0:s.eventId,context:h,drawDefinition:n});let{targetLinks:{loserTargetLink:O},targetMatchUps:{loserMatchUp:k,loserTargetDrawPosition:x}}=On({matchUpId:a.matchUpId,inContextDrawMatchUps:e,drawDefinition:n});if(A||M){let F=A?t:P;if(F)RL({drawPositionToAdvance:F,matchUpId:a.matchUpId,inContextDrawMatchUps:e,tournamentRecord:r,drawDefinition:n,matchUpsMap:o});else if(M&&O&&k)if(k.feedRound)dJ({loserTargetDrawPosition:x,tournamentRecord:r,loserTargetLink:O,drawDefinition:n,loserMatchUp:k,matchUpsMap:o});else{let $=1-a.roundPosition%2,_=k.drawPositions[$],L=Za({structureId:O.target.structureId,drawPosition:_,tournamentRecord:r,drawDefinition:n,event:s});if(L.error)return L}}}function dJ({loserTargetDrawPosition:t,tournamentRecord:e,loserTargetLink:i,drawDefinition:r,loserMatchUp:n,matchUpsMap:a,event:o}){let{roundNumber:s}=n;Oa({method:"assignFedDrawPositionBye",color:"cyan",loserTargetDrawPosition:t});let l=((a==null?void 0:a.mappedMatchUps)||{})[n.structureId].matchUps,{initialRoundNumber:u}=Lm({drawPosition:t,matchUps:l});if(u===s){let c=Za({structureId:i.target.structureId,drawPosition:t,tournamentRecord:e,drawDefinition:r,event:o});if(c.error)return c}}function pJ({positionAssignments:t,tournamentRecord:e,drawDefinition:i,matchUpsMap:r,structure:n,event:a}){let{matchUps:o}=qt({drawDefinition:i,matchUpsMap:r,structure:n,event:a});o.forEach(s=>{let l=t.filter(({drawPosition:u})=>{var c;return(c=s.drawPositions)==null?void 0:c.includes(u)}).filter(u=>u.bye).length;s.winningSide||(Object.assign(s,{matchUpStatus:l?jt:Qi}),Et({tournamentId:e==null?void 0:e.tournamentId,context:"modifyRoundRobinMatchUpsStatus",eventId:a==null?void 0:a.eventId,drawDefinition:i,matchUp:s}))})}function Pw(t){let{inContextDrawMatchUps:e,participantId:i,drawPosition:r}=t,{tournamentRecord:n,drawDefinition:a,structureId:o,matchUpsMap:s,event:l}=t,{structure:u}=tt({drawDefinition:a,structureId:o}),c=(Mr({drawDefinition:a,structure:u}).positionAssignments||[]).find(p=>i&&p.participantId===i||r&&p.drawPosition===r);if(c&&i&&!r&&(r=c==null?void 0:c.drawPosition),!r)return{error:ov};i||(i=c==null?void 0:c.participantId);let{activeDrawPositions:d}=Dw({drawDefinition:a,structureId:o});return d.includes(r)?{error:aP}:(e||({matchUps:e}=fr({inContext:!0,drawDefinition:a,matchUpsMap:s})),EM({inContextDrawMatchUps:e,tournamentRecord:n,drawDefinition:a,structureId:o,drawPosition:r,matchUpsMap:s,event:l}).drawPositionCleared?(Fc({tournamentId:n==null?void 0:n.tournamentId,drawDefinition:a,structure:u,event:l}),{...Q,participantId:i}):{error:_K})}function EM({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,matchUpsMap:n,structureId:a,event:o}){var s,l;let{structure:u}=tt({drawDefinition:i,structureId:a});if(!u)return{error:Ai};let c=Mr({drawDefinition:i,structure:u}).positionAssignments||[],d=c.some(I=>{if(I.drawPosition===r)return delete I.participantId,delete I.qualifier,delete I.bye,!0});if(u.structureType===_n)return pJ({positionAssignments:c,tournamentRecord:e,drawDefinition:i,matchUpsMap:n,structure:u}),{drawPositionCleared:d,...Q};let p={isCollectionMatchUp:!1},{matchUps:m}=qt({drawDefinition:i,matchUpFilters:p,matchUpsMap:n,structure:u,event:o}),{roundProfile:h,roundMatchUps:f}=An({matchUps:m}),g=(s=h&&Object.keys(h))==null?void 0:s.map(I=>Ze(I)),v=r,y=(l=g==null?void 0:g.map(I=>{var b,S,w,U;let T=(S=(b=h==null?void 0:h[I])==null?void 0:b.pairedDrawPositions)==null?void 0:S.find(C=>C.includes(v)),D=T==null?void 0:T.find(C=>C!==v),P=c.find(C=>C.drawPosition===D),E=h==null?void 0:h[I+1],R=P==null?void 0:P.bye,N=(w=E==null?void 0:E.pairedDrawPositions)==null?void 0:w.find(C=>C.includes(D)),A=R&&N&&E&&((U=E.drawPositions)==null?void 0:U.includes(D)),M=T&&{pairedDrawPositionByeAdvancedPair:!A&&N,pairedDrawPosition:D,targetDrawPosition:v,relevantPair:T,roundNumber:I};return A&&(v=D),M}).filter(I=>I==null?void 0:I.targetDrawPosition))==null?void 0:l.reduce((I,b)=>{let{roundNumber:S,relevantPair:w,targetDrawPosition:U,pairedDrawPosition:T,pairedDrawPositionByeAdvancedPair:D}=b,P={roundNumber:S,targetDrawPosition:U,relevantPair:w},E=D&&{roundNumber:S+1,targetDrawPosition:T,relevantPair:D,subsequentRoundRemoval:!0},R=[P,E].filter(Boolean);return I.concat(...R)},[]);return y==null||y.forEach(({roundNumber:I,targetDrawPosition:b,relevantPair:S})=>{let w=f==null?void 0:f[I].find(U=>{var T;return Nn((T=U.drawPositions)==null?void 0:T.filter(Boolean),S.filter(Boolean))});w&&(hTe({inContextDrawMatchUps:t,targetDrawPosition:b,tournamentRecord:e,drawDefinition:i,structureId:a,roundNumber:I,matchUpsMap:n}),mJ({inContextDrawMatchUps:t,positionAssignments:c,tournamentRecord:e,drawDefinition:i,targetMatchUp:w,drawPosition:r,matchUpsMap:n,structure:u,event:o}))}),{tasks:y,drawPositionCleared:d,positionAssignments:c}}function hTe({inContextDrawMatchUps:t,targetDrawPosition:e,tournamentRecord:i,drawDefinition:r,matchUpsMap:n,roundNumber:a,structureId:o}){let{structure:s}=tt({drawDefinition:r,structureId:o});if(!s)return{error:Ai};if(s.structureType===_n)return;n=n||ln({drawDefinition:r});let l=((n==null?void 0:n.mappedMatchUps)||{})[o].matchUps,{initialRoundNumber:u}=Lm({drawPosition:e,matchUps:l}),c=l==null?void 0:l.filter(p=>{var m;return p.roundNumber>=a&&p.roundNumber!==u&&((m=p.drawPositions)==null?void 0:m.includes(e))}),d=si({drawDefinition:r,structureId:o}).positionAssignments??[];return c==null||c.forEach(p=>mJ({drawPosition:e,targetMatchUp:p,inContextDrawMatchUps:t,positionAssignments:d,tournamentRecord:i,drawDefinition:r,matchUpsMap:n,structure:s})),{...Q}}function mJ({inContextDrawMatchUps:t,positionAssignments:e,tournamentRecord:i,drawDefinition:r,targetMatchUp:n,drawPosition:a,matchUpsMap:o,structure:s,event:l}){var u,c,d,p,m;let h="removeDrawPosition",f=(u=n.drawPositions)==null?void 0:u.slice(),g=n.matchUpStatus,v=n.winningSide;o=o??ln({drawDefinition:r});let y=o.mappedMatchUps[s.structureId].matchUps,{initialRoundNumber:I}=Lm({drawPosition:a,matchUps:y});if(n.roundNumber&&I&&n.roundNumber>I){let R=(n.drawPositions??[]).map(N=>N===a?void 0:N);n.drawPositions=R}if(n.matchUpType===fi){let R=(((c=t==null?void 0:t.find(N=>N.matchUpId===n.matchUpId))==null?void 0:c.sides)??[]).reduce((N,A,M)=>A.drawPosition===a?M:N,void 0);R!==void 0&&(p=(d=n.sides)==null?void 0:d[R])!=null&&p.lineUp&&((m=n.sides)==null||delete m[R].lineUp,Et({tournamentId:i==null?void 0:i.tournamentId,context:`${h}-TEAM`,eventId:l==null?void 0:l.eventId,matchUp:n,drawDefinition:r}))}let b=On({matchUpId:n.matchUpId,inContextDrawMatchUps:t,drawDefinition:r}),{targetLinks:{winnerTargetLink:S},targetMatchUps:{loserMatchUp:w,winnerMatchUp:U,loserMatchUpDrawPositionIndex:T}}=b,D=e.filter(({drawPosition:R})=>{var N;return(N=n.drawPositions)==null?void 0:N.includes(R)}).filter(R=>R.bye).length,P=D&&jt||n.matchUpStatus&&[Pt,Ft].includes(n.matchUpStatus)&&n.matcHUpStatus||Qi;n.matchUpStatus=P,n.matchUpStatus&&[Ft,Pt].includes(n.matchUpStatus)&&(n.winningSide=void 0);let E=f==null?void 0:f.find(R=>{var N;return!((N=n.drawPositions)!=null&&N.includes(R))});if(f!=null&&f.includes(a)&&g===n.matchUpStatus&&v===n.winningSide||(E&&Oa({method:h,color:"brightyellow",removedDrawPosition:E}),Et({tournamentId:i==null?void 0:i.tournamentId,context:`${h}-${a}`,eventId:l==null?void 0:l.eventId,matchUp:n,drawDefinition:r})),w&&w.structureId!==b.matchUp.structureId&&!D){let{drawPositions:R,roundNumber:N}=w;if(N===1){let A=R[T];EM({structureId:w.structureId,drawPosition:A,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:r,matchUpsMap:o})}else{let A=Math.min(...R.filter(Boolean)),M=fTe({loserMatchUpDrawPosition:A,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:r,loserMatchUp:w,matchUpsMap:o,event:l});if(M.error)return te({result:M,stack:h});let C=((o==null?void 0:o.mappedMatchUps)||{})[w.structureId].matchUps,{initialRoundNumber:O}=Lm({drawPosition:A,matchUps:C});O===1&&(Oa({method:h,color:"brightyellow",loserMatchUpDrawPosition:A}),EM({structureId:w.structureId,drawPosition:A,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:r,matchUpsMap:o}))}}return U&&U.structureId!==b.matchUp.structureId&&S.target.feedProfile,{...Q}}function fTe({loserMatchUpDrawPosition:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:r,loserMatchUp:n,matchUpsMap:a,event:o}){var s;let{structure:l}=tt({structureId:n.structureId,drawDefinition:r}),{positionAssignments:u}=si({structure:l});if((s=u==null?void 0:u.find(c=>c.drawPosition===t))!=null&&s.bye){let c=Pw({drawPosition:t,structureId:n.structureId,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:r,matchUpsMap:a,event:o});if(c.error)return c}return{...Q}}function Op({drawDefinition:t,stages:e}){if(!t)return{error:$e};let i=((t==null?void 0:t.structures)??[]).filter(n=>!(e!=null&&e.length)||n.stage&&e.includes(n.stage)),r=dt(i.map(n=>{let{positionAssignments:a}=si({structure:n});return a?a.map(Tt):[]}).flat().filter(Boolean));return{...Q,assignedParticipantIds:r}}function Us(t){let e=((t==null?void 0:t.entries)??[]).filter(Boolean).reduce((r,n)=>{let{entryStage:a,entryStatus:o}=n,s=`_${a||Ae}${o||""}`;return r[s]||(r[s]=[]),r[s].push(n),r},{}),i=r=>isNaN(r)?1/0:r;return Object.keys(e).map(r=>e[r].sort((n,a)=>i(n.entryPosition)-i(a.entryPosition)).map((n,a)=>{let o=a+1;return{...n,entryPosition:o}})).flat()}function gd(t){return[Mp,Po].includes(t)}function p0({autoEntryPositions:t=!0,ignoreAssignment:e,tournamentRecord:i,drawDefinition:r,participantIds:n,entryStatus:a,entryStage:o,extension:s,eventSync:l,drawId:u,stage:c,event:d}){var p,m,h,f,g,v,y,I,b,S,w,U;if(!n||!Array.isArray(n))return{error:Ms,method:"modifyEntriesStatus",participantIds:n};if(!r&&!d)return{error:vi};if(a&&!VX.includes(a))return{error:cM};if(o&&!TP.includes(o))return{error:Dp};let T="modifyEntriesStatus",D=[];if(!a&&!s)return te({result:{error:Je},info:"Missing entryStatus",stack:T});if(s&&!ul({extension:s,requiredAttributes:["name"]}))return te({result:{error:se},info:"Invalid extension",context:{extension:s},stack:T});let P=[];(p=d==null?void 0:d.drawDefinitions)==null||p.forEach($=>{let _=Op({stages:c&&[c],drawDefinition:$}).assignedParticipantIds??[];P.push(..._)});let E=(i==null?void 0:i.participants)??[];if(!n.every($=>{var _;let L=(_=Ac({tournamentParticipants:E,participantId:$}))==null?void 0:_.participantType;return!(L&&[ft,Gn].includes(L)&&gd(a))&&!(a&&d!=null&&d.eventType&&L===Dt&&[ho,Ea].includes(d.eventType)&&[qo,...ZU].includes(a))}))return{error:cM};let R=d&&Hi({event:d}).flightProfile,N=(m=R==null?void 0:R.flights)==null?void 0:m.find($=>$.drawId===u),A=$=>{let _=($||[]).filter(B=>!c||!B.entryStage||c===B.entryStage).filter(({participantId:B})=>n.includes(B)),L=B=>a&&P.includes(B.participantId)&&!(ZU.includes(B.entryStatus)&&ZU.includes(a));return _.every(B=>L(B)&&!e?!1:(a&&(B.entryStatus=a,delete B.entryPosition),o&&(B.entryStage=o,delete B.entryPosition),s&&(s.value?_t({element:B,extension:s}):Dn({element:B,name:s.name})),!0))?{...Q}:{error:uv}},M=({flight:$,drawDefinition:_})=>{d&&(d.entries=Us({entries:d.entries??[]})),$&&($.drawEntries=Us({entries:$.drawEntries})),_&&(_.entries=Us({entries:_.entries}))},C=$=>{let{flight:_,drawDefinition:L}=$,B="updateDrawEntries";if(_){let V=A(_.drawEntries);if(V.error)return te({result:V,stack:B})}if(L){let V=A(L.entries);if(V.error)return te({result:V,stack:B});D.includes(L.drawId)||D.push(L.drawId)}return{...Q}},O=((h=d==null?void 0:d.entries)==null?void 0:h.find(({entryPosition:$})=>$))??(((f=N==null?void 0:N.drawEntries)==null?void 0:f.find(({entryPosition:$})=>$))||((g=r==null?void 0:r.entries)==null?void 0:g.find(({entryPosition:$})=>$)));if(t&&!O&&M({flight:N,drawDefinition:r}),N||r){let $=C({flight:N,drawDefinition:r});if($.error)return te({result:$,stack:T})}let k=((v=d==null?void 0:d.drawDefinitions)==null?void 0:v.map(({drawId:$})=>$))??[],x=((y=R==null?void 0:R.flights)==null?void 0:y.filter($=>!k.includes($.drawId)))||[];for(let $ of x){let _=$&&C({flight:$});if(_!=null&&_.error)return te({result:_,stack:T})}let F=((I=R==null?void 0:R.flights)==null?void 0:I.length)===1&&(((b=d==null?void 0:d.drawDefinitions)==null?void 0:b.length)??0)<=((S=R==null?void 0:R.flights)==null?void 0:S.length);if(!N&&!r&&a&&BX.includes(a))return{error:w9};if(!N&&!r||a===Jl||l&&F){let $=A(d==null?void 0:d.entries);if($!=null&&$.error)return te({result:$,stack:T});let _;if(a===Jl&&((w=R==null?void 0:R.flights)==null||w.every(L=>{let B=A(L.drawEntries);return B.error?(_=B.error,!1):(L.drawEntries=L.drawEntries.filter(({participantId:V})=>!n.includes(V)),!0)}),(U=d==null?void 0:d.drawDefinitions)==null||U.every(L=>{var B;let V=A(L.entries);return V.error?(_=V.error,!1):(L.entries=(B=L.entries)==null?void 0:B.filter(({participantId:G})=>!n.includes(G)),!0)})),_)return te({result:{error:_},stack:T})}t&&M({flight:N,drawDefinition:r});for(let $ of(d==null?void 0:d.drawDefinitions)??[])D.length&&!D.includes($.drawId)||ui({tournamentId:i.tournamentId,eventId:d==null?void 0:d.eventId,drawDefinition:$});return{...Q}}function Ll({requireTimeStamp:t,scaleAttributes:e,participant:i}){var r,n;if(!i)return{error:yh};if(!At(e))return{error:se};if(i.timeItems||(i.timeItems=[]),Array.isArray(i.timeItems)){let{accessor:a,scaleType:o,eventType:s,scaleName:l}=e,u=[Jd,o,s,l].join("."),c=i.timeItems.filter(d=>(d==null?void 0:d.itemType)===u).filter(d=>!t||(d==null?void 0:d.itemDate)).sort((d,p)=>(d.createdAt?new Date(d.createdAt).getTime():0)-(p.createdAt?new Date(p.createdAt).getTime():0)).pop();if(c){let[d,p,m,h]=((r=c.itemType)==null?void 0:r.split("."))??[];if(d!==Jd)return{error:Mm};let f=((n=a&&lm({element:c.itemValue,accessor:a}))==null?void 0:n.value)||c.itemValue,g={eventType:m,scaleDate:c.itemDate,scaleValue:f,scaleName:h,scaleType:p};return{...Q,scaleItem:g}}}return{...Q,scaleItem:void 0}}function gTe({publishedSeeding:t,usePublishState:e,withSeeding:i,participant:r,event:n}){var a,o,s;let l={},u=m=>[Jd,xl,n.eventType,m].join("."),c=Object.assign({},...(r.timeItems||[]).filter(({itemType:m})=>m.split(".")[1]===xl).map(({itemType:m,itemValue:h})=>({[m]:h}))),d=((t==null?void 0:t.stageSeedingScaleNames)&&Object.values(t==null?void 0:t.stageSeedingScaleNames)||Array.isArray(t==null?void 0:t.seedingScaleNames)&&t.seedingScaleNames||[]).map(u),p=ji(Object.keys(c),d);if((!e||!Object.keys(c).length&&!((a=t==null?void 0:t.drawIds)!=null&&a.length)||p.length)&&p.length){if(t!=null&&t.stageSeedingScaleNames){let m=Object.keys(t.stageSeedingScaleNames).map(f=>{let g=u(t.stageSeedingScaleNames[f]),v=c[g];return[f,v]}).filter(f=>f[1]).map(f=>({[f[0]]:{seedValue:f[1]}})),h=Object.assign({},...m);l.seedAssignments=h}else if(p){let m=p.map(h=>c[h]);l.seedValue=m.pop()}}else if(!e&&typeof i=="object"){let m=Object.keys(i).map(f=>{let g=u(i[f]),v=c[g];return[f,v]}).filter(f=>f[1]).map(f=>({[f[0]]:{seedValue:f[1]}})),h=Object.assign({},...m);l.seedAssignments=h}else{let{categoryName:m,ageCategoryCode:h}=n.category||{},f=[h,n.eventId,m].filter(Boolean),g;for(let v of f){let y={eventType:n.eventType,scaleType:xl,scaleName:v},I=Ll({scaleAttributes:y,participant:r});if(I.scaleItem){g=I.scaleItem;break}}if(g&&(!e||t!=null&&t.published&&!((s=(o=t==null?void 0:t.published)==null?void 0:o.drawIds)!=null&&s.length))){let v=g.scaleValue;l.seedValue=v}}return l}function vTe({convertExtensions:t,seedAssignments:e,participant:i,withSeeding:r,seedValue:n,eventId:a,ranking:o,entry:s}){let{entryStatus:l,entryStage:u,entryPosition:c,extensions:d}=s,p=d!=null&&d.length&&t?Object.assign({},...RF(d??[])):{},m=Object.assign(p,{entryPosition:c,entryStatus:l,entryStage:u,ranking:o,eventId:a});i.events[a]=He(m,!1,!1,!0),r&&(e&&(i.events[a].seedAssignments=e),n&&(i.events[a].seedValue=n))}function hJ(t){let{participantMap:e,participantId:i,matchUpStatus:r,roundPosition:n,structureId:a,matchUpType:o,roundNumber:s,matchUpId:l,potential:u,schedule:c,drawId:d,score:p}=t;!c||!Object.keys(c).length||r===jt||e[i].scheduleItems.push({...c,scheduledDate:mt(c==null?void 0:c.scheduledDate),scheduledTime:Ui(c==null?void 0:c.scheduledTime),checkScoreHasValue:br({score:p}),matchUpStatus:r,roundPosition:n,structureId:a,matchUpType:o,roundNumber:s,matchUpId:l,potential:u,drawId:d})}function Rw(t){var e,i,r;let n=We(t,[{[Ur]:!0}]);if(n.error)return n;let{tournamentRecord:a,status:o=Qa}=t,s=`${ad}.${od}`;return Ne((r=(i=(e=zP({tournamentRecord:a,itemType:s}))==null?void 0:e.timeItem)==null?void 0:i.itemValue)==null?void 0:r[o],!1,!0)}function ITe(t){let{tournamentId:e}=t??{};return!!e}function Eo({event:t,status:e=Qa}){var i,r,n;let a=`${ad}.${od}`;return(n=(r=(i=dw({itemType:a,event:t}))==null?void 0:i.timeItem)==null?void 0:r.itemValue)==null?void 0:n[e]}function EL({drawDetails:t,drawId:e}){var i,r;return(r=(i=t==null?void 0:t[e])==null?void 0:i.publishingDetail)==null?void 0:r.published}function Fh(t){var e,i,r,n,a,o,s,l,u;let{tournamentRecord:c,drawDefinition:d,eventIds:p,eventId:m,drawIds:h,drawId:f,event:g}=t??{};if(c&&!ITe(c))return{error:se};if(m&&!g)return{error:mo};if(Array.isArray(p)&&p!=null&&p.length){let b={};for(let S of p){if(!Di(S))return{error:se};let w=(e=Kn({tournamentRecord:c,eventId:S}))==null?void 0:e.event;if(!w)return{error:mo};let U=zE({event:w});b[S]=U}return{...Q,publishState:b}}if(g){let b=zE({event:g}),S={};if(f)return d?{publishState:{status:{published:!!((i=b.status.publishedDrawIds)!=null&&i.includes(f)),drawDetail:(r=b.status.drawDetails)==null?void 0:r[f]},...Q}}:{error:Va};if(Array.isArray(h)&&h!=null&&h.length){let w=((n=g.drawDefinitions)==null?void 0:n.map(uy))??[];for(let U of h){if(!Di(U))return{error:se};if(!w.includes(U))return{error:Va};S[U]={status:{published:!!b.status.publishedDrawIds.includes(U),drawDetail:(a=b.status.drawDetails)==null?void 0:a[U]}}}}else S=b;return{...Q,publishState:S}}let v=[],y=!1,I={};for(let b of(c==null?void 0:c.events)??[]){let S=zE({event:b});I[b.eventId]=S,S.status.published&&(v.push(b.eventId),y=!0);for(let{drawId:w}of b.drawDefinitions??[]){let U=(s=(o=S.status)==null?void 0:o.publishedDrawIds)==null?void 0:s.includes(w);U&&(I[w]={status:{published:U}})}}if(c){let b=Rw({tournamentRecord:c});I.tournament=b??{},((l=b==null?void 0:b.orderOfPlay)!=null&&l.published||(u=b==null?void 0:b.participants)!=null&&u.published)&&(y=!0),I.tournament.status={published:y,publishedEventIds:v}}return{...Q,publishState:I}}function zE({event:t}){var e;let i=Eo({event:t});if(!i)return{status:{published:!1}};let r={published:void 0,seedingScaleNames:[],drawIds:[]};i.seeding&&Object.assign(r,i.seeding);let n=i.drawDetails??{};for(let l of((e=t.drawDefinitions)==null?void 0:e.map(uy))||[])n[l]||(n[l]={publishingDetail:{published:!1}});let a=n&&Object.keys(n).length&&Object.keys(n).filter(l=>EL({drawDetails:n,drawId:l})),o=a!=null&&a.length?a:i.drawIds??[];if(o!=null&&o.length&&!(a!=null&&a.length))for(let l of o)n[l]={publishingDetail:{published:!0}};let s=(o==null?void 0:o.length)>0;return{status:{publishedDrawIds:o,publishedSeeding:r,drawDetails:n,published:s}}}function eR(t,e){return(t||"").localeCompare(e||"")}function yTe({finishingPositionRange:t={},participantMap:e,finishingRound:i,participantWon:r,matchUpStatus:n,participantId:a,stageSequence:o,roundNumber:s,structureId:l,matchUpId:u,drawId:c,stage:d}){let p=e[a],m=y=>Math.abs(y[0]-y[1]);p.structureParticipation[l]||(p.structureParticipation[l]={rankingStage:d,walkoverWinCount:0,defaultWinCount:0,stageSequence:o,winCount:0,structureId:l,drawId:c});let h=p.structureParticipation[l],{winner:f,loser:g}=t,v=r?f:g;r&&(h.winCount+=1,n===Ft&&(h.walkoverWinCount+=1),n===Pt&&(h.defaultWinCount+=1)),v&&(!h.finishingPositionRange||m(v)<m(h.finishingPositionRange))&&(h.finishingPositionRange=v),i&&((!h.finishingRound||i<h.finishingRound)&&(h.finishingMatchUpId=u,h.finishingRound=i,h.roundNumber=s),i===1&&(h.participantWon=r))}function D2(t){var e,i,r,n,a,o,s,l,u,c;let{withScheduleItems:d,scheduleAnalysis:p,withTeamMatchUps:m,participantMap:h,withOpponents:f,withMatchUps:g,withEvents:v,withDraws:y,finishingPositionRange:I,finishingRound:b,matchUpStatus:S,stageSequence:w,roundNumber:U,structureId:T,score:D,stage:P,withRankingProfile:E,tieWinningSide:R,roundPosition:N,matchUpTieId:A,matchUpSides:M,collectionId:C,matchUpType:O,winningSide:k,matchUpId:x,schedule:F,eventId:$,drawId:_,sides:L}=t,B=f&&(L==null?void 0:L.length)===2&&Object.assign({},...L.map(({sideNumber:V},G)=>{let j=L[1-G].participantId;return V&&{[V]:j}}).filter(Boolean));for(let V of L){let{participantId:G,sideNumber:j,bye:z}=V;if(z)continue;let W=k===j,q=K=>{var H,Z;let X=(H=h[K])==null?void 0:H.participant,ie=X==null?void 0:X.participantType,ae=[{participantId:K,participantType:ie}];if(ie!==Gn)for(let le of(X==null?void 0:X.individualParticipantIds)||[]){let ne=(Z=h[le])==null?void 0:Z.participant;ae.push({participantType:ne==null?void 0:ne.participantType,participantId:le})}return ae},Y=(K,H)=>{if(g){if(h[K].matchUps[x]={participantWon:W,matchUpType:O,structureId:T,sideNumber:j,matchUpId:x,eventId:$,drawId:_,stage:P},f){let Z=q(H);h[K].matchUps[x].opponentParticipantInfo=Z}C&&(h[K].matchUps[x].collectionId=C)}f&&H&&(h[K].opponents[H]={participantId:H,matchUpId:x,eventId:$,drawId:_}),E&&yTe({finishingPositionRange:I,participantMap:h,participantWon:W,finishingRound:b,matchUpStatus:S,participantId:K,stageSequence:w,roundNumber:U,structureId:T,matchUpId:x,drawId:_,stage:P}),(p||d)&&hJ({participantMap:h,participantId:K,matchUpStatus:S,roundPosition:N,matchUpType:O,roundNumber:U,structureId:T,matchUpId:x,schedule:F,drawId:_,score:D})},re=({participant:K,partnerParticipantId:H})=>{var Z,X,ie;let ae=(le,ne)=>{le&&(le.partnerParticipantIds||(le.partnerParticipantIds=[]),le.partnerParticipantIds.includes(ne)||le.partnerParticipantIds.push(ne))};y&&ae((Z=K==null?void 0:K.draws)==null?void 0:Z[_],H),v&&ae((X=K==null?void 0:K.events)==null?void 0:X[$],H),g&&ae((ie=K==null?void 0:K.matchUps)==null?void 0:ie[x],H)};if(G&&h[G]){let K=B==null?void 0:B[j];Y(G,K);let H=((e=h[G])==null?void 0:e.participant.participantType)===ft,Z=((i=h[G])==null?void 0:i.participant.individualParticipantIds)||[];if(A){if(m){let X=ie=>h[ie].matchUps[A]={participantWon:R===j,matchUpId:A,matchUpType:fi,sideNumber:j};X(G),Z.forEach(X)}if(y&&!h[G].draws[_]){let X=(n=(r=M.find(le=>le.sideNumber===j))==null?void 0:r.participant)==null?void 0:n.participantId,ie=(s=(o=(a=h[X])==null?void 0:a.draws)==null?void 0:o[_])==null?void 0:s.entryStatus,ae=le=>h[le].draws[_]={entryStatus:ie,eventId:$,drawId:_};ae(G),Z.forEach(ae)}}if(H&&(Z.forEach(X=>h[X]&&Y(X,K)),Z.forEach((X,ie)=>{let ae=Z[1-ie],le=h[X];le&&re({participant:le,partnerParticipantId:ae})}),v&&M)){let X=(u=(l=M.find(ie=>ie.sideNumber===j))==null?void 0:l.participant)==null?void 0:u.participantId;if(X){let ie=(c=h[X])==null?void 0:c.events[$];ie?(h[G].events[$]={...ie},Z.forEach(ae=>h[ae].events[$]={...ie})):console.log("Missing teamEntry",{eventId:$,teamParticipantId:X})}}if(k){let X=ie=>{W?(h[ie].counters[O].wins+=1,h[ie].counters.wins+=1,S===Ft&&(h[ie].counters[O].walkoverWins+=1,h[ie].counters.walkoverWins+=1),S===Pt&&(h[ie].counters[O].defaultWins+=1,h[ie].counters.defaultWins+=1)):(h[ie].counters[O].losses+=1,h[ie].counters.losses+=1,S===Ft&&(h[ie].counters[O].walkovers+=1,h[ie].counters.walkovers+=1),S===Pt&&(h[ie].counters[O].defaults+=1,h[ie].counters.defaults+=1))};X(G),Z.forEach(X)}}}}function bTe(t){var e,i,r,n,a,o,s;let{participantFilters:l,convertExtensions:u,policyDefinitions:c,tournamentRecord:d,usePublishState:p,participantMap:m,contextProfile:h,withPotentialMatchUps:f,withRankingProfile:g,withScheduleItems:v,scheduleAnalysis:y,withTeamMatchUps:I,withStatistics:b,withOpponents:S,withMatchUps:w,withSeeding:U,withEvents:T,withDraws:D}=t,P=l==null?void 0:l.participantIds,E=F=>{var $,_;let L=[F];return(_=($=m[F])==null?void 0:$.participant.individualParticipantIds)==null||_.forEach(B=>L.push(B)),L.some(B=>!(P!=null&&P.length)||P.includes(B))?L:[]},R={withMatchUps:w||g,withEvents:T||g,withDraws:D||g,withPotentialMatchUps:f,withRankingProfile:g,withScheduleItems:v,scheduleAnalysis:y,withTeamMatchUps:I,withStatistics:b,participantMap:m,withOpponents:S,withSeeding:U},N=[],A={},M=[],C={},O={},k={},x=({eventType:F,scaleNames:$,participantId:_})=>{var L,B,V,G,j;return(j=(G=(V=(B=(L=m[_])==null?void 0:L.participant)==null?void 0:B.rankings)==null?void 0:V[F])==null?void 0:G.find(z=>$.includes(z.scaleName)))==null?void 0:j.scaleValue};for(let F of(d==null?void 0:d.events)||[]){if(l!=null&&l.eventIds&&!l.eventIds.includes(F.eventId))continue;let{drawDefinitions:$=[],extensions:_=[],eventType:L,eventName:B,category:V,entries:G,eventId:j,gender:z}=F,{flightProfile:W}=Hi({event:F}),q=(W==null?void 0:W.flights)??[],Y=Fh({event:F}).publishState;Y&&(C[j]=Y);let re=(e=Y==null?void 0:Y.status)==null?void 0:e.publishedSeeding;if(T||U||g){let H=u?Object.assign({},...RF(_??[])):{};O[j]={...H,eventName:B,eventType:L,category:V,eventId:j,gender:z};let Z=[V==null?void 0:V.categoryName,V==null?void 0:V.ageCategoryCode].filter(Boolean);for(let X of G){let{participantId:ie}=X;if(!ie||!m[ie])continue;let ae=x({eventType:L,scaleNames:Z,participantId:ie}),le,ne;if(U){let ye=m[ie].participant;({seedAssignments:le,seedValue:ne}=gTe({publishedSeeding:re,usePublishState:p,withSeeding:U,participant:ye,event:F}))}let de=ye=>{var ce,ke;if((ke=(ce=m[ye])==null?void 0:ce.events)!=null&&ke[j])return;let Pe=m[ye];vTe({convertExtensions:u,seedAssignments:le,participant:Pe,withSeeding:U,seedValue:ne,eventId:j,ranking:ae,entry:X})};de(ie),(m[ie].participant.individualParticipantIds||[]).forEach(de)}}let K=(i=C==null?void 0:C[j])==null?void 0:i.publishedSeeding;if(D||g||U){let H=X=>X?Object.assign({},...X.map(({participantId:ie,seedValue:ae,seedNumber:le})=>({[ie]:{seedValue:ae,seedNumber:le}}))):void 0,Z=dt([...$.map(uy),...q.map(uy)]);for(let X of Z){let ie=$.find(we=>we.drawId===X),ae=[V==null?void 0:V.categoryName,V==null?void 0:V.ageCategoryCode].filter(Boolean),{structures:le=[],drawOrder:ne,drawName:de,drawType:ye}=ie??{},ce=q==null?void 0:q.find(we=>we.drawId===X),ke=(ie==null?void 0:ie.entries)||(ce==null?void 0:ce.drawEntries),Pe=ce==null?void 0:ce.flightNumber,it=((ie==null?void 0:ie.structures)||[]).sort((we,Ue)=>Ph(we,Ue)).map(({structureId:we,structures:Ue})=>[we,...(Ue||[]).map(({structureId:wt})=>wt)]).flat(1/0),It,me,fe,pe,Fe=0,De=le.filter(({stage:we,stageSequence:Ue})=>we===Ae&&Ue===1||we===Ke).flatMap(we=>{let{positionAssignments:Ue}=si({structure:we}),{seedAssignments:wt,stageSequence:Le,stage:rt}=we;return rt===Ae?(Fe=(Ue==null?void 0:Ue.length)??0,fe=Ue,pe=wt):Le===1&&(It=Ue,me=wt),Ue}).map(({participantId:we})=>we).filter(Boolean),je=H(pe),ue=H(me),he=ie?ke.filter(({participantId:we})=>De.includes(we)):ke,Re=!p||(K==null?void 0:K.published)&&(((r=K==null?void 0:K.drawIds)==null?void 0:r.length)===0||((n=K==null?void 0:K.drawIds)==null?void 0:n.includes(X)));for(let we of he){if(!m[we.participantId])continue;let{entryStatus:Ue,entryStage:wt,entryPosition:Le,participantId:rt}=we,Ei=x({participantId:rt,scaleNames:ae,eventType:L}),Be=nt=>{var Ii,be,Ct,Ce,qe;if(!m[nt]||(Ii=m[nt].draws)!=null&&Ii[X])return;let Ot=U&&Re,di=Ot?{}:void 0,yi=Ot?((be=je==null?void 0:je[rt])==null?void 0:be.seedValue)||((Ct=je==null?void 0:je[rt])==null?void 0:Ct.seedNumber):void 0,Fi=yi?je==null?void 0:je[rt]:void 0,Ci=Ot?((Ce=ue==null?void 0:ue[rt])==null?void 0:Ce.seedValue)||((qe=ue==null?void 0:ue[rt])==null?void 0:qe.seedNumber):void 0,gn=Ci?ue==null?void 0:ue[rt]:void 0;di&&yi&&(di[Ae]=Fi),di&&Ci&&(di[Ke]=gn);let gr=yi||Ci;gr&&(m[nt].participant.seedings[L]||(m[nt].participant.seedings[L]=[]),Fi&&m[nt].participant.seedings[L].push({...Fi,scaleName:X}),gn&&m[nt].participant.seedings[L].push({...gn,scaleName:X}),di&&(m[nt].events[j].seedAssignments||(m[nt].events[j].seedAssignments={}),Object.keys(di).forEach(Co=>m[nt].events[j].seedAssignments[Co]=di[Co]))),(D||g)&&(m[nt].draws[X]=He({seedAssignments:di,entryPosition:Le,entryStatus:Ue,entryStage:wt,seedValue:gr,eventId:j,ranking:Ei,drawId:X},!1,!1,!0))};[Po,Mp].includes(Ue)||(Be(rt),(a=m[rt].participant.individualParticipantIds||[])==null||a.forEach(Be))}let xe=((ie==null?void 0:ie.structures)??[]).reduce((we,Ue)=>(we.includes(Ue.stage)||we.push(Ue.stage),we),[]),Ee=((ie==null?void 0:ie.links)??[]).length;k[X]={qualifyingPositionAssignments:It,qualifyingSeedAssignments:me,mainPositionAssignments:fe,qualifyingSeedingMap:ue,mainSeedAssignments:pe,orderedStructureIds:it,mainSeedingMap:je,flightNumber:Pe,linksCount:Ee,drawOrder:ne,drawName:de,drawType:ye,drawSize:Fe,drawId:X,stages:xe}}}if(g||y||I||b||S||w||D){let H=!!y||f,Z=((o=au({afterRecoveryTimes:!!y,policyDefinitions:c,tournamentRecord:d,inContext:!0,contextProfile:h,participantMap:m,nextMatchUps:H,event:F}))==null?void 0:o.matchUps)??[];for(let X of Z){let{finishingPositionRange:ie,potentialParticipants:ae,tieMatchUps:le=[],sides:ne=[],winningSide:de,matchUpType:ye,matchUpId:ce,eventId:ke,drawId:Pe,collectionId:it,stageSequence:It,finishingRound:me,matchUpStatus:fe,roundPosition:pe,roundNumber:Fe,structureId:De,schedule:je,score:ue,stage:he}=X;A[ce]=X;let Re={finishingPositionRange:ie,finishingRound:me,stageSequence:It,roundPosition:pe,collectionId:it,roundNumber:Fe,structureId:De,schedule:je,eventId:ke,drawId:Pe,score:ue,stage:he};D2({...Re,...R,matchUpStatus:fe,winningSide:de,matchUpType:ye,matchUpId:ce,sides:ne});for(let xe of le){let{winningSide:Ee,sides:we=[],matchUpId:Ue,matchUpStatus:wt,matchUpType:Le}=xe;D2({...Re,...R,winningSide:Ee,tieWinningSide:de,matchUpTieId:ce,matchUpId:Ue,sides:we,matchUpSides:ne,matchUpStatus:wt,matchUpType:Le})}Array.isArray(ae)&&(H||y||v)&&((s=ae.flat().map(Tt).filter(Boolean))==null||s.forEach(xe=>{var Ee;(Ee=E(xe))==null||Ee.forEach(we=>{m[we]&&(m[we].potentialMatchUps[ce]=He({tournamentId:d==null?void 0:d.tournamentId,matchUpId:ce,eventId:ke,drawId:Pe}))}),(y||v)&&hJ({potential:!0,participantMap:m,participantId:xe,matchUpStatus:fe,roundPosition:pe,structureId:De,matchUpType:ye,roundNumber:Fe,matchUpId:ce,schedule:je,drawId:Pe,score:ue})}))}M.push(...Z)}}if(b||g||y){let F=Object.values(m);for(let $ of F){let{wins:_,losses:L,[ii]:{wins:B,losses:V},[ei]:{wins:G,losses:j}}=$.counters,z=(W,q,Y)=>{let re=q+Y,K=q,H=re&&K/re;$.statistics[W]={denominator:re,numerator:K,statValue:H,statCode:W}};if(b&&(z(QU,_,L),z(`${QU}.${ii}`,B,V),z(`${QU}.${ei}`,G,j)),g){let W=(q=[])=>Math.abs(q[0]-q[1]);for(let q of Object.keys($.draws)){let{orderedStructureIds:Y=[],flightNumber:re}=k[q]||{};if($.structureParticipation&&Y.length){let K,H=0,Z=Y.map(X=>{let ie=$.structureParticipation[X];if(!ie)return;K||(K=ie==null?void 0:ie.finishingPositionRange),W(K)>W(ie==null?void 0:ie.finishingPositionRange)&&(K=ie==null?void 0:ie.finishingPositionRange);let ae=ie.stage!==Ke;return ae&&(H+=1),He({...ie,participationOrder:ae?H:void 0,flightNumber:re})}).filter(Boolean);$.draws[q]&&($.draws[q].finishingPositionRange=K,$.draws[q].structureParticipation=Z)}}}if(y){let W=At(y)?y.scheduledMinutesDifference:0,q=$.scheduleItems||[],Y=$.potentialMatchUps||{},re=q.reduce((H,Z)=>{let{scheduledDate:X,scheduledTime:ie}=Z;return H[X]||(H[X]=[]),ie&&H[X].push(Z),H},{});Object.values(re).forEach(H=>H.sort(a8));for(let H of q){let{typeChangeTimeAfterRecovery:Z,timeAfterRecovery:X,scheduledDate:ie,scheduledTime:ae}=H,le=re[ie],ne=xt(ae);for(let de of le){if(de.matchUpId===H.matchUpId||[Ft,Pt].includes(de.matchUpStatus)&&!de.checkScoreHasValue)continue;let ye=H.matchUpType!==de.matchUpType&&Z||X,ce=H.drawId===de.drawId,ke=Y[H.matchUpId]&&Y[de.matchUpId],Pe=xt(de.scheduledTime),it=Math.abs(Pe-ne),It=Pe>=ne;if((W&&!isNaN(W)?it<=W:It&&xt(de.scheduledTime)<xt(ye))&&!(ke&&ce)&&It){let me=[H.matchUpId,de.matchUpId].sort(eR).join("|");$.scheduleConflicts[me]={priorScheduledMatchUpId:H.matchUpId,matchUpIdWithConflict:de.matchUpId}}}}let K=$.participant.participantId;Object.keys($.scheduleConflicts).length&&N.push(K),m[K].scheduleConflicts=$.scheduleConflicts}}}return{participantIdsWithConflicts:N,eventsPublishStatuses:C,derivedEventInfo:O,derivedDrawInfo:k,mappedMatchUps:A,participantMap:m,matchUps:M}}function Ew({participantFilters:t={},tournamentRecord:e,participants:i=[]}){var r;if(!Object.keys(t).length)return i;let{accessorValues:n,drawEntryStatuses:a,positionedParticipants:o,eventEntryStatuses:s,participantRoles:l,participantRoleResponsibilities:u,participantTypes:c,participantIds:d,signInStatus:p,enableOrFiltering:m,eventIds:h,genders:f}=t,g=Sl(h)&&((r=e==null?void 0:e.events)==null?void 0:r.filter(S=>h==null?void 0:h.includes(S.eventId)))||(e==null?void 0:e.events)||[],v=a&&wTe({drawEntryStatuses:a,tournamentEvents:g}),y=s&&UTe({eventEntryStatuses:s,tournamentEvents:g}),I=o!==void 0&&[!0,!1].includes(o)&&g.reduce((S,w)=>S.concat(...(w.drawDefinitions||[]).map(U=>DX({drawDefinition:U}).allPositionedParticipantIds).filter(Boolean)),[]),b=S=>n==null?void 0:n.reduce((w,U)=>{let{accessor:T,value:D}=U,{values:P}=lm({element:S,accessor:T});return w&&(P==null?void 0:P.includes(D))},!0);if(i=i==null?void 0:i.filter(S=>{var w,U;let T=(U=(w=Do({element:S,itemType:cw}))==null?void 0:w.timeItem)==null?void 0:U.itemValue,{participantRoleResponsibilities:D,participantType:P,participantRole:E,participantId:R,person:N}=S,A=Array.isArray(f)&&(f==null?void 0:f.length)&&(N==null?void 0:N.sex)&&f.includes(N.sex);return m?f&&A||o&&I.includes(R)||o===!1&&!I.includes(R)||(v==null?void 0:v.includes(R))||(y==null?void 0:y.includes(R))||(d==null?void 0:d.includes(R))||p&&T===p||c&&P&&Sl(c)&&c.includes(P)||l&&E&&Sl(l)&&l.includes(E)||u&&Sl(D)&&Sl(u)&&u.find(M=>D==null?void 0:D.includes(M))||(n==null?void 0:n.length)&&Sl(n)&&b(S):(!f||A)&&(o===void 0||o&&I.includes(R)||o===!1&&!I.includes(R))&&(!v||v.includes(R))&&(!y||y.includes(R))&&(!d||d.includes(R))&&(!p||T===p)&&(!c||P&&Sl(c)&&c.includes(P))&&(!l||E&&Sl(l)&&l.includes(E))&&(!u||Sl(D)&&Sl(u)&&u.find(M=>D==null?void 0:D.includes(M)))&&(!(n!=null&&n.length)||Sl(n)&&b(S))}),g.length&&h){let S=g.filter(w=>h.includes(w.eventId)).map(w=>{let U=(w.entries||[]).map(D=>D.participantId);if(Xi(sl)(w.eventType))return U;let T=((e==null?void 0:e.participants)??[]).filter(D=>U.includes(D.participantId)).map(D=>D.individualParticipantIds).flat(1);return U.concat(...T)}).flat(1);i=i==null?void 0:i.filter(w=>S.includes(w.participantId))}return i}function Sl(t){return t&&Array.isArray(t)&&t.length}function wTe({drawEntryStatuses:t,tournamentEvents:e}){let i=({entryStatus:r})=>Array.isArray(t)?t.includes(r):!0;return dt(e.reduce((r,n)=>{var a,o;let{flightProfile:s}=Hi({event:n}),l=((a=s==null?void 0:s.flights)==null?void 0:a.map(({drawEntries:c})=>Array.isArray(c)?c.filter(i).map(Tt):[]).flat())||[],u=((o=n.drawDefinitions)==null?void 0:o.map(({entries:c})=>c?c.filter(i).map(Tt):[]))||[];return r.concat(...l,...u)},[]))}function UTe({eventEntryStatuses:t,tournamentEvents:e}){return dt(e.reduce((i,r)=>{let n=(r.entries||[]).filter(({entryStatus:a})=>Array.isArray(t)?t.includes(a):!0).map(Tt);return i.concat(...n)},[]))}function Oi(t){var e;let{withIndividualParticipants:i,participantFilters:r={},withPotentialMatchUps:n,withRankingProfile:a,convertExtensions:o,policyDefinitions:s,withScheduleItems:l,tournamentRecord:u,scheduleAnalysis:c,withSignInStatus:d,withTeamMatchUps:p,withScaleValues:m,usePublishState:h,contextProfile:f,withStatistics:g,withOpponents:v,withMatchUps:y,internalUse:I,withSeeding:b,withEvents:S,withDraws:w,withISO2:U,withIOC:T}=t;if(!u)return{error:ve};(y||a)&&ps({tournamentRecord:u});let D=_X({convertExtensions:o,tournamentRecord:u,withSignInStatus:d,withScaleValues:m,internalUse:I,withISO2:U,withIOC:T}),{participantMap:P}=D,E=bTe({withMatchUps:y??a,withEvents:S??a,withDraws:w??a,withPotentialMatchUps:n,participantFilters:r,withRankingProfile:a,convertExtensions:o,withScheduleItems:l,policyDefinitions:s,tournamentRecord:u,scheduleAnalysis:c,withTeamMatchUps:p,usePublishState:h,withStatistics:g,participantMap:P,withOpponents:v,contextProfile:f,withSeeding:b}),{participantIdsWithConflicts:R,eventsPublishStatuses:N,derivedEventInfo:A,derivedDrawInfo:M,mappedMatchUps:C}=E,O=E.matchUps;P=E.participantMap;let k=c??n,x=({potentialMatchUps:V,scheduleConflicts:G,scheduleItems:j,participant:z,statistics:W,opponents:q,matchUps:Y,events:re,draws:K})=>{let H=Object.values(K),Z=Object.values(q);return v&&(H==null||H.forEach(X=>{X.opponents=Z.filter(ie=>ie.drawId===X.drawId)})),He({...z,scheduleConflicts:c?Object.values(G):void 0,draws:w||a?H:void 0,events:S||a?Object.values(re):void 0,matchUps:y||a?Object.values(Y):void 0,opponents:v?Z:void 0,potentialMatchUps:k?Object.values(V):void 0,statistics:g?Object.values(W):void 0,scheduleItems:l?j:void 0},!1,!1,!0)},F=new Map;for(let V of Object.keys(P))F.set(V,x(P[V]));let $=[...F.values()],_=(e=s==null?void 0:s[gv])==null?void 0:e.participant,L=Ew({participants:$,participantFilters:r,tournamentRecord:u});if(i){let V=At(i)?i:void 0;for(let G of L)for(let j of G.individualParticipantIds??[]){let z=P[G.participantId].participant;z!=null&&z.individualParticipants||(z.individualParticipants=[]),G.individualParticipants||(G.individualParticipants=[]);let W=F.get(j),q=V?km({template:V,source:W}):W;z!=null&&z.individualParticipants&&z.individualParticipants.push(q),G.individualParticipants.push(q)}}let B=_?L.map(V=>km({source:V,template:_})):L;return{participantMap:t.returnParticipantMap!==!1?P:void 0,mappedMatchUps:t.returnMatchUps!==!1?C:void 0,matchUps:t.returnMatchUps!==!1?O:void 0,missingParticipantIds:D.missingParticipantIds,participantIdsWithConflicts:R,eventsPublishStatuses:N,derivedEventInfo:A,derivedDrawInfo:M,participants:B,...Q}}function um({participantId:t,drawDefinition:e,entryStatus:i,entryStage:r}){var n;if(!e)return{error:$e};let a=(n=e.entries)==null?void 0:n.find(o=>o.participantId===t&&(!i||i===o.entryStatus)&&(!r||r===o.entryStage));return t&&a}function Uv(t){var e,i,r,n,a,o,s,l,u;let{provisionalPositioning:c,drawDefinition:d,stageSequence:p,structureId:m,stage:h}=t;if(!d)return{error:$e};let{entryProfile:f}=mw({drawDefinition:d}),g=h&&p&&((r=(i=(e=f==null?void 0:f[h])==null?void 0:e.stageSequence)==null?void 0:i[p])==null?void 0:r.qualifiersCount)||h&&((n=f==null?void 0:f[h])==null?void 0:n.qualifiersCount)||0,v={};if(!m)return{qualifiersCount:g,roundQualifiersCounts:v};let{structure:y}=tt({drawDefinition:d,structureId:m}),I=(a=d.links)==null?void 0:a.filter(w=>{var U;return((U=w==null?void 0:w.target)==null?void 0:U.structureId)===(y==null?void 0:y.structureId)}),b=0;if(I!=null&&I.length)for(let w of I){let U=(o=tt({structureId:w.source.structureId,drawDefinition:d}))==null?void 0:o.structure;if((U==null?void 0:U.stage)===Ke){let T=w.source.roundNumber,D=w.target.roundNumber,P=0;if(U.structureType===_n){let E=((s=U.structures)==null?void 0:s.length)??0,R=((l=w.source.finishingPositions)==null?void 0:l.length)??0;P=E*R}else P=((u=qt({matchUpFilters:{roundNumbers:[T]},structure:U,afterRecoveryTimes:!1,provisionalPositioning:c,inContext:!1}).matchUps)==null?void 0:u.length)||0;v[D]||(v[D]=0),v[D]+=P,b+=P}}let S=Object.keys(v);if(S.length<=1){let w=S[0]||1;v[w]=Math.max(v[w]||0,g)}return b=Math.max(b,g),{qualifiersCount:b,roundQualifiersCounts:v}}function m0({stage:t,drawDefinition:e}){var i;let{entryProfile:r}=mw({drawDefinition:e});return((i=r==null?void 0:r[t])==null?void 0:i.drawSize)||0}function STe(t){let{provisionalPositioning:e,drawDefinition:i,stageSequence:r,stage:n}=t,a=m0({stage:n,drawDefinition:i}),{qualifiersCount:o}=Uv({provisionalPositioning:e,drawDefinition:i,stageSequence:r,stage:n});return a&&a-o}function fJ({stage:t,drawDefinition:e}){return!!(t===Lr||IL({stage:t,drawDefinition:e})&&m0({stage:t,drawDefinition:e}))}function gJ({entryStatus:t=ca,drawDefinition:e,stageSequence:i,stage:r}){if(t===qo)return f0e({stage:r,drawDefinition:e})?{positionsAvailable:1/0,...Q}:{error:b9};let n=STe({drawDefinition:e,stageSequence:i,stage:r}),a=g0e({drawDefinition:e,stage:r}),o=UM({entryStatus:cg,drawDefinition:e,stage:r}),s=UM({entryStatus:ca,drawDefinition:e,stage:r}),l=o+s,u=l>=n,c=n-l;return r!==Lr&&u?{error:dM}:t===cg?o<a?{...Q}:{error:dM}:{positionsAvailable:c,...Q}}function CL(t){let e=We(t,[{[$n]:!0,[eX]:!0}]);if(e.error)return e;let{suppressDuplicateEntries:i=!0,entryStatus:r=ca,entryStageSequence:n,entryStage:a=Ae,ignoreStageSpace:o,drawDefinition:s,entryPosition:l,participant:u,roundTarget:c,extensions:d,extension:p,drawType:m,event:h}=t,f="addDrawEntry";if(m!==Ga&&!fJ({stage:a,drawDefinition:s}))return te({result:{error:Dp},stack:f});let g=gJ({stageSequence:n,stage:a,drawDefinition:s,entryStatus:r});if(!o&&!g.success&&(!m||m!==Ga))return{error:g.error};if(p&&!ul({extension:p}))return te({result:{error:se},info:"Invalid extension",context:{extension:p},stack:f});let v=t.participantId||(u==null?void 0:u.participantId);if(!v)return te({result:{error:hr},stack:f});let y=r===_u&&um({participantId:v,drawDefinition:s,entryStatus:r}),I=a===Lr&&um({participantId:v,drawDefinition:s,entryStage:a}),b=um({participantId:v,drawDefinition:s}),S=r!==_u&&a!==Lr&&b;if(S)return i?(ut({payload:{drawId:s.drawId,eventId:h==null?void 0:h.eventId,error:YI,participantId:v},topic:ZF}),{...Q}):te({result:{error:YI},context:{participantId:v},stack:f});if(y||I)return te({context:{invalidEntry:S,invalidLuckyLoser:y,invalidVoluntaryConsolation:I},result:{error:pP},stack:f});let w=He({entryStageSequence:n,participantId:v,entryPosition:l,entryStatus:r,entryStage:a,extensions:d});return p&&_t({element:w,extension:p}),c&&_t({extension:{name:"roundEntry",value:c},element:w}),s.entries||(s.entries=[]),s.entries.push(w),ui({drawDefinition:s}),{...Q}}function TTe(t){let e="addDrawEntries",{suppressDuplicateEntries:i=!0,entryStatus:r=ca,autoEntryPositions:n=!0,ignoreStageSpace:a,participantIds:o,drawDefinition:s,stageSequence:l,stage:u=Ae,roundTarget:c,extension:d,event:p}=t;if(!u)return{error:QK};if(!s)return{error:$e};if(!Array.isArray(o))return{error:ya};if(!fJ({stage:u,drawDefinition:s}))return{error:Dp};if(d&&!ul({extension:d}))return te({result:{error:se},info:"Invalid extension",context:{extension:d},stack:e});let m=gJ({drawDefinition:s,stageSequence:l,entryStatus:r,stage:u});if(!a&&!m.success)return{error:m.error};let h=m.positionsAvailable??0;if(!a&&u!==Lr&&h<o.length)return{error:aF};let f=[],g=s.drawId,v=p==null?void 0:p.eventId,y=o.reduce((I,b)=>{let S=r===_u&&um({participantId:b,drawDefinition:s,entryStatus:r}),w=u===Lr&&um({entryStage:u,drawDefinition:s,participantId:b}),U=um({participantId:b,drawDefinition:s});return r!==_u&&u!==Lr&&U&&(f.push(b),i&&ut({payload:{error:YI,participantId:b,eventId:v,drawId:g},topic:ZF})),S||w?I.concat(b):I},[]);return f.length&&!i?te({context:{eventId:v,drawId:g,duplicateEntries:f},result:{error:YI},stack:e}):(o.filter(I=>I&&!y.includes(I)).forEach(I=>{let b={entryStageSequence:l,entryStage:u,participantId:I,entryStatus:r};d&&_t({element:b,extension:d}),c&&_t({extension:{name:yl,value:c},element:b}),s.entries||(s.entries=[]),s.entries.push(b)}),n&&(s.entries=Us({entries:s.entries})),ui({drawDefinition:s}),y!=null&&y.length||f!=null&&f.length?{info:"some participantIds could not be added",participantIdsNotAdded:y,duplicateEntries:f,...Q}:{...Q})}function ML({suppressDuplicateEntries:t=!0,autoEntryPositions:e=!0,entryStageSequence:i,ignoreStageSpace:r,participantIds:n,drawDefinition:a,entryStatus:o,roundTarget:s,entryStage:l,extension:u,drawId:c,event:d}){if(!(n!=null&&n.length))return{error:Qc};if(!d)return{error:mo};if(!c)return{error:Fs};let p=(d.entries||[]).map(Tt);if(n.filter(f=>!p.includes(f)).length)return{error:XK};if(a){let f=TTe({stageSequence:i,suppressDuplicateEntries:t,autoEntryPositions:e,stage:l,ignoreStageSpace:r,participantIds:n,drawDefinition:a,entryStatus:o,roundTarget:s,extension:u});if(f.error)return f}let{flightProfile:m}=Hi({event:d}),h=m==null?void 0:m.flights.find(f=>f.drawId===c);return h!=null&&h.drawEntries&&(n.forEach(f=>{let g=o===_u&&WE({participantId:f,entryStatus:o,flight:h}),v=l===Lr&&WE({participantId:f,entryStage:l,flight:h});!(o!==_u&&l!==Lr&&WE({flight:h,participantId:f}))&&!g&&!v&&h.drawEntries.push({participantId:f,entryStatus:o,entryStage:l})}),e&&(h.drawEntries=Us({entries:h.drawEntries}))),{...Q}}function WE({participantId:t,entryStatus:e,entryStage:i,flight:r}){var n;let a=(n=r.drawEntries)==null?void 0:n.find(o=>o.participantId===t&&(!e||e===o.entryStatus)&&(!i||i===o.entryStage));return t&&a}function Cw({autoEntryPositions:t=!0,participantIds:e=[],entryStatuses:i,stage:r,event:n}){var a,o,s,l;let u="removeEventEntries";if(!(n!=null&&n.eventId))return{error:vi};if(!Array.isArray(e)||e.some(f=>!Di(f)))return te({result:{error:Ms},stack:u});let c=(n.drawDefinitions??[]).flatMap(f=>Op({drawDefinition:f}).assignedParticipantIds??[]),d=((i==null?void 0:i.length)&&((a=n.entries)==null?void 0:a.filter(f=>f.entryStatus&&i.includes(f.entryStatus)))||[]).map(Tt).filter(f=>!c.includes(f)),p=(r&&((o=n.entries)==null?void 0:o.filter(f=>f.entryStage&&f.entryStage===r))||[]).map(Tt).filter(f=>!c.includes(f));if(e.length?e=e.filter(f=>(!(i!=null&&i.length)||d.includes(f))&&(!r||p.includes(f))):d.length&&p.length?e=ji(d,p):d.length?e=d:p.length&&(e=p),(e==null?void 0:e.length)&&c.some(f=>e.includes(f)))return te({result:{error:uv},stack:u});if(!(e!=null&&e.length))return{...Q,participantIdsRemoved:[]};let m=[];n.entries=(n.entries??[]).filter(f=>{let g=!e.includes(f==null?void 0:f.participantId);return g||m.push(f.participantId),g}),t&&(n.entries=Us({entries:n.entries}));let{flightProfile:h}=Hi({event:n});return(s=h==null?void 0:h.flights)==null||s.forEach(f=>{f.drawEntries=(f.drawEntries||[]).filter(g=>!e.includes(g.participantId))}),(l=n.drawDefinitions)==null||l.forEach(f=>{f.entries=(f.entries??[]).filter(g=>!e.includes(g.participantId))}),{...Q,participantIdsRemoved:m}}var vJ={[_r]:{policyName:"matchUpActionsDefault",enabledStructures:[{stages:[],stageSequences:[],enabledActions:[],disabledActions:[]}],participants:{enforceCategory:!0,enforceGender:!0},processCodes:{substitution:["RANKING.IGNORE","RATING.IGNORE"]},substituteAfterCompleted:!1,substituteWithoutScore:!1}},Sv=vJ;function Xs(t){var e,i;let{suppressDuplicateEntries:r=!0,entryStatus:n=ca,autoEntryPositions:a=!0,enforceGender:o=!0,entryStageSequence:s,policyDefinitions:l,entryStage:u=Ae,tournamentRecord:c,ignoreStageSpace:d,drawDefinition:p,roundTarget:m,extensions:h,extension:f,drawId:g,event:v}=t,y="addEventEntries";if(!Array.isArray(t.participantIds))return te({result:{error:ya},stack:y});let I=dt(t.participantIds??[]);if(!v)return{error:vi};if(!(I!=null&&I.length))return te({result:{error:Qc},stack:y});if(!(v!=null&&v.eventId))return{error:mo};let b=Bt({tournamentRecord:c,event:v}).appliedPolicies??{},S=(l==null?void 0:l[_r])??(b==null?void 0:b[_r])??Sv[_r],w=(o??((e=S==null?void 0:S.participants)==null?void 0:e.enforceGender))!==!1,U=[],T=[];if(h&&(!Array.isArray(h)||!h.every(O=>ul({extension:O})))||f&&!ul({extension:f}))return te({context:He({extension:f,extensions:h}),result:{error:se},info:"Invalid extension(s)",stack:y});let D=!!c,P=[],E,R=((i=c==null?void 0:c.participants)==null?void 0:i.filter(O=>{var k,x,F;if(!I.includes(O.participantId))return!1;let $=Xi(ii)(v.eventType)&&O.participantType===Dt&&!gd(n),_=v.eventType===ei&&O.participantType===ft;return $&&(!v.gender||!w||[jn,As].includes(v.gender)||v.gender===((k=O.person)==null?void 0:k.sex))||_&&!gd(n)||v.eventType===ei&&O.participantType===Dt&&gd(n)?!0:$&&v.gender&&w&&![jn,As].includes(v.gender)&&v.gender!==((x=O.person)==null?void 0:x.sex)?(P.push({participantId:O.participantId,sex:(F=O.person)==null?void 0:F.sex}),!1):v.eventType===Xt&&(O.participantType===Xt||gd(n)&&O.participantType===Dt)}).map(O=>O.participantId))??[],N=I.filter(O=>!D||R.includes(O));v.entries||(v.entries=[]);let A=v.entries.map(O=>{var k;return O.participantId||((k=O.participant)==null?void 0:k.participantId)});if(N.forEach(O=>{var k;if(!A.includes(O)){let x=He({participantId:O,entryStatus:n,entryStage:u,extensions:h});f&&_t({element:x,extension:f}),m&&_t({extension:{name:yl,value:m},element:x}),s&&(x.entryStageSequence=s),U.push(x.participantId),(k=v.entries)==null||k.push(x)}}),g&&!gd(u)){let O=ML({participantIds:N,suppressDuplicateEntries:r,autoEntryPositions:a,entryStageSequence:s,ignoreStageSpace:d,drawDefinition:p,entryStatus:n,roundTarget:m,entryStage:u,extension:f,drawId:g,event:v});O.error&&(E=O.error)}if(v.eventType&&[Au,Ea].includes(v.eventType)){let O=(v.entries||[]).map($=>$.participantId),k=(v.entries||[]).filter($=>gd($.entryStatus)).map($=>$.participantId),x=((c==null?void 0:c.participants)??[]).filter($=>O.includes($.participantId)&&$.participantType&&[ft,Xt].includes($.participantType)).map($=>$.individualParticipantIds).flat(1/0),F=k.filter($=>x.includes($));F.length&&(T.push(...F),Cw({participantIds:F,autoEntryPositions:!1,event:v}))}if(N.length!==I.length)return te({context:{mismatchedGender:P,gender:v.gender},result:{error:ya},stack:y});a&&(v.entries=Us({entries:v.entries||[]}));let M=U.length,C=T.length;return te({result:{...Q,addedEntriesCount:M,removedEntriesCount:C},stack:y,info:E})}var IJ="ADMINISTRATION",DTe="CAPTAIN",PTe="COACH",en="COMPETITOR",yJ="MEDIA",bJ="MEDICAL",NL="OFFICIAL",wJ="OTHER",UJ="SECURITY",AL={ADMINISTRATION:IJ,CAPTAIN:DTe,COACH:PTe,COMPETITOR:en,MEDIA:yJ,MEDICAL:bJ,OFFICIAL:NL,OTHER:wJ,SECURITY:UJ};function OL({addIndividualParticipantsToEvents:t,individualParticipantIds:e,groupingParticipantId:i,tournamentRecord:r,suppressErrors:n}){let a="removeIndividualParticipantIds";if(!r)return te({result:{error:ve},stack:a});if(!i||!e)return te({result:{error:Je},stack:a});let o=(r.participants??[]).find(c=>c.participantId===i);if(!o)return te({result:{error:Wi},stack:a});if(![Xt,Ja].includes(o.participantType))return te({result:{participantType:o.participantType,error:Ns},stack:a});let s=SJ({individualParticipantIds:e,groupingParticipant:o,tournamentRecord:r,suppressErrors:n}),{removed:l,error:u}=s;if(u)return te({result:s,stack:a});if(t)for(let c of r.events??[]){let d=(c.entries??[]).map(({participantId:p})=>p).filter(Boolean);if(d.includes(i)){let p=l==null?void 0:l.filter(m=>!d.includes(m));Xs({participantIds:p,entryStatus:Po,tournamentRecord:r,event:c})}}return l&&ut({topic:on,payload:{tournamentId:r.tournamentId,participants:[o]}}),{...Q,...s}}function SJ({individualParticipantIds:t=[],groupingParticipant:e,tournamentRecord:i,suppressErrors:r,mappedMatchUps:n,participants:a}){var o,s;let l=[];if(!e)return{removed:l};let u=[],c=[];a||({participants:a,mappedMatchUps:n}=Oi({withMatchUps:!0,tournamentRecord:i,withEvents:!0}));let d=(s=(o=a==null?void 0:a.find(({participantId:h})=>h===e.participantId))==null?void 0:o.events)==null?void 0:s.map(({eventId:h})=>h),p=(e.individualParticipantIds??[]).filter(h=>{var f;let g=t==null?void 0:t.includes(h),v=g&&((f=a==null?void 0:a.find(I=>I.participantId===h))==null?void 0:f.matchUps.filter(({eventId:I})=>d.includes(I)).map(({matchUpId:I})=>n==null?void 0:n[I]).filter(({winningSide:I,score:b})=>I||br({score:b}))),y=g&&!(v!=null&&v.length);if(g&&!y&&c.push(h),y){l.push(h);for(let I of i.events??[])for(let b of I.drawDefinitions??[]){let{extension:S}=vt({element:b,name:Fu}),w=S==null?void 0:S.value[e.participantId];S&&w&&(S.value[e.participantId]=w.filter(T=>T.participantId!==h),_t({element:b,extension:S}),uw({drawDefinition:b}));let U=Pn({drawDefinition:b,inContext:!1}).matchUps??[];for(let T of U){let D=T.sides??[];for(let P of D){let E=P.lineUp??[];E.find(R=>R.participantId===h)&&(P.lineUp=E.filter(R=>R.participantId!==h),Et({tournamentId:i==null?void 0:i.tournamentId,drawDefinition:b,matchUp:T}))}}}}else u.push(h);return!y});e.individualParticipantIds=p;let m={groupingParticipantId:e.participantId,cannotRemove:c,notRemoved:u,removed:l};return c.length&&!r&&{...m,cannotRemove:c,error:cP}||m}function tR({participantRole:t=en,individualParticipantIds:e=[],groupingTypes:i=[Gn,Ja],tournamentRecord:r}){if(!r)return{error:ve};let n=r.participants??[],{participants:a,mappedMatchUps:o}=Oi({withMatchUps:!0,tournamentRecord:r,withEvents:!0}),s=0;return n.filter(l=>(l.participantRole===t||!l.participantRole)&&l.participantType&&i.includes(l.participantType)).forEach(l=>{let{removed:u}=SJ({groupingParticipant:l,individualParticipantIds:e,tournamentRecord:r,mappedMatchUps:o,participants:a});u&&s++}),s?Q:{error:f9}}function Lh(t){var e,i;let r=We(t,[{[Ur]:!0},{participantIds:!0,[Jn]:cn,[Wo]:Qc}]);if(r.error)return r;let{addIndividualParticipantsToEvents:n,tournamentRecord:a,participantIds:o}=t,s=((e=a.participants)==null?void 0:e.length)||0;if(!s)return{...Q};let l=(i=a.events||[])==null?void 0:i.filter(({eventType:g})=>g===ur).map(g=>{var v;return(v=g==null?void 0:g.drawDefinitions)==null?void 0:v.map(({drawId:y})=>y)}).flat(1/0),u=Oi({participantFilters:{participantIds:o},tournamentRecord:a,withDraws:!0}).participants??[],c=g=>{let v=(Hr({matchUpFilters:{drawIds:g,matchUpTypes:[ei]},tournamentRecord:a}).matchUps??[]).flatMap(({sides:y})=>y==null?void 0:y.map(({participantId:I})=>I||[])).filter(Boolean);return ji(v,o)},d=l!=null&&l.length?c(l):[],p=u.filter(g=>{var v;return(v=g.draws)==null?void 0:v.filter(y=>(!(l!=null&&l.length)||!(l!=null&&l.includes(y.drawId)))&&y.positionAssignments).length});if(d!=null&&d.length||p.length)return{error:uv};let m={},h={};for(let g of a.events||[]){let v=Cw({participantIds:o,event:g});if(v.error)return v;m[g.eventId]=v.participantIdsRemoved}a.participants=(a.participants??[]).filter(g=>{var v,y;let I=o.includes(g.participantId)||g.participantType===ft&&((v=g.individualParticipantIds)==null?void 0:v.some(b=>o.includes(b)));if(!I&&g.participantType===ur&&(y=g.individualParticipantIds)!=null&&y.some(b=>o.includes(b))&&(g.individualParticipantIds=g.individualParticipantIds.filter(b=>!o.includes(b))),I&&n&&g.participantType&&[ft,Xt].includes(g.participantType))for(let b of g.individualParticipantIds||[])o.includes(b)||(h[g.participantId]||(h[g.participantId]=[]),h[g.participantId].push(b));return!I});let f=s-a.participants.length;if(tR({individualParticipantIds:o,tournamentRecord:a}),n)for(let g of a.events||[]){let v=m[g.eventId].map(y=>h[y]||[]).flat();Xs({participantIds:v,entryStatus:Po,tournamentRecord:a,event:g})}return f&&ut({payload:{participantIds:o,tournamentId:a.tournamentId},topic:eL}),f?{...Q,participantsRemovedCount:f}:{error:cP}}function TJ({selected:t=!0,drawDefinition:e,entryStatuses:i,drawId:r,event:n,stage:a}){var o;let s=n.entries??[];if(r){let{flightProfile:u}=Hi({event:n}),c=(o=u==null?void 0:u.flights)==null?void 0:o.find(d=>d.drawId===r);c?s=c.drawEntries:e.entries&&(s=e==null?void 0:e.entries)}let l=s.filter(u=>(!(i!=null&&i.length)||!u.entryStatus||i.includes(u.entryStatus))&&(!a||!u.entryStage||u.entryStage===a)&&(!t||u.entryStatus&&ds.includes(u.entryStatus)));return{entries:s,stageEntries:l}}function DJ({removeGroupParticipant:t,tournamentRecord:e,drawDefinition:i,participantId:r,drawId:n,stage:a,event:o}){var s;let l="destroyGroupEntry";if(!e)return{error:ve};if(!r)return te({result:{error:hr},stack:l});if(!o)return{error:vi};if(!o.eventType||![Au,Ea].includes(o.eventType))return te({result:{error:Wl},stack:l});let u=e.participants??[],c=u.find(y=>y.participantId===r);if(!c)return te({result:{error:Wi},stack:l});if(!c.participantType||![ft,Gn].includes(c.participantType)||c.participantType===Gn&&o.eventType!==Ea||c.participantType===ft&&o.eventType!==Au)return{error:Ns};let d=(o.entries??[]).find(y=>y.participantId===r);if(!d)return{error:y9};let{stageEntries:p}=TJ({selected:!1,drawDefinition:i,drawId:n,event:o,stage:a}),m=p.map(Tt),h=u.filter(({participantId:y})=>m.includes(y)).map(({individualParticipantIds:y})=>y).flat().filter(Boolean),f=(s=c.individualParticipantIds)==null?void 0:s.filter(y=>Ys(y,h).length===1),g=Cw({participantIds:[r],event:o});if(g.error||f!=null&&f.length&&(g=Xs({participantIds:f,entryStatus:Po,entryStage:d.entryStage,tournamentRecord:e,drawDefinition:i,drawId:n,event:o}),g.error))return g;let v;return t&&Lh({participantIds:[r],tournamentRecord:e}).success&&(v=!0),{...Q,participantRemoved:v}}function kL({removeGroupParticipant:t,tournamentRecord:e,drawDefinition:i,participantId:r,drawId:n,event:a}){return DJ({removeGroupParticipant:t,tournamentRecord:e,drawDefinition:i,participantId:r,drawId:n,event:a})}function PJ(t){if(!t.tournamentRecord)return{error:ve};let{participantIds:e,...i}=t,r=0,n=[];for(let a of e){let o=DJ({participantId:a,...i});o.success&&(r+=1),o.error&&n.push(o.error)}return r?{destroyedCount:r,...Q}:{error:n}}function my(t){let{tournamentRecord:e,replaceWithBye:i,drawDefinition:r,destroyPair:n,entryStatus:a,matchUpsMap:o,drawId:s}=t,l="removeDrawPositionAssignment",u=Pw(t);if(u.error)return te({result:u,stack:l});let{participantId:c}=u,{drawPosition:d,event:p,structureId:m}=t,h=Bt({tournamentRecord:e,drawDefinition:r,event:p}).appliedPolicies??{};if([qo,Jl].includes(a)&&c){let{tournamentRecord:g}=t,{participant:v}=nd({tournamentRecord:g,participantId:c}),{participantType:y,individualParticipantIds:I}=v??{};if(n&&y===ft){let b=kL({tournamentRecord:g,drawDefinition:r,participantId:c,event:p});if(b.error)return te({result:b,stack:l});I&&p0({participantIds:I,tournamentRecord:g,drawDefinition:r,entryStatus:a,drawId:s,event:p})}else p0({participantIds:[c],tournamentRecord:g,drawDefinition:r,entryStatus:a,drawId:s,event:p})}if(i){let g=Za({tournamentRecord:e,drawDefinition:r,drawPosition:d,structureId:m,matchUpsMap:o,event:p});if(g.error)return te({result:g,stack:l})}let{structure:f}=tt({drawDefinition:r,structureId:m});return dL({structure:f,drawPositions:[d]}),GP({appliedPolicies:h,drawDefinition:r,positionAction:{name:"removeDrawPositionAssignment",replaceWithBye:i,drawPosition:d,entryStatus:a,structureId:m}}),u}function RJ(t){return Object.assign(t,{entryStatus:Jl}),my(t)}function CM(t){return Di(t)?t.split(" ").map(e=>e.split("").map((i,r)=>r?i.toLowerCase():i.toUpperCase()).join("")).join(" "):t}function tn(t){return Di(t)?CM(t.replace(/_/g," ")):""}var bc=({finishingPosition:t=Th,qualifyingRoundNumber:e,structureAbbreviation:i,seedAssignments:r=[],stageSequence:n=1,structureOrder:a,seedingProfile:o,matchUpFormat:s,structureType:l,structureName:u,matchUpType:c,matchUps:d=[],structureId:p,roundOffset:m,roundLimit:h,stageOrder:f,structures:g,stage:v})=>{let y={structureId:p??Ht(),structureAbbreviation:i,finishingPosition:t,seedAssignments:r,matchUpFormat:s,stageSequence:n,structureName:u};a&&(y.structureOrder=a),l&&(y.structureType=l),o&&(typeof o=="string"?y.seedingProfile=o:typeof o=="object"&&typeof o.positioning=="string"&&(y.seedingProfile=o.positioning)),c&&(y.matchUpType=c),m&&(y.roundOffset=m),f&&(y.stageOrder=f),h&&(y.roundLimit=h),v&&(y.stage=v),e&&(y.qualifyingRoundNumber=e);let I=d.flatMap(({drawPositions:b})=>b).filter(Boolean);return g?y.structures=g:(y.matchUps=d,y.positionAssignments=dt(I).sort((b,S)=>b-S).map(b=>({drawPosition:b}))),y},so=bc;function xL({structureName:t=tn(Lr),structureAbbreviation:e,drawDefinition:i,matchUpType:r,structureId:n}){if(!i)return{error:$e};let a=so({stage:Lr,structureAbbreviation:e,structureName:t,matchUps:[],structureId:n,matchUpType:r});return i.structures||(i.structures=[]),i.structures.push(a),ui({drawDefinition:i,structureIds:[a.structureId]}),{...Q}}function FL({drawPositions:t}){if(!(t!=null&&t.length))return{error:qb};let e=n=>t.filter(a=>a!==n).map(a=>[n,a]),i=[].concat(...(t??[]).map(e)),r=dt(i.map(iR)).map(n=>n.split("|").map(a=>+a));return{groupMatchUps:i,uniqueMatchUpGroupings:r}}function iR(t=[]){return!Array.isArray(t)||!t.length?"":[...t].sort(lr).join("|")}function EJ({groupSize:t,drawPositionOffset:e}){if(!t)return[];let i=d=>[...Array(d)].map((p,m)=>m),r=i(2*Math.round(t/2)+1).slice(1),n=i(r.length-1).map(()=>[]),a=r.slice(0,r.length/2),o=r.slice(r.length/2);r.slice(1).forEach((d,p)=>{a.forEach((g,v)=>{n[p].push([a[v],o[v]])});let m=a.shift(),h=a.pop(),f=o.shift();a=[m,f,...a].filter(Boolean),o=[...o,h].filter(Boolean)});let s=a.shift(),l=a.pop(),u=o.shift();a=[s,u,...a].filter(Boolean),o=[...o,l].filter(Boolean);let c=d=>d[0].reduce((p,m)=>p+m);return[...n].reverse().sort((d,p)=>c(d)-c(p)).map(d=>d.filter(p=>p.every(m=>m<=t)).map(p=>{let m=p.map(h=>h+e);return iR(m)}))}function RTe({rounds:t,hash:e}){return t!=null&&t.length?t==null?void 0:t.reduce((i,r,n)=>r.includes(e)?n+1:i,void 0):{error:Je}}var ETe={getRoundRobinGroupMatchUps:FL,determineRoundNumber:RTe,drawPositionsHash:iR,groupRounds:EJ};function Mw(t){var e;let{groupNameBase:i="Group",playoffAttributes:r,stageSequence:n=1,structureOptions:a,appliedPolicies:o,seedingProfile:s,stage:l=Ae,matchUpType:u,roundTarget:c,structureId:d,groupNames:p,drawSize:m,idPrefix:h,isMock:f,uuids:g}=t,v=t.structureName??((e=r==null?void 0:r[0])==null?void 0:e.name)??tn(Ae),{groupCount:y,groupSize:I}=CTe({structureOptions:a,appliedPolicies:o,drawSize:m}),b=Xd,S,w=Te(1,y+1).map(T=>{let D=MTe({groupSize:I,structureOrder:T,matchUpType:u,drawSize:m,idPrefix:h,isMock:f});S=Array.isArray(D)?Math.max(...D.map(({roundNumber:E})=>E??0)):0;let P=(p==null?void 0:p[T-1])??`${i} ${T}`;return bc({structureId:g==null?void 0:g.pop(),structureType:PP,finishingPosition:b,structureOrder:T,structureName:P,matchUps:D})}),U=bc({structureId:d??(g==null?void 0:g.pop()),structureType:_n,finishingPosition:b,seedingProfile:s,structureName:v,stageSequence:n,structures:w,stage:l});return c&&_t({extension:{name:yl,value:c},element:U}),{structures:[U],maxRoundNumber:S,groupCount:y,links:[],groupSize:I,...Q}}function CTe({appliedPolicies:t,structureOptions:e,drawSize:i}){let r=e==null?void 0:e.groupSize,n=(e==null?void 0:e.groupSizeLimit)||8,{validGroupSizes:a}=Nw({groupSizeLimit:n,drawSize:i}),o=a&&Math.max(...a);r&&a!=null&&a.includes(r)||(r&&r>4||!(a!=null&&a.includes(4))?r=o:r=4);let s=Math.ceil(i/r);return{groupSize:r,groupCount:s}}function Nw(t){let{groupSizeLimit:e=10,drawSize:i=0}=t??{},r=Te(3,e+1).filter(n=>{let a=Math.ceil(i/n),o=a*n-i,s=Math.ceil(i/a),l=Math.ceil(o/a);return(!o||o<n)&&s===n&&s>=3&&l<2});return{...Q,validGroupSizes:r}}function MTe({structureOrder:t,matchUpType:e,groupSize:i,drawSize:r,idPrefix:n,isMock:a,uuids:o}){let s=(t-1)*i,l=Te(1+s,i+1+s),u=FL({drawPositions:l}).uniqueMatchUpGroupings??[],c=EJ({groupSize:i,drawPositionOffset:s});return u.map(p).sort((m,h)=>(m.roundNumber??1/0)-(h.roundNumber??1/0));function d(m){return c.reduce((h,f,g)=>f.includes(m)?g+1:h,void 0)}function p(m){let h=iR(m),f=d(h),g=[1,r],v=NTe({structureOrder:t,drawPositions:m,roundNumber:f,idPrefix:n,uuids:o}),y={matchUpStatus:f?Qi:jt,matchUpType:e,finishingPositionRange:{winner:g,loser:g},drawPositions:m,roundNumber:f,matchUpId:v};return a&&(y.isMock=!0),y}}function NTe({structureOrder:t,drawPositions:e,roundNumber:i,idPrefix:r,uuids:n}){return r?`${r}-${t}-${i}-DP-${e.join("-")}`:(n==null?void 0:n.pop())||Ht()}function LL(t){let{roundRobinGroupsCount:e,participantsCount:i,cluster:r}=t;if(!st(i))return{seedBlocks:void 0,...te({result:{error:se},context:{participantsCount:i},stack:"getSeedBlocks"})};let n=nv(i);if(e){let m=Math.min(e,n),h=[],f=1;for(Te(0,m).forEach(()=>{h.push([f]),f++});f<n;){let g=Te(f,f+m);f+=m,h.push(g)}return{...Q,seedBlocks:h}}let a=Te(1,n+1),o=[],s=n/2;for(;s>1;){let m=Cr(a,s),h=m.length;m.forEach((f,g)=>{let v,y=g<h/2,I=g%2===0,b=f[0],S=f[f.length-1];r&&h>4?h===8?v=y?S:b:v=I?b:S:v=y?b:S,Nn(f,o)||o.push(v)}),s=s/2}let l=a.filter(m=>!o.includes(m));for(;l.length;)l.length%2===0?o.push(l.pop()):o.push(l.shift());let u=Te(0,20).map(m=>Math.pow(2,m));u.unshift(1);let c=u.indexOf(n),d=0,p=[];return Te(0,c).forEach(m=>{p.push(o.slice(d,d+u[m])),d+=u[m]}),{...Q,seedBlocks:p}}function _L({roundRobinGroupsCount:t,drawSize:e}){let i="getSeedGroups";if(!st(e))return{seedGroups:void 0,...te({result:{error:se},context:{drawSize:e},stack:i})};if(t){if(!st(t))return{seedGroups:void 0,...te({context:{roundRobinGroupsCount:t},result:{error:se},stack:i})};let r=1,n=Math.floor(e/t);return{seedGroups:Te(0,n).map(()=>{let a=Te(r,r+t);return r+=t,a})}}else{let{seedBlocks:r}=LL({participantsCount:e,roundRobinGroupsCount:t}),n=0;return{seedGroups:(r||[]).map(a=>(a||[]).map(()=>(n+=1,n)))}}}function $L({roundRobinGroupsCount:t,participantsCount:e}){var i;if(t){let{validGroupSizes:a}=Nw({drawSize:e});if(!((i=a==null?void 0:a.map(o=>Math.ceil(e/o)))!=null&&i.includes(t)))return te({context:{roundRobinGroupsCount:t},result:{error:se}})}let{seedGroups:r}=_L({drawSize:e,roundRobinGroupsCount:t}),n=(r==null?void 0:r.map(a=>Math.min(...a)))||[];return{...Q,seedingThresholds:n}}function pg(t){if(!t)return 1/0;if(st(t))return Ze(t);let e=t.split("-")[0];return st(e)?Ze(e):1/0}function ATe({size:t}){let e=[t],i=t;for(;i/2===Math.floor(i/2);)i=i/2,e.push(i);return e.includes(1)||e.push(1),e.sort(lr),e.reverse(),e}function OTe({blockPattern:t,index:e}){let i=0;for(let r of t){if(i===e)return r;let n=0;for(;n<r.length;){if(i===e)return r;i+=1,n++}}}function kTe({positioning:t,size:e}){let i=ATe({size:e}),r=[],n=[],a=p=>p[0],o=p=>p[p.length-1],s=(p,m)=>(t&&[DP,Yd].includes(t)&&m%2?o(p):a(p))||a(p),l=(p,m)=>{if(p.every(h=>!n.includes(h))){let h=s(p,m);return n.push(h),h}},u=p=>{let m=p.filter(h=>!n.includes(h));if(m.length)return n.push(...m),m},c=(p,m)=>{let h=s(p,m);if(!n.includes(h))return n.push(h),h},d=Te(1,e+1);for(let p of i)if(p===1){let m=Cr(d,2),h=m.map(l).filter(Boolean);h.length&&r.push(h);let f=m.flatMap(u).filter(Boolean);f.length&&r.push(f)}else{let m=Cr(d,p).map(c).filter(Boolean);m.length&&r.push(m)}return{divisions:i,divisionGroupings:r}}function _h({provisionalPositioning:t,returnAllProxies:e,appliedPolicies:i,seedingProfile:r,drawDefinition:n,allPositions:a,structure:o}){var s;let l=[];if(!o)return{error:Tp};let{matchUps:u,roundMatchUps:c}=qt({matchUpFilters:{roundNumbers:[1]},provisionalPositioning:t,structure:o}),{seedAssignments:d}=go({provisionalPositioning:t,returnAllProxies:e,drawDefinition:n,structure:o}),{positionAssignments:p}=Mr({structure:o}),m=p==null?void 0:p.length,h=(d==null?void 0:d.length)??0,f=[],g=Object.keys(c).map(O=>parseInt(O)).sort((O,k)=>O-k).map(O=>{let k=c[O].map(F=>F.drawPositions).flat(1/0).filter(Boolean),x=k.filter(F=>!f.includes(F));return f=f.concat(...k),x}).filter(O=>O.length).reverse(),v=g.pop()??[],y=v&&Math.min(...v)-1||0;r=r??((s=i==null?void 0:i.seeding)==null?void 0:s.seedingProfile);let I=(v==null?void 0:v.length)||0,b=g.filter(O=>O.filter(k=>k<=h).length),{stage:S,structureType:w,roundLimit:U}=o,T=w===_n,D=!T&&(g==null?void 0:g.length),P=!T&&S===Ke&&U,E=b.flat(1/0),R=D?E==null?void 0:E.length:0,N=a?m:h,A=yL({drawDefinition:n,structure:o,matchUps:u}),M=A?0:!D&&N||N&&E.length<N&&N-E.length||0;if(P){let O=o!=null&&o.matchUps?o.matchUps.filter(({roundNumber:x})=>x===o.roundLimit).length:0,k=v.length/O;if(!D){let x=Aw(r),F=Cr(v,k),$=1,_=Te(0,F[0].length).map(()=>{let L=Te($,$+F.length);return $+=F.length,L});({validSeedBlocks:l}=CJ({drawPositionBlocks:F,nonRandom:r==null?void 0:r.nonRandom,positioning:x,seedGroups:_}))}}else T?{validSeedBlocks:l}=xTe({nonRandom:r==null?void 0:r.nonRandom,seedingProfile:r,structure:o}):D?l=b.map(O=>({seedNumbers:O,drawPositions:O})):A&&Cr(v,2).map((O,k)=>({drawPositions:[O[0]],seedNumbers:[k+1]})).forEach(O=>l.push(O));if(!T&&!A&&!P){let{blocks:O}=FTe({drawPositionOffset:y,seedNumberOffset:R,seedCountGoal:M,seedingProfile:r,baseDrawSize:I});O.forEach(k=>l.push(k))}let C=l.flatMap(O=>O.drawPositions).reduce((O,k)=>(v==null?void 0:v.includes(k))&&O,!0);return!A&&!D&&!T&&!C?{error:WK,validSeedBlocks:[],isContainer:T,isFeedIn:D}:{isLuckyStructure:A,validSeedBlocks:l,isContainer:T,isFeedIn:D}}function xTe({seedingProfile:t,structure:e,nonRandom:i}){var r;let n=e.structures||[],a=n.length,o=(r=si({structure:e}))==null?void 0:r.positionAssignments,s=Aw(t),l=(o==null?void 0:o.length)??0,{seedGroups:u}=_L({roundRobinGroupsCount:a,drawSize:l}),c=n.map(d=>{var p;return(p=si({structure:d}).positionAssignments)==null?void 0:p.map(m=>m.drawPosition)});return CJ({drawPositionBlocks:c,positioning:s,seedGroups:u,nonRandom:i})}function CJ({drawPositionBlocks:t,positioning:e,seedGroups:i,nonRandom:r}){let n=[],{divisionGroupings:a}=kTe({size:i.length,positioning:e}),o=[];return i.forEach((s,l)=>{let u=OTe({blockPattern:a,index:l});s.forEach((c,d)=>{let p=l%2?t.length-d-1:d,m=t[p].slice().filter((f,g)=>u.includes(g+1)&&f);e!==Yd?m=r?m:Tn(m):l%2&&m.reverse();let h=m.find(f=>!o.includes(f));h&&(o.push(h),n.push({drawPositions:[h],seedNumbers:[c]}))})}),{validSeedBlocks:n}}function FTe(t){let{drawPositionOffset:e=0,roundRobinGroupsCount:i,seedNumberOffset:r=0,seedingProfile:n,seedCountGoal:a,baseDrawSize:o}=t,s=1,l=[],{seedBlocks:u}=LL({cluster:Aw(n)===DP,participantsCount:o,roundRobinGroupsCount:i});s=0;for(let d of u){if(s+1>a)break;let p=d.map(h=>h+e),m=c(s+1,d.length).map(h=>+h+r);s+=d.length,l.push({drawPositions:p,seedNumbers:m})}return{blocks:l};function c(d,p){return Array.from(new Array(p),(m,h)=>h+d)}}function h0({appliedPolicies:t,drawDefinition:e,seedBlockInfo:i,drawPosition:r,structureId:n,seedNumber:a}){var o,s,l,u,c,d;let{structure:p}=tt({drawDefinition:e,structureId:n});t||(t=Bt({drawDefinition:e}).appliedPolicies);let m=i==null?void 0:i.validSeedBlocks;return!m&&p&&(m=(o=_h({appliedPolicies:t,drawDefinition:e,structure:p}))==null?void 0:o.validSeedBlocks),(l=(s=t==null?void 0:t.seeding)==null?void 0:s.validSeedPositions)!=null&&l.ignore?!0:(c=(u=t==null?void 0:t.seeding)==null?void 0:u.validSeedPositions)!=null&&c.strict?(((d=m.find(h=>h.seedNumbers.includes(a)))==null?void 0:d.drawPositions)||[]).includes(r):[].concat(...m.map(h=>h.drawPositions)).includes(r)}function MJ(t){var e,i,r;let{provisionalPositioning:n,drawDefinition:a,seedingProfile:o,seedBlockInfo:s,structureId:l,randomize:u}=t,{structure:c}=tt({drawDefinition:a,structureId:l}),{seedAssignments:d}=go({returnAllProxies:t.returnAllProxies,provisionalPositioning:n,drawDefinition:a,structure:c}),{positionAssignments:p}=Mr({structure:c}),m=(e=p==null?void 0:p.filter(M=>M.participantId??M.bye??M.qualifier))==null?void 0:e.map(M=>M.drawPosition).filter(Boolean),{appliedPolicies:h}=Bt({drawDefinition:a}),f=((s==null?void 0:s.validSeedBlocks)||c&&((i=_h({returnAllProxies:t.returnAllProxies,provisionalPositioning:n,appliedPolicies:h,drawDefinition:a,seedingProfile:o,structure:c}))==null?void 0:i.validSeedBlocks)||[]).filter(M=>M.drawPositions.filter(C=>!(m!=null&&m.includes(C))).length)[0],g=d==null?void 0:d.map(M=>M.participantId).filter(Boolean),v=p==null?void 0:p.map(M=>M.participantId).filter(Boolean),y=g==null?void 0:g.filter(M=>v==null?void 0:v.includes(M)),I=g==null?void 0:g.filter(M=>!(v!=null&&v.includes(M))),b=d==null?void 0:d.filter(M=>I==null?void 0:I.includes(M.participantId)),S=d==null?void 0:d.filter(M=>!M.participantId),w=(b!=null&&b.length&&b.length>0?b.length:(S==null?void 0:S.length)??0)&&(f==null?void 0:f.drawPositions.filter(M=>!(m!=null&&m.includes(M))))||[],U=u?Tn(w):w,T=[],D=U.map(()=>{var M;let C=(M=A(b,T))==null?void 0:M.participantId;return C&&T.push(C),C}).filter(Boolean),P=d==null?void 0:d.filter(M=>y==null?void 0:y.includes(M.participantId)).map(M=>M.seedNumber),E=((f==null?void 0:f.seedNumbers)||[]).filter(M=>!(P!=null&&P.includes(M))),R=d==null?void 0:d.filter(M=>E.includes(M.seedNumber)).map(M=>M.participantId),N=(r=h==null?void 0:h.seeding)==null?void 0:r.duplicateSeedNumbers;return{nextSeedBlock:f,unplacedSeedParticipantIds:N===void 0||N?D:R,unplacedSeedNumbers:E,unfilledPositions:U,unplacedSeedAssignments:b};function A(M,C){let O=M.filter(F=>!C.includes(F.participantId)),k=Math.min(...O.map(F=>pg(F.seedValue))),x=O.filter(F=>pg(F.seedValue)===k);return Tn(x).pop()}}function Aw(t){if(typeof t=="string")return t;if(typeof t=="object")return t.positioning}function Tv({provisionalPositioning:t,tournamentRecord:e,drawDefinition:i,seedingProfile:r,participantId:n,seedBlockInfo:a,structureId:o,seedNumber:s,seedValue:l,eventId:u,event:c}){var d,p,m;let h="assignSeed",{structure:f}=tt({drawDefinition:i,structureId:o}),{positionAssignments:g}=Mr({structure:f}),v=go({provisionalPositioning:t,drawDefinition:i,structure:f}).seedAssignments,y=v.map(T=>T.seedNumber),I=um({drawDefinition:i,participantId:n});if(n&&!I)return te({result:{error:Ms},context:{participantId:n},stack:h});let b=c?(p=(d=Hi({event:c}).flightProfile)==null?void 0:d.flights)==null?void 0:p.length:0,S=b&&b>1,w=(m=g==null?void 0:g.find(T=>T.participantId===n))==null?void 0:m.drawPosition;if(w&&!h0({drawPosition:w,drawDefinition:i,seedBlockInfo:a,structureId:o,seedNumber:s}))return te({result:{error:zx},context:{assignedDrawPosition:w},info:"invalid seed position",stack:h});y.includes(s)||v.push({seedNumber:s,seedValue:l});let U;return v.forEach(T=>{T.participantId===n&&T.seedNumber!==s&&(T.participantId=void 0),T.seedNumber===s&&(T.participantId=n,!(r!=null&&r.groupSeedingThreshold)&&!S&&(T.seedValue=l??s),U=!0)}),U?(AX({tournamentId:e==null?void 0:e.tournamentId,drawDefinition:i,structure:f,eventId:u}),{...Q}):te({result:{error:zK},stack:h})}function BL({inContextTargetMatchUp:t,drawPositionSideIndex:e,teamParticipantId:i,tournamentRecord:r,drawDefinition:n,matchUp:a,event:o}){var s,l,u,c;let d=(l=(s=t==null?void 0:t.sides)==null?void 0:s[e])==null?void 0:l.sideNumber,p=d&&((u=a.sides)==null?void 0:u.find(g=>g.sideNumber===d)),{extension:m}=vt({element:n,name:Fu}),h=(m==null?void 0:m.value)||{},f=Ne(h[i],!1,!0);if(p)(c=a==null?void 0:a.sides)==null||c.forEach(g=>{g.sideNumber===d&&(g.lineUp=f)});else{a.sides=[1,2].map(v=>{var y;return{...((y=a.sides)==null?void 0:y.find(I=>I.sideNumber===v))??{},sideNumber:v}});let g=a.sides.find(v=>v.sideNumber===d);g&&(g.lineUp=f)}Et({tournamentId:r==null?void 0:r.tournamentId,context:"updateSidLineUp",eventId:o==null?void 0:o.eventId,drawDefinition:n,matchUp:a})}function NJ(t){let{sourceMatchUp:e}=t,{targetMatchUp:i,structure:r,matchUpsMap:n,drawPosition:a}=t,o=i.roundNumber>1&&i.roundNumber-1,s=Zd({structureId:r.structureId,matchUpsMap:n});!e&&a&&(e=s.find(({drawPositions:h,roundNumber:f})=>f===o&&(h==null?void 0:h.includes(a))));let l=e==null?void 0:e.roundPosition,u=l%2?1:-1,c=l+u,d=o&&s.find(({roundNumber:h,roundPosition:f})=>h===o&&f===c),p=d==null?void 0:d.matchUpStatus,m=[tr,dr].includes(p);return{pairedPreviousMatchUp:d,pairedPreviousMatchUpIsDoubleExit:m}}function LTe({drawPosition:t,drawPositions:e}){let i=!1,r=!!(e!=null&&e.includes(t));return{updatedDrawPositions:r?e||[]:[...e,void 0,void 0].slice(0,2).map(n=>!n&&!r?(r=!0,i=!0,t):n).sort(lr).filter(Boolean),positionAdded:i,positionAssigned:r}}function AJ({structureId:t,matchUpsMap:e,matchUp:i}){let r=i==null?void 0:i.roundPosition,n=r%2?1:-1,a=r+n;return{pairedPreviousMatchUp:Zd({matchUpsMap:e,structureId:t}).find(({roundNumber:o,roundPosition:s})=>o===(i==null?void 0:i.roundNumber)&&s===a)}}function OJ({inContextDrawMatchUps:t,sourceMatchUpStatus:e,sourceMatchUpId:i,matchUpsMap:r,matchUp:n}){let a=t.find(s=>s.matchUpId===i),{pairedPreviousMatchUp:o}=AJ({structureId:a==null?void 0:a.structureId,matchUp:a,matchUpsMap:r});if(a&&o){let s=o==null?void 0:o.matchUpId,l=t.find(c=>c.matchUpId===s),u=(a==null?void 0:a.structureId)===(l==null?void 0:l.structureId)?(a==null?void 0:a.roundPosition)<(l==null?void 0:l.roundPosition)&&1||2:a.structureId===(l==null?void 0:l.structureId)&&2||1;n.matchUpStatusCodes=(n.matchUpStatusCodes??[]).map(c=>{let d=Di(c)||!isNaN(c)?{code:c}:c;return d.sideNumber===u?{...d,previousMatchUpStatus:e}:d})}}function iS({inContextDrawMatchUps:t,drawPosition:e,matchUpId:i}){let r=t.filter(({winnerMatchUpId:n,loserMatchUpId:a})=>a===i||n===i).sort((n,a)=>n.roundPosition-a.roundPosition);return t.find(n=>n.matchUpId===i).feedRound?1:r.reduce((n,a,o)=>{var s;return(s=a.drawPositions)!=null&&s.includes(e)?o+1:n},void 0)}function mg({inContextDrawMatchUps:t,sourceMatchUpStatus:e,tournamentRecord:i,sourceMatchUpId:r,drawDefinition:n,matchUpStatus:a,drawPosition:o,matchUpsMap:s,matchUpId:l,event:u}){var c,d,p,m;let h="assignMatchUpDrawPosition";s||(s=ln({drawDefinition:n})),t||(t=fr({inContext:!0,drawDefinition:n,matchUpsMap:s}).matchUps??[]);let f=t.find(C=>C.matchUpId===l),g=f==null?void 0:f.structureId,v=(c=n==null?void 0:n.structures)==null?void 0:c.find(C=>C.structureId===g);if(!v)return{error:Ai};let y=(d=s==null?void 0:s.drawMatchUps)==null?void 0:d.find(C=>C.matchUpId===l),I=(y==null?void 0:y.drawPositions)??[],{positionAdded:b,positionAssigned:S,updatedDrawPositions:w}=LTe({drawPositions:I,drawPosition:o}),{positionAssignments:U}=si({drawDefinition:n,structure:v}),T=(p=U==null?void 0:U.filter(C=>w.includes(C.drawPosition)))==null?void 0:p.find(({bye:C})=>C),D=(y==null?void 0:y.matchUpStatus)&&[Ft,Pt].includes(y.matchUpStatus)&&w.filter(Boolean).length<2;if(a=T&&jt||a||D&&y.matchUpStatus||(y==null?void 0:y.matchUpStatus)&&[tr,dr].includes(y.matchUpStatus)&&y.matchUpStatus||Qi,y&&b){t=fr({inContext:!0,drawDefinition:n,matchUpsMap:s}).matchUps??[];let C=D&&iS({inContextDrawMatchUps:t,drawPosition:o,matchUpId:l})||void 0;y!=null&&y.matchUpStatusCodes&&OJ({inContextDrawMatchUps:t,sourceMatchUpStatus:e,sourceMatchUpId:r,matchUpsMap:s,matchUp:y}),Object.assign(y,{drawPositions:w,winningSide:C,matchUpStatus:a}),Et({tournamentId:i==null?void 0:i.tournamentId,eventId:f==null?void 0:f.eventId,context:h,drawDefinition:n,matchUp:y})}let P=On({inContextDrawMatchUps:t,inContextMatchUp:f,drawDefinition:n,matchUpId:l}),{targetMatchUps:{winnerMatchUp:E,loserMatchUp:R,loserTargetDrawPosition:N},targetLinks:{loserTargetLink:A}}=P,M=Zd({structureId:v.structureId,matchUpsMap:s});if(S&&T){if(E)if([jt,tr,dr].includes(a)){let C=mg({matchUpId:E.matchUpId,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:n,drawPosition:o,matchUpsMap:s});if(C.error)return C}else{let{structureId:C}=E;C!==v.structureId&&console.log("winnerMatchUp in different structure... participant is in different targetDrawPosition")}}else if(E&&f&&!f.feedRound){let{pairedPreviousMatchUpIsDoubleExit:C}=NJ({targetMatchUp:y,drawPosition:o,matchUpsMap:s,structure:v});if(C){let O=mg({matchUpId:E.matchUpId,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:n,drawPosition:o,matchUpsMap:s});if(O.error)return O}}if((y==null?void 0:y.matchUpType)===fi){let C=t==null?void 0:t.find(({matchUpId:x})=>x===y.matchUpId),O=((C==null?void 0:C.sides)??[]).reduce((x,F,$)=>F.drawPosition===o?$:x,void 0),k=(m=U==null?void 0:U.find(x=>x.drawPosition===o))==null?void 0:m.participantId;k&&O!==void 0&&BL({inContextTargetMatchUp:C,drawPositionSideIndex:O,teamParticipantId:k,tournamentRecord:i,drawDefinition:n,matchUp:y})}if((A==null?void 0:A.linkCondition)===ll&&w.filter(Boolean).length===2&&!T&&M.filter(({drawPositions:C,roundNumber:O})=>O===1&&Nn(C,w)).every(({matchUpStatus:C})=>[Ki,zr].includes(C))&&R){let{structureId:C}=R,O=Za({drawPosition:N,tournamentRecord:i,drawDefinition:n,structureId:C,matchUpsMap:s,event:u});if(O.error)return O}return S?{...Q}:te({result:{error:Xf},context:{drawPosition:o},stack:h})}function kJ({inContextDrawMatchUps:t,drawDefinition:e,assignments:i,matchUpsMap:r,structure:n}){var a,o,s,l;let u=((s=(o=(a=yv({drawDefinition:e}))==null?void 0:a.containedStructures)==null?void 0:o[n.structureId])==null?void 0:s.map(({structureId:h})=>h))||[];u.push(n==null?void 0:n.structureId);let c=(i==null?void 0:i.map(({drawPosition:h})=>h))||[],d=(t==null?void 0:t.filter(h=>u.includes(h.structureId)&&ji(h.drawPositions??[],c).length))??[],p=d.map(({matchUpId:h})=>h),m=((l=r==null?void 0:r.drawMatchUps)==null?void 0:l.filter(h=>p.includes(h.matchUpId)))??[];return{drawPositions:c,matchUps:m,targetMatchUps:d}}function VL({lineUp:t}){if(!Array.isArray(t))return;let e={};return dt(t.flatMap(({collectionAssignments:i})=>i==null?void 0:i.map(({collectionId:r,collectionPosition:n})=>[r,n].join("|"))).filter(Boolean)).forEach(i=>{let[r,n]=i.split("|"),a=parseInt(n),{assignedParticipantIds:o}=c0({collectionPosition:a,collectionId:r,lineUp:t});o.forEach(s=>{e[s]||(e[s]=[]),e[s].push({collectionId:r,collectionPosition:a})})}),Object.keys(e).map(i=>({participantId:i,collectionAssignments:e[i]}))}function ip(t){return`${t} must be an array`}function rR({lineUp:t,tieFormat:e}){let i=[];if(!Array.isArray(t))return i.push(ip("lineUp")),{valid:!1,errors:i,error:se};let r=t.every(a=>{if(typeof a!="object")return i.push("lineUp entries must be objects"),!1;let{participantId:o,collectionAssignments:s}=a;return o?typeof o!="string"?(i.push("participantIds must be strings"),!1):Array.isArray(s)?s.every(l=>{if(typeof l!="object")return i.push("collectionAssignments must be objects"),!1;let{collectionPosition:u}=l;return typeof u!="number"?(i.push("collectionPosition must be a number"),!1):!0}):(i.push(ip("collectionAssignments")),!1):(i.push("Missing participantId"),!1)}),n=dt(t.map(Tt)).length===t.length;return n||i.push("Duplicated participantId(s)"),{valid:r&&n,errors:i,error:i.length?se:void 0}}function $h({drawDefinition:t,participantId:e,tieFormat:i,lineUp:r}){if(typeof t!="object")return{error:$e};if(typeof e!="string")return{error:hr};let n=rR({lineUp:r,tieFormat:i});if(!n.valid)return n;let{extension:a}=vt({element:t,name:Fu}),o=(a==null?void 0:a.value)||{};return o[e]=VL({lineUp:r}),_t({element:t,extension:{name:Fu,value:o}}),uw({drawDefinition:t}),{...Q}}function jL({inContextDrawMatchUps:t,inheritance:e=!0,tournamentRecord:i,drawDefinition:r,matchUpsMap:n,assignments:a,structure:o,event:s}){if(!r)return{error:$e};let{drawPositions:l,matchUps:u,targetMatchUps:c}=kJ({inContextDrawMatchUps:t,matchUpsMap:n,assignments:a,structure:o});for(let d of c)d.matchUpType===Ba&&(d.sides??[]).forEach((p,m)=>{var h;if(p!=null&&p.drawPosition&&l!=null&&l.includes(p.drawPosition)){let f=u.find(({matchUpId:g})=>g===d.matchUpId);if((h=f==null?void 0:f.sides)!=null&&h[m]){if(delete f.sides[m].lineUp,e===!1){let g=d.tieFormat,v=p.participantId;g&&v&&$h({drawDefinition:r,participantId:v,lineUp:[],tieFormat:g})}Et({tournamentId:i==null?void 0:i.tournamentId,context:"resetLineUps",eventId:s==null?void 0:s.eventId,drawDefinition:r,matchUp:f})}}});return{...Q}}function cl({provisionalPositioning:t,inContextDrawMatchUps:e,isQualifierPosition:i,sourceMatchUpStatus:r,tournamentRecord:n,drawDefinition:a,seedingProfile:o,participantId:s,seedBlockInfo:l,drawPosition:u,matchUpsMap:c,structureId:d,event:p}){var m,h,f,g,v;let y="assignDrawPosition";if(!s&&!i)return te({result:{error:hr},stack:y});c=c??ln({drawDefinition:a}),e||({matchUps:e}=fr({inContext:!0,drawDefinition:a,matchUpsMap:c}));let I=tt({drawDefinition:a,structureId:d});if(I.error)return te({result:I,stack:y});let{structure:b}=I;if(!b)return{error:Ai};if(Yn({structure:b}))return te({result:{error:la},stack:y});let{seedAssignments:S}=go({provisionalPositioning:t,drawDefinition:a,structure:b}),w=(m=S==null?void 0:S.find(M=>M.participantId===s))==null?void 0:m.seedNumber,{appliedPolicies:U}=Bt({tournamentRecord:n,drawDefinition:a,structure:b,event:p});if(w&&!h0({seedNumber:w,appliedPolicies:U,drawDefinition:a,seedBlockInfo:l,drawPosition:u,structureId:d}))return te({result:{error:zx},context:{drawPosition:u},stack:y});let T=Mr({structure:b}).positionAssignments||[],D=T==null?void 0:T.find(M=>M.drawPosition===u);if(!D)return te({result:{error:av},context:{drawPosition:u},stack:y});if(T!=null&&T.map(Tt).includes(s))return te({result:{error:uv},context:{drawPosition:u},stack:y});let{containsParticipant:P,containsBye:E}=A(D);if(E){let M=Pw({inContextDrawMatchUps:e,tournamentRecord:n,drawDefinition:a,drawPosition:u,structureId:d,matchUpsMap:c,event:p});if(M.error)return te({result:M,stack:y})}if(P&&D.participantId!==s){let{activeDrawPositions:M}=Dw({drawDefinition:a,structureId:d});if(M.includes(u))return te({result:{error:aP},stack:y});jL({assignments:[D],inContextDrawMatchUps:e,tournamentRecord:n,drawDefinition:a,matchUpsMap:c,structure:b})}if(D.participantId=s,i&&(D.qualifier=!0),b.stage===Ae&&(!b.stageSequence||b.stageSequence>1)||b.stage&&[an,Bi].includes(b.stage)){let M=b.stage===Ke?Ke:Ae,C=(((f=(h=a.structures)==null?void 0:h.find(O=>(O==null?void 0:O.stage)===M&&(O==null?void 0:O.stageSequence)===1))==null?void 0:f.seedAssignments)??[]).find(O=>O.participantId===s);if(C!=null&&C.participantId){let{participantId:O,seedNumber:k,seedValue:x}=C;Tv({eventId:p==null?void 0:p.eventId,provisionalPositioning:t,tournamentRecord:n,drawDefinition:a,seedingProfile:o,participantId:O,seedNumber:k,seedValue:x,structureId:d,event:p})}}if(b.structureType!==_n)_Te({provisionalPositioning:t,inContextDrawMatchUps:e,sourceMatchUpStatus:r,tournamentRecord:n,drawDefinition:a,drawPosition:u,matchUpsMap:c,structure:b,event:p});else{pJ({positionAssignments:T,tournamentRecord:n,drawDefinition:a,matchUpsMap:c,structure:b});let{drawPositions:M,matchUps:C,targetMatchUps:O}=kJ({assignments:[D],inContextDrawMatchUps:e,drawDefinition:a,matchUpsMap:c,structure:b});if(M&&(C==null?void 0:C.length)===1&&C[0].matchUpType===fi){let k=((O==null?void 0:O[0].sides)??[]).reduce((x,F,$)=>M!=null&&M.includes(F.drawPosition)?$:x,void 0);BL({inContextTargetMatchUp:O[0],teamParticipantId:s,matchUp:C[0],drawPositionSideIndex:k,tournamentRecord:n,drawDefinition:a})}}let R=(g=a.entries)==null?void 0:g.find(M=>M.participantId===s),N=(v=p==null?void 0:p.entries)==null?void 0:v.find(M=>M.participantId===s);return!R&&N&&CL({entryStatus:N.entryStatus,entryStage:b.stage,ignoreStageSpace:!0,drawDefinition:a,participantId:s,event:p}),Fc({tournamentId:n==null?void 0:n.tournamentId,drawDefinition:a,structure:b,event:p}),{positionAssignments:T,...Q};function A(M){let C=M.bye,O=M.qualifier,k=M.participantId;return{containsBye:C,containsQualifier:O,containsParticipant:k,filled:C||O||k}}}function _Te({provisionalPositioning:t,inContextDrawMatchUps:e,sourceMatchUpStatus:i,tournamentRecord:r,drawDefinition:n,drawPosition:a,matchUpsMap:o,structure:s,event:l}){let u={isCollectionMatchUp:!1},{matchUps:c}=qt({provisionalPositioning:t,matchUpFilters:u,drawDefinition:n,matchUpsMap:o,structure:s,event:l}),{roundMatchUps:d}=An({matchUps:c}),{initialRoundNumber:p}=Lm({drawPosition:a,matchUps:c}),m=p&&(d==null?void 0:d[p].find(h=>{var f;return(f=h.drawPositions)==null?void 0:f.includes(a)}));if(m){let h=mg({matchUpId:m.matchUpId,inContextDrawMatchUps:e,sourceMatchUpStatus:i,tournamentRecord:r,drawDefinition:n,drawPosition:a,matchUpsMap:o});if(h.error)return te({stack:"assignDrawPositionToMatchUps",context:{drawPosition:a},result:h})}return{...Q}}function GL(t){let{participantIdAttributeName:e="participantId",isQualifierPosition:i,positionActionName:r,tournamentRecord:n,drawDefinition:a,participantId:o,drawPosition:s,structureId:l,event:u}=t,c="positionParticipantAction";if(!a)return{error:$e};let d=Bt({tournamentRecord:n,drawDefinition:a,event:u}).appliedPolicies??{},{inContextDrawMatchUps:p,matchUpsMap:m}=t;m||(m=ln({drawDefinition:a}),Object.assign(t,{matchUpsMap:m})),p||({matchUps:p}=fr({inContext:!0,drawDefinition:a,matchUpsMap:m}),Object.assign(t,{inContextDrawMatchUps:p}));let{positionAssignments:h}=si({drawDefinition:a,structureId:l}),f=h==null?void 0:h.find(b=>b.drawPosition===s);if(f!=null&&f.participantId){let b=f.participantId,S=cl({inContextDrawMatchUps:p,tournamentRecord:n,drawDefinition:a,participantId:o,drawPosition:s,structureId:l,matchUpsMap:m,event:u});return S.success?I({appliedPolicies:d,removedParticipantId:b}):te({result:S,stack:c})}let g=Pw({inContextDrawMatchUps:p,tournamentRecord:n,drawDefinition:a,drawPosition:s,structureId:l,matchUpsMap:m,event:u});if(g.error)return te({result:g,stack:c});let v=g.participantId,y=cl({inContextDrawMatchUps:p,isQualifierPosition:i,tournamentRecord:n,drawDefinition:a,participantId:o,drawPosition:s,structureId:l,matchUpsMap:m,event:u});if(!y.success)return te({result:y,stack:c});return I({appliedPolicies:d,removedParticipantId:v});function I({appliedPolicies:b,removedParticipantId:S}){let{structure:w}=tt({drawDefinition:a,structureId:l});dL({drawPositions:[s],structure:w});let U={[e]:o,name:r,drawPosition:s,structureId:l};return GP({appliedPolicies:b,drawDefinition:a,positionAction:U}),te({context:{removedParticipantId:S},result:{...Q},stack:c})}}function $Te({luckyLoserParticipantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,structureId:n}){return GL({positionActionName:"luckyLoserDrawPositionAssignment",participantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,structureId:n})}function xJ(t){return $Te(t)}function FJ({params:t,modMap:e,structure:i}){let{tournamentRecord:r,drawDefinition:n,event:a}=t;for(let o of i.matchUps)e[o.matchUpId]&&(o.roundNumber=e[o.matchUpId],Et({tournamentId:r==null?void 0:r.tournamentId,eventId:a==null?void 0:a.eventId,drawDefinition:n,matchUp:o}))}function LJ(t,e){let i=[{drawDefinition:!0,structureId:!0}];Array.isArray(e)&&i.push(...e);let r=We(t,i);if(r.error)return r;let n=tt(t);if(n.error)return n;let a=n.structure;if(!Yn({structure:a}))return te({result:{error:Sp,message:"structure must be adHoc"}});let{roundMatchUps:o=[],roundNumbers:s}=An({matchUps:a==null?void 0:a.matchUps});return s!=null&&s.length?{valid:!0,structure:a,roundMatchUps:o,roundNumbers:s}:{error:Ju}}function _J(t){var e;let i=LJ(t,[{targetRoundNumber:!0,roundNumber:!0,[Jn]:CSe}]);if(i.error)return i;let{structure:r,roundMatchUps:n,roundNumbers:a}=i,{targetRoundNumber:o,roundNumber:s}=t;if(!(a!=null&&a.includes(s))||!(a!=null&&a.includes(o)))return te({result:{error:se},info:"roundNumbers must be valid rounds"});let l=o>s,u=l?Te(s+1,o+1):Te(o,s),c={};return u.forEach(d=>((n==null?void 0:n[d])??[]).forEach(({matchUpId:p})=>{c[p]=d-(l?1:-1)})),(e=n==null?void 0:n[s])==null||e.forEach(({matchUpId:d})=>c[d]=o),FJ({params:t,modMap:c,structure:r}),{...Q}}function $J({structurePositionAssignments:t,provisionalPositioning:e,tournamentRecord:i,drawDefinition:r,event:n}){var a;if(!r)return{error:$e};if(!Array.isArray(t))return{error:se};let o="setPositionAssignments";for(let l of t){let{structureId:u,positionAssignments:c}=l;if(!c)continue;let d=tt({drawDefinition:r,structureId:u});if(d.error)return d;let p=d.structure;if(!p)return{error:Ai};let m=(a=si({structure:p}).positionAssignments)==null?void 0:a.map(({drawPosition:v})=>v),h=c==null?void 0:c.map(({drawPosition:v})=>v);if(ji(m,h).length!==(m==null?void 0:m.length))return te({result:{error:se},info:"drawPositions do not match",stack:o});let f=ln({drawDefinition:r}),{matchUps:g}=fr({inContext:!0,drawDefinition:r,matchUpsMap:f});for(let v of c||[]){let{drawPosition:y,participantId:I,bye:b,qualifier:S}=v;if(b){let w=Za({tournamentRecord:i,drawDefinition:r,drawPosition:y,matchUpsMap:f,structureId:u,structure:p,event:n});if(w!=null&&w.error)return w}else if(S)c.forEach(w=>{w.drawPosition===y&&(w.qualifier=!0,delete w.participantId,delete w.bye)});else if(I){let w=cl({provisionalPositioning:e,inContextDrawMatchUps:g,tournamentRecord:i,drawDefinition:r,participantId:I,drawPosition:y,matchUpsMap:f,structureId:u,event:n});if(w!=null&&w.error)return w}}Fc({tournamentId:i==null?void 0:i.tournamentId,drawDefinition:r,structure:p,event:n})}let s=t.map(({structureId:l})=>l);return ui({tournamentId:i==null?void 0:i.tournamentId,eventId:n==null?void 0:n.eventId,drawDefinition:r,structureIds:s}),{...Q}}function BJ(t){let e=LJ(t,[{roundNumbers:!0,[Jn]:cn,[Xr]:o=>o.length===2&&o.every(_i)}]);if(e.error)return e;let{structure:i,roundMatchUps:r,roundNumbers:n}=e;if(!t.roundNumbers.every(o=>n==null?void 0:n.includes(o)))return te({result:{error:se,message:"roundNumbers must be valid rounds"}});let a={};return t.roundNumbers.forEach((o,s)=>((r==null?void 0:r[o])??[]).forEach(({matchUpId:l})=>{a[l]=t.roundNumbers[1-s]})),FJ({params:t,modMap:a,structure:i}),{...Q}}function BTe({qualifyingParticipantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,structureId:n}){return GL({positionActionName:"qualifierDrawPositionAssignment",participantId:t,isQualifierPosition:!0,tournamentRecord:e,drawDefinition:i,drawPosition:r,structureId:n})}function VJ(t){return BTe(t)}function jJ({alternateParticipantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,structureId:n,event:a}){return GL({positionActionName:"alternateDrawPositionAssignment",participantIdAttributeName:"alternateParticipantid",participantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,structureId:n,event:a})}function GJ({validation:t=!0,tournamentRecord:e,drawDefinition:i,participantId:r,structureId:n,seedValue:a,event:o}){if(!i)return{error:$e};if(!n)return{error:Xa};let s=((e==null?void 0:e.participants)??[]).find(p=>p.participantId===r);if(e&&!s)return{error:Ms};let{structure:l}=tt({drawDefinition:i,structureId:n});if(!l)return{error:Ai};if(!(!t||_i(a)||a===void 0||a===""||typeof a=="string"&&a.split("-").every(p=>_i(p)&&Ze(p)>0)))return{error:se};let{seedAssignments:u}=go({drawDefinition:i,structure:l}),c=u==null?void 0:u.map(p=>p.seedNumber),d=u==null?void 0:u.find(p=>p.participantId===r);if(d){let p=typeof a=="string"?a.includes("-")&&a.split("-").map(m=>parseInt(m)).join("-")||parseInt(a)>0&&parseInt(a)||"":a&&a>0&&a||"";d.seedValue=p}else{let p={seedNumber:Math.max(0,...c||[])+1,participantId:r};a&&(p.seedValue=a),l.seedAssignments||(l.seedAssignments=[]),l.seedAssignments.push(p)}return AX({tournamentId:e==null?void 0:e.tournamentId,eventId:o==null?void 0:o.eventId,drawDefinition:i,structure:l}),{...Q}}function HJ({drawDefinition:t,structureId:e}){if(!t)return{error:$e};let{structure:i}=tt({drawDefinition:t,structureId:e}),r=((t==null?void 0:t.links)||[]).filter(n=>{var a;return((a=n.source)==null?void 0:a.structureId)===e}).map(n=>{var a;return(a=n.target)==null?void 0:a.structureId});return{playoffStructures:((t==null?void 0:t.structures)||[]).filter(n=>r.includes(n.structureId)),structure:i}}function nR({withStageGrouping:t,stageSequences:e,stageSequence:i,roundTarget:r,stages:n,event:a,stage:o}){if(!a)return{error:vi};let s={},l=[];for(let u of a.drawDefinitions||[]){let{structures:c,stageStructures:d}=ns({withStageGrouping:t,stageSequences:e,drawDefinition:u,stageSequence:i,roundTarget:r,stages:n,stage:o});if(l.push(...c),d)for(let p of Object.keys(d))s[p]||(s[p]=[]),s[p].push(...d[p])}return{structures:l,stageStructures:s}}function HL({withStageGrouping:t,tournamentRecord:e,stageSequences:i,stageSequence:r,roundTarget:n,stages:a,stage:o}){if(!e)return{error:ve};let s={},l=[];for(let u of e.events||[]){let{structures:c,stageStructures:d}=nR({withStageGrouping:t,stageSequences:i,stageSequence:r,roundTarget:n,stages:a,event:u,stage:o});if(c&&l.push(...c),d)for(let p of Object.keys(d))s[p]||(s[p]=[]),s[p].push(...d[p])}return{structures:l,stageStructures:s}}function _c(t){if(!(t!=null&&t.drawDefinition))return!1;let e=ZP(t),i=e==null?void 0:e.includesTeamMatchUps,{completedMatchUps:r,pendingMatchUps:n,upcomingMatchUps:a}=e||{};return i&&(r=r==null?void 0:r.filter(({matchUpType:o})=>o===fi),n=n==null?void 0:n.filter(({matchUpType:o})=>o===fi),a=a==null?void 0:a.filter(({matchUpType:o})=>o===fi)),!!(r!=null&&r.length&&!(n!=null&&n.length)&&!(a!=null&&a.length))}function zL(t){var e,i;let{drawDefinition:r,structureId:n}=t;if(!r)return{error:$e};let{playoffStructures:a}=HJ({drawDefinition:r,structureId:n});if(!(a!=null&&a.length))return!1;let o=((i=(e=r==null?void 0:r.entries)==null?void 0:e.filter(l=>(l==null?void 0:l.entryStatus)&&ds.includes(l.entryStatus)))==null?void 0:i.length)??0,s=0;return(a||[]).reduce((l,u)=>{var c;return!!((c=si({structure:u}).positionAssignments??[])!=null&&c.filter(d=>(d.participantId&&s++,(d==null?void 0:d.bye)??(d==null?void 0:d.participantId))).length&&l)},!!a.length)||s===o}function MM({significantCharacters:t,accessors:e=[],value:i}){let r=[],n=e[0];if(i!=null&&i[n]){let o=e.slice(1);if(Array.isArray(i[n]))i[n].forEach(s=>{let l=MM({accessors:o,significantCharacters:t,value:s});r.push(...l)});else if(i=i[n],o.length){let s=MM({accessors:o,significantCharacters:t,value:i});r.push(...s)}else a({value:i})}function a({value:o}){if(o&&["string","number"].includes(typeof o)){let s=t?o.slice(0,t):o;r.push(s)}}return r}function VTe({targetParticipantIds:t,policyAttributes:e,idCollections:i,participants:r}){if(!Array.isArray(e))return{error:tF};if(!Array.isArray(r))return{error:Xb};let n={};return t.forEach(a=>{let o=r.find(l=>l.participantId===a),{values:s}=zJ({policyAttributes:e,idCollections:i,participants:r,participant:o});s&&s.forEach(l=>{n[l]||(n[l]=[]),n[l].includes(a)||n[l].push(a)})}),n}function zJ({policyAttributes:t,idCollections:e,participants:i,participant:r}){if(!Array.isArray(t))return{error:tF};if(!r)return{error:yh};let n=[];return t.forEach(a=>{let{directive:o,groupings:s,key:l,significantCharacters:u}=a||{};if(l){let c=l.split(".");n.push(...MM({significantCharacters:u,value:r,accessors:c}))}else if(o){let c=a==null?void 0:a.includeIds,d=((e==null?void 0:e[o])||[]).filter(p=>!c||c.includes(p));d!=null&&d.length&&i!=null&&i.length&&d.forEach(p=>{var m;let h=i.find(f=>f.participantId===p);if((m=h==null?void 0:h.individualParticipantIds)!=null&&m.includes(r.participantId)){let f=h==null?void 0:h.participantId;n.push(f)}})}else s&&Object.keys(s).forEach(c=>{s[c].includes(r.participantId)&&n.push(c)})}),{values:dt(n)}}function P2({candidatePositionAssignments:t,participantsWithGroupings:e,policyAttributes:i,idCollections:r}){let n=Object.assign({},...e.map(a=>({[a.participantId]:a})));return t.map(a=>{let o=n[a.participantId],{values:s}=zJ({participants:e,policyAttributes:i,idCollections:r,participant:o});return{...a,values:s}})}function WJ({participantIdGroups:t,positionAssignments:e,groupsToAvoid:i}){return Object.assign({},...e.filter(r=>r==null?void 0:r.participantId).map(r=>{let{drawPosition:n,participantId:a}=r,o=t?t[a]||[]:[],s=!!i.some(l=>o.includes(l));return{[n]:{participantGroups:o,includesGroupsToAvoid:s}}}))}function jTe(t){let{unfilledPositions:e,chunkedDrawPositions:i}=t,r=WJ(t);return i.map(a=>{let o=e.filter(u=>a.includes(u)),s=n(o),l=o.filter(u=>!s.includes(u)).filter(u=>{var c;let d=R2(u);return!((c=r[d])!=null&&c.includesGroupsToAvoid)});return{unassigned:o,unpaired:s,pairedNoConflict:l}});function n(a){return a.filter(s=>!o(s));function o(s){let l=R2(s);return!a.includes(l)}}}function GTe(t){let{unfilledPositions:e,chunkedDrawPositions:i}=t,r=WJ(t);return i.map(n=>{let a=e.filter(l=>n.includes(l)),o=a.length===n.length?a:[],s=n.filter(l=>{var u;return(u=r[l])==null?void 0:u.includesGroupsToAvoid}).length;return{unassigned:a,unpaired:o,pairedNoConflict:s?[]:a,conflictsCount:s}})}function R2(t){return Number(t%2?t+1:t-1)}function HTe({allGroups:t,participantId:e}){return Object.keys(t).filter(i=>t[i].includes(e))}function zTe({selectedParticipantGroups:t,participantIdGroups:e,positionAssignments:i,drawPositionChunks:r,unfilledPositions:n,isRoundRobin:a}){let o=r.map(s=>a?GTe({groupsToAvoid:t,chunkedDrawPositions:s,participantIdGroups:e,positionAssignments:i,unfilledPositions:n}):jTe({groupsToAvoid:t,chunkedDrawPositions:s,participantIdGroups:e,positionAssignments:i,unfilledPositions:n}));if(a){let s=o.map(c=>c.map(d=>d.unassigned).filter(d=>d==null?void 0:d.length)).filter(c=>c==null?void 0:c.length).sort((c,d)=>(d.length||0)-(c.length||0)),l=o.map(c=>c.map(d=>d.unpaired).filter(d=>d==null?void 0:d.length)).filter(c=>c==null?void 0:c.length),u=o.map(c=>c.map(d=>d.pairedNoConflict).filter(d=>d==null?void 0:d.length)).filter(c=>c==null?void 0:c.length).sort((c,d)=>(d.length||0)-(c.length||0));return{unassigned:s,unpaired:l,pairedNoConflict:u}}else{let s=o.map(c=>c.map(d=>d.unassigned).filter(d=>d==null?void 0:d.length)).filter(c=>c==null?void 0:c.length),l=o.map(c=>c.map(d=>d.unpaired).filter(d=>d==null?void 0:d.length)).filter(c=>c==null?void 0:c.length),u=o.map(c=>c.map(d=>d.pairedNoConflict).filter(d=>d==null?void 0:d.length)).filter(c=>c==null?void 0:c.length);return{unassigned:s,unpaired:l,pairedNoConflict:u}}}function qJ({positionAssignments:t,participantIds:e}){let i=t.map(r=>r.participantId);return e.filter(r=>!i.includes(r))}function WTe({useSpecifiedGroupKey:t=!1,targetParticipantIds:e,largestFirst:i=!0,allGroups:r,groupKey:n}){var a;let o=Object.assign({},...Object.keys(r).map(c=>[c,r[c].filter(d=>e.includes(d))]).filter(c=>c[1].length).map(([c,d])=>({[c]:d}))),s=Object.keys(o).reduce((c,d)=>o[d].length>c?o[d].length:c,0),l=Object.keys(o).filter(c=>o[c].length===s),u=_o(i?l:Object.keys(o));return n=t&&(a=o[n])!=null&&a.length?n:u,{participantId:n&&o[n]?_o(o[n]):_o(e),groupKey:n}}function qTe({drawPositionGroups:t,positionAssignments:e}){let i=Object.assign({},...e.map(r=>({[r.drawPosition]:r})));return t.map(r=>r.filter(Boolean).map(n=>i[n]).filter(Boolean).filter(n=>!n.participantId&&!n.bye).map(n=>n.drawPosition)).flat().filter(Boolean)}function YTe({candidatePositionAssignments:t,unseededParticipantIds:e,participantIdGroups:i,drawPositionChunks:r,drawPositionGroups:n,pairedPriority:a,allGroups:o,groupKey:s}){let l=n.reduce((T,D)=>D.length>T?D.length:T,0)<=2,u=qJ({positionAssignments:t,participantIds:e}),c=qTe({positionAssignments:t,drawPositionGroups:n}),{participantId:d,groupKey:p}=WTe({targetParticipantIds:u,useSpecifiedGroupKey:l,allGroups:o,groupKey:s}),m=HTe({participantId:d,allGroups:o}),h=zTe({positionAssignments:t,isRoundRobin:l,selectedParticipantGroups:m,participantIdGroups:i,drawPositionChunks:r,unfilledPositions:c}),{unassigned:f,unpaired:g,pairedNoConflict:v}=h,y=(v==null?void 0:v.length)&&v[0],I=(g==null?void 0:g.length)&&g[0],b=a&&y?y:I,S=a?I:y,w=(b==null?void 0:b.length)&&b||(S==null?void 0:S.length)&&S,U;if(w!=null&&w.length){let T=ga(w);U=ga(T)}else{let T=ga(f[0]);U=ga(T)}return{newGroupKey:p,selectedParticipantId:d,targetDrawPosition:U}}function f0({isRoundRobin:t,groupedParticipants:e}){let i=[];return t?e.forEach(r=>{let n=r.map(s=>s.drawPosition),a=FL({drawPositions:n}).uniqueMatchUpGroupings??[],o=Object.assign({},...r.map(s=>({[s.drawPosition]:s})));a.forEach(s=>{Nn(o[s[0]].values||[],o[s[1]].values||[])&&(i.push(s),r.conflict=!0)})}):e.forEach(r=>{var n,a;Nn(((n=r[0])==null?void 0:n.values)||[],((a=r[1])==null?void 0:a.values)||[])&&(i.push(r),r.conflict=!0)}),i}function KTe({positionedParticipants:t,potentialDrawPositions:e,drawPositionGroups:i,avoidanceConflicts:r,isRoundRobin:n}){return r.map(a=>{let o=a.map(s=>s.drawPosition);return a.filter(s=>e.includes(s.drawPosition)).map(s=>{let l=e.filter(u=>!(o!=null&&o.includes(u))).filter(u=>{let c=i.find(f=>f.includes(u)).find(f=>f!==u),d=t.find(f=>f.drawPosition===c),p=f0({isRoundRobin:n,groupedParticipants:[[s,d]]}),m=[t.find(f=>f.drawPosition===u),d],h=f0({isRoundRobin:n,groupedParticipants:[m]});return!p.length&&!h.length});if(l.length)return{drawPosition:s.drawPosition,possibleDrawPositions:l}}).filter(Boolean)}).flat(1)}function E2(t){let{initialPositionAssignments:e,participantsWithGroupings:i,opponentsToPlaceCount:r,unseededByePositions:n,drawPositionGroups:a,policyAttributes:o,idCollections:s,allGroups:l}=t,u=[],c,d=Math.min(...(a||[]).map(I=>I==null?void 0:I.length).filter(Boolean)),p=d>2,m=Ne(e,!1,!0).filter(I=>!I.qualifier),h=e.filter(I=>!I.participantId&&(!I.bye||(n==null?void 0:n.includes(I.drawPosition)))).map(I=>I.drawPosition);Te(0,r).forEach(()=>{let{newGroupKey:I,selectedParticipantId:b,targetDrawPosition:S}=YTe({...t,candidatePositionAssignments:m,allGroups:l,groupKey:c});c=I,m.forEach(w=>{w.drawPosition===S&&(w.participantId=b)})});let f=P2({candidatePositionAssignments:m,participantsWithGroupings:i,policyAttributes:o,idCollections:s}),g=Cr(f,d),v=f0({groupedParticipants:g,isRoundRobin:p}),y=0;for(;y<20&&v.length;){let I=KTe({positionedParticipants:f,potentialDrawPositions:h,avoidanceConflicts:v,drawPositionGroups:a,isRoundRobin:p});if(I.length){let b=XTe({candidatePositionAssignments:m,swapOptions:I});b.error&&console.log({result:b}),f=P2({candidatePositionAssignments:m,participantsWithGroupings:i,policyAttributes:o,idCollections:s}),g=Cr(f,d),v=f0({groupedParticipants:g,isRoundRobin:p}),y++}else y=20}return m.forEach(I=>{if(I.bye&&I.participantId){let b=oM;u.push(b)}if(I.qualifier&&I.participantId){let b=oM;u.push(b)}}),{positionAssignments:m,conflicts:v.length,groupedParticipants:g,errors:u}}function XTe({candidatePositionAssignments:t,swapOptions:e}){let i=ga(e);if(!i)return{error:{message:"No swap options"}};let r=i.drawPosition,n=ga(i.possibleDrawPositions),a=t.find(u=>u.drawPosition===r),o=t.find(u=>u.drawPosition===n)??{},s={participantId:o==null?void 0:o.participantId,qualifier:o==null?void 0:o.qualifier,bye:o==null?void 0:o.bye},l={participantId:a.participantId,qualifier:a.qualifier,bye:a.bye};return Object.assign(a,s),Object.assign(o,l),{...Q}}function JTe({provisionalPositioning:t,unseededParticipantIds:e,inContextDrawMatchUps:i,unseededByePositions:r,tournamentRecord:n,drawDefinition:a,seedBlockInfo:o,participants:s,matchUpsMap:l,structureId:u,avoidance:c,drawSize:d,event:p}){var m;if(!c)return{error:r9};let{candidatesCount:h=1,policyAttributes:f,targetDivisions:g}=c,{roundsToSeparate:v}=c,y="randomUnseededSeparation",{structure:I}=tt({drawDefinition:a,structureId:u}),{matchUps:b}=qt({provisionalPositioning:t,matchUpsMap:l,structure:I,event:p});if(g&&Cs(g)&&!v){let _=Nwe(g)||0,L=b.reduce((B,V)=>V.roundNumber>B?V.roundNumber:B,0);v=L<_?1:L-_+1}let{positionAssignments:S}=Mr({structure:I}),w=pL({participantsProfile:{convertExtensions:!0},deepCopy:!1,participants:s}).participantsWithGroupings,U=S==null?void 0:S.filter(_=>!_.participantId),T=S==null?void 0:S.map(_=>_.drawPosition),D=(I==null?void 0:I.structureType)===_n,P=D?{structure:I,matchUps:b,allDrawPositions:T,roundsToSeparate:v}:{matchUps:b,allDrawPositions:T,roundsToSeparate:v},{drawPositionGroups:E,drawPositionChunks:R}=D?QTe(P):ZTe(P),N={groupParticipants:s.filter(_=>_.participantType===Ja).map(_=>_.participantId),teamParticipants:s.filter(_=>_.participantType===Xt).map(_=>_.participantId),pairParticipants:s.filter(_=>_.participantType===ft).map(_=>_.participantId)},A=VTe({targetParticipantIds:e,policyAttributes:f,idCollections:N,participants:s});if(A.error)return te({result:A,stack:y});let M=Object.assign({},...e.map(_=>{let L=Object.keys(A).filter(B=>(A[B]??[]).includes(_));return{[_]:L}})),C=qJ({participantIds:e,positionAssignments:S});if(C.length>((U==null?void 0:U.length)||0))return{error:oF};let O,k=C.length,x=Te(0,h).map(()=>E2({initialPositionAssignments:S,participantsWithGroupings:w,unseededParticipantIds:e,opponentsToPlaceCount:k,pairedPriority:!1,unseededByePositions:r,participantIdGroups:M,drawPositionChunks:R,drawPositionGroups:E,policyAttributes:f,idCollections:N,allGroups:A,drawSize:d}));if(O=x.reduce((_,L)=>!_||(L.conflicts||0)<(_.conflicts||0)?L:_,void 0),!O||O.conflicts){let _=Te(0,h).map(()=>E2({initialPositionAssignments:S,participantsWithGroupings:w,unseededParticipantIds:e,opponentsToPlaceCount:k,pairedPriority:!0,unseededByePositions:r,participantIdGroups:M,drawPositionChunks:R,drawPositionGroups:E,policyAttributes:f,idCollections:N,allGroups:A,drawSize:d}));O=x.concat(..._).filter(L=>{var B;return!((B=L.errors)!=null&&B.length)}).reduce((L,B)=>!L||(B.conflicts||0)<(L.conflicts||0)?B:L,void 0)}if(!O)return{error:hP};let F=(((m=si({structure:I}))==null?void 0:m.positionAssignments)??[]).filter(_=>_.participantId).map(_=>_.participantId),$=O.positionAssignments.filter(_=>!F.includes(_.participantId));for(let _ of $)if(_.bye){let L=Za({tournamentRecord:n,drawDefinition:a,seedBlockInfo:o,structureId:u,matchUpsMap:l,event:p,..._});if(L.error)return te({result:L,stack:y})}else if(_.participantId){let L=cl({automaticPlacement:!0,inContextDrawMatchUps:i,tournamentRecord:n,drawDefinition:a,seedBlockInfo:o,structureId:u,matchUpsMap:l,event:p,..._});if(L.error)return te({result:L,stack:y,context:{assignment:_}})}return{...Q}}function QTe(t){let{structure:{structures:e}}=t,i=e.map(r=>r.positionAssignments.map(n=>n.drawPosition));return{drawPositionGroups:i,drawPositionChunks:[i]}}function ZTe({allDrawPositions:t,roundsToSeparate:e,matchUps:i}){let r=i.filter(c=>c.roundNumber===1).map(c=>c.drawPositions),n=r.flat().sort(lr),a=Math.max(...n),o=t.filter(c=>c>a),s=n.length,l=Te(s===2?1:2,s).filter(c=>c===Gx(c)),u=l.slice(0,e||l.length).reverse().map(c=>Cr(n,c));return o.length&&console.log({fedDrawPositions:o}),{drawPositionGroups:r,drawPositionChunks:u}}function eDe({provisionalPositioning:t,inContextDrawMatchUps:e,unseededByePositions:i,multipleStructures:r,tournamentRecord:n,drawDefinition:a,seedBlockInfo:o,participants:s,matchUpsMap:l,structureId:u,structure:c,drawSize:d,event:p}){var m,h;let f="positionUnseededParticipants";c||({structure:c}=tt({drawDefinition:a,structureId:u})),u||({structureId:u}=c);let{positionAssignments:g}=Mr({structure:c}),{seedAssignments:v}=go({provisionalPositioning:t,drawDefinition:a,structure:c}),y=v==null?void 0:v.map(E=>E.participantId).filter(Boolean),{stage:I,stageSequence:b}=c,S=I===Ke?(h=(m=vt({element:c,name:yl}))==null?void 0:m.extension)==null?void 0:h.value:void 0,w=Eh({provisionalPositioning:t,drawDefinition:a,stageSequence:b,entryStatuses:Np,structureId:u,roundTarget:S,stage:I}),U=w.filter(E=>!(y!=null&&y.includes(E.participantId))).map(E=>E.participantId),T=g==null?void 0:g.filter(E=>!E.participantId&&!E.bye&&!E.qualifier).map(E=>E.drawPosition);if(!r&&U.length>((T==null?void 0:T.length)||0))return te({result:{error:oF},context:{unseededParticipantsCount:U.length,unfilledDrawPositionsCount:T==null?void 0:T.length},stack:f});let{appliedPolicies:D}=Bt({tournamentRecord:n,drawDefinition:a,event:p}),P=D==null?void 0:D[sy];if(c.stage===Bi){let E=w.reduce((R,N)=>(R[N.groupingValue]||(R[N.groupingValue]=[]),R[N.groupingValue].push(N.participantId),R),{});Object.keys(E).length&&(P||(P={policyName:"Playoff Avoidance"}),P.policyAttributes||(P.policyAttributes=[]),P.policyAttributes.push({groupings:E}))}return P&&s?JTe({provisionalPositioning:t,unseededParticipantIds:U,inContextDrawMatchUps:e,unseededByePositions:i,tournamentRecord:n,drawDefinition:a,seedBlockInfo:o,participants:s,matchUpsMap:l,structureId:u,avoidance:P,drawSize:d,entries:w}):tDe({provisionalPositioning:t,unseededParticipantIds:U,inContextDrawMatchUps:e,unfilledDrawPositions:T,multipleStructures:r,tournamentRecord:n,drawDefinition:a,seedBlockInfo:o,structureId:u,matchUpsMap:l,drawSize:d,event:p})}function tDe({provisionalPositioning:t,unseededParticipantIds:e,inContextDrawMatchUps:i,unfilledDrawPositions:r,multipleStructures:n,tournamentRecord:a,drawDefinition:o,seedBlockInfo:s,matchUpsMap:l,structureId:u,drawSize:c,event:d}){let p=c>2?Tn(r):r.reverse();for(let m of e){let h=p.pop();if(!n||h){let f=cl({provisionalPositioning:t,inContextDrawMatchUps:i,tournamentRecord:a,drawDefinition:o,seedBlockInfo:s,participantId:m,drawPosition:h,matchUpsMap:l,structureId:u,event:d});if(f!=null&&f.error&&console.log("!!!!!",{result:f}),f==null?void 0:f.error)return te({result:f,stack:"randomUnseededDistribution"})}}return{...Q}}function iDe(t){let e=t.structure??tt(t).structure,i="positionQualifiers",r=[];if(e.stage===an)return te({result:{error:Dp},stack:i});let{unplacedRoundQualifierCounts:n,positionAssignments:a,roundDrawPositions:o}=rDe(t);for(let s of Object.keys(n)){let l=a==null?void 0:a.filter(u=>o[s].includes(u.drawPosition)&&!u.participantId&&!u.qualifier&&!u.bye).map(u=>u.drawPosition);if(n[s]>(l||0))return te({result:{error:U9},context:{unfilledDrawPositions:l},stack:i});Te(0,n[s]).forEach(()=>{let u=ga(l);r.push(u),a==null||a.forEach(c=>{c.drawPosition===u&&(c.qualifier=!0,delete c.participantId,delete c.bye)})})}return{...Q,qualifierDrawPositions:r}}function rDe({drawDefinition:t,structure:e,structureId:i}){e||({structure:e}=tt({drawDefinition:t,structureId:i})),i||({structureId:i}=e);let{positionAssignments:r}=Mr({structure:e}),{stage:n,stageSequence:a}=e,{qualifiersCount:o,roundQualifiersCounts:s}=Uv({drawDefinition:t,stageSequence:a,structureId:i,stage:n}),l=(s?Object.keys(s):[]).map(f=>Ze(f)),{matchUps:u}=qt({structure:e}),{roundProfile:c}=An({matchUps:u}),d=Object.assign({},...l.filter(f=>c==null?void 0:c[f]).map(f=>{var g,v;return{[f]:((v=(g=c==null?void 0:c[f])==null?void 0:g.drawPositions)==null?void 0:v.filter(Boolean))??[]}})),p=r==null?void 0:r.filter(f=>f.qualifier).map(f=>f.drawPosition),m=o-((p==null?void 0:p.length)??0),h=p==null?void 0:p.length;return{unplacedRoundQualifierCounts:Object.assign({},...l.map(f=>{let g=r==null?void 0:r.filter(v=>{var y,I;return v.qualifier&&((I=(y=d[f])==null?void 0:y.drawPositions)==null?void 0:I.includes(v.drawPosition))}).map(v=>v.drawPosition);return{[f]:((s==null?void 0:s[f])??0)-((g==null?void 0:g.length)??0)}})),unplacedQualifiersCount:m,placedQualifiersCount:h,roundQualifiersCounts:s,positionAssignments:r,roundDrawPositions:d,qualifiersCount:o}}function C2({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,appliedPolicies:r,validSeedBlocks:n,drawDefinition:a,seedingProfile:o,seedBlockInfo:s,participants:l,groupsCount:u,structureId:c,matchUpsMap:d,structure:p,event:m}){let h=[],f=[],g=0;if(p||({structure:p}=tt({drawDefinition:a,structureId:c})),c||(c=p==null?void 0:p.structureId),r||(r=Bt({drawDefinition:a}).appliedPolicies),!n){let v=p&&_h({provisionalPositioning:t,appliedPolicies:r,drawDefinition:a,seedingProfile:o,structure:p});v!=null&&v.error&&f.push(v.error),n=v==null?void 0:v.validSeedBlocks}return u=u??(n==null?void 0:n.length)??0,Te(0,u).forEach(()=>{if(g<(u||0)){let v=nDe({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:a,seedingProfile:o,seedBlockInfo:s,participants:l,structureId:c,matchUpsMap:d,event:m});v!=null&&v.success&&(g++,h.push(...v.seedPositions??[])),v.error&&f.push({seedPositionError:v.error})}}),f.length?{error:f}:{...Q,seedPositions:h}}function nDe({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:r,seedingProfile:n,seedBlockInfo:a,participants:o,structureId:s,matchUpsMap:l,event:u}){let{unplacedSeedParticipantIds:c,unfilledPositions:d}=MJ({provisionalPositioning:t,randomize:!0,drawDefinition:r,seedingProfile:n,seedBlockInfo:a,structureId:s,event:u}),{appliedPolicies:p}=Bt({drawDefinition:r}),{avoidance:m}=p??{};m&&o&&(c==null?void 0:c.length)>2;let h=[];for(let f of c){let g=d.pop();if(!g)return{error:ov};h.push(g);let v=cl({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:r,seedingProfile:n,participantId:f,seedBlockInfo:a,drawPosition:g,matchUpsMap:l,structureId:s,event:u});if(!v.success)return v}return{...Q,seedPositions:h}}function aDe({provisionalPositioning:t,drawDefinition:e,structure:i}){let{positionAssignments:r}=Mr({structure:i}),{seedAssignments:n}=go({provisionalPositioning:t,drawDefinition:e,structure:i}),a=Object.assign({},...(n||[]).filter(o=>o.participantId).map(o=>({[o.participantId]:o})));return r==null?void 0:r.map(o=>a[o.participantId]?{...o,seedNumber:a[o.participantId].seedNumber,seedValue:a[o.participantId].seedValue}:"").filter(Boolean)}function oDe({orderedSortedFirstRoundSeededDrawPositions:t,validSeedBlocks:e,byesToPlace:i}){let r=[];e.forEach(a=>{if(i-r.length>a.drawPositions.length)r.push(...a.drawPositions);else{let o=NM(Cr(a.drawPositions,2)),s,l=t[r.length];for(;s=rS(o,l);)r.push(s),l=t[r.length]}});let n=r.map(a=>Array.isArray(a)?Tn(a):a).flat(1/0);return DK(i)&&e.map(a=>a.seedNumbers[0]).includes(i)?t:n}function rS(t,e){if(Array.isArray(t)&&t.length!==2)return t.pop();if(!Array.isArray(t[0]))return t.includes(e)?t.indexOf(e)?t.pop():t.shift():Math.round(Math.random())?t.pop():t.shift();let i=t[0].flat(1/0).length,r=t[1].flat(1/0).length;if(i===r){let n=t[0].flat(1/0).includes(e)?t[0]:t[1];return rS(e?n:t[Math.round(Math.random())],e)}return i<r?rS(t[1],e):rS(t[0],e)}function NM(t){let e=Math.floor(t.length/2);return t.length>2?[NM(t.slice(0,e)),NM(t.slice(e))]:t}function sDe({provisionalPositioning:t,relevantMatchUps:e,appliedPolicies:i,drawDefinition:r,seedingProfile:n,seedBlockInfo:a,byesToPlace:o,structure:s}){var l;a||(a=_h({provisionalPositioning:t,appliedPolicies:i,drawDefinition:r,seedingProfile:n,structure:s}));let{isFeedIn:u,isLuckyStructure:c,isContainer:d}=a,{validSeedBlocks:p}=a;(l=i==null?void 0:i.seeding)!=null&&l.containerByesIgnoreSeeding&&(p=[]);let m=aDe({provisionalPositioning:t,drawDefinition:r,structure:s})??[],h=dt([].concat(...e.map(S=>S.drawPositions))),f=m.filter(S=>h.includes(S.drawPosition)),g=(S,w)=>pg(S.seedValue)-pg(w.seedValue),v=p.reduce((S,w)=>{let U=f.filter(T=>{var D;return(D=w.drawPositions)==null?void 0:D.includes(T.drawPosition)}).sort(g);return S.concat(...U)},[]).map(S=>S.drawPosition),y=oDe({orderedSortedFirstRoundSeededDrawPositions:v,validSeedBlocks:p,byesToPlace:o}),I=M2({orderedSeedDrawPositions:v,relevantMatchUps:e}).slice(0,o),b=M2({orderedSeedDrawPositions:y,relevantMatchUps:e}).slice(0,o);return{strictSeedOrderByePositions:I,blockSeedOrderByePositions:b,isLuckyStructure:c,positionedSeeds:m,isContainer:d,isFeedIn:u}}function M2({orderedSeedDrawPositions:t,relevantMatchUps:e}){let i=e.map(r=>r.drawPositions).map(r=>r==null?void 0:r.sort((n,a)=>n-a)).filter(r=>(r==null?void 0:r[0])+1===(r==null?void 0:r[1]));return t.map(r=>i.find(n=>n==null?void 0:n.includes(r))).filter(Boolean).map(r=>r==null?void 0:r.reduce((n,a)=>t.includes(a)?n:a,void 0)).filter(Boolean)}function lDe({provisionalPositioning:t,seedOrderByePositions:e,isLuckyStructure:i,appliedPolicies:r,drawDefinition:n,seedLimit:a,structure:o,isFeedIn:s}){var l,u;let c=(l=r==null?void 0:r.seeding)==null?void 0:l.seedingProfile,d=o.stage===Ke,{positionAssignments:p}=Mr({structure:o}),m=p==null?void 0:p.filter(O=>O.participantId).map(O=>O.drawPosition),h={isCollectionMatchUp:!1},{matchUps:f,roundMatchUps:g}=qt({provisionalPositioning:t,matchUpFilters:h,structure:o}),v=(g==null?void 0:g[1])||[],y=o.structureType===_n?f:v,I=dt([].concat(...y.map(O=>O.drawPositions))),b=Math.min(...I)-1,S=m==null?void 0:m.filter(O=>I.includes(O)),w=O=>{let k=Math.ceil(O.length/2),x=[O.slice(0,k),O.slice(k)],F=x.map(z=>[].concat(...z.flat(1/0)).length),$=Math.min(...F.flat(1/0)),_=Math.max(...F.flat(1/0)),L=F.indexOf(_),B=$!==_,V=Tn(x),[G,j]=!$||B?[x[L],x[1-L]]:[V[0],V[1]];return{greaterHalf:G,lesserHalf:j}},U=O=>{let{greaterHalf:k,lesserHalf:x}=w(O),{greaterHalf:F,lesserHalf:$}=w(k),_=Tn(F.flat(1/0)).pop(),L=F.flat().filter(B=>B!==_);return{newlyFilteredChunks:[...x,...$,L],drawPosition:_}},T=O=>!e.includes(O),D=O=>!(S!=null&&S.includes(O)),P=O=>{let k=Cr(O.sort(lr),Math.ceil(O.length/4)).map($=>$.filter(D)),x=[].concat(...k.flat(1/0)).length,F=[];for(let $=0;$<x;$++){let{newlyFilteredChunks:_,drawPosition:L}=U(k);F.push(L),k=_}return F},{validSeedBlocks:E}=_h({provisionalPositioning:t,allPositions:!0,appliedPolicies:r,drawDefinition:n,structure:o}),R=E==null?void 0:E.map(O=>{var k;return(k=O.drawPositions)==null?void 0:k.map(x=>x+b)}),N;if(s){let O=I.length,{seedBlocks:k}=LL({cluster:Aw(c)===DP,participantsCount:O});N=k.map(x=>x.map(F=>F+b)).map(P).filter(x=>x.length)}else d?N=R==null?void 0:R.map(O=>O.filter(D)):N=R==null?void 0:R.map(P).filter(O=>O.length);let A=y.map(O=>O.drawPositions).map(O=>O==null?void 0:O.sort((k,x)=>k-x)).filter(O=>(O==null?void 0:O[0])+1===(O==null?void 0:O[1])),M=O=>A.reduce((k,x)=>x.includes(O)?x.reduce((F,$)=>$!==O?$:F,void 0):k,void 0),C=N.map(O=>O.map(M)).flat(1/0).filter(D).filter(T).filter(Boolean);if(d&&!o.structures){let O=a%4,k=C.slice(0,O),x=(u=g[o.roundLimit])==null?void 0:u.length,F=Cr(C.slice(O),x).map(Tn).flat();C=k.concat(F)}return{unseededByePositions:C}}function uDe({provisionalPositioning:t,drawDefinition:e,matchUpsMap:i,structure:r,event:n}){var a;let o={isCollectionMatchUp:!1},{matchUps:s,roundMatchUps:l}=qt({afterRecoveryTimes:!1,provisionalPositioning:t,drawDefinition:e,matchUpFilters:o,matchUpsMap:i,structure:r,event:n}),u=(l==null?void 0:l[1])||[],c=(r==null?void 0:r.structureType)===_n,d=c?s:u,p=c?((a=r==null?void 0:r.structures)==null?void 0:a.length)||0:s.length,{structureId:m,stage:h,stageSequence:f}=r,g=Eh({entryStatuses:ds,provisionalPositioning:t,drawDefinition:e,stageSequence:f,structureId:m,stage:h}),{qualifiersCount:v}=Uv({provisionalPositioning:t,drawDefinition:e,stageSequence:f,structureId:m,stage:h}),y=g.length+v,{positionAssignments:I,unassignedPositions:b}=Mr({structure:r}),S=b==null?void 0:b.map(E=>E.drawPosition),w=I==null?void 0:I.filter(E=>E.bye).length,U=I==null?void 0:I.filter(E=>E.bye).map(E=>E.drawPosition),T=d.map(E=>E.drawPositions).filter(E=>E==null?void 0:E.reduce((R,N)=>!(U!=null&&U.includes(N))&&R,!0)).flat(1/0).filter(E=>S==null?void 0:S.includes(E)),D=I==null?void 0:I.length,P=D?D-y:0;return P>p&&r.stageSequence===1&&r.stage!==an&&(P=p),{placedByes:w,byesCount:P,relevantMatchUps:d,placedByePositions:U,roundMatchUps:l,positionsToAvoidDoubleBye:T}}function N2({provisionalPositioning:t,tournamentRecord:e,appliedPolicies:i,drawDefinition:r,seedBlockInfo:n,seedingProfile:a,matchUpsMap:o,structureId:s,structure:l,seedLimit:u,seedsOnly:c,event:d}){var p;l||({structure:l}=tt({drawDefinition:r,structureId:s})),s||(s=l==null?void 0:l.structureId);let m=!((l==null?void 0:l.structures)??(l==null?void 0:l.stage)===Ke),{byesCount:h,placedByes:f,relevantMatchUps:g}=uDe({provisionalPositioning:t,drawDefinition:r,matchUpsMap:o,structure:l,event:d}),v=h-(f||0);if(v<=0)return{...Q};let{strictSeedOrderByePositions:y,blockSeedOrderByePositions:I,isLuckyStructure:b,isFeedIn:S}=sDe({provisionalPositioning:t,relevantMatchUps:g,appliedPolicies:i,drawDefinition:r,seedingProfile:a,seedBlockInfo:n,byesToPlace:v,structure:l}),w=(l==null?void 0:l.structureType)&&[_n,PP].includes(l.structureType)&&((p=i==null?void 0:i.seeding)==null?void 0:p.containerByesIgnoreSeeding),U=m&&I!=null&&I.length?I:y,{unseededByePositions:T}=lDe({provisionalPositioning:t,seedOrderByePositions:U,isLuckyStructure:b,appliedPolicies:i,drawDefinition:r,seedLimit:u,structure:l,isFeedIn:S}),D=N=>N%2,P=(N,A)=>(N||[]).every(M=>D(M)?A!==M+1:A!==M-1),E=[].concat(...U);if(!c)for(;T.length;){let N=T.find(A=>P(E,A));N?(E.push(N),T=T.filter(A=>A!==N)):(E.push(...T),T=[])}w&&(E=Tn(E),ja({ignoreSeededByes:w})&&console.log({byePositions:E}));let R=E.slice(0,v);for(let N of R){let A=Za({provisionalPositioning:t,tournamentRecord:e,drawDefinition:r,drawPosition:N,matchUpsMap:o,structureId:s,structure:l,event:d});if(A!=null&&A.error)return A}return{...Q,unseededByePositions:T,byeDrawPositions:R}}function Ow(t){var e,i,r,n;let{drawDefinition:a}=t,{applyPositioning:o=!0,provisionalPositioning:s,multipleStructures:l,placeByes:u=!0,tournamentRecord:c,placementGroup:d,seedingProfile:p,structureId:m,seedLimit:h,seedsOnly:f,drawType:g,drawSize:v,event:y}=t,I=[];o||(z9(),a=Ne(a,!1,!0));let b=x=>(o||KU(),te({result:x,stack:"automatedPositioning"})),S=x=>(o||KU(),x),w=tt({drawDefinition:a,structureId:m});if(w.error)return b(w);let U=w.structure;if(!U)return{error:Ai};let T=t.appliedPolicies||((e=Bt({drawDefinition:a,structure:U,event:y}))==null?void 0:e.appliedPolicies),{qualifiersCount:D}=Uv({stageSequence:U.stageSequence,provisionalPositioning:s,stage:U.stage,drawDefinition:a,structureId:m}),P=Np;if(!((i=Eh({stageSequence:U.stageSequence,provisionalPositioning:s,stage:U.stage,placementGroup:d,drawDefinition:a,entryStatuses:P,structureId:m}))!=null&&i.length)&&!D)return S({...Q});let E=t.matchUpsMap??ln({drawDefinition:a}),R=t.inContextDrawMatchUps??((r=fr({inContext:!0,drawDefinition:a,matchUpsMap:E}))==null?void 0:r.matchUps),N=[],A=_h({provisionalPositioning:s,appliedPolicies:T,drawDefinition:a,seedingProfile:p,structure:U});if(A.error)return A;let{validSeedBlocks:M}=A;I.push({validSeedBlocks:M});let C=t.participants||(c?(n=Oi({withIndividualParticipants:!0,convertExtensions:!0,tournamentRecord:c}))==null?void 0:n.participants:[]);if(Aw(U.seedingProfile||p)===Yd){let x=u?N2({provisionalPositioning:s,tournamentRecord:c,appliedPolicies:T,drawDefinition:a,seedBlockInfo:A,matchUpsMap:E,structure:U,seedLimit:h,seedsOnly:f,event:y}):void 0;if(x!=null&&x.error)return b(x);N=x.unseededByePositions,I.push({action:"positionByes",unseededByePositions:N});let F=U.seedingProfile?{positioning:U.seedingProfile}:p;if(x=C2({seedingProfile:F,provisionalPositioning:s,inContextDrawMatchUps:R,tournamentRecord:c,appliedPolicies:T,validSeedBlocks:M,drawDefinition:a,seedBlockInfo:A,participants:C,matchUpsMap:E,structure:U,event:y}),x.error)return b(x);I.push({seedPositions:x.seedPositions,action:"positionSeedBlocks"})}else{if(g!==Pp){let F=U.seedingProfile?{positioning:U.seedingProfile}:p,$=C2({seedingProfile:F,provisionalPositioning:s,inContextDrawMatchUps:R,tournamentRecord:c,appliedPolicies:T,validSeedBlocks:M,drawDefinition:a,seedBlockInfo:A,participants:C,matchUpsMap:E,structure:U,event:y});if($.error)return b($);I.push({action:"positionSeedBlocks",seedPositions:$.seedPositions})}let x=u?N2({provisionalPositioning:s,tournamentRecord:c,appliedPolicies:T,drawDefinition:a,seedBlockInfo:A,matchUpsMap:E,structure:U,seedLimit:h,seedsOnly:f,event:y}):void 0;if(x!=null&&x.error)return b(x);N=x==null?void 0:x.unseededByePositions,I.push({action:"positionByes",byeDrawPositions:x==null?void 0:x.byeDrawPositions,unseededByePositions:N})}let O={};if(!f){let x=iDe({inContextDrawMatchUps:R,tournamentRecord:c,appliedPolicies:T,validSeedBlocks:M,drawDefinition:a,seedBlockInfo:A,participants:C,matchUpsMap:E,structure:U});if(x.error||(x.conflicts&&(O.qualifierConflicts=x.conflicts),I.push({action:"positionQualifiers",qualifierDrawPositions:x.qualifierDrawPositions}),x=eDe({provisionalPositioning:s,inContextDrawMatchUps:R,unseededByePositions:N,multipleStructures:l,tournamentRecord:c,drawDefinition:a,seedBlockInfo:A,participants:C,matchUpsMap:E,structureId:m,structure:U,drawSize:v,event:y}),x.error))return b(x);x.conflicts&&(O.unseededConflicts=x.conflicts),I.push({action:"positionUnseededParticipants"})}let{positionAssignments:k}=si({drawDefinition:a,structure:U});return ui({drawDefinition:a,structureIds:[m]}),o||KU(),{positionAssignments:k,conflicts:O,...Q,positioningReport:I}}function Dv(t){var e;let{applyPositioning:i=!0,provisionalPositioning:r,tournamentRecord:n,drawDefinition:a,seedingProfile:o,structureId:s,placeByes:l,seedsOnly:u}=t;if(!a)return{error:Va};if(!_c({drawDefinition:a,structureId:s})&&!r)return{error:Hx};let c=(e=HJ({drawDefinition:a,structureId:s}).playoffStructures)==null?void 0:e.sort((m,h)=>s0(m)-s0(h)),d=[],p=[];if(c)for(let m of c){let{structureId:h}=m,f=Ow({structureId:h,provisionalPositioning:r,applyPositioning:i,tournamentRecord:n,drawDefinition:a,seedingProfile:o,placeByes:l,seedsOnly:u});if(f.error)return f;f.positionAssignments&&d.push({positionAssignments:f.positionAssignments,structureId:h}),f.positioningReport&&p.push(f.positioningReport)}return{...Q,structurePositionAssignments:d,positioningReports:p}}function YJ({drawDefinition:t,orderMap:e}){return t?((typeof e!="object"||!Object.values(e).every(i=>st(i)))&&te({result:{error:se},context:{orderMap:e}}),t.structures||(t.structures=[]),t.structures.forEach(i=>{let r=e[i.structureId];r&&(i.structureOrder=r)}),t.structures.sort((i,r)=>Yf(i.structureOrder)-Yf(r.structureOrder)),{...Q}):{error:$e}}function aR({drawDefinition:t}){var e,i,r,n,a,o,s;let l=t.structures??[],u=t.links??[],c=new Map,d=U=>{let T=c.get(U)||c.set(U,{drawSources:[],drawTargets:[],progeny:[],sources:[],targets:[]})&&c.get(U);if(T&&!(T!=null&&T.stage)){let D=l.find(P=>P.structureId===U);T.stage=D==null?void 0:D.stage}return T},p={},m={},h=u.map(U=>{let T=U.source.structureId,D=U.target.structureId,P=d(T),E=d(D);return[Kd,$o,RP,Yd].includes(U.target.feedProfile)?(P==null||P.targets.push(D),E==null||E.sources.push(T)):U.target.feedProfile===gs&&(E==null||E.drawSources.push(T),P==null||P.drawTargets.push(D)),m[D]=m[D]||U.target.feedProfile===gs,p[D]=dt([...p[D]||[],T]).filter(Boolean),[U.source.structureId,U.target.structureId]});for(let U of c.keys()){let T=c.get(U);if(T){let D=T.targets??[];for(;D.length;){let P=D.pop(),E=P&&c[P];(e=E==null?void 0:E.targets)!=null&&e.length?D.push(...E.targets):E&&(T.rootStage=E.stage)}if(T.rootStage||(T.rootStage=T.stage),!((i=T.targets)!=null&&i.length)){let P=T.sources??[];for(;P.length;){let E=P.pop(),R=E&&c[E];if((r=R==null?void 0:R.sources)!=null&&r.length){for(let N of R.sources)(n=T.progeny)!=null&&n.includes(N)||(a=T.progeny)==null||a.push(N);P.push(...R.sources)}}}}}let f=0;for(let U of c.keys()){let T=c.get(U);if(T&&T.rootStage===Ke){let D=[(o=T.drawTargets)==null?void 0:o[0]],P=0;for(;D.length;){P+=1;let E=D.pop(),R=E?c.get(E):void 0;(s=R==null?void 0:R.drawTargets)!=null&&s.length&&D.push(R.drawTargets[0])}T.distanceFromMain=P,P>f&&(f=P)}}let g=h.length;Te(0,Math.ceil(g/2)).forEach(()=>{h=Te(0,g).map(U=>{let T=h[U],D=h.reduce((P,E)=>Nn(T,E)?P.concat(...E):P,[])||[];return dt(T.concat(...D))})});let v=h[0],y=(U,T)=>ji(U,T).length===U.length,I=h.slice(1).reduce((U,T)=>U&&y(T,v),!0),b=[v].filter(Boolean),S=[v].filter(Boolean);l.forEach(U=>{let{structureId:T,stage:D}=U;b.find(P=>P.includes(T))||(b.push([T]),D!==Lr&&S.push([T]))});let w=I&&S.length===1;return!(u!=null&&u.length)&&l.length===1&&d(l[0].structureId),{structureProfiles:Object.fromEntries(c),allStructuresLinked:w,maxQualifyingDepth:f,sourceStructureIds:p,hasDrawFeedProfile:m,structureGroups:b}}function KJ({drawDefinition:t}){let{maxQualifyingDepth:e,structureProfiles:i}=aR({drawDefinition:t});for(let r of t.structures){let n=i[r.structureId];n.distanceFromMain&&(r.stageSequence=e+1-n.distanceFromMain)}return{...Q}}function WL(t){let e=We(t,[{[Ur]:!0,[$n]:!0}]);if(e.error)return e;let{tournamentRecord:i,drawDefinition:r,structure:n,link:a}=t;return cDe({tournamentId:i.tournamentId,drawDefinition:r,structure:n,link:a})}function cDe(t){var e;let i=We(t,[{[$n]:!0,[AP]:!0},{link:!0,[Jn]:ta,[OK]:Kx}]);if(i.error)return i;let{drawDefinition:r,tournamentId:n,structure:a,eventId:o,link:s}=t,l=s.target.structureId,u=tt({drawDefinition:r,structureId:l});if(u.error)return te({stack:"attachQualifyingStructure",context:{targetStructureId:l},result:u});r.structures||(r.structures=[]),r.links||(r.links=[]),r.structures.push(a),r.links.push(s),KJ({drawDefinition:r});let c=((e=qt({structure:a}))==null?void 0:e.matchUps)||[];return xc({drawDefinition:r,tournamentId:n,matchUps:c,eventId:o}),ui({drawDefinition:r,structureIds:[a.structureId]}),{...Q}}function XJ({drawDefinition:t,structureDetails:e}){if(!Array.isArray(e))return{error:se};if(!t)return{error:$e};let i=Object.assign({},...e.map(r=>{if(!At(r))return;let{structureId:n,structureName:a}=r||{};if(!(!n||!a))return{[n]:a}}).filter(Boolean));if(!Object.values(i).length)return{error:Je};for(let r of t.structures||[]){let n=i[r.structureId];if(n&&(r.structureName=n),r.structures)for(let a of r.structures){let o=i[a.structureId];o&&(a.structureName=o)}}return{...Q}}function qL({drawDefinition:t,timeItem:e}){if(!t)return{error:Va};if(!e)return{error:cF};let i=e&&Object.keys(e),r=["itemType","itemValue"];if(r.filter(a=>i.includes(a)).length!==r.length)return{error:uF};t.timeItems||(t.timeItems=[]);let n=new Date().toISOString();return Object.assign(e,{createdAt:n}),t.timeItems.push(e),uw({drawDefinition:t}),{...Q}}function JJ(t){var e;let{tournamentRecord:i,drawDefinition:r,structureId:n,event:a}=t,o=We(t,[{drawDefinition:!0,structureId:!0}]);if(o.error)return o;let s=r.structures??[],l=s.find(y=>y.structureId===n);if(!l)return{error:Ai};let u=s.find(({stage:y,stageSequence:I})=>y===Ae&&I===1),c=n===(u==null?void 0:u.structureId),d=s.filter(({stage:y})=>y===Ke).map(Ma("structureId"));if(c&&!d.length)return{error:xK};let p=d.includes(n),m=dDe({isQualifyingStructure:p,structure:l,...t});if(m!=null&&m.error)return m;let{structureIdsToRemove:h,relatedStructureIdsMap:f}=mDe({qualifyingStructureIds:d,isQualifyingStructure:p,isMainStageSequence1:c,mainStageSequence1:u,drawDefinition:r,structureId:n}),{removedMatchUpIds:g,removedStructureIds:v}=hDe({relatedStructureIdsMap:f,qualifyingStructureIds:d,isMainStageSequence1:c,mainStageSequence1:u,drawDefinition:r,structureIdsToRemove:h,structureId:n});if(pDe({removedMatchUpIds:g,drawDefinition:r}),c){let y=(e=u.matchUps??[])==null?void 0:e.map(Ma("matchUpId"));g.push(...y),u.positionAssignments=[],u.seedAssignments=[],u.matchUps=[],u.extensions&&(u.extensions=[])}return p&&KJ({drawDefinition:r}),Zu({tournamentId:i==null?void 0:i.tournamentId,matchUpIds:g,action:"removeStructure",eventId:a==null?void 0:a.eventId,drawDefinition:r}),ui({drawDefinition:r,eventId:a==null?void 0:a.eventId}),{...Q,removedMatchUpIds:g,removedStructureIds:v}}function dDe({isQualifyingStructure:t,tournamentRecord:e,drawDefinition:i,structureId:r,structure:n,event:a,force:o}){var s,l,u,c,d,p;let m=[r];if(t){let h=g=>{var v;return(v=i.links)==null?void 0:v.find(y=>y.target.structureId===g)},f=(s=h(r))==null?void 0:s.source.structureId;for(;f;)m.push(f),f=(l=h(f))==null?void 0:l.source.structureId}if((u=fr({matchUpFilters:{structureIds:m},drawDefinition:i}).matchUps)!=null&&u.some(({score:h})=>br({score:h}))){let h=(c=Bt({tournamentRecord:e,drawDefinition:i,structure:n,event:a}))==null?void 0:c.appliedPolicies;if(!(o??((p=(d=h==null?void 0:h[fo])==null?void 0:d.allowDeletionWithScoresPresent)==null?void 0:p.structures)))return{error:IP}}return{...Q}}function pDe({removedMatchUpIds:t,drawDefinition:e}){let{matchUps:i}=fr({drawDefinition:e});i==null||i.forEach(r=>{r.winnerMatchUpId&&t.includes(r.winnerMatchUpId)&&delete r.winnerMatchUpId,r.loserMatchUpId&&t.includes(r.loserMatchUpId)&&delete r.loserMatchUpId})}function mDe({qualifyingStructureIds:t,isQualifyingStructure:e,isMainStageSequence1:i,mainStageSequence1:r,drawDefinition:n,structureId:a}){let o=(n.structures??[]).map(Ma("structureId")),s=c=>{var d;return((d=n.links)==null?void 0:d.map(p=>p.source.structureId===c&&p.target.structureId!==(r==null?void 0:r.structureId)&&p.target.structureId).filter(Boolean))??[]},l=c=>{var d;return((d=n.links)==null?void 0:d.map(p=>t.includes(p.source.structureId)&&p.target.structureId===c&&p.source.structureId).filter(Boolean))??[]},u=new Map;return o.forEach(c=>u.set(c,e?l(c):s(c))),{structureIdsToRemove:i?u.get(a):[a],relatedStructureIdsMap:u}}function hDe({relatedStructureIdsMap:t,qualifyingStructureIds:e,isMainStageSequence1:i,mainStageSequence1:r,drawDefinition:n,structureIdsToRemove:a,structureId:o}){let s=[],l=[];for(;a!=null&&a.length;){let u=a.pop();l.push(...vDe({idBeingRemoved:u,drawDefinition:n}));let c=gDe({qualifyingStructureIds:e,isMainStageSequence1:i,idBeingRemoved:u,drawDefinition:n,structureId:o});s.push(...c.removedStructureIds);let d=fDe({relatedStructureIdsMap:t,mainStageSequence1:r,idBeingRemoved:u,structureId:o});d!=null&&d.length&&a.push(...d)}return{removedMatchUpIds:l,removedStructureIds:s}}function fDe({idBeingRemoved:t,relatedStructureIdsMap:e,mainStageSequence1:i,structureId:r}){var n;return t&&((n=e.get(t))==null?void 0:n.filter(a=>a!==(i==null?void 0:i.structureId)||r===i.structureId))}function gDe({qualifyingStructureIds:t,isMainStageSequence1:e,idBeingRemoved:i,drawDefinition:r,structureId:n}){var a;let o=[];return r.links=((a=r.links)==null?void 0:a.filter(s=>s.source.structureId!==i&&s.target.structureId!==i))??[],(!e||e&&t.length||i!==n)&&(r.structures=(r.structures??[]).filter(s=>(i&&i===s.structureId&&o.push(i),s.structureId!==i))),{removedStructureIds:o}}function vDe({idBeingRemoved:t,drawDefinition:e}){let{structure:i}=tt({structureId:t,drawDefinition:e}),r=qt({structure:i}).matchUps;return qF(r)}function g0({stageSequence:t=1,drawDefinition:e,drawSize:i,stage:r}){if(!e)return{error:$e};if(!IL({drawDefinition:e,stage:r}))return{error:Dp};let n=I0e({drawDefinition:e,stage:r}),{qualifiersCount:a}=Uv({drawDefinition:e,stageSequence:t,stage:r}),o=n+a;if(i<o)return{error:Yx};let{entryProfile:s}=vL({attributes:[{[r]:{drawSize:i}}],drawDefinition:e});return ui({drawDefinition:e}),{...Q,entryProfile:s}}function QJ({qualifiersCount:t=0,drawDefinition:e,stage:i}){return e?IL({drawDefinition:e,stage:i})?i!==Ae?{error:Yx,info:"qualifiersCount can only be set for main stage"}:(vL({attributes:[{[i]:{qualifiersCount:t}}],drawDefinition:e}),ui({drawDefinition:e}),{...Q}):{error:Dp}:{error:$e}}function IDe({drawDefinition:t,drawSize:e}){if(!t)return{error:$e};let i=g0({stage:Lr,stageSequence:1,drawDefinition:t,drawSize:e});return i.error?i:(ui({drawDefinition:t}),{...Q})}function ZJ(t){return IDe(t)}var yDe="qualifierDrawPositionAssignment",bDe="withdrawParticipantAtDrawPosition",wDe="alternateDrawPositionAssignment",UDe="luckyLoserDrawPositionAssignment",A2="removeDrawPositionAssignment",eQ="swapDrawPositionAssignments",SDe="modifyPairAssignment",TDe="adHocPositionSwap",DDe="modifyParticipantOtherName",O2="assignDrawPosition",PDe="removeSeededParticipant",RDe="assignDrawPositionBye",EDe="modifySeedAssignment",tQ="addPenalty",YL="MODIFY_PAIR",oR="QUALIFIER",KL="ALTERNATE",XL="WITHDRAW",_m="ASSIGN",AM="REMOVE",JL="LUCKY",sI="REMOVE_SEED",sR="SWAP",hy="NICKNAME",cm="SEED_VALUE",$m="PENALTY",v0="BYE",CDe={MODIFY_PAIR_ASSIGNMENT:YL,QUALIFYING_PARTICIPANT:oR,ALTERNATE_PARTICIPANT:KL,WITHDRAW_PARTICIPANT:XL,ASSIGN_PARTICIPANT:_m,LUCKY_PARTICIPANT:JL,REMOVE_ASSIGNMENT:AM,SWAP_PARTICIPANTS:sR,ADD_NICKNAME:hy,REMOVE_SEED:sI,ADD_PENALTY:$m,ASSIGN_BYE:v0,SEED_VALUE:cm};function iQ({tournamentRecord:t,drawDefinition:e,drawPositions:i,structureId:r,event:n}){if(!e)return{error:$e};if(!r)return{error:Xa};if((i==null?void 0:i.length)!==2)return{error:se,drawPositions:i};let a=ln({drawDefinition:e}),{matchUps:o}=fr({inContext:!0,drawDefinition:e,matchUpsMap:a}),{structure:s}=tt({drawDefinition:e,structureId:r});if(!s)return{error:Ai};let l=Bt({tournamentRecord:t,drawDefinition:e,event:n}).appliedPolicies??{},u;if(s.structureType===_n?u=ADe({inContextDrawMatchUps:o,tournamentRecord:t,drawDefinition:e,drawPositions:i,matchUpsMap:a,structure:s,event:n}):u=MDe({inContextDrawMatchUps:o,tournamentRecord:t,drawDefinition:e,drawPositions:i,matchUpsMap:a,structure:s,event:n}),u.error)return u;if(dL({structure:s,drawPositions:i}),GP({appliedPolicies:l,drawDefinition:e,positionAction:{name:eQ,drawPositions:i,structureId:r}}),Fc({tournamentId:t==null?void 0:t.tournamentId,drawDefinition:e,structure:s,event:n}),n.eventType===Ea){let c=qt({matchUpFilters:{matchUpTypes:[Ba]},inContext:!0,structure:s}).matchUps.filter(p=>{var m;return(m=p.drawPositions)==null?void 0:m.some(h=>i.includes(h))}),d=qt({matchUpFilters:{matchUpTypes:[Ba]},structure:s}).matchUps;c.forEach(p=>{(p.sides||[]).forEach(m=>{var h;let f=m==null?void 0:m.drawPosition;if(i.includes(f)){let g=m.participantId,v=d.find(({matchUpId:I})=>I===p.matchUpId),y=(h=p==null?void 0:p.sides)==null?void 0:h.reduce((I,b,S)=>b.drawPosition===f?S:I,void 0);BL({inContextTargetMatchUp:p,drawPositionSideIndex:y,teamParticipantId:g,tournamentRecord:t,drawDefinition:e,matchUp:v,event:n})}})})}return ui({drawDefinition:e,structureIds:[r]}),{...Q}}function MDe({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPositions:r,matchUpsMap:n,structure:a,event:o}){let s=a==null?void 0:a.positionAssignments.filter(u=>r==null?void 0:r.includes(u.drawPosition));if(!s)return{error:se,structure:a,info:"Missing positionAssignments"};if(s.filter(({bye:u})=>u).length===2)return{...Q};if(s.filter(({qualifier:u})=>u).length===2)return{...Q};let l=s.some(({qualifier:u})=>u);return s.some(({bye:u})=>u)&&!l?rQ({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:s,matchUpsMap:n,structure:a,event:o}):NDe({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:s,matchUpsMap:n,structure:a,event:o})}function rQ({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:r,matchUpsMap:n,structure:a,event:o}){let s=r.find(({bye:h})=>h),l=r.find(({participantId:h})=>h),u=s.drawPosition,{participantId:c,drawPosition:d}=l,{structureId:p}=a,m=my({drawPosition:u,inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:p,matchUpsMap:n});return m.error||(m=my({drawPosition:d,inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:p,matchUpsMap:n}),m.error)||(Za({drawPosition:d,tournamentRecord:e,drawDefinition:i,structureId:p,matchUpsMap:n,event:o}),m=cl({drawPosition:u,inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:p,participantId:c,matchUpsMap:n,event:o}),m.error)?m:{...Q}}function NDe({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:r,matchUpsMap:n,structure:a,event:o}){let s=Object.assign({},...r.map((l,u)=>{let{drawPosition:c}=l,d={...r[1-u],drawPosition:c};return{[c]:d}}));return a.positionAssignments=a.positionAssignments.map(l=>s[l.drawPosition]||l),jL({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,matchUpsMap:n,assignments:r,structure:a,event:o}),{...Q}}function ADe({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPositions:r,matchUpsMap:n,structure:a,event:o}){var s;let l=(s=a.structures)==null?void 0:s.reduce((c,d)=>{let p=d==null?void 0:d.positionAssignments.filter(m=>r==null?void 0:r.includes(m.drawPosition));return p&&c.push(...p),c},[]);if(l.filter(({bye:c})=>c).length===2)return{...Q};if(l.filter(({qualifier:c})=>c).length===2)return{...Q};jL({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,matchUpsMap:n,assignments:l,structure:a,event:o});let u=l.some(({qualifier:c})=>c);if(l.some(({bye:c})=>c)&&!u)rQ({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:l,matchUpsMap:n,structure:a,event:o});else{let c=Ne(l,!1,!0);l.forEach((d,p)=>{let m=c[1-p].participantId;d.qualifier=c[1-p].qualifier,d.participantId=m})}return{...Q}}function nQ({tournamentRecord:t,drawDefinition:e,participantId:i,structureId:r}){var n;let a="removeSeededParticipant";if(!t)return{error:ve};if(!e)return{error:$e};let o=(e.structures??[]).find(s=>s.structureId===r);return o?!o.stage||![Ae,Ke].includes(o.stage)||o.stage===Ae&&o.stageSequence!==1?te({result:{error:Sp},stack:a}):(n=o.seedAssignments)!=null&&n.find(s=>s.participantId===i)?{...Q}:te({info:"participant not seeded",result:{error:jr},context:{participantId:i}}):te({result:{error:Ai},stack:a})}function kw({targetEntryRound:t=1,finishingPositions:e,sourceRoundNumber:i,sourceStructureId:r,targetStructureId:n,linkType:a=ku}){return!r||!n?{error:Xa}:{link:He({linkType:a,source:{roundNumber:i,structureId:r,finishingPositions:e},target:{feedProfile:gs,roundNumber:t,structureId:n}})}}function QL({roundPosition:t,roundNumber:e,idPrefix:i,uuids:r}){return i?`${i}-${e}-${t}`:(r==null?void 0:r.pop())||Ht()}function I0({includeMatchUpType:t,matchUpType:e,roundNumber:i,matchUps:r,idPrefix:n,isMock:a,uuids:o,nodes:s}){let l=0,u=[],c=1,d=i-1,p=s==null?void 0:s.length;for(;l<(p||0);){let m=s==null?void 0:s[l],h=s==null?void 0:s[l+1];d&&(m.roundNumber=d),h&&d&&(h.roundNumber=d);let f=QL({roundPosition:c,roundNumber:i,idPrefix:n,uuids:o}),g={roundPosition:c,children:[m,h],matchUpId:f};u.push(g);let v={drawPositions:g.children.map(y=>y==null?void 0:y.drawPosition).filter(Boolean),matchUpStatus:Qi,matchUpId:g.matchUpId,roundPosition:c,roundNumber:i};t&&e&&(v.matchUpType=e),a&&(v.isMock=!0),r.push(v),c++,l+=2}return{roundNodes:u,matchUps:r}}function dl({finishingPositionOffset:t,finishingPositionLimit:e,qualifyingRoundNumber:i,qualifyingPositions:r,matchUpType:n,roundLimit:a,idPrefix:o,drawSize:s,isMock:l,uuids:u}){if(isNaN(s)||s<2||r&&s<=r)return{matchUps:[],roundsCount:0};if(r&&(!Cs(s)||s%r)){let g=r;for(;g<s;)g=2*g;s=g}let c=r&&!(s%2)&&(!isNaN(r)||i&&!isNaN(i))&&(s/r===Math.round(s/r)||i&&s/i===Math.round(s/i));if(!Cs(s)&&!c)return{matchUps:[],roundsCount:0};let d=Te(1,s+1).map(g=>({drawPosition:g})),p,m=[],h=1;for({roundNodes:p,matchUps:m}=I0({matchUpType:n,roundNumber:h,idPrefix:o,matchUps:m,isMock:l,nodes:d,uuids:u}),h++,a=a??i;p.length>1;)r&&p.length===r&&(a=h-1),{roundNodes:p,matchUps:m}=I0({nodes:p,matchUpType:n,roundNumber:h,idPrefix:o,matchUps:m,isMock:l,uuids:u}),h++;let f=h-1;return m=Sw({finishingPositionOffset:t,finishingPositionLimit:e,roundsCount:f,roundLimit:a,matchUps:m}),a?m=m.filter(g=>a&&(g.roundNumber??0)<=a):a=h-1,{drawSize:s,matchUps:m,roundsCount:f,roundLimit:a}}function ZL(t){var e,i,r,n,a,o;let s="generateQualifyingStructure";if(!t.drawDefinition)return te({result:{error:$e},stack:s});if(t.drawSize&&!st(t.drawSize)||t.participantsCount&&!st(t.participantsCount)||t.qualifyingPositions&&!st(t.qualifyingPositions))return te({result:{error:se},stack:s});let l=t.drawSize??jx(t.participantsCount),{qualifyingRoundNumber:u,qualifyingPositions:c,targetStructureId:d,structureOptions:p,appliedPolicies:m,drawDefinition:h,matchUpFormat:f,structureName:g,structureId:v,roundTarget:y,drawType:I,idPrefix:b,isMock:S,uuids:w}=t;if(!t.drawSize)return te({result:{error:Yb},context:{drawSize:l},stack:s});if(c&&c>=t.drawSize)return te({result:{error:se},context:{drawSize:l,qualifyingPositions:c},stack:s});let U,T,D,P,E=0,R,N=1,{structureProfiles:A}=aR({drawDefinition:h}),M=A[d];if(!M)return te({result:{error:Ai},context:{targetStructureId:d},stack:s});let C=h.matchUpType,O=y?`${y}-`:"",k=M.stage===Ke,x=((i=(e=m==null?void 0:m[sg])==null?void 0:e.namingConventions)==null?void 0:i.pre)??((n=(r=U0e[sg])==null?void 0:r.namingConventions)==null?void 0:n.pre),F=k&&x?`${x}-`:"",$=g??(O?`${F}${tn(Ke)} ${O}`:`${F}${tn(Ke)}`);if(I===is){let{maxRoundNumber:B,structures:V,groupCount:G}=Mw({structureName:g??$,structureId:v??(w==null?void 0:w.pop()),stage:Ke,structureOptions:p,appliedPolicies:m,stageSequence:N,matchUpType:C,roundTarget:y,idPrefix:b,drawSize:l,isMock:S,uuids:w});E=G,U=B,D=V[0],R=[1]}else({drawSize:l,matchUps:P,roundLimit:U,roundsCount:T}=dl({qualifyingRoundNumber:u,qualifyingPositions:c,matchUpType:C,idPrefix:b,drawSize:l,isMock:S,uuids:w})),U||(U=T),D=so({structureName:g??$,structureId:v??(w==null?void 0:w.pop()),qualifyingRoundNumber:U,stage:Ke,matchUpFormat:f,stageSequence:N,matchUpType:C,roundLimit:U,matchUps:P}),y&&_t({extension:{name:yl,value:y},element:D}),E=(a=P==null?void 0:P.filter(B=>B.roundNumber===U))==null?void 0:a.length;let _=I===is?Ou:ku,L=D&&U&&((o=kw({sourceStructureId:D.structureId,sourceRoundNumber:U,targetStructureId:d,finishingPositions:R,linkType:_}))==null?void 0:o.link);return{qualifyingDrawPositionsCount:l,qualifiersCount:E,...Q,structure:D,link:L}}function aQ(t){if(!t.tournamentRecord)return{error:ve};let e=ODe(t);return e.error,e}function ODe(t){if(!t.drawDefinition)return{error:$e};if(!t.targetStructureId)return{error:Xa};let e=ZL(t);if(e.error)return e;let{structure:i,link:r}=e;return!i||!r?{error:se}:WL({tournamentRecord:t.tournamentRecord,drawDefinition:t.drawDefinition,structure:i,link:r})}function oQ(t){var e;let i=We(t,[{[$n]:!0,[CP]:!0,[Il]:!0},{[SSe]:!0,[Xr]:p=>Number.isInteger(p)&&p>0},{[Xr]:p=>Array.isArray(p)&&p.length===2&&p.every(Di),[Ha]:ya,participantIds:!0}]);if(i.error)return i;let{drawDefinition:r,structureId:n,tournamentRecord:a,event:o}=t,{structure:s}=tt({drawDefinition:r,structureId:n});if(!s)return{error:Ai};if(!Yn({structure:s}))return{error:Sp};let l=p=>{var m;return(m=p.sides)==null?void 0:m.map(h=>h.participantId).some(h=>t.participantIds.includes(h))},u=p=>p.roundNumber===t.roundNumber,c=p=>!br(p),d=((s==null?void 0:s.matchUps)??[]).filter(u).filter(c).filter(l);if(d.length!==2)return{error:ya};for(let p of d){let m=(e=p==null?void 0:p.sides)==null?void 0:e.find(h=>t.participantIds.includes(h==null?void 0:h.participantId));if(m){let h=t.participantIds.find(f=>f!==(m==null?void 0:m.participantId));m.participantId=h,Et({tournamentId:a==null?void 0:a.tournamentId,eventId:o==null?void 0:o.eventId,drawDefinition:r,matchUp:p})}}return ui({drawDefinition:r,structureIds:[n]}),{...Q}}function kDe({includeMatchUpType:t,drawPosition:e,roundNumber:i,matchUpType:r,idPrefix:n,matchUps:a,isMock:o,uuids:s,nodes:l,fed:u}){let c=l.length,d=e?e-c:void 0,p=Te(0,c).map(f=>d?d+f:void 0),m=[];for(let f=0;f<c;f++){let g=p.shift(),v={drawPosition:g,fed:u+1,feed:!0},y=l[f];y.roundNumber=i-1;let I=QL({roundPosition:y.roundPosition,roundNumber:i,idPrefix:n,uuids:s}),b={roundPosition:y.roundPosition,drawPositions:[g],matchUpStatus:Qi,roundNumber:i,matchUpId:I};t&&(b.matchUpType=r),o&&(b.isMock=!0),a.push(b);let S={children:[y,v]};m.push(S)}let h=e?e-c:void 0;return{roundNodes:m,matchUps:a,drawPosition:h}}function $c(t){let e=t.drawSize,{feedRoundsProfile:i,feedRounds:r=0,skipRounds:n=0,baseDrawSize:a}=t,{linkFedFinishingRoundNumbers:o,finishingPositionOffset:s,linkFedRoundNumbers:l,feedsFromFinal:u,isConsolation:c,matchUpType:d,idPrefix:p,isMock:m,uuids:h,fmlc:f}=t;a=a??A(e);let g=xDe({drawSize:a}),v=g.length,y=0;if(i!=null&&i.length)y=i.reduce((M,C)=>M+C,0);else if(e){let M=e-a;i=g.filter(C=>C<=M?(M-=C,!0):!1),y=i.reduce((C,O)=>C+O,0),r=i.length}else n>=v?r=0:u&&(r=v-u,n=0),i=g.filter((M,C)=>u&&!r||r&&C>=n+r||C<n?0:M),y=i.reduce((M,C)=>M+C,0),r=i.length;let I=[...g,...i].sort((M,C)=>C-M),b=I.length,S=[...(l??[]).map(M=>M-1),...(o??[]).map(M=>b-M)].map(M=>I[M]).reduce((M,C)=>M+C,0);y=y-S;let w=0,U=[],T,D=1,P=Te(0,a).map((M,C)=>({drawPosition:C+1+y})),E=y+1;for(let M of g){if({roundNodes:T,matchUps:U}=I0({matchUpType:d,roundNumber:D,idPrefix:p,matchUps:U,isMock:m,nodes:P,uuids:h}),D++,i.includes(M)){let C=Pa(i)[M],O=Te(0,C),k=b+1-D,x=(o==null?void 0:o.includes(k))??(l==null?void 0:l.includes(D));O.forEach(()=>{({roundNodes:T,matchUps:U,drawPosition:E}=kDe({drawPosition:!x&&E||void 0,nodes:T,matchUpType:d,roundNumber:D,idPrefix:p,matchUps:U,isMock:m,uuids:h,fed:w})),D++,w+=1})}P=T}b!==D-1&&console.log("ERROR");let R=a-y;U=Sw({finishingPositionOffset:c?R:s,positionsFed:y,roundsCount:b,matchUps:U,fmlc:f});let N=T!=null&&T.length?T[0]:T;return N&&(N.roundNumber=D-1,N.matchUps=U),{draw:N,matchUps:U,roundsCount:b};function A(M){let C=Gx(M);return C>M?C/2:C}}function xDe({drawSize:t}){let e=Math.ceil(Math.log(t)/Math.log(2));return Te(0,e).reverse().map(i=>Math.pow(2,i))}function wf(t){let{finishingPositionOffset:e=0,addNameBaseToAttributeName:i,playoffStructureNameBase:r,finishingPositionNaming:n,finishingPositionLimit:a,playoffAttributes:o,stageSequence:s=1,exitProfile:l="0",exitProfileLimit:u,roundOffsetLimit:c,roundOffset:d=0,drawDefinition:p,staggeredEntry:m,sequenceLimit:h,stage:f=Ae,drawSize:g,idPrefix:v,isMock:y,uuids:I}=t;if(!(!o||!u||o!=null&&o[l])||g<2||h&&s>h)return{};let b=[],S=[],w=[],U=t.matchUpType??(p==null?void 0:p.matchUpType),T=e+1,D=e+g,P=`${T}-${D}`,E=o==null?void 0:o[l],R=r&&`${r} `||"",N=(o==null?void 0:o[P])??(n==null?void 0:n[P]),A=t.structureName||(N==null?void 0:N.name)||(E==null?void 0:E.name)&&(i?`${R}${E==null?void 0:E.name}`:E.name)||`${R}${P}`,M=(N==null?void 0:N.abbreviation)??(E==null?void 0:E.abbreviation),C=t.structureId??(E==null?void 0:E.structureId)??(I==null?void 0:I.pop()),O={idPrefix:v&&`${v}-${A}-RP`,finishingPositionOffset:e,matchUpType:U,drawSize:g,isMock:y,uuids:I},{matchUps:k}=m?$c(O):dl(O),x=so({structureAbbreviation:M,stageSequence:s,structureName:A,matchUpType:U,roundOffset:d,structureId:C,matchUps:k,stage:f});b.push(...k),S.push(x);let F=Math.ceil(Math.log(g)/Math.log(2)),$=c?Math.min(c-d,F):(!a||T<a)&&F||0;return g>2&&Te(1,$+1).forEach(L=>_(L)),{structureId:x.structureId,matchUps:b,structureName:A,structures:S,links:w,...Q};function _(L){let B=g/Math.pow(2,L);if(B<2)return;let V=g/Math.pow(2,L)+e;if(a&&V+1>a)return;let{structures:G,structureId:j,matchUps:z,links:W}=wf({finishingPositionOffset:V,exitProfile:`${l}-${L}`,roundOffset:d+L,stageSequence:s+1,drawSize:B,addNameBaseToAttributeName:i,playoffStructureNameBase:r,finishingPositionNaming:n,finishingPositionLimit:a,playoffAttributes:o,exitProfileLimit:u,roundOffsetLimit:c,drawDefinition:p,sequenceLimit:h,matchUpType:U,idPrefix:v,uuids:I,stage:f});if(x.structureId&&j){let q={linkType:Yl,source:{roundNumber:L,structureId:x.structureId},target:{roundNumber:1,feedProfile:$o,structureId:j}};W&&x&&W.push(q),W!=null&&W.length&&w.push(...W)}return G!=null&&G.length&&S.push(...G),z!=null&&z.length&&b.push(...z),{structureId:j,childLinks:W,structures:S}}}function e_({drawDefinition:t,matchUpsMap:e,structureId:i}){let r=tt({drawDefinition:t,structureId:i});if(r.error)return te({result:r});let{matchUps:n}=qt({structure:r.structure,matchUpsMap:e});return{...An({matchUps:n}),matchUps:n,matchUpsMap:e}}function k2({finishingPositions:t,drawDefinition:e,structureId:i}){var r;let{roundProfile:n}=e_({drawDefinition:e,structureId:i});return(r=n&&Object.keys(n))==null?void 0:r.reduce((a,o)=>(sQ(n==null?void 0:n[o]).forEach(s=>{t.forEach(l=>{FDe({position:l,rangeDefinition:s})&&(a[l]={roundNumber:o})})}),a),{})}function FDe({position:t,rangeDefinition:e}){if(!Array.isArray(e)||e.reduce((n,a)=>n||isNaN(a),!1))return!1;let[i,r]=e;return Te(i,(r||i)+1).includes(t)}function sQ(t){var e,i;return[dt(((e=t==null?void 0:t.finishingPositionRange)==null?void 0:e.loser)||[]),dt(((i=t==null?void 0:t.finishingPositionRange)==null?void 0:i.winner)||[])]}function LDe(t){return sQ(t).map(e=>Te(e[0],e[1]&&e[1]+1||e[0]+1))}function Pv({drawDefinition:t,structureIds:e,matchUpsMap:i}){if(e&&!Array.isArray(e))return{error:se,context:{structureIds:e}};if(!t)return{error:$e};e=e??(t.structures??[]).filter(a=>a.stage!==Ke).map(({structureId:a})=>a);let r=e.map(a=>{var o;let{roundProfile:s}=e_({drawDefinition:t,matchUpsMap:i,structureId:a});return(o=s&&Object.values(s))==null?void 0:o.map(LDe).flat()}).flat(),n=r.filter(a=>(a==null?void 0:a.length)===1).sort(lr).flat();return{positionsNotPlayedOff:dt(r.flat()).filter(a=>!n.includes(a)),positionsPlayedOff:n}}function lQ({excludeRoundNumbers:t=[],playoffPositions:e=[],drawDefinition:i,structureId:r}){if(!i)return{error:$e};if(!r)return{error:Xa};if(!e)return{error:Je,info:"missing playoffPositions"};let n=Pv({drawDefinition:i});if(n.error)return n;let a=n.positionsPlayedOff,o=e.filter(v=>!a.includes(v)),s=k2({finishingPositions:o,drawDefinition:i,structureId:r}),l=Object.values(s).reduce((v,y)=>v.includes(y.roundNumber)?v:v.concat(y.roundNumber),[]).map(v=>Ze(v)).filter(v=>!t.includes(v)),u=k2({finishingPositions:a,drawDefinition:i,structureId:r}),c=u?Object.values(u):[],d=u?c.reduce((v,y)=>v.includes(y.roundNumber)?v:v.concat(y.roundNumber),[]).map(v=>Ze(v)):[],p=l.filter(v=>!d.includes(v)).sort(lr),{roundProfile:m}=e_({drawDefinition:i,structureId:r}),h=p.map(v=>{let y=m==null?void 0:m[v].finishingPositionRange.loser,[I,b]=y??[0,0];return Te(I,(b||I)+1)}).flat().sort(lr),{playoffRoundsRanges:f}=_De({playoffSourceRounds:p,roundProfile:m}),g=[...p,...d];return{playoffPositionsReturned:h,playedOffSourceRounds:d,playoffRoundsRanges:f,playoffSourceRounds:p,sourceRounds:g,roundProfile:m}}function _De({playoffSourceRounds:t,roundProfile:e}){return{playoffRoundsRanges:t.map(i=>{let r=e[i].finishingPositionRange.loser,[n,a]=r,o=Te(n,(a||n)+1);return{finishingPositionRange:r.join("-"),finishingPositions:o,roundNumber:i}})}}function xw({drawDefinition:t,structureId:e}){if(!t)return{error:$e};let{matchUps:i,matchUpsMap:r}=Pn({inContext:!0,drawDefinition:t}),{positionsNotPlayedOff:n,positionsPlayedOff:a}=Pv({drawDefinition:t,matchUpsMap:r}),{structures:o}=ns({drawDefinition:t}),s=o.filter(u=>!e&&u.stage!==Lr||u.structureId===e),l={};for(let u of s){let c=u==null?void 0:u.structureId,d=$De({playoffPositions:n,drawDefinition:t,structure:u,matchUps:i}),{error:p,...m}=d;if(p)return d;l[c]={structureId:c,...m}}return e?{positionsPlayedOff:a,...l[e]}:{availablePlayoffProfiles:Object.values(l),availablePlayoffRounds:Object.values(l),positionsPlayedOff:a}}function $De({playoffPositions:t,drawDefinition:e,structure:i,matchUps:r}){var n,a,o,s,l,u,c,d,p;let m=i==null?void 0:i.structureId,{links:h}=bv({drawDefinition:e,structureId:m});if(i.structureType===_n||i.structures){let w=(a=(n=si({structure:i}))==null?void 0:n.positionAssignments)==null?void 0:a.length,U=i.structures.length,T=(w??0)/U,D=((o=h.source)==null?void 0:o.flatMap(({source:x})=>(x==null?void 0:x.finishingPositions)||[]))||[],P=Te(1,T+1).filter(x=>!D.includes(x)),E=((l=(s=r.find(x=>x.containerStructureId===m&&x.finishingPositionRange))==null?void 0:s.finishingPositionRange)==null?void 0:l.winner)||[0,1],R=h==null?void 0:h.source.map(({target:x})=>x.structureId),{positionsPlayedOff:N=[],positionsNotPlayedOff:A=[]}=Pv({structureIds:R,drawDefinition:e}),M=[...N,...A],C=Te(E[0],E[1]+1).filter(x=>!M.includes(x)),O=Cr(C,C.length/P.length),k=P.map((x,F)=>{let $=O[F],_=[Math.min(...$||[]),Math.max(...$||[])].join("-");return{finishingPosition:x,finishingPositions:$,finishingPositionRange:_}});return{positionsNotPlayedOff:C,playoffFinishingPositionRanges:k,finishingPositionsAvailable:P,finishingPositionsPlayedOff:D,positionsPlayedOff:N,groupCount:U,groupSize:T}}let f=((u=h==null?void 0:h.source)==null?void 0:u.filter(w=>w.linkCondition!==ll).map(w=>{var U;return(U=w.source)==null?void 0:U.roundNumber}))||[],g=((c=h==null?void 0:h.source)==null?void 0:c.filter(w=>w.linkCondition===ll).map(w=>{var U;return(U=w.source)==null?void 0:U.roundNumber}))||[],v=lQ({excludeRoundNumbers:f,playoffPositions:t,drawDefinition:e,structureId:m}),y=v!=null&&v.playoffSourceRounds?[...(v==null?void 0:v.playoffSourceRounds)||[]]:void 0,I=[...(v==null?void 0:v.playoffRoundsRanges)||[]],{roundProfile:b,error:S}=v;for(let w of g){let U=h==null?void 0:h.source.find(R=>R.source.roundNumber===w),T=U==null?void 0:U.target.roundNumber,D=U==null?void 0:U.target.structureId,P=r.filter(({roundNumber:R,structureId:N})=>N===D&&R===T),E=P.filter(({sides:R})=>R.find(N=>N.participantFed&&!N.participantId)).length;if(y&&E===P.length){y.push(w);let R=(p=(d=b==null?void 0:b[w])==null?void 0:d.finishingPositionRange)==null?void 0:p.loser;if(R){let N=Math.min(...R),A=N+E,M=Te(N,A),C={finishingPositionRange:[N,A-1].join("-"),finishingPositions:M,roundNumber:w};I.push(C)}}}return y&&y.sort(lr),I.sort((w,U)=>w.roundNumber-U.roundNumber),{playoffRounds:y,playoffRoundsRanges:I,error:S}}function BDe({playoffGroups:t,drawDefinition:e,structureId:i}){var r,n;if(!e)return{error:$e};if(!Di(i)||!Array.isArray(t))return{error:se};let a=t.map(({finishingPositions:o})=>o).flat();return{positionRangeMap:(n=(r=xw({drawDefinition:e,structureId:i}).playoffFinishingPositionRanges)==null?void 0:r.filter(o=>a.includes(o.finishingPosition)))==null?void 0:n.reduce((o,s)=>(o[s.finishingPosition]=s,o),{})}}function uQ(t){var e,i;let{finishingPositionOffset:r=0,playoffAttributes:n,stageSequence:a=1,staggeredEntry:o,structureName:s,stage:l=Ae,matchUpType:u,structureId:c,idPrefix:d,drawSize:p,isMock:m,uuids:h}=t,f={finishingPositionOffset:r,matchUpType:u,drawSize:p,idPrefix:d,isMock:m,uuids:h},{matchUps:g}=o?$c(f):dl(f),v=so({structureName:s||((e=n==null?void 0:n[0])==null?void 0:e.name)||tn(Ae),structureId:c||(h==null?void 0:h.pop()),stageSequence:a,matchUpType:u,matchUps:g,stage:l}),y=[v],I=[];if(p>2){let b=p/2,{matchUps:S}=dl({finishingPositionOffset:r+b,idPrefix:d&&`${d}-c`,drawSize:b,matchUpType:u,isMock:m}),w=tn(an),U=((i=n==null?void 0:n["0-1"])==null?void 0:i.name)??t.consolationStructureName??(s?`${s} ${w}`:w),T=so({structureName:U,matchUps:S,structureId:h==null?void 0:h.pop(),stage:an,stageSequence:1,matchUpType:u});y.push(T);let D={linkType:Yl,source:{roundNumber:1,structureId:v.structureId},target:{roundNumber:1,feedProfile:$o,structureId:T.structureId}};I.push(D)}return{...Q,structures:y,links:I}}function cQ({consolationStructure:t,roundOffset:e=0,mainStructure:i,roundsCount:r,feedPolicy:n,fmlc:a}){let o=t.matchUps.reduce((u,c)=>(c.drawPositions||[]).filter(Boolean).length&&!u.includes(c.roundNumber)?u.concat(c.roundNumber):u,[]),s=(n==null?void 0:n.roundGroupedOrder)||[],l=n==null?void 0:n.roundFeedProfiles;return Te(1+e,r+1+e).map(u=>{let c=l!=null&&l[u-1]?l[u-1]:u%2&&$o||Kd,d=u-e<=2?u-e:(u-e-2)*2+2,p={linkType:Yl,source:{roundNumber:u,structureId:i.structureId},target:{feedProfile:c,roundNumber:d,structureId:t.structureId}},m=s[u-1];return m&&(p.target.groupedOrder=m),ja()&&(p.source.structureName=i.structureName,p.target.structureName=t.structureName),u===2&&a&&(p.linkCondition=ll,p.target.feedProfile=$o),o.includes(d)?p:void 0}).filter(Boolean)}function dQ(t){var e,i;let{playoffStructureNameBase:r,finishingPositionOffset:n,stageSequence:a=1,playoffAttributes:o,structureNameMap:s,staggeredEntry:l,stage:u=Ae,matchUpType:c,structureId:d,drawSize:p,idPrefix:m,isMock:h,uuids:f}=t,g={finishingPositionOffset:n,matchUpType:c,drawSize:p,idPrefix:m,isMock:h,uuids:f},{matchUps:v,roundsCount:y}=l?$c(g):dl(g),I=t.structureName??((e=o==null?void 0:o[0])==null?void 0:e.name)??tn(Ae),b=bc({structureId:d||(f==null?void 0:f.pop()),structureName:I,stageSequence:a,matchUpType:c,matchUps:v,stage:u}),S=[b],w=[];if(p>2){let U=[0,2].slice(0,p/16).map((T,D)=>{let P=D+1,{consolationStructure:E}=VDe({idPrefix:m&&`${m}-c${D}`,structureId:f==null?void 0:f.pop(),playoffStructureNameBase:r,playoffAttributes:o,structureNameMap:s,stageSequence:P,roundOffset:T,matchUpType:c,drawSize:p,isMock:h,index:D,uuids:f});S.push(E);let R=cQ({consolationStructure:E,roundsCount:2,mainStructure:b,roundOffset:T});return{consolationStructure:E,links:R}}).map(T=>T.links).flat();if(w.push(...U),p>=4&&p<=16||p>32){let{matchUps:T}=dl({idPrefix:m&&`${m}-p3t4`,finishingPositionOffset:2,drawSize:2,matchUpType:c,isMock:h}),D=((i=o==null?void 0:o["3-4"])==null?void 0:i.name)??tn(Bi),P=(s==null?void 0:s[D])||D,E=r?`${r} ${P}`:P,R=bc({structureId:f==null?void 0:f.pop(),matchUps:T,stageSequence:2,stage:Bi,structureName:E,matchUpType:c}),N={linkType:Yl,source:{roundNumber:y-1,structureId:b.structureId},target:{structureId:R.structureId,feedProfile:$o,roundNumber:1}};S.push(R),w.push(N)}}return{structures:S,links:w,...Q}}function VDe({playoffStructureNameBase:t,stageSequence:e=1,playoffAttributes:i,structureNameMap:r,roundOffset:n=0,matchUpType:a,structureId:o,idPrefix:s,drawSize:l,isMock:u,index:c,uuids:d}){var p,m;let h=l/(2*Math.pow(2,n)),{matchUps:f,roundsCount:g}=$c({finishingPositionOffset:h,baseDrawSize:h,isConsolation:!0,feedRounds:1,matchUpType:a,idPrefix:s,isMock:u,uuids:d}),v=c===0&&((p=i==null?void 0:i["0-1"])==null?void 0:p.name)||c===1&&((m=i==null?void 0:i["0-3"])==null?void 0:m.name)||`${tn(an)} ${c+1}`,y=(r==null?void 0:r[v])||v,I=t?`${t} ${y}`:y;return{consolationStructure:bc({matchUps:f,stage:an,structureName:I,stageSequence:e,matchUpType:a,structureId:o}),consolationRoundsCount:g}}function Vp(t){var e,i,r,n;let{finishingPositionOffset:a,stageSequence:o=1,playoffAttributes:s,feedsFromFinal:l,staggeredEntry:u,structureName:c,stage:d=Ae,structureId:p,matchUpType:m,skipRounds:h,feedRounds:f,idPrefix:g,drawSize:v,isMock:y,uuids:I,fmlc:b}=t,S=t.feedPolicy||((e=t.policyDefinitions)==null?void 0:e[lg])||((i=t.appliedPolicies)==null?void 0:i[lg]),w={finishingPositionOffset:a,matchUpType:m,skipRounds:h,drawSize:v,idPrefix:g,isMock:y,uuids:I},{matchUps:U}=u?$c(w):dl(w),T=so({structureName:c||((r=s==null?void 0:s[0])==null?void 0:r.name)||tn(Ae),structureId:p||(I==null?void 0:I.pop()),stageSequence:o,matchUpType:m,matchUps:U,stage:d}),D=[T],P=[],E=v/2,{matchUps:R,roundsCount:N}=$c({finishingPositionOffset:E,idPrefix:g&&`${g}-c`,isConsolation:!0,feedsFromFinal:l,baseDrawSize:E,matchUpType:m,feedRounds:f,skipRounds:h,isMock:y,uuids:I,fmlc:b});if(v>2){let A=((n=s==null?void 0:s["0-1"])==null?void 0:n.name)??tn(an),M=t.playoffStructureNameBase?`${t.playoffStructureNameBase} ${A}`:A,C=so({matchUps:R,structureId:I==null?void 0:I.pop(),stage:an,stageSequence:1,structureName:M,matchUpType:m});D.push(C);let O=cQ({consolationStructure:C,mainStructure:T,roundsCount:N,feedPolicy:S,fmlc:b});P.push(...O)}return{...Q,structures:D,links:P}}function pQ({requireSequential:t=!0,playoffMatchUpFormat:e,playoffAttributes:i,sourceStructureId:r,policyDefinitions:n,stageSequence:a,drawDefinition:o,playoffGroups:s,matchUpType:l,feedPolicy:u,groupCount:c,idPrefix:d,isMock:p,uuids:m}){var h,f,g,v,y,I;u=u||(n==null?void 0:n[lg]);let b="processPlayoffGroups",S=0,w=[],U=[],T=[],{error:D,positionRangeMap:P}=BDe({structureId:r,drawDefinition:o,playoffGroups:s});if(D)return te({result:{error:D},stack:b});if(!(!P||s!=null&&s.every(E=>{let{finishingPositions:R=[]}=E;if(!R.length)return!1;let N=[...R].sort(lr).map((A,M)=>(R[M+1]||A)-A).every(A=>A<2);return(!t||N)&&R.every(A=>P[A])})))return te({context:{validFinishingPositions:Object.values(P)},result:{error:se},stack:b});for(let E of s){let R=E.finishingPositions,N=P&&R.map($=>{var _;return(_=P[$])==null?void 0:_.finishingPositions}).flat(),A=c*R.length,M=nv(A),C=M===2&&Ks||E.drawType||Ks;N&&(S=Math.min(...N)-1);let O=N&&`${Math.min(...N)}-${Math.max(...N)}`,k=E.structureName||O&&((f=(h=E.playoffAttributes)==null?void 0:h[O])==null?void 0:f.name)||((v=(g=E.playoffAttributes)==null?void 0:g[0])==null?void 0:v.name),x={addNameBaseToAttributeName:E.addNameBaseToAttributeName,playoffStructureNameBase:E.playoffStructureNameBase,finishingPositionNaming:E.finishingPositionNaming,finishingPositionLimit:E.finishingPositionLimit,structureId:E.structureId??(m==null?void 0:m.pop()),playoffAttributes:E.playoffAttributes,structureNameMap:E.structureNameMap,sequenceLimit:E.sequenceLimit,structureName:k,idPrefix:d&&`${d}-po`,appliedPolicies:n,finishingPositionOffset:S,stage:Bi,stageSequence:a,matchUpType:l,drawSize:M,isMock:p,uuids:m},F=({playoffStructures:$,playoffLinks:_})=>{let[L]=$,B=vU({playoffStructureId:L.structureId,finishingPositions:R,sourceStructureId:r});T.push(B),T.push(..._),U.push(...$),w.push({structureId:L.structureId,finishingPositions:R}),S+=A};if(C===Ks){let{matchUps:$}=dl({finishingPositionLimit:S+A,idPrefix:d&&`${d}-po`,finishingPositionOffset:S,matchUpType:l,drawSize:M,isMock:p,uuids:m}),_=so({structureId:E.structureId??(m==null?void 0:m.pop()),matchUpFormat:e,stage:Bi,structureName:k,stageSequence:a,matchUps:$});U.push(_);let L=vU({playoffStructureId:_.structureId,finishingPositions:R,sourceStructureId:r});T.push(L),S+=A,w.push({structureId:_.structureId,finishingPositions:R})}else if([rg,ng,Bi].includes(C)){let $={playoffAttributes:E.playoffAttributes??i,playoffStructureNameBase:E.playoffStructureNameBase,structureId:E.structureId??(m==null?void 0:m.pop()),structureName:E.structureName,idPrefix:d&&`${d}-po`,addNameBaseToAttributeName:!0,finishingPositionOffset:S,stage:Bi,roundOffset:0,stageSequence:a,drawSize:M,isMock:p,uuids:m};C===rg?Object.assign($,{playoffAttributes:(E==null?void 0:E.playoffAttributes)??i??NF,roundOffsetLimit:3}):C===ng&&Object.assign($,{playoffAttributes:(E==null?void 0:E.playoffAttributes)??i??AF,roundOffsetLimit:2});let _=wf($);if(_.error)return _;if((y=_.links)!=null&&y.length&&T.push(..._.links),(I=_.structures)!=null&&I.length&&U.push(..._.structures),U.sort(Ph),_.structureId){let L=vU({playoffStructureId:_.structureId,finishingPositions:R,sourceStructureId:r});T.push(L),w.push({structureId:_.structureId,finishingPositions:R})}S+=A}else if([ag,nw,ny,ry,iy,ay].includes(C)){let $=[m==null?void 0:m.pop(),m==null?void 0:m.pop()],_={playoffStructureNameBase:E.playoffStructureNameBase,structureId:E.structureId??(m==null?void 0:m.pop()),playoffAttributes:E.playoffAttributes,idPrefix:d&&`${d}-po`,finishingPositionOffset:S,uuids:$,stage:Bi,structureName:k,matchUpType:l,feedPolicy:u,drawSize:M,isMock:p},L={[ag]:{fmlc:!0,feedRounds:1},[ay]:{feedRounds:1},[ny]:{feedsFromFinal:3},[ry]:{feedsFromFinal:2},[iy]:{feedsFromFinal:1}};Object.assign(_,L[C]||{});let{structures:B,links:V}=Vp(_),[G]=B,j=vU({playoffStructureId:G.structureId,finishingPositions:R,sourceStructureId:r});T.push(j),T.push(...V),U.push(...B),w.push({structureId:G.structureId,finishingPositions:R}),S+=A}else if([is].includes(C)){let{structures:$,links:_}=Mw({...x,structureOptions:E.structureOptions||{groupSize:4}});F({playoffStructures:$,playoffLinks:_})}else if([rw].includes(C)){let{structures:$,links:_}=uQ(x);F({playoffStructures:$,playoffLinks:_})}else if([vSe].includes(C)){let{structures:$,links:_}=dQ(x);F({playoffStructures:$,playoffLinks:_})}else if([Ga].includes(C)){let $=so({structureId:E.structureId??(m==null?void 0:m.pop()),structureName:E.structureName,finishingPosition:QU,stage:Bi,stageSequence:a,matchUps:[]});F({playoffStructures:[$],playoffLinks:[]})}}return{finishingPositionTargets:w,positionRangeMap:P,structures:U,links:T}}function vU({playoffStructureId:t,finishingPositions:e,sourceStructureId:i}){return{linkType:Ou,source:{structureId:i,finishingPositions:e},target:{structureId:t,feedProfile:gs,roundNumber:1}}}function Fw({matchUp:t,tieFormat:e,isMock:i,uuids:r}){let{collectionDefinitions:n}=e??{};return{tieMatchUps:(n??[]).map(a=>Lw({matchUp:t,collectionDefinition:a,uuids:r,isMock:i})).filter(Boolean).flat()}}function Lw({collectionPositionOffset:t=0,collectionDefinition:e,matchUpsLimit:i,matchUp:r,isMock:n,uuids:a}){let{matchUpCount:o,matchUpType:s,collectionId:l,processCodes:u}=e||{},c=i??o??0,d=p=>{if(!n&&!(r!=null&&r.isMock))return(a==null?void 0:a.pop())??Ht();let m=e==null?void 0:e.collectionId;return(a==null?void 0:a.pop())??`${r==null?void 0:r.matchUpId}-${m}-TMU-${p+1}`};return Te(0,c).map(p=>{let m=t+p+1;return{sides:[{sideNumber:1},{sideNumber:2}],matchUpId:d(p),matchUpStatus:Qi,collectionPosition:m,collectionId:l,processCodes:u,matchUpType:s,isMock:n}})}function jDe(t){var e,i,r;let n="generateAndPopulateRRplayoffStructures";if(!t.playoffGroups)return te({result:{error:Je},info:"playoffGroups required",stack:n});let{sourceStructureId:a,requireSequential:o,tournamentRecord:s,drawDefinition:l,playoffGroups:u,groupCount:c,groupSize:d,event:p}=t,m=pQ({requireSequential:o,sourceStructureId:a,playoffGroups:u,groupCount:c,groupSize:d,...t});if(m.error)return te({result:m,stack:n});let{structures:h=[],links:f=[],finishingPositionTargets:g,positionRangeMap:v}=m,y=g==null?void 0:g.map(({finishingPositions:E})=>E).flat().map(E=>v[E].finishingPositions).flat();l.structures.push(...h),l.links.push(...f);let{matchUps:I,matchUpsMap:b}=fr({inContext:!0,drawDefinition:l}),S=h.map(({structureId:E})=>E),w=I==null?void 0:I.filter(({structureId:E})=>S.includes(E)).map(Pr),U=(e=b==null?void 0:b.drawMatchUps)==null?void 0:e.filter(({matchUpId:E})=>w==null?void 0:w.includes(E));if(U!=null&&U.length){let E=(i=In({drawDefinition:l,event:p}))==null?void 0:i.tieFormat;E&&U.forEach(R=>{let{tieMatchUps:N}=Fw({isMock:t.isMock,tieFormat:E,matchUp:R});Object.assign(R,{tieMatchUps:N,matchUpType:Ba})})}let{positionAssignments:T}=si({structureId:a,drawDefinition:l}),D={};T==null||T.forEach(E=>{var R,N,A;let M=(A=(N=(R=vt({element:E,name:Oc}))==null?void 0:R.extension)==null?void 0:N.value)==null?void 0:A.groupOrder;M&&(D[M]||(D[M]=[]),D[M].push(E.participantId))});let P=Dv({provisionalPositioning:t.provisionalPositioning,structureId:a,applyPositioning:!0,event:t.event,tournamentRecord:s,drawDefinition:l});return P.error&&((r=P.error)==null?void 0:r.code)!==Hx.code?te({result:P,stack:n}):{structures:h,links:f,positionsPlayedOff:y,drawDefinition:l,...Q}}function df({value:t,sourceRange:e,targetRange:i}){let r=Math.min(...e),n=Math.max(...e),a=Math.min(...i),o=Math.max(...i);return(t-r)*(o-a)/(n-r)+a}var Fo="ELO",mQ="NTRP",GDe="TRN",hQ="UTR",t_="WTN",HDe={ELO:Fo,NTRP:mQ,TRN:GDe,UTR:hQ,WTN:t_},zDe={[Fo]:{defaultInitialization:1500,decimalsCount:0,range:[0,3e3],ascending:!0},[mQ]:{accessors:["ntrpRating","dntrpRatingHundredths"],attributes:{ustaRatingType:""},accessor:"dntrpRatingHundredths",defaultInitialization:3,decimalsCount:1,ascending:!0,range:[1,7]},[hQ]:{defaultInitialization:6,accessors:["utrRating"],accessor:"utrRating",decimalsCount:2,ascending:!0,range:[1,16]},[t_]:{attributes:{confidence:{generator:!0,range:[60,100]}},accessors:["wtnRating","confidence"],defaultInitialization:23,accessor:"wtnRating",ascending:!1,decimalsCount:2,range:[40,1]}},Tr=zDe;function WDe({sourceRatingType:t,sourceRating:e}){let i=Tr[t].range,r=i[0]>i[1],n=Tr[Fo].range;return df({value:r?i[0]-e:e,sourceRange:i,targetRange:n})}function qDe({targetRatingType:t,sourceRating:e}){let i=Tr[t].decimalsCount||0,r=Tr[t].range,n=r[0]>r[1],a=Math.max(...r),o=Tr[Fo].range,s=df({targetRange:r,sourceRange:o,value:e}),l=parseFloat(s.toFixed(i));return n?a-l:l}function x2(t){var e;let i=We(t,[{ratings:!0,[Jn]:ta}]);if(i.error)return i;let r=t.matchUpType&&[ii,ei].includes(t.matchUpType)?t.matchUpType:ii,n=Object.keys(Tr),a=t.targetRatingType&&n.includes(t.targetRatingType)?t.targetRatingType:Fo,o=t.ratings[r]?t.ratings[r].reduce((p,m)=>p.includes(m.scaleName)?p:p.concat(m.scaleName),[]):[];if(!o)return{error:jr};let s=((e=t.ratings[r])==null?void 0:e.find(p=>p.scaleName===a))??t.ratings[r][0];if(o[0]===a)return s;let l=s.scaleName,u=Tr[s.scaleName].accessor,c=u?s.scaleValue[u]:s.scaleValue,d=WDe({sourceRatingType:l,sourceRating:c});return{convertedRating:qDe({targetRatingType:a,sourceRating:d}),sourceRating:c}}function YDe({participantResults:t,sides:e,score:i}){var r,n;let a=e.find(({sideNumber:u})=>u===1),o=e.find(({sideNumber:u})=>u===2),s=(r=a==null?void 0:a.participant)==null?void 0:r.ratings,l=(n=o==null?void 0:o.participant)==null?void 0:n.ratings;if(s!=null&&s[ii]&&l!=null&&l[ii]){let u=Fo,{convertedRating:c}=x2({ratings:s,targetRatingType:u}),{convertedRating:d}=x2({ratings:l,targetRatingType:u}),{side1pressure:p,side2pressure:m}=KDe({side1ConvertedRating:c,side2ConvertedRating:d,score:i});p&&t[a==null?void 0:a.participantId].pressureScores.push(p),m&&t[o==null?void 0:o.participantId].pressureScores.push(m);let h=Math.max(...Tr[Fo].range),f=XS((d-c)/h),g=XS((c-d)/h);t[a==null?void 0:a.participantId].ratingVariation.push(f),t[o==null?void 0:o.participantId].ratingVariation.push(g)}}function KDe({side1ConvertedRating:t,side2ConvertedRating:e,score:i}){var r,n;let a=t>e?t:e,o=t>e?e:t,s=Math.abs(t-e),l=Tr[Fo].range,u=Math.max(...l),c=(u-a)*0,d=(a+c)/u*s,p=(r=i==null?void 0:i.sets)==null?void 0:r.reduce((b,S)=>b+((S==null?void 0:S.side1Score)??0),0),m=(n=i==null?void 0:i.sets)==null?void 0:n.reduce((b,S)=>b+(S.side2Score??0),0),h=t>e?2:1,f=(p||0)*(o+(h===1?d:0)),g=(m||0)*(o+(h===2?d:0)),v=f+g,y=v?XS(f/v):0,I=v?XS(g/v):0;return{side1pressure:y,side2pressure:I}}function i_({winningSide:t,matchUpFormat:e=zo,matchUpStatus:i,tallyPolicy:r,score:n}){let a=[0,0],o=n==null?void 0:n.sets,s=typeof t=="number"&&t-1,l=Ln(e),u=r_((l==null?void 0:l.bestOf)??1);if(typeof s=="number"&&(i===Pt&&r!=null&&r.setsCreditForDefaults||i===Ft&&r!=null&&r.setsCreditForWalkovers))a[s]=u;else for(let c of o||[]){let{winningSide:d}=c;d&&(a[d-1]+=1)}return typeof s=="number"&&i===zr&&(+a[1-s]===u&&(a[1-s]-=1),r!=null&&r.setsCreditForRetirements&&(a[s]=u)),a}function fQ({matchUpFormat:t=zo,winningSide:e,matchUpStatus:i,tallyPolicy:r,score:n}){var a,o;let{sets:s}=n||{};if(!s)return[0,0];let l=typeof e=="number"&&e-1,u=Ln(t),c=(u==null?void 0:u.bestOf)??1,d=r_(c),p=((a=u==null?void 0:u.setFormat)==null?void 0:a.tiebreakAt)||0,m=[[],[]];if(typeof l=="number"&&(i===Pt&&r!=null&&r.gamesCreditForDefaults||i===Ft&&r!=null&&r.gamesCreditForWalkovers)){let h=((o=u==null?void 0:u.setFormat)==null?void 0:o.setTo)||0,f=d*h;m[l].push(f)}else s.forEach((h,f)=>{var g;let v=(h.setNumber||f+1)>d&&u!=null&&u.finalSetFormat?"finalSetFormat":"setFormat",y=(g=u==null?void 0:u[v])==null?void 0:g.based,I=u==null?void 0:u[v].tiebreakSet,{side1Score:b,side2Score:S}=h;F2(y)&&(m[0].push(Ze(b||0)),m[1].push(Ze(S||0))),I&&h.winningSide&&(r==null?void 0:r.gamesCreditForTiebreakSets)!==!1&&m[h.winningSide-1].push(1)});if(i===zr&&typeof l=="number"){let h=s.length>d&&u!=null&&u.finalSetFormat?"finalSetFormat":"setFormat",f=u==null?void 0:u[h];if(F2(f.based)){let g=(f==null?void 0:f.setTo)||0,v=I=>{if(!(!u||I===""))return+I===p-1||+I===p?Ze(p||0)+1:+I<p?g:p},y=i_({winningSide:e,score:{sets:s},matchUpStatus:i,matchUpFormat:t,tallyPolicy:r});if(m.map(I=>I[l]<=I[1-l]).reduce((I,b)=>I+(b?1:0),0)>y[1-l]){let I=m[l].length,b=v(m[1-l][I-1]);b&&(m[l][I-1]=b)}d>m[l].length&&r!=null&&r.gamesCreditForRetirements&&m[l].push(g)}}return[m[0].reduce((h,f)=>h+f,0),m[1].reduce((h,f)=>h+f,0)]}function gQ({matchUpFormat:t,score:e}){var i;let r=t?Ln(t):void 0,n=(r==null?void 0:r.bestOf)??1,a=r_(n),o=[0,0],s=[0,0];return(i=e==null?void 0:e.sets)==null||i.forEach((l,u)=>{var c;let d=(l.setNumber||u+1)>a&&r!=null&&r.finalSetFormat?"finalSetFormat":"setFormat",p=(c=r==null?void 0:r[d])==null?void 0:c.based;if(vQ(p)){let{side1Score:m,side2Score:h}=l;m&&(s[0]+=Ze(m||0)),h&&(s[1]+=Ze(h||0))}else l.side1TiebreakScore&&(s[0]+=Ze(l.side1TiebreakScore||0)),l.side2TiebreakScore&&(s[1]+=Ze(l.side2TiebreakScore||0)),(l.side1TiebreakScore||l.side2TiebreakScore)&&l.winningSide&&(o[l.winningSide-1]+=1)}),{pointsTally:s,tiebreaksTally:o}}function r_(t){return t&&Math.ceil(t/2)||1}function vQ(t){return t==="P"}function F2(t){return!vQ(t)}function XDe({participantResults:t,matchUpFormat:e,tallyPolicy:i,perPlayer:r,totalSets:n}){var a;let o=e&&Ln(e)||{},s=o.bestOf,l=s&&Math.ceil(s/2)||1,u=(a=o.setFormat)==null?void 0:a.setTo;Object.keys(t).forEach(c=>{let d=t[c].setsWon,p=t[c].setsLost,m=i!=null&&i.groupTotalSetsPlayed?n:r*(l||0)||d+p,h=Math.round(d/m*1e3)/1e3;(h===1/0||isNaN(h))&&(h=m);let f=t[c].tieMatchUpsWon,g=t[c].tieMatchUpsLost,v=f+g,y=Math.round(f/v*1e3)/1e3;(y===1/0||isNaN(y))&&(y=f);let I=t[c].matchUpsWon,b=t[c].matchUpsLost,S=I+b,w=Math.round(I/S*1e3)/1e3;(w===1/0||isNaN(w))&&(w=I);let U=t[c].gamesWon||0,T=t[c].gamesLost||0,D=(r||0)*(l||0)*(u||0),P=Math.max(D,U+T),E=Math.round(U/P*1e3)/1e3;(E===1/0||isNaN(E))&&(E=0);let R=t[c].pointsWon+t[c].pointsLost,N=Math.round(t[c].pointsWon/R*1e3)/1e3;(N===1/0||isNaN(N))&&(N=0),t[c].setsWon=d,t[c].setsLost=p,t[c].setsPct=h,t[c].tieMatchUpsWon=f,t[c].tieMatchUpsPct=y,t[c].matchUpsPct=w,t[c].gamesWon=U,t[c].gamesLost=T,t[c].gamesPct=E,t[c].pointsPct=N,t[c].result=`${t[c].matchUpsWon}/${t[c].matchUpsLost}`})}function _w({participantIds:t,pressureRating:e,matchUpFormat:i,tallyPolicy:r,perPlayer:n,matchUps:a}){var o,s,l,u,c,d,p;let m={},h=(r==null?void 0:r.excludeMatchUpStatuses)||[],f=a==null?void 0:a.filter(v=>(v.tieMatchUps||!h.includes(v.matchUpStatus))&&(!(t!=null&&t.length)||ji(t,[pf(v,0),pf(v,1)]).length===2)),g=(o=f==null?void 0:f.flatMap(({score:v,tieMatchUps:y})=>{var I;return y?y.filter(({matchUpStatus:b})=>!h.includes(b)).flatMap(({score:b})=>{var S;return((S=b==null?void 0:b.sets)==null?void 0:S.length)??0}):((I=v==null?void 0:v.sets)==null?void 0:I.length)??0}))==null?void 0:o.reduce((v,y)=>v+y,0);for(let v of f??[]){let{matchUpStatus:y,tieMatchUps:I,tieFormat:b,score:S,winningSide:w,sides:U}=v,T=b&&v._disableAutoCalc&&b.collectionDefinitions.every(({scoreValue:N})=>N),D=w&&JDe(v),P=w&&QDe(v);if(!D&&!P)if(y&&yr.includes(y)){let N=pf(v,0),A=pf(v,1);N&&(cc(m,N),m[N].matchUpsCancelled+=1),A&&(cc(m,A),m[A].matchUpsCancelled+=1)}else if(I!=null&&I.length){n=0;for(let N of I){if(N.winningSide){let A=(s=U==null?void 0:U.find(({sideNumber:C})=>C===N.winningSide))==null?void 0:s.participantId,M=(l=U==null?void 0:U.find(({sideNumber:C})=>C===N.winningSide))==null?void 0:l.participantId;A&&M&&(cc(m,A),cc(m,M),m[A].tieMatchUpsWon+=1,m[M].tieMatchUpsLost+=1,Xi(ii)(N.matchUpType)?(m[A].tieSinglesWon+=1,m[M].tieSinglesLost+=1):Xi(ei)(N.matchUpType)&&(m[A].tieDoublesWon+=1,m[M].tieDoublesLost+=1))}L2({score:N.score,manualGamesOverride:T,participantResults:m,sides:U})}}else L2({manualGamesOverride:T,participantResults:m,score:S,sides:U});else if(cc(m,D),cc(m,P),I==null?void 0:I.length){n=0;for(let N of I){let{matchUpType:A}=N,M=Xi(ei)(A),C=Xi(ii)(A);N.winningSide&&(N.winningSide===w?(D&&(m[D].tieMatchUpsWon+=1,C&&(m[D].tieSinglesWon+=1),M&&(m[D].tieDoublesWon+=1)),P&&(m[P].tieMatchUpsLost+=1,C&&(m[P].tieSinglesLost+=1),M&&(m[P].tieDoublesLost+=1))):N.winningSide!==w&&(P&&(m[P].tieMatchUpsWon+=1,C&&(m[P].tieSinglesWon+=1),M&&(m[P].tieDoublesWon+=1)),D&&(m[D].tieMatchUpsLost+=1,C&&(m[D].tieSinglesLost+=1),M&&(m[D].tieDoublesLost+=1)))),_2({matchUpFormat:N.matchUpFormat,matchUpStatus:N.matchUpStatus,matchUpType:N.matchUpType,score:N.score,sides:N.sides,winningParticipantId:D,losingParticipantId:P,manualGamesOverride:T,participantResults:m,isTieMatchUp:!0,pressureRating:e,tallyPolicy:r,winningSide:w})}IQ({winningParticipantId:D,losingParticipantId:P,participantResults:m,matchUpStatus:y})}else _2({matchUpFormat:v.matchUpFormat??i,matchUpType:v.matchUpType,isTieMatchUp:void 0,winningParticipantId:D,manualGamesOverride:T,losingParticipantId:P,participantResults:m,pressureRating:e,matchUpStatus:y,tallyPolicy:r,winningSide:w,score:S,sides:U});let E=(u=S==null?void 0:S.sets)==null?void 0:u.reduce((N,A)=>N+((A==null?void 0:A.side1Score)??0),0),R=(c=S==null?void 0:S.sets)==null?void 0:c.reduce((N,A)=>N+(A.side2Score??0),0);if(T){let N=(d=U==null?void 0:U.find(({sideNumber:M})=>M===1))==null?void 0:d.participantId,A=(p=U==null?void 0:U.find(({sideNumber:M})=>M===2))==null?void 0:p.participantId;cc(m,N),cc(m,A),N&&(m[N].gamesWon+=E,m[N].gamesLost+=R),A&&(m[A].gamesWon+=R,m[A].gamesLost+=E)}}return XDe({participantResults:m,matchUpFormat:i,tallyPolicy:r,perPlayer:n,totalSets:g}),{participantResults:m}}function JDe(t){let e=t.winningSide-1;return pf(t,e)}function QDe(t){let e=1-(t.winningSide-1);return pf(t,e)}function pf(t,e){if(!(t!=null&&t.sides))return console.log("no sides:",{matchUp:t}),"foo";let i=t.sides[e];return i?i.participantId:(console.log("No Side",{matchUp:t,index:e}),"foo")}function cc(t,e){e&&!t[e]&&(t[e]={allDefaults:0,defaults:0,defeats:[],gamesLost:0,gamesWon:0,matchUpsCancelled:0,matchUpsLost:0,matchUpsWon:0,pointsLost:0,pointsWon:0,pressureScores:[],ratingVariation:[],retirements:0,setsLost:0,setsWon:0,tieSinglesWon:0,tieSinglesLost:0,tieDoublesWon:0,tieDoublesLost:0,tieMatchUpsLost:0,tieMatchUpsWon:0,victories:[],walkovers:0})}function L2({manualGamesOverride:t,participantResults:e,score:i,sides:r}){let{sets:n}=i||{},a=[[],[]],o=[0,0];for(let l of n||[]){let{winningSide:u,side1Score:c,side2Score:d}=l;u&&(o[u-1]+=1),a[0].push(Ze(c||0)),a[1].push(Ze(d||0))}let s=[a[0].reduce((l,u)=>l+u,0),a[1].reduce((l,u)=>l+u,0)];r.forEach((l,u)=>{let{participantId:c}=l;c&&(cc(e,c),e[c].setsWon+=o[u],e[c].setsLost+=o[1-u],t||(e[c].gamesWon+=s[u],e[c].gamesLost+=s[1-u]))})}function _2({winningParticipantId:t,manualGamesOverride:e,losingParticipantId:i,participantResults:r,pressureRating:n,matchUpFormat:a,matchUpStatus:o,isTieMatchUp:s,matchUpType:l,tallyPolicy:u,winningSide:c,score:d,sides:p}){let m=c&&c-1,h=1-m;n&&l===ii&&YDe({participantResults:r,sides:p,score:d}),s||IQ({winningParticipantId:t,losingParticipantId:i,participantResults:r,matchUpStatus:o});let f=i_({matchUpStatus:o,matchUpFormat:a,tallyPolicy:u,winningSide:c,score:d}),g=fQ({matchUpStatus:o,matchUpFormat:a,tallyPolicy:u,winningSide:c,score:d}),{pointsTally:v}=gQ({score:d,matchUpFormat:a});t&&(r[t].setsWon+=f[m],r[t].setsLost+=f[h],e||(r[t].gamesWon+=g[m],r[t].gamesLost+=g[h]),r[t].pointsWon+=v[m],r[t].pointsLost+=v[h]),i&&(r[i].setsWon+=f[h],r[i].setsLost+=f[m],e||(r[i].gamesWon+=g[h],r[i].gamesLost+=g[m]),r[i].pointsWon+=v[h],r[i].pointsLost+=v[m])}function IQ({winningParticipantId:t,losingParticipantId:e,participantResults:i,matchUpStatus:r}){e&&(r===Ft&&(i[e].walkovers+=1),r===Pt&&(i[e].defaults+=1),r===zr&&(i[e].retirements+=1),[Pt,zr,Ft].includes(r)&&(i[e].allDefaults+=1),i[e].matchUpsLost+=1),t&&(i[t].matchUpsWon+=1),e&&t&&(i[e].defeats.push(t),i[t].victories.push(e))}function ZDe({matchUps:t,order:e,report:i}){let r={};t.forEach(({sides:a})=>{a.forEach(o=>{o.participantId&&o.participant&&(r[o.participantId]=o.participant.participantName)})});let n=[];return Array.isArray(i)&&i.forEach((a,o)=>{var s,l;if((s=a.excludedDirectives)!=null&&s.length){let u=a.excludedDirectives.map(({attribute:p})=>p).join(", "),c=`${u.length} directives were excluded due to participants limit}`;n.push(c);let d=`Excluded: ${u}`;n.push(d)}else{let u=(f,g)=>parseFloat(a.reversed?f:g)-parseFloat(a.reversed?g:f),c=a.groups?Object.values(a.groups).flat(1/0).length:((l=a.participantIds)==null?void 0:l.length)??0,d=f=>{f.groups&&Object.keys(f.groups).sort(u).forEach(g=>{let v=f.groups[g].map(I=>r[I]).join(", "),y=`${g} ${f.attribute}: ${v}`;n.push(y)})},p=a.reversed?" in reverse order":"",m=a.groups?"grouped":"separated",h=`Step ${o+1}: ${c} particiants were ${m}${p} by ${a.attribute}`;if(n.push(h),a.idsFilter){let f=`${a.attribute} was calculated considering ONLY TIED PARTICIPANTS`;n.push(f)}d(a)}n.push("----------------------")}),n.push("Final Order:"),e.forEach(a=>{let{participantId:o,resolved:s}=a,l=a.groupOrder||a.provisionalOrder;n.push(`${l}: ${r[o]} => resolved: ${!!s}`)}),n.join(`\r
`)}function yQ({participantResults:t,participantIds:e,attribute:i}){return bQ({participantResults:t,participantIds:e}).reduce((r,n)=>{let{participantId:a,results:o}=n,s=o==null?void 0:o[i];return!isNaN(s)&&a&&(r[s]?r[s].push(a):r[s]=[a]),r},{})}function bQ(t){return(t.participantIds||Object.keys(t.participantResults)).reduce((e,i,r)=>(e.push({participantId:i,i:r,results:t.participantResults[i]}),e),[])}var ePe=[{attribute:"matchUpsPct",idsFilter:!1},{attribute:"allDefaults",reversed:!0,idsFilter:!1},{attribute:"defaults",reversed:!0,idsFilter:!1},{attribute:"walkovers",reversed:!0,idsFilter:!1},{attribute:"retirements",reversed:!0,idsFilter:!1},{attribute:"setsPct",idsFilter:!1},{attribute:"gamesPct",idsFilter:!1},{attribute:"pointsPct",idsFilter:!1},{attribute:"matchUpsPct",idsFilter:!0},{attribute:"setsPct",idsFilter:!0},{attribute:"gamesPct",idsFilter:!0},{attribute:"pointsPct",idsFilter:!0}],qE={matchUpsPct:20,tieMatchUpsPct:16,pointsPct:4,gamesPct:8,setsPct:12};function $2(t){let{requireCompletion:e=!0,participantResults:i,subOrderMap:r,tallyPolicy:n}=t,a=[];if(e&&!tPe(t))return{};let o=["tieMatchUpsWon","tieSinglesWon","tieDoublesWon","matchUpsWon","pointsWon","gamesWon","setsWon","gamesPct","setsPct","pointsPct","matchUpsPct"].includes(n==null?void 0:n.groupOrderKey)?n.groupOrderKey:"matchUpsWon",s=yQ({participantResults:i,attribute:o});a.push({attribute:o,groups:s});let l=Object.keys(s).map(g=>parseFloat(g)).sort((g,v)=>v-g).map(g=>s[g]).map(g=>{let v=wQ({participantIds:g,...t});return a.push(...v.report??[]),v.order}).map((g,v)=>g.map(y=>y.resolved?y:{...y,subGroup:[v].concat(...y.subGroup??[])})).flat(),u,c=0,d=1,p;l.forEach((g,v)=>{var y;v&&(g.resolved||p&&!g.resolved)&&(d+=1),p=g.resolved;let I=parseInt(((y=g.subGroup)==null?void 0:y.join(""))||0);g.resolved?(g.position=v+1,d=g.position):(u&&I>u&&(d+=c,c=0),g.position=d,c+=1),u=I});let m=l.map(({position:g})=>g),h=Pa(m);return l.forEach(g=>{let{participantId:v,position:y}=g||{},I=i[v];g.GEMscore=f(I);let b=h[y];(g==null?void 0:g.position)!==void 0&&(b>1&&(g.ties=b,r&&(g.subOrder=r[v])),g.rankOrder=y,g.groupOrder=y+(g.subOrder||1)-1)}),{groupOrder:l,report:a.flat(1/0).filter(Boolean)};function f(g){return(Array.isArray(n==null?void 0:n.GEMscore)?Object.keys(qE).filter(v=>n.GEMscore.includes(v)):Object.keys(qE)).map(v=>(g[v]||0)*Math.pow(10,qE[v].toFixed(3))).reduce((v,y)=>v+y,0)}}function tPe({participantResults:t,participantsCount:e}){let i=bQ({participantResults:t}).filter(r=>e-1===r.results.matchUpsWon+r.results.matchUpsLost+r.results.matchUpsCancelled);return e===i.length}function iPe({disableHeadToHead:t,participantIds:e,matchUpFormat:i,tallyPolicy:r,attribute:n,idsFilter:a,matchUps:o,reversed:s}){let{participantResults:l}=_w({participantIds:a&&e,matchUpFormat:i,tallyPolicy:r,matchUps:o}),u=yQ({participantResults:l,participantIds:e,attribute:n}),c=[{attribute:n,reversed:s,groups:u,idsFilter:a}],d;return Object.keys(u).length>1&&e.length&&(d=Object.keys(u).map(p=>parseFloat(p)).sort((p,m)=>s?p-m:m-p).map(p=>u[p]).map(p=>{let m=wQ({participantResults:l,disableHeadToHead:t,participantIds:p,matchUpFormat:i,tallyPolicy:r,matchUps:o});return c.push(...m.report??[]),m.order}).map((p,m)=>p.map(h=>h.resolved?h:{...h,subGroup:[m].concat(...h.subGroup??[])})).flat()),{order:d,report:c}}function wQ({participantResults:t,disableHeadToHead:e,participantIds:i,matchUpFormat:r,tallyPolicy:n,matchUps:a}){let o=[],s=[],l;if((i==null?void 0:i.length)===1)return{order:[{resolved:!0,participantId:i[0]}]};if((i==null?void 0:i.length)===2&&(!(n!=null&&n.headToHead)||!n.headToHead.disabled&&!e)){let c=rPe({participantIds:i,participantResults:t});if(c){let d=c[0].participantId;return s.push({attribute:"head2Head",participantIds:i,headToHeadWinner:d}),{order:c,headToHeadWinner:d,report:s}}}let u=((n==null?void 0:n.tallyDirectives)||ePe).filter(c=>{let d=!(_i(c.maxParticipants)&&(i==null?void 0:i.length)>c.maxParticipants);return d||o.push(c),d});return o.length&&s.push({excludedDirectives:o,participantIds:i}),u.every(({attribute:c,reversed:d,idsFilter:p,disableHeadToHead:m})=>(l=iPe({disableHeadToHead:m,participantIds:i,matchUpFormat:r,tallyPolicy:n,attribute:c,idsFilter:p,matchUps:a,reversed:d}),s.push(l.report),!l.order)),l.order?{order:l.order,report:s}:{order:i==null?void 0:i.map(c=>({participantId:c})),report:s}}function rPe({participantIds:t,participantResults:e}){if(t){if(e[t[0]].victories.includes(t[1]))return t.map(i=>({resolved:!0,participantId:i}));if(e[t[1]].victories.includes(t[0]))return t.reverse().map(i=>({resolved:!0,participantId:i}))}}function Rv({policyDefinitions:t,generateReport:e,pressureRating:i,matchUpFormat:r,matchUps:n=[],subOrderMap:a,perPlayer:o}){if(!(n!=null&&n.length)||!Ro(n))return{error:Ju};let s=dt(n.map(({structureId:b})=>b));if(s.length!==1)return te({result:{error:se,info:"Maximum one structureId"},stack:"tallyParticipantResults",context:{structureIds:s}});let l=n.filter(b=>b&&b.matchUpStatus!==jt),u=l.length&&dt(l.map(({drawPositions:b})=>b).flat()).length,c=l.filter(b=>Cd({matchUp:b})).length===l.length;c||(o=0);let d=n.every(({matchUpType:b,tieMatchUps:S})=>b===fi&&(S==null?void 0:S.every(w=>Cd({matchUp:w})))),p=t==null?void 0:t[jF],m=n.filter(b=>Cd({matchUp:b})||b.matchUpType===fi),{participantResults:h}=_w({matchUps:m,pressureRating:i,matchUpFormat:r,tallyPolicy:p,perPlayer:o}),f,g,{groupOrder:v,report:y}=$2({matchUps:m,participantResults:h,participantsCount:u,matchUpFormat:r,tallyPolicy:p,subOrderMap:a});if(i&&nPe({participantResults:h}),c&&v)f=y,g=v,v.forEach(b=>{let{participantId:S,groupOrder:w,rankOrder:U,subOrder:T,ties:D,GEMscore:P}=b,E=h[S];Object.assign(E,{groupOrder:w,rankOrder:U,GEMscore:P,subOrder:T,ties:D})});else{let{groupOrder:b,report:S}=$2({requireCompletion:!1,participantResults:h,participantsCount:u,matchUpFormat:r,tallyPolicy:p,subOrderMap:a,matchUps:n});f=S,g=b,b&&b.forEach(w=>{let{participantId:U,groupOrder:T,GEMscore:D}=w,P=h[U];Object.assign(P,{provisionalOrder:T,GEMscore:D})})}let I={completedTieMatchUps:d,readableReport:"",participantResults:h,bracketComplete:c,order:[],report:f};if((c||d)&&(I.order=g),e||ja({tally:!0})){let b=ZDe({matchUps:n,report:f,order:g});ja({tally:!0})&&console.log(b),I.readableReport=b}return I}function nPe({participantResults:t}){let e=n=>n.reduce((a,o)=>a+parseFloat(o),0),i=n=>parseFloat((e(n)/n.length).toFixed(2)),r=Object.keys(t).map(n=>{let a=t[n],{pressureScores:o}=a,s=o!=null&&o.length?i(o):0;return{participantId:n,averagePressure:s}}).sort((n,a)=>(a.averagePressure||0)-(n.averagePressure||0)).map((n,a)=>({...n,order:a+1}));for(let n of r)t[n.participantId].pressureOrder=n.order}function UQ({positionAssignments:t}){let e=(t||[]).filter(Ma(Xl)).map(n=>{let{extension:a}=vt({element:n,name:ug}),o=Ze(a==null?void 0:a.value),s=!isNaN(o)&&o;return s&&{participantId:n.participantId,subOrder:s}}).filter(Boolean),i=e.map(({subOrder:n})=>n),r=Pa(i);return{subOrderMap:Object.assign({},...e.filter(({subOrder:n})=>r[n]===1).map(({participantId:n,subOrder:a})=>({[n]:a})))}}function n_({positionAssignments:t,tournamentRecord:e,drawDefinition:i,matchUpFormat:r,matchUps:n,event:a}){if(!Ro(n))return{error:se};if(!t)return{error:se};let{policyDefinitions:o}=ec({policyTypes:[jF],tournamentRecord:e,drawDefinition:i,event:a}),{subOrderMap:s}=UQ({positionAssignments:t}),l=n.length?Rv({policyDefinitions:o,matchUpFormat:r,subOrderMap:s,matchUps:n}):void 0;if(l!=null&&l.error)return l;let{participantResults:u={},bracketComplete:c,report:d}=l??{},p=Object.keys(u);return t.forEach(m=>{let{participantId:h}=m;if(p.includes(h)){let f={value:u[h],name:Oc};_t({element:m,extension:f}),u[h].ties||Dn({element:m,name:ug})}else Dn({element:m,name:Oc}),Dn({element:m,name:ug})}),ui({drawDefinition:i}),{...Q,participantResults:u,bracketComplete:c,report:d}}function SQ({matchUps:t,matchUpId:e}){return{matchUp:(t||[]).find(i=>i.matchUpId===e)}}function Si(t){let e=We(t,[{[$n]:!0,[Il]:!0}]);if(e.error)return e;let{tournamentParticipants:i,afterRecoveryTimes:r,contextProfile:n,drawDefinition:a,matchUpsMap:o,matchUpId:s,inContext:l,context:u,event:c}=t,{structures:d=[]}=ns({drawDefinition:a}),p=t.contextContent||n&&tc({contextProfile:n,drawDefinition:a});for(let m of d){let{matchUps:h}=qt({tournamentParticipants:i,afterRecoveryTimes:r,contextContent:p,drawDefinition:a,contextProfile:n,matchUpsMap:o,inContext:l,structure:m,context:u,event:c}),{matchUp:f}=SQ({matchUps:h,matchUpId:s});if(f)return{matchUp:f,structure:m}}return{error:hn}}function lR(t){var e;return!At(t)||!t.notes?{error:Je}:At(t.element)?!Di(t.notes)&&!((e=t.notes)!=null&&e.testing)?{error:se}:(Object.assign(t.element,{notes:t.notes}),{...Q}):{error:se}}function a_(t){return At(t)?At(t.element)?(t.element.notes&&delete t.element.notes,{...Q}):{error:se}:{error:Je}}var uR={matchUpStatus:Qi,matchUpStatusCodes:[],score:{scoreStringSide1:"",scoreStringSide2:"",sets:void 0},matchUpFormat:void 0,winningSide:void 0};function Js(t){var e,i,r,n,a,o,s,l;let u="modifyMatchUpScore",c=t.matchUpFormat,d=t.matchUp,p,{matchUpStatusCodes:m,tournamentRecord:h,drawDefinition:f,matchUpStatus:g,removeScore:v,winningSide:y,matchUpId:I,event:b,notes:S,score:w}=t,U=t.appliedPolicies&&Object.keys(t.appliedPolicies).length?t.appliedPolicies:(e=Bt({policyTypes:[fo],tournamentRecord:h,drawDefinition:f,structure:p,event:b}))==null?void 0:e.appliedPolicies,T=d.matchUpType===fi;if(T&&f){if(I&&d.matchUpId!==I){let M=Si({drawDefinition:f,matchUpId:I,event:b});if(!M.matchUp)return{error:hn};({matchUp:d,structure:p}=M)}}else d.matchUpId!==I&&console.log("!!!!!");g&&[Ft,tr].includes(g)||v?Object.assign(d,{...uR}):w&&(d.score=w);let D=g&&(d==null?void 0:d.matchUpStatus)===Pt&&g!==Pt;g&&(d.matchUpStatus=g),c&&(d.matchUpFormat=c),m&&(d.matchUpStatusCodes=m),y&&(d.winningSide=y),t.removeWinningSide&&(d.winningSide=void 0),!p&&f&&({structure:p}=Si({drawDefinition:f,matchUpId:I,event:b})),g&&!d.winningSide&&br(d)&&!yr.includes(g)&&![Dh,rd,Ca].includes(g)&&(d.matchUpStatus=cs);let P;if((D&&(i=d==null?void 0:d.processCodes)!=null&&i.length||g===Pt)&&(P=(n=(r=U==null?void 0:U[fo])==null?void 0:r.processCodes)==null?void 0:n.incompleteAssignmentsOnDefault),!d.collectionId){let M=(p==null?void 0:p.structureType)===_n,C=Yn({structure:p});if(yL({drawDefinition:f,structure:p})||C||M){let O=F=>{c=T?"SET1-S:T100":c??d.matchUpFormat??(F==null?void 0:F.matchUpFormat)??(f==null?void 0:f.matchUpFormat)??(b==null?void 0:b.matchUpFormat);let $=T?{matchUpTypes:[fi]}:void 0,{matchUps:_}=qt({afterRecoveryTimes:!1,tournamentRecord:h,inContext:!0,matchUpFilters:$,drawDefinition:f,structure:F,event:b});return C&&(F.positionAssignments=dt(_.flatMap(L=>(L.sides??[]).map(B=>B.participantId)).filter(Boolean)).map(L=>({participantId:L}))),n_({positionAssignments:F.positionAssignments,tournamentRecord:h,drawDefinition:f,matchUpFormat:c,matchUps:_,event:b})},k=M&&p.structures.find(F=>F==null?void 0:F.matchUps.find($=>$.matchUpId===I)),x=O(k||p);if(x.error)return te({result:x,stack:u})}}if(S){let M=lR({element:d,notes:S});if(M.error)return te({result:M,stack:u})}let E=h==null?void 0:h.tournamentId,R=So().topics.includes(VP),N=(R||P)&&ln({drawDefinition:f}),A=N&&((a=fr({matchUpFilters:{matchUpIds:[I]},nextMatchUps:!0,tournamentRecord:h,inContext:!0,drawDefinition:f,matchUpsMap:N}).matchUps)==null?void 0:a[0]);if(R&&A&&i0e({tournamentId:E,inContextMatchUp:A}),Array.isArray(P)&&A&&!((o=A.sides)!=null&&o.every(({participantId:M})=>M)))if(g===Pt)d.processCodes=dt([...d.processCodes??[],...P]);else for(let M of P||[]){let C=M&&((s=d==null?void 0:d.processCodes)==null?void 0:s.lastIndexOf(M));(l=d==null?void 0:d.processCodes)==null||l.splice(C,1)}return Et({eventId:b==null?void 0:b.eventId,context:u,drawDefinition:f,tournamentId:E,matchUp:d}),{...Q}}function o_(t){var e,i,r,n;let{matchUpStatusCodes:a,matchUpStatus:o,structure:s,matchUp:l,dualMatchUp:u,inContextMatchUp:c,autoCalcDisabled:d}=t,p=Tw({matchUpStatus:o})||[bl,ua].includes(o)&&u||d,m=((e=l==null?void 0:l.sides)==null?void 0:e.map(y=>y.participantId).filter(Boolean).length)||((i=c==null?void 0:c.sides)==null?void 0:i.map(y=>y.participantId).filter(Boolean).length),h="attemptToModifyScore";if(!(Yn({structure:s})&&m===1||o===Pt&&m||aPe({structure:s,matchUp:l,inContextMatchUp:c})||((n=(r=t.appliedPolicies)==null?void 0:r[fo])==null?void 0:n.requireParticipantsForScoring)===!1))return te({result:{error:Jx},stack:h});let f=[Ft].includes(o),g=p?o:t.winningSide&&Ki||Ca,v=Js({...t,matchUpStatusCodes:p&&a||[],matchUpStatus:g,context:h,removeScore:f});return te({result:v,stack:h})}function aPe({structure:t,matchUp:e,inContextMatchUp:i}){var r;let{drawPositions:n}=e,{positionAssignments:a}=Mr({structure:t}),o=a==null?void 0:a.filter(l=>(n==null?void 0:n.includes(l.drawPosition))&&l.participantId),s=(r=i==null?void 0:i.sides)==null?void 0:r.every(l=>l.participantId);return(o==null?void 0:o.length)===2||s}function TQ({collectionGroups:t=[]}){let e=Object.assign({},...t.filter(r=>st(r==null?void 0:r.groupValue)&&(r==null?void 0:r.groupNumber)).map(r=>({[r.groupNumber]:{...r,allGroupMatchUpsCompleted:!0,matchUpsCount:0,sideWins:[0,0],values:[0,0]}}))),i=Object.keys(e).map(r=>Ze(r));return{groupValueGroups:e,groupValueNumbers:i}}function oPe({collectionDefinition:t,groupValueNumbers:e,groupValueGroups:i,sideTieValues:r,tieMatchUps:n}){let a=n.filter(y=>y.collectionId===t.collectionId),o=[0,0],s=[0,0],l=a.every(y=>yr.includes(y.matchUpStatus)),{collectionValueProfiles:u,collectionGroupNumber:c,collectionValue:d,matchUpValue:p,winCriteria:m,scoreValue:h,setValue:f}=t,g=c&&e.includes(c),v=[0,0];if(a.forEach(y=>{y.winningSide&&(v[y.winningSide-1]+=1)}),st(p)?a.forEach(y=>{y.winningSide&&(o[y.winningSide-1]+=p)}):st(f)?a.forEach(y=>{var I,b;(b=(I=y.score)==null?void 0:I.sets)==null||b.forEach(S=>{S.winningSide&&(o[S.winningSide-1]+=f)})}):st(h)?a.forEach(y=>{var I,b;(b=(I=y.score)==null?void 0:I.sets)==null||b.forEach(S=>{let{side1TiebreakScore:w=0,side2TiebreakScore:U=0,side1Score:T=0,side2Score:D=0}=S;(y.matchUpStatus===Ki||y.winningSide||S.winningSide)&&(T||D?(o[0]+=T,o[1]+=D):(w||U)&&S.winningSide&&(o[S.winningSide-1]+=1))})}):Array.isArray(u)&&a.forEach(y=>{if(y.winningSide){let I=y.collectionPosition,b=sPe({collectionDefinition:t,collectionPosition:I});st(b)&&(o[y.winningSide-1]+=b)}}),st(d)){let y;if(m!=null&&m.aggregateValue)l&&(st(p||f||h)&&o[0]!==o[1]?y=o[0]>o[1]?1:2:v[0]!==v[1]&&(y=v[0]>v[1]?1:2));else if(m!=null&&m.valueGoal)y=o.reduce((I,b,S)=>b>=m.valueGoal?S+1:I,0);else{let I=Math.floor(t.matchUpCount/2)+1;y=v.reduce((b,S,w)=>S>=I?w+1:b,0)}y&&(g?i[c].values[y-1]+=d:s[y-1]+=d)}else g?(i[c].values[0]+=o[0]||0,i[c].values[1]+=o[1]||0):s=o;g?(i[c].sideWins[0]+=v[0]||0,i[c].sideWins[1]+=v[1]||0,i[c].allGroupMatchUpsCompleted=i[c].allGroupMatchUpsCompleted&&l,i[c].matchUpsCount+=a.length):s.forEach((y,I)=>r[I]+=y||0)}function sPe({collectionDefinition:t,collectionPosition:e}){var i,r;return(r=(i=t.collectionValueProfiles||[])==null?void 0:i.find(n=>n.collectionPosition===e))==null?void 0:r.matchUpValue}function $w(t){var e,i,r,n,a;let{sideAdjustments:o=[0,0],separator:s="-",drawDefinition:l,matchUpsMap:u,structure:c,matchUp:d,event:p}=t;if(!Array.isArray(o)||o.length!==2||isNaN(o.reduce((D,P)=>D+P)))return{error:se};if(!d)return{error:sa};let m=((e=In({matchUp:d,drawDefinition:l,structure:c,event:p}))==null?void 0:e.tieFormat)||(t==null?void 0:t.tieFormat);if(!m)return{error:lv};let h=qn({tieFormat:m});if(h.error)return h;let f=(m==null?void 0:m.collectionDefinitions)||[],g=(d==null?void 0:d.tieMatchUps)??[],v=[0,0],{groupValueGroups:y,groupValueNumbers:I}=TQ(m);for(let D of f)oPe({collectionDefinition:D,groupValueNumbers:I,groupValueGroups:y,sideTieValues:v,tieMatchUps:g});for(let D of I){let P=y[D],{allGroupMatchUpsCompleted:E,matchUpCount:R,winCriteria:N,groupValue:A,sideWins:M,values:C}=P,O;if(N!=null&&N.aggregateValue)E&&C[0]!==C[1]&&(O=C[0]>C[1]?1:2);else if(N!=null&&N.valueGoal)O=C.reduce((k,x,F)=>x>=N.valueGoal?F+1:k,void 0);else{let k=Math.floor(R/2)+1;O=M.reduce((x,F,$)=>F>=k?$+1:x,void 0)}O&&(v[O-1]+=A||0)}let b=v.map((D,P)=>(D||0)+o[P]),S={side1Score:b[0],side2Score:b[1],winningSide:void 0},w=b.join(s),U=b.slice().reverse().join(s),T;if(m!=null&&m.winCriteria){let{valueGoal:D,aggregateValue:P,tallyDirectives:E}=m.winCriteria;if(D?T=(i=b.map((R,N)=>({sideNumber:N+1,points:R})).find(({points:R})=>R>=D))==null?void 0:i.sideNumber:P&&g.every(R=>R.matchUpStatus&&yr.includes(R.matchUpStatus)||R.winningSide)&&b[0]!==b[1]&&(T=b[0]>b[1]?1:2),!T&&E){let R=d.matchUpId,N=d.hasContext?d:((r=u==null?void 0:u.drawMatchUps)==null?void 0:r[R])||l&&((n=Si({inContext:!0,drawDefinition:l,matchUpId:R}))==null?void 0:n.matchUp);if(N){let{completedTieMatchUps:A,order:M}=Rv({matchUps:[N]});if(A&&M!=null&&M.length){let C=M[0].participantId;T=(a=N.sides.find(({participantId:O})=>O===C))==null?void 0:a.sideNumber}}}}return T&&(S.winningSide=T),{scoreStringSide1:w,scoreStringSide2:U,winningSide:T,set:S}}function Bw({inContextDualMatchUp:t,drawDefinition:e,tournamentId:i,dualMatchUp:r,eventId:n}){var a,o;if(r){t||(t=(a=Si({matchUpId:r.matchUpId,inContext:!0,drawDefinition:e}))==null?void 0:a.matchUp);let{extension:s}=vt({element:e,name:Fu}),l=Ne((s==null?void 0:s.value)||{},!1,!0),u=({displaySideNumber:c,drawPosition:d,sideNumber:p})=>({drawPosition:d,sideNumber:p,displaySideNumber:c});r.sides=(o=t==null?void 0:t.sides)==null?void 0:o.map(c=>{var d;let p=c.participantId,m=p&&l[p]||void 0,{lineUp:h,...f}=((d=r.sides)==null?void 0:d.find(({sideNumber:v})=>v===c.sideNumber))??{},g=h!=null&&h.length?h:m;return{...u(c),...f,lineUp:g}}),Et({context:"ensureSidLineUps",matchUp:r,drawDefinition:e,tournamentId:i,eventId:n})}}function Yr(t){if(t)return Ne(t,!1,!0)}function s_(t){let e=We(t,[{[fn]:!0}]);return e.error?e:Object.keys(t.tournamentRecords).reduce((i,r)=>{i.tournamentIdMap[r]=[];let n=t.tournamentRecords[r].events??[],a=n.map(({eventId:s})=>s),o=n.map(s=>(s.drawDefinitions??[]).map(({drawId:l})=>l)).flat();return i.tournamentIdMap[r].push(...a,...o),i.eventIds.push(...a),i.drawIds.push(...o),i},{eventIds:[],drawIds:[],tournamentIdMap:{}})}function DQ({tournamentRecords:t,eventId:e,drawId:i}){let{tournamentIdMap:r}=s_({tournamentRecords:t});return(r?Object.keys(r):[]).find(n=>e&&(r==null?void 0:r[n].includes(e))||i&&(r==null?void 0:r[n].includes(i)))}function ic(t){var e,i,r,n;let{exitWhenNoValues:a,drawDefinition:o,matchUpStatus:s,removeScore:l,matchUpsMap:u,matchUpId:c,event:d}=t,p=t.tournamentRecords||t.tournamentRecord&&{[(e=t.tournamentRecord)==null?void 0:e.tournamentId]:t.tournamentRecord}||{},m=t.tournamentId||((i=t.tournamentRecord)==null?void 0:i.tournamentId);p&&DQ({tournamentRecords:p,...t});let h=m&&p[m];if(!h)return{error:ve};let f=Si({drawDefinition:o,event:d,matchUpId:c});if(f.error)return f;if(!f.matchUp)return{error:hn};let{matchUp:g,structure:v}=f;if(!g.tieMatchUps)return{error:la};Bw({tournamentId:h==null?void 0:h.tournamentId,eventId:d==null?void 0:d.eventId,dualMatchUp:g,drawDefinition:o});let{extension:y}=vt({name:xm,element:g});if(y!=null&&y.value)if(l)Dn({element:g,name:xm});else return{...Q,score:g.score};let I=(r=In({drawDefinition:o,structure:v,matchUp:g,event:d}))==null?void 0:r.tieFormat;g.tieFormat=Yr(I);let b=$w({drawDefinition:o,matchUpsMap:u,structure:v,matchUp:g,event:d}),{winningSide:S,set:w,scoreStringSide1:U,scoreStringSide2:T}=b,D=(w==null?void 0:w.side1Score)||(w==null?void 0:w.side2Score);if(a&&!g.score&&!D)return{...Q};let P={scoreStringSide1:U,scoreStringSide2:T,sets:w?[w]:[]},E=S&&[1,2].includes(S),R=E&&Ki||PL({matchUpStatus:s??g.matchUpStatus,tieMatchUps:g.tieMatchUps,winningSide:g.winningSide,score:P})&&cs||Qi,N=!!(g.winningSide&&!E),A=g.tieMatchUps.find(({score:C,winningSide:O,matchUpStatus:k})=>{var x;return((x=C==null?void 0:C.sets)==null?void 0:x.length)&&(C.sets[0].side1Score||C.sets[0].side2Score)||k&&yr.includes(k)||O}),M;if(g.tieFormat&&!E&&!A){let C=(n=In({drawDefinition:o,structure:v,event:d}))==null?void 0:n.tieFormat;C&&JSON.stringify(I)===JSON.stringify(C)&&(g.tieFormatId=void 0,g.tieFormat=void 0,M=!0)}return Js({appliedPolicies:t.appliedPolicies,matchUpStatus:R,score:P,removeWinningSide:N,tournamentRecord:h,drawDefinition:o,removeScore:l,winningSide:S,matchUpId:c,matchUp:g,event:d}),{...Q,score:P,removeWinningSide:N,tieFormatRemoved:M,winningSide:S}}function lPe({winnerMatchUpDrawPositionIndex:t,inContextDrawMatchUps:e,projectedWinningSide:i,sourceMatchUpStatus:r,winningDrawPosition:n,tournamentRecord:a,winnerTargetLink:o,sourceMatchUpId:s,drawDefinition:l,winnerMatchUp:u,dualMatchUp:c,matchUpsMap:d,event:p}){var m,h,f,g,v;let y="directWinner";if(o){let I=u.drawPositions||[],b=I[t],S=o.source.structureId,w=tt({structureId:S,drawDefinition:l});if(w.error)return w;let{structure:U}=w,{positionAssignments:T}=Mr({structureId:S,drawDefinition:l}),D=(m=T==null?void 0:T.find(M=>M.drawPosition===n))==null?void 0:m.participantId,P=o.target.structureId,{positionAssignments:E}=Mr({structureId:P,drawDefinition:l}),R=(h=E==null?void 0:E.find(M=>M.participantId===D))==null?void 0:h.drawPosition,N=E==null?void 0:E.filter(M=>{let C=I.includes(M.drawPosition),O=!M.participantId&&!M.bye&&!M.qualifier;return C&&O}).map(M=>M.drawPosition),A=N==null?void 0:N.includes(b);if(D&&o.target.roundNumber===1&&A)cl({drawPosition:b,participantId:D,structureId:P,inContextDrawMatchUps:e,sourceMatchUpStatus:r,tournamentRecord:a,drawDefinition:l,matchUpsMap:d,event:p});else if(D&&N!=null&&N.length){let M=N.pop();M&&cl({participantId:D,structureId:P,inContextDrawMatchUps:e,sourceMatchUpStatus:r,tournamentRecord:a,drawDefinition:l,drawPosition:M,matchUpsMap:d,event:p})}else if(R){let M=mg({drawPosition:R,matchUpId:u.matchUpId,inContextDrawMatchUps:e,sourceMatchUpStatus:r,tournamentRecord:a,sourceMatchUpId:s,drawDefinition:l,matchUpsMap:d});if(M.error)return te({result:M,stack:y})}else if((U==null?void 0:U.stage)!==Ke){let M="winner target position unavaiallble";return console.log(M),{error:M}}if(U!=null&&U.seedAssignments&&U.structureId!==P){let M=U.seedAssignments.find(({participantId:O})=>O===D),C=M==null?void 0:M.participantId;M&&C&&Tv({eventId:u==null?void 0:u.eventId,structureId:P,...M,tournamentRecord:a,drawDefinition:l,participantId:C})}}else{let I=mg({matchUpId:u.matchUpId,drawPosition:n,inContextDrawMatchUps:e,sourceMatchUpStatus:r,tournamentRecord:a,sourceMatchUpId:s,drawDefinition:l,matchUpsMap:d});if(I.error)return I}if(c&&i){let I=(f=c.sides)==null?void 0:f.find(b=>b.sideNumber===i);if(I!=null&&I.lineUp){let b=c.roundPosition,S=u.roundPosition,w=b===S&&b!==1||Math.floor(b/2)===S?2:1,U=(g=d==null?void 0:d.drawMatchUps)==null?void 0:g.find(({matchUpId:P})=>P===u.matchUpId),T=[1,2].map(P=>{var E;return{...((E=U.sides)==null?void 0:E.find(R=>R.sideNumber===P))||{},sideNumber:P}});U.sides=T;let D=U.sides.find(P=>P.sideNumber===w);if(D){let P=(v=I.lineUp)==null?void 0:v.filter(E=>E==null?void 0:E.participantId);D.lineUp=VL({lineUp:P}),Et({tournamentId:a==null?void 0:a.tournamentId,eventId:u==null?void 0:u.eventId,matchUp:U,context:y,drawDefinition:l})}}}return{...Q}}function uPe(t){var e,i,r;let{loserMatchUpDrawPositionIndex:n,inContextDrawMatchUps:a,projectedWinningSide:o,sourceMatchUpStatus:s,loserDrawPosition:l,tournamentRecord:u,loserTargetLink:c,drawDefinition:d,loserMatchUp:p,dualMatchUp:m,matchUpsMap:h,event:f}=t,g="directLoser",v=c.linkCondition,y=p.drawPositions||[],I=v===ll&&p.roundNumber===2&&Math.min(...y.filter(Boolean)),b=I||y[n],S=I||y[1-n],w=c.source.structureId,{structure:U}=tt({structureId:w,drawDefinition:d}),{matchUps:T}=qt({afterRecoveryTimes:!1,inContext:!0,drawDefinition:d,structure:U,event:f}),D=T.filter(L=>{var B;return(B=L.drawPositions)==null?void 0:B.includes(l)}).filter(L=>{let B=L.sides.find(G=>G.drawPosition===l),V=L.matchUpStatus===Ft||L.matchUpStatus===Pt&&!br(L);return(B==null?void 0:B.sideNumber)===L.winningSide&&!V}),P=v===ll&&D.length===0,{positionAssignments:E}=Mr({structureId:w,drawDefinition:d}),R=(e=E==null?void 0:E.find(L=>L.drawPosition===l))==null?void 0:e.participantId,N=c.target.structureId,{positionAssignments:A}=Mr({structureId:N,drawDefinition:d}),M=A==null?void 0:A.filter(({drawPosition:L})=>y.includes(L));if(M!=null&&M.some(L=>L.participantId===R))return{...Q};let C=M==null?void 0:M.filter(L=>{let B=y.includes(L.drawPosition),V=!L.participantId&&!L.bye&&!L.qualifier;return B&&V}).map(L=>L.drawPosition),O=C==null?void 0:C.includes(b),k=c.target.roundNumber>1&&(C==null?void 0:C.length),x=c.target.roundNumber===1&&O;if(I){let L=F();if(L.error)return te({result:L,stack:g})}else if(x){let L=_();if(L.error)return te({result:L,stack:g})}else if(R&&k){C.sort(lr);let L=C[0],B=cl({participantId:R,structureId:N,drawPosition:L,inContextDrawMatchUps:a,sourceMatchUpStatus:s,tournamentRecord:u,drawDefinition:d,matchUpsMap:h,event:f});if(B.error)return te({result:B,stack:g})}else return te({context:{loserDrawPosition:l,loserTargetLink:c,targetDrawPositionIsUnfilled:O},result:{error:O?av:qwe},stack:g});if(U!=null&&U.seedAssignments&&U.structureId!==N){let L=U.seedAssignments.find(({participantId:V})=>V===R),B=L==null?void 0:L.participantId;L&&B&&Tv({eventId:p==null?void 0:p.eventId,structureId:N,...L,tournamentRecord:u,drawDefinition:d,participantId:B})}if(m&&o){let L=(i=m.sides)==null?void 0:i.find(B=>B.sideNumber===3-o);if(L!=null&&L.lineUp){let{roundNumber:B,eventId:V}=p,{roundPosition:G}=m,j=B===1?2-G%2:1,z=(r=h==null?void 0:h.drawMatchUps)==null?void 0:r.find(({matchUpId:Y})=>Y===p.matchUpId),W=[1,2].map(Y=>{var re;return{...((re=z.sides)==null?void 0:re.find(K=>K.sideNumber===Y))||{},sideNumber:Y}});z.sides=W;let q=z.sides.find(Y=>Y.sideNumber===j);q&&(q.lineUp=VL({lineUp:L.lineUp}),Et({tournamentId:u==null?void 0:u.tournamentId,matchUp:z,context:g,drawDefinition:d,eventId:V}))}}return{...Q};function F(){let L="loserLinkFedFMLC";return te(P?{result:_(),stack:L}:{result:$(),stack:L})}function $(){let L=Za({drawPosition:S,structureId:N,tournamentRecord:u,drawDefinition:d,event:f});return te({result:L,stack:"assignLoserPositionBye"})}function _(){let L=R?cl({drawPosition:b,participantId:R,structureId:N,inContextDrawMatchUps:a,sourceMatchUpStatus:s,tournamentRecord:u,drawDefinition:d,matchUpsMap:h,event:f}):{error:hr};return te({result:L,stack:"assignLoserDrawPosition"})}}function PQ(t){var e;let i="directParticipants",r=o_(t);if(r.error)return te({result:r,stack:i});let n=Tw({matchUpStatus:t.matchUpStatus}),{dualWinningSideChange:a,projectedWinningSide:o,inContextDrawMatchUps:s,tournamentRecord:l,drawDefinition:u,matchUpStatus:c,dualMatchUp:d,matchUpsMap:p,winningSide:m,targetData:h,matchUpId:f,structure:g,matchUp:v,event:y}=t,I=!!v.collectionId,b=Yn({structure:g}),S=v.drawPositions,w;if(I){let{matchUpTieId:U,matchUpsMap:T}=t,D=ic({appliedPolicies:t.appliedPolicies,matchUpId:U,tournamentRecord:l,drawDefinition:u,matchUpsMap:T,event:y});if(w=D&&{tieMatchUpResult:D},S=(e=s.find(({matchUpId:P})=>P===U))==null?void 0:e.drawPositions,!a)return te({result:{...Q,...w},stack:i})}if(b)return te({result:{...Q,...w},stack:i});if(S){let U=o?o-1:m-1,T=1-U,D=S[U],P=S[T],{targetLinks:{loserTargetLink:E,winnerTargetLink:R,byeTargetLink:N},targetMatchUps:{winnerMatchUpDrawPositionIndex:A,loserMatchUpDrawPositionIndex:M,winnerMatchUp:C,loserMatchUp:O,byeMatchUp:k}}=h;if(C){let x=lPe({sourceMatchUpStatus:n&&c||Ki,winnerMatchUpDrawPositionIndex:A,sourceMatchUpId:f,inContextDrawMatchUps:s,projectedWinningSide:o,winningDrawPosition:D,tournamentRecord:l,winnerTargetLink:R,drawDefinition:u,winnerMatchUp:C,dualMatchUp:d,matchUpsMap:p,event:y});if(x.error)return te({result:x,stack:i})}if(O){let x=uPe({sourceMatchUpStatus:n&&c||Ki,loserMatchUpDrawPositionIndex:M,sourceMatchUpId:f,inContextDrawMatchUps:s,projectedWinningSide:o,loserDrawPosition:P,tournamentRecord:l,loserTargetLink:E,drawDefinition:u,loserMatchUp:O,winningSide:m,matchUpsMap:p,dualMatchUp:d,event:y});if(x.error)return te({result:x,stack:i})}if(k){let x=k.drawPositions||[],F=Math.min(...x.filter(Boolean)),$=N.target.structureId,_=Za({drawPosition:F,structureId:$,tournamentRecord:l,drawDefinition:u,event:y});if(_.error)return te({result:_,stack:i})}}else return te({result:{error:qb},stack:i});return te({result:{...Q,...w},stack:i})}function l_(t){var e,i,r,n;let a="genPlayoffStructure";if(!t.drawDefinition)return te({result:{error:$e},stack:a});let o=xw(t);if(o.error)return te({result:o,stack:a});let{structureId:s,addNameBaseToAttributeName:l,playoffStructureNameBase:u,finishingPositionNaming:c,finishingPositionLimit:d,playoffAttributes:p,playoffPositions:m,roundOffsetLimit:h,tournamentRecord:f,exitProfileLimit:g,roundProfiles:v,roundNumbers:y,idPrefix:I,isMock:b,event:S,uuids:w}=t,U=Ne(t.drawDefinition,!1,!0),{structure:T}=tt({structureId:s,drawDefinition:U});if(!T)return te({result:{error:Ai},stack:a});if(T.structureType===_n||T.structures)return jDe({sourceStructureId:T.structureId,...t,...o,drawDefinition:U});let{playoffRoundsRanges:D,playoffRounds:P}=o,{playoffPositionsReturned:E,error:R,playoffSourceRounds:N,playoffRoundsRanges:A}=lQ(t);if(R)return te({result:{error:R},stack:a});let M=(v==null?void 0:v.length)&&Object.assign({},...v),C=y||typeof v=="object"&&v.map(Y=>Object.keys(Y)).flat(),O=Array.isArray(C)&&C.map(Y=>!isNaN(Y)&&Ze(Y)).filter(Boolean);if(O){if(!Array.isArray(O))return te({result:{error:se},context:{validRoundNumbers:O},stack:a});O.forEach(Y=>{if(!(P!=null&&P.includes(Y)))return te({result:{error:se},context:{roundNumber:Y},stack:a})})}m&&m.forEach(Y=>{if(!(E!=null&&E.includes(Y)))return te({result:{error:se},context:{playoffPosition:Y},stack:a})});let k=O||N,x=O?D:A,F=[],$=[];for(let Y of k??[]){let re=x==null?void 0:x.find(ne=>ne.roundNumber===Y);if(!re)return te({result:{error:se},context:{roundNumber:Y},stack:a});let K=re.finishingPositions.length,H=Math.min(...re.finishingPositions)-1,Z=2,X=Y&&(M==null?void 0:M[Y])&&Z+M[Y]-1,ie=wf({exitProfile:`0-${Y}`,addNameBaseToAttributeName:l,playoffStructureNameBase:u,finishingPositionOffset:H,playoffAttributes:p,exitProfileLimit:g,stage:Bi,roundOffset:0,drawDefinition:U,sequenceLimit:X,stageSequence:Z,drawSize:K,idPrefix:I,isMock:b,uuids:w,finishingPositionNaming:c,finishingPositionLimit:d,roundOffsetLimit:h});if(ie.error)return te({result:ie,stack:a});let{structures:ae,links:le}=ie;if(ae!=null&&ae.length&&F.push(...ae),le!=null&&le.length&&$.push(...le),ie.structureId&&Y){let ne={linkType:Yl,source:{structureId:s,roundNumber:Y},target:{structureId:ie.structureId,feedProfile:$o,roundNumber:1}};$.push(ne)}}if(!F.length)return te({result:{error:se},info:"No structures generated",stack:a});U.structures.push(...F),U.links.push(...$);let{matchUps:_,matchUpsMap:L}=fr({inContext:!0,drawDefinition:U}),B=F.map(({structureId:Y})=>Y),V=_==null?void 0:_.filter(({structureId:Y})=>B.includes(Y)).map(Pr),G=(e=L==null?void 0:L.drawMatchUps)==null?void 0:e.filter(({matchUpId:Y})=>V==null?void 0:V.includes(Y));if(G!=null&&G.length){let Y=(i=In({drawDefinition:U,event:S}))==null?void 0:i.tieFormat;Y&&G.forEach(re=>{let{tieMatchUps:K}=Fw({matchUp:re,tieFormat:Y,isMock:b});Object.assign(re,{tieMatchUps:K,matchUpType:fi})})}(r=_==null?void 0:_.filter(Y=>Cd({matchUp:Y})&&Y.structureId===s))==null||r.forEach(Y=>{let{matchUpId:re,score:K,winningSide:H}=Y,Z=On({inContextDrawMatchUps:_,drawDefinition:U,matchUpId:re}),X=PQ({inContextDrawMatchUps:_,tournamentRecord:f,drawDefinition:U,matchUpsMap:L,winningSide:H,targetData:Z,matchUpId:re,structure:T,matchUp:Y,score:K,event:S});X.error&&console.log(X.error)}),(n=_==null?void 0:_.filter(Y=>Y.matchUpStatus===jt&&Y.structureId===s))==null||n.forEach(Y=>{let{matchUpId:re}=Y,K=On({inContextDrawMatchUps:_,drawDefinition:U,matchUpId:re}),{targetLinks:{loserTargetLink:H},targetMatchUps:{loserMatchUpDrawPositionIndex:Z,loserMatchUp:X}}=K;if(H&&X){let ie=H.target.structureId,ae=X.drawPositions[Z],le=Za({drawPosition:ae,structureId:ie,tournamentRecord:f,drawDefinition:U,event:S});le.error&&console.log(le.error)}});let j=[],z=tp({inContextDrawMatchUps:_,drawDefinition:U,matchUpsMap:L}).goesToMap,{structure:W}=tt({drawDefinition:t.drawDefinition,structureId:s}),{matchUps:q}=qt({structure:W});return q.forEach(Y=>{var re,K;let H=z==null?void 0:z.loserMatchUpIds[Y.matchUpId];if(H&&Y.loserMatchUpId!==H){Y.loserMatchUpId=H;let X={tournamentId:f==null?void 0:f.tournamentId,eventId:(re=t.event)==null?void 0:re.eventId,context:a,matchUp:Y};j.push(X)}let Z=z==null?void 0:z.winnerMatchUpIds[Y.matchUpId];if(Z&&Y.winnerMatchUpId!==Z){Y.winnerMatchUpId=Z;let X={tournamentId:f==null?void 0:f.tournamentId,eventId:(K=t.event)==null?void 0:K.eventId,context:a,matchUp:Y};j.push(X)}}),{structures:F,matchUpModifications:j,links:$,drawDefinition:U,...Q}}function RQ({element:t}){if(!t)return{error:se};if(!t.timeItems)return{};if(!Array.isArray(t.timeItems))return{error:se};let e=(i,r)=>(n,a)=>(a[i]&&(n[a[i]]=a[r]),n);return t.timeItems.reduce(e("itemType","itemValue"),{})}function wl(t){let{duplicateValues:e=!0,creationTime:i=!0,removePriorValues:r,timeItem:n}=t;if(!n)return{error:cF};let a=LX(t);if(a.error)return a;if(!(At(n)&&Di(n.itemType)&&Object.keys(n).includes("itemValue")))return{error:uF};if(!a.timeItems)a.timeItems=[];else if(cPe({element:a,duplicateValues:e,timeItem:n}))return{...Q};if(n.itemSubTypes&&!n.itemSubTypes.length&&delete n.itemSubTypes,i){let o=new Date().toISOString();Object.assign(n,{createdAt:o})}return r&&(a.timeItems=a.timeItems.filter(({itemType:o})=>n.itemType!==o)),r&&!n.itemValue||a.timeItems.push(n),{...Q}}function cPe({element:t,duplicateValues:e,timeItem:i}){var r;let{itemType:n,itemSubTypes:a,itemValue:o}=i,s=n&&((r=Do({itemSubTypes:a,itemType:n,element:t}))==null?void 0:r.timeItem);return s&&JSON.stringify(s==null?void 0:s.itemValue)===JSON.stringify(o)&&!e}function u_({creationTime:t=!0,removePriorValues:e,tournamentRecord:i,duplicateValues:r,participantId:n,timeItem:a}){if(!i)return{error:ve};if(!n)return{error:hr};let o=nd({tournamentRecord:i,participantId:n});return o.error?o:wl({element:o.participant,removePriorValues:e,duplicateValues:r,creationTime:t,timeItem:a})}function Vw(t){let{removePriorValues:e,tournamentRecord:i,duplicateValues:r,creationTime:n,timeItem:a}=t;if(!i)return{error:ve};let o=wl({element:i,removePriorValues:e,duplicateValues:r,creationTime:n,timeItem:a});if(o.error)return o;let s=RQ({element:i});return ut({payload:{parentOrganisation:i.parentOrganisation,tournamentId:i.tournamentId,timeItemValues:s},topic:Rp}),o}function Bh(t){let{removePriorValues:e,duplicateValues:i,creationTime:r,timeItem:n,event:a}=t;return a?wl({removePriorValues:e,duplicateValues:i,element:a,creationTime:r,timeItem:n}):{error:mo}}function EQ(t){return cR({...t,itemType:"attachConsolationStructures"})}function c_(t){return cR({...t,itemType:"attachPlayoffStructures"})}function cR({itemType:t="attachStructures",matchUpModifications:e,tournamentRecord:i,drawDefinition:r,structures:n,links:a=[],event:o}){var s,l,u;let c="attachStructures";if(!r)return{error:$e};if(!Array.isArray(n)||!Array.isArray(a))return te({result:{error:se},stack:c});let d=I=>{var b;return[I.source.structureId,I.source.roundNumber||((b=I.source.finishingPositions)==null?void 0:b.join("|")),I.target.roundNumber].join("|")},p=(s=r.links)==null?void 0:s.map(d);if(a.some(I=>{let b=d(I);return p==null?void 0:p.includes(b)}))return te({result:{error:fF},info:"playoff structure exists",stack:c});a.length&&((l=r.links)==null||l.push(...a));let m=n.map(({structureId:I})=>I),h=(u=r.structures)==null?void 0:u.map(({structureId:I})=>I);r.structures=(r.structures??[]).map(I=>m.includes(I.structureId)?n.find(({structureId:b})=>b===I.structureId):I);let f=n==null?void 0:n.filter(({structureId:I})=>!(h!=null&&h.includes(I)));f.length&&r.structures.push(...f),tp({drawDefinition:r});let g=n.map(I=>{var b;return((b=qt({structure:I}))==null?void 0:b.matchUps)||[]}).flat();xc({tournamentId:i==null?void 0:i.tournamentId,eventId:o==null?void 0:o.eventId,drawDefinition:r,matchUps:g});let v=n.map(({structureId:I})=>I);if(ui({drawDefinition:r,structureIds:v}),e==null?void 0:e.length){let I={};e.forEach(S=>{var w;let U=(w=S.matchUp)==null?void 0:w.matchUpId;U&&(I[U]=S)});let b=S=>{S.matchUps.forEach(w=>{if(I[w.matchUpId]){let{tieMatchUps:U,...T}=I[w.matchUpId].matchUp;if(Object.assign(w,T),U==null?void 0:U.length){let D={};U.forEach(P=>I[P.matchUpId]=P),w.tieMatchUps.forEach(P=>Object.assign(P,D[P.matchUpId]))}I[w.matchUpId].matchUp=w,Et(I[w.matchUpId])}})};r.structures.forEach(S=>{if(h!=null&&h.includes(S.structureId))if(S.structures)for(let w of S.structures)b(w);else b(S)})}let y=f.map(Ma("structureId"));if(i){let I={itemValue:{structureIds:v,drawId:r.drawId},itemType:t};wl({element:i,timeItem:I})}return{...Q,addedStructureIds:y}}function dR(t){var e,i;let{structures:r,links:n,matchUpModifications:a,error:o}=l_(t);if(o)return{error:o};let s=t.drawDefinition;return c_({tournamentId:(e=t.tournamentRecord)==null?void 0:e.tournamentId,eventId:((i=t.event)==null?void 0:i.eventId)||t.eventId,matchUpModifications:a,drawDefinition:s,structures:r,links:n})}function rp(t){let e=We(t,[{_anyOf:{[fn]:!1,[Ur]:!1,[$n]:!1,[ed]:!1},[OF]:!0}]);if(e.error)return e;let i=[],r=t.drawDefinition??t.event??((t.tournamentId||!t.tournamentRecords)&&t.tournamentRecord);if(r){let n=B2(t,r);if(n.error)return n;i.push(...(n==null?void 0:n.applied)??[]),t.drawDefinition&&ui({drawDefinition:t.drawDefinition,tournamentId:t.tournamentId})}else if(t.tournamentRecords){let n=Object.keys(t.tournamentRecords);if(!n.length)return{error:ve};for(let a of n){let o=t.tournamentRecords[a],s=B2(t,o);if(s.error)return s;i.push(...(s==null?void 0:s.applied)??[])}}else return{error:ve};return i.length?{...Q,applied:i}:{error:iF}}function B2(t,e){let i=Bt(t).appliedPolicies??{};e.extensions||(e.extensions=[]);let r=[],n=Object.keys(t.policyDefinitions);if(!n.length)return{error:sP};for(let a of n)if(!i[a]||t.allowReplacement){let o=t.policyDefinitions[a];if(!o)continue;if(!At(o))return{error:se};let{policyName:s,...l}=o;if(!l||!Object.keys(l).length||s&&!Di(s))return{error:se};i[a]=t.policyDefinitions[a],r.push(a)}return r!=null&&r.length?{..._t({element:e,extension:{name:ly,value:i}}),applied:r}:{applied:r,error:iF}}function d_({tournamentRecord:t,drawDefinition:e,flightProfile:i,drawName:r,drawId:n,event:a}){var o;if(!r||typeof r!="string")return te({result:{error:se},context:{drawName:r}});i||(i=Hi({event:a}).flightProfile);let s=(o=i==null?void 0:i.flights)==null?void 0:o.find(l=>l.drawId===n);if(s){s.drawName=r;let l={name:rs,value:{...i,flights:i.flights}};id({event:a,extension:l})}return e&&(e.drawName=r,ui({tournamentId:t==null?void 0:t.tournamentId,drawDefinition:e})),!s&&!e?{error:$e}:{...Q,flight:s}}function CQ({tournamentRecord:t,drawDefinition:e,drawUpdates:i,drawId:r,event:n}){var a;if(!At(i))return{error:se};let o=Hi({event:n}).flightProfile,s=i.drawName&&d_({drawName:i.drawName,tournamentRecord:t,drawDefinition:e,flightProfile:o,drawId:r,event:n});if(s!=null&&s.error)return s==null?void 0:s.error;let l=(s==null?void 0:s.flight)||((a=o==null?void 0:o.flights)==null?void 0:a.find(u=>u.drawId===r));if(!l&&!e)return{error:$e};if(l){let u={name:rs,value:{...o,flights:o.flights}};id({event:n,extension:u})}return e&&(i.policyDefinitions&&rp({policyDefinitions:i.policyDefinitions,drawDefinition:e}),ui({tournamentId:t==null?void 0:t.tournamentId,drawDefinition:e})),{...Q}}function MQ({tournamentRecord:t,removeScheduling:e,drawDefinition:i}){var r,n;if(!i)return{error:$e};let a=ln({drawDefinition:i}),o=l=>{var u;return(u=a==null?void 0:a.drawMatchUps)==null?void 0:u.find(c=>c.matchUpId===l)};for(let l of i.structures||[]){let{positionAssignments:u,stage:c,stageSequence:d}=l;u&&(d!==1||![Ke,Ae].includes(c))&&(l.positionAssignments=u.map(h=>(delete h.participantId,h)),l.seedAssignments=[]);let{matchUps:p,isRoundRobin:m}=qt({afterRecoveryTimes:!1,inContext:!0,matchUpsMap:a,structure:l});for(let h of p){let{matchUpId:f,roundNumber:g}=h,v=h.sides||[],y=o(f);if(y){if(delete y.extensions,delete y.notes,y.matchUpStatus!==jt&&Object.assign(y,uR),g&&g>1&&((r=y.drawPositions)==null?void 0:r.length)&&!m){let I=v==null?void 0:v.map(({drawPosition:S,participantFed:w})=>!w&&S).filter(Boolean),b=y.drawPositions.map(S=>I.includes(S)?void 0:S);y.drawPositions=b}e?delete y.timeItems:(n=y.timeItems)!=null&&n.length&&(y.timeItems=y.timeItems.filter(I=>I.itemType&&![Ql,Lc,Ch,UL,Mh,Nh].includes(I.itemType))),Et({tournamentId:t==null?void 0:t.tournamentId,context:"resetDrawDefiniton",drawDefinition:i,matchUp:y})}}}i.extensions=i.extensions.filter(l=>l.name!==bf);let s=(i.structures||[]).map(({structureId:l})=>l);return ui({drawDefinition:i,structureIds:s}),{...Q}}function jw({tournamentRecord:t}){var e;if(!t)return{error:ve};let i={positionsNoOutcomes:[],canBePruned:[],matchPlay:[],inactive:[],drawAnalysis:{}},r={};return((e=t.events)==null?void 0:e.map(n=>{let a=n.eventId;return r[a]=n,((n==null?void 0:n.drawDefinitions)||[]).map(o=>({drawDefinition:o,eventId:a}))}).flat().filter(Boolean)).forEach(({drawDefinition:n,eventId:a})=>{let o=0,s=0,l=0,{allStructuresLinked:u}=aR({drawDefinition:n}),c=r[a],d=((n==null?void 0:n.structures)||[]).map(b=>{let{stage:S,stageSequence:w,structureId:U}=b,T=Om[S],{inContextStructureMatchUps:D}=Dw({drawDefinition:n,structure:b,event:c}),P=D==null?void 0:D.filter(({winningSide:L})=>L),E=P.filter(Boolean).length||0;s+=E,l+=D.length-s;let R=Math.max(P.filter(({roundNumber:L})=>L===1).map(({roundPosition:L})=>L)),{positionAssignments:N}=si({structure:b}),A=N==null?void 0:N.filter(({participantId:L})=>L);o+=(A==null?void 0:A.length)??0;let M=((N==null?void 0:N.length)??0)-((A==null?void 0:A.length)??0),{roundMatchUps:C,roundProfile:O,roundNumbers:k,maxMatchUpsCount:x}=An({matchUps:D}),F=O&&Object.keys(O).filter(L=>!O[L].inactiveRound).map(L=>parseInt(L)),$=O&&Object.keys(O).filter(L=>O[L].inactiveRound).map(L=>parseInt(L)),_=O&&Object.values(O).every(L=>L.inactiveRound);return{positionsAssignedCount:(A==null?void 0:A.length)??0,maxWinningSideFirstRoundPosition:R,unassignedPositionsCount:M,inactiveStructure:_,maxMatchUpsCount:x,inactiveRounds:$,roundMatchUps:C,activeRounds:F,roundNumbers:k,roundProfile:O,structureId:U,stageSequence:w,orderNumber:T,stage:S}}),p=d.find(b=>b.orderNumber===2&&b.stageSequence===1),m=d.filter(({inactiveStructure:b})=>!b).length,{links:h}=bv({structureId:p.structureId,drawDefinition:n}),f=Ze(p.activeRounds[0])===1&&p.activeRounds.length===1&&m===1,g=d==null?void 0:d.every(({inactiveStructure:b})=>b),v=!h.length&&p.activeRounds.length&&(p.roundProfile[1].inactiveCount||p.inactiveRounds.length),y=n.drawId;o&&!s&&i.positionsNoOutcomes.push(y),g&&i.inactive.push(y),f&&i.matchPlay.push(y),v&&i.canBePruned.push(y);let I={matchUpsWithWinningSideCount:s,matchUpsNoOutcomeCount:l,positionsAssignedCount:o,allStructuresLinked:u,structuresData:d,inactiveDraw:g,isMatchPlay:f,drawId:y};i.drawAnalysis[y]=I}),{...Q,drawsAnalysis:i}}function NQ({matchPlayDrawPositions:t=!0,tournamentRecord:e,drawDefinition:i,drawId:r}){var n;if(!e)return{error:ve};if(!i)return{error:$e};let a=[],{drawsAnalysis:o}=jw({tournamentRecord:e});if(o.canBePruned.includes(r)){let s=o.matchPlay.includes(r),l=o.drawAnalysis[r],{structures:[u]}=ns({stageSequence:1,drawDefinition:i,stage:Ae}),c=l.structuresData.find(({structureId:h})=>u.structureId===h),d=(u.matchUps??[]).sort((h,f)=>h.roundPosition-f.roundPosition);a=d.filter(({roundNumber:h})=>!c.inactiveRounds.includes(h));let p=a.map(Pr),m=d.map(Pr).filter(h=>!p.includes(h));if(s){let h=a.filter(({roundNumber:I})=>!c.inactiveRounds.includes(I)).filter(({winningSide:I})=>I),f=h.map(Pr),g=p.filter(I=>!f.includes(I));m.push(...g);let v=h.flatMap(I=>I.drawPositions??[]).filter(Boolean).flat(),y=Object.assign({},...v.map((I,b)=>({[I]:b+1})));if(h.forEach(I=>{t?I.drawPositions=I.drawPositions.map(b=>y[b]):delete I.drawPositions}),t){let I=(n=u==null?void 0:u.positionAssignments)==null?void 0:n.filter(b=>v.includes(b.drawPosition)).map(b=>(b.drawPosition=y[b.drawPosition],b));u.positionAssignments=I}else u.positionAssignments=[];u.matchUps=h,a=h}Zu({tournamentId:e==null?void 0:e.tournamentId,matchUpIds:m,drawDefinition:i}),ui({drawDefinition:i})}return{...Q,matchUps:a}}function AQ({tournamentRecord:t,drawDefinition:e,participantId:i,drawPosition:r,structureId:n,qualifier:a,event:o,bye:s}){if(!e)return{error:$e};if(!r)return{error:ov};if(!n)return{error:Xa};if(s){let l=Za({tournamentRecord:t,drawDefinition:e,drawPosition:r,structureId:n,event:o});if(l.error)return l}else{if(a)return{error:gP};{let l=cl({tournamentRecord:t,drawDefinition:e,participantId:i,drawPosition:r,structureId:n,event:o});if(l.error)return l}}return{...Q}}function OQ(t){var e,i,r,n,a;let o=t.matchUpIds??[],{drawDefinition:s}=t,l=t.structureId??((i=(e=s==null?void 0:s.structures)==null?void 0:e.find(m=>{var h;return(h=m.matchUps)==null?void 0:h.some(({matchUpId:f})=>o.includes(f))}))==null?void 0:i.structureId)??((n=(r=s==null?void 0:s.structures)==null?void 0:r[0])==null?void 0:n.structureId);if(!l)return{error:Ai};let u=(a=s.structures)==null?void 0:a.find(m=>m.structureId===l);if(!u)return{error:Ai};let c=u==null?void 0:u.matchUps,d=c==null?void 0:c.find(m=>!!m.roundPosition);if(u.structures||d||u.finishingPosition===Th)return{error:Sp};let p=c.filter(({roundNumber:m})=>{var h;return(h=t.roundNumbers)==null?void 0:h.includes(m)}).map(Pr);return o=o.filter(m=>!p.includes(m)),t.roundNumbers&&!o.length&&(o=p),{existingMatchUps:c,matchUpIds:o,structureId:l,structure:u}}function kQ(t){let e=We(t,[{[$n]:!0},{[og]:{[aw]:!1,roundNumbers:!1},[Ha]:se,[Jn]:cn}]);if(e.error)return e;let{removeIncomplete:i=!1,removeUnAssigned:r=!0,removeCompleted:n=!1,tournamentRecord:a,drawDefinition:o,event:s}=t,l=OQ(t);if(l.error)return l;let{structure:u,structureId:c,existingMatchUps:d,matchUpIds:p}=l,m=[],h=(d==null?void 0:d.filter(({matchUpId:v,score:y,winningSide:I})=>{if(I&&!n)return!1;if(I||br({score:y})){if(!I&&!i)return!1;m.push(v)}else if(!r)return!1;return p==null?void 0:p.includes(v)}))??[],f=h.map(Pr),g=h.map(({tieMatchUps:v})=>v==null?void 0:v.map(Pr)).filter(Boolean).flat();if(f.length){u.matchUps=(u.matchUps??[]).filter(({matchUpId:I})=>!f.includes(I)),Zu({tournamentId:a==null?void 0:a.tournamentId,matchUpIds:[...g,...f],action:"deleteAdHocMatchUps",eventId:s==null?void 0:s.eventId,drawDefinition:o});let v=dt(u.matchUps.map(Ma("roundNumber"))),y=Bwe(v);if(y.length){y.reverse();for(let I of y)u.matchUps.forEach(b=>{b.roundNumber&&b.roundNumber>I&&(b.roundNumber-=1,Et({tournamentId:a==null?void 0:a.tournamentId,context:["adHoc round deletion"],eventId:s==null?void 0:s.eventId,drawDefinition:o,matchUp:b}))})}if(m.length){u.positionAssignments=dt(u.matchUps.flatMap(U=>(U.sides??[]).map(T=>T.participantId)).filter(Boolean)).map(U=>({participantId:U}));let I=(u==null?void 0:u.matchUpFormat)??(o==null?void 0:o.matchUpFormat)??(s==null?void 0:s.matchUpFormat),b=l.existingMatchUps.some(U=>U.matchUpType===Ba)?{matchUpTypes:[Ba]}:void 0,{matchUps:S}=qt({afterRecoveryTimes:!1,inContext:!0,matchUpFilters:b,structure:u,event:s});Yn({structure:u})&&(u.positionAssignments=dt(S.flatMap(U=>(U.sides??[]).map(T=>T.participantId)).filter(Boolean)).map(U=>({participantId:U})));let w=n_({positionAssignments:u.positionAssignments,tournamentRecord:a,drawDefinition:o,matchUpFormat:I,matchUps:S,event:s});w.error&&console.log(w)}ui({structureIds:[c],eventId:s==null?void 0:s.eventId,drawDefinition:o})}return!f.length&&p.length?{error:IP}:{...Q,deletedMatchUpsCount:[...f,...g].length}}function xQ({removeCompletedMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:r,roundNumber:n,event:a}){if(!e)return{error:ve};if(!i)return{error:$e};if(!n)return te({result:{error:Je},info:"roundNumber required"});let o=tt({drawDefinition:i,structureId:r});if(o.error)return o;let s=o.structure;return s!=null&&s.structures?{error:Sp}:Yn({structure:s})?dPe({tournamentId:e.tournamentId,removeCompletedMatchUps:t,eventId:a.eventId,drawDefinition:i,roundNumber:n,structure:s}):(console.log("not implemented"),{...Q})}function dPe({removeCompletedMatchUps:t,drawDefinition:e,tournamentId:i,roundNumber:r,structure:n,eventId:a}){let o=(n==null?void 0:n.matchUps)??[],s=[],l=[],u=!1;if(o.reduce((c,d)=>{let p=d==null?void 0:d.roundNumber;return p?c.includes(p)?c:c.concat(p):c},[]).sort(lr).includes(r)){let c=o.filter(d=>{let p=d.roundNumber===r&&(!yr.includes(d.matchUpStatus)||t);return p&&(l.push(d.matchUpId),d.tieMatchUps&&s.push(...d.tieMatchUps.map(Pr))),!p});l.length&&(Zu({matchUpIds:[...s,...l],drawDefinition:e,tournamentId:i,eventId:a}),c.some(d=>d.roundNumber===r)||(c.forEach(d=>{d.roundNumber>r&&(d.roundNumber-=1,Et({drawDefinition:e,tournamentId:i,eventId:a,matchUp:d}))}),u=!0),n.matchUps=c)}return{deletedMatchUpsCount:l.length,roundRemoved:u,...Q}}function pR(t){var e,i,r,n,a,o;let{suppressNotifications:s,tournamentRecord:l,drawDefinition:u,matchUps:c,event:d}=t;if(typeof u!="object")return{error:$e};let p=t==null?void 0:t.structureId;if(!p&&((e=u.structures)==null?void 0:e.length)===1&&(p=(r=(i=u.structures)==null?void 0:i[0])==null?void 0:r.structureId),typeof p!="string")return{error:Xa};if(!Ro(c))return{error:se,info:ip("matchUps")};let m=(n=u.structures)==null?void 0:n.find(y=>y.structureId===p);if(!m)return{error:Ai};let h=(m==null?void 0:m.matchUps).find(y=>!!y.roundPosition);if(m.structures||h||m.finishingPosition===Th)return{error:Sp};let f=((o=(a=Hr({tournamentRecord:l,inContext:!1}))==null?void 0:a.matchUps)==null?void 0:o.map(Pr))??[],g=c.map(Pr);if(Nn(f,g))return{error:B9,info:"One or more matchUpIds already present in tournamentRecord"};m.matchUps.push(...c);let v=c.map(({tieMatchUps:y})=>y).filter(Boolean).flat();return s||(xc({tournamentId:l==null?void 0:l.tournamentId,matchUps:[...v,...c],eventId:d==null?void 0:d.eventId,drawDefinition:u}),ui({drawDefinition:u,structureIds:[p]})),{...Q}}function FQ({tournamentRecord:t,drawDefinition:e,drawPosition:i,structureId:r,subOrder:n,event:a}){var o;if(!e)return{error:$e};if(!r)return{error:Xa};if(!i)return{error:ov};let{structure:s}=tt({drawDefinition:e,structureId:r});if(!s)return{error:Ai};let l=s;s.structures&&s.structureType===_n&&(l=(o=s.structures)==null?void 0:o.find(h=>{var f;return(f=h.positionAssignments)==null?void 0:f.find(g=>g.drawPosition===i)}));let u=l==null?void 0:l.positionAssignments,c=u==null?void 0:u.find(h=>h.drawPosition===i);c&&_t({element:c,extension:{name:ug,value:n}});let d=((a==null?void 0:a.eventType)===fi||e.matchUpType===fi||((a==null?void 0:a.tieFormat)??(e==null?void 0:e.tieFormat)??(s==null?void 0:s.tieFormat)))&&{matchUpTypes:[fi]},{matchUps:p}=qt({structure:l,afterRecoveryTimes:!1,inContext:!0,matchUpFilters:d,event:a}),m=(s==null?void 0:s.matchUpFormat)??e.matchUpFormat;return n_({positionAssignments:u,tournamentRecord:t,drawDefinition:e,matchUpFormat:m,matchUps:p,event:a}),ui({drawDefinition:e,structureIds:[r]}),{...Q}}var LQ={};bt(LQ,{addGoesTo:()=>tp,allPlayoffPositionsFilled:()=>zL,checkValidEntries:()=>fR,findDrawDefinition:()=>f_,getAssignedParticipantIds:()=>Op,getAvailableMatchUpsCount:()=>mR,getAvailablePlayoffProfiles:()=>xw,getDrawDefinitionTimeItem:()=>mL,getDrawParticipantRepresentativeIds:()=>m_,getDrawStructures:()=>ns,getDrawTypeCoercion:()=>Gw,getEligibleVoluntaryConsolationParticipants:()=>p_,getMatchUpsMap:()=>ln,getParticipantIdFinishingPositions:()=>h_,getPositionAssignments:()=>fy,getPositionsPlayedOff:()=>Pv,getSeedingThresholds:()=>$L,getSeedsCount:()=>Hw,getStructureSeedAssignments:()=>go,getTeamLineUp:()=>ep,getValidGroupSizes:()=>Nw,isAdHoc:()=>Yn,isCompletedStructure:()=>_c,isValidForQualifying:()=>I_,positionActions:()=>v_});function p_({excludedMatchUpStatuses:t=[],includeEventParticipants:e,includeQualifyingStage:i,finishingRoundLimit:r,policyDefinitions:n,roundNumberLimit:a,tournamentRecord:o,drawDefinition:s,matchUpsLimit:l,requirePlay:u,requireLoss:c,allEntries:d,winsLimit:p,event:m}){var h,f,g,v,y;if(!s)return{error:$e};let I=[Ae,Bi];i&&I.push(Ke);let b=m!=null&&m.eventType?{matchUpTypes:[m.eventType]}:void 0,S=s!=null&&s.matchUpType?{matchUpTypes:[s.matchUpType]}:void 0,w=e&&m?((h=au({contextFilters:{stages:I},matchUpFilters:b,tournamentRecord:o,inContext:!0,event:m}))==null?void 0:h.matchUps)??[]:((f=Pn({contextFilters:{stages:I},matchUpFilters:S,tournamentRecord:o,inContext:!0,drawDefinition:s}))==null?void 0:f.matchUps)??[],U=Eh({stage:Lr,drawDefinition:s}).map(({participantId:_})=>_),T={},D={},P={},E={};n||(n=ec({policyTypes:[vM],tournamentRecord:o,drawDefinition:s,event:m}).policyDefinitions);let R=n==null?void 0:n[vM];t=t.length&&t||(R==null?void 0:R.excludedMatchUpStatuses)||[],e=e??(R==null?void 0:R.includeEventParticipants),d=d??(R==null?void 0:R.allEntries),r=r??(R==null?void 0:R.finishingRoundLimit),a=a??(R==null?void 0:R.roundNumberLimit),l=l??(R==null?void 0:R.matchUpsLimit),u===void 0&&(u=(R==null?void 0:R.requirePlay)!==void 0?R.requirePlay:!0),c===void 0&&(c=(R==null?void 0:R.requireLoss)!==void 0?R.requireLoss:!0),p=p??(R==null?void 0:R.winsLimit);for(let _ of w){if(u&&_.winningSide&&![1,2].includes(_.winningSide)&&_.matchUpStatus!==tr||_.finishingRound&&r&&_.finishingRound>=r||_.finishingRound&&a&&_.finishingRound<=a)continue;let L=(g=_.sides)==null?void 0:g.find(({sideNumber:V})=>_.winningSide&&V===3-_.winningSide),B=(v=_.sides)==null?void 0:v.find(({sideNumber:V})=>_.winningSide&&V===_.winningSide);if((y=_.sides)==null||y.forEach(V=>{var G;let j=(G=V==null?void 0:V.participant)==null?void 0:G.participantId;j&&(P[j]=V.participant,_.matchUpStatus===tr&&!u&&(D[j]=V.participant,T[j]||(T[j]=0),(!_.matchUpStatus||!t.includes(_.matchUpStatus))&&(T[j]+=1)))}),L==null?void 0:L.participant){let V=L.participant.participantId;D[V]=L.participant,T[V]||(T[V]=0),_.matchUpStatus&&!t.includes(_.matchUpStatus)&&(T[V]+=1)}if(B!=null&&B.participant){let V=B.participant.participantId;E[V]||(E[V]=0),E[V]+=1,T[V]||(T[V]=0),_.matchUpStatus&&!t.includes(_.matchUpStatus)&&(T[V]+=1)}}let N=(o==null?void 0:o.participants)&&!u&&!c&&d,A=N?((e&&m?m.entries:s.entries)??[]).filter(_=>![Jl,Po].includes(_.entryStatus)).map(({participantId:_})=>_):[],M=Object.keys(D),C=N?((o==null?void 0:o.participants)??[]).filter(({participantId:_})=>A.includes(_)):c&&Object.values(D)||Object.values(P),O=_=>!c||M.includes(_),k=_=>!u||(T[_]||0)>=0,x=_=>!p||(E[_]||0)<=p,F=_=>!l||T[_]<=l,$=_=>!U.includes(_);return{eligibleParticipants:C.filter(_=>O(_.participantId)&&k(_.participantId)&&x(_.participantId)&&F(_.participantId)&&$(_.participantId)).map(_=>{var L;return{..._,individualParticipants:(L=_.individualParticipantIds)==null?void 0:L.map(B=>{var V;return(V=o==null?void 0:o.participants)==null?void 0:V.find(G=>G.participantId===B)})}}),losingParticipantIds:M,...Q}}function mR(t){var e,i,r,n,a,o,s,l;let u=We(t,[{drawDefinition:!0}]);if(u.error)return u;let{drawDefinition:c,roundNumber:d}=t,p=t.structureId??(((e=c.structures)==null?void 0:e.length)===1&&((r=(i=c.structures)==null?void 0:i[0])==null?void 0:r.structureId));if(typeof p!="string")return{error:Xa};let m=(n=c.structures)==null?void 0:n.find(w=>w.structureId===p);if(!m)return{error:Ai};let h,f=(a=m.matchUps??[])==null?void 0:a.reduce((w,U)=>(U.roundPosition&&(h=!0),((U==null?void 0:U.roundNumber)||0)>w?U.roundNumber:w),0);if(m.structures||h||m.finishingPosition===Th)return{error:Sp};let g=((o=c==null?void 0:c.entries)==null?void 0:o.filter(w=>{let U=w.entryStatus;return ds.includes(U)}))??[],v=Math.floor((g==null?void 0:g.length)/2)||1,y=d??f??1,I=((l=(s=m.matchUps)==null?void 0:s.filter(w=>w.roundNumber===y))==null?void 0:l.length)??0,b=v-I,S=b>0?b:0;return{...Q,availableMatchUpsCount:S,lastRoundNumber:f,roundMatchUpsCount:v}}function m_({drawDefinition:t}){var e;let i=vt({name:"participantRepresentatives",element:t});return i.error?i:{representativeParticipantIds:((e=i.extension)==null?void 0:e.value)||[]}}function pPe({tournamentParticipants:t,drawDefinition:e,event:i}){if(!e)return{error:$e};let r=fr({tournamentParticipants:t,inContext:!0,drawDefinition:e,event:i}),n=Ne(r.matchUps,!1,!0),a=dt(n.reduce((s,l)=>s.concat(...l.sides.map(u=>u.participantId).filter(Boolean)),[])),o=Object.assign({},...a.map(s=>{let l=n.filter(u=>u.sides.map(c=>c.participantId).filter(Boolean).includes(s));return{[s]:l}}));return{participantIds:a,participantIdMatchUps:o}}function h_({byeAdvancements:t=!1,tournamentRecord:e,drawDefinition:i}){if(!i)return{error:$e};let{participantIds:r,participantIdMatchUps:n}=pPe({tournamentParticipants:e==null?void 0:e.participants,drawDefinition:i}),a=(r==null?void 0:r.map(o=>{let s=n[o].filter(d=>[Ki,jt].includes(d.matchUpStatus)||d.winningSide),l=s.map(d=>{let p=d.sides.find(h=>h.bye),m=d.sides.find(h=>h.participantId===o).sideNumber;return(d.winningSide||t&&p&&m)===m?d.finishingPositionRange.winner:d.finishingPositionRange.loser}),u=d=>Math.abs(d[0]-d[1]),c=l.reduce((d,p)=>d&&u(d)<u(p)?d:p,void 0);return{[o]:{relevantMatchUps:s,finishingPositionRanges:l,finishingPositionRange:c}}}))||[];return Object.assign({},...a)}function sd({tournamentRecords:t,tournamentRecord:e,tournamentId:i,drawId:r}){if(!e&&!t)return{error:ve};if(!r)return{error:Fs};if(!e&&t){if(typeof i!="string"&&(i=DQ({tournamentRecords:t,drawId:r}),!i))return{error:Kf};if(e=t[i],!e)return{error:ve}}let n=e&&Kn({tournamentRecord:e,drawId:r});return n!=null&&n.drawDefinition?{drawDefinition:n.drawDefinition,event:n.event,tournamentRecord:e,...Q}:te({result:{error:Va},stack:"findDrawDefinition"})}function f_(t){let{drawDefinition:e,error:i}=sd(t);return i?{error:i}:{drawDefinition:Ne(e)}}function OM({targetRoundNumber:t,finishingPosition:e,drawDefinition:i,structureId:r,linkType:n}){let{links:a}=bv({drawDefinition:i,structureId:r})||{},o=((a==null?void 0:a.target)||[]).filter(({linkType:s})=>s===n).filter(({target:s})=>!t||t===s.roundNumber).map(s=>{let l=s.source.structureId,{structure:u}=tt({structureId:l,drawDefinition:i});if(!(e&&(u==null?void 0:u.finishingPosition)!==e))return s}).filter(Boolean);return{sourceStructureIds:o.map(({source:s})=>s.structureId),relevantLinks:o}}function mPe({tournamentParticipants:t,returnParticipants:e,drawPosition:i,participant:r,drawId:n,event:a}){var o;let s=((o=a==null?void 0:a.entries)==null?void 0:o.filter(({entryStatus:l})=>[Po,Mp].includes(l)).map(({participantId:l})=>l))||[];if(s.length){let l=r.individualParticipantIds,u=e?t.filter(({participantId:d})=>s.includes(d)):void 0,c=e?t.filter(({participantId:d})=>l.includes(d)):void 0;return{validModifyAssignedPairAction:He({payload:{participantId:r.participantId,replacementIndividualParticipantId:void 0,existingIndividualParticipantId:void 0,drawPosition:i,drawId:n},method:SDe,availableIndividualParticipantIds:s,availableIndividualParticipants:u,existingIndividualParticipantIds:l,existingIndividualParticipants:c,type:YL},!1,!1,!0)}}return{}}function np(t){var e,i,r,n,a;let{inContextDrawMatchUps:o,targetData:s,drawDefinition:l,relevantLink:u}=t;if((u==null?void 0:u.linkCondition)===ll&&((e=s==null?void 0:s.matchUp)==null?void 0:e.matchUpStatus)===jt)return!1;let{targetMatchUps:{loserMatchUp:c,winnerMatchUp:d},targetLinks:p}=s,m=c&&On({matchUpId:c.matchUpId,inContextDrawMatchUps:o,drawDefinition:l}),h=(i=m==null?void 0:m.targetMatchUps)==null?void 0:i.loserMatchUp,f=(r=m==null?void 0:m.targetMatchUps)==null?void 0:r.loserMatchUpDrawPositionIndex,g=(n=h==null?void 0:h.sides[f])==null?void 0:n.participant,v=[Pt,Ft].includes(c==null?void 0:c.matchUpStatus)&&!g,y=((a=d==null?void 0:d.drawPositions)==null?void 0:a.filter(Boolean).length)||0;if(c!=null&&c.winningSide&&!v||d!=null&&d.winningSide&&y===2&&(!d.feedRound||![Ft,Pt].includes(d==null?void 0:d.matchUpStatus)))return!0;let I=d&&On({matchUpId:d.matchUpId,inContextDrawMatchUps:o,drawDefinition:l}),b=m&&np({relevantLink:p==null?void 0:p.loserTargetLink,targetData:m,inContextDrawMatchUps:o,drawDefinition:l});return!!(I&&np({targetData:I,inContextDrawMatchUps:o,drawDefinition:l})||b)}var _Q={[xu]:{policyName:"positionActionsDefault",enabledStructures:[{stages:[Ke,Ae],stageSequences:[1],enabledActions:[],disabledActions:[]},{stages:[],stageSequences:[],enabledActions:[hy,$m,oR,cm],disabledActions:[]}],disbledStructures:[],otherFlightEntries:!1,activePositionOverrides:[]}},nS="positionAction",kM="matchUpAction";function $Q({actionType:t=nS,appliedPolicies:e,drawDefinition:i,structure:r}){var n,a;let o=t===nS&&xu||t===kM&&_r,s=t===nS&&_Q||t===kM&&vJ,l=o&&((e==null?void 0:e[o])||(s==null?void 0:s[o])),u=((a=(n=i.links)==null?void 0:n.filter(m=>{var h;return((h=m==null?void 0:m.target)==null?void 0:h.structureId)===(r==null?void 0:r.structureId)}))==null?void 0:a.map(({target:m})=>m.feedProfile))??[],{enabledStructures:c,disabledStructures:d}=l||{},p=d==null?void 0:d.find(m=>{let{stages:h,stageSequences:f,structureTypes:g,feedProfiles:v}=m;return(!(v!=null&&v.length)||Array.isArray(v)&&v.some(y=>u.includes(y)))&&(!(h!=null&&h.length)||Array.isArray(h)&&(h==null?void 0:h.includes(r==null?void 0:r.stage)))&&(!(g!=null&&g.length)||Array.isArray(g)&&(g==null?void 0:g.includes(r==null?void 0:r.structureType)))&&(!(f!=null&&f.length)||Array.isArray(f)&&f.includes(r==null?void 0:r.stageSequence))});return{enabledStructures:c,actionsDisabled:p,actionsPolicy:l}}function V2({activePositionOverrides:t,activeDrawPositions:e,action:i}){return i&&t.includes(i)?!0:!e.length}function BQ({enabledStructures:t,drawDefinition:e,structure:i}){var r,n;if(t===!1)return{};if(!(t!=null&&t.length))return{policyActions:{enabledActions:[],disabledActions:[]}};let{stage:a,stageSequence:o,structureType:s}=i||{},l=((n=(r=e.links)==null?void 0:r.filter(u=>{var c;return((c=u==null?void 0:u.target)==null?void 0:c.structureId)===(i==null?void 0:i.structureId)}))==null?void 0:n.map(({target:u})=>u.feedProfile))||[];return{policyActions:t.find(u=>{let{stages:c,stageSequences:d,structureTypes:p,feedProfiles:m}=u||{},h=!(c!=null&&c.length)||Array.isArray(c)&&c.includes(a),f=!(d!=null&&d.length)||Array.isArray(d)&&d.includes(o),g=!(p!=null&&p.length)||Array.isArray(p)&&p.includes(s),v=!(m!=null&&m.length)||Array.isArray(m)&&m.some(y=>l.includes(y));return f&&g&&v&&u&&h})}}function Zn({action:t,policyActions:e}){var i;let r=!(e!=null&&e.enabledActions)||((i=e==null?void 0:e.disabledActions)==null?void 0:i.length)&&e.disabledActions.includes(t);return r?!1:((e==null?void 0:e.enabledActions.length)===0||(e==null?void 0:e.enabledActions.includes(t)))&&!r}var VQ="replaceTieMatchUpParticipantId",jQ="assignTieMatchUpParticipantId",xM="removeTieMatchUpParticipantId",j2="assignMatchUpSideParticipant",hPe="removeMatchUpSideParticipant",GQ="substituteParticipant",FM="REMOVE_SUBSTITUTION",HQ="REPLACE_PARTICIPANT",g_="REMOVE_PARTICIPANT",LM="setMatchUpStatus",_M="SUBSTITUTION",zQ="SCHEDULE",fPe="PENALTY",$M="REFEREE",WQ="STATUS",BM="START",qQ="SCORE",VM="END",gPe={REPLACE_TEAM_POSITION_METHOD:VQ,ASSIGN_TEAM_POSITION_METHOD:jQ,REMOVE_TEAM_POSITION_METHOD:xM,REPLACE_PARTICIPANT:HQ,SUBSTITUTION_METHOD:GQ,REMOVE_SUBSTITUTION:FM,REMOVE_PARTICIPANT:g_,SCHEDULE_METHOD:LM,SUBSTITUTION:_M,SCHEDULE:zQ,PENALTY:fPe,REFEREE:$M,STATUS:WQ,SCORE:qQ,START:BM,END:VM};function vPe({specifiedPolicyDefinitions:t,inContextDrawMatchUps:e,matchUpParticipantIds:i,matchUpActionsPolicy:r,inContextMatchUp:n,policyActions:a,enforceGender:o,participantId:s,sideNumber:l,matchUpId:u,matchUp:c,drawId:d,side:p}){var m,h,f,g,v,y,I,b,S,w,U,T,D,P,E;let R=[],N=(m=n.sides)==null?void 0:m.find(W=>W.participant),A=n.gender===jn&&n.sideNumber&&((h=n.sides)==null?void 0:h.filter(W=>W.particiapntId).length)===1&&((g=(f=N==null?void 0:N.participant)==null?void 0:f.person)==null?void 0:g.sex),M=n.matchUpType,C=(o??((v=r==null?void 0:r.participants)==null?void 0:v.enforceGender))!==!1?n.gender:void 0,O=(I=(y=n.sides)==null?void 0:y.flatMap(W=>{var q;return((q=W.participant)==null?void 0:q.individualParticipants)||W.participant}).filter(Boolean))==null?void 0:I.map(Tt),k=(b=n.sides)==null?void 0:b.filter(W=>!l||W.sideNumber===l).flatMap(W=>{var q;return((q=W.participant)==null?void 0:q.individualParticipants)||W.participant}).filter(Boolean),x=k==null?void 0:k.map(Tt),F=(w=(S=e==null?void 0:e.find(W=>W.matchUpId===n.matchUpTieId))==null?void 0:S.sides)==null?void 0:w.map(W=>{var q,Y;return(Y=(q=W==null?void 0:W.participant)==null?void 0:q.individualParticipants)==null?void 0:Y.filter(({participantId:re,person:K})=>!(x!=null&&x.includes(re))&&(!C||C===As||K.sex===C||C===jn&&!A||A&&K.sex!==A))}),$=l?F==null?void 0:F[l-1]:F==null?void 0:F.map((W,q)=>({participants:W,sideNumber:q+1})),_=l?(U=F==null?void 0:F[l-1])==null?void 0:U.map(Tt):F==null?void 0:F.map((W,q)=>({participants:W==null?void 0:W.map(Tt),sideNumber:q+1})),L=l&&(Xi(om)(M)&&!(x!=null&&x.length)||Xi(Wd)(M)&&((x==null?void 0:x.length)??0)<2)||!l&&(Xi(om)(M)&&((x==null?void 0:x.length)??0)<2||Xi(Wd)(M)&&((x==null?void 0:x.length)??0)<4),B=_==null?void 0:_.filter(W=>!(O!=null&&O.includes(W))),V=$==null?void 0:$.filter(({participantId:W})=>B.includes(W));if(L&&B!=null&&B.length&&R.push({availableParticipantIds:B,method:jQ,availableParticipants:V,type:_m,payload:{participantId:void 0,tieMatchUpId:u,sideNumber:l,drawId:d}}),x!=null&&x.length&&(!br(c)||(T=p==null?void 0:p.substitutions)!=null&&T.length)&&R.push({method:xM,type:g_,existingParticipantIds:x,payload:{participantId:void 0,tieMatchUpId:u,drawId:d}}),V!=null&&V.length&&(!l&&x!=null&&x.length||l&&p!=null&&p.participant)&&R.push({availableParticipantIds:B,method:VQ,availableParticipants:V,type:HQ,existingParticipantIds:x,payload:{existingParticipantId:void 0,participantId:void 0,tieMatchUpId:u,drawId:d}}),Zn({policyActions:a,action:FM})&&((D=p==null?void 0:p.substitutions)==null?void 0:D.length)){let W=((P=p.participant)==null?void 0:P.participantType)===Dt&&[p.participantId]||((E=p.participant)==null?void 0:E.participantType)===ft&&p.participant.individualParticipantIds||[],q=p.substitutions.map(Y=>Y.participantId).filter(Y=>W.includes(Y));(!s||q.includes(s))&&R.push({method:xM,type:FM,substitutedParticipantIds:q,payload:{participantId:void 0,tieMatchUpId:u,drawId:d}})}let G=t==null?void 0:t[_r],j=G==null?void 0:G.substituteWithoutScore,z=G==null?void 0:G.substituteAfterCompleted;if(Zn({policyActions:a,action:_M})&&i.length===2&&(!l&&x!=null&&x.length||l&&p!=null&&p.participant)&&(j||br(c))&&(z||c.matchUpStatus&&!yr.includes(c.matchUpStatus))&&k!=null&&k.length&&$.length){let W=k.map(Tt);R.push({info:"list of team players available for substitution",method:GQ,availableParticipantIds:_,existingParticipantIds:W,availableParticipants:$,existingParticipants:k,type:_M,payload:{substituteParticipantId:void 0,existingParticipantId:void 0,sideNumber:l,matchUpId:u,drawId:d}})}return R}function IPe({tournamentParticipants:t=[],possiblyDisablingAction:e,activeDrawPositions:i,positionAssignments:r,returnParticipants:n,appliedPolicies:a,drawDefinition:o,drawPosition:s,validActions:l,structureId:u,structure:c,drawId:d,event:p}){var m,h,f,g,v;if(i.includes(s))return{};let y=(m=l.find(R=>R.type===_m))==null?void 0:m.availableParticipantIds,I=(h=a==null?void 0:a[xu])==null?void 0:h.otherFlightEntries,b=(f=a==null?void 0:a[xu])==null?void 0:f.restrictQualifyingAlternates,S=(o.entries??[]).filter(({entryStage:R})=>!b||(c.stage===Ke?R===Ke:R!==Ke)).sort((R,N)=>(R.entryPosition??1/0)-(N.entryPosition??1/0)).map(({participantId:R})=>R).filter(Boolean),{allPositionedParticipantIds:w}=DX({drawDefinition:o}),U=r.map(R=>R.participantId).filter(Boolean),T=S.filter(R=>c.stage&&[Ke,Ae,Bi].includes(c.stage)?!(w!=null&&w.includes(R)):!U.includes(R)),D=((p==null?void 0:p.entries)??[]).filter(R=>R.entryStatus===qo&&YQ({restrictQualifyingAlternates:b,structure:c,entry:R})&&(c.stage&&[Ke,Ae,Bi].includes(c.stage)?!(w!=null&&w.includes(R.participantId)):!U.includes(R.participantId))).sort((R,N)=>(R.entryPosition??1/0)-(N.entryPosition??1/0)).map(R=>R.participantId),P=dt(T.concat(D));if(I){let R=(v=(g=p?Hi({event:p}).flightProfile:void 0)==null?void 0:g.flights)==null?void 0:v.filter(N=>N.drawId!==d).map(N=>N.drawEntries.filter(A=>A.participantId&&![Jl,Po,Mp].includes(A.entryStatus)&&!S.includes(A.participantId)).map(({participantId:A})=>A)).flat().filter(Boolean);R!=null&&R.length&&P.push(...R)}y!=null&&y.length&&(P=P.filter(R=>!y.includes(R)));let E=n?t==null?void 0:t.filter(R=>P.includes(R.participantId)):void 0;return E==null||E.forEach(R=>{let N=(o.entries??[]).find(A=>A.participantId===R.participantId);R.entryPosition=N==null?void 0:N.entryPosition}),E==null||E.sort((R,N)=>(R.entryPosition||1/0)-(N.entryPosition||1/0)),P.length?{validAlternatesAction:He({payload:{drawId:d,structureId:u,drawPosition:s},willDisableLinks:e,method:wDe,availableAlternatesParticipantIds:P,type:KL,availableAlternates:E})}:{}}function YQ({restrictQualifyingAlternates:t,structure:e,entry:i}){let{stage:r}=e;if(!i.entryStage||i.entryStage===r||r===Ke&&!t||i.entryStage===Ae&&r===an)return!0}function yPe({eventEntries:t,structure:e}){let i=n=>n.entryStatus===qo&&YQ({structure:e,entry:n}),r=(n,a)=>(n.entryPosition||1/0)-(a.entryPosition||1/0);return t.filter(i).sort(r).map(Tt)}function bPe({restrictAdHocRoundParticipants:t,tournamentParticipants:e,matchUpParticipantIds:i,otherFlightEntries:r,drawDefinition:n,structureId:a,sideNumber:o,matchUpId:s,structure:l,matchUp:u,drawId:c,event:d}){var p,m,h,f,g,v,y;let I=[],b=(l==null?void 0:l.matchUps)??[],S=(m=(p=u.sides)==null?void 0:p.find(M=>M.sideNumber===o))==null?void 0:m.participantId,w=b.filter(({roundNumber:M})=>M===u.roundNumber),U=((h=n==null?void 0:n.entries)==null?void 0:h.filter(({entryStatus:M})=>M&&Np.includes(M)).map(Tt))??[],T=w.map(M=>(M.sides??[]).flatMap(Tt)).flat().filter(Boolean),D=U.filter(M=>!i.includes(M)&&(!t||!T.includes(M))),P=e==null?void 0:e.filter(M=>D==null?void 0:D.includes(M.participantId)).map(M=>Ne(M,void 0,!0));P==null||P.forEach(M=>{let C=(n.entries??[]).find(O=>O.participantId===M.participantId);M.entryPosition=C==null?void 0:C.entryPosition}),D.length&&I.push({payload:{drawId:c,matchUpId:s,structureId:a,sideNumber:o},method:j2,type:_m,availableParticipantIds:D,participantsAvailable:P});let E=(d==null?void 0:d.entries)??[],R=yPe({eventEntries:E,structure:l}),N=dt(U.concat(R));if(r){let M=(g=(f=d?Hi({event:d}):void 0)==null?void 0:f.flights)==null?void 0:g.filter(C=>C.drawId!==c).flatMap(C=>C.drawEntries.filter(O=>O.participantId&&![Jl,Po,Mp].includes(O.entryStatus)).map(({participantId:O})=>O)).filter(Boolean);M!=null&&M.length&&N.push(...M)}N=N.filter(M=>!i.includes(M)&&!D.includes(M)&&(!t||!T.includes(M)));let A=e==null?void 0:e.filter(M=>N.includes(M.participantId)).map(M=>Ne(M,void 0,!0));if(A==null||A.forEach(M=>{let C=(n.entries??[]).find(O=>O.participantId===M.participantId);M.entryPosition=C==null?void 0:C.entryPosition}),A==null||A.sort((M,C)=>(M.entryPosition||1/0)-(C.entryPosition||1/0)),N.length&&I.push({payload:{drawId:c,matchUpId:s,structureId:a,sideNumber:o},availableParticipantIds:N,participantsAvailable:A,method:j2,type:qo}),!br(u)&&o&&S){I.push({payload:{drawId:c,matchUpId:s,structureId:a,sideNumber:o},method:hPe,type:g_});let M=L=>L.sides.map(Tt),C=({matchUpId:L})=>L!==u.matchUpId,O=L=>!br(L),k=(y=(v=u.sides)==null?void 0:v.find(L=>L.sideNumber!==o))==null?void 0:y.participantId,x=b.filter(({roundNumber:L})=>L!==u.roundNumber).filter(C).map(M),F=[k,...x.filter(L=>L.includes(S)).flat()].filter(Boolean),$=L=>!F.flat().includes(L),_=w.filter(O).filter(C).map(M).flat().filter($);if(_.length){let L=e==null?void 0:e.filter(B=>_.includes(B.participantId)).map(B=>Ne(B,void 0,!0));I.push({payload:{participantIds:[S],roundNumber:u.roundNumber,structureId:a,sideNumber:o,matchUpId:s,drawId:c},swappableParticipantIds:_,method:TDe,type:sR,swappableParticipants:L})}}return I}function hR(t){var e,i,r,n,a,o,s,l,u;if(!t)return{error:se};let{drawDefinition:c,event:d}=t,{restrictAdHocRoundParticipants:p=!0,policyDefinitions:m,enforceGender:h,participantId:f,sideNumber:g,matchUpId:v}=t,y=t.tournamentRecord??(t.tournamentId&&Di(t.tournamentId)&&((e=t.tournamentRecords)==null?void 0:e[t.tournamentId]));if(!y)return{error:ve};if(!v||!Di(v))return{error:bn};if(g&&![1,2].includes(g))return te({result:{error:se},context:{sideNumber:g}});if(!c){let ae=(Hr({tournamentRecord:y}).matchUps??[]).find(ne=>ne.matchUpId===v);d=((y==null?void 0:y.events)??[]).find(ne=>ne.eventId===(ae==null?void 0:ae.eventId));let le=((d==null?void 0:d.drawDefinitions)??[]).find(ne=>ne.drawId===(ae==null?void 0:ae.drawId));le&&(c=le)}if(!c)return{error:$e};let I=Oi({withIndividualParticipants:!0,tournamentRecord:y}).participants,{drawId:b}=c,{matchUp:S,structure:w}=Si({drawDefinition:c,matchUpId:v,event:d});if(!S)return{error:hn};let U=Bt({tournamentRecord:y,drawDefinition:c,structure:w,event:d}).appliedPolicies??{};Object.assign(U,m??{});let T=(i=U==null?void 0:U[xu])==null?void 0:i.otherFlightEntries,D=(U==null?void 0:U[_r])??Sv[_r],{enabledStructures:P}=$Q({actionType:kM,appliedPolicies:U,drawDefinition:c,structure:w}),{policyActions:E}=BQ({enabledStructures:P,drawDefinition:c,structure:w}),R=t.matchUpsMap??ln({drawDefinition:c}),N=t.inContextDrawMatchUps??fr({tournamentParticipants:I,inContext:!0,drawDefinition:c,matchUpsMap:R,event:d}).matchUps,A=N==null?void 0:N.find(ae=>ae.matchUpId===v),M=g&&((r=A==null?void 0:A.sides)==null?void 0:r.find(ae=>ae.sideNumber===g)),C=((n=A==null?void 0:A.sides)==null?void 0:n.map(ae=>{var le;return ae.participantId||((le=ae.participant)==null?void 0:le.participantid)}).filter(Boolean))??[],{assignedPositions:O,allPositionsAssigned:k}=Mr({structure:w}),{structureId:x}=w??{},F=[];if(!x)return{validActions:F};let $=Yn({structure:w}),_=S.collectionId;if($&&!_){let ae=bPe({restrictAdHocRoundParticipants:p,tournamentParticipants:I,matchUpParticipantIds:C,otherFlightEntries:T,drawDefinition:c,structureId:x,sideNumber:g,matchUpId:v,structure:w,matchUp:S,drawId:b,event:d});F.push(...ae)}let L=_c({drawDefinition:c,structure:w}),B=O==null?void 0:O.filter(ae=>ae.participantId).map(ae=>ae.drawPosition),V=O==null?void 0:O.filter(ae=>ae.bye).map(ae=>ae.drawPosition),G=S.matchUpStatus===jt||!_&&((a=S.drawPositions)==null?void 0:a.reduce((ae,le)=>(V==null?void 0:V.includes(le))||ae,!1));if(G)return{validActions:F,isByeMatchUp:G};Zn({policyActions:E,action:$M})&&F.push({type:$M,payload:{matchUpId:v}});let j=!Tw({matchUpStatus:S.matchUpStatus}),z=(o=U==null?void 0:U.scoring)==null?void 0:o.structures,W=(w==null?void 0:w.stage)&&(z==null?void 0:z.stage)&&(z==null?void 0:z.stage[w.stage]),q=(w==null?void 0:w.stageSequence)&&(W==null?void 0:W.stageSequence)&&W.stageSequence[w.stageSequence],Y=!((s=U==null?void 0:U.scoring)!=null&&s.requireAllPositionsAssigned||W!=null&&W.requireAllPositionsAssigned||q!=null&&q.requireAllPositionsAssigned)||k,re=S.sides&&S.sides.filter(ae=>ae==null?void 0:ae.participantId).length===2,K=S.matchUpStatus&&[tr,dr].includes(S.matchUpStatus),H=On({inContextDrawMatchUps:N,drawDefinition:c,matchUpId:v}),Z=np({inContextDrawMatchUps:N,drawDefinition:c,targetData:H}),X=(((l=A==null?void 0:A.drawPositions)==null?void 0:l.length)===2&&A.drawPositions.every(ae=>B==null?void 0:B.includes(ae))&&((u=A==null?void 0:A.sides)==null?void 0:u.length)===2&&A.sides.every(({participantId:ae})=>ae)||re)&&!(K&&Z),ie={method:tQ,type:$m,payload:{drawId:b,matchUpId:v,penaltyCode:void 0,penaltyType:void 0,participantIds:[],notes:void 0}};if(j&&F.push({payload:{drawId:b,matchUpId:v,schedule:{}},method:LM,type:zQ}),Zn({policyActions:E,action:$m})&&(M!=null&&M.participant||!g&&C!=null&&C.length)&&F.push(ie),j&&X&&F.push({type:WQ}),Y&&X){let{matchUpId:ae,matchUpFormat:le}=S,ne={drawId:b,matchUpId:ae,matchUpFormat:le,outcome:{scoreStringSide1:void 0,scoreStringSide2:void 0,sets:[]},winningSide:void 0};F.push({info:"set outcome and winningSide",method:LM,type:qQ,payload:ne}),Zn({policyActions:E,action:BM})&&F.push({type:BM}),Zn({policyActions:E,action:VM})&&F.push({type:VM})}if(_&&A){let ae=vPe({specifiedPolicyDefinitions:m,inContextDrawMatchUps:N,matchUpParticipantIds:C,matchUpActionsPolicy:D,inContextMatchUp:A,policyActions:E,enforceGender:h,participantId:f,sideNumber:g,matchUpId:v,matchUp:S,drawId:b,side:M});F.push(...ae)}return{structureIsComplete:L,validActions:F,isDoubleExit:K,...Q}}function wPe({tournamentParticipants:t=[],sourceStructuresComplete:e,possiblyDisablingAction:i,isWinRatioFedStructure:r,activeDrawPositions:n,positionAssignments:a,drawDefinition:o,drawPosition:s,structureId:l,structure:u,drawId:c,event:d}){var p,m,h,f,g,v,y;if(n.includes(s)||r&&!e)return{};let{sourceStructureIds:I,targetStructureIds:b}=((p=o.links)==null?void 0:p.reduce((T,D)=>{var P,E;let R=(P=D.source)==null?void 0:P.structureId,N=(E=D.target)==null?void 0:E.structureId;return T.sourceStructureIds.includes(R)||T.sourceStructureIds.push(R),T.targetStructureIds.includes(N)||T.targetStructureIds.push(N),T},{sourceStructureIds:[],targetStructureIds:[]}))||{},S=[],w=((m=o.links)==null?void 0:m.filter(T=>{var D;return((D=T.target)==null?void 0:D.structureId)===u.structureId}))??[];for(let T of w){let D=(h=T==null?void 0:T.source)==null?void 0:h.structureId,{structure:P}=tt({structureId:D,drawDefinition:o}),E=(P==null?void 0:P.finishingPosition)===Th&&((I==null?void 0:I.length)!==1||(b==null?void 0:b.length)!==1),R={};if(E){let{matchUps:M}=qt({drawDefinition:o,structure:u,event:d}),{initialRoundNumber:C}=Lm({drawPosition:s,matchUps:M}),O=(v=(g=(f=o.links)==null?void 0:f.find(k=>{var x;return((x=k.target)==null?void 0:x.structureId)===(u==null?void 0:u.structureId)&&k.target.roundNumber===C}))==null?void 0:g.source)==null?void 0:v.roundNumber;R.roundNumbers=[O]}let{completedMatchUps:N}=ZP({structureId:D,inContext:!0,matchUpFilters:R,drawDefinition:o}),A=a.map(M=>M.participantId).filter(Boolean);(y=N==null?void 0:N.filter(({matchUpType:M,winningSide:C})=>C&&((d==null?void 0:d.eventType)!==ur||M===ur)).map(({winningSide:M,sides:C})=>M&&(C==null?void 0:C[1-(M-1)])).map(Tt).filter(M=>M&&!A.includes(M)))==null||y.forEach(M=>{S.includes(M)||S.push(M)})}let U=t==null?void 0:t.filter(T=>S==null?void 0:S.includes(T.participantId));return U==null||U.forEach(T=>{let D=(o.entries??[]).find(P=>P.participantId===T.participantId);T.entryPosition=D==null?void 0:D.entryPosition}),S!=null&&S.length?{validLuckyLosersAction:{type:JL,method:UDe,availableLuckyLosers:U,availableLuckyLoserParticipantIds:S,willDisableLinks:i,payload:{drawId:c,structureId:l,drawPosition:s}}}:{}}function UPe({positionSourceStructureIds:t,unassignedParticipantIds:e,possiblyDisablingAction:i,provisionalPositioning:r,tournamentParticipants:n,isWinRatioFedStructure:a,positionAssignments:o,returnParticipants:s,appliedPolicies:l,drawDefinition:u,seedingProfile:c,isByePosition:d,drawPosition:p,structureId:m,event:h}){var f,g,v;let{drawId:y}=u,I=[],b,S,w=[],U=(g=(f=l==null?void 0:l[Oo])==null?void 0:f.validSeedPositions)==null?void 0:g.ignore;if(U||({unplacedSeedParticipantIds:b,unplacedSeedAssignments:S,unfilledPositions:w}=MJ({provisionalPositioning:r,returnAllProxies:!0,randomize:!0,drawDefinition:u,seedingProfile:c,structureId:m,event:h})),w!=null&&w.length||(w=o.filter(T=>!T.participantId&&!T.bye&&!T.qualifier).map(T=>T.drawPosition)),d||I.push({payload:{drawId:y,structureId:m,drawPosition:p,isPositionAction:!0},willDisableLinks:i,method:RDe,type:v0}),a&&U){let T=o.map(N=>N.participantId).filter(Boolean),D={structureIds:t},{completedMatchUps:P}=wv({inContext:!0,matchUpFilters:D,drawDefinition:u}),E=dt((v=(P??[]).filter(({matchUpType:N})=>(h==null?void 0:h.eventType)!==ur||N===ur))==null?void 0:v.map(({sides:N})=>N==null?void 0:N.map(Tt)).flat().filter(N=>N&&!T.includes(N))),R=s?n==null?void 0:n.filter(N=>E==null?void 0:E.includes(N.participantId)).map(N=>Ne(N,void 0,!0)):void 0;return R==null||R.forEach(N=>{let A=(u.entries??[]).find(M=>M.participantId===N.participantId);N.entryPosition=A==null?void 0:A.entryPosition}),R!=null&&R.length&&I.push(He({payload:{drawId:y,structureId:m,drawPosition:p},willDisableLinks:i,method:O2,type:_m,availableParticipantIds:E,participantsAvailable:R})),{validAssignmentActions:I}}if(w.includes(p)||d){let T;if(S!=null&&S.length){let P=S.filter(E=>b==null?void 0:b.includes(E.participantId));P.sort(SPe),T=P.map(E=>E.participantId)}else T=e;let D=s?n==null?void 0:n.filter(P=>T.includes(P.participantId)).map(P=>Ne(P,void 0,!0)):void 0;D!=null&&D.length&&I.push(He({payload:{drawId:y,structureId:m,drawPosition:p},willDisableLinks:i,method:O2,type:_m,availableParticipantIds:T,participantsAvailable:D}))}return{validAssignmentActions:I}}function SPe(t,e){return t.bye||pg(t.seedValue)<pg(e.seedValue)||t.seedValue&&!e.seedValue?-1:(t.seedNumber||0)-(e.seedNumber||0)}function TPe({drawPositionInitialRounds:t,tournamentParticipants:e,positionAssignments:i,returnParticipants:r,appliedPolicies:n,drawDefinition:a,drawPosition:o,structureId:s,drawId:l}){var u,c,d;let p=[],m=[],h=[],f=[],g=i.map(T=>T.participantId).filter(Boolean),v=n==null?void 0:n[xu],y=!(v!=null&&v.disableRoundRestrictions)&&t[o],I=v==null?void 0:v.requireCompletedStructures,{sourceStructureIds:b,relevantLinks:S}=OM({targetRoundNumber:y,linkType:ku,drawDefinition:a,structureId:s})||{};b!=null&&b.length&&f.push(...b);let{sourceStructureIds:w,relevantLinks:U}=OM({targetRoundNumber:y,linkType:Ou,drawDefinition:a,structureId:s})||{};w!=null&&w.length&&f.push(...w);for(let T of S){let D=(u=a.structures)==null?void 0:u.find(E=>E.structureId===T.source.structureId);if((D==null?void 0:D.stage)!==Ke)continue;let P=_c({structureId:T.source.structureId,drawDefinition:a});if(!I||P){let E=D.qualifyingRoundNumber,{matchUps:R}=qt({matchUpFilters:{roundNumbers:[E],hasWinningSide:!0},afterRecoveryTimes:!1,tournamentParticipants:e,inContext:!0,structure:D});for(let N of R){let A=N.sides.find(C=>(C==null?void 0:C.sideNumber)===N.winningSide),M=N.matchUpStatus===jt&&((c=N.sides)==null?void 0:c.find(({participantId:C})=>C));if(A||M){let{participantId:C,participant:O}=A||M||{};C&&!g.includes(C)&&(O&&r&&p.push(O),m.push(C))}}}}for(let T of U){let D=(d=a.structures)==null?void 0:d.find(E=>E.structureId===T.source.structureId);if((D==null?void 0:D.stage)!==Ke)continue;let P=_c({structureId:T.source.structureId,drawDefinition:a});if(!I||P){let{positionAssignments:E}=si({structure:D}),R=(E==null?void 0:E.map(N=>{var A;let M=N.participantId,C=(A=vt({element:N,name:Oc}).extension)==null?void 0:A.value;return C?{participantId:M,groupOrder:C==null?void 0:C.groupOrder}:{}}).filter(({groupOrder:N,participantId:A})=>N===1&&!g.includes(A)).map(({participantId:N})=>N))??[];if(R&&m.push(...R),r){let N=e.filter(({participantId:A})=>R.includes(A));p.push(...N)}}}return m.length&&h.push(He({qualifyingParticipants:r?p:void 0,method:yDe,type:oR,qualifyingParticipantIds:m,payload:{qualifyingParticipantId:void 0,drawPosition:o,structureId:s,drawId:l}})),{validAssignmentActions:h,sourceStructureIds:f}}function DPe({onlyAssignedPositions:t=!0,possiblyDisablingAction:e,tournamentParticipants:i,inactiveDrawPositions:r,activeDrawPositions:n,positionAssignments:a,returnParticipants:o,byeDrawPositions:s,drawDefinition:l,isByePosition:u,drawPosition:c,structureId:d,structure:p,drawId:m,event:h}){if(n.includes(c))return{};let f=P=>!t||P.participantId||P.qualifier||P.bye,g=r==null?void 0:r.filter(P=>P!==c&&!(u&&s.includes(P))),v=(a==null?void 0:a.filter(P=>f(P)&&(g==null?void 0:g.includes(P.drawPosition))))??[],y=v.map(({drawPosition:P})=>P),{matchUps:I}=qt({afterRecoveryTimes:!1,inContext:!0,drawDefinition:l,structure:p,event:h}),b=I.filter(({drawPositions:P})=>Nn(P,y)),S=Object.assign({},...b.map(P=>{var E;return(E=P.sides)==null?void 0:E.filter(({sourceDrawPositionRange:R})=>R).map(({drawPosition:R,sourceDrawPositionRange:N})=>({[R]:N}))}).flat()),w=v.map(P=>P.participantId).filter(Boolean),U=(i??[]).filter(P=>w.includes(P.participantId)),T=Object.assign({},...U.map(P=>({[P.participantId]:P}))),D=v.map(P=>{let E=T==null?void 0:T[P.participantId],R=S[P.drawPosition];return He({...P,participant:o?Ne(E,!1,!0):void 0,sourceDrawPositionRange:R})});return D.length?{validSwapAction:{payload:{drawId:m,structureId:d,drawPositions:[c]},willDisableLinks:e,method:eQ,type:sR,availableAssignments:D}}:{}}function v_(t){var e;let i=We(t,[{event:!0,drawDefinition:!0,structureId:!0}]);if(i.error)return i;let{policyDefinitions:r,returnParticipants:n=!0,provisionalPositioning:a,tournamentRecord:o,drawDefinition:s,drawPosition:l,event:u}=t,c=t.tournamentParticipants??(o&&Oi({withIndividualParticipants:!0,tournamentRecord:o}).participants)??[],d=tt({structureId:t.structureId,drawDefinition:s});if(d.error)return d;let p=d.containingStructure||d.structure;if(!p)return{error:Ai};let m=p.structureId;if(d=Dw({drawDefinition:s,structureId:m}),l===void 0&&!d.isAdHoc)return{error:ov};if(d.isAdHoc)return hR(t);if(d.error)return d;let{drawPositionInitialRounds:h,inactiveDrawPositions:f,activeDrawPositions:g,byeDrawPositions:v}=d,y=Bt({tournamentRecord:o,drawDefinition:s,structure:p,event:u}).appliedPolicies??{};Object.assign(y,r??{});let{actionsPolicy:I,enabledStructures:b,actionsDisabled:S}=$Q({actionType:nS,appliedPolicies:y,drawDefinition:s,structure:p}),w=(I==null?void 0:I.activePositionOverrides)||[],{sourceStructureIds:U}=OM({finishingPosition:Xd,targetRoundNumber:1,linkType:Ou,drawDefinition:s,structureId:m})||{},T;U!=null&&U.length&&(T=U.every(W=>_c({structureId:W,drawDefinition:s})));let D=U.length,P=U.length&&!T,{policyActions:E}=BQ({enabledStructures:b,drawDefinition:s,structure:p}),R=![Ke,Ae].includes(p.stage)||p.stageSequence!==1,{drawId:N}=s,A=[],{assignedPositions:M,positionAssignments:C}=Mr({structure:p}),O=M==null?void 0:M.find(W=>W.drawPosition===l),k=!!O;if(!((e=C==null?void 0:C.map(W=>W.drawPosition))!=null&&e.includes(l)))return{error:av};let{stage:x,stageSequence:F}=p,$=[x];x===an&&$.push(Ae),x===Ae&&$.push(an);let _=Eh({entryStatuses:Np,provisionalPositioning:a,drawDefinition:s,stageSequence:F,structureId:m,stages:$}),L=Op({drawDefinition:s,stages:$}).assignedParticipantIds??[],B=_.filter(W=>!L.includes(W.participantId)).map(W=>W.participantId),V=v.includes(l),G=g.includes(l);if(S)return{info:"Actions Disabled for structure",isActiveDrawPosition:G,isDrawPosition:!0,hasPositionAssigned:k,validActions:[],isByePosition:V};if(Zn({policyActions:E,action:_m})&&!G&&C&&!P&&(!O||V)){let{validAssignmentActions:W}=UPe({positionSourceStructureIds:U,unassignedParticipantIds:B,possiblyDisablingAction:R,isWinRatioFedStructure:D,tournamentParticipants:c,positionAssignments:C,returnParticipants:n,appliedPolicies:y,drawDefinition:s,isByePosition:V,drawPosition:l,structureId:m,event:u});W==null||W.forEach(q=>A.push(q))}if(Zn({policyActions:E,action:oR})&&!G){let{validAssignmentActions:W}=TPe({drawPositionInitialRounds:h,tournamentParticipants:c,positionAssignments:C,returnParticipants:n,appliedPolicies:y,drawDefinition:s,drawPosition:l,structureId:m,drawId:N});W==null||W.forEach(q=>A.push(q))}let{participantId:j}=O||{},z=j&&c.find(W=>W.participantId===j);if(O){Zn({policyActions:E,action:AM})&&!G&&(A.push({type:AM,method:A2,payload:{drawId:N,structureId:m,drawPosition:l},willDisableLinks:R}),V||A.push({type:XL,method:bDe,payload:{drawId:N,structureId:m,drawPosition:l},willDisableLinks:R}),Zn({policyActions:E,action:v0})&&!V&&A.push({type:v0,method:A2,payload:{drawId:N,structureId:m,drawPosition:l,replaceWithBye:!0},willDisableLinks:R}));let W=p.stage===Ke||p.stage===Ae&&p.stageSequence===1;if(!V&&V2({activePositionOverrides:w,activeDrawPositions:g,action:cm})&&Zn({policyActions:E,action:cm})&&h0({drawDefinition:s,structureId:m,drawPosition:l})&&W){let{seedAssignments:q}=go({returnAllProxies:!0,drawDefinition:s,structure:p}),{seedNumber:Y,seedValue:re}=(q==null?void 0:q.find(K=>K.participantId===j))??{};A.push({type:cm,method:EDe,participant:z,seedNumber:Y,payload:{drawId:N,structureId:m,participantId:j,seedValue:re}})}if(!V&&V2({activePositionOverrides:w,activeDrawPositions:g,action:sI})&&Zn({policyActions:E,action:sI})&&h0({drawDefinition:s,structureId:m,drawPosition:l})&&W){let{seedAssignments:q}=go({returnAllProxies:!0,drawDefinition:s,structure:p}),{seedNumber:Y}=(q==null?void 0:q.find(re=>re.participantId===j))??{};A.push({method:PDe,type:sI,participant:z,seedNumber:Y,payload:{participantId:j,structureId:m,drawId:N}})}if(!V&&j){if(Zn({policyActions:E,action:$m})){let q={type:$m,method:tQ,participant:z,payload:{penaltyCode:void 0,penaltyType:void 0,participantIds:[],notes:void 0,drawId:N}};A.push(q)}if(Zn({policyActions:E,action:hy})){let q={type:hy,method:DDe,participant:z,payload:{participantId:j,otherName:void 0}};A.push(q)}}if(Zn({policyActions:E,action:sR})){let{validSwapAction:q}=DPe({possiblyDisablingAction:R,tournamentParticipants:c,inactiveDrawPositions:f,activeDrawPositions:g,positionAssignments:C,returnParticipants:n,byeDrawPositions:v,drawDefinition:s,isByePosition:V,drawPosition:l,structureId:m,structure:p,drawId:N});q&&A.push(q)}}if(Zn({policyActions:E,action:KL})&&!P){let{validAlternatesAction:W}=IPe({possiblyDisablingAction:R,tournamentParticipants:c,positionAssignments:C,activeDrawPositions:g,returnParticipants:n,appliedPolicies:y,drawDefinition:s,drawPosition:l,validActions:A,structureId:m,structure:p,drawId:N,event:u});W&&A.push(W)}if(Zn({policyActions:E,action:JL})&&!P&&!G&&C){let{validLuckyLosersAction:W}=wPe({sourceStructuresComplete:T,possiblyDisablingAction:R,isWinRatioFedStructure:D,tournamentParticipants:c,activeDrawPositions:g,positionAssignments:C,drawDefinition:s,drawPosition:l,structureId:m,structure:p,drawId:N});W&&A.push(W)}if((z==null?void 0:z.participantType)===ft&&Zn({policyActions:E,action:YL})){let{validModifyAssignedPairAction:W}=mPe({tournamentParticipants:c,returnParticipants:n,drawPosition:l,participant:z,drawId:N,event:u});W&&A.push(W)}return{isActiveDrawPosition:G,isDrawPosition:!0,hasPositionAssigned:k,isByePosition:V,validActions:A,...Q}}function Gw({policyDefinitions:t,appliedPolicies:e,drawType:i}){var r,n;let a=(r=t==null?void 0:t[n0])==null?void 0:r.drawTypeCoercion,o=(n=e==null?void 0:e[n0])==null?void 0:n.drawTypeCoercion;return(typeof a=="boolean"?a:void 0)??(i&&(a==null?void 0:a[i]))??(typeof o=="boolean"?o:void 0)??(i&&(o==null?void 0:o[i]))??!0}function fy({tournamentRecord:t,drawDefinition:e,stage:i=Ae,structureId:r,structure:n}){var a;if(!t)return{error:ve};if(!n&&!e)return{error:$e};if(!n&&!r&&((a=e==null?void 0:e.structures)==null?void 0:a.filter(l=>l.stage===i).length)===1&&(n=e.structures.find(l=>l.stage===i)),!n&&!r)return{error:Xa};let{error:o,positionAssignments:s}=si({drawDefinition:e,structureId:r,structure:n});return{positionAssignments:s??[],structureId:n==null?void 0:n.structureId,error:o}}function I_({structureId:t,drawDefinition:e}){if(!e)return{error:$e};if(!Di(t))return{error:se};let i=bv({drawDefinition:e,structureId:t});if(i.error)return i;let r=i.links.target.flatMap(a=>a.target.feedProfile).filter(Boolean),n=!ji([Kd,$o,RP,Yd],r).length;return{...Q,valid:n}}function KQ({participantsCount:t,participantCount:e}){if(t=t??e,!t)return{error:se};let i=nv(t);return i?{drawSize:i}:te({result:{error:se},stack:"getEliminationDrawSize",context:{participantsCount:t}})}function Hw(t){let{drawSizeProgression:e=!1,policyDefinitions:i,drawSize:r}=t||{},{requireParticipantCount:n=!0,tournamentRecord:a,drawDefinition:o,event:s}=t||{},l="getSeedsCount",u=(t==null?void 0:t.participantsCount)??(t==null?void 0:t.participantCount);if(!i){let h=ec({tournamentRecord:a,drawDefinition:o,event:s});if(h.error)return te({result:h,stack:l});i=h.policyDefinitions}let c=st(u);if(u&&!c)return te({result:{error:se},context:{participantsCount:u},stack:l});if(n&&!c)return te({result:{error:g9},stack:l});if(isNaN(r))if(u)({drawSize:r}=KQ({participantsCount:u}));else return te({result:{error:Yb},stack:l});let d=n&&u||r;if(d&&d>r)return{error:aF};let p=i==null?void 0:i[Oo];if(!p)return{error:n9};let m=p.seedsCountThresholds;return m?(p.drawSizeProgression!==void 0&&(e=p.drawSizeProgression),{seedsCount:m.filter(h=>e?h.drawSize<=r:r===h.drawSize).reduce((h,f)=>u&&u>=f.minimumParticipantCount?f.seedsCount:h,0)}):{error:jK}}function fR({consideredEntries:t,policyDefinitions:e,tournamentRecord:i,appliedPolicies:r,participantMap:n,enforceGender:a,participants:o,event:s}){var l;if((!o||!n)&&i&&({participants:o,participantMap:n}=Oi({tournamentRecord:i})),!o)return{error:Xb};if(!Array.isArray(o))return{error:se};if(!s)return{error:vi};let u=(e==null?void 0:e[_r])??(r==null?void 0:r[_r])??Sv[_r],c=(a??((l=u==null?void 0:u.participants)==null?void 0:l.enforceGender))!==!1,{eventType:d,gender:p}=s,m=d===Au,h=d===Ea&&Xt||m&&ft||Dt,f=Object.assign({},...(t??s.entries??[]).map(y=>({[y.participantId]:y.entryStatus}))),g=Object.keys(f),v=o.filter(y=>g.includes(y.participantId)).filter(y=>{let I=PPe({participant:y,participantType:h,eventType:d,entryStatusMap:f}),b=RPe({genderEnforced:c,participantMap:n,eventGender:p,participant:y,isDoubles:m,mismatch:I});return I||!b});if(v.length){let y=v.map(I=>I.participantId);return{error:JK,invalidParticipantIds:y}}return{...Q,valid:!0}}function PPe({participant:t,participantType:e,eventType:i,entryStatusMap:r}){let n=r[t.participantId],a=i&&[Au,Ea].includes(i)&&t.participantType===Dt&&(gd(n)||n===Jl);return t.participantType!==e&&!a}function RPe(t){var e,i,r;let{participant:n,participantMap:a,eventGender:o,mismatch:s,isDoubles:l,genderEnforced:u}=t,c=!s&&l&&dt(((e=n==null?void 0:n.individualParticipantIds)==null?void 0:e.map(h=>{var f,g,v;return(v=(g=(f=a==null?void 0:a[h])==null?void 0:f.participant)==null?void 0:g.person)==null?void 0:v.sex}).filter(Boolean))??[])||[],d=!o||!(c!=null&&c.length)||As===o||[Qt,mi].includes(o)&&c[0]===o||jn===o&&(c.length===1&&((i=n.individualParticipantIds)==null?void 0:i.length)===1||c.length===2),p=(r=n==null?void 0:n.person)==null?void 0:r.sex,m=!(n!=null&&n.person)||!o||[As,jn].includes(o)||[Qt,mi].includes(o)&&p===o;return!u||d&&m}function XQ({qualifyingProfiles:t,appliedPolicies:e,idPrefix:i,isMock:r,uuids:n}){var a;let o="generateQualifyingSTructures",s=[],l=[],u=[],c=(g,v)=>g.stageSequence-v.stageSequence,d=(g,v)=>g.roundTarget-v.roundTarget,p=0,m=0,h,f=1;for(let g of t.sort(d)){let v=g.structureProfiles||[];f=g.roundTarget||f;let y=1,I=0,b,S,w;for(let U of(v||[]).sort(c)){let T=jx(U.drawSize||U.participantsCount),{qualifyingRoundNumber:D,structureOptions:P,matchUpFormat:E,structureName:R,structureId:N,drawType:A}=U,M=U.matchUpType,C=U.qualifyingPositions||EPe({drawSize:T,qualifyingRoundNumber:D}),O,k,x;if(!st(T))return te({result:{error:Yb},stack:o});let F=t.length>1?`${f}-`:"",$=v.length>1||F?y:"",_=R||(F||$?`${tn(Ke)} ${F}${$}`:tn(Ke));if(A===is){let{structures:L,groupCount:B,maxRoundNumber:V}=Mw({structureName:U.structureName||_,structureId:N||(n==null?void 0:n.pop()),stage:Ke,structureOptions:P,appliedPolicies:e,stageSequence:y,matchUpType:M,roundTarget:f,drawSize:T,idPrefix:i,isMock:r,uuids:n});I=B,O=V,k=L[0],h=[1]}else({drawSize:T,matchUps:x,roundLimit:O}=dl({qualifyingRoundNumber:D,qualifyingPositions:C,matchUpType:M,drawSize:T,idPrefix:i,isMock:r,uuids:n})),k=so({structureName:U.structureName||_,structureId:N||(n==null?void 0:n.pop()),qualifyingRoundNumber:O,stage:Ke,matchUpFormat:E,stageSequence:y,matchUpType:M,roundLimit:O,matchUps:x}),f&&_t({extension:{name:yl,value:f},element:k}),I=((a=x==null?void 0:x.filter(L=>L.roundNumber===O))==null?void 0:a.length)||0;if(y>1){let{link:L}=kw({sourceStructureId:S,sourceRoundNumber:b,targetStructureId:k.structureId,finishingPositions:w===Ou?[1]:void 0,linkType:w});u.push(L),p+=(T||0)-I}else p+=T||0;w=A===is?Ou:ku,S=k.structureId,b=O,l.push(k),y+=1}m+=I,s.push({qualifiersCount:I,finalQualifyingRoundNumber:b,finalQualifyingStructureId:S,finishingPositions:h,roundTarget:f,linkType:w}),f+=1}return{qualifiersCount:m,qualifyingDrawPositionsCount:p,qualifyingDetails:s,structures:l,...Q,links:u}}function EPe({drawSize:t,qualifyingRoundNumber:e}){let i=t,r=0;for(;r<e;)i=Math.floor(i/2),r+=1;return i}function JQ(t){let{drawTypeCoercion:e,enforceMinimumDrawSize:i}=t,r=Ze(t.drawSize),n=e&&t.drawType!==Ga&&(typeof e=="boolean"||e<=2)&&r===2&&Ks||t.drawType||Ks,a=X8.includes(n);if(r&&a){if(e&&(typeof e=="boolean"&&r<4||r<=e))n=Ks;else if(r<4&&i)return{...te({context:{enforceMinimumDrawSize:i,drawSize:r,drawType:n},result:{error:oP},stack:"getCoercedDrawType"}),drawType:n}}return{drawType:n}}function CPe(t){let{drawDefinition:e,structureOptions:i,requireSequential:r}=t,n={structureName:tn(Ae),...t,stage:Ae},{structures:a,groupCount:o,groupSize:s}=Mw(n);if(o<1)return{error:k9};let l=(i==null?void 0:i.playoffGroups)||[{finishingPositions:[1],structureName:tn(Bi)}],[u]=a,{structures:c,links:d}=pQ({sourceStructureId:u.structureId,requireSequential:r,drawDefinition:e,playoffGroups:l,groupCount:o,groupSize:s,...t});return c&&a.push(...c),{...Q,structures:a,links:d}}function MPe({mainStructure:t,consolationStructure:e,deciderStructure:i}){let r=e.matchUps.reduce((u,c)=>(c.drawPositions||[]).filter(Boolean).length&&!u.includes(c.roundNumber)?u.concat(c.roundNumber):u,[]),n=t.matchUps.reduce((u,c)=>!u||c.roundNumber>u?c.roundNumber:u,void 0),a=e.matchUps.reduce((u,c)=>!u||c.roundNumber>u?c.roundNumber:u,void 0),o=r.map((u,c)=>{let d=r.indexOf(u)%2?$o:Kd,p=1+c;return{linkType:Yl,source:{roundNumber:p,structureId:t.structureId},target:{feedProfile:d,roundNumber:u,structureId:e.structureId}}}),s={linkType:ku,source:{roundNumber:a,structureId:e.structureId},target:{feedProfile:$o,roundNumber:n,structureId:t.structureId}},l=[{linkType:ku,source:{roundNumber:n,structureId:t.structureId},target:{feedProfile:$o,roundNumber:1,structureId:i.structureId}},{linkType:Yl,source:{roundNumber:n,structureId:t.structureId},target:{feedProfile:$o,roundNumber:1,structureId:i.structureId}}];return[...o,s,...l]}function NPe({structureName:t,matchUpType:e,idPrefix:i,drawSize:r,isMock:n,uuids:a}){let o=[],{matchUps:s}=$c({linkFedFinishingRoundNumbers:[1],drawSize:r+1,matchUpType:e,idPrefix:i,isMock:n}),l=bc({structureName:t||tn(Ae),structureId:a==null?void 0:a.pop(),stageSequence:1,stage:Ae,matchUpType:e,matchUps:s});o.push(l);let u=r/2,{matchUps:c}=$c({finishingPositionOffset:u,idPrefix:i&&`${i}-c`,drawSize:r-1,isConsolation:!0,matchUpType:e,isMock:n,uuids:a}),d=bc({structureName:tn(K8),matchUps:c,structureId:a==null?void 0:a.pop(),stage:an,stageSequence:2,matchUpType:e});o.push(d);let{matchUps:p}=dl({idPrefix:i&&`${i}-p1t2`,drawSize:2,matchUpType:e,isMock:n}),m=bc({structureName:tn(Y8),matchUps:p,structureId:a==null?void 0:a.pop(),stageSequence:3,stage:Bi,matchUpType:e});o.push(m);let h=MPe({mainStructure:l,consolationStructure:d,deciderStructure:m});return{structures:o,links:h,...Q}}function APe(t){let{qualifyingRoundNumber:e,finishingPositionOffset:i,qualifyingPositions:r,matchUpType:n,idPrefix:a,drawSize:o,isMock:s,uuids:l}=t;if(!st(o)||o<2)return{matchUps:[],roundsCount:0};if(Cs(o))return dl(t);let u=OPe(o),c=u.shift(),d=Te(1,((c==null?void 0:c.participantsCount)||0)+1).map(g=>({drawPosition:g})),p=[],m=1;({matchUps:p}=I0({roundNumber:m,matchUpType:n,idPrefix:a,matchUps:p,isMock:s,nodes:d,uuids:l})),m++;let h=t.roundLimit||e;for(let g of u){let v=g.participantsCount/2,y=Te(1,v+1);r&&v===r&&(h=m-1);let I=y.map(b=>{let S=QL({roundPosition:b,roundNumber:m,idPrefix:a,uuids:l});return{roundPosition:b,roundNumber:m,matchUpId:S}});p.push(...I),m++}let f=m-1;return p=Sw({finishingPositionOffset:i,lucky:!0,roundsCount:f,roundLimit:h,matchUps:p}),h&&(p=p.filter(g=>g.roundNumber<=h)),{matchUps:p,roundsCount:f,roundLimit:h}}function OPe(t){let e=Ze(t),i=e%2?e+1:e,r=!!(Math.ceil(i/2)%2),n=[{participantsCount:i,preFeedRound:r}];for(;i>2;){let a=Math.ceil(i/2),o=a===1,s=!!(!o&&a%2);i=!o&&s?a+1:a;let l=!!(i!==2&&Math.ceil(i/2)%2);n.push({participantsCount:i,preFeedRound:l,feedRound:s})}return n}function QQ(t){var e,i;let{playoffAttributes:r,stageSequence:n=1,stage:a=Ae,matchUpType:o,drawSize:s,uuids:l}=t,u=()=>!t.isMock&&!t.idPrefix?void 0:`${t.drawDefinition.drawId}-s-0`,c=t.structureId||u()||(l==null?void 0:l.pop()),d=t.appliedPolicies??Bt(t),p=((e=t.policyDefinitions)==null?void 0:e[lg])||(d==null?void 0:d[lg]);t.skipRounds=t.skipRounds||s<=4&&(p!=null&&p.feedFromMainFinal?0:1)||0;let m=t.structureName??((i=r==null?void 0:r[0])==null?void 0:i.name)??tn(Ae),h=()=>{let{matchUps:f}=dl(t);return{structures:[so({stageSequence:n,structureName:m,matchUpType:o,structureId:c,matchUps:f,stage:a})],links:[],...Q}};return{generators:{[Ga]:()=>({structures:[so({finishingPosition:Xd,stageSequence:n,structureName:m,matchUps:[],matchUpType:o,structureId:c,stage:a})],links:[],...Q}),[Pp]:()=>{let{matchUps:f}=APe(t);return{structures:[so({stageSequence:n,structureName:m,matchUpType:o,structureId:c,matchUps:f,stage:a})],links:[],...Q}},[Ks]:()=>h(),[iw]:()=>NPe(t),[rg]:()=>wf({...t,roundOffsetLimit:3,playoffAttributes:r??NF}),[ng]:()=>wf({...t,roundOffsetLimit:2,playoffAttributes:r??AF}),[Bi]:()=>wf(t),[mv]:()=>{let{matchUps:f}=$c({drawSize:s,uuids:l,matchUpType:o});return{structures:[so({stageSequence:n,structureName:m,matchUpType:o,structureId:c,stage:Ae,matchUps:f})],links:[],...Q}},[rw]:()=>uQ(t),[ag]:()=>Vp({...t,feedRounds:1,fmlc:!0}),[q8]:()=>Vp({...t,feedRounds:1}),[EF]:()=>Vp({...t,feedsFromFinal:1}),[CF]:()=>Vp({...t,feedsFromFinal:2}),[MF]:()=>Vp({...t,feedsFromFinal:3}),[nw]:()=>Vp(t),[EP]:()=>dQ(t),[is]:()=>Mw(t),[Kl]:()=>CPe(t)}}}function y_(t){var e,i,r,n,a;let{enforceMinimumDrawSize:o=!0,overwriteExisting:s,appliedPolicies:l,staggeredEntry:u,drawDefinition:c,tieFormat:d,isMock:p,uuids:m}=t||{},h=Ze(t.drawSize),f=t.drawTypeCoercion??Gw({appliedPolicies:l,drawType:t.drawType}),g="generateDrawStructuresAndLinks",v=JQ({drawType:t.drawType,enforceMinimumDrawSize:o,drawTypeCoercion:f,drawSize:h});if(v.error)return v;let y=v.drawType,I=[],b=[],S=(t==null?void 0:t.matchUpType)??ii,w=(e=c==null?void 0:c.structures)==null?void 0:e.filter(({stage:j})=>j===Ke);w&&I.push(...w);let U=w==null?void 0:w.map(({structureId:j})=>j),T=(i=c==null?void 0:c.structures)==null?void 0:i.find(({stage:j,stageSequence:z})=>j===Ae&&z===1),D=(r=c==null?void 0:c.links)==null?void 0:r.filter(j=>j.target.structureId===(T==null?void 0:T.structureId)&&(U==null?void 0:U.includes(j.source.structureId))),P=(j,z)=>{var W;if(j.linkType===Ou&&z!=null&&z.structures){let q=j.source.finishingPositions||[];return z.structures.length*q.length}else if(j.linkType===ku&&(W=z==null?void 0:z.matchUps)!=null&&W.length){let q=j.source.roundNumber;return z.matchUps.filter(({roundNumber:Y})=>Y===q).length}},E=w==null?void 0:w.map(j=>{var z,W,q;let Y=D==null?void 0:D.find(X=>X.target.structureId===j.structureId),re=((W=(z=si({structure:j}))==null?void 0:z.positionAssignments)==null?void 0:W.length)??0;if(!Y)return re;let K=Y==null?void 0:Y.source.structureId,H=(q=c.structures)==null?void 0:q.find(X=>X.structureId===K),Z=P(Y,H)||0;return re-Z}).filter(Boolean).reduce((j,z)=>j+z,0),R=D==null?void 0:D.map(j=>{let z=j.source.structureId,W=w==null?void 0:w.find(q=>q.structureId===z);return P(j,W)}).filter(Boolean).reduce((j,z)=>j+z,0),N=!!(T&&!((n=T==null?void 0:T.matchUps)!=null&&n.length));if(w!=null&&w.length&&!N)return{error:pM};let A=!(w!=null&&w.length)&&t.qualifyingProfiles,M=(A==null?void 0:A.length)&&XQ({idPrefix:t.idPrefix,qualifyingProfiles:A,appliedPolicies:l,isMock:p,uuids:m});if(M!=null&&M.error)return M;let{qualifyingDrawPositionsCount:C,qualifyingDetails:O,qualifiersCount:k}=M||{qualifyingDrawPositionsCount:E,qualifiersCount:R};C&&(M!=null&&M.structures&&I.push(...M.structures),M!=null&&M.links&&b.push(...M.links)),Object.assign(t,He({drawSize:h,matchUpType:S,tieFormat:d}));let x=y!==Ga&&(!h||h<2||!u&&![mv,Pp].includes(y)&&([Kl,is].includes(y)&&h<3||![is,Kl].includes(y)&&!Cs(h)));if(x&&!C)return te({context:{drawSize:h,invalidDrawSize:x},result:{error:oP},stack:g});let{generators:F,error:$}=QQ(t);if($)return{error:$};let _=F[y];if(!_)return{error:Wx};let L=_==null?void 0:_();if(L.error)return L;let{structures:B,links:V}=L;if(B!=null&&B.length){let j=B.find(({stage:z,stageSequence:W})=>z===Ae&&W===1);if(T&&j){if(N){let z=j.structureId;if(j.structureId=T.structureId,V==null?void 0:V.length)for(let W of V)W.source.structureId===z&&(W.source.structureId=T.structureId),W.target.structureId===z&&(W.target.structureId=T.structureId)}else if(!s)return{error:pM}}I.push(...B)}I.sort(Ph),V!=null&&V.length&&b.push(...V);let G=L.structures.find(({stage:j,stageSequence:z})=>j===Ae&&z===1);for(let j of O||[]){let{finalQualifyingRoundNumber:z,finalQualifyingStructureId:W,roundTarget:q,finishingPositions:Y,linkType:re}=j,K=G&&((a=kw({targetStructureId:G.structureId,sourceStructureId:W,sourceRoundNumber:z,finishingPositions:Y,targetEntryRound:q,linkType:re}))==null?void 0:a.link);if(K!=null&&K.error)return K;K&&b.push(K)}return D&&b.push(...D),{...Q,qualifyingResult:{qualifyingDrawPositionsCount:C,qualifiersCount:k},structures:I,links:b}}function b_(t){var e,i;let{modifyOriginal:r=!0,stageSequence:n=1,isMock:a}=t||{},o="generateDrawTypeAndModifyDrawDefinition";if(!t.drawDefinition)return te({result:{error:$e},stack:o});let s=r?t.drawDefinition:Ne(t.drawDefinition,!1,!0),{tieFormat:l,matchUpType:u}=t;if(l){let S=qn({tieFormat:l});if(S.error)return S}l=Yr(l??((e=In({drawDefinition:s}))==null?void 0:e.tieFormat)),u=u??(s.matchUpType||ii),t.tieFormat=l,t.matchUpType=u;let c=m0({drawDefinition:s,stage:Ae});t.drawSize=t.drawSize??c,!c&&t.drawSize&&g0({drawSize:t.drawSize,drawDefinition:s,stageSequence:n,stage:Ae});let d=ln({drawDefinition:s}).drawMatchUps.map(Pr),p=y_(t);if(p.error)return te({result:p,stack:o});let{structures:m,links:h,qualifyingResult:f}=p;s.structures=m,s.links=h;let g=Math.max(t.qualifiersCount??0,(f==null?void 0:f.qualifiersCount)||0);if(f!=null&&f.qualifyingDrawPositionsCount&&!m0({stage:Ke,drawDefinition:s})){let S=g0({drawSize:f.qualifyingDrawPositionsCount,stage:Ke,drawDefinition:s});if(S.error)return S}if(g){let S=QJ({qualifiersCount:g,drawDefinition:s,stage:Ae});if(S.error)return S}let v=t.drawSize??c;Object.assign(t,He({drawSize:v,matchUpType:u,tieFormat:l}));let{matchUps:y,matchUpsMap:I}=fr({drawDefinition:s});l&&(y==null||y.forEach(S=>{if(!d.includes(S.matchUpId)){let{tieMatchUps:w}=Fw({tieFormat:l,matchUp:S,isMock:a});Object.assign(S,{tieMatchUps:w,matchUpType:u})}}));let{inContextDrawMatchUps:b}=tp({drawDefinition:s,matchUpsMap:I});return ui({tournamentId:(i=t.tournamentRecord)==null?void 0:i.tournamentId,drawDefinition:s}),{inContextDrawMatchUps:b,drawDefinition:s,matchUpsMap:I,...Q,structures:m,matchUps:y,links:h}}function zw(t){let{removePriorValues:e,tournamentRecord:i,participantId:r,scaleItem:n}=t,a,o;if(!eZ({scaleItem:n}))return{error:Mm};if(r&&Array.isArray(i.participants)&&(o=i.participants.find(s=>s.participantId===r),o)){if(o.participantType===Gn&&(n==null?void 0:n.eventType)!==Ea)return{error:Mm};let s=tZ({removePriorValues:e,participant:o,scaleItem:n});if(s.error)return s;a=!s.valueChanged;let{topics:l}=So();l.includes(on)&&ut({topic:on,payload:{tournamentId:i.tournamentId,participants:[o]}})}return a&&{...Q,info:mF,existingValue:n==null?void 0:n.scaleValue}||o&&{...Q,newValue:n==null?void 0:n.scaleValue}||{error:Wi}}function ZQ(t){var e;let{scaleItemsWithParticipantIds:i=[],removePriorValues:r,tournamentRecord:n,auditData:a,context:o}=t;if(!n)return{error:ve};if(!n.participants)return{error:Xb};let s=0,l={},u=[];for(let p of i){let m=p==null?void 0:p.participantId;if(Array.isArray(p==null?void 0:p.scaleItems))for(let h of p.scaleItems)if(eZ({scaleItem:h}))Array.isArray(l[m])||(l[m]=[]),l[m].push(h);else return{error:Mm}}for(let p of n.participants){let{participantId:m}=p||{};if(Array.isArray(l[m]))for(let h of l[m]){if(p.participantType===Gn&&(h==null?void 0:h.eventType)!==Ea)return te({context:{participantId:m,scaleItem:h,participantType:p.participantType},info:"Invalid participantType for eventType",result:{error:Mm}});tZ({participant:p,scaleItem:h,removePriorValues:r}),u.push(p),s++}}let c=s?void 0:dv,{topics:d}=So();if(d.includes(on)&&s&&ut({topic:on,payload:{tournamentId:n.tournamentId,participants:u}}),o){let{eventId:p,drawId:m,...h}=o,f=((e=h.scaleAttributes)==null?void 0:e.scaleType)&&[h.scaleAttributes.scaleType];if(Object.keys(h).length){let g={itemType:JF,itemValue:h};if(f&&(g.itemSubTypes=f),m||p){let{drawDefinition:v,event:y}=Kn({tournamentRecord:n,eventId:p,drawId:m});m&&qL({drawDefinition:v,timeItem:g}),p&&Bh({event:y,timeItem:g})}else Vw({tournamentRecord:n,timeItem:g})}}return a&&d.includes(vu)&&ut({topic:vu,payload:a}),He({...Q,modificationsApplied:s,info:c})}function eZ({scaleItem:t}){let e=t&&Object.keys(t),i=["scaleType","eventType","scaleName"];return i.filter(r=>e==null?void 0:e.includes(r)).length===i.length}function tZ({removePriorValues:t,participant:e,scaleItem:i}){if(!e)return{error:yh};let r=i&&Object.keys(i),n=["scaleType","eventType","scaleName"];if(n.filter(u=>r.includes(u)&&i[u]).length!==n.length)return{error:Mm};let a=new Date().toISOString();e.timeItems||(e.timeItems=[]);let{scaleItem:o}=Ll({scaleAttributes:i,participant:e}),s=u=>[void 0,null,""].includes(u),l=!(s(o==null?void 0:o.scaleValue)&&s(i.scaleValue))&&JSON.stringify(o==null?void 0:o.scaleValue)!==JSON.stringify(i.scaleValue);if(l){let{scaleType:u,eventType:c,scaleName:d}=i,p=[Jd,u,c,d].join("."),m=He({itemValue:i.scaleValue,itemDate:i.scaleDate,createdAt:a,itemType:p});i.scaleId&&(m.itemSubTypes=[i.scaleId]),t&&(e.timeItems=e.timeItems.filter(h=>h.itemType!==p)),e.timeItems.push(m)}return{...Q,valueChanged:l,newValue:i.scaleValue}}function w_(t){let{tournamentRecord:e,modifiedScaleValues:i,removePriorValues:r}=t,n=We(t,[{[Ur]:!0},{modifiedScaleValues:!0,[Jn]:ta}]);if(n.error)return n;for(let a in i){let o=zw({scaleItem:i[a],removePriorValues:r,tournamentRecord:e,participantId:a});if(o.error)return o}return{...Q}}function hg(t){let{tournamentRecord:e,scaleAttributes:i,participantId:r}=t,n=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(!r)return{error:hr};let{participant:a,tournamentId:o}=nd({tournamentRecords:n,tournamentRecord:e,participantId:r});return a?{...Ll({participant:a,scaleAttributes:i}),tournamentId:o}:{error:Wi}}var kPe=(t=0)=>250/Math.pow(t+5,.4),xPe=()=>1;function FPe(t=3,e=2){let i=t/e;return isNaN(i)?af.kDefault():i}var af={nSpread:400,diffThreshold:.125,kCalc:kPe,kMultiplier:FPe,kDefault:xPe};function iZ(t){let{winnerRating:e,loserRating:i}=t,{ratings:r=Tr,winnerCountables:n=1,loserCountables:a=0,ratingType:o=Fo,maxCountables:s,countables:l}=t||{},u=r==null?void 0:r[o];if(!u)return{error:Je};let c=u.range||t.ratingRange;e=e||u.defaultInitialization,i=i||u.defaultInitialization;let d=c[0]>c[1],p=u.decimalsCount||0,m=d?c.slice().reverse():c,h=(C,O)=>parseFloat(O)>=Math.min(...C)&&parseFloat(O)<=Math.max(...C);(!h(c,e)||!h(c,i))&&(h(c,e)||(e=u.defaultInitialization),h(c,i)||(i=u.defaultInitialization));let f=df({targetRange:Tr[Fo].range,sourceRange:m,value:d?c[0]-e:e}),g=df({targetRange:Tr[Fo].range,sourceRange:m,value:d?c[0]-i:i}),v=(C,O)=>1/(1+Math.pow(10,(O-C)/af.nSpread)),y=v(f,g),I=v(g,f),b=af.kCalc(n),S=af.kCalc(a),w=af.kMultiplier(s,l),U=f+w*b*(1-y),T=g+w*S*(0-I),D=df({sourceRange:Tr[Fo].range,value:U,targetRange:m}),P=df({sourceRange:Tr[Fo].range,value:T,targetRange:m}),E=d?c[0]-D:D,R=parseFloat(E.toFixed(p)),N=d?c[0]-P:P,A=parseFloat(N.toFixed(p)),M=Math.max(...c)?Math.abs(e-i)/Math.max(...c):0;return(D>P&&M>af.diffThreshold||R<0||A<0)&&(R=e,A=i),{newWinnerRating:R,newLoserRating:A}}var LPe=t=>(t==null?void 0:t.reduce((e,i)=>(i.winningSide&&(e[i.winningSide-1]+=1),e),[0,0]))||[0,0];function rZ(t){var e,i;let r=We(t,[{[Ur]:!0},{matchUpIds:!0,[Jn]:cn,[Wo]:gh},{ratingType:!1,[Xr]:b=>Tr[b]}]);if(r.error)return r;let{updateParticipantRatings:n,removePriorValues:a=!0,tournamentRecord:o,ratingType:s=Fo,refreshDynamic:l,considerGames:u,drawDefinition:c,matchUpIds:d,asDynamic:p}=t,m=Tr[s],{accessor:h}=m,f={},g=(t.matchUps||l&&Pn({drawDefinition:c,tournamentRecord:o,inContext:!0,matchUpFilters:{matchUpStatuses:yr}}).matchUps||Hr({matchUpFilters:{matchUpIds:d,matchUpStatuses:yr},tournamentRecord:o,inContext:!0}).matchUps)??[],v=`${s}.${VF}`,y=p?v:s;g.sort(xh);for(let b of g){let{endDate:S,matchUpFormat:w,score:U,sides:T,winningSide:D}=b,P=b.matchUpType,E={eventType:P,scaleName:s,scaleType:Ic},R={scaleName:v,eventType:P,scaleType:Ic},N=Object.assign({},...(T??[]).map(_=>{let{sideNumber:L,participant:B}=_;return L&&{[L]:[B==null?void 0:B.participantId,...(B==null?void 0:B.individualParticipantIds)??[]].filter(Boolean).flat()}})),A=Object.assign({},...Object.values(N).flat().map(_=>{let L=f[_],B=!l||L?hg({scaleAttributes:R,tournamentRecord:o,participantId:_}).scaleItem:void 0,V=hg({tournamentRecord:o,scaleAttributes:E,participantId:_}).scaleItem,G=h?{[h]:void 0}:void 0;return _&&{[_]:B??V??{scaleName:y,eventType:P,scaleDate:S,scaleType:Ic,scaleValue:G}}})),M=w?Ln(w):{},C=(M==null?void 0:M.bestOf)||1,O=(M==null?void 0:M.setsTo)||1,k=u?C&O:C,x=(U==null?void 0:U.sets)&&LPe(U.sets)||D===1&&[1,0]||[0,1],F=D?N[D]:[],$=D?N[3-D]:[];for(let _ of F){let L=(e=A[_])==null?void 0:e.scaleValue,B=typeof L=="object"?L[h]:L;for(let V of $){let G=(i=A[V])==null?void 0:i.scaleValue,j=typeof G=="object"?G[h]:G,z=D?x[D]:[0,0],W=D?x[3-D]:[0,0],{newWinnerRating:q,newLoserRating:Y}=iZ({winnerCountables:z,loserCountables:W,maxCountables:k,winnerRating:B,loserRating:j,ratingType:s}),re=h?{...L,[h]:q}:q,K=h?{...G,[h]:Y}:Y;A[_].scaleValue=re,A[V].scaleValue=K,A[_].scaleName=y,A[V].scaleName=y}}Object.assign(f,A),n&&w_({tournamentRecord:o,modifiedScaleValues:f,removePriorValues:a})}let I=g.map(({matchUpId:b})=>b);return{...Q,modifiedScaleValues:f,outputScaleName:y,processedMatchUpIds:I}}function gR(t){var e;let{matchUpIds:i=[],drawDefinition:r,roundNumber:n,newRound:a,isMock:o,event:s}=t;if(typeof r!="object")return{error:$e};let{participantIdPairings:l,matchUpsCount:u}=t,c=mR(t);if(c.error)return te({result:c});let{lastRoundNumber:d,availableMatchUpsCount:p=0,roundMatchUpsCount:m=0}=c;if(!u)a?u=m:p>0&&(u=p);else if(u>m&&t.restrictMatchUpsCount!==!1)return te({result:{error:se,info:"matchUpsCount error",context:{roundMatchUpsCount:m}}});if(l&&!Array.isArray(l)||u&&!st(u)||i&&!Array.isArray(i)||!l&&!u)return{error:se,info:"matchUpsCount or pairings error"};if(u&&t.restrictMatchUpsCount!==!1&&u>32)return{error:se,info:"matchUpsCount must be less than 33"};if(n&&!t.ignoreLastRoundNumber&&n-1>(d||0))return{error:se,info:"roundNumber error"};let h=n??(a&&(d??0)+1||d||1);l=l??Te(0,u).map(()=>({participantIds:[void 0,void 0]}));let f=v=>{if(!t.idPrefix)return;let y=r.drawId,I=t.idPrefix??"ah";return`${y}-${I}-${h}-${v}`},g=l==null?void 0:l.map((v,y)=>{let I=(v==null?void 0:v.participantIds)??[void 0,void 0];I.push(void 0,void 0);let b=I.slice(0,2).map((w,U)=>He({sideNumber:U+1,participantId:w})),S=i[y]??f(y)??Ht();return{roundNumber:h,matchUpStatus:Qi,matchUpId:S,sides:b}});if(g!=null&&g.length){let v=(e=In({drawDefinition:r,event:s}))==null?void 0:e.tieFormat;v&&g.forEach(y=>{let{tieMatchUps:I}=Fw({tieFormat:v,matchUp:y,isMock:o});Object.assign(y,{tieMatchUps:I,matchUpType:fi})})}return{roundNumber:h,matchUpsCount:(g==null?void 0:g.length)??0,matchUps:g,...Q}}function _Pe({maxIterations:t=4e3,valueSortedPairings:e,pairingValues:i,valueObjects:r,deltaObjects:n}){let a=Object.assign({},...e.map(y=>({[y.pairing]:y.value}))),o=Object.keys(i),s=[],l=G2({actorsCount:o.length,valueSortedPairings:e,pairingValueMap:a,deltaObjects:n,valueObjects:r}),u=[YE(l)];s.push(l);let c=l.value,d=l,p=1,m=0,h=o.length,f;do h-=1,f=o.length*i[o[0]].length;while(f>t&&h>5);let g=[];o.forEach(y=>{i[y].slice(0,h).forEach(I=>{m+=1;let b=dm(y,I.opponent);if(!g.includes(b)){let S=G2({stipulated:[[y,I.opponent]],actorsCount:o.length,valueSortedPairings:e,pairingValueMap:a,deltaObjects:n,valueObjects:r});if(!u.includes(YE(S))){u.push(YE(S)),s.push(S);let{maxDelta:w,value:U}=S;w<d.maxDelta&&(d=S),(U<c||U===c&&Math.round(Math.random()))&&(c=U),g.push(b),p+=1}}}),s=s.filter(I=>Math.abs(I.value-c)<5)}),s.sort((y,I)=>y.maxDiff-I.maxDiff);let v=ga(s);return{candidatesCount:p,deltaCandidate:d,maxIterations:t,iterations:m,candidate:v}}function YE(t){return t.participantIdPairings.map(({participantIds:e})=>e.sort().join("|")).sort().join("/")}function G2({valueSortedPairings:t,stipulated:e=[],pairingValueMap:i,deltaObjects:r,valueObjects:n,actorsCount:a}){let o=[].concat(...e),s=[],l=0;e.filter(Boolean).forEach(d=>{let[p,m]=d,h=dm(p,m),f=i[h];s.push({participantIds:d,value:f}),l+=i[h]}),Cr(t,a).map(d=>Tn(d).map(p=>({...p,value:p.value+Math.random()*Math.round(Math.random())}))).flat().forEach(d=>{let p=d.pairing.split("|");if(!p.reduce((m,h)=>o.includes(h)||m,!1)){o.push(...p);let m=d.value;l+=m,s.push({participantIds:p,value:m})}}),s.sort((d,p)=>d.value-p.value);let u=s.reduce((d,p)=>{let[m,h]=p.participantIds,f=dm(m,h),g=r[f];return g>d?g:d},0),c=s.reduce((d,p)=>{let[m,h]=p.participantIds,f=dm(m,h),g=n[f];return g>d?g:d},0);return{value:l,participantIdPairings:s,maxDelta:u,maxDiff:c}}function dm(t,e){return[t,e].sort(eR).join("|")}function nZ({participantIds:t}){let e={},i=[];t.forEach(n=>{e[n]=t.filter(a=>a!==n),e[n].forEach(a=>{let o=dm(a,n);i.includes(o)||i.push(o)})});let r=Object.assign({},...i.map(n=>({[n]:0})));return{uniquePairings:i,possiblePairings:e,deltaObjects:r}}function $Pe({matchUps:t}){let e=[];for(let i of t){let r=i.sides.map(Tt);if(r.length===2){let[n,a]=r,o=dm(n,a);e.includes(o)||e.push(o)}}return{encounters:e}}function BPe({possiblePairings:t,valueObjects:e}){let i={};for(let n of Object.keys(t)){let a=t[n].map(o=>r(n,o));i[n]=a.sort((o,s)=>o.value-s.value)}function r(n,a){let o=dm(n,a);return{opponent:a,value:e[o]}}return{pairingValues:i}}var VPe=0;function jPe({tournamentParticipants:t,adHocRatings:e,eventType:i,scaleName:r,pairing:n}){var a;let o=((a=Tr[r])==null?void 0:a.defaultInitialization)??VPe;return n.split("|").map(s=>{var l;if(i===ho){let u=(l=t==null?void 0:t.find(c=>c.participantId===s))==null?void 0:l.individualParticipantIds;return u?u==null?void 0:u.map(c=>e[c]||o):o*2}else return e[s]||o})}function GPe(t){let{tournamentParticipants:e,adHocRatings:i={},possiblePairings:r,uniquePairings:n,maxIterations:a,minimizeDelta:o,deltaObjects:s,valueObjects:l,eventType:u,scaleName:c,salted:d}=t;n.forEach(I=>{let b=jPe({tournamentParticipants:e,adHocRatings:i,scaleName:c,eventType:u,pairing:I}),S=typeof d=="number"&&d||.5,w=d&&(Math.round(Math.random())?S:S*-1)||0,U=Math.abs(b[0]-b[1])+w,T=Math.abs(b[0]-b[1]);s[I]=T,l[I]||(l[I]=0),l[I]+=U?Math.pow(U,2):0});let p=n.map(I=>({pairing:I,value:l[I]})).sort((I,b)=>I.value-b.value),{pairingValues:m}=BPe({possiblePairings:r,valueObjects:l}),{candidate:h,candidatesCount:f,deltaCandidate:g,iterations:v}=_Pe({valueSortedPairings:p,maxIterations:a,pairingValues:m,deltaObjects:s,valueObjects:l}),{participantIdPairings:y}=o?g:h;return{participantIdPairings:y,candidatesCount:f,deltaCandidate:g,iterations:v,candidate:h}}var HPe=100,zPe=100,WPe=4e3;function U_(t){var e,i;let{encounterValue:r=HPe,sameTeamValue:n=zPe,maxIterations:a=WPe,updateParticipantRatings:o,generateMatchUps:s=!0,ignoreLastRoundNumber:l,iterationMatchUps:u,tournamentRecord:c,dynamicRatings:d,refreshDynamic:p,participantIds:m,drawDefinition:h,roundNumber:f,structureId:g,matchUpIds:v,eventType:y,scaleName:I,idPrefix:b,isMock:S,salted:w,event:U}=t;if(!h)return{error:$e};if(!t.structure&&!g)return{error:Ai};let T=t.structure||tt({drawDefinition:h,structureId:g}).structure;if(!At(T))return{error:Tp};if(!(m!=null&&m.length))return{error:Qc};let D=[...u??[],...(T==null?void 0:T.matchUps)??[]],{encounters:P}=$Pe({matchUps:D}),E=(c==null?void 0:c.participants)??[],R={};if(d){let z=dt(T!=null&&T.matchUps?T.matchUps.map(({roundNumber:q})=>q):[]),W=Math.max(...z,0);if(W){let q=(e=T==null?void 0:T.matchUps)==null?void 0:e.filter(({roundNumber:re})=>re===W).map(({matchUpId:re})=>re),Y=rZ({ratingType:I??((i=U==null?void 0:U.category)==null?void 0:i.ratingType),updateParticipantRatings:o,tournamentRecord:c,asDynamic:!0,refreshDynamic:p,drawDefinition:h,matchUpIds:q});if(Y.error)return Y;Y.modifiedScaleValues&&(R=Y.modifiedScaleValues)}}let{valueObjects:N}=qPe({tournamentParticipants:E,encounterValue:r,sameTeamValue:n,encounters:P}),{uniquePairings:A,possiblePairings:M,deltaObjects:C}=nZ({participantIds:m}),O=Object.values(R).length?R:t.adHocRatings,k={tournamentParticipants:E,possiblePairings:M,participantIds:m,uniquePairings:A,drawDefinition:h,maxIterations:a,adHocRatings:O,deltaObjects:C,valueObjects:N,eventType:y,scaleName:I,structure:T,salted:w},{candidatesCount:x,participantIdPairings:F,deltaCandidate:$,iterations:_,candidate:L}=GPe(k);if(!x)return{error:hP};let B,V;if(s){let z=gR({structureId:T==null?void 0:T.structureId,ignoreLastRoundNumber:l,participantIdPairings:F,newRound:!0,drawDefinition:h,roundNumber:f,matchUpIds:v,idPrefix:b,isMock:S,event:U});if(z.error)return z;B=z.roundNumber,V=z.matchUps}let{maxDelta:G,maxDiff:j}=L;return{roundNumber:B,participantIdPairings:F,modifiedScaleValues:R,candidatesCount:x,deltaCandidate:$,...Q,iterations:_,matchUps:V,maxDelta:G,maxDiff:j}}function qPe({encounters:t,tournamentParticipants:e,encounterValue:i,sameTeamValue:r}){let n={};for(let o of t)n[o]||(n[o]=0),n[o]+=i;let a=e==null?void 0:e.filter(({participantType:o})=>o===Xt);if(a)for(let o of a){let s=o.individualParticipantIds??[],{uniquePairings:l}=nZ({participantIds:s});for(let u of l)n[u]||(n[u]=0),n[u]+=r}return{valueObjects:n}}function aZ(t){var e,i,r,n;let{drawType:a=Ks,attachConsolation:o=!0,applyPositioning:s=!0,tournamentRecord:l,staggeredEntry:u,automated:c,placeByes:d,isMock:p,event:m}=t,h=t==null?void 0:t.drawDefinition;if(!h)return{error:$e};let f=Lr,g=Eh({stageSequence:1,drawDefinition:h,stage:f}),v=[is,iw,Kl].includes(a)?g.length:nv(g.length);if(!u&&a===mv&&g.length<2||a===is&&g.length<3)return{error:oP};let{tieFormat:y,matchUpType:I}=t;if(y){let M=qn({tieFormat:y});if(M.error)return M}y=Yr(y??((e=In({drawDefinition:h}))==null?void 0:e.tieFormat)),I=I??h.matchUpType??ii;let{structures:b}=ns({stageSequence:1,drawDefinition:h,stage:f});if(b.length>1)return{error:ZK};if((r=(i=b==null?void 0:b[0])==null?void 0:i.matchUps)!=null&&r.length)return{error:fF};let S=(n=b==null?void 0:b[0])==null?void 0:n.structureId;Object.assign(t,He({structureName:t.structureName??tn(Lr),structureId:S,matchUpType:I,tieFormat:y,drawSize:v,stage:f}));let w=QQ(t);if(w.error)return w;let U=w.generators[a];if(!U)return{error:Wx};let T=U==null?void 0:U();if(T.error)return T;let{structures:D,links:P}=T,E=D.map(M=>qt({structure:M}).matchUps).flat();y&&E.forEach(M=>{let{tieMatchUps:C}=Fw({matchUp:M,tieFormat:y,isMock:p});Object.assign(M,{tieMatchUps:C,matchUpType:I})}),(!s||!o)&&(h=Ne(h,!1,!0)),h.links||(h.links=[]),P.length&&h.links.push(...P);let R=D.map(({structureId:M})=>M);h.structures||(h.structures=[]);let N=h.structures.map(({structureId:M})=>M);h.structures=h.structures.map(M=>R.includes(M.structureId)?D.find(({structureId:C})=>C===M.structureId):M);let A=D.filter(({structureId:M})=>!N.includes(M));return A.length&&h.structures.push(...A),c&&Ow({seedingProfile:t.seedingProfile,applyPositioning:s,tournamentRecord:l,drawDefinition:h,structureId:S,placeByes:d,drawSize:v,event:m}),o&&ui({drawDefinition:h}),{links:P,structures:D,...Q}}var S_={};bt(S_,{addGame:()=>mZ,addPoint:()=>pZ,addSet:()=>fZ,addShot:()=>hZ,analyzeScore:()=>C_,analyzeSet:()=>vy,calculateHistoryScore:()=>uZ,checkScoreHasValue:()=>br,checkSetIsComplete:()=>yR,clearHistory:()=>dZ,generate:()=>oZ,generateScoreString:()=>_l,generateTieMatchUpScore:()=>$w,getSetComplement:()=>N_,getTiebreakComplement:()=>SR,helpers:()=>yZ,isValidMatchUpFormat:()=>Ra,keyValueScore:()=>zZ,mutate:()=>lZ,parseMatchUpFormat:()=>Ln,parseScoreString:()=>U0,query:()=>XZ,redo:()=>gZ,reverseScore:()=>sZ,setServingSide:()=>cZ,stringifyMatchUpFormat:()=>SP,tidyScore:()=>KZ,umo:()=>IZ,undo:()=>vZ,validateScore:()=>M_,validateTieFormat:()=>qn});var oZ={};bt(oZ,{generateScoreString:()=>_l,generateTieMatchUpScore:()=>$w,reverseScore:()=>sZ});function _l(t){let{winnerFirst:e=!0,addOutcomeString:i,reversed:r=!1,matchUpStatus:n,matchUpFormat:a,autoComplete:o,winningSide:s,sets:l}=t;if(!l)return{error:Je,info:"missing sets"};let u=a&&Ln(a),{bestOf:c,finalSetFormat:d,setFormat:p}=u??{},m=r||!(!e||!s||s===1),h=i?YPe({matchUpStatus:n}):"",f=(l==null?void 0:l.sort(KPe).map(g).filter(Boolean).join(" "))||"";if(!h)return f;if(s===2)return`${h} ${f}`;return`${f} ${h}`;function g(v){let y=c&&v.setNumber===c&&d?d:p,I=$=>_i($==null?void 0:$.side1Score)||_i($==null?void 0:$.side2Score),b=$=>_i($==null?void 0:$.side1TiebreakScore)||_i($==null?void 0:$.side2TiebreakScore),S=(y==null?void 0:y.tiebreakSet)||!I(v)&&b(v),{side1Score:w,side2Score:U,side1TiebreakScore:T,side2TiebreakScore:D}=v,P=T||(_i(T)||o?0:""),E=D||(_i(D)||o?0:"");if(S)return`[${(m?[E,P]:[P,E]).join("-")}]`;let R=Math.min(P,E),N=R===P?1:2,A=R?`(${R})`:"",M=w||(_i(w)||o?0:""),C=U||(_i(U)||o?0:""),O=$=>N===$?A:"",k=`${M}${O(1)}`,x=`${C}${O(2)}`,F=m?`${[x,k].join("-")}`:`${[k,x].join("-")}`;return["-"," "].includes(F)&&(F=""),F}}function YPe({matchUpStatus:t}){let e={[zr]:"RET",[Ft]:"WO",[dr]:"DF/DF",[tr]:"WO/WO",[rd]:"SUS",[ua]:"ABN",[Pt]:"DEF",[Iv]:"DR"};return t&&e[t]||""}function KPe(t,e){return t.setNumber-e.setNumber}function sZ(t){if(!(t!=null&&t.score))return{error:Je};let{sets:e}=t.score,i=e.map(a=>{let{side1TiebreakScore:o,side2TiebreakScore:s,winningSide:l,side1Score:u,side2Score:c,setNumber:d}=a;return He({winningSide:l?3-l:void 0,side1TiebreakScore:s,side2TiebreakScore:o,side1Score:c,side2Score:u,setNumber:d})}),r=_l({sets:i}),n=_l({sets:i,reversed:!0});return{reversedScore:{sets:i,scoreStringSide1:r,scoreStringSide2:n},...Q}}var lZ={};bt(lZ,{addGame:()=>mZ,addPoint:()=>pZ,addSet:()=>fZ,addShot:()=>hZ,calculateHistoryScore:()=>uZ,clearHistory:()=>dZ,redo:()=>gZ,setServingSide:()=>cZ,umo:()=>IZ,undo:()=>vZ});function kp({matchUp:t}){let{extension:e}=vt({name:$P,element:t});if(!e)return{error:jr};let{history:i=[],undoHistory:r=[]}=e.value;return{history:i,undoHistory:r,...Q}}function uZ(t){var e,i;if(!t)return{error:Je};let{matchUp:r,updateScore:n}=t;if(!r)return{error:sa};let a=((e=kp({matchUp:r}))==null?void 0:e.history)||[];if(!Array.isArray(a))return{error:se,info:"history is not an array"};let{matchUpFormat:o}=r;if(!o)return{error:Zx};if(!Ra({matchUpFormat:o}))return{error:Qx};let s=Ln(o),{bestOf:l,finalSetFormat:u,setFormat:c}=s,d=["0","15","30","40","A","G"],p={sets:[]},m=[],h,f=[0,0],g=1,v=0,y,I=0,b=R=>[1,2].includes(R),S=()=>(v+=1,{winningSide:void 0,side1Score:0,side2Score:0,setNumber:v,games:[]}),w=()=>({winningSide:void 0,points:[]}),U=()=>({winningSide:void 0,side1Score:"",side2Score:"",shots:[]}),T=U(),D=w(),P=S(),E=0;for(let R of a){E+=1,y=p.sets.length+1===l;let N=y&&u?u:c,{tiebreakAt:A,setTo:M,NoAD:C,tiebbreakFormat:O}=N,k=P.side1Score===A&&P.side1Score===P.side2Score,x=!!N.tiebreakSet,F=x?N.tiebreakSet:O,{tiebreakTo:$,NoAD:_}=F||{},L=()=>{h=void 0,f=[0,0],g=3-g,P.side1TiebreakScore=0,P.side2TiebreakScore=0,P.side1PointScore="",P.side2PointScore="",I=0},B=j=>{P.winningSide=j;let{s:z,...W}=P;p.sets.push(W),T=U(),D=w(),P=S(),L()},V=j=>{D.winningSide=j;let{g:z,...W}=D;P.games.push(W),T=U(),D=w(),L();let q=`side${j}Score`;P[q]+=1},G=j=>{T.winningSide=j;let{p:z,...W}=T;D.points.push(W),T=U(),I=0;let q=()=>f.reduce((re,K)=>re+K)%4/4>.5?g:3-g,Y=j-1;if(k||x){f[Y]+=1,h=q(),P[`side${j}TiebreakScore`]=f[Y],P[`side${3-j}TiebreakScore`]=f[1-Y];let re=_?1:2;if(f[Y]>=$&&f[Y]>=f[1-Y]+re)return V(j),{gameCompleted:!0}}else if(f[1-Y]===4&&f[Y]===3?f[1-Y]-=1:f[Y]+=1,P.side1PointScore=d[f[0]],P.side2PointScore=d[f[1]],f[Y]===5||f[Y]===4&&f[1-Y]<3||C&&f[Y]===4)return V(j),{gameCompleted:!0}};if(b(R.srv)&&(g=R.srv),["p","s","g","o"].includes(R.u)&&m.push(R.u),R.shotOutcome&&(T.shots.push(R),R.shotType==="SERVE"&&["OUT","NET"].includes(R.shotOutcome)&&(I+=1),I===2)){let j=3-g;G(j)}if(b(R.p)||st(R.pointNumber)){let j=R.winningSide||R.p;if((i=G(j))!=null&&i.gameCompleted)continue}if(b(R.g)||st(R.gameNumber)){let j=R.winningSide||R.g;D.winningSide=j;let z=`side${j}Score`,W=`side${3-j}Score`;if(m.length&&(m.includes("p"),m=[]),V(j),P[z]===M&&P[z]-P[W]>=(C?1:2)&&(B(j),y))break}if(b(R.s)||st(R.setNumber)){let j=R.winningSide||R.s;if(B(j),m.length&&(m.includes("p"),m.includes("g"),m=[]),y)break}}return E!==a.length&&console.log({error:"Match completed with excess history"}),(P.side1Score||P.side2Score||P.games.length||P.side1TiebreakScore||P.side2TiebreakScore)&&p.sets.push(P),p.scoreStringSide1=_l({...p,matchUpFormat:o}),p.scoreStringSide2=_l({...p,matchUpFormat:o,reversed:!0}),g=h||g,n&&(r.score=p),{...Q,servingSide:g,score:p}}function xp({undoHistory:t,history:e,matchUp:i}){return _t({element:i,extension:{value:{history:e,undoHistory:t},name:$P}})}function cZ({matchUp:t,sideNumber:e}){if(![1,2].includes(e))return{error:rF};let{history:i=[]}=kp({matchUp:t});return i.push({srv:e}),xp({matchUp:t,history:i})}function dZ({matchUp:t}){return xp({matchUp:t})}function pZ({matchUp:t,point:e}){if(!e||!t)return{error:Je};if(typeof e!="object")return{error:se,context:{point:e}};let{history:i=[]}=kp({matchUp:t});return i.push(e),xp({matchUp:t,history:i})}function mZ({matchUp:t,game:e}){if(typeof e!="object")return{error:se,context:{game:e}};let{history:i=[]}=kp({matchUp:t});return i.push(e),xp({matchUp:t,history:i})}function hZ({matchUp:t,shot:e}){if(typeof e!="object")return{error:Je};let{history:i=[]}=kp({matchUp:t});return i.push(e),xp({matchUp:t,history:i})}function fZ({matchUp:t,set:e}){if(typeof e!="object")return{error:Je};let{history:i=[]}=kp({matchUp:t});return i.push(e),xp({matchUp:t,history:i})}function gZ({matchUp:t}){let{history:e=[],undoHistory:i=[]}=kp({matchUp:t});return i.length&&e.push(i.pop()),xp({matchUp:t,history:e,undoHistory:i})}function vZ({matchUp:t}){let{history:e=[],undoHistory:i=[]}=kp({matchUp:t});return i.push(e.pop()),xp({matchUp:t,history:e,undoHistory:i})}var IZ={},yZ={};bt(yZ,{keyValueScore:()=>zZ,parseMatchUpFormat:()=>Ln,stringifyMatchUpFormat:()=>SP,tidyScore:()=>KZ});var pm=" ",jM="DEF",XPe="COMPLETED",bZ="WO",JPe="WO/WO",wZ="ABN",UZ="SUS",SZ="RET",TZ="INT",DZ=[SZ,jM,bZ,JPe,wZ,UZ,TZ],GM="DEFAULTED",PZ="WALKOVER",RZ="ABANDONED",EZ="SUSPENDED",CZ="RETIRED",MZ="INTERRUPTED",QPe=[CZ,GM,PZ],ZPe="Enter Score",Bm="()",ap="[]",T_=["up","left","shift+tab"],D_=["enter","down","tab","right"],y0="backspace",NZ="r",AZ="s",OZ="a",kZ="d",xZ="w",FZ="i",vR=[NZ,kZ,xZ,OZ,AZ,FZ],IR="space",KE=["[","("],b0=[...T_,...D_,IR,"]"],LZ="-",eRe="/",mm=LZ,$l=LZ,_Z=[eRe],tRe=0,iRe=["=","+","num_1","num_2","shift+=","shift+-"],P_=["0","1","2","3","4","5","6","7","8","9"].concat(vR),$Z=P_.map(t=>`shift+${t}`),BZ=[mm,y0].concat(b0,_Z),VZ=[P_,$Z,BZ].join(","),rRe=[VZ,T_,D_,iRe].join(","),nRe={OUTCOMEKEYS:vR,SIDE1KEYS:P_,SIDE2KEYS:$Z,MODIFIERS:BZ,PROMPT:ZPe,MOVEUP:T_,MOVEDOWN:D_,HOTKEYS:rRe};function Qh({scoreString:t,lowSide:e,outcome:i}){if({scoreString:t}=jZ({scoreString:t}),e===2){let r=(t&&t[t.length-1])!==pm?pm:"";return t+r+i}else return i+pm+t}function jZ({scoreString:t}){if(!t)return{scoreString:""};let e=!1;for(let i of DZ){let r=t==null?void 0:t.indexOf(i);r===0?t=t.slice(i.length+1).trim()+pm:r>0&&(t=t.slice(0,r)),r>=0&&(e=!0)}return t!=null&&t.trim()||(t=""),{scoreString:t,removed:e}}function HM({analysis:t,scoreString:e,sets:i,lowSide:r}){var n,a,o;let s,l;if(!e)return{scoreString:e,sets:i};let{scoreString:u,removed:c}=jZ({scoreString:e});if(e=u,c)return{scoreString:e,sets:i,outcomeRemoved:!0};let d=i[i.length-1]||{},p=Object.values(d).filter(y=>y!==void 0).length;d.setNumber&&p===1&&(i=i.slice(0,i.length-1),d=i[i.length-1]||{});let{tiebreakSet:m}=t.setFormat,{tiebreakTo:h,NoAD:f}=m||{},{isTiebreakEntry:g}=Uf({brackets:ap,scoreString:e}),v=oRe(e);if(v>=0){s=e.slice(0,v);let{isTiebreakEntry:y}=Uf({brackets:Bm,scoreString:s}),{lastOpenBracketIndex:I,isTiebreakEntry:b}=Uf({brackets:ap,scoreString:s}),S=s&&s[s.length-1].trim(),w=s&&!isNaN(S),U=t.isIncompleteSetScore;if(g&&b){let T=s.slice(I+1).split($l),D=(T==null?void 0:T.length)>0&&T[0]!==void 0&&!isNaN(parseInt(T[0]))&&parseInt(T[0])||void 0,P=(T==null?void 0:T.length)>1&&T[1]!==void 0&&parseInt(T[1])||void 0,E=[D,P];if(P){let R=r===1?1:0;E[R]=((E==null?void 0:E[1-R])||0)+(f?1:2),(E[R]||0)<h&&(E[R]=h),s=e.slice(0,I+1),s+=E.join($l)}else D!==void 0?(s=e.slice(0,I+1),s+=D):(s=e.slice(0,I),U=!0);d.side1TiebreakScore=E[0]||0,d.side2TiebreakScore=E[1]||0}if(s.length||(s=void 0),U){let T=(n=d.side1Score)==null?void 0:n.toString();if(T){let D=T==null?void 0:T.slice(0,T.length-1);d.side1Score=!isNaN(D)&&parseInt(D)||void 0,d.side1Score===void 0&&(d.side2Score=void 0)}t.isTimedSet?(l=d.side1Score?i:(i==null?void 0:i.slice(0,i.length-1))||[],l[i.length-1]=d):l=(i==null?void 0:i.slice(0,i.length-1))||[]}else if(w){let T=(a=d.side2Score)==null?void 0:a.toString(),D=(o=d.side1Score)==null?void 0:o.toString();if(!t.isTiebreakEntry&&!t.isMatchTiebreak)if(d.side2Score){let P=T==null?void 0:T.slice(0,T.length-1);d.side2Score=!isNaN(P)&&parseInt(P)||void 0}else{let P=D==null?void 0:D.slice(0,D.length-1);d.side1Score=!isNaN(P)&&parseInt(P)||void 0}t.isTimedSet?d.side1Score?(l=i||[],l[i.length-1]=d):l=(i==null?void 0:i.slice(0,i.length-1))||[]:(l=i||[],l[i.length-1]=d),l[l.length-1]&&Object.assign(l[l.length-1],{winningSide:void 0})}else y?(l=i||[],Object.assign(l[l.length-1]||{},{winningSide:void 0,side1TiebreakScore:void 0,side2TiebreakScore:void 0})):(g&&!b?l=(i==null?void 0:i.slice(0,i.length-1))||[]:(l=i,l[i.length-1]=d),g||(l[l.length-1].side2Score=0,l[l.length-1].winningSide=void 0));return{scoreString:s,sets:l}}return{scoreString:e,sets:i}}function Uf({brackets:t=Bm,scoreString:e}){if(!e)return{};let[i,r]=t.split(""),n=e.split(""),a=Math.max(...Ys(i,n)),o=Math.max(...Ys(r,n));return{isTiebreakEntry:a>o,lastOpenBracketIndex:a}}function aRe({scoreString:t}){if(!t)return!1;let e=t&&t[t.length-1].trim(),i=t&&!isNaN(e),[r,n]=ap.split(""),a=t.split(""),o=Math.max(...Ys(r,a)),s=Math.max(...Ys(n,a)),l=Math.max(...Ys($l,a));return i&&o>s&&l>o}function oRe(t){return t.split("").reduce((e,i,r)=>(i.match(/\d+/g)&&e.push(r),e),[]).pop()}function GZ(t){let{lowValue:e=0,NoAD:i=!1,tiebreakTo:r}=t||{},n=i?1:2;return e+1>=r?e+n:parseInt(r)}function H2({matchUpFormat:t,matchUpStatus:e,winningSide:i,sets:r}){var n;let a=Ln(t),{bestOf:o}=a,s=Math.ceil(o/2),l=((n=r==null?void 0:r.reduce((u,c)=>{let{winningSide:d}=c;return d&&u[d-1]++,u},[0,0]))==null?void 0:n.indexOf(s))+1||void 0;return QPe.includes(e)&&i&&(l=i),{matchUpWinningSide:l}}function yR({ignoreTiebreak:t=!1,matchUpScoringFormat:e,matchUpFormat:i,isTiebreakSet:r,isDecidingSet:n,isTimedSet:a,set:o}){var s;if(!o)return{error:Je,info:"missing set"};e=e||i&&Ln(i);let l=n&&e.finalSetFormat||(e==null?void 0:e.setFormat)||{},{side1Score:u,side2Score:c}=o,{setTo:d,tiebreakAt:p}=l,m=u||c,h=bR({set:o}),f=Math.abs(u-c),g=u>=d||c>=d,v=r||u>=d&&c>=d||p&&p<d&&(u===p||c===p),y=t||v&&(h===1&&o.side1TiebreakScore>o.side2TiebreakScore||h===2&&o.side2TiebreakScore>o.side1TiebreakScore),I=!v&&l.NoAD||v||r&&(s=l.tiebreakFormat)!=null&&s.NoAD?1:2,b=f>=I;return!!((a&&m||g&&(b||v)||r)&&(!v||y))}function bR({set:t}){if(t.side1Score||t.side2Score){if(t.side1Score>t.side2Score)return 1;if(t.side2Score>t.side1Score)return 2}else if(t.side1TiebreakScore||t.side2TiebreakScore){if(t.side1TiebreakScore>t.side2TiebreakScore)return 1;if(t.side2TiebreakScore>t.side1TiebreakScore)return 2}}function R_({analysis:t,set:e}){let i=bR({set:e}),{isDecidingSet:r,isTiebreakSet:n,matchUpScoringFormat:a}=t;return yR({matchUpScoringFormat:a,isDecidingSet:r,isTiebreakSet:n,set:e})&&i}function sRe({analysis:t,scoreString:e,sets:i,value:r}){let n;if(!(i!=null&&i.length))return{sets:[]};let a=i[i.length-1];r=Ze(r);let{validSide2Score:o,requiresTiebreak:s}=lRe({analysis:t,set:a,value:r});if(o){n=!0,e=(e||"")+r,a.side2Score=r;let l=R_({analysis:t,set:i[i.length-1]});if(a.winningSide=l||void 0,s){let u=Bm.split("")[0];e+=u}else t.isDecidingSet||(e+=pm)}return{sets:i,scoreString:e,updated:n}}function lRe({analysis:t,set:e={},value:i}){let r=t.isDecidingSet&&t.matchUpScoringFormat.finalSetFormat||t.matchUpScoringFormat.setFormat,{tiebreakAt:n,setTo:a,NoAD:o}=r,{side1Score:s}=e,l,u;return n&&n<a?s===n?l=i<=a:l=i<=n:s===a?o?l=i<a:l=i<=a+1:s===a-1?o?l=i<=a:l=i<=a+1:s===a+1?l=i===a||i===a-1:l=i<=a,l&&(n&&n<a?u=s===a&&i===n||s===n&&i===a:u=s>=a&&i>=a&&s!==i),{validSide2Score:l,requiresTiebreak:u}}function HZ({lowSide:t,value:e,sets:i,scoreString:r,winningSide:n,matchUpStatus:a}){let o;return e===NZ?r?(o=!0,r=Qh({scoreString:r,lowSide:t,outcome:SZ}),n=t===2?1:2,a=CZ):(o=!0,r=Qh({scoreString:r,lowSide:t,outcome:jM}),n=t===2?1:2,a=GM):e===kZ?(o=!0,r=Qh({scoreString:r,lowSide:t,outcome:jM}),n=t===2?1:2,a=GM):e===xZ?(o=!0,i=[],r=bZ,n=t===2?1:2,a=PZ):e===AZ&&r?(o=!0,r=Qh({scoreString:r,lowSide:t,outcome:UZ}),a=EZ,n=void 0):e===OZ?(o=!0,r=Qh({scoreString:r,lowSide:t,outcome:wZ}),a=RZ,n=void 0):e===FZ&&r&&(o=!0,r=Qh({scoreString:r,lowSide:t,outcome:TZ}),a=MZ,n=void 0),{updated:o,sets:i,scoreString:r,matchUpStatus:a,winningSide:n}}function uRe(t){let{sets:e,info:i,scoreString:r,winningSide:n,matchUpStatus:a}=t,{analysis:o,lowSide:s,value:l}=t,u,c;!(e!=null&&e.length)&&l!==y0&&(e=[{setNumber:1}]);let d=e.length-1;if(vR.includes(l)){let p=e[e.length-1]||{},{side1Score:m,side2Score:h}=p;m&&!h?i="missing side2Score":o.finalSetIsComplete||n?i="final set is already complete":o.isIncompleteSetScore?i="incomplete set scoreString":o.isIncompleteSetScore||({sets:e,scoreString:r,winningSide:n,matchUpStatus:a,updated:u}=HZ({lowSide:s,value:l,sets:e,scoreString:r,matchUpStatus:a,winningSide:n}))}else if(l===y0){if({scoreString:r,sets:e,outcomeRemoved:c}=HM({analysis:o,scoreString:r,sets:e}),(r==null?void 0:r.trim())===""&&(r=r.trim()),r||(e=[]),c){let p=e[e.length-1]||{},{side1Score:m,side2Score:h}=p;if(m&&h){let f=m>h&&1||h>m&&2||void 0;f&&(p.winningSide=f,e.push({setNumber:e.length+1}))}}a=void 0,n=void 0,u=!0}else if(o.hasOutcome)i="has outcome";else{if(n)return{sets:e,scoreString:r,winningSide:n,matchUpStatus:a,updated:!1,info:"matchUp is complete"};if(l===IR){let p=e[e.length-1]||{},{side1Score:m,side2Score:h}=p,f=m>h&&1||h>m&&2||void 0;f&&!n&&!o.isIncompleteSetScore&&(e[e.length-1].winningSide=f,e.push({setNumber:e.length+1}),r+=" ",u=!0)}else if(l===mm&&e[d].side1Score!==void 0&&e[d].side2Score===void 0&&r&&o.isNumericEnding)r+="-",e[d].side2Score=0,a=void 0,n=void 0,u=!0;else if(!isNaN(l)){let p;if(e[d].side2Score===void 0){let m=Ze((e[d].side1Score||0).toString()+l).toString().slice(0,2);e[d].side1Score=Ze(m),p=e[d].side1Score.toString(),u=!0}else{let m=Ze((e[d].side2Score||0).toString()+l).toString().slice(0,2);e[d].side2Score=Ze(m),p=[e[d].side1Score,e[d].side2Score].join("-"),u=!0}if(u){let m=(e.slice(0,d)||[]).filter(h=>h).map(h=>{let{side1Score:f,side2Score:g}=h;return[f,g].join("-")}).join(" ");m?r=m+" "+p:r=p}}}return{sets:e,scoreString:r,winningSide:n,matchUpStatus:a,info:i,updated:u}}function cRe({analysis:t,auto:e,lowSide:i,scoreString:r="",sets:n,value:a}){var o;let s,l,{tiebreakSet:{tiebreakTo:u,NoAD:c}}=t.setFormat,[d]=ap.split("");if(t.isMatchTiebreakEntry||(r+=d),n[t.setNumber-1]){let{lastOpenBracketIndex:p}=Uf({brackets:ap,scoreString:r}),m=(r.slice((p??0)+1)+(e?"":a)).split($l);if((((o=m[i-1])==null?void 0:o.length)||0)>=2)l="tiebreak digit limit";else if(e){i===1&&(m[0]=(m[0]||"")+a),i===2&&(m[1]=(m[1]||"")+a);let h=[m[0]||0,m[1]||0].map(v=>Ze(v)),f=i===1?1:0;h[f]=h[1-f]+(c?1:2),h[f]<u&&(h[f]=u);let g=n[n.length-1];g.side1TiebreakScore=h[0],g.side2TiebreakScore=h[1],r=r.slice(0,(p??0)+1),r+=h.join($l),s=!0}else{let h=[m[0]||0,m[1]||0].map(g=>Ze(g)),f=n[n.length-1];f.side1TiebreakScore=h[0],f.side2TiebreakScore=h[1],r+=a,s=!0}}else{let p=GZ({lowValue:Ze(a||0),tiebreakTo:u,NoAD:c}),m=[Ze(a),p];i===2&&m.reverse();let h={side1TiebreakScore:m[0],side2TiebreakScore:m[1],setNumber:(n==null?void 0:n.length)+1||1};n.push(h),r+=m.join($l),s=!0}return{info:l,scoreString:r,sets:n,updated:s}}function dRe({analysis:t,lowSide:e,scoreString:i,value:r}){let{setTo:n,tiebreakAt:a,NoAD:o}=(t==null?void 0:t.setFormat)||{},s=r===parseInt(a||n);if(a&&a<n&&r>a)return{scoreString:i};if(o&&r===n||r>n)return{scoreString:i};let l=h(),u=[r,l];e===2&&u.reverse();let c=Bm.split("")[0],d=u.join(mm)+(s?c:pm);i=(i||"")+d;let p={side1Score:u[0],side2Score:u[1]},m=R_({analysis:t,set:p});return p.winningSide=m||void 0,{scoreString:i,set:p};function h(){return s?r+1:r+1===n?r+(o?1:2):n}}function pRe({matchUpFormat:t,scoreString:e,winningSide:i,value:r,sets:n}){var a,o,s;let l=(((a=n==null?void 0:n.filter(_=>_==null?void 0:_.winningSide))==null?void 0:a.length)||0)+(i?0:1),u=Ln(t),c=l===(u==null?void 0:u.bestOf),d=c&&(u==null?void 0:u.finalSetFormat)||(u==null?void 0:u.setFormat)||{},p=d==null?void 0:d.timed,m=c&&n[(u==null?void 0:u.bestOf)-1],h=m==null?void 0:m.winningSide,{isTiebreakEntry:f}=Uf({brackets:Bm,scoreString:e}),{isTiebreakEntry:g}=Uf({brackets:ap,scoreString:e}),v=f||g,y=!!d.tiebreakSet,I=(o=e==null?void 0:e[e.length-1])==null?void 0:o.trim(),b=e&&!isNaN(I),S=!v&&I===mm,w=f&&KE.includes(I),U=g&&KE.includes(I),T=g&&I===$l,D=e==null?void 0:e.split(""),[P]=ap.split(""),E=D&&Math.max(...Ys(P,D)),R=D&&Math.max(...Ys($l,D)),N=D&&R>E,A=(s=n[n.length-1])==null?void 0:s.winningSide,M=(n==null?void 0:n.length)&&!A,C=DZ.find(_=>(e==null?void 0:e.indexOf(_))>=0),O=!isNaN(r),k=r===IR,x=b0.includes(r),F=e==null?void 0:e.split("").find(_=>KE.includes(_)),$=x&&g&&!U&&(T||!aRe({scoreString:e}));return{isTiebreakSetValue:y&&O,matchUpScoringFormat:u,setNumber:l,setFormat:d,matchTiebreakHasJoiner:N,isGameScoreEntry:M,isSpace:k,isCloser:x,isTiebreakCloser:x&&F&&v&&b,isDecidingSet:c,isTiebreakSet:y,isTimedSet:p,isNumericEnding:b,isNumericValue:O,hasOpener:F,hasOutcome:C,finalSet:m,finalSetIsComplete:h,lastSetIsComplete:A,isInvalidSetTiebreakValue:k&&v&&w,isInvalidMatchTiebreakValue:$,isTiebreakEntry:v,isSetTiebreakEntry:f,isMatchTiebreakEntry:g,isIncompleteSetScore:S,isIncompleteSetTiebreak:w,isIncompleteMatchTiebreak:U,isPartialMatchTiebreakValue:T}}function zZ(t){let{lowSide:e=1,value:i}=t,{scoreString:r,sets:n,winningSide:a,matchUpStatus:o}=t,{matchUpFormat:s,shiftFirst:l,auto:u=!0}=t,c,d,p=l&&e===2||!l&&e===1;if(!VZ.includes(i))return{updated:!1,info:"invalid key"};l&&(e=3-e);let{matchUpWinningSide:m}=H2({sets:n,winningSide:a,matchUpStatus:o,matchUpFormat:s});a=m;let h=pRe({value:i,winningSide:a,scoreString:r,sets:n,matchUpFormat:s});if(_Z.includes(i)&&(i=mm),h.hasOpener&&h.isTiebreakEntry&&!h.isTiebreakSet&&p&&Ze(i)===0&&(h.isTiebreakCloser=!0),b0.includes(i)&&h.hasOpener&&(i=""),b0.includes(i)&&(i=IR),h.lastSetIsComplete){let f=(r==null?void 0:r.length)&&r[r.length-1];r&&f!==" "&&(r+=" ")}if(h.isTimedSet)({info:d,sets:n,scoreString:r,updated:c,matchUpStatus:o,winningSide:a}=uRe({analysis:h,lowSide:e,scoreString:r,sets:n,matchUpStatus:o,winningSide:a,value:i}));else if(vR.includes(i))h.finalSetIsComplete||a?d="final set is already complete":!h.isTiebreakEntry&&!h.isIncompleteSetScore?{sets:n,scoreString:r,matchUpStatus:o,winningSide:a,updated:c}=HZ({lowSide:e,sets:n,scoreString:r,matchUpStatus:o,winningSide:a,value:i}):h.isTiebreakEntry||h.isIncompleteSetScore?d="incomplete set scoreString or tiebreak entry":console.log("handle case",{value:i});else if(i===y0)c=!0,{scoreString:r,sets:n}=HM({analysis:h,scoreString:r,sets:n,lowSide:e}),r||(n=[]),o=void 0,a=void 0;else if(h.hasOutcome)d="has outcome";else if(i===mm&&!h.isMatchTiebreakEntry)(!h.isSetTiebreakEntry||h.isSetTiebreakEntry&&!h.isNumericEnding)&&(c=!0,{scoreString:r,sets:n}=HM({analysis:h,scoreString:r,sets:n,lowSide:e}),o=void 0);else if(i===$l&&h.isMatchTiebreakEntry&&!h.isSetTiebreakEntry)h.matchTiebreakHasJoiner?d="existing joiner":h.isNumericEnding&&(c=!0,r+=$l);else if([mm,$l].includes(i))d="invalid location for joiner";else{if(a)return{updated:!1,info:"matchUp is complete"};if(h.isIncompleteSetScore)h.isNumericValue&&({sets:n,scoreString:r,updated:c}=sRe({analysis:h,scoreString:r,sets:n,value:i}));else if(h.isInvalidMatchTiebreakValue)d="invalid matchUp tiebreak character";else if(h.isInvalidSetTiebreakValue)d="invalid set tiebreak character";else if(h.isTiebreakCloser){let f=h.isSetTiebreakEntry?Bm:ap,g=f.split("").reverse()[0],v=f.split("")[0],y=n[n.length-1],{tiebreakFormat:I}=h.setFormat,{tiebreakTo:b,NoAD:S}=I||{},w=bR({set:y});if(!h.isTiebreakSet){let T=parseInt(r.split(v).reverse()[0]),D=GZ({lowValue:T,tiebreakTo:b,NoAD:S});w===1?(y.side1TiebreakScore=D,y.side2TiebreakScore=T):(y.side1TiebreakScore=T,y.side2TiebreakScore=D)}r=(r||"")+g,h.isDecidingSet||(r+=pm);let U=R_({analysis:h,set:y});y.winningSide=U||void 0,c=!0}else if(h.isTiebreakSetValue)({info:d,scoreString:r,sets:n,updated:c}=cRe({analysis:h,auto:u,lowSide:e,scoreString:r,sets:n,value:i}));else if(h.isSetTiebreakEntry){let[f]=Bm.split(""),g=Math.max(...Ys(f,r.split(""))),v=r.slice(g+1),y=v&&Ze(v)===tRe,I=Ze(v?v+i:i),{tiebreakFormat:b}=h.setFormat,{tiebreakTo:S,NoAD:w}=b||{};!y&&v.length<2?w&&I>S-1?d="invalid low value for NoAD tiebreak":(c=!0,r=(r||"")+i):d=y?"tiebreak begins with zero":"tiebreak digit limit"}else if(h.isCloser)d=`invalid key: ${i}`;else if(h.isGameScoreEntry)d="game scoreString entry";else if(h.lastSetIsComplete||!n.length){c=!0;let{scoreString:f,set:g}=dRe({analysis:h,lowSide:e,scoreString:r,value:Ze(i)});g&&(g.setNumber=(n==null?void 0:n.length)+1||1),n=(n==null?void 0:n.concat(g).filter(Boolean))||[g],r=f||void 0}else console.log("error: unknown outcome")}if(c){n=n==null?void 0:n.filter(Boolean);let{matchUpWinningSide:f}=H2({sets:n,winningSide:a,matchUpStatus:o,matchUpFormat:s});return a=f,f&&(!o||[Qi,Ca].includes(o))?(o=XPe,n=n.filter(g=>{let{side1Score:v,side2Score:y,side1TiebreakScore:I,side2TiebreakScore:b}=g;return v||y||I||b})):r&&!a&&![EZ,RZ,MZ].includes(o)&&(o=void 0),{updated:c,scoreString:r,sets:n,winningSide:a,matchUpStatus:o,info:d}}return{updated:c,scoreString:r,sets:n,winningSide:a,matchUpStatus:o,info:d}}var wR="\\d+-\\d+",gy="\\d+-\\d+\\(\\d+\\)",E_="\\[\\d+-\\d+\\]",mRe="\\d+-\\d+\\(\\d+-\\d+\\)",hRe=new RegExp(`(${wR}),`,"g"),fRe=new RegExp(`(${gy}),`,"g"),gRe=[wR,gy,E_,mRe],vRe=["0","1","2","00","01","10","11","002","012","102","112","000","001","010","100","011","101","110","111","002","012","102","112","0002","0012","0102","1002","0112","1012","1102","1112","3","03","13","013","103"],IRe=vRe.map(t=>{let e=t.split("").map(i=>gRe[i]).join(" ");return new RegExp(`^${e}$`)});function z2(t){return!t||IRe.some(e=>e.test(t))}function yRe(t){let e="[];",i="()",r=e+i,n=[e[0],i[0]],a=Object.assign({},...r.split("").map(l=>({[l]:0}))),o="",s=t.split("").map(l=>{let u=r.includes(l)&&l,c=n.includes(u);if(c&&u)return a[u]+=1,o=u,l;if(!c&&u&&o&&u!==o){a[o]-=1;let d=e.includes(o)&&e||i.includes(o)&&i||"",p=d.split("").find(m=>m!==o);if(d.includes(u))a[o]||(o="");else return a[u]||(o=""),p}return l}).join("");return t!==s?s:t}function aS(t){return/^\(\d+\)$/.test(t)||/^\(\d+$/.test(t)}function bRe(t){return/^\(\d+-\d+\)$/.test(t)||/^\[\d+-\d+\]$/.test(t)}function fg(t){let e=(i=>i==null?void 0:i.split("-").join("").split("/").join(""))(t);if(/^\d+$/.test(e)&&e.length===2){let i=e.split("");return Math.abs(i.reduce((r,n)=>+r-+n))===1}return!1}function w0(t,e){let i=[t.slice(e,e+2),e?t.slice(0,1):t.slice(2)].map(n=>parseInt(n.join("")));e&&i.reverse();let r=i;if(Math.abs(r.reduce((n,a)=>+n-+a))>=2)return r.join("-")}function W2(t){return t.length===2?t.split("").join("-"):([", ",",","/"," "].forEach(e=>t=t.split(e).join("-")),t=t.replace(/-{2,}/,"-"),t)}function wRe(t){return t.startsWith("(")&&t.endsWith(")")}function URe({score:t,applied:e}){t=yRe(t);let i=/\)(\d+)/g;if(i.test(t))for(let w of t.match(i)){let U=w.replace(")",") ");t=t.replace(w,U)}t=t.replace(/\)\//g,") / "),t=t.replace(/\/\)/g,")");let r=/\(([\d- ]+)\)/g,n=/\(([\d- ]+)\)/,a=t.match(r);for(let w of a||[]){let[U]=w.match(n).slice(1),T=U.replace(/ /g,"");t=t.replace(w,`(${T})`)}let o=/\(\(\d-\d\)\)/g;if(o.test(t)){let w=t.match(o);w.length&&w.forEach(U=>{let T=U.match(/\((\(\d-\d\))\)/).slice(1)[0];t=t.replace(U,T)})}if(o=/\(\((\d)\)\)/g,o.test(t)){let w=t.match(o);w.length&&w.forEach(U=>{let T=U.match(/\((\(\d\))\)/).slice(1)[0];t=t.replace(U,T)})}/(^|\s)6-,/.test(t)&&(t=t.replace(/(^|\s)6-,/g,"6-0,"));let s=new RegExp(/[-,]{2,}/g);t=t.replace(s,"-"),["- "," -"].forEach(w=>{let U=new RegExp(`(\\d+)${w}(\\d+)`,"g"),T=t.match(U);T&&T.forEach(D=>t=t.replace(D,D.split(w).join("-")))}),/^[(-/,]+$/.test(t)&&(t=""),/\)[-/,]+$/.test(t)&&(t=t.slice(0,t.length-1)),/\d \/\d/.test(t)&&(t=t.replace(/ \//g,"/")),t.includes(" /")&&(t=t.replace(/ \//g," "));let l=/\(\d+, \)/g;l.test(t)&&t.match(l).forEach(w=>{let[U]=w.match(/\((\d+), \)/).slice(1);U.length===2?t=t.replace(w,`(${U})`):U.length===1&&U==="6"&&(t=t.replace(w,"(6-0)"))});let u=/\((\d+)\/\)/g;u.test(t)&&t.match(u).forEach(w=>{let[U]=w.match(/\((\d+)\/\)/).slice(1);U.length===2?t=t.replace(w,`(${U})`):U.length===1&&U==="6"?t=t.replace(w,"(6-0)"):t=t.replace(w,`(${U})`)});let c=/\d\/\d\/,/g;c.test(t)&&t.match(c).forEach(w=>{let[U]=w.match(/(\d\/\d)\/,/).slice(1);t=t.replace(w,`${U},`),e.push("slashComma")});let d=/\(\/(\d+)\)/g;d.test(t)&&t.match(d).forEach(w=>{let[U]=w.match(/\(\/(\d+)\)/).slice(1);U.length===2?t=t.replace(w,`(${U})`):U.length===1&&parseInt(U)<6?t=t.replace(w,`(6-${U})`):t=t.replace(w,`(${U})`)});let p,m,h,f,g,v=()=>{g=Pa(t.split("")),m=g["("]===(g[")"]||0)+1,p=(g["("]||0)+1===g[")"],h=g["["]===g["]"]+1,f=m&&!h};v();let y=/(\d+-\d+\(\d+)0,/;if(y.test(t)){let[w]=t.match(y).slice(1);t=t.replace(y,w+")")}if(g["("]===g[")"]&&g["("]>1){let w=t.split(")(").join(") (").split(" ");w.every(wRe)?t=w.map(U=>{let T=U.slice(1,U.length-1);return T.length>2?T:U}).join(" "):t=w.join(" ")}v();let I=/[A-Za-z]+/.test(t),b=/\d+/.test(t);if(!I&&!b)return{score:""};if(/^\[.+\]$/.test(t)&&"()/,- ".split("").some(w=>g[w])&&(t=t.slice(1,t.length-1)),/^\(.+\)$/.test(t)&&g["("]===1&&g[")"]===1&&"[]/,".split("").some(w=>g[w]>1)&&(t=t.slice(1,t.length-1)),t.startsWith("(")&&t.endsWith("))")&&(t=t.slice(1,t.length-1)),g["("]>(g[")"]||0)&&t[t.length-1]==="("&&(t=t.slice(0,t.length-1)+")",v()),g["("]===1&&!g[")"]&&t[0]==="("&&(t=t+")",v()),g["("]>(g[")"]||0)&&t.slice(0,2)==="(("&&(t=t.slice(1)),p){if(/^9\d/.test(t))t="("+t.slice(1);else if(t[0]!=="(")t="("+t;else{let w=[],U=0;for(let T of t.split("").reverse())T===")"&&(U?w.push("("):U+=1),T==="("&&(U-=1),w.push(T);w.reverse(),t=w.join("")}v()}if(g[")"]>(g["("]||0)&&t[0]===")"&&(t="("+t.slice(1),v()),f&&(t.endsWith(9)||/\d+0$/.test(t))&&(t=t.slice(0,t.length-1)+")",v()),f&&(!t.endsWith(")")||t.startsWith("(("))&&(t=t+")",v()),f){let w="",U=0;for(let T of t.split(""))T==="("&&(U?w+=")":U+=1),T===")"&&(U-=1),w+=T;t=w}v(),h&&!m&&(t=t+"]"),t.includes("([")&&t.includes("])")&&(t=t.split("([").join("[").split("])").join("]"),v()),/\(\d+0$/.test(t)&&(t=t.slice(0,t.length-1)+")"),v(),g[")"]===1&&!g["("]&&t.endsWith(")")&&(t=t.slice(0,t.length-1)),t.startsWith("(")&&t.endsWith(")")&&g["("]===1&&g[")"]===1&&(t=t.slice(1,t.length-1),v());let S=w=>{let U=w.indexOf("("),T=w.indexOf(")");return U>=0&&T>=0&&U<T};if(/^\([\d ]+.*[\d ]+\)$/.test(t)&&g["("]===g[")"]){let w=t.slice(1,t.length-1);S(w)&&(t=w,v())}return{score:t,applied:e}}function UR(t){if(!/^[\d-]+(\(\d\))*$/.test(t))return t;let e=Ys("-",t.split(""));if(!e.length)return t;let i=t.split("-"),r=!(i.length%2),n=!!(e.length%2);return r&&n&&e.length>i.length/2&&e.filter((a,o)=>o%2).forEach(a=>{t=t.substring(0,a)+" "+t.substring(a+1)}),t}function SRe({score:t,applied:e}){return t.includes("( ")&&(e.push("removeParenSpacingAfterOpen"),t=t.split("( ").map(i=>i.trim()).join("(")),t.includes(" )")&&(e.push("removeParenSpacingBeforeClose"),t=t.split(" )").map(i=>i.trim()).join(")")),[hRe,fRe].forEach(i=>{let r=t.match(i);r!=null&&r.length&&(r.forEach(n=>{t=t.replace(n,n.slice(0,n.length-1)+" ")}),e.push("setsEndComma"))}),t=t.split(" ").filter(Boolean).map(UR).join(" "),{score:t,applied:e}}function TRe({score:t}){if(typeof t!="string")return{score:t};let e=p=>p==null?void 0:p.split("-").join("").split("/").join(""),i=p=>p.split("[").join("(").split("]").join(")");t=t.split(", ").join(" ");let r=t.split(" ");t=r.map(p=>{let m=/^-(\d+)$/;if(m.test(p)){let[h]=p.match(m).slice(1);if(h.length===2)return h.split("").join("-")}return p}).join(" "),r=t.split(" ");let n=r.filter(aS),a=0,o="";for(let p of n){let m=Ys(p,r).filter(v=>!a||v>a)[0],h=r.slice(a,m-1),f=r[m-1],g=e(f);if(/^\d+$/.test(g)&&g.length===2){let v=g.split(""),y=Math.abs(v.reduce((I,b)=>+I-+b));if(y===1){let I=[h.join(" "),[f,p].join("")].join(" ");o+=I,a=m+1}else if(y===0){let I=Math.max(...v);if([4,5,6,7,8,9].includes(I)){let b=[6,4].includes(I)?I+1:I-1,S=[I,b].sort().reverse().join("-"),w=[h.join(" "),[S,p].join("")].join(" ");o+=w,a=m+1}}}}if(n.length&&o.length){let p=r.slice(a).join(" ");return o=[o,p].join(" "),{score:o.trim()}}if(r.length===2&&["(","["].some(p=>r[1].includes(p))){let p=e(r[0]).split("");if(Math.abs(p.reduce((m,h)=>+m-+h,0))===1)return r[1]=i(r[1]),{score:r.join("")}}let s=r.map(p=>bRe(p)&&"bracket"||fg(p)&&"set");if(s.includes("set")&&s.includes("bracket")){let p,m="";return r.forEach((h,f)=>{s[f]==="bracket"&&p==="set"?(h=i(h),m+=h):m+=` ${h}`,p=s[f]}),{score:m.trim()}}r=t.split(" ");let l,u=r.map(p=>{let m=new RegExp(/^(\d+)-(\d+)$/);if(m.test(p)){let[h,f]=p.match(m).slice(1),g=Math.abs([h,f].reduce((y,I)=>+y-+I)),v=Math.max(h,f);if(g===1)return l="tiebreakSet",l;if(g>=2&&v>=7&&l==="tiebreakSet")return l="tiebreak",l}}),c=Ys("tiebreak",u);if(c.length){let p="";r.forEach((m,h)=>{c.includes(h)?p+=`(${m}) `:c.includes(h+1)?p+=`${m}`:p+=`${m} `}),t=p.trim()}let d=/(\d+-\d+)\((\d+)-(\d+)\)$/;if(d.test(t)){let[p,m,h]=t.match(d).slice(1),f=Math.max(m,h)>=10;!fg(p)&&f&&(t=t.replace(d,`${p} [${m}-${h}]`))}return u=[],t=t.split(" ").map(p=>{let m=/^\((.*)\)$/,h=m.test(p),f=new RegExp(E_).test(p)&&"super"||new RegExp(gy).test(p)&&"tiebreak"||new RegExp(wR).test(p)&&"standard"||"unknown";return u.push(f),f==="standard"&&h?p.match(m)[1]:p}).join(" "),{score:t}}function DRe({score:t,applied:e}){for(let T of[".",","," ","/"]){let D=new RegExp(`^(\\d+)\\${T}(\\d+)$`);if(D.test(t)){let P=t.match(D).slice(1).map(R=>parseInt(R)),E=Math.abs(P[0]-P[1]);E<=10&&E>=2&&(t=t.split(T).join("-"),e.push("variedJoinerPattern"))}}t.includes(";")&&(t=t.split(";").join(" "),e.push("semicolon set separation"));let i=/(^|\s)(\d)\/(\d)(\d)\/(\d)(\(|$)/;if(i.test(t)){let[T,D,P,E,R,N]=t.match(i).slice(1);t=t.replace(i,`${T}${D}-${P} ${E}-${R}${N}`),e.push("smashSlashPattern")}/.*\s6[/-]+$/.test(t)&&(t+="0",e.push("incompleteFinalSetPattern"));let r=/\(6,\)/g;r.test(t)&&(t=t.replace(r,"(6, 0)"),e.push("missingZeroPattern1"));let n=/^\d{3,}\(/,a=/\(\d+\)\d+/;[n,a].forEach(()=>{t=t.split(" ").map(T=>(n.test(T)&&(T=T.replace("("," (")),a.test(T)&&(T=T.replace(")",") ")),T)).join(" "),e.push("spaceConsiderationPatterns")});let o=UR(t);o!==t&&(t=o,e.push("deDashMash"));let s=/^(\d)[-/,]+(\d{2})[-/,]+(\d)$/;if(s.test(t)){let[T,D,P]=t.match(s).slice(1),[E,R]=D.split("");t=`${T}-${E} ${R}-${P}`,e.push("smashSetPattern")}let l=/^(\d+)[ -](\d+)$/,u=/^([\d -]+)\/([\d -]+)$/;if(u.test(t)){let[T,D]=t.match(u).slice(1),P=T.trim(),E=D.trim();if(l.test(P)&&l.test(E)){let R=P.match(l).slice(1,3).join("-"),N=E.match(l).slice(1,3).join("-");t=`${R} ${N}`,e.push("slashSeparationPattern")}}let c=/^([\d -]+),([\d -]+)$/;if(c.test(t)){let[T,D]=t.match(c).slice(1),P=T.trim(),E=D.trim();if(l.test(P)&&l.test(E)){let R=P.match(l).slice(1,3).join("-"),N=E.match(l).slice(1,3).join("-");t=`${R} ${N}`,e.push("commaSeparationPattern")}}let d=/^\d \d,/;if(d.test(t)){let T=t.match(d)[0],D=T.slice(0,T.length-1).split(" ").join("-");t=t.replace(T,D),e.push("singleSetCommaSeparationPattern")}let p=0,m=/(\d+)-(\d{2})-(\d+)/;for(;m.test(t)&&p<3;){let[T,D,P]=t.match(m).slice(1),E=D.split(""),R=`${T}-${E[0]} ${E[1]}-${P}`;t=t.replace(m,R),e.push("noSetSeparationPattern"),p+=1}let h=/(^|\s)7-6\s(\d+)\s/g,f=t.match(h);if(f!=null&&f.length){let T=/(^|\s)7-6\s(\d+)\s/;f.forEach(D=>{let P=D.match(T).slice(2)[0];t=t.replace(D,`7-6(${P}) `),e.push("floatingTiebreakPattern1")})}let g=t.match(/\d \d /);g==null||g.forEach(T=>{let D=T.slice(0,T.length-1).split(" ").join("-");t=t.replace(T,D),e.push("spaceSeparatedSetPattern1")}),g=t.match(/ \d \d$/),g==null||g.forEach(T=>{let D=" "+T.slice(1).split(" ").join("-");t=t.replace(T,D),e.push("spaceSeparatedSetPattern2")});let v=/^\d, *\d\/\d, *\d/;if(v.test(t)){let T=t.match(v)[0],D=T.split("/").map(P=>`(${P})`).join(" ")+" ";t=t.replace(T,D),e.push("slashCommaSetPattern")}let y=/\(6-\)/g;y.test(t)&&(t=t.replace(y,"(6-0)"),e.push("missingZeroPattern2"));let I=new RegExp("(?<!-)(\\d+)\\/(\\d+)(?!-)","g");if(I.test(t)){let T=t.match(I),D=new RegExp("(?<!-)(\\d+)\\/(\\d+)(?!-)"),P=t;T.forEach(E=>{let[R,N]=E.match(D).slice(1),A=`${R}-${N}`;P=P.replace(E,A)}),t=P,e.push("slashSetPattern")}let b=/(.*)\s(1\d)\s(\d+)$/;if(b.test(t)){let[T,D,P]=t.match(b).slice(1);T.replace(/\D/g,"").length>=4&&(t=T+` ${D}${P}`,e.push("spaceSeparatedSuperPattern"))}let S=/(^|\s)(\d+-\d+)\s(\d+)(\s|$)/g;for(let T of t.match(S)||[]){let[D,P,E,R]=T.match(/(^|\s)(\d+-\d+)\s(\d+)(\s|$)/).slice(1),[N,A]=P.split("-").map(M=>parseInt(M));Math.abs(N-A)===1&&(t=t.replace(T,`${D}${P}(${E})${R}`),e.push("spaceSeparatedSetPattern"))}let w=/\d-\d \(\d{1,2}\)(\s|$|,)/g;for(let T of t.match(w)||[]){let D=/(\d-\d) \((\d{1,2})\)(\s|$|,)/,[P,E,R]=T.match(D).slice(1),[N,A]=P.split("-").map(M=>parseInt(M));Math.abs(N-A)===1&&(t=t.replace(T,`${P}(${E})${R}`),e.push("floatingTiebreakPattern2"))}let U=/(^|\s)(\d \d)\(/g;for(let T of t.match(U)||[]){let D=/(^|\s)(\d \d)\(/,[P,E]=T.match(D).slice(1);t=t.replace(T,`${P}${E.split(" ").join("-")}(`),e.push("spacedTiebreakPattern")}return{score:t,applied:e}}function PRe({score:t,matchUpStatus:e}){var i;let r=t==null?void 0:t.split(" ");t=r.map(l=>{if(l.endsWith("]")){let u=l.split("[");if(fg(u[0]))return u[0]+`(${u[1].slice(0,u[1].length-1)})`}return l}).join(" ");let n=new RegExp(/(\([\d ]+\))/g);if(n.test(t))for(let l of t.match(n)){let u=(i=l.replace(" ","-").match(/\((.*)\)/))==null?void 0:i[1];if(_i(u)&&(u==null?void 0:u[0])>2){if([2,4].includes(u.length))u=u.split("").join("-");else if(u.length===3){let c=u.indexOf("1");u=w0(u.split(""),c)}}t=t.replace(l,`(${u})`)}r=t==null?void 0:t.split(" ");let a=new RegExp(/^(\d[-/]+\d)\((\d+)[-/]+(\d+)\)$/),o=r.length-1;t=r.map((l,u)=>{let c=[void 0,"","COMPLETED"].includes(e)||u!==o;if(a.test(l)&&c){let[d,p,m]=Array.from(l.match(a)).slice(1),h=Math.min(p,m);return`${d}(${h})`}return l}).join(" "),r=t==null?void 0:t.split(" "),a=new RegExp(/^(\d{2})\((\d+)\)$/),t=r.map(l=>{if(a.test(l)){let[u,c]=Array.from(l.match(a)).slice(1),d=u.split("");return`${d[0]}-${d[1]}(${c})`}return l}).join(" "),r=t==null?void 0:t.split(" "),a=new RegExp(/^\((\d[-/]+\d)\)(\d+)$/),t=r.map(l=>{if(a.test(l)){let[u,c]=Array.from(l.match(a)).slice(1);return fg(u)?`${u}(${c})`:u}return l}).join(" "),r=t==null?void 0:t.split(" "),a=new RegExp(/^1-0\((\d+)\)$/),t=r.map(l=>{if(a.test(l)){let[u]=l.match(a).slice(1);return`[${u<9?10:parseInt(u)+2}-${u}]`}return l}).join(" ");let s=/\((\d)+0 /;if(s.test(t)){let l=t.match(s)[1];t=t.replace(s,`(${l}) `)}return{score:t}}function RRe({score:t,attributes:e,identifier:i}){var r,n,a;if(typeof t!="string")return{score:t,identifier:i};let o=new RegExp(/\([\d,/ ]+\)/g),s=t.match(o);for(let m of s||[]){let h=(n=(r=m.match(/^\((.*)\)$/))==null?void 0:r.slice(1))==null?void 0:n[0],f=t.split(m)[0].split(")").reverse()[0].replace(/\D/g,"");if((h==null?void 0:h.length)===2&&(f==null?void 0:f.length)>=2){let y=f.slice(f.length-2).split("").map(I=>parseInt(I));if(Math.abs(y[0]-y[1])===1)continue}let g=W2(h),v=UR(g);t=t.replace(m,`(${v})`).trim()}let l=new RegExp(/\[[\d,/ ]+\]/g);(a=t.match(l))==null||a.forEach(m=>{let h=W2(m.match(/^\[(.*)\]$/)[1]);t=t.replace(m,`(${h}) `).trim()});let u=[")","]"],c=[")(","), (",") (",")[",") [","](","] ("];if(t.startsWith("(")&&u.some(m=>t.endsWith(m))&&c.some(m=>t.includes(m))){let m="",h=t.split(/[)\]]/).filter(Boolean).map(I=>(I.startsWith(",")&&(I=I.slice(1)),I.trim())),f=h.every(I=>I.includes(",")||aS(I)),g=h.every(I=>I.includes("/")||aS(I)),v=h.every(I=>I.includes("-")||aS(I)),y=f&&","||v&&"-"||g&&"/";if(y){let I;h.forEach(b=>{if(b.startsWith("("))if(I==="set"&&(m+=" "),b.includes(y))m+=b.slice(1).split(y).map(S=>S.trim()).join("-"),I="set";else{let S=b.slice(1);m+=`(${S}) `,I="tiebreak"}else if(b.startsWith("[")){let S=b.slice(1).split(y).map(U=>parseInt(U.trim())),w=Math.min(...S);I==="set"?m+=`(${w}) `:m+=`[${S.join("-")}] `,I="tiebreak"}}),t=m.trim()}}let d=Pa(t.split(""));d["("]===1&&d[")"]===1&&t.startsWith("(")&&t.endsWith(")")&&(t=t.slice(1,t.length-1),d["-"]===1&&fg(t)&&_i(e==null?void 0:e.removed)&&(t=t+`(${e.removed})`,e.removed=void 0));let p=/\(\)/g;return p.test(t)&&(t=t.replace(p,"").trim()),{score:t}}function WZ({score:t}){let e=t.split(""),i=[],r,n=()=>r=[void 0,void 0,void 0],a=()=>{let s=`${r[0]}-${r[1]}`;return r[2]&&(s+=` (${r[2]})`),n(),r.push(r),s};n();let o=()=>r[0]!==void 0&&r[1]!==void 0&&Math.abs(parseInt(r[0])-parseInt(r[1]));for(;e.length;){let s=e.shift(),l=_i(s)&&parseInt(s),u=r[0]!==void 0&&r[1]!==void 0;if(_i(l)){if(r[0]===void 0){r[0]=l;continue}if(r[1]===void 0&&(r[1]=l,o())){i.push(a()),r=[void 0,void 0];continue}if(u&&e.length===1&&_i(e[0])){let c=e.pop();r[0]=r[0].toString()+r[1].toString(),r[1]=c,i.push(a()),r=[void 0,void 0]}u&&o()}}return{sets:i}}function zM(t){let e=t.indexOf("1"),i=t.split(""),r=i.every(n=>!isNaN(n));if(r&&t.length===3&&e===0){let n=w0(i,e);if(n)return n}if(r&&t.length===7&&e>3){let n=i.slice(4),a=w0(n,e-4);if(a)return`${i[0]}-${i[1]} ${i[2]}-${i[3]} ${a}`}}function qZ(t){let{score:e}=t,{applied:i,matchUpStatus:r}=t,n=e==null?void 0:e.toString().split(""),a=n==null?void 0:n.every(s=>_i(s)),o=s=>Math.abs(s[0]-s[1]);if(typeof e=="number"||a){e=e.toString().toLowerCase(),a&&(e=n.join(""));let s=a?n.map(l=>parseInt(l)):e.split("").map(l=>parseInt(l));if(WZ({score:e}),s.length,e.length===3&&o(s.slice(0,2))===1){let[l,u,c]=s;e=`${l}-${u}(${c})`,i.push("numericTiebreakPattern1")}else if(e.length===3&&s[0]===1){let[l,u,c]=s;e=`[${l}${u}-${c}]`,i.push("numericTiebreakPattern2")}else if(e.length===4&&o(s.slice(0,2))===1&&"987654".split("").includes(s[0].toString())){let[l,u,c,d]=s,p=Math.min(c,d);e=`${l}-${u}(${p})`,i.push("numericTiebreakPattern3")}else if(e.length===4&&s[0]===1&&s[2]===1){let[l,u,c,d]=s;e=`[${l}${u}-${c}${d}]`,i.push("bigSuper")}else if(e.length===4){let[l,u,c,d]=s;e=`${l}${u} ${c}${d}`,i.push("split4")}else if(e.length===5&&o(s.slice(0,2))===1){let[l,u,c,d,p]=s;e=`${l}-${u}(${c}) ${d}-${p}`,i.push("numericTiebreakPattern4")}else if(e.length===5&&o(s.slice(3))===1){let[l,u,c,d,p]=s;e=`${l}-${u} ${c}-${d}(${p})`,i.push("numericTiebreakPattern5")}else if(s.length===7)if(o(s.slice(0,2))>1&&o(s.slice(2,4))>1&&s[4]===1){let[l,u,c,d,p,m,h]=s;e=`${l}-${u} ${c}-${d} [${p}${m}-${h}]`,i.push("numericTiebreakPattern6")}else if(o(s.slice(0,2))===1&&o(s.slice(3,5))>1&&o(s.slice(5,7))>1){let[l,u,c,d,p,m,h]=s;e=`${l}-${u}(${c}) ${d}-${p} ${m}-${h}`,i.push("numericTiebreakPattern7")}else if(o(s.slice(0,2))>1&&o(s.slice(2,4))===1&&o(s.slice(5,7))>1){let[l,u,c,d,p,m,h]=s;e=`${l}-${u} ${c}-${d}(${p}) ${m}-${h}`,i.push("numericTiebreakPattern8")}else if(o(s.slice(0,2))>1&&o(s.slice(2,4))>1&&o(s.slice(4,6))===1){let[l,u,c,d,p,m,h]=s;e=`${l}-${u} ${c}-${d} ${p}-${m}(${h})`,i.push("numericTiebreakPattern9")}else e=e.slice(0,2)+" "+e.slice(2,4)+" "+e.slice(4),i.push("numericMatchTiebreakPattern");else if(e.length%2){let l=zM(e);l&&e!==l&&i.push("parsedSuperPattern"),e=l??e}else{let l=Cr(e.split(""),2).map(g=>g.join("")),u=l.map(g=>{let[v,y]=g.split("").map(S=>parseInt(S)),I=Math.abs(v-y),b=v>y?1:2;return I>1&&b||b*-1}),c=u.reduce((g,v)=>g>0&&v>0,1),d=Pa(u),p=u.map(g=>Math.abs(g)),m=Pa(p),h=u[0]<0,f=!h&&u[1]<0;if(u[0]>0&&u[1]>0&&u[0]!==u[1])e=[l.slice(0,2).join(" "),l.slice(2).join("-")].join(" "),i.push("numeric3rdSetTiebreakPattern");else if(c)e=l.join(" "),i.push("chunkSplit");else if(s.length===6){if(d[1]===2||d[2]===2)if(!Object.values(m).includes(3))e=l.join(" "),i.push("chunkSplit");else{let[g,v,y,I,b,S]=s,w=u.reduce((U,T,D)=>T<0?D:U,void 0);if(w===0){let U=Math.min(y,I);e=`${g}-${v}(${U}) ${b}-${S}`,i.push("chunkSplitTiebreak1")}else if(w===1){let U=Math.min(b,S);e=`${g}-${v} ${y}-${I}(${U})`,i.push("chunkSplitTiebreak2")}else e=`${g}-${v} ${y}-${I}`,i.push("chunkSplitTrimExtraneous")}}else if(s.length===8){let[g,v,y,I,b,S,w,U]=s;h||f?s[5]===1&&(h?e=`${g}-${v}(${y}) ${I}-${b} [${S}${w}-${U}]`:e=`${g}-${v} ${y}-${I}(${b}) [${S}${w}-${U}]`):(u[0],u[1])}}}return{score:e,applied:i,matchUpStatus:r}}function YZ(t){let e=[0,0],i=[],r=t.split(" "),n=/(\d+)-(\d+)/;r.forEach(l=>{if(n.test(l)){let u=l.match(n).slice(1).map(d=>parseInt(d)),c=u[0]>u[1]&&1||u[1]>u[0]&&2;c&&(e[c-1]+=1,i.push(c))}});let a=e[0]>e[1]&&1||e[1]>e[0]&&2,o=e[0]>0&&e[0]===e[1],s=e.reduce((l,u)=>l+u,0);return{setsWon:e,setsTied:o,setWinners:i,totalSets:s,winningSide:a}}function ERe({score:t,matchUpStatus:e,attributes:i}){let r=[],n,a=t.split(" "),o=a.length;t=a.map((c,d)=>{if(new RegExp(gy).test(c)){let m=c.slice(3),h=c.slice(0,3),f=h.split("-");if(!fg(h)&&!e){let g=Math.max(...f),v=h.indexOf(g),y=[g,g-1];return v&&y.reverse(),y.join("-")+m}}else if(c.length===2&&_i(c))return c.split("").join("-");c=UR(c);let p=new RegExp(`^${E_}$`).test(c)&&"super"||new RegExp(`^${gy}$`).test(c)&&"tiebreak"||new RegExp(`^${wR}$`).test(c)&&"standard"||"unknown";if(r.push(p),o>1&&p==="standard"&&d<2){let[m,h]=c.split("-"),f=Math.abs(parseInt(m)-parseInt(h)),g=Math.max(m,h),v=Math.min(m,h),y=[parseInt(m),parseInt(h)].indexOf(v);if(g>9&&f>2){let I=g.toString().split(""),b=I.find(S=>parseInt(S)>v||d&&parseInt(S)<=n)??I[0];b&&(c=y?[b,v].join("-"):[v,b].join("-"))}g>(n||0)&&(n=g)}if(p==="standard"){let[m,h]=c.split("-");if(!Math.abs(parseInt(m)-parseInt(h))&&e!=="RETIRED")return""}return c}).filter(Boolean).join(" ");let{setsWon:s,setWinners:l,totalSets:u}=YZ(t);if(u===1&&(i==null?void 0:i.removed)==="6"&&(t+=" 6-0"),t.split(" ").length>2&&Math.max(...s)>=2&&l[0]===l[1]&&(t=t.split(" ").slice(0,2).join(" ")),Math.max(...s)>2){let c=[0,0];t=t.split(" ").map((d,p)=>(c[l[p]]+=1,Math.max(...c)>2?void 0:d)).filter(Boolean).join(" ")}return{score:t,profile:r}}function CRe({score:t}){let{setsTied:e,winningSide:i}=YZ(t),r=/\s\((\d+)\)$/;if(!i&&e&&r.test(t)){let s=t.match(r).slice(1)[0],l=s<=8?10:s+2;t=t.replace(r,` [${l}-${s}]`)}let n=t.split(" "),a=n[n.length-1];if(!a.includes("-")||a.indexOf("(")>0)return{score:t};let o=a.split("(").join("").split(")").join("").split("-");if(!o.every(s=>_i(s)))return{score:t};if(o[0]==="76"){let s=o[1].length===2?Math.min(...o[1].split("").map(l=>parseInt(l))):o[1];t=[...n.slice(0,n.length-1),`7-6(${s})`].join(" ")}else{o=o.map(u=>parseInt(u));let s=Math.max(...o),l=Math.abs(o[0]-o[1]);if(s>=10){if(l>2&&o.every(u=>+u>=10)){let u=o.map(c=>c===s?c-10:10).sort();l=Math.abs(u[0]-u[1]),l>2&&(o=u)}t=[...n.slice(0,n.length-1),`[${o.join("-")}]`].join(" ")}else n.length===3&&s>=7&&l>2&&(t=[...n.slice(0,n.length-1),`[${o.join("-")}]`].join(" "))}return{score:t}}function MRe({score:t}){return t=(t==null?void 0:t.toString().toLowerCase())||"",{score:t}}function NRe({score:t,applied:e}){return typeof t!="string"?{score:t}:(t.toLowerCase().includes("o")&&(t=t.toLowerCase().split(" ").map(i=>i.split("o").join("0")).join(" "),e.push("replaceOh")),{score:t,applied:e})}function ARe({score:t,applied:e}){return typeof t!="string"?{score:t}:(t=t.toLowerCase().split(" ").map(i=>{if(/^\d+$/.test(i)&&i.length>2){let r=i.indexOf("1");if(i.length%2){if(i.length===3&&r===0){let n=w0(i.split(""),r);return e.push("getSuper"),n}}else{let{score:n,applied:a}=qZ({score:i,applied:[]});n!==i&&(i=n,e.push(...a))}}return i}).join(" "),{score:t,applied:e})}function ORe({score:t,applied:e}){return typeof t!="string"?{score:t}:[3,4].includes(t.length)&&zM(t)?{score:zM(t)}:(t=t.toLowerCase().split(" ").map(i=>{if(/^\d+$/.test(i)&&i.length===1){e.push("removeErroneous1");return}return i}).filter(Boolean).join(" "),{score:t,applied:e})}function kRe({score:t,applied:e}){return["walkover","wo","w/o","w-o"].includes(t==null?void 0:t.toString().toLowerCase())?(e.push("handleWalkover"),{matchUpStatus:"walkover",score:"",applied:e}):{score:t}}function xRe({score:t,profile:e,applied:i}){var r;t=t==null?void 0:t.toString().toLowerCase();let n=/^(.*\d+.*)(ret|con)+[A-Za-z ]*$/;if(n.test(t)){let[s]=t.match(n).slice(1);return i.push("handleRetired"),{score:s.trim(),matchUpStatus:"retired",applied:i}}let a=(r=e==null?void 0:e.matchUpStatuses)==null?void 0:r.retired,o=["rtd",...Array.isArray(a)?a:[a].filter(Boolean)].find(s=>t==null?void 0:t.endsWith(s));return o?(i.push("handleRetired"),{matchUpStatus:"retired",score:t==null?void 0:t.replace(o,"").trim(),applied:i}):{score:t}}function FRe({score:t,attributes:e}){(t.endsWith(" am")||t.endsWith(" pm"))&&(t=""),t=t.replace(/[A-Za-z]+/g,"").trim(),[".",","].some(n=>t.endsWith(n))&&(t=t.slice(0,t.length-1));let i="()/-".split("").some(n=>t.includes(n));/ \d$/.test(t)&&i&&(e={removed:t.slice(t.length-2).trim()},t=t.slice(0,t.length-2));let r=/(.*)[A-Za-z]+$/;return r.test(t)&&(t=t.match(r).slice(1)[0].trim()),{score:t,attributes:e}}function LRe({score:t}){return new RegExp(/-\d+\/\d+-/).test(t)&&(t=t.split("/").join(" ")),{score:t}}function _Re({score:t}){let e=new RegExp(/^\d+\/\d+/),i=t.split(" ");i.some(n=>e.test(n))&&(t=i.map(n=>e.test(n)?n.replace("/","-"):n).join(" "));let r=/^(\d+), *(\d+)$/;if(r.test(t)){let[n,a]=t.match(r).slice(1);t=[n,a].join("-")}return{score:t}}function $Re({score:t}){let e=new RegExp(/\(\d+\/\d+\)/g),i=t.match(e);for(let r of i||[]){let n=r.replace("/","-");t=t.replace(r,n)}return{score:t}}function BRe({score:t}){if(t.includes(",")){let e=t.split(",").map(r=>r.trim()),i=r=>/\d \d/.test(r);e.every(i)&&(t=e.map(r=>{let n=/\d+ \d+/g;for(let a of r.match(n)){let[o,s]=a.match(/(\d+) (\d+)/).slice(1);r=r.replace(a,`${o}-${s}`)}return r}).join(" "))}if(t.includes(" ")){let e=t.replace(/[ ,]/g,"");e.split("").every(i=>_i(i))&&e.length===4&&(t=e)}return{score:t}}function VRe({score:t}){let e=new RegExp(/^\[\d+\](.*)$/);e.test(t)&&(t=t.match(e).slice(1)[0].trim());let i=/\(,/g;return i.test(t)&&(t=t.replace(i,"(")),{score:t}}var jRe={handleTiebreakSlashSeparation:$Re,handleSetSlashSeparation:LRe,punctuationAdjustments:URe,handleGameSeparation:_Re,joinFloatingTiebreak:TRe,handleBracketSpacing:SRe,handleSpaceSeparator:BRe,separateScoreBlocks:ARe,matchKnownPatterns:DRe,removeDanglingBits:FRe,removeErroneous:ORe,handleWalkover:kRe,properTiebreak:PRe,handleNumeric:qZ,handleRetired:xRe,containedSets:RRe,sensibleSets:ERe,stringScore:MRe,superSquare:CRe,setBuilder:WZ,excisions:VRe,replaceOh:NRe},XE={},GRe=["handleNumeric","handleWalkover","handleRetired","replaceOh","stringScore","punctuationAdjustments","excisions","handleSpaceSeparator","matchKnownPatterns","removeDanglingBits","handleBracketSpacing","matchKnownPatterns","containedSets","separateScoreBlocks","handleGameSeparation","removeErroneous","joinFloatingTiebreak","handleSetSlashSeparation","handleTiebreakSlashSeparation","properTiebreak","sensibleSets","superSquare"],HRe=["handleNumeric","separateScoreBlocks","sensibleSets","superSquare"];function KZ(t){if(!t.score)return{error:se};let{score:e,sheetName:i,identifier:r,fileName:n,stepLog:a,fullLog:o,profile:s}=t,l=[],u,c=[],d,p,m=e,h=g=>{g.forEach(v=>{p=jRe[v]({profile:s,identifier:r,matchUpStatus:u,attributes:d,applied:c,score:m});let y=p.score!==m;y&&l.push({method:v,score:p.score}),a&&(o||y||p.matchUpStatus!==u)&&console.log(u?{score:p.score,matchUpStatus:u}:{score:p.score},v),p.matchUpStatus&&(u=p.matchUpStatus),p.attributes&&(d=p.attributes),p.applied&&(c=p.applied),m=p.score})};h(GRe);let f=z2(m);return f||(m=e.toString().replace(/\D/g,""),d!=null&&d.removed&&(d.removed=void 0),h(HRe),f=z2(m),f||(m="")),c.forEach(g=>{XE[g]||(XE[g]=0),XE[g]+=1}),{matchUpStatus:u==null?void 0:u.toUpperCase(),modifications:l,attributes:d,isValid:f,score:m}}var XZ={};bt(XZ,{analyzeScore:()=>C_,analyzeSet:()=>vy,checkScoreHasValue:()=>br,checkSetIsComplete:()=>yR,getSetComplement:()=>N_,getTiebreakComplement:()=>SR,isValidMatchUpFormat:()=>Ra,parseScoreString:()=>U0,validateScore:()=>M_,validateTieFormat:()=>qn});function C_({existingMatchUpStatus:t,matchUpFormat:e,matchUpStatus:i,winningSide:r,score:n}){var a,o;let s=(n==null?void 0:n.sets)??[],l=((s==null?void 0:s.filter(U=>U==null?void 0:U.winningSide))||[]).reduce((U,T)=>{let{winningSide:D}=T;if(!D)return U;let P=D-1;return U[P]++,U},[0,0]),u=r?r-1:void 0,c=u!==void 0?1-u:void 0,d=u!==void 0&&l[u],p=c!==void 0&&l[c],m=e?Ln(e):void 0,h=Math.max(...l),f=Pa(l)[h],g=((a=m==null?void 0:m.setFormat)==null?void 0:a.timed)||((o=m==null?void 0:m.finalSetFormat)==null?void 0:o.timed),v=m==null?void 0:m.bestOf,y=v&&Math.ceil(v/2)||1,I=i??t,b=I&&[Pt,zr,Ft].includes(I),S=!m||!s.length||s.every((U,T)=>{let D=T+1,P=D===v,E=D===s.length,{side1Score:R,side2Score:N,side1TiebreakScore:A,side2TiebreakScore:M,winningSide:C}=U,O=Math.max(R??0,N??0),k=A??M,{finalSetFormat:x,setFormat:F}=m,$=P&&x||F;if(k){let{tiebreakTo:_,NoAD:L}=($==null?void 0:$.tiebreakFormat)||{},B=Math.max(A??0,M??0);if(L&&B>_||B<_&&C&&(E&&!b||!E))return!1}return $.setTo?!(!$.noTiebreak&&O>$.setTo+1):!0}),w=(!e||h===y)&&f===1&&l.indexOf(h)+1||void 0;return{valid:!!(S&&(r&&d>p&&r===w||r&&b||!r&&!w&&(![Ki,Pt,zr,Ft].includes(I)||g&&I===Ki)))}}function M_({existingMatchUpStatus:t,matchUpFormat:e,matchUpStatus:i,winningSide:r,score:n}){if(typeof n!="object")return{error:se};let{sets:a,scoreStringSide1:o,scoreStringSide2:s}=n,l="scoreString must be a string!";if(o!==void 0&&typeof o!="string")return{error:se,info:l};if(s!==void 0&&typeof s!="string")return{error:se,info:l};if(a!==void 0&&!Array.isArray(a))return{error:se,info:ip("sets")};if(a!=null&&a.length){let u=a.map(d=>d==null?void 0:d.setNumber).filter(Boolean);if(u.length!==dt(u).length)return{error:se,info:"setNumbers not unique"};for(let d of a){let{side1Score:p,side2Score:m,side1TiebreakScore:h,side2TiebreakScore:f,side1PointScore:g,side2PointScore:v,winningSide:y,setNumber:I}=d;if(![[p,m],[h,f],[g,v]].filter(b=>b.some(S=>![void 0,null].includes(S))).every(b=>b.every(S=>st(S))))return{error:se,info:"non-numeric values"};if(![I,y].filter(b=>![void 0,null].includes(b)).every(b=>st(b)))return{error:se,info:"non-numeric values"};if(y&&![1,2].includes(y))return{error:se,info:"winningSide must be 1 or 2"}}let{valid:c}=C_({existingMatchUpStatus:t,matchUpStatus:i,matchUpFormat:e,winningSide:r,score:n});if(!c)return{error:c9,info:"score is invalid for matchUpFormat or winningSide does not match calculated winningSide"}}return{valid:!0}}var N_=t=>{let{isSide1:e,lowValue:i,setTo:r,tiebreakAt:n,NoAD:a}=t;if(i===void 0)return!1;let o=Ze(i);(o==null?void 0:o.toString().length)>2&&(o=parseInt(o.toString().slice(0,2))),n&&n<r&&o>n&&(o=n);let s;return a&&!n?(o>r&&(s=r),s=o<r?r:r-1):s=o+1<r&&r||n&&n<r&&o===n&&r||!n&&o+2||r+1,[e?o:s,e?s:o]},SR=t=>{let{isSide1:e,lowValue:i,tiebreakTo:r,tiebreakNoAd:n}=t;if(i===void 0)return!1;let a=typeof i=="string"?parseInt(i):i;(a==null?void 0:a.toString().length)>2&&(a=parseInt(a.toString().slice(0,2))),n&&a>r-1&&(a=r-1);let o=zRe({lowValue:a,NoAD:n,tiebreakTo:r});return[e?a:o,e?o:a]};function zRe(t){let{lowValue:e,NoAD:i,tiebreakTo:r}=t,n=i?1:2;return e+1>=r?e+n:r}function U0({tiebreakTo:t=7,scoreString:e=""}){return e==null?void 0:e.split(" ").filter(Boolean).map((r,n)=>i({set:r,setNumber:n+1}));function i({set:r,setNumber:n}){let a=/\(([^)]+)\)/,o=/\[([^)]+)\]/,s=a.exec(r),l=o.exec(r),u=(r==null?void 0:r.startsWith("["))&&l&&l[1].split("-").map(I=>parseInt(I)),c=s&&r.replace(s[0],"")||l&&r.replace(l[0],"")||r,d=!u&&c.split("-").map(I=>parseInt(I)),p=u?u[0]>u[1]&&1||u[0]<u[1]&&2||void 0:d[0]>d[1]&&1||d[0]<d[1]&&2||void 0,m=s?s[1]:void 0,h=(m&&SR({lowValue:m,isSide1:p===2,tiebreakTo:t}))??[],[f,g]=d||[],[v,y]=u||h||[];return{side1Score:f,side2Score:g,side1TiebreakScore:v,side2TiebreakScore:y,winningSide:p,setNumber:n}}}function WRe({matchUpScoringFormat:t,isDecidingSet:e,isTiebreakSet:i,isTimedSet:r,setObject:n}){if(!n)return;let a=bR({set:n});return yR({matchUpScoringFormat:t,set:n,isDecidingSet:e,isTiebreakSet:i,isTimedSet:r})&&a||void 0}function vy(t){let{setObject:e,matchUpScoringFormat:i}=t;if(!e)return{error:lP};let{setNumber:r}=e||{},{bestOf:n,exactly:a}=i||{},o=n||a,s=!!(r&&o&&r===o),l=s&&(i==null?void 0:i.finalSetFormat)||(i==null?void 0:i.setFormat),u=!!(l!=null&&l.tiebreakSet),c=!!(l!=null&&l.timed),d=!u&&!c,p=!!(r&&o&&r<=o),m=[e==null?void 0:e.side1Score,e==null?void 0:e.side2Score],h=[e==null?void 0:e.side1PointScore,e==null?void 0:e.side2PointScore],f=[e==null?void 0:e.side1TiebreakScore,e==null?void 0:e.side2TiebreakScore],g=m.filter(k=>k!==void 0).length,v=h.filter(k=>k!==void 0).length,y=f.filter(k=>k!==void 0).length,I=m==null?void 0:m.filter(k=>!isNaN(k)).length,b=f==null?void 0:f.filter(k=>!isNaN(k)).length,{tiebreakAt:S}=l||{},w=S&&m.filter(k=>k>=S).length===2,U=w&&(m[0]>m[1]&&1||m[1]>m[0]&&2||void 0),T=!!(b&&!I),D=!!(e!=null&&e.winningSide),{error:P,result:E}=qRe({sideTiebreakScores:f,sideGameScores:m,setFormat:l,setObject:e}),{error:R,result:N}=YRe({sideTiebreakScores:f,setObject:e,setFormat:l}),A=d&&!T&&E||u&&T&&N||c,M=p&&!(u&&!T)&&!(d&&T)&&(!D||A),C=WRe({isTimedSet:c,matchUpScoringFormat:i,isDecidingSet:s,isTiebreakSet:T,setObject:e}),O={expectTiebreakSet:u,expectTimedSet:c,hasTiebreakCondition:w,isCompletedSet:D,isDecidingSet:s,isTiebreakSet:T,isValidSet:M,isValidSetNumber:p,isValidSetOutcome:A,leadingSide:U,setFormat:l,sideGameScores:m,sideGameScoresCount:g,sidePointScores:h,sidePointScoresCount:v,sideTiebreakScores:f,sideTiebreakScoresCount:y,winningSide:C};return(e==null?void 0:e.winningSide)!==void 0&&(T?(O.isValidTiebreakSetOutcome=N,N||(O.tiebreakSetError=R)):(O.isValidStandardSetOutcome=E,E||(O.standardSetError=P))),O}function qRe({setObject:t,setFormat:e,sideGameScores:i,sideTiebreakScores:r}){if(!t)return{result:!1,error:lP};let n=!!(e!=null&&e.tiebreakSet),a=!!(e!=null&&e.timed);if(!e||n||a)return{result:!1,error:se};if((i==null?void 0:i.filter(U=>!isNaN(U)).length)!==2)return{result:!1,error:lM};let{setTo:o,tiebreakAt:s,tiebreakFormat:l,NoAD:u}=e||{};if(!(o&&i!=null&&i.find(U=>U>=o)))return{result:!1,error:lM};let c=[1,2].includes(t==null?void 0:t.winningSide);if(!t||!c)return{result:!1,error:uP};let d=(t==null?void 0:t.winningSide)-1,p=1-d,m=i[d],h=i[p],f=m-h;if(!(m>h))return{result:!1,error:{message:"winningSide game scoreString is not high"}};let g=s&&l,v=(r==null?void 0:r.filter(U=>!isNaN(U)).length)===2,y=r==null?void 0:r[d],I=r==null?void 0:r[p],b=s&&i.filter(U=>U>=s).length===2;if(g){let{NoAD:U,tiebreakTo:T}=l;if(b){if(f>1)return{result:!1,error:{message:"invalid winning game scoreString (5)"}};if(!v)return{result:!1,error:{message:"invalid tiebreak scores (1)"}};if(isNaN(T))return{result:!1,error:{message:"tiebreakTo error"}};if(!(T&&r!=null&&r.find(N=>N>=T)))return{result:!1,error:{message:"invalid tiebreak scores (2)"}};let D=s<o?o:o+1;if(m>D)return{result:!1,error:{message:"invalid winning game scoreString (1)"}};if(!y||!I||y<I)return{result:!1,error:{message:"winningSide tiebreak value is not high"}};let P=U?1:2,E=y-I,R=I>=T-1;if(E&&R&&E<P)return{result:!1,error:{message:"invalid tiebreak scores (3)"}}}if(m>o&&!b)return{result:!1,error:{message:"invalid winning game scoreString (2)"}}}let S=u?1:2,w=h>=o-1;return f&&w&&!b&&f<S?{result:!1,error:{message:"invalid winning game scoreString (3)"}}:f>S&&m>o?{result:!1,error:{message:"invalid winning game scoreString (4)"}}:{result:!0}}function YRe({setObject:t,setFormat:e,sideTiebreakScores:i}){if(!t)return{result:!1,error:lP};let r=!!(e!=null&&e.tiebreakSet),n=!!(e!=null&&e.timed);if(!e||!r||n)return{result:!1,error:{message:"not tiebreak set"}};let a=[1,2].includes(t==null?void 0:t.winningSide);if(!t||!a)return{result:!1,error:uP};let{tiebreakSet:o}=e||{},{NoAD:s,tiebreakTo:l}=o||{};if((i==null?void 0:i.filter(g=>!isNaN(g)).length)!==2)return{result:!1,error:{message:"invalid tiebreak scores (1)"}};if(isNaN(l))return{result:!1,error:{message:"tiebreakTo error"}};if(!(i!=null&&i.find(g=>g>=l)))return{result:!1,error:{message:"invalid tiebreak scores (2)"}};let u=(t==null?void 0:t.winningSide)-1,c=1-u,d=i[u],p=i[c];if(!d||!p||d<p)return{result:!1,error:{message:"winningSide tiebreak value is not high"}};let m=s?1:2,h=d-p,f=p>=l-1;return h&&f&&h<m?{result:!1,error:{message:"invalid tiebreak scores (3)"}}:{result:!0}}function KRe(t){var e,i,r;let{existingDrawDefinition:n,hydrateCollections:a,enforceGender:o,tieFormatName:s,matchUpType:l,eventType:u,isMock:c,event:d}=t,{tieFormat:p,matchUpFormat:m}=t;if(l===ur&&u===ur){let h=(i=(e=n==null?void 0:n.structures)==null?void 0:e.find(({stage:f})=>f===Ae))==null?void 0:i.tieFormat;p=p||h||s&&((r=d==null?void 0:d.tieFormat)==null?void 0:r.tieFormatName)===s&&d.tieFormat||s&&Nu({namedFormat:s,hydrateCollections:a,isMock:c,event:d})||(d==null?void 0:d.tieFormat)||Nu({event:d,isMock:c,hydrateCollections:a}),m=void 0}else m||(p=void 0,d!=null&&d.matchUpFormat||(m=zo));if(p){let h=qn({gender:d==null?void 0:d.gender,enforceGender:o,tieFormat:p});if(h.error)return h}return{tieFormat:p,matchUpFormat:m}}function XRe(t){var e,i,r,n,a;let o=t.drawDefinition,{existingQualifyingPlaceholderStructureId:s,appliedPolicies:l,drawEntries:u,structureId:c,idPrefix:d,isMock:p,event:m}=t,h=t.qualifyingProfiles,f=h!=null&&h.length?XQ({uuids:t.uuids,qualifyingProfiles:h,appliedPolicies:l,idPrefix:d,isMock:p}):void 0;if(f!=null&&f.error)return f;o.structures=(e=o.structures)==null?void 0:e.filter(({structureId:T})=>T!==s),o.links=(i=o.links)==null?void 0:i.filter(({source:T})=>T.structureId!==s);let{qualifiersCount:g,qualifyingDrawPositionsCount:v,qualifyingDetails:y}=f??{};v&&(f!=null&&f.structures&&((r=o.structures)==null||r.push(...f.structures)),f!=null&&f.links&&((n=o.links)==null||n.push(...f.links)));let I=(a=o.structures)==null?void 0:a.find(({stage:T,stageSequence:D})=>T===Ae&&D===1),{qualifiersCount:b}=Uv({stageSequence:1,drawDefinition:o,structureId:c,stage:Ae}),S=Math.max(g??0,b??0),w=QJ({qualifiersCount:S,drawDefinition:o,stage:Ae});if(w.error||(w=g0({drawSize:v,stage:Ke,drawDefinition:o}),w.error))return w;JRe({drawDefinition:o,drawEntries:u,event:m});let U=QRe({mainStructure:I,qualifyingDetails:y,drawDefinition:o});return U.error?U:{drawDefinition:o,structureId:c}}function JRe({drawDefinition:t,drawEntries:e,event:i}){for(let r of(e??[]).filter(({entryStage:n})=>n===Ke)){let n={...r,entryStage:r.entryStage??Ae,drawDefinition:t,event:i};CL(n)}}function QRe({mainStructure:t,qualifyingDetails:e,drawDefinition:i}){var r;for(let n of e||[]){let{finalQualifyingRoundNumber:a,finalQualifyingStructureId:o,roundTarget:s,finishingPositions:l,linkType:u}=n,c=t&&((r=kw({targetStructureId:t.structureId,sourceStructureId:o,sourceRoundNumber:a,finishingPositions:l,targetEntryRound:s,linkType:u}))==null?void 0:r.link);if(c!=null&&c.error)return c;c&&(i.links||(i.links=[]),i.links.push(c))}return{error:void 0}}function JZ(t){var e,i;let{participantIds:r}=t,n=((i=(e=t.drawDefinition)==null?void 0:e.entries)==null?void 0:i.filter(a=>{let o=a.entryStatus;return!t.restrictEntryStatus||ds.includes(o)}).map(Tt))??[];if(r){let a=r.filter(o=>!(n!=null&&n.includes(o)));if(a!=null&&a.length)return te({result:{error:Ms},info:{invalidParticipantIds:a}})}else r=n;return t.roundsCount&&t.restrictRoundsCount!==!1&&t.roundsCount>r.length-1&&(!t.enableDoubleRobin||t.roundsCount>(r.length-1)*2)?{error:se,info:"Not enough participants for roundsCount"}:t.roundsCount&&t.restrictRoundsCount!==!1&&t.roundsCount>31?{error:se,info:"roundsCount must be less than 32"}:{participantIds:r}}function A_(t){var e;let i=[],{roundsCount:r=1,drawDefinition:n,matchUpsCount:a,structureId:o,idPrefix:s,isMock:l,event:u}=t,c,d=JZ(t);if(d.error)return d;for(let p of Te(1,r+1)){let m=gR({restrictMatchUpsCount:t.restrictMatchUpsCount,ignoreLastRoundNumber:!!c,newRound:!c,drawDefinition:n,matchUpsCount:a,structureId:o,roundNumber:c,idPrefix:s,isMock:l,event:u});if(m.error)return te({result:m,info:{iteration:p}});(e=m.matchUps)!=null&&e.length&&i.push(...m.matchUps),c=((m==null?void 0:m.roundNumber)??1)+1}return{matchUps:i}}function ZRe(t){var e;let{tournamentRecord:i,participantIds:r,scaleName:n,eventType:a,adHocRatings:o={}}=t,s=t.scaleAccessor??((e=Tr[n])==null?void 0:e.accessor),l=i.participants??[];for(let u of r??[]){let c=l==null?void 0:l.find(p=>p.participantId===u),d=q2({scaleName:`${n}.${VF}`,participant:c,eventType:a});!d&&n&&(d=q2({scaleAccessor:s,participant:c,scaleName:n,eventType:a})),d&&!o[u]&&(o[u]=d)}return o}function q2({scaleType:t=Ic,scaleAccessor:e,participant:i,scaleName:r,eventType:n}){var a,o;let s=(o=(a=i&&Ll({scaleAttributes:{eventType:n??Am,scaleType:t,scaleName:r},participant:i}))==null?void 0:a.scaleItem)==null?void 0:o.scaleValue;return e&&At(s)?s[e]:s}function O_(t){var e,i;let r=tEe(t);if(r!=null&&r.error)return r;let n=JZ(t);if(n.error)return n;let a=eEe(t);if(a.error)return a;let o=ZRe(t),s=((e=t.tournamentRecord)==null?void 0:e.isMock)??t.isMock,l=t.eventType??((i=t.event)==null?void 0:i.eventType),u=[],c=[],d;for(let p of Te(1,(t.roundsCount??1)+1)){let m=U_({...t,participantIds:n.participantIds,structure:a.structure,ignoreLastRoundNumber:!0,iterationMatchUps:u,adHocRatings:o,roundNumber:d,eventType:l,isMock:s});if(m.error)return m;let{matchUps:h,...f}=m;f.modifiedScaleValues&&(o=f.modifiedScaleValues),c.push({...f,iteration:p,matchUpsCount:h==null?void 0:h.length}),d=((f==null?void 0:f.roundNumber)??1)+1,h!=null&&h.length&&u.push(...h)}return{...Q,matchUps:u,roundResults:c}}function eEe(t){var e,i,r;if(t.structureId)return t.structureId;let n=t.drawDefinition,a=(i=(e=n==null?void 0:n.structures)==null?void 0:e.filter(s=>s.stageSequence===1))==null?void 0:i.reduce((s,l)=>{let u=l.stage&&Om[l.stage];return Yn({structure:l})&&u>(Om[s==null?void 0:s.stage]||1)?l:s},void 0),o=(r=n==null?void 0:n.structures)==null?void 0:r.find(s=>s.structureId===(a==null?void 0:a.structureId));return o?Yn({structure:o})?{structure:o}:{error:sm}:{error:Ai}}function tEe(t){var e;return t.roundsCount&&typeof t.roundsCount!="number"?{error:se,info:"roundsCount must be a number"}:typeof t.drawDefinition!="object"||t.drawDefinition.drawType&&t.drawDefinition.drawType!==Ga?{error:sm}:!Array.isArray((e=t.drawDefinition)==null?void 0:e.entries)&&t.participantIds&&!Array.isArray(t.participantIds)?{error:se,info:"Missing Entries"}:{error:void 0}}function iEe(t){var e,i;let{tournamentRecord:r,drawDefinition:n,structureId:a,idPrefix:o,isMock:s,event:l}=t,u=(e=l==null?void 0:l.entries)==null?void 0:e.filter(({entryStage:p,entryStatus:m})=>(!p||p===Ae)&&m&&ds.includes(m)),c=u==null?void 0:u.map(Tt),d=u?Math.floor(u.length/2):0;if(t.automated)return rEe({...t,participantIds:c});{let p=A_({roundsCount:t.roundsCount,drawDefinition:n,matchUpsCount:d,idPrefix:o,isMock:s,event:l});if(p.error)return p;(i=p.matchUps)!=null&&i.length&&pR({matchUps:p.matchUps,suppressNotifications:!0,tournamentRecord:r,drawDefinition:n,structureId:a,event:l})}return{...Q}}function rEe(t){var e,i;let{restrictEntryStatus:r,generateMatchUps:n,structureId:a,matchUpIds:o,scaleName:s,scaleAccessor:l}=t.drawMatic??{},u=O_({...t,eventType:((e=t.drawMatic)==null?void 0:e.eventType)??t.matchUpType,generateMatchUps:n??!0,scaleAccessor:l??t.scaleAccessor,scaleName:s??t.scaleName,participantIds:t.participantIds,roundsCount:t.roundsCount,restrictEntryStatus:r,structureId:a,matchUpIds:o});return u.error?u:((i=u==null?void 0:u.matchUps)!=null&&i.length&&pR({tournamentRecord:t.tournamentRecord,drawDefinition:t.drawDefinition,suppressNotifications:!0,matchUps:u.matchUps,event:t.event,structureId:a}),{...Q})}function nEe({requireParticipantCount:t=!0,enforcePolicyLimits:e=!0,drawSizeProgression:i,participantsCount:r,participantCount:n,appliedPolicies:a,drawDefinition:o,seedingProfile:s,structureId:l,seedsCount:u}){var c,d;r=r??n;let p=tt({drawDefinition:o,structureId:l});if(p.error)return p;let m=p.structure;if(!m)return{error:Ai};let{positionAssignments:h}=Mr({structure:m}),f=(h==null?void 0:h.length)||0;if(u>f)return{error:VK};let g=(c=m.structures)==null?void 0:c.length,v=st(s==null?void 0:s.groupSeedingThreshold)&&(s==null?void 0:s.groupSeedingThreshold),y=(d=_L({roundRobinGroupsCount:g,drawSize:f}))==null?void 0:d.seedGroups,{seedsCount:I}=Hw({policyDefinitions:a,requireParticipantCount:t,drawSizeProgression:i,participantsCount:r,drawSize:f});return I&&a!=null&&a[Oo]&&u>I&&e&&(u=I),m.seedLimit=u,m.seedAssignments=Te(1,u+1).map(b=>{let S=y==null?void 0:y.find(T=>T.includes(b)),w=S&&Math.min(...S),U=v&&b>=v?w:b;return{participantId:void 0,seedNumber:b,seedValue:U}}),ui({drawDefinition:o,structureIds:[l]}),{...Q,seedLimit:u}}function Vh({sortDescending:t=!1,tournamentRecord:e,scaleAttributes:i,scaleSortMethod:r,stageSequence:n,entries:a,event:o,stage:s}){if(!e)return{error:ve};return a=a??(o==null?void 0:o.entries)??[],{scaledEntries:a.filter(c=>(!s||!c.entryStage||c.entryStage===s)&&(!n||!c.entryStageSequence||c.entryStageSequence===n)&&ds.includes(c.entryStatus)).map(c=>{let{participantId:d}=c,{scaleItem:p}=hg({tournamentRecord:e,scaleAttributes:i,participantId:d});return{...c,...p}}).filter(c=>{let d=c.scaleValue;return!r&&(isNaN(d)||!parseFloat(d))?!1:d}).sort(r||l)};function l(c,d){return t?u(d)-u(c):u(c)-u(d)}function u(c){return parseFloat(c.scaleValue||(t?-1:1e5))}}function QZ(t){let e="prepareStage",{drawDefinition:i}=t,{structures:r}=ns({stageSequence:t.stageSequence||1,roundTarget:t.roundTarget,stage:t.stage,drawDefinition:i}),n=t.preparedStructureIds||[],a=r==null?void 0:r.find(({structureId:m})=>!n.includes(m));if(!a)return te({result:{error:Ai},stack:e});let o=a==null?void 0:a.structureId,{seedsCount:s,stageEntries:l,seedLimit:u}=pEe({...t,structureId:o});(t.seededParticipants||t.event||t.seedingScaleName)&&sEe({...t,seedsCount:s,structure:a,structureId:o});let c=t.automated!==!1&&t.drawType!==Ga&&!(t.qualifyingOnly&&t.stage!==Ke),d=((r==null?void 0:r.length)||0)>1,p=c?oEe({...t,multipleStructures:d,seedLimit:u,structureId:o}):{};return p!=null&&p.error?te({result:p,stack:e}):{...p,stageEntries:l,structureId:o,seedsCount:s}}function aEe({entries:t,stage:e,stageSequence:i,roundTarget:r}){return t.filter(n=>{var a,o;let s=(o=(a=vt({name:yl,element:n}))==null?void 0:a.extension)==null?void 0:o.value;return(!n.entryStage||n.entryStage===e)&&(!i||!n.entryStageSequence||n.entryStageSequence===i)&&(!r||!s||s===r)&&Np.includes(n.entryStatus)})}function oEe(t){let e=typeof t.automated=="object"&&t.automated.seedsOnly,i=Ow({...t,seedsOnly:e});if(i.error)return i;let r=i==null?void 0:i.positionAssignments,n=i==null?void 0:i.positioningReport;return{conflicts:i.conflicts,positionAssignments:r,positioningReport:n}}function sEe(t){let{seededParticipants:e,seedingScaleName:i,entries:r,event:n}=t,a=r.map(Tt);e?lEe({...t,enteredParticipantIds:a}):(n||i)&&uEe({...t,enteredParticipantIds:a})}function lEe(t){let{provisionalPositioning:e,enteredParticipantIds:i,seededParticipants:r,tournamentRecord:n,appliedPolicies:a,drawDefinition:o,seedingProfile:s,structureId:l,structure:u,event:c}=t,d=u?_h({provisionalPositioning:e,appliedPolicies:a,drawDefinition:o,seedingProfile:s,structure:u}):void 0;r.filter(({participantId:p})=>i.includes(p)).filter(p=>!p.seedNumber||p.seedNumber<=r.length).sort((p,m)=>p.seedNumber<m.seedNumber?-1:p.seedNumber<m.seedNumber?1:0).forEach(p=>{let{participantId:m,seedNumber:h,seedValue:f}=p;Tv({provisionalPositioning:e,tournamentRecord:n,drawDefinition:o,seedingProfile:s,participantId:m,seedBlockInfo:d,structureId:l,seedNumber:h,seedValue:f,event:c})})}function uEe(t){let e=t.seedsCount,{provisionalPositioning:i,enteredParticipantIds:r,seedAssignmentProfile:n,assignSeedsCount:a,tournamentRecord:o,drawDefinition:s,seedByRanking:l,seedingProfile:u,structureId:c,event:d}=t,{categoryName:p,ageCategoryCode:m}=(d==null?void 0:d.category)||{},h=d==null?void 0:d.eventType,f=cEe({...t,ageCategoryCode:m,categoryName:p,eventType:h})||l&&dEe({...t,ageCategoryCode:m,categoryName:p,eventType:h}),g=(f==null?void 0:f.length)??0;g<e&&(e=g),f==null||f.filter(({participantId:v})=>r.includes(v)).slice(0,a||e).forEach((v,y)=>{let I=y+1,{participantId:b,scaleValue:S}=v,w=(n==null?void 0:n[I])||S||I;Tv({provisionalPositioning:i,tournamentRecord:o,drawDefinition:s,seedingProfile:u,participantId:b,structureId:c,seedNumber:I,seedValue:w,event:d})})}function cEe(t){let{tournamentRecord:e,seedingScaleName:i,stageSequence:r,entries:n,stage:a,event:o}=t,{categoryName:s,ageCategoryCode:l}=(o==null?void 0:o.category)||{},u=o==null?void 0:o.eventType,c={scaleName:i||s||l||o.eventId,scaleType:xl,eventType:u};return Vh({scaleAttributes:c,tournamentRecord:e,stageSequence:r,entries:n,stage:a}).scaledEntries}function dEe(t){let{tournamentRecord:e,stageSequence:i,event:r,entries:n,stage:a}=t,{categoryName:o,ageCategoryCode:s}=(r==null?void 0:r.category)||{},l=r==null?void 0:r.eventType;return Vh({scaleAttributes:{scaleName:o||s,scaleType:Nc,eventType:l},tournamentRecord:e,stageSequence:i,entries:n,stage:a}).scaledEntries}function pEe(t){let{seedsCount:e}=t;t.seededParticipants&&(e=t.seededParticipants.length),e>t.drawSize&&(e=t.drawSize);let i=aEe(t);e>i.length&&(e=i.length);let{seedLimit:r}=nEe({enforcePolicyLimits:t.enforcePolicyLimits??!0,appliedPolicies:t.appliedPolicies,participantsCount:i.length,seedingProfile:t.seedingProfile,drawDefinition:t.drawDefinition,structureId:t.structureId,seedsCount:e});return r&&r<e&&(e=r),{seedsCount:e,stageEntries:i,seedLimit:r}}function mEe(t){var e;let i=b_({...t,modifyOriginal:!1});if(i.error)return i;let r=i.drawDefinition,{suppressDuplicateEntries:n=!0,ignoreStageSpace:a,appliedPolicies:o,qualifyingOnly:s,seedingProfile:l,participants:u,drawEntries:c,placeByes:d,drawSize:p,drawType:m,entries:h}=t,f=[],g=[],v=hEe({suppressDuplicateEntries:n,ignoreStageSpace:a,drawDefinition:r,drawEntries:c,drawType:m,entries:h});if(v.error)return v;let y=m===Pp?0:Ze(t.seedsCount??0),I=QZ({...t,qualifyingOnly:!p||s,appliedPolicies:o,drawDefinition:r,seedingProfile:l,participants:u,stage:Ae,seedsCount:y,placeByes:d,drawSize:p,entries:h});if(I.error&&!I.conflicts)return I;(e=I.positioningReport)!=null&&e.length&&f.push({[Ae]:I.positioningReport});let b=I.structureId;return I.conflicts&&(g=I.conflicts),m===Ga&&t.roundsCount&&iEe({...t,drawDefinition:r,structureId:b}),{drawDefinition:r,positioningReports:f,conflicts:g,structureId:b}}function hEe(t){let{ignoreStageSpace:e,drawDefinition:i,drawEntries:r,drawType:n,entries:a}=t;for(let o of a){if(r&&o.entryStage&&o.entryStage!==Ae)continue;let s={...o,ignoreStageSpace:e??n===Ga,entryStage:o.entryStage??Ae,event:t.event,drawDefinition:i,drawType:n},l=CL(s);if(r&&l.error)return l}return{error:void 0}}var fEe=()=>({matchUpType:void 0,drawName:void 0,drawId:void 0,structures:[],entries:[],links:[]}),gEe=fEe;function vEe(t){let{drawId:e=Ht(),processCodes:i,matchUpType:r,drawType:n}=t??{},a=gEe();return Object.assign(a,{processCodes:i,matchUpType:r,drawType:n,drawId:e})}function k_(t){let e=t.structureIds,{tournamentRecord:i,drawDefinition:r,matchUpFormat:n,structureId:a,matchUpId:o,event:s}=t,l=We(t,[{[$n]:!0,[xF]:!0}]);if(l.error)return l;if(!Ra({matchUpFormat:n}))return{error:Kb};let u="setMatchUpFormat";if(o){let c=Si({drawDefinition:r,matchUpId:o,event:s});if(c.error)return c;let d=c.matchUp;if((d==null?void 0:d.matchUpType)===ur)return{info:"Cannot set matchUpFormat when { matchUpType: TEAM }",error:la};d&&(d.matchUpFormat=n,Et({tournamentId:i==null?void 0:i.tournamentId,eventId:s==null?void 0:s.eventId,context:u,drawDefinition:r,matchUp:d}))}else if(Array.isArray(e)){if((s==null?void 0:s.eventType)===ur)return{error:Wl};for(let c of e){let d=tt({drawDefinition:r,structureId:c});if(d.error)return d;d.structure&&(d.structure.matchUpFormat=n)}}else if(a){if((s==null?void 0:s.eventType)===ur)return{error:Wl};let c=tt({drawDefinition:r,structureId:a});if(c.error)return c;c.structure&&(c.structure.matchUpFormat=n)}else r&&(r.matchUpFormat=n);return e=e??(a?[a]:void 0),ui({drawDefinition:r,structureIds:e}),{...Q}}function IEe({tieFormat:t}){let e=qn({checkCollectionIds:!1,tieFormat:t});if(e.error)return e;for(let i of t.collectionDefinitions)i.collectionId||(i.collectionId=Ht());return{tieFormat:t}}function yEe({tournamentRecord:t,drawDefinition:e,matchUpFormat:i,matchUpType:r,tieFormat:n,event:a}){if((i||n)&&!(i&&(a==null?void 0:a.matchUpFormat)===i||a!=null&&a.tieFormat&&n&&JSON.stringify(a.tieFormat)===JSON.stringify(n))){if(n){let o=IEe({tieFormat:n});if(o.error)return o;e.tieFormat=o.tieFormat??n}else if(i){let o=k_({tournamentRecord:t,drawDefinition:e,matchUpFormat:i,event:a});if(o.error)return{info:"matchUpFormat or tieFormat error",error:o.error}}r&&(e.matchUpType=r)}return{error:void 0}}var ZZ={};bt(ZZ,{attachPolicies:()=>rp,findPolicy:()=>Cp,getAppliedPolicies:()=>Bt,getPolicyDefinitions:()=>ec,mutate:()=>eee,query:()=>iee,removePolicy:()=>tee});var eee={};bt(eee,{attachPolicies:()=>rp,removePolicy:()=>tee});function tee(t){let e=We(t,[{[TSe]:!0,_anyOf:{[fn]:!1,[Ur]:!1,[$n]:!1,[ed]:!1}}]);if(e.error)return e;let i,r=t.drawDefinition??t.event??((t.tournamentId||!t.tournamentRecords)&&t.tournamentRecord);if(r)return Y2(t,r);if(t.tournamentRecords){let n=Object.keys(t.tournamentRecords);if(!n.length)return{error:ve};for(let a of n){let o=t.tournamentRecords[a],s=Y2(t,o);if(s.error)return s;i=!0}}else return{error:ve};return i?{...Q}:{error:Jf}}function Y2(t,e){let i=Bt(t).appliedPolicies??{};return i[t.policyType]?(delete i[t.policyType],Object.keys(i).length?_t({element:e,extension:{name:ly,value:i}}):Dn({element:e,name:ly}),{...Q}):{error:Jf}}var iee={};bt(iee,{findPolicy:()=>Cp,getAppliedPolicies:()=>Bt,getPolicyDefinitions:()=>ec});var ree={[Oo]:{validSeedPositions:{ignore:!0},duplicateSeedNumbers:!0,drawSizeProgression:!0,seedingProfile:{drawTypes:{[Kl]:{positioning:Yd},[is]:{positioning:Yd}},positioning:hSe},policyName:"USTA SEEDING",seedsCountThresholds:[{drawSize:4,minimumParticipantCount:3,seedsCount:2},{drawSize:16,minimumParticipantCount:12,seedsCount:4},{drawSize:32,minimumParticipantCount:24,seedsCount:8},{drawSize:64,minimumParticipantCount:48,seedsCount:16},{drawSize:128,minimumParticipantCount:96,seedsCount:32},{drawSize:256,minimumParticipantCount:192,seedsCount:64}]}},WM=ree;function bEe({appliedPolicies:t,policyDefinitions:e,drawDefinition:i,stack:r}){if(e&&typeof e!="object")return te({info:"policyDefinitions must be an object",result:{error:se},stack:r});let n={[sy]:t==null?void 0:t[sy]};return e?wEe({policyDefinitions:e,appliedPolicies:t,policiesToAttach:n,drawDefinition:i}):n.avoidance&&rp({drawDefinition:i,policyDefinitions:n}),!(t!=null&&t[Oo])&&!(e!=null&&e[Oo])&&(rp({policyDefinitions:WM,drawDefinition:i}),t&&Object.assign(t,WM)),{error:void 0}}function wEe({policyDefinitions:t,appliedPolicies:e,policiesToAttach:i,drawDefinition:r}){for(let n of Object.keys(t))JSON.stringify(e==null?void 0:e[n])!==JSON.stringify(t[n])&&(i[n]=t[n]);Object.keys(i).length&&(rp({policyDefinitions:i,drawDefinition:r}),e&&Object.assign(e,i))}function UEe(t){var e,i,r,n,a;let{tournamentRecord:o,matchUpFormat:s,appliedPolicies:l,policyDefinitions:u,matchUpType:c,tieFormat:d,drawType:p,stack:m,event:h}=t,f=t.drawId?(e=h==null?void 0:h.drawDefinitions)==null?void 0:e.find(w=>w.drawId===t.drawId):void 0;f&&p!==f.drawType&&(f.drawType=p);let g=f??vEe({processCodes:t.processCodes,drawId:t.drawId,drawType:p}),v=yEe({tournamentRecord:o,drawDefinition:g,matchUpFormat:s,matchUpType:c,tieFormat:d,event:h});if(v.error)return te({result:v,stack:m});let y=bEe({appliedPolicies:l,policyDefinitions:u,drawDefinition:g,stack:m});if(y.error)return y;let I=(r=(i=f==null?void 0:f.structures)==null?void 0:i.find(w=>w.stage===Ae&&w.stageSequence===1))==null?void 0:r.structureId,b=f?(n=f.structures)==null?void 0:n.filter(w=>w.stage===Ke):[],S=(b==null?void 0:b.length)===1&&!((a=b[0].matchUps)!=null&&a.length)&&b[0].structureId;return{drawDefinition:g,structureId:I,existingDrawDefinition:f,existingQualifyingPlaceholderStructureId:S}}function SEe(t){var e,i;let r="generateOrGetExisting",n=[],a=[],o=UEe(t);if(o.error)return te({result:o,stack:r});let s=o.existingDrawDefinition,l=o.drawDefinition??{},u=o.structureId,c=t.drawEntries??t.eventEntries??[],d=o.existingQualifyingPlaceholderStructureId&&XRe({...t,...o})||mEe({...t,...o,entries:c});return d.error?te({result:d,stack:r}):((e=d.positioningReports)!=null&&e.length&&n.push(...d.positioningReports??[]),(i=d.conflicts)!=null&&i.length&&a.push(...d.conflicts??[]),l=d.drawDefinition,u=d.structureId,{existingDrawDefinition:s,positioningReports:n,drawDefinition:l,structureId:u,conflicts:a,entries:c})}function TEe(t){var e,i,r;let{qualifyingPlaceholder:n,qualifyingProfiles:a,existingDrawDefinition:o,positioningReports:s,appliedPolicies:l,qualifyingOnly:u,drawDefinition:c,seedingProfile:d,participants:p,structureId:m,entries:h,stack:f}=t,g=n&&!(a!=null&&a.length)&&!o,v=[];if(a){let y=(w,U)=>w.stageSequence-U.stageSequence,I=(w,U)=>w.roundTarget-U.roundTarget,b=[],S=1;a.sort(I);for(let w of a){if(!Array.isArray(w.structureProfiles))return te({info:ip("structureProfiles"),result:{error:Je},stack:f});S=w.roundTarget||S;let U=((e=w.structureProfiles)==null?void 0:e.sort(y))||[],T=1;for(let D of U){let{qualifyingRoundNumber:P,qualifyingPositions:E,seededParticipants:R,seedingScaleName:N,seedsCount:A=0,seedByRanking:M,placeByes:C,drawSize:O}=D,k=QZ({...t,seedingProfile:D.seedingProfile??d,stageSequence:T,qualifyingRoundNumber:P,preparedStructureIds:b,qualifyingPositions:E,seededParticipants:R,stage:Ke,seedingScaleName:N,appliedPolicies:l,drawDefinition:c,qualifyingOnly:u,seedByRanking:M,participants:p,roundTarget:S,seedsCount:A,placeByes:C,drawSize:O,entries:h});if(k.error)return k;k.structureId&&b.push(k.structureId),T+=1,(i=k.conflicts)!=null&&i.length&&v.push(...k.conflicts),(r=k.positioningReport)!=null&&r.length&&s.push({[Ke]:k.positioningReport})}S+=1}}else if(m&&g){let y=so({structureName:tn(Ke),stage:Ke}),{link:I}=kw({sourceStructureId:y.structureId,targetStructureId:m,sourceRoundNumber:0,linkType:Ou});c.structures||(c.structures=[]),c.structures.push(y),c.links||(c.links=[]),c.links.push(I)}return{qualifyingConflicts:v,error:void 0}}var nee={};bt(nee,{addGoesTo:()=>tp,allCompetitionMatchUps:()=>Os,allDrawMatchUps:()=>Pn,allEventMatchUps:()=>au,allPlayoffPositionsFilled:()=>zL,allTournamentMatchUps:()=>Hr,analyzeDraws:()=>jw,analyzeMatchUp:()=>yy,analyzeTournament:()=>H_,bulkUpdatePublishedEventIds:()=>q_,calculateWinCriteria:()=>Gh,categoryCanContain:()=>ew,checkMatchUpIsComplete:()=>Cd,checkValidEntries:()=>fR,compareTieFormats:()=>Bu,competitionScheduleMatchUps:()=>Xw,courtGridRows:()=>kR,credits:()=>DEe,drawMatchUps:()=>s$,eventMatchUps:()=>LR,filterMatchUps:()=>pu,filterParticipants:()=>Ew,findDrawDefinition:()=>f_,findExtension:()=>vt,findVenue:()=>nu,getAggregateTeamResults:()=>G_,getAllDrawMatchUps:()=>fr,getAllEventData:()=>Y_,getAllStructureMatchUps:()=>qt,getAllowedDrawTypes:()=>TR,getAllowedMatchUpFormats:()=>B_,getAppliedPolicies:()=>Bt,getAssignedParticipantIds:()=>Op,getAvailableMatchUpsCount:()=>mR,getAvailablePlayoffProfiles:()=>xw,getCategoryAgeDetails:()=>Nm,getCheckedInParticipantIds:()=>Ah,getCompetitionDateRange:()=>PR,getCompetitionMatchUps:()=>Iy,getCompetitionParticipants:()=>x_,getCompetitionPenalties:()=>V_,getCompetitionVenues:()=>Ww,getCourtInfo:()=>XP,getCourts:()=>l$,getDrawData:()=>ER,getDrawDefinitionTimeItem:()=>mL,getDrawParticipantRepresentativeIds:()=>m_,getDrawStructures:()=>ns,getDrawTypeCoercion:()=>Gw,getEligibleVoluntaryConsolationParticipants:()=>p_,getEntriesAndSeedsCount:()=>xR,getEvent:()=>d$,getEventData:()=>CR,getEventMatchUpFormatTiming:()=>Q_,getEventProperties:()=>u$,getEventPublishStatus:()=>Eo,getEventStructures:()=>nR,getEventTimeItem:()=>dw,getEvents:()=>c$,getFlightProfile:()=>Hi,getHomeParticipantId:()=>i$,getLinkedTournamentIds:()=>lw,getMatchUpCompetitiveProfile:()=>bw,getMatchUpContextIds:()=>r$,getMatchUpDailyLimits:()=>$R,getMatchUpDailyLimitsUpdate:()=>Z_,getMatchUpDependencies:()=>ps,getMatchUpFormat:()=>n$,getMatchUpFormatTiming:()=>ww,getMatchUpFormatTimingUpdate:()=>J_,getMatchUpScheduleDetails:()=>JP,getMatchUpType:()=>QP,getMatchUpsMap:()=>ln,getMatchUpsStats:()=>a$,getMatchUpsToSchedule:()=>MR,getMaxEntryPosition:()=>X_,getModifiedMatchUpFormatTiming:()=>FR,getPairedParticipant:()=>as,getParticipantEventDetails:()=>F_,getParticipantIdFinishingPositions:()=>h_,getParticipantMembership:()=>L_,getParticipantResults:()=>_w,getParticipantScaleItem:()=>hg,getParticipantSchedules:()=>__,getParticipantSignInStatus:()=>$_,getParticipantTimeItem:()=>hL,getParticipants:()=>Oi,getPersonRequests:()=>Fp,getPolicyDefinitions:()=>ec,getPositionAssignments:()=>fy,getPositionsPlayedOff:()=>Pv,getPredictiveAccuracy:()=>t$,getProfileRounds:()=>OR,getPublishState:()=>Fh,getRoundMatchUps:()=>An,getRounds:()=>o$,getScaleValues:()=>fv,getScaledEntries:()=>Vh,getScheduledRoundsDetails:()=>qw,getSchedulingProfile:()=>nc,getSchedulingProfileIssues:()=>K_,getSeedingThresholds:()=>$L,getSeedsCount:()=>Hw,getStructureSeedAssignments:()=>go,getTeamLineUp:()=>ep,getTieFormat:()=>W_,getTimeItem:()=>Do,getTournamentIds:()=>ow,getTournamentInfo:()=>jh,getTournamentPenalties:()=>DR,getTournamentPersons:()=>j_,getTournamentPoints:()=>RR,getTournamentPublishStatus:()=>Rw,getTournamentStructures:()=>HL,getTournamentTimeItem:()=>zP,getValidGroupSizes:()=>Nw,getVenueData:()=>dg,getVenuesAndCourts:()=>rc,isAdHoc:()=>Yn,isCompletedStructure:()=>_c,isValidForQualifying:()=>I_,isValidMatchUpFormat:()=>Ra,matchUpActions:()=>hR,participantScaleItem:()=>Ll,participantScheduledMatchUps:()=>e$,positionActions:()=>v_,publicFindCourt:()=>DL,publicFindVenue:()=>TL,tallyParticipantResults:()=>Rv,tieFormatGenderValidityCheck:()=>UP,tournamentMatchUps:()=>_R,validMatchUp:()=>WP,validMatchUps:()=>Ro,validateCollectionDefinition:()=>tw,validateLineUp:()=>rR});function DEe(){return`
    This project would not have been possible without the generous input and patience
    of tournament organizers and directors who worked with early versions of CourtHive/TMX.

    Thanks to Pavel, Ivan, Mladen, Zdenko, Antonia, Jakov, Kreso, Barry, Jeff, Bobby... to name just a few. 

    The project would not have even begun without the support of Miro, or the introduction by Sretchko.
    The project would not have succeeded without the enthusiasm of Randy and Bruce.
    Thanks to serendipity and Luca and the ensuing TODS conversations with ITF.
    Thanks to Scott and Jake for sanity checks, suggestions, and camaraderie.
    Thanks to Zoran for inspiring the async support and getting into the weeds with subscriptions.
    Thanks to Dave for backing the conversion of TMX 1.x source into the factory repository.
    Thanks to Vuk and Pavle and Rich and Chris and Deepa for the direct engagement with the APIs.
    Thanks to Joe for repeatedly challenging me and the many pointers to useful tooling.
    Thanks to Shannon for the validation of the approach from his deep domain experience.
    Thanks to Nikola for the ongoing camaraderie and explorations of what we can do with TODS.

    And a special thanks to my family for putting up with the long days and weeks and months of coding
    and conversations at all hours.
  `}var aee={};bt(aee,{filterParticipants:()=>Ew,getCompetitionParticipants:()=>x_,getPairedParticipant:()=>as,getParticipantEventDetails:()=>F_,getParticipantMembership:()=>L_,getParticipantScaleItem:()=>hg,getParticipantSchedules:()=>__,getParticipantSignInStatus:()=>$_,getParticipantTimeItem:()=>hL,getParticipants:()=>Oi,getScaleValues:()=>fv,participantScaleItem:()=>Ll,validateLineUp:()=>rR});function x_(t){let{tournamentRecords:e}=t||{};if(typeof e!="object"||!Object.keys(e).length)return{error:xi};let i=[],r={},n={},a={},o=[],s={},l=[];for(let u of Object.values(e)){let{participantIdsWithConflicts:c,mappedMatchUps:d,participantMap:p,participants:m,matchUps:h,derivedEventInfo:f,derivedDrawInfo:g}=Oi({...t,tournamentRecord:u});Object.assign(s,d),Object.assign(r,p),Object.assign(n,f),Object.assign(a,g),i.push(...m??[]),o.push(...h??[]),c==null||c.forEach(v=>{l.includes(v)||l.push(v)})}return{participantIdsWithConflicts:l,derivedEventInfo:n,derivedDrawInfo:a,participantMap:r,mappedMatchUps:s,participants:i,...Q,matchUps:o}}function F_({tournamentRecord:t,participantId:e}){if(!t)return{error:ve};if(!e)return{error:hr};let i=[e].concat((t.participants??[]).filter(r=>{var n;return(r==null?void 0:r.participantType)&&[Xt,ft].includes(r.participantType)&&((n=r.individualParticipantIds)==null?void 0:n.includes(e))}).map(r=>r.participantId));return{eventDetails:(t.events??[]).filter(r=>{let n=((r==null?void 0:r.entries)??[]).map(a=>a.participantId);return Nn(n,i)}).map(r=>({eventName:r.eventName,eventId:r.eventId}))}}function L_({tournamentRecord:t,participantId:e}){if(!t)return{error:ve};if(!e)return{error:hr};let{participants:i}=Oi({participantFilters:{participantTypes:[Xt,ft,Ja]},tournamentRecord:t});return(i??[]).filter(r=>{var n;return(n=r.individualParticipantIds)==null?void 0:n.includes(e)}).reduce((r,n)=>{let a=n.participantType;return a&&(r[a]||(r[a]=[]),r[a].push(n)),r},{})}function __({participantFilters:t={},tournamentRecord:e}){if(!e)return{error:ve};if(typeof t!="object")return{error:Qu,context:{participantFilters:t}};let i={eventIds:t.eventIds},r=Hr({tournamentRecord:e,contextFilters:i}).matchUps??[],n=Object.assign({},...r.map(l=>({[l.matchUpId]:l}))),a=r.filter(({schedule:l})=>l&&Object.keys(l).length),o=ps({tournamentRecord:e,matchUps:r}).sourceMatchUpIds??[],s={};for(let l of a){let{sides:u}=l,c,d=(u==null?void 0:u.map(m=>{if(m.participant)return[m.participant].concat(...m.participant.individualParticipants||[]);o[l.matchUpId]&&!c&&(c=(o[l.matchUpId]||[]).map(h=>n[h]).filter(({winningSide:h,bye:f})=>!h&&!f))}).filter(Boolean).flat())??[];for(let m of d){let{participantId:h}=m;s[h]||(s[h]={potentialMatchUps:[],participant:m,matchUps:[]}),s[h].matchUps.push(l)}let p=(c==null?void 0:c.map(({sides:m})=>m).flat().map(({participant:m})=>m&&[m].concat(...m.individualParticipants||[])).filter(Boolean).flat())||[];for(let m of p){let{participantId:h}=m;s[h]||(s[h]={potentialMatchUps:[],participant:m,matchUps:[]}),s[h].potentialMatchUps.push(l)}}return{participantSchedules:Object.values(s).filter(({participant:l})=>!(t.participantIds&&!t.participantIds.includes(l.participantId)||t.participantTypes&&!t.participantTypes.includes(l.participantType))),...Q}}function $_({tournamentRecord:t,participantId:e}){if(!t)return{error:ve};if(!e)return{error:hr};let{participant:i}=nd({tournamentRecord:t,participantId:e});if(!i)return{error:Wi};let{timeItem:r}=Do({itemType:cw,element:i});return r&&r.itemValue===cy&&cy}var oee={};bt(oee,{analyzeDraws:()=>jw,analyzeTournament:()=>H_,getAggregateTeamResults:()=>G_,getAllowedDrawTypes:()=>TR,getAllowedMatchUpFormats:()=>B_,getAppliedPolicies:()=>Bt,getCompetitionDateRange:()=>PR,getCompetitionPenalties:()=>V_,getPolicyDefinitions:()=>ec,getTournamentInfo:()=>jh,getTournamentPenalties:()=>DR,getTournamentPersons:()=>j_,getTournamentPoints:()=>RR,getTournamentStructures:()=>HL,getTournamentTimeItem:()=>zP});function B_({tournamentRecord:t,categoryName:e,categoryType:i}){var r;if(!t)return{error:ve};let{appliedPolicies:n}=Bt({tournamentRecord:t});return(((r=n==null?void 0:n[fo])==null?void 0:r.matchUpFormats)||[]).filter(({categoryNames:a,categoryTypes:o})=>!e&&!o||e&&(a==null?void 0:a.includes(e))||i&&(o==null?void 0:o.includes(i)))}function TR({tournamentRecord:t,categoryName:e,categoryType:i}){var r;if(!t)return{error:ve};let{appliedPolicies:n}=Bt({tournamentRecord:t});return(((r=n==null?void 0:n[n0])==null?void 0:r.allowedDrawTypes)||[]).filter(({categoryNames:a,categoryTypes:o})=>!e&&!o||e&&(a==null?void 0:a.includes(e))||i&&(o==null?void 0:o.includes(i)))}function DR({tournamentRecord:t}){if(!t)return{error:ve};let e=((t==null?void 0:t.participants)??[]).reduce((i,r)=>{let{participantId:n}=r;return(r.penalties??[]).forEach(a=>{let{penaltyId:o}=a||{};i[o]?i[o].participants.push(n):i[o]={...a,participantIds:[n]}}),i},{});return{penalties:Object.values(e)}}function V_({tournamentRecords:t}){if(typeof t!="object"||!Object.keys(t).length)return{error:xi};let e=[];for(let i of Object.values(t)){let{penalties:r}=DR({tournamentRecord:i});e.push(...r??[])}return{penalties:e}}function see({event:t}){return{eventInfo:(({eventId:e,eventName:i,eventType:r,eventLevel:n,surfaceCategory:a,matchUpFormat:o,category:s,gender:l,startDate:u,endDate:c,ballType:d,discipline:p,onlineResources:m,notes:h})=>({eventId:e,eventName:i,eventType:r,eventLevel:n,surfaceCategory:a,matchUpFormat:o,category:s,gender:l,startDate:u,endDate:c,ballType:d,discipline:p,onlineResources:m,notes:h}))(t)}}var PEe={[gv]:{policyName:"Staff Privacy Policy",participant:{contacts:!1,individualParticipants:!1,individualParticipantIds:!1,onlineResources:!1,participantName:!0,participantOtherName:!0,participantId:!0,participantRole:!0,participantRoleResponsibilities:!0,participantStatus:!0,penalties:!1,representing:!0,participantType:!0,person:{addresses:!1,biographicalInformation:!1,birthDate:!1,contacts:!1,nationalityCode:!0,nativeFamilyName:!1,nativeGivenName:!1,onlineResources:!1,otherNames:!0,parentOrganisationId:!1,passportFamilyName:!1,passportGivenName:!1,personId:!1,personOtherIds:!1,previousNames:!1,sex:!1,standardFamilyName:!0,standardGivenName:!0,status:!1,tennisId:!1,wheelchair:!0}}}},REe=PEe;function jh(t){var e,i,r,n;let{tournamentRecord:a}=t??{};if(!a)return{error:ve};let o=(({tournamentId:d,tournamentRank:p,tournamentStatus:m,formalName:h,tournamentName:f,promotionalName:g,onlineResources:v,localTimeZone:y,activeDates:I,startDate:b,endDate:S,hostCountryCode:w,venues:U,notes:T,updatedAt:D})=>({tournamentId:d,tournamentRank:p,tournamentStatus:m,formalName:h,tournamentName:f,promotionalName:g,onlineResources:v,localTimeZone:y,activeDates:I,startDate:b,endDate:S,hostCountryCode:w,venues:U,notes:T,updatedAt:D}))(a),s=((e=Oi({participantFilters:{participantRoles:[IJ,NL,yJ,bJ,UJ]},policyDefinitions:REe,tournamentRecord:a}))==null?void 0:e.participants)??[];s&&(o.tournamentContacts=s);let l=(i=Fh({tournamentRecord:a}))==null?void 0:i.publishState,u=((n=(r=l==null?void 0:l.tournament)==null?void 0:r.status)==null?void 0:n.publishedEventIds)||[],c=[];for(let d of a.events??[])if(!(t!=null&&t.usePublishState)||u.includes(d.eventId)){let p=see({event:d}).eventInfo;p&&c.push(p)}return o.timeItemValues=RQ({element:a}),o.publishState=l==null?void 0:l.tournament,o.eventInfo=c,{tournamentInfo:Ne(He(o),!1,!0),...Q}}function PR({tournamentRecords:t}){if(!At(t))return{error:xi};let e=Object.keys(t??{}).reduce((n,a)=>{let o=t[a],{tournamentInfo:{startDate:s,endDate:l}}=jh({tournamentRecord:o}),u=s&&new Date(mt(s));(!n.startDate||u&&u<n.startDate)&&(n.startDate=u);let c=l&&new Date(mt(l));return(!n.endDate||c&&c>n.endDate)&&(n.endDate=c),n},{startDate:void 0,endDate:void 0}),i=e.startDate&&mt(e.startDate.toISOString()),r=e.endDate&&mt(e.endDate.toISOString());return!i||!r?{error:o9}:{startDate:i,endDate:r}}function j_({tournamentRecord:t,participantFilters:e}){if(!t)return{error:ve};let i=t.participants||[];e&&(i=Ew({participants:i,participantFilters:e,tournamentRecord:t}));let r={},n=a=>{if(a.person){let{personId:o}=a.person;r[o]?r[o].participantIds.push(a.participantId):r[o]={...a.person,participantIds:[a.participantId]}}};return i.forEach(a=>{a.person&&n(a)}),{tournamentPersons:Object.values(r)}}function G_(t){var e,i,r,n,a,o,s,l;let u=We(t,[{[Ur]:!0}]);if(u.error)return u;let c=t.finishingPositionRangeBounsPoints||{},d={},p=I=>{var b,S,w;let U=(b=I==null?void 0:I.individualParticipants)==null?void 0:b.map(T=>{var D;return((D=T.teams)==null?void 0:D.length)===1&&T.teams[0]});return((S=I==null?void 0:I.teams)==null?void 0:S.length)===1&&((w=I==null?void 0:I.teams)==null?void 0:w[0])||(U==null?void 0:U[0].participantId)===(U==null?void 0:U[1].participantId)&&(U==null?void 0:U[0])},{matchUps:m,participants:h}=Oi({participantFilters:{participantTypes:[Dt]},withRankingProfile:!0,withStatistics:!0,...t});for(let I of h??[]){if(I.participantType===Gn)continue;((i=(e=I.draws)==null?void 0:e[0])==null?void 0:i.drawId)==="draw-0-3"&&console.log(I.participantType,I.draws[0].finishingPositionRange);let b=p(I);if(b)for(let S of(I==null?void 0:I.draws)??[]){let w=(r=S==null?void 0:S.finishingPositionRange)==null?void 0:r.join("-");if(w&&c!=null&&c[w]){let U=b==null?void 0:b.participantId,T=S==null?void 0:S.drawId,D=`${U}|${T}|${w}`;d[D]=c[w]}}}let f=I=>({teamName:I,standingPoints:0,pointsPlayed:0,pointsPct:0,points:0,bonus:0,diff:0,loss:0,win:0}),g=(I,b,S)=>{I[b]===void 0&&(I[b]=0),I[b]+=S},v={},y={};for(let I of m??[]){let{sides:b,matchUpFormat:S}=I,w=S&&Ln(S);if((b==null?void 0:b.length)===2&&(n=w.setFormat)!=null&&n.timed&&(!w.finalSetFormat||(a=w.finalSetFormat)!=null&&a.timed))for(let U of b){let T=p(U.participant),D=T==null?void 0:T.participantId,P=(o=U.participant)==null?void 0:o.participantId,E=T==null?void 0:T.participantName,R=U.sideNumber,N=((s=U.participant)==null?void 0:s.individualParticipantIds)||P&&[P]||[];if(N.forEach(A=>{A&&!v[A]&&(v[A]=f(E))}),D&&R){y[D]||(y[D]=f(E));let A=[...N.map(C=>v[C]),y[D]];I.winningSide&&(R===I.winningSide?A.forEach(C=>g(C,"win",1)):A.forEach(C=>g(C,"loss",1)));let M=((l=I.score)==null?void 0:l.sets)||[];for(let C of M){let O=(C==null?void 0:C[`side${3-R}Score`])||0,k=(C==null?void 0:C[`side${R}Score`])||0,x=k-O;A.forEach(F=>g(F,"pointsPlayed",k+O)),A.forEach(F=>g(F,"points",k)),A.forEach(F=>g(F,"diff",x))}}}}for(let I of Object.keys(d)){let[b]=I.split("|");y[b]&&(y[b].bonus+=d[I],y[b].pointsPct=parseFloat((y[b].points/y[b].pointsPlayed).toFixed(2)),y[b].standingPoints=y[b].win+y[b].bonus)}for(let I of Object.keys(v))v[I].pointsPct=parseFloat((v[I].points/v[I].pointsPlayed).toFixed(2));return{...Q,individualResults:v,teamResults:y}}function EEe(t){var e,i,r,n,a,o,s;let l=((i=(e=t.participants)==null?void 0:e.filter(({participantType:p})=>p===Xt))==null?void 0:i.length)===2,u=((r=t.events)==null?void 0:r.length)===1&&t.events[0],c=((n=u==null?void 0:u.drawDefinitions)==null?void 0:n.length)===1&&u.drawDefinitions[0],d=((s=(o=((a=c==null?void 0:c.structures)==null?void 0:a.length)===1&&c.structures[0])==null?void 0:o.positionAssignments)==null?void 0:s.length)===2;return!!(u.tieFormat&&l&&d)}function H_({tournamentRecord:t}){var e;if(!t)return{error:ve};let{drawsAnalysis:i}=jw({tournamentRecord:t}),r={isDual:EEe(t),drawsAnalysis:i},n=Oi({tournamentRecord:t});return(e=n.missingParticipantIds)!=null&&e.length&&(r.missingParticipantIds=n.missingParticipantIds),{...Q,analysis:r}}function lee(t,e){return t&&e&&Array.isArray(e)&&e[t-1]||typeof e=="object"&&e[t]}function CEe(t){let{participation:e={},awardProfiles:i,startDate:r,eventType:n,drawSize:a,drawType:o,category:s,endDate:l,level:u}=t,{participationOrder:c,flightNumber:d,rankingStage:p}=e,m=h=>!r&&!l||!h.dateRanges?!0:h.dateRanges.some(f=>{let g=!r||!f.startDate||new Date(r)>new Date(f.startDate),v=!l||!f.endDate||new Date(l)<=new Date(f.endDate);return g&&v});return{awardProfile:i.find(h=>{var f,g,v,y,I,b,S,w,U,T;return m(h)&&(!h.maxFlightNumber||d<=h.maxFlightNumber)&&(!((f=h.drawTypes)!=null&&f.length)||((g=h.drawTypes)==null?void 0:g.includes(o)))&&(!((v=h.drawSizes)!=null&&v.length)||h.drawSizes.includes(a))&&(!((y=h.stages)!=null&&y.length)||h.stages.includes(p))&&(!((I=h.levels)!=null&&I.length)||h.levels.includes(u))&&(!h.maxDrawSize||a<=h.maxDrawSize)&&(!h.drawSize||h.drawSize===a)&&(!h.maxLevel||u<=h.maxLevel)&&(!d||!((S=(b=h.flights)==null?void 0:b.flightNumbers)!=null&&S.length)||h.flights.flightNumbers.includes(d))&&(!h.participationOrder||h.participationOrder===c)&&(!((w=h.category)!=null&&w.ageCategoryCodes)||h.category.ageCategoryCodes.includes(s==null?void 0:s.ageCategoryCode))&&(!((U=h.eventTypes)!=null&&U.length)||((T=h.eventTypes)==null?void 0:T.includes(n)))})}}function K2({participantWon:t,flightNumber:e,valueObj:i,drawSize:r,flights:n,level:a}){var o,s;let l=(g,v)=>{if(g){if(Array.isArray(v)){let y=v.find(I=>I.flight===g||I.f===g);return y.value||y.v}if(typeof v=="object"){let y=v.flights||v.f;if(Array.isArray(y))return y[g-1]}}},u=(g,v)=>{let y=(g==null?void 0:g.value)||(g==null?void 0:g.v)||(st(g)?g:0),I=lee(a,g==null?void 0:g.level);return{value:l(v,I)||st(I)&&I||y}},c=0,d,p,m,h,f=t&&"won"||t===!1&&"lost"||void 0;if(Array.isArray(i)){let g=i.find(I=>{var b;return I.drawSize===r||((b=I.drawSizes)==null?void 0:b.includes(r))}),v=i.find(I=>I.drawSize&&I.threshold&&r>I.drawSize),y=i.find(I=>{var b;return!I.drawSize&&!((b=I.drawSizes)!=null&&b.length)});f!==void 0&&(g=g==null?void 0:g[f],v=v==null?void 0:v[f],y=y==null?void 0:y[f]),p=u(g,e).value,m=u(v,e).value,h=u(y,e).value,c=p||m||h,d=p&&g.requireWin||m&&v.requireWin||(y==null?void 0:y.requireWin)}else if(typeof i=="object"){let g=(o=i==null?void 0:i.drawSizes)==null?void 0:o[r],v=i;f!==void 0&&(g=g==null?void 0:g[f],v=v==null?void 0:v[f]),p=u(g,e).value,h=u(v,e).value,c=p||h,d=p?g.requireWin:v==null?void 0:v.requireWin}else st(i)&&f===void 0&&(c=i);return e&&(s=n==null?void 0:n.pct)!=null&&s[e]&&(c=Math.round(c*n.pct[e])),{awardPoints:c,requireWin:d}}function RR({participantFilters:t,policyDefinitions:e,tournamentRecord:i,level:r}){var n;if(!i)return{error:ve};let{policyDefinitions:a}=ec({policyTypes:[JU],tournamentRecord:i}),o=(e==null?void 0:e[JU])??(a==null?void 0:a[JU]);if(!o)return{error:sP};let s=o.awardProfiles,l=o.requireWinFirstRound,u=o.requireWinForPoints,{participants:c,derivedEventInfo:d,derivedDrawInfo:p,mappedMatchUps:m}=Oi({withRankingProfile:!0,participantFilters:t,tournamentRecord:i}),h=c==null?void 0:c.filter(y=>{var I;return(I=y.draws)==null?void 0:I.length}),f={},g={},v={};for(let y of h??[]){let{participantType:I,participantId:b,person:S,draws:w}=y;for(let U of w){let{drawId:T,structureParticipation:D,eventId:P}=U,E=d[P],R=p[T],N=R==null?void 0:R.drawType,{category:A,eventType:M}=E||{},C=U.startDate||E.startDate||i.startDate,O=U.endDate||E.endDate||i.endDate;if(M===Ea&&b!==Gn)continue;let k;if(s){let x=u,F=0,$=0,_=0,L;for(let B of D){let{finishingPositionRange:V,participationOrder:G,participantWon:j,flightNumber:z,rankingStage:W,winCount:q}=B;F+=q||0;let Y=R==null?void 0:R.drawSize,{awardProfile:re}=CEe({awardProfiles:s,participation:B,eventType:M,startDate:C,category:A,drawSize:Y,drawType:N,endDate:O,level:r});if(re){if(!Y)continue;let K=Array.isArray(V)&&Math.max(...V),H=dt(V||[]).join("-"),Z=K&&W!==Ke&&(V==null?void 0:V.includes(Y));re.requireWinForPoints!==void 0&&(x=re.requireWinForPoints),re.requireWinFirstRound!==void 0&&(l=re.requireWinFirstRound);let{finishingPositionPoints:X={},finishingPositionRanges:ie,finishingRound:ae,pointsPerWin:le,flights:ne}=re,de=Array.isArray(re.perWinPoints)?(n=re.perWinPoints)==null?void 0:n.find(Pe=>{var it;return(it=Pe.participationOrders)==null?void 0:it.includes(G)}):re.perWinPoints,ye=X.participationOrders,ce=0,ke;if((!ye||ye.includes(G))&&ie&&K){let Pe=ie[K];Pe&&({awardPoints:ce,requireWin:ke}=K2({flightNumber:z,valueObj:Pe,drawSize:Y,flights:ne,level:r}))}if(!ce&&ae&&G===1&&K){let Pe=ae[K];Pe&&({awardPoints:ce,requireWin:ke}=K2({participantWon:j,flightNumber:z,valueObj:Pe,drawSize:Y,flights:ne,level:r}))}if(Z&&l!==void 0&&(x=l),ke!==void 0&&(x=ke),ce>$&&(!x||q)&&($=ce,L=K),!ce&&le&&q&&(_+=q*le,L=H),!ce&&q&&de){let Pe=lee(r,de==null?void 0:de.level);Pe?_+=q*Pe:de.value&&(_+=q*de.value)}}if(k=$+_,I===Gn){let K=(y.matchUps||[]).filter(({structureId:H})=>H===B.structureId);for(let{matchUpId:H}of K){let Z=m[H],X=Z.sides.find(ie=>ie.participantId===b).sideNumber;if(Z.winningSice===X)for(let ie of Z.tieMatchUps)ie.winningSide}}}if(_||$){let B={winCount:F,positionPoints:$,rangeAccessor:L,perWinPoints:_,eventType:M,drawId:T,points:k},V=S==null?void 0:S.personId;V?(f[V]||(f[V]=[]),f[V].push(B)):I===ft?(v[b]||(v[b]=[]),v[b].push(B)):I===Gn&&(g[b]||(g[b]=[]),g[b].push(B))}}}}return{participantsWithOutcomes:h,personPoints:f,pairPoints:v,teamPoints:g,...Q}}var uee={};bt(uee,{compareTieFormats:()=>Bu,getTieFormat:()=>W_,tieFormatGenderValidityCheck:()=>UP,validateCollectionDefinition:()=>tw});function S0(t){var e;if(!t)return{};let i=[],r=t.tieFormatName,n=(e=t.collectionDefinitions)==null?void 0:e.map(a=>{let{matchUpType:o,matchUpFormat:s,matchUpCount:l,category:u,gender:c}=a;i.includes(s)||i.push(s);let d=u==null?void 0:u.ageCategoryCode;return[l,o===Wd?"D":"S",d,s,c].join(";")}).join("|");return{tieFormatName:t&&r||"UNNAMED",matchUpFormats:i,tieFormatDesc:n}}function Bu({considerations:t={},descendant:e,ancestor:i}){var r,n;let a={},o={},{matchUpFormats:s,tieFormatDesc:l}=S0(e),{matchUpFormats:u,tieFormatDesc:c}=S0(i),d=dt((s??[]).filter(U=>!(u??[]).includes(U)).concat((u??[]).filter(U=>!(s??[]).includes(U)))),p=!!(t!=null&&t.collectionName&&e.collectionDefinitions.map(({collectionName:U})=>U).join("|")!==i.collectionDefinitions.map(({collectionName:U})=>U).join("|")),m=!!(t!=null&&t.collectionOrder&&e.collectionDefinitions.map(({collectionOrder:U})=>U).join("|")!==i.collectionDefinitions.map(({collectionOrder:U})=>U).join("|")),h=Object.assign({},...((e==null?void 0:e.collectionDefinitions)||[]).map(U=>({[U.collectionId]:U}))),f=Object.assign({},...((i==null?void 0:i.collectionDefinitions)||[]).map(U=>({[U.collectionId]:U})));a.collectionIds=m2(Object.keys(h),Object.keys(f)),o.collectionIds=m2(Object.keys(f),Object.keys(h)),a.collectionsValue=X2(h),o.collectionsValue=X2(f),a.groupsCount=((r=i==null?void 0:i.collectionGroups)==null?void 0:r.length)??(0-(((n=e==null?void 0:e.collectionGroups)==null?void 0:n.length)??0)||0),o.groupsCount=a.groupsCount?-1*a.groupsCount:0;let g=a.collectionsValue.totalValue-o.collectionsValue.totalValue,v=a.collectionsValue.totalMatchUps-o.collectionsValue.totalMatchUps,y=o.collectionsValue.assignmentValues.length!==a.collectionsValue.assignmentValues.length,I=o.collectionsValue.assignmentValues.some((U,T)=>{let D=a.collectionsValue.assignmentValues[T];return!D||U.valueKey!==D.valueKey||U.value!==D.value?!0:Array.isArray(U.value)?U.value.every((P,E)=>D.value[E]===P):!1}),b=p||m||c!==l||y||I||g!==0,S=[...o.collectionsValue.invalidValues,...a.collectionsValue.invalidValues],w=S.length&&S;return{matchUpFormatDifferences:d,matchUpCountDifference:v,descendantDifferences:a,ancestorDifferences:o,orderDifference:m,valueDifference:g,nameDifference:p,descendantDesc:l,ancestorDesc:c,...Q,different:b,invalid:w}}function X2(t){let e=[],i=[],r=0;return{totalValue:Object.keys(t).sort(eR).reduce((n,a)=>{let o=t[a],{collectionValueProfiles:s,collectionValue:l,matchUpCount:u,matchUpValue:c,scoreValue:d,setValue:p}=o,m={collectionValueProfiles:s,collectionValue:l,matchUpValue:c,scoreValue:d,setValue:p},h=Object.keys(m).filter(g=>![void 0,null].includes(m[g])&&(!Array.isArray(m[g])||m[g].length>0));h.length!==1&&e.push({collectionId:a});let f=h[0];if(f){let g=f==="collectionValueProfiles"?Object.values(s):m[f];i.push({valueKey:f,value:g})}return r+=u,s!=null&&s.length?n+s.reduce((g,v)=>g+v.value,0):u?st(c)?n+c*u:st(d)?n+d*u:st(p)?n+p*u:n+l:n},0),totalMatchUps:r,invalidValues:e,assignmentValues:i}}function z_(t){Object.assign(t,{inContext:!0});let{matchUp:e,error:i}=cee(t);return{matchUp:Ne(e,!0,!0),error:i}}function cee({participantsProfile:t,afterRecoveryTimes:e,tournamentRecord:i,contextContent:r,contextProfile:n,drawDefinition:a,nextMatchUps:o,matchUpId:s,inContext:l,eventId:u,drawId:c,event:d}){var p;if(!i)return{error:ve};if(typeof s!="string")return{error:bn};if(!a||!d){let f=(Hr({tournamentRecord:i,nextMatchUps:o}).matchUps??[]).find(g=>g.matchUpId===s);if(!f)return{error:hn};({eventId:u,drawId:c}=f),{event:d,drawDefinition:a}=Kn({tournamentRecord:i,eventId:u,drawId:c})}if(!a)return{error:Va};n&&!r&&(r=tc({tournamentRecord:i,contextProfile:n}));let m={surfaceCategory:(d==null?void 0:d.surfaceCategory)??i.surfaceCategory,indoorOutDoor:(d==null?void 0:d.indoorOutdoor)??i.indoorOutdoor,endDate:(d==null?void 0:d.endDate)??i.endDate,tournamentId:i.tournamentId,eventId:u??(d==null?void 0:d.eventId),drawId:c},{participants:h=[]}=Rh({participantsProfile:t,tournamentRecord:i,contextProfile:n,inContext:l});if(o){let f=(Pn({context:l?m:void 0,participants:h,afterRecoveryTimes:e,contextContent:r,contextProfile:n,drawDefinition:a,nextMatchUps:o,inContext:l,event:d}).matchUps??[]).find(v=>v.matchUpId===s);if(!f)return{error:hn};let g=(p=a==null?void 0:a.structures)==null?void 0:p.find(v=>v.structureId===f.structureId);return{drawDefinition:a,structure:g,matchUp:f}}else{let{matchUp:f,structure:g}=Si({context:l?m:void 0,tournamentParticipants:h,afterRecoveryTimes:e,contextContent:r,drawDefinition:a,contextProfile:n,matchUpId:s,inContext:l,event:d});return{matchUp:f,structure:g,drawDefinition:a}}}function W_({tournamentRecord:t,drawDefinition:e,structureId:i,matchUpId:r,structure:n,eventId:a,drawId:o,event:s}){var l,u,c,d,p;if(!t)return{error:ve};if(!o&&!s&&!i&&!r)return te({result:{error:Je},stack:"getTieFormat"});a&&!s&&(s=(l=t.events)==null?void 0:l.find(y=>y.eventId===a));let m=z_({tournamentRecord:t,drawDefinition:e,matchUpId:r,drawId:o,event:s});if(r&&m!=null&&m.error)return m;if(!e&&m!=null&&m.drawDefinition&&(e=m==null?void 0:m.drawDefinition),n=n??(m==null?void 0:m.structure),!n&&i&&!r){if(!e)return{error:Fs};let y=tt({drawDefinition:e,structureId:i});if(y.error)return y;n=y.structure}let h=((n==null?void 0:n.tieFormat)||(n==null?void 0:n.tieFormatId))&&((u=In({structure:n,drawDefinition:e,event:s}))==null?void 0:u.tieFormat),f=((e==null?void 0:e.tieFormat)||(e==null?void 0:e.tieFormatId))&&((c=In({drawDefinition:e,event:s}))==null?void 0:c.tieFormat),g=(d=In({event:s}))==null?void 0:d.tieFormat,v=(p=In({matchUp:m==null?void 0:m.matchUp,drawDefinition:e,structure:n,event:s}))==null?void 0:p.tieFormat;return{...Q,matchUp:m==null?void 0:m.matchUp,structureDefaultTieFormat:Yr(h),eventDefaultTieFormat:Yr(g),drawDefaultTieFormat:Yr(f),tieFormat:Yr(v),structure:n}}var dee={};bt(dee,{bulkUpdatePublishedEventIds:()=>q_,getAllEventData:()=>Y_,getCourtInfo:()=>XP,getDrawData:()=>ER,getEventData:()=>CR,getEventPublishStatus:()=>Eo,getPublishState:()=>Fh,getTournamentPublishStatus:()=>Rw,getVenueData:()=>dg});function q_({tournamentRecord:t,outcomes:e}){var i;if(!t)return{error:ve};if(!(e!=null&&e.length))return{error:Je,info:"Missing outcomes"};let r=e.reduce((a,o)=>{let{drawId:s,eventId:l}=o;return l&&s&&(a[l]?a[l].includes(s)||a[l].push(s):a[l]=[s]),a},{}),n=Object.keys(r);return{publishedEventIds:((i=t.events)==null?void 0:i.filter(a=>n.includes(a.eventId))).filter(a=>{let o=Eo({event:a}),{drawDetails:s,drawIds:l}=o??{},{eventId:u}=a;return r[u].filter(c=>{let d=s?Object.keys(o.drawDetails).filter(p=>EL({drawId:p,drawDetails:s})):[];return(l==null?void 0:l.includes(c))||d.includes(c)}).length}).map(a=>a.eventId),eventIdPublishedDrawIdsMap:r}}function pee({dates:t=[],extension:e}){var i;if(!e)return!1;if(typeof e.value=="boolean"&&e.value)return!0;if(!t.length)return!1;let r=At(e.value)?(i=e.value)==null?void 0:i.dates:void 0;if(Array.isArray(r))return r!=null&&r.length?!!r.filter(n=>!t.length||t.includes(n)).length:!1}function mee({convertExtensions:t,ignoreDisabled:e,venue:i,court:r}){var n;let a={...Ne(r,t,!0),venueId:i.venueId},{extension:o}=vt({name:ws,element:r});if(e&&o){let s=At(o.value)?(n=o.value)==null?void 0:n.dates:void 0,l=(o==null?void 0:o.value)===!0?[]:a.dateAvailability.map(u=>{let c=u.date;if(!(!c||s.includes(c)))return u}).filter(Boolean);a.dateAvailability=l}return{inContextCourt:a}}function rc(t){let{convertExtensions:e,ignoreDisabled:i,venueIds:r=[],dates:n}=t,a=t.tournamentRecords||t.tournamentRecord&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord}||{},o=[],s=[],l=[],u=[];return Object.keys(a).filter(c=>!t.tournamentId||c===t.tournamentId).forEach(c=>{let d=a[c];for(let p of d.venues??[])if(!(r.length&&!r.includes(p.venueId))){if(i){let{extension:m}=vt({name:ws,element:p});if(m!=null&&m.value)continue}o.includes(p.venueId)||(u.push(Ne(p,e,!0)),o.push(p.venueId));for(let m of p.courts??[])if(!s.includes(m.courtId)){if(i){let{extension:f}=vt({name:ws,element:m});if(pee({extension:f,dates:n}))continue}let{inContextCourt:h}=mee({convertExtensions:e,ignoreDisabled:i,venue:p,court:m});l.push(h),s.push(m.courtId)}}}),{courts:l,venues:u,...Q}}function MEe({convertExtensions:t,tournamentRecord:e,ignoreDisabled:i,dates:r}){if(!e)return{error:xi};let n=Ne(e.venues??[],t).filter(o=>{if(!i)return o;let{extension:s}=vt({name:ws,element:o});return!(s!=null&&s.value)&&o}).filter(Boolean),a=n.reduce((o,s)=>{let l=((s==null?void 0:s.courts)||[]).filter(u=>{if(!i&&!(r!=null&&r.length))return u;let{extension:c}=vt({name:ws,element:u});return pee({extension:c,dates:r})}).filter(Boolean).map(u=>{let{inContextCourt:c}=mee({convertExtensions:t,ignoreDisabled:i,venue:s,court:u});return c});return l.length?o.concat(l):o},[]);return{venues:n,courts:a}}function Ww({tournamentRecords:t,requireCourts:e,dates:i}){return typeof t!="object"||!Object.keys(t).length?{error:xi}:Object.keys(t).reduce((r,n)=>{let a=t[n],{venues:o}=MEe({tournamentRecord:a,dates:i});return o==null||o.forEach(s=>{let{venueId:l,courts:u}=s;(!e||u!=null&&u.length)&&!r.venueIds.includes(l)&&(r.venues.push(s),r.venueIds.push(l))}),r},{venues:[],venueIds:[]})}function Y_({tournamentRecord:t,policyDefinitions:e}){if(!t)return{error:ve};let i=t.events||[],r=(t==null?void 0:t.participants)||[],{tournamentInfo:n}=jh({tournamentRecord:t}),{venues:a}=rc({tournamentRecord:t}),o=i.map(s=>{let{eventId:l}=s,u=see({event:s}).eventInfo,c=pw({tournamentRecord:t,event:s}).scheduleTiming,d=(s.drawDefinitions||[]).map(m=>{let h=(({drawId:I,drawName:b,matchUpFormat:S,updatedAt:w})=>({matchUpFormat:S,updatedAt:w,drawName:b,drawId:I}))(m),{abandonedMatchUps:f,completedMatchUps:g,upcomingMatchUps:v,pendingMatchUps:y}=wv({requireParticipants:!0,tournamentParticipants:r,context:{eventId:l},policyDefinitions:e,tournamentRecord:t,inContext:!0,scheduleTiming:c,drawDefinition:m,event:s});return{drawInfo:h,matchUps:{abandonedMatchUps:f,completedMatchUps:g,upcomingMatchUps:v,pendingMatchUps:y}}}),p=Eo({event:s});return Object.assign(u,{drawsData:d,publish:p}),u});return{allEventData:{tournamentInfo:n,venuesData:a,eventsData:o}}}function hee({publishStatus:t,drawId:e}){var i,r,n;return t!=null&&t.drawDetails?(n=(r=(i=t.drawDetails)==null?void 0:i[e])==null?void 0:r.publishingDetail)==null?void 0:n.published:t!=null&&t.drawIds?t.drawIds.includes(e):!0}var fee="PUBLIC",NEe="ADMIN",AEe={PUBLIC_DISPLAY:fee,ADMIN_DISPLAY:NEe};function ER(t){var e,i,r;let{tournamentParticipants:n=[],includePositionAssignments:a,policyDefinitions:o,tournamentRecord:s,inContext:l=!0,usePublishState:u,status:c=Qa,pressureRating:d,refreshResults:p,drawDefinition:m,noDeepCopy:h,sortConfig:f,context:g,event:v}=t;if(!m)return{error:$e};let y=(({matchUpFormat:A,updatedAt:M,drawType:C,drawName:O,drawId:k})=>({matchUpFormat:A,updatedAt:M,drawName:O,drawType:C,drawId:k}))(m);y.display=(e=vt({element:m,name:a0}).extension)==null?void 0:e.value;let I={},b,{allStructuresLinked:S,sourceStructureIds:w,hasDrawFeedProfile:U,structureGroups:T}=aR({drawDefinition:m});if(!S)return{error:YK};let D=(t==null?void 0:t.publishStatus)??Eo({event:v,status:c}),P=t.eventPublished??!!((r=(i=Fh({event:v}).publishState)==null?void 0:i.status)!=null&&r.published),E=!1,R=!1,N=T.map(A=>{let M={},C=A.map(O=>{let{structure:k}=tt({drawDefinition:m,structureId:O}),{seedAssignments:x}=go({drawDefinition:m,structure:k});return(k==null?void 0:k.stage)===Ae&&k.stageSequence===1&&(b=x),(k==null?void 0:k.stage)===Ke&&(I[k.stageSequence??0]=x),k}).sort((O,k)=>Ph(O,k,f)).map(O=>{var k,x;if(!O)return;let F=O==null?void 0:O.structureId,$=[];O.stage&&[Ae,an,Bi].includes(O.stage)&&($=b),(O==null?void 0:O.stage)===Ke&&($=I[O.stageSequence??0]);let{matchUps:_,roundMatchUps:L,roundProfile:B}=qt({seedAssignments:(k=O==null?void 0:O.seedAssignments)!=null&&k.length?void 0:$,context:{drawId:y.drawId,...g},tournamentParticipants:n,policyDefinitions:o,tournamentRecord:s,usePublishState:u,publishStatus:D,drawDefinition:m,inContext:l,structure:O,event:v}),{positionAssignments:V}=si({structure:O}),G=V==null?void 0:V.filter(Ma(Xl)).map(q=>{var Y,re;let K=(re=(Y=vt({element:q,name:Oc}))==null?void 0:Y.extension)==null?void 0:re.value,{drawPosition:H,participantId:Z}=q;return R=!0,{participantResult:K,participantId:Z,drawPosition:H}});if(_.length&&(!(G!=null&&G.length)&&t.allParticipantResults||p&&!O.structures)){let{subOrderMap:q}=UQ({positionAssignments:V}),Y=_.some(K=>K.matchUpType===Ba)?_.filter(K=>K.matchUpType===Ba):_,re=Rv({matchUpFormat:O.matchUpFormat,matchUps:Y,policyDefinitions:o,pressureRating:d,subOrderMap:q});G=V==null?void 0:V.filter(Ma(Xl)).map(K=>{var H;let{drawPosition:Z,participantId:X}=K;return R=!0,{participantResult:X&&((H=re==null?void 0:re.participantResults)==null?void 0:H[X]),participantId:X,drawPosition:Z}})}let j=O?(({stageSequence:q,structureName:Y,structureType:re,matchUpFormat:K,stage:H})=>({stageSequence:q,structureName:Y,structureType:re,matchUpFormat:K,stage:H}))(O):{},z=(x=vt({element:O,name:a0}).extension)==null?void 0:x.value;j.display=(z==null?void 0:z[fee])??z,j.sourceStructureIds=w[F],j.hasDrawFeedProfile=U[F],j.positionAssignments=V,j.structureActive=_.reduce((q,Y)=>{var re;let K=[tr,dr,cs,Ki,bl,Pt,zr,Ft].includes(Y.matchUpStatus);return q||K||!!Y.winningSide||!!((re=Y.score)!=null&&re.scoreStringSide1)},!1);let W=_.reduce((q,Y)=>q&&[jt,Ki,zr,Ft,Pt,ua].includes(Y.matchUpStatus),!!_.length);return j.structureCompleted=W,M[F]=W,j.structureActive&&(E=!0),{...j,participantResults:G,seedAssignments:$,roundMatchUps:L,roundProfile:B,structureId:F}});return C.forEach(O=>{var k;a||delete O.positionAssignments,O.sourceStructuresComplete=(k=O.sourceStructureIds)==null?void 0:k.every(x=>M[x])}),C}).flat();return y.drawActive=E,y.participantPlacements=R,y.drawGenerated=N==null?void 0:N.reduce((A,M)=>A||!!(M!=null&&M.roundMatchUps),!1),y.drawCompleted=N==null?void 0:N.reduce((A,M)=>A&&M.structureCompleted,!0),y.drawPublished=u?P&&hee({publishStatus:D,drawId:y.drawId}):void 0,{structures:!u||y.drawPublished?h&&N||Ne(N,!1,!0):void 0,drawInfo:h?y:Ne(y,!1,!0),...Q}}function CR(t){var e,i,r;let{includePositionAssignments:n,participantsProfile:a,policyDefinitions:o,usePublishState:s,status:l=Qa,sortConfig:u}=t,c=We(t,[{tournamentRecord:!0},{[BF]:{event:!1,eventId:!1}}]);if(c.error)return c;let d=Ne(t.tournamentRecord,!1,!0),p=t.event?void 0:Kn({tournamentRecord:d,eventId:t.eventId}).event,m=t.event?Ne(t.event,!1,!0):p&&Ne(p,!1,!0)||void 0;if(!m)return{error:mo};let{eventId:h}=m,{tournamentId:f,endDate:g}=d,v=Eo({event:m,status:l}),y=Fh({event:m}).publishState??{},I=!!((e=y==null?void 0:y.status)!=null&&e.published),{participants:b}=Oi({withGroupings:!0,withEvents:!1,withDraws:!1,policyDefinitions:o,...a,tournamentRecord:d}),S=({stage:M,drawId:C})=>{var O,k,x;if(!s)return!0;let F=(k=(O=v==null?void 0:v.drawDetails)==null?void 0:O[C])==null?void 0:k.stageDetails;return!F||!Object.keys(F).length?!0:(x=F[M])==null?void 0:x.published},w=({structureId:M,drawId:C})=>{var O,k,x;if(!s)return!0;let F=(k=(O=v==null?void 0:v.drawDetails)==null?void 0:O[C])==null?void 0:k.structureDetails;return!F||!Object.keys(F).length?!0:(x=F[M])==null?void 0:x.published},U=({drawId:M})=>s?hee({publishStatus:v,drawId:M}):!0,T=({drawId:M,structure:C})=>{var O,k,x,F;if(!s)return C;let $=(F=(x=(k=(O=v==null?void 0:v.drawDetails)==null?void 0:O[M])==null?void 0:k.structureDetails)==null?void 0:x[C.structureId])==null?void 0:F.roundLimit;if(st($)){let _=Te(1,$+1),L={},B={};for(let V of _)C.roundMatchUps[V]&&(L[V]=C.roundMatchUps[V],B[V]=C.roundProfile[V]);C.roundMatchUps=L,C.roundProfile=B}return C},D=m.drawDefinitions||[],P=!s||I?D.filter(U).map(M=>(({drawInfo:C,structures:O})=>({...C,structures:O}))(ER({allParticipantResults:t.allParticipantResults,context:{eventId:h,tournamentId:f,endDate:g},pressureRating:t.pressureRating,refreshResults:t.refreshResults,includePositionAssignments:n,tournamentParticipants:b,noDeepCopy:!0,policyDefinitions:o,tournamentRecord:d,usePublishState:s,drawDefinition:M,publishStatus:v,sortConfig:u,event:m}))).map(({structures:M,...C})=>{let O=M==null?void 0:M.filter(({stage:k,structureId:x})=>w({structureId:x,drawId:C.drawId})&&S({stage:k,drawId:C.drawId})).map(k=>T({drawId:C.drawId,structure:k}));return{...C,structures:O}}).filter(M=>{var C;return(C=M.structures)==null?void 0:C.length}):void 0,E=(Array.isArray(d.venues)?d.venues:[]).map(M=>(({venueData:C})=>({...C}))(dg({venueId:M.venueId,tournamentRecord:d}))),R=(({eventId:M,eventName:C,eventType:O,eventLevel:k,surfaceCategory:x,matchUpFormat:F,category:$,gender:_,startDate:L,endDate:B,ballType:V,discipline:G})=>({eventId:M,eventName:C,eventType:O,eventLevel:k,surfaceCategory:x,matchUpFormat:F,category:$,gender:_,startDate:L,endDate:B,ballType:V,discipline:G}))(m);R.display=(i=vt({element:m,name:a0}).extension)==null?void 0:i.value;let{tournamentInfo:N}=jh({tournamentRecord:d}),A={tournamentInfo:N,venuesData:E,eventInfo:R,drawsData:P};return A.eventInfo.publishState=y,A.eventInfo.published=(r=y==null?void 0:y.status)==null?void 0:r.published,{...Q,eventData:A,participants:b}}var gee={};bt(gee,{courtGridRows:()=>kR,findVenue:()=>nu,getMatchUpsToSchedule:()=>MR,getPersonRequests:()=>Fp,getProfileRounds:()=>OR,getScheduledRoundsDetails:()=>qw,getSchedulingProfile:()=>nc,getSchedulingProfileIssues:()=>K_,publicFindCourt:()=>DL});function gg({matchUpPotentialParticipantIds:t,matchUpNotBeforeTimes:e,timeAfterRecovery:i,matchUp:r}){var n,a,o,s;let{individualParticipantIds:l}=HP(r);i=i??((n=r.schedule)==null?void 0:n.timeAfterRecovery);let u=m=>{t[m]||(t[m]=[]),t[m]=dt(t[m].concat(...l))},c=m=>{i&&(!e[m]||i>e[m])&&(e[m]=i)},d=((a=r.winnerTo)==null?void 0:a.matchUpId)||r.winnerMatchUpId;d&&(i&&c(d),u(d));let p=((o=r.loserTo)==null?void 0:o.matchUpId)||r.loserMatchUpId;p&&(i&&c(p),u(p)),(s=r.sidesTo)!=null&&s.length&&r.sidesTo.forEach(({matchUpId:m})=>{m&&(i&&c(m),u(m))})}function MR(t){let e=We(t,[{[_F]:!0}]);if(e.error)return e;let{matchUpPotentialParticipantIds:i,dateScheduledMatchUpIds:r=[],scheduleCompletedMatchUps:n,matchUpNotBeforeTimes:a,matchUpScheduleTimes:o,orderedMatchUpIds:s,clearDate:l,matchUps:u}=t,c=o?Object.keys(o):[],d=(s??[]).map(m=>u.find(h=>h.matchUpId===m)).filter(Boolean).filter(m=>{let h=!l&&(r.includes(m.matchUpId)||c.includes(m.matchUpId)),f=[jt,Pt,Ki,ua,zr,Ft,tr,dr].includes(m==null?void 0:m.matchUpStatus);return n||!h&&!m.winningSide&&!f}),p=i&&a?d.reduce((m,h)=>{let{drawId:f,tournamentId:g}=h;return m.matchUpMap[g]||(m.matchUpMap[g]={}),m.matchUpMap[g][f]?m.matchUpMap[g][f].push(h):m.matchUpMap[g][f]=[h],gg({matchUpPotentialParticipantIds:i,matchUpNotBeforeTimes:a,matchUp:h}),m},{matchUpMap:{}}).matchUpMap:{};return{matchUpsToSchedule:d,matchUpMap:p}}function NR({defaultRecoveryMinutes:t=0,defaultAverageMinutes:e,tournamentRecords:i,matchUpFormat:r,categoryName:n,categoryType:a,tournamentId:o,eventType:s,eventId:l}){if(!Ra({matchUpFormat:r}))return{error:Kb};let u=Object.keys(i).filter(d=>!o||d===o),c;return u.forEach(d=>{var p;if(c)return;let m=i[d],h=l?(p=Kn({tournamentRecord:m,eventId:l}))==null?void 0:p.event:void 0;return c=ww({tournamentRecord:m,matchUpFormat:r,categoryName:n,categoryType:a,eventType:s,event:h}),(c==null?void 0:c.averageMinutes)||(c==null?void 0:c.recoveryMinutes)}),{recoveryMinutes:(c==null?void 0:c.recoveryMinutes)||t,averageMinutes:(c==null?void 0:c.averageMinutes)||e,typeChangeRecoveryMinutes:(c==null?void 0:c.typeChangeRecoveryMinutes)||(c==null?void 0:c.recoveryMinutes)||t}}function qw(t){let e=We(t,[{[BF]:{tournamentRecords:!1,tournamentRecord:!1}},{rounds:!0,[Jn]:cn}]);if(e.error)return e;let{scheduleCompletedMatchUps:i,periodLength:r=30}=t,n=t.tournamentRecords||t.tournamentRecord&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord}||{};if(typeof n!="object")return{error:xi};let a={},o=[],s=t.rounds.toSorted((h,f)=>(h.sortOrder??0)-(f.sortOrder??0)),l=t.containedStructureIds??Object.assign({},...Object.values(n).map(h=>yv({tournamentRecord:h}).containedStructures)),u=t.matchUps??Os({nextMatchUps:!0,tournamentRecords:n}).matchUps,c=0,d={},p={},m={};return{scheduledRoundsDetails:s.flatMap(h=>{var f;let g=h.periodLength||r,v=[];l!=null&&l[h.structureId]?v.push(...l[h.structureId]):v.push(h.structureId);let y=u?pu({tournamentIds:[h.tournamentId],roundNumbers:[h.roundNumber],matchUpIds:h.matchUpIds,eventIds:[h.eventId],drawIds:[h.drawId],processContext:!0,structureIds:v,matchUps:u}).sort(xh):[],{segmentNumber:I,segmentsCount:b}=h.roundSegment||{};if(st(I)&&Cs(y==null?void 0:y.length)&&Cs(b)&&I>0&&I<=b&&b<(y==null?void 0:y.length)&&!((f=h.matchUpIds)!=null&&f.length)){let T=y.length/b,D=T*(I-1);y=y.slice(D,D+T)}let S=n[h.tournamentId],w=Kn({drawId:h.drawId,tournamentRecord:S}).event,U=[];for(let T of y){let D=T.matchUpFormat;D&&(a[D]||(a[D]=[],a[D].push(T)),U.push(D))}for(let T of U){let{eventType:D,category:P}=w??{},{categoryName:E,ageCategoryCode:R}=P??{},{typeChangeRecoveryMinutes:N,recoveryMinutes:A,averageMinutes:M,error:C}=NR({categoryName:E??R,categoryType:P==null?void 0:P.categoryType,tournamentId:h.tournamentId,eventId:h.eventId,tournamentRecords:n,matchUpFormat:T,eventType:D});if(C)return{error:C,round:h};let O=y.filter(x=>(i||!yr.includes(x.matchUpStatus))&&x.matchUpStatus!==jt).map(Pr);O.forEach(x=>{m[x]={typeChangeRecoveryMinutes:N,recoveryMinutes:A,averageMinutes:M},d[x]=A,p[x]=M}),o.push(...O),c=Math.max(M||0,c);let k=`${M}|${g}`;return{roundPeriodLength:g,recoveryMinutes:A,averageMinutes:M,matchUpIds:O,hash:k}}}),greatestAverageMinutes:c,matchUpFormatCohorts:a,recoveryMinutesMap:d,averageMinutesMap:p,orderedMatchUpIds:o,minutesMap:m,...Q}}function vee({schedulingProfile:t,venueIds:e,eventIds:i,drawIds:r}){let n=[],a=t==null?void 0:t.map(s=>{let l=mt(s==null?void 0:s.scheduleDate);if(!l){n.push(`Invalid date: ${s==null?void 0:s.scheduledDate}`);return}let u=((s==null?void 0:s.venues)||[]).map(c=>{let{rounds:d,venueId:p}=c;if(!(e!=null&&e.includes(p))){n.push(`Missing venueId: ${p}`);return}let m=d.filter(h=>{let f=i.includes(h.eventId)&&r.includes(h.drawId);return f||n.push(`Invalid eventId: ${h.eventId} or drawId: ${h.drawId}`),f});if(m.length)return{venueId:p,rounds:m}}).filter(Boolean);return u.length&&l&&{...s,venues:u}}).filter(Boolean),o=n.length;return{updatedSchedulingProfile:a,modifications:o,issues:n}}function AR({tournamentRecords:t,schedulingProfile:e}){if(!e)return{valid:!0};if(!Array.isArray(e))return{valid:!1,error:se};let{venueIds:i,tournamentsMap:r}=kEe({tournamentRecords:t}),n,a,o=e.every(s=>{let{scheduleDate:l,venues:u}=s;return ba(l)?u.every(c=>{let{venueId:d,rounds:p}=c;return typeof d!="string"?(a="venueId should be a string",!1):Array.isArray(p)?i.includes(d)?!!p.every(m=>{var h,f,g,v;if(!m)return a="empty round",!1;let{roundSegment:y,tournamentId:I,structureId:b,roundNumber:S,eventId:w,drawId:U}=m,T=(v=(g=(f=(h=r==null?void 0:r[I])==null?void 0:h[w])==null?void 0:f[U])==null?void 0:g[b])==null?void 0:v.includes(S);T||(a="Invalid rounds");let{segmentNumber:D,segmentsCount:P}=y||{},E=!y||st(D)&&Cs(P)&&D<=P;return E||(a="Invalid segment"),T&&E}):(n=bh,!1):(a="rounds should be an array",!1)}):!1});return!o&&!n&&(n=se),{valid:!!o,error:n,info:a}}function OEe(t){let{tournamentRecord:e={},tournamentMap:i={},requireCourts:r}=t,n=[],a=[],o=[],s=[],l=((e==null?void 0:e.venues)||[]).map(({venueId:c,courts:d})=>(!r||(d==null?void 0:d.length))&&c),u=e==null?void 0:e.tournamentId;return u&&(n.push(u),i[u]={},((e==null?void 0:e.events)||[]).forEach(c=>{let d=c.eventId;o.push(d),i[u][d]={},(c.drawDefinitions||[]).forEach(p=>{let m=p.drawId;s.push(m),i[u][d][m]={};let{structures:h}=ns({drawDefinition:p});(h||[]).forEach(f=>{var g;let v=f.structureId,{matchUps:y}=qt({structure:f}),{roundMatchUps:I}=An({matchUps:y}),b=I&&Object.keys(I).map(S=>parseInt(S));i[u][d][m][v]=b,a.push(v),(g=f.structures)!=null&&g.length&&f.structures.forEach(S=>{a.push(S.structureId),i[u][d][m][S.structureId]=b})})})})),{tournamentMap:i,tournamentIds:n,structureIds:a,venueIds:l,eventIds:o,drawIds:s}}function kEe(t){let e=(t==null?void 0:t.tournamentRecords)&&Object.values(t==null?void 0:t.tournamentRecords)||[],i={},{venueIds:r,eventIds:n,drawIds:a,structureIds:o,tournamentIds:s}=e.reduce((l,u)=>{let{tournamentIds:c,tournamentMap:d,structureIds:p,venueIds:m,eventIds:h,drawIds:f}=OEe({tournamentRecord:u});return m.forEach(g=>{l.venueIds.includes(g)||l.venueIds.push(g)}),l.tournamentIds.push(...c),l.structureIds.push(...p),l.eventIds.push(...h),l.drawIds.push(...f),Object.assign(i,d),l},{tournamentIds:[],structureIds:[],venueIds:[],eventIds:[],drawIds:[]});return{tournamentsMap:i,tournamentIds:s,structureIds:o,venueIds:r,eventIds:n,drawIds:a}}function nc({tournamentRecords:t,tournamentRecord:e}){if(typeof t!="object"||!Object.keys(t).length)return{error:xi};let{extension:i}=vt({element:e,name:Fm,tournamentRecords:t,discover:!0}),r=(i==null?void 0:i.value)||[];if(r.length){let{venueIds:n}=Ww({requireCourts:!0,tournamentRecords:t}),{eventIds:a,drawIds:o}=s_({tournamentRecords:t}),{updatedSchedulingProfile:s,modifications:l,issues:u}=vee({schedulingProfile:r,venueIds:n,eventIds:a,drawIds:o});if(l){r=s;let c=Ev({tournamentRecords:t,tournamentRecord:e,schedulingProfile:r});return c.error?c:{schedulingProfile:r,modifications:l,issues:u}}}return{schedulingProfile:r,modifications:0}}function Ev({tournamentRecords:t,tournamentRecord:e,schedulingProfile:i}){let r=AR({tournamentRecords:t,schedulingProfile:i});return r.error?r:i?_t({tournamentRecords:t,discover:!0,extension:{name:Fm,value:i}}):Dn({element:e,name:Fm,tournamentRecords:t,discover:!0})}function Yw(t){let{tournamentRecord:e}=t,i=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(!t.schedulingProfile){let{modifications:u,issues:c}=nc({tournamentRecords:i,tournamentRecord:e});return{success:!u,modifications:u,issues:c}}let{venueIds:r}=Ww({tournamentRecords:i}),{eventIds:n,drawIds:a}=s_({tournamentRecords:i}),{updatedSchedulingProfile:o,modifications:s,issues:l}=vee({schedulingProfile:t.schedulingProfile,venueIds:r,eventIds:n,drawIds:a});return s?{...Ev({schedulingProfile:o,tournamentRecords:i}),modifications:s,issues:l}:{...Q,modifications:s,issues:l}}function K_(t){let{scheduleDates:e=[],tournamentRecords:i,periodLength:r=30}=t??{};if(typeof i!="object")return{error:Wb};if(!Array.isArray(e))return{error:se};if(!e.every(ba))return{error:Fr};let n=[],a=0,o={},{schedulingProfile:s}=nc({tournamentRecords:i});if(!s)return{issues:n,...Q};let{matchUps:l}=Os({nextMatchUps:!0,tournamentRecords:i});for(let c of s){let{scheduleDate:d,venues:p=[]}=c;if(!(e!=null&&e.length)||e.includes(d)){for(let m of p||[])if(m){let{rounds:h}=m,f=[],{orderedMatchUpIds:g,scheduledRoundsDetails:v}=qw({tournamentRecords:i,periodLength:r,matchUps:l,rounds:h}),{matchUpDependencies:y}=ps({tournamentRecords:i,matchUps:l}),I=b=>{let S;return v==null||v.find((w,U)=>{let T=w.matchUpIds.includes(b);return T&&(S=U),T}),S};if(g==null||g.forEach((b,S)=>{var w;let U=g.slice(S+1),T=ji(U,((w=y==null?void 0:y[b])==null?void 0:w.matchUpIds)||[]);T.length&&f.push({matchUpId:b,shouldBeAfter:T})}),f.length){a+=f.length;let b=f.map(({matchUpId:S,shouldBeAfter:w})=>{let U=I(S),T=dt(w.map(I));return o[d]||(o[d]={}),o[d][U]||(o[d][U]=[]),T.forEach(D=>{o[d][U].includes(D)||o[d][U].push(D)}),{matchUpId:S,matchUpRoundIndex:U,earlierRoundIndices:T,shouldBeAfter:w}});n.push(...b)}}}}let u={matchUpIdShouldBeAfter:Object.assign({},...n.map(c=>{let{matchUpId:d,shouldBeAfter:p,earlierRoundIndices:m}=c;return{[d]:{earlierRoundIndices:m,shouldBeAfter:p}}}))};return{issuesCount:a,profileIssues:u,roundIndexShouldBeAfter:o,...Q}}function Fp(t){let{tournamentRecords:e,requestType:i}=t,r=We(t,[{[fn]:!0}]);if(r.error)return r;let n={};for(let a of Object.values(e)){let{extension:o}=vt({element:a,name:vv}),s=(o==null?void 0:o.value)||[];for(let l of s){let{personId:u,requests:c}=l||{};n[u]||(n[u]=[]);for(let d of c)i&&d.requestType!==i||n[u].push(d)}}return{personRequests:n,...Q}}function qM(t){let{containerStructureId:e,roundSegment:i,isRoundRobin:r,tournamentId:n,roundNumber:a,structureId:o,eventId:s,drawId:l}=t,u=r?e:o,c=[n,s,l,u,a].join("|");return He({structureId:u,roundSegment:i,tournamentId:n,roundNumber:a,eventId:s,drawId:l,id:c})}function J2({round:t,matchUps:e,events:i,tournamentRecords:r}){let n=i.find(p=>p.eventId===t.eventId),{eventType:a,category:o,categoryType:s}=n||{},{categoryName:l,ageCategoryCode:u}=o||{},c=Pa(e.map(({matchUpFormat:p})=>p)),d=0;return Object.keys(c).forEach(p=>{let m=c[p],h=NR({categoryName:l||u,tournamentId:t.tournamentId,eventId:t.eventId,tournamentRecords:r,matchUpFormat:p,categoryType:s,eventType:a});if(h.error)return h;let f=h.averageMinutes*m;isNaN(d)||(d+=f)}),{roundMinutes:d}}function xEe(t){return(t||[]).reduce((e,i)=>{var r,n;let a=(((r=i.finishingPositionRange)==null?void 0:r.winner)||[]).reduce((s,l)=>s+l,0),o=(((n=i.finishingPositionRange)==null?void 0:n.winner)||[]).join("-")||"";return!e.minFinishingSum||a<e.minFinishingSum?{minFinishingSum:a,winnerFinishingPositionRange:o}:e},{minFinishingSum:0,winnerFinishingPositionRange:""})}function Q2(t){let e=t.length,i=t.filter(({sides:u})=>u==null?void 0:u.some(({bye:c})=>c)).length||0,r=t.filter(({winningSide:u,matchUpStatus:c})=>u||yr.includes(c)).length||0,n=t.filter(({schedule:u,matchUpStatus:c})=>(u==null?void 0:u.scheduledDate)&&(u==null?void 0:u.scheduledTime)&&c!==jt).length||0,a=e-i,o=a===r,s=a-n,l=a-n;return{unscheduledCount:s,incompleteCount:l,scheduledCount:n,completedCount:r,matchUpsCount:e,isScheduled:a===n,isComplete:o,byeCount:i}}function OR({tournamentRecords:t,schedulingProfile:e,tournamentRecord:i,withRoundId:r}){if(i&&!t){if(typeof i!="object")return{error:Wb};t={[i.tournamentId]:i}}if(e){let a=AR({tournamentRecords:t,schedulingProfile:e});if(a.error)return a}if(!e&&t){let a=nc({tournamentRecords:t});if(a.error)return a;e=a.schedulingProfile}if(!e)return{error:jr};let n={};return{profileRounds:e.map(({venues:a,scheduleDate:o})=>a.map(({rounds:s})=>s.map(l=>{var u;let c=qM(l);return(u=c.roundSegment)!=null&&u.segmentsCount&&(n[c.id]=c.roundSegment.segmentsCount),He({id:r?c.id:void 0,scheduleDate:o,...c})}))).flat(1/0),segmentedRounds:n}}function kR({courtPrefix:t="C|",minRowsCount:e,courtsData:i}){if(!Array.isArray(i))return{error:se};let r=i==null?void 0:i.reduce((o,s)=>{let l=s.matchUps||[],u=Math.max(0,...l.map(c=>c.schedule.courtOrder||0));return u>o?u:o},1),n=e?Math.max(e,r):r,a=Te(0,n).map(o=>({matchUps:Te(0,i.length).map(s=>{let l=i[s],{courtId:u,venueId:c}=l;return{schedule:{courtOrder:o+1,venueId:c,courtId:u}}})}));return i.forEach((o,s)=>{var l;for(let u of o.matchUps){let c=(l=u.schedule)==null?void 0:l.courtOrder;c&&(a[c-1].matchUps[s]=u)}}),{courtPrefix:t,rows:a.map((o,s)=>Object.assign({rowId:`rowId-${s+1}`},...o.matchUps.map((l,u)=>({[`${t}${u}`]:l}))))}}var Iee={};bt(Iee,{getEntriesAndSeedsCount:()=>xR,getMaxEntryPosition:()=>X_});function xR({policyDefinitions:t,drawDefinition:e,drawSize:i,drawId:r,event:n,stage:a}){if(!n)return{error:vi};let{entries:o,stageEntries:s}=TJ({drawDefinition:e,drawId:r,stage:a,event:n}),l=s.length,{drawSize:u}=KQ({participantsCount:l}),c=Hw({drawSize:i??u,participantsCount:l,policyDefinitions:t});if(c.error)return te({result:c,stack:"getEntriesAndSeedsCount"});let{seedsCount:d}=c;return{entries:o,seedsCount:d,stageEntries:s}}function X_(t){let{entries:e=[],entryStatus:i,stage:r}=t;return Math.max(...e.filter(n=>(!r||r===n.entryStage)&&(!i||n.entryStatus===i)&&!isNaN(n.entryPosition)).map(({entryPosition:n})=>Ze(n||0)),0)}var yee={};bt(yee,{allCompetitionMatchUps:()=>Os,allDrawMatchUps:()=>Pn,allEventMatchUps:()=>au,allTournamentMatchUps:()=>Hr,analyzeMatchUp:()=>yy,calculateWinCriteria:()=>Gh,checkMatchUpIsComplete:()=>Cd,competitionScheduleMatchUps:()=>Xw,drawMatchUps:()=>s$,eventMatchUps:()=>LR,filterMatchUps:()=>pu,getAllDrawMatchUps:()=>fr,getAllStructureMatchUps:()=>qt,getCheckedInParticipantIds:()=>Ah,getCompetitionMatchUps:()=>Iy,getEventMatchUpFormatTiming:()=>Q_,getHomeParticipantId:()=>i$,getMatchUpCompetitiveProfile:()=>bw,getMatchUpContextIds:()=>r$,getMatchUpDailyLimits:()=>$R,getMatchUpDailyLimitsUpdate:()=>Z_,getMatchUpDependencies:()=>ps,getMatchUpFormat:()=>n$,getMatchUpFormatTiming:()=>ww,getMatchUpFormatTimingUpdate:()=>J_,getMatchUpScheduleDetails:()=>JP,getMatchUpType:()=>QP,getMatchUpsStats:()=>a$,getModifiedMatchUpFormatTiming:()=>FR,getParticipantResults:()=>_w,getPredictiveAccuracy:()=>t$,getRoundMatchUps:()=>An,getRounds:()=>o$,isValidMatchUpFormat:()=>Ra,matchUpActions:()=>hR,participantScheduledMatchUps:()=>e$,tallyParticipantResults:()=>Rv,tournamentMatchUps:()=>_R,validMatchUp:()=>WP,validMatchUps:()=>Ro});function bee({tournamentRecords:t,extensionName:e}){if(typeof t!="object"||!Object.keys(t).length)return{error:xi};let i=[],r;for(let n of Object.values(t)){let{extension:a}=vt({element:n,name:e});a&&!r&&(i.push({params:{extension:a,discover:!0},method:"addExtension"}),r=!0);let o=n.events??[];for(let s of o){let{eventId:l}=s,{extension:u}=vt({name:e,element:s});u&&i.push({params:{eventId:l,extension:u},method:"addEventExtension"})}}return{methods:i}}function J_({tournamentRecords:t}){return bee({extensionName:Lu,tournamentRecords:t})}var JE="ADULT",QE="JUNIOR",IU="WHEELCHAIR",wee={[td]:{allowModificationWhenMatchUpsScheduled:{courts:!1,venues:!1},defaultTimes:{averageTimes:[{categoryNames:[],minutes:{default:90}}],recoveryTimes:[{minutes:{[ei]:30,default:60}}]},defaultDailyLimits:{[ii]:2,[ei]:2,total:3},matchUpAverageTimes:[{matchUpFormatCodes:[zo],averageTimes:[{categoryNames:[],minutes:{default:90}},{categoryTypes:[IU],minutes:{default:120}}]},{matchUpFormatCodes:["SET3-S:6/TB7-F:TB10"],averageTimes:[{categoryNames:[],minutes:{default:85}}]},{matchUpFormatCodes:["SET3-S:6/TB7-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:70}}]},{matchUpFormatCodes:["SET3-S:4NOAD-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:55}}]},{matchUpFormatCodes:["SET3-S:4/TB7"],averageTimes:[{categoryNames:[],minutes:{default:60}}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:50}}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB10"],averageTimes:[{categoryNames:[],minutes:{default:55}}]},{matchUpFormatCodes:["SET3-S:4/TB5@3"],averageTimes:[{categoryNames:[],minutes:{default:45}}]},{matchUpFormatCodes:["SET1-S:8/TB7","SET1-S:8/TB7@7"],averageTimes:[{categoryNames:[],minutes:{default:40}}]},{matchUpFormatCodes:["SET1-S:5/TB9@4"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:6/TB7"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:6NOAD"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:4/TB7","SET1-S:4/TB5@3","SET3-S:TB10","SET1-S:T20"],averageTimes:[{categoryNames:[],minutes:{default:20}}]},{matchUpFormatCodes:["SET1-S:4NOAD"],averageTimes:[{categoryNames:[],minutes:{default:20}}]},{matchUpFormatCodes:["SET1-S:TB10"],averageTimes:[{categoryNames:[],minutes:{default:10}}]}],matchUpRecoveryTimes:[{matchUpFormatCodes:["SET3-S:6/TB7","SET3-S:6/TB7-F:TB10","SET3-S:6/TB7-F:TB7"],recoveryTimes:[{categoryTypes:[JE,IU],minutes:{default:60,[ei]:30}},{categoryTypes:[QE],minutes:{default:60,[ei]:60}}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB7","SET3-S:4/TB7-F:TB10","SET3-S:4NOAD-F:TB7","SET3-S:4/TB7","SET3-S:4/TB5@3"],recoveryTimes:[{categoryTypes:[JE,IU],minutes:{default:30}},{categoryTypes:[QE],minutes:{default:60}}]},{matchUpFormatCodes:["SET1-S:8/TB7","SET1-S:8/TB7@7","SET1-S:5/TB9@4","SET1-S:6/TB7","SET1-S:6NOAD","SET1-S:4/TB7","SET1-S:4NOAD","SET3-S:TB10","SET1-S:T20"],recoveryTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:4/TB5@3"],recoveryTimes:[{categoryTypes:[JE,QE],minutes:{default:30}},{categoryTypes:[IU],minutes:{default:15}}]},{matchUpFormatCodes:["SET1-S:TB10"],recoveryTimes:[{categoryNames:[],minutes:{default:15}}]}],matchUpDailyLimits:[]}},FEe=wee;function Q_({tournamentRecord:t,matchUpFormats:e,categoryType:i,event:r}){if(!r)return{error:vi};let n=[],a;if(e!=null&&e.length){let d=[];n=e.map(p=>{let m=typeof p=="string"?{matchUpFormat:p}:p;if(!d.includes(m==null?void 0:m.matchUpFormat)&&Ra({matchUpFormat:m==null?void 0:m.matchUpFormat}))return d.push(m.matchUpFormat),m}).filter(Boolean)}else{let{policy:d}=Cp({policyType:fo,tournamentRecord:t,event:r});if(d!=null&&d.matchUpFormats)n=d==null?void 0:d.matchUpFormats;else{let{extension:p}=vt({name:Lu,element:r}),m,h;p!=null&&p.value?{matchUpAverageTimes:m,matchUpRecoveryTimes:h}=p.value:{matchUpAverageTimes:m,matchUpRecoveryTimes:h}=FEe[td],n=dt([...(m||[]).map(f=>f.matchUpFormatCodes),...(h||[]).map(f=>f.matchUpFormatCodes)].flat()).map(f=>({matchUpFormat:f})),a="default scheduling policy in use"}}let{eventType:o,eventId:s,category:l}=r,u=(l==null?void 0:l.categoryName)??(l==null?void 0:l.ageCategoryCode)??s;if(!s)return{error:vi};let c=n.map(({matchUpFormat:d,description:p})=>{let m=ww({tournamentRecord:t,matchUpFormat:d,categoryName:u,categoryType:i,eventType:o,event:r});return{matchUpFormat:d,description:p,...m}});return He({eventMatchUpFormatTiming:c,info:a})}function FR(t){let e=We(t,[{[Ur]:!0},{[Xr]:f=>Ra({matchUpFormat:f}),[Ha]:Kb,[xF]:!0}]);if(e.error)return e;let{tournamentRecord:i,matchUpFormat:r,event:n}=t,{extension:a}=vt({name:Lu,element:n}),o=a==null?void 0:a.value,{extension:s}=vt({element:i,name:Lu}),l=s==null?void 0:s.value,u=(o==null?void 0:o.matchUpAverageTimes)&&aI({...o,matchUpFormat:r}),c=(l==null?void 0:l.matchUpAverageTimes)&&aI({...l,matchUpFormat:r}),d=[u,c].find(f=>f),p=(o==null?void 0:o.matchUpRecoveryTimes)&&oI({...o,matchUpFormat:r}),m=(l==null?void 0:l.matchUpRecoveryTimes)&&oI({...l,matchUpFormat:r}),h=[p,m].find(f=>f);return{matchUpFormat:r,recoveryTimes:h,averageTimes:d}}function Z_({tournamentRecords:t}){return bee({extensionName:sw,tournamentRecords:t})}var Kw=({scheduleAttributes:t=["scheduledDate","scheduledTime"],schedule:e={}})=>!!Object.keys(e).filter(i=>t.includes(i)).filter(i=>e[i]).length;function e$({scheduleAttributes:t=["scheduledDate","scheduledTime"],matchUps:e=[]}){if(!Ro(e))return{error:Ju};if(!Array.isArray(t))return{error:se};let i=e.filter(Boolean).filter(({schedule:r})=>Kw({schedule:r,scheduleAttributes:t})).reduce((r,n)=>{let{schedule:a}=n,o=mt(a==null?void 0:a.scheduledDate),s=Ui(a==null?void 0:a.scheduledTime);return o&&s&&(r[o]?r[o].push(n):r[o]=[n]),r},{});return Object.keys(i).forEach(r=>{i[r].sort((n,a)=>{var o,s;return a8(Ui((o=n.schedule)==null?void 0:o.scheduledTime),Ui((s=a.schedule)==null?void 0:s.scheduledTime))})}),{...Q,scheduledMatchUps:i}}function LEe({tournamentRecords:t}){var e;let i={},r=[];for(let n of Object.values(t))for(let a of n.events??[]){let o=Eo({event:a}),s=o==null?void 0:o.drawDetails;At(s)?(Object.assign(i,s),r.push(...Object.keys(s).filter(l=>EL({drawId:l,drawDetails:s})))):(e=o==null?void 0:o.drawIds)!=null&&e.length&&r.push(...o.drawIds)}return{drawIds:r,detailsMap:i}}function T0({schedulingProfile:t,matchUps:e=[]}){let i={},r=({eventId:s,drawId:l,structureId:u,roundNumber:c})=>`${s}|${l}|${u}${c}`;t!=null&&t.length&&t.map(({venues:s})=>s.map(({rounds:l})=>l)).flat().forEach(s=>{s.sort((l,u)=>(l.sortOrder||0)-(u.sortOrder||0)).forEach(({eventId:l,drawId:u,structureId:c,roundNumber:d},p)=>{let m=r({eventId:l,drawId:u,structureId:c,roundNumber:d});i[m]=p})});let n=[],a={noScheduledDate:[]};for(let s of e){let l=s.schedule||{},u=l.scheduledDate&&mt(l.scheduledDate)||l.scheduledTime&&mt(l.scheduledTime)||"noScheduledDate";a[u]||(a[u]=[]),a[u].push(s)}let o=Object.keys(a).sort();for(let s of o){let l=a[s],u={noScheduledTime:[]};for(let d of l){let p=d.schedule||{},m=p.scheduledTime&&Ui(p.scheduledTime)||"noScheduledTime";u[m]||(u[m]=[]),u[m].push(d)}let c=Object.keys(u).sort();for(let d of c){let p=u[d];p.sort((m,h)=>{let f=i[r(m)]||0,g=i[r(h)]||0;return f-g}),n.push(...p)}}return n}function LR(t){let{participants:e,contextContent:i,participantMap:r}=t,{tournamentAppliedPolicies:n,scheduleVisibilityFilters:a,participantsProfile:o,afterRecoveryTimes:s,policyDefinitions:l,useParticipantMap:u,tournamentRecord:c,usePublishState:d,contextFilters:p,matchUpFilters:m,contextProfile:h,nextMatchUps:f,tournamentId:g,inContext:v,context:y,event:I}=t;if(!I)return{error:vi};let{eventId:b,eventName:S,endDate:w,eventType:U,category:T,gender:D}=I??{},P={...y,...He({surfaceCategory:I.surfaceCategory??(c==null?void 0:c.surfaceCategory),indoorOutDoor:I.indoorOutdoor??(c==null?void 0:c.indoorOutdoor),tournamentId:g??(c==null?void 0:c.tournamentId),endDate:w??(c==null?void 0:c.endDate),eventName:S,eventType:U,category:T,eventId:b,gender:D})},E;!e&&c&&({participants:e,participantMap:r,groupInfo:E}=Rh({participantsProfile:o,policyDefinitions:l,useParticipantMap:u,tournamentRecord:c,contextProfile:h,inContext:v})),h&&!i&&(i=tc({policyDefinitions:l,tournamentRecord:c,contextProfile:h,event:I}));let R=Eo({event:I});return{...(I.drawDefinitions??[]).reduce((N,A)=>{var M;let C=wv({hydrateParticipants:t.hydrateParticipants,context:P,tournamentAppliedPolicies:n,scheduleVisibilityFilters:a,tournamentParticipants:e,participantsProfile:o,afterRecoveryTimes:s,policyDefinitions:l,tournamentRecord:c,usePublishState:d,contextContent:i,contextFilters:p,matchUpFilters:m,participantMap:r,publishStatus:R,contextProfile:h,drawDefinition:A,nextMatchUps:f,inContext:v,event:I});return(M=Object.keys(C))==null||M.forEach(O=>{Array.isArray(C[O])&&(N[O]||(N[O]=[]),N[O]=N[O].concat(C[O]))}),N},{}),...Q,groupInfo:E}}function _R(t){if(!(t!=null&&t.tournamentRecord))return{error:ve};let e=t.contextContent,{scheduleVisibilityFilters:i,participantsProfile:r,afterRecoveryTimes:n,policyDefinitions:a,useParticipantMap:o,tournamentRecord:s,inContext:l=!0,usePublishState:u,contextFilters:c,matchUpFilters:d,contextProfile:p,nextMatchUps:m,context:h}=t,f=t.tournamentId??s.tournamentId,g=(s==null?void 0:s.events)??[],{participants:v,participantMap:y,groupInfo:I}=Rh({participantsProfile:r,policyDefinitions:a,useParticipantMap:o,tournamentRecord:s,contextProfile:p,inContext:l});p&&!e&&(e=tc({policyDefinitions:a,tournamentRecord:s,contextProfile:p}));let{appliedPolicies:b}=Bt({tournamentRecord:s}),S=(c==null?void 0:c.eventIds)??[];return{...g.filter(w=>!S.includes(w.eventId)).map(w=>{var U,T,D;let P={eventDrawsCount:((T=(U=Hi({event:w}).flightProfile)==null?void 0:U.flights)==null?void 0:T.length)||((D=w.drawDefinitions)==null?void 0:D.length)||0,...h};return LR({hydrateParticipants:t.hydrateParticipants,context:P,tournamentAppliedPolicies:b,scheduleVisibilityFilters:i,participantsProfile:r,afterRecoveryTimes:n,policyDefinitions:a,tournamentRecord:s,usePublishState:u,contextFilters:c,contextProfile:p,contextContent:e,matchUpFilters:d,participantMap:y,participants:v,tournamentId:f,nextMatchUps:m,inContext:l,event:w})}).reduce((w,U)=>{var T;return(T=U&&Object.keys(U).filter(D=>!["success","matchUpsMap"].includes(D)))==null||T.forEach(D=>{Array.isArray(U[D])&&(w[D]||(w[D]=[]),w[D]=w[D].concat(U[D]),w.matchUpsCount+=U[D].length)}),w},{matchUpsCount:0}),groupInfo:I}}function Iy({scheduleVisibilityFilters:t,hydrateParticipants:e,participantsProfile:i,tournamentRecords:r,policyDefinitions:n,usePublishState:a,matchUpFilters:o,contextFilters:s,nextMatchUps:l,inContext:u}){if(typeof r!="object"||!Object.keys(r).length)return{error:xi};let c=Object.keys(r).map(p=>{let m=r[p];return _R({scheduleVisibilityFilters:t,hydrateParticipants:e,participantsProfile:i,policyDefinitions:n,tournamentRecord:m,usePublishState:a,matchUpFilters:o,contextFilters:s,nextMatchUps:l,inContext:u})}),d={};return{...c.reduce((p,m)=>(Object.keys(m).forEach(h=>{Array.isArray(m[h])&&(p[h]||(p[h]=[]),p[h]=p[h].concat(m[h])),h==="groupInfo"&&Object.assign(d,m[h])}),p),{}),groupInfo:d}}function Xw(t){var e,i,r,n,a,o,s;if(typeof(t==null?void 0:t.tournamentRecords)!="object"||!Object.keys(t==null?void 0:t.tournamentRecords).length)return{error:xi};let{courts:l,venues:u}=rc(t),c=nc(t).schedulingProfile,{sortDateMatchUps:d=!0,courtCompletedMatchUps:p,alwaysReturnCompleted:m,activeTournamentId:h,tournamentRecords:f,withCourtGridRows:g,minCourtGridRows:v,usePublishState:y,status:I=Qa,sortCourtsData:b}=t,S=h??wh()??Object.keys(f)[0],w=y?Rw({tournamentRecord:f[S],status:I}):void 0,U=m?Iy({...t,matchUpFilters:{...t.matchUpFilters,matchUpStatuses:[Ki]},contextFilters:t.contextFilters}).completedMatchUps:[];if(y&&!((e=w==null?void 0:w.orderOfPlay)!=null&&e.published))return{completedMatchUps:U,dateMatchUps:[],courtsData:[],venues:u};let T,D;y&&({drawIds:T,detailsMap:D}=LEe({tournamentRecords:f})),T!=null&&T.length&&(t.contextFilters||(t.contextFilters={}),(i=t.contextFilters)!=null&&i.drawIds?t.contextFilters.drawIds=t.contextFilters.drawIds.filter(x=>T.includes(x)):t.contextFilters.drawIds=T),(r=w==null?void 0:w.eventIds)!=null&&r.length&&(t.matchUpFilters||(t.matchUpFilters={}),(n=t.matchUpFilters)!=null&&n.eventIds&&t.matchUpFilters.eventIds.length?t.matchUpFilters.eventIds=t.matchUpFilters.eventIds.filter(x=>w.eventIds.includes(x)):t.matchUpFilters.eventIds=w.eventIds),(a=w==null?void 0:w.scheduledDates)!=null&&a.length&&(t.matchUpFilters||(t.matchUpFilters={}),t.matchUpFilters.scheduledDates&&t.matchUpFilters.scheduledDates.length?t.matchUpFilters.scheduledDates=t.matchUpFilters.scheduledDates.filter(x=>w.scheduledDates.includes(x)):t.matchUpFilters.scheduledDates=w.scheduledDates),m&&(t.matchUpFilters||(t.matchUpFilters={}),(s=(o=t.matchUpFilters)==null?void 0:o.excludeMatchUpStatuses)!=null&&s.length?t.matchUpFilters.excludeMatchUpStatuses.includes(Ki)||t.matchUpFilters.excludeMatchUpStatuses.push(Ki):t.matchUpFilters.excludeMatchUpStatuses=[Ki]);let{completedMatchUps:P,upcomingMatchUps:E,pendingMatchUps:R,groupInfo:N}=Iy({...t,matchUpFilters:t.matchUpFilters,contextFilters:t.contextFilters}),A=[...E??[],...R??[]];D&&(!(T!=null&&T.length)||Object.keys(D).length)&&(A=A.filter(x=>{var F,$;let{drawId:_,structureId:L,stage:B}=x;if(!(($=(F=D==null?void 0:D[_])==null?void 0:F.publishingDetail)!=null&&$.published))return!1;if(D[_].stageDetails){let V=Object.keys(D[_].stageDetails),G=V.filter(z=>!D[_].stageDetails[z].published),j=V.filter(z=>D[_].stageDetails[z].published);return G.length&&G.includes(B)?!1:j.length&&j.includes(B)?!0:G.length&&!G.includes(B)&&!j.length}if(D[_].structureDetails){let V=Object.keys(D[_].structureDetails),G=V.filter(z=>!D[_].structureDetails[z].published),j=V.filter(z=>D[_].structureDetails[z].published);return G.length&&G.includes(L)?!1:j.length&&j.includes(L)?!0:G.length&&!G.includes(L)&&!j.length}return!0}));let M=d?T0({matchUps:A,schedulingProfile:c}):A,C=l==null?void 0:l.map(x=>{let F=k(x);return{surfaceCategory:(x==null?void 0:x.surfaceCategory)??"",matchUps:F,...x}}),O={completedMatchUps:m?U:P,dateMatchUps:M,courtsData:C,groupInfo:N,venues:u};if(g){let{rows:x,courtPrefix:F}=kR({minRowsCount:v,courtsData:C});O.courtPrefix=F,O.rows=x}return{...O,...Q};function k({courtId:x}){let F=(p?M.concat(P??[]):M).filter($=>{var _,L,B;return((_=$.schedule)==null?void 0:_.courtId)===x||((B=(L=$.schedule)==null?void 0:L.allocatedCourts)==null?void 0:B.map(({courtId:V})=>V).includes(x))});return b?T0({matchUps:F,schedulingProfile:c}):F}}function $R({tournamentRecords:t,tournamentId:e}){if(typeof t!="object"||!Object.keys(t).length)return{error:xi};let i=Object.keys(t).filter(n=>!e||n===e),r;return i.forEach(n=>{let a=t[n],{matchUpDailyLimits:o}=_Ee({tournamentRecord:a});r=o}),{matchUpDailyLimits:r}}function _Ee(t){var e;let i=We(t,[{[Ur]:!0}]);if(i.error)return i;let{tournamentRecord:r}=t,{policy:n}=Cp({policyType:td,tournamentRecord:r}),{extension:a}=vt({element:r,name:sw}),o=(e=a==null?void 0:a.value)==null?void 0:e.dailyLimits,s=n==null?void 0:n.defaultDailyLimits;return{matchUpDailyLimits:o||s}}function t$(t){var e,i,r,n;let{matchUps:a}=t,{singlesForDoubles:o,tournamentRecord:s,drawDefinition:l,excludeMargin:u,exclusionRule:c,zoneDoubling:d,matchUpType:p,scaleName:m,eventId:h,zonePct:f,drawId:g,event:v}=t;if(!s&&!a)return{error:ve};if(p&&![ii,ei].includes(p))return{error:se,info:{matchUpType:p}};if(a&&!Ro(a))return{error:se,context:{matchUps:a}};let y=Tr[m],I=(y==null?void 0:y.ascending)??t.ascending??!1,b=(y==null?void 0:y.accessor)??t.valueAccessor,S=Array.isArray(y==null?void 0:y.range)?Math.abs(y.range[0]-y.range[1]):0,w=st(f)&&S?(f??0/100)*S:t.zoneMargin??S,U={withScaleValues:!0,withCompetitiveness:!0},T={matchUpTypes:p?[p]:[ii,ei]},D=s==null?void 0:s.participants;(e=a==null?void 0:a[0])!=null&&e.hasContext?g?a=a.filter(k=>k.drawId===g):h&&(a=a.filter(k=>k.eventId===h)):a===void 0&&(a=g&&!l&&[]||!g&&h&&!v&&[]||g&&((i=Pn({inContext:!0,drawDefinition:l,contextFilters:T,contextProfile:U,participants:D}))==null?void 0:i.matchUps)||!g&&h&&((r=au({inContext:!0,contextFilters:T,contextProfile:U,participants:D,event:v}))==null?void 0:r.matchUps)||((n=Hr({tournamentRecord:s,contextFilters:T,contextProfile:U}))==null?void 0:n.matchUps)||[]),p&&(a=a.filter(k=>k.matchUpType===p));let P=a.filter(({winningSide:k,score:x,sides:F,matchUpStatus:$})=>![zr,Pt,Ft,Iv,ua].includes($??"")&&br({score:x})&&(F==null?void 0:F.length)===2&&k),E=BEe({matchUps:P,excludeMargin:u,exclusionRule:c,valueAccessor:b,ascending:I,scaleName:m}),R=!d||Xi(ii)(p)?w:(w||0)*2,N=w?P.map(({competitiveProfile:k,matchUpType:x,score:F,sides:$})=>{let _=Uee({singlesForDoubles:o,valueAccessor:b,matchUpType:x,scaleName:m,sides:$}),L=Math.abs(_[0].value-_[1].value);return{competitiveness:k==null?void 0:k.competitiveness,valuesGap:L,score:F}}).filter(({valuesGap:k})=>k<=R):[],A=$Ee({zoneData:N}),M=A&&[].concat(Object.values(A)).flat().length,C=M&&Object.assign({},...Object.keys(A).map(k=>({[k]:Math.round(1e4*A[k].length/M)/100}))),O=P.length-((N==null?void 0:N.length)||0);return{...Q,relevantMatchUps:P,zoneDistribution:C,zoneData:N,accuracy:E,nonZone:O}}function $Ee({zoneData:t}){let e={[fL]:[],[dy]:[],[py]:[]};for(let i of t){let{competitiveness:r,score:n,valuesGap:a}=i;e[r]&&e[r].push({score:n,valuesGap:a})}return e}function Uee({singlesForDoubles:t,exclusionRule:e,valueAccessor:i,matchUpType:r,scaleName:n,sides:a}){let o=e==null?void 0:e.range.sort(),s=l=>{let u=l==null?void 0:l[e==null?void 0:e.valueAccessor];return{exclude:e&&u>=o[0]&&u<=o[1],exclusionValue:u}};return a.sort((l,u)=>l.sideNumber-u.sideNumber).map(({participant:l})=>{let u=[],c=l==null?void 0:l.individualParticipants;if(c!=null&&c.length){let d=[],p=0;for(let m of c){let{scaleValue:h,value:f}=Z2({singlesForDoubles:t,valueAccessor:i,participant:m,matchUpType:r,scaleName:n}),{exclude:g,exclusionValue:v}=s(h);g&&u.push(v),d.push(h),f&&!isNaN(p)?p+=f:p=void 0}return{participantName:l.participantName,exclusionValues:u,scaleValues:d,value:p}}else if(l){let{scaleValue:d,value:p}=Z2({singlesForDoubles:t,valueAccessor:i,matchUpType:r,participant:l,scaleName:n}),{exclude:m,exclusionValue:h}=s(d);return m&&u.push(h),{participantName:l.participantName,exclusionValues:u,scaleValue:d,value:p}}else return{}})}function Z2({singlesForDoubles:t,valueAccessor:e,matchUpType:i,participant:r,scaleName:n}){var a,o,s,l,u;let c=t?ii:i,d=(o=(a=r==null?void 0:r.rankings)==null?void 0:a[c])==null?void 0:o.find(h=>h.scaleName===n),p=(u=((l=(s=r==null?void 0:r.ratings)==null?void 0:s[c])==null?void 0:l.find(h=>h.scaleName===n))||d)==null?void 0:u.scaleValue,m=e?p==null?void 0:p[e]:p;return{scaleValue:p,value:m}}function BEe({excludeMargin:t,exclusionRule:e,valueAccessor:i,ascending:r,scaleName:n,matchUps:a}){let o={affirmative:[],negative:[],excluded:[]};for(let u of a){let{matchUpType:c,sides:d,score:p,winningSide:m}=u;if(!m)continue;if(e&&(!e.valueAccessor||!e.range))return{info:"exclusionRule requires valueAccessor and range",error:Je};let h=m-1,f=Uee({exclusionRule:e,valueAccessor:i,matchUpType:c,scaleName:n,sides:d});if(e){let S=f.map(({exclusionValues:w})=>w).flat();if(S.length){o.excluded.push({scoreString:p==null?void 0:p.scoreStringSide1,exclusionValues:S,winningSide:m,sideValues:f});continue}}if(f.filter(S=>![void 0,"",null].includes(S.value)).length<2){o.excluded.push({scoreString:p==null?void 0:p.scoreStringSide1,missingValues:!0,winningSide:m,sideValues:f});continue}let g=f[h].value-f[1-h].value,v=parseFloat(t||0),y=v&&Math.abs(g)<v;if(y){o.excluded.push({scoreString:p==null?void 0:p.scoreStringSide1,excludeMargin:t,winningSide:m,excludeGap:y,sideValues:f,valuesGap:g});continue}let I=r?g:g*-1,b=m===1?p==null?void 0:p.scoreStringSide1:p==null?void 0:p.scoreStringSide2;I>0?o.affirmative.push({winningScoreString:b,winningSide:m,sideValues:f,valuesGap:g,score:p}):o.negative.push({winningScoreString:b,winningSide:m,sideValues:f,valuesGap:g,score:p})}let s=o.affirmative.length+o.negative.length,l=s&&o.affirmative.length/s*100;return o.percent=l?Math.round(100*l)/100:0,o}function Gh({collectionDefinitions:t=[],collectionGroups:e=[]}){let i=0,{groupValueNumbers:r}=TQ({collectionGroups:e}),n;for(let a of t||[]){let{collectionValueProfiles:o,collectionGroupNumber:s,collectionValue:l,matchUpCount:u,matchUpValue:c,scoreValue:d,setValue:p}=a,m=s&&r.includes(s);if(st(p||d))n=!0;else{if(m)continue;if(typeof l=="number"&&st(l))i+=l;else if(Array.isArray(o)&&o!=null&&o.length)for(let h of o)i+=h.matchUpValue;else typeof c=="number"&&st(c)&&(i+=(u??0)*c)}}for(let a of e)i+=a.groupValue??0;return n||!i?{aggregateValue:!0,...Q}:{valueGoal:Math.floor(i/2)+1,...Q}}function i$(t){let{timeStamp:e,schedule:i,matchUp:r}=t,n=We(t,[{[ru]:!0}]);if(n.error)return n;let{itemValue:a,timeStamp:o}=Ap({timeItems:(r==null?void 0:r.timeItems)||[],itemType:wL});return!i||o&&e&&new Date(o).getTime()>new Date(e).getTime()?{homeParticipantId:a}:i}function r$({matchUps:t,matchUpId:e}){if(!Ro(t))return{error:se};let i=t.find(s=>s.matchUpId===e),{drawId:r,eventId:n,structureId:a,tournamentId:o}=i||{};return{matchUpId:e,drawId:r,eventId:n,structureId:a,tournamentId:o}}function Cv(t,e){if(!At(t))return{error:se};if(!Array.isArray(e))return{error:se};let i={};for(let{param:r,error:n,attr:a}of e){let o=VEe({params:t,param:r,attr:a,error:n});if(o!=null&&o.error)return o;i[r]=o}return i}function VEe({params:t,param:e,attr:i,error:r}){if(e===AP&&At(t.drawDefinition)&&Di(t.structureId)){let n=(t.drawDefinition.structures??[]).find(({structureId:a})=>a===t.structureId);return!n.length&&r?{error:r}:{structure:n}}if(e===ru){let n=cee({...t,...i});return n.error&&r?{...n,error:r}:n}return{error:jr,info:{param:e}}}function n$(t){var e,i;let{structureId:r,matchUpId:n,event:a}=t,o=t.drawDefinition,s=We(t,[{[Ur]:!0},{[BF]:{[CP]:!1,[Il]:!1,[nX]:!1,[ed]:!1}}]);if(s[Wo])return s;let l=(e=Cv(t,[{[hv]:ru,[Wo]:Je}]))==null?void 0:e.matchUp;if(n&&l!=null&&l.error)return l;!o&&l!=null&&l.drawDefinition&&(o=l==null?void 0:l.drawDefinition);let u=l==null?void 0:l.structure;if(!u&&r&&!n){if(!o)return{error:Fs};let h=tt({drawDefinition:o,structureId:r});if(h.error)return h;u=h.structure}let c=u==null?void 0:u.matchUpFormat,d=o==null?void 0:o.matchUpFormat,p=a==null?void 0:a.matchUpFormat,m=((i=l==null?void 0:l.matchUp)==null?void 0:i.matchUpFormat)||c||d||p;return{structureDefaultMatchUpFormat:c,eventDefaultMatchUpFormat:p,drawDefaultMatchUpFormat:d,matchUpFormat:m}}function a$({profileBands:t,tournamentRecord:e,matchUps:i}){if(!Ro(i))return{error:Ju};let r=!t&&Cp({policyType:du,tournamentRecord:e}).policy,n=t||(r==null?void 0:r.profileBands)||gL[du].profileBands,a=i.filter(({winningSide:p})=>p),o=a.map(zX),s=(p,m)=>{let h=HX(m,n);return p[h]+=1,p},l=WX(o).reduce((p,m)=>s(p,m),{[fL]:0,[dy]:0,[py]:0,[$X]:0}),u=Object.keys(l).reduce((p,m)=>(l[m]||0)+p,0),c=Object.keys(l).map(p=>{let m=parseFloat((l[p]/u).toFixed(4));return{[p]:m*100}}),d=a.filter(({matchUpStatus:p})=>p===S2).length;return c.push({[S2]:parseFloat((d/u).toFixed(4))*100}),{competitiveBands:Object.assign({},...c),...Q}}var{stageOrder:ej}=bSe;function jEe(t,e){return t.eventName.localeCompare(e.eventName)||t.eventId.localeCompare(e.eventId)||(ej[t==null?void 0:t.stage]||0)-(ej[e==null?void 0:e.stage]||0)||e.matchUpsCount-t.matchUpsCount||`${t.stageSequence}-${t.roundNumber}-${t.minFinishingSum}`.localeCompare(`${e.stageSequence}-${e.roundNumber}-${e.minFinishingSum}`)}function o$({excludeScheduleDateProfileRounds:t,excludeScheduledRounds:e,excludeCompletedRounds:i,inContextMatchUps:r,tournamentRecords:n,schedulingProfile:a,tournamentRecord:o,withSplitRounds:s,matchUpFilters:l,scheduleDate:u,withRoundId:c,venueId:d,context:p}){var m;if(r&&!Array.isArray(r||typeof r[0]!="object"))return{error:se,inContextMatchUps:r};if(o&&!n){if(typeof o!="object")return{error:Wb};n={[o.tournamentId]:o}}let h=typeof n!="object"||!Object.keys(n).length;if((d||u||!r||!a&&(t||i||a||s))&&h)return{error:xi};let f=Object.assign({},...Object.values(n??{}).map(({venues:U=[],tournamentId:T})=>({[T]:U==null?void 0:U.map(({venueId:D})=>D)}))),g=Object.values(n??{}).map(({events:U=[],tournamentId:T,startDate:D,endDate:P})=>U.map(E=>({...E,validVenueIds:f[T],startDate:E.startDate??D,endDate:E.endDate??P}))).flat(),{segmentedRounds:v,profileRounds:y}=n&&(t||i||a||s)&&OR({tournamentRecords:n,schedulingProfile:a})||{},I=t&&Object.assign({},...y.map(U=>({[U.id]:U}))),b=r||n&&((m=Os({tournamentRecords:n,matchUpFilters:l}))==null?void 0:m.matchUps)||[],S=[],w=b&&Object.values(b.reduce((U,T)=>{var D;let P=qM(T).id,E=v==null?void 0:v[P],R=[...((D=U[P])==null?void 0:D.matchUps)??[],T],{containerStructureId:N,stageSequence:A,structureName:M,tournamentId:C,isRoundRobin:O,matchUpType:k,roundNumber:x,roundOffset:F,structureId:$,eventName:_,roundName:L,drawName:B,eventId:V,drawId:G}=T,j=O?N:$;return{...U,[P]:{id:c?P:void 0,structureId:j,stageSequence:A,segmentsCount:E,structureName:M,tournamentId:C,matchUpType:k,roundNumber:x,roundOffset:F,eventName:_,roundName:L,drawName:B,matchUps:R,eventId:V,drawId:G}}},{})).map(U=>{let{minFinishingSum:T,winnerFinishingPositionRange:D}=xEe(U.matchUps),P=U.segmentsCount;if(P){let k=U.matchUps.length/P;return Cr(U.matchUps.sort((x,F)=>x.roundPosition-F.roundPosition),k).map((x,F)=>{let{unscheduledCount:$,incompleteCount:_,matchUpsCount:L,isScheduled:B,isComplete:V,byeCount:G}=Q2(x),j=J2({matchUps:U.matchUps,tournamentRecords:n,events:g,round:U});return He({...U,...p,roundSegment:{segmentsCount:P,segmentNumber:F+1},winnerFinishingPositionRange:D,unscheduledCount:$,incompleteCount:_,minFinishingSum:T,matchUpsCount:L,isScheduled:B,roundTiming:j,isComplete:V,byeCount:G,matchUps:x})})}let{unscheduledCount:E,incompleteCount:R,matchUpsCount:N,isScheduled:A,isComplete:M,byeCount:C}=Q2(U.matchUps),O=J2({matchUps:U.matchUps,tournamentRecords:n,events:g,round:U});return He({...U,...p,winnerFinishingPositionRange:D,unscheduledCount:E,incompleteCount:R,minFinishingSum:T,matchUpsCount:N,isScheduled:A,roundTiming:O,isComplete:M,byeCount:C})}).flat().filter(U=>{if(t){let F=mt(t),$=c?U.id:qM(U).id;if(F&&I[$]&&mt(I[$].scheduleDate)===F)return!1}let{isComplete:T,isScheduled:D}=U,P=!i||!T,E=!e||!D,R=d||u?g==null?void 0:g.find(({eventId:F})=>F===U.eventId):void 0,N=(R==null?void 0:R.startDate)??(o==null?void 0:o.startDate),A=(R==null?void 0:R.endDate)??(o==null?void 0:o.endDate),M=!u||!N||new Date(u)>=new Date(N),C=!u||!A||new Date(u)<=new Date(A),O=M&&C,k=!d||(R==null?void 0:R.validVenueIds.includes(d)),x=P&&E&&k&&O;return x||S.push(U),x}).sort(jEe)||[];return{...Q,rounds:w,excludedRounds:S}}function yy(t){var e;let{matchUp:i,sideNumber:r,setNumber:n,isTiebreakValue:a,isPointValue:o}=t||{},{matchUpFormat:s}=t||{};if(!i)return{error:sa};s=s||(i==null?void 0:i.matchUpFormat);let l=Ln(s),u=!!(i!=null&&i.winningSide),c=(e=i.score)==null?void 0:e.sets,d=c==null?void 0:c.length,p=n&&n-1,m=!!(c!=null&&c.find((G,j)=>G.setNumber===n&&j===p)),h=(c==null?void 0:c.filter(G=>G==null?void 0:G.winningSide))||[],f=(h==null?void 0:h.length)||0,g=n&&(c==null?void 0:c.slice(n))||[],v=!!(d&&n&&g!=null&&g.reduce((G,j)=>(!j||!j.side1Score&&!j.side2Score&&!j.side1TiebreakScore&&!j.side2TiebreakScore&&!j.side1PointScore&&!j.side2PointScore)&&G,!0)),y=n<=d&&c.find(G=>G.setNumber===n),I=y&&vy({setObject:y,matchUpScoringFormat:l}),{isCompletedSet:b,sideGameScores:S,sideTiebreakScores:w}=I||{},U=!!(y&&!b&&v||n&&n===d+1&&!u),T=[1,2].includes(r),D=T?r-1:0,P=y&&T&&(!a&&!o&&S[D]!==void 0&&S[D]||a&&w[D]!==void 0&&w[D]),E=!!P,R=h==null?void 0:h.map(G=>vy({setObject:G,matchUpScoringFormat:l}).isValidSetOutcome).reduce((G,j)=>G&&j,!0),N=h.reduce((G,j)=>{let{winningSide:z}=j,W=z-1;return G[W]++,G},[0,0]),A=i==null?void 0:i.winningSide,M=A&&A-1,C=1-M,O=N[M],k=N[C],x=Math.max(...N),F=Pa(N)[x],{bestOf:$,exactly:_}=l??{},L=$&&Math.ceil($/2)||_||1,B=x===L&&F===1&&N.indexOf(x)+1||void 0,V=O>k&&A===B;return{completedSetsHaveValidOutcomes:R,validMatchUpWinningSide:V,calculatedWinningSide:B,matchUpScoringFormat:l,validMatchUpOutcome:B&&R&&V,isLastSetWithValues:v,completedSetsCount:f,isCompletedMatchUp:u,isValidSideNumber:T,hasExistingValue:E,existingValue:P,isExistingSet:m,isActiveSet:U,...I}}function s$({participants:t,tournamentAppliedPolicies:e,scheduleVisibilityFilters:i,participantsProfile:r,afterRecoveryTimes:n,policyDefinitions:a,useParticipantMap:o,tournamentRecord:s,usePublishState:l,contextFilters:u,contextContent:c,matchUpFilters:d,participantMap:p,publishStatus:m,contextProfile:h,drawDefinition:f,nextMatchUps:g,tournamentId:v,inContext:y,context:I,event:b}){let{eventId:S,eventName:w,endDate:U,eventType:T,category:D,gender:P}=b??{},E={...I,...He({surfaceCategory:(b==null?void 0:b.surfaceCategory)??(s==null?void 0:s.surfaceCategory),indoorOutDoor:(b==null?void 0:b.indoorOutdoor)??(s==null?void 0:s.indoorOutdoor),endDate:U??(b==null?void 0:b.endDate)??(s==null?void 0:s.endDate),tournamentId:v??(s==null?void 0:s.tournamentId),eventName:w,eventType:T,category:D,eventId:S,gender:P})},R;return!(t!=null&&t.length)&&s&&({participants:t,participantMap:p,groupInfo:R}=Rh({participantsProfile:r,policyDefinitions:a,useParticipantMap:o,tournamentRecord:s,contextProfile:h,inContext:y})),b&&h&&!c&&(c=tc({policyDefinitions:a,tournamentRecord:s,contextProfile:h,drawDefinition:f,event:b})),{...wv({context:E,tournamentAppliedPolicies:e,scheduleVisibilityFilters:i,tournamentParticipants:t,participantsProfile:r,afterRecoveryTimes:n,policyDefinitions:a,tournamentRecord:s,usePublishState:l,participantMap:p,contextContent:c,contextFilters:u,matchUpFilters:d,publishStatus:m,contextProfile:h,drawDefinition:f,nextMatchUps:g,inContext:y,event:b}),groupInfo:R}}var See={};bt(See,{getCompetitionVenues:()=>Ww,getCourts:()=>l$,getVenuesAndCourts:()=>rc,publicFindVenue:()=>TL});function l$({tournamentRecord:t,venueId:e,venueIds:i}){return t?{courts:(t.venues||[]).filter(r=>e?r.venueId===e:i?i.includes(r.venueId):!0).map(r=>{let{venueId:n}=r,a=Ne(r.courts||[]);return a.forEach(o=>Object.assign(o,{venueId:n})),a}).flat()}:{error:ve}}var Tee={};bt(Tee,{categoryCanContain:()=>ew,getCategoryAgeDetails:()=>Nm,getEvent:()=>d$,getEventProperties:()=>u$,getEventStructures:()=>nR,getEventTimeItem:()=>dw,getEvents:()=>c$,getFlightProfile:()=>Hi,getScaledEntries:()=>Vh});function u$({tournamentRecord:t,event:e}){var i,r;if(!t)return{error:ve};if(!e)return{error:vi};let n=e.entries||[],a=t.participants||[],o=((i=e.category)==null?void 0:i.categoryName)||((r=e.category)==null?void 0:r.ageCategoryCode),{eventType:s}=e,l=n.map(m=>m.participantId),u=a.filter(m=>l.includes(m.participantId)),c,d,p;return{entryScaleAttributes:u.map(m=>{var h,f,g,v,y,I;let{participantId:b,participantName:S,name:w}=m,U={scaleType:SL,eventType:s,scaleName:o},T=(f=(h=Ll({participant:m,scaleAttributes:U}))==null?void 0:h.scaleItem)==null?void 0:f.scaleValue;U={scaleType:tJ,eventType:s,scaleName:o};let D=(v=(g=Ll({participant:m,scaleAttributes:U}))==null?void 0:g.scaleItem)==null?void 0:v.scaleValue;U={scaleType:eJ,eventType:s,scaleName:o};let P=(I=(y=Ll({participant:m,scaleAttributes:U}))==null?void 0:y.scaleItem)==null?void 0:I.scaleValue;return c=!!(c||T),d=!!(d||D),p=!!(p||P),{participantId:b,participantName:S||w,seed:T,ranking:D,rating:P}}),hasSeededParticipants:c,hasRankedParticipants:d,hasRatedParticipants:p}}function c$({tournamentRecord:t,withScaleValues:e,scaleEventType:i,inContext:r,eventIds:n,drawIds:a,context:o}){var s,l,u,c;if(!t)return{error:ve};let{tournamentId:d}=t,p=(t.events??[]).filter(({eventId:h})=>!n||Array.isArray(n)&&n.includes(h)).map(h=>{var f;let g=(f=h.drawDefinitions)==null?void 0:f.map(uy);if(a!=null&&a.length&&!ji(a,g).length)return;let v=Ne(h);return r&&Object.assign(v,{tournamentId:d}),o&&Object.assign(v,o),v}).filter(Boolean),m={};if(e){let h=Oi({withScaleValues:!0,tournamentRecord:t}).participantMap,f=g=>g.reduce((v,y)=>v+parseFloat(y),0);for(let g of p){let v=i??g.eventType,y=g.eventId;m[y]||(m[y]={ratingsStats:{},ratings:{},ranking:{},draws:{}});let I=(g.entries??[]).filter(({entryStatus:P})=>ds.includes(P)).map(Tt),b=P=>{var E,R,N,A,M,C;if((E=P==null?void 0:P.ratings)!=null&&E[v])for(let O of((R=P==null?void 0:P.ratings)==null?void 0:R[v])??[]){let k=O.scaleName;m[y].ratings[k]||(m[y].ratings[k]=[]);let x=(N=Tr[k])==null?void 0:N.accessor;if(x){let F=parseFloat((A=O.scaleValue)==null?void 0:A[x]);F&&m[y].ratings[k].push(F)}}if((M=P==null?void 0:P.rankings)!=null&&M[v])for(let O of((C=P==null?void 0:P.rankings)==null?void 0:C[v])??[]){let k=O.scaleName;m[y].ranking[k]||(m[y].ranking[k]=[]),O.scaleValue&&m[y].ranking[k].push(O.scaleValue)}};for(let P of I){let E=(s=h==null?void 0:h[P])==null?void 0:s.participant;if((E==null?void 0:E.participantType)!==Dt)for(let R of(E==null?void 0:E.individualParticipantIds)??[]){let N=(l=h==null?void 0:h[R])==null?void 0:l.participant;b(N)}else b(E)}let S=m[y].ratings;for(let P of Object.keys(S)){let E=S[P];if(!E.length)continue;let R=(u=p2(E))==null?void 0:u.toFixed(2);m[y].ratingsStats[P]={avg:parseFloat((f(E)/E.length).toFixed(2)),median:R?parseFloat(R):void 0,max:Math.max(...E),min:Math.min(...E)}}let w=(P,E)=>{var R,N;let A=M=>{var C,O,k,x,F,$,_,L,B,V;if((C=m[y].draws)!=null&&C[P]&&(O=M==null?void 0:M.ratings)!=null&&O[v])for(let G of((k=M==null?void 0:M.ratings)==null?void 0:k[v])??[]){let j=G.scaleName;(x=m[y].draws[P])!=null&&x.ratings[j]||(m[y].draws[P].ratings[j]=[]);let z=(F=Tr[j])==null?void 0:F.accessor;if(z){let W=parseFloat(($=G.scaleValue)==null?void 0:$[z]);W&&m[y].draws[P].ratings[j].push(W)}}if((_=m[y].draws)!=null&&_[P]&&(L=M==null?void 0:M.rankings)!=null&&L[v])for(let G of((B=M==null?void 0:M.rankings)==null?void 0:B[v])??[]){let j=G.scaleName;(V=m[y].draws[P])!=null&&V.ranking[j]||(m[y].draws[P].ranking[j]=[]);let z=G.scaleValue;z&&m[y].draws[P].ranking[j].push(z)}};for(let M of E.filter(Boolean)){let C=(R=h==null?void 0:h[M])==null?void 0:R.participant;if((C==null?void 0:C.participantType)!==Dt)for(let O of(C==null?void 0:C.individualParticipantIds)??[]){let k=(N=h==null?void 0:h[O])==null?void 0:N.participant;A(k)}else A(C)}},U=[],T=P=>(a==null?void 0:a.length)&&a.includes(P)||U.includes(P);for(let P of g.drawDefinitions??[]){let E=P.drawId;if(T(E))continue;let R=Op({drawDefinition:P}).assignedParticipantIds??[];m[y].draws[E]||(m[y].draws[E]={ratingsStats:{},ratings:{},ranking:{}}),U.push(E),w(E,R)}let D=Hi({event:g}).flightProfile;for(let P of(D==null?void 0:D.flights)??[]){let E=P.drawId;if(T(E))continue;let R=P.drawEntries.map(Tt);w(E,R)}for(let P of U){let E=m[y].draws[P].ratings;for(let R of Object.keys(E)){let N=E[R];if(!N.length)continue;let A=(c=p2(N))==null?void 0:c.toFixed(2);m[y].draws[P].ratingsStats[R]={avg:parseFloat((f(N)/N.length).toFixed(2)),median:A?parseFloat(A):void 0,max:Math.max(...N),min:Math.min(...N)}}}}}return He({eventScaleValues:m,events:p,...Q})}function d$({tournamentRecord:t,drawDefinition:e,context:i,event:r}){var n;if(!t)return{error:ve};if(!r)return{error:vi};let a=Ne(r);i&&Object.assign(a,i);let o=e&&((n=a.drawDefinitions)==null?void 0:n.find(({drawId:s})=>e.drawId===s));return He({drawDefinition:o,event:a})}function GEe(t){var e,i;let r="validateAndDeriveDrawValues",{appliedPolicies:n,policyDefinitions:a}=WEe(t),o=qEe({...t,policyDefinitions:a,appliedPolicies:n}),s=zEe(t),l=YEe({...t,consideredEntries:s,appliedPolicies:n});if(l!=null&&l.error)return te({result:l,stack:r});let u=KEe({...t,consideredEntries:s}),c=HEe({...t,appliedPolicies:n,policyDefinitions:a,drawSize:u});if(c.error)return te({result:c,stack:r});let d=c.drawType;if(isNaN(u)&&d!==Ga)return te({result:{error:Yb},stack:r});let p=(a==null?void 0:a[Oo])??(n==null?void 0:n[Oo]),m=t.seedingProfile??((i=(e=p==null?void 0:p.seedingProfile)==null?void 0:e.drawTypes)==null?void 0:i[d??""])??(p==null?void 0:p.seedingProfile);t.seedingProfile&&(a[Oo]||(a[Oo]={...WM[Oo]}),a[Oo].seedingProfile=m);let h=XEe({...t,drawType:d});return h!=null&&h.error?te({result:h,stack:r}):{drawSize:u,drawType:d,enforceGender:o,seedingProfile:m,appliedPolicies:n,policyDefinitions:a}}function HEe(t){let{policyDefinitions:e,appliedPolicies:i,enforceMinimumDrawSize:r=!0,drawSize:n}=t,a=t.drawTypeCoercion??Gw({drawType:t.drawType,policyDefinitions:e,appliedPolicies:i}),o=JQ({drawType:t.drawType,enforceMinimumDrawSize:r,drawTypeCoercion:a,drawSize:n});return o.error?o:{drawType:o.drawType}}function Dee(t){return t==null?void 0:t.filter(e=>e.entryStatus&&[...ds,Iw].includes(e.entryStatus))}function zEe({considerEventEntries:t=!0,drawEntries:e,eventEntries:i,qualifyingOnly:r}){return(r&&[]||Dee(e)||(t?i:[])).filter(({entryStage:n})=>!n||n===Ae)}function WEe(t){let{tournamentRecord:e,event:i}=t,r=Bt({tournamentRecord:e,event:i}).appliedPolicies??{},n=Ne(t.policyDefinitions??{},!1,!0);return{appliedPolicies:r,policyDefinitions:n}}function qEe({enforceGender:t,policyDefinitions:e,appliedPolicies:i}){var r,n,a,o;return t??((n=(r=e==null?void 0:e[_r])==null?void 0:r.participants)==null?void 0:n.enforceGender)??((o=(a=i==null?void 0:i[_r])==null?void 0:a.participants)==null?void 0:o.enforceGender)}function YEe(t){let{consideredEntries:e,appliedPolicies:i,policyDefinitions:r,enforceGender:n,participantMap:a,participants:o,event:s}=t;return s&&o&&fR({consideredEntries:e,policyDefinitions:r,appliedPolicies:i,participantMap:a,enforceGender:n,participants:o,event:s})}function KEe(t){return!t.drawSize&&t.consideredEntries.length&&![Ga,iw,mv,is,Kl].includes(t.drawType??"")&&nv(t.consideredEntries.length)||t.drawSize&&Ze(t.drawSize)||!1}function XEe(t){var e,i;let{tournamentRecord:r,event:n,ignoreAllowedDrawTypes:a,drawType:o}=t,s=!a&&r&&TR({tournamentRecord:r,categoryType:(e=n==null?void 0:n.category)==null?void 0:e.categoryType,categoryName:(i=n==null?void 0:n.category)==null?void 0:i.categoryName});return s!=null&&s.length&&!s.includes(o)?{error:qx}:{...Q}}function Jw(t){let{voluntaryConsolation:e,tournamentRecord:i,event:r}=t,n="generateDrawDefinition",{participants:a,participantMap:o}=Oi({withIndividualParticipants:!0,convertExtensions:!0,internalUse:!0,tournamentRecord:i}),s=Dee(r==null?void 0:r.entries)??[],l=GEe({...t,participantMap:o,participants:a,eventEntries:s});if(l.error)return te({result:l,stack:n});let{appliedPolicies:u,policyDefinitions:c,drawSize:d,drawType:p,enforceGender:m,seedingProfile:h}=l,f=r==null?void 0:r.eventType,g=t.matchUpType??f,v=KRe({...t,enforceGender:m,eventType:f,matchUpType:g});if(v.error)return te({result:v,stack:n});let{matchUpFormat:y,tieFormat:I}=v;if(t.drawId&&typeof t.drawId!="string")return te({result:{error:se},stack:n});let b=SEe({...t,policyDefinitions:c,tournamentRecord:i,appliedPolicies:u,matchUpFormat:y,seedingProfile:h,participants:a,eventEntries:s,matchUpType:g,tieFormat:I,drawSize:d,drawType:p,event:r});if(b.error)return te({result:b,stack:n});let{existingDrawDefinition:S,positioningReports:w,drawDefinition:U,structureId:T,conflicts:D,entries:P}=b;if(!U)return te({result:{error:se},stack:n});let E=TEe({...t,existingDrawDefinition:S,positioningReports:w,appliedPolicies:u,drawDefinition:U,seedingProfile:h,participants:a,structureId:T,entries:P,params:t,stack:n});if(E.error)return E;let{qualifyingConflicts:R}=E;return U.drawName=t.drawName??(p&&tn(p)),d&&typeof e=="object"&&d>=4&&xL({...e,drawDefinition:U,matchUpType:g}),{existingDrawDefinition:!!S,qualifyingConflicts:R,positioningReports:w,drawDefinition:U,structureId:T,...Q,conflicts:D}}function Pee({scaleAttributes:t,scaledEntries:e,stageEntries:i,seedsCount:r,scaleName:n}){if(!t)return{error:Je,info:"missing scaleAttributes"};let a=Object.assign({},...(e||[]).slice(0,r).map(({participantId:s},l)=>({[s]:l+1})));n=n||t.scaleName;let o=new Date().toISOString();return{scaleItemsWithParticipantIds:i.map(({participantId:s})=>({scaleItems:[{scaleValue:a[s],eventType:t.eventType,scaleType:xl,scaleName:n,scaleDate:o}],participantId:s}))}}function JEe({tournamentRecord:t,drawDefinition:e,policyDefinitions:i,scaleAttributes:r,scaleName:n,drawSize:a,drawId:o,event:s,stage:l,sortDescending:u,scaleSortMethod:c}){let d=xR({policyDefinitions:i,drawDefinition:e,drawSize:a,drawId:o,event:s,stage:l});if(d.error)return d;let{entries:p,seedsCount:m,stageEntries:h}=d;if(!h||!m)return{error:se};let f=Vh({tournamentRecord:t,scaleAttributes:r,scaleSortMethod:c,sortDescending:u,entries:p,stage:l}).scaledEntries??[],{scaleItemsWithParticipantIds:g}=Pee({scaleAttributes:r,scaledEntries:f,stageEntries:h,seedsCount:m,scaleName:n});return{scaleItemsWithParticipantIds:g}}var Ree={};bt(Ree,{addDrawEntries:()=>ML,addEventEntries:()=>Xs,addEventEntryPairs:()=>Aee,destroyPairEntries:()=>PJ,destroyPairEntry:()=>kL,getEntriesAndSeedsCount:()=>xR,getMaxEntryPosition:()=>X_,modifyEntriesStatus:()=>p0,modifyEventEntries:()=>Oee,mutate:()=>Eee,promoteAlternate:()=>Mee,promoteAlternates:()=>m$,query:()=>Iee,removeDrawEntries:()=>Nee,removeEventEntries:()=>Cw,setEntryPosition:()=>p$,setEntryPositions:()=>Cee});var Eee={};bt(Eee,{addDrawEntries:()=>ML,addEventEntries:()=>Xs,addEventEntryPairs:()=>Aee,destroyPairEntries:()=>PJ,destroyPairEntry:()=>kL,modifyEntriesStatus:()=>p0,modifyEventEntries:()=>Oee,promoteAlternate:()=>Mee,promoteAlternates:()=>m$,removeDrawEntries:()=>Nee,removeEventEntries:()=>Cw,setEntryPosition:()=>p$,setEntryPositions:()=>Cee});function p$({tournamentRecord:t,drawDefinition:e,participantId:i,entryPosition:r,skipRefresh:n,event:a}){let o="setEntryPositions";if(!t)return{error:ve};if(!i)return te({result:{error:hr},stack:o});if(r!==void 0&&!Number.isSafeInteger(r))return{error:se,entryPosition:r};((a==null?void 0:a.entries)||[]).forEach(l=>{l.participantId===i&&(l.entryPosition=r)}),((e==null?void 0:e.entries)||[]).forEach(l=>{l.participantId===i&&(l.entryPosition=r)});let s=l=>{l.entries.forEach(u=>{u.entryPosition===r&&u.participantId!==i&&(u.entryPosition+=.1)})};return n||(a!=null&&a.entries&&(s(a),a.entries=Us({entries:a.entries})),e!=null&&e.entries&&(s(e),e.entries=Us({entries:e.entries}))),{...Q}}function Cee({tournamentRecord:t,entryPositions:e,drawDefinition:i,event:r}){if(!t)return{error:ve};if(!Array.isArray(e))return{error:se};for(let n of e){let{participantId:a,entryPosition:o}=n,s=p$({skipRefresh:!0,tournamentRecord:t,drawDefinition:i,participantId:a,entryPosition:o,event:r});if(s.error)return s}return r!=null&&r.entries&&(r.entries=Us({entries:r.entries})),i!=null&&i.entries&&(i.entries=Us({entries:i.entries})),{...Q}}function Mee(t){let{participantId:e}=t;return e&&typeof e!="string"?{error:se,participantId:e}:m$({...t,participantIds:[e].filter(Boolean)})}function m$({tournamentRecord:t,drawDefinition:e,participantIds:i,stageSequence:r,stage:n=Ae,eventId:a,event:o}){if(!t)return{error:ve};if(!Array.isArray(i))return{error:se,participantIds:i};if(!o)return{error:vi};let s="promoteAlternates";if(o){let l=tj({element:o,participantIds:i,stageSequence:r,stage:n});if(l.error)return l}if(e){let l=tj({element:e,participantIds:i,stageSequence:r,stage:n});if(l.error)return a?te({context:{drawPromotionError:l.error,drawId:e.drawId},result:{...Q},stack:s}):l}return{...Q}}function tj({participantIds:t,stageSequence:e,element:i,stage:r}){let n=(i.entries||[]).filter(d=>d.entryStatus===qo),a=(i.entries||[]).filter(d=>t.includes(d.participantId)),o=n.reduce((d,p)=>{let{entryPosition:m}=p;return isNaN(m)&&d||(!d||m<d.entryPosition)&&p||d},void 0),s=a.length?a:[o].filter(Boolean);if(!(s!=null&&s.length))return{error:y9};let l=s.filter(({entryStatus:d})=>d!==qo);if(l.length)return{error:cM,invalidEntryStatus:l};let u=s.filter(({entryStage:d})=>d&&d!==r);if(u.length)return{error:rUe,invalidStage:u};let c=e&&s.filter(d=>d.stageSequence!==e);if(c!=null&&c.length)return{error:nUe,invalidStageSequence:c};for(let d of s){d.entryStatus=ca;let p=d==null?void 0:d.entryPosition;isNaN(p)||i.entries.forEach(h=>{h.entryStatus===qo&&h.entryPosition>p&&(h.entryPosition=h.entryPosition-1)});let m=Math.max(...i.entries.filter(h=>h.entryStatus===ca&&!isNaN(h.entryPosition)).map(({entryPosition:h})=>Ze(h||0)),0);d.entryPosition=m||0}return{...Q}}function Nee({autoEntryPositions:t=!0,participantIds:e,drawDefinition:i,drawId:r,stages:n,event:a}){var o;if(!a)return{error:vi};if(!r)return{error:Fs};if(!(e!=null&&e.length))return{error:Qc};let s=Op({drawDefinition:i,stages:n}).assignedParticipantIds??[];if(Nn(s,e))return{error:uv};let l=d=>{let p=d.participantId;return!e.includes(p)},{flightProfile:u}=Hi({event:a}),c=(o=u==null?void 0:u.flights)==null?void 0:o.find(d=>d.drawId===r);return c!=null&&c.drawEntries&&(c.drawEntries=c.drawEntries.filter(l),t&&(c.drawEntries=Us({entries:c.drawEntries}))),i!=null&&i.entries&&(i.entries=i.entries.filter(l),t&&(i.entries=Us({entries:i.entries}))),{...Q}}function pl(t){var e,i,r,n,a;let o="addParticipant",{allowDuplicateParticipantIdPairs:s,returnParticipant:l,disableNotice:u,pairOverride:c,participant:d}=t,p=t.tournamentId?(e=t.tournamentRecords)==null?void 0:e[t.tournamentId]:t.tournamentRecord??(t.activeTournamentId&&((i=t.tournamentRecords)==null?void 0:i[t.activeTournamentId]));if(!p)return{error:ve};if(!d)return te({result:{error:yh},stack:o});d.participantId||(d.participantId=Ht()),p.participants||(p.participants=[]);let{participantId:m,individualParticipantIds:h}=d;if(p.participants.reduce((b,S)=>S.participantId===m||b,!1))return{error:h9};let{participantType:f,participantRole:g}=d;if(!f||!Object.keys(rI).includes(f))return{error:Ns,participantType:f};if(!g)return{error:m9};let v=p.participants||[],y=v.filter(b=>b.participantType===Dt).map(b=>b.participantId);if(f!==Dt&&d.person)return{error:se,person:d.person};if(h&&!Array.isArray(h))return{error:se,individualParticipantIds:h};if(f===ft){if(d.person)return{error:se,person:d.person};if(d.individualParticipantIds){if(d.individualParticipantIds.length!==2&&!c)return te({info:"PAIR must be 2 individualParticipantIds",result:{error:ya},stack:o});{let w=v.filter(U=>U.participantType===Dt).map(U=>U.participantId);if(!Array.isArray(d.individualParticipantIds))return te({result:{error:ya},stack:o});if(!d.individualParticipantIds.reduce((U,T)=>w.includes(T)&&U,!0))return te({result:{error:ya},stack:o})}}else return te({result:{error:Qc},stack:o});let b=v.filter(w=>w.participantType===ft).map(w=>({individualParticipantIds:w.individualParticipantIds,participant:w})),S=d.participantType===ft&&b.find(w=>ji(w.individualParticipantIds,d.individualParticipantIds).length===2);if(S&&!s)return{...Q,existingParticipant:!0,participant:l&&Ne(S.participant)};if(!d.participantName){let w=v.filter(T=>{var D;return(D=d.individualParticipantIds)==null?void 0:D.includes(T.participantId)}),U=w.map(T=>{var D;return(D=T.person)==null?void 0:D.standardFamilyName}).filter(Boolean).join("/");w.length===1&&(U+="/Unknown"),d.participantName=U}}else if(f===Dt){if(!((r=d.person)!=null&&r.standardFamilyName)||!((n=d.person)!=null&&n.standardGivenName))return{error:I9};if(!d.participantName){let b=`${d.person.standardFamilyName.toUpperCase()}, ${d.person.standardGivenName}`;d.participantName=b}}else if(f&&[Xt,Ja].includes(f)){if(h||(d.individualParticipantIds=[]),(a=d.individualParticipantIds)==null?void 0:a.length)for(let b of d.individualParticipantIds){if(typeof b!="string")return te({result:{participantId:b,error:se},stack:o});if(!y.includes(b))return te({result:{participantId:b,error:Wi},stack:o})}}else return{error:Ns};p.participants.push(d),u||ut({payload:{tournamentId:p.tournamentId,participants:[d]},topic:kc});let I={participant:l&&Ne(d),...Q};return He(I)}function os({allowDuplicateParticipantIdPairs:t,returnParticipants:e,tournamentRecord:i,participants:r=[]}){if(!i)return{error:ve};i.participants||(i.participants=[]);let n=i.participants.map(d=>d.participantId)||[];r.forEach(d=>{d.participantId||(d.participantId=Ht())});let a=r.filter(d=>!n.includes(d.participantId)),o=r.filter(d=>n.includes(d.participantId)),s=a.filter(d=>d.participantType===Dt),l=a.filter(d=>d.participantType!==Dt),u=s.concat(...l),c=[];if(u.length){for(let p of u){let m=pl({allowDuplicateParticipantIdPairs:t,returnParticipant:!0,disableNotice:!0,tournamentRecord:i,participant:p});if(m.error)return m;m.success&&!m.existingParticipant&&c.push(m.participant)}c.length&&ut({topic:kc,payload:{tournamentId:i.tournamentId,participants:c}});let d={participants:e&&Ne(c),addedCount:c.length,...Q};return o.length&&Object.assign(d,{notAdded:o,info:pP}),He(d)}else return{info:"No new participants to add",addedCount:0,...Q}}function Aee(t){let e=We(t,[{[Ur]:!0,[ed]:!0}]);if(e.error)return e;let{allowDuplicateParticipantIdPairs:i,entryStatus:r=qo,participantIdPairs:n=[],entryStage:a=Ae,tournamentRecord:o,drawDefinition:s,event:l,uuids:u}=t;if(l.eventType!==ei)return{error:Wl};let c=[],d=new Map;for(let b of o.participants??[]){let{participantType:S,participantId:w,person:U,individualParticipantIds:T}=b;S===Dt&&U!=null&&U.sex?d.set(w,U.sex):S===ft&&T&&c.push(T)}let p=n.filter(b=>{if(b.length!==2)return!0;if(!l.gender||l.gender===As)return!1;if(!d.has(b[0])||!d.has(b[1]))return!0;let S=b.map(U=>d.get(U)),w=l.gender===Qt&&(S[0]!==Qt||S[1]!==Qt)||l.gender===mi&&(S[0]!==mi||S[1]!==mi);return l.gender===jn&&(S.sort(eR),(S[0]!==mi||S[1]!==Qt)&&(w=!0)),w});if(p.length)return{error:ya,invalidParticipantIdPairs:p};let m=n.map(b=>({participantId:(u==null?void 0:u.pop())??Ht(),participantRole:en,individualParticipantIds:b,participantType:ft})),h=i?m:m.filter(b=>!c.find(S=>ji(S,b.individualParticipantIds).length===2)),f,g=[];if(h){let b=os({allowDuplicateParticipantIdPairs:i,participants:h,returnParticipants:!0,tournamentRecord:o});if(b.error)return b;g=b.participants||[],f=b.info}let v=n.map(b=>{let S=g.find(U=>ji(U.individualParticipantIds,b).length===2);if(S)return S;let{participant:w}=as({tournamentRecord:o,participantIds:b});return w}).map(b=>b.participantId),y=Xs({participantIds:v,tournamentRecord:o,drawDefinition:s,entryStatus:r,entryStage:a,event:l});h.length&&ut({payload:{participants:h},topic:kc});let I=h.map(Tt);return{...y,info:f,newParticipantIds:I}}function Oee({entryStatus:t=ca,unpairedParticipantIds:e=[],participantIdPairs:i=[],entryStage:r=Ae,tournamentRecord:n,event:a}){if(!n)return{error:ve};if(!a)return{error:vi};let o=n.participants??[],s=o.filter(f=>f.participantType===Dt).map(f=>f.participantId),l=e.concat(...i).flat(1/0).filter(f=>!s.includes(f));if(l.length)return{error:ya,invalidParticipantIds:l};let u=i.filter(f=>f.length!==2);if(u.length)return{error:ya,invalidParticipantIdPairs:u};let c=o.filter(f=>f.participantType===ft).map(f=>f.individualParticipantIds),d=i.filter(f=>!c.find(g=>ji(g,f).length===2)).map(f=>({participantType:ft,participantRole:en,individualParticipantIds:f})),p=os({participants:d,tournamentRecord:n});if(p.error)return p;let m=i.map(f=>{let{participant:g}=as({tournamentRecord:n,participantIds:f});return g}).map(f=>({participantId:f,entryStatus:t,entryStage:r})),h=e.map(f=>({entryStatus:Po,participantId:f,entryStage:r}));return a.entries=(a.entries??[]).filter(f=>f.entryStage===r),a.entries=a.entries.concat(...m,...h),{...Q}}var kee={};bt(kee,{addDrawDefinition:()=>Qw,addEvent:()=>Mv,addFlight:()=>GR,assignSeedPositions:()=>qee,attachFlightProfile:()=>b$,categoryCanContain:()=>ew,deleteDrawDefinitions:()=>BR,deleteEvents:()=>Kee,deleteFlightAndFlightDraw:()=>zee,deleteFlightProfileAndFlightDraws:()=>Bee,generate:()=>xee,generateEventsFromTieFormat:()=>Lee,getCategoryAgeDetails:()=>Nm,getEvent:()=>d$,getEventProperties:()=>u$,getEventStructures:()=>nR,getEventTimeItem:()=>dw,getEvents:()=>c$,getFlightProfile:()=>Hi,getScaledEntries:()=>Vh,modifyEvent:()=>Xee,modifyEventMatchUpFormatTiming:()=>Vee,modifyPairAssignment:()=>Wee,mutate:()=>_ee,query:()=>Tee,refreshEventDrawOrder:()=>y$,removeEventMatchUpFormatTiming:()=>VR,removeScaleValues:()=>w$,removeSeeding:()=>Yee,setEventDates:()=>v$,setEventDisplay:()=>jR,setEventEndDate:()=>g$,setEventStartDate:()=>f$,updateDrawIdsOrder:()=>I$,validateCategory:()=>ty});var xee={};bt(xee,{generateEventsFromTieFormat:()=>Lee});function QEe({tournamentId:t,event:e}){return e?(ut({payload:{tournamentId:t,event:e},key:e.eventId,topic:PX}),{...Q}):{error:vi}}var ZEe={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_D3",winCriteria:{valueGoal:5}},eCe={collectionDefinitions:[{collectionName:"Doubles",collectionValue:1,matchUpCount:3,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES"},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_DEFAULT",winCriteria:{valueGoal:5}},tCe={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_JUCO",winCriteria:{valueGoal:5}},Fee={COLLEGE_D3:ZEe,COLLEGE_DEFAULT:eCe,COLLEGE_JUCO:tCe,DOMINANT_DUO:y8,DOMINANT_DUO_MIXED:h8,LAVER_CUP:T8,TEAM_DOUBLES_3_AGGREGATION:u8,TIME_TENNIS_DUAL:f8,TIME_TENNIS_PRO_CIRCUIT:m8,USTA_BREWER_CUP:g8,USTA_OZAKI_CUP:v8,USTA_COLLEGE:b8,USTA_GOLD_TEAM_CHALLENGE:l8,USTA_INTERSECTIONAL:p8,USTA_LEVEL_1:w8,USTA_SECTION_BATTLE:d8,USTA_SOUTHERN_LEVEL_5:c8,USTA_TOC:D8,USTA_WTT_ITT:U8,USTA_ZONAL:S8};function Mv({suppressNotifications:t,tournamentRecord:e,internalUse:i,event:r}){var n,a,o,s;if(!e)return{error:ve};if(e.events||(e.events=[]),!r)return{error:vi};let{startDate:l,endDate:u}=e;if(!i&&((n=r.entries)!=null&&n.length||(a=r.drawDefinitions)!=null&&a.length)){let d=He({drawDefinitions:!!((o=r.drawDefinitions)!=null&&o.length),entries:!!((s=r.entries)!=null&&s.length)});return{info:"entries/drawDefinitions cannot exist",error:se,context:d}}let c={eventType:Am,drawDefinitions:[],entries:[],startDate:l,endDate:u,...r};if(r.eventType===Ea){if(r.tieFormat){let d=qn({tieFormat:r.tieFormat});if(d.error)return d}else if(r.tieFormatName){if(!Fee[r.tieFormatName])return{context:{tieFormatName:r.tieFormatName},error:se};let d=Nu({isMock:e==null?void 0:e.isMock,namedFormat:r.tieFormatName,event:r});c.tieFormat=d}}if(c.eventId||(c.eventId=Ht()),e.events.reduce((d,p)=>d||p.eventId===c.eventId,void 0))return{error:KK};{let d=c;if(e.events.push(d),!t){let{topics:p}=So();if(p.includes(BP)){let f=au({event:r}).matchUps??[];xc({tournamentId:e==null?void 0:e.tournamentId,eventId:r.eventId,matchUps:f})}let{drawDefinitions:m,...h}=r;for(let f of m||[])uw({drawDefinition:f});QEe({tournamentId:e==null?void 0:e.tournamentId,event:h})}return{...Q,event:c}}}function Lee(t){var e,i,r,n;let a=We(t,[{[og]:{[MP]:!0,[Q8]:!0}},{[Ur]:!0}]);if(a.error)return a;let o=t.tieFormat||Nu({namedFormat:t.tieFormatName}),s=t.uuids||[s8(o.collectionDefinitions.length)],l={[Qt]:[],[mi]:[]};if(t.addEntriesFromTeams){let c=(i=(e=t.tournamentRecord.participants)==null?void 0:e.filter(d=>d.participantType===Gn))==null?void 0:i.flatMap(d=>d.individualParticipantIds??[]);for(let d of t.tournamentRecord.participants??[])if(c!=null&&c.includes(d.participantId)){let p=(r=d.person)==null?void 0:r.sex;p&&[Qt,mi].includes(p)&&l[p].push(d.participantId)}}let u=[];for(let c of o.collectionDefinitions??[]){let d=((n=s==null?void 0:s.pop())==null?void 0:n.toString())||Ht(),p=c.matchUpType,m=c.gender,h={matchUpFormat:c.matchUpFormat,eventName:c.collectionName,category:c.category,gender:m,eventType:p,eventId:d};if(t.addEntriesFromTeams){let f=p===Au?Po:t.entryStatus||ca,g=m===jn?[...l[Qt],...l[mi]]:l[m]??[];if(g.length){let v=Xs({participantIds:g,entryStatus:f,event:h});if(v.error)return v}}if(u.push(h),t.addEvents!==!1){let f=Mv({internalUse:!0,tournamentRecord:t.tournamentRecord,event:h});if(f.error)return f}}return{...Q,events:u}}var _ee={};bt(_ee,{addDrawDefinition:()=>Qw,addEvent:()=>Mv,addFlight:()=>GR,assignSeedPositions:()=>qee,attachFlightProfile:()=>b$,deleteDrawDefinitions:()=>BR,deleteEvents:()=>Kee,deleteFlightAndFlightDraw:()=>zee,deleteFlightProfileAndFlightDraws:()=>Bee,modifyEvent:()=>Xee,modifyEventMatchUpFormatTiming:()=>Vee,modifyPairAssignment:()=>Wee,refreshEventDrawOrder:()=>y$,removeEventMatchUpFormatTiming:()=>VR,removeScaleValues:()=>w$,removeSeeding:()=>Yee,setEventDates:()=>v$,setEventDisplay:()=>jR,setEventEndDate:()=>g$,setEventStartDate:()=>f$,updateDrawIdsOrder:()=>I$,validateCategory:()=>ty});function Nv({removePriorValues:t=!0,status:e=Qa,statusObject:i,event:r}){if(!At(i))return{error:se};let n=Eo({event:r,status:e}),a=`${ad}.${od}`,o={itemValue:{[e]:{...n,...i}},itemType:a};return Bh({timeItem:o,removePriorValues:t,event:r})}function Av(t){var e,i,r,n,a,o,s;let l=We(t,[{[Ur]:!0,[ed]:!0},{eventDataParams:!1,[Jn]:ta}]);if(l.error)return l;let{includePositionAssignments:u,removePriorValues:c,tournamentRecord:d,status:p=Qa,event:m,drawIdsToRemove:h,drawIdsToAdd:f}=t,{appliedPolicies:g}=Bt({tournamentRecord:d,event:m}),v={...g,...t.policyDefinitions},y=((e=m==null?void 0:m.drawDefinitions)==null?void 0:e.map(({drawId:R})=>R))??[],I=t.drawDetails?Object.keys(t.drawDetails):[],b=I.length?[]:t.drawIds,S=(f??[]).concat(...h??[],...b??[],...I),w=S.filter(R=>!y.includes(R));if(w.length)return te({result:{error:Va},context:{invalidDrawIds:w}});let U=Eo({event:m,status:p}),T=Object.keys((U==null?void 0:U.drawDetails)||{}).filter(R=>y.includes(R)).reduce((R,N)=>(R[N]=U.drawDetails[N],R),{});for(let R of y)if((!S.length||S.includes(R))&&(h!=null&&h.includes(R)||b!=null&&b.length&&!b.includes(R)?T[R]={...T[R],publishingDetail:{published:!1}}:(f!=null&&f.includes(R)||b!=null&&b.includes(R)||!(b!=null&&b.length))&&(T[R]={...T[R],publishingDetail:{published:!0}})),(i=t.drawDetails)==null?void 0:i[R]){let N=t.drawDetails[R],A=N.structureDetails??T[R].structureDetails,M=N.stageDetails??T[R].stageDetails??{},{structureIdsToRemove:C=[],structureIdsToAdd:O=[],publishingDetail:k={},stagesToRemove:x=[],stagesToAdd:F=[]}=N;if((O||F)&&(k.published=!0),T[R]={publishingDetail:k,structureDetails:A,stageDetails:M},O.length||C.length){let _=(((n=(r=m==null?void 0:m.drawDefinitions)==null?void 0:r.find(B=>B.drawId===R))==null?void 0:n.structures)??[]).map(({structureId:B})=>B),L=(O??[]).concat(C??[]).filter(B=>!_.includes(B));if(L.length)return te({result:{error:Ai},context:{invalidStructureIds:L}});A=A??{};for(let B of _)C.includes(B)?A[B]={published:!1}:A[B]={published:!0};T[R].structureDetails=A}let $=(((o=(a=m==null?void 0:m.drawDefinitions)==null?void 0:a.find(_=>_.drawId===R))==null?void 0:o.structures)??[]).map(({stage:_})=>_);if(F.length){for(let _ of F)M[_]={published:!0};for(let _ of $)M[_]||(M[_]={published:!1})}if(F.length||x.length){for(let _ of x)M[_]={published:!1};for(let _ of $)M[_]||(M[_]={published:!0})}(F.length||x.length)&&(T[R].stageDetails=M)}Nv({statusObject:{drawDetails:T},removePriorValues:c,status:p,event:m});let{topics:D}=So(),P=D.includes(wM),E=P||t.returnEventData?(s=CR({includePositionAssignments:u,...t.eventDataParams,usePublishState:!0,tournamentRecord:d,policyDefinitions:v,event:m}))==null?void 0:s.eventData:void 0;return P&&ut({payload:{eventData:E,tournamentId:d.tournamentId},topic:wM}),{...Q,eventData:E}}var $ee="deleteDrawDefinitions",YM="autoSchedulingAudit",oS="deleteEvents",iCe={AUTO_SCHEDULING_AUDIT:YM,DELETE_EVENTS:oS,DELETE_DRAW_DEFINITIONS:$ee};function BR(t){var e,i,r,n,a;if(!t.tournamentRecord)return{error:ve};let o="deleteDrawDefinitions",s=t.drawIds??[],l=t.event,{autoPublish:u=!0,tournamentRecord:c,auditData:d,eventId:p,force:m}=t,{appliedPolicies:h}=Bt({tournamentRecord:c,event:l}),f={...h,...t.policyDefinitions},g=Array.isArray(s)?s[0]:void 0;if(!l){let N=Kn({tournamentRecord:c,eventId:p,drawId:g});if(N.error)return N;l=N.event}let v=[],y=[],I=[];if(!(l!=null&&l.drawDefinitions))return te({info:"event has no drawDefinition",result:{...Q},stack:o});let b=l.drawDefinitions.map(({drawId:N})=>N);if(s.length||(s=b),s=s.filter(N=>b.includes(N)),!s.length)return te({info:"nothing to do; no matching drawIds in event.",result:{...Q},stack:o});let S=Ne(Hi({event:l}).flightProfile,!1,!0),w=({participantId:N,drawPosition:A,qualifier:M,bye:C})=>({bye:C,qualifier:M,drawPosition:A,participantId:N}),U=m??((i=(e=h==null?void 0:h[fo])==null?void 0:e.allowDeletionWithScoresPresent)==null?void 0:i.drawDefinitions),T=Eo({event:l})??{},D=T.drawIds??(T.drawDetails&&Object.keys(T.drawDetails))??[],P,E=[],R=l.drawDefinitions.filter(N=>{var A,M,C,O,k,x,F,$;if(s.includes(N.drawId)){let _=((A=Pn({event:l,drawDefinition:N}))==null?void 0:A.matchUps)??[];if(_.some(({score:re})=>br({score:re}))&&!U)return E.push(N.drawId),!0;let{drawId:L,drawType:B,drawName:V}=N,G=(M=S==null?void 0:S.flights)==null?void 0:M.find(re=>re.drawId===N.drawId);G&&(G.drawEntries=(C=G.drawEntries)==null?void 0:C.filter(re=>ds.includes(re.entryStatus))),D.includes(L)&&(D=D.filter(re=>re!==L),P=!0);let j=(k=(O=ns({stageSequence:1,drawDefinition:N,stage:Ae}))==null?void 0:O.structures)==null?void 0:k[0],z=(F=(x=j?fy({structureId:j.structureId,tournamentRecord:c,drawDefinition:N}):void 0)==null?void 0:x.positionAssignments)==null?void 0:F.map(w),W=($=ns({stage:Ke,drawDefinition:N}))==null?void 0:$.structures,q=W!=null&&W.length?W.map(re=>{var K;let H=re.stageSequence;return{positionAssignments:(K=fy({structureId:re.structureId,tournamentRecord:c,drawDefinition:N}))==null?void 0:K.positionAssignments.map(w),stageSequence:H}}):void 0,Y={action:$ee,payload:{drawDefinitions:[N],eventId:p??(l==null?void 0:l.eventId),auditData:d}};I.push(Y),v.push(He({tournamentId:c.tournamentId,eventId:p??(l==null?void 0:l.eventId),qualifyingPositionAssignments:q,positionAssignments:z,auditData:d,drawType:B,drawName:V,drawId:L})),_==null||_.forEach(({matchUpId:re})=>y.push(re))}return!s.includes(N.drawId)});if(E.length&&!m)return te({context:{drawIdsWithScoresPresent:E},result:{error:IP},stack:o});if(l.drawDefinitions=R,S&&id({event:l,extension:{name:rs,value:S}}),Yw({tournamentRecord:c}),P){let N={};for(let M of D)N[M]=((r=T.drawDetails)==null?void 0:r[M])??{published:!0};let A=Nv({statusObject:{drawDetails:N},event:l});if(A.error)return{error:A.error}}if(I.length)if(yP(vu)){let N=c.tournamentId;ut({topic:vu,payload:{tournamentId:N,detail:I}});let A=(((a=(n=Do({element:l,itemType:Ed}))==null?void 0:n.timeItem)==null?void 0:a.itemValue)||0)+1;wl({element:l,timeItem:{itemType:Ed,itemValue:A},removePriorValues:!0})}else rCe({appliedPolicies:h,event:l,deletedDrawsDetail:v,auditData:d});if(y.length&&Zu({tournamentId:c==null?void 0:c.tournamentId,matchUpIds:y}),s.forEach(N=>r0e({drawId:N})),u&&P){let N=Av({...t.eventDataParams,drawIdsToRemove:s,policyDefinitions:f,tournamentRecord:c,event:l});if(N.error)return{...Q,info:N.error}}return{...Q}}function rCe({appliedPolicies:t,event:e,deletedDrawsDetail:i,auditData:r}){var n;if(((n=t==null?void 0:t.audit)==null?void 0:n[Ed])===!1)return;let{extension:a}=vt({name:Ed,element:e}),o={...r,deletedDrawsDetail:i},s={value:Array.isArray(a==null?void 0:a.value)?a==null?void 0:a.value.concat(o):[o],name:Ed};_t({element:e,extension:s})}function Bee({autoPublish:t=!0,tournamentRecord:e,auditData:i,event:r,force:n}){var a;if(!e)return{error:ve};if(!r)return{error:vi};let{flightProfile:o}=Hi({event:r});if(o){let s=(a=o.flights)==null?void 0:a.map(({drawId:u})=>u).filter(Boolean),l=BR({eventId:r.eventId,tournamentRecord:e,autoPublish:t,auditData:i,drawIds:s,event:r,force:n});return l.error?l:FP({event:r,name:rs})}return{...Q}}function h$(t){let{matchUpFormat:e,recoveryTimes:i,averageTimes:r,tournamentId:n,eventId:a}=t,o=(t==null?void 0:t.tournamentRecords)??((t==null?void 0:t.tournamentRecord)&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord})??{};if(!Object.keys(o).length)return{error:xi};let s=Object.keys(o).filter(u=>!n||n===u);if(n&&!s.includes(n))return{error:se};let l;for(let u of s){let c=o[u],{event:d}=Kn({tournamentRecord:c,eventId:a});a&&d&&(l=!0);let p=nCe({tournamentRecord:c,event:d,matchUpFormat:e,averageTimes:r,recoveryTimes:i});if(p.error)return p}return!a||l?{...Q}:{error:mo}}function nCe({tournamentRecord:t,recoveryTimes:e,matchUpFormat:i,averageTimes:r,event:n}){if(!t)return{error:ve};if(r&&!Array.isArray(r))return{error:se};if(e&&!Array.isArray(e))return{error:se};let a=Lu;if(n){let{extension:o}=vt({element:n,name:a}),s=(o==null?void 0:o.value)||{},l=ij({...s,matchUpFormat:i,averageTimes:r,recoveryTimes:e});_t({element:n,extension:{name:a,value:l}})}else{let{extension:o}=vt({element:t,name:a}),s=(o==null?void 0:o.value)||{},l=ij({...s,matchUpFormat:i,averageTimes:r,recoveryTimes:e});_t({extension:{name:a,value:l},element:t})}return{...Q}}function ij(t){let{matchUpRecoveryTimes:e=[],matchUpAverageTimes:i=[],matchUpFormat:r}=t,{averageTimes:n,recoveryTimes:a}=t;n=(n||[]).filter(l=>{var u,c;return((u=l==null?void 0:l.categoryNames)==null?void 0:u.length)||((c=l==null?void 0:l.categoryTypes)==null?void 0:c.length)});let o=(n==null?void 0:n.length)&&i.map(l=>{var u;return l!=null&&l.matchUpFormatCodes.includes(r)?{...l,matchUpFormatCodes:(u=l.matchUpFormatCodes)==null?void 0:u.filter(c=>c!==r)}:l}).filter(({matchUpFormatCodes:l})=>l==null?void 0:l.length).concat({matchUpFormatCodes:[r],averageTimes:n});a=(a||[]).filter(l=>{var u,c;return((u=l==null?void 0:l.categoryNames)==null?void 0:u.length)||((c=l==null?void 0:l.categoryTypes)==null?void 0:c.length)});let s=(a==null?void 0:a.length)&&e.map(l=>{var u;return l!=null&&l.matchUpFormatCodes.includes(r)?{...l,matchUpFormatCodes:(u=l.matchUpFormatCodes)==null?void 0:u.filter(c=>c!==r)}:l}).filter(({matchUpFormatCodes:l,averageTimes:u})=>(l==null?void 0:l.length)||u).concat({matchUpFormatCodes:[r],recoveryTimes:a});return{matchUpAverageTimes:(o==null?void 0:o.length)&&o||i,matchUpRecoveryTimes:(s==null?void 0:s.length)&&s||e}}function Vee(t){let{tournamentRecord:e,recoveryMinutes:i,averageMinutes:r,matchUpFormat:n,categoryType:a,eventId:o,event:s}=t;if(!e)return{error:ve};if(!Ra({matchUpFormat:n}))return{error:se};if(!s)return{error:vi};let{averageTimes:l=[],recoveryTimes:u=[]}=FR({tournamentRecord:e,matchUpFormat:n,event:s}),c=s.category,d=(c==null?void 0:c.categoryName)||(c==null?void 0:c.ageCategoryCode)||(s==null?void 0:s.eventId),p={categoryNames:[d],minutes:{}},m={categoryNames:[d],minutes:{}},h=I=>{var b,S;if((b=I.categoryTypes)!=null&&b.includes(a)&&console.log("encountered:",{categoryType:a}),!((S=I.categoryNames)!=null&&S.includes(d)&&(I.categoryNames=I.categoryNames.filter(w=>w!==d),p={minutes:I.minutes,categoryNames:[d]},!I.categoryNames.length)))return I},f=r&&!isNaN(Ze(r)),g=i&&!isNaN(Ze(i)),v=l.map(h).filter(I=>{var b;return(b=I==null?void 0:I.categoryNames)==null?void 0:b.length}),y=u.map(h).filter(I=>{var b;return(b=I==null?void 0:I.categoryNames)==null?void 0:b.length});return f&&(Object.assign(p.minutes,{[(s==null?void 0:s.eventType)||ii]:r}),v.push(p)),g&&(Object.assign(m.minutes,{[(s==null?void 0:s.eventType)||ii]:i}),y.push(m)),!f&&!g?{error:se}:h$({averageTimes:f&&v,recoveryTimes:g&&y,tournamentRecord:e,matchUpFormat:n,eventId:o,event:s})}function VR(t){if(t.event)return rj({event:t.event});{t.tournamentRecord&&!t.tournamentRecords&&(t.tournamentRecords={[t.tournamentRecord.tournamentId]:t.tournamentRecord});let e=We(t,[{[fn]:!0,[rX]:!0}]);if(e.error)return e;let{tournamentRecords:i,eventId:r}=t;for(let n of Object.values(i??{})){let{event:a}=Kn({tournamentRecord:n,eventId:r});if(a)return rj({event:a})}}return{error:mo}}function rj({event:t}){return FP({event:t,name:Lu})}var aCe="MON",oCe="TUE",sCe="WED",lCe="THU",uCe="FRI",cCe="SAT",dCe="SUN",jee={MON:aCe,TUE:oCe,WED:sCe,THU:lCe,FRI:uCe,SAT:cCe,SUN:dCe};function Gee(t){return!Array.isArray(t)||dt(t).length!==t.length?!1:t.every(e=>Object.keys(jee).includes(e))}function f$({tournamentRecord:t,event:e,startDate:i}){if(!t)return{error:ve};if(!e)return{error:vi};if(!ol.test(i))return{error:Fr};let r=Hee(t);if(r.error)return r;let{tournamentStartDate:n,tournamentEndDate:a}=r,o=new Date(mt(i)).getTime();if(!n||!a||o<n||o>a)return{error:Fr};let s=e.endDate&&new Date(mt(e.endDate)).getTime();return s&&o>s&&(e.endDate=i),e.startDate=i,{...Q}}function g$(t){let{tournamentRecord:e,event:i,endDate:r}=t;if(!e)return{error:ve};if(!i)return{error:vi};if(!ol.test(r))return{error:Fr};let n=Hee(e);if(n.error)return n;let{tournamentStartDate:a,tournamentEndDate:o}=n,s=new Date(mt(r)).getTime();if(!a||!o||s<a||s>o)return{error:Fr};let l=i.startDate&&new Date(mt(i.startDate)).getTime();return l&&s<l&&(i.startDate=r),i.endDate=r,{...Q}}function v$(t){var e;let i=We(t,[{tournamentRecord:!0,event:!0},{[Xr]:u=>ol.test(u),[Ha]:Fr,startDate:!1,endDate:!1},{[Xr]:u=>u.filter(Boolean).every(c=>ol.test(c)),[Ha]:Fr,activeDates:!1},{[Xr]:Gee,weekdays:!1}]);if(i.error)return i;let{tournamentRecord:r,weekdays:n,event:a,startDate:o,endDate:s}=t,l=(e=t.activeDates)==null?void 0:e.filter(Boolean);if(o&&s){let u=new Date(mt(o)).getTime(),c=new Date(mt(s)).getTime();if(u>c)return{error:se}}if(l){let u=o||r.startDate,c=s||r.endDate,d=!u||l.every(m=>new Date(m)>=new Date(u)),p=!c||l.every(m=>new Date(m)<=new Date(c));if(!d||!p)return{error:Fr}}if(o){let u=f$({tournamentRecord:r,event:a,startDate:o});if(u.error)return u}if(s){let u=g$({tournamentRecord:r,event:a,endDate:s});if(u.error)return u}return l&&(a.activeDates=l),n&&(a.weekdays=n),{...Q}}function Hee(t){let{startDate:e,endDate:i}=t;return!ol.test(e)||!ol.test(i)?te({result:{error:u9},context:{startDate:e,endDate:i}}):{tournamentStartDate:new Date(mt(e)).getTime(),tournamentEndDate:new Date(mt(i)).getTime()}}function I$({event:t,orderedDrawIdsMap:e}){var i,r;if(typeof t!="object")return{error:vi};if(!e)return{error:Je,info:"Missing drawIdsOrderMap"};if(typeof e!="object")return{error:se,info:"orderedDrawIdsMap must be an object"};let n=Object.values(e);if(!n.every(o=>!isNaN(o)))return{error:se,info:"drawOrder must be numeric"};if(dt(n).length!==n.length)return{error:se,info:"drawOrder values must be unique"};if((i=t.drawDefinitions)!=null&&i.length){let o=(t.drawDefinitions||[]).map(({drawId:l})=>l),s=Object.keys(e);if(s!=null&&s.length&&ji(o,s).length!==o.length)return{error:se,info:"Missing drawIds"};t.drawDefinitions.forEach(l=>{l.drawOrder=e[l.drawId]})}let{flightProfile:a}=Hi({event:t});return(r=a==null?void 0:a.flights)==null||r.forEach(o=>{o.flightNumber=e[o.drawId]}),{...Q}}function y$({tournamentRecord:t,event:e}){var i;if(!t)return{error:ve};if(!e)return{error:vi};let{flightProfile:r}=Hi({event:e}),n=(r==null?void 0:r.flights)&&Object.assign({},...r.flights.sort((a,o)=>a.flightNumber-o.flightNumber).map((a,o)=>({[a.drawId]:o+1})))||((i=e.drawDefinitions)==null?void 0:i.length)&&Object.assign({},...e.drawDefinitions.sort((a,o)=>a.drawOrder-o.drawOrder).map((a,o)=>({[a.drawId]:o+1})))||void 0;return n?I$({event:e,orderedDrawIdsMap:n}):{...Q}}function zee({autoPublish:t=!0,tournamentRecord:e,auditData:i,drawId:r,event:n,force:a}){var o,s;if(!e)return{error:ve};if(!r)return{error:Fs};if(!n)return{error:vi};let{flightProfile:l}=Hi({event:n});if(l&&(o=l.flights)!=null&&o.find(u=>u.drawId===r)){let u=l.flights.filter(d=>d.drawId!==r),c={name:rs,value:{...l,flights:u}};id({event:n,extension:c})}if((s=n.drawDefinitions)!=null&&s.find(u=>u.drawId===r)){let u=BR({drawIds:[r],eventId:n.eventId,tournamentRecord:e,autoPublish:t,auditData:i,event:n,force:a});if(u.error)return u}return y$({tournamentRecord:e,event:n})}function Wee(t){var e,i;let r=We(t,[{[ed]:!0,[Ur]:!0,[$F]:!1},{replacementIndividualParticipantId:!0,[Xr]:y=>Di(y),existingIndividualParticipantId:!0,[Wo]:hr,participantId:!0}]),{replacementIndividualParticipantId:n,existingIndividualParticipantId:a,tournamentRecord:o,drawDefinition:s,participantId:l,event:u,uuids:c}=t;if(r.error)return r;if((u==null?void 0:u.eventType)!==ho)return{error:Wl};if(!(((e=u==null?void 0:u.entries)==null?void 0:e.filter(({entryStatus:y})=>[Po,Mp].includes(y)).map(({participantId:y})=>y))||[]).includes(n))return{error:Ms};let d=(o.participants||[]).find(y=>y.participantId===l);if((d==null?void 0:d.participantType)!==ft)return{error:Ih,participant:d};let p=d.individualParticipantIds,m=[n,...p.filter(y=>y!==a)],{participant:h}=as({participantIds:m,tournamentRecord:o}),f;if(h)f=h.participantId;else{let y={participantId:c==null?void 0:c.pop(),participantRole:en,individualParticipantIds:m,participantType:ft},I=pl({participant:y,returnParticipant:!0,tournamentRecord:o});if(I.error)return I;f=I.participant.participantId}let{flightProfile:g}=Hi({event:u});if(s){let y=(i=g==null?void 0:g.flights)==null?void 0:i.find(({drawId:I})=>I===s.drawId);y&&(y.drawEntries=y.drawEntries.map(I=>I.participantId===l?{...I,participantId:f}:I)),s.entries=s.entries.map(I=>I.participantId===l?{...I,participantId:f}:I);for(let I of s.structures||[])if(I.structures){I.positionAssignments=void 0;for(let b of I.structures)b.positionAssignments=b.positionAssignments.map(S=>S.participantId===l?{...S,participantId:f}:S)}else I.positionAssignments&&(I.positionAssignments=I.positionAssignments.map(b=>b.participantId===l?{...b,participantId:f}:b))}u.entries=u.entries.map(y=>y.participantId===l&&{...y,participantId:f}||y.participantId===n&&{...y,participantId:a}||y);let v=o.events.some(({entries:y,eventId:I,drawDefinitions:b})=>u.eventId===I?b.some(({drawId:S,entries:w})=>S===(s==null?void 0:s.drawId)?!1:w==null?void 0:w.find(U=>U.participantId===l)):y==null?void 0:y.find(S=>S.participantId===l));if(!v){let y=Lh({addIndividualParticipantsToEvents:!1,participantIds:[l],tournamentRecord:o});if(y.error)return y}return{...Q,participantOtherEntries:v,newPairParticipantId:f}}function Qw(t){var e,i,r,n,a,o,s,l,u,c,d,p;let{flight:m,suppressNotifications:h,modifyEventEntries:f,existingDrawCount:g,allowReplacement:v,checkEntryStatus:y,tournamentRecord:I,drawDefinition:b,event:S}=t;if(!b)return{error:$e};if(!S)return{error:vi};S.drawDefinitions||(S.drawDefinitions=[]);let{drawId:w,drawName:U,entries:T}=b,{entries:D}=S,P=0;if(g!==void 0&&g!==S.drawDefinitions.length)return{error:se,info:"drawDefintions count mismatch"};let{flightProfile:E}=Hi({event:S}),R=m&&((e=E==null?void 0:E.flights)==null?void 0:e.find(B=>B.flightNumber===m.flightNumber)),N=(n=(r=(i=E==null?void 0:E.links)==null?void 0:i.find(B=>{var V;return((V=B==null?void 0:B.target)==null?void 0:V.drawId)===w}))==null?void 0:r.source)==null?void 0:n.drawId;if(N&&!S.drawDefinitions.find(B=>B.drawId===N))return te({result:{error:$e},info:{sourceDrawId:N}});if(R&&R.drawId!==b.drawId)return te({result:{error:sm},info:{relevantFlight:R}});let A=T==null?void 0:T.every(({participantId:B,entryStatus:V})=>{let G=R==null?void 0:R.drawEntries.find(j=>j.participantId===B);return!V||(G==null?void 0:G.entryStatus)===V}),M=!y||D&&(T==null?void 0:T.every(({participantId:B,entryStatus:V,entryStage:G})=>{var j;return((j=D.find(z=>z.participantId===B&&(!z.entryStage||z.entryStage===G)))==null?void 0:j.entryStatus)===V}));if(R&&!A)return te({result:{error:sm},context:{drawEntriesPresentInFlight:A,matchingEventEntries:M,relevantFlight:R},info:"Draw entries are not present in flight or do not match entryStatuses"});if(f&&(T==null||T.filter(Boolean).forEach(B=>{if(B!=null&&B.entryStatus&&ds.includes(B==null?void 0:B.entryStatus)){let V=D==null?void 0:D.filter(Boolean).find(G=>G.participantId===B.participantId);V&&B.entryStatus&&(V==null?void 0:V.entryStatus)!==B.entryStatus&&(V.entryStatus=B.entryStatus,P+=1)}})),D&&!M)return te({result:{info:"Draw entries do not match event entryStatuses",context:{matchingEventEntries:M,eventEntries:D},error:sm}});let C=((o=(a=E==null?void 0:E.flights)==null?void 0:a.map(({flightNumber:B})=>!isNaN(B)&&Ze(B)))==null?void 0:o.filter(Boolean))||[],O=((s=S.drawDefinitions.map(({drawOrder:B})=>B&&Ze(B)))==null?void 0:s.filter(Boolean))||[],k=Math.max(0,...O,...C)+1,x=(l=E==null?void 0:E.flights)==null?void 0:l.find(B=>B.drawId===w),F;if(x){x.drawName=b.drawName,F={name:rs,value:{...E,flights:E.flights}};let B=x.flightNumber;B&&!O.includes(B)?k=B:x.flightNumber=k}else{let B=(E==null?void 0:E.flights)||[];B.push({manuallyAdded:!0,flightNumber:k,drawEntries:T,drawName:U,drawId:w}),F={name:rs,value:{...E||{},flights:B}}}id({event:S,extension:F}),Object.assign(b,{drawOrder:k});let $=S.drawDefinitions.find(B=>B.drawId===w),_=I==null?void 0:I.tournamentId,L=S.eventId;if($){if(!v)return{error:$K};let B=((c=(u=Pn({drawDefinition:$}))==null?void 0:u.matchUps)==null?void 0:c.map(Pr))??[],V=(d=Pn({drawDefinition:b}))==null?void 0:d.matchUps;if(!h){B!=null&&B.length&&Zu({matchUpIds:B,action:"modifyDrawDefinition",tournamentId:_,eventId:L}),V!=null&&V.length&&xc({matchUps:V,tournamentId:_,eventId:L}),S.drawDefinitions=S.drawDefinitions.map(j=>j.drawId===w?b:j);let G=(p=b.structures)==null?void 0:p.map(({structureId:j})=>j);ui({drawDefinition:b,tournamentId:_,structureIds:G,eventId:L})}}else if(S.drawDefinitions.push(b),!h){let{matchUps:B}=Pn({drawDefinition:b,event:S});B&&xc({tournamentId:I==null?void 0:I.tournamentId,matchUps:B}),uw({drawDefinition:b,tournamentId:_,eventId:L})}return{...Q,modifiedEventEntryStatusCount:P}}function qee(t){let{provisionalPositioning:e,useExistingSeedLimit:i,tournamentRecord:r,drawDefinition:n,seedingProfile:a,structureId:o,assignments:s,drawId:l,event:u}=t,c=0;if(!(s!=null&&s.length))return{error:Jx};if(!r)return{error:ve};if(!l)return{error:Fs};let d=go({provisionalPositioning:e,drawDefinition:n,structureId:o});if(d.error)return d;let{seedAssignments:p,seedLimit:m}=d,h=Object.assign({},...(p??[]).filter(v=>v.seedNumber).map(v=>({[v.seedNumber]:v})));s.forEach(v=>{let{seedNumber:y}=v;m&&y<=m&&(!i||h[y])&&(h[y]=v)});let f=Object.values(h),g=f.map(v=>v==null?void 0:v.participantId).filter(Boolean);if(g.length!==EK(g).length)return{error:BK};for(let v of f){let y=Tv({...v,provisionalPositioning:e,tournamentRecord:r,drawDefinition:n,seedingProfile:a,structureId:o,event:u});if(y!=null&&y.error)return y;y!=null&&y.success&&c++}return c?{...Q,modifications:c}:{error:dv}}function b$({deleteExisting:t,event:e,flightProfile:i}){var r;let n="attachFlightProfile";if(!i)return te({result:{error:Je},stack:n});if(!e)return te({result:{error:vi},stack:n});let{flightProfile:a}=Hi({event:e});return a&&!t?te({result:{error:hF},stack:n}):(r=e.drawDefinitions)!=null&&r.length?te({result:{error:FK},stack:n}):(id({event:e,extension:{name:rs,value:i}}),{flightProfile:Ne(i,!1,!0),...Q})}function pCe({tournamentRecord:t,scaleAttributes:e,participantIds:i}){var r;if(!t)return{error:ve};if(!i)return{error:Qc};if(!e)return{error:Je,info:"scaleAttributes required"};let{scaleType:n,eventType:a,scaleName:o}=e,s=[ZX,n,a,o].join(".");return(r=t.participants)==null||r.forEach(l=>{i.includes(l.participantId)&&l.timeItems&&(l.timeItems=l.timeItems.filter(u=>u&&(u==null?void 0:u.itemType)!==s))}),{...Q}}function w$({tournamentRecord:t,scaleAttributes:e,drawDefinition:i,entryStatuses:r,drawId:n,event:a,stage:o}){var s;if(!a)return{error:vi};if(r&&!Array.isArray(r))return te({result:{error:se},info:ip("entryStatus"),stack:"removeScaleValues"});let l=a.entries;if(n){let{flightProfile:c}=Hi({event:a}),d=(s=c==null?void 0:c.flights)==null?void 0:s.find(p=>p.drawId===n);d?l=d.drawEntries:l=i==null?void 0:i.entries}let u=(l||[]).filter(c=>(!o||!c.entryStage||c.entryStage===o)&&(!r||r.includes(c.entryStatus))).map(Tt);return pCe({tournamentRecord:t,scaleAttributes:e,participantIds:u})}function jR({removePriorValues:t,tournamentRecord:e,displaySettings:i,status:r=Qa,event:n}){if(!e)return te({result:{error:ve}});if(!n)return te({result:{error:vi}});if(!At(i))return te({result:{error:Je}});if(At(i.draws))for(let o of Object.keys(i.draws)){let s=i.draws[o].scheduleDetails??[];if(s.length){let l=[];for(let u of s){let c=l.find(d=>Vwe(d.attributes,u.attributes));c!=null&&c.dates&&u.dates?c.dates.push(...u.dates):l.push(u)}i.draws[o].scheduleDetails=l}}let a=Nv({statusObject:{displaySettings:i},removePriorValues:t,status:r,event:n});return a.error?a:{...Q}}function Yee({tournamentRecord:t,drawDefinition:e,entryStatuses:i,scaleName:r,drawId:n,event:a,stage:o}){var s,l;if(!t)return{error:ve};if(!a)return{error:vi};r=r||((s=a.category)==null?void 0:s.categoryName)||((l=a.category)==null?void 0:l.ageCategoryCode);let u={eventType:a.eventType,scaleType:xl,scaleName:r};return w$({tournamentRecord:t,scaleAttributes:u,drawDefinition:e,entryStatuses:i,drawId:n,event:a,stage:o})}function Kee(t){let e=We(t,[{[Ur]:!0},{eventIds:!0,[Jn]:cn}]);if(e.error)return e;let{removePairParticipants:i,tournamentRecord:r,eventIds:n}=t,a=[],o=[],s=[],l=[];if(r.events=(r.events||[]).filter(u=>{if(n.includes(u.eventId)){let p={action:oS,payload:{events:[u]}};a.push(p),o.push({tournamentId:r.tournamentId,eventName:u.eventName,eventType:u.eventType,category:u.category,eventId:u.eventId,gender:u.gender})}let c=u.eventType===ho?(u.entries||[]).map(({entryStatus:p,participantId:m})=>p!==Po&&m).filter(Boolean):[],d=n.includes(u.eventId);return d?l.push(...c):s.push(...c),!d}),i){let u=l.filter(c=>!s.includes(c));r.participants=r.participants.filter(({participantId:c})=>!u.includes(c))}if(Yw({tournamentRecord:r}),a.length)if(yP(vu)){let u=r.tournamentId;ut({topic:vu,payload:{type:oS,tournamentId:u,detail:a}})}else Vw({tournamentRecord:r,timeItem:{itemValue:o,itemType:oS}});return{...Q}}function Xee(t){var e,i,r;let n=We(t,[{tournamentRecord:!0,eventId:!0,event:!0},{eventUpdates:!0,_ofType:ta}]);if(n.error)return n;let{eventUpdates:a,event:o}=t,s="modifyEvent",l=fCe(t),u=gCe({enteredParticipants:l}),{enteredParticipantGenders:c,enteredParticipantTypes:d}=u,p=(i=(e=Hi({event:o}))==null?void 0:e.flightProfile)==null?void 0:i.flights,m=!((r=o.drawDefinitions)!=null&&r.length)&&!(p!=null&&p.length),h=vCe({noFlightsNoDraws:m,enteredParticipantGenders:c,eventUpdates:a,stack:s});if(h.error)return h;let f=ICe({enteredParticipantTypes:d,eventUpdates:a,stack:s});if(f.error)return f;let g=mCe({...t,...u,enteredParticipants:l,stack:s});if(g.error)return g;let v=hCe({...t,stack:s});return v.error?v:(a.eventType&&(o.eventType=a.eventType),a.eventName&&(o.eventName=a.eventName),a.gender&&(o.gender=a.gender),{...Q})}function mCe(t){var e,i,r,n,a,o;let s=(e=t.eventUpdates)==null?void 0:e.category;if(!s)return{...Q};let l=ty({category:s});if(l.error)return l;if(t.event.eventType===ur){let u=((r=(i=t.event)==null?void 0:i.drawDefinitions)==null?void 0:r.map(p=>$s(p)))??[],c=$s(t.event),d=(((n=au(t))==null?void 0:n.matchUps)??[]).map(p=>$s(p))??[];if(![c,...u,...d].filter(Boolean).every(p=>p.collectionDefinitions.every(m=>!m.category||ew({category:t.eventUpdates.category,childCategory:m.category}))))return te({result:{error:KI},stack:t.stack})}if((a=t.enteredParticipants)!=null&&a.length){let u=t.eventUpdates.startDate||t.event.startDate||t.tournamentRecord.startDate,c=t.eventUpdates.endDate||t.event.endDate||t.tournamentRecord.endDate,d=t.enteredParticipants.map(h=>h.participantType===Dt?h:h.individualParticpants??[]).flat(),p=Nm({category:s,consideredDate:u}),m=Nm({category:s,consideredDate:c});if(p!=null&&p.ageMinDate||p!=null&&p.ageMaxDate||m!=null&&m.ageMinDate||m!=null&&m.ageMaxDate)for(let h of d){let f=(o=h.person)==null?void 0:o.birthDate;if(!f)return te({result:{error:a9},stack:t.stack});let g=new Date(f).getTime();if(p.ageMinDate||p.ageMaxDate){let v=new Date(p.ageMinDate).getTime(),y=new Date(p.ageMaxDate).getTime();if(g<v||g>y)return te({result:{error:uM},stack:t.stack})}if(m.ageMin||m.ageMax){let v=new Date(m.ageMinDate).getTime(),y=new Date(m.ageMaxDate).getTime();if(g<v||g>y)return te({result:{error:uM},stack:t.stack})}}}return{...Q}}function hCe(t){let{tournamentRecord:e,eventUpdates:i,event:r,stack:n}=t;if(i.startDate||i.endDate){let a=v$({startDate:i.startDate,endDate:i.endDate,tournamentRecord:e,event:r});if(a.error)return te({result:a,stack:n})}return{...Q}}function fCe(t){var e;let{tournamentRecord:i,event:r}=t,n=((e=r==null?void 0:r.entries)==null?void 0:e.filter(({entryStatus:a})=>{let o=a;return[...ds,qo].includes(o)}).map(({participantId:a})=>a))??[];return n?Oi({participantFilters:{participantIds:n},withIndividualParticipants:!0,tournamentRecord:i}).participants??[]:[]}function gCe({enteredParticipants:t}){let e=[],i=t.reduce((n,a)=>{var o,s;let l=(o=a.person)!=null&&o.sex?[a.person.sex]:((s=a.individualParticpants)==null?void 0:s.map(u=>{var c;return(c=u.person)==null?void 0:c.sex}))||[];return e.push(...l),n.includes(a.participantType)?n:n.concat(a.participantType)},[]),r=dt(e);return{enteredParticipantTypes:i,enteredParticipantGenders:r}}function vCe({noFlightsNoDraws:t,enteredParticipantGenders:e,eventUpdates:i,stack:r}){let n=!e.length||!i.gender||i.gender===As||e.length===1&&e[0]===i.gender||t&&i.gender===jn;return i.gender&&!n?te({context:{gender:i.gender,validGender:n},result:{error:tI},stack:r}):{...Q}}function ICe({enteredParticipantTypes:t,eventUpdates:e,stack:i}){let r=(t.includes(ur)&&[ur]||t.includes(Dt)&&[sl]||t.includes(ft)&&[ho]||[ho,sl,ur]).includes(e.eventType??"");return e.eventType&&!r?te({context:{participantType:e.eventType,validEventType:r},result:{error:Wl},stack:i}):{...Q}}function GR({qualifyingPositions:t,drawEntries:e=[],drawName:i,drawId:r,event:n,stage:a}){var o,s,l;let u="addFlight";if(!n)return te({result:{error:vi},stack:u});if(!i)return te({result:{error:Je},stack:u});if(e!=null&&e.length){let g=(n.entries??[]).map(Tt),v=e.map(Tt);if(ji(v,g).length!==v.length)return te({result:{error:se},stack:u})}let c=(o=Hi({event:n}))==null?void 0:o.flightProfile,d=((l=(s=c==null?void 0:c.flights)==null?void 0:s.map(({flightNumber:g})=>!isNaN(g)&&Ze(g)))==null?void 0:l.filter(Boolean))||[],p=Math.max(0,...d)+1,m={drawId:r||Ht(),flightNumber:p,drawEntries:e,drawName:i};if(a&&(m.stage=a),t&&(m.qualifyingPositions=t),((c==null?void 0:c.flights)||[]).find(({drawId:g})=>g===m.drawId))return te({result:{error:_9},stack:u});let h=((c==null?void 0:c.flights)||[]).concat(m),f={name:rs,value:{...c||{},flights:h}};return id({event:n,extension:f})}var Jee={};bt(Jee,{drawMatic:()=>O_,garman:()=>nte,generateAdHocMatchUps:()=>gR,generateAdHocRounds:()=>A_,generateAndPopulatePlayoffStructures:()=>l_,generateCourts:()=>U$,generateDrawDefinition:()=>Jw,generateDrawMaticRound:()=>U_,generateDrawStructuresAndLinks:()=>y_,generateDrawTypeAndModifyDrawDefinition:()=>b_,generateFlightProfile:()=>wCe,generateLineUps:()=>rte,generateQualifyingStructure:()=>ZL,generateSeedingScaleItems:()=>Pee,generateStatCrew:()=>UCe,generateVoluntaryConsolation:()=>aZ,roundRobinGroups:()=>ETe});var yCe="splitLevelBased",Qee="splitWaterfall",Zee="splitShuttle",bCe={SPLIT_LEVEL_BASED:yCe,SPLIT_WATERFALL:Qee,SPLIT_SHUTTLE:Zee};function wCe(t){let{drawNameRoot:e="Flight",attachFlightProfile:i,tournamentRecord:r,scaleAttributes:n,scaleSortMethod:a,deleteExisting:o,sortDescending:s,drawNames:l=[],flightsCount:u,splitMethod:c,uuids:d=[],event:p,stage:m}=t;if(!p)return{error:vi};let h=p.entries??[],{flightProfile:f}=Hi({event:p});if(f&&i&&!o)return{error:hF};let g=t.scaledEntries??Vh({tournamentRecord:r,scaleAttributes:n,scaleSortMethod:a,sortDescending:s,event:p,stage:m}).scaledEntries,v=g.map(Tt),y=Tn(h.filter(({participantId:P})=>!v.includes(P)).filter(P=>(!m||!P.entryStage||P.entryStage===m)&&(!P.entryStatus||Np.includes(P.entryStatus)))),I=g.concat(...y),b=I.length,S=Math.ceil(b/u),w=Cr(I,S);c===Qee?w=tM(I,u):c===Zee&&(w=tM(I,u,!0));function U(P){return(P||[]).map(({participantId:E,scaleValue:R})=>{let N=h.find(A=>A.participantId===E);return N!=null&&N.scaleValue&&R&&(N.scaleValue=R),N}).sort((E,R)=>E.scaleValue-R.scaleValue).map((E,R)=>(E.scaleValue&&(E.seedNumber=R+1),E))}let T=Te(0,u).map(P=>{let E=P+1;return{flightNumber:E,drawId:(d==null?void 0:d.pop())??Ht(),drawEntries:U(w[P]),drawName:(l==null?void 0:l.length)&&l[P]||`${e} ${E}`}}),D={scaleAttributes:n,splitMethod:c,flights:T};if(i){let P=b$({flightProfile:D,deleteExisting:o,event:p});return{splitEntries:ja()&&w||void 0,...P}}else return{flightProfile:D,...Q}}function ete({json:t,tagName:e}){let i=Object.keys(t).filter(a=>Array.isArray(t[a])).map(a=>({key:a,value:t[a].filter(o=>typeof o=="object"&&Object.keys(o).length===1)})),r=Object.keys(t).filter(a=>typeof t[a]=="object"&&!Array.isArray(t[a])).map(a=>({key:a,value:t[a]})),n=Object.keys(t).filter(a=>["string","number"].includes(typeof t[a])).map(a=>({key:a,value:t[a]}));return tte({tagName:e,attributes:n,childArrays:i,childObjects:r})}function tte(t){let{tagName:e,attributes:i=[],childArrays:r=[],childObjects:n}=t,a=`\r
`,o=m=>{let h=Object.keys(m)[0],f=m[h];return{key:h,value:f}},s=r==null?void 0:r.map(({key:m,value:h})=>tte({tagName:m,childObjects:h.map(o)})).join(`\r
`),l=n==null?void 0:n.map(({key:m,value:h})=>ete({tagName:m,json:h??[]})).join(`\r
`),u=i==null?void 0:i.map(({key:m,value:h})=>`${m}="${h}"`).join(" "),c=u?` ${u}`:"";if(e==="childArray")return l;let d=l!=null&&l.length?`${a}${l}${a}`:"",p=s!=null&&s.length?`${a}${s}${a}`:"";return`<${e}${c}>${d}${p}</${e}>`}function UCe(t){var e,i,r;let n=We(t,[{[Ur]:!0}]);if(n.error)return n;let{tournamentRecord:a}=t,{startDate:o,tournamentId:s,tournamentName:l}=a,{participantMap:u,matchUps:c,mappedMatchUps:d}=Oi({withMatchUps:!0,withEvents:!0,tournamentRecord:a}),p=a.participants.filter(w=>w.participantType===Xt),m=(c==null?void 0:c.filter(w=>w.matchUpType===Xt))??[],h=(m==null?void 0:m.reduce((w,U)=>{let T=(U==null?void 0:U.tieMatchUps)??[];return T&&[...w,...T]},[]))??[],f=(c==null?void 0:c.filter(w=>w.matchUpType===ii))??[],g=(c==null?void 0:c.filter(w=>w.matchUpType===ei))??[],v=h.length===f.length+g.length,y=m.length===1&&v,I={mappedMatchUps:d,participantMap:u,tournamentName:l,tournamentId:s,tournament:v?"N":"Y",startDate:o},b=[],S=[];if(y){let w=m[0],{json:U,xml:T}=nj({teamParticipants:p,teamMatchUp:w,...I,doubles:g,singles:f});S.push(U),b.push(T)}else for(let w of m){let U=(e=w==null?void 0:w.sides)==null?void 0:e.map(({participant:E})=>E==null?void 0:E.participantId).filter(Boolean);if((U==null?void 0:U.length)!==2)continue;let T=U.map(E=>{var R;return E&&((R=u==null?void 0:u[E])==null?void 0:R.participant)}),{xml:D,json:P}=nj({doubles:(i=w.tieMatchUps)==null?void 0:i.filter(E=>E.matchUpType===ei),singles:(r=w.tieMatchUps)==null?void 0:r.filter(E=>E.matchUpType===ii),teamParticipants:T,teamMatchUp:w,...I});S.push(P),b.push(D)}return{json:S,xml:b,...Q}}function nj({teamParticipants:t,mappedMatchUps:e,participantMap:i,tournamentName:r,tournamentId:n,teamMatchUp:a,tournament:o,startDate:s,doubles:l,singles:u}){var c,d,p,m;let h=t==null?void 0:t.find(T=>{var D;return(D=T.participantRoleResponsibilities)==null?void 0:D.includes("Home")}),f=t==null?void 0:t.filter(T=>T.participantId!==(h==null?void 0:h.participantId)),g=Ho(s,"/","MDY"),v=(h==null?void 0:h.participantName)||((c=f==null?void 0:f[1])==null?void 0:c.participantName),y=(h==null?void 0:h.participantId)||((d=f==null?void 0:f[1])==null?void 0:d.participantId),I=(p=f==null?void 0:f[0])==null?void 0:p.participantName,b=(m=f==null?void 0:f[0])==null?void 0:m.participantId,S={},w=t.map(T=>({team:{...DCe({teamParticipant:T,teamMatchUp:a,uniValues:S,participantMap:i,mappedMatchUps:e,homeid:y})}})),U=He({venue:{tournamentname:o?r:void 0,neutralgame:h?"N":"Y",gameid:n,officials:{},tournament:o,rules:{},homename:v,visname:I,homeid:y,visid:b,date:g},childArray:w,singles_matches:u==null?void 0:u.map(T=>aj({matchUp:T,homeid:y,uniValues:S})),doubles_matches:l==null?void 0:l.map(T=>aj({matchUp:T,homeid:y,uniValues:S}))});return{json:U,xml:ete({json:U,tagName:"tngame"})}}function SCe({homeid:t,uniValues:e,participant:i}){var r,n,a,o,s,l,u,c,d,p,m,h,f,g,v;if(!i)return{};let y=((r=i.individualParticipants)==null?void 0:r.length)===2,I=y?dt((n=i.individualParticipants)==null?void 0:n.map(A=>{var M,C;return(C=(M=A.teams)==null?void 0:M[0])==null?void 0:C.participantId})):[],b=y?dt((a=i.individualParticipants)==null?void 0:a.map(A=>{var M,C;return(C=(M=A.teams)==null?void 0:M[0])==null?void 0:C.teamId})):[],S=!y&&((s=(o=i.teams)==null?void 0:o[0])==null?void 0:s.participantId)||(I==null?void 0:I.length)===1&&I[0]||void 0,w=!y&&((u=(l=i.teams)==null?void 0:l[0])==null?void 0:u.teamId)||(b==null?void 0:b.length)===1&&b[0]||S,U=y?void 0:i.participantName,T=(d=(c=i.individualParticipants)==null?void 0:c[0])==null?void 0:d.participantName,D=(m=(p=i.individualParticipants)==null?void 0:p[1])==null?void 0:m.participantName,P=t&&(S===t?"H":"V")||"",E=y?void 0:e[S][i.participantId],R=e[S][(f=(h=i.individualParticipants)==null?void 0:h[0])==null?void 0:f.participantId],N=e[S][(v=(g=i.individualParticipants)==null?void 0:g[1])==null?void 0:v.participantId];return He({vh:P,uni:E,uni_1:R,uni_2:N,team:w,name:U,name_1:T,name_2:D})}function TCe({sets:t,sideNumber:e}){return Object.assign({},...(t==null?void 0:t.map(i=>{let{setNumber:r,side1Score:n,side2Score:a,side1TiebreakScore:o,side2TiebreakScore:s}=i,l=`set_${r}`,u=`tie_${r}`,c=e===1?n:a,d=e===1?o:s;return{[l]:c,[u]:d}}))??[])}function DCe({teamParticipant:t,teamMatchUp:e,participantMap:i,mappedMatchUps:r,homeid:n,uniValues:a}){var o,s,l,u,c,d,p,m,h,f,g,v,y,I;let{participantId:b,participantName:S}=t,w=n&&(b===n?"H":"V")||"",U=(o=i==null?void 0:i[b])==null?void 0:o.matchUps,T=U&&Object.keys(U),D=(l=(s=e==null?void 0:e.sides)==null?void 0:s.find(({participant:k})=>k.participantId===b))==null?void 0:l.sideNumber,P=((d=(c=(u=e==null?void 0:e.score)==null?void 0:u.sets)==null?void 0:c[0])==null?void 0:d[`side${D}Score`])??0;a[b]={};let E={SINGLES:{w:0,l:0},DOUBLES:{w:0,l:0}},R=[],N=[],A=0;for(let k of T??[]){let x=r==null?void 0:r[k],F=(p=x.sides.find(({participant:_})=>_.participantId===b))==null?void 0:p.sideNumber,$=((f=(h=(m=x.score)==null?void 0:m.sets)==null?void 0:h[0])==null?void 0:f[`side${F}Score`])??0;A+=$;for(let _ of x.tieMatchUps??[]){let{matchUpType:L,winningSide:B}=_,V=B&&(B===F?"w":"l")||"";V&&(E[L][V]+=1);let G=V==="w"?"1":"0",j=V==="l"?"1":"0";if(L===ii){let z=N.length+1;N.push({singles_pair:{pair:z,won:G,lost:j,tied:"0"}})}else if(L===ei){let z=R.length+1;R.push({doubles_pair:{pair:z,won:G,lost:j,tied:"0"}})}}}let M=[{singles:{childArray:N,won:E.SINGLES.w,lost:E.SINGLES.l}},{doubles:{childArray:R,won:E.DOUBLES.w,lost:E.DOUBLES.l}}],C=[],O=1;for(let k of t.individualParticipantIds){let x=i==null?void 0:i[k];if(x){let{participant:F,counters:$}=x,_={won:((g=$==null?void 0:$.DOUBLES)==null?void 0:g.wins)||0,lost:((v=$==null?void 0:$.DOUBLES)==null?void 0:v.losses)||0},L={won:((y=$==null?void 0:$.SINGLES)==null?void 0:y.wins)||0,lost:((I=$==null?void 0:$.SINGLES)==null?void 0:I.losses)||0},{participantName:B,participantId:V}=F;a[b][V]=O,C.push({player:{name:B,uni:O,singles:L,doubles:_}})}O+=1}return{vh:w,id:b,name:S,score:P||A,totals:M,childArray:C}}function aj({matchUp:t,homeid:e,uniValues:i}){let{collectionPosition:r,orderOfFinish:n,matchUpType:a,sides:o}=t??{},s=o==null?void 0:o.map(l=>{var u;let{sideNumber:c,participant:d}=l,p=TCe({sets:(u=t.score)==null?void 0:u.sets,sideNumber:c});return{[a===ii?"singles_score":"doubles_score"]:{...SCe({homeid:e,uniValues:i,participant:d}),...p}}});return{[a===ii?"singles_match":"doubles_match"]:{match:r,order:n,childArray:s}}}var PCe="ASC",ite="ASC",RCe="DESC",KM="DESC",ECe={ASC:PCe,ASCENDING:ite,DESC:RCe,DESCENDING:KM};function rte(t){var e,i,r,n,a;let{tieFormat:o}=t,{useDefaultEventRanking:s,tournamentRecord:l,drawDefinition:u,scaleAccessor:c,singlesOnly:d,attach:p,event:m}=t;if((m==null?void 0:m.eventType)!==Ea)return{error:Wl};if(!l)return{error:ve};if(!o&&!u)return{error:Va};if(o=o??((e=In({drawDefinition:u,event:m}))==null?void 0:e.tieFormat),qn({tieFormat:o}).error)return{error:kl};if(typeof c!="object"&&!s)return{error:se,context:{scaleAccessor:c}};let h={},f=((u==null?void 0:u.entries)??(m==null?void 0:m.entries)??[]).filter(C=>(C==null?void 0:C.entryStatus)===ca).map(Tt),{participants:g=[]}=Oi({withIndividualParticipants:!0,withScaleValues:!0,tournamentRecord:l}),v=g.filter(({participantId:C})=>f.includes(C)),y=C=>C===Nc?"rankings":"ratings",I=((i=m==null?void 0:m.category)==null?void 0:i.categoryName)??((r=m==null?void 0:m.category)==null?void 0:r.ageCategoryCode),{scaleName:b=I,scaleType:S=Nc,sortOrder:w,accessor:U}=c||{},T=y(S),D=(C,O)=>{var k,x,F;let $=(k=C[T])==null?void 0:k[O];if(!$&&s&&($=(x=C[T])==null?void 0:x[om]),Array.isArray($)){let _=(F=$.find(L=>L.scaleName===b))==null?void 0:F.scaleValue;if(_i(_))return _;if(U&&typeof _=="object")return _[U]}return 0},P=(C,O,k)=>{let x=w===KM?O:C,F=w===KM?C:O;return D(x,k)-D(F,k)},E=(C,O)=>P(C,O,om),R=(C,O)=>P(C,O,Wd),N=[],A=(o==null?void 0:o.collectionDefinitions)??[];for(let C of v){let O=((n=C.individualParticipants)==null?void 0:n.sort(E))??[],k=d?O:((a=C.individualParticipants)==null?void 0:a.sort(R))??[],x={};for(let $ of A){let _=[],{collectionId:L,matchUpCount:B,matchUpType:V,gender:G}=$,j=Xi(om)(V);Te(0,B).forEach(z=>{let W=j?O:k??[],q=z+1,Y=[];Te(0,j?1:2).forEach(re=>{var K;let H=(K=W==null?void 0:W.find(Z=>{var X;let ie=G&&([Qt,mi].includes(G)&&G||G===jn&&[Qt,mi][re]);return(!ie||ie===((X=Z.person)==null?void 0:X.sex))&&!_.includes(Z.participantId)}))==null?void 0:K.participantId;H&&(Y.push(H),_.push(H),x[H]||(x[H]=[]),x[H].push({collectionPosition:q,collectionId:L}))}),j||N.push(Y)})}let F=Object.keys(x).map($=>({collectionAssignments:x[$],participantId:$}));h[C.participantId]=F}let M=[];for(let C of N){let{participant:O}=as({tournamentParticipants:g,participantIds:C});if(!O){let k={individualParticipantIds:C,participantRole:en,participantType:ft};M.push(k)}}if(p){for(;M.length;)pl({participant:M.pop(),tournamentRecord:l});_t({element:u,extension:{name:Fu,value:h}})}return{...Q,lineUps:h,participantsToAdd:M}}function U$(t){if(!t)return{error:Je};let e=We(t,[{dates:!1,[Xr]:o=>Array.isArray(o)&&o.every(ba)},{uuids:!1,[Xr]:o=>Array.isArray(o)&&o.every(Di)},{startTime:!1,endTime:!1,[Xr]:TF},{idPrefix:!1,namePrefix:!1,[Xr]:Di},{count:!0,[Xr]:_i}]);if(e.error)return e;let{startDate:i,endDate:r}=t.tournamentRecord??{},n=t.dates||i&&r&&Zf(i,r)||[],a=Te(1,t.count+1).map(o=>{var s,l;return He({courtId:((s=t.uuids)==null?void 0:s.pop())??(t.idPrefix&&`${t.idPrefix}-${o}`)??Ht(),courtName:((l=t.courtNames)==null?void 0:l.pop())??(t.namePrefix&&`${t.namePrefix} ${o}`),dateAvailability:n.map(u=>({startTime:t.startTime??"08:00",endTime:t.endTime??"20:00",date:u}))})});return{...Q,courts:a}}var nte={};bt(nte,{default:()=>NCe,garman:()=>ste});function Zw({court:t,date:e}){let i=e&&t.dateAvailability.find(n=>ql(n.date,e)),r=t.dateAvailability.find(n=>!n.date);return i||r}function Ov(t){let e=We(t,[{courtDate:!0,_ofType:ta}]);if(e.error)return e;let{includeBookingTypes:i=[],courtDate:r}=t,n=[],a=rr(r.startTime);(r.bookings||[]).filter(s=>!s.bookingType||!i.includes(s.bookingType)).sort((s,l)=>t0(s.startTime).localeCompare(t0(l.startTime))).forEach(s=>{let l={startTime:Ui(a.toISOString()),endTime:s.startTime};rr(s.startTime)>a&&n.push(l),rr(s.endTime)>a&&(a=rr(s.endTime))});let o={startTime:Ui(a.toISOString()),endTime:r.endTime};return rr(r.endTime)>a&&n.push(o),{timeSlots:n}}function CCe({averageMatchUpMinutes:t,includeBookingTypes:e,periodStartTime:i,periodEndTime:r}){let n=o=>{var s;let{timeSlots:l}=Ov({includeBookingTypes:e,courtDate:o});return!!((s=l==null?void 0:l.filter(a))!=null&&s.length)};function a(o){let s=rr(o.startTime),l=rr(o.endTime);return s>i||l<r?!1:Zb(i,l)>=t}return{enoughTime:n}}function ate(t){let e=We(t,[{periodStart:!0,date:!0},{courts:!0,_ofType:cn}]);if(e.error)return e;let{averageMatchUpMinutes:i,includeBookingTypes:r,periodStart:n,date:a}=t,o=t.courts,s=rr(n),l=PF(s,i),{enoughTime:u}=CCe({averageMatchUpMinutes:i,includeBookingTypes:r,periodStartTime:s,periodEndTime:l});return{availableToScheduleCount:((o==null?void 0:o.filter(c=>{if(!Array.isArray(c.dateAvailability))return!1;let d=Zw({date:a,court:c});return!!(d&&u(d))}))||[]).length,...Q}}function HR(t){var e;let{remainingScheduleTimes:i=[],clearScheduleDates:r,periodLength:n=30,scheduleDate:a,courts:o=[]}=t,{bookings:s=[]}=t;if(!Array.isArray(o)||!o.length)return{error:se,courts:o};if(!Array.isArray(s))return{error:JS};if(!ba(a))return{error:Fr};r&&(Array.isArray(r)?r.includes(a)&&(s=[]):s=[]);let{courtBookings:l,unassignedBookings:u}=s.reduce((m,h)=>{let{courtId:f}=h;return f?m.courtBookings[f]?m.courtBookings[f].push(h):m.courtBookings[f]=[h]:m.unassignedBookings.push(h),m},{courtBookings:{},unassignedBookings:[]}),c=o.map((m,h)=>{let{courtId:f,courtName:g}=m,v=l[f]||[],y=Zw({date:a,court:m})||{},{bookings:I=[],startTime:b,endTime:S,date:w}=y,U=[i[h]&&{startTime:b,endTime:i[h]},...Ne(I,!1,!0),...v].filter(Boolean);return{courtId:f,courtName:g,dateAvailability:{bookings:U,startTime:b,endTime:S,date:w}}});u.sort((m,h)=>xt(m.startTime)-xt(h.startTime));let d=()=>c.map(m=>{let h=m.dateAvailability,{timeSlots:f=[]}=Ov({courtDate:h});return{courtName:m.courtName,courtId:m.courtId,timeSlots:f}}).flat(),p=[];for(let m of u){let{startTime:h,endTime:f,averageMinutes:g,recoveryMinutes:v,matchUpId:y}=m,I=xt(h),b=xt(f),S=d().reduce((w,{courtId:U,courtName:T,timeSlots:D})=>{let P;return D.find(({startTime:E,endTime:R})=>{P=xt(E)-I;let N=I>=xt(E);return b<=xt(R)&&w.startDifference!==0&&((P===0||P+n>=0)&&(w.startDifference===void 0||P<w.startDifference)||N)})?{courtName:T,courtId:U,startDifference:P}:w},{});if(S.courtId){let w={averageMinutes:g,recoveryMinutes:v,matchUpId:y,startTime:h,endTime:f};p.push(w),(e=c.find(({courtId:U})=>U===S.courtId))==null||e.dateAvailability.bookings.push(w)}else console.log({unassignedBooking:m})}return{virtualCourts:c.map(({courtId:m,courtName:h,dateAvailability:f})=>({dateAvailability:[f],courtName:h,courtId:m})),assignedBookings:p}}function zR({averageMatchUpMinutes:t,periodLength:e=30,recoveryMinutes:i}){let r=(t||90)+(i||0);return e>r?r:e||30}function ote(t){let{startTime:e="8:00",endTime:i="20:30",count:r=10,date:n}=t??{};return Te(0,r).map(()=>({dateAvailability:[{date:n,startTime:e,endTime:i}]}))}function vg({scheduleDate:t,startTime:e,endTime:i,courts:r}){let n=e&&"startTime"||i&&"endTime"||void 0;return r.reduce((a,o)=>{let s=Zw({date:t,court:o}),l=n&&((s==null?void 0:s[n])||o[n]);return l&&(!a||e&&xt(l)<xt(a)||i&&xt(l)>xt(a))?l:a},void 0)}function MCe({averageMinutes:t,startTime:e,endTime:i,courts:r,date:n}){e=e||vg({courts:r,scheduleDate:n,startTime:!0}),i=i||vg({courts:r,scheduleDate:n,endTime:!0});let a;if(e&&i){let o=rr(e),s=rr(i);for(let l of r||[]){if(!Array.isArray(l.dateAvailability))continue;let u=Zw({court:l,date:n}),{timeSlots:c}=Ov({courtDate:u});c==null||c.forEach(d=>{let p=rr(d.startTime),m=rr(d.endTime);if(p>s||p<o||m<o)return!1;if(Zb(p,m)>=t){let h=Ui(p.toISOString());(!a||h<a)&&(a=h)}})}}return{firstTimeSlotStartTime:a}}function S$(t){let e=We(t,[{courts:!0,_ofType:cn}]);if(e.error)return e;let{date:i=SF(),startTime:r="08:00",endTime:n="19:00",periodLength:a,courts:o}=t,{calculateStartTimeFromCourts:s=!0,remainingScheduleTimes:l,averageMatchUpMinutes:u,clearScheduleDates:c,courtsCount:d,bookings:p}=t;a=a||zR({averageMatchUpMinutes:u}),i=mt(i),r=Ui(r),n=Ui(n);let m=0,h=0,f=0,g=0,v=0;!o&&d&&(o=ote({startTime:r,endTime:n,count:d,date:i}));let{virtualCourts:y}=HR({remainingScheduleTimes:l,clearScheduleDates:c,scheduleDate:i,periodLength:a,bookings:p,courts:o}),{firstTimeSlotStartTime:I}=MCe({averageMinutes:u,courts:y,startTime:r,endTime:n,date:i});s&&I&&(r=I||r);let b=xt(r),S=xt(n)-b,w=Math.floor(S/a),U=Te(0,w+1).map(T=>{let D=b+T*a,P=HUe(D),E=ate({courts:y??[],averageMatchUpMinutes:u,periodStart:P,date:i});if(E.error)return{error:E.error};let{availableToScheduleCount:R=0}=E,N=R>h?R-h:0;v+=T?R:0;let A=T?v/T:R,M=a*A/u,C=T?M*(T-1)+A:A,O=R?h&&C-m||N:0;m=C,h=R,f+=O;let k=Ze(f)-g;return g+=k,{periodStart:P,add:k,availableToScheduleCount:R,newCourts:N,totalMatchUps:g}});return{scheduleTimes:U.reduce((T,D)=>{let P=Te(0,D.add).map(()=>({scheduleTime:D.periodStart}));return T.concat(...P)},[]).flat(),timingProfile:U,totalMatchUps:g}}var ste={getCourtsAvailableAtPeriodStart:ate,generateTimeSlots:Ov,getScheduleTimes:S$,courtGenerator:ote},NCe=ste,lte={};bt(lte,{isValid:()=>Ra,isValidMatchUpFormat:()=>Ra,parse:()=>Ln,stringify:()=>SP});var ute={};bt(ute,{allCompetitionMatchUps:()=>Os,allDrawMatchUps:()=>Pn,allEventMatchUps:()=>au,allTournamentMatchUps:()=>Hr,analyzeMatchUp:()=>yy,applyLineUps:()=>Ate,assignMatchUpSideParticipant:()=>dte,assignTieMatchUpParticipantId:()=>D0,bulkMatchUpStatusUpdate:()=>Ete,calculateWinCriteria:()=>Gh,checkInParticipant:()=>D$,checkMatchUpIsComplete:()=>Cd,checkOutParticipant:()=>T$,competitionScheduleMatchUps:()=>Xw,disableTieAutoCalc:()=>Dte,drawMatchUps:()=>s$,enableTieAutoCalc:()=>Ute,eventMatchUps:()=>LR,filterMatchUps:()=>pu,findMatchUp:()=>z_,getAllDrawMatchUps:()=>fr,getAllStructureMatchUps:()=>qt,getCheckedInParticipantIds:()=>Ah,getCompetitionMatchUps:()=>Iy,getEventMatchUpFormatTiming:()=>Q_,getHomeParticipantId:()=>i$,getMatchUpCompetitiveProfile:()=>bw,getMatchUpContextIds:()=>r$,getMatchUpDailyLimits:()=>$R,getMatchUpDailyLimitsUpdate:()=>Z_,getMatchUpDependencies:()=>ps,getMatchUpFormat:()=>n$,getMatchUpFormatTiming:()=>ww,getMatchUpFormatTimingUpdate:()=>J_,getMatchUpScheduleDetails:()=>JP,getMatchUpType:()=>QP,getMatchUpsStats:()=>a$,getModifiedMatchUpFormatTiming:()=>FR,getParticipantResults:()=>_w,getPredictiveAccuracy:()=>t$,getRoundMatchUps:()=>An,getRounds:()=>o$,isValidMatchUpFormat:()=>Ra,matchUpActions:()=>hR,mutate:()=>cte,participantScheduledMatchUps:()=>e$,query:()=>yee,removeDelegatedOutcome:()=>Ste,removeMatchUpSideParticipant:()=>E$,removeTieMatchUpParticipantId:()=>mte,replaceTieMatchUpParticipantId:()=>R$,resetAdHocMatchUps:()=>Mte,resetMatchUpLineUps:()=>x$,resetScorecard:()=>L$,resetTieFormat:()=>F$,setDelegatedOutcome:()=>Cte,setMatchUpFormat:()=>Pte,setMatchUpStatus:()=>tU,setOrderOfFinish:()=>Nte,substituteParticipant:()=>Tte,tallyParticipantResults:()=>Rv,toggleParticipantCheckInState:()=>WR,tournamentMatchUps:()=>_R,updateTieMatchUpScore:()=>ic,validMatchUp:()=>WP,validMatchUps:()=>Ro});var cte={};bt(cte,{applyLineUps:()=>Ate,assignMatchUpSideParticipant:()=>dte,assignTieMatchUpParticipantId:()=>D0,bulkMatchUpStatusUpdate:()=>Ete,checkInParticipant:()=>D$,checkOutParticipant:()=>T$,disableTieAutoCalc:()=>Dte,enableTieAutoCalc:()=>Ute,findMatchUp:()=>z_,removeDelegatedOutcome:()=>Ste,removeMatchUpSideParticipant:()=>E$,removeTieMatchUpParticipantId:()=>mte,replaceTieMatchUpParticipantId:()=>R$,resetAdHocMatchUps:()=>Mte,resetMatchUpLineUps:()=>x$,resetScorecard:()=>L$,resetTieFormat:()=>F$,setDelegatedOutcome:()=>Cte,setMatchUpFormat:()=>Pte,setMatchUpStatus:()=>tU,setOrderOfFinish:()=>Nte,substituteParticipant:()=>Tte,toggleParticipantCheckInState:()=>WR,updateTieMatchUpScore:()=>ic});function dte({tournamentRecord:t,drawDefinition:e,participantId:i,sideNumber:r,matchUpId:n,event:a}){var o,s;if(i&&typeof i!="string")return{error:Ms};if(!e)return{error:$e};if(!n)return{error:bn};let l=r===void 0;if(l&&(r=1),![1,2].includes(r))return te({result:{error:se,context:{sideNumber:r}}});let{matchUp:u,structure:c}=Si({drawDefinition:e,matchUpId:n,event:a});if(!u)return{error:hn};if(!(!(c!=null&&c.structures)&&!(e.drawType&&e.drawType!==Ga)&&!((o=c==null?void 0:c.matchUps)!=null&&o.find(({roundPosition:d})=>!!d))))return{error:qx};if(!i&&((s=u==null?void 0:u.score)!=null&&s.scoreStringSide1||yr.includes(u==null?void 0:u.matchUpstatus)||u!=null&&u.matchUpStatus&&[tr,dr].includes(u.matchUpStatus)))return{error:cP,info:"matchUp has completed status or score"};if(u){if(u.sides=[1,2].map(d=>{var p;let m=((p=u.sides)==null?void 0:p.find(h=>h.sideNumber===d))??{sideNumber:d};return r===d?{...m,participantId:i}:m}),l)for(let d of u.sides)d.sideNumber&&(d.sideNumber=3-d.sideNumber);Et({tournamentId:t==null?void 0:t.tournamentId,context:"assignSideParticipant",drawDefinition:e,matchUp:u})}return{...Q,sidesSwapped:l}}function Na({removePriorValues:t,tournamentRecord:e,duplicateValues:i,drawDefinition:r,disableNotice:n,matchUpId:a,timeItem:o,event:s}){let{matchUp:l}=Si({drawDefinition:r,event:s,matchUpId:a});if(!l)return{error:hn};let u=wl({removePriorValues:t,element:l,duplicateValues:i,timeItem:o});return n||Et({tournamentId:e==null?void 0:e.tournamentId,eventId:s==null?void 0:s.eventId,context:"addTimeItem",drawDefinition:r,matchUp:l}),u}function T$(t){var e;let i=[{[Ur]:!0},{[$n]:!0},{[Xl]:!0},{[Il]:!0}],r=We(t,i);if(r.error)return r;let n=Cv(t,[{[hv]:ru,attr:{[NP]:!0}}]);if(n.error)return n;let{tournamentRecord:a,drawDefinition:o,participantId:s,matchUpId:l}=t,u=(e=n==null?void 0:n.matchUp)==null?void 0:e.matchUp,{matchUpStatus:c,score:d}=u??{};if(c&&KF.includes(c)||c&&yr.includes(c)||br({score:d}))return{error:GK};let p=Ah({matchUp:u});if(p!=null&&p.error)return p;let{checkedInParticipantIds:m,allRelevantParticipantIds:h}=p??{};if(!(h!=null&&h.includes(s)))return{error:Ms};if(!(m!=null&&m.includes(s)))return{error:v9};let f=qX({matchUp:u});if(f!=null&&f.error)return f;let{sideParticipantIds:g,nestedIndividualParticipantIds:v}=f??{},y=g==null?void 0:g.indexOf(s);return y!==void 0&&[0,1].includes(y)&&((v==null?void 0:v[y])??[]).forEach(I=>{Na({drawDefinition:o,matchUpId:l,timeItem:{itemType:u0,itemValue:I}})}),Na({tournamentRecord:a,drawDefinition:o,matchUpId:l,timeItem:{itemValue:s,itemType:u0}}),{...Q,checkedOut:!0}}function D$(t){var e;let i=[{[Ur]:!0},{[$n]:!0},{[Xl]:!0},{[Il]:!0}],r=We(t,i);if(r[Wo])return r;let n=Cv(t,[{[hv]:ru,attr:{[NP]:!0}}]);if(n[Wo])return n;let{tournamentRecord:a,drawDefinition:o,participantId:s,matchUpId:l}=t,u=Ah({matchUp:(e=n==null?void 0:n.matchUp)==null?void 0:e.matchUp});if(u!=null&&u.error)return u;let{checkedInParticipantIds:c,allRelevantParticipantIds:d}=u??{};if(!(d!=null&&d.includes(s)))return{[Wo]:Ms};let p={...Q,checkedIn:!0};return c!=null&&c.includes(s)||Na({tournamentRecord:a,drawDefinition:o,matchUpId:l,timeItem:{itemValue:s,itemType:l0}}),p}function WR(t){var e,i;let r=We(t,[{[Xl]:!0,[$n]:!0,[Il]:!0}]);if(r.error)return r;let n=t.tournamentId??t.activeTournamentId,a=t.tournamentRecord??(n&&((e=t.tournamentRecords)==null?void 0:e[n]));if(!a)return{error:ve};let o=(i=Cv(t,[{[hv]:ru,attr:{[NP]:!0},[Wo]:hn}]).matchUp)==null?void 0:i.matchUp;if(!o)return{error:hn};let{checkedInParticipantIds:s=[]}=Ah({matchUp:o}),{participantId:l,matchUpId:u,drawDefinition:c}=t;return l&&s.includes(l)?T$({tournamentRecord:a,drawDefinition:c,participantId:l,matchUpId:u,matchUp:o}):D$({tournamentRecord:a,drawDefinition:c,participantId:l,matchUpId:u,matchUp:o})}function P$({tournamentRecord:t,drawDefinition:e,tieMatchUpId:i,event:r}){var n,a;if(!t)return{error:ve};if(!e)return{error:Fs};if(!r)return{error:mo};let o=ln({drawDefinition:e}),{matchUp:s}=Si({matchUpId:i,drawDefinition:e,matchUpsMap:o});if(!s)return{error:hn};let{matchUp:l,structure:u}=Si({tournamentParticipants:t.participants,matchUpId:i,inContext:!0,drawDefinition:e,matchUpsMap:o,event:r});if(!l)return{error:hn};let{collectionPosition:c,drawPositions:d,collectionId:p,matchUpTieId:m,matchUpType:h}=l;if(h&&!nP([ii,ei],h))return{error:la};let{positionAssignments:f}=si({structure:u}),g=f==null?void 0:f.filter(T=>d==null?void 0:d.includes(T.drawPosition)),{matchUp:v}=Si({matchUpId:m,drawDefinition:e,matchUpsMap:o}),y=((n=v==null?void 0:v.sides)==null?void 0:n.map(Tt))??[],I=(g==null?void 0:g.map(Tt))??[],b=[...y,...I],{participants:S}=Oi({tournamentRecord:t,participantFilters:{participantTypes:[Xt],participantIds:b}}),{matchUp:w}=Si({matchUpId:m,inContext:!0,drawDefinition:e,matchUpsMap:o}),U=(a=In({matchUp:v,drawDefinition:e,structure:u,event:r}))==null?void 0:a.tieFormat;return{inContextDualMatchUp:w,inContextTieMatchUp:l,relevantAssignments:g,collectionPosition:c,teamParticipants:S,collectionId:p,matchUpType:h,dualMatchUp:v,tieMatchUp:s,tieFormat:U,structure:u,...Q}}function R$(t){var e,i,r,n,a,o,s,l,u,c,d,p,m,h,f,g;let v=P$(t);if(v.error)return v;let y="replaceTieMatchUpParticipantid",{existingParticipantId:I,tournamentRecord:b,newParticipantId:S,drawDefinition:w,substitution:U,event:T}=t;if(!I||!S)return te({result:{error:hr},stack:y});if(I===S)return{...Q};let{inContextDualMatchUp:D,inContextTieMatchUp:P,collectionPosition:E,collectionId:R,dualMatchUp:N,tieMatchUp:A,tieFormat:M}=v,C=P==null?void 0:P.matchUpType,O=(e=P==null?void 0:P.sides)==null?void 0:e.find(H=>{var Z,X,ie;return((Z=H.participant)==null?void 0:Z.participantId)===I||((ie=(X=H.participant)==null?void 0:X.individualParticipantIds)==null?void 0:ie.includes(I))});if(!O)return{error:Wi};let k=((i=Oi({tournamentRecord:b,participantFilters:{participantIds:[I,S]}}))==null?void 0:i.participants)??[];if(k.length!==2)return te({result:{error:hr},stack:y});if(k[0].participantType!==k[1].participantType)return te({result:{error:Ns},stack:y});let{appliedPolicies:x}=Bt({tournamentRecord:b,drawDefinition:w,event:T}),F=((r=t.policyDefinitions)==null?void 0:r[_r])??(x==null?void 0:x[_r])??Sv[_r],$=k.find(({participantId:H})=>H===S);if((t.enforceGender??((n=F==null?void 0:F.participants)==null?void 0:n.enforceGender))!==!1&&[Qt,mi].includes(P==null?void 0:P.gender)&&(P==null?void 0:P.gender)!==((a=$==null?void 0:$.person)==null?void 0:a.sex))return{error:Ih,info:"Gender mismatch"};let _=(o=F==null?void 0:F.processCodes)==null?void 0:o.substitution;Bw({tournamentId:b.tournamentId,eventId:T.eventId,inContextDualMatchUp:D,drawDefinition:w,dualMatchUp:N});let L=(s=N==null?void 0:N.sides)==null?void 0:s.find(({sideNumber:H})=>H===O.sideNumber);if(!L)return te({result:{sideNumber:O.sideNumber,existingParticipantId:I,error:jr},stack:y});if((u=(l=P==null?void 0:P.sides)==null?void 0:l.flatMap(H=>{var Z,X;return((Z=H.participant)==null?void 0:Z.individualParticipantIds)||((X=H.participant)==null?void 0:X.participantId)||[]}))!=null&&u.includes(S))return te({result:{error:pP},stack:y});let B=(d=(c=D==null?void 0:D.sides)==null?void 0:c.find(({sideNumber:H})=>H===O.sideNumber))==null?void 0:d.participantId,V=L.lineUp,G=V==null?void 0:V.find(({participantId:H})=>S===H),j=V==null?void 0:V.reduce((H,Z)=>Z.substitutionOrder>H?Z.substitutionOrder:H,0),z=(V==null?void 0:V.map(H=>{var Z;let X=Ne(H,!1,!0);if(![I,S].includes(X.participantId))return X;if(!U&&[I,S].includes(X.participantId)&&(X.collectionAssignments=(Z=X.collectionAssignments)==null?void 0:Z.filter(ie=>!(ie.collectionPosition===E&&ie.collectionId===R))),U&&I===X.participantId&&(X.collectionAssignments=X.collectionAssignments.map(ie=>ie.collectionPosition===E&&ie.collectionId===R&&ie.substitutionOrder===void 0?{...ie,substitutionOrder:j}:ie)),X.participantId===S){X.collectionAssignments||(X.collectionAssignments=[]);let ie={collectionId:R,collectionPosition:E};U&&(ie.previousParticipantId=I,ie.substitutionOrder=(j??0)+1),X.collectionAssignments.push(ie)}return X}))??[];if(!G){let H={collectionId:R,collectionPosition:E};U&&(H.substitutionOrder=(j??0)+1,H.previousParticipantId=I);let Z={collectionAssignments:[H],participantId:S};z.push(Z)}let W=C===ei,{assignedParticipantIds:q}=c0({lineUp:V,collectionPosition:E,collectionId:R}),{assignedParticipantIds:Y}=c0({lineUp:z,collectionPosition:E,collectionId:R});if(L.lineUp=z,B&&M){let H=$h({participantId:B,lineUp:z,drawDefinition:w,tieFormat:M});if(H.error)return te({result:H,stack:y})}else console.log("team participantId not found");let re,K;if(W){let{tournamentRecord:H}=t,Z=as({participantIds:Y,tournamentRecord:H});if(!Z.participant){let ie=pl({returnParticipant:!0,pairOverride:!0,tournamentRecord:H,participant:{participantRole:en,individualParticipantIds:Y,participantType:ft}});if(ie.error)return te({result:ie,stack:y});re=(p=ie.participant)==null?void 0:p.participantId}Z=as({participantIds:q,tournamentRecord:H});let X=(m=Z.participant)==null?void 0:m.participantId;X&&Lh({participantIds:[X],tournamentRecord:H}).success&&(K=X)}if(U||((h=O.substitutions)==null?void 0:h.length)===1){if(U)_&&A&&(A.processCodes=dt([...(A==null?void 0:A.processCodes)??[],..._]));else for(let H of _||[]){let Z=(f=A==null?void 0:A.processCodes)==null?void 0:f.lastIndexOf(H);Z!==void 0&&((g=A==null?void 0:A.processCodes)==null||g.splice(Z,1))}A&&Et({tournamentId:b==null?void 0:b.tournamentId,matchUp:A,context:y,drawDefinition:w})}return N&&Et({tournamentId:b==null?void 0:b.tournamentId,matchUp:N,context:y,drawDefinition:w}),{...Q,modifiedLineUp:z,participantRemoved:K,participantAdded:re}}function pte({collectionPosition:t,teamParticipantId:e,dualMatchUpSide:i,drawDefinition:r,participantIds:n,collectionId:a}){var o;if(!a||!t||!Array.isArray(n))return{modifiedLineUp:(i==null?void 0:i.lineUp)||[],error:se};let s=(i==null?void 0:i.lineUp)||((o=ep({participantId:e,drawDefinition:r}))==null?void 0:o.lineUp),l=[],u=[];return{modifiedLineUp:(s==null?void 0:s.map(c=>{var d;if(!n.includes(c.participantId))return c;let p=(d=c.collectionAssignments)==null?void 0:d.filter(m=>{let h=m.collectionId===a&&m.collectionPosition===t;return h&&(m.previousParticipantId&&l.push(m.previousParticipantId),u.push({participantId:c.participantId,...m})),!h});return{participantId:c.participantId,collectionAssignments:p}}).filter(Boolean))||[],assignmentsRemoved:u,previousParticipantIds:l}}function ACe({individualParticipantIds:t,groupingParticipantId:e,tournamentRecord:i}){var r,n;let a=(i.events||[]).filter(s=>{var l;return(s==null?void 0:s.eventType)===ur&&((l=s==null?void 0:s.entries)==null?void 0:l.some(u=>u.participantId===e))}),o=s=>!t.includes(s.participantId);for(let s of a){s.entries=(s.entries||[]).filter(o);let{flightProfile:l}=Hi({event:s});(r=l==null?void 0:l.flights)==null||r.forEach(u=>{u.drawEntries=(u.drawEntries||[]).filter(o)}),(n=s==null?void 0:s.drawDefinitions)==null||n.forEach(u=>{u.entries=(u.entries||[]).filter(o)})}return{...Q}}function qR({individualParticipantIds:t,groupingParticipantId:e,removeFromOtherTeams:i,tournamentRecord:r}){let n="addIndividualParticipantIds";if(!r)return te({result:{error:ve},stack:n});if(!e||!t)return te({result:{error:Je},stack:n});let a=r.participants??[],o=a.find(d=>d.participantId===e);if(!o)return te({result:{error:Wi},stack:n});if(o!=null&&o.participantType&&![Xt,Ja].includes(o.participantType))return te({context:{participantType:o.participantType},result:{error:Ns},stack:n});let s=t.filter(d=>{var p;return((p=a.find(m=>m.participantId===d))==null?void 0:p.participantType)!==Dt});if(s.length)return te({result:{error:ya,invalidParticipantIds:s},stack:n});o.individualParticipantIds||(o.individualParticipantIds=[]);let l=o.individualParticipantIds,u=t.filter(d=>!l.includes(d));u.length&&(i&&tR({individualParticipantIds:u,tournamentRecord:r}),o.individualParticipantIds=o.individualParticipantIds.concat(...u));let{topics:c}=So();if(c.includes(on)){let d=a.find(({participantId:p})=>p===e);ut({topic:on,payload:{participants:[d]}})}return ACe({individualParticipantIds:t,groupingParticipantId:e,tournamentRecord:r}),{groupingParticipant:Ne(o,!1,!0),added:u.length,...Q}}function YR(t){let{updateParticipantName:e=!0,groupingParticipantId:i,removeFromOtherTeams:r,tournamentRecord:n,pairOverride:a,participant:o}=t;if(!n)return{error:ve};if(!o)return{error:yh};if(!o.participantId)return pl({tournamentRecord:n,participant:o});let{participant:s}=nd({participantId:o.participantId,tournamentRecord:n});if(!s)return pl({tournamentRecord:n,participant:o});let{participantRoleResponsibilties:l,individualParticipantIds:u,participantOtherName:c,participantName:d,participantRole:p,participantType:m,onlineResources:h,contacts:f,person:g}=o;if(m&&s.participantType!==m)return{error:d9};let v={};if(f&&(v.contacts=f),h&&(v.onlineResources=h),c&&Di(c)&&(v.participantOtherName=c),d&&Di(d)&&(v.participantName=d),Array.isArray(u)){let{participants:y}=Oi({participantFilters:{participantTypes:[Dt]},tournamentRecord:n}),I=y==null?void 0:y.map(Tt);if(I){let b=u.filter(S=>Di(S)&&I.includes(S));([Ja,fi].includes(m||s.participantType)||m===ft&&(b.length===2||a))&&(v.individualParticipantIds=b),s.participantType===rI.PAIR&&e&&(v.participantName=OCe({individualParticipants:y,newValues:v}))}}return Object.keys(AL).includes(p)&&(v.participantRole=p),Object.keys(rI).includes(m)&&(v.participantType=m),Array.isArray(l)&&(v.participantRoleResponsibilties=l),s.participantType===rI.INDIVIDUAL&&g&&kCe({updateParticipantName:e,existingParticipant:s,newValues:v,person:g}),Object.assign(s,He(v)),i&&qR({individualParticipantIds:[s.participantId],groupingParticipantId:i,removeFromOtherTeams:r,tournamentRecord:n}),ut({topic:on,payload:{tournamentId:n.tournamentId,participants:[s]}}),{participant:Ne(s),...Q}}function OCe({individualParticipants:t,newValues:e}){let i=e.individualParticipantIds,r=t.filter(({participantId:n})=>i.includes(n)).map(({person:n})=>n==null?void 0:n.standardFamilyName).filter(Boolean).sort().join("/");return i.length===1&&(r+="/Unknown"),r}function kCe({updateParticipantName:t,existingParticipant:e,newValues:i,person:r}){let n={},{standardFamilyName:a,standardGivenName:o,nationalityCode:s,personId:l,birthdate:u,tennisId:c,sex:d}=r;d&&Object.keys(wF).includes(d)&&(n.sex=d);let p;if(Di(l)&&(n.personId=l),s&&Di(s)&&(xCe(s)||s==="")&&(n.nationalityCode=s),a&&typeof Di(a)&&a.length>1&&(n.standardFamilyName=a,p=!0),o&&typeof Di(o)&&o.length>1&&(n.standardGivenName=o,p=!0),p&&t){let m=`${n.standardGivenName} ${n.standardFamilyName}`;i.participantName=m}u&&ba(u)&&(n.birthdate=u),c&&Di(c)&&(n.tennisId=c),Object.assign(e.person,n)}function xCe(t){return yc.flatMap(({iso:e,ioc:i})=>[e,i]).filter(Boolean).includes(t)}function D0(t){var e,i,r,n,a,o,s,l,u,c,d,p,m,h,f,g,v,y,I,b;let S=P$(t);if(S.error)return S;let w="assignTieMatchUpParticipantId",U=t.teamParticipantId,{tournamentRecord:T,drawDefinition:D,participantId:P,event:E}=t;if(!P)return te({result:{error:hr},stack:w});if(t.sideNumber&&![1,2].includes(t.sideNumber))return te({result:{error:rF},stack:w});let{inContextDualMatchUp:R,inContextTieMatchUp:N,relevantAssignments:A,collectionPosition:M,teamParticipants:C,collectionId:O,matchUpType:k,dualMatchUp:x,tieFormat:F}=S;if((i=(e=N==null?void 0:N.sides)==null?void 0:e.flatMap(ne=>{var de,ye;return((de=ne.participant)==null?void 0:de.individualParticipantIds)||((ye=ne.participant)==null?void 0:ye.participantId)||[]}))!=null&&i.includes(P))return te({result:{...Q},stack:w});U=U??(t.sideNumber?(n=(r=R==null?void 0:R.sides)==null?void 0:r.find(ne=>ne.sideNumber===t.sideNumber))==null?void 0:n.participantId:void 0);let $=(o=(a=Oi({participantFilters:{participantIds:[P]},tournamentRecord:T}))==null?void 0:a.participants)==null?void 0:o[0];if(!$)return te({result:{error:Wi},stack:w});let{appliedPolicies:_}=Bt({tournamentRecord:T,drawDefinition:D,event:E}),L=((s=t.policyDefinitions)==null?void 0:s[_r])??(_==null?void 0:_[_r])??Sv[_r];if((t.enforceGender??((l=L==null?void 0:L.participants)==null?void 0:l.enforceGender))!==!1&&[Qt,mi].includes(N==null?void 0:N.gender)&&(N==null?void 0:N.gender)!==((u=$.person)==null?void 0:u.sex))return{error:Ih,info:"Gender mismatch"};let{individualParticipantIds:B,participantType:V}=$;if(Xi(ii)(k)&&V!==Dt)return{error:Ns};let G=V===Dt?[P]:B,j=U&&(C==null?void 0:C.find(({participantId:ne})=>ne===U))||(C==null?void 0:C.find(({individualParticipantIds:ne})=>Nn(G,ne)));if(!j)return{error:pF};if(U||(U=j.participantId),!U)return{error:Wi};let z=(c=A==null?void 0:A.find(ne=>ne.participantId===(j==null?void 0:j.participantId)))==null?void 0:c.drawPosition,W=(p=(d=x==null?void 0:x.sides)==null?void 0:d.find(ne=>ne.participantId===U))==null?void 0:p.sideNumber,q=(h=(m=N==null?void 0:N.sides)==null?void 0:m.find(ne=>z&&ne.drawPosition===z))==null?void 0:h.sideNumber,Y=W??q??t.sideNumber;if(!F)return{error:lv};if(!((f=F.collectionDefinitions)!=null&&f.find(ne=>ne.collectionId===O)))return{error:i9};Bw({tournamentId:T.tournamentId,eventId:E.eventId,inContextDualMatchUp:R,drawDefinition:D,dualMatchUp:x});let re=(g=x==null?void 0:x.sides)==null?void 0:g.find(ne=>ne.sideNumber===Y),K=(v=N==null?void 0:N.sides)==null?void 0:v.find(ne=>ne.sideNumber===Y),H=(b=(I=(re==null?void 0:re.lineUp)??((y=ep({participantId:U,drawDefinition:D}))==null?void 0:y.lineUp))==null?void 0:I.filter(ne=>{var de;return(de=ne.collectionAssignments)==null?void 0:de.find(ye=>ye.collectionPosition===M&&ye.collectionId===O&&!ye.previousParticipantId)}))==null?void 0:b.map(ne=>ne==null?void 0:ne.participantId),Z=(H==null?void 0:H.length)>1&&H||(V===ft?$.individualParticipantIds:[P]),X=pte({collectionPosition:M,teamParticipantId:U,dualMatchUpSide:re,drawDefinition:D,participantIds:Z,collectionId:O});if(X.error)return te({result:X,stack:w});let{modifiedLineUp:ie}=X,ae;if(k===ei){if(V!==ft){let ne=ZE({collectionPosition:M,teamParticipantId:U,drawDefinition:D,modifiedLineUp:ie,participantId:P,collectionId:O,tieFormat:F});if(ne!=null&&ne.error)return te({result:ne,stack:w});if(ne=le({side:K}),ne.error)return ne;ae=ne.deletedParticipantId,re&&(re.lineUp=ie),x&&Et({tournamentId:T==null?void 0:T.tournamentId,matchUp:x,context:w,drawDefinition:D})}else if(V===ft)for(let ne of Z)ZE({collectionPosition:M,teamParticipantId:U,drawDefinition:D,modifiedLineUp:ie,participantId:ne,collectionId:O,tieFormat:F})}else{let ne=ZE({collectionPosition:M,teamParticipantId:U,drawDefinition:D,modifiedLineUp:ie,participantId:P,collectionId:O,tieFormat:F});if(ne!=null&&ne.error)return ne}if(re&&(re.lineUp=ie),x&&Et({tournamentId:T==null?void 0:T.tournamentId,matchUp:x,context:w,drawDefinition:D}),ae){let{error:ne}=Lh({participantIds:[ae],tournamentRecord:T});ne&&console.log("cleanup")}return{...Q,modifiedLineUp:ie};function le({side:ne}){let de;if(ne.participant){let ye=ne.participant.individualParticipantIds||[];if(ye.filter(Boolean).length===1){let{participant:ce}=as({participantIds:ye,tournamentRecord:T});ye.push(P);let{participant:ke}=as({participantIds:ye,tournamentRecord:T});if(!ke&&ce){ce.individualParticipantIds=ye;let Pe=YR({pairOverride:!0,tournamentRecord:T,participant:ce});if(Pe.error)return Pe}else de=ce==null?void 0:ce.participantId}}else{let ye=pl({participant:{individualParticipantIds:[P],participantRole:en,participantType:ft},pairOverride:!0,tournamentRecord:T});if(ye.error)return ye}return{...Q,deletedParticipantId:de}}}function ZE({collectionPosition:t,teamParticipantId:e,drawDefinition:i,modifiedLineUp:r,participantId:n,collectionId:a,tieFormat:o}){var s,l;let u=(s=ep({participantId:e,drawDefinition:i}))==null?void 0:s.lineUp,c=(l=r||u)==null?void 0:l.find(p=>(p==null?void 0:p.participantId)===n),d={collectionId:a,collectionPosition:t};if(c)c.collectionAssignments.push(d);else{let p={collectionAssignments:[d],participantId:n};r.push(p)}return $h({participantId:e,lineUp:r,drawDefinition:i,tieFormat:o})}function mte(t){var e,i,r,n,a,o,s,l,u,c,d,p,m,h,f,g,v,y,I,b,S,w,U;let{tournamentRecord:T,drawDefinition:D,participantId:P,event:E}=t,R="removeTieMatchUpParticiapantId";if(!P)return te({result:{error:hr},stack:R});let N=P$(t);if(N.error)return N;let{appliedPolicies:A}=Bt({tournamentRecord:T,drawDefinition:D,event:E}),M=(r=(i=((e=t.policyDefinitions)==null?void 0:e[_r])??(A==null?void 0:A[_r])??Sv[_r])==null?void 0:i.processCodes)==null?void 0:r.substitution,{inContextDualMatchUp:C,inContextTieMatchUp:O,relevantAssignments:k,collectionPosition:x,teamParticipants:F,collectionId:$,matchUpType:_,dualMatchUp:L,tieMatchUp:B,tieFormat:V}=N;if(!L)return te({result:{error:sa},stack:R});let G=(n=O==null?void 0:O.sides)==null?void 0:n.find(H=>{var Z,X,ie;return((Z=H.participant)==null?void 0:Z.participantId)===P||((ie=(X=H.participant)==null?void 0:X.individualParticipantIds)==null?void 0:ie.includes(P))});if(!G)return te({result:{error:Wi},stack:R});let j=((a=t.policyDefinitions)==null?void 0:a[fo])??(A==null?void 0:A[fo]);if(!((o=G.substitutions)!=null&&o.length)&&(br({score:O==null?void 0:O.score})||O!=null&&O.winningSide)&&(j==null?void 0:j.requireParticipantsForScoring)!==!1)return te({result:{error:$9},stack:R});let z=(l=(s=C==null?void 0:C.sides)==null?void 0:s.find(({sideNumber:H})=>H===G.sideNumber))==null?void 0:l.participantId;if(!z)return te({result:{error:Wi},stack:R});let W=(c=(u=Oi({participantFilters:{participantIds:[P]},tournamentRecord:T}))==null?void 0:u.participants)==null?void 0:c[0];if(!W)return te({result:{error:Wi},stack:R});if(_===ii&&W.participantType===ft)return te({result:{error:Ih},stack:R});let q=W.participantType===Dt?[P]:W.individualParticipantIds;Bw({tournamentId:T.tournamentId,eventId:E.eventId,inContextDualMatchUp:C,drawDefinition:D,dualMatchUp:L});let Y=(d=L.sides)==null?void 0:d.find(({sideNumber:H})=>H===G.sideNumber);if(!Y&&(((p=L.sides)==null?void 0:p.filter(({lineUp:H})=>!H).length)||0)<2){let H=F==null?void 0:F.map(({participantId:Z})=>{var X;return{drawPosition:(X=k==null?void 0:k.find(ie=>ie.participantId===Z))==null?void 0:X.drawPosition,teamParticipantId:Z}});Y=(m=L.sides)==null?void 0:m.find(Z=>{var X;return((X=H==null?void 0:H.find(({drawPosition:ie})=>ie===Z.drawPosition))==null?void 0:X.teamParticipantId)===z})}if(!Y)return te({result:{error:Wi,context:{participantId:P}}});let{modifiedLineUp:re,previousParticipantIds:K}=pte({collectionPosition:x,teamParticipantId:z,dualMatchUpSide:Y,participantIds:q,drawDefinition:D,collectionId:$});if(Y.lineUp=re,z&&V&&$h({participantId:z,lineUp:re,drawDefinition:D,tieFormat:V}),_===ei&&W.participantType===Dt){let H=(h=O==null?void 0:O.sides)==null?void 0:h.find(ie=>ie.sideNumber===(Y==null?void 0:Y.sideNumber)),{participantId:Z}=H??{},X=Z&&((g=(f=Oi({participantFilters:{participantIds:[Z]},tournamentRecord:T,withDraws:!0}))==null?void 0:f.participants)==null?void 0:g[0]);if(X){let ie=((v=X==null?void 0:X.individualParticipantIds)==null?void 0:v.filter(ae=>ae!==P))??[];if(K&&ie.push(...K),ie.length>2)return te({result:{error:ya},stack:R});if((y=X.draws)!=null&&y.length){if(ie.length===1){let{participant:ae}=as({participantIds:ie,tournamentRecord:T});if(!ae){let le=pl({participant:{participantRole:en,individualParticipantIds:ie,participantType:ft},pairOverride:!0,tournamentRecord:T});if(le.error)return te({result:le,stack:R})}}}else if(ie.length){X.individualParticipantIds=ie;let ae=YR({participant:X,pairOverride:!0,tournamentRecord:T});if(ae.error)return te({result:ae,stack:R})}else{let ae=Lh({participantIds:[Z],tournamentRecord:T});ae.error&&console.log("cleanup",{result:ae})}}else return te({result:{error:Wi},stack:R})}if(((I=G.substitutions)==null?void 0:I.length)===1&&!((w=(S=(b=O==null?void 0:O.sides)==null?void 0:b.find(H=>H.sideNumber!==G.sideNumber))==null?void 0:S.substitutions)!=null&&w.length)&&(U=B==null?void 0:B.processCodes)!=null&&U.length){for(let H of M||[]){let Z=B.processCodes.lastIndexOf(H);B.processCodes.splice(Z,1)}Et({tournamentId:T==null?void 0:T.tournamentId,matchUp:B,context:R,drawDefinition:D})}return Et({tournamentId:T==null?void 0:T.tournamentId,matchUp:L,context:R,drawDefinition:D}),{...Q,modifiedLineUp:re}}function E$(t){var e,i;let r=We(t,[{[Ur]:!0,[$n]:!0,[Il]:!0}]);if(r.error)return r;let{drawDefinition:n,sideNumber:a,matchUpId:o,event:s}=t;if(a&&![1,2].includes(a))return{error:se,sideNumber:a};let{matchUp:l,structure:u}=Si({drawDefinition:n,matchUpId:o,event:s});return l?Yn({structure:u})?((e=l.sides)==null||e.forEach(c=>{(!a||c.sideNumber===a)&&delete c.participantId}),Et({tournamentId:(i=t.tournamentRecord)==null?void 0:i.tournamentId,context:"assignSideParticipant",drawDefinition:n,matchUp:l}),{...Q}):{error:qx}:{error:hn}}function FCe({matchUpStatuses:t=[jt,Ft,Pt],drawPositionMatchUps:e,loserDrawPosition:i,sourceMatchUps:r}){var n;let a=e==null?void 0:e.reduce((d,p)=>!d||p.roundNumber>d.roundNumber?p:d,void 0),o=(n=a==null?void 0:a.drawPositions)==null?void 0:n.find(d=>d!==i),s=r.filter(d=>{var p;return(p=d==null?void 0:d.drawPositions)==null?void 0:p.includes(o)}).map(d=>d.matchUpStatus),l=r.filter(d=>{var p;return(p=d==null?void 0:d.drawPositions)==null?void 0:p.includes(i)}).map(d=>d.matchUpStatus),u=Nn(s||[],t),c=Nn(l||[],t);return{sourceMatchUp:a,winnerHadMatchUpStatus:u,winnerMatchUpStatuses:s,loserHadMatchUpStatus:c,loserMatchUpStatuses:l}}function LCe({inContextDrawMatchUps:t,sourceMatchUpStatus:e,targetDrawPosition:i,tournamentRecord:r,sourceMatchUpId:n,drawDefinition:a,structureId:o,dualMatchUp:s,roundNumber:l,matchUpsMap:u,event:c}){let{structure:d}=tt({drawDefinition:a,structureId:o});if((d==null?void 0:d.structureType)===_n)return{...Q};u=u??ln({drawDefinition:a});let p=((u==null?void 0:u.mappedMatchUps)||{})[o].matchUps,{initialRoundNumber:m}=Lm({drawPosition:i,matchUps:p}),h=p==null?void 0:p.filter(g=>{var v;return g.roundNumber>=l&&g.roundNumber!==m&&((v=g.drawPositions)==null?void 0:v.includes(i))}),{positionAssignments:f}=si({drawDefinition:a,structureId:o});for(let g of h??[])_Ce({inContextDrawMatchUps:t,sourceMatchUpStatus:e,positionAssignments:f,targetDrawPosition:i,tournamentRecord:r,sourceMatchUpId:n,drawDefinition:a,dualMatchUp:s,matchUpsMap:u,matchUp:g,event:c});return{...Q}}function _Ce({inContextDrawMatchUps:t,positionAssignments:e,sourceMatchUpStatus:i,targetDrawPosition:r,tournamentRecord:n,sourceMatchUpId:a,drawDefinition:o,dualMatchUp:s,matchUpsMap:l,matchUp:u,event:c}){var d,p,m;let h="removeSubsequentDrawPosition";if(s){let g=(p=(d=t.find(({matchUpId:y})=>u.matchUpId===y).sides)==null?void 0:d.find(y=>y.drawPosition===r))==null?void 0:p.sideNumber,v=(m=u.sides)==null?void 0:m.find(y=>y.sideNumber===g);v&&delete v.lineUp}u.drawPositions=(u.drawPositions||[]).map(g=>g===r?void 0:g).filter(Boolean);let f=e.filter(({drawPosition:g})=>{var v;return(v=u.drawPositions)==null?void 0:v.includes(g)}).filter(g=>g.bye).length;return u.matchUpStatus=f&&jt||[Pt,Ft].includes(u.matchUpStatus)&&u.matchUpStatus||Qi,[Ft,Pt].includes(u.matchUpStatus)&&(u.winningSide=void 0),u.matchUpStatusCodes&&OJ({inContextDrawMatchUps:t,sourceMatchUpStatus:i,sourceMatchUpId:a,matchUpsMap:l,matchUp:u}),Et({tournamentId:n==null?void 0:n.tournamentId,eventId:c==null?void 0:c.eventId,context:`${h}-${r}`,drawDefinition:o,matchUp:u}),{...Q}}function kv(t){let{dualWinningSideChange:e,inContextDrawMatchUps:i,tournamentRecord:r,drawDefinition:n,matchUpStatus:a,matchUpsMap:o,dualMatchUp:s,targetData:l,matchUpId:u,structure:c,event:d}=t,p=!!t.matchUp.collectionId,m=Yn({structure:c}),{drawPositions:h,winningSide:f}=l.matchUp||{};if(!m&&!h)return{error:qb};let{targetLinks:{loserTargetLink:g,winnerTargetLink:v,byeTargetLink:y},targetMatchUps:{loserMatchUp:I,winnerMatchUp:b,byeMatchUp:S}}=l,w=Js({...t,matchUpStatus:a||Qi,removeWinningSide:!0});if(w.error)return w;let U;if(p){let{matchUpTieId:O,matchUpsMap:k}=t;if(U=ic({appliedPolicies:t.appliedPolicies,matchUpId:O,tournamentRecord:r,drawDefinition:n,matchUpsMap:k,event:d}),!e&&!U.removeWinningSide)return{...Q}}if(m)return{...Q};let{matchUps:T}=qt({afterRecoveryTimes:!1,inContext:!0,drawDefinition:n,matchUpsMap:o,structure:c}),{positionAssignments:D}=Mr({structure:c}),P=f-1,E=1-P,R=h[P],N=h[E],{winnerParticipantId:A,loserParticipantId:M}=(D==null?void 0:D.reduce((O,k)=>(k.drawPosition===N&&(O.loserParticipantId=k.participantId),k.drawPosition===R&&(O.winnerParticipantId=k.participantId),O),{winnerParticipantId:void 0,loserParticipantId:void 0}))||{},C=T.filter(O=>{var k;return(k=O.drawPositions)==null?void 0:k.includes(N)});if(b&&hte({sourceMatchUpStatus:a,sourceMatchUpId:u,inContextDrawMatchUps:i,winningDrawPosition:R,winnerParticipantId:A,tournamentRecord:r,winnerTargetLink:v,drawDefinition:n,winnerMatchUp:b,dualMatchUp:s,matchUpsMap:o}),I){let{winnerHadMatchUpStatus:O}=FCe({drawPositionMatchUps:C,loserDrawPosition:N,sourceMatchUps:T}),k=g.linkCondition===ll;if(O&&k){let F=Math.min(...I.drawPositions);XM({targetLink:g,inContextDrawMatchUps:i,drawDefinition:n,drawPosition:F,matchUpsMap:o,event:d})}let x=$Ce({sourceMatchUpStatus:a,sourceMatchUpId:u,loserParticipantId:M,tournamentRecord:r,loserTargetLink:g,drawDefinition:n,loserMatchUp:I,dualMatchUp:s,matchUpsMap:o,event:d});if(x.error)return x}if(S){let O=Math.min(...S.drawPositions);XM({sourceMatchUpId:u,targetLink:y,inContextDrawMatchUps:i,drawDefinition:n,drawPosition:O,matchUpsMap:o,event:d})}return{...Q,...U&&{tieMatchUpResult:U}}}function hte({inContextDrawMatchUps:t,winningDrawPosition:e,sourceMatchUpStatus:i,winnerParticipantId:r,tournamentRecord:n,winnerTargetLink:a,sourceMatchUpId:o,drawDefinition:s,winnerMatchUp:l,matchUpsMap:u,dualMatchUp:c,event:d}){var p,m;let{structureId:h,roundNumber:f}=l,g="removeDirectedWinner";if(a){let v=a.target.structureId,{structure:y}=tt({drawDefinition:s,structureId:v});if(!y)return{error:Ai};let{positionAssignments:I}=Mr({structure:y});y.seedAssignments=(y.seedAssignments??[]).filter(D=>D.participantId!==r);let b=(p=I==null?void 0:I.find(D=>D.participantId===r))==null?void 0:p.drawPosition,{matchUps:S}=qt({drawDefinition:s,structure:y,event:d}),w=S.map(D=>D.drawPositions).flat(1/0).filter(Boolean),U=Pa(w);if((b?U[b]:void 0)===1)I==null||I.forEach(D=>{D.participantId===r&&delete D.participantId});else{let D=S.filter(({drawPositions:P})=>P.includes(b));console.log("not removing from position assignments since instances > 1",{drawPositionMatchUps:D,winnerTargetLink:a})}let T=(m=u==null?void 0:u.drawMatchUps)==null?void 0:m.find(({matchUpId:D})=>D===l.matchUpId);T&&Et({tournamentId:n==null?void 0:n.tournamentId,eventId:d==null?void 0:d.eventId,matchUp:T,context:g,drawDefinition:s})}return f&&LCe({targetDrawPosition:e,inContextDrawMatchUps:t,sourceMatchUpStatus:i,tournamentRecord:n,sourceMatchUpId:o,drawDefinition:s,dualMatchUp:c,matchUpsMap:u,roundNumber:f,structureId:h}),{...Q}}function $Ce({sourceMatchUpStatus:t,loserParticipantId:e,tournamentRecord:i,loserTargetLink:r,sourceMatchUpId:n,drawDefinition:a,loserMatchUp:o,matchUpsMap:s,dualMatchUp:l,event:u}){var c,d,p;let m="removeDirectedLoser",h=r.target.structureId,{structure:f}=tt({drawDefinition:a,structureId:h});if(!f)return{error:Ai};let{positionAssignments:g}=Mr({structure:f}),v=(c=g==null?void 0:g.find(y=>y.participantId===e))==null?void 0:c.drawPosition;if(g==null||g.forEach(y=>{y.participantId===e&&delete y.participantId}),f.seedAssignments=(f.seedAssignments??[]).filter(y=>y.participantId!==e),l){let y=o==null?void 0:o.sides.reduce((S,w,U)=>w.drawPosition===v?U:S,void 0),I=(d=s==null?void 0:s.drawMatchUps)==null?void 0:d.find(({matchUpId:S})=>S===o.matchUpId),b=(p=I==null?void 0:I.sides)==null?void 0:p[y];b&&(delete b.lineUp,Et({tournamentId:i==null?void 0:i.tournamentId,eventId:u==null?void 0:u.eventId,matchUp:I,context:m,drawDefinition:a}))}return{...Q}}function XM({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,matchUpsMap:n,targetLink:a,event:o}){let s=a.target.structureId,l="removeDirectedBye";Oa({color:"brightyellow",method:l,drawPosition:r});let u=Pw({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,matchUpsMap:n,structureId:s,event:o});return te({result:u,stack:l})}function BCe(t){var e,i;let{matchUpFormat:r,score:n}=t,a=(e=n==null?void 0:n.sets)==null?void 0:e.length,o=r&&Ln(r),{setFormat:s,finalSetFormat:l,bestOf:u}=o??{};return((i=u&&a===u&&l||s)==null?void 0:i.timed)||!1}function VCe({tournamentRecord:t,drawDefinition:e,structure:i,matchUp:r}){var n;let a="attemptToSetMatchUpStatusBYE";if(r!=null&&r.winningSide)return te({result:{error:sv},context:{matchUpStatus:jt},stack:a});let{positionAssignments:o}=Mr({structure:i}),s=o==null?void 0:o.filter(l=>l.bye).map(l=>l.drawPosition);return(n=r.drawPositions)!=null&&n.some(l=>s==null?void 0:s.includes(l))?(r.matchUpStatus=jt,r.matchUpStatusCodes=[],Et({tournamentId:t==null?void 0:t.tournamentId,context:a,drawDefinition:e,matchUp:r}),{...Q}):te({result:{error:t9},info:"matchUp does not include BYE",stack:a})}function lI(t){var e,i;let{tournamentRecord:r,appliedPolicies:n,drawDefinition:a,matchUpsMap:o,targetData:s,structure:l,event:u}=t,c="doubleExitAdvancement";if(l.structureType===_n)return te({result:{...Q},stack:c});let{matchUp:d,targetMatchUps:p,targetLinks:m}=s,{loserMatchUp:h,winnerMatchUp:f,loserTargetDrawPosition:g}=p,v=[Ft,Pt].includes(h==null?void 0:h.matchUpStatus)&&!((e=h.sides)!=null&&e.map(y=>y.participantId??y.participant).filter(Boolean).length);if(h&&h.matchUpStatus!==jt){let{loserTargetLink:y}=m;if((i=n==null?void 0:n.progression)!=null&&i.doubleExitPropagateBye){let I=fte({loserTargetDrawPosition:g,tournamentRecord:r,loserTargetLink:y,drawDefinition:a,loserMatchUp:h,matchUpsMap:o,event:u});if(I.error)return te({result:I,stack:c})}else if(!v){let{feedRound:I,drawPositions:b,matchUpId:S}=h,w=I?2:2-b.indexOf(g),U=oj({...t,targetMatchUp:h,walkoverWinningSide:w,tournamentRecord:r,sourceMatchUp:d,matchUpId:S});if(U.error)return te({result:U,stack:c})}}if(f){let y=oj({...t,matchUpId:f.matchUpId,targetMatchUp:f,tournamentRecord:r,sourceMatchUp:d});if(y.error)return te({result:y,stack:c})}return te({result:{...Q},stack:c})}function oj(t){var e,i,r;let{inContextDrawMatchUps:n,tournamentRecord:a,drawDefinition:o,sourceMatchUp:s,targetMatchUp:l,matchUpsMap:u}=t,c=o.structures.find(({structureId:z})=>z===l.structureId),d=t.matchUpStatus===dr?dr:tr,p=t.matchUpStatus===dr?Pt:Ft,m="conditionallyAdvanceDrawPosition",h=u.drawMatchUps.find(z=>z.matchUpId===l.matchUpId);if(!h)return{error:sa};let f=(s==null?void 0:s.drawPositions)||[],g=(e=h.drawPositions)==null?void 0:e.filter(Boolean),v=(s==null?void 0:s.structureId)===l.structureId;if(v&&Nn(f,g)&&(g=g.filter(z=>!f.includes(z))),v&&g.length>1)return te({result:{error:Xf},stack:m});let{pairedPreviousMatchUpIsDoubleExit:y,pairedPreviousMatchUp:I}=NJ(t),b=On({matchUpId:l.matchUpId,inContextDrawMatchUps:n,drawDefinition:o}),{targetMatchUps:S,targetLinks:w}=b,{loserTargetDrawPosition:U,winnerMatchUp:T,loserMatchUp:D}=S;if(D){let{loserTargetLink:z}=w,W=fte({loserTargetDrawPosition:U,loserMatchUp:D,tournamentRecord:a,loserTargetLink:z,drawDefinition:o,matchUpsMap:u});if(W.error)return te({result:W,stack:m})}let P=((i=h.drawPositions)==null?void 0:i.filter(Boolean))||[],E=P.length===1,R=t.walkoverWinningSide||E&&iS({drawPosition:P[0],matchUpId:l.matchUpId,inContextDrawMatchUps:n})||void 0,N=[Ft,Pt].includes(h.matchUpStatus)&&!P.length,A=h.finishingRound===1,M=N&&!A?d:p,C=n.find(z=>z.matchUpId===I.matchUpId),O=[],k;s&&((s==null?void 0:s.structureId)===(C==null?void 0:C.structureId)?s.roundPosition<(I==null?void 0:I.roundPosition)?k=1:k=2:l.feedRound?s.structureId===l.structureId?k=2:k=1:R&&(k=3-R));let x=t.matchUpStatus,F=I==null?void 0:I.matchUpStatus;k===1?O=[{matchUpStatus:yU(x),previousMatchUpStatus:x,sideNumber:1},{matchUpStatus:yU(F),previousMatchUpStatus:F,sideNumber:2}]:k===2&&(O=[{matchUpStatus:yU(F),previousMatchUpStatus:F,sideNumber:1},{matchUpStatus:yU(x),previousMatchUpStatus:x,sideNumber:2}]),O.length&&(O=O.map(z=>He(z)));let $=Js({...t,winningSide:R,matchUp:h,matchUpStatusCodes:O,context:m,matchUpStatus:M});if($.error)return te({result:$,stack:m});if(N)return lI({...t,matchUpStatus:M,targetData:b});if(!T)return te({result:{...Q},stack:m});let _=g.length===2?g[R-1]:g[0],{positionAssignments:L}=si({structure:c}),B=L==null?void 0:L.find(z=>z.drawPosition===_),V=u.drawMatchUps.find(z=>z.matchUpId===T.matchUpId),G=(r=V==null?void 0:V.drawPositions)==null?void 0:r.filter(Boolean),j=G.length===1;if(_){if(B!=null&&B.bye){let z=On({matchUpId:V.matchUpId,inContextDrawMatchUps:n,drawDefinition:o});if(j){let W=G.filter(Boolean)[0],q=iS({drawPosition:W,matchUpId:V.matchUpId,inContextDrawMatchUps:n}),Y=Js({appliedPolicies:t.appliedPolicies,matchUpId:V.matchUpId,matchUp:V,matchUpStatus:p,matchUpStatusCodes:[],removeScore:!0,context:m,drawDefinition:o,winningSide:q});return Y.error?te({result:Y,stack:m}):RL({drawPositionToAdvance:W,matchUpId:V.matchUpId,inContextDrawMatchUps:n,drawDefinition:o,matchUpsMap:u})}else if([Ft,Pt].includes(T.matchUpStatus)){let W=lI({...t,matchUpId:V.matchUpId,matchUpStatus:M,targetData:z});if(W.error)return te({result:W,stack:m})}return te({result:{...Q},stack:m})}return mg({matchUpId:T.matchUpId,drawPosition:_,inContextDrawMatchUps:n,drawDefinition:o})}else if(y){if(!V)return{error:sa};if(j){let q=G[0],Y=iS({matchUpId:l.matchUpId,inContextDrawMatchUps:n,drawPosition:q});console.log("existing drawPosition is winningSide",{walkoverWinningSide:Y})}let z=[Ft,Pt].includes(V.matchUpStatus)?p:d,W=Js({matchUpId:V.matchUpId,appliedPolicies:t.appliedPolicies,matchUp:V,matchUpStatusCodes:[],removeScore:!0,context:m,drawDefinition:o,matchUpStatus:z});if(W.error)return te({result:W,stack:m});if(z===d){let q=lI({...t,matchUpId:l.matchUpId,matchUpStatus:z,targetData:b});if(q.error)return q}}return te({result:{...Q},stack:m})}function fte(t){var e;let{loserTargetDrawPosition:i,tournamentRecord:r,loserTargetLink:n,drawDefinition:a,matchUpsMap:o,event:s}=t,l=(e=n==null?void 0:n.target)==null?void 0:e.structureId,{structure:u}=tt({drawDefinition:a,structureId:l});return u?Za({drawPosition:i,tournamentRecord:r,drawDefinition:a,structureId:l,matchUpsMap:o,event:s}):{error:Tp}}function yU(t){return t===tr?Ft:t===dr?Pt:t}function jCe(t){let{tournamentRecord:e,drawDefinition:i,matchUpStatus:r,structure:n,matchUp:a}=t,o=!!(a.tieMatchUps&&!a.rondPosition&&t.inContextDrawMatchUps.find(v=>v.matchUpId===a.matchUpId).containerStructureId),s="attemptToSetMatchUpStatus",l=r===jt,u=a.winningSide,c=[tr,dr].includes(r),d=Tw({matchUpStatus:r}),p=RM({matchUpStatus:r}),m=!d&&!p,h=t.matchUpTieId||u&&d&&!c,f=u&&c,g=()=>Js({...t,removeScore:[bl,Ft].includes(r),matchUpStatus:r||Qi});return m&&{error:sM}||h&&JM(t)||f&&GCe(t)||u&&kv(t)||p&&g()||l&&VCe({tournamentRecord:e,drawDefinition:i,structure:n,matchUp:a})||!d&&{error:sM}||c&&HCe(t)||o&&JM(t)||te({result:{error:sv},stack:s})}function GCe(t){let e=kv(t);return e.error?e:lI(t)}function HCe(t){let e=JM({...t,removeScore:!0});return e.error?e:lI(t)}function JM(t){var e;let i="scoreModification";if(t.isCollectionMatchUp&&(e=t.dualMatchUp)!=null&&e.winningSide&&!t.projectedWinningSide){let a=kv(t);if(a.error)return te({result:a,stack:i})}let r=!!t.matchUp.collectionId,n=Js({...t,context:i});if(r){let{matchUpTieId:a,drawDefinition:o,matchUpsMap:s}=t,l=ic({tournamentRecord:t.tournamentRecord,appliedPolicies:t.appliedPolicies,matchUpId:a,event:t.event,drawDefinition:o,matchUpsMap:s});if(l.error)return te({result:l,stack:i});Object.assign(n,{tieMatchUpResult:l})}return te({result:n,stack:i})}function zCe({drawDefinition:t,structure:e,matchUp:i}){var r,n,a,o;let{drawPositions:s}=i,{positionAssignments:l}=si({drawDefinition:t,structure:e}),u=(r=l==null?void 0:l.filter(({drawPosition:p})=>s==null?void 0:s.includes(p)))==null?void 0:r.map(p=>{var m;let{extension:h}=vt({element:p,name:Oc});return(m=h==null?void 0:h.value)==null?void 0:m.groupOrder}),{containerStructures:c}=yv({drawDefinition:t}),d=c[e.structureId];return{structureIds:(o=(a=(n=bv({drawDefinition:t,structureId:d}))==null?void 0:n.links)==null?void 0:a.source)==null?void 0:o.filter(p=>{var m;return Nn(u,((m=p.source)==null?void 0:m.finishingPositions)||[])}).map(p=>p.source.structureId)}}function gte({drawDefinition:t,structure:e,matchUp:i}){let r=[];if(e.finishingPosition===Xd&&_c({drawDefinition:t,structure:e})){let{structureIds:n}=zCe({drawDefinition:t,structure:e,matchUp:i});n!=null&&n.length&&r.push(...n)}return{connectedStructureIds:r}}function WCe(t){var e,i,r;let n,{inContextDrawMatchUps:a,inContextMatchUp:o,drawDefinition:s,winningSide:l}=t,u=(e=t.targetData.targetLinks)==null?void 0:e.winnerTargetLink;if(u.target.feedProfile===gs){let c=o.sides.find(({sideNumber:p})=>p!==l).participantId,d=a.find(p=>p.structureId===u.target.structureId&&p.roundNumber===u.target.roundNumber&&p.sides.some(({participantId:m})=>m===c));if((d==null?void 0:d.matchUpStatus)===Qi){let p=On({matchUpId:d.matchUpId,inContextDrawMatchUps:a,drawDefinition:s});if(!np({inContextDrawMatchUps:a,drawDefinition:s,targetData:p})){let{structure:m}=tt({structureId:d.structureId,drawDefinition:s}),h=si({structure:m}).positionAssignments;for(let f of h||[])if(f.participantId===c){let g=o.sides.find(({sideNumber:v})=>v===l).participantId;if(f.participantId=g,m==null?void 0:m.positionAssignments)m.positionAssignments=h;else if(m!=null&&m.structures){let v=Object.assign({},...(h||[]).map(y=>({[y.drawPosition]:y.participantId})));for(let y of m.structures)(i=y.positionAssignments)==null||i.forEach(I=>I.participantId=v[I.drawPosition])}Fc({tournamentId:(r=t.tournamentRecord)==null?void 0:r.tournamentId,event:t.event,drawDefinition:s,structure:m}),n=!0}}}}return{...Q,qualifierReplaced:n}}function qCe(t){var e,i,r,n,a;let o,{inContextDrawMatchUps:s,inContextMatchUp:l,drawDefinition:u,winningSide:c}=t,d=(e=t.targetData.targetLinks)==null?void 0:e.winnerTargetLink;if(d.target.feedProfile===gs){let p=(i=l.sides.find(({sideNumber:f})=>f===c))==null?void 0:i.participantId,m=s.filter(f=>f.structureId===d.target.structureId&&f.roundNumber===d.target.roundNumber&&f.sides.some(({participantId:g,qualifier:v})=>v&&!g)),h=_o(m);if((h==null?void 0:h.matchUpStatus)===Qi){let f=On({matchUpId:h.matchUpId,inContextDrawMatchUps:s,drawDefinition:u});if(!np({inContextDrawMatchUps:s,drawDefinition:u,targetData:f})){let g=(r=h.sides.find(I=>I.qualifier&&!I.participantId))==null?void 0:r.drawPosition,{structure:v}=tt({structureId:h.structureId,drawDefinition:u});if(!v)return{error:Ai};let y=si({structure:v}).positionAssignments;for(let I of y||[])if(I.drawPosition===g&&!I.participantId){if(I.participantId=p,v.positionAssignments)v.positionAssignments=y;else if(v.structures){let b=Object.assign({},...(y||[]).map(S=>({[S.drawPosition]:S.participantId})));for(let S of v.structures)(n=S.positionAssignments)==null||n.forEach(w=>w.participantId=b[w.drawPosition])}Fc({tournamentId:(a=t.tournamentRecord)==null?void 0:a.tournamentId,event:t.event,drawDefinition:u,structure:v}),o=!0}}}}return{...Q,qualifierPlaced:o}}function YCe(t){var e,i;let r="attemptToSetWinningSide",n,{appliedPolicies:a,disableAutoCalc:o,drawDefinition:s,dualMatchUp:l,winningSide:u,structure:c,matchUp:d}=t;if(l!=null&&l._disableAutoCalc&&o!==!1)return o_(t);if(d.winningSide&&d.winningSide!==u){let{connectedStructureIds:f}=gte({drawDefinition:s,structure:c,matchUp:d});f.length&&(console.log({connectedStructureIds:f}),n=!0);let g=kv(t);if(g.error)return g}let p=PQ(t);if(p.error)return te({result:p,stack:r});let m,h;return t.qualifierChanging&&(e=a==null?void 0:a[oy])!=null&&e.autoReplaceQualifiers&&(m=WCe(t).qualifierReplaced),t.qualifierAdvancing&&(i=a==null?void 0:a[oy])!=null&&i.autoPlaceQualifiers&&(h=qCe(t).qualifierPlaced),te({result:He({...Q,...p,connectedStructures:n,qualifierReplaced:m,qualifierPlaced:h}),stack:r})}var sS={drawPositionToRemove:"green",iteration:"brightred",winner:"green",loser:"brightred"};function vte(t){var e,i,r,n;let{inContextDrawMatchUps:a,appliedPolicies:o,drawDefinition:s,matchUpsMap:l,targetData:u,matchUp:c}=t,{matchUpId:d}=c,{iteration:p=0}=t;p+=1;let m="removeDoubleExit";Oa({color:"brightyellow",method:m,matchUpId:d,iteration:p,keyColors:sS});let{targetMatchUps:{loserMatchUp:h,winnerMatchUp:f,loserTargetDrawPosition:g},targetLinks:{loserTargetLink:v}}=u;if(f&&f.matchUpStatus!==jt){let{stage:b,roundNumber:S,roundPosition:w,structureName:U}=f;Oa({winner:"winner",roundPosition:w,structureName:U,roundNumber:S,keyColors:sS,stage:b}),sj({...t,targetMatchUp:f,sourceMatchUp:c,iteration:p})}let y=(h==null?void 0:h.matchUpStatus)===jt&&((h==null?void 0:h.feedRound)||(h==null?void 0:h.roundNumber)===1),I=((i=(e=u==null?void 0:u.targetLinks)==null?void 0:e.loserTargetLink)==null?void 0:i.linkCondition)===ll;if(y&&I){let b=a.filter(({roundNumber:U,structureId:T})=>T===c.structureId&&U===1),S=b.map(({roundPosition:U})=>U),w=Cr(S.sort(),2).find(U=>U.includes(c.roundPosition));if(((r=b.filter(({roundPosition:U})=>w.includes(U)))==null?void 0:r.map(({matchUpStatus:U})=>U)).every(U=>[dr,tr].includes(U)))return te({result:{...Q},stack:m})}if(h&&(h.matchUpStatus!==jt||y)){let b=a.find(({matchUpId:E})=>E===h.matchUpId),{structure:S}=tt({drawDefinition:s,structureId:b.structureId}),{stage:w,roundNumber:U,roundPosition:T,feedRound:D,structureName:P}=h;if(Oa({loser:"loser",roundPosition:T,structureName:P,roundNumber:U,keyColors:sS,feedRound:D,stage:w}),((n=o==null?void 0:o.progression)==null?void 0:n.doubleExitPropagateBye)||y)XM({drawPosition:g,targetLink:v,inContextDrawMatchUps:a,drawDefinition:s,matchUpsMap:l});else{let E=sj({...t,targetMatchUp:h,structure:S,iteration:p});if(E.error)return te({result:E,stack:m})}}return te({result:{...Q},stack:m})}function sj(t){var e,i,r,n,a,o;let{inContextDrawMatchUps:s,appliedPolicies:l,drawDefinition:u,sourceMatchUp:c,targetMatchUp:d,matchUpsMap:p,structure:m,iteration:h}=t,f="conditionallyRemoveDrawPosition";Oa({method:f,structureName:m==null?void 0:m.structureName,iteration:h});let g=On({matchUpId:d.matchUpId,inContextDrawMatchUps:s,drawDefinition:u}),{targetMatchUps:{winnerMatchUp:v}}=g,y=p==null?void 0:p.drawMatchUps.find(P=>P.matchUpId===d.matchUpId),I=[],b,S,w;if(d.feedRound)w=(i=(e=v==null?void 0:v.drawPositions)==null?void 0:e.filter(Boolean))==null?void 0:i.find(P=>d.drawPositions.includes(P));else if(!c)w=(r=ji((d==null?void 0:d.drawPositions)||[],(v==null?void 0:v.drawPositions)||[]))==null?void 0:r[0];else if(S=(n=AJ({structureId:m.structureId,matchUp:c,matchUpsMap:p}))==null?void 0:n.pairedPreviousMatchUp,b=[tr,dr].includes(S==null?void 0:S.matchUpStatus),I=((a=S==null?void 0:S.drawPositions)==null?void 0:a.filter(Boolean))||[],[...yr,jt].includes(S==null?void 0:S.matchUpStatus)||(S==null?void 0:S.winningSide)){let P=c.drawPositions||[],E=(o=d.drawPositions)==null?void 0:o.filter(Boolean);Nn(P,E)&&(E=E==null?void 0:E.filter(R=>!P.includes(R))),w=P.concat(I).find(R=>E==null?void 0:E.includes(R))}if(v&&w){let{stage:P,roundNumber:E,roundPosition:R,structureName:N}=v;Oa({method:"removeDirectedWinner",drawPositionToRemove:w,color:"brightgreen",roundPosition:R,structureName:N,roundNumber:E,keyColors:sS,stage:P}),hte({winningDrawPosition:w,winnerMatchUp:v,inContextDrawMatchUps:s,drawDefinition:u,matchUpsMap:p})}let U=vte({targetData:g,matchUp:d,inContextDrawMatchUps:s,appliedPolicies:l,drawDefinition:u,matchUpsMap:p,structure:m,iteration:h});if(U.error)return te({result:U,stack:f});let T=KCe({pairedPreviousDoubleExit:b,noContextTargetMatchUp:y}),D=!b;return U=Js({...t,matchUpId:d.matchUpId,matchUp:y,removeWinningSide:!0,matchUpStatusCodes:[],context:f,matchUpStatus:T,removeScore:D,score:{scoreStringSide1:"",scoreStringSide2:"",sets:void 0}}),U.error?te({result:U,stack:f}):{...Q}}function KCe({pairedPreviousDoubleExit:t,noContextTargetMatchUp:e}){return e.matchUpStatus===jt?jt:t?[dr,Pt].includes(e==null?void 0:e.matchUpStatus)?Pt:Ft:Qi}function XCe(t){var e,i,r,n,a;let o,{inContextDrawMatchUps:s,inContextMatchUp:l,drawDefinition:u}=t,c=(e=t.targetData.targetLinks)==null?void 0:e.winnerTargetLink;if(c.target.feedProfile===gs){let d=(r=(i=l.sides)==null?void 0:i.find(({sideNumber:m})=>m===l.winningSide))==null?void 0:r.participantId,p=s.find(m=>{var h;return m.structureId===c.target.structureId&&m.roundNumber===c.target.roundNumber&&((h=m.sides)==null?void 0:h.some(({participantId:f})=>f===d))});if(p&&p.matchUpStatus===Qi){let m=On({matchUpId:p.matchUpId,inContextDrawMatchUps:s,drawDefinition:u});if(!np({inContextDrawMatchUps:s,drawDefinition:u,targetData:m})){let{structure:h}=tt({structureId:p.structureId,drawDefinition:u}),f=si({structure:h}).positionAssignments;for(let g of f||[])if(g.participantId===d){if(g.participantId=void 0,h==null?void 0:h.positionAssignments)h.positionAssignments=f;else if(h!=null&&h.structures){let v=Object.assign({},...(f||[]).map(y=>({[y.drawPosition]:y.participantId})));for(let y of(h==null?void 0:h.structures)||[])(n=y.positionAssignments)==null||n.forEach(I=>I.participantId=v[I.drawPosition])}Fc({tournamentId:(a=t.tournamentRecord)==null?void 0:a.tournamentId,event:t.event,drawDefinition:u,structure:h}),o=!0}}}}return{qualifierRemoved:o}}function JCe(t){var e;let{matchUp:i,matchUpStatus:r,score:n,winningSide:a}=t,o="noDownStreamDependencies";if([tr,dr].includes(i==null?void 0:i.matchUpStatus)&&![tr,dr].includes(r)){let g=vte(t);if(g.error)return te({result:g,stack:o})}let s=r===tr,l=br({score:n})&&!s&&(t.isCollectionMatchUp&&!t.projectedWinningSide||!a),u=((e=t==null?void 0:t.inContextMatchUp)==null?void 0:e.collectionId)&&BCe(t.inContextMatchUp),c=t.removeScore||!u&&![Ca,ua].includes(r||Ca),d=t.isCollectionMatchUp&&t.dualMatchUp.winningSide&&!t.projectedWinningSide||i.winningSide&&!a&&!br({score:n}),p=r&&r!==Qi,m=g=>{var v,y;let I,{structure:b,drawDefinition:S,dualMatchUp:w,disableAutoCalc:U}=t;if(w!=null&&w._disableAutoCalc&&U!==!1)return o_({...t,removeWinningSide:d});let{connectedStructureIds:T}=gte({drawDefinition:S,structure:b,matchUp:i});T.length&&(console.log({connectedStructureIds:T}),I=!0),Object.assign(t,{removeScore:g});let D=kv(t);if(D.error)return D;if(t.removingQualifier&&(y=(v=t.appliedPolicies)==null?void 0:v[oy])!=null&&y.autoRemoveQualifiers){let P=XCe(t);return{...Q,connectedStructures:I,...P}}return{...Q,connectedStructures:I}};if(d&&a&&t.isCollectionMatchUp)return lj(t);let h=[bl,ua].includes(r)&&t.dualWinningSideChange,f=(a||h)&&YCe(t)||l&&m(c)||p&&jCe(t)||d&&m(c)||i&&lj({...t,removeScore:!0})||{...Q};return te({result:f,stack:o})}function lj(t){var e;let i="ndd:scoreModification";if(t.isCollectionMatchUp&&(e=t.dualMatchUp)!=null&&e.winningSide&&!t.projectedWinningSide&&!t.autoCalcDisabled){let n=kv(t);if(n.error)return n}let r=Js({...t,context:i});if(t.isCollectionMatchUp){let{matchUpTieId:n,drawDefinition:a,event:o,matchUpsMap:s}=t,{removeWinningSide:l}=ic({tournamentRecord:t.tournamentRecord,appliedPolicies:t.appliedPolicies,matchUpId:n,drawDefinition:a,matchUpsMap:s,event:o});l&&console.log("REMOVE WINNING SIDE")}return te({result:r,stack:i})}function C$(t){var e,i,r;let n=We(t,[{[Ur]:!0,[$n]:!0,[Il]:!0},{homeParticipantId:!0,[Wo]:hr}]);if(n.error)return n;let a=Cv(t,[{[hv]:ru,attr:{[NP]:!0}}]);if(a.error)return a;let o=(r=(i=(e=a==null?void 0:a.matchUp)==null?void 0:e.matchUp)==null?void 0:i.sides)==null?void 0:r.map(m=>m==null?void 0:m.participantId);if(t.homeParticipantId&&!(o!=null&&o.includes(t.homeParticipantId)))return{error:Ms};let{disableNotice:s=!0,homeParticipantId:l,removePriorValues:u,tournamentRecord:c,drawDefinition:d,matchUpId:p}=t;return Na({duplicateValues:!1,removePriorValues:u,tournamentRecord:c,drawDefinition:d,disableNotice:s,matchUpId:p,timeItem:{itemType:wL,itemValue:l}})}function Ite({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:r,timeStamp:n}=Ap({timeItems:(i==null?void 0:i.timeItems)||[],itemType:YP});return!e||n&&t&&new Date(n).getTime()>new Date(t).getTime()?{timeModifiers:r}:e}function ld(t){var e;let i="addMatchUpScheduledTime",r=t.matchUp,{removePriorValues:n,tournamentRecord:a,drawDefinition:o,disableNotice:s,scheduledTime:l,matchUpId:u}=t;if(!u)return te({result:{error:bn},stack:i});if(!pv(l))return te({result:{error:Ao},stack:i});if(!r){let h=Si({drawDefinition:o,matchUpId:u});if(h.error)return te({result:h,stack:i});r=h.matchUp}let c=mt(l),d=Oh({matchUp:r}).scheduledDate,p=c&&!d;if((e=Ite({matchUp:r}).timeModifiers||[])!=null&&e.length){let h=yte({disableNotice:!0,removePriorValues:n,tournamentRecord:a,timeModifiers:[],drawDefinition:o,matchUpId:u,matchUp:r});if(h!=null&&h.error)return te({result:h,stack:i})}let m=Sh(l,!0,p);return Na({duplicateValues:!1,removePriorValues:n,tournamentRecord:a,drawDefinition:o,disableNotice:s,matchUpId:u,timeItem:{itemType:Nh,itemValue:m}})}function yte({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,timeModifiers:n,matchUpId:a,matchUp:o}){let s="addMatchUpTimeModifiers";if(!a)return te({result:{error:bn},stack:s});if(n!==void 0&&!Array.isArray(n))return te({info:ip("timeModifiers"),result:{error:se},stack:s});if(!o){let d=Si({drawDefinition:i,matchUpId:a});if(d.error)return te({result:d,stack:s});o=d.matchUp}let l=Ite({matchUp:o}).timeModifiers||[],u=n.filter(d=>!l.includes(d));if(n.length&&!u.length)return{...Q};if(u.some(d=>SM.includes(d))){l=l.filter(p=>!SM.includes(p));let d=ld({disableNotice:!0,removePriorValues:t,scheduledTime:"",tournamentRecord:e,drawDefinition:i,matchUpId:a});if(d.error)return te({result:d,stack:s})}let c=n!=null&&n.length?[...u,...l]:void 0;return Na({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:a,timeItem:{itemType:YP,itemValue:c}})}function KR({scheduledDate:t,removePriorValues:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:a}){if(!a)return{error:bn};let o=t&&ol.test(t);if(t&&!o)return{error:Fr};let s={itemValue:mt(t),itemType:Mh};return Na({duplicateValues:!1,removePriorValues:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:a,timeItem:s})}function XR({removePriorValues:t,tournamentRecords:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,courtDayDate:a,matchUpId:o,courtIds:s}){var l,u;if(!i&&!e)return{error:ve};if(!o)return{error:bn};let c=Si({drawDefinition:r,matchUpId:o});if(c.error)return c;if(((l=c==null?void 0:c.matchUp)==null?void 0:l.matchUpType)!==Ba)return{error:la};if(!(s===void 0||Array.isArray(s)&&s.length&&s.every(p=>typeof p=="string")))return{error:se,context:{courtIds:s}};let d;if(s){let p=e||i&&{[i.tournamentId]:i},m=rc({tournamentRecords:p});if(m.error)return m;let h=(u=m.courts)==null?void 0:u.filter(f=>s.includes(f.courtId));if((h==null?void 0:h.length)!==s.length)return{error:se,context:{courtIds:s}};d=h==null?void 0:h.map(f=>({venueId:f.venueId,courtId:f.courtId}))}return Na({duplicateValues:!1,removePriorValues:t,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:o,timeItem:{itemType:Ql,itemDate:a,itemValue:d}})}function xv({removePriorValues:t,tournamentRecords:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:a,venueId:o}){if(!i)return{error:ve};if(!a)return{error:bn};if(o){let s=nu({tournamentRecords:e,tournamentRecord:i,venueId:o});if(s.error)return s}return Na({duplicateValues:!1,removePriorValues:t,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:a,timeItem:{itemType:Ch,itemValue:o}})}function Hh({removePriorValues:t,tournamentRecords:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,courtDayDate:a,matchUpId:o,courtId:s}){var l;if(!i&&!e)return{error:ve};if(!o)return{error:bn};if(s){let u=kh({tournamentRecords:e,tournamentRecord:i,courtId:s});if(u.error)return u;let c=(l=u.venue)==null?void 0:l.venueId;xv({tournamentRecords:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:o,venueId:c})}return Na({duplicateValues:!1,removePriorValues:t,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:o,timeItem:{itemType:Lc,itemDate:a,itemValue:s}})}function js(t,e){let i=n8.test(t)?t:Ui(t),r=mt(t)||mt(e)||Ho(new Date);return new Date(`${r}T${i}`).getTime()}function JR(t){var e;let i="addMatchUpScheduleItems",r=We(t,[{drawDefinition:!0,matchUpId:!0},{schedule:!0,[Jn]:ta}],i);if(r.error)return r;let{matchUpDependencies:n,inContextMatchUps:a}=t,{errorOnAnachronism:o=!1,checkChronology:s=!0,removePriorValues:l,tournamentRecords:u,tournamentRecord:c,drawDefinition:d,disableNotice:p,drawMatchUps:m,matchUpId:h,schedule:f,event:g}=t,v,y;if(m)v=m.find(C=>C.matchUpId===h);else{let C=Si({drawDefinition:d,event:g,matchUpId:h});if(C.error)return C;v=C.matchUp}let{endTime:I,courtId:b,courtIds:S,courtOrder:w,resumeTime:U,homeParticipantId:T,scheduledDate:D,scheduledTime:P,startTime:E,stopTime:R,timeModifiers:N,venueId:A}=f;s&&(!n||!a)&&({matchUpDependencies:n,matchUps:a}=ps({drawDefinition:d}));let M=(e=n==null?void 0:n[h])==null?void 0:e.matchUpIds;if(f.scheduledDate&&s&&M){let C=a==null?void 0:a.filter(O=>{var k,x;return(((k=O.schedule)==null?void 0:k.scheduledDate)||mt((x=O.schedule)==null?void 0:x.scheduledTime))&&M.includes(O.matchUpId)}).map(({schedule:O})=>{let k=ZS(O);return new Date(k).getTime()});if(C!=null&&C.length){let O=ZS(f),k=new Date(O).getTime();if(Math.max(...C)>=k){if(o)return te({result:{error:nM},stack:i});y=nM}}}if(D!==void 0){let C=KR({disableNotice:!0,removePriorValues:l,tournamentRecord:c,drawDefinition:d,scheduledDate:D,matchUpId:h});if(C!=null&&C.error)return te({result:C,stack:i,context:{scheduledDate:D}})}if(P!==void 0){let C=ld({disableNotice:!0,removePriorValues:l,tournamentRecord:c,drawDefinition:d,scheduledTime:P,matchUpId:h,matchUp:v});if(C!=null&&C.error)return te({result:C,stack:i,context:{scheduledTime:P}})}if(E!==void 0){let C=N$({disableNotice:!0,removePriorValues:l,tournamentRecord:c,drawDefinition:d,matchUpId:h,startTime:E,event:g});if(C!=null&&C.error)return te({result:C,stack:i,context:{startTime:E}})}if(R!==void 0){let C=O$({disableNotice:!0,removePriorValues:l,tournamentRecord:c,drawDefinition:d,matchUpId:h,stopTime:R,event:g});if(C!=null&&C.error)return te({result:C,stack:i,context:{stopTime:R}})}if(U!==void 0){let C=k$({disableNotice:!0,removePriorValues:l,tournamentRecord:c,drawDefinition:d,resumeTime:U,matchUpId:h,event:g});if(C!=null&&C.error)return te({result:C,stack:i,context:{resumeTime:U}})}if(I!==void 0){let C=A$({disableNotice:!0,removePriorValues:l,tournamentRecord:c,drawDefinition:d,matchUpId:h,endTime:I,event:g});if(C!=null&&C.error)return te({result:C,stack:i,context:{endTime:I}})}if(S!==void 0){let C=XR({disableNotice:!0,removePriorValues:l,tournamentRecord:c,drawDefinition:d,matchUpId:h,courtIds:S});if(C!=null&&C.error)return te({result:C,stack:i,context:{courtIds:S}})}if(b!==void 0&&D!==void 0){let C=Hh({courtDayDate:D,disableNotice:!0,removePriorValues:l,tournamentRecords:u,tournamentRecord:c,drawDefinition:d,matchUpId:h,courtId:b});if(C!=null&&C.error)return te({result:C,stack:i,context:{courtId:b}})}if(A!==void 0){let C=xv({disableNotice:!0,removePriorValues:l,tournamentRecords:u,tournamentRecord:c,drawDefinition:d,matchUpId:h,venueId:A});if(C!=null&&C.error)return te({result:C,stack:i,context:{venueId:A}})}if(w!==void 0&&st(w)){let C=M$({disableNotice:!0,removePriorValues:l,tournamentRecord:c,drawDefinition:d,courtOrder:w,matchUpId:h});if(C!=null&&C.error)return te({result:C,stack:i,context:{courtOrder:w}})}if(N!==void 0){let C=yte({disableNotice:!0,removePriorValues:l,tournamentRecord:c,drawDefinition:d,timeModifiers:N,matchUpId:h,matchUp:v});if(C!=null&&C.error)return te({result:C,stack:i,context:{timeModifiers:N}})}return Di(T)&&C$({disableNotice:!0,homeParticipantId:T,removePriorValues:l,tournamentRecord:c,drawDefinition:d,matchUpId:h}),p||Et({tournamentId:c==null?void 0:c.tournamentId,eventId:g==null?void 0:g.eventId,context:i,drawDefinition:d,matchUp:v}),y?{...Q,warnings:[y]}:{...Q}}function M$({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,courtOrder:n,matchUpId:a}){if(!a)return{error:bn};if(n&&!st(n))return{error:se,info:"courtOrder must be numeric"};let o=n&&Ze(n);return Na({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:a,timeItem:{itemType:qP,itemValue:o}})}function bte({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,participantId:n,officialType:a,matchUpId:o}){if(!o)return{error:bn};if(!n)return{error:hr};if(e){let l=Oi({tournamentRecord:e,participantFilters:{participantTypes:[Dt],participantRoles:[NL]}}).participants??[];if(!Ac({tournamentParticipants:l,participantId:n}))return{error:Wi}}let s={itemType:"SCHEDULE.ASSIGNMENT.OFFICIAL",itemValue:n};return a&&(s.itemSubTypes=[a]),Na({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:o,timeItem:s})}function N$({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:n,startTime:a,event:o}){if(!n)return{error:bn};if(!pv(a))return{error:Ao};let{matchUp:s}=Si({drawDefinition:i,event:o,matchUpId:n}),{scheduledDate:l}=Oh({matchUp:s}),u=((s==null?void 0:s.timeItems)??[]).filter(c=>[Iu,Fl,$u].includes(c==null?void 0:c.itemType)).map(c=>js(c.itemValue,l)).reduce((c,d)=>!c||d<c?d:c,void 0);if(!u||js(a,l)<u){s!=null&&s.timeItems&&(s.timeItems=s.timeItems.filter(d=>d.itemType!==vs));let c=Sh(a,!0,!0);return Na({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:n,timeItem:{itemType:vs,itemValue:c}})}else return{error:C9}}function A$({validateTimeSeries:t=!0,removePriorValues:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:a,endTime:o,event:s}){if(!a)return{error:bn};if(!pv(o))return{error:Ao};let{matchUp:l}=Si({drawDefinition:r,event:s,matchUpId:a}),{scheduledDate:u}=Oh({matchUp:l}),c=((l==null?void 0:l.timeItems)??[]).filter(d=>[vs,Fl,Iu].includes(d==null?void 0:d.itemType)).map(d=>js(d.itemValue,u)).reduce((d,p)=>!d||p>d?p:d,void 0);if(!t||!c||js(o,u)>c){l!=null&&l.timeItems&&(l.timeItems=l.timeItems.filter(p=>p.itemType!==$u));let d=Sh(o,!0,!0);return Na({duplicateValues:!1,removePriorValues:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:a,timeItem:{itemType:$u,itemValue:d}})}else return{error:R9}}function O$({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:n,stopTime:a,event:o}){if(!n)return{error:bn};if(!pv(a))return{error:Ao};let{matchUp:s}=Si({drawDefinition:i,event:o,matchUpId:n}),{scheduledDate:l}=Oh({matchUp:s}),u=(s==null?void 0:s.timeItems)??[];if(u.reduce((h,f)=>f.itemType===$u||h,void 0))return{error:lF};let c=u.filter(h=>[vs,Fl,Iu].includes(h==null?void 0:h.itemType)).sort((h,f)=>js(h.itemValue,l)-js(f.itemValue,l)),d=c[c.length-1],p=d&&d.itemType===Iu,m=c.filter(h=>!p||h.createdAt!==d.createdAt).map(h=>js(h.itemValue,l)).reduce((h,f)=>!h||f>h?f:h,void 0);if(js(a,l)>m){if(s!=null&&s.timeItems&&p){let f=d.createdAt;s.timeItems=s.timeItems.filter(g=>g.createdAt!==f)}let h={itemValue:Sh(a,!0,!0),itemType:Iu};return Na({duplicateValues:!0,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:n,timeItem:h})}else return{error:E9}}function k$({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,resumeTime:n,matchUpId:a,event:o}){if(!a)return{error:bn};if(!pv(n))return{error:Ao};let{matchUp:s}=Si({drawDefinition:i,event:o,matchUpId:a}),{scheduledDate:l}=Oh({matchUp:s}),u=(s==null?void 0:s.timeItems)??[];if(u.reduce((h,f)=>f.itemType===$u||h,void 0))return{error:lF};let c=u.filter(h=>[vs,Fl,Iu].includes(h==null?void 0:h.itemType)).sort((h,f)=>js(h.itemValue,l)-js(f.itemValue,l)),d=c[c.length-1],p=d&&d.itemType===Fl,m=c.filter(h=>!p||h.createdAt!==d.createdAt).map(h=>js(h.itemValue,l)).reduce((h,f)=>!h||f>h?f:h,void 0);if(js(n,l)>m){if(s!=null&&s.timeItems&&p){let f=d.createdAt;s.timeItems=s.timeItems.filter(g=>g.createdAt!==f)}let h={itemValue:Sh(n,!0,!0),itemType:Fl};return Na({duplicateValues:!0,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:a,timeItem:h})}else return{error:aUe}}function QCe({drawDefinition:t,matchUpStatus:e,matchUpsMap:i,winningSide:r,dualMatchUp:n,tieFormat:a,structure:o,matchUp:s,event:l,score:u}){var c;let d=Ne(n,void 0,!0);for(let m of(d==null?void 0:d.tieMatchUps)||[])m.matchUpId===s.matchUpId&&(m.winningSide=r,m.score=u,!br({score:u})&&!e?Object.assign(m,{...uR}):e&&(m.matchUpStatus=e));a=a??((c=In({matchUp:s,structure:o,drawDefinition:t,event:l}))==null?void 0:c.tieFormat);let{winningSide:p}=$w({matchUp:d,drawDefinition:t,matchUpsMap:i,structure:o,tieFormat:a,event:l});return{projectedWinningSide:p}}function ZCe(t){var e;let{tournamentRecord:i,inContextMatchUp:r,structure:n,drawDefinition:a}=t,o=r.roundNumber,s=r.sides.find(w=>w.sideNumber===r.winningSide),l=r.sides.find(w=>w.sideNumber!==r.winningSide),{drawPosition:u,participantId:c}=s,{drawPosition:d,participantId:p}=l,m="swapWinnerLoser",{matchUps:h}=qt(t),f=h.filter(({drawPositions:w,roundNumber:U})=>(w==null?void 0:w.includes(u))&&U>o);ja({changeWinner:!0})&&console.log({existingWinnerSubsequentMatchUps:f}),f.forEach(w=>{var U,T;w.drawPositions=((U=w.drawPositions)==null?void 0:U.map(D=>D===u?d:D))||[],Et({tournamentId:i==null?void 0:i.tournamentId,eventId:(T=t.event)==null?void 0:T.eventId,context:m,drawDefinition:a,matchUp:w})});let{stage:g,stageSequence:v}=n,y=a.structures.filter(({stage:w,stageSequence:U})=>w===g&&U>v).map(({structureId:w})=>w),{targetLinks:{loserTargetLink:I,winnerTargetLink:b}}=t.targetData,S=[I==null?void 0:I.target.structureId,(e=b==null?void 0:b.target)==null?void 0:e.structureId].filter(Boolean);return a.structures.filter(({stage:w,structureId:U})=>w!==g&&S.includes(U)).forEach(({stage:w,stageSequence:U,structureId:T})=>{y.includes(T)||y.push(T),a.structures.filter(({stage:D,stageSequence:P})=>D===w&&P>U).forEach(({structureId:D})=>{y.includes(D)||y.push(D)})}),a.structures.filter(({structureId:w})=>y.includes(w)).forEach(w=>{let{positionAssignments:U}=si({structure:w}),T=U==null?void 0:U.find(({participantId:P})=>P===c),D=U==null?void 0:U.find(({participantId:P})=>P===p);T&&(T.participantId=p),D&&(D.participantId=c)}),Js({...t,context:m})}function eU(t){var e,i,r;let n="setMatchUpStatus";t.matchUpStatus&&[Ft,tr].includes(t.matchUpStatus)&&(t.score=void 0);let{allowChangePropagation:a,disableScoreValidation:o,tournamentRecords:s,tournamentRecord:l,disableAutoCalc:u,enableAutoCalc:c,drawDefinition:d,matchUpStatus:p,winningSide:m,matchUpId:h,event:f,score:g}=t;if(!d)return{error:$e};if(p&&[bl,Ca,ua,Qi].includes(p)&&m)return{error:se,winningSide:m,matchUpStatus:p};if(![void 0,...bX].includes(p))return te({result:{error:sv},info:"matchUpStatus does not exist",stack:"setMatchUpStatus"});let v=ln({drawDefinition:d}),{matchUps:y}=fr({nextMatchUps:!0,tournamentRecord:l,inContext:!0,drawDefinition:d,matchUpsMap:v,event:f}),I=v.drawMatchUps.find(B=>B.matchUpId===h),b=y==null?void 0:y.find(B=>B.matchUpId===h);if(!I||!y)return{error:hn};if((I.winningSide||m)&&p===jt)return{context:"Cannot have Bye with winningSide",error:qU,matchUpStatus:p};let S=b==null?void 0:b.structureId,{structure:w}=tt({drawDefinition:d,structureId:S}),U=Xi(fi)(I.matchUpType),T=(e=b==null?void 0:b.drawPositions)==null?void 0:e.filter(Boolean),D=b==null?void 0:b.matchUpTieId,P=On({matchUpId:D||h,inContextDrawMatchUps:y,drawDefinition:d});Object.assign(t,{inContextDrawMatchUps:y,inContextMatchUp:b,matchUpTieId:D,matchUpsMap:v,targetData:P,structure:w,matchUp:I});let E=np(t),R;if(U){if(u)_t({extension:{name:xm,value:!0},element:I});else if(c){let B=I.winningSide,{winningSide:V,scoreStringSide1:G,scoreStringSide2:j,set:z}=$w({drawDefinition:d,matchUpsMap:v,structure:w,matchUp:I,event:f}),W={scoreStringSide1:G,scoreStringSide2:j,sets:z?[z]:[]};if(R=V!==B,E&&R)return te({stack:"winningSideWithDownstreamDependencies",result:{error:dP},context:{winningSide:m,matchUp:I}});Dn({name:xm,element:I}),Object.assign(t,{winningSide:V,dualWinningSideChange:R,projectedWinningSide:V,score:W})}Bw({tournamentId:l==null?void 0:l.tournamentId,inContextDualMatchUp:b,eventId:f==null?void 0:f.eventId,dualMatchUp:I,drawDefinition:d})}if(U&&p&&[Dh].includes(p))return{info:"Not supported for matchUpType: TEAM",error:se};if(g&&!U&&!o){let B=I.matchUpFormat??(w==null?void 0:w.matchUpFormat)??(d==null?void 0:d.matchUpFormat)??(f==null?void 0:f.matchUpFormat),V=M_({existingMatchUpStatus:I.matchUpStatus,matchUpFormat:B,matchUpStatus:p,winningSide:m,score:g});if(V.error)return V}let N=((i=Bt({policyTypes:[oy,fo],tournamentRecord:l,drawDefinition:d,event:f}))==null?void 0:i.appliedPolicies)??{};At(t.policyDefinitions)&&Object.assign(N,t.policyDefinitions);let A=t1e({assignedDrawPositions:T,inContextMatchUp:b,appliedPolicies:N,drawDefinition:d,matchUpStatus:p,structure:w,matchUp:I});if(A!=null&&A.error)return A;let M=(b==null?void 0:b.stage)===Ke&&b.finishingRound===1,C=M&&m,O=M&&I.winningSide&&!m&&(!t.matchUpStatus||t.matchUpStatus&&RM({matchUpStatus:t.matchUpStatus}))&&(!t.outcome||!br({outcome:t.outcome})),k=C&&m!==I.winningSide&&I.winningSide;if(Object.assign(t,{qualifierAdvancing:C,qualifierChanging:k,removingQualifier:O,appliedPolicies:N}),D){let{matchUp:B}=Si({matchUpId:D,inContext:!0,drawDefinition:d,matchUpsMap:v,event:f});if(B){let V=(r=In({matchUp:B,drawDefinition:d,structure:w,event:f}))==null?void 0:r.tieFormat,{projectedWinningSide:G}=QCe({drawDefinition:d,matchUpStatus:p,dualMatchUp:B,matchUpsMap:v,winningSide:m,tieFormat:V,structure:w,matchUp:I,event:f,score:g}),j=B.winningSide;R=G!==j;let z=B._disableAutoCalc;Object.assign(t,{isCollectionMatchUp:!0,dualWinningSideChange:R,projectedWinningSide:G,autoCalcDisabled:z,matchUpTieId:D,dualMatchUp:B,tieFormat:V})}}let x=Tw({matchUpStatus:p});if(!D){if(E&&!m&&(p&&RM({matchUpStatus:p})||p&&[tr,dr].includes(p)))return{error:qU,activeDownstream:E,winningSide:m};if(m&&m===I.winningSide&&p&&!x)return{context:"winningSide must include directing matchUpStatus",error:qU,directingMatchUpStatus:x,matchUpStatus:p}}let{schedule:F}=t;if(F){let B=JR({disableNotice:!0,tournamentRecords:s,tournamentRecord:l,drawDefinition:d,matchUpId:h,schedule:F});if(B.error)return B}let $=!U&&!R&&m&&I.winningSide&&I.winningSide!==m;if(a&&$&&I.roundPosition)return ZCe(t);let _=m&&!D||t.projectedWinningSide;Oa({activeDownstream:E,matchUpWinner:_,method:n,winningSide:m});let L=!E&&JCe(t)||_&&e1e(t)||(x||t.autoCalcDisabled)&&wte(t)||{error:L9};return te({result:L,stack:n})}function e1e(t){let{matchUp:e,winningSide:i,matchUpTieId:r,dualWinningSideChange:n}=t;return i===e.winningSide||r&&!n?wte(t):te({stack:"winningSideWithDownstreamDependencies",result:{error:dP},context:{winningSide:i,matchUp:e}})}function wte(t){let{tournamentRecord:e,matchUp:i,event:r}=t,n=t.isCollectionMatchUp&&i.winningSide&&!t.winningSide&&!br({score:t.score}),a=t.isCollectionMatchUp?t.matchUpStatus||n&&Qi||t.winningSide&&Ki||Ca:t.matchUpStatus||Ki,o=t.removeScore||[bl,Ft].includes(a)&&![Ca,ua].includes(a),s=Js({...t,matchUpStatus:a,removeWinningSide:n,context:"sms",removeScore:o});if(s.error)return s;if(t.isCollectionMatchUp){let{matchUpTieId:l,drawDefinition:u,matchUpsMap:c}=t,d=ic({appliedPolicies:t.appliedPolicies,matchUpId:l,tournamentRecord:e,drawDefinition:u,matchUpsMap:c,event:r});if(d.error)return d;Object.assign(s,{tieMatchUpResult:d})}return s}function t1e({assignedDrawPositions:t,inContextMatchUp:e,appliedPolicies:i,drawDefinition:r,matchUpStatus:n,structure:a,matchUp:o}){var s,l;if(((s=i==null?void 0:i[fo])==null?void 0:s.requireParticipantsForScoring)===!1)return{...Q};let u=(l=e==null?void 0:e.sides)==null?void 0:l.map(p=>p.participantId).filter(Boolean).length,c=o!=null&&o.sides?[]:si({structureId:a==null?void 0:a.structureId,drawDefinition:r}).positionAssignments,d=u&&u===2||o.collectionId&&Yn({structure:a})&&u&&u>=1||(t==null?void 0:t.length)===2&&(c==null?void 0:c.filter(p=>t.includes(p.drawPosition)).every(p=>p.participantId));return n&&yX.includes(n)&&!d?te({info:"matchUpStatus requires assigned participants",context:{matchUpStatus:n,requiredParticipants:d},result:{error:sv}}):{...Q}}function Ute({tournamentRecord:t,drawDefinition:e,matchUpId:i,event:r}){if(!e)return{error:$e};let{matchUp:n}=Si({drawDefinition:e,matchUpId:i,event:r});return(n==null?void 0:n.matchUpType)!==Ba?{error:la}:eU({enableAutoCalc:!0,tournamentRecord:t,drawDefinition:e,matchUpId:i,event:r})}function Ste({drawDefinition:t,event:e,matchUpId:i}){if(!t)return{error:$e};if(!i)return{error:bn};let{matchUp:r}=Si({drawDefinition:t,event:e,matchUpId:i});return r?Dn({name:LP,element:r}):{error:hn}}function i1e({substituteParticipantId:t,existingParticipantId:e,tournamentRecord:i,drawDefinition:r,sideNumber:n,matchUpId:a,event:o}){var s,l,u,c,d;let p="substituteParticipant";if(!r)return{error:$e};if(!a)return{error:bn};if(!e||!t)return te({result:{error:hr},stack:p});let{matchUp:m}=Si({drawDefinition:r,matchUpId:a,event:o});if(!m)return{error:hn};if(!m.collectionId)return te({result:{error:la},stack:p});let h=ln({drawDefinition:r}),{matchUps:f}=fr({tournamentParticipants:i==null?void 0:i.participants,inContext:!0,drawDefinition:r,matchUpsMap:h}),g=f==null?void 0:f.find(y=>y.matchUpId===a),v=(l=(s=f==null?void 0:f.find(y=>y.matchUpId===(g==null?void 0:g.matchUpTieId)))==null?void 0:s.sides)==null?void 0:l.find(y=>y.participant.individualParticipants.some(({participantId:I})=>I===e));return!v||n&&v.sideNumber!==n?{error:Ms}:(d=(c=(u=v.participant)==null?void 0:u.individualParticipants)==null?void 0:c.map(Tt).filter(y=>y!==e))!=null&&d.includes(t)?R$({newParticipantId:t,tieMatchUpId:a,existingParticipantId:e,substitution:!0,tournamentRecord:i,drawDefinition:r,event:o}):te({result:{error:Ms},stack:p})}function Tte(t){return i1e(t)}function Dte({drawDefinition:t,matchUpId:e,event:i}){if(!t)return{error:$e};let{matchUp:r}=Si({drawDefinition:t,matchUpId:e,event:i});return _t({extension:{name:xm,value:!0},element:r})}function Pte(t){let e="setMatchUpFormat",i=We(t,[{tournamentRecord:!0},{[Xr]:S=>Ra({matchUpFormat:S}),[Ha]:Kb,matchUpFormat:!0}]);if(i.error)return te({result:i,stack:e});let{tournamentRecord:r,drawDefinition:n,scheduledDates:a,stageSequences:o,matchUpFormat:s,structureId:l,eventType:u,matchUpId:c,eventId:d,stages:p,drawId:m,event:h,force:f}=t;if(a&&!Array.isArray(a))return te({result:{error:se,scheduledDates:a},stack:e});if(u&&!nP([sl,ho],u))return te({result:{error:Wl},stack:e});let g=0,v=t.structureIds||l&&[l].filter(Boolean)||[],y=t.eventIds||d&&[d].filter(Boolean)||[],I=t.drawIds||m&&[m].filter(Boolean)||[];if((l||v!=null&&v.length)&&!n)return te({result:{error:$e},stack:e});if(m&&c&&n){let S=k_({tournamentRecord:r,drawDefinition:n,matchUpFormat:s,structureIds:v,structureId:l,matchUpId:c});if(S.error)return S;g+=1}let b=S=>{let w=[];for(let U of S.structures||[]){if(Array.isArray(p)&&!p.includes(U.stage)||Array.isArray(o)&&!o.includes(U.stageSequence)||v!=null&&v.length&&!v.includes(U.structureId))continue;v!=null&&v.length&&U.matchUpFormat!==s&&(U.matchUpFormat=s,w.push(U.structureId),g+=1);let T=((f||a)&&qt({matchUpFilters:{matchUpStatuses:[Qi]},structure:U}).matchUps)??[],D=(a&&qt({matchUpFilters:{matchUpStatuses:[Qi]},contextFilters:{scheduledDates:a},afterRecoveryTimes:!1,inContext:!0,structure:U}).matchUps)??[];if(T!=null&&T.length){let P=D?D.map(Pr):T.map(Pr);for(let E of T)P.includes(E.matchUpId)&&(E.matchUpFormat=a!=null&&a.length?s:void 0,Et({tournamentId:r==null?void 0:r.tournamentId,eventId:h==null?void 0:h.eventId,context:e,drawDefinition:S,matchUp:E}))}}return!w.length&&S.matchUpFormat!==s&&(S.matchUpFormat=s,g+=1),w};for(let S of(r==null?void 0:r.events)||[])if(!(y!=null&&y.length&&!y.includes(S.eventId)||u&&u!==S.eventType||u===ur))if(Array.isArray(o)||Array.isArray(p)||v!=null&&v.length||I!=null&&I.length)for(let w of S.drawDefinitions||[]){if(Array.isArray(I)&&!I.includes(w.drawId))continue;let U=b(w);ui({structureIds:U,drawDefinition:w})}else S.matchUpFormat!==s&&(S.matchUpFormat=s,g+=1);return g?{...Q,modificationsCount:g}:{...Q,info:dv}}function x$({inheritance:t=!0,tournamentRecord:e,drawDefinition:i,matchUpId:r,event:n}){var a,o;if(!i)return{error:$e};let s=(a=Si({drawDefinition:i,matchUpId:r}))==null?void 0:a.matchUp;if(!(s!=null&&s.tieMatchUps))return{error:la};let l=(o=Si({inContext:!0,drawDefinition:i,matchUpId:r,event:n}))==null?void 0:o.matchUp,u=0;return((s==null?void 0:s.sides)||[]).forEach(c=>{c.lineUp&&delete c.lineUp}),((l==null?void 0:l.sides)||[]).forEach(c=>{if(u+=1,t===!1){let d=l==null?void 0:l.tieFormat,p=c.participantId;d&&p&&$h({drawDefinition:i,participantId:p,lineUp:[],tieFormat:d})}Et({tournamentId:e==null?void 0:e.tournamentId,context:"resetMatchUpLineUps",eventId:n==null?void 0:n.eventId,drawDefinition:i,matchUp:s})}),{...Q,modificationsCount:u}}function Rte(t){let{matchUpFormat:e,matchUpStatus:i,winningSide:r,score:n}=t;if(!n)return{sets:[]};let a=n.sets||[],o=_l({winnerFirst:!1,matchUpFormat:e,matchUpStatus:i,sets:a}),s=_l({winnerFirst:!1,reversed:!0,matchUpFormat:e,matchUpStatus:i,sets:a}),l=_l({matchUpFormat:e,matchUpStatus:i,winningSide:r,sets:a}),u=o===l?s:o;return r&&(o=r===1?l:u,s=r===2?l:u),{score:{sets:a,scoreStringSide1:o,scoreStringSide2:s}}}function tU(t){var e,i;let r=We(t,[{[Il]:!0,[$n]:!0}]);if(r.error)return r;let n=To(t);if(!t.drawDefinition){let I=t.tournamentRecord??(t.tournamentId&&n[t.tournamentId]);t.tournamentRecord||(t.tournamentRecord=I);let b=Kn({eventId:t.eventId,drawId:t.drawId,tournamentRecord:I});if(b.error)return b;b.drawDefinition&&(t.drawDefinition=b.drawDefinition),t.event=b.event}let{disableScoreValidation:a,policyDefinitions:o,tournamentRecord:s,disableAutoCalc:l,enableAutoCalc:u,drawDefinition:c,matchUpId:d,schedule:p,event:m,notes:h}=t,f=t.matchUpFormat||((e=t.outcome)==null?void 0:e.matchUpFormat),{policy:g}=Cp({policyType:fo,tournamentRecord:s,event:m}),v=t.allowChangePropagation!==void 0&&t.allowChangePropagation||(g==null?void 0:g.allowChangePropagation)!==void 0&&g.allowChangePropagation||void 0,{outcome:y}=t;if(y!=null&&y.winningSide&&![1,2].includes(y.winningSide))return{error:uP};if(f){let I=k_({tournamentRecord:s,drawDefinition:c,matchUpFormat:f,matchUpId:d,event:m});if(I.error)return I}if((i=y==null?void 0:y.score)!=null&&i.sets&&!y.score.scoreStringSide1){let{score:I}=Rte(y);y.score=I,y.score.sets=y.score.sets.filter(b=>b.side1Score||b.side2Score||b.side1TiebreakScore||b.side2TiebreakScore)}return eU({matchUpStatusCodes:y==null?void 0:y.matchUpStatusCodes,matchUpStatus:y==null?void 0:y.matchUpStatus,winningSide:y==null?void 0:y.winningSide,allowChangePropagation:v,disableScoreValidation:a,score:y==null?void 0:y.score,tournamentRecords:n,policyDefinitions:o,tournamentRecord:s,disableAutoCalc:l,enableAutoCalc:u,drawDefinition:c,matchUpFormat:f,matchUpId:d,schedule:p,event:m,notes:h})}function Ete(t){if(!(t!=null&&t.outcomes))return{error:Je};if(!Array.isArray(t.outcomes))return{error:Je,info:{outcomes:t.outcomes}};let e=t.tournamentRecords||t.tournamentRecord&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord}||{},i=t.outcomes??[],r=i.reduce((n,a)=>n.includes(a.tournamentId)?n:n.concat(a.tournamentId),[]);for(let n of r){let a=e[n];if(!a)return{error:ve};let o=i.filter(s=>s.tournamentId===n);if(o.length){let s=r1e({outcomes:o,tournamentRecord:a});if(s.error)return s}}return{...Q}}function r1e(t){var e;let{tournamentRecords:i,tournamentRecord:r,outcomes:n,policyDefinitions:a}=t,o={};n.forEach(s=>{let{eventId:l}=s;o[l]||(o[l]=[]),o[l].push(s)});for(let s of Object.keys(o)){let{event:l}=Kn({tournamentRecord:r,eventId:s});for(let u of o[s]){let{drawId:c}=u,d=(e=l==null?void 0:l.drawDefinitions)==null?void 0:e.find(p=>p.drawId===c);if(d&&c){let{matchUpFormat:p,matchUpId:m}=u,h=tU({schedule:u==null?void 0:u.schedule,tournamentRecords:i,policyDefinitions:a,tournamentRecord:r,drawDefinition:d,matchUpFormat:p,matchUpId:m,outcome:u,drawId:c,event:l});if(h.error)return h}}}return{...Q}}function n1e({drawDefinition:t,matchUpId:e,outcome:i,matchUp:r}){var n,a;if(!r&&!t)return{error:$e};if(!i)return{error:Je,info:"missing outcome"};if(!r&&!e)return{error:sa};if(!r){let o=Si({drawDefinition:t,matchUpId:e});if(o.error)return o;r=o.matchUp}return typeof i!="object"||!((n=i.score)!=null&&n.scoreStringSide1)||!((a=i.score)!=null&&a.scoreStringSide2)?{error:se}:_t({element:r,extension:{name:LP,value:i}})}function Cte(t){return n1e(t)}function F$(t){var e,i;let r="resetTieFormat",{drawDefinition:n,event:a,uuids:o}=t,s=We(t,[{[Ur]:!0,[Il]:!0}],r);if(s.error)return s;let l=Cv(t,[{[hv]:ru}]);if(l[Wo])return l;let u=(e=t.tournamentRecord)==null?void 0:e.tournamentId,{matchUp:c,structure:d}=(l==null?void 0:l.matchUp)??{};if(!(c!=null&&c.tieMatchUps))return te({result:{error:la},info:"Must be a TEAM matchUp",stack:r});if(!c.tieFormat)return{...Q};let p=(i=In({structure:d,drawDefinition:n,event:a}))==null?void 0:i.tieFormat;if(!p)return te({result:{error:jr},info:"No inherited tieFormat",stack:r});let m=[],h=[],f=[],g=[];for(let v of p.collectionDefinitions){let{matchUpCount:y,collectionId:I}=v;h.push(I);let b=(c.tieMatchUps||[]).filter(S=>S.collectionId===I);if(b.length>y)b.sort((S,w)=>(S.matchUpStatus===Qi?1:0)-(w.matchUpStatus===Qi?1:0)),f.push(...b.slice(0,y)),m.push(...b.slice(3).map(Pr));else if(f.push(...b),b.length<y){let S=y-b.length,w=Lw({collectionDefinition:v,matchUpsLimit:S,matchUp:c,uuids:o});g.push(...w)}}for(let v of(c==null?void 0:c.tieMatchUps)||[])v.collectionId&&!h.includes(v.collectionId)&&m.push(v.matchUpId);return g.length&&(f.push(...g),xc({eventId:a==null?void 0:a.eventId,matchUps:g,drawDefinition:n,tournamentId:u})),m.length&&Zu({matchUpIds:m,eventId:a==null?void 0:a.eventId,drawDefinition:n,tournamentId:u}),c&&(c.tieMatchUps=f,c.tieFormatId=void 0,c.tieFormat=void 0,Et({structureId:d==null?void 0:d.structureId,eventId:a==null?void 0:a.eventId,context:r,drawDefinition:n,tournamentId:u,matchUp:c})),{...Q,newMatchUps:g,deletedMatchUpIds:m}}function L$(t){var e,i,r;let{tournamentRecord:n,drawDefinition:a,matchUpId:o,event:s}=t,l="resetScorecard";if(!a)return te({result:{error:$e},stack:l});if(!o)return te({result:{error:bn},stack:l});if(!Di(o))return te({result:{error:se,matchUpId:o},stack:l});let u=ln({drawDefinition:a}),{matchUps:c}=fr({nextMatchUps:!0,inContext:!0,drawDefinition:a,matchUpsMap:u}),d=u.drawMatchUps.find(y=>y.matchUpId===o),p=c==null?void 0:c.find(y=>y.matchUpId===o);if(!d||!c)return{error:hn};if(d.matchUpType!==Ea)return{error:la};let m=On({inContextDrawMatchUps:c,drawDefinition:a,matchUpId:o}),h=p==null?void 0:p.structureId,{structure:f}=tt({drawDefinition:a,structureId:h});if(Object.assign(t,{inContextDrawMatchUps:c,inContextMatchUp:p,matchUpsMap:u,targetData:m,structure:f,matchUp:d}),np(t))return{error:dP};if((e=d.tieMatchUps)!=null&&e.length)for(let y of d.tieMatchUps){let I=eU({matchUpId:y.matchUpId,matchUpTieId:o,winningSide:void 0,removeScore:!0,tournamentRecord:n,drawDefinition:a,event:s});if(I.error)return te({result:I,stack:l})}let g=(i=Bt({tournamentRecord:n,drawDefinition:a,event:s}))==null?void 0:i.appliedPolicies,v=ic({event:t.event,removeScore:!0,tournamentRecord:n,appliedPolicies:g,drawDefinition:a,matchUpsMap:u,matchUpId:o});if(v.error)return te({result:v,stack:l});if(t.tiebreakReset&&!v.tieFormatRemoved){let y=(r=In({drawDefinition:a,structure:f,event:s}))==null?void 0:r.tieFormat;if(d.tieFormat&&y){let{matchUpCountDifference:I,descendantDifferences:b,ancestorDifferences:S,valueDifference:w}=Bu({descendant:d.tieFormat,ancestor:y});if(b.collectionIds.length===1&&!S.collectionIds.length&&!S.groupsCount&&I===1&&w===1){let U=F$({tournamentRecord:n,drawDefinition:a,matchUpId:o,event:s});if(U.error)return U}}}return{...Q}}function Mte(t){let e=We(t,[{[$n]:!0,[ed]:!0},{[og]:{[aw]:!1,roundNumbers:!1},[aX]:"At least one must be provided",[Jn]:cn}]);if(e.error)return e;let i=OQ(t);if(i.error)return i;let{matchUpIds:r}=i,n=Xi(Ea)(t.event.eventType),{tournamentRecord:a,drawDefinition:o,event:s}=t;for(let l of r){if(n){let c=L$({tiebreakReset:!0,tournamentRecord:a,drawDefinition:o,matchUpId:l,event:s});if(c.error||t.removeAssignments&&x$({inheritance:!1,drawDefinition:o,matchUpId:l}).error)return c}let u=eU({winningSide:void 0,removeScore:!0,tournamentRecord:a,drawDefinition:o,matchUpId:l,event:s});if(u.error)return u;if(t.removeAssignments){let c=E$({...t,matchUpId:l});if(c.error)return c}}return{...Q}}function a1e({tournamentRecord:t,drawDefinition:e,finishingOrder:i}){var r;if(!e)return{error:$e};let n="setOrderOfFinish";if(!Array.isArray(i))return te({info:ip("finishingOrder"),result:{error:se},stack:n});let{completedMatchUps:a,matchUpsMap:o}=wv({inContext:!0,drawDefinition:e}),s=(a==null?void 0:a.map(Pr))??[],l=i.map(Pr),{matchUpTypes:u,roundNumbers:c,structureIds:d,matchUpTieIds:p}=(a??[]).filter(({matchUpId:I})=>l.includes(I)).reduce((I,b)=>{let{matchUpTieId:S,matchUpType:w,roundNumber:U,structureId:T}=b;return I.matchUpTypes.includes(w)||I.matchUpTypes.push(w),I.roundNumbers.includes(U)||I.roundNumbers.push(U),I.structureIds.includes(T)||I.structureIds.push(T),I.matchUpTieIds.includes(S)||I.matchUpTieIds.push(S),I},{matchUpTypes:[],roundNumbers:[],structureIds:[],matchUpTieIds:[]});if(u.length>1||p.length>1||c.length>1||d.length>1)return te({info:"matchUpType, structureId and roundNumber must be equivalent",result:{error:se},stack:n});let m,h,f={},g=[],v=[];if(!i.every(({orderOfFinish:I,matchUpId:b})=>(g.push(b),I&&v.push(I),f[b]=I,m=s.includes(b),h=I===void 0||st(I)&&Math.floor(I)>0,m&&h)))return te({result:{error:m?se:sv},info:!m&&"matchUps must be completed"||!h&&"orderOfFinish must be integer > 0 or undefined"||void 0,stack:n});let y=a==null?void 0:a.filter(I=>I.structureId===d[0]&&I.roundNumber===c[0]&&I.matchUpType===u[0]&&I.matchUpTieId===p[0]&&!g.includes(I.matchUpId));for(let I of y??[]){let{orderOfFinish:b}=I||{};if(b){if(!st(b))return te({context:{orderOfFinish:b,matchUp:I},result:{error:se},stack:n});v.push(b)}}if(EK(v).length!==v.length||Math.max(...v)>v.length)return te({info:"Values not unique or greater than expected number of values",result:{error:se},stack:n});if(d.length){let I=ZP({matchUpFilters:{matchUpIds:l},structureId:d[0],drawDefinition:e,matchUpsMap:o});if(I.error)return te({result:I,stack:n});(r=I.completedMatchUps)==null||r.forEach(b=>{b.orderOfFinish=f[b.matchUpId],Et({tournamentId:t.tournamentId,context:"setOrderOfFinish",drawDefinition:e,matchUp:b})})}return{...Q}}function Nte(t){return a1e(t)}function Ate(t){var e,i,r,n;let{tournamentRecord:a,drawDefinition:o,matchUpId:s,lineUps:l,event:u}=t,c="applyLineUps",d=We(t,[{[Ur]:!0,[$n]:!0,[Il]:!0},{lineUps:!0,[Jn]:cn}],c);if(d.error)return d;let p=a.participants||[],m=Si({tournamentParticipants:p,inContext:!0,drawDefinition:o,matchUpId:s});if(m.error)return m;if(!m.matchUp)return{error:hn};let{matchUp:h,structure:f}=m,{drawPositions:g,matchUpType:v}=h;if(v!==fi)return{error:la};if(!(g!=null&&g.length))return{error:qb};let y=(e=In({matchUp:h,drawDefinition:o,structure:f,event:u}))==null?void 0:e.tieFormat,I={};for(let S of l){if(!Array.isArray(S))return{error:se,lineUp:S};let w={},U=[];for(let R of S){if(typeof R!="object")return{error:se,lineUpAssignment:R};let{participantId:N,collectionAssignments:A=[]}=R;if(!Array.isArray(A))return{error:se,collectionAssignments:A};let M=p.find(O=>O.participantId===N);if(!M)return{error:Wi};if(M.participantType!==Dt)return{error:Ns};let C=(r=(i=h.sides)==null?void 0:i.find(O=>{var k,x;return(x=(k=O.participant)==null?void 0:k.individualParticipantIds)==null?void 0:x.includes(N)}))==null?void 0:r.sideNumber;C&&U.push(C);for(let O of A){if(typeof O!="object")return{error:se,collectionAssignment:O};let{collectionId:k,collectionPosition:x}=O,F=(n=y==null?void 0:y.collectionDefinitions)==null?void 0:n.find(L=>L.collectionId===k);if(!F)return{error:se,collectionId:k};let $=`${k}-${x}`;w[$]||(w[$]=[]);let _=w[$].length;if(Xi(ii)(F.matchUpType)&&_||F.matchUpType===ei&&_>1)return{info:"Excessive collectionPosition assignments",error:se};w[$].push(N)}}let T=Object.values(w);for(let R of T)if(R.length===2){let{participant:N}=as({tournamentParticipants:p,participantIds:R});if(!N){let A=pl({participant:{participantType:ft,participantRole:en,individualParticipantIds:R},pairOverride:!0,tournamentRecord:a});if(A.error)return A}}let D=Pa(U),P=(D[1]||0)>(D[2]||0)&&1||(D[2]||0)>(D[1]||0)&&2||void 0,E=Object.keys(I).map(R=>parseInt(R));P&&!E.includes(P)&&(I[P]=S)}if(!Object.keys(I).length)return{error:mF};if(m=Si({drawDefinition:o,matchUpId:s}),m.error)return m;if(!m.matchUp)return{error:hn};let{matchUp:b}=m;b.sides||(b.sides=[]);for(let S of[1,2]){let w=b.sides.find(T=>T.sideNumber===S),U=I[S];if(U)w?w.lineUp=U:b.sides.push({lineUp:U,sideNumber:S});else continue}return Et({tournamentId:a==null?void 0:a.tournamentId,context:c,drawDefinition:o,matchUp:b}),{...Q}}var _$={};bt(_$,{anonymizeTournamentRecord:()=>eie,generate:()=>Ote,generateEventWithDraw:()=>iE,generateOutcome:()=>W$,generateOutcomeFromScoreString:()=>$$,generateParticipants:()=>Fv,generateTournamentRecord:()=>Qte,modifyTournamentRecord:()=>tie,mutate:()=>Zte});var Ote={};bt(Ote,{generateEventWithDraw:()=>iE,generateOutcome:()=>W$,generateOutcomeFromScoreString:()=>$$,generateParticipants:()=>Fv,generateTournamentRecord:()=>Qte});function $$(t){let{matchUpFormat:e,matchUpStatus:i,winningSide:r,scoreString:n}=t;if(!n)return{outcome:{...uR,winningSide:r,matchUpStatus:i}};if(r&&![1,2,void 0].includes(r))return{error:se,winningSide:r};let a=n&&U0({scoreString:n}),o={},s=_l({sets:a,matchUpFormat:e}),l=_l({sets:a,reversed:!0,matchUpFormat:e});return r===2?(o.scoreStringSide1=l,o.scoreStringSide2=s):(o.scoreStringSide1=s,o.scoreStringSide2=l),o.sets=U0({scoreString:o.scoreStringSide1}),He({outcome:{matchUpStatus:i,winningSide:r,score:o}})}function B$({matchUpScheduleTimes:t,matchUpDependencies:e,allDateMatchUpIds:i,matchUp:r}){var n;let a=(((n=e==null?void 0:e[r.matchUpId])==null?void 0:n.matchUpIds)||[]).filter(o=>i.includes(o)).filter(o=>!t[o]);return{dependenciesScheduled:!(a!=null&&a.length),remainingDependencies:a}}function iU({individualParticipantProfiles:t,participantId:e}){t[e]||(t[e]={typeChangeTimeAfterRecovery:void 0,timeAfterRecovery:void 0,priorMatchUpType:void 0,potentialRecovery:{},potentialCounted:{},potentialBookings:{},bookings:[],counters:{}})}function o1e({individualParticipantProfiles:t,recoveryValue:e,participantId:i,scheduleTime:r,drawId:n}){t[i].potentialRecovery[n]||(t[i].potentialRecovery[n]=[]),t[i].potentialRecovery[n].push(e),t[i].potentialBookings[n]||(t[i].potentialBookings[n]=[]),t[i].potentialBookings[n].push({timeAfterRecovery:e,scheduleTime:r})}function by({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,typeChangeRecoveryMinutes:i,averageMatchUpMinutes:r=0,matchUpNotBeforeTimes:n,matchUpDependencies:a,recoveryMinutes:o=0,scheduleTime:s,matchUp:l}){var u,c;let d=Ui((u=l==null?void 0:l.schedule)==null?void 0:u.endTime),p=d?ra(d,Ze(o)):ra(s,Ze(r)+Ze(o)),m=i&&(d?ra(Ui(d),i):ra(s,Ze(r)+Ze(i))),h=((c=a==null?void 0:a[l.matchUpId])==null?void 0:c.participantIds)||[],f=(l.roundPosition&&t[l.matchUpId]||[]).flat();h.forEach(g=>{iU({individualParticipantProfiles:e,participantId:g});let v=e[g].priorMatchUpType!==l.matchUpType&&m||p;f.includes(g)?o1e({individualParticipantProfiles:e,drawId:l.drawId,recoveryValue:v,participantId:g,scheduleTime:s}):(e[g].timeAfterRecovery=v,e[g].bookings.push({scheduleTime:s,timeAfterRecovery:v}))}),gg({matchUpPotentialParticipantIds:t,matchUpNotBeforeTimes:n,timeAfterRecovery:p,matchUp:l})}function kte({matchUpScheduleTimes:t,matchUpDependencies:e,scheduleTime:i,matchUpId:r,details:n}){var a,o,s,l,u;let c,d=(o=(a=n.minutesMap)==null?void 0:a[r])==null?void 0:o.recoveryMinutes,p=(((l=(s=n.minutesMap)==null?void 0:s[r])==null?void 0:l.averageMinutes)||0)+(d||0),m=ra(i,p),h=((u=e==null?void 0:e[r])==null?void 0:u.dependentMatchUpIds)||[];if(h.length){let f=h.reduce((g,v)=>{let y=t[v];if(!y)return g;let I={scheduleTime:y,matchUpId:v};return y&&!g.matchUpId||xt(y)<xt(g.scheduleTime)?I:g},{});f.scheduleTime&&xt(m)>xt(f.scheduleTime)&&(c=f)}return{scheduledDependent:c}}function s1e(t){let{sides:e,matchUpType:i}=t||{};return(e||[]).map(r=>{var n;return i===ei&&(((n=r==null?void 0:r.participant)==null?void 0:n.individualParticipants)||[])||(r==null?void 0:r.participant)&&[r.participant]||[]}).flat()}var rU="DO_NOT_SCHEDULE",l1e={DO_NOT_SCHEDULE:rU};function V$({averageMatchUpMinutes:t=90,requestConflicts:e={},potentials:i=!0,personRequests:r,scheduleTime:n,scheduleDate:a,matchUp:o}){let s=s1e(o).map(({person:m})=>m==null?void 0:m.personId);if(i){let m=((o==null?void 0:o.potentialParticipants)||[]).flat().map(({person:h})=>h==null?void 0:h.personId);s.push(...m)}let l=s.map(m=>{var h;return(h=r[m])==null?void 0:h.map(f=>({...f,personId:m}))}).filter(Boolean).flat().filter(m=>m.requestType===rU&&ql(a,m.date)),u=[],c=o==null?void 0:o.matchUpId,d=rr(Ui(n),mt(a)),p=Ui(PF(d,t).toISOString());for(let m of l){let{requestId:h,startTime:f,endTime:g}=m;(n>f&&n<g||p>f&&p<g)&&(u.push({matchUpId:c,request:m,scheduleTime:n}),e[h]?(e[h].scheduleTimes.includes(n)||e[h].scheduleTimes.push(n),e[h].matchUpIds.includes(c)||e[h].matchUpIds.push(c)):e[h]={request:m,scheduleTimes:[n],matchUpIds:[c]})}return{conflicts:u}}function QM({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,matchUp:i,value:r}){let{matchUpType:n}=i,{individualParticipantIds:a}=HP(i),o=(t[i.matchUpId]||[]).filter(s=>!Nn(s,a)).flat();[...a,...o].forEach(s=>{if(iU({individualParticipantProfiles:e,participantId:s}),!e[s].potentialCounted[i.drawId]){let l=e[s].counters;l[n]?l[n]+=r:r>0&&(l[n]=r),l[Yo]?l[Yo]+=r:r>0&&(l[Yo]=r),o.includes(s)&&(e[s].potentialCounted[i.drawId]=!0)}})}function u1e({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,dateScheduledMatchUpIds:i,greatestAverageMinutes:r,dateScheduledMatchUps:n,matchUpNotBeforeTimes:a,matchUpScheduleTimes:o,matchUpDependencies:s,clearScheduleDates:l,scheduleDate:u,minutesMap:c,matchUps:d}){var p,m;let h=[];i||(n=d==null?void 0:d.filter(v=>{let y=v.schedule||{},I=v.matchUpStatus===jt;return I&&h.push({tournamentId:v.tournamentId,matchUpId:v.matchUpId}),!I&&Kw({schedule:y})&&(!u||v.schedule.scheduledDate===u)}),i=n.map(Pr));let f=Array.isArray(l)?l.includes(u):l,g=f?[]:d.filter(({matchUpId:v})=>i.includes(v));for(let v of g){QM({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,value:1,matchUp:v});let y=(p=v.schedule)==null?void 0:p.scheduledTime;if(y){o[v.matchUpId]=y;let I=(m=c==null?void 0:c[v.matchUpId])==null?void 0:m.recoveryMinutes;by({individualParticipantProfiles:e,matchUpPotentialParticipantIds:t,matchUpNotBeforeTimes:a,matchUpDependencies:s,averageMatchUpMinutes:r,recoveryMinutes:I,scheduleTime:y,matchUp:v})}}return{dateScheduledMatchUpIds:i,byeScheduledMatchUpDetails:h,dateScheduledMatchUps:n,clearDate:f}}function QR({defaultRecoveryMinutes:t=0,averageMatchUpMinutes:e=90,dateScheduledMatchUps:i,tournamentRecords:r,venueIds:n=[],periodLength:a,scheduleDate:o,matchUps:s}){if(typeof r!="object")return{error:xi};if(!Ro(s)&&!Array.isArray(i))return{error:Ju};a=a??zR({recoveryMinutes:t,averageMatchUpMinutes:e});let l=Object.assign({},...Object.values(r).map(d=>(d.events??[]).map(p=>{let{scheduleTiming:m}=pw({tournamentRecord:d,event:p});return{[p.eventId]:{event:p,scheduleTiming:m}}})).flat()),u={averageTimes:[{minutes:{default:e}}],recoveryTimes:[{minutes:{default:t}}]};i||(i=s==null?void 0:s.filter(d=>{let p=d.schedule;return Kw({schedule:p})&&(!o||d.schedule.scheduledDate===o)}));let c=i==null?void 0:i.filter(d=>(!n.length||n.includes(d.schedule.venueId))&&d.matchUpStatus!==jt);return{bookings:c==null?void 0:c.map(({eventId:d,schedule:p,matchUpFormat:m})=>{let{event:h,scheduleTiming:f}=l[d],g=h==null?void 0:h.eventType,v={...f,defaultTiming:u,matchUpFormat:m},{averageMinutes:y,recoveryMinutes:I}=KP({timingDetails:v,eventType:g}),{courtId:b,venueId:S}=p,w=Ui(p.scheduledTime),U=ra(w,y);return{recoveryMinutes:I,averageMinutes:y,periodLength:a,startTime:w,courtId:b,endTime:U,venueId:S}}).filter(Boolean),relevantMatchUps:c,dateScheduledMatchUps:i}}function c1e({calculateStartTimeFromCourts:t=!0,remainingScheduleTimes:e,defaultRecoveryMinutes:i,averageMatchUpMinutes:r,clearScheduleDates:n,tournamentRecords:a,tournamentRecord:o,periodLength:s,scheduleDate:l,startTime:u,venueIds:c,matchUps:d,endTime:p}){if(o&&!a&&(a={[o.tournamentId]:o}),typeof a!="object"||!Object.keys(a).length)return{error:xi};s=s??zR({recoveryMinutes:i,averageMatchUpMinutes:r});let{courts:m,venues:h}=rc({dates:[l],ignoreDisabled:!0,tournamentRecords:a}),f=(m==null?void 0:m.filter(S=>!c||c.includes(S.venueId)))??[];u=u??vg({courts:f,scheduleDate:l,startTime:!0}),p=p??vg({courts:f,scheduleDate:l,endTime:!0});let{bookings:g,dateScheduledMatchUps:v}=QR({defaultRecoveryMinutes:i,averageMatchUpMinutes:r,tournamentRecords:a,scheduleDate:l,periodLength:s,venueIds:c,matchUps:d}),y={calculateStartTimeFromCourts:t,remainingScheduleTimes:e,averageMatchUpMinutes:r,clearScheduleDates:n,date:l,periodLength:s,startTime:u,bookings:g,endTime:p,courts:f},{scheduleTimes:I}=S$(y),b=(c==null?void 0:c.length)===1&&c[0]||(h==null?void 0:h.length)===1&&h[0].venueId||void 0;return{dateScheduledMatchUpIds:v==null?void 0:v.map(Ma("matchUpId")),dateScheduledMatchUps:v,scheduleTimes:I,venueId:b}}function d1e({scheduledRoundsDetails:t,greatestAverageMinutes:e,garmanSinglePass:i}){let r=[],n=[],a,o,s,l;for(let u of t.filter(Boolean))l||(l=u.hash),(u.hash===l||i)&&(n=n.concat(u.matchUpIds)),u.hash!==l&&!i&&(l=u.hash,r.push({averageMinutes:s,recoveryMinutes:o,roundPeriodLength:a,matchUpIds:n}),n=u.matchUpIds),s=i?e:u.averageMinutes,o=u.recoveryMinutes,a=u.roundPeriodLength;return n.length&&r.push({matchUpIds:n,roundPeriodLength:a,recoveryMinutes:o,averageMinutes:s}),{groupedRounds:r}}function xte({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,scheduleCompletedMatchUps:i,containedStructureIds:r,matchUpNotBeforeTimes:n,matchUpScheduleTimes:a,matchUpDependencies:o,clearScheduleDates:s,tournamentRecords:l,periodLength:u,scheduleDate:c,useGarman:d,matchUps:p,courts:m,venues:h}){var f;let g={},v=[],y=[],I=[];for(let b of h){let{rounds:S=[],venueId:w}=b,{scheduledRoundsDetails:U,greatestAverageMinutes:T,orderedMatchUpIds:D,minutesMap:P}=qw({scheduleCompletedMatchUps:i,containedStructureIds:r,tournamentRecords:l,periodLength:u,matchUps:p,rounds:S});I.push(...D??[]);let{groupedRounds:E}=d1e({scheduledRoundsDetails:U,greatestAverageMinutes:T,garmanSinglePass:!0}),R,N=[];d&&({scheduleTimes:N,dateScheduledMatchUpIds:R}=c1e({averageMatchUpMinutes:(f=E[0])==null?void 0:f.averageMinutes,scheduleDate:mt(c),venueIds:[b.venueId],clearScheduleDates:s,tournamentRecords:l,periodLength:u,matchUps:p}));let A=u1e({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,dateScheduledMatchUpIds:R,greatestAverageMinutes:T,matchUpNotBeforeTimes:n,matchUpScheduleTimes:a,matchUpDependencies:o,clearScheduleDates:s,scheduleDate:c,minutesMap:P,matchUps:p});({dateScheduledMatchUpIds:R}=A);let M=A,{byeScheduledMatchUpDetails:C,clearDate:O}=A;C!=null&&C.length&&y.push(...C);let{matchUpsToSchedule:k,matchUpMap:x}=MR({matchUpPotentialParticipantIds:t,scheduleCompletedMatchUps:i,dateScheduledMatchUpIds:R,matchUpNotBeforeTimes:n,matchUpScheduleTimes:a,orderedMatchUpIds:D,clearDate:O,matchUps:p}),F=m.filter($=>$.venueId===w);g[w]={previousRemainingScheduleTimes:[],courtsCount:F.length,greatestAverageMinutes:T,scheduledRoundsDetails:U,dateScheduledMatchUps:M,matchUpsToSchedule:k,scheduleTimes:N,groupedRounds:E,venueCourts:F,minutesMap:P,matchUpMap:x},s||v.push(...R)}return{allDateScheduledByeMatchUpDetails:y,allDateScheduledMatchUpIds:v,venueScheduledRoundDetails:g,allDateMatchUpIds:I}}function p1e(t,e){let i=xt(t.scheduleTime),r=xt(t.timeAfterRecovery),n=xt(e.scheduleTime),a=xt(e.timeAfterRecovery),o=i===n||r===a,s=i>n&&i<a,l=n>i&&n<r,u=r>n&&r<a,c=a>i&&a<r;return He({hasOverlap:o||s||u||l||c,startAisContained:s,endAisContained:u,startBisContained:l,endBisContained:c},!0)}function j$({individualParticipantProfiles:t,matchUpNotBeforeTimes:e,matchUpDependencies:i,scheduleTime:r,matchUp:n,details:a}){var o,s,l,u,c;let d=(((o=i==null?void 0:i[n.matchUpId])==null?void 0:o.participantIds)||[]).flat(),p=((l=(s=a==null?void 0:a.minutesMap)==null?void 0:s[n.matchUpId])==null?void 0:l.averageMinutes)||0,m=((c=(u=a==null?void 0:a.minutesMap)==null?void 0:u[n.matchUpId])==null?void 0:c.recoveryMinutes)||0,h=d.every(v=>{var y;iU({individualParticipantProfiles:t,participantId:v});let I=t[v];if(!I.timeAfterRecovery)return!0;let b=Ui((y=n==null?void 0:n.schedule)==null?void 0:y.endTime),S=b?ra(b,Ze(m)):ra(r,Ze(p)+Ze(m));return![...Object.keys(I.potentialBookings).filter(w=>w!==n.drawId).map(w=>I.potentialBookings[w]).flat(),...I.bookings].find(w=>p1e({scheduleTime:r,timeAfterRecovery:S},w).hasOverlap)}),f=e[n.matchUpId],g=(f?Zb(rr(f),rr(r),!1):0)>=0;return{enoughTime:h&&g}}function Fte({autoSchedulingAudit:t,tournamentRecords:e}){var i;ut({topic:vu,payload:t});let r=s=>s?Object.values(s).reduce((l,u)=>l+u.length||0,0):0,n=((t==null?void 0:t.schedulingProfile)||[]).reduce((s,l)=>s+l.venues.reduce((u,c)=>u+c.rounds.length,0),0),a={scheduledDatesCount:(i=t.scheduledDates)==null?void 0:i.length,noTimeMatchUpIdsCount:r(t==null?void 0:t.noTimeMatchUpIds),scheduledMatchUpIdsCount:r(t==null?void 0:t.scheduledMatchUpIds),overLimitMatchUpIdsCount:r(t==null?void 0:t.overLimitMatchUpIds),requestConflictsCount:r(t==null?void 0:t.requestConflicts),profileRoundsCount:n},o={itemType:YM,itemValue:a};for(let s of Object.values(e)){let l=s.tournamentId;yP(vu)?ut({payload:{type:YM,tournamentId:l,detail:a},topic:vu}):Vw({tournamentRecord:s,timeItem:o})}}function G$({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,matchUpDailyLimits:i={},matchUp:r}){let{enteredIndividualParticipantIds:n}=HP(r),{matchUpId:a,matchUpType:o}=r,s=(r.roundPosition&&t[a]||[]).flat(),l=dt(n.concat(...s));return l.forEach(u=>{iU({individualParticipantProfiles:e,participantId:u})}),{participantIdsAtLimit:l.filter(u=>{let c=e[u];if(c)return[o,Yo].find(d=>{var p;let m=((p=c.counters)==null?void 0:p[d])||0,h=i[d]||0;return m&&h&&m>=h})}),relevantParticipantIds:l}}function wy({scheduleCompletedMatchUps:t=!1,scheduleByeMatchUps:e=!1,errorOnAnachronism:i=!1,checkChronology:r=!0,matchUpDependencies:n,removePriorValues:a,tournamentRecords:o,tournamentRecord:s,matchUpDetails:l,matchUpIds:u,schedule:c}){var d,p,m;if(!s)return{error:ve};if(!l&&(!u||!Array.isArray(u)))return{error:gh};if(!l&&(!c||typeof c!="object"))return{error:N9};let h,f=[],g=0;if(r&&!n){let I=ps({tournamentRecords:o,tournamentRecord:s});n=I.matchUpDependencies,h=I.matchUps}h||(h=((d=Hr({tournamentRecord:s}))==null?void 0:d.matchUps)??[]);let v=h.reduce((I,b)=>{let{matchUpId:S,drawId:w,matchUpStatus:U}=b;return(e||U!==jt)&&(t||!yr.includes(U))&&(I[w]?I[w].push(S):I[w]=[S]),I},{}),y=l==null?void 0:l.map(I=>I.matchUpId);for(let I of Object.keys(v)){let{drawDefinition:b}=sd({tournamentRecord:s,drawId:I});if(!b)continue;let S=v[I].filter(U=>(u==null?void 0:u.includes(U))??(y==null?void 0:y.includes(U))),w=Pn({inContext:!1,drawDefinition:b}).matchUps;for(let U of S){let T=((p=l==null?void 0:l.find(P=>P.matchUpId===U))==null?void 0:p.schedule)||c,D=JR({schedule:T,matchUpDependencies:n,errorOnAnachronism:i,removePriorValues:a,inContextMatchUps:h,tournamentRecords:o,tournamentRecord:s,checkChronology:r,drawDefinition:b,drawMatchUps:w,matchUpId:U});if((m=D==null?void 0:D.warnings)!=null&&m.length&&f.push(...D.warnings),D!=null&&D.success&&(g+=1),D.error)return D}}return f.length?{...Q,scheduled:g,warnings:f}:{...Q,scheduled:g}}function nU(t){var e;let{scheduleCompletedMatchUps:i=!1,scheduleByeMatchUps:r=!1,errorOnAnachronism:n,matchUpContextIds:a,removePriorValues:o,tournamentRecords:s,checkChronology:l,matchUpDetails:u,schedule:c}=t;if(t.matchUpIds&&!a)return wy(t);let d=We(t,[{[fn]:!0},{[og]:{matchUpContextIds:!1,matchUpDetails:!1},[Ha]:se,[Jn]:cn}]);if(d.error)return d;if((!u||a)&&!c)return{error:Je,info:"schedule is required"};let p=[],m=0,{matchUpDependencies:h}=ps({tournamentRecords:s});for(let f of Object.values(s)){let{tournamentId:g}=f,v=a==null?void 0:a.filter(I=>I.tournamentId===g).map(Pr),y=u==null?void 0:u.filter(I=>(I==null?void 0:I.tournamentId)===g);if(v!=null&&v.length||y!=null&&y.length){let I=wy({matchUpDetails:y,scheduleCompletedMatchUps:i,scheduleByeMatchUps:r,matchUpDependencies:h,errorOnAnachronism:n,removePriorValues:o,tournamentRecords:s,tournamentRecord:f,checkChronology:l,matchUpIds:v,schedule:c});if((e=I.warnings)!=null&&e.length&&p.push(...I.warnings),I.scheduled&&(m+=I.scheduled),I.error)return I}}return p.length?{...Q,scheduled:m,warnings:p}:{...Q,scheduled:m}}function m1e({schedulingProfileModifications:t,checkPotentialRequestConflicts:e,scheduleCompletedMatchUps:i,schedulingProfileIssues:r,dateSchedulingProfiles:n,containedStructureIds:a,matchUpDependencies:o,matchUpDailyLimits:s,clearScheduleDates:l,tournamentRecords:u,schedulingProfile:c,personRequests:d,periodLength:p,matchUps:m,courts:h,dryRun:f}){var g,v,y,I,b,S,w;let U={},T={},D={},P={},E={},R={},N={},A={},M={},C={};for(let x of n){let F=mt(x==null?void 0:x.scheduleDate),$=(x==null?void 0:x.venues)||[],_={},L={},B=(K,H)=>{K.forEach(Z=>{let X=L[Z].counters;X[H]?X[H]+=1:X[H]=1,X[Yo]?X[Yo]+=1:X[Yo]=1})};D[F]={},P[F]={},U[F]={},T[F]={},N[F]=[],A[F]=[],M[F]=[],C[F]=[];let V={};m.forEach(K=>{var H;(H=K.schedule)!=null&&H.scheduledDate&&ql(F,mt(K.schedule.scheduledDate))&&gg({matchUpPotentialParticipantIds:_,matchUpNotBeforeTimes:V,matchUp:K})});let{allDateScheduledByeMatchUpDetails:G,venueScheduledRoundDetails:j,allDateMatchUpIds:z}=xte({matchUpPotentialParticipantIds:_,individualParticipantProfiles:L,scheduleCompletedMatchUps:i,containedStructureIds:a,matchUpNotBeforeTimes:V,matchUpScheduleTimes:R,matchUpDependencies:o,clearScheduleDates:l,tournamentRecords:u,useGarman:!0,periodLength:p,scheduleDate:F,matchUps:m,courts:h,venues:$}),W=10,q=0,Y,re=10;for(;!Y;){for(let{venueId:K}of $){let H=0,Z=j[K];for(;Z.courtsCount&&(g=Z.scheduleTimes)!=null&&g.length&&(v=Z.matchUpsToSchedule)!=null&&v.length&&H<=Z.courtsCount;){let{scheduleTime:X,attempts:ie=0}=Z.scheduleTimes.shift(),ae=Z.matchUpsToSchedule.find(le=>{var ne,de;let{matchUpId:ye,matchUpType:ce}=le,{participantIdsAtLimit:ke,relevantParticipantIds:Pe}=G$({matchUpPotentialParticipantIds:_,individualParticipantProfiles:L,matchUpDailyLimits:s,matchUp:le});if(ke.length)return A[F].includes(ye)||A[F].push(ye),!1;let{scheduledDependent:it}=kte({matchUpScheduleTimes:R,matchUpDependencies:o,scheduleTime:X,matchUpId:ye,details:Z});if(it)return!1;let{dependenciesScheduled:It,remainingDependencies:me}=B$({matchUpScheduleTimes:R,matchUpDependencies:o,allDateMatchUpIds:z,matchUp:le});if(!It)return P[F][ye]||(P[F][ye]=[]),P[F][ye].push({scheduleTime:X,remainingDependencies:me}),!1;let{enoughTime:fe}=j$({individualParticipantProfiles:L,matchUpNotBeforeTimes:V,matchUpDependencies:o,scheduleTime:X,details:Z,matchUp:le});if(!fe)return D[F][ye]||(D[F][ye]=[]),D[F][ye].push({scheduleTime:X}),!1;let pe=Z.greatestAverageMinutes,{conflicts:Fe}=V$({potentials:e,averageMatchUpMinutes:pe,requestConflicts:C,personRequests:d,scheduleTime:X,scheduleDate:F,matchUp:le});if(Fe!=null&&Fe.length)return E[F]||(E[F]=[]),E[F].push(...Fe),!1;B(Pe,ce);let De=(de=(ne=Z.minutesMap)==null?void 0:ne[ye])==null?void 0:de.recoveryMinutes;return by({matchUpPotentialParticipantIds:_,individualParticipantProfiles:L,matchUpNotBeforeTimes:V,averageMatchUpMinutes:pe,matchUpDependencies:o,recoveryMinutes:De,scheduleTime:X,matchUp:le}),R[ye]=X,!0});Z.matchUpsToSchedule=Z.matchUpsToSchedule.filter(({matchUpId:le})=>le!==(ae==null?void 0:ae.matchUpId)),ae?H+=1:(T[F][K]||(T[F][K]=[]),T[F][K].push({scheduleTime:X,attempts:ie+1}))}(y=Z.matchUpsToSchedule)!=null&&y.length&&(T[F][K]=(I=T[F][K])==null?void 0:I.filter(X=>{let ie=X.attempts<W;return ie&&Z.scheduleTimes.push(X),!ie})),(!((b=Z.scheduleTimes)!=null&&b.length)||!((S=Z.matchUpsToSchedule)!=null&&S.length))&&(Z.complete=!0)}q+=1,Y=$.every(({venueId:K})=>j[K].complete)||q===re}for(let{venueId:K}of $){let H=j[K].matchUpMap;Object.keys(H).forEach(Z=>{let X=u[Z];X&&Object.keys(H[Z]).forEach(ie=>{let{drawDefinition:ae}=sd({tournamentRecord:X,drawId:ie});ae&&H[Z][ie].forEach(({matchUpId:le})=>{let ne=R[le];if(ne){let de=ne.split(":").map(oo).join(":"),ye=`${mt(F)}T${de}`;f?N[F].push(le):(ld({drawDefinition:ae,scheduledTime:ye,matchUpId:le}).success&&N[F].push(le),K&&xv({tournamentRecord:X,drawDefinition:ae,matchUpId:le,venueId:K}))}})})}),M[F]=j[K].matchUpsToSchedule.map(Pr),U[F][K]=j[K].scheduleTimes.sort((Z,X)=>xt(Z.scheduleTime)-xt(X.scheduleTime))}!f&&G!=null&&G.length&&nU({matchUpDetails:G,scheduleByeMatchUps:!0,removePriorValues:!0,tournamentRecords:u,schedule:{scheduledDate:"",scheduledTime:"",courtOrder:"",courtId:"",venueId:""}});for(let K of x.venues)for(let H of K.rounds){let Z=(((w=H.matchUps)==null?void 0:w.map(({matchUpId:ie})=>ie))||[]).filter(ie=>N[F].includes(ie));H.canScheduledMatchUpIds=Z;let X=Math.round(Z.length/H.matchUpsCount*1e4)/100;(X===1/0||isNaN(X))&&(X=0),H.possibleToSchedulePct=X,H.matchUpsCount===Z.length&&(H.possibleToSchedule=!0)}}let O=n.map(({scheduleDate:x})=>x),k={timeStamp:Date.now(),overLimitMatchUpIds:A,scheduledMatchUpIds:N,schedulingProfile:c,noTimeMatchUpIds:M,requestConflicts:C,scheduledDates:O};return Fte({tournamentRecords:u,autoSchedulingAudit:k}),{...Q,schedulingProfileModifications:t,schedulingProfileIssues:r,scheduleTimesRemaining:U,dateSchedulingProfiles:n,skippedScheduleTimes:T,recoveryTimeDeferredMatchUpIds:D,dependencyDeferredMatchUpIds:P,matchUpScheduleTimes:R,overLimitMatchUpIds:A,scheduledMatchUpIds:N,noTimeMatchUpIds:M,requestConflicts:C,scheduledDates:O}}function uj({averageMinutes:t,startTime:e,endTime:i,court:r,date:n}){if(!Array.isArray(r.dateAvailability))return{error:Je,stack:"getEarliestCourtTime"};let a=vg({scheduleDate:n,courts:[r],startTime:!0}),o=vg({scheduleDate:n,courts:[r],endTime:!0});e=e||a,i=i||o;let s=Zw({court:r,date:n}),{timeSlots:l}=Ov({courtDate:s}),u=rr(e),c=rr(i);return{earliestCourtTime:l==null?void 0:l.reduce((d,p)=>{let m=rr(p.startTime),h=rr(p.endTime);if(m>c||h<u)return d;let f=u>m?u:m;if(Zb(f,h)>=t){let g=Ui(f.toISOString());(!d||g<d)&&(d=g)}return d},void 0),courtStartTime:a,courtEndTime:o}}function h1e({schedulingProfileModifications:t,checkPotentialRequestConflicts:e,scheduleCompletedMatchUps:i,schedulingProfileIssues:r,dateSchedulingProfiles:n,containedStructureIds:a,matchUpDependencies:o,matchUpDailyLimits:s,clearScheduleDates:l,tournamentRecords:u,periodLength:c=30,schedulingProfile:d,personRequests:p,matchUps:m=[],courts:h,dryRun:f}){var g,v;let y={},I={},b={},S={},w={},U={},T={},D={},P={};for(let N of n??[]){let A=mt(N==null?void 0:N.scheduleDate),M=(N==null?void 0:N.venues)||[],C={},O={},k=(K,H)=>{K.forEach(Z=>{let X=O[Z].counters;X[H]?X[H]+=1:X[H]=1,X[Yo]?X[Yo]+=1:X[Yo]=1})};y[A]={},I[A]={},U[A]=[],T[A]=[],D[A]=[],P[A]=[];let x={};m==null||m.forEach(K=>{var H;(H=K.schedule)!=null&&H.scheduledDate&&ql(A,mt(K.schedule.scheduledDate))&&gg({matchUpPotentialParticipantIds:C,matchUpNotBeforeTimes:x,matchUp:K})});let{allDateScheduledByeMatchUpDetails:F,allDateScheduledMatchUpIds:$,venueScheduledRoundDetails:_,allDateMatchUpIds:L}=xte({matchUpPotentialParticipantIds:C,individualParticipantProfiles:O,scheduleCompletedMatchUps:i,containedStructureIds:a,matchUpNotBeforeTimes:x,matchUpScheduleTimes:w,matchUpDependencies:o,clearScheduleDates:l,tournamentRecords:u,periodLength:c,scheduleDate:A,matchUps:m,courts:h,venues:M}),B=m==null?void 0:m.filter(({matchUpId:K})=>$.includes(K)),{bookings:V}=QR({dateScheduledMatchUps:B,tournamentRecords:u,scheduleDate:A,periodLength:c}),{virtualCourts:G}=HR({scheduleDate:A,periodLength:c,bookings:V,courts:h}),j=G==null?void 0:G.reduce((K,H)=>{let{earliestCourtTime:Z,courtEndTime:X}=uj({date:A,averageMinutes:0,court:H});return(!K.startTime||rr(Z)<rr(K.startTime))&&(K.startTime=Z),(!K.endTime||rr(X)>rr(K.endTime))&&(K.endTime=X),K},{}),z=j.startTime,W=({courtId:K,booking:H})=>{var Z;return(Z=G==null?void 0:G.find(X=>X.courtId===K))==null?void 0:Z.dateAvailability[0].bookings.push(H)},q=10,Y=0,re;for(;!re;){for(let{venueId:K}of M){let H=_[K],Z=H.matchUpsToSchedule.length,X=[],ie=[],ae,le=0;for(;!ae;){for(let ne of H.matchUpsToSchedule){if(ie.length===H.courtsCount||X.length===H.courtsCount){ae=!0;break}let{matchUpId:de,matchUpType:ye}=ne,{participantIdsAtLimit:ce,relevantParticipantIds:ke}=G$({matchUpPotentialParticipantIds:C,individualParticipantProfiles:O,matchUpDailyLimits:s,matchUp:ne});if(ce.length){T[A].includes(de)||T[A].push(de);continue}let{dependenciesScheduled:Pe,remainingDependencies:it}=B$({matchUpScheduleTimes:w,matchUpDependencies:o,allDateMatchUpIds:L,matchUp:ne});if(!Pe){I[A][de]||(I[A][de]=[]),I[A][de].push({remainingDependencies:it});continue}let It=[],me=G==null?void 0:G.reduce((fe,pe)=>{var Fe,De,je,ue;if(ie.includes(pe.courtId))return fe;let{earliestCourtTime:he}=uj({averageMinutes:H.greatestAverageMinutes,startTime:z,date:A,court:pe});if(fe.scheduleTime&&xt(he)>=xt(fe.scheduleTime))return fe;let{scheduledDependent:Re}=kte({matchUpScheduleTimes:w,matchUpDependencies:o,scheduleTime:he,matchUpId:de,details:H});if(Re)return fe;let{enoughTime:xe}=j$({individualParticipantProfiles:O,matchUpNotBeforeTimes:x,matchUpDependencies:o,scheduleTime:he,details:H,matchUp:ne});if(!xe)return y[A][de]||(y[A][de]=[]),y[A][de].includes(he)||y[A][de].push(he),fe;let Ee=((De=(Fe=H.minutesMap)==null?void 0:Fe[de])==null?void 0:De.averageMinutes)||H.greatestAverageMinutes,{conflicts:we}=V$({potentials:e,averageMatchUpMinutes:Ee,requestConflicts:P,personRequests:p,scheduleTime:he,scheduleDate:A,matchUp:ne});if(we!=null&&we.length)return It.push(...we),!1;k(ke,ye);let Ue=(ue=(je=H.minutesMap)==null?void 0:je[de])==null?void 0:ue.recoveryMinutes;return by({matchUpPotentialParticipantIds:C,individualParticipantProfiles:O,matchUpNotBeforeTimes:x,averageMatchUpMinutes:Ee,matchUpDependencies:o,recoveryMinutes:Ue,scheduleTime:he,matchUp:ne}),(!fe.scheduleTime||xt(he)<xt(fe.scheduleTime))&&(fe.averageMatchUpMinutes=Ee,fe.recoveryMinutes=Ue,fe.scheduleTime=he,fe.courtName=pe.courtName,fe.courtId=pe.courtId),fe},{});if(me.scheduleTime){let{averageMatchUpMinutes:fe,recoveryMinutes:pe,scheduleTime:Fe,courtId:De}=me;w[de]=Fe,S[de]=De,X.push(de),ie.push(De);let je=Fe,ue=ra(je,fe);W({courtId:De,booking:{averageMatchUpMinutes:fe,recoveryMinutes:pe,periodLength:c,matchUpId:de,startTime:je,courtId:De,endTime:ue,venueId:K}}),H.matchUpsToSchedule=H.matchUpsToSchedule.filter(he=>he.matchUpId!==de)}else It!=null&&It.length&&(b[A]||(b[A]=[]),b[A].push(...It))}(ie.length===H.courtsCount||X.length===H.courtsCount||!H.matchUpsToSchedule.length)&&(ae=!0),H.matchUpsToSchedule.length&&X<H.courtsCount&&(rr(z)<rr(j.endTime)?z=ra(z,c):(ae=!0,H.complete=!0)),le+=1,!ae&&le>=Z&&(ae=!0)}(g=H.matchUpsToSchedule)!=null&&g.length||(H.complete=!0)}Y+=1,re=M.every(({venueId:K})=>_[K].complete)||Y===q}for(let{venueId:K}of M){let H=_[K].matchUpMap;Object.keys(H).forEach(Z=>{let X=u[Z];X&&Object.keys(H[Z]).forEach(ie=>{let{drawDefinition:ae}=sd({tournamentRecord:X,drawId:ie});ae&&H[Z][ie].forEach(({matchUpId:le})=>{let ne=w[le],de=S[le];if(ne){let ye=ne.split(":").map(oo).join(":"),ce=`${mt(A)}T${ye}`;f||(ld({drawDefinition:ae,scheduledTime:ce,matchUpId:le}),Hh({courtDayDate:A,tournamentRecords:u,tournamentRecord:X,drawDefinition:ae,matchUpId:le,courtId:de})),U[A].push(le)}})})}),D[A]=_[K].matchUpsToSchedule.map(Pr)}!f&&F!=null&&F.length&&nU({matchUpDetails:F,scheduleByeMatchUps:!0,removePriorValues:!0,tournamentRecords:u,schedule:{scheduledDate:"",scheduledTime:"",courtOrder:"",courtId:"",venueId:""}});for(let K of N.venues)for(let H of K.rounds){let Z=(v=(H.matchUps??[]).map(({matchUpId:ie})=>ie))==null?void 0:v.filter(ie=>U[A].includes(ie));H.canScheduledMatchUpIds=Z;let X=Math.round(((Z==null?void 0:Z.length)||0)/H.matchUpsCount*1e4)/100;(X===1/0||isNaN(X))&&(X=void 0),H.possibleToSchedulePct=X,H.matchUpsCount===(Z==null?void 0:Z.length)&&(H.possibleToSchedule=!0)}}let E=(n??[]).map(({scheduleDate:N})=>N),R={timeStamp:Date.now(),overLimitMatchUpIds:T,scheduledMatchUpIds:U,schedulingProfile:d,noTimeMatchUpIds:D,requestConflicts:P,scheduledDates:E};return Fte({tournamentRecords:u,autoSchedulingAudit:R}),{...Q,schedulingProfileModifications:t,schedulingProfileIssues:r,dateSchedulingProfiles:n,recoveryTimeDeferredMatchUpIds:y,dependencyDeferredMatchUpIds:I,matchUpScheduleTimes:w,overLimitMatchUpIds:T,scheduledMatchUpIds:U,noTimeMatchUpIds:D,requestConflicts:P,scheduledDates:E}}function ZR(t){let{scheduleAttributes:e=["scheduledDate","scheduledTime","courtOrder"],ignoreMatchUpStatuses:i=yr,scheduledDates:r,venueIds:n}=t,a=To(t),o=At(a)?Object.values(a).map(({tournamentId:l})=>l).filter(Boolean):[];if(!(o!=null&&o.length))return{error:xi};let s=0;for(let l of o){let u=a[l],c=f1e({ignoreMatchUpStatuses:i,scheduleAttributes:e,tournamentRecord:u,scheduledDates:r,venueIds:n});if(c.error)return c;s+=c.clearedScheduleCount??0}return{...Q,clearedScheduleCount:s}}function f1e({scheduleAttributes:t=["scheduledDate","scheduledTime","courtOrder"],ignoreMatchUpStatuses:e=yr,tournamentRecord:i,scheduledDates:r,venueIds:n=[]}){if(typeof i!="object")return{error:ve};if(!Array.isArray(e)||!Array.isArray(n))return{error:se};n.length&&t.push("venueId");let a=Hr({matchUpFilters:{scheduledDates:r},tournamentRecord:i}).matchUps??[],o={};a.forEach(({matchUpStatus:u,schedule:c,drawId:d,matchUpId:p})=>{(!u||!e.includes(u))&&Kw({schedule:c,scheduleAttributes:t})&&(!(n!=null&&n.length)||n.includes(c.venueId))&&(o[d]||(o[d]=[]),o[d].push(p))});let s=i.tournamentId,l=0;for(let u in o){let{event:c,drawDefinition:d}=Kn({tournamentRecord:i,drawId:u}),p=Pn({drawDefinition:d,matchUpFilters:{matchUpIds:o[u]}}).matchUps??[];for(let m of p){let h=!1;m.timeItems=(m.timeItems??[]).filter(f=>{let g=(f==null?void 0:f.itemType)&&![Ql,Lc,Ch,qP,Mh,Nh].includes(f==null?void 0:f.itemType);return g||(h=!0),g}),h&&(Et({context:"clear schedules",eventId:c==null?void 0:c.eventId,drawDefinition:d,tournamentId:s,matchUp:m}),l+=1)}}return{...Q,clearedScheduleCount:l}}function eE(t){let{checkPotentialRequestConflicts:e=!0,scheduleCompletedMatchUps:i,clearScheduleDates:r,scheduleDates:n=[],tournamentRecords:a,periodLength:o,useGarman:s,dryRun:l,pro:u}=t,c=We(t,[{[fn]:!0},{[Xr]:D=>!D||Array.isArray(D)&&D.every(ba),[Z8]:!1,[Jn]:cn}]);if(c.error)return c;let d=nc({tournamentRecords:a});if(d.error)return d;if(!d.schedulingProfile.length)return{...Q};let{modifications:p,issues:m=[],schedulingProfile:h=[]}=d,f=Object.assign({},...Object.values(a).map(D=>yv({tournamentRecord:D}).containedStructures)),g=n.map(D=>{if(ba(D))return mt(D)}).filter(Boolean),v=h.map(D=>D.scheduleDate).map(D=>ba(D)&&mt(D)).filter(D=>D&&(!n.length||g.includes(D)));if(!v.length)return{error:s9};if(r&&!l){let D=Array.isArray(r)?r:[];ZR({tournamentRecords:a,scheduledDates:D})}let y=rc({ignoreDisabled:!1,tournamentRecords:a}).courts,{matchUps:I}=Os({matchUpFilters:{matchUpTypes:[ii,ei]},afterRecoveryTimes:!0,nextMatchUps:!0,tournamentRecords:a}),{matchUpDependencies:b}=ps({includeParticipantDependencies:!0,tournamentRecords:a,matchUps:I}),{matchUpDailyLimits:S}=$R({tournamentRecords:a}),{personRequests:w}=Fp({requestType:rU,tournamentRecords:a}),U=h.filter(D=>{let P=mt(D==null?void 0:D.scheduleDate);return v.includes(P)}).sort((D,P)=>new Date(D.scheduleDate).getTime()-new Date(P.scheduleDate).getTime()),T={schedulingProfileModifications:p,checkPotentialRequestConflicts:e,scheduleCompletedMatchUps:i,schedulingProfileIssues:m,dateSchedulingProfiles:U,containedStructureIds:f,matchUpDependencies:b,matchUpDailyLimits:S,clearScheduleDates:r,tournamentRecords:a,schedulingProfile:h,personRequests:w,periodLength:o,useGarman:s,matchUps:I,dryRun:l,courts:y};return u?h1e(T):m1e(T)}function tE(t){let{tournamentRecord:e,tournamentRecords:i,activeTournamentId:r,...n}=t||{};return n.tournamentId||(n.tournamentId=Ht()),n.startDate&&!qd(n.startDate)&&!QS.test(n.startDate)?{error:Fr}:n.endDate&&!qd(n.endDate)&&!QS.test(n.endDate)?{error:Fr}:(n.extensions&&(n.extensions=n.extensions.filter(ul)),{...n})}function H$({addParticipants:t=!0,participantAttribute:e,tournamentRecord:i,personAttribute:r,teamNames:n,accessor:a,uuids:o}){var s,l;if(!i)return{error:ve};let u={},c=(i.participants??[]).filter(({participantType:g,participantRole:v})=>g===Dt&&v===en),d=0;for(let g of c){let v=a&&((s=lm({element:g,accessor:a}))==null?void 0:s.value)||r&&((l=g.person)==null?void 0:l[r])||e&&g[e];if(v){if(!Object.keys(u).includes(v)){u[v]={participantName:(n==null?void 0:n[d])??v,participantId:(o==null?void 0:o.pop())??Ht(),individualParticipantIds:[],participantRole:en,participantType:Xt};let y={value:r??e,name:IM};_t({element:u[v],extension:y}),d+=1}u[v].individualParticipantIds.push(g.participantId)}}let p=Object.keys(u),m=(i.participants??[]).map(g=>{if(g.participantType!==Xt||g.participantRole!==en)return;let{extension:v}=vt({name:IM,element:g}),y=v==null?void 0:v.value;if(p.includes(y))return g.participantId}).filter(Boolean),h=0,f=[];return Object.keys(u).forEach(g=>{let v=u[g],{participantId:y}=v;m.includes(y)||(i.participants||(i.participants=[]),t&&i.participants.push(v),f.push(v),h++)}),t&&h?(ut({payload:{tournamentId:i.tournamentId,participants:f},topic:kc}),{...Q,participantsAdded:h}):f.length?{...Q,newParticipants:f}:{error:tUe}}var g1e=[{AA:"Annexia"},{BA:"Bacteria"},{BO:"Borduria"},{BM:"Bensalem"},{BS:"Basenji"},{BI:"Balnibarbi"},{BV:"Bartovia"},{BZ:"Berzerkistan"},{CA:"Caldonia"},{CC:"Concordia"},{CH:"Chula"},{DA:"Deltora"},{DW:"Discworld"},{EA:"Eastasia"},{EP:"Ecotopia"},{ER:"Erewhon"},{FA:"Freedonia"},{FN:"Florin"},{FG:"Fogg"},{FK:"Fourecks"},{GA:"Genovia"},{GL:"Gilead"},{GD:"Gilead"},{GL:"Gondal"},{GO:"Gondor"},{GR:"Gruzinia"},{GT:"Goritania"},{GU:"Guilder"},{HA:"Heldscalla"},{HO:"Hidalgo"},{IL:"Illyria"},{KA:"Kinakuta"},{KG:"Kangan"},{KN:"Kreplachistan"},{KS:"Kallipolis"},{LH:"Lugash"},{LI:"Listenbourg"},{LT:"Lilliput"},{LU:"Luggnagg"},{LV:"Lichtenslava"},{MR:"Moher"},{NA:"Narnia"},{NV:"Novaria"},{OA:"Oceania"},{OS:"Orsinia"},{OV:"Octavia"},{PA:"Palombia"},{PG:"Penguina"},{QA:"Qasha"},{PM:"Panem"},{SA:"Solymbria"},{SD:"Syldavia"},{SG:"San Glucose"},{SL:"San Lorenzo"},{SR:"Sontar"},{SY:"Sylvania"},{TF:"Tralfamadore"},{TH:"Themyscira"},{UA:"Utopia"},{VA:"Vespugia"},{WA:"Wakanda"},{WX:"Wessex"},{ZA:"Zamunda"},{ZK:"Zubrowka"}],v1e=["Amber","Ansul","Atlantis","Braavos","Busytown","Castle Rock","Centralia","Coober Pedy","Chefchaouen","Chronopolis","Damanhur","Diaspar","Dictionopolis","Diomira","El Dorado","Elista","Ephesus","Gotham","Hadleyburg","Hallstatt","Hierusalem","Ilium","Inverness","Kowloon","Laputa","Longyearbyen","Lys","Matmata","Maycomb","Metropolis","Miyake-jima","Monowi","Nagoro","Navarre","New New York","Nimbin","Pemberley","Pseudopolis","Rivendell","Roswell","Shangri-La","Springfield","Supilinn","Thneedville","Trantor","Wobegon","Yonwood","Xanadu","Xylar","Zion"];function Lte({count:t=1,participantsCount:e=32}={}){let i=Tn(v1e),r=i.slice(0,t);return{cities:Te(0,e).map(n=>n<Math.min(t,i.length)?r[n]:_o(r))}}function _te({count:t=1,participantsCount:e=32}={}){let i=Tn(g1e),r=i.slice(0,t).map(n=>Object.keys(n)).flat();return{states:Te(0,e).map(n=>n<Math.min(t,i.length)?r[n]:_o(r))}}function $te({count:t=1,participantsCount:e=32}={}){let i=Te(0,t).map(()=>Te(0,5).map(()=>ro(0,9)).join(""));return{postalCodes:Te(0,e).map(r=>r<t?i[r]:_o(i))}}function P0({idPrefix:t,participantType:e,index:i,uuids:r}){let n=Di(e)?e[0]:"X";return t?`${t}-${n}-${i}`:(r==null?void 0:r.pop())||Ht()}function Bte(t){let{cities:e,states:i,postalCodes:r,nationalityCode:n,participantIndex:a}=t;return{postalCode:r==null?void 0:r[a],state:i==null?void 0:i[a],city:e==null?void 0:e[a],countryCode:n}}var I1e={lastNames:["Abbey","Ahern","Ampleforth","Ananiadis","Andelic","Assange","Atreides","Austen","Bach","Banks","Barrington","Batty","Bauers","Beals","Beer","Bennett","Berry","Bonaparte","Brewer","Brockovich","Bukowski","Cassidy","Catton","Calvino","Carlin","Carson","Chip","Constant","Crane","Crowne","Cummings","Curie","Dallas","Diamond","Deckard","Drazic","Dunbar","Earhart","Eisenstein","Eldritch","Elliot","Ellul","Escher","Eyre","Faulkner","Fulcher","Fukuoka","Godel","Goldstein","Greer","Hedges","Herbert","Holmgren","Humperdinck","Huxley","Illich","Jeffers","Jensen","Jevons","Johnson","Johnstone","Jovovich","Kingsnorth","Langer","Fernwright","Fuller","Le Guin","Lem","Lovelace","Mander","McLuhan","Midgely","Mond","Montoya","Moore","Murry","Nagle","Nearing","Ogden","Ophuls","Parks","Paz","Peet","Perfect","Pendejo","Pevensie","Postman","Ripley","Rodda","Rumfoord","Runciter","Rugen","Sale","Schumacher","Shaftoe","Shelley","Shepard","Smith","Stratton","Stewart","Swift","Tillich","Turing","Tyrell","Twain","Yeats","Veblen","Yates","Vonnegut","Waterhouse","Watson","Wolin","Wirt","Waschuk","Wormwood"],firstFemale:["Ada","Amelia","Amelie","America","Anne","Antonia","Aravis","Astrid","Beatrice","Brienne","Buttercup","Caitlin","Cimorene","Cordelia","Desdemona","Ellen","Elizabeth","Emily","Emmie","Erin","Eva","Evelyn","Heather","Helen","Hermia","Hypatia","Imogen","Jane","Jasmine","Juliana","Juliet","Katniss","Leeloo","Lenina","Lilith","Linda","Lizzie","Louise","Lucy","Marie","Mary","Martha","Matilda","Milla","Miranda","Meg","Melba","Nicole","Ola","Portia","Pris","Rachael","Rachel","Rebecca","River","Rosa","Rosalind","Scout","Sharn","Susanne","Titania","Uhura","Ursula","Valentina","Viola","Virginia","Xena","Zoe"],firstMale:["Alan","Aldous","August","Axel","Barda","Barry","Bill","Bruce","Charles","Chris","Constantine","Darwin","David","Derrick","Edward","Emmanuel","Ernst","Estlin","Fezzik","Filby","Frank","Frito","George","Glen","Helmholtz","Inigo","Italo","Ivan","Jacques","James","Jared","Jerry","Joe","Johann","Julian","John Michael","Jonathan","Korben","Kirkpatrick","Kurt","Lief","Malachi","Mark","Marhsall","Masanobu","Maurits","Michael","Mustapha","Neil","Nikola","Octavio","Palmer","Paul","Pierre","Robinson","Rick","Rincewind","Roy","Shannon","Sheldon","Stafford","Stanislaw","Stanley","Syme","Thorstein","Thomas","Tyrone","Vizzini","Walton","Walker","Warren","Wendell","Westley","William","Winston","Zoran"]};function eC(t){let{count:e=100,sex:i}=t||{};if(!e||i&&![Qt,mi].includes(i))return{personData:[],error:se};let r=Math.ceil(e*1.3),{lastNames:n,firstFemale:a,firstMale:o}=I1e,s=yc.map(({iso:f})=>f).filter(Boolean),l=Math.ceil(r/n.length),u=Math.ceil(r/a.length),c=Math.ceil(r/o.length),d=Te(0,l).flatMap(()=>{let f=Ne(n,!1,!0);return Te(0,n.length).map(()=>ga(f))}),p=Te(0,u).flatMap(()=>{let f=Ne(a,!1,!0);return Te(0,a.length).map(()=>ga(f))}),m=Te(0,c).flatMap(()=>{let f=Ne(o,!1,!0);return Te(0,o.length).map(()=>ga(f))}),h={};for(let f=0;f<r;f++){let g=d.pop(),v=i||_o([Qt,mi]),y=v===Qt?m.pop():p.pop(),I=_o(s);h[`${y}${g}`]={nationalityCode:I,sex:v,firstName:y,lastName:g}}return{personData:Object.values(h).slice(0,e)}}function Vte(t){let e=(t==null?void 0:t.count)||1,{personExtensions:i,consideredDate:r,isMock:n=!0,gendersCount:a,personData:o,category:s,sex:l}=t||{};if(isNaN(e))return{error:se};let u=(a==null?void 0:a[Qt])||l===Qt&&e||0,c=(a==null?void 0:a[mi])||l===mi&&e||0;e=Math.max(e,u+c);let d=e-(u+c),p=u&&eC({count:u,sex:Qt}).personData||[],m=c&&eC({count:c,sex:mi}).personData||[],h=[...p,...m,...d&&eC({count:d}).personData||[]],f=h.filter(T=>!l||u&&c||T.sex===l),g=[];if(Array.isArray(o)){let T=o.filter(D=>typeof D.firstName!="string"||typeof D.lastName!="string"||D.sex&&![Qt,mi].includes(D.sex)||D.nationalityCode&&(typeof D.nationalityCode!="string"||D.nationalityCode.length>3||!yc.find(({iso:P,ioc:E})=>[P,E].includes(D.nationalityCode)))?!1:(D.nationalityCode&&g.push(D.nationalityCode),!0));if(T.length)f=T;else return{error:se}}let v=o?f:Tn(f);if(v.length<e){let{maleFirstNames:T,maleLastNames:D,femaleFirstNames:P,femaleLastNames:E,nationalityCodes:R}=h.reduce((N,A)=>{let{firstName:M,lastName:C,nationalityCode:O}=A;return A.sex===Qt?(N.maleFirstNames.includes(M)||N.maleFirstNames.push(M),N.maleLastNames.includes(C)||N.maleLastNames.push(C)):(N.femaleFirstNames.includes(M)||N.femaleFirstNames.push(M),N.femaleLastNames.includes(C)||N.femaleLastNames.push(C)),N.nationalityCodes.includes(O)||N.nationalityCodes.push(O),N},{maleFirstNames:[],maleLastNames:[],femaleFirstNames:[],femaleLastNames:[],nationalityCodes:[]});Te(0,e-v.length).forEach(()=>{let N=l||_o([Qt,mi]),A=_o(R),M=_o(N===Qt?T:P),C=_o(N===Qt?D:E),O={firstName:M,lastName:C,sex:N,nationalityCode:A};v.push(O)})}let{ageMinDate:y,ageMaxDate:I}=Nm({consideredDate:r,category:s}),b=Ze((y==null?void 0:y.slice(0,4))||0)||Ze((I==null?void 0:I.slice(0,4))||0)-3,S=Ze((I==null?void 0:I.slice(0,4))||0)||Ze((y==null?void 0:y.slice(0,4))||0)+3,w=(y||I)&&[b,S],U=v.slice(0,e).map((T,D)=>{let[P,E]=w||[],R=w&&ga(Te(P,E)),N=ga(Te(0,365)),A=R&&KUe(R,N);return Object.assign(He({extensions:i||[{name:"regionCode",value:D+1}],birthDate:A,isMock:n}),T)});return{persons:U.length&&U||v[0],nationalityCodes:g}}var y1e=["Ace Academy","Avengers","Ball Bouncers","Baseliners","Captivators","Civil Disobedients","Continentals","Court Royal","Court Sharks","Diamond Dogs","Danger Zone","Doubles Dominators","Double Faults","Tricksters","Eliminators","Court Crusaders","Fuzz Busters","Game Changers","Goal Gurus","Good Volley","Green Machine","Hawk Eyes","Inside Outers","Killer Instinct","Line Toers","Masters of Mayhem","Matter Catchers","Cheap Shot","Mean Machines","Mindspace Invaders","Net Centric","Net Positive","Smash Mullet","Over Your Head","Spin Meisters","Aggressors","Racket Machine","Slice Happy","Refs Nightmare","Sandeaters","Sun Seekers","Slicer Dicers","Stacked Deck","Cross Stringers","The Emergence","Total Demolition","Touch and Go","Unreturnables","Upside Downers","Vertically Challenged","Visual Spectacle"];function R0({nameRoot:t="TEAM",count:e=1}={}){let i=Tn(y1e).slice(0,e);return i.length<e&&Te(0,e-i.length).forEach(r=>i.push(`${t} ${r+1}`)),{names:i}}function Fv(t){let{scaledParticipantsCount:e,rankingRange:i}=t,{ratingsParameters:r=Tr,valuesInstanceLimit:n,ratingsValues:a=[],consideredDate:o,categories:s,category:l,nationalityCodesCount:u,nationalityCodeType:c,nationalityCodes:d,participantsCount:p=32,participantType:m,teamSize:h=8,personIds:f,idPrefix:g,uuids:v,personExtensions:y,addressProps:I,gendersCount:b,matchUpType:S,personData:w,sex:U,inContext:T,withISO2:D,withIOC:P,scaleAllParticipants:E}=t,R=m===ft||S===Wd,N=m===Xt||S===Xt;i&&(!Array.isArray(i)||!i.every(ce=>_i(ce))||i.length!==2)&&(i=void 0),e=E?p:e;let A=1e3,M=e&&e>A?e:A;i=i||[1,M],i[1]+=1;let C=p*(R&&2||N&&(h??8)||1),O=Vte({count:C,personExtensions:y,consideredDate:o,gendersCount:b,personData:w,category:l,sex:U});if(O.error)return O;let{nationalityCodes:k,persons:x}=O,F={},$={},_={},L={},B=ce=>{Object.assign(F,ce.doublesRankings),Object.assign($,ce.singlesRankings),Object.assign(L,ce.doublesRatings),Object.assign(_,ce.singlesRatings)};if(At(l)){let ce=cj({scaledParticipantsCount:e,ratingsParameters:r,participantType:m,ratingsValues:a,rankingRange:i,category:l});B(ce)}Array.isArray(s)&&s.forEach(ce=>{let ke=cj({scaledParticipantsCount:e,ratingsParameters:r,participantType:m,ratingsValues:a,rankingRange:i,category:ce});B(ke)});let V=yc.filter(ce=>c==="IOC"&&ce.ioc||ce.iso);function G(ce){let ke=Math.ceil(C/ce);return n&&ke>n?Math.ceil(C/n):ce}let{postalCodesProfile:j,postalCodesCount:z,statesProfile:W,citiesProfile:q,citiesCount:Y,statesCount:re}=I||{},K=ce=>Object.keys(ce).map(ke=>Te(0,W[ke]).map(()=>ke)).flat(),H=q&&K(q)||(I==null?void 0:I.cities)||Lte({count:Y||C,participantsCount:C}).cities,Z=W&&K(W)||(I==null?void 0:I.states)||_te({count:re||C,participantsCount:C}).states,X=j&&K(j)||(I==null?void 0:I.postalCodes)||$te({count:z||C,participantsCount:C}).postalCodes,ie={cities:H,states:Z,postalCodes:X},ae=G(u),le=ae?Tn(V).slice(0,u):d&&V.filter(ce=>d.includes(ce.iso))||V,ne=Tn(Te(0,Math.ceil(C/(ae||1))).map(()=>le).flat(1/0)),de=R0({count:p}).names;return{participants:Te(0,p).map(ce=>{let ke=R&&2||N&&(h??8)||1,Pe=Te(0,ke).map(pe=>{let Fe=ce*ke+pe;return ye(Fe)}),it=Pe.map(pe=>pe.participantId),It=Pe.map(pe=>pe.person.standardFamilyName).join("/"),me=R?ft:Xt,fe={participantId:P0({participantType:me,index:ce,idPrefix:g,uuids:v}),participantName:R?It:de[ce],participantRole:en,individualParticipantIds:it,participantType:me};return T&&(fe.individualParticipants=Pe),R||N?[fe,...Pe]:Pe}).flat(),...Q};function ye(ce){let ke=x[ce],{nationalityCode:Pe,participantExtensions:it,participantTimeItems:It,extensions:me,firstName:fe,birthDate:pe,lastName:Fe,personId:De,sex:je}=ke||{},ue=fe||"GivenName",he=Fe||"FamilyName",Re=`${ue} ${he}`,xe=ne[ce],Ee=(k==null?void 0:k.length)&&Pe||xe&&(c==="IOC"?xe.ioc||xe.iso:xe.iso||xe.ioc)||Pe;ne!=null&&ne.length&&!Ee&&!Pe&&console.log("%c Invalid Nationality Code",{participantIndex:ce,country:xe});let we=Bte({...ie,participantIndex:ce,nationalityCode:Ee}),Ue=He({participantId:P0({participantType:Dt,index:ce,idPrefix:g,uuids:v}),extensions:it,timeItems:It,participantRole:en,participantType:Dt,participantName:Re,person:{personId:De||(f==null?void 0:f.length)&&f[ce]||Ht(),birthDate:ba(pe)?pe:void 0,addresses:[we],standardFamilyName:he,standardGivenName:ue,nationalityCode:Ee,extensions:me,sex:je}});if(P&&Ee){let Le=yc.find(({iso:rt})=>rt===Ee);Le!=null&&Le.ioc&&(Ue.person.iocNationalityCode=Le.ioc),Le!=null&&Le.label&&(Ue.person.countryName=Le.label)}if(D&&Ee){let Le=yc.find(({iso:rt})=>rt===Ee);Le!=null&&Le.iso2&&(Ue.person.iso2NationalityCode=Le.iso2),Le!=null&&Le.label&&(Ue.person.countryName=Le.label)}let wt=Le=>{var rt,Ei,Be,nt;let Ii=Le.categoryName||Le.ratingType||Le.ageCategoryCode,be=(rt=$[Ii])==null?void 0:rt[ce],Ct=(Ei=F[Ii])==null?void 0:Ei[ce];bU({scaleValue:be,eventType:Am,scaleType:Nc,participant:Ue,category:Le}),bU({scaleValue:Ct,eventType:Au,scaleType:Nc,participant:Ue,category:Le});let Ce=(Be=_[Ii])==null?void 0:Be[ce],qe=(nt=L[Ii])==null?void 0:nt[ce];bU({scaleValue:Ce,eventType:Am,scaleType:Ic,participant:Ue,category:Le}),bU({scaleValue:qe,eventType:Au,scaleType:Ic,participant:Ue,category:Le})};return Array.isArray(s)?s.forEach(Le=>wt(Le)):l&&wt(l),Ue}}function bU({scaleValue:t,participant:e,eventType:i,scaleType:r,category:n}){let a=n.categoryName||n.ratingType||n.ageCategoryCode,o=[Jd,r,i,a].join("."),s={itemValue:t,itemType:o};a&&t&&(e.timeItems||(e.timeItems=[]),e.timeItems.push(s))}function cj(t){let{category:e,scaledParticipantsCount:i,ratingsParameters:r,participantType:n,ratingsValues:a=[]}=t,o=e.rankingRange||t.rankingRange||[1,1e3],s={},l={},u={},c={},{categoryName:d,ageCategoryCode:p,ratingType:m}=e,h=e.categoryName||e.ratingType||e.ageCategoryCode;if((d||p)&&!m){let[f,g]=o||[];if(l[h]=Tn(Te(f,g)).slice(0,i||ro(20,30)),[ft,Xt].includes(n)){let[v,y]=o||[];s[h]=Tn(Te(v,y)).slice(0,i||ro(20,30))}}if(m&&r[m]){let{ratingMax:f,ratingMin:g,ratingAttributes:v}=e,y={...r[m],...v||{}},{attributes:I={},decimalsCount:b,accessors:S,range:w,step:U}=y,T=N=>{let A={},M=Object.keys(N||{});for(let C of M){let O=N[C];if(typeof O=="object"&&O.generator){let{range:k}=O,[x,F]=k.slice().sort();A[C]=ro(x,F)}else A[C]=O}return A},D=w[0]>w[1]?2:.7,[P,E]=w.slice().sort(),R=Te(0,2e3).map(()=>PK(P,E,D,U,b)).filter(N=>(!f||N<=f)&&(!g||N>=g)).slice(0,i||ro(20,30)).map(N=>S?Object.assign({},...S.map(A=>({[A]:N})),T(I)):N);u[h]=[...a,...R],[ft,Xt].includes(n)&&(c[h]=[...a,...R])}return{singlesRankings:l,doublesRankings:s,singlesRatings:u,doublesRatings:c}}function z$(t){var e,i;let{alternatesCount:r=0,tieFormatName:n,drawSize:a}=t,o=0,s=0,l=0,u=0,c={},d={[Qt]:0,[mi]:0,[jn]:0,[Td]:0,[As]:0};(i=(e=At(t.tieFormat)?t.tieFormat:Nu({namedFormat:n}))==null?void 0:e.collectionDefinitions)==null||i.filter(Boolean).forEach(f=>{let{category:g,collectionId:v,matchUpType:y,matchUpCount:I,gender:b}=f;if([Qt,mi].includes(b)){let S=I*(y===ei?2:1);d[b]<S&&(d[b]=S)}else b===jn&&(d[Qt]<I&&(d[Qt]=I),d[mi]<I&&(d[mi]=I));if(g){let S=JSON.stringify(g);c[S]=g}if(v||(f.collectionId=Ht()),Xi(ei)(y)){let S=I;u+=I,o=Math.max(o,S)}if(Xi(ii)(y)){let S=I;l+=I,s=Math.max(s,S)}});let p=Object.keys(c).length?Math.max(l,u*2):Math.max(s,o*2),m=o*(a+r),h=s*(a+r);return{maxDoublesDraw:m,maxSinglesDraw:h,teamSize:p,genders:d}}function b1e({participantsProfile:t,eventProfiles:e,drawProfiles:i}){let{participantsCount:r,participantType:n=Dt}=t||{},a=r||0,o={[mi]:0,[jn]:0,[Td]:0,[Qt]:0,[As]:0},s=0,l=0,u=0,c=0,d=0,p=({alternatesCount:h=0,uniqueParticipants:f,tieFormatName:g,drawSize:v=0,eventType:y,tieFormat:I,category:b,gender:S,stage:w})=>{let U=y===ho,T=y===ur,D=!!(f||w===Ke||b||S);if(T){c=Math.max(c,v+h),I=typeof I=="object"?I:Nu({namedFormat:g});let{teamSize:P,maxDoublesDraw:E,maxSinglesDraw:R,genders:N}=z$({alternatesCount:h,tieFormatName:g,tieFormat:I,drawSize:v});u=Math.max(u,P),l=Math.max(l,R),D||(s=Math.max(s,E)),Object.keys(N).forEach(A=>o[A]+=N[A])}else if(U)if(D){let P=(v+h)*2;d+=P,S&&(o[S]+=P)}else v+h&&v+h>s&&(s=v+h);else if(D){let P=v+h;S&&(o[S]+=P),d+=P}else v&&v>l&&(l=v+h)};if(e==null||e.forEach(h=>{let{tieFormatName:f,tieFormat:g,drawProfiles:v,eventType:y,category:I,gender:b}=h;if(v)for(let S of v){let{tieFormatName:w,tieFormat:U}=S;p({...S,tieFormatName:w||f,tieFormat:U||g,eventType:y,category:I,gender:b})}}),Array.isArray(i))for(let h of i)p(h);let m=Math.max(c*u,s*2,l);return s&&(n=ft),(r||a)<m&&(r=m),r&&s&&[ft,ur].includes(n)&&(l&&Math.floor(l/2)>s?r=Math.floor(l/2):(!l||s*2>=l)&&(r=Math.ceil(r/2))),r===void 0&&(r=!(e!=null&&e.length)&&!(i!=null&&i.length)?32:0),r<a&&(r=a),{uniqueParticipantsCount:d,participantsCount:r,largestTeamDraw:c,largestTeamSize:u,participantType:n,gendersCount:o}}function jte({participantsProfile:t,tournamentRecord:e,eventProfiles:i,drawProfiles:r,startDate:n,uuids:a}){if((t==null?void 0:t.participantsCount)===0)return{addedCount:0,...Q};let{participantsCount:o,participantType:s,largestTeamDraw:l,largestTeamSize:u,gendersCount:c}=b1e({participantsProfile:t,eventProfiles:i,drawProfiles:r}),d=t==null?void 0:t.teamKey,p=Fv({consideredDate:n,...t,participantsCount:o,participantType:s,gendersCount:c,uuids:a}).participants,m=0,h=os({tournamentRecord:e,participants:p});if(h.error)return h;if(m+=h.addedCount,d){let y=H$({tournamentRecord:e,...d});if(y.error)return y}let f=p.filter(({participantType:y})=>y===Dt).map(Tt),g=t!=null&&t.idPrefix?`${Xt}-${t.idPrefix}`:void 0,v=Te(0,l).map(y=>{let I=f.slice(y*u,(y+1)*u),b=P0({index:y,participantType:s,idPrefix:g,uuids:a});return{participantName:`Team ${y+1}`,participantRole:en,individualParticipantIds:I,participantType:Xt,participantId:b}});return h=os({participants:v,tournamentRecord:e}),h.error?h:(m+=h.addedCount,{addedCount:m,...Q})}function Gte({drawProfiles:t,category:e,gender:i}){let r={},n=t==null?void 0:t.reduce((o,s)=>{let{qualifyingPositions:l=0,participantsCount:u=0,uniqueParticipants:c,stage:d=Ae,drawSize:p=0}=s||{};Object.keys(o).includes(d)||(o[d]=0);let m=(u||p)-l;return c||i||e||d===Ke?(Object.keys(r).includes(d)||(r[d]=0),r[d]+=m):o[d]=Math.max(o[d],m),o},{}),a=Object.keys(r);return a.forEach(o=>n[o]+=r[o]),{stageParticipantsCount:n,uniqueParticipantsCount:r,uniqueParticipantStages:a}}function Hte({allUniqueParticipantIds:t,stageParticipantsCount:e,eventParticipantType:i,targetParticipants:r}){let n=e[Ae]||0,a=e[Ke]||0;return{stageParticipants:{QUALIFYING:r==null?void 0:r.filter(({participantType:o})=>o===i).filter(({participantId:o})=>!t.includes(o)).slice(0,a),MAIN:r==null?void 0:r.filter(({participantType:o})=>o===i).filter(({participantId:o})=>!t.includes(o)).slice(a,a+n)}}}var w1e={[Ft]:2,[tr]:1,[dr]:1,[zr]:1,[Pt]:4};function W$(t){let{defaultWithScorePercent:e=2,winningSide:i}=t,{matchUpStatusProfile:r=w1e,matchUpFormat:n=zo,pointsPerMinute:a=1,sideWeight:o=4}=t;if(!Ra({matchUpFormat:n}))return{error:Qx};if(typeof r!="object")return{error:se};if(e>100&&(e=100),isNaN(e)||isNaN(a)||isNaN(o))return{error:se};let s=Object.keys(r).filter(P=>Object.keys(TX).includes(P)&&P!==Ki);if(Object.keys(s).reduce((P,E)=>P+r[E],0)>100)return{error:se,matchUpStatusProfile:r};let l=s.reduce((P,E)=>(P.pointer=P.pointer+r[E],P.valueMap.push([P.pointer,E]),P),{pointer:0,valueMap:[]}),u=ro(1,100),c=(l.valueMap.find(P=>u<=P[0])??[100,Ki])[1],d={sets:[],scoreStringSide1:"",side2ScoreString:""};if([Ft,Pt].includes(c)){i=i||ro(1,2);let P={score:d,matchUpStatus:c,winningSide:i};if(!(c===Pt&&ro(1,100)>100-e))return{outcome:P}}else if([tr,dr].includes(c))return{outcome:{score:d,matchUpStatus:c}};let p=Ln(n),{bestOf:m=1,exactly:h,setFormat:f,finalSetFormat:g}=p??{},v=[],y=ro(0,1),I=i?[i-1]:[...Te(0,o).map(()=>y),1-y],b=[zr,Pt,Ca,rd].includes(c)&&(ga(Te(1,h||m))||1),S,w=Te(1,(h??m)+1);for(let P of w){let E=P===(h??m),{set:R,incomplete:N,winningSideNumber:A}=U1e({setFormat:E&&g||f,incomplete:b===P,pointsPerMinute:a,matchUpStatus:c,weightedRange:I,setNumber:P});if(v.push(R),N){S=A;break}if(yy({matchUp:{score:{sets:v},matchUpFormat:n}}).calculatedWinningSide)break}let U=yy({matchUp:{score:{sets:v},matchUpFormat:n,winningSide:i}}),T=S?i||S:U.calculatedWinningSide,{score:D}=Rte({winningSide:T,score:{sets:v},matchUpStatus:c});return{outcome:{winningSide:T,matchUpStatus:c,score:D}}}function U1e({weightedRange:t=[0,1],pointsPerMinute:e,matchUpStatus:i,incomplete:r,setFormat:n,setNumber:a}){let o={setNumber:a},{setTo:s,tiebreakFormat:l,tiebreakAt:u,tiebreakSet:c,timed:d,minutes:p}=n,m=ro(0,t.length-1),h=t[m],f;if(d){let g=p*e,v=Math.round(g*.2),y=g+ga([1,-1])*v,I=Awe(y,2),b=[I,y-I];h&&b.reverse(),f=t[m]+1;let S=b[0]>b[1]&&1||b[1]>b[0]&&2||0;if(r){let[T,D]=b;return Object.assign(o,{side1Score:T,side2Score:D}),yr.includes(i)?{set:o,incomplete:r,winningSideNumber:f}:{set:o,incomplete:r}}S||(b[ro(0,1)]+=1),S=b[0]>b[1]?1:2,S!==f&&b.reverse();let[w,U]=b;return Object.assign(o,{side1Score:w,side2Score:U,winningSide:f}),{set:o}}else{if(r)return o.side1Score=ro(0,u),o.side2Score=ro(0,u),yr.includes(i)&&(f=t[m]+1),{set:o,incomplete:r,winningSideNumber:f};{let g=Te(1,s+1).map(U=>Te(0,s+2-U).map(()=>U)).flat(),v=g[ro(0,g.length-1)],y=s&&N_({isSide1:!0,tiebreakAt:u,lowValue:v,setTo:s}),I=!y,b=t.length===1&&t[m]+1;if(!I){b?(y[0]>y[1]?1:2)!==b&&y.reverse():h&&y.reverse();let[U,T]=y;Object.assign(o,{side1Score:U,side2Score:T})}let S=vy({matchUpScoringFormat:{setFormat:n},setObject:o}),w;if(S.hasTiebreakCondition||I){let{NoAD:U,tiebreakTo:T}=l||c||{},D=Te(1,T+1).map(R=>Te(0,T+2-R).map(()=>R)).flat(),P=D[ro(0,D.length-1)],E=SR({isSide1:!0,tiebreakNoAd:U,tiebreakTo:T,lowValue:P});if(E)if(I){let R=E[0]>E[1]?1:2;b?R!==b&&E.reverse():h&&E.reverse(),[o.side1TiebreakScore,o.side2TiebreakScore]=E,w=E[0]>E[1]&&1||E[1]>E[0]&&2||void 0}else S.leadingSide===2?[o.side1TiebreakScore,o.side2TiebreakScore]=E:[o.side2TiebreakScore,o.side1TiebreakScore]=E}o.winningSide=S.winningSide||S.leadingSide||b||w}}return{set:o}}function E0(t){var e,i,r;let{matchUpStatusProfile:n,completeAllMatchUps:a,randomWinningSide:o,tournamentRecord:s,completionGoal:l,drawDefinition:u,event:c}=t;if(!u)return{error:$e};let d=t.matchUpFormat||u.matchUpFormat||(c==null?void 0:c.matchUpFormat),p=u.structures.slice().sort(Ph),m=0,{matchUps:h,matchUpsMap:f}=fr({matchUpFilters:{matchUpTypes:[fi],roundNumbers:[1]},contextFilters:{stages:[Ae,Ke]},inContext:!0,drawDefinition:u});if(h!=null&&h.length){let b=((e=c==null?void 0:c.category)==null?void 0:e.ageCategoryCode)||((i=c==null?void 0:c.category)==null?void 0:i.categoryName);if(b){let S=rte({singlesOnly:!0,tournamentRecord:s,drawDefinition:u,scaleAccessor:{scaleName:b,sortOrder:ite,scaleType:Nc},event:c});if(S.error)return S;let{lineUps:w,participantsToAdd:U}=S;os({tournamentRecord:s,participants:U}),_t({element:u,extension:{name:Fu,value:w}})}else{let S=(r=h[0])==null?void 0:r.structureId,{positionAssignments:w}=si({drawDefinition:u,structureId:S});if(w!=null&&w.length){let{participants:U}=Oi({participantFilters:{participantTypes:[fi]},tournamentRecord:s}),T=D=>{let P=D.tieMatchUps.filter(Xi(ii)),E=D.tieMatchUps.filter(Xi(ei));P.forEach((R,N)=>{let A=R.matchUpId;R.sides.forEach(M=>{var C;let{drawPosition:O}=M,k=U==null?void 0:U.find(x=>{var F;let{participantId:$}=x;return((F=w.find(_=>_.participantId===$))==null?void 0:F.drawPosition)===O});if(k){let x=(C=k.individualParticipantIds)==null?void 0:C[N];x&&D0({teamParticipantId:k.participantId,participantId:x,tournamentRecord:s,drawDefinition:u,tieMatchUpId:A,event:c})}})}),E.forEach((R,N)=>{let A=R.matchUpId;R.sides.forEach(M=>{var C,O;let{drawPosition:k}=M,x=U==null?void 0:U.find(F=>{var $;let{participantId:_}=F;return(($=w.find(L=>L.participantId===_))==null?void 0:$.drawPosition)===k});x&&((O=(C=x.individualParticipantIds)==null?void 0:C.slice(N*2,N*2+2))==null||O.forEach(F=>{D0({teamParticipantId:x.participantId,participantId:F,tournamentRecord:s,drawDefinition:u,tieMatchUpId:A,event:c})}))})})};h.forEach(T)}}}let g=typeof a=="string"&&a,v=g&&Ki,y=p.length===2&&p[0].finishingPosition===Xd&&ji(p.map(({stage:b})=>b),[Ae,Bi]).length===2,I=p.map(({structureId:b})=>b);for(let b of I){if(m>=l)break;let S=u.structures.find(T=>T.structureId===b),w=qt({contextFilters:{matchUpTypes:[ei,ii]},afterRecoveryTimes:!1,tournamentRecord:s,inContext:!0,drawDefinition:u,matchUpsMap:f,structure:S,event:c}).matchUps;w.length;let U=w.filter(({winningSide:T})=>!T).sort(xh).map(Pr);for(let T of U){if(!isNaN(l)&&m>=l)break;let{matchUps:D}=qt({matchUpFilters:{matchUpTypes:[ei,ii]},afterRecoveryTimes:!1,tournamentRecord:s,inContext:!0,drawDefinition:u,matchUpsMap:f,structure:S,event:c}),P=D.find(R=>R.matchUpId===T),E=[tr,dr].includes(P.matchUpStatus);if(P!=null&&P.readyToScore&&!E){let R=S1e({matchUpStatusProfile:n,tournamentRecord:s,drawDefinition:u,targetMatchUp:P,matchUpFormat:d,matchUpStatus:v,scoreString:g,winningSide:!o&&1,event:c});if(R!=null&&R.error)return R;m+=1}}y&&S.finishingPosition===Xd&&t.completeRoundRobinPlayoffs&&Dv({structureId:S.structureId,applyPositioning:!0,drawDefinition:u})}return{...Q,completedCount:m}}function zte(t){let{matchUpStatusCodes:e,policyDefinitions:i,tournamentRecord:r,drawDefinition:n,targetMatchUp:a,matchUpStatus:o,matchUpFormat:s,scoreString:l,winningSide:u,event:c}=t;if(!a||a.matchUpStatus===jt)return;let{matchUpId:d}=a||{},{outcome:p}=$$({matchUpFormat:s,matchUpStatus:o,scoreString:l,winningSide:u});return e&&(p.matchUpStatusCodes=e),tU({tournamentRecord:r,policyDefinitions:i,drawDefinition:n,matchUpFormat:s,matchUpId:d,outcome:p,event:c})}function S1e(t){let{matchUpStatusProfile:e={},tournamentRecord:i,policyDefinitions:r,drawDefinition:n,matchUpStatus:a,matchUpFormat:o,targetMatchUp:s,scoreString:l,winningSide:u,event:c}=t;if(l||a)return zte(t);let{matchUpId:d}=s||{},{outcome:p}=W$({matchUpStatusProfile:e,matchUpFormat:o,winningSide:u});return tU({policyDefinitions:r,tournamentRecord:i,drawDefinition:n,matchUpFormat:o,matchUpId:d,outcome:p,event:c})}function Wte({matchUpStatusProfile:t,completeAllMatchUps:e,randomWinningSide:i,tournamentRecord:r,drawProfiles:n,isMock:a,event:o}){var s,l,u,c;let d=Hi({event:o}).flightProfile,{eventName:p,eventType:m,category:h}=o,{startDate:f}=r,g=[],v=(h==null?void 0:h.categoryName)||(h==null?void 0:h.ageCategoryCode)||(h==null?void 0:h.ratingType),y=(s=o.drawDefinitions)==null?void 0:s.map(({drawId:I})=>I);if(Array.isArray(d==null?void 0:d.flights))for(let[I,b]of d.flights.entries()){let{drawId:S,stage:w,drawName:U,drawEntries:T}=b;g.push(b.drawId);let D=n[I],{seedsCount:P,generate:E=!0}=D||{};if(E){let R=T.filter(Ma(Xl)).map(Ma(Xl)),N=v||p;if(r&&P&&P<=R.length&&Te(1,P+1).forEach((k,x)=>{let F={scaleValue:k,scaleName:N,scaleType:xl,eventType:m,scaleDate:f},$=R[x];zw({tournamentRecord:r,participantId:$,scaleItem:F})}),y==null?void 0:y.includes(S))break;let A=Jw({...D,matchUpType:m,seedingScaleName:N,tournamentRecord:r,drawEntries:T,drawName:U,drawId:S,isMock:a,event:o,stage:w});if(A.error)return{error:A.error,drawIds:[]};let{drawDefinition:M}=A;if(!M)return{error:Va};let C=(l=n[I])==null?void 0:l.drawExtensions;if(Array.isArray(C)&&C.filter(ul).forEach(k=>_t({element:M,extension:k})),A=Qw({suppressNotifications:!0,tournamentRecord:r,drawDefinition:M,event:o}),A.error)return{error:A.error,drawIds:[]};if(D!=null&&D.withPlayoffs){let k=(u=M.structures)==null?void 0:u[0].structureId,x=dR({idPrefix:D.idPrefix,...D.withPlayoffs,tournamentRecord:r,drawDefinition:M,structureId:k,isMock:a,event:o});if(x!=null&&x.error)return x}let O=D==null?void 0:D.completionGoal;if((D==null?void 0:D.automated)!==!1&&(e||O)){let k=D==null?void 0:D.matchUpFormat,x=E0({completeAllMatchUps:!O&&e,matchUpStatusProfile:t,randomWinningSide:i,tournamentRecord:r,completionGoal:O,drawDefinition:M,matchUpFormat:k,event:o});if(x.error)return{error:x.error,drawIds:[]};let F=x.completedCount;if((D==null?void 0:D.drawType)===Kl){let $=(c=M.structures)==null?void 0:c.find(B=>B.stage===Ae);if(!$)return{error:Ai};let _=Dv({structureId:$.structureId,tournamentRecord:r,drawDefinition:M,event:o});if(_.error)return{error:_.error,drawIds:[]};let L=O?O-(F??0):void 0;if(_=E0({completeAllMatchUps:!O&&e,completionGoal:O?L:void 0,matchUpStatusProfile:t,randomWinningSide:i,tournamentRecord:r,drawDefinition:M,matchUpFormat:k,event:o}),_.error)return{error:_.error,drawIds:[]}}}}}return{...Q,drawIds:g}}function qte(t){var e,i;let{participantsProfile:r={},uniqueParticipantsCount:n,ratingsParameters:a,tournamentRecord:o,eventProfile:s,eventIndex:l,event:u,uuids:c}=t,{category:d,gender:p,eventType:m}=u,h=Xi(sl)(m)&&Dt||Xi(ho)(m)&&ft||m,f=n[Ae]||0,g=n[Ke]||0,v=(e=s.drawProfiles)!=null&&e.length?f+g:((i=s.participantsProfile)==null?void 0:i.participantsCount)??0,y=[Qt,mi].includes(p)?p:void 0,I=r!=null&&r.idPrefix?`E-${l}-${r==null?void 0:r.idPrefix}`:void 0,{participants:b}=Fv({uuids:s.uuids||c,...r,scaledParticipantsCount:s.scaledParticipantsCount,consideredDate:o==null?void 0:o.startDate,rankingRange:s.rankingRange,participantType:h,participantsCount:v,ratingsParameters:a,category:d,idPrefix:I,sex:y}),S=os({tournamentRecord:o,participants:b});if(S.error)return S;let w=b==null?void 0:b.filter(({participantType:T})=>T===h),U=b==null?void 0:b.map(Tt);return{uniqueDrawParticipants:w,uniqueParticipantIds:U}}function T1e({autoEntryPositions:t,tournamentRecord:e,drawParticipants:i,drawProfile:r,event:n}){let{drawType:a=Ks,qualifyingPositions:o=0,stage:s=Ae,drawSize:l=0,drawName:u,drawId:c}=r,d=l-o,p=i.slice(0,d).map(Tt);if(p.length){let f=Xs({participantIds:p,autoEntryPositions:t,entryStage:s,tournamentRecord:e,event:n});if(f.error)return f}let m=p.map(f=>({entryStatus:ca,entryStage:s,participantId:f})),h=GR({drawName:u||a,qualifyingPositions:o,drawEntries:m,drawId:c,event:n,stage:s});return h.error?h:{...Q}}function Yte({uniqueDrawParticipants:t,autoEntryPositions:e,stageParticipants:i,tournamentRecord:r,drawProfiles:n,category:a,gender:o,event:s}){let l=0;for(let u of n){let{qualifyingPositions:c=0,uniqueParticipants:d,stage:p=Ae,drawSize:m=0}=u,h=m-c,f=d||o||a||p===Ke,g=f?t.slice(l,l+h):i[p||Ae]||[];f&&(l+=h);let v=T1e({autoEntryPositions:e,drawParticipants:g,tournamentRecord:r,drawProfile:u,event:s});if(v.error)return v}return{...Q}}function Kte(t){var e;let{allUniqueParticipantIds:i,matchUpStatusProfile:r,participantsProfile:n,completeAllMatchUps:a,autoEntryPositions:o,hydrateCollections:s,randomWinningSide:l,ratingsParameters:u,tournamentRecord:c,eventProfile:d,eventIndex:p,publish:m,isMock:h,uuids:f}=t,g=d.gender,v=d.eventName,{eventType:y=sl,policyDefinitions:I,drawProfiles:b=[],eventExtensions:S,surfaceCategory:w,tieFormatName:U,processCodes:T,discipline:D,eventLevel:P,timeItems:E,ballType:R,category:N}=d,A=d.eventId||Ht(),M=d.tieFormat||(y===ur?Nu({namedFormat:U,event:{eventId:A,category:N,gender:g},hydrateCollections:s,isMock:h}):void 0),C=c.participants;for(let q of b)!g&&q.gender&&(g=q==null?void 0:q.gender);let{stageParticipantsCount:O,uniqueParticipantsCount:k,uniqueParticipantStages:x}=Gte({drawProfiles:b,category:N,gender:g}),F=Xi(sl)(y)&&Dt||Xi(ho)(y)&&ft||y,{uniqueDrawParticipants:$=[],uniqueParticipantIds:_=[]}=x?qte({event:{eventType:y,category:N,gender:g},uniqueParticipantsCount:k,participantsProfile:n,ratingsParameters:u,tournamentRecord:c,eventProfile:d,eventIndex:p,uuids:f}):{},{eventAttributes:L}=d;typeof L!="object"&&(L={});let B=(N==null?void 0:N.categoryName)||(N==null?void 0:N.ageCategoryCode)||(N==null?void 0:N.ratingType);v=v||B||"Generated Event";let V={...L,surfaceCategory:w,processCodes:T,discipline:D,eventLevel:P,eventName:v,eventType:y,tieFormat:M,ballType:R,category:N,eventId:A,gender:g};if(S!=null&&S.length&&Array.isArray(S)){let q=S.filter(ul);q!=null&&q.length&&Object.assign(V,{extensions:q})}if(Array.isArray(E)&&E.forEach(q=>Bh({event:z,timeItem:q})),typeof I=="object")for(let q of Object.keys(I))rp({policyDefinitions:{[q]:I[q]},event:V});V.category&&(V.category.categoryName=B);let G,j=Mv({suppressNotifications:!1,internalUse:!0,tournamentRecord:c,event:V});if(j.error)return j;let z=j==null?void 0:j.event,{stageParticipants:W}=Hte({allUniqueParticipantIds:i,stageParticipantsCount:O,eventParticipantType:F,targetParticipants:C});if(b!=null&&b.length){let q=Yte({uniqueDrawParticipants:$,autoEntryPositions:o,stageParticipants:W,tournamentRecord:c,drawProfiles:b,category:N,gender:g,event:z});if(q.error)return q;let Y=Wte({matchUpStatusProfile:r,completeAllMatchUps:a,randomWinningSide:l,tournamentRecord:c,drawProfiles:b,isMock:h,event:z});if(Y.error)return Y;G=Y.drawIds}else if((e=d==null?void 0:d.participantsProfile)!=null&&e.participantsCount){let q=$.map(Tt);if(q.length){let Y=Xs({participantIds:q,autoEntryPositions:o,tournamentRecord:c,entryStage:Ae,event:z});if(Y.error)return Y}}return m&&Av({tournamentRecord:c,event:z}),{drawIds:G,eventId:A,uniqueParticipantIds:_}}function q$({tournamentRecords:t,scheduleDate:e,venueId:i,round:r}){if(!ba(e))return{error:Fr};let n="addSchedulingProfileRound",{extension:a}=vt({name:Fm,tournamentRecords:t,discover:!0}),o=(a==null?void 0:a.value)||[],s=o.find(p=>ql(e,p.scheduleDate));if(!s){let{startDate:p,endDate:m}=PR({tournamentRecords:t}),h=new Date(e);if(p&&h<new Date(p)||m&&h>new Date(m))return{error:Fr};s={scheduleDate:e,venues:[]},o.push(s)}let l=s.venues.find(p=>p.venueId===i);l||(l={venueId:i,rounds:[]},s.venues.push(l));let u=["notBeforeTime"],c=p=>Object.keys(p).filter(m=>!u.includes(m)).sort().map(m=>At(p[m])?c(p[m]):p[m]).flat().join("|");if(l.rounds.find(p=>c(p)===c(r)))return te({result:{error:qK},stack:n});l.rounds.push(r);let d=Ev({tournamentRecords:t,schedulingProfile:o});return d.error?d:{...Q}}function D1e({schedulingProfile:t,tournamentRecord:e}){if(typeof t!="object")return{error:se};let i=yv({tournamentRecord:e}).containedStructures,r=Hr({tournamentRecord:e}).matchUps??[],{tournamentId:n}=e,a=[];for(let o of t){let{scheduleDate:s,venues:l=[]}=o;for(let u of l){let{rounds:c,venueId:d}=u;for(let p of c){let{drawId:m,winnerFinishingPositionRange:h,roundSegment:f}=p,g=r.filter(v=>{var y;let I=(h==null?void 0:h.indexOf("-"))>0&&h.split("-").map(S=>+S),b=(y=v.finishingPositionRange)==null?void 0:y.winner;return v.drawId===m&&(!p.roundNumber||v.roundNumber===p.roundNumber)&&(!b||!I||ji(b,I).length===2||dt(b).length===dt(I).length&&ji(b,I).length===dt(b).length)})[0];if(g){let{eventId:v,roundNumber:y,drawName:I,structureName:b,roundName:S}=g,w=g.structureId;y&&!h&&(w=Object.keys(i).find(D=>i[D].includes(w))??w);let U={tournamentId:n,structureId:w,roundNumber:y,roundSegment:f,eventId:v,drawId:m},T=q$({tournamentRecords:{[n]:e},round:U,scheduleDate:s,venueId:d});if(T.error)return T;a.push({structureName:b,roundName:S,drawName:I,...U})}}}}return{scheduledRounds:a}}function iE(t){var e,i,r;let n=We(t,[{drawProfile:!0,_ofType:ta}]);if(n.error)return n;let{allUniqueParticipantIds:a=[],participantsProfile:o={},matchUpStatusProfile:s,completeAllMatchUps:l,autoEntryPositions:u,hydrateCollections:c,randomWinningSide:d,ratingsParameters:p,tournamentRecord:m,isMock:h=!0,drawProfile:f,startDate:g,drawIndex:v,uuids:y}=t,I=Ne(f,!1,!0),{excessParticipantAlternates:b=!0,matchUpFormat:S=zo,drawType:w=Ks,tournamentAlternates:U=0,alternatesCount:T=0,qualifyingPositions:D,qualifyingProfiles:P,generate:E=!0,eventExtensions:R,drawExtensions:N,completionGoal:A,tieFormatName:M,buildTeams:C,seedsCount:O,timeItems:k,drawName:x,category:F,idPrefix:$,publish:_,gender:L,stage:B}=I,V=I.drawSize||(I.ignoreDefaults?void 0:32),G=I.eventId||Ht(),j=f.eventType||f.matchUpType||sl,z=j===ho?ft:Dt,W=At(f.tieFormat)&&f.tieFormat||j===Xt&&Nu({event:{eventId:G,category:F,gender:L},namedFormat:M,hydrateCollections:c,isMock:h})||void 0,q=(F==null?void 0:F.categoryName)||(F==null?void 0:F.ageCategoryCode)||(F==null?void 0:F.ratingType),Y=f.eventName||q||`Generated ${j}`,re=(m==null?void 0:m.participants)||[],K=((P==null?void 0:P.map(me=>me.structureProfiles||[]).flat().reduce((me,fe)=>{let pe=!fe.participantsCount||fe.participantsCount>fe.drawSize?fe.drawSize:fe.participantsCount||0;return me+pe},0))||0)*(z===ft?2:1),H=(!f.participantsCount||f.participantsCount>V?V:f.participantsCount)||0,Z={eventName:Y,eventType:j,tieFormat:W,category:F,eventId:G,gender:L};Array.isArray(k)&&k.forEach(me=>Bh({event:Z,timeItem:me}));let{eventAttributes:X}=f;if(typeof X!="object"&&(X={}),Object.assign(Z,X),(R==null?void 0:R.length)&&Array.isArray(R)){let me=R.filter(ul);me!=null&&me.length&&Object.assign(Z,{extensions:me})}let ie=[];if((o==null?void 0:o.participantsCount)===0||f.uniqueParticipants||K||!m||L||F){let me=(H||0)+T+K,fe=me,pe={[Qt]:0,[mi]:0},Fe,De;j===Xt&&({teamSize:Fe,genders:De}=z$({alternatesCount:T,tieFormatName:M,tieFormat:W,drawSize:V}),Object.keys(De).forEach(he=>{[Qt,mi].includes(he)&&De[he]&&(pe[he]=V*De[he])}),fe=Fe*((V||0)+K));let je=o!=null&&o.idPrefix?`D-${v}-${o==null?void 0:o.idPrefix}`:void 0,ue=Fv({...o,scaledParticipantsCount:f.scaledParticipantsCount||o.scaledParticipantsCount,participantsCount:fe,consideredDate:m==null?void 0:m.startDate,sex:L||(o==null?void 0:o.sex),rankingRange:f.rankingRange,uuids:f.uuids||y,ratingsParameters:p,participantType:z,gendersCount:pe,idPrefix:je,category:F}).participants;if(Z.category&&(Z.category.categoryName=q),m){let he=os({participants:ue,tournamentRecord:m});if(he.error)return he}if(ue.forEach(({participantId:he})=>ie.push(he)),re=ue,j===Xt){let he=De[Qt]?ue.filter(({participantType:Be,person:nt})=>Be===Dt&&(nt==null?void 0:nt.sex)===Qt).map(Tt):[],Re=De[mi]?ue.filter(({participantType:Be,person:nt})=>Be===Dt&&(nt==null?void 0:nt.sex)===mi).map(Tt):[],xe=ue.filter(({participantType:Be})=>Be===Dt).map(Tt).filter(Be=>!he.includes(Be)&&!Re.includes(Be)),Ee=[...I.teamNames??[],...R0({count:me}).names],we=Fe-(De[Qt]+De[mi]),Ue=0,wt=0,Le=0,rt=Te(0,me).map(Be=>{let nt=Re.slice(Ue,Ue+De[mi]),Ii=he.slice(wt,wt+De[Qt]),be=xe.slice(Le,Le+we);Ue+=De[mi],wt+=De[Qt],Le+=we;let Ct=C!==!1?[...nt,...Ii,...be]:[];return{participantName:Ee[Be]||`Team ${Be+1}`,participantOtherName:`TM${Be+1}`,participantRole:en,individualParticipantIds:Ct,participantType:Xt,participantId:Ht()}}),Ei=os({participants:rt,tournamentRecord:m});if(!Ei.success)return Ei;re=rt}}let ae=me=>{let{participantType:fe}=me;return Xi(sl)(j)&&fe===Dt||Xi(ho)(j)&&fe===ft?!0:j===Xt&&fe===Xt},le=me=>{var fe,pe;return!f.gender||((fe=me.person)==null?void 0:fe.sex)===f.gender?!0:(pe=me.individualParticipantIds)==null?void 0:pe.some(Fe=>{let De=re.find(je=>je.participantId===Fe);return De&&le(De)})},ne=re.filter(ae).filter(le).filter(({participantId:me})=>!a.includes(me)),de=ne.slice(0,H).map(me=>me.participantId);if(h&&de!=null&&de.length){let me=Xs({autoEntryPositions:u,entryStage:B,tournamentRecord:m,participantIds:de,event:Z});if(me.error)return me}let ye=K?ne.slice(H,H+K).map(me=>me.participantId):0;if(h&&ye!=null&&ye.length){let me=0,fe=1,pe=(De,je)=>De.stageSequence-je.stageSequence,Fe=(De,je)=>De.roundTarget-je.roundTarget;for(let De of P.sort(Fe)){fe=De.roundTarget||fe;let je=1,ue;for(let he of De.structureProfiles.sort(pe)){let Re=(he.drawSize||jx(he.participantsCount))-(ue||0),xe=ye.slice(me,me+Re),Ee=Xs({entryStage:Ke,entryStageSequence:je,autoEntryPositions:u,tournamentRecord:m,participantIds:xe,roundTarget:fe,event:Z});if(Ee.error)return Ee;ue=he.qualifyingPositions,me+=Re,je+=1}fe+=1}}let ce=b&&((e=m==null?void 0:m.participants)==null?void 0:e.filter(({participantId:me})=>!de.includes(me)).filter(ae).filter(le).slice(0,T||V-H||U).map(me=>me.participantId));if(h&&ce!=null&&ce.length){let me=Xs({participantIds:ce,autoEntryPositions:!1,entryStatus:qo,tournamentRecord:m,event:Z});if(me.error)return me.error}let ke=q||Y;m&&O&&O<=de.length&&Te(1,O+1).forEach((me,fe)=>{let pe={scaleName:ke,scaleDate:g,scaleType:SL,scaleValue:me,eventType:j},Fe=de[fe];zw({tournamentRecord:m,participantId:Fe,scaleItem:pe})});let Pe=Jw({...Ne(f,!1,!0),tournamentRecord:m,seedingScaleName:ke,matchUpFormat:S,eventId:G,isMock:h,event:Z});if(Pe.error)return Pe;if(!Pe.drawDefinition)return{error:Va};let{drawDefinition:it}=Pe,It=it.drawId;if(Array.isArray(N)&&N.filter(ul).forEach(me=>_t({element:it,extension:me})),E){if(Qw({drawDefinition:it,event:Z,suppressNotifications:!0}),f.withPlayoffs){let fe=(i=it.structures)==null?void 0:i[0].structureId,pe=dR({...f.withPlayoffs,tournamentRecord:m,drawDefinition:it,structureId:fe,idPrefix:$,isMock:h,event:Z});if(pe!=null&&pe.error)return pe}let me=f.automated===!1;if(h&&!me){let fe=pe=>{var Fe;let De=E0({completeAllMatchUps:pe.completeAllMatchUps,completionGoal:pe.completionGoal,matchUpStatusProfile:s,randomWinningSide:d,tournamentRecord:m,drawDefinition:it,matchUpFormat:S,event:Z});if(De.error)return De;let je=De.completedCount;if(w===Kl){let ue=(Fe=it.structures)==null?void 0:Fe.find(xe=>xe.stage===Ae);if(!ue)return{error:Ai};Dv({structureId:ue.structureId,tournamentRecord:m,drawDefinition:it,event:Z});let he=A?A-(je??0):void 0,Re=E0({completionGoal:A?he:void 0,matchUpStatusProfile:s,completeAllMatchUps:l,randomWinningSide:d,tournamentRecord:m,drawDefinition:it,matchUpFormat:S,event:Z});if(Re.error)return Re}};if(A&&fe({completionGoal:A}),f.outcomes){let{matchUps:pe}=Pn({inContext:!0,drawDefinition:it,event:Z});for(let Fe of f.outcomes){let{matchUpStatus:De=Ki,matchUpStatusCodes:je,stageSequence:ue=1,matchUpIndex:he=0,structureOrder:Re,matchUpFormat:xe,drawPositions:Ee,roundPosition:we,stage:Ue=Ae,roundNumber:wt,winningSide:Le,scoreString:rt}=Fe,Ei=(pe==null?void 0:pe.reduce((be,Ct)=>{let{structureId:Ce,matchUpId:qe}=Ct;return be[Ce]?be[Ce].push(qe):be[Ce]=[qe],be},{}))??[],Be=Object.assign({},...Object.keys(Ei).map((be,Ct)=>({[be]:Ct+1}))),nt=(r=pe==null?void 0:pe.filter(be=>(!Ue||be.stage===Ue)&&(!ue||be.stageSequence===ue)&&(!wt||be.roundNumber===wt)&&(!we||be.roundPosition===we)&&(!Re||Be[be.structureId]===Re)&&(!Ee||ji(Ee,be.drawPositions).length===2)))==null?void 0:r[he],Ii=zte({matchUpStatusCodes:je,tournamentRecord:m,drawDefinition:it,targetMatchUp:nt,matchUpFormat:xe,matchUpStatus:De,scoreString:rt,winningSide:Le});if(Ii!=null&&Ii.error)return Ii}}l&&fe({completeAllMatchUps:l})}_&&Av({tournamentRecord:m,event:Z})}else{let me=GR({drawEntries:it.entries,drawName:x||w,qualifyingPositions:D,drawId:It,event:Z,stage:B});if(me.error)return me}return{...Q,event:He(Z),uniqueParticipantIds:ie,targetParticipants:re,drawDefinition:it,eventId:G,drawId:It}}var Xte=()=>({altitude:void 0,courtId:void 0,courtName:"",courtDimensions:void 0,latitude:void 0,longitude:void 0,surfaceCategory:void 0,surfaceType:void 0,surfacedDate:void 0,dateAvailability:[],onlineResources:[],pace:void 0,notes:void 0}),P1e=Xte;function C0(t){return parseInt(t)}function dj({startTime:t="",endTime:e=""}={}){if(!t||!e||!Dd.test(t)||!Dd.test(e))return!1;let[i,r]=t.split(":").map(C0),[n,a]=e.split(":").map(C0);return n<i?!1:!(i===n&&a<r)}function R1e(t,e){let[i,r]=t.startTime.split(":").map(C0),[n,a]=e.startTime.split(":").map(C0);return i<n?-1:i>n?1:r<a?-1:r>a?1:0}function Jte({dateAvailability:t}){if(!t)return{error:l9};if(!Array.isArray(t))return{error:YU};let e="Dates must be formated => YYYY-MM-DD",i="Times must be 24 hour => 00:00";for(let r of t){if(typeof r!="object")return{error:YU};let{date:n,startTime:a,endTime:o,bookings:s=[]}=r;if(!a||!o)return{error:YU};if(n&&!ol.test(n))return{error:Fr,dateAvailability:{date:n},info:e};if(!Dd.test(a))return{error:Ao,dateAvailability:{startTime:a},info:i};if(!Dd.test(o))return{error:Ao,dateAvailability:{endTime:o},info:i};if(a===o)return{error:Ao,dateAvailability:{startTime:a,endTime:o},info:"startTime and endTime are equivalent"};if(!dj({startTime:a,endTime:o}))return{error:Ao,dateAvailability:{startTime:a,endTime:o},info:"endTime must be after startTime"};if(s){if(!Array.isArray(s))return{error:JS};for(let l of s){if(typeof l!="object")return{error:JS};let{startTime:u,endTime:c}=l;if(!Dd.test(u))return{error:Ao,booking:{startTime:u},info:i};if(!Dd.test(c))return{error:Ao,booking:{endTime:c},info:i};if(u===c)return{error:Ao,dateAvailability:{startTime:u,endTime:c},info:"startTime and endTime are equivalent"};if(!dj({startTime:u,endTime:c}))return{error:Ao,dateAvailability:{startTime:u,endTime:c},info:"endTime must be after startTime"}}}}return{valid:!0}}function rE({tournamentRecord:t,disableNotice:e,venueId:i,courtId:r,court:n}){let{venue:a}=nu({tournamentRecord:t,venueId:i});if(!a)return{error:bh};a.courts||(a.courts=[]);let o={...Xte(),venueId:i,courtId:r};if(o.courtId||(o.courtId=Ht()),a.courts.some(s=>s.courtId===o.courtId))return{error:D9};{let s=((n==null?void 0:n.dateAvailability)||[]).map(c=>{var d;return{...c,date:mt(c.date),startTime:Ui(c.startTime),endTime:Ui(c.endTime),bookings:(d=c.bookings)==null?void 0:d.map(({startTime:p,endTime:m,bookingType:h})=>({startTime:Ui(p),endTime:Ui(m),bookingType:h}))}}),l=Object.keys(o);for(let c of l)if(n!=null&&n[c])if(c==="dateAvailability"){let d=Jte({dateAvailability:s});if(!d.valid&&d.error)return d;o.dateAvailability=s}else o[c]=n[c];let u=o;return a.courts.push(u),e||ut({payload:{venue:a,tournamentId:t.tournamentId},topic:Ep,key:a.venueId}),{...Q,court:Ne(o),venueId:i}}}function Y$(t){let{tournamentRecord:e,venueId:i}=t;if(typeof i!="string"||!i)return{error:Zc};let r=t.tournamentRecords??(e&&{[e.tournamentId]:e})??{},n=[],a;for(let o of Object.values(r)){let{venue:s}=nu({tournamentRecord:o,venueId:i});if(s){let l=E1e({...t,tournamentRecord:o});for(let u of(l==null?void 0:l.courts)??[])n.push(u==null?void 0:u.courtId);if(l.error)return l;a=!0}}return a?{...Q,courtIds:n}:{error:bh}}function E1e({courtNameRoot:t="Court",dateAvailability:e=[],venueAbbreviationRoot:i,tournamentRecord:r,courtNames:n=[],courtTimings:a,courtsCount:o,startTime:s,courtIds:l,endTime:u,idPrefix:c,venueId:d,dates:p}){if(!d)return{error:Zc};let m=nu({tournamentRecord:r,venueId:d});if(m.error)return m;let{venue:h}=m;if(!_i(o)||!n)return{error:T9};o=o??n.length;let f=Te(0,o).map(g=>{let v=a==null?void 0:a[g],y=v?p.map(I=>({date:Ho(I),startTime:s,endTime:u,...v})):e;return v&&s&&u&&y.push({startTime:s,endTime:u}),{courtName:n[g]||i&&(h==null?void 0:h.venueAbbreviation)&&`${h==null?void 0:h.venueAbbreviation} ${g+1}`||`${t} ${g+1}`,dateAvailability:y}}).map((g,v)=>{let y=(l==null?void 0:l.pop())||c&&`${c}-${v+1}`;return rE({disableNotice:!0,tournamentRecord:r,courtId:y,venueId:d,court:g})}).map(g=>g.court).filter(Boolean);return f.length!==o?te({info:"not all courts could be generated",result:{error:se}}):(h&&ut({payload:{venue:h,tournamentId:r.tournamentId},topic:Ep,key:h.venueId}),{...Q,courts:Ne(f)})}function K$({tournamentRecord:t,ignoreExistingVenues:e,venueProfiles:i,uuids:r}){let{startDate:n,endDate:a}=t,o=[];for(let[s,l]of i.entries()){let{venueAbbreviation:u,venueId:c=(r==null?void 0:r.pop())??Ht(),dateAvailability:d,startTime:p="07:00",endTime:m="19:00",courtTimings:h,courtsCount:f,courtNames:g,venueName:v,idPrefix:y,courtIds:I}=l,b={venueName:v||`Venue ${s+1}`,venueAbbreviation:u,venueId:c},S=Uw({tournamentRecord:t,venue:b});if(S.error){if(e)continue;return S}o.push(c);let w=Zf(n,a),U=!Array.isArray(d)&&[{startTime:p,endTime:m}].concat(w.map(T=>({date:Ho(T),startTime:p,endTime:m})));if(f||g){let T=Y$({dateAvailability:d||U,tournamentRecord:t,courtTimings:h,courtsCount:f,courtNames:g,startTime:p,idPrefix:y,courtIds:I,endTime:m,venueId:c,dates:w});if(T.error)return T}}return o}function C1e(t){var e,i,r;let{tournamentRecord:n,leagueProfiles:a,eventIds:o,venueIds:s,drawIds:l,allUniqueParticipantIds:u,uuids:c}=t,d=0;for(let m of a){let h=[],{tieFormatName:f=r0,teamProfiles:g=[],teamsCount:v=0,category:y,idPrefix:I,gender:b}=m,S=m.leagueName??m.eventName??`League ${d+1}`,w=m.leagueId??m.eventId??(c==null?void 0:c.pop())??Ht();o.push(w);let U=At(m.tieFormat)&&m.tieFormat||Nu({event:{eventId:w,category:y,gender:b},namedFormat:f,isMock:t.isMock})||void 0;if(!U)return{error:lv};let T=Math.max(v,g.length),D=Te(0,T),{genders:P,teamSize:E}=z$({tieFormat:U,drawSize:T}),R={[mi]:0,[jn]:0,[Td]:0,[Qt]:0,[As]:0};Object.keys(P).forEach(A=>R[A]+=P[A]);for(let A of D){let M=((e=g==null?void 0:g[A])==null?void 0:e.teamName)??`Team ${A+1}`,C=((i=g==null?void 0:g[A])==null?void 0:i.teamId)||(c==null?void 0:c.pop())||Ht(),O=m.startDate??t.startDate,k=Fv({...m==null?void 0:m.participantsProfile,participantsCount:E,consideredDate:O,gendersCount:R,category:y,gender:b,uuids:c}).participants,x=k.map(V=>V.participantId),F=Xt,$=C??P0({participantType:F,idPrefix:I,index:A,uuids:c});h.push({participantId:$,entryStatus:ca,entryStage:Ae});let _=((r=g==null?void 0:g[A])==null?void 0:r.venueIds)??[],L={participantId:$,participantRole:en,participantName:M,individualParticipantIds:x,participantType:F,homeVenueIds:_};_.forEach(V=>!s.includes(V)&&s.push(V)),u.push(...x),u.push($);let B=os({participants:[L,...k],tournamentRecord:n});if(B.error)return B}let N={eventName:S,entries:h,eventType:Xt,tieFormat:U,category:y,eventId:w,gender:b};if(n.events||(n.events=[]),n.events.push(N),h.length){let A=(_i(m.roundsCount)&&m.roundsCount)??m.roundsCount===ISe?(T-1)*2:T-1,M=Jw({automated:m.automated,tournamentRecord:n,drawType:Ga,roundsCount:A,drawSize:T,event:N});if(M.error)return M;let{drawDefinition:C}=M;if(C){let O=C==null?void 0:C.drawId;Qw({drawDefinition:C,event:N,suppressNotifications:!0}),l.push(O)}}d++}let p=s.map(m=>({venueId:m}));K$({tournamentRecord:n,ignoreExistingVenues:!0,venueProfiles:p,uuids:c})}var M1e=["Generated Tournament","CourtHive Challenge","Replication Crisis","Open Competition","Factory Follies","Mock Tournament","Atomic Culture","Racket Rally","Stats Fail"];function Qte(t){var e,i,r;let{startDate:n,endDate:a}=t??{},{tournamentName:o=ga(M1e),ratingsParameters:s=Tr,tournamentExtensions:l,policyDefinitions:u,schedulingProfile:c,venueProfiles:d,uuids:p}=t??{},m=(t==null?void 0:t.isMock)===!1?void 0:!0;if(n&&!ba(n)||a&&!ba(a))return{error:Fr};if(t.leagueProfiles&&!Array.isArray(t.leagueProfiles)||t.eventProfiles&&!Array.isArray(t.eventProfiles)||t.drawProfiles&&!Array.isArray(t.drawProfiles))return{error:se};if(!n){let S=new Date;n=Ho(a??S),a=Ho(S.setDate(S.getDate()+7))}if(!a){let S=new Date(n);a=Ho(S.setDate(S.getDate()+7))}let h=tE({...t.tournamentAttributes??{},tournamentName:o,startDate:n,endDate:a,isMock:m}),f=d!=null&&d.length?K$({tournamentRecord:h,venueProfiles:d,uuids:p}):[];if(l!=null&&l.length&&Array.isArray(l)){let S=l.filter(w=>ul({extension:w}));S!=null&&S.length&&Object.assign(h,{extensions:S,isMock:m})}if(typeof u=="object")for(let S of Object.keys(u))rp({policyDefinitions:{[S]:u[S]},tournamentRecord:h});if(!((e=t==null?void 0:t.leagueProfiles)!=null&&e.length)||(i=t.eventProfiles)!=null&&i.length||(r=t.drawProfiles)!=null&&r.length||t.participantsProfile){let S=jte({tournamentRecord:h,...t});if(!S.success)return S}let g=[],v=[],y=[];if(t.leagueProfiles){let S=C1e({allUniqueParticipantIds:g,tournamentRecord:h,...t,eventIds:v,venueIds:f,drawIds:y});if(S!=null&&S.error)return S}if(t.drawProfiles){let S=N1e({allUniqueParticipantIds:g,ratingsParameters:s,tournamentRecord:h,...t,eventIds:v,drawIds:y});if(S!=null&&S.error)return S}if(t.eventProfiles){let S=A1e({allUniqueParticipantIds:g,ratingsParameters:s,tournamentRecord:h,...t,eventIds:v,drawIds:y});if(S!=null&&S.error)return S}let{scheduledRounds:I=void 0,schedulerResult:b={}}=c?O1e({...t,tournamentRecord:h}):{};return IF(),He({...Q,tournamentRecord:h,scheduledRounds:I,schedulerResult:b,eventIds:v,venueIds:f,drawIds:y})}function N1e(t){let{tournamentRecord:e,drawProfiles:i,allUniqueParticipantIds:r,eventIds:n,drawIds:a}=t,o=0;for(let s of i){let l=iE({allUniqueParticipantIds:r,tournamentRecord:e,drawProfile:s,drawIndex:o,...t});if(l.error)return l;let{drawId:u,eventId:c,event:d,uniqueParticipantIds:p}=l;if((s==null?void 0:s.addEvent)!==!1){if(l=Mv({suppressNotifications:!1,internalUse:!0,tournamentRecord:e,event:d}),l.error)return l;u&&a.push(u),n.push(c)}p!=null&&p.length&&r.push(...p),o+=1}}function A1e(t){let{eventProfiles:e,allUniqueParticipantIds:i,eventIds:r,drawIds:n}=t,a=0;for(let o of e){let s=Kte({...t,eventIndex:a,eventProfile:o});if(s.error)return s;let{eventId:l,drawIds:u,uniqueParticipantIds:c}=s;u&&n.push(...u),r.push(l),c!=null&&c.length&&i.push(...c),a+=1}}function O1e(t){let{schedulingProfile:e,tournamentRecord:i,autoSchedule:r,periodLength:n,scheduleCompletedMatchUps:a}=t,o=D1e({schedulingProfile:e,tournamentRecord:i});if(o.error)return o;let s=o.scheduledRounds;if(r){let{tournamentId:l}=i,u={[l]:i};return{schedulerResult:eE({scheduleCompletedMatchUps:a,tournamentRecords:u,periodLength:n}),scheduledRounds:s}}return{scheduledRounds:s}}var Zte={};bt(Zte,{anonymizeTournamentRecord:()=>eie,modifyTournamentRecord:()=>tie});function eie({keepExtensions:t=[],anonymizeParticipantNames:e=!0,tournamentRecord:i,tournamentName:r,personIds:n=[],tournamentId:a}){var o,s,l,u,c;if(!i)return{error:ve};let d=Array.isArray(t)?U2.concat(...t):U2,p=L=>{var B;return Array.isArray(t)?(B=L==null?void 0:L.extensions)==null?void 0:B.filter(V=>d.includes(V.name)):L==null?void 0:L.extensions},m={};i.extensions=p(i);let h=a||Ht();m[i.tournamentId]=h,i.tournamentId=h,i.createdAt=new Date().toISOString(),i.tournamentName=r||`Anonymized: ${Ho(new Date)}`,i.isMock=!0,delete i.parentOrganisation;for(let L of i.participants||[]){L.extensions=p(L),L.onlineResources=[];let B=Ht();m[L.participantId]=B,L.participantId=B}for(let L of i.participants||[])Array.isArray(L.individualParticipantIds)&&(L.individualParticipantIds=L.individualParticipantIds.map(B=>m[B]));let f=0;for(let L of i.venues||[]){L.venueAbbreviation=`V${f}`,L.extensions=p(L),L.venueName=`Venue #${f}`,L.onlineResources=[],L.addresses=[];let B=Ht();m[L.venueId]=B,L.isMock=!0,f+=1;let V=0;for(let G of L.courts||[])G.courtName=`V${f}C${V}`,G.extensions=p(G),G.onlineResources=[],G.isMock=!0,V+=1}let g=1;for(let L of i.events||[]){L.extensions=p(L),L.onlineResources=[],L.isMock=!0;let B=Ht();m[L.eventId]=B,L.eventId=B;let V=((o=L.category)==null?void 0:o.categoryName)||((s=L.category)==null?void 0:s.ageCategoryCode)||((l=L.category)==null?void 0:l.ratingType)||L.gender;if(L.eventName=`Event ${g} ${V}`,Array.isArray(L.entries))for(let j of L.entries)j.participantId=m[j.participantId];for(let j of L.drawDefinitions||[]){j.extensions=p(j);let z=Ht();if(m[j.drawId]=z,j.drawId=z,j.isMock=!0,Array.isArray(j.entries))for(let q of j.entries)q.participantId=m[q.participantId];let W=q=>{q.extensions=p(q);let Y=Ht();m[q.structureId]=Y,q.structureId=Y;for(let re of q.positionAssignments||[])re.participantId&&(re.participantId=m[re.participantId]);for(let re of q.seedAssignments||[])re.participantId&&(re.participantId=m[re.participantId]);for(let re of q.matchUps||[]){re.isMock=!0;for(let K of re.sides||[])K.lineUp&&(K.lineUp=K.lineUp.map(({participantId:H,collectionAssignments:Z})=>({participantId:m[H],collectionAssignments:Z})))}};for(let q of j.structures||[])if(W(q),Array.isArray(q.structures))for(let Y of q.structures)W(Y);for(let q of j.links||[])q.source.structureId=m[q.source.structureId],q.target.structureId=m[q.target.structureId]}let{extension:G}=vt({name:rs,element:L});Array.isArray((u=G==null?void 0:G.value)==null?void 0:u.flights)&&((c=G==null?void 0:G.value.flights)==null||c.forEach(j=>{if(j.drawId=m[j.drawId],Array.isArray(j.drawEntries))for(let z of j.drawEntries)z.participantId=m[z.participantId]})),g+=1}let v=i.startDate||Ho(new Date),y=(i.participants||[]).filter(({participantType:L})=>L===Dt),I=y.reduce((L,B)=>{var V;let G=(V=B.person)==null?void 0:V.sex;return[Qt,mi].includes(G)?L[G]+=1:L[Td]+=1,L},{[Qt]:0,[mi]:0,[Td]:0}),b=Object.assign({},...Object.keys(I).map(L=>{var B;return{[L]:((B=Vte({category:{ageCategoryCode:"O18"},count:I[L],addressProps:{citiesCount:10},personExtensions:[],consideredDate:v,sex:L}))==null?void 0:B.persons)||[]}})),S={[Qt]:0,[mi]:0,[Td]:0},w=y.length,U=y.reduce((L,B)=>{var V,G;let j=((G=(V=B.person)==null?void 0:V.addresses)==null?void 0:G[0])||{},{city:z,state:W,postalCode:q}=j;return L.cities.includes(z)||L.cities.push(z),L.states.includes(W)||L.states.push(W),L.postalCodes.includes(q)||L.postalCodes.push(q),L},{cities:[],postalCodes:[],states:[]}),T=U.postalCodes.length,D=U.cities.length,P=U.states.length,{cities:E}=Lte({count:D||w,participantsCount:w}),{states:R}=_te({count:P||w,participantsCount:w}),{postalCodes:N}=$te({count:T||w,participantsCount:w}),A={cities:E,states:R,postalCodes:N};y.forEach((L,B)=>{var V,G;let j=L==null?void 0:L.person,z=(j==null?void 0:j.sex)||Td,W=(V=mt(j==null?void 0:j.birthDate))==null?void 0:V.split("-")[0],q=S[z],Y=b[z][q];if(S[z]+=1,W){let[,re,K]=((G=Y==null?void 0:Y.birthDate)==null?void 0:G.split("-"))||[],H=[W,re,K].join("-");Y.birthDate=H}if(j!=null&&j.addresses){let re=Bte({...A,participantIndex:B,nationalityCode:Y.nationalityCode});Y.addresses=[re]}Y.personId=(n==null?void 0:n[B])||Ht(),e?(Y.standardFamilyName=Y.lastName,Y.standardGivenName=Y.firstName,L.participantName=`${Y.standardGivenName} ${Y.standardFamilyName}`):(Y.standardFamilyName=j==null?void 0:j.standardFamilyName,Y.standardGivenName=j==null?void 0:j.standardGivenName),delete Y.firstName,delete Y.lastName,Y.extensions=p(j),L.person=Y,m[j==null?void 0:j.personId]=Y.personId}),(i.participants||[]).filter(({participantType:L})=>L===ft).forEach(L=>{let{individualParticipantIds:B}=L;L.participantName=k1e({individualParticipantIds:B,individualParticipants:y})});let M=(i.participants||[]).filter(({participantType:L})=>L===Xt),C=M.length,O=R0({count:C}).names;M.forEach((L,B)=>{L.participantName=O[B]});let k=(i.participants||[]).filter(({participantType:L})=>L===Ja),x=k.length,F=R0({count:x,nameRoot:"Group"}).names;k.forEach((L,B)=>{L.participantName=F[B]});let{extension:$}=vt({element:i,name:Fm});Array.isArray($==null?void 0:$.value)&&($==null||$.value.forEach(L=>{L.tournamentId=m[L.tournamentId],L.structureId=m[L.structureId],L.eventId=m[L.eventId],L.drawId=m[L.drawId]}));let{extension:_}=vt({element:i,name:vv});return Array.isArray(_==null?void 0:_.value)&&(_==null||_.value.forEach(L=>{L.personId=m[L.personId]})),{...Q}}function k1e({individualParticipantIds:t,individualParticipants:e}){let i=e.filter(({participantId:r})=>t.includes(r)).map(({person:r})=>r==null?void 0:r.standardFamilyName).filter(Boolean).sort().join("/");return t.length===1&&(i+="/Unknown"),i}function tie(t){var e,i,r;let{ratingsParameters:n=Tr,participantsProfile:a={},matchUpStatusProfile:o,completeAllMatchUps:s,autoEntryPositions:l,hydrateCollections:u,randomWinningSide:c,schedulingProfile:d,tournamentRecord:p,autoSchedule:m,eventProfiles:h,periodLength:f,venueProfiles:g,drawProfiles:v,isMock:y,uuids:I}=t;if(!p)return{error:ve};let b=[],S=[],w=[];h==null||h.forEach(R=>{var N;let A=(N=p.events)==null?void 0:N.find((M,C)=>R.eventIndex!==void 0&&C===R.eventIndex||R.eventName&&M.eventName===R.eventName||R.eventId&&M.eventId===R.eventId);A!=null&&A.gender&&(R.gender=A.gender)});let U=((e=p.participants)==null?void 0:e.length)||void 0;U&&a!=null&&a.idPrefix&&(a.idPrefix=`${a.idPrefix}-${U}`);let T=jte({startDate:p.startDate,participantsProfile:a,tournamentRecord:p,eventProfiles:h,drawProfiles:v,uuids:I});if(!T.success)return T;if(h){let R=((i=p.events)==null?void 0:i.length)||0;for(let N of h){let{ratingsParameters:A}=N,M=(r=p.events)==null?void 0:r.find((C,O)=>N.eventIndex!==void 0&&O===N.eventIndex||N.eventName&&C.eventName===N.eventName||N.eventId&&C.eventId===N.eventId);if(M){let{gender:C,category:O,eventType:k}=M,{drawProfiles:x,publish:F}=N,$=Xi(sl)(k)&&Dt||Xi(ho)(k)&&ft||k;if(x){let{stageParticipantsCount:_,uniqueParticipantsCount:L,uniqueParticipantStages:B}=Gte({drawProfiles:x,category:O,gender:C}),{uniqueDrawParticipants:V=[],uniqueParticipantIds:G=[]}=B?qte({event:{eventType:k,category:O,gender:C},uniqueParticipantsCount:L,participantsProfile:a,ratingsParameters:A,tournamentRecord:p,eventProfile:N,uuids:I}):{};b.push(...G);let{stageParticipants:j}=Hte({targetParticipants:p.participants||[],allUniqueParticipantIds:b,stageParticipantsCount:_,eventParticipantType:$}),z=Yte({uniqueDrawParticipants:V,autoEntryPositions:l,stageParticipants:j,tournamentRecord:p,drawProfiles:x,category:O,gender:C,event:M});if(z.error||(z=Wte({matchUpStatusProfile:o,completeAllMatchUps:s,randomWinningSide:c,tournamentRecord:p,drawProfiles:x,isMock:y,event:M}),z.error))return z;w.push(...z.drawIds)}F&&Av({tournamentRecord:p,event:M})}else{let C=Kte({startDate:p.startDate,allUniqueParticipantIds:b,matchUpStatusProfile:o,participantsProfile:a,completeAllMatchUps:s,autoEntryPositions:l,randomWinningSide:c,ratingsParameters:A,tournamentRecord:p,eventProfile:N,eventIndex:R,uuids:I});if(C.error)return C;let{eventId:O,drawIds:k,uniqueParticipantIds:x}=C;k&&w.push(...k),S.push(O),x!=null&&x.length&&b.push(...x),R+=1}}}if(v){let R=(p.events||[]).map(N=>{var A;return((A=N.drawDefinitions)==null?void 0:A.map(()=>1))||[]}).flat().reduce((N,A)=>N+A,0);for(let N of v){let A=iE({startDate:p.startDate,allUniqueParticipantIds:b,matchUpStatusProfile:o,participantsProfile:a,completeAllMatchUps:s,autoEntryPositions:l,hydrateCollections:u,randomWinningSide:c,ratingsParameters:n,tournamentRecord:p,drawProfile:N,drawIndex:R,uuids:I});if(A.error)return A;let{drawId:M,eventId:C,event:O,uniqueParticipantIds:k}=A;if(A=Mv({tournamentRecord:p,event:O,internalUse:!0}),A.error)return A;M&&w.push(M),S.push(C),k!=null&&k.length&&b.push(...k),R+=1}}let D=g!=null&&g.length?K$({tournamentRecord:p,venueProfiles:g}):[],P,E={};if(d!=null&&d.length){let R={[p.tournamentId]:p},N=Ev({tournamentRecords:R,schedulingProfile:d});if(N.error)return N;if(m){let{tournamentId:A}=p,M={[A]:p};E=eE({tournamentRecords:M,periodLength:f})}}return{totalParticipantsCount:p.participants.length,scheduledRounds:P,schedulerResult:E,...Q,eventIds:S,venueIds:D,drawIds:w}}var iie={};bt(iie,{addDynamicRatings:()=>w_,addIndividualParticipantIds:()=>qR,addParticipant:()=>pl,addParticipants:()=>os,addPenalty:()=>Sie,addPersonRequests:()=>lie,addPersons:()=>Tie,createGroupParticipant:()=>hie,createTeamsFromParticipantAttributes:()=>H$,deleteParticipants:()=>Lh,filterParticipants:()=>Ew,findParticipant:()=>mie,getCompetitionParticipants:()=>x_,getPairedParticipant:()=>as,getParticipantEventDetails:()=>F_,getParticipantMembership:()=>L_,getParticipantScaleItem:()=>hg,getParticipantSchedules:()=>__,getParticipantSignInStatus:()=>$_,getParticipantTimeItem:()=>hL,getParticipants:()=>Oi,getScaleValues:()=>fv,mergeParticipants:()=>Uie,modifyIndividualParticipantIds:()=>uie,modifyParticipant:()=>YR,modifyParticipantName:()=>fie,modifyParticipantOtherName:()=>die,modifyParticipantsSignInStatus:()=>cie,modifyPenalty:()=>bie,modifyPersonRequests:()=>oie,mutate:()=>rie,participantScaleItem:()=>Ll,query:()=>aee,regenerateParticipantNames:()=>pie,removeIndividualParticipantIds:()=>OL,removeParticipantIdsFromAllTeams:()=>tR,removePenalty:()=>Iie,removePersonRequests:()=>sie,removeRatings:()=>vie,scaledTeamAssignment:()=>gie,setParticipantScaleItem:()=>zw,setParticipantScaleItems:()=>ZQ,validateLineUp:()=>rR});var rie={};bt(rie,{addDynamicRatings:()=>w_,addIndividualParticipantIds:()=>qR,addParticipant:()=>pl,addParticipants:()=>os,addPenalty:()=>Sie,addPersonRequests:()=>lie,addPersons:()=>Tie,createGroupParticipant:()=>hie,createTeamsFromParticipantAttributes:()=>H$,deleteParticipants:()=>Lh,findParticipant:()=>mie,mergeParticipants:()=>Uie,modifyIndividualParticipantIds:()=>uie,modifyParticipant:()=>YR,modifyParticipantName:()=>fie,modifyParticipantOtherName:()=>die,modifyParticipantsSignInStatus:()=>cie,modifyPenalty:()=>bie,modifyPersonRequests:()=>oie,regenerateParticipantNames:()=>pie,removeIndividualParticipantIds:()=>OL,removeParticipantIdsFromAllTeams:()=>tR,removePenalty:()=>Iie,removePersonRequests:()=>sie,removeRatings:()=>vie,scaledTeamAssignment:()=>gie,setParticipantScaleItem:()=>zw,setParticipantScaleItems:()=>ZQ});function nie(t=0){(typeof t!="number"||isNaN(t))&&(t=0);let e=new Date;return e.setHours(e.getHours()+t),e.getTime().toString(36).slice(-6).toUpperCase()}function aie({personRequests:t,personId:e,requests:i}){t[e]||(t[e]=[]);let r=i.filter(({requestType:n})=>n).map(n=>{let{date:a,startTime:o,endTime:s}=n;return n.requestType===rU&&(a=mt(a),o=Ui(o),s=Ui(s),a&&o&&s)?{date:a,startTime:o,endTime:s,requestType:n.requestType}:n}).filter(Boolean);for(let n of r)n.requestId=nie(),t[e].push(n);return{mergeCount:r.length}}function X$(t){let{tournamentRecords:e,personRequests:i}=t,r=We(t,[{[fn]:!0}]);if(r.error)return r;if(!i)return{...Q};let n=Object.values(e);for(let a of n){let o=a.participants??[],s=[];for(let l of Object.keys(i))if(Ac({tournamentParticipants:o,personId:l})){let u=i[l];u.length&&s.push({personId:l,requests:u})}Object.keys(s).length&&_t({element:a,extension:{value:s,name:vv}})}return{...Q}}function oie(t){let{tournamentRecords:e,requests:i,personId:r}=t,n=We(t,[{[fn]:!0},{requests:!0,[Jn]:cn,[Ha]:se}]);if(n.error)return n;let a=i.map(({requestId:u})=>u).filter(Boolean),{personRequests:o}=Fp({tournamentRecords:e}),s=u=>{o&&(o[u]=o[u].map(c=>{if(!a.includes(c.requestId))return c;let d=i.find(p=>p.requestId===c.requestId);if(d.requestType)return Object.assign(c,d)}).filter(Boolean))};if(r&&o!=null&&o[r])s(r);else if(o)for(let u of Object.keys(o))s(u);let l=i.filter(u=>!u.requestId);return l.length&&aie({personRequests:o,personId:r,requests:l}),X$({tournamentRecords:e,personRequests:o})}function sie(t){let{tournamentRecords:e,requestType:i,requestId:r,personId:n,date:a}=t,o=We(t,[{[fn]:!0}]);if(o.error)return o;let{personRequests:s}=Fp({tournamentRecords:e}),l=c=>{var d;s&&(s[c]=s[c].filter(p=>(!i||p.requestType!==i)&&(!r||p.requestId!==r)&&(!a||p.date!==a)),(d=s==null?void 0:s[c])!=null&&d.length||delete s[c])},u=!i&&!r&&!n&&!a;if(!u){if(n&&s!=null&&s[n])l(n);else if(s)for(let c of Object.keys(s))l(c)}return u||!s||!Object.keys(s).length?Dn({name:vv,tournamentRecords:e,discover:!0}):X$({tournamentRecords:e,personRequests:s})}function lie(t){let{tournamentRecords:e,personId:i,requests:r}=t,n=We(t,[{[fn]:!0,[DSe]:!0},{requests:!0,[Jn]:cn,[Ha]:se}]);if(n.error)return n;let{personRequests:a}=Fp({tournamentRecords:e}),{mergeCount:o}=aie({personRequests:a,personId:i,requests:r});return o&&a?X$({tournamentRecords:e,personRequests:a}):{error:se}}function uie({individualParticipantIds:t,groupingParticipantId:e,tournamentRecord:i}){let r="modifyIndividualParticipantIds";if(!i)return te({result:{error:ve},stack:r});if(!e||!t)return te({result:{error:Je},stack:r});let n=i.participants||[],a=n.find(m=>m.participantId===e);if(!a)return te({result:{error:Wi},stack:r});if(![Xt,Ja].includes(a.participantType))return te({result:{error:Ns},context:{participantType:a.participantType},stack:r});let o=t.filter(m=>{var h;return((h=n.find(f=>f.participantId===m))==null?void 0:h.participantType)!==Dt});if(o.length)return te({result:{error:ya,invalidParticipantIds:o},stack:r});let s=a.individualParticipantIds||[],l=t.filter(m=>!s.includes(m)),u=s.filter(m=>!t.includes(m)),c=qR({individualParticipantIds:l,groupingParticipantId:e,tournamentRecord:i});if(c.error)return te({result:c,stack:r});let d=OL({individualParticipantIds:u,groupingParticipantId:e,tournamentRecord:i});if(d.error)return te({result:d,stack:r});let{topics:p}=So();if(p.includes(on)){let m=n.find(({participantId:h})=>h===e);ut({topic:on,payload:{tournamentId:i.tournamentId,participants:[m]}})}return{...c,...d}}function cie({tournamentRecord:t,participantIds:e,signInState:i}){if(!t)return{error:ve};if(!Array.isArray(e))return{error:Je};if(![cy,kX].includes(i))return{error:se,signInState:i};let r=t.participants||[];if(!r.length)return{error:Xb};let n=r.map(Tt),a=e.filter(u=>!n.includes(u));if(a.length)return{error:se,context:{invalidParticipantIds:a}};let o=[],s=new Date().toISOString();for(let u of r){let{participantId:c}=u;if(e.includes(c)){let d=u_({duplicateValues:!1,tournamentRecord:t,participantId:c,timeItem:{itemType:cw,itemValue:i,createdAt:s}});if(d.error)return d;o.push(u)}}let{topics:l}=So();return o.length&&l.includes(on)&&ut({topic:on,payload:{tournamentId:t.tournamentId,participants:o}}),{...Q}}function die({tournamentRecord:t,participantId:e,participantOtherName:i}){if(!t)return{error:ve};if(!e)return{error:hr};let{participant:r}=nd({tournamentRecord:t,participantId:e});if(!r)return{error:Wi};r.participantOtherName=i;let{topics:n}=So();return n.includes(on)&&ut({topic:on,payload:{tournamentId:t.tournamentId,participants:[r]}}),{...Q}}function pj({personFormat:t,person:e}){let i=f=>f.replace(/\W/g,""),r=f=>/^[a-z]*$/.test(i(f)),n=f=>/^[A-Z]*$/.test(i(f)),a=f=>/^[LAST]{4}/.test(i(f)),o=f=>f.toLowerCase().indexOf("l")<f.toLowerCase().indexOf("f"),s=f=>f.indexOf(",")>=0,l=f=>f.toLowerCase().indexOf("f.")>=0,u=f=>f.toLowerCase().indexOf("f")<0,c=f=>f.indexOf(" ")>0;if(!e)return;let d=c(t)?" ":"",p=CM((e==null?void 0:e.standardGivenName)??""),m=CM((e==null?void 0:e.standardFamilyName)??"");if(!t)return`${p}${d}${m}`;l(t)&&!s(t)&&!o(t)&&(p=`${p[0]}.`),r(t)?(p=p.toLowerCase(),m=m.toLowerCase()):n(t)?(p=p.toUpperCase(),m=m.toUpperCase()):a(t)&&(m=m.toUpperCase());let h=`${p}${d}${m}`;return u(t)?h=m:o(t)&&(s(t)?h=`${m},${d}${p}`:h=`${m}${d}${p}`),h}function x1e({participantMap:t,participant:e,formats:i}){let{participantType:r,individualParticipantIds:n,person:a}=e,o=r&&i[r];if(r!==Gn&&o){let{personFormat:s,doublesJoiner:l}=o;r===Dt&&(e.participantName=pj({person:a,personFormat:s})),r===ft&&(e.participantName=n==null?void 0:n.map(u=>{var c;let d=(c=t[u])==null?void 0:c.person;return pj({person:d,personFormat:s})}).filter(Boolean).join(l??"/"))}}function pie({tournamentRecord:t,formats:e}){if(!t)return{error:ve};if(!At(e))return{error:Je};let i=t.participants??[],r=AK(i,"participantId");for(let n of i)x1e({participant:n,participantMap:r,formats:e});return{...Q}}function mie(t){let{tournamentRecord:e,policyDefinitions:i,contextProfile:r,participantId:n,personId:a}=t,o=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(typeof n!="string"&&typeof a!="string")return{error:Je,stack:"publicFindParticipant"};let s,l;for(let u of Object.values(o)){l=u.tournamentId;let c=u.participants||[];if(s=Ac({tournamentParticipants:c,internalUse:!0,policyDefinitions:i,contextProfile:r,participantId:n,personId:a}),s)break}return{participant:s,tournamentId:l,...Q}}function hie({individualParticipantIds:t=[],participantRoleResponsibilities:e,participantRole:i=wJ,tournamentRecord:r,participantId:n,groupName:a}){if(!r)return{error:ve};if(!a)return{error:Je,info:"Missing groupName"};if(!Array.isArray(t))return{info:"Invalid individualParticipantIds",error:se};let o=(Oi({participantFilters:{participantTypes:[Dt]},tournamentRecord:r}).participants??[]).map(c=>c.participantId);for(let c of t)if(!o.includes(c))return{error:Ns,participantId:c};let s=He({participantId:n||Ht(),participantRoleResponsibilities:e,participantName:a,individualParticipantIds:t,participantType:Ja,participantRole:i}),l=pl({participant:s,tournamentRecord:r});if(l.error)return l;let{topics:u}=So();return u.includes(kc)&&ut({topic:kc,payload:{tournamentId:r.tournamentId,participants:[s]}}),{...Q,participant:Ne(s)}}function fie({tournamentRecord:t,participantName:e,participantId:i}){if(!t)return{error:ve};if(!i)return{error:hr};if(!e)return{error:Je,info:"Missing participantName"};let{participant:r}=nd({tournamentRecord:t,participantId:i});if(!r)return{error:Wi};r.participantName=e;let{topics:n}=So();return n.includes(on)&&ut({topic:on,payload:{tournamentId:t.tournamentId,participants:[r]}}),{...Q}}function gie({clearExistingAssignments:t=!0,individualParticipantIds:e,reverseAssignmentOrder:i,initialTeamIndex:r=0,scaledParticipants:n=[],teamParticipantIds:a,tournamentRecord:o,scaleAttributes:s,teamNameBase:l,teamsCount:u,eventId:c,event:d}){var p,m,h,f,g;if(!o)return{error:ve};if(!Array.isArray(a)&&!st(u)&&!c||!st(r)||n&&!Array.isArray(n)||s&&(typeof s!="object"||!Object.keys(s).length))return{error:se};if(!s&&!n.length||!n&&!(e&&s))return{error:Je,info:"Missing scaling details"};if(c&&!a){if((d==null?void 0:d.eventType)!==Ea)return{error:Wl};a=(p=d==null?void 0:d.entries)==null?void 0:p.filter(({entryStatus:w})=>w===ca).map(Tt)}if(!(a!=null&&a.length)&&!u)return{info:"Missing teamParticipantIds or teamsCount",error:Je};let v=e??n.map(({participantId:w})=>w);i&&(a==null||a.reverse(),r+=1),r>((a==null?void 0:a.length)||0)-1&&(r=0);let y=(a==null?void 0:a.slice(r).concat(...a.slice(0,r)))??[],I=[];for(let w of o.participants??[]){let{participantId:U,participantType:T}=w;if(y.includes(U)){if(T!==Gn)return{error:Ns,participant:w};I.push(w)}}if(u&&I.length<u){let w=u-((I==null?void 0:I.length)||0),U=l??"Team",T=Te(0,w).map(R=>({participantName:`${U} ${R+1}`,participantType:Gn,participantRole:en})),{participants:D=[]}=os({participants:T,returnParticipants:!0,tournamentRecord:o}),P=D.map(Tt),E=((m=o.participants)==null?void 0:m.filter(({participantId:R})=>P.includes(R)))??[];I.push(...E)}if(!I.length)return{error:pF};if(t)for(let w of I)w.individualParticipantIds=[];else{let w=I.map(U=>U).flat();e!=null&&e.length?v=v.filter(U=>!w.includes(U)):n=n==null?void 0:n.filter(({participantId:U})=>!w.includes(U))}if(!(e!=null&&e.length)&&!(n!=null&&n.length))return{error:hP,info:"Nothing to be done"};if(!n.length){for(let w of o.participants??[]){let{participantId:U,participantType:T}=w;if(!v.includes(U))continue;if(T!==Dt)return{error:Ns,participant:w};let D=(h=Ll({scaleAttributes:s,participant:w}))==null?void 0:h.scaleItem,P=s!=null&&s.accessor?(f=D==null?void 0:D.scaleValue)==null?void 0:f[s==null?void 0:s.accessor]:D==null?void 0:D.scaleValue,E={participantId:U,scaleValue:P};n.push(E)}if(!n.length)return{error:Wi}}n.sort((w,U)=>s!=null&&s.sortOrder?((U==null?void 0:U.scaleValue)||0)-((w==null?void 0:w.scaleValue)||0):((w==null?void 0:w.scaleValue)||1/0)-((U==null?void 0:U.scaleValue)||1/0));for(let w of n)if(!w.participantId)return{error:se,scaledParticipant:w};let b=0;for(;b<n.length;){for(let w of I){if(b+1>n.length)break;let U=n[b];w.individualParticipantIds.push(U.participantId),b++}I.reverse()}let S=I.map(Tt);for(let w of o.events??[]){if(w.eventType!==Ea)continue;let U=(w.entries??[]).filter(T=>S.includes(T.participantId));for(let T of U){let D=T.participantId,P=(g=I.find(R=>R.participantId===D))==null?void 0:g.individualParticipantIds;w.entries=(w.entries??[]).filter(R=>!P.includes(R.participantId)),(w.drawDefinitions??[]).forEach(R=>{R.entries=(R.entries??[]).filter(N=>!P.includes(N.participantId))});let{flightProfile:E}=Hi({event:w});((E==null?void 0:E.flights)||[]).forEach(R=>{R.drawEntries=(R.drawEntries||[]).filter(N=>!P.includes(N.participantId))})}}return{...Q,scaledParticipants:n}}function vie(t){let e=We(t,[{[Ur]:!0,[LF]:!0},{ratingType:!1,[Xr]:o=>Tr[o]}]);if(e.error)return e;let i=`${t.ratingType}.${VF}`,r=t.asDynamic?i:t.ratingType,n=[Jd,Ic,t.eventType,r].join("."),a=t.tournamentRecord.participants??[];for(let o of a)o.timeItems&&(o.timeItems=o.timeItems.filter(s=>s.itemType!==n));return{...Q}}function Iie(t){let{tournamentRecords:e}=t;if(typeof e!="object"||!Object.keys(e).length)return{error:xi};for(let i of Object.values(e)){let r=F1e({...t,tournamentRecord:i});if(r.error&&r.error!==Qf)return r}return{...Q}}function F1e({tournamentRecord:t,penaltyId:e}){if(!t)return{error:ve};if(!e)return{error:sF};let i=(t==null?void 0:t.participants)??[],r=[],n=!1,a;return i.forEach(o=>{let s=!1;o.penalties=(o.penalties??[]).filter(l=>(l.penaltyId===e&&(s=!0,n||(a=l,n=!0)),s&&r.push(o),l.penaltyId!==e))}),a&&ut({topic:on,payload:{tournamentId:t.tournamentId,participants:r}}),a?{...Q,penalty:a}:{error:Qf}}var L1e=({penaltyId:t=Ht()}={})=>({refereeParticipantId:void 0,penaltyCode:void 0,penaltyType:void 0,extensions:void 0,matchUpId:void 0,createdAt:void 0,issuedAt:void 0,notes:void 0,penaltyId:t}),yie=L1e;function bie(t){let{tournamentRecords:e}=t;if(typeof e!="object"||!Object.keys(e).length)return{error:xi};for(let i of Object.values(e)){let r=_1e({...t,tournamentRecord:i});if(r.error&&r.error!==Qf||r.success)return r}return{error:Qf}}function _1e({tournamentRecord:t,modifications:e,penaltyId:i}){if(!t)return{error:ve};if(!e)return{error:se,modifications:e};if(!i)return{error:sF};let r=(t==null?void 0:t.participants)??[],n=Object.keys(yie()).filter(l=>l!=="penaltyId"),a=Object.keys(e).filter(l=>n.includes(l));if(!a.length)return{error:fP};let o,s=[];return r.forEach(l=>{let u=!1;l.penalties=(l.penalties??[]).map(c=>(c.penaltyId===i&&(u=!0,a.forEach(d=>Object.assign(c,{[d]:e[d]})),o||(o=c)),c)),u&&s.push(l)}),o&&ut({topic:on,payload:{tournamentId:t.tournamentId,participants:s}}),o?{...Q,penalty:o}:{error:Qf}}function wie(t,e,i){return!t&&e?e:t&&!e||typeof t!="object"||typeof e!="object"?t:dt(Object.keys(t).concat(Object.keys(e))).reduce((r,n)=>{if(!e[n])r[n]=t[n];else if(!t[n])r[n]=e[n];else if(typeof t[n]!=typeof e[n])r[n]=e[n];else if(Array.isArray(t[n]))if(i===!0||Array.isArray(i)&&i.includes(n)){let a=dt(t[n].map(o=>JSON.stringify(o)).concat(e[n].map(o=>JSON.stringify(o)))).map(o=>JSON.parse(o));r[n]=a}else r[n]=e[n];else typeof t[n]=="object"?r[n]=wie(t[n],e[n],i):r[n]=e[n];return r},{})}function Uie({participants:t=[],tournamentRecord:e,arraysToMerge:i}){if(!e)return{error:ve};e.participants||(e.participants=[]);let r=t.filter(Ma(Xl)).map(u=>({[u.participantId]:u})),n=Object.assign({},...r),a=[];e.participants=e.participants.map(u=>{if(n[u.participantId]){let c=wie(u,n[u.participantId],i);return a.push(c),c}return u});let o=e.participants.map(Ma(Xl))||[],s=t.filter(({participantId:u})=>!o.includes(u)),{topics:l}=So();return s.length&&(e.participants=e.participants.concat(...s),l.includes(kc)&&ut({topic:kc,payload:{participants:s}})),a.length&&l.includes(on)&&ut({topic:on,payload:{tournamentId:e.tournamentId,participants:a}}),{modifiedParticipantsCount:a.length,newParticipantsCount:s.length,...Q}}function Sie(t){var e;let{tournamentRecord:i,participantIds:r}=t,n=t.tournamentRecords??(i&&{[i.tournamentId]:i})??{},a;for(let o of Object.values(n)){let s=(e=Oi({tournamentRecord:o}).participants??[])==null?void 0:e.map(Tt).filter(l=>r.includes(l));s.length&&(a=$1e({...t,penaltyId:t.penaltyId??a,tournamentRecord:o,participantIds:s}).penaltyId)}return a?{...Q,penaltyId:a}:{error:Wi}}function $1e({refereeParticipantId:t,tournamentRecord:e,participantIds:i,penaltyCode:r,penaltyType:n,extensions:a,penaltyId:o,matchUpId:s,issuedAt:l,notes:u}){if(!e)return{error:ve};if(!i)return{error:hr};if(!n)return{error:S9};let c=((e==null?void 0:e.participants)??[]).filter(m=>i.includes(m.participantId));if(!c.length)return{error:Wi};let d=new Date().toISOString(),p=Object.assign(yie({penaltyId:o}),{refereeParticipantId:t,penaltyCode:r,penaltyType:n,matchUpId:s,createdAt:d,issuedAt:l,notes:u});return Array.isArray(a)&&a.forEach(m=>_t({element:p,extension:m})),c.forEach(m=>{m.penalties||(m.penalties=[]),m.penalties.push(p)}),ut({topic:on,payload:{tournamentId:e.tournamentId,participants:c}}),{...Q,penaltyId:p.penaltyId}}function Tie({participantRole:t=en,tournamentRecord:e,persons:i}){var r;if(!e)return{error:ve};if(!Array.isArray(i))return{error:se};if(!Object.keys(AL).includes(t))return{error:p9};let n=(e.participants||[]).map(({person:f})=>f==null?void 0:f.personId).filter(Boolean),a=[],o=i.filter(f=>f&&(!f.personId||!n.includes(f.personId))).map(f=>(f.personId||(f.personId=Ht()),a.push(f.personId),f)),s=(f,g)=>Object.assign({},...Object.keys(f).filter(v=>!g.includes(v)).map(v=>({[v]:f[v]}))),l=o.map(f=>He({extensions:f.participantExtensions,timeItems:f.participantTimeItems,participantType:Dt,participantRole:t,person:s(f,["participantExtensions","participantTimeItems","pairedPersons"])})),u=0,c=0,d=os({participants:l,tournamentRecord:e});if(d.error)return d;c=d.addedCount||0;let p=[],m=((r=Oi({participantFilters:{participantTypes:[Dt]},tournamentRecord:e}))==null?void 0:r.participants)??[];if(t===en&&i.filter(({pairedPersons:f})=>f).forEach(({personId:f,pairedPersons:g})=>{Array.isArray(g)&&g.forEach(v=>{let y=[f,v.personId].map(I=>Ac({tournamentParticipants:m,personId:I})).filter(Boolean);if(y.length===2){let I=y.map(Tt);p.push(He({extensions:v.participantExtensions,timeItems:v.timeItems,participantRole:en,individualParticipantIds:I,participantType:ft}))}})}),p.length){if(d=os({participants:p,tournamentRecord:e}),d.error)return d;u=d.addedCount||0}let h=c+u;return{...Q,addedCount:h,newPersonIds:a}}var Die={};bt(Die,{bulkUpdatePublishedEventIds:()=>q_,getAllEventData:()=>Y_,getCourtInfo:()=>XP,getDrawData:()=>ER,getEventData:()=>CR,getEventPublishStatus:()=>Eo,getPublishState:()=>Fh,getTournamentPublishStatus:()=>Rw,getVenueData:()=>dg,mutate:()=>Pie,publishEvent:()=>Av,publishEventSeeding:()=>Rie,publishOrderOfPlay:()=>Aie,publishParticipants:()=>Nie,query:()=>dee,setEventDisplay:()=>jR,unPublishEvent:()=>Oie,unPublishEventSeeding:()=>Eie,unPublishOrderOfPlay:()=>Mie,unPublishParticipants:()=>Cie});var Pie={};bt(Pie,{publishEvent:()=>Av,publishEventSeeding:()=>Rie,publishOrderOfPlay:()=>Aie,publishParticipants:()=>Nie,setEventDisplay:()=>jR,unPublishEvent:()=>Oie,unPublishEventSeeding:()=>Eie,unPublishOrderOfPlay:()=>Mie,unPublishParticipants:()=>Cie});function Rie({removePriorValues:t=!0,stageSeedingScaleNames:e,seedingScaleNames:i,tournamentRecord:r,status:n=Qa,drawIds:a=[],event:o}){var s,l,u,c;if(!r)return{error:ve};if(!o)return{error:vi};let d=Eo({event:o,status:n}),p=(((s=d==null?void 0:d.seeding)==null?void 0:s.seedingScaleNames)||i)&&{...(l=d==null?void 0:d.seeding)==null?void 0:l.seedingScaleNames,...i},m=(((u=d==null?void 0:d.seeding)==null?void 0:u.stageSeedingScaleNames)||e)&&{...(c=d==null?void 0:d.seeding)==null?void 0:c.stageSeedingScaleNames,...e},h=He({stageSeedingScaleNames:m,seedingScaleNames:p,published:!0,drawIds:a});return Nv({statusObject:{seeding:h},removePriorValues:t,status:n,event:o}),ut({topic:CX,payload:{tournamentId:r.tournamentId,eventId:o.eventId,drawIds:a}}),{...Q}}function Eie({removePriorValues:t=!0,seedingScaleNames:e,tournamentRecord:i,status:r=Qa,drawIds:n,stages:a,event:o}){var s,l;if(!i)return{error:ve};if(!o)return{error:vi};let u=Eo({event:o});if(u){let c=u.seeding;if(Array.isArray(a)&&c.stageSeedingScaleNames)for(let d of a)c.stageSeedingScaleNames[d]&&delete c.stageSeedingScaleNames[d];Array.isArray(e)&&c!=null&&c.seedingScaleNames&&(c.seedingScaleNames=c.seedingScaleNames.filter(d=>!e.includes(d))),Array.isArray(n)&&c!=null&&c.drawIds&&(c.drawIds=c.drawIds.filter(d=>!n.includes(d))),(!Object.values(c.stageSeedingScaleNames??{}).length&&!((s=c.seedingScaleNames)!=null&&s.length)&&!((l=c.drawIds)!=null&&l.length)||!a&&!e&&!(n!=null&&n.length))&&(delete c.stageSeedingScaleNames,delete c.seedingScaleNames,delete c.drawIds,c.published=!1),Nv({statusObject:{seeding:c},removePriorValues:t,status:r,event:o})}return ut({topic:uL,payload:{tournamentId:i.tournamentId,eventId:o.eventId}}),{...Q}}function Cie(t){let e=To(t);if(!Object.keys(e).length)return{error:xi};for(let i of Object.values(e)){let r=B1e({tournamentRecord:i,...t});if(r.error)return r}return{...Q}}function B1e({removePriorValues:t=!0,tournamentRecord:e,status:i=Qa}){if(!e)return{error:ve};let r=`${ad}.${od}`,{timeItem:n}=Do({element:e,itemType:r}),a=(n==null?void 0:n.itemValue)||{[i]:{}};return a[i]&&delete a[i].participants,wl({timeItem:{itemValue:a,itemType:r},element:e,removePriorValues:t}),ut({payload:{tournamentId:e.tournamentId},topic:e0e}),{...Q}}function Mie(t){let e=To(t);if(!Object.keys(e).length)return{error:xi};for(let i of Object.values(e)){let r=V1e({tournamentRecord:i,...t});if(r.error)return r}return{...Q}}function V1e({removePriorValues:t=!0,tournamentRecord:e,status:i=Qa}){if(!e)return{error:ve};let r=`${ad}.${od}`,{timeItem:n}=Do({element:e,itemType:r}),a=(n==null?void 0:n.itemValue)||{[i]:{}};return a[i]&&delete a[i].orderOfPlay,wl({timeItem:{itemValue:a,itemType:r},element:e,removePriorValues:t}),ut({topic:cL,payload:{tournamentId:e.tournamentId}}),{...Q}}function Nie(t){let e=To(t);if(!Object.keys(e).length)return{error:xi};for(let i of Object.values(e)){let r=j1e({tournamentRecord:i,...t});if(r.error)return r}return{...Q}}function j1e({removePriorValues:t,tournamentRecord:e,status:i=Qa}){if(!e)return{error:ve};let r=`${ad}.${od}`,{timeItem:n}=Do({element:e,itemType:r}),a=(n==null?void 0:n.itemValue)||{[i]:{}};return a[i].participants={published:!0},wl({timeItem:{itemValue:a,itemType:r},element:e,removePriorValues:t}),ut({payload:{tournamentId:e.tournamentId},topic:NX}),{...Q}}function Aie(t){let e=To(t);if(!Object.keys(e).length)return{error:xi};for(let i of Object.values(e)){let r=G1e({tournamentRecord:i,...t});if(r.error)return r}return{...Q}}function G1e({scheduledDates:t=[],removePriorValues:e,tournamentRecord:i,status:r=Qa,eventIds:n=[]}){if(!i)return{error:ve};let a=`${ad}.${od}`,{timeItem:o}=Do({element:i,itemType:a}),s=(o==null?void 0:o.itemValue)||{[r]:{}};return s[r].orderOfPlay={published:!0,scheduledDates:t,eventIds:n},wl({timeItem:{itemValue:s,itemType:a},element:i,removePriorValues:e}),ut({topic:MX,payload:{tournamentId:i.tournamentId,scheduledDates:t,eventIds:n}}),{...Q}}function Oie({removePriorValues:t=!0,tournamentRecord:e,status:i=Qa,event:r}){if(!e)return{error:ve};if(!r)return{error:vi};let n=`${ad}.${od}`,{timeItem:a}=dw({itemType:n,event:r}),o=(a==null?void 0:a.itemValue)||{[i]:{}};return delete o[i].structureIds,delete o[i].drawDetails,delete o[i].drawIds,Bh({event:r,timeItem:{itemValue:o,itemType:n},removePriorValues:t}),Nv({statusObject:{structureIds:void 0,drawIds:void 0,seeding:void 0},removePriorValues:t,status:i,event:r}),ut({topic:lL,payload:{tournamentId:e.tournamentId,eventId:r.eventId}}),{eventId:r.eventId,...Q}}var kie={};bt(kie,{getEntryStatusReports:()=>z1e,getParticipantStats:()=>H1e,getStructureReports:()=>q1e,getVenuesReport:()=>K1e});function H1e({withCompetitiveProfiles:t,opponentParticipantId:e,withIndividualStats:i,teamParticipantId:r,tournamentRecord:n,withScaleValues:a,tallyPolicy:o,matchUps:s}){var l,u,c,d,p;if(!n)return{error:ve};if(s&&!Array.isArray(s))return{error:la};if(s=s??Hr({tournamentRecord:n,participantsProfile:a?{withScaleValues:a}:void 0}).matchUps,!(s!=null&&s.length))return{error:Ju};let m=[];e&&m.push(e),r&&m.push(r);let h=m.length?{participantIds:m}:{participantTypes:[Gn]},f=Oi({participantFilters:h,tournamentRecord:n}).participants??[];if(!f.every(({participantType:R})=>R===Gn))return{error:ya};m.length||m.push(...f.map(Tt));let g=new Map,v=new Map,y=new Map,I=new Map,b=(R,N="")=>v.get(R)||v.set(R,{participantName:N,participantId:R,competitorIds:[],competitiveness:{},matchUpStatuses:{},tiebreaks:[0,0],matchUps:[0,0],points:[0,0],games:[0,0],sets:[0,0]})&&v.get(R);for(let R of f){let{participantId:N,individualParticipantIds:A}=R;I.set(N,A??[]),b(N,R.participantName)}if(r&&!I.get(r))return te({result:{error:Wi},context:{teamParticipantId:r}});if(e&&!I.get(e))return te({result:{error:Wi},context:{opponentParticipantId:e}});let S=[],w=R=>{let N=[[],[]];for(let M of R){let C=M.participant;if(C!=null&&C.participantName){g.set(C.participantId,{participantName:C.participantName,ratings:C.ratings});let O=v.get(C.participantId);O&&(O.participantName=C.participantName)}}let A=({side:M,individualParticipantIds:C})=>{var O,k,x,F,$;return M.participantId&&(!(C!=null&&C.length)||C.includes(M.participantId))&&[M.participantId]||((k=(O=M.participant)==null?void 0:O.individualParticipantIds)==null?void 0:k.length)&&(!(C!=null&&C.length)||ji(C,(x=M.participant)==null?void 0:x.individualParticipantIds).length===(($=(F=M.participant)==null?void 0:F.individualParticipantIds)==null?void 0:$.length))&&M.participant.individualParticipantIds};if(I.size){let M=(C,O)=>{for(let k of R){if(!k.participant)continue;let x=A({individualParticipantIds:O,side:k});if(x!=null&&x.length){let F=k.sideNumber;if(!F)continue;let $=[C];i&&$.push(...x),N[F-1]=$;let _=v.get(C);for(let L of x.filter(Boolean))_&&!_.competitorIds.includes(L)&&_.competitorIds.push(L)}}};if(r)(!e||R.every(C=>C.participant&&(A({individualParticipantIds:I.get(r),side:C})||A({individualParticipantIds:I.get(e),side:C}))))&&M(r,I.get(r));else for(let[C,O]of I)M(C,O)}else if(i)for(let M of R){if(!M.participant)continue;let C=A({individualParticipantIds:[],side:M}),O=M.sideNumber;O&&(N[O-1]=C)}return N};for(let R of s){if(!At(R))return{error:la};let{matchUpStatus:N,matchUpFormat:A,matchUpType:M,winningSide:C,score:O,sides:k}=R;if(!k||!O||M===Ba||N===jt)continue;let x=w(k);if(!x.filter(Boolean).length)continue;let F=t&&C&&((l=bw({matchUp:R}))==null?void 0:l.competitiveness);S.push(R);let $=i_({matchUpStatus:N,matchUpFormat:A,tallyPolicy:o,winningSide:C,score:O}),_=fQ({matchUpStatus:N,matchUpFormat:A,tallyPolicy:o,winningSide:C,score:O}),{pointsTally:L,tiebreaksTally:B}=gQ({matchUpFormat:A,score:O});x.forEach((V,G)=>{var j;for(let z of V){let W=(j=g.get(z))==null?void 0:j.participantName,q=b(z,W);if(q){let Y=(X,ie)=>ie.forEach((ae,le)=>q[X][le]+=ae),re=G?[...B].reverse():B,K=G?[...L].reverse():L,H=G?[..._].reverse():_,Z=G?[...$].reverse():$;if(Y("tiebreaks",re),Y("points",K),Y("games",H),Y("sets",Z),C){let X=C-1===G?0:1;q.matchUps[X]+=1}if(F){let X=F.toLowerCase();q.competitiveness[X]||(q.competitiveness[X]=[0,0]),q.competitiveness[X][G]+=1}if(N){let X=N.toLowerCase();q.matchUpStatuses[X]||(q.matchUpStatuses[X]=0),q.matchUpStatuses[X]+=1}}}})}let U=["tiebreaks","matchUps","points","games","sets"],T=["competitive","routine","decisive"],D=new Map,P=(R,N)=>(R??0)+(N??0);for(let[R,N]of v.entries()){for(let A of U){let M=N[A].reduce(P);if(M){let C=N[A][0]/M,O=`${A}Ratio`,k=parseFloat(C.toFixed(2));N[O]=k,y.set(R,!0),D.has(O)||D.set(O,[]),(u=D.get(O))==null||u.push(k)}}for(let A of T){let M=(d=(c=N.competitiveness)==null?void 0:c[A])==null?void 0:d.reduce(P);if(M){let C=N.competitiveness[A][0]/M,O=`${A}Ratio`,k=parseFloat(C.toFixed(2));N[O]=k}}}if(!r){let R=(N,A)=>A-N;for(let N of v.values())for(let A of U){let M=`${A}Ratio`;if(typeof N[M]=="number"){let C=(p=D.get(M))==null?void 0:p.sort(R).indexOf(N[M]);if(typeof C=="number"&&C>=0){let O=`${A}Rank`;N[O]=C+1}}}}let E={relevantMatchUps:S,...Q};return r?(E.teamStats=v.get(r),e&&(E.opponentStats=v.get(e))):E.participatingTeamsCount=y.size,E.allParticipantStats=[...v.values()],E}function M0({participant:t,eventType:e}){var i,r,n,a,o,s;let l=(i=t==null?void 0:t.person)==null?void 0:i.personId,u=(n=(r=t==null?void 0:t.person)==null?void 0:r.personOtherIds)==null?void 0:n[0],c=(a=t==null?void 0:t.person)==null?void 0:a.tennisId,d=(s=(o=t==null?void 0:t.ratings)==null?void 0:o[e])==null?void 0:s.find(({scaleName:f})=>f===t_),p=d==null?void 0:d.scaleValue,{wtnRating:m,confidence:h}=p||{};return{timeStamp:d==null?void 0:d.scaleDate,personOtherId:u,confidence:h,wtnRating:m,personId:l,tennisId:c}}function z1e({tournamentRecord:t}){if(!t)return{error:ve};let e=t.tournamentId,{participantMap:i}=Oi({withScaleValues:!0,withEvents:!0,withSeeding:!0,tournamentRecord:t,withDraws:!0}),r=(Hr({matchUpFilters:{matchUpTypes:[om,Wd]},tournamentRecord:t}).matchUps??[]).flatMap(({sides:m,matchUpType:h})=>m==null?void 0:m.flatMap(f=>{var g,v;return h===Wd?(g=f==null?void 0:f.participant)==null?void 0:g.individualParticipantIds:((v=f==null?void 0:f.participant)==null?void 0:v.participantId)||f.participantId}).filter(Boolean)).filter(Boolean),n=[],a={},o={},s={},l=0,u=({id:m,entry:h,eventId:f,eventType:g})=>{var v;let{qualifyingSeeding:y,mainSeeding:I,entryStatus:b,entryStage:S,drawId:w}=h;a[m]||(a[m]=[]);let{participant:U,events:T}=(i==null?void 0:i[m])??{},D=M0({participant:U,eventType:g}),P=(v=T==null?void 0:T[f])==null?void 0:v.ranking;b===XL&&n.push(m),a[m].push({participantType:U==null?void 0:U.participantType,participantId:m,tournamentId:e,eventType:g,eventId:f,drawId:w,entryStatus:b,entryStage:S,...D,ranking:P,mainSeeding:I,qualifyingSeeding:y})};for(let m of t.events??[]){let h={},f=U=>{h[U]||(h[U]={count:0}),h[U].count+=1},{drawDefinitions:g=[],eventType:v,eventId:y}=m,I=g.flatMap(U=>{let{drawId:T,entries:D}=U;l+=1;let P=({stage:A,stageSequence:M})=>A===Ae&&M===1||A===Ke,E=(U.structures??[]).filter(P).flatMap(({positionAssignments:A})=>A).filter(Boolean).map(({participantId:A})=>A),R=({participantId:A})=>E.includes(A),N=A=>{var M,C,O,k,x,F,$,_;let{participantId:L,entryStatus:B,entryStage:V}=A;f(B);let G=(k=(O=(C=(M=i==null?void 0:i[L])==null?void 0:M.draws)==null?void 0:C[T])==null?void 0:O.seedAssignments)==null?void 0:k[Ae];return{qualifyingSeeding:(_=($=(F=(x=i==null?void 0:i[L])==null?void 0:x.draws)==null?void 0:F[T])==null?void 0:$.seedAssignments)==null?void 0:_[Ke],participantId:L,mainSeeding:G,entryStatus:B,entryStage:V,drawId:T}};return D==null?void 0:D.filter(R).map(N)}),b=U=>{var T;let D=U.participantId,P=(T=i==null?void 0:i[D].participant.individualParticipantIds)==null?void 0:T.filter(E=>r.includes(E));return D&&{[D]:{individualParticipantIds:P}}};v===Au?(()=>{let U=Object.assign({},...I.map(b).filter(Boolean)),T=D=>{U[D.participantId].individualParticipantIds.forEach(P=>{u({id:P,eventType:v,eventId:y,entry:D})})};I.forEach(T)})():I.forEach(U=>{u({id:U==null?void 0:U.participantId,eventType:v,eventId:y,entry:U})});let S=Object.values(h).reduce((U,T)=>U+T.count,0);Object.keys(h).forEach(U=>{h[U].pct=h[U].count/S*100}),s[y]={tournamentId:e,eventId:y,entries:I,entryStatuses:h};let w=Object.assign({},...ds.flatMap(U=>{var T,D;return[{[U+"_count"]:(T=h[U])==null?void 0:T.count},{[U+"_pct"]:(D=h[U])==null?void 0:D.pct}]}));o[y]={tournamentId:e,eventId:y,...w}}let c=Object.values(i??{}).filter(({participant:{participantType:m,participantRole:h}})=>m===Dt&&h===en),d=c.filter(({participant:m})=>!r.includes(m.participantId)).map(({participant:m})=>m.participantId),p={nonParticipatingEntriesCount:d.length,individualParticipantsCount:c.length,eventsCount:Object.values(s).length,nonParticipatingParticipantIds:d,drawDefinitionsCount:l,tournamentId:e};return{entryStatusReports:Object.values(o).flat(),participantEntryReports:Object.values(a).flat(),eventReports:Object.values(s).flat(),withDrawnParticipantIds:n,tournamentEntryReport:p}}function W1e({eventType:t,matchUps:e,eventId:i,drawId:r}){let n={},a=h=>{let f=h==null?void 0:h.matchUpFormat;f&&(n[f]||(n[f]=0),n[f]+=1)},o=e.filter(h=>i?h.eventId===i:h.drawId===r).reduce((h,f)=>(a(f),(f.sides??[]).flatMap(g=>{var v;return(((v=g==null?void 0:g.participant)==null?void 0:v.individualParticipants)||[g==null?void 0:g.participant]).filter(Boolean)}).forEach(g=>h[g.participantId]=g),h),{}),s=Object.values(o),l=s.map(h=>M0({participant:h,eventType:t})).filter(({wtnRating:h})=>h),u=(s.length-l.length)/s.length*100,c=l.reduce((h,f)=>{let{wtnRating:g,confidence:v}=f;return h.totalWTN+=g,h.totalConfidence+=v,h},{totalWTN:0,totalConfidence:0}),d=l!=null&&l.length?c.totalWTN/l.length:0,p=l!=null&&l.length?c.totalConfidence/l.length:0,m=Object.values(n).reduce((h,f)=>h+(f||0),0);return{matchUpFormatCounts:n,matchUpsCount:m,avgConfidence:p,pctNoRating:u,avgWTN:d}}function q1e(t){var e;let{tournamentRecord:i,extensionProfiles:r,firstFlightOnly:n}=t;if(!i)return{error:Kf};let a=[],o={},s={},l=[],u=Object.assign({},...(r??[]).map(({name:f,label:g,accessor:v})=>{var y,I,b;let S=(I=(y=vt({element:i,name:f}))==null?void 0:y.extension)==null?void 0:I.value,w=v?(b=lm({element:S,accessor:v}))==null?void 0:b.value:S;return{[g||f]:w}})),c=i==null?void 0:i.tournamentId,d=Hr({participantsProfile:{withScaleValues:!0},tournamentRecord:i}).matchUps??[],p=f=>{var g,v,y;return(y=(v=(g=Do({itemType:JF,itemSubTypes:[xl],element:{timeItems:f}}))==null?void 0:g.timeItem)==null?void 0:v.itemValue)==null?void 0:y.scaleBasis},m=({positionManipulations:f})=>{f==null||f.forEach(g=>{let{structureId:v,name:y}=g,I=g.drawPositions||[g.drawPosition];o[v]||(o[v]=[]),o[v].push(`${y}: ${I.join("/")}`)})},h=(e=i==null?void 0:i.events)==null?void 0:e.flatMap(({timeItems:f,drawDefinitions:g=[],extensions:v,eventType:y,eventName:I,eventId:b,category:S})=>{var w,U,T,D;let P=(T=(U=(w=v==null?void 0:v.find(k=>k.name===rs))==null?void 0:w.value)==null?void 0:U.flights)==null?void 0:T.map(k=>({[k.drawId]:k.flightNumber})),E=P&&Object.assign({},...P),R=v==null?void 0:v.find(k=>k.name===Ed),N=f==null?void 0:f.find(k=>k.itemType===Ed),A=((D=R==null?void 0:R.value)==null?void 0:D.length)||(N==null?void 0:N.itemValue)||0,M=Object.values(E??{}),C=E&&Math.min(...M),O=p(f);return s[b]={seedingBasis:O?JSON.stringify(O):void 0,totalPositionManipulations:0,maxPositionManipulations:0,generatedDrawsCount:0,drawDeletionsCount:A,tournamentId:c,eventId:b},g.filter(k=>!n||!P||E[k.drawId]===C).flatMap(k=>{let{matchUpFormat:x,tieFormat:F,timeItems:$,extensions:_,structures:L,drawName:B,drawType:V,drawId:G}=k,{matchUpFormatCounts:j,matchUpsCount:z,avgConfidence:W,pctNoRating:q,avgWTN:Y}=W1e({eventType:y,matchUps:d,drawId:G}),re=p($)||O,K=Y1e({extensions:_}),H=(K==null?void 0:K.length)||0;return m({positionManipulations:K}),s[b].totalPositionManipulations+=H,s[b].generatedDrawsCount+=1,H>s[b].maxPositionManipulations&&(s[b].maxPositionManipulations=H),L==null?void 0:L.filter(Z=>Z.stageSequence===1&&[Ke,Ae,an,Bi].includes(Z.stage)).map(Z=>{var X,ie,ae;let le=[Ae,Bi].includes(Z.stage)?d.find(be=>be.structureId===Z.structureId&&be.finishingRound===1&&be.winningSide):void 0;Z.stage===Ae&&a.push({eventName:I,drawName:B,structureId:Z.structureId});let ne=(ie=(X=le==null?void 0:le.sides)==null?void 0:X.find(be=>be.sideNumber===le.winningSide))==null?void 0:ie.participant,de=(ne==null?void 0:ne.participantType)===Gn&&ne.participantId,ye=(ne==null?void 0:ne.participantType)===ft?ne.individualParticipants:[],ce=M0({participant:(ye==null?void 0:ye[0])||ne,eventType:y}),{personId:ke,personOtherId:Pe,tennisId:it,confidence:It,wtnRating:me}=ce||{},fe=M0({participant:ye==null?void 0:ye[1],eventType:y}),{personId:pe,personOtherId:Fe,tennisId:De,confidence:je,wtnRating:ue}=fe||{},{ageCategoryCode:he,categoryName:Re,subType:xe}=S??{},Ee=Z.matchUpFormat||x,we=(j[Ee]||0)/z*100,{tieFormatName:Ue,tieFormatDesc:wt}=S0(F),{tieFormatName:Le,tieFormatDesc:rt}=S0(Z.tieFormat),Ei=wt===rt,Be=!Ei&&Le,nt=Z.tieFormat&&!Ei&&rt,Ii=((ae=K==null?void 0:K.filter(be=>be.structureId===Z.structureId))==null?void 0:ae.length)||0;return{...u,tournamentId:c,eventId:b,structureId:Z.structureId,drawId:G,eventType:y,category:xe,categoryName:Re,ageCategoryCode:he,flightNumber:E[G],drawType:V,stage:Z.stage,seedingBasis:re?JSON.stringify(re):void 0,winningPersonId:ke,winningPersonOtherId:Pe,winningPersonTennisId:it,winningPersonWTNrating:me,winningPersonWTNconfidence:It,winningPerson2Id:pe,winningPerson2OtherId:Fe,winningPerson2TennisId:De,winningPerson2WTNrating:ue,winningPerson2WTNconfidence:je,winningTeamId:de,positionManipulations:Ii,pctNoRating:q,matchUpFormat:Ee,pctInitialMatchUpFormat:we,matchUpsCount:z,drawTieFormatName:Ue,drawTieFormatDesc:wt,tieFormatName:Be,tieFormatDesc:nt,avgConfidence:W,avgWTN:Y}})})});return a.forEach(({eventName:f,drawName:g,structureId:v})=>{var y;(y=o[v])!=null&&y.length&&l.push({eventName:f,drawName:g,actions:o[v]})}),{eventStructureReports:Object.values(s),structureReports:h,flightReports:l}}function Y1e({extensions:t}){var e,i;return(i=(e=t==null?void 0:t.find(({name:r})=>r===bf))==null?void 0:e.value)==null?void 0:i.slice(1)}function K1e({ignoreDisabled:t=!0,tournamentRecords:e,tournamentId:i,venueIds:r=[],dates:n=[]}){var a,o;if(!Array.isArray(n))return{error:se,dates:n};if(!Array.isArray(r))return{error:se,venueIds:r};if(!(e&&Object.keys(e).filter(p=>!i||p===i)||[]).length)return{error:xi};if(!n.every(ba))return{error:Fr};let s=rc({tournamentRecords:e,ignoreDisabled:t,dates:n});if(s.error)return s;let l=(a=s==null?void 0:s.venues)==null?void 0:a.filter(({venueId:p})=>!(r!=null&&r.length)||r.includes(p)),u=(o=s.courts)==null?void 0:o.reduce((p,m)=>{var h;return(h=m.dateAvailability)==null||h.forEach(f=>{let g=f.date;p.includes(g)||p.push(g)}),p},[]).filter(p=>!n.length||n.includes(p)),c={venueIds:l==null?void 0:l.map(({venueId:p})=>p)},{matchUps:d}=Os({afterRecoveryTimes:!0,tournamentRecords:e,matchUpFilters:c});return{venuesReport:l==null?void 0:l.map(p=>X1e(u,p,d))}}function X1e(t,e,i){let{venueId:r,courts:n,venueName:a}=e,o={};return t.forEach(s=>{var l;let u=0,c=0,d=0;for(let h of n){let f=h.dateAvailability.find(v=>v.date===s),g=(l=f&&Ov({courtDate:f}).timeSlots)==null?void 0:l.reduce((v,y)=>{let{startTime:I,endTime:b}=y,S=xt(b)-xt(I);return v+S},0);g&&(d+=1),u+=g}let p=i.filter(({schedule:h})=>h.venueId===r&&ql(s,h.scheduledDate));p.forEach(({schedule:h})=>{let f=Ui(h.scheduledTime),g=ra(f,h.averageMinutes),v=xt(g)-xt(f);c+=v});let m=u?(c/u*100).toFixed(2):"100";o[s]={scheduledMatchUpsCount:p.length,availableCourts:d,availableMinutes:u,scheduledMinutes:c,percentUtilization:m}}),{venueId:r,venueName:a,venueReport:o}}var xie={};bt(xie,{addMatchUpCourtOrder:()=>M$,addMatchUpEndTime:()=>A$,addMatchUpOfficial:()=>bte,addMatchUpResumeTime:()=>k$,addMatchUpScheduleItems:()=>JR,addMatchUpScheduledDate:()=>KR,addMatchUpScheduledTime:()=>ld,addMatchUpStartTime:()=>N$,addMatchUpStopTime:()=>O$,addSchedulingProfileRound:()=>q$,allocateTeamMatchUpCourts:()=>XR,assignMatchUpCourt:()=>Hh,assignMatchUpVenue:()=>xv,bulkRescheduleMatchUps:()=>Gie,bulkScheduleMatchUps:()=>nU,bulkScheduleTournamentMatchUps:()=>wy,bulkUpdateCourtAssignments:()=>$ie,calculateScheduleTimes:()=>J$,clearMatchUpSchedule:()=>zie,clearScheduledMatchUps:()=>ZR,courtGridRows:()=>kR,findMatchUpFormatTiming:()=>NR,findVenue:()=>nu,generateBookings:()=>QR,generateVirtualCourts:()=>HR,getMatchUpsToSchedule:()=>MR,getPersonRequests:()=>Fp,getProfileRounds:()=>OR,getScheduledRoundsDetails:()=>qw,getSchedulingProfile:()=>nc,getSchedulingProfileIssues:()=>K_,matchUpScheduleChange:()=>Hie,modifyMatchUpFormatTiming:()=>h$,mutate:()=>Fie,proAutoSchedule:()=>_ie,proConflicts:()=>Vie,publicFindCourt:()=>DL,query:()=>gee,removeEventMatchUpFormatTiming:()=>VR,removeMatchUpCourtAssignment:()=>Lie,reorderUpcomingMatchUps:()=>jie,scheduleMatchUps:()=>Bie,scheduleProfileRounds:()=>eE,setMatchUpDailyLimits:()=>Wie,setMatchUpHomeParticipantId:()=>C$,setSchedulingProfile:()=>Ev,toggleParticipantCheckInState:()=>WR,validateSchedulingProfile:()=>AR});var Fie={};bt(Fie,{addMatchUpCourtOrder:()=>M$,addMatchUpEndTime:()=>A$,addMatchUpOfficial:()=>bte,addMatchUpResumeTime:()=>k$,addMatchUpScheduleItems:()=>JR,addMatchUpScheduledDate:()=>KR,addMatchUpScheduledTime:()=>ld,addMatchUpStartTime:()=>N$,addMatchUpStopTime:()=>O$,addSchedulingProfileRound:()=>q$,allocateTeamMatchUpCourts:()=>XR,assignMatchUpCourt:()=>Hh,assignMatchUpVenue:()=>xv,bulkRescheduleMatchUps:()=>Gie,bulkScheduleMatchUps:()=>nU,bulkScheduleTournamentMatchUps:()=>wy,bulkUpdateCourtAssignments:()=>$ie,calculateScheduleTimes:()=>J$,clearMatchUpSchedule:()=>zie,clearScheduledMatchUps:()=>ZR,findMatchUpFormatTiming:()=>NR,generateBookings:()=>QR,generateVirtualCourts:()=>HR,matchUpScheduleChange:()=>Hie,modifyMatchUpFormatTiming:()=>h$,proAutoSchedule:()=>_ie,proConflicts:()=>Vie,removeEventMatchUpFormatTiming:()=>VR,removeMatchUpCourtAssignment:()=>Lie,reorderUpcomingMatchUps:()=>jie,scheduleMatchUps:()=>Bie,scheduleProfileRounds:()=>eE,setMatchUpDailyLimits:()=>Wie,setMatchUpHomeParticipantId:()=>C$,setSchedulingProfile:()=>Ev,toggleParticipantCheckInState:()=>WR,validateSchedulingProfile:()=>AR});function J$({calculateStartTimeFromCourts:t=!0,defaultRecoveryMinutes:e=0,averageMatchUpMinutes:i=90,remainingScheduleTimes:r,clearScheduleDates:n,tournamentRecords:a,periodLength:o,scheduleDate:s,startTime:l,venueIds:u,endTime:c}){if(typeof a!="object"||!Object.keys(a).length)return{error:xi};o=o??zR({recoveryMinutes:e,averageMatchUpMinutes:i});let{courts:d,venues:p}=rc({dates:[s],ignoreDisabled:!0,tournamentRecords:a}),m=d==null?void 0:d.filter(P=>!u||u.includes(P.venueId));l||(l=m==null?void 0:m.reduce((P,E)=>{var R,N;let A=((N=(R=E.dateAvailability)==null?void 0:R.find(M=>!M.date||ql(s,M.date)))==null?void 0:N.startTime)??E.startTime;return A&&(!P||xt(A)<xt(P))?A:P},void 0)),c||(c=m==null?void 0:m.reduce((P,E)=>{var R,N;let A=((N=(R=E.dateAvailability)==null?void 0:R.find(M=>!M.date||ql(s,M.date)))==null?void 0:N.endTime)??E.endTime;return A&&(!P||xt(A)>xt(P))?A:P},void 0));let h=Object.values(a),f=Object.assign({},...h.map(P=>(P.events??[]).map(E=>{let{scheduleTiming:R}=pw({tournamentRecord:P,event:E});return{[E.eventId]:{event:E,scheduleTiming:R}}})).flat()),g=Xw({sortDateMatchUps:!1,tournamentRecords:a,matchUpFilters:{scheduledDate:s,venueIds:u}}),v=(g==null?void 0:g.dateMatchUps)??[],y=(g==null?void 0:g.completedMatchUps)??[],I=[];I.push(...v),I.push(...y);let b={averageTimes:[{minutes:{default:i}}],recoveryTimes:[{minutes:{default:e}}]},S=I==null?void 0:I.map(({eventId:P,schedule:E,matchUpFormat:R})=>{let{event:N,scheduleTiming:A}=f[P],M=N==null?void 0:N.eventType,C={...A,defaultTiming:b,matchUpFormat:R},{averageMinutes:O,recoveryMinutes:k}=KP({eventType:M,timingDetails:C}),{courtId:x,venueId:F}=E,$=Ui(E.scheduledTime),_=ra($,O);return{recoveryMinutes:k,averageMinutes:O,periodLength:o,startTime:$,endTime:_,courtId:x,venueId:F}}),w={calculateStartTimeFromCourts:t,remainingScheduleTimes:r,averageMatchUpMinutes:i,date:s,clearScheduleDates:n,periodLength:o,startTime:l,endTime:c,bookings:S,courts:m},{scheduleTimes:U}=S$(w),T=(u==null?void 0:u.length)===1&&u[0]||(p==null?void 0:p.length)===1&&p[0].venueId||void 0,D=I.map(Pr);return{venueId:T,scheduleTimes:U,dateScheduledMatchUpIds:D}}function Lie(t){var e;let i=We(t,[{[fn]:!0}]);if(i.error)return i;let{removePriorValues:r,tournamentRecords:n,tournamentId:a,courtDayDate:o,matchUpId:s,courtId:l,drawId:u}=t,c=n[a];if(!c)return{error:ve};let{drawDefinition:d,event:p}=sd({tournamentRecord:c,drawId:u});if(!d)return{error:$e};let m=Si({drawDefinition:d,event:p,matchUpId:s});if(m.error)return m;if(((e=m==null?void 0:m.matchUp)==null?void 0:e.matchUpType)===Ba){let{itemValue:h}=Ap({timeItems:m.matchUp.timeItems??[],itemType:Ql}),f=l&&h.filter(g=>g.courtId!==l);return Na({duplicateValues:!1,removePriorValues:r,tournamentRecord:c,drawDefinition:d,matchUpId:s,timeItem:{itemType:Ql,itemValue:f}})}else return Hh({tournamentRecord:c,drawDefinition:d,courtDayDate:o,courtId:"",matchUpId:s})}function _ie({scheduleCompletedMatchUps:t,tournamentRecords:e,scheduledDate:i,matchUps:r}){if(!Ro(r))return{error:se};if(r.some(({hasContext:m})=>!m))return{info:"matchUps must have { inContext: true, nextMatchUps: true }",error:mP};let n=Xw({courtCompletedMatchUps:!0,withCourtGridRows:!0,minCourtGridRows:10,tournamentRecords:e,matchUpFilters:{localPerspective:!0,scheduledDate:i}});if(n.error)return n;let{rows:a}=n,o=[],s=m=>[(m.sides||[]).map(h=>{var f;return[h.participantId,(f=h.participant)==null?void 0:f.individualParticipantIds]}),(m.potentialParticipants||[]).flat().map(h=>[h.participantId,h.individualParticipantIds])].flat(1/0).filter(Boolean),l=a==null?void 0:a.reduce((m,h)=>{let f=[],g=[];Object.values(h).forEach(y=>{if(At(y)&&(y.matchUpId&&(f.push(y.matchUpId),o.push(y)),y.sides)){let I=s(y);g.push(...I)}});let v=Object.values(h).filter(y=>At(y)&&!y.matchUpId);return m.concat({matchUpIds:f,availableCourts:v,rowId:h.rowId,participantIds:g})},[]);r.filter(({matchUpStatus:m})=>m&&m!==jt&&(t||!yr.includes(m))).sort(xh);let u=ps({matchUps:r.concat(o),includeParticipantDependencies:!0,tournamentRecords:e}).matchUpDependencies,c=[],d=[];for(;r.length&&l.length;){let m=l.shift(),h=[];for(;r.length&&m.availableCourts.length;){let f=r.concat(h).map(T=>T.matchUpId),g=r.shift(),v=g==null?void 0:g.matchUpId,y=v&&u[v].matchUpIds.concat(u[v].dependentMatchUpIds),I=v&&f.some(T=>u[v].matchUpIds.includes(T)),b=v&&d.some(T=>u[v].dependentMatchUpIds.includes(T)),S=m.matchUpIds.some(T=>y.includes(T)),w=s(g),U=m.participantIds.some(T=>w.includes(T));if(g&&!S&&!I&&!U&&!b){let T=m.availableCourts.shift();Object.assign(g.schedule,T.schedule),Object.assign(T,g),c.push(g),m.participantIds.push(...w),m.matchUpIds.push(v)}else g&&h.push(g)}r.push(...h),d.push(...m.matchUpIds)}let p=c.map(({matchUpId:m,tournamentId:h,schedule:f,drawId:g})=>({tournamentId:h,matchUpId:m,drawId:g,schedule:{...f,scheduledDate:i}}));return n=nU({tournamentRecords:e,matchUpDetails:p}),{...n,scheduled:c,notScheduled:r}}function $ie(t){let{courtDayDate:e}=t,i=We(t,[{courtAssignments:!0,[Jn]:cn,[Ha]:Je},{[fn]:!0}]);if(i.error)return i;let r=t.courtAssignments.reduce((a,o)=>{let{tournamentId:s}=o;return a[s]||(a[s]=[]),a[s].push(o),a},{}),n;return Object.keys(r).every(a=>{let o=t[fn][a];if(!o)return n={error:ve},!1;let s=r[a].reduce((l,u)=>{let{drawId:c}=u;return l[c]||(l[c]=[]),l[c].push(u),l},{});Object.keys(s).every(l=>{let{drawDefinition:u}=Kn({tournamentRecord:o,drawId:l});return u?(s[l].every(c=>{let{matchUpId:d,courtId:p}=c,m=Hh({tournamentRecord:o,drawDefinition:u,courtDayDate:e,matchUpId:d,courtId:p});if(m.success)return m==null?void 0:m.success;n={error:O9}}),!0):(n={error:$e},!1)})}),n||Q}function Bie(t){let{tournamentRecords:e,allDateMatchUpIds:i=[],averageMatchUpMinutes:r=90,recoveryMinutes:n=0,recoveryMinutesMap:a,matchUpPotentialParticipantIds:o={},individualParticipantProfiles:s={},matchUpNotBeforeTimes:l={},matchUpDailyLimits:u={},checkPotentialRequestConflicts:c=!0,remainingScheduleTimes:d,clearScheduleDates:p,periodLength:m=30,scheduleDate:h,matchUpIds:f,venueIds:g,startTime:v,endTime:y,dryRun:I}=t,b=We(t,[{[fn]:!0,[aw]:!0},{[Xr]:ba,[Ha]:Fr,[USe]:!0},{[Xr]:V=>!V||!isNaN(V),[PSe]:!1,[Ha]:se,[RSe]:!1,[ESe]:!1}]);if(b.error)return b;let S=t.competitionMatchUps??Os({nextMatchUps:!0,tournamentRecords:e}).matchUps??[],w=t.matchUpDependencies??ps({includeParticipantDependencies:!0,matchUps:S,tournamentRecords:e}).matchUpDependencies;S.forEach(V=>{var G;(G=V.schedule)!=null&&G.scheduledDate&&ql(h,mt(V.schedule.scheduledDate))&&gg({matchUpPotentialParticipantIds:o,matchUpNotBeforeTimes:l,matchUp:V})});let U=f.map(V=>S.find(G=>G.matchUpId===V)).filter(Boolean),{venueId:T,scheduleTimes:D,dateScheduledMatchUpIds:P}=J$({tournamentRecords:e,remainingScheduleTimes:d,startTime:Ui(v),endTime:Ui(y),scheduleDate:mt(h),averageMatchUpMinutes:r,clearScheduleDates:p,periodLength:m,venueIds:g}),E={},R=[],N={},A={},M={};S.filter(({matchUpId:V})=>P==null?void 0:P.includes(V)).forEach(V=>{var G;QM({matchUpPotentialParticipantIds:o,individualParticipantProfiles:s,matchUp:V,value:1});let j=(G=V.schedule)==null?void 0:G.scheduledTime;if(j){N[V.matchUpId]=j;let z=a==null?void 0:a[V.matchUpId];by({recoveryMinutes:z||n,matchUpPotentialParticipantIds:o,individualParticipantProfiles:s,matchUpNotBeforeTimes:l,averageMatchUpMinutes:r,matchUpDependencies:w,scheduleTime:j,matchUp:V})}});let C=U.filter(V=>{let G=P==null?void 0:P.includes(V.matchUpId),j=[jt,Pt,Ki,ua,zr,Ft].includes(V==null?void 0:V.matchUpStatus);return!G&&!V.winningSide&&!j}),{matchUpMap:O,overLimitMatchUpIds:k,participantIdsAtLimit:x}=C.reduce((V,G)=>{let{drawId:j,tournamentId:z,matchUpType:W}=G,{participantIdsAtLimit:q,relevantParticipantIds:Y}=G$({individualParticipantProfiles:s,matchUpPotentialParticipantIds:o,matchUpDailyLimits:u,matchUp:G});return q!=null&&q.length?(V.overLimitMatchUpIds.push(G.matchUpId),V.participantIdsAtLimit.push(...q),V):(Y.forEach(re=>{iU({individualParticipantProfiles:s,participantId:re});let K=s[re].counters;K[W]?K[W]+=1:K[W]=1,K[Yo]?K[Yo]+=1:K[Yo]=1}),V.matchUpMap[z]||(V.matchUpMap[z]={}),V.matchUpMap[z][j]?V.matchUpMap[z][j].push(G):V.matchUpMap[z][j]=[G],gg({matchUpPotentialParticipantIds:o,matchUpNotBeforeTimes:l,matchUp:G}),V)},{matchUpMap:{},overLimitMatchUpIds:[],participantIdsAtLimit:[]});C=C.filter(({matchUpId:V})=>!k.includes(V));let F=0,$=(D==null?void 0:D.length)??0,{personRequests:_}=Fp({tournamentRecords:e,requestType:rU});for(;D!=null&&D.length&&C.length&&F<=$;){F++;let{scheduleTime:V}=D.shift(),G=C.find(j=>{let{matchUpId:z}=j,{dependenciesScheduled:W,remainingDependencies:q}=B$({matchUpScheduleTimes:N,matchUpDependencies:w,allDateMatchUpIds:i,matchUp:j});if(!W)return M[z]||(M[z]=[]),M[z].push({scheduleTime:V,remainingDependencies:q}),!1;let{enoughTime:Y}=j$({individualParticipantProfiles:s,matchUpNotBeforeTimes:l,matchUpDependencies:w,scheduleTime:V,matchUp:j});if(!Y)return A[z]||(A[z]=[]),A[z].push({scheduleTime:V}),!1;let{conflicts:re}=V$({potentials:c,averageMatchUpMinutes:r,requestConflicts:E,personRequests:_,scheduleTime:V,scheduleDate:h,matchUp:j});if(re!=null&&re.length)return!1;let K=a==null?void 0:a[j.matchUpId];return by({recoveryMinutes:K||n,matchUpPotentialParticipantIds:o,individualParticipantProfiles:s,matchUpNotBeforeTimes:l,averageMatchUpMinutes:r,matchUpDependencies:w,scheduleTime:V,matchUp:j}),N[j.matchUpId]=V,!0});C=C.filter(({matchUpId:j})=>j!==(G==null?void 0:G.matchUpId)),G||R.push(V)}C.forEach(V=>{QM({individualParticipantProfiles:s,matchUpPotentialParticipantIds:o,value:-1,matchUp:V})});let L=[];Object.keys(O).forEach(V=>{let G=e[V];G&&Object.keys(O[V]).forEach(j=>{let{drawDefinition:z}=sd({tournamentRecord:G,drawId:j});z&&O[V][j].forEach(({matchUpId:W})=>{let q=N[W];if(q){let Y=q.split(":").map(oo).join(":"),re=`${mt(h)}T${Y}`;I?L.push(W):(ld({drawDefinition:z,matchUpId:W,scheduledTime:re}).success&&L.push(W),T&&xv({tournamentRecords:e,tournamentRecord:G,drawDefinition:z,matchUpId:W,venueId:T}))}})})});let B=qF(C);return{...Q,requestConflicts:Object.values(E),remainingScheduleTimes:D==null?void 0:D.map(({scheduleTime:V})=>V),individualParticipantProfiles:s,matchUpNotBeforeTimes:l,participantIdsAtLimit:x,skippedScheduleTimes:R,overLimitMatchUpIds:k,scheduledMatchUpIds:L,noTimeMatchUpIds:B,recoveryTimeDeferred:A,dependencyDeferred:M}}function Vie({tournamentRecords:t,matchUps:e}){if(!Ro(e))return{error:Ju};if(e.some(({matchUpId:m,hasContext:h})=>m&&!h))return{info:"matchUps must have { inContext: true, nextMatchUps: true }",error:mP};let i=Math.max(...e.map(({schedule:m})=>(m==null?void 0:m.courtOrder)||1).map(m=>Ze(m))),r=Te(1,i+1).map(m=>e.filter(h=>{var f;return Ze((f=h.schedule)==null?void 0:f.courtOrder)===m})),n={},a={},o={};r.flat().filter(Boolean).sort(xh).forEach(({schedule:m})=>delete m[tS]);let s=dt(e.map(({drawId:m})=>m)),l=ps({includeParticipantDependencies:!0,tournamentRecords:t,drawIds:s}).matchUpDependencies,u=r.map((m,h)=>m.reduce((f,g)=>{if(!g.matchUpId)return f;let{matchUpId:v,winnerMatchUpId:y,loserMatchUpId:I,schedule:b,sides:S,potentialParticipants:w}=g,U=b==null?void 0:b.courtId;n[v]=h,a[U]=[],f.matchUpIds.push(v),o[v]=g;let T=l[v].matchUpIds;T.length&&f.sourceMatchUpIds.push(...T);let D=(S==null?void 0:S.map(E=>{var R;return[(R=E.participant)==null?void 0:R.individualParticipantIds,E.participantId]}).flat().filter(Boolean))??[],P=(w==null?void 0:w.flat().map(({individualParticipantIds:E,participantId:R})=>[E,R]).flat().filter(Boolean))||[];return f.participantIds.push(...P,...D),y&&f.targetMatchUpIds.push(y),I&&f.targetMatchUpIds.push(I),f},{sourceMatchUpIds:[],targetMatchUpIds:[],participantIds:[],matchUpIds:[]})),c=(m,h)=>l[m].sources.reduce((f,g,v)=>g.includes(h)&&v+1||f,0),d=u.map(()=>[]),p=(m,h,f,g)=>{if(!o[m].schedule[tS]){o[m].schedule[tS]=h,o[m].schedule[aJ]=g,d[n[m]].push({matchUpId:m,issueType:f,issueIds:g,issue:h});let v=o[m].schedule.courtId;a[v]||(a[v]=[]),a[v].push({matchUpId:m,issue:h,issueType:f,issueIds:g})}};return u.forEach((m,h)=>{let f=h?u[h-1]:void 0,g=u.slice(h+1),v={},y=Pa(m.participantIds),I=Object.keys(y).filter(w=>y[w]>1),b=m.matchUpIds.filter(w=>l[w].participantIds.some(U=>I.includes(U)));b.forEach(w=>{v[w]||(v[w]={}),v[w][md]||(v[w][md]=b.filter(U=>U!==w))});let S=f&&m.participantIds.filter(w=>f.participantIds.includes(w));S&&S.forEach(w=>{let U=m.matchUpIds.concat(f.matchUpIds).filter(T=>l[T].participantIds.includes(w));U.forEach(T=>{v[T]||(v[T]={}),v[T][hd]||(v[T][hd]=U.filter(D=>D!==T))})}),m.matchUpIds.forEach(w=>{var U,T,D,P;let E=l[w].matchUpIds;for(let N of g){let A=N.matchUpIds.filter(M=>E.includes(M));A!=null&&A.length&&(A.forEach(M=>p(M,DM,uc,[w])),p(w,DM,uc,A))}if((U=v[w])!=null&&U[md]&&p(w,md,TM,v[w][md]),m.sourceMatchUpIds.includes(w)){let N=m.matchUpIds.filter(A=>l[A].matchUpIds.includes(w));p(w,md,uc,N),m.matchUpIds.filter(A=>l[A].matchUpIds.includes(w)).forEach(A=>p(A,md,uc,[w]))}let R=(T=f==null?void 0:f.matchUpIds)==null?void 0:T.filter(N=>c(w,N)>1);if(R!=null&&R.length&&(p(w,PM,uc,R),R.forEach(N=>p(N,PM,uc,[w]))),(D=v[w])!=null&&D[hd]&&p(w,hd,TM,v[w][hd]),(P=f==null?void 0:f.targetMatchUpIds)==null?void 0:P.includes(w)){let N=o[w].schedule.courtId,A=E.filter(M=>f.matchUpIds.includes(M));A.some(M=>o[M].schedule.courtId===N)||(A.forEach(M=>p(M,hd,uc,[w])),p(w,hd,uc,A))}})}),{courtIssues:a,rowIssues:d}}function jie(t){let e="reorderUpcomingMatchUps",{tournamentRecords:i}=t;if(typeof i!="object"||!Object.keys(i).length)return te({result:{error:xi},stack:e});let{matchUpsContextIds:r,firstToLast:n}=t;if(!r)return te({result:{error:Je},stack:e});let a=r==null?void 0:r.length;if(!a)return{...Q};let o=0;return r.forEach((l,u)=>{let{tournamentId:c,drawId:d,matchUpId:p}=l,m=u+(n?-1:1);m<0&&(m=a-1),m===a&&(m=0);let h=r[m].schedule.scheduledTime,f=s({tournamentId:c,scheduledTime:h,matchUpId:p,drawId:d});if(f.success)o++;else return f}),o===a?Q:te({result:{error:A9},stack:e});function s({tournamentId:l,scheduledTime:u,matchUpId:c,drawId:d}){let p=i[l],{drawDefinition:m}=sd({tournamentRecord:p,drawId:d});return m?ld({drawDefinition:m,scheduledTime:u,matchUpId:c}):{error:Va}}}function Gie(t){var e,i;let{scheduleChange:r,matchUpIds:n,dryRun:a}=t;if(!n||!Array.isArray(n))return{error:gh};if(typeof r!="object")return{error:se};let o=To(t),s=[],l=[];for(let c of Object.values(o)){let d=J1e({tournamentRecord:c,scheduleChange:r,matchUpIds:n,dryRun:a});if(d.error)return d;Array.isArray(d.notRescheduled)&&l.push(...d.notRescheduled);let p=qF(d.notRescheduled),m=[];(e=d.rescheduled)==null||e.forEach(h=>{let{matchUpId:f}=h;p.includes(f)&&m.push(f),s.push(h)}),m.length&&(l=((i=d==null?void 0:d.notRescheduled)==null?void 0:i.filter(({matchUpId:h})=>!m.includes(h)))||[])}let u=!!(s.length&&!l.length);return{...Q,rescheduled:s,notRescheduled:l,allRescheduled:u}}function J1e({tournamentRecord:t,scheduleChange:e,matchUpIds:i,dryRun:r}){var n;if(!t)return{error:ve};if(!i||!Array.isArray(i))return{error:gh};if(typeof e!="object")return{error:se};let a=[],o=[],{minutesChange:s,daysChange:l}=e;if(!s&&!l)return{...Q};if(s&&isNaN(s))return{error:se};if(l&&isNaN(l))return{error:se};let{matchUps:u}=Hr({matchUpFilters:{matchUpIds:i},tournamentRecord:t}),c=({matchUpStatus:S})=>!yr.includes(S),d=u==null?void 0:u.filter(S=>Kw({schedule:S.schedule})).filter(S=>c({matchUpStatus:S.matchUpStatus}));if(!(d!=null&&d.length))return{...Q};let{tournamentInfo:p}=jh({tournamentRecord:t}),{startDate:m,endDate:h}=p,f=d==null?void 0:d.reduce((S,w)=>{let{matchUpId:U,drawId:T}=w;return S[T]?S[T].push(U):S[T]=[U],S},{}),g=1440;for(let S of Object.keys(f)){let w=sd({tournamentRecord:t,drawId:S});if(w.error)return w;let U=w.drawDefinition,T=f[S].filter(D=>i.includes(D));for(let D of T)if(D&&U){let P=(n=d.find(C=>C.matchUpId===D))==null?void 0:n.schedule,{scheduledTime:E,scheduledDate:R}=P,N,A,M;if(!N&&l&&R){let C=mt(R);M=Hv(C,l),N=new Date(M)<new Date(m)||new Date(M)>new Date(h)}if(s&&E){let C=mt(E),O=xt(Ui(E))+s;if(N=O<0||O>g,!N){let k=ra(E,s),x=C&&M||R===C&&C;A=x?`${x}T${k}`:k}}if(N)o.push(D);else{if(!r){if(A){let C=ld({scheduledTime:A,drawDefinition:U,matchUpId:D});if(C.error)return C}if(M){let C=KR({scheduledDate:M,drawDefinition:U,matchUpId:D});if(C.error)return C}}(A||M)&&a.push(D)}}}let v=Hr({matchUpFilters:{matchUpIds:i},tournamentRecord:t}).matchUps??[],y=v.filter(({matchUpId:S})=>a.includes(S)),I=v.filter(({matchUpId:S})=>o.includes(S)),b=y.length&&!I.length;return{...Q,rescheduled:y,notRescheduled:I,allRescheduled:b}}function Hie(t){let e="matchUpScheduleChange",{tournamentRecords:i}=t;if(typeof i!="object"||!Object.keys(i).length)return{error:xi};let{sourceMatchUpContextIds:r,targetMatchUpContextIds:n,sourceCourtId:a,targetCourtId:o,courtDayDate:s}=t||{},{drawId:l,matchUpId:u,tournamentId:c}=r||{},{drawId:d,matchUpId:p,tournamentId:m}=n||{};if(!u&&!p)return te({result:{error:Je},stack:e});let{matchUps:h}=Os({matchUpFilters:{matchUpIds:[u,p].filter(Boolean),drawIds:[l,d].filter(Boolean)},tournamentRecords:t.tournamentRecords}),f=h==null?void 0:h.find(({matchUpId:b})=>b===u),g=h==null?void 0:h.find(({matchUpId:b})=>b===p),v=0;if(o&&u&&!p){let b=y({tournamentId:c,matchUpId:u,courtId:o,matchUp:f,drawId:l,tournamentRecords:i,sourceCourtId:a,courtDayDate:s});if(b!=null&&b.success&&v++,b.error)return te({result:b,stack:e})}else if(a&&o&&u&&p){let b=y({tournamentId:c,matchUpId:u,courtId:o,matchUp:f,drawId:l,tournamentRecords:i,sourceCourtId:a,courtDayDate:s});if(b.success&&v++,b.error)return te({result:b,stack:e,info:"source"});let S=y({tournamentId:m,sourceCourtId:o,matchUpId:p,matchUp:g,courtId:a,drawId:d,tournamentRecords:i,courtDayDate:s});if(S.success&&v++,S.error)return te({result:S,stack:e,info:"target"})}else return{error:Je};return v?Q:te({result:{error:dv},stack:e});function y(b){let{tournamentRecords:S,tournamentId:w,matchUp:U,drawId:T}=b,D=S[w],{drawDefinition:P}=sd({tournamentRecord:D,drawId:T});return U.matchUpType===fi?I({...b,tournamentRecord:D,drawDefinition:P}):Hh({...b,tournamentRecord:D,drawDefinition:P})}function I({removePriorValues:b,tournamentRecords:S,tournamentRecord:w,drawDefinition:U,sourceCourtId:T,courtDayDate:D,matchUpId:P,matchUp:E,courtId:R}){let N=[R].concat(E.schedule.allocatedCourts.map(({courtId:A})=>A).filter(A=>A!==T));return XR({removePriorValues:b,tournamentRecords:S,tournamentRecord:w,drawDefinition:U,courtDayDate:D,matchUpId:P,courtIds:N})}}function zie({scheduleAttributes:t=[Ql,Lc,Ch,Mh,Nh,vs,$u,Fl,Iu],tournamentRecord:e,drawDefinition:i,matchUpId:r}){var n,a;let o="clearMatchUpSchedule",s=i?(n=Pn({matchUpFilters:{matchUpIds:[r]},inContext:!1,drawDefinition:i}).matchUps)==null?void 0:n[0]:(a=Hr({matchUpFilters:{matchUpIds:[r]},tournamentRecord:e,inContext:!1}).matchUps)==null?void 0:a[0];if(!s)return{error:hn};let l=(s.timeItems??[]).filter(u=>(u==null?void 0:u.itemType)&&!t.includes(u==null?void 0:u.itemType));return s.timeItems=l,Et({tournamentId:e.tournamentId,context:o,drawDefinition:i,matchUp:s}),{...Q}}function Wie(t){let{tournamentRecord:e,tournamentId:i,dailyLimits:r}=t,n=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(typeof n!="object"||!Object.keys(n).length)return{error:xi};if(typeof r!="object")return{error:Qu};let a=Object.keys(n).filter(o=>!i||i===o);if(i&&!a.includes(i))return{error:se};for(let o of a){let s=n[o],l=_t({extension:{name:sw,value:{dailyLimits:r}},element:s});if(l.error)return l}return{...Q}}var qie={};bt(qie,{addCollectionDefinition:()=>eB,addCollectionGroup:()=>Zie,aggregateTieFormats:()=>tre,compareTieFormats:()=>Bu,getTieFormat:()=>W_,modifyCollectionDefinition:()=>Q$,modifyTieFormat:()=>ere,mutate:()=>Yie,orderCollectionDefinitions:()=>Jie,query:()=>uee,removeCollectionDefinition:()=>Z$,removeCollectionGroup:()=>Xie,tieFormatGenderValidityCheck:()=>UP,validateCollectionDefinition:()=>tw});var Yie={};bt(Yie,{addCollectionDefinition:()=>eB,addCollectionGroup:()=>Zie,aggregateTieFormats:()=>tre,modifyCollectionDefinition:()=>Q$,modifyTieFormat:()=>ere,orderCollectionDefinitions:()=>Jie,removeCollectionDefinition:()=>Z$,removeCollectionGroup:()=>Xie});function op({drawDefinition:t,structureId:e,matchUpId:i,structure:r,matchUp:n,eventId:a,event:o}){var s;let l="getTieFormat",u;if(e=(r==null?void 0:r.structureId)??e,i=(n==null?void 0:n.matchUpId)??i,(i||e)&&!t)return{error:$e};if(a&&o)u=$s(o);else if(i){if(t&&(!n||!r)){let c=Si({drawDefinition:t,matchUpId:i});if(c.error)return c;if(((s=c.matchUp)==null?void 0:s.matchUpType)!==Ba)return te({result:{error:la},stack:l});r||(r=c.structure),n||(n=c.matchUp)}u=nI({item:n,drawDefinition:t,structure:r,event:o})||nI({item:r,drawDefinition:t,structure:r,event:o})||$s(t)||$s(o)}else if(t&&e){if(!r){let c=tt({drawDefinition:t,structureId:e});if(c.error)return c;r=c==null?void 0:c.structure}u=nI({item:r,drawDefinition:t,structure:r,event:o})||$s(t)||$s(o)}else u=$s(t)||$s(o);return u?{...Q,structure:r,tieFormat:u,matchUp:n}:te({result:{error:lv},stack:l})}function N0({matchUp:t,updateInProgressMatchUps:e}){return!t.winningSide&&![yr].includes(t.matchUpStatus)&&(e||t.matchUpStatus!==cs&&!br(t))}function tC({from:t,to:e}){let i=Object.keys(t),r=ji(i,Object.keys(e)).length===i.length,n=i.filter(o=>t[o]!==e[o]).map(o=>({countChange:e[o]-t[o],collectionId:o})),a=i.every(o=>t[o]===e[o]);return{equivalent:r&&a,matchUpsCountChanges:n}}function Q1e({updateInProgressMatchUps:t,tournamentRecord:e,drawDefinition:i,structure:r,tieFormat:n,eventId:a,matchUp:o,event:s,uuids:l}){var u,c,d,p;let m="updateTieFormat",h=e==null?void 0:e.tournamentId,f=0,g=0,v=0,y=0,I=n==null?void 0:n.collectionDefinitions.reduce((P,E)=>(P[E.collectionId]=(P[E.collectionId]||0)+E.matchUpCount,P),{}),b=({tieFormat:P})=>{let E=P==null?void 0:P.collectionDefinitions.reduce((R,N)=>(R[N.collectionId]=(R[N.collectionId]||0)+N.matchUpCount,R),{});return tC({from:E,to:I}).equivalent},S=(u=op({drawDefinition:i}))==null?void 0:u.tieFormat,w=(c=op({event:s}))==null?void 0:c.tieFormat;if(s&&a){for(let P of s.drawDefinitions??[])U({drawDefinition:P});s.tieFormat=Yr(n),y+=1}else if(o){if(!o.tieMatchUps)return te({result:{error:la},stack:m});let P=Pa((d=o.tieMatchUps)==null?void 0:d.map(({collectionId:M})=>M)),E=tC({to:I,from:P}),{changes:R,changesArePossible:N,cannotChangeReaon:A}=mj({matchUp:o,check:E});if(E.equivalent)if(N0({matchUp:o,updateInProgressMatchUps:t}))o.tieFormat=Yr(n),y+=1;else return te({result:{error:nF},info:"matchUp is IN_PROGRESS or COMPLETE",stack:m});else if(N)D({tieFormat:n,matchUp:o,changes:R,uuids:l});else return te({context:{collectionMap:I,matchUpMap:P},result:{error:kl},info:A||"specified changes not possible",stack:m});g+=1,Et({eventId:s==null?void 0:s.eventId,context:m,drawDefinition:i,tournamentId:h,matchUp:o})}else if(r){let P=(p=T({inheritedTieFormat:S??w,structure:r}))==null?void 0:p.modifiedMatchUpsCount;P&&(g+=P,f+=1,y+=1);let E=!r.tieFormat||Bu({ancestor:r.tieFormat,descendant:n}).different;E&&(r.tieFormat=Yr(n),f+=1,y+=1),(P||E)&&i&&ui({structureIds:[r.structureId],eventId:s==null?void 0:s.eventId,drawDefinition:i})}else if(i)U({drawDefinition:i}),i.tieFormat=Yr(n),y+=1;else return{error:$e};return{modifiedStructuresCount:f,modifiedMatchUpsCount:g,addedMatchUpsCount:v,modifiedCount:y,...Q,tieFormat:n};function U({drawDefinition:P}){var E;let R=P.structures||[],N=[];for(let A of R){if(A.tieFormat)continue;let M=(E=T({inheritedTieFormat:w,structure:A}))==null?void 0:E.modifiedMatchUpsCount;if(M){f+=1,g+=M;let C=A.structureId;N.push(C)}}return ui({structureIds:N,eventId:s==null?void 0:s.eventId,drawDefinition:P}),N.length}function T({inheritedTieFormat:P,structure:E}){var R,N;let A=0,M=((R=qt({matchUpFilters:{matchUpTypes:[fi]},structure:E}))==null?void 0:R.matchUps)||[];for(let C of M){let O=N0({matchUp:C,updateInProgressMatchUps:t}),k=!1,x=Pa((N=C.tieMatchUps)==null?void 0:N.map(({collectionId:$})=>$)),F=tC({from:x,to:I});if(F.equivalent)C.tieFormat&&b(C)&&O&&(C.tieFormat=Yr(n),k=!0);else{let{changes:$,changesArePossible:_}=mj({matchUp:C,check:F});if(_&&!C.tieFormat)D({changes:$,matchUp:C,tieFormat:n,uuids:l});else if(P)(!C.tieFormat||Bu({ancestor:P,descendant:C.tieFormat}).different)&&(C.tieFormat=P,k=!0);else return te({result:{error:lv},stack:m})}k&&(A+=1,Et({tournamentId:e==null?void 0:e.tournamentId,drawDefinition:i,context:m,eventId:a,matchUp:C}))}return{modifiedMatchUpsCount:A}}function D({uuids:P,matchUp:E,tieFormat:R,changes:N}){E.tieFormat=Yr(R);let A=[],M=[];return N.forEach(C=>{if(C.countChange>0){let O=Math.max(0,...E.tieMatchUps.filter(F=>F.collectionId===C.collectionId).map(Ma("collectionPosition"))),k=R.collectionDefinitions.find(F=>F.collectionId===C.collectionId),x=Lw({matchUpsLimit:C.countChange,collectionPositionOffset:O,collectionDefinition:k,matchUp:E,uuids:P});M.push(...Ne(x,!1,!0)),v+=M.length,E.tieMatchUps.push(...x)}else{let O=C.toBePlayedTieMatchUpIds.slice(0,Math.abs(C.countChange));console.log("remove",O.length),A.push(...O),E.tieMatchUps=E.tieMatchUps.filter(({matchUpId:k})=>!O.includes(k))}}),M.length&&xc({matchUps:M,drawDefinition:i,tournamentId:h,eventId:a}),A.length&&Zu({matchUpIds:A,action:"updateTieFormat",drawDefinition:i,tournamentId:h,eventId:a}),{matchUpIdsRemoved:A,matchUpsAdded:M}}}function mj({check:t,matchUp:e}){let i="",r=[];return{changesArePossible:t.matchUpsCountChanges.every(({collectionId:n,countChange:a})=>{let o=e.tieMatchUps.filter(l=>l.collectionId===n&&l.matchUpStatus===Qi).map(Ma("matchUpId")),s=o.length+a>=0||a>0;return!s&&a<0&&(i="Insufficient TO_BE_PLAYED matchUps"),r.push({toBePlayedTieMatchUpIds:o,collectionId:n,countChange:a}),s}),changes:r,cannotChangeReaon:i}}function nE({appliedPolicies:t,drawDefinition:e,auditData:i}){var r;if(!((r=t==null?void 0:t.audit)!=null&&r[iI]))return;let{extension:n}=vt({name:iI,element:e}),a={value:Array.isArray(n==null?void 0:n.value)?n==null?void 0:n.value.concat(i):[i],name:iI};_t({element:e,extension:a})}function Q$({updateInProgressMatchUps:t=!1,tournamentRecord:e,collectionOrder:i,collectionName:r,tieFormatName:n,drawDefinition:a,matchUpFormat:o,matchUpCount:s,collectionId:l,matchUpType:u,structureId:c,matchUpId:d,category:p,eventId:m,gender:h,event:f,collectionValueProfiles:g,collectionValue:v,matchUpValue:y,scoreValue:I,setValue:b}){let S="modifyCollectionDefinition";if(o&&!Ra({matchUpFormat:o}))return te({result:{error:se},context:{matchUpFormat:o},stack:S});if(r&&typeof r!="string")return te({result:{error:se},context:{collectionName:r},stack:S});if(h&&!Object.values(wF).includes(h))return te({result:{error:se},context:{gender:h},stack:S});if(p&&typeof p!="object")return te({result:{error:se},context:{category:p},stack:S});let w={collectionValueProfiles:g,collectionValue:v,matchUpValue:y,scoreValue:I,setValue:b};if(!Object.values(w).filter(Boolean).length&&!i&&!r&&!o&&!s&&!u)return te({result:{error:Je},stack:S});if(Object.values(w).filter(Boolean).length>1)return te({info:"Only one value assignment allowed per collectionDefinition",result:{error:se},stack:S});let U=op({drawDefinition:a,structureId:c,matchUpId:d,eventId:m,event:f});if(U.error)return te({result:U,stack:S});let{matchUp:T,structure:D,tieFormat:P}=U,E=Yr(P),R=P==null?void 0:P.collectionDefinitions.find(L=>L.collectionId===l),N=E==null?void 0:E.collectionDefinitions.find(L=>L.collectionId===l);if(!R)return te({info:"source collectionDefinition",result:{error:jr},context:{collectionId:l},stack:S});let A=v??y??I??b;if(g!=null&&g.length){let L=kK({matchUpCount:s??(R==null?void 0:R.matchUpCount)??0,collectionValueProfiles:g});if(L.errors)return te({result:{error:se},info:L.errors,stack:S})}else if(A&&!st(A))return te({result:{error:se},info:"value is not an integer",context:{value:A},stack:S});let M=(L,B)=>ji(Object.keys(L),Object.keys(B)).length===Object.keys(L).length&&ji(Object.values(L),Object.values(B)).length===Object.values(L).length,C=g&&(!R.collectionValueProfiles||!M(R.collectionValueProfiles,g)),O=st(v)&&R.collectionValue!==v||st(y)&&R.matchUpValue!==y||st(I)&&R.scoreValue!==I||st(b)&&R.setValue!==b||C,k=[];if(O&&(N.collectionValueProfiles=void 0,N.collectionValue=void 0,N.matchUpValue=void 0,N.scoreValue=void 0,N.setValue=void 0,Object.assign(N,w),k.push({collectionId:l,...He(w)})),(st(I)||st(b))&&N.collectionGroupNumber){let L=N.collectionGroupNumber;E.collectionDefinitions=E.collectionDefinitions.map(B=>{let{collectionGroupNumber:V,...G}=B;return V===L?G:B}),E.collectionGroups=E.collectionGroups.filter(({groupNumber:B})=>B!==L),k.push({collectionId:l,change:"collectionGroupNumber removed"})}let{aggregateValue:x,valueGoal:F}=Gh(E),$=He({aggregateValue:x,valueGoal:F});if(($.aggregateValue!==(P==null?void 0:P.winCriteria.aggregateValue)||$.valueGoal!==(P==null?void 0:P.winCriteria.valueGoal))&&(E.winCriteria=$,k.push({collectionId:l,winCriteria:$})),st(i)&&R.collectionOrder!==i&&(N.collectionOrder=i,k.push({collectionId:l,collectionOrder:i})),r&&R.collectionName!==r&&(N.collectionName=r,k.push({collectionId:l,collectionName:r})),o&&R.matchUpFormat!==o&&(N.matchUpFormat=o,k.push({collectionId:l,matchUpFormat:o})),st(s)&&R.matchUpCount!==s&&(N.matchUpCount=s,k.push({collectionId:l,matchUpCount:s})),u&&R.matchUpType!==u)return te({result:{error:gP},context:{matchUpType:u},stack:S});p&&R.category!==p&&(N.category=p,k.push({collectionId:l,category:p})),h&&R.gender!==h&&(N.gender=h,k.push({collectionId:l,gender:h}));let _=He(E);if(U=qn({tieFormat:_}),U.error)return te({result:U,stack:S});if(!k.length)return te({result:{...Q,modifications:k}});if((P==null?void 0:P.tieFormatName)!==n?(_.tieFormatName=n,k.push({tieFormatName:n})):k.length&&(delete _.tieFormatName,k.push("tieFormatName removed: modifications without new tieFormatName")),U=Q1e({tieFormat:_,updateInProgressMatchUps:t,tournamentRecord:e,drawDefinition:a,structure:D,eventId:m,matchUp:T,event:f}),!U.error){let{appliedPolicies:L}=Bt({tournamentRecord:e}),B=He({collectionDefinition:N,drawId:a==null?void 0:a.drawId,action:S,structureId:c,matchUpId:d,eventId:m});nE({appliedPolicies:L,drawDefinition:a,auditData:B})}return te({result:{...U,modifications:k},stack:S})}function Z1e({updateInProgressMatchUps:t,drawDefinition:e,structureId:i,structure:r,matchUpId:n,matchUp:a}){var o,s;let l=[];return n&&a?l=[a]:i&&r?l=((o=qt({matchUpFilters:{matchUpTypes:[fi]},structure:r}))==null?void 0:o.matchUps)??[]:e&&(l=((s=Pn({matchUpFilters:{matchUpTypes:[fi]},drawDefinition:e}))==null?void 0:s.matchUps)??[]),{targetMatchUps:l.filter(u=>!u.winningSide&&u.matchUpStatus!==Ki&&(t||u.matchUpStatus!==cs&&!br(u)))}}function eMe({updateInProgressMatchUps:t,tournamentRecord:e,drawDefinition:i,targetMatchUps:r,tieFormat:n,event:a}){for(let o of r){let s=!!o.tieFormat;s&&(o.tieFormat=Yr(n));let l;if(t){let u=Bt({tournamentRecord:e,drawDefinition:i,event:a}).appliedPolicies,c=ic({matchUpId:o.matchUpId,exitWhenNoValues:!0,tournamentRecord:e,appliedPolicies:u,drawDefinition:i,event:a});if(c.error)return c;l=c.score}s&&!l&&Et({tournamentId:e==null?void 0:e.tournamentId,context:"updateTargetTeamMatchUps",eventId:a==null?void 0:a.eventId,matchUp:o,drawDefinition:i})}return{...Q}}function Kie({updateInProgressMatchUps:t,originalValueGoal:e,tournamentRecord:i,wasAggregateValue:r,tieFormatName:n,drawDefinition:a,structureId:o,structure:s,tieFormat:l,matchUpId:u,matchUp:c,eventId:d,event:p}){let{aggregateValue:m,valueGoal:h}=Gh(l);l.winCriteria=He({aggregateValue:m,valueGoal:h}),(e&&e!==h||m&&!r)&&(n?l.tieFormatName=n:delete l.tieFormatName);let{targetMatchUps:f}=Z1e({updateInProgressMatchUps:t,drawDefinition:a,structureId:o,structure:s,matchUpId:u,matchUp:c});eMe({updateInProgressMatchUps:t,tournamentRecord:i,targetMatchUps:f,drawDefinition:a,tieFormat:l,event:p});let g=He(l),v=qn({tieFormat:g});if(v.error)return v;if(d&&p)p.tieFormat=g;else if(u&&c)c.tieFormat=l;else if(s)s.tieFormat=g;else if(a)a.tieFormat=g;else if(!c||!a)return{error:$e};return ui({drawDefinition:a,eventId:p==null?void 0:p.eventId}),{...Q}}function Xie({updateInProgressMatchUps:t=!0,collectionGroupNumber:e,tournamentRecord:i,drawDefinition:r,tieFormatName:n,structureId:a,matchUpId:o,matchUp:s,eventId:l,event:u}){if(!e)return{error:Je};if(isNaN(e))return{error:se};let c="removeCollectionGroup",d=s?void 0:op({drawDefinition:r,structureId:a,matchUpId:o,eventId:l,event:u});if(d!=null&&d.error)return te({result:d,stack:c});let p=d==null?void 0:d.structure;s=s??(d==null?void 0:d.matchUp);let m=d==null?void 0:d.tieFormat,h=m==null?void 0:m.winCriteria.valueGoal,f=m==null?void 0:m.winCriteria.aggregateValue,g=Yr(m);if(d=qn({tieFormat:g}),d.error)return te({result:d,stack:c});let v=[];if(g.collectionDefinitions=g.collectionDefinitions.map(y=>{let{collectionGroupNumber:I,...b}=y;return I!==e?y:(v.push(y.collectionId),b)}),g.collectionGroups=g.collectionGroups.filter(({groupNumber:y})=>y!==e),d=Kie({updateInProgressMatchUps:t,originalValueGoal:h,wasAggregateValue:f,tournamentRecord:i,drawDefinition:r,tieFormatName:n,structureId:a,structure:p,tieFormat:g,matchUpId:o,matchUp:s,eventId:l,event:u}),!d.error){let{appliedPolicies:y}=Bt({tournamentRecord:i}),I=He({drawId:r==null?void 0:r.drawId,collectionGroupNumber:e,action:c,structureId:a,matchUpId:o,eventId:l});nE({appliedPolicies:y,drawDefinition:r,auditData:I})}return te({result:{...d,modifiedCollectionIds:v},stack:c})}function Ig({tieFormat:t,orderMap:e}){var i;let r=Yr(t);return r.collectionDefinitions.forEach(n=>{let a=e[n.collectionId];a&&(n.collectionOrder=a)}),(i=r.collectionDefinitions)==null||i.sort((n,a)=>Yf(n.collectionOrder)-Yf(a.collectionOrder)),r}function Jie({tournamentRecord:t,drawDefinition:e,structureId:i,matchUpId:r,orderMap:n,eventId:a,matchUp:o,event:s}){if(typeof n!="object"||!Object.values(n).every(l=>st(l)))return te({result:{error:se},context:{orderMap:n}});if(a&&s!=null&&s.tieFormat)hj({tournamentRecord:t,event:s,orderMap:n});else if(r){let l=e&&Si({drawDefinition:e,matchUpId:r});if(l!=null&&l.error)return l;if(o=l.matchUp,!o)return{error:sa};o!=null&&o.tieFormat&&(o.tieFormat=Ig({tieFormat:o.tieFormat,orderMap:n}),Et({tournamentId:t==null?void 0:t.tournamentId,eventId:s==null?void 0:s.eventId,drawDefinition:e,matchUp:o}))}else if(i){let l=tt({drawDefinition:e,structureId:i});if(l.error)return l;let u=l.structure;if(u!=null&&u.tieFormat)u.tieFormat=Ig({tieFormat:u.tieFormat,orderMap:n}),Qie({eventId:s==null?void 0:s.eventId,tournamentRecord:t,drawDefinition:e,structure:u,orderMap:n}),ui({drawDefinition:e,structureIds:[u.structureId]});else if(e.tieFormat)ZM({structureIds:[i],tournamentRecord:t,drawDefinition:e,orderMap:n,event:s});else if(s!=null&&s.tieFormat)hj({structureIds:[i],tournamentRecord:t,orderMap:n,event:s});else return{error:jr}}else if(e!=null&&e.tieFormat)ZM({tournamentRecord:t,drawDefinition:e,orderMap:n,event:s});else return{error:jr};return{...Q}}function hj({tournamentRecord:t,structureIds:e,orderMap:i,event:r}){let n=Ig({tieFormat:r.tieFormat,orderMap:i});e!=null&&e.length||(r.tieFormat=n);for(let a of r.drawDefinitions??[])ZM({tournamentRecord:t,drawDefinition:a,structureIds:e,orderMap:i,event:r})}function ZM({tournamentRecord:t,drawDefinition:e,structureIds:i,orderMap:r,event:n}){let a=e.tieFormat??(n==null?void 0:n.tieFormat),o=Ig({tieFormat:a,orderMap:r});i!=null&&i.length||(e.tieFormat=o);let s=[];for(let l of e.structures??[])i!=null&&i.length&&!i.includes(l.structureId)||((l.tieFormat||i!=null&&i.includes(l.structureId))&&(l.tieFormat=Ig({tieFormat:l.tieFormat??e.tieFormat??(n==null?void 0:n.tieFormat),orderMap:r})),Qie({eventId:n==null?void 0:n.eventId,tournamentRecord:t,drawDefinition:e,structure:l,orderMap:r}),s.push(l.structureId));ui({drawDefinition:e,structureIds:s})}function Qie({tournamentRecord:t,drawDefinition:e,structure:i,orderMap:r,eventId:n}){var a;let o=(a=qt({matchUpFilters:{matchUpTypes:[fi]},structure:i}))==null?void 0:a.matchUps;for(let s of o)s.tieFormat&&(s.tieFormat=Ig({tieFormat:s.tieFormat,orderMap:r}),Et({tournamentId:t==null?void 0:t.tournamentId,drawDefinition:e,eventId:n,matchUp:s}))}function Z$({updateInProgressMatchUps:t=!0,tieFormatComparison:e,tournamentRecord:i,drawDefinition:r,tieFormatName:n,collectionId:a,structureId:o,matchUpId:s,eventId:l,matchUp:u,event:c}){var d,p,m,h,f;let g="removeCollectionDefinition",v=u?void 0:op({drawDefinition:r,structureId:o,matchUpId:s,eventId:l,event:c});if(v!=null&&v.error)return te({result:v,stack:g});let y=v==null?void 0:v.structure;u=u??(v==null?void 0:v.matchUp);let I=v==null?void 0:v.tieFormat,b=Yr(I);if(v=qn({tieFormat:b}),v.error)return te({result:v,stack:g});let S=(d=b==null?void 0:b.collectionDefinitions)==null?void 0:d.find(C=>C.collectionId===a);if(!S)return te({result:{error:jr,collectionId:a}});b.collectionDefinitions=b.collectionDefinitions.filter(C=>C.collectionId!==a),S.collectionGroupNumber&&(b.collectionDefinitions=b.collectionDefinitions.map(C=>{let{collectionGroupNumber:O,...k}=C;return k}),b.collectionGroups=b.collectionGroups.filter(({groupNumber:C})=>C!==S.collectionGroupNumber));let{aggregateValue:w,valueGoal:U}=Gh(b);b.winCriteria=He({aggregateValue:w,valueGoal:U});let T=I==null?void 0:I.winCriteria.valueGoal,D=I==null?void 0:I.winCriteria.aggregateValue;(T&&T!==U||w&&!D)&&(n?b.tieFormatName=n:delete b.tieFormatName);let P=[];s&&u?P=[u]:o&&y?P=((p=qt({matchUpFilters:{matchUpTypes:[fi]},structure:y}))==null?void 0:p.matchUps)??[]:r?P=((m=Pn({matchUpFilters:{matchUpTypes:[fi]},drawDefinition:r}))==null?void 0:m.matchUps)??[]:c&&(P=((h=au({matchUpFilters:{matchUpTypes:[fi]},drawDefinition:r}))==null?void 0:h.matchUps)??[]);let E=(P||[]).filter(C=>{var O,k,x;let F=(k=(O=C.tieMatchUps)==null?void 0:O.filter(_=>_.collectionId===a))==null?void 0:k.some(br),$=e&&C.tieFormat?(x=Bu({descendant:C.tieFormat,ancestor:b}))==null?void 0:x.different:!1;return t&&!F||!C.winningSide&&C.matchUpStatus!==Ki&&(t||C.matchUpStatus!==cs&&!br(C)&&!$)});if(!E.length)return{error:dv};let{appliedPolicies:R}=Bt({tournamentRecord:i});if(s&&u&&t){let C=(f=u.tieMatchUps)==null?void 0:f.filter(O=>O.collectionId===a);for(let O of C??[]){let k=eU({matchUpId:O.matchUpId,tieMatchUpId:u==null?void 0:u.matchUpId,winningSide:void 0,removeScore:!0,tournamentRecord:i,appliedPolicies:R,drawDefinition:r,event:c});if(k.error||(k=Si({drawDefinition:r,matchUpId:s}),k.error))return k;u=k==null?void 0:k.matchUp}}let N=[];for(let C of E){for(let O of(C==null?void 0:C.sides)??[])O.lineUp=(O.lineUp??[]).map(k=>({participantId:k.participantId,collectionAssignments:((k==null?void 0:k.collectionAssignments)??[]).filter(x=>x.collectionId!==a)}));if(C.tieMatchUps=(C.tieMatchUps??[]).filter(O=>{let k=O.collectionId===a;return k&&N.push(O.matchUpId),!k}),C.tieFormat&&(C.tieFormat=Yr(b)),t){let O=ic({matchUpId:C.matchUpId,exitWhenNoValues:!0,tournamentRecord:i,appliedPolicies:R,drawDefinition:r,event:c});if(O.error)return O}Et({tournamentId:i==null?void 0:i.tournamentId,eventId:c==null?void 0:c.eventId,drawDefinition:r,context:g,matchUp:C})}N.length&&Zu({tournamentId:i==null?void 0:i.tournamentId,matchUpIds:N,eventId:c==null?void 0:c.eventId,drawDefinition:r});let A=He(b);if(v=qn({tieFormat:A}),v.error)return te({result:v,stack:g});if(l&&c)c.tieFormat=A;else if(s&&u)u.tieFormat=A;else if(y)y.tieFormat=A;else if(r)r.tieFormat=A;else if(!u||!r)return{error:$e};ui({drawDefinition:r,eventId:c==null?void 0:c.eventId});let M=He({drawId:r==null?void 0:r.drawId,action:g,collectionId:a,structureId:o,matchUpId:s,eventId:l});return nE({appliedPolicies:R,drawDefinition:r,auditData:M}),{tieFormat:A,deletedMatchUpIds:N,targetMatchUps:E,...Q}}function Zie({updateInProgressMatchUps:t=!0,tournamentRecord:e,groupDefinition:i,drawDefinition:r,collectionIds:n,tieFormatName:a,structureId:o,matchUpId:s,matchUp:l,eventId:u,event:c}){let d="addCollectionGroup";if(!Array.isArray(n))return te({result:{error:Je},stack:d});let p=l?void 0:op({drawDefinition:r,structureId:o,matchUpId:s,eventId:u,event:c});if(p!=null&&p.error)return te({result:p,stack:d});let m=p==null?void 0:p.structure;l=l||(p==null?void 0:p.matchUp);let h=p==null?void 0:p.tieFormat,f=h==null?void 0:h.winCriteria.valueGoal,g=Yr(h);if(p=qn({tieFormat:g}),p.error)return te({result:p,stack:d});for(let y of g.collectionDefinitions){let{collectionId:I,collectionGroupNumber:b}=y;if(b&&n.includes(I))return te({info:"collectionIds cannot be part of other collectionGroups",result:{error:se},stack:d})}let v=(g.collectionGroups||[]).reduce((y,I)=>I.groupNumber>y?I.groupNumber:y,0)+1;return i.groupNumber=v,g.collectionDefinitions=g.collectionDefinitions.map(y=>n.includes(y.collectionId)?{...y,collectionGroupNumber:v}:y),g.collectionGroups=[...g.collecitonGroups||[],i],Kie({updateInProgressMatchUps:t,originalValueGoal:f,tournamentRecord:e,drawDefinition:r,tieFormatName:a,structureId:o,structure:m,tieFormat:g,matchUpId:s,matchUp:l,eventId:u,event:c})}function eB({updateInProgressMatchUps:t=!0,collectionDefinition:e,referenceCategory:i,tournamentRecord:r,policyDefinitions:n,enforceCategory:a,referenceGender:o,drawDefinition:s,tieFormatName:l,enforceGender:u,structureId:c,matchUpId:d,matchUp:p,eventId:m,uuids:h,event:f}){var g,v;let y="addCollectionDefinition",I=Bt({tournamentRecord:r,drawDefinition:s,event:f}).appliedPolicies??{},b=(n==null?void 0:n[_r])??(I==null?void 0:I[_r]);a=a??((g=b==null?void 0:b.participants)==null?void 0:g.enforceCategory);let S=(u??((v=b==null?void 0:b.participants)==null?void 0:v.enforceGender))!==!1,w=!!((i??(f==null?void 0:f.category))&&a!==!1),U=!!((o??(f==null?void 0:f.gender))&&S),T=tw({referenceCategory:i??(f==null?void 0:f.category),collectionDefinition:e,referenceGender:o,checkCategory:w,checkGender:U,event:f});if(T.error)return te({result:T,stack:y});let D=p!=null&&p.tieFormat?void 0:op({drawDefinition:s,structureId:c,matchUpId:d,eventId:m,event:f});if(D!=null&&D.error)return te({result:{error:D.error},stack:y});let P=D==null?void 0:D.structure;p=p??(D==null?void 0:D.matchUp);let E=(p==null?void 0:p.tieFormat)??(D==null?void 0:D.tieFormat),R=Yr(E);if(D=qn({tieFormat:R}),D==null?void 0:D.error)return te({result:{error:D.error},stack:y});if(!e.collectionId)e.collectionId=Ht();else if(R.collectionDefinitions.map(({collectionId:_})=>_).includes(e.collectionId))return te({context:{collectionId:e.collectionId},result:{error:F9}});R.collectionDefinitions.push(e),R.collectionDefinitions.sort((_,L)=>(_.collectionOrder||0)-(L.collectionOrder||0)).forEach((_,L)=>_.collectionOrder=L+1);let{aggregateValue:N,valueGoal:A}=Gh(R);R.winCriteria=He({aggregateValue:N,valueGoal:A});let M=E==null?void 0:E.winCriteria.valueGoal,C=E==null?void 0:E.winCriteria.aggregateValue;(M&&M!==A||N&&!C)&&(l?R.tieFormatName=l:delete R.tieFormatName);let O=[],k=[],x=[],F=He(R);if(D=qn({tieFormat:F}),D==null?void 0:D.error)return te({result:{error:D.error},stack:y});if(m&&f){f.tieFormat=F;for(let _ of f.drawDefinitions??[])if(!_.tieFormat)for(let L of _.structures??[]){if(L.tieFormat)continue;let B=iC({updateInProgressMatchUps:t,collectionDefinition:e,structure:L,uuids:h});k.push(...B.newMatchUps),x.push(...B.targetMatchUps),O.push(L.structureId)}wU({modifiedMatchUps:x,eventId:f==null?void 0:f.eventId,modifiedStructureIds:O,tournamentRecord:r,drawDefinition:s,addedMatchUps:k,stack:y})}else if(c&&P){P.tieFormat=F;let _=iC({updateInProgressMatchUps:t,collectionDefinition:e,structure:P,uuids:h});k.push(..._.newMatchUps),x=_.targetMatchUps,wU({modifiedMatchUps:x,eventId:f==null?void 0:f.eventId,modifiedStructureIds:O,tournamentRecord:r,drawDefinition:s,addedMatchUps:k,stack:y})}else if(d&&p){if(!N0({matchUp:p,updateInProgressMatchUps:t}))return te({result:{error:nF},stack:y});p.tieFormat=F;let _=Lw({collectionDefinition:e,matchUp:p,uuids:h});Array.isArray(p.tieMatchUps)||(p.tieMatchUps=[]),p.tieMatchUps.push(..._),k.push(..._),wU({modifiedMatchUps:[p],eventId:f==null?void 0:f.eventId,modifiedStructureIds:O,tournamentRecord:r,drawDefinition:s,addedMatchUps:k,stack:y})}else if(s){s.tieFormat=F;for(let _ of s.structures??[]){let L=iC({updateInProgressMatchUps:t,collectionDefinition:e,structure:_,uuids:h});O.push(_.structureId),k.push(...L.newMatchUps),x.push(...L.targetMatchUps)}wU({modifiedMatchUps:x,eventId:f==null?void 0:f.eventId,tournamentRecord:r,drawDefinition:s,addedMatchUps:k,stack:y})}else return{error:$e};let $=He({drawId:s==null?void 0:s.drawId,collectionDefinition:e,action:y,structureId:c,matchUpId:d,eventId:m});return nE({appliedPolicies:I,drawDefinition:s,auditData:$}),{tieFormat:F,targetMatchUps:x,addedMatchUps:k,...Q}}function iC({updateInProgressMatchUps:t,collectionDefinition:e,structure:i,uuids:r}){var n;let a=[],o=((n=qt({matchUpFilters:{matchUpTypes:[fi]},structure:i}))==null?void 0:n.matchUps).filter(s=>N0({matchUp:s,updateInProgressMatchUps:t})&&!s.tieFormat);for(let s of o){let l=Lw({collectionDefinition:e,matchUp:s,uuids:r});Array.isArray(s.tieMatchUps)||(s.tieMatchUps=[]),s.tieMatchUps.push(...l),a.push(...l)}return{newMatchUps:a,targetMatchUps:o}}function wU({modifiedStructureIds:t,tournamentRecord:e,modifiedMatchUps:i,drawDefinition:r,addedMatchUps:n,eventId:a,stack:o}){xc({tournamentId:e==null?void 0:e.tournamentId,matchUps:n,drawDefinition:r,eventId:a}),i==null||i.forEach(s=>{Et({tournamentId:e==null?void 0:e.tournamentId,drawDefinition:r,context:o,matchUp:s,eventId:a})}),ui({structureIds:t,drawDefinition:r,eventId:a})}function ere({updateInProgressMatchUps:t=!1,tieFormatComparison:e,modifiedTieFormat:i,tournamentRecord:r,considerations:n,drawDefinition:a,structureId:o,matchUpId:s,eventId:l,uuids:u,event:c}){let d="modifyTieFormat";if(!qn({tieFormat:i}).valid)return te({result:{error:kl},info:"falied validation",stack:d});let p=op({drawDefinition:a,structureId:o,matchUpId:s,eventId:l,event:c});if(p.error)return te({result:p,stack:d});let{matchUp:m,tieFormat:h}=p,f=Yr(h),g=Bu({descendant:i,ancestor:f,considerations:n});if(g.invalid)return te({context:{invalid:g.invalid},result:{error:kl},stack:d});if(!(g!=null&&g.different))return te({result:{...Q},info:"Nothing to do",stack:d});let v=f.collectionDefinitions.map(({collectionId:D})=>D),y=i.collectionDefinitions.map(({collectionId:D})=>D),I=v.filter(D=>!y.includes(D)),b=i.collectionDefinitions.filter(({collectionId:D})=>!v.includes(D)),S=b.map(Ma("collectionId")),w=[],U,T=i.tieFormatName;for(let D of i.collectionDefinitions){if(S.includes(D.collectionId))continue;let P=Q$({updateInProgressMatchUps:t,...D,tournamentRecord:r,tieFormatName:T,drawDefinition:a,structureId:o,matchUpId:s,eventId:l,event:c});if(P.modifications&&w.push(...P.modifications),P.error)return te({result:P,stack:d});P.tieFormat&&(U=P.tieFormat)}for(let D of b){let P=eB({updateInProgressMatchUps:t,collectionDefinition:D,tournamentRecord:r,drawDefinition:a,tieFormatName:T,structureId:o,matchUpId:s,matchUp:m,eventId:l,uuids:u,event:c});if(P.error)return te({result:P,stack:d});P.tieFormat&&(U=P.tieFormat)}for(let D of I){let P=Z$({updateInProgressMatchUps:t,tieFormatComparison:e,tournamentRecord:r,drawDefinition:a,tieFormatName:T,collectionId:D,structureId:o,matchUpId:s,eventId:l,matchUp:m,event:c});if(P.error)return te({result:P,stack:d});P.tieFormat&&(U=P.tieFormat)}return(h==null?void 0:h.tieFormatName)!==T?(U.tieFormatName=T,w.push({tieFormatName:T})):(w.length||S.length||I.length)&&(delete U.tieFormatName,w.push("tieFormatName removed: modifications without new tieFormatName")),U.collectionDefinitions=U.collectionDefinitions.sort((D,P)=>Yf(D.collectionOrder)-Yf(P.collectionOrder)).map((D,P)=>({...D,collectionOrder:P+1})),{processedTieFormat:Yr(U),modifications:w,...Q}}function tre({tournamentRecord:t}){if(!t)return{error:ve};let e=0;for(let i of t.events??[]){let r=i.tieFormats??[],n=c=>{if(!c.tieFormat)return;let d;for(let p of r)Bu({descendant:c.tieFormat,ancestor:p}).different||(d=p.tieFormatId);if(d)c.tieFormatId=d,delete c.tieFormat;else{let p=Ne(c.tieFormat,void 0,!0);p.tieFormatId||(p.tieFormatId=Ht()),c.tieFormatId=p.tieFormatId,delete c.tieFormat,r.push(p),e+=1}},a=i.eventType;n({tieFormat:i.tieFormat,eventType:a});for(let c of i.drawDefinitions??[]){n({tieFormat:c.tieFormat,eventType:a});for(let d of c.structures??[])n({tieFormat:d.tieFormat,eventType:a})}let o=(c,d)=>{var p;let m=(p=l.matchUps)==null?void 0:p.find(h=>h.matchUpId===c);m&&(m.tieFormatId=d,delete m.tieFormat,Et({tournamentId:t==null?void 0:t.tournamentId,eventId:i.eventId,matchUp:m}))},s=c=>{let d=Ne(c.tieFormat,void 0,!0);d.tieFormatId||(d.tieFormatId=Ht()),r.push(d),e+=1,o(c.matchUpId,d.tieFormatId)},l=au({matchUpFilters:{matchUpTypes:[Ba]},event:i}),u=l.matchUps??[];for(let c of u){let d;for(let p of r)c.tieFormat&&Bu({descendant:c.tieFormat,ancestor:p}).different||(d=p.tieFormatId);d?o(c.matchUpId,d):s(c)}r.length&&(i.tieFormats=r)}return{...Q,addedCount:e}}var ire={};bt(ire,{addDrawDefinitionExtension:()=>xP,addEventExtension:()=>id,addEventTimeItem:()=>Bh,addExtension:()=>_t,addNotes:()=>lR,addOnlineResource:()=>ure,addParticipantExtension:()=>sX,addParticipantTimeItem:()=>u_,addTimeItem:()=>wl,addTournamentExtension:()=>GF,addTournamentTimeItem:()=>Vw,analyzeDraws:()=>jw,analyzeTournament:()=>H_,copyTournamentRecord:()=>nre,createTournamentRecord:()=>tE,generate:()=>rre,getAggregateTeamResults:()=>G_,getAllowedDrawTypes:()=>TR,getAllowedMatchUpFormats:()=>B_,getAppliedPolicies:()=>Bt,getCompetitionDateRange:()=>PR,getCompetitionPenalties:()=>V_,getPolicyDefinitions:()=>ec,getTournamentInfo:()=>jh,getTournamentPenalties:()=>DR,getTournamentPersons:()=>j_,getTournamentPoints:()=>RR,getTournamentStructures:()=>HL,getTournamentTimeItem:()=>zP,mutate:()=>are,query:()=>oee,removeDrawDefinitionExtension:()=>lX,removeEventExtension:()=>FP,removeExtension:()=>Dn,removeNotes:()=>a_,removeOnlineResource:()=>lre,removeParticipantExtension:()=>uX,removeTournamentExtension:()=>HF,setTournamentCategories:()=>pre,setTournamentDates:()=>aE,setTournamentEndDate:()=>hre,setTournamentName:()=>cre,setTournamentNotes:()=>dre,setTournamentStartDate:()=>mre,setTournamentStatus:()=>sre});var rre={};bt(rre,{copyTournamentRecord:()=>nre,createTournamentRecord:()=>tE});function nre(t){var e,i;let r=We(t,[{tournamentRecord:!0,startDate:!0,endDate:!1,tournamentName:!0}]);if(r.error)return r;let{startDate:n,endDate:a}=t.tournamentRecord,o=24*60*60*1e3,s=(n&&a?new Date(mt(a)).getTime()-new Date(mt(n)).getTime():0)/o,l=t.endDate||DF(t.startDate,s),u=h=>h==null?void 0:h.filter(({itemType:f})=>{var g;return(g=t.itemTypeList)==null?void 0:g.includes(f)}),c=h=>h==null?void 0:h.filter(({name:f})=>{var g;return(g=t.extensionList)==null?void 0:g.includes(f)}),d=h=>{let{timeItems:f,extensions:g,...v}=h;return Ne({...v,timeItems:u(f),extensions:c(g)},!1,!0)},p=h=>{let{drawDefinitions:f,timeItems:g,extensions:v,startDate:y,endDate:I,...b}=h;return Ne({extensions:c(v),timeItems:u(g),startDate:t.startDate,endDate:l,...b},!1,!0)},m={participants:t.copyParticipants?((e=t.tournamentRecord.participants)==null?void 0:e.map(d))??[]:[],parentOrganisation:Ne({...t.tournamentRecord.parentOrganisation},!1,!0),venues:Ne(t.tournamentRecord.venues??[],!1,!0),extensions:c(t.tournamentRecord.extensions),timeItems:u(t.tournamentRecord.timeItems),events:((i=t.tournamentRecord.events)==null?void 0:i.map(p))??[],weekdays:[...t.tournamentRecord.weekdays??[]],tournamentName:t.tournamentName,startDate:t.startDate,tournamentId:Ht(),endDate:l};return{...Q,tournamentRecord:m}}var are={};bt(are,{addDrawDefinitionExtension:()=>xP,addEventExtension:()=>id,addEventTimeItem:()=>Bh,addExtension:()=>_t,addNotes:()=>lR,addOnlineResource:()=>ure,addParticipantExtension:()=>sX,addParticipantTimeItem:()=>u_,addTimeItem:()=>wl,addTournamentExtension:()=>GF,addTournamentTimeItem:()=>Vw,removeDrawDefinitionExtension:()=>lX,removeEventExtension:()=>FP,removeExtension:()=>Dn,removeNotes:()=>a_,removeOnlineResource:()=>lre,removeParticipantExtension:()=>uX,removeTournamentExtension:()=>HF,setTournamentCategories:()=>pre,setTournamentDates:()=>aE,setTournamentEndDate:()=>hre,setTournamentName:()=>cre,setTournamentNotes:()=>dre,setTournamentStartDate:()=>mre,setTournamentStatus:()=>sre});var tMe="ABANDONED",iMe="ACTIVE",rMe="CANCELLED",nMe="COMPLETED",aMe="IN_PROGRESS",ore={ABANDONED:tMe,ACTIVE:iMe,CANCELLED:rMe,COMPLETED:nMe,IN_PROGRESS:aMe};function sre({tournamentRecord:t,status:e}){return t?e&&!Object.keys(ore).includes(e)?{error:se,info:"Unknown status"}:(t.tournamentStatus=e,{...Q}):{error:ve}}function lre(t){var e,i,r;let n=We(t,[{tournamentRecord:!0,onlineResource:!0}]);if(n.error)return n;let{tournamentRecord:a,onlineResource:o,organisationId:s,participantId:l,personId:u,courtId:c,venueId:d}=t;if(s){if(((e=a.parentOrganisation)==null?void 0:e.parentOrganisationId)!==s)return te({result:{error:jr}});Zh({element:a.parentOrganisation,onlineResource:o})}else if(l||u){let p=(a.participants??[]).find(m=>{var h;return u&&((h=m.person)==null?void 0:h.personId)===u||m.participantId===l});if(!p)return te(u?{result:{error:jr}}:{result:{error:Wi}});if(u){if(((i=p.person)==null?void 0:i.personId)!==u)return te({result:{error:Ih}});Zh({element:p.person,onlineResource:o})}else Zh({element:p,onlineResource:o})}else if(c){let p=(r=(a.venues??[]).filter(m=>!d||m.venueId===d).flatMap(m=>(m.courts??[]).filter(h=>h.courtId===c)))==null?void 0:r[0];if(!p)return te({result:{error:cv}});Zh({element:p,onlineResource:o})}else if(d){let p=(a.venues??[]).find(m=>m.venueId===d);if(!p)return te({result:{error:bh}});Zh({element:p,onlineResource:o})}else Zh({element:a,onlineResource:o}),ut({payload:{parentOrganisation:a.parentOrganisation,onlineResources:a.onlineResources,tournamentId:a.tournamentId},topic:Rp});return{...Q}}function Zh({element:t,onlineResource:e}){let i=(t.onlineResources??[]).filter(r=>!((r==null?void 0:r[eg])===e[eg]&&(r==null?void 0:r[tg])===e[tg]&&(r==null?void 0:r[ig])===e[ig]));t.onlineResources=i}function ure(t){var e,i,r;let n=We(t,[{tournamentRecord:!0,onlineResource:!0}]);if(n.error)return n;let{tournamentRecord:a,onlineResource:o,organisationId:s,participantId:l,personId:u,courtId:c,venueId:d}=t;if(s){if(((e=a.parentOrganisation)==null?void 0:e.parentOrganisationId)!==s)return te({result:{error:jr}});ef({element:a.parentOrganisation,onlineResource:o})}else if(l||u){let p=(a.participants??[]).find(m=>{var h;return u&&((h=m.person)==null?void 0:h.personId)===u||m.participantId===l});if(!p)return te(u?{result:{error:jr}}:{result:{error:Wi}});if(u){if(((i=p.person)==null?void 0:i.personId)!==u)return te({result:{error:Ih}});ef({element:p.person,onlineResource:o})}else ef({element:p,onlineResource:o})}else if(c){let p=(r=(a.venues??[]).filter(m=>!d||m.venueId===d).flatMap(m=>(m.courts??[]).filter(h=>h.courtId===c)))==null?void 0:r[0];if(!p)return te({result:{error:cv}});ef({element:p,onlineResource:o})}else if(d){let p=(a.venues??[]).find(m=>m.venueId===d);if(!p)return te({result:{error:bh}});ef({element:p,onlineResource:o})}else ef({element:a,onlineResource:o}),ut({payload:{parentOrganisation:a.parentOrganisation,onlineResources:a.onlineResources,tournamentId:a.tournamentId},topic:Rp});return{...Q}}function ef({element:t,onlineResource:e}){let i=(t.onlineResources??[]).filter(r=>(r==null?void 0:r[eg])!==e[eg]&&(r==null?void 0:r[tg])!==e[tg]&&(r==null?void 0:r[ig])!==e[ig]);return i.push(e),t.onlineResources=i,{...Q}}function cre({tournamentRecord:t,promotionalName:e,tournamentName:i,formalName:r}){if(!t)return{error:ve};let n=t.tournamentId,a={tournamentId:n};return i&&i!==t.tournamentName&&(t.tournamentName=i,a.tournamentName=i),e&&e!==t.promotionalName&&(t.promotionalName=e,a.promotionalName=e),r&&r!==t.formalName&&(t.formalName=r,a.formalName=r),t.promotionalName===t.tournamentName&&(delete t.promotionalName,a.promotionalName=""),t.formalName===t.tournamentName&&(delete t.formalName,a.formalName=""),Object.keys(a).length>1&&ut({topic:Rp,payload:{parentOrganisation:t.parentOrganisation,tournamentId:n,...a}}),{...Q}}function dre({tournamentRecord:t,notes:e}){if(!t)return{error:ve};let i=e?lR({element:t,notes:e}):a_({element:t});return i.error?i:(ut({topic:Rp,payload:{parentOrganisation:t.parentOrganisation,tournamentId:t.tournamentId,notes:e??""}}),{...Q})}function pre({tournamentRecord:t,categories:e}){return t?(e=(e||[]).filter(i=>i.categoryName&&i.type),t.tournamentCategories=e,ut({topic:Rp,payload:{parentOrganisation:t.parentOrganisation,tournamentId:t.tournamentId,categories:e}}),{...Q}):{error:ve}}function oMe({tournamentRecord:t}){var e,i;if(!t)return{error:ve};let{startDate:r,endDate:n}=t,a=Zf(r,n),o=[];for(let s of t.venues||[])(e=s==null?void 0:s.courts)!=null&&e.length&&o.push(...s.courts);for(let s of o){let{startTime:l,endTime:u}=(s.dateAvailability??[]).reduce((p,m)=>{let h=xt(p.startTime),f=xt(p.endTime);return m.startTime&&xt(m.startTime)<h&&(p.startTime=m.startTime),m.endTime&&xt(m.endTime)>f&&(p.endTime=m.endTime),p},{startTime:"08:00",endTime:"18:00"}),c=a.map(p=>{var m;return((m=s.dateAvailability)==null?void 0:m.find(h=>h.date===p))??{date:p,startTime:l,endTime:u}}),d=(i=s.dateAvailability)==null?void 0:i.find(p=>!p.date);d&&c.unshift(d),s.dateAvailability=c}return{...Q}}function aE(t){var e,i;let{tournamentRecord:r,startDate:n,endDate:a,weekdays:o}=t,s=(e=t.activeDates)==null?void 0:e.filter(Boolean),l=We(t,[{tournamentRecord:!0},{[Xr]:f=>ol.test(f),[Ha]:Fr,startDate:!1,endDate:!1},{[Xr]:f=>f.filter(Boolean).every(g=>ol.test(g)),[Ha]:Fr,activeDates:!1},{[Xr]:Gee,weekdays:!1}]);if(l.error)return l;if(a&&n&&new Date(a)<new Date(n))return{error:se};if(a&&n&&new Date(n)>new Date(a))return{error:se};if(s!=null&&s.length){let f=n||r.startDate,g=a||r.endDate,v=!f||s.every(I=>new Date(I)>=new Date(f)),y=!g||s.every(I=>new Date(I)<=new Date(g));if(!v||!y)return{error:Fr}}let u;(n&&r.startDate&&new Date(n)>new Date(r.startDate)||a&&r.endDate&&new Date(a)<new Date(r.endDate))&&(u=!0);let c=Zf(r.startDate,r.endDate);n&&(r.startDate=n),a&&(r.endDate=a);let d=Zf(r.startDate,r.endDate),p=c.filter(f=>!d.includes(f)),m=d.filter(f=>!c.includes(f));for(let f of r.events??[])n&&f.startDate&&new Date(f.startDate)<new Date(n)&&(f.startDate=n),a&&f.startDate&&new Date(f.startDate)>new Date(a)&&(f.startDate=n??a),a&&f.endDate&&new Date(f.endDate)>new Date(a)&&(f.endDate=a),n&&f.endDate&&new Date(f.endDate)<new Date(n)&&(f.endDate=a??n);n&&r.endDate&&new Date(n)>new Date(r.endDate)&&(r.endDate=n),a&&r.startDate&&new Date(a)<new Date(r.startDate)&&(r.startDate=a),s&&(r.activeDates=s),o&&(r.weekdays=o);let h=u&&((i=sMe({tournamentRecord:r}))==null?void 0:i.unscheduledMatchUpIds);return oMe({tournamentRecord:r}),ut({payload:He({parentOrganisation:r.parentOrganisation,tournamentId:r.tournamentId,activeDates:s,startDate:n,weekdays:o,endDate:a}),topic:Rp}),{...Q,unscheduledMatchUpIds:h,datesAdded:m,datesRemoved:p}}function mre({tournamentRecord:t,startDate:e}){return e?aE({tournamentRecord:t,startDate:e}):{error:Fr}}function hre({tournamentRecord:t,endDate:e}){return e?aE({tournamentRecord:t,endDate:e}):{error:Fr}}function sMe({tournamentRecord:t}){let e=Hr({tournamentRecord:t}).matchUps??[],i=t.startDate&&new Date(t.startDate),r=t.endDate&&new Date(t.endDate),n=[],a=[];for(let o of e){let{schedule:s,matchUpId:l}=o;if(s&&s.scheduledDate){let u=new Date(s.scheduledDate);(i&&u<i||r&&u>r)&&(a.push(l),n.includes(s.scheduledDate)||n.push(s.scheduledDate))}}return n.length&&!ZR({scheduledDates:n,tournamentRecord:t}).clearedScheduleCount?{error:LK}:{unscheduledMatchUpIds:a}}var fre={};bt(fre,{addCourt:()=>rE,addCourts:()=>Y$,addVenue:()=>Uw,deleteCourt:()=>Tre,deleteVenue:()=>nB,deleteVenues:()=>yre,disableCourts:()=>bre,disableVenues:()=>wre,enableCourts:()=>Ure,enableVenues:()=>Sre,generate:()=>gre,generateCourts:()=>U$,getCompetitionVenues:()=>Ww,getCourts:()=>l$,getVenuesAndCourts:()=>rc,modifyCourt:()=>aB,modifyCourtAvailability:()=>iB,modifyVenue:()=>Dre,mutate:()=>vre,publicFindVenue:()=>TL,query:()=>See});var gre={};bt(gre,{generateCourts:()=>U$});var vre={};bt(vre,{addCourt:()=>rE,addCourts:()=>Y$,addVenue:()=>Uw,deleteCourt:()=>Tre,deleteVenue:()=>nB,deleteVenues:()=>yre,disableCourts:()=>bre,disableVenues:()=>wre,enableCourts:()=>Ure,enableVenues:()=>Sre,modifyCourt:()=>aB,modifyCourtAvailability:()=>iB,modifyVenue:()=>Dre});function tB(t){if(!(t!=null&&t.tournamentRecord)&&!Array.isArray(t==null?void 0:t.venueMatchUps))return{error:ve};if(!(t!=null&&t.courtId))return{error:vh};let{scheduleVisibilityFilters:e,tournamentRecord:i,matchUpFilters:r,venueMatchUps:n,courtId:a}=t,{schedulingProfile:o}=nc({tournamentRecord:i});if(Array.isArray(n))return{matchUps:l({matchUps:n,courtId:a})};let{matchUps:s}=Hr({scheduleVisibilityFilters:e,tournamentRecord:i,matchUpFilters:r});return{matchUps:l({matchUps:s,courtId:a})};function l({matchUps:u,courtId:c}){let d=u.filter(p=>{var m,h,f;let g=(h=(m=p.schedule)==null?void 0:m.allocatedCourts)==null?void 0:h.map(({courtId:v})=>v);return((f=p.schedule)==null?void 0:f.courtId)===c||(g==null?void 0:g.includes(c))});return T0({matchUps:d,schedulingProfile:o})}}function lMe({scheduleVisibilityFilters:t,tournamentRecord:e,matchUpFilters:i,venueId:r}){if(!e)return{error:ve};if(!r)return{error:Zc};let{schedulingProfile:n}=nc({tournamentRecord:e}),{matchUps:a}=Hr({scheduleVisibilityFilters:t,tournamentRecord:e,matchUpFilters:i});return{matchUps:o({matchUps:a,venueId:r})};function o({matchUps:s,venueId:l}){let u=s.filter(c=>{var d,p,m;let h=(p=(d=c.schedule)==null?void 0:d.allocatedCourts)==null?void 0:p.map(({venueId:f})=>f);return((m=c.schedule)==null?void 0:m.venueId)===l||(h==null?void 0:h.includes(l))});return T0({matchUps:u,schedulingProfile:n})}}function iB({tournamentRecord:t,dateAvailability:e,disableNotice:i,venueMatchUps:r,courtId:n,force:a}){var o,s,l;if(!t)return{error:ve};if(!n)return{error:vh};let u=Jte({dateAvailability:e});if(u.error)return u;let{updatedDateAvailability:c,totalMergeCount:d}=uMe(e);e=c;let p=kh({tournamentRecord:t,courtId:n});if(p.error)return p;let{court:m,venue:h}=p,{matchUps:f}=tB({tournamentRecord:t,venueMatchUps:r,courtId:n});if(f!=null&&f.length){let g=(o=Bt({tournamentRecord:t}))==null?void 0:o.appliedPolicies,v=a??((l=(s=g==null?void 0:g[td])==null?void 0:s.allowDeletionWithScoresPresent)==null?void 0:l.courts),y=[];y.length&&(v||console.log("throw error: scheduled court matchUps",y.length))}return m&&(m.dateAvailability=e,!i&&h&&ut({payload:{venue:h,tournamentId:t.tournamentId},topic:Ep,key:h.venueId})),{...Q,totalMergeCount:d}}function uMe(t){let e=0,i=t.reduce((n,a)=>{let{date:o,startTime:s,endTime:l,bookings:u}=a;return n[o]||(n[o]=[]),n[o].push({startTime:s,endTime:l,bookings:u}),n},{}),r=[];return Object.keys(i).forEach(n=>{i[n].sort(R1e);let{mergedAvailability:a,mergeCount:o}=cMe(i[n]);r.push(...a.map(s=>({date:n,...s}))),e+=o}),{updatedDateAvailability:r,totalMergeCount:e}}function cMe(t){let e,i,r,n=t.length,a=0,o=[];for(;t.length&&n;){let l=t.shift(),{startTime:u,endTime:c,bookings:d}=l;if(n-=1,!e)e=u,r=d,i=c;else if(Zb(rr(i),rr(u),!1)>0){let p={startTime:e,endTime:i};r!=null&&r.length&&(p.bookings=r),o.push(p),e=u,r=d,i=c}else d&&(r?r.push(d):r=d),i=c,a+=1}let s={startTime:e,endTime:i};return r!=null&&r.length&&(s.bookings=r),o.push(s),{mergedAvailability:o,mergeCount:a}}function rB({matchUpsCount:t=0}){let e=`Schedule would be deleted from ${t} ${t===1?"matchUp":"matchUps"}; use { force: true }`;return{error:V9,info:e}}function Ire({tournamentRecord:t,drawDefinition:e,matchUpId:i,drawId:r}){let n="removeCourtAssignment";if(!i)return{error:bn};if(!e&&!r)return{error:Fs};let a;if(!e){if(!t)return{error:ve};({drawDefinition:e}=Kn({tournamentRecord:t,drawId:r}))}if(e)({matchUp:a}=Si({drawDefinition:e,matchUpId:i}));else{if(!t)return{error:ve};let o=Hr({tournamentRecord:t,inContext:!1}).matchUps??[];({matchUp:a}=SQ({matchUps:o,matchUpId:i}))}return a?(a.timeItems&&a.timeItems.find(o=>[Lc,Ql].includes(o.itemType))&&(a.timeItems=a.timeItems.filter(({itemType:o})=>![Lc,Ql].includes(o)),Et({tournamentId:t==null?void 0:t.tournamentId,context:n,drawDefinition:e,matchUp:a})),{...Q}):{error:hn}}function nB(t){var e,i,r;if(typeof(t==null?void 0:t.venueId)!="string")return{error:Zc};let{tournamentRecord:n,venueId:a,force:o}=t,s=t.tournamentRecords||n&&{[n.tournamentId]:n}||{};if(!Object.keys(s).length)return{error:ve};let l=Os({tournamentRecords:s,contextFilters:{venueIds:[a]}}).matchUps??[],u=(e=Bt({tournamentRecord:n}))==null?void 0:e.appliedPolicies,c=o??((r=(i=u==null?void 0:u[td])==null?void 0:i.allowDeletionWithScoresPresent)==null?void 0:r.venues);if(!l.length||c)for(let d of Object.values(s)){for(let m of l){let h=Ire({matchUpId:m.matchUpId,drawId:m.drawId,tournamentRecord:d});if(h.error)return h}let p;d.venues=(d.venues??[]).filter(m=>(m==null?void 0:m.venueId)!==a?!0:(p=!0,!1)),p&&ut({payload:{venueId:a,tournamentId:d.tournamentId},topic:tL,key:a})}else return rB({matchUpsCount:l.length});return Yw({tournamentRecords:s}),{...Q}}function yre({tournamentRecord:t,venueIds:e,force:i}){if(!t)return{error:ve};if(!Array.isArray(e))return{error:se};for(let r of t.venues||[]){let{venueId:n}=r;if(e.includes(n)){let{venueId:a}=r,o=nB({tournamentRecord:t,venueId:a,force:i});if(o.error)return o}}return{...Q}}function bre(t){let{courtIds:e,dates:i}=t,r=To(t),n=[{[fn]:!0,[OP]:!0}],a=We(t,n);if(a.error)return a;for(let o of Object.values(r))dMe({tournamentRecord:o,courtIds:e,dates:i});return{...Q}}function dMe({tournamentRecord:t,courtIds:e,dates:i}){let r=Array.isArray(i)&&i.length?{dates:i}:!0,n=a=>_t({extension:{value:r,name:ws},creationTime:!1,element:a});for(let a of t.venues||[])for(let o of a.courts||[])if(e!=null&&e.includes(o.courtId)){let s=n(o);if(s.error)return s}return{...Q}}function wre(t){let{tournamentRecords:e,tournamentId:i,venueIds:r}=t,n=[{[fn]:!0,[kP]:!0}],a=We(t,n);if(a.error)return a;let o=Object.keys(e).filter(s=>!i||s===i);for(let s of o){let l=e[s];pMe({tournamentRecord:l,venueIds:r})}return{...Q}}function pMe({tournamentRecord:t,venueIds:e}){for(let i of t.venues||[])if(e!=null&&e.includes(i.venueId)){let r=_t({creationTime:!1,element:i,extension:{name:ws,value:!0}});if(r.error)return r}return{...Q}}function Ure(t){let e=To(t),i=[{[fn]:!0}];!t.enableAll&&i.push({[OP]:!0});let r=We(t,i);if(r.error)return r;let{enableAll:n,courtIds:a,dates:o}=t;for(let s of Object.values(e))mMe({tournamentRecord:s,courtIds:a,enableAll:n,dates:o});return{...Q}}function mMe({tournamentRecord:t,courtIds:e,enableAll:i,dates:r}){for(let n of t.venues||[])for(let a of n.courts||[])if(i||e!=null&&e.includes(a.courtId))if(Array.isArray(r)){let{extension:o}=vt({element:a,name:ws});if(o){let s=o.value;Array.isArray(s.dates)&&(s.dates=s.dates.filter(l=>!r.includes(l))),_t({extension:{name:ws,value:s},creationTime:!1,element:a})}}else Dn({element:a,name:ws});return{...Q}}function Sre(t){let e=To(t),i=[{[fn]:!0}];!t.enableAll&&i.push({[kP]:!0});let r=We(t,i);if(r.error)return r;let{venueIds:n,enableAll:a}=t;for(let o of Object.values(e))for(let s of o.venues||[])(a||n!=null&&n.includes(s.venueId))&&Dn({element:s,name:ws});return{...Q}}function Tre(t){let{courtId:e,disableNotice:i,force:r}=t,n=To(t),a=We(t,[{[fn]:!0,[iX]:!0}]);if(a.error)return a;let o,s;for(let l of Object.values(n)){if(s=hMe({tournamentRecord:l,disableNotice:i,courtId:e,force:r}),s.error&&s.error!==cv)return s;s.success&&(o=!0)}return o?{...Q}:s}function hMe({tournamentRecord:t,disableNotice:e,courtId:i,force:r}){var n,a,o;let s=kh({tournamentRecord:t,courtId:i});if(s.error)return s;let l=s.venue,{matchUps:u}=tB({tournamentRecord:t,courtId:i}),c=(n=Bt({tournamentRecord:t}))==null?void 0:n.appliedPolicies,d=r??((o=(a=c==null?void 0:c[td])==null?void 0:a.allowDeletionWithScoresPresent)==null?void 0:o.courts);if(!(u!=null&&u.length)||d){for(let p of u??[]){let m=Ire({matchUpId:p.matchUpId,drawId:p.drawId,tournamentRecord:t});if(m.error)return m}l&&(l.courts=(l.courts??[]).filter(p=>p.courtId!==i),e||ut({payload:{venue:l,tournamentId:t.tournamentId},topic:Ep,key:l.venueId}))}else return rB({matchUpsCount:u.length});return{...Q}}function aB(t){let{disableNotice:e,modifications:i,courtId:r,force:n,venueMatchUps:a}=t,o=To(t);if(!Object.keys(o).length)return{error:xi};let s,l;for(let u of Object.values(o)){let c=fMe({tournamentRecord:u,disableNotice:e,venueMatchUps:a,modifications:i,courtId:r,force:n});if(c!=null&&c.error)return c;s=!0}return s?{...Q}:l}function fMe({tournamentRecord:t,disableNotice:e,venueMatchUps:i,modifications:r,courtId:n,force:a}){if(!t)return{error:ve};if(!n)return{error:vh};if(!r||typeof r!="object")return{error:Qu};let o=kh({tournamentRecord:t,courtId:n});if(o.error)return o;let{venue:s,court:l}=o,u=Object.keys(P1e()).filter(p=>p!=="courtId");if(!Object.keys(r).filter(p=>u.includes(p)).length)return{error:fP};let c=u.filter(p=>!["dateAvailability"].includes(p)),d=Object.keys(r).filter(p=>c.includes(p));if(l&&d.forEach(p=>Object.assign(l,{[p]:r[p]})),r.dateAvailability){let p=iB({dateAvailability:r.dateAvailability,tournamentRecord:t,venueMatchUps:i,disableNotice:e,courtId:n,force:a});if(p.error)return p}return e||ut({payload:{venue:s,tournamentId:t.tournamentId},topic:Ep,key:s==null?void 0:s.venueId}),{...Q,court:Ne(l)}}var gMe=()=>({venueId:void 0,venueName:"",venueAbbreviation:"",onlineResources:[],venueType:void 0,addresses:[],contacts:[],courts:[],roles:[]}),vMe=gMe;function Dre(t){let{modifications:e,venueId:i,force:r}=t,n=To(t);if(!Object.keys(n).length)return{error:xi};if(typeof i!="string")return{error:Zc};let a,o;for(let s of Object.values(n)){let l=IMe({tournamentRecord:s,modifications:e,venueId:i,force:r});if(l.success&&(o=!0),l.error&&(a=l.error),l.error&&l.error!==bh)return l}return Yw({tournamentRecords:n}),o?{...Q}:{error:a}}function IMe({tournamentRecord:t,modifications:e,venueId:i,force:r}){var n,a,o,s,l,u,c,d;if(!t)return{error:ve};if(!e||typeof e!="object")return{error:Qu};if(!i)return{error:Zc};let p=(n=Bt({tournamentRecord:t}))==null?void 0:n.appliedPolicies,m=r??((o=(a=p==null?void 0:p[td])==null?void 0:a.allowDeletionWithScoresPresent)==null?void 0:o.venues),{matchUps:h}=lMe({tournamentRecord:t,venueId:i}),f=nu({tournamentRecord:t,venueId:i});if(f.error)return f;let g=f.venue,v=Object.keys(vMe()).filter(T=>T!=="venueId");if(!Object.keys(e).filter(T=>v.includes(T)).length)return{error:fP};let y=v.filter(T=>!["courts","onlineResources"].includes(T)),I=Object.keys(e).filter(T=>y.includes(T));g&&I.forEach(T=>Object.assign(g,{[T]:e[T]}));let b=((s=g==null?void 0:g.courts)==null?void 0:s.map(T=>T.courtId))??[],S=((l=e.courts)==null?void 0:l.map(T=>T.courtId))||[],w=S.length?b.filter(T=>!S.includes(T)):(e==null?void 0:e.courts)&&b,U=[];if(w!=null&&w.length){let T=(c=(u=g==null?void 0:g.courts)==null?void 0:u.filter(D=>w.includes(D.courtId)))==null?void 0:c.map(D=>{var P;let E=tB({courtId:D.courtId,tournamentRecord:t,venueMatchUps:h});for(let R of E.matchUps??[])U.push({matchUpId:R.matchUpId,drawId:R.drawId});return((P=E.matchUps)==null?void 0:P.length)??0}).reduce((D,P)=>D+P);if(g&&(!T||m))g.courts=(d=g.courts)==null?void 0:d.filter(D=>S.includes(D.courtId)),wy({schedule:{courtId:"",scheduledDate:""},matchUpDetails:U,removePriorValues:!0,tournamentRecord:t});else return rB({matchUpsCount:T})}if(e.courts)for(let T of e.courts){let{courtId:D}=T||{},P=aB({modifications:T,disableNotice:!0,tournamentRecord:t,venueMatchUps:h,courtId:D,force:r});if(P.error===cv&&(P=rE({disableNotice:!0,tournamentRecord:t,venueId:i,court:T})),P.error)return P}return Yw({tournamentRecord:t}),g&&ut({payload:{venue:g,tournamentId:t.tournamentId},topic:Ep,key:g==null?void 0:g.venueId}),{...Q,venue:Ne(g)}}var oB={};bt(oB,{JSON2CSV:()=>DMe,UUID:()=>Ht,UUIDS:()=>s8,allNumeric:()=>MK,attributeFilter:()=>km,chunkArray:()=>Cr,chunkByNth:()=>tM,chunkSizeProfile:()=>CK,constantToString:()=>tn,countValues:()=>xwe,createMap:()=>AK,dateTime:()=>o8,definedAttributes:()=>He,dehydrateMatchUps:()=>wMe,extractAttributes:()=>uJ,flattenJSON:()=>sB,generateDateRange:()=>Zf,generateHashCode:()=>Gwe,generateRange:()=>Te,generateTimeCode:()=>nie,groupValues:()=>RK,hasAttributeValues:()=>jwe,instanceCount:()=>Pa,intersection:()=>ji,isConvertableInteger:()=>st,isNumeric:()=>_i,isOdd:()=>DK,isPowerOf2:()=>Cs,makeDeepCopy:()=>Ne,matchUpScheduleSort:()=>bMe,matchUpSort:()=>xh,nearestPowerOf2:()=>Gx,nextPowerOf2:()=>nv,noNulls:()=>kwe,noNumeric:()=>NK,numericSort:()=>lr,occurrences:()=>Lwe,overlap:()=>Nn,randomMember:()=>_o,randomPop:()=>ga,shuffleArray:()=>Tn,structureSort:()=>Ph,subSort:()=>_we,undefinedToNull:()=>iM,unique:()=>dt,visualizeScheduledMatchUps:()=>yMe});function yMe({scheduledMatchUps:t,showGlobalLog:e}){cTe();let i=t==null?void 0:t.reduce((n,{structureId:a})=>n.includes(a)?n:n.concat(a),[]),r=Array.isArray(i)&&{...i.map(n=>{let{structureName:a,matchUpType:o}=t.find(s=>s.structureId===n);return{[n]:`${a} ${o}`}})};i==null||i.forEach(n=>{var a;Oa({color:"blue",method:"draw",structure:r[n],keyColors:{structure:"magenta"}},!0);let o=t.filter(l=>l.structureId===n),s=((a=An({matchUps:o}))==null?void 0:a.roundMatchUps)||[];Object.keys(s).forEach(l=>{Oa({roundNumber:l,keyColors:{roundNumber:"brightcyan"}},!0),s[l].forEach(({matchUpId:u,schedule:c})=>{let d=Ui(c.scheduledTime);Oa({matchUpId:u,time:d,date:c.scheduledDate,venue:c.venueId,keyColors:{time:"brightcyan",date:"brightcyan",matchUpId:"yellow",venue:"magenta"}},!0)})})}),e&&uTe()}var{extractTime:fj,timeStringMinutes:gj}=o8;function bMe(t,e){let i=t.schedule??{},r=e.schedule??{};if(i.scheduledDate&&!r.scheduledDate)return 1;if(r.scheduledDate&&!i.scheduledDate)return-1;if(i.scheduledDate&&r.scheduledDate){if(i.scheduledDate===r.scheduledDate){if(i.scheduledTime&&!r.scheduledTime)return 1;if(r.scheduledTime&&!i.scheduledTime)return-1;if(i.scheduledTime&&r.scheduledTime){let n=gj(fj(i.scheduledTime)),a=gj(fj(r.scheduledTime));return n-a}}return new Date(i.scheduledDate).getTime()-new Date(r.scheduledDate).getTime()}return 0}function wMe({tournamentRecord:t}){if(!t)return{error:ve};if(typeof t!="object"||!t.tournamentId)return{error:se};let{matchUps:e}=Hr({tournamentRecord:t,inContext:!1});if(e!=null&&e.length){let i=UMe({tournamentRecord:t});TMe(e,i)}return{...Q}}function UMe({tournamentRecord:t}){let e={};for(let i of t.events||[]){i.matchUpFormat&&(e[i.eventId]=i.matchUpFormat);for(let r of i.drawDefinitions||[]){r.matchUpFormat&&(e[r.drawId]=r.matchUpFormat);for(let n of r.structures||[]){n.matchUpFormat&&(e[n.structureId]=n.matchUpFormat);for(let a of n.structures||[])a.matchUpFormat&&(e[a.structureId]=a.matchUpFormat)}}}return e}var SMe=["collectionId","collectionPosition","drawPositions","extensions","finishingPositionRange","finishingRound","isMock","matchUpId","matchUpStatus","matchUpStatusCodes","orderOfFinish","processCodes","roundNumber","tieFormat","tieMatchUps","roundPosition","score","sides","winnerMatchUpId","loserMatchUpId","matchUpDuration","winningSide"];function TMe(t,e={}){for(let i of t){let{structureId:r,drawId:n,eventId:a}=i,o=e[r]||e[n]||e[a],s=i.matchUpFormat===o?void 0:i.matchUpFormat;for(let l of Object.keys(i))SMe.includes(l)||delete i[l];i.sides&&i.drawPositions&&!i.tieMatchUps&&delete i.sides,s&&(i.matchUpFormat=s)}}function DMe(t,e){if(e&&typeof e!="object")return{error:se};let{columnTransform:i={}}=e||{},{includeTransformAccessors:r,includeHeaderRow:n=!0,returnTransformedJSON:a,removeEmptyColumns:o,onlyHeaderRow:s,columnAccessors:l=[],functionMap:u={},columnMap:c={},valuesMap:d={},context:p={},delimiter:m='"',columnJoiner:h=",",rowJoiner:f=`\r
`,keyJoiner:g="."}=e||{};if(!Array.isArray(t)||!Array.isArray(l)||typeof p!="object"||typeof c!="object"||typeof i!="object"||typeof u!="object"||typeof d!="object"||typeof h!="string"||typeof f!="string"||typeof g!="string"||typeof m!="string")return{error:se};i=Object.assign({},...Object.keys(i).reverse().map(A=>({[A]:Array.isArray(i[A])?i[A]:[typeof i[A]=="string"&&i[A]].filter(Boolean)})));let v=t.filter(Boolean).map(A=>sB(A,g)),y=Object.values(i).flat();r&&l.push(...y);let I=v.reduce((A,M)=>Object.keys(M).every(C=>!A.includes(C)&&A.push(C)||!0)&&A,[]).filter(A=>!(l!=null&&l.length)||l.includes(A)),b=Object.assign({},...Object.keys(i).reverse().map(A=>i[A].map(M=>({[M]:A})).flat()).flat()),S=(A,M)=>e!=null&&e.sortOrder?e.sortOrder.includes(A)&&e.sortOrder.includes(M)&&e.sortOrder.indexOf(A)-e.sortOrder.indexOf(M)||!e.sortOrder.includes(M)&&-1:0,w=I.reduce((A,M)=>{let C=b[M];return C?A.includes(C)||A.push(C):A.push(M),A},[]).sort(S);Object.keys(c).forEach(A=>!w.includes(A)&&w.unshift(A)),Object.keys(i).forEach(A=>!w.includes(A)&&w.unshift(A)),typeof p=="object"&&Object.keys(p).forEach(A=>!w.includes(A)&&w.unshift(A));let U=w.map(A=>c[A]||A);if(s)return[U];let T=A=>`${m}${A}${m}`,D=[],P=A=>Object.values(w.reduce((M,C,O)=>{var k;let x=i[C],F=(x!=null&&x.length?A[x.find(L=>A[L])]:A[C])||(p==null?void 0:p[C])||"",$=((k=d[C])==null?void 0:k[F])||F,_=ha(u[C])?u[C]($):$;return M[C]=T(_),_&&(D[O]=(D[O]||0)+1),M},{})),E=v.map(P),R=o&&[...D].map((A,M)=>!A&&M).filter(_i).reverse();if(R){let A=M=>M.filter((C,O)=>!R.includes(O));E=E.map(A),U=A(U)}let N=E.map(A=>A.join(h));return a?N.map(A=>{let M=A.split(h);return Object.assign({},...M.map((C,O)=>({[U[O]]:C})))}):n?[U.map(T).join(h),...N].join(f):N.join(f)}function sB(t,e=".",i=[]){return typeof t=="object"&&Object.keys(t).reduce((r,n)=>typeof t[n]!="object"?(r[i.concat(n).join(e)]=t[n],r):Object.assign(r,sB(t[n],e,i.concat(n))),{})}var{FACTORY:vj}=dX;function PMe({tournamentRecord:t,value:e}){let{extension:i}=vt({element:t,name:vj}),r={name:vj,value:{...i==null?void 0:i.value,...e}};_t({element:t,extension:r})}function Pre({timeStamp:t}){let e=Uh(),i=IF();return i&&Object.values(e).forEach(r=>{PMe({tournamentRecord:r,value:{version:rP(),timeStamp:t}})}),i}function Rre({engineType:t,methodName:e,elapsed:i,params:r,result:n}){var a,o;let s=ja();if(typeof s!="object")return;let l={method:e},u=(n==null?void 0:n.error)&&(s.errors===!0||Array.isArray(s.errors)&&s.errors.includes(e)),c=Array.isArray(s.params)&&((a=s.params)==null?void 0:a.includes(e)),d=s.params&&!Array.isArray(s.params)||c,p=Array.isArray(s.exclude)&&s.exclude.includes(e);!p&&![void 0,!1].includes(s.perf)&&!isNaN(s.perf)&&i>=s.perf&&(l.elapsed=i),!p&&(u||d)&&(l.params=r),!p&&(u||s.result&&!Array.isArray(s.result)&&(!Array.isArray(s.params)||c)||Array.isArray(s.result)&&(o=s.result)!=null&&o.includes(e))&&(l.result=n),Object.keys(l).length>1&&Q9(l,t)}function lB({methodName:t,params:e,start:i}){let r={error:vP,methodName:t},n=i?Date.now()-i:0;return Rre({result:r,methodName:t,elapsed:n,params:e,engineType:"sync"}),r}function RMe(t,e){var i;if(e._middleware===!1)return e;if(e.tournamentId&&!t[e.tournamentId])return{error:ve};let r=e.drawId||((i=e.matchUp)==null?void 0:i.drawId);if(r){let{event:o,drawDefinition:s,tournamentId:l}=Kn({tournamentRecords:t,drawId:r});s&&(e.drawDefinition=s),l&&(e.tournamentId=l),o&&(e.event=o)}if(e.eventId&&!e.event){let{event:o,tournamentId:s}=Kn({eventId:e.eventId,tournamentRecords:t});if(!o)return{error:mo};e.tournamentId=s,e.event=o}let n=e.tournamentId??wh();if(!n&&e)return e;let a=t[n];return n&&!a?{error:ve}:(a&&(e.tournamentRecord=a),e)}function uB(t,e,i,r,n){delete t.success,delete t.error;let a=Date.now(),o=wh();i&&(i.activeTournamentId=o);let s=(i==null?void 0:i.tournamentRecord)||bF(o),l=typeof(i==null?void 0:i.tournamentRecord)=="object"&&{[i==null?void 0:i.tournamentRecord.tournamentId]:i.tournamentRecord}||Uh(),u=i?Ne(i,void 0,!0):void 0,c=i?RMe(l,i):void 0;if(c!=null&&c.error)return c;let d=EMe({params:c,tournamentRecords:l,tournamentRecord:s,methodName:r,method:e}),p=Date.now()-a;return Rre({result:d,methodName:r,elapsed:p,params:u,engineType:n}),d}function EMe({tournamentRecords:t,tournamentRecord:e,params:i,methodName:r,method:n}){if(ja())return n({tournamentRecords:t,tournamentRecord:e,...i});try{return n({tournamentRecords:t,tournamentRecord:e,...i})}catch(a){return wP({engineName:"engine",methodName:r,params:i,err:a})}}function oE(t){let{mutationStatus:e,tournamentId:i,directives:r,timeStamp:n}=t||{},{topics:a}=So();for(let o of[...a].sort(CMe)){let s=K9({topic:o});s!=null&&s.length&&mM({topic:o,notices:s})}e&&n&&a.includes(bM)&&mM({notices:[{tournamentId:i,directives:r,timeStamp:n}],topic:bM})}var Ij={[uL]:5,[lL]:5,[cL]:5,[sL]:5,[oL]:5,[nL]:5,[RX]:5,[EX]:5,[aL]:1,[VP]:1,[on]:5,[Ep]:5,[rL]:4,[eL]:4,[tL]:4,[iL]:4,[BP]:3,[XF]:2};function CMe(t,e){return(Ij[e]||0)-(Ij[t]||0)}function MMe({convertExtensions:t,removeExtensions:e}){let i=Uh();return{tournamentId:wh(),tournamentRecords:Ne(i,t,!1,e)}}function NMe(t){let{convertExtensions:e=!1,removeExtensions:i=!1}=t??{},r=(t==null?void 0:t.tournamentId)??wh();if(typeof r!="string")return{};let n=bF(r);return{tournamentRecord:Ne(n,e,!1,i)}}function AMe(){var t;let e=Uh(),{extension:i}=vt({name:Qd,tournamentRecords:e,discover:!0}),r=((t=i==null?void 0:i.value)==null?void 0:t.tournamentIds)||[];return Object.keys(e).forEach(n=>{r.includes(n)||delete e[n]}),bP(e)}function yj(t,e=!0){return typeof t!="object"||Array.isArray(t)?{error:Qu}:t!=null&&t.tournamentId?X9(e?Ne(t):t):{error:se}}function Uy(t,e=!0){if(typeof t!="object")return{error:Qu};if(QI(),Array.isArray(t)){if(t.filter(i=>i==null?void 0:i.tournamentId).length!==t.length)return{error:aM};t=Object.assign({},...t.map(i=>({[i.tournamentId]:i})))}else if(t!=null&&t.tournamentId)t={[t.tournamentId]:t},QI(t.tournamentId);else if(!Object.keys(t).every(i=>t[i].tournamentId===i))return{error:aM};return bP(e?Ne(t):t)}function OMe(t,e,i,r,n,a){let o=Z9(i,r,n,a);if(o.error)return o;let s=o.methods??[];return Object.keys(s).filter(l=>ha(s[l])).forEach(l=>{t[l]=u=>{let c=()=>e(t,{[l]:s[l],...u});if(ja())return c();try{return c()}catch(d){wP({engineName:"engine",methodName:l,params:u,err:d})}}}),{...Q,...t}}function tf(t,e){return e!=null&&e.error?(t.error=e.error,t.success=!1):(t.error=void 0,t.success=!0),t}function Ere(t,e){t.importMethods=(i,r,n,a)=>OMe(t,e,i,r,n,a),t.getTournament=i=>NMe(i),t.getState=i=>MMe({convertExtensions:i==null?void 0:i.convertExtensions,removeExtensions:i==null?void 0:i.removeExtensions}),t.version=()=>rP(),t.reset=()=>(bP({}),tf(t)),t.devContext=i=>(XI(i),tf(t)),t.getDevContext=i=>ja(i),t.newTournamentRecord=(i={})=>{let r=tE(i),n=r.tournamentId;return r.error?r:(yj(r),QI(n),{...Q,tournamentId:n})},t.setState=(i,r,n)=>{JI(r,n);let a=Uy(i,r);return tf(t,a)},t.setTournamentId=i=>QI(i),t.getTournamentId=()=>wh(),t.setTournamentRecord=(i,r,n)=>{JI(r,n);let a=yj(i,r);return tf(t,a)},t.removeTournamentRecord=i=>{let r=J9(i);return tf(t,r)},t.removeUnlinkedTournamentRecords=()=>{let i=AMe();return tf(t,i)}}function kMe(t,e,i){if(!Array.isArray(e))return{error:se,message:"directives must be an array"};let r=Y9(),n=Date.now(),a=i&&Ne(Uh(),!1,!0),o=[];for(let u of e){if(typeof u!="object")return{error:se,message:"directive must be an object"};if(u.params&&typeof u.params!="object")return{error:se,message:"params must be an object"};let{method:c,pipe:d}=u,p=u.params?{...u.params}:{};if(!r[c])return lB({methodName:c,start:n,params:p});if(d){let h=o[o.length-1],f=Object.keys(d);for(let g of f)h[g]&&(p[g]=h[g])}let m=uB(t,r[c],p,c,"sync");if(m!=null&&m.error)return a&&Uy(a),{...m,rolledBack:!!a};o.push({...m,methodName:c})}let s=Date.now(),l=Pre({timeStamp:s});return oE({directives:e,mutationStatus:l,timeStamp:s}),Jb(),{success:o.every(u=>u.success),results:o}}function bj(t,e){if(!At(e))return{error:se,message:"args must be an object"};let i=Object.values(e).filter(ha).length;if(i>1)return{message:"there must be only one arg with typeof function",error:se};let r=i?Object.keys(e).find(m=>ha(e[m])):Di(e.method)&&e.method;if(!r)return{error:vP};let{[r]:n,...a}=e,o=e!=null&&e.params?{...e.params}:{...a},s=o.rollbackOnError&&Ne(Uh(),!1,!0),l=n||t[r]||gF()[r];if(!l)return lB({methodName:r,params:o});let u=uB(t,l,o,r,"sync")??{};u!=null&&u.error&&s&&Uy(s);let c=Date.now(),d=Pre({timeStamp:c}),p=(u==null?void 0:u.success)&&(o==null?void 0:o.delayNotify)!==!0&&(o==null?void 0:o.doNotNotify)!==!0;return p&&oE({directives:[{method:l,params:o}],mutationStatus:d,timeStamp:c}),(p||!(u!=null&&u.success)||o!=null&&o.doNotNotify)&&Jb(),u}var xMe=(()=>{let t={executionQueue:(e,i)=>kMe(t,e,i),execute:e=>bj(t,e)};return Ere(t,bj),t})(),cB=xMe;function wj(t,e){if(!At(e))return{error:se,message:"args must be an object"};let i=Object.values(e).filter(ha).length;if(i>1)return{message:"there must be only one arg with typeof function",error:se};let r=i?Object.keys(e).find(l=>ha(e[l])):Di(e.method)&&e.method;if(!r)return{error:vP};let{[r]:n,...a}=e,o=e!=null&&e.params?{...e.params}:{...a},s=n||t[r]||gF()[r];return s?uB(t,s,o,r,"ask"):lB({methodName:r,params:o})}(()=>{let t={execute:e=>wj(t,e)};return Ere(t,wj),t})();var hm={},fc;function Uj(t,e=!0){if(!t)return{error:Je};if(typeof t!="object")return{error:Qu};if(t.matchUpId)fc=t.matchUpId,hm[fc]=e?Ne(t):t;else if(Array.isArray(t))for(let i of t.reverse())i.matchUpId&&(hm[i.matchUpId]=e?Ne(i):i,fc||(fc=i.matchUpId));else for(let i of Object.values(t))i.matchUpId&&(hm[i.matchUpId]=e?Ne(i):i,fc||(fc=i.matchUpId));return e?Ne(t):t}function FMe(){return hm[fc]}function LMe(){return Object.values(hm)}function _Me(){fc=void 0,hm={}}function $Me(t){return Ne(hm[fc],t==null?void 0:t.convertExtensions,!1,t==null?void 0:t.removeExtensions)}(()=>{let t={getState:n=>$Me(n),version:()=>rP(),reset:()=>(_Me(),{...Q}),drawId:void 0,error:void 0,success:!1,devContext:n=>(XI(n),t),setState:(n,a,o)=>{JI(a,o);let s=Uj(n);return e(s)}};function e(n){return n!=null&&n.error?(t.error=n.error,t.success=!1):(t.error=void 0,t.success=!0,t.drawId=n.drawId),t}return i([S_]),t;function i(n){n.forEach(a=>{Object.keys(a).forEach(o=>{t[o]=s=>{if(ja())return r({params:s,governor:a,methodName:o});try{return r({params:s,governor:a,methodName:o})}catch(l){wP({engineName:"matchUpEngine",methodName:o,params:s,err:l})}}})})}function r({params:n,governor:a,methodName:o}){t.error=void 0,t.success=!1;let s=(n==null?void 0:n.matchUp)||FMe(),l=(n==null?void 0:n.matchUps)||LMe(),u=(n==null?void 0:n.rollbackOnError)&&Ne(s,!1,!0);n={...n,matchUpId:s==null?void 0:s.matchUpId,matchUps:l,matchUp:s};let c=a[o](n);if(c!=null&&c.error)return u&&Uj(u),{...c,rolledBack:!!u};let d=(c==null?void 0:c.success)&&(n==null?void 0:n.delayNotify)!==!0&&(n==null?void 0:n.doNotNotify)!==!0;return d&&oE(),(d||!(c!=null&&c.success)||n!=null&&n.doNotNotify)&&Jb(),c}})();var rC=!1;(()=>{let t={version:()=>rP(),setDeepCopy:(r,n)=>(JI(r,n),t),devContext:r=>(XI(r),rC=!0,t)};return i([_$]),t;function e(r,n){let a=r({...n});return a!=null&&a.error||oE(),Jb(),rC&&(XI(!1),rC=!1),a}function i(r){r.forEach(n=>{Object.keys(n).forEach(a=>{t[a]=o=>{if(ja()){let s=e(n[a],o);return!(s!=null&&s.error)&&o!=null&&o.setState&&s!=null&&s.tournamentRecord&&Uy(s.tournamentRecord),s}else try{let s=e(n[a],o);return!(s!=null&&s.error)&&o!=null&&o.setState&&s!=null&&s.tournamentRecord&&Uy(s.tournamentRecord),s}catch(s){let l;typeof s=="string"?l=s.toUpperCase():s instanceof Error&&(l=s.message),console.log("ERROR",{params:JSON.stringify(o),method:a,error:l})}}})})}})();cB.importMethods(wK,!0,1);var Cre=cB,BMe={getTournamentPoints:RR},VMe=BMe,jMe={calculateNewRatings:iZ,generateDynamicRatings:rZ},GMe=jMe,HMe={...VMe,...GMe};cB.importMethods(HMe);var zMe={[sy]:{roundsToSeparate:void 0,policyName:"Nationality Code",policyAttributes:[{key:"person.nationalityCode"},{key:"individualParticipants.person.nationalityCode"}]}},WMe={[xu]:{policyName:"positionActionsUnrestricted",enabledStructures:[],otherFlightEntries:!0,disableRoundRestrictions:!0,activePositionOverrides:[cm,sI]}},qMe={[xu]:{policyName:"positionActionsNoMovement",enabledStructures:[{stages:[],stageSequences:[],enabledActions:[cm,hy,$m],disabledActions:[]}]}},YMe={[xu]:{policyName:"positionActionsDisabled",enabledStructures:!1}},KMe={[gv]:{policyName:"Participant Privacy Policy",participant:{contacts:!1,individualParticipants:{onlineResources:!1,participantName:!0,participantOtherName:!0,participantId:!0,participantRole:!0,participantStatus:!0,penalties:!1,rankings:!0,ratings:!0,representing:!0,participantRoleResponsibilities:!1,participantType:!0,person:{addresses:!1,biographicalInformation:!1,birthDate:!1,contacts:!1,nationalityCode:!0,nativeFamilyName:!1,nativeGivenName:!1,onlineResources:!1,otherNames:!0,parentOrganisationId:!1,passportFamilyName:!1,passportGivenName:!1,personId:!1,personOtherIds:!1,previousNames:!1,sex:!1,standardFamilyName:!0,standardGivenName:!0,status:!1,tennisId:!1,wheelchair:!0}},individualParticipantIds:!0,onlineResources:!1,participantName:!0,participantOtherName:!0,participantId:!0,participantRole:!0,participantStatus:!0,penalties:!1,rankings:!0,ratings:!0,representing:!0,participantRoleResponsibilities:!1,participantType:!0,person:{addresses:!1,biographicalInformation:!1,birthDate:!1,contacts:!1,nationalityCode:!0,nativeFamilyName:!1,nativeGivenName:!1,onlineResources:!1,otherNames:!0,parentOrganisationId:!1,passportFamilyName:!1,passportGivenName:!1,personId:!1,personOtherIds:!1,previousNames:!1,sex:!1,standardFamilyName:!0,standardGivenName:!0,status:!1,tennisId:!1,wheelchair:!0}}}},XMe={[fo]:{processCodes:{incompleteAssignmentsOnDefault:["RANKING.IGNORE"]},defaultMatchUpFormat:zo,allowDeletionWithScoresPresent:{drawDefinitions:!1,structures:!1},requireParticipantsForScoring:!1,requireAllPositionsAssigned:void 0,allowChangePropagation:!1,stage:{[Ae]:{stageSequence:{1:{requireAllPositionsAssigned:!0}}}},matchUpFormats:[],matchUpStatusCodes:{[ua]:[],[bl]:[],[Pt]:[],[Ca]:[],[zr]:[],[Ft]:[]}}},nC="Personal circumstance",JMe={[fo]:{requireAllPositionsAssigned:!1,stage:{[Ae]:{stageSequence:{1:{requireAllPositionsAssigned:!0}}}},defaultMatchUpFormat:zo,matchUpFormats:[{description:"Best of 3 tiebreak sets",matchUpFormat:zo,categoryNames:[],categoryTypes:[]},{description:"Two tiebreak sets, 7-point match tiebreak at one set all",matchUpFormat:"SET3-S:6/TB7-F:TB7"},{description:"Two tiebreak sets, 10-point match tiebreak at one set all",matchUpFormat:"SET3-S:6/TB7-F:TB10"},{description:"One standard tiebreak set to 6, 7-point tiebreak at 6 games all",matchUpFormat:"SET1-S:6/TB7"},{description:"Best of 3 sets to 4",matchUpFormat:"SET3-S:4/TB7"},{description:"Two out of three short sets to 4 with 5-point tiebreak at 3 games all",matchUpFormat:"SET3-S:4/TB5@3"},{description:"One short set to 4, 7-point tiebreak at 4 games all",matchUpFormat:"SET1-S:4/TB7"},{description:"One short set to 4, 5-point tiebreak at 3 games all",matchUpFormat:"SET1-S:4/TB5@3"},{description:"Two short sets to 4, 10-point match tiebreak at one set all",matchUpFormat:"SET3-S:4/TB7-F:TB10"},{description:"Two short sets to 4, 7-point match tiebreak at one set all",matchUpFormat:"SET3-S:4/TB7-F:TB7"},{description:"One no advantage set to 5, tiebreak to 9 at 4-4",matchUpFormat:"SET1-S:5/TB9@4"},{description:"One set to 6 with deciding game at 5 games all",matchUpFormat:"SET1-S:6NOAD"},{description:"One short set to 4, deciding game is played at 3 games all",matchUpFormat:"SET1-S:4NOAD"},{description:"Two short sets to 4 with deciding game at 3-3, 7-point match tiebreak at one set all",matchUpFormat:"SET3-S:4NOAD-F:TB7"},{description:"8 game pro-set with 7 point tiebreak at 8 games all",matchUpFormat:"SET1-S:8/TB7"},{description:"8 game pro-set with 7 point tiebreak at 7 games all",matchUpFormat:"SET1-S:8/TB7@7"},{description:"Best of 3 10-point tiebreak games",matchUpFormat:"SET3-S:TB10"},{description:"One 10-point tiebreak game",matchUpFormat:"SET1-S:TB10"},{description:"Timed 20 minute game - game based",matchUpFormat:"SET1-S:T20"}],matchUpStatusCodes:{[ua]:[{matchUpStatusCodeDisplay:"Abandoned",label:"Abandoned match",matchUpStatusCode:"OA"}],[bl]:[{matchUpStatusCodeDisplay:"Unplayed or Cancelled",label:"Cancelled match",matchUpStatusCode:"OC"}],[Ca]:[{matchUpStatusCodeDisplay:"Incomplete",label:"Incomplete match",matchUpStatusCode:"OI"}],[Pt]:[{description:"Disqualification for cause or ineligibility",label:"Disqualification (ineligibility)",matchUpStatusCodeDisplay:"Def [dq]",matchUpStatusCode:"DQ"},{description:"Misconduct before or between matches",label:"Misconduct",matchUpStatusCodeDisplay:"Def [cond]",matchUpStatusCode:"DM"},{description:"Failure to start match because of adult discipline",label:"Fail. (adult discipline)",matchUpStatusCodeDisplay:"Def [ad]",matchUpStatusCode:"D5"},{description:"Refusal to start match for reason other than adult discipline, injury, illness, or personal circumstance. (After the Referee has conclusively confirmed that a player refuses to play a match, the Referee need not wait until the scheduled time of the match to records the result.)",label:"Refusal to start match",matchUpStatusCodeDisplay:"Def [refsl]",matchUpStatusCode:"D4"},{label:"Not showing up",matchUpStatusCodeDisplay:"Def [ns]",matchUpStatusCode:"D6"},{description:"Lateness for match including, but not limited to, intending to play but mistakenly arriving at the wrong time, location, or without proper equipment",label:"Lateness for match",matchUpStatusCodeDisplay:"Score + Def [late]",matchUpStatusCode:"D7"},{label:"Double default",matchUpStatusCodeDisplay:"Def/Def",matchUpStatusCode:"DD"},{description:"Refusal to continue playing a match for reason other than injury, illness, personal circumstance, or adult discipline",label:"Refusal to continue match",matchUpStatusCodeDisplay:"Def [refsl]",matchUpStatusCode:"D9"},{description:"Default for receiving an injection, IV, or supplemental oxygen",label:"Default (PEDs)",matchUpStatusCodeDisplay:"Def [med]",matchUpStatusCode:"DI"},{description:"Default under Point Penalty System",label:"Default (Point Penalty System)",matchUpStatusCodeDisplay:"Def [pps]",matchUpStatusCode:"DP"}],[Ft]:[{matchUpStatusCodeDisplay:"Wo [inj]",matchUpStatusCode:"W1",label:"Injury"},{matchUpStatusCodeDisplay:"Wo [ill]",matchUpStatusCode:"W2",label:"Illness"},{matchUpStatusCodeDisplay:"Wo [pc]",label:nC,matchUpStatusCode:"W3"},{matchUpStatusCodeDisplay:"Wo/Wo",matchUpStatusCode:"WOWO",label:"Double walkover"},{matchUpStatusCodeDisplay:"Wo [Tae]",label:"Tournament Administrative Error",matchUpStatusCode:"W4"},{matchUpStatusCodeDisplay:"Wo/Withdrawn",matchUpStatusCode:"W5",label:"Withdrawn"}],[zr]:[{matchUpStatusCodeDisplay:"Ret [inj]",matchUpStatusCode:"RJ",label:"Injury"},{matchUpStatusCodeDisplay:"Ret [ill]",matchUpStatusCode:"RI",label:"Illness"},{matchUpStatusCodeDisplay:"Ret [pc]",label:nC,matchUpStatusCode:"RC"},{description:"Retirement because of adult discipline",label:"Ret. (adult discipline)",matchUpStatusCodeDisplay:"Ret [ad]",matchUpStatusCode:"RD"},{description:"A player who retires from a match remains eligible for consolations, place playoffs, doubles and subsequent round robin matches",matchUpStatusCodeDisplay:"Ret [elg]",label:"Ret. (eligible)",matchUpStatusCode:"RU"}],[Jl]:[{matchUpStatusCodeDisplay:"Wd [inj]",matchUpStatusCode:"WD.INJ",label:"Injury"},{matchUpStatusCodeDisplay:"Wd [ill]",matchUpStatusCode:"WD.ILL",label:"Illness"},{matchUpStatusCodeDisplay:"Wd [pc]",label:nC,matchUpStatusCode:"WD.PC"},{matchUpStatusCodeDisplay:"Wd/Wd",matchUpStatusCode:"WD.WD",label:"Double withdrawal"},{label:"Tournament Administrative Error",matchUpStatusCodeDisplay:"Wd [Tae]",matchUpStatusCode:"WD.TAE"}]}}},QMe={[Oo]:{seedingProfile:{positioning:DP},validSeedPositions:{ignore:!0},duplicateSeedNumbers:!0,drawSizeProgression:!0,policyName:"ITF SEEDING",seedsCountThresholds:[{drawSize:4,minimumParticipantCount:3,seedsCount:2},{drawSize:16,minimumParticipantCount:12,seedsCount:4},{drawSize:32,minimumParticipantCount:24,seedsCount:8},{drawSize:64,minimumParticipantCount:48,seedsCount:16},{drawSize:128,minimumParticipantCount:97,seedsCount:32},{drawSize:256,minimumParticipantCount:192,seedsCount:64}]}},ZMe={POLICY_AVOIDANCE_COUNTRY:zMe,POLICY_POSITION_ACTIONS_DEFAULT:_Q,POLICY_POSITION_ACTIONS_DISABLED:YMe,POLICY_POSITION_ACTIONS_NO_MOVEMENT:qMe,POLICY_POSITION_ACTIONS_UNRESTRICTED:WMe,POLICY_PRIVACY_DEFAULT:KMe,POLICY_ROUND_NAMING_DEFAULT:bL,POLICY_SCHEDULING_DEFAULT:wee,POLICY_SCORING_DEFAULT:XMe,POLICY_SCORING_USTA:JMe,POLICY_SEEDING_ITF:QMe,POLICY_SEEDING_DEFAULT:ree},eNe={ratingsParameters:Tr,matchUpFormats:oSe,countryToFlag:xX,tieFormats:Fee,countries:yc,policies:ZMe,flagIOC:a0e},tNe={};bt(tNe,{activeMatchUpStatuses:()=>KF,auditConstants:()=>iCe,completedMatchUpStatuses:()=>yr,directingMatchUpStatuses:()=>wX,displayConstants:()=>AEe,drawDefinitionConstants:()=>J8,entryStatusConstants:()=>h0e,errorConditionConstants:()=>oUe,eventConstants:()=>pSe,extensionConstants:()=>dX,flightConstants:()=>bCe,genderConstants:()=>wF,keyValueConstants:()=>nRe,matchUpActionConstants:()=>gPe,matchUpStatusConstants:()=>TX,matchUpTypes:()=>Mwe,nonDirectingMatchUpStatuses:()=>UX,particicipantsRequiredMatchUpStatuses:()=>yX,participantConstants:()=>n0e,participantRoles:()=>AL,participantTypes:()=>rI,penaltyConstants:()=>yNe,policyConstants:()=>VSe,positionActionConstants:()=>CDe,ratingConstants:()=>HDe,recoveryTimeRequiredMatchUpStatuses:()=>ZSe,requestConstants:()=>l1e,resourceContants:()=>ZUe,resultConstants:()=>Hwe,scaleConstants:()=>LSe,scheduleConstants:()=>B0e,sortingConstants:()=>ECe,surfaceConstants:()=>DNe,tieFormatConstants:()=>sSe,timeItemConstants:()=>L0e,topicConstants:()=>t0e,tournamentConstants:()=>ore,upcomingMatchUpStatuses:()=>SX,validMatchUpStatuses:()=>bX,venueConstants:()=>ENe,weekdayConstants:()=>jee});var iNe="Coaching",rNe="Ball Abuse",nNe="Racket Abuse",aNe="Verbal Abuse",oNe="INELIGIBILITY",sNe="Physical Abuse",lNe="Unsportmanlike Conduct",uNe="Dress Code Violation",cNe="Equipment Violation",dNe="Leaving the court",pNe="Failure to complete",mNe="No Show",hNe="Other",fNe="REFUSAL_TO_PLAY",gNe="PROHIBITED_SUBSTANCE",vNe="Puncuality",INe="Failure to sign in",yNe={COACHING:iNe,BALL_ABUSE:rNe,RACKET_ABUSE:nNe,VERBAL_ABUSE:aNe,PHYSICAL_ABUSE:sNe,INELIGIBILITY:oNe,UNSPORTSMANLIKE_CONDUCT:lNe,PROHIBITED_SUBSTANCE:gNe,DRESS_CODE_VIOLATION:uNe,EQUIMENT_VIOLATION:cNe,LEAVING_THE_COURT:dNe,REFUSAL_TO_PLAY:fNe,FAILURE_TO_COMPLETE:pNe,NO_SHOW:mNe,OTHER:hNe,PUNCTUALITY:vNe,FAILUIRE_TO_SIGN_IN:INe},bNe="CLAY",wNe="HARD",UNe="GRASS",SNe="CARPET",TNe="ARTIFICIAL",DNe={CLAY:bNe,HARD:wNe,GRASS:UNe,CARPET:SNe,ARTIFICIAL:TNe},PNe="INDOOR",RNe="OUTDOOR",ENe={INDOOR:PNe,OUTDOOR:RNe};const CNe=Yt({WebkitBoxSizing:"border-box",marginInlineEnd:".3em",display:"inline-block",boxSizing:"border-box",position:"relative",borderRadius:2,variants:{variant:{doubles:{width:".75rem"},singles:{width:"1rem"}}}});function MNe({matchUp:t,individualParticipant:e,spacer:i}){var r,n,a;const o=((r=e==null?void 0:e.person)==null?void 0:r.iso2NationalityCode)||"",s=o?(n=eNe.countryToFlag(o))==null?void 0:n.slice(0,4):"",l=document.createElement("span"),u=(a=t==null?void 0:t.matchUpType)==null?void 0:a.toLowerCase();return i||(l.className=CNe({variant:u})),l.innerHTML=i?"":s,l}function aC({individualParticipant:t,composition:e,className:i,matchUp:r,spacer:n,side:a,type:o}){if(o==="scale")return Ewe({individualParticipant:t,composition:e,className:i,matchUp:r,spacer:n});const s=(e==null?void 0:e.configuration)||{},l=document.createElement("div");return o==="flag"&&s.flags&&MNe({className:i,matchUp:r,individualParticipant:t,spacer:n})||o==="seeding"&&Pwe({className:i,composition:e,matchUp:r,side:a})||l}const NNe="Qualifier",ANe="BYE",ONe="TBD";function Sj(t){var e,i,r,n;const{isWinningSide:a,side:o,sideNumber:s,individualParticipant:l,matchUp:u,composition:c}=t||{},d=a?"winner":void 0,p=t.eventHandlers||{},m=c==null?void 0:c.configuration,h={QUALIFIER:((e=m==null?void 0:m.placeHolders)==null?void 0:e.qualifier)||NNe,BYE:((i=m==null?void 0:m.placeHolders)==null?void 0:i.bye)||ANe,TBD:((r=m==null?void 0:m.placeHolders)==null?void 0:r.tbd)||ONe},f=l==null?void 0:l.participantName,g=U=>{Is(p==null?void 0:p.participantClick)&&(U.stopPropagation(),p.participantClick({individualParticipant:l,pointerEvent:U,matchUp:u,side:o}))},v=document.createElement("div");v.classList.add("tmx-i"),v.setAttribute("sideNumber",s),v.setAttribute("id",l==null?void 0:l.participantId),v.onclick=g;const y=document.createElement("div");y.className=owe({variant:d});const I=(m==null?void 0:m.flags)&&aC({...t,type:"flag"});if(I)y.appendChild(I);else{const U=aC({type:"scale",...t});U&&y.appendChild(U)}const b=document.createElement("div");if(b.className=swe({variant:d}),f){const U=document.createElement("span");if(a&&m!=null&&m.winnerColor)U.style.color=typeof m.winnerColor=="string"?m.winnerColor:"green";else if(m!=null&&m.genderColor){const T=(n=l==null?void 0:l.person)==null?void 0:n.sex,D=T==="MALE"&&"#2E86C1"||T==="FEMALE"&&"#AA336A"||"";U.style.color=typeof m.genderColor=="string"?m.genderColor:D}U.innerHTML=f,b.appendChild(U)}else{const U=document.createElement("abbr");U.className=awe({variant:m.showAddress?"showAddress":""}),U.innerHTML=(o==null?void 0:o.bye)&&h.BYE||(o==null?void 0:o.qualifier)&&h.QUALIFIER||h.TBD,b.appendChild(U)}const S=aC({...t,className:Dwe(),type:"seeding"});S&&b.appendChild(S),y.appendChild(b),v.appendChild(y);const w=Twe(t);return v.appendChild(w),{element:v}}const kNe=Yt({width:"auto",display:"inline-block",textTransform:"uppercase",fontFamily:"Sharp Sans, Arial, sans-serif",fontSize:"0.625rem",lineHeight:"1rem",marginInline:"0.25rem 0.25rem",paddingInline:"0.25rem 0.25rem",fontWeight:700,borderRadius:"4px",color:"#fff",textAlign:"center",whiteSpace:"nowrap",variants:{variant:{defaulted:{backgroundColor:"#df164c"},retired:{backgroundColor:"#df164c"},walkover:{backgroundColor:"black"},double_walkover:{backgroundColor:"black"}}}});function xNe({matchUpStatus:t}){const e=t==null?void 0:t.toLowerCase(),i=["WALKOVER","DOUBLE_WALKOVER"].includes(t)?"WO":(t==null?void 0:t.slice(0,3))||"",r=document.createElement("div");r.className=kNe({variant:e});const n=document.createElement("abbr");return n.setAttribute("title",t),n.style.textDecoration="none",n.style.borderBottom="none",n.innerHTML=i,r.appendChild(n),r}function FNe(t){return t instanceof Element||t}const LNe=Yt({marginInlineEnd:".5rem",backgroundColor:"pink",marginInlineStart:2,height:40,width:40});function _Ne({teamLogo:t}){console.log({teamLogo:t});const e=document.createElement("div");return e.className=LNe(),e}const $Ne=Yt({flexDirection:"column",position:"relative",display:"flex"}),BNe=Yt({alignItems:"stretch",display:"flex"}),VNe=Yt({marginInlineEnd:".25rem",color:"green"});function jNe({dim:t="20px"}={}){const e=VNe();return`
    <div style="line-height: 0;">
      <svg height="${t}" viewBox="0 0 18 24" width="${t}" xmlns="http://www.w3.org/2000/svg" class="${e}" style="fill: currentcolor;">
        <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"></path>
      </svg>
    </div>
  `}function Mre({initialRoundNumber:t=1,eventHandlers:e,sideContainer:i,composition:r,participant:n,placeholder:a,sideNumber:o,matchUp:s}){var l,u,c;const{winningSide:d,matchUpType:p,isRoundRobin:m,matchUpStatus:h}=s||{},f=r==null?void 0:r.configuration;let g;const v=o?(l=s==null?void 0:s.sides)==null?void 0:l.find(A=>A.sideNumber===o):void 0;n||(n=v==null?void 0:v.participant,g=f!=null&&f.allDrawPositions||f!=null&&f.drawPositions&&v!=null&&v.drawPosition&&((s==null?void 0:s.roundNumber)===t||v!=null&&v.participantFed||m)?v==null?void 0:v.drawPosition:"");const y=p==="DOUBLES",I=y?(u=n==null?void 0:n.individualParticipants)==null?void 0:u[0]:n,b=y&&((c=n==null?void 0:n.individualParticipants)==null?void 0:c[1]),S=o===d||h==="BYE"&&n,w=(f==null?void 0:f.winnerChevron)&&S,U=f==null?void 0:f.teamLogo,T=["RETIRED","DOUBLE_WALKOVER","WALKOVER","DEFAULTED"].includes(h)&&!S,D=f==null?void 0:f.gameScoreOnly,P=document.createElement("div");if(P.className=i&&uwe({drawPosition:g,sideNumber:o}),P.classList.add("tmx-p"),P.setAttribute("id",n==null?void 0:n.participantId),U){const A=_Ne({teamLogo:U});P.appendChild(A)}const E=document.createElement("div");E.className=lwe({variant:y?"doubles":"singles"});const R=document.createElement("div");R.className=cwe({winnerChevron:w,isDoubles:y});const N=Sj({individualParticipant:I,eventHandlers:e,isWinningSide:S,composition:r,sideNumber:o,matchUp:s,side:v}).element;if(R.appendChild(N),b){const A=Sj({individualParticipant:b,eventHandlers:e,isWinningSide:S,composition:r,sideNumber:o,matchUp:s,side:v}).element;R.appendChild(A)}else y&&a&&FNe(a)&&R.appendChild(a);if(E.appendChild(R),P.appendChild(E),i){const A=document.createElement("div");if(S&&!D){const M=jNe();typeof M=="string"?A.innerHTML=M:A.appendChild(M)}else if(T){const M=xNe({matchUpStatus:h});A.appendChild(M)}P.appendChild(A)}return P}const GNe=Yt({borderBottom:"solid 1px black",marginInlineStart:"16px",marginInlineEnd:"16px",fontWeight:"bold",height:"1.5em"});function HNe({eventHandlers:t,roundMatchUps:e,roundProfile:i,roundNumber:r,context:n}){var a;const o=document.createElement("div");o.className=GNe(),o.classList.add("tmx-rh"),o.setAttribute("roundNumber",r);const s=Is(t==null?void 0:t.roundHeaderClick);s&&(o.onclick=d=>t.roundHeaderClick({roundNumber:r,roundProfile:i,roundMatchUps:e,context:n,pointerEvent:d}));const l=s?"":"",u=(a=i==null?void 0:i[r])==null?void 0:a.roundName,c=u&&` <div style="display: flex; flex-direction: row; justify-content: space-between">
        <div>${u}</div>
        <div style="font-weight: bold">${l}</div>
      </div>
  `;return o.innerHTML=c||"",o}const Nre=Yt({flexDirection:"column",display:"flex"}),zNe=Yt({flexDirection:"row",display:"flex"}),Are=Yt({justifyContent:"space-around",marginInlineStart:"16px",marginInlineEnd:"16px",flexDirection:"column",height:"100%",display:"flex",variants:{variant:{adHoc:{justifyContent:"flex-start"}}}}),WNe=Yt({borderTop:"solid 1px black",marginRight:"-1em",marginLeft:"-1em",paddingTop:".5em",marginTop:".2em",variants:{variant:{0:{marginTop:"1em",borderTop:"none",paddingTop:"0px"}},roundOrder:{first:{marginLeft:"0em"},last:{marginRight:"0em"}}}}),qNe=Yt({fontWeight:"bold",color:"blue",height:"1em"}),Tj=Yt({width:"$score$setWidth",display:"inline-block",fontSize:9,variants:{variant:{set:{textAlign:"center"},points:{marginInlineEnd:3}}}}),YNe=Yt({transform:"translateY(-50%)",textTransform:"uppercase",backgroundColor:"#fff",position:"absolute",textAlign:"center",top:"calc(50%)",color:"#bbb",fontSize:0,right:4});function KNe(){return Yt({backgroundColor:"magenta",position:"absolute",opacity:"0.2",height:"100%",width:"100%",top:0})}const XNe=Yt({});function JNe({configuration:t}){const e={backgroundColor:"$matchUpBackgroundColor",WebkitTransition:"all 0.30s linear",boxShadow:"$matchUp$boxShadow",transition:"all 0.30s linear",border:"solid $border",marginBottom:"$space$1",marginTop:"$space$1",position:"relative",display:"grid",width:"100%",borderInlineStartWidth:"$borderWidths$borderInlineStart"};if(t!=null&&t.matchUpHover){const i=typeof t.matchUpHover=="string"?t.matchUpHover:"cyan";e["&:hover"]={backgroundColor:i}}else e["&:hover"]={borderColor:"$borderHover"};return Yt(e)}function QNe({variant:t}){return Yt({borderBottom:"solid 1px lightgray",backgroundColor:"$matchUp",position:"relative",width:"100%",height:"$lineHeights$centerInfo",variants:{variant:{1:{borderBottom:"solid 1px black"},2:{borderBottom:"solid 1px lightgray"}}}})({variant:t})}const ZNe=Yt({justifyContent:"center",alignContent:"center",flexDirection:"column",height:"100%",display:"flex"}),eAe=Yt({fontFamily:"Lato,Arial,Helvetica,sans-serif",WebkitFontSmooting:"antialiased",marginInlineStart:"calc(20%)",WebkitBoxOrient:"horizontal",WebKitBoxDirection:"normal",WebkitBoxPack:"center",boxSizing:"inherit",flexDirection:"row",display:"flex"}),Dj=Yt({alignContent:"center",boxSizing:"inherit",fontFamily:"Lato",fontWeight:900,fontSize:9});function tAe({eventHandlers:t,entryStatus:e,sideNumber:i,className:r,matchUp:n}){const a=document.createElement("div");Is(t==null?void 0:t.centerInfoClick)&&(a.onclick=c=>t.centerInfoClick({matchUp:n,sideNumber:i,pointerEvent:c})),a.className=Up(QNe({variant:i}),r),a.classList.add("tmx-ci"),a.setAttribute("sideNumber",i);const o=document.createElement("div");o.className=ZNe();const s=document.createElement("div");s.className=eAe();const l=document.createElement("div");l.className=Dj(),l.innerHTML=e?"Entry status:&nbsp;":"",s.appendChild(l);const u=document.createElement("div");return u.className=Dj(),u.innerHTML=e||"",s.appendChild(u),o.appendChild(s),a.appendChild(o),{element:a}}const uI={scheduleInfo:1.8,centerInfo:1.5,gameScore:2};function iAe({composition:t,isDoubles:e,roundFactor:i=1}){const r=parseInt(window.getComputedStyle(document.body).getPropertyValue("font-size")),n=(t==null?void 0:t.configuration)||{},a=(n==null?void 0:n.connectorWidth)||16,o=n.centerInfo?uI.centerInfo*r:0,s=n.scheduleInfo?uI.scheduleInfo*r:0,l=(60+(n.showAddress?r:0))*(e?1.3:1)+o,u=l*i,c=(l+s)*i;return Yt({"&::before":{borderBlockStart:"$borderWidths$matchUp solid #999",left:-a,width:a,position:"absolute",borderRadius:2,top:-1},"&::after":{width:a,position:"absolute",borderRadius:2,left:"100%"},"&::after, &::before":{borderWidth:"$borderWidths$matchUp",borderColor:"$connector",display:"block",content:""},variants:{isFirstRound:{true:{"&::before":{height:0,width:0,borderWidth:0}}},link:{m1:{"&::after":{borderInlineEnd:"$borderWidths$matchUp solid $connector",borderTopStyle:"solid",height:u,top:-1}},m2:{"&::after":{bottom:"calc(100%)",borderInlineEnd:"$borderWidths$matchUp solid $connector",borderBottomStyle:"solid",height:c}},m0:{"&::after":{borderTopStyle:"solid",borderColor:"$connector",top:-1}},mr:{"&::before":{height:0,width:0,borderWidth:0},"&::after":{height:0,width:0,borderWidth:0}},noProgression:{true:{"&::after":{height:0,width:0,borderWidth:0}}}}}})}const Ore=t=>Yt({display:"flex",alignItems:"center",height:t,justifyContent:"flex-end",backgroundColor:"$matchUp",variants:{sideNumber:{1:{borderBottom:"1px solid $internalDividers"}},fontSize:{small:{fontSize:"smaller",paddingRight:"1em",color:"blue"}}}}),rAe=Yt({lineHeight:"0.75rem",fontSize:"0.625rem",left:"1.1rem",top:".4rem"}),kre=Yt({lineHeight:"$lineHeights$gameScore",justifyContent:"center",width:"$score$setWidth",position:"relative",textAlign:"center",cursor:"pointer",fontWeight:500,fontSize:"$1",display:"flex",margin:0,variants:{variant:{winner:{color:"$winner!important",fontWeight:700},loser:{color:"$loser!important"}}}}),nAe=Yt({marginInlineEnd:"$space$gameMarginInlineEnd",justifyContent:"flex-end",alignItems:"center",display:"flex"});function aAe({value:t}={}){const e=document.createElement("input");return e.onclick=i=>i.target.select(),e.className=kre(),e.value=t,e}function oAe({gameScoreOnly:t,scoreStripes:e,set:i,sideNumber:r}){const n=r===(i==null?void 0:i.winningSide)||i!=null&&i.winningSide?"loser":void 0,a=r===2?i.side2Score:i.side1Score,o=i.side2TiebreakScore||i.side1TiebreakScore,s=r===2?i.side2TiebreakScore:i.side1TiebreakScore,l=a===void 0&&s,u=l||a,c=e&&i.setNumber%2?"lightgray":"transparent",d=i.editing?i.editing===r:void 0;let p;if(d)p=aAe({value:u});else if(p=document.createElement("p"),p.className=kre({variant:n}),p.classList.add("tmx-st"),p.setAttribute("setNumber",i.setNumber),p.style.backgroundColor=c,p.innerHTML=isNaN(u)?"":u,!t){const m=document.createElement("span");m.className=rAe(),m.innerHTML=o&&!l?s:"",p.appendChild(m)}return p}function sAe({participantHeight:t,eventHandlers:e,composition:i,sideNumber:r,matchUp:n}){var a,o,s,l;const u=(a=i==null?void 0:i.configuration)==null?void 0:a.winnerChevron,c=(o=i==null?void 0:i.configuration)==null?void 0:o.gameScoreOnly,d=((s=n==null?void 0:n.score)==null?void 0:s.sets)||[],p=(l=i==null?void 0:i.configuration)==null?void 0:l.scoreBox,m=r===2?t:t-1,h=Ore(m),f=y=>{Is(e==null?void 0:e.scoreClick)&&(y.stopPropagation(),e.scoreClick({pointerEvent:y,matchUp:n}))},g=document.createElement("div");g.className=h({sideNumber:!p&&r,fontSize:"5px"}),g.classList.add("sideScore"),g.classList.add("tmx-scr"),g.onclick=f;const v=document.createElement("div");v.className=nAe();for(const y of d||[]){const I=oAe({gameScoreOnly:c,scoreStripes:u,sideNumber:r,set:y});v.appendChild(I)}return g.appendChild(v),g}const lAe=Yt({height:"$lineHeights$scheduleInfo",borderBottom:"1px solid darkgray",justifyContent:"space-between",backgroundColor:"#F8F9F9",boxSizing:"border-box",paddingRight:"0.2rem",paddingLeft:"0.5rem",alignItems:"center",cursor:"pointer",color:"#7F8080",display:"flex",width:"100%"});var xre={exports:{}};(function(t,e){(function(i,r){t.exports=r()})(dwe,function(){var i=1e3,r=6e4,n=36e5,a="millisecond",o="second",s="minute",l="hour",u="day",c="week",d="month",p="quarter",m="year",h="date",f="Invalid Date",g=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,v=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,y={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(A){var M=["th","st","nd","rd"],C=A%100;return"["+A+(M[(C-20)%10]||M[C]||M[0])+"]"}},I=function(A,M,C){var O=String(A);return!O||O.length>=M?A:""+Array(M+1-O.length).join(C)+A},b={s:I,z:function(A){var M=-A.utcOffset(),C=Math.abs(M),O=Math.floor(C/60),k=C%60;return(M<=0?"+":"-")+I(O,2,"0")+":"+I(k,2,"0")},m:function A(M,C){if(M.date()<C.date())return-A(C,M);var O=12*(C.year()-M.year())+(C.month()-M.month()),k=M.clone().add(O,d),x=C-k<0,F=M.clone().add(O+(x?-1:1),d);return+(-(O+(C-k)/(x?k-F:F-k))||0)},a:function(A){return A<0?Math.ceil(A)||0:Math.floor(A)},p:function(A){return{M:d,y:m,w:c,d:u,D:h,h:l,m:s,s:o,ms:a,Q:p}[A]||String(A||"").toLowerCase().replace(/s$/,"")},u:function(A){return A===void 0}},S="en",w={};w[S]=y;var U="$isDayjsObject",T=function(A){return A instanceof R||!(!A||!A[U])},D=function A(M,C,O){var k;if(!M)return S;if(typeof M=="string"){var x=M.toLowerCase();w[x]&&(k=x),C&&(w[x]=C,k=x);var F=M.split("-");if(!k&&F.length>1)return A(F[0])}else{var $=M.name;w[$]=M,k=$}return!O&&k&&(S=k),k||!O&&S},P=function(A,M){if(T(A))return A.clone();var C=typeof M=="object"?M:{};return C.date=A,C.args=arguments,new R(C)},E=b;E.l=D,E.i=T,E.w=function(A,M){return P(A,{locale:M.$L,utc:M.$u,x:M.$x,$offset:M.$offset})};var R=function(){function A(C){this.$L=D(C.locale,null,!0),this.parse(C),this.$x=this.$x||C.x||{},this[U]=!0}var M=A.prototype;return M.parse=function(C){this.$d=function(O){var k=O.date,x=O.utc;if(k===null)return new Date(NaN);if(E.u(k))return new Date;if(k instanceof Date)return new Date(k);if(typeof k=="string"&&!/Z$/i.test(k)){var F=k.match(g);if(F){var $=F[2]-1||0,_=(F[7]||"0").substring(0,3);return x?new Date(Date.UTC(F[1],$,F[3]||1,F[4]||0,F[5]||0,F[6]||0,_)):new Date(F[1],$,F[3]||1,F[4]||0,F[5]||0,F[6]||0,_)}}return new Date(k)}(C),this.init()},M.init=function(){var C=this.$d;this.$y=C.getFullYear(),this.$M=C.getMonth(),this.$D=C.getDate(),this.$W=C.getDay(),this.$H=C.getHours(),this.$m=C.getMinutes(),this.$s=C.getSeconds(),this.$ms=C.getMilliseconds()},M.$utils=function(){return E},M.isValid=function(){return this.$d.toString()!==f},M.isSame=function(C,O){var k=P(C);return this.startOf(O)<=k&&k<=this.endOf(O)},M.isAfter=function(C,O){return P(C)<this.startOf(O)},M.isBefore=function(C,O){return this.endOf(O)<P(C)},M.$g=function(C,O,k){return E.u(C)?this[O]:this.set(k,C)},M.unix=function(){return Math.floor(this.valueOf()/1e3)},M.valueOf=function(){return this.$d.getTime()},M.startOf=function(C,O){var k=this,x=!!E.u(O)||O,F=E.p(C),$=function(W,q){var Y=E.w(k.$u?Date.UTC(k.$y,q,W):new Date(k.$y,q,W),k);return x?Y:Y.endOf(u)},_=function(W,q){return E.w(k.toDate()[W].apply(k.toDate("s"),(x?[0,0,0,0]:[23,59,59,999]).slice(q)),k)},L=this.$W,B=this.$M,V=this.$D,G="set"+(this.$u?"UTC":"");switch(F){case m:return x?$(1,0):$(31,11);case d:return x?$(1,B):$(0,B+1);case c:var j=this.$locale().weekStart||0,z=(L<j?L+7:L)-j;return $(x?V-z:V+(6-z),B);case u:case h:return _(G+"Hours",0);case l:return _(G+"Minutes",1);case s:return _(G+"Seconds",2);case o:return _(G+"Milliseconds",3);default:return this.clone()}},M.endOf=function(C){return this.startOf(C,!1)},M.$set=function(C,O){var k,x=E.p(C),F="set"+(this.$u?"UTC":""),$=(k={},k[u]=F+"Date",k[h]=F+"Date",k[d]=F+"Month",k[m]=F+"FullYear",k[l]=F+"Hours",k[s]=F+"Minutes",k[o]=F+"Seconds",k[a]=F+"Milliseconds",k)[x],_=x===u?this.$D+(O-this.$W):O;if(x===d||x===m){var L=this.clone().set(h,1);L.$d[$](_),L.init(),this.$d=L.set(h,Math.min(this.$D,L.daysInMonth())).$d}else $&&this.$d[$](_);return this.init(),this},M.set=function(C,O){return this.clone().$set(C,O)},M.get=function(C){return this[E.p(C)]()},M.add=function(C,O){var k,x=this;C=Number(C);var F=E.p(O),$=function(B){var V=P(x);return E.w(V.date(V.date()+Math.round(B*C)),x)};if(F===d)return this.set(d,this.$M+C);if(F===m)return this.set(m,this.$y+C);if(F===u)return $(1);if(F===c)return $(7);var _=(k={},k[s]=r,k[l]=n,k[o]=i,k)[F]||1,L=this.$d.getTime()+C*_;return E.w(L,this)},M.subtract=function(C,O){return this.add(-1*C,O)},M.format=function(C){var O=this,k=this.$locale();if(!this.isValid())return k.invalidDate||f;var x=C||"YYYY-MM-DDTHH:mm:ssZ",F=E.z(this),$=this.$H,_=this.$m,L=this.$M,B=k.weekdays,V=k.months,G=k.meridiem,j=function(q,Y,re,K){return q&&(q[Y]||q(O,x))||re[Y].slice(0,K)},z=function(q){return E.s($%12||12,q,"0")},W=G||function(q,Y,re){var K=q<12?"AM":"PM";return re?K.toLowerCase():K};return x.replace(v,function(q,Y){return Y||function(re){switch(re){case"YY":return String(O.$y).slice(-2);case"YYYY":return E.s(O.$y,4,"0");case"M":return L+1;case"MM":return E.s(L+1,2,"0");case"MMM":return j(k.monthsShort,L,V,3);case"MMMM":return j(V,L);case"D":return O.$D;case"DD":return E.s(O.$D,2,"0");case"d":return String(O.$W);case"dd":return j(k.weekdaysMin,O.$W,B,2);case"ddd":return j(k.weekdaysShort,O.$W,B,3);case"dddd":return B[O.$W];case"H":return String($);case"HH":return E.s($,2,"0");case"h":return z(1);case"hh":return z(2);case"a":return W($,_,!0);case"A":return W($,_,!1);case"m":return String(_);case"mm":return E.s(_,2,"0");case"s":return String(O.$s);case"ss":return E.s(O.$s,2,"0");case"SSS":return E.s(O.$ms,3,"0");case"Z":return F}return null}(q)||F.replace(":","")})},M.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},M.diff=function(C,O,k){var x,F=this,$=E.p(O),_=P(C),L=(_.utcOffset()-this.utcOffset())*r,B=this-_,V=function(){return E.m(F,_)};switch($){case m:x=V()/12;break;case d:x=V();break;case p:x=V()/3;break;case c:x=(B-L)/6048e5;break;case u:x=(B-L)/864e5;break;case l:x=B/n;break;case s:x=B/r;break;case o:x=B/i;break;default:x=B}return k?x:E.a(x)},M.daysInMonth=function(){return this.endOf(d).$D},M.$locale=function(){return w[this.$L]},M.locale=function(C,O){if(!C)return this.$L;var k=this.clone(),x=D(C,O,!0);return x&&(k.$L=x),k},M.clone=function(){return E.w(this.$d,this)},M.toDate=function(){return new Date(this.valueOf())},M.toJSON=function(){return this.isValid()?this.toISOString():null},M.toISOString=function(){return this.$d.toISOString()},M.toString=function(){return this.$d.toUTCString()},A}(),N=R.prototype;return P.prototype=N,[["$ms",a],["$s",o],["$m",s],["$H",l],["$W",u],["$M",d],["$y",m],["$D",h]].forEach(function(A){N[A[1]]=function(M){return this.$g(M,A[0],A[1])}}),P.extend=function(A,M){return A.$i||(A(M,R,P),A.$i=!0),P},P.locale=D,P.isDayjs=T,P.unix=function(A){return P(1e3*A)},P.en=w[S],P.Ls=w,P.p={},P})})(xre);var uAe=xre.exports;const cAe=yK(uAe);function dAe({matchUp:t,eventHandlers:e}){const{scheduledTime:i,scheduledDate:r,venueAbbreviation:n,courtName:a}=(t==null?void 0:t.schedule)||{},{dateTime:{extractDate:o,extractTime:s}}=oB,l=s(i);let u=o(r),c="ddd D MMMM";l&&(c+=", hh:mm A",u+=`T${l}`);const d=r?cAe(u).format(c):"Not scheduled",p=n&&(a==null?void 0:a.toString().startsWith(n))&&a||n&&a&&`${n} ${a}`||a||n||"",m=document.createElement("div");m.className=lAe(),m.classList.add("tmx-sch"),Is(e==null?void 0:e.scheduleClick)&&(m.onclick=y=>e.scheduleClick({matchUp:t,pointerEvent:y}));const h=document.createElement("div");h.innerHTML=d,m.append(h);const f=y=>{Is(e==null?void 0:e.venueClick)&&(y.stopPropagation(),e.venueClick({pointerEvent:y,matchUp:t}))},g=document.createElement("div");g.style="display: flex; flex-direction: row";const v=document.createElement("div");if(v.style.paddingRight=".2rem",v.onclick=f,v.innerHTML=p,g.append(v),m.append(g),m.onclick){const y=document.createElement("div");y.innerHTML="",g.append(y)}return m}function Pj({initialRoundNumber:t=1,eventHandlers:e,composition:i,sideNumber:r,className:n,matchUp:a}){var o,s;const l=(i==null?void 0:i.configuration)||{},u=l==null?void 0:l.scheduleInfo,c=(o=a==null?void 0:a.score)==null?void 0:o.scoreStringSide1,d=((s=i==null?void 0:i.configuration)==null?void 0:s.scoreBox)&&c,p=(a==null?void 0:a.readyToScore)&&(e==null?void 0:e.scoreClick)&&!Cre.checkScoreHasValue({matchUp:a}),m=document.createElement("div");if(m.className=Up($Ne(),n),m.classList.add("tmx-sd"),m.setAttribute("sideNumber",r),u&&r===1){const g=dAe({matchUp:a,eventHandlers:e});m.appendChild(g)}const h=document.createElement("div");h.className=BNe();const f=Mre({sideContainer:!0,initialRoundNumber:t,eventHandlers:e,composition:i,sideNumber:r,matchUp:a});if(h.appendChild(f),d){const g=document.createElement("div");g.style.border="1px solid lightgray",h.appendChild(g)}if(c){const g=sAe({eventHandlers:e,composition:i,sideNumber:r,matchUp:a});h.appendChild(g)}if(p){const g=Ore(),v=I=>{Is(e==null?void 0:e.scoreClick)&&(event.stopPropagation(),e.scoreClick({pointerEvent:I,matchUp:a}))},y=document.createElement("div");y.className=g({sideNumber:!d&&r,fontSize:"small"}),y.onclick=v,y.innerHTML="[Score]",h.appendChild(y)}return m.appendChild(h),m}function pAe(t){const{composition:e,initialRoundNumber:i=1,matchUp:r,moiety:n,selectedMatchUpId:a,searchActive:o}=t,{roundFactor:s,roundNumber:l,finishingRound:u,matchUpType:c,preFeedRound:d,stage:p}=r,m=t.isFinalRound||parseInt(u)===1,h=p==="QUALIFYING"&&m,f=m,g=parseInt(l)===i,v=c==="DOUBLES",y=(o||r.isRoundRobin||r.collectionId||t.isLucky||t.isAdHoc)&&"mr"||f&&"noProgression"||(h||d)&&"m0"||n&&"m1"||"m2",I=iAe({composition:e,isDoubles:v,roundFactor:s})({isFirstRound:g,link:y}),b=(e==null?void 0:e.configuration)||{},{resultsInfo:S,centerInfo:w}=b||{},U=t.eventHandlers||{},T=A=>{Is(U==null?void 0:U.matchUpClick)&&U.matchUpClick({pointerEvent:A,matchUp:r})},D=document.createElement("div");D.className=Up(e.theme,t==null?void 0:t.className,"matchup",XNe()),D.classList.add("tmx-m"),D.setAttribute("id",r==null?void 0:r.matchUpId),D.onclick=T;const P=document.createElement("div");P.className=JNe({configuration:b});const E=({sideNumber:A})=>{var M,C,O;const k=(O=(C=(M=r==null?void 0:r.sides.find(x=>x.sideNumber===A))==null?void 0:M.participant)==null?void 0:C.entryStatus)==null?void 0:O.replace("_"," ");return tAe({eventHandlers:U,entryStatus:k,sideNumber:A,className:A===2&&I,matchUp:r})},R=Pj({initialRoundNumber:i,eventHandlers:U,sideNumber:1,composition:e,matchUp:r}),N=Pj({className:!w&&I,initialRoundNumber:i,eventHandlers:U,sideNumber:2,composition:e,matchUp:r});if(P.appendChild(R),w){const A=E({sideNumber:1}),M=E({sideNumber:2});P.appendChild(A.element),P.appendChild(M.element)}if(P.appendChild(N),S){const A=mAe({score:r.score});P.appendChild(A)}if(D.appendChild(P),a===r.matchUpId){const A=document.createElement("div");A.className=KNe(),D.appendChild(A)}return D}function mAe({score:t}){var e;const i=(e=t==null?void 0:t.sets)==null?void 0:e.filter(Boolean).sort((o,s)=>(o.setNumber||0)-(s.setNumber||0)),r=i==null?void 0:i[i.length-1],n=(r==null?void 0:r.side1PointsScore)||(r==null?void 0:r.side2PointsScore),a=document.createElement("div");if(a.className=YNe(),n){const o=document.createElement("div");o.className=Tj({variant:"points"}),o.innerHTML="PTS",a.appendChild(o)}for(const o of i||[]){const s=document.createElement("div");s.setAttribute("key",o.setNumber),s.className=Tj({variant:"set"}),s.innerHTML=o.setNumber,a.appendChild(s)}return a}function hAe({initialRoundNumber:t=1,selectedMatchUpId:e,eventHandlers:i,isFinalRound:r,isRoundRobin:n,searchActive:a,composition:o,roundFactor:s,roundNumber:l,roundProfile:u,minWidth:c,matchUps:d,context:p,isLucky:m}){const h=d.filter(P=>P.roundNumber===l).sort((P,E)=>(P.roundPosition||0)-(E.roundPosition||0)),f=h.every(({roundPosition:P,drawPositions:E})=>!P&&!E),g=(o==null?void 0:o.configuration)||{},v=document.createElement("div");if(v.className=Nre(),v.classList.add("tmx-rd"),v.setAttribute("roundNumber",l),g.roundHeader){const P=HNe({roundProfile:u,roundMatchUps:h,roundNumber:l,eventHandlers:i,context:p});v.appendChild(P)}const y=document.createElement("div");y.className=Are({variant:f?"adHoc":void 0}),c&&(y.style.minWidth=c);let I,b,S;if(n){const P=R=>R.reduce((N,A)=>A+N,0);h.sort((R,N)=>{const A=P(R.drawPositions)-P(N.drawPositions),M=Math.min(...R.drawPositions??[])-Math.min(...N.drawPositions??[]);return A||M});const E=h.reduce((R,N)=>(R[N.structureId]=N.structureName,R),{});I=Object.values(E),b=Object.keys(E),S=Object.keys(oB.instanceCount(h.map(({structureId:R})=>R))).length}else f&&h.sort((P,E)=>(P.roundOrder??0)-(E.roundOrder??0));const w=S&&h.length/S,U=Object.keys(u).map(P=>parseInt(P)),T=U.indexOf(l),D=T===0&&"first"||T===U.length-1&&"last";return h.forEach((P,E)=>{const R=w&&!(E%w),N=w&&Math.floor(E/w),A=w&&I[N];if(R){const O=document.createElement("div");O.className=WNe({variant:N,roundOrder:D}),y.appendChild(O);const k=document.createElement("div");if(k.className=qNe(),Is(i==null?void 0:i.groupHeaderClick)){const{drawId:x,containerStructureId:F}=h[0];y.onclick=$=>i.groupHeaderClick({structureId:b[N],containerStructureId:F,pointerEvent:$,drawId:x})}l===t&&(k.innerHTML=A),y.appendChild(k)}const M=E%2===0;s?P.roundFactor=s:t>1&&(P.roundFactor=Math.pow(2,l-t));const C=pAe({initialRoundNumber:t,selectedMatchUpId:e,eventHandlers:i,isFinalRound:r,searchActive:a,composition:o,isAdHoc:f,isLucky:m,matchUp:P,moiety:M});y.appendChild(C)}),v.appendChild(y),v}function fAe({initialRoundNumber:t=1,selectedMatchUpId:e,eventHandlers:i,searchActive:r,composition:n,structureId:a,finalColumn:o,matchUps:s,minWidth:l,context:u}){var c;const{roundNumbers:d,roundProfile:p,hasOddMatchUpsCount:m,isNotEliminationStructure:h}=Cre.getRoundMatchUps({matchUps:s});a=a||(u==null?void 0:u.structureId)||((c=s==null?void 0:s[0])==null?void 0:c.structureId);const f=s.some(({isRoundRobin:I})=>I),g=m||h,v=document.createElement("div");v.className=zNe(),v.classList.add("tmx-str"),v.setAttribute("id",a);const y=Math.max(...d);for(const I of d){if(I<t)continue;const b=hAe({initialRoundNumber:t,selectedMatchUpId:e,eventHandlers:i,isFinalRound:I===y,isRoundRobin:f,searchActive:r,composition:n,roundNumber:I,roundProfile:p,matchUps:s,minWidth:l,context:u,isLucky:g});v.appendChild(b)}if(o){const I=document.createElement("div");I.className=Nre();const b=document.createElement("div");b.className=Are(),b.appendChild(o),I.appendChild(b),v.appendChild(I)}return v}const Rj=Yt({backgroundColor:"$colors$backgroundColor",color:"$colors$color",overflowX:"auto",height:1e3});function gAe({content:t,theme:e}){const i=document.createElement("div");return i.className=e?Up(Rj(),e):Rj(),e&&i.classList.add(e),typeof t=="string"?i.innerHTML=t:i.appendChild(t),i}const{createTheme:zh}=IK({theme:{lineHeights:{scheduleInfo:`${uI.scheduleInfo}rem`,centerInfo:`${uI.centerInfo}rem`,gameScore:`${uI.gameScore}rem`},borderWidths:{matchUpInline:"1px 1px",matchUp:"1px"},space:{1:"10px",2:"0.375rem",gameMarginInlineEnd:"0.25rem"},fontSizes:{1:"0.875rem"},colors:{internalDividers:"lightgray",backgroundColor:"white",connector:"lightgray",border:"darkgray",color:"black"},participant:{textTransform:"capitalize",minHeight:"2rem",seed:"gray"},score:{setWidth:"1.3rem"}}}),Ej=zh("australian-theme",{colors:{borderHover:"#0091d2",connector:"#999"}}),vAe=zh("wimbledon-theme",{borderWidths:{borderInlineStart:"10px"},colors:{connector:"transparent",borderHover:"darkgrey",border:"#00703c",matchUp:"#fff"},participant:{textTransform:"uppercase"}}),IAe=zh("french-theme",{colors:{winnerName:"#01503d!important",winner:"#01503d!important",borderHover:"#0091d2",border:"#F8F9F9"},matchUp:{boxShadow:"0 0 30px 0 hsla(0,0%,89%,9)"}}),yAe=zh("usopen-theme",{colors:{matchUpBackgroundColor:"#F8F9F9",internalDividers:"darkgray",borderHover:"#0091d2",connector:"#999"}}),Cj=zh("basic-theme",{colors:{internalDividers:"transparent",winner:"#50B649!important",loser:"#E61A1A!important",connector:"#999"},space:{gameMarginInlineEnd:"0.75rem"},participant:{seed:"transparent"},fontSizes:{1:"1.5rem"}}),bAe=zh("dark-theme",{colors:{backgroundColor:"#333333",borderHover:"#0091d2",color:"white"},participant:{seed:"cyan"}}),wAe=zh("itf-theme",{colors:{borderHover:"#0091d2",connector:"#999",matchUp:"#fff"},participant:{textTransform:"uppercase",seed:"gray"}}),UAe={Australian:{configuration:{flags:!0},theme:Ej},Basic:{configuration:{gameScoreOnly:!0,teamLogo:!1,roundHeader:!0,placeHolders:{tbd:"-",bye:"Bye"}},theme:Cj},DrawPositions:{configuration:{gameScoreOnly:!0,drawPositions:!0,teamLogo:!1},theme:Cj},French:{configuration:{bracketedSeeds:!0,flags:!0},theme:IAe},Wimbledon:{configuration:{resultsInfo:!0,flags:!0},theme:vAe},"US Open":{configuration:{scoreBox:!0,flags:!0},theme:yAe},ITF:{configuration:{winnerChevron:!0,centerInfo:!0,flags:!0,roundHeader:!0},theme:wAe},National:{configuration:{bracketedSeeds:"square",allDrawPositions:!0,drawPositions:!0,scheduleInfo:!0,roundHeader:!0,showAddress:!0,scaleAttributes:{scaleColor:"red",scaleType:"RATING",scaleName:"WTN",accessor:"wtnRating"}},theme:Ej},Night:{configuration:{flags:!0},theme:bAe}},{MALE:SAe,FEMALE:TAe}=nT,{PAIR:DAe}=wW,PAe="utr",RAe={utr:{accessor:"utrRating",scaleType:"RATING",scaleColor:"blue",scaleName:"UTR",fallback:!0},wtn:{accessor:"wtnRating",scaleType:"RATING",scaleColor:"red",scaleName:"WTN",fallback:!0}},Fre=t=>(e,i,r)=>{var d;const n=e.getColumn().getDefinition(),a=n.field==="side1"&&1||n.field==="side2"&&2,o=document.createElement("div"),s=e.getRow().getData(),l=s.winningSide,u=e.getValue(),c=s.participant||u.participant||s.person&&s;if(c){const p=RAe[PAe],m=f=>Mre({eventHandlers:{participantClick:g=>uu(t)&&t({...g,event:g.pointerEvent,cell:e})},composition:{configuration:{participantDetail:"TEAM",winnerColor:!0,genderColor:!0,scaleAttributes:p,flag:!1}},matchUp:s.matchUp,participant:f,placeholder:i,sideNumber:a}),h=f=>{const g=document.createElement("div");return g.className="flexrow flexjustifystart",f.individualParticipants.forEach((v,y)=>{if(g.appendChild(m(v)),!y){const I=document.createElement("span");I.style.width="1em",I.innerHTML="&nbsp;",g.appendChild(I)}}),g};return r==="sideBySide"&&c.participantType===DAe?h(c):m(c)}if(l){const p=n.field===s.winningSide;o.style.color=p?"green":"red"}else{const p=(u==null?void 0:u.sex)||((d=s==null?void 0:s.person)==null?void 0:d.sex),m=p===SAe&&"#2E86C1"||p===TAe&&"#AA336A"||"";o.style.color=m}return o.innerHTML=(h1(u)?u.participantName:u)||"",o};function EAe(t){var o;const e=t.getRow().getData();if(!((o=e.competitiveProfile)!=null&&o.competitiveness))return"";const{competitiveProfile:i,score:r}=e,n=document.createElement("span"),a={COMPETITIVE:"green",DECISIVE:"magenta",ROUTINE:"blue"};if(r){const{competitiveness:s}=i;n.style.fontSize="smaller",n.style.color=a[s],n.innerHTML=s}return n}function CAe(t){const e=t.getRow().getData();if(!e.readyToScore)return"";const i=e.matchUp.matchUpStatus==="WALKOVER",r=document.createElement("span");return r.classList.add("scoreCell"),e.score?(r.style.fontSize="smaller",r.innerHTML=e.score):i?r.innerHTML="WO":(r.style.fontSize="smaller",r.style.color="blue",r.innerHTML="--- --- ---"),r}function eN(t,e){var n,a,o,s;const i=(t==null?void 0:t.person)||((n=t==null?void 0:t.participant)==null?void 0:n.person),r=(e==null?void 0:e.person)||((a=e==null?void 0:e.participant)==null?void 0:a.person);return i||r?i!=null&&i.standardFamilyName&&!(r!=null&&r.standardFamilyName)||r!=null&&r.standardFamilyName&&!(i!=null&&i.standardFamilyName)||!(i!=null&&i.standardFamilyName)&&!(r!=null&&r.standardFamilyName)?1:(o=i.standardFamilyName)==null?void 0:o.localeCompare(r==null?void 0:r.standardFamilyName):t.participantName&&!e.participantName||e.participantName&&!t.participantName||!(t!=null&&t.participantName)&&!(e!=null&&e.participantName)?1:(s=t==null?void 0:t.participantName)==null?void 0:s.localeCompare(e==null?void 0:e.participantName)}function MAe(t,e){if(!t.score&&!e.score){if(t.readyToScore&&!e.readyToScore)return-1;if(e.readyToScore&&!t.readyToScore)return 1}return t.score&&!e.score?-1:e.score&&!t.score?1:0}function NAe({data:t}){const e=t.some(r=>r.courtName),i=r=>{const n=document.createElement("div");n.className="has-text-warning-dark",n.innerHTML="Select participant";const a=()=>console.log("boo");return r.getValue().participantName&&Fre(a)(r,n)};return[{formatter:"responsiveCollapse",headerSort:!1,resizable:!1,hozAlign:Zi,minWidth:50,width:50},{formatter:"rownum",headerSort:!1,hozAlign:zd,width:55},{title:"Flight",visible:!1,minWidth:150,field:"flight",widthGrow:1},{field:"scheduledDate",title:"Date",width:110},{visible:!!e,field:"courtName",title:"Court",width:100},{field:"scheduleTime",headerSort:!1,visible:!1,title:"Time",width:70},{formatter:i,sorter:eN,responsive:!1,title:"Side 1",minWidth:180,field:"side1",widthGrow:1},{formatter:i,sorter:eN,responsive:!1,title:"Side 2",minWidth:180,field:"side2",widthGrow:1},{formatter:CAe,sorter:MAe,field:"scoreDetail",responsive:!1,title:"Score",width:140},{sorter:Mbe,formatter:EAe,field:"competitiveProfile",responsive:!1,title:"Profile",visible:!1,width:140},{title:"<div class='fa-solid fa-check' style='color: green' />",formatter:"tickCross",field:"complete",hozAlign:zd,tooltip:!1,width:40},{field:"matchUp.matchUpStatus",title:"Status",width:150},{title:"<div class='fa-solid fa-clock' style='color: blue' />",headerSort:!1,field:"duration",visible:!1,width:70}]}var AAe=function(t){return String.prototype.normalize?t.normalize("NFKD").replace(/[\u0300-\u036F]/g,""):t};const{TEAM:OAe}=Nz,Mj=t=>{var M,C,O,k,x;const{potentialParticipants:e,structureName:i,matchUpType:r,roundNumber:n,matchUpId:a,roundName:o,schedule:s,eventId:l,drawId:u,sides:c,...d}=t,{scheduledDate:p,scheduleTime:m,courtName:h}=s||{},f=F=>{var $;return(($=F.person)==null?void 0:$.standardFamilyName)||F.participantName},g=(e==null?void 0:e.map(F=>({participantName:F.map(f).filter(Boolean).join(" or ")})))||[],v=((M=c==null?void 0:c[0])==null?void 0:M.participant)||g.shift(),y=((C=c==null?void 0:c[1])==null?void 0:C.participant)||g.shift(),I={participantName:v==null?void 0:v.participantName,sex:(O=v==null?void 0:v.person)==null?void 0:O.sex,participant:v},b={participantName:y==null?void 0:y.participantName,sex:(k=y==null?void 0:y.person)==null?void 0:k.sex,participant:y},S=c.flatMap(({participant:F})=>{var $;return($=F==null?void 0:F.individualParticipantIds)!=null&&$.length?F.individualParticipantIds:F==null?void 0:F.participantId}).filter(Boolean),w=d.winningSide===1&&"side1"||d.winningSide===2&&"side2"||void 0,U=!!d.winningSide,T=!!(d.winningSide||d.readyToScore),D=(x=d.score)==null?void 0:x.scoreStringSide1,P=c.flatMap(F=>{var _,L,B;const $=(_=F.participant)==null?void 0:_.person;return $?[$.standardGivenName,$.standardFamilyName]:(B=(L=F.participant)==null?void 0:L.individualParticipants)==null?void 0:B.map(({person:V})=>[V.standardGivenName,V.standardFamilyName])}).filter(Boolean).join(" ").toLowerCase(),E=AAe([P,v==null?void 0:v.participantName,y==null?void 0:y.participantName].filter(Boolean).join(" ")).toLowerCase(),R=t.collectionId?OAe:r,N=t.competitiveness?{competitiveness:t.competitiveness}:t.competitiveProfile,A={score:D,matchUpStatus:t.matchUpStatus,readyToScore:T,complete:U,winningSide:w};return{matchUpStatus:t.matchUpStatus,individualParticipantIds:S,flight:t.drawName,competitiveProfile:N,structureName:i,scheduledDate:p,readyToScore:T,scheduleTime:m,matchUpType:r,scoreDetail:A,winningSide:w,roundNumber:n,searchText:E,courtName:h,eventType:R,matchUpId:a,roundName:o,complete:U,eventId:l,matchUp:t,drawId:u,side1:I,side2:b,score:D}},{CONTAINER:kAe}=dT;async function xAe(t){const{drawId:e,structureId:i,eventData:r}=t;let n,a,o,s,l=t.matchUps;const u=()=>{var b,S;const v=(b=r==null?void 0:r.drawsData)==null?void 0:b.find(w=>w.drawId===e);a=(S=v==null?void 0:v.structures)==null?void 0:S.find(w=>w.structureId===i),s=(a==null?void 0:a.structureType)===kAe;const y=a!=null&&a.roundMatchUps?Object.values((a==null?void 0:a.roundMatchUps)||{}).flat():[],I=y.flatMap(w=>w.tieMatchUps||[]);return I.length&&y.push(...I),y.filter(({matchUpStatus:w})=>w!=="BYE").filter(({sides:w})=>!o||w.find(U=>{var T,D;return(D=(T=U.participant)==null?void 0:T.participantName)==null?void 0:D.toLowerCase().includes(o==null?void 0:o.toLowerCase())}))};l||(l=await u()),r&&l.forEach(v=>v.eventName=r.eventInfo.eventName);const c=()=>l.map(Mj),d=()=>u().map(Mj),p=v=>{v.participantFilter&&(o=v.participantFilter),n.replaceData(d())},m=c(),h=NAe({data:m}),f=s?["roundName","structureName"]:["roundName"];return(v=>{XD({anchorId:"flightDisplay"});const y=document.getElementById("flightDisplay");n=new Vb(y,{groupHeader:[Cbe,I=>I],headerSortElement:gK(["complete","duration","score"]),responsiveLayoutCollapseStartOpen:!1,height:window.innerHeight*.85,responsiveLayout:"collapse",placeholder:"No matches",layout:"fitColumns",reactiveData:!0,index:"matchUpId",groupBy:f,columns:h,data:v})})(m),{table:n,replaceTableData:p}}const FAe=t=>t.reduce((e,i)=>e+parseFloat(i),0),Nj=t=>parseFloat((FAe(t)/t.length).toFixed(2));function Aj(t){var p,m;const{participantResult:e,drawPosition:i,participantId:r,participantMap:n}=t,a=(p=e==null?void 0:e.ratingVariation)!=null&&p.length?Nj(e.ratingVariation):0,o=(m=e==null?void 0:e.pressureScores)!=null&&m.length?Nj(e.pressureScores):0,s=`${(e==null?void 0:e.pointsWon)||0}/${(e==null?void 0:e.pointsLost)||0}`,l=`${(e==null?void 0:e.gamesWon)||0}/${(e==null?void 0:e.gamesLost)||0}`,u=`${(e==null?void 0:e.setsWon)||0}/${(e==null?void 0:e.setsLost)||0}`,c=(e==null?void 0:e.groupOrder)||(e==null?void 0:e.provisionalOrder),d=n[r];return{participantName:d.participantName,groupName:d.groupName,...e,averageVariation:a,averagePressure:o,participantId:r,pointsResult:s,drawPosition:i,participant:d,gamesResult:l,setsResult:u,order:c}}function A0(t,e){return!t&&!e||t&&!e?-1:e&&!t?1:t-e}function rf(t){const e=t.getValue();return e&&`${(parseFloat(e)*100).toFixed(0)}%`}function Oj(t,e){return!t&&!e||t&&!e?-1:e&&!t?1:e-t}function LAe({isAdHoc:t}){return[{formatter:Fre(({event:e,cell:i,...r})=>console.log("cell clicked",{event:e,cell:i,undefined:void 0,params:r})),sorter:eN,field:"participantName",responsive:!1,resizable:!1,maxWidth:400,minWidth:200,title:"Name",widthGrow:2,frozen:!0},{headerHozAlign:Zi,headerWordWrap:!0,title:"Match W/L",hozAlign:Zi,maxWidth:80,field:"result"},{formatter:rf,headerHozAlign:Zi,headerWordWrap:!0,field:"matchUpsPct",title:"Match Win%",hozAlign:Zi,maxWidth:80},{headerHozAlign:Zi,headerWordWrap:!0,field:"setsResult",title:"Sets W/L",hozAlign:Zi,maxWidth:80},{formatter:rf,headerHozAlign:Zi,headerWordWrap:!0,title:"Set Win%",hozAlign:Zi,field:"setsPct",maxWidth:80},{headerHozAlign:Zi,headerWordWrap:!0,field:"gamesResult",title:"Games W/L",hozAlign:Zi,maxWidth:80},{formatter:rf,headerHozAlign:Zi,headerWordWrap:!0,title:"Game Win%",hozAlign:Zi,field:"gamesPct",maxWidth:80},{headerHozAlign:Zi,headerWordWrap:!0,field:"pointsResult",title:"Points W/L",hozAlign:Zi,maxWidth:80},{formatter:rf,headerHozAlign:Zi,headerWordWrap:!0,title:"Points Win%",field:"pointsPct",hozAlign:Zi,maxWidth:80},{formatter:rf,field:"averagePressure",headerHozAlign:Zi,sorter:Oj,hozAlign:Zi,maxWidth:70,title:"PS"},{formatter:rf,field:"averageVariation",headerHozAlign:Zi,sorter:Oj,hozAlign:Zi,maxWidth:70,title:"RV"},{headerHozAlign:Zi,field:"pressureOrder",sorter:A0,hozAlign:Zi,visible:t,title:"Order",maxWidth:80},{headerHozAlign:Zi,sorter:A0,visible:!t,hozAlign:Zi,title:"Order",field:"order",maxWidth:80},{field:"groupName",visible:!1,title:"Group"}]}async function _Ae({drawId:t,structureId:e,eventData:i,participants:r=[]}){var b,S;let n,a,o;const s=(b=i==null?void 0:i.drawsData)==null?void 0:b.find(w=>w.drawId===t);let l=(S=s==null?void 0:s.structures)==null?void 0:S.find(w=>w.structureId===e);const u=ST.isAdHoc({structure:l}),c=w=>(w??[]).reduce((U,T)=>(U[T.participantId]=T,U),{}),d={},p=()=>{var T,D;const w=(T=i==null?void 0:i.drawsData)==null?void 0:T.find(P=>P.drawId===t);return l=(D=w==null?void 0:w.structures)==null?void 0:D.find(P=>P.structureId===e),o||(o=c(r)),(l!=null&&l.roundMatchUps?Object.values(l.roundMatchUps).flat():[]).forEach(({sides:P,structureName:E,structureId:R})=>{d[R]=E,P.forEach(N=>{N.participantId&&(o[N.participantId].groupName=E)})}),((l==null?void 0:l.participantResults)??[]).filter(P=>{var R;const E=o[P.participantId];return!a||((R=E==null?void 0:E.participantName)==null?void 0:R.toLowerCase().includes(a==null?void 0:a.toLowerCase()))})},m=p(),h=()=>m==null?void 0:m.map(w=>Aj({...w,participantMap:o})).sort((w,U)=>u?A0(w.pressureOrder,U.pressureOrder):A0(w.order,U.order)),f=()=>{var w;return(w=p())==null?void 0:w.map(U=>Aj({...U,participantMap:o}))},g=w=>{(w==null?void 0:w.participantFilter)!==void 0&&(a=w.participantFilter),n.replaceData(f())},v=h(),y=LAe({isAdHoc:u});return(w=>{XD({anchorId:"flightDisplay"});const U=document.getElementById("flightDisplay"),T=Object.values(d).length>1?["groupName"]:void 0;n=new Vb(U,{headerSortElement:gK(["averageVariation","averagePressure","participantName","gamesResult","matchUpsPct","setsResult","gamesPct","setsPct","result","order"]),height:window.innerHeight*.85,groupHeader:[D=>D],placeholder:"No participants",renderHorizontal:"virtual",index:"matchUpId",groupBy:T,columns:y,data:w})})(v),{table:n,replaceTableData:g}}const{CONTAINER:$Ae}=dT;function BAe(t){const{callback:e,structure:i,existingView:r}=t,n=l=>r!==l&&uu(e)&&e({refresh:!0,view:l}),a=(i==null?void 0:i.structureType)===$Ae,o=vfe.isAdHoc({structure:i}),s=[];return r!==kV&&s.push({onClick:()=>n(kV),label:o?"Columns":"Draw",close:!0}),r!==FV&&s.push({onClick:()=>n(FV),label:"Table view",close:!0}),(o||a)&&r!==xV&&s.push({onClick:()=>n(xV),label:"Statistics",close:!0}),{label:"Display",id:"roundDisplayButton",options:s,selection:!1,location:Rm,align:Rm}}function kj({tournamentId:t,eventId:e,header:i,flightDisplay:r,displayFormat:n}){const a=()=>{var l;return(l=document.getElementById("structureButton"))==null?void 0:l.remove()},o=()=>{var l;return(l=document.getElementById("roundDisplayButton"))==null?void 0:l.remove()};cK({tournamentId:t,eventId:e,hydrateParticipants:!1}).then(l=>{var y,I,b;const u=((y=l==null?void 0:l.data)==null?void 0:y.eventData)||(l==null?void 0:l.data),c=((I=l==null?void 0:l.data)==null?void 0:I.participants)||[];window!=null&&window.dev&&(window.dev.eventData=u);const d=S=>Object.values(S.roundMatchUps||{}).flat(),p=S=>{var w;return(w=S.structures)==null?void 0:w.some(U=>d(U).length>0)},m=u==null?void 0:u.drawsData.filter(p);{const S=new Map(c.map(U=>[U.participantId,U])),w=U=>{var T;for(const D of U.sides||[])D.participantId&&(D.participant=S.get(D.participantId),(T=D.participant)!=null&&T.individualParticipantIds&&(D.participant.individualParticipants=D.participant.individualParticipantIds.map(P=>S.get(P))))};for(const U of m)for(const T of U.structures)Object.values(T.roundMatchUps||{}).flat().forEach(D=>{var P;w(D),(P=D.tieMatchUps)==null||P.forEach(w)})}const h=S=>{var E,R;const w=m[S];if(!w)return;const U=w.drawId,T=({view:N})=>{N&&(n=N),h(S)},D=N=>{var B,V;const A=(B=w.structures)==null?void 0:B[N];o();const M=BAe({callback:T,structure:A}),C=rm({button:M});i.appendChild(C);const O=A.structureId,k=Object.values(A.roundMatchUps||{}).flat();ST.isAdHoc({structure:A})&&k.sort(zD.matchUpScheduleSort),r.innerHTML=w.drawName,Wp(r);const F={...(V=u==null?void 0:u.eventInfo)==null?void 0:V.display,...w==null?void 0:w.display,...A==null?void 0:A.display},$=F==null?void 0:F.compositionName,_=F==null?void 0:F.configuration,L=UAe[$??"National"];if(Object.assign(L.configuration,_),L.configuration.genderColor=!0,n==="roundsColumns"){const G=gAe({content:fAe({context:{drawId:U,structureId:O},matchUps:k,composition:L,structure:A}),theme:L.theme});r.appendChild(G)}else n==="roundsStats"?_Ae({drawId:U,structureId:O,eventData:u,participants:c}):xAe({drawId:U,structureId:O,eventData:u})};if(((E=w.structures)==null?void 0:E.length)>1){const N=w.structures.map(({structureName:C},O)=>({onClick:()=>D(O),label:C,close:!0})),A={label:w.structures[0].structureName,options:N,id:"structureButton",modifyLabel:!0,selection:!0,location:zd},M=rm({button:A});i.appendChild(M)}(R=w.structures)!=null&&R[0]&&D(0)},f=m.map(({drawName:S},w)=>({onClick:()=>h(w),label:S,close:!0})),g={label:(b=m==null?void 0:m[0])==null?void 0:b.drawName,options:f,modifyLabel:!0,id:"flightButton",selection:!0,location:zd},v=rm({button:g,stateChange:a});i.appendChild(v),h(0)})}function Wp(t){if(t)for(;t.firstChild;)t.removeChild(t.firstChild)}function VAe(t,e,i,r,n){if(n){const a=e.target.value;n(a)?(r.innerHTML="",r.classList.remove("is-danger"),i.classList.remove("is-danger"),i.classList.add("is-success")):(r.innerHTML=t.error||"Invalid",i.classList.remove("is-success"),i.classList.add("is-danger"),r.classList.add("is-danger"))}}var Ko="top",ml="bottom",hl="right",Xo="left",dB="auto",aU=[Ko,ml,hl,Xo],yg="start",Sy="end",jAe="clippingParents",Lre="viewport",Vv="popper",GAe="reference",xj=aU.reduce(function(t,e){return t.concat([e+"-"+yg,e+"-"+Sy])},[]),_re=[].concat(aU,[dB]).reduce(function(t,e){return t.concat([e,e+"-"+yg,e+"-"+Sy])},[]),HAe="beforeRead",zAe="read",WAe="afterRead",qAe="beforeMain",YAe="main",KAe="afterMain",XAe="beforeWrite",JAe="write",QAe="afterWrite",ZAe=[HAe,zAe,WAe,qAe,YAe,KAe,XAe,JAe,QAe];function Vu(t){return t?(t.nodeName||"").toLowerCase():null}function ks(t){if(t==null)return window;if(t.toString()!=="[object Window]"){var e=t.ownerDocument;return e&&e.defaultView||window}return t}function Vm(t){var e=ks(t).Element;return t instanceof e||t instanceof Element}function Qs(t){var e=ks(t).HTMLElement;return t instanceof e||t instanceof HTMLElement}function pB(t){if(typeof ShadowRoot>"u")return!1;var e=ks(t).ShadowRoot;return t instanceof e||t instanceof ShadowRoot}function eOe(t){var e=t.state;Object.keys(e.elements).forEach(function(i){var r=e.styles[i]||{},n=e.attributes[i]||{},a=e.elements[i];!Qs(a)||!Vu(a)||(Object.assign(a.style,r),Object.keys(n).forEach(function(o){var s=n[o];s===!1?a.removeAttribute(o):a.setAttribute(o,s===!0?"":s)}))})}function tOe(t){var e=t.state,i={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(e.elements.popper.style,i.popper),e.styles=i,e.elements.arrow&&Object.assign(e.elements.arrow.style,i.arrow),function(){Object.keys(e.elements).forEach(function(r){var n=e.elements[r],a=e.attributes[r]||{},o=Object.keys(e.styles.hasOwnProperty(r)?e.styles[r]:i[r]),s=o.reduce(function(l,u){return l[u]="",l},{});!Qs(n)||!Vu(n)||(Object.assign(n.style,s),Object.keys(a).forEach(function(l){n.removeAttribute(l)}))})}}const $re={name:"applyStyles",enabled:!0,phase:"write",fn:eOe,effect:tOe,requires:["computeStyles"]};function yu(t){return t.split("-")[0]}var fm=Math.max,O0=Math.min,bg=Math.round;function tN(){var t=navigator.userAgentData;return t!=null&&t.brands&&Array.isArray(t.brands)?t.brands.map(function(e){return e.brand+"/"+e.version}).join(" "):navigator.userAgent}function Bre(){return!/^((?!chrome|android).)*safari/i.test(tN())}function wg(t,e,i){e===void 0&&(e=!1),i===void 0&&(i=!1);var r=t.getBoundingClientRect(),n=1,a=1;e&&Qs(t)&&(n=t.offsetWidth>0&&bg(r.width)/t.offsetWidth||1,a=t.offsetHeight>0&&bg(r.height)/t.offsetHeight||1);var o=Vm(t)?ks(t):window,s=o.visualViewport,l=!Bre()&&i,u=(r.left+(l&&s?s.offsetLeft:0))/n,c=(r.top+(l&&s?s.offsetTop:0))/a,d=r.width/n,p=r.height/a;return{width:d,height:p,top:c,right:u+d,bottom:c+p,left:u,x:u,y:c}}function mB(t){var e=wg(t),i=t.offsetWidth,r=t.offsetHeight;return Math.abs(e.width-i)<=1&&(i=e.width),Math.abs(e.height-r)<=1&&(r=e.height),{x:t.offsetLeft,y:t.offsetTop,width:i,height:r}}function Vre(t,e){var i=e.getRootNode&&e.getRootNode();if(t.contains(e))return!0;if(i&&pB(i)){var r=e;do{if(r&&t.isSameNode(r))return!0;r=r.parentNode||r.host}while(r)}return!1}function Bc(t){return ks(t).getComputedStyle(t)}function iOe(t){return["table","td","th"].indexOf(Vu(t))>=0}function Lp(t){return((Vm(t)?t.ownerDocument:t.document)||window.document).documentElement}function sE(t){return Vu(t)==="html"?t:t.assignedSlot||t.parentNode||(pB(t)?t.host:null)||Lp(t)}function Fj(t){return!Qs(t)||Bc(t).position==="fixed"?null:t.offsetParent}function rOe(t){var e=/firefox/i.test(tN()),i=/Trident/i.test(tN());if(i&&Qs(t)){var r=Bc(t);if(r.position==="fixed")return null}var n=sE(t);for(pB(n)&&(n=n.host);Qs(n)&&["html","body"].indexOf(Vu(n))<0;){var a=Bc(n);if(a.transform!=="none"||a.perspective!=="none"||a.contain==="paint"||["transform","perspective"].indexOf(a.willChange)!==-1||e&&a.willChange==="filter"||e&&a.filter&&a.filter!=="none")return n;n=n.parentNode}return null}function oU(t){for(var e=ks(t),i=Fj(t);i&&iOe(i)&&Bc(i).position==="static";)i=Fj(i);return i&&(Vu(i)==="html"||Vu(i)==="body"&&Bc(i).position==="static")?e:i||rOe(t)||e}function hB(t){return["top","bottom"].indexOf(t)>=0?"x":"y"}function cI(t,e,i){return fm(t,O0(e,i))}function nOe(t,e,i){var r=cI(t,e,i);return r>i?i:r}function jre(){return{top:0,right:0,bottom:0,left:0}}function Gre(t){return Object.assign({},jre(),t)}function Hre(t,e){return e.reduce(function(i,r){return i[r]=t,i},{})}var aOe=function(e,i){return e=typeof e=="function"?e(Object.assign({},i.rects,{placement:i.placement})):e,Gre(typeof e!="number"?e:Hre(e,aU))};function oOe(t){var e,i=t.state,r=t.name,n=t.options,a=i.elements.arrow,o=i.modifiersData.popperOffsets,s=yu(i.placement),l=hB(s),u=[Xo,hl].indexOf(s)>=0,c=u?"height":"width";if(!(!a||!o)){var d=aOe(n.padding,i),p=mB(a),m=l==="y"?Ko:Xo,h=l==="y"?ml:hl,f=i.rects.reference[c]+i.rects.reference[l]-o[l]-i.rects.popper[c],g=o[l]-i.rects.reference[l],v=oU(a),y=v?l==="y"?v.clientHeight||0:v.clientWidth||0:0,I=f/2-g/2,b=d[m],S=y-p[c]-d[h],w=y/2-p[c]/2+I,U=cI(b,w,S),T=l;i.modifiersData[r]=(e={},e[T]=U,e.centerOffset=U-w,e)}}function sOe(t){var e=t.state,i=t.options,r=i.element,n=r===void 0?"[data-popper-arrow]":r;n!=null&&(typeof n=="string"&&(n=e.elements.popper.querySelector(n),!n)||Vre(e.elements.popper,n)&&(e.elements.arrow=n))}const lOe={name:"arrow",enabled:!0,phase:"main",fn:oOe,effect:sOe,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function Ug(t){return t.split("-")[1]}var uOe={top:"auto",right:"auto",bottom:"auto",left:"auto"};function cOe(t,e){var i=t.x,r=t.y,n=e.devicePixelRatio||1;return{x:bg(i*n)/n||0,y:bg(r*n)/n||0}}function Lj(t){var e,i=t.popper,r=t.popperRect,n=t.placement,a=t.variation,o=t.offsets,s=t.position,l=t.gpuAcceleration,u=t.adaptive,c=t.roundOffsets,d=t.isFixed,p=o.x,m=p===void 0?0:p,h=o.y,f=h===void 0?0:h,g=typeof c=="function"?c({x:m,y:f}):{x:m,y:f};m=g.x,f=g.y;var v=o.hasOwnProperty("x"),y=o.hasOwnProperty("y"),I=Xo,b=Ko,S=window;if(u){var w=oU(i),U="clientHeight",T="clientWidth";if(w===ks(i)&&(w=Lp(i),Bc(w).position!=="static"&&s==="absolute"&&(U="scrollHeight",T="scrollWidth")),w=w,n===Ko||(n===Xo||n===hl)&&a===Sy){b=ml;var D=d&&w===S&&S.visualViewport?S.visualViewport.height:w[U];f-=D-r.height,f*=l?1:-1}if(n===Xo||(n===Ko||n===ml)&&a===Sy){I=hl;var P=d&&w===S&&S.visualViewport?S.visualViewport.width:w[T];m-=P-r.width,m*=l?1:-1}}var E=Object.assign({position:s},u&&uOe),R=c===!0?cOe({x:m,y:f},ks(i)):{x:m,y:f};if(m=R.x,f=R.y,l){var N;return Object.assign({},E,(N={},N[b]=y?"0":"",N[I]=v?"0":"",N.transform=(S.devicePixelRatio||1)<=1?"translate("+m+"px, "+f+"px)":"translate3d("+m+"px, "+f+"px, 0)",N))}return Object.assign({},E,(e={},e[b]=y?f+"px":"",e[I]=v?m+"px":"",e.transform="",e))}function dOe(t){var e=t.state,i=t.options,r=i.gpuAcceleration,n=r===void 0?!0:r,a=i.adaptive,o=a===void 0?!0:a,s=i.roundOffsets,l=s===void 0?!0:s,u={placement:yu(e.placement),variation:Ug(e.placement),popper:e.elements.popper,popperRect:e.rects.popper,gpuAcceleration:n,isFixed:e.options.strategy==="fixed"};e.modifiersData.popperOffsets!=null&&(e.styles.popper=Object.assign({},e.styles.popper,Lj(Object.assign({},u,{offsets:e.modifiersData.popperOffsets,position:e.options.strategy,adaptive:o,roundOffsets:l})))),e.modifiersData.arrow!=null&&(e.styles.arrow=Object.assign({},e.styles.arrow,Lj(Object.assign({},u,{offsets:e.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:l})))),e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-placement":e.placement})}const pOe={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:dOe,data:{}};var UU={passive:!0};function mOe(t){var e=t.state,i=t.instance,r=t.options,n=r.scroll,a=n===void 0?!0:n,o=r.resize,s=o===void 0?!0:o,l=ks(e.elements.popper),u=[].concat(e.scrollParents.reference,e.scrollParents.popper);return a&&u.forEach(function(c){c.addEventListener("scroll",i.update,UU)}),s&&l.addEventListener("resize",i.update,UU),function(){a&&u.forEach(function(c){c.removeEventListener("scroll",i.update,UU)}),s&&l.removeEventListener("resize",i.update,UU)}}const hOe={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:mOe,data:{}};var fOe={left:"right",right:"left",bottom:"top",top:"bottom"};function lS(t){return t.replace(/left|right|bottom|top/g,function(e){return fOe[e]})}var gOe={start:"end",end:"start"};function _j(t){return t.replace(/start|end/g,function(e){return gOe[e]})}function fB(t){var e=ks(t),i=e.pageXOffset,r=e.pageYOffset;return{scrollLeft:i,scrollTop:r}}function gB(t){return wg(Lp(t)).left+fB(t).scrollLeft}function vOe(t,e){var i=ks(t),r=Lp(t),n=i.visualViewport,a=r.clientWidth,o=r.clientHeight,s=0,l=0;if(n){a=n.width,o=n.height;var u=Bre();(u||!u&&e==="fixed")&&(s=n.offsetLeft,l=n.offsetTop)}return{width:a,height:o,x:s+gB(t),y:l}}function IOe(t){var e,i=Lp(t),r=fB(t),n=(e=t.ownerDocument)==null?void 0:e.body,a=fm(i.scrollWidth,i.clientWidth,n?n.scrollWidth:0,n?n.clientWidth:0),o=fm(i.scrollHeight,i.clientHeight,n?n.scrollHeight:0,n?n.clientHeight:0),s=-r.scrollLeft+gB(t),l=-r.scrollTop;return Bc(n||i).direction==="rtl"&&(s+=fm(i.clientWidth,n?n.clientWidth:0)-a),{width:a,height:o,x:s,y:l}}function vB(t){var e=Bc(t),i=e.overflow,r=e.overflowX,n=e.overflowY;return/auto|scroll|overlay|hidden/.test(i+n+r)}function zre(t){return["html","body","#document"].indexOf(Vu(t))>=0?t.ownerDocument.body:Qs(t)&&vB(t)?t:zre(sE(t))}function dI(t,e){var i;e===void 0&&(e=[]);var r=zre(t),n=r===((i=t.ownerDocument)==null?void 0:i.body),a=ks(r),o=n?[a].concat(a.visualViewport||[],vB(r)?r:[]):r,s=e.concat(o);return n?s:s.concat(dI(sE(o)))}function iN(t){return Object.assign({},t,{left:t.x,top:t.y,right:t.x+t.width,bottom:t.y+t.height})}function yOe(t,e){var i=wg(t,!1,e==="fixed");return i.top=i.top+t.clientTop,i.left=i.left+t.clientLeft,i.bottom=i.top+t.clientHeight,i.right=i.left+t.clientWidth,i.width=t.clientWidth,i.height=t.clientHeight,i.x=i.left,i.y=i.top,i}function $j(t,e,i){return e===Lre?iN(vOe(t,i)):Vm(e)?yOe(e,i):iN(IOe(Lp(t)))}function bOe(t){var e=dI(sE(t)),i=["absolute","fixed"].indexOf(Bc(t).position)>=0,r=i&&Qs(t)?oU(t):t;return Vm(r)?e.filter(function(n){return Vm(n)&&Vre(n,r)&&Vu(n)!=="body"}):[]}function wOe(t,e,i,r){var n=e==="clippingParents"?bOe(t):[].concat(e),a=[].concat(n,[i]),o=a[0],s=a.reduce(function(l,u){var c=$j(t,u,r);return l.top=fm(c.top,l.top),l.right=O0(c.right,l.right),l.bottom=O0(c.bottom,l.bottom),l.left=fm(c.left,l.left),l},$j(t,o,r));return s.width=s.right-s.left,s.height=s.bottom-s.top,s.x=s.left,s.y=s.top,s}function Wre(t){var e=t.reference,i=t.element,r=t.placement,n=r?yu(r):null,a=r?Ug(r):null,o=e.x+e.width/2-i.width/2,s=e.y+e.height/2-i.height/2,l;switch(n){case Ko:l={x:o,y:e.y-i.height};break;case ml:l={x:o,y:e.y+e.height};break;case hl:l={x:e.x+e.width,y:s};break;case Xo:l={x:e.x-i.width,y:s};break;default:l={x:e.x,y:e.y}}var u=n?hB(n):null;if(u!=null){var c=u==="y"?"height":"width";switch(a){case yg:l[u]=l[u]-(e[c]/2-i[c]/2);break;case Sy:l[u]=l[u]+(e[c]/2-i[c]/2);break}}return l}function Ty(t,e){e===void 0&&(e={});var i=e,r=i.placement,n=r===void 0?t.placement:r,a=i.strategy,o=a===void 0?t.strategy:a,s=i.boundary,l=s===void 0?jAe:s,u=i.rootBoundary,c=u===void 0?Lre:u,d=i.elementContext,p=d===void 0?Vv:d,m=i.altBoundary,h=m===void 0?!1:m,f=i.padding,g=f===void 0?0:f,v=Gre(typeof g!="number"?g:Hre(g,aU)),y=p===Vv?GAe:Vv,I=t.rects.popper,b=t.elements[h?y:p],S=wOe(Vm(b)?b:b.contextElement||Lp(t.elements.popper),l,c,o),w=wg(t.elements.reference),U=Wre({reference:w,element:I,strategy:"absolute",placement:n}),T=iN(Object.assign({},I,U)),D=p===Vv?T:w,P={top:S.top-D.top+v.top,bottom:D.bottom-S.bottom+v.bottom,left:S.left-D.left+v.left,right:D.right-S.right+v.right},E=t.modifiersData.offset;if(p===Vv&&E){var R=E[n];Object.keys(P).forEach(function(N){var A=[hl,ml].indexOf(N)>=0?1:-1,M=[Ko,ml].indexOf(N)>=0?"y":"x";P[N]+=R[M]*A})}return P}function UOe(t,e){e===void 0&&(e={});var i=e,r=i.placement,n=i.boundary,a=i.rootBoundary,o=i.padding,s=i.flipVariations,l=i.allowedAutoPlacements,u=l===void 0?_re:l,c=Ug(r),d=c?s?xj:xj.filter(function(h){return Ug(h)===c}):aU,p=d.filter(function(h){return u.indexOf(h)>=0});p.length===0&&(p=d);var m=p.reduce(function(h,f){return h[f]=Ty(t,{placement:f,boundary:n,rootBoundary:a,padding:o})[yu(f)],h},{});return Object.keys(m).sort(function(h,f){return m[h]-m[f]})}function SOe(t){if(yu(t)===dB)return[];var e=lS(t);return[_j(t),e,_j(e)]}function TOe(t){var e=t.state,i=t.options,r=t.name;if(!e.modifiersData[r]._skip){for(var n=i.mainAxis,a=n===void 0?!0:n,o=i.altAxis,s=o===void 0?!0:o,l=i.fallbackPlacements,u=i.padding,c=i.boundary,d=i.rootBoundary,p=i.altBoundary,m=i.flipVariations,h=m===void 0?!0:m,f=i.allowedAutoPlacements,g=e.options.placement,v=yu(g),y=v===g,I=l||(y||!h?[lS(g)]:SOe(g)),b=[g].concat(I).reduce(function(B,V){return B.concat(yu(V)===dB?UOe(e,{placement:V,boundary:c,rootBoundary:d,padding:u,flipVariations:h,allowedAutoPlacements:f}):V)},[]),S=e.rects.reference,w=e.rects.popper,U=new Map,T=!0,D=b[0],P=0;P<b.length;P++){var E=b[P],R=yu(E),N=Ug(E)===yg,A=[Ko,ml].indexOf(R)>=0,M=A?"width":"height",C=Ty(e,{placement:E,boundary:c,rootBoundary:d,altBoundary:p,padding:u}),O=A?N?hl:Xo:N?ml:Ko;S[M]>w[M]&&(O=lS(O));var k=lS(O),x=[];if(a&&x.push(C[R]<=0),s&&x.push(C[O]<=0,C[k]<=0),x.every(function(B){return B})){D=E,T=!1;break}U.set(E,x)}if(T)for(var F=h?3:1,$=function(V){var G=b.find(function(j){var z=U.get(j);if(z)return z.slice(0,V).every(function(W){return W})});if(G)return D=G,"break"},_=F;_>0;_--){var L=$(_);if(L==="break")break}e.placement!==D&&(e.modifiersData[r]._skip=!0,e.placement=D,e.reset=!0)}}const DOe={name:"flip",enabled:!0,phase:"main",fn:TOe,requiresIfExists:["offset"],data:{_skip:!1}};function Bj(t,e,i){return i===void 0&&(i={x:0,y:0}),{top:t.top-e.height-i.y,right:t.right-e.width+i.x,bottom:t.bottom-e.height+i.y,left:t.left-e.width-i.x}}function Vj(t){return[Ko,hl,ml,Xo].some(function(e){return t[e]>=0})}function POe(t){var e=t.state,i=t.name,r=e.rects.reference,n=e.rects.popper,a=e.modifiersData.preventOverflow,o=Ty(e,{elementContext:"reference"}),s=Ty(e,{altBoundary:!0}),l=Bj(o,r),u=Bj(s,n,a),c=Vj(l),d=Vj(u);e.modifiersData[i]={referenceClippingOffsets:l,popperEscapeOffsets:u,isReferenceHidden:c,hasPopperEscaped:d},e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-reference-hidden":c,"data-popper-escaped":d})}const ROe={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:POe};function EOe(t,e,i){var r=yu(t),n=[Xo,Ko].indexOf(r)>=0?-1:1,a=typeof i=="function"?i(Object.assign({},e,{placement:t})):i,o=a[0],s=a[1];return o=o||0,s=(s||0)*n,[Xo,hl].indexOf(r)>=0?{x:s,y:o}:{x:o,y:s}}function COe(t){var e=t.state,i=t.options,r=t.name,n=i.offset,a=n===void 0?[0,0]:n,o=_re.reduce(function(c,d){return c[d]=EOe(d,e.rects,a),c},{}),s=o[e.placement],l=s.x,u=s.y;e.modifiersData.popperOffsets!=null&&(e.modifiersData.popperOffsets.x+=l,e.modifiersData.popperOffsets.y+=u),e.modifiersData[r]=o}const MOe={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:COe};function NOe(t){var e=t.state,i=t.name;e.modifiersData[i]=Wre({reference:e.rects.reference,element:e.rects.popper,strategy:"absolute",placement:e.placement})}const AOe={name:"popperOffsets",enabled:!0,phase:"read",fn:NOe,data:{}};function OOe(t){return t==="x"?"y":"x"}function kOe(t){var e=t.state,i=t.options,r=t.name,n=i.mainAxis,a=n===void 0?!0:n,o=i.altAxis,s=o===void 0?!1:o,l=i.boundary,u=i.rootBoundary,c=i.altBoundary,d=i.padding,p=i.tether,m=p===void 0?!0:p,h=i.tetherOffset,f=h===void 0?0:h,g=Ty(e,{boundary:l,rootBoundary:u,padding:d,altBoundary:c}),v=yu(e.placement),y=Ug(e.placement),I=!y,b=hB(v),S=OOe(b),w=e.modifiersData.popperOffsets,U=e.rects.reference,T=e.rects.popper,D=typeof f=="function"?f(Object.assign({},e.rects,{placement:e.placement})):f,P=typeof D=="number"?{mainAxis:D,altAxis:D}:Object.assign({mainAxis:0,altAxis:0},D),E=e.modifiersData.offset?e.modifiersData.offset[e.placement]:null,R={x:0,y:0};if(w){if(a){var N,A=b==="y"?Ko:Xo,M=b==="y"?ml:hl,C=b==="y"?"height":"width",O=w[b],k=O+g[A],x=O-g[M],F=m?-T[C]/2:0,$=y===yg?U[C]:T[C],_=y===yg?-T[C]:-U[C],L=e.elements.arrow,B=m&&L?mB(L):{width:0,height:0},V=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:jre(),G=V[A],j=V[M],z=cI(0,U[C],B[C]),W=I?U[C]/2-F-z-G-P.mainAxis:$-z-G-P.mainAxis,q=I?-U[C]/2+F+z+j+P.mainAxis:_+z+j+P.mainAxis,Y=e.elements.arrow&&oU(e.elements.arrow),re=Y?b==="y"?Y.clientTop||0:Y.clientLeft||0:0,K=(N=E==null?void 0:E[b])!=null?N:0,H=O+W-K-re,Z=O+q-K,X=cI(m?O0(k,H):k,O,m?fm(x,Z):x);w[b]=X,R[b]=X-O}if(s){var ie,ae=b==="x"?Ko:Xo,le=b==="x"?ml:hl,ne=w[S],de=S==="y"?"height":"width",ye=ne+g[ae],ce=ne-g[le],ke=[Ko,Xo].indexOf(v)!==-1,Pe=(ie=E==null?void 0:E[S])!=null?ie:0,it=ke?ye:ne-U[de]-T[de]-Pe+P.altAxis,It=ke?ne+U[de]+T[de]-Pe-P.altAxis:ce,me=m&&ke?nOe(it,ne,It):cI(m?it:ye,ne,m?It:ce);w[S]=me,R[S]=me-ne}e.modifiersData[r]=R}}const xOe={name:"preventOverflow",enabled:!0,phase:"main",fn:kOe,requiresIfExists:["offset"]};function FOe(t){return{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}}function LOe(t){return t===ks(t)||!Qs(t)?fB(t):FOe(t)}function _Oe(t){var e=t.getBoundingClientRect(),i=bg(e.width)/t.offsetWidth||1,r=bg(e.height)/t.offsetHeight||1;return i!==1||r!==1}function $Oe(t,e,i){i===void 0&&(i=!1);var r=Qs(e),n=Qs(e)&&_Oe(e),a=Lp(e),o=wg(t,n,i),s={scrollLeft:0,scrollTop:0},l={x:0,y:0};return(r||!r&&!i)&&((Vu(e)!=="body"||vB(a))&&(s=LOe(e)),Qs(e)?(l=wg(e,!0),l.x+=e.clientLeft,l.y+=e.clientTop):a&&(l.x=gB(a))),{x:o.left+s.scrollLeft-l.x,y:o.top+s.scrollTop-l.y,width:o.width,height:o.height}}function BOe(t){var e=new Map,i=new Set,r=[];t.forEach(function(a){e.set(a.name,a)});function n(a){i.add(a.name);var o=[].concat(a.requires||[],a.requiresIfExists||[]);o.forEach(function(s){if(!i.has(s)){var l=e.get(s);l&&n(l)}}),r.push(a)}return t.forEach(function(a){i.has(a.name)||n(a)}),r}function VOe(t){var e=BOe(t);return ZAe.reduce(function(i,r){return i.concat(e.filter(function(n){return n.phase===r}))},[])}function jOe(t){var e;return function(){return e||(e=new Promise(function(i){Promise.resolve().then(function(){e=void 0,i(t())})})),e}}function GOe(t){var e=t.reduce(function(i,r){var n=i[r.name];return i[r.name]=n?Object.assign({},n,r,{options:Object.assign({},n.options,r.options),data:Object.assign({},n.data,r.data)}):r,i},{});return Object.keys(e).map(function(i){return e[i]})}var jj={placement:"bottom",modifiers:[],strategy:"absolute"};function Gj(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return!e.some(function(r){return!(r&&typeof r.getBoundingClientRect=="function")})}function HOe(t){t===void 0&&(t={});var e=t,i=e.defaultModifiers,r=i===void 0?[]:i,n=e.defaultOptions,a=n===void 0?jj:n;return function(s,l,u){u===void 0&&(u=a);var c={placement:"bottom",orderedModifiers:[],options:Object.assign({},jj,a),modifiersData:{},elements:{reference:s,popper:l},attributes:{},styles:{}},d=[],p=!1,m={state:c,setOptions:function(v){var y=typeof v=="function"?v(c.options):v;f(),c.options=Object.assign({},a,c.options,y),c.scrollParents={reference:Vm(s)?dI(s):s.contextElement?dI(s.contextElement):[],popper:dI(l)};var I=VOe(GOe([].concat(r,c.options.modifiers)));return c.orderedModifiers=I.filter(function(b){return b.enabled}),h(),m.update()},forceUpdate:function(){if(!p){var v=c.elements,y=v.reference,I=v.popper;if(Gj(y,I)){c.rects={reference:$Oe(y,oU(I),c.options.strategy==="fixed"),popper:mB(I)},c.reset=!1,c.placement=c.options.placement,c.orderedModifiers.forEach(function(P){return c.modifiersData[P.name]=Object.assign({},P.data)});for(var b=0;b<c.orderedModifiers.length;b++){if(c.reset===!0){c.reset=!1,b=-1;continue}var S=c.orderedModifiers[b],w=S.fn,U=S.options,T=U===void 0?{}:U,D=S.name;typeof w=="function"&&(c=w({state:c,options:T,name:D,instance:m})||c)}}}},update:jOe(function(){return new Promise(function(g){m.forceUpdate(),g(c)})}),destroy:function(){f(),p=!0}};if(!Gj(s,l))return m;m.setOptions(u).then(function(g){!p&&u.onFirstUpdate&&u.onFirstUpdate(g)});function h(){c.orderedModifiers.forEach(function(g){var v=g.name,y=g.options,I=y===void 0?{}:y,b=g.effect;if(typeof b=="function"){var S=b({state:c,name:v,instance:m,options:I}),w=function(){};d.push(S||w)}})}function f(){d.forEach(function(g){return g()}),d=[]}return m}}var zOe=[hOe,AOe,pOe,$re,MOe,DOe,xOe,lOe,ROe],WOe=HOe({defaultModifiers:zOe}),qOe="tippy-box",qre="tippy-content",YOe="tippy-backdrop",Yre="tippy-arrow",Kre="tippy-svg-arrow",jp={passive:!0,capture:!0},Xre=function(){return document.body};function oC(t,e,i){if(Array.isArray(t)){var r=t[e];return r??(Array.isArray(i)?i[e]:i)}return t}function IB(t,e){var i={}.toString.call(t);return i.indexOf("[object")===0&&i.indexOf(e+"]")>-1}function Jre(t,e){return typeof t=="function"?t.apply(void 0,e):t}function Hj(t,e){if(e===0)return t;var i;return function(r){clearTimeout(i),i=setTimeout(function(){t(r)},e)}}function KOe(t){return t.split(/\s+/).filter(Boolean)}function of(t){return[].concat(t)}function zj(t,e){t.indexOf(e)===-1&&t.push(e)}function XOe(t){return t.filter(function(e,i){return t.indexOf(e)===i})}function JOe(t){return t.split("-")[0]}function k0(t){return[].slice.call(t)}function Wj(t){return Object.keys(t).reduce(function(e,i){return t[i]!==void 0&&(e[i]=t[i]),e},{})}function pI(){return document.createElement("div")}function lE(t){return["Element","Fragment"].some(function(e){return IB(t,e)})}function QOe(t){return IB(t,"NodeList")}function ZOe(t){return IB(t,"MouseEvent")}function eke(t){return!!(t&&t._tippy&&t._tippy.reference===t)}function tke(t){return lE(t)?[t]:QOe(t)?k0(t):Array.isArray(t)?t:k0(document.querySelectorAll(t))}function sC(t,e){t.forEach(function(i){i&&(i.style.transitionDuration=e+"ms")})}function qj(t,e){t.forEach(function(i){i&&i.setAttribute("data-state",e)})}function ike(t){var e,i=of(t),r=i[0];return r!=null&&(e=r.ownerDocument)!=null&&e.body?r.ownerDocument:document}function rke(t,e){var i=e.clientX,r=e.clientY;return t.every(function(n){var a=n.popperRect,o=n.popperState,s=n.props,l=s.interactiveBorder,u=JOe(o.placement),c=o.modifiersData.offset;if(!c)return!0;var d=u==="bottom"?c.top.y:0,p=u==="top"?c.bottom.y:0,m=u==="right"?c.left.x:0,h=u==="left"?c.right.x:0,f=a.top-r+d>l,g=r-a.bottom-p>l,v=a.left-i+m>l,y=i-a.right-h>l;return f||g||v||y})}function lC(t,e,i){var r=e+"EventListener";["transitionend","webkitTransitionEnd"].forEach(function(n){t[r](n,i)})}function Yj(t,e){for(var i=e;i;){var r;if(t.contains(i))return!0;i=i.getRootNode==null||(r=i.getRootNode())==null?void 0:r.host}return!1}var ou={isTouch:!1},Kj=0;function nke(){ou.isTouch||(ou.isTouch=!0,window.performance&&document.addEventListener("mousemove",Qre))}function Qre(){var t=performance.now();t-Kj<20&&(ou.isTouch=!1,document.removeEventListener("mousemove",Qre)),Kj=t}function ake(){var t=document.activeElement;if(eke(t)){var e=t._tippy;t.blur&&!e.state.isVisible&&t.blur()}}function oke(){document.addEventListener("touchstart",nke,jp),window.addEventListener("blur",ake)}var ske=typeof window<"u"&&typeof document<"u",lke=ske?!!window.msCrypto:!1,uke={animateFill:!1,followCursor:!1,inlinePositioning:!1,sticky:!1},cke={allowHTML:!1,animation:"fade",arrow:!0,content:"",inertia:!1,maxWidth:350,role:"tooltip",theme:"",zIndex:9999},Dl=Object.assign({appendTo:Xre,aria:{content:"auto",expanded:"auto"},delay:0,duration:[300,250],getReferenceClientRect:null,hideOnClick:!0,ignoreAttributes:!1,interactive:!1,interactiveBorder:2,interactiveDebounce:0,moveTransition:"",offset:[0,10],onAfterUpdate:function(){},onBeforeUpdate:function(){},onCreate:function(){},onDestroy:function(){},onHidden:function(){},onHide:function(){},onMount:function(){},onShow:function(){},onShown:function(){},onTrigger:function(){},onUntrigger:function(){},onClickOutside:function(){},placement:"top",plugins:[],popperOptions:{},render:null,showOnCreate:!1,touch:!0,trigger:"mouseenter focus",triggerTarget:null},uke,cke),dke=Object.keys(Dl),pke=function(e){var i=Object.keys(e);i.forEach(function(r){Dl[r]=e[r]})};function Zre(t){var e=t.plugins||[],i=e.reduce(function(r,n){var a=n.name,o=n.defaultValue;if(a){var s;r[a]=t[a]!==void 0?t[a]:(s=Dl[a])!=null?s:o}return r},{});return Object.assign({},t,i)}function mke(t,e){var i=e?Object.keys(Zre(Object.assign({},Dl,{plugins:e}))):dke,r=i.reduce(function(n,a){var o=(t.getAttribute("data-tippy-"+a)||"").trim();if(!o)return n;if(a==="content")n[a]=o;else try{n[a]=JSON.parse(o)}catch{n[a]=o}return n},{});return r}function Xj(t,e){var i=Object.assign({},e,{content:Jre(e.content,[t])},e.ignoreAttributes?{}:mke(t,e.plugins));return i.aria=Object.assign({},Dl.aria,i.aria),i.aria={expanded:i.aria.expanded==="auto"?e.interactive:i.aria.expanded,content:i.aria.content==="auto"?e.interactive?null:"describedby":i.aria.content},i}var hke=function(){return"innerHTML"};function rN(t,e){t[hke()]=e}function Jj(t){var e=pI();return t===!0?e.className=Yre:(e.className=Kre,lE(t)?e.appendChild(t):rN(e,t)),e}function Qj(t,e){lE(e.content)?(rN(t,""),t.appendChild(e.content)):typeof e.content!="function"&&(e.allowHTML?rN(t,e.content):t.textContent=e.content)}function nN(t){var e=t.firstElementChild,i=k0(e.children);return{box:e,content:i.find(function(r){return r.classList.contains(qre)}),arrow:i.find(function(r){return r.classList.contains(Yre)||r.classList.contains(Kre)}),backdrop:i.find(function(r){return r.classList.contains(YOe)})}}function ene(t){var e=pI(),i=pI();i.className=qOe,i.setAttribute("data-state","hidden"),i.setAttribute("tabindex","-1");var r=pI();r.className=qre,r.setAttribute("data-state","hidden"),Qj(r,t.props),e.appendChild(i),i.appendChild(r),n(t.props,t.props);function n(a,o){var s=nN(e),l=s.box,u=s.content,c=s.arrow;o.theme?l.setAttribute("data-theme",o.theme):l.removeAttribute("data-theme"),typeof o.animation=="string"?l.setAttribute("data-animation",o.animation):l.removeAttribute("data-animation"),o.inertia?l.setAttribute("data-inertia",""):l.removeAttribute("data-inertia"),l.style.maxWidth=typeof o.maxWidth=="number"?o.maxWidth+"px":o.maxWidth,o.role?l.setAttribute("role",o.role):l.removeAttribute("role"),(a.content!==o.content||a.allowHTML!==o.allowHTML)&&Qj(u,t.props),o.arrow?c?a.arrow!==o.arrow&&(l.removeChild(c),l.appendChild(Jj(o.arrow))):l.appendChild(Jj(o.arrow)):c&&l.removeChild(c)}return{popper:e,onUpdate:n}}ene.$$tippy=!0;var fke=1,SU=[],uC=[];function gke(t,e){var i=Xj(t,Object.assign({},Dl,Zre(Wj(e)))),r,n,a,o=!1,s=!1,l=!1,u=!1,c,d,p,m=[],h=Hj(H,i.interactiveDebounce),f,g=fke++,v=null,y=XOe(i.plugins),I={isEnabled:!0,isVisible:!1,isDestroyed:!1,isMounted:!1,isShown:!1},b={id:g,reference:t,popper:pI(),popperInstance:v,props:i,state:I,plugins:y,clearDelayTimeouts:it,setProps:It,setContent:me,show:fe,hide:pe,hideWithInteractivity:Fe,enable:ke,disable:Pe,unmount:De,destroy:je};if(!i.render)return b;var S=i.render(b),w=S.popper,U=S.onUpdate;w.setAttribute("data-tippy-root",""),w.id="tippy-"+b.id,b.popper=w,t._tippy=b,w._tippy=b;var T=y.map(function(ue){return ue.fn(b)}),D=t.hasAttribute("aria-expanded");return Y(),F(),O(),k("onCreate",[b]),i.showOnCreate&&ye(),w.addEventListener("mouseenter",function(){b.props.interactive&&b.state.isVisible&&b.clearDelayTimeouts()}),w.addEventListener("mouseleave",function(){b.props.interactive&&b.props.trigger.indexOf("mouseenter")>=0&&A().addEventListener("mousemove",h)}),b;function P(){var ue=b.props.touch;return Array.isArray(ue)?ue:[ue,0]}function E(){return P()[0]==="hold"}function R(){var ue;return!!((ue=b.props.render)!=null&&ue.$$tippy)}function N(){return f||t}function A(){var ue=N().parentNode;return ue?ike(ue):document}function M(){return nN(w)}function C(ue){return b.state.isMounted&&!b.state.isVisible||ou.isTouch||c&&c.type==="focus"?0:oC(b.props.delay,ue?0:1,Dl.delay)}function O(ue){ue===void 0&&(ue=!1),w.style.pointerEvents=b.props.interactive&&!ue?"":"none",w.style.zIndex=""+b.props.zIndex}function k(ue,he,Re){if(Re===void 0&&(Re=!0),T.forEach(function(Ee){Ee[ue]&&Ee[ue].apply(Ee,he)}),Re){var xe;(xe=b.props)[ue].apply(xe,he)}}function x(){var ue=b.props.aria;if(ue.content){var he="aria-"+ue.content,Re=w.id,xe=of(b.props.triggerTarget||t);xe.forEach(function(Ee){var we=Ee.getAttribute(he);if(b.state.isVisible)Ee.setAttribute(he,we?we+" "+Re:Re);else{var Ue=we&&we.replace(Re,"").trim();Ue?Ee.setAttribute(he,Ue):Ee.removeAttribute(he)}})}}function F(){if(!(D||!b.props.aria.expanded)){var ue=of(b.props.triggerTarget||t);ue.forEach(function(he){b.props.interactive?he.setAttribute("aria-expanded",b.state.isVisible&&he===N()?"true":"false"):he.removeAttribute("aria-expanded")})}}function $(){A().removeEventListener("mousemove",h),SU=SU.filter(function(ue){return ue!==h})}function _(ue){if(!(ou.isTouch&&(l||ue.type==="mousedown"))){var he=ue.composedPath&&ue.composedPath()[0]||ue.target;if(!(b.props.interactive&&Yj(w,he))){if(of(b.props.triggerTarget||t).some(function(Re){return Yj(Re,he)})){if(ou.isTouch||b.state.isVisible&&b.props.trigger.indexOf("click")>=0)return}else k("onClickOutside",[b,ue]);b.props.hideOnClick===!0&&(b.clearDelayTimeouts(),b.hide(),s=!0,setTimeout(function(){s=!1}),b.state.isMounted||G())}}}function L(){l=!0}function B(){l=!1}function V(){var ue=A();ue.addEventListener("mousedown",_,!0),ue.addEventListener("touchend",_,jp),ue.addEventListener("touchstart",B,jp),ue.addEventListener("touchmove",L,jp)}function G(){var ue=A();ue.removeEventListener("mousedown",_,!0),ue.removeEventListener("touchend",_,jp),ue.removeEventListener("touchstart",B,jp),ue.removeEventListener("touchmove",L,jp)}function j(ue,he){W(ue,function(){!b.state.isVisible&&w.parentNode&&w.parentNode.contains(w)&&he()})}function z(ue,he){W(ue,he)}function W(ue,he){var Re=M().box;function xe(Ee){Ee.target===Re&&(lC(Re,"remove",xe),he())}if(ue===0)return he();lC(Re,"remove",d),lC(Re,"add",xe),d=xe}function q(ue,he,Re){Re===void 0&&(Re=!1);var xe=of(b.props.triggerTarget||t);xe.forEach(function(Ee){Ee.addEventListener(ue,he,Re),m.push({node:Ee,eventType:ue,handler:he,options:Re})})}function Y(){E()&&(q("touchstart",K,{passive:!0}),q("touchend",Z,{passive:!0})),KOe(b.props.trigger).forEach(function(ue){if(ue!=="manual")switch(q(ue,K),ue){case"mouseenter":q("mouseleave",Z);break;case"focus":q(lke?"focusout":"blur",X);break;case"focusin":q("focusout",X);break}})}function re(){m.forEach(function(ue){var he=ue.node,Re=ue.eventType,xe=ue.handler,Ee=ue.options;he.removeEventListener(Re,xe,Ee)}),m=[]}function K(ue){var he,Re=!1;if(!(!b.state.isEnabled||ie(ue)||s)){var xe=((he=c)==null?void 0:he.type)==="focus";c=ue,f=ue.currentTarget,F(),!b.state.isVisible&&ZOe(ue)&&SU.forEach(function(Ee){return Ee(ue)}),ue.type==="click"&&(b.props.trigger.indexOf("mouseenter")<0||o)&&b.props.hideOnClick!==!1&&b.state.isVisible?Re=!0:ye(ue),ue.type==="click"&&(o=!Re),Re&&!xe&&ce(ue)}}function H(ue){var he=ue.target,Re=N().contains(he)||w.contains(he);if(!(ue.type==="mousemove"&&Re)){var xe=de().concat(w).map(function(Ee){var we,Ue=Ee._tippy,wt=(we=Ue.popperInstance)==null?void 0:we.state;return wt?{popperRect:Ee.getBoundingClientRect(),popperState:wt,props:i}:null}).filter(Boolean);rke(xe,ue)&&($(),ce(ue))}}function Z(ue){var he=ie(ue)||b.props.trigger.indexOf("click")>=0&&o;if(!he){if(b.props.interactive){b.hideWithInteractivity(ue);return}ce(ue)}}function X(ue){b.props.trigger.indexOf("focusin")<0&&ue.target!==N()||b.props.interactive&&ue.relatedTarget&&w.contains(ue.relatedTarget)||ce(ue)}function ie(ue){return ou.isTouch?E()!==ue.type.indexOf("touch")>=0:!1}function ae(){le();var ue=b.props,he=ue.popperOptions,Re=ue.placement,xe=ue.offset,Ee=ue.getReferenceClientRect,we=ue.moveTransition,Ue=R()?nN(w).arrow:null,wt=Ee?{getBoundingClientRect:Ee,contextElement:Ee.contextElement||N()}:t,Le={name:"$$tippy",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:function(Be){var nt=Be.state;if(R()){var Ii=M(),be=Ii.box;["placement","reference-hidden","escaped"].forEach(function(Ct){Ct==="placement"?be.setAttribute("data-placement",nt.placement):nt.attributes.popper["data-popper-"+Ct]?be.setAttribute("data-"+Ct,""):be.removeAttribute("data-"+Ct)}),nt.attributes.popper={}}}},rt=[{name:"offset",options:{offset:xe}},{name:"preventOverflow",options:{padding:{top:2,bottom:2,left:5,right:5}}},{name:"flip",options:{padding:5}},{name:"computeStyles",options:{adaptive:!we}},Le];R()&&Ue&&rt.push({name:"arrow",options:{element:Ue,padding:3}}),rt.push.apply(rt,(he==null?void 0:he.modifiers)||[]),b.popperInstance=WOe(wt,w,Object.assign({},he,{placement:Re,onFirstUpdate:p,modifiers:rt}))}function le(){b.popperInstance&&(b.popperInstance.destroy(),b.popperInstance=null)}function ne(){var ue=b.props.appendTo,he,Re=N();b.props.interactive&&ue===Xre||ue==="parent"?he=Re.parentNode:he=Jre(ue,[Re]),he.contains(w)||he.appendChild(w),b.state.isMounted=!0,ae()}function de(){return k0(w.querySelectorAll("[data-tippy-root]"))}function ye(ue){b.clearDelayTimeouts(),ue&&k("onTrigger",[b,ue]),V();var he=C(!0),Re=P(),xe=Re[0],Ee=Re[1];ou.isTouch&&xe==="hold"&&Ee&&(he=Ee),he?r=setTimeout(function(){b.show()},he):b.show()}function ce(ue){if(b.clearDelayTimeouts(),k("onUntrigger",[b,ue]),!b.state.isVisible){G();return}if(!(b.props.trigger.indexOf("mouseenter")>=0&&b.props.trigger.indexOf("click")>=0&&["mouseleave","mousemove"].indexOf(ue.type)>=0&&o)){var he=C(!1);he?n=setTimeout(function(){b.state.isVisible&&b.hide()},he):a=requestAnimationFrame(function(){b.hide()})}}function ke(){b.state.isEnabled=!0}function Pe(){b.hide(),b.state.isEnabled=!1}function it(){clearTimeout(r),clearTimeout(n),cancelAnimationFrame(a)}function It(ue){if(!b.state.isDestroyed){k("onBeforeUpdate",[b,ue]),re();var he=b.props,Re=Xj(t,Object.assign({},he,Wj(ue),{ignoreAttributes:!0}));b.props=Re,Y(),he.interactiveDebounce!==Re.interactiveDebounce&&($(),h=Hj(H,Re.interactiveDebounce)),he.triggerTarget&&!Re.triggerTarget?of(he.triggerTarget).forEach(function(xe){xe.removeAttribute("aria-expanded")}):Re.triggerTarget&&t.removeAttribute("aria-expanded"),F(),O(),U&&U(he,Re),b.popperInstance&&(ae(),de().forEach(function(xe){requestAnimationFrame(xe._tippy.popperInstance.forceUpdate)})),k("onAfterUpdate",[b,ue])}}function me(ue){b.setProps({content:ue})}function fe(){var ue=b.state.isVisible,he=b.state.isDestroyed,Re=!b.state.isEnabled,xe=ou.isTouch&&!b.props.touch,Ee=oC(b.props.duration,0,Dl.duration);if(!(ue||he||Re||xe)&&!N().hasAttribute("disabled")&&(k("onShow",[b],!1),b.props.onShow(b)!==!1)){if(b.state.isVisible=!0,R()&&(w.style.visibility="visible"),O(),V(),b.state.isMounted||(w.style.transition="none"),R()){var we=M(),Ue=we.box,wt=we.content;sC([Ue,wt],0)}p=function(){var rt;if(!(!b.state.isVisible||u)){if(u=!0,w.offsetHeight,w.style.transition=b.props.moveTransition,R()&&b.props.animation){var Ei=M(),Be=Ei.box,nt=Ei.content;sC([Be,nt],Ee),qj([Be,nt],"visible")}x(),F(),zj(uC,b),(rt=b.popperInstance)==null||rt.forceUpdate(),k("onMount",[b]),b.props.animation&&R()&&z(Ee,function(){b.state.isShown=!0,k("onShown",[b])})}},ne()}}function pe(){var ue=!b.state.isVisible,he=b.state.isDestroyed,Re=!b.state.isEnabled,xe=oC(b.props.duration,1,Dl.duration);if(!(ue||he||Re)&&(k("onHide",[b],!1),b.props.onHide(b)!==!1)){if(b.state.isVisible=!1,b.state.isShown=!1,u=!1,o=!1,R()&&(w.style.visibility="hidden"),$(),G(),O(!0),R()){var Ee=M(),we=Ee.box,Ue=Ee.content;b.props.animation&&(sC([we,Ue],xe),qj([we,Ue],"hidden"))}x(),F(),b.props.animation?R()&&j(xe,b.unmount):b.unmount()}}function Fe(ue){A().addEventListener("mousemove",h),zj(SU,h),h(ue)}function De(){b.state.isVisible&&b.hide(),b.state.isMounted&&(le(),de().forEach(function(ue){ue._tippy.unmount()}),w.parentNode&&w.parentNode.removeChild(w),uC=uC.filter(function(ue){return ue!==b}),b.state.isMounted=!1,k("onHidden",[b]))}function je(){b.state.isDestroyed||(b.clearDelayTimeouts(),b.unmount(),re(),delete t._tippy,b.state.isDestroyed=!0,k("onDestroy",[b]))}}function sU(t,e){e===void 0&&(e={});var i=Dl.plugins.concat(e.plugins||[]);oke();var r=Object.assign({},e,{plugins:i}),n=tke(t),a=n.reduce(function(o,s){var l=s&&gke(s,r);return l&&o.push(l),o},[]);return lE(t)?a[0]:a}sU.defaultProps=Dl;sU.setDefaultProps=pke;sU.currentInput=ou;Object.assign({},$re,{effect:function(e){var i=e.state,r={popper:{position:i.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};Object.assign(i.elements.popper.style,r.popper),i.styles=r,i.elements.arrow&&Object.assign(i.elements.arrow.style,r.arrow)}});sU.setDefaultProps({render:ene});function Zj(t){var i;const e=document.createElement("button");return e.className="button font-medium",t.disabled&&(e.disabled=!0),t.class&&e.classList.add(t.class),t.id&&(e.id=t.id),t.location===Rm?e.style.marginLeft="1em":e.style.marginRight="1em",t.intent&&e.classList.add(t.intent),(i=t.toolTip)!=null&&i.content&&sU(e,t.toolTip),e.innerHTML=t.label,t.visible===!1&&(e.style.display=Bs),e}const vke=({target:t})=>(e=[])=>{t.style.backgroundColor=e!=null&&e.length?"lightgray":m1;const i=(r,n,a)=>{const o=t.getElementsByClassName(`options_${r}`)[0];o&&(o.style.display=e!=null&&e.length?n:a)};i(p1,hU,Bs),i(zd,Bs,hU),i(Zi,Bs,hU),i(Rm,Bs,hU)};function Ike(t){var v;const{table:e,targetClassName:i,items:r=[],onSelection:n}=t,a=!!t.target,o=t.target||i&&((v=document.getElementsByClassName(i))==null?void 0:v[0]);if(!o)return{};let s=0,l=0;const u={},c={};let d;if(a){Wp(o);const y=yke();Object.assign(u,y.elements),o.appendChild(y.anchor)}const p=Object.assign({},...[p1,zd,Zi,Rm,AV].map(y=>{var b;const I=(b=o.getElementsByClassName(`options_${y}`))==null?void 0:b[0];return Wp(I),{[y]:I}}).filter(Boolean)),m=vke({target:o}),h=(y,I)=>{uu(I.onClick)&&(y.stopPropagation(),!I.disabled&&I.onClick(y,e),I.stateChange&&m())},f={onClick:()=>{},location:Rm};for(const y of r){const I={...f};h1(y)&&Object.assign(I,y);const b=p[I.location];if(!b){console.log(I.location,p);continue}if(I.location===p1&&(s+=1),I.location===AV){if(uu(I.headerClick)){const S=o.getElementsByClassName("panelHeader")[0];S&&(S.onclick=I.headerClick)}l+=1}if(!I.hide&&(I.input||I.placeholder||I.search)){const S=document.createElement("p");S.style.marginRight="1em",S.className=`control ${I.search?"has-icons-left has-icons-right":""}`;const w=document.createElement("input");if(I.focus&&(d=w),w.className="input font-medium",w.setAttribute("type","text"),w.setAttribute("autocomplete","cc-number"),w.setAttribute("placeholder",y.placeholder||m1),I.id&&(c[I.id]=w),I.id&&w.setAttribute("id",I.id),I.onKeyDown&&w.addEventListener("keydown",U=>I.onKeyDown(U,I)),I.onChange&&w.addEventListener("change",U=>I.onChange(U,I)),I.onKeyUp&&w.addEventListener("keyup",U=>{I.clearSearch&&U.key==="Escape"&&(U.stopPropagation(),w.value="",I.clearSearch()),I.onKeyUp(U,I)}),I.class&&w.classList.add(I.class),I.visible===!1&&(S.style.display=Bs),I.value&&(w.value=I.value),S.appendChild(w),I.search){const U=document.createElement("span");if(U.className="icon is-small is-left font-medium",U.innerHTML='<i class="fa-solid fa-magnifying-glass"></i>',S.appendChild(U),uu(I.clearSearch)){const T=document.createElement("span");T.className="icon is-small is-right font-medium",T.innerHTML='<i class="fa-solid fa-circle-xmark" style="color: #dddada; pointer-events: all; cursor: pointer"></i>',T.onclick=D=>{D.stopPropagation(),w.value="",I.clearSearch()},S.appendChild(T)}}if(y.validator){const U=document.createElement("p");U.className="help font-medium",S.appendChild(U),w.addEventListener("input",T=>VAe(y,T,w,U,y.validator))}I.id&&(u[I.id]=S,S.id=I.id),b==null||b.appendChild(S);continue}if(!I.hide&&I.text){const S=document.createElement("div");S.className="font-medium",I.id&&(u[I.id]=S,S.id=I.id),S.innerHTML=I.text,S.onclick=w=>h(w,I),b==null||b.appendChild(S);continue}if(!(!I.id&&(!(I!=null&&I.label)||I.hide))){if(I.options){const S=rm({target:b,button:I,stateChange:m});I.visible===!1&&(S.style.display=Bs),I.id&&(u[I.id]=S)}else if(h1(I.selection)){const{selection:{options:S,actions:w},actionPlacement:U,threshold:T=8,...D}=I;if((S==null?void 0:S.length)<T){S.length&&(U===OV?S.unshift({divider:!0}):S.push({divider:!0})),w.forEach(R=>{const{label:N,...A}=R,M={...A,label:`<p style="font-weight: bold">${N}</p>`};U===OV?S.unshift(M):S.push(M)});const P={...D,options:S},E=rm({target:b,button:P,stateChange:m});P.visible===!1&&(E.style.display=Bs),P.id&&(u[I.id]=E)}else{const P=Zj(I);P.onclick=E=>{E.stopPropagation()},I.id&&(u[I.id]=P),b==null||b.appendChild(P)}}else{const S=Zj(I);S.onclick=w=>h(w,I),I.id&&(u[I.id]=S),b==null||b.appendChild(S)}(!(I!=null&&I.label)||I.hide)&&(u[I.id].style.display=Bs)}}const g=o.getElementsByClassName("panelHeader")[0];return g&&(g.style.display=l?m1:Bs),e==null||e.on("rowSelectionChanged",(y,I)=>{uu(n)&&n(I),s&&m(I)}),m(),d&&setTimeout(()=>d.focus(),200),{elements:u,inputs:c}}function yke(){const t=document.createElement("div");t.className="panel_container flexcol flexcenter";const e=document.createElement("div");e.className="panelHeader options_header",e.style.display=Bs,t.appendChild(e);const i=document.createElement("div");i.className=tge,i.style.flexWrap="wrap-reverse;";const r={optionsOverlay:document.createElement("div"),optionsLeft:document.createElement("div"),optionsCenter:document.createElement("div"),optionsRight:document.createElement("div")};r.optionsOverlay.className="options_overlay",r.optionsCenter.className="options_center",r.optionsRight.className="options_right",r.optionsLeft.className="options_left";for(const n of Object.values(r))i.appendChild(n);return t.appendChild(i),{elements:r,anchor:t,header:e}}function bke(t){const e=Ebe(t),i=[{onKeyDown:n=>n.keyCode===8&&n.target.value.length===1&&e(""),onChange:n=>e(n.target.value),onKeyUp:n=>e(n.target.value),clearSearch:()=>e(""),placeholder:"Search tournaments",location:zd,search:!0}],r=document.getElementById(sG);Ike({target:r,items:i})}function wke(t){var u,c;const e=document.createElement("span"),i=document.createElement("table"),r=t.getValue();i.style.width="400px";const n="4em",a=document.createElement("tr"),o=r.tournamentImageURL||((c=(u=r.onlineResources)==null?void 0:u.find(({name:d,resourceType:p})=>d==="tournamentImage"&&p==="URL"))==null?void 0:c.identifier),s=o?`<img src='${o}' style='width: ${n}' alt=''>`:"",l=`<td style='min-width: ${n}'>${s}</td><td><div style='margin-left: 1em'><strong style='font-size: 1.5em'>${r.tournamentName}</strong></div><div style='margin-left: 1em'>${r.startDate} / ${r.endDate}</div></td>`;return a.innerHTML=l,i.appendChild(a),e.appendChild(i),e}function Uke(){return[{formatter:wke,cellClick:(e,i)=>{const r=i.getRow().getData().tournamentId;if(r){const n=`/${_0}/${r}`;Cm.router.navigate(n)}},field:"tournament",headerSort:!1,resizable:!0,minWidth:250,widthGrow:3}]}function Ske({providerAbbr:t}){const e=s=>console.log("Network error",{error:s});let i;const r=({providerAbbr:s})=>{setTimeout(()=>{const u=c=>{var d;return((d=c==null?void 0:c.data)==null?void 0:d.calendar)&&i.replaceData(c.data.calendar)};K1({providerAbbr:s}).then(u,e)},1e3)},n=Uke(),a=s=>{XD({anchorId:pC});const l=document.getElementById(pC);i=new Vb(l,{height:window.innerHeight*.9,placeholder:"No tournaments",index:"tournament.tournamentId",headerVisible:!1,layout:"fitColumns",reactiveData:!0,data:s,columns:n}),i.on("tableBuilt",()=>{bke(i)})},o=s=>{s.tournaments.sort((l,u)=>new Date(u.tournament.startDate).getTime()-new Date(l.tournament.startDate).getTime()),a(s.tournaments)};if(t){const s=l=>{var u;(u=l==null?void 0:l.data)!=null&&u.calendar&&o(l.data.calendar)};K1({providerAbbr:t}).then(s,e)}return{table:i,replaceTableData:r}}function Tke({startDate:t,endDate:e}){const i=new Date(t),r=new Date(e),n=["January","February","March","April","May","June","July","August","September","October","November","December"],a=i.getDate()===r.getDate(),o=i.getFullYear()===r.getFullYear(),s=o&&i.getMonth()===r.getMonth(),l=u=>[u.getFullYear(),u.getMonth()+1,u.getDate()].join("/");return a&&o&&s?`${n[i.getMonth()]} ${i.getDate()}, ${i.getFullYear()}`:o&&s?`${n[i.getMonth()]} ${i.getDate()}-${r.getDate()}, ${i.getFullYear()}`:o?`${n[i.getMonth()]} ${i.getDate()} - ${n[r.getMonth()]} ${r.getDate()}, ${i.getFullYear()}`:`${l(i)} - ${l(r)}`}async function Dke(t){var o,s,l,u,c;const e=document.getElementById(une);Wp(e);const i=((o=t==null?void 0:t.data)==null?void 0:o.tournamentInfo)??{},r=(s=i.onlineResources)==null?void 0:s.find(d=>d.name==="tournamentImage"),n=document.getElementById(lG);if(r!=null&&r.identifier?n.innerHTML=`<img src="${r.identifier}" alt="${i.name}" style="max-height: 20em" />`:Wp(n),i.tournamentName){const d=document.getElementById(oG),p=`<h1>${i.tournamentName}</h1>`,m=`<h2>${Tke(i)}</h2>`;d.innerHTML=`${p}${m}`}const a=document.getElementById(Zv("Info"));if(i.notes?(a.innerHTML=i.notes,J1("Info"),kE("Info")):(Wp(a),xE("Info")),(l=i.eventInfo)!=null&&l.length){const d=i.tournamentId,p=document.getElementById(Zv("Events"));Wp(p);const m=document.createElement("div"),h=document.createElement("div");h.id="flightDisplay";const f=i.eventInfo.map(({eventId:b,eventName:S})=>({onClick:()=>kj({tournamentId:d,eventId:b,header:m,flightDisplay:h,displayFormat:"roundsColumns"}),label:S,close:!0})),g={label:i.eventInfo[0].eventName,options:f,id:"eventButton",modifyLabel:!0,selection:!0,location:zd},y=rm({button:g,stateChange:()=>{var b,S;(b=document.getElementById("structureButton"))==null||b.remove(),(S=document.getElementById("flightButton"))==null||S.remove()}}),I=i.eventInfo[0].eventId;m.className="block",m.appendChild(y),p.appendChild(m),p.appendChild(h),kj({tournamentId:d,eventId:I,header:m,flightDisplay:h,displayFormat:"roundsColumns"}),kE("Events"),Cm.tab||J1("Events")}else xE("Events");if((c=(u=i.publishState)==null?void 0:u.orderOfPlay)!=null&&c.published){const d=document.getElementById(Zv("Schedule")),p=document.createElement("div");p.style.width="100%",p.className="block",p.id="scheduleHeader",d.appendChild(p);const m=document.createElement("div");m.id="tournamentSchedule",d.appendChild(m),kE("Schedule")}else xE("Schedule")}const Pke=""+new URL("courthive-transparent-logo-ScJ-jfxv.png",import.meta.url).href;function Rke(){document.querySelector(`#${Dy}`).innerHTML=`
  <div>
    <a href="https://courthive.com" target="_blank">
      <img src="${Pke}" class="logo" alt="Vite logo" />
    </a>
    <h1 class="name">CourtHive</h1>
  </div>
`}var Eke=/([:*])(\w+)/g,Cke="([^/]+)",Mke=/\*/g,Nke="?(?:.*)",Ake=/\/\?/g,Oke="/?([^/]+|)",kke="(?:/^|^)",xke="";function tne(t){return t===void 0&&(t="/"),bB()?location.pathname+location.search+location.hash:t}function Wr(t){return t.replace(/\/+$/,"").replace(/^\/+/,"")}function x0(t){return typeof t=="string"}function Fke(t){return typeof t=="function"}function F0(t){return t&&t.indexOf("#")>=0&&t.split("#").pop()||""}function Lke(t,e){return e.length===0||!t?null:t.slice(1,t.length).reduce(function(i,r,n){return i===null&&(i={}),i[e[n]]=decodeURIComponent(r),i},null)}function L0(t){var e=Wr(t).split(/\?(.*)?$/);return[Wr(e[0]),e.slice(1).join("")]}function yB(t){for(var e={},i=t.split("&"),r=0;r<i.length;r++){var n=i[r].split("=");if(n[0]!==""){var a=decodeURIComponent(n[0]);e[a]?(Array.isArray(e[a])||(e[a]=[e[a]]),e[a].push(decodeURIComponent(n[1]||""))):e[a]=decodeURIComponent(n[1]||"")}}return e}function ine(t,e){var i=L0(Wr(t.currentLocationPath)),r=i[0],n=i[1],a=n===""?null:yB(n),o=[],s;if(x0(e.path)){if(s=kke+Wr(e.path).replace(Eke,function(d,p,m){return o.push(m),Cke}).replace(Mke,Nke).replace(Ake,Oke)+"$",Wr(e.path)===""&&Wr(r)==="")return{url:r,queryString:n,hashString:F0(t.to),route:e,data:null,params:a}}else s=e.path;var l=new RegExp(s,xke),u=r.match(l);if(u){var c=x0(e.path)?Lke(u,o):u.groups?u.groups:u.slice(1);return{url:Wr(r.replace(new RegExp("^"+t.instance.root),"")),queryString:n,hashString:F0(t.to),route:e,data:c,params:a}}return!1}function rne(){return!!(typeof window<"u"&&window.history&&window.history.pushState)}function Wh(t,e){return typeof t[e]>"u"||t[e]===!0}function _ke(t){if(!t)return{};var e=t.split(","),i={},r;return e.forEach(function(n){var a=n.split(":").map(function(o){return o.replace(/(^ +| +$)/g,"")});switch(a[0]){case"historyAPIMethod":i.historyAPIMethod=a[1];break;case"resolveOptionsStrategy":r||(r={}),r.strategy=a[1];break;case"resolveOptionsHash":r||(r={}),r.hash=a[1]==="true";break;case"updateBrowserURL":case"callHandler":case"updateState":case"force":i[a[0]]=a[1]==="true";break}}),r&&(i.resolveOptions=r),i}function bB(){return typeof window<"u"}function $ke(t,e){return t===void 0&&(t=[]),e===void 0&&(e={}),t.filter(function(i){return i}).forEach(function(i){["before","after","already","leave"].forEach(function(r){i[r]&&(e[r]||(e[r]=[]),e[r].push(i[r]))})}),e}function mu(t,e,i){var r=e||{},n=0;(function a(){if(!t[n]){i&&i(r);return}Array.isArray(t[n])?(t.splice.apply(t,[n,1].concat(t[n][0](r)?t[n][1]:t[n][2])),a()):t[n](r,function(o){typeof o>"u"||o===!0?(n+=1,a()):i&&i(r)})})()}mu.if=function(t,e,i){return Array.isArray(e)||(e=[e]),Array.isArray(i)||(i=[i]),[t,e,i]};function eG(t,e){typeof t.currentLocationPath>"u"&&(t.currentLocationPath=t.to=tne(t.instance.root)),t.currentLocationPath=t.instance._checkForAHash(t.currentLocationPath),e()}function cC(t,e){for(var i=0;i<t.instance.routes.length;i++){var r=t.instance.routes[i],n=ine(t,r);if(n&&(t.matches||(t.matches=[]),t.matches.push(n),t.resolveOptions.strategy==="ONE")){e();return}}e()}function Bke(t,e){t.navigateOptions&&(typeof t.navigateOptions.shouldResolve<"u"&&console.warn('"shouldResolve" is deprecated. Please check the documentation.'),typeof t.navigateOptions.silent<"u"&&console.warn('"silent" is deprecated. Please check the documentation.')),e()}function Vke(t,e){t.navigateOptions.force===!0?(t.instance._setCurrent([t.instance._pathToMatchObject(t.to)]),e(!1)):e()}var tG=bB(),jke=rne();function Gke(t,e){if(Wh(t.navigateOptions,"updateBrowserURL")){var i=("/"+t.to).replace(/\/\//g,"/"),r=tG&&t.resolveOptions&&t.resolveOptions.hash===!0;jke?(history[t.navigateOptions.historyAPIMethod||"pushState"](t.navigateOptions.stateObj||{},t.navigateOptions.title||"",r?"#"+i:i),location&&location.hash&&(t.instance.__freezeListening=!0,setTimeout(function(){if(!r){var n=location.hash;location.hash="",location.hash=n}t.instance.__freezeListening=!1},1))):tG&&(window.location.href=t.to)}e()}function nne(t,e){var i=t.instance;if(!i.lastResolved()){e();return}mu(i.lastResolved().map(function(r){return function(n,a){if(!r.route.hooks||!r.route.hooks.leave){a();return}var o=!1,s=t.instance.matchLocation(r.route.path,t.currentLocationPath,!1);if(r.route.path!=="*")o=!s;else{var l=t.matches?t.matches.find(function(u){return r.route.path===u.route.path}):!1;o=!l}if(Wh(t.navigateOptions,"callHooks")&&o){mu(r.route.hooks.leave.map(function(u){return function(c,d){return u(function(p){p===!1?t.instance.__markAsClean(t):d()},t.matches&&t.matches.length>0?t.matches.length===1?t.matches[0]:t.matches:void 0)}}).concat([function(){return a()}]));return}else a()}}),{},function(){return e()})}function Hke(t,e){t.match.route.hooks&&t.match.route.hooks.before&&Wh(t.navigateOptions,"callHooks")?mu(t.match.route.hooks.before.map(function(i){return function(n,a){return i(function(o){o===!1?t.instance.__markAsClean(t):a()},t.match)}}).concat([function(){return e()}])):e()}function zke(t,e){Wh(t.navigateOptions,"callHandler")&&t.match.route.handler(t.match),t.instance.updatePageLinks(),e()}function Wke(t,e){t.match.route.hooks&&t.match.route.hooks.after&&Wh(t.navigateOptions,"callHooks")&&t.match.route.hooks.after.forEach(function(i){return i(t.match)}),e()}function qke(t,e){var i=t.instance.lastResolved();if(i&&i[0]&&i[0].route===t.match.route&&i[0].url===t.match.url&&i[0].queryString===t.match.queryString){i.forEach(function(r){r.route.hooks&&r.route.hooks.already&&Wh(t.navigateOptions,"callHooks")&&r.route.hooks.already.forEach(function(n){return n(t.match)})}),e(!1);return}e()}function Yke(t,e){var i=t.instance._notFoundRoute;if(i){t.notFoundHandled=!0;var r=L0(t.currentLocationPath),n=r[0],a=r[1],o=F0(t.to);i.path=Wr(n);var s={url:i.path,queryString:a,hashString:o,data:null,route:i,params:a!==""?yB(a):null};t.matches=[s],t.match=s}e()}function Kke(t,e){(!t.resolveOptions||t.resolveOptions.noMatchWarning===!1||typeof t.resolveOptions.noMatchWarning>"u")&&console.warn('Navigo: "'+t.currentLocationPath+`" didn't match any of the registered routes.`),e()}function Xke(t,e){t.instance._setCurrent(null),e()}function ane(t,e){Wh(t.navigateOptions,"updateState")&&t.instance._setCurrent(t.matches),e()}var one=[qke,Hke,zke,Wke],iG=[nne,Yke,mu.if(function(t){var e=t.notFoundHandled;return e},one.concat([ane]),[Kke,Xke])];function aN(){return aN=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(t[r]=i[r])}return t},aN.apply(this,arguments)}function rG(t,e){var i=0;function r(){if(i===t.matches.length){ane(t,e);return}mu(one,aN({},t,{match:t.matches[i]}),function(){i+=1,r()})}nne(t,r)}function dC(t){t.instance.__markAsClean(t)}function oN(){return oN=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(t[r]=i[r])}return t},oN.apply(this,arguments)}var nG="[data-navigo]";function Jke(t,e){var i=e||{strategy:"ONE",hash:!1,noMatchWarning:!1,linksSelector:nG},r=this,n="/",a=null,o=[],s=!1,l,u=rne(),c=bB();t?n=Wr(t):console.warn('Navigo requires a root path in its constructor. If not provided will use "/" as default.');function d(F){return F.indexOf("#")>=0&&(i.hash===!0?F=F.split("#")[1]||"/":F=F.split("#")[0]),F}function p(F){return Wr(n+"/"+Wr(F))}function m(F,$,_,L){return F=x0(F)?p(F):F,{name:L||Wr(String(F)),path:F,handler:$,hooks:$ke(_)}}function h(F,$,_){var L=this;return typeof F=="object"&&!(F instanceof RegExp)?(Object.keys(F).forEach(function(B){if(typeof F[B]=="function")L.on(B,F[B]);else{var V=F[B],G=V.uses,j=V.as,z=V.hooks;o.push(m(B,G,[l,z],j))}}),this):(typeof F=="function"&&(_=$,$=F,F=n),o.push(m(F,$,[l,_])),this)}function f(F,$){if(r.__dirty){r.__waiting.push(function(){return r.resolve(F,$)});return}else r.__dirty=!0;F=F?Wr(n)+"/"+Wr(F):void 0;var _={instance:r,to:F,currentLocationPath:F,navigateOptions:{},resolveOptions:oN({},i,$)};return mu([eG,cC,mu.if(function(L){var B=L.matches;return B&&B.length>0},rG,iG)],_,dC),_.matches?_.matches:!1}function g(F,$){if(r.__dirty){r.__waiting.push(function(){return r.navigate(F,$)});return}else r.__dirty=!0;F=Wr(n)+"/"+Wr(F);var _={instance:r,to:F,navigateOptions:$||{},resolveOptions:$&&$.resolveOptions?$.resolveOptions:i,currentLocationPath:d(F)};mu([Bke,Vke,cC,mu.if(function(L){var B=L.matches;return B&&B.length>0},rG,iG),Gke,dC],_,dC)}function v(F,$,_){var L=E(F,$);return L!==null?(g(L.replace(new RegExp("^/?"+n),""),_),!0):!1}function y(F){return this.routes=o=o.filter(function($){return x0(F)?Wr($.path)!==Wr(F):Fke(F)?F!==$.handler:String($.path)!==String(F)}),this}function I(){u&&(this.__popstateListener=function(){r.__freezeListening||f()},window.addEventListener("popstate",this.__popstateListener))}function b(){this.routes=o=[],u&&window.removeEventListener("popstate",this.__popstateListener),this.destroyed=s=!0}function S(F,$){return r._notFoundRoute=m("*",F,[l,$],"__NOT_FOUND__"),this}function w(){if(c)return U().forEach(function(F){if(F.getAttribute("data-navigo")==="false"||F.getAttribute("target")==="_blank"){F.hasListenerAttached&&F.removeEventListener("click",F.navigoHandler);return}F.hasListenerAttached||(F.hasListenerAttached=!0,F.navigoHandler=function($){if(($.ctrlKey||$.metaKey)&&$.target.tagName.toLowerCase()==="a")return!1;var _=F.getAttribute("href");if(typeof _>"u"||_===null)return!1;if(_.match(/^(http|https)/)&&typeof URL<"u")try{var L=new URL(_);_=L.pathname+L.search}catch{}var B=_ke(F.getAttribute("data-navigo-options"));s||($.preventDefault(),$.stopPropagation(),r.navigate(Wr(_),B))},F.addEventListener("click",F.navigoHandler))}),r}function U(){return c?[].slice.call(document.querySelectorAll(i.linksSelector||nG)):[]}function T(F){return"/"+n+"/"+Wr(F)}function D(F){return l=F,this}function P(){return a}function E(F,$,_){var L=o.find(function(G){return G.name===F}),B=null;if(L){if(B=L.path,$)for(var V in $)B=B.replace(":"+V,$[V]);B=B.match(/^\//)?B:"/"+B}return B&&_&&!_.includeRoot&&(B=B.replace(new RegExp("^/"+n),"")),B}function R(F){return F.getAttribute("href")}function N(F){var $=L0(Wr(F)),_=$[0],L=$[1],B=L===""?null:yB(L),V=F0(F),G=m(_,function(){},[l],_);return{url:_,queryString:L,hashString:V,route:G,data:null,params:B}}function A(){return N(Wr(tne(n)).replace(new RegExp("^"+n),""))}function M(F){var $={instance:r,currentLocationPath:F,to:F,navigateOptions:{},resolveOptions:i};return cC($,function(){}),$.matches?$.matches:!1}function C(F,$,_){typeof $<"u"&&(typeof _>"u"||_)&&($=p($));var L={instance:r,to:$,currentLocationPath:$};eG(L,function(){}),typeof F=="string"&&(F=typeof _>"u"||_?p(F):F);var B=ine(L,{name:String(F),path:F,handler:function(){},hooks:{}});return B||!1}function O(F,$,_){return typeof $=="string"&&($=k($)),$?($.hooks[F]||($.hooks[F]=[]),$.hooks[F].push(_),function(){$.hooks[F]=$.hooks[F].filter(function(L){return L!==_})}):(console.warn("Route doesn't exists: "+$),function(){})}function k(F){return typeof F=="string"?o.find(function($){return $.name===p(F)}):o.find(function($){return $.handler===F})}function x(F){F.instance.__dirty=!1,F.instance.__waiting.length>0&&F.instance.__waiting.shift()()}this.root=n,this.routes=o,this.destroyed=s,this.current=a,this.__freezeListening=!1,this.__waiting=[],this.__dirty=!1,this.__markAsClean=x,this.on=h,this.off=y,this.resolve=f,this.navigate=g,this.navigateByName=v,this.destroy=b,this.notFound=S,this.updatePageLinks=w,this.link=T,this.hooks=D,this.extractGETParameters=function(F){return L0(d(F))},this.lastResolved=P,this.generate=E,this.getLinkPath=R,this.match=M,this.matchLocation=C,this.getCurrentLocation=A,this.addBeforeHook=O.bind(this,"before"),this.addAfterHook=O.bind(this,"after"),this.addAlreadyHook=O.bind(this,"already"),this.addLeaveHook=O.bind(this,"leave"),this.getRoute=k,this._pathToMatchObject=N,this._clean=Wr,this._checkForAHash=d,this._setCurrent=function(F){return a=r.current=F},I.call(this),w.call(this)}var Qke={};function Zke(){window.location.host.startsWith("localhost")||Qke.PUBLIC_URL;const t=document.getElementById("back"),e=!0,i=new Jke("/",{hash:e});return i.on("/",()=>{t.style.display="none",HU(Dy),Rke()}),i.on("/tournaments/:providerAbbr",({data:r})=>{t.style.display="none";const n=r.providerAbbr.toUpperCase();HU(sN),Ske({providerAbbr:n})}),i.on("/tournament/:tournamentId",({data:r})=>{t.style.display="block";const n=r.tournamentId;Cm.tournamentId=n,HU(_0),uK({tournamentId:n}).then(Dke)}),i.notFound(()=>{i.navigate("/")}),i.resolve(),i}const exe=document.body;exe.appendChild(ube());Rbe();Cm.router=Zke();
//# sourceMappingURL=index-BCiF3Wl3.js.map
