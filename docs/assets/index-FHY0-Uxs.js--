var lme=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var wQe=lme((eZe,Cy)=>{(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const s of a.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function i(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerPolicy&&(a.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?a.credentials="include":n.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(n){if(n.ep)return;n.ep=!0;const a=i(n);fetch(n.href,a)}})();const xY="tournament_title_block",FY="tournaments_control",$k="tournaments_table",ume="tournament_events",LY="tournament_logo",U1="tournaments",AE="tournament",Uw="splash",cme=[U1,AE,Uw];var dme=Object.defineProperty,ct=(t,e)=>{for(var i in e)dme(t,i,{get:e[i],enumerable:!0})};function kE(){return"2.4.6-beta.2"}var _Y={};ct(_Y,{competitionGovernor:()=>$Y,drawsGovernor:()=>gR,entriesGovernor:()=>IX,eventGovernor:()=>TX,generationGovernor:()=>BX,matchUpFormatGovernor:()=>XX,matchUpGovernor:()=>JX,mocksGovernor:()=>O_,participantGovernor:()=>WJ,policyGovernor:()=>q9,publishingGovernor:()=>mQ,queryGovernor:()=>J9,rankingGovernor:()=>q_,reportGovernor:()=>RQ,scheduleGovernor:()=>Y_,scoreGovernor:()=>a0,temporalGovernor:()=>cZ,tieFormatGovernor:()=>jQ,tournamentGovernor:()=>JQ,venueGovernor:()=>$Z});var $Y={};ct($Y,{getLinkedTournamentIds:()=>Gw,getTournamentIds:()=>Vw,linkTournaments:()=>B5,mutate:()=>BY,query:()=>G5,unlinkTournament:()=>j5,unlinkTournaments:()=>V5});var BY={};ct(BY,{linkTournaments:()=>B5,unlinkTournament:()=>j5,unlinkTournaments:()=>V5});var Qf="SINGLES",Wt="SINGLES",wp="DOUBLES",$t="DOUBLES",ka="TEAM",Zt="TEAM",pme={SINGLES_MATCHUP:Qf,SINGLES:Wt,DOUBLES_MATCHUP:wp,DOUBLES:$t,TEAM_MATCHUP:ka,TEAM:Zt},VY={[Wt]:[Wt,"S"],[$t]:[$t,"D"],[Zt]:[Zt,"T"],S:[Wt,"S"],D:[$t,"D"],T:[Zt,"T"]};function ir(t,e){return(t??0)-(e??0)}function Ye(t){return typeof t=="number"?parseInt(t.toString()):typeof t=="string"?parseInt(t):0}function pa(t){return typeof t=="function"}function ri(t){return typeof t=="string"}function bt(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)}function fme(t,e){if(!bt(t)||!bt(e))return!1;let i=Object.keys(t),r=Object.keys(e);if(i.length!==r.length)return!1;for(let n of i)if(t[n]!==e[n])return!1;return!0}function jY(t,e){return Array.isArray(t)?Object.assign({},...(t??[]).filter(bt).map(i=>i[e]&&{[i[e]]:i}).filter(Boolean)):{}}var mme=t=>e=>Object.keys(t).every(i=>e[i]===t[i]);function Bk(t,e){if(t===void 0)return null;if(!bt(t)||t===null)return t;let i=Object.keys(t),r=n=>n===void 0?null:n;return Object.assign({},...i.map(n=>Array.isArray(t[n])?{[n]:e?t[n]:t[n].map(a=>Bk(a))}:{[n]:e?r(t[n]):Bk(t[n])}))}function Vk(t){return Array.isArray(t)?t.length+t.map(Vk).reduce((e,i)=>e+i,0):bt(t)&&t!==null?Object.keys(t).length+Object.keys(t).map(e=>Vk(t[e])).reduce((e,i)=>e+i,0):0}function hme(t){if(t===null||typeof t!="object")return;let e=JSON.stringify(t),i=Vk(t),r=e.split("").reduce((n,a)=>n+a.charCodeAt(0),0);return[e.length,i,r].map(n=>n.toString(36)).join("")}function Uo(t){return Number.isNaN(Number(t))?!1:t>0&&(t&t-1)===0}function UH(t){if(!t.length)return;let e=[...t].sort(ir),i=Math.floor(e.length/2);return e.length%2?e[i]:(e[i-1]+e[i])/2}function gme(t){if(t===1||Number.isNaN(Number(t))||!Uo(t))return!1;let e=t,i=1;for(;e!==2;)i+=1,e=e/2;return i}function T1(t){return Number.isNaN(Number(t))?0:t%2&&t+1||t}function D1(t){return Math.pow(2,Math.round(Math.log(t)/Math.log(2)))}function Ni(t){return!Number.isNaN(Number.parseFloat(t))}function GY(t){let e=Ye(t);if(!Number.isNaN(e))return e===0?!1:(e&-e)===1}function qI(t){if(Number.isNaN(Number(t)))return!1;for(;!Uo(t);)t++;return t}function ts(t,e){return t=Math.ceil(t),e=Math.floor(e),Math.floor(Math.random()*(e-t+1))+t}function ot(t){return ri(t)&&!t.trim().length?!1:Number.isSafeInteger(typeof t=="string"?+t:t)}function Ime(t=1,e=3,i=!0){let r=0;for(let n=0;n<e;n++)r+=Math.random()*(t/e);return i&&t>1?Math.round(r):r}function vme(t,e){e||(e=1);let i=1/e;return Math.round(t*i)/i}function HY(t,e,i,r,n=2){let a=1-Math.random(),s=1-Math.random(),o=Math.sqrt(-2*Math.log(a))*Math.cos(2*Math.PI*s);return o=o/10+.5,o>1||o<0?o=HY(t,e,i):(o=Math.pow(o,i),o*=e-t,o+=t),r&&(o=vme(o,r)),Number.parseFloat(o.toFixed(n))}function RD(t,e=2){return Number.parseFloat(Number(Math.round(t*1e3)/1e3).toFixed(e))}function rt(t){return Array.isArray(t)?t?.filter((e,i,r)=>r.lastIndexOf(e)===i):[]}function yme(t){return Array.isArray(t)?t?.map(e=>e===null?void 0:e):t}function Dn(t){return Array.isArray(t)?t.map(e=>[Math.random(),e]).sort((e,i)=>e[0]-i[0]).map(e=>e[1]):[]}function Wg(t){return ot(t)?t:1/0}function va(t){return Array.isArray(t)?t.reduce((e,i)=>(e[i]||(e[i]=0),e[i]++,e),{}):{}}function bme(t){return WY(va(t))}function WY(t){return Object.keys(t).reduce((e,i)=>{let r=t[i];return e[r]?e[r].push(i):e[r]=[i],e},{})}function wme(t,e,i){return i.indexOf(t)===e}function zY(t){return t.filter(wme)}function ma(t){return Array.isArray(t)&&t.length?t.splice(Math.floor(Math.random()*t.length),1)[0]:void 0}function ca(t){let e=Math.floor(Math.random()*t.length);return t[e]}function Re(t,e){return Array.from({length:e-t},(i,r)=>r+t)}function qo(t,e){return e.reduce((i,r,n)=>(r===t&&i.push(n),i),[])}function xi(t,e){return!Array.isArray(t)||!Array.isArray(e)?[]:t.filter(i=>e.indexOf(i)!==-1).filter((i,r,n)=>n.indexOf(i)===r)}function TH(t,e){return!Array.isArray(t)||!Array.isArray(e)?[]:t.filter(i=>!e.includes(i))}function kn(t,e){return!Array.isArray(t)||!Array.isArray(e)?!1:t.some(i=>e.includes(i))}function Sme(t,e){return Array.isArray(e)&&e.reduce((i,r)=>(i[r]=1+i[r]||1,i),{})[t]||0}function Ume(t,e,i,r){return Array.isArray(t)?[].concat(...t.slice(0,e),...t.slice(e,e+i).sort(r),...t.slice(e+i,t.length)):[]}function yr(t,e){return Array.isArray(t)?t.reduce((i,r,n)=>{let a=Math.floor(n/e);return i[a]=[].concat(i[a]||[],r),i},[]):[]}function qY(t,[e,...i]){return t.length?[t.slice(0,e),...qY(t.slice(e),[...i,e])]:[]}function Tme(t){return t.reduce((e,i)=>{let r=e[e.length-1];return(!r||r[r.length-1]!==i-1)&&e.push([]),e[e.length-1].push(i),e},[])}function YY(t){return Array.isArray(t)?t.reduce((e,i)=>!isNaN(parseInt(i))&&e,!0):!1}function KY(t){return Array.isArray(t)?t.reduce((e,i)=>isNaN(parseInt(i))&&e,!0):!1}function jk(t,e,i){return Array.isArray(t)?t.reduce((r,n,a)=>{let s=i?!!(Math.floor(a/e)%2):!1,o=a%e,l=s?e-1-o:o;return r[l]||(r[l]=[]),r[l].push(n),r},[]):[]}function Dme(t,e=1){if(!Array.isArray(t)||!t.every(ot))return[];let i=Math.min(...t,e),r=Math.max(...t);return Re(i,r+1).filter(n=>!t.includes(n))}function Zf(t,e){return!Array.isArray(t)||!ri(e)?!1:xi(t,VY[e]).length}var H={success:!0},XY="error",Pme={SUCCESS:H,ERROR:XY};function JY({collectionValueProfiles:t,matchUpCount:e}){let i=[];if(!Array.isArray(t))return i.push(`collectionValueProfiles is not an array: ${t}`),{errors:i};if(t.length&&t.length!==e)return i.push("collectionValueProfiles do not align with matchUpsCount"),{errors:i};for(let n of t){if(typeof n!="object")return i.push(`valueProfile is not type object: ${n}`),{errors:i};let{matchUpValue:a,collectionPosition:s}=n;if(typeof a!="number"||typeof s!="number"||s>e||s<1)return i.push("Invalid value profile: value and collectionPosition must be numeric. collectionPosition cannot be greater than matchUpCount"),{errors:i}}let r=t.map(n=>n.collectionPosition);return r.length!==rt(r).length?(i.push("collectionPositions are not unique"),{errors:i}):{...H}}var Eme={};ct(Eme,{addNotice:()=>at,callListener:()=>Qk,createInstanceState:()=>che,cycleMutationStatus:()=>Z1,deepCopyEnabled:()=>Q1,deleteNotice:()=>eF,deleteNotices:()=>Aw,disableNotifications:()=>h4,enableNotifications:()=>zE,getDevContext:()=>ia,getMethods:()=>v4,getNotices:()=>y4,getProvider:()=>Zk,getTopics:()=>gs,getTournamentId:()=>rh,getTournamentRecord:()=>tF,getTournamentRecords:()=>nh,globalLog:()=>S4,handleCaughtError:()=>KE,hasTopic:()=>qE,removeTournamentRecord:()=>w4,setDeepCopy:()=>cb,setDevContext:()=>ub,setGlobalLog:()=>m4,setGlobalMethods:()=>g4,setGlobalSubscriptions:()=>phe,setMethods:()=>I4,setStateMethods:()=>U4,setStateProvider:()=>uhe,setSubscriptions:()=>fhe,setTournamentId:()=>db,setTournamentRecord:()=>b4,setTournamentRecords:()=>YE,timeKeeper:()=>dhe});var Gk={message:"Chronological error; time violation.",code:"ANACHRONISM"},ob={message:"Duplicate entry",code:"DUPLICATE_ENTRY"},QY={message:"Cannot remove main structure",code:"ERR_CANNOT_REMOVE_MAIN_STRUCTURE"},Hk={message:"records must be an object with tournamentId keys",code:"ERR_INVALID_TOURNAMENTS"},Ci={message:"Missing tournamentRecords",code:"ERR_MISSING_TOURNAMENTS"},Ie={message:"Missing tournamentRecord",code:"ERR_MISSING_TOURNAMENT"},Tw={message:"Invalid tournamentRecord",code:"ERR_INVALID_TOURNAMENT"},zg={message:"Missing tournamentId",code:"ERR_MISSING_TOURNAMENT_ID"},em={message:"Invalid drawDefinition",code:"ERR_INVALID_DRAWDEF"},_e={message:"Missing drawDefinition",code:"ERR_MISSING_DRAWDEF"},ZY={message:"Existing drawDefinition(s)",code:"ERR_EXISTING_DRAWDEFS"},Oa={message:"drawDefinition not found",code:"ERR_NOT_FOUND_DRAWDEF"},Jp={message:"Invalid structure",code:"ERR_INVALID_STRUCTURE"},P1={message:"Incomplete source structure",code:"ERR_INCOMPLETE_STRUCTURE"},E1={message:"Invalid drawPosition for seedAssignment",code:"ERR_INVALID_SEEDING_POSITION"},qg={message:"drawPosition already assigned",code:"ERR_EXISTING_POSITION_ASSIGNMENT"},e6={message:"Schedule not cleared",code:"ERR_UNCHANGED_SCHEDULE_NOT_CLEARED"},t6={message:"Schedule conflict: court slot already occupied",code:"ERR_SCHEDULE_CONFLICT_DOUBLE_BOOKING"},i6={message:"drawPosition not cleared",code:"ERR_FAILURE_POSITION_NOT_CLEARED"},Rme={message:"drawPosition not found",code:"ERR_NOT_FOUND_DRAW_POSITION"},R1={message:"Unrecognized drawType",code:"ERR_UNRECOGNIZED_DRAW_TYPE"},Dw={message:"Missing drawPositions",code:"ERR_MISSING_DRAW_POSITIONS"},Pw={message:"drawPosition is active",code:"ERR_ACTIVE_DRAW_POSITION"},Cme={message:"drawPosition is occupied",code:"ERR_OCCUPIED_DRAW_POSITION"},Zm={message:"Invlid drawPosition",code:"ERR_INVALID_DRAW_POSITION"},YI={message:"Missing drawPosition",code:"ERR_MISSING_DRAW_POSITION"},C1={message:"Invalid drawType",code:"ERR_INVALID_DRAW_TYPE"},OE={message:"Invalid drawSize",code:"ERR_INVALID_DRAW_SIZE"},r6={message:"Cannot set drawSize to be less than existing entries",code:"ERR_INVALID_DRAW_SIZE_MISMATCH"},Ew={message:"Missing drawSize",code:"ERR_MISSING_DRAW_SIZE"},Oo={message:"Missing drawId",code:"ERR_MISSING_DRAW_ID"},n6={message:"drawId exists",code:"ERR_EXISTING_DRAW_ID"},a6={message:"participantId cannot be assigned to multiple seedNumbers",code:"INVALID_PARTICIPANT_SEEDING"},s6={message:"seedsCount greater than drawSize",code:"ERR_INVALID_SEED_COUNT"},o6={message:"Missing seedCountThresholds",code:"ERR_MISSING_SEED_COUNT_THRESHOLD"},l6={message:"Invalid action",code:"ERR_INVALID_ACTION"},Wk={message:"Invalid assignment",code:"ERR_INVALID_ASSIGNMENT"},u6={message:"Missing seedAssignments",code:"ERR_MISSING_SEED_ASSIGNMENTS"},c6={message:"Invalid seedNumber",code:"ERR_INVALID_SEED_NUMBER"},d6={message:"Invalid seedPosition",code:"ERR_INVALID_SEED_POSITION"},M1={message:"Missing targetLink",code:"ERR_MISSING_LINK_TARGET"},p6={message:"Existing round",code:"ERR_EXISTING_ROUND"},Mme={message:"Missing roundNumber",code:"ERR_MISSING_ROUND_NUMBER"},Va={message:"Missing structureId",code:"ERR_MISSING_STRUCTURE_ID"},Ii={message:"structure not found",code:"ERR_NOT_FOUND_STRUCTURE"},N1={message:"Missing structures",code:"ERR_MISSING_STRUCTURES"},Qp={message:"Missing structure",code:"ERR_MISSING_STRUCTURE"},A1={message:"Missing MAIN structure",code:"ERR_MISSING_MAIN_STRUCTURE"},f6={message:"drawDefinition contains unlinked structures",code:"ERR_MISSING_STRUCTURE_LINKS"},Zl={message:"Invalid eventType",code:"ERR_INVALID_EVENT_TYPE"},li={message:"Missing event / eventId",code:"ERR_MISSING_EVENT_ID"},os={message:"Event not found",code:"ERR_NOT_FOUND_EVENT"},m6={message:"Event exists",code:"ERR_EXISTING_EVENT"},h6={message:"Missing entries",code:"ERR_MISSING_ENTRIES"},g6={message:"Invalid entries",code:"ERR_INVALID_ENTRIES"},k1={message:"Missing assignments",code:"ERR_MISSING_ASSIGNMENTS"},I6={message:"Missing stage",code:"ERR_MISSING_STAGE"},Zp={message:"Invalid stage",code:"ERR_INVALID_STAGE"},v6={message:"stageSequence limit",code:"ERR_LIMIT_STAGE_SEQUENCE"},y6={message:"Missing positionAssignments",code:"ERR_MISSING_POSITION_ASSIGNMENTS"},b6={message:"Cannot Assign BYE status if no assignment: { bye: true }",code:"ERR_UNCHANGED_CANNOT_ASSIGN_BYE"},zk={message:"Unrecognized matchUpStatus",code:"ERR_UNRECOGNIZED_MATCHUP_STATUS"},Rw={message:"Unrecognized matchUpFormat",code:"ERR_UNRECOGNIZED_MATCHUP_FORMAT"},GT={message:"Incompatible matchUpStatus",code:"ERR_INCOMPATIBLE_MATCHUP_STATUS"},Nme={message:"Propagated exits downstream",code:"ERR_PROPAGATED_EXITS_DOWNSTREAM"},KI={message:"Invalid matchUpStatus",code:"ERR_INVALID_MATCHUP_STATUS"},Vl={message:"Invalid tieFormat",code:"ERR_INVALID_TIE_FORMAT"},w6={message:"Invalid matchUpFormat",code:"ERR_INVALID_MATCHUP_FORMAT"},S6={message:"Missing matchUpFormat",code:"ERR_MISSING_MATCHUP_FORMAT"},U6={message:"Missing collectionDefinition",code:"ERR_MISSING_COLLECTION_DEFINITION"},XI={message:"Missing tieFormat",code:"ERR_MISSING_TIE_FORMAT"},Un={message:"Missing matchUpId",code:"ERR_MISSING_MATCHUP_ID"},eh={message:"Missing matchUpIds",code:"ERR_MISSING_MATCHUP_IDS"},un={message:"matchUp not found",code:"ERR_NOT_FOUND_MATCHUP"},Tu={message:"Missing matchUps",code:"ERR_MISSING_MATCHUPS"},ea={message:"Missing matchUp",code:"ERR_MISSING_MATCHUP"},ta={message:"Invalid matchUp",code:"ERR_INVALID_MATCHUP"},O1={message:"Missing policyType",code:"ERR_MISSING_POLICY_TYPE"},xE={message:"Missing policyDefinitions",code:"ERR_MISSING_POLICY_DEFINITIONS"},Ame={message:"Missing seeding policy",code:"ERR_MISSING_POLICY_SEEDING"},T6={message:"Missing avoidance policy",code:"ERR_MISSING_POLICY_AVOIDANCE"},x1={message:"Missing policy attributes",code:"ERR_MISSING_POLICY_ATTRIBUTES"},D6={message:"Invalid policyDefinitions",code:"ERR_INVALID_POLICY_DEFINITIONS"},F1={message:"existing policyType",code:"ERR_EXISTING_POLICY_TYPE"},kme={message:"Policy not attached",code:"ERR_FAILURE_POLICY_NOT_ATTACHED"},Cw={message:"Policy not found",code:"ERR_NOT_FOUND_POLICY"},Ome={message:"Missing scoring policy / matchUpFormats",code:"ERR_MISSING_POLICY_SCORING_MATCHUP_FORMATS"},P6={message:"Invalid sideNumber",code:"ERR_INVALID_SIDE_NUMBER"},xme={message:"Invalid setNumber",code:"ERR_INVALID_SET_NUMBER"},FE={message:"Missing setObject",code:"ERR_MISSING_SET_ATTRIBUTE"},Fme={message:"Missing setNumber",code:"ERR_MISSING_SET_NUMBER"},Lme={message:"Missing sideNumber",code:"ERR_MISSING_SIDE_NUMBER"},th={message:"Missing courtId",code:"ERR_MISSING_COURT_ID"},Xe={message:"Missing value",code:"ERR_MISSING_VALUE"},E6={message:"Missing birthdate",code:"ERR_MISSING_BIRTH_DATE"},R6={message:"Missing date",code:"ERR_MISSING_DATE"},C6={message:"No valid dates",code:"ERR_NO_VALID_DATES"},CD={message:"Invalid bookings",code:"ERR_INVALID_BOOKINGS"},HT={message:"Invalid dateAvailability",code:"ERR_INVALID_DATE_AVAILABILITY"},M6={message:"Missing dateAvailability",code:"ERR_MISSING_DATE_AVAILABILITY"},sr={message:"Invalid Date",code:"ERR_INVALID_DATE"},Ps={message:"Invalid time",code:"ERR_INVALID_TIME"},N6={message:"Invalid tournament dates",code:"ERR_INVALID_DATES_TOURNAMENT"},_me={message:"Missing date range",info:"Event or tournament must have start and end dates",code:"ERR_MISSING_DATE_RANGE"},LE={message:"Invalid Time Zone",code:"ERR_INVALID_TIME_ZONE"},Sg={message:"Invalid embargo: must be an ISO 8601 datetime with timezone (Z or Â±HH:MM offset)",code:"ERR_INVALID_EMBARGO"},qk={message:"Invalid game scores",code:"ERR_INVALID_SCORES_GAME"},A6={message:"Invalid score",code:"ERR_INVALID_SCORE"},_E={message:"Invalid winningSide",code:"ERR_INVALID_WINNING_SIDE"},$me={message:"No participants generated",code:"ERR_NO_PARTICIPANTS_GENERATED"},L1={message:"Cannot modify tieFormat",code:"ERR_UNCHANGED_CANNOT_MODIFY_TIEFORMAT"},k6={message:"Cannot modify participantType",code:"ERR_UNCHANGED_CANNOT_MODIFY_PARTICIPANT_TYPE"},$E={message:"Cannot remove participants",code:"ERR_UNCHANGED_CANNOT_REMOVE_PARTICIPANTS"},O6={message:"Participant category mismatch",code:"ERR_CATEGORY_MISMATCH"},BE={message:"Cannot change winningSide",code:"ERR_UNCHANGED_CANNOT_CHANGE_WINNING_SIDE"},Sp={message:"Invalid participant",code:"ERR_INVALID_PARTICIPANT"},To={message:"Invalid participantId",code:"ERR_INVALID_PARTICIPANT_ID"},ga={message:"Invalid participantIds",code:"ERR_INVALID_PARTICIPANT_IDS"},x6={message:"Invalid participantRole",code:"ERR_INVALID_PARTICIPANT_ROLE"},Do={message:"Invalid participantType",code:"ERR_INVALID_PARTICIPANT_TYPE"},F6={message:"Missing participantRole",code:"ERR_MISSING_PARTICIPANT_ROLE"},ih={message:"Missing participant",code:"ERR_MISSING_PARTICIPANT"},Mw={message:"Missing participants",code:"ERR_MISSING_PARTICIPANTS"},lr={message:"Missing participantId",code:"ERR_MISSING_PARTICIPANT_ID"},L6={message:"Missing qualified participants",code:"ERR_MISSING_QUALIFIED_PARTICIPANTS"},Vi={message:"Participant Not Found",code:"ERR_NOT_FOUND_PARTICIPANT"},_6={message:"participantId exists",code:"ERR_EXISTING_PARTICIPANT_ID"},Bme={message:"participant pair exists",code:"ERR_EXISTING_PARTICIPANT_PAIR"},$6={message:"No participant removed",code:"ERR_UNCHANGED_NO_PARTICIPANT_REMOVED"},Od={message:"Missing participantIds",code:"ERR_MISSING_PARTICIPANT_IDS"},B6={message:"Missing participantsCount",code:"ERR_MISSING_PARTICIPANT_COUNT"},V6={message:"Participant not checked in",code:"ERR_UNCHANGED_PARTICIPANT_NOT_CHECKED_IN"},j6={message:"Missing person details",code:"ERR_MISSING_PERSON_DETAILS"},JI={message:"Existing participant drawPosition assignment",code:"ERR_EXISTING_PARTICIPANT_DRAW_POSITION_ASSIGNMENT"},VE={message:"Existing participant",code:"ERR_EXISTING_PARTICIPANT"},_1={message:"participantsCount exceeds drawSize",code:"ERR_INVALID_PARTICIPANT_COUNT"},Yk={message:"Invalid entry status",code:"ERR_INVALID_ENTRY_STATUS"},G6={message:"Participant Entry Not Found",code:"ERR_NOT_FOUND_PARTICIPANT_ENTRY"},Vme={message:"Participant not entered in stage",code:"ERR_UNCHANGED_PARTICIPANT_NOT_ENTERED"},jme={message:"Participant not found in stageSequence",code:"ERR_NOT_FOUND_PARTICIPANT_IN_STAGE"},H6={message:"entryStatus not allowed in stage",code:"ERR_INVALID_ENTRY_STATUS_IN_STAGE"},W6={message:"entryStatus not allowed for event",code:"ERR_INVALID_ENTRY_STATUS_IN_EVENT"},Kk={message:"No stage space available for entryStatus",code:"ERR_UNCHANGED_NO_AVAILABLE_STAGE_SPACE"},$1={message:"Insufficient drawPositions to accommodate qualifiers",code:"ERR_UNCHANGED_NO_DRAW_POSITIONS_FOR_QUALIFIERS"},B1={message:"Insufficient drawPositions to accommodate entries",code:"ERR_INSUFFICIENT_DRAW_POSITIONS"},z6={message:"Missing penaltyType",code:"ERR_MISSING_PENALTY_TYPE"},V1={message:"Missing penaltyId",code:"ERR_MISSING_PENALTY_ID"},Yg={message:"Penalty not found",code:"ERR_NOT_FOUND_PENALTY"},q6={message:"Missing courtsCount/courtNames",code:"ERR_MISSING_COURTS_INFO"},nc={message:"Court not found",code:"ERR_NOT_FOUND_COURT"},Y6={message:"Court exists",code:"ERR_EXISTING_COURT"},Xk={message:"Booking not found",code:"ERR_NOT_FOUND_BOOKING"},K6={message:"Existing matchUps conflict with booking",code:"ERR_EXISTING_MATCHUPS"},X6={message:"Venue exists",code:"ERR_EXISTING_VENUE"},ef={message:"Venue not found",code:"ERR_NOT_FOUND_VENUE"},xd={message:"Missing venueId",code:"ERR_MISSING_VENUE_ID"},J6={message:"Invalid endTime",code:"ERR_INVALID_END_TIME"},j1={message:"Existing endTime",code:"ERR_EXISTING_END_TIME"},Q6={message:"Invalid stopTime",code:"ERR_INVALID_STOP_TIME"},Z6={message:"Invalid startTime",code:"ERR_INVALID_START_TIME"},Gme={message:"Invalid resumeTime",code:"ERR_INVALID_RESUME_TIME"},G1={message:"Invalid timeItem",code:"ERR_INVALID_TIME_ITEMS"},e4={message:"Missing async state provider",code:"ERR_MISSING_ASYNC_STATE_PROVIDER"},H1={message:"Missing timeItem",code:"ERR_MISSING_TIME_ITEM"},W1={message:"Missing timeItems",code:"ERR_MISSING_TIME_ITEMS"},jE={message:"Missing context",code:"ERR_MISSING_CONTEXT"},t4={message:"Missing schedule",code:"ERR_MISSING_SCHEDULE"},Tm={message:"Invalid scaleItem",code:"ERR_INVALID_SCALE_ITEM"},i4={message:"Modifications failed",code:"ERR_FAILURE_MODIFICATIONS"},QI={message:"No modifications applied",code:"ERR_UNCHANGED_NO_MODIFICATIONS_APPLIED"},r4={message:"Unable to assign court",code:"ERR_UNCHANGED_COURT_NOT_ASSIGNED"},GE={message:"No Candidates",code:"ERR_UNCHANGED_NO_CANDIDATES"},n4={message:"Invalid configuration",code:"ERR_INVALID_CONFIG"},a4={message:"Invalid collectionDefinition",code:"ERR_INVALID_COLLECTION_DEFINITION"},Nc={message:"Invalid object",code:"ERR_INVALID_OBJECT"},My={message:"Invalid gender",code:"ERR_INVALID_GENDER"},lb={message:"Invalid category",code:"ERR_INVALID_CATEGORY"},ie={message:"Invalid values",code:"ERR_INVALID_VALUES"},s4={message:"Duplicate value",code:"ERR_DUPLICATE_VALUE"},z1={message:"Team not found",code:"ERR_NOT_FOUND_TEAM"},o4={message:"No valid actions",code:"ERR_NO_VALID_ACTIONS"},HE={message:"No valid attributes",code:"ERR_NO_VALID_ATTRIBUTES"},q1={message:"Value unchanged",code:"ABORT_UNCHANGED"},_r={message:"Not found",code:"ERR_NOT_FOUND"},Y1={message:"Not implemented",code:"ERR_NOT_IMPLEMENTED"},l4={message:"Existing flight",code:"ERR_EXISTING_FLIGHT"},K1={message:"Existing flight profile",code:"ERR_EXISTING_FLIGHT_PROFILE"},u4={message:"Existing outcome",code:"ERR_EXISTING_OUTCOME"},c4={message:"Existing matchUpId",code:"ERR_EXISTING_MATCHUP_ID"},Jk={message:"Existing stage",code:"ERR_EXISTING_STAGE"},X1={message:"Existing structure",code:"ERR_EXISTING_STRUCTURE"},WE={message:"Method not found",code:"ERR_NOT_FOUND_METHOD"},d4={message:"Scheduled matchUps",code:"ERR_SCHEDULED_MATCHUPS"},Nw={message:"Scores present",code:"ERR_SCORES_PRESENT"},Hme={ANACHRONISM:Gk,BOOKING_NOT_FOUND:Xk,CANNOT_CHANGE_WINNING_SIDE:BE,CANNOT_MODIFY_TIEFORMAT:L1,CANNOT_MODIFY_PARTICIPANT_TYPE:k6,CANNOT_REMOVE_MAIN_STRUCTURE:QY,CANNOT_REMOVE_PARTICIPANTS:$E,CATEGORY_MISMATCH:O6,COURT_EXISTS:Y6,COURT_NOT_FOUND:nc,EXISTING_MATCHUPS:K6,DRAW_DEFINITION_NOT_FOUND:Oa,DRAW_ID_EXISTS:n6,DRAW_POSITION_ACTIVE:Pw,DRAW_POSITION_ASSIGNED:qg,DRAW_POSITION_NOT_CLEARED:i6,DRAW_POSITION_NOT_FOUND:Rme,DRAW_SIZE_MISMATCH:r6,DUPLICATE_ENTRY:ob,DUPLICATE_VALUE:s4,ENTRY_STATUS_NOT_ALLOWED_FOR_EVENT:W6,ENTRY_STATUS_NOT_ALLOWED_IN_STAGE:H6,EVENT_EXISTS:m6,EVENT_NOT_FOUND:os,EXISTING_DRAW_DEFINITIONS:ZY,EXISTING_END_TIME:j1,EXISTING_FLIGHT:l4,EXISTING_MATCHUP_ID:c4,EXISTING_OUTCOME:u4,EXISTING_PARTICIPANT_DRAW_POSITION_ASSIGNMENT:JI,EXISTING_PARTICIPANT:VE,EXISTING_POLICY_TYPE:F1,EXISTING_PROFILE:K1,EXISTING_ROUND:p6,EXISTING_STAGE:Jk,EXISTING_STRUCTURE:X1,INCOMPATIBLE_MATCHUP_STATUS:GT,INCOMPLETE_SOURCE_STRUCTURE:P1,INSUFFICIENT_DRAW_POSITIONS:B1,INVALID_ACTION:l6,INVALID_ASSIGNMENT:Wk,INVALID_BOOKINGS:CD,INVALID_CATEGORY:lb,INVALID_COLLECTION_DEFINITION:a4,INVALID_CONFIGURATION:n4,INVALID_DATE_AVAILABILITY:HT,INVALID_DATE:sr,INVALID_DRAW_DEFINITION:em,INVALID_DRAW_POSITION_FOR_SEEDING:E1,INVALID_DRAW_POSITION:Zm,INVALID_DRAW_SIZE:OE,INVALID_END_TIME:J6,INVALID_ENTRIES:g6,INVALID_EVENT_TYPE:Zl,INVALID_GAME_SCORES:qk,INVALID_GENDER:My,INVALID_MATCHUP_FORMAT:w6,INVALID_MATCHUP_STATUS:KI,INVALID_MATCHUP_STATUS_BYE:b6,INVALID_MATCHUP:ta,INVALID_OBJECT:Nc,INVALID_PARTICIPANT_ID:To,INVALID_PARTICIPANT_IDS:ga,INVALID_PARTICIPANT_ROLE:x6,INVALID_PARTICIPANT_SEEDING:a6,INVALID_PARTICIPANT_TYPE:Do,INVALID_PARTICIPANT:Sp,INVALID_POLICY_DEFINITION:D6,INVALID_RECORDS:Hk,INVALID_SCALE_ITEM:Tm,INVALID_SEED_NUMBER:c6,INVALID_SEED_POSITION:d6,INVALID_SET_NUMBER:xme,INVALID_SIDE_NUMBER:P6,INVALID_SCORE:A6,INVALID_STAGE:Zp,INVALID_START_TIME:Z6,INVALID_STRUCTURE:Jp,INVALID_STOP_TIME:Q6,INVALID_TIE_FORMAT:Vl,INVALID_TIME:Ps,INVALID_TIME_ITEM:G1,INVALID_TOURNAMENT_DATES:N6,INVALID_TOURNAMENT_RECORD:Tw,INVALID_VALUES:ie,INVALID_WINNING_SIDE:_E,MATCHUP_NOT_FOUND:un,METHOD_NOT_FOUND:WE,MISSING_ASSIGNMENTS:k1,MISSING_ASYNC_STATE_PROVIDER:e4,MISSING_AVOIDANCE_POLICY:T6,MISSING_BIRTH_DATE:E6,MISSING_COLLECTION_DEFINITION:U6,MISSING_COURT_ID:th,MISSING_COURTS_INFO:q6,MISSING_DATE_AVAILABILITY:M6,MISSING_DATE:R6,MISSING_DRAW_DEFINITION:_e,MISSING_DRAW_ID:Oo,MISSING_DRAW_POSITION:YI,MISSING_DRAW_POSITIONS:Dw,MISSING_DRAW_SIZE:Ew,MISSING_ENTRIES:h6,MISSING_EVENT:li,MISSING_QUALIFIED_PARTICIPANTS:L6,MISSING_MATCHUP_FORMAT:S6,MISSING_MATCHUP_ID:Un,MISSING_MATCHUP_IDS:eh,MISSING_MATCHUP:ea,MISSING_MATCHUPS:Tu,MISSING_PARTICIPANT_COUNT:B6,MISSING_PARTICIPANT_ID:lr,MISSING_PARTICIPANT_IDS:Od,MISSING_PARTICIPANT_ROLE:F6,MISSING_PARTICIPANT:ih,MISSING_PARTICIPANTS:Mw,MISSING_PENALTY_ID:V1,MISSING_PENALTY_TYPE:z6,MISSING_PERSON_DETAILS:j6,MISSING_POLICY_ATTRIBUTES:x1,MISSING_POLICY_DEFINITION:xE,MISSING_POLICY_TYPE:O1,MISSING_POSITION_ASSIGNMENTS:y6,MISSING_ROUND_NUMBER:Mme,MISSING_SCHEDULE:t4,MISSING_SCORING_POLICY:Ome,MISSING_SEED_ASSIGNMENTS:u6,MISSING_SEEDCOUNT_THRESHOLDS:o6,MISSING_SEEDING_POLICY:Ame,MISSING_SET_NUMBER:Fme,MISSING_SET_OBJECT:FE,MISSING_SIDE_NUMBER:Lme,MISSING_STAGE:I6,MISSING_STRUCTURE_ID:Va,MISSING_STRUCTURE:Qp,MISSING_MAIN_STRUCTURE:A1,MISSING_STRUCTURES:N1,MISSING_TARGET_LINK:M1,MISSING_TIE_FORMAT:XI,MISSING_TIME_ITEM:H1,MISSING_TIME_ITEMS:W1,MISSING_TOURNAMENT_ID:zg,MISSING_TOURNAMENT_RECORD:Ie,MISSING_TOURNAMENT_RECORDS:Ci,MISSING_VALUE:Xe,MISSING_VENUE_ID:xd,MODIFICATIONS_FAILED:i4,NO_CANDIDATES:GE,NO_DRAW_POSITIONS_AVAILABLE_FOR_QUALIFIERS:$1,NO_MODIFICATIONS_APPLIED:QI,NO_STAGE_SPACE_AVAILABLE_FOR_ENTRY_STATUS:Kk,NO_PARTICIPANT_REMOVED:$6,NO_VALID_ACTIONS:o4,NO_VALID_ATTRIBUTES:HE,NO_VALID_DATES:C6,NOT_FOUND:_r,NOT_IMPLEMENTED:Y1,PARTICIPANT_COUNT_EXCEEDS_DRAW_SIZE:_1,PARTICIPANT_ID_EXISTS:_6,PARTICIPANT_NOT_CHECKED_IN:V6,PARTICIPANT_NOT_FOUND:Vi,PARTICIPANT_PAIR_EXISTS:Bme,PENALTY_NOT_FOUND:Yg,POLICY_NOT_ATTACHED:kme,POLICY_NOT_FOUND:Cw,SCHEDULE_NOT_CLEARED:e6,SCHEDULE_CONFLICT_DOUBLE_BOOKING:t6,SCHEDULED_MATCHUPS:d4,SCORES_PRESENT:Nw,SEEDSCOUNT_GREATER_THAN_DRAW_SIZE:s6,STAGE_SEQUENCE_LIMIT:v6,STRUCTURE_NOT_FOUND:Ii,TEAM_NOT_FOUND:z1,UNABLE_TO_ASSIGN_COURT:r4,UNLINKED_STRUCTURES:f6,UNRECOGNIZED_DRAW_TYPE:R1,UNRECOGNIZED_MATCHUP_FORMAT:Rw,UNRECOGNIZED_MATCHUP_STATUS:zk,VALUE_UNCHANGED:q1,VENUE_EXISTS:X6},hi={disableNotifications:!1,tournamentId:void 0,tournamentRecords:{},subscriptions:{},modified:!1,methods:{},notices:[]},p4={addNotice:ihe,callListener:ohe,cycleMutationStatus:the,deleteNotice:ahe,deleteNotices:nhe,disableNotifications:Wme,enableNotifications:zme,getMethods:J1,getNotices:rhe,getTopics:she,getTournamentId:f4,getTournamentRecord:qme,getTournamentRecords:Yme,removeTournamentRecord:Qme,setMethods:ehe,setSubscriptions:Zme,setTournamentId:Xme,setTournamentRecord:Kme,setTournamentRecords:Jme,handleCaughtError:lhe};function Wme(){hi.disableNotifications=!0}function zme(){hi.disableNotifications=!1}function f4(){return hi.tournamentId}function qme(t){return hi.tournamentRecords[t]}function Yme(){return hi.tournamentRecords}function Kme(t){let e=t?.tournamentId;return e?(hi.tournamentRecords[e]=t,{success:!0}):{error:Tw}}function Xme(t){return t?hi.tournamentRecords[t]?(hi.tournamentId=t,{success:!0}):{error:Ie}:(hi.tournamentId=void 0,{success:!0})}function Jme(t){hi.tournamentRecords=t;let e=Object.keys(t);e.length===1?hi.tournamentId=e[0]:e.length||(hi.tournamentId=void 0)}function Qme(t){if(typeof t!="string")return{error:ie};if(!hi.tournamentRecords[t])return{error:_r};delete hi.tournamentRecords[t];let e=Object.keys(hi.tournamentRecords);return e.length===1?hi.tournamentId=e[0]:e.length||(hi.tournamentId=void 0),{success:!0}}function Zme(t){return t.subscriptions===null||Object.keys(t.subscriptions).length===0?(hi.subscriptions={},{...H}):typeof t.subscriptions!="object"?{error:ie}:(Object.keys(t.subscriptions).forEach(e=>{typeof t.subscriptions[e]=="function"?hi.subscriptions[e]=t.subscriptions[e]:delete hi.subscriptions[e]}),{...H})}function ehe(t){return typeof t!="object"?{error:ie}:(Object.keys(t).forEach(e=>{typeof t[e]=="function"&&(hi.methods[e]=t[e])}),{...H})}function the(){let t=hi.modified;return hi.modified=!1,t}function ihe({topic:t,payload:e,key:i},r){if(!(typeof t!="string"||typeof e!="object")&&(hi.disableNotifications||(hi.modified=!0),!(hi.disableNotifications||!hi.subscriptions[t]&&!r)))return i&&(hi.notices=hi.notices.filter(n=>!(n.topic===t&&n.key===i))),hi.notices.push({topic:t,payload:e,key:i}),{...H}}function J1(){return hi.methods??{}}function rhe({topic:t}){return hi.notices.filter(e=>e.topic===t).map(e=>e.payload)}function nhe(){hi.notices=[]}function ahe({topic:t,key:e}){hi.notices=hi.notices.filter(i=>(!t||i.topic===t)&&i.key!==e)}function she(){return{topics:Object.keys(hi.subscriptions)}}function ohe({topic:t,notices:e},i){let r=hi.subscriptions[t];r&&typeof r=="function"&&r(e);let n=i?.[t];n&&typeof n=="function"&&n(e)}function lhe({engineName:t,methodName:e,params:i,err:r}){let n;return typeof r=="string"?n=r.toUpperCase():r instanceof Error&&(n=r.message),console.log("ERROR",{tournamentId:f4(),params:JSON.stringify(i),engine:t,methodName:e,error:n}),{error:n}}var Xt={timers:{default:{elapsedTime:0}},globalSubscriptions:{},deepCopyAttributes:{stringify:[],ignore:[],toJSON:[]},globalMethods:[],deepCopy:!0},Mr=p4,DH=["addNotice","callListener","cycleMutationStatus","deleteNotice","deleteNotices","disableNotifications","enableNotifications","getMethods","getNotices","getTopics","getTournamentId","getTournamentRecord","getTournamentRecords","removeTournamentRecord","setSubscriptions","setTournamentId","setTournamentRecord","setTournamentRecords"];function uhe(t){if(typeof t!="object")throw new Error("Global state provider can not be undefined or null");if(xi(Object.keys(t),DH).length!==DH.length)throw new Error("Global state provider is missing required methods");return Mr=t,{success:!0}}function che(){if(Mr.createInstanceState){try{Mr.createInstanceState()}catch(t){return{error:t}}return{success:!0}}else return{error:e4}}function ia(t){return!t||typeof t!="object"?Xt.devContext??!1:typeof Xt.devContext!="object"?!1:Object.keys(t).every(e=>Xt.devContext?.[e]===t[e])&&Xt.devContext}function dhe(t="reset",e="default"){let i=Date.now();if(t==="report"){if(e==="allTimers")return Object.keys(Xt.timers).filter(r=>r!=="default"||Xt.timers[r].startTime).map(r=>{let n=Xt.timers[r],a=n.state==="stopped"?0:(i-(n?.startTime??0))/1e3,s=n.elapsedTime+a;return{state:Xt.timers[r].state,elapsedTime:s.toFixed(2),timer:r}});{let r=Xt.timers[e].state==="stopped"?0:(i-(Xt.timers[e]?.startTime??0))/1e3,n=Xt.timers[e].elapsedTime+r;return{state:Xt.timers[e].state,elapsedTime:n.toFixed(2),timer:e}}}if(!Xt.timers[e]||t==="reset"){if(e==="allTimers")return Xt.timers={default:{elapsedTime:0}},!0;Xt.timers[e]={startTime:i,state:"active",elapsedTime:0}}return Xt.timers[e].elapsedTime||(Xt.timers[e].elapsedTime=0),t==="stop"&&Xt.timers[e].state!=="stopped"&&(Xt.timers[e].state="stopped")&&(Xt.timers[e].elapsedTime+=(i-(Xt.timers[e]?.startTime??0))/1e3),t==="start"&&(Xt.timers[e].startTime=i)&&(Xt.timers[e].state="active"),Xt.timers[e]}function m4(t){pa(t)?Xt.globalLog=t:delete Xt.globalLog}function ub(t){Xt.devContext=t}function h4(){Mr.disableNotifications()}function zE(){Mr.enableNotifications()}function cb(t,e){typeof t=="boolean"&&(Xt.deepCopy=t),typeof e=="object"&&(Array.isArray(e.ignore)&&(Xt.deepCopyAttributes.ignore=e.ignore),Array.isArray(e.toJSON)&&(Xt.deepCopyAttributes.toJSON=e.toJSON),Array.isArray(e.stringify)&&(Xt.deepCopyAttributes.stringify=e.stringify),e.threshold&&(Xt.deepCopyAttributes.threshold=e.threshold))}function Q1(){return{enabled:Xt.deepCopy,...Xt.deepCopyAttributes}}function phe(t){return t?.subscriptions?(Object.keys(t.subscriptions).forEach(e=>{Xt.globalSubscriptions[e]=t.subscriptions[e]}),{...H}):{error:Xe,info:"missing subscriptions"}}function fhe(t){return t?.subscriptions?Mr.setSubscriptions({subscriptions:t.subscriptions}):{error:Xe,info:"missing subscriptions"}}function g4(t){return t?typeof t!="object"?{error:ie}:(Object.keys(t).forEach(e=>{pa(t[e])&&(Xt.globalMethods[e]=t[e])}),{...H}):{error:Xe,info:"missing method declarations"}}function I4(t){return t?typeof t!="object"?{error:ie}:Mr.setMethods(t):{error:Xe,info:"missing method declarations"}}function Z1(){return Mr.cycleMutationStatus()}function at(t){if(typeof t?.topic!="string")return;let e=Xt.globalSubscriptions[t.topic];return Mr.addNotice(t,e)}function v4(){return{...Xt.globalMethods,...Mr.getMethods()}}function y4(t){return Mr.getNotices(t)}function eF({key:t,topic:e}){return Mr.deleteNotice({key:t,topic:e})}function Aw(){return Mr.deleteNotices()}function gs(){return Mr.getTopics()}function qE(t){return gs()?.topics?.includes(t)}async function Qk(t){return Mr.callListener(t,Xt.globalSubscriptions)}function rh(){return Mr.getTournamentId()}function tF(t){return Mr.getTournamentRecord(t)}function nh(){return Mr.getTournamentRecords()}function b4(t){return Mr.setTournamentRecord(t)}function YE(t){return Mr.setTournamentRecords(t)}function db(t){return Mr.setTournamentId(t)}function w4(t){return Mr.removeTournamentRecord(t)}function Zk(){return Mr}function KE({engineName:t,methodName:e,params:i,err:r}){let n=pa(Mr.handleCaughtError)&&Mr.handleCaughtError||p4.handleCaughtError,{tournamentRecord:a,...s}=i;return n({params:s,engineName:t,methodName:e,err:r})}function S4(t,e){if(Xt.globalLog)try{Xt.globalLog({log:t,engine:e})}catch(i){console.log("globalLog error",i),console.log(e,t),m4()}else console.log(e,t)}function U4(t,e,i,r){if(!bt(t))return{error:ie};Ni||(i=1);let n=Array.isArray(e)?e:[],a={},s=(o,l=0)=>{Object.keys(o).forEach(u=>{pa(o[u])?a[u]=o[u]:bt(o[u])&&(e===!0||n?.includes(u))&&(i===void 0||l<i)&&s(o[u],l+1)})};return s(t),r?g4(a):I4(a),{methods:a}}function mhe(t,e,i){return Object.keys(t).filter(r=>!e.includes(t[r])&&(!i||(Array.isArray(t[r])?t[r].length:!0)))}function Ve(t,e,i,r){if(typeof t!="object"||t===null)return t;Q1()?.enabled||(r=!0);let n=["",void 0,null];e&&n.push(!1);let a=mhe(t,n,i);return Object.assign({},...a.map(s=>Array.isArray(t[s])?{[s]:r?t[s]:t[s].map(o=>Ve(o))}:{[s]:r?t[s]:Ve(t[s])}))}function z({context:t,result:e,stack:i,info:r}){return e&&!Array.isArray(e?.stack)&&(e.stack=[]),e&&Array.isArray(e?.stack)&&typeof i=="string"&&e.stack.push(i),e&&r&&(e.info=r),e&&typeof t=="object"&&Object.keys(t).length&&(e.context||(e.context={}),Object.assign(e.context,Ve(t))),e&&!e?.error&&!e?.success&&Object.assign(e,{...H}),e??{success:!0}}var Hr="FEMALE",Vu="OTHER",ah="MIXED",er="MALE",XE={FEMALE_ABBR:"F",OTHER_ABBR:"O",MIXED_ABBR:"X",MALE_ABBR:"M",ANY_ABBR:"A",FEMALE:Hr,MIXED:ah,OTHER:Vu,MALE:er,ANY:"ANY"};function sp(t){return[Hr,"F"].includes(t)}function Wf(t){return[er,"M"].includes(t)}function Na(t){return[ah,"X"].includes(t)}function eu(t){return["ANY","A"].includes(t)}function on(t){if(t){if(sp(t))return Hr;if(Na(t))return ah;if(Wf(t))return er;if(eu(t))return"ANY"}return Vu}function il(t){return sp(t)||Wf(t)}var hhe="MIXED events can not contain mixed singles or { gender: ANY } collections",ghe="events with { gender: ANY } can not contain MIXED singles collections";function JE(t){let e="tieFormatGenderValidityCheck",{referenceGender:i,matchUpType:r,gender:n}=t;return i&&n&&il(i)&&on(i)!==on(n)?z({result:{valid:!1,error:My},context:{gender:n},stack:e}):Na(i)&&(eu(n)||Na(n)&&r!==$t)?z({result:{error:My,valid:!1},info:hhe,stack:e}):eu(i)&&Na(n)&&r!==$t?z({result:{error:My,valid:!1},info:ghe,stack:e}):{valid:!0}}var Ihe="normal",PH="timed",vhe="final",iF="NOAD",T4=["SET","HAL","QTR","PER","INN","RND","FRM","MAP","MAT"],D4="CONSECUTIVE",P4="TRADITIONAL",yhe={S:Ihe,F:vhe,G:"game"};function QE(t,e){if(bt(t)&&(t?.bestOf||t?.exactly)&&t?.setFormat)return whe(t,e)}function pb(t){return!Number.isNaN(Number(t))&&Number(t)}function E4(t){let e=`T${t.minutes}`;return t.based==="P"&&(e+="P"),t.tiebreakFormat?.tiebreakTo&&(e+=`/TB${t.tiebreakFormat.tiebreakTo}`),t.modifier&&(e+=`@${t.modifier}`),e}function bhe(t){let e=t?.deuceAfter?`${t.deuceAfter}D`:"";if(t?.type===P4)return`TN${e}`;if(t?.type===D4&&Number.isInteger(t.count))return`${t.count}C${e}`}function whe(t,e){let i=pb(t.bestOf)||void 0,r=pb(t.exactly)||void 0,n=i||r;if(t.setFormat?.timed&&t.simplified&&n===1)return E4(t.setFormat);let a=t.matchRoot||"SET",s=r&&r!==1?"X":"",o=t.aggregate?"A":"",l=n&&`${a}${n}${s}${o}`||"",u=EH(t.setFormat,e),c=u&&`S:${u}`||"",d=EH(t.finalSetFormat,e),p=n&&n>1&&d&&u!==d&&`F:${d}`||"",f=t.gameFormat?`G:${bhe(t.gameFormat)}`:"";if(l&&u)return[l,c,f,p].filter(Boolean).join("-")}function EH(t,e){if(typeof t=="object"&&Object.keys(t).length){if(t.timed)return E4(t);if(t.tiebreakSet)return RH(t.tiebreakSet);let i=pb(t.setTo);if(i){let r=t.NoAD&&iF||"",n=RH(t.tiebreakFormat),a=n&&`/${n}`||"",s=pb(t.tiebreakAt),o=s&&(s!==i||e)&&`@${s}`||"";if(n!==!1)return`${i}${r}${a}${o}`}}}function RH(t){if(t){if(typeof t=="object"&&!t.tiebreakTo)return"";if(typeof t=="object"&&pb(t.tiebreakTo)){let e=`TB${t.tiebreakTo}${t.NoAD?iF:""}`;return t.modifier&&(e+=`@${t.modifier}`),e}else return!1}}function zi(t){if(ri(t)){let e=t.startsWith("T")&&PH||T4.some(i=>t.startsWith(i))&&"SET"||"";if(e===PH){let i=M4(t),r={simplified:!0,setFormat:i,bestOf:1};if(i)return r}if(e==="SET")return The(t)}}function She(t){let e=T4.find(u=>t.startsWith(u));if(!e)return;let i=t.slice(e.length),r=/^(\d+)([A-Z]*)$/.exec(i);if(!r)return;let n=Kg(r[1]);if(!n)return;let a=r[2],s=!1,o=!1,l=[];for(let u of a)u==="X"?s=!0:u==="A"?o=!0:l.push(u);return{matchRoot:e,count:n,exactly:s,aggregate:o,matchMods:l}}function Uhe(t){let e=/^(.+?)(\d+D)$/.exec(t),i=e?e[1]:t,r=e?Number(e[2].slice(0,-1)):void 0;if(r!==void 0&&(r<1||!Number.isInteger(r)))return;if(i==="TN"){let a={type:P4};return r&&(a.deuceAfter=r),a}let n=/^([1-9]\d*)C$/.exec(i);if(n){let a={type:D4,count:Number(n[1])};return r&&(a.deuceAfter=r),a}}function The(t){let e=t.split("-"),i=She(e[0]);if(!i)return;let{matchRoot:r,count:n,exactly:a,aggregate:s,matchMods:o}=i,l=a&&n!==1?void 0:n,u=a&&n!==1?n:void 0,c,d,p,f=0,m=0,h=0;for(let v=1;v<e.length;v++){let w=e[v].indexOf(":");if(w<0)return;let y=e[v].slice(0,w),b=e[v].slice(w+1);if(!(y in yhe))return;if(y==="S"){if(f++,f>1)return;c=CH(e[v],b)}else if(y==="F"){if(m++,m>1)return;d=CH(e[v],b)}else if(y==="G"&&(h++,h>1||(p=Uhe(b),!p)))return}let g=c&&c.timed||d&&d.timed;if(r==="SET"&&!(l&&l<6||g&&u)||!c||!(!d||d))return;let I=Ve({setFormat:c,exactly:u,bestOf:l});return r!=="SET"&&(I.matchRoot=r),s&&(I.aggregate=!0),o.length>0&&(I.matchMods=o),d&&(I.finalSetFormat=d),p&&(I.gameFormat=p),I}function CH(t,e){return e.startsWith("TB")?Dhe(e):e.startsWith("T")?M4(e):Phe(t,e)}function Dhe(t){let e=C4(t);return e===!1?!1:typeof e=="object"?{tiebreakSet:e}:void 0}function Phe(t,e){let i=/^[FS]:(\d+)([A-Za-z]*)/.exec(t),r=i&&N4(i[2])||!1,n=!i?.[2]||r,a=i?Kg(i[1]):void 0,s=R4(e),o=s!==!1,l=o&&s||a,u=C4(e.split("/")[1]);return!a||!n||u===!1||!o?!1:Ehe(a,r,u,l)}function Ehe(t,e,i,r){let n={setTo:t};return e&&(n.NoAD=!0),i?(n.tiebreakFormat=i,n.tiebreakAt=r):n.noTiebreak=!0,n}function R4(t,e=!0){let i=t?.indexOf("@")>0&&t.split("@");if(i)return(e?Kg(i[1]):i[1])||!1}function C4(t){if(t)return t.startsWith("TB")?Rhe(t):!1}function Rhe(t){let e=R4(t,!1),i=/^TB(\d+)([A-Za-z]*)/.exec(t),r=i?.[1],n=i&&N4(i[2]),a=!i?.[2]||n,s=Kg(r);if(!s||!a)return!1;let o={tiebreakTo:s};return e&&typeof e=="string"&&!ot(e)&&(o.modifier=e),n&&(o.NoAD=!0),o}function M4(t){let e=t.slice(1),i=/^(\d+)([PG])?(?:\/TB(\d+))?(@[A-Za-z]+)?$/.exec(e),r=Kg(i?.[1]);if(!r)return;let n={timed:!0,minutes:r},a=i?.[2];a==="P"?n.based="P":a==="G"&&(n.based="G");let s=i?.[3];if(s){let u=Kg(s);u&&(n.tiebreakFormat={tiebreakTo:u})}let o=i?.[4],l=[void 0,"P","G",""].includes(o);if(o&&!l){let u=/^(\d+)([PGA])?(?:\/TB\d+)?(@)([A-Za-z]+)$/.exec(e)?.[4];return u?(n.modifier=u,n):void 0}return o&&(n.based=o),n}function N4(t){return t?.includes(iF)}function Kg(t){let e=Number(t);return Number.isNaN(e)?0:e}function Che(t){return t.replaceAll(/T(\d+)G(?=\/TB|@|-|$)/g,"T$1")}function xa({matchUpFormat:t}){if(!ri(t)||t==="")return!1;let e=zi(t),i=/-S:(\d+)\/TB(\d{1,2})@?(\d?)/.exec(t),r=i?.[1],n=i?.[2],a=i?.[3],s=/-F:(\d+)\/TB(\d{1,2})@?(\d?)/.exec(t),o=s?.[1],l=s?.[2],u=s?.[3];return QE(e,!!(i&&n&&r===a||s&&l&&o===u))===Che(t)}var MD=/^\d{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2]\d|3[0-1])$/,A4=/^((0\d|1\d|2[0-3]):[0-5]\d(:[0-5]\d)?)([.,]\d{3})?$/,rl=/^(\d{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2]\d|3[0-1]))([ T](0\d|1\d|2[0-3]):[0-5]\d(:[0-5]\d)?)?([.,]\d{3})?Z?$/,op=/^(\d{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2]\d|3[0-1]))?([ T]?(0\d|1\d|2[0-3]):[0-5]\d(:[0-5]\d)?)?([.,]\d{3})?Z?$/;function ND(t){let{scheduledDate:e}=t;if(!e&&t.scheduledTime&&(e=Qe(t.scheduledTime)),!e)return;let i=ci(t.scheduledTime),r=Qe(e);return r&&i&&(r+=`T${i}`),r}function Mhe(t){return typeof t!="object"||Array.isArray(t)?!1:Object.prototype.toString.call(t)==="[object Date]"}function ZI(t){let e=typeof t=="string"?t?.split(" "):[];if(t&&e?.length>1&&!["AM","PM"].includes(e[1].toUpperCase()))return!1;let i=sh(t,!0,!0);return!!(!t||i&&op.test(i))}function Pn(t){return ac(t)||MD.test(t)}function Nhe(t){let e=new Date(t),i=e.getSeconds()+60*e.getMinutes()+3600*e.getHours();return Ahe(i,{displaySeconds:!1})}function Ahe(t,e){let i=Number.parseInt(t,10),r=Math.floor(i/3600),n=Math.floor((i-r*3600)/60),a=i-r*3600-n*60;return(!e||e?.displaySeconds?r+":"+n+":"+a:r+":"+n).split(":").map(rs).join(":")}var rF=t=>{let e=fb(t)||ac(t)?new Date(t):new Date,i=e.getUTCMonth()+1,r=i<10?`0${i}`:`${i}`;return`${e.getUTCFullYear()}-${rs(r)}-${rs(e.getUTCDate())}`};function khe(t){let e=fb(t)||ac(t)?new Date(t):new Date;return Date.UTC(e.getFullYear(),e.getMonth(),e.getDate())}function Os(t,e="-",i="YMD"){if(!t)return"";typeof t=="string"&&!t.includes("T")&&(t=t+"T00:00");let r=new Date(t),n=""+(r.getMonth()+1),a=""+r.getDate(),s=r.getFullYear();return n.length<2&&(n="0"+n),a.length<2&&(a="0"+a),i==="DMY"?[a,n,s].join(e):i==="MDY"?[n,a,s].join(e):i==="YDM"?[s,a,n].join(e):i==="DYM"?[a,s,n].join(e):i==="MYD"?[n,s,a].join(e):[s,n,a].join(e)}function AD(t){let e=t?new Date(t):new Date,i=e.getTimezoneOffset();return new Date(e.getTime()-i*60*1e3)}function Ohe(t){return AD(t).getTime()}function fb(t){if(typeof t=="boolean")return!1;let e=t instanceof Date&&t||!Number.isNaN(Number(t))&&new Date(t)||!1;return e&&!Number.isNaN(Number(e.valueOf()))}function xhe(t,e){return t<=e}function Xg(t,e){if(!Pn(t)||!Pn(e))return[];let i=Qe(t)+"T00:00",r=Qe(e)+"T00:00",n=new Date(i),a=new Date(r),s=fb(a)&&fb(n)&&xhe(n,a),o=[],l=0;if(s){let u=n,c=u.getTime();for(;c<=a.getTime()&&l<300;)l+=1,o.push(new Date(u)),c=u.setDate(u.getDate()+1)}return o.map(u=>Os(u))}var Fhe=/^([+-]?\d{4}(?!\d{2}\b))((-?)((0[1-9]|1[0-2])(\3([12]\d|0[1-9]|3[01]))?|W([0-4]\d|5[0-2])(-?[1-7])?|(00[1-9]|0[1-9]\d|[12]\d{2}|3([0-5]\d|6[1-6])))([T\s]((([01]\d|2[0-3])((:?)[0-5]\d)?|24:?00)([.,]\d+(?!:))?)?(\17[0-5]\d([.,]\d+)?)?([zZ]|([+-])([01]\d|2[0-3]):?([0-5]\d)?)?)?)?$/;function ac(t){return typeof t!="string"?!1:Fhe.test(t)}function td(t){return typeof t!="string"||!ac(t)?!1:/([zZ]|[+-]\d{2}:?\d{2})$/.test(t)}function nF(t){if(typeof t!="string")return!1;let e=t.split("Z")[0].split(":"),i=e.every(r=>!Number.isNaN(Number.parseInt(r)));return!(e.length<2||!i||Number.parseInt(e[0])>23||Number.parseInt(e[1])>60)}function Pt(t){let e=ci(t);if(!e)return 0;let[i,r]=e.split(":").map(n=>Number.parseInt(n));return i*60+r}function Lhe(t){let e=Math.floor(t/60),i=t-e*60;return e>23&&(e=e%24),[rs(e),rs(i)].join(":")}function kD(t){return nF(t)?t.split(":").slice(0,2).map(rs).join(":"):void 0}function ci(t){return ac(t)&&t.indexOf("T")>0?kD(t.split("T").reverse()[0]):kD(t)}function Qe(t){return ac(t)||rl.test(t)?t.split("T")[0]:""}function yy(t,e){let i=new Date(t);return i.setDate(i.getDate()+e),Qe(i.toISOString())}function OD(t){t=typeof t=="string"?t:"00:00";let e={},i={};return{0:e.time,1:e.ampm}=t.split(" ")||[],{0:i.hours,1:i.minutes}=e.time.split(":")||[],i.ampm=e.ampm,Number.isNaN(Number.parseInt(i.hours))||Number.isNaN(Number.parseInt(i.minutes))||i.ampm&&!["AM","PM"].includes(i.ampm.toUpperCase())?{}:i}function _he(t){let e=OD(t);return e.ampm&&e.hours&&(e.ampm.toLowerCase()==="pm"&&Number.parseInt(e.hours)<12&&(e.hours=(e.hours&&Number.parseInt(e.hours)||0)+12),e.ampm.toLowerCase()==="am"&&e.hours==="12"&&(e.hours="00")),`${e.hours||"12"}:${e.minutes||"00"}`.split(":").map(rs).join(":")}function $he(t){let e=OD(t);if(!(typeof e=="object"&&!Object.keys(e).length))return e.ampm?t:(e.hours>12?(e.hours-=12,e.ampm="PM"):e.hours==="12"?e.ampm="PM":(e.hours==="00"&&(e.hours="12"),e.ampm="AM"),e.hours?.[0]==="0"&&(e.hours=e.hours.slice(1)),`${e.hours||"12"}:${e.minutes||"00"} ${e.ampm}`)}function sh(t,e,i){let r=Qe(t),n=ci(t),a=r?n:t;return t?e&&(r&&i&&t||_he(a))||$he(a):void 0}function k4(t,e){let i=OD(t),r=OD(e);if(Number.parseInt(i.hours)<Number.parseInt(r.hours))return-1;if(Number.parseInt(i.hours)>Number.parseInt(r.hours))return 1;if(i.hours===r.hours){if(Number.parseInt(i.minutes)<Number.parseInt(r.minutes))return-1;if(Number.parseInt(i.minutes)>Number.parseInt(r.minutes))return 1}return 0}function aF(t,e=7){let i=Qe(t)+"T00:00",r=new Date(i),n=new Date(r.setDate(r.getDate()+e));return Os(n)}function Bhe(t){return aF(t)}function Vhe(t,e,i,r=!1){let n=new Date(e,0,1+(t-1)*7),a=r?0:1;return n.setDate(n.getDate()+(a-n.getDay())),Os(n,i)}function jhe(t,e,i){let r=new Date(t,0);return Os(new Date(r.setDate(e)),i)}function Xi(t,e=void 0){let[i,r]=(t||"00:00").split(":").map(rs),n=AD(e).setHours(i,r,0,0);return AD(n)}function kw(t,e,i=!0){let r=new Date(t),n=(new Date(e).getTime()-r.getTime())/1e3/60;return i?Math.abs(Math.round(n)):Math.round(n)}function Xn(t,e){let i=ci(t);if(!i)return"00:00";let r=Number.isNaN(e)?0:e;return ci(sF(Xi(i),r).toISOString())||"00:00"}function sF(t,e){let i=new Date(t);return new Date(i.getTime()+e*6e4)}function rs(t){return t.toString()[1]?t:"0"+t}function tu(t,e){let i=new Date(t),r=new Date(e);return i.getFullYear()===r.getFullYear()&&i.getMonth()===r.getMonth()&&i.getDate()===r.getDate()}var O4={addDays:aF,addWeek:Bhe,addMinutesToTimeString:Xn,convertTime:sh,getIsoDateString:ND,getUTCdateString:rF,DateHHMM:Nhe,extractDate:Qe,extractTime:ci,formatDate:Os,getDateByWeek:Vhe,isISODateString:ac,isValidEmbargoDate:td,isDate:fb,isTimeString:nF,offsetDate:AD,offsetTime:Ohe,sameDay:tu,timeStringMinutes:Pt,timeToDate:Xi,timeUTC:khe,validTimeValue:ZI,validDateString:MD,timeValidation:op,dateValidation:rl},Ghe=(t,e)=>t.filter(Boolean).every(i=>typeof i===e),Hhe=t=>t.filter(Boolean).every(Ni);function rg(t,e){return`${t}-${e}`}function Up(t){let e=t.category;if(typeof e!="object"||!e)return{error:lb};let{ageCategoryCode:i,ageMaxDate:r,ageMinDate:n,ageMax:a,ageMin:s}=e,o=e.categoryName,l;if(!(Ghe([i,r,n,o],"string")&&Hhe([a,s])&&[r,n].filter(Boolean).every(Pn)))return{error:lb};let u=t.consideredDate??Qe(new Date().toLocaleDateString("sv"));if(!u||!Pn(u))return{error:sr};let[c]=u.split("-").slice(0,3).map(L=>Number.parseInt(L)),d=yy(u,-1);if(!d)return{error:sr};let[p,f]=d.split("-").slice(1,3).map(L=>Number.parseInt(L)),m=`${rs(p)}-${rs(f)}`,h=yy(u,1);if(!h)return{error:sr};let[g,I]=h.split("-").slice(1,3).map(L=>Number.parseInt(L)),v=`${rs(g)}-${rs(I)}`,w=s&&yy(u,-1*365*s),y=a&&yy(u,-1*365*a),b=[],S=L=>!b.includes(L)&&b.push(L);i=i??o;let U=/^([UO]?)(\d{1,2})([UO]?)$/,T=/^C(\d{1,2})-(\d{1,2})$/,P=i?.includes("-"),D=P&&i?.match(T),E=i?.match(U);function R(L){let $=c-L,V=rg($,v);e.ageMinDate&&e.ageMinDate!==V&&S(`Invalid submitted ageMinDate: ${n}`),n=V,i&&(e.ageMax&&e.ageMax!==L-1&&(S(`Invalid submitted ageMax: ${a}`),y=void 0),a=L-1)}function C(L){let $=c-L-1,V=rg($,v);e.ageMin&&e.ageMin>L&&S(`Invalid submitted ageMin: ${s}`),e.ageMax&&e.ageMax>L&&S(`Invalid submitted ageMax: ${a}`),e.ageMinDate&&e.ageMinDate!==V&&S(`Invalid submitted ageMinDate: ${n}`),n=V,i&&(e.ageMax&&e.ageMax!==L&&(S(`Invalid submitted ageMax: ${a}`),w=void 0),a=L)}function M(L){let $=c-L,V=rg($,m);e.ageMaxDate&&e.ageMaxDate!==V&&S(`Invalid submitted ageMaxDate: ${r}`),r=V,i&&(e.ageMin&&e.ageMin!==L+1&&(S(`Invalid submitted ageMin: ${s}`),w=void 0),s=L+1)}function N(L){let $=c-L-1,V=rg($,m);e.ageMaxDate&&e.ageMaxDate!==V&&S(`Invalid submitted ageMaxDate: ${r}`),r=V,i&&(e.ageMin&&e.ageMin!==L&&(S(`Invalid submitted ageMin: ${s}`),w=void 0),s=L)}function A(L){let $=U.exec(L)||[],[V,_,B]=$.slice(1),G=Number.parseInt(_);V==="U"?(e.ageMaxDate&&e.ageMaxDate!==r&&S(`Invalid submitted ageMaxDate: ${e.ageMaxDate}`),R(G)):V==="O"&&M(G),B==="U"?(e.ageMaxDate&&e.ageMaxDate!==r&&S(`Invalid submitted ageMaxDate: ${e.ageMaxDate}`),C(G)):B==="O"&&N(G),r=(r??w)||void 0,n=(n??y)||void 0}function O(){if(r=void 0,n=void 0,a=void 0,s=void 0,e.ageMin){let V=c-e.ageMin;r=rg(V,m)}if(e.ageMax){let V=c-e.ageMax-1;n=rg(V,v)}let[L,$]=(i?.match(T)??[]).slice(1).map(V=>Number.parseInt(V));L<=$?(s=L,a=$,l=!0):S(`Invalid combined age range ${i}`)}function k(){s&&M(s),a&&C(a)}function F(){D?O():P?i?.split("-").forEach(A):E&&i?A(i):k()}F(),a&&e?.ageMin&&e?.ageMin>a&&(S(`Invalid submitted ageMin: ${e?.ageMin}`),s=void 0);let x=Ve({consideredDate:u,combinedAge:l,ageMaxDate:r,ageMinDate:n,ageMax:a,ageMin:s});return b.length&&(x.errors=b),x}function mb({category:t}){if(!bt(t))return{error:ie};let e=Up({category:t});if(e.error)return{error:e};let{ratingMax:i,ratingMin:r}=t;return i&&!Ni(i)?z({result:{error:ie},context:{ratingMax:i}}):r&&!Ni(r)?z({result:{error:ie},context:{ratingMin:r}}):{...e}}function Ow({childCategory:t,withDetails:e,category:i}){let r=mb({category:i}),n=mb({category:t}),a=n.ageMin&&(r.ageMin&&n.ageMin<r.ageMin||r.ageMax&&n.ageMin>r.ageMax),s=n.ageMax&&(r.ageMax&&n.ageMax>r.ageMax||r.ageMin&&n.ageMax<r.ageMin),o=n.ageMinDate&&r.ageMaxDate&&new Date(n.ageMinDate)>new Date(r.ageMaxDate),l=n.ageMaxDate&&r.ageMinDate&&new Date(n.ageMaxDate)<new Date(r.ageMinDate),u=i?.ratingType&&t?.ratingType&&i.ratingType===t.ratingType&&(i.ratingMin&&t.ratingMin&&t.ratingMin<i.ratingMin||i.ratingMax&&t.ratingMax&&t.ratingMax>i.ratingMax||i.ratingMin&&t.ratingMax&&t.ratingMax<i.ratingMin||i.ratingMax&&t.ratingMin&&t.ratingMin>i.ratingMax),c=i?.ballType&&t?.ballType&&i.ballType!==t.ballType,d=Ve({invalidRatingRange:u,invalidAgeMinDate:o,invalidAgeMaxDate:l,invalidBallType:c,invalidAgeMax:s,invalidAgeMin:a,valid:!u&&!o&&!l&&!c&&!s&&!a},!0);return e&&Object.assign(d,{categoryDetails:r,childCategoryDetails:n}),d}function xw({checkCategory:t=!0,collectionDefinition:e,checkCollectionIds:i,checkGender:r=!0,referenceCategory:n,referenceGender:a,event:s}){a=a??s?.gender;let o="validateCollectionDefinition",l=[];if(typeof e!="object")return l.push(`collectionDefinition must be an object: ${e}`),z({result:{errors:l,error:Nc},stack:o});let{collectionValueProfiles:u,collectionGroupNumber:c,collectionValue:d,collectionId:p,matchUpCount:f,matchUpFormat:m,matchUpValue:h,matchUpType:g,scoreValue:I,setValue:v,category:w,gender:y}=e;if(i&&typeof p!="string"&&l.push(`collectionId is not type string: ${p}`),typeof f!="number"&&l.push(`matchUpCount is not type number: ${f}`),g&&!Zf([Wt,$t],g)&&l.push(`matchUpType must be SINGLES or DOUBLES: ${g}`),[!!u?.length].concat([h,d,I,v].map(ot)).filter(Boolean).length!==1&&l.push("Missing value definition for matchUps: matchUpValue, collectionValue, or collectionValueProfiles"),h&&typeof h!="number"&&l.push(`matchUpValue is not type number: ${h}`),d&&typeof d!="number"&&l.push(`collectionValue is not type number: ${d}`),u&&f){let b=JY({collectionValueProfiles:u,matchUpCount:f});b.errors&&l.push(...b.errors)}if(c&&typeof c!="number"&&l.push(`collectionGroupNumber is not type number: ${d}`),m&&!xa({matchUpFormat:m})&&l.push(`Invalid matchUpFormat: ${m}`),r){let b=JE({referenceGender:a,matchUpType:g,gender:y});if(b.error)return z({context:{referenceGender:a,gender:y},result:b,stack:o})}if(t&&n&&w){let b=Ow({category:n,childCategory:w});if(!b.valid)return z({result:{error:lb},context:b,stack:o})}return l.length?z({result:{errors:l,error:a4},stack:o}):{valid:!0}}function Bn(t){let e=!!(t?.enforceCategory!==!1&&t?.category),i=!!(t?.enforceGender!==!1&&t?.gender),r=t?.checkCollectionIds,n=t?.tieFormat,a=t?.event,s="validateTieFormat",o=[],l=Whe({...t,stack:s});if(l?.error)return l;let u,c=n.collectionDefinitions.every(g=>{let{setValue:I,scoreValue:v,collectionValue:w}=g;(I||v)&&!w&&(u=!0);let{valid:y,errors:b}=xw({referenceCategory:t.category,referenceGender:t.gender,collectionDefinition:g,checkCollectionIds:r,checkCategory:e,checkGender:i,event:a});return y?!0:(Array.isArray(b)&&o.push(...b),!1)}),d=typeof n.winCriteria?.valueGoal=="number"&&n.winCriteria?.valueGoal>0&&!u||n.winCriteria?.aggregateValue;if(!(d||n.winCriteria?.aggregateValue))return u?o.push("aggregateValue is required"):o.push("Either non-zero valueGoal, or { aggregateValue: true } must be specified in winCriteria"),z({context:{tieFormat:n,errors:o,aggregateValueImperative:u},result:{error:Vl},stack:s});let p=n.collectionDefinitions.map(({collectionId:g})=>g),f=!r||p.length===rt(p).length,m=c&&d&&f;return m?{valid:m,errors:o}:z({result:{error:Vl},context:{tieFormat:n,errors:o},stack:s})}function Whe(t){let{tieFormat:e,stack:i}=t;return!t||!e||!bt(e)?z({result:{error:Vl},context:{tieFormat:e,message:"tieformat must be an object"},stack:i}):bt(e.winCriteria)?Array.isArray(e.collectionDefinitions)?{...H}:z({result:{error:Vl},context:{tieFormat:e,message:"collectionDefinitions must be an array"},stack:i}):z({result:{error:Vl},context:{tieFormat:e,message:"tieformat.winCritiera must be an object"},stack:i})}var xD="resourceSubType",FD="resourceType",Jg="identifier",eO="name",zhe={RESOURCE_SUB_TYPE:xD,RESOURCE_TYPE:FD,IDENTIFIER:Jg,NAME:eO};function ke(t,e,i,r,n=0){if(Zk().makeDeepCopy)return Zk().makeDeepCopy(t,e,i,r);let a=Q1(),{stringify:s,toJSON:o,ignore:l,modulate:u}=a||{};if(!a?.enabled&&!i||typeof t!="object"||pa(t)||t===null||typeof a?.threshold=="number"&&n>=a.threshold)return t;let c=Array.isArray(t)?[]:{},d=Object.keys(t).filter(f=>!i||!l||Array.isArray(l)&&!l.includes(f)||pa(l)&&!l(f)),p=(f,m)=>{c[f]=pa(m?.toString)?m.toString():JSON.stringify(m)};for(let f of d){let m=t[f],h=pa(u)?u(m):void 0;if(h!==void 0)c[f]=h;else if(e&&f==="extensions"&&Array.isArray(m)){let g=oF(m);Object.assign(c,...g)}else r&&f==="extensions"?c[f]=[]:Array.isArray(s)&&s.includes(f)?p(f,m):Array.isArray(o)&&o.includes(f)&&pa(m?.toJSON)?c[f]=m.toJSON():m===null?c[f]=void 0:Mhe(m)?c[f]=new Date(m).toISOString():c[f]=ke(m,e,i,r,n+1)}return c}function oF(t){return t?.map(e=>{let{name:i,value:r}=e;return i&&r&&{[`_${i}`]:r}}).filter(Boolean)}function x4(t=1,e){return Re(0,t).map(()=>Et(e))}function Et(t){let e=[];for(let o=0;o<256;o++)e[o]=(o<16?"0":"")+o.toString(16);let i=Math.trunc(Math.random()*4294967295),r=Math.trunc(Math.random()*4294967295),n=Math.trunc(Math.random()*4294967295),a=Math.trunc(Math.random()*4294967295),s=e[i&255]+e[i>>8&255]+e[i>>16&255]+e[i>>24&255]+"-"+e[r&255]+e[r>>8&255]+"-"+e[r>>16&15|64]+e[r>>24&255]+"-"+e[n&63|128]+e[n>>8&255]+"-"+e[n>>16&255]+e[n>>24&255]+e[a&255]+e[a>>8&255]+e[a>>16&255]+e[a>>24&255];return typeof t=="string"?`${t}_${s.replaceAll("-","")}`:s}var F4={collectionDefinitions:[{collectionName:"Male Singles",matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpCount:4,matchUpValue:1,gender:"MALE"},{collectionName:"Female Singles",matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:4,matchUpValue:1},{collectionName:"Male Doubles",matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpCount:2,matchUpValue:1,gender:"MALE"},{collectionName:"Female Doubles",matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:2,matchUpValue:1},{collectionName:"Mixed Doubles",matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpCount:4,matchUpValue:1,gender:"MIXED"}],tieFormatName:"USTA_GOLD_TEAM_CHALLENGE",winCriteria:{valueGoal:9}},L4={collectionDefinitions:[{collectionName:"Round 1",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Round 2",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Round 3",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"Doubles Shuffle",unrestrictedSelections:!0,winCriteria:{aggregateValue:!0}},_4={collectionDefinitions:[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_SOUTHERN_LEVEL_5",winCriteria:{valueGoal:8}},$4={collectionDefinitions:[{category:{ageCategoryCode:"16U"},collectionName:"16U Singles",matchUpCount:4,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Singles",matchUpCount:4,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Doubles",matchUpCount:2,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Doubles",matchUpCount:2,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Tiebreak Doubles",matchUpCount:1,matchUpFormat:"SET1-S:TB10",matchUpType:"DOUBLES",matchUpValue:1,processCodes:["RANKING.IGNORE"]}],tieFormatName:"USTA_SECTION_BATTLE",winCriteria:{valueGoal:9}},B4={collectionDefinitions:[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_INTERSECTIONAL",winCriteria:{valueGoal:8}},V4={collectionDefinitions:[{scoreValue:1,matchUpType:"SINGLES",collectionName:"Men's Singles",matchUpFormat:"SET1-S:T60",gender:"MALE",matchUpCount:1},{scoreValue:1,matchUpType:"SINGLES",collectionName:"Women's Singles",matchUpFormat:"SET1-S:T60",gender:"FEMALE",matchUpCount:1},{matchUpValue:1,matchUpType:"DOUBLES",collectionName:"Mixed Doubles",matchUpFormat:"SET1-S:T60",gender:"MIXED",matchUpCount:1}],tieFormatName:"Time Tennis Pro Circuit",winCriteria:{aggregateValue:!0}},j4={collectionDefinitions:[{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"DOMINANT_DUO_MIXED",winCriteria:{valueGoal:2}},G4={collectionDefinitions:[{scoreValue:1,matchUpType:"SINGLES",collectionName:"Men's Singles",matchUpFormat:"SET1-S:T60",gender:"MALE",matchUpCount:3},{scoreValue:1,matchUpType:"SINGLES",collectionName:"Women's Singles",matchUpFormat:"SET1-S:T60",gender:"FEMALE",matchUpCount:3},{scoreValue:1,matchUpType:"DOUBLES",collectionName:"Men's Doubles",matchUpFormat:"SET1-S:T60",gender:"MALE",matchUpCount:1},{matchUpValue:1,matchUpType:"DOUBLES",collectionName:"Women's Doubles",matchUpFormat:"SET1-S:T60",gender:"FEMALE",matchUpCount:1},{matchUpValue:1,matchUpType:"DOUBLES",collectionName:"Mixed Doubles",matchUpFormat:"SET1-S:T60",gender:"MIXED",matchUpCount:1}],tieFormatName:"Time Tennis Dual",winCriteria:{aggregateValue:!0}},H4={collectionDefinitions:[{category:{ageCategoryCode:"14U"},collectionName:"14U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],collectionGroups:[{groupNumber:1,groupName:"Doubles",groupValue:1,winCriteria:{valueGoal:2}}],tieFormatName:"USTA_BREWER_CUP",winCriteria:{valueGoal:4}},W4={winCriteria:{valueGoal:23},tieFormatName:"USTA_OZAKI_CUP",collectionDefinitions:[{category:{ageCategoryCode:"18U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"18U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"18U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"18U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"18U"},collectionName:"18U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"16U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"16U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"16U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"16U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"16U"},collectionName:"16U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"14U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"14U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"14U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"14U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"14U"},collectionName:"14U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"12U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"12U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"12U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"12U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"12U"},collectionName:"12U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"12U"},collectionName:"12U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"12U"},collectionName:"12U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1}]},Xu="SET3-S:6/TB7",qhe="SET3-S:6/TB7-F:TB10",z4={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"DOMINANT_DUO",winCriteria:{valueGoal:2}},q4={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",collectionValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"USTA_COLLEGE",winCriteria:{valueGoal:4}},Y4={collectionDefinitions:[{collectionName:"Male Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_LEVEL_1",winCriteria:{valueGoal:10}},K4={collectionDefinitions:[{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Overtime",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"USTA_WTT_ITT",winCriteria:{aggregateValue:!0}},X4={collectionDefinitions:[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_ZONAL",winCriteria:{valueGoal:10}},J4={collectionDefinitions:[{collectionGroupNumber:1,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:1},{collectionGroupNumber:1,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:1},{collectionGroupNumber:2,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:2},{collectionGroupNumber:2,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:2},{collectionGroupNumber:3,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:3},{collectionGroupNumber:3,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:3}],collectionGroups:[{groupNumber:1,groupName:"Day 1"},{groupNumber:2,groupName:"Day 2"},{groupNumber:3,groupName:"Day 3"}],tieFormatName:"LAVER_CUP",winCriteria:{valueGoal:13}},Q4={collectionDefinitions:[{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Overtime",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"USTA_TOC",winCriteria:{aggregateValue:!0}},LD="COLLEGE_DEFAULT",tO="COLLEGE_JUCO",iO="COLLEGE_D3",Z4="DOMINANT_DUO",e5="DOMINANT_DUO_MIXED",t5="LAVER_CUP",i5="TEAM_DOUBLES_3_AGGREGATION",r5="TIME_TENNIS_DUAL",n5="TIME_TENNIS_PRO_CIRCUIT",a5="USTA_BREWER_CUP",s5="USTA_OZAKI_CUP",o5="USTA_COLLEGE",l5="USTA_GOLD_TEAM_CHALLENGE",u5="USTA_LEVEL_1",c5="USTA_INTERSECTIONAL",d5="USTA_SECTION_BATTLE",p5="USTA_SOUTHERN_LEVEL_5",f5="USTA_TOC",m5="USTA_WTT_ITT",h5="USTA_ZONAL",Yhe={COLLEGE_D3:iO,COLLEGE_DEFAULT:LD,COLLEGE_JUCO:tO,DOMINANT_DUO:Z4,DOMINANT_DUO_MIXED:e5,LAVER_CUP:t5,TEAM_DOUBLES_3_AGGREGATION:i5,TIME_TENNIS_DUAL:r5,TIME_TENNIS_PRO_CIRCUIT:n5,USTA_BREWER_CUP:a5,USTA_OZAKI_CUP:s5,USTA_COLLEGE:o5,USTA_GOLD_TEAM_CHALLENGE:l5,USTA_INTERSECTIONAL:c5,USTA_LEVEL_1:u5,USTA_SECTION_BATTLE:d5,USTA_SOUTHERN_LEVEL_5:p5,USTA_TOC:f5,USTA_WTT_ITT:m5,USTA_ZONAL:h5},g5="STANDARD",MH={[g5]:{hydrate:!0,doubles:{matchUpCount:3,matchUpValue:1},singles:{matchUpCount:6,matchUpValue:1},valueGoal:5},[iO]:{hydrate:!0,doubles:{matchUpFormat:"SET1-S:8/TB7@7",matchUpCount:3,matchUpValue:1},singles:{matchUpFormat:Xu,matchUpCount:6,matchUpValue:1},tieFormatName:iO,valueGoal:5},[LD]:{hydrate:!0,doubles:{matchUpFormat:"SET1-S:6/TB7",collectionValue:1,matchUpCount:3},singles:{matchUpFormat:Xu,matchUpCount:6,matchUpValue:1},tieFormatName:LD,valueGoal:4},[tO]:{hydrate:!0,doubles:{matchUpFormat:"SET1-S:8/TB7",matchUpCount:3,matchUpValue:1},singles:{matchUpFormat:Xu,matchUpCount:6,matchUpValue:1},tieFormatName:tO,valueGoal:5},[t5]:J4,[Z4]:z4,[e5]:j4,[i5]:L4,[r5]:G4,[n5]:V4,[a5]:H4,[s5]:W4,[o5]:q4,[l5]:F4,[c5]:B4,[u5]:Y4,[d5]:$4,[p5]:_4,[m5]:K4,[f5]:Q4,[h5]:X4},Khe=t=>{let e=t?.namedFormat&&Object.keys(MH).includes(t.namedFormat)?t.namedFormat:g5,i=Array.isArray(t?.uuids)?t?.uuids:[],r,{category:n,gender:a}=t?.event??{},s=ke(MH[e],!1,!0),o=l=>{if(!t?.isMock&&!t?.event?.isMock||!t.event)return i?.pop()??Et();let u=t?.event?.eventId;return i.pop()??`${u}-COL-${l+1}`};return s.hydrate?(r={winCriteria:{valueGoal:s.valueGoal},collectionDefinitions:[{collectionId:o(0),matchUpFormat:qhe,collectionName:"Doubles",matchUpType:$t,...s.doubles},{collectionId:o(1),matchUpFormat:Xu,collectionName:"Singles",matchUpType:Wt,...s.singles}]},s.tieFormatName&&(r.tieFormatName=s.tieFormatName)):(s.collectionDefinitions.forEach((l,u)=>l.collectionId=o(u)),r=s),t?.hydrateCollections&&r.collectionDefinitions.forEach(l=>{n&&!l.category&&(l.category=n),a&&!l.gender&&(l.gender=a)}),r},sc=Khe,nl="SINGLES",Dm="SINGLES",ls="DOUBLES",oc="DOUBLES",rr="TEAM",ya="TEAM",Xhe="RATING",Jhe="BOTH",I5={AGE:"AGE",BOTH:Jhe,DOUBLES:ls,DOUBLES_EVENT:oc,RATING:Xhe,SINGLES:nl,SINGLES_EVENT:Dm,TEAM_EVENT:ya,TEAM:rr},xe="MAIN",We="QUALIFYING",Zr="CONSOLATION",Pr="VOLUNTARY_CONSOLATION",Ui="PLAY_OFF",ZE=[xe,We,Zr,Ui,Pr],Pm={[We]:1,[xe]:2,[Ui]:3,[Zr]:3,[Pr]:4},v5="finishingPositions",y5="aggregateEventStructures",b5={[xe]:1,[Ui]:2,[Zr]:3,[We]:4,[Pr]:5},Qhe={[Ui]:1,[xe]:2,[Zr]:3,[We]:4,[Pr]:5},eR="CLUSTER",tR="ADJACENT",w5="SEPARATE",Tp="WATERFALL",iR="ITEM",fn="CONTAINER",Cs="DRAW",rR="RANDOM",Ms="TOP_DOWN",Dp="BOTTOM_UP",iu="POSITION",ru="WINNER",nu="LOSER",al="FIRST_MATCHUP",ra="AD_HOC",Zhe="AD_HOC",ev="FEED_IN",Qg="COMPASS",Zg="OLYMPIC",ege="SINGLE_ELIMINATION",Yo="SINGLE_ELIMINATION",Fw="DOUBLE_ELIMINATION",eI="FIRST_MATCH_LOSER_CONSOLATION",Lw="FIRST_ROUND_LOSER_CONSOLATION",tf="LUCKY_DRAW",nR="CURTIS_CONSOLATION",tge="CURTIS_CONSOLATION",lF="FEED_IN_CHAMPIONSHIP_TO_SF",hb="FEED_IN_CHAMPIONSHIP_TO_SF",uF="FEED_IN_CHAMPIONSHIP_TO_QF",gb="FEED_IN_CHAMPIONSHIP_TO_QF",cF="FEED_IN_CHAMPIONSHIP_TO_R16",Ib="FEED_IN_CHAMPIONSHIP_TO_R16",S5="MODIFIED_FEED_IN_CHAMPIONSHIP",vb="MODIFIED_FEED_IN_CHAMPIONSHIP",_w="FEED_IN_CHAMPIONSHIP",ige="DOUBLE_ROUND_ROBIN",Ks="ROUND_ROBIN",au="ROUND_ROBIN_WITH_PLAYOFF",U5="DECIDER",T5="BACKDRAW",dF={0:{name:"East",abbreviation:"E"},"0-1":{name:"West",abbreviation:"W"},"0-2":{name:"North",abbreviation:"N"},"0-3":{name:"Northeast",abbreviation:"NE"},"0-1-1":{name:"South",abbreviation:"S"},"0-1-2":{name:"Southwest",abbreviation:"SW"},"0-2-1":{name:"Northwest",abbreviation:"NW"},"0-1-1-1":{name:"Southeast",abbreviation:"SE"}},pF={0:{name:"East",abbreviation:"E"},"0-1":{name:"West",abbreviation:"W"},"0-2":{name:"North",abbreviation:"N"},"0-1-1":{name:"South",abbreviation:"S"}},Pp="WIN_RATIO",oh="ROUND_OUTCOME",D5=[Qg,nR,gb,Ib,hb,_w,uF,cF,lF,eI,Lw,tf,vb,Zg,Ui,au],rge=[ra,Qg,nR,Fw,gb,Ib,hb,_w,ev,eI,Lw,tf,vb,Zg,Ui,Ks,au,Yo],aR={MAIN:xe,QUALIFYING:We,CONSOLATION:Zr,ITEM:iR,CONTAINER:fn,FIRST_MATCHUP:al,WINNER:ru,LOSER:nu,AD_HOC:ra,FEED_IN:ev,FLEX_ROUNDS:Zhe,COMPASS:Qg,PLAY_OFF:Ui,OLYMPIC:Zg,KNOCKOUT:ege,SINGLE_ELIMINATION:Yo,DOUBLE_ELIMINATION:Fw,CURTIS:nR,FICSF:lF,FICQF:uF,FICR16:cF,MFIC:S5,VOLUNTARY_CONSOLATION:Pr,FIRST_MATCH_LOSER_CONSOLATION:eI,FIRST_ROUND_LOSER_CONSOLATION:Lw,MODIFIED_FEED_IN_CHAMPIONSHIP:vb,FEED_IN_CHAMPIONSHIP_TO_R16:Ib,FEED_IN_CHAMPIONSHIP_TO_QF:gb,FEED_IN_CHAMPIONSHIP_TO_SF:hb,FEED_IN_CHAMPIONSHIP:_w,LUCKY_DRAW:tf,ROUND_ROBIN_WITH_PLAYOFF:au,ROUND_ROBIN:Ks,DECIDER:U5,BACKDRAW:T5,COMPASS_ATTRIBUTES:dF,OLYMPIC_ATTRIBUTES:pF,DRAW:Cs,RANDOM:rR,TOP_DOWN:Ms,BOTTOM_UP:Dp,CLUSTER:eR,ADJACENT:tR,SEPARATE:w5,WATERFALL:Tp,WIN_RATIO:Pp,ROUND_OUTCOME:oh,MULTI_STRUCTURE_DRAWS:D5,generatedDrawTypes:rge,stageOrder:Pm,finishOrder:b5,AGGREGATE_EVENT_STRUCTURES:y5,FINISHING_POSITIONS:v5},nge=aR,cn="tournamentRecords",fF="policyDefinitions",mr="tournamentRecord",mF="onlineResource",mn="drawDefinition",P5="tieFormatName",hF="matchUpFormat",su="participantId",E5="scheduleDates",age="tournamentId",sge="scheduleDate",oge="roundNumber",sR="structureId",gF="participant",$w="matchUpIds",R5="entryStage",lge="policyType",C5="structures",IF="eventType",Ul="matchUpId",oR="tieFormat",lR="inContext",uR="structure",cR="courtIds",uge="personId",dR="venueIds",vF="matchUps",M5="courtId",N5="eventId",Du="matchUp",A5="drawId",xs="error",Ac="event",tv="param",yF="uuids",cge="averageMatchUpMinutes",dge="recoveryMinutes",pge="periodLength",fge="number",Yn="object",an="array",Wr="_validate",k5="_message",Fa="_invalid",zn="_ofType",bF="_anyOf",tI="_oneOf",NH={[mF]:t=>xi(Object.keys(t),[xD,FD,Jg]).length===3,[P5]:t=>t&&sc({namedFormat:t}),[yF]:t=>!t||Array.isArray(t)&&t.every(ri),[oR]:t=>!Bn({tieFormat:t}).error,[IF]:t=>[nl,ls,rr].includes(t),[R5]:t=>ZE.includes(t)},mge={[cn]:Ci,[mr]:Ie,[fF]:xE,[mn]:_e,[su]:lr,[hF]:S6,[age]:zg,[sR]:Va,[$w]:eh,[gF]:ih,[mF]:Nc,[IF]:Zl,[C5]:N1,[Ul]:Un,[oR]:Vl,[uR]:Qp,[M5]:th,[vF]:Tu,[N5]:os,[Du]:ea,[cR]:Xe,[dR]:Xe,[A5]:Oo,[Ac]:li},hge={[cn]:Yn,[fF]:Yn,[mr]:Yn,[mn]:Yn,[mF]:Yn,[E5]:an,[gF]:Yn,[$w]:an,[C5]:an,[oR]:Yn,[uR]:Yn,[cR]:an,[dR]:an,[vF]:an,[Du]:Yn,[Ac]:Yn,[yF]:an};function Ge(t,e,i){if(!t&&!bt(t))return{error:ie};if(!e?.length||t?._bypassParamCheck)return{valid:!0};if(!Array.isArray(e))return{error:ie};let{paramError:r,errorParam:n}=vge(t,e);if(!r)return{valid:!0};let a=r[Wr]&&(r[xs]||r[Fa])||t?.[n]===void 0&&(r[xs]||r[Fa]||mge[n]||ie)||ie,s=n??(r[tI]&&Object.keys(r[tI]).join(", "));return z({info:{param:s,message:r[k5]},result:{error:a},stack:i})}function O5(t,e){let i=Object.keys(t),r=Object.keys(e);return xi(i,r)}function gge(t,e){if(!e)return;let i=O5(t,e);return i.length!==1?{error:ie}:i.reduce((r,n)=>({...r,[n]:!0}),{})}function Ige(t,e){if(!e)return;let i=O5(t,e).filter(r=>t[r]);return i.length<1?{error:ie}:i.reduce((r,n)=>({...r,[n]:!0}),{})}function vge(t,e){let i,r;return{paramError:e.find(({_ofType:n,_oneOf:a,_anyOf:s,_validate:o,_info:l,...u})=>{let c=a&&gge(t,a);if(c?.error)return c.error;c&&Object.assign(u,c);let d=s&&Ige(t,s);if(d?.error)return d.error;d&&Object.assign(u,d);let p=Object.keys(u).filter(m=>typeof u[m]=="boolean"),f=p.find(m=>{let h=o&&!pa(o),g=t[m]!==void 0&&!o&&yge(t,m,n),I=u[m]&&[void 0,null].includes(t[m]),v=h||g||I||o&&t[m]!==void 0&&!bge(t[m],o)||NH[m]&&!NH[m](t[m]);return v&&(i=m,r=l),v});return!p.length||f}),errorParam:i,paramInfo:r}}function yge(t,e,i){return i=i||hge[e]||"string",i==="array"?!Array.isArray(t[e]):typeof t[e]!==i}function bge(t,e){return pa(e)?e(t):!0}var wF="DYNAMIC",ou="RANKING",sd="RATING",pd="SCALE",jl="SEEDING",wge={RANKING:ou,RATING:sd,SCALE:pd,SEEDING:jl};function iv(t){let e=Ge(t,[{[gF]:!0}]);if(e.error)return e;let i=t.participant.timeItems?.filter(({itemType:n})=>n?.startsWith(pd)&&[ou,sd,jl].includes(n.split(".")[1])),r={ratings:{},rankings:{},seedings:{}};if(i?.length){let n=s=>i.filter(o=>o?.itemType===s).sort((o,l)=>new Date(o.createdAt||void 0).getTime()-new Date(l.createdAt||void 0).getTime()).pop(),a=rt(i.map(({itemType:s})=>s));for(let s of a){let o=n(s);if(o){let[,l,u,c,d]=o.itemType.split("."),p=d?`${c}.${d}`:c,f=l===jl&&"seedings"||l===ou&&"rankings"||"ratings";r[f][u]||(r[f][u]=[]),r[f][u].push({scaleValue:o.itemValue,scaleDate:o.itemDate,scaleName:p})}}}return{...H,...r}}function Em(t){if(t===null)return{};let{source:e,template:i}=t||{};if(!i)return e;let r={};return n(e,i,r),r;function n(a,s,o){if(!a||!s)return;let l=Object.keys(a),u=Object.keys(s),c=Object.assign({},...u.filter(f=>f.indexOf("||")).map(f=>f.split("||").map(m=>({[m]:f}))).flat()),d=u.concat(...Object.keys(c)),p=d.includes("*");for(let f of l)if(d.indexOf(f)>=0||p){let m=c[f]||f,h=s[m]||p,g=a[f];if(typeof h=="object"&&typeof g!="function"&&!Array.isArray(h))if(Array.isArray(g)){let I=g.map(v=>{let w={};return n(v,h,w)!==!1?w:void 0}).filter(Boolean);o[f]=I}else g&&(o[f]={},n(g,h,o[f]));else{let I=a[f];if(Array.isArray(h)&&!h.includes(I))return!1;(s[f]||p&&s[f]!==!1)&&(o[f]=I)}}}}var rO="voluntaryConsolation",ju="competitiveBands",SF="roundRobinTally",Ep="positionActions",Er="matchUpActions",WT="rankingPoints",lc="roundNaming",Bw="participant",yb="progression",Fd="scheduling",_D="avoidance",Sge="participant",Uge="display",Po="scoring",fo="seeding",iI="feedIn",Tge="audit",$D="draws",Dge={POLICY_TYPE_VOLUNTARY_CONSOLATION:rO,POLICY_TYPE_COMPETITIVE_BANDS:ju,POLICY_TYPE_ROUND_ROBIN_TALLY:SF,POLICY_TYPE_POSITION_ACTIONS:Ep,POLICY_TYPE_MATCHUP_ACTIONS:Er,POLICY_TYPE_RANKING_POINTS:WT,POLICY_TYPE_ROUND_NAMING:lc,POLICY_TYPE_PARTICIPANT:Bw,POLICY_TYPE_PROGRESSION:yb,POLICY_TYPE_SCHEDULING:Fd,POLICY_TYPE_AVOIDANCE:_D,POLICY_TYPE_DISPLAY:Uge,POLICY_TYPE_PRIVACY:Sge,POLICY_TYPE_FEED_IN:iI,POLICY_TYPE_SCORING:Po,POLICY_TYPE_SEEDING:fo,POLICY_TYPE_AUDIT:Tge,POLICY_TYPE_DRAWS:$D};function fd({tournamentParticipants:t=[],policyDefinitions:e={},contextProfile:i,participantId:r,internalUse:n,personId:a}){let s=t.find(l=>r&&l.participantId===r||a&&l.person&&l.person.personId===a),o=ke(s,!1,n);if(o){let l=e?.[Bw];if(i?.withScaleValues){let{ratings:u,rankings:c}=iv({participant:o});o.rankings=c,o.ratings=u}if(l?.participant)return Em({template:l.participant,source:o})}return o}var Pge="element required",Ege="missing name";function En(t){if(!t||typeof t!="object")return{error:Xe};if(t.element&&typeof t?.element!="object")return{error:ie};if(!t?.name)return{error:Xe,info:Ege};if(!t?.element){if(t.discover&&t.tournamentRecords){for(let e of Object.keys(t.tournamentRecords)){let i=t.tournamentRecords[e],r=En({element:i,name:t.name});if(r.error)return z({result:r,stack:"removeExtension"})}return{...H}}return{error:Xe,info:Pge}}return t?.element.extensions?(t.element.extensions=t.element.extensions.filter(e=>e?.name!==t.name),{...H}):{...H,info:_r}}function sl({requiredAttributes:t=["name","value"],extension:e}){if(!e||typeof e!="object"||typeof e.name!="string")return!1;let i=Object.keys(e);return t.filter(r=>i.includes(r)).length===t.length}function xt(t){if(typeof t!="object")return{error:Xe};let e="addExtension";if(t?.element&&typeof t.element!="object")return z({result:{error:ie},stack:e});if(!sl({extension:t.extension}))return z({result:{error:ie,info:"invalid extension"},stack:e});if(!t.element)if(t.discover&&!t.tournamentId&&t.tournamentRecords){for(let r of Object.values(t.tournamentRecords)){let n=xt({extension:t.extension,element:r});if(n.error)return z({result:n,stack:e})}return{...H}}else return z({result:{error:Xe},stack:e});if(t.element.extensions||(t.element.extensions=[]),t?.creationTime??!0){let r=new Date().toISOString();Object.assign(t.extension,{createdAt:r})}let i=t.element.extensions.find(({name:r})=>r===t.extension.name);return i?i.value=t.extension.value:t.extension.value&&t.element.extensions.push(t.extension),{...H}}function UF(t){return!t||typeof t!="object"?{error:Xe}:t.tournamentRecord?xt({creationTime:t.creationTime,element:t.tournamentRecord,extension:t.extension}):{error:Ie}}function pR(t){return!t||typeof t!="object"?{error:Xe}:t.drawDefinition?xt({creationTime:t.creationTime,element:t.drawDefinition,extension:t.extension}):{error:Oa}}function Ld(t){return!t||typeof t!="object"?{error:Xe}:t.event?xt({creationTime:t.creationTime,extension:t.extension,element:t.event}):{error:os}}function x5(t){if(!t||typeof t!="object")return{error:Xe};if(!t.participantId)return{error:lr};let e=t.tournamentRecord?.participants||[],i=fd({participantId:t.participantId,tournamentParticipants:e});return i?xt({creationTime:t.creationTime,extension:t.extension,element:i}):{error:Vi}}function TF(t){return!t||typeof t!="object"?{error:Xe}:t.tournamentRecord?En({element:t.tournamentRecord,name:t.name}):{error:Ie}}function F5(t){return!t||typeof t!="object"?{error:Xe}:t.drawDefinition?En({element:t.drawDefinition,name:t.name}):{error:Oa}}function fR(t){return!t||typeof t!="object"?{error:Xe}:t?.event?En({element:t.event,name:t.name}):{error:os}}function L5(t){if(!t||typeof t!="object")return{error:Xe};if(!t.participantId)return{error:lr};let e=t.tournamentRecord?.participants||[],i=fd({participantId:t.participantId,tournamentParticipants:e});return i?En({element:i,name:t.name}):{error:Vi}}function Vw({tournamentRecords:t}){return{tournamentIds:bt(t)?Object.keys(t):[],...H}}var Rge="extensionQueries";function mt({discover:t,element:e,name:i,...r}){if(!e||!i){if(t&&r){let a=Object.keys(r).filter(l=>typeof t=="boolean"||Array.isArray(t)&&t.includes(l)).find(l=>Array.isArray(r[l]?.extensions)?r[l].extensions.find(u=>u?.name===i):!1),s=a&&r[a];!s&&r.tournamentRecords&&(s=Object.values(r.tournamentRecords).find(l=>l.extensions?.length));let o=s?.extensions?.find(l=>l?.name===i);return{extension:o,info:o?void 0:_r}}return z({result:{error:Xe},stack:Rge})}if(!Array.isArray(e.extensions))return{info:"no extensions"};let n=e.extensions.find(a=>a?.name===i);return{extension:n,info:n?void 0:_r}}var Cge="activeSuspension",bb="appliedPolicies",_5="context",mR="delegatedOutcome",Io="disabled",Rm="disableAutoCalc",hR="disableLinks",BD="display",pp="drawDeletions",Mge="drawProfile",VD="entryProfile",Nge="eventProfile",Age="eventWithdrawalRequests",kge="factory",Xs="flightProfile",nO="groupingAttribute",uc="lineUps",Rp="linkedTournamentsIds",DF="participantRepresentatives",rv="personRequests",Lg="positionActions",Oge="rankingPoints",xge="registration",Tl="roundTarget",jw="scheduleLimits",cc="scheduleTiming",Cm="schedulingProfile",Fge="statusDetail",rI="subOrder",dc="tally",Ny="tieFormatModification",$5={ACTIVE_SUSPENSION:Cge,APPLIED_POLICIES:bb,CONTEXT:_5,DELEGATED_OUTCOME:mR,DISABLED:Io,DISABLE_LINKS:hR,DISABLE_AUTO_CALC:Rm,DISPLAY:BD,DRAW_DELETIONS:pp,DRAW_PROFILE:Mge,ENTRY_PROFILE:VD,EVENT_PROFILE:Nge,EVENT_WITHDRAWAL_REQUESTS:Age,FLIGHT_PROFILE:Xs,GROUPING_ATTRIBUTE:nO,LINEUPS:uc,LINKED_TOURNAMENTS:Rp,PARTICIPANT_REPRESENTATIVES:DF,PERSON_REQUESTS:rv,POSITION_ACTIONS:Lg,RANKING_POINTS:Oge,REGISTRATION:xge,ROUND_TARGET:Tl,SCHEDULE_LIMITS:jw,SCHEDULE_TIMING:cc,SCHEDULING_PROFILE:Cm,STATUS_DETAIL:Fge,SUB_ORDER:rI,TALLY:dc,TIE_FORMAT_MODIFICATIONS:Ny,FACTORY:kge},AH=[mR,Io,Rm,hR,Xs,uc,Rp,DF,rv,Tl,jw,cc,Cm,rI,dc,Ny];function B5({tournamentRecords:t}){if(typeof t!="object"||!Object.keys(t).length)return{error:Ci};let e=Vw({tournamentRecords:t}),{tournamentIds:i}=e;return i?.length>1?xt({tournamentRecords:t,discover:!0,extension:{name:Rp,value:{tournamentIds:i}}}):{...H}}function V5({tournamentRecords:t}){if(typeof t!="object"||!Object.keys(t).length)return{error:Ci};let e=En({name:Rp,tournamentRecords:t,discover:!0});return z({result:e,stack:"unlinkTournaments"})}function j5({tournamentRecords:t,tournamentId:e}){if(typeof t!="object")return{error:ie};if(!e)return{error:zg};let i=Vw({tournamentRecords:t}),{tournamentIds:r}=i;if(!r.includes(e))return{error:zg};let n;return r.every(a=>{let s=t[a],{extension:o}=mt({element:s,name:Rp});if(!o)return!0;let l=o?.value?.tournamentIds||[];if(!l?.length||l.length===1&&l.includes(e)||a===e){let d=TF({name:Rp,tournamentRecord:s});return d.error&&(n=d.error),d.success}let u=l.filter(d=>d!==e);o.value={tournamentIds:u};let c=UF({tournamentRecord:s,extension:o});return c.error&&(n=c.error),c.success}),n?{error:n}:{...H}}var G5={};ct(G5,{getLinkedTournamentIds:()=>Gw,getTournamentIds:()=>Vw});function Gw({tournamentRecords:t}){return typeof t!="object"||!Object.keys(t).length?{error:Ci}:{linkedTournamentIds:Object.assign({},...Object.keys(t).map(e=>{let i=t[e],r=i?.tournamentId,{extension:n}=mt({element:i,name:Rp}),a=(n?.value?.tournamentIds||[]).filter(s=>s!==r);return{[e]:a}}))}}var gR={};ct(gR,{adHocPositionSwap:()=>r8,addAdHocMatchUps:()=>HR,addDrawDefinitionTimeItem:()=>NL,addFinishingRounds:()=>aS,addGoesTo:()=>Mp,addPlayoffStructures:()=>GR,addQualifyingStructure:()=>i8,addVoluntaryConsolationStage:()=>K7,addVoluntaryConsolationStructure:()=>vL,allPlayoffPositionsFilled:()=>RL,alternateDrawPositionAssignment:()=>x7,assignDrawPosition:()=>y8,assignDrawPositionBye:()=>Wa,attachConsolationStructures:()=>h8,attachPlayoffStructures:()=>WL,attachQualifyingStructure:()=>ML,attachStructures:()=>jR,autoSeeding:()=>CDe,automatedPlayoffPositioning:()=>pv,automatedPositioning:()=>hS,buildDrawHierarchy:()=>EDe,checkValidEntries:()=>YR,deleteAdHocMatchUps:()=>w8,drawMatic:()=>R0,findDrawDefinition:()=>XL,generateAdHocMatchUps:()=>KR,generateAdHocRounds:()=>E0,generateAndPopulatePlayoffStructures:()=>GL,generateDrawDefinition:()=>AS,generateDrawMaticRound:()=>n0,generateDrawStructuresAndLinks:()=>t0,generateDrawTypeAndModifyDrawDefinition:()=>i0,generateQualifyingStructure:()=>LL,generateVoluntaryConsolation:()=>Q8,getAssignedParticipantIds:()=>cf,getAvailableMatchUpsCount:()=>WR,getAvailablePlayoffProfiles:()=>vS,getDrawDefinitionTimeItem:()=>WF,getDrawParticipantRepresentativeIds:()=>YL,getDrawStructures:()=>Js,getDrawTypeCoercion:()=>DS,getEligibleVoluntaryConsolationParticipants:()=>qL,getMatchUpsMap:()=>Ar,getParticipantIdFinishingPositions:()=>KL,getPositionAssignments:()=>lI,getPositionsPlayedOff:()=>fv,getRandomQualifierList:()=>ZL,getSeedingThresholds:()=>SL,getSeedsCount:()=>PS,getStructureSeedAssignments:()=>ds,getTeamLineUp:()=>Cp,getValidGroupSizes:()=>fS,isAdHoc:()=>Vn,isCompletedStructure:()=>uu,isValidForQualifying:()=>e0,luckyLoserDrawPositionAssignment:()=>C7,modifyDrawDefinition:()=>g8,modifyDrawName:()=>zL,modifySeedAssignment:()=>j7,mutate:()=>H5,positionActions:()=>QL,pruneDrawDefinition:()=>v8,qualifierDrawPositionAssignment:()=>CL,qualifierProgression:()=>G7,query:()=>T8,removeDrawPositionAssignment:()=>Db,removeRoundMatchUps:()=>S8,removeSeededParticipant:()=>t8,removeStructure:()=>q7,renameStructures:()=>z7,resetDrawDefinition:()=>I8,resetQualifyingStructure:()=>X7,resetVoluntaryConsolationStructure:()=>oK,setDrawParticipantRepresentativeIds:()=>W5,setPositionAssignments:()=>k7,setStructureOrder:()=>H7,setSubOrder:()=>U8,shiftAdHocRounds:()=>A7,swapAdHocRounds:()=>O7,swapDrawPositionAssignments:()=>Z7,updateTeamLineUp:()=>bh,withdrawParticipantAtDrawPosition:()=>w7});var H5={};ct(H5,{adHocPositionSwap:()=>r8,addAdHocMatchUps:()=>HR,addDrawDefinitionTimeItem:()=>NL,addPlayoffStructures:()=>GR,addQualifyingStructure:()=>i8,addVoluntaryConsolationStage:()=>K7,addVoluntaryConsolationStructure:()=>vL,alternateDrawPositionAssignment:()=>x7,assignDrawPosition:()=>y8,assignDrawPositionBye:()=>Wa,attachConsolationStructures:()=>h8,attachPlayoffStructures:()=>WL,attachQualifyingStructure:()=>ML,attachStructures:()=>jR,automatedPlayoffPositioning:()=>pv,automatedPositioning:()=>hS,deleteAdHocMatchUps:()=>w8,luckyLoserDrawPositionAssignment:()=>C7,modifyDrawDefinition:()=>g8,modifyDrawName:()=>zL,modifySeedAssignment:()=>j7,pruneDrawDefinition:()=>v8,qualifierDrawPositionAssignment:()=>CL,qualifierProgression:()=>G7,removeDrawPositionAssignment:()=>Db,removeRoundMatchUps:()=>S8,removeSeededParticipant:()=>t8,removeStructure:()=>q7,renameStructures:()=>z7,resetDrawDefinition:()=>I8,resetQualifyingStructure:()=>X7,resetVoluntaryConsolationStructure:()=>oK,setDrawParticipantRepresentativeIds:()=>W5,setPositionAssignments:()=>k7,setStructureOrder:()=>H7,setSubOrder:()=>U8,shiftAdHocRounds:()=>A7,swapAdHocRounds:()=>O7,swapDrawPositionAssignments:()=>Z7,updateTeamLineUp:()=>bh,withdrawParticipantAtDrawPosition:()=>w7});var PF=t=>e=>t[e],EF=(t=[])=>t.map(Ir).filter(Boolean),aO=(t=[])=>t.map(vt).filter(Boolean),vt=(t={})=>PF(t)("participantId"),Ir=(t={})=>PF(t)("matchUpId"),wb=(t={})=>PF(t)("drawId");function W5({representativeParticipantIds:t,drawDefinition:e}){if(!e)return{error:Oa};if(!Array.isArray(t))return{error:ie};let i=aO(e?.entries||[]);return t.length&&xi(t,i).length<t.length?{error:ie}:pR({drawDefinition:e,extension:{name:DF,value:t}})}var us="ABANDONED",lh="AWAITING_RESULT",kc="CANCELLED",ki="COMPLETED",nv="DEAD_RUBBER",Qt="DEFAULTED",Hi="DOUBLE_DEFAULT",wi="DOUBLE_WALKOVER",ao="IN_PROGRESS",cs="INCOMPLETE",RF="NOT_PLAYED",$r="RETIRED",_d="SUSPENDED",Fi="TO_BE_PLAYED",mi="WALKOVER",Lge=[lh,ki,Qt,ao,cs,$r,_d],z5=[lh,ki,Qt,wi,Hi,ao,cs,$r,_d,mi],q5=[us,lh,"BYE",kc,ki,nv,Qt,wi,Hi,ao,cs,RF,$r,_d,Fi,mi],Y5=["BYE",wi,Hi,ki,Qt,$r,mi],K5=[us,lh,kc,nv,ao,cs,RF,_d,Fi,void 0],Yi=[kc,us,ki,nv,Qt,wi,Hi,$r,mi],CF=[us,ki,Qt,wi,Hi,ao,$r,mi],X5=[ao,cs,_d,Fi],J5={ABANDONED:us,AWAITING_RESULT:lh,BYE:"BYE",CANCELLED:kc,COMPLETED:ki,DEAD_RUBBER:nv,DEFAULTED:Qt,DOUBLE_WALKOVER:wi,DOUBLE_DEFAULT:Hi,IN_PROGRESS:ao,INCOMPLETE:cs,NOT_PLAYED:RF,RETIRED:$r,SUSPENDED:_d,TO_BE_PLAYED:Fi,WALKOVER:mi};function uh(t,e,i){let r=d=>mt({element:d,name:Tl})?.extension?.value,n=i?.deprioritizeCompleted,a=i?.mode===y5&&Qhe,s=i?.mode===v5&&b5,o=s||a||Pm,l=d=>d?.stage===xe&&d?.stageSequence===1,u=d=>l(d)?-1:o[d?.stage],c=d=>d?.matchUps.every(({matchUpStatus:p})=>Yi.includes(p)?1:-1);return n&&c(t)-c(e)||a&&u(t)-u(e)||(t?.stage&&o[t.stage]||0)-(e?.stage&&o[e.stage]||0)||(r(t)||0)-(r(e)||0)||!s&&!a&&(e?.positionAssignments?.length??1/0)-(t?.positionAssignments?.length??1/0)||(t?.stageSequence??0)-(e?.stageSequence??0)||(jD(t)||0)-(jD(e)||0)}function jD(t){return(t?.matchUps||[]).reduce((e,i)=>{let r=(i.finishingPositionRange?.winner||[]).reduce((n,a)=>n+a,0);return!e||r<e?r:e},void 0)}function et(t){let e=Ge(t,[{[mn]:!0,[sR]:!0}]);if(e.error)return e;let{drawDefinition:i,structureId:r}=t,{structures:n}=Js({drawDefinition:i}),a=n?.flatMap(l=>l.structures?[...l.structures].concat(l):l),s=a?.find(l=>l.structureId===r);if(!s)return{error:Ii};let o=s.structureType===iR?a?.find(l=>l.structures?.some(u=>u.structureId===r)):void 0;return{structure:s,containingStructure:o}}function Js({withStageGrouping:t,drawDefinition:e,stageSequences:i,stageSequence:r,roundTarget:n,sortConfig:a,stages:s,stage:o}){let l=!e&&_e||!e?.structures&&N1||void 0;if(l)return{error:l,structures:[],stageStructures:{}};let u=m=>{let h=mt({element:m,name:Tl})?.extension?.value;return!n||n===h},c=e?.structures?.filter(p).filter(f).filter(u).sort((m,h)=>uh(m,h,a))??[],d=t?Object.assign({},...ZE.map(m=>{let h=c?.filter(g=>g.stage===m);return h?.length&&{[m]:h}}).filter(Boolean)):{};return{structures:c,stageStructures:d};function p(m){return!o&&!Array.isArray(s)||o&&m.stage===o||Array.isArray(s)&&s.includes(m.stage)}function f(m){return!r&&!Array.isArray(i)||r&&m.stageSequence===r||Array.isArray(i)&&i.includes(m.stageSequence)}}function Q5({drawDefinition:t}){if(!t)return{error:_e};let e={};return{allPositionedParticipantIds:(t.structures||[]).map(i=>{let r=i.stage;e[r]||(e[r]=[]);let{positionAssignments:n}=Yt({structure:i}),a=n?.map(vt).filter(Boolean)??[];return e[r].push(...a),a}).flat(),stagePositionedParticipantIds:e}}function Yt({drawDefinition:t,structureId:e,structure:i}){let r,n=[];if(!i){if(!t)return{positionAssignments:n,error:_e};if({structure:i,error:r}=et({drawDefinition:t,structureId:e}),r)return{positionAssignments:n,error:r}}return i.structures?n=[].concat(...i.structures.map(a=>Yt({structure:a}).positionAssignments)):i.positionAssignments?n=i.positionAssignments:r=y6,{positionAssignments:n,error:r}}function ur({drawDefinition:t,structureId:e,structure:i}){let r=Yt({drawDefinition:t,structureId:e,structure:i})?.positionAssignments||[],n=r?.filter(u=>u.participantId??u.bye??u.qualifier),a=r&&r?.length===n?.length,s=r?.filter(u=>!u.participantId&&!u.bye&&!u.qualifier),o=r?.filter(u=>!u.participantId&&u.bye),l=r?.filter(u=>!u.participantId&&u.qualifier);return{allPositionsAssigned:a,positionAssignments:r,unassignedPositions:s,assignedPositions:n,qualifierPositions:l,byePositions:o}}var MF="addDrawDefinition",IR="addMatchUps",md="addParticipants",NF="addScaleItems",Z5="addEvent",eK="addVenue",Ju="audit",AF="dataIssue",kF="deleteParticipants",OF="deleteVenue",xF="deletedDrawIds",FF="deletedMatchUpIds",LF="modifyDrawDefinition",tK="modifyDrawEntries",iK="modifyEventEntries",_F="modifyMatchUp",en="modifyParticipants",$F="modifyPositionAssignments",BF="modifySeedAssignments",rf="modifyTournamentDetail",Oc="modifyVenue",sO="mutations",oO="publishEvent",rK="publishEventSeeding",nK="publishOrderOfPlay",aK="publishParticipants",VF="unPublishEvent",jF="unPublishEventSeeding",GF="unPublishOrderOfPlay",_ge="unPublishParticipants",vR="updateInContextMatchUp",$ge={ADD_DRAW_DEFINITION:MF,ADD_MATCHUPS:IR,ADD_PARTICIPANTS:md,ADD_SCALE_ITEMS:NF,ADD_EVENT:Z5,ADD_VENUE:eK,AUDIT:Ju,DATA_ISSUE:AF,DELETE_PARTICIPANTS:kF,DELETE_VENUE:OF,DELETED_DRAW_IDS:xF,DELETED_MATCHUP_IDS:FF,MODIFY_DRAW_DEFINITION:LF,MODIFY_DRAW_ENTRIES:tK,MODIFY_EVENT_ENTRIES:iK,MODIFY_MATCHUP:_F,MODIFY_PARTICIPANTS:en,MODIFY_POSITION_ASSIGNMENTS:$F,MODIFY_SEED_ASSIGNMENTS:BF,MODIFY_TOURNAMENT_DETAIL:rf,MODIFY_VENUE:Oc,MUTATIONS:sO,PUBLISH_EVENT_SEEDING:rK,PUBLISH_EVENT:oO,PUBLISH_ORDER_OF_PLAY:nK,PUBLISH_PARTICIPANTS:aK,UNPUBLISH_EVENT_SEEDING:jF,UNPUBLISH_EVENT:VF,UNPUBLISH_ORDER_OF_PLAY:GF,UPDATE_INCONTEXT_MATCHUP:vR};function yR(t,e){if(!t)return{error:_e};let i=Date.now();t.updatedAt&&i===new Date(t.updatedAt).getTime()&&(i+=1);let r=new Date(i).toISOString(),n=e?.filter(Boolean);return t.updatedAt=r,t.structures?.filter(Boolean).forEach(a=>{(!n?.length||n?.includes(a.structureId))&&(a.updatedAt=r)}),{...H}}function hd({drawDefinition:t,tournamentId:e,matchUps:i,eventId:r}){return t&&yR(t),at({payload:{matchUps:i,tournamentId:e,eventId:r},topic:IR}),{...H}}function Pu({drawDefinition:t,tournamentId:e,matchUpIds:i,eventId:r,action:n}){t&&yR(t),at({topic:FF,payload:{tournamentId:e,matchUpIds:i,eventId:r,action:n}});for(let a of i)eF({key:a});return{...H}}function St({drawDefinition:t,tournamentId:e,structureId:i,context:r,eventId:n,matchUp:a}){return a?(t&&ti({drawDefinition:t,structureIds:i?[i]:void 0,tournamentId:e,eventId:n}),at({topic:_F,payload:{matchUp:a,tournamentId:e,context:r},key:a.matchUpId}),{...H}):(console.log(ea),{error:ea})}function Bge({tournamentId:t,inContextMatchUp:e}){return e?(at({payload:{inContextMatchUp:e,tournamentId:t},topic:vR,key:e.matchUpId}),{...H}):{error:ea}}function Hw({tournamentId:t,eventId:e,drawDefinition:i}){return i?(yR(i),at({payload:{drawDefinition:i,tournamentId:t,eventId:e},topic:MF,key:i.drawId}),{...H}):(console.log(_e),{error:_e})}function Vge({tournamentId:t,eventId:e,drawId:i}){return at({payload:{drawId:i,tournamentId:t,eventId:e},topic:xF,key:i}),eF({key:i}),{...H}}function ti({drawDefinition:t,tournamentId:e,structureIds:i,eventId:r}){return t?(yR(t,i),at({payload:{tournamentId:e,eventId:r,drawDefinition:t},topic:LF,key:t.drawId}),{...H}):{error:_e}}function sK({drawDefinition:t,tournamentId:e,structure:i,eventId:r}){if(!t)return{error:_e};if(!i)return{error:Qp};let n=i.seedAssignments,a=i.structureId,s=t.drawId;return at({payload:{tournamentId:e,eventId:r,drawId:s,structureId:a,seedAssignments:n},topic:BF,key:t.drawId}),ti({structureIds:[a],drawDefinition:t,tournamentId:e,eventId:r}),{...H}}function pc({drawDefinition:t,tournamentId:e,structure:i,event:r}){if(!t)return{error:_e};if(!i)return{error:Qp};let n=Yt({structure:i}),a=i.structureId,s=t.drawId,o=r?.eventId;return at({topic:$F,payload:{positionAssignments:n,tournamentId:e,structureId:a,eventId:o,drawId:s},key:a}),ti({structureIds:[a],drawDefinition:t,tournamentId:e,eventId:o}),{...H}}function oK({tournamentRecord:t,drawDefinition:e,resetEntries:i,event:r}){if(!e)return{error:_e};let n=e.structures?.find(s=>s.stage===Pr);if(!n)return{error:Ii};let a=n.matchUps?.map(({matchUpId:s})=>s)||[];return n.positionAssignments=[],n.seedAssignments=[],n.matchUps=[],Pu({tournamentId:t?.tournamentId,action:"resetVoluntaryConsolationStructure",matchUpIds:a,drawDefinition:e}),i&&(e.entries=e.entries.filter(s=>s.entryStage!==Pr)),ti({tournamentId:t?.tournamentId,eventId:r?.eventId,drawDefinition:e,structureIds:[n.structureId]}),{...H}}function HF({drawPositions:t,structure:e}){if([We,xe].includes(e.stage)&&e.stageSequence===1)return;let{positionAssignments:i}=Yt({structure:e});i?.filter(({drawPosition:r})=>t?.includes(r))?.forEach(r=>{xt({element:r,extension:{name:hR,value:!0}})})}function Ww(t){let{appliedPolicies:e,positionAction:i,drawDefinition:r}=t;if(e?.audit?.[Lg]===!1)return;let{extension:n}=mt({name:Lg,element:r}),a=Array.isArray(n?.value)?n?.value??[]:[];if(!a?.length){let o=r.structures.find(l=>l.stage===xe);if(o){let l=Yt({structure:o}).positionAssignments?.map(({drawPosition:u,participantId:c,bye:d,qualifier:p})=>({drawPosition:u,participantId:c,qualifier:p,bye:d}));a.push({name:"initialMainAssignments",initialAssignments:l})}}let s={value:a.concat(i),name:Lg};xt({element:r,extension:s})}function av({tournamentRecord:t,drawDefinition:e,event:i}){let r=(t?.events||i&&[i])?.map(o=>o?.drawDefinitions).flat().filter(Boolean)||e&&[e]||[],n={},a={},s=r.map(o=>o?.structures?.filter(l=>l?.structures)).flat().filter(Boolean);for(let o of s){let{structures:l,structureId:u}=o??{};l&&u&&(n[u]=l?.map(c=>c.structureId))&&l.forEach(c=>a[c.structureId]=o?.structureId)}return{containedStructures:n,containerStructures:a}}function bR(t){let{sides:e,matchUpType:i}=t||{},r=t.potentialParticipants?.length?t.potentialParticipants.flat().map(a=>i===$t?a?.individualParticipantIds||[]:a.participantId).flat():[],n=(e||[]).map(a=>i===$t&&(a?.participant?.individualParticipantIds||[])||a?.participantId&&[a.participantId]||[]).flat();return{individualParticipantIds:n.concat(r).flat(),enteredIndividualParticipantIds:n,potentialIndividualParticipantIds:r}}function Is(t){return t?.tournamentRecords??(t?.tournamentRecord&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord})??{}}var zw="SIGN_IN_STATUS",lK="SIGNED_OUT",Sb="SIGNED_IN",_n="TEAM",gt="INDIVIDUAL",ja="GROUP",pt="PAIR",Lt="TEAM",Ay={TEAM_PARTICIPANT:_n,INDIVIDUAL:gt,GROUP:ja,TEAM:Lt,PAIR:pt},uK={INDIVIDUAL:gt,GROUP:ja,PAIR:pt,TEAM:Lt,SIGN_IN_STATUS:zw,SIGNED_OUT:lK,SIGNED_IN:Sb};function wR({participantsProfile:t,participants:e=[],deepCopy:i}){let r=new Map,n=i!==!1?ke(e,t?.convertExtensions,!0):e,a=n.filter(l=>l.participantType===Lt),s=n.filter(l=>l.participantType===ja),o=n.filter(l=>l.participantType===pt);return n.forEach(l=>{if(l.participantType===gt){let{participantId:u}=l;l.groupParticipantIds=[],l.teamParticipantIds=[],l.pairParticipantIds=[],l.groups=[],l.teams=[],a.forEach(c=>{(c?.individualParticipantIds||[]).forEach(d=>{d===u&&!l.teamParticipantIds?.includes(c.participantId)&&(l.teamParticipantIds.push(c.participantId),r.get(c.participantId)||r.set(c.participantId,{participantName:c.participantName,participantId:c.participantId}),l.teams.push({participantRoleResponsibilities:c.participantRoleResponsibilities,participantOtherName:c.participantOtherName,participantName:c.participantName,participantId:c.participantId,teamId:c.teamId}))})}),o.forEach(c=>{(c?.individualParticipantIds||[]).forEach(d=>{d===u&&!l.pairParticipantIds.includes(c.participantId)&&l.pairParticipantIds.push(c.participantId)})}),s.forEach(c=>{(c?.individualParticipantIds||[]).forEach(d=>{d===u&&!l.groupParticipantIds.includes(c.participantId)&&(l.groupParticipantIds.push(c.participantId),l.groups.push({participantRoleResponsibilities:c.participantRoleResponsibilities,participantOtherName:c.participantOtherName,participantName:c.participantName,participantId:c.participantId}))})})}}),{participantsWithGroupings:n,groupInfo:Object.fromEntries(r)}}var tm=[{ioc:"",iso2:"",iso:"",label:"NONE",phone:""},{ioc:"AND",iso2:"AD",iso:"AND",label:"Andorra",phone:"376"},{ioc:"UAE",iso2:"AE",iso:"ARE",label:"United Arab Emirates",phone:"971"},{ioc:"AFG",iso2:"AF",iso:"AFG",label:"Afghanistan",phone:"93"},{ioc:"ANT",iso2:"AG",iso:"ATG",label:"Antigua and Barbuda",phone:"1-268"},{ioc:"AIA",iso2:"AI",iso:"AIA",label:"Anguilla",phone:"1-264"},{ioc:"ALB",iso2:"AL",iso:"ALB",label:"Albania",phone:"355"},{ioc:"ARM",iso2:"AM",iso:"ARM",label:"Armenia",phone:"374"},{ioc:"ANG",iso2:"AO",iso:"AGO",label:"Angola",phone:"244"},{ioc:"",iso2:"AQ",iso:"ATA",label:"Antarctica",phone:"672"},{ioc:"ARG",iso2:"AR",iso:"ARG",label:"Argentina",phone:"54"},{ioc:"ASA",iso2:"AS",iso:"ASM",label:"American Samoa",phone:"1-684"},{ioc:"AUT",iso2:"AT",iso:"AUT",label:"Austria",phone:"43"},{ioc:"AUS",iso2:"AU",iso:"AUS",label:"Australia",phone:"61",suggested:!0},{ioc:"ARU",iso2:"AW",iso:"ABW",label:"Aruba",phone:"297"},{ioc:"AZE",iso2:"AZ",iso:"AZE",label:"Azerbaijan",phone:"994"},{ioc:"BIH",iso2:"BA",iso:"BIH",label:"Bosnia and Herzegovina",phone:"387"},{ioc:"BAR",iso2:"BB",iso:"BRB",label:"Barbados",phone:"1-246"},{ioc:"BAN",iso2:"BD",iso:"BGD",label:"Bangladesh",phone:"880"},{ioc:"BEL",iso2:"BE",iso:"BEL",label:"Belgium",phone:"32"},{ioc:"BUR",iso2:"BF",iso:"BFA",label:"Burkina Faso",phone:"226"},{ioc:"BUL",iso2:"BG",iso:"BGR",label:"Bulgaria",phone:"359"},{ioc:"BRN",iso2:"BH",iso:"BHR",label:"Bahrain",phone:"973"},{ioc:"BDI",iso2:"BI",iso:"BDI",label:"Burundi",phone:"257"},{ioc:"BEN",iso2:"BJ",iso:"BEN",label:"Benin",phone:"229"},{ioc:"",iso2:"BL",iso:"BLM",label:"Saint Barthelemy",phone:"590"},{ioc:"BER",iso2:"BM",iso:"BMU",label:"Bermuda",phone:"1-441"},{ioc:"BRU",iso2:"BN",iso:"BRN",label:"Brunei Darussalam",phone:"673"},{ioc:"BOL",iso2:"BO",iso:"BOL",label:"Bolivia",phone:"591"},{ioc:"BRA",iso2:"BR",iso:"BRA",label:"Brazil",phone:"55"},{ioc:"BAH",iso2:"BS",iso:"BHS",label:"Bahamas",phone:"1-242"},{ioc:"BHU",iso2:"BT",iso:"BTN",label:"Bhutan",phone:"975"},{ioc:"",iso2:"BV",iso:"BVT",label:"Bouvet Island",phone:"47"},{ioc:"BOT",iso2:"BW",iso:"BWA",label:"Botswana",phone:"267"},{ioc:"BLR",iso2:"BY",iso:"BLR",label:"Belarus",phone:"375"},{ioc:"BIZ",iso2:"BZ",iso:"BLZ",label:"Belize",phone:"501"},{ioc:"CAN",iso2:"CA",iso:"CAN",label:"Canada",phone:"1",suggested:!0},{ioc:"",iso2:"CC",iso:"CCK",label:"Cocos (Keeling) Islands",phone:"61"},{ioc:"CGO",iso2:"CD",iso:"COG",label:"Congo, Republic of the",phone:"242"},{ioc:"CAF",iso2:"CF",iso:"CAF",label:"Central African Republic",phone:"236"},{ioc:"COD",iso2:"CG",iso:"CGD",label:"Congo, Democratic Republic of the",phone:"243"},{ioc:"SUI",iso2:"CH",iso:"CHE",label:"Switzerland",phone:"41"},{ioc:"CIV",iso2:"CI",iso:"CIV",label:"Cote d'Ivoire",phone:"225"},{ioc:"COK",iso2:"CK",iso:"COK",label:"Cook Islands",phone:"682"},{ioc:"CHI",iso2:"CL",iso:"CHL",label:"Chile",phone:"56"},{ioc:"CMR",iso2:"CM",iso:"CMR",label:"Cameroon",phone:"237"},{ioc:"CHN",iso2:"CN",iso:"CHN",label:"China",phone:"86"},{ioc:"COL",iso2:"CO",iso:"COL",label:"Colombia",phone:"57"},{ioc:"CRC",iso2:"CR",iso:"CRI",label:"Costa Rica",phone:"506"},{ioc:"CUB",iso2:"CU",iso:"CUB",label:"Cuba",phone:"53"},{ioc:"CPV",iso2:"CV",iso:"CPV",label:"Cape Verde",phone:"238"},{ioc:"CUW",iso2:"CW",iso:"CUW",label:"Curacao",phone:"599"},{ioc:"CXR",iso2:"CX",iso:"CXR",label:"Christmas Island",phone:"61"},{ioc:"CYP",iso2:"CY",iso:"CYP",label:"Cyprus",phone:"357"},{ioc:"CZE",iso2:"CZ",iso:"CZE",label:"Czech Republic",phone:"420"},{ioc:"GER",iso2:"DE",iso:"DEU",label:"Germany",phone:"49",suggested:!0},{ioc:"DJI",iso2:"DJ",iso:"DJI",label:"Djibouti",phone:"253"},{ioc:"DEN",iso2:"DK",iso:"DNK",label:"Denmark",phone:"45"},{ioc:"DMA",iso2:"DM",iso:"DMA",label:"Dominica",phone:"1-767"},{ioc:"DOM",iso2:"DO",iso:"DOM",label:"Dominican Republic",phone:"1-809"},{ioc:"ALG",iso2:"DZ",iso:"DZA",label:"Algeria",phone:"213"},{ioc:"ECU",iso2:"EC",iso:"ECU",label:"Ecuador",phone:"593"},{ioc:"EST",iso2:"EE",iso:"ESE",label:"Estonia",phone:"372"},{ioc:"EGY",iso2:"EG",iso:"EGY",label:"Egypt",phone:"20"},{ioc:"",iso2:"EH",iso:"ESH",label:"Western Sahara",phone:"212"},{ioc:"ERI",iso2:"ER",iso:"ERI",label:"Eritrea",phone:"291"},{ioc:"ESP",iso2:"ES",iso:"ESP",label:"Spain",phone:"34"},{ioc:"ETH",iso2:"ET",iso:"ETH",label:"Ethiopia",phone:"251"},{ioc:"FIN",iso2:"FI",iso:"FIN",label:"Finland",phone:"358"},{ioc:"FIJ",iso2:"FJ",iso:"FJI",label:"Fiji",phone:"679"},{ioc:"FLK",iso2:"FK",iso:"FLK",label:"Falkland Islands (Malvinas)",phone:"500"},{ioc:"FSM",iso2:"FM",iso:"FSM",label:"Micronesia, Federated States of",phone:"691"},{ioc:"FAR",iso2:"FO",iso:"FRO",label:"Faroe Islands",phone:"298"},{ioc:"FRA",iso2:"FR",iso:"FRA",label:"France",phone:"33",suggested:!0},{ioc:"GAB",iso2:"GA",iso:"GAB",label:"Gabon",phone:"241"},{ioc:"GBR",iso2:"GB",iso:"GBR",label:"United Kingdom",phone:"44"},{ioc:"GRN",iso2:"GD",iso:"GRD",label:"Grenada",phone:"1-473"},{ioc:"GEO",iso2:"GE",iso:"GEO",label:"Georgia",phone:"995"},{ioc:"FGU",iso2:"GF",iso:"GUF",label:"French Guiana",phone:"594"},{ioc:"",iso2:"GG",iso:"GGY",label:"Guernsey",phone:"44"},{ioc:"",iso2:"GH",iso:"GHA",label:"Ghana",phone:"233"},{ioc:"GIB",iso2:"GI",iso:"GIB",label:"Gibraltar",phone:"350"},{ioc:"GRL",iso2:"GL",iso:"GRL",label:"Greenland",phone:"299"},{ioc:"GAM",iso2:"GM",iso:"GMB",label:"Gambia",phone:"220"},{ioc:"GUI",iso2:"GN",iso:"GIN",label:"Guinea",phone:"224"},{ioc:"GUD",iso2:"GP",iso:"GLP",label:"Guadeloupe",phone:"590"},{ioc:"GEQ",iso2:"GQ",iso:"GNQ",label:"Equatorial Guinea",phone:"240"},{ioc:"GRE",iso2:"GR",iso:"GRC",label:"Greece",phone:"30"},{ioc:"",iso2:"GS",iso:"SGS",label:"South Georgia and the South Sandwich Islands",phone:"500"},{ioc:"GUA",iso2:"GT",iso:"GTM",label:"Guatemala",phone:"502"},{ioc:"GUM",iso2:"GU",iso:"GUM",label:"Guam",phone:"1-671"},{ioc:"GBS",iso2:"GW",iso:"GNB",label:"Guinea-Bissau",phone:"245"},{ioc:"GUY",iso2:"GY",iso:"GUY",label:"Guyana",phone:"592"},{ioc:"HKG",iso2:"HK",iso:"HKG",label:"Hong Kong",phone:"852"},{ioc:"",iso2:"HM",iso:"HMD",label:"Heard Island and McDonald Islands",phone:"672"},{ioc:"HON",iso2:"HN",iso:"HND",label:"Honduras",phone:"504"},{ioc:"CRO",iso2:"HR",iso:"HRV",label:"Croatia",phone:"385"},{ioc:"HAI",iso2:"HT",iso:"HTI",label:"Haiti",phone:"509"},{ioc:"HUN",iso2:"HU",iso:"HUN",label:"Hungary",phone:"36"},{ioc:"INA",iso2:"ID",iso:"IDN",label:"Indonesia",phone:"62"},{ioc:"IRL",iso2:"IE",iso:"IRL",label:"Ireland",phone:"353"},{ioc:"ISR",iso2:"IL",iso:"ISR",label:"Israel",phone:"972"},{ioc:"",iso2:"IM",iso:"IMN",label:"Isle of Man",phone:"44"},{ioc:"IND",iso2:"IN",iso:"IND",label:"India",phone:"91"},{ioc:"",iso2:"IO",iso:"IOT",label:"British Indian Ocean Territory",phone:"246"},{ioc:"IRQ",iso2:"IQ",iso:"IRQ",label:"Iraq",phone:"964"},{ioc:"IRI",iso2:"IR",iso:"IRN",label:"Iran, Islamic Republic of",phone:"98"},{ioc:"ISL",iso2:"IS",iso:"ISL",label:"Iceland",phone:"354"},{ioc:"ITA",iso2:"IT",iso:"ITA",label:"Italy",phone:"39"},{ioc:"",iso2:"JE",iso:"JEY",label:"Jersey",phone:"44"},{ioc:"JAM",iso2:"JM",iso:"JAM",label:"Jamaica",phone:"1-876"},{ioc:"JOR",iso2:"JO",iso:"JOR",label:"Jordan",phone:"962"},{ioc:"JPN",iso2:"JP",iso:"JPN",label:"Japan",phone:"81",suggested:!0},{ioc:"KEN",iso2:"KE",iso:"KEN",label:"Kenya",phone:"254"},{ioc:"KGZ",iso2:"KG",iso:"KGZ",label:"Kyrgyzstan",phone:"996"},{ioc:"CAM",iso2:"KH",iso:"KHM",label:"Cambodia",phone:"855"},{ioc:"KIR",iso2:"KI",iso:"KIR",label:"Kiribati",phone:"686"},{ioc:"COM",iso2:"KM",iso:"COM",label:"Comoros",phone:"269"},{ioc:"SKN",iso2:"KN",iso:"KNA",label:"Saint Kitts and Nevis",phone:"1-869"},{ioc:"KOR",iso2:"KP",iso:"KOR",label:"Korea, Democratic People's Republic of",phone:"850"},{ioc:"PRK",iso2:"KR",iso:"PRK",label:"Korea, Republic of",phone:"82"},{ioc:"KUW",iso2:"KW",iso:"KWT",label:"Kuwait",phone:"965"},{ioc:"CAY",iso2:"KY",iso:"CYM",label:"Cayman Islands",phone:"1-345"},{ioc:"KAZ",iso2:"KZ",iso:"KAZ",label:"Kazakhstan",phone:"7"},{ioc:"LAO",iso2:"LA",iso:"LAO",label:"Lao People's Democratic Republic",phone:"856"},{ioc:"LIB",iso2:"LB",iso:"LBN",label:"Lebanon",phone:"961"},{ioc:"LCA",iso2:"LC",iso:"LCA",label:"Saint Lucia",phone:"1-758"},{ioc:"LIE",iso2:"LI",iso:"LIE",label:"Liechtenstein",phone:"423"},{ioc:"SRI",iso2:"LK",iso:"LKA",label:"Sri Lanka",phone:"94"},{ioc:"LBR",iso2:"LR",iso:"LBR",label:"Liberia",phone:"231"},{ioc:"LES",iso2:"LS",iso:"LSO",label:"Lesotho",phone:"266"},{ioc:"LTU",iso2:"LT",iso:"LTU",label:"Lithuania",phone:"370"},{ioc:"LUX",iso2:"LU",iso:"LUX",label:"Luxembourg",phone:"352"},{ioc:"LAT",iso2:"LV",iso:"LVA",label:"Latvia",phone:"371"},{ioc:"LBA",iso2:"LY",iso:"LBY",label:"Libya",phone:"218"},{ioc:"MAR",iso2:"MA",iso:"MAR",label:"Morocco",phone:"212"},{ioc:"MON",iso2:"MC",iso:"MCO",label:"Monaco",phone:"377"},{ioc:"MDA",iso2:"MD",iso:"MDA",label:"Moldova, Republic of",phone:"373"},{ioc:"MNE",iso2:"ME",iso:"MNE",label:"Montenegro",phone:"382"},{ioc:"",iso2:"MF",iso:"MAF",label:"Saint Martin (French part)",phone:"590"},{ioc:"MAD",iso2:"MG",iso:"MDG",label:"Madagascar",phone:"261"},{ioc:"MSH",iso2:"MH",iso:"MHL",label:"Marshall Islands",phone:"692"},{ioc:"MKD",iso2:"MK",iso:"MKD",label:"Macedonia, the Former Yugoslav Republic of",phone:"389"},{ioc:"MLI",iso2:"ML",iso:"MLI",label:"Mali",phone:"223"},{ioc:"MYA",iso2:"MM",iso:"MMR",label:"Myanmar",phone:"95"},{ioc:"MGL",iso2:"MN",iso:"MNG",label:"Mongolia",phone:"976"},{ioc:"MAC",iso2:"MO",iso:"MAC",label:"Macao",phone:"853"},{ioc:"NMA",iso2:"MP",iso:"NMP",label:"Northern Mariana Islands",phone:"1-670"},{ioc:"MRT",iso2:"MQ",iso:"MTQ",label:"Martinique",phone:"596"},{ioc:"MTN",iso2:"MR",iso:"MRT",label:"Mauritania",phone:"222"},{ioc:"MNT",iso2:"MS",iso:"MSR",label:"Montserrat",phone:"1-664"},{ioc:"MLT",iso2:"MT",iso:"MLT",label:"Malta",phone:"356"},{ioc:"MRI",iso2:"MU",iso:"MUS",label:"Mauritius",phone:"230"},{ioc:"MDV",iso2:"MV",iso:"MDV",label:"Maldives",phone:"960"},{ioc:"MAW",iso2:"MW",iso:"MWI",label:"Malawi",phone:"265"},{ioc:"MEX",iso2:"MX",iso:"MEX",label:"Mexico",phone:"52"},{ioc:"MAS",iso2:"MY",iso:"MYS",label:"Malaysia",phone:"60"},{ioc:"MOZ",iso2:"MZ",iso:"MOZ",label:"Mozambique",phone:"258"},{ioc:"NAM",iso2:"NA",iso:"NAM",label:"Namibia",phone:"264"},{ioc:"NCL",iso2:"NC",iso:"NCL",label:"New Caledonia",phone:"687"},{ioc:"NIG",iso2:"NE",iso:"NER",label:"Niger",phone:"227"},{ioc:"NFI",iso2:"NF",iso:"NFK",label:"Norfolk Island",phone:"672"},{ioc:"NGR",iso2:"NG",iso:"NGA",label:"Nigeria",phone:"234"},{ioc:"NCA",iso2:"NI",iso:"NIC",label:"Nicaragua",phone:"505"},{ioc:"NED",iso2:"NL",iso:"NLD",label:"Netherlands",phone:"31"},{ioc:"NOR",iso2:"NO",iso:"NOR",label:"Norway",phone:"47"},{ioc:"NEP",iso2:"NP",iso:"NPL",label:"Nepal",phone:"977"},{ioc:"NRU",iso2:"NR",iso:"NRU",label:"Nauru",phone:"674"},{ioc:"NIU",iso2:"NU",iso:"NIU",label:"Niue",phone:"683"},{ioc:"NZL",iso2:"NZ",iso:"NZL",label:"New Zealand",phone:"64"},{ioc:"OMA",iso2:"OM",iso:"OMN",label:"Oman",phone:"968"},{ioc:"PAN",iso2:"PA",iso:"PAN",label:"Panama",phone:"507"},{ioc:"PER",iso2:"PE",iso:"PER",label:"Peru",phone:"51"},{ioc:"FPO",iso2:"PF",iso:"PYF",label:"French Polynesia",phone:"689"},{ioc:"PNG",iso2:"PG",iso:"PNG",label:"Papua New Guinea",phone:"675"},{ioc:"PHI",iso2:"PH",iso:"PHL",label:"Philippines",phone:"63"},{ioc:"PAK",iso2:"PK",iso:"PAK",label:"Pakistan",phone:"92"},{ioc:"POL",iso2:"PL",iso:"POL",label:"Poland",phone:"48"},{ioc:"SPM",iso2:"PM",iso:"SPM",label:"Saint Pierre and Miquelon",phone:"508"},{ioc:"",iso2:"PN",iso:"PCN",label:"Pitcairn",phone:"870"},{ioc:"PUR",iso2:"PR",iso:"PRI",label:"Puerto Rico",phone:"1"},{ioc:"PLE",iso2:"PS",iso:"PSE",label:"Palestine, State of",phone:"970"},{ioc:"POR",iso2:"PT",iso:"PRT",label:"Portugal",phone:"351"},{ioc:"PLW",iso2:"PW",iso:"PLW",label:"Palau",phone:"680"},{ioc:"PAR",iso2:"PY",iso:"PRY",label:"Paraguay",phone:"595"},{ioc:"QAT",iso2:"QA",iso:"QAT",label:"Qatar",phone:"974"},{ioc:"REU",iso2:"RE",iso:"REU",label:"Reunion",phone:"262"},{ioc:"ROU",iso2:"RO",iso:"ROU",label:"Romania",phone:"40"},{ioc:"SRB",iso2:"RS",iso:"SRB",label:"Serbia",phone:"381"},{ioc:"RUS",iso2:"RU",iso:"RUS",label:"Russia",phone:"7"},{ioc:"RWA",iso2:"RW",iso:"RWA",label:"Rwanda",phone:"250"},{ioc:"KSA",iso2:"SA",iso:"SAU",label:"Saudi Arabia",phone:"966"},{ioc:"SOL",iso2:"SB",iso:"SLB",label:"Solomon Islands",phone:"677"},{ioc:"SEY",iso2:"SC",iso:"SYC",label:"Seychelles",phone:"248"},{ioc:"SUD",iso2:"SD",iso:"SDN",label:"Sudan",phone:"249"},{ioc:"SWE",iso2:"SE",iso:"SWE",label:"Sweden",phone:"46"},{ioc:"SIN",iso2:"SG",iso:"SGP",label:"Singapore",phone:"65"},{ioc:"HEL",iso2:"SH",iso:"SHN",label:"Saint Helena",phone:"290"},{ioc:"SLO",iso2:"SI",iso:"SVN",label:"Slovenia",phone:"386"},{ioc:"",iso2:"SJ",iso:"SJM",label:"Svalbard and Jan Mayen",phone:"47"},{ioc:"SVK",iso2:"SK",iso:"SVK",label:"Slovakia",phone:"421"},{ioc:"SLE",iso2:"SL",iso:"SLE",label:"Sierra Leone",phone:"232"},{ioc:"SMR",iso2:"SM",iso:"SMR",label:"San Marino",phone:"378"},{ioc:"SEN",iso2:"SN",iso:"SEN",label:"Senegal",phone:"221"},{ioc:"SOM",iso2:"SO",iso:"SOM",label:"Somalia",phone:"252"},{ioc:"SUR",iso2:"SR",iso:"SUR",label:"Suriname",phone:"597"},{ioc:"",iso2:"SS",iso:"SSD",label:"South Sudan",phone:"211"},{ioc:"STP",iso2:"ST",iso:"STP",label:"Sao Tome and Principe",phone:"239"},{ioc:"ESA",iso2:"SV",iso:"SLV",label:"El Salvador",phone:"503"},{ioc:"",iso2:"SX",iso:"SMX",label:"Sint Maarten",phone:"1-721"},{ioc:"SYR",iso2:"SY",iso:"SYR",label:"Syria",phone:"963"},{ioc:"",iso2:"SZ",iso:"SWZ",label:"Swaziland",phone:"268"},{ioc:"TKS",iso2:"TC",iso:"TCA",label:"Turks and Caicos Islands",phone:"1-649"},{ioc:"CHA",iso2:"TD",iso:"TCD",label:"Chad",phone:"235"},{ioc:"",iso2:"TF",iso:"ATF",label:"French Southern Territories",phone:"262"},{ioc:"TOG",iso2:"TG",iso:"TGO",label:"Togo",phone:"228"},{ioc:"THA",iso2:"TH",iso:"THA",label:"Thailand",phone:"66"},{ioc:"TJK",iso2:"TJ",iso:"TJK",label:"Tajikistan",phone:"992"},{ioc:"",iso2:"TK",iso:"TKL",label:"Tokelau",phone:"690"},{ioc:"TLS",iso2:"TL",iso:"TLS",label:"Timor-Leste",phone:"670"},{ioc:"TKM",iso2:"TM",iso:"TKM",label:"Turkmenistan",phone:"993"},{ioc:"TUN",iso2:"TN",iso:"TUN",label:"Tunisia",phone:"216"},{ioc:"TGA",iso2:"TO",iso:"TON",label:"Tonga",phone:"676"},{ioc:"TUR",iso2:"TR",iso:"TUR",label:"Turkey",phone:"90"},{ioc:"TTO",iso2:"TT",iso:"TTO",label:"Trinidad and Tobago",phone:"1-868"},{ioc:"TUV",iso2:"TV",iso:"TUV",label:"Tuvalu",phone:"688"},{ioc:"TPE",iso2:"TW",iso:"TWN",label:"Taiwan",phone:"886"},{ioc:"TAN",iso2:"TZ",iso:"TZA",label:"United Republic of Tanzania",phone:"255"},{ioc:"UKR",iso2:"UA",iso:"UKR",label:"Ukraine",phone:"380"},{ioc:"UGA",iso2:"UG",iso:"UGA",label:"Uganda",phone:"256"},{ioc:"USA",iso2:"US",label:"United States",phone:"1",suggested:!0,iso:"USA"},{ioc:"URU",iso2:"UY",iso:"URY",label:"Uruguay",phone:"598"},{ioc:"UZB",iso2:"UZ",iso:"UZB",label:"Uzbekistan",phone:"998"},{ioc:"",iso2:"VA",iso:"VAT",label:"Holy See (Vatican City State)",phone:"379"},{ioc:"VIN",iso2:"VC",iso:"VCT",label:"Saint Vincent and the Grenadines",phone:"1-784"},{ioc:"VEN",iso2:"VE",iso:"VEN",label:"Venezuela",phone:"58"},{ioc:"IVB",iso2:"VG",iso:"VGB",label:"British Virgin Islands",phone:"1-284"},{ioc:"ISV",iso2:"VI",iso:"VIR",label:"US Virgin Islands",phone:"1-340"},{ioc:"VIE",iso2:"VN",iso:"VNM",label:"Vietnam",phone:"84"},{ioc:"VAN",iso2:"VU",iso:"VUT",label:"Vanuatu",phone:"678"},{ioc:"WAF",iso2:"WF",iso:"WLF",label:"Wallis and Futuna",phone:"681"},{ioc:"SAM",iso2:"WS",iso:"WSM",label:"Samoa",phone:"685"},{ioc:"KOS",iso2:"XK",iso:"KOS",label:"Kosovo",phone:"383"},{ioc:"YEM",iso2:"YE",iso:"YEM",label:"Yemen",phone:"967"},{ioc:"MAY",iso2:"YT",iso:"MYT",label:"Mayotte",phone:"262"},{ioc:"RSA",iso2:"ZA",iso:"ZAF",label:"South Africa",phone:"27"},{ioc:"ZAM",iso2:"ZM",iso:"ZMB",label:"Zambia",phone:"260"},{ioc:"ZIM",iso2:"ZW",iso:"ZWE",label:"Zimbabwe",phone:"263"}];function cK({participant:t,withISO2:e,withIOC:i}){let{person:r,individualParticipants:n}=t,a=[r,n?.map(({person:o})=>o)].flat().filter(Boolean);function s(o){let{nationalityCode:l}=o||{};if(l){let u=tm.find(({iso:c})=>c===l);i&&u?.ioc&&!o.iocNationalityCode&&(o.iocNationalityCode=u.ioc),e&&u?.iso2&&!o.iso2NationalityCode&&(o.iso2NationalityCode=u.iso2),u?.label&&!o.countryName&&(o.countryName=u.label)}}a.forEach(s)}function jge({participantMap:t,template:e}){let i=Object.values(t);for(let r of i){let n=r.participant;if(n.individualParticipantIds?.length){n.individualParticipants=[];for(let a of n.individualParticipantIds){let s=t[a].participant;n.individualParticipants.push(e?Em({template:e,source:s}):s)}}}}function $d(t){let{tournamentRecord:e,participantId:i}=t,r=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};for(let n of Object.values(r)){let a=n.participants?.find(s=>s.participantId===i);if(a)return{participant:a,tournamentId:n.tournamentId}}return{error:Vi}}function dK(t){let{tournamentRecord:e,participantId:i}=t;if(i){let n=$d({tournamentRecord:e,participantId:i});return n.participant??n}return t.element||t.drawDefinition||t.event||t.tournamentRecord||{error:Xe}}function vs(t){let{returnPreviousValues:e,itemSubTypes:i,itemType:r}=t,n=dK(t);if(n.error)return n;if(i&&!Array.isArray(i))return{error:ie,context:{itemSubTypes:i}};if(!Array.isArray(n.timeItems))return{error:W1};let a=n.timeItems.filter(o=>o?.itemType===r).filter(o=>!i?.length||i.some(l=>o?.itemSubTypes?.includes(l))).sort((o,l)=>{let u=new Date(o.createdAt||void 0).getTime(),c=new Date(l.createdAt||void 0).getTime();return u-c}),s=ke(a.pop(),!1,!0);if(s){let o={timeItem:s,...H};return e&&Object.assign(o,{previousItems:a}),o}else return{info:_r}}function WF({returnPreviousValues:t,drawDefinition:e,itemSubTypes:i,itemType:r}){if(!e)return{error:Oo};if(!e.timeItems)return{info:_r};let{timeItem:n,previousItems:a,info:s}=vs({element:e,returnPreviousValues:t,itemSubTypes:i,itemType:r});return n&&{timeItem:n,previousItems:a}||{info:s}}function qw({returnPreviousValues:t,itemSubTypes:e,itemType:i,event:r}){if(!r)return{error:li};if(!r.timeItems)return{info:_r};let{timeItem:n,previousItems:a,info:s}=vs({returnPreviousValues:t,element:r,itemSubTypes:e,itemType:i});return n&&{timeItem:n,previousItems:a}||{info:s}}function SR({returnPreviousValues:t,tournamentRecord:e,itemSubTypes:i,itemType:r}){if(!e)return{error:Ie};if(!e.timeItems)return{info:_r};let{timeItem:n,previousItems:a,info:s}=vs({element:e,returnPreviousValues:t,itemSubTypes:i,itemType:r});return n&&{timeItem:n,previousItems:a}||{info:s}}function zF({returnPreviousValues:t,tournamentRecord:e,participantId:i,itemSubTypes:r,itemType:n}){if(!e)return{error:Ie};if(!i)return{error:lr};let a=$d({tournamentRecord:e,participantId:i});if(a.error)return a;let{participant:s}=a;if(!s?.timeItems)return{info:_r};let{timeItem:o,previousItems:l,info:u}=vs({element:a.participant,returnPreviousValues:t,itemSubTypes:r,itemType:n});return o&&{timeItem:o,previousItems:l}||{info:u}}var Gge={[ja]:"groupParticipantIds",[pt]:"pairParticipantIds",[Lt]:"teamParticipantIds"},Hge={[ja]:"groups",[Lt]:"teams"};function pK({withIndividualParticipants:t,convertExtensions:e,tournamentRecord:i,withSignInStatus:r,withScaleValues:n,withGroupings:a,internalUse:s,withISO2:o,withIOC:l}){let u=[],c={};for(let p of i.participants??[]){let f=p?.participantId;f&&qge({participantMap:c,participantId:f})}for(let p of i.participants??[]){let f=ke(p,e,s),{participantId:m,individualParticipantIds:h,participantType:g}=f;if(!c[m]){u.push(m);continue}if(Object.assign(c[m].participant,f),h){let I=zge({individualParticipantIds:h,participantCopy:f,participantMap:c,participantType:g,participantId:m});I.missingParticipantIds.length&&u.push(...I.missingParticipantIds)}if(r&&(c[m].participant.signedIn=Wge(f)),n){let{ratings:I,rankings:v,seedings:w}=iv({participant:f});c[m].participant.seedings=w,c[m].participant.rankings=v,c[m].participant.ratings=I}(l||o)&&cK({participant:c[m].participant,withISO2:o,withIOC:l})}if(t){let p=bt(t)?t:void 0;jge({participantMap:c,template:p})}let d;return a&&(d=wR({participants:Object.values(c).map(({participant:p})=>p),participantsProfile:{convertExtensions:e},deepCopy:!1}).groupInfo),{missingParticipantIds:u,participantMap:c,groupInfo:d}}function Wge(t){let{timeItem:e}=vs({itemType:zw,element:t});return e?.itemValue===Sb}function zge({individualParticipantIds:t,participantCopy:e,participantMap:i,participantType:r,participantId:n}){let a=[];for(let s of t){let o=i[s]?.participant;if(!o){a.push(s);continue}if(o[Gge[r]].push(n),[Lt,ja].includes(r)){let{participantRoleResponsibilities:l,participantOtherName:u,participantName:c,participantId:d,teamId:p}=e,f=Hge[r];o[f].push({participantRoleResponsibilities:l,participantOtherName:u,participantName:c,participantId:d,teamId:p})}if(r===pt){let l=t.find(u=>u!==s);i[s].pairIdMap[n]=l,i[s].pairIdMap[l]=n}}return{missingParticipantIds:a}}function qge({participantMap:t,participantId:e}){if(t[e])return;let i={walkoverWins:0,defaultWins:0,walkovers:0,defaults:0,losses:0,wins:0};t[e]={structureParticipation:{},potentialMatchUps:{},scheduleConflicts:{},scheduleItems:[],participant:{groupParticipantIds:[],pairParticipantIds:[],teamParticipantIds:[],seedings:{},rankings:{},ratings:{},groups:[],teams:[]},statistics:{},opponents:{},pairIdMap:{},matchUps:{},events:{},draws:{},counters:{[Wt]:{...i},[$t]:{...i},[Lt]:{...i},...i}}}function nf({participantsProfile:t,useParticipantMap:e,tournamentRecord:i,contextProfile:r,inContext:n}){if(e)return pK({...t,...r,tournamentRecord:i});let a=ke(i.participants,!1,!0)||[];(t?.withIOC||t?.withISO2)&&a.forEach(o=>cK({participant:o,...t}));let s;if((n||t?.withGroupings)&&a?.length&&({participantsWithGroupings:a,groupInfo:s}=wR({participantsProfile:t,deepCopy:!1,participants:a})),t?.withScaleValues&&a?.length)for(let o of a){let{ratings:l,rankings:u}=iv({participant:o});o.rankings=u,o.ratings=l}return{participants:a,groupInfo:s}}function Tt({onlySpecifiedPolicyTypes:t=!1,policyTypes:e=[],tournamentRecord:i,drawDefinition:r,structure:n,event:a}){if(!Array.isArray(e))return{error:O1};let s={};return i&&o(i),a&&o(a),r&&o(r),n&&o(n),{appliedPolicies:s,...H};function o(l){let u=l?.extensions?.find(c=>c.name===bb)?.value;if(u)for(let c of Object.keys(u))(t?e.includes(c):!e.length||e.includes(c))&&(s[c]=ke(u[c],!1,!0))}}function xc({policyTypes:t=[],tournamentRecord:e,drawDefinition:i,structure:r,event:n}){if(!Array.isArray(t))return{error:O1};let{appliedPolicies:a}=Tt({tournamentRecord:e,drawDefinition:i,structure:r,event:n}),s={};for(let o of t){let l=a?.[o];l&&(s[o]=l)}return Object.keys(s).length?{policyDefinitions:s}:{info:Cw.message}}var fK="WALKOVER",kH="RETIRED",qF="COMPETITIVE",Ub="ROUTINE",Tb="DECISIVE",zT="winRatio",Yge={[ju]:{policyName:"Competitive Bands Default",profileBands:{[Tb]:20,[Ub]:50}}},YF=Yge;function Fc({policyDefinitions:t,tournamentRecord:e,contextProfile:i,drawDefinition:r,event:n}){let a={policies:{}};if(!i)return a;let s=xc({tournamentRecord:e,drawDefinition:r,event:n}).policyDefinitions;if(i.withCompetitiveness){let o=t?.[ju]??s?.[ju]??YF[ju];a.policies[ju]=o}return a}function af({tournamentRecord:t,drawDefinition:e,policyType:i,structure:r,event:n}){if(!t)return{error:Ie};let{appliedPolicies:a}=Tt({tournamentRecord:t,drawDefinition:e,structure:r,event:n});return a?.[i]?{policy:a[i]}:{info:Cw?.message}}function Yw({tournamentRecord:t,categoryName:e,categoryType:i,event:r}){e=e??r?.category?.categoryName??r?.category?.ageCategoryCode,i=i??r?.category?.categoryType??r?.category?.subType;let{policy:n}=af({policyType:Fd,tournamentRecord:t,event:r}),a=(t?mt({element:t,name:cc}).extension:void 0)?.value,s=(r&&mt({name:cc,element:r}).extension)?.value;return{scheduleTiming:{tournamentScheduling:a,eventScheduling:s,categoryName:e,categoryType:i,policy:n}}}function KF({drawDefinition:t,attributes:e}){let{extension:i}=mt({element:t,name:VD}),r=i?.value||{};return e.forEach(n=>{Object.keys(n).forEach(a=>{r[a]?Object.assign(r[a],n[a]):r[a]=n[a]})}),i={name:VD,value:r},pR({drawDefinition:t,extension:i}),{entryProfile:r}}function Kw({drawDefinition:t}){let{extension:e}=mt({element:t,name:VD});return{entryProfile:e?.value||{}}}var Fs="ALTERNATE",Xw="CONFIRMED",na="DIRECT_ACCEPTANCE",Jw="FEED_IN",Qw="JUNIOR_EXEMPT",fc="LUCKY_LOSER",Zw="ORGANISER_ACCEPTANCE",eS="QUALIFIER",Kge="REGISTERED",tS="SPECIAL_EXEMPT",ys="UNGROUPED",sf="UNPAIRED",nI="WILDCARD",mc="WITHDRAWN",qT=[Xw,na,Qw,Zw,tS],mK=[Jw,fc,eS],of=[Xw,na,Jw,Qw,Zw,tS,nI],so=[Xw,na,Qw,fc,eS,Zw,tS,nI],hK=[Fs,Xw,na,Jw,Qw,fc,Zw,eS,Kge,tS,ys,sf,nI,mc],Xge={ALTERNATE:Fs,CONFIRMED:Xw,DIRECT_ACCEPTANCE:na,DIRECT_ENTRY_STATUSES:of,DRAW_SPECIFIC_STATUSES:mK,EQUIVALENT_ACCEPTANCE_STATUSES:qT,FEED_IN:Jw,JUNIOR_EXEMPT:Qw,LUCKY_LOSER:fc,ORGANISER_ACCEPTANCE:Zw,QUALIFIER:eS,SPECIAL_EXEMPT:tS,STRUCTURE_SELECTED_STATUSES:so,UNGROUPED:ys,UNPAIRED:sf,VALID_ENTRY_STATUSES:hK,WILDCARD:nI,WITHDRAWN:mc};function XF({stage:t,drawDefinition:e}){let{entryProfile:i}=Kw({drawDefinition:e}),r=Object.keys(i).includes(t);if(!r&&ZE.includes(t)){let n=[{[t]:{drawSize:void 0,alternates:!0}}];return KF({drawDefinition:e,attributes:n}),!0}return r}function Jge({stage:t,drawDefinition:e}){let{entryProfile:i}=Kw({drawDefinition:e});return i[t]?.alternates||0}function Qge({stage:t,drawDefinition:e}){let{entryProfile:i}=Kw({drawDefinition:e});return i[t]?.wildcardsCount||0}function lO({stage:t,drawDefinition:e,entryStatus:i}){return e.entries.reduce((r,n)=>n.entryStage===t&&n.entryStatus===i?r+1:r,0)}function ch({provisionalPositioning:t,placementGroup:e,drawDefinition:i,stageSequence:r,entryStatuses:n,structureId:a,roundTarget:s,stages:o,stage:l}){let u=i.entries?.reduce((c,d)=>{let p=mt({name:Tl,element:d})?.extension?.value,f=l&&d.entryStage===l||o?.length&&d.entryStage&&o.includes(d.entryStage),m=!n||d.entryStatus&&n.includes(d.entryStatus),h=d.entryStageSequence??1;return f&&(!r||h===r)&&m&&(!s||!p||s===p)?c.concat(d):c},[])??[];if(a&&l===Ui){let{playoffEntries:c,error:d}=Zge({provisionalPositioning:t,drawDefinition:i,structureId:a});return d&&console.log("playoff entries error"),(c?.length?c:u).filter(p=>!e||p.placementGroup===e)}return u}function Zge({provisionalPositioning:t,drawDefinition:e,structureId:i}){let r=[],n=(e.links??[]).find(a=>a.linkType===iu&&a.target.structureId===i);if(n){let{finishingPositions:a,structureId:s}=n.source,{structure:o}=et({drawDefinition:e,structureId:s});o?.structureType===fn&&(o.structures??[]).forEach(l=>{let u=l.positionAssignments??[],{structureId:c}=l,d=c,p=Object.assign({},...u.map(h=>{let{participantId:g}=h,I=mt({element:h,name:dc}).extension?.value;return I&&g?{[g]:I}:void 0}).filter(Boolean)),f=Object.keys(p).reduce((h,g)=>{let I=p[g],v=I.groupOrder||t&&I.provisionalOrder;return h.includes(v)||h.push(v),h},[]).length===Object.keys(p).length,m=Object.keys(p).filter(h=>{let g=p[h],I=g.groupOrder||t&&g.provisionalOrder;return a?.includes(I)});(!t||f)&&m.forEach(h=>{let g=p[h],{groupOrder:I,provisionalOrder:v,GEMscore:w}=g,y=I||t&&v,b=[...a??[]].sort(ir).indexOf(y)+1;r.push({entryStage:Ui,entryStatus:Jw,placementGroup:b,groupingValue:d,participantId:h,GEMscore:w})})})}return{playoffEntries:r}}function eIe({stage:t,drawDefinition:e}){return of.reduce((i,r)=>(lO({drawDefinition:e,entryStatus:r,stage:t})||0)+i,0)}function ds({provisionalPositioning:t,returnAllProxies:e,drawDefinition:i,structureId:r,structure:n}){let a,s=[];n||({structure:n,error:a}=et({drawDefinition:i,structureId:r}));let o=Yt({structure:n}).positionAssignments;if(a||!n)return{seedAssignments:[],error:Ii};r||(r=n.structureId);let{stage:l,stageSequence:u}=n,c=l===Ui&&i&&ch({provisionalPositioning:t,drawDefinition:i,stageSequence:u,structureId:r,stage:l}),d=c?c.filter(m=>m.placementGroup===1).sort((m,h)=>m.GEMscore<h.GEMscore&&1||m.GEMscore>h.GEMscore&&-1||0).map((m,h)=>{let g=h+1;return{participantId:m.participantId,seedValue:g,seedProxy:!0,seedNumber:g}}):[],p=d?.slice(0,e?d.length:o.length/2);p.length?s=p:n.seedAssignments?s=n.seedAssignments:a=u6;let f=n.seedLimit??n?.positionAssignments?.length;return{seedAssignments:s,stageSequence:u,seedLimit:f,stage:l,error:a}}function $o(t){if(!t)return;let{tieFormatId:e,tieFormats:i}=t;if(t.tieFormat)return t.tieFormat;if(e&&Array.isArray(i))return i.find(r=>r.tieFormatId===e)}function ky({item:t,drawDefinition:e,structure:i,event:r}){if(t){if(t.tieFormat)return t.tieFormat;if(t.tieFormatId)return e.tieFormat?e.tieFormat:e.tieFormats?.find(a=>t.tieFormatId===a.tieFormatId)||(r.tieFormat?r.tieFormat:r.tieFormats?.find(a=>t.tieFormatId===a.tieFormatId));if(i?.tieFormat)return i.tieFormat;if(i?.tieFormatId){let n=e.tieFormats?.find(a=>i.tieFormatId===a.tieFormatId);if(n)return n}}}function vn({drawDefinition:t,structure:e,matchUp:i,event:r}){return{tieFormat:ky({item:i,drawDefinition:t,structure:e,event:r})||ky({item:e,drawDefinition:t,structure:e,event:r})||$o(t)||$o(r)}}function tIe({matchUps:t}){let e=t.reduce((i,r)=>!r.collectionPosition||i.includes(r.collectionPosition)?i:i.concat(r.collectionPosition),[]).map(i=>({[i]:t.filter(r=>r.collectionPosition===i)}));return{collectionPositionMatchUps:Object.assign({},...e)}}function Ar({drawDefinition:t,structure:e}){let i={},r=[];return(t?.structures??[e]).filter(n=>n&&typeof n=="object").forEach(n=>{if(!n)return;let{structureId:a,matchUps:s,structures:o}=n,l=Array.isArray(o);if(l)l&&o.forEach(u=>{let{structureName:c}=u,d=u.matchUps;i[u.structureId]={matchUps:d,itemStructureIds:[],structureName:c},d&&(r.push(...d),d.forEach(p=>{p.tieMatchUps&&r.push(...p.tieMatchUps)})),i[a]||(i[a]={itemStructureIds:[],matchUps:[]}),i[a].itemStructureIds||(i[a].itemStructureIds=[]),i[a].itemStructureIds.push(u.structureId)});else{let u=s;i[a]={matchUps:u,itemStructureIds:[]},u?.forEach(c=>{r.push(c),c.tieMatchUps&&r.push(...c.tieMatchUps)})}}),{mappedMatchUps:i,drawMatchUps:r}}function gd({mappedMatchUps:t,matchUpsMap:e,structureId:i,inContext:r}){t=e?.mappedMatchUps??t;let n=t[i],a=(n?.itemStructureIds||[]).map(s=>{let{matchUps:o,structureName:l}=t[s];return r?o.map(u=>Object.assign(ke(u,!0,!0),{containerStructureId:i,structureId:s,structureName:l})):o}).flat();return(n?.matchUps||[]).concat(...a)}function gK({groupedOrder:t,roundPositionsCount:e}){if(!t||t?.length<=e)return t;let i=yr(t,t.length/e).map(n=>n.reduce((a,s)=>a+s)),r=i.slice().sort(ir);return i.map(n=>r.indexOf(n)+1)}function UR(t){if(!bt(t))return!1;let{matchUpId:e,drawPositions:i}=t,r=typeof e=="string",n=!i||Array.isArray(i)&&i.length<=2&&i.every(a=>ot(a)||a===void 0||a===null);return r&&n}function Ga(t){return Array.isArray(t)?t.every(UR):!1}function iIe(t,e){return e?.find(i=>t.includes(i))}function bn({matchUps:t=[],interpolate:e}){if(!Ga(t))return{roundMatchUps:[],error:ie};let i=t.reduce((d,p)=>{let f=typeof p.roundNumber=="string"?Ye(p.roundNumber):p.roundNumber;return!p.roundNumber||d.includes(f)?d:d.concat(f)},[]).sort(ir).map(d=>{let p=t.filter(h=>h.roundNumber===d),f=p.find(({matchUpType:h})=>h===Zt)?p.filter(({matchUpType:h})=>h===Zt):p,m=h=>h.sort((g,I)=>ir(g.roundPosition,I.roundPosition));return{[d]:m(f)}}),r=t.reduce((d,p)=>{let f=typeof p.roundNumber=="string"?Ye(p.roundNumber):p.roundNumber;return d[f]||(d[f]=Ve({abbreviatedRoundName:p.abbreviatedRoundName,finishingRound:p.finishingRound,roundName:p.roundName})),d},{}),n=Object.assign({},...i);if(e){let d=Math.max(...Object.keys(n).map(f=>Ye(f)).filter(f=>!Number.isNaN(f))),p=n[d]?.length;if(p>1&&Uo(p)){let f=d+1,m=f+p/2;Re(f,m).forEach((h,g)=>{n[h]=Re(0,p/(2+g*2)).map(()=>({}))})}}let a=0,s=Object.assign({},...Object.keys(n).map(d=>{let p=n[d]?.length,f=n[d]?.filter(h=>!Yi.includes(h.matchUpStatus)&&!h.score?.scoreStringSide1)?.length,m=p&&p===f;return a=Math.max(a,p),{[d]:{matchUpsCount:p,inactiveCount:f,inactiveRound:m}}})),o=0,l=0,u=Object.keys(n).map(d=>Ye(d)).filter(d=>!Number.isNaN(d));u.forEach(d=>{let p=n[d].sort((m,h)=>m.roundPosition-h.roundPosition),f=p.flatMap(m=>m?.drawPositions||[]);if(s[d].roundNumber=d,s[d].roundFactor=s[d].matchUpsCount?a/s[d].matchUpsCount:1,s[d].finishingRound=r[d]?.finishingRound,s[d].roundName=r[d]?.roundName,s[d].abbreviatedRoundName=r[d]?.abbreviatedRoundName,s[d].finishingPositionRange=n[d]?.[0]?.finishingPositionRange,d===1||!s[d-1]){let m=f.sort(ir),h=yr(m,2);s[d].drawPositions=m,s[d].pairedDrawPositions=h}else{let m=s[d-1],h=m.drawPositions,g=m.matchUpsCount/s[d].matchUpsCount,I=yr(h,g),v=p.map(w=>{let{roundPosition:y}=w,b=[...w.drawPositions||[],void 0,void 0].slice(0,2);if(!y)return b;let S=b?.filter(Boolean)||[];if(!S?.length)return[void 0,void 0];if(d<3&&S?.length===2)return b?.slice().sort(ir);let U=xi(h,S).length!==S?.length;if(S?.length&&U)return S?.length===1?[S[0],void 0]:b?.slice().sort(ir);let T=(y-1)*2;return I.slice(T,T+2).map(P=>iIe(P,S))});s[d].drawPositions=v?.flat(),s[d].pairedDrawPositions=v}s[d+1]?.matchUpsCount===s[d].matchUpsCount&&(s[d+1].feedRound=!0,s[d+1].feedRoundIndex=l,s[d].preFeedRound=!0,l+=1),s[d]&&!s[d].feedRound&&(s[d].roundIndex=o,o+=1)});let c=!!Object.values(s).some(({matchUpsCount:d})=>!Uo(d));return{hasNoRoundPositions:t.some(d=>!d.roundPosition),roundsNotPowerOf2:c,maxMatchUpsCount:a,roundMatchUps:n,roundNumbers:u,roundProfile:s,...H}}function YT(t){if(!Array.isArray(t))return"";let e=t.filter(Ni);return e.length?rt([Math.min(...e),Math.max(...e)]).join("-"):""}function rIe({drawDefinition:t,structureId:e,matchUpsMap:i}){if(!t)return{error:_e};if(!e)return{error:Va};let{structure:r}=et({drawDefinition:t,structureId:e});if(r?.stage!==Zr)return{error:Zp,info:"Structure is not CONSOLATION stage"};let{links:n}=t,a=n?.filter(d=>d.target.structureId===e)||[],s=a?.reduce((d,p)=>{let{structureId:f}=p.source;return d.includes(f)?d:d.concat(f)},[])||[],o=Object.assign({},...s.map(d=>{let p=gd({structureId:d,matchUpsMap:i}),f=bn({matchUps:p}).roundProfile;return{[d]:f}})),l=gd({matchUpsMap:i,structureId:e}),{roundProfile:u}=bn({matchUps:l}),c={};return a?.forEach(d=>{let{structureId:p,roundNumber:f}=d.source,{feedProfile:m,groupedOrder:h,positionInterleave:g,roundNumber:I}=d.target,v=o[p],w=v[1]?.drawPositions,y=v[f]?.matchUpsCount;if(!y)return;let b=y?w.length/y:0,S=w.length/b,U=w.slice(),T=gK({roundPositionsCount:S,groupedOrder:h}),P=T?.length||1;if(P<=S){let R=w.length/P,C=yr(U,R);m===Dp&&C.forEach(M=>M.reverse()),U=T?.length&&T?.map(M=>C[M-1]).flat()||C.flat()}let D=yr(U,b);if(g){let R=Re(0,g.interleave).map(()=>{}),C=Re(0,g.offset).map(()=>{});D=D.map(N=>[N,...R]),D.unshift(C),D=D.flat(1);let M=D.length-g.offset;D=D.slice(0,M)}c[I]||(c[I]={});let E=u?.[I]?.feedRound?2:1;D.forEach((R,C)=>{let M=1+C*E;c[I][M]||(c[I][M]=YT(R))})}),{sourceDrawPositionRanges:c}}function IK({drawDefinition:t}){if(typeof t!="object")return{error:em};let e={},{structures:i=[],links:r=[]}=t||{},n=i.reduce((s,o)=>{let{stage:l}=o;return s[l]?s[l].push(o):s[l]=[o],s},{});for(let s of Object.keys(n)){let o=n[s].find(({stageSequence:u})=>u===1);if(!o)continue;let{structureId:l}=o;a({aggregator:{},targetRound:0,exitProfiles:e,exitProfile:"0",structureId:l,stage:s})}return{exitProfiles:e};function a({exitProfiles:s,exitProfile:o,structureId:l,targetRound:u,aggregator:c,stage:d}){s[l]||(s[l]=[]),o==="0"&&[Zr,Ui].includes(d)||s[l].push(o);let p=r.filter(f=>f.source.structureId===l&&f.source.roundNumber>=u);for(let f of p){let m=f.source.roundNumber,h=f.target.roundNumber,g=f.target.structureId,I=i.find(w=>w.structureId===g).stage,v=[I,g,h,m].join("|");if(c[v])return;c[v]=!0,a({exitProfile:`${o}-${m}`,structureId:g,exitProfiles:s,targetRound:h,aggregator:c,stage:I})}}}function nIe({drawDefinition:t,roundProfile:e,structureId:i,matchUpsMap:r}){if(!t)return{error:_e};if(!i)return{error:Va};if(!e){let s=gd({matchUpsMap:r,structureId:i});if({roundProfile:e}=bn({matchUps:s}),!e)return{error:Xe}}let n=(Math.min(...e?.[1]?.drawPositions??[])||1)-1,a=Object.keys(e);return{drawPositionsRanges:Object.assign({},...(a||[]).map(s=>{let o=e?.[s]?.matchUpsCount,l=e?.[1]?.drawPositions??[],u=yr(l,l.length/o),c=u.map(YT),d=u.map(g=>g.map(I=>I-n)).map(YT),p=a.map(g=>{if(g>s)return;let I=e?.[g]?.drawPositions??[];return yr(I,I.length/o)}).filter(Boolean),f=Re(0,o).map(g=>p.map(I=>I[g]).flat().filter(Boolean).sort(ir)).map(g=>rt(g)),m=f.map(g=>Tme(g).map(YT).join(", ")),h=Object.assign({},...Re(0,o).map(g=>({[g+1]:{firstRoundDrawPositionsRange:c[g],firstRoundOffsetDrawPositionsRange:d[g],possibleDrawPositions:f[g],drawPositionsRange:m[g]}})));return{[s]:h}}))}}function JF({roundsNotPowerOf2:t,drawDefinition:e,structure:i,matchUps:r}){if(!i)return!1;r=r??i.matchUps??[],t=t??bn({matchUps:r}).roundsNotPowerOf2;let n=!!i.positionAssignments?.find(({drawPosition:a})=>a)||!!r?.find(({drawPositions:a})=>a?.length);return(!e?.drawType||e.drawType!==tf)&&!i?.structures&&t&&n}function Vn({structure:t}){if(!t)return!1;let e=t.matchUps||t.roundMatchUps&&Object.values(t.roundMatchUps).flat(),i=!!e?.find(n=>n?.roundPosition),r=!!e?.find(n=>n?.drawPositions?.length);return!t?.structures&&t?.stage!==Pr&&(!e.length||!i&&!r)}var vK={[lc]:{policyName:"Round Naming Default",namingConventions:{round:"Round",pre:"Pre"},qualifyingFinishMap:{1:"Final"},abbreviatedRoundNamingMap:{1:"F",2:"SF",4:"QF"},roundNamingMap:{1:"Final",2:"Semifinal",4:"Quarterfinal"},affixes:{roundNumber:"R",preFeedRound:"Q",preQualifying:"P"},stageConstants:{[xe]:"",[Ui]:"P",[We]:"Q",[Zr]:"C"}}},aIe=vK;function yK({roundNamingPolicy:t,drawDefinition:e,structure:i,matchUps:r}){let{roundProfile:n,roundMatchUps:a}=bn({matchUps:r}),{structureAbbreviation:s,stage:o}=i,l=Vn({structure:i}),u=JF({structure:i}),c=i.structures,d={},p=vK[lc],f=i.stage===We,m=f?Math.max(...(e?.structures??[]).filter(R=>R.stage===We).map(({stageSequence:R})=>R??1),0):0,h=(i.stageSequence??1)<m?i.stageSequence??1:"",g=h&&(t?.affixes?.preQualifying||p.affixes.preQualifying)||"",I=t?.roundNamingMap||p.roundNamingMap||{},v=t?.abbreviatedRoundNamingMap||p.abbreviatedRoundNamingMap||{},w=t?.affixes?.preFeedRound||p.affixes.preFeedRound,y=t?.affixes?.roundNumber||p.affixes.roundNumber,b=(t?.namingConventions||p.namingConventions).round,S=o&&o!==xe?o[0]:"",U=t?.stageConstants||p.stageConstants,T=o&&U?.[o]||S,P=`${g}${T}${h}`,D=n?Object.keys(n):[],E=f&&U?.[We]?`${U?.[We]}-`:"";if(c||l||u)Object.assign(d,...D.map(R=>{let C=`${E}${b} ${R}`,M=`${y}${R}`;return{[R]:{roundName:C,abbreviatedRoundName:M}}}));else{let R=f&&(t?.qualifyingFinishMap||p?.qualifyingFinishMap||{});Object.assign(d,...D.map(C=>{if(!n?.[C])return;let{matchUpsCount:M,preFeedRound:N}=n[C],A=M*2,O=R?.[n?.[C].finishingRound]||R&&`${y}${A}`||I[M]||`${y}${A}`,k=N?`-${w}`:"",F=`${O}${k}`,x=[P,s,F].filter(Boolean).join("-"),L=`${v[M]||`${y}${A}`}${k}`,$=[P,s,L].filter(Boolean).join("-");return{[C]:{abbreviatedRoundName:$,roundName:x}}}))}return{roundNamingProfile:d,roundProfile:n,roundMatchUps:a}}var sIe=(t,e)=>(t||0)+(e||0);function bK(t,e){let i=Array.isArray(t)?t[0]:t;return Number.isNaN(i)&&fK||i<=e[Tb]&&Tb||i<=e[Ub]&&Ub||qF}function wK({score:t}){let e=t?.sets||[],i=e.reduce((n,a)=>(n[0]+=a.side1Score||0,n[1]+=a.side2Score||0,n),[0,0]),r=e.reduce((n,a)=>(n[0]+=a.side1TiebreakScore||0,n[1]+=a.side2TiebreakScore||0,n),[0,0]);return r.reduce(sIe)&&(i[r[0]>r[1]?0:1]+=1),{sets:e,games:i,score:t}}function oIe(t){let e=Math.min(...t.games),i=Math.max(...t.games);return Math.round(e/i*100)}function SK(t){return t.map(oIe).sort().map(e=>parseFloat(e.toFixed(2)))}function iS({tournamentRecord:t,profileBands:e,matchUp:i}){if(!i)return{error:ea};let{score:r,winningSide:n}=i;if(!n)return{error:ie};let a=!e&&t&&af({policyType:ju,tournamentRecord:t}).policy,s=e||a?.profileBands||YF[ju].profileBands,o=wK({score:r}),l=SK([o]),u=bK(l,s),c=Array.isArray(l)?l[0]:l;return{...H,competitiveness:u,pctSpread:c}}function UK({matchUp:t}){if(!t)return{error:ea};if(t&&!t.sides)return{error:ta};if(t&&!t.hasContext)return{error:jE};let e=(t.sides??[])?.map(s=>s?.participantId).filter(Boolean),i=t.sides?.filter(s=>s.participant?.participantType===gt).map(s=>s.participantId).filter(Boolean)??[],r=((t.sides??[])?.map(s=>s.participant?.individualParticipants).filter(Boolean)??[]).map(s=>(s??[]).map(o=>o?.participantId).filter(Boolean)),n=[...i,...r.flat()].filter(Boolean)??[],a=rt(n.concat(e)).filter(Boolean)??[];return{nestedIndividualParticipantIds:r,allRelevantParticipantIds:a,individualParticipantIds:n,sideParticipantIds:e,...H}}var GD="CHECK_IN",HD="CHECK_OUT",lIe="SCHEDULE",dh="SCHEDULE.ASSIGNMENT.VENUE",lu="SCHEDULE.ALLOCATION.COURTS",Id="SCHEDULE.ASSIGNMENT.COURT",TR="SCHEDULE.COURT.ORDER",ph="SCHEDULE.DATE",uIe="COMPLETED.DATE",QF="HOME_PARTICIPANT_ID",ZF="SCHEDULE.ASSIGN.OFFICIAL",fh="SCHEDULE.TIME.SCHEDULED",mo="SCHEDULE.TIME.START",Qu="SCHEDULE.TIME.STOP",Gl="SCHEDULE.TIME.RESUME",hc="SCHEDULE.TIME.END",DR="SCHEDULE.TIME.MODIFIERS",TK="TO_BE_ANNOUNCED",DK="NEXT_AVAILABLE",PK="FOLLOWED_BY",EK="AFTER_REST",RK="RAIN_DELAY",cIe="NOT_BEFORE",uO=[TK,DK,PK,EK,RK],dIe="ELIGIBILITY",pIe="REGISTRATION",fIe="SUSPENSION",mIe="MEDICAL",hIe="PENALTY",CK="SCALE",MK="RATING",NK="RANKING",eL="SEEDING",Bd="PUBLISH",Ha="PUBLIC",Vd="STATUS",gIe="MODIFICATION",IIe="RETRIEVAL",vIe="other",yIe={MUTUALLY_EXCLUSIVE_TIME_MODIFIERS:uO,AFTER_REST:EK,ALLOCATE_COURTS:lu,ASSIGN_COURT:Id,ASSIGN_OFFICIAL:ZF,ASSIGN_VENUE:dh,CHECK_IN:GD,CHECK_OUT:HD,COMPLETED_DATE:uIe,COURT_ORDER:TR,ELIGIBILITY:dIe,END_TIME:hc,FOLLOWED_BY:PK,MEDICAL:mIe,MODIFICATION:gIe,NEXT_AVAILABLE:DK,NOT_BEFORE:cIe,OTHER:vIe,PENALTY:hIe,PUBLIC:Ha,PUBLISH:Bd,RANKING:NK,RATING:MK,RAIN_DELAY:RK,REGISTRATION:pIe,RESUME_TIME:Gl,RETRIEVAL:IIe,SCALE:CK,SCHEDULE:lIe,SCHEDULED_DATE:ph,SCHEDULED_TIME:fh,SEEDING:eL,START_TIME:mo,STATUS:Vd,STOP_TIME:Qu,SUSPENSION:fIe,TIME_MODIFIERS:DR,TO_BE_ANNOUNCED:TK};function mh({matchUp:t}){if(!t)return{error:ea};if(!t.hasContext)return{error:jE};if(!t.sides||t?.sides.filter(Boolean).length!==2)return{error:ta};let{nestedIndividualParticipantIds:e,allRelevantParticipantIds:i,sideParticipantIds:r}=UK({matchUp:t}),n=(t.timeItems??[]).filter(o=>o?.itemType&&[GD,HD].includes(o.itemType)).sort((o,l)=>(o.createdAt?new Date(o.createdAt).getTime():0)-(l.createdAt?new Date(l.createdAt).getTime():0)),a=n.map(o=>o.itemValue).filter(o=>n.filter(l=>l?.itemValue===o).reverse()[0].itemType===GD);e?.forEach((o,l)=>{let u=r?.[l],c=o?.length&&o.every(d=>a.includes(d));u&&c&&!a.includes(u)&&a.push(u)}),r?.forEach((o,l)=>{a.includes(o)&&(e?.[l]??[]).forEach(u=>{u&&!a.includes(u)&&a.push(u)})});let s=r?.reduce((o,l)=>a.includes(l)&&o,!0);return{allRelevantParticipantIds:i,allParticipantsCheckedIn:s,checkedInParticipantIds:a,...H}}var Di=t=>e=>{let i=bt(e)&&e?.matchUpType||ri(e)&&e;return i&&VY[t].includes(i)};function Oy(t){let{matchUpAverageTimes:e,matchUpFormat:i}=t||{},r=e?.map(({matchUpFormatCodes:a})=>a?.filter(s=>s===i)).flat().filter(Boolean).sort((a,s)=>(a?.length||0)-(s?.length||0))||[],n=r.includes(i)?i:r[0];return e?.find(({matchUpFormatCodes:a,averageTimes:s})=>a?.find(o=>n===o)&&s)?.averageTimes}function xy(t){let{matchUpRecoveryTimes:e,averageMinutes:i,matchUpFormat:r}=t||{};return e?.find(({matchUpFormatCodes:n,averageTimes:a,recoveryTimes:s})=>{if(a&&i){let{greaterThan:o=0,lessThan:l=360}=a;if(i>o&&i<l)return!0}return n?.find(o=>o===r)&&s})?.recoveryTimes}function AK({timesBlockArray:t,categoryName:e,categoryType:i}){return t.filter(r=>Array.isArray(r)).map(r=>r.sort((n,a)=>(a.categoryNames?.length||0)-(n.categoryNames?.length||0)).find(({categoryTypes:n,categoryNames:a})=>!a?.length&&!n?.length||a?.includes(e)||n?.includes(i))).find(Boolean)}function bIe({tournamentScheduling:t,eventScheduling:e,averageMinutes:i,defaultTiming:r,matchUpFormat:n,categoryName:a,categoryType:s,policy:o}){let l=e?.matchUpRecoveryTimes&&xy({...e,averageMinutes:i,matchUpFormat:n}),u=t?.matchUpRecoveryTimes&&xy({...t,averageMinutes:i,matchUpFormat:n}),c=o?.matchUpRecoveryTimes&&xy({...o,averageMinutes:i,matchUpFormat:n}),d=[l,u,c,o?.defaultTimes?.recoveryTimes,r?.recoveryTimes];return AK({categoryName:a,categoryType:s,timesBlockArray:d})}function wIe({matchUpFormat:t,categoryName:e,categoryType:i,defaultTiming:r,tournamentScheduling:n,eventScheduling:a,policy:s}){let o=a?.matchUpAverageTimes&&Oy({...a,matchUpFormat:t}),l=n?.matchUpAverageTimes&&Oy({...n,matchUpFormat:t}),u=s?.matchUpAverageTimes&&Oy({...s,matchUpFormat:t}),c=[o,l,u,s?.defaultTimes?.averageTimes,r?.averageTimes];return AK({categoryName:e,categoryType:i,timesBlockArray:c})}var kK="DOUBLES_SINGLES",OK="SINGLES_DOUBLES",Ls="total",cO="participantConflict",dO="potentialParticipantConflict",Za="matchUpConflict",xK="courtDoubleBooking",FK="positionLinkConflict",LK="ISSUE_IDS",Al="CONFLICT",kl="WARNING",by="ERROR",wy="ISSUE",KT="STATE",SIe="BLOCKED",UIe="PRACTICE",TIe="MAINTENANCE",DIe={SINGLES_DOUBLES:OK,DOUBLES_SINGLES:kK,TOTAL:Ls,CONFLICT_MATCHUP_ORDER:Za,CONFLICT_PARTICIPANTS:cO,CONFLICT_POTENTIAL_PARTICIPANTS:dO,CONFLICT_COURT_DOUBLE_BOOKING:xK,CONFLICT_POSITION_LINK:FK,SCHEDULE_ISSUE_IDS:LK,SCHEDULE_CONFLICT:Al,SCHEDULE_WARNING:kl,SCHEDULE_ERROR:by,SCHEDULE_ISSUE:wy,SCHEDULE_STATE:KT,BLOCKED:SIe,PRACTICE:UIe,MAINTENANCE:TIe};function rS({defaultAverageMinutes:t=90,defaultRecoveryMinutes:e=0,tournamentRecord:i,matchUpFormat:r,categoryName:n,categoryType:a,eventType:s,event:o}){if(!i)return{error:Ie};s=s??o?.eventType??Dm;let l={averageTimes:[{minutes:{default:t}}],recoveryTimes:[{minutes:{default:e}}]},{scheduleTiming:u}=Yw({tournamentRecord:i,categoryName:n,categoryType:a,event:o}),c={...u,matchUpFormat:r,categoryType:a,defaultTiming:l};return PR({eventType:s,timingDetails:c})}function PR({timingDetails:t,eventType:e}){let i=wIe(t),r=Object.keys(i?.minutes||{}),n=i?.minutes&&(r?.includes(e)&&i.minutes[e]||i.minutes.default),a=bIe({...t,averageMinutes:n}),s=Object.keys(a?.minutes||{}),o=a?.minutes&&(s?.includes(e)&&a.minutes[e]||a.minutes.default),l=Di(Dm)(e)?OK:kK,u=a?.minutes&&(s?.includes(l)&&a.minutes[l]||o);return{averageMinutes:n,recoveryMinutes:o,typeChangeRecoveryMinutes:u}}function bA(t){return t.createdAt?new Date(t.createdAt).getTime():0}function lf({timeItems:t,itemType:e}){let i=t.filter(n=>n&&n.itemType===e).sort((n,a)=>bA(n)-bA(a)).pop(),r=i&&bA(i);return{itemValue:i?.itemValue,timeStamp:r}}function tL({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:r,timeStamp:n}=lf({timeItems:i?.timeItems||[],itemType:fh});return!e||n&&t&&new Date(n).getTime()>new Date(t).getTime()?{scheduledTime:r}:e}function uf({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:r,timeStamp:n}=lf({timeItems:i?.timeItems||[],itemType:ph});return!e||n&&t&&new Date(n).getTime()>new Date(t).getTime()?{scheduledDate:r}:e}function Af(t){if(A4.test(t)){let e=rF();return new Date(`${e}T${t}`)}else return new Date(t)}function PIe({matchUp:t}){if(!t)return{error:ea};if(!t.timeItems)return{error:W1};let e=t.timeItems.filter(r=>[mo,Qu,Gl,hc].includes(r?.itemType)).sort((r,n)=>Af(r.itemValue).getTime()-Af(n.itemValue).getTime()),i=e.reduce((r,n)=>{let a,s=n?.itemType?.split("."),o=`SCHEDULE.TIME.${n?.itemType?.startsWith("SCHEDULE.TIME")&&s[2]}`;switch(o){case mo:a=0;break;case hc:if(r.lastValue&&[mo,Gl].includes(r.lastType)){let l=Af(n.itemValue).getTime()-Af(r.lastValue).getTime();a=r.milliseconds+l}else a=r.milliseconds;break;case Qu:if([mo,"SCHECULE.TIME.RESUME"].includes(r.lastType)){let l=Af(n.itemValue).getTime()-Af(r.lastValue).getTime();a=r.milliseconds+l}else a=r.milliseconds;break;default:a=r.milliseconds;break}return{milliseconds:a,lastType:o,lastValue:n.itemValue}},{milliseconds:0,lastType:void 0,lastValue:void 0});if([mo,Gl].includes(i.lastType)){let r=new Date().getTime()-Af(i.lastValue).getTime();i.milliseconds+=r}return{milliseconds:i.milliseconds,time:EIe(i.milliseconds),relevantTimeItems:e}}function EIe(t){let e=(i,r=2)=>("00"+i).slice(-r);return e(t/36e5|0)+":"+e(t%36e5/6e4|0)+":"+e(t%6e4/1e3|0)}function RIe({matchUp:t}){let e=t?.timeItems||[],i=r=>r.createdAt?new Date(r.createdAt).getTime():0;return{startTime:e.reduce((r,n)=>{let a=n.itemType===mo&&n;return a&&(!r||i(a)<i(r))?a:r},void 0)?.itemValue}}function WD(t){return parseInt(t)}function zD({startTime:t="",endTime:e=""}={}){if(!t||!e||!op.test(t)||!op.test(e))return!1;let[i,r]=t.split(":").map(WD),[n,a]=e.split(":").map(WD);return n<i?!1:!(i===n&&a<r)}function CIe(t,e){let[i,r]=t.startTime.split(":").map(WD),[n,a]=e.startTime.split(":").map(WD);return i<n?-1:i>n?1:r<a?-1:r>a?1:0}function ER({dateAvailability:t}){if(!t)return{error:M6};if(!Array.isArray(t))return{error:HT};let e="Dates must be formated => YYYY-MM-DD",i="Times must be 24 hour => 00:00";for(let r of t){if(typeof r!="object")return{error:HT};let{date:n,startTime:a,endTime:s,bookings:o=[]}=r;if(!a||!s)return{error:HT};if(n&&!rl.test(n))return{error:sr,dateAvailability:{date:n},info:e};if(!op.test(a))return{error:Ps,dateAvailability:{startTime:a},info:i};if(!op.test(s))return{error:Ps,dateAvailability:{endTime:s},info:i};if(a===s)return{error:Ps,dateAvailability:{startTime:a,endTime:s},info:"startTime and endTime are equivalent"};if(!zD({startTime:a,endTime:s}))return{error:Ps,dateAvailability:{startTime:a,endTime:s},info:"endTime must be after startTime"};if(o){if(!Array.isArray(o))return{error:CD};for(let l of o){if(typeof l!="object")return{error:CD};let{startTime:u,endTime:c}=l;if(!op.test(u))return{error:Ps,booking:{startTime:u},info:i};if(!op.test(c))return{error:Ps,booking:{endTime:c},info:i};if(u===c)return{error:Ps,dateAvailability:{startTime:u,endTime:c},info:"startTime and endTime are equivalent"};if(!zD({startTime:u,endTime:c}))return{error:Ps,dateAvailability:{startTime:u,endTime:c},info:"endTime must be after startTime"}}}}return{valid:!0}}function _K({tournamentRecord:t}){for(let e of t.venues??[])e.isPrimary&&delete e.isPrimary}function nS(t){let{disableNotice:e,venue:i,context:r}=t;if(typeof i!="object")return{error:ie};let n=Is(t);i.venueId||(i.venueId=Et());let a;for(let s of Object.values(n)){let o=MIe({disableNotice:!0,tournamentRecord:s,context:r,venue:i});if(o?.error)return o;a=o.venue}return e||at({topic:eK,payload:{venue:i}}),Ve({...H,venue:a})}function MIe({tournamentRecord:t,disableNotice:e,context:i,venue:r}){if(!t)return{error:Ie};if(!r)return{error:Xe,info:"missing venue"};if(t.venues||(t.venues=[]),r.venueId||(r.venueId=Et()),t.venues.reduce((n,a)=>n||a.venueId===r.venueId,void 0))return{error:X6};if(r.dateAvailability?.length){let n=ER({dateAvailability:r.dateAvailability});if(n.error)return n}if(r.defaultStartTime||r.defaultEndTime){if(!r.defaultStartTime||!r.defaultEndTime)return{error:ie,info:"both defaultStartTime and defaultEndTime are required"};if(!zD({startTime:r.defaultStartTime,endTime:r.defaultEndTime}))return{error:ie,info:"defaultEndTime must be after defaultStartTime"}}return i&&xt({element:r,extension:{value:i,name:_5}}),r.isPrimary&&_K({tournamentRecord:t}),t.venues.push(r),{...H,venue:ke(r)}}function Eu({tournamentRecords:t,tournamentRecord:e,venueId:i}){if(!e)return{error:Ie};if(!i)return{error:xd};let r=(e.venues??[]).reduce((n,a)=>a.venueId===i?a:n,void 0);if(!r&&t){let n=(Gw({tournamentRecords:t}).linkedTournamentIds??[])[e.tournamentId];for(let a of n){let s=t[a],o=Eu({tournamentRecord:s,venueId:i});if(o.success&&o.venue)return nS({tournamentRecord:e,venue:o.venue}),{...H,venue:r}}}return r?{...H,venue:r}:{error:ef}}function iL({convertExtensions:t,...e}){let{tournamentRecords:i,tournamentRecord:r,venueId:n}=e,a=Eu({tournamentRecords:i,tournamentRecord:r,venueId:n});return ke(a,t,!0)}function jd({tournamentRecords:t,tournamentRecord:e,courtId:i}){if(!e)return{error:Ie};if(!i)return{error:th};let r="findCourt",n,a;if((e.venues??[]).forEach(s=>{(s.courts??[]).forEach(o=>{o.courtId===i&&(n=o,a=s)})}),n)return{...H,court:n,venue:a};if(t){let s=(Gw({tournamentRecords:t}).linkedTournamentIds??[])[e.tournamentId];for(let o of s){let l=t[o],u=jd({tournamentRecord:l,courtId:i});if(u.success)return u.venue&&nS({tournamentRecord:e,venue:u.venue}),{...H,court:n,venue:a}}}return z({result:{error:nc},stack:r})}function rL(t){return ke(jd(t),!1,!0)}function RR({tournamentRecord:t,internalUse:e,courtId:i}){if(!t)return{error:Ie};if(!i)return{error:th};let r=jd({tournamentRecord:t,courtId:i});if(r.error)return r;let n=r.court&&(({altitude:a,courtId:s,courtName:o,courtDimensions:l,latitude:u,longitude:c,surfaceCategory:d,surfaceType:p,surfacedDate:f,pace:m,notes:h})=>({altitude:a,courtId:s,courtName:o,courtDimensions:l,latitude:u,longitude:c,surfaceCategory:d,surfaceType:p,surfacedDate:f,pace:m,notes:h}))(r.court);return{...H,courtInfo:ke(n,!1,e)}}function aI(t){let e=Ge(t,[{[mr]:!0},{venueId:!0,[xs]:xd}]);if(e.error)return e;let{tournamentRecord:i,venueId:r}=t,n=Eu({tournamentRecord:i,venueId:r});if(n.error)return n;let a=(n.venue?.courts??[]).map(l=>(({courtInfo:u})=>({...u}))(RR({courtId:l.courtId,internalUse:!0,tournamentRecord:i}))),s=n.venue&&(({venueId:l,venueName:u,venueAbbreviation:c})=>({venueAbbreviation:c,venueName:u,venueId:l}))(n.venue),o=s&&{...s,courtsInfo:a};return{...H,venueData:ke(o,!1,!0)}}function NIe({matchUp:t}){let e=t?.timeItems||[],i=r=>r.createdAt?new Date(r.createdAt).getTime():0;return{endTime:e.reduce((r,n)=>{let a=n.itemType===hc&&n;return a&&(!r||i(a)>i(r))?a:r},void 0)?.itemValue}}function $i({event:t,eventId:e}){if(!t)return{error:li};let i=mt({name:Xs,element:t})?.extension,r=e?ke(i?.value,!1,!0):i?.value;return e&&t.drawDefinitions?.forEach(n=>{r?.flights?.forEach(a=>{a.drawId===n.drawId&&Object.assign(a,{drawDefinition:n})})}),{flightProfile:r}}function jn(t){let{tournamentRecord:e,eventId:i,drawId:r}=t,n="findEvent",a={},s=t.tournamentRecords??(e&&{[e.tournamentId]:e})??{},o=Object.values(s).map(({events:u,tournamentId:c})=>(u&&u.forEach(d=>{a[d.eventId]={tournamentId:c}}),u??[])).flat(),l;if(r){let u,c=o.find(d=>{let p=(d?.drawDefinitions??[]).find(f=>f.drawId===r);if(p)u=p,l=a[d.eventId].tournamentId;else{let f=(d&&$i({event:d})?.flightProfile)?.flights?.find(m=>m.drawId===r);if(f)return l=a[d.eventId].tournamentId,{entries:f.drawEntries,drawName:f.drawName,tournamentId:l,drawId:r}}return p});if(c)return{event:c,drawDefinition:u,tournamentId:l}}if(i){let u=o.find(c=>c?.eventId===i);if(u)l=a[u.eventId].tournamentId;else return{event:void 0,drawDefinition:void 0,...z({result:{error:os},stack:n})};return{event:u,drawDefinition:void 0,tournamentId:l}}return{event:void 0,drawDefinition:void 0,...z({result:{error:Oa},context:{drawId:r,eventId:i},stack:n})}}function CR(t){let e=t.event,i=t.matchUpType,{scheduleVisibilityFilters:r,afterRecoveryTimes:n,tournamentRecord:a,usePublishState:s,scheduleTiming:o,matchUpFormat:l,publishStatus:u,matchUp:c}=t;if(!c)return{error:ea};if(n&&!c.matchUpType&&!t.matchUpType&&(e||a)&&c.drawId){let b=t.drawDefinition||e?.drawDefinitions?.find(U=>U.drawId===c.drawId);!b&&a&&({drawDefinition:b,event:e}=jn({drawId:c.drawId,tournamentRecord:a}));let S=c.structureId&&b?.structures?.find(({structureId:U})=>U===c.structureId);i=t.matchUpType||S?.matchUpType||b?.matchUpType||e?.eventType!==rr&&e?.eventType}let{milliseconds:d,time:p}=PIe({matchUp:c}),{startTime:f}=RIe({matchUp:c}),{endTime:m}=NIe({matchUp:c}),h,{eventIds:g,drawIds:I}=r??{};if((!g||g.includes(c.eventId))&&(!I||I.includes(c.drawId))){let b=X=>X.createdAt?new Date(X.createdAt).getTime():0,S=new Map,U=c.timeItems?.toSorted((X,Z)=>b(X)-b(Z))??[];for(let X of U)S.set(X.itemType,X.itemValue);let T=S.get(QF),P=S.get(lu),D=S.get(fh),E=S.get(DR),R=S.get(ph),C=S.get(ZF),M=S.get(TR),N=S.get(dh),A=S.get(Id),O,k,F,x,L,$=c.matchUpType??i;if(o&&D&&n&&$){let X={matchUpFormat:c.matchUpFormat??l,...o};({averageMinutes:k=0,recoveryMinutes:F=0,typeChangeRecoveryMinutes:x=0}=PR({timingDetails:X,eventType:$})),(k||F)&&(O=m?Xn(ci(m),F):Xn(D,k+F)),x&&(L=m?Xn(ci(m),x):Xn(D,k+x))}!R&&D&&(R=Qe(D));let V=ND({scheduledDate:R,scheduledTime:D}),_={},B=(a&&N&&aI({tournamentRecord:a,venueId:N}))?.venueData||{};N&&(_[N]=B);let{venueName:G,venueAbbreviation:j,courtsInfo:K}=B,Y=(A&&K?.find(X=>X.courtId===A))?.courtName;for(let X of P||[]){if(!a)break;X.venueId&&!_[X.venueid]&&(_[X.venueId]=aI({venueId:X.venueId,tournamentRecord:a})?.venueData);let Z=_[X.venueId];X.venueName=Z?.venueName;let J=Z?.courtsInfo?.find(ae=>ae.courtId===X.courtId);X.courtName=J?.courtName}h=Ve({typeChangeTimeAfterRecovery:L,timeAfterRecovery:O,scheduledDate:R,scheduledTime:D,isoDateString:V,homeParticipantId:T,venueAbbreviation:j,allocatedCourts:P,timeModifiers:E,venueName:G,venueId:N,courtOrder:M,courtName:Y,courtId:A,official:C,typeChangeRecoveryMinutes:x,recoveryMinutes:F,averageMinutes:k,milliseconds:d,startTime:f,endTime:m,time:p})}else h=Ve({milliseconds:d,startTime:f,endTime:m,time:p});let{scheduledDate:v}=uf({matchUp:c}),{scheduledTime:w}=tL({matchUp:c});if(s&&u?.displaySettings?.draws){let b=u.displaySettings.draws,S=(b?.[c.drawId]??b?.default)?.scheduleDetails;if(S){let U=(S.find(T=>v&&T.dates?.includes(v))??S.find(T=>!T.dates?.length))?.attributes;if(U){let T=Object.assign({},...Object.keys(h).map(P=>({[P]:!0})),U);h=Em({source:h,template:T})}}}let y=c.matchUpStatus&&Yi.includes(c.matchUpStatus)&&(Qe(m)||Qe(v)||Qe(w))||void 0;return{schedule:h,endDate:y}}function AIe({drawPositions:t,roundProfile:e,roundNumber:i}){let r=[void 0,void 0];if(KY(t))return{orderedDrawPositions:r,displayOrder:r};let n=e?.[i],a=n?.pairedDrawPositions?.find(o=>kn(o||[],t.filter(Boolean)))??r,s=n?.feedRound;if(YY(t)){let o=[...t].sort(ir);return{orderedDrawPositions:o.length===2?o:a,displayOrder:s?o:a}}if(s){let o=[t.find(l=>!isNaN(Ye(l))),void 0];return{orderedDrawPositions:o,displayOrder:o}}return{orderedDrawPositions:a,displayOrder:a}}function qD({collectionPosition:t,collectionId:e,lineUp:i}){let r=[],n=[];if(i){let a=o=>o===void 0?-1:o,s=i.map(o=>{let{collectionAssignments:l,participantId:u}=o,c=l?.find(d=>d.collectionPosition===t&&d.collectionId===e);return c&&{participantId:u,...c}}).filter(Boolean).sort((o,l)=>a(o.substitutionOrder)-a(l.substitutionOrder));for(let o of s){let{participantId:l,previousParticipantId:u,substitutionOrder:c}=o;r.includes(l)||(u&&n.push({previousParticipantId:u,substitutionOrder:c,participantId:l}),r=r.filter(d=>d!==u),r.push(l))}}return{assignedParticipantIds:r,substitutions:n}}function Qs({tournamentParticipants:t,tournamentRecord:e,participantIds:i}){let r="getPairedParticipant";if(!t&&!e)return{error:Ie};if(!Array.isArray(i)||i.length>2)return{error:ga};if(!i.length)return z({result:{error:Od},stack:r});t=t??e?.participants??[];let n=t.filter(o=>o.participantType===pt&&xi(i,o.individualParticipantIds).length===i.length&&o.individualParticipantIds.length===i.length),a=n[0];if(!a)return z({result:{error:Vi},stack:r});let s=ke(n.slice(1),!1,!0);return{participant:ke(a),duplicatedPairParticipants:s,...H}}function Cp({drawDefinition:t,participantId:e}){if(typeof t!="object")return{error:_e};if(typeof e!="string")return{error:lr};let{extension:i}=mt({element:t,name:uc});return{lineUp:(i?.value||{})[e]}}function kIe({tournamentParticipants:t,positionAssignments:e,collectionPosition:i,drawPositions:r=[],participantMap:n,drawDefinition:a,collectionId:s,sideLineUps:o,matchUpType:l}){if(!s||!i)return{};let u=({attribute:d,lineUp:p,teamParticipant:f})=>{let{assignedParticipantIds:m,substitutions:h}=qD({collectionPosition:i,collectionId:s,lineUp:p});if(l===$t){if(m?.length<=2){let g=n?.[m[0]]?.pairIdMap?.[m[1]],I=(g&&n[g]?.participant||Qs({participantIds:m,tournamentParticipants:t}).participant)?.participantId;return{[d]:{participantId:I,teamParticipant:f,substitutions:h}}}else if(m?.length>2)return{[d]:{teamParticipant:f,substitutions:h}}}else{let g=m?.[0];return g&&{[d]:{participantId:g,teamParticipant:f,substitutions:h}}}};if(!r?.length){let d=o?.map(p=>{let{teamParticipant:f,sideNumber:m}=p,h=p.lineUp||Cp({participantId:f.teamParticipantId,drawDefinition:a})?.lineUp;return u({attribute:m,lineUp:h,teamParticipant:f})}).filter(Boolean)||{};return{sideNumberCollectionAssignment:Object.assign({},...d)}}let c=r?.map(d=>{let p=e.find(g=>g.drawPosition===d)?.participantId,f=o?.find(g=>g?.drawPosition===d),m=f?.teamParticipant||p&&n?.[p]?.participant||t?.find(({participantId:g})=>g===p),h=f?.lineUp||Cp({participantId:p,drawDefinition:a})?.lineUp;return u({attribute:d,lineUp:h,teamParticipant:m})}).filter(Boolean)||{};return{drawPositionCollectionAssignment:Object.assign({},...c)}}function MR(t){let e=Ge(t,[{[Du]:!0}]);if(e.error)return e;let i=t?.matchUp,r=i?.matchUpType;if(!r&&i?.sides?.length){let n=i.sides.find(({participant:a})=>a)?.participant?.participantType;r=n===gt&&Wt||n===pt&&$t||n===Lt&&Lt||void 0}return{matchUpType:r}}function OIe({drawPositionCollectionAssignment:t,sideNumberCollectionAssignment:e,positionAssignments:i,displaySideNumber:r,seedAssignments:n,drawPosition:a,isFeedRound:s,sideNumber:o}){let l=i.find(f=>f.drawPosition&&f.drawPosition===a),u=a&&t,c=o&&e,d=u?u[a]?.participantId:l?.participantId,p=l?xIe({displaySideNumber:r,seedAssignments:n,participantId:d,assignment:l,sideNumber:o}):{...c?.[o]};if(s&&(o===1?Object.assign(p,{participantFed:!0}):Object.assign(p,{participantAdvanced:!0})),a&&u){let f=u[a]?.teamParticipant,m=u[a]?.participant,h=u[a]?.substitutions;m&&(p.participant=m),h&&(p.substitutions=h),f&&(p.teamParticipant=f)}return p}function xIe({displaySideNumber:t,seedAssignments:e,participantId:i,assignment:r,sideNumber:n}){let a={drawPosition:r.drawPosition,displaySideNumber:t,sideNumber:n};if(i){let s=FIe({seedAssignments:e,participantId:i});Object.assign(a,s,{participantId:i}),s?.seedNumber&&s?.seedValue===""&&(a.seedValue="~")}else r.bye&&Object.assign(a,{bye:!0});return r.qualifier&&Object.assign(a,{qualifier:!0}),a}function FIe({seedAssignments:t,participantId:e}){return t?.find(i=>!i.seedProxy&&i.participantId===e)}function $K({scheduleVisibilityFilters:t,sourceDrawPositionRanges:e,tournamentParticipants:i,positionAssignments:r,drawPositionsRanges:n,hydrateParticipants:a,afterRecoveryTimes:s,initialRoundOfPlay:o,additionalContext:l,roundNamingProfile:u,tournamentRecord:c,tieDrawPositions:d,appliedPolicies:p,isCollectionBye:f,seedAssignments:m,usePublishState:h,participantMap:g,contextContent:I,scheduleTiming:v,contextProfile:w,drawDefinition:y,publishStatus:b,scoringActive:S,matchUpTieId:U,isRoundRobin:T,roundProfile:P,sideLineUps:D,structure:E,context:R,matchUp:C,event:M}){l=l??{};let N=vn({drawDefinition:y,structure:E,matchUp:C,event:M})?.tieFormat,{roundOffset:A,structureId:O,structureName:k,stage:F,stageSequence:x}=E,{drawId:L,drawName:$,drawType:V}=y??{},_=N?.collectionDefinitions,B=C.collectionId&&_?.find(Q=>Q.collectionId===C.collectionId),G=C.collectionId?B?.matchUpFormat:C.matchUpFormat??E?.matchUpFormat??y?.matchUpFormat??M?.matchUpFormat,j=C.matchUpType||B?.matchUpType||E?.matchUpType||y?.matchUpType||!Di(rr)(M?.eventType)&&M?.eventType,K=f?"BYE":C.matchUpStatus,{schedule:Y,endDate:X}=CR({scheduleVisibilityFilters:t,afterRecoveryTimes:s,tournamentRecord:c,usePublishState:h,scheduleTiming:v,drawDefinition:y,matchUpFormat:G,publishStatus:b,matchUpType:j,matchUp:C,event:M}),Z=d??C.drawPositions??[],{collectionPosition:J,collectionId:ae,roundPosition:te}=C,ne=C.roundNumber??l.roundNumber,le=ae?kIe({tournamentParticipants:i,positionAssignments:r,collectionPosition:J,participantMap:g,drawDefinition:y,drawPositions:Z,collectionId:ae,sideLineUps:D,matchUpType:j}):void 0,de=u?.[ne]?.roundName||l.roundName,pe=u?.[ne]?.abbreviatedRoundName||l.abbreviatedRoundName,ge=P?.[ne]?.feedRound,Me=P?.[ne]?.preFeedRound,Pe=P?.[ne]?.roundFactor,Be=n?.[ne],fe=te?Be?.[te]:void 0,Te=e?.[ne],ce=B?.category?{...R?.category,...B.category}:R?.category??M?.category,ye=C.processCodes?.length&&C.processCodes||B?.processCodes?.length&&B?.processCodes||E?.processCodes?.length&&E?.processCodes||y?.processCodes?.length&&y?.processCodes||M?.processCodes?.length&&M?.processCodes||c?.processCodes,be=w?.withCompetitiveness&&iS({...I,matchUp:C}),Fe=C.finishingPositionRange??l.finishingPositionRange,we=F!==We&&ot(o)&&o+(ne||0),Ne=Q=>Ve(Q,void 0,!0),me={...Ne(R),...Ne({matchUpFormat:j===rr?void 0:G,tieFormat:j===rr?N:void 0,gender:B?.gender??M?.gender,endDate:C.endDate??X,discipline:M?.discipline,category:ce,finishingPositionRange:Fe,abbreviatedRoundName:pe,drawPositionsRange:fe,competitiveProfile:be,structureName:k,stageSequence:x,drawPositions:Z,matchUpStatus:K,processCodes:ye,isRoundRobin:T,matchUpTieId:U,preFeedRound:Me,matchUpType:j,roundFactor:Pe,roundOffset:A,structureId:O,roundNumber:ne,roundOfPlay:we,feedRound:ge,roundName:de,drawName:$,drawType:V,schedule:Y,drawId:L,stage:F}),...ke(Ne(C),!0,!0)};if(G&&C.score?.scoreStringSide1){let Q=zi(G),{bestOf:se,finalSetFormat:oe,setFormat:ue}=Q??{};(oe?.tiebreakSet||ue?.tiebreakSet||ue?.timed)&&(me.score.sets=me.score.sets.sort((ee,Se)=>ee.setNumber-Se.setNumber).map((ee,Se)=>{let De=Se+1===se&&oe?oe:ue,it=De?.tiebreakSet&&!De?.timed,Ue=De?.timed;return it?(ee.tiebreakSet=!0,[1,2].includes(ee.winningSide)&&(ee.side1Score=ee.winningSide===1?1:0,ee.side2Score=ee.winningSide===2?1:0)):Ue&&(ee.timed=!0),ee}))}if(Array.isArray(Z)){let{orderedDrawPositions:Q,displayOrder:se}=AIe({drawPositions:Z,roundProfile:P,roundNumber:ne}),oe=P?.[ne]?.feedRound,ue=se[0]!==Q[0],ee=Q.concat(void 0,void 0).slice(0,2).map((Se,De)=>{let it=De+1,Ue=ue?3-it:it,ut=OIe({...le,positionAssignments:r,displaySideNumber:Ue,seedAssignments:m,drawPosition:Se,isFeedRound:oe,sideNumber:it}),yi=C.sides?.find(oi=>oi.sideNumber===it),qe=te?(te-1)*2+De+1:void 0,bi=qe?Te?.[qe]:void 0;return Ne({sourceDrawPositionRange:bi,...yi,...ut})});Object.assign(me,ke({sides:ee},!0,!0))}if(i&&me.sides){let Q=p?.[Bw],se=oe=>{let ue=g?.[oe]?.participant;return ue&&Em({template:Q?.participant,source:ue})};if(me.sides.filter(Boolean).forEach(oe=>{if(oe.participantId){let ue=ke(se(oe.participantId)||(i?fd({policyDefinitions:p,participantId:oe.participantId,tournamentParticipants:i,internalUse:!0,contextProfile:w}):void 0),void 0,!0);if(ue){let ee,Se;if(y?.entries){let De=y.entries.find(Ue=>Ue.participantId===oe.participantId),it=M?.entries?.find(Ue=>Ue.participantId===oe.participantId);ee=De?.entryStatus||it?.entryStatus,ue.entryStatus=ee,De?.entryStage&&(Se=De.entryStage,ue.entryStage=Se)}a===!1?Object.assign(oe,{participant:{entryStage:Se,entryStatus:ee}}):Object.assign(oe,{participant:ue})}}if(oe?.participant?.individualParticipantIds?.length&&!oe.participant.individualParticipants?.length){let ue=oe.participant.individualParticipantIds.map(ee=>se(ee)||(i?fd({policyDefinitions:p,tournamentParticipants:i,internalUse:!0,contextProfile:w,participantId:ee}):void 0));a!==!1&&Object.assign(oe.participant,{individualParticipants:ue})}}),!me.matchUpType){let{matchUpType:oe}=MR({matchUp:me});oe&&Object.assign(me,{matchUpType:oe})}if(w?.inferGender&&(!me.gender||me.gender===ah)&&me.sides?.length===2&&me.matchUpType!==rr){let oe=me.sides.map(ue=>{if(Di(Wt)(me.matchUpType))return ue.participant?.person?.sex;if(ue.participant?.individualParticipants?.length===2){let ee=rt(ue.participant.individualParticipants.map(Se=>Se.person?.sex)).filter(Boolean);if(ee.length===1)return ee[0]}});if(oe.filter(Boolean).length===2&&rt(oe).length===1){let ue=oe[0];me.inferredGender=ue}}}if(me.tieMatchUps){let Q=me.matchUpStatus==="BYE",se=me.sides?.map(({participant:oe,drawPosition:ue,sideNumber:ee,lineUp:Se})=>{let De=oe?.participantType===rr&&oe;return{teamParticipant:De&&Ve({participantRoleResponsibilities:De.participantRoleResponsibilities,participantOtherName:De.participanOthertName,participantName:De.participantName,participantId:De.participantId,teamId:De.teamId}),drawPosition:ue,sideNumber:ee,lineUp:Se}});me.tieMatchUps=me.tieMatchUps.map(oe=>{let ue=me.matchUpId,ee={finishingPositionRange:me.finishingPositionRange,abbreviatedRoundName:pe,roundNumber:ne,roundName:de};return $K({tieDrawPositions:Z,scheduleVisibilityFilters:t,sourceDrawPositionRanges:e,sideLineUps:se,drawPositionsRanges:n,initialRoundOfPlay:o,roundNamingProfile:u,additionalContext:ee,appliedPolicies:p,isCollectionBye:Q,usePublishState:h,publishStatus:b,matchUpTieId:ue,isRoundRobin:T,roundProfile:P,matchUp:oe,event:M,tournamentParticipants:i,positionAssignments:r,tournamentRecord:c,seedAssignments:m,participantMap:g,contextContent:I,scheduleTiming:v,contextProfile:w,drawDefinition:y,scoringActive:S,structure:E,context:R})})}let Ee=me.sides?.filter(Q=>Q?.participantId).length===2,Le=!me.winningSide;if(Object.assign(me,{readyToScore:S&&Ee&&Le,hasContext:!0}),Ee){let{allParticipantsCheckedIn:Q,checkedInParticipantIds:se}=mh({matchUp:me});Object.assign(me,{allParticipantsCheckedIn:Q,checkedInParticipantIds:se})}return Array.isArray(w?.exclude)&&w?.exclude.forEach(Q=>delete me[Q]),me}function LIe({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:r,timeStamp:n}=lf({timeItems:i?.timeItems||[],itemType:lu});return!e||n&&t&&new Date(n).getTime()>new Date(t).getTime()?{allocatedCourts:ke(r,!1,!0)}:e}function _Ie({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:r,timeStamp:n}=lf({timeItems:i?.timeItems||[],itemType:Id});return!e||n&&t&&new Date(n).getTime()>new Date(t).getTime()?{courtId:r}:e}function $Ie({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:r,timeStamp:n}=lf({timeItems:i?.timeItems||[],itemType:dh});return!e||n&&t&&new Date(n).getTime()>new Date(t).getTime()?{venueId:r}:e}function Gu(t){if(!Array.isArray(t.matchUps))return[];let{matchUps:e,excludeMatchUpStatuses:i,hasParticipantsCount:r,isCollectionMatchUp:n,matchUpStatuses:a,hasWinningSide:s,matchUpFormats:o,roundPositions:l,matchUpFormat:u,collectionIds:c,isMatchUpTie:d,roundNumbers:p,matchUpIds:f,roundNames:m,filterMatchUpTypes:h=!0,filterMatchUpIds:g=!0,stageSequences:I,scheduledDates:v,scheduledDate:w,participantIds:y,processContext:b,tournamentIds:S,matchUpTypes:U,structureIds:T,readyToScore:P,courtIds:D,eventIds:E,venueIds:R,drawIds:C,stages:M}=t,N=Array.isArray(y)?y.filter(Boolean):[],A=Array.isArray(a)?a.filter(Boolean):[],O=Array.isArray(i)?i.filter(Boolean):[],k=Array.isArray(M)?M.filter(Boolean):[],F=Array.isArray(I)?I.filter(Boolean):[],x=Array.isArray(c)?c.filter(Boolean):[],L=Array.isArray(m)?m.filter(Boolean):[],$=Array.isArray(p)?p.filter(Boolean):[],V=Array.isArray(l)?l.filter(Boolean):[],_=Array.isArray(f)&&g?f.filter(Boolean):[],B=Array.isArray(U)&&h?U.filter(Boolean):[],G=Array.isArray(D)?D.filter(Boolean):[],j=Array.isArray(R)?R.filter(Boolean):[],K=Array.isArray(o)&&o.filter(Boolean)||typeof u=="string"&&[u]||[],Y=Array.isArray(v)&&v.filter(Boolean)||typeof w=="string"&&w.length&&[w]||[],X=Array.isArray(S)?S.filter(Boolean):[],Z=Array.isArray(E)?E.filter(Boolean):[],J=Array.isArray(C)?C.filter(Boolean):[],ae=Array.isArray(T)?T.filter(Boolean):[];return e.filter(te=>{if(P&&!Di(ka)(te)&&!te.readyToScore||te.winningSide&&s&&![1,2].includes(te.winningSide)||d!==void 0&&(d&&!te.tieMatchUps||!d&&te.tieMatchUps)||n!==void 0&&(n&&!te.collectionId||!n&&te.collectionId)||k.length&&!k.includes(te.stage)||F.length&&!F.includes(te.stageSequence)||x.length&&(!te.collectionId||!x.includes(te.collectionId))||L.length&&(!te.roundName||!L.includes(te.roundName))||$.length&&(!te.roundNumber||!$.includes(te.roundNumber))||V.length&&(!te.roundPosition||!V.includes(te.roundPosition))||A.length&&(!te.matchUpStatus||!A.includes(te.matchUpStatus))||O.length&&te.matchUpStatus&&O.includes(te.matchUpStatus)||_.length&&!_.includes(te.matchUpId)||B.length&&(!te.matchUpType||!Zf(B,te.matchUpType))||K.length&&(!te.matchUpFormat||!K.includes(te.matchUpFormat)))return!1;if(Y?.length){let{scheduledTime:ne}=tL({matchUp:te}),{scheduledDate:le}=uf({matchUp:te}),de=Qe(ne)||le;if(!Y.some(pe=>tu(pe,de)))return!1}if(G.length){let{courtId:ne}=_Ie({matchUp:te}),{allocatedCourts:le}=LIe({matchUp:te}),de=le?.map(({courtId:pe})=>pe);if(!G.filter(Boolean).includes(ne)||de?.includes(ne))return!1}if(j.length){let{venueId:ne}=$Ie({matchUp:te});if(!j.filter(Boolean).includes(ne))return!1}if(b){if(X.length&&!X.includes(te.tournamentId)||Z.length&&!Z.includes(te.eventId)||J.length&&!J.includes(te.drawId)||ae.length&&!ae.includes(te.structureId))return!1;let ne=te.sides?.map(({participantId:le})=>le).filter(Boolean)??[];if(r&&ne.length<r||N.length&&!N.some(le=>ne.includes(le)))return!1}return!0})}function Nt(t){let{provisionalPositioning:e,tournamentRecord:i,contextFilters:r,matchUpFilters:n,contextProfile:a,drawDefinition:s,context:o={},structure:l,inContext:u,event:c}=t,{seedAssignments:d,contextContent:p,exitProfiles:f,matchUpsMap:m}=t,h={},g={};if(!l)return{collectionPositionMatchUps:h,error:Qp,roundMatchUps:g,matchUps:[]};let I=Array.isArray(n?.eventIds)?n?.eventIds.filter(Boolean):[],v=Array.isArray(n?.structureIds)?n?.structureIds.filter(Boolean):[],w=Array.isArray(n?.drawIds)?n?.drawIds.filter(Boolean):[],y=!o?.eventId||!I?.length&&!r?.eventIds?.filter(Boolean).length||I?.includes(o.eventId)||r?.eventIds?.includes(o.eventId),b=!v?.length||v.includes(l.structureId),S=!s||!w?.length||w.includes(s.drawId);if(!y||!b||!S)return{collectionPositionMatchUps:h,roundMatchUps:g,matchUps:[]};a&&!p&&(p=Fc({tournamentRecord:i,contextProfile:a,drawDefinition:s}));let{appliedPolicies:U}=Tt({drawDefinition:s}),T={...t.tournamentAppliedPolicies,...U,...t.policyDefinitions},P=T?.scoring?.structures,D=l.stage&&P?.stage?.[l.stage],E=l.stageSequence&&D?.stageSequence?.[l.stageSequence],R=T?.scoring?.requireAllPositionsAssigned||D?.requireAllPositionsAssigned||E?.requireAllPositionsAssigned;m||(m=Ar({drawDefinition:s,structure:l}));let{positionAssignments:C,allPositionsAssigned:M}=ur({structure:l}),N=!R||M,{seedAssignments:A}=ds({provisionalPositioning:e,drawDefinition:s,structure:l});d=d??A;let{structureId:O}=l;f=f||s&&IK({drawDefinition:s}).exitProfiles;let k=f?.[O],F=k?.length&&(k[0].split("-").map(G=>parseInt(G)).reduce((G,j)=>G+j)||0),x=!!l.structures,L=gd({matchUpsMap:m,structureId:O,inContext:u}),$=T?.[lc],V=yK({roundNamingPolicy:$,drawDefinition:s,structure:l,matchUps:L}),{roundNamingProfile:_,roundProfile:B}=V;if(g=V?.roundMatchUps??[],n&&(L=Gu({matchUps:L,...n,filterMatchUpTypes:!1,filterMatchUpIds:!1})),u){let{sourceDrawPositionRanges:G}=rIe({drawDefinition:s,matchUpsMap:m,structureId:O}),j=s?nIe({drawDefinition:s,roundProfile:B,matchUpsMap:m,structureId:O}).drawPositionsRanges:void 0,K=t.tournamentParticipants,Y=t.participantMap;!K?.length&&!Y&&i&&({participants:K=[],participantMap:Y}=nf({participantsProfile:t.participantsProfile,useParticipantMap:t.useParticipantMap,policyDefinitions:t.policyDefinitions,tournamentRecord:i,contextProfile:a,inContext:u})),L=L.map(X=>$K({scheduleVisibilityFilters:t.scheduleVisibilityFilters,hydrateParticipants:t.hydrateParticipants,afterRecoveryTimes:t.afterRecoveryTimes,usePublishState:t.usePublishState,scheduleTiming:t.scheduleTiming,publishStatus:t.publishStatus,sourceDrawPositionRanges:G,tournamentParticipants:K,positionAssignments:C,drawPositionsRanges:j,initialRoundOfPlay:F,roundNamingProfile:_,tournamentRecord:i,appliedPolicies:T,seedAssignments:d,contextContent:p,participantMap:Y,contextProfile:a,drawDefinition:s,scoringActive:N,isRoundRobin:x,roundProfile:B,structure:l,context:o,matchUp:X,event:c})),(L?.filter(X=>Array.isArray(X.tieMatchUps))).forEach(X=>{let Z=X.tieMatchUps;L=L.concat(...Z)}),r&&(L=Gu({processContext:!0,...r,matchUps:L}))}else(L?.filter(G=>Array.isArray(G.tieMatchUps))).forEach(G=>{let j=G.tieMatchUps;L=L.concat(...j)});return n&&(L=Gu({matchUps:L,...n,filterMatchUpTypes:!1,filterMatchUpIds:!1})),(n?.matchUpTypes||n?.matchUpIds)&&(L=Gu({matchUpTypes:n.matchUpTypes,matchUpIds:n.matchUpIds,matchUps:L})),(n?.matchUpTypes||n?.matchUpIds||u)&&(g=bn({matchUps:L}).roundMatchUps??[]),vn({drawDefinition:s,structure:l,event:c})?.tieFormat&&({collectionPositionMatchUps:h}=tIe({matchUps:L})),{collectionPositionMatchUps:h,roundMatchUps:g,isRoundRobin:x,roundProfile:B,matchUpsMap:m,matchUps:L}}function fp({matchUp:t}){return t?Yi.includes(t?.matchUpStatus)||t?.winningSide:!1}function NR({requireParticipants:t=!0,scheduleVisibilityFilters:e,tournamentAppliedPolicies:i,tournamentParticipants:r,hydrateParticipants:n,afterRecoveryTimes:a,policyDefinitions:s,tournamentRecord:o,usePublishState:l,matchUpFilters:u,contextFilters:c,contextContent:d,participantMap:p,scheduleTiming:f,publishStatus:m,contextProfile:h,drawDefinition:g,exitProfiles:I,matchUpsMap:v,structureId:w,inContext:y,structure:b,context:S,event:U}){!b&&w&&({structure:b}=et({drawDefinition:g,structureId:w}));let T=Nt({tournamentAppliedPolicies:i,scheduleVisibilityFilters:e,tournamentParticipants:r,hydrateParticipants:n,afterRecoveryTimes:a,policyDefinitions:s,tournamentRecord:o,usePublishState:l,matchUpFilters:u,contextFilters:c,contextContent:d,participantMap:p,scheduleTiming:f,publishStatus:m,contextProfile:h,drawDefinition:g,exitProfiles:I,matchUpsMap:v,structure:b,inContext:y,context:S,event:U}),P=[],D=[],E=[],R=[],C=[];if(T.error)return T;let{matchUps:M}=T,{assignedPositions:N}=ur({structure:b}),A=N?.filter(k=>k.participantId).map(k=>k.drawPosition),O;return M.filter(k=>{let F=u?.matchUpTypes?.length===1&&u.matchUpTypes[0]===Zt;return!(k.matchUpType!==Zt&&F)}).forEach(k=>{if(k.matchUpStatus===us){P.push(k);return}k.matchUpType===Zt&&(O=!0);let F=!!k.collectionId,x=F&&k.sides?.every(G=>G.participantId),L=!F&&k.drawPositions?.filter(Boolean).length===2,$=!F&&k.drawPositions?.every(G=>A?.includes(G)),V=N?.filter(G=>G.bye).map(G=>G.drawPosition),_=!F&&k.drawPositions?.find(G=>V?.includes(G)),B=X5.includes(k.matchUpStatus)&&(x||L&&(!t||$));return _?C.push(k):fp({matchUp:k})?D.push(k):B?E.push(k):R.push(k)}),{includesTeamMatchUps:O,abandonedMatchUps:P,completedMatchUps:D,upcomingMatchUps:E,pendingMatchUps:R,byeMatchUps:C,structure:b}}function BIe({drawDefinition:t,roundNumber:e,structureId:i}){if(!t)return{error:_e};if(!i)return{error:Va};let{links:r}=sv({drawDefinition:t,structureId:i}),n=r.source.reduce((s,o)=>!o.source.roundNumber||o.source.roundNumber===e?s.concat(o):s,[]),a=r.target.reduce((s,o)=>!o.target.roundNumber||o.target.roundNumber===e?s.concat(o):s,[]);return{links:{source:n,target:a}}}function wA({finishingPositions:t,linkCondition:e,linkType:i,source:r}){let n=r.find(a=>{let s=!a.source?.finishingPositions||!t||kn(t,a.source?.finishingPositions);return e===a.linkCondition&&s&&a.linkType===i});return[ru,nu].includes(n?.linkType)&&!n?.source?.roundNumber?z({result:{error:ie},stack:"getTargetLink",context:n}):n}function sv({drawDefinition:t,structureId:e,roundNumber:i}){return t?e?{links:(t.links||[]).filter(Boolean).reduce((r,n)=>(n.source?.structureId===e&&(!i||n.source.roundNumber===i)&&(r.source=r.source.concat(n)),n.target?.structureId===e&&(!i||n.target.roundNumber===i)&&(r.target=r.target.concat(n)),r),{source:[],target:[]})}:{error:Va}:{error:_e}}function VIe({structureMatchUps:t,matchUp:e}){let{roundNumber:i,roundPosition:r}=e,n=t.filter(s=>s.roundNumber===i&&!s.matchUpTieId),a=t.filter(s=>s.roundNumber===i+1&&!s.matchUpTieId);if(a.length){let s;return a.length===n.length?s=a.find(o=>o.roundPosition===r):a.length===n.length/2&&(s=a.find(o=>o.roundPosition===Math.ceil(r/2))),{matchUp:s}}return{message:"no progression found"}}function SA({sourceRoundMatchUpCount:t,inContextDrawMatchUps:e,sourceRoundPosition:i,drawDefinition:r,targetLink:n}){if(!n)return{error:M1};let{target:{structureId:a,feedProfile:s,groupedOrder:o,roundNumber:l,positionInterleave:u}}=n,{structure:c}=et({drawDefinition:r,structureId:a}),{positionAssignments:d}=Yt({structure:c}),p=(e?.filter(P=>P.structureId===c?.structureId)).filter(P=>P.roundNumber===l&&!P.matchUpTieId),f=p.length,m=Re(1,f+1),h=f/t,g=Math.ceil(h*i),I=1-i%2;if(u?.interleave&&h!==.5){let P=u.offset+(i-1)*u.interleave,D=i+P;g=Math.ceil(D/2),I=1-D%2}let v=m,w=m[g-1],y=gK({roundPositionsCount:m.length,groupedOrder:o}),b=y?.length||1;if(b<=m.length){let P=f/b,D=yr(m,P);s===Dp&&D.forEach(E=>E.reverse()),v=y?.length&&y?.map(E=>D[E-1]).flat()||v}s===Ms?w=v[g-1]:s===Dp?((!y?.length||b>m.length)&&(g=p.length+1-g),w=v[g-1]):s===rR&&ia()&&console.log(Y1,{feedProfile:s});let S=w&&p.reduce((P,D)=>D.roundPosition===w?D:P,void 0),U;S?.feedRound?(I=0,U=Math.min(...(S.drawPositions||[]).filter(Boolean))):U=S?.drawPositions?.length===2&&S?.drawPositions[I];let T=d?.find(({drawPosition:P})=>P===U);if(T){let{extension:P}=mt({element:T,name:hR});if(P?.value)return{disabledDrawPosition:U}}return{matchUp:S,targetDrawPosition:U,matchUpDrawPositionIndex:I}}function On({inContextDrawMatchUps:t=[],useTargetMatchUpIds:e,inContextMatchUp:i,drawDefinition:r,matchUpId:n}){let a=i;t.length&&!a&&(a=t.find(o=>o.matchUpId===n));let{structure:s}=et({structureId:a?.structureId,drawDefinition:r});return s?.finishingPosition===oh?jIe({inContextDrawMatchUps:t,useTargetMatchUpIds:e,drawDefinition:r,structure:s,matchUp:a}):GIe({matchUp:a})}function jIe({inContextDrawMatchUps:t,useTargetMatchUpIds:e,drawDefinition:i,structure:r,matchUp:n}){let{winnerMatchUpId:a,loserMatchUpId:s}=n,{links:o}=BIe({roundNumber:n.roundNumber,structureId:r.structureId,drawDefinition:i}),l=o?.source,u=wA({source:l,linkType:ru}),c=wA({linkCondition:al,linkType:nu,source:l}),d=wA({source:l,linkType:nu}),p=c&&d;d||(d=c);let f=u?.target?.feedProfile,m=d?.target?.feedProfile,h=c?.target?.feedProfile,g,I,v,w,y,b,S,U,T,P;if(e&&(a||s)&&(S=a&&f!==Cs&&t.find(({matchUpId:R})=>R===a),w=s&&m!==Cs&&t.find(({matchUpId:R})=>R===s),S||w))return{matchUp:n,targetLinks:{loserTargetLink:d,winnerTargetLink:u},targetMatchUps:{loserMatchUp:w,winnerMatchUp:S}};let{roundPosition:D}=n;P=P||t.filter(R=>R.structureId===r.structureId);let E=P.reduce((R,C)=>C.roundNumber===n.roundNumber&&!C.matchUpTieId?R+1:R,0);return d&&!w&&m!==Cs&&({matchUpDrawPositionIndex:b,targetDrawPosition:y,matchUp:w}=SA({targetLink:d,sourceRoundMatchUpCount:E,inContextDrawMatchUps:t,sourceRoundPosition:D,drawDefinition:i})),p&&h!==Cs&&({matchUpDrawPositionIndex:v,targetDrawPosition:I,matchUp:g}=SA({targetLink:c,sourceRoundMatchUpCount:E,inContextDrawMatchUps:t,sourceRoundPosition:D,drawDefinition:i})),u&&!S&&f!==Cs&&({matchUpDrawPositionIndex:T,targetDrawPosition:U,matchUp:S}=SA({targetLink:u,sourceRoundMatchUpCount:E,inContextDrawMatchUps:t,sourceRoundPosition:D,drawDefinition:i})),S||(P=P||t.filter(R=>R.structureId===r.structureId),{matchUp:S}=VIe({structureMatchUps:P,matchUp:n})),Ve({matchUp:n,targetLinks:{loserTargetLink:d,winnerTargetLink:u,byeTargetLink:c},targetMatchUps:{winnerMatchUpDrawPositionIndex:T,loserMatchUpDrawPositionIndex:b,byeMatchUpDrawPositionIndex:v,winnerTargetDrawPosition:U,loserTargetDrawPosition:y,byeTargetDrawPosition:I,winnerMatchUp:S,loserMatchUp:w,byeMatchUp:g},targetMatchUpIds:!!(a||s)})}function GIe({matchUp:t}){return{targetLinks:{loserTargetLink:void 0,winnerTargetLink:void 0},targetMatchUps:{loserMatchUp:void 0,winnerMatchUp:void 0},matchUp:t}}function HIe({drawDefinition:t,inContextDrawMatchUps:e}){let i={};return e.forEach(r=>{let{matchUpId:n,structureId:a,drawPositions:s=[]}=r,{structure:o}=et({drawDefinition:t,structureId:a});if(o?.finishingPosition===Pp){let{roundNumber:l}=r,u=l&&Ye(l)+1,c=o.matchUps??[],{roundMatchUps:d}=bn({matchUps:c});if(u&&d?.[u]){let p=[...s].sort(ir).map((f,m)=>{let h=d[u].find(g=>g.drawPositions?.includes(f));return{matchUpId:h?.matchUpId,roundNumber:u,schedule:h?.schedule,sideNumber:m+1,structureName:o.structureName}});Object.assign(r,{sidesTo:p})}}else{let l=On({useTargetMatchUpIds:!0,inContextDrawMatchUps:e,inContextMatchUp:r,drawDefinition:t,matchUpId:n}),{winnerMatchUp:u}=l.targetMatchUps,{loserMatchUp:c}=l.targetMatchUps;!r.winnerMatchUpId&&u&&(r.winnerMatchUpId=u.matchUpId),!r.loserMatchUpId&&c&&(r.loserMatchUpId=c.matchUpId);let d=UA({upcomingMatchUp:u}),p=UA({upcomingMatchUp:c});if(r.matchUpStatus!=="BYE"&&c?.matchUpStatus==="BYE"){let{matchUp:m}=BK({matchUp:c,drawDefinition:t,inContextDrawMatchUps:e})||{};p=m&&UA({upcomingMatchUp:m})||p}let f=r.schedule?.timeAfterRecovery;if(f&&(d?.schedule?.scheduledTime&&Pt(d.schedule.scheduledTime)<Pt(f)&&(i[d.matchUpId]=r.matchUpId,d.schedule.scheduleConflict=r.matchUpId),p?.schedule?.scheduledTime&&Pt(p.schedule.scheduledTime)<Pt(f)&&(i[p.matchUpId]=r.matchUpId,p.schedule.scheduleConflict=r.matchUpId)),Object.assign(r,{winnerTo:d,loserTo:p}),r.drawPositions?.filter(Boolean).length){let m=l.targetLinks?.loserTargetLink?.linkCondition===al,h=WIe(r);if(h.length){let g=aO(u?.sides),I=aO(c?.sides),v=h.find(({participantId:y})=>g.includes(y))?[]:h,w=h.find(({participantId:y})=>I.includes(y))?[]:h;c&&m&&w.length<2&&w.push({bye:!0,tbd:!0}),v?.length&&u&&(!l.targetMatchUpIds&&u&&(u=e.find(({matchUpId:y})=>y===u.matchUpId)),u.potentialParticipants||(u.potentialParticipants=[]),u.potentialParticipants.push(v)),w?.length&&c&&(l.targetMatchUpIds||(u=e.find(({matchUpId:y})=>y===c.matchUpId)),c.potentialParticipants||(c.potentialParticipants=[]),c.potentialParticipants.push(w))}}}}),Object.keys(i).length&&e.forEach(r=>{Object.keys(i).includes(r.matchUpId)&&(r.schedule.scheduleConflict=i[r.matchUpId])}),{scheduleConflictMatchUpIds:i}}function WIe(t){return t?.sides?.map(({participant:e,participantId:i,qualifier:r})=>e||i&&{participantId:i}||r&&{qualifier:r}).filter(Boolean)||[]}function BK({matchUp:t,drawDefinition:e,inContextDrawMatchUps:i}){let{matchUpId:r,matchUpStatus:n,structureId:a}=t||{};if(!t||!a||t?.matchUpStatus===Fi)return{matchUp:t};if(n==="BYE"){let s;return t.winnerMatchUpId?s=i.find(({matchUpId:o})=>o===t.winnerMatchUpId):{winnerMatchUp:s}=On({inContextDrawMatchUps:i,drawDefinition:e,matchUpId:r})?.targetMatchUps||{},BK({matchUp:s,drawDefinition:e,inContextDrawMatchUps:i})}return{matchUp:void 0}}function UA(t){if(t?.upcomingMatchUp)return(({matchUpId:e,structureId:i,schedule:r,roundNumber:n,roundPosition:a,structureName:s})=>({matchUpId:e,structureId:i,schedule:r,roundNumber:n,roundPosition:a,structureName:s}))(t.upcomingMatchUp)}function Qi(t){let e="getAllDrawMatchUps";Object.assign(t,{requireParticipants:!1});let i=ov(t);if(i.error)return z({result:i,stack:e});let{abandonedMatchUps:r,completedMatchUps:n,upcomingMatchUps:a,pendingMatchUps:s,byeMatchUps:o,matchUpsMap:l}=i;return{matchUps:(r??[]).concat(...n??[],...a??[],...s??[],...o??[]),matchUpsMap:l}}function ov(t){if(!t?.drawDefinition)return{error:_e};let{tournamentParticipants:e,contextContent:i,matchUpsMap:r}=t,{scheduleVisibilityFilters:n,tournamentAppliedPolicies:a,requireParticipants:s,participantsProfile:o,afterRecoveryTimes:l,policyDefinitions:u,tournamentRecord:c,usePublishState:d,contextFilters:p,matchUpFilters:f,scheduleTiming:m,participantMap:h,publishStatus:g,contextProfile:I,drawDefinition:v,nextMatchUps:w,inContext:y,context:b,event:S}=t,U=[],T=[],P=[],D=[],E=[];I&&!i&&(i=Fc({policyDefinitions:u,tournamentRecord:c,contextProfile:I,event:S}));let R;!e?.length&&c&&(e=c?.participants,(y||o?.withGroupings)&&e?.length&&({participantsWithGroupings:e,groupInfo:R}=wR({participants:e,participantsProfile:o})));let{structures:C}=Js({drawDefinition:v});if(!C)return{error:Ii};r||(r=Ar({drawDefinition:v}));let M=v&&IK({drawDefinition:v}).exitProfiles;C.forEach(O=>{let{byeMatchUps:k=[],pendingMatchUps:F=[],upcomingMatchUps:x=[],completedMatchUps:L=[],abandonedMatchUps:$=[]}=NR({matchUpFilters:w?void 0:f,contextFilters:w?void 0:p,inContext:y||w||p,hydrateParticipants:t.hydrateParticipants,tournamentAppliedPolicies:a,scheduleVisibilityFilters:n,tournamentParticipants:e,requireParticipants:s,afterRecoveryTimes:l,policyDefinitions:u,tournamentRecord:c,usePublishState:d,contextContent:i,participantMap:h,scheduleTiming:m,publishStatus:g,contextProfile:I,drawDefinition:v,exitProfiles:M,matchUpsMap:r,structure:O,context:b,event:S});U=U.concat(...$),T=T.concat(...L),P=P.concat(...x),D=D.concat(...F),E=E.concat(...k)});let N=O=>(!f&&!w&&!p||(f&&(O=Gu({matchUps:O,...f})),p&&(O=Gu({matchUps:O,...p,processContext:!0}))),O),A={abandonedMatchUps:N(U),completedMatchUps:N(T),upcomingMatchUps:N(P),pendingMatchUps:N(D),byeMatchUps:N(E),matchUpsMap:r,...H,groupInfo:R};if(w){let O=typeof w=="object"||{abandoned:!0,completed:!0,upcoming:!0,pending:!0,bye:!0},{abandoned:k,completed:F,upcoming:x,pending:L,bye:$}=O,V=[].concat(...k&&U||[],...F&&T||[],...x&&P||[],...L&&D||[],...$&&E||[]);HIe({inContextDrawMatchUps:V,drawDefinition:v})}return A}function Ru(t){let{participants:e=[],contextContent:i,participantMap:r}=t,{scheduleVisibilityFilters:n,tournamentAppliedPolicies:a,participantsProfile:s,afterRecoveryTimes:o,policyDefinitions:l,useParticipantMap:u,tournamentRecord:c,usePublishState:d,contextFilters:p,matchUpFilters:f,contextProfile:m,nextMatchUps:h,inContext:g,context:I,event:v}=t;if(!v)return{error:li};let{eventId:w,eventName:y,endDate:b,eventType:S,category:U,gender:T,matchUpFormat:P}=v??{},D={...I,...Ve({indoorOutDoor:v.indoorOutdoor??c?.indoorOutdoor,surfaceCategory:v.surfaceCategory??c?.surfaceCategory,endDate:v.endDate??c?.endDate,tournamentId:c?.tournamentId,matchUpFormat:P,eventName:y,eventType:S,category:U,eventId:w,gender:T})};b&&(D.endDate=b),m&&!i&&(i=Fc({policyDefinitions:l,tournamentRecord:c,contextProfile:m,event:v}));let E;if(!e?.length&&!r&&c){let M=nf({participantsProfile:s,useParticipantMap:u,tournamentRecord:c,contextProfile:m,inContext:g});r=M.participantMap,e=M.participants??[],E=M.groupInfo}let R=v.drawDefinitions??[],C=Yw({tournamentRecord:c,event:v}).scheduleTiming;return{matchUps:R.flatMap(M=>{let{matchUps:N}=Qi({tournamentParticipants:e,tournamentAppliedPolicies:a,scheduleVisibilityFilters:n,context:D,participantsProfile:s,afterRecoveryTimes:o,policyDefinitions:l,tournamentRecord:c,usePublishState:d,contextFilters:p,contextProfile:m,drawDefinition:M,contextContent:i,matchUpFilters:f,participantMap:r,scheduleTiming:C,nextMatchUps:h,inContext:g,event:v});return N??[]}),groupInfo:E}}function br(t){let e=Ge(t,[{tournamentRecord:!0}]);if(e.error)return e;if(!t?.tournamentRecord)return{error:Ie};let{participantMap:i,participants:r}=t,{scheduleVisibilityFilters:n,participantsProfile:a,afterRecoveryTimes:s,useParticipantMap:o,policyDefinitions:l,tournamentRecord:u,inContext:c=!0,usePublishState:d,contextProfile:p,matchUpFilters:f,contextFilters:m,nextMatchUps:h,context:g}=t,I=t.tournamentId??u.tournamentId,v=u?.events??[];r||({participants:r,participantMap:i}=nf({participantsProfile:a,useParticipantMap:o,tournamentRecord:u,contextProfile:p,inContext:c}));let{appliedPolicies:w}=Tt({tournamentRecord:u}),y={...g,tournamentId:I,indoorOutDoor:u.indoorOutdoor,surfaceCategory:u.surfaceCategory,endDate:u.endDate},b=Fc({policyDefinitions:l,tournamentRecord:u,contextProfile:p});return{matchUps:v.flatMap(S=>(y.eventDrawsCount=S.drawDefinitions?.length??0,Ru({context:y,scheduleVisibilityFilters:n,tournamentAppliedPolicies:w,participantsProfile:a,afterRecoveryTimes:s,policyDefinitions:l,tournamentRecord:u,usePublishState:d,contextContent:b,contextFilters:m,contextProfile:p,matchUpFilters:f,participantMap:i,nextMatchUps:h,participants:r,inContext:c,event:S}).matchUps??[])).concat(...u.matchUps??[])}}function Eo({scheduleVisibilityFilters:t,afterRecoveryTimes:e,participantsProfile:i,tournamentRecords:r,policyDefinitions:n,usePublishState:a,matchUpFilters:s,contextFilters:o,nextMatchUps:l,inContext:u}){if(typeof r!="object"||!Object.keys(r).length)return{error:Ci};let c=Object.keys(r).map(d=>{let p=r[d];return br({scheduleVisibilityFilters:t,afterRecoveryTimes:e,participantsProfile:i,policyDefinitions:n,tournamentRecord:p,usePublishState:a,matchUpFilters:s,contextFilters:o,nextMatchUps:l,inContext:u}).matchUps??[]}).flat();return{...H,matchUps:c}}function hh(t,e){return zIe(t,e)||(t?.stageSequence||0)-(e?.stageSequence||0)||t?.roundNumber&&e.roundNumber&&t?.roundNumber-e?.roundNumber||(t?.roundPosition??0)-(e?.roundPosition??0)}function zIe(t,e){return(Pm[t?.stage]||0)-(Pm[e?.stage]||0)}function Rn(t){let{participants:e,participantMap:i,contextContent:r}=t,{scheduleVisibilityFilters:n,tournamentAppliedPolicies:a,participantsProfile:s,afterRecoveryTimes:o,policyDefinitions:l,useParticipantMap:u,tournamentRecord:c,matchUpFilters:d,contextFilters:p,contextProfile:f,drawDefinition:m,nextMatchUps:h,inContext:g,context:I,event:v}=t,{eventId:w,eventName:y,endDate:b,eventType:S,category:U,gender:T,matchUpFormat:P}=v??{},D={...I,surfaceCategory:v?.surfaceCategory??c?.surfaceCategory,indoorOutDoor:v?.indoorOutdoor??c?.indoorOutdoor,matchUpFormat:P,eventType:S,eventName:y,category:U,eventId:w,endDate:b,gender:T},E;return!e?.length&&!i&&c&&({participants:e=[],participantMap:i,groupInfo:E}=nf({participantsProfile:s,useParticipantMap:u,tournamentRecord:c,contextProfile:f,inContext:g})),f&&!r&&(r=Fc({policyDefinitions:l,tournamentRecord:c,contextProfile:f,drawDefinition:m,event:v})),{...Qi({context:D,tournamentAppliedPolicies:a,scheduleVisibilityFilters:n,tournamentParticipants:e,participantsProfile:s,afterRecoveryTimes:o,policyDefinitions:l,tournamentRecord:c,drawDefinition:m,contextContent:r,contextFilters:p,contextProfile:f,matchUpFilters:d,participantMap:i,nextMatchUps:h,inContext:g,event:v}),groupInfo:E}}function mp({element:t,accessor:e}){if(typeof e!="string")return{values:[]};let i=ke(t),r=e.split("."),n=[],a;o({targetElement:i,attributes:r});let s={value:a};return n.length&&(s.values=n),s;function o({targetElement:l,attributes:u=[],significantCharacters:c}){for(let[p,f]of u.entries())if(l?.[f]){let m=u.slice(p+1);m.length?Array.isArray(l[f])?l[f].forEach(h=>o({targetElement:h,attributes:m})):(l=l[f],d({targetElement:l,index:p})):(a||(a=l[f]),n.includes(l[f])||n.push(l[f]))}function d({targetElement:p,index:f}){if(p&&f===u.length-1&&["string","number"].includes(typeof p)){let m=c?p.slice(0,c):p;a?n.includes(m)||n.push(m):(a=m,n.push(m))}}}}var VK=t=>e=>!t||typeof e!="object"?void 0:Array.isArray(t)&&t.map(i=>({[i]:mp({element:e,accessor:i})?.value}))||typeof t=="object"&&Object.keys(t).map(i=>({[i]:mp({element:e,accessor:i})?.value}))||(typeof t=="string"&&mp({element:e,accessor:t}))?.value,ba=VK;function aS({finishingPositionOffset:t=0,finishingPositionLimit:e,positionsFed:i,roundsCount:r,roundLimit:n,matchUps:a,lucky:s,fmlc:o}){if(!Ga(a))return[];let{roundProfile:l,roundNumbers:u=[]}=bn({interpolate:!0,matchUps:a});r=r??Math.max(...u,0);let c=n?r-n:0,d=c&&l?.[r-c]?.matchUpsCount,p=l&&Object.values(l).map(ba("matchUpsCount")),f=(g,I)=>{let v=Math.min(...g);d&&I&&v===1&&(v=d);let w=Math.max(...g);return e&&w>e&&(w=e),[v,w]},m=l&&Object.assign({},...u.map(g=>{let I=(r??0)+1-g-c,v=l[g].matchUpsCount,w={finishingPositionRange:{},finishingRound:I},y=p?.slice(g-1).reduce((R,C)=>R+(C||0),0),b=o&&g!==1,S=1+t+(b?i??0:0),U=1,T=Re(S,s?S+v*2:y+S+U),P=y+U-v,D=f(T.slice(P)),E=f(T.slice(0,P),!0);return w.finishingPositionRange={loser:D,winner:E},{[g]:w}})),h=ia({finishingRound:!0});return a.filter(Boolean).forEach(g=>{let I=g.roundNumber&&m[g.roundNumber];h&&!I&&console.log({roundFinishingData:m,matchUp:g}),g.finishingRound=I?.finishingRound,g.finishingPositionRange=I?.finishingPositionRange}),a}function Mp({inContextDrawMatchUps:t,drawDefinition:e,matchUpsMap:i}){if(!e)return{error:_e};let r={loserMatchUpIds:{},winnerMatchUpIds:{}};if(t||({matchUps:t,matchUpsMap:i}=Qi({inContext:!0,drawDefinition:e,matchUpsMap:i})),!i?.drawMatchUps.some(n=>n.finishingPositionRange)&&e?.structures?.length===1&&!e?.structures[0].structures){let n=i?.drawMatchUps??[];aS({matchUps:n})}return(t??[]).filter(({collectionId:n})=>!n).forEach(n=>{let{matchUpId:a,structureId:s}=n,o=On({inContextDrawMatchUps:t,drawDefinition:e,matchUpId:a}),{winnerMatchUp:l,loserMatchUp:u}=o.targetMatchUps,c=l?.matchUpId,d=u?.matchUpId,p=gd({matchUpsMap:i,structureId:s}).find(f=>f.matchUpId===a);if(p&&(c&&(r.winnerMatchUpIds[p.matchUpId]=c,Object.assign(p,{winnerMatchUpId:c}),Object.assign(n,{winnerMatchUpId:c})),d&&(r.loserMatchUpIds[p.matchUpId]=d,n.loserMatchUpId=d,p.loserMatchUpId=d,n.finishingPositionRange))){let f=u.finishingPositionRange&&[...n.finishingPositionRange.loser,...u.finishingPositionRange.loser],m=f&&[Math.min(...f),Math.max(...f)];n.finishingPositionRange.loser=m,p.finishingPositionRange.loser=m}}),{inContextDrawMatchUps:t,goesToMap:r}}function oo(t){let e=Is(t),i=t.matchUps??[],r=t.drawIds??[],{includeParticipantDependencies:n,tournamentRecord:a,drawDefinition:s}=t;if(!Array.isArray(i))return{error:Tu};if(!Array.isArray(r))return{error:Oo};let o=t.matchUpIds?.length?t.matchUpIds:i.map(v=>v.matchUpId);if(!Array.isArray(o))return{error:eh};let l={},u={},c={},d={};a&&!Object.keys(e).length&&(e={[a.tournamentId]:a});let p=Object.values(e),f=p.reduce((v,w)=>v.concat(w.events??[]).map(y=>(y.drawDefinitions||[]).map(b=>b.links||[])).flat(1/0),[]).filter(({linkType:v})=>v===iu),m=i;if(f.length){m=Eo({nextMatchUps:!0,tournamentRecords:e}).matchUps;let v=f.reduce((w,y)=>{let b=y.source?.structureId,S=y.target?.structureId;return b&&S&&(c[S]=b),b&&!w.includes(b)&&w.push(b),w},[]);for(let w of v)l[w]=[];for(let w of m??[]){let y=w.containerStructureId||w.structureId;v.includes(y)&&l[y].push(w.matchUpId)}}let h=v=>{u[v]||(u[v]={dependentMatchUpIds:[],participantIds:[],matchUpIds:[],sources:[]},d[v]=[])},g=(v,w)=>{u[v].matchUpIds.forEach(y=>{u[w].matchUpIds.push(y)}),u[w].matchUpIds.push(v),u[v].dependentMatchUpIds.push(w),n&&u[v].participantIds.forEach(y=>u[w].participantIds.push(y))},I=v=>{let w=Object.keys(l).length;for(let y of v||[]){let{matchUpId:b,winnerMatchUpId:S,loserMatchUpId:U}=y;if(!o.length||o.includes(b)){if(h(b),n){let{individualParticipantIds:D}=bR(y);u[b].participantIds=D}S&&(h(S),g(b,S),d[S].push(b)),U&&(h(U),g(b,U),d[U].push(b)),u[b].sources.push(d[b]);let T=d[b].map(D=>u[D].sources[0]).flat(),P=d[b].map(D=>u[D].sources[1]).flat();if(u[b].sources.push(T,P),w){let D=y.containerStructureId||y.structureId,E=c[D];if(l[E])for(let R of l[E])h(R),g(R,b),d[R].push(b)}}}};if(s)Mp({drawDefinition:s}),m?.length||(m=Rn({drawDefinition:s}).matchUps),I(m);else{if(m?.length||(m=Eo({nextMatchUps:!0,tournamentRecords:e}).matchUps),!r.length){let v=p?.length?p.map(({events:w=[]})=>w.map(({drawDefinitions:y=[]})=>y.map(({drawId:b})=>b))).flat(1/0):[];v&&(r=v)}for(let v of r){let w=m?.filter(y=>y.drawId===v).sort(hh);if(!w?.find(({roundPosition:y})=>!y)){let y=w?.find(({tournamentId:S})=>S),{drawDefinition:b}=jn({tournamentRecord:e[y?.tournamentId],drawId:v});b&&Mp({drawDefinition:b})}I(w)}}return{positionDependencies:l,matchUpDependencies:u,sourceMatchUpIds:d,matchUps:m,...H}}function cr(t){let e=t?.matchUp,i=t?.score||e?.score,r=i?.sets?.[0],{side1Score:n,side2Score:a,side1TiebreakScore:s,side2TiebreakScore:o,side1PointScore:l,side2PointScore:u}=r||{},c=n||a||s||o||l||u;return!!(i?.sets?.length>1||c)}function sS({matchUpStatus:t}){return Y5.includes(t)}function qIe({matchUpStatus:t}){return CF.includes(t)}function pO({matchUpStatus:t}){return K5.includes(t)}function nL({matchUpStatus:t,winningSide:e,tieMatchUps:i,sides:r,score:n}){let a=r?.find(({participantId:o})=>o),s=i?.filter(nL)?.length;return cr({score:n})||s||e&&a||t&&qIe({matchUpStatus:t})&&![Qt,mi,ao].includes(t)}function lv(t){let{drawDefinition:e,findContainer:i,structureId:r,event:n}=t,a=t.structure,{containedStructures:s}=av({drawDefinition:e}),o=r?s[r]||[]:[],l={isCollectionMatchUp:!1};if(!a){let U=et({drawDefinition:e,structureId:r});if(U.error)return U;a=i?U.containingStructure??U.structure:U.structure}if(Vn({structure:a}))return{structure:a,isAdHoc:!0,error:Zm};let{matchUps:u}=Qi({inContext:!0,matchUpFilters:l,drawDefinition:e,event:n}),c=u?.filter(U=>U.structureId===r||o.includes(U.structureId)),{matchUpDependencies:d}=oo({drawIds:[e.drawId],matchUps:u,drawDefinition:e}),p=[],f=[],m={},h=[];for(let U of u??[]){if(U.structureId===r||o.includes(U.structureId)){f.push(...U.drawPositions??[]);let T=U.roundNumber;for(let P of(U.drawPositions??[]).filter(Boolean))(!m[P]||T&&m[P]>T)&&(m[P]=T)}nL(U)&&(h.push(U),p.push(U.matchUpId,...d?.[U?.matchUpId]?.matchUpIds||[]))}let g=rt(f.filter(Boolean)).sort(ir),I=rt(p),v=rt(c?.map(({matchUpId:U,drawPositions:T})=>I.includes(U)?T:[]).flat().filter(Boolean)).sort(ir),{positionAssignments:w}=Yt({drawDefinition:e,structure:a}),y=w?.filter(U=>U.bye).map(U=>U.drawPosition),b=w?.filter(U=>U.qualifier).map(U=>U.drawPosition),S=g?.filter(U=>!v.includes(U))||[];return{allDrawPositions:g,inContextStructureMatchUps:c,drawPositionInitialRounds:m,activeDependentMatchUpIds:I,qualifyingDrawPositions:b,inactiveDrawPositions:S,positionAssignments:w,activeDrawPositions:v,byeDrawPositions:y,activeMatchUps:h,structure:a}}function Mm({drawPosition:t,matchUps:e=[]}){return{initialRoundNumber:e.filter(({drawPositions:i})=>t&&i?.includes(t)).map(({roundNumber:i})=>i).sort(ir)[0]}}var qc={reset:"\x1B[0m",bright:"\x1B[1m",dim:"\x1B[2m",red:"\x1B[31m",brightred:"\x1B[91m",green:"\x1B[32m",brightgreen:"\x1B[92m",yellow:"\x1B[33m",brightyellow:"\x1B[93m",blue:"\x1B[34m",brightblue:"\x1B[94m",lightblue:"\x1B[105m",magenta:"\x1B[35m",brightmagenta:"\x1B[95m",cyan:"\x1B[36m",brightcyan:"\x1B[96m",white:"\x1B[37m",brightwhite:"\x1B[97m"},aL=[];function Gt(t,e){ri(t)&&(t={method:t}),(e||ia())&&aL.push(t)}function YIe(t){return aL.slice()}function KIe(t){let e=YIe().map(i=>{let{color:r,keyColors:n,method:a,newline:s}=i,o=Object.keys(qc).includes(r)?qc[r]:qc.cyan,l=Object.keys(i).filter(c=>!["color","keyColors","method","newline"].includes(c)).map(c=>{let d=n&&Object.keys(n).includes(c)&&qc[n[c]]?qc[n[c]]:qc.brightwhite;return`${qc.white}${c}: ${d}${i[c]}`}).join(", "),u=a?.length<15?"		":"	";return[s?`
`:"",o,a,u,qc.white,l,qc.reset,`
`].join("")});e?.length&&console.log(...e)}function XIe(){aL.length=0}function sL(t){let e=t.bye,i=t.qualifier,r=t.participantId;return{containsBye:e,containsQualifier:i,containsParticipant:r,filled:e||i||r}}function Fr(t){return[Qt,mi,$r].includes(t)}function Wa({provisionalPositioning:t,isPositionAction:e,tournamentRecord:i,drawDefinition:r,drawPosition:n,loserMatchUp:a,matchUpsMap:s,structureId:o,structure:l,event:u}){if(!r)return{error:_e};if(l||({structure:l}=et({drawDefinition:r,structureId:o})),!l)return{error:Ii};o||({structureId:o}=l);let c="assignDrawPositionBye";Gt({method:c,color:"cyan",drawPosition:n}),s??=Ar({drawDefinition:r});let{positionAssignments:d}=Yt({structure:l}),{activeDrawPositions:p}=lv({drawDefinition:r,structureId:o});if(d?.find(E=>E.drawPosition===n)?.bye)return{...H};let f=!!(a&&s.drawMatchUps.some(E=>E.loserMatchUpId===a?.matchUpId&&Fr(E.matchUpStatus)));if(p?.includes(n)&&!f)return{error:Pw};let m=d?.find(E=>E.drawPosition===n);if(!m)return{error:Zm};let{filled:h,containsBye:g,containsParticipant:I}=sL(m);if(g)return{...H};if(h&&!g&&!f)return z({result:{error:qg},stack:c});let v=Tt({tournamentRecord:i,drawDefinition:r,event:u}).appliedPolicies??{},w=Qi({inContext:!0,drawDefinition:r,matchUpsMap:s}).matchUps??[],y={isCollectionMatchUp:!1},{matchUps:b}=Nt({provisionalPositioning:t,drawDefinition:r,matchUpFilters:y,matchUpsMap:s,structure:l});if(d?.forEach(E=>{E.drawPosition===n&&(E.bye=!0,f&&(E.participantId=void 0))}),l.structureType===fn)return JIe({tournamentRecord:i,drawDefinition:r,drawPosition:n,matchUps:b}),pc({tournamentId:i?.tournamentId,drawDefinition:r,structure:l,event:u}),OH({assignedParticipantId:I,isPositionAction:e,appliedPolicies:v,drawDefinition:r,drawPosition:n,structureId:o,stack:c});let{roundProfile:S,roundMatchUps:U}=bn({matchUps:b}),T=(S&&Object.keys(S).map(E=>Number.parseInt(E)).reverse())?.find(E=>S?.[E].drawPositions?.includes(n)),P=T?U?.[T].find(({drawPositions:E})=>E?.includes(n)):void 0;P&&jK({tournamentRecord:i,drawDefinition:r,matchUp:P,event:u});let D=P?.drawPositions?.find(E=>E!==n);if(P&&D){let E=oL({sourceDrawPositions:P.drawPositions,matchUpId:P.matchUpId,inContextDrawMatchUps:w,drawPositionToAdvance:D,tournamentRecord:i,drawDefinition:r,matchUpsMap:s});if(E.error)return E}return pc({tournamentId:i?.tournamentId,drawDefinition:r,structure:l,event:u}),OH({assignedParticipantId:I,isPositionAction:e,appliedPolicies:v,drawDefinition:r,drawPosition:n,structureId:o,stack:c})}function OH({assignedParticipantId:t,isPositionAction:e,appliedPolicies:i,drawDefinition:r,drawPosition:n,structureId:a,stack:s}){return e&&Ww({appliedPolicies:i,drawDefinition:r,positionAction:{removedParticipantId:t,drawPosition:n,structureId:a,name:s}}),z({result:{...H},stack:s})}function jK({tournamentRecord:t,drawDefinition:e,eventId:i,matchUp:r,event:n}){Object.assign(r,{matchUpStatus:"BYE",score:void 0,winningSide:void 0}),St({tournamentId:t?.tournamentId,eventId:i??n?.eventId,context:"setMatchUpStatusBye",drawDefinition:e,matchUp:r})}function JIe({tournamentRecord:t,drawDefinition:e,drawPosition:i,matchUps:r,event:n}){r.forEach(a=>{a.drawPositions?.includes(i)&&jK({eventId:n?.eventId,tournamentRecord:t,drawDefinition:e,matchUp:a})})}function oL({drawPositionToAdvance:t,inContextDrawMatchUps:e,sourceDrawPositions:i,tournamentRecord:r,drawDefinition:n,matchUpsMap:a,matchUpId:s,event:o}){Gt({method:"advanceDrawPosition",color:"cyan",drawPositionToAdvance:t});let l=a.drawMatchUps.find(w=>w.matchUpId===s),u=e.find(w=>w.matchUpId===s)?.structureId,{structure:c}=et({drawDefinition:n,structureId:u}),{positionAssignments:d}=Yt({structure:c}),p=d?.filter(w=>w.bye).map(w=>w.drawPosition),f=l?.drawPositions?.find(w=>w!==t),m=f&&p?.includes(f),{targetLinks:{loserTargetLink:h},targetMatchUps:{loserMatchUp:g,winnerMatchUp:I,loserTargetDrawPosition:v}}=On({inContextDrawMatchUps:e,drawDefinition:n,matchUpId:s});if(I&&I.structureId===c?.structureId&&QIe({drawPositionToAdvance:t,inContextDrawMatchUps:e,sourceDrawPositions:i,tournamentRecord:r,drawDefinition:n,winnerMatchUp:I,matchUpsMap:a,event:o}),g&&m&&g.structureId!==c?.structureId){let{roundNumber:w}=g;if(w===1){let y=Wa({structureId:h.target.structureId,drawPosition:v,tournamentRecord:r,drawDefinition:n,event:o});if(y.error)return y}else GK({loserTargetDrawPosition:v,tournamentRecord:r,loserTargetLink:h,drawDefinition:n,loserMatchUp:g,matchUpsMap:a,event:o})}return{...H}}function QIe({drawPositionToAdvance:t,inContextDrawMatchUps:e,sourceDrawPositions:i,tournamentRecord:r,drawDefinition:n,winnerMatchUp:a,matchUpsMap:s,event:o}){let l="advanceWinner",u=s.drawMatchUps.find(M=>M.matchUpId===a.matchUpId),c=e.find(M=>M.matchUpId===a.matchUpId)?.structureId,{structure:d}=et({drawDefinition:n,structureId:c}),{positionAssignments:p}=Yt({structure:d}),f=p?.find(({drawPosition:M})=>M===t)?.bye,m=u.drawPositions?.filter(Boolean),h=p?.filter(M=>m?.includes(M.drawPosition)),g=p?.find(({drawPosition:M})=>M===t),I=i?.find(M=>M!==t),v=(I&&h?.find(({drawPosition:M})=>M===I))?.bye,w=f&&v;if(w&&console.log({isByeAdvancedBye:w}),m?.length>1&&f&&!v)return z({result:{error:qg},stack:l});let y=m?.find(M=>M!==t),b=w,S=[...(u.drawPositions||[]).filter(Boolean),void 0,void 0].slice(0,2),U=S.map(M=>!M&&!b||M===t?(b=!0,t):M).sort(ir);if(!b)return console.log("@@@@@@@",{advancingAssignmentIsBye:g,drawPositionToAdvance:t,existingAssignments:h}),z({result:{error:qg},stack:l});let T=p?.find(({drawPosition:M})=>M===y)?.bye,P=p?.find(({drawPosition:M})=>M===t)?.bye;Object.assign(u,{matchUpStatus:P||T?"BYE":Fi,score:void 0,winningSide:void 0,drawPositions:U});let D=u.drawPositions.find(M=>!S.includes(M));Gt({method:l,color:"brightyellow",changedDrawPosition:D,pairedDrawPositionIsBye:T,drawPositionIsBye:P}),St({tournamentId:r?.tournamentId,matchUp:u,eventId:o?.eventId,context:l,drawDefinition:n});let{targetLinks:{loserTargetLink:E},targetMatchUps:{loserMatchUp:R,loserTargetDrawPosition:C}}=On({matchUpId:a.matchUpId,inContextDrawMatchUps:e,drawDefinition:n});if(T||P){let M=T?t:y;if(M)oL({drawPositionToAdvance:M,matchUpId:a.matchUpId,inContextDrawMatchUps:e,tournamentRecord:r,drawDefinition:n,matchUpsMap:s});else if(P&&E&&R)if(R.feedRound)GK({loserTargetDrawPosition:C,tournamentRecord:r,loserTargetLink:E,drawDefinition:n,loserMatchUp:R,matchUpsMap:s});else{let N=1-a.roundPosition%2,A=R.drawPositions[N],O=Wa({structureId:E.target.structureId,drawPosition:A,tournamentRecord:r,drawDefinition:n,event:o});if(O.error)return O}}}function GK({loserTargetDrawPosition:t,tournamentRecord:e,loserTargetLink:i,drawDefinition:r,loserMatchUp:n,matchUpsMap:a,event:s}){let{roundNumber:o}=n;Gt({method:"assignFedDrawPositionBye",color:"cyan",loserTargetDrawPosition:t});let l=(a?.mappedMatchUps||{})[n.structureId].matchUps,{initialRoundNumber:u}=Mm({drawPosition:t,matchUps:l});if(u===o){let c=Wa({structureId:i.target.structureId,drawPosition:t,tournamentRecord:e,drawDefinition:r,event:s});if(c.error)return c}}function HK({positionAssignments:t,tournamentRecord:e,drawDefinition:i,matchUpsMap:r,structure:n,event:a}){let{matchUps:s}=Nt({drawDefinition:i,matchUpsMap:r,structure:n,event:a});s.forEach(o=>{let l=t.filter(({drawPosition:u})=>o.drawPositions?.includes(u)).filter(u=>u.bye).length;o.winningSide||(Object.assign(o,{matchUpStatus:l?"BYE":Fi}),St({tournamentId:e?.tournamentId,context:"modifyRoundRobinMatchUpsStatus",eventId:a?.eventId,drawDefinition:i,matchUp:o}))})}function oS(t){let{inContextDrawMatchUps:e,participantId:i,drawPosition:r}=t,{tournamentRecord:n,drawDefinition:a,structureId:s,matchUpsMap:o,event:l}=t,{structure:u}=et({drawDefinition:a,structureId:s}),c=(ur({drawDefinition:a,structure:u}).positionAssignments||[]).find(p=>i&&p.participantId===i||r&&p.drawPosition===r);if(c&&i&&!r&&(r=c?.drawPosition),!r)return{error:YI};i||(i=c?.participantId);let{activeDrawPositions:d}=lv({drawDefinition:a,structureId:s});return d.includes(r)?{error:Pw}:(e||({matchUps:e}=Qi({inContext:!0,drawDefinition:a,matchUpsMap:o})),fO({inContextDrawMatchUps:e,tournamentRecord:n,drawDefinition:a,structureId:s,drawPosition:r,matchUpsMap:o,event:l}).drawPositionCleared?(pc({tournamentId:n?.tournamentId,drawDefinition:a,structure:u,event:l}),{...H,participantId:i}):{error:i6})}function fO({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,matchUpsMap:n,structureId:a,event:s}){let{structure:o}=et({drawDefinition:i,structureId:a});if(!o)return{error:Ii};let l=ur({drawDefinition:i,structure:o}).positionAssignments||[],u=l.some(I=>{if(I.drawPosition===r)return delete I.participantId,delete I.qualifier,delete I.bye,!0});if(o.structureType===fn)return HK({positionAssignments:l,tournamentRecord:e,drawDefinition:i,matchUpsMap:n,structure:o}),{drawPositionCleared:u,...H};let c={isCollectionMatchUp:!1},{matchUps:d}=Nt({drawDefinition:i,matchUpFilters:c,matchUpsMap:n,structure:o,event:s}),{roundProfile:p,roundMatchUps:f}=bn({matchUps:d}),m=(p&&Object.keys(p))?.map(I=>Ye(I)),h=r,g=m?.map(I=>{let v=p?.[I]?.pairedDrawPositions?.find(D=>D.includes(h)),w=v?.find(D=>D!==h),y=l.find(D=>D.drawPosition===w),b=p?.[I+1],S=y?.bye,U=b?.pairedDrawPositions?.find(D=>D.includes(w)),T=S&&U&&b&&b.drawPositions?.includes(w),P=v&&{pairedDrawPositionByeAdvancedPair:!T&&U,pairedDrawPosition:w,targetDrawPosition:h,relevantPair:v,roundNumber:I};return T&&(h=w),P}).filter(I=>I?.targetDrawPosition)?.reduce((I,v)=>{let{roundNumber:w,relevantPair:y,targetDrawPosition:b,pairedDrawPosition:S,pairedDrawPositionByeAdvancedPair:U}=v,T={roundNumber:w,targetDrawPosition:b,relevantPair:y},P=U&&{roundNumber:w+1,targetDrawPosition:S,relevantPair:U,subsequentRoundRemoval:!0},D=[T,P].filter(Boolean);return I.concat(...D)},[]);return g?.forEach(({roundNumber:I,targetDrawPosition:v,relevantPair:w})=>{let y=f?.[I].find(b=>kn(b.drawPositions?.filter(Boolean),w.filter(Boolean)));y&&(ZIe({inContextDrawMatchUps:t,targetDrawPosition:v,tournamentRecord:e,drawDefinition:i,structureId:a,roundNumber:I,matchUpsMap:n}),WK({inContextDrawMatchUps:t,positionAssignments:l,tournamentRecord:e,drawDefinition:i,targetMatchUp:y,drawPosition:r,matchUpsMap:n,structure:o,event:s}))}),{tasks:g,drawPositionCleared:u,positionAssignments:l}}function ZIe({inContextDrawMatchUps:t,targetDrawPosition:e,tournamentRecord:i,drawDefinition:r,matchUpsMap:n,roundNumber:a,structureId:s}){let{structure:o}=et({drawDefinition:r,structureId:s});if(!o)return{error:Ii};if(o.structureType===fn)return;n=n||Ar({drawDefinition:r});let l=(n?.mappedMatchUps||{})[s].matchUps,{initialRoundNumber:u}=Mm({drawPosition:e,matchUps:l}),c=l?.filter(p=>p.roundNumber>=a&&p.roundNumber!==u&&p.drawPositions?.includes(e)),d=Yt({drawDefinition:r,structureId:s}).positionAssignments??[];return c?.forEach(p=>WK({drawPosition:e,targetMatchUp:p,inContextDrawMatchUps:t,positionAssignments:d,tournamentRecord:i,drawDefinition:r,matchUpsMap:n,structure:o})),{...H}}function WK({inContextDrawMatchUps:t,positionAssignments:e,tournamentRecord:i,drawDefinition:r,targetMatchUp:n,drawPosition:a,matchUpsMap:s,structure:o,event:l}){let u="removeDrawPosition",c=n.drawPositions?.slice(),d=n.matchUpStatus,p=n.winningSide;s=s??Ar({drawDefinition:r});let f=s.mappedMatchUps[o.structureId].matchUps,{initialRoundNumber:m}=Mm({drawPosition:a,matchUps:f});if(n.roundNumber&&m&&n.roundNumber>m){let U=(n.drawPositions??[]).map(T=>T===a?void 0:T);n.drawPositions=U}if(n.matchUpType===Zt){let U=(t?.find(T=>T.matchUpId===n.matchUpId)?.sides??[]).reduce((T,P,D)=>P.drawPosition===a?D:T,void 0);U!==void 0&&n.sides?.[U]?.lineUp&&(delete n.sides?.[U].lineUp,St({tournamentId:i?.tournamentId,context:`${u}-TEAM`,eventId:l?.eventId,matchUp:n,drawDefinition:r}))}let h=On({matchUpId:n.matchUpId,inContextDrawMatchUps:t,drawDefinition:r}),{targetLinks:{winnerTargetLink:g},targetMatchUps:{loserMatchUp:I,winnerMatchUp:v,loserMatchUpDrawPositionIndex:w}}=h,y=e.filter(({drawPosition:U})=>n.drawPositions?.includes(U)).filter(U=>U.bye).length,b=y&&"BYE"||n.matchUpStatus&&Fr(n.matchUpStatus)&&n.matcHUpStatus||Fi;n.matchUpStatus=b,n.matchUpStatus&&Fr(n.matchUpStatus)&&(n.winningSide=void 0);let S=c?.find(U=>!n.drawPositions?.includes(U));if(c?.includes(a)&&d===n.matchUpStatus&&p===n.winningSide||(S&&Gt({method:u,color:"brightyellow",removedDrawPosition:S}),St({tournamentId:i?.tournamentId,context:`${u}-${a}`,eventId:l?.eventId,matchUp:n,drawDefinition:r})),I&&I.structureId!==h.matchUp.structureId&&!y){let{drawPositions:U,roundNumber:T}=I;if(T===1){let P=U[w];fO({structureId:I.structureId,drawPosition:P,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:r,matchUpsMap:s})}else{let P=Math.min(...U.filter(Boolean)),D=eve({loserMatchUpDrawPosition:P,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:r,loserMatchUp:I,matchUpsMap:s,event:l});if(D.error)return z({result:D,stack:u});let E=(s?.mappedMatchUps||{})[I.structureId].matchUps,{initialRoundNumber:R}=Mm({drawPosition:P,matchUps:E});R===1&&(Gt({method:u,color:"brightyellow",loserMatchUpDrawPosition:P}),fO({structureId:I.structureId,drawPosition:P,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:r,matchUpsMap:s}))}}return v&&v.structureId!==h.matchUp.structureId&&g.target.feedProfile,{...H}}function eve({loserMatchUpDrawPosition:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:r,loserMatchUp:n,matchUpsMap:a,event:s}){let{structure:o}=et({structureId:n.structureId,drawDefinition:r}),{positionAssignments:l}=Yt({structure:o});if(l?.find(u=>u.drawPosition===t)?.bye){let u=oS({drawPosition:t,structureId:n.structureId,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:r,matchUpsMap:a,event:s});if(u.error)return u}return{...H}}function cf({drawDefinition:t,stages:e}){if(!t)return{error:_e};let i=(t?.structures??[]).filter(n=>!e?.length||n.stage&&e.includes(n.stage)),r=rt(i.map(n=>{let{positionAssignments:a}=Yt({structure:n});return a?a.map(vt):[]}).flat().filter(Boolean));return{...H,assignedParticipantIds:r}}function vo(t){let e=(t?.entries??[]).filter(Boolean).reduce((r,n)=>{let{entryStage:a,entryStatus:s}=n,o=`_${a||xe}${s||""}`;return r[o]||(r[o]=[]),r[o].push(n),r},{}),i=r=>isNaN(r)?1/0:r;return Object.keys(e).map(r=>e[r].sort((n,a)=>i(n.entryPosition)-i(a.entryPosition)).map((n,a)=>{let s=a+1;return{...n,entryPosition:s}})).flat()}function lp(t){return[sf,ys].includes(t)}function YD({autoEntryPositions:t=!0,ignoreAssignment:e,tournamentRecord:i,drawDefinition:r,participantIds:n,entryStatus:a,entryStage:s,extension:o,eventSync:l,drawId:u,stage:c,event:d}){if(!n||!Array.isArray(n))return{error:To,method:"modifyEntriesStatus",participantIds:n};if(!r&&!d)return{error:li};if(a&&!hK.includes(a))return{error:Yk};if(s&&!ZE.includes(s))return{error:Zp};let p="modifyEntriesStatus",f=[];if(!a&&!o)return z({result:{error:Xe},info:"Missing entryStatus",stack:p});if(o&&!sl({extension:o,requiredAttributes:["name"]}))return z({result:{error:ie},info:"Invalid extension",context:{extension:o},stack:p});let m=[];d?.drawDefinitions?.forEach(P=>{let D=cf({stages:c&&[c],drawDefinition:P}).assignedParticipantIds??[];m.push(...D)});let h=i?.participants??[];if(!n.every(P=>{let D=fd({tournamentParticipants:h,participantId:P})?.participantType;return!(D&&[pt,_n].includes(D)&&lp(a))&&!(a&&d?.eventType&&D===gt&&[ls,ya].includes(d.eventType)&&[Fs,...qT].includes(a))}))return{error:Yk};let g=d&&$i({event:d}).flightProfile,I=g?.flights?.find(P=>P.drawId===u),v=P=>{let D=(P||[]).filter(R=>!c||!R.entryStage||c===R.entryStage).filter(({participantId:R})=>n.includes(R)),E=R=>a&&m.includes(R.participantId)&&!(qT.includes(R.entryStatus)&&qT.includes(a));return D.every(R=>E(R)&&!e?!1:(a&&(R.entryStatus=a,delete R.entryPosition),s&&(R.entryStage=s,delete R.entryPosition),o&&(o.value?xt({element:R,extension:o}):En({element:R,name:o.name})),!0))?{...H}:{error:JI}},w=({flight:P,drawDefinition:D})=>{d&&(d.entries=vo({entries:d.entries??[]})),P&&(P.drawEntries=vo({entries:P.drawEntries})),D&&(D.entries=vo({entries:D.entries}))},y=P=>{let{flight:D,drawDefinition:E}=P,R="updateDrawEntries";if(D){let C=v(D.drawEntries);if(C.error)return z({result:C,stack:R})}if(E){let C=v(E.entries);if(C.error)return z({result:C,stack:R});f.includes(E.drawId)||f.push(E.drawId)}return{...H}},b=d?.entries?.find(({entryPosition:P})=>P)??(I?.drawEntries?.find(({entryPosition:P})=>P)||r?.entries?.find(({entryPosition:P})=>P));if(t&&!b&&w({flight:I,drawDefinition:r}),I||r){let P=y({flight:I,drawDefinition:r});if(P.error)return z({result:P,stack:p})}let S=d?.drawDefinitions?.map(({drawId:P})=>P)??[],U=g?.flights?.filter(P=>!S.includes(P.drawId))||[];for(let P of U){let D=P&&y({flight:P});if(D?.error)return z({result:D,stack:p})}let T=g?.flights?.length===1&&(d?.drawDefinitions?.length??0)<=g?.flights?.length;if(!I&&!r&&a&&mK.includes(a))return{error:W6};if(!I&&!r||a===mc||l&&T){let P=v(d?.entries);if(P?.error)return z({result:P,stack:p});let D;if(a===mc&&(g?.flights?.every(E=>{let R=v(E.drawEntries);return R.error?(D=R.error,!1):(E.drawEntries=E.drawEntries.filter(({participantId:C})=>!n.includes(C)),!0)}),d?.drawDefinitions?.every(E=>{let R=v(E.entries);return R.error?(D=R.error,!1):(E.entries=E.entries?.filter(({participantId:C})=>!n.includes(C)),!0)})),D)return z({result:{error:D},stack:p})}t&&w({flight:I,drawDefinition:r});for(let P of d?.drawDefinitions??[])f.length&&!f.includes(P.drawId)||ti({tournamentId:i.tournamentId,eventId:d?.eventId,drawDefinition:P});return{...H}}function Ug({value:t,sourceRange:e,targetRange:i}){if(!Array.isArray(e)||e.length!==2)return 0;let r=Math.min(...e),n=Math.max(...e),a=Math.min(...i),s=Math.max(...i);return(t-r)*(s-a)/(n-r)+a}var zK="NTRP",qK="DUPR",YK="UTR_P",KK="UTPR",XK="SQUASH_LEVELS",JK="US_SQUASH",QK="USATT",ZK="ITTF",e7="USAR",tve={ELO:"ELO",NTRP:zK,TRN:"TRN",UTR:"UTR",WTN:"WTN",DUPR:qK,UTR_P:YK,UTPR:KK,PSA:"PSA",SQUASH_LEVELS:XK,US_SQUASH:JK,USATT:QK,ITTF:ZK,USAR:e7,BWF:"BWF"},ive={ELO:{defaultInitialization:1500,decimalsCount:0,range:[0,3e3],ascending:!1},[zK]:{accessors:["ntrpRating","dntrpRatingHundredths"],attributes:{ustaRatingType:""},accessor:"dntrpRatingHundredths",defaultInitialization:3,decimalsCount:1,ascending:!1,range:[1,7]},UTR:{defaultInitialization:6,accessors:["utrRating"],accessor:"utrRating",decimalsCount:2,ascending:!1,range:[1,16]},WTN:{attributes:{confidence:{generator:!0,range:[60,100]}},accessors:["wtnRating","confidence"],defaultInitialization:23,accessor:"wtnRating",ascending:!0,decimalsCount:2,range:[40,1]},[qK]:{defaultInitialization:3.5,accessors:["duprRating","reliabilityScore"],accessor:"duprRating",attributes:{reliabilityScore:{generator:!0,range:[0,100]}},decimalsCount:3,ascending:!1,range:[2,8]},[YK]:{defaultInitialization:5,accessors:["utrpRating","verified"],accessor:"utrpRating",attributes:{verified:{type:"boolean"},provisional:{type:"string"}},decimalsCount:1,ascending:!1,range:[1,10]},[KK]:{defaultInitialization:3.5,accessor:"utprRating",decimalsCount:1,ascending:!1,range:[2,5],deprecated:!0},PSA:{defaultInitialization:500,accessor:"psaPoints",decimalsCount:0,ascending:!1,range:[0,3e3],attributes:{tournaments:{generator:!0,range:[1,20]},divisor:{generator:!0,range:[10,20]}}},[XK]:{defaultInitialization:2e3,accessor:"squashLevel",decimalsCount:0,ascending:!1,range:[0,7e3]},[JK]:{defaultInitialization:3.5,accessor:"usSquashRating",decimalsCount:1,ascending:!1,range:[2,6]},[QK]:{defaultInitialization:1e3,accessor:"usattRating",decimalsCount:0,ascending:!1,range:[200,3e3]},[ZK]:{defaultInitialization:500,accessor:"ittfPoints",decimalsCount:0,ascending:!1,range:[0,2e4]},[e7]:{defaultInitialization:1e4,accessor:"usarRanking",decimalsCount:0,ascending:!0,range:[1,25e3]},BWF:{defaultInitialization:5e3,accessor:"bwfPoints",decimalsCount:0,ascending:!0,range:[0,15e4],attributes:{tournaments:{generator:!0,range:[1,10]}}}},xr=ive;function rve({sourceRatingType:t,sourceRating:e}){let i=xr[t]?.range,r=i?.[0]>i?.[1],n=xr.ELO.range;return Ug({value:r?i[0]-e:e,sourceRange:i,targetRange:n})}function nve({targetRatingType:t,sourceRating:e}){let i=xr[t]?.decimalsCount||0,r=xr[t]?.range,n=r?.[0]>r?.[1],a=Math.max(...r),s=xr.ELO?.range,o=Ug({targetRange:r,sourceRange:s,value:e}),l=Number.parseFloat(o?.toFixed(i))||0;return n?a-l:l}function xH(t){let e=Ge(t,[{ratings:!0,[zn]:Yn}]);if(e.error)return e;let i=t.matchUpType&&[Wt,$t].includes(t.matchUpType)?t.matchUpType:Wt,r=Object.keys(xr),n=t.targetRatingType&&r.includes(t.targetRatingType)?t.targetRatingType:"ELO",a=t.ratings[i]?t.ratings[i].reduce((p,f)=>p.includes(f.scaleName)?p:p.concat(f.scaleName),[]):[];if(!a)return{error:_r};let s=t.ratings[i]?.find(p=>p.scaleName===n)??t.ratings[i]?.[0];if(a[0]===n)return s;let o=s?.scaleName,l=xr[s?.scaleName]?.accessor,u=l&&s.scaleValue[l]||s?.scaleValue,c=rve({sourceRatingType:o,sourceRating:u}),d=nve({targetRatingType:n,sourceRating:c});return d?{convertedRating:d,sourceRating:u}:{error:ie}}function ave({participantResults:t,sides:e,score:i}){let r=e?.find(({sideNumber:o})=>o===1),n=e?.find(({sideNumber:o})=>o===2),a=r?.participant?.ratings,s=n?.participant?.ratings;if(a?.[Wt]&&s?.[Wt]){let o="ELO",{convertedRating:l}=xH({ratings:a,targetRatingType:o}),{convertedRating:u}=xH({ratings:s,targetRatingType:o}),{side1pressure:c,side2pressure:d}=sve({side1ConvertedRating:l,side2ConvertedRating:u,score:i});c&&t[r?.participantId].pressureScores.push(c),d&&t[n?.participantId].pressureScores.push(d);let p=Math.max(...xr.ELO.range),f=RD((u-l)/p),m=RD((l-u)/p);t[r?.participantId].ratingVariation.push(f),t[n?.participantId].ratingVariation.push(m)}}function sve({side1ConvertedRating:t,side2ConvertedRating:e,score:i}){let r=Math.max(t,e),n=Math.min(t,e),a=Math.abs(t-e),s=xr.ELO.range,o=Math.max(...s),l=(o-r)*0,u=(r+l)/o*a,c=i?.sets?.reduce((v,w)=>v+(w?.side1Score??0),0),d=i?.sets?.reduce((v,w)=>v+(w.side2Score??0),0),p=t>e?2:1,f=(c||0)*(n+(p===1?u:0)),m=(d||0)*(n+(p===2?u:0)),h=f+m,g=h?RD(f/h):0,I=h?RD(m/h):0;return{side1pressure:g,side2pressure:I}}function lL({winningSide:t,matchUpFormat:e=Xu,matchUpStatus:i,tallyPolicy:r,score:n}){let a=[0,0],s=n?.sets,o=typeof t=="number"&&t-1,l=zi(e),u=uL(l?.bestOf??1);if(typeof o=="number"&&(i===Qt&&r?.setsCreditForDefaults||i===mi&&r?.setsCreditForWalkovers))a[o]=u;else for(let c of s||[]){let{winningSide:d}=c;d&&(a[d-1]+=1)}return typeof o=="number"&&i===$r&&(+a[1-o]===u&&(a[1-o]-=1),r?.setsCreditForRetirements&&(a[o]=u)),a}function t7({matchUpFormat:t=Xu,winningSide:e,matchUpStatus:i,tallyPolicy:r,score:n}){let{sets:a}=n||{};if(!a)return[0,0];let s=typeof e=="number"&&e-1,o=zi(t),l=o?.bestOf??1,u=uL(l),c=o?.setFormat?.tiebreakAt||0,d=[[],[]];if(typeof s=="number"&&(i===Qt&&r?.gamesCreditForDefaults||i===mi&&r?.gamesCreditForWalkovers)){let p=o?.setFormat?.setTo||0,f=u*p;d[s].push(f)}else a.forEach((p,f)=>{let m=(p.setNumber||f+1)>u&&o?.finalSetFormat?"finalSetFormat":"setFormat",h=o?.[m]?.based,g=o?.[m].tiebreakSet,{side1Score:I,side2Score:v}=p;FH(h)&&!g&&(d[0].push(Ye(I||0)),d[1].push(Ye(v||0))),g&&p.winningSide&&r?.gamesCreditForTiebreakSets!==!1&&d[p.winningSide-1].push(1)});if(i===$r&&typeof s=="number"){let p=a.length>u&&o?.finalSetFormat?"finalSetFormat":"setFormat",f=o?.[p];if(FH(f.based)){let m=f?.setTo||0,h=I=>{if(!(!o||I===""))return+I===c-1||+I===c?Ye(c||0)+1:+I<c?m:c},g=lL({winningSide:e,score:{sets:a},matchUpStatus:i,matchUpFormat:t,tallyPolicy:r});if(d.map(I=>I[s]<=I[1-s]).reduce((I,v)=>I+(v?1:0),0)>g[1-s]){let I=d[s].length,v=h(d[1-s][I-1]);v&&(d[s][I-1]=v)}u>d[s].length&&r?.gamesCreditForRetirements&&d[s].push(m)}}return[d[0].reduce((p,f)=>p+f,0),d[1].reduce((p,f)=>p+f,0)]}function i7({matchUpFormat:t,score:e}){let i=t?zi(t):void 0,r=i?.bestOf??1,n=uL(r),a=[0,0],s=[0,0];return e?.sets?.forEach((o,l)=>{let u=(o.setNumber||l+1)>n&&i?.finalSetFormat?"finalSetFormat":"setFormat",c=i?.[u]?.based;if(r7(c)){let{side1Score:d,side2Score:p}=o;d&&(s[0]+=Ye(d||0)),p&&(s[1]+=Ye(p||0))}else o.side1TiebreakScore&&(s[0]+=Ye(o.side1TiebreakScore||0)),o.side2TiebreakScore&&(s[1]+=Ye(o.side2TiebreakScore||0)),(o.side1TiebreakScore||o.side2TiebreakScore)&&o.winningSide&&(a[o.winningSide-1]+=1)}),{pointsTally:s,tiebreaksTally:a}}function uL(t){return t&&Math.ceil(t/2)||1}function r7(t){return t==="P"}function FH(t){return!r7(t)}function ove({participantResults:t,groupingTotal:e,matchUpFormat:i,tallyPolicy:r,totalGames:n,perPlayer:a,totalSets:s}){let o=i&&zi(i)||{},l=o.bestOf,u=l&&Math.ceil(l/2)||1,c=o.setFormat?.setTo,d=Math.pow(10,r?.precision||3);Object.keys(t).forEach(p=>{let f=t[p].setsWon,m=t[p].setsLost,h=r?.groupTotalSetsPlayed||e==="setsPct"?s:a*u||f+m,g=Math.round(f/h*d)/d;(g===1/0||Number.isNaN(g))&&(g=h);let I=t[p].tieMatchUpsWon,v=t[p].tieMatchUpsLost,w=I+v,y=Math.round(I/w*d)/d;(y===1/0||Number.isNaN(y))&&(y=I);let b=t[p].matchUpsWon,S=t[p].matchUpsLost,U=b+S,T=Math.round(b/U*d)/d;(T===1/0||Number.isNaN(T))&&(T=b);let P=t[p].gamesWon||0,D=t[p].gamesLost||0,E=(a||0)*u*(c||0),R=r?.groupTotalGamesPlayed||e==="gamesPct"?n:Math.max(E,P+D),C=Math.round(P/R*d)/d;(C===1/0||Number.isNaN(C))&&(C=0);let M=t[p].pointsWon+t[p].pointsLost,N=Math.round(t[p].pointsWon/M*d)/d;(N===1/0||Number.isNaN(N))&&(N=0),t[p].setsWon=f,t[p].setsLost=m,t[p].setsPct=g,t[p].tieMatchUpsWon=I,t[p].tieMatchUpsPct=y,t[p].matchUpsPct=T,t[p].gamesWon=P,t[p].gamesLost=D,t[p].gamesPct=C,t[p].pointsPct=N,t[p].result=`${t[p].matchUpsWon}/${t[p].matchUpsLost}`})}function lS({participantIds:t,pressureRating:e,groupingTotal:i,matchUpFormat:r,tallyPolicy:n,perPlayer:a,matchUps:s}){let o={},l=n?.excludeMatchUpStatuses||[],u=s?.filter(f=>(f.tieMatchUps||!l.includes(f.matchUpStatus))&&(!t?.length||xi(t,[Tg(f,0),Tg(f,1)]).length===2)),c=u?.flatMap(({score:f,tieMatchUps:m})=>m?m.filter(({matchUpStatus:h})=>!l.includes(h)).flatMap(({score:h})=>h?.sets?.length??0):f?.sets?.length??0)?.reduce((f,m)=>f+m,0),d=f=>f?.sets?.reduce((m,h)=>m+(h?.side1Score??0)+(h?.side2Score??0),0)??0,p=u?.flatMap(({score:f,tieMatchUps:m})=>m?m.filter(({matchUpStatus:h})=>!l.includes(h)).flatMap(({score:h})=>d(h)):d(f))?.reduce((f,m)=>f+m,0);for(let f of u??[]){let{matchUpStatus:m,tieMatchUps:h,tieFormat:g,score:I,winningSide:v,sides:w}=f,y=g&&f._disableAutoCalc&&g.collectionDefinitions.every(({scoreValue:U})=>U),b=v&&lve(f),S=v&&uve(f);if(!b&&!S)if(m&&Yi.includes(m)){let U=Tg(f,0),T=Tg(f,1);U&&(Xc(o,U),o[U].matchUpsCancelled+=1),T&&(Xc(o,T),o[T].matchUpsCancelled+=1)}else if(h?.length){a=0;for(let U of h){if(U.winningSide){let T=w?.find(({sideNumber:D})=>D===U.winningSide)?.participantId,P=w?.find(({sideNumber:D})=>D===U.winningSide)?.participantId;T&&P&&(Xc(o,T),Xc(o,P),o[T].tieMatchUpsWon+=1,o[P].tieMatchUpsLost+=1,Di(Wt)(U.matchUpType)?(o[T].tieSinglesWon+=1,o[P].tieSinglesLost+=1):Di($t)(U.matchUpType)&&(o[T].tieDoublesWon+=1,o[P].tieDoublesLost+=1))}LH({score:U.score,manualGamesOverride:y,participantResults:o,sides:w})}}else LH({manualGamesOverride:y,participantResults:o,score:I,sides:w});else if(Xc(o,b),Xc(o,S),h?.length){a=0;for(let U of h){let{matchUpType:T}=U,P=Di($t)(T),D=Di(Wt)(T);U.winningSide&&(U.winningSide===v?(b&&(o[b].tieMatchUpsWon+=1,D&&(o[b].tieSinglesWon+=1),P&&(o[b].tieDoublesWon+=1)),S&&(o[S].tieMatchUpsLost+=1,D&&(o[S].tieSinglesLost+=1),P&&(o[S].tieDoublesLost+=1))):U.winningSide!==v&&(S&&(o[S].tieMatchUpsWon+=1,D&&(o[S].tieSinglesWon+=1),P&&(o[S].tieDoublesWon+=1)),b&&(o[b].tieMatchUpsLost+=1,D&&(o[b].tieSinglesLost+=1),P&&(o[b].tieDoublesLost+=1)))),_H({matchUpFormat:U.matchUpFormat,matchUpStatus:U.matchUpStatus,matchUpType:U.matchUpType,score:U.score,sides:U.sides,winningParticipantId:b,losingParticipantId:S,manualGamesOverride:y,participantResults:o,isTieMatchUp:!0,pressureRating:e,tallyPolicy:n,winningSide:v})}n7({winningParticipantId:b,losingParticipantId:S,participantResults:o,matchUpStatus:m})}else _H({matchUpFormat:f.matchUpFormat??r,matchUpType:f.matchUpType,isTieMatchUp:void 0,winningParticipantId:b,manualGamesOverride:y,losingParticipantId:S,participantResults:o,pressureRating:e,matchUpStatus:m,tallyPolicy:n,winningSide:v,score:I,sides:w});if(y){let U=I?.sets?.reduce((E,R)=>E+(R?.side1Score??0),0),T=I?.sets?.reduce((E,R)=>E+(R.side2Score??0),0),P=w?.find(({sideNumber:E})=>E===1)?.participantId,D=w?.find(({sideNumber:E})=>E===2)?.participantId;Xc(o,P),Xc(o,D),P&&(o[P].gamesWon+=U,o[P].gamesLost+=T),D&&(o[D].gamesWon+=T,o[D].gamesLost+=U)}}return ove({participantResults:o,groupingTotal:i,matchUpFormat:r,tallyPolicy:n,totalGames:p,perPlayer:a,totalSets:c}),{participantResults:o}}function lve(t){let e=t.winningSide-1;return Tg(t,e)}function uve(t){let e=1-(t.winningSide-1);return Tg(t,e)}function Tg(t,e){if(!t?.sides)return console.log("no sides:",{matchUp:t}),"foo";let i=t.sides[e];return i?i.participantId:(console.log("No Side",{matchUp:t,index:e}),"foo")}function Xc(t,e){e&&!t[e]&&(t[e]={allDefaults:0,defaults:0,defeats:[],gamesLost:0,gamesWon:0,matchUpsCancelled:0,matchUpsLost:0,matchUpsWon:0,pointsLost:0,pointsWon:0,pressureScores:[],ratingVariation:[],retirements:0,setsLost:0,setsWon:0,tieSinglesWon:0,tieSinglesLost:0,tieDoublesWon:0,tieDoublesLost:0,tieMatchUpsLost:0,tieMatchUpsWon:0,victories:[],walkovers:0})}function LH({manualGamesOverride:t,participantResults:e,score:i,sides:r}){let{sets:n}=i||{},a=[[],[]],s=[0,0];for(let l of n||[]){let{winningSide:u,side1Score:c,side2Score:d}=l;u&&(s[u-1]+=1),a[0].push(Ye(c||0)),a[1].push(Ye(d||0))}let o=[a[0].reduce((l,u)=>l+u,0),a[1].reduce((l,u)=>l+u,0)];r.forEach((l,u)=>{let{participantId:c}=l;c&&(Xc(e,c),e[c].setsWon+=s[u],e[c].setsLost+=s[1-u],t||(e[c].gamesWon+=o[u],e[c].gamesLost+=o[1-u]))})}function _H({winningParticipantId:t,manualGamesOverride:e,losingParticipantId:i,participantResults:r,pressureRating:n,matchUpFormat:a,matchUpStatus:s,isTieMatchUp:o,matchUpType:l,tallyPolicy:u,winningSide:c,score:d,sides:p}){let f=c&&c-1,m=1-f;n&&l===Wt&&ave({participantResults:r,sides:p,score:d}),o||n7({winningParticipantId:t,losingParticipantId:i,participantResults:r,matchUpStatus:s});let h=lL({matchUpStatus:s,matchUpFormat:a,tallyPolicy:u,winningSide:c,score:d}),g=t7({matchUpStatus:s,matchUpFormat:a,tallyPolicy:u,winningSide:c,score:d}),{pointsTally:I}=i7({score:d,matchUpFormat:a});t&&(r[t].setsWon+=h[f],r[t].setsLost+=h[m],e||(r[t].gamesWon+=g[f],r[t].gamesLost+=g[m]),r[t].pointsWon+=I[f],r[t].pointsLost+=I[m]),i&&(r[i].setsWon+=h[m],r[i].setsLost+=h[f],e||(r[i].gamesWon+=g[m],r[i].gamesLost+=g[f]),r[i].pointsWon+=I[m],r[i].pointsLost+=I[f])}function n7({winningParticipantId:t,losingParticipantId:e,participantResults:i,matchUpStatus:r}){e&&(r===mi&&(i[e].walkovers+=1),r===Qt&&(i[e].defaults+=1),r===$r&&(i[e].retirements+=1),Fr(r)&&(i[e].allDefaults+=1),i[e].matchUpsLost+=1),t&&(i[t].matchUpsWon+=1),e&&t&&(i[e].defeats.push(t),i[t].victories.push(e))}function cve(t,e,i,r){t.groups&&Object.keys(t.groups).sort(r).forEach(n=>{let a=t.groups[n].map(o=>e[o]).join(", "),s=`${n} ${t.attribute}: ${a}`;i.push(s)})}function dve(t,e,i,r){if(t.excludedDirectives?.length){let n=t.excludedDirectives.map(({attribute:o})=>o).join(", "),a=`${n.length} directives were excluded due to participants limit}`;r.push(a);let s=`Excluded: ${n}`;r.push(s)}else{let n=(u,c)=>Number.parseFloat(t.reversed?u:c)-Number.parseFloat(t.reversed?c:u),a=t.groups?Object.values(t.groups).flat(1/0).length:t.participantIds?.length??0,s=t.reversed?" in reverse order":"",o=t.groups?"grouped":"separated",l=`Step ${e+1}: ${a} particiants were ${o}${s} by ${t.attribute}`;if(r.push(l),t.idsFilter){let u=`${t.attribute} was calculated considering ONLY TIED PARTICIPANTS`;r.push(u)}cve(t,i,r,n)}r.push("----------------------")}function pve({matchUps:t,order:e,report:i}){let r={};t.forEach(({sides:a})=>{a.forEach(s=>{s.participantId&&s.participant&&(r[s.participantId]=s.participant.participantName)})});let n=[];return Array.isArray(i)&&i.forEach((a,s)=>{dve(a,s,r,n)}),n.push("Final Order:"),e.forEach(a=>{let{participantId:s,resolved:o}=a,l=a.groupOrder||a.provisionalOrder;n.push(`${l}: ${r[s]} => resolved: ${!!o}`)}),n.join(`\r
`)}function a7({participantResults:t,participantIds:e,attribute:i}){return s7({participantResults:t,participantIds:e}).reduce((r,n)=>{let{participantId:a,results:s}=n,o=s?.[i];return!isNaN(o)&&a&&(r[o]?r[o].push(a):r[o]=[a]),r},{})}function s7(t){return(t.participantIds||Object.keys(t.participantResults)).reduce((e,i,r)=>(e.push({participantId:i,i:r,results:t.participantResults[i]}),e),[])}var fve=[{attribute:"matchUpsPct",idsFilter:!1},{attribute:"allDefaults",reversed:!0,idsFilter:!1},{attribute:"defaults",reversed:!0,idsFilter:!1},{attribute:"walkovers",reversed:!0,idsFilter:!1},{attribute:"retirements",reversed:!0,idsFilter:!1},{attribute:"setsPct",idsFilter:!1},{attribute:"gamesPct",idsFilter:!1},{attribute:"pointsPct",idsFilter:!1},{attribute:"matchUpsPct",idsFilter:!0},{attribute:"setsPct",idsFilter:!0},{attribute:"gamesPct",idsFilter:!0},{attribute:"pointsPct",idsFilter:!0}],TA={matchUpsPct:20,tieMatchUpsPct:16,pointsPct:4,gamesPct:8,setsPct:12};function $H(t){let{requireCompletion:e=!0,participantResults:i,subOrderMap:r,tallyPolicy:n}=t,a=[];if(e&&!mve(t))return{};let s=["tieMatchUpsWon","tieSinglesWon","tieDoublesWon","matchUpsWon","pointsWon","gamesWon","setsWon","gamesPct","setsPct","pointsPct","matchUpsPct"].includes(n?.groupOrderKey)?n.groupOrderKey:"matchUpsWon",o=a7({participantResults:i,attribute:s});a.push({attribute:s,groups:o});let l=Object.keys(o).map(g=>Number.parseFloat(g)).sort((g,I)=>I-g).map(g=>o[g]).map(g=>{let I=o7({participantIds:g,...t});return a.push(...I.report??[]),I.order}).flatMap((g,I)=>g.map(v=>v.resolved?v:{...v,subGroup:[I].concat(...v.subGroup??[])})),u,c=0,d=1,p;l.forEach((g,I)=>{I&&(g.resolved||p&&!g.resolved)&&(d+=1),p=g.resolved;let v=Number.parseInt(g.subGroup?.join("")||0);g.resolved?(g.position=I+1,d=g.position):(u&&v>u&&(d+=c,c=0),g.position=d,c+=1),u=v});let f=l.map(({position:g})=>g),m=va(f);return l.forEach(g=>{let{participantId:I,position:v}=g||{},w=i[I];g.GEMscore=h(w);let y=m[v];g?.position!==void 0&&(y>1&&(g.ties=y,r&&(g.subOrder=r[I])),g.rankOrder=v,g.groupOrder=v+(g.subOrder||1)-1)}),{groupOrder:l,report:a.flat(1/0).filter(Boolean)};function h(g){return(Array.isArray(n?.GEMscore)?Object.keys(TA).filter(I=>n.GEMscore.includes(I)):Object.keys(TA)).map(I=>(g[I]||0)*Math.pow(10,TA[I].toFixed(3))).reduce((I,v)=>I+v,0)}}function mve({participantResults:t,participantsCount:e}){let i=s7({participantResults:t}).filter(r=>e-1===r.results.matchUpsWon+r.results.matchUpsLost+r.results.matchUpsCancelled);return e===i.length}function hve({disableHeadToHead:t,participantIds:e,matchUpFormat:i,groupTotals:r,tallyPolicy:n,attribute:a,idsFilter:s,matchUps:o,reversed:l}){let{participantResults:u}=lS({participantIds:s&&e,groupingTotal:r&&a,matchUpFormat:i,tallyPolicy:n,matchUps:o}),c=a7({participantResults:u,participantIds:e,attribute:a}),d=[{attribute:a,reversed:l,groups:c,idsFilter:s,groupTotals:r}],p;return Object.keys(c).length>1&&e.length&&(p=Object.keys(c).map(f=>Number.parseFloat(f)).sort((f,m)=>l?f-m:m-f).map(f=>c[f]).map(f=>{let m=o7({participantResults:u,disableHeadToHead:t,participantIds:f,matchUpFormat:i,tallyPolicy:n,matchUps:o});return d.push(...m.report??[]),m.order}).flatMap((f,m)=>f.map(h=>h.resolved?h:{...h,subGroup:[m].concat(...h.subGroup??[])}))),{order:p,report:d}}function o7({participantResults:t,disableHeadToHead:e,participantIds:i,matchUpFormat:r,tallyPolicy:n,matchUps:a}){let s=[],o=[],l;if(i?.length===1)return{order:[{resolved:!0,participantId:i[0]}]};if(i?.length===2&&(!n?.headToHead||!n.headToHead.disabled&&!e)){let c=gve({participantIds:i,participantResults:t});if(c){let d=c[0].participantId;return o.push({attribute:"head2Head",participantIds:i,headToHeadWinner:d}),{order:c,headToHeadWinner:d,report:o}}}let u=(n?.tallyDirectives||fve).filter(c=>{let d=!(Ni(c.maxParticipants)&&i?.length>c.maxParticipants);return d||s.push(c),d});return s.length&&o.push({excludedDirectives:s,participantIds:i}),u.every(({attribute:c,reversed:d,idsFilter:p,groupTotals:f,disableHeadToHead:m})=>(l=hve({disableHeadToHead:m,participantIds:i,matchUpFormat:r,groupTotals:f,tallyPolicy:n,attribute:c,idsFilter:p,matchUps:a,reversed:d}),o.push(l.report),!l.order)),l.order?{order:l.order,report:o}:{order:i?.map(c=>({participantId:c})),report:o}}function gve({participantIds:t,participantResults:e}){if(t){if(e[t[0]].victories.includes(t[1]))return t.map(i=>({resolved:!0,participantId:i}));if(e[t[1]].victories.includes(t[0]))return t.reverse().map(i=>({resolved:!0,participantId:i}))}}function gh({policyDefinitions:t,generateReport:e,pressureRating:i,matchUpFormat:r,matchUps:n=[],subOrderMap:a,perPlayer:s}){if(!n?.length||!Ga(n))return{error:Tu};let o=rt(n.map(({structureId:y})=>y));if(o.length!==1)return z({result:{error:ie,info:"Maximum one structureId"},stack:"tallyParticipantResults",context:{structureIds:o}});let l=n.filter(y=>y&&y.matchUpStatus!=="BYE"),u=l.length&&rt(l.flatMap(({drawPositions:y})=>y)).length,c=l.filter(y=>fp({matchUp:y})).length===l.length;c||(s=0);let d=n.every(({matchUpType:y,tieMatchUps:b})=>y===Zt&&b?.every(S=>fp({matchUp:S}))),p=t?.[SF],f=n.filter(y=>fp({matchUp:y})??y.matchUpType===Zt),{participantResults:m}=lS({matchUps:f,pressureRating:i,matchUpFormat:r,tallyPolicy:p,perPlayer:s}),h,g,{groupOrder:I,report:v}=$H({matchUps:f,participantResults:m,participantsCount:u,matchUpFormat:r,subOrderMap:a,tallyPolicy:p});if(i&&Ive({participantResults:m}),c&&I)h=v,g=I,I.forEach(y=>{let{participantId:b,groupOrder:S,rankOrder:U,subOrder:T,ties:P,GEMscore:D}=y,E=m[b];Object.assign(E,{groupOrder:S,rankOrder:U,GEMscore:D,subOrder:T,ties:P})});else{let{groupOrder:y,report:b}=$H({requireCompletion:!1,participantResults:m,participantsCount:u,matchUpFormat:r,tallyPolicy:p,subOrderMap:a,matchUps:n});h=b,g=y,y&&y.forEach(S=>{let{participantId:U,groupOrder:T,GEMscore:P}=S,D=m[U];Object.assign(D,{provisionalOrder:T,GEMscore:P})})}let w={completedTieMatchUps:d,readableReport:"",participantResults:m,bracketComplete:c,order:[],report:h};if((c||d)&&(w.order=g),e||ia({tally:!0})){let y=pve({matchUps:n,report:h,order:g});ia({tally:!0})&&console.log(y),w.readableReport=y}return w}function Ive({participantResults:t}){let e=n=>n.reduce((a,s)=>a+parseFloat(s),0),i=n=>parseFloat((e(n)/n.length).toFixed(2)),r=Object.keys(t).map(n=>{let a=t[n],{pressureScores:s}=a,o=s?.length?i(s):0;return{participantId:n,averagePressure:o}}).sort((n,a)=>(a.averagePressure||0)-(n.averagePressure||0)).map((n,a)=>({...n,order:a+1}));for(let n of r)t[n.participantId].pressureOrder=n.order}function Hl({requireTimeStamp:t,scaleAttributes:e,participant:i}){if(!i)return{error:ih};if(!bt(e))return{error:ie};if(i.timeItems??=[],Array.isArray(i.timeItems)){let{accessor:r,scaleType:n,eventType:a,scaleName:s}=e,o=[pd,n,a,s].join("."),l=i.timeItems.filter(u=>u?.itemType===o).filter(u=>!t||u?.itemDate).sort((u,c)=>(u.createdAt?new Date(u.createdAt).getTime():0)-(c.createdAt?new Date(c.createdAt).getTime():0)).pop();if(l){let[u,c,d,p]=l.itemType?.split(".")??[];if(u!==pd)return{error:Tm};let f=r&&mp({element:l.itemValue,accessor:r}),m=f?.value||l.itemValue,h={rawValue:f&&l.itemValue,eventType:d,scaleDate:l.itemDate,scaleValue:m,scaleName:p,scaleType:c};return{...H,scaleItem:h}}}return{...H,scaleItem:void 0}}function vve({publishedSeeding:t,usePublishState:e,withSeeding:i,participant:r,event:n}){let a={},s=c=>[pd,jl,n.eventType,c].join("."),o=Object.assign({},...(r.timeItems||[]).filter(({itemType:c})=>c.split(".")[1]===jl).map(({itemType:c,itemValue:d})=>({[c]:d}))),l=(t?.stageSeedingScaleNames&&Object.values(t?.stageSeedingScaleNames)||Array.isArray(t?.seedingScaleNames)&&t.seedingScaleNames||[]).map(s),u=xi(Object.keys(o),l);if((!e||!Object.keys(o).length&&!t?.drawIds?.length||u.length)&&u.length){if(t?.stageSeedingScaleNames){let c=Object.keys(t.stageSeedingScaleNames).map(p=>{let f=s(t.stageSeedingScaleNames[p]),m=o[f];return[p,m]}).filter(p=>p[1]).map(p=>({[p[0]]:{seedValue:p[1]}})),d=Object.assign({},...c);a.seedAssignments=d}else if(u){let c=u.map(d=>o[d]);a.seedValue=c.pop()}}else if(!e&&typeof i=="object"){let c=Object.keys(i).map(p=>{let f=s(i[p]),m=o[f];return[p,m]}).filter(p=>p[1]).map(p=>({[p[0]]:{seedValue:p[1]}})),d=Object.assign({},...c);a.seedAssignments=d}else{let{categoryName:c,ageCategoryCode:d}=n.category||{},p=[d,n.eventId,c].filter(Boolean),f;for(let m of p){let h={eventType:n.eventType,scaleType:jl,scaleName:m},g=Hl({scaleAttributes:h,participant:r});if(g.scaleItem){f=g.scaleItem;break}}if(f&&(!e||t?.published&&!t?.published?.drawIds?.length)){let m=f.scaleValue;a.seedValue=m}}return a}function cL({positionAssignments:t}){let e=(t||[]).filter(ba(su)).map(n=>{let{extension:a}=mt({element:n,name:rI}),s=Ye(a?.value),o=!isNaN(s)&&s;return o&&{participantId:n.participantId,subOrder:o}}).filter(Boolean),i=e.map(({subOrder:n})=>n),r=va(i);return{subOrderMap:Object.assign({},...e.filter(({subOrder:n})=>r[n]===1).map(({participantId:n,subOrder:a})=>({[n]:a})))}}function yve({convertExtensions:t,seedAssignments:e,participant:i,withSeeding:r,seedValue:n,eventId:a,ranking:s,entry:o}){let{entryStatus:l,entryStage:u,entryPosition:c,extensions:d}=o,p=d?.length&&t?Object.assign({},...oF(d??[])):{},f=Object.assign(p,{entryPosition:c,entryStatus:l,entryStage:u,ranking:s,eventId:a});i.events[a]=Ve(f,!1,!1,!0),r&&(e&&(i.events[a].seedAssignments=e),n&&(i.events[a].seedValue=n))}function uS(t){let e=Ge(t,[{[mr]:!0}]);if(e.error)return e;let{tournamentRecord:i,status:r=Ha}=t,n=`${Bd}.${Vd}`;return ke(SR({tournamentRecord:i,itemType:n})?.timeItem?.itemValue?.[r],!1,!0)}function bve(t){let{tournamentId:e}=t??{};return!!e}function za({event:t,status:e=Ha}){let i=`${Bd}.${Vd}`;return qw({itemType:i,event:t})?.timeItem?.itemValue?.[e]}function Of(t){let e=t?.embargo;return!e||!ac(e)?!1:new Date(e).getTime()>Date.now()}function Bo(t){return!!t?.published&&!Of(t)}function dL({drawDetails:t,drawId:e,ignoreEmbargo:i=!1}){let r=t?.[e]?.publishingDetail;return i?!!r?.published:Bo(r)}function Ih(t){let{tournamentRecord:e,drawDefinition:i,eventIds:r,eventId:n,drawIds:a,drawId:s,event:o}=t??{};if(e&&!bve(e))return{error:ie};if(n&&!o)return{error:os};if(Array.isArray(r)&&r?.length){let p={};for(let f of r){if(!ri(f))return{error:ie};let m=jn({tournamentRecord:e,eventId:f})?.event;if(!m)return{error:os};let h=DA({event:m});p[f]=h}return{...H,publishState:p}}if(o){let p=DA({event:o}),f={};if(s)return i?{publishState:{status:{published:!!p.status.publishedDrawIds?.includes(s),drawDetail:p.status.drawDetails?.[s]},...H}}:{error:Oa};if(Array.isArray(a)&&a?.length){let m=o.drawDefinitions?.map(wb)??[];for(let h of a){if(!ri(h))return{error:ie};if(!m.includes(h))return{error:Oa};f[h]={status:{published:!!p.status.publishedDrawIds.includes(h),drawDetail:p.status.drawDetails?.[h]}}}}else f=p;return{...H,publishState:f}}let l=[],u=!1,c={};for(let p of e?.events??[]){let f=DA({event:p});c[p.eventId]=f,f.status.published&&(l.push(p.eventId),u=!0);for(let{drawId:m}of p.drawDefinitions??[]){let h=f.status?.publishedDrawIds?.includes(m);h&&(c[m]={status:{published:h}})}}let d=[];if(e){let p=uS({tournamentRecord:e});c.tournament=p??{},(p?.orderOfPlay?.published||p?.participants?.published)&&(u=!0),c.tournament.status={published:u,publishedEventIds:l},p?.orderOfPlay?.embargo&&d.push({type:"orderOfPlay",embargo:p.orderOfPlay.embargo,embargoActive:Of(p.orderOfPlay)}),p?.participants?.embargo&&d.push({type:"participants",embargo:p.participants.embargo,embargoActive:Of(p.participants)})}for(let p of e?.events??[]){let f=za({event:p})?.drawDetails??{};for(let[m,h]of Object.entries(f)){h?.publishingDetail?.embargo&&d.push({type:"draw",id:m,embargo:h.publishingDetail.embargo,embargoActive:Of(h.publishingDetail)});for(let[g,I]of Object.entries(h?.stageDetails??{}))I?.embargo&&d.push({type:"stage",id:`${m}:${g}`,embargo:I.embargo,embargoActive:Of(I)});for(let[g,I]of Object.entries(h?.structureDetails??{}))if(I?.embargo&&d.push({type:"structure",id:g,embargo:I.embargo,embargoActive:Of(I)}),I?.scheduledRounds)for(let[v,w]of Object.entries(I.scheduledRounds))w?.embargo&&d.push({type:"scheduledRound",id:`${g}:round${v}`,embargo:w.embargo,embargoActive:Of(w)})}}return d.length&&(c.embargoes=d),{...H,publishState:c}}function DA({event:t}){let e=za({event:t});if(!e)return{status:{published:!1}};let i={published:void 0,seedingScaleNames:[],drawIds:[]};e.seeding&&Object.assign(i,e.seeding);let r=e.drawDetails??{};for(let o of t.drawDefinitions?.map(wb)||[])r[o]||(r[o]={publishingDetail:{published:!1}});let n=r&&Object.keys(r).length&&Object.keys(r).filter(o=>dL({drawDetails:r,drawId:o,ignoreEmbargo:!0})),a=n?.length?n:e.drawIds??[];if(a?.length&&!n?.length)for(let o of a)r[o]={publishingDetail:{published:!0}};let s=a?.length>0;return{status:{publishedDrawIds:a,publishedSeeding:i,drawDetails:r,published:s}}}function l7(t){let{participantMap:e,participantId:i,matchUpStatus:r,roundPosition:n,structureId:a,matchUpType:s,roundNumber:o,matchUpId:l,potential:u,schedule:c,drawId:d,score:p}=t;!c||!Object.keys(c).length||r==="BYE"||e[i].scheduleItems.push({...c,scheduledDate:Qe(c?.scheduledDate),scheduledTime:ci(c?.scheduledTime),checkScoreHasValue:cr({score:p}),matchUpStatus:r,roundPosition:n,structureId:a,matchUpType:s,roundNumber:o,matchUpId:l,potential:u,drawId:d})}function wve({finishingPositionRange:t={winner:[],loser:[]},collectionPosition:e,participantMap:i,finishingRound:r,participantWon:n,collectionId:a,matchUpStatus:s,participantId:o,stageSequence:l,roundNumber:u,structureId:c,matchUpId:d,drawId:p,stage:f}){let m=i[o],h=y=>Math.abs(y[0]-y[1]);m.structureParticipation[c]||(m.structureParticipation[c]={rankingStage:f,walkoverWinCount:0,defaultWinCount:0,stageSequence:l,winCount:0,structureId:c,drawId:p});let g=m.structureParticipation[c],{winner:I,loser:v}=t,w=n?I:v;n&&(g.winCount+=1,s===mi&&(g.walkoverWinCount+=1),s===Qt&&(g.defaultWinCount+=1)),w&&(!g.finishingPositionRange||h(w)<h(g.finishingPositionRange))&&(g.finishingPositionRange=w),r&&((!g.finishingRound||r<g.finishingRound)&&(g.finishingMatchUpId=d,g.finishingRound=r,g.roundNumber=u),r===1&&(g.participantWon=n)),e&&(g.lineParticipation||(g.lineParticipation=[]),g.lineParticipation.push({collectionPosition:e,collectionId:a,won:n}))}function BH(t){let{withScheduleItems:e,scheduleAnalysis:i,withTeamMatchUps:r,participantMap:n,withOpponents:a,withMatchUps:s,withEvents:o,withDraws:l,finishingPositionRange:u,finishingRound:c,matchUpStatus:d,stageSequence:p,roundNumber:f,structureId:m,score:h,stage:g,withRankingProfile:I,collectionPosition:v,tieWinningSide:w,roundPosition:y,matchUpTieId:b,matchUpSides:S,collectionId:U,matchUpType:T,winningSide:P,matchUpId:D,schedule:E,eventId:R,drawId:C,sides:M}=t,N=a&&M?.length===2&&Object.assign({},...M.map(({sideNumber:A},O)=>{let k=M[1-O].participantId;return A&&{[A]:k}}).filter(Boolean));for(let A of M){let{participantId:O,sideNumber:k,bye:F}=A;if(F)continue;let x=P===k,L=_=>{let B=n[_]?.participant,G=B?.participantType,j=[{participantId:_,participantType:G}];if(G!==_n)for(let K of B?.individualParticipantIds||[]){let Y=n[K]?.participant;j.push({participantType:Y?.participantType,participantId:K})}return j},$=(_,B)=>{if(s){if(n[_].matchUps[D]={participantWon:x,matchUpType:T,structureId:m,sideNumber:k,matchUpId:D,eventId:R,drawId:C,stage:g},a){let G=L(B);n[_].matchUps[D].opponentParticipantInfo=G}U&&(n[_].matchUps[D].collectionId=U)}a&&B&&(n[_].opponents[B]={participantId:B,matchUpId:D,eventId:R,drawId:C}),I&&wve({finishingPositionRange:u,collectionPosition:v,participantMap:n,participantWon:x,collectionId:U,finishingRound:c,matchUpStatus:d,participantId:_,stageSequence:p,roundNumber:f,structureId:m,matchUpId:D,drawId:C,stage:g}),(i||e)&&l7({participantMap:n,participantId:_,matchUpStatus:d,roundPosition:y,matchUpType:T,roundNumber:f,structureId:m,matchUpId:D,schedule:E,drawId:C,score:h})},V=({participant:_,partnerParticipantId:B})=>{let G=(j,K)=>{j&&(j.partnerParticipantIds||(j.partnerParticipantIds=[]),j.partnerParticipantIds.includes(K)||j.partnerParticipantIds.push(K))};l&&G(_?.draws?.[C],B),o&&G(_?.events?.[R],B),s&&G(_?.matchUps?.[D],B)};if(O&&n[O]){let _=N?.[k];$(O,_);let B=n[O]?.participant.participantType===pt,G=n[O]?.participant.individualParticipantIds||[];if(b){if(r){let j=K=>n[K].matchUps[b]={participantWon:w===k,matchUpId:b,matchUpType:Zt,sideNumber:k};j(O),G.forEach(j)}if(l&&!n[O].draws[C]){let j=S.find(X=>X.sideNumber===k)?.participant?.participantId,K=n[j]?.draws?.[C]?.entryStatus,Y=X=>n[X].draws[C]={entryStatus:K,eventId:R,drawId:C};Y(O),G.forEach(Y)}}if(B&&(G.forEach(j=>n[j]&&$(j,_)),G.forEach((j,K)=>{let Y=G[1-K],X=n[j];X&&V({participant:X,partnerParticipantId:Y})}),o&&S)){let j=S.find(K=>K.sideNumber===k)?.participant?.participantId;if(j){let K=n[j]?.events[R];K?(n[O].events[R]={...K},G.forEach(Y=>n[Y].events[R]={...K})):console.log("Missing teamEntry",{eventId:R,teamParticipantId:j})}}if(P){let j=K=>{x?(n[K].counters[T].wins+=1,n[K].counters.wins+=1,d===mi&&(n[K].counters[T].walkoverWins+=1,n[K].counters.walkoverWins+=1),d===Qt&&(n[K].counters[T].defaultWins+=1,n[K].counters.defaultWins+=1)):(n[K].counters[T].losses+=1,n[K].counters.losses+=1,d===mi&&(n[K].counters[T].walkovers+=1,n[K].counters.walkovers+=1),d===Qt&&(n[K].counters[T].defaults+=1,n[K].counters.defaults+=1))};j(O),G.forEach(j)}}}}function AR(t,e){return(t||"").localeCompare(e||"")}function Sve(t){let{participantFilters:e,convertExtensions:i,policyDefinitions:r,tournamentRecord:n,usePublishState:a,contextFilters:s,matchUpFilters:o,participantMap:l,contextProfile:u,withPotentialMatchUps:c,withRankingProfile:d,withScheduleItems:p,scheduleAnalysis:f,withTeamMatchUps:m,withStatistics:h,withOpponents:g,withMatchUps:I,withSeeding:v,withEvents:w,withDraws:y}=t,b=e?.participantIds,S=k=>{let F=[k];return l[k]?.participant.individualParticipantIds?.forEach(x=>F.push(x)),F.some(x=>!b?.length||b.includes(x))?F:[]},U={withMatchUps:I||d,withEvents:w||d,withDraws:y||d,withPotentialMatchUps:c,withRankingProfile:d,withScheduleItems:p,scheduleAnalysis:f,withTeamMatchUps:m,withStatistics:h,participantMap:l,withOpponents:g,withSeeding:v},T=[],P={},D=[],E={},R={},C={},M={},N={},A=({eventType:k,scaleNames:F,participantId:x})=>l[x]?.participant?.rankings?.[k]?.find(L=>F.includes(L.scaleName))?.scaleValue;for(let k of n?.events||[]){if(e?.eventIds&&!e.eventIds.includes(k.eventId))continue;let{drawDefinitions:F=[],extensions:x=[],wheelchairClass:L,eventType:$,eventName:V,category:_,entries:B,eventId:G,gender:j}=k,{flightProfile:K}=$i({event:k}),Y=K?.flights??[],X=Ih({event:k}).publishState;X&&(E[G]=X);let Z=X?.status?.publishedSeeding;if(w||v||d){let ae=i?Object.assign({},...oF(x??[])):{};R[G]={...ae,wheelchairClass:L,eventName:V,eventType:$,category:_,eventId:G,gender:j};let te=[_?.categoryName,_?.ageCategoryCode].filter(Boolean);for(let ne of B){let{participantId:le}=ne;if(!le||!l[le])continue;let de=A({eventType:$,scaleNames:te,participantId:le}),pe,ge;if(v){let Pe=l[le].participant;({seedAssignments:pe,seedValue:ge}=vve({publishedSeeding:Z,usePublishState:a,withSeeding:v,participant:Pe,event:k}))}let Me=Pe=>{if(l[Pe]?.events?.[G])return;let Be=l[Pe];yve({convertExtensions:i,seedAssignments:pe,participant:Be,withSeeding:v,seedValue:ge,eventId:G,ranking:de,entry:ne})};Me(le),(l[le].participant.individualParticipantIds||[]).forEach(Me)}}let J=E?.[G]?.publishedSeeding;if(y||d||v){let ae=ne=>ne?Object.assign({},...ne.map(({participantId:le,seedValue:de,seedNumber:pe})=>({[le]:{seedValue:de,seedNumber:pe}}))):void 0,te=rt([...F.map(wb),...Y.map(wb)]);for(let ne of te){let le=F.find(ee=>ee.drawId===ne),de=[_?.categoryName,_?.ageCategoryCode].filter(Boolean),{structures:pe=[],drawOrder:ge,drawName:Me,drawType:Pe}=le??{},Be=Y?.find(ee=>ee.drawId===ne),fe=le?.entries||Be?.drawEntries,Te=Be?.flightNumber,ce=(le?.structures||[]).sort((ee,Se)=>uh(ee,Se)).map(({structureId:ee,structures:Se})=>[ee,...(Se||[]).map(({structureId:De})=>De)]).flat(1/0),ye,be,Fe,we,Ne=0,me=new Set(pe.filter(({stage:ee,stageSequence:Se})=>ee===xe&&Se===1||ee===We).flatMap(ee=>{let{positionAssignments:Se}=Yt({structure:ee}),{seedAssignments:De,stageSequence:it,stage:Ue}=ee;return Ue===xe?(Ne=Se?.length??0,Fe=Se,we=De):it===1&&(ye=Se,be=De),Se}).map(({participantId:ee})=>ee).filter(Boolean)),Ee=ae(we),Le=ae(be),Q=le?fe.filter(({participantId:ee})=>me.has(ee)):fe,se=!a||J?.published&&(J?.drawIds?.length===0||J?.drawIds?.includes(ne));for(let ee of Q){if(!l[ee.participantId])continue;let{entryStatus:Se,entryStage:De,entryPosition:it,participantId:Ue}=ee,ut=A({participantId:Ue,scaleNames:de,eventType:$}),yi=qe=>{if(!l[qe]||l[qe].draws?.[ne])return;let bi=v&&se,oi=bi?{}:void 0,nn=bi?Ee?.[Ue]?.seedValue||Ee?.[Ue]?.seedNumber:void 0,Fo=nn?Ee?.[Ue]:void 0,Mf=bi?Le?.[Ue]?.seedValue||Le?.[Ue]?.seedNumber:void 0,Nf=Mf?Le?.[Ue]:void 0;oi&&nn&&(oi[xe]=Fo),oi&&Mf&&(oi[We]=Nf);let ly=nn||Mf;ly&&(l[qe].participant.seedings[$]||(l[qe].participant.seedings[$]=[]),Fo&&l[qe].participant.seedings[$].push({...Fo,scaleName:ne}),Nf&&l[qe].participant.seedings[$].push({...Nf,scaleName:ne}),oi&&(l[qe].events[G].seedAssignments||(l[qe].events[G].seedAssignments={}),Object.keys(oi).forEach(uy=>l[qe].events[G].seedAssignments[uy]=oi[uy]))),(y||d)&&(l[qe].draws[ne]=Ve({seedAssignments:oi,entryPosition:it,entryStatus:Se,entryStage:De,seedValue:ly,eventId:G,ranking:ut,drawId:ne},!1,!1,!0))};[ys,sf].includes(Se)||(yi(Ue),(l[Ue].participant.individualParticipantIds||[])?.forEach(yi))}let oe=(le?.structures??[]).reduce((ee,Se)=>(ee.includes(Se.stage)||ee.push(Se.stage),ee),[]),ue=(le?.links??[]).length;C[ne]={qualifyingPositionAssignments:ye,qualifyingSeedAssignments:be,mainPositionAssignments:Fe,qualifyingSeedingMap:Le,mainSeedAssignments:we,orderedStructureIds:ce,mainSeedingMap:Ee,flightNumber:Te,linksCount:ue,drawOrder:ge,drawName:Me,drawType:Pe,drawSize:Ne,drawId:ne,stages:oe}}}if(d||f||m||h||g||I||y){let ae=!!f||c,te=Ru({afterRecoveryTimes:!!f,policyDefinitions:r,tournamentRecord:n,inContext:!0,participantMap:l,contextFilters:s,matchUpFilters:o,contextProfile:u,nextMatchUps:ae,event:k})?.matchUps??[];for(let ne of te){let{finishingPositionRange:le,potentialParticipants:de,tieMatchUps:pe=[],sides:ge=[],winningSide:Me,matchUpType:Pe,matchUpId:Be,eventId:fe,drawId:Te,collectionId:ce,containerStructureId:ye,stageSequence:be,finishingRound:Fe,matchUpStatus:we,roundPosition:Ne,roundNumber:me,structureId:Ee,schedule:Le,score:Q,stage:se}=ne;if(P[Be]=ne,d&&ye&&Ee&&Te&&(M[Ee]||(M[Ee]=[]),M[Ee].push(ne),!N[ye])){let ue=F.find(ee=>ee.drawId===Te);ue&&(N[ye]={drawDefinition:ue,drawId:Te})}let oe={finishingPositionRange:le,containerStructureId:ye,finishingRound:Fe,stageSequence:be,roundPosition:Ne,collectionId:ce,roundNumber:me,structureId:Ee,schedule:Le,eventId:fe,drawId:Te,score:Q,stage:se};BH({...oe,...U,matchUpStatus:we,winningSide:Me,matchUpType:Pe,matchUpId:Be,sides:ge});for(let ue of pe){let{winningSide:ee,sides:Se=[],matchUpId:De,collectionPosition:it,collectionId:Ue,matchUpStatus:ut,matchUpType:yi}=ue;BH({...oe,...U,winningSide:ee,tieWinningSide:Me,matchUpTieId:Be,matchUpId:De,sides:Se,collectionId:Ue,collectionPosition:it,matchUpSides:ge,matchUpStatus:ut,matchUpType:yi})}Array.isArray(de)&&(ae||f||p)&&de.flat().map(vt).filter(Boolean)?.forEach(ue=>{S(ue)?.forEach(ee=>{l[ee]&&(l[ee].potentialMatchUps[Be]=Ve({tournamentId:n?.tournamentId,matchUpId:Be,eventId:fe,drawId:Te}))}),(f||p)&&l7({potential:!0,participantMap:l,participantId:ue,matchUpStatus:we,roundPosition:Ne,structureId:Ee,matchUpType:Pe,roundNumber:me,matchUpId:Be,schedule:Le,drawId:Te,score:Q})})}D.push(...te)}}let O={};if(d)for(let[k,F]of Object.entries(N)){let{drawDefinition:x,drawId:L}=F,$=x.structures?.find(j=>j.structureType===fn&&j.stage===xe&&j.stageSequence===1);if(!$?.structures)continue;let V=$.structures,_=V.length,B=V.reduce((j,K)=>j+(K.positionAssignments?.length||0),0),G=x.structures?.find(j=>j.stage===Ui);O[L]||(O[L]={});for(let j of V){let K=j.structureId,Y=M[K];if(!Y?.length)continue;let X=j.positionAssignments?.length,{subOrderMap:Z}=cL({positionAssignments:j.positionAssignments}),J=gh({matchUps:Y,subOrderMap:Z});if(J?.participantResults)for(let[ae,te]of Object.entries(J.participantResults)){let{groupOrder:ne,provisionalOrder:le}=te,de=ne||le;if(!de)continue;let pe;if(B===X&&de)pe=[de,de];else if(_>1&&de&&!G)pe=[1,_];else if(_>1&&de&&G){let ge=x.links?.find(Me=>Me.source.structureId===k)?.source?.finishingPositions;if(ge){let Me=ge.length*_;if(ge.includes(de))pe=[1,Me];else{let Pe=(X-de)*_;pe=[Me+1,B-Pe]}}}pe&&(O[L][ae]=pe)}}}if(h||d||f){let k=Object.values(l);for(let F of k){let{wins:x,losses:L,[Wt]:{wins:$,losses:V},[$t]:{wins:_,losses:B}}=F.counters,G=(j,K,Y)=>{let X=K+Y,Z=K,J=X&&Z/X;F.statistics[j]={denominator:X,numerator:Z,statValue:J,statCode:j}};if(h&&(G(zT,x,L),G(`${zT}.${Wt}`,$,V),G(`${zT}.${$t}`,_,B)),d){let j=(K=[])=>Math.abs(K[0]-K[1]);for(let K of Object.keys(F.draws)){let{orderedStructureIds:Y=[],flightNumber:X}=C[K]||{};if(F.structureParticipation&&Y.length){let Z,J=0,ae=Y.map(te=>{let ne=F.structureParticipation[te];if(!ne)return;Z||(Z=ne?.finishingPositionRange),j(Z)>j(ne?.finishingPositionRange)&&(Z=ne?.finishingPositionRange);let le=ne.stage!==We;return le&&(J+=1),Ve({...ne,participationOrder:le?J:void 0,flightNumber:X})}).filter(Boolean);if(F.draws[K]){let te=F.participant.participantId,ne=O[K]?.[te];ne&&(Z=ne),F.draws[K].finishingPositionRange=Z,F.draws[K].structureParticipation=ae}}}}if(f){let j=bt(f)?f.scheduledMinutesDifference:0,K=F.scheduleItems||[],Y=F.potentialMatchUps||{},X=K.reduce((J,ae)=>{let{scheduledDate:te,scheduledTime:ne}=ae;return J[te]||(J[te]=[]),ne&&J[te].push(ae),J},{});Object.values(X).forEach(J=>J.sort(k4));for(let J of K){let{typeChangeTimeAfterRecovery:ae,timeAfterRecovery:te,scheduledDate:ne,scheduledTime:le}=J,de=X[ne],pe=Pt(le);for(let ge of de){if(ge.matchUpId===J.matchUpId||Fr(ge.matchUpStatus)&&!ge.checkScoreHasValue)continue;let Me=J.matchUpType!==ge.matchUpType&&ae||te,Pe=J.drawId===ge.drawId,Be=Y[J.matchUpId]&&Y[ge.matchUpId],fe=Pt(ge.scheduledTime),Te=Math.abs(fe-pe),ce=fe>=pe;if((j&&!Number.isNaN(j)?Te<=j:ce&&Pt(ge.scheduledTime)<Pt(Me))&&!(Be&&Pe)&&ce){let ye=[J.matchUpId,ge.matchUpId].sort(AR).join("|");F.scheduleConflicts[ye]={priorScheduledMatchUpId:J.matchUpId,matchUpIdWithConflict:ge.matchUpId}}}}let Z=F.participant.participantId;Object.keys(F.scheduleConflicts).length&&T.push(Z),l[Z].scheduleConflicts=F.scheduleConflicts}}}return{participantIdsWithConflicts:T,eventsPublishStatuses:E,derivedEventInfo:R,derivedDrawInfo:C,mappedMatchUps:P,participantMap:l,matchUps:D}}function cS({participantFilters:t={},tournamentRecord:e,participants:i=[]}){if(!Object.keys(t).length)return i;let{accessorValues:r,drawEntryStatuses:n,positionedParticipants:a,eventEntryStatuses:s,participantRoles:o,participantRoleResponsibilities:l,participantTypes:u,participantIds:c,signInStatus:d,enableOrFiltering:p,eventIds:f,genders:m}=t,h=Ml(f)&&e?.events?.filter(y=>f?.includes(y.eventId))||e?.events||[],g=n&&Uve({drawEntryStatuses:n,tournamentEvents:h}),I=s&&Tve({eventEntryStatuses:s,tournamentEvents:h}),v=a!==void 0&&[!0,!1].includes(a)&&h.reduce((y,b)=>y.concat(...(b.drawDefinitions||[]).map(S=>Q5({drawDefinition:S}).allPositionedParticipantIds).filter(Boolean)),[]),w=y=>r?.reduce((b,S)=>{let{accessor:U,value:T}=S,{values:P}=mp({element:y,accessor:U});return b&&P?.includes(T)},!0);if(i=i?.filter(y=>{let b=vs({element:y,itemType:zw})?.timeItem?.itemValue,{participantRoleResponsibilities:S,participantType:U,participantRole:T,participantId:P,person:D}=y,E=Array.isArray(m)&&m?.length&&D?.sex&&m.includes(D.sex);return p?m&&E||a&&v.includes(P)||a===!1&&!v.includes(P)||g?.includes(P)||I?.includes(P)||c?.includes(P)||d&&b===d||u&&U&&Ml(u)&&u.includes(U)||o&&T&&Ml(o)&&o.includes(T)||l&&Ml(S)&&Ml(l)&&l.find(R=>S?.includes(R))||r?.length&&Ml(r)&&w(y):(!m||E)&&(a===void 0||a&&v.includes(P)||a===!1&&!v.includes(P))&&(!g||g.includes(P))&&(!I||I.includes(P))&&(!c||c.includes(P))&&(!d||b===d)&&(!u||U&&Ml(u)&&u.includes(U))&&(!o||T&&Ml(o)&&o.includes(T))&&(!l||Ml(S)&&Ml(l)&&l.find(R=>S?.includes(R)))&&(!r?.length||Ml(r)&&w(y))}),h.length&&f){let y=new Set(h.filter(b=>f.includes(b.eventId)).flatMap(b=>{let S=(b.entries||[]).map(T=>T.participantId);if(Di(nl)(b.eventType))return S;let U=(e?.participants??[]).filter(T=>S.includes(T.participantId)).flatMap(T=>T.individualParticipantIds);return S.concat(...U)}));i=i?.filter(b=>y.has(b.participantId))}return i}function Ml(t){return t&&Array.isArray(t)&&t.length}function Uve({drawEntryStatuses:t,tournamentEvents:e}){let i=({entryStatus:r})=>Array.isArray(t)?t.includes(r):!0;return rt(e.reduce((r,n)=>{let{flightProfile:a}=$i({event:n}),s=a?.flights?.flatMap(({drawEntries:l})=>Array.isArray(l)?l.filter(i).map(vt):[])||[],o=n.drawDefinitions?.map(({entries:l})=>l?l.filter(i).map(vt):[])||[];return r.concat(...s,...o)},[]))}function Tve({eventEntryStatuses:t,tournamentEvents:e}){return rt(e.reduce((i,r)=>{let n=(r.entries||[]).filter(({entryStatus:a})=>Array.isArray(t)?t.includes(a):!0).map(vt);return i.concat(...n)},[]))}function Ei(t){let{withIndividualParticipants:e,participantFilters:i={},withPotentialMatchUps:r,withRankingProfile:n,convertExtensions:a,policyDefinitions:s,withScheduleItems:o,tournamentRecord:l,scheduleAnalysis:u,withSignInStatus:c,withTeamMatchUps:d,withScaleValues:p,usePublishState:f,withStatistics:m,contextFilters:h,matchUpFilters:g,contextProfile:I,withOpponents:v,withMatchUps:w,internalUse:y,withSeeding:b,withEvents:S,withDraws:U,withISO2:T,withIOC:P}=t,D="getParticipants";if(!l)return z({stack:D,result:{error:Ie}});(w||n)&&oo({tournamentRecord:l});let E=pK({convertExtensions:a,tournamentRecord:l,withSignInStatus:c,withScaleValues:p,internalUse:y,withISO2:T,withIOC:P}),{participantMap:R}=E,C=Sve({withMatchUps:w??n,withEvents:S??n,withDraws:U??n,withPotentialMatchUps:r,participantFilters:i,withRankingProfile:n,convertExtensions:a,withScheduleItems:o,policyDefinitions:s,tournamentRecord:l,scheduleAnalysis:u,withTeamMatchUps:d,usePublishState:f,withStatistics:m,contextFilters:h,matchUpFilters:g,participantMap:R,withOpponents:v,contextProfile:I,withSeeding:b}),{participantIdsWithConflicts:M,eventsPublishStatuses:N,derivedEventInfo:A,derivedDrawInfo:O,mappedMatchUps:k}=C,F=C.matchUps;R=C.participantMap;let x=u??r,L=({potentialMatchUps:j,scheduleConflicts:K,scheduleItems:Y,participant:X,statistics:Z,opponents:J,matchUps:ae,events:te,draws:ne})=>{let le=Object.values(ne),de=Object.values(J);return v&&le?.forEach(pe=>{pe.opponents=de.filter(ge=>ge.drawId===pe.drawId)}),Ve({...X,scheduleConflicts:u?Object.values(K):void 0,draws:U||n?le:void 0,events:S||n?Object.values(te):void 0,matchUps:w||n?Object.values(ae):void 0,opponents:v?de:void 0,potentialMatchUps:x?Object.values(j):void 0,statistics:m?Object.values(Z):void 0,scheduleItems:o?Y:void 0},!1,!1,!0)},$=new Map;for(let j of Object.keys(R))$.set(j,L(R[j]));let V=[...$.values()],_=s?.[Bw]?.participant,B=cS({participants:V,participantFilters:i,tournamentRecord:l});if(e){let j=bt(e)?e:void 0;for(let K of B)for(let Y of K.individualParticipantIds??[]){K.individualParticipants??=[];let X=$.get(Y),Z=j?Em({template:j,source:X}):X;K.individualParticipants.push(Z)}}let G=_?B.map(j=>Em({source:j,template:_})):B;return{participantMap:t.returnParticipantMap!==!1?R:void 0,mappedMatchUps:t.returnMatchUps!==!1?k:void 0,matchUps:t.returnMatchUps!==!1?F:void 0,missingParticipantIds:E.missingParticipantIds,participantIdsWithConflicts:M,eventsPublishStatuses:N,derivedEventInfo:A,derivedDrawInfo:O,participants:G,...H}}function Nm(t){let{tournamentRecord:e,scaleAttributes:i,participantId:r}=t,n=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(!r)return{error:lr};let{participant:a,tournamentId:s}=$d({tournamentRecords:n,tournamentRecord:e,participantId:r});return a?{...Hl({participant:a,scaleAttributes:i}),tournamentId:s}:{error:Vi}}function Dve(t,e){let i=t.startDate||e?.startDate,r=t.endDate||e?.endDate;return!i||!r?{error:_me}:!Pn(i)||!Pn(r)?{error:sr}:{startDate:i,endDate:r}}function VH(t,e){let i=new Date(Qe(t)),r=new Date(Qe(e)),n=r.getFullYear()-i.getFullYear(),a=r.getMonth()-i.getMonth();return(a<0||a===0&&r.getDate()<i.getDate())&&n--,n}function jH(t,e,i){return!(e!==void 0&&t<e||i!==void 0&&t>i)}function Pve(t){return/^C\d{1,2}-\d{1,2}$/.test(t.ageCategoryCode||"")}function Eve(t,e,i,r){if(Pve(e))return{valid:!0};let n=e.ageMin,a=e.ageMax;if(e.ageCategoryCode&&!n&&!a){let d=Up({consideredDate:i,category:e});d.error||(n=d.ageMin,a=d.ageMax)}if(!n&&!a)return{valid:!0};let s=t.person?.birthDate;if(!s)return{valid:!1,reason:"Missing birthDate",details:{requiredMin:n,requiredMax:a}};let o=VH(s,i),l=VH(s,r),u=jH(o,n,a),c=jH(l,n,a);if(!u){let d=[n===void 0?null:`min: ${n}`,a===void 0?null:`max: ${a}`].filter(Boolean).join(", ");return{valid:!1,reason:`Age ${o} at event start (${i}) outside range [${d}]`,details:{birthDate:s,ageAtStart:o,ageAtEnd:l,requiredMin:n,requiredMax:a}}}if(!c){let d=[n===void 0?null:`min: ${n}`,a===void 0?null:`max: ${a}`].filter(Boolean).join(", ");return{valid:!1,reason:`Age ${l} at event end (${r}) outside range [${d}]`,details:{birthDate:s,ageAtStart:o,ageAtEnd:l,requiredMin:n,requiredMax:a}}}return{valid:!0}}function Rve(t,e,i,r){if(!e.ratingMin&&!e.ratingMax)return{valid:!0};if(!e.ratingType)return{valid:!0};let n={scaleType:"RATING",scaleName:e.ratingType,eventType:i.eventType},{scaleItem:a}=Nm({tournamentRecord:r,participantId:t.participantId,scaleAttributes:n});if(!a?.scaleValue)return{valid:!1,reason:`Missing ${e.ratingType} rating`,details:{ratingType:e.ratingType,requiredMin:e.ratingMin,requiredMax:e.ratingMax}};let s;if(typeof a.scaleValue=="object"){let o=mp({element:a.scaleValue,accessor:a.scaleValue?.accessor});if(o===void 0)return{valid:!1,reason:`Cannot extract rating value from ${e.ratingType} scale item`,details:{ratingType:e.ratingType,requiredMin:e.ratingMin,requiredMax:e.ratingMax}};s=o}else s=a.scaleValue;return e.ratingMin!==void 0&&s<e.ratingMin?{valid:!1,reason:`${e.ratingType} rating ${s} below minimum ${e.ratingMin}`,details:{ratingType:e.ratingType,ratingValue:s,requiredMin:e.ratingMin,requiredMax:e.ratingMax}}:e.ratingMax!==void 0&&s>e.ratingMax?{valid:!1,reason:`${e.ratingType} rating ${s} above maximum ${e.ratingMax}`,details:{ratingType:e.ratingType,ratingValue:s,requiredMin:e.ratingMin,requiredMax:e.ratingMax}}:{valid:!0}}function Cve(t){let e=t.person;if(!e)return"Unknown";let i=e.standardGivenName||e.passportGivenName,r=e.standardFamilyName||e.passportFamilyName;return[i,r].filter(Boolean).join(" ")||"Unknown"}function Mve(t,e,i,r,n,a){let s=Eve(t,e,r,n),o=Rve(t,e,i,a);if(!s.valid||!o.valid){let l={participantId:t.participantId,participantName:Cve(t),rejectionReasons:[]};return s.valid||l.rejectionReasons.push({type:"age",reason:s.reason,details:s.details||{}}),o.valid||l.rejectionReasons.push({type:"rating",reason:o.reason,details:o.details||{}}),l}return null}function im({participantId:t,drawDefinition:e,entryStatus:i,entryStage:r}){if(!e)return{error:_e};let n=e.entries?.find(a=>a.participantId===t&&(!i||i===a.entryStatus)&&(!r||r===a.entryStage));return t&&n}function Nve({relevantLinks:t,drawDefinition:e,provisionalPositioning:i,roundQualifiersCounts:r}){let n=0;for(let a of t){let s=et({structureId:a.source.structureId,drawDefinition:e})?.structure;if(s?.stage===We){let o=a.source.roundNumber,l=a.target.roundNumber,u;if(s.structureType===fn){let c=s.structures?.length??0,d=a.source.finishingPositions?.length??0;u=c*d}else u=Nt({matchUpFilters:{roundNumbers:[o]},structure:s,afterRecoveryTimes:!1,provisionalPositioning:i,inContext:!1}).matchUps?.length||0;r[l]||(r[l]=0),r[l]+=u,n+=u}}return n}function uv(t){let{provisionalPositioning:e,drawDefinition:i,stageSequence:r,structureId:n,stage:a}=t;if(!i)return{error:_e};let{entryProfile:s}=Kw({drawDefinition:i}),o=a&&r&&s?.[a]?.stageSequence?.[r]?.qualifiersCount||a&&s?.[a]?.qualifiersCount||0,l={};if(!n)return{qualifiersCount:o,roundQualifiersCounts:l};let{structure:u}=et({drawDefinition:i,structureId:n}),c=i.links?.filter(f=>f?.target?.structureId===u?.structureId),d=0;c?.length&&(d=Nve({relevantLinks:c,drawDefinition:i,provisionalPositioning:e,roundQualifiersCounts:l}));let p=Object.keys(l);if(p.length<=1){let f=p[0]||1;l[f]=Math.max(l[f]||0,o)}return d=Math.max(d,o),{qualifiersCount:d,roundQualifiersCounts:l}}function KD({stage:t,drawDefinition:e}){let{entryProfile:i}=Kw({drawDefinition:e});return i?.[t]?.drawSize||0}function Ave(t){let{provisionalPositioning:e,drawDefinition:i,stageSequence:r,stage:n}=t,a=KD({stage:n,drawDefinition:i}),{qualifiersCount:s}=uv({provisionalPositioning:e,drawDefinition:i,stageSequence:r,stage:n});return a&&a-s}function u7({stage:t,drawDefinition:e}){return!!(t===Pr||XF({stage:t,drawDefinition:e})&&KD({stage:t,drawDefinition:e}))}function c7({entryStatus:t=na,drawDefinition:e,stageSequence:i,stage:r}){if(t===Fs)return Jge({stage:r,drawDefinition:e})?{positionsAvailable:1/0,...H}:{error:H6};let n=Ave({drawDefinition:e,stageSequence:i,stage:r}),a=Qge({drawDefinition:e,stage:r}),s=lO({entryStatus:nI,drawDefinition:e,stage:r}),o=lO({entryStatus:na,drawDefinition:e,stage:r}),l=s+o,u=l>=n,c=n-l;return r!==Pr&&u?{error:Kk}:t===nI?s<a?{...H}:{error:Kk}:{positionsAvailable:c,...H}}function pL(t){let e=Ge(t,[{[mn]:!0,[R5]:!0}]);if(e.error)return e;let{suppressDuplicateEntries:i=!0,entryStatus:r=na,entryStageSequence:n,entryStage:a=xe,ignoreStageSpace:s,drawDefinition:o,entryPosition:l,participant:u,roundTarget:c,extensions:d,extension:p,drawType:f,event:m}=t,h="addDrawEntry";if(f!==ra&&!u7({stage:a,drawDefinition:o}))return z({result:{error:Zp},stack:h});let g=c7({stageSequence:n,stage:a,drawDefinition:o,entryStatus:r});if(!s&&!g.success&&(!f||f!==ra))return{error:g.error};if(p&&!sl({extension:p}))return z({result:{error:ie},info:"Invalid extension",context:{extension:p},stack:h});let I=t.participantId||u?.participantId;if(!I)return z({result:{error:lr},stack:h});let v=r===fc&&im({participantId:I,drawDefinition:o,entryStatus:r}),w=a===Pr&&im({participantId:I,drawDefinition:o,entryStage:a}),y=im({participantId:I,drawDefinition:o}),b=r!==fc&&a!==Pr&&y;if(b)return i?(at({payload:{drawId:o.drawId,eventId:m?.eventId,error:ob,participantId:I},topic:AF}),{...H}):z({result:{error:ob},context:{participantId:I},stack:h});if(v||w)return z({context:{invalidEntry:b,invalidLuckyLoser:v,invalidVoluntaryConsolation:w},result:{error:VE},stack:h});let S=Ve({entryStageSequence:n,participantId:I,entryPosition:l,entryStatus:r,entryStage:a,extensions:d});return p&&xt({element:S,extension:p}),c&&xt({extension:{name:"roundEntry",value:c},element:S}),o.entries??=[],o.entries.push(S),ti({drawDefinition:o}),{...H}}function kve(t){let e="addDrawEntries",{suppressDuplicateEntries:i=!0,entryStatus:r=na,autoEntryPositions:n=!0,ignoreStageSpace:a,participantIds:s,drawDefinition:o,stageSequence:l,stage:u=xe,roundTarget:c,extension:d,event:p}=t,f=o.drawType===ra;if(!u)return{error:I6};if(!o)return{error:_e};if(!Array.isArray(s))return{error:ga};if(!f&&!u7({stage:u,drawDefinition:o}))return{error:Zp};if(d&&!sl({extension:d}))return z({result:{error:ie},info:"Invalid extension",context:{extension:d},stack:e});let m=c7({drawDefinition:o,stageSequence:l,entryStatus:r,stage:u});if(!a&&!m.success&&!f)return{error:m.error};let h=m.positionsAvailable??0;if(!a&&!f&&u!==Pr&&h<s.length)return{error:_1};let g=[],I=o.drawId,v=p?.eventId,w=s.reduce((y,b)=>{let S=r===fc&&im({participantId:b,drawDefinition:o,entryStatus:r}),U=u===Pr&&im({entryStage:u,drawDefinition:o,participantId:b}),T=im({participantId:b,drawDefinition:o});return r!==fc&&u!==Pr&&T&&(g.push(b),i&&at({payload:{error:ob,participantId:b,eventId:v,drawId:I},topic:AF})),S||U?y.concat(b):y},[]);return g.length&&!i?z({context:{eventId:v,drawId:I,duplicateEntries:g},result:{error:ob},stack:e}):(s.filter(y=>y&&!w.includes(y)).forEach(y=>{let b={entryStageSequence:l,entryStage:u,participantId:y,entryStatus:r};d&&xt({element:b,extension:d}),c&&xt({extension:{name:Tl,value:c},element:b}),o.entries??=[],o.entries.push(b)}),n&&(o.entries=vo({entries:o.entries})),ti({drawDefinition:o}),w?.length||g?.length?{info:"some participantIds could not be added",participantIdsNotAdded:w,duplicateEntries:g,...H}:{...H})}function fL({suppressDuplicateEntries:t=!0,autoEntryPositions:e=!0,entryStageSequence:i,ignoreStageSpace:r,participantIds:n,drawDefinition:a,entryStatus:s,roundTarget:o,entryStage:l,extension:u,drawId:c,event:d}){if(!n?.length)return{error:Od};if(!d)return{error:os};if(!c)return{error:Oo};let p=(d.entries||[]).map(vt);if(n.filter(h=>!p.includes(h)).length)return{error:h6};if(a){let h=kve({stageSequence:i,suppressDuplicateEntries:t,autoEntryPositions:e,stage:l,ignoreStageSpace:r,participantIds:n,drawDefinition:a,entryStatus:s,roundTarget:o,extension:u});if(h.error)return h}let{flightProfile:f}=$i({event:d}),m=f?.flights.find(h=>h.drawId===c);return m?.drawEntries&&(n.forEach(h=>{let g=s===fc&&PA({participantId:h,entryStatus:s,flight:m}),I=l===Pr&&PA({participantId:h,entryStage:l,flight:m});!(s!==fc&&l!==Pr&&PA({flight:m,participantId:h}))&&!g&&!I&&m.drawEntries.push({participantId:h,entryStatus:s,entryStage:l})}),e&&(m.drawEntries=vo({entries:m.drawEntries}))),{...H}}function PA({participantId:t,entryStatus:e,entryStage:i,flight:r}){let n=r.drawEntries?.find(a=>a.participantId===t&&(!e||e===a.entryStatus)&&(!i||i===a.entryStage));return t&&n}function dS({autoEntryPositions:t=!0,participantIds:e=[],entryStatuses:i,stage:r,event:n}){let a="removeEventEntries";if(!n?.eventId)return{error:li};if(!Array.isArray(e)||e.some(d=>!ri(d)))return z({result:{error:To},stack:a});let s=(n.drawDefinitions??[]).flatMap(d=>cf({drawDefinition:d}).assignedParticipantIds??[]),o=(i?.length&&n.entries?.filter(d=>d.entryStatus&&i.includes(d.entryStatus))||[]).map(vt).filter(d=>!s.includes(d)),l=(r&&n.entries?.filter(d=>d.entryStage&&d.entryStage===r)||[]).map(vt).filter(d=>!s.includes(d));if(e.length?e=e.filter(d=>(!i?.length||o.includes(d))&&(!r||l.includes(d))):o.length&&l.length?e=xi(o,l):o.length?e=o:l.length&&(e=l),e?.length&&s.some(d=>e.includes(d)))return z({result:{error:JI},stack:a});if(!e?.length)return{...H,participantIdsRemoved:[]};let u=[];n.entries=(n.entries??[]).filter(d=>{let p=!e.includes(d?.participantId);return p||u.push(d.participantId),p}),t&&(n.entries=vo({entries:n.entries}));let{flightProfile:c}=$i({event:n});return c?.flights?.forEach(d=>{d.drawEntries=(d.drawEntries||[]).filter(p=>!e.includes(p.participantId))}),n.drawDefinitions?.forEach(d=>{d.entries=(d.entries??[]).filter(p=>!e.includes(p.participantId))}),{...H,participantIdsRemoved:u}}var d7={[Er]:{policyName:"matchUpActionsDefault",enabledStructures:[{stages:[],stageSequences:[],enabledActions:[],disabledActions:[]}],participants:{enforceCategory:!0,enforceGender:!0},processCodes:{substitution:["RANKING.IGNORE","RATING.IGNORE"]},substituteAfterCompleted:!1,substituteWithoutScore:!1}},cv=d7;function Ove(t,e,i,r){return e.gender&&i&&!(Na(e.gender)||eu(e.gender))&&on(e.gender)!==on(t.person?.sex)?(r.push({participantId:t.participantId,sex:t.person?.sex}),!1):!0}function xve({participantIds:t,typedParticipantIds:e,checkTypedParticipants:i}){return t.filter(r=>!i||e.includes(r))}function Fve({tournamentRecord:t,participantIds:e,event:i,entryStatus:r,genderEnforced:n,mismatchedGender:a}){function s(c,d,p){return Di(Wt)(d.eventType)&&c.participantType===gt&&!lp(p)}function o(c,d,p){return d.eventType===$t&&c.participantType===pt&&!lp(p)}function l(c,d,p,f,m){return d.eventType===$t&&c.participantType===gt&&lp(p)?d.gender&&f&&!(Na(d.gender)||eu(d.gender))&&on(d.gender)!==on(c.person?.sex)?(m.push({participantId:c.participantId,sex:c.person?.sex}),!1):!0:!1}function u(c,d,p){return d.eventType===Lt&&(c.participantType===Lt||lp(p)&&c.participantType===gt)}return t?.participants?.filter(c=>e.includes(c.participantId)?s(c,i,r)&&(!i.gender||!n||Na(i.gender)||eu(i.gender)||on(i.gender)===on(c.person?.sex))||o(c,i,r)||l(c,i,r,n,a)?!0:s(c,i,r)&&!Ove(c,i,n,a)?!1:u(c,i,r):!1).map(c=>c.participantId)??[]}function Lve({typedParticipantIds:t,categoryRejections:e,tournamentRecord:i,startDate:r,endDate:n,event:a}){let s=[];for(let o of t){let l=i.participants?.find(u=>u.participantId===o);if(l)if(a.category){let u=Mve(l,a.category,a,r,n,i);u?e.push(u):s.push(o)}else s.push(o)}return s}function _ve({enforceCategory:t,event:e,tournamentRecord:i,typedParticipantIds:r,categoryRejections:n}){if(t&&e.category&&i){let a=Dve(e,i);if(!("error"in a)){let{startDate:s,endDate:o}=a;return Lve({typedParticipantIds:r,tournamentRecord:i,event:e,startDate:s,endDate:o,categoryRejections:n})}}return r}function $ve({validParticipantIds:t,existingIds:e,entryStatus:i,entryStage:r,extensions:n,extension:a,roundTarget:s,entryStageSequence:o,addedParticipantIdEntries:l,event:u}){t.forEach(c=>{if(!e.has(c)){let d=Ve({participantId:c,entryStatus:i,entryStage:r,extensions:n});a&&xt({element:d,extension:a}),s&&xt({extension:{name:Tl,value:s},element:d}),o&&(d.entryStageSequence=o),l.push(d.participantId),u.entries?.push(d)}})}function Bve({tournamentRecord:t,removedEntries:e,event:i}){if(i.eventType&&[oc,ya].includes(i.eventType)){let r=new Set((i.entries||[]).map(l=>l.participantId)),n=(i.entries||[]).filter(l=>lp(l.entryStatus)).map(l=>l.participantId),a=t?.participants??[],s=new Set(a.filter(l=>r.has(l.participantId)&&l.participantType&&[pt,Lt].includes(l.participantType)).map(l=>l.individualParticipantIds).flat(1/0)),o=n.filter(l=>s.has(l));o.length&&(e.push(...o),dS({participantIds:o,autoEntryPositions:!1,event:i}))}}function Vve(t,e){if(!Array.isArray(t.participantIds))return z({result:{error:ga},stack:e});let i=rt(t.participantIds??[]);return t.event?i?.length?t.event?.eventId?{participantIds:i}:{error:os}:z({result:{error:Od},stack:e}):{error:li}}function jve({policyDefinitions:t,tournamentRecord:e,event:i,enforceGender:r}){let n=Tt({tournamentRecord:e,event:i}).appliedPolicies??{},a=t?.[Er]??n?.[Er]??cv[Er],s=(r??a?.participants?.enforceGender)!==!1;return{matchUpActionsPolicy:a,genderEnforced:s}}function Gve(t,e,i){return t&&(!Array.isArray(t)||!t.every(r=>sl({extension:r})))||e&&!sl({extension:e})?z({context:Ve({extension:e,extensions:t}),result:{error:ie},info:"Invalid extension(s)",stack:i}):null}function Ko(t){let{suppressDuplicateEntries:e=!0,entryStatus:i=na,autoEntryPositions:r=!0,enforceCategory:n=!1,enforceGender:a=!0,entryStageSequence:s,policyDefinitions:o,entryStage:l=xe,tournamentRecord:u,ignoreStageSpace:c,drawDefinition:d,roundTarget:p,extensions:f,extension:m,drawId:h,event:g}=t,I="addEventEntries",v=Vve(t,I);if("error"in v)return v;let w="participantIds"in v?v.participantIds:[],y=Gve(f,m,I);if(y)return y;let{genderEnforced:b}=jve({policyDefinitions:o,tournamentRecord:u,event:g,enforceGender:a}),S=[],U=[],T=!!u,P=[],D,E=Fve({tournamentRecord:u,participantIds:w,event:g,entryStatus:i,genderEnforced:b,mismatchedGender:P}),R=[];E=_ve({enforceCategory:n,event:g,tournamentRecord:u,typedParticipantIds:E,categoryRejections:R});let C=xve({participantIds:w,typedParticipantIds:E,checkTypedParticipants:T});g.entries??=[];let M=new Set(g.entries.map(O=>O.participantId||O.participant?.participantId));if($ve({validParticipantIds:C,existingIds:M,entryStatus:i,entryStage:l,extensions:f,extension:m,roundTarget:p,entryStageSequence:s,addedParticipantIdEntries:S,event:g}),h&&!lp(l)){let O=fL({participantIds:C,suppressDuplicateEntries:e,autoEntryPositions:r,entryStageSequence:s,ignoreStageSpace:c,drawDefinition:d,entryStatus:i,roundTarget:p,entryStage:l,extension:m,drawId:h,event:g});O.error&&(D=O.error)}if(Bve({event:g,tournamentRecord:u,removedEntries:U}),C.length!==w.length)return z({context:Ve({categoryRejections:R.length?R:void 0,mismatchedGender:P.length?P:void 0,gender:g.gender}),result:{error:ga},stack:I});r&&(g.entries=vo({entries:g.entries||[]}));let N=S.length,A=U.length;return z({result:{...H,addedEntriesCount:N,removedEntriesCount:A,...R.length&&{context:Ve({categoryRejections:R})}},stack:I,info:D})}var p7="ADMINISTRATION",Hve="CAPTAIN",Wve="COACH",Kr="COMPETITOR",zve="DIRECTOR",qve="HOSPITALITY",f7="MEDIA",m7="MEDICAL",mL="OFFICIAL",h7="OTHER",g7="SECURITY",Yve="STRINGER",Kve="SUPERVISOR",Xve="TRANSPORT",Jve="VOLUNTEER",hL={ADMINISTRATION:p7,CAPTAIN:Hve,COACH:Wve,COMPETITOR:Kr,DIRECTOR:zve,HOSPITALITY:qve,MEDIA:f7,MEDICAL:m7,OFFICIAL:mL,OTHER:h7,SECURITY:g7,STRINGER:Yve,SUPERVISOR:Kve,TRANSPORT:Xve,VOLUNTEER:Jve};function gL({addIndividualParticipantsToEvents:t,individualParticipantIds:e,groupingParticipantId:i,tournamentRecord:r,suppressErrors:n}){let a="removeIndividualParticipantIds";if(!r)return z({result:{error:Ie},stack:a});if(!i||!e)return z({result:{error:Xe},stack:a});let s=(r.participants??[]).find(c=>c.participantId===i);if(!s)return z({result:{error:Vi},stack:a});if(![Lt,ja].includes(s.participantType))return z({result:{participantType:s.participantType,error:Do},stack:a});let o=I7({individualParticipantIds:e,groupingParticipant:s,tournamentRecord:r,suppressErrors:n}),{removed:l,error:u}=o;if(u)return z({result:o,stack:a});if(t)for(let c of r.events??[]){let d=(c.entries??[]).map(({participantId:p})=>p).filter(Boolean);if(d.includes(i)){let p=l?.filter(f=>!d.includes(f));Ko({participantIds:p,entryStatus:ys,tournamentRecord:r,event:c})}}return l&&at({topic:en,payload:{tournamentId:r.tournamentId,participants:[s]}}),{...H,...o}}function I7({individualParticipantIds:t=[],groupingParticipant:e,tournamentRecord:i,suppressErrors:r,mappedMatchUps:n,participants:a}){let s=[];if(!e)return{removed:s};let o=[],l=[];a||({participants:a,mappedMatchUps:n}=Ei({withMatchUps:!0,tournamentRecord:i,withEvents:!0}));let u=a?.find(({participantId:p})=>p===e.participantId)?.events?.map(({eventId:p})=>p),c=(e.individualParticipantIds??[]).filter(p=>{let f=t?.includes(p),m=f&&a?.find(g=>g.participantId===p)?.matchUps.filter(({eventId:g})=>u.includes(g)).map(({matchUpId:g})=>n?.[g]).filter(({winningSide:g,score:I})=>g||cr({score:I})),h=f&&!m?.length;if(f&&!h&&l.push(p),h){s.push(p);for(let g of i.events??[])for(let I of g.drawDefinitions??[]){let{extension:v}=mt({element:I,name:uc}),w=v?.value[e.participantId];v&&w&&(v.value[e.participantId]=w.filter(b=>b.participantId!==p),xt({element:I,extension:v}),Hw({drawDefinition:I}));let y=Rn({drawDefinition:I,inContext:!1}).matchUps??[];for(let b of y){let S=b.sides??[];for(let U of S){let T=U.lineUp??[];T.find(P=>P.participantId===p)&&(U.lineUp=T.filter(P=>P.participantId!==p),St({tournamentId:i?.tournamentId,drawDefinition:I,matchUp:b}))}}}}else o.push(p);return!h});e.individualParticipantIds=c;let d={groupingParticipantId:e.participantId,cannotRemove:l,notRemoved:o,removed:s};return l.length&&!r&&{...d,cannotRemove:l,error:$E}||d}function kR({participantRole:t=Kr,individualParticipantIds:e=[],groupingTypes:i=[_n,ja],tournamentRecord:r}){if(!r)return{error:Ie};let n=r.participants??[],{participants:a,mappedMatchUps:s}=Ei({withMatchUps:!0,tournamentRecord:r,withEvents:!0}),o=0;return n.filter(l=>(l.participantRole===t||!l.participantRole)&&l.participantType&&i.includes(l.participantType)).forEach(l=>{let{removed:u}=I7({groupingParticipant:l,individualParticipantIds:e,tournamentRecord:r,mappedMatchUps:s,participants:a});u&&o++}),o?H:{error:$6}}function vh(t){let e=Ge(t,[{[mr]:!0},{participantIds:!0,[zn]:an,[xs]:Od}]);if(e.error)return e;let{addIndividualParticipantsToEvents:i,tournamentRecord:r,participantIds:n}=t,a=r.participants?.length||0;if(!a)return{...H};let s=(r.events||[])?.filter(({eventType:m})=>m===rr).map(m=>m?.drawDefinitions?.map(({drawId:h})=>h)).flat(1/0),o=Ei({participantFilters:{participantIds:n},tournamentRecord:r,withDraws:!0}).participants??[],l=m=>{let h=(br({matchUpFilters:{drawIds:m,matchUpTypes:[$t]},tournamentRecord:r}).matchUps??[]).flatMap(({sides:g})=>g?.map(({participantId:I})=>I||[])).filter(Boolean);return xi(h,n)},u=s?.length?l(s):[],c=o.filter(m=>m.draws?.filter(h=>(!s?.length||!s?.includes(h.drawId))&&h.positionAssignments).length);if(u?.length||c.length)return{error:JI};let d={},p={};for(let m of r.events||[]){let h=dS({participantIds:n,event:m});if(h.error)return h;d[m.eventId]=h.participantIdsRemoved}r.participants=(r.participants??[]).filter(m=>{let h=n.includes(m.participantId)||m.participantType===pt&&m.individualParticipantIds?.some(g=>n.includes(g));if(!h&&m.participantType===rr&&m.individualParticipantIds?.some(g=>n.includes(g))&&(m.individualParticipantIds=m.individualParticipantIds.filter(g=>!n.includes(g))),h&&i&&m.participantType&&[pt,Lt].includes(m.participantType))for(let g of m.individualParticipantIds||[])n.includes(g)||(p[m.participantId]||(p[m.participantId]=[]),p[m.participantId].push(g));return!h});let f=a-r.participants.length;if(kR({individualParticipantIds:n,tournamentRecord:r}),i)for(let m of r.events||[]){let h=d[m.eventId].map(g=>p[g]||[]).flat();Ko({participantIds:h,entryStatus:ys,tournamentRecord:r,event:m})}return f&&at({payload:{participantIds:n,tournamentId:r.tournamentId},topic:kF}),f?{...H,participantsRemovedCount:f}:{error:$E}}function v7({selected:t=!0,drawDefinition:e,entryStatuses:i,drawId:r,event:n,stage:a}){let s=n.entries??[];if(r){let{flightProfile:l}=$i({event:n}),u=l?.flights?.find(c=>c.drawId===r);u?s=u.drawEntries:e.entries&&(s=e?.entries)}let o=s.filter(l=>(!i?.length||!l.entryStatus||i.includes(l.entryStatus))&&(!a||!l.entryStage||l.entryStage===a)&&(!t||l.entryStatus&&so.includes(l.entryStatus)));return{entries:s,stageEntries:o}}function y7({removeGroupParticipant:t,tournamentRecord:e,drawDefinition:i,participantId:r,drawId:n,stage:a,event:s}){let o="destroyGroupEntry";if(!e)return{error:Ie};if(!r)return z({result:{error:lr},stack:o});if(!s)return{error:li};if(!s.eventType||![oc,ya].includes(s.eventType))return z({result:{error:Zl},stack:o});let l=e.participants??[],u=l.find(I=>I.participantId===r);if(!u)return z({result:{error:Vi},stack:o});if(!u.participantType||![pt,_n].includes(u.participantType)||u.participantType===_n&&s.eventType!==ya||u.participantType===pt&&s.eventType!==oc)return{error:Do};let c=(s.entries??[]).find(I=>I.participantId===r);if(!c)return{error:G6};let{stageEntries:d}=v7({selected:!1,drawDefinition:i,drawId:n,event:s,stage:a}),p=d.map(vt),f=l.filter(({participantId:I})=>p.includes(I)).map(({individualParticipantIds:I})=>I).flat().filter(Boolean),m=u.individualParticipantIds?.filter(I=>qo(I,f).length===1),h=dS({participantIds:[r],event:s});if(h.error||m?.length&&(h=Ko({participantIds:m,entryStatus:ys,entryStage:c.entryStage,tournamentRecord:e,drawDefinition:i,drawId:n,event:s}),h.error))return h;let g;return t&&vh({participantIds:[r],tournamentRecord:e}).success&&(g=!0),{...H,participantRemoved:g}}function IL({removeGroupParticipant:t,tournamentRecord:e,drawDefinition:i,participantId:r,drawId:n,event:a}){return y7({removeGroupParticipant:t,tournamentRecord:e,drawDefinition:i,participantId:r,drawId:n,event:a})}function b7(t){if(!t.tournamentRecord)return{error:Ie};let{participantIds:e,...i}=t,r=0,n=[];for(let a of e){let s=y7({participantId:a,...i});s.success&&(r+=1),s.error&&n.push(s.error)}return r?{destroyedCount:r,...H}:{error:n}}function Db(t){let{tournamentRecord:e,replaceWithBye:i,drawDefinition:r,destroyPair:n,entryStatus:a,matchUpsMap:s,drawId:o}=t,l="removeDrawPositionAssignment",u=oS(t);if(u.error)return z({result:u,stack:l});let{participantId:c}=u,{drawPosition:d,event:p,structureId:f}=t,m=Tt({tournamentRecord:e,drawDefinition:r,event:p}).appliedPolicies??{};if([Fs,mc].includes(a)&&c){let{tournamentRecord:g}=t,{participant:I}=$d({tournamentRecord:g,participantId:c}),{participantType:v,individualParticipantIds:w}=I??{};if(n&&v===pt){let y=IL({tournamentRecord:g,drawDefinition:r,participantId:c,event:p});if(y.error)return z({result:y,stack:l});w&&YD({participantIds:w,tournamentRecord:g,drawDefinition:r,entryStatus:a,drawId:o,event:p})}else YD({participantIds:[c],tournamentRecord:g,drawDefinition:r,entryStatus:a,drawId:o,event:p})}if(i){let g=Wa({tournamentRecord:e,drawDefinition:r,drawPosition:d,structureId:f,matchUpsMap:s,event:p});if(g.error)return z({result:g,stack:l})}let{structure:h}=et({drawDefinition:r,structureId:f});return HF({structure:h,drawPositions:[d]}),Ww({appliedPolicies:m,drawDefinition:r,positionAction:{name:"removeDrawPositionAssignment",replaceWithBye:i,drawPosition:d,entryStatus:a,structureId:f}}),u}function w7(t){return Object.assign(t,{entryStatus:mc}),Db(t)}var od=({finishingPosition:t=oh,hasExistingDrawDefinition:e,qualifyingRoundNumber:i,structureAbbreviation:r,seedAssignments:n=[],stageSequence:a=1,qualifyingOnly:s,structureOrder:o,seedingProfile:l,matchUpFormat:u,structureType:c,structureName:d,matchUps:p=[],matchUpType:f,structureId:m,roundOffset:h,roundLimit:g,stageOrder:I,structures:v,tieFormat:w,stage:y})=>{let b={structureId:m??Et(),structureAbbreviation:r,finishingPosition:t,seedAssignments:n,matchUpFormat:u,stageSequence:a,structureName:d};(s||e&&w)&&(b.tieFormat=w),o&&(b.structureOrder=o),c&&(b.structureType=c),l&&(typeof l=="string"?b.seedingProfile=l:typeof l=="object"&&typeof l.positioning=="string"&&(b.seedingProfile=l.positioning)),f&&(b.matchUpType=f),h&&(b.roundOffset=h),I&&(b.stageOrder=I),g&&(b.roundLimit=g),y&&(b.stage=y),i&&(b.qualifyingRoundNumber=i);let S=p.flatMap(({drawPositions:U})=>U).filter(Boolean);return v?b.structures=v:(b.matchUps=p,b.positionAssignments=rt(S).sort((U,T)=>U-T).map(U=>({drawPosition:U}))),b},ns=od;function mO(t){return ri(t)?t.split(" ").map(e=>e.split("").map((i,r)=>r?i.toLowerCase():i.toUpperCase()).join("")).join(" "):t}function Xr(t){return ri(t)?mO(t.replace(/_/g," ")):""}function vL({structureName:t=Xr(Pr),structureAbbreviation:e,drawDefinition:i,matchUpType:r,structureId:n}){if(!i)return{error:_e};let a=ns({stage:Pr,structureAbbreviation:e,structureName:t,matchUps:[],structureId:n,matchUpType:r});return i.structures||(i.structures=[]),i.structures.push(a),ti({drawDefinition:i,structureIds:[a.structureId]}),{...H}}function Qve({size:t}){let e=[t],i=t;for(;i/2===Math.floor(i/2);)i=i/2,e.push(i);return e.includes(1)||e.push(1),e.sort(ir),e.reverse(),e}function Zve({blockPattern:t,index:e}){let i=0;for(let r of t){if(i===e)return r;let n=0;for(;n<r.length;){if(i===e)return r;i+=1,n++}}}function eye({positioning:t,size:e}){let i=Qve({size:e}),r=[],n=[],a=p=>p[0],s=p=>p[p.length-1],o=(p,f)=>(t&&[eR,tR,Tp].includes(t)&&f%2?s(p):a(p))||a(p),l=(p,f)=>{if(p.every(m=>!n.includes(m))){let m=o(p,f);return n.push(m),m}},u=p=>{let f=p.filter(m=>!n.includes(m));if(f.length)return n.push(...f),f},c=(p,f)=>{let m=o(p,f);if(!n.includes(m))return n.push(m),m},d=Re(1,e+1);for(let p of i)if(p===1){let f=yr(d,2),m=f.map(l).filter(Boolean);m.length&&r.push(m);let h=f.flatMap(u).filter(Boolean);h.length&&r.push(h)}else{let f=yr(d,p).map(c).filter(Boolean);f.length&&r.push(f)}return{divisions:i,divisionGroupings:r}}function yL({drawPositions:t}){if(!t?.length)return{error:Dw};let e=n=>t.filter(a=>a!==n).map(a=>[n,a]),i=[].concat(...(t??[]).map(e)),r=rt(i.map(OR)).map(n=>n.split("|").map(a=>+a));return{groupMatchUps:i,uniqueMatchUpGroupings:r}}function OR(t=[]){return!Array.isArray(t)||!t.length?"":[...t].sort(ir).join("|")}function S7({groupSize:t,drawPositionOffset:e}){if(!t)return[];let i=d=>[...Array(d)].map((p,f)=>f),r=i(2*Math.round(t/2)+1).slice(1),n=i(r.length-1).map(()=>[]),a=r.slice(0,r.length/2),s=r.slice(r.length/2);r.slice(1).forEach((d,p)=>{a.forEach((g,I)=>{n[p].push([a[I],s[I]])});let f=a.shift(),m=a.pop(),h=s.shift();a=[f,h,...a].filter(Boolean),s=[...s,m].filter(Boolean)});let o=a.shift(),l=a.pop(),u=s.shift();a=[o,u,...a].filter(Boolean),s=[...s,l].filter(Boolean);let c=d=>d[0].reduce((p,f)=>p+f);return[...n].reverse().sort((d,p)=>c(d)-c(p)).map(d=>d.filter(p=>p.every(f=>f<=t)).map(p=>{let f=p.map(m=>m+e);return OR(f)}))}function tye({rounds:t,hash:e}){return t?.length?t?.reduce((i,r,n)=>r.includes(e)?n+1:i,void 0):{error:Xe}}var iye={getRoundRobinGroupMatchUps:yL,determineRoundNumber:tye,drawPositionsHash:OR,groupRounds:S7};function pS(t){let{hasExistingDrawDefinition:e,groupNameBase:i="Group",playoffAttributes:r,stageSequence:n=1,structureOptions:a,appliedPolicies:s,qualifyingOnly:o,seedingProfile:l,stage:u=xe,matchUpType:c,roundTarget:d,structureId:p,groupNames:f,tieFormat:m,drawSize:h,idPrefix:g,isMock:I,uuids:v}=t,w=t.structureName??r?.["0"]?.name??Xr(xe),{groupCount:y,groupSize:b}=rye({structureOptions:a,appliedPolicies:s,drawSize:h}),S=Pp,U,T=Re(1,y+1).map(D=>{let E=nye({groupSize:b,structureOrder:D,matchUpType:c,drawSize:h,idPrefix:g,isMock:I});U=Array.isArray(E)?Math.max(...E.map(({roundNumber:C})=>C??0)):0;let R=f?.[D-1]??`${i} ${D}`;return od({structureId:v?.pop(),hasExistingDrawDefinition:e,structureType:iR,finishingPosition:S,qualifyingOnly:o,structureOrder:D,structureName:R,tieFormat:m,matchUps:E})}),P=od({structureId:p??v?.pop(),hasExistingDrawDefinition:e,structureType:fn,finishingPosition:S,seedingProfile:l,structureName:w,stageSequence:n,structures:T,tieFormat:m,stage:u});return d&&xt({extension:{name:Tl,value:d},element:P}),{structures:[P],maxRoundNumber:U,groupCount:y,links:[],groupSize:b,...H}}function rye({appliedPolicies:t,structureOptions:e,drawSize:i}){let r=e?.groupSize,n=e?.groupSizeLimit||8,{validGroupSizes:a}=fS({groupSizeLimit:n,drawSize:i}),s=a&&Math.max(...a);r&&a?.includes(r)||(r&&r>4||!a?.includes(4)?r=s:r=4);let o=Math.ceil(i/r);return{groupSize:r,groupCount:o}}function fS(t){let{groupSizeLimit:e=10,drawSize:i=0}=t??{},r=Re(3,e+1).filter(n=>{let a=Math.ceil(i/n),s=a*n-i,o=Math.ceil(i/a),l=Math.ceil(s/a);return(!s||s<n)&&o===n&&o>=3&&l<2});return{...H,validGroupSizes:r}}function nye({structureOrder:t,matchUpType:e,groupSize:i,drawSize:r,idPrefix:n,isMock:a,uuids:s}){let o=(t-1)*i,l=Re(1+o,i+1+o),u=yL({drawPositions:l}).uniqueMatchUpGroupings??[],c=S7({groupSize:i,drawPositionOffset:o});return u.map(p).sort((f,m)=>(f.roundNumber??1/0)-(m.roundNumber??1/0));function d(f){return c.reduce((m,h,g)=>h.includes(f)?g+1:m,void 0)}function p(f){let m=OR(f),h=d(m),g=[1,r],I=aye({structureOrder:t,drawPositions:f,roundNumber:h,idPrefix:n,uuids:s}),v={matchUpStatus:h?Fi:"BYE",matchUpType:e,finishingPositionRange:{winner:g,loser:g},drawPositions:f,roundNumber:h,matchUpId:I};return a&&(v.isMock=!0),v}}function aye({structureOrder:t,drawPositions:e,roundNumber:i,idPrefix:r,uuids:n}){return r?`${r}-${t}-${i}-DP-${e.join("-")}`:n?.pop()||Et()}function bL(t){let{roundRobinGroupsCount:e,participantsCount:i,cluster:r}=t;if(!ot(i))return{seedBlocks:void 0,...z({result:{error:ie},context:{participantsCount:i},stack:"getSeedBlocks"})};let n=qI(i);if(e){let f=Math.min(e,n),m=[],h=1;for(Re(0,f).forEach(()=>{m.push([h]),h++});h<n;){let g=Re(h,h+f);h+=f,m.push(g)}return{...H,seedBlocks:m}}let a=Re(1,n+1),s=[],o=n/2;for(;o>1;){let f=yr(a,o),m=f.length;f.forEach((h,g)=>{let I,v=g<m/2,w=g%2===0,y=h[0],b=h[h.length-1];r&&m>4?m===8?I=v?b:y:I=w?y:b:I=v?y:b,kn(h,s)||s.push(I)}),o=o/2}let l=a.filter(f=>!s.includes(f));for(;l.length;)l.length%2===0?s.push(l.pop()):s.push(l.shift());let u=Re(0,20).map(f=>Math.pow(2,f));u.unshift(1);let c=u.indexOf(n),d=0,p=[];return Re(0,c).forEach(f=>{p.push(s.slice(d,d+u[f])),d+=u[f]}),{...H,seedBlocks:p}}function wL({roundRobinGroupsCount:t,drawSize:e}){let i="getSeedGroups";if(!ot(e))return{seedGroups:void 0,...z({result:{error:ie},context:{drawSize:e},stack:i})};if(t){if(!ot(t))return{seedGroups:void 0,...z({context:{roundRobinGroupsCount:t},result:{error:ie},stack:i})};let r=1,n=Math.floor(e/t);return{seedGroups:Re(0,n).map(()=>{let a=Re(r,r+t);return r+=t,a})}}else{let{seedBlocks:r}=bL({participantsCount:e,roundRobinGroupsCount:t}),n=0;return{seedGroups:(r||[]).map(a=>(a||[]).map(()=>(n+=1,n)))}}}function SL({roundRobinGroupsCount:t,participantsCount:e}){if(t){let{validGroupSizes:n}=fS({drawSize:e});if(!n?.map(a=>Math.ceil(e/a))?.includes(t))return z({context:{roundRobinGroupsCount:t},result:{error:ie}})}let{seedGroups:i}=wL({drawSize:e,roundRobinGroupsCount:t}),r=i?.map(n=>Math.min(...n))||[];return{...H,seedingThresholds:r}}function sI(t){if(!t)return 1/0;if(ot(t))return Ye(t);let e=t.split("-")[0];return ot(e)?Ye(e):1/0}function yh({provisionalPositioning:t,returnAllProxies:e,appliedPolicies:i,seedingProfile:r,drawDefinition:n,allPositions:a,structure:s}){let o=[];if(!s)return{error:Qp};let{matchUps:l,roundMatchUps:u}=Nt({matchUpFilters:{roundNumbers:[1]},provisionalPositioning:t,structure:s}),{seedAssignments:c}=ds({provisionalPositioning:t,returnAllProxies:e,drawDefinition:n,structure:s}),{positionAssignments:d}=ur({structure:s}),p=d?.length,f=c?.length??0,m=[],h=Object.keys(u).map(A=>Number.parseInt(A)).sort((A,O)=>A-O).map(A=>{let O=u[A].map(F=>F.drawPositions).flat(1/0).filter(Boolean),k=O.filter(F=>!m.includes(F));return m=m.concat(...O),k}).filter(A=>A.length).reverse(),g=h.pop()??[],I=g&&Math.min(...g)-1||0;r=r??i?.seeding?.seedingProfile;let v=g?.length||0,w=h.filter(A=>A.filter(O=>O<=f).length),{stage:y,structureType:b,roundLimit:S}=s,U=b===fn,T=!U&&h?.length,P=!U&&y===We&&S,D=w.flat(1/0),E=T?D?.length:0,R=a?p:f,C=JF({drawDefinition:n,structure:s,matchUps:l}),M=C?0:!T&&R||R&&D.length<R&&R-D.length||0;if(P){let A=s?.matchUps?s.matchUps.filter(({roundNumber:k})=>k===s.roundLimit).length:0,O=g.length/A;if(!T){let k=mS(r),F=yr(g,O),x=1,L=Re(0,F[0].length).map(()=>{let $=Re(x,x+F.length);return x+=F.length,$});({validSeedBlocks:o}=U7({drawPositionBlocks:F,nonRandom:r?.nonRandom,positioning:k,seedGroups:L}))}}else U?{validSeedBlocks:o}=sye({nonRandom:r?.nonRandom,seedingProfile:r,structure:s}):T?o=w.map(A=>({seedNumbers:A,drawPositions:A})):C&&yr(g,2).map((A,O)=>({drawPositions:[A[0]],seedNumbers:[O+1]})).forEach(A=>o.push(A));if(!U&&!C&&!P){let{blocks:A}=oye({drawPositionOffset:I,seedNumberOffset:E,seedCountGoal:M,seedingProfile:r,baseDrawSize:v});A.forEach(O=>o.push(O))}let N=o.flatMap(A=>A.drawPositions).reduce((A,O)=>g?.includes(O)&&A,!0);return!C&&!T&&!U&&!N?{error:d6,validSeedBlocks:[],isContainer:U,isFeedIn:T}:{isLuckyStructure:C,validSeedBlocks:o,isContainer:U,isFeedIn:T}}function sye({seedingProfile:t,structure:e,nonRandom:i}){let r=e.structures||[],n=r.length,a=Yt({structure:e})?.positionAssignments,s=mS(t),o=a?.length??0,{seedGroups:l}=wL({roundRobinGroupsCount:n,drawSize:o}),u=r.map(c=>Yt({structure:c}).positionAssignments?.map(d=>d.drawPosition));return U7({drawPositionBlocks:u,positioning:s,seedGroups:l,nonRandom:i})}function U7({drawPositionBlocks:t,positioning:e,seedGroups:i,nonRandom:r}){let n=[],{divisionGroupings:a}=eye({size:i.length,positioning:e}),s=[];return i.forEach((o,l)=>{let u=Zve({blockPattern:a,index:l});o.forEach((c,d)=>{let p=l%2?t.length-d-1:d,f=t[p].slice().filter((h,g)=>u.includes(g+1)&&h);e!==Tp?f=r?f:Dn(f):l%2&&f.reverse();let m=f.find(h=>!s.includes(h));m&&(s.push(m),n.push({drawPositions:[m],seedNumbers:[c]}))})}),{validSeedBlocks:n}}function oye(t){let{drawPositionOffset:e=0,roundRobinGroupsCount:i,seedNumberOffset:r=0,seedingProfile:n,seedCountGoal:a,baseDrawSize:s}=t,o,l=[],{seedBlocks:u}=bL({cluster:[eR,tR].includes(mS(n)),participantsCount:s,roundRobinGroupsCount:i});o=0;for(let c of u){if(o+1>a)break;let d=c.map(f=>f+e),p=lye(o+1,c.length).map(f=>+f+r);o+=c.length,l.push({drawPositions:d,seedNumbers:p})}return{blocks:l}}function lye(t,e){return Array.from(new Array(e),(i,r)=>r+t)}function XD({appliedPolicies:t,drawDefinition:e,seedBlockInfo:i,drawPosition:r,structureId:n,seedNumber:a}){let{structure:s}=et({drawDefinition:e,structureId:n});t??=Tt({drawDefinition:e}).appliedPolicies;let o=i?.validSeedBlocks;return!o&&s&&(o=yh({appliedPolicies:t,drawDefinition:e,structure:s})?.validSeedBlocks),t?.seeding?.validSeedPositions?.ignore?!0:t?.seeding?.validSeedPositions?.strict?(o.find(l=>l.seedNumbers.includes(a))?.drawPositions||[]).includes(r):o.flatMap(l=>l.drawPositions).includes(r)}function T7(t){let{provisionalPositioning:e,drawDefinition:i,seedingProfile:r,seedBlockInfo:n,structureId:a,randomize:s}=t,{structure:o}=et({drawDefinition:i,structureId:a}),{seedAssignments:l}=ds({returnAllProxies:t.returnAllProxies,provisionalPositioning:e,drawDefinition:i,structure:o}),{positionAssignments:u}=ur({structure:o}),c=u?.filter(R=>R.participantId??R.bye??R.qualifier)?.map(R=>R.drawPosition).filter(Boolean),{appliedPolicies:d}=Tt({drawDefinition:i}),p=(n?.validSeedBlocks||o&&yh({returnAllProxies:t.returnAllProxies,provisionalPositioning:e,appliedPolicies:d,drawDefinition:i,seedingProfile:r,structure:o})?.validSeedBlocks||[]).find(R=>R.drawPositions.filter(C=>!c?.includes(C)).length),f=l?.map(R=>R.participantId).filter(Boolean),m=u?.map(R=>R.participantId).filter(Boolean),h=f?.filter(R=>m?.includes(R)),g=f?.filter(R=>!m?.includes(R)),I=l?.filter(R=>g?.includes(R.participantId)),v=l?.filter(R=>!R.participantId),w=(I?.length&&I.length>0?I.length:v?.length??0)&&p?.drawPositions.filter(R=>!c?.includes(R))||[],y=s?Dn(w):w,b=[],S=y.map(()=>{let R=E(I,b)?.participantId;return R&&b.push(R),R}).filter(Boolean),U=l?.filter(R=>h?.includes(R.participantId)).map(R=>R.seedNumber),T=(p?.seedNumbers||[]).filter(R=>!U?.includes(R)),P=l?.filter(R=>T.includes(R.seedNumber)).map(R=>R.participantId),D=d?.seeding?.duplicateSeedNumbers;return{nextSeedBlock:p,unplacedSeedParticipantIds:typeof D!="boolean"||D?S:P,unplacedSeedNumbers:T,unfilledPositions:y,unplacedSeedAssignments:I};function E(R,C){let M=R.filter(O=>!C.includes(O.participantId)),N=Math.min(...M.map(O=>sI(O.seedValue))),A=M.filter(O=>sI(O.seedValue)===N);return Dn(A).pop()}}function mS(t){if(typeof t=="string")return t;if(typeof t=="object")return t.positioning}function dv({provisionalPositioning:t,tournamentRecord:e,drawDefinition:i,seedingProfile:r,participantId:n,seedBlockInfo:a,structureId:s,seedNumber:o,seedValue:l,eventId:u,event:c}){let d="assignSeed",{structure:p}=et({drawDefinition:i,structureId:s}),{positionAssignments:f}=ur({structure:p}),m=ds({provisionalPositioning:t,drawDefinition:i,structure:p}).seedAssignments,h=m.map(b=>b.seedNumber),g=im({drawDefinition:i,participantId:n});if(n&&!g)return z({result:{error:To},context:{participantId:n},stack:d});let I=c?$i({event:c}).flightProfile?.flights?.length:0,v=I&&I>1,w=f?.find(b=>b.participantId===n)?.drawPosition;if(w&&!XD({drawPosition:w,drawDefinition:i,seedBlockInfo:a,structureId:s,seedNumber:o}))return z({result:{error:E1},context:{assignedDrawPosition:w},info:"invalid seed position",stack:d});h.includes(o)||m.push({seedNumber:o,seedValue:l});let y;return m.forEach(b=>{b.participantId===n&&b.seedNumber!==o&&(b.participantId=void 0),b.seedNumber===o&&(b.participantId=n,!r?.groupSeedingThreshold&&!v&&(b.seedValue=l??o),y=!0)}),y?(sK({tournamentId:e?.tournamentId,drawDefinition:i,structure:p,eventId:u}),{...H}):z({result:{error:c6},stack:d})}function UL({inContextTargetMatchUp:t,drawPositionSideIndex:e,teamParticipantId:i,tournamentRecord:r,drawDefinition:n,matchUp:a,event:s}){let o=t?.sides?.[e]?.sideNumber,l=o&&a.sides?.find(p=>p.sideNumber===o),{extension:u}=mt({element:n,name:uc}),c=u?.value||{},d=ke(c[i],!1,!0);if(l)a?.sides?.forEach(p=>{p.sideNumber===o&&(p.lineUp=d)});else{a.sides=[1,2].map(f=>({...a.sides?.find(m=>m.sideNumber===f)??{},sideNumber:f}));let p=a.sides.find(f=>f.sideNumber===o);p&&(p.lineUp=d)}St({tournamentId:r?.tournamentId,context:"updateSidLineUp",eventId:s?.eventId,drawDefinition:n,matchUp:a})}function D7(t){let{sourceMatchUp:e}=t,{targetMatchUp:i,structure:r,matchUpsMap:n,drawPosition:a}=t,s=i.roundNumber>1&&i.roundNumber-1,o=gd({structureId:r.structureId,matchUpsMap:n});Gt({method:"getPairedPreviousMatchUpIsDoubleExit",color:"brightcyan",keyColors:{structureId:"brightyellow",sourceMatchUpId:"brightmagenta"},structureId:r.structureId?.slice(0,8),targetMatchUpId:i.matchUpId,targetRound:[i.roundNumber,i.roundPosition],previousRoundNumber:s,sourceMatchUpId:e?.matchUpId,sourceStructureId:e?.structureId?.slice(0,8),sourceRound:e?[e.roundNumber,e.roundPosition]:void 0,drawPosition:a,structureMatchUpCount:o?.length}),e&&e.structureId!==r.structureId&&a?(Gt({method:"getPairedPreviousMatchUpIsDoubleExit",color:"cyan",info:"cross_structure_sourceMatchUp_resolving_in_target",originalSourceId:e?.matchUpId,originalSourceStructure:e?.structureId?.slice(0,8),targetStructure:r.structureId?.slice(0,8)}),e=o.find(({drawPositions:m,roundNumber:h})=>h===s&&m?.includes(a)),Gt({method:"getPairedPreviousMatchUpIsDoubleExit",color:"cyan",info:"resolved_cross_structure_sourceMatchUp",resolvedMatchUpId:e?.matchUpId,resolvedRound:e?[e.roundNumber,e.roundPosition]:void 0,resolvedStatus:e?.matchUpStatus})):!e&&a&&(e=o.find(({drawPositions:m,roundNumber:h})=>h===s&&m?.includes(a)),Gt({method:"getPairedPreviousMatchUpIsDoubleExit",color:"cyan",info:"resolved_sourceMatchUp_from_drawPosition",resolvedMatchUpId:e?.matchUpId,resolvedRound:e?[e.roundNumber,e.roundPosition]:void 0,resolvedStatus:e?.matchUpStatus}));let l=e?.roundPosition,u=l%2?1:-1,c=l+u,d=s&&o.find(({roundNumber:m,roundPosition:h})=>m===s&&h===c),p=d?.matchUpStatus,f=[wi,Hi].includes(p);return Gt({method:"getPairedPreviousMatchUpIsDoubleExit",color:f?"brightred":"brightgreen",keyColors:{pairedMatchUpId:"brightcyan",isDoubleExit:f?"brightred":"brightgreen"},sourceRoundPosition:l,offset:u,pairedRoundPosition:c,pairedMatchUpId:d?.matchUpId,pairedRound:d?[d.roundNumber,d.roundPosition]:void 0,pairedStatus:p,isDoubleExit:f}),{pairedPreviousMatchUp:d,pairedPreviousMatchUpIsDoubleExit:f}}function uye({drawPosition:t,drawPositions:e}){let i=!1,r=!!e?.includes(t);return{updatedDrawPositions:r?e||[]:[...e,void 0,void 0].slice(0,2).map(n=>!n&&!r?(r=!0,i=!0,t):n).sort(ir).filter(Boolean),positionAdded:i,positionAssigned:r}}function P7({structureId:t,matchUpsMap:e,matchUp:i}){let r=i?.roundPosition,n=r%2?1:-1,a=r+n;return{pairedPreviousMatchUp:gd({matchUpsMap:e,structureId:t}).find(({roundNumber:s,roundPosition:o})=>s===i?.roundNumber&&o===a)}}function E7({inContextDrawMatchUps:t,sourceMatchUpStatus:e,sourceMatchUpId:i,matchUpsMap:r,matchUp:n}){let a=t.find(o=>o.matchUpId===i),{pairedPreviousMatchUp:s}=P7({structureId:a?.structureId,matchUp:a,matchUpsMap:r});if(a&&s){let o=s?.matchUpId,l=t.find(c=>c.matchUpId===o),u=a?.structureId===l?.structureId?a?.roundPosition<l?.roundPosition&&1||2:a.structureId===l?.structureId&&2||1;n.matchUpStatusCodes=(n.matchUpStatusCodes??[]).map(c=>{let d=ri(c)||!isNaN(c)?{code:c}:c;return d.sideNumber===u?{...d,previousMatchUpStatus:e}:d})}}function XT({inContextDrawMatchUps:t,drawPosition:e,matchUpId:i}){let r=t.filter(({winnerMatchUpId:n,loserMatchUpId:a})=>a===i||n===i).sort((n,a)=>n.roundPosition-a.roundPosition);return t.find(n=>n.matchUpId===i).feedRound?1:r.reduce((n,a,s)=>a.drawPositions?.includes(e)?s+1:n,void 0)}function rm({inContextDrawMatchUps:t,sourceMatchUpStatus:e,tournamentRecord:i,sourceMatchUpId:r,drawDefinition:n,matchUpStatus:a,drawPosition:s,matchUpsMap:o,matchUpId:l,event:u}){let c="assignMatchUpDrawPosition";o||(o=Ar({drawDefinition:n})),t||(t=Qi({inContext:!0,drawDefinition:n,matchUpsMap:o}).matchUps??[]);let d=t.find(C=>C.matchUpId===l),p=d?.structureId,f=n?.structures?.find(C=>C.structureId===p);if(!f)return{error:Ii};let m=o?.drawMatchUps?.find(C=>C.matchUpId===l),h=m?.drawPositions??[],{positionAdded:g,positionAssigned:I,updatedDrawPositions:v}=uye({drawPositions:h,drawPosition:s}),{positionAssignments:w}=Yt({drawDefinition:n,structure:f}),y=w?.filter(C=>v.includes(C.drawPosition))?.find(({bye:C})=>C),b=m?.matchUpStatus&&Fr(m.matchUpStatus)&&v.filter(Boolean).length<2;a=y&&"BYE"||a||b&&m.matchUpStatus||m?.matchUpStatus&&[wi,Hi].includes(m.matchUpStatus)&&m.matchUpStatus||Fi;let S=!!(Fr(m?.matchUpStatus)&&m?.winningSide);if(m&&g){t=Qi({inContext:!0,drawDefinition:n,matchUpsMap:o}).matchUps??[];let C=b&&XT({inContextDrawMatchUps:t,drawPosition:s,matchUpId:l})||S&&m.winningSide||void 0;m?.matchUpStatusCodes&&E7({inContextDrawMatchUps:t,sourceMatchUpStatus:e,sourceMatchUpId:r,matchUpsMap:o,matchUp:m}),Object.assign(m,{drawPositions:v,winningSide:C,matchUpStatus:S?m?.matchUpStatus:a}),St({tournamentId:i?.tournamentId,eventId:d?.eventId,context:c,drawDefinition:n,matchUp:m})}let U=On({inContextDrawMatchUps:t,inContextMatchUp:d,drawDefinition:n,matchUpId:l}),{targetMatchUps:{winnerMatchUp:T,loserMatchUp:P,loserTargetDrawPosition:D},targetLinks:{loserTargetLink:E}}=U,R=gd({structureId:f.structureId,matchUpsMap:o});if(I&&y){if(T)if(["BYE",wi,Hi].includes(a)){let C=rm({matchUpId:T.matchUpId,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:n,drawPosition:s,matchUpsMap:o});if(C.error)return C}else{let{structureId:C}=T;C!==f.structureId&&console.log("winnerMatchUp in different structure... participant is in different targetDrawPosition")}}else if(I&&S){if(T){let C=rm({matchUpId:T.matchUpId,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:n,drawPosition:s,matchUpsMap:o});if(C.error)return C}}else if(T&&d&&!d.feedRound){let{pairedPreviousMatchUpIsDoubleExit:C}=D7({targetMatchUp:m,drawPosition:s,matchUpsMap:o,structure:f});if(C){let M=rm({matchUpId:T.matchUpId,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:n,drawPosition:s,matchUpsMap:o});if(M.error)return M}}if(m?.matchUpType===Zt){let C=t?.find(({matchUpId:A})=>A===m.matchUpId),M=(C?.sides??[]).reduce((A,O,k)=>O.drawPosition===s?k:A,void 0),N=w?.find(A=>A.drawPosition===s)?.participantId;N&&M!==void 0&&UL({inContextTargetMatchUp:C,drawPositionSideIndex:M,teamParticipantId:N,tournamentRecord:i,drawDefinition:n,matchUp:m})}if(E?.linkCondition===al&&v.filter(Boolean).length===2&&!y&&R.filter(({drawPositions:C,roundNumber:M})=>M===1&&kn(C,v)).every(({matchUpStatus:C})=>[ki,$r].includes(C))&&P){let{structureId:C}=P,M=Wa({drawPosition:D,tournamentRecord:i,drawDefinition:n,structureId:C,matchUpsMap:o,event:u});if(M.error)return M}return I?{...H}:z({result:{error:qg},context:{drawPosition:s},stack:c})}function R7({inContextDrawMatchUps:t,drawDefinition:e,assignments:i,matchUpsMap:r,structure:n}){let a=av({drawDefinition:e})?.containedStructures?.[n.structureId]?.map(({structureId:c})=>c)||[];a.push(n?.structureId);let s=i?.map(({drawPosition:c})=>c)||[],o=t?.filter(c=>a.includes(c.structureId)&&xi(c.drawPositions??[],s).length)??[],l=o.map(({matchUpId:c})=>c),u=r?.drawMatchUps?.filter(c=>l.includes(c.matchUpId))??[];return{drawPositions:s,matchUps:u,targetMatchUps:o}}function TL({lineUp:t}){if(!Array.isArray(t))return;let e={};return rt(t.flatMap(({collectionAssignments:i})=>i?.map(({collectionId:r,collectionPosition:n})=>[r,n].join("|"))).filter(Boolean)).forEach(i=>{let[r,n]=i.split("|"),a=parseInt(n),{assignedParticipantIds:s}=qD({collectionPosition:a,collectionId:r,lineUp:t});s.forEach(o=>{e[o]||(e[o]=[]),e[o].push({collectionId:r,collectionPosition:a})})}),Object.keys(e).map(i=>({participantId:i,collectionAssignments:e[i]}))}function Np(t){return`${t} must be an array`}function xR({lineUp:t,tieFormat:e}){let i=[];if(!Array.isArray(t))return i.push(Np("lineUp")),{valid:!1,errors:i,error:ie};let r=t.every(a=>{if(typeof a!="object")return i.push("lineUp entries must be objects"),!1;let{participantId:s,collectionAssignments:o}=a;return s?typeof s!="string"?(i.push("participantIds must be strings"),!1):Array.isArray(o)?o.every(l=>{if(typeof l!="object")return i.push("collectionAssignments must be objects"),!1;let{collectionPosition:u}=l;return typeof u!="number"?(i.push("collectionPosition must be a number"),!1):!0}):(i.push(Np("collectionAssignments")),!1):(i.push("Missing participantId"),!1)}),n=rt(t.map(vt)).length===t.length;return n||i.push("Duplicated participantId(s)"),{valid:r&&n,errors:i,error:i.length?ie:void 0}}function bh({drawDefinition:t,participantId:e,tieFormat:i,lineUp:r}){if(typeof t!="object")return{error:_e};if(typeof e!="string")return{error:lr};let n=xR({lineUp:r,tieFormat:i});if(!n.valid)return n;let{extension:a}=mt({element:t,name:uc}),s=a?.value||{};return s[e]=TL({lineUp:r}),xt({element:t,extension:{name:uc,value:s}}),Hw({drawDefinition:t}),{...H}}function DL({inContextDrawMatchUps:t,inheritance:e=!0,tournamentRecord:i,drawDefinition:r,matchUpsMap:n,assignments:a,structure:s,event:o}){if(!r)return{error:_e};let{drawPositions:l,matchUps:u,targetMatchUps:c}=R7({inContextDrawMatchUps:t,matchUpsMap:n,assignments:a,structure:s});for(let d of c)d.matchUpType===ka&&(d.sides??[]).forEach((p,f)=>{if(p?.drawPosition&&l?.includes(p.drawPosition)){let m=u.find(({matchUpId:h})=>h===d.matchUpId);if(m?.sides?.[f]){if(delete m.sides[f].lineUp,e===!1){let h=d.tieFormat,g=p.participantId;h&&g&&bh({drawDefinition:r,participantId:g,lineUp:[],tieFormat:h})}St({tournamentId:i?.tournamentId,context:"resetLineUps",eventId:o?.eventId,drawDefinition:r,matchUp:m})}}});return{...H}}function ol({provisionalPositioning:t,inContextDrawMatchUps:e,isQualifierPosition:i,sourceMatchUpStatus:r,tournamentRecord:n,drawDefinition:a,seedingProfile:s,participantId:o,seedBlockInfo:l,drawPosition:u,matchUpsMap:c,structureId:d,event:p}){let f="assignDrawPosition";if(!o&&!i)return z({result:{error:lr},stack:f});c=c??Ar({drawDefinition:a}),e||({matchUps:e}=Qi({inContext:!0,drawDefinition:a,matchUpsMap:c}));let m=et({drawDefinition:a,structureId:d});if(m.error)return z({result:m,stack:f});let{structure:h}=m;if(!h)return{error:Ii};if(Vn({structure:h}))return z({result:{error:ta},stack:f});let{seedAssignments:g}=ds({provisionalPositioning:t,drawDefinition:a,structure:h}),I=g?.find(P=>P.participantId===o)?.seedNumber,{appliedPolicies:v}=Tt({tournamentRecord:n,drawDefinition:a,structure:h,event:p});if(I&&!XD({seedNumber:I,appliedPolicies:v,drawDefinition:a,seedBlockInfo:l,drawPosition:u,structureId:d}))return z({result:{error:E1},context:{drawPosition:u},stack:f});let w=ur({structure:h}).positionAssignments||[],y=w?.find(P=>P.drawPosition===u);if(!y)return z({result:{error:Zm},context:{drawPosition:u},stack:f});if(w?.map(vt).includes(o))return z({result:{error:JI},context:{drawPosition:u},stack:f});let{containsParticipant:b,containsBye:S}=sL(y);if(S){let P=oS({inContextDrawMatchUps:e,tournamentRecord:n,drawDefinition:a,drawPosition:u,structureId:d,matchUpsMap:c,event:p});if(P.error)return z({result:P,stack:f})}if(b&&y.participantId!==o){let{activeDrawPositions:P}=lv({drawDefinition:a,structureId:d});if(P.includes(u))return z({result:{error:Pw},stack:f});DL({assignments:[y],inContextDrawMatchUps:e,tournamentRecord:n,drawDefinition:a,matchUpsMap:c,structure:h})}if(y.participantId=o,i&&(y.qualifier=!0),h.stage===xe&&(!h.stageSequence||h.stageSequence>1)||h.stage&&[Zr,Ui].includes(h.stage)){let P=h.stage===We?We:xe,D=(a.structures?.find(E=>E?.stage===P&&E?.stageSequence===1)?.seedAssignments??[]).find(E=>E.participantId===o);if(D?.participantId){let{participantId:E,seedNumber:R,seedValue:C}=D;dv({eventId:p?.eventId,provisionalPositioning:t,tournamentRecord:n,drawDefinition:a,seedingProfile:s,participantId:E,seedNumber:R,seedValue:C,structureId:d,event:p})}}if(h.structureType===fn){HK({positionAssignments:w,tournamentRecord:n,drawDefinition:a,matchUpsMap:c,structure:h});let{drawPositions:P,matchUps:D,targetMatchUps:E}=R7({assignments:[y],inContextDrawMatchUps:e,drawDefinition:a,matchUpsMap:c,structure:h});if(P&&D?.length===1&&D[0].matchUpType===Zt){let R=(E?.[0].sides??[]).reduce((C,M,N)=>P?.includes(M.drawPosition)?N:C,void 0);UL({inContextTargetMatchUp:E[0],teamParticipantId:o,matchUp:D[0],drawPositionSideIndex:R,tournamentRecord:n,drawDefinition:a})}}else cye({provisionalPositioning:t,inContextDrawMatchUps:e,sourceMatchUpStatus:r,tournamentRecord:n,drawDefinition:a,drawPosition:u,matchUpsMap:c,structure:h,event:p});let U=a.entries?.find(P=>P.participantId===o),T=p?.entries?.find(P=>P.participantId===o);return!U&&T&&pL({entryStatus:T.entryStatus,entryStage:h.stage,ignoreStageSpace:!0,drawDefinition:a,participantId:o,event:p}),pc({tournamentId:n?.tournamentId,drawDefinition:a,structure:h,event:p}),{positionAssignments:w,...H}}function cye({provisionalPositioning:t,inContextDrawMatchUps:e,sourceMatchUpStatus:i,tournamentRecord:r,drawDefinition:n,drawPosition:a,matchUpsMap:s,structure:o,event:l}){let u={isCollectionMatchUp:!1},{matchUps:c}=Nt({provisionalPositioning:t,matchUpFilters:u,drawDefinition:n,matchUpsMap:s,structure:o,event:l}),{roundMatchUps:d}=bn({matchUps:c}),{initialRoundNumber:p}=Mm({drawPosition:a,matchUps:c}),f=p&&d?.[p].find(m=>m.drawPositions?.includes(a));if(f){let m=rm({matchUpId:f.matchUpId,inContextDrawMatchUps:e,sourceMatchUpStatus:i,tournamentRecord:r,drawDefinition:n,drawPosition:a,matchUpsMap:s});if(m.error)return z({stack:"assignDrawPositionToMatchUps",context:{drawPosition:a},result:m})}return{...H}}function PL(t){let{participantIdAttributeName:e="participantId",isQualifierPosition:i,positionActionName:r,tournamentRecord:n,drawDefinition:a,participantId:s,drawPosition:o,structureId:l,event:u}=t,c="positionParticipantAction";if(!a)return{error:_e};let d=Tt({tournamentRecord:n,drawDefinition:a,event:u}).appliedPolicies??{},{inContextDrawMatchUps:p,matchUpsMap:f}=t;f||(f=Ar({drawDefinition:a}),Object.assign(t,{matchUpsMap:f})),p||({matchUps:p}=Qi({inContext:!0,drawDefinition:a,matchUpsMap:f}),Object.assign(t,{inContextDrawMatchUps:p}));let{positionAssignments:m}=Yt({drawDefinition:a,structureId:l}),h=m?.find(y=>y.drawPosition===o);if(h?.participantId){let y=h.participantId,b=ol({inContextDrawMatchUps:p,tournamentRecord:n,drawDefinition:a,participantId:s,drawPosition:o,structureId:l,matchUpsMap:f,event:u});return b.success?w({appliedPolicies:d,removedParticipantId:y}):z({result:b,stack:c})}let g=oS({inContextDrawMatchUps:p,tournamentRecord:n,drawDefinition:a,drawPosition:o,structureId:l,matchUpsMap:f,event:u});if(g.error)return z({result:g,stack:c});let I=g.participantId,v=ol({inContextDrawMatchUps:p,isQualifierPosition:i,tournamentRecord:n,drawDefinition:a,participantId:s,drawPosition:o,structureId:l,matchUpsMap:f,event:u});if(!v.success)return z({result:v,stack:c});return w({appliedPolicies:d,removedParticipantId:I});function w({appliedPolicies:y,removedParticipantId:b}){let{structure:S}=et({drawDefinition:a,structureId:l});HF({drawPositions:[o],structure:S});let U={[e]:s,name:r,drawPosition:o,structureId:l};return Ww({appliedPolicies:y,drawDefinition:a,positionAction:U}),z({context:{removedParticipantId:b},result:{...H},stack:c})}}function dye({luckyLoserParticipantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,structureId:n}){return PL({positionActionName:"luckyLoserDrawPositionAssignment",participantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,structureId:n})}function C7(t){return dye(t)}function M7({params:t,modMap:e,structure:i}){let{tournamentRecord:r,drawDefinition:n,event:a}=t;for(let s of i.matchUps)e[s.matchUpId]&&(s.roundNumber=e[s.matchUpId],St({tournamentId:r?.tournamentId,eventId:a?.eventId,drawDefinition:n,matchUp:s}))}function N7(t,e){let i=[{drawDefinition:!0,structureId:!0}];Array.isArray(e)&&i.push(...e);let r=Ge(t,i);if(r.error)return r;let n=et(t);if(n.error)return n;let a=n.structure;if(!Vn({structure:a}))return z({result:{error:Jp,message:"structure must be adHoc"}});let{roundMatchUps:s=[],roundNumbers:o}=bn({matchUps:a?.matchUps});return o?.length?{valid:!0,structure:a,roundMatchUps:s,roundNumbers:o}:{error:Tu}}function A7(t){let e=N7(t,[{targetRoundNumber:!0,roundNumber:!0,[zn]:fge}]);if(e.error)return e;let{structure:i,roundMatchUps:r,roundNumbers:n}=e,{targetRoundNumber:a,roundNumber:s}=t;if(!n?.includes(s)||!n?.includes(a))return z({result:{error:ie},info:"roundNumbers must be valid rounds"});let o=a>s,l=o?Re(s+1,a+1):Re(a,s),u={};return l.forEach(c=>(r?.[c]??[]).forEach(({matchUpId:d})=>{u[d]=c-(o?1:-1)})),r?.[s]?.forEach(({matchUpId:c})=>u[c]=a),M7({params:t,modMap:u,structure:i}),{...H}}function k7({structurePositionAssignments:t,provisionalPositioning:e,tournamentRecord:i,drawDefinition:r,event:n}){if(!r)return{error:_e};if(!Array.isArray(t))return{error:ie};let a="setPositionAssignments";for(let o of t){let{structureId:l,positionAssignments:u}=o;if(!u)continue;let c=et({drawDefinition:r,structureId:l});if(c.error)return c;let d=c.structure;if(!d)return{error:Ii};let p=Yt({structure:d}).positionAssignments?.map(({drawPosition:g})=>g),f=u?.map(({drawPosition:g})=>g);if(xi(p,f).length!==p?.length)return z({result:{error:ie},info:"drawPositions do not match",stack:a});let m=Ar({drawDefinition:r}),{matchUps:h}=Qi({inContext:!0,drawDefinition:r,matchUpsMap:m});for(let g of u||[]){let{drawPosition:I,participantId:v,bye:w,qualifier:y}=g;if(w){let b=Wa({tournamentRecord:i,drawDefinition:r,drawPosition:I,matchUpsMap:m,structureId:l,structure:d,event:n});if(b?.error)return b}else if(y)u.forEach(b=>{b.drawPosition===I&&(b.qualifier=!0,delete b.participantId,delete b.bye)});else if(v){let b=ol({provisionalPositioning:e,inContextDrawMatchUps:h,tournamentRecord:i,drawDefinition:r,participantId:v,drawPosition:I,matchUpsMap:m,structureId:l,event:n});if(b?.error)return b}}pc({tournamentId:i?.tournamentId,drawDefinition:r,structure:d,event:n})}let s=t.map(({structureId:o})=>o);return ti({tournamentId:i?.tournamentId,eventId:n?.eventId,drawDefinition:r,structureIds:s}),{...H}}function O7(t){let e=N7(t,[{roundNumbers:!0,[zn]:an,[Wr]:s=>s.length===2&&s.every(Ni)}]);if(e.error)return e;let{structure:i,roundMatchUps:r,roundNumbers:n}=e;if(!t.roundNumbers.every(s=>n?.includes(s)))return z({result:{error:ie,message:"roundNumbers must be valid rounds"}});let a={};return t.roundNumbers.forEach((s,o)=>(r?.[s]??[]).forEach(({matchUpId:l})=>{a[l]=t.roundNumbers[1-o]})),M7({params:t,modMap:a,structure:i}),{...H}}function x7({alternateParticipantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,structureId:n,event:a}){return PL({positionActionName:"alternateDrawPositionAssignment",participantIdAttributeName:"alternateParticipantid",participantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,structureId:n,event:a})}function F7({drawDefinition:t,structureId:e}){if(!t)return{error:_e};let{structure:i}=et({drawDefinition:t,structureId:e}),r=(t?.links||[]).filter(n=>n.source?.structureId===e).map(n=>n.target?.structureId);return{playoffStructures:(t?.structures||[]).filter(n=>r.includes(n.structureId)),structure:i}}function FR({withStageGrouping:t,stageSequences:e,stageSequence:i,roundTarget:r,stages:n,event:a,stage:s}){if(!a)return{error:li};let o={},l=[];for(let u of a.drawDefinitions||[]){let{structures:c,stageStructures:d}=Js({withStageGrouping:t,stageSequences:e,drawDefinition:u,stageSequence:i,roundTarget:r,stages:n,stage:s});if(l.push(...c),d)for(let p of Object.keys(d))o[p]||(o[p]=[]),o[p].push(...d[p])}return{structures:l,stageStructures:o}}function EL({withStageGrouping:t,tournamentRecord:e,stageSequences:i,stageSequence:r,roundTarget:n,stages:a,stage:s}){if(!e)return{error:Ie};let o={},l=[];for(let u of e.events||[]){let{structures:c,stageStructures:d}=FR({withStageGrouping:t,stageSequences:i,stageSequence:r,roundTarget:n,stages:a,event:u,stage:s});if(c&&l.push(...c),d)for(let p of Object.keys(d))o[p]||(o[p]=[]),o[p].push(...d[p])}return{structures:l,stageStructures:o}}function uu(t){if(!t?.drawDefinition)return!1;let e=NR(t),i=e?.includesTeamMatchUps,{completedMatchUps:r,pendingMatchUps:n,upcomingMatchUps:a}=e||{};return i&&(r=r?.filter(({matchUpType:s})=>s===Zt),n=n?.filter(({matchUpType:s})=>s===Zt),a=a?.filter(({matchUpType:s})=>s===Zt)),!!(r?.length&&!n?.length&&!a?.length)}function RL(t){let{drawDefinition:e,structureId:i}=t;if(!e)return{error:_e};let{playoffStructures:r}=F7({drawDefinition:e,structureId:i});if(!r?.length)return!1;let n=e?.entries?.filter(s=>s?.entryStatus&&so.includes(s.entryStatus))?.length??0,a=0;return(r||[]).reduce((s,o)=>!!((Yt({structure:o}).positionAssignments??[])?.filter(l=>(l.participantId&&a++,l?.bye??l?.participantId)).length&&s),!!r.length)||a===n}function hO({significantCharacters:t,accessors:e=[],value:i}){let r=[],n=e[0];if(i?.[n]){let s=e.slice(1);if(Array.isArray(i[n]))i[n].forEach(o=>{let l=hO({accessors:s,significantCharacters:t,value:o});r.push(...l)});else if(i=i[n],s.length){let o=hO({accessors:s,significantCharacters:t,value:i});r.push(...o)}else a({value:i})}function a({value:s}){if(s&&["string","number"].includes(typeof s)){let o=t?s.slice(0,t):s;r.push(o)}}return r}function pye({targetParticipantIds:t,policyAttributes:e,idCollections:i,participants:r}){if(!Array.isArray(e))return{error:x1};if(!Array.isArray(r))return{error:Mw};let n={};return t.forEach(a=>{let s=r.find(l=>l.participantId===a),{values:o}=L7({policyAttributes:e,idCollections:i,participants:r,participant:s});o&&o.forEach(l=>{n[l]||(n[l]=[]),n[l].includes(a)||n[l].push(a)})}),n}function L7({policyAttributes:t,idCollections:e,participants:i,participant:r}){if(!Array.isArray(t))return{error:x1};if(!r)return{error:ih};let n=[];return t.forEach(a=>{let{directive:s,groupings:o,key:l,significantCharacters:u}=a||{};if(l){let c=l.split(".");n.push(...hO({significantCharacters:u,value:r,accessors:c}))}else if(s){let c=a?.includeIds,d=(e?.[s]||[]).filter(p=>!c||c.includes(p));d?.length&&i?.length&&d.forEach(p=>{let f=i.find(m=>m.participantId===p);if(f?.individualParticipantIds?.includes(r.participantId)){let m=f?.participantId;n.push(m)}})}else o&&Object.keys(o).forEach(c=>{o[c].includes(r.participantId)&&n.push(c)})}),{values:rt(n)}}function GH({candidatePositionAssignments:t,participantsWithGroupings:e,policyAttributes:i,idCollections:r}){let n=Object.assign({},...e.map(a=>({[a.participantId]:a})));return t.map(a=>{let s=n[a.participantId],{values:o}=L7({participants:e,policyAttributes:i,idCollections:r,participant:s});return{...a,values:o}})}function _7({participantIdGroups:t,positionAssignments:e,groupsToAvoid:i}){return Object.assign({},...e.filter(r=>r?.participantId).map(r=>{let{drawPosition:n,participantId:a}=r,s=t?t[a]||[]:[],o=!!i.some(l=>s.includes(l));return{[n]:{participantGroups:s,includesGroupsToAvoid:o}}}))}function fye(t){let{unfilledPositions:e,chunkedDrawPositions:i}=t,r=_7(t);return i.map(a=>{let s=e.filter(u=>a.includes(u)),o=n(s),l=s.filter(u=>!o.includes(u)).filter(u=>{let c=HH(u);return!r[c]?.includesGroupsToAvoid});return{unassigned:s,unpaired:o,pairedNoConflict:l}});function n(a){return a.filter(o=>!s(o));function s(o){let l=HH(o);return!a.includes(l)}}}function mye(t){let{unfilledPositions:e,chunkedDrawPositions:i}=t,r=_7(t);return i.map(n=>{let a=e.filter(l=>n.includes(l)),s=a.length===n.length?a:[],o=n.filter(l=>r[l]?.includesGroupsToAvoid).length;return{unassigned:a,unpaired:s,pairedNoConflict:o?[]:a,conflictsCount:o}})}function HH(t){return Number(t%2?t+1:t-1)}function hye({allGroups:t,participantId:e}){return Object.keys(t).filter(i=>t[i].includes(e))}function gye({selectedParticipantGroups:t,participantIdGroups:e,positionAssignments:i,drawPositionChunks:r,unfilledPositions:n,isRoundRobin:a}){let s=r.map(o=>a?mye({groupsToAvoid:t,chunkedDrawPositions:o,participantIdGroups:e,positionAssignments:i,unfilledPositions:n}):fye({groupsToAvoid:t,chunkedDrawPositions:o,participantIdGroups:e,positionAssignments:i,unfilledPositions:n}));if(a){let o=s.map(c=>c.map(d=>d.unassigned).filter(d=>d?.length)).filter(c=>c?.length).sort((c,d)=>(d.length||0)-(c.length||0)),l=s.map(c=>c.map(d=>d.unpaired).filter(d=>d?.length)).filter(c=>c?.length),u=s.map(c=>c.map(d=>d.pairedNoConflict).filter(d=>d?.length)).filter(c=>c?.length).sort((c,d)=>(d.length||0)-(c.length||0));return{unassigned:o,unpaired:l,pairedNoConflict:u}}else{let o=s.map(c=>c.map(d=>d.unassigned).filter(d=>d?.length)).filter(c=>c?.length),l=s.map(c=>c.map(d=>d.unpaired).filter(d=>d?.length)).filter(c=>c?.length),u=s.map(c=>c.map(d=>d.pairedNoConflict).filter(d=>d?.length)).filter(c=>c?.length);return{unassigned:o,unpaired:l,pairedNoConflict:u}}}function $7({positionAssignments:t,participantIds:e}){let i=t.map(r=>r.participantId);return e.filter(r=>!i.includes(r))}function Iye({useSpecifiedGroupKey:t=!1,targetParticipantIds:e,largestFirst:i=!0,allGroups:r,groupKey:n}){let a=Object.assign({},...Object.keys(r).map(u=>[u,r[u].filter(c=>e.includes(c))]).filter(u=>u[1].length).map(([u,c])=>({[u]:c}))),s=Object.keys(a).reduce((u,c)=>a[c].length>u?a[c].length:u,0),o=Object.keys(a).filter(u=>a[u].length===s),l=ca(i?o:Object.keys(a));return n=t&&a[n]?.length?n:l,{participantId:n&&a[n]?ca(a[n]):ca(e),groupKey:n}}function vye({drawPositionGroups:t,positionAssignments:e}){let i=Object.assign({},...e.map(r=>({[r.drawPosition]:r})));return t.map(r=>r.filter(Boolean).map(n=>i[n]).filter(Boolean).filter(n=>!n.participantId&&!n.bye).map(n=>n.drawPosition)).flat().filter(Boolean)}function yye({candidatePositionAssignments:t,unseededParticipantIds:e,participantIdGroups:i,drawPositionChunks:r,drawPositionGroups:n,pairedPriority:a,allGroups:s,groupKey:o}){let l=n.reduce((T,P)=>P.length>T?P.length:T,0)<=2,u=$7({positionAssignments:t,participantIds:e}),c=vye({positionAssignments:t,drawPositionGroups:n}),{participantId:d,groupKey:p}=Iye({targetParticipantIds:u,useSpecifiedGroupKey:l,allGroups:s,groupKey:o}),f=hye({participantId:d,allGroups:s}),m=gye({positionAssignments:t,isRoundRobin:l,selectedParticipantGroups:f,participantIdGroups:i,drawPositionChunks:r,unfilledPositions:c}),{unassigned:h,unpaired:g,pairedNoConflict:I}=m,v=I?.length&&I[0],w=g?.length&&g[0],y=a&&v?v:w,b=a?w:v,S=y?.length&&y||b?.length&&b,U;if(S?.length){let T=ma(S);U=ma(T)}else{let T=ma(h[0]);U=ma(T)}return{newGroupKey:p,selectedParticipantId:d,targetDrawPosition:U}}function gO({isRoundRobin:t,groupedParticipants:e}){let i=[];return t?e.forEach(r=>{let n=r.map(o=>o.drawPosition),a=yL({drawPositions:n}).uniqueMatchUpGroupings??[],s=Object.assign({},...r.map(o=>({[o.drawPosition]:o})));a.forEach(o=>{kn(s[o[0]].values||[],s[o[1]].values||[])&&(i.push(o),r.conflict=!0)})}):e.forEach(r=>{kn(r[0]?.values||[],r[1]?.values||[])&&(i.push(r),r.conflict=!0)}),i}function bye(t,e){let i=t.find(r=>r.includes(e));if(i)return i.find(r=>r!==e)}function WH(t,e){return t.find(i=>i.drawPosition===e)}function wye({moveableParticipant:t,possibleDrawPosition:e,positionedParticipants:i,drawPositionGroups:r,isRoundRobin:n,getAvoidanceConflicts:a}){let s=bye(r,e),o=WH(i,s),l=a({isRoundRobin:n,groupedParticipants:[[t,o]]}),u=[WH(i,e),o],c=a({isRoundRobin:n,groupedParticipants:[u]});return!l.length&&!c.length}function Sye({positionedParticipants:t,potentialDrawPositions:e,drawPositionGroups:i,avoidanceConflicts:r,isRoundRobin:n}){return r.flatMap(a=>{let s=a.map(o=>o.drawPosition);return a.filter(o=>e.includes(o.drawPosition)).map(o=>{let l=e.filter(u=>!s?.includes(u)).filter(u=>wye({moveableParticipant:o,possibleDrawPosition:u,positionedParticipants:t,drawPositionGroups:i,isRoundRobin:n,getAvoidanceConflicts:gO}));if(l.length)return{drawPosition:o.drawPosition,possibleDrawPositions:l}}).filter(Boolean)})}function zH(t){let{initialPositionAssignments:e,participantsWithGroupings:i,opponentsToPlaceCount:r,unseededByePositions:n,drawPositionGroups:a,policyAttributes:s,idCollections:o,allGroups:l}=t,u=[],c,d=Math.min(...(a||[]).map(w=>w?.length).filter(Boolean)),p=d>2,f=ke(e,!1,!0).filter(w=>!w.qualifier),m=e.filter(w=>!w.participantId&&(!w.bye||n?.includes(w.drawPosition))).map(w=>w.drawPosition);Re(0,r).forEach(()=>{let{newGroupKey:w,selectedParticipantId:y,targetDrawPosition:b}=yye({...t,candidatePositionAssignments:f,allGroups:l,groupKey:c});c=w,f.forEach(S=>{S.drawPosition===b&&(S.participantId=y)})});let h=GH({candidatePositionAssignments:f,participantsWithGroupings:i,policyAttributes:s,idCollections:o}),g=yr(h,d),I=gO({groupedParticipants:g,isRoundRobin:p}),v=0;for(;v<20&&I.length;){let w=Sye({positionedParticipants:h,potentialDrawPositions:m,avoidanceConflicts:I,drawPositionGroups:a,isRoundRobin:p});if(w.length){let y=Uye({candidatePositionAssignments:f,swapOptions:w});y.error&&console.log({result:y}),h=GH({candidatePositionAssignments:f,participantsWithGroupings:i,policyAttributes:s,idCollections:o}),g=yr(h,d),I=gO({groupedParticipants:g,isRoundRobin:p}),v++}else v=20}return f.forEach(w=>{if(w.bye&&w.participantId){let y=Wk;u.push(y)}if(w.qualifier&&w.participantId){let y=Wk;u.push(y)}}),{positionAssignments:f,conflicts:I.length,groupedParticipants:g,errors:u}}function Uye({candidatePositionAssignments:t,swapOptions:e}){let i=ma(e);if(!i)return{error:{message:"No swap options"}};let r=i.drawPosition,n=ma(i.possibleDrawPositions),a=t.find(u=>u.drawPosition===r),s=t.find(u=>u.drawPosition===n)??{},o={participantId:s?.participantId,qualifier:s?.qualifier,bye:s?.bye},l={participantId:a.participantId,qualifier:a.qualifier,bye:a.bye};return Object.assign(a,o),Object.assign(s,l),{...H}}function Tye({provisionalPositioning:t,unseededParticipantIds:e,inContextDrawMatchUps:i,unseededByePositions:r,tournamentRecord:n,drawDefinition:a,seedBlockInfo:s,participants:o,matchUpsMap:l,structureId:u,avoidance:c,drawSize:d,event:p}){if(!c)return{error:T6};let{candidatesCount:f=1,policyAttributes:m,targetDivisions:h}=c,{roundsToSeparate:g}=c,I="randomUnseededSeparation",{structure:v}=et({drawDefinition:a,structureId:u}),{matchUps:w}=Nt({provisionalPositioning:t,matchUpsMap:l,structure:v,event:p});if(h&&Uo(h)&&!g){let L=gme(h)||0,$=w.reduce((V,_)=>_.roundNumber>V?_.roundNumber:V,0);g=$<L?1:$-L+1}let{positionAssignments:y}=ur({structure:v}),b=wR({participantsProfile:{convertExtensions:!0},deepCopy:!1,participants:o}).participantsWithGroupings,S=y?.filter(L=>!L.participantId),U=y?.map(L=>L.drawPosition),T=v?.structureType===fn,P=T?{structure:v,matchUps:w,allDrawPositions:U,roundsToSeparate:g}:{matchUps:w,allDrawPositions:U,roundsToSeparate:g},{drawPositionGroups:D,drawPositionChunks:E}=T?Dye(P):Pye(P),R={groupParticipants:o.filter(L=>L.participantType===ja).map(L=>L.participantId),teamParticipants:o.filter(L=>L.participantType===Lt).map(L=>L.participantId),pairParticipants:o.filter(L=>L.participantType===pt).map(L=>L.participantId)},C=pye({targetParticipantIds:e,policyAttributes:m,idCollections:R,participants:o});if(C.error)return z({result:C,stack:I});let M=Object.assign({},...e.map(L=>{let $=Object.keys(C).filter(V=>(C[V]??[]).includes(L));return{[L]:$}})),N=$7({participantIds:e,positionAssignments:y});if(N.length>(S?.length||0))return{error:B1};let A,O=N.length,k=Re(0,f).map(()=>zH({initialPositionAssignments:y,participantsWithGroupings:b,unseededParticipantIds:e,opponentsToPlaceCount:O,pairedPriority:!1,unseededByePositions:r,participantIdGroups:M,drawPositionChunks:E,drawPositionGroups:D,policyAttributes:m,idCollections:R,allGroups:C,drawSize:d}));if(A=k.reduce((L,$)=>!L||($.conflicts||0)<(L.conflicts||0)?$:L,void 0),!A||A.conflicts){let L=Re(0,f).map(()=>zH({initialPositionAssignments:y,participantsWithGroupings:b,unseededParticipantIds:e,opponentsToPlaceCount:O,pairedPriority:!0,unseededByePositions:r,participantIdGroups:M,drawPositionChunks:E,drawPositionGroups:D,policyAttributes:m,idCollections:R,allGroups:C,drawSize:d}));A=k.concat(...L).filter($=>!$.errors?.length).reduce(($,V)=>!$||(V.conflicts||0)<($.conflicts||0)?V:$,void 0)}if(!A)return{error:GE};let F=(Yt({structure:v})?.positionAssignments??[]).filter(L=>L.participantId).map(L=>L.participantId),x=A.positionAssignments.filter(L=>!F.includes(L.participantId));for(let L of x)if(L.bye){let $=Wa({tournamentRecord:n,drawDefinition:a,structureId:u,matchUpsMap:l,event:p,...L});if($.error)return z({result:$,stack:I})}else if(L.participantId){let $=ol({inContextDrawMatchUps:i,tournamentRecord:n,drawDefinition:a,seedBlockInfo:s,structureId:u,matchUpsMap:l,event:p,...L});if($.error)return z({result:$,stack:I,context:{assignment:L}})}return{...H}}function Dye(t){let{structure:{structures:e}}=t,i=e.map(r=>r.positionAssignments.map(n=>n.drawPosition));return{drawPositionGroups:i,drawPositionChunks:[i]}}function Pye({allDrawPositions:t,roundsToSeparate:e,matchUps:i}){let r=i.filter(c=>c.roundNumber===1).map(c=>c.drawPositions),n=r.flat().sort(ir),a=Math.max(...n),s=t.filter(c=>c>a),o=n.length,l=Re(o===2?1:2,o).filter(c=>c===D1(c)),u=l.slice(0,e||l.length).reverse().map(c=>yr(n,c));return s.length&&console.log({fedDrawPositions:s}),{drawPositionGroups:r,drawPositionChunks:u}}function Eye({provisionalPositioning:t,inContextDrawMatchUps:e,unseededByePositions:i,multipleStructures:r,tournamentRecord:n,drawDefinition:a,seedBlockInfo:s,participants:o,matchUpsMap:l,structureId:u,structure:c,drawSize:d,event:p}){let f="positionUnseededParticipants";c||({structure:c}=et({drawDefinition:a,structureId:u})),u||({structureId:u}=c);let{positionAssignments:m}=ur({structure:c}),{seedAssignments:h}=ds({provisionalPositioning:t,drawDefinition:a,structure:c}),g=h?.map(P=>P.participantId).filter(Boolean),{stage:I,stageSequence:v}=c,w=I===We?mt({element:c,name:Tl})?.extension?.value:void 0,y=ch({provisionalPositioning:t,drawDefinition:a,stageSequence:v,entryStatuses:of,structureId:u,roundTarget:w,stage:I}),b=y.filter(P=>!g?.includes(P.participantId)).map(P=>P.participantId),S=m?.filter(P=>!P.participantId&&!P.bye&&!P.qualifier).map(P=>P.drawPosition);if(!r&&b.length>(S?.length||0))return z({result:{error:B1},context:{unseededParticipantsCount:b.length,unfilledDrawPositionsCount:S?.length},stack:f});let{appliedPolicies:U}=Tt({tournamentRecord:n,drawDefinition:a,event:p}),T=U?.[_D];if(c.stage===Ui){let P=y.reduce((D,E)=>(D[E.groupingValue]||(D[E.groupingValue]=[]),D[E.groupingValue].push(E.participantId),D),{});Object.keys(P).length&&(T||(T={policyName:"Playoff Avoidance"}),T.policyAttributes||(T.policyAttributes=[]),T.policyAttributes.push({groupings:P}))}return T&&o?Tye({provisionalPositioning:t,unseededParticipantIds:b,inContextDrawMatchUps:e,unseededByePositions:i,tournamentRecord:n,drawDefinition:a,seedBlockInfo:s,participants:o,matchUpsMap:l,structureId:u,avoidance:T,drawSize:d}):Rye({provisionalPositioning:t,unseededParticipantIds:b,inContextDrawMatchUps:e,unfilledDrawPositions:S,multipleStructures:r,tournamentRecord:n,drawDefinition:a,seedBlockInfo:s,structureId:u,matchUpsMap:l,drawSize:d,event:p})}function Rye({provisionalPositioning:t,unseededParticipantIds:e,inContextDrawMatchUps:i,unfilledDrawPositions:r,multipleStructures:n,tournamentRecord:a,drawDefinition:s,seedBlockInfo:o,matchUpsMap:l,structureId:u,drawSize:c,event:d}){let p=c>2?Dn(r):r.reverse();for(let f of e){let m=p.pop();if(!n||m){let h=ol({provisionalPositioning:t,inContextDrawMatchUps:i,tournamentRecord:a,drawDefinition:s,seedBlockInfo:o,participantId:f,drawPosition:m,matchUpsMap:l,structureId:u,event:d});if(h?.error&&console.log("!!!!!",{result:h}),h?.error)return z({result:h,stack:"randomUnseededDistribution"})}}return{...H}}function Cye(t){let e=t.structure??et(t).structure,i="positionQualifiers",r=[];if(e.stage===Zr)return z({result:{error:Zp},stack:i});let{unplacedRoundQualifierCounts:n,positionAssignments:a,roundDrawPositions:s}=Mye(t);for(let o of Object.keys(n)){let l=a?.filter(u=>s[o].includes(u.drawPosition)&&!u.participantId&&!u.qualifier&&!u.bye).map(u=>u.drawPosition);if(n[o]>(l||0))return z({result:{error:$1},context:{unfilledDrawPositions:l},stack:i});Re(0,n[o]).forEach(()=>{let u=ma(l);r.push(u),a?.forEach(c=>{c.drawPosition===u&&(c.qualifier=!0,delete c.participantId,delete c.bye)})})}return{...H,qualifierDrawPositions:r}}function Mye({drawDefinition:t,structure:e,structureId:i}){e||({structure:e}=et({drawDefinition:t,structureId:i})),i||({structureId:i}=e);let{positionAssignments:r}=ur({structure:e}),{stage:n,stageSequence:a}=e,{qualifiersCount:s,roundQualifiersCounts:o}=uv({drawDefinition:t,stageSequence:a,structureId:i,stage:n}),l=(o?Object.keys(o):[]).map(h=>Ye(h)),{matchUps:u}=Nt({structure:e}),{roundProfile:c}=bn({matchUps:u}),d=Object.assign({},...l.filter(h=>c?.[h]).map(h=>({[h]:c?.[h]?.drawPositions?.filter(Boolean)??[]}))),p=r?.filter(h=>h.qualifier).map(h=>h.drawPosition),f=s-(p?.length??0),m=p?.length;return{unplacedRoundQualifierCounts:Object.assign({},...l.map(h=>{let g=r?.filter(I=>I.qualifier&&d[h]?.drawPositions?.includes(I.drawPosition)).map(I=>I.drawPosition);return{[h]:(o?.[h]??0)-(g?.length??0)}})),unplacedQualifiersCount:f,placedQualifiersCount:m,roundQualifiersCounts:o,positionAssignments:r,roundDrawPositions:d,qualifiersCount:s}}function B7({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,appliedPolicies:r,validSeedBlocks:n,drawDefinition:a,seedingProfile:s,seedBlockInfo:o,participants:l,groupsCount:u,structureId:c,matchUpsMap:d,structure:p,event:f}){let m=[],h=[],g=0;if(p||({structure:p}=et({drawDefinition:a,structureId:c})),c||(c=p?.structureId),r||(r=Tt({drawDefinition:a}).appliedPolicies),!n){let I=p&&yh({provisionalPositioning:t,appliedPolicies:r,drawDefinition:a,seedingProfile:s,structure:p});I?.error&&h.push(I.error),n=I?.validSeedBlocks}return u=u??n?.length??0,Re(0,u).forEach(()=>{if(g<(u||0)){let I=Nye({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:a,seedingProfile:s,seedBlockInfo:o,participants:l,structureId:c,matchUpsMap:d,event:f});I?.success&&(g++,m.push(...I.seedPositions??[])),I.error&&h.push({seedPositionError:I.error})}}),h.length?{error:h}:{...H,seedPositions:m}}function Nye({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:r,seedingProfile:n,seedBlockInfo:a,participants:s,structureId:o,matchUpsMap:l,event:u}){let{unplacedSeedParticipantIds:c,unfilledPositions:d}=T7({provisionalPositioning:t,randomize:!0,drawDefinition:r,seedingProfile:n,seedBlockInfo:a,structureId:o}),{appliedPolicies:p}=Tt({drawDefinition:r}),{avoidance:f}=p??{};f&&s&&c?.length>2;let m=[];for(let h of c){let g=d.pop();if(!g)return{error:YI};m.push(g);let I=ol({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:r,seedingProfile:n,participantId:h,seedBlockInfo:a,drawPosition:g,matchUpsMap:l,structureId:o,event:u});if(!I.success)return I}return{...H,seedPositions:m}}function Aye({provisionalPositioning:t,drawDefinition:e,structure:i}){let{positionAssignments:r}=ur({structure:i}),{seedAssignments:n}=ds({provisionalPositioning:t,drawDefinition:e,structure:i}),a=Object.assign({},...(n||[]).filter(s=>s.participantId).map(s=>({[s.participantId]:s})));return r?.map(s=>a[s.participantId]?{...s,seedNumber:a[s.participantId].seedNumber,seedValue:a[s.participantId].seedValue}:"").filter(Boolean)}function kye({orderedSortedFirstRoundSeededDrawPositions:t,validSeedBlocks:e,byesToPlace:i}){let r=[];e.forEach(a=>Oye(a,i,r,t));let n=r.map(a=>Array.isArray(a)?Dn(a):a).flat(1/0);return GY(i)&&e.map(a=>a.seedNumbers[0]).includes(i)?t:n}function Oye(t,e,i,r){if(e-i.length>t.drawPositions.length)i.push(...t.drawPositions);else{let n=IO(yr(t.drawPositions,2));xye(n,i,r)}}function xye(t,e,i){let r,n=i[e.length];for(;r=JT(t,n);)e.push(r),n=i[e.length]}function JT(t,e){return Array.isArray(t)&&t.length!==2?t.pop():Array.isArray(t[0])?Lye(t,e):Fye(t,e)}function Fye(t,e){return t.includes(e)?t.indexOf(e)?t.pop():t.shift():Math.round(Math.random())?t.pop():t.shift()}function Lye(t,e){let i=t[0].flat(1/0).length,r=t[1].flat(1/0).length;if(i===r){let n=t[0].flat(1/0).includes(e)?t[0]:t[1];return JT(e?n:t[Math.round(Math.random())],e)}return i<r?JT(t[1],e):JT(t[0],e)}function IO(t){let e=Math.floor(t.length/2);return t.length>2?[IO(t.slice(0,e)),IO(t.slice(e))]:t}function _ye({provisionalPositioning:t,relevantMatchUps:e,appliedPolicies:i,drawDefinition:r,seedingProfile:n,seedBlockInfo:a,byesToPlace:s,structure:o}){a||(a=yh({provisionalPositioning:t,appliedPolicies:i,drawDefinition:r,seedingProfile:n,structure:o}));let{isFeedIn:l,isLuckyStructure:u,isContainer:c}=a,{validSeedBlocks:d}=a;i?.seeding?.containerByesIgnoreSeeding&&(d=[]);let p=Aye({provisionalPositioning:t,drawDefinition:r,structure:o})??[],f=rt([].concat(...e.map(y=>y.drawPositions))),m=p.filter(y=>f.includes(y.drawPosition)),h=(y,b)=>sI(y.seedValue)-sI(b.seedValue),g=d.reduce((y,b)=>{let S=m.filter(U=>b.drawPositions?.includes(U.drawPosition)).sort(h);return y.concat(...S)},[]).map(y=>y.drawPosition),I=kye({orderedSortedFirstRoundSeededDrawPositions:g,validSeedBlocks:d,byesToPlace:s}),v=qH({orderedSeedDrawPositions:g,relevantMatchUps:e}).slice(0,s),w=qH({orderedSeedDrawPositions:I,relevantMatchUps:e}).slice(0,s);return{strictSeedOrderByePositions:v,blockSeedOrderByePositions:w,isLuckyStructure:u,positionedSeeds:p,isContainer:c,isFeedIn:l}}function qH({orderedSeedDrawPositions:t,relevantMatchUps:e}){let i=e.map(r=>r.drawPositions).map(r=>r?.sort((n,a)=>n-a)).filter(r=>r?.[0]+1===r?.[1]);return t.map(r=>i.find(n=>n?.includes(r))).filter(Boolean).map(r=>r?.reduce((n,a)=>t.includes(a)?n:a,void 0)).filter(Boolean)}function $ye({provisionalPositioning:t,seedOrderByePositions:e,isLuckyStructure:i,appliedPolicies:r,drawDefinition:n,seedLimit:a,structure:s,isFeedIn:o}){let l=r?.seeding?.seedingProfile,u=s.stage===We,{positionAssignments:c}=ur({structure:s}),d=c?.filter(N=>N.participantId).map(N=>N.drawPosition),p={isCollectionMatchUp:!1},{matchUps:f,roundMatchUps:m}=Nt({provisionalPositioning:t,matchUpFilters:p,structure:s}),h=m?.[1]||[],g=s.structureType===fn?f:h,I=rt([].concat(...g.map(N=>N.drawPositions))),v=Math.min(...I)-1,w=d?.filter(N=>I.includes(N)),y=N=>{let A=Math.ceil(N.length/2),O=[N.slice(0,A),N.slice(A)],k=O.map(G=>[].concat(...G.flat(1/0)).length),F=Math.min(...k.flat(1/0)),x=Math.max(...k.flat(1/0)),L=k.indexOf(x),$=F!==x,V=Dn(O),[_,B]=!F||$?[O[L],O[1-L]]:[V[0],V[1]];return{greaterHalf:_,lesserHalf:B}},b=N=>{let{greaterHalf:A,lesserHalf:O}=y(N),{greaterHalf:k,lesserHalf:F}=y(A),x=Dn(k.flat(1/0)).pop(),L=k.flat().filter($=>$!==x);return{newlyFilteredChunks:[...O,...F,L],drawPosition:x}},S=N=>!e.includes(N),U=N=>!w?.includes(N),T=N=>{let A=yr(N.sort(ir),Math.ceil(N.length/4)).map(F=>F.filter(U)),O=[].concat(...A.flat(1/0)).length,k=[];for(let F=0;F<O;F++){let{newlyFilteredChunks:x,drawPosition:L}=b(A);k.push(L),A=x}return k},{validSeedBlocks:P}=yh({provisionalPositioning:t,allPositions:!0,appliedPolicies:r,drawDefinition:n,structure:s}),D=P?.map(N=>N.drawPositions?.map(A=>A+v)),E;if(o){let N=I.length,{seedBlocks:A}=bL({cluster:[eR,tR].includes(mS(l)),participantsCount:N});E=A.map(O=>O.map(k=>k+v)).map(T).filter(O=>O.length)}else u?E=D?.map(N=>N.filter(U)):E=D?.map(T).filter(N=>N.length);let R=g.map(N=>N.drawPositions).map(N=>N?.sort((A,O)=>A-O)).filter(N=>N?.[0]+1===N?.[1]),C=N=>R.reduce((A,O)=>O.includes(N)?O.reduce((k,F)=>F!==N?F:k,void 0):A,void 0),M=E.map(N=>N.map(C)).flat(1/0).filter(U).filter(S).filter(Boolean);if(u&&!s.structures){let N=a%4,A=M.slice(0,N),O=m[s.roundLimit]?.length,k=yr(M.slice(N),O).map(Dn).flat();M=A.concat(k)}return{unseededByePositions:M}}function Bye({provisionalPositioning:t,drawDefinition:e,matchUpsMap:i,structure:r,event:n}){let a={isCollectionMatchUp:!1},{matchUps:s,roundMatchUps:o}=Nt({afterRecoveryTimes:!1,provisionalPositioning:t,drawDefinition:e,matchUpFilters:a,matchUpsMap:i,structure:r,event:n}),l=o?.[1]||[],u=r?.structureType===fn,c=u?s:l,d=u?r?.structures?.length||0:s.length,{structureId:p,stage:f,stageSequence:m}=r,h=ch({entryStatuses:so,provisionalPositioning:t,drawDefinition:e,stageSequence:m,structureId:p,stage:f}),{qualifiersCount:g}=uv({provisionalPositioning:t,drawDefinition:e,stageSequence:m,structureId:p,stage:f}),I=h.length+g,{positionAssignments:v,unassignedPositions:w}=ur({structure:r}),y=w?.map(D=>D.drawPosition),b=v?.filter(D=>D.bye).length,S=v?.filter(D=>D.bye).map(D=>D.drawPosition),U=c.map(D=>D.drawPositions).filter(D=>D?.reduce((E,R)=>!S?.includes(R)&&E,!0)).flat(1/0).filter(D=>y?.includes(D)),T=v?.length,P=T?T-I:0;return P>d&&r.stageSequence===1&&r.stage!==Zr&&(P=d),{placedByes:b,byesCount:P,relevantMatchUps:c,placedByePositions:S,roundMatchUps:o,positionsToAvoidDoubleBye:U}}function V7({provisionalPositioning:t,tournamentRecord:e,appliedPolicies:i,drawDefinition:r,seedBlockInfo:n,seedingProfile:a,matchUpsMap:s,structureId:o,structure:l,seedLimit:u,seedsOnly:c,event:d}){l||({structure:l}=et({drawDefinition:r,structureId:o})),o||(o=l?.structureId);let p=!(l?.structures??l?.stage===We),{byesCount:f,placedByes:m,relevantMatchUps:h}=Bye({provisionalPositioning:t,drawDefinition:r,matchUpsMap:s,structure:l,event:d}),g=f-(m||0);if(g<=0)return{...H};let{strictSeedOrderByePositions:I,blockSeedOrderByePositions:v,isLuckyStructure:w,isFeedIn:y}=_ye({provisionalPositioning:t,relevantMatchUps:h,appliedPolicies:i,drawDefinition:r,seedingProfile:a,seedBlockInfo:n,byesToPlace:g,structure:l}),b=l?.structureType&&[fn,iR].includes(l.structureType)&&i?.seeding?.containerByesIgnoreSeeding,S=p&&v?.length?v:I,{unseededByePositions:U}=$ye({provisionalPositioning:t,seedOrderByePositions:S,isLuckyStructure:w,appliedPolicies:i,drawDefinition:r,seedLimit:u,structure:l,isFeedIn:y}),T=R=>R%2,P=(R,C)=>(R||[]).every(M=>T(M)?C!==M+1:C!==M-1),D=[].concat(...S);if(!c)for(;U.length;){let R=U.find(C=>P(D,C));R?(D.push(R),U=U.filter(C=>C!==R)):(D.push(...U),U=[])}b&&(D=Dn(D),ia({ignoreSeededByes:b})&&console.log({byePositions:D}));let E=D.slice(0,g);for(let R of E){let C=Wa({provisionalPositioning:t,tournamentRecord:e,drawDefinition:r,drawPosition:R,matchUpsMap:s,structureId:o,structure:l,event:d});if(C?.error)return C}return{...H,unseededByePositions:U,byeDrawPositions:E}}function cy(t,e){return e||zE(),z({result:t,stack:"automatedPositioning"})}function Vye(t,e){return e||zE(),t}function jye(t,e,i,r){let n=et({drawDefinition:e,structureId:i});if(n.error)return{error:n.error};let a=n.structure;if(!a)return{error:Ii};let s=t.appliedPolicies||Tt({drawDefinition:e,structure:a,event:r})?.appliedPolicies,{qualifiersCount:o}=uv({stageSequence:a.stageSequence,provisionalPositioning:t.provisionalPositioning,stage:a.stage,drawDefinition:e,structureId:i}),l=of,u=ch({stageSequence:a.stageSequence,provisionalPositioning:t.provisionalPositioning,stage:a.stage,placementGroup:t.placementGroup,drawDefinition:e,entryStatuses:l,structureId:i});return{structure:a,appliedPolicies:s,qualifiersCount:o,entries:u}}function Gye({placeByes:t,provisionalPositioning:e,tournamentRecord:i,appliedPolicies:r,drawDefinition:n,seedBlockInfo:a,matchUpsMap:s,structure:o,seedLimit:l,seedsOnly:u,event:c,structureSeedingProfile:d,seedingProfile:p,inContextDrawMatchUps:f,participants:m,positioningReport:h}){let g=t?V7({provisionalPositioning:e,tournamentRecord:i,appliedPolicies:r,drawDefinition:n,seedBlockInfo:a,matchUpsMap:s,structure:o,seedLimit:l,seedsOnly:u,event:c}):void 0;if(g?.error)return{error:g.error};let I=g?.unseededByePositions;return h.push({action:"positionByes",unseededByePositions:I}),g=B7({seedingProfile:d?{positioning:d}:p,provisionalPositioning:e,inContextDrawMatchUps:f,tournamentRecord:i,appliedPolicies:r,validSeedBlocks:a.validSeedBlocks,drawDefinition:n,seedBlockInfo:a,participants:m,matchUpsMap:s,structure:o,event:c}),g.error?{error:g.error}:(h.push({seedPositions:g.seedPositions,action:"positionSeedBlocks"}),{unseededByePositions:I})}function Hye({drawType:t,LUCKY_DRAW:e,structureSeedingProfile:i,seedingProfile:r,provisionalPositioning:n,inContextDrawMatchUps:a,tournamentRecord:s,appliedPolicies:o,validSeedBlocks:l,drawDefinition:u,seedBlockInfo:c,participants:d,matchUpsMap:p,structure:f,event:m,placeByes:h,seedLimit:g,seedsOnly:I,positioningReport:v}){let w;if(t!==e){let b=B7({seedingProfile:i?{positioning:i}:r,provisionalPositioning:n,inContextDrawMatchUps:a,tournamentRecord:s,appliedPolicies:o,validSeedBlocks:l,drawDefinition:u,seedBlockInfo:c,participants:d,matchUpsMap:p,structure:f,event:m});if(b.error)return{error:b.error};v.push({action:"positionSeedBlocks",seedPositions:b.seedPositions})}let y=h?V7({provisionalPositioning:n,tournamentRecord:s,appliedPolicies:o,drawDefinition:u,seedBlockInfo:c,matchUpsMap:p,structure:f,seedLimit:g,seedsOnly:I,event:m}):void 0;return y?.error?{error:y.error}:(w=y?.unseededByePositions,v.push({action:"positionByes",byeDrawPositions:y?.byeDrawPositions,unseededByePositions:w}),{unseededByePositions:w})}function Wye({seedsOnly:t,inContextDrawMatchUps:e,tournamentRecord:i,appliedPolicies:r,validSeedBlocks:n,drawDefinition:a,seedBlockInfo:s,participants:o,matchUpsMap:l,structure:u,positionQualifiers:c,positionUnseededParticipants:d,provisionalPositioning:p,unseededByePositions:f,multipleStructures:m,structureId:h,drawSize:g,event:I,positioningReport:v,conflicts:w}){if(t)return{};let y=c({inContextDrawMatchUps:e,tournamentRecord:i,appliedPolicies:r,validSeedBlocks:n,drawDefinition:a,seedBlockInfo:s,participants:o,matchUpsMap:l,structure:u});return y.error?{error:y.error}:(y.conflicts&&(w.qualifierConflicts=y.conflicts),v.push({action:"positionQualifiers",qualifierDrawPositions:y.qualifierDrawPositions}),y=d({provisionalPositioning:p,inContextDrawMatchUps:e,unseededByePositions:f,multipleStructures:m,tournamentRecord:i,drawDefinition:a,seedBlockInfo:s,participants:o,matchUpsMap:l,structureId:h,structure:u,drawSize:g,event:I}),y.error?{error:y.error}:(y.conflicts&&(w.unseededConflicts=y.conflicts),v.push({action:"positionUnseededParticipants"}),{}))}function hS(t){let{drawDefinition:e}=t,{applyPositioning:i=!0,provisionalPositioning:r,multipleStructures:n,placeByes:a=!0,tournamentRecord:s,seedingProfile:o,structureId:l,seedLimit:u,seedsOnly:c,drawType:d,drawSize:p,event:f}=t,m=[];i||(h4(),e=ke(e,!1,!0));let{structure:h,appliedPolicies:g,qualifiersCount:I,entries:v,error:w}=jye(t,e,l,f);if(w)return cy(w,i);if(!v?.length&&!I)return Vye({...H},i);let y=t.matchUpsMap??Ar({drawDefinition:e}),b=t.inContextDrawMatchUps??Qi({inContext:!0,drawDefinition:e,matchUpsMap:y})?.matchUps,S=yh({provisionalPositioning:r,appliedPolicies:g,drawDefinition:e,seedingProfile:o,structure:h});if(S.error)return cy(S,i);let{validSeedBlocks:U}=S;m.push({validSeedBlocks:U});let T=t.participants||(s?Ei({withIndividualParticipants:!0,convertExtensions:!0,tournamentRecord:s})?.participants:[]),P;if(mS(h.seedingProfile||o)===Tp){let C=Gye({placeByes:a,provisionalPositioning:r,tournamentRecord:s,appliedPolicies:g,drawDefinition:e,seedBlockInfo:S,matchUpsMap:y,structure:h,seedLimit:u,seedsOnly:c,event:f,structureSeedingProfile:h.seedingProfile,seedingProfile:o,inContextDrawMatchUps:b,participants:T,positioningReport:m});if(C?.error)return cy(C.error,i);P=C.unseededByePositions}else{let C=Hye({drawType:d,LUCKY_DRAW:tf,structureSeedingProfile:h.seedingProfile,seedingProfile:o,provisionalPositioning:r,inContextDrawMatchUps:b,tournamentRecord:s,appliedPolicies:g,validSeedBlocks:U,drawDefinition:e,seedBlockInfo:S,participants:T,matchUpsMap:y,structure:h,event:f,placeByes:a,seedLimit:u,seedsOnly:c,positioningReport:m});if(C?.error)return cy(C.error,i);P=C.unseededByePositions}let D={},E=Wye({seedsOnly:c,inContextDrawMatchUps:b,tournamentRecord:s,appliedPolicies:g,validSeedBlocks:U,drawDefinition:e,seedBlockInfo:S,participants:T,matchUpsMap:y,structure:h,positionQualifiers:Cye,positionUnseededParticipants:Eye,provisionalPositioning:r,unseededByePositions:P,multipleStructures:n,structureId:l,drawSize:p,event:f,positioningReport:m,conflicts:D});if(E?.error)return cy(E.error,i);let{positionAssignments:R}=Yt({drawDefinition:e,structure:h});return ti({drawDefinition:e,structureIds:[l]}),i||zE(),{positionAssignments:R,conflicts:D,...H,positioningReport:m}}function pv(t){let{applyPositioning:e=!0,provisionalPositioning:i,tournamentRecord:r,drawDefinition:n,seedingProfile:a,structureId:s,placeByes:o,seedsOnly:l}=t;if(!n)return{error:Oa};if(!uu({drawDefinition:n,structureId:s})&&!i)return{error:P1};let u=F7({drawDefinition:n,structureId:s}).playoffStructures?.sort((p,f)=>jD(p)-jD(f)),c=[],d=[];if(u)for(let p of u){let{structureId:f}=p,m=hS({structureId:f,provisionalPositioning:i,applyPositioning:e,tournamentRecord:r,drawDefinition:n,seedingProfile:a,placeByes:o,seedsOnly:l});if(m.error)return m;m.positionAssignments&&c.push({positionAssignments:m.positionAssignments,structureId:f}),m.positioningReport&&d.push(m.positioningReport)}return{...H,structurePositionAssignments:c,positioningReports:d}}function j7({validation:t=!0,tournamentRecord:e,drawDefinition:i,participantId:r,structureId:n,seedValue:a,event:s}){if(!i)return{error:_e};if(!n)return{error:Va};let o=(e?.participants??[]).find(p=>p.participantId===r);if(e&&!o)return{error:To};let{structure:l}=et({drawDefinition:i,structureId:n});if(!l)return{error:Ii};if(!(!t||Ni(a)||a===void 0||a===""||typeof a=="string"&&a.split("-").every(p=>Ni(p)&&Ye(p)>0)))return{error:ie};let{seedAssignments:u}=ds({drawDefinition:i,structure:l}),c=u?.map(p=>p.seedNumber),d=u?.find(p=>p.participantId===r);if(d){let p=typeof a=="string"?a.includes("-")&&a.split("-").map(f=>parseInt(f)).join("-")||parseInt(a)>0&&parseInt(a)||"":a&&a>0&&a||"";d.seedValue=p}else{let p={seedNumber:Math.max(0,...c||[])+1,participantId:r};a&&(p.seedValue=a),l.seedAssignments||(l.seedAssignments=[]),l.seedAssignments.push(p)}return sK({tournamentId:e?.tournamentId,eventId:s?.eventId,drawDefinition:i,structure:l}),{...H}}function CL({qualifyingParticipantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,structureId:n}){return PL({positionActionName:"qualifierDrawPositionAssignment",participantId:t,isQualifierPosition:!0,tournamentRecord:e,drawDefinition:i,drawPosition:r,structureId:n})}function Pb({targetRoundNumber:t,finishingPosition:e,drawDefinition:i,structureId:r,linkType:n}){let{links:a}=sv({drawDefinition:i,structureId:r})||{},s=(a?.target||[]).filter(({linkType:o})=>o===n).filter(({target:o})=>!t||t===o.roundNumber).map(o=>{let l=o.source.structureId,{structure:u}=et({structureId:l,drawDefinition:i});if(!(e&&u?.finishingPosition!==e))return o}).filter(Boolean);return{sourceStructureIds:s.map(({source:o})=>o.structureId),relevantLinks:s}}var zye=(t,e)=>{let i=[...new Set(e.slice(0,t.length))],r=[...i].sort((o,l)=>o-l),n=new Set,a=[];i.forEach(o=>{let l=t.indexOf(o);if(l!==-1&&!n.has(l))a.push(l),n.add(l);else{let u=r.indexOf(o),c=t.findIndex((d,p)=>!n.has(p));for(;n.has(c)&&c===-1&&n.size<t.length;)c=t.findIndex((d,p)=>!n.has(p)&&p>c);a.push(u),n.add(u)}});let s=t.filter((o,l)=>!n.has(l));return[...a,...s]};function G7({targetRoundNumber:t=1,tournamentRecord:e,drawDefinition:i,event:r,randomList:n}){let a=Ge({drawDefinition:i,event:r,tournamentRecord:e},[{[mn]:!0,[Ac]:!0,[mr]:!0}]);if(a.error)return a;let s=[],o=[],l=i.structures?.find(g=>g.stage===xe&&g.stageSequence===1);if(!l)return z({result:{error:A1}});let u=(Tt({tournamentRecord:e,drawDefinition:i,structure:l,event:r}).appliedPolicies??{})[Ep]?.requireCompletedStructures,{qualifierPositions:c,positionAssignments:d}=ur({structure:l});if(!c.length)return z({result:{error:$1}});let p=Re(0,c.length);n&&(p=zye(p,n));let f=d.map(g=>g.participantId).filter(Boolean),{relevantLinks:m}=Pb({structureId:l.structureId,targetRoundNumber:t,linkType:ru,drawDefinition:i})||{},{relevantLinks:h}=Pb({structureId:l.structureId,targetRoundNumber:t,linkType:iu,drawDefinition:i})||{};for(let g of m){let I=i.structures?.find(w=>w.structureId===g.source.structureId);if(I?.stage!==We)continue;let v=uu({structureId:g.source.structureId,drawDefinition:i});if(!u||v){let w=I.qualifyingRoundNumber,{matchUps:y}=Nt({matchUpFilters:{...w&&{roundNumbers:[w]},isCollectionMatchUp:!1,hasWinningSide:!0},afterRecoveryTimes:!1,inContext:!0,structure:I});for(let b of y){let S=b.matchUpStatus==="BYE"&&b.sides?.find(({participantId:T})=>T),U=b.sides.find(T=>T?.sideNumber===b.winningSide);if(U||S){let{participantId:T}=U||S||{};T&&!f.includes(T)&&o.push(T)}}}}for(let g of h){let I=i?.structures?.find(v=>v.structureId===g.source.structureId);if(I?.stage===We&&uu({structureId:g.source.structureId,drawDefinition:i})){let{positionAssignments:v}=Yt({structure:I}),w=v?.map(y=>{let b=y.participantId,S=mt({element:y,name:dc}).extension?.value;return S?{participantId:b,groupOrder:S?.groupOrder}:{}}).filter(({groupOrder:y,participantId:b})=>y===1&&!f.includes(b)).map(({participantId:y})=>y)??[];w&&o.push(...w)}}return o.length?(p.forEach((g,I)=>{let v=o[I],w=c[g].drawPosition;v&&CL({qualifyingParticipantId:v,structureId:l.structureId,drawPosition:w,tournamentRecord:e,drawDefinition:i})?.success&&s.push({participantId:v,drawPosition:w})}),z({result:Ve({...H,assignedParticipants:s})})):z({result:{error:L6}})}function H7({drawDefinition:t,orderMap:e}){return t?((typeof e!="object"||!Object.values(e).every(i=>ot(i)))&&z({result:{error:ie},context:{orderMap:e}}),t.structures||(t.structures=[]),t.structures.forEach(i=>{let r=e[i.structureId];r&&(i.structureOrder=r)}),t.structures.sort((i,r)=>Wg(i.structureOrder)-Wg(r.structureOrder)),{...H}):{error:_e}}function LR({drawDefinition:t}){let e=t.structures??[],i=t.links??[],r=new Map,n=g=>{let I=r.get(g)||r.set(g,{drawSources:[],drawTargets:[],progeny:[],sources:[],targets:[]})&&r.get(g);if(I&&!I?.stage){let v=e.find(w=>w.structureId===g);I.stage=v?.stage}return I},a={},s={},o=i.map(g=>{let I=g.source.structureId,v=g.target.structureId,w=n(I),y=n(v);return[Dp,Ms,rR,Tp].includes(g.target.feedProfile)?(w?.targets.push(v),y?.sources.push(I)):g.target.feedProfile===Cs&&(y?.drawSources.push(I),w?.drawTargets.push(v)),s[v]=s[v]||g.target.feedProfile===Cs,a[v]=rt([...a[v]||[],I]).filter(Boolean),[g.source.structureId,g.target.structureId]});for(let g of r.keys()){let I=r.get(g);if(I){let v=I.targets??[];for(;v.length;){let w=v.pop(),y=w&&r[w];y?.targets?.length?v.push(...y.targets):y&&(I.rootStage=y.stage)}if(I.rootStage||(I.rootStage=I.stage),!I.targets?.length){let w=I.sources??[];for(;w.length;){let y=w.pop(),b=y&&r[y];if(b?.sources?.length){for(let S of b.sources)I.progeny?.includes(S)||I.progeny?.push(S);w.push(...b.sources)}}}}}let l=0;for(let g of r.keys()){let I=r.get(g);if(I&&I.rootStage===We){let v=[I.drawTargets?.[0]],w=0;for(;v.length;){w+=1;let y=v.pop(),b=y?r.get(y):void 0;b?.drawTargets?.length&&v.push(b.drawTargets[0])}I.distanceFromMain=w,w>l&&(l=w)}}let u=o.length;Re(0,Math.ceil(u/2)).forEach(()=>{o=Re(0,u).map(g=>{let I=o[g],v=o.reduce((w,y)=>kn(I,y)?w.concat(...y):w,[])||[];return rt(I.concat(...v))})});let c=o[0],d=(g,I)=>xi(g,I).length===g.length,p=o.slice(1).reduce((g,I)=>g&&d(I,c),!0),f=[c].filter(Boolean),m=[c].filter(Boolean);e.forEach(g=>{let{structureId:I,stage:v}=g;f.find(w=>w.includes(I))||(f.push([I]),v!==Pr&&m.push([I]))});let h=p&&m.length===1;return!i?.length&&e.length===1&&n(e[0].structureId),{structureProfiles:Object.fromEntries(r),allStructuresLinked:h,maxQualifyingDepth:l,sourceStructureIds:a,hasDrawFeedProfile:s,structureGroups:f}}function W7({drawDefinition:t}){let{maxQualifyingDepth:e,structureProfiles:i}=LR({drawDefinition:t});for(let r of t.structures){let n=i[r.structureId];n.distanceFromMain&&(r.stageSequence=e+1-n.distanceFromMain)}return{...H}}function ML(t){let e=Ge(t,[{[mr]:!0,[mn]:!0}]);if(e.error)return e;let{tournamentRecord:i,drawDefinition:r,structure:n,link:a}=t;return qye({tournamentId:i.tournamentId,drawDefinition:r,structure:n,link:a})}function qye(t){let e=Ge(t,[{[mn]:!0,[uR]:!0},{link:!0,[zn]:Yn,[XY]:M1}]);if(e.error)return e;let{drawDefinition:i,tournamentId:r,structure:n,eventId:a,link:s}=t,o=s.target.structureId,l=et({drawDefinition:i,structureId:o});if(l.error)return z({stack:"attachQualifyingStructure",context:{targetStructureId:o},result:l});i.structures||(i.structures=[]),i.links||(i.links=[]),i.structures.push(n),i.links.push(s),W7({drawDefinition:i});let u=Nt({structure:n})?.matchUps||[];return hd({drawDefinition:i,tournamentId:r,matchUps:u,eventId:a}),ti({drawDefinition:i,structureIds:[n.structureId]}),{...H}}function z7({drawDefinition:t,structureDetails:e}){if(!Array.isArray(e))return{error:ie};if(!t)return{error:_e};let i=Object.assign({},...e.map(r=>{if(!bt(r))return;let{structureId:n,structureName:a}=r||{};if(!(!n||!a))return{[n]:a}}).filter(Boolean));if(!Object.values(i).length)return{error:Xe};for(let r of t.structures||[]){let n=i[r.structureId];if(n&&(r.structureName=n),r.structures)for(let a of r.structures){let s=i[a.structureId];s&&(a.structureName=s)}}return{...H}}function NL({drawDefinition:t,timeItem:e}){if(!t)return{error:Oa};if(!e)return{error:H1};let i=e&&Object.keys(e),r=["itemType","itemValue"];if(r.filter(a=>i.includes(a)).length!==r.length)return{error:G1};t.timeItems||(t.timeItems=[]);let n=new Date().toISOString();return Object.assign(e,{createdAt:n}),t.timeItems.push(e),Hw({drawDefinition:t}),{...H}}function q7(t){let{tournamentRecord:e,drawDefinition:i,structureId:r,event:n}=t,a=Ge(t,[{drawDefinition:!0,structureId:!0}]);if(a.error)return a;let s=i.structures??[],o=s.find(I=>I.structureId===r);if(!o)return{error:Ii};let l=s.find(({stage:I,stageSequence:v})=>I===xe&&v===1),u=r===l?.structureId,c=s.filter(({stage:I})=>I===We).map(ba("structureId"));if(u&&!c.length)return{error:QY};let d=c.includes(r),p=Yye({isQualifyingStructure:d,structure:o,...t});if(p?.error)return p;let{structureIdsToRemove:f,relatedStructureIdsMap:m}=Xye({qualifyingStructureIds:c,isQualifyingStructure:d,isMainStageSequence1:u,mainStageSequence1:l,drawDefinition:i,structureId:r}),{removedMatchUpIds:h,removedStructureIds:g}=Jye({relatedStructureIdsMap:m,qualifyingStructureIds:c,isMainStageSequence1:u,mainStageSequence1:l,drawDefinition:i,structureIdsToRemove:f,structureId:r});if(Kye({removedMatchUpIds:h,drawDefinition:i}),u){let I=(l.matchUps??[])?.map(ba("matchUpId"));h.push(...I),l.positionAssignments=[],l.seedAssignments=[],l.matchUps=[],l.extensions&&(l.extensions=[])}return d&&W7({drawDefinition:i}),Pu({tournamentId:e?.tournamentId,matchUpIds:h,action:"removeStructure",eventId:n?.eventId,drawDefinition:i}),ti({drawDefinition:i,eventId:n?.eventId}),{...H,removedMatchUpIds:h,removedStructureIds:g}}function Yye({isQualifyingStructure:t,tournamentRecord:e,drawDefinition:i,structureId:r,structure:n,event:a,force:s}){let o=[r];if(t){let l=c=>i.links?.find(d=>d.target.structureId===c),u=l(r)?.source.structureId;for(;u;)o.push(u),u=l(u)?.source.structureId}if(Qi({matchUpFilters:{structureIds:o},drawDefinition:i}).matchUps?.some(({score:l})=>cr({score:l}))){let l=Tt({tournamentRecord:e,drawDefinition:i,structure:n,event:a})?.appliedPolicies;if(!(s??l?.[Po]?.allowDeletionWithScoresPresent?.structures))return{error:Nw}}return{...H}}function Kye({removedMatchUpIds:t,drawDefinition:e}){let{matchUps:i}=Qi({drawDefinition:e});i?.forEach(r=>{r.winnerMatchUpId&&t.includes(r.winnerMatchUpId)&&delete r.winnerMatchUpId,r.loserMatchUpId&&t.includes(r.loserMatchUpId)&&delete r.loserMatchUpId})}function Xye({qualifyingStructureIds:t,isQualifyingStructure:e,isMainStageSequence1:i,mainStageSequence1:r,drawDefinition:n,structureId:a}){let s=(n.structures??[]).map(ba("structureId")),o=c=>n.links?.map(d=>d.source.structureId===c&&d.target.structureId!==r?.structureId&&d.target.structureId).filter(Boolean)??[],l=c=>n.links?.map(d=>t.includes(d.source.structureId)&&d.target.structureId===c&&d.source.structureId).filter(Boolean)??[],u=new Map;return s.forEach(c=>u.set(c,e?l(c):o(c))),{structureIdsToRemove:i?u.get(a):[a],relatedStructureIdsMap:u}}function Jye({relatedStructureIdsMap:t,qualifyingStructureIds:e,isMainStageSequence1:i,mainStageSequence1:r,drawDefinition:n,structureIdsToRemove:a,structureId:s}){let o=[],l=[];for(;a?.length;){let u=a.pop();l.push(...ebe({idBeingRemoved:u,drawDefinition:n}));let c=Zye({qualifyingStructureIds:e,isMainStageSequence1:i,idBeingRemoved:u,drawDefinition:n,structureId:s});o.push(...c.removedStructureIds);let d=Qye({relatedStructureIdsMap:t,mainStageSequence1:r,idBeingRemoved:u,structureId:s});d?.length&&a.push(...d)}return{removedMatchUpIds:l,removedStructureIds:o}}function Qye({idBeingRemoved:t,relatedStructureIdsMap:e,mainStageSequence1:i,structureId:r}){return t&&e.get(t)?.filter(n=>n!==i?.structureId||r===i.structureId)}function Zye({qualifyingStructureIds:t,isMainStageSequence1:e,idBeingRemoved:i,drawDefinition:r,structureId:n}){let a=[];return r.links=r.links?.filter(s=>s.source.structureId!==i&&s.target.structureId!==i)??[],(!e||e&&t.length||i!==n)&&(r.structures=(r.structures??[]).filter(s=>(i&&i===s.structureId&&a.push(i),s.structureId!==i))),{removedStructureIds:a}}function ebe({idBeingRemoved:t,drawDefinition:e}){let{structure:i}=et({structureId:t,drawDefinition:e}),r=Nt({structure:i}).matchUps;return EF(r)}function JD({stageSequence:t=1,drawDefinition:e,drawSize:i,stage:r}){if(!e)return{error:_e};if(!XF({drawDefinition:e,stage:r}))return{error:Zp};let n=eIe({drawDefinition:e,stage:r}),{qualifiersCount:a}=uv({drawDefinition:e,stageSequence:t,stage:r}),s=n+a;if(i<s)return{error:r6};let{entryProfile:o}=KF({attributes:[{[r]:{drawSize:i}}],drawDefinition:e});return ti({drawDefinition:e}),{...H,entryProfile:o}}function Y7({qualifiersCount:t=0,drawDefinition:e,stage:i}){return e?XF({drawDefinition:e,stage:i})?(KF({attributes:[{[i]:{qualifiersCount:t}}],drawDefinition:e}),ti({drawDefinition:e}),{...H}):{error:Zp}:{error:_e}}function tbe({drawDefinition:t,drawSize:e}){if(!t)return{error:_e};let i=JD({stage:Pr,stageSequence:1,drawDefinition:t,drawSize:e});return i.error?i:(ti({drawDefinition:t}),{...H})}function K7(t){return tbe(t)}function X7({tournamentRecord:t,drawDefinition:e,event:i,structureId:r}){if(!e)return{error:_e};let n=e.structures?.find(s=>s.stage===We&&s.structureId===r);if(!n)return{error:Ii};if(n.matchUps?.some(({matchUpStatus:s,score:o})=>cr({score:o})??Yi.includes(s)))return{error:Nw};let a=n.matchUps?.map(({matchUpId:s})=>s)||[];return n.positionAssignments=[],n.seedAssignments=[],n.matchUps=[],Pu({tournamentId:t?.tournamentId,action:"resetVoluntaryConsolationStructure",matchUpIds:a,drawDefinition:e}),ti({tournamentId:t?.tournamentId,eventId:i?.eventId,drawDefinition:e,structureIds:[n.structureId]}),{...H}}var ibe="qualifierDrawPositionAssignment",rbe="withdrawParticipantAtDrawPosition",nbe="alternateDrawPositionAssignment",abe="luckyLoserDrawPositionAssignment",YH="removeDrawPositionAssignment",J7="swapDrawPositionAssignments",sbe="modifyPairAssignment",obe="adHocPositionSwap",lbe="modifyParticipantOtherName",KH="assignDrawPosition",ube="removeSeededParticipant",cbe="assignDrawPositionBye",dbe="modifySeedAssignment",Q7="addPenalty",AL="MODIFY_PAIR",_R="QUALIFIER",kL="ALTERNATE",OL="WITHDRAW",Am="ASSIGN",vO="REMOVE",xL="LUCKY",QT="REMOVE_SEED",$R="SWAP",QD="NICKNAME",Fy="SEED_VALUE",oI="PENALTY",pbe={MODIFY_PAIR_ASSIGNMENT:AL,QUALIFYING_PARTICIPANT:_R,ALTERNATE_PARTICIPANT:kL,WITHDRAW_PARTICIPANT:OL,ASSIGN_PARTICIPANT:Am,LUCKY_PARTICIPANT:xL,REMOVE_ASSIGNMENT:vO,SWAP_PARTICIPANTS:$R,ADD_NICKNAME:QD,REMOVE_SEED:QT,ADD_PENALTY:oI,ASSIGN_BYE:"BYE",SEED_VALUE:Fy};function Z7({tournamentRecord:t,drawDefinition:e,drawPositions:i,structureId:r,event:n}){if(!e)return{error:_e};if(!r)return{error:Va};if(i?.length!==2)return{error:ie,drawPositions:i};let a=Ar({drawDefinition:e}),{matchUps:s}=Qi({inContext:!0,drawDefinition:e,matchUpsMap:a}),{structure:o}=et({drawDefinition:e,structureId:r});if(!o)return{error:Ii};let l=Tt({tournamentRecord:t,drawDefinition:e,event:n}).appliedPolicies??{},u;if(o.structureType===fn?u=hbe({inContextDrawMatchUps:s,tournamentRecord:t,drawDefinition:e,drawPositions:i,matchUpsMap:a,structure:o,event:n}):u=fbe({inContextDrawMatchUps:s,tournamentRecord:t,drawDefinition:e,drawPositions:i,matchUpsMap:a,structure:o,event:n}),u.error)return u;if(HF({structure:o,drawPositions:i}),Ww({appliedPolicies:l,drawDefinition:e,positionAction:{name:J7,drawPositions:i,structureId:r}}),pc({tournamentId:t?.tournamentId,drawDefinition:e,structure:o,event:n}),n.eventType===ya){let c=Nt({matchUpFilters:{matchUpTypes:[ka]},inContext:!0,structure:o}).matchUps.filter(p=>p.drawPositions?.some(f=>i.includes(f))),d=Nt({matchUpFilters:{matchUpTypes:[ka]},structure:o}).matchUps;c.forEach(p=>{(p.sides||[]).forEach(f=>{let m=f?.drawPosition;if(i.includes(m)){let h=f.participantId,g=d.find(({matchUpId:v})=>v===p.matchUpId),I=p?.sides?.reduce((v,w,y)=>w.drawPosition===m?y:v,void 0);UL({inContextTargetMatchUp:p,drawPositionSideIndex:I,teamParticipantId:h,tournamentRecord:t,drawDefinition:e,matchUp:g,event:n})}})})}return ti({drawDefinition:e,structureIds:[r]}),{...H}}function fbe({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPositions:r,matchUpsMap:n,structure:a,event:s}){let o=a?.positionAssignments.filter(u=>r?.includes(u.drawPosition));if(!o)return{error:ie,structure:a,info:"Missing positionAssignments"};if(o.filter(({bye:u})=>u).length===2)return{...H};if(o.filter(({qualifier:u})=>u).length===2)return{...H};let l=o.some(({qualifier:u})=>u);return o.some(({bye:u})=>u)&&!l?e8({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:o,matchUpsMap:n,structure:a,event:s}):mbe({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:o,matchUpsMap:n,structure:a,event:s})}function e8({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:r,matchUpsMap:n,structure:a,event:s}){let o=r.find(({bye:m})=>m),l=r.find(({participantId:m})=>m),u=o.drawPosition,{participantId:c,drawPosition:d}=l,{structureId:p}=a,f=Db({drawPosition:u,inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:p,matchUpsMap:n});return f.error||(f=Db({drawPosition:d,inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:p,matchUpsMap:n}),f.error)||(Wa({drawPosition:d,tournamentRecord:e,drawDefinition:i,structureId:p,matchUpsMap:n,event:s}),f=ol({drawPosition:u,inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:p,participantId:c,matchUpsMap:n,event:s}),f.error)?f:{...H}}function mbe({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:r,matchUpsMap:n,structure:a,event:s}){let o=Object.assign({},...r.map((l,u)=>{let{drawPosition:c}=l,d={...r[1-u],drawPosition:c};return{[c]:d}}));return a.positionAssignments=a.positionAssignments.map(l=>o[l.drawPosition]||l),DL({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,matchUpsMap:n,assignments:r,structure:a,event:s}),{...H}}function hbe({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPositions:r,matchUpsMap:n,structure:a,event:s}){let o=a.structures?.reduce((u,c)=>{let d=c?.positionAssignments.filter(p=>r?.includes(p.drawPosition));return d&&u.push(...d),u},[]);if(o.filter(({bye:u})=>u).length===2)return{...H};if(o.filter(({qualifier:u})=>u).length===2)return{...H};DL({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,matchUpsMap:n,assignments:o,structure:a,event:s});let l=o.some(({qualifier:u})=>u);if(o.some(({bye:u})=>u)&&!l)e8({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:o,matchUpsMap:n,structure:a,event:s});else{let u=ke(o,!1,!0);o.forEach((c,d)=>{let p=u[1-d].participantId;c.qualifier=u[1-d].qualifier,c.participantId=p})}return{...H}}function t8({tournamentRecord:t,drawDefinition:e,participantId:i,structureId:r}){let n="removeSeededParticipant";if(!t)return{error:Ie};if(!e)return{error:_e};let a=(e.structures??[]).find(s=>s.structureId===r);return a?!a.stage||![xe,We].includes(a.stage)||a.stage===xe&&a.stageSequence!==1?z({result:{error:Jp},stack:n}):a.seedAssignments?.find(s=>s.participantId===i)?{...H}:z({info:"participant not seeded",result:{error:_r},context:{participantId:i}}):z({result:{error:Ii},stack:n})}function gS({targetEntryRound:t=1,finishingPositions:e,sourceRoundNumber:i,sourceStructureId:r,targetStructureId:n,linkType:a=ru}){return!r||!n?{error:Va}:{link:Ve({linkType:a,source:{roundNumber:i,structureId:r,finishingPositions:e},target:{feedProfile:Cs,roundNumber:t,structureId:n}})}}function wh({matchUp:t,tieFormat:e,isMock:i,uuids:r}){let{collectionDefinitions:n}=e??{};return{tieMatchUps:(n??[]).map(a=>IS({matchUp:t,collectionDefinition:a,uuids:r,isMock:i})).filter(Boolean).flat()}}function IS({collectionPositionOffset:t=0,collectionDefinition:e,matchUpsLimit:i,matchUp:r,isMock:n,uuids:a}){let{matchUpCount:s,matchUpType:o,collectionId:l,processCodes:u}=e||{},c=i??s??0,d=p=>{if(!n&&!r?.isMock)return a?.pop()??Et();let f=e?.collectionId;return a?.pop()??`${r?.matchUpId}-${f}-TMU-${p+1}`};return Re(0,c).map(p=>{let f=t+p+1;return{sides:[{sideNumber:1},{sideNumber:2}],matchUpId:d(p),matchUpStatus:Fi,collectionPosition:f,collectionId:l,processCodes:u,matchUpType:o,isMock:n}})}function FL({roundPosition:t,roundNumber:e,idPrefix:i,uuids:r}){return i?`${i}-${e}-${t}`:r?.pop()||Et()}function ZD({includeMatchUpType:t,matchUpType:e,roundNumber:i,matchUps:r,idPrefix:n,isMock:a,uuids:s,nodes:o}){let l=0,u=[],c=1,d=i-1,p=o?.length;for(;l<(p||0);){let f=o?.[l],m=o?.[l+1];d&&(f.roundNumber=d),m&&d&&(m.roundNumber=d);let h=FL({roundPosition:c,roundNumber:i,idPrefix:n,uuids:s}),g={roundPosition:c,children:[f,m],matchUpId:h};u.push(g);let I={drawPositions:g.children.map(v=>v?.drawPosition).filter(Boolean),matchUpStatus:Fi,matchUpId:g.matchUpId,roundPosition:c,roundNumber:i};t&&e&&(I.matchUpType=e),a&&(I.isMock=!0),r.push(I),c++,l+=2}return{roundNodes:u,matchUps:r}}function ll({finishingPositionOffset:t,finishingPositionLimit:e,qualifyingRoundNumber:i,qualifyingPositions:r,matchUpType:n,roundLimit:a,idPrefix:s,drawSize:o,isMock:l,uuids:u}){if(isNaN(o)||o<2||r&&o<=r)return{matchUps:[],roundsCount:0};if(r&&(!Uo(o)||o%r)){let g=r;for(;g<o;)g=2*g;o=g}let c=r&&!(o%2)&&(!isNaN(r)||i&&!isNaN(i))&&(o/r===Math.round(o/r)||i&&o/i===Math.round(o/i));if(!Uo(o)&&!c)return{matchUps:[],roundsCount:0};let d=Re(1,o+1).map(g=>({drawPosition:g})),p,f=[],m=1;for({roundNodes:p,matchUps:f}=ZD({matchUpType:n,roundNumber:m,idPrefix:s,matchUps:f,isMock:l,nodes:d,uuids:u}),m++,a=a??i;p.length>1;)r&&p.length===r&&(a=m-1),{roundNodes:p,matchUps:f}=ZD({nodes:p,matchUpType:n,roundNumber:m,idPrefix:s,matchUps:f,isMock:l,uuids:u}),m++;let h=m-1;return f=aS({finishingPositionOffset:t,finishingPositionLimit:e,roundsCount:h,roundLimit:a,matchUps:f}),a?f=f.filter(g=>a&&(g.roundNumber??0)<=a):a=m-1,{drawSize:o,matchUps:f,roundsCount:h,roundLimit:a}}function gbe(t,e){return t.drawDefinition?t.drawSize&&!ot(t.drawSize)||t.participantsCount&&!ot(t.participantsCount)||t.qualifyingPositions&&!ot(t.qualifyingPositions)?z({result:{error:ie},stack:e}):t.drawSize?t.qualifyingPositions&&t.qualifyingPositions>=t.drawSize?z({result:{error:ie},context:{drawSize:t.drawSize,qualifyingPositions:t.qualifyingPositions},stack:e}):null:z({result:{error:Ew},context:{drawSize:t.drawSize},stack:e}):z({result:{error:_e},stack:e})}function Ibe(t,e,i){let{structureProfiles:r}=LR({drawDefinition:t});return r[e]||z({result:{error:Ii},context:{targetStructureId:e},stack:i})}function vbe(t){let{maxRoundNumber:e,structures:i,groupCount:r}=pS(t);return{qualifiersCount:r,roundLimit:e,structure:i[0],finishingPositions:[1]}}function ybe(t){let{drawSize:e,matchUps:i,roundLimit:r,roundsCount:n}=ll(t);r||(r=n);let a=ns({structureName:t.structureName,structureId:t.structureId,qualifyingRoundNumber:r,stage:We,matchUpFormat:t.matchUpFormat,stageSequence:t.stageSequence,matchUpType:t.matchUpType,roundLimit:r,matchUps:i});t.roundTarget&&xt({extension:{name:Tl,value:t.roundTarget},element:a});let s=i?.filter(o=>o.roundNumber===r)?.length??0;return{drawSize:e,structure:a,matchUps:i,roundLimit:r,qualifiersCount:s}}function LL(t){let e="generateQualifyingStructure",i=gbe(t,e);if(i)return i;let r=t.drawSize??T1(t.participantsCount),{hasExistingDrawDefinition:n,qualifyingRoundNumber:a,qualifyingPositions:s,targetStructureId:o,structureOptions:l,appliedPolicies:u,qualifyingOnly:c,drawDefinition:d,matchUpFormat:p,structureName:f,structureId:m,roundTarget:h,tieFormat:g,drawType:I,idPrefix:v,isMock:w,uuids:y}=t,b=Ibe(d,o,e);if(b?.error)return b;let S=d.matchUpType,U=1,T=h?`${h}-`:"",P=typeof b=="object"&&"stage"in b&&b.stage===We,D=u?.[lc]?.namingConventions?.pre??aIe[lc]?.namingConventions?.pre,E=P&&D?`${D}-`:"",R=f??(T?`${E}${Xr(We)} ${T}`:`${E}${Xr(We)}`),C,M,N,A,O;if(I===Ks){let x=vbe({structureName:f??R,structureId:m??y?.pop(),hasExistingDrawDefinition:n,stage:We,structureOptions:l,appliedPolicies:u,qualifyingOnly:c,stageSequence:U,matchUpType:S,roundTarget:h,tieFormat:g,idPrefix:v,drawSize:r,isMock:w,uuids:y});A=x.qualifiersCount,N=x.roundLimit,C=x.structure,O=x.finishingPositions}else{let x=ybe({qualifyingRoundNumber:a,qualifyingPositions:s,matchUpType:S,idPrefix:v,drawSize:r,isMock:w,uuids:y,structureName:f??R,structureId:m??y?.pop(),matchUpFormat:p,stageSequence:U,roundTarget:h});r=x.drawSize,C=x.structure,N=x.roundLimit,A=x.qualifiersCount}let k=I===Ks?iu:ru,F=C&&N&&gS({sourceStructureId:C.structureId,sourceRoundNumber:N,targetStructureId:o,finishingPositions:O,linkType:k})?.link;return g&&(M=Nt({structure:C})?.matchUps||[],M?.forEach(x=>{let{tieMatchUps:L}=wh({tieFormat:g,matchUp:x,isMock:w});Object.assign(x,{tieMatchUps:L,matchUpType:S})})),{qualifyingDrawPositionsCount:r,qualifiersCount:A,...H,structure:C,link:F}}function i8(t){if(!t.tournamentRecord)return{error:Ie};let e=bbe(t);return e.error,e}function bbe(t){if(!t.drawDefinition)return{error:_e};if(!t.targetStructureId)return{error:Va};let e=LL(t);if(e.error)return e;let{structure:i,link:r}=e;return!i||!r?{error:ie}:ML({tournamentRecord:t.tournamentRecord,drawDefinition:t.drawDefinition,structure:i,link:r})}function r8(t){let e=Ge(t,[{[mn]:!0,[sR]:!0,[Ul]:!0},{[oge]:!0,[Wr]:d=>Number.isInteger(d)&&d>0},{[Wr]:d=>Array.isArray(d)&&d.length===2&&d.every(ri),[Fa]:ga,participantIds:!0}]);if(e.error)return e;let{drawDefinition:i,structureId:r,tournamentRecord:n,event:a}=t,{structure:s}=et({drawDefinition:i,structureId:r});if(!s)return{error:Ii};if(!Vn({structure:s}))return{error:Jp};let o=d=>d.sides?.map(p=>p.participantId).some(p=>t.participantIds.includes(p)),l=d=>d.roundNumber===t.roundNumber,u=d=>!cr(d),c=(s?.matchUps??[]).filter(l).filter(u).filter(o);if(c.length!==2)return{error:ga};for(let d of c){let p=d?.sides?.find(f=>t.participantIds.includes(f?.participantId));if(p){let f=t.participantIds.find(m=>m!==p?.participantId);p.participantId=f,St({tournamentId:n?.tournamentId,eventId:a?.eventId,drawDefinition:i,matchUp:d})}}return ti({drawDefinition:i,structureIds:[r]}),{...H}}function wbe({includeMatchUpType:t,drawPosition:e,roundNumber:i,matchUpType:r,idPrefix:n,matchUps:a,isMock:s,uuids:o,nodes:l,fed:u}){let c=l.length,d=e?e-c:void 0,p=Re(0,c).map(h=>d?d+h:void 0),f=[];for(let h=0;h<c;h++){let g=p.shift(),I={drawPosition:g,fed:u+1,feed:!0},v=l[h];v.roundNumber=i-1;let w=FL({roundPosition:v.roundPosition,roundNumber:i,idPrefix:n,uuids:o}),y={roundPosition:v.roundPosition,drawPositions:[g],matchUpStatus:Fi,roundNumber:i,matchUpId:w};t&&(y.matchUpType=r),s&&(y.isMock=!0),a.push(y);let b={children:[v,I]};f.push(b)}let m=e?e-c:void 0;return{roundNodes:f,matchUps:a,drawPosition:m}}function vd(t){let e=t.drawSize,{feedRoundsProfile:i,feedRounds:r=0,skipRounds:n=0,baseDrawSize:a}=t,{linkFedFinishingRoundNumbers:s,finishingPositionOffset:o,linkFedRoundNumbers:l,feedsFromFinal:u,isConsolation:c,matchUpType:d,idPrefix:p,isMock:f,uuids:m,fmlc:h}=t;a=a??M(e);let g=Sbe({drawSize:a}),I=g.length,v=0;if(i?.length)v=i.reduce((N,A)=>N+A,0);else if(e){let N=e-a;i=g.filter(A=>A<=N?(N-=A,!0):!1),v=i.reduce((A,O)=>A+O,0),r=i.length}else n>=I?r=0:u&&(r=I-u,n=0),i=g.filter((N,A)=>u&&!r||r&&A>=n+r||A<n?0:N),v=i.reduce((N,A)=>N+A,0),r=i.length;let w=[...g,...i].sort((N,A)=>A-N),y=w.length,b=[...(l??[]).map(N=>N-1),...(s??[]).map(N=>y-N)].map(N=>w[N]).reduce((N,A)=>N+A,0);v=v-b;let S=0,U=[],T,P=1,D=Re(0,a).map((N,A)=>({drawPosition:A+1+v})),E=v+1;for(let N of g){if({roundNodes:T,matchUps:U}=ZD({matchUpType:d,roundNumber:P,idPrefix:p,matchUps:U,isMock:f,nodes:D,uuids:m}),P++,i.includes(N)){let A=va(i)[N],O=Re(0,A),k=y+1-P,F=s?.includes(k)??l?.includes(P);O.forEach(()=>{({roundNodes:T,matchUps:U,drawPosition:E}=wbe({drawPosition:!F&&E||void 0,nodes:T,matchUpType:d,roundNumber:P,idPrefix:p,matchUps:U,isMock:f,uuids:m,fed:S})),P++,S+=1})}D=T}y!==P-1&&console.log("ERROR");let R=a-v;U=aS({finishingPositionOffset:c?R:o,positionsFed:v,roundsCount:y,matchUps:U,fmlc:h});let C=T?.length?T[0]:T;return C&&(C.roundNumber=P-1,C.matchUps=U),{draw:C,matchUps:U,roundsCount:y};function M(N){let A=D1(N);return A>N?A/2:A}}function Sbe({drawSize:t}){let e=Math.ceil(Math.log(t)/Math.log(2));return Re(0,e).reverse().map(i=>Math.pow(2,i))}function _g(t){let{finishingPositionOffset:e=0,addNameBaseToAttributeName:i,playoffStructureNameBase:r,finishingPositionNaming:n,finishingPositionLimit:a,playoffAttributes:s,stageSequence:o=1,exitProfile:l="0",exitProfileLimit:u,roundOffsetLimit:c,roundOffset:d=0,drawDefinition:p,staggeredEntry:f,sequenceLimit:m,stage:h=xe,drawSize:g,idPrefix:I,isMock:v,uuids:w}=t;if(!(!s||!u||s?.[l])||g<2||m&&o>m)return{};let y=[],b=[],S=[],U=t.matchUpType??p?.matchUpType,T=e+1,P=e+g,D=`${T}-${P}`,E=s?.[l],R=r&&`${r} `||"",C=s?.[D]??n?.[D],M=t.structureName||C?.name||E?.name&&(i?`${R}${E?.name}`:E.name)||`${R}${D}`,N=C?.abbreviation??E?.abbreviation,A=t.structureId??E?.structureId??w?.pop(),O={idPrefix:I&&`${I}-${M}-RP`,finishingPositionOffset:e,matchUpType:U,drawSize:g,isMock:v,uuids:w},{matchUps:k}=f?vd(O):ll(O),F=ns({structureAbbreviation:N,stageSequence:o,structureName:M,matchUpType:U,roundOffset:d,structureId:A,matchUps:k,stage:h});y.push(...k),b.push(F);let x=Math.ceil(Math.log(g)/Math.log(2)),L=c?Math.min(c-d,x):(!a||T<a)&&x||0;return g>2&&Re(1,L+1).forEach(V=>$(V)),{structureId:F.structureId,matchUps:y,structureName:M,structures:b,links:S,...H};function $(V){let _=g/Math.pow(2,V);if(_<2)return;let B=g/Math.pow(2,V)+e;if(a&&B+1>a)return;let{structures:G,structureId:j,matchUps:K,links:Y}=_g({finishingPositionOffset:B,exitProfile:`${l}-${V}`,roundOffset:d+V,stageSequence:o+1,drawSize:_,addNameBaseToAttributeName:i,playoffStructureNameBase:r,finishingPositionNaming:n,finishingPositionLimit:a,playoffAttributes:s,exitProfileLimit:u,roundOffsetLimit:c,drawDefinition:p,sequenceLimit:m,matchUpType:U,idPrefix:I,uuids:w,stage:h});if(F.structureId&&j){let X={linkType:nu,source:{roundNumber:V,structureId:F.structureId},target:{roundNumber:1,feedProfile:Ms,structureId:j}};Y&&F&&Y.push(X),Y?.length&&S.push(...Y)}return G?.length&&b.push(...G),K?.length&&y.push(...K),{structureId:j,childLinks:Y,structures:b}}}function _L({drawDefinition:t,matchUpsMap:e,structureId:i}){let r=et({drawDefinition:t,structureId:i});if(r.error)return z({result:r});let{matchUps:n}=Nt({structure:r.structure,matchUpsMap:e});return{...bn({matchUps:n}),matchUps:n,matchUpsMap:e}}function XH({finishingPositions:t,drawDefinition:e,structureId:i}){let{roundProfile:r}=_L({drawDefinition:e,structureId:i});return(r&&Object.keys(r))?.reduce((n,a)=>(n8(r?.[a]).forEach(s=>{t.forEach(o=>{Ube({position:o,rangeDefinition:s})&&(n[o]={roundNumber:a})})}),n),{})}function Ube({position:t,rangeDefinition:e}){if(!Array.isArray(e)||e.reduce((n,a)=>n||isNaN(a),!1))return!1;let[i,r]=e;return Re(i,(r||i)+1).includes(t)}function n8(t){return[rt(t?.finishingPositionRange?.loser||[]),rt(t?.finishingPositionRange?.winner||[])]}function Tbe(t){return n8(t).map(e=>Re(e[0],e[1]&&e[1]+1||e[0]+1))}function fv({drawDefinition:t,structureIds:e,matchUpsMap:i}){if(e&&!Array.isArray(e))return{error:ie,context:{structureIds:e}};if(!t)return{error:_e};e=e??(t.structures??[]).filter(a=>a.stage!==We).map(({structureId:a})=>a);let r=e.map(a=>{let{roundProfile:s}=_L({drawDefinition:t,matchUpsMap:i,structureId:a});return(s&&Object.values(s))?.map(Tbe).flat()}).flat(),n=r.filter(a=>a?.length===1).sort(ir).flat();return{positionsNotPlayedOff:rt(r.flat()).filter(a=>!n.includes(a)),positionsPlayedOff:n}}function a8({excludeRoundNumbers:t=[],playoffPositions:e=[],drawDefinition:i,structureId:r}){if(!i)return{error:_e};if(!r)return{error:Va};if(!e)return{error:Xe,info:"missing playoffPositions"};let n=fv({drawDefinition:i});if(n.error)return n;let a=n.positionsPlayedOff,s=e.filter(I=>!a.includes(I)),o=XH({finishingPositions:s,drawDefinition:i,structureId:r}),l=Object.values(o).reduce((I,v)=>I.includes(v.roundNumber)?I:I.concat(v.roundNumber),[]).map(I=>Ye(I)).filter(I=>!t.includes(I)),u=XH({finishingPositions:a,drawDefinition:i,structureId:r}),c=u?Object.values(u):[],d=u?c.reduce((I,v)=>I.includes(v.roundNumber)?I:I.concat(v.roundNumber),[]).map(I=>Ye(I)):[],p=l.filter(I=>!d.includes(I)).sort(ir),{roundProfile:f}=_L({drawDefinition:i,structureId:r}),m=p.map(I=>{let v=f?.[I].finishingPositionRange.loser,[w,y]=v??[0,0];return Re(w,(y||w)+1)}).flat().sort(ir),{playoffRoundsRanges:h}=Dbe({playoffSourceRounds:p,roundProfile:f}),g=[...p,...d];return{playoffPositionsReturned:m,playedOffSourceRounds:d,playoffRoundsRanges:h,playoffSourceRounds:p,sourceRounds:g,roundProfile:f}}function Dbe({playoffSourceRounds:t,roundProfile:e}){return{playoffRoundsRanges:t.map(i=>{let r=e[i].finishingPositionRange.loser,[n,a]=r,s=Re(n,(a||n)+1);return{finishingPositionRange:r.join("-"),finishingPositions:s,roundNumber:i}})}}function vS({drawDefinition:t,structureId:e}){if(!t)return{error:_e};let{matchUps:i,matchUpsMap:r}=Rn({inContext:!0,drawDefinition:t}),{positionsNotPlayedOff:n,positionsPlayedOff:a}=fv({drawDefinition:t,matchUpsMap:r}),{structures:s}=Js({drawDefinition:t}),o=s.filter(u=>!e&&u.stage!==Pr||u.structureId===e),l={};for(let u of o){let c=u?.structureId,d=Pbe({playoffPositions:n,drawDefinition:t,structure:u,matchUps:i}),{error:p,...f}=d;if(p)return d;l[c]={structureId:c,...f}}return e?{positionsPlayedOff:a,...l[e]}:{availablePlayoffProfiles:Object.values(l),availablePlayoffRounds:Object.values(l),positionsPlayedOff:a}}function Pbe({playoffPositions:t,drawDefinition:e,structure:i,matchUps:r}){let n=i?.structureId,{links:a}=sv({drawDefinition:e,structureId:n});if(i.structureType===fn||i.structures){let f=Yt({structure:i})?.positionAssignments?.length,m=i.structures.length,h=(f??0)/m,g=a.source?.flatMap(({source:D})=>D?.finishingPositions||[])||[],I=Re(1,h+1).filter(D=>!g.includes(D)),v=r.find(D=>D.containerStructureId===n&&D.finishingPositionRange)?.finishingPositionRange?.winner||[0,1],w=a?.source.map(({target:D})=>D.structureId),{positionsPlayedOff:y=[],positionsNotPlayedOff:b=[]}=fv({structureIds:w,drawDefinition:e}),S=new Set([...y,...b]),U=Re(v[0],v[1]+1).filter(D=>!S.has(D)),T=yr(U,U.length/I.length),P=I.map((D,E)=>{let R=T[E],C=[Math.min(...R||[]),Math.max(...R||[])].join("-");return{finishingPosition:D,finishingPositions:R,finishingPositionRange:C}});return{positionsNotPlayedOff:U,playoffFinishingPositionRanges:P,finishingPositionsAvailable:I,finishingPositionsPlayedOff:g,positionsPlayedOff:y,groupCount:m,groupSize:h}}let s=a?.source?.filter(f=>f.linkCondition!==al).map(f=>f.source?.roundNumber)||[],o=a?.source?.filter(f=>f.linkCondition===al).map(f=>f.source?.roundNumber)||[],l=a8({excludeRoundNumbers:s,playoffPositions:t,drawDefinition:e,structureId:n}),u=l?.playoffSourceRounds?[...l?.playoffSourceRounds||[]]:void 0,c=[...l?.playoffRoundsRanges||[]],{roundProfile:d,error:p}=l;for(let f of o){let m=a?.source.find(w=>w.source.roundNumber===f),h=m?.target.roundNumber,g=m?.target.structureId,I=r.filter(({roundNumber:w,structureId:y})=>y===g&&w===h),v=I.filter(({sides:w})=>w.find(y=>y.participantFed&&!y.participantId)).length;if(u&&v===I.length){u.push(f);let w=d?.[f]?.finishingPositionRange?.loser;if(w){let y=Math.min(...w),b=y+v,S=Re(y,b),U={finishingPositionRange:[y,b-1].join("-"),finishingPositions:S,roundNumber:f};c.push(U)}}}return u&&u.sort(ir),c.sort((f,m)=>f.roundNumber-m.roundNumber),{playoffRounds:u,playoffRoundsRanges:c,error:p}}function Ebe({playoffGroups:t,drawDefinition:e,structureId:i}){if(!e)return{error:_e};if(!ri(i)||!Array.isArray(t))return{error:ie};let r=t.map(({finishingPositions:n})=>n).flat();return{positionRangeMap:vS({drawDefinition:e,structureId:i}).playoffFinishingPositionRanges?.filter(n=>r.includes(n.finishingPosition))?.reduce((n,a)=>(n[a.finishingPosition]=a,n),{})}}function s8(t){let{finishingPositionOffset:e=0,playoffAttributes:i,stageSequence:r=1,staggeredEntry:n,structureName:a,stage:s=xe,matchUpType:o,structureId:l,idPrefix:u,drawSize:c,isMock:d,uuids:p}=t,f={finishingPositionOffset:e,matchUpType:o,drawSize:c,idPrefix:u,isMock:d,uuids:p},{matchUps:m}=n?vd(f):ll(f),h=ns({structureName:a||i?.["0"]?.name||Xr(xe),structureId:l||p?.pop(),stageSequence:r,matchUpType:o,matchUps:m,stage:s}),g=[h],I=[];if(c>2){let v=c/2,{matchUps:w}=ll({finishingPositionOffset:e+v,idPrefix:u&&`${u}-c`,drawSize:v,matchUpType:o,isMock:d}),y=Xr(Zr),b=i?.["0-1"]?.name??t.consolationStructureName??(a?`${a} ${y}`:y),S=ns({structureName:b,matchUps:w,structureId:p?.pop(),stage:Zr,stageSequence:1,matchUpType:o});g.push(S);let U={linkType:nu,source:{roundNumber:1,structureId:h.structureId},target:{roundNumber:1,feedProfile:Ms,structureId:S.structureId}};I.push(U)}return{...H,structures:g,links:I}}function o8({consolationStructure:t,roundOffset:e=0,mainStructure:i,roundsCount:r,feedPolicy:n,fmlc:a}){let s=t.matchUps.reduce((u,c)=>(c.drawPositions||[]).filter(Boolean).length&&!u.includes(c.roundNumber)?u.concat(c.roundNumber):u,[]),o=n?.roundGroupedOrder||[],l=n?.roundFeedProfiles;return Re(1+e,r+1+e).map(u=>{let c=l?.[u-1]?l[u-1]:u%2&&Ms||Dp,d=u-e<=2?u-e:(u-e-2)*2+2,p={linkType:nu,source:{roundNumber:u,structureId:i.structureId},target:{feedProfile:c,roundNumber:d,structureId:t.structureId}},f=o[u-1];return f&&(p.target.groupedOrder=f),ia()&&(p.source.structureName=i.structureName,p.target.structureName=t.structureName),u===2&&a&&(p.linkCondition=al,p.target.feedProfile=Ms),s.includes(d)?p:void 0}).filter(Boolean)}function l8(t){let{playoffStructureNameBase:e,finishingPositionOffset:i,stageSequence:r=1,playoffAttributes:n,structureNameMap:a,staggeredEntry:s,stage:o=xe,matchUpType:l,structureId:u,drawSize:c,idPrefix:d,isMock:p,uuids:f}=t,m={finishingPositionOffset:i,matchUpType:l,drawSize:c,idPrefix:d,isMock:p,uuids:f},{matchUps:h,roundsCount:g}=s?vd(m):ll(m),I=t.structureName??n?.["0"]?.name??Xr(xe),v=od({structureId:u||f?.pop(),structureName:I,stageSequence:r,matchUpType:l,matchUps:h,stage:o}),w=[v],y=[];if(c>2){let b=[0,2].slice(0,c/16).map((S,U)=>{let T=U+1,{consolationStructure:P}=Rbe({idPrefix:d&&`${d}-c${U}`,structureId:f?.pop(),playoffStructureNameBase:e,playoffAttributes:n,structureNameMap:a,stageSequence:T,roundOffset:S,matchUpType:l,drawSize:c,isMock:p,index:U,uuids:f});w.push(P);let D=o8({consolationStructure:P,roundsCount:2,mainStructure:v,roundOffset:S});return{consolationStructure:P,links:D}}).map(S=>S.links).flat();if(y.push(...b),c>=4&&c<=16||c>32){let{matchUps:S}=ll({idPrefix:d&&`${d}-p3t4`,finishingPositionOffset:2,drawSize:2,matchUpType:l,isMock:p}),U=n?.["3-4"]?.name??Xr(Ui),T=a?.[U]||U,P=e?`${e} ${T}`:T,D=od({structureId:f?.pop(),matchUps:S,stageSequence:2,stage:Ui,structureName:P,matchUpType:l}),E={linkType:nu,source:{roundNumber:g-1,structureId:v.structureId},target:{structureId:D.structureId,feedProfile:Ms,roundNumber:1}};w.push(D),y.push(E)}}return{structures:w,links:y,...H}}function Rbe({playoffStructureNameBase:t,stageSequence:e=1,playoffAttributes:i,structureNameMap:r,roundOffset:n=0,matchUpType:a,structureId:s,idPrefix:o,drawSize:l,isMock:u,index:c,uuids:d}){let p=l/(2*Math.pow(2,n)),{matchUps:f,roundsCount:m}=vd({finishingPositionOffset:p,baseDrawSize:p,isConsolation:!0,feedRounds:1,matchUpType:a,idPrefix:o,isMock:u,uuids:d}),h=c===0&&i?.["0-1"]?.name||c===1&&i?.["0-3"]?.name||`${Xr(Zr)} ${c+1}`,g=r?.[h]||h,I=t?`${t} ${g}`:g;return{consolationStructure:od({matchUps:f,stage:Zr,structureName:I,stageSequence:e,matchUpType:a,structureId:s}),consolationRoundsCount:m}}function xf(t){let{finishingPositionOffset:e,stageSequence:i=1,playoffAttributes:r,feedsFromFinal:n,staggeredEntry:a,structureName:s,stage:o=xe,structureId:l,matchUpType:u,skipRounds:c,feedRounds:d,idPrefix:p,drawSize:f,isMock:m,uuids:h,fmlc:g}=t,I=t.feedPolicy||t.policyDefinitions?.[iI]||t.appliedPolicies?.[iI],v={finishingPositionOffset:e,matchUpType:u,skipRounds:c,drawSize:f,idPrefix:p,isMock:m,uuids:h},{matchUps:w}=a?vd(v):ll(v),y=ns({structureName:s||r?.["0"]?.name||Xr(xe),structureId:l||h?.pop(),stageSequence:i,matchUpType:u,matchUps:w,stage:o}),b=[y],S=[],U=f/2,{matchUps:T,roundsCount:P}=vd({finishingPositionOffset:U,idPrefix:p&&`${p}-c`,isConsolation:!0,feedsFromFinal:n,baseDrawSize:U,matchUpType:u,feedRounds:d,skipRounds:c,isMock:m,uuids:h,fmlc:g});if(f>2){let D=r?.["0-1"]?.name??Xr(Zr),E=t.playoffStructureNameBase?`${t.playoffStructureNameBase} ${D}`:D,R=ns({matchUps:T,structureId:h?.pop(),stage:Zr,stageSequence:1,structureName:E,matchUpType:u});b.push(R);let C=o8({consolationStructure:R,mainStructure:y,roundsCount:P,feedPolicy:I,fmlc:g});S.push(...C)}return{...H,structures:b,links:S}}function u8({requireSequential:t=!0,playoffMatchUpFormat:e,playoffAttributes:i,sourceStructureId:r,policyDefinitions:n,stageSequence:a,drawDefinition:s,playoffGroups:o,matchUpType:l,feedPolicy:u,groupCount:c,idPrefix:d,isMock:p,uuids:f}){u=u||n?.[iI];let m="processPlayoffGroups",h=0,g=[],I=[],v=[],{error:w,positionRangeMap:y}=Ebe({structureId:r,drawDefinition:s,playoffGroups:o});if(w)return z({result:{error:w},stack:m});if(!(!y||o?.every(b=>{let{finishingPositions:S=[]}=b;if(!S.length)return!1;let U=[...S].sort(ir).map((T,P)=>(S[P+1]||T)-T).every(T=>T<2);return(!t||U)&&S.every(T=>y[T])})))return z({context:{validFinishingPositions:Object.values(y)},result:{error:ie},stack:m});for(let b of o){let S=b.finishingPositions,U=y&&S.flatMap(N=>y[N]?.finishingPositions??[]),T=c*S.length,P=qI(T),D=P===2&&Yo||b.drawType||Yo;U&&(h=Math.min(...U)-1);let E=U&&`${Math.min(...U)}-${Math.max(...U)}`,R=b.structureName||E&&b.playoffAttributes?.[E]?.name||b.playoffAttributes?.["0"]?.name,C={addNameBaseToAttributeName:b.addNameBaseToAttributeName,playoffStructureNameBase:b.playoffStructureNameBase,finishingPositionNaming:b.finishingPositionNaming,finishingPositionLimit:b.finishingPositionLimit,structureId:b.structureId??f?.pop(),playoffAttributes:b.playoffAttributes,structureNameMap:b.structureNameMap,sequenceLimit:b.sequenceLimit,structureName:R,idPrefix:d&&`${d}-po`,appliedPolicies:n,finishingPositionOffset:h,stage:Ui,stageSequence:a,matchUpType:l,drawSize:P,isMock:p,uuids:f},M=({playoffStructures:N,playoffLinks:A})=>{let[O]=N,k=IT({playoffStructureId:O.structureId,finishingPositions:S,sourceStructureId:r});v.push(k,...A),I.push(...N),g.push({structureId:O.structureId,finishingPositions:S}),h+=T};if(D===Yo){let{matchUps:N}=ll({finishingPositionLimit:h+T,idPrefix:d&&`${d}-po`,finishingPositionOffset:h,matchUpType:l,drawSize:P,isMock:p,uuids:f}),A=ns({structureId:b.structureId??f?.pop(),matchUpFormat:e,stage:Ui,structureName:R,stageSequence:a,matchUps:N});I.push(A);let O=IT({playoffStructureId:A.structureId,finishingPositions:S,sourceStructureId:r});v.push(O),h+=T,g.push({structureId:A.structureId,finishingPositions:S})}else if([Qg,Zg,Ui].includes(D)){let N={playoffAttributes:b.playoffAttributes??i,playoffStructureNameBase:b.playoffStructureNameBase,structureId:b.structureId??f?.pop(),structureName:b.structureName,idPrefix:d&&`${d}-po`,addNameBaseToAttributeName:!0,finishingPositionOffset:h,stage:Ui,roundOffset:0,stageSequence:a,drawSize:P,isMock:p,uuids:f};D===Qg?Object.assign(N,{playoffAttributes:b?.playoffAttributes??i??dF,roundOffsetLimit:3}):D===Zg&&Object.assign(N,{playoffAttributes:b?.playoffAttributes??i??pF,roundOffsetLimit:2});let A=_g(N);if(A.error)return A;if(A.links?.length&&v.push(...A.links),A.structures?.length&&I.push(...A.structures),I.sort(uh),A.structureId){let O=IT({playoffStructureId:A.structureId,finishingPositions:S,sourceStructureId:r});v.push(O),g.push({structureId:A.structureId,finishingPositions:S})}h+=T}else if([eI,_w,Ib,gb,hb,vb].includes(D)){let N=[f?.pop(),f?.pop()],A={playoffStructureNameBase:b.playoffStructureNameBase,structureId:b.structureId??f?.pop(),playoffAttributes:b.playoffAttributes,idPrefix:d&&`${d}-po`,finishingPositionOffset:h,uuids:N,stage:Ui,structureName:R,matchUpType:l,feedPolicy:u,drawSize:P,isMock:p},O={[eI]:{fmlc:!0,feedRounds:1},[vb]:{feedRounds:1},[Ib]:{feedsFromFinal:3},[gb]:{feedsFromFinal:2},[hb]:{feedsFromFinal:1}};Object.assign(A,O[D]||{});let{structures:k,links:F}=xf(A),[x]=k,L=IT({playoffStructureId:x.structureId,finishingPositions:S,sourceStructureId:r});v.push(L,...F),I.push(...k),g.push({structureId:x.structureId,finishingPositions:S}),h+=T}else if([Ks].includes(D)){let{structures:N,links:A}=pS({...C,structureOptions:b.structureOptions||{groupSize:4}});M({playoffStructures:N,playoffLinks:A})}else if([Lw].includes(D)){let{structures:N,links:A}=s8(C);M({playoffStructures:N,playoffLinks:A})}else if([tge].includes(D)){let{structures:N,links:A}=l8(C);M({playoffStructures:N,playoffLinks:A})}else if([ra].includes(D)){let N=ns({structureId:b.structureId??f?.pop(),structureName:b.structureName,finishingPosition:zT,stage:Ui,stageSequence:a,matchUps:[]});M({playoffStructures:[N],playoffLinks:[]})}}return{finishingPositionTargets:g,positionRangeMap:y,structures:I,links:v}}function IT({playoffStructureId:t,finishingPositions:e,sourceStructureId:i}){return{linkType:iu,source:{structureId:i,finishingPositions:e},target:{structureId:t,feedProfile:Cs,roundNumber:1}}}function Cbe(t){let e="generateAndPopulateRRplayoffStructures";if(!t.playoffGroups)return z({result:{error:Xe},info:"playoffGroups required",stack:e});let{sourceStructureId:i,requireSequential:r,tournamentRecord:n,drawDefinition:a,playoffGroups:s,groupCount:o,groupSize:l,event:u}=t,c=u8({requireSequential:r,sourceStructureId:i,playoffGroups:s,groupCount:o,...t});if(c.error)return z({result:c,stack:e});let{structures:d=[],links:p=[],finishingPositionTargets:f,positionRangeMap:m}=c,h=f?.flatMap(({finishingPositions:T})=>T).flatMap(T=>m[T].finishingPositions);a.structures.push(...d),a.links.push(...p);let{matchUps:g,matchUpsMap:I}=Qi({inContext:!0,drawDefinition:a}),v=new Set(d.map(({structureId:T})=>T)),w=g?.filter(({structureId:T})=>v.has(T)).map(Ir),y=I?.drawMatchUps?.filter(({matchUpId:T})=>w?.includes(T));if(y?.length){let T=vn({drawDefinition:a,event:u})?.tieFormat;T&&y.forEach(P=>{let{tieMatchUps:D}=wh({isMock:t.isMock,tieFormat:T,matchUp:P});Object.assign(P,{tieMatchUps:D,matchUpType:ka})})}let{positionAssignments:b}=Yt({structureId:i,drawDefinition:a}),S={};b?.forEach(T=>{let P=mt({element:T,name:dc})?.extension?.value?.groupOrder;P&&(S[P]||(S[P]=[]),S[P].push(T.participantId))});let U=pv({provisionalPositioning:t.provisionalPositioning,structureId:i,applyPositioning:!0,event:t.event,tournamentRecord:n,drawDefinition:a});return U.error&&U.error?.code!==P1.code?z({result:U,stack:e}):{structures:d,links:p,positionsPlayedOff:h,drawDefinition:a,...H}}function $L({positionAssignments:t,tournamentRecord:e,drawDefinition:i,matchUpFormat:r,matchUps:n,event:a}){if(!Ga(n))return{error:ie};if(!t)return{error:ie};let{policyDefinitions:s}=xc({policyTypes:[SF],tournamentRecord:e,drawDefinition:i,event:a}),{subOrderMap:o}=cL({positionAssignments:t}),l=n.length?gh({policyDefinitions:s,matchUpFormat:r,subOrderMap:o,matchUps:n}):void 0;if(l?.error)return l;let{participantResults:u={},bracketComplete:c,report:d}=l??{},p=Object.keys(u);return t.forEach(f=>{let{participantId:m}=f;if(p.includes(m)){let h={value:u[m],name:dc};xt({element:f,extension:h}),u[m].ties||En({element:f,name:rI})}else En({element:f,name:dc}),En({element:f,name:rI})}),ti({drawDefinition:i}),{...H,participantResults:u,bracketComplete:c,report:d}}function c8({matchUps:t,matchUpId:e}){return{matchUp:(t||[]).find(i=>i.matchUpId===e)}}function di(t){let e=Ge(t,[{[mn]:!0,[Ul]:!0}]);if(e.error)return e;let{tournamentParticipants:i,afterRecoveryTimes:r,contextProfile:n,drawDefinition:a,matchUpsMap:s,matchUpId:o,inContext:l,context:u,event:c}=t,{structures:d=[]}=Js({drawDefinition:a}),p=t.contextContent||n&&Fc({contextProfile:n,drawDefinition:a});for(let f of d){let{matchUps:m}=Nt({tournamentParticipants:i,afterRecoveryTimes:r,contextContent:p,drawDefinition:a,contextProfile:n,matchUpsMap:s,inContext:l,structure:f,context:u,event:c}),{matchUp:h}=c8({matchUps:m,matchUpId:o});if(h)return{matchUp:h,structure:f}}return{error:un}}function BR(t){return!bt(t)||!t.notes?{error:Xe}:bt(t.element)?!ri(t.notes)&&!t.notes?.testing?{error:ie}:(Object.assign(t.element,{notes:t.notes}),{...H}):{error:ie}}function BL(t){return bt(t)?bt(t.element)?(t.element.notes&&delete t.element.notes,{...H}):{error:ie}:{error:Xe}}var VR={matchUpStatus:Fi,matchUpStatusCodes:[],score:{scoreStringSide1:"",scoreStringSide2:"",sets:void 0},matchUpFormat:void 0,winningSide:void 0};function yo(t){let e="modifyMatchUpScore",i=t.matchUpFormat,r=t.matchUp,n,{matchUpStatusCodes:a,tournamentRecord:s,drawDefinition:o,matchUpStatus:l,removeScore:u,winningSide:c,matchUpId:d,event:p,notes:f,score:m}=t,h=t.appliedPolicies&&Object.keys(t.appliedPolicies).length?t.appliedPolicies:Tt({policyTypes:[Po],tournamentRecord:s,drawDefinition:o,structure:n,event:p})?.appliedPolicies,g=r.matchUpType===Zt;if(g&&o){if(d&&r.matchUpId!==d){let U=di({drawDefinition:o,matchUpId:d,event:p});if(!U.matchUp)return{error:un};({matchUp:r,structure:n}=U)}}else r.matchUpId!==d&&console.log("!!!!!");l&&[mi,wi].includes(l)||u?Object.assign(r,{...VR}):m&&(r.score=m);let I=l&&r?.matchUpStatus===Qt&&l!==Qt;l&&(r.matchUpStatus=l),i&&(r.matchUpFormat=i),a&&(r.matchUpStatusCodes=a),c&&(r.winningSide=c),t.removeWinningSide&&(r.winningSide=void 0),!n&&o&&({structure:n}=di({drawDefinition:o,matchUpId:d,event:p})),l&&!r.winningSide&&cr(r)&&!Yi.includes(l)&&![lh,_d,cs].includes(l)&&(r.matchUpStatus=ao);let v;if((I&&r?.processCodes?.length||l===Qt)&&(v=h?.[Po]?.processCodes?.incompleteAssignmentsOnDefault),!r.collectionId){let U=n?.structureType===fn,T=Vn({structure:n});if(JF({drawDefinition:o,structure:n})||T||U){let P=R=>{i=g?"SET1-S:T100":i??r.matchUpFormat??R?.matchUpFormat??o?.matchUpFormat??p?.matchUpFormat;let C=g?{matchUpTypes:[Zt]}:void 0,{matchUps:M}=Nt({afterRecoveryTimes:!1,tournamentRecord:s,inContext:!0,matchUpFilters:C,drawDefinition:o,structure:R,event:p});return T&&(R.positionAssignments=rt(M.flatMap(N=>(N.sides??[]).map(A=>A.participantId)).filter(Boolean)).map(N=>({participantId:N}))),$L({positionAssignments:R.positionAssignments,tournamentRecord:s,drawDefinition:o,matchUpFormat:i,matchUps:M,event:p})},D=U&&n.structures.find(R=>R?.matchUps.find(C=>C.matchUpId===d)),E=P(D||n);if(E.error)return z({result:E,stack:e})}}if(f){let U=BR({element:r,notes:f});if(U.error)return z({result:U,stack:e})}let w=s?.tournamentId,y=gs().topics.includes(vR),b=(y||v)&&Ar({drawDefinition:o}),S=b&&Qi({matchUpFilters:{matchUpIds:[d]},nextMatchUps:!0,tournamentRecord:s,inContext:!0,drawDefinition:o,matchUpsMap:b}).matchUps?.[0];if(y&&S&&Bge({tournamentId:w,inContextMatchUp:S}),Array.isArray(v)&&S&&!S.sides?.every(({participantId:U})=>U))if(l===Qt)r.processCodes=rt([...r.processCodes??[],...v]);else for(let U of v||[]){let T=U&&r?.processCodes?.lastIndexOf(U);r?.processCodes?.splice(T,1)}return St({eventId:p?.eventId,context:e,drawDefinition:o,tournamentId:w,matchUp:r}),{...H}}function VL(t){let{propagateExitStatus:e,matchUpStatusCodes:i,autoCalcDisabled:r,inContextMatchUp:n,matchUpStatus:a,dualMatchUp:s,structure:o,matchUp:l}=t,u=sS({matchUpStatus:a})||[kc,us].includes(a)&&s||r,c=l?.sides?.map(h=>h.participantId).filter(Boolean).length||n?.sides?.map(h=>h.participantId).filter(Boolean).length,d="attemptToModifyScore";if(!(Vn({structure:o})&&c===1||a===Qt&&c||Mbe({structure:o,matchUp:l,inContextMatchUp:n})||t.appliedPolicies?.[Po]?.requireParticipantsForScoring===!1||Fr(a)&&c===1&&e))return z({result:{error:k1},stack:d});let p=[mi].includes(a),f=u?a:t.winningSide&&ki||cs,m=yo({...t,winningSide:t.winningSide,matchUpStatusCodes:u&&i||[],matchUpStatus:f,removeScore:p});return z({result:m,stack:d})}function Mbe({structure:t,matchUp:e,inContextMatchUp:i}){let{drawPositions:r}=e,{positionAssignments:n}=ur({structure:t}),a=n?.filter(o=>r?.includes(o.drawPosition)&&o.participantId),s=i?.sides?.every(o=>o.participantId);return a?.length===2||s}function d8({collectionGroups:t=[]}){let e=Object.assign({},...t.filter(r=>ot(r?.groupValue)&&r?.groupNumber).map(r=>({[r.groupNumber]:{...r,allGroupMatchUpsCompleted:!0,matchUpsCount:0,sideWins:[0,0],values:[0,0]}}))),i=Object.keys(e).map(r=>Ye(r));return{groupValueGroups:e,groupValueNumbers:i}}function Nbe({collectionDefinition:t,groupValueNumbers:e,groupValueGroups:i,sideTieValues:r,tieMatchUps:n}){let a=n.filter(v=>v.collectionId===t.collectionId),s=[0,0],o=[0,0],l=a.every(v=>Yi.includes(v.matchUpStatus)),{collectionValueProfiles:u,collectionGroupNumber:c,collectionValue:d,matchUpValue:p,winCriteria:f,scoreValue:m,setValue:h}=t,g=c&&e.includes(c),I=[0,0];if(a.forEach(v=>{v.winningSide&&(I[v.winningSide-1]+=1)}),ot(p)?a.forEach(v=>{v.winningSide&&(s[v.winningSide-1]+=p)}):ot(h)?a.forEach(v=>{v.score?.sets?.forEach(w=>{w.winningSide&&(s[w.winningSide-1]+=h)})}):ot(m)?a.forEach(v=>{v.score?.sets?.forEach(w=>{let{side1TiebreakScore:y=0,side2TiebreakScore:b=0,side1Score:S=0,side2Score:U=0}=w;(v.matchUpStatus===ki||v.winningSide||w.winningSide)&&(S||U?(s[0]+=S,s[1]+=U):(y||b)&&w.winningSide&&(s[w.winningSide-1]+=1))})}):Array.isArray(u)&&a.forEach(v=>{if(v.winningSide){let w=v.collectionPosition,y=Abe({collectionDefinition:t,collectionPosition:w});ot(y)&&(s[v.winningSide-1]+=y)}}),ot(d)){let v;if(f?.aggregateValue)l&&(ot(p||h||m)&&s[0]!==s[1]?v=s[0]>s[1]?1:2:I[0]!==I[1]&&(v=I[0]>I[1]?1:2));else if(f?.valueGoal)v=s.reduce((w,y,b)=>y>=f.valueGoal?b+1:w,0);else{let w=Math.floor(t.matchUpCount/2)+1;v=I.reduce((y,b,S)=>b>=w?S+1:y,0)}v&&(g?i[c].values[v-1]+=d:o[v-1]+=d)}else g?(i[c].values[0]+=s[0]||0,i[c].values[1]+=s[1]||0):o=s;g?(i[c].sideWins[0]+=I[0]||0,i[c].sideWins[1]+=I[1]||0,i[c].allGroupMatchUpsCompleted=i[c].allGroupMatchUpsCompleted&&l,i[c].matchUpsCount+=a.length):o.forEach((v,w)=>r[w]+=v||0)}function Abe({collectionDefinition:t,collectionPosition:e}){return(t.collectionValueProfiles||[])?.find(i=>i.collectionPosition===e)?.matchUpValue}function yS(t){let{sideAdjustments:e=[0,0],separator:i="-",drawDefinition:r,matchUpsMap:n,structure:a,matchUp:s,event:o}=t;if(!Array.isArray(e)||e.length!==2||Number.isNaN(e.reduce((y,b)=>y+b)))return{error:ie};if(!s)return{error:ea};let l=vn({matchUp:s,drawDefinition:r,structure:a,event:o})?.tieFormat||t?.tieFormat;if(!l)return{error:XI};let u=Bn({tieFormat:l});if(u.error)return u;let c=l?.collectionDefinitions||[],d=s?.tieMatchUps??[],p=[0,0],{groupValueGroups:f,groupValueNumbers:m}=d8(l);for(let y of c)Nbe({collectionDefinition:y,groupValueNumbers:m,groupValueGroups:f,sideTieValues:p,tieMatchUps:d});for(let y of m){let b=f[y],{allGroupMatchUpsCompleted:S,matchUpCount:U,winCriteria:T,groupValue:P,sideWins:D,values:E}=b,R;if(T?.aggregateValue)S&&E[0]!==E[1]&&(R=E[0]>E[1]?1:2);else if(T?.valueGoal)R=E.reduce((C,M,N)=>M>=T.valueGoal?N+1:C,void 0);else{let C=Math.floor(U/2)+1;R=D.reduce((M,N,A)=>N>=C?A+1:M,void 0)}R&&(p[R-1]+=P||0)}let h=p.map((y,b)=>(y||0)+e[b]),g={side1Score:h[0],side2Score:h[1],winningSide:void 0},I=h.join(i),v=h.slice().reverse().join(i),w;if(l?.winCriteria){let{valueGoal:y,aggregateValue:b,tallyDirectives:S}=l.winCriteria;if(y?w=h.map((U,T)=>({sideNumber:T+1,points:U})).find(({points:U})=>U>=y)?.sideNumber:b&&d.every(U=>U.matchUpStatus&&Yi.includes(U.matchUpStatus)||U.winningSide)&&h[0]!==h[1]&&(w=h[0]>h[1]?1:2),!w&&S){let U=s.matchUpId,T=s.hasContext?s:n?.drawMatchUps?.[U]||r&&di({inContext:!0,drawDefinition:r,matchUpId:U})?.matchUp;if(T){let{completedTieMatchUps:P,order:D}=gh({matchUps:[T]});if(P&&D?.length){let E=D[0].participantId;w=T.sides.find(({participantId:R})=>R===E)?.sideNumber}}}}return w&&(g.winningSide=w),{scoreStringSide1:I,scoreStringSide2:v,winningSide:w,set:g}}function bS({inContextDualMatchUp:t,drawDefinition:e,tournamentId:i,dualMatchUp:r,eventId:n}){if(r){t||(t=di({matchUpId:r.matchUpId,inContext:!0,drawDefinition:e})?.matchUp);let{extension:a}=mt({element:e,name:uc}),s=ke(a?.value||{},!1,!0),o=({displaySideNumber:l,drawPosition:u,sideNumber:c})=>({drawPosition:u,sideNumber:c,displaySideNumber:l});r.sides=t?.sides?.map(l=>{let u=l.participantId,c=u&&s[u]||void 0,{lineUp:d,...p}=r.sides?.find(({sideNumber:m})=>m===l.sideNumber)??{},f=d?.length?d:c;return{...o(l),...p,lineUp:f}}),St({context:"ensureSidLineUps",matchUp:r,drawDefinition:e,tournamentId:i,eventId:n})}}function jr(t){if(t)return ke(t,!1,!0)}function jL(t){let e=Ge(t,[{[cn]:!0}]);return e.error?e:Object.keys(t.tournamentRecords).reduce((i,r)=>{i.tournamentIdMap[r]=[];let n=t.tournamentRecords[r].events??[],a=n.map(({eventId:o})=>o),s=n.map(o=>(o.drawDefinitions??[]).map(({drawId:l})=>l)).flat();return i.tournamentIdMap[r].push(...a,...s),i.eventIds.push(...a),i.drawIds.push(...s),i},{eventIds:[],drawIds:[],tournamentIdMap:{}})}function p8({tournamentRecords:t,eventId:e,drawId:i}){let{tournamentIdMap:r}=jL({tournamentRecords:t});return(r?Object.keys(r):[]).find(n=>e&&r?.[n].includes(e)||i&&r?.[n].includes(i))}function Lc(t){let{exitWhenNoValues:e,drawDefinition:i,matchUpStatus:r,removeScore:n,matchUpsMap:a,matchUpId:s,event:o}=t,l=t.tournamentRecords||t.tournamentRecord&&{[t.tournamentRecord?.tournamentId]:t.tournamentRecord}||{},u=t.tournamentId||t.tournamentRecord?.tournamentId;l&&p8({tournamentRecords:l,...t});let c=u&&l[u];if(!c)return{error:Ie};let d=di({drawDefinition:i,event:o,matchUpId:s});if(d.error)return d;if(!d.matchUp)return{error:un};let{matchUp:p,structure:f}=d;if(!p.tieMatchUps)return{error:ta};bS({tournamentId:c?.tournamentId,eventId:o?.eventId,dualMatchUp:p,drawDefinition:i});let{extension:m}=mt({name:Rm,element:p});if(m?.value)if(n)En({element:p,name:Rm});else return{...H,score:p.score};let h=vn({drawDefinition:i,structure:f,matchUp:p,event:o})?.tieFormat;p.tieFormat=jr(h);let g=yS({drawDefinition:i,matchUpsMap:a,structure:f,matchUp:p,event:o}),{winningSide:I,set:v,scoreStringSide1:w,scoreStringSide2:y}=g,b=v?.side1Score||v?.side2Score;if(e&&!p.score&&!b)return{...H};let S={scoreStringSide1:w,scoreStringSide2:y,sets:v?[v]:[]},U=I&&[1,2].includes(I),T=U&&ki||nL({matchUpStatus:r??p.matchUpStatus,tieMatchUps:p.tieMatchUps,winningSide:p.winningSide,score:S})&&ao||Fi,P=!!(p.winningSide&&!U),D=p.tieMatchUps.find(({score:R,winningSide:C,matchUpStatus:M})=>R?.sets?.length&&(R.sets[0].side1Score||R.sets[0].side2Score)||M&&Yi.includes(M)||C),E;if(p.tieFormat&&!U&&!D){let R=vn({drawDefinition:i,structure:f,event:o})?.tieFormat;R&&JSON.stringify(h)===JSON.stringify(R)&&(p.tieFormatId=void 0,p.tieFormat=void 0,E=!0)}return yo({appliedPolicies:t.appliedPolicies,matchUpStatus:T,score:S,removeWinningSide:P,tournamentRecord:c,drawDefinition:i,removeScore:n,winningSide:I,matchUpId:s,matchUp:p,event:o}),{...H,score:S,removeWinningSide:P,tieFormatRemoved:E,winningSide:I}}function kbe({winnerMatchUpDrawPositionIndex:t,inContextDrawMatchUps:e,projectedWinningSide:i,sourceMatchUpStatus:r,winningDrawPosition:n,tournamentRecord:a,winnerTargetLink:s,sourceMatchUpId:o,drawDefinition:l,winnerMatchUp:u,dualMatchUp:c,matchUpsMap:d,event:p}){let f="directWinner";if(s){let m=u.drawPositions||[],h=m[t],g=s.source.structureId,I=et({structureId:g,drawDefinition:l});if(I.error)return I;let{structure:v}=I,{positionAssignments:w}=ur({structureId:g,drawDefinition:l}),y=w?.find(D=>D.drawPosition===n)?.participantId,b=s.target.structureId,{positionAssignments:S}=ur({structureId:b,drawDefinition:l}),U=S?.find(D=>D.participantId===y)?.drawPosition,T=S?.filter(D=>{let E=m.includes(D.drawPosition),R=!D.participantId&&!D.bye&&!D.qualifier;return E&&R}).map(D=>D.drawPosition),P=T?.includes(h);if(y&&s.target.roundNumber===1&&P)ol({drawPosition:h,participantId:y,structureId:b,inContextDrawMatchUps:e,sourceMatchUpStatus:r,tournamentRecord:a,drawDefinition:l,matchUpsMap:d,event:p});else if(y&&T?.length){let D=T.pop();D&&ol({participantId:y,structureId:b,inContextDrawMatchUps:e,sourceMatchUpStatus:r,tournamentRecord:a,drawDefinition:l,drawPosition:D,matchUpsMap:d,event:p})}else if(U){let D=rm({drawPosition:U,matchUpId:u.matchUpId,inContextDrawMatchUps:e,sourceMatchUpStatus:r,tournamentRecord:a,sourceMatchUpId:o,drawDefinition:l,matchUpsMap:d});if(D.error)return z({result:D,stack:f})}else if(v?.stage!==We){let D="winner target position unavaiallble";console.log(D),z({stack:f,result:{error:D}})}if(v?.seedAssignments&&v.structureId!==b){let D=v.seedAssignments.find(({participantId:R})=>R===y),E=D?.participantId;D&&E&&dv({eventId:u?.eventId,structureId:b,...D,tournamentRecord:a,drawDefinition:l,participantId:E})}}else{let m=rm({matchUpId:u.matchUpId,drawPosition:n,inContextDrawMatchUps:e,sourceMatchUpStatus:r,tournamentRecord:a,sourceMatchUpId:o,drawDefinition:l,matchUpsMap:d});if(m.error)return m}if(c&&i){let m=c.sides?.find(h=>h.sideNumber===i);if(m?.lineUp){let h=c.roundPosition,g=u.roundPosition,I=h===g&&h!==1||Math.floor(h/2)===g?2:1,v=d?.drawMatchUps?.find(({matchUpId:b})=>b===u.matchUpId),w=[1,2].map(b=>({...v.sides?.find(S=>S.sideNumber===b)||{},sideNumber:b}));v.sides=w;let y=v.sides.find(b=>b.sideNumber===I);if(y){let b=m.lineUp?.filter(S=>S?.participantId);y.lineUp=TL({lineUp:b}),St({tournamentId:a?.tournamentId,eventId:u?.eventId,matchUp:v,context:f,drawDefinition:l})}}}return{...H}}function Obe(t){let{loserMatchUpDrawPositionIndex:e,inContextDrawMatchUps:i,projectedWinningSide:r,propagateExitStatus:n,sourceMatchUpStatus:a,loserDrawPosition:s,tournamentRecord:o,loserTargetLink:l,drawDefinition:u,loserMatchUp:c,dualMatchUp:d,matchUpsMap:p,event:f}=t,m="directLoser",h=l.linkCondition,g=c.drawPositions||[],I=h===al&&c.roundNumber===2&&Math.min(...g.filter(Boolean)),v=I||g[e],w=I||g[1-e],y=l.source.structureId,{structure:b}=et({structureId:y,drawDefinition:u}),{matchUps:S}=Nt({afterRecoveryTimes:!1,inContext:!0,drawDefinition:u,structure:b,event:f}),U=S.filter(_=>_.drawPositions?.includes(s)).filter(_=>{let B=_.sides.find(j=>j.drawPosition===s),G=_.matchUpStatus===mi||_.matchUpStatus===Qt&&!cr(_);return B?.sideNumber===_.winningSide&&!G}),T=h===al&&U.length===0,{positionAssignments:P}=ur({structureId:y,drawDefinition:u}),D=P?.find(_=>_.drawPosition===s)?.participantId,E={loserParticipantId:D},R=l.target.structureId,{positionAssignments:C}=ur({structureId:R,drawDefinition:u}),M=C?.filter(({drawPosition:_})=>g.includes(_)),N=M?.some(_=>_.participantId&&D&&_.participantId===D),A=n&&[$r,mi,Qt].includes(a||"");if(N)return{...H,stack:m};let O=M?.filter(_=>{let B=g.includes(_.drawPosition),G=!_.participantId&&!_.bye&&!_.qualifier;return B&&G}).map(_=>_.drawPosition),k=O?.includes(v),F=l.target.roundNumber>1&&O?.length,x=l.target.roundNumber===1&&k;if(I){let _=L();if(_.context&&Object.assign(E,_.context),_.error)return z({result:_,stack:m})}else if(x){let _=V();if(_.context&&Object.assign(E,_.context),_.error)return z({result:_,stack:m})}else if(D&&F){O.sort(ir);let _=O[0],B=ol({participantId:D,structureId:R,drawPosition:_,inContextDrawMatchUps:i,sourceMatchUpStatus:a,tournamentRecord:o,drawDefinition:u,matchUpsMap:p,event:f});if(B.error)return z({result:B,stack:m});if(!B.error&&A&&n)return{stack:m,context:{progressExitStatus:!0,loserParticipantId:D}}}else return z({context:{loserDrawPosition:s,loserTargetLink:l,targetDrawPositionIsUnfilled:k},result:{error:k?Zm:Cme},stack:m});if(b?.seedAssignments&&b.structureId!==R){let _=b.seedAssignments.find(({participantId:G})=>G===D),B=_?.participantId;_&&B&&dv({eventId:c?.eventId,structureId:R,..._,tournamentRecord:o,drawDefinition:u,participantId:B})}if(d&&r){let _=d.sides?.find(B=>B.sideNumber===3-r);if(_?.lineUp){let{roundNumber:B,eventId:G}=c,{roundPosition:j}=d,K=B===1?2-j%2:1,Y=p?.drawMatchUps?.find(({matchUpId:J})=>J===c.matchUpId),X=[1,2].map(J=>({...Y.sides?.find(ae=>ae.sideNumber===J)||{},sideNumber:J}));Y.sides=X;let Z=Y.sides.find(J=>J.sideNumber===K);Z&&(Z.lineUp=TL({lineUp:_.lineUp}),St({tournamentId:o?.tournamentId,matchUp:Y,context:m,drawDefinition:u,eventId:G}))}}return z({result:{...H},stack:m,context:E});function L(){let _="loserLinkFedFMLC";return z(T?{result:V(),stack:_}:{result:$(),stack:_})}function $(){let _=Wa({drawPosition:w,structureId:R,tournamentRecord:o,drawDefinition:u,event:f});return z({result:_,stack:"assignLoserPositionBye"})}function V(){let _=D?ol({drawPosition:v,participantId:D,structureId:R,inContextDrawMatchUps:i,sourceMatchUpStatus:a,tournamentRecord:o,drawDefinition:u,matchUpsMap:p,event:f}):{error:lr};return!_.error&&A&&n?{stack:m,context:{progressExitStatus:!0}}:z({result:_,stack:"assignLoserDrawPosition"})}}function f8(t){let e="directParticipants",i=VL(t);if(i.error)return z({result:i,stack:e});let r=sS({matchUpStatus:t.matchUpStatus}),{dualWinningSideChange:n,inContextDrawMatchUps:a,projectedWinningSide:s,propagateExitStatus:o,matchUpStatusCodes:l,tournamentRecord:u,drawDefinition:c,matchUpStatus:d,dualMatchUp:p,matchUpsMap:f,winningSide:m,targetData:h,matchUpId:g,structure:I,matchUp:v,event:w}=t,y=!!v.collectionId,b=Vn({structure:I}),S=v.drawPositions,U;if(y){let{matchUpTieId:T,matchUpsMap:P}=t,D=Lc({appliedPolicies:t.appliedPolicies,matchUpId:T,tournamentRecord:u,drawDefinition:c,matchUpsMap:P,event:w});if(U=D&&{tieMatchUpResult:D},S=a.find(({matchUpId:E})=>E===T)?.drawPositions,!n)return z({result:{...H,...U},stack:e})}if(b)return z({result:{...H,...U},stack:e});if(S){let T=s?s-1:m-1,P=1-T,D=S[T],E=S[P],R={},{targetLinks:{loserTargetLink:C,winnerTargetLink:M,byeTargetLink:N},targetMatchUps:{winnerMatchUpDrawPositionIndex:A,loserMatchUpDrawPositionIndex:O,winnerMatchUp:k,loserMatchUp:F,byeMatchUp:x}}=h;if(k){let L=kbe({sourceMatchUpStatus:r&&d||ki,winnerMatchUpDrawPositionIndex:A,sourceMatchUpId:g,inContextDrawMatchUps:a,projectedWinningSide:s,winningDrawPosition:D,tournamentRecord:u,winnerTargetLink:M,drawDefinition:c,winnerMatchUp:k,dualMatchUp:p,matchUpsMap:f,event:w});if(L.error)return z({result:L,stack:e})}if(F){let L=Obe({sourceMatchUpStatus:r&&d||ki,loserMatchUpDrawPositionIndex:O,inContextDrawMatchUps:a,projectedWinningSide:s,propagateExitStatus:o,loserDrawPosition:E,tournamentRecord:u,loserTargetLink:C,drawDefinition:c,loserMatchUp:F,matchUpsMap:f,dualMatchUp:p,event:w});if(L.context?.progressExitStatus&&Object.assign(R,L.context,{sourceMatchUpStatus:r&&d||ki,sourceMatchUpStatusCodes:l||[],loserMatchUp:F,matchUpsMap:f}),L.error)return z({result:L,stack:e})}if(x){let L=x.drawPositions||[],$=Math.min(...L.filter(Boolean)),V=N.target.structureId,_=Wa({drawPosition:$,structureId:V,tournamentRecord:u,drawDefinition:c,event:w});if(_.error)return z({result:_,stack:e})}return z({result:{...H,...U},stack:e,context:R})}else return z({result:{error:Dw},stack:e})}function GL(t){let e="genPlayoffStructure";if(!t.drawDefinition)return z({result:{error:_e},stack:e});let i=vS(t);if(i.error)return z({result:i,stack:e});let{structureId:r,addNameBaseToAttributeName:n,playoffStructureNameBase:a,finishingPositionNaming:s,finishingPositionLimit:o,playoffAttributes:l,playoffPositions:u,roundOffsetLimit:c,tournamentRecord:d,exitProfileLimit:p,roundProfiles:f,roundNumbers:m,idPrefix:h,isMock:g,event:I,uuids:v}=t,w=ke(t.drawDefinition,!1,!0),{structure:y}=et({structureId:r,drawDefinition:w});if(!y)return z({result:{error:Ii},stack:e});if(y.structureType===fn||y.structures)return Cbe({sourceStructureId:y.structureId,...t,...i,drawDefinition:w});let{playoffRoundsRanges:b,playoffRounds:S}=i,{playoffPositionsReturned:U,error:T,playoffSourceRounds:P,playoffRoundsRanges:D}=a8(t);if(T)return z({result:{error:T},stack:e});let E=f?.length&&Object.assign({},...f),R=m||typeof f=="object"&&f.map(j=>Object.keys(j)).flat(),C=Array.isArray(R)&&R.map(j=>!isNaN(j)&&Ye(j)).filter(Boolean);if(C){if(!Array.isArray(C))return z({result:{error:ie},context:{validRoundNumbers:C},stack:e});C.forEach(j=>{if(!S?.includes(j))return z({result:{error:ie},context:{roundNumber:j},stack:e})})}u&&u.forEach(j=>{if(!U?.includes(j))return z({result:{error:ie},context:{playoffPosition:j},stack:e})});let M=C||P,N=C?b:D,A=[],O=[];for(let j of M??[]){let K=N?.find(le=>le.roundNumber===j);if(!K)return z({result:{error:ie},context:{roundNumber:j},stack:e});let Y=K.finishingPositions.length,X=Math.min(...K.finishingPositions)-1,Z=2,J=j&&E?.[j]&&Z+E[j]-1,ae=_g({exitProfile:`0-${j}`,addNameBaseToAttributeName:n,playoffStructureNameBase:a,finishingPositionOffset:X,playoffAttributes:l,exitProfileLimit:p,stage:Ui,roundOffset:0,drawDefinition:w,sequenceLimit:J,stageSequence:Z,drawSize:Y,idPrefix:h,isMock:g,uuids:v,finishingPositionNaming:s,finishingPositionLimit:o,roundOffsetLimit:c});if(ae.error)return z({result:ae,stack:e});let{structures:te,links:ne}=ae;if(te?.length&&A.push(...te),ne?.length&&O.push(...ne),ae.structureId&&j){let le={linkType:nu,source:{structureId:r,roundNumber:j},target:{structureId:ae.structureId,feedProfile:Ms,roundNumber:1}};O.push(le)}}if(!A.length)return z({result:{error:ie},info:"No structures generated",stack:e});w.structures.push(...A),w.links.push(...O);let{matchUps:k,matchUpsMap:F}=Qi({inContext:!0,drawDefinition:w}),x=A.map(({structureId:j})=>j),L=k?.filter(({structureId:j})=>x.includes(j)).map(Ir),$=F?.drawMatchUps?.filter(({matchUpId:j})=>L?.includes(j));if($?.length){let j=vn({drawDefinition:w,event:I})?.tieFormat;j&&$.forEach(K=>{let{tieMatchUps:Y}=wh({matchUp:K,tieFormat:j,isMock:g});Object.assign(K,{tieMatchUps:Y,matchUpType:Zt})})}k?.filter(j=>fp({matchUp:j})&&j.structureId===r)?.forEach(j=>{let{matchUpId:K,score:Y,winningSide:X}=j,Z=On({inContextDrawMatchUps:k,drawDefinition:w,matchUpId:K}),J=f8({inContextDrawMatchUps:k,tournamentRecord:d,drawDefinition:w,matchUpsMap:F,winningSide:X,targetData:Z,matchUpId:K,structure:y,matchUp:j,score:Y,event:I});J.error&&console.log(J.error)}),k?.filter(j=>j.matchUpStatus==="BYE"&&j.structureId===r)?.forEach(j=>{let{matchUpId:K}=j,Y=On({inContextDrawMatchUps:k,drawDefinition:w,matchUpId:K}),{targetLinks:{loserTargetLink:X},targetMatchUps:{loserMatchUpDrawPositionIndex:Z,loserMatchUp:J}}=Y;if(X&&J){let ae=X.target.structureId,te=J.drawPositions[Z],ne=Wa({drawPosition:te,structureId:ae,tournamentRecord:d,drawDefinition:w,event:I});ne.error&&console.log(ne.error)}});let V=[],_=Mp({inContextDrawMatchUps:k,drawDefinition:w,matchUpsMap:F}).goesToMap,{structure:B}=et({drawDefinition:t.drawDefinition,structureId:r}),{matchUps:G}=Nt({structure:B});return G.forEach(j=>{let K=_?.loserMatchUpIds[j.matchUpId];if(K&&j.loserMatchUpId!==K){j.loserMatchUpId=K;let X={tournamentId:d?.tournamentId,eventId:t.event?.eventId,context:e,matchUp:j};V.push(X)}let Y=_?.winnerMatchUpIds[j.matchUpId];if(Y&&j.winnerMatchUpId!==Y){j.winnerMatchUpId=Y;let X={tournamentId:d?.tournamentId,eventId:t.event?.eventId,context:e,matchUp:j};V.push(X)}}),{structures:A,matchUpModifications:V,links:O,drawDefinition:w,...H}}function m8({element:t}){if(!t)return{error:ie};if(!t.timeItems)return{};if(!Array.isArray(t.timeItems))return{error:ie};let e=(i,r)=>(n,a)=>(a[i]&&(n[a[i]]=a[r]),n);return t.timeItems.reduce(e("itemType","itemValue"),{})}function Dl(t){let{duplicateValues:e=!0,creationTime:i=!0,removePriorValues:r,timeItem:n}=t;if(!n)return{error:H1};let a=dK(t);if(a.error)return a;if(!(bt(n)&&ri(n.itemType)&&Object.keys(n).includes("itemValue")))return{error:G1};if(!a.timeItems)a.timeItems=[];else if(xbe({element:a,duplicateValues:e,timeItem:n}))return{...H};if(n.itemSubTypes&&!n.itemSubTypes.length&&delete n.itemSubTypes,i){let s=new Date().toISOString();Object.assign(n,{createdAt:s})}return r&&(a.timeItems=a.timeItems.filter(({itemType:s})=>n.itemType!==s)),r&&!n.itemValue||a.timeItems.push(n),{...H}}function xbe({element:t,duplicateValues:e,timeItem:i}){let{itemType:r,itemSubTypes:n,itemValue:a}=i,s=r&&vs({itemSubTypes:n,itemType:r,element:t})?.timeItem;return s&&JSON.stringify(s?.itemValue)===JSON.stringify(a)&&!e}function HL({creationTime:t=!0,removePriorValues:e,tournamentRecord:i,duplicateValues:r,participantId:n,timeItem:a}){if(!i)return{error:Ie};if(!n)return{error:lr};let s=$d({tournamentRecord:i,participantId:n});return s.error?s:Dl({element:s.participant,removePriorValues:e,duplicateValues:r,creationTime:t,timeItem:a})}function wS(t){let{removePriorValues:e,tournamentRecord:i,duplicateValues:r,creationTime:n,timeItem:a}=t;if(!i)return{error:Ie};let s=Dl({element:i,removePriorValues:e,duplicateValues:r,creationTime:n,timeItem:a});if(s.error)return s;let o=m8({element:i});return at({payload:{parentOrganisation:i.parentOrganisation,tournamentId:i.tournamentId,timeItemValues:o},topic:rf}),s}function Sh(t){let{removePriorValues:e,duplicateValues:i,creationTime:r,timeItem:n,event:a}=t;return a?Dl({removePriorValues:e,duplicateValues:i,element:a,creationTime:r,timeItem:n}):{error:os}}function h8(t){return jR({...t,itemType:"attachConsolationStructures"})}function WL(t){return jR({...t,itemType:"attachPlayoffStructures"})}function jR({itemType:t="attachStructures",matchUpModifications:e,tournamentRecord:i,drawDefinition:r,structures:n,links:a=[],event:s}){let o="attachStructures";if(!r)return{error:_e};if(!Array.isArray(n)||!Array.isArray(a))return z({result:{error:ie},stack:o});let l=g=>[g.source.structureId,g.source.roundNumber||g.source.finishingPositions?.join("|"),g.target.roundNumber].join("|"),u=r.links?.map(l);if(a.some(g=>{let I=l(g);return u?.includes(I)}))return z({result:{error:X1},info:"playoff structure exists",stack:o});a.length&&r.links?.push(...a);let c=n.map(({structureId:g})=>g),d=r.structures?.map(({structureId:g})=>g);r.structures=(r.structures??[]).map(g=>c.includes(g.structureId)?n.find(({structureId:I})=>I===g.structureId):g);let p=n?.filter(({structureId:g})=>!d?.includes(g));p.length&&r.structures.push(...p),Mp({drawDefinition:r});let f=n.map(g=>Nt({structure:g})?.matchUps||[]).flat();hd({tournamentId:i?.tournamentId,eventId:s?.eventId,drawDefinition:r,matchUps:f});let m=n.map(({structureId:g})=>g);if(ti({drawDefinition:r,structureIds:m}),e?.length){let g={};e.forEach(v=>{let w=v.matchUp?.matchUpId;w&&(g[w]=v)});let I=v=>{v.matchUps.forEach(w=>{if(g[w.matchUpId]){let{tieMatchUps:y,...b}=g[w.matchUpId].matchUp;if(Object.assign(w,b),y?.length){let S={};y.forEach(U=>g[U.matchUpId]=U),w.tieMatchUps.forEach(U=>Object.assign(U,S[U.matchUpId]))}g[w.matchUpId].matchUp=w,St(g[w.matchUpId])}})};r.structures.forEach(v=>{if(d?.includes(v.structureId))if(v.structures)for(let w of v.structures)I(w);else I(v)})}let h=p.map(ba("structureId"));if(i){let g={itemValue:{structureIds:m,drawId:r.drawId},itemType:t};Dl({element:i,timeItem:g})}return{...H,addedStructureIds:h}}function GR(t){let{structures:e,links:i,matchUpModifications:r,error:n}=GL(t);if(n)return{error:n};let a=t.drawDefinition;return WL({tournamentId:t.tournamentRecord?.tournamentId,eventId:t.event?.eventId||t.eventId,matchUpModifications:r,drawDefinition:a,structures:e,links:i})}function Ap(t){let e=Ge(t,[{_anyOf:{[cn]:!1,[mr]:!1,[mn]:!1,[Ac]:!1},[fF]:!0}]);if(e.error)return e;let i=[],r=t.drawDefinition??t.event??((t.tournamentId||!t.tournamentRecords)&&t.tournamentRecord);if(r){let n=JH(t,r);if(n.error)return n;i.push(...n?.applied??[]),t.drawDefinition&&ti({drawDefinition:t.drawDefinition,tournamentId:t.tournamentId})}else if(t.tournamentRecords){let n=Object.keys(t.tournamentRecords);if(!n.length)return{error:Ie};for(let a of n){let s=t.tournamentRecords[a],o=JH(t,s);if(o.error)return o;i.push(...o?.applied??[])}}else return{error:Ie};return i.length?{...H,applied:i}:{error:F1}}function JH(t,e){let i=Tt(t).appliedPolicies??{};e.extensions||(e.extensions=[]);let r=[],n=Object.keys(t.policyDefinitions);if(!n.length)return{error:xE};for(let a of n)if(!i[a]||t.allowReplacement){let s=t.policyDefinitions[a];if(!s)continue;if(!bt(s))return{error:ie};let{policyName:o,...l}=s;if(!l||!Object.keys(l).length||o&&!ri(o))return{error:ie};i[a]=t.policyDefinitions[a],r.push(a)}return r?.length?{...xt({element:e,extension:{name:bb,value:i}}),applied:r}:{applied:r,error:F1}}function zL({tournamentRecord:t,drawDefinition:e,flightProfile:i,drawName:r,drawId:n,event:a}){if(!r||typeof r!="string")return z({result:{error:ie},context:{drawName:r}});i||(i=$i({event:a}).flightProfile);let s=i?.flights?.find(o=>o.drawId===n);if(s){s.drawName=r;let o={name:Xs,value:{...i,flights:i.flights}};Ld({event:a,extension:o})}return e&&(e.drawName=r,ti({tournamentId:t?.tournamentId,drawDefinition:e})),!s&&!e?{error:_e}:{...H,flight:s}}function g8({tournamentRecord:t,drawDefinition:e,drawUpdates:i,drawId:r,event:n}){if(!bt(i))return{error:ie};let a=$i({event:n}).flightProfile,s=i.drawName&&zL({drawName:i.drawName,tournamentRecord:t,drawDefinition:e,flightProfile:a,drawId:r,event:n});if(s?.error)return s?.error;let o=s?.flight||a?.flights?.find(l=>l.drawId===r);if(!o&&!e)return{error:_e};if(o){let l={name:Xs,value:{...a,flights:a.flights}};Ld({event:n,extension:l})}return e&&(i.policyDefinitions&&Ap({policyDefinitions:i.policyDefinitions,drawDefinition:e}),ti({tournamentId:t?.tournamentId,drawDefinition:e})),{...H}}function I8({tournamentRecord:t,removeScheduling:e,drawDefinition:i}){if(!i)return{error:_e};let r=Ar({drawDefinition:i}),n=s=>r?.drawMatchUps?.find(o=>o.matchUpId===s);for(let s of i.structures||[]){let{positionAssignments:o,stage:l,stageSequence:u}=s;o&&(u!==1||![We,xe].includes(l))&&(s.positionAssignments=o.map(p=>(delete p.participantId,p)),s.seedAssignments=[]);let{matchUps:c,isRoundRobin:d}=Nt({afterRecoveryTimes:!1,inContext:!0,matchUpsMap:r,structure:s});for(let p of c){let{matchUpId:f,roundNumber:m}=p,h=p.sides||[],g=n(f);if(g){if(delete g.extensions,delete g.notes,g.matchUpStatus!=="BYE"&&Object.assign(g,VR),m&&m>1&&g.drawPositions?.length&&!d){let I=h?.map(({drawPosition:w,participantFed:y})=>!y&&w).filter(Boolean),v=g.drawPositions.map(w=>I.includes(w)?void 0:w);g.drawPositions=v}e?delete g.timeItems:g.timeItems?.length&&(g.timeItems=g.timeItems.filter(I=>I.itemType&&![lu,Id,dh,ZF,ph,fh].includes(I.itemType))),St({tournamentId:t?.tournamentId,context:"resetDrawDefiniton",drawDefinition:i,matchUp:g})}}}i.extensions=i.extensions.filter(s=>s.name!==Lg);let a=(i.structures||[]).map(({structureId:s})=>s);return ti({drawDefinition:i,structureIds:a}),{...H}}function SS({tournamentRecord:t}){if(!t)return{error:Ie};let e={positionsNoOutcomes:[],canBePruned:[],matchPlay:[],inactive:[],drawAnalysis:{}},i={};return(t.events?.flatMap(r=>{let n=r.eventId;return i[n]=r,(r?.drawDefinitions||[]).map(a=>({drawDefinition:a,eventId:n}))}).filter(Boolean)).forEach(({drawDefinition:r,eventId:n})=>{let a=0,s=0,o=0,{allStructuresLinked:l}=LR({drawDefinition:r}),u=i[n],c=(r?.structures||[]).map(w=>{let{stage:y,stageSequence:b,structureId:S}=w,U=Pm[y],{inContextStructureMatchUps:T}=lv({drawDefinition:r,structureId:S,structure:w,event:u}),P=T?.filter(({winningSide:$})=>$),D=P.filter(Boolean).length||0;s+=D,o+=T.length-s;let E=Math.max(P.filter(({roundNumber:$})=>$===1).map(({roundPosition:$})=>$)),{positionAssignments:R}=Yt({structure:w}),C=R?.filter(({participantId:$})=>$);a+=C?.length??0;let M=(R?.length??0)-(C?.length??0),{roundMatchUps:N,roundProfile:A,roundNumbers:O,maxMatchUpsCount:k}=bn({matchUps:T}),F=A&&Object.keys(A).filter($=>!A[$].inactiveRound).map($=>Number.parseInt($)),x=A&&Object.keys(A).filter($=>A[$].inactiveRound).map($=>Number.parseInt($)),L=A&&Object.values(A).every($=>$.inactiveRound);return{positionsAssignedCount:C?.length??0,maxWinningSideFirstRoundPosition:E,unassignedPositionsCount:M,inactiveStructure:L,maxMatchUpsCount:k,inactiveRounds:x,roundMatchUps:N,activeRounds:F,roundNumbers:O,roundProfile:A,structureId:S,stageSequence:b,orderNumber:U,stage:y}}),d=c.find(w=>w.orderNumber===2&&w.stageSequence===1),p=c.filter(({inactiveStructure:w})=>!w).length,{links:f}=sv({structureId:d.structureId,drawDefinition:r}),m=Ye(d.activeRounds[0])===1&&d.activeRounds.length===1&&p===1,h=c?.every(({inactiveStructure:w})=>w),g=!f.length&&d.activeRounds.length&&(d.roundProfile[1].inactiveCount||d.inactiveRounds.length),I=r.drawId;a&&!s&&e.positionsNoOutcomes.push(I),h&&e.inactive.push(I),m&&e.matchPlay.push(I),g&&e.canBePruned.push(I);let v={matchUpsWithWinningSideCount:s,matchUpsNoOutcomeCount:o,positionsAssignedCount:a,allStructuresLinked:l,structuresData:c,inactiveDraw:h,isMatchPlay:m,drawId:I};e.drawAnalysis[I]=v}),{...H,drawsAnalysis:e}}function v8({matchPlayDrawPositions:t=!0,tournamentRecord:e,drawDefinition:i,drawId:r}){if(!e)return{error:Ie};if(!i)return{error:_e};let n=[],{drawsAnalysis:a}=SS({tournamentRecord:e});if(a.canBePruned.includes(r)){let s=a.matchPlay.includes(r),o=a.drawAnalysis[r],{structures:[l]}=Js({stageSequence:1,drawDefinition:i,stage:xe}),u=o.structuresData.find(({structureId:f})=>l.structureId===f),c=(l.matchUps??[]).sort((f,m)=>f.roundPosition-m.roundPosition);n=c.filter(({roundNumber:f})=>!u.inactiveRounds.includes(f));let d=n.map(Ir),p=c.map(Ir).filter(f=>!d.includes(f));if(s){let f=n.filter(({roundNumber:v})=>!u.inactiveRounds.includes(v)).filter(({winningSide:v})=>v),m=f.map(Ir),h=d.filter(v=>!m.includes(v));p.push(...h);let g=f.flatMap(v=>v.drawPositions??[]).filter(Boolean).flat(),I=Object.assign({},...g.map((v,w)=>({[v]:w+1})));if(f.forEach(v=>{t?v.drawPositions=v.drawPositions.map(w=>I[w]):delete v.drawPositions}),t){let v=l?.positionAssignments?.filter(w=>g.includes(w.drawPosition)).map(w=>(w.drawPosition=I[w.drawPosition],w));l.positionAssignments=v}else l.positionAssignments=[];l.matchUps=f,n=f}Pu({tournamentId:e?.tournamentId,matchUpIds:p,drawDefinition:i}),ti({drawDefinition:i})}return{...H,matchUps:n}}function Fbe({isPositionAction:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,loserMatchUp:n,matchUpsMap:a,structureId:s,structure:o,event:l}){if(!i)return{error:_e};if(o||({structure:o}=et({drawDefinition:i,structureId:s})),!o)return{error:Ii};s||({structureId:s}=o);let u="assignDrawPositionQualifier";Gt({method:u,color:"cyan",drawPosition:r}),a??=Ar({drawDefinition:i});let{positionAssignments:c}=Yt({structure:o}),{activeDrawPositions:d}=lv({drawDefinition:i,structureId:s});if(c?.find(I=>I.drawPosition===r)?.qualifier)return{...H};let p=!!(n&&a.drawMatchUps.some(I=>I.loserMatchUpId===n?.matchUpId&&Fr(I.matchUpStatus)));if(d?.includes(r)&&!p)return{error:Pw};let f=c?.find(I=>I.drawPosition===r);if(!f)return{error:Zm};let{containsQualifier:m,containsParticipant:h}=sL(f);if(m)return{...H};let g=Tt({tournamentRecord:e,drawDefinition:i,event:l}).appliedPolicies??{};return c?.forEach(I=>{I.drawPosition===r&&(I.qualifier=!0,p&&(I.participantId=void 0,console.log("oddity: invalid participantId on qualifier position cleared")))}),pc({tournamentId:e?.tournamentId,drawDefinition:i,structure:o,event:l}),Lbe({assignedParticipantId:h,isPositionAction:t,appliedPolicies:g,drawDefinition:i,drawPosition:r,structureId:s,stack:u})}function Lbe({assignedParticipantId:t,isPositionAction:e,appliedPolicies:i,drawDefinition:r,drawPosition:n,structureId:a,stack:s}){return e&&Ww({appliedPolicies:i,drawDefinition:r,positionAction:{removedParticipantId:t,drawPosition:n,structureId:a,name:s}}),z({result:{...H},stack:s})}function y8({tournamentRecord:t,drawDefinition:e,participantId:i,drawPosition:r,structureId:n,qualifier:a,event:s,bye:o}){if(!e)return{error:_e};if(!r)return{error:YI};if(!n)return{error:Va};if(o){let l=Wa({tournamentRecord:t,drawDefinition:e,drawPosition:r,structureId:n,event:s});if(l.error)return l}else if(a){let l=Fbe({tournamentRecord:t,drawDefinition:e,drawPosition:r,structureId:n,event:s});if(l.error)return l}else{let l=ol({participantId:i,tournamentRecord:t,drawDefinition:e,drawPosition:r,structureId:n,event:s});if(l.error)return l}return{...H}}function b8(t){let e=t.matchUpIds??[],{drawDefinition:i}=t,r=t.structureId??i?.structures?.find(l=>l.matchUps?.some(({matchUpId:u})=>e.includes(u)))?.structureId??i?.structures?.[0]?.structureId;if(!r)return{error:Ii};let n=i.structures?.find(l=>l.structureId===r);if(!n)return{error:Ii};let a=n?.matchUps,s=a?.find(l=>!!l.roundPosition);if(n.structures||s||n.finishingPosition===oh)return{error:Jp};let o=a.filter(({roundNumber:l})=>t.roundNumbers?.includes(l)).map(Ir);return e=e.filter(l=>!o.includes(l)),t.roundNumbers&&!e.length&&(e=o),{existingMatchUps:a,matchUpIds:e,structureId:r,structure:n}}function w8(t){let e=Ge(t,[{[mn]:!0},{[tI]:{[$w]:!1,roundNumbers:!1},[Fa]:ie,[zn]:an}]);if(e.error)return e;let{removeIncomplete:i=!1,removeUnAssigned:r=!0,removeCompleted:n=!1,tournamentRecord:a,drawDefinition:s,event:o}=t,l=b8(t);if(l.error)return l;let{structure:u,structureId:c,existingMatchUps:d,matchUpIds:p}=l,f=[],m=d?.filter(({matchUpId:I,score:v,winningSide:w})=>{if(w&&!n)return!1;if(w||cr({score:v})){if(!w&&!i)return!1;f.push(I)}else if(!r)return!1;return p?.includes(I)})??[],h=m.map(Ir),g=m.map(({tieMatchUps:I})=>I?.map(Ir)).filter(Boolean).flat();if(h.length){u.matchUps=(u.matchUps??[]).filter(({matchUpId:w})=>!h.includes(w)),Pu({tournamentId:a?.tournamentId,matchUpIds:[...g,...h],action:"deleteAdHocMatchUps",eventId:o?.eventId,drawDefinition:s});let I=rt(u.matchUps.map(ba("roundNumber"))),v=Dme(I);if(v.length){v.reverse();for(let w of v)u.matchUps.forEach(y=>{y.roundNumber&&y.roundNumber>w&&(y.roundNumber-=1,St({tournamentId:a?.tournamentId,context:["adHoc round deletion"],eventId:o?.eventId,drawDefinition:s,matchUp:y}))})}if(f.length){u.positionAssignments=rt(u.matchUps.flatMap(U=>(U.sides??[]).map(T=>T.participantId)).filter(Boolean)).map(U=>({participantId:U}));let w=u?.matchUpFormat??s?.matchUpFormat??o?.matchUpFormat,y=l.existingMatchUps.some(U=>U.matchUpType===ka)?{matchUpTypes:[ka]}:void 0,{matchUps:b}=Nt({afterRecoveryTimes:!1,inContext:!0,matchUpFilters:y,structure:u,event:o});Vn({structure:u})&&(u.positionAssignments=rt(b.flatMap(U=>(U.sides??[]).map(T=>T.participantId)).filter(Boolean)).map(U=>({participantId:U})));let S=$L({positionAssignments:u.positionAssignments,tournamentRecord:a,drawDefinition:s,matchUpFormat:w,matchUps:b,event:o});S.error&&console.log(S)}ti({structureIds:[c],eventId:o?.eventId,drawDefinition:s})}return!h.length&&p.length?{error:Nw}:{...H,deletedMatchUpsCount:[...h,...g].length}}function S8({removeCompletedMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:r,roundNumber:n,event:a}){if(!e)return{error:Ie};if(!i)return{error:_e};if(!n)return z({result:{error:Xe},info:"roundNumber required"});let s=et({drawDefinition:i,structureId:r});if(s.error)return s;let o=s.structure;return o?.structures?{error:Jp}:Vn({structure:o})?_be({tournamentId:e.tournamentId,removeCompletedMatchUps:t,eventId:a.eventId,drawDefinition:i,roundNumber:n,structure:o}):(console.log("not implemented"),{...H})}function _be({removeCompletedMatchUps:t,drawDefinition:e,tournamentId:i,roundNumber:r,structure:n,eventId:a}){let s=n?.matchUps??[],o=[],l=[],u=!1;if(s.reduce((c,d)=>{let p=d?.roundNumber;return p?c.includes(p)?c:c.concat(p):c},[]).sort(ir).includes(r)){let c=s.filter(d=>{let p=d.roundNumber===r&&(!Yi.includes(d.matchUpStatus)||t);return p&&(l.push(d.matchUpId),d.tieMatchUps&&o.push(...d.tieMatchUps.map(Ir))),!p});l.length&&(Pu({matchUpIds:[...o,...l],drawDefinition:e,tournamentId:i,eventId:a}),c.some(d=>d.roundNumber===r)||(c.forEach(d=>{d.roundNumber>r&&(d.roundNumber-=1,St({drawDefinition:e,tournamentId:i,eventId:a,matchUp:d}))}),u=!0),n.matchUps=c)}return{deletedMatchUpsCount:l.length,roundRemoved:u,...H}}function HR(t){let{suppressNotifications:e,tournamentRecord:i,drawDefinition:r,matchUps:n,event:a}=t;if(typeof r!="object")return{error:_e};let s=t?.structureId;if(!s&&r.structures?.length===1&&(s=r.structures?.[0]?.structureId),typeof s!="string")return{error:Va};if(!Ga(n))return{error:ie,info:Np("matchUps")};let o=r.structures?.find(p=>p.structureId===s);if(!o)return{error:Ii};let l=(o?.matchUps).find(p=>!!p.roundPosition);if(o.structures||l||o.finishingPosition===oh)return{error:Jp};let u=br({tournamentRecord:i,inContext:!1})?.matchUps?.map(Ir)??[],c=n.map(Ir);if(kn(u,c))return{error:c4,info:"One or more matchUpIds already present in tournamentRecord"};o.matchUps.push(...n);let d=n.map(({tieMatchUps:p})=>p).filter(Boolean).flat();return e||(hd({tournamentId:i?.tournamentId,matchUps:[...d,...n],eventId:a?.eventId,drawDefinition:r}),ti({drawDefinition:r,structureIds:[s]})),{...H}}function U8({tournamentRecord:t,drawDefinition:e,drawPosition:i,structureId:r,subOrder:n,event:a}){if(!e)return{error:_e};if(!r)return{error:Va};if(!i)return{error:YI};let{structure:s}=et({drawDefinition:e,structureId:r});if(!s)return{error:Ii};let o=s;s.structures&&s.structureType===fn&&(o=s.structures?.find(f=>f.positionAssignments?.find(m=>m.drawPosition===i)));let l=o?.positionAssignments,u=l?.find(f=>f.drawPosition===i);u&&xt({element:u,extension:{name:rI,value:n}});let c=(a?.eventType===Zt||e.matchUpType===Zt||(a?.tieFormat??e?.tieFormat??s?.tieFormat))&&{matchUpTypes:[Zt]},{matchUps:d}=Nt({structure:o,afterRecoveryTimes:!1,inContext:!0,matchUpFilters:c,event:a}),p=s?.matchUpFormat??e.matchUpFormat;return $L({positionAssignments:l,tournamentRecord:t,drawDefinition:e,matchUpFormat:p,matchUps:d,event:a}),ti({drawDefinition:e,structureIds:[r]}),{...H}}var T8={};ct(T8,{addGoesTo:()=>Mp,allPlayoffPositionsFilled:()=>RL,checkValidEntries:()=>YR,findDrawDefinition:()=>XL,getAssignedParticipantIds:()=>cf,getAvailableMatchUpsCount:()=>WR,getAvailablePlayoffProfiles:()=>vS,getDrawDefinitionTimeItem:()=>WF,getDrawParticipantRepresentativeIds:()=>YL,getDrawStructures:()=>Js,getDrawTypeCoercion:()=>DS,getEligibleVoluntaryConsolationParticipants:()=>qL,getMatchUpsMap:()=>Ar,getParticipantIdFinishingPositions:()=>KL,getPositionAssignments:()=>lI,getPositionsPlayedOff:()=>fv,getRandomQualifierList:()=>ZL,getSeedingThresholds:()=>SL,getSeedsCount:()=>PS,getStructureSeedAssignments:()=>ds,getTeamLineUp:()=>Cp,getValidGroupSizes:()=>fS,isAdHoc:()=>Vn,isCompletedStructure:()=>uu,isValidForQualifying:()=>e0,positionActions:()=>QL});function qL({excludedMatchUpStatuses:t=[],includeEventParticipants:e,includeQualifyingStage:i,finishingRoundLimit:r,policyDefinitions:n,roundNumberLimit:a,tournamentRecord:s,drawDefinition:o,matchUpsLimit:l,requirePlay:u,requireLoss:c,allEntries:d,winsLimit:p,event:f}){if(!o)return{error:_e};let m=[xe,Ui];i&&m.push(We);let h=f?.eventType?{matchUpTypes:[f.eventType]}:void 0,g=o?.matchUpType?{matchUpTypes:[o.matchUpType]}:void 0,I=e&&f?Ru({contextFilters:{stages:m},matchUpFilters:h,tournamentRecord:s,inContext:!0,event:f})?.matchUps??[]:Rn({contextFilters:{stages:m},matchUpFilters:g,tournamentRecord:s,inContext:!0,drawDefinition:o})?.matchUps??[],v=ch({stage:Pr,drawDefinition:o}),w=new Set(v.map(({participantId:F})=>F)),y={},b={},S={},U={};n??=xc({policyTypes:[rO],tournamentRecord:s,drawDefinition:o,event:f}).policyDefinitions;let T=n?.[rO];t=t.length&&t||T?.excludedMatchUpStatuses||[],e=e??T?.includeEventParticipants,d=d??T?.allEntries,r=r??T?.finishingRoundLimit,a=a??T?.roundNumberLimit,l=l??T?.matchUpsLimit,u??=T?.requirePlay??!0,c??=T?.requireLoss??!0,p=p??T?.winsLimit;for(let F of I){if(u&&F.winningSide&&![1,2].includes(F.winningSide)&&F.matchUpStatus!==wi||F.finishingRound&&r&&F.finishingRound>=r||F.finishingRound&&a&&F.finishingRound<=a)continue;let x=F.sides?.find(({sideNumber:$})=>F.winningSide&&$===3-F.winningSide),L=F.sides?.find(({sideNumber:$})=>F.winningSide&&$===F.winningSide);if(F.sides?.forEach($=>{let V=$?.participant?.participantId;V&&(S[V]=$.participant,F.matchUpStatus===wi&&!u&&(b[V]=$.participant,y[V]||(y[V]=0),(!F.matchUpStatus||!t.includes(F.matchUpStatus))&&(y[V]+=1)))}),x?.participant){let $=x.participant.participantId;b[$]=x.participant,y[$]||(y[$]=0),F.matchUpStatus&&!t.includes(F.matchUpStatus)&&(y[$]+=1)}if(L?.participant){let $=L.participant.participantId;U[$]||(U[$]=0),U[$]+=1,y[$]||(y[$]=0),F.matchUpStatus&&!t.includes(F.matchUpStatus)&&(y[$]+=1)}}let P=s?.participants&&!u&&!c&&d,D;e&&f?D=f.entries:D=o.entries;let E=P?(D??[]).filter(F=>![mc,ys].includes(F.entryStatus)).map(({participantId:F})=>F):[],R=Object.keys(b),C=P?(s?.participants??[]).filter(({participantId:F})=>E.includes(F)):c&&Object.values(b)||Object.values(S),M=F=>!c||R.includes(F),N=F=>!u||(y[F]||0)>=0,A=F=>!p||(U[F]||0)<=p,O=F=>!l||y[F]<=l,k=F=>!w.has(F);return{eligibleParticipants:C.filter(F=>M(F.participantId)&&N(F.participantId)&&A(F.participantId)&&O(F.participantId)&&k(F.participantId)).map(F=>({...F,individualParticipants:F.individualParticipantIds?.map(x=>s?.participants?.find(L=>L.participantId===x))})),losingParticipantIds:R,...H}}function WR(t){let e=Ge(t,[{drawDefinition:!0}]);if(e.error)return e;let{drawDefinition:i,roundNumber:r}=t,n=t.structureId??(i.structures?.length===1&&i.structures?.[0]?.structureId);if(typeof n!="string")return{error:Va};let a=i.structures?.find(m=>m.structureId===n);if(!a)return{error:Ii};let s,o=(a.matchUps??[])?.reduce((m,h)=>(h.roundPosition&&(s=!0),(h?.roundNumber||0)>m?h.roundNumber:m),0);if(a.structures||s||a.finishingPosition===oh)return{error:Jp};let l=i?.entries?.filter(m=>{let h=m.entryStatus;return so.includes(h)})??[],u=Math.floor(l?.length/2)||1,c=r??o??1,d=a.matchUps?.filter(m=>m.roundNumber===c)?.length??0,p=u-d,f=p>0?p:0;return{...H,availableMatchUpsCount:f,lastRoundNumber:o,roundMatchUpsCount:u}}function YL({drawDefinition:t}){let e=mt({name:"participantRepresentatives",element:t});return e.error?e:{representativeParticipantIds:e.extension?.value||[]}}function $be({tournamentParticipants:t,drawDefinition:e,event:i}){if(!e)return{error:_e};let r=Qi({tournamentParticipants:t,inContext:!0,drawDefinition:e,event:i}),n=ke(r.matchUps,!1,!0),a=rt(n.reduce((o,l)=>o.concat(...l.sides.map(u=>u.participantId).filter(Boolean)),[])),s=Object.assign({},...a.map(o=>{let l=n.filter(u=>u.sides.map(c=>c.participantId).filter(Boolean).includes(o));return{[o]:l}}));return{participantIds:a,participantIdMatchUps:s}}function lI({tournamentRecord:t,drawDefinition:e,stage:i=xe,structureId:r,structure:n}){if(!t)return{error:Ie};if(!n&&!e)return{error:_e};if(!n&&!r&&e?.structures?.filter(o=>o.stage===i).length===1&&(n=e.structures.find(o=>o.stage===i)),!n&&!r)return{error:Va};let{error:a,positionAssignments:s}=Yt({drawDefinition:e,structureId:r,structure:n});return{positionAssignments:s??[],structureId:n?.structureId,error:a}}function D8({dates:t=[],extension:e}){if(!e)return!1;if(typeof e.value=="boolean"&&e.value)return!0;if(!t.length)return!1;let i=bt(e.value)?e.value?.dates:void 0;if(Array.isArray(i))return i?.length?!!i.filter(r=>!t.length||t.includes(r)).length:!1}function Bbe({inContextCourt:t,venue:e}){let{defaultStartTime:i,defaultEndTime:r,dateAvailability:n}=e;if(!(i||r||n?.length))return;let a=t.dateAvailability;if(!a?.length){n?.length?t.dateAvailability=n.map(s=>({...s})):i&&r&&(t.dateAvailability=[{startTime:i,endTime:r}]);return}t.dateAvailability=a.map(s=>{let o=Vbe({date:s.date,venueDateAvailability:n,defaultStartTime:i,defaultEndTime:r});if(!o)return s;let l=jbe(s.startTime,o.startTime),u=Gbe(s.endTime,o.endTime),c=Hbe(s.bookings,o.bookings);return{...s,startTime:l,endTime:u,...c.length?{bookings:c}:{}}})}function Vbe({date:t,venueDateAvailability:e,defaultStartTime:i,defaultEndTime:r}){if(e?.length){if(t){let a=e.find(s=>s.date===t);if(a)return a}let n=e.find(a=>!a.date);if(n)return n}if(i||r)return{startTime:i,endTime:r}}function jbe(t,e){return t?e?t>e?t:e:t:e}function Gbe(t,e){return t?e?t<e?t:e:t:e}function Hbe(t,e){let i=[];return t?.length&&i.push(...t),e?.length&&i.push(...e),i}function P8({convertExtensions:t,ignoreDisabled:e,venue:i,court:r}){let n={...ke(r,t,!0),venueId:i.venueId},{extension:a}=mt({name:Io,element:r});if(e&&a){let s=bt(a.value)?a.value?.dates:void 0,o=a?.value===!0?[]:n.dateAvailability.map(l=>{let u=l.date;if(!(!u||s.includes(u)))return l}).filter(Boolean);n.dateAvailability=o}return Bbe({inContextCourt:n,venue:i}),{inContextCourt:n}}function Wbe(t,e,i){if(e.length&&!e.includes(t.venueId))return!1;if(i){let{extension:r}=mt({name:Io,element:t});if(r?.value)return!1}return!0}function zbe({venue:t,convertExtensions:e,ignoreDisabled:i,dates:r,uniqueVenueIds:n,venues:a,uniqueCourtIds:s,courts:o}){n.includes(t.venueId)||(a.push(ke(t,e,!0)),n.push(t.venueId));for(let l of t.courts??[])if(!s.includes(l.courtId)){if(i){let{extension:c}=mt({name:Io,element:l});if(D8({extension:c,dates:r}))continue}let{inContextCourt:u}=P8({convertExtensions:e,ignoreDisabled:i,venue:t,court:l});o.push(u),s.push(l.courtId)}}function Cu(t){let{convertExtensions:e,ignoreDisabled:i,venueIds:r=[],dates:n}=t,a=t.tournamentRecords||t.tournamentRecord&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord}||{},s=[],o=[],l=[],u=[];return Object.keys(a).filter(c=>!t.tournamentId||c===t.tournamentId).forEach(c=>{let d=a[c];for(let p of d.venues??[])Wbe(p,r,!!i)&&zbe({venue:p,convertExtensions:e,ignoreDisabled:i,dates:n,uniqueVenueIds:s,venues:u,uniqueCourtIds:o,courts:l})}),{courts:l,venues:u,...H}}function qbe({convertExtensions:t,tournamentRecord:e,ignoreDisabled:i,dates:r}){if(!e)return{error:Ci};let n=ke(e.venues??[],t).filter(s=>{if(!i)return s;let{extension:o}=mt({name:Io,element:s});return!o?.value&&s}).filter(Boolean),a=n.reduce((s,o)=>{let l=(o?.courts||[]).filter(u=>{if(!i&&!r?.length)return u;let{extension:c}=mt({name:Io,element:u});return D8({extension:c,dates:r})}).filter(Boolean).map(u=>{let{inContextCourt:c}=P8({convertExtensions:t,ignoreDisabled:i,venue:o,court:u});return c});return l.length?s.concat(l):s},[]);return{venues:n,courts:a}}function US({tournamentRecords:t,requireCourts:e,dates:i}){return typeof t!="object"||!Object.keys(t).length?{error:Ci}:Object.keys(t).reduce((r,n)=>{let a=t[n],{venues:s}=qbe({tournamentRecord:a,dates:i});return s?.forEach(o=>{let{venueId:l,courts:u}=o;(!e||u?.length)&&!r.venueIds.includes(l)&&(r.venues.push(o),r.venueIds.push(l))}),r},{venues:[],venueIds:[]})}function E8({event:t}){let{surfaceCategory:e,onlineResources:i,matchUpFormat:r,discipline:n,eventLevel:a,eventName:s,eventType:o,startDate:l,category:u,ballType:c,eventId:d,endDate:p,gender:f,notes:m}=t;return{eventInfo:{drawDefinitionCount:t.drawDefinitions?.length,surfaceCategory:e,onlineResources:i,matchUpFormat:r,discipline:n,eventLevel:a,eventName:s,eventType:o,ballType:c,startDate:l,category:u,endDate:p,eventId:d,gender:f,notes:m}}}var Ybe="IN_PROGRESS",Kbe="ABANDONED",Xbe="CANCELLED",Jbe="COMPLETED",Qbe="ACTIVE",R8="tournamentImage",C8={TOURNAMENT_IMAGE_RESOURCE_NAME:R8,IN_PROGRESS:Ybe,ABANDONED:Kbe,CANCELLED:Xbe,COMPLETED:Jbe,ACTIVE:Qbe},Zbe={[Bw]:{policyName:"Staff Privacy Policy",participant:{contacts:!1,individualParticipants:!1,individualParticipantIds:!1,onlineResources:!1,participantName:!0,participantOtherName:!0,participantId:!0,participantRole:!0,participantRoleResponsibilities:!0,participantStatus:!0,penalties:!1,representing:!0,participantType:!0,person:{addresses:!1,biographicalInformation:!1,birthDate:!1,contacts:!1,nationalityCode:!0,nativeFamilyName:!1,nativeGivenName:!1,onlineResources:!1,otherNames:!0,parentOrganisationId:!1,passportFamilyName:!1,passportGivenName:!1,personId:!1,personOtherIds:!1,previousNames:!1,sex:!1,standardFamilyName:!0,standardGivenName:!0,status:!1,tennisId:!1,wheelchair:!0}}}},ewe=Zbe;function Uh(t){let{tournamentRecord:e,withMatchUpStats:i,withStructureDetails:r,withVenueData:n}=t??{};if(!e)return{error:Ie};let a=(({tournamentId:m,tournamentRank:h,tournamentStatus:g,formalName:I,tournamentName:v,promotionalName:w,onlineResources:y,localTimeZone:b,activeDates:S,startDate:U,endDate:T,hostCountryCode:P,venues:D,notes:E,updatedAt:R})=>({tournamentId:m,tournamentRank:h,tournamentStatus:g,formalName:I,tournamentName:v,promotionalName:w,onlineResources:y,localTimeZone:b,activeDates:S,startDate:U,endDate:T,hostCountryCode:P,venues:D,notes:E,updatedAt:R}))(e),s=e.venues?.find(m=>m.isPrimary);s?.addresses?.length&&(a.tournamentAddress=s.addresses[0]);let o=Ei({participantFilters:{participantRoles:[p7,mL,f7,m7,g7]},policyDefinitions:ewe,tournamentRecord:e})?.participants??[];o&&(a.tournamentContacts=o);let l=e?.onlineResources?.find(m=>m.name===R8&&m.resourceType==="URL")?.identifier;l&&(a.imageUrl=l);let u=Ih({tournamentRecord:e})?.publishState,c=u?.tournament?.status?.publishedEventIds||[],d=[];for(let m of e.events??[])if(!t?.usePublishState||c.includes(m.eventId)){let h=E8({event:m}).eventInfo;h&&d.push(h)}a.timeItemValues=m8({element:e}),a.publishState=u?.tournament,a.eventInfo=d;let p=[],f=[];if(i||r)for(let m of e.events??[])for(let h of m.drawDefinitions??[])for(let g of h.structures??[])f.push(...g.matchUps??[]),p.push(Ve({eventId:m.eventId,eventName:m.eventName,eventType:m.eventType,drawId:h.drawId,drawName:h.drawName,drawType:h.drawType,structureId:g.structureId,structureName:g.structureName,stage:g.stage,stageSequence:g.stageSequence,positionAssignments:g.positionAssignments,seedAssignments:g.seedAssignments,matchUpFormat:g.matchUpFormat}));if(r&&(a.structures=p),i){let m=e.participants?.filter(S=>S.participantType===gt).length??0,h=e.participants?.filter(S=>S.participantType===Lt).length??0,g=e.events?.length??0,I=f?.filter(S=>S.matchUpStatus!=="BYE"),v=I?.length,w=I?.filter(S=>Yi.includes(S.matchUpStatus)||S.winningSide)?.length,y=I?.filter(S=>uf({matchUp:S})?.scheduledDate||tL({matchUp:S})?.scheduledTime)?.length,b=v>0?Math.round(w/v*100):0;a.matchUpStats={total:v,completed:w,scheduled:y,percentComplete:b},a.individualParticipantCount=m,a.teamParticipantCount=h,a.eventCount=g}if(n){let{venues:m}=Cu({tournamentRecord:e});a.venues=m??[]}return{tournamentInfo:ke(Ve(a),!1,!0),...H}}function M8({publishStatus:t,drawId:e}){return t?.drawDetails?Bo(t.drawDetails?.[e]?.publishingDetail):t?.drawIds?t.drawIds.includes(e):!0}var N8="PUBLIC",twe="ADMIN",iwe={PUBLIC_DISPLAY:N8,ADMIN_DISPLAY:twe};function zR(t){let{tournamentParticipants:e=[],includePositionAssignments:i,policyDefinitions:r,tournamentRecord:n,inContext:a=!0,usePublishState:s,status:o=Ha,pressureRating:l,refreshResults:u,contextProfile:c,drawDefinition:d,noDeepCopy:p,sortConfig:f,context:m,event:h}=t;if(!d)return{error:_e};let{matchUpFormat:g,updatedAt:I,drawType:v,drawName:w,drawId:y}=d,b={matchUpFormat:g,updatedAt:I,drawName:w,drawType:v,drawId:y};b.display=mt({element:d,name:BD}).extension?.value;let S={},U,T,{allStructuresLinked:P,sourceStructureIds:D,hasDrawFeedProfile:E,structureGroups:R}=LR({drawDefinition:d});if(!P)return{error:f6};let C=t?.eventPublishState??Ih({event:h}).publishState,M=t?.publishStatus??za({event:h,status:o}),N=C?.status?.drawDetails?.[d.drawId],A=!!C?.status?.published,O=N?.structureDetails,k=!1,F=!1,x=R.map(L=>{let $={},V=L.map(_=>{let{structure:B}=et({drawDefinition:d,structureId:_}),{seedAssignments:G}=ds({drawDefinition:d,structure:B});return B?.stage===xe&&B.stageSequence===1&&(U=G),B?.stage===We&&(S[B.stageSequence??0]=G),B}).sort((_,B)=>uh(_,B,f)).map(_=>{if(!_)return;let B=_?.structureId,G=[];_.stage&&[xe,Zr,Ui].includes(_.stage)&&(G=U),_?.stage===We&&(G=S[_.stageSequence??0]);let{matchUps:j,roundMatchUps:K,roundProfile:Y}=Nt({seedAssignments:_?.seedAssignments?.length?void 0:G,context:{drawId:b.drawId,...m},hydrateParticipants:t.hydrateParticipants,participantsProfile:t.participantsProfile,tournamentParticipants:e,policyDefinitions:r,tournamentRecord:n,usePublishState:s,publishStatus:M,contextProfile:c,drawDefinition:d,inContext:a,structure:_,event:h}),{positionAssignments:X}=Yt({structure:_}),Z=X?.filter(ba(su)).map(ne=>{let le=mt({element:ne,name:dc})?.extension?.value,{drawPosition:de,participantId:pe}=ne;return F=!0,{participantResult:le,participantId:pe,drawPosition:de}});if(j.length&&(!Z?.length&&t.allParticipantResults||u&&!_.structures)){let{subOrderMap:ne}=cL({positionAssignments:X}),le=j.some(pe=>pe.matchUpType===ka)?j.filter(pe=>pe.matchUpType===ka):j,de=gh({matchUpFormat:_.matchUpFormat,matchUps:le,policyDefinitions:r,pressureRating:l,subOrderMap:ne});T=de?.report,Z=X?.filter(ba(su)).map(pe=>{let{drawPosition:ge,participantId:Me}=pe;return F=!0,{participantResult:Me&&de?.participantResults?.[Me],participantId:Me,drawPosition:ge}})}let J=_?{stageSequence:_.stageSequence,structureName:_.structureName,structureType:_.structureType,matchUpFormat:_.matchUpFormat,stage:_.stage}:{},ae=mt({element:_,name:BD}).extension?.value;J.display=ae?.[N8]??ae,J.sourceStructureIds=D[B],J.hasDrawFeedProfile=E[B],J.positionAssignments=X,J.structureActive=j.reduce((ne,le)=>{let de=[wi,Hi,ao,ki,kc,Qt,$r,mi].includes(le.matchUpStatus);return ne||de||!!le.winningSide||!!le.score?.scoreStringSide1},!1);let te=j.every(ne=>[...Yi,"BYE"].includes(ne.matchUpStatus));return J.structureCompleted=te,$[B]=te,J.structureActive&&(k=!0),{...J,participantResults:Z,seedAssignments:G,roundMatchUps:K,roundProfile:Y,structureId:B,report:T}});return V.forEach(_=>{i||delete _.positionAssignments,_.sourceStructuresComplete=_.sourceStructureIds?.every(B=>$[B])}),V}).flat().filter(L=>!s||Bo(O?.[L?.structureId])||!0);return b.drawActive=k,b.participantPlacements=F,b.drawGenerated=x?.reduce((L,$)=>L||!!$?.roundMatchUps,!1),b.drawCompleted=x?.reduce((L,$)=>L&&$.structureCompleted,!0),b.drawPublished=s?A&&M8({publishStatus:M,drawId:b.drawId}):void 0,{structures:!s||b.drawPublished?p&&x||ke(x,!1,!0):void 0,drawInfo:p?b:ke(b,!1,!0),...H}}function TS(t){let{includePositionAssignments:e,participantsProfile:i,policyDefinitions:r,usePublishState:n,status:a=Ha,contextProfile:s,sortConfig:o}=t,l=Ge(t,[{tournamentRecord:!0},{[bF]:{event:!1,eventId:!1}}]);if(l.error)return l;let u=ke(t.tournamentRecord,!1,!0),c=t.event==null?jn({tournamentRecord:u,eventId:t.eventId}).event:void 0,d=t.event?ke(t.event,!1,!0):c&&ke(c,!1,!0)||void 0;if(!d)return{error:os};let{eventId:p}=d,{tournamentId:f,endDate:m}=u,h=za({event:d,status:a}),g=Ih({event:d}).publishState??{},I=!!g?.status?.published,{participants:v}=Ei({participantFilters:t.participantFilters,withEvents:!1,withDraws:!1,policyDefinitions:r,...i,tournamentRecord:u}),w=({stage:C,drawId:M})=>{if(!n)return!0;let N=h?.drawDetails?.[M]?.stageDetails;return!N||!Object.keys(N).length?!0:Bo(N[C])},y=({structureId:C,drawId:M})=>{if(!n)return!0;let N=h?.drawDetails?.[M]?.structureDetails;return!N||!Object.keys(N).length?!0:Bo(N[C])},b=({drawId:C})=>n?M8({publishStatus:h,drawId:C}):!0,S=({drawId:C,drawType:M,structure:N})=>{if(!n||M!==ra)return N;let A=h?.drawDetails?.[C]?.structureDetails?.[N.structureId]?.roundLimit;if(ot(A)){let O=Re(1,A+1),k={},F={};for(let x of O)N.roundMatchUps[x]&&(k[x]=N.roundMatchUps[x],F[x]=N.roundProfile[x]);N.roundMatchUps=k,N.roundProfile=F}return N},U=d.drawDefinitions||[],T=!n||I?U.filter(b).map(C=>(({drawInfo:M,structures:N})=>({...M,structures:N}))(zR({allParticipantResults:t.allParticipantResults,hydrateParticipants:t.hydrateParticipants,context:{eventId:p,tournamentId:f,endDate:m},pressureRating:t.pressureRating,refreshResults:t.refreshResults,includePositionAssignments:e,tournamentParticipants:v,eventPublishState:g,noDeepCopy:!0,policyDefinitions:r,tournamentRecord:u,usePublishState:n,contextProfile:s,drawDefinition:C,publishStatus:h,sortConfig:o,event:d}))).map(({structures:C,...M})=>{let N=C?.filter(({stage:A,structureId:O})=>y({structureId:O,drawId:M.drawId})&&w({stage:A,drawId:M.drawId})).map(A=>S({drawId:M.drawId,drawType:M.drawType,structure:A}));return{...M,structures:N}}).filter(C=>C.structures?.length):void 0,P=(Array.isArray(u.venues)?u.venues:[]).map(C=>{let{venueData:M}=aI({venueId:C.venueId,tournamentRecord:u});return{...M}}),D=(({eventId:C,eventName:M,eventType:N,eventLevel:A,surfaceCategory:O,matchUpFormat:k,category:F,gender:x,startDate:L,endDate:$,ballType:V,discipline:_})=>({eventId:C,eventName:M,eventType:N,eventLevel:A,surfaceCategory:O,matchUpFormat:k,category:F,gender:x,startDate:L,endDate:$,ballType:V,discipline:_}))(d);D.display=mt({element:d,name:BD}).extension?.value;let{tournamentInfo:E}=Uh({tournamentRecord:u}),R={tournamentInfo:E,venuesData:P,eventInfo:D,drawsData:T};return R.eventInfo.publishState=g,R.eventInfo.published=g?.status?.published,{...H,eventData:R,participants:v}}function KL({byeAdvancements:t=!1,tournamentRecord:e,drawDefinition:i,event:r}){if(!i)return{error:_e};let{participantIds:n,participantIdMatchUps:a}=$be({tournamentParticipants:e?.participants,drawDefinition:i}),s=Object.values(a).some(p=>p.some(f=>f.containerStructureId)),o=(s&&TS({tournamentRecord:e,event:r}))?.eventData?.drawsData?.find(p=>p.drawId===i.drawId)?.structures,l=i?.structures?.find(p=>p.stage===xe&&p.stageSequence===1),u=l?.structureType===fn&&l.structures,c=(s?lI({tournamentRecord:e,drawDefinition:i,structureId:l?.structureId})?.positionAssignments:void 0)?.length||0,d=n?.map(p=>{let f=a[p].filter(I=>[ki,"BYE"].includes(I.matchUpStatus)||I.winningSide),m=f.map(I=>{let v=I.sides.find(y=>y.bye),w=I.sides.find(y=>y.participantId===p).sideNumber;if(I.containerStructureId){let y=rwe({containedStructures:u,drawPositionsCount:c,drawDataStructures:o,drawDefinition:i,participantId:p,matchUp:I});if(y)return y}return(I.winningSide||t&&v&&w)===w?I.finishingPositionRange.winner:I.finishingPositionRange.loser}),h=I=>Math.abs(I[0]-I[1]),g=m.reduce((I,v)=>I&&h(I)<h(v)?I:v,void 0);return{[p]:{finishingPositionRanges:m,finishingPositionRange:g,relevantMatchUps:f}}})||[];return Object.assign({},...d)}function rwe({containedStructures:t,drawPositionsCount:e,drawDataStructures:i,drawDefinition:r,participantId:n,matchUp:a}){let s=t?.find(f=>f.structureId===a.structureId)?.positionAssignments?.length,o=i.find(f=>f.structureId===a.containerStructureId)?.participantResults?.find(f=>f.participantId===n)?.participantResult,{ties:l,groupOrder:u,provisionalOrder:c}=o||{},d=t?.length,p=r.structure?.find(f=>f.stage===Ui);if(ia()&&console.log({drawPositionsCount:e,provisionalOrder:c,bracketsCount:d,bracketSize:s,groupOrder:u,ties:l}),e===s&&u)return[u,u];if(d>1&&u&&!p)return[1,d];if(d>1&&u&&p){let f=r.links?.find(h=>h.source.structureId===a.containerStructureId)?.source?.finishingPositions,m=f.length*d;if(u in f)return[1,m];{let h=(s-u)*d;return[m+1,e-h]}}}function Gd({tournamentRecords:t,tournamentRecord:e,tournamentId:i,drawId:r}){if(!e&&!t)return{error:Ie};if(!r)return{error:Oo};if(!e&&t){if(typeof i!="string"&&(i=p8({tournamentRecords:t,drawId:r}),!i))return{error:zg};if(e=t[i],!e)return{error:Ie}}let n=e&&jn({tournamentRecord:e,drawId:r});return n?.drawDefinition?{drawDefinition:n.drawDefinition,event:n.event,tournamentRecord:e,...H}:z({result:{error:Oa},stack:"findDrawDefinition"})}function XL(t){let{drawDefinition:e,error:i}=Gd(t);return i?{error:i}:{drawDefinition:ke(e)}}function nwe({tournamentParticipants:t,returnParticipants:e,drawPosition:i,participant:r,drawId:n,event:a}){let s=a?.entries?.filter(({entryStatus:o})=>[ys,sf].includes(o)).map(({participantId:o})=>o)||[];if(s.length){let o=r.individualParticipantIds,l=e?t.filter(({participantId:c})=>s.includes(c)):void 0,u=e?t.filter(({participantId:c})=>o.includes(c)):void 0;return{validModifyAssignedPairAction:Ve({payload:{participantId:r.participantId,replacementIndividualParticipantId:void 0,existingIndividualParticipantId:void 0,drawPosition:i,drawId:n},method:sbe,availableIndividualParticipantIds:s,availableIndividualParticipants:l,existingIndividualParticipantIds:o,existingIndividualParticipants:u,type:AL},!1,!1,!0)}}return{}}function kp(t){let{inContextDrawMatchUps:e,targetData:i,drawDefinition:r,relevantLink:n}=t;if(n?.linkCondition===al&&i?.matchUp?.matchUpStatus==="BYE")return!1;let{targetMatchUps:{loserMatchUp:a,winnerMatchUp:s},targetLinks:o}=i,l=a&&On({matchUpId:a.matchUpId,inContextDrawMatchUps:e,drawDefinition:r}),u=l?.targetMatchUps?.loserMatchUp,c=l?.targetMatchUps?.loserMatchUpDrawPositionIndex,d=u?.sides[c]?.participant,p=Fr(a?.matchUpStatus),f=p&&!d,m=a?.sides?.filter(w=>w?.participant).length??0,h=a?.winningSide&&p&&m===1,g=s?.drawPositions?.filter(Boolean).length||0;if(!h&&(a?.winningSide&&!f||s?.winningSide&&g===2&&(!s.feedRound||!Fr(s?.matchUpStatus))))return!0;let I=s&&On({matchUpId:s.matchUpId,inContextDrawMatchUps:e,drawDefinition:r}),v=l&&kp({relevantLink:o?.loserTargetLink,targetData:l,inContextDrawMatchUps:e,drawDefinition:r});return!!(I&&kp({targetData:I,inContextDrawMatchUps:e,drawDefinition:r})||v)}var awe={[Ep]:{policyName:"positionActionsDefault",enabledStructures:[{stages:[We,xe],stageSequences:[1],enabledActions:[],disabledActions:[]},{stages:[],stageSequences:[],enabledActions:[QD,oI,_R,Fy],disabledActions:[]}],disbledStructures:[],otherFlightEntries:!1,activePositionOverrides:[]}},ZT="positionAction",yO="matchUpAction";function A8({actionType:t=ZT,appliedPolicies:e,drawDefinition:i,structure:r}){let n=t===ZT&&Ep||t===yO&&Er,a=t===ZT&&awe||t===yO&&d7,s=n&&(e?.[n]||a?.[n]),o=i.links?.filter(d=>d?.target?.structureId===r?.structureId)?.map(({target:d})=>d.feedProfile)??[],{enabledStructures:l,disabledStructures:u}=s||{},c=u?.find(d=>{let{stages:p,stageSequences:f,structureTypes:m,feedProfiles:h}=d;return(!h?.length||Array.isArray(h)&&h.some(g=>o.includes(g)))&&(!p?.length||Array.isArray(p)&&p?.includes(r?.stage))&&(!m?.length||Array.isArray(m)&&m?.includes(r?.structureType))&&(!f?.length||Array.isArray(f)&&f.includes(r?.stageSequence))});return{enabledStructures:l,actionsDisabled:c,actionsPolicy:s}}function swe({activePositionOverrides:t,activeDrawPositions:e,action:i}){return i&&t.includes(i)?!0:!e.length}function k8({enabledStructures:t,drawDefinition:e,structure:i}){if(t===!1)return{};if(!t?.length)return{policyActions:{enabledActions:[],disabledActions:[]}};let{stage:r,stageSequence:n,structureType:a}=i||{},s=e.links?.filter(o=>o?.target?.structureId===i?.structureId)?.map(({target:o})=>o.feedProfile)||[];return{policyActions:t.find(o=>{let{stages:l,stageSequences:u,structureTypes:c,feedProfiles:d}=o||{},p=!l?.length||Array.isArray(l)&&l.includes(r),f=!u?.length||Array.isArray(u)&&u.includes(n),m=!c?.length||Array.isArray(c)&&c.includes(a),h=!d?.length||Array.isArray(d)&&d.some(g=>s.includes(g));return f&&m&&h&&o&&p})}}function Jn({action:t,policyActions:e}){let i=!e?.enabledActions||e?.disabledActions?.length&&e.disabledActions.includes(t);return i?!1:(e?.enabledActions.length===0||e?.enabledActions.includes(t))&&!i}var O8="replaceTieMatchUpParticipantId",x8="assignTieMatchUpParticipantId",bO="removeTieMatchUpParticipantId",QH="assignMatchUpSideParticipant",owe="removeMatchUpSideParticipant",F8="substituteParticipant",wO="REMOVE_SUBSTITUTION",L8="REPLACE_PARTICIPANT",JL="REMOVE_PARTICIPANT",SO="setMatchUpStatus",UO="SUBSTITUTION",_8="SCHEDULE",lwe="PENALTY",TO="REFEREE",$8="STATUS",DO="START",B8="SCORE",uwe={REPLACE_TEAM_POSITION_METHOD:O8,ASSIGN_TEAM_POSITION_METHOD:x8,REMOVE_TEAM_POSITION_METHOD:bO,REPLACE_PARTICIPANT:L8,SUBSTITUTION_METHOD:F8,REMOVE_SUBSTITUTION:wO,REMOVE_PARTICIPANT:JL,SCHEDULE_METHOD:SO,SUBSTITUTION:UO,SCHEDULE:_8,PENALTY:lwe,REFEREE:TO,STATUS:$8,SCORE:B8,START:DO,END:"END"};function cwe({specifiedPolicyDefinitions:t,inContextDrawMatchUps:e,matchUpParticipantIds:i,matchUpActionsPolicy:r,inContextMatchUp:n,policyActions:a,enforceGender:s,participantId:o,sideNumber:l,matchUpId:u,matchUp:c,drawId:d,side:p}){let f=[],m=n.sides?.find(M=>M.participant),h=Na(n.gender)&&n.sideNumber&&n.sides?.filter(M=>M.particiapntId).length===1&&m?.participant?.person?.sex,g=n.matchUpType,I=(s??r?.participants?.enforceGender)!==!1?n.gender:void 0,v=n.sides?.flatMap(M=>M.participant?.individualParticipants||M.participant).filter(Boolean)?.map(vt),w=n.sides?.filter(M=>!l||M.sideNumber===l).flatMap(M=>M.participant?.individualParticipants||M.participant).filter(Boolean),y=w?.map(vt),b=e?.find(M=>M.matchUpId===n.matchUpTieId)?.sides?.map(M=>M?.participant?.individualParticipants?.filter(({participantId:N,person:A})=>!y?.includes(N)&&(!I||eu(I)||A.sex===I||Na(I)&&!h||h&&A.sex!==h))),S=l?b?.[l-1]:b?.map((M,N)=>({participants:M,sideNumber:N+1})),U=l?b?.[l-1]?.map(vt):b?.map((M,N)=>({participants:M?.map(vt),sideNumber:N+1})),T=l&&(Di(Qf)(g)&&!y?.length||Di(wp)(g)&&(y?.length??0)<2)||!l&&(Di(Qf)(g)&&(y?.length??0)<2||Di(wp)(g)&&(y?.length??0)<4),P=U?.filter(M=>!v?.includes(M)),D=S?.filter(({participantId:M})=>P.includes(M));if(T&&P?.length&&f.push({availableParticipantIds:P,method:x8,availableParticipants:D,type:Am,payload:{participantId:void 0,tieMatchUpId:u,sideNumber:l,drawId:d}}),y?.length&&(!cr(c)||p?.substitutions?.length)&&f.push({method:bO,type:JL,existingParticipantIds:y,payload:{participantId:void 0,tieMatchUpId:u,drawId:d}}),D?.length&&(!l&&y?.length||l&&p?.participant)&&f.push({availableParticipantIds:P,method:O8,availableParticipants:D,type:L8,existingParticipantIds:y,payload:{existingParticipantId:void 0,participantId:void 0,tieMatchUpId:u,drawId:d}}),Jn({policyActions:a,action:wO})&&p?.substitutions?.length){let M=p.participant?.participantType===gt&&[p.participantId]||p.participant?.participantType===pt&&p.participant.individualParticipantIds||[],N=p.substitutions.map(A=>A.participantId).filter(A=>M.includes(A));(!o||N.includes(o))&&f.push({method:bO,type:wO,substitutedParticipantIds:N,payload:{participantId:void 0,tieMatchUpId:u,drawId:d}})}let E=t?.[Er],R=E?.substituteWithoutScore,C=E?.substituteAfterCompleted;if(Jn({policyActions:a,action:UO})&&i.length===2&&(!l&&y?.length||l&&p?.participant)&&(R||cr(c))&&(C||c.matchUpStatus&&!Yi.includes(c.matchUpStatus))&&w?.length&&S.length){let M=w.map(vt);f.push({info:"list of team players available for substitution",method:F8,availableParticipantIds:U,existingParticipantIds:M,availableParticipants:S,existingParticipants:w,type:UO,payload:{substituteParticipantId:void 0,existingParticipantId:void 0,sideNumber:l,matchUpId:u,drawId:d}})}return f}function dwe({tournamentParticipants:t=[],possiblyDisablingAction:e,activeDrawPositions:i,positionAssignments:r,returnParticipants:n,appliedPolicies:a,drawDefinition:s,drawPosition:o,validActions:l,structureId:u,structure:c,drawId:d,event:p}){if(i.includes(o))return{};let f=l.find(U=>U.type===Am)?.availableParticipantIds,m=a?.[Ep]?.otherFlightEntries,h=a?.[Ep]?.restrictQualifyingAlternates,g=(s.entries??[]).filter(({entryStage:U})=>!h||(c.stage===We?U===We:U!==We)).sort((U,T)=>(U.entryPosition??1/0)-(T.entryPosition??1/0)).map(({participantId:U})=>U).filter(Boolean),{allPositionedParticipantIds:I}=Q5({drawDefinition:s}),v=r.map(U=>U.participantId).filter(Boolean),w=g.filter(U=>c.stage&&[We,xe,Ui].includes(c.stage)?!I?.includes(U):!v.includes(U)),y=(p?.entries??[]).filter(U=>U.entryStatus===Fs&&V8({restrictQualifyingAlternates:h,structure:c,entry:U})&&(c.stage&&[We,xe,Ui].includes(c.stage)?!I?.includes(U.participantId):!v.includes(U.participantId))).sort((U,T)=>(U.entryPosition??1/0)-(T.entryPosition??1/0)).map(U=>U.participantId),b=rt(w.concat(y));if(m){let U=(p?$i({event:p}).flightProfile:void 0)?.flights?.filter(T=>T.drawId!==d).map(T=>T.drawEntries.filter(P=>P.participantId&&![mc,ys,sf].includes(P.entryStatus)&&!g.includes(P.participantId)).map(({participantId:P})=>P)).flat().filter(Boolean);U?.length&&b.push(...U)}f?.length&&(b=b.filter(U=>!f.includes(U)));let S=n?t?.filter(U=>b.includes(U.participantId)):void 0;return S?.forEach(U=>{let T=(s.entries??[]).find(P=>P.participantId===U.participantId);U.entryPosition=T?.entryPosition}),S?.sort((U,T)=>(U.entryPosition||1/0)-(T.entryPosition||1/0)),b.length?{validAlternatesAction:Ve({payload:{drawId:d,structureId:u,drawPosition:o},willDisableLinks:e,method:nbe,availableAlternatesParticipantIds:b,type:kL,availableAlternates:S})}:{}}function V8({restrictQualifyingAlternates:t,structure:e,entry:i}){let{stage:r}=e;if(!i.entryStage||i.entryStage===r||r===We&&!t||i.entryStage===xe&&r===Zr)return!0}function pwe({eventEntries:t,structure:e}){let i=n=>n.entryStatus===Fs&&V8({structure:e,entry:n}),r=(n,a)=>(n.entryPosition||1/0)-(a.entryPosition||1/0);return t.filter(i).sort(r).map(vt)}function fwe({restrictAdHocRoundParticipants:t,tournamentParticipants:e,matchUpParticipantIds:i,otherFlightEntries:r,drawDefinition:n,structureId:a,sideNumber:s,matchUpId:o,structure:l,matchUp:u,drawId:c,event:d}){let p=[],f=l?.matchUps??[],m=u.sides?.find(T=>T.sideNumber===s)?.participantId,h=f.filter(({roundNumber:T})=>T===u.roundNumber),g=n?.entries?.filter(({entryStatus:T})=>T&&of.includes(T)).map(vt)??[],I=h.map(T=>(T.sides??[]).flatMap(vt)).flat().filter(Boolean),v=g.filter(T=>!i.includes(T)&&(!t||!I.includes(T))),w=e?.filter(T=>v?.includes(T.participantId)).map(T=>ke(T,void 0,!0));w?.forEach(T=>{let P=(n.entries??[]).find(D=>D.participantId===T.participantId);T.entryPosition=P?.entryPosition}),v.length&&p.push({payload:{drawId:c,matchUpId:o,structureId:a,sideNumber:s},method:QH,type:Am,availableParticipantIds:v,participantsAvailable:w});let y=d?.entries??[],b=pwe({eventEntries:y,structure:l}),S=rt(g.concat(b));if(r){let T=(d?$i({event:d}):void 0)?.flights?.filter(P=>P.drawId!==c).flatMap(P=>P.drawEntries.filter(D=>D.participantId&&![mc,ys,sf].includes(D.entryStatus)).map(({participantId:D})=>D)).filter(Boolean);T?.length&&S.push(...T)}S=S.filter(T=>!i.includes(T)&&!v.includes(T)&&(!t||!I.includes(T)));let U=e?.filter(T=>S.includes(T.participantId)).map(T=>ke(T,void 0,!0));if(U?.forEach(T=>{let P=(n.entries??[]).find(D=>D.participantId===T.participantId);T.entryPosition=P?.entryPosition}),U?.sort((T,P)=>(T.entryPosition||1/0)-(P.entryPosition||1/0)),S.length&&p.push({payload:{drawId:c,matchUpId:o,structureId:a,sideNumber:s},availableParticipantIds:S,participantsAvailable:U,method:QH,type:Fs}),!cr(u)&&s&&m){p.push({payload:{drawId:c,matchUpId:o,structureId:a,sideNumber:s},method:owe,type:JL});let T=A=>A.sides.map(vt),P=({matchUpId:A})=>A!==u.matchUpId,D=A=>!cr(A),E=u.sides?.find(A=>A.sideNumber!==s)?.participantId,R=f.filter(({roundNumber:A})=>A!==u.roundNumber).filter(P).map(T),C=[E,...R.filter(A=>A.includes(m)).flat()].filter(Boolean),M=A=>!C.flat().includes(A),N=h.filter(D).filter(P).map(T).flat().filter(M);if(N.length){let A=e?.filter(O=>N.includes(O.participantId)).map(O=>ke(O,void 0,!0));p.push({payload:{participantIds:[m],roundNumber:u.roundNumber,structureId:a,sideNumber:s,matchUpId:o,drawId:c},swappableParticipantIds:N,method:obe,type:$R,swappableParticipants:A})}}return p}function qR(t){if(!t)return{error:ie};let{drawDefinition:e,event:i}=t,{restrictAdHocRoundParticipants:r=!0,policyDefinitions:n,enforceGender:a,participantId:s,sideNumber:o,matchUpId:l}=t,u=t.tournamentRecord??(t.tournamentId&&ri(t.tournamentId)&&t.tournamentRecords?.[t.tournamentId]);if(!u)return{error:Ie};if(!l||!ri(l))return{error:Un};if(o&&![1,2].includes(o))return z({result:{error:ie},context:{sideNumber:o}});if(!e){let Y=(br({tournamentRecord:u}).matchUps??[]).find(Z=>Z.matchUpId===l);i=(u?.events??[]).find(Z=>Z.eventId===Y?.eventId);let X=(i?.drawDefinitions??[]).find(Z=>Z.drawId===Y?.drawId);X&&(e=X)}if(!e)return{error:_e};let c=Ei({withIndividualParticipants:!0,tournamentRecord:u}).participants,{drawId:d}=e,{matchUp:p,structure:f}=di({drawDefinition:e,matchUpId:l,event:i});if(!p)return{error:un};let m=Tt({tournamentRecord:u,drawDefinition:e,structure:f,event:i}).appliedPolicies??{};Object.assign(m,n??{});let h=m?.[Ep]?.otherFlightEntries,g=m?.[Er]??cv[Er],{enabledStructures:I}=A8({actionType:yO,appliedPolicies:m,drawDefinition:e,structure:f}),{policyActions:v}=k8({enabledStructures:I,drawDefinition:e,structure:f}),w=t.matchUpsMap??Ar({drawDefinition:e}),y=t.inContextDrawMatchUps??Qi({tournamentParticipants:c,inContext:!0,drawDefinition:e,matchUpsMap:w,event:i}).matchUps,b=y?.find(Y=>Y.matchUpId===l),S=o&&b?.sides?.find(Y=>Y.sideNumber===o),U=b?.sides?.map(Y=>Y.participantId||Y.participant?.participantid).filter(Boolean)??[],{assignedPositions:T,allPositionsAssigned:P}=ur({structure:f}),{structureId:D}=f??{},E=[];if(!D)return{validActions:E};let R=Vn({structure:f}),C=!!p.collectionId;if(R&&!C){let Y=fwe({restrictAdHocRoundParticipants:r,tournamentParticipants:c,matchUpParticipantIds:U,otherFlightEntries:h,drawDefinition:e,structureId:D,sideNumber:o,matchUpId:l,structure:f,matchUp:p,drawId:d,event:i});E.push(...Y)}let M=uu({drawDefinition:e,structure:f}),N=T?.filter(Y=>Y.participantId).map(Y=>Y.drawPosition),A=T?.filter(Y=>Y.bye).map(Y=>Y.drawPosition),O=p.matchUpStatus==="BYE"||!C&&p.drawPositions?.reduce((Y,X)=>A?.includes(X)||Y,!1);if(O)return{validActions:E,isByeMatchUp:O};Jn({policyActions:v,action:TO})&&E.push({type:TO,payload:{matchUpId:l}});let k=!sS({matchUpStatus:p.matchUpStatus}),F=m?.scoring?.structures,x=f?.stage&&F?.stage?.[f.stage],L=f?.stageSequence&&x?.stageSequence?.[f.stageSequence],$=!(m?.scoring?.requireAllPositionsAssigned||x?.requireAllPositionsAssigned||L?.requireAllPositionsAssigned)||P,V=p.sides?.filter(Y=>Y?.participantId).length===2,_=p.matchUpStatus&&[wi,Hi].includes(p.matchUpStatus),B=On({inContextDrawMatchUps:y,drawDefinition:e,matchUpId:l}),G=kp({inContextDrawMatchUps:y,drawDefinition:e,targetData:B}),j=(b?.drawPositions?.length===2&&b.drawPositions.every(Y=>N?.includes(Y))&&b?.sides?.length===2&&b.sides.every(({participantId:Y})=>Y)||V)&&!(_&&G),K={method:Q7,type:oI,payload:{drawId:d,matchUpId:l,penaltyCode:void 0,penaltyType:void 0,participantIds:[],notes:void 0}};if(k&&E.push({payload:{drawId:d,matchUpId:l,schedule:{}},method:SO,type:_8}),Jn({policyActions:v,action:oI})&&(S?.participant||!o&&U?.length)&&E.push(K),k&&j&&E.push({type:$8}),$&&j){let{matchUpId:Y,matchUpFormat:X}=p,Z={drawId:d,matchUpId:Y,matchUpFormat:X,outcome:{scoreStringSide1:void 0,scoreStringSide2:void 0,sets:[]},winningSide:void 0};E.push({info:"set outcome and winningSide",method:SO,type:B8,payload:Z}),Jn({policyActions:v,action:DO})&&E.push({type:DO}),Jn({policyActions:v,action:"END"})&&E.push({type:"END"})}if(C&&b){let Y=cwe({specifiedPolicyDefinitions:n,inContextDrawMatchUps:y,matchUpParticipantIds:U,matchUpActionsPolicy:g,inContextMatchUp:b,policyActions:v,enforceGender:a,participantId:s,sideNumber:o,matchUpId:l,matchUp:p,drawId:d,side:S});E.push(...Y)}return{structureIsComplete:M,validActions:E,isDoubleExit:_,...H}}function mwe({tournamentParticipants:t=[],sourceStructuresComplete:e,possiblyDisablingAction:i,isWinRatioFedStructure:r,activeDrawPositions:n,positionAssignments:a,drawDefinition:s,drawPosition:o,structureId:l,structure:u,drawId:c,event:d}){if(n.includes(o)||r&&!e)return{};let{sourceStructureIds:p,targetStructureIds:f}=s.links?.reduce((I,v)=>{let w=v.source?.structureId,y=v.target?.structureId;return I.sourceStructureIds.includes(w)||I.sourceStructureIds.push(w),I.targetStructureIds.includes(y)||I.targetStructureIds.push(y),I},{sourceStructureIds:[],targetStructureIds:[]})||{},m=[],h=s.links?.filter(I=>I.target?.structureId===u.structureId)??[];for(let I of h){let v=I?.source?.structureId,{structure:w}=et({structureId:v,drawDefinition:s}),y=w?.finishingPosition===oh&&(p?.length!==1||f?.length!==1),b={};if(y){let{matchUps:T}=Nt({drawDefinition:s,structure:u,event:d}),{initialRoundNumber:P}=Mm({drawPosition:o,matchUps:T}),D=s.links?.find(E=>E.target?.structureId===u?.structureId&&E.target.roundNumber===P)?.source?.roundNumber;b.roundNumbers=[D]}let{completedMatchUps:S}=NR({structureId:v,inContext:!0,matchUpFilters:b,drawDefinition:s}),U=a.map(T=>T.participantId).filter(Boolean);S?.filter(({matchUpType:T,winningSide:P})=>P&&(d?.eventType!==rr||T===rr)).map(({winningSide:T,sides:P})=>T&&P?.[1-(T-1)]).map(vt).filter(T=>T&&!U.includes(T))?.forEach(T=>{m.includes(T)||m.push(T)})}let g=t?.filter(I=>m?.includes(I.participantId));return g?.forEach(I=>{let v=(s.entries??[]).find(w=>w.participantId===I.participantId);I.entryPosition=v?.entryPosition}),m?.length?{validLuckyLosersAction:{type:xL,method:abe,availableLuckyLosers:g,availableLuckyLoserParticipantIds:m,willDisableLinks:i,payload:{drawId:c,structureId:l,drawPosition:o}}}:{}}function hwe({positionSourceStructureIds:t,unassignedParticipantIds:e,possiblyDisablingAction:i,provisionalPositioning:r,tournamentParticipants:n,isWinRatioFedStructure:a,positionAssignments:s,returnParticipants:o,appliedPolicies:l,drawDefinition:u,seedingProfile:c,isByePosition:d,drawPosition:p,structureId:f,event:m}){let{drawId:h}=u,g=[],I,v,w=[],y=l?.[fo]?.validSeedPositions?.ignore;if(y||({unplacedSeedParticipantIds:I,unplacedSeedAssignments:v,unfilledPositions:w}=T7({provisionalPositioning:r,returnAllProxies:!0,randomize:!0,drawDefinition:u,seedingProfile:c,structureId:f})),w?.length||(w=s.filter(b=>!b.participantId&&!b.bye&&!b.qualifier).map(b=>b.drawPosition)),d||g.push({payload:{drawId:h,structureId:f,drawPosition:p,isPositionAction:!0},willDisableLinks:i,method:cbe,type:"BYE"}),a&&y){let b=s.map(D=>D.participantId).filter(Boolean),S={structureIds:t},{completedMatchUps:U}=ov({inContext:!0,matchUpFilters:S,drawDefinition:u}),T=rt((U??[]).filter(({matchUpType:D})=>m?.eventType!==rr||D===rr)?.map(({sides:D})=>D?.map(vt)).flat().filter(D=>D&&!b.includes(D))),P=o?n?.filter(D=>T?.includes(D.participantId)).map(D=>ke(D,void 0,!0)):void 0;return P?.forEach(D=>{let E=(u.entries??[]).find(R=>R.participantId===D.participantId);D.entryPosition=E?.entryPosition}),P?.length&&g.push(Ve({payload:{drawId:h,structureId:f,drawPosition:p},willDisableLinks:i,method:KH,type:Am,availableParticipantIds:T,participantsAvailable:P})),{validAssignmentActions:g}}if(w.includes(p)||d){let b;if(v?.length){let U=v.filter(T=>I?.includes(T.participantId));U.sort(gwe),b=U.map(T=>T.participantId)}else b=e;let S=o?n?.filter(U=>b.includes(U.participantId)).map(U=>ke(U,void 0,!0)):void 0;S?.length&&g.push(Ve({payload:{drawId:h,structureId:f,drawPosition:p},willDisableLinks:i,method:KH,type:Am,availableParticipantIds:b,participantsAvailable:S}))}return{validAssignmentActions:g}}function gwe(t,e){return t.bye||sI(t.seedValue)<sI(e.seedValue)||t.seedValue&&!e.seedValue?-1:(t.seedNumber||0)-(e.seedNumber||0)}function Iwe({drawPositionInitialRounds:t,tournamentParticipants:e,positionAssignments:i,returnParticipants:r,appliedPolicies:n,drawDefinition:a,drawPosition:s,structureId:o,drawId:l}){let u=[],c=[],d=[],p=[],f=new Set(i.map(b=>b.participantId).filter(Boolean)),m=n?.[Ep],h=!m?.disableRoundRestrictions&&t[s],g=m?.requireCompletedStructures,{sourceStructureIds:I,relevantLinks:v}=Pb({targetRoundNumber:h,linkType:ru,drawDefinition:a,structureId:o})||{};I?.length&&p.push(...I);let{sourceStructureIds:w,relevantLinks:y}=Pb({targetRoundNumber:h,linkType:iu,drawDefinition:a,structureId:o})||{};w?.length&&p.push(...w);for(let b of v){let S=a.structures?.find(T=>T.structureId===b.source.structureId);if(S?.stage!==We)continue;let U=uu({structureId:b.source.structureId,drawDefinition:a});if(!g||U){let T=S.qualifyingRoundNumber,{matchUps:P}=Nt({matchUpFilters:{roundNumbers:[T],isCollectionMatchUp:!1,hasWinningSide:!0},afterRecoveryTimes:!1,tournamentParticipants:e,inContext:!0,structure:S});for(let D of P){let E=D.sides.find(C=>C?.sideNumber===D.winningSide),R=D.matchUpStatus==="BYE"&&D.sides?.find(({participantId:C})=>C);if(E||R){let{participantId:C,participant:M}=E||R||{};C&&!f.has(C)&&(M&&r&&u.push(M),c.push(C))}}}}for(let b of y){let S=a.structures?.find(T=>T.structureId===b.source.structureId);if(S?.stage!==We)continue;let U=uu({structureId:b.source.structureId,drawDefinition:a});if(!g||U){let{positionAssignments:T}=Yt({structure:S}),P=T?.map(D=>{let E=D.participantId,R=mt({element:D,name:dc}).extension?.value;return R?{participantId:E,groupOrder:R?.groupOrder}:{}}).filter(({groupOrder:D,participantId:E})=>D===1&&!f.has(E)).map(({participantId:D})=>D)??[];if(P&&c.push(...P),r){let D=e.filter(({participantId:E})=>P.includes(E));u.push(...D)}}}return c.length&&d.push(Ve({qualifyingParticipants:r?u:void 0,method:ibe,type:_R,qualifyingParticipantIds:c,payload:{qualifyingParticipantId:void 0,drawPosition:s,structureId:o,drawId:l}})),{validAssignmentActions:d,sourceStructureIds:p}}function vwe({onlyAssignedPositions:t=!0,possiblyDisablingAction:e,tournamentParticipants:i,inactiveDrawPositions:r,activeDrawPositions:n,positionAssignments:a,returnParticipants:s,byeDrawPositions:o,drawDefinition:l,isByePosition:u,drawPosition:c,structureId:d,structure:p,drawId:f,event:m}){if(n.includes(c))return{};let h=D=>!t||D.participantId||D.qualifier||D.bye,g=r?.filter(D=>D!==c&&!(u&&o.includes(D))),I=a?.filter(D=>h(D)&&g?.includes(D.drawPosition))??[],v=I.map(({drawPosition:D})=>D),{matchUps:w}=Nt({afterRecoveryTimes:!1,inContext:!0,drawDefinition:l,structure:p,event:m}),y=w.filter(({drawPositions:D})=>kn(D,v)),b=Object.assign({},...y.map(D=>D.sides?.filter(({sourceDrawPositionRange:E})=>E).map(({drawPosition:E,sourceDrawPositionRange:R})=>({[E]:R}))).flat()),S=I.map(D=>D.participantId).filter(Boolean),U=(i??[]).filter(D=>S.includes(D.participantId)),T=Object.assign({},...U.map(D=>({[D.participantId]:D}))),P=I.map(D=>{let E=T?.[D.participantId],R=b[D.drawPosition];return Ve({...D,participant:s?ke(E,!1,!0):void 0,sourceDrawPositionRange:R})});return P.length?{validSwapAction:{payload:{drawId:f,structureId:d,drawPositions:[c]},willDisableLinks:e,method:J7,type:$R,availableAssignments:P}}:{}}function ywe(t,e){return t.filter(i=>!e.includes(i.participantId)).map(i=>i.participantId)}function bwe({validActions:t,policyActions:e,isActiveDrawPosition:i,positionAssignments:r,disablePlacementActions:n,positionAssignment:a,isByePosition:s,getValidAssignmentActions:o,positionSourceStructureIds:l,unassignedParticipantIds:u,possiblyDisablingAction:c,isWinRatioFedStructure:d,tournamentParticipants:p,returnParticipants:f,appliedPolicies:m,drawDefinition:h,drawPosition:g,structureId:I,event:v}){if(Jn({policyActions:e,action:Am})&&!i&&r&&!n&&(!a||s)){let{validAssignmentActions:w}=o({positionSourceStructureIds:l,unassignedParticipantIds:u,possiblyDisablingAction:c,isWinRatioFedStructure:d,tournamentParticipants:p,positionAssignments:r,returnParticipants:f,appliedPolicies:m,drawDefinition:h,isByePosition:s,drawPosition:g,structureId:I,event:v});w?.forEach(y=>t.push(y))}}function wwe({validActions:t,policyActions:e,isActiveDrawPosition:i,getValidQualifiersAction:r,drawPositionInitialRounds:n,tournamentParticipants:a,positionAssignments:s,returnParticipants:o,appliedPolicies:l,drawDefinition:u,drawPosition:c,structureId:d,drawId:p}){if(Jn({policyActions:e,action:_R})&&!i){let{validAssignmentActions:f}=r({drawPositionInitialRounds:n,tournamentParticipants:a,positionAssignments:s,returnParticipants:o,appliedPolicies:l,drawDefinition:u,drawPosition:c,structureId:d,drawId:p});f?.forEach(m=>t.push(m))}}function Swe({validActions:t,policyActions:e,isActiveDrawPosition:i,drawId:r,structureId:n,drawPosition:a,possiblyDisablingAction:s,isByePosition:o}){Jn({policyActions:e,action:vO})&&!i&&(t.push({type:vO,method:YH,payload:{drawId:r,structureId:n,drawPosition:a},willDisableLinks:s}),o||t.push({type:OL,method:rbe,payload:{drawId:r,structureId:n,drawPosition:a},willDisableLinks:s}),Jn({policyActions:e,action:"BYE"})&&!o&&t.push({type:"BYE",method:YH,payload:{drawId:r,structureId:n,drawPosition:a,replaceWithBye:!0},willDisableLinks:s}))}function Uwe({validActions:t,policyActions:e,activePositionsCheck:i,activePositionOverrides:r,activeDrawPositions:n,drawDefinition:a,structureId:s,drawPosition:o,structure:l,isByePosition:u,participantId:c,participant:d,drawId:p}){let f=l.stage===We||l.stage===xe&&l.stageSequence===1;if(!u&&i({activePositionOverrides:r,activeDrawPositions:n,action:Fy})&&Jn({policyActions:e,action:Fy})&&XD({drawDefinition:a,structureId:s,drawPosition:o})&&f){let{seedAssignments:m}=ds({returnAllProxies:!0,drawDefinition:a,structure:l}),{seedNumber:h,seedValue:g}=m?.find(I=>I.participantId===c)??{};t.push({type:Fy,method:dbe,participant:d,seedNumber:h,payload:{drawId:p,structureId:s,participantId:c,seedValue:g}})}if(!u&&i({activePositionOverrides:r,activeDrawPositions:n,action:QT})&&Jn({policyActions:e,action:QT})&&XD({drawDefinition:a,structureId:s,drawPosition:o})&&f){let{seedAssignments:m}=ds({returnAllProxies:!0,drawDefinition:a,structure:l}),{seedNumber:h}=m?.find(g=>g.participantId===c)??{};t.push({method:ube,type:QT,participant:d,seedNumber:h,payload:{participantId:c,structureId:s,drawId:p}})}}function Twe({validActions:t,policyActions:e,isByePosition:i,participantId:r,participant:n,drawId:a}){if(!i&&r){if(Jn({policyActions:e,action:oI})){let s={type:oI,method:Q7,participant:n,payload:{penaltyCode:void 0,penaltyType:void 0,participantIds:[],notes:void 0,drawId:a}};t.push(s)}if(Jn({policyActions:e,action:QD})){let s={type:QD,method:lbe,participant:n,payload:{participantId:r,otherName:void 0}};t.push(s)}}}function Dwe({validActions:t,policyActions:e,getValidSwapAction:i,possiblyDisablingAction:r,tournamentParticipants:n,inactiveDrawPositions:a,activeDrawPositions:s,positionAssignments:o,returnParticipants:l,byeDrawPositions:u,drawDefinition:c,isByePosition:d,drawPosition:p,structureId:f,structure:m,drawId:h}){if(Jn({policyActions:e,action:$R})){let{validSwapAction:g}=i({possiblyDisablingAction:r,tournamentParticipants:n,inactiveDrawPositions:a,activeDrawPositions:s,positionAssignments:o,returnParticipants:l,byeDrawPositions:u,drawDefinition:c,isByePosition:d,drawPosition:p,structureId:f,structure:m,drawId:h});g&&t.push(g)}}function Pwe({validActions:t,policyActions:e,getValidAlternatesAction:i,possiblyDisablingAction:r,tournamentParticipants:n,positionAssignments:a,activeDrawPositions:s,returnParticipants:o,appliedPolicies:l,drawDefinition:u,drawPosition:c,structureId:d,structure:p,drawId:f,event:m,disablePlacementActions:h}){if(Jn({policyActions:e,action:kL})&&!h){let{validAlternatesAction:g}=i({possiblyDisablingAction:r,tournamentParticipants:n,positionAssignments:a,activeDrawPositions:s,returnParticipants:o,appliedPolicies:l,drawDefinition:u,drawPosition:c,validActions:t,structureId:d,structure:p,drawId:f,event:m});g&&t.push(g)}}function Ewe({validActions:t,policyActions:e,getValidLuckyLosersAction:i,sourceStructuresComplete:r,possiblyDisablingAction:n,isWinRatioFedStructure:a,tournamentParticipants:s,activeDrawPositions:o,positionAssignments:l,drawDefinition:u,drawPosition:c,structureId:d,structure:p,drawId:f,disablePlacementActions:m,isActiveDrawPosition:h}){if(Jn({policyActions:e,action:xL})&&!m&&!h&&l){let{validLuckyLosersAction:g}=i({sourceStructuresComplete:r,possiblyDisablingAction:n,isWinRatioFedStructure:a,tournamentParticipants:s,activeDrawPositions:o,positionAssignments:l,drawDefinition:u,drawPosition:c,structureId:d,structure:p,drawId:f});g&&t.push(g)}}function Rwe({validActions:t,policyActions:e,getValidModifyAssignedPairAction:i,participant:r,tournamentParticipants:n,returnParticipants:a,drawPosition:s,drawId:o,event:l}){if(r?.participantType===pt&&Jn({policyActions:e,action:AL})){let{validModifyAssignedPairAction:u}=i({tournamentParticipants:n,returnParticipants:a,drawPosition:s,participant:r,drawId:o,event:l});u&&t.push(u)}}function QL(t){return Cwe(t)}function Cwe(t){let e=Ge(t,[{event:!0,drawDefinition:!0,structureId:!0}]);if(e.error)return e;let{policyDefinitions:i,returnParticipants:r=!0,provisionalPositioning:n,tournamentRecord:a,drawDefinition:s,drawPosition:o,event:l}=t,u=t.tournamentParticipants??(a&&Ei({withIndividualParticipants:!0,tournamentRecord:a}).participants)??[],c=et({structureId:t.structureId,drawDefinition:s});if(c.error)return c;let d=c.containingStructure||c.structure;if(!d)return{error:Ii};let p=d.structureId;if(c=lv({drawDefinition:s,structureId:p}),o===void 0&&!c.isAdHoc)return{error:YI};if(c.isAdHoc)return qR(t);if(c.error)return c;let{drawPositionInitialRounds:f,inactiveDrawPositions:m,activeDrawPositions:h,byeDrawPositions:g}=c,I=Tt({tournamentRecord:a,drawDefinition:s,structure:d,event:l}).appliedPolicies??{};Object.assign(I,i??{});let{actionsPolicy:v,enabledStructures:w,actionsDisabled:y}=A8({actionType:ZT,appliedPolicies:I,drawDefinition:s,structure:d}),b=v?.activePositionOverrides||[],{sourceStructureIds:S}=Pb({finishingPosition:Pp,targetRoundNumber:1,linkType:iu,drawDefinition:s,structureId:p})||{},U;S?.length&&(U=S.every(K=>uu({structureId:K,drawDefinition:s})));let T=S.length,P=S.length&&!U,{policyActions:D}=k8({enabledStructures:w,drawDefinition:s,structure:d}),E=![We,xe].includes(d.stage)||d.stageSequence!==1,{drawId:R}=s,C=[],{assignedPositions:M,positionAssignments:N}=ur({structure:d}),A=M?.find(K=>K.drawPosition===o),O=!!A;if(!N?.map(K=>K.drawPosition)?.includes(o))return{error:Zm};let{stage:k,stageSequence:F}=d,x=[k];k===Zr&&x.push(xe),k===xe&&x.push(Zr);let L=ch({entryStatuses:of,provisionalPositioning:n,drawDefinition:s,stageSequence:F,structureId:p,stages:x}),$=cf({drawDefinition:s,stages:x}).assignedParticipantIds??[],V=ywe(L,$),_=g.includes(o),B=h.includes(o);if(y)return{info:"Actions Disabled for structure",isActiveDrawPosition:B,isDrawPosition:!0,hasPositionAssigned:O,validActions:[],isByePosition:_};bwe({validActions:C,policyActions:D,isActiveDrawPosition:B,positionAssignments:N,disablePlacementActions:P,positionAssignment:A,isByePosition:_,getValidAssignmentActions:hwe,positionSourceStructureIds:S,unassignedParticipantIds:V,possiblyDisablingAction:E,isWinRatioFedStructure:T,tournamentParticipants:u,returnParticipants:r,appliedPolicies:I,drawDefinition:s,drawPosition:o,structureId:p,event:l}),wwe({validActions:C,policyActions:D,isActiveDrawPosition:B,getValidQualifiersAction:Iwe,drawPositionInitialRounds:f,tournamentParticipants:u,positionAssignments:N,returnParticipants:r,appliedPolicies:I,drawDefinition:s,drawPosition:o,structureId:p,drawId:R});let{participantId:G}=A||{},j=G&&u.find(K=>K.participantId===G);return A&&(Swe({validActions:C,policyActions:D,isActiveDrawPosition:B,drawId:R,structureId:p,drawPosition:o,possiblyDisablingAction:E,isByePosition:_}),Uwe({validActions:C,policyActions:D,activePositionsCheck:swe,activePositionOverrides:b,activeDrawPositions:h,drawDefinition:s,structureId:p,drawPosition:o,structure:d,isByePosition:_,participantId:G,participant:j,drawId:R}),Twe({validActions:C,policyActions:D,isByePosition:_,participantId:G,participant:j,drawId:R}),Dwe({validActions:C,policyActions:D,getValidSwapAction:vwe,possiblyDisablingAction:E,tournamentParticipants:u,inactiveDrawPositions:m,activeDrawPositions:h,positionAssignments:N,returnParticipants:r,byeDrawPositions:g,drawDefinition:s,isByePosition:_,drawPosition:o,structureId:p,structure:d,drawId:R})),Pwe({validActions:C,policyActions:D,getValidAlternatesAction:dwe,possiblyDisablingAction:E,tournamentParticipants:u,positionAssignments:N,activeDrawPositions:h,returnParticipants:r,appliedPolicies:I,drawDefinition:s,drawPosition:o,structureId:p,structure:d,drawId:R,event:l,disablePlacementActions:P}),Ewe({validActions:C,policyActions:D,getValidLuckyLosersAction:mwe,sourceStructuresComplete:U,possiblyDisablingAction:E,isWinRatioFedStructure:T,tournamentParticipants:u,activeDrawPositions:h,positionAssignments:N,drawDefinition:s,drawPosition:o,structureId:p,structure:d,drawId:R,disablePlacementActions:P,isActiveDrawPosition:B}),Rwe({validActions:C,policyActions:D,getValidModifyAssignedPairAction:nwe,participant:j,tournamentParticipants:u,returnParticipants:r,drawPosition:o,drawId:R,event:l}),{isActiveDrawPosition:B,isDrawPosition:!0,hasPositionAssigned:O,isByePosition:_,validActions:C,...H}}function DS({policyDefinitions:t,appliedPolicies:e,drawType:i}){let r=t?.[$D]?.drawTypeCoercion,n=e?.[$D]?.drawTypeCoercion;return(typeof r=="boolean"?r:void 0)??(i&&r?.[i])??(typeof n=="boolean"?n:void 0)??(i&&n?.[i])??!0}var ZL=({drawDefinition:t})=>{let e=Ge({drawDefinition:t},[{[mn]:!0}]);if(e.error)return e;let i=t.structures?.find(n=>n.stage===xe&&n.stageSequence===1);if(!i)return z({result:{error:A1}});let{qualifierPositions:r}=ur({structure:i});return Re(0,r.length).sort(()=>Math.random()-.5)};function e0({structureId:t,drawDefinition:e}){if(!e)return{error:_e};if(!ri(t))return{error:ie};let i=sv({drawDefinition:e,structureId:t});if(i.error)return i;let r=i.links.target.flatMap(a=>a.target.feedProfile).filter(Boolean),n=!xi([Dp,Ms,rR,Tp],r).length;return{...H,valid:n}}function j8({participantsCount:t,participantCount:e}){if(t=t??e,!t)return{error:ie};let i=qI(t);return i?{drawSize:i}:z({result:{error:ie},stack:"getEliminationDrawSize",context:{participantsCount:t}})}function PS(t){let{drawSizeProgression:e=!1,policyDefinitions:i,drawSize:r}=t||{},{requireParticipantCount:n=!0,tournamentRecord:a,drawDefinition:s,event:o}=t||{},l="getSeedsCount",u=t?.participantsCount??t?.participantCount;if(!i){let m=xc({tournamentRecord:a,drawDefinition:s,event:o});if(m.error)return z({result:m,stack:l});i=m.policyDefinitions}let c=ot(u);if(u&&!c)return z({result:{error:ie},context:{participantsCount:u},stack:l});if(n&&!c)return z({result:{error:B6},stack:l});if(Number.isNaN(Number(r)))if(u)({drawSize:r}=j8({participantsCount:u}));else return z({result:{error:Ew},stack:l});let d=n&&u||r;if(d&&d>r)return{error:_1};let p=i?.[fo];if(!p)return{error:D6};let f=p.seedsCountThresholds;return f?(p.drawSizeProgression!==void 0&&(e=p.drawSizeProgression),{seedsCount:f.filter(m=>e?m.drawSize<=r:r===m.drawSize).reduce((m,h)=>u&&u>=h.minimumParticipantCount?h.seedsCount:m,0)}):{error:o6}}function YR({consideredEntries:t,policyDefinitions:e,tournamentRecord:i,appliedPolicies:r,participantMap:n,enforceGender:a,participants:s,event:o}){if((!s||!n)&&i&&({participants:s,participantMap:n}=Ei({tournamentRecord:i})),!s)return{error:Mw};if(!Array.isArray(s))return{error:ie};if(!o)return{error:li};let l=e?.[Er]??r?.[Er]??cv[Er],u=(a??l?.participants?.enforceGender)!==!1,{eventType:c,gender:d}=o,p=c===oc,f=c===ya&&Lt||p&&pt||gt,m=Object.assign({},...(t??o.entries??[]).map(I=>({[I.participantId]:I.entryStatus}))),h=Object.keys(m),g=s.filter(I=>h.includes(I.participantId)).filter(I=>{let v=Mwe({participant:I,participantType:f,eventType:c,entryStatusMap:m}),w=Nwe({genderEnforced:u,participantMap:n,eventGender:d,participant:I,isDoubles:p,mismatch:v});return v||!w});if(g.length){let I=g.map(v=>v.participantId);return{error:g6,invalidParticipantIds:I}}return{...H,valid:!0}}function Mwe({participant:t,participantType:e,eventType:i,entryStatusMap:r}){let n=r[t.participantId],a=i&&[oc,ya].includes(i)&&t.participantType===gt&&(lp(n)||n===mc);return t.participantType!==e&&!a}function Nwe(t){let{participant:e,participantMap:i,eventGender:r,mismatch:n,isDoubles:a,genderEnforced:s}=t,o=!n&&a&&rt(e?.individualParticipantIds?.map(d=>i?.[d]?.participant?.person?.sex).filter(Boolean)??[])||[],l=!r||!o?.length||eu(r)||il(r)&&on(o[0])===on(r)||Na(r)&&(o.length===1&&e.individualParticipantIds?.length===1||o.length===2),u=e?.person?.sex,c=!e?.person||!r||Na(r)||eu(r)||il(r)&&on(u)===on(r);return!s||l&&c}function G8({hasExistingDrawDefinition:t,qualifyingProfiles:e,appliedPolicies:i,qualifyingOnly:r,tieFormat:n,idPrefix:a,isMock:s,uuids:o}){let l="generateQualifyingSTructures",u=[],c=[],d=[],p=(v,w)=>v.stageSequence-w.stageSequence,f=(v,w)=>v.roundTarget-w.roundTarget,m=0,h=0,g,I=1;for(let v of e.sort(f)){let w=v.structureProfiles||[];I=v.roundTarget||I;let y=1,b=0,S,U,T;for(let P of(w||[]).sort(p)){let D=T1(P.drawSize||P.participantsCount),{qualifyingRoundNumber:E,structureOptions:R,matchUpFormat:C,structureName:M,structureId:N,drawType:A}=P,O=P.matchUpType,k=P.qualifyingPositions||Awe({drawSize:D,qualifyingRoundNumber:E}),F,x,L;if(!ot(D))return z({result:{error:Ew},stack:l});let $=e.length>1?`${I}-`:"",V=w.length>1||$?y:"",_=M||($||V?`${Xr(We)} ${$}${V}`:Xr(We));if(A===Ks){let{structures:B,groupCount:G,maxRoundNumber:j}=pS({structureName:P.structureName||_,structureId:N||o?.pop(),hasExistingDrawDefinition:t,stage:We,structureOptions:R,appliedPolicies:i,qualifyingOnly:r,stageSequence:y,matchUpType:O,roundTarget:I,tieFormat:n,drawSize:D,idPrefix:a,isMock:s,uuids:o});b=G,F=j,x=B[0],g=[1]}else({drawSize:D,matchUps:L,roundLimit:F}=ll({qualifyingRoundNumber:E,qualifyingPositions:k,matchUpType:O,drawSize:D,idPrefix:a,isMock:s,uuids:o})),x=ns({structureName:P.structureName||_,structureId:N||o?.pop(),qualifyingRoundNumber:F,hasExistingDrawDefinition:t,stage:We,qualifyingOnly:r,matchUpFormat:C,stageSequence:y,matchUpType:O,roundLimit:F,tieFormat:n,matchUps:L}),I&&xt({extension:{name:Tl,value:I},element:x}),b=L?.filter(B=>B.roundNumber===F)?.length||0;if(y>1){let{link:B}=gS({sourceStructureId:U,sourceRoundNumber:S,targetStructureId:x.structureId,finishingPositions:T===iu?[1]:void 0,linkType:T});d.push(B),m+=(D||0)-b}else m+=D||0;T=A===Ks?iu:ru,U=x.structureId,S=F,n&&(L=Nt({structure:x})?.matchUps||[],L?.forEach(B=>{let{tieMatchUps:G}=wh({tieFormat:n,matchUp:B,isMock:s});Object.assign(B,{tieMatchUps:G,matchUpType:O})})),c.push(x),y+=1}h+=b,u.push({qualifiersCount:b,finalQualifyingRoundNumber:S,finalQualifyingStructureId:U,finishingPositions:g,roundTarget:I,linkType:T}),I+=1}return{qualifiersCount:h,qualifyingDrawPositionsCount:m,qualifyingDetails:u,structures:c,...H,links:d}}function Awe({drawSize:t,qualifyingRoundNumber:e}){let i=t,r=0;for(;r<e;)i=Math.floor(i/2),r+=1;return i}function H8(t){let{drawTypeCoercion:e,enforceMinimumDrawSize:i}=t,r=Ye(t.drawSize),n=e&&t.drawType!==ra&&(typeof e=="boolean"||e<=2)&&r===2&&Yo||t.drawType||Yo,a=D5.includes(n);if(r&&a){if(e&&(typeof e=="boolean"&&r<4||r<=e))n=Yo;else if(r<4&&i)return{...z({context:{enforceMinimumDrawSize:i,drawSize:r,drawType:n},result:{error:OE},stack:"getCoercedDrawType"}),drawType:n}}return{drawType:n}}function kwe(t){let{drawDefinition:e,structureOptions:i,requireSequential:r}=t,n={structureName:Xr(xe),...t,stage:xe},{structures:a,groupCount:s}=pS(n);if(s<1)return{error:n4};let o=i?.playoffGroups||[{finishingPositions:[1],structureName:Xr(Ui)}],[l]=a,{structures:u,links:c}=u8({sourceStructureId:l.structureId,requireSequential:r,drawDefinition:e,playoffGroups:o,groupCount:s,...t});return u&&a.push(...u),{...H,structures:a,links:c}}function Owe({mainStructure:t,consolationStructure:e,deciderStructure:i}){let r=e.matchUps.reduce((u,c)=>(c.drawPositions||[]).filter(Boolean).length&&!u.includes(c.roundNumber)?u.concat(c.roundNumber):u,[]),n=t.matchUps.reduce((u,c)=>!u||c.roundNumber>u?c.roundNumber:u,void 0),a=e.matchUps.reduce((u,c)=>!u||c.roundNumber>u?c.roundNumber:u,void 0),s=r.map((u,c)=>{let d=r.indexOf(u)%2?Ms:Dp,p=1+c;return{linkType:nu,source:{roundNumber:p,structureId:t.structureId},target:{feedProfile:d,roundNumber:u,structureId:e.structureId}}}),o={linkType:ru,source:{roundNumber:a,structureId:e.structureId},target:{feedProfile:Ms,roundNumber:n,structureId:t.structureId}},l=[{linkType:ru,source:{roundNumber:n,structureId:t.structureId},target:{feedProfile:Ms,roundNumber:1,structureId:i.structureId}},{linkType:nu,source:{roundNumber:n,structureId:t.structureId},target:{feedProfile:Ms,roundNumber:1,structureId:i.structureId}}];return[...s,o,...l]}function xwe({structureName:t,matchUpType:e,idPrefix:i,drawSize:r,isMock:n,uuids:a}){let s=[],{matchUps:o}=vd({linkFedFinishingRoundNumbers:[1],drawSize:r+1,matchUpType:e,idPrefix:i,isMock:n}),l=od({structureName:t||Xr(xe),structureId:a?.pop(),stageSequence:1,stage:xe,matchUpType:e,matchUps:o});s.push(l);let u=r/2,{matchUps:c}=vd({finishingPositionOffset:u,idPrefix:i&&`${i}-c`,drawSize:r-1,isConsolation:!0,matchUpType:e,isMock:n,uuids:a}),d=od({structureName:Xr(T5),matchUps:c,structureId:a?.pop(),stage:Zr,stageSequence:2,matchUpType:e});s.push(d);let{matchUps:p}=ll({idPrefix:i&&`${i}-p1t2`,drawSize:2,matchUpType:e,isMock:n}),f=od({structureName:Xr(U5),matchUps:p,structureId:a?.pop(),stageSequence:3,stage:Ui,matchUpType:e});s.push(f);let m=Owe({mainStructure:l,consolationStructure:d,deciderStructure:f});return{structures:s,links:m,...H}}function Fwe(t){let{qualifyingRoundNumber:e,finishingPositionOffset:i,qualifyingPositions:r,matchUpType:n,idPrefix:a,drawSize:s,isMock:o,uuids:l}=t;if(!ot(s)||s<2)return{matchUps:[],roundsCount:0};if(Uo(s))return ll(t);let u=Lwe(s),c=u.shift(),d=Re(1,(c?.participantsCount||0)+1).map(g=>({drawPosition:g})),p=[],f=1;({matchUps:p}=ZD({roundNumber:f,matchUpType:n,idPrefix:a,matchUps:p,isMock:o,nodes:d,uuids:l})),f++;let m=t.roundLimit||e;for(let g of u){let I=g.participantsCount/2,v=Re(1,I+1);r&&I===r&&(m=f-1);let w=v.map(y=>{let b=FL({roundPosition:y,roundNumber:f,idPrefix:a,uuids:l});return{roundPosition:y,roundNumber:f,matchUpId:b}});p.push(...w),f++}let h=f-1;return p=aS({finishingPositionOffset:i,lucky:!0,roundsCount:h,roundLimit:m,matchUps:p}),m&&(p=p.filter(g=>g.roundNumber<=m)),{matchUps:p,roundsCount:h,roundLimit:m}}function Lwe(t){let e=Ye(t),i=e%2?e+1:e,r=!!(Math.ceil(i/2)%2),n=[{participantsCount:i,preFeedRound:r}];for(;i>2;){let a=Math.ceil(i/2),s=a===1,o=!!(!s&&a%2);i=!s&&o?a+1:a;let l=!!(i!==2&&Math.ceil(i/2)%2);n.push({participantsCount:i,preFeedRound:l,feedRound:o})}return n}function W8(t){let{playoffAttributes:e,stageSequence:i=1,stage:r=xe,tieFormat:n,matchUpType:a,drawSize:s,uuids:o}=t,l=()=>!t.isMock&&!t.idPrefix?void 0:`${t.drawDefinition.drawId}-s-0`,u=t.structureId||l()||o?.pop(),c=t.appliedPolicies??Tt(t),d=t.policyDefinitions?.[iI]||c?.[iI];t.skipRounds=t.skipRounds||s<=4&&(d?.feedFromMainFinal?0:1)||0;let p=t.structureName??e?.["0"]?.name??Xr(xe),f=()=>{let{matchUps:m}=ll(t);return{structures:[ns({stageSequence:i,structureName:p,matchUpType:a,structureId:u,tieFormat:n,matchUps:m,stage:r})],links:[],...H}};return{generators:{[ra]:()=>({structures:[ns({finishingPosition:Pp,stageSequence:i,structureName:p,matchUps:[],matchUpType:a,structureId:u,stage:r})],links:[],...H}),[tf]:()=>{let{matchUps:m}=Fwe(t);return{structures:[ns({stageSequence:i,structureName:p,matchUpType:a,structureId:u,matchUps:m,stage:r})],links:[],...H}},[Yo]:()=>f(),[Fw]:()=>xwe(t),[Qg]:()=>_g({...t,roundOffsetLimit:3,playoffAttributes:e??dF}),[Zg]:()=>_g({...t,roundOffsetLimit:2,playoffAttributes:e??pF}),[Ui]:()=>_g(t),[ev]:()=>{let{matchUps:m}=vd({drawSize:s,uuids:o,matchUpType:a});return{structures:[ns({stageSequence:i,structureName:p,matchUpType:a,structureId:u,stage:xe,tieFormat:n,matchUps:m})],links:[],...H}},[Lw]:()=>s8(t),[eI]:()=>xf({...t,feedRounds:1,fmlc:!0}),[S5]:()=>xf({...t,feedRounds:1}),[lF]:()=>xf({...t,feedsFromFinal:1}),[uF]:()=>xf({...t,feedsFromFinal:2}),[cF]:()=>xf({...t,feedsFromFinal:3}),[_w]:()=>xf(t),[nR]:()=>l8(t),[Ks]:()=>pS(t),[au]:()=>kwe(t)}}}function t0(t){let{enforceMinimumDrawSize:e=!0,overwriteExisting:i,appliedPolicies:r,qualifyingOnly:n,staggeredEntry:a,drawDefinition:s,tieFormat:o,isMock:l,uuids:u}=t||{},c=Ye(t.drawSize),d=t.drawTypeCoercion??DS({appliedPolicies:r,drawType:t.drawType}),p="generateDrawStructuresAndLinks",f=H8({drawType:t.drawType,enforceMinimumDrawSize:e,drawTypeCoercion:d,drawSize:c});if(f.error)return f;let m=f.drawType,h=[],g=[],I=t?.matchUpType??Wt,v=s?.structures?.filter(({stage:V})=>V===We);v&&h.push(...v);let w=v?.map(({structureId:V})=>V),y=s?.structures?.find(({stage:V,stageSequence:_})=>V===xe&&_===1),b=s?.links?.filter(V=>V.target.structureId===y?.structureId&&w?.includes(V.source.structureId)),S=(V,_)=>{if(V.linkType===iu&&_?.structures){let B=V.source.finishingPositions||[];return _.structures.length*B.length}else if(V.linkType===ru&&_?.matchUps?.length){let B=V.source.roundNumber;return _.matchUps.filter(({roundNumber:G})=>G===B).length}},U=v?.map(V=>{let _=b?.find(Y=>Y.target.structureId===V.structureId),B=Yt({structure:V})?.positionAssignments?.length??0;if(!_)return B;let G=_?.source.structureId,j=s.structures?.find(Y=>Y.structureId===G),K=S(_,j)||0;return B-K}).filter(Boolean).reduce((V,_)=>V+_,0),T=b?.map(V=>{let _=V.source.structureId,B=v?.find(G=>G.structureId===_);return S(V,B)}).filter(Boolean).reduce((V,_)=>V+_,0),P=!!(y&&!y?.matchUps?.length);if(v?.length&&!P)return{error:Jk};let D=!v?.length&&t.qualifyingProfiles,E=D?.length&&G8({idPrefix:t.idPrefix,qualifyingProfiles:D,appliedPolicies:r,qualifyingOnly:n,tieFormat:o,isMock:l,uuids:u});if(E?.error)return E;let{qualifyingDrawPositionsCount:R,qualifyingDetails:C,qualifiersCount:M}=E||{qualifyingDrawPositionsCount:U,qualifiersCount:T};R&&(E?.structures&&h.push(...E.structures),E?.links&&g.push(...E.links)),Object.assign(t,Ve({drawSize:c,matchUpType:I,tieFormat:o}));let N=m!==ra&&(!c||c<2||!a&&![ev,tf].includes(m)&&([au,Ks].includes(m)&&c<3||![Ks,au].includes(m)&&!Uo(c)));if(N&&!R)return z({context:{drawSize:c,invalidDrawSize:N},result:{error:OE},stack:p});let{generators:A,error:O}=W8(t);if(O)return{error:O};let k=A[m];if(!k)return{error:R1};let F=k?.();if(F.error)return F;let{structures:x,links:L}=F;if(x?.length){let V=x.find(({stage:_,stageSequence:B})=>_===xe&&B===1);if(y&&V){if(P){let _=V.structureId;if(V.structureId=y.structureId,L?.length)for(let B of L)B.source.structureId===_&&(B.source.structureId=y.structureId),B.target.structureId===_&&(B.target.structureId=y.structureId)}else if(!i)return{error:Jk}}h.push(...x)}h.sort(uh),L?.length&&g.push(...L);let $=F.structures.find(({stage:V,stageSequence:_})=>V===xe&&_===1);for(let V of C||[]){let{finalQualifyingRoundNumber:_,finalQualifyingStructureId:B,roundTarget:G,finishingPositions:j,linkType:K}=V,Y=$&&gS({targetStructureId:$.structureId,sourceStructureId:B,sourceRoundNumber:_,finishingPositions:j,targetEntryRound:G,linkType:K})?.link;if(Y?.error)return Y;Y&&g.push(Y)}return b&&g.push(...b),{...H,qualifyingResult:{qualifyingDrawPositionsCount:R,qualifiersCount:M},structures:h,links:g}}function i0(t){let{modifyOriginal:e=!0,stageSequence:i=1,isMock:r}=t||{},n="generateDrawTypeAndModifyDrawDefinition";if(!t.drawDefinition)return z({result:{error:_e},stack:n});let a=e?t.drawDefinition:ke(t.drawDefinition,!1,!0),{tieFormat:s,matchUpType:o}=t;if(s){let w=Bn({tieFormat:s});if(w.error)return w}s=jr(s??vn({drawDefinition:a})?.tieFormat),o=o??(a.matchUpType||Wt),t.tieFormat=s,t.matchUpType=o;let l=KD({drawDefinition:a,stage:xe});t.drawSize=t.drawSize??l,!l&&t.drawSize&&JD({drawSize:t.drawSize,drawDefinition:a,stageSequence:i,stage:xe});let u=Ar({drawDefinition:a}).drawMatchUps.map(Ir),c=t0(t);if(c.error)return z({result:c,stack:n});let{structures:d,links:p,qualifyingResult:f}=c;a.structures=d,a.links=p;let m=Math.max(t.qualifiersCount??0,f?.qualifiersCount||0);if(f?.qualifyingDrawPositionsCount&&!KD({stage:We,drawDefinition:a})){let w=JD({drawSize:f.qualifyingDrawPositionsCount,stage:We,drawDefinition:a});if(w.error)return w}if(m){let w=Y7({qualifiersCount:m,drawDefinition:a,stage:xe});if(w.error)return w}let h=t.drawSize??l;Object.assign(t,Ve({drawSize:h,matchUpType:o,tieFormat:s}));let{matchUps:g,matchUpsMap:I}=Qi({drawDefinition:a});s&&g?.forEach(w=>{if(!u.includes(w.matchUpId)){let{tieMatchUps:y}=wh({tieFormat:s,matchUp:w,isMock:r});Object.assign(w,{tieMatchUps:y,matchUpType:o})}});let{inContextDrawMatchUps:v}=Mp({drawDefinition:a,matchUpsMap:I});return ti({tournamentId:t.tournamentRecord?.tournamentId,drawDefinition:a}),{inContextDrawMatchUps:v,drawDefinition:a,matchUpsMap:I,...H,structures:d,matchUps:g,links:p}}function mv(t){let{removePriorValues:e,tournamentRecord:i,participantId:r,scaleItem:n}=t,a,s;if(!q8({scaleItem:n}))return{error:Tm};if(r&&Array.isArray(i.participants)&&(s=i.participants.find(o=>o.participantId===r),s)){if(s.participantType===_n&&n?.eventType!==ya)return{error:Tm};let o=Y8({removePriorValues:e,participant:s,scaleItem:n});if(o.error)return o;a=!o.valueChanged;let{topics:l}=gs();l.includes(en)&&at({topic:en,payload:{tournamentId:i.tournamentId,participants:[s]}})}return a&&{...H,info:q1,existingValue:n?.scaleValue}||s&&{...H,newValue:n?.scaleValue}||{error:Vi}}function z8(t){let{scaleItemsWithParticipantIds:e=[],removePriorValues:i,tournamentRecord:r,auditData:n,context:a}=t;if(!r)return{error:Ie};if(!r.participants)return{error:Mw};let s=0,o={},l=[];for(let d of e){let p=d?.participantId;if(Array.isArray(d?.scaleItems))for(let f of d.scaleItems)if(q8({scaleItem:f}))Array.isArray(o[p])||(o[p]=[]),o[p].push(f);else return{error:Tm}}for(let d of r.participants){let{participantId:p}=d||{};if(Array.isArray(o[p]))for(let f of o[p]){if(d.participantType===_n&&f?.eventType!==ya)return z({context:{participantId:p,scaleItem:f,participantType:d.participantType},info:"Invalid participantType for eventType",result:{error:Tm}});Y8({participant:d,scaleItem:f,removePriorValues:i}),l.push(d),s++}}let u=s?void 0:QI,{topics:c}=gs();if(c.includes(en)&&s&&at({topic:en,payload:{tournamentId:r.tournamentId,participants:l}}),a){let{eventId:d,drawId:p,...f}=a,m=f.scaleAttributes?.scaleType&&[f.scaleAttributes.scaleType];if(Object.keys(f).length){let h={itemType:NF,itemValue:f};if(m&&(h.itemSubTypes=m),p||d){let{drawDefinition:g,event:I}=jn({tournamentRecord:r,eventId:d,drawId:p});p&&NL({drawDefinition:g,timeItem:h}),d&&Sh({event:I,timeItem:h})}else wS({tournamentRecord:r,timeItem:h})}}return n&&c.includes(Ju)&&at({topic:Ju,payload:n}),Ve({...H,modificationsApplied:s,info:u})}function q8({scaleItem:t}){let e=t&&Object.keys(t),i=["scaleType","eventType","scaleName"];return i.filter(r=>e?.includes(r)).length===i.length}function Y8({removePriorValues:t,participant:e,scaleItem:i}){if(!e)return{error:ih};let r=i&&Object.keys(i),n=["scaleType","eventType","scaleName"];if(n.filter(u=>r.includes(u)&&i[u]).length!==n.length)return{error:Tm};let a=new Date().toISOString();e.timeItems||(e.timeItems=[]);let{scaleItem:s}=Hl({scaleAttributes:i,participant:e}),o=u=>[void 0,null,""].includes(u),l=!(o(s?.scaleValue)&&o(i.scaleValue))&&JSON.stringify(s?.scaleValue)!==JSON.stringify(i.scaleValue);if(l){let{scaleType:u,eventType:c,scaleName:d}=i,p=[pd,u,c,d].join("."),f=Ve({itemValue:i.scaleValue,itemDate:i.scaleDate,createdAt:a,itemType:p});i.scaleId&&(f.itemSubTypes=[i.scaleId]),t&&(e.timeItems=e.timeItems.filter(m=>m.itemType!==p)),e.timeItems.push(f)}return{...H,valueChanged:l,newValue:i.scaleValue}}function r0(t){let{tournamentRecord:e,modifiedScaleValues:i,removePriorValues:r}=t,n=Ge(t,[{[mr]:!0},{modifiedScaleValues:!0,[zn]:Yn}]);if(n.error)return n;for(let a in i){let s=mv({scaleItem:i[a],removePriorValues:r,tournamentRecord:e,participantId:a});if(s.error)return s}return{...H}}var _we=(t=0)=>250/Math.pow(t+5,.4),$we=()=>1;function Bwe(t=3,e=2){let i=t/e;return Number.isNaN(i)?Ig.kDefault():i}var Ig={nSpread:400,diffThreshold:.125,kCalc:_we,kMultiplier:Bwe,kDefault:$we};function K8(t){let{winnerRating:e,loserRating:i}=t,{ratings:r=xr,winnerCountables:n=1,loserCountables:a=0,ratingType:s="ELO",maxCountables:o,countables:l}=t||{},u=r?.[s];if(!u)return{error:Xe};let c=u.range||t.ratingRange;e=e||u.defaultInitialization,i=i||u.defaultInitialization;let d=c[0]>c[1],p=u.decimalsCount||0,f=d?c.slice().reverse():c,m=(A,O)=>Number.parseFloat(O)>=Math.min(...A)&&Number.parseFloat(O)<=Math.max(...A);(!m(c,e)||!m(c,i))&&(m(c,e)||(e=u.defaultInitialization),m(c,i)||(i=u.defaultInitialization));let h=Ug({targetRange:xr.ELO.range,sourceRange:f,value:d?c[0]-e:e}),g=Ug({targetRange:xr.ELO.range,sourceRange:f,value:d?c[0]-i:i}),I=(A,O)=>1/(1+Math.pow(10,(O-A)/Ig.nSpread)),v=I(h,g),w=I(g,h),y=Ig.kCalc(n),b=Ig.kCalc(a),S=Ig.kMultiplier(o,l),U=h+S*y*(1-v),T=g+S*b*(0-w),P=Ug({sourceRange:xr.ELO.range,value:U,targetRange:f}),D=Ug({sourceRange:xr.ELO.range,value:T,targetRange:f}),E=d?c[0]-P:P,R=Number.parseFloat(E.toFixed(p)),C=d?c[0]-D:D,M=Number.parseFloat(C.toFixed(p)),N=Math.max(...c)?Math.abs(e-i)/Math.max(...c):0;return(P>D&&N>Ig.diffThreshold||R<0||M<0)&&(R=e,M=i),{newWinnerRating:R,newLoserRating:M}}var Vwe=t=>t?.reduce((e,i)=>(i.winningSide&&(e[i.winningSide-1]+=1),e),[0,0])||[0,0];function X8(t){let e=Ge(t,[{[mr]:!0},{matchUpIds:!0,[zn]:an,[xs]:eh},{ratingType:!1,[Wr]:v=>xr[v]}]);if(e.error)return e;let{updateParticipantRatings:i,removePriorValues:r=!0,tournamentRecord:n,ratingType:a="ELO",refreshDynamic:s,considerGames:o,drawDefinition:l,matchUpIds:u,asDynamic:c}=t,d=xr[a],{accessor:p}=d,f={},m=(t.matchUps||s&&Rn({drawDefinition:l,tournamentRecord:n,inContext:!0,matchUpFilters:{matchUpStatuses:Yi}}).matchUps||br({matchUpFilters:{matchUpIds:u,matchUpStatuses:Yi},tournamentRecord:n,inContext:!0}).matchUps)??[],h=`${a}.${wF}`,g=c?h:a;m.sort(hh);for(let v of m){let{endDate:w,matchUpFormat:y,score:b,sides:S,winningSide:U}=v,T=v.matchUpType,P={eventType:T,scaleName:a,scaleType:sd},D={scaleName:h,eventType:T,scaleType:sd},E=Object.assign({},...(S??[]).map(x=>{let{sideNumber:L,participant:$}=x;return L&&{[L]:[$?.participantId,...$?.individualParticipantIds??[]].filter(Boolean).flat()}})),R=Object.assign({},...Object.values(E).flat().map(x=>{let L=f[x],$=!s||L?Nm({scaleAttributes:D,tournamentRecord:n,participantId:x}).scaleItem:void 0,V=Nm({tournamentRecord:n,scaleAttributes:P,participantId:x}).scaleItem,_=p?{[p]:void 0}:void 0;return x&&{[x]:$??V??{scaleName:g,eventType:T,scaleDate:w,scaleType:sd,scaleValue:_}}})),C=y?zi(y):{},M=C?.bestOf||1,N=C?.setsTo||1,A=o?M&N:M,O=b?.sets&&Vwe(b.sets)||U===1&&[1,0]||[0,1],k=U?E[U]:[],F=U?E[3-U]:[];for(let x of k){let L=R[x]?.scaleValue,$=typeof L=="object"?L[p]:L;for(let V of F){let _=R[V]?.scaleValue,B=typeof _=="object"?_[p]:_,G=U?O[U]:[0,0],j=U?O[3-U]:[0,0],{newWinnerRating:K,newLoserRating:Y}=K8({winnerCountables:G,loserCountables:j,maxCountables:A,winnerRating:$,loserRating:B,ratingType:a}),X=p?{...L,[p]:K}:K,Z=p?{..._,[p]:Y}:Y;R[x].scaleValue=X,R[V].scaleValue=Z,R[x].scaleName=g,R[V].scaleName=g}}Object.assign(f,R),i&&r0({tournamentRecord:n,modifiedScaleValues:f,removePriorValues:r})}let I=m.map(({matchUpId:v})=>v);return{...H,modifiedScaleValues:f,outputScaleName:g,processedMatchUpIds:I}}function KR(t){let{matchUpIds:e=[],drawDefinition:i,roundNumber:r,newRound:n,isMock:a,event:s}=t;if(typeof i!="object")return{error:_e};let{participantIdPairings:o,matchUpsCount:l}=t,u=WR(t);if(u.error)return z({result:u});let{lastRoundNumber:c,availableMatchUpsCount:d=0,roundMatchUpsCount:p=0}=u;if(!l)n?l=p:d>0&&(l=d);else if(l>p&&t.restrictMatchUpsCount!==!1)return z({result:{error:ie,info:"matchUpsCount error",context:{roundMatchUpsCount:p}}});if(o&&!Array.isArray(o)||l&&!ot(l)||e&&!Array.isArray(e)||!o&&!l)return{error:ie,info:"matchUpsCount or pairings error"};if(l&&t.restrictMatchUpsCount!==!1&&l>32)return{error:ie,info:"matchUpsCount must be less than 33"};if(r&&!t.ignoreLastRoundNumber&&r-1>(c||0))return{error:ie,info:"roundNumber error"};let f=r??(n&&(c??0)+1||c||1);o=o??Re(0,l).map(()=>({participantIds:[void 0,void 0]}));let m=g=>{if(!t.idPrefix)return;let I=i.drawId,v=t.idPrefix??"ah";return`${I}-${v}-${f}-${g}`},h=o?.map((g,I)=>{let v=g?.participantIds??[void 0,void 0];v.push(void 0,void 0);let w=v.slice(0,2).map((b,S)=>Ve({sideNumber:S+1,participantId:b})),y=e[I]??m(I)??Et();return{roundNumber:f,matchUpStatus:Fi,matchUpId:y,sides:w}});if(h?.length){let g=vn({drawDefinition:i,event:s})?.tieFormat;g&&h.forEach(I=>{let{tieMatchUps:v}=wh({tieFormat:g,matchUp:I,isMock:a});Object.assign(I,{tieMatchUps:v,matchUpType:Zt})})}return{roundNumber:f,matchUpsCount:h?.length??0,matchUps:h,...H}}function jwe({maxIterations:t=4e3,valueSortedPairings:e,pairingValues:i,valueObjects:r,deltaObjects:n}){let a=Object.assign({},...e.map(v=>({[v.pairing]:v.value}))),s=Object.keys(i),o=[],l=ZH({actorsCount:s.length,valueSortedPairings:e,pairingValueMap:a,deltaObjects:n,valueObjects:r}),u=[EA(l)];o.push(l);let c=l.value,d=l,p=1,f=0,m=s.length,h;do m-=1,h=s.length*i[s[0]].length;while(h>t&&m>5);let g=[];s.forEach(v=>{i[v].slice(0,m).forEach(w=>{f+=1;let y=nm(v,w.opponent);if(!g.includes(y)){let b=ZH({stipulated:[[v,w.opponent]],actorsCount:s.length,valueSortedPairings:e,pairingValueMap:a,deltaObjects:n,valueObjects:r});if(!u.includes(EA(b))){u.push(EA(b)),o.push(b);let{maxDelta:S,value:U}=b;S<d.maxDelta&&(d=b),(U<c||U===c&&Math.round(Math.random()))&&(c=U),g.push(y),p+=1}}}),o=o.filter(w=>Math.abs(w.value-c)<5)}),o.sort((v,w)=>v.maxDiff-w.maxDiff);let I=ma(o);return{candidatesCount:p,deltaCandidate:d,maxIterations:t,iterations:f,candidate:I}}function EA(t){return t.participantIdPairings.map(({participantIds:e})=>e.sort().join("|")).sort().join("/")}function ZH({valueSortedPairings:t,stipulated:e=[],pairingValueMap:i,deltaObjects:r,valueObjects:n,actorsCount:a}){let s=e.flat(),o=[],l=0;e.filter(Boolean).forEach(d=>{let[p,f]=d,m=nm(p,f),h=i[m];o.push({participantIds:d,value:h}),l+=i[m]}),yr(t,a).flatMap(d=>Dn(d).map(p=>({...p,value:p.value+Math.random()*Math.round(Math.random())}))).forEach(d=>{let p=d.pairing.split("|");if(!p.reduce((f,m)=>s.includes(m)||f,!1)){s.push(...p);let f=d.value;l+=f,o.push({participantIds:p,value:f})}}),o.sort((d,p)=>d.value-p.value);let u=o.reduce((d,p)=>{let[f,m]=p.participantIds,h=nm(f,m),g=r[h];return Math.max(g,d)},0),c=o.reduce((d,p)=>{let[f,m]=p.participantIds,h=nm(f,m),g=n[h];return Math.max(g,d)},0);return{value:l,participantIdPairings:o,maxDelta:u,maxDiff:c}}function nm(t,e){return[t,e].sort(AR).join("|")}function J8({participantIds:t}){let e={},i=[];t.forEach(n=>{e[n]=t.filter(a=>a!==n),e[n].forEach(a=>{let s=nm(a,n);i.includes(s)||i.push(s)})});let r=Object.assign({},...i.map(n=>({[n]:0})));return{uniquePairings:i,possiblePairings:e,deltaObjects:r}}function Gwe({matchUps:t}){let e=[];for(let i of t){let r=i.sides.map(vt);if(r.length===2){let[n,a]=r,s=nm(n,a);e.includes(s)||e.push(s)}}return{encounters:e}}function Hwe({possiblePairings:t,valueObjects:e}){let i={};for(let n of Object.keys(t)){let a=t[n].map(s=>r(n,s));i[n]=a.sort((s,o)=>s.value-o.value)}function r(n,a){let s=nm(n,a);return{opponent:a,value:e[s]}}return{pairingValues:i}}var Wwe=0;function zwe({tournamentParticipants:t,adHocRatings:e,eventType:i,scaleName:r,pairing:n}){let a=xr[r]?.defaultInitialization??Wwe;return n.split("|").map(s=>{if(i===ls){let o=t?.find(l=>l.participantId===s)?.individualParticipantIds;return o?o?.map(l=>e[l]||a):a*2}else return e[s]||a})}function qwe(t){let{tournamentParticipants:e,adHocRatings:i={},possiblePairings:r,uniquePairings:n,maxIterations:a,minimizeDelta:s,deltaObjects:o,valueObjects:l,eventType:u,scaleName:c,salted:d}=t;n.forEach(w=>{let y=zwe({tournamentParticipants:e,adHocRatings:i,scaleName:c,eventType:u,pairing:w}),b=typeof d=="number"&&d||.5,S=d&&(Math.round(Math.random())?b:b*-1)||0,U=Math.abs(y[0]-y[1])+S,T=Math.abs(y[0]-y[1]);o[w]=T,l[w]||(l[w]=0),l[w]+=U?Math.pow(U,2):0});let p=n.map(w=>({pairing:w,value:l[w]})).sort((w,y)=>w.value-y.value),{pairingValues:f}=Hwe({possiblePairings:r,valueObjects:l}),{candidate:m,candidatesCount:h,deltaCandidate:g,iterations:I}=jwe({valueSortedPairings:p,maxIterations:a,pairingValues:f,deltaObjects:o,valueObjects:l}),{participantIdPairings:v}=s?g:m;return{participantIdPairings:v,candidatesCount:h,deltaCandidate:g,iterations:I,candidate:m}}var Ywe=100,Kwe=100,Xwe=4e3;function n0(t){let{encounterValue:e=Ywe,sameTeamValue:i=Kwe,maxIterations:r=Xwe,updateParticipantRatings:n,generateMatchUps:a=!0,ignoreLastRoundNumber:s,iterationMatchUps:o,tournamentRecord:l,dynamicRatings:u,refreshDynamic:c,participantIds:d,drawDefinition:p,roundNumber:f,structureId:m,matchUpIds:h,eventType:g,scaleName:I,idPrefix:v,isMock:w,salted:y,event:b}=t;if(!p)return{error:_e};if(!t.structure&&!m)return{error:Ii};let S=t.structure||et({drawDefinition:p,structureId:m}).structure;if(!bt(S))return{error:Qp};if(!d?.length)return{error:Od};let U=[...o??[],...S?.matchUps??[]],{encounters:T}=Gwe({matchUps:U}),P=l?.participants??[],D={};if(u){let G=rt(S?.matchUps?S.matchUps.map(({roundNumber:K})=>K):[]),j=Math.max(...G,0);if(j){let K=S?.matchUps?.filter(({roundNumber:X})=>X===j).map(({matchUpId:X})=>X),Y=X8({ratingType:I??b?.category?.ratingType,updateParticipantRatings:n,tournamentRecord:l,asDynamic:!0,refreshDynamic:c,drawDefinition:p,matchUpIds:K});if(Y.error)return Y;Y.modifiedScaleValues&&(D=Y.modifiedScaleValues)}}let{valueObjects:E}=Jwe({tournamentParticipants:P,encounterValue:e,sameTeamValue:i,encounters:T}),{uniquePairings:R,possiblePairings:C,deltaObjects:M}=J8({participantIds:d}),N=Object.values(D).length?D:t.adHocRatings,A={tournamentParticipants:P,possiblePairings:C,uniquePairings:R,maxIterations:r,adHocRatings:N,deltaObjects:M,valueObjects:E,eventType:g,scaleName:I,salted:y},{candidatesCount:O,participantIdPairings:k,deltaCandidate:F,iterations:x,candidate:L}=qwe(A);if(!O)return{error:GE};let $,V;if(a){let G=KR({structureId:S?.structureId,ignoreLastRoundNumber:s,participantIdPairings:k,newRound:!0,drawDefinition:p,roundNumber:f,matchUpIds:h,idPrefix:v,isMock:w,event:b});if(G.error)return G;$=G.roundNumber,V=G.matchUps}let{maxDelta:_,maxDiff:B}=L;return{roundNumber:$,participantIdPairings:k,modifiedScaleValues:D,candidatesCount:O,deltaCandidate:F,...H,iterations:x,matchUps:V,maxDelta:_,maxDiff:B}}function Jwe({encounters:t,tournamentParticipants:e,encounterValue:i,sameTeamValue:r}){let n={};for(let s of t)n[s]||(n[s]=0),n[s]+=i;let a=e?.filter(({participantType:s})=>s===Lt);if(a)for(let s of a){let o=s.individualParticipantIds??[],{uniquePairings:l}=J8({participantIds:o});for(let u of l)n[u]||(n[u]=0),n[u]+=r}return{valueObjects:n}}function Q8(t){let{drawType:e=Yo,attachConsolation:i=!0,applyPositioning:r=!0,tournamentRecord:n,staggeredEntry:a,automated:s,placeByes:o,isMock:l,event:u}=t,c=t?.drawDefinition;if(!c)return{error:_e};let d=Pr,p=ch({stageSequence:1,drawDefinition:c,stage:d}),f=[Ks,Fw,au].includes(e)?p.length:qI(p.length);if(!a&&e===ev&&p.length<2||e===Ks&&p.length<3)return{error:OE};let{tieFormat:m,matchUpType:h}=t;if(m){let E=Bn({tieFormat:m});if(E.error)return E}m=jr(m??vn({drawDefinition:c})?.tieFormat),h=h??c.matchUpType;let{structures:g}=Js({stageSequence:1,drawDefinition:c,stage:d});if(g.length>1)return{error:v6};if(g?.[0]?.matchUps?.length)return{error:X1};let I=g?.[0]?.structureId;Object.assign(t,Ve({structureName:t.structureName??Xr(Pr),structureId:I,matchUpType:h,tieFormat:m,drawSize:f,stage:d}));let v=W8(t);if(v.error)return v;let w=v.generators[e];if(!w)return{error:R1};let y=w?.();if(y.error)return y;let{structures:b,links:S}=y,U=b.flatMap(E=>Nt({structure:E}).matchUps);m&&U.forEach(E=>{let{tieMatchUps:R}=wh({matchUp:E,tieFormat:m,isMock:l});Object.assign(E,{tieMatchUps:R,matchUpType:h})}),(!r||!i)&&(c=ke(c,!1,!0)),c.links??=[],S.length&&c.links.push(...S);let T=new Set(b.map(({structureId:E})=>E));c.structures??=[];let P=new Set(c.structures.map(({structureId:E})=>E));c.structures=c.structures.map(E=>T.has(E.structureId)?b.find(({structureId:R})=>R===E.structureId):E);let D=b.filter(({structureId:E})=>!P.has(E));return D.length&&c.structures.push(...D),s&&hS({seedingProfile:t.seedingProfile,applyPositioning:r,tournamentRecord:n,drawDefinition:c,structureId:I,placeByes:o,drawSize:f,event:u}),i&&ti({drawDefinition:c}),{links:S,structures:b,...H}}var a0={};ct(a0,{ScoringEngine:()=>a9,addPoint:()=>hp,analyzeScore:()=>T0,analyzeSequence:()=>$9,analyzeSet:()=>Rb,calculateMatchStatistics:()=>g0,calculatePointsTo:()=>JR,checkScoreHasValue:()=>cr,checkSetIsComplete:()=>tC,createMatchUp:()=>id,deduceMatchUpFormat:()=>oC,enrichPointHistory:()=>r9,exportMatchUpJSON:()=>gTe,generate:()=>Z8,generateScoreString:()=>Wl,generateTieMatchUpScore:()=>yS,getEpisodes:()=>h0,getQuickStats:()=>n9,getScore:()=>yd,getScoreboard:()=>p0,getSetComplement:()=>P0,getSetScoreString:()=>ZUe,getTiebreakComplement:()=>sC,getWinner:()=>f0,groupByMatch:()=>G9,helpers:()=>o9,inferServeSide:()=>o0,isComplete:()=>m0,isValidMatchUpFormat:()=>xa,keyValueScore:()=>R9,mcpValidator:()=>hTe,mutate:()=>s9,parseCSV:()=>j9,parseMCPPoint:()=>V9,parseMatchUpFormat:()=>zi,parseScoreString:()=>ES,pbpValidator:()=>tTe,pointParser:()=>B9,query:()=>k9,resolvePointValue:()=>l0,reverseScore:()=>e9,shotParser:()=>MO,shotSplitter:()=>_9,stringifyMatchUpFormat:()=>QE,tidyScore:()=>A9,toStatObjects:()=>I0,validateMCPMatch:()=>H9,validateMatchUp:()=>x9,validateMatchUpScore:()=>O9,validateScore:()=>D0,validateSet:()=>eTe,validateSetScore:()=>U0,validateTieFormat:()=>Bn});var Z8={};ct(Z8,{ScoringEngine:()=>a9,generateScoreString:()=>Wl,generateTieMatchUpScore:()=>yS,reverseScore:()=>e9});function Wl(t){let{winnerFirst:e=!0,setTBlast:i=!0,addOutcomeString:r,reversed:n=!1,matchUpStatus:a,matchUpFormat:s,autoComplete:o,winningSide:l,sets:u}=t;if(!u)return{error:Xe,info:"missing sets"};let c=s&&zi(s),{bestOf:d,finalSetFormat:p,setFormat:f}=c??{},m=n||!(!e||!l||l===1),h=r?Qwe({matchUpStatus:a}):"",g=u?.sort(Zwe).map(I).filter(Boolean).join(" ")||"";if(!h)return g;if(l===2)return`${h} ${g}`;return`${g} ${h}`;function I(v){let w=d&&v.setNumber===d&&p?p:f,y=V=>Ni(V?.side1Score)||Ni(V?.side2Score),b=(V=>Ni(V?.side1TiebreakScore)||Ni(V?.side2TiebreakScore))(v),S=w?.tiebreakSet||!y(v)&&b,{side1Score:U,side2Score:T,side1TiebreakScore:P,side2TiebreakScore:D}=v,E=P||(Ni(P)||b&&o?0:""),R=D||(Ni(D)||b&&o?0:"");if(S){let V=y(v)&&!b,_=V?U:E,B=V?T:R;return`[${(m?[B,_]:[_,B]).join("-")}]`}let C=b?Math.min(E,R):"",M=C===E?1:2,N=Ni(C)?`(${C})`:"",A=U||(Ni(U)||o?0:""),O=T||(Ni(T)||o?0:""),k=V=>!i&&M===V?N:"",F=`${A}${k(1)}`,x=`${O}${k(2)}`,L=i&&b?`(${C})`:"",$=m?`${[x,F].join("-")}${L}`:`${[F,x].join("-")}${L}`;return["-"," "].includes($)&&($=""),$}}function Qwe({matchUpStatus:t}){let e={[$r]:"RET",[mi]:"WO",[Hi]:"DF/DF",[wi]:"WO/WO",[_d]:"SUS",[us]:"ABN",[Qt]:"DEF",[nv]:"DR"};return t&&e[t]||""}function Zwe(t,e){return t.setNumber-e.setNumber}function e9(t){if(!t?.score)return{error:Xe};let{sets:e}=t.score,i=e.map(s=>{let{side1TiebreakScore:o,side2TiebreakScore:l,winningSide:u,side1Score:c,side2Score:d,setNumber:p}=s;return Ve({winningSide:u?3-u:void 0,side1TiebreakScore:l,side2TiebreakScore:o,side1Score:d,side2Score:c,setNumber:p})}),r=t?.setTBlast,n=Wl({setTBlast:r,sets:i}),a=Wl({sets:i,reversed:!0,setTBlast:r});return{reversedScore:{sets:i,scoreStringSide1:n,scoreStringSide2:a},...H}}function id(t){let{matchUpId:e=Et(),matchUpFormat:i,participants:r=[],isDoubles:n=!1,matchUpType:a}=t,s=a||(n?"DOUBLES":"SINGLES"),o=r.map((l,u)=>({sideNumber:u+1,participantId:l.participantId,participant:l}));return o.length===0&&o.push({sideNumber:1},{sideNumber:2}),{matchUpId:e,matchUpFormat:i,matchUpStatus:"TO_BE_PLAYED",matchUpType:s,sides:o,score:{sets:[]},createdAt:new Date().toISOString()}}function s0(t){return t?!!t.aggregate:!1}function XR(t,e){let i=t.bestOf||t.exactly||3,r=Math.ceil(i/2);if(e[0]===r-1&&e[1]===r-1&&t.finalSetFormat){let a=t.finalSetFormat;return a.tiebreakSet?"matchTiebreak":a.timed?"timed":"standard"}let n=t.setFormat;return n?n.tiebreakSet?"tiebreakOnly":n.timed?"timed":"standard":"standard"}function JR(t,e,i,r,n){if(i==="timed"||!r)return;let a=eSe(t),s=tSe(t),o=e.exactly||e.bestOf||3,l=Math.ceil(o/2),{side1Points:u,side2Points:c}=iSe(a),d=rSe(u,c,r,i,e,a),p=aSe(a,r,i),f=sSe(d,p,r,i),m=oSe(f,s,l,e),h=uSe(d,n);return{pointsToGame:d,pointsToSet:f,pointsToMatch:m,gamesToSet:p,isBreakpoint:h}}function eSe(t){let e=t.score.sets;if(e.length===0)return;let i=e.at(-1);return i?.winningSide===void 0?i:void 0}function tSe(t){let e=[0,0];return t.score.sets.forEach(i=>{i.winningSide===1&&e[0]++,i.winningSide===2&&e[1]++}),e}function iSe(t){if(!t)return{side1Points:0,side2Points:0};let e=t.side1GameScores||[],i=t.side2GameScores||[];if(e.length===0&&i.length===0)return{side1Points:0,side2Points:0};let r=Math.max(e.length,i.length)-1;return{side1Points:e[r]??0,side2Points:i[r]??0}}function rSe(t,e,i,r,n,a){if(r==="tiebreakOnly"){let s=i.tiebreakSet?.tiebreakTo||11,o=i.tiebreakSet?.NoAD||!1;return RA(t,e,s,o)}if(r==="matchTiebreak"){let s=n.finalSetFormat?.tiebreakSet?.tiebreakTo||10,o=n.finalSetFormat?.tiebreakSet?.NoAD||!1;return RA(t,e,s,o)}if(a){let s=a.side1Score||0,o=a.side2Score||0,l=i.setTo||6,u=(typeof i.tiebreakAt=="number"?i.tiebreakAt:void 0)??l;if(!i.noTiebreak&&s===u&&o===u){let c=i.tiebreakFormat?.tiebreakTo||7,d=i.tiebreakFormat?.NoAD||!1;return RA(t,e,c,d)}}if(n.gameFormat?.type==="CONSECUTIVE"){let s=n.gameFormat.count||3;return[s,s]}return nSe(t,e,i)}function nSe(t,e,i){let r=i.gameFormat?.NoAD||i.NoAD||!1,n=4;return[eW(t,e,n,r),eW(e,t,n,r)]}function eW(t,e,i,r){if(t>=i-1&&e>=i-1){if(r)return t>e?0:t===e?1:2;let n=t-e;return n>=2?0:n===1?1:2}return t>=i?0:i-t}function RA(t,e,i,r){return[tW(t,e,i,r),tW(e,t,i,r)]}function tW(t,e,i,r){if(t>=i&&(t-e>=2||r&&t>e))return 0;if(t>=i-1&&e>=i-1){if(r)return t>e?0:t===e?1:2;let n=t-e;return n>=2?0:n===1?1:2}return t>=i?0:i-t}function aSe(t,e,i){if(i==="tiebreakOnly"||i==="matchTiebreak")return!t||t.winningSide!==void 0?[1,1]:[1,1];let r=t?.side1Score||0,n=t?.side2Score||0,a=e.setTo||6,s=(typeof e.tiebreakAt=="number"?e.tiebreakAt:void 0)??a,o=e.noTiebreak||!1,l=e.winBy||2;return[iW(r,n,a,s,o,l),iW(n,r,a,s,o,l)]}function iW(t,e,i,r,n,a){if(!n&&t===r&&e===r)return 1;if(t>=i){let o=t-e;return o>=a?0:a-o}let s=i-t;if(e>=i-1&&t>=i-1){if(!n)return Math.max(1,i-t);let o=t-e;return o>=a?0:a-o}return s}function sSe(t,e,i,r){if(r==="tiebreakOnly"||r==="matchTiebreak")return[...t];let n=4;return[rW(t[0],e[0],n),rW(t[1],e[1],n)]}function rW(t,e,i){if(e<=0)return 0;let r=Math.max(0,e-1);return t+r*i}function oSe(t,e,i,r){let n=r.setFormat,a=lSe(n,r);return[nW(t[0],e[0],i,a),nW(t[1],e[1],i,a)]}function lSe(t,e){if(!t)return 24;if(t.tiebreakSet)return t.tiebreakSet.tiebreakTo||11;if(t.timed)return 0;let i=t.setTo||6,r=e.gameFormat?.type==="CONSECUTIVE"?e.gameFormat?.count||3:4;return i*r}function nW(t,e,i,r){if(e>=i)return 0;let n=Math.max(0,i-e-1);return t+n*r}function uSe(t,e){if(e===void 0)return!1;let i=1-e;return t[i]===1}function o0(t,e,i){if(i==="timed")return;let r=cSe(t);return s0(e)?dSe(t,r):i==="tiebreakOnly"||i==="matchTiebreak"?pSe(r):fSe(t,e,r)}function cSe(t){let e=t.score.sets;if(e.length===0)return;let i=e[e.length-1];return i.winningSide===void 0?i:void 0}function dSe(t,e){let i=0;for(let r of t.score.sets)r.winningSide!==void 0&&(r.side1TiebreakScore!==void 0?i+=(r.side1TiebreakScore??0)+(r.side2TiebreakScore??0):i+=(r.side1Score??0)+(r.side2Score??0));if(e&&e.winningSide===void 0){let r=e.side1GameScores||[],n=e.side2GameScores||[];if(r.length>0||n.length>0){let a=Math.max(r.length,n.length)-1;i+=(r[a]??0)+(n[a]??0)}else i+=(e.side1Score??0)+(e.side2Score??0)}return i%2===0?"deuce":"ad"}function pSe(t){if(!t)return"deuce";let e=t.side1GameScores||[],i=t.side2GameScores||[];return e.length===0&&i.length===0||((e[0]??0)+(i[0]??0))%2===0?"deuce":"ad"}function fSe(t,e,i){if(!i)return"deuce";let r=i.side1GameScores||[],n=i.side2GameScores||[];if(r.length===0&&n.length===0)return"deuce";let a=Math.max(r.length,n.length)-1;return((r[a]??0)+(n[a]??0))%2===0?"deuce":"ad"}function l0(t,e){if(!e.length)return 1;for(let{condition:i,value:r}of e)if(i.results&&t.result&&i.results.includes(t.result)||i.strokes&&t.stroke&&i.strokes.includes(t.stroke))return r;return 1}function hp(t,e,i){if(!bt(e)||e.winner===void 0||e.winner===null)return t;let r=t,{winner:n,server:a,timestamp:s}=e;r.history??={points:[]};let o=zi(t.matchUpFormat);if(!o)throw new Error(`Invalid matchUpFormat: ${t.matchUpFormat}`);let l=o.exactly||o.bestOf||3,u=Math.ceil(l/2),c=r.history.points.length+1,d=r.history.points.length,p=[0,0];r.score.sets.forEach(U=>{U.winningSide===1&&p[0]++,U.winningSide===2&&p[1]++});let f=XR(o,p),m=p[0]===u-1&&p[1]===u-1,h=m&&o.finalSetFormat?o.finalSetFormat:o.setFormat,g=h?.tiebreakSet?.modifier==="RALLY"||h?.modifier==="RALLY";a===void 0&&!g&&(a=d0(r,o,f));let I=e.code;!I&&n!==void 0&&a!==void 0&&(I=n===a?"S":"R");let v={...e,pointNumber:c,winner:n,server:a,timestamp:s||new Date().toISOString()};I&&(v.code=I),v.index=d;let w=JR(r,o,f,h,a);w&&(v.pointsToGame=w.pointsToGame,v.pointsToSet=w.pointsToSet,v.pointsToMatch=w.pointsToMatch,v.gamesToSet=w.gamesToSet,v.isBreakpoint=w.isBreakpoint);let y=o0(r,o,f);y!==void 0&&(v.serveSide=y);let b=i?.pointMultipliers||[],S=l0(v,b);switch(S!==1&&(v.scoreValue=S),r.history.points.push(v),r.matchUpStatus==="TO_BE_PLAYED"&&(r.matchUpStatus="IN_PROGRESS"),f){case"tiebreakOnly":hSe(r,v,n,o,h,p,u,S);break;case"matchTiebreak":gSe(r,v,n,o,p,u,S);break;case"timed":ISe(r,v,n,h,S);break;default:mSe(r,v,n,o,h,p,u,m);break}return r}function mSe(t,e,i,r,n,a,s,o){let l=QR(t,!1,!1),u=t.score.sets.indexOf(l),c=l.side1Score||0,d=l.side2Score||0,p=l.side1GameScores||[],f=l.side2GameScores||[];p.length===0&&f.length===0&&(p.push(0),f.push(0));let m=Math.max(p.length,f.length)-1,h=m>=0?p[m]??0:0,g=m>=0?f[m]??0:0;e.set=u,e.game=m,e.number=h+g;let I=n.setTo||6,v=(typeof n.tiebreakAt=="number"?n.tiebreakAt:void 0)??I,w=o&&r.finalSetFormat?.noTiebreak;i===0?(h++,p[p.length-1]=h):(g++,f[f.length-1]=g),l.side1GameScores=p,l.side2GameScores=f;let y=r.gameFormat?.type==="CONSECUTIVE",b=r.gameFormat?.count||3;if(y){let P=l.currentStreak;P&&P.side===i?l.currentStreak={side:i,count:P.count+1}:l.currentStreak={side:i,count:1}}let S=!w&&c===v&&d===v,U;y&&!S?U=l.currentStreak.count>=b?l.currentStreak.side:void 0:U=vSe(h,g,n,S);let T=U===void 0?t9(h,g,S,y&&!S):"0-0";if(e.score=T,U!==void 0){y&&(l.currentStreak=void 0),U===0?l.side1Score=c+1:l.side2Score=d+1,S&&(l.side1TiebreakScore=h,l.side2TiebreakScore=g);let P=ySe(l.side1Score||0,l.side2Score||0,n,o,r.finalSetFormat);typeof P=="number"?(l.winningSide=P+1,u0(t,r,s)):(l.side1GameScores.push(0),l.side2GameScores.push(0))}}function hSe(t,e,i,r,n,a,s,o=1){let l=QR(t,!0,!1),u=t.score.sets.indexOf(l),c=n.tiebreakSet.tiebreakTo||11,d=n.tiebreakSet.NoAD||!1,p=l.side1GameScores||[],f=l.side2GameScores||[];p.length===0&&f.length===0&&(p.push(0),f.push(0),l.side1GameScores=p,l.side2GameScores=f);let m=p[0]||0,h=f[0]||0;e.set=u,e.game=0,e.number=m+h,i===0?(m+=o,p[0]=m):(h+=o,f[0]=h),l.side1GameScores=p,l.side2GameScores=f;let g=c0(m,h,c,d);e.score=g===void 0?`${m}-${h}`:"0-0",g!==void 0&&(l.winningSide=g+1,l.side1TiebreakScore=m,l.side2TiebreakScore=h,l.side1Score=g===0?1:0,l.side2Score=g===0?0:1,u0(t,r,s))}function gSe(t,e,i,r,n,a,s=1){let o=r.finalSetFormat?.tiebreakSet?.tiebreakTo||10,l=r.finalSetFormat?.tiebreakSet?.NoAD||!1,u=QR(t,!1,!1),c=t.score.sets.indexOf(u),d=u.side1GameScores||[],p=u.side2GameScores||[];d.length===0&&p.length===0&&(d.push(0),p.push(0),u.side1GameScores=d,u.side2GameScores=p);let f=d[0]||0,m=p[0]||0;e.set=c,e.game=0,e.number=f+m,i===0?(f+=s,d[0]=f):(m+=s,p[0]=m),u.side1GameScores=d,u.side2GameScores=p;let h=c0(f,m,o,l);e.score=h===void 0?`${f}-${m}`:"0-0",h!==void 0&&(u.side1TiebreakScore=f,u.side2TiebreakScore=m,u.side1Score=h===0?1:0,u.side2Score=h===0?0:1,u.winningSide=h+1,u0(t,r,a))}function ISe(t,e,i,r,n=1){let a=QR(t,!1,!0),s=t.score.sets.indexOf(a);e.set=s,e.game=0,e.number=(a.side1Score||0)+(a.side2Score||0),i===0?a.side1Score=(a.side1Score||0)+n:a.side2Score=(a.side2Score||0)+n;let o=a.side1Score||0,l=a.side2Score||0;e.score=`${o}-${l}`}function QR(t,e,i){let r=t.score.sets.length-1;if(r>=0&&t.score.sets[r].winningSide===void 0)return t.score.sets[r];let n={setNumber:t.score.sets.length+1,side1Score:0,side2Score:0,side1GameScores:[],side2GameScores:[]};return e&&(n.isTiebreakOnly=!0),i&&(n.isTimed=!0),t.score.sets.push(n),n}function u0(t,e,i){let r=[0,0];t.score.sets.forEach(o=>{o.winningSide===1&&r[0]++,o.winningSide===2&&r[1]++});let n=s0(e),a=e.exactly;if(n){let o=a||e.bestOf||3;if(t.score.sets.filter(u=>u.winningSide!==void 0).length<o)return;let l=t.score.sets.reduce((u,c)=>(c.side1TiebreakScore!==void 0&&c.side2TiebreakScore!==void 0?(u[0]+=c.side1TiebreakScore,u[1]+=c.side2TiebreakScore):(u[0]+=c.side1Score??0,u[1]+=c.side2Score??0),u),[0,0]);l[0]!==l[1]&&(t.matchUpStatus="COMPLETED",t.winningSide=l[0]>l[1]?1:2,t.endTime=new Date().toISOString());return}if(!(r[0]>=i||r[1]>=i)||a&&t.score.sets.filter(o=>o.winningSide!==void 0).length<a)return;let s=r[0]>=i?0:1;t.matchUpStatus="COMPLETED",t.winningSide=s+1,t.endTime=new Date().toISOString()}function c0(t,e,i,r=!1){let n=Math.abs(t-e),a=r?1:2;if((t>=i||e>=i)&&n>=a)return t>e?0:1}function vSe(t,e,i,r){let n=i.gameFormat?.NoAD||i.NoAD||!1;if(r){let o=i.tiebreakFormat?.tiebreakTo||7,l=i.tiebreakFormat?.NoAD||!1;return c0(t,e,o,l)}let a=4,s=Math.abs(t-e);if(n)return t>=a||e>=a?t>e?0:1:void 0;if((t>=a||e>=a)&&s>=2)return t>e?0:1}function ySe(t,e,i,r,n){let a=i.setTo||6,s=(typeof i.tiebreakAt=="number"?i.tiebreakAt:void 0)??a,o=r&&n?.noTiebreak;if(a===1)return t>=1||e>=1?t>e?0:1:void 0;let l=(r&&n?n:i).winBy||2;if(!o&&(t===s+1||e===s+1)||(t>=a||e>=a)&&Math.abs(t-e)>=l)return t>e?0:1}function d0(t,e,i){let r=bSe(t,e,i);return t.history?.points?.[0]?.server===1?1-r:r}function bSe(t,e,i){let r=t.score.sets.length-1,n=r>=0?t.score.sets[r]:void 0;if(i==="tiebreakOnly"||i==="matchTiebreak"){let u=n?.side1GameScores||[],c=n?.side2GameScores||[],d=(u[0]||0)+(c[0]||0),p=0;for(let h=0;h<t.score.sets.length-1;h++){let g=t.score.sets[h];p+=(g.side1Score||0)+(g.side2Score||0)}let f=p%2,m=Math.floor(d/2)%2;return(f+m)%2}if(i==="timed")return((n?.side1Score||0)+(n?.side2Score||0))%2;let a=n?.side1Score||0,s=n?.side2Score||0,o=e.setFormat?.setTo||6,l=(typeof e.setFormat?.tiebreakAt=="number"?e.setFormat.tiebreakAt:void 0)??o;if(!e.finalSetFormat?.noTiebreak&&a===l&&s===l){let u=n?.side1GameScores||[],c=n?.side2GameScores||[],d=(u.at(-1)||0)+(c.at(-1)||0),p=(a+s)%2,f=Math.floor(d/2)%2;return(p+f)%2}return(a+s)%2}function t9(t,e,i,r){if(i||r)return`${t}-${e}`;let n=["0","15","30","40"];if(t<4&&e<4)return`${n[t]}-${n[e]}`;if(t>=3&&e>=3&&t===e)return"40-40";if(t>=3&&e>=3){let a=t-e;if(a===1)return"A-40";if(a===-1)return"40-A";if(a>=2)return"G-40";if(a<=-2)return"40-G"}return t>=3?`40-${e<4?n[e]:"40"}`:e>=3?`${t<4?n[t]:"40"}-40`:`${t<4?n[t]:"0"}-${e<4?n[e]:"0"}`}function yd(t,e){let i=t.score.sets,r=USe(t,e?.useBracketNotation),n=i.length>0?i.at(-1):null,a=n&&n.winningSide===void 0?[n.side1Score||0,n.side2Score||0]:[0,0],s=[0,0];if(n?.side1GameScores&&n.side2GameScores){let u=Math.max(n.side1GameScores.length,n.side2GameScores.length)-1;u>=0&&(s=[n.side1GameScores[u]||0,n.side2GameScores[u]||0])}let o=wSe(t,s),l=SSe(t);return{sets:i,scoreString:r,games:a,points:s,pointDisplay:o,situation:l}}function wSe(t,e){if(t.matchUpStatus==="COMPLETED"||t.matchUpStatus==="TO_BE_PLAYED")return;let i=zi(t.matchUpFormat);if(!i)return;let r=t.score.sets.at(-1);if(!r||r.winningSide!==void 0)return;let n=[0,0];t.score.sets.forEach(c=>{c.winningSide===1&&n[0]++,c.winningSide===2&&n[1]++});let a=XR(i,n),s=a==="tiebreakOnly"||a==="matchTiebreak",o=i.gameFormat?.type==="CONSECUTIVE",l=s;if(!l&&a==="standard"){let c=i.exactly||i.bestOf||3,d=Math.ceil(c/2),p=n[0]===d-1&&n[1]===d-1,f=p&&i.finalSetFormat?i.finalSetFormat:i.setFormat;if(f){let m=r.side1Score||0,h=r.side2Score||0,g=f.setTo||6,I=(typeof f.tiebreakAt=="number"?f.tiebreakAt:void 0)??g,v=f.noTiebreak||!1,w=p&&i.finalSetFormat?.noTiebreak;l=!v&&!w&&m===I&&h===I}}let u=t9(e[0],e[1],l,o&&!l).split("-");return u.length===2?[u[0],u[1]]:[String(e[0]),String(e[1])]}function SSe(t){if(t.matchUpStatus==="COMPLETED"||t.matchUpStatus==="TO_BE_PLAYED")return;let e=zi(t.matchUpFormat);if(!e)return;let i=e.exactly||e.bestOf||3,r=Math.ceil(i/2),n=[0,0];t.score.sets.forEach(y=>{y.winningSide===1&&n[0]++,y.winningSide===2&&n[1]++});let a=XR(e,n),s=n[0]===r-1&&n[1]===r-1,o=s&&e.finalSetFormat?e.finalSetFormat:e.setFormat,l=o?.tiebreakSet?.modifier==="RALLY"||o?.modifier==="RALLY",u;l||(u=d0(t,e,a));let c=JR(t,e,a,o,u);if(!c)return{isBreakPoint:!1,isGamePoint:!1,isSetPoint:!1,isMatchPoint:!1,isGoldenPoint:!1,isTiebreak:!1,server:u};let{pointsToGame:d,pointsToSet:p,pointsToMatch:f,isBreakpoint:m}=c,h=a==="tiebreakOnly"||a==="matchTiebreak";if(!h&&a==="standard"&&o){let y=t.score.sets.at(-1);if(y){let b=y.side1Score||0,S=y.side2Score||0,U=o.setTo||6,T=(typeof o.tiebreakAt=="number"?o.tiebreakAt:void 0)??U,P=o.noTiebreak||!1,D=s&&e.finalSetFormat?.noTiebreak;h=!P&&!D&&b===T&&S===T}}let g=!!(o?.NoAD||o?.gameFormat?.NoAD||h&&(o?.tiebreakFormat?.NoAD||o?.tiebreakSet?.NoAD||e.finalSetFormat?.tiebreakSet?.NoAD))&&d[0]===1&&d[1]===1,I=u===void 0?!1:d[u]===1,v=Math.min(p[0],p[1])===1,w=Math.min(f[0],f[1])===1;return{isBreakPoint:m,isGamePoint:I,isSetPoint:v,isMatchPoint:w,isGoldenPoint:g,isTiebreak:h,server:u}}function USe(t,e=!1){let i=t.score.sets;return i.length===0?"0-0":i.map(r=>{let n=r.side1Score||0,a=r.side2Score||0;if(r.side1TiebreakScore!==void 0||r.side2TiebreakScore!==void 0){let s=r.side1TiebreakScore||0,o=r.side2TiebreakScore||0;return e&&(n===0&&a===1||n===1&&a===0)?`[${s}-${o}]`:n>a?`${n}-${a}(${o})`:`${n}(${s})-${a}`}return`${n}-${a}`}).join(", ")}function p0(t,e){let i=t.score.sets;if(i.length===0)return"0-0";let r=e?.perspective,n=i.map(s=>{let o=s.side1Score||0,l=s.side2Score||0;if(r===1&&([o,l]=[l,o]),s.side1TiebreakScore!==void 0||s.side2TiebreakScore!==void 0){let u=s.side1TiebreakScore||0,c=s.side2TiebreakScore||0;return r===1&&([u,c]=[c,u]),o>l?`${o}-${l}(${c})`:`${o}(${u})-${l}`}return`${o}-${l}`}),a=i.at(-1);if(t.matchUpStatus==="IN_PROGRESS"&&a&&!a.winningSide){let s=a.side1GameScores||[],o=s.length-1;if(o>=0&&s.length>0){let l=s[o]||0,u=(a.side2GameScores||[])[o]||0;if(l===0&&u===0)return n.join(", ");r===1&&([l,u]=[u,l]);let c=a.side1Score||0,d=a.side2Score||0,p=t.matchUpFormat?zi(t.matchUpFormat):void 0,f=p?.setFormat?.setTo||6,m=(typeof p?.setFormat?.tiebreakAt=="number"?p.setFormat.tiebreakAt:void 0)??f,h=c===m&&d===m,g=p?.gameFormat?.type==="CONSECUTIVE",I=n.at(-1),v=`${n.slice(0,-1).join(", ")}${n.length>1?", ":""}${I}`;if(h||g)return`${v} (${l}-${u})`;{let w=TSe(l,u);return`${v} (${w})`}}}return n.join(", ")}function TSe(t,e){let i=["0","15","30","40"];if(t<=3&&e<=3)return`${i[t]}-${i[e]}`;if(t>=3&&e>=3){let r=t-e;return r===0?"40-40":r===1?"A-40":r===-1?"40-A":r>=2?"G-40":"40-G"}return t>=3?"G-40":e>=3?"40-G":`${i[t]}-${i[e]}`}function f0(t){if(t.matchUpStatus==="COMPLETED")return t.winningSide}function m0(t){return t.matchUpStatus==="COMPLETED"}function h0(t){if(!t)return[];let e=t.history?.points;if(!e||e.length===0)return[];let i=[];for(let r=0;r<e.length;r++){let n=e[r],a=r<e.length-1?e[r+1]:void 0,s=n.set??0,o=n.game??0,l=n.number??0,u=a?a.set??0:void 0,c=a?a.game??0:void 0,d=r===e.length-1,p=d?t.matchUpStatus==="COMPLETED"||u===void 0&&c===void 0:u!==s||c!==o,f=d?t.matchUpStatus==="COMPLETED"||!1:a!==void 0&&u!==s,m;p&&(m=n.winner);let h;if(f){let b=t.score.sets[s];b?.winningSide!==void 0&&(h=b.winningSide-1)}let g={};n.pointsToGame&&(g.pointsToGame=n.pointsToGame),n.pointsToSet&&(g.pointsToSet=n.pointsToSet),n.pointsToMatch&&(g.pointsToMatch=n.pointsToMatch),n.gamesToSet&&(g.gamesToSet=n.gamesToSet),n.isBreakpoint!==void 0&&(g.isBreakpoint=n.isBreakpoint);let I=a?.server??n.server??0,v=t.score.sets[s],w=!!(v?.isTiebreakOnly||o>0&&v&&v.side1Score!==void 0&&v.side2Score!==void 0&&!v.isTiebreakOnly),y={action:"addPoint",point:{index:r,number:l,winner:n.winner,server:n.server,score:n.score,result:n.result},game:{index:o,isTiebreak:w,complete:p,winner:m},set:{index:s,complete:f,winner:h},needed:g,nextService:I,result:n.result,complete:d&&t.matchUpStatus==="COMPLETED"};i.push(y)}return i}var DSe={A:"Ace",D:"Double Fault",S:"Serve Winner",R:"Return Winner",W:"Winner",E:"Unforced Error",F:"Forced Error"},PSe=new Set(["A","S"]),ESe=new Set(["D","R","E","F"]);function RSe(t,e){let i={...t};return i.server=e.server,i.index=e.index,i.set=e.set,i.game=e.game,i.code&&!i.winner&&(i.winner=CSe(i.code,e.server)),i.code&&!i.result&&(i.result=DSe[i.code]),i.first_serve?i.serve=2:i.serve||(i.serve=1),i}function CSe(t,e){return PSe.has(t)?e:ESe.has(t)?1-e:e}function MSe(t){let e=[],i=[],r=t.result?.toLowerCase()||"";return r.includes("ace")&&e.push("aces"),(r.includes("winner")||r.includes("ace"))&&e.push("winners"),r.includes("double fault")&&i.push("doubleFaults"),r.includes("unforced error")&&i.push("unforcedErrors"),r.includes("forced error")&&i.push("forcedErrors"),t.winner===t.server?(e.push("servesWon"),t.serve===1?e.push("serves1stWon"):t.serve===2&&e.push("serves2ndWon")):(e.push("returns"),t.serve===1?e.push("received1stWon"):t.serve===2&&e.push("received2ndWon")),e.push("pointsWon"),{winner:e,loser:i}}function i9(t,e){let i={players:{},teams:{}};for(let a=0;a<2;a++)i.players[a]={},i.teams[a]={};let r=t;e?.setFilter!==void 0&&(r=t.filter(a=>a.set===e.setFilter));let n;return r.forEach((a,s)=>{if(a.winner===void 0){console.warn("Point missing winner:",a);return}let{winner:o,loser:l}=MSe(a),u=a.winner,c=1-u;if(o.forEach(d=>{i.teams[u][d]||(i.teams[u][d]=[]),i.teams[u][d].push(a),i.players[u][d]||(i.players[u][d]=[]),i.players[u][d].push(a)}),l.forEach(d=>{i.teams[c][d]||(i.teams[c][d]=[]),i.teams[c][d].push(a),i.players[c][d]||(i.players[c][d]=[]),i.players[c][d].push(a)}),a.server!==void 0){let d=a.server;i.teams[d].pointsServed||(i.teams[d].pointsServed=[]),i.teams[d].pointsServed.push(a),a.serve===1?(i.teams[d].serves1stIn||(i.teams[d].serves1stIn=[]),i.teams[d].serves1stIn.push(a)):a.serve===2&&(i.teams[d].serves2ndIn||(i.teams[d].serves2ndIn=[]),i.teams[d].serves2ndIn.push(a))}if(a.hand){let d=a.hand;i.teams[u][d]||(i.teams[u][d]=[]),i.teams[u][d].push({point:a,index:s})}if(NSe(a,n)&&n?.winner!==void 0){let d=n.winner;i.teams[d].gamesWon||(i.teams[d].gamesWon=[]),i.teams[d].gamesWon.push(n),i.players[d].gamesWon||(i.players[d].gamesWon=[]),i.players[d].gamesWon.push(n)}if(a.breakpoint){let d=a.server;i.teams[d].breakpointsFaced||(i.teams[d].breakpointsFaced=[]),i.teams[d].breakpointsFaced.push(a),u===d&&(i.teams[d].breakpointsSaved||(i.teams[d].breakpointsSaved=[]),i.teams[d].breakpointsSaved.push(a))}n=a}),i}function NSe(t,e){return e&&t.game!==void 0&&e.game!==void 0?t.game!==e.game:!1}function ASe(t){let e={totalPoints:0,byTeam:[0,0],byCategory:{}};for(let r=0;r<2;r++)if(t.teams[r].pointsWon){let n=t.teams[r].pointsWon.length;e.byTeam[r]=n,e.totalPoints+=n}let i=new Set;for(let r=0;r<2;r++)Object.keys(t.teams[r]).forEach(n=>i.add(n));return i.forEach(r=>{e.byCategory[r]=0;for(let n=0;n<2;n++)t.teams[n][r]&&(e.byCategory[r]+=t.teams[n][r].length)}),e}function kSe(t){if(!t?.teams)return[];let e=[];return Object.values({Aces:{category:"Aces",numerators:["aces"],calc:"number"},"Double Faults":{category:"Double Faults",numerators:["doubleFaults"],calc:"number"},Winners:{category:"Winners",numerators:["winners"],calc:"number"},"Unforced Errors":{category:"Unforced Errors",numerators:["unforcedErrors"],calc:"number"},"Forced Errors":{category:"Forced Errors",numerators:["forcedErrors"],calc:"number"},"Total Points Won":{category:"Total Points Won",numerators:["pointsWon"],calc:"number"},"Max Pts/Row":{category:"Max Pts/Row",numerators:["pointsWon"],calc:"maxConsecutive",attribute:"index"},"Max Games/Row":{category:"Max Games/Row",numerators:["gamesWon"],calc:"maxConsecutive",attribute:"game"},"First Serve %":{category:"First Serve %",numerators:["serves1stIn"],denominators:["pointsServed"],calc:"percentage"},"Points Won 1st":{category:"Points Won 1st",numerators:["serves1stWon"],denominators:["serves1stIn"],calc:"percentage"},"Points Won 2nd":{category:"Points Won 2nd",numerators:["serves2ndWon"],denominators:["serves2ndIn"],calc:"percentage"},"Points Won Receiving":{category:"Points Won Receiving",numerators:["received1stWon","received2ndWon"],denominators:["-pointsServed"],calc:"percentage"},"Breakpoints Saved":{category:"Breakpoints Saved",numerators:["breakpointsSaved"],denominators:["breakpointsFaced"],calc:"percentage"},"Breakpoints Converted":{category:"Breakpoints Converted",numerators:["-breakpointsSaved"],denominators:["-breakpointsFaced"],calc:"difference"},"Games Won":{category:"Games Won",numerators:["gamesWon"],calc:"number"},"Service Points Won":{category:"Service Points Won",numerators:["servesWon"],denominators:["pointsServed"],calc:"percentage"},"Aggressive Margin":{category:"Aggressive Margin",numerators:["*doubleFaults","*unforcedErrors"],denominators:["*aces","*winners","-*forcedErrors"],calc:"aggressiveMargin"}}).forEach(i=>{let r=[aW(i,t.teams,0),aW(i,t.teams,1)];(r[0].value!==0||r[1].value!==0)&&e.push({category:i.category,teams:r})}),e}function aW(t,e,i){switch(t.calc){case"number":return OSe(t,e,i);case"percentage":return xSe(t,e,i);case"maxConsecutive":return FSe(t,e,i);case"difference":return LSe(t,e,i);case"aggressiveMargin":return _Se(t,e,i)}}function OSe(t,e,i){let r=km(t.numerators,e,i);return{value:r,display:String(r),numerators:t.numerators}}function xSe(t,e,i){let r=km(t.numerators,e,i),n=km(t.denominators||[],e,i);if(!n)return{value:0,display:"0",numerators:t.numerators};let a=Math.round(r/n*100);return{value:a,display:`${a}% (${r}/${n})`,numerators:t.numerators}}function FSe(t,e,i){let r=t.numerators[0],n=t.attribute||"index";if(!e[i][r])return{value:0,display:"0"};let a=e[i][r],s=0,o=a.length?1:0,l;return a.forEach(u=>{let c=u[n];l!==void 0&&c===l+1?o++:(o>s&&(s=o),o=1),l=c}),o>s&&(s=o),{value:s,display:String(s)}}function LSe(t,e,i){let r=km(t.numerators,e,i),n=km(t.denominators||[],e,i);if(!n)return{value:0,display:"0",numerators:t.numerators};let a=Math.abs(n-r),s=Math.round(a/n*100);return{value:s,display:`${s}% (${a}/${n})`,numerators:t.numerators}}function _Se(t,e,i){let r=km(t.denominators||[],e,i),n=km(t.numerators,e,i),a=r-n;return{value:a,display:String(a)}}function km(t,e,i){return t?t.reduce((r,n)=>{let a=n.startsWith("-");n.includes("*");let s=n.replace("-","").replace("*",""),o=a?1-i:i,l=e[o]?.[s];return l?r+l.length:r},0):0}function g0(t,e,i){let r=i9(e||[],i),n=kSe(r),a=ASe(r);return{counters:r,calculated:n,summary:a}}function r9(t){if(!t)return[];let e=[],i=0,r=0,n=0;return t.forEach((a,s)=>{let o=RSe(a,{server:i,index:s,set:r,game:n});e.push(o)}),e}function n9(t,e){let i=i9(t||[],e);return{aces:[i.teams[0].aces?.length||0,i.teams[1].aces?.length||0],doubleFaults:[i.teams[0].doubleFaults?.length||0,i.teams[1].doubleFaults?.length||0],winners:[i.teams[0].winners?.length||0,i.teams[1].winners?.length||0],unforcedErrors:[i.teams[0].unforcedErrors?.length||0,i.teams[1].unforcedErrors?.length||0],totalPoints:[i.teams[0].pointsWon?.length||0,i.teams[1].pointsWon?.length||0]}}function Vt(t,e,i){return t.teams[e]?.[i]?.length??0}function Ts(t,e){return!e||!t?0:Number.parseFloat((t/e*100).toFixed(2))}function vT(t,e,i){return t.find(r=>r.category===e)?.teams[i]?.value??0}function I0(t){if(!t?.counters?.teams)return[];let{counters:e,calculated:i}=t,r=[];r.push({name:"Aces",numerator:[Vt(e,0,"aces"),Vt(e,1,"aces")],default:"numerator"},{name:"Double Faults",numerator:[Vt(e,0,"doubleFaults"),Vt(e,1,"doubleFaults")],default:"numerator"});let n=[Vt(e,0,"serves1stWon"),Vt(e,1,"serves1stWon")],a=[Vt(e,0,"servesWon"),Vt(e,1,"servesWon")];if(n[0]+n[1]>0&&(a[0]!==n[0]||a[1]!==n[1])){let y=[Vt(e,0,"pointsServed"),Vt(e,1,"pointsServed")],b=[Vt(e,0,"serves1stIn"),Vt(e,1,"serves1stIn")],S=[Vt(e,0,"serves2ndWon"),Vt(e,1,"serves2ndWon")],U=[Vt(e,0,"serves2ndIn"),Vt(e,1,"serves2ndIn")];r.push({name:"1st Serve In",numerator:b,denominator:y,pct:[Ts(b[0],y[0]),Ts(b[1],y[1])]},{name:"1st Serve Points Won",numerator:n,denominator:b,pct:[Ts(n[0],b[0]),Ts(n[1],b[1])]},{name:"2nd Serve Points Won",numerator:S,denominator:U,pct:[Ts(S[0],U[0]),Ts(S[1],U[1])]})}r.push({name:"Total Points Won",numerator:[Vt(e,0,"pointsWon"),Vt(e,1,"pointsWon")],default:"numerator"});let s=Vt(e,0,"received1stWon")+Vt(e,0,"received2ndWon"),o=Vt(e,1,"received1stWon")+Vt(e,1,"received2ndWon"),l=Vt(e,1,"pointsServed"),u=Vt(e,0,"pointsServed");r.push({name:"Receiving Points Won",numerator:[s,o],denominator:[l,u],pct:[Ts(s,l),Ts(o,u)]});let c=Vt(e,1,"breakpointsFaced")-Vt(e,1,"breakpointsSaved"),d=Vt(e,0,"breakpointsFaced")-Vt(e,0,"breakpointsSaved"),p=Vt(e,1,"breakpointsFaced"),f=Vt(e,0,"breakpointsFaced");r.push({name:"Break Points Won",numerator:[c,d],denominator:[p,f],pct:[Ts(c,p),Ts(d,f)]});let m=Vt(e,0,"breakpointsSaved"),h=Vt(e,1,"breakpointsSaved"),g=Vt(e,0,"breakpointsFaced"),I=Vt(e,1,"breakpointsFaced");r.push({name:"Break Points Saved",numerator:[m,h],denominator:[g,I],pct:[Ts(m,g),Ts(h,I)]},{name:"Winners",numerator:[Vt(e,0,"winners"),Vt(e,1,"winners")],default:"numerator"},{name:"Unforced Errors",numerator:[Vt(e,0,"unforcedErrors"),Vt(e,1,"unforcedErrors")],default:"numerator"},{name:"Forced Errors",numerator:[Vt(e,0,"forcedErrors"),Vt(e,1,"forcedErrors")],default:"numerator"});let v=a,w=[Vt(e,0,"pointsServed"),Vt(e,1,"pointsServed")];return r.push({name:"Service Points Won",numerator:v,denominator:w,pct:[Ts(v[0],w[0]),Ts(v[1],w[1])]},{name:"Games Won",numerator:[Vt(e,0,"gamesWon"),Vt(e,1,"gamesWon")]},{name:"Most Consecutive Points Won",numerator:[vT(i,"Max Pts/Row",0),vT(i,"Max Pts/Row",1)]},{name:"Most Consecutive Games Won",numerator:[vT(i,"Max Games/Row",0),vT(i,"Max Games/Row",1)]}),r}var a9=class{constructor(e={}){this.redoStack=[],this.pointMultipliers=[],e.competitionFormat?(this.competitionFormat=e.competitionFormat,this.matchUpFormat=e.matchUpFormat||e.competitionFormat.matchUpFormat||"SET3-S:6/TB7",this.pointMultipliers=e.pointMultipliers||e.competitionFormat.pointMultipliers||[]):(this.matchUpFormat=e.matchUpFormat||"SET3-S:6/TB7",this.pointMultipliers=e.pointMultipliers||[]),this.matchUpId=e.matchUpId,this.isDoubles=e.isDoubles||!1,this.eventHandlers=e.eventHandlers,this.state=id({matchUpFormat:this.matchUpFormat,matchUpId:this.matchUpId,isDoubles:this.isDoubles}),this.cacheFormatStructure()}setState(e){this.state=e,this.matchUpFormat=e.matchUpFormat,this.matchUpId=e.matchUpId,this.isDoubles=e.matchUpType==="DOUBLES",this.redoStack=[],this.initialScore=void 0,this.cacheFormatStructure()}getState(){return this.state}addPoint(e){let i=this.state.history?.points.length||0,r=this.state.score.sets.reduce((o,l)=>o+(l.side1Score||0)+(l.side2Score||0),0),n=this.state.score.sets.filter(o=>o.winningSide!==void 0).length,a=this.state.matchUpStatus==="COMPLETED",s=this.hasLineUp()?this.getActivePlayers():void 0;if(this.state=hp(this.state,e,{pointMultipliers:this.pointMultipliers}),s){let o=this.state.history.points[this.state.history.points.length-1];this.isDoubles?o.activePlayers=[s.side1,s.side2]:o.activePlayers=[s.side1[0]||"",s.side2[0]||""]}if(e.penaltyType){let o=this.state.history.points[this.state.history.points.length-1];o.penaltyType=e.penaltyType}if(this.ensureHistory(),this.state.history.entries.push({type:"point",data:{winner:e.winner,server:e.server,timestamp:e.timestamp,rallyLength:e.rallyLength,result:e.result,penaltyType:e.penaltyType},timestamp:e.timestamp||new Date().toISOString(),pointIndex:i}),this.redoStack=[],this.eventHandlers){let o=this.buildEventContext();if(this.eventHandlers.onPoint?.(o),this.state.score.sets.reduce((l,u)=>l+(u.side1Score||0)+(u.side2Score||0),0)>r&&this.eventHandlers.onGameComplete?.({...o,gameWinner:e.winner}),this.state.score.sets.filter(l=>l.winningSide!==void 0).length>n){let l=this.state.score.sets.findLast(u=>u.winningSide!==void 0)?.winningSide===1?0:1;this.eventHandlers.onSetComplete?.({...o,setWinner:l})}if(!a&&this.state.matchUpStatus==="COMPLETED"){let l=this.state.winningSide===1?0:1;this.eventHandlers.onMatchComplete?.({...o,matchWinner:l})}}}addSet(e){this.applyAddSet(e),this.ensureHistory();let i=this.state.score.sets.at(-1)?.winningSide;this.state.history.entries.push({type:"set",data:{...e,winningSide:i},timestamp:e.timestamp||new Date().toISOString()}),this.redoStack=[]}addGame(e){this.applyAddGame(e),this.ensureHistory(),this.state.history.entries.push({type:"game",data:e,timestamp:e.timestamp||new Date().toISOString()}),this.redoStack=[]}endSegment(e){this.applyEndSegment(e),this.ensureHistory();let i=(e?.setNumber??this.state.score.sets.length)-1;this.state.history.entries.push({type:"endSegment",data:{setNumber:i+1,...e},timestamp:e?.timestamp||new Date().toISOString()})}setInitialScore(e){this.initialScore=e,this.redoStack=[],this.applyInitialScore(this.state,e),this.ensureHistory(),this.state.history.entries.push({type:"setInitialScore",data:e,timestamp:new Date().toISOString()}),this.state.matchUpStatus==="TO_BE_PLAYED"&&(this.state.matchUpStatus="IN_PROGRESS")}undo(e=1){let i=this.state.history?.entries;if(i&&i.length>0){let a=Math.min(e,i.length);for(let s=0;s<a;s++){let o=i.pop();this.redoStack.push(o),o.type==="point"&&this.state.history.points.pop()}return this.rebuildFromEntries(),this.eventHandlers?.onUndo?.(this.buildEventContext()),!0}let r=this.state.history?.points||[];if(r.length===0)return!1;let n=Math.min(e,r.length);for(let a=0;a<n;a++){let s=r.pop();this.redoStack.push({type:"point",data:{winner:s.winner,server:s.server,timestamp:s.timestamp,rallyLength:s.rallyLength},timestamp:s.timestamp||""})}return this.rebuildState(),this.eventHandlers?.onUndo?.(this.buildEventContext()),!0}redo(e=1){if(this.redoStack.length===0)return!1;let i=Math.min(e,this.redoStack.length);for(let r=0;r<i;r++){let n=this.redoStack.pop();this.ensureHistory(),this.state.history.entries.push(n),n.type}return this.rebuildFromEntries(),this.eventHandlers?.onRedo?.(this.buildEventContext()),!0}canUndo(){let e=this.state.history?.entries;return e&&e.length>0?!0:(this.state.history?.points.length||0)>0}canRedo(){return this.redoStack.length>0}getUndoDepth(){let e=this.state.history?.entries;return e&&e.length>0?e.length:this.state.history?.points.length||0}getRedoDepth(){return this.redoStack.length}getScore(){return yd(this.state)}getScoreboard(e){return p0(this.state,e)}getWinner(){return f0(this.state)}isComplete(){return m0(this.state)}getPointCount(){return this.state.history?.points.length||0}getFormat(){return this.state.matchUpFormat}getStatistics(e){let i=this.state.history?.points||[];return g0(this.state,i,e)}getStatObjects(e){return I0(this.getStatistics(e))}getNextServer(){if(this.competitionFormat?.serverRule==="WINNER_SERVES"){let r=this.state.history?.points.at(-1);return r?r.winner:0}if(!this.cachedFormatStructure)return 0;let e=[0,0];this.state.score.sets.forEach(r=>{r.winningSide===1&&e[0]++,r.winningSide===2&&e[1]++});let i=XR(this.cachedFormatStructure,e);return d0(this.state,this.cachedFormatStructure,i)}getEpisodes(){return h0(this.state)}isNoAd(){return!!(this.cachedFormatStructure?.setFormat?.NoAD||this.cachedFormatStructure?.setFormat?.gameFormat?.NoAD)}getSetsToWin(){if(!this.cachedFormatStructure)return 2;let e=this.cachedFormatStructure.exactly||this.cachedFormatStructure.bestOf||3;return Math.ceil(e/2)}getTiebreakAt(){let e=this.cachedFormatStructure?.setFormat;if(!e||e.tiebreakSet||e.timed||e.noTiebreak)return null;let i=e.setTo||6;return(typeof e.tiebreakAt=="number"?e.tiebreakAt:void 0)??i}hasFinalSetTiebreak(){let e=this.cachedFormatStructure?.finalSetFormat;return e?e.tiebreakSet?!0:e.noTiebreak?!1:!!(e.tiebreakFormat||e.tiebreakAt!==void 0):this.getTiebreakAt()!==null}getFormatStructure(){return this.cachedFormatStructure}getInputMode(){let e=this.state.history?.entries||[];if(e.length===0)return(this.state.history?.points.length||0)>0?"points":"none";let i=new Set(e.filter(r=>r.type!=="setInitialScore"&&r.type!=="endSegment").map(r=>r.type));if(i.size===0)return"none";if(i.size===1){let r=i.values().next().value;if(r==="point")return"points";if(r==="game")return"games";if(r==="set")return"sets"}return"mixed"}setLineUp(e,i){let r=this.state.sides.find(n=>n.sideNumber===e);r&&(r.lineUp=i),this.initialLineUps??={},this.initialLineUps[e]=i.map(n=>({...n}))}substitute(e){let i=this.state.sides.find(a=>a.sideNumber===e.sideNumber);if(!i?.lineUp)return;let r=i.lineUp.findIndex(a=>a.participantId===e.outParticipantId);if(r===-1)return;this.ensureHistory(),this.state.history.substitutions??=[];let n={sideNumber:e.sideNumber,outParticipantId:e.outParticipantId,inParticipantId:e.inParticipantId,beforePointIndex:this.state.history.points.length,timestamp:e.timestamp};this.state.history.substitutions.push(n),i.lineUp[r]={...i.lineUp[r],participantId:e.inParticipantId},this.state.history.entries.push({type:"substitution",data:n,timestamp:e.timestamp||new Date().toISOString()}),this.redoStack=[]}getActivePlayers(){let e=this.state.sides.find(r=>r.sideNumber===1),i=this.state.sides.find(r=>r.sideNumber===2);return{side1:e?.lineUp?.map(r=>r.participantId)||[],side2:i?.lineUp?.map(r=>r.participantId)||[]}}hasLineUp(){return this.state.sides.some(e=>e.lineUp&&e.lineUp.length>0)}setPointMultipliers(e){this.pointMultipliers=e}getPointMultipliers(){return this.pointMultipliers}getSupplementaryState(){return{redoStack:[...this.redoStack],initialLineUps:this.initialLineUps?Object.fromEntries(Object.entries(this.initialLineUps).map(([e,i])=>[e,i.map(r=>({...r}))])):void 0}}loadSupplementaryState(e){e.redoStack&&(this.redoStack=[...e.redoStack]),e.initialLineUps&&(this.initialLineUps=Object.fromEntries(Object.entries(e.initialLineUps).map(([i,r])=>[i,r.map(n=>({...n}))])))}getPenaltyProfile(){return this.competitionFormat?.penaltyProfile}getPointProfile(){return this.competitionFormat?.pointProfile}getTimerProfile(){return this.competitionFormat?.timerProfile}getTimeoutRules(){return this.competitionFormat?.timeoutRules}getSubstitutionRules(){return this.competitionFormat?.substitutionRules}getPlayerRules(){return this.competitionFormat?.playerRules}setEventHandlers(e){this.eventHandlers=e}getEventHandlers(){return this.eventHandlers}decoratePoint(e,i){let r=this.state.history?.points[e];r&&Object.assign(r,i)}markHardBoundary(e){let i=this.state.score.sets[e.setIndex];i&&(i.hardBoundaries??=[],i.hardBoundaries.includes(e.gameIndex)||(i.hardBoundaries.push(e.gameIndex),i.hardBoundaries.sort((r,n)=>r-n)))}editPoint(e,i,r){let n=this.state.history?.points;if(!n||e<0||e>=n.length)return;let a=r?.recalculate!==!1,s=n[e];if(i.winner!==void 0&&(s.winner=i.winner),i.server!==void 0&&(s.server=i.server),i.timestamp!==void 0&&(s.timestamp=i.timestamp),i.rallyLength!==void 0&&(s.rallyLength=i.rallyLength),i.wrongSide!==void 0&&(s.wrongSide=i.wrongSide),i.wrongServer!==void 0&&(s.wrongServer=i.wrongServer),i.penaltyPoint!==void 0&&(s.penaltyPoint=i.penaltyPoint),!a)return;let o=this.state.history?.entries;if(o){let l=o.find(u=>u.type==="point"&&u.pointIndex===e);l&&(i.winner!==void 0&&(l.data.winner=i.winner),i.server!==void 0&&(l.data.server=i.server))}o&&o.length>0?this.rebuildFromEntries():this.rebuildState(),this.redoStack=[]}reset(){this.state=id({matchUpFormat:this.matchUpFormat,matchUpId:this.matchUpId,isDoubles:this.isDoubles}),this.redoStack=[],this.initialScore=void 0,this.initialLineUps=void 0,this.eventHandlers?.onReset?.(this.buildEventContext())}ensureHistory(){this.state.history??={points:[]},this.state.history.entries??=[]}buildEventContext(){return{state:this.state,score:yd(this.state)}}cacheFormatStructure(){this.cachedFormatStructure=zi(this.matchUpFormat)}getInitialLineUps(){return this.initialLineUps}applyAddSet(e){let{side1Score:i,side2Score:r,side1TiebreakScore:n,side2TiebreakScore:a}=e,s=e.winningSide;s===void 0&&(i>r?s=1:r>i&&(s=2));let o={setNumber:this.state.score.sets.length+1,side1Score:i,side2Score:r,winningSide:s};n!==void 0&&(o.side1TiebreakScore=n),a!==void 0&&(o.side2TiebreakScore=a),this.state.score.sets.push(o),this.state.matchUpStatus==="TO_BE_PLAYED"&&(this.state.matchUpStatus="IN_PROGRESS"),s!==void 0&&this.checkMatchCompletion()}applyAddGame(e){let{winner:i,tiebreakScore:r}=e,n=this.state.score.sets.length>0?this.state.score.sets.at(-1):void 0;(!n||n.winningSide!==void 0)&&(n={setNumber:this.state.score.sets.length+1,side1Score:0,side2Score:0},this.state.score.sets.push(n)),i===0?n.side1Score=(n.side1Score||0)+1:n.side2Score=(n.side2Score||0)+1,r&&(n.side1TiebreakScore=r[0],n.side2TiebreakScore=r[1]),this.state.matchUpStatus==="TO_BE_PLAYED"&&(this.state.matchUpStatus="IN_PROGRESS"),this.checkSetCompletion(n),n.winningSide!==void 0&&this.checkMatchCompletion()}applySubstitution(e){let i=this.state.sides.find(n=>n.sideNumber===e.sideNumber);if(!i?.lineUp)return;let r=i.lineUp.findIndex(n=>n.participantId===e.outParticipantId);r!==-1&&(i.lineUp[r]={...i.lineUp[r],participantId:e.inParticipantId},this.state.history??={points:[]},this.state.history.substitutions??=[],this.state.history.substitutions.push(e))}applyEndSegment(e){let i=(e?.setNumber??this.state.score.sets.length)-1,r=this.state.score.sets[i];if(!r||r.winningSide!==void 0)return;let n=r.side1Score||0,a=r.side2Score||0;n>a?r.winningSide=1:a>n&&(r.winningSide=2),this.checkMatchCompletion()}checkSetCompletion(e){let i=zi(this.state.matchUpFormat);if(!i)return;let r=i.exactly||i.bestOf||3,n=Math.ceil(r/2),a=[0,0];this.state.score.sets.forEach(u=>{u.winningSide===1&&a[0]++,u.winningSide===2&&a[1]++});let s=a[0]===n-1&&a[1]===n-1&&i.finalSetFormat?i.finalSetFormat:i.setFormat;if(!s)return;let o=e.side1Score||0,l=e.side2Score||0;if(s.tiebreakSet){let u=s.tiebreakSet.tiebreakTo||11,c=s.tiebreakSet.NoAD?1:2;(o>=u||l>=u)&&Math.abs(o-l)>=c&&(e.winningSide=o>l?1:2)}else if(!s.timed){let u=s.setTo||6,c=(typeof s.tiebreakAt=="number"?s.tiebreakAt:void 0)??u,d=s.noTiebreak||!1,p=s.winBy||2;(!d&&e.side1TiebreakScore!==void 0&&(o===c+1||l===c+1)||(o>=u||l>=u)&&Math.abs(o-l)>=p)&&(e.winningSide=o>l?1:2)}}checkMatchCompletion(){let e=zi(this.state.matchUpFormat);if(!e)return;let i=e.exactly||e.bestOf||3,r=Math.ceil(i/2),n=s0(e),a=e.exactly;if(n){let s=a||i;if(this.state.score.sets.filter(o=>o.winningSide!==void 0).length>=s){let o=this.state.score.sets.reduce((l,u)=>(u.side1TiebreakScore===void 0?(l[0]+=u.side1Score??0,l[1]+=u.side2Score??0):(l[0]+=u.side1TiebreakScore,l[1]+=u.side2TiebreakScore??0),l),[0,0]);o[0]!==o[1]&&(this.state.matchUpStatus="COMPLETED",this.state.winningSide=o[0]>o[1]?1:2,this.state.endTime=new Date().toISOString())}}else{let s=[0,0];if(this.state.score.sets.forEach(o=>{o.winningSide===1&&s[0]++,o.winningSide===2&&s[1]++}),(s[0]>=r||s[1]>=r)&&(!a||this.state.score.sets.filter(o=>o.winningSide!==void 0).length>=a)){let o=s[0]>=r?0:1;this.state.matchUpStatus="COMPLETED",this.state.winningSide=o+1,this.state.endTime=new Date().toISOString()}}}rebuildFromEntries(){let e=this.state.history?.entries||[],i=this.getInitialLineUps(),r=id({matchUpFormat:this.matchUpFormat,matchUpId:this.matchUpId,isDoubles:this.isDoubles});if(i)for(let n of r.sides)i[n.sideNumber]&&(n.lineUp=i[n.sideNumber].map(a=>({...a})));this.initialScore&&(this.applyInitialScore(r,this.initialScore),r.matchUpStatus==="TO_BE_PLAYED"&&(r.matchUpStatus="IN_PROGRESS")),r.history={points:[],entries:[...e]},this.state=r;for(let n of e)switch(n.type){case"point":this.state=hp(this.state,n.data,{pointMultipliers:this.pointMultipliers}),this.state.history.entries=r.history.entries;break;case"set":this.applyAddSet(n.data);break;case"game":this.applyAddGame(n.data);break;case"endSegment":this.applyEndSegment(n.data);break;case"substitution":this.applySubstitution(n.data);break}}rebuildState(){let e=this.state.history?.points||[],i=id({matchUpFormat:this.matchUpFormat,matchUpId:this.matchUpId,isDoubles:this.isDoubles});this.initialScore&&(this.applyInitialScore(i,this.initialScore),i.matchUpStatus==="TO_BE_PLAYED"&&(i.matchUpStatus="IN_PROGRESS"));for(let r of e)i=hp(i,{winner:r.winner,server:r.server,timestamp:r.timestamp,rallyLength:r.rallyLength,result:r.result},{pointMultipliers:this.pointMultipliers});this.state=i}applyInitialScore(e,i){e.score.sets=[];for(let r=0;r<i.sets.length;r++){let n=i.sets[r],a={setNumber:r+1,side1Score:n.side1Score,side2Score:n.side2Score};n.side1TiebreakScore!==void 0&&(a.side1TiebreakScore=n.side1TiebreakScore),n.side2TiebreakScore!==void 0&&(a.side2TiebreakScore=n.side2TiebreakScore),n.winningSide!==void 0?a.winningSide=n.winningSide:n.side1Score>n.side2Score?a.winningSide=1:n.side2Score>n.side1Score&&(a.winningSide=2),e.score.sets.push(a)}if(i.currentSetScore){let r={setNumber:e.score.sets.length+1,side1Score:i.currentSetScore.side1Score,side2Score:i.currentSetScore.side2Score,side1GameScores:[],side2GameScores:[]};i.currentGameScore?(r.side1GameScores=[i.currentGameScore.side1Points],r.side2GameScores=[i.currentGameScore.side2Points]):(r.side1GameScores=[0],r.side2GameScores=[0]),e.score.sets.push(r)}}},s9={};ct(s9,{addPoint:()=>hp,calculatePointsTo:()=>JR,createMatchUp:()=>id,inferServeSide:()=>o0,resolvePointValue:()=>l0});var o9={};ct(o9,{keyValueScore:()=>R9,parseMatchUpFormat:()=>zi,stringifyMatchUpFormat:()=>QE,tidyScore:()=>A9});var $Se="COMPLETED",BSe="WO/WO",l9=["RET","DEF","WO",BSe,"ABN","SUS","INT"],PO="DEFAULTED",u9="WALKOVER",c9="ABANDONED",d9="SUSPENDED",p9="RETIRED",f9="INTERRUPTED",VSe=[p9,PO,u9],jSe="Enter Score",Om="()",Op="[]",v0=["up","left","shift+tab"],y0=["enter","down","tab","right"],eP="backspace",m9="r",h9="s",g9="a",I9="d",v9="w",y9="i",ZR=[m9,I9,v9,g9,h9,y9],eC="space",CA=["[","("],tP=[...v0,...y0,eC,"]"],b9="-",GSe="/",am=b9,zl=b9,w9=[GSe],HSe=0,WSe=["=","+","num_1","num_2","shift+=","shift+-"],b0=["0","1","2","3","4","5","6","7","8","9"].concat(ZR),S9=b0.map(t=>`shift+${t}`),U9=[am,eP].concat(tP,w9),T9=[b0,S9,U9].join(","),zSe=[T9,v0,y0,WSe].join(","),qSe={OUTCOMEKEYS:ZR,SIDE1KEYS:b0,SIDE2KEYS:S9,MODIFIERS:U9,PROMPT:jSe,MOVEUP:v0,MOVEDOWN:y0,HOTKEYS:zSe};function ng({scoreString:t,lowSide:e,outcome:i}){if({scoreString:t}=D9({scoreString:t}),e===2){let r=(t&&t[t.length-1])!==" "?" ":"";return t+r+i}else return i+" "+t}function D9({scoreString:t}){if(!t)return{scoreString:""};let e=!1;for(let i of l9){let r=t?.indexOf(i);r===0?t=t.slice(i.length+1).trim()+" ":r>0&&(t=t.slice(0,r)),r>=0&&(e=!0)}return t?.trim()||(t=""),{scoreString:t,removed:e}}function EO({analysis:t,scoreString:e,sets:i,lowSide:r}){let n,a;if(!e)return{scoreString:e,sets:i};let{scoreString:s,removed:o}=D9({scoreString:e});if(e=s,o)return{scoreString:e,sets:i,outcomeRemoved:!0};let l=i[i.length-1]||{},u=Object.values(l).filter(h=>h!==void 0).length;l.setNumber&&u===1&&(i=i.slice(0,i.length-1),l=i[i.length-1]||{});let{tiebreakSet:c}=t.setFormat,{tiebreakTo:d,NoAD:p}=c||{},{isTiebreakEntry:f}=$g({brackets:Op,scoreString:e}),m=KSe(e);if(m>=0){n=e.slice(0,m);let{isTiebreakEntry:h}=$g({brackets:Om,scoreString:n}),{lastOpenBracketIndex:g,isTiebreakEntry:I}=$g({brackets:Op,scoreString:n}),v=n&&n[n.length-1].trim(),w=n&&!isNaN(v),y=t.isIncompleteSetScore;if(f&&I){let b=n.slice(g+1).split(zl),S=b?.length>0&&b[0]!==void 0&&!isNaN(parseInt(b[0]))&&parseInt(b[0])||void 0,U=b?.length>1&&b[1]!==void 0&&parseInt(b[1])||void 0,T=[S,U];if(U){let P=r===1?1:0;T[P]=(T?.[1-P]||0)+(p?1:2),(T[P]||0)<d&&(T[P]=d),n=e.slice(0,g+1),n+=T.join(zl)}else S!==void 0?(n=e.slice(0,g+1),n+=S):(n=e.slice(0,g),y=!0);l.side1TiebreakScore=T[0]||0,l.side2TiebreakScore=T[1]||0}if(n.length||(n=void 0),y){let b=l.side1Score?.toString();if(b){let S=b?.slice(0,b.length-1);l.side1Score=!isNaN(S)&&parseInt(S)||void 0,l.side1Score===void 0&&(l.side2Score=void 0)}t.isTimedSet?(a=l.side1Score?i:i?.slice(0,i.length-1)||[],a[i.length-1]=l):a=i?.slice(0,i.length-1)||[]}else if(w){let b=l.side2Score?.toString(),S=l.side1Score?.toString();if(!t.isTiebreakEntry&&!t.isMatchTiebreak)if(l.side2Score){let U=b?.slice(0,b.length-1);l.side2Score=!isNaN(U)&&parseInt(U)||void 0}else{let U=S?.slice(0,S.length-1);l.side1Score=!isNaN(U)&&parseInt(U)||void 0}t.isTimedSet?l.side1Score?(a=i||[],a[i.length-1]=l):a=i?.slice(0,i.length-1)||[]:(a=i||[],a[i.length-1]=l),a[a.length-1]&&Object.assign(a[a.length-1],{winningSide:void 0})}else h?(a=i||[],Object.assign(a[a.length-1]||{},{winningSide:void 0,side1TiebreakScore:void 0,side2TiebreakScore:void 0})):(f&&!I?a=i?.slice(0,i.length-1)||[]:(a=i,a[i.length-1]=l),f||(a[a.length-1].side2Score=0,a[a.length-1].winningSide=void 0));return{scoreString:n,sets:a}}return{scoreString:e,sets:i}}function $g({brackets:t=Om,scoreString:e}){if(!e)return{};let[i,r]=t.split(""),n=e.split(""),a=Math.max(...qo(i,n)),s=Math.max(...qo(r,n));return{isTiebreakEntry:a>s,lastOpenBracketIndex:a}}function YSe({scoreString:t}){if(!t)return!1;let e=t&&t[t.length-1].trim(),i=t&&!isNaN(e),[r,n]=Op.split(""),a=t.split(""),s=Math.max(...qo(r,a)),o=Math.max(...qo(n,a)),l=Math.max(...qo(zl,a));return i&&s>o&&l>s}function KSe(t){return t.split("").reduce((e,i,r)=>(i.match(/\d+/g)&&e.push(r),e),[]).pop()}function P9(t){let{lowValue:e=0,NoAD:i=!1,tiebreakTo:r}=t||{},n=i?1:2;return e+1>=r?e+n:parseInt(r)}function sW({matchUpFormat:t,matchUpStatus:e,winningSide:i,sets:r}){let n=zi(t),{bestOf:a}=n,s=Math.ceil(a/2),o=r?.reduce((l,u)=>{let{winningSide:c}=u;return c&&l[c-1]++,l},[0,0])?.indexOf(s)+1||void 0;return VSe.includes(e)&&i&&(o=i),{matchUpWinningSide:o}}function tC({ignoreTiebreak:t=!1,matchUpScoringFormat:e,matchUpFormat:i,isTiebreakSet:r,isDecidingSet:n,isTimedSet:a,set:s}){if(!s)return{error:Xe,info:"missing set"};e=e||i&&zi(i);let o=n&&e.finalSetFormat||e?.setFormat||{},{side1Score:l,side2Score:u}=s,{setTo:c,tiebreakAt:d}=o,p=l||u,f=iC({set:s}),m=Math.abs(l-u),h=l>=c||u>=c,g=r||l>=c&&u>=c||d&&d<c&&(l===d||u===d),I=t||g&&(f===1&&s.side1TiebreakScore>s.side2TiebreakScore||f===2&&s.side2TiebreakScore>s.side1TiebreakScore),v=!g&&o.NoAD||g||r&&o.tiebreakFormat?.NoAD?1:2,w=m>=v;return!!((a&&p||h&&(w||g)||r)&&(!g||I))}function iC({set:t}){if(t.side1Score||t.side2Score){if(t.side1Score>t.side2Score)return 1;if(t.side2Score>t.side1Score)return 2}else if(t.side1TiebreakScore||t.side2TiebreakScore){if(t.side1TiebreakScore>t.side2TiebreakScore)return 1;if(t.side2TiebreakScore>t.side1TiebreakScore)return 2}}function w0({analysis:t,set:e}){let i=iC({set:e}),{isDecidingSet:r,isTiebreakSet:n,matchUpScoringFormat:a}=t;return tC({matchUpScoringFormat:a,isDecidingSet:r,isTiebreakSet:n,set:e})&&i}function XSe({analysis:t,scoreString:e,sets:i,value:r}){let n;if(!i?.length)return{sets:[]};let a=i[i.length-1];r=Ye(r);let{validSide2Score:s,requiresTiebreak:o}=JSe({analysis:t,set:a,value:r});if(s){n=!0,e=(e||"")+r,a.side2Score=r;let l=w0({analysis:t,set:i[i.length-1]});if(a.winningSide=l||void 0,o){let u=Om.split("")[0];e+=u}else t.isDecidingSet||(e+=" ")}return{sets:i,scoreString:e,updated:n}}function JSe({analysis:t,set:e={},value:i}){let r=t.isDecidingSet&&t.matchUpScoringFormat.finalSetFormat||t.matchUpScoringFormat.setFormat,{tiebreakAt:n,setTo:a,NoAD:s}=r,{side1Score:o}=e,l,u;return n&&n<a?o===n?l=i<=a:l=i<=n:o===a?s?l=i<a:l=i<=a+1:o===a-1?s?l=i<=a:l=i<=a+1:o===a+1?l=i===a||i===a-1:l=i<=a,l&&(n&&n<a?u=o===a&&i===n||o===n&&i===a:u=o>=a&&i>=a&&o!==i),{validSide2Score:l,requiresTiebreak:u}}function E9({lowSide:t,value:e,sets:i,scoreString:r,winningSide:n,matchUpStatus:a}){let s;return e===m9?r?(s=!0,r=ng({scoreString:r,lowSide:t,outcome:"RET"}),n=t===2?1:2,a=p9):(s=!0,r=ng({scoreString:r,lowSide:t,outcome:"DEF"}),n=t===2?1:2,a=PO):e===I9?(s=!0,r=ng({scoreString:r,lowSide:t,outcome:"DEF"}),n=t===2?1:2,a=PO):e===v9?(s=!0,i=[],r="WO",n=t===2?1:2,a=u9):e===h9&&r?(s=!0,r=ng({scoreString:r,lowSide:t,outcome:"SUS"}),a=d9,n=void 0):e===g9?(s=!0,r=ng({scoreString:r,lowSide:t,outcome:"ABN"}),a=c9,n=void 0):e===y9&&r&&(s=!0,r=ng({scoreString:r,lowSide:t,outcome:"INT"}),a=f9,n=void 0),{updated:s,sets:i,scoreString:r,matchUpStatus:a,winningSide:n}}function QSe(t){let{sets:e,info:i,scoreString:r,winningSide:n,matchUpStatus:a}=t,{analysis:s,lowSide:o,value:l}=t,u,c;!e?.length&&l!==eP&&(e=[{setNumber:1}]);let d=e.length-1;if(ZR.includes(l)){let p=e[e.length-1]||{},{side1Score:f,side2Score:m}=p;f&&!m?i="missing side2Score":s.finalSetIsComplete||n?i="final set is already complete":s.isIncompleteSetScore?i="incomplete set scoreString":s.isIncompleteSetScore||({sets:e,scoreString:r,winningSide:n,matchUpStatus:a,updated:u}=E9({lowSide:o,value:l,sets:e,scoreString:r,matchUpStatus:a,winningSide:n}))}else if(l===eP){if({scoreString:r,sets:e,outcomeRemoved:c}=EO({analysis:s,scoreString:r,sets:e}),r?.trim()===""&&(r=r.trim()),r||(e=[]),c){let p=e[e.length-1]||{},{side1Score:f,side2Score:m}=p;if(f&&m){let h=f>m&&1||m>f&&2||void 0;h&&(p.winningSide=h,e.push({setNumber:e.length+1}))}}a=void 0,n=void 0,u=!0}else if(s.hasOutcome)i="has outcome";else{if(n)return{sets:e,scoreString:r,winningSide:n,matchUpStatus:a,updated:!1,info:"matchUp is complete"};if(l===eC){let p=e[e.length-1]||{},{side1Score:f,side2Score:m}=p,h=f>m&&1||m>f&&2||void 0;h&&!n&&!s.isIncompleteSetScore&&(e[e.length-1].winningSide=h,e.push({setNumber:e.length+1}),r+=" ",u=!0)}else if(l===am&&e[d].side1Score!==void 0&&e[d].side2Score===void 0&&r&&s.isNumericEnding)r+="-",e[d].side2Score=0,a=void 0,n=void 0,u=!0;else if(!isNaN(l)){let p;if(e[d].side2Score===void 0){let f=Ye((e[d].side1Score||0).toString()+l).toString().slice(0,2);e[d].side1Score=Ye(f),p=e[d].side1Score.toString(),u=!0}else{let f=Ye((e[d].side2Score||0).toString()+l).toString().slice(0,2);e[d].side2Score=Ye(f),p=[e[d].side1Score,e[d].side2Score].join("-"),u=!0}if(u){let f=(e.slice(0,d)||[]).filter(m=>m).map(m=>{let{side1Score:h,side2Score:g}=m;return[h,g].join("-")}).join(" ");f?r=f+" "+p:r=p}}}return{sets:e,scoreString:r,winningSide:n,matchUpStatus:a,info:i,updated:u}}function ZSe({analysis:t,auto:e,lowSide:i,scoreString:r="",sets:n,value:a}){let s,o,{tiebreakSet:{tiebreakTo:l,NoAD:u}}=t.setFormat,[c]=Op.split("");if(t.isMatchTiebreakEntry||(r+=c),n[t.setNumber-1]){let{lastOpenBracketIndex:d}=$g({brackets:Op,scoreString:r}),p=(r.slice((d??0)+1)+(e?"":a)).split(zl);if((p[i-1]?.length||0)>=2)o="tiebreak digit limit";else if(e){i===1&&(p[0]=(p[0]||"")+a),i===2&&(p[1]=(p[1]||"")+a);let f=[p[0]||0,p[1]||0].map(g=>Ye(g)),m=i===1?1:0;f[m]=f[1-m]+(u?1:2),f[m]<l&&(f[m]=l);let h=n[n.length-1];h.side1TiebreakScore=f[0],h.side2TiebreakScore=f[1],r=r.slice(0,(d??0)+1),r+=f.join(zl),s=!0}else{let f=[p[0]||0,p[1]||0].map(h=>Ye(h)),m=n[n.length-1];m.side1TiebreakScore=f[0],m.side2TiebreakScore=f[1],r+=a,s=!0}}else{let d=P9({lowValue:Ye(a||0),tiebreakTo:l,NoAD:u}),p=[Ye(a),d];i===2&&p.reverse();let f={side1TiebreakScore:p[0],side2TiebreakScore:p[1],setNumber:n?.length+1||1};n.push(f),r+=p.join(zl),s=!0}return{info:o,scoreString:r,sets:n,updated:s}}function eUe({analysis:t,lowSide:e,scoreString:i,value:r}){let{setTo:n,tiebreakAt:a,NoAD:s}=t?.setFormat||{},o=r===parseInt(a||n);if(a&&a<n&&r>a)return{scoreString:i};if(s&&r===n||r>n)return{scoreString:i};let l=m(),u=[r,l];e===2&&u.reverse();let c=Om.split("")[0],d=u.join(am)+(o?c:" ");i=(i||"")+d;let p={side1Score:u[0],side2Score:u[1]},f=w0({analysis:t,set:p});return p.winningSide=f||void 0,{scoreString:i,set:p};function m(){return o?r+1:r+1===n?r+(s?1:2):n}}function tUe({matchUpFormat:t,scoreString:e,winningSide:i,value:r,sets:n}){let a=(n?.filter(F=>F?.winningSide)?.length||0)+(i?0:1),s=zi(t),o=a===s?.bestOf,l=o&&s?.finalSetFormat||s?.setFormat||{},u=l?.timed,c=o&&n[s?.bestOf-1],d=c?.winningSide,{isTiebreakEntry:p}=$g({brackets:Om,scoreString:e}),{isTiebreakEntry:f}=$g({brackets:Op,scoreString:e}),m=p||f,h=!!l.tiebreakSet,g=e?.[e.length-1]?.trim(),I=e&&!isNaN(g),v=!m&&g===am,w=p&&CA.includes(g),y=f&&CA.includes(g),b=f&&g===zl,S=e?.split(""),[U]=Op.split(""),T=S&&Math.max(...qo(U,S)),P=S&&Math.max(...qo(zl,S)),D=S&&P>T,E=n[n.length-1]?.winningSide,R=n?.length&&!E,C=l9.find(F=>e?.indexOf(F)>=0),M=!isNaN(r),N=r===eC,A=tP.includes(r),O=e?.split("").find(F=>CA.includes(F)),k=A&&f&&!y&&(b||!YSe({scoreString:e}));return{isTiebreakSetValue:h&&M,matchUpScoringFormat:s,setNumber:a,setFormat:l,matchTiebreakHasJoiner:D,isGameScoreEntry:R,isSpace:N,isCloser:A,isTiebreakCloser:A&&O&&m&&I,isDecidingSet:o,isTiebreakSet:h,isTimedSet:u,isNumericEnding:I,isNumericValue:M,hasOpener:O,hasOutcome:C,finalSet:c,finalSetIsComplete:d,lastSetIsComplete:E,isInvalidSetTiebreakValue:N&&m&&w,isInvalidMatchTiebreakValue:k,isTiebreakEntry:m,isSetTiebreakEntry:p,isMatchTiebreakEntry:f,isIncompleteSetScore:v,isIncompleteSetTiebreak:w,isIncompleteMatchTiebreak:y,isPartialMatchTiebreakValue:b}}function R9(t){let{lowSide:e=1,value:i}=t,{scoreString:r,sets:n,winningSide:a,matchUpStatus:s}=t,{matchUpFormat:o,shiftFirst:l,auto:u=!0}=t,c,d,p=l&&e===2||!l&&e===1;if(!T9.includes(i))return{updated:!1,info:"invalid key"};l&&(e=3-e);let{matchUpWinningSide:f}=sW({sets:n,winningSide:a,matchUpStatus:s,matchUpFormat:o});a=f;let m=tUe({value:i,winningSide:a,scoreString:r,sets:n,matchUpFormat:o});if(w9.includes(i)&&(i=am),m.hasOpener&&m.isTiebreakEntry&&!m.isTiebreakSet&&p&&Ye(i)===0&&(m.isTiebreakCloser=!0),tP.includes(i)&&m.hasOpener&&(i=""),tP.includes(i)&&(i=eC),m.lastSetIsComplete){let h=r?.length&&r[r.length-1];r&&h!==" "&&(r+=" ")}if(m.isTimedSet)({info:d,sets:n,scoreString:r,updated:c,matchUpStatus:s,winningSide:a}=QSe({analysis:m,lowSide:e,scoreString:r,sets:n,matchUpStatus:s,winningSide:a,value:i}));else if(ZR.includes(i))m.finalSetIsComplete||a?d="final set is already complete":!m.isTiebreakEntry&&!m.isIncompleteSetScore?{sets:n,scoreString:r,matchUpStatus:s,winningSide:a,updated:c}=E9({lowSide:e,sets:n,scoreString:r,matchUpStatus:s,winningSide:a,value:i}):m.isTiebreakEntry||m.isIncompleteSetScore?d="incomplete set scoreString or tiebreak entry":console.log("handle case",{value:i});else if(i===eP)c=!0,{scoreString:r,sets:n}=EO({analysis:m,scoreString:r,sets:n,lowSide:e}),r||(n=[]),s=void 0,a=void 0;else if(m.hasOutcome)d="has outcome";else if(i===am&&!m.isMatchTiebreakEntry)(!m.isSetTiebreakEntry||m.isSetTiebreakEntry&&!m.isNumericEnding)&&(c=!0,{scoreString:r,sets:n}=EO({analysis:m,scoreString:r,sets:n,lowSide:e}),s=void 0);else if(i===zl&&m.isMatchTiebreakEntry&&!m.isSetTiebreakEntry)m.matchTiebreakHasJoiner?d="existing joiner":m.isNumericEnding&&(c=!0,r+=zl);else if([am,zl].includes(i))d="invalid location for joiner";else{if(a)return{updated:!1,info:"matchUp is complete"};if(m.isIncompleteSetScore)m.isNumericValue&&({sets:n,scoreString:r,updated:c}=XSe({analysis:m,scoreString:r,sets:n,value:i}));else if(m.isInvalidMatchTiebreakValue)d="invalid matchUp tiebreak character";else if(m.isInvalidSetTiebreakValue)d="invalid set tiebreak character";else if(m.isTiebreakCloser){let h=m.isSetTiebreakEntry?Om:Op,g=h.split("").reverse()[0],I=h.split("")[0],v=n[n.length-1],{tiebreakFormat:w}=m.setFormat,{tiebreakTo:y,NoAD:b}=w||{},S=iC({set:v});if(!m.isTiebreakSet){let T=Number.parseInt(r.split(I).reverse()[0]),P=P9({lowValue:T,tiebreakTo:y,NoAD:b});S===1?(v.side1TiebreakScore=P,v.side2TiebreakScore=T):(v.side1TiebreakScore=T,v.side2TiebreakScore=P)}r=(r||"")+g,m.isDecidingSet||(r+=" ");let U=w0({analysis:m,set:v});v.winningSide=U||void 0,c=!0}else if(m.isTiebreakSetValue)({info:d,scoreString:r,sets:n,updated:c}=ZSe({analysis:m,auto:u,lowSide:e,scoreString:r,sets:n,value:i}));else if(m.isSetTiebreakEntry){let[h]=Om.split(""),g=Math.max(...qo(h,r.split(""))),I=r.slice(g+1),v=I&&Ye(I)===HSe,w=Ye(I?I+i:i),{tiebreakFormat:y}=m.setFormat,{tiebreakTo:b,NoAD:S}=y||{};!v&&I.length<2?S&&w>b-1?d="invalid low value for NoAD tiebreak":(c=!0,r=(r||"")+i):d=v?"tiebreak begins with zero":"tiebreak digit limit"}else if(m.isCloser)d=`invalid key: ${i}`;else if(m.isGameScoreEntry)d="game scoreString entry";else if(m.lastSetIsComplete||!n.length){c=!0;let{scoreString:h,set:g}=eUe({analysis:m,lowSide:e,scoreString:r,value:Ye(i)});g&&(g.setNumber=n?.length+1||1),n=n?.concat(g).filter(Boolean)||[g],r=h||void 0}else console.log("error: unknown outcome")}if(c){n=n?.filter(Boolean);let{matchUpWinningSide:h}=sW({sets:n,winningSide:a,matchUpStatus:s,matchUpFormat:o});return a=h,h&&(!s||[Fi,cs].includes(s))?(s=$Se,n=n.filter(g=>{let{side1Score:I,side2Score:v,side1TiebreakScore:w,side2TiebreakScore:y}=g;return I||v||w||y})):r&&!a&&![d9,c9,f9].includes(s)&&(s=void 0),{updated:c,scoreString:r,sets:n,winningSide:a,matchUpStatus:s,info:d}}return{updated:c,scoreString:r,sets:n,winningSide:a,matchUpStatus:s,info:d}}var rC="\\d+-\\d+",Eb="\\d+-\\d+\\(\\d+\\)",S0="\\[\\d+-\\d+\\]",iUe="\\d+-\\d+\\(\\d+-\\d+\\)",rUe=new RegExp(`(${rC}),`,"g"),nUe=new RegExp(`(${Eb}),`,"g"),aUe=[rC,Eb,S0,iUe],sUe=["0","1","2","00","01","10","11","002","012","102","112","000","001","010","100","011","101","110","111","002","012","102","112","0002","0012","0102","1002","0112","1012","1102","1112","3","03","13","013","103"],oUe=sUe.map(t=>{let e=t.split("").map(i=>aUe[i]).join(" ");return new RegExp(`^${e}$`)});function oW(t){return!t||oUe.some(e=>e.test(t))}function lUe(t){let e="[];()",i=["[","("],r=Object.assign({},...e.split("").map(s=>({[s]:0}))),n="",a=t.split("").map(s=>{let o=e.includes(s)&&s,l=i.includes(o);if(l&&o)return r[o]+=1,n=o,s;if(!l&&o&&n&&o!==n){r[n]-=1;let u="[];".includes(n)&&"[];"||"()".includes(n)&&"()"||"",c=u.split("").find(d=>d!==n);if(u.includes(o))r[n]||(n="");else return r[o]||(n=""),c}return s}).join("");return t!==a?a:t}function eD(t){return/^\(\d+\)$/.test(t)||/^\(\d+$/.test(t)}function uUe(t){return/^\(\d+-\d+\)$/.test(t)||/^\[\d+-\d+\]$/.test(t)}function uI(t){let e=(i=>i?.split("-").join("").split("/").join(""))(t);if(/^\d+$/.test(e)&&e.length===2){let i=e.split("");return Math.abs(i.reduce((r,n)=>+r-+n))===1}return!1}function iP(t,e){let i=[t.slice(e,e+2),e?t.slice(0,1):t.slice(2)].map(n=>parseInt(n.join("")));e&&i.reverse();let r=i;if(Math.abs(r.reduce((n,a)=>+n-+a))>=2)return r.join("-")}function lW(t){return t.length===2?t.split("").join("-"):([", ",",","/"," "].forEach(e=>t=t.split(e).join("-")),t=t.replace(/-{2,}/,"-"),t)}function cUe(t){return t.startsWith("(")&&t.endsWith(")")}function dUe({score:t,applied:e}){t=lUe(t);let i=/\)(\d+)/g;if(i.test(t))for(let S of t.match(i)){let U=S.replace(")",") ");t=t.replace(S,U)}t=t.replace(/\)\//g,") / "),t=t.replace(/\/\)/g,")");let r=/\(([\d- ]+)\)/g,n=/\(([\d- ]+)\)/,a=t.match(r);for(let S of a||[]){let[U]=S.match(n).slice(1),T=U.replace(/ /g,"");t=t.replace(S,`(${T})`)}let s=/\(\(\d-\d\)\)/g;if(s.test(t)){let S=t.match(s);S.length&&S.forEach(U=>{let T=U.match(/\((\(\d-\d\))\)/).slice(1)[0];t=t.replace(U,T)})}if(s=/\(\((\d)\)\)/g,s.test(t)){let S=t.match(s);S.length&&S.forEach(U=>{let T=U.match(/\((\(\d\))\)/).slice(1)[0];t=t.replace(U,T)})}/(^|\s)6-,/.test(t)&&(t=t.replace(/(^|\s)6-,/g,"6-0,"));let o=new RegExp(/[-,]{2,}/g);t=t.replace(o,"-"),["- "," -"].forEach(S=>{let U=new RegExp(`(\\d+)${S}(\\d+)`,"g"),T=t.match(U);T&&T.forEach(P=>t=t.replace(P,P.split(S).join("-")))}),/^[(-/,]+$/.test(t)&&(t=""),/\)[-/,]+$/.test(t)&&(t=t.slice(0,t.length-1)),/\d \/\d/.test(t)&&(t=t.replace(/ \//g,"/")),t.includes(" /")&&(t=t.replace(/ \//g," "));let l=/\(\d+, \)/g;l.test(t)&&t.match(l).forEach(S=>{let[U]=S.match(/\((\d+), \)/).slice(1);U.length===2?t=t.replace(S,`(${U})`):U.length===1&&U==="6"&&(t=t.replace(S,"(6-0)"))});let u=/\((\d+)\/\)/g;u.test(t)&&t.match(u).forEach(S=>{let[U]=S.match(/\((\d+)\/\)/).slice(1);U.length===2?t=t.replace(S,`(${U})`):U.length===1&&U==="6"?t=t.replace(S,"(6-0)"):t=t.replace(S,`(${U})`)});let c=/\d\/\d\/,/g;c.test(t)&&t.match(c).forEach(S=>{let[U]=S.match(/(\d\/\d)\/,/).slice(1);t=t.replace(S,`${U},`),e.push("slashComma")});let d=/\(\/(\d+)\)/g;d.test(t)&&t.match(d).forEach(S=>{let[U]=S.match(/\(\/(\d+)\)/).slice(1);U.length===2?t=t.replace(S,`(${U})`):U.length===1&&parseInt(U)<6?t=t.replace(S,`(6-${U})`):t=t.replace(S,`(${U})`)});let p,f,m,h,g,I=()=>{g=va(t.split("")),f=g["("]===(g[")"]||0)+1,p=(g["("]||0)+1===g[")"],m=g["["]===g["]"]+1,h=f&&!m};I();let v=/(\d+-\d+\(\d+)0,/;if(v.test(t)){let[S]=t.match(v).slice(1);t=t.replace(v,S+")")}if(g["("]===g[")"]&&g["("]>1){let S=t.split(")(").join(") (").split(" ");S.every(cUe)?t=S.map(U=>{let T=U.slice(1,U.length-1);return T.length>2?T:U}).join(" "):t=S.join(" ")}I();let w=/[A-Za-z]+/.test(t),y=/\d+/.test(t);if(!w&&!y)return{score:""};if(/^\[.+\]$/.test(t)&&"()/,- ".split("").some(S=>g[S])&&(t=t.slice(1,t.length-1)),/^\(.+\)$/.test(t)&&g["("]===1&&g[")"]===1&&"[]/,".split("").some(S=>g[S]>1)&&(t=t.slice(1,t.length-1)),t.startsWith("(")&&t.endsWith("))")&&(t=t.slice(1,t.length-1)),g["("]>(g[")"]||0)&&t[t.length-1]==="("&&(t=t.slice(0,t.length-1)+")",I()),g["("]===1&&!g[")"]&&t[0]==="("&&(t=t+")",I()),g["("]>(g[")"]||0)&&t.slice(0,2)==="(("&&(t=t.slice(1)),p){if(/^9\d/.test(t))t="("+t.slice(1);else if(t[0]!=="(")t="("+t;else{let S=[],U=0;for(let T of t.split("").reverse())T===")"&&(U?S.push("("):U+=1),T==="("&&(U-=1),S.push(T);S.reverse(),t=S.join("")}I()}if(g[")"]>(g["("]||0)&&t[0]===")"&&(t="("+t.slice(1),I()),h&&(t.endsWith(9)||/\d+0$/.test(t))&&(t=t.slice(0,t.length-1)+")",I()),h&&(!t.endsWith(")")||t.startsWith("(("))&&(t=t+")",I()),h){let S="",U=0;for(let T of t.split(""))T==="("&&(U?S+=")":U+=1),T===")"&&(U-=1),S+=T;t=S}I(),m&&!f&&(t=t+"]"),t.includes("([")&&t.includes("])")&&(t=t.split("([").join("[").split("])").join("]"),I()),/\(\d+0$/.test(t)&&(t=t.slice(0,t.length-1)+")"),I(),g[")"]===1&&!g["("]&&t.endsWith(")")&&(t=t.slice(0,t.length-1)),t.startsWith("(")&&t.endsWith(")")&&g["("]===1&&g[")"]===1&&(t=t.slice(1,t.length-1),I());let b=S=>{let U=S.indexOf("("),T=S.indexOf(")");return U>=0&&T>=0&&U<T};if(/^\([\d ]+.*[\d ]+\)$/.test(t)&&g["("]===g[")"]){let S=t.slice(1,t.length-1);b(S)&&(t=S,I())}return{score:t,applied:e}}function nC(t){if(!/^[\d-]+(\(\d\))*$/.test(t))return t;let e=qo("-",t.split(""));if(!e.length)return t;let i=t.split("-"),r=!(i.length%2),n=!!(e.length%2);return r&&n&&e.length>i.length/2&&e.filter((a,s)=>s%2).forEach(a=>{t=t.substring(0,a)+" "+t.substring(a+1)}),t}function pUe({score:t,applied:e}){return t.includes("( ")&&(e.push("removeParenSpacingAfterOpen"),t=t.split("( ").map(i=>i.trim()).join("(")),t.includes(" )")&&(e.push("removeParenSpacingBeforeClose"),t=t.split(" )").map(i=>i.trim()).join(")")),[rUe,nUe].forEach(i=>{let r=t.match(i);r?.length&&(r.forEach(n=>{t=t.replace(n,n.slice(0,n.length-1)+" ")}),e.push("setsEndComma"))}),t=t.split(" ").filter(Boolean).map(nC).join(" "),{score:t,applied:e}}function fUe({score:t}){if(typeof t!="string")return{score:t};let e=p=>p?.split("-").join("").split("/").join(""),i=p=>p.split("[").join("(").split("]").join(")");t=t.split(", ").join(" ");let r=t.split(" ");t=r.map(p=>{let f=/^-(\d+)$/;if(f.test(p)){let[m]=p.match(f).slice(1);if(m.length===2)return m.split("").join("-")}return p}).join(" "),r=t.split(" ");let n=r.filter(eD),a=0,s="";for(let p of n){let f=qo(p,r).find(I=>!a||I>a),m=r.slice(a,f-1),h=r[f-1],g=e(h);if(/^\d+$/.test(g)&&g.length===2){let I=g.split(""),v=Math.abs(I.reduce((w,y)=>+w-+y));if(v===1){let w=[m.join(" "),[h,p].join("")].join(" ");s+=w,a=f+1}else if(v===0){let w=Math.max(...I);if([4,5,6,7,8,9].includes(w)){let y=[6,4].includes(w)?w+1:w-1,b=[w,y].sort().reverse().join("-"),S=[m.join(" "),[b,p].join("")].join(" ");s+=S,a=f+1}}}}if(n.length&&s.length){let p=r.slice(a).join(" ");return s=[s,p].join(" "),{score:s.trim()}}if(r.length===2&&["(","["].some(p=>r[1].includes(p))){let p=e(r[0]).split("");if(Math.abs(p.reduce((f,m)=>+f-+m,0))===1)return r[1]=i(r[1]),{score:r.join("")}}let o=r.map(p=>uUe(p)&&"bracket"||uI(p)&&"set");if(o.includes("set")&&o.includes("bracket")){let p,f="";return r.forEach((m,h)=>{o[h]==="bracket"&&p==="set"?(m=i(m),f+=m):f+=` ${m}`,p=o[h]}),{score:f.trim()}}r=t.split(" ");let l,u=r.map(p=>{let f=new RegExp(/^(\d+)-(\d+)$/);if(f.test(p)){let[m,h]=p.match(f).slice(1),g=Math.abs([m,h].reduce((v,w)=>+v-+w,0)),I=Math.max(m,h);if(g===1)return l="tiebreakSet",l;if(g>=2&&I>=7&&l==="tiebreakSet")return l="tiebreak",l}}),c=qo("tiebreak",u);if(c.length){let p="";r.forEach((f,m)=>{c.includes(m)?p+=`(${f}) `:c.includes(m+1)?p+=`${f}`:p+=`${f} `}),t=p.trim()}let d=/(\d+-\d+)\((\d+)-(\d+)\)$/;if(d.test(t)){let[p,f,m]=t.match(d).slice(1),h=Math.max(f,m)>=10;!uI(p)&&h&&(t=t.replace(d,`${p} [${f}-${m}]`))}return u=[],t=t.split(" ").map(p=>{let f=/^\((.*)\)$/,m=f.test(p),h=new RegExp(S0).test(p)&&"super"||new RegExp(Eb).test(p)&&"tiebreak"||new RegExp(rC).test(p)&&"standard"||"unknown";return u.push(h),h==="standard"&&m?p.match(f)[1]:p}).join(" "),{score:t}}function mUe({score:t,applied:e}){for(let T of[".",","," ","/"]){let P=new RegExp(`^(\\d+)\\${T}(\\d+)$`);if(P.test(t)){let D=t.match(P).slice(1).map(R=>parseInt(R)),E=Math.abs(D[0]-D[1]);E<=10&&E>=2&&(t=t.split(T).join("-"),e.push("variedJoinerPattern"))}}t.includes(";")&&(t=t.split(";").join(" "),e.push("semicolon set separation"));let i=/(^|\s)(\d)\/(\d)(\d)\/(\d)(\(|$)/;if(i.test(t)){let[T,P,D,E,R,C]=t.match(i).slice(1);t=t.replace(i,`${T}${P}-${D} ${E}-${R}${C}`),e.push("smashSlashPattern")}/.*\s6[/-]+$/.test(t)&&(t+="0",e.push("incompleteFinalSetPattern"));let r=/\(6,\)/g;r.test(t)&&(t=t.replace(r,"(6, 0)"),e.push("missingZeroPattern1"));let n=/^\d{3,}\(/,a=/\(\d+\)\d+/;[n,a].forEach(()=>{t=t.split(" ").map(T=>(n.test(T)&&(T=T.replace("("," (")),a.test(T)&&(T=T.replace(")",") ")),T)).join(" "),e.push("spaceConsiderationPatterns")});let s=nC(t);s!==t&&(t=s,e.push("deDashMash"));let o=/^(\d)[-/,]+(\d{2})[-/,]+(\d)$/;if(o.test(t)){let[T,P,D]=t.match(o).slice(1),[E,R]=P.split("");t=`${T}-${E} ${R}-${D}`,e.push("smashSetPattern")}let l=/^(\d+)[ -](\d+)$/,u=/^([\d -]+)\/([\d -]+)$/;if(u.test(t)){let[T,P]=t.match(u).slice(1),D=T.trim(),E=P.trim();if(l.test(D)&&l.test(E)){let R=D.match(l).slice(1,3).join("-"),C=E.match(l).slice(1,3).join("-");t=`${R} ${C}`,e.push("slashSeparationPattern")}}let c=/^([\d -]+),([\d -]+)$/;if(c.test(t)){let[T,P]=t.match(c).slice(1),D=T.trim(),E=P.trim();if(l.test(D)&&l.test(E)){let R=D.match(l).slice(1,3).join("-"),C=E.match(l).slice(1,3).join("-");t=`${R} ${C}`,e.push("commaSeparationPattern")}}let d=/^\d \d,/;if(d.test(t)){let T=t.match(d)[0],P=T.slice(0,T.length-1).split(" ").join("-");t=t.replace(T,P),e.push("singleSetCommaSeparationPattern")}let p=0,f=/(\d+)-(\d{2})-(\d+)/;for(;f.test(t)&&p<3;){let[T,P,D]=t.match(f).slice(1),E=P.split(""),R=`${T}-${E[0]} ${E[1]}-${D}`;t=t.replace(f,R),e.push("noSetSeparationPattern"),p+=1}let m=/(^|\s)7-6\s(\d+)\s/g,h=t.match(m);if(h?.length){let T=/(^|\s)7-6\s(\d+)\s/;h.forEach(P=>{let D=P.match(T).slice(2)[0];t=t.replace(P,`7-6(${D}) `),e.push("floatingTiebreakPattern1")})}let g=t.match(/\d \d /);g?.forEach(T=>{let P=T.slice(0,T.length-1).split(" ").join("-");t=t.replace(T,P),e.push("spaceSeparatedSetPattern1")}),g=t.match(/ \d \d$/),g?.forEach(T=>{let P=" "+T.slice(1).split(" ").join("-");t=t.replace(T,P),e.push("spaceSeparatedSetPattern2")});let I=/^\d, *\d\/\d, *\d/;if(I.test(t)){let T=t.match(I)[0],P=T.split("/").map(D=>`(${D})`).join(" ")+" ";t=t.replace(T,P),e.push("slashCommaSetPattern")}let v=/\(6-\)/g;v.test(t)&&(t=t.replace(v,"(6-0)"),e.push("missingZeroPattern2"));let w=new RegExp("(?<!-)(\\d+)\\/(\\d+)(?!-)","g");if(w.test(t)){let T=t.match(w),P=new RegExp("(?<!-)(\\d+)\\/(\\d+)(?!-)"),D=t;T.forEach(E=>{let[R,C]=E.match(P).slice(1),M=`${R}-${C}`;D=D.replace(E,M)}),t=D,e.push("slashSetPattern")}let y=/(.*)\s(1\d)\s(\d+)$/;if(y.test(t)){let[T,P,D]=t.match(y).slice(1);T.replace(/\D/g,"").length>=4&&(t=T+` ${P}${D}`,e.push("spaceSeparatedSuperPattern"))}let b=/(^|\s)(\d+-\d+)\s(\d+)(\s|$)/g;for(let T of t.match(b)||[]){let[P,D,E,R]=T.match(/(^|\s)(\d+-\d+)\s(\d+)(\s|$)/).slice(1),[C,M]=D.split("-").map(N=>parseInt(N));Math.abs(C-M)===1&&(t=t.replace(T,`${P}${D}(${E})${R}`),e.push("spaceSeparatedSetPattern"))}let S=/\d-\d \(\d{1,2}\)(\s|$|,)/g;for(let T of t.match(S)||[]){let P=/(\d-\d) \((\d{1,2})\)(\s|$|,)/,[D,E,R]=T.match(P).slice(1),[C,M]=D.split("-").map(N=>parseInt(N));Math.abs(C-M)===1&&(t=t.replace(T,`${D}(${E})${R}`),e.push("floatingTiebreakPattern2"))}let U=/(^|\s)(\d \d)\(/g;for(let T of t.match(U)||[]){let P=/(^|\s)(\d \d)\(/,[D,E]=T.match(P).slice(1);t=t.replace(T,`${D}${E.split(" ").join("-")}(`),e.push("spacedTiebreakPattern")}return{score:t,applied:e}}function hUe({score:t,matchUpStatus:e}){let i=t?.split(" ");t=i.map(o=>{if(o.endsWith("]")){let l=o.split("[");if(uI(l[0]))return l[0]+`(${l[1].slice(0,-1)})`}return o}).join(" ");let r=new RegExp(/(\([\d ]+\))/g);if(r.test(t))for(let o of t.match(r)){let l=o.replace(" ","-").match(/\((.*)\)/)?.[1];if(Ni(l)&&l?.[0]>2){if([2,4].includes(l.length))l=l.split("").join("-");else if(l.length===3){let u=l.indexOf("1");l=iP(l.split(""),u)}}t=t.replace(o,`(${l})`)}i=t?.split(" ");let n=new RegExp(/^(\d[-/]+\d)\((\d+)[-/]+(\d+)\)$/),a=i.length-1;t=i.map((o,l)=>{let u=[void 0,"","COMPLETED"].includes(e)||l!==a;if(n.test(o)&&u){let[c,d,p]=Array.from(o.match(n)).slice(1),f=Math.min(d,p);return`${c}(${f})`}return o}).join(" "),i=t?.split(" "),n=new RegExp(/^(\d{2})\((\d+)\)$/),t=i.map(o=>{if(n.test(o)){let[l,u]=Array.from(o.match(n)).slice(1),c=l.split("");return`${c[0]}-${c[1]}(${u})`}return o}).join(" "),i=t?.split(" "),n=new RegExp(/^\((\d[-/]+\d)\)(\d+)$/),t=i.map(o=>{if(n.test(o)){let[l,u]=Array.from(o.match(n)).slice(1);return uI(l)?`${l}(${u})`:l}return o}).join(" "),i=t?.split(" "),n=new RegExp(/^1-0\((\d+)\)$/),t=i.map(o=>{if(n.test(o)){let[l]=o.match(n).slice(1);return`[${l<9?10:Number.parseInt(l)+2}-${l}]`}return o}).join(" ");let s=/\((\d)+0 /;if(s.test(t)){let o=t.match(s)[1];t=t.replace(s,`(${o}) `)}return{score:t}}function gUe({score:t,attributes:e,identifier:i}){if(typeof t!="string")return{score:t,identifier:i};let r=new RegExp(/\([\d,/ ]+\)/g),n=t.match(r);for(let c of n||[]){let d=c.match(/^\((.*)\)$/)?.slice(1)?.[0],p=t.split(c)[0].split(")").reverse()[0].replace(/\D/g,"");if(d?.length===2&&p?.length>=2){let h=p.slice(p.length-2).split("").map(g=>parseInt(g));if(Math.abs(h[0]-h[1])===1)continue}let f=lW(d),m=nC(f);t=t.replace(c,`(${m})`).trim()}let a=new RegExp(/\[[\d,/ ]+\]/g);t.match(a)?.forEach(c=>{let d=lW(c.match(/^\[(.*)\]$/)[1]);t=t.replace(c,`(${d}) `).trim()});let s=[")","]"],o=[")(","), (",") (",")[",") [","](","] ("];if(t.startsWith("(")&&s.some(c=>t.endsWith(c))&&o.some(c=>t.includes(c))){let c="",d=t.split(/[)\]]/).filter(Boolean).map(g=>(g.startsWith(",")&&(g=g.slice(1)),g.trim())),p=d.every(g=>g.includes(",")||eD(g)),f=d.every(g=>g.includes("/")||eD(g)),m=d.every(g=>g.includes("-")||eD(g)),h=p&&","||m&&"-"||f&&"/";if(h){let g;d.forEach(I=>{if(I.startsWith("("))if(g==="set"&&(c+=" "),I.includes(h))c+=I.slice(1).split(h).map(v=>v.trim()).join("-"),g="set";else{let v=I.slice(1);c+=`(${v}) `,g="tiebreak"}else if(I.startsWith("[")){let v=I.slice(1).split(h).map(y=>parseInt(y.trim())),w=Math.min(...v);g==="set"?c+=`(${w}) `:c+=`[${v.join("-")}] `,g="tiebreak"}}),t=c.trim()}}let l=va(t.split(""));l["("]===1&&l[")"]===1&&t.startsWith("(")&&t.endsWith(")")&&(t=t.slice(1,t.length-1),l["-"]===1&&uI(t)&&Ni(e?.removed)&&(t=t+`(${e.removed})`,e.removed=void 0));let u=/\(\)/g;return u.test(t)&&(t=t.replace(u,"").trim()),{score:t}}function C9({score:t}){let e=t.split(""),i=[],r,n=()=>r=[void 0,void 0,void 0],a=()=>{let o=`${r[0]}-${r[1]}`;return r[2]&&(o+=` (${r[2]})`),n(),r.push(r),o};n();let s=()=>r[0]!==void 0&&r[1]!==void 0&&Math.abs(parseInt(r[0])-parseInt(r[1]));for(;e.length;){let o=e.shift(),l=Ni(o)&&parseInt(o),u=r[0]!==void 0&&r[1]!==void 0;if(Ni(l)){if(r[0]===void 0){r[0]=l;continue}if(r[1]===void 0&&(r[1]=l,s())){i.push(a()),r=[void 0,void 0];continue}if(u&&e.length===1&&Ni(e[0])){let c=e.pop();r[0]=r[0].toString()+r[1].toString(),r[1]=c,i.push(a()),r=[void 0,void 0]}u&&s()}}return{sets:i}}function RO(t){let e=t.indexOf("1"),i=t.split(""),r=i.every(n=>!isNaN(n));if(r&&t.length===3&&e===0){let n=iP(i,e);if(n)return n}if(r&&t.length===7&&e>3){let n=i.slice(4),a=iP(n,e-4);if(a)return`${i[0]}-${i[1]} ${i[2]}-${i[3]} ${a}`}}function M9(t){let{score:e}=t,{applied:i,matchUpStatus:r}=t,n=e?.toString().split(""),a=n?.every(o=>Ni(o)),s=o=>Math.abs(o[0]-o[1]);if(typeof e=="number"||a){e=e.toString().toLowerCase(),a&&(e=n.join(""));let o=a?n.map(u=>parseInt(u)):e.split("").map(u=>parseInt(u)),{sets:l}=C9({score:e});if(o.length,e.length===3&&s(o.slice(0,2))===1){let[u,c,d]=o;e=`${u}-${c}(${d})`,i.push("numericTiebreakPattern1")}else if(e.length===3&&o[0]===1){let[u,c,d]=o;e=`[${u}${c}-${d}]`,i.push("numericTiebreakPattern2")}else if(e.length===4&&s(o.slice(0,2))===1&&"987654".split("").includes(o[0].toString())){let[u,c,d,p]=o,f=Math.min(d,p);e=`${u}-${c}(${f})`,i.push("numericTiebreakPattern3")}else if(e.length===4&&o[0]===1&&o[2]===1){let[u,c,d,p]=o;e=`[${u}${c}-${d}${p}]`,i.push("bigSuper")}else if(e.length===4){let[u,c,d,p]=o;e=`${u}${c} ${d}${p}`,i.push("split4")}else if(e.length===5&&s(o.slice(0,2))===1){let[u,c,d,p,f]=o;e=`${u}-${c}(${d}) ${p}-${f}`,i.push("numericTiebreakPattern4")}else if(e.length===5&&s(o.slice(3))===1){let[u,c,d,p,f]=o;e=`${u}-${c} ${d}-${p}(${f})`,i.push("numericTiebreakPattern5")}else if(o.length===7)if(s(o.slice(0,2))>1&&s(o.slice(2,4))>1&&o[4]===1){let[u,c,d,p,f,m,h]=o;e=`${u}-${c} ${d}-${p} [${f}${m}-${h}]`,i.push("numericTiebreakPattern6")}else if(s(o.slice(0,2))===1&&s(o.slice(3,5))>1&&s(o.slice(5,7))>1){let[u,c,d,p,f,m,h]=o;e=`${u}-${c}(${d}) ${p}-${f} ${m}-${h}`,i.push("numericTiebreakPattern7")}else if(s(o.slice(0,2))>1&&s(o.slice(2,4))===1&&s(o.slice(5,7))>1){let[u,c,d,p,f,m,h]=o;e=`${u}-${c} ${d}-${p}(${f}) ${m}-${h}`,i.push("numericTiebreakPattern8")}else if(s(o.slice(0,2))>1&&s(o.slice(2,4))>1&&s(o.slice(4,6))===1){let[u,c,d,p,f,m,h]=o;e=`${u}-${c} ${d}-${p} ${f}-${m}(${h})`,i.push("numericTiebreakPattern9")}else e=e.slice(0,2)+" "+e.slice(2,4)+" "+e.slice(4),i.push("numericMatchTiebreakPattern");else if(e.length%2){let u=RO(e);u&&e!==u&&i.push("parsedSuperPattern"),e=u??e}else{let u=yr(e.split(""),2).map(I=>I.join("")),c=u.map(I=>{let[v,w]=I.split("").map(S=>parseInt(S)),y=Math.abs(v-w),b=v>w?1:2;return y>1&&b||b*-1}),d=c.reduce((I,v)=>I>0&&v>0,1),p=va(c),f=c.map(I=>Math.abs(I)),m=va(f),h=c[0]<0,g=!h&&c[1]<0;if(c[0]>0&&c[1]>0&&c[0]!==c[1])e=[u.slice(0,2).join(" "),u.slice(2).join("-")].join(" "),i.push("numeric3rdSetTiebreakPattern");else if(d)e=u.join(" "),i.push("chunkSplit");else if(o.length===6){if(p[1]===2||p[2]===2)if(!Object.values(m).includes(3))e=u.join(" "),i.push("chunkSplit");else{let[I,v,w,y,b,S]=o,U=c.reduce((T,P,D)=>P<0?D:T,void 0);if(U===0){let T=Math.min(w,y);e=`${I}-${v}(${T}) ${b}-${S}`,i.push("chunkSplitTiebreak1")}else if(U===1){let T=Math.min(b,S);e=`${I}-${v} ${w}-${y}(${T})`,i.push("chunkSplitTiebreak2")}else e=`${I}-${v} ${w}-${y}`,i.push("chunkSplitTrimExtraneous")}}else if(o.length===8){let[I,v,w,y,b,S,U,T]=o;h||g?o[5]===1&&(h?e=`${I}-${v}(${w}) ${y}-${b} [${S}${U}-${T}]`:e=`${I}-${v} ${w}-${y}(${b}) [${S}${U}-${T}]`):(c[0],c[1])}}}return{score:e,applied:i,matchUpStatus:r}}function N9(t){let e=[0,0],i=[],r=t.split(" "),n=/(\d+)-(\d+)/;r.forEach(l=>{if(n.test(l)){let u=l.match(n).slice(1).map(d=>Number.parseInt(d)),c=u[0]>u[1]&&1||u[1]>u[0]&&2;c&&(e[c-1]+=1,i.push(c))}});let a=e[0]>e[1]&&1||e[1]>e[0]&&2,s=e[0]>0&&e[0]===e[1],o=e.reduce((l,u)=>l+u,0);return{setsWon:e,setsTied:s,setWinners:i,totalSets:o,winningSide:a}}function IUe({score:t,matchUpStatus:e,attributes:i}){let r=[],n,a=t.split(" "),s=a.length;t=a.map((c,d)=>{if(new RegExp(Eb).test(c)){let f=c.slice(3),m=c.slice(0,3),h=m.split("-");if(!uI(m)&&!e){let g=Math.max(...h),I=m.indexOf(g),v=[g,g-1];return I&&v.reverse(),v.join("-")+f}}else if(c.length===2&&Ni(c))return c.split("").join("-");c=nC(c);let p=new RegExp(`^${S0}$`).test(c)&&"super"||new RegExp(`^${Eb}$`).test(c)&&"tiebreak"||new RegExp(`^${rC}$`).test(c)&&"standard"||"unknown";if(r.push(p),s>1&&p==="standard"&&d<2){let[f,m]=c.split("-"),h=Math.abs(parseInt(f)-parseInt(m)),g=Math.max(f,m),I=Math.min(f,m),v=[parseInt(f),parseInt(m)].indexOf(I);if(g>9&&h>2){let w=g.toString().split(""),y=w.find(b=>parseInt(b)>I||d&&parseInt(b)<=n)??w[0];y&&(c=v?[y,I].join("-"):[I,y].join("-"))}g>(n||0)&&(n=g)}if(p==="standard"){let[f,m]=c.split("-");if(!Math.abs(parseInt(f)-parseInt(m))&&e!=="RETIRED")return""}return c}).filter(Boolean).join(" ");let{setsWon:o,setWinners:l,totalSets:u}=N9(t);if(u===1&&i?.removed==="6"&&(t+=" 6-0"),t.split(" ").length>2&&Math.max(...o)>=2&&l[0]===l[1]&&(t=t.split(" ").slice(0,2).join(" ")),Math.max(...o)>2){let c=[0,0];t=t.split(" ").map((d,p)=>(c[l[p]]+=1,Math.max(...c)>2?void 0:d)).filter(Boolean).join(" ")}return{score:t,profile:r}}function vUe({score:t}){let{setsTied:e,winningSide:i}=N9(t),r=/\s\((\d+)\)$/;if(!i&&e&&r.test(t)){let o=t.match(r).slice(1)[0],l=o<=8?10:o+2;t=t.replace(r,` [${l}-${o}]`)}let n=t.split(" "),a=n[n.length-1];if(!a.includes("-")||a.indexOf("(")>0)return{score:t};let s=a.split("(").join("").split(")").join("").split("-");if(!s.every(o=>Ni(o)))return{score:t};if(s[0]==="76"){let o=s[1].length===2?Math.min(...s[1].split("").map(l=>parseInt(l))):s[1];t=[...n.slice(0,n.length-1),`7-6(${o})`].join(" ")}else{s=s.map(u=>parseInt(u));let o=Math.max(...s),l=Math.abs(s[0]-s[1]);if(o>=10){if(l>2&&s.every(u=>+u>=10)){let u=s.map(c=>c===o?c-10:10).sort();l=Math.abs(u[0]-u[1]),l>2&&(s=u)}t=[...n.slice(0,n.length-1),`[${s.join("-")}]`].join(" ")}else n.length===3&&o>=7&&l>2&&(t=[...n.slice(0,n.length-1),`[${s.join("-")}]`].join(" "))}return{score:t}}function yUe({score:t}){return t=t?.toString().toLowerCase()||"",{score:t}}function bUe({score:t,applied:e}){return typeof t!="string"?{score:t}:(t.toLowerCase().includes("o")&&(t=t.toLowerCase().split(" ").map(i=>i.split("o").join("0")).join(" "),e.push("replaceOh")),{score:t,applied:e})}function wUe({score:t,applied:e}){return typeof t!="string"?{score:t}:(t=t.toLowerCase().split(" ").map(i=>{if(/^\d+$/.test(i)&&i.length>2){let r=i.indexOf("1");if(i.length%2){if(i.length===3&&r===0){let n=iP(i.split(""),r);return e.push("getSuper"),n}}else{let{score:n,applied:a}=M9({score:i,applied:[]});n!==i&&(i=n,e.push(...a))}}return i}).join(" "),{score:t,applied:e})}function SUe({score:t,applied:e}){return typeof t!="string"?{score:t}:[3,4].includes(t.length)&&RO(t)?{score:RO(t)}:(t=t.toLowerCase().split(" ").map(i=>{if(/^\d+$/.test(i)&&i.length===1){e.push("removeErroneous1");return}return i}).filter(Boolean).join(" "),{score:t,applied:e})}function UUe({score:t,applied:e}){return["walkover","wo","w/o","w-o"].includes(t?.toString().toLowerCase())?(e.push("handleWalkover"),{matchUpStatus:"walkover",score:"",applied:e}):{score:t}}function TUe({score:t,profile:e,applied:i}){t=t?.toString().toLowerCase();let r=/^(.*\d+.*)(ret|con)+[A-Za-z ]*$/;if(r.test(t)){let[s]=t.match(r).slice(1);return i.push("handleRetired"),{score:s.trim(),matchUpStatus:"retired",applied:i}}let n=e?.matchUpStatuses?.retired,a=["rtd",...Array.isArray(n)?n:[n].filter(Boolean)].find(s=>t?.endsWith(s));return a?(i.push("handleRetired"),{matchUpStatus:"retired",score:t?.replace(a,"").trim(),applied:i}):{score:t}}function DUe({score:t,profile:e,applied:i}){t=t?.toString().toLowerCase();let r=/^(.*\d+.*)(def|defaulted)+[A-Za-z ]*$/;if(r.test(t)){let[s]=t.match(r).slice(1);return i.push("handleDefaulted"),{score:s.trim(),matchUpStatus:"defaulted",applied:i}}let n=e?.matchUpStatuses?.defaulted,a=["dft",...Array.isArray(n)?n:[n].filter(Boolean)].find(s=>t?.endsWith(s));return a?(i.push("handleDefaulted"),{matchUpStatus:"defaulted",score:t?.replace(a,"").trim(),applied:i}):{score:t}}function PUe({score:t,attributes:e}){(t.endsWith(" am")||t.endsWith(" pm"))&&(t=""),t=t.replace(/[A-Za-z]+/g,"").trim(),[".",","].some(n=>t.endsWith(n))&&(t=t.slice(0,t.length-1));let i="()/-".split("").some(n=>t.includes(n));/ \d$/.test(t)&&i&&(e={removed:t.slice(t.length-2).trim()},t=t.slice(0,t.length-2));let r=/(.*)[A-Za-z]+$/;return r.test(t)&&(t=t.match(r).slice(1)[0].trim()),{score:t,attributes:e}}function EUe({score:t}){return new RegExp(/-\d+\/\d+-/).test(t)&&(t=t.split("/").join(" ")),{score:t}}function RUe({score:t}){let e=new RegExp(/^\d+\/\d+/),i=t.split(" ");i.some(n=>e.test(n))&&(t=i.map(n=>e.test(n)?n.replace("/","-"):n).join(" "));let r=/^(\d+), *(\d+)$/;if(r.test(t)){let[n,a]=t.match(r).slice(1);t=[n,a].join("-")}return{score:t}}function CUe({score:t}){let e=new RegExp(/\(\d+\/\d+\)/g),i=t.match(e);for(let r of i||[]){let n=r.replace("/","-");t=t.replace(r,n)}return{score:t}}function MUe({score:t}){if(t.includes(",")){let e=t.split(",").map(r=>r.trim()),i=r=>/\d \d/.test(r);e.every(i)&&(t=e.map(r=>{let n=/\d+ \d+/g;for(let a of r.match(n)){let[s,o]=a.match(/(\d+) (\d+)/).slice(1);r=r.replace(a,`${s}-${o}`)}return r}).join(" "))}if(t.includes(" ")){let e=t.replace(/[ ,]/g,"");e.split("").every(i=>Ni(i))&&e.length===4&&(t=e)}return{score:t}}function NUe({score:t}){let e=new RegExp(/^\[\d+\](.*)$/);e.test(t)&&(t=t.match(e).slice(1)[0].trim());let i=/\(,/g;return i.test(t)&&(t=t.replace(i,"(")),{score:t}}var AUe={handleTiebreakSlashSeparation:CUe,handleSetSlashSeparation:EUe,punctuationAdjustments:dUe,handleGameSeparation:RUe,joinFloatingTiebreak:fUe,handleBracketSpacing:pUe,handleSpaceSeparator:MUe,separateScoreBlocks:wUe,matchKnownPatterns:mUe,removeDanglingBits:PUe,removeErroneous:SUe,handleDefaulted:DUe,handleWalkover:UUe,properTiebreak:hUe,handleNumeric:M9,handleRetired:TUe,containedSets:gUe,sensibleSets:IUe,stringScore:yUe,superSquare:vUe,setBuilder:C9,excisions:NUe,replaceOh:bUe},MA={},kUe=["handleNumeric","handleWalkover","handleRetired","handleDefaulted","replaceOh","stringScore","punctuationAdjustments","excisions","handleSpaceSeparator","matchKnownPatterns","removeDanglingBits","handleBracketSpacing","matchKnownPatterns","containedSets","separateScoreBlocks","handleGameSeparation","removeErroneous","joinFloatingTiebreak","handleSetSlashSeparation","handleTiebreakSlashSeparation","properTiebreak","sensibleSets","superSquare"],OUe=["handleNumeric","separateScoreBlocks","sensibleSets","superSquare"];function A9(t){if(!t.score)return{error:ie};let{score:e,sheetName:i,identifier:r,fileName:n,stepLog:a,fullLog:s,profile:o}=t,l=[],u,c=[],d,p,f=e,m=g=>{g.forEach(I=>{p=AUe[I]({profile:o,identifier:r,matchUpStatus:u,attributes:d,applied:c,score:f});let v=p.score!==f;v&&l.push({method:I,score:p.score}),a&&(s||v||p.matchUpStatus!==u)&&console.log(u?{score:p.score,matchUpStatus:u}:{score:p.score},I),p.matchUpStatus&&(u=p.matchUpStatus),p.attributes&&(d=p.attributes),p.applied&&(c=p.applied),f=p.score})};m(kUe);let h=oW(f);return h||(f=e.toString().replaceAll(/\D/g,""),d?.removed&&(d.removed=void 0),m(OUe),h=oW(f),h||(f="")),c.forEach(g=>{MA[g]||(MA[g]=0),MA[g]+=1}),{matchUpStatus:u?.toUpperCase(),modifications:l,attributes:d,isValid:h,score:f}}var k9={};ct(k9,{analyzeScore:()=>T0,analyzeSet:()=>Rb,calculateMatchStatistics:()=>g0,checkScoreHasValue:()=>cr,checkSetIsComplete:()=>tC,deduceMatchUpFormat:()=>oC,enrichPointHistory:()=>r9,getEpisodes:()=>h0,getQuickStats:()=>n9,getScore:()=>yd,getScoreboard:()=>p0,getSetComplement:()=>P0,getTiebreakComplement:()=>sC,getWinner:()=>f0,isComplete:()=>m0,isValidMatchUpFormat:()=>xa,parseScoreString:()=>ES,toStatObjects:()=>I0,validateMatchUpScore:()=>O9,validateScore:()=>D0,validateSetScore:()=>U0,validateTieFormat:()=>Bn});function xUe(t,e,i,r,n,a=!1){return n?{isValid:!0}:t===0&&e===0?{isValid:!1,error:"Tiebreak-only set requires both scores"}:t<r?{isValid:!1,error:`Tiebreak-only set winner must reach at least ${r}, got ${t}`}:i<(a?1:2)?{isValid:!1,error:a?`Tiebreak-only set (NoAD) must be won by at least 1 point, got ${t}-${e}`:`Tiebreak-only set must be won by at least 2 points, got ${t}-${e}`}:a?{isValid:!0}:t===r&&e>r-2?{isValid:!1,error:`Tiebreak-only set at ${r}-${e} requires playing past ${r}`}:t>r&&i!==2?{isValid:!1,error:`Tiebreak-only set past ${r} must be won by exactly 2 points, got ${t}-${e}`}:{isValid:!0}}function FUe(t,e,i,r){let n=r===i?i+1:i,a=r;return t!==n?{isValid:!1,error:`Tiebreak set winner must have ${n} games, got ${t}`}:e!==a?{isValid:!1,error:`Tiebreak set loser must have ${a} games, got ${e}`}:{isValid:!0}}function LUe(t,e,i){let r=Math.max(t||0,e||0),n=Math.min(t||0,e||0),a=r-n,s=i.tiebreakTo||7;return r<s?{isValid:!1,error:`Tiebreak winner must reach ${s} points, got ${r}`}:a<2?{isValid:!1,error:`Tiebreak must be won by 2 points, got ${r}-${n}`}:n>=s-1&&a>2?{isValid:!1,error:`Tiebreak score ${r}-${n} is invalid`}:{isValid:!0}}function _Ue(t,e,i,r){return r?t===i+1&&e<i-1?{isValid:!1,error:`With tiebreak format, if side 1 has ${i+1} games, side 2 must be at least ${i-1}, got ${e}`}:e===i+1&&t<i-1?{isValid:!1,error:`With tiebreak format, if side 2 has ${i+1} games, side 1 must be at least ${i-1}, got ${t}`}:{isValid:!0}:{isValid:!0}}function $Ue(t,e,i,r,n){if(t<r)return{isValid:!1,error:`Set winner must reach ${r} games, got ${t}`};let a=n&&t===r&&e===n&&i===1;if(i<2&&!a)return{isValid:!1,error:`Set must be won by at least 2 games, got ${t}-${e}`};if(n){if(e>=n&&!a)return{isValid:!1,error:`When tied at ${n}-${n}, must play tiebreak. Use format like ${n+1}-${n}(5)`};let s=n===r?r+1:r;if(t>s)return{isValid:!1,error:`With tiebreak format, set score cannot exceed ${s}-${n}. Got ${t}-${e}`}}else if(t>r+10)return{isValid:!1,error:`Set score ${t}-${e} exceeds reasonable limits`};return{isValid:!0}}function BUe(t,e,i){let r=t.side1TiebreakScore,n=t.side2TiebreakScore,a=e&&i?r:t.side1Score||t.side1||0,s=e&&i?n:t.side2Score||t.side2||0;return{side1Score:a,side2Score:s,side1TiebreakScore:r,side2TiebreakScore:n}}function VUe(t,e,i,r,n,a,s){if(i&&r){let o=FUe(t,e,i,r);if(!o.isValid)return o}return(n!==void 0||a!==void 0)&&s?LUe(n,a,s):{isValid:!0}}function jUe(t,e,i){return i&&(t>i+10||e>i+10)?{isValid:!1,error:`Set score ${t}-${e} exceeds expected range for ${i}-game sets`}:{isValid:!0}}function GUe(t,e,i){let{side1:r,side2:n,winner:a,loser:s,diff:o}=t,{setTo:l,tiebreakAt:u}=e;if(l&&u){let c=_Ue(r,n,l,u);if(!c.isValid)return c}return i?jUe(a,s,l):l?$Ue(a,s,o,l,u):{isValid:!0}}function U0(t,e,i,r){if(!e)return{isValid:!0};let n=zi(e);if(!n)return{isValid:!0};let a=i&&n.finalSetFormat?n.finalSetFormat:n.setFormat;if(!a)return{isValid:!0};if(a.timed){if(!r){let S=t.side1Score??0,U=t.side2Score??0;if(S===0&&U===0)return{isValid:!1,error:"Timed set requires at least one side to have scored"};if(a.based==="P"&&S===U&&S>0&&a.tiebreakFormat&&!(t.side1TiebreakScore!==void 0||t.side2TiebreakScore!==void 0))return{isValid:!1,error:"Tied timed set requires tiebreak"}}return{isValid:!0}}let{setTo:s,tiebreakAt:o,tiebreakFormat:l,tiebreakSet:u}=a,c=u?.tiebreakTo,d=!!c&&!s,p=t.side1TiebreakScore!==void 0&&t.side2TiebreakScore!==void 0,{side1Score:f,side2Score:m,side1TiebreakScore:h,side2TiebreakScore:g}=BUe(t,d,p),I=Math.max(f,m),v=Math.min(f,m),w=I-v;if(d){let S=t.NoAD??a.tiebreakSet?.NoAD??!1;return xUe(I,v,w,c,r??!1,S)}let y=h!==void 0||g!==void 0,b=s&&I===s+1&&v===s;return y||b?VUe(I,v,s,o,h,g,l):GUe({side1:f,side2:m,winner:I,loser:v,diff:w},{setTo:s,tiebreakAt:o},r)}function O9(t,e,i){if(!t||t.length===0)return{isValid:!0};let r=e?.match(/SET(\d+)/)?.[1],n=r?Number.parseInt(r):3,a=[$r,mi,Qt].includes(i||"");for(let s=0;s<t.length;s++){let o=t[s],l=s+1===n,u=o.winningSide!==void 0,c=U0(o,e,l,a||i===void 0&&!u);if(!c.isValid)return{isValid:!1,error:`Set ${s+1}: ${c.error}`}}return{isValid:!0}}function aC(t){return!!t?.aggregate}function HUe(t,e,i,r,n,a){let{tiebreakTo:s,NoAD:o}=t||{},l=Math.max(e??0,i??0);return!(o&&l>s||l<s&&r&&(n&&!a||!n))}function WUe(t,e,i,r,n,a){let s=e+1===r,{side1Score:o,side2Score:l,side1TiebreakScore:u,side2TiebreakScore:c,winningSide:d}=t,p=Math.max(o??0,l??0),f=u??c,{finalSetFormat:m,setFormat:h}=i,g=s&&m||h;return f&&!HUe(g?.tiebreakFormat,u,c,d,n,a)?!1:g.setTo?!(!g.noTiebreak&&p>g.setTo+1):!0}function zUe(t){let e=t.reduce((i,r)=>((r.side1Score!==void 0||r.side2Score!==void 0)&&(i[0]+=r.side1Score??0,i[1]+=r.side2Score??0),i),[0,0]);return e[0]>e[1]?1:e[1]>e[0]?2:t.find(i=>i.side1TiebreakScore!==void 0||i.side2TiebreakScore!==void 0)?.winningSide}function qUe(t,e,i,r,n){return(!n||t===e)&&i===1&&r.indexOf(t)+1||void 0}function T0({existingMatchUpStatus:t,matchUpFormat:e,matchUpStatus:i,winningSide:r,score:n}){let a=n?.sets??[],s=(a?.filter(T=>T?.winningSide)||[]).reduce((T,P)=>{let{winningSide:D}=P;if(!D)return T;let E=D-1;return T[E]++,T},[0,0]),o=r?r-1:void 0,l=o!==void 0&&[0,1].includes(o)?1-o:void 0,u=o!==void 0&&s[o],c=l!==void 0&&s[l],d=e?zi(e):void 0,p=Math.max(...s),f=va(s)[p],m=d?.setFormat?.timed||d?.finalSetFormat?.timed,h=d?.bestOf||d?.exactly,g=h&&Math.ceil(h/2)||1,I=i??t,v=!!(I&&[Qt,$r,mi].includes(I)),w=!d||!a.length||a.every((T,P)=>WUe(T,P,d,h??0,P===a.length-1,v)),y=d?.exactly,b=!y||!I||I!==ki||v||a.length>=y,S=aC(d),U=S&&a.length>0?zUe(a):qUe(p,g,f,s,e);return{valid:!!(w&&b&&(r&&S&&r===U||r&&!S&&u>c&&r===U||r&&v||!r&&!U&&(![ki,Qt,$r,mi].includes(I)||m&&I===ki)))}}function D0({existingMatchUpStatus:t,matchUpFormat:e,matchUpStatus:i,winningSide:r,score:n}){if(typeof n!="object")return{error:ie};let{sets:a,scoreStringSide1:s,scoreStringSide2:o}=n,l="scoreString must be a string!";if(s!==void 0&&typeof s!="string")return{error:ie,info:l};if(o!==void 0&&typeof o!="string")return{error:ie,info:l};if(a!==void 0&&!Array.isArray(a))return{error:ie,info:Np("sets")};if(a?.length){let u=a.map(d=>d?.setNumber).filter(Boolean);if(u.length!==rt(u).length)return{error:ie,info:"setNumbers not unique"};for(let d of a){let{side1Score:p,side2Score:f,side1TiebreakScore:m,side2TiebreakScore:h,side1PointScore:g,side2PointScore:I,winningSide:v,setNumber:w}=d;if(![[p,f],[m,h],[g,I]].filter(y=>y.some(b=>![void 0,null].includes(b))).every(y=>y.every(b=>ot(b))))return{error:ie,info:"non-numeric values"};if(![w,v].filter(y=>![void 0,null].includes(y)).every(y=>ot(y)))return{error:ie,info:"non-numeric values"};if(v&&![1,2].includes(v))return{error:ie,info:"winningSide must be 1 or 2"}}let{valid:c}=T0({existingMatchUpStatus:t,matchUpStatus:i,matchUpFormat:e,winningSide:r,score:n});if(!c)return{error:A6,info:"score is invalid for matchUpFormat or winningSide does not match calculated winningSide"}}return{valid:!0}}var P0=t=>{let{isSide1:e,lowValue:i,setTo:r,tiebreakAt:n,NoAD:a}=t;if(i===void 0)return!1;let s=Ye(i);s?.toString().length>2&&(s=Number.parseInt(s.toString().slice(0,2))),n&&n<r&&s>n&&(s=n);let o;return a&&!n?s>r?o=r:o=s<r?r:r-1:o=s+1<r&&r||n&&n<r&&s===n&&r||!n&&s+2||r+1,[e?s:o,e?o:s]},sC=t=>{let{isSide1:e,lowValue:i,tiebreakTo:r,tiebreakNoAd:n}=t;if(i===void 0)return!1;let a=typeof i=="string"?Number.parseInt(i):i;a?.toString().length>2&&(a=Number.parseInt(a.toString().slice(0,2))),n&&a>r-1&&(a=r-1);let s=YUe({lowValue:a,NoAD:n,tiebreakTo:r});return[e?a:s,e?s:a]};function YUe(t){let{lowValue:e,NoAD:i,tiebreakTo:r}=t,n=i?1:2;return e+1>=r?e+n:r}function CO(t,e){return t>e&&1||t<e&&2||void 0}function KUe(t,e){return e?{side1Score:t[0],side2Score:t[1],winningSide:CO(t[0],t[1])}:{side1TiebreakScore:t[0],side2TiebreakScore:t[1],winningSide:CO(t[0],t[1])}}function ES({tiebreakTo:t=7,scoreString:e="",matchUpFormat:i}){let r,n=3;if(i)try{r=zi(i);let c=/SET(\d+)/.exec(i)?.[1];n=c?Number.parseInt(c):3}catch{}return e?.split(" ").filter(Boolean).map((c,d)=>u({set:c,setNumber:d+1}));function a(c,d){if(!r||!d)return!1;let p=c===n&&r.finalSetFormat?r.finalSetFormat:r.setFormat;if(!p)return!1;let f=p.tiebreakSet?.tiebreakTo,m=p.setTo;return!!f&&!m}function s(c){if(!r)return t;let d=c===n&&r.finalSetFormat?r.finalSetFormat:r.setFormat;return d?.tiebreakSet?.tiebreakTo??d?.tiebreakFormat?.tiebreakTo??t}function o(c,d,p){let f=c[1],m=s(p),h=sC({lowValue:f,isSide1:d===2,tiebreakTo:m});return Array.isArray(h)?[h[0],h[1]]:[void 0,void 0]}function l(c,d,p,f){let m=(d&&c.replace(d[0],"")||p&&c.replace(p[0],"")||c).split("-").map(y=>Number.parseInt(y)),h=m[0],g=m[1],I=CO(h,g),v,w;if(d&&([v,w]=o(d,I,f)),p){let y=p[1].split("-").map(b=>Number.parseInt(b));v=y[0],w=y[1]}return{side1Score:h,side2Score:g,side1TiebreakScore:v,side2TiebreakScore:w,winningSide:I}}function u({set:c,setNumber:d}){let p=/\(([^)]+)\)/,f=/\[([^\]]+)\]/,m=p.exec(c),h=f.exec(c),g=c?.startsWith("[")&&h,I=a(d,!!g),v=s(d),w=I&&v===1,y;if(g){let b=h[1].split("-").map(S=>Number.parseInt(S));y=KUe(b,I)}else y=l(c,m,h,d);return{side1Score:y.side1Score,side2Score:y.side2Score,side1TiebreakScore:y.side1TiebreakScore,side2TiebreakScore:y.side2TiebreakScore,winningSide:y.winningSide,setNumber:d,...w&&{NoAD:!0},...I&&{tiebreakSet:!0}}}}function XUe({matchUpScoringFormat:t,isDecidingSet:e,isTiebreakSet:i,isTimedSet:r,setObject:n}){if(!n)return;let a=iC({set:n});return tC({matchUpScoringFormat:t,set:n,isDecidingSet:e,isTiebreakSet:i,isTimedSet:r})&&a||void 0}function Rb(t){let{setObject:e,matchUpScoringFormat:i}=t;if(!e)return{error:FE};let{setNumber:r}=e||{},{bestOf:n,exactly:a}=i||{},s=n||a,o=!!(r&&s&&r===s),l=o&&i?.finalSetFormat||i?.setFormat,u=!!l?.tiebreakSet,c=!!l?.timed,d=!u&&!c,p=!!(r&&s&&r<=s),f=[e?.side1Score,e?.side2Score],m=[e?.side1PointScore,e?.side2PointScore],h=[e?.side1TiebreakScore,e?.side2TiebreakScore],g=f.filter(k=>k!==void 0).length,I=m.filter(k=>k!==void 0).length,v=h.filter(k=>k!==void 0).length,w=f?.filter(k=>!isNaN(k)).length,y=h?.filter(k=>!isNaN(k)).length,{tiebreakAt:b}=l||{},S=b&&f.filter(k=>k>=b).length===2,U=S&&(f[0]>f[1]&&1||f[1]>f[0]&&2||void 0),T=!!(y&&!w),P=!!e?.winningSide,{error:D,result:E}=JUe({sideTiebreakScores:h,sideGameScores:f,setFormat:l,setObject:e}),{error:R,result:C}=QUe({sideTiebreakScores:h,setObject:e,setFormat:l}),M=d&&!T&&E||u&&T&&C||c,N=p&&!(u&&!T)&&!(d&&T)&&(!P||M),A=XUe({isTimedSet:c,matchUpScoringFormat:i,isDecidingSet:o,isTiebreakSet:T,setObject:e}),O={expectTiebreakSet:u,expectTimedSet:c,hasTiebreakCondition:S,isCompletedSet:P,isDecidingSet:o,isTiebreakSet:T,isValidSet:N,isValidSetNumber:p,isValidSetOutcome:M,leadingSide:U,setFormat:l,sideGameScores:f,sideGameScoresCount:g,sidePointScores:m,sidePointScoresCount:I,sideTiebreakScores:h,sideTiebreakScoresCount:v,winningSide:A};return e?.winningSide!==void 0&&(T?(O.isValidTiebreakSetOutcome=C,C||(O.tiebreakSetError=R)):(O.isValidStandardSetOutcome=E,E||(O.standardSetError=D))),O}function JUe({setObject:t,setFormat:e,sideGameScores:i,sideTiebreakScores:r}){if(!t)return{result:!1,error:FE};let n=!!e?.tiebreakSet,a=!!e?.timed;if(!e||n||a)return{result:!1,error:ie};if(i?.filter(U=>!isNaN(U)).length!==2)return{result:!1,error:qk};let{setTo:s,tiebreakAt:o,tiebreakFormat:l,NoAD:u}=e||{};if(!(s&&i?.find(U=>U>=s)))return{result:!1,error:qk};let c=[1,2].includes(t?.winningSide);if(!t||!c)return{result:!1,error:_E};let d=t?.winningSide-1,p=1-d,f=i[d],m=i[p],h=f-m;if(!(f>m))return{result:!1,error:{message:"winningSide game scoreString is not high"}};let g=o&&l,I=r?.filter(U=>!isNaN(U)).length===2,v=r?.[d],w=r?.[p],y=o&&i.filter(U=>U>=o).length===2;if(g){let{NoAD:U,tiebreakTo:T}=l;if(y){if(h>1)return{result:!1,error:{message:"invalid winning game scoreString (5)"}};if(!I)return{result:!1,error:{message:"invalid tiebreak scores (1)"}};if(isNaN(T))return{result:!1,error:{message:"tiebreakTo error"}};if(!(T&&r?.find(C=>C>=T)))return{result:!1,error:{message:"invalid tiebreak scores (2)"}};let P=o<s?s:s+1;if(f>P)return{result:!1,error:{message:"invalid winning game scoreString (1)"}};if(!v||!w||v<w)return{result:!1,error:{message:"winningSide tiebreak value is not high"}};let D=U?1:2,E=v-w,R=w>=T-1;if(E&&R&&E<D)return{result:!1,error:{message:"invalid tiebreak scores (3)"}}}if(f>s&&!y)return{result:!1,error:{message:"invalid winning game scoreString (2)"}}}let b=u?1:2,S=m>=s-1;return h&&S&&!y&&h<b?{result:!1,error:{message:"invalid winning game scoreString (3)"}}:h>b&&f>s?{result:!1,error:{message:"invalid winning game scoreString (4)"}}:{result:!0}}function QUe({setObject:t,setFormat:e,sideTiebreakScores:i}){if(!t)return{result:!1,error:FE};let r=!!e?.tiebreakSet,n=!!e?.timed;if(!e||!r||n)return{result:!1,error:{message:"not tiebreak set"}};let a=[1,2].includes(t?.winningSide);if(!t||!a)return{result:!1,error:_E};let{tiebreakSet:s}=e||{},{NoAD:o,tiebreakTo:l}=s||{};if(i?.filter(g=>!isNaN(g)).length!==2)return{result:!1,error:{message:"invalid tiebreak scores (1)"}};if(isNaN(l))return{result:!1,error:{message:"tiebreakTo error"}};if(!i?.find(g=>g>=l))return{result:!1,error:{message:"invalid tiebreak scores (2)"}};let u=t?.winningSide-1,c=1-u,d=i[u],p=i[c];if(!d||!p||d<p)return{result:!1,error:{message:"winningSide tiebreak value is not high"}};let f=o?1:2,m=d-p,h=p>=l-1;return m&&h&&m<f?{result:!1,error:{message:"invalid tiebreak scores (3)"}}:{result:!0}}var NA="SET3-S:6/TB7";function oC(t){let e=t.split(/[\s,]+/).filter(o=>o.length>0);if(e.length===0)return NA;let i;e.length===1?i=1:e.length===2?i=3:i=5;for(let o of e){let l=o.replace(/\([^)]*\)/g,"").match(/(\d+)/g)?.map(u=>Number.parseInt(u,10))||[];if(l.length===2){let u=Math.max(...l),c=Math.min(...l),d=u-c;if(u===10||u>10&&d<=2)return`SET${i}-S:TB10`}}let r=null;for(let o of e)if(/\(/.test(o)){r=o;break}let n;if(r){let o=r.replace(/\([^)]*\)/g,"").match(/(\d+)/g)?.map(c=>parseInt(c,10))||[];if(o.length===0)return NA;let l=Math.max(...o),u=Math.min(...o);l===u+1?n=u:n=l-1}else{let o=[];for(let u of e){let c=u.replace(/\([^)]*\)/g,"").match(/(\d+)/g)?.map(d=>parseInt(d,10))||[];c.length>0&&o.push(Math.max(...c))}if(o.length===0)return NA;let l=Math.max(...o);l>=6?n=6:n=l}let a=!1;if(e.length>=3){let o=e.at(-1).replace(/\([^)]*\)/g,"").match(/(\d+)/g)?.map(l=>Number.parseInt(l,10))||[];if(o.length===2){let l=Math.max(...o),u=Math.min(...o);l>n+1&&l-u===2&&(a=!0)}}let s;return n===6?s=`SET${i}-S:6/TB7`:n===4?s=`SET${i}-S:4/TB7`:s=`SET${i}-S:${n}/TB7`,a&&(s+=`-F:${n}`),s}function x9(t){let{matchUp:e,expectedScore:i}=t;if(!e)return{isValid:!1,errors:["No matchUp provided"],warnings:[],actual:{sets:[],scoreString:""},expected:{sets:i?.sets,scoreString:i?.scoreString},pointsProcessed:0,pointsRejected:0};let r=[],n=[],a=id({matchUpFormat:e?.matchUpFormat,matchUpId:e?.matchUpId,participants:e?.sides?.map(c=>c.participant).filter(c=>c!==void 0)}),s=e?.history?.points||[];s.length===0&&n.push("No points found to validate");let o=0,l=0;for(let c of s)try{a=hp(a,{winner:c.winner,server:c.server}),o++}catch(d){l++;let p=d instanceof Error?d.message:String(d);r.push(`Point ${c.pointNumber||o+1}: ${p}`)}let u=yd(a);return i&&(i.sets&&(u.sets.length!==i.sets.length&&r.push(`Set count mismatch: expected ${i.sets.length}, got ${u.sets.length}`),i.sets.forEach((c,d)=>{let p=u.sets[d];if(!p){r.push(`Missing set ${d+1}`);return}c.side1Score!==void 0&&p.side1Score!==c.side1Score&&r.push(`Set ${d+1} side1Score: expected ${c.side1Score}, got ${p.side1Score}`),c.side2Score!==void 0&&p.side2Score!==c.side2Score&&r.push(`Set ${d+1} side2Score: expected ${c.side2Score}, got ${p.side2Score}`),c.side1TiebreakScore!==void 0&&p.side1TiebreakScore!==c.side1TiebreakScore&&r.push(`Set ${d+1} side1TiebreakScore: expected ${c.side1TiebreakScore}, got ${p.side1TiebreakScore}`),c.side2TiebreakScore!==void 0&&p.side2TiebreakScore!==c.side2TiebreakScore&&r.push(`Set ${d+1} side2TiebreakScore: expected ${c.side2TiebreakScore}, got ${p.side2TiebreakScore}`)})),i.scoreString&&u.scoreString!==i.scoreString&&r.push(`Score string mismatch: expected "${i.scoreString}", got "${u.scoreString}"`)),{isValid:r.length===0,errors:r,warnings:n,actual:{sets:u.sets,scoreString:u.scoreString},expected:{sets:i?.sets,scoreString:i?.scoreString},pointsProcessed:o,pointsRejected:l}}function ZUe(t){let e=t?.side1Score||0,i=t?.side2Score||0;if(t?.side1TiebreakScore!==void 0||t?.side2TiebreakScore!==void 0){let r=t?.side1TiebreakScore||0,n=t?.side2TiebreakScore||0;return e>i?`${e}-${i}(${n})`:`${e}(${r})-${i}`}return`${e}-${i}`}function eTe(t){let{points:e,matchUpFormat:i,expectedGames:r,expectedTiebreak:n}=t,a={matchUpId:"validation",matchUpFormat:i,matchUpStatus:"TO_BE_PLAYED",matchUpType:"SINGLES",sides:[{sideNumber:1},{sideNumber:2}],score:{sets:[]},history:{points:e?.map((s,o)=>({...s,pointNumber:o+1,timestamp:"",winner:s.winner,server:s.server}))}};return x9({matchUp:a,expectedScore:{sets:[{side1Score:r?.[0],side2Score:r?.[1],side1TiebreakScore:n?.[0],side2TiebreakScore:n?.[1]}]}})}function tTe(t){let{points:e,expectedScore:i,matchUpFormat:r,allowExtraPoints:n=!1,debug:a=!1}=t,s=[],o=[],l=[],u,c=!1;r?u=r:i?(u=oC(i),c=!0,a&&console.log(`Deduced format: ${u} from score: ${i}`)):(u="SET3-S:6/TB7",c=!0,o.push("No format provided, using default SET3-S:6/TB7"));let d=id({matchUpFormat:u}),p=e?.split("").map(v=>{let w=Number.parseInt(v,10);return Number.isNaN(w)||w!==0&&w!==1?null:w}).filter(v=>v!==null);if(p?.length===0)return s.push("No valid points found in point string"),{valid:!1,errors:s,warnings:o,pointsProcessed:0,pointsRejected:[],actualScore:"0-0",matchUpFormat:u,formatDeduced:c,sets:[]};let f=0;for(let v=0;v<p?.length;v++){let w=p[v];if(d.matchUpStatus==="COMPLETED"&&!n){l.push(w),a&&console.log(`Point ${v+1}: Rejected (match complete)`);continue}try{if(d=hp(d,{winner:w}),f++,a){let y=yd(d);console.log(`Point ${v+1}: ${w} â ${y.scoreString}`)}}catch(y){l.push(w);let b=y instanceof Error?y.message:String(y);s.push(`Point ${v+1}: ${b}`),a&&console.log(`Point ${v+1}: Error - ${b}`)}}let m=yd(d),h=m.scoreString,g=m.sets.map(v=>{let w=[v.side1Score||0,v.side2Score||0],y=v.side1TiebreakScore===void 0?void 0:[v.side1TiebreakScore,v.side2TiebreakScore||0],b=`${w[0]}-${w[1]}`;return y&&(b=w[0]>w[1]?`${w[0]}-${w[1]}(${y[1]})`:`${w[0]}(${y[0]})-${w[1]}`),{games:w,tiebreak:y,scoreString:b}}),I=!0;if(i){let v=uW(i),w=uW(h);v!==w&&(I=!1,s.push(`Score mismatch: expected "${i}", got "${h}"`))}return l.length>0&&o.push(`${l.length} excess points after match complete`),s.length>0&&(I=!1),{valid:I,errors:s,warnings:o,pointsProcessed:f,pointsRejected:l,expectedScore:i,actualScore:h,matchUpFormat:u,formatDeduced:c,sets:g}}function uW(t){return t.replace(/\s+/g,"").replace(/,/g,", ").toLowerCase()}var iTe={4:"Wide",5:"Body",6:"T"},F9={f:"Forehand",r:"Forehand Slice",v:"Forehand Volley",o:"Overhead Smash",u:"Forehand Drop Shot",l:"Forehand Lob",h:"Forehand Half-volley",j:"Forehand Drive Volley"},L9={b:"Backhand",s:"Backhand Slice",z:"Backhand Volley",p:"Backhand Overhead Smash",y:"Backhand Drop Shot",m:"Backhand Lob",i:"Backhand Half-volley",k:"Backhand Drive Volley"},rTe={t:"Trick Shot",q:"Unknown Shot"},nTe={...F9,...L9,...rTe},aTe={7:"shallow",8:"deep",9:"very deep"},sTe={1:1,2:2,3:3},oTe={"+":"approach","-":"net","=":"baseline"},Ff={n:"Net",w:"Out Wide",d:"Out Long",x:"Out Wide and Long",g:"Foot Fault",e:"Unknown","!":"Shank"};function lTe(t,e){return t.PtWinner===t.Svr?e:1-e}function _9(t){let e=[],i="",r="fbrsvzouymlhijkpqt";for(let n=0;n<t.length;n++){let a=t[n];a&&(r.includes(a)||"456".includes(a)?(i&&e.push(i),i=a):i+=a)}return i&&e.push(i),e}function uTe(t){if(t.includes("*"))return"*";if(t.includes("#"))return"#";if(t.includes("@"))return"@"}function Ol(t){if(t){for(let e of Object.keys(Ff))if(t.includes(e))return e}}function cTe(t){let e=[];for(let i of t){if(!i)continue;let r=i[0];if(r&&/[456]/.test(r))e.push(i);else break}return e}function $9(t){if(!ri(t))return{serves:[],rally:[]};let e,i,r,n=t.split("c").length-1;t=t.split("c").join("");let a=_9(t),s=a;for(let c=a.length-1;c>=0;c--){let d=a[c];if(d&&(i=uTe(d),i)){s=a.slice(0,c+1),r=a.slice(c+1),e=d;break}}let o=cTe(s),l=o.length?s.slice(o.length):s;if(!i&&!o.length&&l.length===1){let c=l[0];c&&["S","P","Q","R"].includes(c)&&(e=c,l.length=0)}let u={serves:o,rally:l};return n&&(u.lets=n),i&&(u.terminator=i),e&&(u.result=e),r?.length,u}function B9(t){let e=t.join("|"),i=MO(t[0],1);if(i.winner==="S"||!t[1])return i.serve=1,i.code=e,i;let r=MO(t[1],2);return r.serve=2,r.first_serve={serves:i.serves},i.lets&&(r.first_serve.lets=i.lets),i.error&&(r.first_serve.error=i.error),i.parse_notes&&(r.first_serve.parse_notes=i.parse_notes),r.code=e,r}function MO(t,e){let i=$9(t);if(["Q","S"].includes(i.result||""))return i.winner="S",i;if(["P","R"].includes(i.result||"")||!i.terminator&&!Ol(i.serves[0])&&i.serves.length>2)return i.winner="R",i;let r=(i.serves.length+i.rally.length)%2===0?"R":"S",n;if(i.rally.length>0?n=i.rally[i.rally.length-1]:i.serves.length>0&&(n=i.serves[i.serves.length-1]),!n)return{...i,winner:void 0};if(!i.rally.length){if(i.terminator==="*")i.result="Ace",i.winner="S";else if(i.terminator==="#")i.result="Serve Winner",i.winner="S";else{let a=Ol(i.serves[0]);a?(i.error=Ff[a],e===2&&(i.result="Double Fault",i.winner="R")):(i.parse_notes="treated as a fault",e===2&&(i.result="Double Fault",i.winner="R"))}return i}if(i.rally.length===1&&n.includes("#")){i.result="Serve Winner",i.winner="S";let a=Ol(n);return a&&(i.error=Ff[a]),i}return n.includes("#")?(i.result="Forced Error",i.error=Ff[Ol(n)],i.winner=r==="R"?"S":"R"):n.includes("*")?(i.result="Winner",i.winner=r):n.includes("@")?(i.result="Unforced Error",i.error=Ff[Ol(n)],i.winner=r==="R"?"S":"R"):Ol(i.serves[0])?i.rally.length===1&&Ol(n)&&(i.error=Ff[Ol(n)],i.winner=r==="R"?"S":"R"):i.serves.length&&i.rally.length?(i.parse_notes="no terminator: receiver wins point",i.result="Unknown",i.winner="R"):i.rally.length===1&&Ol(n)&&(i.error=Ff[Ol(n)],i.winner=r==="R"?"S":"R"),i}function NO(t){if(t)for(let e of t){let i=nTe[e];if(i)return i}}function dTe(t){if(t)for(let e of t){let i=iTe[e];if(i)return i}}function pTe(t,e,i){let r=[],n=1,a=i;if(t.length>0&&!Ol(t[t.length-1])){let s=t[t.length-1],o=NO(s)||"Forehand";r.push({shotNumber:n++,player:a,stroke:o,code:s}),a=1-a}for(let s of e){let o=NO(s);if(!o)continue;let l={shotNumber:n++,player:a,stroke:o,code:s};for(let u of s){let c=sTe[u];c!==void 0&&(l.direction=c)}for(let u of s){let c=aTe[u];c&&(l.depth=c)}for(let u of s){let c=oTe[u];c&&(l.position=c)}r.push(l),a=1-a}return r}function V9(t,e){let i=lTe(t,e),r=t["1st"]||"",n=t["2nd"]||"";if(!r&&!n)return{winner:i,server:e,result:"Unknown"};let a=B9([r,n]),s={winner:i,server:e};a.result&&(s.result=a.result),a.serve&&(s.serve=a.serve);let o=a.serve===1?r:n,l=dTe(o);l&&(s.serveLocation=l);let u=a.rally[a.rally.length-1];if(u){let d=NO(u);d&&(s.stroke=d,Object.values(F9).includes(d)?s.hand="Forehand":Object.values(L9).includes(d)&&(s.hand="Backhand"))}let c=pTe(a.serves,a.rally,e);return c.length>0&&(s.rally=c,s.rallyLength=c.length),a.code&&(s.code=a.code),s}function j9(t){if(!t||!ri(t))return[];let e=t.trim().split(`
`);if(e.length<2)return[];let i=e[0]?.split(",")||[],r=[];for(let n=1;n<e.length;n++){let a=e[n];if(!a)continue;let s=a.split(","),o={};for(let l=0;l<i.length;l++){let u=i[l];u&&(o[u]=s[l]||"")}r.push(o)}return r}function G9(t){if(!Array.isArray(t))return[];let e=new Map;for(let i of t){let r=i.match_id;e.has(r)||e.set(r,[]),e.get(r).push(i)}return Array.from(e.entries()).map(([i,r])=>({match_id:i,points:r}))}function fTe(t){let e=t?.split("-")||[];if(e.length<6)return{player1:"Player 1",player2:"Player 2"};let i=e[0],r=e[2]?.replace(/_/g," "),n=e[4]?.replace(/_/g," ")||"Player 1",a=e[5]?.replace(/_/g," ")||"Player 2";return{player1:n,player2:a,date:i,tournament:r}}function mTe(t){if(!t||t.length===0)return;let e=t.at(-1);if(!e)return;let i=e.Set1,r=e.Set2,n=e.Set3,a=e.Set4,s=e.Set5,o=[];return i&&o.push(`${i}-${r}`),n&&o.push(`${n}-${r||"0"}`),a&&o.push(`${a}-${r||"0"}`),s&&o.push(`${s}-${r||"0"}`),o.length>0?o.join(", "):void 0}function H9(t,e={}){let{matchUpFormat:i,validateScore:r=!0,debug:n=!1}=e,a=[],s=[],o=fTe(t.match_id),l=mTe(t.points),u,c=!1;i?u=i:l?(u=oC(l),c=!0,n&&console.log(`Deduced format: ${u} from score: ${l}`)):(u="SET3-S:6/TB7",c=!0,s.push("No format provided, using default SET3-S:6/TB7")),n&&(console.log(`Validating match: ${o.player1} vs ${o.player2}`),console.log(`Format: ${u}`),console.log(`Total points: ${t.points.length}`),l&&console.log(`Expected score: ${l}`));let d=id({matchUpFormat:u,matchUpId:t.match_id});d.sides[0]&&(d.sides[0].participant={participantId:"player1",participantName:o.player1,participantType:"INDIVIDUAL",participantRole:"COMPETITOR"}),d.sides[1]&&(d.sides[1].participant={participantId:"player2",participantName:o.player2,participantType:"INDIVIDUAL",participantRole:"COMPETITOR"});let p=0,f=0,m=0,h=0,g=0,I,v=0;for(let S=0;S<t.points?.length;S++){let U=t.points[S];if(U){I=U.Svr==="1"?0:1;try{let T=V9(U,I),P={winner:T.winner,server:T.server};if(d=hp(d,P),d.history?.points&&d.history.points.length>0){let D=d.history.points[d.history.points.length-1];D&&(T.result&&(D.result=T.result),T.stroke&&(D.stroke=T.stroke),T.hand&&(D.hand=T.hand),T.serve&&(D.serve=T.serve),T.serveLocation&&(D.serveLocation=T.serveLocation),T.rally&&(D.rally=T.rally),T.rallyLength&&(D.rallyLength=T.rallyLength),T.code&&(D.code=T.code))}if(v++,T.result==="Ace"&&p++,T.result==="Double Fault"&&f++,T.result==="Winner"&&m++,T.result==="Unforced Error"&&h++,T.result==="Forced Error"&&g++,n&&(S<5||S===t.points.length-1)){let D=yd(d);console.log(`Point ${S+1}: ${T.result||"Rally"} â ${D.scoreString}`)}}catch(T){let P=T instanceof Error?T.message:String(T);a.push(`Point ${S+1}: ${P}`),n&&console.error(`Point ${S+1} failed:`,P)}}}let w=yd(d).scoreString,y=d.matchUpStatus==="COMPLETED";y||s.push(`Match not complete. Final score: ${w}`);let b;if(r&&l){let S=cW(l),U=cW(w);b=S===U,b||a.push(`Score mismatch: expected "${l}", got "${w}"`),n&&(console.log(`Expected: ${l} â ${S}`),console.log(`Actual: ${w} â ${U}`),console.log(`Score matches: ${b}`))}return n&&(console.log(`Final score: ${w}`),console.log(`Match complete: ${y}`),console.log(`Stats: ${p} aces, ${f} DFs, ${m} winners, ${h} UEs, ${g} FEs`)),{valid:a.length===0,errors:a,warnings:s,matchUp:d,pointsProcessed:v,expectedScore:l,actualScore:w,scoreMatches:b,formatDeduced:c,aces:p,doubleFaults:f,winners:m,unforcedErrors:h,forcedErrors:g}}function cW(t){return t.replace(/\s+/g,"").replace(/,/g,", ").toLowerCase()}function hTe(t){let{csvData:e,matchId:i,matchUpFormat:r,debug:n=!1}=t,a=[],s=[],o=[],l;try{l=j9(e)}catch(I){let v=I instanceof Error?I.message:String(I);return a.push(`Failed to parse CSV: ${v}`),{valid:!1,errors:a,warnings:s,matchesProcessed:0,pointsProcessed:0,matchUps:[],totalAces:0,totalDoubleFaults:0,totalWinners:0,totalUnforcedErrors:0,totalForcedErrors:0}}let u=G9(l);n&&console.log(`Parsed ${l.length} points from ${u.length} matches`);let c=i?u.filter(I=>I.match_id===i):u;if(c.length===0)return a.push(i?`Match ID not found: ${i}`:"No matches found in CSV data"),{valid:!1,errors:a,warnings:s,matchesProcessed:0,pointsProcessed:0,matchUps:[],totalAces:0,totalDoubleFaults:0,totalWinners:0,totalUnforcedErrors:0,totalForcedErrors:0};let d=0,p=0,f=0,m=0,h=0,g=0;for(let I of c){let v=H9(I,{matchUpFormat:r,debug:n});v.valid||a.push(...v.errors),s.push(...v.warnings),o.push(v.matchUp),d+=v.pointsProcessed,p+=v.aces,f+=v.doubleFaults,m+=v.winners,h+=v.unforcedErrors,g+=v.forcedErrors}return{valid:a.length===0,errors:a,warnings:s,matchesProcessed:c.length,pointsProcessed:d,matchUps:o,totalAces:p,totalDoubleFaults:f,totalWinners:m,totalUnforcedErrors:h,totalForcedErrors:g}}function gTe(t){return JSON.stringify(t,null,2)}function ITe(t){let{existingDrawDefinition:e,hydrateCollections:i,enforceGender:r,tieFormatName:n,matchUpType:a,eventType:s,isMock:o,event:l}=t,{tieFormat:u,matchUpFormat:c}=t;if(a===rr&&s===rr){let d=e?.structures?.find(({stage:p})=>p===xe)?.tieFormat;u=u||d||n&&l?.tieFormat?.tieFormatName===n&&l.tieFormat||n&&sc({namedFormat:n,hydrateCollections:i,isMock:o,event:l})||l?.tieFormat||sc({event:l,isMock:o,hydrateCollections:i}),c=void 0}else c||(u=void 0,l?.matchUpFormat||(c=Xu));if(u){let d=Bn({gender:l?.gender,enforceGender:r,tieFormat:u});if(d.error)return d}return{tieFormat:u,matchUpFormat:c}}function vTe(t){let e=t.drawDefinition,{existingQualifyingPlaceholderStructureId:i,appliedPolicies:r,qualifyingOnly:n,drawEntries:a,structureId:s,tieFormat:o,idPrefix:l,isMock:u,event:c}=t,d=t.qualifyingProfiles,p=d?.length?G8({hasExistingDrawDefinition:!0,uuids:t.uuids,qualifyingProfiles:d,appliedPolicies:r,qualifyingOnly:n,tieFormat:o,idPrefix:l,isMock:u}):void 0;if(p?.error)return p;e.structures=e.structures?.filter(({structureId:b})=>b!==i),e.links=e.links?.filter(({source:b})=>b.structureId!==i);let{qualifiersCount:f,qualifyingDrawPositionsCount:m,qualifyingDetails:h}=p??{};m&&(p?.structures&&e.structures?.push(...p.structures),p?.links&&e.links?.push(...p.links));let g=e.structures?.find(({stage:b,stageSequence:S})=>b===xe&&S===1),{qualifiersCount:I}=uv({stageSequence:1,drawDefinition:e,structureId:s,stage:xe}),v=Math.max(f??0,I??0),w=Y7({qualifiersCount:v,drawDefinition:e,stage:xe});if(w.error||(w=JD({drawSize:m,stage:We,drawDefinition:e}),w.error))return w;yTe({drawDefinition:e,drawEntries:a,event:c});let y=bTe({mainStructure:g,qualifyingDetails:h,drawDefinition:e});return y.error?y:{drawDefinition:e,structureId:s}}function yTe({drawDefinition:t,drawEntries:e,event:i}){for(let r of(e??[]).filter(({entryStage:n})=>n===We)){let n={...r,entryStage:r.entryStage??xe,drawDefinition:t,event:i};pL(n)}}function bTe({mainStructure:t,qualifyingDetails:e,drawDefinition:i}){for(let r of e||[]){let{finalQualifyingRoundNumber:n,finalQualifyingStructureId:a,roundTarget:s,finishingPositions:o,linkType:l}=r,u=t&&gS({targetStructureId:t.structureId,sourceStructureId:a,sourceRoundNumber:n,finishingPositions:o,targetEntryRound:s,linkType:l})?.link;if(u?.error)return u;u&&(i.links||(i.links=[]),i.links.push(u))}return{error:void 0}}function W9(t){let{participantIds:e}=t,i=t.drawDefinition?.entries?.filter(r=>{let n=r.entryStatus;return!t.restrictEntryStatus||so.includes(n)}).map(vt)??[];if(e){let r=e.filter(n=>!i?.includes(n));if(r?.length)return z({result:{error:To},info:{invalidParticipantIds:r}})}else e=i;return t.roundsCount&&t.restrictRoundsCount!==!1&&t.roundsCount>e.length-1&&(!t.enableDoubleRobin||t.roundsCount>(e.length-1)*2)?{error:ie,info:"Not enough participants for roundsCount"}:t.roundsCount&&t.restrictRoundsCount!==!1&&t.roundsCount>31?{error:ie,info:"roundsCount must be less than 32"}:{participantIds:e}}function E0(t){let e=[],{roundsCount:i=1,drawDefinition:r,matchUpsCount:n,structureId:a,idPrefix:s,isMock:o,event:l}=t,u,c=W9(t);if(c.error)return c;for(let d of Re(1,i+1)){let p=KR({restrictMatchUpsCount:t.restrictMatchUpsCount,ignoreLastRoundNumber:!!u,newRound:!u,drawDefinition:r,matchUpsCount:n,structureId:a,roundNumber:u,idPrefix:s,isMock:o,event:l});if(p.error)return z({result:p,info:{iteration:d}});p.matchUps?.length&&e.push(...p.matchUps),u=(p?.roundNumber??1)+1}return{matchUps:e}}function wTe(t){let{tournamentRecord:e,participantIds:i,scaleName:r,eventType:n,adHocRatings:a={}}=t,s=t.scaleAccessor??xr[r]?.accessor,o=e.participants??[];for(let l of i??[]){let u=o?.find(d=>d.participantId===l),c=dW({scaleName:`${r}.${wF}`,participant:u,eventType:n});!c&&r&&(c=dW({scaleAccessor:s,participant:u,scaleName:r,eventType:n})),c&&!a[l]&&(a[l]=c)}return a}function dW({scaleType:t=sd,scaleAccessor:e,participant:i,scaleName:r,eventType:n}){let a=(i&&Hl({scaleAttributes:{eventType:n??Dm,scaleType:t,scaleName:r},participant:i}))?.scaleItem?.scaleValue;return e&&bt(a)?a[e]:a}function R0(t){let e=UTe(t);if(e?.error)return e;let i=W9(t);if(i.error)return i;let r=STe(t);if(r.error)return r;let n=wTe(t),a=t.tournamentRecord?.isMock??t.isMock,s=t.eventType??t.event?.eventType,o=[],l=[],u;for(let c of Re(1,(t.roundsCount??1)+1)){let d=n0({...t,participantIds:i.participantIds,structure:r.structure,ignoreLastRoundNumber:!0,iterationMatchUps:o,adHocRatings:n,roundNumber:u,eventType:s,isMock:a});if(d.error)return d;let{matchUps:p,...f}=d;f.modifiedScaleValues&&(n=f.modifiedScaleValues),l.push({...f,iteration:c,matchUpsCount:p?.length}),u=(f?.roundNumber??1)+1,p?.length&&o.push(...p)}return{...H,matchUps:o,roundResults:l}}function STe(t){if(t.structureId)return t.structureId;let e=t.drawDefinition,i=e?.structures?.filter(n=>n.stageSequence===1)?.reduce((n,a)=>{let s=a.stage&&Pm[a.stage];return Vn({structure:a})&&s>(Pm[n?.stage]||1)?a:n},void 0),r=e?.structures?.find(n=>n.structureId===i?.structureId);return r?Vn({structure:r})?{structure:r}:{error:em}:{error:Ii}}function UTe(t){return t.roundsCount&&typeof t.roundsCount!="number"?{error:ie,info:"roundsCount must be a number"}:typeof t.drawDefinition!="object"||t.drawDefinition.drawType&&t.drawDefinition.drawType!==ra?{error:em}:!Array.isArray(t.drawDefinition?.entries)&&t.participantIds&&!Array.isArray(t.participantIds)?{error:ie,info:"Missing Entries"}:{error:void 0}}function TTe(t){let{tournamentRecord:e,drawDefinition:i,structureId:r,idPrefix:n,isMock:a,event:s}=t,o=s?.entries?.filter(({entryStage:c,entryStatus:d})=>(!c||c===xe)&&d&&so.includes(d)),l=o?.map(vt),u=o?Math.floor(o.length/2):0;if(t.automated)return DTe({...t,participantIds:l});{let c=E0({roundsCount:t.roundsCount,drawDefinition:i,matchUpsCount:u,idPrefix:n,isMock:a,event:s});if(c.error)return c;c.matchUps?.length&&HR({matchUps:c.matchUps,suppressNotifications:!0,tournamentRecord:e,drawDefinition:i,structureId:r,event:s})}return{...H}}function DTe(t){let{restrictEntryStatus:e,generateMatchUps:i,structureId:r,matchUpIds:n,scaleName:a,scaleAccessor:s}=t.drawMatic??{},o=R0({...t,eventType:t.drawMatic?.eventType??t.matchUpType,generateMatchUps:i??!0,scaleAccessor:s??t.scaleAccessor,scaleName:a??t.scaleName,participantIds:t.participantIds,roundsCount:t.roundsCount,restrictEntryStatus:e,structureId:r,matchUpIds:n});return o.error?o:(o?.matchUps?.length&&HR({tournamentRecord:t.tournamentRecord,drawDefinition:t.drawDefinition,suppressNotifications:!0,matchUps:o.matchUps,event:t.event,structureId:r}),{...H})}function PTe({requireParticipantCount:t=!0,enforcePolicyLimits:e=!0,drawSizeProgression:i,participantsCount:r,participantCount:n,appliedPolicies:a,drawDefinition:s,seedingProfile:o,structureId:l,seedsCount:u}){r=r??n;let c=et({drawDefinition:s,structureId:l});if(c.error)return c;let d=c.structure;if(!d)return{error:Ii};let{positionAssignments:p}=ur({structure:d}),f=p?.length||0;if(u>f)return{error:s6};let m=d.structures?.length,h=ot(o?.groupSeedingThreshold)&&o?.groupSeedingThreshold,g=wL({roundRobinGroupsCount:m,drawSize:f})?.seedGroups,{seedsCount:I}=PS({policyDefinitions:a,requireParticipantCount:t,drawSizeProgression:i,participantsCount:r,drawSize:f});return I&&a?.[fo]&&u>I&&e&&(u=I),d.seedLimit=u,d.seedAssignments=Re(1,u+1).map(v=>{let w=g?.find(S=>S.includes(v)),y=w&&Math.min(...w),b=h&&v>=h?y:v;return{participantId:void 0,seedNumber:v,seedValue:b}}),ti({drawDefinition:s,structureIds:[l]}),{...H,seedLimit:u}}function Th({sortDescending:t=!1,tournamentRecord:e,scaleAttributes:i,scaleSortMethod:r,stageSequence:n,entries:a,event:s,stage:o}){if(!e)return{error:Ie};a=a??s?.entries??[];let l=a.filter(f=>(!o||!f.entryStage||f.entryStage===o)&&(!n||!f.entryStageSequence||f.entryStageSequence===n)&&so.includes(f.entryStatus)),u={...i};return{scaledEntries:l.map(f=>{let{participantId:m}=f,{scaleItem:h}=Nm({tournamentRecord:e,scaleAttributes:i,participantId:m});return{...f,...h}}).filter(f=>{let m=f.scaleValue;return!r&&(Number.isNaN(m)||!Number.parseFloat(m))?!1:m}).sort(r||(t||u?.ascending===!1?d:c))};function c(f,m){return p(f)-p(m)}function d(f,m){return p(m)-p(f)}function p(f){return Number.parseFloat(f.scaleValue||(t?-1:1e5))}}function z9(t){let e="prepareStage",{drawDefinition:i}=t,{structures:r}=Js({stageSequence:t.stageSequence||1,roundTarget:t.roundTarget,stage:t.stage,drawDefinition:i}),n=t.preparedStructureIds||[],a=r?.find(({structureId:f})=>!n.includes(f));if(!a)return z({result:{error:Ii},stack:e});let s=a?.structureId,{seedsCount:o,stageEntries:l,seedLimit:u}=OTe({...t,structureId:s});(t.seededParticipants||t.event||t.seedingScaleName)&&CTe({...t,seedsCount:o,structure:a,structureId:s});let c=t.automated!==!1&&t.drawType!==ra&&!(t.qualifyingOnly&&t.stage!==We),d=(r?.length||0)>1,p=c?RTe({...t,multipleStructures:d,seedLimit:u,structureId:s}):{};return p?.error?z({result:p,stack:e}):{...p,stageEntries:l,structureId:s,seedsCount:o}}function ETe({entries:t,stage:e,stageSequence:i,roundTarget:r}){return t.filter(n=>{let a=mt({name:Tl,element:n})?.extension?.value;return(!n.entryStage||n.entryStage===e)&&(!i||!n.entryStageSequence||n.entryStageSequence===i)&&(!r||!a||a===r)&&of.includes(n.entryStatus)})}function RTe(t){let e=typeof t.automated=="object"&&t.automated.seedsOnly,i=hS({...t,seedsOnly:e});if(i.error)return i;let r=i?.positionAssignments,n=i?.positioningReport;return{conflicts:i.conflicts,positionAssignments:r,positioningReport:n}}function CTe(t){let{seededParticipants:e,seedingScaleName:i,entries:r,event:n}=t,a=r.map(vt);e?MTe({...t,enteredParticipantIds:a}):(n||i)&&NTe({...t,enteredParticipantIds:a})}function MTe(t){let{provisionalPositioning:e,enteredParticipantIds:i,seededParticipants:r,tournamentRecord:n,appliedPolicies:a,drawDefinition:s,seedingProfile:o,structureId:l,structure:u,event:c}=t,d=u?yh({provisionalPositioning:e,appliedPolicies:a,drawDefinition:s,seedingProfile:o,structure:u}):void 0;r.filter(({participantId:p})=>i.includes(p)).filter(p=>!p.seedNumber||p.seedNumber<=r.length).sort((p,f)=>p.seedNumber<f.seedNumber?-1:p.seedNumber<f.seedNumber?1:0).forEach(p=>{let{participantId:f,seedNumber:m,seedValue:h}=p;dv({provisionalPositioning:e,tournamentRecord:n,drawDefinition:s,seedingProfile:o,participantId:f,seedBlockInfo:d,structureId:l,seedNumber:m,seedValue:h,event:c})})}function NTe(t){let e=t.seedsCount,{provisionalPositioning:i,enteredParticipantIds:r,seedAssignmentProfile:n,assignSeedsCount:a,tournamentRecord:s,drawDefinition:o,seedByRanking:l,seedingProfile:u,structureId:c,event:d}=t,{categoryName:p,ageCategoryCode:f}=d?.category||{};d?.eventType;let m=ATe({...t})||l&&kTe({...t}),h=m?.length??0;h<e&&(e=h),m?.filter(({participantId:g})=>r.includes(g)).slice(0,a||e).forEach((g,I)=>{let v=I+1,{participantId:w,scaleValue:y}=g,b=n?.[v]||y||v;dv({provisionalPositioning:i,tournamentRecord:s,drawDefinition:o,seedingProfile:u,participantId:w,structureId:c,seedNumber:v,seedValue:b,event:d})})}function ATe(t){let{tournamentRecord:e,seedingScaleName:i,stageSequence:r,entries:n,stage:a,event:s}=t,{categoryName:o,ageCategoryCode:l}=s?.category||{},u=s?.eventType,c={scaleName:i||o||l||s.eventId,scaleType:jl,eventType:u};return Th({scaleAttributes:c,tournamentRecord:e,stageSequence:r,entries:n,stage:a}).scaledEntries}function kTe(t){let{tournamentRecord:e,stageSequence:i,event:r,entries:n,stage:a}=t,{categoryName:s,ageCategoryCode:o}=r?.category||{},l=r?.eventType;return Th({scaleAttributes:{scaleName:s||o,scaleType:ou,eventType:l},tournamentRecord:e,stageSequence:i,entries:n,stage:a}).scaledEntries}function OTe(t){let{seedsCount:e}=t;t.seededParticipants&&(e=t.seededParticipants.length),e>t.drawSize&&(e=t.drawSize);let i=ETe(t);e>i.length&&(e=i.length);let{seedLimit:r}=PTe({enforcePolicyLimits:t.enforcePolicyLimits??!0,appliedPolicies:t.appliedPolicies,participantsCount:i.length,seedingProfile:t.seedingProfile,drawDefinition:t.drawDefinition,structureId:t.structureId,seedsCount:e});return r&&r<e&&(e=r),{seedsCount:e,stageEntries:i,seedLimit:r}}function xTe(t){let e=i0({...t,modifyOriginal:!1});if(e.error)return e;let i=e.drawDefinition,{suppressDuplicateEntries:r=!0,ignoreStageSpace:n,appliedPolicies:a,qualifyingOnly:s,seedingProfile:o,participants:l,drawEntries:u,placeByes:c,drawSize:d,drawType:p,entries:f}=t,m=[],h=[],g=FTe({ignoreStageSpace:n,drawDefinition:i,drawEntries:u,drawType:p,entries:f});if(g.error)return g;let I=p===tf?0:Ye(t.seedsCount??0),v=z9({...t,qualifyingOnly:!d||s,appliedPolicies:a,drawDefinition:i,seedingProfile:o,participants:l,stage:xe,seedsCount:I,placeByes:c,drawSize:d,entries:f});if(v.error&&!v.conflicts)return v;v.positioningReport?.length&&m.push({[xe]:v.positioningReport});let w=v.structureId;return v.conflicts&&(h=v.conflicts),p===ra&&t.roundsCount&&TTe({...t,drawDefinition:i,structureId:w}),{drawDefinition:i,positioningReports:m,conflicts:h,structureId:w}}function FTe(t){let{ignoreStageSpace:e,drawDefinition:i,drawEntries:r,drawType:n,entries:a}=t;for(let s of a){if(r&&s.entryStage&&s.entryStage!==xe)continue;let o={...s,ignoreStageSpace:e??n===ra,entryStage:s.entryStage??xe,event:t.event,drawDefinition:i,drawType:n},l=pL(o);if(r&&l.error)return l}return{error:void 0}}var LTe=()=>({matchUpType:void 0,drawName:void 0,drawId:void 0,structures:[],entries:[],links:[]}),_Te=LTe;function $Te(t){let{drawId:e=Et(),processCodes:i,matchUpType:r,drawType:n}=t??{},a=_Te();return Object.assign(a,{processCodes:i,matchUpType:r,drawType:n,drawId:e})}function C0(t){let e=t.structureIds,{tournamentRecord:i,drawDefinition:r,matchUpFormat:n,structureId:a,matchUpId:s,event:o}=t,l=Ge(t,[{[mn]:!0,[hF]:!0}]);if(l.error)return l;if(!xa({matchUpFormat:n}))return{error:Rw};let u="setMatchUpFormat";if(s){let c=di({drawDefinition:r,matchUpId:s,event:o});if(c.error)return c;let d=c.matchUp;if(d?.matchUpType===rr)return{info:"Cannot set matchUpFormat when { matchUpType: TEAM }",error:ta};d&&(d.matchUpFormat=n,St({tournamentId:i?.tournamentId,eventId:o?.eventId,context:u,drawDefinition:r,matchUp:d}))}else if(Array.isArray(e)){if(o?.eventType===rr)return{error:Zl};for(let c of e){let d=et({drawDefinition:r,structureId:c});if(d.error)return d;d.structure&&(d.structure.matchUpFormat=n)}}else if(a){if(o?.eventType===rr)return{error:Zl};let c=et({drawDefinition:r,structureId:a});if(c.error)return c;c.structure&&(c.structure.matchUpFormat=n)}else r&&(r.matchUpFormat=n);return e=e??(a?[a]:void 0),ti({drawDefinition:r,structureIds:e}),{...H}}function BTe({tieFormat:t}){let e=Bn({checkCollectionIds:!1,tieFormat:t});if(e.error)return e;for(let i of t.collectionDefinitions)i.collectionId||(i.collectionId=Et());return{tieFormat:t}}function VTe({existingQualifyingStructures:t,tournamentRecord:e,drawDefinition:i,matchUpFormat:r,matchUpType:n,tieFormat:a,event:s}){if((r||a)&&!(r&&s?.matchUpFormat===r||s?.tieFormat&&a&&JSON.stringify(s.tieFormat)===JSON.stringify(a))){if(a){let o=BTe({tieFormat:a});if(o.error)return o;let l=t?.every(u=>u.tieFormat);(!t?.length||l)&&(i.tieFormat=o.tieFormat??a)}else if(r){let o=C0({tournamentRecord:e,drawDefinition:i,matchUpFormat:r,event:s});if(o.error)return{info:"matchUpFormat or tieFormat error",error:o.error}}n&&(i.matchUpType=n)}return{error:void 0}}var q9={};ct(q9,{attachPolicies:()=>Ap,findPolicy:()=>af,getAppliedPolicies:()=>Tt,getPolicyDefinitions:()=>xc,mutate:()=>Y9,query:()=>X9,removePolicy:()=>K9});var Y9={};ct(Y9,{attachPolicies:()=>Ap,removePolicy:()=>K9});function K9(t){let e=Ge(t,[{[lge]:!0,_anyOf:{[cn]:!1,[mr]:!1,[mn]:!1,[Ac]:!1}}]);if(e.error)return e;let i,r=t.drawDefinition??t.event??((t.tournamentId||!t.tournamentRecords)&&t.tournamentRecord);if(r)return pW(t,r);if(t.tournamentRecords){let n=Object.keys(t.tournamentRecords);if(!n.length)return{error:Ie};for(let a of n){let s=t.tournamentRecords[a],o=pW(t,s);if(o.error)return o;i=!0}}else return{error:Ie};return i?{...H}:{error:Cw}}function pW(t,e){let i=Tt(t).appliedPolicies??{};return i[t.policyType]?(delete i[t.policyType],Object.keys(i).length?xt({element:e,extension:{name:bb,value:i}}):En({element:e,name:bb}),{...H}):{error:Cw}}var X9={};ct(X9,{findPolicy:()=>af,getAppliedPolicies:()=>Tt,getPolicyDefinitions:()=>xc});var jTe={[fo]:{validSeedPositions:{ignore:!0},duplicateSeedNumbers:!0,drawSizeProgression:!0,seedingProfile:{drawTypes:{[au]:{positioning:Tp},[Ks]:{positioning:Tp}},positioning:w5},policyName:"USTA SEEDING",seedsCountThresholds:[{drawSize:4,minimumParticipantCount:3,seedsCount:2},{drawSize:16,minimumParticipantCount:12,seedsCount:4},{drawSize:32,minimumParticipantCount:24,seedsCount:8},{drawSize:64,minimumParticipantCount:48,seedsCount:16},{drawSize:128,minimumParticipantCount:96,seedsCount:32},{drawSize:256,minimumParticipantCount:192,seedsCount:64}]}},AO=jTe;function GTe({appliedPolicies:t,policyDefinitions:e,drawDefinition:i,stack:r}){if(e&&typeof e!="object")return z({info:"policyDefinitions must be an object",result:{error:ie},stack:r});let n={[_D]:t?.[_D]};return e?HTe({policyDefinitions:e,appliedPolicies:t,policiesToAttach:n,drawDefinition:i}):n.avoidance&&Ap({drawDefinition:i,policyDefinitions:n}),!t?.[fo]&&!e?.[fo]&&(Ap({policyDefinitions:AO,drawDefinition:i}),t&&Object.assign(t,AO)),{error:void 0}}function HTe({policyDefinitions:t,appliedPolicies:e,policiesToAttach:i,drawDefinition:r}){for(let n of Object.keys(t))JSON.stringify(e?.[n])!==JSON.stringify(t[n])&&(i[n]=t[n]);Object.keys(i).length&&(Ap({policyDefinitions:i,drawDefinition:r}),e&&Object.assign(e,i))}function WTe(t){let{tournamentRecord:e,policyDefinitions:i,appliedPolicies:r,matchUpFormat:n,matchUpType:a,tieFormat:s,drawType:o,stack:l,event:u}=t,c=t.drawId?u?.drawDefinitions?.find(I=>I.drawId===t.drawId):void 0,d=c?.structures?.find(I=>I.stage===xe&&I.stageSequence===1)?.structureId,p=c?c.structures?.filter(I=>I.stage===We):[],f=p?.length===1&&!p[0].matchUps?.length&&p[0].structureId;c&&o!==c.drawType&&(c.drawType=o);let m=c??$Te({processCodes:t.processCodes,drawId:t.drawId,drawType:o}),h=VTe({existingQualifyingStructures:p,tournamentRecord:e,drawDefinition:m,matchUpFormat:n,matchUpType:a,tieFormat:s,event:u});if(h.error)return z({result:h,stack:l});let g=GTe({appliedPolicies:r,policyDefinitions:i,drawDefinition:m,stack:l});return g.error?g:{drawDefinition:m,structureId:d,existingDrawDefinition:c,existingQualifyingPlaceholderStructureId:f}}function zTe(t){let e="generateOrGetExisting",i=[],r=[],n=WTe(t);if(n.error)return z({result:n,stack:e});let a=n.existingDrawDefinition,s,o,l=t.drawEntries??t.eventEntries??[],u=n.existingQualifyingPlaceholderStructureId&&vTe({...t,...n})||xTe({...t,...n,entries:l});return u.error?z({result:u,stack:e}):(u.positioningReports?.length&&i.push(...u.positioningReports??[]),u.conflicts?.length&&r.push(...u.conflicts??[]),s=u.drawDefinition,o=u.structureId,{existingDrawDefinition:a,positioningReports:i,drawDefinition:s,structureId:o,conflicts:r,entries:l})}function qTe(t){let{qualifyingPlaceholder:e,existingDrawDefinition:i,positioningReports:r,qualifyingProfiles:n,appliedPolicies:a,qualifyingOnly:s,drawDefinition:o,seedingProfile:l,participants:u,structureId:c,tieFormat:d,entries:p,stack:f}=t,m=e&&!n?.length&&!i,h=[];if(n){let g=(y,b)=>y.stageSequence-b.stageSequence,I=(y,b)=>y.roundTarget-b.roundTarget,v=[],w=1;n.sort(I);for(let y of n){if(!Array.isArray(y.structureProfiles))return z({info:Np("structureProfiles"),result:{error:Xe},stack:f});w=y.roundTarget||w;let b=y.structureProfiles?.sort(g)||[],S=1;for(let U of b){let{qualifyingRoundNumber:T,qualifyingPositions:P,seededParticipants:D,seedingScaleName:E,seedsCount:R=0,seedByRanking:C,placeByes:M,drawSize:N}=U,A=z9({...t,seedingProfile:U.seedingProfile??l,stageSequence:S,qualifyingRoundNumber:T,preparedStructureIds:v,qualifyingPositions:P,seededParticipants:D,stage:We,seedingScaleName:E,appliedPolicies:a,drawDefinition:o,qualifyingOnly:s,seedByRanking:C,participants:u,roundTarget:w,seedsCount:R,placeByes:M,drawSize:N,entries:p});if(A.error)return A;A.structureId&&v.push(A.structureId),S+=1,A.conflicts?.length&&h.push(...A.conflicts),A.positioningReport?.length&&r.push({[We]:A.positioningReport})}w+=1}}else if(c&&m){let g=ns({structureName:Xr(We),stage:We,qualifyingOnly:s,tieFormat:d}),{link:I}=gS({sourceStructureId:g.structureId,targetStructureId:c,sourceRoundNumber:0,linkType:iu});o.structures||(o.structures=[]),o.structures.push(g),o.links||(o.links=[]),o.links.push(I)}return{qualifyingConflicts:h,error:void 0}}var J9={};ct(J9,{addGoesTo:()=>Mp,allCompetitionMatchUps:()=>Eo,allDrawMatchUps:()=>Rn,allEventMatchUps:()=>Ru,allPlayoffPositionsFilled:()=>RL,allTournamentMatchUps:()=>br,analyzeDraws:()=>SS,analyzeMatchUp:()=>Mb,analyzeTournament:()=>$0,bulkUpdatePublishedEventIds:()=>G0,calculateWinCriteria:()=>Dh,categoryCanContain:()=>Ow,checkMatchUpIsComplete:()=>fp,checkValidEntries:()=>YR,compareTieFormats:()=>gc,competitionScheduleMatchUps:()=>NS,courtGridRows:()=>gC,credits:()=>YTe,drawMatchUps:()=>r_,eventMatchUps:()=>yC,filterMatchUps:()=>Gu,filterParticipants:()=>cS,findDrawDefinition:()=>XL,findExtension:()=>mt,findVenue:()=>Eu,getAggregateTeamResults:()=>_0,getAllDrawMatchUps:()=>Qi,getAllEventData:()=>H0,getAllStructureMatchUps:()=>Nt,getAllowedDrawTypes:()=>lC,getAllowedMatchUpFormats:()=>x0,getAppliedPolicies:()=>Tt,getAssignedParticipantIds:()=>cf,getAvailableMatchUpsCount:()=>WR,getAvailablePlayoffProfiles:()=>vS,getCategoryAgeDetails:()=>Up,getCheckedInParticipantIds:()=>mh,getCompetitionDateRange:()=>cC,getCompetitionMatchUps:()=>Cb,getCompetitionParticipants:()=>M0,getCompetitionPenalties:()=>F0,getCompetitionVenues:()=>US,getCourtInfo:()=>RR,getCourts:()=>n_,getDrawData:()=>zR,getDrawDefinitionTimeItem:()=>WF,getDrawParticipantRepresentativeIds:()=>YL,getDrawStructures:()=>Js,getDrawTypeCoercion:()=>DS,getEligibleVoluntaryConsolationParticipants:()=>qL,getEntriesAndSeedsCount:()=>IC,getEvent:()=>o_,getEventData:()=>TS,getEventMatchUpFormatTiming:()=>Y0,getEventProperties:()=>a_,getEventPublishStatus:()=>za,getEventStructures:()=>FR,getEventTimeItem:()=>qw,getEvents:()=>s_,getFlightProfile:()=>$i,getHomeParticipantId:()=>Q0,getLinkedTournamentIds:()=>Gw,getMatchUpCompetitiveProfile:()=>iS,getMatchUpContextIds:()=>Z0,getMatchUpDailyLimits:()=>wC,getMatchUpDailyLimitsUpdate:()=>K0,getMatchUpDependencies:()=>oo,getMatchUpFormat:()=>e_,getMatchUpFormatTiming:()=>rS,getMatchUpFormatTimingUpdate:()=>q0,getMatchUpScheduleDetails:()=>CR,getMatchUpType:()=>MR,getMatchUpsMap:()=>Ar,getMatchUpsStats:()=>t_,getMatchUpsToSchedule:()=>pC,getMaxEntryPosition:()=>z0,getModifiedMatchUpFormatTiming:()=>vC,getPairedParticipant:()=>Qs,getParticipantEventDetails:()=>N0,getParticipantIdFinishingPositions:()=>KL,getParticipantMembership:()=>A0,getParticipantResults:()=>lS,getParticipantScaleItem:()=>Nm,getParticipantSchedules:()=>k0,getParticipantSignInStatus:()=>O0,getParticipantTimeItem:()=>zF,getParticipants:()=>Ei,getPersonRequests:()=>df,getPolicyDefinitions:()=>xc,getPositionAssignments:()=>lI,getPositionsPlayedOff:()=>fv,getPredictiveAccuracy:()=>J0,getProfileRounds:()=>hC,getPublishState:()=>Ih,getRandomQualifierList:()=>ZL,getRoundMatchUps:()=>bn,getRounds:()=>i_,getScaleValues:()=>iv,getScaledEntries:()=>Th,getScheduledRoundsDetails:()=>RS,getSchedulingProfile:()=>_c,getSchedulingProfileIssues:()=>W0,getSeedingThresholds:()=>SL,getSeedsCount:()=>PS,getStructureSeedAssignments:()=>ds,getTeamLineUp:()=>Cp,getTieFormat:()=>dC,getTimeItem:()=>vs,getTournamentIds:()=>Vw,getTournamentInfo:()=>Uh,getTournamentPenalties:()=>uC,getTournamentPersons:()=>L0,getTournamentPoints:()=>hv,getTournamentPublishStatus:()=>uS,getTournamentStructures:()=>EL,getTournamentTimeItem:()=>SR,getValidGroupSizes:()=>fS,getVenueData:()=>aI,getVenuesAndCourts:()=>Cu,isAdHoc:()=>Vn,isCompletedStructure:()=>uu,isValidForQualifying:()=>e0,isValidMatchUpFormat:()=>xa,matchUpActions:()=>qR,participantScaleItem:()=>Hl,participantScheduledMatchUps:()=>X0,positionActions:()=>QL,publicFindCourt:()=>rL,publicFindVenue:()=>iL,tallyParticipantResults:()=>gh,tieFormatGenderValidityCheck:()=>JE,tournamentMatchUps:()=>bC,validMatchUp:()=>UR,validMatchUps:()=>Ga,validateCollectionDefinition:()=>xw,validateLineUp:()=>xR});function YTe(){return`
    This project would not have been possible without the generous input and patience
    of tournament organizers and directors who worked with early versions of CourtHive/TMX.

    Thanks to Miro, Pavel, Ivan, Mladen, Zdenko, Antonia, Jakov, Kreso, Barry, Jeff, Bobby... to name just a few. 

    The project would not have even begun without the support of Miro, or the introduction by Sretchko.
    The project would not have succeeded without the enthusiasm of Randy and Bruce.
    Thanks to serendipity and Luca and the ensuing TODS conversations with ITF.
    Thanks to Scott and Jake for sanity checks, suggestions, and camaraderie.
    Thanks to Zoran for inspiring the async support and getting into the weeds with subscriptions.
    Thanks to Dave for backing the conversion of TMX 1.x source into the factory repository.
    Thanks to Vuk and Pavle and Rich and Chris and Deepa for the direct engagement with the APIs.
    Thanks to Joe for repeatedly challenging me and the many pointers to useful tooling.
    Thanks to Shannon for the validation of the approach from his deep domain experience.
    Thanks to Nikola for the ongoing camaraderie and explorations of what we can do with TODS.

    And a special thanks to my family for putting up with the long days and weeks and months of coding
    and conversations at all hours.
  `}var Q9={};ct(Q9,{filterParticipants:()=>cS,getCompetitionParticipants:()=>M0,getPairedParticipant:()=>Qs,getParticipantEventDetails:()=>N0,getParticipantMembership:()=>A0,getParticipantScaleItem:()=>Nm,getParticipantSchedules:()=>k0,getParticipantSignInStatus:()=>O0,getParticipantTimeItem:()=>zF,getParticipants:()=>Ei,getScaleValues:()=>iv,participantScaleItem:()=>Hl,validateLineUp:()=>xR});function M0(t){let{tournamentRecords:e}=t||{};if(typeof e!="object"||!Object.keys(e).length)return{error:Ci};let i=[],r={},n={},a={},s=[],o={},l=[];for(let u of Object.values(e)){let{participantIdsWithConflicts:c,mappedMatchUps:d,participantMap:p,participants:f,matchUps:m,derivedEventInfo:h,derivedDrawInfo:g}=Ei({...t,tournamentRecord:u});Object.assign(o,d),Object.assign(r,p),Object.assign(n,h),Object.assign(a,g),i.push(...f??[]),s.push(...m??[]),c?.forEach(I=>{l.includes(I)||l.push(I)})}return{participantIdsWithConflicts:l,derivedEventInfo:n,derivedDrawInfo:a,participantMap:r,mappedMatchUps:o,participants:i,...H,matchUps:s}}function N0({tournamentRecord:t,participantId:e}){if(!t)return{error:Ie};if(!e)return{error:lr};let i=[e].concat((t.participants??[]).filter(r=>r?.participantType&&[Lt,pt].includes(r.participantType)&&r.individualParticipantIds?.includes(e)).map(r=>r.participantId));return{eventDetails:(t.events??[]).filter(r=>{let n=(r?.entries??[]).map(a=>a.participantId);return kn(n,i)}).map(r=>({eventName:r.eventName,eventId:r.eventId}))}}function A0({tournamentRecord:t,participantId:e}){if(!t)return{error:Ie};if(!e)return{error:lr};let{participants:i}=Ei({participantFilters:{participantTypes:[Lt,pt,ja]},tournamentRecord:t});return(i??[]).filter(r=>r.individualParticipantIds?.includes(e)).reduce((r,n)=>{let a=n.participantType;return a&&(r[a]||(r[a]=[]),r[a].push(n)),r},{})}function k0({participantFilters:t={},tournamentRecord:e}){if(!e)return{error:Ie};if(typeof t!="object")return{error:Nc,context:{participantFilters:t}};let i={eventIds:t.eventIds},r=br({tournamentRecord:e,contextFilters:i}).matchUps??[],n=Object.assign({},...r.map(l=>({[l.matchUpId]:l}))),a=r.filter(({schedule:l})=>l&&Object.keys(l).length),s=oo({tournamentRecord:e,matchUps:r}).sourceMatchUpIds??[],o={};for(let l of a){let{sides:u}=l,c,d=u?.map(f=>{if(f.participant)return[f.participant].concat(...f.participant.individualParticipants||[]);s[l.matchUpId]&&!c&&(c=(s[l.matchUpId]||[]).map(m=>n[m]).filter(({winningSide:m,bye:h})=>!m&&!h))}).filter(Boolean).flat()??[];for(let f of d){let{participantId:m}=f;o[m]||(o[m]={potentialMatchUps:[],participant:f,matchUps:[]}),o[m].matchUps.push(l)}let p=c?.map(({sides:f})=>f).flat().map(({participant:f})=>f&&[f].concat(...f.individualParticipants||[])).filter(Boolean).flat()||[];for(let f of p){let{participantId:m}=f;o[m]||(o[m]={potentialMatchUps:[],participant:f,matchUps:[]}),o[m].potentialMatchUps.push(l)}}return{participantSchedules:Object.values(o).filter(({participant:l})=>!(t.participantIds&&!t.participantIds.includes(l.participantId)||t.participantTypes&&!t.participantTypes.includes(l.participantType))),...H}}function O0({tournamentRecord:t,participantId:e}){if(!t)return{error:Ie};if(!e)return{error:lr};let{participant:i}=$d({tournamentRecord:t,participantId:e});if(!i)return{error:Vi};let{timeItem:r}=vs({itemType:zw,element:i});return r&&r.itemValue===Sb&&Sb}var Z9={};ct(Z9,{analyzeDraws:()=>SS,analyzeTournament:()=>$0,getAggregateTeamResults:()=>_0,getAllowedDrawTypes:()=>lC,getAllowedMatchUpFormats:()=>x0,getAppliedPolicies:()=>Tt,getCompetitionDateRange:()=>cC,getCompetitionPenalties:()=>F0,getPolicyDefinitions:()=>xc,getTournamentInfo:()=>Uh,getTournamentPenalties:()=>uC,getTournamentPersons:()=>L0,getTournamentPoints:()=>hv,getTournamentStructures:()=>EL,getTournamentTimeItem:()=>SR});function x0({tournamentRecord:t,categoryName:e,categoryType:i}){if(!t)return{error:Ie};let{appliedPolicies:r}=Tt({tournamentRecord:t});return(r?.[Po]?.matchUpFormats||[]).filter(({categoryNames:n,categoryTypes:a})=>!e&&!a||e&&n?.includes(e)||i&&a?.includes(i))}function lC({tournamentRecord:t,categoryName:e,categoryType:i}){if(!t)return{error:Ie};let{appliedPolicies:r}=Tt({tournamentRecord:t});return(r?.[$D]?.allowedDrawTypes||[]).filter(({categoryNames:n,categoryTypes:a})=>!e&&!a||e&&n?.includes(e)||i&&a?.includes(i))}function uC({tournamentRecord:t}){if(!t)return{error:Ie};let e=(t?.participants??[]).reduce((i,r)=>{let{participantId:n}=r;return(r.penalties??[]).forEach(a=>{let{penaltyId:s}=a||{};i[s]?i[s].participants.push(n):i[s]={...a,participantIds:[n]}}),i},{});return{penalties:Object.values(e)}}function F0({tournamentRecords:t}){if(typeof t!="object"||!Object.keys(t).length)return{error:Ci};let e=[];for(let i of Object.values(t)){let{penalties:r}=uC({tournamentRecord:i});e.push(...r??[])}return{penalties:e}}function cC({tournamentRecords:t}){if(!bt(t))return{error:Ci};let e=Object.keys(t??{}).reduce((n,a)=>{let s=t[a],{tournamentInfo:{startDate:o,endDate:l}}=Uh({tournamentRecord:s}),u=o&&Qe(o),c=u&&new Date(u);(!n.startDate||c&&c<n.startDate)&&(n.startDate=c);let d=l&&Qe(l),p=d&&new Date(d);return(!n.endDate||p&&p>n.endDate)&&(n.endDate=p),n},{startDate:void 0,endDate:void 0}),i=e.startDate&&Qe(e.startDate.toISOString()),r=e.endDate&&Qe(e.endDate.toISOString());return!i||!r?{error:R6}:{startDate:i,endDate:r}}function L0({tournamentRecord:t,participantFilters:e}){if(!t)return{error:Ie};let i=t.participants||[];e&&(i=cS({participants:i,participantFilters:e,tournamentRecord:t}));let r={},n=a=>{if(a.person){let{personId:s}=a.person;r[s]?r[s].participantIds.push(a.participantId):r[s]={...a.person,participantIds:[a.participantId]}}};return i.forEach(a=>{a.person&&n(a)}),{tournamentPersons:Object.values(r)}}function _0(t){let e=Ge(t,[{[mr]:!0}]);if(e.error)return e;let i=t.finishingPositionRangeBounsPoints||{},r={},n=d=>{let p=d?.individualParticipants?.map(f=>f.teams?.length===1&&f.teams[0]);return d?.teams?.length===1&&d?.teams?.[0]||p?.[0].participantId===p?.[1].participantId&&p?.[0]},{matchUps:a,participants:s}=Ei({participantFilters:{participantTypes:[gt]},withRankingProfile:!0,withStatistics:!0,...t});for(let d of s??[]){if(d.participantType===_n)continue;d.draws?.[0]?.drawId==="draw-0-3"&&console.log(d.participantType,d.draws[0].finishingPositionRange);let p=n(d);if(p)for(let f of d?.draws??[]){let m=f?.finishingPositionRange?.join("-");if(m&&i?.[m]){let h=p?.participantId,g=f?.drawId,I=`${h}|${g}|${m}`;r[I]=i[m]}}}let o=d=>({teamName:d,standingPoints:0,pointsPlayed:0,pointsPct:0,points:0,bonus:0,diff:0,loss:0,win:0}),l=(d,p,f)=>{d[p]===void 0&&(d[p]=0),d[p]+=f},u={},c={};for(let d of a??[]){let{sides:p,matchUpFormat:f}=d,m=f&&zi(f);if(p?.length===2&&m.setFormat?.timed&&(!m.finalSetFormat||m.finalSetFormat?.timed))for(let h of p){let g=n(h.participant),I=g?.participantId,v=h.participant?.participantId,w=g?.participantName,y=h.sideNumber,b=h.participant?.individualParticipantIds||v&&[v]||[];if(b.forEach(S=>{S&&!u[S]&&(u[S]=o(w))}),I&&y){c[I]||(c[I]=o(w));let S=[...b.map(T=>u[T]),c[I]];d.winningSide&&(y===d.winningSide?S.forEach(T=>l(T,"win",1)):S.forEach(T=>l(T,"loss",1)));let U=d.score?.sets||[];for(let T of U){let P=T?.[`side${3-y}Score`]||0,D=T?.[`side${y}Score`]||0,E=D-P;S.forEach(R=>l(R,"pointsPlayed",D+P)),S.forEach(R=>l(R,"points",D)),S.forEach(R=>l(R,"diff",E))}}}}for(let d of Object.keys(r)){let[p]=d.split("|");c[p]&&(c[p].bonus+=r[d],c[p].pointsPct=parseFloat((c[p].points/c[p].pointsPlayed).toFixed(2)),c[p].standingPoints=c[p].win+c[p].bonus)}for(let d of Object.keys(u))u[d].pointsPct=parseFloat((u[d].points/u[d].pointsPlayed).toFixed(2));return{...H,individualResults:u,teamResults:c}}function KTe(t){let e=t.participants?.filter(({participantType:a})=>a===Lt)?.length===2,i=t.events?.length===1&&t.events[0],r=i?.drawDefinitions?.length===1&&i.drawDefinitions[0],n=(r?.structures?.length===1&&r.structures[0])?.positionAssignments?.length===2;return!!(i.tieFormat&&e&&n)}function $0({tournamentRecord:t}){if(!t)return{error:Ie};let{drawsAnalysis:e}=SS({tournamentRecord:t}),i={isDual:KTe(t),drawsAnalysis:e},r=Ei({tournamentRecord:t});return r.missingParticipantIds?.length&&(i.missingParticipantIds=r.missingParticipantIds),{...H,analysis:i}}function Dg(t,e){return t&&e&&Array.isArray(e)&&e[t-1]||typeof e=="object"&&e[t]}function B0({qualityWinProfiles:t,wonMatchUpIds:e,mappedMatchUps:i,participantSideMap:r,tournamentParticipants:n,tournamentStartDate:a,level:s}){let o=0,l=[],u={};for(let c of n)u[c.participantId]=c;for(let c of t){let{rankingScaleName:d,rankingSnapshot:p="latestAvailable",includeWalkovers:f=!1,rankingRanges:m=[],maxBonusPerTournament:h,unrankedOpponentBehavior:g="noBonus"}=c,I=0;for(let v of e){let w=i[v];if(!w)continue;let{matchUpStatus:y,sides:b=[],winningSide:S}=w;if(!f&&(y===mi||y===Qt))continue;let U=r[v];if(!U||S!==U)continue;let T=b.find(R=>R.sideNumber!==U)?.participantId;if(!T)continue;let P=u[T];if(!P)continue;let D=XTe({participant:P,rankingScaleName:d,rankingSnapshot:p,tournamentStartDate:a});if(!D){if(g==="noBonus")continue;continue}let E=m.find(R=>D>=R.rankRange[0]&&D<=R.rankRange[1]);if(E){let R;if(typeof E.value=="number")R=E.value;else if(typeof E.value=="object"){let C=Dg(s,E.value.level??E.value);typeof C=="number"&&(R=C)}R&&(I+=R,l.push({opponentParticipantId:T,opponentRank:D,points:R,matchUpId:v}))}}h!==void 0&&I>h&&(I=h),o+=I}return{qualityWinPoints:o,qualityWins:l}}function XTe({participant:t,rankingScaleName:e,rankingSnapshot:i,tournamentStartDate:r}){let n=(t.timeItems||[]).filter(o=>{if(!o?.itemType)return!1;let l=o.itemType.split(".");return l[0]===pd&&l[1]===ou&&l[3]===e});if(!n.length)return;let a=n;if(i==="tournamentStart"&&r){let o=new Date(r).getTime();a=n.filter(l=>(l.itemDate?new Date(l.itemDate).getTime():0)<=o)}if(!a.length)return;a.sort((o,l)=>(o.createdAt?new Date(o.createdAt).getTime():0)-(l.createdAt?new Date(l.createdAt).getTime():0));let s=a[a.length-1]?.itemValue;return typeof s=="number"?s:void 0}var JTe="RANKING_POINTS",QTe="QUALITY_WIN",ZTe="fullToEach",eX="splitEven",eDe="teamOnly",tX=["ageCategoryCodes","genders","categoryNames","categoryTypes","ratingTypes","ballTypes","wheelchairClasses","subTypes"],iX=["eventTypes","drawTypes","drawSizes","maxDrawSize","stages","stageSequences","levels","maxLevel","flights","maxFlightNumber","participationOrder","dateRanges"],tDe={RANKING_POINTS:JTe,QUALITY_WIN:QTe,FULL_TO_EACH:ZTe,SPLIT_EVEN:eX,TEAM_ONLY:eDe,CATEGORY_SCOPE_FIELDS:tX,PROFILE_SCOPE_FIELDS:iX};function V0(t){let{participation:e={},awardProfiles:i,wheelchairClass:r,startDate:n,eventType:a,drawSize:s,drawType:o,category:l,endDate:u,gender:c,level:d}=t,{participationOrder:p,flightNumber:f,rankingStage:m}=e,h=b=>!n&&!u||!b.dateRanges?!0:b.dateRanges.some(S=>{let U=!n||!S.startDate||new Date(n)>new Date(S.startDate),T=!u||!S.endDate||new Date(u)<=new Date(S.endDate);return U&&T}),g=b=>{if(!b)return!0;let S=l||{};return!(b.ageCategoryCodes?.length&&!b.ageCategoryCodes.includes(S.ageCategoryCode)||b.genders?.length&&!b.genders.includes(c)||b.categoryNames?.length&&!b.categoryNames.includes(S.categoryName)||b.categoryTypes?.length&&!b.categoryTypes.includes(S.type)||b.ratingTypes?.length&&!b.ratingTypes.includes(S.ratingType)||b.ballTypes?.length&&!b.ballTypes.includes(S.ballType)||b.wheelchairClasses?.length&&!b.wheelchairClasses.includes(r)||b.subTypes?.length&&!b.subTypes.includes(S.subType))},I=b=>h(b)&&(!b.maxFlightNumber||f<=b.maxFlightNumber)&&(!b.drawTypes?.length||b.drawTypes?.includes(o))&&(!b.drawSizes?.length||b.drawSizes.includes(s))&&(!b.stages?.length||b.stages.includes(m))&&(!b.levels?.length||b.levels.includes(d))&&(!b.maxDrawSize||s<=b.maxDrawSize)&&(!b.drawSize||b.drawSize===s)&&(!b.maxLevel||d<=b.maxLevel)&&(!f||!b.flights?.flightNumbers?.length||b.flights.flightNumbers.includes(f))&&(!b.participationOrder||b.participationOrder===p)&&g(b.category)&&(!b.eventTypes?.length||b.eventTypes?.includes(a)),v=i.filter(I);if(v.length===0)return{awardProfile:void 0};if(v.length===1)return{awardProfile:v[0]};let w=v.filter(b=>b.priority!==void 0);if(w.length){let b=Math.max(...w.map(S=>S.priority));return{awardProfile:w.find(S=>S.priority===b)}}let y=v.map((b,S)=>({profile:b,score:iDe(b),index:S}));return y.sort((b,S)=>S.score-b.score||b.index-S.index),{awardProfile:y[0].profile}}function iDe(t){let e=0;for(let i of iX){let r=t[i];if(r!=null){if(Array.isArray(r)&&r.length===0)continue;e+=1}}if(t.category)for(let i of tX){let r=t.category[i];Array.isArray(r)&&r.length>0&&(e+=1)}return e}function rP({participantWon:t,flightNumber:e,valueObj:i,drawSize:r,flights:n,level:a}){let s=(m,h)=>{if(m){if(Array.isArray(h)){let g=h.find(I=>I.flight===m||I.f===m);return g.value||g.v}if(typeof h=="object"){let g=h.flights||h.f;if(Array.isArray(g))return g[m-1]}}},o=(m,h)=>{let g=m?.value||m?.v||(ot(m)?m:0),I=Dg(a,m?.level);return{value:s(h,I)||ot(I)&&I||g}},l=0,u,c,d,p,f=t&&"won"||t===!1&&"lost"||void 0;if(Array.isArray(i)){let m=i.find(I=>I.drawSize===r||I.drawSizes?.includes(r)),h=i.find(I=>I.drawSize&&I.threshold&&r>I.drawSize),g=i.find(I=>!I.drawSize&&!I.drawSizes?.length);f!==void 0&&(m=m?.[f],h=h?.[f],g=g?.[f]),c=o(m,e).value,d=o(h,e).value,p=o(g,e).value,l=c||d||p,u=c&&m.requireWin||d&&h.requireWin||g?.requireWin}else if(typeof i=="object"){let m=i?.drawSizes?.[r],h=i;f!==void 0&&(m=m?.[f],h=h?.[f]),c=o(m,e).value,p=o(h,e).value,l=c||p,u=c?m.requireWin:h?.requireWin}else ot(i)&&f===void 0&&(l=i);return e&&n?.pct?.[e]&&(l=Math.round(l*n.pct[e])),{awardPoints:l,requireWin:u}}function hv({participantFilters:t,policyDefinitions:e,tournamentRecord:i,level:r}){if(!i)return{error:Ie};let n=ia(),{policyDefinitions:a}=xc({policyTypes:[WT],tournamentRecord:i}),s=e?.[WT]??a?.[WT];if(!s)return{error:xE};let o=s.awardProfiles,l=s.requireWinFirstRound,u=s.requireWinForPoints,c=s.doublesAttribution,d=s.qualityWinProfiles,{participants:p,derivedEventInfo:f,derivedDrawInfo:m,mappedMatchUps:h}=Ei({withRankingProfile:!0,participantFilters:t,tournamentRecord:i}),g=p?.filter(S=>S.draws?.length),I={},v={};for(let S of i.participants||[])S.person?.personId&&(I[S.participantId]=S.person.personId),S.individualParticipantIds?.length&&(v[S.participantId]=S.individualParticipantIds);let w={},y={},b={};for(let S of g??[]){let{participantType:U,participantId:T,person:P,draws:D}=S;for(let E of D){let{drawId:R,structureParticipation:C,eventId:M}=E,N=f[M],A=m[R],O=A?.drawType,{category:k,eventType:F,gender:x,wheelchairClass:L}=N||{},$=E.startDate||N.startDate||i.startDate,V=E.endDate||N.endDate||i.endDate;if(F===ya&&U!==_n)continue;let _;if(o){let B=u,G=0,j=0,K=0,Y=0,X,Z,J=0,ae,te,ne;for(let le of C){let{finishingPositionRange:de,participationOrder:pe,participantWon:ge,flightNumber:Me,rankingStage:Pe,winCount:Be}=le;if(G+=Be||0,Array.isArray(de)&&de.length){let ce=Math.min(...de);(te===void 0||ce<te)&&(te=ce)}let fe=A?.drawSize,{awardProfile:Te}=V0({wheelchairClass:L,awardProfiles:o,participation:le,eventType:F,startDate:$,category:k,drawSize:fe,drawType:O,endDate:V,gender:x,level:r});if(Te){if(!fe)continue;if(Te.profileName&&(Z=Te.profileName),ne||(ne=Te),ae===void 0&&Te.maxCountableMatches!==void 0){let ee=Te.maxCountableMatches;if(typeof ee=="number")ae=ee;else if(typeof ee=="object"){let Se=Dg(r,ee.level??ee);typeof Se=="number"&&(ae=Se)}}let ce=Array.isArray(de)&&Math.max(...de),ye=rt(de||[]).join("-"),be=ce&&Pe!==We&&de?.includes(fe);Te.requireWinForPoints!==void 0&&(B=Te.requireWinForPoints),Te.requireWinFirstRound!==void 0&&(l=Te.requireWinFirstRound);let{finishingPositionPoints:Fe={},finishingPositionRanges:we,finishingRound:Ne,pointsPerWin:me,flights:Ee}=Te,Le=Array.isArray(Te.perWinPoints)?Te.perWinPoints?.find(ee=>ee.participationOrders?.includes(pe)):Te.perWinPoints,Q=Fe.participationOrders,se=0,oe;if((!Q||Q.includes(pe))&&we&&ce){let ee=we[ce];ee&&({awardPoints:se,requireWin:oe}=rP({flightNumber:Me,valueObj:ee,drawSize:fe,flights:Ee,level:r}))}if(!se&&Ne&&pe===1&&ce){let ee=Ne[ce];ee&&({awardPoints:se,requireWin:oe}=rP({participantWon:ge,flightNumber:Me,valueObj:ee,drawSize:fe,flights:Ee,level:r}))}be&&l!==void 0&&(B=l),oe!==void 0&&(B=oe),se>j&&(!B||Be)&&(j=se,X=ce,ne=Te);let ue=ae!==void 0?Math.min(Be||0,Math.max(0,ae-J)):Be;if(!se&&me&&ue&&(K+=ue*me,J+=ue,X=ye),!se&&Be&&Le){let ee=Dg(r,Le?.level);typeof ee=="number"?(K+=(ue||0)*ee,J+=ue||0):!ee&&Le.value&&(K+=(ue||0)*Le.value,J+=ue||0)}}if(U===_n&&Te){let ce=Array.isArray(Te.perWinPoints)?Te.perWinPoints?.find(be=>be.participationOrders?.includes(pe)):Te.perWinPoints,ye=ce&&Dg(r,ce.level);if(ye){let be=(S.matchUps||[]).filter(({structureId:Fe})=>Fe===le.structureId);for(let{matchUpId:Fe}of be){let we=h[Fe],Ne=we?.sides?.find(me=>me.participantId===T)?.sideNumber;if(!(!Ne||we.winningSide!==Ne))for(let me of we.tieMatchUps||[]){if(!me.winningSide)continue;let{collectionPosition:Ee}=me,Le;if(typeof ye=="object"&&ye.line){if(ye.limit&&Ee>ye.limit)continue;Le=ye.line[Ee-1]}else typeof ye=="number"&&(Le=ye);if(Le)for(let Q of me.sides||[]){if(Q.sideNumber!==me.winningSide)continue;let se=Q.participantId;if(!se)continue;let oe=v[se]||[se];for(let ue of oe){let ee=I[ue];ee&&(w[ee]||(w[ee]=[]),w[ee].push({linePoints:Le,collectionPosition:Ee,eventType:F,drawId:R}))}}}}}}}if(ne?.bonusPoints&&te!==void 0){for(let le of ne.bonusPoints)if(le.finishingPositions?.includes(te)){let de=le.value;if(typeof de=="number")Y=de;else if(typeof de=="object"){let pe=Dg(r,de.level??de);typeof pe=="number"&&(Y=pe)}break}}if(_=j+K+Y,K||j||Y){let le={winCount:G,positionPoints:j,rangeAccessor:X,perWinPoints:K,bonusPoints:Y,eventType:F,drawId:R,points:_,category:k,drawType:O,startDate:$,endDate:V,level:r};n&&Z&&(le.profileName=Z);let de=P?.personId;if(de)w[de]||(w[de]=[]),w[de].push(le);else if(U===pt){if(b[T]||(b[T]=[]),b[T].push(le),c){let pe=c===eX?.5:1,ge=v[T]||[];for(let Me of ge){let Pe=I[Me];if(!Pe)continue;let Be={...le,points:Math.round(le.points*pe),positionPoints:Math.round(le.positionPoints*pe),perWinPoints:Math.round(le.perWinPoints*pe),bonusPoints:Math.round(le.bonusPoints*pe),doublesParticipantId:T};w[Pe]||(w[Pe]=[]),w[Pe].push(Be)}}}else U===_n&&(y[T]||(y[T]=[]),y[T].push(le))}if(d?.length&&S.matchUps){let le=Object.values(S.matchUps).filter(de=>de.drawId===R&&de.participantWon);if(le.length){let de=le.map(Pe=>Pe.matchUpId),pe={};for(let Pe of le)pe[Pe.matchUpId]=Pe.sideNumber;let{qualityWinPoints:ge,qualityWins:Me}=B0({qualityWinProfiles:d,wonMatchUpIds:de,mappedMatchUps:h,participantSideMap:pe,tournamentParticipants:i.participants||[],tournamentStartDate:i.startDate,level:r});if(ge>0){let Pe=P?.personId;Pe&&(w[Pe]||(w[Pe]=[]),w[Pe].push({qualityWinPoints:ge,qualityWins:Me,eventType:F,drawId:R}))}}}}}}return{participantsWithOutcomes:g,personPoints:w,pairPoints:b,teamPoints:y,...H}}var rX={};ct(rX,{compareTieFormats:()=>gc,getTieFormat:()=>dC,tieFormatGenderValidityCheck:()=>JE,validateCollectionDefinition:()=>xw});function nP(t){if(!t)return{};let e=[],i=t.tieFormatName,r=t.collectionDefinitions?.map(n=>{let{matchUpType:a,matchUpFormat:s,matchUpCount:o,category:l,gender:u}=n;e.includes(s)||e.push(s);let c=l?.ageCategoryCode;return[o,a===wp?"D":"S",c,s,u].join(";")}).join("|");return{tieFormatName:t&&i||"UNNAMED",matchUpFormats:e,tieFormatDesc:r}}function gc({considerations:t={},descendant:e,ancestor:i}){let r={},n={},{matchUpFormats:a,tieFormatDesc:s}=nP(e),{matchUpFormats:o,tieFormatDesc:l}=nP(i),u=rt((a??[]).filter(b=>!(o??[]).includes(b)).concat((o??[]).filter(b=>!(a??[]).includes(b)))),c=!!(t?.collectionName&&e.collectionDefinitions.map(({collectionName:b})=>b).join("|")!==i.collectionDefinitions.map(({collectionName:b})=>b).join("|")),d=!!(t?.collectionOrder&&e.collectionDefinitions.map(({collectionOrder:b})=>b).join("|")!==i.collectionDefinitions.map(({collectionOrder:b})=>b).join("|")),p=Object.assign({},...(e?.collectionDefinitions||[]).map(b=>({[b.collectionId]:b}))),f=Object.assign({},...(i?.collectionDefinitions||[]).map(b=>({[b.collectionId]:b})));r.collectionIds=TH(Object.keys(p),Object.keys(f)),n.collectionIds=TH(Object.keys(f),Object.keys(p)),r.collectionsValue=fW(p),n.collectionsValue=fW(f),r.groupsCount=i?.collectionGroups?.length??(0-(e?.collectionGroups?.length??0)||0),n.groupsCount=r.groupsCount?-1*r.groupsCount:0;let m=r.collectionsValue.totalValue-n.collectionsValue.totalValue,h=r.collectionsValue.totalMatchUps-n.collectionsValue.totalMatchUps,g=n.collectionsValue.assignmentValues.length!==r.collectionsValue.assignmentValues.length,I=n.collectionsValue.assignmentValues.some((b,S)=>{let U=r.collectionsValue.assignmentValues[S];return!U||b.valueKey!==U.valueKey||b.value!==U.value?!0:Array.isArray(b.value)?b.value.every((T,P)=>U.value[P]===T):!1}),v=c||d||l!==s||g||I||m!==0,w=[...n.collectionsValue.invalidValues,...r.collectionsValue.invalidValues],y=w.length&&w;return{matchUpFormatDifferences:u,matchUpCountDifference:h,descendantDifferences:r,ancestorDifferences:n,orderDifference:d,valueDifference:m,nameDifference:c,descendantDesc:s,ancestorDesc:l,...H,different:v,invalid:y}}function fW(t){let e=[],i=[],r=0;return{totalValue:Object.keys(t).sort(AR).reduce((n,a)=>{let s=t[a],{collectionValueProfiles:o,collectionValue:l,matchUpCount:u,matchUpValue:c,scoreValue:d,setValue:p}=s,f={collectionValueProfiles:o,collectionValue:l,matchUpValue:c,scoreValue:d,setValue:p},m=Object.keys(f).filter(g=>![void 0,null].includes(f[g])&&(!Array.isArray(f[g])||f[g].length>0));m.length!==1&&e.push({collectionId:a});let h=m[0];if(h){let g=h==="collectionValueProfiles"?Object.values(o):f[h];i.push({valueKey:h,value:g})}return r+=u,o?.length?n+o.reduce((g,I)=>g+I.value,0):u?ot(c)?n+c*u:ot(d)?n+d*u:ot(p)?n+p*u:n+l:n},0),totalMatchUps:r,invalidValues:e,assignmentValues:i}}function j0(t){Object.assign(t,{inContext:!0});let{matchUp:e,error:i}=nX(t);return{matchUp:ke(e,!0,!0),error:i}}function nX({participantsProfile:t,afterRecoveryTimes:e,tournamentRecord:i,contextContent:r,contextProfile:n,drawDefinition:a,nextMatchUps:s,matchUpId:o,inContext:l,eventId:u,drawId:c,event:d}){if(!i)return{error:Ie};if(typeof o!="string")return{error:Un};if(!a||!d){let m=(br({tournamentRecord:i,nextMatchUps:s}).matchUps??[]).find(h=>h.matchUpId===o);if(!m)return{error:un};({eventId:u,drawId:c}=m),{event:d,drawDefinition:a}=jn({tournamentRecord:i,eventId:u,drawId:c})}if(!a)return{error:Oa};n&&!r&&(r=Fc({tournamentRecord:i,contextProfile:n}));let p={surfaceCategory:d?.surfaceCategory??i.surfaceCategory,indoorOutDoor:d?.indoorOutdoor??i.indoorOutdoor,endDate:d?.endDate??i.endDate,tournamentId:i.tournamentId,eventId:u??d?.eventId,drawId:c},{participants:f=[]}=nf({participantsProfile:t,tournamentRecord:i,contextProfile:n,inContext:l});if(s){let m=(Rn({context:l?p:void 0,participants:f,afterRecoveryTimes:e,contextContent:r,contextProfile:n,drawDefinition:a,nextMatchUps:s,inContext:l,event:d}).matchUps??[]).find(g=>g.matchUpId===o);if(!m)return{error:un};let h=a?.structures?.find(g=>g.structureId===m.structureId);return{drawDefinition:a,structure:h,matchUp:m}}else{let{matchUp:m,structure:h}=di({context:l?p:void 0,tournamentParticipants:f,afterRecoveryTimes:e,contextContent:r,drawDefinition:a,contextProfile:n,matchUpId:o,inContext:l,event:d});return{matchUp:m,structure:h,drawDefinition:a}}}function dC({tournamentRecord:t,drawDefinition:e,structureId:i,matchUpId:r,structure:n,eventId:a,drawId:s,event:o}){if(!t)return{error:Ie};if(!s&&!o&&!i&&!r)return z({result:{error:Xe},stack:"getTieFormat"});a&&!o&&(o=t.events?.find(f=>f.eventId===a));let l=j0({tournamentRecord:t,drawDefinition:e,matchUpId:r,drawId:s,event:o});if(r&&l?.error)return l;if(!e&&l?.drawDefinition&&(e=l?.drawDefinition),n=n??l?.structure,!n&&i&&!r){if(!e)return{error:Oo};let f=et({drawDefinition:e,structureId:i});if(f.error)return f;n=f.structure}let u=(n?.tieFormat||n?.tieFormatId)&&vn({structure:n,drawDefinition:e,event:o})?.tieFormat,c=(e?.tieFormat||e?.tieFormatId)&&vn({drawDefinition:e,event:o})?.tieFormat,d=vn({event:o})?.tieFormat,p=vn({matchUp:l?.matchUp,drawDefinition:e,structure:n,event:o})?.tieFormat;return{...H,matchUp:l?.matchUp,structureDefaultTieFormat:jr(u),eventDefaultTieFormat:jr(d),drawDefaultTieFormat:jr(c),tieFormat:jr(p),structure:n}}var aX={};ct(aX,{bulkUpdatePublishedEventIds:()=>G0,getAllEventData:()=>H0,getCourtInfo:()=>RR,getDrawData:()=>zR,getEventData:()=>TS,getEventPublishStatus:()=>za,getPublishState:()=>Ih,getTournamentPublishStatus:()=>uS,getVenueData:()=>aI});function G0({tournamentRecord:t,outcomes:e}){if(!t)return{error:Ie};if(!e?.length)return{error:Xe,info:"Missing outcomes"};let i=e.reduce((n,a)=>{let{drawId:s,eventId:o}=a;return o&&s&&(n[o]?n[o].includes(s)||n[o].push(s):n[o]=[s]),n},{}),r=Object.keys(i);return{publishedEventIds:(t.events?.filter(n=>r.includes(n.eventId))).filter(n=>{let a=za({event:n}),{drawDetails:s,drawIds:o}=a??{},{eventId:l}=n;return i[l].filter(u=>{let c=s?Object.keys(a.drawDetails).filter(d=>dL({drawId:d,drawDetails:s})):[];return o?.includes(u)||c.includes(u)}).length}).map(n=>n.eventId),eventIdPublishedDrawIdsMap:i}}function H0({tournamentRecord:t,policyDefinitions:e}){if(!t)return{error:Ie};let i=t.events||[],r=t?.participants||[],{tournamentInfo:n}=Uh({tournamentRecord:t}),{venues:a}=Cu({tournamentRecord:t}),s=i.map(o=>{let{eventId:l}=o,u=E8({event:o}).eventInfo,c=Yw({tournamentRecord:t,event:o}).scheduleTiming,d=(o.drawDefinitions||[]).map(f=>{let{drawId:m,drawName:h,matchUpFormat:g,updatedAt:I}=f,v={drawId:m,drawName:h,matchUpFormat:g,updatedAt:I},{abandonedMatchUps:w,completedMatchUps:y,upcomingMatchUps:b,pendingMatchUps:S}=ov({requireParticipants:!0,tournamentParticipants:r,context:{eventId:l},policyDefinitions:e,tournamentRecord:t,inContext:!0,scheduleTiming:c,drawDefinition:f,event:o});return{drawInfo:v,matchUps:{abandonedMatchUps:w,completedMatchUps:y,upcomingMatchUps:b,pendingMatchUps:S}}}),p=za({event:o});return Object.assign(u,{drawsData:d,publish:p}),u});return{allEventData:{tournamentInfo:n,venuesData:a,eventsData:s}}}var sX={};ct(sX,{courtGridRows:()=>gC,findVenue:()=>Eu,getMatchUpsToSchedule:()=>pC,getPersonRequests:()=>df,getProfileRounds:()=>hC,getScheduledRoundsDetails:()=>RS,getSchedulingProfile:()=>_c,getSchedulingProfileIssues:()=>W0,publicFindCourt:()=>rL});function cI({matchUpPotentialParticipantIds:t,matchUpNotBeforeTimes:e,timeAfterRecovery:i,matchUp:r}){let{individualParticipantIds:n}=bR(r);i=i??r.schedule?.timeAfterRecovery;let a=u=>{t[u]||(t[u]=[]),t[u]=rt(t[u].concat(...n))},s=u=>{i&&(!e[u]||i>e[u])&&(e[u]=i)},o=r.winnerTo?.matchUpId||r.winnerMatchUpId;o&&(i&&s(o),a(o));let l=r.loserTo?.matchUpId||r.loserMatchUpId;l&&(i&&s(l),a(l)),r.sidesTo?.length&&r.sidesTo.forEach(({matchUpId:u})=>{u&&(i&&s(u),a(u))})}function pC(t){let e=Ge(t,[{[vF]:!0}]);if(e.error)return e;let{matchUpPotentialParticipantIds:i,dateScheduledMatchUpIds:r=[],scheduleCompletedMatchUps:n,matchUpNotBeforeTimes:a,matchUpScheduleTimes:s,orderedMatchUpIds:o,clearDate:l,matchUps:u}=t,c=s?Object.keys(s):[],d=(o??[]).map(f=>u.find(m=>m.matchUpId===f)).filter(Boolean).filter(f=>{let m=!l&&(r.includes(f.matchUpId)||c.includes(f.matchUpId)),h=["BYE",Qt,ki,us,$r,mi,wi,Hi].includes(f?.matchUpStatus);return n||!m&&!f.winningSide&&!h}),p=i&&a?d.reduce((f,m)=>{let{drawId:h,tournamentId:g}=m;return f.matchUpMap[g]||(f.matchUpMap[g]={}),f.matchUpMap[g][h]?f.matchUpMap[g][h].push(m):f.matchUpMap[g][h]=[m],cI({matchUpPotentialParticipantIds:i,matchUpNotBeforeTimes:a,matchUp:m}),f},{matchUpMap:{}}).matchUpMap:{};return{matchUpsToSchedule:d,matchUpMap:p}}function fC({defaultRecoveryMinutes:t=0,defaultAverageMinutes:e,tournamentRecords:i,matchUpFormat:r,categoryName:n,categoryType:a,tournamentId:s,eventType:o,eventId:l}){if(!xa({matchUpFormat:r}))return{error:Rw};let u=Object.keys(i).filter(d=>!s||d===s),c;return u.forEach(d=>{if(c)return;let p=i[d],f=l?jn({tournamentRecord:p,eventId:l})?.event:void 0;return c=rS({tournamentRecord:p,matchUpFormat:r,categoryName:n,categoryType:a,eventType:o,event:f}),c?.averageMinutes||c?.recoveryMinutes}),{recoveryMinutes:c?.recoveryMinutes||t,averageMinutes:c?.averageMinutes||e,typeChangeRecoveryMinutes:c?.typeChangeRecoveryMinutes||c?.recoveryMinutes||t}}function RS(t){let e=Ge(t,[{[bF]:{tournamentRecords:!1,tournamentRecord:!1}},{rounds:!0,[zn]:an}]);if(e.error)return e;let{scheduleCompletedMatchUps:i,periodLength:r=30}=t,n=t.tournamentRecords||t.tournamentRecord&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord}||{};if(typeof n!="object")return{error:Ci};let a={},s=[],o=t.rounds.toSorted((m,h)=>(m.sortOrder??0)-(h.sortOrder??0)),l=t.containedStructureIds??Object.assign({},...Object.values(n).map(m=>av({tournamentRecord:m}).containedStructures)),u=t.matchUps??Eo({nextMatchUps:!0,tournamentRecords:n}).matchUps,c=0,d={},p={},f={};return{scheduledRoundsDetails:o.flatMap(m=>{let h=m.periodLength||r,g=[];l?.[m.structureId]?g.push(...l[m.structureId]):g.push(m.structureId);let I=u?Gu({tournamentIds:[m.tournamentId],roundNumbers:[m.roundNumber],matchUpIds:m.matchUpIds,eventIds:[m.eventId],drawIds:[m.drawId],processContext:!0,structureIds:g,matchUps:u}).sort(hh):[],{segmentNumber:v,segmentsCount:w}=m.roundSegment||{};if(ot(v)&&Uo(I?.length)&&Uo(w)&&v>0&&v<=w&&w<I?.length&&!m.matchUpIds?.length){let U=I.length/w,T=U*(v-1);I=I.slice(T,T+U)}let y=n[m.tournamentId],b=jn({drawId:m.drawId,tournamentRecord:y}).event,S=[];for(let U of I){let T=U.matchUpFormat;T&&(a[T]||(a[T]=[],a[T].push(U)),S.push(T))}for(let U of S){let{eventType:T,category:P}=b??{},{categoryName:D,ageCategoryCode:E}=P??{},{typeChangeRecoveryMinutes:R,recoveryMinutes:C,averageMinutes:M,error:N}=fC({categoryName:D??E,categoryType:P?.categoryType,tournamentId:m.tournamentId,eventId:m.eventId,tournamentRecords:n,matchUpFormat:U,eventType:T});if(N)return{error:N,round:m};let A=I.filter(k=>(i||!Yi.includes(k.matchUpStatus))&&k.matchUpStatus!=="BYE").map(Ir);A.forEach(k=>{f[k]={typeChangeRecoveryMinutes:R,recoveryMinutes:C,averageMinutes:M},d[k]=C,p[k]=M}),s.push(...A),c=Math.max(M||0,c);let O=`${M}|${h}`;return{roundPeriodLength:h,recoveryMinutes:C,averageMinutes:M,matchUpIds:A,hash:O}}}),greatestAverageMinutes:c,matchUpFormatCohorts:a,recoveryMinutesMap:d,averageMinutesMap:p,orderedMatchUpIds:s,minutesMap:f,...H}}function oX({schedulingProfile:t,venueIds:e,eventIds:i,drawIds:r}){let n=[],a=t?.map(o=>{let l=Qe(o?.scheduleDate);if(!l){n.push(`Invalid date: ${o?.scheduledDate}`);return}let u=(o?.venues||[]).map(c=>{let{rounds:d,venueId:p}=c;if(!e?.includes(p)){n.push(`Missing venueId: ${p}`);return}let f=d.filter(m=>{let h=i.includes(m.eventId)&&r.includes(m.drawId);return h||n.push(`Invalid eventId: ${m.eventId} or drawId: ${m.drawId}`),h});if(f.length)return{venueId:p,rounds:f}}).filter(Boolean);return u.length&&l&&{...o,venues:u}}).filter(Boolean),s=n.length;return{updatedSchedulingProfile:a,modifications:s,issues:n}}function mC({tournamentRecords:t,schedulingProfile:e}){if(!e)return{valid:!0};if(!Array.isArray(e))return{valid:!1,error:ie};let{venueIds:i,tournamentsMap:r}=nDe({tournamentRecords:t}),n,a,s=e.every(o=>{let{scheduleDate:l,venues:u}=o;return Pn(l)?u.every(c=>{let{venueId:d,rounds:p}=c;return typeof d!="string"?(a="venueId should be a string",!1):Array.isArray(p)?i.includes(d)?!!p.every(f=>{if(!f)return a="empty round",!1;let{roundSegment:m,tournamentId:h,structureId:g,roundNumber:I,eventId:v,drawId:w}=f,y=r?.[h]?.[v]?.[w]?.[g]?.includes(I);y||(a="Invalid rounds");let{segmentNumber:b,segmentsCount:S}=m||{},U=!m||ot(b)&&Uo(S)&&b<=S;return U||(a="Invalid segment"),y&&U}):(n=ef,!1):(a="rounds should be an array",!1)}):!1});return!s&&!n&&(n=ie),{valid:!!s,error:n,info:a}}function rDe(t){let{tournamentRecord:e={},tournamentMap:i={},requireCourts:r}=t,n=[],a=[],s=[],o=[],l=(e?.venues||[]).map(({venueId:c,courts:d})=>(!r||d?.length)&&c),u=e?.tournamentId;if(u){n.push(u),i[u]={};let c=e?.events||[];for(let d of c){let p=d.eventId;s.push(p),i[u][p]={};let f=m=>parseInt(m);for(let m of d.drawDefinitions||[]){let h=m.drawId;o.push(h),i[u][p][h]={};let{structures:g}=Js({drawDefinition:m});for(let I of g||[]){let v=I.structureId,{matchUps:w}=Nt({structure:I}),{roundMatchUps:y}=bn({matchUps:w}),b=y&&Object.keys(y).map(f);if(i[u][p][h][v]=b,a.push(v),I.structures?.length)for(let S of I.structures)a.push(S.structureId),i[u][p][h][S.structureId]=b}}}}return{tournamentMap:i,tournamentIds:n,structureIds:a,venueIds:l,eventIds:s,drawIds:o}}function nDe(t){let e=t?.tournamentRecords&&Object.values(t?.tournamentRecords)||[],i={},{venueIds:r,eventIds:n,drawIds:a,structureIds:s,tournamentIds:o}=e.reduce((l,u)=>{let{tournamentIds:c,tournamentMap:d,structureIds:p,venueIds:f,eventIds:m,drawIds:h}=rDe({tournamentRecord:u});return f.forEach(g=>{l.venueIds.includes(g)||l.venueIds.push(g)}),l.tournamentIds.push(...c),l.structureIds.push(...p),l.eventIds.push(...m),l.drawIds.push(...h),Object.assign(i,d),l},{tournamentIds:[],structureIds:[],venueIds:[],eventIds:[],drawIds:[]});return{tournamentsMap:i,tournamentIds:o,structureIds:s,venueIds:r,eventIds:n,drawIds:a}}function _c({tournamentRecords:t,tournamentRecord:e}){if(typeof t!="object"||!Object.keys(t).length)return{error:Ci};let{extension:i}=mt({element:e,name:Cm,tournamentRecords:t,discover:!0}),r=i?.value||[];if(r.length){let{venueIds:n}=US({requireCourts:!0,tournamentRecords:t}),{eventIds:a,drawIds:s}=jL({tournamentRecords:t}),{updatedSchedulingProfile:o,modifications:l,issues:u}=oX({schedulingProfile:r,venueIds:n,eventIds:a,drawIds:s});if(l){r=o;let c=gv({tournamentRecords:t,tournamentRecord:e,schedulingProfile:r});return c.error?c:{schedulingProfile:r,modifications:l,issues:u}}}return{schedulingProfile:r,modifications:0}}function gv({tournamentRecords:t,tournamentRecord:e,schedulingProfile:i}){let r=mC({tournamentRecords:t,schedulingProfile:i});return r.error?r:i?xt({tournamentRecords:t,discover:!0,extension:{name:Cm,value:i}}):En({element:e,name:Cm,tournamentRecords:t,discover:!0})}function CS(t){let{tournamentRecord:e}=t,i=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(!t.schedulingProfile){let{modifications:u,issues:c}=_c({tournamentRecords:i,tournamentRecord:e});return{success:!u,modifications:u,issues:c}}let{venueIds:r}=US({tournamentRecords:i}),{eventIds:n,drawIds:a}=jL({tournamentRecords:i}),{updatedSchedulingProfile:s,modifications:o,issues:l}=oX({schedulingProfile:t.schedulingProfile,venueIds:r,eventIds:n,drawIds:a});return o?{...gv({schedulingProfile:s,tournamentRecords:i}),modifications:o,issues:l}:{...H,modifications:o,issues:l}}function W0(t){let{scheduleDates:e=[],tournamentRecords:i,periodLength:r=30}=t??{};if(typeof i!="object")return{error:Tw};if(!Array.isArray(e))return{error:ie};if(!e.every(Pn))return{error:sr};let n=[],a=0,s={},{schedulingProfile:o}=_c({tournamentRecords:i});if(!o)return{issues:n,...H};let{matchUps:l}=Eo({nextMatchUps:!0,tournamentRecords:i});for(let c of o){let{scheduleDate:d,venues:p=[]}=c;if(!e?.length||e.includes(d)){for(let f of p||[])if(f){let{rounds:m}=f,h=[],{orderedMatchUpIds:g,scheduledRoundsDetails:I}=RS({tournamentRecords:i,periodLength:r,matchUps:l,rounds:m}),{matchUpDependencies:v}=oo({tournamentRecords:i,matchUps:l}),w=y=>{let b;return I?.find((S,U)=>{let T=S.matchUpIds.includes(y);return T&&(b=U),T}),b};if(g?.forEach((y,b)=>{let S=g.slice(b+1),U=xi(S,v?.[y]?.matchUpIds||[]);U.length&&h.push({matchUpId:y,shouldBeAfter:U})}),h.length){a+=h.length;let y=h.map(({matchUpId:b,shouldBeAfter:S})=>{let U=w(b),T=rt(S.map(w));return s[d]||(s[d]={}),s[d][U]||(s[d][U]=[]),T.forEach(P=>{s[d][U].includes(P)||s[d][U].push(P)}),{matchUpId:b,matchUpRoundIndex:U,earlierRoundIndices:T,shouldBeAfter:S}});n.push(...y)}}}}let u={matchUpIdShouldBeAfter:Object.assign({},...n.map(c=>{let{matchUpId:d,shouldBeAfter:p,earlierRoundIndices:f}=c;return{[d]:{earlierRoundIndices:f,shouldBeAfter:p}}}))};return{issuesCount:a,profileIssues:u,roundIndexShouldBeAfter:s,...H}}function df(t){let{tournamentRecords:e,requestType:i}=t,r=Ge(t,[{[cn]:!0}]);if(r.error)return r;let n={};for(let a of Object.values(e)){let{extension:s}=mt({element:a,name:rv}),o=s?.value||[];for(let l of o){let{personId:u,requests:c}=l||{};n[u]||(n[u]=[]);for(let d of c)i&&d.requestType!==i||n[u].push(d)}}return{personRequests:n,...H}}function kO(t){let{containerStructureId:e,roundSegment:i,isRoundRobin:r,tournamentId:n,roundNumber:a,structureId:s,eventId:o,drawId:l}=t,u=r?e:s,c=[n,o,l,u,a].join("|");return Ve({structureId:u,roundSegment:i,tournamentId:n,roundNumber:a,eventId:o,drawId:l,id:c})}function mW({round:t,matchUps:e,events:i,tournamentRecords:r}){let n=i.find(p=>p.eventId===t.eventId),{eventType:a,category:s,categoryType:o}=n||{},{categoryName:l,ageCategoryCode:u}=s||{},c=va(e.map(({matchUpFormat:p})=>p)),d=0;return Object.keys(c).forEach(p=>{let f=c[p],m=fC({categoryName:l||u,tournamentId:t.tournamentId,eventId:t.eventId,tournamentRecords:r,matchUpFormat:p,categoryType:o,eventType:a});if(m.error)return m;let h=m.averageMinutes*f;isNaN(d)||(d+=h)}),{roundMinutes:d}}function aDe(t){return(t||[]).reduce((e,i)=>{let r=(i.finishingPositionRange?.winner||[]).reduce((a,s)=>a+s,0),n=(i.finishingPositionRange?.winner||[]).join("-")||"";return!e.minFinishingSum||r<e.minFinishingSum?{minFinishingSum:r,winnerFinishingPositionRange:n}:e},{minFinishingSum:0,winnerFinishingPositionRange:""})}function hW(t){let e=t.length,i=t.filter(({sides:u})=>u?.some(({bye:c})=>c)).length||0,r=t.filter(({winningSide:u,matchUpStatus:c})=>u||Yi.includes(c)).length||0,n=t.filter(({schedule:u,matchUpStatus:c})=>u?.scheduledDate&&u?.scheduledTime&&c!=="BYE").length||0,a=e-i,s=a===r,o=a-n,l=a-n;return{unscheduledCount:o,incompleteCount:l,scheduledCount:n,completedCount:r,matchUpsCount:e,isScheduled:a===n,isComplete:s,byeCount:i}}function hC({tournamentRecords:t,schedulingProfile:e,tournamentRecord:i,withRoundId:r}){if(i&&!t){if(typeof i!="object")return{error:Tw};t={[i.tournamentId]:i}}if(e){let a=mC({tournamentRecords:t,schedulingProfile:e});if(a.error)return a}if(!e&&t){let a=_c({tournamentRecords:t});if(a.error)return a;e=a.schedulingProfile}if(!e)return{error:_r};let n={};return{profileRounds:e.map(({venues:a,scheduleDate:s})=>a.map(({rounds:o})=>o.map(l=>{let u=kO(l);return u.roundSegment?.segmentsCount&&(n[u.id]=u.roundSegment.segmentsCount),Ve({id:r?u.id:void 0,scheduleDate:s,...u})}))).flat(1/0),segmentedRounds:n}}function bd({court:t,date:e}){let i=e&&t.dateAvailability?.find(n=>tu(n.date,e)),r=t.dateAvailability?.find(n=>!n.date);return i||r}function sDe({court:t,date:e}){let i=bd({court:t,date:e}),r=new Map,n=[];return(i?.bookings||[]).forEach(a=>{if(typeof a.courtOrder=="number"){let s=a.rowCount||1;for(let o=0;o<s;o++)r.set(a.courtOrder+o,a)}else n.push(a)}),{gridBookings:r,timeBookings:n}}function gC({courtPrefix:t="C|",minRowsCount:e,courtsData:i,scheduledDate:r}){if(!Array.isArray(i))return{error:ie};let n=i?.reduce((o,l)=>{let u=l.matchUps||[],c=Math.max(0,...u.map(d=>d.schedule.courtOrder||0));return Math.max(c,o)},1),a=Math.max(e||0,n),s=Re(0,a).map(o=>({matchUps:Re(0,i.length).map(l=>{let u=i[l],{courtId:c,venueId:d}=u;if(r){let{gridBookings:p}=sDe({court:u,date:r});if(p.has(o+1)){let f=p.get(o+1);return{schedule:{courtOrder:o+1,venueId:d,courtId:c},isBlocked:!0,booking:f}}}return{schedule:{courtOrder:o+1,venueId:d,courtId:c}}})}));return i.forEach((o,l)=>{for(let u of o.matchUps){let c=u.schedule?.courtOrder;c&&(s[c-1].matchUps[l]=u)}}),{courtPrefix:t,rows:s.map((o,l)=>Object.assign({rowId:`rowId-${l+1}`},...o.matchUps.map((u,c)=>({[`${t}${c}`]:u}))))}}var lX={};ct(lX,{getEntriesAndSeedsCount:()=>IC,getMaxEntryPosition:()=>z0});function IC({policyDefinitions:t,drawDefinition:e,drawSize:i,drawId:r,event:n,stage:a}){if(!n)return{error:li};let{entries:s,stageEntries:o}=v7({drawDefinition:e,drawId:r,stage:a,event:n}),l=o.length,{drawSize:u}=j8({participantsCount:l}),c=PS({drawSize:i??u,participantsCount:l,policyDefinitions:t});if(c.error)return z({result:c,stack:"getEntriesAndSeedsCount"});let{seedsCount:d}=c;return{entries:s,seedsCount:d,stageEntries:o}}function z0(t){let{entries:e=[],entryStatus:i,stage:r}=t;return Math.max(...e.filter(n=>(!r||r===n.entryStage)&&(!i||n.entryStatus===i)&&!isNaN(n.entryPosition)).map(({entryPosition:n})=>Ye(n||0)),0)}var uX={};ct(uX,{allCompetitionMatchUps:()=>Eo,allDrawMatchUps:()=>Rn,allEventMatchUps:()=>Ru,allTournamentMatchUps:()=>br,analyzeMatchUp:()=>Mb,calculateWinCriteria:()=>Dh,checkMatchUpIsComplete:()=>fp,competitionScheduleMatchUps:()=>NS,drawMatchUps:()=>r_,eventMatchUps:()=>yC,filterMatchUps:()=>Gu,getAllDrawMatchUps:()=>Qi,getAllStructureMatchUps:()=>Nt,getCheckedInParticipantIds:()=>mh,getCompetitionMatchUps:()=>Cb,getEventMatchUpFormatTiming:()=>Y0,getHomeParticipantId:()=>Q0,getMatchUpCompetitiveProfile:()=>iS,getMatchUpContextIds:()=>Z0,getMatchUpDailyLimits:()=>wC,getMatchUpDailyLimitsUpdate:()=>K0,getMatchUpDependencies:()=>oo,getMatchUpFormat:()=>e_,getMatchUpFormatTiming:()=>rS,getMatchUpFormatTimingUpdate:()=>q0,getMatchUpScheduleDetails:()=>CR,getMatchUpType:()=>MR,getMatchUpsStats:()=>t_,getModifiedMatchUpFormatTiming:()=>vC,getParticipantResults:()=>lS,getPredictiveAccuracy:()=>J0,getRoundMatchUps:()=>bn,getRounds:()=>i_,isValidMatchUpFormat:()=>xa,matchUpActions:()=>qR,participantScheduledMatchUps:()=>X0,tallyParticipantResults:()=>gh,tournamentMatchUps:()=>bC,validMatchUp:()=>UR,validMatchUps:()=>Ga});function cX({tournamentRecords:t,extensionName:e}){if(typeof t!="object"||!Object.keys(t).length)return{error:Ci};let i=[],r;for(let n of Object.values(t)){let{extension:a}=mt({element:n,name:e});a&&!r&&(i.push({params:{extension:a,discover:!0},method:"addExtension"}),r=!0);let s=n.events??[];for(let o of s){let{eventId:l}=o,{extension:u}=mt({name:e,element:o});u&&i.push({params:{eventId:l,extension:u},method:"addEventExtension"})}}return{methods:i}}function q0({tournamentRecords:t}){return cX({extensionName:cc,tournamentRecords:t})}var AA="ADULT",kA="JUNIOR",yT="WHEELCHAIR",oDe={[Fd]:{allowModificationWhenMatchUpsScheduled:{courts:!1,venues:!1},defaultTimes:{averageTimes:[{categoryNames:[],minutes:{default:90}}],recoveryTimes:[{minutes:{[$t]:30,default:60}}]},defaultDailyLimits:{[Wt]:2,[$t]:2,total:3},matchUpAverageTimes:[{matchUpFormatCodes:[Xu],averageTimes:[{categoryNames:[],minutes:{default:90}},{categoryTypes:[yT],minutes:{default:120}}]},{matchUpFormatCodes:["SET3-S:6/TB7-F:TB10"],averageTimes:[{categoryNames:[],minutes:{default:85}}]},{matchUpFormatCodes:["SET3-S:6/TB7-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:70}}]},{matchUpFormatCodes:["SET3-S:4NOAD-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:55}}]},{matchUpFormatCodes:["SET3-S:4/TB7"],averageTimes:[{categoryNames:[],minutes:{default:60}}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:50}}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB10"],averageTimes:[{categoryNames:[],minutes:{default:55}}]},{matchUpFormatCodes:["SET3-S:4/TB5@3"],averageTimes:[{categoryNames:[],minutes:{default:45}}]},{matchUpFormatCodes:["SET1-S:8/TB7","SET1-S:8/TB7@7"],averageTimes:[{categoryNames:[],minutes:{default:40}}]},{matchUpFormatCodes:["SET1-S:5/TB9@4"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:6/TB7"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:6NOAD"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:4/TB7","SET1-S:4/TB5@3","SET3-S:TB10","SET1-S:T20"],averageTimes:[{categoryNames:[],minutes:{default:20}}]},{matchUpFormatCodes:["SET1-S:4NOAD"],averageTimes:[{categoryNames:[],minutes:{default:20}}]},{matchUpFormatCodes:["SET1-S:TB10"],averageTimes:[{categoryNames:[],minutes:{default:10}}]}],matchUpRecoveryTimes:[{matchUpFormatCodes:["SET3-S:6/TB7","SET3-S:6/TB7-F:TB10","SET3-S:6/TB7-F:TB7"],recoveryTimes:[{categoryTypes:[AA,yT],minutes:{default:60,[$t]:30}},{categoryTypes:[kA],minutes:{default:60,[$t]:60}}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB7","SET3-S:4/TB7-F:TB10","SET3-S:4NOAD-F:TB7","SET3-S:4/TB7","SET3-S:4/TB5@3"],recoveryTimes:[{categoryTypes:[AA,yT],minutes:{default:30}},{categoryTypes:[kA],minutes:{default:60}}]},{matchUpFormatCodes:["SET1-S:8/TB7","SET1-S:8/TB7@7","SET1-S:5/TB9@4","SET1-S:6/TB7","SET1-S:6NOAD","SET1-S:4/TB7","SET1-S:4NOAD","SET3-S:TB10","SET1-S:T20"],recoveryTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:4/TB5@3"],recoveryTimes:[{categoryTypes:[AA,kA],minutes:{default:30}},{categoryTypes:[yT],minutes:{default:15}}]},{matchUpFormatCodes:["SET1-S:TB10"],recoveryTimes:[{categoryNames:[],minutes:{default:15}}]}],matchUpDailyLimits:[]}},lDe=oDe;function Y0({tournamentRecord:t,matchUpFormats:e,categoryType:i,event:r}){if(!r)return{error:li};let n,a;if(e?.length){let d=[];n=e.map(p=>{let f=typeof p=="string"?{matchUpFormat:p}:p;if(!d.includes(f?.matchUpFormat)&&xa({matchUpFormat:f?.matchUpFormat}))return d.push(f.matchUpFormat),f}).filter(Boolean)}else{let{policy:d}=af({policyType:Po,tournamentRecord:t,event:r});if(d?.matchUpFormats)n=d?.matchUpFormats;else{let{extension:p}=mt({name:cc,element:r}),f,m;p?.value?{matchUpAverageTimes:f,matchUpRecoveryTimes:m}=p.value:{matchUpAverageTimes:f,matchUpRecoveryTimes:m}=lDe[Fd],n=rt([...(f||[]).map(h=>h.matchUpFormatCodes),...(m||[]).map(h=>h.matchUpFormatCodes)].flat()).map(h=>({matchUpFormat:h})),a="default scheduling policy in use"}}let{eventType:s,eventId:o,category:l}=r,u=l?.categoryName??l?.ageCategoryCode??o;if(!o)return{error:li};let c=n.map(({matchUpFormat:d,description:p})=>{let f=rS({tournamentRecord:t,matchUpFormat:d,categoryName:u,categoryType:i,eventType:s,event:r});return{matchUpFormat:d,description:p,...f}});return Ve({eventMatchUpFormatTiming:c,info:a})}function vC(t){let e=Ge(t,[{[mr]:!0},{[Wr]:h=>xa({matchUpFormat:h}),[Fa]:Rw,[hF]:!0}]);if(e.error)return e;let{tournamentRecord:i,matchUpFormat:r,event:n}=t,{extension:a}=mt({name:cc,element:n}),s=a?.value,{extension:o}=mt({element:i,name:cc}),l=o?.value,u=s?.matchUpAverageTimes&&Oy({...s,matchUpFormat:r}),c=l?.matchUpAverageTimes&&Oy({...l,matchUpFormat:r}),d=[u,c].find(h=>h),p=s?.matchUpRecoveryTimes&&xy({...s,matchUpFormat:r}),f=l?.matchUpRecoveryTimes&&xy({...l,matchUpFormat:r}),m=[p,f].find(h=>h);return{matchUpFormat:r,recoveryTimes:m,averageTimes:d}}function K0({tournamentRecords:t}){return cX({extensionName:jw,tournamentRecords:t})}var MS=({scheduleAttributes:t=["scheduledDate","scheduledTime"],schedule:e={}})=>!!Object.keys(e).filter(i=>t.includes(i)).filter(i=>e[i]).length;function X0({scheduleAttributes:t=["scheduledDate","scheduledTime"],matchUps:e=[]}){if(!Ga(e))return{error:Tu};if(!Array.isArray(t))return{error:ie};let i=e.filter(Boolean).filter(({schedule:r})=>MS({schedule:r,scheduleAttributes:t})).reduce((r,n)=>{let{schedule:a}=n,s=Qe(a?.scheduledDate),o=ci(a?.scheduledTime);return s&&o&&(r[s]?r[s].push(n):r[s]=[n]),r},{});return Object.keys(i).forEach(r=>{i[r].sort((n,a)=>k4(ci(n.schedule?.scheduledTime),ci(a.schedule?.scheduledTime)))}),{...H,scheduledMatchUps:i}}function uDe({tournamentRecords:t}){let e={},i=[];for(let r of Object.values(t))for(let n of r.events??[]){let a=za({event:n}),s=a?.drawDetails;bt(s)?(Object.assign(e,s),i.push(...Object.keys(s).filter(o=>dL({drawId:o,drawDetails:s})))):a?.drawIds?.length&&i.push(...a.drawIds)}return{drawIds:i,detailsMap:e}}function aP({schedulingProfile:t,matchUps:e=[]}){let i={},r=({eventId:o,drawId:l,structureId:u,roundNumber:c})=>`${o}|${l}|${u}${c}`;t?.length&&t.flatMap(({venues:o})=>o.map(({rounds:l})=>l)).forEach(o=>{o.sort((l,u)=>(l.sortOrder||0)-(u.sortOrder||0)).forEach(({eventId:l,drawId:u,structureId:c,roundNumber:d},p)=>{let f=r({eventId:l,drawId:u,structureId:c,roundNumber:d});i[f]=p})});let n=[],a={noScheduledDate:[]};for(let o of e){let l=o.schedule||{},u=l.scheduledDate&&Qe(l.scheduledDate)||l.scheduledTime&&Qe(l.scheduledTime)||"noScheduledDate";a[u]||(a[u]=[]),a[u].push(o)}let s=Object.keys(a).sort((o,l)=>o.localeCompare(l));for(let o of s){let l=a[o],u={noScheduledTime:[]};for(let d of l){let p=d.schedule||{},f=p.scheduledTime&&ci(p.scheduledTime)||"noScheduledTime";u[f]||(u[f]=[]),u[f].push(d)}for(let d of Object.keys(u)){let p=u[d].sort((f,m)=>(f.roundNumber||0)-(m.roundNumber||0));u[d]=p}let c=Object.keys(u).sort((d,p)=>d.localeCompare(p));for(let d of c){let p=u[d];p.sort((f,m)=>{let h=i[r(f)]||0,g=i[r(m)]||0;return h-g}),n.push(...p)}}return n}function yC(t){let{participants:e,contextContent:i,participantMap:r}=t,{tournamentAppliedPolicies:n,scheduleVisibilityFilters:a,participantsProfile:s,afterRecoveryTimes:o,policyDefinitions:l,useParticipantMap:u,tournamentRecord:c,usePublishState:d,contextFilters:p,matchUpFilters:f,contextProfile:m,nextMatchUps:h,tournamentId:g,inContext:I,context:v,event:w}=t;if(!w)return{error:li};let{eventId:y,eventName:b,endDate:S,eventType:U,category:T,gender:P}=w??{},D={...v,...Ve({surfaceCategory:w.surfaceCategory??c?.surfaceCategory,indoorOutDoor:w.indoorOutdoor??c?.indoorOutdoor,tournamentId:g??c?.tournamentId,endDate:S??c?.endDate,eventName:b,eventType:U,category:T,eventId:y,gender:P})},E;!e&&c&&({participants:e,participantMap:r,groupInfo:E}=nf({participantsProfile:s,useParticipantMap:u,tournamentRecord:c,contextProfile:m,inContext:I})),m&&!i&&(i=Fc({policyDefinitions:l,tournamentRecord:c,contextProfile:m,event:w}));let R=za({event:w});return{...(w.drawDefinitions??[]).reduce((C,M)=>{let N=ov({hydrateParticipants:t.hydrateParticipants,context:D,tournamentAppliedPolicies:n,scheduleVisibilityFilters:a,tournamentParticipants:e,participantsProfile:s,afterRecoveryTimes:o,policyDefinitions:l,tournamentRecord:c,usePublishState:d,contextContent:i,contextFilters:p,matchUpFilters:f,participantMap:r,publishStatus:R,contextProfile:m,drawDefinition:M,nextMatchUps:h,inContext:I,event:w});return Object.keys(N)?.forEach(A=>{Array.isArray(N[A])&&(C[A]||(C[A]=[]),C[A]=C[A].concat(N[A]))}),C},{}),...H,groupInfo:E}}function bC(t){if(!t?.tournamentRecord)return{error:Ie};let e=t.contextContent,{scheduleVisibilityFilters:i,participantsProfile:r,afterRecoveryTimes:n,policyDefinitions:a,tournamentRecord:s,inContext:o=!0,usePublishState:l,contextFilters:u,matchUpFilters:c,contextProfile:d,nextMatchUps:p,context:f}=t,m=t.tournamentId??s.tournamentId,h=s?.events??[],{participants:g,participantMap:I,groupInfo:v}=nf({participantsProfile:r,tournamentRecord:s,contextProfile:d,inContext:o});d&&!e&&(e=Fc({policyDefinitions:a,tournamentRecord:s,contextProfile:d}));let{appliedPolicies:w}=Tt({tournamentRecord:s}),y=u?.eventIds??[];return{...h.filter(b=>!y.includes(b.eventId)).map(b=>{let S={eventDrawsCount:$i({event:b}).flightProfile?.flights?.length||b.drawDefinitions?.length||0,...f};return yC({hydrateParticipants:t.hydrateParticipants,context:S,tournamentAppliedPolicies:w,scheduleVisibilityFilters:i,participantsProfile:r,afterRecoveryTimes:n,policyDefinitions:a,tournamentRecord:s,usePublishState:l,contextFilters:u,contextProfile:d,contextContent:e,matchUpFilters:c,participantMap:I,participants:g,tournamentId:m,nextMatchUps:p,inContext:o,event:b})}).reduce((b,S)=>((S&&Object.keys(S).filter(U=>!["success","matchUpsMap"].includes(U)))?.forEach(U=>{Array.isArray(S[U])&&(b[U]||(b[U]=[]),b[U]=b[U].concat(S[U]),b.matchUpsCount!==void 0?b.matchUpsCount+=S[U].length:b.matchUpsCount=S[U].length)}),b),{matchUpsCount:0}),groupInfo:v,participants:g}}function Cb({scheduleVisibilityFilters:t,hydrateParticipants:e,participantsProfile:i,tournamentRecords:r,useParticipantMap:n,policyDefinitions:a,usePublishState:s,matchUpFilters:o,contextFilters:l,nextMatchUps:u,inContext:c}){if(typeof r!="object"||!Object.keys(r).length)return{error:Ci};let d=Object.keys(r).map(m=>{let h=r[m];return bC({scheduleVisibilityFilters:t,hydrateParticipants:e,participantsProfile:i,policyDefinitions:a,tournamentRecord:h,usePublishState:s,matchUpFilters:o,contextFilters:l,nextMatchUps:u,inContext:c})}),p={},f={};return{...d.reduce((m,h)=>(Object.keys(h).forEach(g=>{if(g==="groupInfo")Object.assign(f,h[g]);else if(g==="participants")for(let I of h[g]??[])p[I.participantId]=I;else Array.isArray(h[g])&&(m[g]||(m[g]=[]),m[g]=m[g].concat(h[g]))}),m),{}),groupInfo:f,mappedParticipants:p}}function NS(t){if(typeof t?.tournamentRecords!="object"||!Object.keys(t?.tournamentRecords).length)return{error:Ci};let{courts:e,venues:i}=Cu(t),r=_c(t).schedulingProfile,{sortDateMatchUps:n=!0,courtCompletedMatchUps:a,alwaysReturnCompleted:s,activeTournamentId:o,tournamentRecords:l,withCourtGridRows:u,minCourtGridRows:c,usePublishState:d,status:p=Ha,sortCourtsData:f}=t,m=o??rh()??Object.keys(l)[0],h=d?uS({tournamentRecord:l[m],status:p}):void 0,g=s?Cb({...t,matchUpFilters:{...t.matchUpFilters,matchUpStatuses:[ki]},contextFilters:t.contextFilters}).completedMatchUps:[];if(d&&!Bo(h?.orderOfPlay))return{completedMatchUps:g,dateMatchUps:[],courtsData:[],venues:i};let I,v;d&&({drawIds:I,detailsMap:v}=uDe({tournamentRecords:l})),I?.length&&(t.contextFilters??={},t.contextFilters.drawIds?t.contextFilters.drawIds=t.contextFilters.drawIds.filter(M=>I.includes(M)):t.contextFilters.drawIds=I),h?.eventIds?.length&&(t.matchUpFilters??={},t.matchUpFilters?.eventIds&&t.matchUpFilters.eventIds.length?t.matchUpFilters.eventIds=t.matchUpFilters.eventIds.filter(M=>h.eventIds.includes(M)):t.matchUpFilters.eventIds=h.eventIds),h?.scheduledDates?.length&&(t.matchUpFilters??={},t.matchUpFilters.scheduledDates&&t.matchUpFilters.scheduledDates.length?t.matchUpFilters.scheduledDates=t.matchUpFilters.scheduledDates.filter(M=>h.scheduledDates.includes(M)):t.matchUpFilters.scheduledDates=h.scheduledDates),s&&(t.matchUpFilters??={},t.matchUpFilters?.excludeMatchUpStatuses?.length?t.matchUpFilters.excludeMatchUpStatuses.includes(ki)||t.matchUpFilters.excludeMatchUpStatuses.push(ki):t.matchUpFilters.excludeMatchUpStatuses=[ki]);let{completedMatchUps:w,upcomingMatchUps:y,pendingMatchUps:b,abandonedMatchUps:S,groupInfo:U,mappedParticipants:T}=Cb({...t,matchUpFilters:t.matchUpFilters,contextFilters:t.contextFilters}),P=[...y??[],...b??[]];v&&(!I?.length||Object.keys(v).length)&&(P=P.filter(M=>{let{drawId:N,structureId:A,stage:O}=M;if(!Bo(v?.[N]?.publishingDetail))return!1;let k=Object.keys(v[N].stageDetails??{});if(k.length){let x=k.filter($=>!Bo(v[N].stageDetails[$])),L=k.filter($=>Bo(v[N].stageDetails[$]));return x.length&&x.includes(O)?!1:L.length&&L.includes(O)?!0:x.length&&!x.includes(O)&&!L.length}let F=Object.keys(v[N].structureDetails??{});if(F.length){let x=F.filter($=>!Bo(v[N].structureDetails[$])),L=F.filter($=>Bo(v[N].structureDetails[$]));return x.length&&x.includes(A)?!1:L.length&&L.includes(A)?!0:x.length&&!x.includes(A)&&!L.length}return!0})),v&&d&&(P=P.filter(M=>{let{drawId:N,structureId:A,roundNumber:O}=M;if(!ot(O))return!0;let k=v[N]?.structureDetails?.[A];if(!k)return!0;let{scheduledRounds:F,roundLimit:x}=k;if(ot(x)&&O>x)return!1;if(F){let L=F[O];return L?Bo(L):!1}return!0}));let D=n?aP({matchUps:P,schedulingProfile:r}):P,E=e?.map(M=>{let N=C(M);return{surfaceCategory:M?.surfaceCategory??"",matchUps:N,...M}}),R={completedMatchUps:s?g:w,mappedParticipants:t.hydrateParticipants?void 0:T,dateMatchUps:D,courtsData:E,groupInfo:U,venues:i};if(u){let M=t.matchUpFilters?.scheduledDate,{rows:N,courtPrefix:A}=gC({minRowsCount:Math.max(c||0,D.length||0),scheduledDate:M,courtsData:E});R.courtPrefix=A,R.rows=N}return{...R,...H};function C({courtId:M}){let N=(a?D.concat(w??[],S??[]):D).filter(A=>A.schedule?.courtId===M||A.schedule?.allocatedCourts?.map(({courtId:O})=>O).includes(M));return f?aP({matchUps:N,schedulingProfile:r}):N}}function wC({tournamentRecords:t,tournamentId:e}){if(typeof t!="object"||!Object.keys(t).length)return{error:Ci};let i=Object.keys(t).filter(n=>!e||n===e),r;return i.forEach(n=>{let a=t[n],{matchUpDailyLimits:s}=cDe({tournamentRecord:a});r=s}),{matchUpDailyLimits:r}}function cDe(t){let e=Ge(t,[{[mr]:!0}]);if(e.error)return e;let{tournamentRecord:i}=t,{policy:r}=af({policyType:Fd,tournamentRecord:i}),{extension:n}=mt({element:i,name:jw}),a=n?.value?.dailyLimits,s=r?.defaultDailyLimits;return{matchUpDailyLimits:a||s}}function J0(t){let{matchUps:e}=t,{singlesForDoubles:i,tournamentRecord:r,drawDefinition:n,excludeMargin:a,exclusionRule:s,zoneDoubling:o,matchUpType:l,scaleName:u,eventId:c,zonePct:d,drawId:p,event:f}=t;if(!r&&!e)return{error:Ie};if(l&&![Wt,$t].includes(l))return{error:ie,info:{matchUpType:l}};if(e&&!Ga(e))return{error:ie,context:{matchUps:e}};let m=xr[u],h=m?.ascending??t.ascending??!1,g=m?.accessor??t.valueAccessor,I=Array.isArray(m?.range)?Math.abs(m.range[0]-m.range[1]):0,v=ot(d)&&I?(d??0/100)*I:t.zoneMargin??I,w={withScaleValues:!0,withCompetitiveness:!0},y={matchUpTypes:l?[l]:[Wt,$t]},b=r?.participants;e?.[0]?.hasContext?p?e=e.filter(M=>M.drawId===p):c&&(e=e.filter(M=>M.eventId===c)):e??=p&&!n&&[]||!p&&c&&!f&&[]||p&&Rn({inContext:!0,drawDefinition:n,contextFilters:y,contextProfile:w,participants:b})?.matchUps||!p&&c&&Ru({inContext:!0,contextFilters:y,contextProfile:w,participants:b,event:f})?.matchUps||br({tournamentRecord:r,contextFilters:y,contextProfile:w})?.matchUps||[],l&&(e=e.filter(M=>M.matchUpType===l));let S=e.filter(({winningSide:M,score:N,sides:A,matchUpStatus:O})=>![$r,Qt,mi,nv,us].includes(O??"")&&cr({score:N})&&A?.length===2&&M),U=pDe({matchUps:S,excludeMargin:a,exclusionRule:s,valueAccessor:g,ascending:h,scaleName:u}),T=!o||Di(Wt)(l)?v:(v||0)*2,P=v?S.map(({competitiveProfile:M,matchUpType:N,score:A,sides:O})=>{let k=dX({singlesForDoubles:i,valueAccessor:g,matchUpType:N,scaleName:u,sides:O}),F=Math.abs(k[0].value-k[1].value);return{competitiveness:M?.competitiveness,valuesGap:F,score:A}}).filter(({valuesGap:M})=>M<=T):[],D=dDe({zoneData:P}),E=D&&Object.values(D).flat().length,R=E&&Object.assign({},...Object.keys(D).map(M=>({[M]:Math.round(1e4*D[M].length/E)/100}))),C=S.length-(P?.length||0);return{...H,relevantMatchUps:S,zoneDistribution:R,zoneData:P,accuracy:U,nonZone:C}}function dDe({zoneData:t}){let e={[qF]:[],[Ub]:[],[Tb]:[]};for(let i of t){let{competitiveness:r,score:n,valuesGap:a}=i;e[r]&&e[r].push({score:n,valuesGap:a})}return e}function dX({singlesForDoubles:t,exclusionRule:e,valueAccessor:i,matchUpType:r,scaleName:n,sides:a}){let s=e?.range.sort(),o=l=>{let u=l?.[e?.valueAccessor];return{exclude:e&&u>=s[0]&&u<=s[1],exclusionValue:u}};return a.sort((l,u)=>l.sideNumber-u.sideNumber).map(({participant:l})=>{let u=[],c=l?.individualParticipants;if(c?.length){let d=[],p=0;for(let f of c){let{scaleValue:m,value:h}=gW({singlesForDoubles:t,valueAccessor:i,participant:f,matchUpType:r,scaleName:n}),{exclude:g,exclusionValue:I}=o(m);g&&u.push(I),d.push(m),h&&!Number.isNaN(Number(p))?p+=h:p=void 0}return{participantName:l.participantName,exclusionValues:u,scaleValues:d,value:p}}else if(l){let{scaleValue:d,value:p}=gW({singlesForDoubles:t,valueAccessor:i,matchUpType:r,participant:l,scaleName:n}),{exclude:f,exclusionValue:m}=o(d);return f&&u.push(m),{participantName:l.participantName,exclusionValues:u,scaleValue:d,value:p}}else return{}})}function gW({singlesForDoubles:t,valueAccessor:e,matchUpType:i,participant:r,scaleName:n}){let a=t?Wt:i,s=r?.rankings?.[a]?.find(u=>u.scaleName===n),o=(r?.ratings?.[a]?.find(u=>u.scaleName===n)||s)?.scaleValue,l=e?o?.[e]:o;return{scaleValue:o,value:l}}function pDe({excludeMargin:t,exclusionRule:e,valueAccessor:i,ascending:r,scaleName:n,matchUps:a}){let s={affirmative:[],negative:[],excluded:[]};for(let u of a)fDe({matchUp:u,accuracy:s,excludeMargin:t,exclusionRule:e,valueAccessor:i,ascending:r,scaleName:n});let o=s.affirmative.length+s.negative.length,l=o&&s.affirmative.length/o*100;return s.percent=l?Math.round(100*l)/100:0,s}function fDe({matchUp:t,accuracy:e,excludeMargin:i,exclusionRule:r,valueAccessor:n,ascending:a,scaleName:s}){let{matchUpType:o,sides:l,score:u,winningSide:c}=t;if(!c)return;if(r&&(!r.valueAccessor||!r.range)){e.error={info:"exclusionRule requires valueAccessor and range",error:Xe};return}let d=c-1,p=dX({exclusionRule:r,valueAccessor:n,matchUpType:o,scaleName:s,sides:l});if(mDe({exclusionRule:r,sideValues:p,accuracy:e,score:u,winningSide:c}))return;if(hDe(p)){e.excluded.push({scoreString:u?.scoreStringSide1,missingValues:!0,winningSide:c,sideValues:p});return}let f=p[d].value-p[1-d].value;if(gDe({excludeMargin:i,valuesGap:f})){e.excluded.push({scoreString:u?.scoreStringSide1,excludeMargin:i,winningSide:c,excludeGap:!0,sideValues:p,valuesGap:f});return}let m=a?f:f*-1,h=c===1?u?.scoreStringSide1:u?.scoreStringSide2;m>0?e.affirmative.push({winningScoreString:h,winningSide:c,sideValues:p,valuesGap:f,score:u}):e.negative.push({winningScoreString:h,winningSide:c,sideValues:p,valuesGap:f,score:u})}function mDe({exclusionRule:t,sideValues:e,accuracy:i,score:r,winningSide:n}){if(t){let a=e.flatMap(({exclusionValues:s})=>s);if(a.length)return i.excluded.push({scoreString:r?.scoreStringSide1,exclusionValues:a,winningSide:n,sideValues:e}),!0}return!1}function hDe(t){return t.filter(e=>![void 0,"",null].includes(e.value)).length<2}function gDe({excludeMargin:t,valuesGap:e}){let i=Number.parseFloat(t||0);return i&&Math.abs(e)<i}function Dh({collectionDefinitions:t=[],collectionGroups:e=[]}){let i=0,{groupValueNumbers:r}=d8({collectionGroups:e}),n;for(let a of t||[]){let{collectionValueProfiles:s,collectionGroupNumber:o,collectionValue:l,matchUpCount:u,matchUpValue:c,scoreValue:d,setValue:p}=a,f=o&&r.includes(o);if(ot(p||d))n=!0;else{if(f)continue;if(typeof l=="number"&&ot(l))i+=l;else if(Array.isArray(s)&&s?.length)for(let m of s)i+=m.matchUpValue;else typeof c=="number"&&ot(c)&&(i+=(u??0)*c)}}for(let a of e)i+=a.groupValue??0;return n||!i?{aggregateValue:!0,...H}:{valueGoal:Math.floor(i/2)+1,...H}}function Q0(t){let{timeStamp:e,schedule:i,matchUp:r}=t,n=Ge(t,[{[Du]:!0}]);if(n.error)return n;let{itemValue:a,timeStamp:s}=lf({timeItems:r?.timeItems||[],itemType:QF});return!i||s&&e&&new Date(s).getTime()>new Date(e).getTime()?{homeParticipantId:a}:i}function Z0({matchUps:t,matchUpId:e}){if(!Ga(t))return{error:ie};let i=t.find(o=>o.matchUpId===e),{drawId:r,eventId:n,structureId:a,tournamentId:s}=i||{};return{matchUpId:e,drawId:r,eventId:n,structureId:a,tournamentId:s}}function Iv(t,e){if(!bt(t))return{error:ie};if(!Array.isArray(e))return{error:ie};let i={};for(let{param:r,error:n,attr:a}of e){let s=IDe({params:t,param:r,attr:a,error:n});if(s?.error)return s;i[r]=s}return i}function IDe({params:t,param:e,attr:i,error:r}){if(e===uR&&bt(t.drawDefinition)&&ri(t.structureId)){let n=(t.drawDefinition.structures??[]).find(({structureId:a})=>a===t.structureId);return!n.length&&r?{error:r}:{structure:n}}if(e===Du){let n=nX({...t,...i});return n.error&&r?{...n,error:r}:n}return{error:_r,info:{param:e}}}function e_(t){let{structureId:e,matchUpId:i,event:r}=t,n=t.drawDefinition,a=Ge(t,[{[mr]:!0},{[bF]:{[sR]:!1,[Ul]:!1,[A5]:!1,[Ac]:!1}}]);if(a[xs])return a;let s=Iv(t,[{[tv]:Du,[xs]:Xe}])?.matchUp;if(i&&s?.error)return s;!n&&s?.drawDefinition&&(n=s?.drawDefinition);let o=s?.structure;if(!o&&e&&!i){if(!n)return{error:Oo};let p=et({drawDefinition:n,structureId:e});if(p.error)return p;o=p.structure}let l=o?.matchUpFormat,u=n?.matchUpFormat,c=r?.matchUpFormat,d=s?.matchUp?.matchUpFormat||l||u||c;return{structureDefaultMatchUpFormat:l,eventDefaultMatchUpFormat:c,drawDefaultMatchUpFormat:u,matchUpFormat:d}}function t_({profileBands:t,tournamentRecord:e,matchUps:i}){if(!Ga(i))return{error:Tu};let r=!t&&af({policyType:ju,tournamentRecord:e}).policy,n=t||r?.profileBands||YF[ju].profileBands,a=i.filter(({winningSide:p})=>p),s=a.map(wK),o=(p,f)=>{let m=bK(f,n);return p[m]+=1,p},l=SK(s).reduce((p,f)=>o(p,f),{[qF]:0,[Ub]:0,[Tb]:0,[fK]:0}),u=Object.keys(l).reduce((p,f)=>(l[f]||0)+p,0),c=Object.keys(l).map(p=>{let f=Number.parseFloat((l[p]/u).toFixed(4));return{[p]:f*100}}),d=a.filter(({matchUpStatus:p})=>p===kH).length;return c.push({[kH]:Number.parseFloat((d/u).toFixed(4))*100}),{competitiveBands:Object.assign({},...c),...H}}var{stageOrder:IW}=nge;function vDe(t,e){return t.eventName.localeCompare(e.eventName)||t.eventId.localeCompare(e.eventId)||(IW[t?.stage]||0)-(IW[e?.stage]||0)||e.matchUpsCount-t.matchUpsCount||`${t.stageSequence}-${t.roundNumber}-${t.minFinishingSum}`.localeCompare(`${e.stageSequence}-${e.roundNumber}-${e.minFinishingSum}`)}function i_({excludeScheduleDateProfileRounds:t,excludeScheduledRounds:e,excludeCompletedRounds:i,inContextMatchUps:r,tournamentRecords:n,schedulingProfile:a,tournamentRecord:s,withSplitRounds:o,matchUpFilters:l,scheduleDate:u,withRoundId:c,venueId:d,context:p}){if(r&&!Array.isArray(r||typeof r[0]!="object"))return{error:ie,inContextMatchUps:r};if(s&&!n){if(typeof s!="object")return{error:Tw};n={[s.tournamentId]:s}}let f=typeof n!="object"||!Object.keys(n).length;if((d||u||!r||!a&&(t||i||a||o))&&f)return{error:Ci};let m=Object.assign({},...Object.values(n??{}).map(({venues:S=[],tournamentId:U})=>({[U]:S?.map(({venueId:T})=>T)}))),h=Object.values(n??{}).map(({events:S=[],tournamentId:U,startDate:T,endDate:P})=>S.map(D=>({...D,validVenueIds:m[U],startDate:D.startDate??T,endDate:D.endDate??P}))).flat(),{segmentedRounds:g,profileRounds:I}=n&&(t||i||a||o)&&hC({tournamentRecords:n,schedulingProfile:a})||{},v=t&&Object.assign({},...I.map(S=>({[S.id]:S}))),w=r||n&&Eo({tournamentRecords:n,matchUpFilters:l})?.matchUps||[],y=[],b=w&&Object.values(w.reduce((S,U)=>{let T=kO(U).id,P=g?.[T],D=[...S[T]?.matchUps??[],U],{containerStructureId:E,stageSequence:R,structureName:C,tournamentId:M,isRoundRobin:N,matchUpType:A,roundNumber:O,roundOffset:k,structureId:F,eventName:x,roundName:L,drawName:$,eventId:V,drawId:_}=U,B=N?E:F;return{...S,[T]:{id:c?T:void 0,structureId:B,stageSequence:R,segmentsCount:P,structureName:C,tournamentId:M,matchUpType:A,roundNumber:O,roundOffset:k,eventName:x,roundName:L,drawName:$,matchUps:D,eventId:V,drawId:_}}},{})).map(S=>{let{minFinishingSum:U,winnerFinishingPositionRange:T}=aDe(S.matchUps),P=S.segmentsCount;if(P){let O=S.matchUps.length/P;return yr(S.matchUps.sort((k,F)=>k.roundPosition-F.roundPosition),O).map((k,F)=>{let{unscheduledCount:x,incompleteCount:L,matchUpsCount:$,isScheduled:V,isComplete:_,byeCount:B}=hW(k),G=mW({matchUps:S.matchUps,tournamentRecords:n,events:h,round:S});return Ve({...S,...p,roundSegment:{segmentsCount:P,segmentNumber:F+1},winnerFinishingPositionRange:T,unscheduledCount:x,incompleteCount:L,minFinishingSum:U,matchUpsCount:$,isScheduled:V,roundTiming:G,isComplete:_,byeCount:B,matchUps:k})})}let{unscheduledCount:D,incompleteCount:E,matchUpsCount:R,isScheduled:C,isComplete:M,byeCount:N}=hW(S.matchUps),A=mW({matchUps:S.matchUps,tournamentRecords:n,events:h,round:S});return Ve({...S,...p,winnerFinishingPositionRange:T,unscheduledCount:D,incompleteCount:E,minFinishingSum:U,matchUpsCount:R,isScheduled:C,roundTiming:A,isComplete:M,byeCount:N})}).flat().filter(S=>{if(t){let F=Qe(t),x=c?S.id:kO(S).id;if(F&&v[x]&&Qe(v[x].scheduleDate)===F)return!1}let{isComplete:U,isScheduled:T}=S,P=!i||!U,D=!e||!T,E=d||u?h?.find(({eventId:F})=>F===S.eventId):void 0,R=E?.startDate??s?.startDate,C=E?.endDate??s?.endDate,M=!u||!R||new Date(u)>=new Date(R),N=!u||!C||new Date(u)<=new Date(C),A=M&&N,O=!d||E?.validVenueIds.includes(d),k=P&&D&&O&&A;return k||y.push(S),k}).sort(vDe)||[];return{...H,rounds:b,excludedRounds:y}}function Mb(t){let{matchUp:e,sideNumber:i,setNumber:r,isTiebreakValue:n,isPointValue:a}=t||{},{matchUpFormat:s}=t||{};if(!e)return{error:ea};s=s||e?.matchUpFormat;let o=zi(s),l=!!e?.winningSide,u=e.score?.sets,c=u?.length,d=r&&r-1,p=!!u?.find((B,G)=>B.setNumber===r&&G===d),f=u?.filter(B=>B?.winningSide)||[],m=f?.length||0,h=r&&u?.slice(r)||[],g=!!(c&&r&&h?.reduce((B,G)=>(!G||!G.side1Score&&!G.side2Score&&!G.side1TiebreakScore&&!G.side2TiebreakScore&&!G.side1PointScore&&!G.side2PointScore)&&B,!0)),I=r<=c&&u.find(B=>B.setNumber===r),v=I&&Rb({setObject:I,matchUpScoringFormat:o}),{isCompletedSet:w,sideGameScores:y,sideTiebreakScores:b}=v||{},S=!!(I&&!w&&g||r&&r===c+1&&!l),U=[1,2].includes(i),T=U?i-1:0,P=I&&U&&(!n&&!a&&y[T]!==void 0&&y[T]||n&&b[T]!==void 0&&b[T]),D=!!P,E=f?.map(B=>Rb({setObject:B,matchUpScoringFormat:o}).isValidSetOutcome).reduce((B,G)=>B&&G,!0),R=f.reduce((B,G)=>{let{winningSide:j}=G,K=j-1;return B[K]++,B},[0,0]),C=e?.winningSide,M=C&&C-1,N=1-M,A=R[M],O=R[N],k=Math.max(...R),F=va(R)[k],{bestOf:x,exactly:L}=o??{},$=Math.ceil((x||L||1)/2),V=k===$&&F===1&&R.indexOf(k)+1||void 0,_=A>O&&C===V;return{completedSetsHaveValidOutcomes:E,validMatchUpWinningSide:_,calculatedWinningSide:V,matchUpScoringFormat:o,validMatchUpOutcome:V&&E&&_,isLastSetWithValues:g,completedSetsCount:m,isCompletedMatchUp:l,isValidSideNumber:U,hasExistingValue:D,existingValue:P,isExistingSet:p,isActiveSet:S,...v}}function r_({participants:t,tournamentAppliedPolicies:e,scheduleVisibilityFilters:i,participantsProfile:r,afterRecoveryTimes:n,policyDefinitions:a,useParticipantMap:s,tournamentRecord:o,usePublishState:l,contextFilters:u,contextContent:c,matchUpFilters:d,participantMap:p,publishStatus:f,contextProfile:m,drawDefinition:h,nextMatchUps:g,tournamentId:I,inContext:v,context:w,event:y}){let{eventId:b,eventName:S,endDate:U,eventType:T,category:P,gender:D}=y??{},E={...w,...Ve({surfaceCategory:y?.surfaceCategory??o?.surfaceCategory,indoorOutDoor:y?.indoorOutdoor??o?.indoorOutdoor,endDate:U??y?.endDate??o?.endDate,tournamentId:I??o?.tournamentId,eventName:S,eventType:T,category:P,eventId:b,gender:D})},R;return!t?.length&&o&&({participants:t,participantMap:p,groupInfo:R}=nf({participantsProfile:r,useParticipantMap:s,tournamentRecord:o,contextProfile:m,inContext:v})),y&&m&&!c&&(c=Fc({policyDefinitions:a,tournamentRecord:o,contextProfile:m,drawDefinition:h,event:y})),{...ov({context:E,tournamentAppliedPolicies:e,scheduleVisibilityFilters:i,tournamentParticipants:t,participantsProfile:r,afterRecoveryTimes:n,policyDefinitions:a,tournamentRecord:o,usePublishState:l,participantMap:p,contextContent:c,contextFilters:u,matchUpFilters:d,publishStatus:f,contextProfile:m,drawDefinition:h,nextMatchUps:g,inContext:v,event:y}),groupInfo:R}}var pX={};ct(pX,{getCompetitionVenues:()=>US,getCourts:()=>n_,getVenuesAndCourts:()=>Cu,publicFindVenue:()=>iL});function n_({tournamentRecord:t,venueId:e,venueIds:i}){return t?{courts:(t.venues||[]).filter(r=>e?r.venueId===e:i?i.includes(r.venueId):!0).map(r=>{let{venueId:n}=r,a=ke(r.courts||[]);return a.forEach(s=>Object.assign(s,{venueId:n})),a}).flat()}:{error:Ie}}var fX={};ct(fX,{categoryCanContain:()=>Ow,getCategoryAgeDetails:()=>Up,getEvent:()=>o_,getEventProperties:()=>a_,getEventStructures:()=>FR,getEventTimeItem:()=>qw,getEvents:()=>s_,getFlightProfile:()=>$i,getScaledEntries:()=>Th});function a_({tournamentRecord:t,event:e}){if(!t)return{error:Ie};if(!e)return{error:li};let i=e.entries||[],r=t.participants||[],n=e.category?.categoryName||e.category?.ageCategoryCode,{eventType:a}=e,s=new Set(i.map(d=>d.participantId)),o=r.filter(d=>s.has(d.participantId)),l,u,c;return{entryScaleAttributes:o.map(d=>{let{participantId:p,participantName:f,name:m}=d,h={scaleType:eL,eventType:a,scaleName:n},g=Hl({participant:d,scaleAttributes:h})?.scaleItem?.scaleValue;h={scaleType:NK,eventType:a,scaleName:n};let I=Hl({participant:d,scaleAttributes:h})?.scaleItem?.scaleValue;h={scaleType:MK,eventType:a,scaleName:n};let v=Hl({participant:d,scaleAttributes:h})?.scaleItem?.scaleValue;return l=!!(l||g),u=!!(u||I),c=!!(c||v),{participantId:p,participantName:f||m,seed:g,ranking:I,rating:v}}),hasSeededParticipants:l,hasRankedParticipants:u,hasRatedParticipants:c}}function s_({tournamentRecord:t,withScaleValues:e,scaleEventType:i,inContext:r,eventIds:n,drawIds:a,context:s}){if(!t)return{error:Ie};let{tournamentId:o}=t,l=(t.events??[]).filter(({eventId:c})=>!n||Array.isArray(n)&&n.includes(c)).map(c=>{let d=c.drawDefinitions?.map(wb);if(a?.length&&!xi(a,d).length)return;let p=ke(c);return r&&Object.assign(p,{tournamentId:o}),s&&Object.assign(p,s),p}).filter(Boolean),u={};if(e){let c=Ei({withScaleValues:!0,tournamentRecord:t}).participantMap,d=p=>p.reduce((f,m)=>f+Number.parseFloat(m),0);for(let p of l){let f=i??p.eventType,m=p.eventId;u[m]||(u[m]={ratingsStats:{},ratings:{},ranking:{},draws:{}});let h=(p.entries??[]).filter(({entryStatus:S})=>so.includes(S)).map(vt),g=S=>{if(S?.ratings?.[f])for(let U of S?.ratings?.[f]??[]){let T=U.scaleName;u[m].ratings[T]||(u[m].ratings[T]=[]);let P=xr[T]?.accessor;if(P){let D=Number.parseFloat(U.scaleValue?.[P]);D&&u[m].ratings[T].push(D)}}if(S?.rankings?.[f])for(let U of S?.rankings?.[f]??[]){let T=U.scaleName;u[m].ranking[T]||(u[m].ranking[T]=[]),U.scaleValue&&u[m].ranking[T].push(U.scaleValue)}};for(let S of h){let U=c?.[S]?.participant;if(U?.participantType===gt)g(U);else for(let T of U?.individualParticipantIds??[]){let P=c?.[T]?.participant;g(P)}}let I=u[m].ratings;for(let S of Object.keys(I)){let U=I[S];if(!U.length)continue;let T=UH(U)?.toFixed(2);u[m].ratingsStats[S]={avg:Number.parseFloat((d(U)/U.length).toFixed(2)),median:T?Number.parseFloat(T):void 0,max:Math.max(...U),min:Math.min(...U)}}let v=(S,U)=>{let T=P=>{if(u[m].draws?.[S]&&P?.ratings?.[f])for(let D of P?.ratings?.[f]??[]){let E=D.scaleName;u[m].draws[S]?.ratings[E]||(u[m].draws[S].ratings[E]=[]);let R=xr[E]?.accessor;if(R){let C=Number.parseFloat(D.scaleValue?.[R]);C&&u[m].draws[S].ratings[E].push(C)}}if(u[m].draws?.[S]&&P?.rankings?.[f])for(let D of P?.rankings?.[f]??[]){let E=D.scaleName;u[m].draws[S]?.ranking[E]||(u[m].draws[S].ranking[E]=[]);let R=D.scaleValue;R&&u[m].draws[S].ranking[E].push(R)}};for(let P of U.filter(Boolean)){let D=c?.[P]?.participant;if(D?.participantType===gt)T(D);else for(let E of D?.individualParticipantIds??[]){let R=c?.[E]?.participant;T(R)}}},w=[],y=S=>a?.length&&a.includes(S)||w.includes(S);for(let S of p.drawDefinitions??[]){let U=S.drawId;if(y(U))continue;let T=cf({drawDefinition:S}).assignedParticipantIds??[];u[m].draws[U]||(u[m].draws[U]={ratingsStats:{},ratings:{},ranking:{}}),w.push(U),v(U,T)}let b=$i({event:p}).flightProfile;for(let S of b?.flights??[]){let U=S.drawId;if(y(U))continue;let T=S.drawEntries.map(vt);v(U,T)}for(let S of w){let U=u[m].draws[S].ratings;for(let T of Object.keys(U)){let P=U[T];if(!P.length)continue;let D=UH(P)?.toFixed(2);u[m].draws[S].ratingsStats[T]={avg:Number.parseFloat((d(P)/P.length).toFixed(2)),median:D?Number.parseFloat(D):void 0,max:Math.max(...P),min:Math.min(...P)}}}}}return Ve({eventScaleValues:u,events:l,...H})}function o_({tournamentRecord:t,drawDefinition:e,context:i,event:r}){if(!t)return{error:Ie};if(!r)return{error:li};let n=ke(r);i&&Object.assign(n,i);let a=e&&n.drawDefinitions?.find(({drawId:s})=>e.drawId===s);return Ve({drawDefinition:a,event:n})}function yDe(t){let e="validateAndDeriveDrawValues",{appliedPolicies:i,policyDefinitions:r}=SDe(t),n=UDe({...t,policyDefinitions:r,appliedPolicies:i}),a=wDe(t),s=TDe({...t,consideredEntries:a,appliedPolicies:i});if(s?.error)return z({result:s,stack:e});let o=DDe({...t,consideredEntries:a}),l=bDe({...t,appliedPolicies:i,policyDefinitions:r,drawSize:o});if(l.error)return z({result:l,stack:e});let u=l.drawType;if(isNaN(o)&&u!==ra)return z({result:{error:Ew},stack:e});let c=r?.[fo]??i?.[fo],d=t.seedingProfile??c?.seedingProfile?.drawTypes?.[u??""]??c?.seedingProfile;t.seedingProfile&&(r[fo]||(r[fo]={...AO[fo]}),r[fo].seedingProfile=d);let p=PDe({...t,drawType:u});return p?.error?z({result:p,stack:e}):{drawSize:o,drawType:u,enforceGender:n,seedingProfile:d,appliedPolicies:i,policyDefinitions:r}}function bDe(t){let{policyDefinitions:e,appliedPolicies:i,enforceMinimumDrawSize:r=!0,drawSize:n}=t,a=t.drawTypeCoercion??DS({drawType:t.drawType,policyDefinitions:e,appliedPolicies:i}),s=H8({drawType:t.drawType,enforceMinimumDrawSize:r,drawTypeCoercion:a,drawSize:n});return s.error?s:{drawType:s.drawType}}function mX(t){return t?.filter(e=>e.entryStatus&&[...so,eS].includes(e.entryStatus))}function wDe({considerEventEntries:t=!0,drawEntries:e,eventEntries:i,qualifyingOnly:r}){return(r&&[]||mX(e)||(t?i:[])).filter(({entryStage:n})=>!n||n===xe)}function SDe(t){let{tournamentRecord:e,event:i}=t,r={...t?.appliedPolicies,...Tt({tournamentRecord:e,event:i}).appliedPolicies??{}},n=ke(t.policyDefinitions??{},!1,!0);return{appliedPolicies:r,policyDefinitions:n}}function UDe({enforceGender:t,policyDefinitions:e,appliedPolicies:i}){return t??e?.[Er]?.participants?.enforceGender??i?.[Er]?.participants?.enforceGender}function TDe(t){let{consideredEntries:e,appliedPolicies:i,policyDefinitions:r,enforceGender:n,participantMap:a,participants:s,event:o}=t;return o&&s&&YR({consideredEntries:e,policyDefinitions:r,appliedPolicies:i,participantMap:a,enforceGender:n,participants:s,event:o})}function DDe(t){return!t.drawSize&&t.consideredEntries.length&&![ra,Fw,ev,Ks,au].includes(t.drawType??"")&&qI(t.consideredEntries.length)||t.drawSize&&Ye(t.drawSize)||!1}function PDe(t){let{tournamentRecord:e,event:i,ignoreAllowedDrawTypes:r,drawType:n}=t,a=!r&&e&&lC({tournamentRecord:e,categoryType:i?.category?.categoryType,categoryName:i?.category?.categoryName});return a?.length&&!a.includes(n)?{error:C1}:{...H}}function hX(t){let{drawDefinition:e,appliedPolicies:i}=t,r=i?.[lc],n=Ar({drawDefinition:e});return e.structures?.forEach(a=>{let s=gd({structureId:a.structureId,matchUpsMap:n}),o=yK({roundNamingPolicy:r,drawDefinition:e,structure:a,matchUps:s}),{roundNamingProfile:l,roundProfile:u}=o;(a.structures||[a]).forEach(c=>{(c.matchUps??[]).forEach(d=>{let p=d?.roundNumber?.toString();if(p){let f=l?.[p]?.roundName,m=l?.[p]?.abbreviatedRoundName,h=u?.[p]?.feedRound;Object.assign(d,{abbreviatedRoundName:m,feedRound:h,roundName:f})}})})}),{drawDefinition:e}}function AS(t){let{voluntaryConsolation:e,tournamentRecord:i,event:r}=t,n="generateDrawDefinition",{participants:a,participantMap:s}=Ei({withIndividualParticipants:!0,convertExtensions:!0,internalUse:!0,tournamentRecord:i}),o=mX(r?.entries)??[],l=yDe({...t,participantMap:s,participants:a,eventEntries:o});if(l.error)return z({result:l,stack:n});let{appliedPolicies:u,policyDefinitions:c,drawSize:d,drawType:p,enforceGender:f,seedingProfile:m}=l,h=r?.eventType,g=t.matchUpType??h,I=ITe({...t,enforceGender:f,eventType:h,matchUpType:g});if(I.error)return z({result:I,stack:n});let{matchUpFormat:v,tieFormat:w}=I;if(t.drawId&&typeof t.drawId!="string")return z({result:{error:ie},stack:n});let y=zTe({...t,policyDefinitions:c,tournamentRecord:i,appliedPolicies:u,matchUpFormat:v,seedingProfile:m,participants:a,eventEntries:o,matchUpType:g,tieFormat:w,drawSize:d,drawType:p,event:r});if(y.error)return z({result:y,stack:n});let{existingDrawDefinition:b,positioningReports:S,drawDefinition:U,structureId:T,conflicts:P,entries:D}=y;if(!U)return z({result:{error:ie},stack:n});let E=qTe({...t,existingDrawDefinition:b,positioningReports:S,appliedPolicies:u,drawDefinition:U,seedingProfile:m,participants:a,structureId:T,entries:D,params:t,stack:n});if(E.error)return E;let{qualifyingConflicts:R}=E;return U.drawName=t.drawName??(p&&Xr(p)),d&&typeof e=="object"&&d>=4&&vL({...e,drawDefinition:U,matchUpType:g}),t.hydrateRoundNames&&u?.[lc]&&hX({drawDefinition:U,appliedPolicies:u}),{existingDrawDefinition:!!b,qualifyingConflicts:R,positioningReports:S,drawDefinition:U,structureId:T,...H,conflicts:P}}function EDe({matchUps:t,matchUpType:e}){if(!t)return{error:Tu};let i=[],r=[],n=0;e&&(t=t.filter(T=>T.matchUpType===e));let a=rt(t.map(({matchUpType:T})=>T));if(a.length>1)if(Zf(a,Zt))t=t.filter(Di(Zt));else if(Zf(a,Wt))t=t.filter(Di(Wt));else if(Zf(a,$t))t=t.filter(Di($t));else return{};if(!Ga(t)||!t.length)return{};let s=(T,P)=>Ye(T)-Ye(P),o=rt(t.flatMap(T=>T.drawPositions).filter(Boolean)).sort(s),l=Re(1,Math.max(...o)+1).filter(T=>!o.includes(T)).sort(s),{roundMatchUps:u}=bn({matchUps:t}),c=u?.[1],d=u?.[2]??[],p=c?.[0],f=p?.drawId,m=p?.structureId,h=u?Object.keys(u).map(T=>Ye(T)):[],g=Math.max(...h),I=u?.[g]?.length??0,v=Math.ceil(Math.log(I)/Math.log(2)),w=Re(1,v+1).map(T=>{let P=Math.pow(2,T-1),D=g+v-T+1;return Re(1,P+1).map(E=>({drawId:f,structureId:m,matchUpId:Et(),drawPositions:[],sides:[],roundNumber:D,roundPosition:E,finishingRound:T}))});v&&(t=t.concat(...w.flat()));let y=c?.map(T=>T.drawPositions)?.flat(1/0),b=d.map(T=>T.drawPositions).flat(1/0).filter(T=>!y?.includes(T)).sort(s),S=d.filter(T=>T.drawPositions?.find(P=>b.includes(P))).map(T=>{let P=T.drawPositions?.find(R=>b.includes(R)),D=P&&T.drawPositions?.indexOf(P),E=D!==void 0&&T.sides?.[D];return P&&{[P]:E}});if(l?.length&&b?.length===l?.length){let T=b.map((R,C)=>[R,l[C]].sort(s)),P=Object.assign({},...S),D=ke(c?.[0].finishingRound,!1,!0),E=ke(c?.[0].finishingPositionRange,!1,!0);r=T.map((R,C)=>{let M=Math.max(...R||[])/2,N=R?.map(A=>P[A]||{bye:!0,drawPosition:A});return{finishingPositionRange:E,sideNumber:C+1,matchUpStatus:"BYE",matchUpId:Et(),finishingRound:D,roundNumber:1,drawPositions:R,roundPosition:M,structureId:m,drawId:f,sides:N}}),t=t.concat(...r)}let U=g+v;return Re(1,U+1).forEach(T=>{let P=[],D=vW({matchUps:t,roundNumber:T}),E=vW({matchUps:t,roundNumber:T-1}),R=new Set(E.map(RDe).filter(Boolean)),C=D?.length===i?.length,M=D?.length===i?.length/2;T===1&&D.forEach(N=>{let A=N.drawPositions||[],{matchUpId:O,structureId:k}=N,F=[{...N.sides[0],drawPosition:A[0],matchUpId:O,structureId:k},{...N.sides[1],drawPosition:A[1],matchUpId:O,structureId:k}],x={...N,children:F};P.push(x)}),C?(n++,D.forEach((N,A)=>{let O=N.drawPositions||[],{matchUpId:k,structureId:F}=N,x=O.filter(Boolean).reduce((V,_)=>y?.includes(_)?V:_,void 0),L=[{...N.sides.filter(Boolean).reduce((V,_)=>_.participantId&&!R.has(_.participantId)?_:V,void 0),drawPosition:x,feedRoundNumber:n,sides:N.sides,matchUpId:k,structureId:F},i[A]],$={...N,children:L};P.push($)})):M&&D.forEach((N,A)=>{let O=[i[A*2],i[A*2+1]],k={...N,children:O};P.push(k)}),i=P}),{hierarchy:i[0],missingMatchUps:r,maxRound:g,finalRound:U,matchUps:t}}function vW({matchUps:t,roundNumber:e}){return t.filter(i=>i.roundNumber===e).sort((i,r)=>i.roundPosition-r.roundPosition)}function RDe(t){if(t.matchUpStatus==="BYE")return t.sides.reduce((e,i)=>i.participantId||e,void 0);if(t.winningSide)return t.sides.reduce((e,i)=>i.sideNumber===t.winningSide?i.participantId:e,void 0)}function gX({scaleAttributes:t,scaledEntries:e,stageEntries:i,seedsCount:r,scaleName:n}){if(!t)return{error:Xe,info:"missing scaleAttributes"};let a=Object.assign({},...(e||[]).slice(0,r).map(({participantId:o},l)=>({[o]:l+1})));n=n||t.scaleName;let s=new Date().toISOString();return{scaleItemsWithParticipantIds:i.map(({participantId:o})=>({scaleItems:[{scaleValue:a[o],eventType:t.eventType,scaleType:jl,scaleName:n,scaleDate:s}],participantId:o}))}}function CDe({tournamentRecord:t,drawDefinition:e,policyDefinitions:i,scaleAttributes:r,scaleName:n,drawSize:a,drawId:s,event:o,stage:l,sortDescending:u,scaleSortMethod:c}){let d=IC({policyDefinitions:i,drawDefinition:e,drawSize:a,drawId:s,event:o,stage:l});if(d.error)return d;let{entries:p,seedsCount:f,stageEntries:m}=d;if(!m||!f)return{error:ie};let h=Th({tournamentRecord:t,scaleAttributes:r,scaleSortMethod:c,sortDescending:u,entries:p,stage:l}).scaledEntries??[],{scaleItemsWithParticipantIds:g}=gX({scaleAttributes:r,scaledEntries:h,stageEntries:m,seedsCount:f,scaleName:n});return{scaleItemsWithParticipantIds:g}}var IX={};ct(IX,{addDrawEntries:()=>fL,addEventEntries:()=>Ko,addEventEntryPairs:()=>SX,destroyPairEntries:()=>b7,destroyPairEntry:()=>IL,getEntriesAndSeedsCount:()=>IC,getMaxEntryPosition:()=>z0,modifyEntriesStatus:()=>YD,modifyEventEntries:()=>UX,mutate:()=>vX,promoteAlternate:()=>bX,promoteAlternates:()=>u_,query:()=>lX,removeDrawEntries:()=>wX,removeEventEntries:()=>dS,setEntryPosition:()=>l_,setEntryPositions:()=>yX});var vX={};ct(vX,{addDrawEntries:()=>fL,addEventEntries:()=>Ko,addEventEntryPairs:()=>SX,destroyPairEntries:()=>b7,destroyPairEntry:()=>IL,modifyEntriesStatus:()=>YD,modifyEventEntries:()=>UX,promoteAlternate:()=>bX,promoteAlternates:()=>u_,removeDrawEntries:()=>wX,removeEventEntries:()=>dS,setEntryPosition:()=>l_,setEntryPositions:()=>yX});function l_({tournamentRecord:t,drawDefinition:e,participantId:i,entryPosition:r,skipRefresh:n,event:a}){let s="setEntryPositions";if(!t)return{error:Ie};if(!i)return z({result:{error:lr},stack:s});if(r!==void 0&&!Number.isSafeInteger(r))return{error:ie,entryPosition:r};(a?.entries||[]).forEach(l=>{l.participantId===i&&(l.entryPosition=r)}),(e?.entries||[]).forEach(l=>{l.participantId===i&&(l.entryPosition=r)});let o=l=>{l.entries.forEach(u=>{u.entryPosition===r&&u.participantId!==i&&(u.entryPosition+=.1)})};return n||(a?.entries&&(o(a),a.entries=vo({entries:a.entries})),e?.entries&&(o(e),e.entries=vo({entries:e.entries}))),{...H}}function yX({tournamentRecord:t,entryPositions:e,drawDefinition:i,event:r}){if(!t)return{error:Ie};if(!Array.isArray(e))return{error:ie};for(let n of e){let{participantId:a,entryPosition:s}=n,o=l_({skipRefresh:!0,tournamentRecord:t,drawDefinition:i,participantId:a,entryPosition:s,event:r});if(o.error)return o}return r?.entries&&(r.entries=vo({entries:r.entries})),i?.entries&&(i.entries=vo({entries:i.entries})),{...H}}function bX(t){let{participantId:e}=t;return e&&typeof e!="string"?{error:ie,participantId:e}:u_({...t,participantIds:[e].filter(Boolean)})}function u_({tournamentRecord:t,drawDefinition:e,participantIds:i,stageSequence:r,stage:n=xe,eventId:a,event:s}){if(!t)return{error:Ie};if(!Array.isArray(i))return{error:ie,participantIds:i};if(!s)return{error:li};let o="promoteAlternates";if(s){let l=yW({element:s,participantIds:i,stageSequence:r,stage:n});if(l.error)return l}if(e){let l=yW({element:e,participantIds:i,stageSequence:r,stage:n});if(l.error)return a?z({context:{drawPromotionError:l.error,drawId:e.drawId},result:{...H},stack:o}):l}return{...H}}function yW({participantIds:t,stageSequence:e,element:i,stage:r}){let n=(i.entries||[]).filter(d=>d.entryStatus===Fs),a=(i.entries||[]).filter(d=>t.includes(d.participantId)),s=n.reduce((d,p)=>{let{entryPosition:f}=p;return isNaN(f)&&d||(!d||f<d.entryPosition)&&p||d},void 0),o=a.length?a:[s].filter(Boolean);if(!o?.length)return{error:G6};let l=o.filter(({entryStatus:d})=>d!==Fs);if(l.length)return{error:Yk,invalidEntryStatus:l};let u=o.filter(({entryStage:d})=>d&&d!==r);if(u.length)return{error:Vme,invalidStage:u};let c=e&&o.filter(d=>d.stageSequence!==e);if(c?.length)return{error:jme,invalidStageSequence:c};for(let d of o){d.entryStatus=na;let p=d?.entryPosition;isNaN(p)||i.entries.forEach(m=>{m.entryStatus===Fs&&m.entryPosition>p&&(m.entryPosition=m.entryPosition-1)});let f=Math.max(...i.entries.filter(m=>m.entryStatus===na&&!isNaN(m.entryPosition)).map(({entryPosition:m})=>Ye(m||0)),0);d.entryPosition=f||0}return{...H}}function wX({autoEntryPositions:t=!0,participantIds:e,drawDefinition:i,drawId:r,stages:n,event:a}){if(!a)return{error:li};if(!r)return{error:Oo};if(!e?.length)return{error:Od};let s=cf({drawDefinition:i,stages:n}).assignedParticipantIds??[];if(kn(s,e))return{error:JI};let o=c=>{let d=c.participantId;return!e.includes(d)},{flightProfile:l}=$i({event:a}),u=l?.flights?.find(c=>c.drawId===r);return u?.drawEntries&&(u.drawEntries=u.drawEntries.filter(o),t&&(u.drawEntries=vo({entries:u.drawEntries}))),i?.entries&&(i.entries=i.entries.filter(o),t&&(i.entries=vo({entries:i.entries}))),{...H}}function ul(t){let e="addParticipant",{allowDuplicateParticipantIdPairs:i,returnParticipant:r,disableNotice:n,pairOverride:a,participant:s}=t,o=t.tournamentId?t.tournamentRecords?.[t.tournamentId]:t.tournamentRecord??(t.activeTournamentId&&t.tournamentRecords?.[t.activeTournamentId]);if(!o)return{error:Ie};if(!s)return z({result:{error:ih},stack:e});s.participantId||(s.participantId=Et()),o.participants||(o.participants=[]);let{participantId:l,individualParticipantIds:u}=s;if(o.participants.reduce((h,g)=>g.participantId===l||h,!1))return{error:_6};let{participantType:c,participantRole:d}=s;if(!c||!Object.keys(Ay).includes(c))return{error:Do,participantType:c};if(!d)return{error:F6};let p=o.participants||[],f=p.filter(h=>h.participantType===gt).map(h=>h.participantId);if(c!==gt&&s.person)return{error:ie,person:s.person};if(u&&!Array.isArray(u))return{error:ie,individualParticipantIds:u};if(c===pt){if(s.person)return{error:ie,person:s.person};if(s.individualParticipantIds){if(s.individualParticipantIds.length!==2&&!a)return z({info:"PAIR must be 2 individualParticipantIds",result:{error:ga},stack:e});{let I=p.filter(v=>v.participantType===gt).map(v=>v.participantId);if(!Array.isArray(s.individualParticipantIds))return z({result:{error:ga},stack:e});if(!s.individualParticipantIds.reduce((v,w)=>I.includes(w)&&v,!0))return z({result:{error:ga},stack:e})}}else return z({result:{error:Od},stack:e});let h=p.filter(I=>I.participantType===pt).map(I=>({individualParticipantIds:I.individualParticipantIds,participant:I})),g=s.participantType===pt&&h.find(I=>xi(I.individualParticipantIds,s.individualParticipantIds).length===2);if(g&&!i)return{...H,existingParticipant:!0,participant:r&&ke(g.participant)};if(!s.participantName){let I=p.filter(w=>s.individualParticipantIds?.includes(w.participantId)),v=I.map(w=>w.person?.standardFamilyName).filter(Boolean).join("/");I.length===1&&(v+="/Unknown"),s.participantName=v}}else if(c===gt){if(!s.person?.standardFamilyName||!s.person?.standardGivenName)return{error:j6};if(!s.participantName){let h=`${s.person.standardFamilyName.toUpperCase()}, ${s.person.standardGivenName}`;s.participantName=h}}else if(c&&[Lt,ja].includes(c)){if(u||(s.individualParticipantIds=[]),s.individualParticipantIds?.length)for(let h of s.individualParticipantIds){if(typeof h!="string")return z({result:{participantId:h,error:ie},stack:e});if(!f.includes(h))return z({result:{participantId:h,error:Vi},stack:e})}}else return{error:Do};o.participants.push(s),n||at({payload:{tournamentId:o.tournamentId,participants:[s]},topic:md});let m={participant:r&&ke(s),...H};return Ve(m)}function Zs({allowDuplicateParticipantIdPairs:t,returnParticipants:e,tournamentRecord:i,participants:r=[]}){if(!i)return{error:Ie};i.participants||(i.participants=[]);let n=i.participants.map(d=>d.participantId)||[];r.forEach(d=>{d.participantId||(d.participantId=Et())});let a=r.filter(d=>!n.includes(d.participantId)),s=r.filter(d=>n.includes(d.participantId)),o=a.filter(d=>d.participantType===gt),l=a.filter(d=>d.participantType!==gt),u=o.concat(...l),c=[];if(u.length){for(let p of u){let f=ul({allowDuplicateParticipantIdPairs:t,returnParticipant:!0,disableNotice:!0,tournamentRecord:i,participant:p});if(f.error)return f;f.success&&!f.existingParticipant&&c.push(f.participant)}c.length&&at({topic:md,payload:{tournamentId:i.tournamentId,participants:c}});let d={participants:e&&ke(c),addedCount:c.length,...H};return s.length&&Object.assign(d,{notAdded:s,info:VE}),Ve(d)}else return{info:"No new participants to add",addedCount:0,...H}}function SX(t){let e=Ge(t,[{[mr]:!0,[Ac]:!0}]);if(e.error)return e;let{allowDuplicateParticipantIdPairs:i,entryStatus:r=Fs,participantIdPairs:n=[],entryStage:a=xe,tournamentRecord:s,drawDefinition:o,event:l,uuids:u}=t;if(l.eventType!==$t)return{error:Zl};let c=[],d=new Map;for(let y of s.participants??[]){let{participantType:b,participantId:S,person:U,individualParticipantIds:T}=y;b===gt&&U?.sex?d.set(S,U.sex):b===pt&&T&&c.push(T)}let p=n.filter(y=>{if(y.length!==2)return!0;if(!l.gender||eu(l.gender))return!1;if(!d.has(y[0])||!d.has(y[1]))return!0;let b=y.map(U=>d.get(U)),S=Wf(l.gender)&&(!Wf(b[0])||!Wf(b[1]))||sp(l.gender)&&(!sp(b[0])||!sp(b[1]));return Na(l.gender)&&(b.sort(AR),(!sp(b[0])||!Wf(b[1]))&&(S=!0)),S});if(p.length)return{error:ga,invalidParticipantIdPairs:p};let f=n.map(y=>({participantId:u?.pop()??Et(),participantRole:Kr,individualParticipantIds:y,participantType:pt})),m=i?f:f.filter(y=>!c.find(b=>xi(b,y.individualParticipantIds).length===2)),h,g=[];if(m){let y=Zs({allowDuplicateParticipantIdPairs:i,participants:m,returnParticipants:!0,tournamentRecord:s});if(y.error)return y;g=y.participants||[],h=y.info}let I=n.map(y=>{let b=g.find(U=>xi(U.individualParticipantIds,y).length===2);if(b)return b;let{participant:S}=Qs({tournamentRecord:s,participantIds:y});return S}).map(y=>y.participantId),v=Ko({participantIds:I,tournamentRecord:s,drawDefinition:o,entryStatus:r,entryStage:a,event:l});m.length&&at({payload:{participants:m},topic:md});let w=m.map(vt);return{...v,info:h,newParticipantIds:w}}function UX({entryStatus:t=na,unpairedParticipantIds:e=[],participantIdPairs:i=[],entryStage:r=xe,tournamentRecord:n,event:a}){if(!n)return{error:Ie};if(!a)return{error:li};let s=n.participants??[],o=s.filter(h=>h.participantType===gt).map(h=>h.participantId),l=e.concat(...i).flat(1/0).filter(h=>!o.includes(h));if(l.length)return{error:ga,invalidParticipantIds:l};let u=i.filter(h=>h.length!==2);if(u.length)return{error:ga,invalidParticipantIdPairs:u};let c=s.filter(h=>h.participantType===pt).map(h=>h.individualParticipantIds),d=i.filter(h=>!c.find(g=>xi(g,h).length===2)).map(h=>({participantType:pt,participantRole:Kr,individualParticipantIds:h})),p=Zs({participants:d,tournamentRecord:n});if(p.error)return p;let f=i.map(h=>{let{participant:g}=Qs({tournamentRecord:n,participantIds:h});return g}).map(h=>({participantId:h,entryStatus:t,entryStage:r})),m=e.map(h=>({entryStatus:ys,participantId:h,entryStage:r}));return a.entries=(a.entries??[]).filter(h=>h.entryStage===r),a.entries=a.entries.concat(...f,...m),{...H}}var TX={};ct(TX,{addDrawDefinition:()=>kS,addEvent:()=>vv,addFlight:()=>DC,assignSeedPositions:()=>FX,attachFlightProfile:()=>g_,categoryCanContain:()=>Ow,deleteDrawDefinitions:()=>SC,deleteEvents:()=>_X,deleteFlightAndFlightDraw:()=>OX,deleteFlightProfileAndFlightDraws:()=>CX,generate:()=>DX,generateEventsFromTieFormat:()=>PX,getCategoryAgeDetails:()=>Up,getEvent:()=>o_,getEventProperties:()=>a_,getEventStructures:()=>FR,getEventTimeItem:()=>qw,getEvents:()=>s_,getFlightProfile:()=>$i,getScaledEntries:()=>Th,modifyEvent:()=>$X,modifyEventMatchUpFormatTiming:()=>MX,modifyPairAssignment:()=>xX,mutate:()=>EX,query:()=>fX,refreshEventDrawOrder:()=>h_,removeEventMatchUpFormatTiming:()=>UC,removeScaleValues:()=>I_,removeSeeding:()=>LX,setEventDates:()=>f_,setEventDisplay:()=>TC,setEventEndDate:()=>p_,setEventStartDate:()=>d_,updateDrawIdsOrder:()=>m_,validateCategory:()=>mb});var DX={};ct(DX,{generateEventsFromTieFormat:()=>PX});function MDe({tournamentId:t,event:e}){return e?(at({payload:{tournamentId:t,event:e},key:e.eventId,topic:Z5}),{...H}):{error:li}}var NDe={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_D3",winCriteria:{valueGoal:5}},ADe={collectionDefinitions:[{collectionName:"Doubles",collectionValue:1,matchUpCount:3,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES"},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_DEFAULT",winCriteria:{valueGoal:5}},kDe={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_JUCO",winCriteria:{valueGoal:5}},ODe={COLLEGE_D3:NDe,COLLEGE_DEFAULT:ADe,COLLEGE_JUCO:kDe,DOMINANT_DUO:z4,DOMINANT_DUO_MIXED:j4,LAVER_CUP:J4,TEAM_DOUBLES_3_AGGREGATION:L4,TIME_TENNIS_DUAL:G4,TIME_TENNIS_PRO_CIRCUIT:V4,USTA_BREWER_CUP:H4,USTA_OZAKI_CUP:W4,USTA_COLLEGE:q4,USTA_GOLD_TEAM_CHALLENGE:F4,USTA_INTERSECTIONAL:B4,USTA_LEVEL_1:Y4,USTA_SECTION_BATTLE:$4,USTA_SOUTHERN_LEVEL_5:_4,USTA_TOC:Q4,USTA_WTT_ITT:K4,USTA_ZONAL:X4};function vv({suppressNotifications:t,tournamentRecord:e,internalUse:i,event:r}){if(!e)return{error:Ie};if(e.events||(e.events=[]),!r)return{error:li};let{startDate:n,endDate:a}=e;if(!i&&(r.entries?.length||r.drawDefinitions?.length)){let o=Ve({drawDefinitions:!!r.drawDefinitions?.length,entries:!!r.entries?.length});return{info:"entries/drawDefinitions cannot exist",error:ie,context:o}}let s={eventType:Dm,drawDefinitions:[],entries:[],startDate:n,endDate:a,...r};if(r.eventType===ya){if(r.tieFormat){let o=Bn({tieFormat:r.tieFormat});if(o.error)return o}else if(r.tieFormatName){if(!ODe[r.tieFormatName])return{context:{tieFormatName:r.tieFormatName},error:ie};let o=sc({isMock:e?.isMock,namedFormat:r.tieFormatName,event:r});s.tieFormat=o}}if(s.eventId||(s.eventId=Et()),e.events.reduce((o,l)=>o||l.eventId===s.eventId,void 0))return{error:m6};{let o=s;if(e.events.push(o),!t){let{topics:l}=gs();if(l.includes(IR)){let d=Ru({event:r}).matchUps??[];hd({tournamentId:e?.tournamentId,eventId:r.eventId,matchUps:d})}let{drawDefinitions:u,...c}=r;for(let d of u||[])Hw({drawDefinition:d});MDe({tournamentId:e?.tournamentId,event:c})}return{...H,event:s}}}function PX(t){let e=Ge(t,[{[tI]:{[oR]:!0,[P5]:!0}},{[mr]:!0}]);if(e.error)return e;let i=t.tieFormat||sc({namedFormat:t.tieFormatName}),r=t.uuids||[x4(i.collectionDefinitions.length)],n={[er]:[],[Hr]:[]};if(t.addEntriesFromTeams){let s=t.tournamentRecord.participants?.filter(o=>o.participantType===_n)?.flatMap(o=>o.individualParticipantIds??[]);for(let o of t.tournamentRecord.participants??[])if(s?.includes(o.participantId)){let l=o.person?.sex;if(l&&il(l)){let u=on(l);u&&n[u].push(o.participantId)}}}let a=[];for(let s of i.collectionDefinitions??[]){let o=r?.pop()?.toString()||Et(),l=s.matchUpType,u=s.gender,c={matchUpFormat:s.matchUpFormat,eventName:s.collectionName,category:s.category,gender:u,eventType:l,eventId:o};if(t.addEntriesFromTeams){let d=l===oc?ys:t.entryStatus||na,p=Na(u)?[...n[er],...n[Hr]]:n[on(u)||Vu]??[];if(p.length){let f=Ko({participantIds:p,entryStatus:d,event:c});if(f.error)return f}}if(a.push(c),t.addEvents!==!1){let d=vv({internalUse:!0,tournamentRecord:t.tournamentRecord,event:c});if(d.error)return d}}return{...H,events:a}}var EX={};ct(EX,{addDrawDefinition:()=>kS,addEvent:()=>vv,addFlight:()=>DC,assignSeedPositions:()=>FX,attachFlightProfile:()=>g_,deleteDrawDefinitions:()=>SC,deleteEvents:()=>_X,deleteFlightAndFlightDraw:()=>OX,deleteFlightProfileAndFlightDraws:()=>CX,modifyEvent:()=>$X,modifyEventMatchUpFormatTiming:()=>MX,modifyPairAssignment:()=>xX,refreshEventDrawOrder:()=>h_,removeEventMatchUpFormatTiming:()=>UC,removeScaleValues:()=>I_,removeSeeding:()=>LX,setEventDates:()=>f_,setEventDisplay:()=>TC,setEventEndDate:()=>p_,setEventStartDate:()=>d_,updateDrawIdsOrder:()=>m_,validateCategory:()=>mb});function yv({removePriorValues:t=!0,status:e=Ha,statusObject:i,event:r}){if(!bt(i))return{error:ie};let n=za({event:r,status:e}),a=`${Bd}.${Vd}`,s={itemValue:{[e]:{...n,...i}},itemType:a};return Sh({timeItem:s,removePriorValues:t,event:r})}function bv(t){let e=Ge(t,[{[mr]:!0,[Ac]:!0},{eventDataParams:!1,[zn]:Yn}]);if(e.error)return e;let{includePositionAssignments:i,removePriorValues:r,tournamentRecord:n,status:a=Ha,event:s,drawIdsToRemove:o,drawIdsToAdd:l}=t,{appliedPolicies:u}=Tt({tournamentRecord:n,event:s}),c={...u,...t.policyDefinitions},d=s?.drawDefinitions?.map(({drawId:b})=>b)??[],p=t.drawDetails?Object.keys(t.drawDetails):[],f=p.length?[]:t.drawIds,m=(l??[]).concat(...o??[],...f??[],...p),h=m.filter(b=>!d.includes(b));if(h.length)return z({result:{error:Oa},context:{invalidDrawIds:h}});if(t.drawDetails)for(let b of Object.keys(t.drawDetails)){let S=t.drawDetails[b];if(S.publishingDetail?.embargo&&!td(S.publishingDetail.embargo))return{error:Sg};if(S.stageDetails){for(let U of Object.keys(S.stageDetails))if(S.stageDetails[U].embargo&&!td(S.stageDetails[U].embargo))return{error:Sg}}if(S.structureDetails)for(let U of Object.keys(S.structureDetails)){let T=S.structureDetails[U];if(T.embargo&&!td(T.embargo))return{error:Sg};if(T.scheduledRounds){for(let P of Object.keys(T.scheduledRounds))if(T.scheduledRounds[P].embargo&&!td(T.scheduledRounds[P].embargo))return{error:Sg}}}}let g=za({event:s,status:a}),I=Object.keys(g?.drawDetails||{}).filter(b=>d.includes(b)).reduce((b,S)=>(b[S]=g.drawDetails[S],b),{});for(let b of d)if((!m.length||m.includes(b))&&(o?.includes(b)||f?.length&&!f.includes(b)?I[b]={...I[b],publishingDetail:{published:!1}}:(l?.includes(b)||f?.includes(b)||!f?.length)&&(I[b]={...I[b],publishingDetail:{published:!0}})),t.drawDetails?.[b]){let S=t.drawDetails[b],U=S.structureDetails??I[b].structureDetails,T=S.stageDetails??I[b].stageDetails??{},{structureIdsToRemove:P=[],structureIdsToAdd:D=[],publishingDetail:E={},stagesToRemove:R=[],stagesToAdd:C=[]}=S;if((D||C)&&(E.published=!0),I[b]={publishingDetail:E,structureDetails:U,stageDetails:T},D.length||P.length){let N=(s?.drawDefinitions?.find(O=>O.drawId===b)?.structures??[]).map(({structureId:O})=>O),A=(D??[]).concat(P??[]).filter(O=>!N.includes(O));if(A.length)return z({result:{error:Ii},context:{invalidStructureIds:A}});U=U??{};for(let O of N)P.includes(O)?U[O]={published:!1}:U[O]={published:!0};I[b].structureDetails=U}let M=(s?.drawDefinitions?.find(N=>N.drawId===b)?.structures??[]).map(({stage:N})=>N);if(C.length){for(let N of C)T[N]={published:!0};for(let N of M)T[N]||(T[N]={published:!1})}if(C.length||R.length){for(let N of R)T[N]={published:!1};for(let N of M)T[N]||(T[N]={published:!0})}(C.length||R.length)&&(I[b].stageDetails=T)}yv({statusObject:{drawDetails:I},removePriorValues:r,status:a,event:s});let{topics:v}=gs(),w=v.includes(oO),y=w||t.returnEventData?TS({includePositionAssignments:i,...t.eventDataParams,usePublishState:!0,tournamentRecord:n,policyDefinitions:c,event:s})?.eventData:void 0;return w&&at({payload:{eventData:y,tournamentId:n.tournamentId},topic:oO}),{...H,eventData:y}}var RX="deleteDrawDefinitions",OO="autoSchedulingAudit",tD="deleteEvents",xDe={AUTO_SCHEDULING_AUDIT:OO,DELETE_EVENTS:tD,DELETE_DRAW_DEFINITIONS:RX};function SC(t){if(!t.tournamentRecord)return{error:Ie};let e="deleteDrawDefinitions",i=t.drawIds??[],r=t.event,{autoPublish:n=!0,tournamentRecord:a,auditData:s,eventId:o,force:l}=t,{appliedPolicies:u}=Tt({tournamentRecord:a,event:r}),c={...u,...t.policyDefinitions},d=Array.isArray(i)?i[0]:void 0;if(!r){let T=jn({tournamentRecord:a,eventId:o,drawId:d});if(T.error)return T;r=T.event}let p=[],f=[],m=[];if(!r?.drawDefinitions)return z({info:"event has no drawDefinition",result:{...H},stack:e});let h=r.drawDefinitions.map(({drawId:T})=>T);if(i.length||(i=h),i=i.filter(T=>h.includes(T)),!i.length)return z({info:"nothing to do; no matching drawIds in event.",result:{...H},stack:e});let g=ke($i({event:r}).flightProfile,!1,!0),I=({participantId:T,drawPosition:P,qualifier:D,bye:E})=>({bye:E,qualifier:D,drawPosition:P,participantId:T}),v=l??u?.[Po]?.allowDeletionWithScoresPresent?.drawDefinitions,w=za({event:r})??{},y=w.drawIds??(w.drawDetails&&Object.keys(w.drawDetails))??[],b,S=[],U=r.drawDefinitions.filter(T=>{if(i.includes(T.drawId)){let P=Rn({event:r,drawDefinition:T})?.matchUps??[];if(P.some(({score:F})=>cr({score:F}))&&!v)return S.push(T.drawId),!0;let{drawId:D,drawType:E,drawName:R}=T,C=g?.flights?.find(F=>F.drawId===T.drawId);C&&(C.drawEntries=C.drawEntries?.filter(F=>so.includes(F.entryStatus))),y.includes(D)&&(y=y.filter(F=>F!==D),b=!0);let M=Js({stageSequence:1,drawDefinition:T,stage:xe})?.structures?.[0],N=(M?lI({structureId:M.structureId,tournamentRecord:a,drawDefinition:T}):void 0)?.positionAssignments?.map(I),A=Js({stage:We,drawDefinition:T})?.structures,O=A?.length?A.map(F=>{let x=F.stageSequence;return{positionAssignments:lI({structureId:F.structureId,tournamentRecord:a,drawDefinition:T})?.positionAssignments.map(I),stageSequence:x}}):void 0,k={action:RX,payload:{drawDefinitions:[T],eventId:o??r?.eventId,auditData:s}};m.push(k),p.push(Ve({tournamentId:a.tournamentId,eventId:o??r?.eventId,qualifyingPositionAssignments:O,positionAssignments:N,auditData:s,drawType:E,drawName:R,drawId:D})),P?.forEach(({matchUpId:F})=>f.push(F))}return!i.includes(T.drawId)});if(S.length&&!l)return z({context:{drawIdsWithScoresPresent:S},result:{error:Nw},stack:e});if(r.drawDefinitions=U,g&&Ld({event:r,extension:{name:Xs,value:g}}),CS({tournamentRecord:a}),b){let T={};for(let D of y)T[D]=w.drawDetails?.[D]??{published:!0};let P=yv({statusObject:{drawDetails:T},event:r});if(P.error)return{error:P.error}}if(m.length)if(qE(Ju)){let T=a.tournamentId;at({topic:Ju,payload:{tournamentId:T,detail:m}});let P=(vs({element:r,itemType:pp})?.timeItem?.itemValue||0)+1;Dl({element:r,timeItem:{itemType:pp,itemValue:P},removePriorValues:!0})}else FDe({appliedPolicies:u,event:r,deletedDrawsDetail:p,auditData:s});if(f.length&&Pu({tournamentId:a?.tournamentId,matchUpIds:f}),i.forEach(T=>Vge({drawId:T})),n&&b){let T=bv({...t.eventDataParams,drawIdsToRemove:i,policyDefinitions:c,tournamentRecord:a,event:r});if(T.error)return{...H,info:T.error}}return{...H}}function FDe({appliedPolicies:t,event:e,deletedDrawsDetail:i,auditData:r}){if(t?.audit?.[pp]===!1)return;let{extension:n}=mt({name:pp,element:e}),a={...r,deletedDrawsDetail:i},s={value:Array.isArray(n?.value)?n?.value.concat(a):[a],name:pp};xt({element:e,extension:s})}function CX({autoPublish:t=!0,tournamentRecord:e,auditData:i,event:r,force:n}){if(!e)return{error:Ie};if(!r)return{error:li};let{flightProfile:a}=$i({event:r});if(a){let s=a.flights?.map(({drawId:l})=>l).filter(Boolean),o=SC({eventId:r.eventId,tournamentRecord:e,autoPublish:t,auditData:i,drawIds:s,event:r,force:n});return o.error?o:fR({event:r,name:Xs})}return{...H}}function c_(t){let{matchUpFormat:e,recoveryTimes:i,averageTimes:r,tournamentId:n,eventId:a}=t,s=t?.tournamentRecords??(t?.tournamentRecord&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord})??{};if(!Object.keys(s).length)return{error:Ci};let o=Object.keys(s).filter(u=>!n||n===u);if(n&&!o.includes(n))return{error:ie};let l;for(let u of o){let c=s[u],{event:d}=jn({tournamentRecord:c,eventId:a});a&&d&&(l=!0);let p=LDe({tournamentRecord:c,event:d,matchUpFormat:e,averageTimes:r,recoveryTimes:i});if(p.error)return p}return!a||l?{...H}:{error:os}}function LDe({tournamentRecord:t,recoveryTimes:e,matchUpFormat:i,averageTimes:r,event:n}){if(!t)return{error:Ie};if(r&&!Array.isArray(r))return{error:ie};if(e&&!Array.isArray(e))return{error:ie};let a=cc;if(n){let{extension:s}=mt({element:n,name:a}),o=s?.value||{},l=bW({...o,matchUpFormat:i,averageTimes:r,recoveryTimes:e});xt({element:n,extension:{name:a,value:l}})}else{let{extension:s}=mt({element:t,name:a}),o=s?.value||{},l=bW({...o,matchUpFormat:i,averageTimes:r,recoveryTimes:e});xt({extension:{name:a,value:l},element:t})}return{...H}}function bW(t){let{matchUpRecoveryTimes:e=[],matchUpAverageTimes:i=[],matchUpFormat:r}=t,{averageTimes:n,recoveryTimes:a}=t;n=(n||[]).filter(l=>l?.categoryNames?.length||l?.categoryTypes?.length);let s=n?.length&&i.map(l=>l?.matchUpFormatCodes.includes(r)?{...l,matchUpFormatCodes:l.matchUpFormatCodes?.filter(u=>u!==r)}:l).filter(({matchUpFormatCodes:l})=>l?.length).concat({matchUpFormatCodes:[r],averageTimes:n});a=(a||[]).filter(l=>l?.categoryNames?.length||l?.categoryTypes?.length);let o=a?.length&&e.map(l=>l?.matchUpFormatCodes.includes(r)?{...l,matchUpFormatCodes:l.matchUpFormatCodes?.filter(u=>u!==r)}:l).filter(({matchUpFormatCodes:l,averageTimes:u})=>l?.length||u).concat({matchUpFormatCodes:[r],recoveryTimes:a});return{matchUpAverageTimes:s?.length&&s||i,matchUpRecoveryTimes:o?.length&&o||e}}function MX(t){let{tournamentRecord:e,recoveryMinutes:i,averageMinutes:r,matchUpFormat:n,categoryType:a,eventId:s,event:o}=t;if(!e)return{error:Ie};if(!xa({matchUpFormat:n}))return{error:ie};if(!o)return{error:li};let{averageTimes:l=[],recoveryTimes:u=[]}=vC({tournamentRecord:e,matchUpFormat:n,event:o}),c=o.category,d=c?.categoryName||c?.ageCategoryCode||o?.eventId,p={categoryNames:[d],minutes:{}},f={categoryNames:[d],minutes:{}},m=w=>{if(w.categoryTypes?.includes(a)&&console.log("encountered:",{categoryType:a}),!(w.categoryNames?.includes(d)&&(w.categoryNames=w.categoryNames.filter(y=>y!==d),p={minutes:w.minutes,categoryNames:[d]},!w.categoryNames.length)))return w},h=r&&!isNaN(Ye(r)),g=i&&!isNaN(Ye(i)),I=l.map(m).filter(w=>w?.categoryNames?.length),v=u.map(m).filter(w=>w?.categoryNames?.length);return h&&(Object.assign(p.minutes,{[o?.eventType||Wt]:r}),I.push(p)),g&&(Object.assign(f.minutes,{[o?.eventType||Wt]:i}),v.push(f)),!h&&!g?{error:ie}:c_({averageTimes:h&&I,recoveryTimes:g&&v,tournamentRecord:e,matchUpFormat:n,eventId:s})}function UC(t){if(t.event)return wW({event:t.event});{t.tournamentRecord&&!t.tournamentRecords&&(t.tournamentRecords={[t.tournamentRecord.tournamentId]:t.tournamentRecord});let e=Ge(t,[{[cn]:!0,[N5]:!0}]);if(e.error)return e;let{tournamentRecords:i,eventId:r}=t;for(let n of Object.values(i??{})){let{event:a}=jn({tournamentRecord:n,eventId:r});if(a)return wW({event:a})}}return{error:os}}function wW({event:t}){return fR({event:t,name:cc})}var NX={MON:"MON",TUE:"TUE",WED:"WED",THU:"THU",FRI:"FRI",SAT:"SAT",SUN:"SUN"};function AX(t){return!Array.isArray(t)||rt(t).length!==t.length?!1:t.every(e=>Object.keys(NX).includes(e))}function d_({tournamentRecord:t,event:e,startDate:i}){if(!t)return{error:Ie};if(!e)return{error:li};if(!rl.test(i))return{error:sr};let r=kX(t),n="setEventStartDate";if(r.error)return z({result:r,stack:n});let{tournamentStartDate:a,tournamentEndDate:s}=r,o=new Date(Qe(i)).getTime();if(!a||!s||o<a||o>s)return z({result:{error:sr},stack:n,info:"startDate must be within tournament start and end dates"});let l=e.endDate&&new Date(Qe(e.endDate)).getTime();return l&&o>l&&(e.endDate=i),e.startDate=i,{...H}}function p_(t){let{tournamentRecord:e,event:i,endDate:r}=t;if(!e)return{error:Ie};if(!i)return{error:li};if(!rl.test(r))return{error:sr};let n=kX(e);if(n.error)return n;let{tournamentStartDate:a,tournamentEndDate:s}=n,o=new Date(Qe(r)).getTime();if(!a||!s||o<a||o>s)return{error:sr};let l=i.startDate&&new Date(Qe(i.startDate)).getTime();return l&&o<l&&(i.startDate=r),i.endDate=r,{...H}}function f_(t){let e="setEventDates",i=Ge(t,[{tournamentRecord:!0,event:!0},{[Wr]:u=>rl.test(u),[Fa]:sr,startDate:!1,endDate:!1},{[Wr]:u=>u.filter(Boolean).every(c=>rl.test(c)),[Fa]:sr,activeDates:!1},{[Wr]:AX,weekdays:!1}]);if(i.error)return i;let{tournamentRecord:r,weekdays:n,event:a,startDate:s,endDate:o}=t,l=t.activeDates?.filter(Boolean);if(s&&o){let u=new Date(Qe(s)).getTime(),c=new Date(Qe(o)).getTime();if(u>c)return z({result:{error:ie},stack:e,info:"startDate cannot be after endDate"})}if(l){let u=s||r.startDate,c=o||r.endDate,d=!u||l.every(f=>new Date(f)>=new Date(u)),p=!c||l.every(f=>new Date(f)<=new Date(c));if(!d||!p)return z({result:{error:sr},stack:e})}if(s){let u=d_({tournamentRecord:r,event:a,startDate:s});if(u.error)return z({result:u,stack:e})}if(o){let u=p_({tournamentRecord:r,event:a,endDate:o});if(u.error)return z({result:u,stack:e})}return l&&(a.activeDates=l),n&&(a.weekdays=n),{...H}}function kX(t){let{startDate:e,endDate:i}=t;return!rl.test(e)||!rl.test(i)?z({result:{error:N6},context:{startDate:e,endDate:i}}):{tournamentStartDate:new Date(Qe(e)).getTime(),tournamentEndDate:new Date(Qe(i)).getTime()}}function m_({event:t,orderedDrawIdsMap:e}){if(typeof t!="object")return{error:li};if(!e)return{error:Xe,info:"Missing drawIdsOrderMap"};if(typeof e!="object")return{error:ie,info:"orderedDrawIdsMap must be an object"};let i=Object.values(e);if(!i.every(n=>!Number.isNaN(Number(n))))return{error:ie,info:"drawOrder must be numeric"};if(rt(i).length!==i.length)return{info:"drawOrder values must be unique",error:ie};if(t.drawDefinitions?.length){let n=(t.drawDefinitions||[]).map(({drawId:s})=>s),a=Object.keys(e);if(a?.length&&xi(n,a).length!==n.length)return{error:ie,info:"Missing drawIds"};t.drawDefinitions.forEach(s=>{s.drawOrder=e[s.drawId]})}let{flightProfile:r}=$i({event:t});return r?.flights?.forEach(n=>{n.flightNumber=e[n.drawId]}),{...H}}function h_({tournamentRecord:t,event:e}){if(!t)return{error:Ie};if(!e)return{error:li};let{flightProfile:i}=$i({event:e}),r=i?.flights?.sort((s,o)=>s.flightNumber-o.flightNumber).map(s=>s.drawId).filter(Boolean),n=e.drawDefinitions?.sort((s,o)=>s.drawOrder-o.drawOrder).map(s=>s.drawId).filter(Boolean).filter(s=>!r?.includes(s)),a=Object.assign({},...[...r||[],...n||[]].map((s,o)=>({[s]:o+1})));return a?m_({event:e,orderedDrawIdsMap:a}):{...H}}function OX({autoPublish:t=!0,tournamentRecord:e,auditData:i,drawId:r,event:n,force:a}){if(!e)return{error:Ie};if(!r)return{error:Oo};if(!n)return{error:li};let{flightProfile:s}=$i({event:n});if(s&&s.flights?.find(o=>o.drawId===r)){let o=s.flights.filter(u=>u.drawId!==r),l={name:Xs,value:{...s,flights:o}};Ld({event:n,extension:l})}if(n.drawDefinitions?.find(o=>o.drawId===r)){let o=SC({drawIds:[r],eventId:n.eventId,tournamentRecord:e,autoPublish:t,auditData:i,event:n,force:a});if(o.error)return o}return h_({tournamentRecord:e,event:n})}function xX(t){let e=Ge(t,[{[Ac]:!0,[mr]:!0,[yF]:!1},{replacementIndividualParticipantId:!0,[Wr]:g=>ri(g),existingIndividualParticipantId:!0,[xs]:lr,participantId:!0}]),{replacementIndividualParticipantId:i,existingIndividualParticipantId:r,tournamentRecord:n,drawDefinition:a,participantId:s,event:o,uuids:l}=t;if(e.error)return e;if(o?.eventType!==ls)return{error:Zl};if(!(o?.entries?.filter(({entryStatus:g})=>[ys,sf].includes(g)).map(({participantId:g})=>g)||[]).includes(i))return{error:To};let u=(n.participants||[]).find(g=>g.participantId===s);if(u?.participantType!==pt)return{error:Sp,participant:u};let c=u.individualParticipantIds,d=[i,...c.filter(g=>g!==r)],{participant:p}=Qs({participantIds:d,tournamentRecord:n}),f;if(p)f=p.participantId;else{let g={participantId:l?.pop(),participantRole:Kr,individualParticipantIds:d,participantType:pt},I=ul({participant:g,returnParticipant:!0,tournamentRecord:n});if(I.error)return I;f=I.participant.participantId}let{flightProfile:m}=$i({event:o});if(a){let g=m?.flights?.find(({drawId:I})=>I===a.drawId);g&&(g.drawEntries=g.drawEntries.map(I=>I.participantId===s?{...I,participantId:f}:I)),a.entries=a.entries.map(I=>I.participantId===s?{...I,participantId:f}:I);for(let I of a.structures||[])if(I.structures){I.positionAssignments=void 0;for(let v of I.structures)v.positionAssignments=v.positionAssignments.map(w=>w.participantId===s?{...w,participantId:f}:w)}else I.positionAssignments&&(I.positionAssignments=I.positionAssignments.map(v=>v.participantId===s?{...v,participantId:f}:v))}o.entries=o.entries.map(g=>g.participantId===s&&{...g,participantId:f}||g.participantId===i&&{...g,participantId:r}||g);let h=n.events.some(({entries:g,eventId:I,drawDefinitions:v})=>o.eventId===I?v.some(({drawId:w,entries:y})=>w===a?.drawId?!1:y?.find(b=>b.participantId===s)):g?.find(w=>w.participantId===s));if(!h){let g=vh({addIndividualParticipantsToEvents:!1,participantIds:[s],tournamentRecord:n});if(g.error)return g}return{...H,participantOtherEntries:h,newPairParticipantId:f}}function kS(t){let{flight:e,suppressNotifications:i,modifyEventEntries:r,existingDrawCount:n,allowReplacement:a,checkEntryStatus:s,tournamentRecord:o,drawDefinition:l,event:u}=t;if(!l)return{error:_e};if(!u)return{error:li};u.drawDefinitions||(u.drawDefinitions=[]);let{drawId:c,drawName:d,entries:p}=l,{entries:f}=u,m=0;if(n!==void 0&&n!==u.drawDefinitions.length)return{error:ie,info:"drawDefintions count mismatch"};let{flightProfile:h}=$i({event:u}),g=e&&h?.flights?.find(R=>R.flightNumber===e.flightNumber),I=h?.links?.find(R=>R?.target?.drawId===c)?.source?.drawId;if(I&&!u.drawDefinitions.find(R=>R.drawId===I))return z({result:{error:_e},info:{sourceDrawId:I}});if(g&&g.drawId!==l.drawId)return z({result:{error:em},info:{relevantFlight:g}});let v=p?.every(({participantId:R,entryStatus:C})=>{let M=g?.drawEntries.find(N=>N.participantId===R);return!C||M?.entryStatus===C}),w=!s||f&&p?.every(({participantId:R,entryStatus:C,entryStage:M})=>f.find(N=>N.participantId===R&&(!N.entryStage||N.entryStage===M))?.entryStatus===C);if(g&&!v)return z({result:{error:em},context:{drawEntriesPresentInFlight:v,matchingEventEntries:w,relevantFlight:g},info:"Draw entries are not present in flight or do not match entryStatuses"});if(r&&p?.filter(Boolean).forEach(R=>{if(R?.entryStatus&&so.includes(R?.entryStatus)){let C=f?.filter(Boolean).find(M=>M.participantId===R.participantId);C&&R.entryStatus&&C?.entryStatus!==R.entryStatus&&(C.entryStatus=R.entryStatus,m+=1)}}),f&&!w)return z({result:{info:"Draw entries do not match event entryStatuses",context:{matchingEventEntries:w,eventEntries:f},error:em}});let y=h?.flights?.map(({flightNumber:R})=>!isNaN(R)&&Ye(R))?.filter(Boolean)||[],b=u.drawDefinitions.map(({drawOrder:R})=>R&&Ye(R))?.filter(Boolean)||[],S=Math.max(0,...b,...y)+1,U=h?.flights?.find(R=>R.drawId===c),T;if(U){U.drawName=l.drawName,T={name:Xs,value:{...h,flights:h.flights}};let R=U.flightNumber;R&&!b.includes(R)?S=R:U.flightNumber=S}else{let R=h?.flights||[];R.push({manuallyAdded:!0,flightNumber:S,drawEntries:p,drawName:d,drawId:c}),T={name:Xs,value:{...h||{},flights:R}}}Ld({event:u,extension:T}),Object.assign(l,{drawOrder:S});let P=u.drawDefinitions.find(R=>R.drawId===c),D=o?.tournamentId,E=u.eventId;if(P){if(!a)return{error:n6};let R=Rn({drawDefinition:P})?.matchUps?.map(Ir)??[],C=Rn({drawDefinition:l})?.matchUps;if(!i){R?.length&&Pu({matchUpIds:R,action:"modifyDrawDefinition",tournamentId:D,eventId:E}),C?.length&&hd({matchUps:C,tournamentId:D,eventId:E}),u.drawDefinitions=u.drawDefinitions.map(N=>N.drawId===c?l:N);let M=l.structures?.map(({structureId:N})=>N);ti({drawDefinition:l,tournamentId:D,structureIds:M,eventId:E})}}else if(u.drawDefinitions.push(l),!i){let{matchUps:R}=Rn({drawDefinition:l,event:u});R&&hd({tournamentId:o?.tournamentId,matchUps:R}),Hw({drawDefinition:l,tournamentId:D,eventId:E})}return{...H,modifiedEventEntryStatusCount:m}}function FX(t){let{provisionalPositioning:e,useExistingSeedLimit:i,tournamentRecord:r,drawDefinition:n,seedingProfile:a,structureId:s,assignments:o,drawId:l,event:u}=t,c=0;if(!o?.length)return{error:k1};if(!r)return{error:Ie};if(!l)return{error:Oo};let d=ds({provisionalPositioning:e,drawDefinition:n,structureId:s});if(d.error)return d;let{seedAssignments:p,seedLimit:f}=d,m=Object.assign({},...(p??[]).filter(I=>I.seedNumber).map(I=>({[I.seedNumber]:I})));o.forEach(I=>{let{seedNumber:v}=I;f&&v<=f&&(!i||m[v])&&(m[v]=I)});let h=Object.values(m),g=h.map(I=>I?.participantId).filter(Boolean);if(g.length!==zY(g).length)return{error:a6};for(let I of h){let v=dv({...I,provisionalPositioning:e,tournamentRecord:r,drawDefinition:n,seedingProfile:a,structureId:s,event:u});if(v?.error)return v;v?.success&&c++}return c?{...H,modifications:c}:{error:QI}}function g_({deleteExisting:t,event:e,flightProfile:i}){let r="attachFlightProfile";if(!i)return z({result:{error:Xe},stack:r});if(!e)return z({result:{error:li},stack:r});let{flightProfile:n}=$i({event:e});return n&&!t?z({result:{error:K1},stack:r}):e.drawDefinitions?.length?z({result:{error:ZY},stack:r}):(Ld({event:e,extension:{name:Xs,value:i}}),{flightProfile:ke(i,!1,!0),...H})}function _De({tournamentRecord:t,scaleAttributes:e,participantIds:i}){if(!t)return{error:Ie};if(!i)return{error:Od};if(!e)return{error:Xe,info:"scaleAttributes required"};let{scaleType:r,eventType:n,scaleName:a}=e,s=[CK,r,n,a].join(".");return t.participants?.forEach(o=>{i.includes(o.participantId)&&o.timeItems&&(o.timeItems=o.timeItems.filter(l=>l&&l?.itemType!==s))}),{...H}}function I_({tournamentRecord:t,scaleAttributes:e,drawDefinition:i,entryStatuses:r,drawId:n,event:a,stage:s}){if(!a)return{error:li};if(r&&!Array.isArray(r))return z({result:{error:ie},info:Np("entryStatus"),stack:"removeScaleValues"});let o=a.entries;if(n){let{flightProfile:u}=$i({event:a}),c=u?.flights?.find(d=>d.drawId===n);c?o=c.drawEntries:o=i?.entries}let l=(o||[]).filter(u=>(!s||!u.entryStage||u.entryStage===s)&&(!r||r.includes(u.entryStatus))).map(vt);return _De({tournamentRecord:t,scaleAttributes:e,participantIds:l})}function TC({removePriorValues:t,tournamentRecord:e,displaySettings:i,status:r=Ha,event:n}){if(!e)return z({result:{error:Ie}});if(!n)return z({result:{error:li}});if(!bt(i))return z({result:{error:Xe}});if(bt(i.draws))for(let s of Object.keys(i.draws)){let o=i.draws[s].scheduleDetails??[];if(o.length){let l=[];for(let u of o){let c=l.find(d=>fme(d.attributes,u.attributes));c?.dates&&u.dates?c.dates.push(...u.dates):l.push(u)}i.draws[s].scheduleDetails=l}}let a=yv({statusObject:{displaySettings:i},removePriorValues:t,status:r,event:n});return a.error?a:{...H}}function LX({tournamentRecord:t,drawDefinition:e,entryStatuses:i,scaleName:r,drawId:n,event:a,stage:s}){if(!t)return{error:Ie};if(!a)return{error:li};r=r||a.category?.categoryName||a.category?.ageCategoryCode;let o={eventType:a.eventType,scaleType:jl,scaleName:r};return I_({tournamentRecord:t,scaleAttributes:o,drawDefinition:e,entryStatuses:i,drawId:n,event:a,stage:s})}function _X(t){let e=Ge(t,[{[mr]:!0},{eventIds:!0,[zn]:an}]);if(e.error)return e;let{removePairParticipants:i,tournamentRecord:r,eventIds:n}=t,a=[],s=[],o=[],l=[];if(r.events=(r.events||[]).filter(u=>{if(n.includes(u.eventId)){let p={action:tD,payload:{events:[u]}};a.push(p),s.push({tournamentId:r.tournamentId,eventName:u.eventName,eventType:u.eventType,category:u.category,eventId:u.eventId,gender:u.gender})}let c=u.eventType===ls?(u.entries||[]).map(({entryStatus:p,participantId:f})=>p!==ys&&f).filter(Boolean):[],d=n.includes(u.eventId);return d?l.push(...c):o.push(...c),!d}),i){let u=l.filter(c=>!o.includes(c));r.participants=r.participants.filter(({participantId:c})=>!u.includes(c))}if(CS({tournamentRecord:r}),a.length)if(qE(Ju)){let u=r.tournamentId;at({topic:Ju,payload:{type:tD,tournamentId:u,detail:a}})}else wS({tournamentRecord:r,timeItem:{itemValue:s,itemType:tD}});return{...H}}function $X(t){let e=Ge(t,[{tournamentRecord:!0,eventId:!0,event:!0},{eventUpdates:!0,_ofType:Yn}]);if(e.error)return e;let{eventUpdates:i,event:r}=t,n="modifyEvent",a=GDe(t),s=HDe({enteredParticipants:a}),{enteredParticipantGenders:o,enteredParticipantTypes:l}=s,u=$i({event:r})?.flightProfile?.flights,c=!r.drawDefinitions?.length&&!u?.length,d=WDe({noFlightsNoDraws:c,enteredParticipantGenders:o,eventUpdates:i,stack:n});if(d.error)return d;let p=zDe({enteredParticipantTypes:l,eventUpdates:i,stack:n});if(p.error)return p;let f=$De({...t,...s,enteredParticipants:a,stack:n});if(f.error)return f;let m=jDe({...t,stack:n});return m.error?m:(i.eventType&&(r.eventType=i.eventType),i.eventName&&(r.eventName=i.eventName),i.gender&&(r.gender=i.gender),{...H})}function $De(t){let e=t.eventUpdates?.category;if(!e)return{...H};let i=mb({category:e});if(i.error)return i;if(t.event.eventType===rr){let r=BDe(t);if(r.error)return r}if(t.enteredParticipants?.length){let r=VDe(t,e);if(r.error)return r}return{...H}}function BDe(t){let e=t.event?.drawDefinitions?.map(n=>$o(n))??[],i=$o(t.event),r=(Ru(t)?.matchUps??[]).map(n=>$o(n))??[];return[i,...e,...r].filter(Boolean).every(n=>n.collectionDefinitions.every(a=>!a.category||Ow({category:t.eventUpdates.category,childCategory:a.category})))?{...H}:z({result:{error:lb},stack:t.stack})}function VDe(t,e){let i=t.eventUpdates.startDate||t.event.startDate||t.tournamentRecord.startDate,r=t.eventUpdates.endDate||t.event.endDate||t.tournamentRecord.endDate,n=t.enteredParticipants.flatMap(o=>o.participantType===gt?[o]:o.individualParticpants??[]),a=Up({category:e,consideredDate:i}),s=Up({category:e,consideredDate:r});if(a?.ageMinDate||a?.ageMaxDate||s?.ageMinDate||s?.ageMaxDate)for(let o of n){let l=o.person?.birthDate;if(!l)return z({result:{error:E6},stack:t.stack});let u=new Date(l).getTime(),c=SW(u,a,t.stack);if(c)return c;let d=SW(u,s,t.stack);if(d)return d}return{...H}}function SW(t,e,i){if(!e)return null;if(e.ageMinDate||e.ageMaxDate){let r=new Date(e.ageMinDate).getTime(),n=new Date(e.ageMaxDate).getTime();if(t<r||t>n)return z({result:{error:O6},stack:i})}return null}function jDe(t){let{tournamentRecord:e,eventUpdates:i,event:r,stack:n}=t;if(i.startDate||i.endDate){let a=f_({startDate:i.startDate||r.startDate||e.startDate,endDate:i.endDate||r.endDate||e.endDate,tournamentRecord:e,event:r});if(a.error)return z({result:a,stack:n})}return{...H}}function GDe(t){let{tournamentRecord:e,event:i}=t,r=i?.entries?.filter(({entryStatus:n})=>{let a=n;return[...so,Fs].includes(a)}).map(({participantId:n})=>n)??[];return r?Ei({participantFilters:{participantIds:r},withIndividualParticipants:!0,tournamentRecord:e}).participants??[]:[]}function HDe({enteredParticipants:t}){let e=[],i=t.reduce((n,a)=>{let s=a.person?.sex?[a.person.sex]:a.individualParticpants?.map(o=>o.person?.sex)||[];return e.push(...s),n.includes(a.participantType)?n:n.concat(a.participantType)},[]),r=rt(e);return{enteredParticipantTypes:i,enteredParticipantGenders:r}}function WDe({noFlightsNoDraws:t,enteredParticipantGenders:e,eventUpdates:i,stack:r}){let n=!e.length||!i.gender||eu(i.gender)||e.length===1&&e[0]===i.gender||t&&Na(i.gender);return i.gender&&!n?z({context:{gender:i.gender,validGender:n},result:{error:My},stack:r}):{...H}}function zDe({enteredParticipantTypes:t,eventUpdates:e,stack:i}){let r=(t.includes(rr)&&[rr]||t.includes(gt)&&[nl]||t.includes(pt)&&[ls]||[ls,nl,rr]).includes(e.eventType??"");return e.eventType&&!r?z({context:{participantType:e.eventType,validEventType:r},result:{error:Zl},stack:i}):{...H}}function DC({qualifyingPositions:t,drawEntries:e=[],drawName:i,drawId:r,event:n,stage:a}){let s="addFlight";if(!n)return z({result:{error:li},stack:s});if(!i)return z({result:{error:Xe},stack:s});if(e?.length){let f=(n.entries??[]).map(vt),m=e.map(vt);if(xi(m,f).length!==m.length)return z({result:{error:ie},stack:s})}let o=$i({event:n})?.flightProfile,l=o?.flights?.map(({flightNumber:f})=>!isNaN(f)&&Ye(f))?.filter(Boolean)||[],u=Math.max(0,...l)+1,c={drawId:r||Et(),flightNumber:u,drawEntries:e,drawName:i};if(a&&(c.stage=a),t&&(c.qualifyingPositions=t),(o?.flights||[]).find(({drawId:f})=>f===c.drawId))return z({result:{error:l4},stack:s});let d=(o?.flights||[]).concat(c),p={name:Xs,value:{...o||{},flights:d}};return Ld({event:n,extension:p})}var BX={};ct(BX,{drawMatic:()=>R0,garman:()=>zX,generateAdHocMatchUps:()=>KR,generateAdHocRounds:()=>E0,generateAndPopulatePlayoffStructures:()=>GL,generateCourts:()=>v_,generateDrawDefinition:()=>AS,generateDrawMaticRound:()=>n0,generateDrawStructuresAndLinks:()=>t0,generateDrawTypeAndModifyDrawDefinition:()=>i0,generateFlightProfile:()=>KDe,generateLineUps:()=>WX,generateQualifyingStructure:()=>LL,generateSeedingScaleItems:()=>gX,generateStatCrew:()=>XDe,generateVoluntaryConsolation:()=>Q8,roundRobinGroups:()=>iye});var qDe="splitLevelBased",VX="splitWaterfall",jX="splitShuttle",YDe={SPLIT_LEVEL_BASED:qDe,SPLIT_WATERFALL:VX,SPLIT_SHUTTLE:jX};function KDe(t){let{drawNameRoot:e="Flight",attachFlightProfile:i,tournamentRecord:r,scaleAttributes:n,scaleSortMethod:a,deleteExisting:s,sortDescending:o,drawNames:l=[],flightsCount:u,splitMethod:c,uuids:d=[],event:p,stage:f}=t;if(!p)return{error:li};let m=p.entries??[],{flightProfile:h}=$i({event:p});if(h&&i&&!s)return{error:K1};let g=t.scaledEntries??Th({tournamentRecord:r,scaleAttributes:n,scaleSortMethod:a,sortDescending:o,event:p,stage:f}).scaledEntries,I=new Set(g.map(vt)),v=Dn(m.filter(({participantId:D})=>!I.has(D)).filter(D=>(!f||!D.entryStage||D.entryStage===f)&&(!D.entryStatus||of.includes(D.entryStatus)))),w=g.concat(...v),y=w.length,b=Math.ceil(y/u),S=yr(w,b);c===VX?S=jk(w,u):c===jX&&(S=jk(w,u,!0));function U(D){return(D||[]).map(({participantId:E,scaleValue:R})=>{let C=m.find(M=>M.participantId===E);return C?.scaleValue&&R&&(C.scaleValue=R),C}).sort((E,R)=>E.scaleValue-R.scaleValue).map((E,R)=>(E.scaleValue&&(E.seedNumber=R+1),E))}let T=Re(0,u).map(D=>{let E=D+1;return{flightNumber:E,drawId:d?.pop()??Et(),drawEntries:U(S[D]),drawName:l?.length&&l[D]||`${e} ${E}`}}),P={scaleAttributes:n,splitMethod:c,flights:T};if(i){let D=g_({flightProfile:P,deleteExisting:s,event:p});return{splitEntries:ia()&&S||void 0,...D}}else return{flightProfile:P,...H}}function GX({json:t,tagName:e}){let i=Object.keys(t).filter(a=>Array.isArray(t[a])).map(a=>({key:a,value:t[a].filter(s=>typeof s=="object"&&Object.keys(s).length===1)})),r=Object.keys(t).filter(a=>typeof t[a]=="object"&&!Array.isArray(t[a])).map(a=>({key:a,value:t[a]})),n=Object.keys(t).filter(a=>["string","number"].includes(typeof t[a])).map(a=>({key:a,value:t[a]}));return HX({tagName:e,attributes:n,childArrays:i,childObjects:r})}function HX(t){let{tagName:e,attributes:i=[],childArrays:r=[],childObjects:n}=t,a=`\r
`,s=f=>{let m=Object.keys(f)[0],h=f[m];return{key:m,value:h}},o=r?.map(({key:f,value:m})=>HX({tagName:f,childObjects:m.map(s)})).join(`\r
`),l=n?.map(({key:f,value:m})=>GX({tagName:f,json:m??[]})).join(`\r
`),u=i?.map(({key:f,value:m})=>`${f}="${m}"`).join(" "),c=u?` ${u}`:"";if(e==="childArray")return l;let d=l?.length?`${a}${l}${a}`:"",p=o?.length?`${a}${o}${a}`:"";return`<${e}${c}>${d}${p}</${e}>`}function XDe(t){let e=Ge(t,[{[mr]:!0}]);if(e.error)return e;let{tournamentRecord:i}=t,{startDate:r,tournamentId:n,tournamentName:a}=i,{participantMap:s,matchUps:o,mappedMatchUps:l}=Ei({withMatchUps:!0,withEvents:!0,tournamentRecord:i}),u=i.participants.filter(w=>w.participantType===Lt),c=o?.filter(w=>w.matchUpType===Lt)??[],d=c?.reduce((w,y)=>{let b=y?.tieMatchUps??[];return b&&[...w,...b]},[])??[],p=o?.filter(w=>w.matchUpType===Wt)??[],f=o?.filter(w=>w.matchUpType===$t)??[],m=d.length===p.length+f.length,h=c.length===1&&m,g={mappedMatchUps:l,participantMap:s,tournamentName:a,tournamentId:n,tournament:m?"N":"Y",startDate:r},I=[],v=[];if(h){let w=c[0],{json:y,xml:b}=UW({teamParticipants:u,teamMatchUp:w,...g,doubles:f,singles:p});v.push(y),I.push(b)}else for(let w of c){let y=w?.sides?.map(({participant:T})=>T?.participantId).filter(Boolean);if(y?.length!==2)continue;let b=y.map(T=>T&&s?.[T]?.participant),{xml:S,json:U}=UW({doubles:w.tieMatchUps?.filter(T=>T.matchUpType===$t),singles:w.tieMatchUps?.filter(T=>T.matchUpType===Wt),teamParticipants:b,teamMatchUp:w,...g});v.push(U),I.push(S)}return{json:v,xml:I,...H}}function UW({teamParticipants:t,mappedMatchUps:e,participantMap:i,tournamentName:r,tournamentId:n,teamMatchUp:a,tournament:s,startDate:o,doubles:l,singles:u}){let c=t?.find(y=>y.participantRoleResponsibilities?.includes("Home")),d=t?.filter(y=>y.participantId!==c?.participantId),p=Os(o,"/","MDY"),f=c?.participantName||d?.[1]?.participantName,m=c?.participantId||d?.[1]?.participantId,h=d?.[0]?.participantName,g=d?.[0]?.participantId,I={},v=t.map(y=>({team:{...ZDe({teamParticipant:y,teamMatchUp:a,uniValues:I,participantMap:i,mappedMatchUps:e,homeid:m})}})),w=Ve({venue:{tournamentname:s?r:void 0,neutralgame:c?"N":"Y",gameid:n,officials:{},tournament:s,rules:{},homename:f,visname:h,homeid:m,visid:g,date:p},childArray:v,singles_matches:u?.map(y=>TW({matchUp:y,homeid:m,uniValues:I})),doubles_matches:l?.map(y=>TW({matchUp:y,homeid:m,uniValues:I}))});return{json:w,xml:GX({json:w,tagName:"tngame"})}}function JDe({homeid:t,uniValues:e,participant:i}){if(!i)return{};let r=i.individualParticipants?.length===2,n=r?rt(i.individualParticipants?.map(h=>h.teams?.[0]?.participantId)):[],a=r?rt(i.individualParticipants?.map(h=>h.teams?.[0]?.teamId)):[],s=!r&&i.teams?.[0]?.participantId||n?.length===1&&n[0]||void 0,o=!r&&i.teams?.[0]?.teamId||a?.length===1&&a[0]||s,l=r?void 0:i.participantName,u=i.individualParticipants?.[0]?.participantName,c=i.individualParticipants?.[1]?.participantName,d=t&&(s===t?"H":"V")||"",p=r?void 0:e[s][i.participantId],f=e[s][i.individualParticipants?.[0]?.participantId],m=e[s][i.individualParticipants?.[1]?.participantId];return Ve({vh:d,uni:p,uni_1:f,uni_2:m,team:o,name:l,name_1:u,name_2:c})}function QDe({sets:t,sideNumber:e}){return Object.assign({},...t?.map(i=>{let{setNumber:r,side1Score:n,side2Score:a,side1TiebreakScore:s,side2TiebreakScore:o}=i,l=`set_${r}`,u=`tie_${r}`,c=e===1?n:a,d=e===1?s:o;return{[l]:c,[u]:d}})??[])}function ZDe({teamParticipant:t,teamMatchUp:e,participantMap:i,mappedMatchUps:r,homeid:n,uniValues:a}){let{participantId:s,participantName:o}=t,l=n&&(s===n?"H":"V")||"",u=i?.[s]?.matchUps,c=u&&Object.keys(u),d=e?.sides?.find(({participant:y})=>y.participantId===s)?.sideNumber,p=e?.score?.sets?.[0]?.[`side${d}Score`]??0;a[s]={};let f={SINGLES:{w:0,l:0},DOUBLES:{w:0,l:0}},m=[],h=[],g=0;for(let y of c??[]){let b=r?.[y],S=b.sides.find(({participant:T})=>T.participantId===s)?.sideNumber,U=b.score?.sets?.[0]?.[`side${S}Score`]??0;g+=U;for(let T of b.tieMatchUps??[]){let{matchUpType:P,winningSide:D}=T,E=D&&(D===S?"w":"l")||"";E&&(f[P][E]+=1);let R=E==="w"?"1":"0",C=E==="l"?"1":"0";if(P===Wt){let M=h.length+1;h.push({singles_pair:{pair:M,won:R,lost:C,tied:"0"}})}else if(P===$t){let M=m.length+1;m.push({doubles_pair:{pair:M,won:R,lost:C,tied:"0"}})}}}let I=[{singles:{childArray:h,won:f.SINGLES.w,lost:f.SINGLES.l}},{doubles:{childArray:m,won:f.DOUBLES.w,lost:f.DOUBLES.l}}],v=[],w=1;for(let y of t.individualParticipantIds){let b=i?.[y];if(b){let{participant:S,counters:U}=b,T={won:U?.DOUBLES?.wins||0,lost:U?.DOUBLES?.losses||0},P={won:U?.SINGLES?.wins||0,lost:U?.SINGLES?.losses||0},{participantName:D,participantId:E}=S;a[s][E]=w,v.push({player:{name:D,uni:w,singles:P,doubles:T}})}w+=1}return{vh:l,id:s,name:o,score:p||g,totals:I,childArray:v}}function TW({matchUp:t,homeid:e,uniValues:i}){let{collectionPosition:r,orderOfFinish:n,matchUpType:a,sides:s}=t??{},o=s?.map(l=>{let{sideNumber:u,participant:c}=l,d=QDe({sets:t.score?.sets,sideNumber:u});return{[a===Wt?"singles_score":"doubles_score"]:{...JDe({homeid:e,uniValues:i,participant:c}),...d}}});return{[a===Wt?"singles_match":"doubles_match"]:{match:r,order:n,childArray:o}}}var ePe="DESC",xO="DESC",tPe={ASC:"ASC",ASCENDING:"ASC",DESC:ePe,DESCENDING:xO};function WX(t){let{tieFormat:e}=t,{useDefaultEventRanking:i,tournamentRecord:r,drawDefinition:n,scaleAccessor:a,singlesOnly:s,attach:o,event:l}=t;if(l?.eventType!==ya)return{error:Zl};if(!r)return{error:Ie};if(!e&&!n)return{error:Oa};if(e=e??vn({drawDefinition:n,event:l})?.tieFormat,Bn({tieFormat:e}).error)return{error:Vl};if(typeof a!="object"&&!i)return{error:ie,context:{scaleAccessor:a}};let u={},c=(n?.entries??l?.entries??[]).filter(E=>E?.entryStatus===na).map(vt),{participants:d=[]}=Ei({withIndividualParticipants:!0,withScaleValues:!0,tournamentRecord:r}),p=d.filter(({participantId:E})=>c.includes(E)),f=E=>E===ou?"rankings":"ratings",m=l?.category?.categoryName??l?.category?.ageCategoryCode,{scaleName:h=m,scaleType:g=ou,sortOrder:I,accessor:v}=a||{},w=f(g),y=(E,R)=>{let C=E[w]?.[R];if(!C&&i&&(C=E[w]?.[Qf]),Array.isArray(C)){let M=C.find(N=>N.scaleName===h)?.scaleValue;if(Ni(M))return M;if(v&&typeof M=="object")return M[v]}return 0},b=(E,R,C)=>{let M=I===xO?R:E,N=I===xO?E:R;return y(M,C)-y(N,C)},S=(E,R)=>b(E,R,Qf),U=(E,R)=>b(E,R,wp),T=[],P=e?.collectionDefinitions??[];for(let E of p){let R=E.individualParticipants?.sort(S)??[],C=s?R:E.individualParticipants?.sort(U)??[],M={};for(let A of P){let O=[],{collectionId:k,matchUpCount:F,matchUpType:x,gender:L}=A,$=Di(Qf)(x);Re(0,F).forEach(V=>{let _=$?R:C??[],B=V+1,G=[];Re(0,$?1:2).forEach(j=>{let K=_?.find(Y=>{let X=on(L),Z=X&&(il(L)&&X||Na(L)&&[er,Hr][j]);return(!Z||Z===Y.person?.sex)&&!O.includes(Y.participantId)})?.participantId;K&&(G.push(K),O.push(K),M[K]||(M[K]=[]),M[K].push({collectionPosition:B,collectionId:k}))}),$||T.push(G)})}let N=Object.keys(M).map(A=>({collectionAssignments:M[A],participantId:A}));u[E.participantId]=N}let D=[];for(let E of T){let{participant:R}=Qs({tournamentParticipants:d,participantIds:E});if(!R){let C={individualParticipantIds:E,participantRole:Kr,participantType:pt};D.push(C)}}if(o){for(;D.length;)ul({participant:D.pop(),tournamentRecord:r});xt({element:n,extension:{name:uc,value:u}})}return{...H,lineUps:u,participantsToAdd:D}}function v_(t){if(!t)return{error:Xe};let e=Ge(t,[{dates:!1,[Wr]:s=>Array.isArray(s)&&s.every(Pn)},{uuids:!1,[Wr]:s=>Array.isArray(s)&&s.every(ri)},{startTime:!1,endTime:!1,[Wr]:nF},{idPrefix:!1,namePrefix:!1,[Wr]:ri},{count:!0,[Wr]:Ni}]);if(e.error)return e;let{startDate:i,endDate:r}=t.tournamentRecord??{},n=t.dates||i&&r&&Xg(i,r)||[],a=Re(1,t.count+1).map(s=>Ve({courtId:t.uuids?.pop()??(t.idPrefix&&`${t.idPrefix}-${s}`)??Et(),courtName:t.courtNames?.pop()??(t.namePrefix&&`${t.namePrefix} ${s}`),dateAvailability:n.map(o=>({startTime:t.startTime??"08:00",endTime:t.endTime??"20:00",date:o}))}));return{...H,courts:a}}var zX={};ct(zX,{default:()=>nPe,garman:()=>KX});function wv(t){let e=Ge(t,[{courtDate:!0,_ofType:Yn}]);if(e.error)return e;let{includeBookingTypes:i=[],courtDate:r}=t,n=[],a=Xi(r.startTime);(r.bookings||[]).filter(o=>!o.bookingType||!i.includes(o.bookingType)).sort((o,l)=>(kD(o.startTime)||"").localeCompare(kD(l.startTime)||"")).forEach(o=>{let l={startTime:ci(a.toISOString()),endTime:o.startTime};Xi(o.startTime)>a&&n.push(l),Xi(o.endTime)>a&&(a=Xi(o.endTime))});let s={startTime:ci(a.toISOString()),endTime:r.endTime};return Xi(r.endTime)>a&&n.push(s),{timeSlots:n}}function iPe({averageMatchUpMinutes:t,includeBookingTypes:e,periodStartTime:i,periodEndTime:r}){let n=s=>{let{timeSlots:o}=wv({includeBookingTypes:e,courtDate:s});return!!o?.filter(a)?.length};function a(s){let o=Xi(s.startTime),l=Xi(s.endTime);return o>i||l<r?!1:kw(i,l)>=t}return{enoughTime:n}}function qX(t){let e=Ge(t,[{periodStart:!0,date:!0},{courts:!0,_ofType:an}]);if(e.error)return e;let{averageMatchUpMinutes:i,includeBookingTypes:r,periodStart:n,date:a}=t,s=t.courts,o=Xi(n),l=sF(o,i),{enoughTime:u}=iPe({averageMatchUpMinutes:i,includeBookingTypes:r,periodStartTime:o,periodEndTime:l});return{availableToScheduleCount:(s?.filter(c=>{if(!Array.isArray(c.dateAvailability))return!1;let d=bd({date:a,court:c});return!!(d&&u(d))})||[]).length,...H}}function PC(t){let{remainingScheduleTimes:e=[],clearScheduleDates:i,periodLength:r=30,scheduleDate:n,courts:a=[]}=t,{bookings:s=[]}=t;if(!Array.isArray(a)||!a.length)return{error:ie,courts:a};if(!Array.isArray(s))return{error:CD};if(!Pn(n))return{error:sr};i&&(Array.isArray(i)?i.includes(n)&&(s=[]):s=[]);let{courtBookings:o,unassignedBookings:l}=s.reduce((p,f)=>{let{courtId:m}=f;return m?p.courtBookings[m]?p.courtBookings[m].push(f):p.courtBookings[m]=[f]:p.unassignedBookings.push(f),p},{courtBookings:{},unassignedBookings:[]}),u=a.map((p,f)=>{let{courtId:m,courtName:h}=p,g=o[m]||[],I=bd({date:n,court:p})||{},{bookings:v=[],startTime:w,endTime:y,date:b}=I,S=[e[f]&&{startTime:w,endTime:e[f]},...ke(v,!1,!0),...g].filter(Boolean);return{courtId:m,courtName:h,dateAvailability:{bookings:S,startTime:w,endTime:y,date:b}}});l.sort((p,f)=>Pt(p.startTime)-Pt(f.startTime));let c=()=>u.flatMap(p=>{let f=p.dateAvailability,{timeSlots:m=[]}=wv({courtDate:f});return{courtName:p.courtName,courtId:p.courtId,timeSlots:m}}),d=[];for(let p of l){let{startTime:f,endTime:m,averageMinutes:h,recoveryMinutes:g,matchUpId:I}=p,v=Pt(f),w=Pt(m),y=c().reduce((b,{courtId:S,courtName:U,timeSlots:T})=>{let P;return T.find(({startTime:D,endTime:E})=>{P=Pt(D)-v;let R=v>=Pt(D);return w<=Pt(E)&&b.startDifference!==0&&((P===0||P+r>=0)&&(b.startDifference===void 0||P<b.startDifference)||R)})?{courtName:U,courtId:S,startDifference:P}:b},{});if(y.courtId){let b={averageMinutes:h,recoveryMinutes:g,matchUpId:I,startTime:f,endTime:m};d.push(b),u.find(({courtId:S})=>S===y.courtId)?.dateAvailability.bookings.push(b)}else console.log({unassignedBooking:p})}return{virtualCourts:u.map(({courtId:p,courtName:f,dateAvailability:m})=>({dateAvailability:[m],courtName:f,courtId:p})),assignedBookings:d}}function EC({averageMatchUpMinutes:t,periodLength:e=30,recoveryMinutes:i}){let r=(t||90)+(i||0);return e>r?r:e||30}function YX(t){let{startTime:e="8:00",endTime:i="20:30",count:r=10,date:n}=t??{};return Re(0,r).map(()=>({dateAvailability:[{date:n,startTime:e,endTime:i}]}))}function dI({scheduleDate:t,startTime:e,endTime:i,courts:r}){let n=e&&"startTime"||i&&"endTime"||void 0;return r.reduce((a,s)=>{let o=bd({date:t,court:s}),l=n&&(o?.[n]||s[n]);return l&&(!a||e&&Pt(l)<Pt(a)||i&&Pt(l)>Pt(a))?l:a},void 0)}function rPe({averageMinutes:t,startTime:e,endTime:i,courts:r,date:n}){e=e||dI({courts:r,scheduleDate:n,startTime:!0}),i=i||dI({courts:r,scheduleDate:n,endTime:!0});let a;if(e&&i){let s=Xi(e),o=Xi(i);for(let l of r||[]){if(!Array.isArray(l.dateAvailability))continue;let u=bd({court:l,date:n}),{timeSlots:c}=wv({courtDate:u});c?.forEach(d=>{let p=Xi(d.startTime),f=Xi(d.endTime);if(p>o||p<s||f<s)return!1;if(kw(p,f)>=t){let m=ci(p.toISOString());m&&(!a||m<a)&&(a=m)}})}}return{firstTimeSlotStartTime:a}}function y_(t){let e=Ge(t,[{courts:!0,_ofType:an}]);if(e.error)return e;let{date:i=rF(),startTime:r="08:00",endTime:n="19:00",periodLength:a,courts:s}=t,{calculateStartTimeFromCourts:o=!0,remainingScheduleTimes:l,averageMatchUpMinutes:u,clearScheduleDates:c,courtsCount:d,bookings:p}=t;a=a||EC({averageMatchUpMinutes:u}),i=Qe(i),r=ci(r),n=ci(n);let f=0,m=0,h=0,g=0,I=0;!s&&d&&(s=YX({startTime:r,endTime:n,count:d,date:i}));let{virtualCourts:v}=PC({remainingScheduleTimes:l,clearScheduleDates:c,scheduleDate:i,periodLength:a,bookings:p,courts:s}),{firstTimeSlotStartTime:w}=rPe({averageMinutes:u,courts:v,startTime:r,endTime:n,date:i});o&&w&&(r=w??r);let y=Pt(r),b=Pt(n)-y,S=Math.floor(b/a),U=Re(0,S+1).map(T=>{let P=y+T*a,D=Lhe(P),E=qX({courts:v??[],averageMatchUpMinutes:u,periodStart:D,date:i});if(E.error)return{error:E.error};let{availableToScheduleCount:R=0}=E,C=R>m?R-m:0;I+=T?R:0;let M=T?I/T:R,N=a*M/u,A=T?N*(T-1)+M:M,O=R?m&&A-f||C:0;f=A,m=R,h+=O;let k=Ye(h)-g;return g+=k,{periodStart:D,add:k,availableToScheduleCount:R,newCourts:C,totalMatchUps:g}});return{scheduleTimes:U.reduce((T,P)=>{let D=Re(0,P.add).map(()=>({scheduleTime:P.periodStart}));return T.concat(...D)},[]).flat(),timingProfile:U,totalMatchUps:g}}var KX={getCourtsAvailableAtPeriodStart:qX,generateTimeSlots:wv,getScheduleTimes:y_,courtGenerator:YX},nPe=KX,XX={};ct(XX,{isAggregateFormat:()=>aC,isValid:()=>xa,isValidMatchUpFormat:()=>xa,parse:()=>zi,stringify:()=>QE});var JX={};ct(JX,{allCompetitionMatchUps:()=>Eo,allDrawMatchUps:()=>Rn,allEventMatchUps:()=>Ru,allTournamentMatchUps:()=>br,analyzeMatchUp:()=>Mb,applyLineUps:()=>bJ,assignMatchUpSideParticipant:()=>ZX,assignTieMatchUpParticipantId:()=>sP,bulkMatchUpStatusUpdate:()=>gJ,calculateWinCriteria:()=>Dh,checkInParticipant:()=>w_,checkMatchUpIsComplete:()=>fp,checkOutParticipant:()=>b_,competitionScheduleMatchUps:()=>NS,disableTieAutoCalc:()=>fJ,drawMatchUps:()=>r_,enableTieAutoCalc:()=>cJ,eventMatchUps:()=>yC,filterMatchUps:()=>Gu,findMatchUp:()=>j0,getAllDrawMatchUps:()=>Qi,getAllStructureMatchUps:()=>Nt,getCheckedInParticipantIds:()=>mh,getCompetitionMatchUps:()=>Cb,getEventMatchUpFormatTiming:()=>Y0,getHomeParticipantId:()=>Q0,getMatchUpCompetitiveProfile:()=>iS,getMatchUpContextIds:()=>Z0,getMatchUpDailyLimits:()=>wC,getMatchUpDailyLimitsUpdate:()=>K0,getMatchUpDependencies:()=>oo,getMatchUpFormat:()=>e_,getMatchUpFormatTiming:()=>rS,getMatchUpFormatTimingUpdate:()=>q0,getMatchUpScheduleDetails:()=>CR,getMatchUpType:()=>MR,getMatchUpsStats:()=>t_,getModifiedMatchUpFormatTiming:()=>vC,getParticipantResults:()=>lS,getPredictiveAccuracy:()=>J0,getRoundMatchUps:()=>bn,getRounds:()=>i_,isValidMatchUpFormat:()=>xa,matchUpActions:()=>qR,mutate:()=>QX,participantScheduledMatchUps:()=>X0,query:()=>uX,removeDelegatedOutcome:()=>dJ,removeMatchUpSideParticipant:()=>T_,removeTieMatchUpParticipantId:()=>tJ,replaceTieMatchUpParticipantId:()=>U_,resetAdHocMatchUps:()=>vJ,resetMatchUpLineUps:()=>N_,resetScorecard:()=>k_,resetTieFormat:()=>A_,setDelegatedOutcome:()=>IJ,setMatchUpFormat:()=>mJ,setMatchUpState:()=>pf,setMatchUpStatus:()=>OS,setOrderOfFinish:()=>yJ,substituteParticipant:()=>pJ,tallyParticipantResults:()=>gh,toggleParticipantCheckInState:()=>RC,tournamentMatchUps:()=>bC,updateTieMatchUpScore:()=>Lc,validMatchUp:()=>UR,validMatchUps:()=>Ga});var QX={};ct(QX,{applyLineUps:()=>bJ,assignMatchUpSideParticipant:()=>ZX,assignTieMatchUpParticipantId:()=>sP,bulkMatchUpStatusUpdate:()=>gJ,checkInParticipant:()=>w_,checkOutParticipant:()=>b_,disableTieAutoCalc:()=>fJ,enableTieAutoCalc:()=>cJ,findMatchUp:()=>j0,removeDelegatedOutcome:()=>dJ,removeMatchUpSideParticipant:()=>T_,removeTieMatchUpParticipantId:()=>tJ,replaceTieMatchUpParticipantId:()=>U_,resetAdHocMatchUps:()=>vJ,resetMatchUpLineUps:()=>N_,resetScorecard:()=>k_,resetTieFormat:()=>A_,setDelegatedOutcome:()=>IJ,setMatchUpFormat:()=>mJ,setMatchUpState:()=>pf,setMatchUpStatus:()=>OS,setOrderOfFinish:()=>yJ,substituteParticipant:()=>pJ,toggleParticipantCheckInState:()=>RC,updateTieMatchUpScore:()=>Lc});function ZX({tournamentRecord:t,drawDefinition:e,participantId:i,sideNumber:r,matchUpId:n,event:a}){if(i&&typeof i!="string")return{error:To};if(!e)return{error:_e};if(!n)return{error:Un};let s=r===void 0;if(s&&(r=1),![1,2].includes(r))return z({result:{error:ie,context:{sideNumber:r}}});let{matchUp:o,structure:l}=di({drawDefinition:e,matchUpId:n,event:a});if(!o)return{error:un};if(!(!l?.structures&&!(e.drawType&&e.drawType!==ra)&&!l?.matchUps?.find(({roundPosition:u})=>!!u)))return{error:C1};if(!i&&(o?.score?.scoreStringSide1||Yi.includes(o?.matchUpstatus)||o?.matchUpStatus&&[wi,Hi].includes(o.matchUpStatus)))return{error:$E,info:"matchUp has completed status or score"};if(o){if(o.sides=[1,2].map(u=>{let c=o.sides?.find(d=>d.sideNumber===u)??{sideNumber:u};return r===u?{...c,participantId:i}:c}),s)for(let u of o.sides)u.sideNumber&&(u.sideNumber=3-u.sideNumber);St({tournamentId:t?.tournamentId,context:"assignSideParticipant",drawDefinition:e,matchUp:o})}return{...H,sidesSwapped:s}}function wa({removePriorValues:t,tournamentRecord:e,duplicateValues:i,drawDefinition:r,disableNotice:n,matchUpId:a,timeItem:s,event:o}){let{matchUp:l}=di({drawDefinition:r,event:o,matchUpId:a});if(!l)return{error:un};let u=Dl({removePriorValues:t,element:l,duplicateValues:i,timeItem:s});return n||St({tournamentId:e?.tournamentId,eventId:o?.eventId,context:"addTimeItem",drawDefinition:r,matchUp:l}),u}function b_(t){let e=[{[mr]:!0},{[mn]:!0},{[su]:!0},{[Ul]:!0}],i=Ge(t,e);if(i.error)return i;let r=Iv(t,[{[tv]:Du,attr:{[lR]:!0}}]);if(r.error)return r;let{tournamentRecord:n,drawDefinition:a,participantId:s,matchUpId:o}=t,l=r?.matchUp?.matchUp,{matchUpStatus:u,score:c}=l??{};if(u&&CF.includes(u)||u&&Yi.includes(u)||cr({score:c}))return{error:l6};let d=mh({matchUp:l});if(d?.error)return d;let{checkedInParticipantIds:p,allRelevantParticipantIds:f}=d??{};if(!f?.includes(s))return{error:To};if(!p?.includes(s))return{error:V6};let m=UK({matchUp:l});if(m?.error)return m;let{sideParticipantIds:h,nestedIndividualParticipantIds:g}=m??{},I=h?.indexOf(s);return I!==void 0&&[0,1].includes(I)&&(g?.[I]??[]).forEach(v=>{wa({drawDefinition:a,matchUpId:o,timeItem:{itemType:HD,itemValue:v}})}),wa({tournamentRecord:n,drawDefinition:a,matchUpId:o,timeItem:{itemValue:s,itemType:HD}}),{...H,checkedOut:!0}}function w_(t){let e=[{[mr]:!0},{[mn]:!0},{[su]:!0},{[Ul]:!0}],i=Ge(t,e);if(i[xs])return i;let r=Iv(t,[{[tv]:Du,attr:{[lR]:!0}}]);if(r[xs])return r;let{tournamentRecord:n,drawDefinition:a,participantId:s,matchUpId:o}=t,l=mh({matchUp:r?.matchUp?.matchUp});if(l?.error)return l;let{checkedInParticipantIds:u,allRelevantParticipantIds:c}=l??{};if(!c?.includes(s))return{[xs]:To};let d={...H,checkedIn:!0};return u?.includes(s)||wa({tournamentRecord:n,drawDefinition:a,matchUpId:o,timeItem:{itemValue:s,itemType:GD}}),d}function RC(t){let e=Ge(t,[{[su]:!0,[mn]:!0,[Ul]:!0}]);if(e.error)return e;let i=t.tournamentId??t.activeTournamentId,r=t.tournamentRecord??(i&&t.tournamentRecords?.[i]);if(!r)return{error:Ie};let n=Iv(t,[{[tv]:Du,attr:{[lR]:!0},[xs]:un}]).matchUp?.matchUp;if(!n)return{error:un};let{checkedInParticipantIds:a=[]}=mh({matchUp:n}),{participantId:s,matchUpId:o,drawDefinition:l}=t;return s&&a.includes(s)?b_({tournamentRecord:r,drawDefinition:l,participantId:s,matchUpId:o,matchUp:n}):w_({tournamentRecord:r,drawDefinition:l,participantId:s,matchUpId:o,matchUp:n})}function S_({tournamentRecord:t,drawDefinition:e,tieMatchUpId:i,event:r}){if(!t)return{error:Ie};if(!e)return{error:Oo};if(!r)return{error:os};let n=Ar({drawDefinition:e}),{matchUp:a}=di({matchUpId:i,drawDefinition:e,matchUpsMap:n});if(!a)return{error:un};let{matchUp:s,structure:o}=di({tournamentParticipants:t.participants,matchUpId:i,inContext:!0,drawDefinition:e,matchUpsMap:n,event:r});if(!s)return{error:un};let{collectionPosition:l,drawPositions:u,collectionId:c,matchUpTieId:d,matchUpType:p}=s;if(p&&!Zf([Wt,$t],p))return{error:ta};let{positionAssignments:f}=Yt({structure:o}),m=f?.filter(S=>u?.includes(S.drawPosition)),{matchUp:h}=di({matchUpId:d,drawDefinition:e,matchUpsMap:n}),g=h?.sides?.map(vt)??[],I=m?.map(vt)??[],v=[...g,...I],{participants:w}=Ei({tournamentRecord:t,participantFilters:{participantTypes:[Lt],participantIds:v}}),{matchUp:y}=di({matchUpId:d,inContext:!0,drawDefinition:e,matchUpsMap:n}),b=vn({matchUp:h,drawDefinition:e,structure:o,event:r})?.tieFormat;return{inContextDualMatchUp:y,inContextTieMatchUp:s,relevantAssignments:m,collectionPosition:l,teamParticipants:w,collectionId:c,matchUpType:p,dualMatchUp:h,tieMatchUp:a,tieFormat:b,structure:o,...H}}function U_(t){let e=S_(t);if(e.error)return e;let i="replaceTieMatchUpParticipantid",{existingParticipantId:r,tournamentRecord:n,newParticipantId:a,drawDefinition:s,substitution:o,event:l}=t;if(!r||!a)return z({result:{error:lr},stack:i});if(r===a)return{...H};let{inContextDualMatchUp:u,inContextTieMatchUp:c,collectionPosition:d,collectionId:p,dualMatchUp:f,tieMatchUp:m,tieFormat:h}=e,g=c?.matchUpType,I=c?.sides?.find(k=>k.participant?.participantId===r||k.participant?.individualParticipantIds?.includes(r));if(!I)return{error:Vi};let v=Ei({tournamentRecord:n,participantFilters:{participantIds:[r,a]}})?.participants??[];if(v.length!==2)return z({result:{error:lr},stack:i});if(v[0].participantType!==v[1].participantType)return z({result:{error:Do},stack:i});let{appliedPolicies:w}=Tt({tournamentRecord:n,drawDefinition:s,event:l}),y=t.policyDefinitions?.[Er]??w?.[Er]??cv[Er],b=v.find(({participantId:k})=>k===a);if((t.enforceGender??y?.participants?.enforceGender)!==!1&&il(c?.gender)&&on(c?.gender)!==on(b?.person?.sex))return{error:Sp,info:"Gender mismatch"};let S=y?.processCodes?.substitution;bS({tournamentId:n.tournamentId,eventId:l.eventId,inContextDualMatchUp:u,drawDefinition:s,dualMatchUp:f});let U=f?.sides?.find(({sideNumber:k})=>k===I.sideNumber);if(!U)return z({result:{sideNumber:I.sideNumber,existingParticipantId:r,error:_r},stack:i});if(c?.sides?.flatMap(k=>k.participant?.individualParticipantIds||k.participant?.participantId||[])?.includes(a))return z({result:{error:VE},stack:i});let T=u?.sides?.find(({sideNumber:k})=>k===I.sideNumber)?.participantId,P=U.lineUp,D=P?.find(({participantId:k})=>a===k),E=P?.reduce((k,F)=>F.substitutionOrder>k?F.substitutionOrder:k,0),R=P?.map(k=>{let F=ke(k,!1,!0);if(![r,a].includes(F.participantId))return F;if(!o&&[r,a].includes(F.participantId)&&(F.collectionAssignments=F.collectionAssignments?.filter(x=>!(x.collectionPosition===d&&x.collectionId===p))),o&&r===F.participantId&&(F.collectionAssignments=F.collectionAssignments.map(x=>x.collectionPosition===d&&x.collectionId===p&&x.substitutionOrder===void 0?{...x,substitutionOrder:E}:x)),F.participantId===a){F.collectionAssignments||(F.collectionAssignments=[]);let x={collectionId:p,collectionPosition:d};o&&(x.previousParticipantId=r,x.substitutionOrder=(E??0)+1),F.collectionAssignments.push(x)}return F})??[];if(!D){let k={collectionId:p,collectionPosition:d};o&&(k.substitutionOrder=(E??0)+1,k.previousParticipantId=r);let F={collectionAssignments:[k],participantId:a};R.push(F)}let C=g===$t,{assignedParticipantIds:M}=qD({lineUp:P,collectionPosition:d,collectionId:p}),{assignedParticipantIds:N}=qD({lineUp:R,collectionPosition:d,collectionId:p});if(U.lineUp=R,T&&h){let k=bh({participantId:T,lineUp:R,drawDefinition:s,tieFormat:h});if(k.error)return z({result:k,stack:i})}else console.log("team participantId not found");let A,O;if(C){let{tournamentRecord:k}=t,F=Qs({participantIds:N,tournamentRecord:k});if(!F.participant){let L=ul({returnParticipant:!0,pairOverride:!0,tournamentRecord:k,participant:{participantRole:Kr,individualParticipantIds:N,participantType:pt}});if(L.error)return z({result:L,stack:i});A=L.participant?.participantId}F=Qs({participantIds:M,tournamentRecord:k});let x=F.participant?.participantId;x&&vh({participantIds:[x],tournamentRecord:k}).success&&(O=x)}if(o||I.substitutions?.length===1){if(o)S&&m&&(m.processCodes=rt([...m?.processCodes??[],...S]));else for(let k of S||[]){let F=m?.processCodes?.lastIndexOf(k);F!==void 0&&m?.processCodes?.splice(F,1)}m&&St({tournamentId:n?.tournamentId,matchUp:m,context:i,drawDefinition:s})}return f&&St({tournamentId:n?.tournamentId,matchUp:f,context:i,drawDefinition:s}),{...H,modifiedLineUp:R,participantRemoved:O,participantAdded:A}}function eJ({collectionPosition:t,teamParticipantId:e,dualMatchUpSide:i,drawDefinition:r,participantIds:n,collectionId:a}){if(!a||!t||!Array.isArray(n))return{modifiedLineUp:i?.lineUp||[],error:ie};let s=i?.lineUp||Cp({participantId:e,drawDefinition:r})?.lineUp,o=[],l=[];return{modifiedLineUp:s?.map(u=>{if(!n.includes(u.participantId))return u;let c=u.collectionAssignments?.filter(d=>{let p=d.collectionId===a&&d.collectionPosition===t;return p&&(d.previousParticipantId&&o.push(d.previousParticipantId),l.push({participantId:u.participantId,...d})),!p});return{participantId:u.participantId,collectionAssignments:c}}).filter(Boolean)||[],assignmentsRemoved:l,previousParticipantIds:o}}function aPe({individualParticipantIds:t,groupingParticipantId:e,tournamentRecord:i}){let r=(i.events||[]).filter(a=>a?.eventType===rr&&a?.entries?.some(s=>s.participantId===e)),n=a=>!t.includes(a.participantId);for(let a of r){a.entries=(a.entries||[]).filter(n);let{flightProfile:s}=$i({event:a});s?.flights?.forEach(o=>{o.drawEntries=(o.drawEntries||[]).filter(n)}),a?.drawDefinitions?.forEach(o=>{o.entries=(o.entries||[]).filter(n)})}return{...H}}function CC({individualParticipantIds:t,groupingParticipantId:e,removeFromOtherTeams:i,tournamentRecord:r}){let n="addIndividualParticipantIds";if(!r)return z({result:{error:Ie},stack:n});if(!e||!t)return z({result:{error:Xe},stack:n});let a=r.participants??[],s=a.find(d=>d.participantId===e);if(!s)return z({result:{error:Vi},stack:n});if(s?.participantType&&![Lt,ja].includes(s.participantType))return z({context:{participantType:s.participantType},result:{error:Do},stack:n});let o=t.filter(d=>a.find(p=>p.participantId===d)?.participantType!==gt);if(o.length)return z({result:{error:ga,invalidParticipantIds:o},stack:n});s.individualParticipantIds||(s.individualParticipantIds=[]);let l=s.individualParticipantIds,u=t.filter(d=>!l.includes(d));u.length&&(i&&kR({individualParticipantIds:u,tournamentRecord:r}),s.individualParticipantIds=s.individualParticipantIds.concat(...u));let{topics:c}=gs();if(c.includes(en)){let d=a.find(({participantId:p})=>p===e);at({topic:en,payload:{participants:[d]}})}return aPe({individualParticipantIds:t,groupingParticipantId:e,tournamentRecord:r}),{groupingParticipant:ke(s,!1,!0),added:u.length,...H}}function MC(t){let{updateParticipantName:e=!0,groupingParticipantId:i,removeFromOtherTeams:r,tournamentRecord:n,pairOverride:a,participant:s}=t;if(!n)return{error:Ie};if(!s)return{error:ih};if(!s.participantId)return ul({tournamentRecord:n,participant:s});let{participant:o}=$d({participantId:s.participantId,tournamentRecord:n});if(!o)return ul({tournamentRecord:n,participant:s});let{participantRoleResponsibilties:l,individualParticipantIds:u,participantOtherName:c,participantName:d,participantRole:p,participantType:f,onlineResources:m,contacts:h,person:g}=s;if(f&&o.participantType!==f)return{error:k6};let I={};if(h&&(I.contacts=h),m&&(I.onlineResources=m),c&&ri(c)&&(I.participantOtherName=c),d&&ri(d)&&(I.participantName=d),Array.isArray(u)){let{participants:v}=Ei({participantFilters:{participantTypes:[gt]},tournamentRecord:n}),w=v?.map(vt);if(w){let y=u.filter(b=>ri(b)&&w.includes(b));([ja,Zt].includes(f||o.participantType)||f===pt&&(y.length===2||a))&&(I.individualParticipantIds=y),o.participantType===Ay.PAIR&&e&&(I.participantName=sPe({individualParticipants:v,newValues:I}))}}return Object.keys(hL).includes(p)&&(I.participantRole=p),Object.keys(Ay).includes(f)&&(I.participantType=f),Array.isArray(l)&&(I.participantRoleResponsibilties=l),o.participantType===Ay.INDIVIDUAL&&g&&oPe({updateParticipantName:e,existingParticipant:o,newValues:I,person:g}),Object.assign(o,Ve(I)),i&&CC({individualParticipantIds:[o.participantId],groupingParticipantId:i,removeFromOtherTeams:r,tournamentRecord:n}),at({topic:en,payload:{tournamentId:n.tournamentId,participants:[o]}}),{participant:ke(o),...H}}function sPe({individualParticipants:t,newValues:e}){let i=e.individualParticipantIds,r=t.filter(({participantId:n})=>i.includes(n)).map(({person:n})=>n?.standardFamilyName).filter(Boolean).sort().join("/");return i.length===1&&(r+="/Unknown"),r}function oPe({updateParticipantName:t,existingParticipant:e,newValues:i,person:r}){let n={},{standardFamilyName:a,standardGivenName:s,nationalityCode:o,personId:l,birthdate:u,tennisId:c,sex:d}=r;d&&Object.keys(XE).includes(d)&&(n.sex=d);let p;if(ri(l)&&(n.personId=l),o&&ri(o)&&(lPe(o)||o==="")&&(n.nationalityCode=o),a&&typeof ri(a)&&a.length>1&&(n.standardFamilyName=a,p=!0),s&&typeof ri(s)&&s.length>1&&(n.standardGivenName=s,p=!0),p&&t){let f=`${n.standardGivenName} ${n.standardFamilyName}`;i.participantName=f}u&&Pn(u)&&(n.birthdate=u),c&&ri(c)&&(n.tennisId=c),Object.assign(e.person,n)}function lPe(t){return tm.flatMap(({iso:e,ioc:i})=>[e,i]).filter(Boolean).includes(t)}function sP(t){let e=S_(t);if(e.error)return e;let i="assignTieMatchUpParticipantId",r=t.teamParticipantId,{tournamentRecord:n,drawDefinition:a,participantId:s,event:o}=t;if(!s)return z({result:{error:lr},stack:i});if(t.sideNumber&&![1,2].includes(t.sideNumber))return z({result:{error:P6},stack:i});let{inContextDualMatchUp:l,inContextTieMatchUp:u,relevantAssignments:c,collectionPosition:d,teamParticipants:p,collectionId:f,matchUpType:m,dualMatchUp:h,tieFormat:g}=e;if(u?.sides?.flatMap(x=>x.participant?.individualParticipantIds||x.participant?.participantId||[])?.includes(s))return z({result:{...H},stack:i});r=r??(t.sideNumber?l?.sides?.find(x=>x.sideNumber===t.sideNumber)?.participantId:void 0);let I=Ei({participantFilters:{participantIds:[s]},tournamentRecord:n})?.participants?.[0];if(!I)return z({result:{error:Vi},stack:i});let{appliedPolicies:v}=Tt({tournamentRecord:n,drawDefinition:a,event:o}),w=t.policyDefinitions?.[Er]??v?.[Er]??cv[Er];if((t.enforceGender??w?.participants?.enforceGender)!==!1&&il(u?.gender)&&on(u?.gender)!==on(I.person?.sex))return{error:Sp,info:"Gender mismatch"};let{individualParticipantIds:y,participantType:b}=I;if(Di(Wt)(m)&&b!==gt)return{error:Do};let S=b===gt?[s]:y,U=r&&p?.find(({participantId:x})=>x===r)||p?.find(({individualParticipantIds:x})=>kn(S,x));if(!U)return{error:z1};if(r||(r=U.participantId),!r)return{error:Vi};let T=c?.find(x=>x.participantId===U?.participantId)?.drawPosition,P=h?.sides?.find(x=>x.participantId===r)?.sideNumber,D=u?.sides?.find(x=>T&&x.drawPosition===T)?.sideNumber,E=P??D??t.sideNumber;if(!g)return{error:XI};if(!g.collectionDefinitions?.find(x=>x.collectionId===f))return{error:U6};bS({tournamentId:n.tournamentId,eventId:o.eventId,inContextDualMatchUp:l,drawDefinition:a,dualMatchUp:h});let R=h?.sides?.find(x=>x.sideNumber===E),C=u?.sides?.find(x=>x.sideNumber===E),M=(R?.lineUp??Cp({participantId:r,drawDefinition:a})?.lineUp)?.filter(x=>x.collectionAssignments?.find(L=>L.collectionPosition===d&&L.collectionId===f&&!L.previousParticipantId))?.map(x=>x?.participantId),N=M?.length>1&&M||(b===pt?I.individualParticipantIds:[s]),A=eJ({collectionPosition:d,teamParticipantId:r,dualMatchUpSide:R,drawDefinition:a,participantIds:N,collectionId:f});if(A.error)return z({result:A,stack:i});let{modifiedLineUp:O}=A,k;if(m===$t){if(b!==pt){let x=OA({collectionPosition:d,teamParticipantId:r,drawDefinition:a,modifiedLineUp:O,participantId:s,collectionId:f,tieFormat:g});if(x?.error)return z({result:x,stack:i});if(x=F({side:C}),x.error)return x;k=x.deletedParticipantId,R&&(R.lineUp=O),h&&St({tournamentId:n?.tournamentId,matchUp:h,context:i,drawDefinition:a})}else if(b===pt)for(let x of N)OA({collectionPosition:d,teamParticipantId:r,drawDefinition:a,modifiedLineUp:O,participantId:x,collectionId:f,tieFormat:g})}else{let x=OA({collectionPosition:d,teamParticipantId:r,drawDefinition:a,modifiedLineUp:O,participantId:s,collectionId:f,tieFormat:g});if(x?.error)return x}if(R&&(R.lineUp=O),h&&St({tournamentId:n?.tournamentId,matchUp:h,context:i,drawDefinition:a}),k){let{error:x}=vh({participantIds:[k],tournamentRecord:n});x&&console.log("cleanup")}return{...H,modifiedLineUp:O};function F({side:x}){let L;if(x.participant){let $=x.participant.individualParticipantIds||[];if($.filter(Boolean).length===1){let{participant:V}=Qs({participantIds:$,tournamentRecord:n});$.push(s);let{participant:_}=Qs({participantIds:$,tournamentRecord:n});if(!_&&V){V.individualParticipantIds=$;let B=MC({pairOverride:!0,tournamentRecord:n,participant:V});if(B.error)return B}else L=V?.participantId}}else{let $=ul({participant:{individualParticipantIds:[s],participantRole:Kr,participantType:pt},pairOverride:!0,tournamentRecord:n});if($.error)return $}return{...H,deletedParticipantId:L}}}function OA({collectionPosition:t,teamParticipantId:e,drawDefinition:i,modifiedLineUp:r,participantId:n,collectionId:a,tieFormat:s}){let o=Cp({participantId:e,drawDefinition:i})?.lineUp,l=(r||o)?.find(c=>c?.participantId===n),u={collectionId:a,collectionPosition:t};if(l)l.collectionAssignments.push(u);else{let c={collectionAssignments:[u],participantId:n};r.push(c)}return bh({participantId:e,lineUp:r,drawDefinition:i,tieFormat:s})}function tJ(t){let{tournamentRecord:e,drawDefinition:i,participantId:r,event:n}=t,a="removeTieMatchUpParticiapantId";if(!r)return z({result:{error:lr},stack:a});let s=S_(t);if(s.error)return s;let{appliedPolicies:o}=Tt({tournamentRecord:e,drawDefinition:i,event:n}),l=(t.policyDefinitions?.[Er]??o?.[Er]??cv[Er])?.processCodes?.substitution,{inContextDualMatchUp:u,inContextTieMatchUp:c,relevantAssignments:d,collectionPosition:p,teamParticipants:f,collectionId:m,matchUpType:h,dualMatchUp:g,tieMatchUp:I,tieFormat:v}=s;if(!g)return z({result:{error:ea},stack:a});let w=c?.sides?.find(E=>E.participant?.participantId===r||E.participant?.individualParticipantIds?.includes(r));if(!w)return z({result:{error:Vi},stack:a});let y=t.policyDefinitions?.[Po]??o?.[Po];if(!w.substitutions?.length&&(cr({score:c?.score})||c?.winningSide)&&y?.requireParticipantsForScoring!==!1)return z({result:{error:u4},stack:a});let b=u?.sides?.find(({sideNumber:E})=>E===w.sideNumber)?.participantId;if(!b)return z({result:{error:Vi},stack:a});let S=Ei({participantFilters:{participantIds:[r]},tournamentRecord:e})?.participants?.[0];if(!S)return z({result:{error:Vi},stack:a});if(h===Wt&&S.participantType===pt)return z({result:{error:Sp},stack:a});let U=S.participantType===gt?[r]:S.individualParticipantIds;bS({tournamentId:e.tournamentId,eventId:n.eventId,inContextDualMatchUp:u,drawDefinition:i,dualMatchUp:g});let T=g.sides?.find(({sideNumber:E})=>E===w.sideNumber);if(!T&&(g.sides?.filter(({lineUp:E})=>!E).length||0)<2){let E=f?.map(({participantId:R})=>({drawPosition:d?.find(C=>C.participantId===R)?.drawPosition,teamParticipantId:R}));T=g.sides?.find(R=>E?.find(({drawPosition:C})=>C===R.drawPosition)?.teamParticipantId===b)}if(!T)return z({result:{error:Vi,context:{participantId:r}}});let{modifiedLineUp:P,previousParticipantIds:D}=eJ({collectionPosition:p,teamParticipantId:b,dualMatchUpSide:T,participantIds:U,drawDefinition:i,collectionId:m});if(T.lineUp=P,b&&v&&bh({participantId:b,lineUp:P,drawDefinition:i,tieFormat:v}),h===$t&&S.participantType===gt){let E=c?.sides?.find(M=>M.sideNumber===T?.sideNumber),{participantId:R}=E??{},C=R&&Ei({participantFilters:{participantIds:[R]},tournamentRecord:e,withDraws:!0})?.participants?.[0];if(C){let M=C?.individualParticipantIds?.filter(N=>N!==r)??[];if(D&&M.push(...D),M.length>2)return z({result:{error:ga},stack:a});if(C.draws?.length){if(M.length===1){let{participant:N}=Qs({participantIds:M,tournamentRecord:e});if(!N){let A=ul({participant:{participantRole:Kr,individualParticipantIds:M,participantType:pt},pairOverride:!0,tournamentRecord:e});if(A.error)return z({result:A,stack:a})}}}else if(M.length){C.individualParticipantIds=M;let N=MC({participant:C,pairOverride:!0,tournamentRecord:e});if(N.error)return z({result:N,stack:a})}else{let N=vh({participantIds:[R],tournamentRecord:e});N.error&&console.log("cleanup",{result:N})}}else return z({result:{error:Vi},stack:a})}if(w.substitutions?.length===1&&!c?.sides?.find(E=>E.sideNumber!==w.sideNumber)?.substitutions?.length&&I?.processCodes?.length){for(let E of l||[]){let R=I.processCodes.lastIndexOf(E);I.processCodes.splice(R,1)}St({tournamentId:e?.tournamentId,matchUp:I,context:a,drawDefinition:i})}return St({tournamentId:e?.tournamentId,matchUp:g,context:a,drawDefinition:i}),{...H,modifiedLineUp:P}}function T_(t){let e=Ge(t,[{[mr]:!0,[mn]:!0,[Ul]:!0}]);if(e.error)return e;let{drawDefinition:i,sideNumber:r,matchUpId:n,event:a}=t;if(r&&![1,2].includes(r))return{error:ie,sideNumber:r};let{matchUp:s,structure:o}=di({drawDefinition:i,matchUpId:n,event:a});return s?Vn({structure:o})?(s.sides?.forEach(l=>{(!r||l.sideNumber===r)&&delete l.participantId}),St({tournamentId:t.tournamentRecord?.tournamentId,context:"assignSideParticipant",drawDefinition:i,matchUp:s}),{...H}):{error:C1}:{error:un}}function uPe({matchUpStatuses:t=["BYE",mi,Qt],drawPositionMatchUps:e,loserDrawPosition:i,sourceMatchUps:r}){let n=e?.reduce((c,d)=>!c||d.roundNumber>c.roundNumber?d:c,void 0),a=n?.drawPositions?.find(c=>c!==i),s=r.filter(c=>c?.drawPositions?.includes(a)).map(c=>c.matchUpStatus),o=r.filter(c=>c?.drawPositions?.includes(i)).map(c=>c.matchUpStatus),l=kn(s||[],t),u=kn(o||[],t);return{sourceMatchUp:n,winnerHadMatchUpStatus:l,winnerMatchUpStatuses:s,loserHadMatchUpStatus:u,loserMatchUpStatuses:o}}function cPe({inContextDrawMatchUps:t,sourceMatchUpStatus:e,targetDrawPosition:i,tournamentRecord:r,sourceMatchUpId:n,drawDefinition:a,structureId:s,dualMatchUp:o,roundNumber:l,matchUpsMap:u,event:c}){let{structure:d}=et({drawDefinition:a,structureId:s});if(d?.structureType===fn)return{...H};u=u??Ar({drawDefinition:a});let p=(u?.mappedMatchUps||{})[s].matchUps,{initialRoundNumber:f}=Mm({drawPosition:i,matchUps:p}),m=p?.filter(g=>g.roundNumber>=l&&g.roundNumber!==f&&g.drawPositions?.includes(i)),{positionAssignments:h}=Yt({drawDefinition:a,structureId:s});for(let g of m??[])dPe({inContextDrawMatchUps:t,sourceMatchUpStatus:e,positionAssignments:h,targetDrawPosition:i,tournamentRecord:r,sourceMatchUpId:n,drawDefinition:a,dualMatchUp:o,matchUpsMap:u,matchUp:g,event:c});return{...H}}function dPe({inContextDrawMatchUps:t,positionAssignments:e,sourceMatchUpStatus:i,targetDrawPosition:r,tournamentRecord:n,sourceMatchUpId:a,drawDefinition:s,dualMatchUp:o,matchUpsMap:l,matchUp:u,event:c}){let d="removeSubsequentDrawPosition";if(o){let f=t.find(({matchUpId:h})=>u.matchUpId===h).sides?.find(h=>h.drawPosition===r)?.sideNumber,m=u.sides?.find(h=>h.sideNumber===f);m&&delete m.lineUp}u.drawPositions=(u.drawPositions||[]).map(f=>f===r?void 0:f).filter(Boolean);let p=e.filter(({drawPosition:f})=>u.drawPositions?.includes(f)).filter(f=>f.bye).length;return u.matchUpStatus=p&&"BYE"||Fr(u.matchUpStatus)&&u.matchUpStatus||Fi,Fr(u.matchUpStatus)&&(u.winningSide=void 0),u.matchUpStatusCodes&&E7({inContextDrawMatchUps:t,sourceMatchUpStatus:i,sourceMatchUpId:a,matchUpsMap:l,matchUp:u}),St({tournamentId:n?.tournamentId,eventId:c?.eventId,context:`${d}-${r}`,drawDefinition:s,matchUp:u}),{...H}}function Sv(t){let{dualWinningSideChange:e,inContextDrawMatchUps:i,tournamentRecord:r,drawDefinition:n,matchUpStatus:a,matchUpsMap:s,dualMatchUp:o,targetData:l,matchUpId:u,structure:c,event:d}=t,p=!!t.matchUp.collectionId,f=Vn({structure:c}),{drawPositions:m,winningSide:h}=l.matchUp||{};if(!f&&!m)return{error:Dw};let{targetLinks:{loserTargetLink:g,winnerTargetLink:I,byeTargetLink:v},targetMatchUps:{loserMatchUp:w,winnerMatchUp:y,byeMatchUp:b}}=l,S=yo({...t,matchUpStatus:a||Fi,removeWinningSide:!0});if(S.error)return S;let U;if(p){let{matchUpTieId:O,matchUpsMap:k}=t;if(U=Lc({appliedPolicies:t.appliedPolicies,matchUpId:O,tournamentRecord:r,drawDefinition:n,matchUpsMap:k,event:d}),!e&&!U.removeWinningSide)return{...H}}if(f)return{...H};let{matchUps:T}=Nt({afterRecoveryTimes:!1,inContext:!0,drawDefinition:n,matchUpsMap:s,structure:c}),{positionAssignments:P}=ur({structure:c}),D=h-1,E=1-D,R=m[D],C=m[E],{winnerParticipantId:M,loserParticipantId:N}=P?.reduce((O,k)=>(k.drawPosition===C&&(O.loserParticipantId=k.participantId),k.drawPosition===R&&(O.winnerParticipantId=k.participantId),O),{winnerParticipantId:void 0,loserParticipantId:void 0})||{},A=T.filter(O=>O.drawPositions?.includes(C));if(y&&iJ({sourceMatchUpStatus:a,sourceMatchUpId:u,inContextDrawMatchUps:i,winningDrawPosition:R,winnerParticipantId:M,tournamentRecord:r,winnerTargetLink:I,drawDefinition:n,winnerMatchUp:y,dualMatchUp:o,matchUpsMap:s}),w){let{winnerHadMatchUpStatus:O}=uPe({drawPositionMatchUps:A,loserDrawPosition:C,sourceMatchUps:T}),k=g.linkCondition===al;if(O&&k){let x=Math.min(...w.drawPositions);FO({targetLink:g,inContextDrawMatchUps:i,drawDefinition:n,drawPosition:x,matchUpsMap:s,event:d})}let F=pPe({sourceMatchUpStatus:a,sourceMatchUpId:u,loserParticipantId:N,tournamentRecord:r,loserTargetLink:g,drawDefinition:n,loserMatchUp:w,dualMatchUp:o,matchUpsMap:s,event:d});if(F.error)return F}if(b){let O=Math.min(...b.drawPositions);FO({targetLink:v,inContextDrawMatchUps:i,drawDefinition:n,drawPosition:O,matchUpsMap:s,event:d})}return{...H,...U&&{tieMatchUpResult:U}}}function iJ({inContextDrawMatchUps:t,winningDrawPosition:e,sourceMatchUpStatus:i,winnerParticipantId:r,tournamentRecord:n,winnerTargetLink:a,sourceMatchUpId:s,drawDefinition:o,winnerMatchUp:l,matchUpsMap:u,dualMatchUp:c,event:d}){let{structureId:p,roundNumber:f}=l,m="removeDirectedWinner";if(a){let h=a.target.structureId,{structure:g}=et({drawDefinition:o,structureId:h});if(!g)return{error:Ii};let{positionAssignments:I}=ur({structure:g});g.seedAssignments=(g.seedAssignments??[]).filter(U=>U.participantId!==r);let v=I?.find(U=>U.participantId===r)?.drawPosition,{matchUps:w}=Nt({drawDefinition:o,structure:g,event:d}),y=w.map(U=>U.drawPositions).flat(1/0).filter(Boolean),b=va(y);if((v?b[v]:void 0)===1)I?.forEach(U=>{U.participantId===r&&delete U.participantId});else{let U=w.filter(({drawPositions:T})=>T.includes(v));console.log("not removing from position assignments since instances > 1",{drawPositionMatchUps:U,winnerTargetLink:a})}let S=u?.drawMatchUps?.find(({matchUpId:U})=>U===l.matchUpId);S&&St({tournamentId:n?.tournamentId,eventId:d?.eventId,matchUp:S,context:m,drawDefinition:o})}return f&&cPe({targetDrawPosition:e,inContextDrawMatchUps:t,sourceMatchUpStatus:i,tournamentRecord:n,sourceMatchUpId:s,drawDefinition:o,dualMatchUp:c,matchUpsMap:u,roundNumber:f,structureId:p}),{...H}}function pPe({sourceMatchUpStatus:t,loserParticipantId:e,tournamentRecord:i,loserTargetLink:r,sourceMatchUpId:n,drawDefinition:a,loserMatchUp:s,matchUpsMap:o,dualMatchUp:l,event:u}){let c="removeDirectedLoser",d=r.target.structureId,{structure:p}=et({drawDefinition:a,structureId:d});if(!p)return{error:Ii};let{positionAssignments:f}=ur({structure:p}),m=f?.find(h=>h.participantId===e)?.drawPosition;if(f?.forEach(h=>{h.participantId===e&&delete h.participantId}),n&&t){let h=o?.drawMatchUps?.find(({matchUpId:g})=>g===s.matchUpId);h.matchUpStatusCodes=t===wi?["WO","WO"]:[]}if(p.seedAssignments=(p.seedAssignments??[]).filter(h=>h.participantId!==e),l){let h=s?.sides.reduce((v,w,y)=>w.drawPosition===m?y:v,void 0),g=o?.drawMatchUps?.find(({matchUpId:v})=>v===s.matchUpId),I=g?.sides?.[h];I&&(delete I.lineUp,St({tournamentId:i?.tournamentId,eventId:u?.eventId,matchUp:g,context:c,drawDefinition:a}))}return{...H}}function FO({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,matchUpsMap:n,targetLink:a,event:s}){let o=a.target.structureId,l="removeDirectedBye";Gt({color:"brightyellow",method:l,drawPosition:r});let u=oS({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,matchUpsMap:n,structureId:o,event:s});return z({result:u,stack:l})}function fPe(t){let{matchUpFormat:e,score:i}=t,r=i?.sets?.length,n=e&&zi(e),{setFormat:a,finalSetFormat:s,bestOf:o}=n??{};return(o&&r===o&&s||a)?.timed||!1}function mPe({tournamentRecord:t,drawDefinition:e,structure:i,matchUp:r}){let n="attemptToSetMatchUpStatusBYE";if(r?.winningSide)return z({result:{error:KI},context:{matchUpStatus:"BYE"},stack:n});let{positionAssignments:a}=ur({structure:i}),s=a?.filter(o=>o.bye).map(o=>o.drawPosition);return r.drawPositions?.some(o=>s?.includes(o))?(r.matchUpStatus="BYE",r.matchUpStatusCodes=[],St({tournamentId:t?.tournamentId,context:n,drawDefinition:e,matchUp:r}),{...H}):z({result:{error:b6},info:"matchUp does not include BYE",stack:n})}function Ly(t){let{tournamentRecord:e,appliedPolicies:i,drawDefinition:r,matchUpsMap:n,targetData:a,structure:s,event:o}=t,l="doubleExitAdvancement";if(s.structureType===fn)return z({result:{...H},stack:l});let{matchUp:u,targetMatchUps:c,targetLinks:d}=a,{loserMatchUp:p,winnerMatchUp:f,loserTargetDrawPosition:m}=c,h=Fr(p?.matchUpStatus)&&!p.sides?.map(I=>I.participantId??I.participant).filter(Boolean).length,g=p?.matchUpStatus===wi;if(Gt({method:l,newline:!0,color:"brightyellow",keyColors:{sourceMatchUpId:"brightcyan",loserMatchUpId:"brightmagenta",winnerMatchUpId:"brightgreen"},sourceMatchUpId:u?.matchUpId,sourceStatus:t.matchUpStatus,sourceDP:JSON.stringify(u?.drawPositions),loserMatchUpId:p?.matchUpId,loserStatus:p?.matchUpStatus,loserDP:JSON.stringify(p?.drawPositions),loserTargetDP:m,loserIsEmptyExit:h,loserIsDoubleExit:g,loserSides:JSON.stringify(p?.sides?.map(I=>({sn:I.sideNumber,pid:I.participantId?.slice(0,8),fed:I.participantFed}))),winnerMatchUpId:f?.matchUpId,winnerStatus:f?.matchUpStatus,winnerDP:JSON.stringify(f?.drawPositions)}),p&&p.matchUpStatus!=="BYE"){let{loserTargetLink:I}=d,v=i?.progression?.doubleExitPropagateBye,w=p.feedRound&&p.sides?.[0]?.participantFed;if(v||w){Gt({method:l,color:"cyan",decision:"advanceByeToLoserMatchUp",propagateBye:v,targetFedIn:!!w});let y=rJ({loserTargetDrawPosition:m,tournamentRecord:e,loserTargetLink:I,drawDefinition:r,loserMatchUp:p,matchUpsMap:n,event:o});if(y.error)return z({result:y,stack:l})}else if(h){let y=t.matchUpStatus===Hi?Hi:wi,b=t.matchUpStatus===Hi?Qt:mi,S=n.drawMatchUps.find(U=>U.matchUpId===p.matchUpId);if(Gt({method:l,color:"brightred",decision:"EMPTY_EXIT_converting_to_DOUBLE_EXIT",loserMatchUpId:p.matchUpId,currentStatus:p.matchUpStatus,newStatus:y}),S){let U=[{matchUpStatus:b,previousMatchUpStatus:y,sideNumber:1},{matchUpStatus:b,previousMatchUpStatus:t.matchUpStatus,sideNumber:2}].map(P=>Ve(P)),T=yo({...t,matchUp:S,matchUpId:p.matchUpId,matchUpStatus:y,matchUpStatusCodes:U,winningSide:void 0,removeScore:!0});if(T.error)return z({result:T,stack:l})}}else if(g)Gt({method:l,color:"brightyellow",decision:"SKIP_loserMatchUp_already_doubleExit",loserMatchUpId:p.matchUpId});else{let{feedRound:y,drawPositions:b,matchUpId:S}=p,U=y?2:2-b.indexOf(m);Gt({method:l,color:"cyan",decision:"conditionallyAdvanceLoser",feedRound:y,walkoverWinningSide:U,loserMatchUpId:S});let T=DW({...t,targetMatchUp:p,walkoverWinningSide:U,tournamentRecord:e,sourceMatchUp:u,matchUpId:S});if(T.error)return z({result:T,stack:l})}}if(f){Gt({method:l,color:"cyan",decision:"conditionallyAdvanceWinner",winnerMatchUpId:f.matchUpId});let I=DW({...t,matchUpId:f.matchUpId,targetMatchUp:f,tournamentRecord:e,sourceMatchUp:u});if(I.error)return z({result:I,stack:l})}return z({result:{...H},stack:l})}function DW(t){let{inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:r,sourceMatchUp:n,targetMatchUp:a,matchUpsMap:s}=t,o=r.structures.find(({structureId:_})=>_===a.structureId),l=t.matchUpStatus===Hi?Hi:wi,u=t.matchUpStatus===Hi?Qt:mi,c="conditionallyAdvanceDrawPosition",d=s.drawMatchUps.find(_=>_.matchUpId===a.matchUpId);if(!d)return{error:ea};let p=n?.drawPositions||[],f=d.drawPositions?.filter(Boolean),m=n?.structureId===a.structureId;if(Gt({method:c,newline:!0,color:"magenta",keyColors:{targetMatchUpId:"brightcyan",sourceMatchUpId:"brightyellow"},targetMatchUpId:a.matchUpId,targetStructureId:a.structureId?.slice(0,8),targetRound:[a.roundNumber,a.roundPosition],targetDP:JSON.stringify(d.drawPositions),targetStatus:d.matchUpStatus,targetFeedRound:a.feedRound,sourceMatchUpId:n?.matchUpId,sourceStructureId:n?.structureId?.slice(0,8),sourceRound:n?[n.roundNumber,n.roundPosition]:void 0,sourceDP:JSON.stringify(p),sameStructure:m,paramMatchUpStatus:t.matchUpStatus,EXIT:u,DOUBLE_EXIT:l}),m&&kn(p,f)&&(f=f.filter(_=>!p.includes(_))),m&&f.length>1)return z({result:{error:qg},stack:c});let{pairedPreviousMatchUpIsDoubleExit:h,pairedPreviousMatchUp:g}=D7({...t,structure:o});Gt({method:c,color:"magenta",keyColors:{pairedMatchUpId:"brightcyan"},pairedMatchUpId:g?.matchUpId,pairedRound:g?[g.roundNumber,g.roundPosition]:void 0,pairedStatus:g?.matchUpStatus,pairedStructureId:g?.structureId?.slice(0,8),pairedIsDoubleExit:h});let I=On({matchUpId:a.matchUpId,inContextDrawMatchUps:e,drawDefinition:r}),{targetMatchUps:v,targetLinks:w}=I,{loserTargetDrawPosition:y,winnerMatchUp:b,loserMatchUp:S}=v;if(S){let{loserTargetLink:_}=w,B=rJ({loserTargetDrawPosition:y,loserMatchUp:S,tournamentRecord:i,loserTargetLink:_,drawDefinition:r,matchUpsMap:s});if(B.error)return z({result:B,stack:c})}let U=d.drawPositions?.filter(Boolean)||[],T=U.length===1,P=t.walkoverWinningSide||T&&XT({drawPosition:U[0],matchUpId:a.matchUpId,inContextDrawMatchUps:e})||void 0,D=Fr(d.matchUpStatus)&&!U.length,E=D?l:u;Gt({method:c,color:"brightyellow",keyColors:{matchUpStatus:"brightgreen",existingExit:"brightred"},existingExit:D,matchUpStatus:E,targetCurrentStatus:d.matchUpStatus,targetDP:JSON.stringify(U),hasDrawPosition:T,walkoverWinningSide:P});let R=e.find(_=>_.matchUpId===g.matchUpId),C=[],M;n&&(n?.structureId===R?.structureId?n.roundPosition<g?.roundPosition?M=1:M=2:a.feedRound?n.structureId===a.structureId?M=2:M=1:P&&(M=3-P),Gt({method:c,color:"cyan",keyColors:{sourceSideNumber:"brightgreen"},sourceSideNumber:M,sourceStructureId:n.structureId?.slice(0,8),pairedStructureId:R?.structureId?.slice(0,8),targetStructureId:a.structureId?.slice(0,8),sameStructureAsPaired:n?.structureId===R?.structureId,targetFeedRound:a.feedRound,sourceRP:n.roundPosition,pairedRP:g?.roundPosition}));let N=t.matchUpStatus,A=g?.matchUpStatus;M===1?C=[{matchUpStatus:bT(N),previousMatchUpStatus:N,sideNumber:1},{matchUpStatus:bT(A),previousMatchUpStatus:A,sideNumber:2}]:M===2&&(C=[{matchUpStatus:bT(A),previousMatchUpStatus:A,sideNumber:1},{matchUpStatus:bT(N),previousMatchUpStatus:N,sideNumber:2}]),C.length&&(C=C.map(_=>Ve(_))),Gt({method:c,color:"brightgreen",keyColors:{matchUpStatus:"brightcyan",winningSide:"brightyellow"},action:"modifyMatchUpScore",targetMatchUpId:d.matchUpId,matchUpStatus:E,winningSide:P,matchUpStatusCodes:JSON.stringify(C),sourceStatus:N,pairedStatus:A});let O=yo({...t,winningSide:P,matchUp:d,matchUpStatusCodes:C,matchUpStatus:E});if(O.error)return z({result:O,stack:c});if(D)return Gt({method:c,color:"brightred",decision:"EXISTING_EXIT_triggers_recursive_doubleExitAdvancement",targetMatchUpId:d.matchUpId,matchUpStatus:E}),Ly({...t,matchUpStatus:E,targetData:I});if(!b)return z({result:{...H},stack:c});let k=f.length===2?f[P-1]:f[0],{positionAssignments:F}=Yt({structure:o}),x=F?.find(_=>_.drawPosition===k),L=s.drawMatchUps.find(_=>_.matchUpId===b.matchUpId),$=L?.drawPositions?.filter(Boolean),V=$.length===1;if(k){if(x?.bye){let _=On({matchUpId:L.matchUpId,inContextDrawMatchUps:e,drawDefinition:r});if(V){let B=$.filter(Boolean)[0],G=XT({drawPosition:B,matchUpId:L.matchUpId,inContextDrawMatchUps:e}),j=yo({appliedPolicies:t.appliedPolicies,matchUpId:L.matchUpId,matchUp:L,matchUpStatus:u,matchUpStatusCodes:[],removeScore:!0,drawDefinition:r,winningSide:G});return j.error?z({result:j,stack:c}):oL({drawPositionToAdvance:B,matchUpId:L.matchUpId,inContextDrawMatchUps:e,drawDefinition:r,matchUpsMap:s})}else if(Fr(b.matchUpStatus)){let B=Ly({...t,matchUpId:L.matchUpId,matchUpStatus:E,targetData:_});if(B.error)return z({result:B,stack:c})}return z({result:{...H},stack:c})}return rm({matchUpId:b.matchUpId,drawPosition:k,inContextDrawMatchUps:e,drawDefinition:r})}else if(h){if(!L)return{error:ea};if(V){let G=$[0],j=XT({matchUpId:a.matchUpId,inContextDrawMatchUps:e,drawPosition:G});console.log("existing drawPosition is winningSide",{walkoverWinningSide:j})}let _=Fr(L.matchUpStatus)?u:l,B=yo({matchUpId:L.matchUpId,appliedPolicies:t.appliedPolicies,matchUp:L,matchUpStatusCodes:[],removeScore:!0,drawDefinition:r,matchUpStatus:_});if(B.error)return z({result:B,stack:c});if(_===l){let G=Ly({...t,matchUpId:a.matchUpId,matchUpStatus:_,targetData:I});if(G.error)return G}}return z({result:{...H},stack:c})}function rJ(t){let{loserTargetDrawPosition:e,tournamentRecord:i,loserTargetLink:r,drawDefinition:n,matchUpsMap:a,event:s,loserMatchUp:o}=t,l=r?.target?.structureId,{structure:u}=et({drawDefinition:n,structureId:l});return u?Wa({drawPosition:e,tournamentRecord:i,drawDefinition:n,structureId:l,matchUpsMap:a,loserMatchUp:o,event:s}):{error:Qp}}function bT(t){return t===wi?mi:t===Hi?Qt:t}function hPe(t){let{tournamentRecord:e,drawDefinition:i,matchUpStatus:r,structure:n,matchUp:a}=t,s=!!(a.tieMatchUps&&!a.rondPosition&&t.inContextDrawMatchUps.find(v=>v.matchUpId===a.matchUpId).containerStructureId),o="attemptToSetMatchUpStatus",l=r==="BYE",u=a.winningSide,c=[wi,Hi].includes(r),d=sS({matchUpStatus:r}),p=pO({matchUpStatus:r}),f=!d&&!p,m=t.matchUpTieId||u&&d&&!c,h=u&&c;Gt({method:o,newline:!0,color:"brightyellow",keyColors:{matchUpStatus:"brightcyan",matchUpId:"brightmagenta"},matchUpId:a.matchUpId,matchUpStatus:r,existingStatus:a.matchUpStatus,existingWinningSide:u,isDoubleExit:c,isBYE:l,directing:d,nonDirecting:p,unrecognized:f,onlyModifyScore:m,changeCompletedToDoubleExit:h,propagateExitStatus:t.propagateExitStatus,teamRoundRobinContext:s});let g=()=>yo({...t,removeScore:[kc,mi].includes(r),matchUpStatus:r||Fi}),I=f&&"unrecognized"||m&&"onlyModifyScore"||h&&"changeCompletedToDoubleExit"||u&&"existingWinningSide_removeDirected"||p&&"nonDirecting_clearScore"||l&&"isBYE"||!d&&"notDirecting_error"||c&&"isDoubleExit_modifyAndAdvance"||s&&"teamRoundRobinContext"||t.propagateExitStatus&&"propagateExitStatus"||"fallthrough_error";return Gt({method:o,color:"brightgreen",keyColors:{route:"brightcyan"},route:I,matchUpId:a.matchUpId}),f&&{error:zk}||m&&iD(t)||h&&gPe(t)||u&&Sv(t)||p&&g()||l&&mPe({tournamentRecord:e,drawDefinition:i,structure:n,matchUp:a})||!d&&{error:zk}||c&&IPe(t)||s&&iD(t)||t.propagateExitStatus&&iD(t)||z({result:{error:KI,info:"matchUpStatus: "+r},stack:o})}function gPe(t){let e=Sv(t);return e.error?e:Ly(t)}function IPe(t){let e=iD({...t,removeScore:!0});return e.error?e:Ly(t)}function iD(t){let e="scoreModification";if(t.isCollectionMatchUp&&t.dualMatchUp?.winningSide&&!t.projectedWinningSide){let n=Sv(t);if(n.error)return z({result:n,stack:e})}let i=!!t.matchUp.collectionId,r=yo({...t});if(i){let{matchUpTieId:n,drawDefinition:a,matchUpsMap:s}=t,o=Lc({tournamentRecord:t.tournamentRecord,appliedPolicies:t.appliedPolicies,matchUpId:n,event:t.event,drawDefinition:a,matchUpsMap:s});if(o.error)return z({result:o,stack:e});Object.assign(r,{tieMatchUpResult:o})}return z({result:r,stack:e})}function vPe({drawDefinition:t,structure:e,matchUp:i}){let{drawPositions:r}=i,{positionAssignments:n}=Yt({drawDefinition:t,structure:e}),a=n?.filter(({drawPosition:l})=>r?.includes(l))?.map(l=>{let{extension:u}=mt({element:l,name:dc});return u?.value?.groupOrder}),{containerStructures:s}=av({drawDefinition:t}),o=s[e.structureId];return{structureIds:sv({drawDefinition:t,structureId:o})?.links?.source?.filter(l=>kn(a,l.source?.finishingPositions||[])).map(l=>l.source.structureId)}}function nJ({drawDefinition:t,structure:e,matchUp:i}){let r=[];if(e.finishingPosition===Pp&&uu({drawDefinition:t,structure:e})){let{structureIds:n}=vPe({drawDefinition:t,structure:e,matchUp:i});n?.length&&r.push(...n)}return{connectedStructureIds:r}}function yPe(t){let e,{inContextDrawMatchUps:i,inContextMatchUp:r,drawDefinition:n,winningSide:a}=t,s=t.targetData.targetLinks?.winnerTargetLink;if(s.target.feedProfile===Cs){let o=r.sides.find(({sideNumber:u})=>u!==a).participantId,l=i.find(u=>u.structureId===s.target.structureId&&u.roundNumber===s.target.roundNumber&&u.sides.some(({participantId:c})=>c===o));if(l?.matchUpStatus===Fi){let u=On({matchUpId:l.matchUpId,inContextDrawMatchUps:i,drawDefinition:n});if(!kp({inContextDrawMatchUps:i,drawDefinition:n,targetData:u})){let{structure:c}=et({structureId:l.structureId,drawDefinition:n}),d=Yt({structure:c}).positionAssignments;for(let p of d||[])if(p.participantId===o){let f=r.sides.find(({sideNumber:m})=>m===a).participantId;if(p.participantId=f,c?.positionAssignments)c.positionAssignments=d;else if(c?.structures){let m=Object.assign({},...(d||[]).map(h=>({[h.drawPosition]:h.participantId})));for(let h of c.structures)h.positionAssignments?.forEach(g=>g.participantId=m[g.drawPosition])}pc({tournamentId:t.tournamentRecord?.tournamentId,event:t.event,drawDefinition:n,structure:c}),e=!0}}}}return{...H,qualifierReplaced:e}}function bPe(t){let e,{inContextDrawMatchUps:i,inContextMatchUp:r,drawDefinition:n,winningSide:a}=t,s=t.targetData.targetLinks?.winnerTargetLink;if(s.target.feedProfile===Cs){let o=r.sides.find(({sideNumber:c})=>c===a)?.participantId,l=i.filter(c=>c.structureId===s.target.structureId&&c.roundNumber===s.target.roundNumber&&c.sides.some(({participantId:d,qualifier:p})=>p&&!d)),u=ca(l);if(u?.matchUpStatus===Fi){let c=On({matchUpId:u.matchUpId,inContextDrawMatchUps:i,drawDefinition:n});if(!kp({inContextDrawMatchUps:i,drawDefinition:n,targetData:c})){let d=u.sides.find(m=>m.qualifier&&!m.participantId)?.drawPosition,{structure:p}=et({structureId:u.structureId,drawDefinition:n});if(!p)return{error:Ii};let f=Yt({structure:p}).positionAssignments;for(let m of f||[])if(m.drawPosition===d&&!m.participantId){if(m.participantId=o,p.positionAssignments)p.positionAssignments=f;else if(p.structures){let h=Object.assign({},...(f||[]).map(g=>({[g.drawPosition]:g.participantId})));for(let g of p.structures)g.positionAssignments?.forEach(I=>I.participantId=h[I.drawPosition])}pc({tournamentId:t.tournamentRecord?.tournamentId,event:t.event,drawDefinition:n,structure:p}),e=!0}}}}return{...H,qualifierPlaced:e}}function wPe(t){let e="attemptToSetWinningSide",i,r={},{appliedPolicies:n,disableAutoCalc:a,drawDefinition:s,dualMatchUp:o,winningSide:l,structure:u,matchUp:c}=t;if(o?._disableAutoCalc&&a!==!1)return VL(t);if(c.winningSide&&c.winningSide!==l){let{connectedStructureIds:m}=nJ({drawDefinition:s,structure:u,matchUp:c});m.length&&(console.log({connectedStructureIds:m}),i=!0);let h=Sv(t);if(h.error)return h}let d=f8(t);if(d.context?.progressExitStatus&&Object.assign(r,d.context),d.error)return z({result:d,stack:e});let p,f;return t.qualifierChanging&&n?.[yb]?.autoReplaceQualifiers&&(p=yPe(t).qualifierReplaced),t.qualifierAdvancing&&n?.[yb]?.autoPlaceQualifiers&&(f=bPe(t).qualifierPlaced),z({result:Ve({...H,...d,connectedStructures:i,qualifierReplaced:p,qualifierPlaced:f,context:r}),stack:e})}var rD={drawPositionToRemove:"green",iteration:"brightred",winner:"green",loser:"brightred"};function aJ(t){let{inContextDrawMatchUps:e,appliedPolicies:i,drawDefinition:r,matchUpsMap:n,targetData:a,matchUp:s}=t,{matchUpId:o}=s,{iteration:l=0}=t;l+=1;let u="removeDoubleExit";Gt({color:"brightyellow",method:u,matchUpId:o,iteration:l,keyColors:rD});let{targetMatchUps:{loserMatchUp:c,winnerMatchUp:d,loserTargetDrawPosition:p},targetLinks:{loserTargetLink:f}}=a;if(d&&d.matchUpStatus!=="BYE"){let{stage:g,roundNumber:I,roundPosition:v,structureName:w}=d;Gt({winner:"winner",roundPosition:v,structureName:w,roundNumber:I,keyColors:rD,stage:g}),PW({...t,targetMatchUp:d,sourceMatchUp:s,iteration:l})}let m=c?.matchUpStatus==="BYE"&&(c?.feedRound||c?.roundNumber===1),h=a?.targetLinks?.loserTargetLink?.linkCondition===al;if(m&&h){let g=e.filter(({roundNumber:w,structureId:y})=>y===s.structureId&&w===1),I=g.map(({roundPosition:w})=>w),v=yr(I.sort(),2).find(w=>w.includes(s.roundPosition));if((g.filter(({roundPosition:w})=>v.includes(w))?.map(({matchUpStatus:w})=>w)).every(w=>[Hi,wi].includes(w)))return z({result:{...H},stack:u})}if(c&&(c.matchUpStatus!=="BYE"||m)){let g=e.find(({matchUpId:U})=>U===c.matchUpId),{structure:I}=et({drawDefinition:r,structureId:g.structureId}),{stage:v,roundNumber:w,roundPosition:y,feedRound:b,structureName:S}=c;if(Gt({loser:"loser",roundPosition:y,structureName:S,roundNumber:w,keyColors:rD,feedRound:b,stage:v}),i?.progression?.doubleExitPropagateBye||m)FO({drawPosition:p,targetLink:f,inContextDrawMatchUps:e,drawDefinition:r,matchUpsMap:n});else{let U=PW({...t,targetMatchUp:c,structure:I,iteration:l});if(U.error)return z({result:U,stack:u})}}return z({result:{...H},stack:u})}function PW(t){let{inContextDrawMatchUps:e,appliedPolicies:i,drawDefinition:r,sourceMatchUp:n,targetMatchUp:a,matchUpsMap:s,structure:o,iteration:l}=t,u="conditionallyRemoveDrawPosition";Gt({method:u,structureName:o?.structureName,iteration:l});let c=On({matchUpId:a.matchUpId,inContextDrawMatchUps:e,drawDefinition:r}),{targetMatchUps:{winnerMatchUp:d}}=c,p=s?.drawMatchUps.find(w=>w.matchUpId===a.matchUpId),f,m,h;if(a.feedRound)h=d?.drawPositions?.filter(Boolean)?.find(w=>a.drawPositions.includes(w));else if(n==null)h=xi(a?.drawPositions||[],d?.drawPositions||[])?.[0];else{m=P7({structureId:o.structureId,matchUp:n,matchUpsMap:s})?.pairedPreviousMatchUp,f=[wi,Hi].includes(m?.matchUpStatus);let w=m?.drawPositions?.filter(Boolean)||[];if([...Yi,"BYE"].includes(m?.matchUpStatus)||m?.winningSide){let y=n.drawPositions||[],b=a.drawPositions?.filter(Boolean);kn(y,b)&&(b=b?.filter(S=>!y.includes(S))),h=y.concat(w).find(S=>b?.includes(S))}}if(d&&h){let{stage:w,roundNumber:y,roundPosition:b,structureName:S}=d;Gt({method:"removeDirectedWinner",drawPositionToRemove:h,color:"brightgreen",roundPosition:b,structureName:S,roundNumber:y,keyColors:rD,stage:w}),iJ({winningDrawPosition:h,winnerMatchUp:d,inContextDrawMatchUps:e,drawDefinition:r,matchUpsMap:s})}let g=aJ({targetData:c,matchUp:a,inContextDrawMatchUps:e,appliedPolicies:i,drawDefinition:r,matchUpsMap:s,structure:o,iteration:l});if(g.error)return z({result:g,stack:u});let I=SPe({pairedPreviousDoubleExit:f,noContextTargetMatchUp:p}),v=!f;return g=yo({...t,matchUpId:a.matchUpId,matchUp:p,removeWinningSide:!0,matchUpStatusCodes:[],matchUpStatus:I,removeScore:v,score:{scoreStringSide1:"",scoreStringSide2:"",sets:void 0}}),g.error?z({result:g,stack:u}):{...H}}function SPe({pairedPreviousDoubleExit:t,noContextTargetMatchUp:e}){return e.matchUpStatus==="BYE"?"BYE":t?[Hi,Qt].includes(e?.matchUpStatus)?Qt:mi:Fi}function UPe(t){let e,{inContextDrawMatchUps:i,inContextMatchUp:r,drawDefinition:n}=t,a=t.targetData.targetLinks?.winnerTargetLink;if(a.target.feedProfile===Cs){let s=r.sides?.find(({sideNumber:l})=>l===r.winningSide)?.participantId,o=i.find(l=>l.structureId===a.target.structureId&&l.roundNumber===a.target.roundNumber&&l.sides?.some(({participantId:u})=>u===s));if(o&&o.matchUpStatus===Fi){let l=On({matchUpId:o.matchUpId,inContextDrawMatchUps:i,drawDefinition:n});if(!kp({inContextDrawMatchUps:i,drawDefinition:n,targetData:l})){let{structure:u}=et({structureId:o.structureId,drawDefinition:n}),c=Yt({structure:u}).positionAssignments;for(let d of c||[])if(d.participantId===s){if(d.participantId=void 0,u?.positionAssignments)u.positionAssignments=c;else if(u?.structures){let p=Object.assign({},...(c||[]).map(f=>({[f.drawPosition]:f.participantId})));for(let f of u?.structures||[])f.positionAssignments?.forEach(m=>m.participantId=p[m.drawPosition])}pc({tournamentId:t.tournamentRecord?.tournamentId,event:t.event,drawDefinition:n,structure:u}),e=!0}}}}return{qualifierRemoved:e}}function TPe(t){let{matchUp:e,matchUpStatus:i,score:r,winningSide:n}=t,a="noDownStreamDependencies";if([wi,Hi].includes(e?.matchUpStatus)&&![wi,Hi].includes(i)){let g=aJ(t);if(g.error)return z({result:g,stack:a})}let s=i===wi,o=cr({score:r})&&!s&&(t.isCollectionMatchUp&&!t.projectedWinningSide||!n),l=t?.inContextMatchUp?.collectionId&&fPe(t.inContextMatchUp),u=t.removeScore||!l&&![cs,us].includes(i||cs),c=t.isCollectionMatchUp&&t.dualMatchUp.winningSide&&!t.projectedWinningSide||e.winningSide&&!n&&!cr({score:r}),d=g=>{let I,{structure:v,drawDefinition:w,dualMatchUp:y,disableAutoCalc:b}=t;if(y?._disableAutoCalc&&b!==!1)return VL({...t,removeWinningSide:c});let{connectedStructureIds:S}=nJ({drawDefinition:w,structure:v,matchUp:e});S.length&&(console.log({connectedStructureIds:S}),I=!0),Object.assign(t,{removeScore:g});let U=Sv(t);if(U.error)return U;if(t.removingQualifier&&t.appliedPolicies?.[yb]?.autoRemoveQualifiers){let T=UPe(t);return{...H,connectedStructures:I,...T}}return{...H,connectedStructures:I}};if(c&&n&&t.isCollectionMatchUp)return EW(t);let p=[kc,us].includes(i)&&t.dualWinningSideChange,f=i&&i!==Fi,m=t.propagateExitStatus&&Fr(i),h=(n||p||m)&&wPe(t)||o&&d(u)||f&&hPe(t)||c&&d(u)||e&&EW({...t,removeScore:!0})||{...H};return z({result:h,stack:a})}function EW(t){let e="ndd:scoreModification";if(t.isCollectionMatchUp&&t.dualMatchUp?.winningSide&&!t.projectedWinningSide&&!t.autoCalcDisabled){let r=Sv(t);if(r.error)return r}let i=yo({...t});if(t.isCollectionMatchUp){let{matchUpTieId:r,drawDefinition:n,event:a,matchUpsMap:s}=t,{removeWinningSide:o}=Lc({tournamentRecord:t.tournamentRecord,appliedPolicies:t.appliedPolicies,matchUpId:r,drawDefinition:n,matchUpsMap:s,event:a});o&&console.log("REMOVE WINNING SIDE")}return z({result:i,stack:e})}function D_(t){let e=Ge(t,[{[mr]:!0,[mn]:!0,[Ul]:!0},{homeParticipantId:!0,[xs]:lr}]);if(e.error)return e;let i=Iv(t,[{[tv]:Du,attr:{[lR]:!0}}]);if(i.error)return i;let r=i?.matchUp?.matchUp?.sides?.map(c=>c?.participantId);if(t.homeParticipantId&&!r?.includes(t.homeParticipantId))return{error:To};let{disableNotice:n,homeParticipantId:a,removePriorValues:s,tournamentRecord:o,drawDefinition:l,matchUpId:u}=t;return wa({duplicateValues:!1,removePriorValues:s,tournamentRecord:o,drawDefinition:l,disableNotice:n,matchUpId:u,timeItem:{itemType:QF,itemValue:a}})}function sJ({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:r,timeStamp:n}=lf({timeItems:i?.timeItems||[],itemType:DR});return!e||n&&t&&new Date(n).getTime()>new Date(t).getTime()?{timeModifiers:r}:e}function Hd(t){let e="addMatchUpScheduledTime",i=t.matchUp,{removePriorValues:r,tournamentRecord:n,drawDefinition:a,disableNotice:s,scheduledTime:o,matchUpId:l}=t;if(!l)return z({result:{error:Un},stack:e});if(!ZI(o))return z({result:{error:Ps},stack:e});if(!i){let f=di({drawDefinition:a,matchUpId:l});if(f.error)return z({result:f,stack:e});i=f.matchUp}let u=Qe(o),c=uf({matchUp:i}).scheduledDate,d=u&&!c;if((sJ({matchUp:i}).timeModifiers||[])?.length){let f=oJ({disableNotice:!0,removePriorValues:r,tournamentRecord:n,timeModifiers:[],drawDefinition:a,matchUpId:l,matchUp:i});if(f?.error)return z({result:f,stack:e})}let p=sh(o,!0,d);return wa({duplicateValues:!1,removePriorValues:r,tournamentRecord:n,drawDefinition:a,disableNotice:s,matchUpId:l,timeItem:{itemType:fh,itemValue:p}})}function oJ({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,timeModifiers:n,matchUpId:a,matchUp:s}){let o="addMatchUpTimeModifiers";if(!a)return z({result:{error:Un},stack:o});if(n!==void 0&&!Array.isArray(n))return z({info:Np("timeModifiers"),result:{error:ie},stack:o});if(!s){let d=di({drawDefinition:i,matchUpId:a});if(d.error)return z({result:d,stack:o});s=d.matchUp}let l=sJ({matchUp:s}).timeModifiers||[],u=n.filter(d=>!l.includes(d));if(n.length&&!u.length)return{...H};if(u.some(d=>uO.includes(d))){l=l.filter(p=>!uO.includes(p));let d=Hd({disableNotice:!0,removePriorValues:t,scheduledTime:"",tournamentRecord:e,drawDefinition:i,matchUpId:a});if(d.error)return z({result:d,stack:o})}let c=n?.length?[...u,...l]:void 0;return wa({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:a,timeItem:{itemType:DR,itemValue:c}})}function NC({scheduledDate:t,removePriorValues:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:a}){if(!a)return{error:Un};let s=t&&rl.test(t);if(t&&!s)return{error:sr};let o={itemValue:Qe(t),itemType:ph};return wa({duplicateValues:!1,removePriorValues:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:a,timeItem:o})}function AC({removePriorValues:t,tournamentRecords:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,courtDayDate:a,matchUpId:s,courtIds:o}){if(!i&&!e)return{error:Ie};if(!s)return{error:Un};let l=di({drawDefinition:r,matchUpId:s});if(l.error)return l;if(l?.matchUp?.matchUpType!==ka)return{error:ta};if(!(o===void 0||Array.isArray(o)&&o.length&&o.every(c=>typeof c=="string")))return{error:ie,context:{courtIds:o}};let u;if(o){let c=e||i&&{[i.tournamentId]:i},d=Cu({tournamentRecords:c});if(d.error)return d;let p=d.courts?.filter(f=>o.includes(f.courtId));if(p?.length!==o.length)return{error:ie,context:{courtIds:o}};u=p?.map(f=>({venueId:f.venueId,courtId:f.courtId}))}return wa({duplicateValues:!1,removePriorValues:t,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:s,timeItem:{itemType:lu,itemDate:a,itemValue:u}})}function Uv({removePriorValues:t,tournamentRecords:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:a,venueId:s}){if(!i)return{error:Ie};if(!a)return{error:Un};if(s){let o=Eu({tournamentRecords:e,tournamentRecord:i,venueId:s});if(o.error)return o}return wa({duplicateValues:!1,removePriorValues:t,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:a,timeItem:{itemType:dh,itemValue:s}})}function Ph({removePriorValues:t,tournamentRecords:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,courtDayDate:a,matchUpId:s,courtId:o}){if(!i&&!e)return{error:Ie};if(!s)return{error:Un};if(o){let l=jd({tournamentRecords:e,tournamentRecord:i,courtId:o});if(l.error)return l;let u=l.venue?.venueId;Uv({tournamentRecords:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:s,venueId:u})}return wa({duplicateValues:!1,removePriorValues:t,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:s,timeItem:{itemType:Id,itemDate:a,itemValue:o}})}function Ho(t,e){let i=A4.test(t)?t:ci(t),r=Qe(t)||Qe(e)||Os(new Date);return new Date(`${r}T${i}`).getTime()}function kC(t){let e="addMatchUpScheduleItems",i=Ge(t,[{drawDefinition:!0,matchUpId:!0},{schedule:!0,[zn]:Yn}],e);if(i.error)return i;let{matchUpDependencies:r,inContextMatchUps:n}=t,{proConflictDetection:a=!1,errorOnAnachronism:s=!1,checkChronology:o=!0,removePriorValues:l,tournamentRecords:u,tournamentRecord:c,drawDefinition:d,disableNotice:p,drawMatchUps:f,matchUpId:m,schedule:h,event:g}=t,I,v;if(f)I=f.find(A=>A.matchUpId===m);else{let A=di({drawDefinition:d,event:g,matchUpId:m});if(A.error)return A;I=A.matchUp}let{endTime:w,courtId:y,courtIds:b,courtOrder:S,resumeTime:U,homeParticipantId:T,scheduledDate:P,scheduledTime:D,startTime:E,stopTime:R,timeModifiers:C,venueId:M}=h;o&&(!r||!n)&&({matchUpDependencies:r,matchUps:n}=oo({drawDefinition:d}));let N=r?.[m]?.matchUpIds;if(h.scheduledDate&&o&&N){let A=n?.filter(O=>(O.schedule?.scheduledDate||Qe(O.schedule?.scheduledTime))&&N.includes(O.matchUpId)).map(({schedule:O})=>{let k=ND(O);return new Date(k??"").getTime()});if(A?.length){let O=ND(h),k=new Date(O??"").getTime();if(Math.max(...A)>=k){if(s)return z({result:{error:Gk},stack:e});v=Gk}}}if(P!==void 0){let A=NC({disableNotice:!0,removePriorValues:l,tournamentRecord:c,drawDefinition:d,scheduledDate:P,matchUpId:m});if(A?.error)return z({result:A,stack:e,context:{scheduledDate:P}})}if(D!==void 0){let A=Hd({disableNotice:!0,removePriorValues:l,tournamentRecord:c,drawDefinition:d,scheduledTime:D,matchUpId:m,matchUp:I});if(A?.error)return z({result:A,stack:e,context:{scheduledTime:D}})}if(E!==void 0){let A=E_({disableNotice:!0,removePriorValues:l,tournamentRecord:c,drawDefinition:d,matchUpId:m,startTime:E,event:g});if(A?.error)return z({result:A,stack:e,context:{startTime:E}})}if(R!==void 0){let A=C_({disableNotice:!0,removePriorValues:l,tournamentRecord:c,drawDefinition:d,matchUpId:m,stopTime:R,event:g});if(A?.error)return z({result:A,stack:e,context:{stopTime:R}})}if(U!==void 0){let A=M_({disableNotice:!0,removePriorValues:l,tournamentRecord:c,drawDefinition:d,resumeTime:U,matchUpId:m,event:g});if(A?.error)return z({result:A,stack:e,context:{resumeTime:U}})}if(w!==void 0){let A=R_({disableNotice:!0,removePriorValues:l,tournamentRecord:c,drawDefinition:d,matchUpId:m,endTime:w,event:g});if(A?.error)return z({result:A,stack:e,context:{endTime:w}})}if(b!==void 0){let A=AC({disableNotice:!0,removePriorValues:l,tournamentRecord:c,drawDefinition:d,matchUpId:m,courtIds:b});if(A?.error)return z({result:A,stack:e,context:{courtIds:b}})}if(a&&y!==void 0&&P!==void 0&&S!==void 0&&ot(S)){let A=Ye(S),O=(br({tournamentRecord:c})?.matchUps??[]).find(k=>{if(k.matchUpId===m)return!1;let F=k.schedule?.courtOrder?Ye(k.schedule.courtOrder):void 0;return k.schedule?.courtId===y&&F===A&&k.schedule?.scheduledDate===P});if(O)return z({result:{error:t6,info:`Court slot already occupied by matchUp ${O.matchUpId}`},stack:e,context:{courtId:y,courtOrder:S,scheduledDate:P}})}if(y!==void 0&&P!==void 0){let A=Ph({courtDayDate:P,disableNotice:!0,removePriorValues:l,tournamentRecords:u,tournamentRecord:c,drawDefinition:d,matchUpId:m,courtId:y});if(A?.error)return z({result:A,stack:e,context:{courtId:y}})}if(M!==void 0){let A=Uv({disableNotice:!0,removePriorValues:l,tournamentRecords:u,tournamentRecord:c,drawDefinition:d,matchUpId:m,venueId:M});if(A?.error)return z({result:A,stack:e,context:{venueId:M}})}if(S!==void 0&&ot(S)){let A=P_({disableNotice:!0,removePriorValues:l,tournamentRecord:c,drawDefinition:d,courtOrder:S,matchUpId:m});if(A?.error)return z({result:A,stack:e,context:{courtOrder:S}})}if(C!==void 0){let A=oJ({disableNotice:!0,removePriorValues:l,tournamentRecord:c,drawDefinition:d,timeModifiers:C,matchUpId:m,matchUp:I});if(A?.error)return z({result:A,stack:e,context:{timeModifiers:C}})}return ri(T)&&D_({disableNotice:!0,homeParticipantId:T,removePriorValues:l,tournamentRecord:c,drawDefinition:d,matchUpId:m}),p||St({tournamentId:c?.tournamentId,eventId:g?.eventId,context:e,drawDefinition:d,matchUp:I}),v?{...H,warnings:[v]}:{...H}}function P_({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,courtOrder:n,matchUpId:a}){if(!a)return{error:Un};if(n&&!ot(n))return{error:ie,info:"courtOrder must be numeric"};let s=n&&Ye(n);return wa({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:a,timeItem:{itemType:TR,itemValue:s}})}function lJ({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,participantId:n,officialType:a,matchUpId:s}){if(!s)return{error:Un};if(!n)return{error:lr};if(e){let l=Ei({tournamentRecord:e,participantFilters:{participantTypes:[gt],participantRoles:[mL]}}).participants??[];if(!fd({tournamentParticipants:l,participantId:n}))return{error:Vi}}let o={itemType:"SCHEDULE.ASSIGNMENT.OFFICIAL",itemValue:n};return a&&(o.itemSubTypes=[a]),wa({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:s,timeItem:o})}function E_({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:n,startTime:a,event:s}){if(!n)return{error:Un};if(!ZI(a))return{error:Ps};let{matchUp:o}=di({drawDefinition:i,event:s,matchUpId:n}),{scheduledDate:l}=uf({matchUp:o}),u=(o?.timeItems??[]).filter(c=>[Qu,Gl,hc].includes(c?.itemType)).map(c=>Ho(c.itemValue,l)).reduce((c,d)=>!c||d<c?d:c,void 0);if(!u||Ho(a,l)<u){o?.timeItems&&(o.timeItems=o.timeItems.filter(d=>d.itemType!==mo));let c=sh(a,!0,!0);return wa({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:n,timeItem:{itemType:mo,itemValue:c}})}else return{error:Z6}}function R_({validateTimeSeries:t=!0,removePriorValues:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:a,endTime:s,event:o}){if(!a)return{error:Un};if(!ZI(s))return{error:Ps};let{matchUp:l}=di({drawDefinition:r,event:o,matchUpId:a}),{scheduledDate:u}=uf({matchUp:l}),c=(l?.timeItems??[]).filter(d=>[mo,Gl,Qu].includes(d?.itemType)).map(d=>Ho(d.itemValue,u)).reduce((d,p)=>!d||p>d?p:d,void 0);if(!t||!c||Ho(s,u)>c){l?.timeItems&&(l.timeItems=l.timeItems.filter(p=>p.itemType!==hc));let d=sh(s,!0,!0);return wa({duplicateValues:!1,removePriorValues:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:a,timeItem:{itemType:hc,itemValue:d}})}else return{error:J6}}function C_({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:n,stopTime:a,event:s}){if(!n)return{error:Un};if(!ZI(a))return{error:Ps};let{matchUp:o}=di({drawDefinition:i,event:s,matchUpId:n}),{scheduledDate:l}=uf({matchUp:o}),u=o?.timeItems??[];if(u.reduce((m,h)=>h.itemType===hc||m,void 0))return{error:j1};let c=u.filter(m=>[mo,Gl,Qu].includes(m?.itemType)).sort((m,h)=>Ho(m.itemValue,l)-Ho(h.itemValue,l)),d=c.at(-1),p=d?.itemType===Qu,f=c.filter(m=>!p||m.createdAt!==d.createdAt).map(m=>Ho(m.itemValue,l)).reduce((m,h)=>!m||h>m?h:m,void 0);if(Ho(a,l)>f){if(o?.timeItems&&p){let h=d.createdAt;o.timeItems=o.timeItems.filter(g=>g.createdAt!==h)}let m={itemValue:sh(a,!0,!0),itemType:Qu};return wa({duplicateValues:!0,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:n,timeItem:m})}else return{error:Q6}}function M_({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,resumeTime:n,matchUpId:a,event:s}){if(!a)return{error:Un};if(!ZI(n))return{error:Ps};let{matchUp:o}=di({drawDefinition:i,event:s,matchUpId:a}),{scheduledDate:l}=uf({matchUp:o}),u=o?.timeItems??[];if(u.reduce((m,h)=>h.itemType===hc||m,void 0))return{error:j1};let c=u.filter(m=>[mo,Gl,Qu].includes(m?.itemType)).sort((m,h)=>Ho(m.itemValue,l)-Ho(h.itemValue,l)),d=c.at(-1),p=d?.itemType===Gl,f=c.filter(m=>!p||m.createdAt!==d.createdAt).map(m=>Ho(m.itemValue,l)).reduce((m,h)=>!m||h>m?h:m,void 0);if(Ho(n,l)>f){if(o?.timeItems&&p){let h=d.createdAt;o.timeItems=o.timeItems.filter(g=>g.createdAt!==h)}let m={itemValue:sh(n,!0,!0),itemType:Gl};return wa({duplicateValues:!0,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:a,timeItem:m})}else return{error:Gme}}function DPe(t){let{targetData:e,matchUpsMap:i}=t,{targetMatchUps:{loserMatchUp:r}}=e,n=Fr(r?.matchUpStatus),a=!!i?.drawMatchUps.find(s=>s.loserMatchUpId===r?.matchUpId&&Fr(s.matchUpStatus));return a&&r?.matchUpStatus===wi||a&&n}function PPe({drawDefinition:t,matchUpStatus:e,matchUpsMap:i,winningSide:r,dualMatchUp:n,tieFormat:a,structure:s,matchUp:o,event:l,score:u}){let c=ke(n,void 0,!0);for(let p of c?.tieMatchUps||[])p.matchUpId===o.matchUpId&&(p.winningSide=r,p.score=u,!cr({score:u})&&!e?Object.assign(p,{...VR}):e&&(p.matchUpStatus=e));a=a??vn({matchUp:o,structure:s,drawDefinition:t,event:l})?.tieFormat;let{winningSide:d}=yS({matchUp:c,drawDefinition:t,matchUpsMap:i,structure:s,tieFormat:a,event:l});return{projectedWinningSide:d}}function EPe(t){let{tournamentRecord:e,inContextMatchUp:i,structure:r,drawDefinition:n}=t,a=i.roundNumber,s=i.sides.find(b=>b.sideNumber===i.winningSide),o=i.sides.find(b=>b.sideNumber!==i.winningSide),{drawPosition:l,participantId:u}=s,{drawPosition:c,participantId:d}=o,p="swapWinnerLoser",{matchUps:f}=Nt(t),m=f.filter(({drawPositions:b,roundNumber:S})=>b?.includes(l)&&S>a);ia({changeWinner:!0})&&console.log({existingWinnerSubsequentMatchUps:m}),m.forEach(b=>{b.drawPositions=b.drawPositions?.map(S=>S===l?c:S)||[],St({tournamentId:e?.tournamentId,eventId:t.event?.eventId,context:p,drawDefinition:n,matchUp:b})});let{stage:h,stageSequence:g}=r,I=n.structures.filter(({stage:b,stageSequence:S})=>b===h&&S>g).map(({structureId:b})=>b),{targetLinks:{loserTargetLink:v,winnerTargetLink:w}}=t.targetData,y=[v?.target.structureId,w?.target?.structureId].filter(Boolean);return n.structures.filter(({stage:b,structureId:S})=>b!==h&&y.includes(S)).forEach(({stage:b,stageSequence:S,structureId:U})=>{I.includes(U)||I.push(U),n.structures.filter(({stage:T,stageSequence:P})=>T===b&&P>S).forEach(({structureId:T})=>{I.includes(T)||I.push(T)})}),n.structures.filter(({structureId:b})=>I.includes(b)).forEach(b=>{let{positionAssignments:S}=Yt({structure:b}),U=S?.find(({participantId:P})=>P===u),T=S?.find(({participantId:P})=>P===d);U&&(U.participantId=d),T&&(T.participantId=u)}),yo({...t})}function pf(t){let e="setMatchUpStatus";t.matchUpStatus&&[mi,wi].includes(t.matchUpStatus)&&(t.score=void 0);let{allowChangePropagation:i,disableScoreValidation:r,propagateExitStatus:n,tournamentRecords:a,tournamentRecord:s,disableAutoCalc:o,enableAutoCalc:l,drawDefinition:u,matchUpStatus:c,winningSide:d,matchUpId:p,event:f,score:m}=t;if(!u)return{error:_e};if(c&&[kc,cs,us,Fi].includes(c)&&d)return{error:ie,winningSide:d,matchUpStatus:c};if(![void 0,...q5].includes(c))return z({result:{error:KI},info:"matchUpStatus does not exist",stack:"setMatchUpStatus"});let h=Ar({drawDefinition:u}),{matchUps:g}=Qi({nextMatchUps:!0,tournamentRecord:s,inContext:!0,drawDefinition:u,matchUpsMap:h,event:f}),I=h.drawMatchUps.find(V=>V.matchUpId===p),v=g?.find(V=>V.matchUpId===p);if(!I||!g)return{error:un};if((I.winningSide||d)&&c==="BYE")return{context:"Cannot have Bye with winningSide",error:GT,matchUpStatus:c};let w=v?.structureId,{structure:y}=et({drawDefinition:u,structureId:w}),b=Di(Zt)(I.matchUpType),S=v?.drawPositions?.filter(Boolean),U=v?.matchUpTieId,T=On({matchUpId:U||p,inContextDrawMatchUps:g,drawDefinition:u});Object.assign(t,{inContextDrawMatchUps:g,inContextMatchUp:v,matchUpTieId:U,matchUpsMap:h,targetData:T,structure:y,matchUp:I});let P=c===Fi&&m?.scoreStringSide1===""&&m?.scoreStringSide2===""&&!d;if(DPe(t)&&P)return{error:Nme};let D=kp(t),E;if(b){if(o)xt({extension:{name:Rm,value:!0},element:I});else if(l){let V=I.winningSide,{winningSide:_,scoreStringSide1:B,scoreStringSide2:G,set:j}=yS({drawDefinition:u,matchUpsMap:h,structure:y,matchUp:I,event:f}),K={scoreStringSide1:B,scoreStringSide2:G,sets:j?[j]:[]};if(E=_!==V,D&&E)return z({stack:"winningSideWithDownstreamDependencies",result:{error:BE},context:{winningSide:d,matchUp:I}});En({name:Rm,element:I}),Object.assign(t,{winningSide:_,dualWinningSideChange:E,projectedWinningSide:_,score:K})}bS({tournamentId:s?.tournamentId,inContextDualMatchUp:v,eventId:f?.eventId,dualMatchUp:I,drawDefinition:u})}if(b&&c&&[lh].includes(c))return{info:"Not supported for matchUpType: TEAM",error:ie};if(m&&!b&&!r){let V=I.matchUpFormat??y?.matchUpFormat??u?.matchUpFormat??f?.matchUpFormat,_=D0({existingMatchUpStatus:I.matchUpStatus,matchUpFormat:V,matchUpStatus:c,winningSide:d,score:m});if(_.error)return _}let R=Tt({policyTypes:[yb,Po],tournamentRecord:s,drawDefinition:u,event:f})?.appliedPolicies??{};bt(t.policyDefinitions)&&Object.assign(R,t.policyDefinitions);let C=CPe({assignedDrawPositions:S,propagateExitStatus:n,inContextMatchUp:v,appliedPolicies:R,drawDefinition:u,matchUpStatus:c,structure:y,matchUp:I});if(C?.error)return C;let M=v?.stage===We&&v.finishingRound===1,N=M&&d,A=M&&I.winningSide&&!d&&(!t.matchUpStatus||t.matchUpStatus&&pO({matchUpStatus:t.matchUpStatus}))&&(!t.outcome||!cr({outcome:t.outcome})),O=N&&d!==I.winningSide&&I.winningSide;if(Object.assign(t,{qualifierAdvancing:N,qualifierChanging:O,removingQualifier:A,appliedPolicies:R}),U){let{matchUp:V}=di({matchUpId:U,inContext:!0,drawDefinition:u,matchUpsMap:h,event:f});if(V){let _=vn({matchUp:V,drawDefinition:u,structure:y,event:f})?.tieFormat,{projectedWinningSide:B}=PPe({drawDefinition:u,matchUpStatus:c,dualMatchUp:V,matchUpsMap:h,winningSide:d,tieFormat:_,structure:y,matchUp:I,event:f,score:m}),G=V.winningSide;E=B!==G;let j=V._disableAutoCalc;Object.assign(t,{isCollectionMatchUp:!0,dualWinningSideChange:E,projectedWinningSide:B,autoCalcDisabled:j,matchUpTieId:U,dualMatchUp:V,tieFormat:_})}}let k=sS({matchUpStatus:c});if(!U){if(D&&!d&&(c&&pO({matchUpStatus:c})||c&&[wi,Hi].includes(c)))return{error:GT,activeDownstream:D,winningSide:d};if(d&&d===I.winningSide&&c&&!k)return{context:"winningSide must include directing matchUpStatus",error:GT,directingMatchUpStatus:k,matchUpStatus:c}}let{schedule:F}=t;if(F){let V=kC({disableNotice:!0,tournamentRecords:a,tournamentRecord:s,drawDefinition:u,matchUpId:p,schedule:F});if(V.error)return V}let x=!b&&!E&&d&&I.winningSide&&I.winningSide!==d;if(i&&x&&I.roundPosition)return EPe(t);let L=d&&!U||t.projectedWinningSide;Gt({activeDownstream:D,matchUpWinner:L,method:e,winningSide:d});let $=!D&&TPe(t)||L&&RPe(t)||(k||t.autoCalcDisabled)&&uJ(t)||{error:o4};return z({result:$,stack:e})}function RPe(t){let{matchUp:e,winningSide:i,matchUpTieId:r,dualWinningSideChange:n}=t;return i===e.winningSide||r&&!n?uJ(t):z({stack:"winningSideWithDownstreamDependencies",result:{error:BE},context:{winningSide:i,matchUp:e}})}function uJ(t){let{tournamentRecord:e,matchUp:i,event:r}=t,n=t.isCollectionMatchUp&&i.winningSide&&!t.winningSide&&!cr({score:t.score}),a=t.isCollectionMatchUp?t.matchUpStatus||n&&Fi||t.winningSide&&ki||cs:t.matchUpStatus||ki,s=t.removeScore||[kc,mi].includes(a)&&![cs,us].includes(a),o=yo({...t,matchUpStatus:a,removeWinningSide:n,removeScore:s});if(o.error)return o;if(t.isCollectionMatchUp){let{matchUpTieId:l,drawDefinition:u,matchUpsMap:c}=t,d=Lc({appliedPolicies:t.appliedPolicies,matchUpId:l,tournamentRecord:e,drawDefinition:u,matchUpsMap:c,event:r});if(d.error)return d;Object.assign(o,{tieMatchUpResult:d})}return o}function CPe({assignedDrawPositions:t,propagateExitStatus:e,inContextMatchUp:i,appliedPolicies:r,drawDefinition:n,matchUpStatus:a,structure:s,matchUp:o}){if(r?.[Po]?.requireParticipantsForScoring===!1)return{...H};let l=i?.sides?.map(d=>d.participantId).filter(Boolean).length,u=o?.sides?[]:Yt({structureId:s?.structureId,drawDefinition:n}).positionAssignments,c=l&&l===2||o.collectionId&&Vn({structure:s})&&l&&l>=1||t?.length===2&&u?.filter(d=>t.includes(d.drawPosition)).every(d=>d.participantId);return a&&[mi,Qt,wi].includes(a)&&l===1&&e?{...H}:a&&z5.includes(a)&&!c?z({info:"matchUpStatus requires assigned participants",context:{matchUpStatus:a,requiredParticipants:c},result:{error:KI}}):{...H}}function cJ({tournamentRecord:t,drawDefinition:e,matchUpId:i,event:r}){if(!e)return{error:_e};let{matchUp:n}=di({drawDefinition:e,matchUpId:i,event:r});return n?.matchUpType!==ka?{error:ta}:pf({enableAutoCalc:!0,tournamentRecord:t,drawDefinition:e,matchUpId:i,event:r})}function dJ({drawDefinition:t,event:e,matchUpId:i}){if(!t)return{error:_e};if(!i)return{error:Un};let{matchUp:r}=di({drawDefinition:t,event:e,matchUpId:i});return r?En({name:mR,element:r}):{error:un}}function MPe({substituteParticipantId:t,existingParticipantId:e,tournamentRecord:i,drawDefinition:r,sideNumber:n,matchUpId:a,event:s}){let o="substituteParticipant";if(!r)return{error:_e};if(!a)return{error:Un};if(!e||!t)return z({result:{error:lr},stack:o});let{matchUp:l}=di({drawDefinition:r,matchUpId:a,event:s});if(!l)return{error:un};if(!l.collectionId)return z({result:{error:ta},stack:o});let u=Ar({drawDefinition:r}),{matchUps:c}=Qi({tournamentParticipants:i?.participants,inContext:!0,drawDefinition:r,matchUpsMap:u}),d=c?.find(f=>f.matchUpId===a),p=c?.find(f=>f.matchUpId===d?.matchUpTieId)?.sides?.find(f=>f.participant.individualParticipants.some(({participantId:m})=>m===e));return!p||n&&p.sideNumber!==n?{error:To}:p.participant?.individualParticipants?.map(vt).filter(f=>f!==e)?.includes(t)?U_({newParticipantId:t,tieMatchUpId:a,existingParticipantId:e,substitution:!0,tournamentRecord:i,drawDefinition:r,event:s}):z({result:{error:To},stack:o})}function pJ(t){return MPe(t)}function fJ({drawDefinition:t,matchUpId:e,event:i}){if(!t)return{error:_e};let{matchUp:r}=di({drawDefinition:t,matchUpId:e,event:i});return xt({extension:{name:Rm,value:!0},element:r})}function mJ(t){let e="setMatchUpFormat",i=Ge(t,[{tournamentRecord:!0},{[Wr]:b=>xa({matchUpFormat:b}),[Fa]:Rw,matchUpFormat:!0}]);if(i.error)return z({result:i,stack:e});let{tournamentRecord:r,drawDefinition:n,scheduledDates:a,stageSequences:s,matchUpFormat:o,structureId:l,eventType:u,matchUpId:c,eventId:d,stages:p,drawId:f,event:m,force:h}=t;if(a&&!Array.isArray(a))return z({result:{error:ie,scheduledDates:a},stack:e});if(u&&!Zf([nl,ls],u))return z({result:{error:Zl},stack:e});let g=0,I=t.structureIds||l&&[l].filter(Boolean)||[],v=t.eventIds||d&&[d].filter(Boolean)||[],w=t.drawIds||f&&[f].filter(Boolean)||[];if((l||I?.length)&&!n)return z({result:{error:_e},stack:e});if(f&&c&&n){let b=C0({tournamentRecord:r,drawDefinition:n,matchUpFormat:o,structureIds:I,structureId:l,matchUpId:c});if(b.error)return b;g+=1}let y=b=>{let S=[];for(let U of b.structures||[]){if(Array.isArray(p)&&!p.includes(U.stage)||Array.isArray(s)&&!s.includes(U.stageSequence)||I?.length&&!I.includes(U.structureId))continue;I?.length&&U.matchUpFormat!==o&&(U.matchUpFormat=o,S.push(U.structureId),g+=1);let T=((h||a)&&Nt({matchUpFilters:{matchUpStatuses:[Fi]},structure:U}).matchUps)??[],P=(a&&Nt({matchUpFilters:{matchUpStatuses:[Fi]},contextFilters:{scheduledDates:a},afterRecoveryTimes:!1,inContext:!0,structure:U}).matchUps)??[];if(T?.length){let D=P?P.map(Ir):T.map(Ir);for(let E of T)D.includes(E.matchUpId)&&(E.matchUpFormat=a?.length?o:void 0,St({tournamentId:r?.tournamentId,eventId:m?.eventId,context:e,drawDefinition:b,matchUp:E}))}}return!S.length&&b.matchUpFormat!==o&&(b.matchUpFormat=o,g+=1),S};for(let b of r?.events||[])if(!(v?.length&&!v.includes(b.eventId)||u&&u!==b.eventType||u===rr))if(Array.isArray(s)||Array.isArray(p)||I?.length||w?.length)for(let S of b.drawDefinitions||[]){if(Array.isArray(w)&&!w.includes(S.drawId))continue;let U=y(S);ti({structureIds:U,drawDefinition:S})}else b.matchUpFormat!==o&&(b.matchUpFormat=o,g+=1);return g?{...H,modificationsCount:g}:{...H,info:QI}}function N_({inheritance:t=!0,tournamentRecord:e,drawDefinition:i,matchUpId:r,event:n}){if(!i)return{error:_e};let a=di({drawDefinition:i,matchUpId:r})?.matchUp;if(!a?.tieMatchUps)return{error:ta};let s=di({inContext:!0,drawDefinition:i,matchUpId:r,event:n})?.matchUp,o=0;return(a?.sides||[]).forEach(l=>{l.lineUp&&delete l.lineUp}),(s?.sides||[]).forEach(l=>{if(o+=1,t===!1){let u=s?.tieFormat,c=l.participantId;u&&c&&bh({drawDefinition:i,participantId:c,lineUp:[],tieFormat:u})}St({tournamentId:e?.tournamentId,context:"resetMatchUpLineUps",eventId:n?.eventId,drawDefinition:i,matchUp:a})}),{...H,modificationsCount:o}}function hJ(t){let{matchUpFormat:e,matchUpStatus:i,winningSide:r,score:n,setTBlast:a}=t;if(!n)return{sets:[]};let s=n.sets||[],o=Wl({winnerFirst:!1,matchUpFormat:e,matchUpStatus:i,setTBlast:a,sets:s}),l=Wl({winnerFirst:!1,reversed:!0,matchUpFormat:e,matchUpStatus:i,setTBlast:a,sets:s}),u=Wl({matchUpFormat:e,matchUpStatus:i,winningSide:r,setTBlast:a,sets:s}),c=o===u?l:o;return r&&(o=r===1?u:c,l=r===2?u:c),{score:{sets:s,scoreStringSide1:o,scoreStringSide2:l}}}function NPe({sourceMatchUpStatusCodes:t,propagateExitStatus:e,sourceMatchUpStatus:i,loserParticipantId:r,tournamentRecord:n,drawDefinition:a,loserMatchUp:s,matchUpsMap:o,event:l}){let u="progressExitStatus";Gt({method:u,newline:!0,color:"magenta",keyColors:{loserMatchUpId:"brightcyan",sourceMatchUpStatus:"brightyellow"},loserMatchUpId:s?.matchUpId,loserMatchUpStatus:s?.matchUpStatus,sourceMatchUpStatus:i,sourceMatchUpStatusCodes:JSON.stringify(t),loserParticipantId:r?.slice(0,8),propagateExitStatus:e});let c=Fr(i)&&i!==$r&&i||mi,d=Qi({inContext:!0,drawDefinition:a,matchUpsMap:o})?.matchUps,p=c,f=d?.find(m=>m.matchUpId===s?.matchUpId);if(Gt({method:u,color:"magenta",carryOverMatchUpStatus:c,updatedLoserMatchUpId:f?.matchUpId,updatedLoserStatus:f?.matchUpStatus,updatedLoserSides:JSON.stringify(f?.sides?.map(m=>({sn:m.sideNumber,pid:m.participantId?.slice(0,8),bye:m.bye}))),updatedLoserDP:JSON.stringify(f?.drawPositions),existingStatusCodes:JSON.stringify(f?.matchUpStatusCodes)}),f?.matchUpId&&p){let m,h=f.matchUpStatusCodes?.map(v=>typeof v=="string"?v:"WO")??[],g=f.sides?.find(v=>v.participantId===r);if(g?.sideNumber){let v=f?.sides?.reduce((w,y)=>y?.participantId?w+1:w,0);if(Gt({method:u,color:"brightyellow",keyColors:{decision:"brightgreen"},loserSideNumber:g.sideNumber,participantsCount:v,statusCodesLength:h.length,existingStatusCodes:JSON.stringify(h),loserMatchUpIsExit:Fr(s.matchUpStatus),loserMatchUpOriginalStatus:s.matchUpStatus}),v===1&&h.length===0)m=g.sideNumber===1?2:1,h[0]=t[0],Gt({method:u,color:"brightgreen",decision:"SINGLE_PARTICIPANT_no_existing_codes",winningSide:m,statusCodes:JSON.stringify(h)});else if(!Fr(s.matchUpStatus))m=g.sideNumber===1?2:1,h[0]=t[0],Gt({method:u,color:"brightgreen",decision:"TWO_PARTICIPANTS_not_exit",winningSide:m,statusCodes:JSON.stringify(h)});else{let w=h[0];h[g.sideNumber-1]=t[0];let y=g.sideNumber===1?2:1;h[y-1]=w,p=wi,m=void 0,Gt({method:u,color:"brightred",decision:"BOTH_EXITS_converting_to_DOUBLE_WALKOVER",loserMatchUpStatus:p,winningSide:m,statusCodes:JSON.stringify(h)})}}else Gt({method:u,color:"brightyellow",decision:"NO_LOSER_PARTICIPANT_SIDE_FOUND",loserParticipantId:r?.slice(0,8),availableSides:JSON.stringify(f.sides?.map(v=>({sn:v.sideNumber,pid:v.participantId?.slice(0,8)})))});Gt({method:u,color:"brightmagenta",keyColors:{finalStatus:"brightgreen",finalWinningSide:"brightyellow"},action:"calling_setMatchUpState",loserMatchUpId:s.matchUpId,finalStatus:p,finalWinningSide:m,finalStatusCodes:JSON.stringify(h)});let I=pf({matchUpStatus:p,matchUpId:s.matchUpId,matchUpStatusCodes:h,allowChangePropagation:!0,propagateExitStatus:e,tournamentRecord:n,drawDefinition:a,winningSide:m,event:l});return z({result:I,stack:u,context:{progressExitStatus:!0}})}return z({result:{error:ea},stack:u})}function OS(t){let e=Ge(t,[{[Ul]:!0,[mn]:!0}]);if(e.error)return e;let i="setMatchUpStatus",r=Is(t);if(!t.drawDefinition){let b=t.tournamentRecord??(t.tournamentId&&r[t.tournamentId]);t.tournamentRecord||(t.tournamentRecord=b);let S=jn({eventId:t.eventId,drawId:t.drawId,tournamentRecord:b});if(S.error)return S;S.drawDefinition&&(t.drawDefinition=S.drawDefinition),t.event=S.event}let{disableScoreValidation:n,propagateExitStatus:a,policyDefinitions:s,tournamentRecord:o,disableAutoCalc:l,enableAutoCalc:u,drawDefinition:c,matchUpId:d,schedule:p,event:f,notes:m}=t,h=t.matchUpFormat||t.outcome?.matchUpFormat,{policy:g}=af({policyType:Po,tournamentRecord:o,event:f}),I=t.allowChangePropagation!==void 0&&t.allowChangePropagation||g?.allowChangePropagation!==void 0&&g.allowChangePropagation||void 0,{outcome:v,setTBlast:w}=t;if(v?.winningSide&&![1,2].includes(v.winningSide))return{error:_E};if(h){let b=C0({tournamentRecord:o,drawDefinition:c,matchUpFormat:h,matchUpId:d,event:f});if(b.error)return b}if(v?.score?.sets&&!v.score.scoreStringSide1){let{score:b}=hJ({...v,setTBlast:w});v.score=b,v.score.sets=v.score.sets.filter(S=>S.side1Score||S.side2Score||S.side1TiebreakScore||S.side2TiebreakScore)}let y=pf({matchUpStatusCodes:v?.matchUpStatusCodes,matchUpStatus:v?.matchUpStatus,winningSide:v?.winningSide,allowChangePropagation:I,disableScoreValidation:n,score:v?.score,propagateExitStatus:a,tournamentRecords:r,policyDefinitions:s,tournamentRecord:o,disableAutoCalc:l,enableAutoCalc:u,drawDefinition:c,matchUpFormat:h,matchUpId:d,schedule:p,event:f,notes:m});if(y.context?.progressExitStatus){let b=!0,S=0;for(;b&&S<10;){b=!1,S+=1;let U=NPe({sourceMatchUpStatusCodes:y.context.sourceMatchUpStatusCodes,sourceMatchUpStatus:y.context.sourceMatchUpStatus,loserParticipantId:y.context.loserParticipantId,propagateExitStatus:t.propagateExitStatus,tournamentRecord:t.tournamentRecord,loserMatchUp:y.context.loserMatchUp,matchUpsMap:y.context.matchUpsMap,drawDefinition:t.drawDefinition,event:t.event});U.context?.loserMatchUp&&(Object.assign(y.context,U.context),b=!0)}}return z({result:y,stack:i})}function gJ(t){if(!t?.outcomes)return{error:Xe};if(!Array.isArray(t.outcomes))return{error:Xe,info:{outcomes:t.outcomes}};let e=t.tournamentRecords||t.tournamentRecord&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord}||{},i=t.outcomes??[],r=i.reduce((n,a)=>n.includes(a.tournamentId)?n:n.concat(a.tournamentId),[]);for(let n of r){let a=e[n];if(!a)return{error:Ie};let s=i.filter(o=>o.tournamentId===n);if(s.length){let o=APe({outcomes:s,tournamentRecord:a});if(o.error)return o}}return{...H}}function APe(t){let{tournamentRecords:e,tournamentRecord:i,outcomes:r,policyDefinitions:n}=t,a={};r.forEach(s=>{let{eventId:o}=s;a[o]||(a[o]=[]),a[o].push(s)});for(let s of Object.keys(a)){let{event:o}=jn({tournamentRecord:i,eventId:s});for(let l of a[s]){let{drawId:u}=l,c=o?.drawDefinitions?.find(d=>d.drawId===u);if(c&&u){let{matchUpFormat:d,matchUpId:p}=l,f=OS({schedule:l?.schedule,tournamentRecords:e,policyDefinitions:n,tournamentRecord:i,drawDefinition:c,matchUpFormat:d,matchUpId:p,outcome:l,drawId:u,event:o});if(f.error)return f}}}return{...H}}function kPe({drawDefinition:t,matchUpId:e,outcome:i,matchUp:r}){if(!r&&!t)return{error:_e};if(!i)return{error:Xe,info:"missing outcome"};if(!r&&!e)return{error:ea};if(!r){let n=di({drawDefinition:t,matchUpId:e});if(n.error)return n;r=n.matchUp}return typeof i!="object"||!i.score?.scoreStringSide1||!i.score?.scoreStringSide2?{error:ie}:xt({element:r,extension:{name:mR,value:i}})}function IJ(t){return kPe(t)}function A_(t){let e="resetTieFormat",{drawDefinition:i,event:r,uuids:n}=t,a=Ge(t,[{[mr]:!0,[Ul]:!0}],e);if(a.error)return a;let s=Iv(t,[{[tv]:Du}]);if(s[xs])return s;let o=t.tournamentRecord?.tournamentId,{matchUp:l,structure:u}=s?.matchUp??{};if(!l?.tieMatchUps)return z({result:{error:ta},info:"Must be a TEAM matchUp",stack:e});if(!l.tieFormat)return{...H};let c=vn({structure:u,drawDefinition:i,event:r})?.tieFormat;if(!c)return z({result:{error:_r},info:"No inherited tieFormat",stack:e});let d=[],p=[],f=[],m=[];for(let h of c.collectionDefinitions){let{matchUpCount:g,collectionId:I}=h;p.push(I);let v=(l.tieMatchUps||[]).filter(w=>w.collectionId===I);if(v.length>g)v.sort((w,y)=>(w.matchUpStatus===Fi?1:0)-(y.matchUpStatus===Fi?1:0)),f.push(...v.slice(0,g)),d.push(...v.slice(3).map(Ir));else if(f.push(...v),v.length<g){let w=g-v.length,y=IS({collectionDefinition:h,matchUpsLimit:w,matchUp:l,uuids:n});m.push(...y)}}for(let h of l?.tieMatchUps||[])h.collectionId&&!p.includes(h.collectionId)&&d.push(h.matchUpId);return m.length&&(f.push(...m),hd({eventId:r?.eventId,matchUps:m,drawDefinition:i,tournamentId:o})),d.length&&Pu({matchUpIds:d,eventId:r?.eventId,drawDefinition:i,tournamentId:o}),l&&(l.tieMatchUps=f,l.tieFormatId=void 0,l.tieFormat=void 0,St({structureId:u?.structureId,eventId:r?.eventId,context:e,drawDefinition:i,tournamentId:o,matchUp:l})),{...H,newMatchUps:m,deletedMatchUpIds:d}}function k_(t){let{tournamentRecord:e,drawDefinition:i,matchUpId:r,event:n}=t,a="resetScorecard";if(!i)return z({result:{error:_e},stack:a});if(!r)return z({result:{error:Un},stack:a});if(!ri(r))return z({result:{error:ie,matchUpId:r},stack:a});let s=Ar({drawDefinition:i}),{matchUps:o}=Qi({nextMatchUps:!0,inContext:!0,drawDefinition:i,matchUpsMap:s}),l=s.drawMatchUps.find(h=>h.matchUpId===r),u=o?.find(h=>h.matchUpId===r);if(!l||!o)return{error:un};if(l.matchUpType!==ya)return{error:ta};let c=On({inContextDrawMatchUps:o,drawDefinition:i,matchUpId:r}),d=u?.structureId,{structure:p}=et({drawDefinition:i,structureId:d});if(Object.assign(t,{inContextDrawMatchUps:o,inContextMatchUp:u,matchUpsMap:s,targetData:c,structure:p,matchUp:l}),kp(t))return{error:BE};if(l.tieMatchUps?.length)for(let h of l.tieMatchUps){let g=pf({matchUpId:h.matchUpId,matchUpTieId:r,winningSide:void 0,removeScore:!0,tournamentRecord:e,drawDefinition:i,event:n});if(g.error)return z({result:g,stack:a})}let f=Tt({tournamentRecord:e,drawDefinition:i,event:n})?.appliedPolicies,m=Lc({event:t.event,removeScore:!0,tournamentRecord:e,appliedPolicies:f,drawDefinition:i,matchUpsMap:s,matchUpId:r});if(m.error)return z({result:m,stack:a});if(t.tiebreakReset&&!m.tieFormatRemoved){let h=vn({drawDefinition:i,structure:p,event:n})?.tieFormat;if(l.tieFormat&&h){let{matchUpCountDifference:g,descendantDifferences:I,ancestorDifferences:v,valueDifference:w}=gc({descendant:l.tieFormat,ancestor:h});if(I.collectionIds.length===1&&!v.collectionIds.length&&!v.groupsCount&&g===1&&w===1){let y=A_({tournamentRecord:e,drawDefinition:i,matchUpId:r,event:n});if(y.error)return y}}}return{...H}}function vJ(t){let e=Ge(t,[{[mn]:!0,[Ac]:!0},{[tI]:{[$w]:!1,roundNumbers:!1},[k5]:"At least one must be provided",[zn]:an}]);if(e.error)return e;let i=b8(t);if(i.error)return i;let{matchUpIds:r}=i,n=Di(ya)(t.event.eventType),{tournamentRecord:a,drawDefinition:s,event:o}=t;for(let l of r){if(n){let c=k_({tiebreakReset:!0,tournamentRecord:a,drawDefinition:s,matchUpId:l,event:o});if(c.error||t.removeAssignments&&N_({inheritance:!1,drawDefinition:s,matchUpId:l}).error)return c}let u=pf({winningSide:void 0,removeScore:!0,tournamentRecord:a,drawDefinition:s,matchUpId:l,event:o});if(u.error)return u;if(t.removeAssignments){let c=T_({...t,matchUpId:l});if(c.error)return c}}return{...H}}function OPe({tournamentRecord:t,drawDefinition:e,finishingOrder:i}){if(!e)return{error:_e};let r="setOrderOfFinish";if(!Array.isArray(i))return z({info:Np("finishingOrder"),result:{error:ie},stack:r});let{completedMatchUps:n,matchUpsMap:a}=ov({inContext:!0,drawDefinition:e}),s=n?.map(Ir)??[],o=i.map(Ir),{matchUpTypes:l,roundNumbers:u,structureIds:c,matchUpTieIds:d}=(n??[]).filter(({matchUpId:v})=>o.includes(v)).reduce((v,w)=>{let{matchUpTieId:y,matchUpType:b,roundNumber:S,structureId:U}=w;return v.matchUpTypes.includes(b)||v.matchUpTypes.push(b),v.roundNumbers.includes(S)||v.roundNumbers.push(S),v.structureIds.includes(U)||v.structureIds.push(U),v.matchUpTieIds.includes(y)||v.matchUpTieIds.push(y),v},{matchUpTypes:[],roundNumbers:[],structureIds:[],matchUpTieIds:[]});if(l.length>1||d.length>1||u.length>1||c.length>1)return z({info:"matchUpType, structureId and roundNumber must be equivalent",result:{error:ie},stack:r});let p,f,m={},h=[],g=[];if(!i.every(({orderOfFinish:v,matchUpId:w})=>(h.push(w),v&&g.push(v),m[w]=v,p=s.includes(w),f=v===void 0||ot(v)&&Math.floor(v)>0,p&&f)))return z({result:{error:p?ie:KI},info:!p&&"matchUps must be completed"||!f&&"orderOfFinish must be integer > 0 or undefined"||void 0,stack:r});let I=n?.filter(v=>v.structureId===c[0]&&v.roundNumber===u[0]&&v.matchUpType===l[0]&&v.matchUpTieId===d[0]&&!h.includes(v.matchUpId));for(let v of I??[]){let{orderOfFinish:w}=v||{};if(w){if(!ot(w))return z({context:{orderOfFinish:w,matchUp:v},result:{error:ie},stack:r});g.push(w)}}if(zY(g).length!==g.length||Math.max(...g)>g.length)return z({info:"Values not unique or greater than expected number of values",result:{error:ie},stack:r});if(c.length){let v=NR({matchUpFilters:{matchUpIds:o},structureId:c[0],drawDefinition:e,matchUpsMap:a});if(v.error)return z({result:v,stack:r});v.completedMatchUps?.forEach(w=>{w.orderOfFinish=m[w.matchUpId],St({tournamentId:t.tournamentId,context:"setOrderOfFinish",drawDefinition:e,matchUp:w})})}return{...H}}function yJ(t){return OPe(t)}function bJ(t){let{tournamentRecord:e,drawDefinition:i,matchUpId:r,lineUps:n,event:a}=t,s="applyLineUps",o=Ge(t,[{[mr]:!0,[mn]:!0,[Ul]:!0},{lineUps:!0,[zn]:an}],s);if(o.error)return o;let l=e.participants||[],u=di({tournamentParticipants:l,inContext:!0,drawDefinition:i,matchUpId:r});if(u.error)return u;if(!u.matchUp)return{error:un};let{matchUp:c,structure:d}=u,{drawPositions:p,matchUpType:f}=c;if(f!==Zt)return{error:ta};if(!p?.length)return{error:Dw};let m=vn({matchUp:c,drawDefinition:i,structure:d,event:a})?.tieFormat,h={};for(let I of n){if(!Array.isArray(I))return{error:ie,lineUp:I};let v={},w=[];for(let T of I){if(typeof T!="object")return{error:ie,lineUpAssignment:T};let{participantId:P,collectionAssignments:D=[]}=T;if(!Array.isArray(D))return{error:ie,collectionAssignments:D};let E=l.find(C=>C.participantId===P);if(!E)return{error:Vi};if(E.participantType!==gt)return{error:Do};let R=c.sides?.find(C=>C.participant?.individualParticipantIds?.includes(P))?.sideNumber;R&&w.push(R);for(let C of D){if(typeof C!="object")return{error:ie,collectionAssignment:C};let{collectionId:M,collectionPosition:N}=C,A=m?.collectionDefinitions?.find(F=>F.collectionId===M);if(!A)return{error:ie,collectionId:M};let O=`${M}-${N}`;v[O]||(v[O]=[]);let k=v[O].length;if(Di(Wt)(A.matchUpType)&&k||A.matchUpType===$t&&k>1)return{info:"Excessive collectionPosition assignments",error:ie};v[O].push(P)}}let y=Object.values(v);for(let T of y)if(T.length===2){let{participant:P}=Qs({tournamentParticipants:l,participantIds:T});if(!P){let D=ul({participant:{participantType:pt,participantRole:Kr,individualParticipantIds:T},pairOverride:!0,tournamentRecord:e});if(D.error)return D}}let b=va(w),S=(b[1]||0)>(b[2]||0)&&1||(b[2]||0)>(b[1]||0)&&2||void 0,U=Object.keys(h).map(T=>parseInt(T));S&&!U.includes(S)&&(h[S]=I)}if(!Object.keys(h).length)return{error:q1};if(u=di({drawDefinition:i,matchUpId:r}),u.error)return u;if(!u.matchUp)return{error:un};let{matchUp:g}=u;g.sides??=[];for(let I of[1,2]){let v=g.sides.find(y=>y.sideNumber===I),w=h[I];if(w)v?v.lineUp=w:g.sides.push({lineUp:w,sideNumber:I});else continue}return St({tournamentId:e?.tournamentId,context:s,drawDefinition:i,matchUp:g}),{...H}}var O_={};ct(O_,{anonymizeTournamentRecord:()=>jJ,generate:()=>wJ,generateEventWithDraw:()=>$C,generateOutcome:()=>j_,generateOutcomeFromScoreString:()=>x_,generateParticipants:()=>Tv,generateTournamentRecord:()=>BJ,modifyTournamentRecord:()=>HJ,mutate:()=>VJ});var wJ={};ct(wJ,{generateEventWithDraw:()=>$C,generateOutcome:()=>j_,generateOutcomeFromScoreString:()=>x_,generateParticipants:()=>Tv,generateTournamentRecord:()=>BJ});function xPe(t){let e=t.reduce((i,r)=>((r.side1Score!==void 0||r.side2Score!==void 0)&&(i.side1+=r.side1Score??0,i.side2+=r.side2Score??0),i),{side1:0,side2:0});return e.side1>e.side2?1:e.side2>e.side1?2:t.find(i=>i.side1TiebreakScore!==void 0||i.side2TiebreakScore!==void 0)?.winningSide}function FPe(t){let e={side1:0,side2:0};if(t.forEach(i=>{i.winningSide===1?e.side1++:i.winningSide===2&&e.side2++}),e.side1>e.side2)return 1;if(e.side2>e.side1)return 2}function LPe(t,e,i){if(t||!e||!i)return t;let r=zi(e);return aC(r)?xPe(i):FPe(i)}function _Pe(t,e,i){let r=ES({scoreString:t,matchUpFormat:e});return{sets:r,scoreStringSide1:Wl({sets:r,matchUpFormat:e,setTBlast:i}),scoreStringSide2:Wl({sets:r,reversed:!0,matchUpFormat:e,setTBlast:i})}}function $Pe(t,e,i,r){let n=Wl({sets:t,matchUpFormat:i,setTBlast:r}),a=Wl({sets:t,reversed:!0,matchUpFormat:i,setTBlast:r});if(typeof n!="string")return n;if(typeof a!="string")return a;let s=e===2?a:n,o=e===2?n:a;return{sets:ES({scoreString:s,matchUpFormat:i}),scoreStringSide1:s,scoreStringSide2:o}}function x_(t){let{matchUpFormat:e,matchUpStatus:i,winningSide:r,scoreString:n,setTBlast:a,preserveSideOrder:s=!1}=t;if(!n)return{outcome:{...VR,winningSide:r,matchUpStatus:i}};if(r&&![1,2,void 0].includes(r))return{error:ie,winningSide:r};let o=n&&ES({scoreString:n,matchUpFormat:e}),l=n?.trim().startsWith("["),u=LPe(r,e,o),c=zi(e),d=s||l||aC(c)?_Pe(n,e,a):$Pe(o,u,e,a);return Ve({outcome:{matchUpStatus:i,winningSide:u,score:d}})}function F_({matchUpScheduleTimes:t,matchUpDependencies:e,allDateMatchUpIds:i,matchUp:r}){let n=(e?.[r.matchUpId]?.matchUpIds||[]).filter(a=>i.includes(a)).filter(a=>!t[a]);return{dependenciesScheduled:!n?.length,remainingDependencies:n}}function xS({individualParticipantProfiles:t,participantId:e}){t[e]||(t[e]={typeChangeTimeAfterRecovery:void 0,timeAfterRecovery:void 0,priorMatchUpType:void 0,potentialRecovery:{},potentialCounted:{},potentialBookings:{},bookings:[],counters:{}})}function BPe({individualParticipantProfiles:t,recoveryValue:e,participantId:i,scheduleTime:r,drawId:n}){t[i].potentialRecovery[n]||(t[i].potentialRecovery[n]=[]),t[i].potentialRecovery[n].push(e),t[i].potentialBookings[n]||(t[i].potentialBookings[n]=[]),t[i].potentialBookings[n].push({timeAfterRecovery:e,scheduleTime:r})}function Nb({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,typeChangeRecoveryMinutes:i,averageMatchUpMinutes:r=0,matchUpNotBeforeTimes:n,matchUpDependencies:a,recoveryMinutes:s=0,scheduleTime:o,matchUp:l}){let u=ci(l?.schedule?.endTime),c=u?Xn(u,Ye(s)):Xn(o,Ye(r)+Ye(s)),d=i&&(u?Xn(ci(u),i):Xn(o,Ye(r)+Ye(i))),p=a?.[l.matchUpId]?.participantIds||[],f=(l.roundPosition&&t[l.matchUpId]||[]).flat();p.forEach(m=>{xS({individualParticipantProfiles:e,participantId:m});let h=e[m].priorMatchUpType!==l.matchUpType&&d||c;f.includes(m)?BPe({individualParticipantProfiles:e,drawId:l.drawId,recoveryValue:h,participantId:m,scheduleTime:o}):(e[m].timeAfterRecovery=h,e[m].bookings.push({scheduleTime:o,timeAfterRecovery:h}))}),cI({matchUpPotentialParticipantIds:t,matchUpNotBeforeTimes:n,timeAfterRecovery:c,matchUp:l})}function SJ({matchUpScheduleTimes:t,matchUpDependencies:e,scheduleTime:i,matchUpId:r,details:n}){let a,s=n.minutesMap?.[r]?.recoveryMinutes,o=(n.minutesMap?.[r]?.averageMinutes||0)+(s||0),l=Xn(i,o),u=e?.[r]?.dependentMatchUpIds||[];if(u.length){let c=u.reduce((d,p)=>{let f=t[p];if(!f)return d;let m={scheduleTime:f,matchUpId:p};return f&&!d.matchUpId||Pt(f)<Pt(d.scheduleTime)?m:d},{});c.scheduleTime&&Pt(l)>Pt(c.scheduleTime)&&(a=c)}return{scheduledDependent:a}}function VPe(t){let{sides:e,matchUpType:i}=t||{};return(e||[]).map(r=>i===$t&&(r?.participant?.individualParticipants||[])||r?.participant&&[r.participant]||[]).flat()}var FS="DO_NOT_SCHEDULE",jPe={DO_NOT_SCHEDULE:FS};function L_({averageMatchUpMinutes:t=90,requestConflicts:e={},potentials:i=!0,personRequests:r,scheduleTime:n,scheduleDate:a,matchUp:s}){let o=VPe(s).map(({person:f})=>f?.personId);if(i){let f=(s?.potentialParticipants||[]).flat().map(({person:m})=>m?.personId);o.push(...f)}let l=o.map(f=>r[f]?.map(m=>({...m,personId:f}))).filter(Boolean).flat().filter(f=>f.requestType===FS&&tu(a,f.date)),u=[],c=s?.matchUpId,d=Xi(ci(n),Qe(a)),p=ci(sF(d,t).toISOString());for(let f of l){let{requestId:m,startTime:h,endTime:g}=f;(n>h&&n<g||p&&p>h&&p<g)&&(u.push({matchUpId:c,request:f,scheduleTime:n}),e[m]?(e[m].scheduleTimes.includes(n)||e[m].scheduleTimes.push(n),e[m].matchUpIds.includes(c)||e[m].matchUpIds.push(c)):e[m]={request:f,scheduleTimes:[n],matchUpIds:[c]})}return{conflicts:u}}function LO({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,matchUp:i,value:r}){let{matchUpType:n}=i,{individualParticipantIds:a}=bR(i),s=(t[i.matchUpId]||[]).filter(o=>!kn(o,a)).flat();[...a,...s].forEach(o=>{if(xS({individualParticipantProfiles:e,participantId:o}),!e[o].potentialCounted[i.drawId]){let l=e[o].counters;l[n]?l[n]+=r:r>0&&(l[n]=r),l[Ls]?l[Ls]+=r:r>0&&(l[Ls]=r),s.includes(o)&&(e[o].potentialCounted[i.drawId]=!0)}})}function GPe({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,dateScheduledMatchUpIds:i,greatestAverageMinutes:r,dateScheduledMatchUps:n,matchUpNotBeforeTimes:a,matchUpScheduleTimes:s,matchUpDependencies:o,clearScheduleDates:l,scheduleDate:u,minutesMap:c,matchUps:d}){let p=[];i||(n=d?.filter(h=>{let g=h.schedule||{},I=h.matchUpStatus==="BYE";return I&&p.push({tournamentId:h.tournamentId,matchUpId:h.matchUpId}),!I&&MS({schedule:g})&&(!u||h.schedule.scheduledDate===u)}),i=n.map(Ir));let f=Array.isArray(l)?l.includes(u):l,m=f?[]:d.filter(({matchUpId:h})=>i.includes(h));for(let h of m){LO({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,value:1,matchUp:h});let g=h.schedule?.scheduledTime;if(g){s[h.matchUpId]=g;let I=c?.[h.matchUpId]?.recoveryMinutes;Nb({individualParticipantProfiles:e,matchUpPotentialParticipantIds:t,matchUpNotBeforeTimes:a,matchUpDependencies:o,averageMatchUpMinutes:r,recoveryMinutes:I,scheduleTime:g,matchUp:h})}}return{dateScheduledMatchUpIds:i,byeScheduledMatchUpDetails:p,dateScheduledMatchUps:n,clearDate:f}}function OC({defaultRecoveryMinutes:t=0,averageMatchUpMinutes:e=90,dateScheduledMatchUps:i,tournamentRecords:r,venueIds:n=[],periodLength:a,scheduleDate:s,matchUps:o}){if(typeof r!="object")return{error:Ci};if(!Ga(o)&&!Array.isArray(i))return{error:Tu};a=a??EC({recoveryMinutes:t,averageMatchUpMinutes:e});let l=Object.assign({},...Object.values(r).flatMap(d=>(d.events??[]).map(p=>{let{scheduleTiming:f}=Yw({tournamentRecord:d,event:p});return{[p.eventId]:{event:p,scheduleTiming:f}}}))),u={averageTimes:[{minutes:{default:e}}],recoveryTimes:[{minutes:{default:t}}]};i??=o?.filter(d=>{let p=d.schedule;return MS({schedule:p})&&(!s||d.schedule.scheduledDate===s)});let c=i?.filter(d=>(!n.length||n.includes(d.schedule.venueId))&&d.matchUpStatus!=="BYE");return{bookings:c?.map(({eventId:d,schedule:p,matchUpFormat:f})=>{let{event:m,scheduleTiming:h}=l[d],g=m?.eventType,I={...h,defaultTiming:u,matchUpFormat:f},{averageMinutes:v,recoveryMinutes:w}=PR({timingDetails:I,eventType:g}),{courtId:y,venueId:b}=p,S=ci(p.scheduledTime),U=Xn(S,v);return{recoveryMinutes:w,averageMinutes:v,periodLength:a,startTime:S,courtId:y,endTime:U,venueId:b}}).filter(Boolean),relevantMatchUps:c,dateScheduledMatchUps:i}}function HPe({calculateStartTimeFromCourts:t=!0,remainingScheduleTimes:e,defaultRecoveryMinutes:i,averageMatchUpMinutes:r,clearScheduleDates:n,tournamentRecords:a,tournamentRecord:s,periodLength:o,scheduleDate:l,startTime:u,venueIds:c,matchUps:d,endTime:p}){if(s&&!a&&(a={[s.tournamentId]:s}),typeof a!="object"||!Object.keys(a).length)return{error:Ci};o=o??EC({recoveryMinutes:i,averageMatchUpMinutes:r});let{courts:f,venues:m}=Cu({dates:[l],ignoreDisabled:!0,tournamentRecords:a}),h=f?.filter(b=>!c||c.includes(b.venueId))??[];u=u??dI({courts:h,scheduleDate:l,startTime:!0}),p=p??dI({courts:h,scheduleDate:l,endTime:!0});let{bookings:g,dateScheduledMatchUps:I}=OC({defaultRecoveryMinutes:i,averageMatchUpMinutes:r,tournamentRecords:a,scheduleDate:l,periodLength:o,venueIds:c,matchUps:d}),v={calculateStartTimeFromCourts:t,remainingScheduleTimes:e,averageMatchUpMinutes:r,clearScheduleDates:n,date:l,periodLength:o,startTime:u,bookings:g,endTime:p,courts:h},{scheduleTimes:w}=y_(v),y=c?.length===1&&c[0]||m?.length===1&&m[0].venueId||void 0;return{dateScheduledMatchUpIds:I?.map(ba("matchUpId")),dateScheduledMatchUps:I,scheduleTimes:w,venueId:y}}function WPe({scheduledRoundsDetails:t,greatestAverageMinutes:e,garmanSinglePass:i}){let r=[],n=[],a,s,o,l;for(let u of t.filter(Boolean))l||(l=u.hash),(u.hash===l||i)&&(n=n.concat(u.matchUpIds)),u.hash,o=e,s=u.recoveryMinutes,a=u.roundPeriodLength;return n.length&&r.push({matchUpIds:n,roundPeriodLength:a,recoveryMinutes:s,averageMinutes:o}),{groupedRounds:r}}function UJ({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,scheduleCompletedMatchUps:i,containedStructureIds:r,matchUpNotBeforeTimes:n,matchUpScheduleTimes:a,matchUpDependencies:s,clearScheduleDates:o,tournamentRecords:l,periodLength:u,scheduleDate:c,useGarman:d,matchUps:p,courts:f,venues:m}){let h={},g=[],I=[],v=[];for(let w of m){let{rounds:y=[],venueId:b}=w,{scheduledRoundsDetails:S,greatestAverageMinutes:U,orderedMatchUpIds:T,minutesMap:P}=RS({scheduleCompletedMatchUps:i,containedStructureIds:r,tournamentRecords:l,periodLength:u,matchUps:p,rounds:y});v.push(...T??[]);let{groupedRounds:D}=WPe({scheduledRoundsDetails:S,greatestAverageMinutes:U,garmanSinglePass:!0}),E,R=[];d&&({scheduleTimes:R,dateScheduledMatchUpIds:E}=HPe({averageMatchUpMinutes:D[0]?.averageMinutes,scheduleDate:Qe(c),venueIds:[w.venueId],clearScheduleDates:o,tournamentRecords:l,periodLength:u,matchUps:p}));let C=GPe({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,dateScheduledMatchUpIds:E,greatestAverageMinutes:U,matchUpNotBeforeTimes:n,matchUpScheduleTimes:a,matchUpDependencies:s,clearScheduleDates:o,scheduleDate:c,minutesMap:P,matchUps:p});({dateScheduledMatchUpIds:E}=C);let M=C,{byeScheduledMatchUpDetails:N,clearDate:A}=C;N?.length&&I.push(...N);let{matchUpsToSchedule:O,matchUpMap:k}=pC({matchUpPotentialParticipantIds:t,scheduleCompletedMatchUps:i,dateScheduledMatchUpIds:E,matchUpNotBeforeTimes:n,matchUpScheduleTimes:a,orderedMatchUpIds:T,clearDate:A,matchUps:p}),F=f.filter(x=>x.venueId===b);h[b]={previousRemainingScheduleTimes:[],courtsCount:F.length,greatestAverageMinutes:U,scheduledRoundsDetails:S,dateScheduledMatchUps:M,matchUpsToSchedule:O,scheduleTimes:R,groupedRounds:D,venueCourts:F,minutesMap:P,matchUpMap:k},o||g.push(...E)}return{allDateScheduledByeMatchUpDetails:I,allDateScheduledMatchUpIds:g,venueScheduledRoundDetails:h,allDateMatchUpIds:v}}function zPe(t,e){let i=Pt(t.scheduleTime),r=Pt(t.timeAfterRecovery),n=Pt(e.scheduleTime),a=Pt(e.timeAfterRecovery),s=i===n||r===a,o=i>n&&i<a,l=n>i&&n<r,u=r>n&&r<a,c=a>i&&a<r;return Ve({hasOverlap:s||o||u||l||c,startAisContained:o,endAisContained:u,startBisContained:l,endBisContained:c},!0)}function __({individualParticipantProfiles:t,matchUpNotBeforeTimes:e,matchUpDependencies:i,scheduleTime:r,matchUp:n,details:a}){let s=(i?.[n.matchUpId]?.participantIds||[]).flat(),o=a?.minutesMap?.[n.matchUpId]?.averageMinutes||0,l=a?.minutesMap?.[n.matchUpId]?.recoveryMinutes||0,u=s.every(p=>{xS({individualParticipantProfiles:t,participantId:p});let f=t[p];if(!f.timeAfterRecovery)return!0;let m=ci(n?.schedule?.endTime),h=m?Xn(m,Ye(l)):Xn(r,Ye(o)+Ye(l));return![...Object.keys(f.potentialBookings).filter(g=>g!==n.drawId).map(g=>f.potentialBookings[g]).flat(),...f.bookings].find(g=>zPe({scheduleTime:r,timeAfterRecovery:h},g).hasOverlap)}),c=e[n.matchUpId],d=(c?kw(Xi(c),Xi(r),!1):0)>=0;return{enoughTime:u&&d}}function TJ({autoSchedulingAudit:t,tournamentRecords:e}){at({topic:Ju,payload:t});let i=s=>s?Object.values(s).reduce((o,l)=>o+l.length||0,0):0,r=(t?.schedulingProfile||[]).reduce((s,o)=>s+o.venues.reduce((l,u)=>l+u.rounds.length,0),0),n={scheduledDatesCount:t.scheduledDates?.length,noTimeMatchUpIdsCount:i(t?.noTimeMatchUpIds),scheduledMatchUpIdsCount:i(t?.scheduledMatchUpIds),overLimitMatchUpIdsCount:i(t?.overLimitMatchUpIds),requestConflictsCount:i(t?.requestConflicts),profileRoundsCount:r},a={itemType:OO,itemValue:n};for(let s of Object.values(e)){let o=s.tournamentId;qE(Ju)?at({payload:{type:OO,tournamentId:o,detail:n},topic:Ju}):wS({tournamentRecord:s,timeItem:a})}}function $_({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,matchUpDailyLimits:i={},matchUp:r}){let{enteredIndividualParticipantIds:n}=bR(r),{matchUpId:a,matchUpType:s}=r,o=(r.roundPosition&&t[a]||[]).flat(),l=rt(n.concat(...o));return l.forEach(u=>{xS({individualParticipantProfiles:e,participantId:u})}),{participantIdsAtLimit:l.filter(u=>{let c=e[u];if(c)return[s,Ls].find(d=>{let p=c.counters?.[d]||0,f=i[d]||0;return p&&f&&p>=f})}),relevantParticipantIds:l}}function Ab({scheduleCompletedMatchUps:t=!1,scheduleByeMatchUps:e=!1,errorOnAnachronism:i=!1,checkChronology:r=!0,matchUpDependencies:n,removePriorValues:a,tournamentRecords:s,tournamentRecord:o,matchUpDetails:l,matchUpIds:u,schedule:c}){if(!o)return{error:Ie};if(!l&&(!u||!Array.isArray(u)))return{error:eh};if(!l&&(!c||typeof c!="object"))return{error:t4};let d,p=[],f=0;if(r&&!n){let g=oo({tournamentRecords:s,tournamentRecord:o});n=g.matchUpDependencies,d=g.matchUps}d||(d=br({tournamentRecord:o})?.matchUps??[]);let m=d.reduce((g,I)=>{let{matchUpId:v,drawId:w,matchUpStatus:y}=I;return(e||y!=="BYE")&&(t||!Yi.includes(y))&&(g[w]?g[w].push(v):g[w]=[v]),g},{}),h=l?.map(g=>g.matchUpId);for(let g of Object.keys(m)){let{drawDefinition:I}=Gd({tournamentRecord:o,drawId:g});if(!I)continue;let v=m[g].filter(y=>u?.includes(y)??h?.includes(y)),w=Rn({inContext:!1,drawDefinition:I}).matchUps;for(let y of v){let b=l?.find(U=>U.matchUpId===y)?.schedule||c,S=kC({schedule:b,matchUpDependencies:n,errorOnAnachronism:i,removePriorValues:a,inContextMatchUps:d,tournamentRecords:s,tournamentRecord:o,checkChronology:r,drawDefinition:I,drawMatchUps:w,matchUpId:y});if(S?.warnings?.length&&p.push(...S.warnings),S?.success&&(f+=1),S.error)return S}}return p.length?{...H,scheduled:f,warnings:p}:{...H,scheduled:f}}function LS(t){let{scheduleCompletedMatchUps:e=!1,scheduleByeMatchUps:i=!1,errorOnAnachronism:r,matchUpContextIds:n,removePriorValues:a,tournamentRecords:s,checkChronology:o,matchUpDetails:l,schedule:u}=t;if(t.matchUpIds&&!n)return Ab(t);let c=Ge(t,[{[cn]:!0},{[tI]:{matchUpContextIds:!1,matchUpDetails:!1},[Fa]:ie,[zn]:an}]);if(c.error)return c;if((!l||n)&&!u)return{error:Xe,info:"schedule is required"};let d=[],p=0,{matchUpDependencies:f}=oo({tournamentRecords:s});for(let m of Object.values(s)){let{tournamentId:h}=m,g=n?.filter(v=>v.tournamentId===h).map(Ir),I=l?.filter(v=>v?.tournamentId===h);if(g?.length||I?.length){let v=Ab({matchUpDetails:I,scheduleCompletedMatchUps:e,scheduleByeMatchUps:i,matchUpDependencies:f,errorOnAnachronism:r,removePriorValues:a,tournamentRecords:s,tournamentRecord:m,checkChronology:o,matchUpIds:g,schedule:u});if(v.warnings?.length&&d.push(...v.warnings),v.scheduled&&(p+=v.scheduled),v.error)return v}}return d.length?{...H,scheduled:p,warnings:d}:{...H,scheduled:p}}function qPe({schedulingProfileModifications:t,checkPotentialRequestConflicts:e,scheduleCompletedMatchUps:i,schedulingProfileIssues:r,dateSchedulingProfiles:n,containedStructureIds:a,matchUpDependencies:s,matchUpDailyLimits:o,clearScheduleDates:l,tournamentRecords:u,schedulingProfile:c,personRequests:d,periodLength:p,matchUps:f,courts:m,dryRun:h}){let g={},I={},v={},w={},y={},b={},S={},U={},T={},P={};for(let R of n){let C=Qe(R?.scheduleDate),M=R?.venues||[],N={},A={},O=(G,j)=>{G.forEach(K=>{let Y=A[K].counters;Y[j]?Y[j]+=1:Y[j]=1,Y[Ls]?Y[Ls]+=1:Y[Ls]=1})};v[C]={},w[C]={},g[C]={},I[C]={},S[C]=[],U[C]=[],T[C]=[],P[C]=[];let k={};f.forEach(G=>{G.schedule?.scheduledDate&&tu(C,Qe(G.schedule.scheduledDate))&&cI({matchUpPotentialParticipantIds:N,matchUpNotBeforeTimes:k,matchUp:G})});let{allDateScheduledByeMatchUpDetails:F,venueScheduledRoundDetails:x,allDateMatchUpIds:L}=UJ({matchUpPotentialParticipantIds:N,individualParticipantProfiles:A,scheduleCompletedMatchUps:i,containedStructureIds:a,matchUpNotBeforeTimes:k,matchUpScheduleTimes:b,matchUpDependencies:s,clearScheduleDates:l,tournamentRecords:u,useGarman:!0,periodLength:p,scheduleDate:C,matchUps:f,courts:m,venues:M}),$=10,V=0,_,B=10;for(;!_;){for(let{venueId:G}of M){let j=0,K=x[G];for(;K.courtsCount&&K.scheduleTimes?.length&&K.matchUpsToSchedule?.length&&j<=K.courtsCount;){let{scheduleTime:Y,attempts:X=0}=K.scheduleTimes.shift(),Z=K.matchUpsToSchedule.find(J=>{let{matchUpId:ae,matchUpType:te}=J,{participantIdsAtLimit:ne,relevantParticipantIds:le}=$_({matchUpPotentialParticipantIds:N,individualParticipantProfiles:A,matchUpDailyLimits:o,matchUp:J});if(ne.length)return U[C].includes(ae)||U[C].push(ae),!1;let{scheduledDependent:de}=SJ({matchUpScheduleTimes:b,matchUpDependencies:s,scheduleTime:Y,matchUpId:ae,details:K});if(de)return!1;let{dependenciesScheduled:pe,remainingDependencies:ge}=F_({matchUpScheduleTimes:b,matchUpDependencies:s,allDateMatchUpIds:L,matchUp:J});if(!pe)return w[C][ae]||(w[C][ae]=[]),w[C][ae].push({scheduleTime:Y,remainingDependencies:ge}),!1;let{enoughTime:Me}=__({individualParticipantProfiles:A,matchUpNotBeforeTimes:k,matchUpDependencies:s,scheduleTime:Y,details:K,matchUp:J});if(!Me)return v[C][ae]||(v[C][ae]=[]),v[C][ae].push({scheduleTime:Y}),!1;let Pe=K.greatestAverageMinutes,{conflicts:Be}=L_({potentials:e,averageMatchUpMinutes:Pe,requestConflicts:P,personRequests:d,scheduleTime:Y,scheduleDate:C,matchUp:J});if(Be?.length)return y[C]||(y[C]=[]),y[C].push(...Be),!1;O(le,te);let fe=K.minutesMap?.[ae]?.recoveryMinutes;return Nb({matchUpPotentialParticipantIds:N,individualParticipantProfiles:A,matchUpNotBeforeTimes:k,averageMatchUpMinutes:Pe,matchUpDependencies:s,recoveryMinutes:fe,scheduleTime:Y,matchUp:J}),b[ae]=Y,!0});K.matchUpsToSchedule=K.matchUpsToSchedule.filter(({matchUpId:J})=>J!==Z?.matchUpId),Z?j+=1:(I[C][G]||(I[C][G]=[]),I[C][G].push({scheduleTime:Y,attempts:X+1}))}K.matchUpsToSchedule?.length&&(I[C][G]=I[C][G]?.filter(Y=>{let X=Y.attempts<$;return X&&K.scheduleTimes.push(Y),!X})),(!K.scheduleTimes?.length||!K.matchUpsToSchedule?.length)&&(K.complete=!0)}V+=1,_=M.every(({venueId:G})=>x[G].complete)||V===B}for(let{venueId:G}of M){let j=x[G].matchUpMap;Object.keys(j).forEach(K=>{let Y=u[K];Y&&Object.keys(j[K]).forEach(X=>{let{drawDefinition:Z}=Gd({tournamentRecord:Y,drawId:X});Z&&j[K][X].forEach(({matchUpId:J})=>{let ae=b[J];if(ae){let te=ae.split(":").map(rs).join(":"),ne=`${Qe(C)}T${te}`;h?S[C].push(J):(Hd({drawDefinition:Z,scheduledTime:ne,matchUpId:J}).success&&S[C].push(J),G&&Uv({tournamentRecord:Y,drawDefinition:Z,matchUpId:J,venueId:G}))}})})}),T[C]=x[G].matchUpsToSchedule.map(Ir),g[C][G]=x[G].scheduleTimes.sort((K,Y)=>Pt(K.scheduleTime)-Pt(Y.scheduleTime))}!h&&F?.length&&LS({matchUpDetails:F,scheduleByeMatchUps:!0,removePriorValues:!0,tournamentRecords:u,schedule:{scheduledDate:"",scheduledTime:"",courtOrder:"",courtId:"",venueId:""}});for(let G of R.venues)for(let j of G.rounds){let K=(j.matchUps?.map(({matchUpId:X})=>X)||[]).filter(X=>S[C].includes(X));j.canScheduledMatchUpIds=K;let Y=Math.round(K.length/j.matchUpsCount*1e4)/100;(Y===1/0||isNaN(Y))&&(Y=0),j.possibleToSchedulePct=Y,j.matchUpsCount===K.length&&(j.possibleToSchedule=!0)}}let D=n.map(({scheduleDate:R})=>R),E={timeStamp:Date.now(),overLimitMatchUpIds:U,scheduledMatchUpIds:S,schedulingProfile:c,noTimeMatchUpIds:T,requestConflicts:P,scheduledDates:D};return TJ({tournamentRecords:u,autoSchedulingAudit:E}),{...H,schedulingProfileModifications:t,schedulingProfileIssues:r,scheduleTimesRemaining:g,dateSchedulingProfiles:n,skippedScheduleTimes:I,recoveryTimeDeferredMatchUpIds:v,dependencyDeferredMatchUpIds:w,matchUpScheduleTimes:b,overLimitMatchUpIds:U,scheduledMatchUpIds:S,noTimeMatchUpIds:T,requestConflicts:P,scheduledDates:D}}function RW({averageMinutes:t,startTime:e,endTime:i,court:r,date:n}){if(!Array.isArray(r.dateAvailability))return{error:Xe,stack:"getEarliestCourtTime"};let a=dI({scheduleDate:n,courts:[r],startTime:!0}),s=dI({scheduleDate:n,courts:[r],endTime:!0});e=e||a,i=i||s;let o=bd({court:r,date:n}),{timeSlots:l}=wv({courtDate:o}),u=Xi(e),c=Xi(i);return{earliestCourtTime:l?.reduce((d,p)=>{let f=Xi(p.startTime),m=Xi(p.endTime);if(f>c||m<u)return d;let h=u>f?u:f;if(kw(h,m)>=t){let g=ci(h.toISOString());g&&(!d||g<d)&&(d=g)}return d},void 0),courtStartTime:a,courtEndTime:s}}function YPe({schedulingProfileModifications:t,checkPotentialRequestConflicts:e,scheduleCompletedMatchUps:i,schedulingProfileIssues:r,dateSchedulingProfiles:n,containedStructureIds:a,matchUpDependencies:s,matchUpDailyLimits:o,clearScheduleDates:l,tournamentRecords:u,periodLength:c=30,schedulingProfile:d,personRequests:p,matchUps:f=[],courts:m,dryRun:h}){let g={},I={},v={},w={},y={},b={},S={},U={},T={};for(let E of n??[]){let R=Qe(E?.scheduleDate),C=E?.venues||[],M={},N={},A=(Z,J)=>{Z.forEach(ae=>{let te=N[ae].counters;te[J]?te[J]+=1:te[J]=1,te[Ls]?te[Ls]+=1:te[Ls]=1})};g[R]={},I[R]={},b[R]=[],S[R]=[],U[R]=[],T[R]=[];let O={};f?.forEach(Z=>{Z.schedule?.scheduledDate&&tu(R,Qe(Z.schedule.scheduledDate))&&cI({matchUpPotentialParticipantIds:M,matchUpNotBeforeTimes:O,matchUp:Z})});let{allDateScheduledByeMatchUpDetails:k,allDateScheduledMatchUpIds:F,venueScheduledRoundDetails:x,allDateMatchUpIds:L}=UJ({matchUpPotentialParticipantIds:M,individualParticipantProfiles:N,scheduleCompletedMatchUps:i,containedStructureIds:a,matchUpNotBeforeTimes:O,matchUpScheduleTimes:y,matchUpDependencies:s,clearScheduleDates:l,tournamentRecords:u,periodLength:c,scheduleDate:R,matchUps:f,courts:m,venues:C}),$=f?.filter(({matchUpId:Z})=>F.includes(Z)),{bookings:V}=OC({dateScheduledMatchUps:$,tournamentRecords:u,scheduleDate:R,periodLength:c}),{virtualCourts:_}=PC({scheduleDate:R,periodLength:c,bookings:V,courts:m}),B=_?.reduce((Z,J)=>{let{earliestCourtTime:ae,courtEndTime:te}=RW({date:R,averageMinutes:0,court:J});return(!Z.startTime||Xi(ae)<Xi(Z.startTime))&&(Z.startTime=ae),(!Z.endTime||Xi(te)>Xi(Z.endTime))&&(Z.endTime=te),Z},{}),G=B.startTime,j=({courtId:Z,booking:J})=>_?.find(ae=>ae.courtId===Z)?.dateAvailability[0].bookings.push(J),K=10,Y=0,X;for(;!X;){for(let{venueId:Z}of C){let J=x[Z],ae=J.matchUpsToSchedule.length,te=[],ne=[],le,de=0;for(;!le;){for(let pe of J.matchUpsToSchedule){if(ne.length===J.courtsCount||te.length===J.courtsCount){le=!0;break}let{matchUpId:ge,matchUpType:Me}=pe,{participantIdsAtLimit:Pe,relevantParticipantIds:Be}=$_({matchUpPotentialParticipantIds:M,individualParticipantProfiles:N,matchUpDailyLimits:o,matchUp:pe});if(Pe.length){S[R].includes(ge)||S[R].push(ge);continue}let{dependenciesScheduled:fe,remainingDependencies:Te}=F_({matchUpScheduleTimes:y,matchUpDependencies:s,allDateMatchUpIds:L,matchUp:pe});if(!fe){I[R][ge]||(I[R][ge]=[]),I[R][ge].push({remainingDependencies:Te});continue}let ce=[],ye=_?.reduce((be,Fe)=>{if(ne.includes(Fe.courtId))return be;let{earliestCourtTime:we}=RW({averageMinutes:J.greatestAverageMinutes,startTime:G,date:R,court:Fe});if(be.scheduleTime&&Pt(we)>=Pt(be.scheduleTime))return be;let{scheduledDependent:Ne}=SJ({matchUpScheduleTimes:y,matchUpDependencies:s,scheduleTime:we,matchUpId:ge,details:J});if(Ne)return be;let{enoughTime:me}=__({individualParticipantProfiles:N,matchUpNotBeforeTimes:O,matchUpDependencies:s,scheduleTime:we,details:J,matchUp:pe});if(!me)return g[R][ge]||(g[R][ge]=[]),g[R][ge].includes(we)||g[R][ge].push(we),be;let Ee=J.minutesMap?.[ge]?.averageMinutes||J.greatestAverageMinutes,{conflicts:Le}=L_({potentials:e,averageMatchUpMinutes:Ee,requestConflicts:T,personRequests:p,scheduleTime:we,scheduleDate:R,matchUp:pe});if(Le?.length)return ce.push(...Le),!1;A(Be,Me);let Q=J.minutesMap?.[ge]?.recoveryMinutes;return Nb({matchUpPotentialParticipantIds:M,individualParticipantProfiles:N,matchUpNotBeforeTimes:O,averageMatchUpMinutes:Ee,matchUpDependencies:s,recoveryMinutes:Q,scheduleTime:we,matchUp:pe}),(!be.scheduleTime||Pt(we)<Pt(be.scheduleTime))&&(be.averageMatchUpMinutes=Ee,be.recoveryMinutes=Q,be.scheduleTime=we,be.courtName=Fe.courtName,be.courtId=Fe.courtId),be},{});if(ye.scheduleTime){let{averageMatchUpMinutes:be,recoveryMinutes:Fe,scheduleTime:we,courtId:Ne}=ye;y[ge]=we,w[ge]=Ne,te.push(ge),ne.push(Ne);let me=we,Ee=Xn(me,be);j({courtId:Ne,booking:{averageMatchUpMinutes:be,recoveryMinutes:Fe,periodLength:c,matchUpId:ge,startTime:me,courtId:Ne,endTime:Ee,venueId:Z}}),J.matchUpsToSchedule=J.matchUpsToSchedule.filter(Le=>Le.matchUpId!==ge)}else ce?.length&&(v[R]||(v[R]=[]),v[R].push(...ce))}(ne.length===J.courtsCount||te.length===J.courtsCount||!J.matchUpsToSchedule.length)&&(le=!0),J.matchUpsToSchedule.length&&te<J.courtsCount&&(Xi(G)<Xi(B.endTime)?G=Xn(G,c):(le=!0,J.complete=!0)),de+=1,!le&&de>=ae&&(le=!0)}J.matchUpsToSchedule?.length||(J.complete=!0)}Y+=1,X=C.every(({venueId:Z})=>x[Z].complete)||Y===K}for(let{venueId:Z}of C){let J=x[Z].matchUpMap;Object.keys(J).forEach(ae=>{let te=u[ae];te&&Object.keys(J[ae]).forEach(ne=>{let{drawDefinition:le}=Gd({tournamentRecord:te,drawId:ne});le&&J[ae][ne].forEach(({matchUpId:de})=>{let pe=y[de],ge=w[de];if(pe){let Me=pe.split(":").map(rs).join(":"),Pe=`${Qe(R)}T${Me}`;h||(Hd({drawDefinition:le,scheduledTime:Pe,matchUpId:de}),Ph({courtDayDate:R,tournamentRecords:u,tournamentRecord:te,drawDefinition:le,matchUpId:de,courtId:ge})),b[R].push(de)}})})}),U[R]=x[Z].matchUpsToSchedule.map(Ir)}!h&&k?.length&&LS({matchUpDetails:k,scheduleByeMatchUps:!0,removePriorValues:!0,tournamentRecords:u,schedule:{scheduledDate:"",scheduledTime:"",courtOrder:"",courtId:"",venueId:""}});for(let Z of E.venues)for(let J of Z.rounds){let ae=(J.matchUps??[]).map(({matchUpId:ne})=>ne)?.filter(ne=>b[R].includes(ne));J.canScheduledMatchUpIds=ae;let te=Math.round((ae?.length||0)/J.matchUpsCount*1e4)/100;(te===1/0||isNaN(te))&&(te=void 0),J.possibleToSchedulePct=te,J.matchUpsCount===ae?.length&&(J.possibleToSchedule=!0)}}let P=(n??[]).map(({scheduleDate:E})=>E),D={timeStamp:Date.now(),overLimitMatchUpIds:S,scheduledMatchUpIds:b,schedulingProfile:d,noTimeMatchUpIds:U,requestConflicts:T,scheduledDates:P};return TJ({tournamentRecords:u,autoSchedulingAudit:D}),{...H,schedulingProfileModifications:t,schedulingProfileIssues:r,dateSchedulingProfiles:n,recoveryTimeDeferredMatchUpIds:g,dependencyDeferredMatchUpIds:I,matchUpScheduleTimes:y,overLimitMatchUpIds:S,scheduledMatchUpIds:b,noTimeMatchUpIds:U,requestConflicts:T,scheduledDates:P}}function xC(t){let{scheduleAttributes:e=["scheduledDate","scheduledTime","courtOrder"],ignoreMatchUpStatuses:i=Yi,scheduledDates:r,venueIds:n}=t,a=Is(t),s=bt(a)?Object.values(a).map(({tournamentId:l})=>l).filter(Boolean):[];if(!s?.length)return{error:Ci};let o=0;for(let l of s){let u=a[l],c=KPe({ignoreMatchUpStatuses:i,scheduleAttributes:e,tournamentRecord:u,scheduledDates:r,venueIds:n});if(c.error)return c;o+=c.clearedScheduleCount??0}return{...H,clearedScheduleCount:o}}function KPe({scheduleAttributes:t=["scheduledDate","scheduledTime","courtOrder"],ignoreMatchUpStatuses:e=Yi,tournamentRecord:i,scheduledDates:r,venueIds:n=[]}){if(typeof i!="object")return{error:Ie};if(!Array.isArray(e)||!Array.isArray(n))return{error:ie};n.length&&t.push("venueId");let a=br({matchUpFilters:{scheduledDates:r},tournamentRecord:i}).matchUps??[],s={};a.forEach(({matchUpStatus:u,schedule:c,drawId:d,matchUpId:p})=>{(!u||!e.includes(u))&&MS({schedule:c,scheduleAttributes:t})&&(!n?.length||n.includes(c.venueId))&&(s[d]||(s[d]=[]),s[d].push(p))});let o=i.tournamentId,l=0;for(let u in s){let{event:c,drawDefinition:d}=jn({tournamentRecord:i,drawId:u}),p=Rn({drawDefinition:d,matchUpFilters:{matchUpIds:s[u]}}).matchUps??[];for(let f of p){let m=!1;f.timeItems=(f.timeItems??[]).filter(h=>{let g=h?.itemType&&![lu,Id,dh,TR,ph,fh].includes(h?.itemType);return g||(m=!0),g}),m&&(St({context:"clear schedules",eventId:c?.eventId,drawDefinition:d,tournamentId:o,matchUp:f}),l+=1)}}return{...H,clearedScheduleCount:l}}function FC(t){let{checkPotentialRequestConflicts:e=!0,scheduleCompletedMatchUps:i,clearScheduleDates:r,scheduleDates:n=[],tournamentRecords:a,periodLength:s,useGarman:o,dryRun:l,pro:u}=t,c=Ge(t,[{[cn]:!0},{[Wr]:P=>!P||Array.isArray(P)&&P.every(Pn),[E5]:!1,[zn]:an}]);if(c.error)return c;let d=_c({tournamentRecords:a});if(d.error)return d;if(!d.schedulingProfile.length)return{...H};let{modifications:p,issues:f=[],schedulingProfile:m=[]}=d,h=Object.assign({},...Object.values(a).map(P=>av({tournamentRecord:P}).containedStructures)),g=new Set(n.map(P=>{if(Pn(P))return Qe(P)}).filter(Boolean)),I=m.map(P=>P.scheduleDate).map(P=>Pn(P)&&Qe(P)).filter(P=>P&&(!n.length||g.has(P)));if(!I.length)return{error:C6};if(r&&!l){let P=Array.isArray(r)?r:[];xC({tournamentRecords:a,scheduledDates:P})}let v=Cu({ignoreDisabled:!1,tournamentRecords:a}).courts,{matchUps:w}=Eo({matchUpFilters:{matchUpTypes:[Wt,$t]},afterRecoveryTimes:!0,nextMatchUps:!0,tournamentRecords:a}),{matchUpDependencies:y}=oo({includeParticipantDependencies:!0,tournamentRecords:a,matchUps:w}),{matchUpDailyLimits:b}=wC({tournamentRecords:a}),{personRequests:S}=df({requestType:FS,tournamentRecords:a}),U=m.filter(P=>{let D=Qe(P?.scheduleDate);return I.includes(D)}).sort((P,D)=>new Date(P.scheduleDate).getTime()-new Date(D.scheduleDate).getTime()),T={schedulingProfileModifications:p,checkPotentialRequestConflicts:e,scheduleCompletedMatchUps:i,schedulingProfileIssues:f,dateSchedulingProfiles:U,containedStructureIds:h,matchUpDependencies:y,matchUpDailyLimits:b,clearScheduleDates:r,tournamentRecords:a,schedulingProfile:m,personRequests:S,periodLength:s,matchUps:w,dryRun:l,courts:v};return u?YPe(T):qPe(T)}function LC(t){if(!t||typeof t!="string")return!1;try{return Intl.DateTimeFormat(void 0,{timeZone:t}),!0}catch{return!1}}function _O(t,e){let i=e??new Date,r=new Intl.DateTimeFormat("en-US",{timeZone:t,timeZoneName:"longOffset"}).formatToParts(i).find(l=>l.type==="timeZoneName")?.value??"";if(r==="GMT")return 0;let n=r.match(/GMT([+-])(\d{2}):(\d{2})/);if(!n)return 0;let a=n[1]==="+"?1:-1,s=Number.parseInt(n[2],10),o=Number.parseInt(n[3],10);return a*(s*60+o)}function DJ(t,e,i){if(!LC(i))return{error:LE};let[r,n]=e.split(":").map(Number),[a,s,o]=t.split("-").map(Number),l=new Date(Date.UTC(a,s-1,o,r,n,0,0)),u=_O(i,l),c=l.getTime()-u*60*1e3,d=new Date(c),p=_O(i,d);if(p!==u){let f=l.getTime()-p*60*1e3;return new Date(f).toISOString()}return d.toISOString()}function XPe(t,e){if(!LC(e))return{error:LE};let i=new Date(t),r=new Intl.DateTimeFormat("en-CA",{timeZone:e,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!1}).formatToParts(i),n=o=>r.find(l=>l.type===o)?.value??"",a=`${n("year")}-${n("month")}-${n("day")}`,s=`${n("hour")==="24"?"00":n("hour")}:${n("minute")}`;return{date:a,time:s}}function JPe(t,e,i){let r=DJ(t,e,i);return typeof r!="string"||td(r)?r:{error:LE}}var QPe={isValidIANATimeZone:LC,getTimeZoneOffsetMinutes:_O,wallClockToUTC:DJ,utcToWallClock:XPe,toEmbargoUTC:JPe};function _C(t){let{tournamentRecord:e,tournamentRecords:i,activeTournamentId:r,...n}=t||{};return n.tournamentId||(n.tournamentId=Et()),n.startDate&&!ac(n.startDate)&&!MD.test(n.startDate)?{error:sr}:n.endDate&&!ac(n.endDate)&&!MD.test(n.endDate)?{error:sr}:n.localTimeZone&&!LC(n.localTimeZone)?{error:LE}:(n.extensions&&(n.extensions=n.extensions.filter(sl)),{...n})}function B_({addParticipants:t=!0,participantAttribute:e,tournamentRecord:i,personAttribute:r,teamNames:n,accessor:a,uuids:s}){if(!i)return{error:Ie};let o={},l=(i.participants??[]).filter(({participantType:m,participantRole:h})=>m===gt&&h===Kr),u=0;for(let m of l){let h=a&&mp({element:m,accessor:a})?.value||r&&m.person?.[r]||e&&m[e];if(h){if(!Object.keys(o).includes(h)){o[h]={participantName:n?.[u]??h,participantId:s?.pop()??Et(),individualParticipantIds:[],participantRole:Kr,participantType:Lt};let g={value:r??e,name:nO};xt({element:o[h],extension:g}),u+=1}o[h].individualParticipantIds.push(m.participantId)}}let c=Object.keys(o),d=(i.participants??[]).map(m=>{if(m.participantType!==Lt||m.participantRole!==Kr)return;let{extension:h}=mt({name:nO,element:m}),g=h?.value;if(c.includes(g))return m.participantId}).filter(Boolean),p=0,f=[];return Object.keys(o).forEach(m=>{let h=o[m],{participantId:g}=h;d.includes(g)||(i.participants||(i.participants=[]),t&&i.participants.push(h),f.push(h),p++)}),t&&p?(at({payload:{tournamentId:i.tournamentId,participants:f},topic:md}),{...H,participantsAdded:p}):f.length?{...H,newParticipants:f}:{error:$me}}var ZPe=[{AA:"Annexia"},{BA:"Bacteria"},{BO:"Borduria"},{BM:"Bensalem"},{BS:"Basenji"},{BI:"Balnibarbi"},{BV:"Bartovia"},{BZ:"Berzerkistan"},{CA:"Caldonia"},{CC:"Concordia"},{CH:"Chula"},{DA:"Deltora"},{DW:"Discworld"},{EA:"Eastasia"},{EP:"Ecotopia"},{ER:"Erewhon"},{FA:"Freedonia"},{FN:"Florin"},{FG:"Fogg"},{FK:"Fourecks"},{GA:"Genovia"},{GL:"Gilead"},{GD:"Gilead"},{GL:"Gondal"},{GO:"Gondor"},{GR:"Gruzinia"},{GT:"Goritania"},{GU:"Guilder"},{HA:"Heldscalla"},{HO:"Hidalgo"},{IL:"Illyria"},{KA:"Kinakuta"},{KG:"Kangan"},{KN:"Kreplachistan"},{KS:"Kallipolis"},{LH:"Lugash"},{LI:"Listenbourg"},{LT:"Lilliput"},{LU:"Luggnagg"},{LV:"Lichtenslava"},{MR:"Moher"},{NA:"Narnia"},{NV:"Novaria"},{OA:"Oceania"},{OS:"Orsinia"},{OV:"Octavia"},{PA:"Palombia"},{PG:"Penguina"},{QA:"Qasha"},{PM:"Panem"},{SA:"Solymbria"},{SD:"Syldavia"},{SG:"San Glucose"},{SL:"San Lorenzo"},{SR:"Sontar"},{SY:"Sylvania"},{TF:"Tralfamadore"},{TH:"Themyscira"},{UA:"Utopia"},{VA:"Vespugia"},{WA:"Wakanda"},{WX:"Wessex"},{ZA:"Zamunda"},{ZK:"Zubrowka"}],eEe=["Amber","Ansul","Atlantis","Braavos","Busytown","Castle Rock","Centralia","Coober Pedy","Chefchaouen","Chronopolis","Damanhur","Diaspar","Dictionopolis","Diomira","El Dorado","Elista","Ephesus","Gotham","Hadleyburg","Hallstatt","Hierusalem","Ilium","Inverness","Kowloon","Laputa","Longyearbyen","Lys","Matmata","Maycomb","Metropolis","Miyake-jima","Monowi","Nagoro","Navarre","New New York","Nimbin","Pemberley","Pseudopolis","Rivendell","Roswell","Shangri-La","Springfield","Supilinn","Thneedville","Trantor","Wobegon","Yonwood","Xanadu","Xylar","Zion"];function PJ({count:t=1,participantsCount:e=32}={}){let i=Dn(eEe),r=i.slice(0,t);return{cities:Re(0,e).map(n=>n<Math.min(t,i.length)?r[n]:ca(r))}}function EJ({count:t=1,participantsCount:e=32}={}){let i=Dn(ZPe),r=i.slice(0,t).map(n=>Object.keys(n)).flat();return{states:Re(0,e).map(n=>n<Math.min(t,i.length)?r[n]:ca(r))}}function RJ({count:t=1,participantsCount:e=32}={}){let i=Re(0,t).map(()=>Re(0,5).map(()=>ts(0,9)).join(""));return{postalCodes:Re(0,e).map(r=>r<t?i[r]:ca(i))}}function oP({idPrefix:t,participantType:e,index:i,uuids:r}){let n=ri(e)?e[0]:"X";return t?`${t}-${n}-${i}`:r?.pop()||Et()}function CJ(t){let{cities:e,states:i,postalCodes:r,nationalityCode:n,participantIndex:a}=t;return{postalCode:r?.[a],state:i?.[a],city:e?.[a],countryCode:n}}var tEe={lastNames:["Abbey","Ahern","Ampleforth","Ananiadis","Andelic","Assange","Atreides","Austen","Bach","Banks","Barrington","Batty","Bauers","Beals","Beer","Bennett","Berry","Bonaparte","Brewer","Brockovich","Bukowski","Cassidy","Catton","Calvino","Carlin","Carson","Chip","Constant","Crane","Crowne","Cummings","Curie","Dallas","Diamond","Deckard","Drazic","Dunbar","Earhart","Eisenstein","Eldritch","Elliot","Ellul","Escher","Eyre","Faulkner","Fulcher","Fukuoka","Godel","Goldstein","Greer","Hedges","Herbert","Holmgren","Humperdinck","Huxley","Illich","Jeffers","Jensen","Jevons","Johnson","Johnstone","Jovovich","Kingsnorth","Langer","Fernwright","Fuller","Le Guin","Lem","Lovelace","Mander","McLuhan","Midgely","Mond","Montoya","Moore","Murry","Nagle","Nearing","Ogden","Ophuls","Parks","Paz","Peet","Perfect","Pendejo","Pevensie","Postman","Ripley","Rodda","Rumfoord","Runciter","Rugen","Sale","Schumacher","Shaftoe","Shelley","Shepard","Smith","Stratton","Stewart","Swift","Tillich","Turing","Tyrell","Twain","Yeats","Veblen","Yates","Vonnegut","Waterhouse","Watson","Wolin","Wirt","Waschuk","Wormwood","Zecic"],firstFemale:["Ada","Amelia","Amelie","America","Anne","Antonia","Aravis","Astrid","Beatrice","Brienne","Buttercup","Caitlin","Cimorene","Cordelia","Desdemona","Ellen","Elizabeth","Emily","Emmie","Erin","Eva","Evelyn","Heather","Helen","Hermia","Hypatia","Imogen","Jane","Jasmine","Juliana","Juliet","Katniss","Leeloo","Lenina","Lilith","Linda","Lizzie","Louise","Lucy","Marie","Mary","Martha","Matilda","Milla","Miranda","Meg","Melba","Nicole","Ola","Portia","Pris","Rachael","Rachel","Rebecca","River","Rosa","Rosalind","Scout","Sharn","Susanne","Titania","Uhura","Ursula","Valentina","Viola","Virginia","Xena","Zoe"],firstMale:["Alan","Aldous","August","Axel","Barda","Barry","Bill","Bruce","Charles","Chris","Constantine","Darwin","David","Derrick","Edward","Emmanuel","Ernst","Estlin","Fezzik","Filby","Frank","Frito","George","Glen","Helmholtz","Inigo","Italo","Ivan","Jacques","James","Jared","Jerry","Joe","Johann","Julian","John Michael","Jonathan","Korben","Kirkpatrick","Kurt","Lief","Malachi","Mark","Marhsall","Masanobu","Maurits","Michael","Miro","Mustapha","Neil","Nikola","Octavio","Palmer","Paul","Pierre","Robinson","Rick","Rincewind","Roy","Shannon","Sheldon","Stafford","Stanislaw","Stanley","Syme","Thorstein","Thomas","Tyrone","Vizzini","Walton","Walker","Warren","Wendell","Westley","William","Winston","Zoran"]};function xA(t){let{count:e=100,sex:i}=t||{};if(!e||i&&!il(i))return{personData:[],error:ie};let r=Math.ceil(e*1.3),{lastNames:n,firstFemale:a,firstMale:s}=tEe,o=tm.map(({iso:h})=>h).filter(Boolean),l=Math.ceil(r/n.length),u=Math.ceil(r/a.length),c=Math.ceil(r/s.length),d=Re(0,l).flatMap(()=>{let h=ke(n,!1,!0);return Re(0,n.length).map(()=>ma(h))}),p=Re(0,u).flatMap(()=>{let h=ke(a,!1,!0);return Re(0,a.length).map(()=>ma(h))}),f=Re(0,c).flatMap(()=>{let h=ke(s,!1,!0);return Re(0,s.length).map(()=>ma(h))}),m={};for(let h=0;h<r;h++){let g=d.pop(),I=i||ca([er,Hr]),v=I===er?f.pop():p.pop(),w=ca(o);m[`${v}${g}`]={nationalityCode:w,sex:I,firstName:v,lastName:g}}return{personData:Object.values(m).slice(0,e)}}function MJ(t){let e=t?.count||1,{personExtensions:i,consideredDate:r,isMock:n=!0,gendersCount:a,personData:s,category:o,sex:l}=t||{};if(Number.isNaN(Number(e)))return{error:ie};let u=a?.[er]||Wf(l)&&e||0,c=a?.[Hr]||sp(l)&&e||0;e=Math.max(e,u+c);let d=e-(u+c),p=u&&xA({count:u,sex:er}).personData||[],f=c&&xA({count:c,sex:Hr}).personData||[],m=[...p,...f,...d&&xA({count:d}).personData||[]],h=m.filter(T=>!l||u&&c||T.sex===l),g=[];if(Array.isArray(s)){let T=s.filter(P=>typeof P.firstName!="string"||typeof P.lastName!="string"||P.sex&&![er,Hr].includes(P.sex)||P.nationalityCode&&(typeof P.nationalityCode!="string"||P.nationalityCode.length>3||!tm.some(({iso:D,ioc:E})=>[D,E].includes(P.nationalityCode)))?!1:(P.nationalityCode&&g.push(P.nationalityCode),!0));if(T.length)h=T;else return{error:ie}}let I=s?h:Dn(h);if(I.length<e){let{maleFirstNames:T,maleLastNames:P,femaleFirstNames:D,femaleLastNames:E,nationalityCodes:R}=m.reduce((C,M)=>{let{firstName:N,lastName:A,nationalityCode:O}=M;return M.sex===er?(C.maleFirstNames.includes(N)||C.maleFirstNames.push(N),C.maleLastNames.includes(A)||C.maleLastNames.push(A)):(C.femaleFirstNames.includes(N)||C.femaleFirstNames.push(N),C.femaleLastNames.includes(A)||C.femaleLastNames.push(A)),C.nationalityCodes.includes(O)||C.nationalityCodes.push(O),C},{maleFirstNames:[],maleLastNames:[],femaleFirstNames:[],femaleLastNames:[],nationalityCodes:[]});Re(0,e-I.length).forEach(()=>{let C=l||ca([er,Hr]),M=ca(R),N=ca(C===er?T:D),A=ca(C===er?P:E),O={firstName:N,lastName:A,sex:C,nationalityCode:M};I.push(O)})}let{ageMinDate:v,ageMaxDate:w}=Up({consideredDate:r,category:o}),y=Ye(v?.slice(0,4)||0)||Ye(w?.slice(0,4)||0)-3,b=Ye(w?.slice(0,4)||0)||Ye(v?.slice(0,4)||0)+3,S=(v||w)&&[y,b],U=I.slice(0,e).map((T,P)=>{let[D,E]=S||[],R=S&&ma(Re(D,E)),C=ma(Re(0,365)),M=R&&jhe(R,C);return Object.assign(Ve({extensions:i||[{name:"regionCode",value:P+1}],birthDate:M,isMock:n}),T)});return{persons:U.length&&U||I[0],nationalityCodes:g}}var iEe=["Ace Academy","Avengers","Ball Bouncers","Baseliners","Captivators","Civil Disobedients","Continentals","Court Royal","Court Sharks","Diamond Dogs","Danger Zone","Doubles Dominators","Double Faults","Tricksters","Eliminators","Court Crusaders","Fuzz Busters","Game Changers","Goal Gurus","Good Volley","Green Machine","Hawk Eyes","Inside Outers","Killer Instinct","Line Toers","Masters of Mayhem","Matter Catchers","Cheap Shot","Mean Machines","Mindspace Invaders","Net Centric","Net Positive","Smash Mullet","Over Your Head","Spin Meisters","Aggressors","Racket Machine","Slice Happy","Refs Nightmare","Sandeaters","Sun Seekers","Slicer Dicers","Stacked Deck","Cross Stringers","The Emergence","Total Demolition","Touch and Go","Unreturnables","Upside Downers","Vertically Challenged","Visual Spectacle"];function lP({nameRoot:t="TEAM",count:e=1}={}){let i=Dn(iEe).slice(0,e);return i.length<e&&Re(0,e-i.length).forEach(r=>i.push(`${t} ${r+1}`)),{names:i}}function Tv(t){let{scaledParticipantsCount:e,rankingRange:i}=t,{ratingsParameters:r=xr,valuesInstanceLimit:n,ratingsValues:a=[],consideredDate:s,categories:o,category:l,nationalityCodesCount:u,nationalityCodeType:c,nationalityCodes:d,participantsCount:p=32,participantType:f,teamSize:m=8,personIds:h,idPrefix:g,uuids:I,personExtensions:v,addressProps:w,gendersCount:y,matchUpType:b,personData:S,sex:U,inContext:T,withISO2:P,withIOC:D,scaleAllParticipants:E}=t,R=f===pt||b===wp,C=f===Lt||b===Lt;i&&(!Array.isArray(i)||!i.every(fe=>Ni(fe))||i.length!==2)&&(i=void 0),e=E?p:e;let M=1e3,N=e&&e>M?e:M;i=i||[1,N],i[1]+=1;let A=p*(R&&2||C&&(m??8)||1),O=MJ({count:A,personExtensions:v,consideredDate:s,gendersCount:y,personData:S,category:l,sex:U});if(O.error)return O;let{nationalityCodes:k,persons:F}=O,x={},L={},$={},V={},_=fe=>{Object.assign(x,fe.doublesRankings),Object.assign(L,fe.singlesRankings),Object.assign(V,fe.doublesRatings),Object.assign($,fe.singlesRatings)};if(bt(l)){let fe=CW({scaledParticipantsCount:e,ratingsParameters:r,participantType:f,ratingsValues:a,rankingRange:i,category:l});_(fe)}Array.isArray(o)&&o.forEach(fe=>{let Te=CW({scaledParticipantsCount:e,ratingsParameters:r,participantType:f,ratingsValues:a,rankingRange:i,category:fe});_(Te)});let B=tm.filter(fe=>c==="IOC"&&fe.ioc||fe.iso);function G(fe){let Te=Math.ceil(A/fe);return n&&Te>n?Math.ceil(A/n):fe}let{postalCodesProfile:j,postalCodesCount:K,statesProfile:Y,citiesProfile:X,citiesCount:Z,statesCount:J}=w||{},ae=fe=>Object.keys(fe).flatMap(Te=>Re(0,Y[Te]).map(()=>Te)),te=X&&ae(X)||w?.cities||PJ({count:Z||A,participantsCount:A}).cities,ne=Y&&ae(Y)||w?.states||EJ({count:J||A,participantsCount:A}).states,le=j&&ae(j)||w?.postalCodes||RJ({count:K||A,participantsCount:A}).postalCodes,de={cities:te,states:ne,postalCodes:le},pe=G(u),ge=pe?Dn(B).slice(0,u):d&&B.filter(fe=>d.includes(fe.iso))||B,Me=Dn(Re(0,Math.ceil(A/(pe||1))).map(()=>ge).flat(1/0)),Pe=lP({count:p}).names;return{participants:Re(0,p).flatMap(fe=>{let Te=R&&2||C&&(m??8)||1,ce=Re(0,Te).map(Ne=>{let me=fe*Te+Ne;return Be(me)}),ye=ce.map(Ne=>Ne.participantId),be=ce.map(Ne=>Ne.person.standardFamilyName).join("/"),Fe=R?pt:Lt,we={participantId:oP({participantType:Fe,index:fe,idPrefix:g,uuids:I}),participantName:R?be:Pe[fe],participantRole:Kr,individualParticipantIds:ye,participantType:Fe};return T&&(we.individualParticipants=ce),R||C?[we,...ce]:ce}),...H};function Be(fe){let Te=F[fe],{nationalityCode:ce,participantExtensions:ye,participantTimeItems:be,extensions:Fe,firstName:we,birthDate:Ne,lastName:me,personId:Ee,sex:Le}=Te||{},Q=we||"GivenName",se=me||"FamilyName",oe=`${Q} ${se}`,ue=Me[fe],ee=k?.length&&ce||ue&&(c==="IOC"?ue.ioc||ue.iso:ue.iso||ue.ioc)||ce;Me?.length&&!ee&&!ce&&console.log("%c Invalid Nationality Code",{participantIndex:fe,country:ue});let Se=CJ({...de,participantIndex:fe,nationalityCode:ee}),De=Ve({participantId:oP({participantType:gt,index:fe,idPrefix:g,uuids:I}),extensions:ye,timeItems:be,participantRole:Kr,participantType:gt,participantName:oe,person:{personId:Ee||h?.length&&h[fe]||Et(),birthDate:Pn(Ne)?Ne:void 0,addresses:[Se],standardFamilyName:se,standardGivenName:Q,nationalityCode:ee,extensions:Fe,sex:Le}});if(D&&ee){let Ue=tm.find(({iso:ut})=>ut===ee);Ue?.ioc&&(De.person.iocNationalityCode=Ue.ioc),Ue?.label&&(De.person.countryName=Ue.label)}if(P&&ee){let Ue=tm.find(({iso:ut})=>ut===ee);Ue?.iso2&&(De.person.iso2NationalityCode=Ue.iso2),Ue?.label&&(De.person.countryName=Ue.label)}let it=Ue=>{let ut=Ue.categoryName||Ue.ratingType||Ue.ageCategoryCode,yi=L[ut]?.[fe],qe=x[ut]?.[fe];wT({scaleValue:yi,eventType:Dm,scaleType:ou,participant:De,category:Ue}),wT({scaleValue:qe,eventType:oc,scaleType:ou,participant:De,category:Ue});let bi=$[ut]?.[fe],oi=V[ut]?.[fe];wT({scaleValue:bi,eventType:Dm,scaleType:sd,participant:De,category:Ue}),wT({scaleValue:oi,eventType:oc,scaleType:sd,participant:De,category:Ue})};return Array.isArray(o)?o.forEach(Ue=>it(Ue)):l&&it(l),De}}function wT({scaleValue:t,participant:e,eventType:i,scaleType:r,category:n}){let a=n.categoryName||n.ratingType||n.ageCategoryCode,s=[pd,r,i,a].join("."),o={itemValue:t,itemType:s};a&&t&&(e.timeItems||(e.timeItems=[]),e.timeItems.push(o))}function CW(t){let{category:e,scaledParticipantsCount:i,ratingsParameters:r,participantType:n,ratingsValues:a=[]}=t,s=e.rankingRange||t.rankingRange||[1,1e3],o={},l={},u={},c={},{categoryName:d,ageCategoryCode:p,ratingType:f}=e,m=e.categoryName||e.ratingType||e.ageCategoryCode;if((d||p)&&!f){let[h,g]=s||[];if(l[m]=Dn(Re(h,g)).slice(0,i||ts(20,30)),[pt,Lt].includes(n)){let[I,v]=s||[];o[m]=Dn(Re(I,v)).slice(0,i||ts(20,30))}}if(f&&r[f]){let{ratingMax:h,ratingMin:g,ratingAttributes:I}=e,v={...r[f],...I||{}},{attributes:w={},decimalsCount:y,accessors:b,range:S,step:U}=v,T=C=>{let M={},N=Object.keys(C||{});for(let A of N){let O=C[A];if(typeof O=="object"&&O.generator){let{range:k}=O,[F,x]=k.slice().sort();M[A]=ts(F,x)}else M[A]=O}return M},P=S[0]>S[1]?2:.7,[D,E]=S.slice().sort(),R=Re(0,2e3).map(()=>HY(D,E,P,U,y)).filter(C=>(!h||C<=h)&&(!g||C>=g)).slice(0,i||ts(20,30)).map(C=>b?Object.assign({},...b.map(M=>({[M]:C})),T(w)):C);u[m]=[...a,...R],[pt,Lt].includes(n)&&(c[m]=[...a,...R])}return{singlesRankings:l,doublesRankings:o,singlesRatings:u,doublesRatings:c}}function V_(t){let{alternatesCount:e=0,tieFormatName:i,drawSize:r}=t,n=0,a=0,s=0,o=0,l={},u={[er]:0,[Hr]:0,[ah]:0,[Vu]:0,ANY:0};(bt(t.tieFormat)?t.tieFormat:sc({namedFormat:i}))?.collectionDefinitions?.filter(Boolean).forEach(f=>{let{category:m,collectionId:h,matchUpType:g,matchUpCount:I,gender:v}=f;if(il(v)){let w=on(v),y=I*(g===$t?2:1);w&&u[w]<y&&(u[w]=y)}else Na(v)&&(u[er]<I&&(u[er]=I),u[Hr]<I&&(u[Hr]=I));if(m){let w=JSON.stringify(m);l[w]=m}if(h||(f.collectionId=Et()),Di($t)(g)){let w=I;o+=I,n=Math.max(n,w)}if(Di(Wt)(g)){let w=I;s+=I,a=Math.max(a,w)}});let c=Object.keys(l).length?Math.max(s,o*2):Math.max(a,n*2),d=n*(r+e),p=a*(r+e);return{maxDoublesDraw:d,maxSinglesDraw:p,teamSize:c,genders:u}}function rEe({participantsProfile:t,eventProfiles:e,drawProfiles:i}){let{participantsCount:r,participantType:n=gt}=t||{},a=r||0,s={[Hr]:0,[ah]:0,[Vu]:0,[er]:0,ANY:0},o=0,l=0,u=0,c=0,d=0,p=({alternatesCount:m=0,uniqueParticipants:h,tieFormatName:g,drawSize:I=0,eventType:v,tieFormat:w,category:y,gender:b,stage:S})=>{let U=v===ls,T=v===rr,P=!!(h||S===We||y||b);if(T){c=Math.max(c,I+m),w=typeof w=="object"?w:sc({namedFormat:g});let{teamSize:D,maxDoublesDraw:E,maxSinglesDraw:R,genders:C}=V_({alternatesCount:m,tieFormatName:g,tieFormat:w,drawSize:I});u=Math.max(u,D),l=Math.max(l,R),P||(o=Math.max(o,E)),Object.keys(C).forEach(M=>s[M]+=C[M])}else if(U)if(P){let D=(I+m)*2;d+=D,b&&(s[b]+=D)}else I+m&&I+m>o&&(o=I+m);else if(P){let D=I+m;b&&(s[b]+=D),d+=D}else I&&I>l&&(l=I+m)};if(e?.forEach(m=>{let{tieFormatName:h,tieFormat:g,drawProfiles:I,eventType:v,category:w,gender:y}=m;if(I)for(let b of I){let{tieFormatName:S,tieFormat:U}=b;p({...b,tieFormatName:S||h,tieFormat:U||g,eventType:v,category:w,gender:y})}}),Array.isArray(i))for(let m of i)p(m);let f=Math.max(c*u,o*2,l);return o&&(n=pt),(r||a)<f&&(r=f),r&&o&&[pt,rr].includes(n)&&(l&&Math.floor(l/2)>o?r=Math.floor(l/2):(!l||o*2>=l)&&(r=Math.ceil(r/2))),r===void 0&&(r=!e?.length&&!i?.length?32:0),r<a&&(r=a),{uniqueParticipantsCount:d,participantsCount:r,largestTeamDraw:c,largestTeamSize:u,participantType:n,gendersCount:s}}function NJ({participantsProfile:t,tournamentRecord:e,eventProfiles:i,drawProfiles:r,startDate:n,uuids:a}){if(t?.participantsCount===0)return{addedCount:0,...H};let{participantsCount:s,participantType:o,largestTeamDraw:l,largestTeamSize:u,gendersCount:c}=rEe({participantsProfile:t,eventProfiles:i,drawProfiles:r}),d=t?.teamKey,p=Tv({consideredDate:n,...t,participantsCount:s,participantType:o,gendersCount:c,uuids:a}).participants,f=0,m=Zs({tournamentRecord:e,participants:p});if(m.error)return m;if(f+=m.addedCount,d){let v=B_({tournamentRecord:e,...d});if(v.error)return v}let h=p.filter(({participantType:v})=>v===gt).map(vt),g=t?.idPrefix?`${Lt}-${t.idPrefix}`:void 0,I=Re(0,l).map(v=>{let w=h.slice(v*u,(v+1)*u),y=oP({index:v,participantType:o,idPrefix:g,uuids:a});return{participantName:`Team ${v+1}`,participantRole:Kr,individualParticipantIds:w,participantType:Lt,participantId:y}});return m=Zs({participants:I,tournamentRecord:e}),m.error?m:(f+=m.addedCount,{addedCount:f,...H})}function AJ({drawProfiles:t,category:e,gender:i}){let r={},n=t?.reduce((s,o)=>{let{qualifyingPositions:l=0,participantsCount:u=0,uniqueParticipants:c,stage:d=xe,drawSize:p=0}=o||{};Object.keys(s).includes(d)||(s[d]=0);let f=(u||p)-l;return c||i||e||d===We?(Object.keys(r).includes(d)||(r[d]=0),r[d]+=f):s[d]=Math.max(s[d],f),s},{}),a=Object.keys(r);return a.forEach(s=>n[s]+=r[s]),{stageParticipantsCount:n,uniqueParticipantsCount:r,uniqueParticipantStages:a}}function kJ({allUniqueParticipantIds:t,stageParticipantsCount:e,eventParticipantType:i,targetParticipants:r}){let n=e[xe]||0,a=e[We]||0;return{stageParticipants:{QUALIFYING:r?.filter(({participantType:s})=>s===i).filter(({participantId:s})=>!t.includes(s)).slice(0,a),MAIN:r?.filter(({participantType:s})=>s===i).filter(({participantId:s})=>!t.includes(s)).slice(a,a+n)}}}var nEe={[mi]:2,[wi]:1,[Hi]:1,[$r]:1,[Qt]:4};function j_(t){let{defaultWithScorePercent:e=2,winningSide:i}=t,{matchUpStatusProfile:r=nEe,matchUpFormat:n=Xu,pointsPerMinute:a=1,sideWeight:s=4}=t;if(!xa({matchUpFormat:n}))return{error:w6};if(typeof r!="object")return{error:ie};if(e>100&&(e=100),Number.isNaN(Number(e))||Number.isNaN(Number(a))||Number.isNaN(Number(s)))return{error:ie};let o=Object.keys(r).filter(D=>Object.keys(J5).includes(D)&&D!==ki);if(Object.keys(o).reduce((D,E)=>D+r[E],0)>100)return{error:ie,matchUpStatusProfile:r};let l=o.reduce((D,E)=>(D.pointer=D.pointer+r[E],D.valueMap.push([D.pointer,E]),D),{pointer:0,valueMap:[]}),u=ts(1,100),c=(l.valueMap.find(D=>u<=D[0])??[100,ki])[1],d={sets:[],scoreStringSide1:"",side2ScoreString:""};if(Fr(c)){i=i||ts(1,2);let D={score:d,matchUpStatus:c,winningSide:i};if(!(c===Qt&&ts(1,100)>100-e))return{outcome:D}}else if([wi,Hi].includes(c))return{outcome:{score:d,matchUpStatus:c}};let p=zi(n),{bestOf:f=1,exactly:m,setFormat:h,finalSetFormat:g}=p??{},I=[],v=ts(0,1),w=i?[i-1]:[...Re(0,s).map(()=>v),1-v],y=[$r,Qt,cs,_d].includes(c)&&(ma(Re(1,m||f))||1),b,S=Re(1,(m??f)+1);for(let D of S){let E=D===(m??f),{set:R,incomplete:C,winningSideNumber:M}=aEe({setFormat:E&&g||h,incomplete:y===D,pointsPerMinute:a,matchUpStatus:c,weightedRange:w,setNumber:D});if(I.push(R),C){b=M;break}if(Mb({matchUp:{score:{sets:I},matchUpFormat:n}}).calculatedWinningSide)break}let U=Mb({matchUp:{score:{sets:I},matchUpFormat:n,winningSide:i}}),T=b?i||b:U.calculatedWinningSide,{score:P}=hJ({winningSide:T,score:{sets:I},matchUpStatus:c});return{outcome:{winningSide:T,matchUpStatus:c,score:P}}}function aEe({weightedRange:t=[0,1],pointsPerMinute:e,matchUpStatus:i,incomplete:r,setFormat:n,setNumber:a}){let s={setNumber:a},{setTo:o,tiebreakFormat:l,tiebreakAt:u,tiebreakSet:c,timed:d,minutes:p}=n,f=ts(0,t.length-1),m=t[f],h;if(d){let g=p*e,I=Math.round(g*.2),v=g+ma([1,-1])*I,w=Ime(v,2),y=[w,v-w];m&&y.reverse(),h=t[f]+1;let b=y[0]>y[1]&&1||y[1]>y[0]&&2||0;if(r){let[T,P]=y;return Object.assign(s,{side1Score:T,side2Score:P}),Yi.includes(i)?{set:s,incomplete:r,winningSideNumber:h}:{set:s,incomplete:r}}b||(y[ts(0,1)]+=1),b=y[0]>y[1]?1:2,b!==h&&y.reverse();let[S,U]=y;return Object.assign(s,{side1Score:S,side2Score:U,winningSide:h}),{set:s}}else{if(r)return s.side1Score=ts(0,u),s.side2Score=ts(0,u),Yi.includes(i)&&(h=t[f]+1),{set:s,incomplete:r,winningSideNumber:h};{let g=Re(1,o+1).flatMap(U=>Re(0,o+2-U).map(()=>U)),I=g[ts(0,g.length-1)],v=o&&P0({isSide1:!0,tiebreakAt:u,lowValue:I,setTo:o}),w=!v,y=t.length===1&&t[f]+1;if(!w){y?(v[0]>v[1]?1:2)!==y&&v.reverse():m&&v.reverse();let[U,T]=v;Object.assign(s,{side1Score:U,side2Score:T})}let b=Rb({matchUpScoringFormat:{setFormat:n},setObject:s}),S;if(b.hasTiebreakCondition||w){let{NoAD:U,tiebreakTo:T}=l||c||{},P=Re(1,T+1).flatMap(R=>Re(0,T+2-R).map(()=>R)),D=P[ts(0,P.length-1)],E=sC({isSide1:!0,tiebreakNoAd:U,tiebreakTo:T,lowValue:D});if(E)if(w){let R=E[0]>E[1]?1:2;y?R!==y&&E.reverse():m&&E.reverse(),[s.side1TiebreakScore,s.side2TiebreakScore]=E,S=E[0]>E[1]&&1||E[1]>E[0]&&2||void 0}else b.leadingSide===2?[s.side1TiebreakScore,s.side2TiebreakScore]=E:[s.side2TiebreakScore,s.side1TiebreakScore]=E}s.winningSide=b.winningSide||b.leadingSide||y||S}}return{set:s}}function sEe({firstRoundDualMatchUps:t,event:e,tournamentRecord:i,drawDefinition:r}){let n=e?.category?.ageCategoryCode||e?.category?.categoryName;if(n){let d=WX({singlesOnly:!0,tournamentRecord:i,drawDefinition:r,scaleAccessor:{scaleName:n,sortOrder:"ASC",scaleType:ou},event:e});if(d.error)return d;let{lineUps:p,participantsToAdd:f}=d;Zs({tournamentRecord:i,participants:f}),xt({element:r,extension:{name:uc,value:p}});return}let a=t[0]?.structureId,{positionAssignments:s}=Yt({drawDefinition:r,structureId:a});if(!s?.length)return;let{participants:o}=Ei({participantFilters:{participantTypes:[Zt]},tournamentRecord:i});function l(d){return o?.find(p=>{let{participantId:f}=p;return s.find(m=>m.participantId===f)?.drawPosition===d})}function u(d,p,f){d.sides.forEach(m=>{let{drawPosition:h}=m,g=l(h);if(g){let I=g.individualParticipantIds?.[p];I&&sP({teamParticipantId:g.participantId,participantId:I,tournamentRecord:i,drawDefinition:r,tieMatchUpId:f,event:e});return}})}function c(d,p,f){d.sides.forEach(m=>{let{drawPosition:h}=m,g=l(h);g&&g.individualParticipantIds?.slice(p*2,p*2+2)?.forEach(I=>{sP({teamParticipantId:g.participantId,participantId:I,tournamentRecord:i,drawDefinition:r,tieMatchUpId:f,event:e})})})}t.forEach(d=>{let p=d.tieMatchUps.filter(Di(Wt)),f=d.tieMatchUps.filter(Di($t));p.forEach((m,h)=>{let g=m.matchUpId;u(m,h,g)}),f.forEach((m,h)=>{let g=m.matchUpId;c(m,h,g)})})}function oEe({structure:t,matchUpsMap:e,drawDefinition:i,tournamentRecord:r,event:n,matchUpStatusProfile:a,matchUpFormat:s,matchUpStatus:o,scoreString:l,randomWinningSide:u,completionGoal:c,completedCount:d}){let p=Nt({contextFilters:{matchUpTypes:[$t,Wt]},afterRecoveryTimes:!1,tournamentRecord:r,inContext:!0,drawDefinition:i,matchUpsMap:e,structure:t,event:n}).matchUps.filter(({winningSide:f})=>!f).sort(hh).map(Ir);for(let f of p){if(!Number.isNaN(Number(c))&&d.value>=c)break;let{matchUps:m}=Nt({matchUpFilters:{matchUpTypes:[$t,Wt]},afterRecoveryTimes:!1,tournamentRecord:r,inContext:!0,drawDefinition:i,matchUpsMap:e,structure:t,event:n}),h=m.find(I=>I.matchUpId===f),g=[wi,Hi].includes(h.matchUpStatus);if(h?.readyToScore&&!g){let I=lEe({matchUpStatusProfile:a,tournamentRecord:r,drawDefinition:i,targetMatchUp:h,matchUpFormat:s,matchUpStatus:o,scoreString:l,winningSide:!u&&1,event:n});if(I?.error)return I;d.value+=1}}}function uP(t){let{matchUpStatusProfile:e,completeAllMatchUps:i,randomWinningSide:r,tournamentRecord:n,completionGoal:a,drawDefinition:s,event:o}=t;if(!s)return{error:_e};let l=t.matchUpFormat||s.matchUpFormat||o?.matchUpFormat,u=s.structures.slice().sort(uh),c={value:0},{matchUps:d,matchUpsMap:p}=Qi({matchUpFilters:{matchUpTypes:[Zt],roundNumbers:[1]},contextFilters:{stages:[xe,We]},inContext:!0,drawDefinition:s});if(d?.length){let I=sEe({firstRoundDualMatchUps:d,event:o,tournamentRecord:n,drawDefinition:s});if(I?.error)return I}let f=typeof i=="string"&&i,m=f&&ki,h=u.length===2&&u[0].finishingPosition===Pp&&xi(u.map(({stage:I})=>I),[xe,Ui]).length===2,g=u.map(({structureId:I})=>I);for(let I of g){if(c.value>=a)break;let v=s.structures.find(y=>y.structureId===I),w=oEe({structure:v,matchUpsMap:p,drawDefinition:s,tournamentRecord:n,event:o,matchUpStatusProfile:e,matchUpFormat:l,matchUpStatus:m,scoreString:f,randomWinningSide:r,completionGoal:a,completedCount:c});if(w?.error)return w;h&&v.finishingPosition===Pp&&t.completeRoundRobinPlayoffs&&pv({structureId:v.structureId,applyPositioning:!0,drawDefinition:s})}return{...H,completedCount:c.value}}function OJ(t){let{matchUpStatusCodes:e,policyDefinitions:i,tournamentRecord:r,drawDefinition:n,targetMatchUp:a,matchUpStatus:s,matchUpFormat:o,scoreString:l,winningSide:u,event:c}=t;if(!a||a.matchUpStatus==="BYE")return;let{matchUpId:d}=a||{},{outcome:p}=x_({matchUpFormat:o,matchUpStatus:s,scoreString:l,winningSide:u});return e&&(p.matchUpStatusCodes=e),OS({tournamentRecord:r,policyDefinitions:i,drawDefinition:n,matchUpFormat:o,matchUpId:d,outcome:p,event:c})}function lEe(t){let{matchUpStatusProfile:e={},tournamentRecord:i,policyDefinitions:r,drawDefinition:n,matchUpStatus:a,matchUpFormat:s,targetMatchUp:o,scoreString:l,winningSide:u,event:c}=t;if(l||a)return OJ(t);let{matchUpId:d}=o||{},{outcome:p}=j_({matchUpStatusProfile:e,matchUpFormat:s,winningSide:u});return OS({policyDefinitions:r,tournamentRecord:i,drawDefinition:n,matchUpFormat:s,matchUpId:d,outcome:p,event:c})}function xJ({matchUpStatusProfile:t,completeAllMatchUps:e,randomWinningSide:i,tournamentRecord:r,drawProfiles:n,isMock:a,event:s}){let o=$i({event:s}).flightProfile,{eventName:l,eventType:u,category:c}=s,{startDate:d}=r,p=[],f=c?.categoryName||c?.ageCategoryCode||c?.ratingType,m=s.drawDefinitions?.map(({drawId:h})=>h);if(Array.isArray(o?.flights))for(let[h,g]of o.flights.entries()){let{drawId:I,stage:v,drawName:w,drawEntries:y}=g;p.push(g.drawId);let b=n[h],{seedsCount:S,generate:U=!0}=b||{};if(U){let T=y.filter(ba(su)).map(ba(su)),P=f||l;if(r&&S&&S<=T.length&&Re(1,S+1).forEach((M,N)=>{let A={scaleValue:M,scaleName:P,scaleType:jl,eventType:u,scaleDate:d},O=T[N];mv({tournamentRecord:r,participantId:O,scaleItem:A})}),m?.includes(I))break;let D=AS({...b,matchUpType:u,seedingScaleName:P,tournamentRecord:r,drawEntries:y,drawName:w,drawId:I,isMock:a,event:s,stage:v});if(D.error)return{error:D.error,drawIds:[]};let{drawDefinition:E}=D;if(!E)return{error:Oa};let R=n[h]?.drawExtensions;if(Array.isArray(R)&&R.filter(sl).forEach(M=>xt({element:E,extension:M})),D=kS({suppressNotifications:!0,tournamentRecord:r,drawDefinition:E,event:s}),D.error)return{error:D.error,drawIds:[]};if(b?.withPlayoffs){let M=E.structures?.[0].structureId,N=GR({idPrefix:b.idPrefix,...b.withPlayoffs,tournamentRecord:r,drawDefinition:E,structureId:M,isMock:a,event:s});if(N?.error)return N}let C=b?.completionGoal;if(b?.automated!==!1&&(e||C)){let M=b?.matchUpFormat,N=uP({completeAllMatchUps:!C&&e,matchUpStatusProfile:t,randomWinningSide:i,tournamentRecord:r,completionGoal:C,drawDefinition:E,matchUpFormat:M,event:s});if(N.error)return{error:N.error,drawIds:[]};let A=N.completedCount;if(b?.drawType===au){let O=E.structures?.find(x=>x.stage===xe);if(!O)return{error:Ii};let k=pv({structureId:O.structureId,tournamentRecord:r,drawDefinition:E});if(k.error)return{error:k.error,drawIds:[]};let F=C?C-(A??0):void 0;if(k=uP({completeAllMatchUps:!C&&e,completionGoal:C?F:void 0,matchUpStatusProfile:t,randomWinningSide:i,tournamentRecord:r,drawDefinition:E,matchUpFormat:M,event:s}),k.error)return{error:k.error,drawIds:[]}}}}}return{...H,drawIds:p}}function FJ(t){let{participantsProfile:e={},uniqueParticipantsCount:i,ratingsParameters:r,tournamentRecord:n,eventProfile:a,eventIndex:s,event:o,uuids:l}=t,{category:u,gender:c,eventType:d}=o,p=Di(nl)(d)&&gt||Di(ls)(d)&&pt||d,f=i[xe]||0,m=i[We]||0,h=a.drawProfiles?.length?f+m:a.participantsProfile?.participantsCount??0,g=il(c)?c:void 0,I=e?.idPrefix?`E-${s}-${e?.idPrefix}`:void 0,{participants:v}=Tv({uuids:a.uuids||l,...e,scaledParticipantsCount:a.scaledParticipantsCount,consideredDate:n?.startDate,rankingRange:a.rankingRange,participantType:p,participantsCount:h,ratingsParameters:r,category:u,idPrefix:I,sex:g}),w=Zs({tournamentRecord:n,participants:v});if(w.error)return w;let y=v?.filter(({participantType:S})=>S===p),b=v?.map(vt);return{uniqueDrawParticipants:y,uniqueParticipantIds:b}}function uEe({autoEntryPositions:t,tournamentRecord:e,drawParticipants:i,drawProfile:r,event:n}){let{drawType:a=Yo,qualifyingPositions:s=0,stage:o=xe,drawSize:l=0,drawName:u,drawId:c}=r,d=l-s,p=i.slice(0,d).map(vt);if(p.length){let h=Ko({participantIds:p,autoEntryPositions:t,entryStage:o,tournamentRecord:e,event:n});if(h.error)return h}let f=p.map(h=>({entryStatus:na,entryStage:o,participantId:h})),m=DC({drawName:u||a,qualifyingPositions:s,drawEntries:f,drawId:c,event:n,stage:o});return m.error?m:{...H}}function LJ({uniqueDrawParticipants:t,autoEntryPositions:e,stageParticipants:i,tournamentRecord:r,drawProfiles:n,category:a,gender:s,event:o}){let l=0;for(let u of n){let{qualifyingPositions:c=0,uniqueParticipants:d,stage:p=xe,drawSize:f=0}=u,m=f-c,h=d||s||a||p===We,g=h?t.slice(l,l+m):i[p||xe]||[];h&&(l+=m);let I=uEe({autoEntryPositions:e,drawParticipants:g,tournamentRecord:r,drawProfile:u,event:o});if(I.error)return I}return{...H}}function _J(t){let{allUniqueParticipantIds:e,matchUpStatusProfile:i,participantsProfile:r,completeAllMatchUps:n,autoEntryPositions:a,hydrateCollections:s,randomWinningSide:o,ratingsParameters:l,tournamentRecord:u,eventProfile:c,eventIndex:d,publish:p,isMock:f,uuids:m}=t,h=c.gender,g=c.eventName,{eventType:I=nl,policyDefinitions:v,drawProfiles:w=[],eventExtensions:y,surfaceCategory:b,tieFormatName:S,processCodes:U,discipline:T,eventLevel:P,timeItems:D,ballType:E,category:R}=c,C=c.eventId||Et(),M=c.tieFormat||(I===rr?sc({namedFormat:S,event:{eventId:C,category:R,gender:h},hydrateCollections:s,isMock:f}):void 0),N=u.participants;for(let Y of w)!h&&Y.gender&&(h=Y?.gender);let{stageParticipantsCount:A,uniqueParticipantsCount:O,uniqueParticipantStages:k}=AJ({drawProfiles:w,category:R,gender:h}),F=Di(nl)(I)&&gt||Di(ls)(I)&&pt||I,{uniqueDrawParticipants:x=[],uniqueParticipantIds:L=[]}=k?FJ({event:{eventType:I,category:R,gender:h},uniqueParticipantsCount:O,participantsProfile:r,ratingsParameters:l,tournamentRecord:u,eventProfile:c,eventIndex:d,uuids:m}):{},{eventAttributes:$}=c;typeof $!="object"&&($={});let V=R?.categoryName||R?.ageCategoryCode||R?.ratingType;g=g||V||"Generated Event";let _={...$,surfaceCategory:b,processCodes:U,discipline:T,eventLevel:P,eventName:g,eventType:I,tieFormat:M,ballType:E,category:R,eventId:C,gender:h};if(y?.length&&Array.isArray(y)){let Y=y.filter(sl);Y?.length&&Object.assign(_,{extensions:Y})}if(Array.isArray(D)&&D.forEach(Y=>Sh({event:j,timeItem:Y})),typeof v=="object")for(let Y of Object.keys(v))Ap({policyDefinitions:{[Y]:v[Y]},event:_});_.category&&(_.category.categoryName=V);let B,G=vv({suppressNotifications:!1,internalUse:!0,tournamentRecord:u,event:_});if(G.error)return G;let j=G?.event,{stageParticipants:K}=kJ({allUniqueParticipantIds:e,stageParticipantsCount:A,eventParticipantType:F,targetParticipants:N});if(w?.length){let Y=LJ({uniqueDrawParticipants:x,autoEntryPositions:a,stageParticipants:K,tournamentRecord:u,drawProfiles:w,category:R,gender:h,event:j});if(Y.error)return Y;let X=xJ({matchUpStatusProfile:i,completeAllMatchUps:n,randomWinningSide:o,tournamentRecord:u,drawProfiles:w,isMock:f,event:j});if(X.error)return X;B=X.drawIds}else if(c?.participantsProfile?.participantsCount){let Y=x.map(vt);if(Y.length){let X=Ko({participantIds:Y,autoEntryPositions:a,tournamentRecord:u,entryStage:xe,event:j});if(X.error)return X}}return p&&bv({tournamentRecord:u,event:j}),{drawIds:B,eventId:C,uniqueParticipantIds:L}}function G_({tournamentRecords:t,scheduleDate:e,venueId:i,round:r}){if(!Pn(e))return{error:sr};let n="addSchedulingProfileRound",{extension:a}=mt({name:Cm,tournamentRecords:t,discover:!0}),s=a?.value||[],o=s.find(p=>tu(e,p.scheduleDate));if(!o){let{startDate:p,endDate:f}=cC({tournamentRecords:t}),m=new Date(e);if(p&&m<new Date(p)||f&&m>new Date(f))return{error:sr};o={scheduleDate:e,venues:[]},s.push(o)}let l=o.venues.find(p=>p.venueId===i);l||(l={venueId:i,rounds:[]},o.venues.push(l));let u=["notBeforeTime"],c=p=>Object.keys(p).filter(f=>!u.includes(f)).sort().map(f=>bt(p[f])?c(p[f]):p[f]).flat().join("|");if(l.rounds.find(p=>c(p)===c(r)))return z({result:{error:p6},stack:n});l.rounds.push(r);let d=gv({tournamentRecords:t,schedulingProfile:s});return d.error?d:{...H}}function cEe({schedulingProfile:t,tournamentRecord:e}){if(typeof t!="object")return{error:ie};let i=av({tournamentRecord:e}).containedStructures,r=br({tournamentRecord:e}).matchUps??[],{tournamentId:n}=e,a=[];for(let s of t){let{scheduleDate:o,venues:l=[]}=s;for(let u of l){let{rounds:c,venueId:d}=u;for(let p of c){let{drawId:f,winnerFinishingPositionRange:m,roundSegment:h}=p,g=r.filter(I=>{let v=m?.indexOf("-")>0&&m.split("-").map(y=>+y),w=I.finishingPositionRange?.winner;return I.drawId===f&&(!p.roundNumber||I.roundNumber===p.roundNumber)&&(!w||!v||xi(w,v).length===2||rt(w).length===rt(v).length&&xi(w,v).length===rt(w).length)})[0];if(g){let{eventId:I,roundNumber:v,drawName:w,structureName:y,roundName:b}=g,S=g.structureId;v&&!m&&(S=Object.keys(i).find(P=>i[P].includes(S))??S);let U={tournamentId:n,structureId:S,roundNumber:v,roundSegment:h,eventId:I,drawId:f},T=G_({tournamentRecords:{[n]:e},round:U,scheduleDate:o,venueId:d});if(T.error)return T;a.push({structureName:y,roundName:b,drawName:w,...U})}}}}return{scheduledRounds:a}}function $C(t){let e=Ge(t,[{drawProfile:!0,_ofType:Yn}]);if(e.error)return e;let{allUniqueParticipantIds:i=[],participantsProfile:r={},matchUpStatusProfile:n,completeAllMatchUps:a,autoEntryPositions:s,hydrateCollections:o,randomWinningSide:l,ratingsParameters:u,tournamentRecord:c,isMock:d=!0,drawProfile:p,startDate:f,drawIndex:m,uuids:h}=t,g=ke(p,!1,!0),{excessParticipantAlternates:I=!0,matchUpFormat:v=Xu,drawType:w=Yo,tournamentAlternates:y=0,alternatesCount:b=0,qualifyingPositions:S,qualifyingProfiles:U,generate:T=!0,eventExtensions:P,drawExtensions:D,completionGoal:E,tieFormatName:R,buildTeams:C,seedsCount:M,timeItems:N,drawName:A,category:O,idPrefix:k,publish:F,gender:x,stage:L}=g,$=g.drawSize||(g.ignoreDefaults?void 0:32),V=g.eventId||Et(),_=p.eventType||p.matchUpType||nl,B=_===ls?pt:gt,G=bt(p.tieFormat)&&p.tieFormat||_===Lt&&sc({event:{eventId:V,category:O,gender:x},namedFormat:R,hydrateCollections:o,isMock:d})||void 0,j=O?.categoryName||O?.ageCategoryCode||O?.ratingType,K=p.eventName||j||`Generated ${_}`,Y=c?.participants||[],X=(U?.flatMap(ce=>ce.structureProfiles||[]).reduce((ce,ye)=>{let be=!ye.participantsCount||ye.participantsCount>ye.drawSize?ye.drawSize:ye.participantsCount||0;return ce+be},0)||0)*(B===pt?2:1),Z=(!p.participantsCount||p.participantsCount>$?$:p.participantsCount)||0,J={eventName:K,eventType:_,tieFormat:G,category:O,eventId:V,gender:x};Array.isArray(N)&&N.forEach(ce=>Sh({event:J,timeItem:ce}));let{eventAttributes:ae}=p;if(typeof ae!="object"&&(ae={}),Object.assign(J,ae),P?.length&&Array.isArray(P)){let ce=P.filter(sl);ce?.length&&Object.assign(J,{extensions:ce})}let te=[];if(r?.participantsCount===0||p.uniqueParticipants||X||!c||x||O){let ce=(Z||0)+b+X,ye=ce,be={[er]:0,[Hr]:0},Fe,we;_===Lt&&({teamSize:Fe,genders:we}=V_({alternatesCount:b,tieFormatName:R,tieFormat:G,drawSize:$}),Object.keys(we).forEach(Ee=>{let Le=on(Ee);Le&&il(Ee)&&we[Le]&&(be[Le]=$*we[Le])}),ye=Fe*(($||0)+X));let Ne=r?.idPrefix?`D-${m}-${r?.idPrefix}`:void 0,me=Tv({...r,scaledParticipantsCount:p.scaledParticipantsCount||r.scaledParticipantsCount,participantsCount:ye,consideredDate:c?.startDate,sex:x||r?.sex,rankingRange:p.rankingRange,uuids:p.uuids||h,ratingsParameters:u,participantType:B,gendersCount:be,idPrefix:Ne,category:O}).participants;if(J.category&&(J.category.categoryName=j),c){let Ee=Zs({participants:me,tournamentRecord:c});if(Ee.error)return Ee}if(me.forEach(({participantId:Ee})=>te.push(Ee)),Y=me,_===Lt){let Ee=we[er]?me.filter(({participantType:Ue,person:ut})=>Ue===gt&&ut?.sex===er).map(vt):[],Le=we[Hr]?me.filter(({participantType:Ue,person:ut})=>Ue===gt&&sp(ut?.sex)).map(vt):[],Q=me.filter(({participantType:Ue})=>Ue===gt).map(vt).filter(Ue=>!Ee.includes(Ue)&&!Le.includes(Ue)),se=[...g.teamNames??[],...lP({count:ce}).names],oe=Fe-(we[er]+we[Hr]),ue=0,ee=0,Se=0,De=Re(0,ce).map(Ue=>{let ut=Le.slice(ue,ue+we[Hr]),yi=Ee.slice(ee,ee+we[er]),qe=Q.slice(Se,Se+oe);ue+=we[Hr],ee+=we[er],Se+=oe;let bi=C!==!1?[...ut,...yi,...qe]:[];return{participantName:se[Ue]||`Team ${Ue+1}`,participantOtherName:`TM${Ue+1}`,participantRole:Kr,individualParticipantIds:bi,participantType:Lt,participantId:Et()}}),it=Zs({participants:De,tournamentRecord:c});if(!it.success)return it;Y=De}}let ne=ce=>{let{participantType:ye}=ce;return Di(nl)(_)&&ye===gt||Di(ls)(_)&&ye===pt?!0:_===Lt&&ye===Lt},le=ce=>!p.gender||ce.person?.sex===p.gender?!0:ce.individualParticipantIds?.some(ye=>{let be=Y.find(Fe=>Fe.participantId===ye);return be&&le(be)}),de=Y.filter(ne).filter(le).filter(({participantId:ce})=>!i.includes(ce)),pe=de.slice(0,Z).map(ce=>ce.participantId);if(d&&pe?.length){let ce=Ko({autoEntryPositions:s,entryStage:L,tournamentRecord:c,participantIds:pe,event:J});if(ce.error)return ce}let ge=X?de.slice(Z,Z+X).map(ce=>ce.participantId):0;if(d&&ge?.length){let ce=0,ye=1,be=(we,Ne)=>we.stageSequence-Ne.stageSequence,Fe=(we,Ne)=>we.roundTarget-Ne.roundTarget;for(let we of U.sort(Fe)){ye=we.roundTarget||ye;let Ne=1,me;for(let Ee of we.structureProfiles.sort(be)){let Le=(Ee.drawSize||T1(Ee.participantsCount))-(me||0),Q=ge.slice(ce,ce+Le),se=Ko({entryStage:We,entryStageSequence:Ne,autoEntryPositions:s,tournamentRecord:c,participantIds:Q,roundTarget:ye,event:J});if(se.error)return se;me=Ee.qualifyingPositions,ce+=Le,Ne+=1}ye+=1}}let Me=I&&c?.participants?.filter(({participantId:ce})=>!pe.includes(ce)).filter(ne).filter(le).slice(0,b||$-Z||y).map(ce=>ce.participantId);if(d&&Me?.length){let ce=Ko({participantIds:Me,autoEntryPositions:!1,entryStatus:Fs,tournamentRecord:c,event:J});if(ce.error)return ce.error}let Pe=j||K;c&&M&&M<=pe.length&&Re(1,M+1).forEach((ce,ye)=>{let be={scaleName:Pe,scaleDate:f,scaleType:eL,scaleValue:ce,eventType:_},Fe=pe[ye];mv({tournamentRecord:c,participantId:Fe,scaleItem:be})});let Be=AS({...ke(p,!1,!0),tournamentRecord:c,seedingScaleName:Pe,matchUpFormat:v,eventId:V,isMock:d,event:J});if(Be.error)return Be;if(!Be.drawDefinition)return{error:Oa};let{drawDefinition:fe}=Be,Te=fe.drawId;if(Array.isArray(D)&&D.filter(sl).forEach(ce=>xt({element:fe,extension:ce})),T){if(kS({drawDefinition:fe,event:J,suppressNotifications:!0}),p.withPlayoffs){let ye=fe.structures?.[0].structureId,be=GR({...p.withPlayoffs,tournamentRecord:c,drawDefinition:fe,structureId:ye,idPrefix:k,isMock:d,event:J});if(be?.error)return be}let ce=p.automated===!1;if(d&&!ce){let ye=be=>{let Fe=uP({completeAllMatchUps:be.completeAllMatchUps,completionGoal:be.completionGoal,matchUpStatusProfile:n,randomWinningSide:l,tournamentRecord:c,drawDefinition:fe,matchUpFormat:v,event:J});if(Fe.error)return Fe;let we=Fe.completedCount;if(w===au){let Ne=fe.structures?.find(Le=>Le.stage===xe);if(!Ne)return{error:Ii};pv({structureId:Ne.structureId,tournamentRecord:c,drawDefinition:fe});let me=E?E-(we??0):void 0,Ee=uP({completionGoal:E?me:void 0,matchUpStatusProfile:n,completeAllMatchUps:a,randomWinningSide:l,tournamentRecord:c,drawDefinition:fe,matchUpFormat:v,event:J});if(Ee.error)return Ee}};if(E&&ye({completionGoal:E}),p.outcomes){let{matchUps:be}=Rn({inContext:!0,drawDefinition:fe,event:J});for(let Fe of p.outcomes){let{matchUpStatus:we=ki,matchUpStatusCodes:Ne,stageSequence:me=1,matchUpIndex:Ee=0,structureOrder:Le,matchUpFormat:Q,drawPositions:se,roundPosition:oe,stage:ue=xe,roundNumber:ee,winningSide:Se,scoreString:De}=Fe,it=be?.reduce((qe,bi)=>{let{structureId:oi,matchUpId:nn}=bi;return qe[oi]?qe[oi].push(nn):qe[oi]=[nn],qe},{})??[],Ue=Object.assign({},...Object.keys(it).map((qe,bi)=>({[qe]:bi+1}))),ut=be?.filter(qe=>(!ue||qe.stage===ue)&&(!me||qe.stageSequence===me)&&(!ee||qe.roundNumber===ee)&&(!oe||qe.roundPosition===oe)&&(!Le||Ue[qe.structureId]===Le)&&(!se||xi(se,qe.drawPositions).length===2))?.[Ee],yi=OJ({matchUpStatusCodes:Ne,tournamentRecord:c,drawDefinition:fe,targetMatchUp:ut,matchUpFormat:Q,matchUpStatus:we,scoreString:De,winningSide:Se});if(yi?.error)return yi}}a&&ye({completeAllMatchUps:a})}F&&bv({tournamentRecord:c,event:J})}else{let ce=DC({drawEntries:fe.entries,drawName:A||w,qualifyingPositions:S,drawId:Te,event:J,stage:L});if(ce.error)return ce}return{...H,event:Ve(J),uniqueParticipantIds:te,targetParticipants:Y,drawDefinition:fe,eventId:V,drawId:Te}}var $J=()=>({altitude:void 0,courtId:void 0,courtName:"",courtDimensions:void 0,latitude:void 0,longitude:void 0,surfaceCategory:void 0,surfaceType:void 0,surfacedDate:void 0,indoorOutdoor:void 0,floodlit:void 0,dateAvailability:[],onlineResources:[],pace:void 0,notes:void 0}),dEe=$J;function BC({tournamentRecord:t,disableNotice:e,venueId:i,courtId:r,court:n}){let{venue:a}=Eu({tournamentRecord:t,venueId:i});if(!a)return{error:ef};a.courts||(a.courts=[]);let s={...$J(),venueId:i,courtId:r};if(s.courtId||(s.courtId=Et()),a.courts.some(o=>o.courtId===s.courtId))return{error:Y6};{let o=(n?.dateAvailability||[]).map(c=>({...c,date:Qe(c.date),startTime:ci(c.startTime),endTime:ci(c.endTime),bookings:c.bookings?.map(({startTime:d,endTime:p,bookingType:f})=>({startTime:ci(d),endTime:ci(p),bookingType:f}))})),l=Object.keys(s);for(let c of l)if(n?.[c])if(c==="dateAvailability"){let d=ER({dateAvailability:o});if(!d.valid&&d.error)return d;s.dateAvailability=o}else s[c]=n[c];let u=s;return a.courts.push(u),e||at({payload:{venue:a,tournamentId:t.tournamentId},topic:Oc,key:a.venueId}),{...H,court:ke(s),venueId:i}}}function H_(t){let{tournamentRecord:e,venueId:i}=t;if(typeof i!="string"||!i)return{error:xd};let r=t.tournamentRecords??(e&&{[e.tournamentId]:e})??{},n=[],a;for(let s of Object.values(r)){let{venue:o}=Eu({tournamentRecord:s,venueId:i});if(o){let l=pEe({...t,tournamentRecord:s});for(let u of l?.courts??[])n.push(u?.courtId);if(l.error)return l;a=!0}}return a?{...H,courtIds:n}:{error:ef}}function pEe({courtNameRoot:t="Court",dateAvailability:e=[],venueAbbreviationRoot:i,tournamentRecord:r,courtNames:n=[],courtTimings:a,courtsCount:s,startTime:o,courtIds:l,endTime:u,idPrefix:c,venueId:d,dates:p}){if(!d)return{error:xd};let f=Eu({tournamentRecord:r,venueId:d});if(f.error)return f;let{venue:m}=f;if(!Ni(s)||!n)return{error:q6};s=s??n.length;let h=Re(0,s).map(g=>{let I=a?.[g],v=I?p.map(w=>({date:Os(w),startTime:o,endTime:u,...I})):e;return I&&o&&u&&v.push({startTime:o,endTime:u}),{courtName:n[g]||i&&m?.venueAbbreviation&&`${m?.venueAbbreviation} ${g+1}`||`${t} ${g+1}`,dateAvailability:v}}).map((g,I)=>{let v=l?.pop()||c&&`${c}-${I+1}`;return BC({disableNotice:!0,tournamentRecord:r,courtId:v,venueId:d,court:g})}).map(g=>g.court).filter(Boolean);return h.length!==s?z({info:"not all courts could be generated",result:{error:ie}}):(m&&at({payload:{venue:m,tournamentId:r.tournamentId},topic:Oc,key:m.venueId}),{...H,courts:ke(h)})}function W_({tournamentRecord:t,ignoreExistingVenues:e,venueProfiles:i,uuids:r}){let{startDate:n,endDate:a}=t,s=[];for(let[o,l]of i.entries()){let{venueAbbreviation:u,venueId:c=r?.pop()??Et(),dateAvailability:d,venueDateAvailability:p,defaultStartTime:f,defaultEndTime:m,startTime:h="07:00",endTime:g="19:00",courtTimings:I,courtsCount:v,courtNames:w,venueName:y,idPrefix:b,courtIds:S}=l,U={venueName:y||`Venue ${o+1}`,venueAbbreviation:u,venueId:c};f&&(U.defaultStartTime=f),m&&(U.defaultEndTime=m),l.isPrimary&&(U.isPrimary=!0),p&&(U.dateAvailability=p);let T=nS({tournamentRecord:t,venue:U});if(T.error){if(e)continue;return T}s.push(c);let P=Xg(n,a),D=!Array.isArray(d)&&[{startTime:h,endTime:g}].concat(P.map(E=>({date:Os(E),startTime:h,endTime:g})));if(v||w){let E=H_({dateAvailability:d||D,tournamentRecord:t,courtTimings:I,courtsCount:v,courtNames:w,startTime:h,idPrefix:b,courtIds:S,endTime:g,venueId:c,dates:P});if(E.error)return E}}return s}function fEe(t){let{tournamentRecord:e,leagueProfiles:i,eventIds:r,venueIds:n,drawIds:a,allUniqueParticipantIds:s,uuids:o}=t,l=0;for(let c of i){let d=[],{tieFormatName:p=LD,teamProfiles:f=[],teamsCount:m=0,category:h,idPrefix:g,gender:I}=c,v=c.leagueName??c.eventName??`League ${l+1}`,w=c.leagueId??c.eventId??o?.pop()??Et();r.push(w);let y=bt(c.tieFormat)&&c.tieFormat||sc({event:{eventId:w,category:h,gender:I},namedFormat:p,isMock:t.isMock})||void 0;if(!y)return{error:XI};let b=Math.max(m,f.length),S=Re(0,b),{genders:U,teamSize:T}=V_({tieFormat:y,drawSize:b}),P={[Hr]:0,[ah]:0,[Vu]:0,[er]:0,ANY:0};Object.keys(U).forEach(E=>P[E]+=U[E]);for(let E of S){let R=f?.[E]?.teamName??`Team ${E+1}`,C=f?.[E]?.teamId||o?.pop()||Et(),M=c.startDate??t.startDate,N=Tv({...c?.participantsProfile,participantsCount:T,consideredDate:M,gendersCount:P,category:h,uuids:o}).participants,A=N.map($=>$.participantId),O=Lt,k=C??oP({participantType:O,idPrefix:g,index:E,uuids:o});d.push({participantId:k,entryStatus:na,entryStage:xe});let F=f?.[E]?.venueIds??[],x={participantId:k,participantRole:Kr,participantName:R,individualParticipantIds:A,participantType:O,homeVenueIds:F};F.forEach($=>!n.includes($)&&n.push($)),s.push(...A,k);let L=Zs({participants:[x,...N],tournamentRecord:e});if(L.error)return L}let D={eventName:v,entries:d,eventType:Lt,tieFormat:y,category:h,eventId:w,gender:I};if(e.events||(e.events=[]),e.events.push(D),d.length){let E=(Ni(c.roundsCount)&&c.roundsCount)??c.roundsCount===ige?(b-1)*2:b-1,R=AS({automated:c.automated,tournamentRecord:e,drawType:ra,roundsCount:E,drawSize:b,event:D});if(R.error)return R;let{drawDefinition:C}=R;if(C){let M=C?.drawId;kS({drawDefinition:C,event:D,suppressNotifications:!0}),a.push(M)}}l++}let u=n.map(c=>({venueId:c}));W_({tournamentRecord:e,ignoreExistingVenues:!0,venueProfiles:u,uuids:o})}var mEe=["Generated Tournament","CourtHive Challenge","Replication Crisis","Open Competition","Factory Follies","Mock Tournament","Atomic Culture","Racket Rally","Stats Fail"];function BJ(t){let{startDate:e,endDate:i}=t??{},{tournamentName:r=ma(mEe),ratingsParameters:n=xr,tournamentExtensions:a,policyDefinitions:s,schedulingProfile:o,venueProfiles:l,uuids:u}=t??{},c=t?.isMock===!1?void 0:!0;if(e&&!Pn(e)||i&&!Pn(i))return{error:sr};if(t.leagueProfiles&&!Array.isArray(t.leagueProfiles)||t.eventProfiles&&!Array.isArray(t.eventProfiles)||t.drawProfiles&&!Array.isArray(t.drawProfiles))return{error:ie};if(!e){let v=new Date;e=Os(i??v),i=Os(v.setDate(v.getDate()+7))}if(!i){let v=new Date(e);i=Os(v.setDate(v.getDate()+7))}let d=_C({...t.tournamentAttributes??{},tournamentName:r,startDate:e,endDate:i,isMock:c}),p=l?.length?W_({tournamentRecord:d,venueProfiles:l,uuids:u}):[];if(a?.length&&Array.isArray(a)){let v=a.filter(w=>sl({extension:w}));v?.length&&Object.assign(d,{extensions:v,isMock:c})}if(typeof s=="object")for(let v of Object.keys(s))Ap({policyDefinitions:{[v]:s[v]},tournamentRecord:d});if(!t?.leagueProfiles?.length||t.eventProfiles?.length||t.drawProfiles?.length||t.participantsProfile){let v=NJ({tournamentRecord:d,...t});if(!v.success)return v}let f=[],m=[],h=[];if(t.leagueProfiles){let v=fEe({allUniqueParticipantIds:f,tournamentRecord:d,...t,eventIds:m,venueIds:p,drawIds:h});if(v?.error)return v}if(t.drawProfiles){let v=hEe({allUniqueParticipantIds:f,ratingsParameters:n,tournamentRecord:d,...t,eventIds:m,drawIds:h});if(v?.error)return v}if(t.eventProfiles){let v=gEe({allUniqueParticipantIds:f,ratingsParameters:n,tournamentRecord:d,...t,eventIds:m,drawIds:h});if(v?.error)return v}let{scheduledRounds:g=void 0,schedulerResult:I={}}=o?IEe({...t,tournamentRecord:d}):{};return Z1(),Ve({...H,tournamentRecord:d,scheduledRounds:g,schedulerResult:I,eventIds:m,venueIds:p,drawIds:h})}function hEe(t){let{tournamentRecord:e,drawProfiles:i,allUniqueParticipantIds:r,eventIds:n,drawIds:a}=t,s=0;for(let o of i){let l=$C({allUniqueParticipantIds:r,tournamentRecord:e,drawProfile:o,drawIndex:s,...t});if(l.error)return l;let{drawId:u,eventId:c,event:d,uniqueParticipantIds:p}=l;if(o?.addEvent!==!1){if(l=vv({suppressNotifications:!1,internalUse:!0,tournamentRecord:e,event:d}),l.error)return l;u&&a.push(u),n.push(c)}p?.length&&r.push(...p),s+=1}}function gEe(t){let{eventProfiles:e,allUniqueParticipantIds:i,eventIds:r,drawIds:n}=t,a=0;for(let s of e){let o=_J({...t,eventIndex:a,eventProfile:s});if(o.error)return o;let{eventId:l,drawIds:u,uniqueParticipantIds:c}=o;u&&n.push(...u),r.push(l),c?.length&&i.push(...c),a+=1}}function IEe(t){let{schedulingProfile:e,tournamentRecord:i,autoSchedule:r,periodLength:n,scheduleCompletedMatchUps:a}=t,s=cEe({schedulingProfile:e,tournamentRecord:i});if(s.error)return s;let o=s.scheduledRounds;if(r){let{tournamentId:l}=i,u={[l]:i};return{schedulerResult:FC({scheduleCompletedMatchUps:a,tournamentRecords:u,periodLength:n}),scheduledRounds:o}}return{scheduledRounds:o}}var VJ={};ct(VJ,{anonymizeTournamentRecord:()=>jJ,modifyTournamentRecord:()=>HJ});function jJ({keepExtensions:t=[],anonymizeParticipantNames:e=!0,tournamentRecord:i,tournamentName:r,personIds:n=[],tournamentId:a}){if(!i)return{error:Ie};let s=Array.isArray(t)?AH.concat(...t):AH,o=k=>Array.isArray(t)?k?.extensions?.filter(F=>s.includes(F.name)):k?.extensions,l={};i.extensions=o(i);let u=a||Et();l[i.tournamentId]=u,i.tournamentId=u,i.createdAt=new Date().toISOString(),i.tournamentName=r||`Anonymized: ${Os(new Date)}`,i.isMock=!0,delete i.parentOrganisation;for(let k of i.participants||[]){k.extensions=o(k),k.onlineResources=[];let F=Et();l[k.participantId]=F,k.participantId=F}for(let k of i.participants||[])Array.isArray(k.individualParticipantIds)&&(k.individualParticipantIds=k.individualParticipantIds.map(F=>l[F]));let c=0;for(let k of i.venues||[]){k.venueAbbreviation=`V${c}`,k.extensions=o(k),k.venueName=`Venue #${c}`,k.onlineResources=[],k.addresses=[];let F=Et();l[k.venueId]=F,k.isMock=!0,c+=1;let x=0;for(let L of k.courts||[])L.courtName=`V${c}C${x}`,L.extensions=o(L),L.onlineResources=[],L.isMock=!0,x+=1}let d=1;for(let k of i.events||[]){k.extensions=o(k),k.onlineResources=[],k.isMock=!0;let F=Et();l[k.eventId]=F,k.eventId=F;let x=k.category?.categoryName||k.category?.ageCategoryCode||k.category?.ratingType||k.gender;if(k.eventName=`Event ${d} ${x}`,Array.isArray(k.entries))for(let $ of k.entries)$.participantId=l[$.participantId];for(let $ of k.drawDefinitions||[]){$.extensions=o($);let V=Et();if(l[$.drawId]=V,$.drawId=V,$.isMock=!0,Array.isArray($.entries))for(let B of $.entries)B.participantId=l[B.participantId];let _=B=>{B.extensions=o(B);let G=Et();l[B.structureId]=G,B.structureId=G;for(let j of B.positionAssignments||[])j.participantId&&(j.participantId=l[j.participantId]);for(let j of B.seedAssignments||[])j.participantId&&(j.participantId=l[j.participantId]);for(let j of B.matchUps||[]){j.isMock=!0;for(let K of j.sides||[])K.lineUp&&(K.lineUp=K.lineUp.map(({participantId:Y,collectionAssignments:X})=>({participantId:l[Y],collectionAssignments:X})))}};for(let B of $.structures||[])if(_(B),Array.isArray(B.structures))for(let G of B.structures)_(G);for(let B of $.links||[])B.source.structureId=l[B.source.structureId],B.target.structureId=l[B.target.structureId]}let{extension:L}=mt({name:Xs,element:k});Array.isArray(L?.value?.flights)&&L?.value.flights?.forEach($=>{if($.drawId=l[$.drawId],Array.isArray($.drawEntries))for(let V of $.drawEntries)V.participantId=l[V.participantId]}),d+=1}let p=i.startDate||Os(new Date),f=(i.participants||[]).filter(({participantType:k})=>k===gt),m=f.reduce((k,F)=>{let x=F.person?.sex,L=on(x);return L&&il(x)?k[L]+=1:k[Vu]+=1,k},{[er]:0,[Hr]:0,[Vu]:0}),h=Object.assign({},...Object.keys(m).map(k=>({[k]:MJ({category:{ageCategoryCode:"O18"},count:m[k],personExtensions:[],consideredDate:p,sex:k})?.persons||[]}))),g={[er]:0,[Hr]:0,[Vu]:0},I=f.length,v=f.reduce((k,F)=>{let x=F.person?.addresses?.[0]||{},{city:L,state:$,postalCode:V}=x;return k.cities.includes(L)||k.cities.push(L),k.states.includes($)||k.states.push($),k.postalCodes.includes(V)||k.postalCodes.push(V),k},{cities:[],postalCodes:[],states:[]}),w=v.postalCodes.length,y=v.cities.length,b=v.states.length,{cities:S}=PJ({count:y||I,participantsCount:I}),{states:U}=EJ({count:b||I,participantsCount:I}),{postalCodes:T}=RJ({count:w||I,participantsCount:I}),P={cities:S,states:U,postalCodes:T};f.forEach((k,F)=>{let x=k?.person,L=x?.sex||Vu,$=Qe(x?.birthDate)?.split("-")[0],V=g[L],_=h[L][V];if(g[L]+=1,$){let[,B,G]=_?.birthDate?.split("-")||[],j=[$,B,G].join("-");_.birthDate=j}if(x?.addresses){let B=CJ({...P,participantIndex:F,nationalityCode:_.nationalityCode});_.addresses=[B]}_.personId=n?.[F]||Et(),e?(_.standardFamilyName=_.lastName,_.standardGivenName=_.firstName,k.participantName=`${_.standardGivenName} ${_.standardFamilyName}`):(_.standardFamilyName=x?.standardFamilyName,_.standardGivenName=x?.standardGivenName),delete _.firstName,delete _.lastName,_.extensions=o(x),k.person=_,l[x?.personId]=_.personId}),(i.participants||[]).filter(({participantType:k})=>k===pt).forEach(k=>{let{individualParticipantIds:F}=k;k.participantName=vEe({individualParticipantIds:F,individualParticipants:f})});let D=(i.participants||[]).filter(({participantType:k})=>k===Lt),E=D.length,R=lP({count:E}).names;D.forEach((k,F)=>{k.participantName=R[F]});let C=(i.participants||[]).filter(({participantType:k})=>k===ja),M=C.length,N=lP({count:M,nameRoot:"Group"}).names;C.forEach((k,F)=>{k.participantName=N[F]});let{extension:A}=mt({element:i,name:Cm});Array.isArray(A?.value)&&A?.value.forEach(k=>{k.tournamentId=l[k.tournamentId],k.structureId=l[k.structureId],k.eventId=l[k.eventId],k.drawId=l[k.drawId]});let{extension:O}=mt({element:i,name:rv});return Array.isArray(O?.value)&&O?.value.forEach(k=>{k.personId=l[k.personId]}),{...H}}function vEe({individualParticipantIds:t,individualParticipants:e}){let i=e.filter(({participantId:r})=>t.includes(r)).map(({person:r})=>r?.standardFamilyName).filter(Boolean).sort().join("/");return t.length===1&&(i+="/Unknown"),i}function yEe({event:t,eventProfile:e,tournamentRecord:i,allUniqueParticipantIds:r,drawIds:n}){let{gender:a,category:s,eventType:o}=t,{drawProfiles:l,publish:u}=e,c=Di(nl)(o)&&gt||Di(ls)(o)&&pt||o;if(l){let{stageParticipantsCount:d,uniqueParticipantsCount:p,uniqueParticipantStages:f}=AJ({drawProfiles:l,category:s,gender:a}),{uniqueDrawParticipants:m=[],uniqueParticipantIds:h=[]}=f?FJ({event:{eventType:o,category:s,gender:a},uniqueParticipantsCount:p,participantsProfile:e.participantsProfile,ratingsParameters:e.ratingsParameters,tournamentRecord:i,eventProfile:e,uuids:e.uuids}):{};r.push(...h);let{stageParticipants:g}=kJ({targetParticipants:i.participants||[],allUniqueParticipantIds:r,stageParticipantsCount:d,eventParticipantType:c}),I=LJ({uniqueDrawParticipants:m,autoEntryPositions:e.autoEntryPositions,stageParticipants:g,tournamentRecord:i,drawProfiles:l,category:s,gender:a,event:t});if(I.error||(I=xJ({matchUpStatusProfile:e.matchUpStatusProfile,completeAllMatchUps:e.completeAllMatchUps,randomWinningSide:e.randomWinningSide,tournamentRecord:i,drawProfiles:l,isMock:e.isMock,event:t}),I.error))return I;n.push(...I.drawIds)}return u&&bv({tournamentRecord:i,event:t}),H}function GJ(t,e){return t?.find((i,r)=>e.eventIndex!==void 0&&r===e.eventIndex||e.eventName&&i.eventName===e.eventName||e.eventId&&i.eventId===e.eventId)}function bEe({event:t,eventProfile:e,tournamentRecord:i,allUniqueParticipantIds:r,drawIds:n,params:a}){return yEe({event:t,eventProfile:{...e,...a},tournamentRecord:i,allUniqueParticipantIds:r,drawIds:n})}function wEe({eventProfile:t,tournamentRecord:e,allUniqueParticipantIds:i,eventIds:r,drawIds:n,params:a,eventIndex:s}){let o=_J({startDate:e.startDate,allUniqueParticipantIds:i,matchUpStatusProfile:a.matchUpStatusProfile,participantsProfile:a.participantsProfile,completeAllMatchUps:a.completeAllMatchUps,autoEntryPositions:a.autoEntryPositions,randomWinningSide:a.randomWinningSide,ratingsParameters:t.ratingsParameters,tournamentRecord:e,eventProfile:t,eventIndex:s,uuids:a.uuids});if(o.error)return o;let{eventId:l,drawIds:u,uniqueParticipantIds:c}=o;return u&&n.push(...u),r.push(l),c?.length&&i.push(...c),{eventIndexIncrement:1}}function SEe({eventProfiles:t,tournamentRecord:e,allUniqueParticipantIds:i,eventIds:r,drawIds:n,params:a}){let s=e.events?.length||0;for(let o of t){let l=GJ(e.events,o);if(l){let u=bEe({event:l,eventProfile:o,tournamentRecord:e,allUniqueParticipantIds:i,drawIds:n,params:a});if(u?.error)return u}else{let u=wEe({eventProfile:o,tournamentRecord:e,allUniqueParticipantIds:i,eventIds:r,drawIds:n,params:a,eventIndex:s});if(u?.error)return u;s+=u?.eventIndexIncrement||1}}return H}function UEe({drawProfiles:t,tournamentRecord:e,allUniqueParticipantIds:i,eventIds:r,drawIds:n,params:a}){let s=(e.events||[]).flatMap(o=>o.drawDefinitions?.map(()=>1)||[]).reduce((o,l)=>o+l,0);for(let o of t){let l=$C({startDate:e.startDate,allUniqueParticipantIds:i,matchUpStatusProfile:a.matchUpStatusProfile,participantsProfile:a.participantsProfile,completeAllMatchUps:a.completeAllMatchUps,autoEntryPositions:a.autoEntryPositions,hydrateCollections:a.hydrateCollections,randomWinningSide:a.randomWinningSide,ratingsParameters:a.ratingsParameters,tournamentRecord:e,drawProfile:o,drawIndex:s,uuids:a.uuids});if(l.error)return l;let{drawId:u,eventId:c,event:d,uniqueParticipantIds:p}=l;if(l=vv({tournamentRecord:e,event:d,internalUse:!0}),l.error)return l;u&&n.push(u),r.push(c),p?.length&&i.push(...p),s+=1}return H}function TEe({schedulingProfile:t,autoSchedule:e,periodLength:i,tournamentRecord:r}){let n=[],a={};if(t?.length){let s={[r.tournamentId]:r},o=gv({tournamentRecords:s,schedulingProfile:t});if(o.error)return o;if(e){let{tournamentId:l}=r,u={[l]:r};a=FC({tournamentRecords:u,periodLength:i})}}return{scheduledRounds:n,schedulerResult:a}}function HJ(t){let{participantsProfile:e={},schedulingProfile:i,tournamentRecord:r,autoSchedule:n,eventProfiles:a,periodLength:s,venueProfiles:o,drawProfiles:l,uuids:u}=t;if(!r)return{error:Ie};let c=[],d=[],p=[];a?.forEach(w=>{let y=GJ(r.events,w);y?.gender&&(w.gender=y.gender)});let f=r.participants?.length||void 0;f&&e?.idPrefix&&(e.idPrefix=`${e.idPrefix}-${f}`);let m=NJ({startDate:r.startDate,participantsProfile:e,tournamentRecord:r,eventProfiles:a,drawProfiles:l,uuids:u});if(!m.success)return m;if(a){let w=SEe({eventProfiles:a,tournamentRecord:r,allUniqueParticipantIds:c,eventIds:d,drawIds:p,params:t});if(w.error)return w}if(l){let w=UEe({drawProfiles:l,tournamentRecord:r,allUniqueParticipantIds:c,eventIds:d,drawIds:p,params:t});if(w.error)return w}let h=o?.length?W_({tournamentRecord:r,venueProfiles:o}):[],g=TEe({tournamentRecord:r,schedulingProfile:i,autoSchedule:n,periodLength:s});if(g.error)return g;let{scheduledRounds:I,schedulerResult:v}=g;return{totalParticipantsCount:r.participants.length,scheduledRounds:I,schedulerResult:v,...H,eventIds:d,venueIds:h,drawIds:p}}var WJ={};ct(WJ,{addDynamicRatings:()=>r0,addIndividualParticipantIds:()=>CC,addParticipant:()=>ul,addParticipants:()=>Zs,addPenalty:()=>pQ,addPersonRequests:()=>JJ,addPersons:()=>fQ,createGroupParticipant:()=>rQ,createTeamsFromParticipantAttributes:()=>B_,deleteParticipants:()=>vh,filterParticipants:()=>cS,findParticipant:()=>iQ,getCompetitionParticipants:()=>M0,getPairedParticipant:()=>Qs,getParticipantEventDetails:()=>N0,getParticipantMembership:()=>A0,getParticipantScaleItem:()=>Nm,getParticipantSchedules:()=>k0,getParticipantSignInStatus:()=>O0,getParticipantTimeItem:()=>zF,getParticipants:()=>Ei,getScaleValues:()=>iv,mergeParticipants:()=>dQ,modifyIndividualParticipantIds:()=>QJ,modifyParticipant:()=>MC,modifyParticipantName:()=>nQ,modifyParticipantOtherName:()=>eQ,modifyParticipantsSignInStatus:()=>ZJ,modifyPenalty:()=>uQ,modifyPersonRequests:()=>KJ,mutate:()=>zJ,participantScaleItem:()=>Hl,query:()=>Q9,regenerateParticipantNames:()=>tQ,removeIndividualParticipantIds:()=>gL,removeParticipantIdsFromAllTeams:()=>kR,removePenalty:()=>oQ,removePersonRequests:()=>XJ,removeRatings:()=>sQ,scaledTeamAssignment:()=>aQ,setParticipantScaleItem:()=>mv,setParticipantScaleItems:()=>z8,validateLineUp:()=>xR});var zJ={};ct(zJ,{addDynamicRatings:()=>r0,addIndividualParticipantIds:()=>CC,addParticipant:()=>ul,addParticipants:()=>Zs,addPenalty:()=>pQ,addPersonRequests:()=>JJ,addPersons:()=>fQ,createGroupParticipant:()=>rQ,createTeamsFromParticipantAttributes:()=>B_,deleteParticipants:()=>vh,findParticipant:()=>iQ,mergeParticipants:()=>dQ,modifyIndividualParticipantIds:()=>QJ,modifyParticipant:()=>MC,modifyParticipantName:()=>nQ,modifyParticipantOtherName:()=>eQ,modifyParticipantsSignInStatus:()=>ZJ,modifyPenalty:()=>uQ,modifyPersonRequests:()=>KJ,regenerateParticipantNames:()=>tQ,removeIndividualParticipantIds:()=>gL,removeParticipantIdsFromAllTeams:()=>kR,removePenalty:()=>oQ,removePersonRequests:()=>XJ,removeRatings:()=>sQ,scaledTeamAssignment:()=>aQ,setParticipantScaleItem:()=>mv,setParticipantScaleItems:()=>z8});function qJ(t=0){(typeof t!="number"||isNaN(t))&&(t=0);let e=new Date;return e.setHours(e.getHours()+t),e.getTime().toString(36).slice(-6).toUpperCase()}function YJ({personRequests:t,personId:e,requests:i}){t[e]||(t[e]=[]);let r=i.filter(({requestType:n})=>n).map(n=>{let{date:a,startTime:s,endTime:o}=n;return n.requestType===FS&&(a=Qe(a),s=ci(s),o=ci(o),a&&s&&o)?{date:a,startTime:s,endTime:o,requestType:n.requestType}:n}).filter(Boolean);for(let n of r)n.requestId=qJ(),t[e].push(n);return{mergeCount:r.length}}function z_(t){let{tournamentRecords:e,personRequests:i}=t,r=Ge(t,[{[cn]:!0}]);if(r.error)return r;if(!i)return{...H};let n=Object.values(e);for(let a of n){let s=a.participants??[],o=[];for(let l of Object.keys(i))if(fd({tournamentParticipants:s,personId:l})){let u=i[l];u.length&&o.push({personId:l,requests:u})}Object.keys(o).length&&xt({element:a,extension:{value:o,name:rv}})}return{...H}}function KJ(t){let{tournamentRecords:e,requests:i,personId:r}=t,n=Ge(t,[{[cn]:!0},{requests:!0,[zn]:an,[Fa]:ie}]);if(n.error)return n;let a=i.map(({requestId:u})=>u).filter(Boolean),{personRequests:s}=df({tournamentRecords:e}),o=u=>{s&&(s[u]=s[u].map(c=>{if(!a.includes(c.requestId))return c;let d=i.find(p=>p.requestId===c.requestId);if(d.requestType)return Object.assign(c,d)}).filter(Boolean))};if(r&&s?.[r])o(r);else if(s)for(let u of Object.keys(s))o(u);let l=i.filter(u=>!u.requestId);return l.length&&YJ({personRequests:s,personId:r,requests:l}),z_({tournamentRecords:e,personRequests:s})}function XJ(t){let{tournamentRecords:e,requestType:i,requestId:r,personId:n,date:a}=t,s=Ge(t,[{[cn]:!0}]);if(s.error)return s;let{personRequests:o}=df({tournamentRecords:e}),l=c=>{o&&(o[c]=o[c].filter(d=>(!i||d.requestType!==i)&&(!r||d.requestId!==r)&&(!a||d.date!==a)),o?.[c]?.length||delete o[c])},u=!i&&!r&&!n&&!a;if(!u){if(n&&o?.[n])l(n);else if(o)for(let c of Object.keys(o))l(c)}return u||!o||!Object.keys(o).length?En({name:rv,tournamentRecords:e,discover:!0}):z_({tournamentRecords:e,personRequests:o})}function JJ(t){let{tournamentRecords:e,personId:i,requests:r}=t,n=Ge(t,[{[cn]:!0,[uge]:!0},{requests:!0,[zn]:an,[Fa]:ie}]);if(n.error)return n;let{personRequests:a}=df({tournamentRecords:e}),{mergeCount:s}=YJ({personRequests:a,personId:i,requests:r});return s&&a?z_({tournamentRecords:e,personRequests:a}):{error:ie}}function QJ({individualParticipantIds:t,groupingParticipantId:e,tournamentRecord:i}){let r="modifyIndividualParticipantIds";if(!i)return z({result:{error:Ie},stack:r});if(!e||!t)return z({result:{error:Xe},stack:r});let n=i.participants||[],a=n.find(f=>f.participantId===e);if(!a)return z({result:{error:Vi},stack:r});if(![Lt,ja].includes(a.participantType))return z({result:{error:Do},context:{participantType:a.participantType},stack:r});let s=t.filter(f=>n.find(m=>m.participantId===f)?.participantType!==gt);if(s.length)return z({result:{error:ga,invalidParticipantIds:s},stack:r});let o=a.individualParticipantIds||[],l=t.filter(f=>!o.includes(f)),u=o.filter(f=>!t.includes(f)),c=CC({individualParticipantIds:l,groupingParticipantId:e,tournamentRecord:i});if(c.error)return z({result:c,stack:r});let d=gL({individualParticipantIds:u,groupingParticipantId:e,tournamentRecord:i});if(d.error)return z({result:d,stack:r});let{topics:p}=gs();if(p.includes(en)){let f=n.find(({participantId:m})=>m===e);at({topic:en,payload:{tournamentId:i.tournamentId,participants:[f]}})}return{...c,...d}}function ZJ({tournamentRecord:t,participantIds:e,signInState:i}){if(!t)return{error:Ie};if(!Array.isArray(e))return{error:Xe};if(![Sb,lK].includes(i))return{error:ie,signInState:i};let r=t.participants||[];if(!r.length)return{error:Mw};let n=r.map(vt),a=e.filter(u=>!n.includes(u));if(a.length)return{error:ie,context:{invalidParticipantIds:a}};let s=[],o=new Date().toISOString();for(let u of r){let{participantId:c}=u;if(e.includes(c)){let d=HL({duplicateValues:!1,tournamentRecord:t,participantId:c,timeItem:{itemType:zw,itemValue:i,createdAt:o}});if(d.error)return d;s.push(u)}}let{topics:l}=gs();return s.length&&l.includes(en)&&at({topic:en,payload:{tournamentId:t.tournamentId,participants:s}}),{...H}}function eQ({tournamentRecord:t,participantId:e,participantOtherName:i}){if(!t)return{error:Ie};if(!e)return{error:lr};let{participant:r}=$d({tournamentRecord:t,participantId:e});if(!r)return{error:Vi};r.participantOtherName=i;let{topics:n}=gs();return n.includes(en)&&at({topic:en,payload:{tournamentId:t.tournamentId,participants:[r]}}),{...H}}function MW({personFormat:t,person:e}){let i=h=>h.replace(/\W/g,""),r=h=>/^[a-z]*$/.test(i(h)),n=h=>/^[A-Z]*$/.test(i(h)),a=h=>/^[LAST]{4}/.test(i(h)),s=h=>h.toLowerCase().indexOf("l")<h.toLowerCase().indexOf("f"),o=h=>h.indexOf(",")>=0,l=h=>h.toLowerCase().indexOf("f.")>=0,u=h=>h.toLowerCase().indexOf("f")<0,c=h=>h.indexOf(" ")>0;if(!e)return;let d=c(t)?" ":"",p=mO(e?.standardGivenName??""),f=mO(e?.standardFamilyName??"");if(!t)return`${p}${d}${f}`;l(t)&&!o(t)&&!s(t)&&(p=`${p[0]}.`),r(t)?(p=p.toLowerCase(),f=f.toLowerCase()):n(t)?(p=p.toUpperCase(),f=f.toUpperCase()):a(t)&&(f=f.toUpperCase());let m=`${p}${d}${f}`;return u(t)?m=f:s(t)&&(o(t)?m=`${f},${d}${p}`:m=`${f}${d}${p}`),m}function DEe({participantMap:t,participant:e,formats:i}){let{participantType:r,individualParticipantIds:n,person:a}=e,s=r&&i[r];if(r!==_n&&s){let{personFormat:o,doublesJoiner:l}=s;r===gt&&(e.participantName=MW({person:a,personFormat:o})),r===pt&&(e.participantName=n?.map(u=>{let c=t[u]?.person;return MW({person:c,personFormat:o})}).filter(Boolean).join(l??"/"))}}function tQ({tournamentRecord:t,formats:e}){if(!t)return{error:Ie};if(!bt(e))return{error:Xe};let i=t.participants??[],r=jY(i,"participantId");for(let n of i)DEe({participant:n,participantMap:r,formats:e});return{...H}}function iQ(t){let{tournamentRecord:e,policyDefinitions:i,contextProfile:r,participantId:n,personId:a}=t,s=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(typeof n!="string"&&typeof a!="string")return{error:Xe,stack:"publicFindParticipant"};let o,l;for(let u of Object.values(s)){l=u.tournamentId;let c=u.participants||[];if(o=fd({tournamentParticipants:c,internalUse:!0,policyDefinitions:i,contextProfile:r,participantId:n,personId:a}),o)break}return{participant:o,tournamentId:l,...H}}function rQ({individualParticipantIds:t=[],participantRoleResponsibilities:e,participantRole:i=h7,tournamentRecord:r,participantId:n,groupName:a}){if(!r)return{error:Ie};if(!a)return{error:Xe,info:"Missing groupName"};if(!Array.isArray(t))return{info:"Invalid individualParticipantIds",error:ie};let s=(Ei({participantFilters:{participantTypes:[gt]},tournamentRecord:r}).participants??[]).map(c=>c.participantId);for(let c of t)if(!s.includes(c))return{error:Do,participantId:c};let o=Ve({participantId:n||Et(),participantRoleResponsibilities:e,participantName:a,individualParticipantIds:t,participantType:ja,participantRole:i}),l=ul({participant:o,tournamentRecord:r});if(l.error)return l;let{topics:u}=gs();return u.includes(md)&&at({topic:md,payload:{tournamentId:r.tournamentId,participants:[o]}}),{...H,participant:ke(o)}}function nQ({tournamentRecord:t,participantName:e,participantId:i}){if(!t)return{error:Ie};if(!i)return{error:lr};if(!e)return{error:Xe,info:"Missing participantName"};let{participant:r}=$d({tournamentRecord:t,participantId:i});if(!r)return{error:Vi};r.participantName=e;let{topics:n}=gs();return n.includes(en)&&at({topic:en,payload:{tournamentId:t.tournamentId,participants:[r]}}),{...H}}function aQ({clearExistingAssignments:t=!0,individualParticipantIds:e,reverseAssignmentOrder:i,initialTeamIndex:r=0,scaledParticipants:n=[],teamParticipantIds:a,tournamentRecord:s,scaleAttributes:o,teamNameBase:l,teamsCount:u,eventId:c,event:d}){if(!s)return{error:Ie};if(!Array.isArray(a)&&!ot(u)&&!c||!ot(r)||n&&!Array.isArray(n)||o&&(typeof o!="object"||!Object.keys(o).length))return{error:ie};if(!o&&!n.length||!n&&!(e&&o))return{error:Xe,info:"Missing scaling details"};if(c&&!a){if(d?.eventType!==ya)return{error:Zl};a=d?.entries?.filter(({entryStatus:I})=>I===na).map(vt)}if(!a?.length&&!u)return{info:"Missing teamParticipantIds or teamsCount",error:Xe};let p=e??n.map(({participantId:I})=>I);i&&(a?.reverse(),r+=1),r>(a?.length||0)-1&&(r=0);let f=a?.slice(r).concat(...a.slice(0,r))??[],m=[];for(let I of s.participants??[]){let{participantId:v,participantType:w}=I;if(f.includes(v)){if(w!==_n)return{error:Do,participant:I};m.push(I)}}if(u&&m.length<u){let I=u-(m?.length||0),v=l??"Team",w=Re(0,I).map(U=>({participantName:`${v} ${U+1}`,participantType:_n,participantRole:Kr})),{participants:y=[]}=Zs({participants:w,returnParticipants:!0,tournamentRecord:s}),b=y.map(vt),S=s.participants?.filter(({participantId:U})=>b.includes(U))??[];m.push(...S)}if(!m.length)return{error:z1};if(t)for(let I of m)I.individualParticipantIds=[];else{let I=m.map(v=>v).flat();e?.length?p=p.filter(v=>!I.includes(v)):n=n?.filter(({participantId:v})=>!I.includes(v))}if(!e?.length&&!n?.length)return{error:GE,info:"Nothing to be done"};if(!n.length){for(let I of s.participants??[]){let{participantId:v,participantType:w}=I;if(!p.includes(v))continue;if(w!==gt)return{error:Do,participant:I};let y=Hl({scaleAttributes:o,participant:I})?.scaleItem,b=o?.accessor?y?.scaleValue?.[o?.accessor]:y?.scaleValue,S={participantId:v,scaleValue:b};n.push(S)}if(!n.length)return{error:Vi}}n.sort((I,v)=>o?.sortOrder?(v?.scaleValue||0)-(I?.scaleValue||0):(I?.scaleValue||1/0)-(v?.scaleValue||1/0));for(let I of n)if(!I.participantId)return{error:ie,scaledParticipant:I};let h=0;for(;h<n.length;){for(let I of m){if(h+1>n.length)break;let v=n[h];I.individualParticipantIds.push(v.participantId),h++}m.reverse()}let g=m.map(vt);for(let I of s.events??[]){if(I.eventType!==ya)continue;let v=(I.entries??[]).filter(w=>g.includes(w.participantId));for(let w of v){let y=w.participantId,b=m.find(U=>U.participantId===y)?.individualParticipantIds;I.entries=(I.entries??[]).filter(U=>!b.includes(U.participantId)),(I.drawDefinitions??[]).forEach(U=>{U.entries=(U.entries??[]).filter(T=>!b.includes(T.participantId))});let{flightProfile:S}=$i({event:I});(S?.flights||[]).forEach(U=>{U.drawEntries=(U.drawEntries||[]).filter(T=>!b.includes(T.participantId))})}}return{...H,scaledParticipants:n}}function sQ(t){let e=Ge(t,[{[mr]:!0,[IF]:!0},{ratingType:!1,[Wr]:s=>xr[s]}]);if(e.error)return e;let i=`${t.ratingType}.${wF}`,r=t.asDynamic?i:t.ratingType,n=[pd,sd,t.eventType,r].join("."),a=t.tournamentRecord.participants??[];for(let s of a)s.timeItems&&(s.timeItems=s.timeItems.filter(o=>o.itemType!==n));return{...H}}function oQ(t){let{tournamentRecords:e}=t;if(typeof e!="object"||!Object.keys(e).length)return{error:Ci};for(let i of Object.values(e)){let r=PEe({...t,tournamentRecord:i});if(r.error&&r.error!==Yg)return r}return{...H}}function PEe({tournamentRecord:t,penaltyId:e}){if(!t)return{error:Ie};if(!e)return{error:V1};let i=t?.participants??[],r=[],n=!1,a;return i.forEach(s=>{let o=!1;s.penalties=(s.penalties??[]).filter(l=>(l.penaltyId===e&&(o=!0,n||(a=l,n=!0)),o&&r.push(s),l.penaltyId!==e))}),a&&at({topic:en,payload:{tournamentId:t.tournamentId,participants:r}}),a?{...H,penalty:a}:{error:Yg}}var EEe=({penaltyId:t=Et()}={})=>({refereeParticipantId:void 0,penaltyCode:void 0,penaltyType:void 0,extensions:void 0,matchUpId:void 0,createdAt:void 0,issuedAt:void 0,notes:void 0,penaltyId:t}),lQ=EEe;function uQ(t){let{tournamentRecords:e}=t;if(typeof e!="object"||!Object.keys(e).length)return{error:Ci};for(let i of Object.values(e)){let r=REe({...t,tournamentRecord:i});if(r.error&&r.error!==Yg||r.success)return r}return{error:Yg}}function REe({tournamentRecord:t,modifications:e,penaltyId:i}){if(!t)return{error:Ie};if(!e)return{error:ie,modifications:e};if(!i)return{error:V1};let r=t?.participants??[],n=Object.keys(lQ()).filter(l=>l!=="penaltyId"),a=Object.keys(e).filter(l=>n.includes(l));if(!a.length)return{error:HE};let s,o=[];return r.forEach(l=>{let u=!1;l.penalties=(l.penalties??[]).map(c=>(c.penaltyId===i&&(u=!0,a.forEach(d=>Object.assign(c,{[d]:e[d]})),s||(s=c)),c)),u&&o.push(l)}),s&&at({topic:en,payload:{tournamentId:t.tournamentId,participants:o}}),s?{...H,penalty:s}:{error:Yg}}function cQ(t,e,i){return!t&&e?e:t&&!e||typeof t!="object"||typeof e!="object"?t:rt(Object.keys(t).concat(Object.keys(e))).reduce((r,n)=>{if(!e[n])r[n]=t[n];else if(!t[n])r[n]=e[n];else if(typeof t[n]!=typeof e[n])r[n]=e[n];else if(Array.isArray(t[n]))if(i===!0||Array.isArray(i)&&i.includes(n)){let a=rt(t[n].map(s=>JSON.stringify(s)).concat(e[n].map(s=>JSON.stringify(s)))).map(s=>JSON.parse(s));r[n]=a}else r[n]=e[n];else typeof t[n]=="object"?r[n]=cQ(t[n],e[n],i):r[n]=e[n];return r},{})}function dQ({participants:t=[],tournamentRecord:e,arraysToMerge:i}){if(!e)return{error:Ie};e.participants||(e.participants=[]);let r=t.filter(ba(su)).map(u=>({[u.participantId]:u})),n=Object.assign({},...r),a=[];e.participants=e.participants.map(u=>{if(n[u.participantId]){let c=cQ(u,n[u.participantId],i);return a.push(c),c}return u});let s=e.participants.map(ba(su))||[],o=t.filter(({participantId:u})=>!s.includes(u)),{topics:l}=gs();return o.length&&(e.participants=e.participants.concat(...o),l.includes(md)&&at({topic:md,payload:{participants:o}})),a.length&&l.includes(en)&&at({topic:en,payload:{tournamentId:e.tournamentId,participants:a}}),{modifiedParticipantsCount:a.length,newParticipantsCount:o.length,...H}}function pQ(t){let{tournamentRecord:e,participantIds:i}=t,r=t.tournamentRecords??(e&&{[e.tournamentId]:e})??{},n;for(let a of Object.values(r)){let s=(Ei({tournamentRecord:a}).participants??[])?.map(vt).filter(o=>i.includes(o));s.length&&(n=CEe({...t,penaltyId:t.penaltyId??n,tournamentRecord:a,participantIds:s}).penaltyId)}return n?{...H,penaltyId:n}:{error:Vi}}function CEe({refereeParticipantId:t,tournamentRecord:e,participantIds:i,penaltyCode:r,penaltyType:n,extensions:a,penaltyId:s,matchUpId:o,issuedAt:l,notes:u}){if(!e)return{error:Ie};if(!i)return{error:lr};if(!n)return{error:z6};let c=(e?.participants??[]).filter(f=>i.includes(f.participantId));if(!c.length)return{error:Vi};let d=new Date().toISOString(),p=Object.assign(lQ({penaltyId:s}),{refereeParticipantId:t,penaltyCode:r,penaltyType:n,matchUpId:o,createdAt:d,issuedAt:l,notes:u});return Array.isArray(a)&&a.forEach(f=>xt({element:p,extension:f})),c.forEach(f=>{f.penalties??=[],f.penalties.push(p)}),at({topic:en,payload:{tournamentId:e.tournamentId,participants:c}}),{...H,penaltyId:p.penaltyId}}function fQ({participantRole:t=Kr,tournamentRecord:e,persons:i}){if(!e)return{error:Ie};if(!Array.isArray(i))return{error:ie};if(!Object.keys(hL).includes(t))return{error:x6};let r=new Set((e.participants||[]).map(({person:m})=>m?.personId).filter(Boolean)),n=[],a=i.filter(m=>m&&(!m.personId||!r.has(m.personId))).map(m=>(m.personId||(m.personId=Et()),n.push(m.personId),m)),s=(m,h)=>Object.assign({},...Object.keys(m).filter(g=>!h.includes(g)).map(g=>({[g]:m[g]}))),o=a.map(m=>Ve({extensions:m.participantExtensions,timeItems:m.participantTimeItems,participantType:gt,participantRole:t,person:s(m,["participantExtensions","participantTimeItems","pairedPersons"])})),l=0,u,c=Zs({participants:o,tournamentRecord:e});if(c.error)return c;u=c.addedCount||0;let d=[],p=Ei({participantFilters:{participantTypes:[gt]},tournamentRecord:e})?.participants??[];if(t===Kr&&i.filter(({pairedPersons:m})=>m).forEach(({personId:m,pairedPersons:h})=>{Array.isArray(h)&&h.forEach(g=>{let I=[m,g.personId].map(v=>fd({tournamentParticipants:p,personId:v})).filter(Boolean);if(I.length===2){let v=I.map(vt);d.push(Ve({extensions:g.participantExtensions,timeItems:g.timeItems,participantRole:Kr,individualParticipantIds:v,participantType:pt}))}})}),d.length){if(c=Zs({participants:d,tournamentRecord:e}),c.error)return c;l=c.addedCount||0}let f=u+l;return{...H,addedCount:f,newPersonIds:n}}var mQ={};ct(mQ,{bulkUpdatePublishedEventIds:()=>G0,getAllEventData:()=>H0,getCourtInfo:()=>RR,getDrawData:()=>zR,getEventData:()=>TS,getEventPublishStatus:()=>za,getPublishState:()=>Ih,getTournamentPublishStatus:()=>uS,getVenueData:()=>aI,mutate:()=>hQ,publishEvent:()=>bv,publishEventSeeding:()=>gQ,publishOrderOfPlay:()=>wQ,publishParticipants:()=>bQ,query:()=>aX,setEventDisplay:()=>TC,unPublishEvent:()=>SQ,unPublishEventSeeding:()=>IQ,unPublishOrderOfPlay:()=>yQ,unPublishParticipants:()=>vQ});var hQ={};ct(hQ,{publishEvent:()=>bv,publishEventSeeding:()=>gQ,publishOrderOfPlay:()=>wQ,publishParticipants:()=>bQ,setEventDisplay:()=>TC,unPublishEvent:()=>SQ,unPublishEventSeeding:()=>IQ,unPublishOrderOfPlay:()=>yQ,unPublishParticipants:()=>vQ});function gQ({removePriorValues:t=!0,stageSeedingScaleNames:e,seedingScaleNames:i,tournamentRecord:r,status:n=Ha,drawIds:a=[],event:s}){if(!r)return{error:Ie};if(!s)return{error:li};let o=za({event:s,status:n}),l=(o?.seeding?.seedingScaleNames||i)&&{...o?.seeding?.seedingScaleNames,...i},u=(o?.seeding?.stageSeedingScaleNames||e)&&{...o?.seeding?.stageSeedingScaleNames,...e},c=Ve({stageSeedingScaleNames:u,seedingScaleNames:l,published:!0,drawIds:a});return yv({statusObject:{seeding:c},removePriorValues:t,status:n,event:s}),at({topic:rK,payload:{tournamentId:r.tournamentId,eventId:s.eventId,drawIds:a}}),{...H}}function IQ({removePriorValues:t=!0,seedingScaleNames:e,tournamentRecord:i,status:r=Ha,drawIds:n,stages:a,event:s}){if(!i)return{error:Ie};if(!s)return{error:li};let o=za({event:s});if(o){let l=o.seeding;if(Array.isArray(a)&&l.stageSeedingScaleNames)for(let u of a)l.stageSeedingScaleNames[u]&&delete l.stageSeedingScaleNames[u];Array.isArray(e)&&l?.seedingScaleNames&&(l.seedingScaleNames=l.seedingScaleNames.filter(u=>!e.includes(u))),Array.isArray(n)&&l?.drawIds&&(l.drawIds=l.drawIds.filter(u=>!n.includes(u))),(!Object.values(l.stageSeedingScaleNames??{}).length&&!l.seedingScaleNames?.length&&!l.drawIds?.length||!a&&!e&&!n?.length)&&(delete l.stageSeedingScaleNames,delete l.seedingScaleNames,delete l.drawIds,l.published=!1),yv({statusObject:{seeding:l},removePriorValues:t,status:r,event:s})}return at({topic:jF,payload:{tournamentId:i.tournamentId,eventId:s.eventId}}),{...H}}function vQ(t){let e=Is(t);if(!Object.keys(e).length)return{error:Ci};for(let i of Object.values(e)){let r=MEe({tournamentRecord:i,...t});if(r.error)return r}return{...H}}function MEe({removePriorValues:t=!0,tournamentRecord:e,status:i=Ha}){if(!e)return{error:Ie};let r=`${Bd}.${Vd}`,{timeItem:n}=vs({element:e,itemType:r}),a=n?.itemValue||{[i]:{}};return a[i]&&delete a[i].participants,Dl({timeItem:{itemValue:a,itemType:r},element:e,removePriorValues:t}),at({payload:{tournamentId:e.tournamentId},topic:_ge}),{...H}}function yQ(t){let e=Is(t);if(!Object.keys(e).length)return{error:Ci};for(let i of Object.values(e)){let r=NEe({tournamentRecord:i,...t});if(r.error)return r}return{...H}}function NEe({removePriorValues:t=!0,tournamentRecord:e,status:i=Ha}){if(!e)return{error:Ie};let r=`${Bd}.${Vd}`,{timeItem:n}=vs({element:e,itemType:r}),a=n?.itemValue||{[i]:{}};return a[i]&&delete a[i].orderOfPlay,Dl({timeItem:{itemValue:a,itemType:r},element:e,removePriorValues:t}),at({topic:GF,payload:{tournamentId:e.tournamentId}}),{...H}}function bQ(t){let e=Is(t);if(!Object.keys(e).length)return{error:Ci};for(let i of Object.values(e)){let r=AEe({tournamentRecord:i,...t});if(r.error)return r}return{...H}}function AEe({removePriorValues:t,tournamentRecord:e,status:i=Ha,embargo:r}){if(!e)return{error:Ie};let n=`${Bd}.${Vd}`,{timeItem:a}=vs({element:e,itemType:n}),s=a?.itemValue||{[i]:{}},o={published:!0};return r&&!td(r)?{error:Sg}:(r&&(o.embargo=r),s[i].participants=o,Dl({timeItem:{itemValue:s,itemType:n},element:e,removePriorValues:t}),at({payload:{tournamentId:e.tournamentId},topic:aK}),{...H})}function wQ(t){let e=Is(t);if(!Object.keys(e).length)return{error:Ci};for(let i of Object.values(e)){let r=kEe({tournamentRecord:i,...t});if(r.error)return r}return{...H}}function kEe({scheduledDates:t=[],removePriorValues:e,tournamentRecord:i,status:r=Ha,eventIds:n=[],embargo:a}){if(!i)return{error:Ie};let s=`${Bd}.${Vd}`,{timeItem:o}=vs({element:i,itemType:s}),l=o?.itemValue||{[r]:{}},u={published:!0,scheduledDates:t,eventIds:n};return a&&!td(a)?{error:Sg}:(a&&(u.embargo=a),l[r].orderOfPlay=u,Dl({timeItem:{itemValue:l,itemType:s},element:i,removePriorValues:e}),at({topic:nK,payload:{tournamentId:i.tournamentId,scheduledDates:t,eventIds:n}}),{...H})}function SQ({removePriorValues:t=!0,tournamentRecord:e,status:i=Ha,event:r}){if(!e)return{error:Ie};if(!r)return{error:li};let n=`${Bd}.${Vd}`,{timeItem:a}=qw({itemType:n,event:r}),s=a?.itemValue||{[i]:{}};return delete s[i].structureIds,delete s[i].drawDetails,delete s[i].drawIds,Sh({event:r,timeItem:{itemValue:s,itemType:n},removePriorValues:t}),yv({statusObject:{structureIds:void 0,drawIds:void 0,seeding:void 0},removePriorValues:t,status:i,event:r}),at({topic:VF,payload:{tournamentId:e.tournamentId,eventId:r.eventId}}),{eventId:r.eventId,...H}}var q_={};ct(q_,{applyTournamentRankingPoints:()=>EQ,generateRankingList:()=>TQ,getAwardPoints:()=>rP,getAwardProfile:()=>V0,getParticipantPoints:()=>DQ,getQualityWinPoints:()=>B0,getTournamentPoints:()=>hv,mutate:()=>PQ,query:()=>UQ});var UQ={};ct(UQ,{generateRankingList:()=>TQ,getAwardPoints:()=>rP,getAwardProfile:()=>V0,getParticipantPoints:()=>DQ,getQualityWinPoints:()=>B0,getTournamentPoints:()=>hv});function cP({awards:t,pointComponents:e,bestOfCount:i,maxResultsPerLevel:r,mandatoryRules:n}){let a=t.map(d=>{let p=0;for(let f of e)p+=typeof d[f]=="number"?d[f]:0;return{award:d,value:p}});a.sort((d,p)=>p.value-d.value);let s=a,o=[];if(r){let d={};s=[];for(let p of a){let f=p.award.level;f===void 0||!r[f]?s.push(p):(d[f]=(d[f]||0)+1,d[f]<=r[f]?s.push(p):o.push(p))}}if(n?.length)return OEe(s,o,i,n);let l=i>0?s.slice(0,i):s,u=[...i>0?s.slice(i):[],...o],c=l.reduce((d,p)=>d+p.value,0);return{counting:l,dropped:u,bucketTotal:c}}function OEe(t,e,i,r){let n=new Set;for(let p of r){let f=new Set(p.levels),m=[];for(let g=0;g<t.length;g++){let I=t[g].award.level;I!==void 0&&f.has(I)&&m.push(g)}let h=p.bestOfCount?m.slice(0,p.bestOfCount):m;for(let g of h)n.add(g)}let a=[],s=[];for(let p=0;p<t.length;p++)n.has(p)?a.push(t[p]):s.push(t[p]);let o,l;if(i>0){let p=Math.max(0,i-a.length);o=s.slice(0,p),l=s.slice(p)}else o=s,l=[];let u=[...a,...o],c=[...l,...e],d=u.reduce((p,f)=>p+f.value,0);return{counting:u,dropped:c,bucketTotal:d}}function TQ({pointAwards:t,aggregationRules:e={},categoryFilter:i,asOfDate:r}){let{rollingPeriodDays:n,countingBuckets:a,tiebreakCriteria:s=[],minCountableResults:o=0,maxResultsPerLevel:l,bestOfCount:u}=e,c=t;if(i&&(c=c.filter(m=>{if(i.ageCategoryCodes?.length){let h=m.category?.ageCategoryCode;if(!h||!i.ageCategoryCodes.includes(h))return!1}if(i.genders?.length){let h=m.category?.gender||m.gender;if(!h||!i.genders.includes(h))return!1}return!(i.eventTypes?.length&&(!m.eventType||!i.eventTypes.includes(m.eventType)))})),n&&r){let m=new Date(r);m.setDate(m.getDate()-n);let h=m.getTime();c=c.filter(g=>g.endDate?new Date(g.endDate).getTime()>=h:!0)}let d={};for(let m of c){let h=m.personId;h&&(d[h]||(d[h]=[]),d[h].push(m))}let p=[];for(let[m,h]of Object.entries(d)){let g=0,I=[],v=[],w;if(a?.length){w=[];for(let S of a){let{bucketName:U,eventTypes:T,pointComponents:P,bestOfCount:D,maxResultsPerLevel:E,mandatoryRules:R}=S,C=h;T?.length&&(C=C.filter(O=>O.eventType&&T.includes(O.eventType)));let{counting:M,dropped:N,bucketTotal:A}=cP({awards:C,pointComponents:P,bestOfCount:D,maxResultsPerLevel:E,mandatoryRules:R});g+=A,I.push(...M.map(O=>O.award)),v.push(...N.map(O=>O.award)),w.push({bucketName:U,countingResults:M.map(O=>O.award),droppedResults:N.map(O=>O.award),bucketTotal:A})}}else{let{counting:S,dropped:U,bucketTotal:T}=cP({awards:h,pointComponents:["points","qualityWinPoints"],bestOfCount:u||0,maxResultsPerLevel:l});g=T,I=S.map(P=>P.award),v=U.map(P=>P.award)}let y=I.length>=o,b={personId:m,totalPoints:g,rank:0,meetsMinimum:y,countingResults:I,droppedResults:v};w&&(b.bucketBreakdown=w),p.push(b)}p.sort((m,h)=>h.totalPoints-m.totalPoints),s.length&&p.sort((m,h)=>{if(m.totalPoints!==h.totalPoints)return h.totalPoints-m.totalPoints;for(let g of s){let I=NW(g,m,h);if(I!==0)return I}return 0});let f=1;for(let m=0;m<p.length;m++)m>0&&p[m].totalPoints===p[m-1].totalPoints?s.length>0&&s.some(h=>NW(h,p[m-1],p[m])!==0)?p[m].rank=f:p[m].rank=p[m-1].rank:p[m].rank=f,f=m+2;return p}function NW(t,e,i){switch(t){case"highestSingleResult":{let r=Math.max(0,...e.countingResults.map(n=>n.points||0));return Math.max(0,...i.countingResults.map(n=>n.points||0))-r}case"mostCountingResults":return i.countingResults.length-e.countingResults.length;case"mostWins":{let r=e.countingResults.reduce((n,a)=>n+(a.winCount||0),0);return i.countingResults.reduce((n,a)=>n+(a.winCount||0),0)-r}default:return 0}}function DQ({pointAwards:t,personId:e,aggregationRules:i={}}){let{countingBuckets:r,maxResultsPerLevel:n,bestOfCount:a}=i,s=t.filter(c=>c.personId===e);if(r?.length){let c=[],d=0;for(let p of r){let{bucketName:f,eventTypes:m,pointComponents:h,bestOfCount:g,maxResultsPerLevel:I,mandatoryRules:v}=p,w=s;m?.length&&(w=w.filter(U=>U.eventType&&m.includes(U.eventType)));let{counting:y,dropped:b,bucketTotal:S}=cP({awards:w,pointComponents:h,bestOfCount:g,maxResultsPerLevel:I,mandatoryRules:v});d+=S,c.push({bucketName:f,countingResults:y.map(U=>U.award),droppedResults:b.map(U=>U.award),bucketTotal:S})}return{buckets:c,totalPoints:d}}let{counting:o,dropped:l,bucketTotal:u}=cP({awards:s,pointComponents:["points","qualityWinPoints"],bestOfCount:a||0,maxResultsPerLevel:n});return{buckets:[{bucketName:"All",countingResults:o.map(c=>c.award),droppedResults:l.map(c=>c.award),bucketTotal:u}],totalPoints:u}}var PQ={};ct(PQ,{applyTournamentRankingPoints:()=>EQ});function EQ({tournamentRecord:t,policyDefinitions:e,participantFilters:i,scaleName:r="RANKING_POINTS",level:n,removePriorValues:a}){if(!t)return{error:Ie};let s=hv({tournamentRecord:t,policyDefinitions:e,participantFilters:i,level:n});if(s.error)return s;let{personPoints:o,pairPoints:l,teamPoints:u}=s,c={};for(let f of t.participants||[])f.person?.personId&&(c[f.person.personId]=f.participantId);let d=t.endDate,p=0;for(let[f,m]of Object.entries(o)){let h=c[f];if(!h)continue;let g={};for(let I of m){let v=I.eventType||"SINGLES";g[v]||(g[v]=[]),g[v].push(I)}for(let[I,v]of Object.entries(g)){let w=v.reduce((b,S)=>b+(S.points||0)+(S.qualityWinPoints||0)+(S.linePoints||0),0),y=mv({tournamentRecord:t,participantId:h,scaleItem:{scaleType:ou,scaleName:r,eventType:I,scaleDate:d,scaleValue:{points:w,awards:v}},removePriorValues:a});if(y.error)return y;p++}}return{...H,personPoints:o,pairPoints:l,teamPoints:u,modificationsApplied:p}}var RQ={};ct(RQ,{getEntryStatusReports:()=>FEe,getParticipantStats:()=>xEe,getStructureReports:()=>_Ee,getVenuesReport:()=>HEe});function xEe({withCompetitiveProfiles:t,opponentParticipantId:e,withIndividualStats:i,teamParticipantId:r,tournamentRecord:n,withScaleValues:a,tallyPolicy:s,matchUps:o}){if(!n)return{error:Ie};if(o&&!Array.isArray(o))return{error:ta};if(o=o??br({tournamentRecord:n,participantsProfile:a?{withScaleValues:a}:void 0}).matchUps,!o?.length)return{error:Tu};let l=[];e&&l.push(e),r&&l.push(r);let u=l.length?{participantIds:l}:{participantTypes:[_n]},c=Ei({participantFilters:u,tournamentRecord:n}).participants??[];if(!c.every(({participantType:U})=>U===_n))return{error:ga};l.length||l.push(...c.map(vt));let d=new Map,p=new Map,f=new Map,m=new Map,h=(U,T="")=>p.get(U)||p.set(U,{participantName:T,participantId:U,competitorIds:[],competitiveness:{},matchUpStatuses:{},tiebreaks:[0,0],matchUps:[0,0],points:[0,0],games:[0,0],sets:[0,0]})&&p.get(U);for(let U of c){let{participantId:T,individualParticipantIds:P}=U;m.set(T,P??[]),h(T,U.participantName)}if(r&&!m.get(r))return z({result:{error:Vi},context:{teamParticipantId:r}});if(e&&!m.get(e))return z({result:{error:Vi},context:{opponentParticipantId:e}});let g=[],I=U=>{let T=[[],[]];for(let D of U){let E=D.participant;if(E?.participantName){d.set(E.participantId,{participantName:E.participantName,ratings:E.ratings});let R=p.get(E.participantId);R&&(R.participantName=E.participantName)}}let P=({side:D,individualParticipantIds:E})=>D.participantId&&(!E?.length||E.includes(D.participantId))&&[D.participantId]||D.participant?.individualParticipantIds?.length&&(!E?.length||xi(E,D.participant?.individualParticipantIds).length===D.participant?.individualParticipantIds?.length)&&D.participant.individualParticipantIds;if(m.size){let D=(E,R)=>{for(let C of U){if(!C.participant)continue;let M=P({individualParticipantIds:R,side:C});if(M?.length){let N=C.sideNumber;if(!N)continue;let A=[E];i&&A.push(...M),T[N-1]=A;let O=p.get(E);for(let k of M.filter(Boolean))O&&!O.competitorIds.includes(k)&&O.competitorIds.push(k)}}};if(r)(!e||U.every(E=>E.participant&&(P({individualParticipantIds:m.get(r),side:E})||P({individualParticipantIds:m.get(e),side:E}))))&&D(r,m.get(r));else for(let[E,R]of m)D(E,R)}else if(i)for(let D of U){if(!D.participant)continue;let E=P({individualParticipantIds:[],side:D}),R=D.sideNumber;R&&(T[R-1]=E)}return T};for(let U of o){if(!bt(U))return{error:ta};let{matchUpStatus:T,matchUpFormat:P,matchUpType:D,winningSide:E,score:R,sides:C}=U;if(!C||!R||D===ka||T==="BYE")continue;let M=I(C);if(!M.filter(Boolean).length)continue;let N=t&&E&&iS({matchUp:U})?.competitiveness;g.push(U);let A=lL({matchUpStatus:T,matchUpFormat:P,tallyPolicy:s,winningSide:E,score:R}),O=t7({matchUpStatus:T,matchUpFormat:P,tallyPolicy:s,winningSide:E,score:R}),{pointsTally:k,tiebreaksTally:F}=i7({matchUpFormat:P,score:R});M.forEach((x,L)=>{for(let $ of x){let V=d.get($)?.participantName,_=h($,V);if(_){let B=(X,Z)=>Z.forEach((J,ae)=>_[X][ae]+=J),G=L?[...F].reverse():F,j=L?[...k].reverse():k,K=L?[...O].reverse():O,Y=L?[...A].reverse():A;if(B("tiebreaks",G),B("points",j),B("games",K),B("sets",Y),E){let X=E-1===L?0:1;_.matchUps[X]+=1}if(N){let X=N.toLowerCase();_.competitiveness[X]||(_.competitiveness[X]=[0,0]),_.competitiveness[X][L]+=1}if(T){let X=T.toLowerCase();_.matchUpStatuses[X]||(_.matchUpStatuses[X]=0),_.matchUpStatuses[X]+=1}}}})}let v=["tiebreaks","matchUps","points","games","sets"],w=["competitive","routine","decisive"],y=new Map,b=(U,T)=>(U??0)+(T??0);for(let[U,T]of p.entries()){for(let P of v){let D=T[P].reduce(b);if(D){let E=T[P][0]/D,R=`${P}Ratio`,C=parseFloat(E.toFixed(2));T[R]=C,f.set(U,!0),y.has(R)||y.set(R,[]),y.get(R)?.push(C)}}for(let P of w){let D=T.competitiveness?.[P]?.reduce(b);if(D){let E=T.competitiveness[P][0]/D,R=`${P}Ratio`,C=parseFloat(E.toFixed(2));T[R]=C}}}if(!r){let U=(T,P)=>P-T;for(let T of p.values())for(let P of v){let D=`${P}Ratio`;if(typeof T[D]=="number"){let E=y.get(D)?.sort(U).indexOf(T[D]);if(typeof E=="number"&&E>=0){let R=`${P}Rank`;T[R]=E+1}}}}let S={relevantMatchUps:g,...H};return r?(S.teamStats=p.get(r),e&&(S.opponentStats=p.get(e))):S.participatingTeamsCount=f.size,S.allParticipantStats=[...p.values()],S}function dP({participant:t,eventType:e}){let i=t?.person?.personId,r=t?.person?.personOtherIds?.[0],n=t?.person?.tennisId,a=t?.ratings?.[e]?.find(({scaleName:u})=>u==="WTN"),s=a?.scaleValue,{wtnRating:o,confidence:l}=s||{};return{timeStamp:a?.scaleDate,personOtherId:r,confidence:l,wtnRating:o,personId:i,tennisId:n}}function FEe({tournamentRecord:t}){if(!t)return{error:Ie};let e=t.tournamentId,{participantMap:i}=Ei({withScaleValues:!0,withEvents:!0,withSeeding:!0,tournamentRecord:t,withDraws:!0}),r=(br({matchUpFilters:{matchUpTypes:[Qf,wp]},tournamentRecord:t}).matchUps??[]).flatMap(({sides:f,matchUpType:m})=>f?.flatMap(h=>m===wp?h?.participant?.individualParticipantIds:h?.participant?.participantId||h.participantId).filter(Boolean)).filter(Boolean),n=[],a={},s={},o={},l=0,u=({id:f,entry:m,eventId:h,eventType:g})=>{let{qualifyingSeeding:I,mainSeeding:v,entryStatus:w,entryStage:y,drawId:b}=m;a[f]||(a[f]=[]);let{participant:S,events:U}=i?.[f]??{},T=dP({participant:S,eventType:g}),P=U?.[h]?.ranking;w===OL&&n.push(f),a[f].push({participantType:S?.participantType,participantId:f,tournamentId:e,eventType:g,eventId:h,drawId:b,entryStatus:w,entryStage:y,...T,ranking:P,mainSeeding:v,qualifyingSeeding:I})};for(let f of t.events??[]){let m={},h=U=>{m[U]||(m[U]={count:0}),m[U].count+=1},{drawDefinitions:g=[],eventType:I,eventId:v}=f,w=g.flatMap(U=>{let{drawId:T,entries:P}=U;l+=1;let D=({stage:M,stageSequence:N})=>M===xe&&N===1||M===We,E=(U.structures??[]).filter(D).flatMap(({positionAssignments:M})=>M).filter(Boolean).map(({participantId:M})=>M),R=({participantId:M})=>E.includes(M),C=M=>{let{participantId:N,entryStatus:A,entryStage:O}=M;h(A);let k=i?.[N]?.draws?.[T]?.seedAssignments?.[xe];return{qualifyingSeeding:i?.[N]?.draws?.[T]?.seedAssignments?.[We],participantId:N,mainSeeding:k,entryStatus:A,entryStage:O,drawId:T}};return P?.filter(R).map(C)}),y=U=>{let T=U.participantId,P=i?.[T].participant.individualParticipantIds?.filter(D=>r.includes(D));return T&&{[T]:{individualParticipantIds:P}}};I===oc?(()=>{let U=Object.assign({},...w.map(y).filter(Boolean)),T=P=>{U[P.participantId].individualParticipantIds.forEach(D=>{u({id:D,eventType:I,eventId:v,entry:P})})};w.forEach(T)})():w.forEach(U=>{u({id:U?.participantId,eventType:I,eventId:v,entry:U})});let b=Object.values(m).reduce((U,T)=>U+T.count,0);Object.keys(m).forEach(U=>{m[U].pct=m[U].count/b*100}),o[v]={tournamentId:e,eventId:v,entries:w,entryStatuses:m};let S=Object.assign({},...so.flatMap(U=>[{[U+"_count"]:m[U]?.count},{[U+"_pct"]:m[U]?.pct}]));s[v]={tournamentId:e,eventId:v,...S}}let c=Object.values(i??{}).filter(({participant:{participantType:f,participantRole:m}})=>f===gt&&m===Kr),d=c.filter(({participant:f})=>!r.includes(f.participantId)).map(({participant:f})=>f.participantId),p={nonParticipatingEntriesCount:d.length,individualParticipantsCount:c.length,eventsCount:Object.values(o).length,nonParticipatingParticipantIds:d,drawDefinitionsCount:l,tournamentId:e};return{entryStatusReports:Object.values(s).flat(),participantEntryReports:Object.values(a).flat(),eventReports:Object.values(o).flat(),withDrawnParticipantIds:n,tournamentEntryReport:p}}function LEe({eventType:t,matchUps:e,eventId:i,drawId:r}){let n={},a=m=>{let h=m?.matchUpFormat;h&&(n[h]||(n[h]=0),n[h]+=1)},s=e.filter(m=>i?m.eventId===i:m.drawId===r).reduce((m,h)=>(a(h),(h.sides??[]).flatMap(g=>(g?.participant?.individualParticipants||[g?.participant]).filter(Boolean)).forEach(g=>m[g.participantId]=g),m),{}),o=Object.values(s),l=o.map(m=>dP({participant:m,eventType:t})).filter(({wtnRating:m})=>m),u=(o.length-l.length)/o.length*100,c=l.reduce((m,h)=>{let{wtnRating:g,confidence:I}=h;return m.totalWTN+=g,m.totalConfidence+=I,m},{totalWTN:0,totalConfidence:0}),d=l?.length?c.totalWTN/l.length:0,p=l?.length?c.totalConfidence/l.length:0,f=Object.values(n).reduce((m,h)=>m+(h||0),0);return{matchUpFormatCounts:n,matchUpsCount:f,avgConfidence:p,pctNoRating:u,avgWTN:d}}function _Ee(t){let{tournamentRecord:e,extensionProfiles:i,firstFlightOnly:r,firstStageSequenceOnly:n=!0}=t;if(!e)return{error:zg};let a=[],s={},o={},l=[],u=g=>I=>I.structureId===g,c=Object.assign({},...(i??[]).map(({name:g,label:I,accessor:v})=>{let w=mt({element:e,name:g})?.extension?.value,y=v?mp({element:w,accessor:v})?.value:w;return{[I??g]:y}})),d=e?.tournamentId,p=br({participantsProfile:{withScaleValues:!0},tournamentRecord:e}).matchUps??[],f=g=>vs({itemType:NF,itemSubTypes:[jl],element:{timeItems:g}})?.timeItem?.itemValue?.scaleBasis,m=({positionManipulations:g})=>{g?.forEach(I=>{let{structureId:v,name:w}=I,y=I.drawPositions??[I.drawPosition];s[v]??=[],s[v].push(`${w}: ${y.join("/")}`)})},h=e?.events?.flatMap(({timeItems:g,drawDefinitions:I=[],extensions:v,eventType:w,eventName:y,eventId:b,category:S})=>{let U=v?.find(N=>N.name===Xs)?.value?.flights?.map(N=>({[N.drawId]:N.flightNumber})),T=U&&Object.assign({},...U),P=v?.find(N=>N.name===pp),D=g?.find(N=>N.itemType===pp),E=P?.value?.length??D?.itemValue??0,R=Object.values(T??{}),C=T&&Math.min(...R),M=f(g);return o[b]={seedingBasis:M?JSON.stringify(M):void 0,totalPositionManipulations:0,maxPositionManipulations:0,generatedDrawsCount:0,drawDeletionsCount:E,tournamentId:d,eventId:b},I.filter(N=>!r||!U||T[N.drawId]===C).flatMap(N=>{let{matchUpFormat:A,tieFormat:O,timeItems:k,extensions:F,structures:x,drawName:L,drawType:$,drawId:V}=N,{matchUpFormatCounts:_,matchUpsCount:B,avgConfidence:G,pctNoRating:j,avgWTN:K}=LEe({eventType:w,matchUps:p,drawId:V}),Y=f(k)??M,X=$Ee({extensions:F}),Z=X?.length??0;return m({positionManipulations:X}),o[b].totalPositionManipulations+=Z,o[b].generatedDrawsCount+=1,Z>o[b].maxPositionManipulations&&(o[b].maxPositionManipulations=Z),x?.filter(J=>(J.stageSequence===1||!n)&&[We,xe,Zr,Ui].includes(J.stage)).map(J=>{let ae=[xe,Ui].includes(J.stage)?BEe(p,J.structureId):void 0;J.stage===xe&&a.push({eventName:y,drawName:L,structureId:J.structureId});let te=VEe(ae)?.participant,ne=jEe(te),le=GEe(te),de=dP({participant:le?.[0]??te,eventType:w}),{personId:pe,personOtherId:ge,tennisId:Me,confidence:Pe,wtnRating:Be}=de||{},fe=dP({participant:le?.[1],eventType:w}),{personId:Te,personOtherId:ce,tennisId:ye,confidence:be,wtnRating:Fe}=fe||{},{ageCategoryCode:we,categoryName:Ne,subType:me}=S??{},Ee=J.matchUpFormat??A,Le=(_[Ee]??0)/B*100,{tieFormatName:Q,tieFormatDesc:se}=nP(O),{tieFormatName:oe,tieFormatDesc:ue}=nP(J.tieFormat),ee=se===ue,Se=!ee&&oe,De=J.tieFormat&&!ee&&ue,it=X?.filter(u(J.structureId))?.length??0;return{...c,tournamentId:d,eventId:b,structureId:J.structureId,drawId:V,eventType:w,category:me,categoryName:Ne,ageCategoryCode:we,flightNumber:T?.[V],drawType:$,stage:J.stage,seedingBasis:Y?JSON.stringify(Y):void 0,winningPersonId:pe,winningPersonOtherId:ge,winningPersonTennisId:Me,winningPersonWTNrating:Be,winningPersonWTNconfidence:Pe,winningPerson2Id:Te,winningPerson2OtherId:ce,winningPerson2TennisId:ye,winningPerson2WTNrating:Fe,winningPerson2WTNconfidence:be,winningTeamId:ne,positionManipulations:it,pctNoRating:j,matchUpFormat:Ee,pctInitialMatchUpFormat:Le,matchUpsCount:B,drawTieFormatName:Q,drawTieFormatDesc:se,tieFormatName:Se,tieFormatDesc:De,avgConfidence:G,avgWTN:K}})})});return a.forEach(({eventName:g,drawName:I,structureId:v})=>{s[v]?.length&&l.push({eventName:g,drawName:I,actions:s[v]})}),{eventStructureReports:Object.values(o),structureReports:h,flightReports:l}}function $Ee({extensions:t}){return t?.find(({name:e})=>e===Lg)?.value?.slice(1)}function BEe(t,e){return t.find(i=>i.structureId===e&&i.finishingRound===1&&i.winningSide)}function VEe(t){if(t?.sides)return t.sides.find(e=>e.sideNumber===t.winningSide)}function jEe(t){return t?.participantType===_n?t.participantId:void 0}function GEe(t){return t?.participantType===pt?t.individualParticipants??[]:[]}function HEe({ignoreDisabled:t=!0,tournamentRecords:e,tournamentId:i,venueIds:r=[],dates:n=[]}){if(!Array.isArray(n))return{error:ie,dates:n};if(!Array.isArray(r))return{error:ie,venueIds:r};if(!(e&&Object.keys(e).filter(c=>!i||c===i)||[]).length)return{error:Ci};if(!n.every(Pn))return{error:sr};let a=Cu({tournamentRecords:e,ignoreDisabled:t,dates:n});if(a.error)return a;let s=a?.venues?.filter(({venueId:c})=>!r?.length||r.includes(c)),o=a.courts?.reduce((c,d)=>(d.dateAvailability?.forEach(p=>{let f=p.date;c.includes(f)||c.push(f)}),c),[]).filter(c=>!n.length||n.includes(c)),l={venueIds:s?.map(({venueId:c})=>c)},{matchUps:u}=Eo({afterRecoveryTimes:!0,tournamentRecords:e,matchUpFilters:l});return{venuesReport:s?.map(c=>WEe(o,c,u))}}function WEe(t,e,i){let{venueId:r,courts:n,venueName:a}=e,s={};return t.forEach(o=>{let l=0,u=0,c=0;for(let f of n){let m=f.dateAvailability.find(g=>g.date===o),h=(m&&wv({courtDate:m}).timeSlots)?.reduce((g,I)=>{let{startTime:v,endTime:w}=I,y=Pt(w)-Pt(v);return g+y},0);h&&(c+=1),l+=h}let d=i.filter(({schedule:f})=>f.venueId===r&&tu(o,f.scheduledDate));d.forEach(({schedule:f})=>{let m=ci(f.scheduledTime),h=Xn(m,f.averageMinutes),g=Pt(h)-Pt(m);u+=g});let p=l?(u/l*100).toFixed(2):"100";s[o]={scheduledMatchUpsCount:d.length,availableCourts:c,availableMinutes:l,scheduledMinutes:u,percentUtilization:p}}),{venueId:r,venueName:a,venueReport:s}}var Y_={};ct(Y_,{addCourtGridBooking:()=>BQ,addMatchUpCourtOrder:()=>P_,addMatchUpEndTime:()=>R_,addMatchUpOfficial:()=>lJ,addMatchUpResumeTime:()=>M_,addMatchUpScheduleItems:()=>kC,addMatchUpScheduledDate:()=>NC,addMatchUpScheduledTime:()=>Hd,addMatchUpStartTime:()=>E_,addMatchUpStopTime:()=>C_,addSchedulingProfileRound:()=>G_,allocateTeamMatchUpCourts:()=>AC,assignMatchUpCourt:()=>Ph,assignMatchUpVenue:()=>Uv,bulkRescheduleMatchUps:()=>FQ,bulkScheduleMatchUps:()=>LS,bulkScheduleTournamentMatchUps:()=>Ab,bulkUpdateCourtAssignments:()=>AQ,calculateScheduleTimes:()=>K_,clearMatchUpSchedule:()=>_Q,clearScheduledMatchUps:()=>xC,courtGridRows:()=>gC,findMatchUpFormatTiming:()=>fC,findVenue:()=>Eu,generateBookings:()=>OC,generateVirtualCourts:()=>PC,getMatchUpsToSchedule:()=>pC,getPersonRequests:()=>df,getProfileRounds:()=>hC,getScheduledRoundsDetails:()=>RS,getSchedulingProfile:()=>_c,getSchedulingProfileIssues:()=>W0,matchUpScheduleChange:()=>LQ,modifyMatchUpFormatTiming:()=>c_,mutate:()=>CQ,proAutoSchedule:()=>NQ,proConflicts:()=>OQ,publicFindCourt:()=>rL,query:()=>sX,removeCourtGridBooking:()=>VQ,removeEventMatchUpFormatTiming:()=>UC,removeMatchUpCourtAssignment:()=>MQ,reorderUpcomingMatchUps:()=>xQ,scheduleMatchUps:()=>kQ,scheduleProfileRounds:()=>FC,setMatchUpDailyLimits:()=>$Q,setMatchUpHomeParticipantId:()=>D_,setSchedulingProfile:()=>gv,toggleParticipantCheckInState:()=>RC,validateSchedulingProfile:()=>mC});var CQ={};ct(CQ,{addCourtGridBooking:()=>BQ,addMatchUpCourtOrder:()=>P_,addMatchUpEndTime:()=>R_,addMatchUpOfficial:()=>lJ,addMatchUpResumeTime:()=>M_,addMatchUpScheduleItems:()=>kC,addMatchUpScheduledDate:()=>NC,addMatchUpScheduledTime:()=>Hd,addMatchUpStartTime:()=>E_,addMatchUpStopTime:()=>C_,addSchedulingProfileRound:()=>G_,allocateTeamMatchUpCourts:()=>AC,assignMatchUpCourt:()=>Ph,assignMatchUpVenue:()=>Uv,bulkRescheduleMatchUps:()=>FQ,bulkScheduleMatchUps:()=>LS,bulkScheduleTournamentMatchUps:()=>Ab,bulkUpdateCourtAssignments:()=>AQ,calculateScheduleTimes:()=>K_,clearMatchUpSchedule:()=>_Q,clearScheduledMatchUps:()=>xC,findMatchUpFormatTiming:()=>fC,generateBookings:()=>OC,generateVirtualCourts:()=>PC,matchUpScheduleChange:()=>LQ,modifyMatchUpFormatTiming:()=>c_,proAutoSchedule:()=>NQ,proConflicts:()=>OQ,removeCourtGridBooking:()=>VQ,removeEventMatchUpFormatTiming:()=>UC,removeMatchUpCourtAssignment:()=>MQ,reorderUpcomingMatchUps:()=>xQ,scheduleMatchUps:()=>kQ,scheduleProfileRounds:()=>FC,setMatchUpDailyLimits:()=>$Q,setMatchUpHomeParticipantId:()=>D_,setSchedulingProfile:()=>gv,toggleParticipantCheckInState:()=>RC,validateSchedulingProfile:()=>mC});function K_({calculateStartTimeFromCourts:t=!0,defaultRecoveryMinutes:e=0,averageMatchUpMinutes:i=90,remainingScheduleTimes:r,clearScheduleDates:n,tournamentRecords:a,periodLength:s,scheduleDate:o,startTime:l,venueIds:u,endTime:c}){if(typeof a!="object"||!Object.keys(a).length)return{error:Ci};s=s??EC({recoveryMinutes:e,averageMatchUpMinutes:i});let{courts:d,venues:p}=Cu({dates:[o],ignoreDisabled:!0,tournamentRecords:a}),f=d?.filter(D=>!u||u.includes(D.venueId));l||(l=f?.reduce((D,E)=>{let R=E.dateAvailability?.find(C=>!C.date||tu(o,C.date))?.startTime??E.startTime;return R&&(!D||Pt(R)<Pt(D))?R:D},void 0)),c||(c=f?.reduce((D,E)=>{let R=E.dateAvailability?.find(C=>!C.date||tu(o,C.date))?.endTime??E.endTime;return R&&(!D||Pt(R)>Pt(D))?R:D},void 0));let m=Object.values(a),h=Object.assign({},...m.map(D=>(D.events??[]).map(E=>{let{scheduleTiming:R}=Yw({tournamentRecord:D,event:E});return{[E.eventId]:{event:E,scheduleTiming:R}}})).flat()),g=NS({sortDateMatchUps:!1,tournamentRecords:a,matchUpFilters:{scheduledDate:o,venueIds:u}}),I=g?.dateMatchUps??[],v=g?.completedMatchUps??[],w=[];w.push(...I),w.push(...v);let y={averageTimes:[{minutes:{default:i}}],recoveryTimes:[{minutes:{default:e}}]},b=w?.map(({eventId:D,schedule:E,matchUpFormat:R})=>{let{event:C,scheduleTiming:M}=h[D],N=C?.eventType,A={...M,defaultTiming:y,matchUpFormat:R},{averageMinutes:O,recoveryMinutes:k}=PR({eventType:N,timingDetails:A}),{courtId:F,venueId:x}=E,L=ci(E.scheduledTime),$=Xn(L,O);return{recoveryMinutes:k,averageMinutes:O,periodLength:s,startTime:L,endTime:$,courtId:F,venueId:x}}),S={calculateStartTimeFromCourts:t,remainingScheduleTimes:r,averageMatchUpMinutes:i,date:o,clearScheduleDates:n,periodLength:s,startTime:l,endTime:c,bookings:b,courts:f},{scheduleTimes:U}=y_(S),T=u?.length===1&&u[0]||p?.length===1&&p[0].venueId||void 0,P=w.map(Ir);return{venueId:T,scheduleTimes:U,dateScheduledMatchUpIds:P}}function MQ(t){let e=Ge(t,[{[cn]:!0}]);if(e.error)return e;let{removePriorValues:i,tournamentRecords:r,tournamentId:n,courtDayDate:a,matchUpId:s,courtId:o,drawId:l}=t,u=r[n];if(!u)return{error:Ie};let{drawDefinition:c,event:d}=Gd({tournamentRecord:u,drawId:l});if(!c)return{error:_e};let p=di({drawDefinition:c,event:d,matchUpId:s});if(p.error)return p;if(p?.matchUp?.matchUpType===ka){let{itemValue:f}=lf({timeItems:p.matchUp.timeItems??[],itemType:lu}),m=o&&f.filter(h=>h.courtId!==o);return wa({duplicateValues:!1,removePriorValues:i,tournamentRecord:u,drawDefinition:c,matchUpId:s,timeItem:{itemType:lu,itemValue:m}})}else return Ph({tournamentRecord:u,drawDefinition:c,courtDayDate:a,courtId:"",matchUpId:s})}function NQ({scheduleCompletedMatchUps:t,minCourtGridRows:e=10,tournamentRecords:i,scheduledDate:r,matchUps:n}){if(!Ga(n))return{error:ie};if(n.some(({hasContext:m})=>!m))return{info:"matchUps must have { inContext: true, nextMatchUps: true }",error:jE};let a=NS({courtCompletedMatchUps:!0,withCourtGridRows:!0,minCourtGridRows:e,tournamentRecords:i,matchUpFilters:{localPerspective:!0,scheduledDate:r}});if(a.error)return a;let{rows:s}=a,o=[],l=m=>[(m.sides||[]).map(h=>[h.participantId,h.participant?.individualParticipantIds]),(m.potentialParticipants||[]).flat().map(h=>[h.participantId,h.individualParticipantIds])].flat(1/0).filter(Boolean),u=s?.reduce((m,h)=>{let g=[],I=[];Object.values(h).forEach(w=>{if(bt(w)&&(w.matchUpId&&(g.push(w.matchUpId),o.push(w)),w.sides)){let y=l(w);I.push(...y)}});let v=Object.values(h).filter(w=>bt(w)&&!w.matchUpId&&!w.isBlocked);return m.concat({matchUpIds:g,availableCourts:v,rowId:h.rowId,participantIds:I})},[]);n.filter(({matchUpStatus:m})=>m&&m!=="BYE"&&(t||!Yi.includes(m))).sort(hh);let c=oo({matchUps:n.concat(o),includeParticipantDependencies:!0,tournamentRecords:i}).matchUpDependencies,d=[],p=[];for(;n.length&&u.length;){let m=u.shift(),h=[];for(;n.length&&m.availableCourts.length;){let g=n.concat(h).map(P=>P.matchUpId),I=n.shift(),v=I?.matchUpId,w=v&&c[v].matchUpIds.concat(c[v].dependentMatchUpIds),y=v&&g.some(P=>c[v].matchUpIds.includes(P)),b=v&&p.some(P=>c[v].dependentMatchUpIds.includes(P)),S=m.matchUpIds.some(P=>w.includes(P)),U=l(I),T=m.participantIds.some(P=>U.includes(P));if(I&&!S&&!y&&!T&&!b){let P=m.availableCourts.shift();Object.assign(I.schedule,P.schedule),Object.assign(P,I),d.push(I),m.participantIds.push(...U),m.matchUpIds.push(v)}else I&&h.push(I)}n.push(...h),p.push(...m.matchUpIds)}let f=d.map(({matchUpId:m,tournamentId:h,schedule:g,drawId:I})=>({tournamentId:h,matchUpId:m,drawId:I,schedule:{...g,scheduledDate:r}}));return a=LS({tournamentRecords:i,matchUpDetails:f}),{...a,scheduled:d,notScheduled:n}}function AQ(t){let{courtDayDate:e}=t,i=Ge(t,[{courtAssignments:!0,[zn]:an,[Fa]:Xe},{[cn]:!0}]);if(i.error)return i;let r=t.courtAssignments.reduce((a,s)=>{let{tournamentId:o}=s;return a[o]||(a[o]=[]),a[o].push(s),a},{}),n;return Object.keys(r).every(a=>{let s=t[cn][a];if(!s)return n={error:Ie},!1;let o=r[a].reduce((l,u)=>{let{drawId:c}=u;return l[c]||(l[c]=[]),l[c].push(u),l},{});Object.keys(o).every(l=>{let{drawDefinition:u}=jn({tournamentRecord:s,drawId:l});return u?(o[l].every(c=>{let{matchUpId:d,courtId:p}=c,f=Ph({tournamentRecord:s,drawDefinition:u,courtDayDate:e,matchUpId:d,courtId:p});if(f.success)return f?.success;n={error:r4}}),!0):(n={error:_e},!1)})}),n||H}function kQ(t){let{tournamentRecords:e,allDateMatchUpIds:i=[],averageMatchUpMinutes:r=90,recoveryMinutes:n=0,recoveryMinutesMap:a,matchUpPotentialParticipantIds:s={},individualParticipantProfiles:o={},matchUpNotBeforeTimes:l={},matchUpDailyLimits:u={},checkPotentialRequestConflicts:c=!0,remainingScheduleTimes:d,clearScheduleDates:p,periodLength:f=30,scheduleDate:m,matchUpIds:h,venueIds:g,startTime:I,endTime:v,dryRun:w}=t,y=Ge(t,[{[cn]:!0,[$w]:!0},{[Wr]:Pn,[Fa]:sr,[sge]:!0},{[Wr]:B=>!B||!isNaN(B),[cge]:!1,[Fa]:ie,[dge]:!1,[pge]:!1}]);if(y.error)return y;let b=t.competitionMatchUps??Eo({nextMatchUps:!0,tournamentRecords:e}).matchUps??[],S=t.matchUpDependencies??oo({includeParticipantDependencies:!0,matchUps:b,tournamentRecords:e}).matchUpDependencies;b.forEach(B=>{B.schedule?.scheduledDate&&tu(m,Qe(B.schedule.scheduledDate))&&cI({matchUpPotentialParticipantIds:s,matchUpNotBeforeTimes:l,matchUp:B})});let U=h.map(B=>b.find(G=>G.matchUpId===B)).filter(Boolean),{venueId:T,scheduleTimes:P,dateScheduledMatchUpIds:D}=K_({tournamentRecords:e,remainingScheduleTimes:d,startTime:ci(I),endTime:ci(v),scheduleDate:Qe(m),averageMatchUpMinutes:r,clearScheduleDates:p,periodLength:f,venueIds:g}),E={},R=[],C={},M={},N={};b.filter(({matchUpId:B})=>D?.includes(B)).forEach(B=>{LO({matchUpPotentialParticipantIds:s,individualParticipantProfiles:o,matchUp:B,value:1});let G=B.schedule?.scheduledTime;if(G){C[B.matchUpId]=G;let j=a?.[B.matchUpId];Nb({recoveryMinutes:j||n,matchUpPotentialParticipantIds:s,individualParticipantProfiles:o,matchUpNotBeforeTimes:l,averageMatchUpMinutes:r,matchUpDependencies:S,scheduleTime:G,matchUp:B})}});let A=U.filter(B=>{let G=D?.includes(B.matchUpId),j=["BYE",Qt,ki,us,$r,mi].includes(B?.matchUpStatus);return!G&&!B.winningSide&&!j}),{matchUpMap:O,overLimitMatchUpIds:k,participantIdsAtLimit:F}=A.reduce((B,G)=>{let{drawId:j,tournamentId:K,matchUpType:Y}=G,{participantIdsAtLimit:X,relevantParticipantIds:Z}=$_({individualParticipantProfiles:o,matchUpPotentialParticipantIds:s,matchUpDailyLimits:u,matchUp:G});return X?.length?(B.overLimitMatchUpIds.push(G.matchUpId),B.participantIdsAtLimit.push(...X),B):(Z.forEach(J=>{xS({individualParticipantProfiles:o,participantId:J});let ae=o[J].counters;ae[Y]?ae[Y]+=1:ae[Y]=1,ae[Ls]?ae[Ls]+=1:ae[Ls]=1}),B.matchUpMap[K]||(B.matchUpMap[K]={}),B.matchUpMap[K][j]?B.matchUpMap[K][j].push(G):B.matchUpMap[K][j]=[G],cI({matchUpPotentialParticipantIds:s,matchUpNotBeforeTimes:l,matchUp:G}),B)},{matchUpMap:{},overLimitMatchUpIds:[],participantIdsAtLimit:[]});A=A.filter(({matchUpId:B})=>!k.includes(B));let x=0,L=P?.length??0,{personRequests:$}=df({tournamentRecords:e,requestType:FS});for(;P?.length&&A.length&&x<=L;){x++;let{scheduleTime:B}=P.shift(),G=A.find(j=>{let{matchUpId:K}=j,{dependenciesScheduled:Y,remainingDependencies:X}=F_({matchUpScheduleTimes:C,matchUpDependencies:S,allDateMatchUpIds:i,matchUp:j});if(!Y)return N[K]||(N[K]=[]),N[K].push({scheduleTime:B,remainingDependencies:X}),!1;let{enoughTime:Z}=__({individualParticipantProfiles:o,matchUpNotBeforeTimes:l,matchUpDependencies:S,scheduleTime:B,matchUp:j});if(!Z)return M[K]||(M[K]=[]),M[K].push({scheduleTime:B}),!1;let{conflicts:J}=L_({potentials:c,averageMatchUpMinutes:r,requestConflicts:E,personRequests:$,scheduleTime:B,scheduleDate:m,matchUp:j});if(J?.length)return!1;let ae=a?.[j.matchUpId];return Nb({recoveryMinutes:ae||n,matchUpPotentialParticipantIds:s,individualParticipantProfiles:o,matchUpNotBeforeTimes:l,averageMatchUpMinutes:r,matchUpDependencies:S,scheduleTime:B,matchUp:j}),C[j.matchUpId]=B,!0});A=A.filter(({matchUpId:j})=>j!==G?.matchUpId),G||R.push(B)}A.forEach(B=>{LO({individualParticipantProfiles:o,matchUpPotentialParticipantIds:s,value:-1,matchUp:B})});let V=[];Object.keys(O).forEach(B=>{let G=e[B];G&&Object.keys(O[B]).forEach(j=>{let{drawDefinition:K}=Gd({tournamentRecord:G,drawId:j});K&&O[B][j].forEach(({matchUpId:Y})=>{let X=C[Y];if(X){let Z=X.split(":").map(rs).join(":"),J=`${Qe(m)}T${Z}`;w?V.push(Y):(Hd({drawDefinition:K,matchUpId:Y,scheduledTime:J}).success&&V.push(Y),T&&Uv({tournamentRecords:e,tournamentRecord:G,drawDefinition:K,matchUpId:Y,venueId:T}))}})})});let _=EF(A);return{...H,requestConflicts:Object.values(E),remainingScheduleTimes:P?.map(({scheduleTime:B})=>B),individualParticipantProfiles:o,matchUpNotBeforeTimes:l,participantIdsAtLimit:F,skippedScheduleTimes:R,overLimitMatchUpIds:k,scheduledMatchUpIds:V,noTimeMatchUpIds:_,recoveryTimeDeferred:M,dependencyDeferred:N}}function OQ({useDeepDependencies:t=!1,tournamentRecords:e,matchUps:i}){if(!Ga(i))return{error:Tu};if(i.some(({matchUpId:b,hasContext:S})=>b&&!S))return{info:"matchUps must have { inContext: true, nextMatchUps: true }",error:jE};let r=Math.max(...i.map(({schedule:b})=>b?.courtOrder||1).map(b=>Ye(b))),n=Re(1,r+1).map(b=>i.filter(S=>Ye(S.schedule?.courtOrder)===b)),a={},s={},o={};n.flat().filter(Boolean).sort(hh).forEach(({schedule:b})=>delete b[KT]);let l=rt(i.map(({drawId:b})=>b)),u=oo({includeParticipantDependencies:!0,tournamentRecords:e,drawIds:l}),c=u.matchUpDependencies,d=t?u.positionDependencies??{}:{},p=n.map((b,S)=>b.reduce((U,T)=>{if(!T.matchUpId)return U;let{matchUpId:P,winnerMatchUpId:D,loserMatchUpId:E,schedule:R,sides:C,potentialParticipants:M}=T,N=R?.courtId;a[P]=S,s[N]=[],U.matchUpIds.push(P),o[P]=T;let A=c[P].matchUpIds;A.length&&U.sourceMatchUpIds.push(...A);let O=C?.flatMap(F=>[F.participant?.individualParticipantIds,F.participantId]).flat().filter(Boolean)??[],k=M?.flat().flatMap(({individualParticipantIds:F,participantId:x})=>[F,x]).flat().filter(Boolean)||[];return U.participantIds.push(...k,...O),D&&U.targetMatchUpIds.push(D),E&&U.targetMatchUpIds.push(E),U},{sourceMatchUpIds:[],targetMatchUpIds:[],participantIds:[],matchUpIds:[]})),f=(b,S)=>c[b].sources.reduce((U,T,P)=>T.includes(S)&&P+1||U,0),m=p.map(()=>[]),h=(b,S,U)=>{U[b]||(U[b]={}),U[b][kl]||(U[b][kl]=S.filter(T=>T!==b))},g=(b,S,U)=>{S.participantIds.filter(T=>b.participantIds.includes(T)).forEach(T=>{let P=S.matchUpIds.concat(b.matchUpIds).filter(D=>c[D].participantIds.includes(T));P.forEach(D=>{h(D,P,U)})})},I=(b,S,U)=>{U[b]||(U[b]={}),U[b][Al]||(U[b][Al]=S.filter(T=>T!==b))},v=b=>{let S={},U=va(b.participantIds),T=new Set(Object.keys(U).filter(D=>U[D]>1)),P=b.matchUpIds.filter(D=>c[D].participantIds.some(E=>T.has(E)));return P.forEach(D=>{I(D,P,S)}),S},w=b=>{let S={},U={};return b.forEach(T=>{let{matchUpId:P,schedule:D}=T;if(!P||!D?.courtId||!D?.scheduledDate)return;let E=`${D.courtId}|${D.scheduledDate}`;U[E]||(U[E]=[]),U[E].push(P)}),Object.values(U).forEach(T=>{T.length>1&&T.forEach(P=>{S[P]=T.filter(D=>D!==P)})}),S},y=(b,S,U,T)=>{if(!o[b].schedule[KT]){o[b].schedule[KT]=S,o[b].schedule[LK]=T,m[a[b]].push({matchUpId:b,issueType:U,issueIds:T,issue:S});let P=o[b].schedule.courtId;s[P]||(s[P]=[]),s[P].push({matchUpId:b,issue:S,issueType:U,issueIds:T})}};if(p.forEach((b,S)=>{let U=S?p[S-1]:void 0,T=p.slice(S+1),P=v(b),D=w(n[S].filter(E=>b.matchUpIds.includes(E.matchUpId)));U&&g(U,b,P),b.matchUpIds.forEach(E=>{let R=c[E].matchUpIds;for(let M of T){let N=M.matchUpIds.filter(A=>R.includes(A));N?.length&&(N.forEach(A=>y(A,by,Za,[E])),y(E,by,Za,N))}if(D[E]&&y(E,Al,xK,D[E]),P[E]?.[Al]&&y(E,Al,cO,P[E][Al]),b.sourceMatchUpIds.includes(E)){let M=b.matchUpIds.filter(N=>c[N].matchUpIds.includes(E));y(E,Al,Za,M),b.matchUpIds.filter(N=>c[N].matchUpIds.includes(E)).forEach(N=>y(N,Al,Za,[E]))}let C=U?.matchUpIds?.filter(M=>f(E,M)>1);if(C?.length&&(y(E,wy,Za,C),C.forEach(M=>y(M,wy,Za,[E]))),P[E]?.[kl]&&y(E,kl,cO,P[E][kl]),U?.targetMatchUpIds?.includes(E)){let M=o[E].schedule.courtId,N=R.filter(A=>U.matchUpIds.includes(A));N.some(A=>o[A].schedule.courtId===M)||(N.forEach(A=>y(A,kl,Za,[E])),y(E,kl,Za,N))}})}),t){let b=new Set(Object.keys(a)),S={};for(let P of b)S[P]=new Set(c[P]?.dependentMatchUpIds??[]);let U=0;for(let P of b){let D=c[P]?.sources?.length??0;D>U&&(U=D)}let T=P=>{let D=new Set(P.participantIds),E={};for(let R of P.matchUpIds){let C=c[R]?.participantIds??[];for(let M of C)D.has(M)||(E[M]||(E[M]=new Set),E[M].add(R))}return E};if(p.forEach((P,D)=>{let E=T(P);for(let[,R]of Object.entries(E))if(R.size>1){let C=[...R];for(let M of C)y(M,kl,dO,C.filter(N=>N!==M))}if(D>0){let R=p[D-1],C=T(R);for(let[M,N]of Object.entries(E))if(C[M]){let A=[...new Set([...N,...C[M]])];for(let O of A)y(O,kl,dO,A.filter(k=>k!==O))}}}),p.forEach((P,D)=>{for(let E of P.matchUpIds)for(let R=2;R<=Math.min(D,U);R++){let C=p[D-R];for(let M of C.matchUpIds){let N=f(E,M);N>0&&R<N&&(y(E,wy,Za,[M]),y(M,wy,Za,[E]))}}}),p.forEach((P,D)=>{for(let E of P.matchUpIds){let R=S[E];if(!R?.size)continue;for(let M=0;M<D;M++){let N=p[M].matchUpIds.filter(A=>R.has(A));if(N.length){for(let A of N)y(A,by,Za,[E]);y(E,by,Za,N)}}let C=P.matchUpIds.filter(M=>M!==E&&R.has(M));if(C.length){for(let M of C)y(M,Al,Za,[E]);y(E,Al,Za,C)}}}),Object.keys(d).length){let P=new Set(Object.values(d).flat());p.forEach(D=>{for(let E of D.matchUpIds){let R=(c[E]?.matchUpIds??[]).filter(C=>P.has(C)).filter(C=>!b.has(C));R.length&&y(E,kl,FK,R)}})}}return{courtIssues:s,rowIssues:m}}function xQ(t){let e="reorderUpcomingMatchUps",{tournamentRecords:i}=t;if(typeof i!="object"||!Object.keys(i).length)return z({result:{error:Ci},stack:e});let{matchUpsContextIds:r,firstToLast:n}=t;if(!r)return z({result:{error:Xe},stack:e});let a=r?.length;if(!a)return{...H};let s=0;return r.forEach((l,u)=>{let{tournamentId:c,drawId:d,matchUpId:p}=l,f=u+(n?-1:1);f<0&&(f=a-1),f===a&&(f=0);let m=r[f].schedule.scheduledTime,h=o({tournamentId:c,scheduledTime:m,matchUpId:p,drawId:d});if(h.success)s++;else return h}),s===a?H:z({result:{error:i4},stack:e});function o({tournamentId:l,scheduledTime:u,matchUpId:c,drawId:d}){let p=i[l],{drawDefinition:f}=Gd({tournamentRecord:p,drawId:d});return f?Hd({drawDefinition:f,scheduledTime:u,matchUpId:c}):{error:Oa}}}function FQ(t){let{scheduleChange:e,matchUpIds:i,dryRun:r}=t;if(!i||!Array.isArray(i))return{error:eh};if(typeof e!="object")return{error:ie};let n=Is(t),a=[],s=[];for(let l of Object.values(n)){let u=zEe({tournamentRecord:l,scheduleChange:e,matchUpIds:i,dryRun:r});if(u.error)return u;Array.isArray(u.notRescheduled)&&s.push(...u.notRescheduled);let c=EF(u.notRescheduled),d=[];u.rescheduled?.forEach(p=>{let{matchUpId:f}=p;c.includes(f)&&d.push(f),a.push(p)}),d.length&&(s=u?.notRescheduled?.filter(({matchUpId:p})=>!d.includes(p))||[])}let o=!!(a.length&&!s.length);return{...H,rescheduled:a,notRescheduled:s,allRescheduled:o}}function zEe({tournamentRecord:t,scheduleChange:e,matchUpIds:i,dryRun:r}){if(!t)return{error:Ie};if(!i||!Array.isArray(i))return{error:eh};if(typeof e!="object")return{error:ie};let n=[],a=[],{minutesChange:s,daysChange:o}=e;if(!s&&!o)return{...H};if(s&&isNaN(s))return{error:ie};if(o&&isNaN(o))return{error:ie};let{matchUps:l}=br({matchUpFilters:{matchUpIds:i},tournamentRecord:t}),u=({matchUpStatus:y})=>!Yi.includes(y),c=l?.filter(y=>MS({schedule:y.schedule})).filter(y=>u({matchUpStatus:y.matchUpStatus}));if(!c?.length)return{...H};let{tournamentInfo:d}=Uh({tournamentRecord:t}),{startDate:p,endDate:f}=d,m=c?.reduce((y,b)=>{let{matchUpId:S,drawId:U}=b;return y[U]?y[U].push(S):y[U]=[S],y},{}),h=1440;for(let y of Object.keys(m)){let b=Gd({tournamentRecord:t,drawId:y});if(b.error)return b;let S=b.drawDefinition,U=m[y].filter(T=>i.includes(T));for(let T of U)if(T&&S){let P=c.find(N=>N.matchUpId===T)?.schedule,{scheduledTime:D,scheduledDate:E}=P,R,C,M;if(!R&&o&&E){let N=Qe(E);M=yy(N,o),R=new Date(M)<new Date(p)||new Date(M)>new Date(f)}if(s&&D){let N=Qe(D),A=Pt(ci(D))+s;if(R=A<0||A>h,!R){let O=Xn(D,s),k=N&&M||E===N&&N;C=k?`${k}T${O}`:O}}if(R)a.push(T);else{if(!r){if(C){let N=Hd({scheduledTime:C,drawDefinition:S,matchUpId:T});if(N.error)return N}if(M){let N=NC({scheduledDate:M,drawDefinition:S,matchUpId:T});if(N.error)return N}}(C||M)&&n.push(T)}}}let g=br({matchUpFilters:{matchUpIds:i},tournamentRecord:t}).matchUps??[],I=g.filter(({matchUpId:y})=>n.includes(y)),v=g.filter(({matchUpId:y})=>a.includes(y)),w=I.length&&!v.length;return{...H,rescheduled:I,notRescheduled:v,allRescheduled:w}}function LQ(t){let e="matchUpScheduleChange",{tournamentRecords:i}=t;if(typeof i!="object"||!Object.keys(i).length)return{error:Ci};let{sourceMatchUpContextIds:r,targetMatchUpContextIds:n,sourceCourtId:a,targetCourtId:s,courtDayDate:o}=t||{},{drawId:l,matchUpId:u,tournamentId:c}=r||{},{drawId:d,matchUpId:p,tournamentId:f}=n||{};if(!u&&!p)return z({result:{error:Xe},stack:e});let{matchUps:m}=Eo({matchUpFilters:{matchUpIds:[u,p].filter(Boolean),drawIds:[l,d].filter(Boolean)},tournamentRecords:t.tournamentRecords}),h=m?.find(({matchUpId:y})=>y===u),g=m?.find(({matchUpId:y})=>y===p),I=0;if(s&&u&&!p){let y=v({tournamentId:c,matchUpId:u,courtId:s,matchUp:h,drawId:l,tournamentRecords:i,sourceCourtId:a,courtDayDate:o});if(y?.success&&I++,y.error)return z({result:y,stack:e})}else if(a&&s&&u&&p){let y=v({tournamentId:c,matchUpId:u,courtId:s,matchUp:h,drawId:l,tournamentRecords:i,sourceCourtId:a,courtDayDate:o});if(y.success&&I++,y.error)return z({result:y,stack:e,info:"source"});let b=v({tournamentId:f,sourceCourtId:s,matchUpId:p,matchUp:g,courtId:a,drawId:d,tournamentRecords:i,courtDayDate:o});if(b.success&&I++,b.error)return z({result:b,stack:e,info:"target"})}else return{error:Xe};return I?H:z({result:{error:QI},stack:e});function v(y){let{tournamentRecords:b,tournamentId:S,matchUp:U,drawId:T}=y,P=b[S],{drawDefinition:D}=Gd({tournamentRecord:P,drawId:T});return U.matchUpType===Zt?w({...y,tournamentRecord:P,drawDefinition:D}):Ph({...y,tournamentRecord:P,drawDefinition:D})}function w({removePriorValues:y,tournamentRecords:b,tournamentRecord:S,drawDefinition:U,sourceCourtId:T,courtDayDate:P,matchUpId:D,matchUp:E,courtId:R}){let C=[R].concat(E.schedule.allocatedCourts.map(({courtId:M})=>M).filter(M=>M!==T));return AC({removePriorValues:y,tournamentRecords:b,tournamentRecord:S,drawDefinition:U,courtDayDate:P,matchUpId:D,courtIds:C})}}function _Q({scheduleAttributes:t=[lu,Id,dh,ph,fh,mo,hc,Gl,Qu],tournamentRecord:e,drawDefinition:i,matchUpId:r}){let n="clearMatchUpSchedule",a=i?Rn({matchUpFilters:{matchUpIds:[r]},inContext:!1,drawDefinition:i}).matchUps?.[0]:br({matchUpFilters:{matchUpIds:[r]},tournamentRecord:e,inContext:!1}).matchUps?.[0];if(!a)return{error:un};let s=(a.timeItems??[]).filter(o=>o?.itemType&&!t.includes(o?.itemType));return a.timeItems=s,St({tournamentId:e.tournamentId,context:n,drawDefinition:i,matchUp:a}),{...H}}function $Q(t){let{tournamentRecord:e,tournamentId:i,dailyLimits:r}=t,n=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(typeof n!="object"||!Object.keys(n).length)return{error:Ci};if(typeof r!="object")return{error:Nc};let a=Object.keys(n).filter(s=>!i||i===s);if(i&&!a.includes(i))return{error:ie};for(let s of a){let o=n[s],l=xt({extension:{name:jw,value:{dailyLimits:r}},element:o});if(l.error)return l}return{...H}}function BQ(t){let{tournamentRecord:e,disableNotice:i,scheduledDate:r,bookingType:n,courtOrder:a,rowCount:s=1,courtId:o,notes:l}=t;if(!e)return z({result:{error:ie},info:"tournamentRecord is required"});if(!o)return{error:nc};if(!r)return z({result:{error:ie},info:"scheduledDate is required"});if(!n)return z({result:{error:ie},info:"bookingType is required"});if(a==null)return z({result:{error:ie},info:"courtOrder is required"});if(!Number.isInteger(a)||a<1)return z({result:{error:ie},info:"courtOrder must be a positive integer"});if(!Number.isInteger(s)||s<1)return z({result:{error:ie},info:"rowCount must be a positive integer"});let{court:u,venue:c}=jd({tournamentRecord:e,courtId:o});if(!u)return{error:nc};if(!bd({court:u,date:r})){u.dateAvailability||(u.dateAvailability=[]);let f={date:r,bookings:[]};u.dateAvailability.push(f)}let d=bd({court:u,date:r});if(d.bookings){for(let f of d.bookings)if(typeof f.courtOrder=="number"){let m=f.courtOrder,h=m+(f.rowCount||1)-1,g=a,I=a+s-1;if(g<=h&&I>=m)return z({result:{error:K6},info:`Booking conflicts with existing booking at rows ${m}-${h}`})}}let p={courtOrder:a,rowCount:s,bookingType:n,notes:l,createdAt:new Date().toISOString()};return d.bookings||(d.bookings=[]),d.bookings.push(p),!i&&c&&at({payload:{venue:c,tournamentId:e.tournamentId},topic:Oc,key:c.venueId}),{...H,booking:p}}function VQ(t){let{tournamentRecord:e,disableNotice:i,scheduledDate:r,courtOrder:n,courtId:a}=t;if(!e)return z({result:{error:ie},info:"tournamentRecord is required"});if(!a)return{error:nc};if(!r)return z({result:{error:ie},info:"scheduledDate is required"});if(n==null)return z({result:{error:ie},info:"courtOrder is required"});let{court:s,venue:o}=jd({tournamentRecord:e,courtId:a});if(!s)return{error:nc};let l=bd({court:s,date:r});if(!l?.bookings)return z({result:{error:Xk},info:"No bookings found for this date"});let u=l.bookings.findIndex(d=>d.courtOrder===n);if(u===-1)return z({result:{error:Xk},info:`No booking found at row ${n}`});let c=l.bookings.splice(u,1)[0];return!i&&o&&at({payload:{venue:o,tournamentId:e.tournamentId},topic:Oc,key:o.venueId}),{...H,booking:c}}var jQ={};ct(jQ,{addCollectionDefinition:()=>Q_,addCollectionGroup:()=>YQ,aggregateTieFormats:()=>XQ,compareTieFormats:()=>gc,getTieFormat:()=>dC,modifyCollectionDefinition:()=>X_,modifyTieFormat:()=>KQ,mutate:()=>GQ,orderCollectionDefinitions:()=>zQ,query:()=>rX,removeCollectionDefinition:()=>J_,removeCollectionGroup:()=>WQ,tieFormatGenderValidityCheck:()=>JE,validateCollectionDefinition:()=>xw});var GQ={};ct(GQ,{addCollectionDefinition:()=>Q_,addCollectionGroup:()=>YQ,aggregateTieFormats:()=>XQ,modifyCollectionDefinition:()=>X_,modifyTieFormat:()=>KQ,orderCollectionDefinitions:()=>zQ,removeCollectionDefinition:()=>J_,removeCollectionGroup:()=>WQ});function xp({drawDefinition:t,structureId:e,matchUpId:i,structure:r,matchUp:n,eventId:a,event:s}){let o="getTieFormat",l;if(e=r?.structureId??e,i=n?.matchUpId??i,(i||e)&&!t)return{error:_e};if(a&&s)l=$o(s);else if(i){if(t&&(!n||!r)){let u=di({drawDefinition:t,matchUpId:i});if(u.error)return u;if(u.matchUp?.matchUpType!==ka)return z({result:{error:ta},stack:o});r||(r=u.structure),n||(n=u.matchUp)}l=ky({item:n,drawDefinition:t,structure:r,event:s})||ky({item:r,drawDefinition:t,structure:r,event:s})||$o(t)||$o(s)}else if(t&&e){if(!r){let u=et({drawDefinition:t,structureId:e});if(u.error)return u;r=u?.structure}l=ky({item:r,drawDefinition:t,structure:r,event:s})||$o(t)||$o(s)}else l=$o(t)||$o(s);return l?{...H,structure:r,tieFormat:l,matchUp:n}:z({result:{error:XI},stack:o})}function pP({matchUp:t,updateInProgressMatchUps:e}){return!t.winningSide&&![Yi].includes(t.matchUpStatus)&&(e||t.matchUpStatus!==ao&&!cr(t))}function FA({from:t,to:e}){let i=Object.keys(t),r=xi(i,Object.keys(e)).length===i.length,n=i.filter(s=>t[s]!==e[s]).map(s=>({countChange:e[s]-t[s],collectionId:s})),a=i.every(s=>t[s]===e[s]);return{equivalent:r&&a,matchUpsCountChanges:n}}function qEe({updateInProgressMatchUps:t,tournamentRecord:e,drawDefinition:i,structure:r,tieFormat:n,eventId:a,matchUp:s,event:o,uuids:l}){let u="updateTieFormat",c=e?.tournamentId,d=0,p=0,f=0,m=0,h=n?.collectionDefinitions.reduce((S,U)=>(S[U.collectionId]=(S[U.collectionId]||0)+U.matchUpCount,S),{}),g=({tieFormat:S})=>{let U=S?.collectionDefinitions.reduce((T,P)=>(T[P.collectionId]=(T[P.collectionId]||0)+P.matchUpCount,T),{});return FA({from:U,to:h}).equivalent},I=xp({drawDefinition:i})?.tieFormat,v=xp({event:o})?.tieFormat;if(o&&a){for(let S of o.drawDefinitions??[])w({drawDefinition:S});o.tieFormat=jr(n),m+=1}else if(s){if(!s.tieMatchUps)return z({result:{error:ta},stack:u});let S=va(s.tieMatchUps?.map(({collectionId:E})=>E)),U=FA({to:h,from:S}),{changes:T,changesArePossible:P,cannotChangeReaon:D}=AW({matchUp:s,check:U});if(U.equivalent)if(pP({matchUp:s,updateInProgressMatchUps:t}))s.tieFormat=jr(n),m+=1;else return z({result:{error:L1},info:"matchUp is IN_PROGRESS or COMPLETE",stack:u});else if(P)b({tieFormat:n,matchUp:s,changes:T,uuids:l});else return z({context:{collectionMap:h,matchUpMap:S},result:{error:Vl},info:D||"specified changes not possible",stack:u});p+=1,St({eventId:o?.eventId,context:u,drawDefinition:i,tournamentId:c,matchUp:s})}else if(r){let S=y({inheritedTieFormat:I??v,structure:r})?.modifiedMatchUpsCount;S&&(p+=S,d+=1,m+=1);let U=!r.tieFormat||gc({ancestor:r.tieFormat,descendant:n}).different;U&&(r.tieFormat=jr(n),d+=1,m+=1),(S||U)&&i&&ti({structureIds:[r.structureId],eventId:o?.eventId,drawDefinition:i})}else if(i)w({drawDefinition:i}),i.tieFormat=jr(n),m+=1;else return{error:_e};return{modifiedStructuresCount:d,modifiedMatchUpsCount:p,addedMatchUpsCount:f,modifiedCount:m,...H,tieFormat:n};function w({drawDefinition:S}){let U=S.structures||[],T=[];for(let P of U){if(P.tieFormat)continue;let D=y({inheritedTieFormat:v,structure:P})?.modifiedMatchUpsCount;if(D){d+=1,p+=D;let E=P.structureId;T.push(E)}}return ti({structureIds:T,eventId:o?.eventId,drawDefinition:S}),T.length}function y({inheritedTieFormat:S,structure:U}){let T=0,P=Nt({matchUpFilters:{matchUpTypes:[Zt]},structure:U})?.matchUps||[];for(let D of P){let E=pP({matchUp:D,updateInProgressMatchUps:t}),R=!1,C=va(D.tieMatchUps?.map(({collectionId:N})=>N)),M=FA({from:C,to:h});if(M.equivalent)D.tieFormat&&g(D)&&E&&(D.tieFormat=jr(n),R=!0);else{let{changes:N,changesArePossible:A}=AW({matchUp:D,check:M});if(A&&!D.tieFormat)b({changes:N,matchUp:D,tieFormat:n,uuids:l});else if(S)(!D.tieFormat||gc({ancestor:S,descendant:D.tieFormat}).different)&&(D.tieFormat=S,R=!0);else return z({result:{error:XI},stack:u})}R&&(T+=1,St({tournamentId:e?.tournamentId,drawDefinition:i,context:u,eventId:a,matchUp:D}))}return{modifiedMatchUpsCount:T}}function b({uuids:S,matchUp:U,tieFormat:T,changes:P}){U.tieFormat=jr(T);let D=[],E=[];return P.forEach(R=>{if(R.countChange>0){let C=Math.max(0,...U.tieMatchUps.filter(A=>A.collectionId===R.collectionId).map(ba("collectionPosition"))),M=T.collectionDefinitions.find(A=>A.collectionId===R.collectionId),N=IS({matchUpsLimit:R.countChange,collectionPositionOffset:C,collectionDefinition:M,matchUp:U,uuids:S});E.push(...ke(N,!1,!0)),f+=E.length,U.tieMatchUps.push(...N)}else{let C=R.toBePlayedTieMatchUpIds.slice(0,Math.abs(R.countChange));console.log("remove",C.length),D.push(...C),U.tieMatchUps=U.tieMatchUps.filter(({matchUpId:M})=>!C.includes(M))}}),E.length&&hd({matchUps:E,drawDefinition:i,tournamentId:c,eventId:a}),D.length&&Pu({matchUpIds:D,action:"updateTieFormat",drawDefinition:i,tournamentId:c,eventId:a}),{matchUpIdsRemoved:D,matchUpsAdded:E}}}function AW({check:t,matchUp:e}){let i="",r=[];return{changesArePossible:t.matchUpsCountChanges.every(({collectionId:n,countChange:a})=>{let s=e.tieMatchUps.filter(l=>l.collectionId===n&&l.matchUpStatus===Fi).map(ba("matchUpId")),o=s.length+a>=0||a>0;return!o&&a<0&&(i="Insufficient TO_BE_PLAYED matchUps"),r.push({toBePlayedTieMatchUpIds:s,collectionId:n,countChange:a}),o}),changes:r,cannotChangeReaon:i}}function VC({appliedPolicies:t,drawDefinition:e,auditData:i}){if(!t?.audit?.[Ny])return;let{extension:r}=mt({name:Ny,element:e}),n={value:Array.isArray(r?.value)?r?.value.concat(i):[i],name:Ny};xt({element:e,extension:n})}function X_({updateInProgressMatchUps:t=!1,tournamentRecord:e,collectionOrder:i,collectionName:r,tieFormatName:n,drawDefinition:a,matchUpFormat:s,matchUpCount:o,collectionId:l,matchUpType:u,structureId:c,matchUpId:d,category:p,eventId:f,gender:m,event:h,collectionValueProfiles:g,collectionValue:I,matchUpValue:v,scoreValue:w,setValue:y}){let b="modifyCollectionDefinition";if(s&&!xa({matchUpFormat:s}))return z({result:{error:ie},context:{matchUpFormat:s},stack:b});if(r&&typeof r!="string")return z({result:{error:ie},context:{collectionName:r},stack:b});if(m&&!Object.values(XE).includes(m))return z({result:{error:ie},context:{gender:m},stack:b});if(p&&typeof p!="object")return z({result:{error:ie},context:{category:p},stack:b});let S={collectionValueProfiles:g,collectionValue:I,matchUpValue:v,scoreValue:w,setValue:y};if(!Object.values(S).filter(Boolean).length&&!i&&!r&&!s&&!o&&!u)return z({result:{error:Xe},stack:b});if(Object.values(S).filter(Boolean).length>1)return z({info:"Only one value assignment allowed per collectionDefinition",result:{error:ie},stack:b});let U=xp({drawDefinition:a,structureId:c,matchUpId:d,eventId:f,event:h});if(U.error)return z({result:U,stack:b});let{matchUp:T,structure:P,tieFormat:D}=U,E=jr(D),R=D?.collectionDefinitions.find(V=>V.collectionId===l),C=E?.collectionDefinitions.find(V=>V.collectionId===l);if(!R)return z({info:"source collectionDefinition",result:{error:_r},context:{collectionId:l},stack:b});let M=I??v??w??y;if(g?.length){let V=JY({matchUpCount:o??R?.matchUpCount??0,collectionValueProfiles:g});if(V.errors)return z({result:{error:ie},info:V.errors,stack:b})}else if(M&&!ot(M))return z({result:{error:ie},info:"value is not an integer",context:{value:M},stack:b});let N=(V,_)=>xi(Object.keys(V),Object.keys(_)).length===Object.keys(V).length&&xi(Object.values(V),Object.values(_)).length===Object.values(V).length,A=g&&(!R.collectionValueProfiles||!N(R.collectionValueProfiles,g)),O=ot(I)&&R.collectionValue!==I||ot(v)&&R.matchUpValue!==v||ot(w)&&R.scoreValue!==w||ot(y)&&R.setValue!==y||A,k=[];if(O&&(C.collectionValueProfiles=void 0,C.collectionValue=void 0,C.matchUpValue=void 0,C.scoreValue=void 0,C.setValue=void 0,Object.assign(C,S),k.push({collectionId:l,...Ve(S)})),(ot(w)||ot(y))&&C.collectionGroupNumber){let V=C.collectionGroupNumber;E.collectionDefinitions=E.collectionDefinitions.map(_=>{let{collectionGroupNumber:B,...G}=_;return B===V?G:_}),E.collectionGroups=E.collectionGroups.filter(({groupNumber:_})=>_!==V),k.push({collectionId:l,change:"collectionGroupNumber removed"})}let{aggregateValue:F,valueGoal:x}=Dh(E),L=Ve({aggregateValue:F,valueGoal:x});if((L.aggregateValue!==D?.winCriteria.aggregateValue||L.valueGoal!==D?.winCriteria.valueGoal)&&(E.winCriteria=L,k.push({collectionId:l,winCriteria:L})),ot(i)&&R.collectionOrder!==i&&(C.collectionOrder=i,k.push({collectionId:l,collectionOrder:i})),r&&R.collectionName!==r&&(C.collectionName=r,k.push({collectionId:l,collectionName:r})),s&&R.matchUpFormat!==s&&(C.matchUpFormat=s,k.push({collectionId:l,matchUpFormat:s})),ot(o)&&R.matchUpCount!==o&&(C.matchUpCount=o,k.push({collectionId:l,matchUpCount:o})),u&&R.matchUpType!==u)return z({result:{error:Y1},context:{matchUpType:u},stack:b});p&&R.category!==p&&(C.category=p,k.push({collectionId:l,category:p})),m&&R.gender!==m&&(C.gender=m,k.push({collectionId:l,gender:m}));let $=Ve(E);if(U=Bn({tieFormat:$}),U.error)return z({result:U,stack:b});if(!k.length)return z({result:{...H,modifications:k}});if(D?.tieFormatName!==n?($.tieFormatName=n,k.push({tieFormatName:n})):k.length&&(delete $.tieFormatName,k.push("tieFormatName removed: modifications without new tieFormatName")),U=qEe({tieFormat:$,updateInProgressMatchUps:t,tournamentRecord:e,drawDefinition:a,structure:P,eventId:f,matchUp:T,event:h}),!U.error){let{appliedPolicies:V}=Tt({tournamentRecord:e}),_=Ve({collectionDefinition:C,drawId:a?.drawId,action:b,structureId:c,matchUpId:d,eventId:f});VC({appliedPolicies:V,drawDefinition:a,auditData:_})}return z({result:{...U,modifications:k},stack:b})}function YEe({updateInProgressMatchUps:t,drawDefinition:e,structureId:i,structure:r,matchUpId:n,matchUp:a}){let s=[];return n&&a?s=[a]:i&&r?s=Nt({matchUpFilters:{matchUpTypes:[Zt]},structure:r})?.matchUps??[]:e&&(s=Rn({matchUpFilters:{matchUpTypes:[Zt]},drawDefinition:e})?.matchUps??[]),{targetMatchUps:s.filter(o=>!o.winningSide&&o.matchUpStatus!==ki&&(t||o.matchUpStatus!==ao&&!cr(o)))}}function KEe({updateInProgressMatchUps:t,tournamentRecord:e,drawDefinition:i,targetMatchUps:r,tieFormat:n,event:a}){for(let s of r){let o=!!s.tieFormat;o&&(s.tieFormat=jr(n));let l;if(t){let u=Tt({tournamentRecord:e,drawDefinition:i,event:a}).appliedPolicies,c=Lc({matchUpId:s.matchUpId,exitWhenNoValues:!0,tournamentRecord:e,appliedPolicies:u,drawDefinition:i,event:a});if(c.error)return c;l=c.score}o&&!l&&St({tournamentId:e?.tournamentId,context:"updateTargetTeamMatchUps",eventId:a?.eventId,matchUp:s,drawDefinition:i})}return{...H}}function HQ({updateInProgressMatchUps:t,originalValueGoal:e,tournamentRecord:i,wasAggregateValue:r,tieFormatName:n,drawDefinition:a,structureId:s,structure:o,tieFormat:l,matchUpId:u,matchUp:c,eventId:d,event:p}){let{aggregateValue:f,valueGoal:m}=Dh(l);l.winCriteria=Ve({aggregateValue:f,valueGoal:m}),(e&&e!==m||f&&!r)&&(n?l.tieFormatName=n:delete l.tieFormatName);let{targetMatchUps:h}=YEe({updateInProgressMatchUps:t,drawDefinition:a,structureId:s,structure:o,matchUpId:u,matchUp:c});KEe({updateInProgressMatchUps:t,tournamentRecord:i,targetMatchUps:h,drawDefinition:a,tieFormat:l,event:p});let g=Ve(l),I=Bn({tieFormat:g});if(I.error)return I;if(d&&p)p.tieFormat=g;else if(u&&c)c.tieFormat=l;else if(o)o.tieFormat=g;else if(a)a.tieFormat=g;else if(!c||!a)return{error:_e};return ti({drawDefinition:a,eventId:p?.eventId}),{...H}}function WQ({updateInProgressMatchUps:t=!0,collectionGroupNumber:e,tournamentRecord:i,drawDefinition:r,tieFormatName:n,structureId:a,matchUpId:s,matchUp:o,eventId:l,event:u}){if(!e)return{error:Xe};if(isNaN(e))return{error:ie};let c="removeCollectionGroup",d=o?void 0:xp({drawDefinition:r,structureId:a,matchUpId:s,eventId:l,event:u});if(d?.error)return z({result:d,stack:c});let p=d?.structure;o=o??d?.matchUp;let f=d?.tieFormat,m=f?.winCriteria.valueGoal,h=f?.winCriteria.aggregateValue,g=jr(f);if(d=Bn({tieFormat:g}),d.error)return z({result:d,stack:c});let I=[];if(g.collectionDefinitions=g.collectionDefinitions.map(v=>{let{collectionGroupNumber:w,...y}=v;return w!==e?v:(I.push(v.collectionId),y)}),g.collectionGroups=g.collectionGroups.filter(({groupNumber:v})=>v!==e),d=HQ({updateInProgressMatchUps:t,originalValueGoal:m,wasAggregateValue:h,tournamentRecord:i,drawDefinition:r,tieFormatName:n,structureId:a,structure:p,tieFormat:g,matchUpId:s,matchUp:o,eventId:l,event:u}),!d.error){let{appliedPolicies:v}=Tt({tournamentRecord:i}),w=Ve({drawId:r?.drawId,collectionGroupNumber:e,action:c,structureId:a,matchUpId:s,eventId:l});VC({appliedPolicies:v,drawDefinition:r,auditData:w})}return z({result:{...d,modifiedCollectionIds:I},stack:c})}function pI({tieFormat:t,orderMap:e}){let i=jr(t);return i.collectionDefinitions?.forEach(r=>{let n=e[r.collectionId];n&&(r.collectionOrder=n)}),i.collectionDefinitions?.sort((r,n)=>Wg(r.collectionOrder)-Wg(n.collectionOrder)),i}function zQ({tournamentRecord:t,drawDefinition:e,structureId:i,matchUpId:r,orderMap:n,eventId:a,matchUp:s,event:o}){if(typeof n!="object"||!Object.values(n).every(c=>ot(c)))return z({result:{error:ie},context:{orderMap:n}});let l=i?et({drawDefinition:e,structureId:i}):void 0;if(l?.error)return l;let u=l?.structure;if(a&&o?.tieFormat)kW({tournamentRecord:t,event:o,orderMap:n});else if(r){let c=e&&di({drawDefinition:e,matchUpId:r});if(c?.error)return c;if(s=c.matchUp,!s)return{error:ea};let d=dC({tournamentRecord:t,matchUpId:r,structure:u,drawDefinition:e,event:o})?.tieFormat;s.tieFormat=pI({tieFormat:d,orderMap:n}),St({tournamentId:t?.tournamentId,eventId:o?.eventId,drawDefinition:e,matchUp:s})}else if(i)if(u?.tieFormat)u.tieFormat=pI({tieFormat:u.tieFormat,orderMap:n}),qQ({eventId:o?.eventId,tournamentRecord:t,drawDefinition:e,structure:u,orderMap:n}),ti({drawDefinition:e,structureIds:[u.structureId]});else if(e.tieFormat)$O({structureIds:[i],tournamentRecord:t,drawDefinition:e,orderMap:n,event:o});else if(o?.tieFormat)kW({structureIds:[i],tournamentRecord:t,orderMap:n,event:o});else return{error:_r};else if(e?.tieFormat)$O({tournamentRecord:t,drawDefinition:e,orderMap:n,event:o});else return{error:_r};return{...H}}function kW({tournamentRecord:t,structureIds:e,orderMap:i,event:r}){let n=pI({tieFormat:r.tieFormat,orderMap:i});e?.length||(r.tieFormat=n);for(let a of r.drawDefinitions??[])$O({tournamentRecord:t,drawDefinition:a,structureIds:e,orderMap:i,event:r})}function $O({tournamentRecord:t,drawDefinition:e,structureIds:i,orderMap:r,event:n}){let a=e.tieFormat??n?.tieFormat,s=pI({tieFormat:a,orderMap:r});i?.length||(e.tieFormat=s);let o=[];for(let l of e.structures??[])i?.length&&!i.includes(l.structureId)||((l.tieFormat||i?.includes(l.structureId))&&(l.tieFormat=pI({tieFormat:l.tieFormat??e.tieFormat??n?.tieFormat,orderMap:r})),qQ({eventId:n?.eventId,tournamentRecord:t,drawDefinition:e,structure:l,orderMap:r}),o.push(l.structureId));ti({drawDefinition:e,structureIds:o})}function qQ({tournamentRecord:t,drawDefinition:e,structure:i,orderMap:r,eventId:n}){let a=Nt({matchUpFilters:{matchUpTypes:[Zt]},structure:i})?.matchUps;for(let s of a)s.tieFormat&&(s.tieFormat=pI({tieFormat:s.tieFormat,orderMap:r}),St({tournamentId:t?.tournamentId,drawDefinition:e,eventId:n,matchUp:s}))}function J_({updateInProgressMatchUps:t=!0,tieFormatComparison:e,tournamentRecord:i,drawDefinition:r,tieFormatName:n,collectionId:a,structureId:s,matchUpId:o,eventId:l,matchUp:u,event:c}){let d="removeCollectionDefinition",p=u?void 0:xp({drawDefinition:r,structureId:s,matchUpId:o,eventId:l,event:c});if(p?.error)return z({result:p,stack:d});let f=p?.structure;u=u??p?.matchUp;let m=p?.tieFormat,h=jr(m);if(p=Bn({tieFormat:h}),p.error)return z({result:p,stack:d});let g=h?.collectionDefinitions?.find(E=>E.collectionId===a);if(!g)return z({result:{error:_r,collectionId:a}});h.collectionDefinitions=h.collectionDefinitions.filter(E=>E.collectionId!==a),g.collectionGroupNumber&&(h.collectionDefinitions=h.collectionDefinitions.map(E=>{let{collectionGroupNumber:R,...C}=E;return C}),h.collectionGroups=h.collectionGroups.filter(({groupNumber:E})=>E!==g.collectionGroupNumber));let{aggregateValue:I,valueGoal:v}=Dh(h);h.winCriteria=Ve({aggregateValue:I,valueGoal:v});let w=m?.winCriteria.valueGoal,y=m?.winCriteria.aggregateValue;(w&&w!==v||I&&!y)&&(n?h.tieFormatName=n:delete h.tieFormatName);let b=[];o&&u?b=[u]:s&&f?b=Nt({matchUpFilters:{matchUpTypes:[Zt]},structure:f})?.matchUps??[]:r?b=Rn({matchUpFilters:{matchUpTypes:[Zt]},drawDefinition:r})?.matchUps??[]:c&&(b=Ru({matchUpFilters:{matchUpTypes:[Zt]}})?.matchUps??[]);let S=(b||[]).filter(E=>{let R=E.tieMatchUps?.filter(M=>M.collectionId===a)?.some(cr),C=e&&E.tieFormat?gc({descendant:E.tieFormat,ancestor:h})?.different:!1;return t&&!R||!E.winningSide&&E.matchUpStatus!==ki&&(t||E.matchUpStatus!==ao&&!cr(E)&&!C)});if(!S.length)return{error:QI};let{appliedPolicies:U}=Tt({tournamentRecord:i});if(o&&u&&t){let E=u.tieMatchUps?.filter(R=>R.collectionId===a);for(let R of E??[]){let C=pf({matchUpId:R.matchUpId,tieMatchUpId:u?.matchUpId,winningSide:void 0,removeScore:!0,tournamentRecord:i,appliedPolicies:U,drawDefinition:r,event:c});if(C.error||(C=di({drawDefinition:r,matchUpId:o}),C.error))return C;u=C?.matchUp}}let T=[];for(let E of S){for(let R of E?.sides??[])R.lineUp=(R.lineUp??[]).map(C=>({participantId:C.participantId,collectionAssignments:(C?.collectionAssignments??[]).filter(M=>M.collectionId!==a)}));if(E.tieMatchUps=(E.tieMatchUps??[]).filter(R=>{let C=R.collectionId===a;return C&&T.push(R.matchUpId),!C}),E.tieFormat&&(E.tieFormat=jr(h)),t){let R=Lc({matchUpId:E.matchUpId,exitWhenNoValues:!0,tournamentRecord:i,appliedPolicies:U,drawDefinition:r,event:c});if(R.error)return R}St({tournamentId:i?.tournamentId,eventId:c?.eventId,drawDefinition:r,context:d,matchUp:E})}T.length&&Pu({tournamentId:i?.tournamentId,matchUpIds:T,eventId:c?.eventId,drawDefinition:r});let P=Ve(h);if(p=Bn({tieFormat:P}),p.error)return z({result:p,stack:d});if(l&&c)c.tieFormat=P;else if(o&&u)u.tieFormat=P;else if(f)f.tieFormat=P;else if(r)r.tieFormat=P;else if(!u||!r)return{error:_e};ti({drawDefinition:r,eventId:c?.eventId});let D=Ve({drawId:r?.drawId,action:d,collectionId:a,structureId:s,matchUpId:o,eventId:l});return VC({appliedPolicies:U,drawDefinition:r,auditData:D}),{tieFormat:P,deletedMatchUpIds:T,targetMatchUps:S,...H}}function YQ({updateInProgressMatchUps:t=!0,tournamentRecord:e,groupDefinition:i,drawDefinition:r,collectionIds:n,tieFormatName:a,structureId:s,matchUpId:o,matchUp:l,eventId:u,event:c}){let d="addCollectionGroup";if(!Array.isArray(n))return z({result:{error:Xe},stack:d});let p=l?void 0:xp({drawDefinition:r,structureId:s,matchUpId:o,eventId:u,event:c});if(p?.error)return z({result:p,stack:d});let f=p?.structure;l=l||p?.matchUp;let m=p?.tieFormat,h=m?.winCriteria.valueGoal,g=jr(m);if(p=Bn({tieFormat:g}),p.error)return z({result:p,stack:d});for(let v of g.collectionDefinitions){let{collectionId:w,collectionGroupNumber:y}=v;if(y&&n.includes(w))return z({info:"collectionIds cannot be part of other collectionGroups",result:{error:ie},stack:d})}let I=(g.collectionGroups||[]).reduce((v,w)=>w.groupNumber>v?w.groupNumber:v,0)+1;return i.groupNumber=I,g.collectionDefinitions=g.collectionDefinitions.map(v=>n.includes(v.collectionId)?{...v,collectionGroupNumber:I}:v),g.collectionGroups=[...g.collecitonGroups||[],i],HQ({updateInProgressMatchUps:t,originalValueGoal:h,tournamentRecord:e,drawDefinition:r,tieFormatName:a,structureId:s,structure:f,tieFormat:g,matchUpId:o,matchUp:l,eventId:u,event:c})}function Q_({updateInProgressMatchUps:t=!0,collectionDefinition:e,referenceCategory:i,tournamentRecord:r,policyDefinitions:n,enforceCategory:a,referenceGender:s,drawDefinition:o,tieFormatName:l,enforceGender:u,structureId:c,matchUpId:d,matchUp:p,eventId:f,uuids:m,event:h}){let g="addCollectionDefinition",I=Tt({tournamentRecord:r,drawDefinition:o,event:h}).appliedPolicies??{},v=n?.[Er]??I?.[Er];a=a??v?.participants?.enforceCategory;let w=(u??v?.participants?.enforceGender)!==!1,y=!!((i??h?.category)&&a!==!1),b=!!((s??h?.gender)&&w),S=xw({referenceCategory:i??h?.category,collectionDefinition:e,referenceGender:s,checkCategory:y,checkGender:b,event:h});if(S.error)return z({result:S,stack:g});let U=p?.tieFormat?void 0:xp({drawDefinition:o,structureId:c,matchUpId:d,eventId:f,event:h});if(U?.error)return z({result:{error:U.error},stack:g});let T=U?.structure;p=p??U?.matchUp;let P=p?.tieFormat??U?.tieFormat,D=jr(P);if(U=Bn({tieFormat:D}),U?.error)return z({result:{error:U.error},stack:g});if(!e.collectionId)e.collectionId=Et();else if(D.collectionDefinitions.map(({collectionId:x})=>x).includes(e.collectionId))return z({context:{collectionId:e.collectionId},result:{error:s4}});D.collectionDefinitions.push(e),D.collectionDefinitions.sort((x,L)=>(x.collectionOrder||0)-(L.collectionOrder||0)).forEach((x,L)=>x.collectionOrder=L+1);let{aggregateValue:E,valueGoal:R}=Dh(D);D.winCriteria=Ve({aggregateValue:E,valueGoal:R});let C=P?.winCriteria.valueGoal,M=P?.winCriteria.aggregateValue;(C&&C!==R||E&&!M)&&(l?D.tieFormatName=l:delete D.tieFormatName);let N=[],A=[],O=[],k=Ve(D);if(U=Bn({tieFormat:k}),U?.error)return z({result:{error:U.error},stack:g});if(f&&h){h.tieFormat=k;for(let x of h.drawDefinitions??[])if(!x.tieFormat)for(let L of x.structures??[]){if(L.tieFormat)continue;let $=LA({updateInProgressMatchUps:t,collectionDefinition:e,structure:L,uuids:m});A.push(...$.newMatchUps),O.push(...$.targetMatchUps),N.push(L.structureId)}ST({modifiedMatchUps:O,eventId:h?.eventId,modifiedStructureIds:N,tournamentRecord:r,drawDefinition:o,addedMatchUps:A,stack:g})}else if(c&&T){T.tieFormat=k;let x=LA({updateInProgressMatchUps:t,collectionDefinition:e,structure:T,uuids:m});A.push(...x.newMatchUps),O=x.targetMatchUps,ST({modifiedMatchUps:O,eventId:h?.eventId,modifiedStructureIds:N,tournamentRecord:r,drawDefinition:o,addedMatchUps:A,stack:g})}else if(d&&p){if(!pP({matchUp:p,updateInProgressMatchUps:t}))return z({result:{error:L1},stack:g});p.tieFormat=k;let x=IS({collectionDefinition:e,matchUp:p,uuids:m});Array.isArray(p.tieMatchUps)||(p.tieMatchUps=[]),p.tieMatchUps.push(...x),A.push(...x),ST({modifiedMatchUps:[p],eventId:h?.eventId,modifiedStructureIds:N,tournamentRecord:r,drawDefinition:o,addedMatchUps:A,stack:g})}else if(o){o.tieFormat=k;for(let x of o.structures??[]){let L=LA({updateInProgressMatchUps:t,collectionDefinition:e,structure:x,uuids:m});N.push(x.structureId),A.push(...L.newMatchUps),O.push(...L.targetMatchUps)}ST({modifiedMatchUps:O,eventId:h?.eventId,tournamentRecord:r,drawDefinition:o,addedMatchUps:A,stack:g})}else return{error:_e};let F=Ve({drawId:o?.drawId,collectionDefinition:e,action:g,structureId:c,matchUpId:d,eventId:f});return VC({appliedPolicies:I,drawDefinition:o,auditData:F}),{tieFormat:k,targetMatchUps:O,addedMatchUps:A,...H}}function LA({updateInProgressMatchUps:t,collectionDefinition:e,structure:i,uuids:r}){let n=[],a=(Nt({matchUpFilters:{matchUpTypes:[Zt]},structure:i})?.matchUps).filter(s=>pP({matchUp:s,updateInProgressMatchUps:t})&&!s.tieFormat);for(let s of a){let o=IS({collectionDefinition:e,matchUp:s,uuids:r});Array.isArray(s.tieMatchUps)||(s.tieMatchUps=[]),s.tieMatchUps.push(...o),n.push(...o)}return{newMatchUps:n,targetMatchUps:a}}function ST({modifiedStructureIds:t,tournamentRecord:e,modifiedMatchUps:i,drawDefinition:r,addedMatchUps:n,eventId:a,stack:s}){hd({tournamentId:e?.tournamentId,matchUps:n,drawDefinition:r,eventId:a}),i?.forEach(o=>{St({tournamentId:e?.tournamentId,drawDefinition:r,context:s,matchUp:o,eventId:a})}),ti({structureIds:t,drawDefinition:r,eventId:a})}function KQ({updateInProgressMatchUps:t=!1,tieFormatComparison:e,modifiedTieFormat:i,tournamentRecord:r,considerations:n,drawDefinition:a,structureId:s,matchUpId:o,eventId:l,uuids:u,event:c}){let d="modifyTieFormat";if(!Bn({tieFormat:i}).valid)return z({result:{error:Vl},info:"falied validation",stack:d});let p=xp({drawDefinition:a,structureId:s,matchUpId:o,eventId:l,event:c});if(p.error)return z({result:p,stack:d});let{matchUp:f,tieFormat:m}=p,h=jr(m),g=gc({descendant:i,ancestor:h,considerations:n});if(g.invalid)return z({context:{invalid:g.invalid},result:{error:Vl},stack:d});if(!g?.different)return z({result:{...H},info:"Nothing to do",stack:d});let I=h.collectionDefinitions.map(({collectionId:P})=>P),v=i.collectionDefinitions.map(({collectionId:P})=>P),w=I.filter(P=>!v.includes(P)),y=i.collectionDefinitions.filter(({collectionId:P})=>!I.includes(P)),b=y.map(ba("collectionId")),S=[],U,T=i.tieFormatName;for(let P of i.collectionDefinitions){if(b.includes(P.collectionId))continue;let D=X_({updateInProgressMatchUps:t,...P,tournamentRecord:r,tieFormatName:T,drawDefinition:a,structureId:s,matchUpId:o,eventId:l,event:c});if(D.modifications&&S.push(...D.modifications),D.error)return z({result:D,stack:d});D.tieFormat&&(U=D.tieFormat)}for(let P of y){let D=Q_({updateInProgressMatchUps:t,collectionDefinition:P,tournamentRecord:r,drawDefinition:a,tieFormatName:T,structureId:s,matchUpId:o,matchUp:f,eventId:l,uuids:u,event:c});if(D.error)return z({result:D,stack:d});D.tieFormat&&(U=D.tieFormat)}for(let P of w){let D=J_({updateInProgressMatchUps:t,tieFormatComparison:e,tournamentRecord:r,drawDefinition:a,tieFormatName:T,collectionId:P,structureId:s,matchUpId:o,eventId:l,matchUp:f,event:c});if(D.error)return z({result:D,stack:d});D.tieFormat&&(U=D.tieFormat)}return m?.tieFormatName!==T?(U.tieFormatName=T,S.push({tieFormatName:T})):(S.length||b.length||w.length)&&(delete U.tieFormatName,S.push("tieFormatName removed: modifications without new tieFormatName")),U.collectionDefinitions=U.collectionDefinitions.sort((P,D)=>Wg(P.collectionOrder)-Wg(D.collectionOrder)).map((P,D)=>({...P,collectionOrder:D+1})),{processedTieFormat:jr(U),modifications:S,...H}}function XQ({tournamentRecord:t}){if(!t)return{error:Ie};let e=0;for(let i of t.events??[]){let r=i.tieFormats??[],n=u=>{if(!u.tieFormat)return;let c;for(let d of r)gc({descendant:u.tieFormat,ancestor:d}).different||(c=d.tieFormatId);if(c)u.tieFormatId=c,delete u.tieFormat;else{let d=ke(u.tieFormat,void 0,!0);d.tieFormatId||(d.tieFormatId=Et()),u.tieFormatId=d.tieFormatId,delete u.tieFormat,r.push(d),e+=1}};i.eventType,n({tieFormat:i.tieFormat});for(let u of i.drawDefinitions??[]){n({tieFormat:u.tieFormat});for(let c of u.structures??[])n({tieFormat:c.tieFormat})}let a=(u,c)=>{let d=o.matchUps?.find(p=>p.matchUpId===u);d&&(d.tieFormatId=c,delete d.tieFormat,St({tournamentId:t?.tournamentId,eventId:i.eventId,matchUp:d}))},s=u=>{let c=ke(u.tieFormat,void 0,!0);c.tieFormatId||(c.tieFormatId=Et()),r.push(c),e+=1,a(u.matchUpId,c.tieFormatId)},o=Ru({matchUpFilters:{matchUpTypes:[ka]},event:i}),l=o.matchUps??[];for(let u of l){let c;for(let d of r)u.tieFormat&&gc({descendant:u.tieFormat,ancestor:d}).different||(c=d.tieFormatId);c?a(u.matchUpId,c):s(u)}r.length&&(i.tieFormats=r)}return{...H,addedCount:e}}var JQ={};ct(JQ,{addDrawDefinitionExtension:()=>pR,addEventExtension:()=>Ld,addEventTimeItem:()=>Sh,addExtension:()=>xt,addNotes:()=>BR,addOnlineResource:()=>nZ,addParticipantExtension:()=>x5,addParticipantTimeItem:()=>HL,addTimeItem:()=>Dl,addTournamentExtension:()=>UF,addTournamentTimeItem:()=>wS,analyzeDraws:()=>SS,analyzeTournament:()=>$0,copyTournamentRecord:()=>ZQ,createTournamentRecord:()=>_C,generate:()=>QQ,getAggregateTeamResults:()=>_0,getAllowedDrawTypes:()=>lC,getAllowedMatchUpFormats:()=>x0,getAppliedPolicies:()=>Tt,getCompetitionDateRange:()=>cC,getCompetitionPenalties:()=>F0,getPolicyDefinitions:()=>xc,getTournamentInfo:()=>Uh,getTournamentPenalties:()=>uC,getTournamentPersons:()=>L0,getTournamentPoints:()=>hv,getTournamentStructures:()=>EL,getTournamentTimeItem:()=>SR,hydrateTournamentRecord:()=>tZ,mutate:()=>eZ,query:()=>Z9,removeDrawDefinitionExtension:()=>F5,removeEventExtension:()=>fR,removeExtension:()=>En,removeNotes:()=>BL,removeOnlineResource:()=>rZ,removeParticipantExtension:()=>L5,removeTournamentExtension:()=>TF,setTournamentCategories:()=>oZ,setTournamentDates:()=>jC,setTournamentEndDate:()=>uZ,setTournamentName:()=>aZ,setTournamentNotes:()=>sZ,setTournamentStartDate:()=>lZ,setTournamentStatus:()=>iZ});var QQ={};ct(QQ,{copyTournamentRecord:()=>ZQ,createTournamentRecord:()=>_C});function ZQ(t){let e=Ge(t,[{tournamentRecord:!0,startDate:!0,endDate:!1,tournamentName:!0}]);if(e.error)return e;let{startDate:i,endDate:r}=t.tournamentRecord,n=1440*60*1e3,a=(i&&r?new Date(Qe(r)).getTime()-new Date(Qe(i)).getTime():0)/n,s=t.endDate||aF(t.startDate,a),o=p=>p?.filter(({itemType:f})=>t.itemTypeList?.includes(f)),l=p=>p?.filter(({name:f})=>t.extensionList?.includes(f)),u=p=>{let{timeItems:f,extensions:m,...h}=p;return ke({...h,timeItems:o(f),extensions:l(m)},!1,!0)},c=p=>{let{drawDefinitions:f,timeItems:m,extensions:h,startDate:g,endDate:I,...v}=p;return ke({extensions:l(h),timeItems:o(m),startDate:t.startDate,endDate:s,...v},!1,!0)},d={participants:t.copyParticipants?t.tournamentRecord.participants?.map(u)??[]:[],parentOrganisation:ke({...t.tournamentRecord.parentOrganisation},!1,!0),venues:ke(t.tournamentRecord.venues??[],!1,!0),extensions:l(t.tournamentRecord.extensions),timeItems:o(t.tournamentRecord.timeItems),events:t.tournamentRecord.events?.map(c)??[],weekdays:[...t.tournamentRecord.weekdays??[]],tournamentName:t.tournamentName,startDate:t.startDate,tournamentId:Et(),endDate:s};return{...H,tournamentRecord:d}}var eZ={};ct(eZ,{addDrawDefinitionExtension:()=>pR,addEventExtension:()=>Ld,addEventTimeItem:()=>Sh,addExtension:()=>xt,addNotes:()=>BR,addOnlineResource:()=>nZ,addParticipantExtension:()=>x5,addParticipantTimeItem:()=>HL,addTimeItem:()=>Dl,addTournamentExtension:()=>UF,addTournamentTimeItem:()=>wS,hydrateTournamentRecord:()=>tZ,removeDrawDefinitionExtension:()=>F5,removeEventExtension:()=>fR,removeExtension:()=>En,removeNotes:()=>BL,removeOnlineResource:()=>rZ,removeParticipantExtension:()=>L5,removeTournamentExtension:()=>TF,setTournamentCategories:()=>oZ,setTournamentDates:()=>jC,setTournamentEndDate:()=>uZ,setTournamentName:()=>aZ,setTournamentNotes:()=>sZ,setTournamentStartDate:()=>lZ,setTournamentStatus:()=>iZ});function tZ(t){let{tournamentRecord:e,eventProfiles:i=[],directives:r,policyDefinitions:n}=t;return e?((e.events||[]).forEach(a=>{let s=i.find(o=>o.eventId&&o.eventId===a.eventId);(s?.directives?.hydrateRoundNames||r?.hydrateRoundNames)&&a.drawDefinitions?.forEach(o=>{(s?.policyDefinitions?.[lc]||n?.[lc])&&hX({drawDefinition:o,appliedPolicies:n})})}),{tournamentRecord:e}):{error:Ie}}function iZ({tournamentRecord:t,status:e}){return t?e&&!Object.keys(C8).includes(e)?{error:ie,info:"Unknown status"}:(t.tournamentStatus=e,{...H}):{error:Ie}}function rZ(t){let e=Ge(t,[{tournamentRecord:!0,onlineResource:!0}]);if(e.error)return e;let{tournamentRecord:i,onlineResource:r,organisationId:n,participantId:a,personId:s,courtId:o,venueId:l}=t;if(n){if(i.parentOrganisation?.parentOrganisationId!==n)return z({result:{error:_r}});ag({element:i.parentOrganisation,onlineResource:r})}else if(a||s){let u=(i.participants??[]).find(c=>s&&c.person?.personId===s||c.participantId===a);if(!u)return z(s?{result:{error:_r}}:{result:{error:Vi}});if(s){if(u.person?.personId!==s)return z({result:{error:Sp}});ag({element:u.person,onlineResource:r})}else ag({element:u,onlineResource:r})}else if(o){let u=(i.venues??[]).filter(c=>!l||c.venueId===l).flatMap(c=>(c.courts??[]).filter(d=>d.courtId===o))?.[0];if(!u)return z({result:{error:nc}});ag({element:u,onlineResource:r})}else if(l){let u=(i.venues??[]).find(c=>c.venueId===l);if(!u)return z({result:{error:ef}});ag({element:u,onlineResource:r})}else ag({element:i,onlineResource:r}),at({payload:{parentOrganisation:i.parentOrganisation,onlineResources:i.onlineResources,tournamentId:i.tournamentId},topic:rf});return{...H}}function ag({element:t,onlineResource:e}){let i=(t.onlineResources??[]).filter(r=>!(r?.[xD]===e[xD]&&r?.[FD]===e[FD]&&r?.[Jg]===e[Jg]));t.onlineResources=i}function nZ(t){let e=Ge(t,[{tournamentRecord:!0,onlineResource:!0}]);if(e.error)return e;let{tournamentRecord:i,onlineResource:r,organisationId:n,participantId:a,personId:s,courtId:o,venueId:l}=t;if(n){if(i.parentOrganisation?.parentOrganisationId!==n)return z({result:{error:_r}});sg({element:i.parentOrganisation,onlineResource:r})}else{if(a&&s&&a!==s)return z({result:{error:Sp}});if(a||s){let u=(i.participants??[]).find(c=>s&&c.person?.personId===s||c.participantId===a);if(!u)return z(s?{result:{error:_r}}:{result:{error:Vi}});if(s){if(u.person?.personId!==s)return z({result:{error:Sp}});sg({element:u.person,onlineResource:r})}else sg({element:u,onlineResource:r})}else if(o){let u=(i.venues??[]).filter(c=>!l||c.venueId===l).flatMap(c=>(c.courts??[]).filter(d=>d.courtId===o))?.[0];if(!u)return z({result:{error:nc}});sg({element:u,onlineResource:r})}else if(l){let u=(i.venues??[]).find(c=>c.venueId===l);if(!u)return z({result:{error:ef}});sg({element:u,onlineResource:r})}else sg({element:i,onlineResource:r}),at({payload:{parentOrganisation:i.parentOrganisation,onlineResources:i.onlineResources,tournamentId:i.tournamentId},topic:rf})}return{...H}}function sg({element:t,onlineResource:e}){let i=(t.onlineResources??[]).filter(r=>r?.[eO]!==e[eO]&&r?.[Jg]!==e[Jg]);return i.push(e),t.onlineResources=i,{...H}}function aZ({tournamentRecord:t,promotionalName:e,tournamentName:i,formalName:r}){if(!t)return{error:Ie};let n=t.tournamentId,a={tournamentId:n};return i&&i!==t.tournamentName&&(t.tournamentName=i,a.tournamentName=i),e&&e!==t.promotionalName&&(t.promotionalName=e,a.promotionalName=e),r&&r!==t.formalName&&(t.formalName=r,a.formalName=r),t.promotionalName===t.tournamentName&&(delete t.promotionalName,a.promotionalName=""),t.formalName===t.tournamentName&&(delete t.formalName,a.formalName=""),Object.keys(a).length>1&&at({topic:rf,payload:{parentOrganisation:t.parentOrganisation,tournamentId:n,...a}}),{...H}}function sZ({tournamentRecord:t,notes:e}){if(!t)return{error:Ie};let i=e?BR({element:t,notes:e}):BL({element:t});return i.error?i:(at({topic:rf,payload:{parentOrganisation:t.parentOrganisation,tournamentId:t.tournamentId,notes:e??""}}),{...H})}function oZ({tournamentRecord:t,categories:e}){return t?(e=(e||[]).filter(i=>i.categoryName&&i.type),t.tournamentCategories=e,at({topic:rf,payload:{parentOrganisation:t.parentOrganisation,tournamentId:t.tournamentId,categories:e}}),{...H}):{error:Ie}}function XEe({tournamentRecord:t}){if(!t)return{error:Ie};let{startDate:e,endDate:i}=t,r=Xg(e,i),n=[];for(let a of t.venues||[])a?.courts?.length&&n.push(...a.courts);for(let a of n){let{startTime:s,endTime:o}=(a.dateAvailability??[]).reduce((c,d)=>{let p=Pt(c.startTime),f=Pt(c.endTime);return d.startTime&&Pt(d.startTime)<p&&(c.startTime=d.startTime),d.endTime&&Pt(d.endTime)>f&&(c.endTime=d.endTime),c},{startTime:"08:00",endTime:"18:00"}),l=r.map(c=>a.dateAvailability?.find(d=>d.date===c)??{date:c,startTime:s,endTime:o}),u=a.dateAvailability?.find(c=>!c.date);u&&l.unshift(u),a.dateAvailability=l}return{...H}}function jC(t){let{tournamentRecord:e,startDate:i,endDate:r,weekdays:n}=t,a=t.activeDates?.filter(Boolean),s=Ge(t,[{tournamentRecord:!0},{[Wr]:f=>rl.test(f),[Fa]:sr,startDate:!1,endDate:!1},{[Wr]:f=>f.filter(Boolean).every(m=>rl.test(m)),[Fa]:sr,activeDates:!1},{[Wr]:AX,weekdays:!1}]);if(s.error)return s;if(r&&i&&new Date(r)<new Date(i))return{error:ie};if(r&&i&&new Date(i)>new Date(r))return{error:ie};if(a?.length){let f=i||e.startDate,m=r||e.endDate,h=!f||a.every(I=>new Date(I)>=new Date(f)),g=!m||a.every(I=>new Date(I)<=new Date(m));if(!h||!g)return{error:sr}}let o;(i&&e.startDate&&new Date(i)>new Date(e.startDate)||r&&e.endDate&&new Date(r)<new Date(e.endDate))&&(o=!0);let l=Xg(e.startDate,e.endDate);i&&(e.startDate=i),r&&(e.endDate=r);let u=Xg(e.startDate,e.endDate),c=l.filter(f=>!u.includes(f)),d=u.filter(f=>!l.includes(f));for(let f of e.events??[])i&&f.startDate&&new Date(f.startDate)<new Date(i)&&(f.startDate=i),r&&f.startDate&&new Date(f.startDate)>new Date(r)&&(f.startDate=i??r),r&&f.endDate&&new Date(f.endDate)>new Date(r)&&(f.endDate=r),i&&f.endDate&&new Date(f.endDate)<new Date(i)&&(f.endDate=r??i);i&&e.endDate&&new Date(i)>new Date(e.endDate)&&(e.endDate=i),r&&e.startDate&&new Date(r)<new Date(e.startDate)&&(e.startDate=r),a&&(e.activeDates=a),n&&(e.weekdays=n);let p=o&&JEe({tournamentRecord:e})?.unscheduledMatchUpIds;return XEe({tournamentRecord:e}),at({payload:Ve({parentOrganisation:e.parentOrganisation,tournamentId:e.tournamentId,activeDates:a,startDate:i,weekdays:n,endDate:r}),topic:rf}),{...H,unscheduledMatchUpIds:p,datesAdded:d,datesRemoved:c}}function lZ({tournamentRecord:t,startDate:e}){return e?jC({tournamentRecord:t,startDate:e}):{error:sr}}function uZ({tournamentRecord:t,endDate:e}){return e?jC({tournamentRecord:t,endDate:e}):{error:sr}}function JEe({tournamentRecord:t}){let e=br({tournamentRecord:t}).matchUps??[],i=t.startDate&&new Date(t.startDate),r=t.endDate&&new Date(t.endDate),n=[],a=[];for(let s of e){let{schedule:o,matchUpId:l}=s;if(o&&o.scheduledDate){let u=new Date(o.scheduledDate);(i&&u<i||r&&u>r)&&(a.push(l),n.includes(o.scheduledDate)||n.push(o.scheduledDate))}}return n.length&&!xC({scheduledDates:n,tournamentRecord:t}).clearedScheduleCount?{error:e6}:{unscheduledMatchUpIds:a}}var cZ={};ct(cZ,{BLOCK_TYPES:()=>kt,EvaluatorRegistry:()=>TZ,adjacentBlockEvaluator:()=>u$,applyTemporalAvailabilityToTournamentRecord:()=>AZ,blockDurationEvaluator:()=>d$,buildDayRange:()=>fZ,buildEdges:()=>t$,buildSchedulingProfileFromUISelections:()=>kZ,calculateCapacityStats:()=>hZ,calculateCourtHours:()=>_Z,clampDragToCollisions:()=>wZ,clampToDayRange:()=>Z_,compareCapacityCurves:()=>vZ,computePlanItemId:()=>mP,courtDayKey:()=>_y,courtKey:()=>Pg,courtOverlapEvaluator:()=>o$,createFollowByEvaluator:()=>DZ,dayBoundaryEvaluator:()=>p$,defaultEvaluators:()=>UZ,deriveRailSegments:()=>r$,diffMinutes:()=>_S,extractDay:()=>ip,filterCapacityCurve:()=>gZ,findBlocksContainingTime:()=>bZ,formatConflicts:()=>RZ,generateCapacityCurve:()=>a$,getHighestSeverity:()=>EZ,groupConflictsBySeverity:()=>PZ,hhmmToMinutes:()=>kb,intervalsOverlap:()=>yZ,iterateDayTicks:()=>MZ,lightingEvaluator:()=>c$,maintenanceWindowEvaluator:()=>f$,matchWindowEvaluator:()=>l$,mergeAdjacentSegments:()=>n$,mergeOverlappingAvailability:()=>LZ,minutesToHhmm:()=>GC,overlappingRange:()=>pZ,railsToDateAvailability:()=>h$,rangesOverlap:()=>e$,resolveCourtId:()=>zf,resolveStatus:()=>fP,resolveVenueId:()=>sm,runValidationPipeline:()=>NZ,sampleCapacityCurve:()=>IZ,snapIsoToGranularity:()=>CZ,snapToGranularity:()=>m$,sortBlocksByStart:()=>SZ,sortEdges:()=>i$,timeInsideBlock:()=>s$,todsAvailabilityToBlocks:()=>OZ,validateDateAvailability:()=>FZ,validateSchedulingProfileFormat:()=>xZ,validateSegments:()=>mZ,venueDayKey:()=>dZ,venueKey:()=>jf});var kt={MAINTENANCE:"MAINTENANCE",PRACTICE:"PRACTICE",RESERVED:"RESERVED",BLOCKED:"BLOCKED",CLOSED:"CLOSED",SCHEDULED:"SCHEDULED",SOFT_BLOCK:"SOFT_BLOCK",HARD_BLOCK:"HARD_BLOCK",LOCKED:"LOCKED",AVAILABLE:"AVAILABLE",UNSPECIFIED:"UNSPECIFIED"};function _y(t,e){return`${t.tournamentId}|${t.venueId}|${t.courtId}|${e}`}function Pg(t){return`${t.tournamentId}|${t.venueId}|${t.courtId}`}function jf(t,e){return`${t}|${e}`}function dZ(t,e,i){return`${t}|${e}|${i}`}function sm(t){return t.venueId||t.venueName||"unknown-venue"}function zf(t){return t.courtId||t.courtName||"unknown-court"}function Z_(t,e){let i=t.start,r=t.end,n=e?.start,a=e?.end;if(r<=n||i>=a)return null;let s=i<n?n:i,o=r>a?a:r;return{...t,start:s,end:o}}function e$(t,e){return t?.start<e?.end&&e?.start<t?.end}function pZ(t,e){let i=t?.start>e?.start?t?.start:e?.start,r=t?.end<e?.end?t?.end:e?.end;return{start:i,end:r}}function _S(t,e){let i=new Date(t),r=(new Date(e).getTime()-i.getTime())/(1e3*60);return Number.isNaN(r)?0:r}function fP(t,e,i){if(t.length===0||!i||i.length===0)return kt.AVAILABLE;let r=new Map(i.map((s,o)=>[s,o])),n=kt.AVAILABLE,a=1/0;for(let s of t){let o=e.get(s);if(!o)continue;let l=r.get(o.type);l!==void 0&&l<a&&(a=l,n=o.type)}return n}function t$(t){let e=[];if(!Array.isArray(t))return e;for(let i of t)e.push({time:i.start,type:"START",blockId:i.id}),e.push({time:i.end,type:"END",blockId:i.id});return e}function i$(t){return Array.isArray(t)?t.slice().sort((e,i)=>{let r=e.time.localeCompare(i.time);return r!==0?r:e.type==="END"&&i.type==="START"?-1:e.type==="START"&&i.type==="END"?1:0}):[]}function r$(t,e,i){if(!Array.isArray(t)||!e||!i)return[];let r=t.map(u=>Z_(u,e)).filter(u=>u!==null);if(r.length===0)return[{start:e.start,end:e.end,status:kt.AVAILABLE,contributingBlocks:[]}];let n=new Map(r.map(u=>[u.id,u])),a=i$(t$(r)),s=new Set,o=[],l=e.start;for(let u of a){let c=u.time;if(c>l){let d=Array.from(s),p=fP(d,n,i.typePrecedence);o.push({start:l,end:c,status:p,contributingBlocks:d})}u.type==="START"?s.add(u.blockId):s.delete(u.blockId),l=c}if(l<e.end){let u=Array.from(s),c=fP(u,n,i.typePrecedence);o.push({start:l,end:e.end,status:c,contributingBlocks:u})}return n$(o)}function n$(t){if(t.length===0)return t;let e=[],i={...t[0]};for(let r=1;r<t.length;r++){let n=t[r],a=i.status===n.status,s=i.contributingBlocks.length===n.contributingBlocks.length&&i.contributingBlocks.every(l=>n.contributingBlocks.includes(l)),o=i.end===n.start;a&&s&&o?i.end=n.end:(e.push(i),i={...n})}return e.push(i),e}function ip(t){return Qe(t)}function fZ(t,e){return{start:`${t}T${e?.dayStartTime}:00`,end:`${t}T${e?.dayEndTime}:00`}}function mZ(t){for(let e=0;e<t.length;e++){let i=t[e];if(i.start>=i.end)return!1;if(e<t.length-1){let r=t[e+1];if(i.end>r.start||i.end!==r.start)return!1}}return!0}function a$(t,e){let i=new Set;if(!Array.isArray(e))return{day:t,points:[]};for(let a of e)for(let s of a.rails)for(let o of s.segments)i.add(o.start),i.add(o.end);let r=Array.from(i).sort(),n=r.map(a=>({time:a,courtsAvailable:0,courtsSoftBlocked:0,courtsHardBlocked:0}));for(let a of e)for(let s of a.rails)for(let o=0;o<r.length;o++){let l=r[o],u=QEe(s.segments,l);if(u){let c=n[o];ZEe(u,c)}}return{day:t,points:n}}function QEe(t,e){for(let i of t)if(e>=i.start&&e<i.end)return i;return null}function ZEe(t,e){switch(t.status){case kt.AVAILABLE:e.courtsAvailable++;break;case kt.RESERVED:case kt.SOFT_BLOCK:e.courtsSoftBlocked++;break;case kt.BLOCKED:case kt.PRACTICE:case kt.MAINTENANCE:case kt.CLOSED:e.courtsSoftBlocked++;break;case kt.SCHEDULED:case kt.HARD_BLOCK:case kt.LOCKED:e.courtsHardBlocked++;break}}function hZ(t){if(!t.points||t.points.length===0)return{peakAvailable:0,peakTime:"",minAvailable:0,minTime:"",avgAvailable:0,totalCourtHours:0,utilizationPercent:0,peakUnavailable:0,peakUnavailableTime:"",totalCourts:0,totalAvailableHours:0,totalUnavailableHours:0,availablePercent:0,avgBlockedHoursPerCourt:0};let e=0,i=t.points[0].time,r=1/0,n=t.points[0].time,a=0,s=t.points[0].time,o=0,l=0,u=0;for(let g=0;g<t.points.length-1;g++){let I=t.points[g],v=t.points[g+1],w=(new Date(v.time).getTime()-new Date(I.time).getTime())/(1e3*60*60),y=I.courtsAvailable+I.courtsSoftBlocked+I.courtsHardBlocked;u=Math.max(u,y);let b=I.courtsSoftBlocked+I.courtsHardBlocked;I.courtsAvailable>e&&(e=I.courtsAvailable,i=I.time),I.courtsAvailable<r&&(r=I.courtsAvailable,n=I.time),b>a&&(a=b,s=I.time),o+=I.courtsAvailable*w,l+=b*w}let c=(new Date(t.points.at(-1).time).getTime()-new Date(t.points[0].time).getTime())/(1e3*60*60),d=u*c,p=d>0?o/d*100:0,f=d>0?l/d*100:0,m=u>0?l/u:0,h=t.points.length>1?t.points.slice(0,-1).reduce((g,I)=>g+I.courtsAvailable,0)/(t.points.length-1):0;return{peakAvailable:e,peakTime:i,minAvailable:r===1/0?0:r,minTime:n,avgAvailable:h,totalCourtHours:d,utilizationPercent:f,peakUnavailable:a,peakUnavailableTime:s,totalCourts:u,totalAvailableHours:o,totalUnavailableHours:l,availablePercent:p,avgBlockedHoursPerCourt:m}}function gZ(t,e){let i=t.points?.filter(r=>r.time>=e.start&&r.time<=e.end);return{...t,points:i}}function IZ(t,e){if(!t.points||t.points.length===0)return t;let i=[],r=new Date(t.points[0].time),n=new Date(t.points.at(-1).time),a=new Date(r);for(;a<=n;){let s=a.toISOString(),o=eRe(t.points,s);o&&i.push(o),a=new Date(a.getTime()+e*60*1e3)}return{...t,points:i}}function eRe(t,e){for(let i=t.length-1;i>=0;i--)if(t[i].time<=e)return{time:e,courtsAvailable:t[i].courtsAvailable,courtsSoftBlocked:t[i].courtsSoftBlocked,courtsHardBlocked:t[i].courtsHardBlocked};return null}function vZ(t,e){let i=[],r=new Set;t.points?.forEach(a=>r.add(a.time)),e?.points?.forEach(a=>r.add(a.time));let n=Array.from(r).sort();for(let a of n){let s=t.points?.find(l=>l.time===a)||{courtsAvailable:0,courtsSoftBlocked:0,courtsHardBlocked:0},o=e.points?.find(l=>l.time===a)||{courtsAvailable:0,courtsSoftBlocked:0,courtsHardBlocked:0};i.push({time:a,availableDelta:o.courtsAvailable-s.courtsAvailable,softBlockedDelta:o.courtsSoftBlocked-s.courtsSoftBlocked,hardBlockedDelta:o.courtsHardBlocked-s.courtsHardBlocked})}return i}function yZ(t,e){let i=new Date(t.start?.endsWith("Z")?t.start:t.start+"Z").getTime(),r=new Date(t.end?.endsWith("Z")?t.end:t.end+"Z").getTime(),n=new Date(e?.start?.endsWith("Z")?e?.start:e?.start+"Z").getTime(),a=new Date(e?.end?.endsWith("Z")?e?.end:e?.end+"Z").getTime();return i<a&&r>n}function s$(t,e){let i=new Date(e?.start?.endsWith("Z")?e?.start:e?.start+"Z").getTime(),r=new Date(e?.end?.endsWith("Z")?e?.end:e?.end+"Z").getTime();return i<=t&&t<r}function bZ(t,e){return Array.isArray(e)?e.filter(i=>s$(t,i)):[]}function wZ(t,e,i){let r=e>=t?"forward":"backward",n=Math.min(t,e),a=Math.max(t,e),s,o,l=!1,u;if(r==="forward"){let c=a;for(let d of i){let p=new Date(d.start.endsWith("Z")?d.start:d.start+"Z").getTime(),f=new Date(d.end.endsWith("Z")?d.end:d.end+"Z").getTime();p>t&&p<a&&p<c&&(c=p,l=!0,u=d),p<a&&f>t&&p<c&&p>t&&(c=p,l=!0,u=d)}s=t,o=c}else{let c=n;if(Array.isArray(i))for(let d of i){let p=new Date(d.start.endsWith("Z")?d.start:d.start+"Z").getTime(),f=new Date(d.end.endsWith("Z")?d.end:d.end+"Z").getTime();f<t&&f>n&&f>c&&(c=f,l=!0,u=d),p<t&&f>n&&f>c&&f<t&&(c=f,l=!0,u=d)}s=c,o=t}return{start:s,end:o,clamped:l,clampedBy:u,direction:r}}function SZ(t){Array.isArray(t)&&t.sort((e,i)=>{let r=new Date(e.start.endsWith("Z")?e.start:e.start+"Z").getTime(),n=new Date(i.start.endsWith("Z")?i.start:i.start+"Z").getTime();return r-n})}var o$={id:"COURT_OVERLAP",description:"Prevent double-booking courts or overriding hard blocks",evaluate:(t,e)=>{let i=[];for(let r of e){if(r.kind==="REMOVE_BLOCK")continue;let n=r.block,a=Qe(n.start),s=`${n.court.tournamentId}|${n.court.venueId}|${n.court.courtId}|${a}`,o=t.blocksByCourtDay.get(s)||[];for(let l of o){if(l===n.id)continue;let u=t.blocksById.get(l);if(u&&e$(n,u)){let c=u.type===kt.HARD_BLOCK||u.type===kt.LOCKED||n.type===kt.HARD_BLOCK||n.type===kt.LOCKED?"ERROR":"WARN",d=n.start>u.start?n.start:u.start,p=n.end<u.end?n.end:u.end;i.push({code:"COURT_OVERLAP",message:`Block overlaps existing ${u.type.toLowerCase()} (${u.reason||"no reason"}) on court ${n.court.courtId}`,severity:c,timeRange:{start:d,end:p},courts:[n.court]})}}}return i}},l$={id:"MATCH_WINDOW",description:"Ensure availability windows are large enough for typical matches",evaluate:(t,e)=>{let i=[],r=new Set;for(let n of e){let a=n.block,s=Qe(a.start),o=`${a.court.tournamentId}|${a.court.venueId}|${a.court.courtId}|${s}`;r.add(o)}for(let n of r){let a=(t.blocksByCourtDay.get(n)||[]).map(o=>t.blocksById.get(o)).filter(Boolean).slice().sort((o,l)=>o.start.localeCompare(l.start)),s=null;for(let o of a)if(o.type!==kt.AVAILABLE&&o.type!==kt.SOFT_BLOCK&&o.type!==kt.RESERVED){if(s){let l=_S(s,o.start);l>0&&l<60&&i.push({code:"MATCH_WINDOW_TOO_SMALL",message:`Availability window (${l} minutes) is smaller than typical match duration (60 minutes)`,severity:"WARN",timeRange:{start:s,end:o.start},courts:[o.court]})}s=o.end}}return i}},u$={id:"ADJACENT_BLOCK",description:"Warn about blocks with no transition time",evaluate:(t,e)=>{let i=[];for(let r of e){if(r.kind==="REMOVE_BLOCK")continue;let n=r.block,a=Qe(n.start),s=`${n.court.tournamentId}|${n.court.venueId}|${n.court.courtId}|${a}`,o=t.blocksByCourtDay.get(s)||[];for(let l of o){if(l===n.id)continue;let u=t.blocksById.get(l);u&&(u.end===n.start||n.end===u.start)&&u.type!==n.type&&i.push({code:"NO_TRANSITION_TIME",message:`${n.type} immediately follows ${u.type} with no transition time (recommended: 15 minutes)`,severity:"INFO",timeRange:{start:u.end,end:n.start},courts:[n.court]})}}return i}},c$={id:"LIGHTING",description:"Prevent scheduling on unlit courts after sunset",evaluate:(t,e)=>{let i=[],r="19:00";for(let n of e){if(n.kind==="REMOVE_BLOCK")continue;let a=n.block;a.end.slice(11,16)>r&&(a.type===kt.AVAILABLE||a.type===kt.RESERVED)&&i.push({code:"AFTER_SUNSET",message:`Court scheduled after sunset (${r}). Verify court has adequate lighting.`,severity:"WARN",timeRange:{start:`${a.start.slice(0,11)}${r}:00`,end:a.end},courts:[a.court]})}return i}},d$={id:"BLOCK_DURATION",description:"Validate block durations are reasonable",evaluate:(t,e)=>{let i=[];for(let r of e){if(r.kind==="REMOVE_BLOCK")continue;let n=r.block,a=_S(n.start,n.end);a<15?i.push({code:"BLOCK_TOO_SHORT",message:`Block duration (${a} minutes) is unusually short. Minimum recommended: 15 minutes.`,severity:"WARN",timeRange:n,courts:[n.court]}):a>720&&i.push({code:"BLOCK_TOO_LONG",message:`Block duration (${a/60} hours) is unusually long. Maximum recommended: ${720/60} hours.`,severity:"WARN",timeRange:n,courts:[n.court]})}return i}},p$={id:"DAY_BOUNDARY",description:"Ensure blocks do not span multiple days",evaluate:(t,e)=>{let i=[];for(let r of e){if(r.kind==="REMOVE_BLOCK")continue;let n=r.block,a=Qe(n.start),s=Qe(n.end);a!==s&&i.push({code:"SPANS_MULTIPLE_DAYS",message:`Block spans from ${a} to ${s}. Blocks should be contained within a single day.`,severity:"ERROR",timeRange:n,courts:[n.court]})}return i}},f$={id:"MAINTENANCE_WINDOW",description:"Validate maintenance scheduling practices",evaluate:(t,e)=>{let i=[],r="09:00",n="17:00";for(let a of e){if(a.kind==="REMOVE_BLOCK")continue;let s=a.block;if(s.type===kt.MAINTENANCE){let o=s.start.slice(11,16),l=s.end.slice(11,16),u=_S(s.start,s.end);(o>=r&&o<n||l>r&&l<=n)&&i.push({code:"MAINTENANCE_DURING_PEAK",message:`Maintenance scheduled during peak hours (${r}-${n}). Consider scheduling during off-peak times.`,severity:"INFO",timeRange:s,courts:[s.court]}),u<30&&i.push({code:"MAINTENANCE_TOO_SHORT",message:`Maintenance duration (${u} minutes) may be insufficient. Recommended minimum: 30 minutes.`,severity:"INFO",timeRange:s,courts:[s.court]})}}return i}},UZ=[o$,p$,d$,l$,u$,c$,f$],TZ=class{constructor(){this.evaluators=new Map}register(t){this.evaluators.set(t.id,t)}unregister(t){this.evaluators.delete(t)}get(t){return this.evaluators.get(t)}getAll(){return Array.from(this.evaluators.values())}clear(){this.evaluators.clear()}},DZ=t=>({id:"FOLLOW_BY",description:"Player rest and follow-by conflicts using Competition Factory",evaluate:(e,i)=>[]});function PZ(t){return Array.isArray(t)?{errors:t?.filter(e=>e.severity==="ERROR"),warnings:t.filter(e=>e.severity==="WARN"),info:t.filter(e=>e.severity==="INFO")}:{errors:[],warnings:[],info:[]}}function EZ(t){return Array.isArray(t)?t.some(e=>e.severity==="ERROR")?"ERROR":t.some(e=>e.severity==="WARN")?"WARN":t.some(e=>e.severity==="INFO")?"INFO":null:null}function RZ(t){return Array.isArray(t)?t.map(e=>{let i=e.courts.map(n=>n.courtId).join(", "),r=`${e.timeRange.start.slice(11,16)}-${e.timeRange.end.slice(11,16)}`;return`[${e.severity}] ${e.code}: ${e.message} (${i} @ ${r})`}):[]}function kb(t){if(typeof t!="string")return 0;let[e,i]=t.split(":").map(Number);return e*60+i}function GC(t){let e=Math.max(0,Math.min(1439,Math.round(t))),i=Math.floor(e/60),r=e%60;return`${String(i).padStart(2,"0")}:${String(r).padStart(2,"0")}`}function m$(t,e,i="round"){if(e<=0)return t;switch(i){case"floor":return Math.floor(t/e)*e;case"ceil":return Math.ceil(t/e)*e;case"round":return Math.round(t/e)*e}}function CZ(t,e,i="round"){if(!t||typeof t!="string")return t;let r=t.slice(0,10),n=t.slice(11,16),a=kb(n),s=m$(a,e,i),o=GC(s);return`${r}T${o}:00`}function*MZ(t,e,i){if(i<=0)return;let r=kb(t),n=kb(e);for(let a=r;a<n;a+=i)yield GC(a)}function mP(t){let e=[t.day,t.venueId,t.eventId];return t.drawId&&e.push(t.drawId),e.push(`R${t.roundNumber}`),e.join("|")}function tRe(t,e){let i=[],r=new Set(t.getTournamentDays()),n=t.listCourtMeta(),a=new Set(n.map(s=>s.ref.venueId));for(let s of e){r.has(s.day)||i.push({ruleId:"PRECHECK_INVALID_DAY",phase:"PRECHECK",severity:"ERROR",message:`Day '${s.day}' is not within the tournament date range`,context:{day:s.day}});for(let o of s.items)a.has(o.venueId)||i.push({ruleId:"PRECHECK_INVALID_VENUE",phase:"PRECHECK",severity:"ERROR",message:`Venue '${o.venueId}' does not exist in the tournament record`,context:{day:s.day,venueId:o.venueId,planItemId:o.planItemId}}),o.notBeforeTime&&!/^\d{2}:\d{2}$/.test(o.notBeforeTime)&&i.push({ruleId:"PRECHECK_INVALID_TIME_FORMAT",phase:"PRECHECK",severity:"ERROR",message:`notBeforeTime '${o.notBeforeTime}' is not valid HH:MM format`,context:{day:s.day,planItemId:o.planItemId}}),o.roundNumber<1&&i.push({ruleId:"PRECHECK_INVALID_ROUND",phase:"PRECHECK",severity:"ERROR",message:`roundNumber must be >= 1, got ${o.roundNumber}`,context:{day:s.day,planItemId:o.planItemId}})}return i}function iRe(t,e){let i=[],r=new Set;for(let n of e)for(let a of n.items)r.has(a.planItemId)&&i.push({ruleId:"INTEGRITY_DUPLICATE_PLAN_ITEM",phase:"INTEGRITY",severity:"ERROR",message:`Duplicate plan item '${a.planItemId}'`,context:{day:n.day,planItemId:a.planItemId}}),r.add(a.planItemId);return i}function rRe(t,e){let i=[],r=new Map;for(let n of e)for(let a of n.items){let s=`${a.eventId}|${a.drawId||""}`,o=r.get(s)||[];o.push({day:n.day,roundNumber:a.roundNumber,planItemId:a.planItemId}),r.set(s,o)}for(let[n,a]of r.entries()){if(a.length<2)continue;let s=[...a].sort((o,l)=>o.roundNumber-l.roundNumber);for(let o=1;o<s.length;o++){let l=s[o-1],u=s[o];u.day<l.day&&i.push({ruleId:"ORDERING_ROUND_DAY_SEQUENCE",phase:"ORDERING",severity:"WARN",message:`Round ${u.roundNumber} is scheduled on ${u.day} which is before round ${l.roundNumber} on ${l.day} (event: ${n.split("|")[0]})`,context:{day:u.day,planItemId:u.planItemId},fixAction:{type:"MOVE_PLAN_ITEM",description:`Move round ${u.roundNumber} to ${l.day} or later`,payload:{planItemId:u.planItemId,suggestedDay:l.day}}})}}return i}function nRe(t,e){let i=[];for(let r of e){let n=0,a=r.items.filter(p=>p.estimatedDurationMinutes);for(let p of a)n+=p.estimatedDurationMinutes;if(n===0)continue;let s=t.getVisibleTimeRange(r.day),o=OW(s.startTime),l=OW(s.endTime)-o,u=t.listCourtMeta(),c=new Set(r.items.map(p=>p.venueId)),d=(c.size===1?u.filter(p=>p.ref.venueId===[...c][0]):u).length*l;n>d?i.push({ruleId:"CAPACITY_DEMAND_EXCEEDS_SUPPLY",phase:"CAPACITY",severity:"WARN",message:`Estimated demand (${Math.round(n/60)}h) exceeds available court-hours (${Math.round(d/60)}h) on ${r.day}`,context:{day:r.day}}):n>d*.9&&i.push({ruleId:"CAPACITY_NEAR_LIMIT",phase:"CAPACITY",severity:"INFO",message:`Demand is at ${Math.round(n/d*100)}% of capacity on ${r.day}`,context:{day:r.day}})}return i}function OW(t){let[e,i]=t.split(":").map(Number);return e*60+i}var xW=["PRECHECK","INTEGRITY","ORDERING","CAPACITY"],aRe={PRECHECK:tRe,INTEGRITY:iRe,ORDERING:rRe,CAPACITY:nRe};function NZ(t){let{engine:e,day:i,phases:r}=t,n;if(i){let l=e.getDayPlan(i);n=l?[l]:[]}else n=e?.getAllPlans();let a=r?xW.filter(l=>r.includes(l)):xW,s=[];for(let l of a){let u=aRe[l],c=u(e,n);if(s.push(...c),l==="PRECHECK"&&c.some(d=>d.severity==="ERROR"))break}let o=new Map;for(let l of s){let u=l.context?.planItemId||"__global__",c=o.get(u)||[];c.push(l),o.set(u,c)}return{results:s,issueIndex:o}}var sRe={courtToCourtId:t=>t.courtId,isSchedulableStatus:t=>t===kt.AVAILABLE||t===kt.SOFT_BLOCK||t===kt.RESERVED,aggregateByVenue:!1};function h$(t,e={}){let i={...sRe,...e},r=[];for(let n of t){let{day:a,venueId:s,rails:o}=n;for(let l of o){let{court:u,segments:c}=l,d=i.courtToCourtId(u),p=oRe(c,i);for(let f of p)r.push({date:a,startTime:FW(f.start),endTime:FW(f.end),venueId:s,courtIds:[d]})}}return i.aggregateByVenue?lRe(r):r}function oRe(t,e){let i=[],r=null,n=null;for(let a of t)e.isSchedulableStatus(a.status)?(r||(r=a.start),n=a.end):(r&&n&&i.push({start:r,end:n}),r=null,n=null);return r&&n&&i.push({start:r,end:n}),i}function FW(t){return t.slice(11,16)}function lRe(t){let e=new Map;for(let i of t){let r=`${i.venueId}|${i.date}|${i.startTime}|${i.endTime}`;if(e.has(r)){let n=e.get(r);i.courtIds&&(n.courtIds=[...n.courtIds||[],...i.courtIds])}else e.set(r,{...i})}return Array.from(e.values())}function AZ(t){let{tournamentRecord:e,timelines:i,config:r={},engine:n}=t,a=h$(i,r),s=structuredClone(e),o=new Map;for(let l of a){let u=o.get(l.venueId)||[];u.push(l),o.set(l.venueId,u)}if(s.venues&&Array.isArray(s.venues)){let l=n?.getConfig()?.tournamentId;for(let u of s.venues){let c=sm(u),d=o.get(c);if(d&&(u.dateAvailability=d),n&&l){let p=n.getVenueAvailability(l,c);p&&(u.defaultStartTime=p.startTime,u.defaultEndTime=p.endTime)}}}return s}function kZ(t){let e=[];for(let i of t)!i.scheduleDate||!i.venueIds.length||e.push({scheduleDate:i.scheduleDate,venueIds:i.venueIds,rounds:i.rounds||[]});return e}function OZ(t){let{venue:e,tournamentId:i,blockType:r=kt.AVAILABLE}=t,n=[];if(!e.dateAvailability)return n;let a=sm(e);for(let s of e.dateAvailability){let{date:o,startTime:l,endTime:u,courtIds:c}=s;if(c&&c.length>0)for(let d of c)n.push({court:{tournamentId:i,venueId:a,courtId:d},start:`${o}T${l}:00`,end:`${o}T${u}:00`,type:r});else if(e.courts&&e.courts.length>0)for(let d of e.courts){let p=zf(d);n.push({court:{tournamentId:i,venueId:a,courtId:p},start:`${o}T${l}:00`,end:`${o}T${u}:00`,type:r})}}return n}function xZ(t){let e=[];if(!Array.isArray(t))return e.push("Profile must be an array"),{valid:!1,errors:e};for(let i=0;i<t.length;i++){let r=t[i];if(r.scheduleDate?/^\d{4}-\d{2}-\d{2}$/.test(r.scheduleDate)||e.push(`Item ${i}: invalid scheduleDate format (expected YYYY-MM-DD)`):e.push(`Item ${i}: missing scheduleDate`),(!r.venueIds||!Array.isArray(r.venueIds)||r.venueIds.length===0)&&e.push(`Item ${i}: missing or empty venueIds array`),r.rounds)if(!Array.isArray(r.rounds))e.push(`Item ${i}: rounds must be an array`);else for(let n=0;n<r.rounds.length;n++)r.rounds[n].eventId||e.push(`Item ${i}, round ${n}: missing eventId`)}return{valid:e.length===0,errors:e}}function FZ(t){let e=[];if(!Array.isArray(t))return e.push("Entries must be an array"),{valid:!1,errors:e};for(let i=0;i<t.length;i++){let r=t[i];(!r.date||!/^\d{4}-\d{2}-\d{2}$/.test(r.date))&&e.push(`Entry ${i}: invalid or missing date`),(!r.startTime||!/^\d{2}:\d{2}$/.test(r.startTime))&&e.push(`Entry ${i}: invalid or missing startTime (expected HH:MM)`),(!r.endTime||!/^\d{2}:\d{2}$/.test(r.endTime))&&e.push(`Entry ${i}: invalid or missing endTime (expected HH:MM)`),r.startTime&&r.endTime&&r.startTime>=r.endTime&&e.push(`Entry ${i}: startTime must be before endTime`),r.venueId||e.push(`Entry ${i}: missing venueId`)}return{valid:e.length===0,errors:e}}function LZ(t){if(t.length===0)return t;let e=new Map;for(let r of t){let n=`${r.venueId}|${r.date}`,a=e.get(n)||[];a.push(r),e.set(n,a)}let i=[];for(let r of e.values()){r.sort((a,s)=>a.startTime.localeCompare(s.startTime));let n={...r[0]};for(let a=1;a<r.length;a++){let s=r[a];s.startTime<=n.endTime?(n.endTime=s.endTime>n.endTime?s.endTime:n.endTime,n.courtIds&&s.courtIds&&(n.courtIds=[...new Set([...n.courtIds,...s.courtIds])])):(i.push(n),n={...s})}i.push(n)}return i}function _Z(t){let e=0;for(let i of t){let r=LW(i.startTime),n=(LW(i.endTime)-r)/60,a=i.courtIds?.length||1;e+=n*a}return e}function LW(t){let[e,i]=t.split(":").map(Number);return e*60+i}var $Z={};ct($Z,{addCourt:()=>BC,addCourts:()=>H_,addVenue:()=>nS,deleteCourt:()=>YZ,deleteVenue:()=>y$,deleteVenues:()=>GZ,disableCourts:()=>HZ,disableVenues:()=>WZ,enableCourts:()=>zZ,enableVenues:()=>qZ,generate:()=>BZ,generateCourts:()=>v_,getCompetitionVenues:()=>US,getCourts:()=>n_,getVenuesAndCourts:()=>Cu,modifyCourt:()=>b$,modifyCourtAvailability:()=>I$,modifyVenue:()=>KZ,mutate:()=>VZ,publicFindVenue:()=>iL,query:()=>pX});var BZ={};ct(BZ,{generateCourts:()=>v_});var VZ={};ct(VZ,{addCourt:()=>BC,addCourts:()=>H_,addVenue:()=>nS,deleteCourt:()=>YZ,deleteVenue:()=>y$,deleteVenues:()=>GZ,disableCourts:()=>HZ,disableVenues:()=>WZ,enableCourts:()=>zZ,enableVenues:()=>qZ,modifyCourt:()=>b$,modifyCourtAvailability:()=>I$,modifyVenue:()=>KZ});function g$(t){if(!t?.tournamentRecord&&!Array.isArray(t?.venueMatchUps))return{error:Ie};if(!t?.courtId)return{error:th};let{scheduleVisibilityFilters:e,tournamentRecord:i,matchUpFilters:r,venueMatchUps:n,courtId:a}=t,{schedulingProfile:s}=_c({tournamentRecord:i});if(Array.isArray(n))return{matchUps:l({matchUps:n,courtId:a})};let{matchUps:o}=br({scheduleVisibilityFilters:e,tournamentRecord:i,matchUpFilters:r});return{matchUps:l({matchUps:o,courtId:a})};function l({matchUps:u,courtId:c}){let d=u.filter(p=>{let f=p.schedule?.allocatedCourts?.map(({courtId:m})=>m);return p.schedule?.courtId===c||f?.includes(c)});return aP({matchUps:d,schedulingProfile:s})}}function uRe({scheduleVisibilityFilters:t,tournamentRecord:e,matchUpFilters:i,venueId:r}){if(!e)return{error:Ie};if(!r)return{error:xd};let{schedulingProfile:n}=_c({tournamentRecord:e}),{matchUps:a}=br({scheduleVisibilityFilters:t,tournamentRecord:e,matchUpFilters:i});return{matchUps:s({matchUps:a,venueId:r})};function s({matchUps:o,venueId:l}){let u=o.filter(c=>{let d=c.schedule?.allocatedCourts?.map(({venueId:p})=>p);return c.schedule?.venueId===l||d?.includes(l)});return aP({matchUps:u,schedulingProfile:n})}}function I$({tournamentRecord:t,dateAvailability:e,disableNotice:i,venueMatchUps:r,courtId:n,force:a}){if(!t)return{error:Ie};if(!n)return{error:th};let s=ER({dateAvailability:e});if(s.error)return s;let{updatedDateAvailability:o,totalMergeCount:l}=cRe(e);e=o;let u=jd({tournamentRecord:t,courtId:n});if(u.error)return u;let{court:c,venue:d}=u,{matchUps:p}=g$({tournamentRecord:t,venueMatchUps:r,courtId:n});if(p?.length){let f=Tt({tournamentRecord:t})?.appliedPolicies,m=a??f?.[Fd]?.allowDeletionWithScoresPresent?.courts,h=[];h.length&&(m||console.log("throw error: scheduled court matchUps",h.length))}return c&&(c.dateAvailability=e,!i&&d&&at({payload:{venue:d,tournamentId:t.tournamentId},topic:Oc,key:d.venueId})),{...H,totalMergeCount:l}}function cRe(t){let e=0,i=t.reduce((n,a)=>{let{date:s,startTime:o,endTime:l,bookings:u}=a;return n[s]||(n[s]=[]),n[s].push({startTime:o,endTime:l,bookings:u}),n},{}),r=[];return Object.keys(i).forEach(n=>{i[n].sort(CIe);let{mergedAvailability:a,mergeCount:s}=dRe(i[n]);r.push(...a.map(o=>({date:n,...o}))),e+=s}),{updatedDateAvailability:r,totalMergeCount:e}}function dRe(t){let e,i,r,n=t.length,a=0,s=[];for(;t.length&&n;){let l=t.shift(),{startTime:u,endTime:c,bookings:d}=l;if(n-=1,!e)e=u,r=d,i=c;else if(kw(Xi(i),Xi(u),!1)>0){let p={startTime:e,endTime:i};r?.length&&(p.bookings=r),s.push(p),e=u,r=d,i=c}else d&&(r?r.push(d):r=d),i=c,a+=1}let o={startTime:e,endTime:i};return r?.length&&(o.bookings=r),s.push(o),{mergedAvailability:s,mergeCount:a}}function v$({matchUpsCount:t=0}){let e=`Schedule would be deleted from ${t} ${t===1?"matchUp":"matchUps"}; use { force: true }`;return{error:d4,info:e}}function jZ({tournamentRecord:t,drawDefinition:e,matchUpId:i,drawId:r}){let n="removeCourtAssignment";if(!i)return{error:Un};if(!e&&!r)return{error:Oo};let a;if(!e){if(!t)return{error:Ie};({drawDefinition:e}=jn({tournamentRecord:t,drawId:r}))}if(e)({matchUp:a}=di({drawDefinition:e,matchUpId:i}));else{if(!t)return{error:Ie};let s=br({tournamentRecord:t,inContext:!1}).matchUps??[];({matchUp:a}=c8({matchUps:s,matchUpId:i}))}return a?(a.timeItems&&a.timeItems.find(s=>[Id,lu].includes(s.itemType))&&(a.timeItems=a.timeItems.filter(({itemType:s})=>![Id,lu].includes(s)),St({tournamentId:t?.tournamentId,context:n,drawDefinition:e,matchUp:a})),{...H}):{error:un}}function y$(t){if(typeof t?.venueId!="string")return{error:xd};let{tournamentRecord:e,venueId:i,force:r}=t,n=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(!Object.keys(n).length)return{error:Ie};let a=Eo({tournamentRecords:n,contextFilters:{venueIds:[i]}}).matchUps??[],s=Tt({tournamentRecord:e})?.appliedPolicies,o=r??s?.[Fd]?.allowDeletionWithScoresPresent?.venues;if(!a.length||o)for(let l of Object.values(n)){for(let c of a){let d=jZ({matchUpId:c.matchUpId,drawId:c.drawId,tournamentRecord:l});if(d.error)return d}let u;l.venues=(l.venues??[]).filter(c=>c?.venueId!==i?!0:(u=!0,!1)),u&&at({payload:{venueId:i,tournamentId:l.tournamentId},topic:OF,key:i})}else return v$({matchUpsCount:a.length});return CS({tournamentRecords:n}),{...H}}function GZ({tournamentRecord:t,venueIds:e,force:i}){if(!t)return{error:Ie};if(!Array.isArray(e))return{error:ie};for(let r of t.venues||[]){let{venueId:n}=r;if(e.includes(n)){let{venueId:a}=r,s=y$({tournamentRecord:t,venueId:a,force:i});if(s.error)return s}}return{...H}}function HZ(t){let{courtIds:e,dates:i}=t,r=Is(t),n=[{[cn]:!0,[cR]:!0}],a=Ge(t,n);if(a.error)return a;for(let s of Object.values(r))pRe({tournamentRecord:s,courtIds:e,dates:i});return{...H}}function pRe({tournamentRecord:t,courtIds:e,dates:i}){let r=Array.isArray(i)&&i.length?{dates:i}:!0,n=a=>xt({extension:{value:r,name:Io},creationTime:!1,element:a});for(let a of t.venues||[])for(let s of a.courts||[])if(e?.includes(s.courtId)){let o=n(s);if(o.error)return o}return{...H}}function WZ(t){let{tournamentRecords:e,tournamentId:i,venueIds:r}=t,n=[{[cn]:!0,[dR]:!0}],a=Ge(t,n);if(a.error)return a;let s=Object.keys(e).filter(o=>!i||o===i);for(let o of s){let l=e[o];fRe({tournamentRecord:l,venueIds:r})}return{...H}}function fRe({tournamentRecord:t,venueIds:e}){for(let i of t.venues||[])if(e?.includes(i.venueId)){let r=xt({creationTime:!1,element:i,extension:{name:Io,value:!0}});if(r.error)return r}return{...H}}function zZ(t){let e=Is(t),i=[{[cn]:!0}];!t.enableAll&&i.push({[cR]:!0});let r=Ge(t,i);if(r.error)return r;let{enableAll:n,courtIds:a,dates:s}=t;for(let o of Object.values(e))mRe({tournamentRecord:o,courtIds:a,enableAll:n,dates:s});return{...H}}function mRe({tournamentRecord:t,courtIds:e,enableAll:i,dates:r}){for(let n of t.venues||[])for(let a of n.courts||[])if(i||e?.includes(a.courtId))if(Array.isArray(r)){let{extension:s}=mt({element:a,name:Io});if(s){let o=s.value;Array.isArray(o.dates)&&(o.dates=o.dates.filter(l=>!r.includes(l))),xt({extension:{name:Io,value:o},creationTime:!1,element:a})}}else En({element:a,name:Io});return{...H}}function qZ(t){let e=Is(t),i=[{[cn]:!0}];!t.enableAll&&i.push({[dR]:!0});let r=Ge(t,i);if(r.error)return r;let{venueIds:n,enableAll:a}=t;for(let s of Object.values(e))for(let o of s.venues||[])(a||n?.includes(o.venueId))&&En({element:o,name:Io});return{...H}}function YZ(t){let{courtId:e,disableNotice:i,force:r}=t,n=Is(t),a=Ge(t,[{[cn]:!0,[M5]:!0}]);if(a.error)return a;let s,o;for(let l of Object.values(n)){if(o=hRe({tournamentRecord:l,disableNotice:i,courtId:e,force:r}),o.error&&o.error!==nc)return o;o.success&&(s=!0)}return s?{...H}:o}function hRe({tournamentRecord:t,disableNotice:e,courtId:i,force:r}){let n=jd({tournamentRecord:t,courtId:i});if(n.error)return n;let a=n.venue,{matchUps:s}=g$({tournamentRecord:t,courtId:i}),o=Tt({tournamentRecord:t})?.appliedPolicies,l=r??o?.[Fd]?.allowDeletionWithScoresPresent?.courts;if(!s?.length||l){for(let u of s??[]){let c=jZ({matchUpId:u.matchUpId,drawId:u.drawId,tournamentRecord:t});if(c.error)return c}a&&(a.courts=(a.courts??[]).filter(u=>u.courtId!==i),e||at({payload:{venue:a,tournamentId:t.tournamentId},topic:Oc,key:a.venueId}))}else return v$({matchUpsCount:s.length});return{...H}}function b$(t){let{disableNotice:e,modifications:i,courtId:r,force:n,venueMatchUps:a}=t,s=Is(t);if(!Object.keys(s).length)return{error:Ci};let o;for(let l of Object.values(s)){let u=gRe({tournamentRecord:l,disableNotice:e,venueMatchUps:a,modifications:i,courtId:r,force:n});if(u?.error)return u;o=!0}return o?{...H}:void 0}function gRe({tournamentRecord:t,disableNotice:e,venueMatchUps:i,modifications:r,courtId:n,force:a}){if(!t)return{error:Ie};if(!n)return{error:th};if(!r||typeof r!="object")return{error:Nc};let s=jd({tournamentRecord:t,courtId:n});if(s.error)return s;let{venue:o,court:l}=s,u=Object.keys(dEe()).filter(p=>p!=="courtId");if(!Object.keys(r).filter(p=>u.includes(p)).length)return{error:HE};let c=new Set(u.filter(p=>!["dateAvailability"].includes(p))),d=Object.keys(r).filter(p=>c.has(p));if(l&&d.forEach(p=>Object.assign(l,{[p]:r[p]})),r.dateAvailability){let p=I$({dateAvailability:r.dateAvailability,tournamentRecord:t,venueMatchUps:i,disableNotice:e,courtId:n,force:a});if(p.error)return p}return e||at({payload:{venue:o,tournamentId:t.tournamentId},topic:Oc,key:o?.venueId}),{...H,court:ke(l)}}var IRe=()=>({venueId:void 0,venueName:"",venueAbbreviation:"",onlineResources:[],venueType:void 0,defaultStartTime:void 0,defaultEndTime:void 0,isPrimary:void 0,dateAvailability:[],addresses:[],contacts:[],courts:[],roles:[]}),vRe=IRe;function KZ(t){let{modifications:e,venueId:i,force:r}=t,n=Is(t);if(!Object.keys(n).length)return{error:Ci};if(typeof i!="string")return{error:xd};let a,s;for(let o of Object.values(n)){let l=wRe({tournamentRecord:o,modifications:e,venueId:i,force:r});if(l.success&&(s=!0),l.error&&(a=l.error),l.error&&l.error!==ef)return l}return CS({tournamentRecords:n}),s?{...H}:{error:a}}function yRe({venue:t,modifications:e,tournamentRecord:i,venueMatchUps:r,allowModificationWhenMatchUpsScheduled:n}){let a=t?.courts?.map(u=>u.courtId)??[],s=e.courts?.map(u=>u.courtId)||[],o=s.length?a.filter(u=>!s.includes(u)):e?.courts&&a,l=[];if(o?.length){let u=t?.courts?.filter(c=>o.includes(c.courtId))?.map(c=>{let d=g$({courtId:c.courtId,tournamentRecord:i,venueMatchUps:r});for(let p of d.matchUps??[])l.push({matchUpId:p.matchUpId,drawId:p.drawId});return d.matchUps?.length??0}).reduce((c,d)=>c+d);return t&&(!u||n)?(t.courts=t.courts?.filter(c=>s.includes(c.courtId)),Ab({schedule:{courtId:"",scheduledDate:""},matchUpDetails:l,removePriorValues:!0,tournamentRecord:i}),{success:!0}):v$({matchUpsCount:u})}return{success:!0}}function bRe({modifications:t,tournamentRecord:e,venueMatchUps:i,venueId:r,force:n}){if(t.courts)for(let a of t.courts){let{courtId:s}=a||{},o=b$({modifications:a,disableNotice:!0,tournamentRecord:e,venueMatchUps:i,courtId:s,force:n});if(o?.error===nc&&(o=BC({disableNotice:!0,tournamentRecord:e,venueId:r,court:a})),o?.error)return o}return{success:!0}}function wRe({tournamentRecord:t,modifications:e,venueId:i,force:r}){if(!t)return{error:Ie};if(!e||typeof e!="object")return{error:Nc};if(!i)return{error:xd};let n=Tt({tournamentRecord:t})?.appliedPolicies,a=r??n?.[Fd]?.allowDeletionWithScoresPresent?.venues,{matchUps:s}=uRe({tournamentRecord:t,venueId:i}),o=Eu({tournamentRecord:t,venueId:i});if(o.error)return o;let l=o.venue,u=Object.keys(vRe()).filter(g=>g!=="venueId");if(!Object.keys(e).filter(g=>u.includes(g)).length)return{error:HE};let c=new Set(u.filter(g=>!["courts","onlineResources","dateAvailability","isPrimary"].includes(g))),d=Object.keys(e).filter(g=>c.has(g));if(!l)return{error:ef};let p=e.defaultStartTime??l.defaultStartTime,f=e.defaultEndTime??l.defaultEndTime;if(p||f){if(!p||!f)return{error:ie,info:"both defaultStartTime and defaultEndTime are required"};if(!zD({startTime:p,endTime:f}))return{error:ie,info:"defaultEndTime must be after defaultStartTime"}}if(d.forEach(g=>Object.assign(l,{[g]:e[g]})),"isPrimary"in e&&(e.isPrimary?(_K({tournamentRecord:t}),l.isPrimary=!0):delete l.isPrimary),e.dateAvailability!==void 0){if(Array.isArray(e.dateAvailability)&&e.dateAvailability.length){let g=ER({dateAvailability:e.dateAvailability});if(g.error)return g}l.dateAvailability=e.dateAvailability}let m=yRe({venue:l,modifications:e,tournamentRecord:t,venueMatchUps:s,allowModificationWhenMatchUpsScheduled:a});if("error"in m&&m.error)return m;let h=bRe({modifications:e,tournamentRecord:t,venueMatchUps:s,venueId:i,force:r});return h?.error?h:(CS({tournamentRecord:t}),l&&at({payload:{venue:l,tournamentId:t.tournamentId},topic:Oc,key:l?.venueId}),{...H,venue:ke(l)})}var HC={};ct(HC,{JSON2CSV:()=>RRe,UUID:()=>Et,UUIDS:()=>x4,allNumeric:()=>YY,attributeFilter:()=>Em,chunkArray:()=>yr,chunkByNth:()=>jk,chunkSizeProfile:()=>qY,constantToString:()=>Xr,countValues:()=>bme,createMap:()=>jY,dateTime:()=>O4,definedAttributes:()=>Ve,dehydrateMatchUps:()=>TRe,extractAttributes:()=>VK,flattenJSON:()=>w$,generateDateRange:()=>Xg,generateHashCode:()=>hme,generateRange:()=>Re,generateTimeCode:()=>qJ,groupValues:()=>WY,hasAttributeValues:()=>mme,instanceCount:()=>va,intersection:()=>xi,isConvertableInteger:()=>ot,isNumeric:()=>Ni,isOdd:()=>GY,isPowerOf2:()=>Uo,isValidEmbargoDate:()=>td,makeDeepCopy:()=>ke,matchUpScheduleSort:()=>URe,matchUpSort:()=>hh,nearestPowerOf2:()=>D1,nextPowerOf2:()=>qI,noNulls:()=>yme,noNumeric:()=>KY,numericSort:()=>ir,occurrences:()=>Sme,overlap:()=>kn,randomMember:()=>ca,randomPop:()=>ma,shuffleArray:()=>Dn,structureSort:()=>uh,subSort:()=>Ume,timeZone:()=>QPe,undefinedToNull:()=>Bk,unique:()=>rt,visualizeScheduledMatchUps:()=>SRe});function SRe({scheduledMatchUps:t,showGlobalLog:e}){XIe();let i=t?.reduce((n,{structureId:a})=>n.includes(a)?n:n.concat(a),[]),r=Array.isArray(i)&&{...i.map(n=>{let{structureName:a,matchUpType:s}=t.find(o=>o.structureId===n);return{[n]:`${a} ${s}`}})};i?.forEach(n=>{Gt({color:"blue",method:"draw",structure:r[n],keyColors:{structure:"magenta"}},!0);let a=t.filter(o=>o.structureId===n),s=bn({matchUps:a})?.roundMatchUps||[];Object.keys(s).forEach(o=>{Gt({roundNumber:o,keyColors:{roundNumber:"brightcyan"}},!0),s[o].forEach(({matchUpId:l,schedule:u})=>{let c=ci(u.scheduledTime);Gt({matchUpId:l,time:c,date:u.scheduledDate,venue:u.venueId,keyColors:{time:"brightcyan",date:"brightcyan",matchUpId:"yellow",venue:"magenta"}},!0)})})}),e&&KIe()}var{extractTime:_W,timeStringMinutes:$W}=O4;function URe(t,e){let i=t.schedule??{},r=e.schedule??{};if(i.scheduledDate&&!r.scheduledDate)return 1;if(r.scheduledDate&&!i.scheduledDate)return-1;if(i.scheduledDate&&r.scheduledDate){if(i.scheduledDate===r.scheduledDate){if(i.scheduledTime&&!r.scheduledTime)return 1;if(r.scheduledTime&&!i.scheduledTime)return-1;if(i.scheduledTime&&r.scheduledTime){let n=$W(_W(i.scheduledTime)),a=$W(_W(r.scheduledTime));return n-a}}return new Date(i.scheduledDate).getTime()-new Date(r.scheduledDate).getTime()}return 0}function TRe({tournamentRecord:t}){if(!t)return{error:Ie};if(typeof t!="object"||!t.tournamentId)return{error:ie};let{matchUps:e}=br({tournamentRecord:t,inContext:!1});if(e?.length){let i=DRe({tournamentRecord:t});ERe(e,i)}return{...H}}function DRe({tournamentRecord:t}){let e={};for(let i of t.events||[]){i.matchUpFormat&&(e[i.eventId]=i.matchUpFormat);for(let r of i.drawDefinitions||[]){r.matchUpFormat&&(e[r.drawId]=r.matchUpFormat);for(let n of r.structures||[]){n.matchUpFormat&&(e[n.structureId]=n.matchUpFormat);for(let a of n.structures||[])a.matchUpFormat&&(e[a.structureId]=a.matchUpFormat)}}}return e}var PRe=["collectionId","collectionPosition","drawPositions","extensions","finishingPositionRange","finishingRound","isMock","matchUpId","matchUpStatus","matchUpStatusCodes","orderOfFinish","processCodes","roundNumber","tieFormat","tieMatchUps","roundPosition","score","sides","winnerMatchUpId","loserMatchUpId","matchUpDuration","winningSide"];function ERe(t,e={}){for(let i of t){let{structureId:r,drawId:n,eventId:a}=i,s=e[r]||e[n]||e[a],o=i.matchUpFormat===s?void 0:i.matchUpFormat;for(let l of Object.keys(i))PRe.includes(l)||delete i[l];i.sides&&i.drawPositions&&!i.tieMatchUps&&delete i.sides,o&&(i.matchUpFormat=o)}}function RRe(t,e){if(e&&typeof e!="object")return{error:ie};let{columnTransform:i={}}=e||{},{includeTransformAccessors:r,includeHeaderRow:n=!0,returnTransformedJSON:a,removeEmptyColumns:s,onlyHeaderRow:o,columnAccessors:l=[],functionMap:u={},columnMap:c={},valuesMap:d={},context:p={},delimiter:f='"',columnJoiner:m=",",rowJoiner:h=`\r
`,keyJoiner:g="."}=e||{};if(!Array.isArray(t)||!Array.isArray(l)||typeof p!="object"||typeof c!="object"||typeof i!="object"||typeof u!="object"||typeof d!="object"||typeof m!="string"||typeof h!="string"||typeof g!="string"||typeof f!="string")return{error:ie};i=Object.assign({},...Object.keys(i).reverse().map(M=>({[M]:Array.isArray(i[M])?i[M]:[typeof i[M]=="string"&&i[M]].filter(Boolean)})));let I=t.filter(Boolean).map(M=>w$(M,g)),v=Object.values(i).flat();r&&l.push(...v);let w=I.reduce((M,N)=>Object.keys(N).every(A=>!M.includes(A)&&M.push(A)||!0)&&M,[]).filter(M=>!l?.length||l.includes(M)),y=Object.assign({},...Object.keys(i).reverse().map(M=>i[M].map(N=>({[N]:M})).flat()).flat()),b=(M,N)=>e?.sortOrder?e.sortOrder.includes(M)&&e.sortOrder.includes(N)&&e.sortOrder.indexOf(M)-e.sortOrder.indexOf(N)||!e.sortOrder.includes(N)&&-1:0,S=w.reduce((M,N)=>{let A=y[N];return A?M.includes(A)||M.push(A):M.push(N),M},[]).sort(b);Object.keys(c).forEach(M=>!S.includes(M)&&S.unshift(M)),Object.keys(i).forEach(M=>!S.includes(M)&&S.unshift(M)),typeof p=="object"&&Object.keys(p).forEach(M=>!S.includes(M)&&S.unshift(M));let U=S.map(M=>c[M]||M);if(o)return[U];let T=M=>`${f}${M}${f}`,P=[],D=M=>Object.values(S.reduce((N,A,O)=>{let k=i[A],F=(k?.length?M[k.find($=>M[$])]:M[A])||p?.[A]||"",x=d[A]?.[F]||F,L=pa(u[A])?u[A](x):x;return N[A]=T(L),L&&(P[O]=(P[O]||0)+1),N},{})),E=I.map(D),R=s&&[...P].map((M,N)=>!M&&N).filter(Ni).reverse();if(R){let M=N=>N.filter((A,O)=>!R.includes(O));E=E.map(M),U=M(U)}let C=E.map(M=>M.join(m));return a?C.map(M=>{let N=M.split(m);return Object.assign({},...N.map((A,O)=>({[U[O]]:A})))}):n?[U.map(T).join(m),...C].join(h):C.join(h)}function w$(t,e=".",i=[]){return typeof t=="object"&&Object.keys(t).reduce((r,n)=>typeof t[n]!="object"?(r[i.concat(n).join(e)]=t[n],r):Object.assign(r,w$(t[n],e,i.concat(n))),{})}var{FACTORY:BW}=$5;function CRe({tournamentRecord:t,value:e}){let{extension:i}=mt({element:t,name:BW}),r={name:BW,value:{...i?.value,...e}};xt({element:t,extension:r})}function XZ({timeStamp:t}){let e=nh(),i=Z1();return i&&Object.values(e).forEach(r=>{CRe({tournamentRecord:r,value:{version:kE(),timeStamp:t}})}),i}function JZ({engineType:t,methodName:e,elapsed:i,params:r,result:n}){let a=ia();if(typeof a!="object")return;let s={method:e},o=n?.error&&(a.errors===!0||Array.isArray(a.errors)&&a.errors.includes(e)),l=Array.isArray(a.params)&&a.params?.includes(e),u=a.params&&!Array.isArray(a.params)||l,c=Array.isArray(a.exclude)&&a.exclude.includes(e);!c&&![void 0,!1].includes(a.perf)&&!isNaN(a.perf)&&i>=a.perf&&(s.elapsed=i),!c&&(o||u)&&(s.params=r),!c&&(o||a.result&&!Array.isArray(a.result)&&(!Array.isArray(a.params)||l)||Array.isArray(a.result)&&a.result?.includes(e))&&(s.result=n),Object.keys(s).length>1&&S4(s,t)}function S$({methodName:t,params:e,start:i}){let r={error:WE,methodName:t},n=i?Date.now()-i:0;return JZ({result:r,methodName:t,elapsed:n,params:e,engineType:"sync"}),r}function MRe(t,e){if(e._middleware===!1)return e;if(e.tournamentId&&!t[e.tournamentId])return{error:Ie};let i=e.drawId||e.matchUp?.drawId;if(i){let{event:a,drawDefinition:s,tournamentId:o}=jn({tournamentRecords:t,drawId:i});s&&(e.drawDefinition=s),o&&(e.tournamentId=o),a&&(e.event=a)}if(e.eventId&&!e.event){let{event:a,tournamentId:s}=jn({eventId:e.eventId,tournamentRecords:t});if(!a)return{error:os};e.tournamentId=s,e.event=a}let r=e.tournamentId??rh();if(!r&&e)return e;let n=t[r];return r&&!n?{error:Ie}:(n&&(e.tournamentRecord=n),e)}function U$(t,e,i,r,n){delete t.success,delete t.error;let a=Date.now(),s=rh();i&&(i.activeTournamentId=s);let o=i?.tournamentRecord||tF(s),l=typeof i?.tournamentRecord=="object"&&{[i?.tournamentRecord.tournamentId]:i.tournamentRecord}||nh(),u=i?ke(i,void 0,!0):void 0,c=i?MRe(l,i):void 0;if(c?.error)return c;let d=NRe({params:c,tournamentRecords:l,tournamentRecord:o,methodName:r,method:e}),p=Date.now()-a;return JZ({result:d,methodName:r,elapsed:p,params:u,engineType:n}),d}function NRe({tournamentRecords:t,tournamentRecord:e,params:i,methodName:r,method:n}){if(ia())return n({tournamentRecords:t,tournamentRecord:e,...i});try{return n({tournamentRecords:t,tournamentRecord:e,...i})}catch(a){return KE({engineName:"engine",methodName:r,params:i,err:a})}}function WC(t){let{mutationStatus:e,tournamentId:i,directives:r,timeStamp:n}=t||{},{topics:a}=gs();for(let s of[...a].sort(ARe)){let o=y4({topic:s});o?.length&&Qk({topic:s,notices:o})}e&&n&&a.includes(sO)&&Qk({notices:[{tournamentId:i,directives:r,timeStamp:n}],topic:sO})}var VW={[jF]:5,[VF]:5,[GF]:5,[BF]:5,[$F]:5,[LF]:5,[tK]:5,[iK]:5,[_F]:1,[vR]:1,[en]:5,[Oc]:5,[FF]:4,[kF]:4,[OF]:4,[xF]:4,[IR]:3,[MF]:2};function ARe(t,e){return(VW[e]||0)-(VW[t]||0)}function kRe({convertExtensions:t,removeExtensions:e}){let i=nh();return{tournamentId:rh(),tournamentRecords:ke(i,t,!1,e)}}function ORe(t){let{convertExtensions:e=!1,removeExtensions:i=!1}=t??{},r=t?.tournamentId??rh();if(typeof r!="string")return{};let n=tF(r);return{tournamentRecord:ke(n,e,!1,i)}}function xRe(){let t=nh(),{extension:e}=mt({name:Rp,tournamentRecords:t,discover:!0}),i=e?.value?.tournamentIds||[];return Object.keys(t).forEach(r=>{i.includes(r)||delete t[r]}),YE(t)}function jW(t,e=!0){return typeof t!="object"||Array.isArray(t)?{error:Nc}:t?.tournamentId?b4(e?ke(t):t):{error:ie}}function Ob(t,e=!0){if(typeof t!="object")return{error:Nc};if(db(),Array.isArray(t)){if(t.filter(i=>i?.tournamentId).length!==t.length)return{error:Hk};t=Object.assign({},...t.map(i=>({[i.tournamentId]:i})))}else if(t?.tournamentId)t={[t.tournamentId]:t},db(t.tournamentId);else if(!Object.keys(t).every(i=>t[i].tournamentId===i))return{error:Hk};return YE(e?ke(t):t)}function FRe(t,e,i,r,n,a){let s=U4(i,r,n,a);if(s.error)return s;let o=s.methods??[];return Object.keys(o).filter(l=>pa(o[l])).forEach(l=>{t[l]=u=>{let c=()=>e(t,{[l]:o[l],...u});if(ia())return c();try{return c()}catch(d){KE({engineName:"engine",methodName:l,params:u,err:d})}}}),{...H,...t}}function og(t,e){return e?.error?(t.error=e.error,t.success=!1):(t.error=void 0,t.success=!0),t}function QZ(t,e){t.importMethods=(i,r,n,a)=>FRe(t,e,i,r,n,a),t.getTournament=i=>ORe(i),t.getState=i=>kRe({convertExtensions:i?.convertExtensions,removeExtensions:i?.removeExtensions}),t.version=()=>kE(),t.reset=()=>(YE({}),og(t)),t.devContext=i=>(ub(i),og(t)),t.getDevContext=i=>ia(i),t.newTournamentRecord=(i={})=>{let r=_C(i),n=r.tournamentId;return r.error?r:(jW(r),db(n),{...H,tournamentId:n})},t.setState=(i,r,n)=>{cb(r,n);let a=Ob(i,r);return og(t,a)},t.setTournamentId=i=>db(i),t.getTournamentId=()=>rh(),t.setTournamentRecord=(i,r,n)=>{cb(r,n);let a=jW(i,r);return og(t,a)},t.removeTournamentRecord=i=>{let r=w4(i);return og(t,r)},t.removeUnlinkedTournamentRecords=()=>{let i=xRe();return og(t,i)}}function LRe(t,e,i){if(!Array.isArray(e))return{error:ie,message:"directives must be an array"};let r=v4(),n=Date.now(),a=i&&ke(nh(),!1,!0),s=[];for(let u of e){if(typeof u!="object")return{error:ie,message:"directive must be an object"};if(u.params&&typeof u.params!="object")return{error:ie,message:"params must be an object"};let{method:c,pipe:d}=u,p=u.params?{...u.params}:{};if(!r[c])return S$({methodName:c,start:n,params:p});if(d){let m=s.at(-1),h=Object.keys(d);for(let g of h)m[g]&&(p[g]=m[g])}let f=U$(t,r[c],p,c,"sync");if(f?.error)return a&&Ob(a),{...f,rolledBack:!!a};s.push({...f,methodName:c})}let o=Date.now(),l=XZ({timeStamp:o});return WC({directives:e,mutationStatus:l,timeStamp:o}),Aw(),{success:s.every(u=>u.success),results:s}}function GW(t,e){if(!bt(e))return{error:ie,message:"args must be an object"};let i=Object.values(e).filter(pa).length;if(i>1)return{message:"there must be only one arg with typeof function",error:ie};let r=i?Object.keys(e).find(f=>pa(e[f])):ri(e.method)&&e.method;if(!r)return{error:WE};let{[r]:n,...a}=e,s=e?.params?{...e.params}:{...a},o=s.rollbackOnError&&ke(nh(),!1,!0),l=n||t[r]||J1()[r];if(!l)return S$({methodName:r,params:s});let u=U$(t,l,s,r,"sync")??{};u?.error&&o&&Ob(o);let c=Date.now(),d=XZ({timeStamp:c}),p=u?.success&&s?.delayNotify!==!0&&s?.doNotNotify!==!0;return p&&WC({directives:[{method:l,params:s}],mutationStatus:d,timeStamp:c}),(p||!u?.success||s?.doNotNotify)&&Aw(),u}var _Re=(()=>{let t={executionQueue:(e,i)=>LRe(t,e,i),execute:e=>GW(t,e)};return QZ(t,GW),t})(),T$=_Re;function HW(t,e){if(!bt(e))return{error:ie,message:"args must be an object"};let i=Object.values(e).filter(pa).length;if(i>1)return{message:"there must be only one arg with typeof function",error:ie};let r=i?Object.keys(e).find(l=>pa(e[l])):ri(e.method)&&e.method;if(!r)return{error:WE};let{[r]:n,...a}=e,s=e?.params?{...e.params}:{...a},o=n||t[r]||J1()[r];return o?U$(t,o,s,r,"ask"):S$({methodName:r,params:s})}(()=>{let t={execute:e=>HW(t,e)};return QZ(t,HW),t})();var om={},Zc;function ZZ(t,e=!0){if(!t)return{error:Xe};if(typeof t!="object")return{error:Nc};if(t.matchUpId)Zc=t.matchUpId,om[Zc]=e?ke(t):t;else if(Array.isArray(t))for(let i of t.reverse())i.matchUpId&&(om[i.matchUpId]=e?ke(i):i,Zc||(Zc=i.matchUpId));else for(let i of Object.values(t))i.matchUpId&&(om[i.matchUpId]=e?ke(i):i,Zc||(Zc=i.matchUpId));return e?ke(t):t}function $Re(){return om[Zc]}function BRe(){return Object.values(om)}function VRe(){Zc=void 0,om={}}function jRe(t){return ke(om[Zc],t?.convertExtensions,!1,t?.removeExtensions)}(()=>{let t={getState:i=>jRe(i),version:()=>kE(),reset:()=>(VRe(),{...H}),drawId:void 0,error:void 0,success:!1,devContext:i=>(ub(i),t),setState:(i,r,n)=>{cb(r,n);let a=ZZ(i);return e(a)}};function e(i){return i?.error?(t.error=i.error,t.success=!1):(t.error=void 0,t.success=!0,t.drawId=i.drawId),t}return GRe(t,[a0]),t})();function GRe(t,e){e.forEach(i=>{Object.keys(i).forEach(r=>{t[r]=n=>{if(ia())return WW(t,{params:n,governor:i,methodName:r});try{return WW(t,{params:n,governor:i,methodName:r})}catch(a){KE({engineName:"matchUpEngine",methodName:r,params:n,err:a})}}})})}function WW(t,{params:e,governor:i,methodName:r}){t.error=void 0,t.success=!1;let n=e?.matchUp||$Re(),a=e?.matchUps||BRe(),s=e?.rollbackOnError&&ke(n,!1,!0);e={...e,matchUpId:n?.matchUpId,matchUps:a,matchUp:n};let o=i[r](e);if(o?.error)return s&&ZZ(s),{...o,rolledBack:!!s};let l=o?.success&&e?.delayNotify!==!0&&e?.doNotNotify!==!0;return l&&WC(),(l||!o?.success||e?.doNotNotify)&&Aw(),o}var _A=!1;(()=>{let t={version:()=>kE(),setDeepCopy:(n,a)=>(cb(n,a),t),devContext:n=>(ub(n),_A=!0,t)};return i([O_]),t;function e(n,a){let s=n({...a});return s?.error||WC(),Aw(),_A&&(ub(!1),_A=!1),s}function i(n){n.forEach(a=>{Object.keys(a).forEach(s=>{t[s]=r(a,s)})})}function r(n,a){return s=>{if(ia()){let o=e(n[a],s);return!o?.error&&s?.setState&&o?.tournamentRecord&&Ob(o.tournamentRecord),o}else try{let o=e(n[a],s);return!o?.error&&s?.setState&&o?.tournamentRecord&&Ob(o.tournamentRecord),o}catch(o){let l;typeof o=="string"?l=o.toUpperCase():o instanceof Error&&(l=o.message),console.log("ERROR",{params:JSON.stringify(s),method:a,error:l})}}}})();var HRe={};ct(HRe,{BLOCK_TYPES:()=>kt,EvaluatorRegistry:()=>TZ,TemporalEngine:()=>WRe,adjacentBlockEvaluator:()=>u$,applyTemporalAvailabilityToTournamentRecord:()=>AZ,blockDurationEvaluator:()=>d$,buildDayRange:()=>fZ,buildEdges:()=>t$,buildSchedulingProfileFromUISelections:()=>kZ,calculateCapacityStats:()=>hZ,calculateCourtHours:()=>_Z,clampDragToCollisions:()=>wZ,clampToDayRange:()=>Z_,compareCapacityCurves:()=>vZ,computePlanItemId:()=>mP,courtDayKey:()=>_y,courtKey:()=>Pg,courtOverlapEvaluator:()=>o$,createFollowByEvaluator:()=>DZ,dayBoundaryEvaluator:()=>p$,defaultEvaluators:()=>UZ,deriveRailSegments:()=>r$,diffMinutes:()=>_S,extractDay:()=>ip,filterCapacityCurve:()=>gZ,findBlocksContainingTime:()=>bZ,formatConflicts:()=>RZ,generateCapacityCurve:()=>a$,getHighestSeverity:()=>EZ,groupConflictsBySeverity:()=>PZ,hhmmToMinutes:()=>kb,intervalsOverlap:()=>yZ,iterateDayTicks:()=>MZ,lightingEvaluator:()=>c$,maintenanceWindowEvaluator:()=>f$,matchWindowEvaluator:()=>l$,mergeAdjacentSegments:()=>n$,mergeOverlappingAvailability:()=>LZ,minutesToHhmm:()=>GC,overlappingRange:()=>pZ,railsToDateAvailability:()=>h$,rangesOverlap:()=>e$,resolveCourtId:()=>zf,resolveStatus:()=>fP,resolveVenueId:()=>sm,runValidationPipeline:()=>NZ,sampleCapacityCurve:()=>IZ,snapIsoToGranularity:()=>CZ,snapToGranularity:()=>m$,sortBlocksByStart:()=>SZ,sortEdges:()=>i$,timeInsideBlock:()=>s$,todsAvailabilityToBlocks:()=>OZ,validateDateAvailability:()=>FZ,validateSchedulingProfileFormat:()=>xZ,validateSegments:()=>mZ,venueDayKey:()=>dZ,venueKey:()=>jf});var ad,WRe=(ad=class{constructor(){this.tournamentRecord=null,this.blocksById=new Map,this.blocksByCourtDay=new Map,this.courtDayAvailability=new Map,this.venueDayAvailability=new Map,this.templates=new Map,this.rules=new Map,this.plans=new Map,this.subscribers=[],this.resolvedGranularity=15,this.nextBlockId=1}init(e,i){this.tournamentRecord=e,this.config={tournamentId:i?.tournamentId||e?.tournamentId||"tournament-1",dayStartTime:i?.dayStartTime||"06:00",dayEndTime:i?.dayEndTime||"23:00",slotMinutes:i?.slotMinutes||15,granularityMinutes:i?.granularityMinutes,typePrecedence:i?.typePrecedence||[kt.HARD_BLOCK,kt.LOCKED,kt.MAINTENANCE,kt.BLOCKED,kt.PRACTICE,kt.RESERVED,kt.SOFT_BLOCK,kt.AVAILABLE,kt.UNSPECIFIED],conflictEvaluators:i?.conflictEvaluators||[]},this.resolvedGranularity=this.config.granularityMinutes??this.config.slotMinutes??15,this.plans.clear(),this.loadBlocksFromTournamentRecord(),this.emit({type:"STATE_CHANGED",payload:{reason:"INIT"}})}updateTournamentRecord(e){this.tournamentRecord=e,this.loadBlocksFromTournamentRecord(),this.emit({type:"STATE_CHANGED",payload:{reason:"TOURNAMENT_RECORD_UPDATED"}})}getConfig(){return{...this.config}}getResolvedGranularityMinutes(){return this.resolvedGranularity}getCourtAvailability(e,i){let r=Pg(e),n=this.courtDayAvailability.get(`${r}|${i}`)??this.courtDayAvailability.get(`${r}|DEFAULT`)??null,a=jf(e.tournamentId,e.venueId),s=this.venueDayAvailability.get(`${a}|${i}`)??this.venueDayAvailability.get(`${a}|DEFAULT`)??null;if(n&&s){let l=n.startTime>s.startTime?n.startTime:s.startTime,u=n.endTime<s.endTime?n.endTime:s.endTime;return l>=u?s:{startTime:l,endTime:u}}return n||s||this.courtDayAvailability.get("GLOBAL|DEFAULT")||{startTime:this.config.dayStartTime,endTime:this.config.dayEndTime}}setCourtAvailability(e,i,r){let n=Pg(e);this.courtDayAvailability.set(`${n}|${i}`,r),this.emit({type:"AVAILABILITY_CHANGED",payload:{court:e,day:i,avail:r}})}setCourtAvailabilityAllDays(e,i){let r=Pg(e);this.courtDayAvailability.set(`${r}|DEFAULT`,i),this.emit({type:"AVAILABILITY_CHANGED",payload:{court:e,scope:"all-days",avail:i}})}setAllCourtsDefaultAvailability(e){this.courtDayAvailability.set("GLOBAL|DEFAULT",e),this.emit({type:"AVAILABILITY_CHANGED",payload:{scope:"global",avail:e}})}getVenueAvailability(e,i,r){let n=jf(e,i);if(r){let a=this.venueDayAvailability.get(`${n}|${r}`);if(a)return a}return this.venueDayAvailability.get(`${n}|DEFAULT`)??null}setVenueDefaultAvailability(e,i,r){let n=jf(e,i);this.venueDayAvailability.set(`${n}|DEFAULT`,r),this.emit({type:"AVAILABILITY_CHANGED",payload:{tournamentId:e,venueId:i,scope:"venue",avail:r}})}setVenueDayAvailability(e,i,r,n){let a=jf(e,i);this.venueDayAvailability.set(`${a}|${r}`,n),this.emit({type:"AVAILABILITY_CHANGED",payload:{tournamentId:e,venueId:i,day:r,scope:"venue-day",avail:n}})}getVisibleTimeRange(e,i){let r=i&&i.length>0?i:this.getAllCourtsFromTournamentRecord(),n="23:59",a="00:00";for(let s of r){let o=this.getCourtAvailability(s,e);o.startTime<n&&(n=o.startTime),o.endTime>a&&(a=o.endTime)}return r.length===0?{startTime:this.config.dayStartTime,endTime:this.config.dayEndTime}:{startTime:n,endTime:a}}getTournamentDays(){if(!this.tournamentRecord?.startDate)return[];let e=this.tournamentRecord.startDate,i=this.tournamentRecord.endDate||e,r=[],n=new Date(e),a=new Date(i);for(;n<=a;)r.push(n.toISOString().slice(0,10)),n.setDate(n.getDate()+1);return r}getDayTimeline(e){let i=this.getAllCourtsFromTournamentRecord(),r=new Map;for(let a of i){let s=r.get(a.venueId)||[];s.push(a),r.set(a.venueId,s)}let n=[];for(let[a,s]of r.entries()){let o=[];for(let l of s){let u=this.getCourtRail(e,l);u&&o.push(u)}n.push({day:e,venueId:a,rails:o})}return n}getVenueTimeline(e,i){return this.getDayTimeline(e).find(r=>r.venueId===i)||null}getCourtRail(e,i){let r=this.getCourtAvailability(i,e),n={start:`${e}T${r.startTime}:00`,end:`${e}T${r.endTime}:00`},a=_y(i,e),s=(this.blocksByCourtDay.get(a)||[]).map(l=>this.blocksById.get(l)).filter(l=>!!l),o=r$(s,n,this.config);return{court:i,segments:o}}getCapacityCurve(e){let i=this.getDayTimeline(e);return a$(e,i)}getDayBlocks(e){let i=[];for(let r of this.blocksById.values())ip(r.start)===e&&i.push(r);return i}getAllBlocks(){return Array.from(this.blocksById.values())}getTemplates(){return Array.from(this.templates.values())}getTemplate(e){return this.templates.get(e)||null}getRules(){return Array.from(this.rules.values())}getRule(e){return this.rules.get(e)||null}addPlanItem(e){let i=mP(e),r={...e,planItemId:i},n=this.plans.get(e.day)||{day:e.day,items:[]};return n.items=n.items.filter(a=>a.planItemId!==i),n.items.push(r),this.plans.set(e.day,n),this.emit({type:"PLAN_CHANGED",payload:{action:"ADD",planItem:r}}),this.emit({type:"STATE_CHANGED",payload:{reason:"PLAN_CHANGED"}}),r}removePlanItem(e){for(let[i,r]of this.plans.entries()){let n=r.items.findIndex(a=>a.planItemId===e);if(n!==-1){let a=r.items.splice(n,1)[0];return r.items.length===0&&this.plans.delete(i),this.emit({type:"PLAN_CHANGED",payload:{action:"REMOVE",planItem:a}}),this.emit({type:"STATE_CHANGED",payload:{reason:"PLAN_CHANGED"}}),!0}}return!1}updatePlanItem(e,i){for(let r of this.plans.values()){let n=r.items.find(a=>a.planItemId===e);if(n)return Object.assign(n,i),this.emit({type:"PLAN_CHANGED",payload:{action:"UPDATE",planItem:n}}),this.emit({type:"STATE_CHANGED",payload:{reason:"PLAN_CHANGED"}}),n}return null}movePlanItem(e,i){let r=null;for(let[s,o]of this.plans.entries()){let l=o.items.findIndex(u=>u.planItemId===e);if(l!==-1){r=o.items.splice(l,1)[0],o.items.length===0&&this.plans.delete(s);break}}if(!r)return null;let n={...r,day:i};n.planItemId=mP(n);let a=this.plans.get(i)||{day:i,items:[]};return a.items=a.items.filter(s=>s.planItemId!==n.planItemId),a.items.push(n),this.plans.set(i,a),this.emit({type:"PLAN_CHANGED",payload:{action:"MOVE",planItem:n,fromDay:r.day}}),this.emit({type:"STATE_CHANGED",payload:{reason:"PLAN_CHANGED"}}),n}getDayPlan(e){return this.plans.get(e)||null}getAllPlans(){return Array.from(this.plans.values())}applyBlock(e){let i=[];for(let r of e.courts){let n=ip(e.timeRange.start),a=this.clampToAvailability(r,n,e.timeRange.start,e.timeRange.end);if(!a)continue;let s={id:this.generateBlockId(),court:r,start:a.start,end:a.end,type:e.type,reason:e.reason,hardSoft:e.hardSoft,source:e.source||"USER"};i.push({kind:"ADD_BLOCK",block:s})}return this.applyMutations(i)}moveBlock(e){let i=this.blocksById.get(e.blockId);if(!i)return{applied:[],rejected:[],warnings:[{code:"BLOCK_NOT_FOUND",message:`Block ${e.blockId} not found`}],conflicts:[]};let r=e.newCourt||i.court,n=ip(e.newTimeRange.start),a=this.clampToAvailability(r,n,e.newTimeRange.start,e.newTimeRange.end);if(!a)return{applied:[],rejected:[],warnings:[{code:"OUTSIDE_AVAILABILITY",message:"Block falls outside court availability"}],conflicts:[]};let s={...i,start:a.start,end:a.end,court:r};return this.applyMutations([{kind:"UPDATE_BLOCK",block:s,previousBlock:i}])}resizeBlock(e){let i=this.blocksById.get(e.blockId);if(!i)return{applied:[],rejected:[],warnings:[{code:"BLOCK_NOT_FOUND",message:`Block ${e.blockId} not found`}],conflicts:[]};let r=ip(e.newTimeRange.start),n=this.clampToAvailability(i.court,r,e.newTimeRange.start,e.newTimeRange.end);if(!n)return{applied:[],rejected:[],warnings:[{code:"OUTSIDE_AVAILABILITY",message:"Block falls outside court availability"}],conflicts:[]};let a={...i,start:n.start,end:n.end};return this.applyMutations([{kind:"UPDATE_BLOCK",block:a,previousBlock:i}])}removeBlock(e){let i=this.blocksById.get(e);return i?this.applyMutations([{kind:"REMOVE_BLOCK",block:i}]):{applied:[],rejected:[],warnings:[{code:"BLOCK_NOT_FOUND",message:`Block ${e} not found`}],conflicts:[]}}applyTemplate(e){return this.templates.get(e.templateId)?{applied:[],rejected:[],warnings:[],conflicts:[]}:{applied:[],rejected:[],warnings:[{code:"TEMPLATE_NOT_FOUND",message:`Template ${e.templateId} not found`}],conflicts:[]}}importScheduledMatchUps(e){let i=[];for(let a of this.blocksById.values())a.type===kt.SCHEDULED&&a.source==="SYSTEM"&&i.push({kind:"REMOVE_BLOCK",block:a});for(let a of i)this.applyMutation(a);let r=[];for(let a of e){let s=a.startTime.length===5?`${a.startTime}:00`:a.startTime,o=this.timeToMinutes(s)+a.durationMinutes,l=Math.floor(o/60),u=o%60,c=`${String(l).padStart(2,"0")}:${String(u).padStart(2,"0")}:00`,d={id:this.generateBlockId(),court:{tournamentId:this.config.tournamentId,venueId:a.venueId,courtId:a.courtId},start:`${a.date}T${s}`,end:`${a.date}T${c}`,type:kt.SCHEDULED,source:"SYSTEM",matchUpId:a.matchUpId,reason:"Scheduled Match"};r.push({kind:"ADD_BLOCK",block:d})}let n=this.applyMutations(r);return{...n,applied:[...i,...n.applied]}}timeToMinutes(e){let i=e.split(":").map(Number);return i[0]*60+i[1]}simulateBlocks(e,i){let r=this.createSnapshot(),n=r.applyMutations(e),a=i||this.getFirstAvailableDay(),s=a?r.getDayTimeline(a):[],o=a?r.getCapacityCurve(a):void 0;return{previewRails:s,capacityImpact:o,conflicts:n.conflicts}}subscribe(e){return this.subscribers.push(e),()=>{let i=this.subscribers.indexOf(e);i>-1&&this.subscribers.splice(i,1)}}emit(e){for(let i of this.subscribers)try{i(e)}catch(r){console.error("Error in event listener:",r)}}applyMutations(e){let i=this.evaluateConflicts(e);if(i.filter(n=>n.severity==="ERROR").length>0)return{applied:[],rejected:e,warnings:[],conflicts:i};let r=[];for(let n of e)this.applyMutation(n),r.push(n);return this.emit({type:"BLOCKS_CHANGED",payload:{mutations:r}}),this.emit({type:"STATE_CHANGED",payload:{reason:"BLOCKS_MUTATED"}}),i.length>0&&this.emit({type:"CONFLICTS_CHANGED",payload:{conflicts:i}}),{applied:r,rejected:[],warnings:i.filter(n=>n.severity==="WARN").map(n=>({code:n.code,message:n.message})),conflicts:i}}applyMutation(e){let{kind:i,block:r,previousBlock:n}=e;switch(i){case"ADD_BLOCK":this.blocksById.set(r.id,r),this.indexBlock(r);break;case"UPDATE_BLOCK":n&&this.unindexBlock(n),this.blocksById.set(r.id,r),this.indexBlock(r);break;case"REMOVE_BLOCK":this.unindexBlock(r),this.blocksById.delete(r.id);break}}indexBlock(e){let i=ip(e.start),r=_y(e.court,i),n=this.blocksByCourtDay.get(r)||[];n.includes(e.id)||(n.push(e.id),this.blocksByCourtDay.set(r,n))}unindexBlock(e){let i=ip(e.start),r=_y(e.court,i),n=(this.blocksByCourtDay.get(r)||[]).filter(a=>a!==e.id);n.length>0?this.blocksByCourtDay.set(r,n):this.blocksByCourtDay.delete(r)}evaluateConflicts(e){let i=this.createContext(),r=[];for(let n of this.config.conflictEvaluators||[])try{let a=n.evaluate(i,e);r.push(...a)}catch(a){console.error(`Error in evaluator ${n.id}:`,a)}return r}createContext(){return{config:this.config,tournamentRecord:this.tournamentRecord,blocksById:new Map(this.blocksById),blocksByCourtDay:new Map(this.blocksByCourtDay),templates:new Map(this.templates),rules:new Map(this.rules)}}createSnapshot(){let e=new ad;return e.config={...this.config},e.tournamentRecord=this.tournamentRecord,e.blocksById=new Map(this.blocksById),e.blocksByCourtDay=new Map(this.blocksByCourtDay),e.courtDayAvailability=new Map(this.courtDayAvailability),e.venueDayAvailability=new Map(this.venueDayAvailability),e.templates=new Map(this.templates),e.rules=new Map(this.rules),e.plans=new Map([...this.plans.entries()].map(([i,r])=>[i,{...r,items:[...r.items]}])),e.nextBlockId=this.nextBlockId,e.resolvedGranularity=this.resolvedGranularity,e}loadBlocksFromTournamentRecord(){if(this.blocksById.clear(),this.blocksByCourtDay.clear(),this.courtDayAvailability.clear(),this.venueDayAvailability.clear(),!!this.tournamentRecord?.venues)for(let e of this.tournamentRecord.venues){let i=sm(e),r=jf(this.config.tournamentId,i);if(e.defaultStartTime&&e.defaultEndTime&&this.venueDayAvailability.set(`${r}|DEFAULT`,{startTime:e.defaultStartTime,endTime:e.defaultEndTime}),e.dateAvailability?.length){for(let n of e.dateAvailability)if(n.date?n.startTime&&n.endTime&&this.venueDayAvailability.set(`${r}|${n.date}`,{startTime:n.startTime,endTime:n.endTime}):n.startTime&&n.endTime&&this.venueDayAvailability.set(`${r}|DEFAULT`,{startTime:n.startTime,endTime:n.endTime}),n.bookings?.length&&e.courts?.length){let a=n.date||this.tournamentRecord.startDate;for(let s of n.bookings){if(!s.startTime||!s.endTime)continue;let o=s.startTime.length===5?`${s.startTime}:00`:s.startTime,l=s.endTime.length===5?`${s.endTime}:00`:s.endTime,u=ad.BOOKING_TYPE_MAP[(s.bookingType||"").toUpperCase()]||kt.RESERVED;for(let c of e.courts){let d={tournamentId:this.config.tournamentId,venueId:i,courtId:zf(c)},p=this.generateBlockId(),f={id:p,court:d,start:`${a}T${o}`,end:`${a}T${l}`,type:u,reason:s.bookingType||"Booking",source:"SYSTEM"};this.blocksById.set(p,f),this.indexBlock(f)}}}}for(let n of e.courts||[]){if(!n.dateAvailability?.length)continue;let a={tournamentId:this.config.tournamentId,venueId:i,courtId:zf(n)};for(let s of n.dateAvailability){let o=s.date||this.tournamentRecord.startDate;if(s.startTime&&s.endTime){let l=Pg(a);this.courtDayAvailability.set(`${l}|${o}`,{startTime:s.startTime,endTime:s.endTime})}if(s.bookings?.length)for(let l of s.bookings){if(!l.startTime||!l.endTime)continue;let u=l.startTime.length===5?`${l.startTime}:00`:l.startTime,c=l.endTime.length===5?`${l.endTime}:00`:l.endTime,d=ad.BOOKING_TYPE_MAP[(l.bookingType||"").toUpperCase()]||kt.RESERVED,p=this.generateBlockId(),f={id:p,court:a,start:`${o}T${u}`,end:`${o}T${c}`,type:d,reason:l.bookingType||"Booking",source:"SYSTEM"};this.blocksById.set(p,f),this.indexBlock(f)}}}}}getAllCourtsFromTournamentRecord(){if(!this.tournamentRecord?.venues)return[];let e=[];for(let i of this.tournamentRecord.venues){let r=sm(i);if(i.courts)for(let n of i.courts)e.push({tournamentId:this.config.tournamentId,venueId:r,courtId:zf(n)})}return e}getFirstAvailableDay(){return this.tournamentRecord?.startDate?Qe(this.tournamentRecord.startDate):null}generateBlockId(){return`block-${this.nextBlockId++}`}clampToAvailability(e,i,r,n){let a=this.getCourtAvailability(e,i),s=`${i}T${a.startTime}:00`,o=`${i}T${a.endTime}:00`,l=r<s?s:r,u=n>o?o:n;return l>=u?null:{start:l,end:u}}listCourtMeta(){return this.getAllCourtsFromTournamentRecord().map(e=>this.getCourtMeta(e))}getCourtMeta(e){if(this.tournamentRecord?.venues){for(let i of this.tournamentRecord.venues)if(sm(i)===e.venueId)for(let r of i.courts||[]){if(zf(r)!==e.courtId)continue;let n=this.getFirstAvailableDay(),a=n?this.getCourtAvailability(e,n):void 0;return{ref:e,name:r.courtName||r.courtId,surface:r.surfaceCategory||r.surfaceType||"hard",indoor:r.indoorOutdoor==="INDOOR"||r.indoor||!1,hasLights:r.hasLights||!1,tags:[],openTime:a?.startTime,closeTime:a?.endTime}}}return{ref:e,name:e.courtId,surface:"hard",indoor:!1,hasLights:!1,tags:[]}}},ad.BOOKING_TYPE_MAP={MAINTENANCE:kt.MAINTENANCE,PRACTICE:kt.PRACTICE,RESERVED:kt.RESERVED,MATCH:kt.SCHEDULED,SCHEDULED:kt.SCHEDULED},ad),zRe={calculateNewRatings:K8,generateDynamicRatings:X8};T$.importMethods({...q_,...zRe});T$.importMethods(_Y,!0,1);var qRe=T$,eee={};ct(eee,{activeMatchUpStatuses:()=>CF,auditConstants:()=>xDe,competitionFormatConstants:()=>tCe,completedMatchUpStatuses:()=>Yi,directingMatchUpStatuses:()=>Y5,displayConstants:()=>iwe,drawDefinitionConstants:()=>aR,entryStatusConstants:()=>Xge,errorConditionConstants:()=>Hme,eventConstants:()=>I5,extensionConstants:()=>$5,flightConstants:()=>YDe,genderConstants:()=>XE,keyValueConstants:()=>qSe,matchUpActionConstants:()=>uwe,matchUpStatusConstants:()=>J5,matchUpTypes:()=>pme,nonDirectingMatchUpStatuses:()=>K5,particicipantsRequiredMatchUpStatuses:()=>z5,participantConstants:()=>uK,participantRoles:()=>hL,participantTypes:()=>Ay,penaltyConstants:()=>yCe,policyConstants:()=>Dge,positionActionConstants:()=>pbe,rankingConstants:()=>tDe,ratingConstants:()=>tve,recoveryTimeRequiredMatchUpStatuses:()=>Lge,requestConstants:()=>jPe,resourceContants:()=>zhe,resultConstants:()=>Pme,scaleConstants:()=>wge,scheduleConstants:()=>DIe,sortingConstants:()=>tPe,surfaceConstants:()=>DCe,tieFormatConstants:()=>Yhe,timeItemConstants:()=>yIe,topicConstants:()=>$ge,tournamentConstants:()=>C8,upcomingMatchUpStatuses:()=>X5,validMatchUpStatuses:()=>q5,venueConstants:()=>RCe,weekdayConstants:()=>NX});var YRe="INTENNSE_STANDARD",KRe="TENNIS_STANDARD",XRe="MATCHUP",JRe="HALF",QRe="SEGMENT",ZRe="BETWEEN_GAMES",eCe="BETWEEN_POINTS",tCe={INTENNSE_STANDARD:YRe,TENNIS_STANDARD:KRe,MATCHUP:XRe,SET:"SET",HALF:JRe,SEGMENT:QRe,BETWEEN_GAMES:ZRe,BETWEEN_POINTS:eCe,ANY:"ANY"},iCe="Coaching",rCe="Ball Abuse",nCe="Racket Abuse",aCe="Verbal Abuse",sCe="INELIGIBILITY",oCe="Physical Abuse",lCe="Unsportmanlike Conduct",uCe="Dress Code Violation",cCe="Equipment Violation",dCe="Leaving the court",pCe="Failure to complete",fCe="No Show",mCe="Other",hCe="REFUSAL_TO_PLAY",gCe="PROHIBITED_SUBSTANCE",ICe="Puncuality",vCe="Failure to sign in",yCe={COACHING:iCe,BALL_ABUSE:rCe,RACKET_ABUSE:nCe,VERBAL_ABUSE:aCe,PHYSICAL_ABUSE:oCe,INELIGIBILITY:sCe,UNSPORTSMANLIKE_CONDUCT:lCe,PROHIBITED_SUBSTANCE:gCe,DRESS_CODE_VIOLATION:uCe,EQUIMENT_VIOLATION:cCe,LEAVING_THE_COURT:dCe,REFUSAL_TO_PLAY:hCe,FAILURE_TO_COMPLETE:pCe,NO_SHOW:fCe,OTHER:mCe,PUNCTUALITY:ICe,FAILUIRE_TO_SIGN_IN:vCe},bCe="CLAY",wCe="HARD",SCe="GRASS",UCe="CARPET",TCe="ARTIFICIAL",DCe={CLAY:bCe,HARD:wCe,GRASS:SCe,CARPET:UCe,ARTIFICIAL:TCe},PCe="INDOOR",ECe="OUTDOOR",RCe={INDOOR:PCe,OUTDOOR:ECe};const{AFTER_REST:CCe,FOLLOWED_BY:MCe,NEXT_AVAILABLE:NCe,NOT_BEFORE:ACe,TO_BE_ANNOUNCED:kCe}=eee.timeItemConstants,BO="overlay",Gi="center",zW="header",xm="right",Fp="left",qW="top",VO="",UT="flex",Go="none",OCe="buttonBar",YW="roundsColumns",xCe=8,KW="roundsStats",XW="roundsTable",FCe={[CCe]:"After rest",[MCe]:"Followed by",[kCe]:"TBA",[NCe]:"Next available",[ACe]:"NB"};function Hu(t){return typeof t=="function"}function jO(t){return typeof t=="object"&&!Array.isArray(t)}const $A="font-medium";function lm(t){const{target:e,button:i,stateChange:r}=t;let n=0;const a=()=>(n+=1,`Item${n}`),s=document.createElement("div");i.class&&s.classList.add(i.class),s.classList.add("dropdown"),i.id&&(s.id=i.id),i.align===xm?(s.classList.add("is-right"),s.style.marginLeft="1em"):s.style.marginRight="1em";const o=v=>v.classList.contains("is-active"),l=()=>{o(s)&&s.classList.remove("is-active")},u=v=>{o(v)?v.classList.remove("is-active"):v.classList.add("is-active")};s.onmouseleave=l,s.onclick=()=>u(s);const c=document.createElement("div");c.classList.add("dropdown-trigger");const d=document.createElement("button");d.className="button font-medium",i.intent&&d.classList.add(i.intent),d.setAttribute("aria-haspopup","true");const p=document.createElement("span");Hu(i.onClick)&&(p.onclick=i.onClick),p.style.marginRight="1em",p.innerHTML=i.label,d.appendChild(p);const f=document.createElement("span");Hu(i.onClick)&&(f.onclick=i.onClick),f.innerHTML=`
      <span class="icon is-small font-medium">
        â
      </span>
  `,f.style.height="2em",d.appendChild(f),c.appendChild(d),s.appendChild(c);const m=document.createElement("div");m.classList.add("dropdown-menu"),m.style.zIndex="99998";const h=document.createElement("div");h.classList.add("dropdown-content");const g=()=>{const v=m.querySelectorAll(".dropdown-item");for(const w of Array.from(v))w.classList.remove("is-active")},I=v=>{const w=document.createElement("a");w.className=$A;const y=v.disabled?"0.4":"1";return w.style.textDecoration="none",w.style.opacity=y,v.color&&(w.style.color=v.color),w.classList.add("dropdown-item"),v.isActive&&w.classList.add("is-active"),v.value&&w.setAttribute("value",v.value),v.class&&w.classList.add(v.class),w.onclick=b=>{if(v.disabled)return;v.value&&(d.value=v.value,s.setAttribute("value",v.value)),b.stopPropagation(),Hu(v.onClick)&&(Hu(r)&&r(),v.onClick(b)),v.close&&l();const S=o(w);g(),S?p.innerHTML=i.label:(i.selection&&u(w),i.modifyLabel&&v.modifyLabel!==!1&&(p.innerHTML=`${i.append?i.label+": ":""}${v?.label||a()}`))},w.innerHTML=v?.label||a(),w};for(const v of i.options||[])if(v.heading){const w=document.createElement("div");w.style.fontWeight="bold",w.classList.add("dropdown-item"),w.classList.add($A),w.innerHTML=v.heading,h.appendChild(w)}else if(v.divider){const w=document.createElement("hr");w.classList.add("dropdown-divider"),w.classList.add($A),h.appendChild(w)}else v.hide||h.appendChild(I(v));return i.options?.length&&(i.options[0].value&&s.setAttribute("value",i.options[0].value),m.appendChild(h)),s.appendChild(m),e&&e.appendChild(s),s}function LCe(t){if(t)for(;t.firstChild;)t.removeChild(t.firstChild)}class Ra{constructor(e){this.table=e}reloadData(e,i,r){return this.table.dataLoader.load(e,void 0,void 0,void 0,i,r)}langText(){return this.table.modules.localize.getText(...arguments)}langBind(){return this.table.modules.localize.bind(...arguments)}langLocale(){return this.table.modules.localize.getLocale(...arguments)}commsConnections(){return this.table.modules.comms.getConnections(...arguments)}commsSend(){return this.table.modules.comms.send(...arguments)}layoutMode(){return this.table.modules.layout.getMode()}layoutRefresh(e){return this.table.modules.layout.layout(e)}subscribe(){return this.table.eventBus.subscribe(...arguments)}unsubscribe(){return this.table.eventBus.unsubscribe(...arguments)}subscribed(e){return this.table.eventBus.subscribed(e)}subscriptionChange(){return this.table.eventBus.subscriptionChange(...arguments)}dispatch(){return this.table.eventBus.dispatch(...arguments)}chain(){return this.table.eventBus.chain(...arguments)}confirm(){return this.table.eventBus.confirm(...arguments)}dispatchExternal(){return this.table.externalEvents.dispatch(...arguments)}subscribedExternal(e){return this.table.externalEvents.subscribed(e)}subscriptionChangeExternal(){return this.table.externalEvents.subscriptionChange(...arguments)}options(e){return this.table.options[e]}setOption(e,i){return typeof i<"u"&&(this.table.options[e]=i),this.table.options[e]}deprecationCheck(e,i,r){return this.table.deprecationAdvisor.check(e,i,r)}deprecationCheckMsg(e,i){return this.table.deprecationAdvisor.checkMsg(e,i)}deprecationMsg(e){return this.table.deprecationAdvisor.msg(e)}module(e){return this.table.module(e)}}class gr{static elVisible(e){return!(e.offsetWidth<=0&&e.offsetHeight<=0)}static elOffset(e){var i=e.getBoundingClientRect();return{top:i.top+window.pageYOffset-document.documentElement.clientTop,left:i.left+window.pageXOffset-document.documentElement.clientLeft}}static retrieveNestedData(e,i,r){var n=e?i.split(e):[i],a=n.length,s;for(let o=0;o<a&&(r=r[n[o]],s=r,!!r);o++);return s}static deepClone(e,i,r=[]){var n={}.__proto__,a=[].__proto__;i||(i=Object.assign(Array.isArray(e)?[]:{},e));for(var s in e){let o=e[s],l,u;o!=null&&typeof o=="object"&&(o.__proto__===n||o.__proto__===a)&&(l=r.findIndex(c=>c.subject===o),l>-1?i[s]=r[l].copy:(u=Object.assign(Array.isArray(o)?[]:{},o),r.unshift({subject:o,copy:u}),i[s]=this.deepClone(o,u,r)))}return i}}let _Ce=class tee extends Ra{constructor(e,i,r){super(e),this.element=i,this.container=this._lookupContainer(),this.parent=r,this.reversedX=!1,this.childPopup=null,this.blurable=!1,this.blurCallback=null,this.blurEventsBound=!1,this.renderedCallback=null,this.visible=!1,this.hideable=!0,this.element.classList.add("tabulator-popup-container"),this.blurEvent=this.hide.bind(this,!1),this.escEvent=this._escapeCheck.bind(this),this.destroyBinding=this.tableDestroyed.bind(this),this.destroyed=!1}tableDestroyed(){this.destroyed=!0,this.hide(!0)}_lookupContainer(){var e=this.table.options.popupContainer;return typeof e=="string"?(e=document.querySelector(e),e||console.warn("Menu Error - no container element found matching selector:",this.table.options.popupContainer,"(defaulting to document body)")):e===!0&&(e=this.table.element),e&&!this._checkContainerIsParent(e)&&(e=!1,console.warn("Menu Error - container element does not contain this table:",this.table.options.popupContainer,"(defaulting to document body)")),e||(e=document.body),e}_checkContainerIsParent(e,i=this.table.element){return e===i?!0:i.parentNode?this._checkContainerIsParent(e,i.parentNode):!1}renderCallback(e){this.renderedCallback=e}containerEventCoords(e){var i=!(e instanceof MouseEvent),r=i?e.touches[0].pageX:e.pageX,n=i?e.touches[0].pageY:e.pageY;if(this.container!==document.body){let a=gr.elOffset(this.container);r-=a.left,n-=a.top}return{x:r,y:n}}elementPositionCoords(e,i="right"){var r=gr.elOffset(e),n,a,s;switch(this.container!==document.body&&(n=gr.elOffset(this.container),r.left-=n.left,r.top-=n.top),i){case"right":a=r.left+e.offsetWidth,s=r.top-1;break;case"bottom":a=r.left,s=r.top+e.offsetHeight;break;case"left":a=r.left,s=r.top-1;break;case"top":a=r.left,s=r.top;break;case"center":a=r.left+e.offsetWidth/2,s=r.top+e.offsetHeight/2;break}return{x:a,y:s,offset:r}}show(e,i){var r,n,a,s,o;return this.destroyed||this.table.destroyed?this:(e instanceof HTMLElement?(a=e,o=this.elementPositionCoords(e,i),s=o.offset,r=o.x,n=o.y):typeof e=="number"?(s={top:0,left:0},r=e,n=i):(o=this.containerEventCoords(e),r=o.x,n=o.y,this.reversedX=!1),this.element.style.top=n+"px",this.element.style.left=r+"px",this.container.appendChild(this.element),typeof this.renderedCallback=="function"&&this.renderedCallback(),this._fitToScreen(r,n,a,s,i),this.visible=!0,this.subscribe("table-destroy",this.destroyBinding),this.element.addEventListener("mousedown",l=>{l.stopPropagation()}),this)}_fitToScreen(e,i,r,n,a){var s=this.container===document.body?document.documentElement.scrollTop:this.container.scrollTop;(e+this.element.offsetWidth>=this.container.offsetWidth||this.reversedX)&&(this.element.style.left="",r?this.element.style.right=this.container.offsetWidth-n.left+"px":this.element.style.right=this.container.offsetWidth-e+"px",this.reversedX=!0);let o=Math.max(this.container.offsetHeight,s?this.container.scrollHeight:0);i+this.element.offsetHeight>o&&(r?a==="bottom"?this.element.style.top=parseInt(this.element.style.top)-this.element.offsetHeight-r.offsetHeight-1+"px":this.element.style.top=parseInt(this.element.style.top)-this.element.offsetHeight+r.offsetHeight+1+"px":this.element.style.height=o+"px")}isVisible(){return this.visible}hideOnBlur(e){return this.blurable=!0,this.visible&&(setTimeout(()=>{this.visible&&(this.table.rowManager.element.addEventListener("scroll",this.blurEvent),this.subscribe("cell-editing",this.blurEvent),document.body.addEventListener("click",this.blurEvent),document.body.addEventListener("contextmenu",this.blurEvent),document.body.addEventListener("mousedown",this.blurEvent),window.addEventListener("resize",this.blurEvent),document.body.addEventListener("keydown",this.escEvent),this.blurEventsBound=!0)},100),this.blurCallback=e),this}_escapeCheck(e){e.keyCode==27&&this.hide()}blockHide(){this.hideable=!1}restoreHide(){this.hideable=!0}hide(e=!1){return this.visible&&this.hideable&&(this.blurable&&this.blurEventsBound&&(document.body.removeEventListener("keydown",this.escEvent),document.body.removeEventListener("click",this.blurEvent),document.body.removeEventListener("contextmenu",this.blurEvent),document.body.removeEventListener("mousedown",this.blurEvent),window.removeEventListener("resize",this.blurEvent),this.table.rowManager.element.removeEventListener("scroll",this.blurEvent),this.unsubscribe("cell-editing",this.blurEvent),this.blurEventsBound=!1),this.childPopup&&this.childPopup.hide(),this.parent&&(this.parent.childPopup=null),this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.visible=!1,this.blurCallback&&!e&&this.blurCallback(),this.unsubscribe("table-destroy",this.destroyBinding)),this}child(e){return this.childPopup&&this.childPopup.hide(),this.childPopup=new tee(this.table,e,this),this.childPopup}};class si extends Ra{constructor(e,i){super(e),this._handler=null}initialize(){}registerTableOption(e,i){this.table.optionsList.register(e,i)}registerColumnOption(e,i){this.table.columnManager.optionsList.register(e,i)}registerTableFunction(e,i){typeof this.table[e]>"u"?this.table[e]=(...r)=>(this.table.initGuard(e),i(...r)):console.warn("Unable to bind table function, name already in use",e)}registerComponentFunction(e,i,r){return this.table.componentFunctionBinder.bind(e,i,r)}registerDataHandler(e,i){this.table.rowManager.registerDataPipelineHandler(e,i),this._handler=e}registerDisplayHandler(e,i){this.table.rowManager.registerDisplayPipelineHandler(e,i),this._handler=e}displayRows(e){var i=this.table.rowManager.displayRows.length-1,r;if(this._handler&&(r=this.table.rowManager.displayPipeline.findIndex(n=>n.handler===this._handler),r>-1&&(i=r)),e&&(i=i+e),this._handler)return i>-1?this.table.rowManager.getDisplayRows(i):this.activeRows()}activeRows(){return this.table.rowManager.activeRows}refreshData(e,i){i||(i=this._handler),i&&this.table.rowManager.refreshActiveData(i,!1,e)}footerAppend(e){return this.table.footerManager.append(e)}footerPrepend(e){return this.table.footerManager.prepend(e)}footerRemove(e){return this.table.footerManager.remove(e)}popup(e,i){return new _Ce(this.table,e,i)}alert(e,i){return this.table.alertManager.alert(e,i)}clearAlert(){return this.table.alertManager.clear()}}var $Ce={rownum:function(t,e,i,r,n,a){return a.getPosition()}};class hP extends si{static moduleName="accessor";static accessors=$Ce;constructor(e){super(e),this.allowedTypes=["","data","download","clipboard","print","htmlOutput"],this.registerColumnOption("accessor"),this.registerColumnOption("accessorParams"),this.registerColumnOption("accessorData"),this.registerColumnOption("accessorDataParams"),this.registerColumnOption("accessorDownload"),this.registerColumnOption("accessorDownloadParams"),this.registerColumnOption("accessorClipboard"),this.registerColumnOption("accessorClipboardParams"),this.registerColumnOption("accessorPrint"),this.registerColumnOption("accessorPrintParams"),this.registerColumnOption("accessorHtmlOutput"),this.registerColumnOption("accessorHtmlOutputParams")}initialize(){this.subscribe("column-layout",this.initializeColumn.bind(this)),this.subscribe("row-data-retrieve",this.transformRow.bind(this))}initializeColumn(e){var i=!1,r={};this.allowedTypes.forEach(n=>{var a="accessor"+(n.charAt(0).toUpperCase()+n.slice(1)),s;e.definition[a]&&(s=this.lookupAccessor(e.definition[a]),s&&(i=!0,r[a]={accessor:s,params:e.definition[a+"Params"]||{}}))}),i&&(e.modules.accessor=r)}lookupAccessor(e){var i=!1;switch(typeof e){case"string":hP.accessors[e]?i=hP.accessors[e]:console.warn("Accessor Error - No such accessor found, ignoring: ",e);break;case"function":i=e;break}return i}transformRow(e,i){var r="accessor"+(i.charAt(0).toUpperCase()+i.slice(1)),n=e.getComponent(),a=gr.deepClone(e.data||{});return this.table.columnManager.traverse(function(s){var o,l,u,c;s.modules.accessor&&(l=s.modules.accessor[r]||s.modules.accessor.accessor||!1,l&&(o=s.getFieldValue(a),o!="undefined"&&(c=s.getComponent(),u=typeof l.params=="function"?l.params(o,a,i,c,n):l.params,s.setFieldValue(a,l.accessor(o,a,i,u,c,n)))))}),a}}var BCe={method:"GET"};function GO(t,e){var i=[];if(e=e||"",Array.isArray(t))t.forEach((n,a)=>{i=i.concat(GO(n,e?e+"["+a+"]":a))});else if(typeof t=="object")for(var r in t)i=i.concat(GO(t[r],e?e+"["+r+"]":r));else i.push({key:e,value:t});return i}function VCe(t){var e=GO(t),i=[];return e.forEach(function(r){i.push(encodeURIComponent(r.key)+"="+encodeURIComponent(r.value))}),i.join("&")}function iee(t,e,i){return t&&i&&Object.keys(i).length&&(!e.method||e.method.toLowerCase()=="get")&&(e.method="get",t+=(t.includes("?")?"&":"?")+VCe(i)),t}function jCe(t,e,i){var r;return new Promise((n,a)=>{if(t=this.urlGenerator.call(this.table,t,e,i),e.method.toUpperCase()!="GET")if(r=typeof this.table.options.ajaxContentType=="object"?this.table.options.ajaxContentType:this.contentTypeFormatters[this.table.options.ajaxContentType],r){for(var s in r.headers)e.headers||(e.headers={}),typeof e.headers[s]>"u"&&(e.headers[s]=r.headers[s]);e.body=r.body.call(this,t,e,i)}else console.warn("Ajax Error - Invalid ajaxContentType value:",this.table.options.ajaxContentType);t?(typeof e.headers>"u"&&(e.headers={}),typeof e.headers.Accept>"u"&&(e.headers.Accept="application/json"),typeof e.headers["X-Requested-With"]>"u"&&(e.headers["X-Requested-With"]="XMLHttpRequest"),typeof e.mode>"u"&&(e.mode="cors"),e.mode=="cors"?(typeof e.headers.Origin>"u"&&(e.headers.Origin=window.location.origin),typeof e.credentials>"u"&&(e.credentials="same-origin")):typeof e.credentials>"u"&&(e.credentials="include"),fetch(t,e).then(o=>{o.ok?o.json().then(l=>{n(l)}).catch(l=>{a(l),console.warn("Ajax Load Error - Invalid JSON returned",l)}):(console.error("Ajax Load Error - Connection Error: "+o.status,o.statusText),a(o))}).catch(o=>{console.error("Ajax Load Error - Connection Error: ",o),a(o)})):(console.warn("Ajax Load Error - No URL Set"),n([]))})}function HO(t,e){var i=[];if(e=e||"",Array.isArray(t))t.forEach((n,a)=>{i=i.concat(HO(n,e?e+"["+a+"]":a))});else if(typeof t=="object")for(var r in t)i=i.concat(HO(t[r],e?e+"["+r+"]":r));else i.push({key:e,value:t});return i}var GCe={json:{headers:{"Content-Type":"application/json"},body:function(t,e,i){return JSON.stringify(i)}},form:{headers:{},body:function(t,e,i){var r=HO(i),n=new FormData;return r.forEach(function(a){n.append(a.key,a.value)}),n}}};class Eg extends si{static moduleName="ajax";static defaultConfig=BCe;static defaultURLGenerator=iee;static defaultLoaderPromise=jCe;static contentTypeFormatters=GCe;constructor(e){super(e),this.config={},this.url="",this.urlGenerator=!1,this.params=!1,this.loaderPromise=!1,this.registerTableOption("ajaxURL",!1),this.registerTableOption("ajaxURLGenerator",!1),this.registerTableOption("ajaxParams",{}),this.registerTableOption("ajaxConfig","get"),this.registerTableOption("ajaxContentType","form"),this.registerTableOption("ajaxRequestFunc",!1),this.registerTableOption("ajaxRequesting",function(){}),this.registerTableOption("ajaxResponse",!1),this.contentTypeFormatters=Eg.contentTypeFormatters}initialize(){this.loaderPromise=this.table.options.ajaxRequestFunc||Eg.defaultLoaderPromise,this.urlGenerator=this.table.options.ajaxURLGenerator||Eg.defaultURLGenerator,this.table.options.ajaxURL&&this.setUrl(this.table.options.ajaxURL),this.setDefaultConfig(this.table.options.ajaxConfig),this.registerTableFunction("getAjaxUrl",this.getUrl.bind(this)),this.subscribe("data-loading",this.requestDataCheck.bind(this)),this.subscribe("data-params",this.requestParams.bind(this)),this.subscribe("data-load",this.requestData.bind(this))}requestParams(e,i,r,n){var a=this.table.options.ajaxParams;return a&&(typeof a=="function"&&(a=a.call(this.table)),n=Object.assign(Object.assign({},a),n)),n}requestDataCheck(e,i,r,n){return!!(!e&&this.url||typeof e=="string")}requestData(e,i,r,n,a){var s;return!a&&this.requestDataCheck(e)?(e&&this.setUrl(e),s=this.generateConfig(r),this.sendRequest(this.url,i,s)):a}setDefaultConfig(e={}){this.config=Object.assign({},Eg.defaultConfig),typeof e=="string"?this.config.method=e:Object.assign(this.config,e)}generateConfig(e={}){var i=Object.assign({},this.config);return typeof e=="string"?i.method=e:Object.assign(i,e),i}setUrl(e){this.url=e}getUrl(){return this.url}sendRequest(e,i,r){return this.table.options.ajaxRequesting.call(this.table,e,i)!==!1?this.loaderPromise(e,r,i).then(n=>(this.table.options.ajaxResponse&&(n=this.table.options.ajaxResponse.call(this.table,e,i,n)),n)):Promise.reject()}}var HCe={replace:function(t){return this.table.setData(t)},update:function(t){return this.table.updateOrAddData(t)},insert:function(t){return this.table.addData(t)}},WCe={table:function(t){var e=[],i=!0,r=this.table.columnManager.columns,n=[],a=[];return t=t.split(`
`),t.forEach(function(s){e.push(s.split("	"))}),e.length&&!(e.length===1&&e[0].length<2)?(e[0].forEach(function(s){var o=r.find(function(l){return s&&l.definition.title&&s.trim()&&l.definition.title.trim()===s.trim()});o?n.push(o):i=!1}),i||(i=!0,n=[],e[0].forEach(function(s){var o=r.find(function(l){return s&&l.field&&s.trim()&&l.field.trim()===s.trim()});o?n.push(o):i=!1}),i||(n=this.table.columnManager.columnsByIndex)),i&&e.shift(),e.forEach(function(s){var o={};s.forEach(function(l,u){n[u]&&(o[n[u].field]=l)}),a.push(o)}),a):!1}},zCe={copyToClipboard:["ctrl + 67","meta + 67"]},qCe={copyToClipboard:function(t){this.table.modules.edit.currentCell||this.table.modExists("clipboard",!0)&&this.table.modules.clipboard.copy(!1,!0)}},YCe={keybindings:{bindings:zCe,actions:qCe}};class gP extends si{static moduleName="clipboard";static moduleExtensions=YCe;static pasteActions=HCe;static pasteParsers=WCe;constructor(e){super(e),this.mode=!0,this.pasteParser=function(){},this.pasteAction=function(){},this.customSelection=!1,this.rowRange=!1,this.blocked=!0,this.registerTableOption("clipboard",!1),this.registerTableOption("clipboardCopyStyled",!0),this.registerTableOption("clipboardCopyConfig",!1),this.registerTableOption("clipboardCopyFormatter",!1),this.registerTableOption("clipboardCopyRowRange","active"),this.registerTableOption("clipboardPasteParser","table"),this.registerTableOption("clipboardPasteAction","insert"),this.registerColumnOption("clipboard"),this.registerColumnOption("titleClipboard")}initialize(){this.mode=this.table.options.clipboard,this.rowRange=this.table.options.clipboardCopyRowRange,(this.mode===!0||this.mode==="copy")&&this.table.element.addEventListener("copy",e=>{var i,r,n;this.blocked||(e.preventDefault(),this.customSelection?(i=this.customSelection,this.table.options.clipboardCopyFormatter&&(i=this.table.options.clipboardCopyFormatter("plain",i))):(n=this.table.modules.export.generateExportList(this.table.options.clipboardCopyConfig,this.table.options.clipboardCopyStyled,this.rowRange,"clipboard"),r=this.table.modules.export.generateHTMLTable(n),i=r?this.generatePlainContent(n):"",this.table.options.clipboardCopyFormatter&&(i=this.table.options.clipboardCopyFormatter("plain",i),r=this.table.options.clipboardCopyFormatter("html",r))),window.clipboardData&&window.clipboardData.setData?window.clipboardData.setData("Text",i):e.clipboardData&&e.clipboardData.setData?(e.clipboardData.setData("text/plain",i),r&&e.clipboardData.setData("text/html",r)):e.originalEvent&&e.originalEvent.clipboardData.setData&&(e.originalEvent.clipboardData.setData("text/plain",i),r&&e.originalEvent.clipboardData.setData("text/html",r)),this.dispatchExternal("clipboardCopied",i,r),this.reset())}),(this.mode===!0||this.mode==="paste")&&this.table.element.addEventListener("paste",e=>{this.paste(e)}),this.setPasteParser(this.table.options.clipboardPasteParser),this.setPasteAction(this.table.options.clipboardPasteAction),this.registerTableFunction("copyToClipboard",this.copy.bind(this))}reset(){this.blocked=!0,this.customSelection=!1}generatePlainContent(e){var i=[];return e.forEach(r=>{var n=[];r.columns.forEach(a=>{var s="";if(a)if(r.type==="group"&&(a.value=a.component.getKey()),a.value===null)s="";else switch(typeof a.value){case"object":s=JSON.stringify(a.value);break;case"undefined":s="";break;default:s=a.value}n.push(s)}),i.push(n.join("	"))}),i.join(`
`)}copy(e,i){var r,n;this.blocked=!1,this.customSelection=!1,(this.mode===!0||this.mode==="copy")&&(this.rowRange=e||this.table.options.clipboardCopyRowRange,typeof window.getSelection<"u"&&typeof document.createRange<"u"?(e=document.createRange(),e.selectNodeContents(this.table.element),r=window.getSelection(),r.toString()&&i&&(this.customSelection=r.toString()),r.removeAllRanges(),r.addRange(e)):typeof document.selection<"u"&&typeof document.body.createTextRange<"u"&&(n=document.body.createTextRange(),n.moveToElementText(this.table.element),n.select()),document.execCommand("copy"),r&&r.removeAllRanges())}setPasteAction(e){switch(typeof e){case"string":this.pasteAction=gP.pasteActions[e],this.pasteAction||console.warn("Clipboard Error - No such paste action found:",e);break;case"function":this.pasteAction=e;break}}setPasteParser(e){switch(typeof e){case"string":this.pasteParser=gP.pasteParsers[e],this.pasteParser||console.warn("Clipboard Error - No such paste parser found:",e);break;case"function":this.pasteParser=e;break}}paste(e){var i,r,n;this.checkPasteOrigin(e)&&(i=this.getPasteData(e),r=this.pasteParser.call(this,i),r?(e.preventDefault(),this.table.modExists("mutator")&&(r=this.mutateData(r)),n=this.pasteAction.call(this,r),this.dispatchExternal("clipboardPasted",i,r,n)):this.dispatchExternal("clipboardPasteError",i))}mutateData(e){var i=[];return Array.isArray(e)?e.forEach(r=>{i.push(this.table.modules.mutator.transformRow(r,"clipboard"))}):i=e,i}checkPasteOrigin(e){var i=!0,r=this.confirm("clipboard-paste",[e]);return(r||!["DIV","SPAN"].includes(e.target.tagName))&&(i=!1),i}getPasteData(e){var i;return window.clipboardData&&window.clipboardData.getData?i=window.clipboardData.getData("Text"):e.clipboardData&&e.clipboardData.getData?i=e.clipboardData.getData("text/plain"):e.originalEvent&&e.originalEvent.clipboardData.getData&&(i=e.originalEvent.clipboardData.getData("text/plain")),i}}class KCe{constructor(e){return this._row=e,new Proxy(this,{get:function(i,r,n){return typeof i[r]<"u"?i[r]:i._row.table.componentFunctionBinder.handle("row",i._row,r)}})}getData(e){return this._row.getData(e)}getElement(){return this._row.getElement()}getTable(){return this._row.table}getCells(){var e=[];return this._row.getCells().forEach(function(i){e.push(i.getComponent())}),e}getCell(e){var i=this._row.getCell(e);return i?i.getComponent():!1}_getSelf(){return this._row}}class ree{constructor(e){return this._cell=e,new Proxy(this,{get:function(i,r,n){return typeof i[r]<"u"?i[r]:i._cell.table.componentFunctionBinder.handle("cell",i._cell,r)}})}getValue(){return this._cell.getValue()}getOldValue(){return this._cell.getOldValue()}getInitialValue(){return this._cell.initialValue}getElement(){return this._cell.getElement()}getRow(){return this._cell.row.getComponent()}getData(e){return this._cell.row.getData(e)}getType(){return"cell"}getField(){return this._cell.column.getField()}getColumn(){return this._cell.column.getComponent()}setValue(e,i){typeof i>"u"&&(i=!0),this._cell.setValue(e,i)}restoreOldValue(){this._cell.setValueActual(this._cell.getOldValue())}restoreInitialValue(){this._cell.setValueActual(this._cell.initialValue)}checkHeight(){this._cell.checkHeight()}getTable(){return this._cell.table}_getSelf(){return this._cell}}class $S extends Ra{constructor(e,i){super(e.table),this.table=e.table,this.column=e,this.row=i,this.element=null,this.value=null,this.initialValue,this.oldValue=null,this.modules={},this.height=null,this.width=null,this.minWidth=null,this.component=null,this.loaded=!1,this.build()}build(){this.generateElement(),this.setWidth(),this._configureCell(),this.setValueActual(this.column.getFieldValue(this.row.data)),this.initialValue=this.value}generateElement(){this.element=document.createElement("div"),this.element.className="tabulator-cell",this.element.setAttribute("role","gridcell"),this.column.isRowHeader&&this.element.classList.add("tabulator-row-header")}_configureCell(){var e=this.element,i=this.column.getField(),r={top:"flex-start",bottom:"flex-end",middle:"center"},n={left:"flex-start",right:"flex-end",center:"center"};if(e.style.textAlign=this.column.hozAlign,this.column.vertAlign&&(e.style.display="inline-flex",e.style.alignItems=r[this.column.vertAlign]||"",this.column.hozAlign&&(e.style.justifyContent=n[this.column.hozAlign]||"")),i&&e.setAttribute("tabulator-field",i),this.column.definition.cssClass){var a=this.column.definition.cssClass.split(" ");a.forEach(s=>{e.classList.add(s)})}this.dispatch("cell-init",this),this.column.visible||this.hide()}_generateContents(){var e;switch(e=this.chain("cell-format",this,null,()=>this.element.innerHTML=this.value),typeof e){case"object":if(e instanceof Node){for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.element.appendChild(e)}else this.element.innerHTML="",e!=null&&console.warn("Format Error - Formatter has returned a type of object, the only valid formatter object return is an instance of Node, the formatter returned:",e);break;case"undefined":this.element.innerHTML="";break;default:this.element.innerHTML=e}}cellRendered(){this.dispatch("cell-rendered",this)}getElement(e){return this.loaded||(this.loaded=!0,e||this.layoutElement()),this.element}getValue(){return this.value}getOldValue(){return this.oldValue}setValue(e,i,r){var n=this.setValueProcessData(e,i,r);n&&(this.dispatch("cell-value-updated",this),this.cellRendered(),this.column.definition.cellEdited&&this.column.definition.cellEdited.call(this.table,this.getComponent()),this.dispatchExternal("cellEdited",this.getComponent()),this.subscribedExternal("dataChanged")&&this.dispatchExternal("dataChanged",this.table.rowManager.getData()))}setValueProcessData(e,i,r){var n=!1;return(this.value!==e||r)&&(n=!0,i&&(e=this.chain("cell-value-changing",[this,e],null,e))),this.setValueActual(e),n&&this.dispatch("cell-value-changed",this),n}setValueActual(e){this.oldValue=this.value,this.value=e,this.dispatch("cell-value-save-before",this),this.column.setFieldValue(this.row.data,e),this.dispatch("cell-value-save-after",this),this.loaded&&this.layoutElement()}layoutElement(){this._generateContents(),this.dispatch("cell-layout",this)}setWidth(){this.width=this.column.width,this.element.style.width=this.column.widthStyled}clearWidth(){this.width="",this.element.style.width=""}getWidth(){return this.width||this.element.offsetWidth}setMinWidth(){this.minWidth=this.column.minWidth,this.element.style.minWidth=this.column.minWidthStyled}setMaxWidth(){this.maxWidth=this.column.maxWidth,this.element.style.maxWidth=this.column.maxWidthStyled}checkHeight(){this.row.reinitializeHeight()}clearHeight(){this.element.style.height="",this.height=null,this.dispatch("cell-height",this,"")}setHeight(){this.height=this.row.height,this.element.style.height=this.row.heightStyled,this.dispatch("cell-height",this,this.row.heightStyled)}getHeight(){return this.height||this.element.offsetHeight}show(){this.element.style.display=this.column.vertAlign?"inline-flex":""}hide(){this.element.style.display="none"}delete(){this.dispatch("cell-delete",this),!this.table.rowManager.redrawBlock&&this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.element=!1,this.column.deleteCell(this),this.row.deleteCell(this),this.calcs={}}getIndex(){return this.row.getCellIndex(this)}getComponent(){return this.component||(this.component=new ree(this)),this.component}}class nee{constructor(e){return this._column=e,this.type="ColumnComponent",new Proxy(this,{get:function(i,r,n){return typeof i[r]<"u"?i[r]:i._column.table.componentFunctionBinder.handle("column",i._column,r)}})}getElement(){return this._column.getElement()}getDefinition(){return this._column.getDefinition()}getField(){return this._column.getField()}getTitleDownload(){return this._column.getTitleDownload()}getCells(){var e=[];return this._column.cells.forEach(function(i){e.push(i.getComponent())}),e}isVisible(){return this._column.visible}show(){this._column.isGroup?this._column.columns.forEach(function(e){e.show()}):this._column.show()}hide(){this._column.isGroup?this._column.columns.forEach(function(e){e.hide()}):this._column.hide()}toggle(){this._column.visible?this.hide():this.show()}delete(){return this._column.delete()}getSubColumns(){var e=[];return this._column.columns.length&&this._column.columns.forEach(function(i){e.push(i.getComponent())}),e}getParentColumn(){return this._column.getParentComponent()}_getSelf(){return this._column}scrollTo(e,i){return this._column.table.columnManager.scrollToColumn(this._column,e,i)}getTable(){return this._column.table}move(e,i){var r=this._column.table.columnManager.findColumn(e);r?this._column.table.columnManager.moveColumn(this._column,r,i):console.warn("Move Error - No matching column found:",r)}getNextColumn(){var e=this._column.nextColumn();return e?e.getComponent():!1}getPrevColumn(){var e=this._column.prevColumn();return e?e.getComponent():!1}updateDefinition(e){return this._column.updateDefinition(e)}getWidth(){return this._column.getWidth()}setWidth(e){var i;return e===!0?i=this._column.reinitializeWidth(!0):i=this._column.setWidth(e),this._column.table.columnManager.rerenderColumns(!0),i}}var aee={title:void 0,field:void 0,columns:void 0,visible:void 0,hozAlign:void 0,vertAlign:void 0,width:void 0,minWidth:40,maxWidth:void 0,maxInitialWidth:void 0,cssClass:void 0,variableHeight:void 0,headerVertical:void 0,headerHozAlign:void 0,headerWordWrap:!1,editableTitle:void 0};class Wu extends Ra{static defaultOptionList=aee;constructor(e,i,r){super(i.table),this.definition=e,this.parent=i,this.type="column",this.columns=[],this.cells=[],this.isGroup=!1,this.isRowHeader=r,this.element=this.createElement(),this.contentElement=!1,this.titleHolderElement=!1,this.titleElement=!1,this.groupElement=this.createGroupElement(),this.hozAlign="",this.vertAlign="",this.field="",this.fieldStructure="",this.getFieldValue="",this.setFieldValue="",this.titleDownload=null,this.titleFormatterRendered=!1,this.mapDefinitions(),this.setField(this.definition.field),this.modules={},this.width=null,this.widthStyled="",this.maxWidth=null,this.maxWidthStyled="",this.maxInitialWidth=null,this.minWidth=null,this.minWidthStyled="",this.widthFixed=!1,this.visible=!0,this.component=null,this.definition.columns?(this.isGroup=!0,this.definition.columns.forEach((n,a)=>{var s=new Wu(n,this);this.attachColumn(s)}),this.checkColumnVisibility()):i.registerColumnField(this),this._initialize()}createElement(){var e=document.createElement("div");switch(e.classList.add("tabulator-col"),e.setAttribute("role","columnheader"),e.setAttribute("aria-sort","none"),this.isRowHeader&&e.classList.add("tabulator-row-header"),this.table.options.columnHeaderVertAlign){case"middle":e.style.justifyContent="center";break;case"bottom":e.style.justifyContent="flex-end";break}return e}createGroupElement(){var e=document.createElement("div");return e.classList.add("tabulator-col-group-cols"),e}mapDefinitions(){var e=this.table.options.columnDefaults;if(e)for(let i in e)typeof this.definition[i]>"u"&&(this.definition[i]=e[i]);this.definition=this.table.columnManager.optionsList.generate(Wu.defaultOptionList,this.definition)}checkDefinition(){Object.keys(this.definition).forEach(e=>{Wu.defaultOptionList.indexOf(e)===-1&&console.warn("Invalid column definition option in '"+(this.field||this.definition.title)+"' column:",e)})}setField(e){this.field=e,this.fieldStructure=e?this.table.options.nestedFieldSeparator?e.split(this.table.options.nestedFieldSeparator):[e]:[],this.getFieldValue=this.fieldStructure.length>1?this._getNestedData:this._getFlatData,this.setFieldValue=this.fieldStructure.length>1?this._setNestedData:this._setFlatData}registerColumnPosition(e){this.parent.registerColumnPosition(e)}registerColumnField(e){this.parent.registerColumnField(e)}reRegisterPosition(){this.isGroup?this.columns.forEach(function(e){e.reRegisterPosition()}):this.registerColumnPosition(this)}_initialize(){for(var e=this.definition;this.element.firstChild;)this.element.removeChild(this.element.firstChild);e.headerVertical&&(this.element.classList.add("tabulator-col-vertical"),e.headerVertical==="flip"&&this.element.classList.add("tabulator-col-vertical-flip")),this.contentElement=this._buildColumnHeaderContent(),this.element.appendChild(this.contentElement),this.isGroup?this._buildGroupHeader():this._buildColumnHeader(),this.dispatch("column-init",this)}_buildColumnHeader(){var e=this.definition;if(this.dispatch("column-layout",this),typeof e.visible<"u"&&(e.visible?this.show(!0):this.hide(!0)),e.cssClass){var i=e.cssClass.split(" ");i.forEach(r=>{this.element.classList.add(r)})}e.field&&this.element.setAttribute("tabulator-field",e.field),this.setMinWidth(parseInt(e.minWidth)),e.maxInitialWidth&&(this.maxInitialWidth=parseInt(e.maxInitialWidth)),e.maxWidth&&this.setMaxWidth(parseInt(e.maxWidth)),this.reinitializeWidth(),this.hozAlign=this.definition.hozAlign,this.vertAlign=this.definition.vertAlign,this.titleElement.style.textAlign=this.definition.headerHozAlign}_buildColumnHeaderContent(){var e=document.createElement("div");return e.classList.add("tabulator-col-content"),this.titleHolderElement=document.createElement("div"),this.titleHolderElement.classList.add("tabulator-col-title-holder"),e.appendChild(this.titleHolderElement),this.titleElement=this._buildColumnHeaderTitle(),this.titleHolderElement.appendChild(this.titleElement),e}_buildColumnHeaderTitle(){var e=this.definition,i=document.createElement("div");if(i.classList.add("tabulator-col-title"),e.headerWordWrap&&i.classList.add("tabulator-col-title-wrap"),e.editableTitle){var r=document.createElement("input");r.classList.add("tabulator-title-editor"),r.addEventListener("click",n=>{n.stopPropagation(),r.focus()}),r.addEventListener("mousedown",n=>{n.stopPropagation()}),r.addEventListener("change",()=>{e.title=r.value,this.dispatchExternal("columnTitleChanged",this.getComponent())}),i.appendChild(r),e.field?this.langBind("columns|"+e.field,n=>{r.value=n||e.title||"&nbsp;"}):r.value=e.title||"&nbsp;"}else e.field?this.langBind("columns|"+e.field,n=>{this._formatColumnHeaderTitle(i,n||e.title||"&nbsp;")}):this._formatColumnHeaderTitle(i,e.title||"&nbsp;");return i}_formatColumnHeaderTitle(e,i){var r=this.chain("column-format",[this,i,e],null,()=>i);switch(typeof r){case"object":r instanceof Node?e.appendChild(r):(e.innerHTML="",console.warn("Format Error - Title formatter has returned a type of object, the only valid formatter object return is an instance of Node, the formatter returned:",r));break;case"undefined":e.innerHTML="";break;default:e.innerHTML=r}}_buildGroupHeader(){if(this.element.classList.add("tabulator-col-group"),this.element.setAttribute("role","columngroup"),this.element.setAttribute("aria-title",this.definition.title),this.definition.cssClass){var e=this.definition.cssClass.split(" ");e.forEach(i=>{this.element.classList.add(i)})}this.titleElement.style.textAlign=this.definition.headerHozAlign,this.element.appendChild(this.groupElement)}_getFlatData(e){return e[this.field]}_getNestedData(e){var i=e,r=this.fieldStructure,n=r.length,a;for(let s=0;s<n&&(i=i[r[s]],a=i,!!i);s++);return a}_setFlatData(e,i){this.field&&(e[this.field]=i)}_setNestedData(e,i){var r=e,n=this.fieldStructure,a=n.length;for(let s=0;s<a;s++)if(s==a-1)r[n[s]]=i;else{if(!r[n[s]])if(typeof i<"u")r[n[s]]={};else break;r=r[n[s]]}}attachColumn(e){this.groupElement?(this.columns.push(e),this.groupElement.appendChild(e.getElement()),e.columnRendered()):console.warn("Column Warning - Column being attached to another column instead of column group")}verticalAlign(e,i){var r=this.parent.isGroup?this.parent.getGroupElement().clientHeight:i||this.parent.getHeadersElement().clientHeight;this.element.style.height=r+"px",this.dispatch("column-height",this,this.element.style.height),this.isGroup&&(this.groupElement.style.minHeight=r-this.contentElement.offsetHeight+"px"),this.columns.forEach(function(n){n.verticalAlign(e)})}clearVerticalAlign(){this.element.style.paddingTop="",this.element.style.height="",this.element.style.minHeight="",this.groupElement.style.minHeight="",this.columns.forEach(function(e){e.clearVerticalAlign()}),this.dispatch("column-height",this,"")}getElement(){return this.element}getGroupElement(){return this.groupElement}getField(){return this.field}getTitleDownload(){return this.titleDownload}getFirstColumn(){return this.isGroup?this.columns.length?this.columns[0].getFirstColumn():!1:this}getLastColumn(){return this.isGroup?this.columns.length?this.columns[this.columns.length-1].getLastColumn():!1:this}getColumns(e){var i=[];return e?this.columns.forEach(r=>{i.push(r),i=i.concat(r.getColumns(!0))}):i=this.columns,i}getCells(){return this.cells}getTopColumn(){return this.parent.isGroup?this.parent.getTopColumn():this}getDefinition(e){var i=[];return this.isGroup&&e&&(this.columns.forEach(function(r){i.push(r.getDefinition(!0))}),this.definition.columns=i),this.definition}checkColumnVisibility(){var e=!1;this.columns.forEach(function(i){i.visible&&(e=!0)}),e?(this.show(),this.dispatchExternal("columnVisibilityChanged",this.getComponent(),!1)):this.hide()}show(e,i){this.visible||(this.visible=!0,this.element.style.display="",this.parent.isGroup&&this.parent.checkColumnVisibility(),this.cells.forEach(function(r){r.show()}),!this.isGroup&&this.width===null&&this.reinitializeWidth(),this.table.columnManager.verticalAlignHeaders(),this.dispatch("column-show",this,i),e||this.dispatchExternal("columnVisibilityChanged",this.getComponent(),!0),this.parent.isGroup&&this.parent.matchChildWidths(),this.silent||this.table.columnManager.rerenderColumns())}hide(e,i){this.visible&&(this.visible=!1,this.element.style.display="none",this.table.columnManager.verticalAlignHeaders(),this.parent.isGroup&&this.parent.checkColumnVisibility(),this.cells.forEach(function(r){r.hide()}),this.dispatch("column-hide",this,i),e||this.dispatchExternal("columnVisibilityChanged",this.getComponent(),!1),this.parent.isGroup&&this.parent.matchChildWidths(),this.silent||this.table.columnManager.rerenderColumns())}matchChildWidths(){var e=0;this.contentElement&&this.columns.length&&(this.columns.forEach(function(i){i.visible&&(e+=i.getWidth())}),this.contentElement.style.maxWidth=e-1+"px",this.table.initialized&&(this.element.style.width=e+"px"),this.parent.isGroup&&this.parent.matchChildWidths())}removeChild(e){var i=this.columns.indexOf(e);i>-1&&this.columns.splice(i,1),this.columns.length||this.delete()}setWidth(e){this.widthFixed=!0,this.setWidthActual(e)}setWidthActual(e){isNaN(e)&&(e=Math.floor(this.table.element.clientWidth/100*parseInt(e))),e=Math.max(this.minWidth,e),this.maxWidth&&(e=Math.min(this.maxWidth,e)),this.width=e,this.widthStyled=e?e+"px":"",this.element.style.width=this.widthStyled,this.isGroup||this.cells.forEach(function(i){i.setWidth()}),this.parent.isGroup&&this.parent.matchChildWidths(),this.dispatch("column-width",this),this.subscribedExternal("columnWidth")&&this.dispatchExternal("columnWidth",this.getComponent())}checkCellHeights(){var e=[];this.cells.forEach(function(i){i.row.heightInitialized&&(i.row.getElement().offsetParent!==null?(e.push(i.row),i.row.clearCellHeight()):i.row.heightInitialized=!1)}),e.forEach(function(i){i.calcHeight()}),e.forEach(function(i){i.setCellHeight()})}getWidth(){var e=0;return this.isGroup?this.columns.forEach(function(i){i.visible&&(e+=i.getWidth())}):e=this.width,e}getLeftOffset(){var e=this.element.offsetLeft;return this.parent.isGroup&&(e+=this.parent.getLeftOffset()),e}getHeight(){return Math.ceil(this.element.getBoundingClientRect().height)}setMinWidth(e){this.maxWidth&&e>this.maxWidth&&(e=this.maxWidth,console.warn("the minWidth ("+e+"px) for column '"+this.field+"' cannot be bigger that its maxWidth ("+this.maxWidthStyled+")")),this.minWidth=e,this.minWidthStyled=e?e+"px":"",this.element.style.minWidth=this.minWidthStyled,this.cells.forEach(function(i){i.setMinWidth()})}setMaxWidth(e){this.minWidth&&e<this.minWidth&&(e=this.minWidth,console.warn("the maxWidth ("+e+"px) for column '"+this.field+"' cannot be smaller that its minWidth ("+this.minWidthStyled+")")),this.maxWidth=e,this.maxWidthStyled=e?e+"px":"",this.element.style.maxWidth=this.maxWidthStyled,this.cells.forEach(function(i){i.setMaxWidth()})}delete(){return new Promise((e,i)=>{this.isGroup&&this.columns.forEach(function(n){n.delete()}),this.dispatch("column-delete",this);var r=this.cells.length;for(let n=0;n<r;n++)this.cells[0].delete();this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.element=!1,this.contentElement=!1,this.titleElement=!1,this.groupElement=!1,this.parent.isGroup&&this.parent.removeChild(this),this.table.columnManager.deregisterColumn(this),this.table.columnManager.rerenderColumns(!0),this.dispatch("column-deleted",this),e()})}columnRendered(){this.titleFormatterRendered&&this.titleFormatterRendered(),this.dispatch("column-rendered",this)}generateCell(e){var i=new $S(this,e);return this.cells.push(i),i}nextColumn(){var e=this.table.columnManager.findColumnIndex(this);return e>-1?this._nextVisibleColumn(e+1):!1}_nextVisibleColumn(e){var i=this.table.columnManager.getColumnByIndex(e);return!i||i.visible?i:this._nextVisibleColumn(e+1)}prevColumn(){var e=this.table.columnManager.findColumnIndex(this);return e>-1?this._prevVisibleColumn(e-1):!1}_prevVisibleColumn(e){var i=this.table.columnManager.getColumnByIndex(e);return!i||i.visible?i:this._prevVisibleColumn(e-1)}reinitializeWidth(e){this.widthFixed=!1,typeof this.definition.width<"u"&&!e&&this.setWidth(this.definition.width),this.dispatch("column-width-fit-before",this),this.fitToData(e),this.dispatch("column-width-fit-after",this)}fitToData(e){if(!this.isGroup){this.widthFixed||(this.element.style.width="",this.cells.forEach(n=>{n.clearWidth()}));var i=this.element.offsetWidth;if((!this.width||!this.widthFixed)&&(this.cells.forEach(n=>{var a=n.getWidth();a>i&&(i=a)}),i)){var r=i+1;e?this.setWidth(r):(this.maxInitialWidth&&!e&&(r=Math.min(r,this.maxInitialWidth)),this.setWidthActual(r))}}}updateDefinition(e){var i;return this.isGroup||this.parent.isGroup?(console.error("Column Update Error - The updateDefinition function is only available on ungrouped columns"),Promise.reject("Column Update Error - The updateDefinition function is only available on columns, not column groups")):(i=Object.assign({},this.getDefinition()),i=Object.assign(i,e),this.table.columnManager.addColumn(i,!1,this).then(r=>(i.field==this.field&&(this.field=!1),this.delete().then(()=>r.getComponent()))))}deleteCell(e){var i=this.cells.indexOf(e);i>-1&&this.cells.splice(i,1)}getComponent(){return this.component||(this.component=new nee(this)),this.component}getPosition(){return this.table.columnManager.getVisibleColumnsByIndex().indexOf(this)+1}getParentComponent(){return this.parent instanceof Wu?this.parent.getComponent():!1}}class zC{constructor(e){return this._row=e,new Proxy(this,{get:function(i,r,n){return typeof i[r]<"u"?i[r]:i._row.table.componentFunctionBinder.handle("row",i._row,r)}})}getData(e){return this._row.getData(e)}getElement(){return this._row.getElement()}getCells(){var e=[];return this._row.getCells().forEach(function(i){e.push(i.getComponent())}),e}getCell(e){var i=this._row.getCell(e);return i?i.getComponent():!1}getIndex(){return this._row.getData("data")[this._row.table.options.index]}getPosition(){return this._row.getPosition()}watchPosition(e){return this._row.watchPosition(e)}delete(){return this._row.delete()}scrollTo(e,i){return this._row.table.rowManager.scrollToRow(this._row,e,i)}move(e,i){this._row.moveToRow(e,i)}update(e){return this._row.updateData(e)}normalizeHeight(){this._row.normalizeHeight(!0)}_getSelf(){return this._row}reformat(){return this._row.reinitialize()}getTable(){return this._row.table}getNextRow(){var e=this._row.nextRow();return e&&e.getComponent()}getPrevRow(){var e=this._row.prevRow();return e&&e.getComponent()}}class Ca extends Ra{constructor(e,i,r="row"){super(i.table),this.parent=i,this.data={},this.type=r,this.element=!1,this.modules={},this.cells=[],this.height=0,this.heightStyled="",this.manualHeight=!1,this.outerHeight=0,this.initialized=!1,this.heightInitialized=!1,this.position=0,this.positionWatchers=[],this.component=null,this.created=!1,this.setData(e)}create(){this.created||(this.created=!0,this.generateElement())}createElement(){var e=document.createElement("div");e.classList.add("tabulator-row"),e.setAttribute("role","row"),this.element=e}getElement(){return this.create(),this.element}detachElement(){this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element)}generateElement(){this.createElement(),this.dispatch("row-init",this)}generateCells(){this.cells=this.table.columnManager.generateCells(this)}initialize(e,i){if(this.create(),!this.initialized||e){for(this.deleteCells();this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.dispatch("row-layout-before",this),this.generateCells(),this.initialized=!0,this.table.columnManager.renderer.renderRowCells(this,i),e&&this.normalizeHeight(),this.dispatch("row-layout",this),this.table.options.rowFormatter&&this.table.options.rowFormatter(this.getComponent()),this.dispatch("row-layout-after",this)}else this.table.columnManager.renderer.rerenderRowCells(this,i)}rendered(){this.cells.forEach(e=>{e.cellRendered()})}reinitializeHeight(){this.heightInitialized=!1,this.element&&this.element.offsetParent!==null&&this.normalizeHeight(!0)}deinitialize(){this.initialized=!1}deinitializeHeight(){this.heightInitialized=!1}reinitialize(e){this.initialized=!1,this.heightInitialized=!1,this.manualHeight||(this.height=0,this.heightStyled=""),this.element&&this.element.offsetParent!==null&&this.initialize(!0),this.dispatch("row-relayout",this)}calcHeight(e){var i=0,r=0;this.table.options.rowHeight?this.height=this.table.options.rowHeight:(r=this.calcMinHeight(),i=this.calcMaxHeight(),e?this.height=Math.max(i,r):this.height=this.manualHeight?this.height:Math.max(i,r)),this.heightStyled=this.height?this.height+"px":"",this.outerHeight=this.element.offsetHeight}calcMinHeight(){return this.table.options.resizableRows?this.element.clientHeight:0}calcMaxHeight(){var e=0;return this.cells.forEach(function(i){var r=i.getHeight();r>e&&(e=r)}),e}setCellHeight(){this.cells.forEach(function(e){e.setHeight()}),this.heightInitialized=!0}clearCellHeight(){this.cells.forEach(function(e){e.clearHeight()})}normalizeHeight(e){e&&!this.table.options.rowHeight&&this.clearCellHeight(),this.calcHeight(e),this.setCellHeight()}setHeight(e,i){(this.height!=e||i)&&(this.manualHeight=!0,this.height=e,this.heightStyled=e?e+"px":"",this.setCellHeight(),this.outerHeight=this.element.offsetHeight,this.subscribedExternal("rowHeight")&&this.dispatchExternal("rowHeight",this.getComponent()))}getHeight(){return this.outerHeight}getWidth(){return this.element.offsetWidth}deleteCell(e){var i=this.cells.indexOf(e);i>-1&&this.cells.splice(i,1)}setData(e){this.data=this.chain("row-data-init-before",[this,e],void 0,e),this.dispatch("row-data-init-after",this)}updateData(e){var i=this.element&&gr.elVisible(this.element),r={},n;return new Promise((a,s)=>{typeof e=="string"&&(e=JSON.parse(e)),this.dispatch("row-data-save-before",this),this.subscribed("row-data-changing")&&(r=Object.assign(r,this.data),r=Object.assign(r,e)),n=this.chain("row-data-changing",[this,r,e],null,e);for(let o in n)this.data[o]=n[o];this.dispatch("row-data-save-after",this);for(let o in e)this.table.columnManager.getColumnsByFieldRoot(o).forEach(u=>{let c=this.getCell(u.getField());if(c){let d=u.getFieldValue(n);c.getValue()!==d&&(c.setValueProcessData(d),i&&c.cellRendered())}});i?(this.normalizeHeight(!0),this.table.options.rowFormatter&&this.table.options.rowFormatter(this.getComponent())):(this.initialized=!1,this.height=0,this.heightStyled=""),this.dispatch("row-data-changed",this,i,e),this.dispatchExternal("rowUpdated",this.getComponent()),this.subscribedExternal("dataChanged")&&this.dispatchExternal("dataChanged",this.table.rowManager.getData()),a()})}getData(e){return e?this.chain("row-data-retrieve",[this,e],null,this.data):this.data}getCell(e){var i=!1;return e=this.table.columnManager.findColumn(e),!this.initialized&&this.cells.length===0&&this.generateCells(),i=this.cells.find(function(r){return r.column===e}),i}getCellIndex(e){return this.cells.findIndex(function(i){return i===e})}findCell(e){return this.cells.find(i=>i.element===e)}getCells(){return!this.initialized&&this.cells.length===0&&this.generateCells(),this.cells}nextRow(){var e=this.table.rowManager.nextDisplayRow(this,!0);return e||!1}prevRow(){var e=this.table.rowManager.prevDisplayRow(this,!0);return e||!1}moveToRow(e,i){var r=this.table.rowManager.findRow(e);r?(this.table.rowManager.moveRowActual(this,r,!i),this.table.rowManager.refreshActiveData("display",!1,!0)):console.warn("Move Error - No matching row found:",e)}delete(){return this.dispatch("row-delete",this),this.deleteActual(),Promise.resolve()}deleteActual(e){this.detachModules(),this.table.rowManager.deleteRow(this,e),this.deleteCells(),this.initialized=!1,this.heightInitialized=!1,this.element=!1,this.dispatch("row-deleted",this)}detachModules(){this.dispatch("row-deleting",this)}deleteCells(){var e=this.cells.length;for(let i=0;i<e;i++)this.cells[0].delete()}wipe(){if(this.detachModules(),this.deleteCells(),this.element){for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.element.parentNode&&this.element.parentNode.removeChild(this.element)}this.element=!1,this.modules={}}isDisplayed(){return this.table.rowManager.getDisplayRows().includes(this)}getPosition(){return this.isDisplayed()?this.position:!1}setPosition(e){e!=this.position&&(this.position=e,this.positionWatchers.forEach(i=>{i(this.position)}))}watchPosition(e){this.positionWatchers.push(e),e(this.position)}getGroup(){return this.modules.group||!1}getComponent(){return this.component||(this.component=new zC(this)),this.component}}var XCe={avg:function(t,e,i){var r=0,n=typeof i.precision<"u"?i.precision:2;return t.length&&(r=t.reduce(function(a,s){return Number(a)+Number(s)}),r=r/t.length,r=n!==!1?r.toFixed(n):r),parseFloat(r).toString()},max:function(t,e,i){var r=null,n=typeof i.precision<"u"?i.precision:!1;return t.forEach(function(a){a=Number(a),(a>r||r===null)&&(r=a)}),r!==null?n!==!1?r.toFixed(n):r:""},min:function(t,e,i){var r=null,n=typeof i.precision<"u"?i.precision:!1;return t.forEach(function(a){a=Number(a),(a<r||r===null)&&(r=a)}),r!==null?n!==!1?r.toFixed(n):r:""},sum:function(t,e,i){var r=0,n=typeof i.precision<"u"?i.precision:!1;return t.length&&t.forEach(function(a){a=Number(a),r+=isNaN(a)?0:Number(a)}),n!==!1?r.toFixed(n):r},concat:function(t,e,i){var r=0;return t.length&&(r=t.reduce(function(n,a){return String(n)+String(a)})),r},count:function(t,e,i){var r=0;return t.length&&t.forEach(function(n){n&&r++}),r},unique:function(t,e,i){var r=t.filter((n,a)=>(t||n===0)&&t.indexOf(n)===a);return r.length}};class Rg extends si{static moduleName="columnCalcs";static calculations=XCe;constructor(e){super(e),this.topCalcs=[],this.botCalcs=[],this.genColumn=!1,this.topElement=this.createElement(),this.botElement=this.createElement(),this.topRow=!1,this.botRow=!1,this.topInitialized=!1,this.botInitialized=!1,this.blocked=!1,this.recalcAfterBlock=!1,this.registerTableOption("columnCalcs",!0),this.registerColumnOption("topCalc"),this.registerColumnOption("topCalcParams"),this.registerColumnOption("topCalcFormatter"),this.registerColumnOption("topCalcFormatterParams"),this.registerColumnOption("bottomCalc"),this.registerColumnOption("bottomCalcParams"),this.registerColumnOption("bottomCalcFormatter"),this.registerColumnOption("bottomCalcFormatterParams")}createElement(){var e=document.createElement("div");return e.classList.add("tabulator-calcs-holder"),e}initialize(){this.genColumn=new Wu({field:"value"},this),this.subscribe("cell-value-changed",this.cellValueChanged.bind(this)),this.subscribe("column-init",this.initializeColumnCheck.bind(this)),this.subscribe("row-deleted",this.rowsUpdated.bind(this)),this.subscribe("scroll-horizontal",this.scrollHorizontal.bind(this)),this.subscribe("row-added",this.rowsUpdated.bind(this)),this.subscribe("column-moved",this.recalcActiveRows.bind(this)),this.subscribe("column-add",this.recalcActiveRows.bind(this)),this.subscribe("data-refreshed",this.recalcActiveRowsRefresh.bind(this)),this.subscribe("table-redraw",this.tableRedraw.bind(this)),this.subscribe("rows-visible",this.visibleRows.bind(this)),this.subscribe("scrollbar-vertical",this.adjustForScrollbar.bind(this)),this.subscribe("redraw-blocked",this.blockRedraw.bind(this)),this.subscribe("redraw-restored",this.restoreRedraw.bind(this)),this.subscribe("table-redrawing",this.resizeHolderWidth.bind(this)),this.subscribe("column-resized",this.resizeHolderWidth.bind(this)),this.subscribe("column-show",this.resizeHolderWidth.bind(this)),this.subscribe("column-hide",this.resizeHolderWidth.bind(this)),this.registerTableFunction("getCalcResults",this.getResults.bind(this)),this.registerTableFunction("recalc",this.userRecalc.bind(this)),this.resizeHolderWidth()}resizeHolderWidth(){this.topElement.style.minWidth=this.table.columnManager.headersElement.offsetWidth+"px"}tableRedraw(e){this.recalc(this.table.rowManager.activeRows),e&&this.redraw()}blockRedraw(){this.blocked=!0,this.recalcAfterBlock=!1}restoreRedraw(){this.blocked=!1,this.recalcAfterBlock&&(this.recalcAfterBlock=!1,this.recalcActiveRowsRefresh())}userRecalc(){this.recalc(this.table.rowManager.activeRows)}blockCheck(){return this.blocked&&(this.recalcAfterBlock=!0),this.blocked}visibleRows(e,i){return this.topRow&&i.unshift(this.topRow),this.botRow&&i.push(this.botRow),i}rowsUpdated(e){this.table.options.groupBy?this.recalcRowGroup(e):this.recalcActiveRows()}recalcActiveRowsRefresh(){this.table.options.groupBy&&this.table.options.dataTreeStartExpanded&&this.table.options.dataTree?this.recalcAll():this.recalcActiveRows()}recalcActiveRows(){this.recalc(this.table.rowManager.activeRows)}cellValueChanged(e){(e.column.definition.topCalc||e.column.definition.bottomCalc)&&(this.table.options.groupBy?((this.table.options.columnCalcs=="table"||this.table.options.columnCalcs=="both")&&this.recalcActiveRows(),this.table.options.columnCalcs!="table"&&this.recalcRowGroup(e.row)):this.recalcActiveRows())}initializeColumnCheck(e){(e.definition.topCalc||e.definition.bottomCalc)&&this.initializeColumn(e)}initializeColumn(e){var i=e.definition,r={topCalcParams:i.topCalcParams||{},botCalcParams:i.bottomCalcParams||{}};if(i.topCalc){switch(typeof i.topCalc){case"string":Rg.calculations[i.topCalc]?r.topCalc=Rg.calculations[i.topCalc]:console.warn("Column Calc Error - No such calculation found, ignoring: ",i.topCalc);break;case"function":r.topCalc=i.topCalc;break}r.topCalc&&(e.modules.columnCalcs=r,this.topCalcs.push(e),this.table.options.columnCalcs!="group"&&this.initializeTopRow())}if(i.bottomCalc){switch(typeof i.bottomCalc){case"string":Rg.calculations[i.bottomCalc]?r.botCalc=Rg.calculations[i.bottomCalc]:console.warn("Column Calc Error - No such calculation found, ignoring: ",i.bottomCalc);break;case"function":r.botCalc=i.bottomCalc;break}r.botCalc&&(e.modules.columnCalcs=r,this.botCalcs.push(e),this.table.options.columnCalcs!="group"&&this.initializeBottomRow())}}registerColumnField(){}removeCalcs(){var e=!1;this.topInitialized&&(this.topInitialized=!1,this.topElement.parentNode.removeChild(this.topElement),e=!0),this.botInitialized&&(this.botInitialized=!1,this.footerRemove(this.botElement),e=!0),e&&this.table.rowManager.adjustTableSize()}reinitializeCalcs(){this.topCalcs.length&&this.initializeTopRow(),this.botCalcs.length&&this.initializeBottomRow()}initializeTopRow(){var e=document.createDocumentFragment();this.topInitialized||(e.appendChild(document.createElement("br")),e.appendChild(this.topElement),this.table.columnManager.getContentsElement().insertBefore(e,this.table.columnManager.headersElement.nextSibling),this.topInitialized=!0)}initializeBottomRow(){this.botInitialized||(this.footerPrepend(this.botElement),this.botInitialized=!0)}scrollHorizontal(e){this.botInitialized&&this.botRow&&(this.botElement.scrollLeft=e)}recalc(e){var i,r;if(!this.blockCheck()&&(this.topInitialized||this.botInitialized)){if(i=this.rowsToData(e),this.topInitialized){for(this.topRow&&this.topRow.deleteCells(),r=this.generateRow("top",i),this.topRow=r;this.topElement.firstChild;)this.topElement.removeChild(this.topElement.firstChild);this.topElement.appendChild(r.getElement()),r.initialize(!0)}if(this.botInitialized){for(this.botRow&&this.botRow.deleteCells(),r=this.generateRow("bottom",i),this.botRow=r;this.botElement.firstChild;)this.botElement.removeChild(this.botElement.firstChild);this.botElement.appendChild(r.getElement()),r.initialize(!0)}this.table.rowManager.adjustTableSize(),this.table.modExists("frozenColumns")&&this.table.modules.frozenColumns.layout()}}recalcRowGroup(e){this.recalcGroup(this.table.modules.groupRows.getRowGroup(e))}recalcAll(){if((this.topCalcs.length||this.botCalcs.length)&&(this.table.options.columnCalcs!=="group"&&this.recalcActiveRows(),this.table.options.groupBy&&this.table.options.columnCalcs!=="table")){var e=this.table.modules.groupRows.getChildGroups();e.forEach(i=>{this.recalcGroup(i)})}}recalcGroup(e){var i,r;this.blockCheck()||e&&e.calcs&&(e.calcs.bottom&&(i=this.rowsToData(e.rows),r=this.generateRowData("bottom",i),e.calcs.bottom.updateData(r),e.calcs.bottom.reinitialize()),e.calcs.top&&(i=this.rowsToData(e.rows),r=this.generateRowData("top",i),e.calcs.top.updateData(r),e.calcs.top.reinitialize()))}generateTopRow(e){return this.generateRow("top",this.rowsToData(e))}generateBottomRow(e){return this.generateRow("bottom",this.rowsToData(e))}rowsToData(e){var i=[],r=this.table.options.dataTree&&this.table.options.dataTreeChildColumnCalcs,n=this.table.modules.dataTree;return e.forEach(a=>{i.push(a.getData()),r&&a.modules.dataTree?.open&&this.rowsToData(n.getFilteredTreeChildren(a)).forEach(s=>{i.push(a)})}),i}generateRow(e,i){var r=this.generateRowData(e,i),n;return this.table.modExists("mutator")&&this.table.modules.mutator.disable(),n=new Ca(r,this,"calc"),this.table.modExists("mutator")&&this.table.modules.mutator.enable(),n.getElement().classList.add("tabulator-calcs","tabulator-calcs-"+e),n.component=!1,n.getComponent=()=>(n.component||(n.component=new KCe(n)),n.component),n.generateCells=()=>{var a=[];this.table.columnManager.columnsByIndex.forEach(s=>{this.genColumn.setField(s.getField()),this.genColumn.hozAlign=s.hozAlign,s.definition[e+"CalcFormatter"]&&this.table.modExists("format")?this.genColumn.modules.format={formatter:this.table.modules.format.lookupFormatter(s.definition[e+"CalcFormatter"]),params:s.definition[e+"CalcFormatterParams"]||{}}:this.genColumn.modules.format={formatter:this.table.modules.format.lookupFormatter("plaintext"),params:{}},this.genColumn.definition.cssClass=s.definition.cssClass;var o=new $S(this.genColumn,n);o.getElement(),o.column=s,o.setWidth(),s.cells.push(o),a.push(o),s.visible||o.hide()}),n.cells=a},n}generateRowData(e,i){var r={},n=e=="top"?this.topCalcs:this.botCalcs,a=e=="top"?"topCalc":"botCalc",s,o;return n.forEach(function(l){var u=[];l.modules.columnCalcs&&l.modules.columnCalcs[a]&&(i.forEach(function(c){u.push(l.getFieldValue(c))}),o=a+"Params",s=typeof l.modules.columnCalcs[o]=="function"?l.modules.columnCalcs[o](u,i):l.modules.columnCalcs[o],l.setFieldValue(r,l.modules.columnCalcs[a](u,i,s)))}),r}hasTopCalcs(){return!!this.topCalcs.length}hasBottomCalcs(){return!!this.botCalcs.length}redraw(){this.topRow&&this.topRow.normalizeHeight(!0),this.botRow&&this.botRow.normalizeHeight(!0)}getResults(){var e={},i;return this.table.options.groupBy&&this.table.modExists("groupRows")?(i=this.table.modules.groupRows.getGroups(!0),i.forEach(r=>{e[r.getKey()]=this.getGroupResults(r)})):e={top:this.topRow?this.topRow.getData():{},bottom:this.botRow?this.botRow.getData():{}},e}getGroupResults(e){var i=e._getSelf(),r=e.getSubGroups(),n={},a={};return r.forEach(s=>{n[s.getKey()]=this.getGroupResults(s)}),a={top:i.calcs.top?i.calcs.top.getData():{},bottom:i.calcs.bottom?i.calcs.bottom.getData():{},groups:n},a}adjustForScrollbar(e){this.botRow&&(this.table.rtl?this.botElement.style.paddingLeft=e+"px":this.botElement.style.paddingRight=e+"px")}}class JCe extends si{static moduleName="dataTree";constructor(e){super(e),this.indent=10,this.field="",this.collapseEl=null,this.expandEl=null,this.branchEl=null,this.elementField=!1,this.startOpen=function(){},this.registerTableOption("dataTree",!1),this.registerTableOption("dataTreeFilter",!0),this.registerTableOption("dataTreeSort",!0),this.registerTableOption("dataTreeElementColumn",!1),this.registerTableOption("dataTreeBranchElement",!0),this.registerTableOption("dataTreeChildIndent",9),this.registerTableOption("dataTreeChildField","_children"),this.registerTableOption("dataTreeCollapseElement",!1),this.registerTableOption("dataTreeExpandElement",!1),this.registerTableOption("dataTreeStartExpanded",!1),this.registerTableOption("dataTreeChildColumnCalcs",!1),this.registerTableOption("dataTreeSelectPropagate",!1),this.registerComponentFunction("row","treeCollapse",this.collapseRow.bind(this)),this.registerComponentFunction("row","treeExpand",this.expandRow.bind(this)),this.registerComponentFunction("row","treeToggle",this.toggleRow.bind(this)),this.registerComponentFunction("row","getTreeParent",this.getTreeParent.bind(this)),this.registerComponentFunction("row","getTreeChildren",this.getRowChildren.bind(this)),this.registerComponentFunction("row","addTreeChild",this.addTreeChildRow.bind(this)),this.registerComponentFunction("row","isTreeExpanded",this.isRowExpanded.bind(this))}initialize(){if(this.table.options.dataTree){var e=null,i=this.table.options;switch(this.field=i.dataTreeChildField,this.indent=i.dataTreeChildIndent,this.options("movableRows")&&console.warn("The movableRows option is not available with dataTree enabled, moving of child rows could result in unpredictable behavior"),i.dataTreeBranchElement?i.dataTreeBranchElement===!0?(this.branchEl=document.createElement("div"),this.branchEl.classList.add("tabulator-data-tree-branch")):typeof i.dataTreeBranchElement=="string"?(e=document.createElement("div"),e.innerHTML=i.dataTreeBranchElement,this.branchEl=e.firstChild):this.branchEl=i.dataTreeBranchElement:(this.branchEl=document.createElement("div"),this.branchEl.classList.add("tabulator-data-tree-branch-empty")),i.dataTreeCollapseElement?typeof i.dataTreeCollapseElement=="string"?(e=document.createElement("div"),e.innerHTML=i.dataTreeCollapseElement,this.collapseEl=e.firstChild):this.collapseEl=i.dataTreeCollapseElement:(this.collapseEl=document.createElement("div"),this.collapseEl.classList.add("tabulator-data-tree-control"),this.collapseEl.tabIndex=0,this.collapseEl.innerHTML="<div class='tabulator-data-tree-control-collapse'></div>"),i.dataTreeExpandElement?typeof i.dataTreeExpandElement=="string"?(e=document.createElement("div"),e.innerHTML=i.dataTreeExpandElement,this.expandEl=e.firstChild):this.expandEl=i.dataTreeExpandElement:(this.expandEl=document.createElement("div"),this.expandEl.classList.add("tabulator-data-tree-control"),this.expandEl.tabIndex=0,this.expandEl.innerHTML="<div class='tabulator-data-tree-control-expand'></div>"),typeof i.dataTreeStartExpanded){case"boolean":this.startOpen=function(r,n){return i.dataTreeStartExpanded};break;case"function":this.startOpen=i.dataTreeStartExpanded;break;default:this.startOpen=function(r,n){return i.dataTreeStartExpanded[n]};break}this.subscribe("row-init",this.initializeRow.bind(this)),this.subscribe("row-layout-after",this.layoutRow.bind(this)),this.subscribe("row-deleting",this.rowDeleting.bind(this)),this.subscribe("row-deleted",this.rowDelete.bind(this),0),this.subscribe("row-data-changed",this.rowDataChanged.bind(this),10),this.subscribe("cell-value-updated",this.cellValueChanged.bind(this)),this.subscribe("edit-cancelled",this.cellValueChanged.bind(this)),this.subscribe("column-moving-rows",this.columnMoving.bind(this)),this.subscribe("table-built",this.initializeElementField.bind(this)),this.subscribe("table-redrawing",this.tableRedrawing.bind(this)),this.registerDisplayHandler(this.getRows.bind(this),30)}}tableRedrawing(e){var i;e&&(i=this.table.rowManager.getRows(),i.forEach(r=>{this.reinitializeRowChildren(r)}))}initializeElementField(){var e=this.table.columnManager.getFirstVisibleColumn();this.elementField=this.table.options.dataTreeElementColumn||(e?e.field:!1)}getRowChildren(e){return this.getTreeChildren(e,!0)}columnMoving(){var e=[];return this.table.rowManager.rows.forEach(i=>{e=e.concat(this.getTreeChildren(i,!1,!0))}),e}rowDataChanged(e,i,r){this.redrawNeeded(r)&&(this.initializeRow(e),i&&(this.layoutRow(e),this.refreshData(!0)))}cellValueChanged(e){var i=e.column.getField();i===this.elementField&&this.layoutRow(e.row)}initializeRow(e){var i=e.getData()[this.field],r=Array.isArray(i),n=r||!r&&typeof i=="object"&&i!==null;!n&&e.modules.dataTree&&e.modules.dataTree.branchEl&&e.modules.dataTree.branchEl.parentNode.removeChild(e.modules.dataTree.branchEl),!n&&e.modules.dataTree&&e.modules.dataTree.controlEl&&e.modules.dataTree.controlEl.parentNode.removeChild(e.modules.dataTree.controlEl),e.modules.dataTree={index:e.modules.dataTree?e.modules.dataTree.index:0,open:n?e.modules.dataTree?e.modules.dataTree.open:this.startOpen(e.getComponent(),0):!1,controlEl:e.modules.dataTree&&n?e.modules.dataTree.controlEl:!1,branchEl:e.modules.dataTree&&n?e.modules.dataTree.branchEl:!1,parent:e.modules.dataTree?e.modules.dataTree.parent:!1,children:n}}reinitializeRowChildren(e){var i=this.getTreeChildren(e,!1,!0);i.forEach(function(r){r.reinitialize(!0)})}layoutRow(e){var i=this.elementField?e.getCell(this.elementField):e.getCells()[0],r=i.getElement(),n=e.modules.dataTree;n.branchEl&&(n.branchEl.parentNode&&n.branchEl.parentNode.removeChild(n.branchEl),n.branchEl=!1),n.controlEl&&(n.controlEl.parentNode&&n.controlEl.parentNode.removeChild(n.controlEl),n.controlEl=!1),this.generateControlElement(e,r),e.getElement().classList.add("tabulator-tree-level-"+n.index),n.index&&(this.branchEl?(n.branchEl=this.branchEl.cloneNode(!0),r.insertBefore(n.branchEl,r.firstChild),this.table.rtl?n.branchEl.style.marginRight=(n.branchEl.offsetWidth+n.branchEl.style.marginLeft)*(n.index-1)+n.index*this.indent+"px":n.branchEl.style.marginLeft=(n.branchEl.offsetWidth+n.branchEl.style.marginRight)*(n.index-1)+n.index*this.indent+"px"):this.table.rtl?r.style.paddingRight=parseInt(window.getComputedStyle(r,null).getPropertyValue("padding-right"))+n.index*this.indent+"px":r.style.paddingLeft=parseInt(window.getComputedStyle(r,null).getPropertyValue("padding-left"))+n.index*this.indent+"px")}generateControlElement(e,i){var r=e.modules.dataTree,n=r.controlEl;i=i||e.getCells()[0].getElement(),r.children!==!1&&(r.open?(r.controlEl=this.collapseEl.cloneNode(!0),r.controlEl.addEventListener("click",a=>{a.stopPropagation(),this.collapseRow(e)})):(r.controlEl=this.expandEl.cloneNode(!0),r.controlEl.addEventListener("click",a=>{a.stopPropagation(),this.expandRow(e)})),r.controlEl.addEventListener("mousedown",a=>{a.stopPropagation()}),n&&n.parentNode===i?n.parentNode.replaceChild(r.controlEl,n):i.insertBefore(r.controlEl,i.firstChild))}getRows(e){var i=[];return e.forEach((r,n)=>{var a,s;i.push(r),r instanceof Ca&&(r.create(),a=r.modules.dataTree,!a.index&&a.children!==!1&&(s=this.getChildren(r,!1,!0),s.forEach(o=>{o.create(),i.push(o)})))}),i}getChildren(e,i,r){var n=e.modules.dataTree,a=[],s=[];return n.children!==!1&&(n.open||i)&&(Array.isArray(n.children)||(n.children=this.generateChildren(e)),this.table.modExists("filter")&&this.table.options.dataTreeFilter?a=this.table.modules.filter.filter(n.children):a=n.children,this.table.modExists("sort")&&this.table.options.dataTreeSort&&this.table.modules.sort.sort(a,r),a.forEach(o=>{s.push(o);var l=this.getChildren(o,!1,!0);l.forEach(u=>{s.push(u)})})),s}generateChildren(e){var i=[],r=e.getData()[this.field];return Array.isArray(r)||(r=[r]),r.forEach(n=>{var a=new Ca(n||{},this.table.rowManager);a.create(),a.modules.dataTree.index=e.modules.dataTree.index+1,a.modules.dataTree.parent=e,a.modules.dataTree.children&&(a.modules.dataTree.open=this.startOpen(a.getComponent(),a.modules.dataTree.index)),i.push(a)}),i}expandRow(e,i){var r=e.modules.dataTree;r.children!==!1&&(r.open=!0,e.reinitialize(),this.refreshData(!0),this.dispatchExternal("dataTreeRowExpanded",e.getComponent(),e.modules.dataTree.index))}collapseRow(e){var i=e.modules.dataTree;i.children!==!1&&(i.open=!1,e.reinitialize(),this.refreshData(!0),this.dispatchExternal("dataTreeRowCollapsed",e.getComponent(),e.modules.dataTree.index))}toggleRow(e){var i=e.modules.dataTree;i.children!==!1&&(i.open?this.collapseRow(e):this.expandRow(e))}isRowExpanded(e){return e.modules.dataTree.open}getTreeParent(e){return e.modules.dataTree.parent?e.modules.dataTree.parent.getComponent():!1}getTreeParentRoot(e){return e.modules.dataTree&&e.modules.dataTree.parent?this.getTreeParentRoot(e.modules.dataTree.parent):e}getFilteredTreeChildren(e){var i=e.modules.dataTree,r=[],n;return i.children&&(Array.isArray(i.children)||(i.children=this.generateChildren(e)),this.table.modExists("filter")&&this.table.options.dataTreeFilter?n=this.table.modules.filter.filter(i.children):n=i.children,n.forEach(a=>{a instanceof Ca&&r.push(a)})),r}rowDeleting(e){var i=e.modules.dataTree;i&&i.children&&Array.isArray(i.children)&&i.children.forEach(r=>{r instanceof Ca&&r.wipe()})}rowDelete(e){var i=e.modules.dataTree.parent,r;i&&(r=this.findChildIndex(e,i),r!==!1&&i.data[this.field].splice(r,1),i.data[this.field].length||delete i.data[this.field],this.initializeRow(i),this.layoutRow(i)),this.refreshData(!0)}addTreeChildRow(e,i,r,n){var a=!1;typeof i=="string"&&(i=JSON.parse(i)),Array.isArray(e.data[this.field])||(e.data[this.field]=[],e.modules.dataTree.open=this.startOpen(e.getComponent(),e.modules.dataTree.index)),typeof n<"u"&&(a=this.findChildIndex(n,e),a!==!1&&e.data[this.field].splice(r?a:a+1,0,i)),a===!1&&(r?e.data[this.field].unshift(i):e.data[this.field].push(i)),this.initializeRow(e),this.layoutRow(e),this.refreshData(!0)}findChildIndex(e,i){var r=!1;return typeof e=="object"?e instanceof Ca?r=e.data:e instanceof zC?r=e._getSelf().data:typeof HTMLElement<"u"&&e instanceof HTMLElement?i.modules.dataTree&&(r=i.modules.dataTree.children.find(n=>n instanceof Ca?n.element===e:!1),r&&(r=r.data)):e===null&&(r=!1):typeof e>"u"?r=!1:r=i.data[this.field].find(n=>n.data[this.table.options.index]==e),r&&(Array.isArray(i.data[this.field])&&(r=i.data[this.field].indexOf(r)),r==-1&&(r=!1)),r}getTreeChildren(e,i,r){var n=e.modules.dataTree,a=[];return n&&n.children&&(Array.isArray(n.children)||(n.children=this.generateChildren(e)),n.children.forEach(s=>{s instanceof Ca&&(a.push(i?s.getComponent():s),r&&this.getTreeChildren(s,i,r).forEach(o=>{a.push(o)}))})),a}getChildField(){return this.field}redrawNeeded(e){return(this.field?typeof e[this.field]<"u":!1)||(this.elementField?typeof e[this.elementField]<"u":!1)}}function QCe(t,e={},i){var r=e.delimiter?e.delimiter:",",n=[],a=[];t.forEach(s=>{var o=[];switch(s.type){case"group":console.warn("Download Warning - CSV downloader cannot process row groups");break;case"calc":console.warn("Download Warning - CSV downloader cannot process column calculations");break;case"header":s.columns.forEach((l,u)=>{l&&l.depth===1&&(a[u]=typeof l.value>"u"||l.value===null?"":'"'+String(l.value).split('"').join('""')+'"')});break;case"row":s.columns.forEach(l=>{if(l){switch(typeof l.value){case"object":l.value=l.value!==null?JSON.stringify(l.value):"";break;case"undefined":l.value="";break}o.push('"'+String(l.value).split('"').join('""')+'"')}}),n.push(o.join(r));break}}),a.length&&n.unshift(a.join(r)),n=n.join(`
`),e.bom&&(n="\uFEFF"+n),i(n,"text/csv")}function ZCe(t,e,i){var r=[];t.forEach(n=>{var a={};switch(n.type){case"header":break;case"group":console.warn("Download Warning - JSON downloader cannot process row groups");break;case"calc":console.warn("Download Warning - JSON downloader cannot process column calculations");break;case"row":n.columns.forEach(s=>{s&&(a[s.component.getTitleDownload()||s.component.getField()]=s.value)}),r.push(a);break}}),r=JSON.stringify(r,null,"	"),i(r,"application/json")}function eMe(t,e={},i){var r=[],n=[],a={},s=e.rowGroupStyles||{fontStyle:"bold",fontSize:12,cellPadding:6,fillColor:220},o=e.rowCalcStyles||{fontStyle:"bold",fontSize:10,cellPadding:4,fillColor:232},l=e.jsPDF||{},u=e.title?e.title:"",c,d;l.orientation||(l.orientation=e.orientation||"landscape"),l.unit||(l.unit="pt"),t.forEach(f=>{switch(f.type){case"header":r.push(p(f));break;case"group":n.push(p(f,s));break;case"calc":n.push(p(f,o));break;case"row":n.push(p(f));break}});function p(f,m){var h=[];return f.columns.forEach(g=>{var I;if(g){switch(typeof g.value){case"object":g.value=g.value!==null?JSON.stringify(g.value):"";break;case"undefined":g.value="";break}I={content:g.value,colSpan:g.width,rowSpan:g.height},m&&(I.styles=m),h.push(I)}}),h}c=this.dependencyRegistry.lookup("jspdf","jsPDF"),d=new c(l),e.autoTable&&(typeof e.autoTable=="function"?a=e.autoTable(d)||{}:a=e.autoTable),u&&(a.didDrawPage=function(f){d.text(u,40,30)}),a.head=r,a.body=n,d.autoTable(a),e.documentProcessing&&e.documentProcessing(d),i(d.output("arraybuffer"),"application/pdf")}function tMe(t,e,i){var r=this,n=e.sheetName||"Sheet1",a=this.dependencyRegistry.lookup("XLSX"),s=a.utils.book_new(),o=new Ra(this),l="compress"in e?e.compress:!0,u=e.writeOptions||{bookType:"xlsx",bookSST:!0,compression:l},c;u.type="binary",s.SheetNames=[],s.Sheets={};function d(){var m=[],h=[],g={},I={s:{c:0,r:0},e:{c:t[0]?t[0].columns.reduce((v,w)=>v+(w&&w.width?w.width:1),0):0,r:t.length}};return t.forEach((v,w)=>{var y=[];v.columns.forEach(function(b,S){b?(y.push(!(b.value instanceof Date)&&typeof b.value=="object"?JSON.stringify(b.value):b.value),(b.width>1||b.height>-1)&&(b.height>1||b.width>1)&&h.push({s:{r:w,c:S},e:{r:w+b.height-1,c:S+b.width-1}})):y.push("")}),m.push(y)}),a.utils.sheet_add_aoa(g,m),g["!ref"]=a.utils.encode_range(I),h.length&&(g["!merges"]=h),g}if(e.sheetOnly){i(d());return}if(e.sheets)for(var p in e.sheets)e.sheets[p]===!0?(s.SheetNames.push(p),s.Sheets[p]=d()):(s.SheetNames.push(p),o.commsSend(e.sheets[p],"download","intercept",{type:"xlsx",options:{sheetOnly:!0},active:r.active,intercept:function(m){s.Sheets[p]=m}}));else s.SheetNames.push(n),s.Sheets[n]=d();e.documentProcessing&&(s=e.documentProcessing(s));function f(m){for(var h=new ArrayBuffer(m.length),g=new Uint8Array(h),I=0;I!=m.length;++I)g[I]=m.charCodeAt(I)&255;return h}c=a.write(s,u),i(f(c),"application/octet-stream")}function iMe(t,e,i){this.modExists("export",!0)&&i(this.modules.export.generateHTMLTable(t),"text/html")}function rMe(t,e,i){const r=[];t.forEach(n=>{const a={};switch(n.type){case"header":break;case"group":console.warn("Download Warning - JSON downloader cannot process row groups");break;case"calc":console.warn("Download Warning - JSON downloader cannot process column calculations");break;case"row":n.columns.forEach(s=>{s&&(a[s.component.getTitleDownload()||s.component.getField()]=s.value)}),r.push(JSON.stringify(a));break}}),i(r.join(`
`),"application/x-ndjson")}var nMe={csv:QCe,json:ZCe,jsonLines:rMe,pdf:eMe,xlsx:tMe,html:iMe};class IP extends si{static moduleName="download";static downloaders=nMe;constructor(e){super(e),this.registerTableOption("downloadEncoder",function(i,r){return new Blob([i],{type:r})}),this.registerTableOption("downloadConfig",{}),this.registerTableOption("downloadRowRange","active"),this.registerColumnOption("download"),this.registerColumnOption("titleDownload")}initialize(){this.deprecatedOptionsCheck(),this.registerTableFunction("download",this.download.bind(this)),this.registerTableFunction("downloadToTab",this.downloadToTab.bind(this))}deprecatedOptionsCheck(){}downloadToTab(e,i,r,n){this.download(e,i,r,n,!0)}download(e,i,r,n,a){var s=!1;function o(u,c){a?a===!0?this.triggerDownload(u,c,e,i,!0):a(u):this.triggerDownload(u,c,e,i)}if(typeof e=="function"?s=e:IP.downloaders[e]?s=IP.downloaders[e]:console.warn("Download Error - No such download type found: ",e),s){var l=this.generateExportList(n);s.call(this.table,l,r||{},o.bind(this))}}generateExportList(e){var i=this.table.modules.export.generateExportList(this.table.options.downloadConfig,!1,e||this.table.options.downloadRowRange,"download"),r=this.table.options.groupHeaderDownload;return r&&!Array.isArray(r)&&(r=[r]),i.forEach(n=>{var a;n.type==="group"&&(a=n.columns[0],r&&r[n.indent]&&(a.value=r[n.indent](a.value,n.component._group.getRowCount(),n.component._group.getData(),n.component)))}),i}triggerDownload(e,i,r,n,a){var s=document.createElement("a"),o=this.table.options.downloadEncoder(e,i);o&&(a?window.open(window.URL.createObjectURL(o)):(n=n||"Tabulator."+(typeof r=="function"?"txt":r),navigator.msSaveOrOpenBlob?navigator.msSaveOrOpenBlob(o,n):(s.setAttribute("href",window.URL.createObjectURL(o)),s.setAttribute("download",n),s.style.display="none",document.body.appendChild(s),s.click(),document.body.removeChild(s))),this.dispatchExternal("downloadComplete"))}commsReceived(e,i,r){i==="intercept"&&this.download(r.type,"",r.options,r.active,r.intercept)}}function qC(t,e){var i=e.mask,r=typeof e.maskLetterChar<"u"?e.maskLetterChar:"A",n=typeof e.maskNumberChar<"u"?e.maskNumberChar:"9",a=typeof e.maskWildcardChar<"u"?e.maskWildcardChar:"*";function s(o){var l=i[o];typeof l<"u"&&l!==a&&l!==r&&l!==n&&(t.value=t.value+""+l,s(o+1))}t.addEventListener("keydown",o=>{var l=t.value.length,u=o.key;if(o.keyCode>46&&!o.ctrlKey&&!o.metaKey){if(l>=i.length)return o.preventDefault(),o.stopPropagation(),!1;switch(i[l]){case r:if(u.toUpperCase()==u.toLowerCase())return o.preventDefault(),o.stopPropagation(),!1;break;case n:if(isNaN(u))return o.preventDefault(),o.stopPropagation(),!1;break;case a:break;default:if(u!==i[l])return o.preventDefault(),o.stopPropagation(),!1}}}),t.addEventListener("keyup",o=>{o.keyCode>46&&e.maskAutoFill&&s(t.value.length)}),t.placeholder||(t.placeholder=i),e.maskAutoFill&&s(t.value.length)}function aMe(t,e,i,r,n){var a=t.getValue(),s=document.createElement("input");if(s.setAttribute("type",n.search?"search":"text"),s.style.padding="4px",s.style.width="100%",s.style.boxSizing="border-box",n.elementAttributes&&typeof n.elementAttributes=="object")for(let l in n.elementAttributes)l.charAt(0)=="+"?(l=l.slice(1),s.setAttribute(l,s.getAttribute(l)+n.elementAttributes["+"+l])):s.setAttribute(l,n.elementAttributes[l]);s.value=typeof a<"u"?a:"",e(function(){t.getType()==="cell"&&(s.focus({preventScroll:!0}),s.style.height="100%",n.selectContents&&s.select())});function o(l){(a===null||typeof a>"u")&&s.value!==""||s.value!==a?i(s.value)&&(a=s.value):r()}return s.addEventListener("change",o),s.addEventListener("blur",o),s.addEventListener("keydown",function(l){switch(l.keyCode){case 13:o();break;case 27:r();break;case 35:case 36:l.stopPropagation();break}}),n.mask&&qC(s,n),s}function sMe(t,e,i,r,n){var a=t.getValue(),s=n.verticalNavigation||"hybrid",o=String(a!==null&&typeof a<"u"?a:""),l=document.createElement("textarea"),u=0;if(l.style.display="block",l.style.padding="2px",l.style.height="100%",l.style.width="100%",l.style.boxSizing="border-box",l.style.whiteSpace="pre-wrap",l.style.resize="none",n.elementAttributes&&typeof n.elementAttributes=="object")for(let d in n.elementAttributes)d.charAt(0)=="+"?(d=d.slice(1),l.setAttribute(d,l.getAttribute(d)+n.elementAttributes["+"+d])):l.setAttribute(d,n.elementAttributes[d]);l.value=o,e(function(){t.getType()==="cell"&&(l.focus({preventScroll:!0}),l.style.height="100%",l.scrollHeight,l.style.height=l.scrollHeight+"px",t.getRow().normalizeHeight(),n.selectContents&&l.select())});function c(d){(a===null||typeof a>"u")&&l.value!==""||l.value!==a?(i(l.value)&&(a=l.value),setTimeout(function(){t.getRow().normalizeHeight()},300)):r()}return l.addEventListener("change",c),l.addEventListener("blur",c),l.addEventListener("keyup",function(){l.style.height="";var d=l.scrollHeight;l.style.height=d+"px",d!=u&&(u=d,t.getRow().normalizeHeight())}),l.addEventListener("keydown",function(d){switch(d.keyCode){case 13:d.shiftKey&&n.shiftEnterSubmit&&c();break;case 27:r();break;case 38:(s=="editor"||s=="hybrid"&&l.selectionStart)&&(d.stopImmediatePropagation(),d.stopPropagation());break;case 40:(s=="editor"||s=="hybrid"&&l.selectionStart!==l.value.length)&&(d.stopImmediatePropagation(),d.stopPropagation());break;case 35:case 36:d.stopPropagation();break}}),n.mask&&qC(l,n),l}function oMe(t,e,i,r,n){var a=t.getValue(),s=n.verticalNavigation||"editor",o=document.createElement("input");if(o.setAttribute("type","number"),typeof n.max<"u"&&o.setAttribute("max",n.max),typeof n.min<"u"&&o.setAttribute("min",n.min),typeof n.step<"u"&&o.setAttribute("step",n.step),o.style.padding="4px",o.style.width="100%",o.style.boxSizing="border-box",n.elementAttributes&&typeof n.elementAttributes=="object")for(let c in n.elementAttributes)c.charAt(0)=="+"?(c=c.slice(1),o.setAttribute(c,o.getAttribute(c)+n.elementAttributes["+"+c])):o.setAttribute(c,n.elementAttributes[c]);o.value=a;var l=function(c){u()};e(function(){t.getType()==="cell"&&(o.removeEventListener("blur",l),o.focus({preventScroll:!0}),o.style.height="100%",o.addEventListener("blur",l),n.selectContents&&o.select())});function u(){var c=o.value;!isNaN(c)&&c!==""&&(c=Number(c)),c!==a?i(c)&&(a=c):r()}return o.addEventListener("keydown",function(c){switch(c.keyCode){case 13:u();break;case 27:r();break;case 38:case 40:s=="editor"&&(c.stopImmediatePropagation(),c.stopPropagation());break;case 35:case 36:c.stopPropagation();break}}),n.mask&&qC(o,n),o}function lMe(t,e,i,r,n){var a=t.getValue(),s=document.createElement("input");if(s.setAttribute("type","range"),typeof n.max<"u"&&s.setAttribute("max",n.max),typeof n.min<"u"&&s.setAttribute("min",n.min),typeof n.step<"u"&&s.setAttribute("step",n.step),s.style.padding="4px",s.style.width="100%",s.style.boxSizing="border-box",n.elementAttributes&&typeof n.elementAttributes=="object")for(let l in n.elementAttributes)l.charAt(0)=="+"?(l=l.slice(1),s.setAttribute(l,s.getAttribute(l)+n.elementAttributes["+"+l])):s.setAttribute(l,n.elementAttributes[l]);s.value=a,e(function(){t.getType()==="cell"&&(s.focus({preventScroll:!0}),s.style.height="100%")});function o(){var l=s.value;!isNaN(l)&&l!==""&&(l=Number(l)),l!=a?i(l)&&(a=l):r()}return s.addEventListener("blur",function(l){o()}),s.addEventListener("keydown",function(l){switch(l.keyCode){case 13:o();break;case 27:r();break}}),s}function uMe(t,e,i,r,n){var a=n.format,s=n.verticalNavigation||"editor",o=a?window.DateTime||luxon.DateTime:null,l=t.getValue(),u=document.createElement("input");function c(p){var f;return o.isDateTime(p)?f=p:a==="iso"?f=o.fromISO(String(p)):f=o.fromFormat(String(p),a),f.toFormat("yyyy-MM-dd")}if(u.type="date",u.style.padding="4px",u.style.width="100%",u.style.boxSizing="border-box",n.max&&u.setAttribute("max",a?c(n.max):n.max),n.min&&u.setAttribute("min",a?c(n.min):n.min),n.elementAttributes&&typeof n.elementAttributes=="object")for(let p in n.elementAttributes)p.charAt(0)=="+"?(p=p.slice(1),u.setAttribute(p,u.getAttribute(p)+n.elementAttributes["+"+p])):u.setAttribute(p,n.elementAttributes[p]);l=typeof l<"u"?l:"",a&&(o?l=c(l):console.error("Editor Error - 'date' editor 'format' param is dependant on luxon.js")),u.value=l,e(function(){t.getType()==="cell"&&(u.focus({preventScroll:!0}),u.style.height="100%",n.selectContents&&u.select())});function d(){var p=u.value,f;if((l===null||typeof l>"u")&&p!==""||p!==l){if(p&&a)switch(f=o.fromFormat(String(p),"yyyy-MM-dd"),a){case!0:p=f;break;case"iso":p=f.toISO();break;default:p=f.toFormat(a)}i(p)&&(l=u.value)}else r()}return u.addEventListener("blur",function(p){(p.relatedTarget||p.rangeParent||p.explicitOriginalTarget!==u)&&d()}),u.addEventListener("keydown",function(p){switch(p.keyCode){case 13:d();break;case 27:r();break;case 35:case 36:p.stopPropagation();break;case 38:case 40:s=="editor"&&(p.stopImmediatePropagation(),p.stopPropagation());break}}),u}function cMe(t,e,i,r,n){var a=n.format,s=n.verticalNavigation||"editor",o=a?window.DateTime||luxon.DateTime:null,l,u=t.getValue(),c=document.createElement("input");if(c.type="time",c.style.padding="4px",c.style.width="100%",c.style.boxSizing="border-box",n.elementAttributes&&typeof n.elementAttributes=="object")for(let p in n.elementAttributes)p.charAt(0)=="+"?(p=p.slice(1),c.setAttribute(p,c.getAttribute(p)+n.elementAttributes["+"+p])):c.setAttribute(p,n.elementAttributes[p]);u=typeof u<"u"?u:"",a&&(o?(o.isDateTime(u)?l=u:a==="iso"?l=o.fromISO(String(u)):l=o.fromFormat(String(u),a),u=l.toFormat("HH:mm")):console.error("Editor Error - 'date' editor 'format' param is dependant on luxon.js")),c.value=u,e(function(){t.getType()=="cell"&&(c.focus({preventScroll:!0}),c.style.height="100%",n.selectContents&&c.select())});function d(){var p=c.value,f;if((u===null||typeof u>"u")&&p!==""||p!==u){if(p&&a)switch(f=o.fromFormat(String(p),"hh:mm"),a){case!0:p=f;break;case"iso":p=f.toISO();break;default:p=f.toFormat(a)}i(p)&&(u=c.value)}else r()}return c.addEventListener("blur",function(p){(p.relatedTarget||p.rangeParent||p.explicitOriginalTarget!==c)&&d()}),c.addEventListener("keydown",function(p){switch(p.keyCode){case 13:d();break;case 27:r();break;case 35:case 36:p.stopPropagation();break;case 38:case 40:s=="editor"&&(p.stopImmediatePropagation(),p.stopPropagation());break}}),c}function dMe(t,e,i,r,n){var a=n.format,s=n.verticalNavigation||"editor",o=a?this.table.dependencyRegistry.lookup(["luxon","DateTime"],"DateTime"):null,l,u=t.getValue(),c=document.createElement("input");if(c.type="datetime-local",c.style.padding="4px",c.style.width="100%",c.style.boxSizing="border-box",n.elementAttributes&&typeof n.elementAttributes=="object")for(let p in n.elementAttributes)p.charAt(0)=="+"?(p=p.slice(1),c.setAttribute(p,c.getAttribute(p)+n.elementAttributes["+"+p])):c.setAttribute(p,n.elementAttributes[p]);u=typeof u<"u"?u:"",a&&(o?(o.isDateTime(u)?l=u:a==="iso"?l=o.fromISO(String(u)):l=o.fromFormat(String(u),a),u=l.toFormat("yyyy-MM-dd")+"T"+l.toFormat("HH:mm")):console.error("Editor Error - 'date' editor 'format' param is dependant on luxon.js")),c.value=u,e(function(){t.getType()==="cell"&&(c.focus({preventScroll:!0}),c.style.height="100%",n.selectContents&&c.select())});function d(){var p=c.value,f;if((u===null||typeof u>"u")&&p!==""||p!==u){if(p&&a)switch(f=o.fromISO(String(p)),a){case!0:p=f;break;case"iso":p=f.toISO();break;default:p=f.toFormat(a)}i(p)&&(u=c.value)}else r()}return c.addEventListener("blur",function(p){(p.relatedTarget||p.rangeParent||p.explicitOriginalTarget!==c)&&d()}),c.addEventListener("keydown",function(p){switch(p.keyCode){case 13:d();break;case 27:r();break;case 35:case 36:p.stopPropagation();break;case 38:case 40:s=="editor"&&(p.stopImmediatePropagation(),p.stopPropagation());break}}),c}let pMe=class{constructor(e,i,r,n,a,s){this.edit=e,this.table=e.table,this.cell=i,this.params=this._initializeParams(s),this.data=[],this.displayItems=[],this.currentItems=[],this.focusedItem=null,this.input=this._createInputElement(),this.listEl=this._createListElement(),this.initialValues=null,this.isFilter=i.getType()==="header",this.filterTimeout=null,this.filtered=!1,this.typing=!1,this.values=[],this.popup=null,this.listIteration=0,this.lastAction="",this.filterTerm="",this.blurable=!0,this.actions={success:n,cancel:a},this._deprecatedOptionsCheck(),this._initializeValue(),r(this._onRendered.bind(this))}_deprecatedOptionsCheck(){}_initializeValue(){var e=this.cell.getValue();typeof e>"u"&&typeof this.params.defaultValue<"u"&&(e=this.params.defaultValue),this.initialValues=this.params.multiselect?e:[e],this.isFilter&&(this.input.value=this.initialValues?this.initialValues.join(","):"",this.headerFilterInitialListGen())}_onRendered(){var e=this.cell.getElement();function i(r){r.stopPropagation()}this.isFilter||(this.input.style.height="100%",this.input.focus({preventScroll:!0})),e.addEventListener("click",i),setTimeout(()=>{e.removeEventListener("click",i)},1e3),this.input.addEventListener("mousedown",this._preventPopupBlur.bind(this))}_createListElement(){var e=document.createElement("div");return e.classList.add("tabulator-edit-list"),e.addEventListener("mousedown",this._preventBlur.bind(this)),e.addEventListener("keydown",this._inputKeyDown.bind(this)),e}_setListWidth(){var e=this.isFilter?this.input:this.cell.getElement();this.listEl.style.minWidth=e.offsetWidth+"px",this.params.maxWidth&&(this.params.maxWidth===!0?this.listEl.style.maxWidth=e.offsetWidth+"px":typeof this.params.maxWidth=="number"?this.listEl.style.maxWidth=this.params.maxWidth+"px":this.listEl.style.maxWidth=this.params.maxWidth)}_createInputElement(){var e=this.params.elementAttributes,i=document.createElement("input");if(i.setAttribute("type",this.params.clearable?"search":"text"),i.style.padding="4px",i.style.width="100%",i.style.boxSizing="border-box",this.params.autocomplete||(i.style.cursor="default",i.style.caretColor="transparent"),e&&typeof e=="object")for(let r in e)r.charAt(0)=="+"?(r=r.slice(1),i.setAttribute(r,i.getAttribute(r)+e["+"+r])):i.setAttribute(r,e[r]);return this.params.mask&&qC(i,this.params),this._bindInputEvents(i),i}_initializeParams(e){var i=["values","valuesURL","valuesLookup"],r;return e=Object.assign({},e),e.verticalNavigation=e.verticalNavigation||"editor",e.placeholderLoading=typeof e.placeholderLoading>"u"?"Searching ...":e.placeholderLoading,e.placeholderEmpty=typeof e.placeholderEmpty>"u"?"No Results Found":e.placeholderEmpty,e.filterDelay=typeof e.filterDelay>"u"?300:e.filterDelay,e.emptyValue=Object.keys(e).includes("emptyValue")?e.emptyValue:"",r=Object.keys(e).filter(n=>i.includes(n)).length,r?r>1&&console.warn("list editor config error - only one of the values, valuesURL, or valuesLookup options can be set on the same editor"):console.warn("list editor config error - either the values, valuesURL, or valuesLookup option must be set"),e.autocomplete?e.multiselect&&(e.multiselect=!1,console.warn("list editor config error - multiselect option is not available when autocomplete is enabled")):(e.freetext&&(e.freetext=!1,console.warn("list editor config error - freetext option is only available when autocomplete is enabled")),e.filterFunc&&(e.filterFunc=!1,console.warn("list editor config error - filterFunc option is only available when autocomplete is enabled")),e.filterRemote&&(e.filterRemote=!1,console.warn("list editor config error - filterRemote option is only available when autocomplete is enabled")),e.mask&&(e.mask=!1,console.warn("list editor config error - mask option is only available when autocomplete is enabled")),e.allowEmpty&&(e.allowEmpty=!1,console.warn("list editor config error - allowEmpty option is only available when autocomplete is enabled")),e.listOnEmpty&&(e.listOnEmpty=!1,console.warn("list editor config error - listOnEmpty option is only available when autocomplete is enabled"))),e.filterRemote&&!(typeof e.valuesLookup=="function"||e.valuesURL)&&(e.filterRemote=!1,console.warn("list editor config error - filterRemote option should only be used when values list is populated from a remote source")),e}_bindInputEvents(e){e.addEventListener("focus",this._inputFocus.bind(this)),e.addEventListener("click",this._inputClick.bind(this)),e.addEventListener("blur",this._inputBlur.bind(this)),e.addEventListener("keydown",this._inputKeyDown.bind(this)),e.addEventListener("search",this._inputSearch.bind(this)),this.params.autocomplete&&e.addEventListener("keyup",this._inputKeyUp.bind(this))}_inputFocus(e){this.rebuildOptionsList()}_filter(){this.params.filterRemote?(clearTimeout(this.filterTimeout),this.filterTimeout=setTimeout(()=>{this.rebuildOptionsList()},this.params.filterDelay)):this._filterList()}_inputClick(e){e.stopPropagation()}_inputBlur(e){this.blurable&&(this.popup?this.popup.hide():this._resolveValue(!0))}_inputSearch(){this._clearChoices()}_inputKeyDown(e){switch(e.keyCode){case 38:this._keyUp(e);break;case 40:this._keyDown(e);break;case 37:case 39:this._keySide(e);break;case 13:this._keyEnter();break;case 27:this._keyEsc();break;case 36:case 35:this._keyHomeEnd(e);break;case 9:this._keyTab(e);break;default:this._keySelectLetter(e)}}_inputKeyUp(e){switch(e.keyCode){case 38:case 37:case 39:case 40:case 13:case 27:break;default:this._keyAutoCompLetter(e)}}_preventPopupBlur(){this.popup&&this.popup.blockHide(),setTimeout(()=>{this.popup&&this.popup.restoreHide()},10)}_preventBlur(){this.blurable=!1,setTimeout(()=>{this.blurable=!0},10)}_keyTab(e){this.params.autocomplete&&this.lastAction==="typing"?this._resolveValue(!0):this.focusedItem&&this._chooseItem(this.focusedItem,!0)}_keyUp(e){var i=this.displayItems.indexOf(this.focusedItem);(this.params.verticalNavigation=="editor"||this.params.verticalNavigation=="hybrid"&&i)&&(e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault(),i>0&&this._focusItem(this.displayItems[i-1]))}_keyDown(e){var i=this.displayItems.indexOf(this.focusedItem);(this.params.verticalNavigation=="editor"||this.params.verticalNavigation=="hybrid"&&i<this.displayItems.length-1)&&(e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault(),i<this.displayItems.length-1&&(i==-1?this._focusItem(this.displayItems[0]):this._focusItem(this.displayItems[i+1])))}_keySide(e){this.params.autocomplete||(e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault())}_keyEnter(e){this.params.autocomplete&&this.lastAction==="typing"?this._resolveValue(!0):this.focusedItem&&this._chooseItem(this.focusedItem)}_keyEsc(e){this._cancel()}_keyHomeEnd(e){this.params.autocomplete&&e.stopImmediatePropagation()}_keySelectLetter(e){this.params.autocomplete||(e.preventDefault(),e.keyCode>=38&&e.keyCode<=90&&this._scrollToValue(e.keyCode))}_keyAutoCompLetter(e){this._filter(),this.lastAction="typing",this.typing=!0}_scrollToValue(e){clearTimeout(this.filterTimeout);var i=String.fromCharCode(e).toLowerCase();this.filterTerm+=i.toLowerCase();var r=this.displayItems.find(n=>typeof n.label<"u"&&n.label.toLowerCase().startsWith(this.filterTerm));r&&this._focusItem(r),this.filterTimeout=setTimeout(()=>{this.filterTerm=""},800)}_focusItem(e){this.lastAction="focus",this.focusedItem&&this.focusedItem.element&&this.focusedItem.element.classList.remove("focused"),this.focusedItem=e,e&&e.element&&(e.element.classList.add("focused"),e.element.scrollIntoView({behavior:"smooth",block:"nearest",inline:"start"}))}headerFilterInitialListGen(){this._generateOptions(!0)}rebuildOptionsList(){this._generateOptions().then(this._sortOptions.bind(this)).then(this._buildList.bind(this)).then(this._showList.bind(this)).catch(e=>{Number.isInteger(e)||console.error("List generation error",e)})}_filterList(){this._buildList(this._filterOptions()),this._showList()}_generateOptions(e){var i=[],r=++this.listIteration;return this.filtered=!1,this.params.values?i=this.params.values:this.params.valuesURL?i=this._ajaxRequest(this.params.valuesURL,this.input.value):typeof this.params.valuesLookup=="function"?i=this.params.valuesLookup(this.cell,this.input.value):this.params.valuesLookup&&(i=this._uniqueColumnValues(this.params.valuesLookupField)),i instanceof Promise?(e||this._addPlaceholder(this.params.placeholderLoading),i.then().then(n=>this.listIteration===r?this._parseList(n):Promise.reject(r))):Promise.resolve(this._parseList(i))}_addPlaceholder(e){var i=document.createElement("div");typeof e=="function"&&(e=e(this.cell.getComponent(),this.listEl)),e&&(this._clearList(),e instanceof HTMLElement?i=e:(i.classList.add("tabulator-edit-list-placeholder"),i.innerHTML=e),this.listEl.appendChild(i),this._showList())}_ajaxRequest(e,i){var r=this.params.filterRemote?{term:i}:{};return e=iee(e,{},r),fetch(e).then(n=>n.ok?n.json().catch(a=>(console.warn("List Ajax Load Error - Invalid JSON returned",a),Promise.reject(a))):(console.error("List Ajax Load Error - Connection Error: "+n.status,n.statusText),Promise.reject(n))).catch(n=>(console.error("List Ajax Load Error - Connection Error: ",n),Promise.reject(n)))}_uniqueColumnValues(e){var i={},r=this.table.getData(this.params.valuesLookup),n;return e?n=this.table.columnManager.getColumnByField(e):n=this.cell.getColumn()._getSelf(),n?r.forEach(a=>{var s=n.getFieldValue(a);this._emptyValueCheck(s)||(this.params.multiselect&&Array.isArray(s)?s.forEach(o=>{this._emptyValueCheck(o)||(i[o]=!0)}):i[s]=!0)}):(console.warn("unable to find matching column to create select lookup list:",e),i=[]),Object.keys(i)}_emptyValueCheck(e){return e===null||typeof e>"u"||e===""}_parseList(e){var i=[];return Array.isArray(e)||(e=Object.entries(e).map(([r,n])=>({label:n,value:r}))),e.forEach(r=>{typeof r!="object"&&(r={label:r,value:r}),this._parseListItem(r,i,0)}),!this.currentItems.length&&this.params.freetext&&(this.input.value=this.initialValues,this.typing=!0,this.lastAction="typing"),this.data=i,i}_parseListItem(e,i,r){var n={};e.options?n=this._parseListGroup(e,r+1):(n={label:e.label,value:e.value,itemParams:e.itemParams,elementAttributes:e.elementAttributes,element:!1,selected:!1,visible:!0,level:r,original:e},this.initialValues&&this.initialValues.indexOf(e.value)>-1&&this._chooseItem(n,!0)),i.push(n)}_parseListGroup(e,i){var r={label:e.label,group:!0,itemParams:e.itemParams,elementAttributes:e.elementAttributes,element:!1,visible:!0,level:i,options:[],original:e};return e.options.forEach(n=>{this._parseListItem(n,r.options,i)}),r}_sortOptions(e){var i;return this.params.sort&&(i=typeof this.params.sort=="function"?this.params.sort:this._defaultSortFunction.bind(this),this._sortGroup(i,e)),e}_sortGroup(e,i){i.sort((r,n)=>e(r.label,n.label,r.value,n.value,r.original,n.original)),i.forEach(r=>{r.group&&this._sortGroup(e,r.options)})}_defaultSortFunction(e,i){var r,n,a,s,o=0,l,u=/(\d+)|(\D+)/g,c=/\d/,d=0;if(this.params.sort==="desc"&&([e,i]=[i,e]),!e&&e!==0)d=!i&&i!==0?0:-1;else if(!i&&i!==0)d=1;else{if(isFinite(e)&&isFinite(i))return e-i;if(r=String(e).toLowerCase(),n=String(i).toLowerCase(),r===n)return 0;if(!(c.test(r)&&c.test(n)))return r>n?1:-1;for(r=r.match(u),n=n.match(u),l=r.length>n.length?n.length:r.length;o<l;)if(a=r[o],s=n[o++],a!==s)return isFinite(a)&&isFinite(s)?(a.charAt(0)==="0"&&(a="."+a),s.charAt(0)==="0"&&(s="."+s),a-s):a>s?1:-1;return r.length>n.length}return d}_filterOptions(){var e=this.params.filterFunc||this._defaultFilterFunc,i=this.input.value;return i?(this.filtered=!0,this.data.forEach(r=>{this._filterItem(e,i,r)})):this.filtered=!1,this.data}_filterItem(e,i,r){var n=!1;return r.group?(r.options.forEach(a=>{this._filterItem(e,i,a)&&(n=!0)}),r.visible=n):r.visible=e(i,r.label,r.value,r.original),r.visible}_defaultFilterFunc(e,i,r,n){return e=String(e).toLowerCase(),i!==null&&typeof i<"u"&&(String(i).toLowerCase().indexOf(e)>-1||String(r).toLowerCase().indexOf(e)>-1)}_clearList(){for(;this.listEl.firstChild;)this.listEl.removeChild(this.listEl.firstChild);this.displayItems=[]}_buildList(e){this._clearList(),e.forEach(i=>{this._buildItem(i)}),this.displayItems.length||this._addPlaceholder(this.params.placeholderEmpty)}_buildItem(e){var i=e.element,r;if(!this.filtered||e.visible){if(!i){if(i=document.createElement("div"),i.tabIndex=0,r=this.params.itemFormatter?this.params.itemFormatter(e.label,e.value,e.original,i):e.label,r instanceof HTMLElement?i.appendChild(r):i.innerHTML=r,e.group?i.classList.add("tabulator-edit-list-group"):i.classList.add("tabulator-edit-list-item"),i.classList.add("tabulator-edit-list-group-level-"+e.level),e.elementAttributes&&typeof e.elementAttributes=="object")for(let n in e.elementAttributes)n.charAt(0)=="+"?(n=n.slice(1),i.setAttribute(n,this.input.getAttribute(n)+e.elementAttributes["+"+n])):i.setAttribute(n,e.elementAttributes[n]);e.group?i.addEventListener("click",this._groupClick.bind(this,e)):i.addEventListener("click",this._itemClick.bind(this,e)),i.addEventListener("mousedown",this._preventBlur.bind(this)),e.element=i}this._styleItem(e),this.listEl.appendChild(i),e.group?e.options.forEach(n=>{this._buildItem(n)}):this.displayItems.push(e)}}_showList(){var e=this.popup&&this.popup.isVisible();if(this.input.parentNode){if(this.params.autocomplete&&this.input.value===""&&!this.params.listOnEmpty){this.popup&&this.popup.hide(!0);return}this._setListWidth(),this.popup||(this.popup=this.edit.popup(this.listEl)),this.popup.show(this.cell.getElement(),"bottom"),e||setTimeout(()=>{this.popup.hideOnBlur(this._resolveValue.bind(this,!0))},10)}}_styleItem(e){e&&e.element&&(e.selected?e.element.classList.add("active"):e.element.classList.remove("active"))}_itemClick(e,i){i.stopPropagation(),this._chooseItem(e)}_groupClick(e,i){i.stopPropagation()}_cancel(){this.popup.hide(!0),this.actions.cancel()}_clearChoices(){this.typing=!0,this.currentItems.forEach(e=>{e.selected=!1,this._styleItem(e)}),this.currentItems=[],this.focusedItem=null}_chooseItem(e,i){var r;this.typing=!1,this.params.multiselect?(r=this.currentItems.indexOf(e),r>-1?(this.currentItems.splice(r,1),e.selected=!1):(this.currentItems.push(e),e.selected=!0),this.input.value=this.currentItems.map(n=>n.label).join(","),this._styleItem(e)):(this.currentItems=[e],e.selected=!0,this.input.value=e.label,this._styleItem(e),i||this._resolveValue()),this._focusItem(e)}_resolveValue(e){var i,r;if(this.popup&&this.popup.hide(!0),this.params.multiselect)i=this.currentItems.map(n=>n.value);else if(e&&this.params.autocomplete&&this.typing)if(this.params.freetext||this.params.allowEmpty&&this.input.value==="")i=this.input.value;else{this.actions.cancel();return}else this.currentItems[0]?i=this.currentItems[0].value:(r=Array.isArray(this.initialValues)?this.initialValues[0]:this.initialValues,r===null||typeof r>"u"||r===""?i=r:i=this.params.emptyValue);i===""&&(i=this.params.emptyValue),this.actions.success(i),this.isFilter&&(this.initialValues=i&&!Array.isArray(i)?[i]:i,this.currentItems=[])}};function fMe(t,e,i,r,n){var a=new pMe(this,t,e,i,r,n);return a.input}function mMe(t,e,i,r,n){var a=this,s=t.getElement(),o=t.getValue(),l=s.getElementsByTagName("svg").length||5,u=s.getElementsByTagName("svg")[0]?s.getElementsByTagName("svg")[0].getAttribute("width"):14,c=[],d=document.createElement("div"),p=document.createElementNS("http://www.w3.org/2000/svg","svg");function f(I){c.forEach(function(v,w){w<I?(a.table.browser=="ie"?v.setAttribute("class","tabulator-star-active"):v.classList.replace("tabulator-star-inactive","tabulator-star-active"),v.innerHTML='<polygon fill="#488CE9" stroke="#014AAE" stroke-width="37.6152" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" points="259.216,29.942 330.27,173.919 489.16,197.007 374.185,309.08 401.33,467.31 259.216,392.612 117.104,467.31 144.25,309.08 29.274,197.007 188.165,173.919 "/>'):(a.table.browser=="ie"?v.setAttribute("class","tabulator-star-inactive"):v.classList.replace("tabulator-star-active","tabulator-star-inactive"),v.innerHTML='<polygon fill="#010155" stroke="#686868" stroke-width="37.6152" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" points="259.216,29.942 330.27,173.919 489.16,197.007 374.185,309.08 401.33,467.31 259.216,392.612 117.104,467.31 144.25,309.08 29.274,197.007 188.165,173.919 "/>')})}function m(I){var v=document.createElement("span"),w=p.cloneNode(!0);c.push(w),v.addEventListener("mouseenter",function(y){y.stopPropagation(),y.stopImmediatePropagation(),f(I)}),v.addEventListener("mousemove",function(y){y.stopPropagation(),y.stopImmediatePropagation()}),v.addEventListener("click",function(y){y.stopPropagation(),y.stopImmediatePropagation(),i(I),s.blur()}),v.appendChild(w),d.appendChild(v)}function h(I){o=I,f(I)}if(s.style.whiteSpace="nowrap",s.style.overflow="hidden",s.style.textOverflow="ellipsis",d.style.verticalAlign="middle",d.style.display="inline-block",d.style.padding="4px",p.setAttribute("width",u),p.setAttribute("height",u),p.setAttribute("viewBox","0 0 512 512"),p.setAttribute("xml:space","preserve"),p.style.padding="0 1px",n.elementAttributes&&typeof n.elementAttributes=="object")for(let I in n.elementAttributes)I.charAt(0)=="+"?(I=I.slice(1),d.setAttribute(I,d.getAttribute(I)+n.elementAttributes["+"+I])):d.setAttribute(I,n.elementAttributes[I]);for(var g=1;g<=l;g++)m(g);return o=Math.min(parseInt(o),l),f(o),d.addEventListener("mousemove",function(I){f(0)}),d.addEventListener("click",function(I){i(0)}),s.addEventListener("blur",function(I){r()}),s.addEventListener("keydown",function(I){switch(I.keyCode){case 39:h(o+1);break;case 37:h(o-1);break;case 13:i(o);break;case 27:r();break}}),d}function hMe(t,e,i,r,n){var a=t.getElement(),s=typeof n.max>"u"?a.getElementsByTagName("div")[0]&&a.getElementsByTagName("div")[0].getAttribute("max")||100:n.max,o=typeof n.min>"u"?a.getElementsByTagName("div")[0]&&a.getElementsByTagName("div")[0].getAttribute("min")||0:n.min,l=(s-o)/100,u=t.getValue()||0,c=document.createElement("div"),d=document.createElement("div"),p,f;function m(){var h=window.getComputedStyle(a,null),g=l*Math.round(d.offsetWidth/((a.clientWidth-parseInt(h.getPropertyValue("padding-left"))-parseInt(h.getPropertyValue("padding-right")))/100))+o;i(g),a.setAttribute("aria-valuenow",g),a.setAttribute("aria-label",u)}if(c.style.position="absolute",c.style.right="0",c.style.top="0",c.style.bottom="0",c.style.width="5px",c.classList.add("tabulator-progress-handle"),d.style.display="inline-block",d.style.position="relative",d.style.height="100%",d.style.backgroundColor="#488CE9",d.style.maxWidth="100%",d.style.minWidth="0%",n.elementAttributes&&typeof n.elementAttributes=="object")for(let h in n.elementAttributes)h.charAt(0)=="+"?(h=h.slice(1),d.setAttribute(h,d.getAttribute(h)+n.elementAttributes["+"+h])):d.setAttribute(h,n.elementAttributes[h]);return a.style.padding="4px 4px",u=Math.min(parseFloat(u),s),u=Math.max(parseFloat(u),o),u=Math.round((u-o)/l),d.style.width=u+"%",a.setAttribute("aria-valuemin",o),a.setAttribute("aria-valuemax",s),d.appendChild(c),c.addEventListener("mousedown",function(h){p=h.screenX,f=d.offsetWidth}),c.addEventListener("mouseover",function(){c.style.cursor="ew-resize"}),a.addEventListener("mousemove",function(h){p&&(d.style.width=f+h.screenX-p+"px")}),a.addEventListener("mouseup",function(h){p&&(h.stopPropagation(),h.stopImmediatePropagation(),p=!1,f=!1,m())}),a.addEventListener("keydown",function(h){switch(h.keyCode){case 39:h.preventDefault(),d.style.width=d.clientWidth+a.clientWidth/100+"px";break;case 37:h.preventDefault(),d.style.width=d.clientWidth-a.clientWidth/100+"px";break;case 9:case 13:m();break;case 27:r();break}}),a.addEventListener("blur",function(){r()}),d}function gMe(t,e,i,r,n){var a=t.getValue(),s=document.createElement("input"),o=n.tristate,l=typeof n.indeterminateValue>"u"?null:n.indeterminateValue,u=!1,c=Object.keys(n).includes("trueValue"),d=Object.keys(n).includes("falseValue");if(s.setAttribute("type","checkbox"),s.style.marginTop="5px",s.style.boxSizing="border-box",n.elementAttributes&&typeof n.elementAttributes=="object")for(let f in n.elementAttributes)f.charAt(0)=="+"?(f=f.slice(1),s.setAttribute(f,s.getAttribute(f)+n.elementAttributes["+"+f])):s.setAttribute(f,n.elementAttributes[f]);s.value=a,o&&(typeof a>"u"||a===l||a==="")&&(u=!0,s.indeterminate=!0),this.table.browser!="firefox"&&this.table.browser!="safari"&&e(function(){t.getType()==="cell"&&s.focus({preventScroll:!0})}),s.checked=c?a===n.trueValue:a===!0||a==="true"||a==="True"||a===1;function p(f){var m=s.checked;return c&&m?m=n.trueValue:d&&!m&&(m=n.falseValue),o?f?u?l:m:s.checked&&!u?(s.checked=!1,s.indeterminate=!0,u=!0,l):(u=!1,m):m}return s.addEventListener("change",function(f){i(p())}),s.addEventListener("blur",function(f){i(p(!0))}),s.addEventListener("keydown",function(f){f.keyCode==13&&i(p()),f.keyCode==27&&r()}),s}function IMe(t,e,i,r,n){var a=t._getSelf().column,s,o,l;function u(c){var d=c.getValue(),p="input";switch(typeof d){case"number":p="number";break;case"boolean":p="tickCross";break;case"string":d.includes(`
`)&&(p="textarea");break}return p}return s=n.editorLookup?n.editorLookup(t):u(t),n.paramsLookup&&(l=typeof n.paramsLookup=="function"?n.paramsLookup(s,t):n.paramsLookup[s]),o=this.table.modules.edit.lookupEditor(s,a),o.call(this,t,e,i,r,l||{})}var vMe={input:aMe,textarea:sMe,number:oMe,range:lMe,date:uMe,time:cMe,datetime:dMe,list:fMe,star:mMe,progress:hMe,tickCross:gMe,adaptable:IMe};class D$ extends si{static moduleName="edit";static editors=vMe;constructor(e){super(e),this.currentCell=!1,this.mouseClick=!1,this.recursionBlock=!1,this.invalidEdit=!1,this.editedCells=[],this.convertEmptyValues=!1,this.editors=D$.editors,this.registerTableOption("editTriggerEvent","focus"),this.registerTableOption("editorEmptyValue"),this.registerTableOption("editorEmptyValueFunc",this.emptyValueCheck.bind(this)),this.registerColumnOption("editable"),this.registerColumnOption("editor"),this.registerColumnOption("editorParams"),this.registerColumnOption("editorEmptyValue"),this.registerColumnOption("editorEmptyValueFunc"),this.registerColumnOption("cellEditing"),this.registerColumnOption("cellEdited"),this.registerColumnOption("cellEditCancelled"),this.registerTableFunction("getEditedCells",this.getEditedCells.bind(this)),this.registerTableFunction("clearCellEdited",this.clearCellEdited.bind(this)),this.registerTableFunction("navigatePrev",this.navigatePrev.bind(this)),this.registerTableFunction("navigateNext",this.navigateNext.bind(this)),this.registerTableFunction("navigateLeft",this.navigateLeft.bind(this)),this.registerTableFunction("navigateRight",this.navigateRight.bind(this)),this.registerTableFunction("navigateUp",this.navigateUp.bind(this)),this.registerTableFunction("navigateDown",this.navigateDown.bind(this)),this.registerComponentFunction("cell","isEdited",this.cellIsEdited.bind(this)),this.registerComponentFunction("cell","clearEdited",this.clearEdited.bind(this)),this.registerComponentFunction("cell","edit",this.editCell.bind(this)),this.registerComponentFunction("cell","cancelEdit",this.cellCancelEdit.bind(this)),this.registerComponentFunction("cell","navigatePrev",this.navigatePrev.bind(this)),this.registerComponentFunction("cell","navigateNext",this.navigateNext.bind(this)),this.registerComponentFunction("cell","navigateLeft",this.navigateLeft.bind(this)),this.registerComponentFunction("cell","navigateRight",this.navigateRight.bind(this)),this.registerComponentFunction("cell","navigateUp",this.navigateUp.bind(this)),this.registerComponentFunction("cell","navigateDown",this.navigateDown.bind(this))}initialize(){this.subscribe("cell-init",this.bindEditor.bind(this)),this.subscribe("cell-delete",this.clearEdited.bind(this)),this.subscribe("cell-value-changed",this.updateCellClass.bind(this)),this.subscribe("column-layout",this.initializeColumnCheck.bind(this)),this.subscribe("column-delete",this.columnDeleteCheck.bind(this)),this.subscribe("row-deleting",this.rowDeleteCheck.bind(this)),this.subscribe("row-layout",this.rowEditableCheck.bind(this)),this.subscribe("data-refreshing",this.cancelEdit.bind(this)),this.subscribe("clipboard-paste",this.pasteBlocker.bind(this)),this.subscribe("keybinding-nav-prev",this.navigatePrev.bind(this,void 0)),this.subscribe("keybinding-nav-next",this.keybindingNavigateNext.bind(this)),this.subscribe("keybinding-nav-up",this.navigateUp.bind(this,void 0)),this.subscribe("keybinding-nav-down",this.navigateDown.bind(this,void 0)),Object.keys(this.table.options).includes("editorEmptyValue")&&(this.convertEmptyValues=!0)}pasteBlocker(e){if(this.currentCell)return!0}keybindingNavigateNext(e){var i=this.currentCell,r=this.options("tabEndNewRow");i&&(this.navigateNext(i,e)||r&&(i.getElement().firstChild.blur(),this.invalidEdit||(r===!0?r=this.table.addRow({}):typeof r=="function"?r=this.table.addRow(r(i.row.getComponent())):r=this.table.addRow(Object.assign({},r)),r.then(()=>{setTimeout(()=>{i.getComponent().navigateNext()})}))))}cellIsEdited(e){return!!e.modules.edit&&e.modules.edit.edited}cellCancelEdit(e){e===this.currentCell?this.table.modules.edit.cancelEdit():console.warn("Cancel Editor Error - This cell is not currently being edited ")}updateCellClass(e){this.allowEdit(e)?e.getElement().classList.add("tabulator-editable"):e.getElement().classList.remove("tabulator-editable")}clearCellEdited(e){e||(e=this.table.modules.edit.getEditedCells()),Array.isArray(e)||(e=[e]),e.forEach(i=>{this.table.modules.edit.clearEdited(i._getSelf())})}navigatePrev(e=this.currentCell,i){var r,n;if(e){if(i&&i.preventDefault(),r=this.navigateLeft(),r)return!0;if(n=this.table.rowManager.prevDisplayRow(e.row,!0),n&&(r=this.findPrevEditableCell(n,n.cells.length),r))return r.getComponent().edit(),!0}return!1}navigateNext(e=this.currentCell,i){var r,n;if(e){if(i&&i.preventDefault(),r=this.navigateRight(),r)return!0;if(n=this.table.rowManager.nextDisplayRow(e.row,!0),n&&(r=this.findNextEditableCell(n,-1),r))return r.getComponent().edit(),!0}return!1}navigateLeft(e=this.currentCell,i){var r,n;return e&&(i&&i.preventDefault(),r=e.getIndex(),n=this.findPrevEditableCell(e.row,r),n)?(n.getComponent().edit(),!0):!1}navigateRight(e=this.currentCell,i){var r,n;return e&&(i&&i.preventDefault(),r=e.getIndex(),n=this.findNextEditableCell(e.row,r),n)?(n.getComponent().edit(),!0):!1}navigateUp(e=this.currentCell,i){var r,n;return e&&(i&&i.preventDefault(),r=e.getIndex(),n=this.table.rowManager.prevDisplayRow(e.row,!0),n)?(n.cells[r].getComponent().edit(),!0):!1}navigateDown(e=this.currentCell,i){var r,n;return e&&(i&&i.preventDefault(),r=e.getIndex(),n=this.table.rowManager.nextDisplayRow(e.row,!0),n)?(n.cells[r].getComponent().edit(),!0):!1}findNextEditableCell(e,i){var r=!1;if(i<e.cells.length-1)for(var n=i+1;n<e.cells.length;n++){let a=e.cells[n];if(a.column.modules.edit&&gr.elVisible(a.getElement())&&this.allowEdit(a)){r=a;break}}return r}findPrevEditableCell(e,i){var r=!1;if(i>0)for(var n=i-1;n>=0;n--){let a=e.cells[n];if(a.column.modules.edit&&gr.elVisible(a.getElement())&&this.allowEdit(a)){r=a;break}}return r}initializeColumnCheck(e){typeof e.definition.editor<"u"&&this.initializeColumn(e)}columnDeleteCheck(e){this.currentCell&&this.currentCell.column===e&&this.cancelEdit()}rowDeleteCheck(e){this.currentCell&&this.currentCell.row===e&&this.cancelEdit()}rowEditableCheck(e){e.getCells().forEach(i=>{i.column.modules.edit&&typeof i.column.modules.edit.check=="function"&&this.updateCellClass(i)})}initializeColumn(e){var i=Object.keys(e.definition).includes("editorEmptyValue"),r={editor:!1,blocked:!1,check:e.definition.editable,params:e.definition.editorParams||{},convertEmptyValues:i,editorEmptyValue:e.definition.editorEmptyValue,editorEmptyValueFunc:e.definition.editorEmptyValueFunc};r.editor=this.lookupEditor(e.definition.editor,e),r.editor&&(e.modules.edit=r)}lookupEditor(e,i){var r;switch(typeof e){case"string":this.editors[e]?r=this.editors[e]:console.warn("Editor Error - No such editor found: ",e);break;case"function":r=e;break;case"boolean":e===!0&&(typeof i.definition.formatter!="function"?this.editors[i.definition.formatter]?r=this.editors[i.definition.formatter]:r=this.editors.input:console.warn("Editor Error - Cannot auto lookup editor for a custom formatter: ",i.definition.formatter));break}return r}getCurrentCell(){return this.currentCell?this.currentCell.getComponent():!1}clearEditor(e){var i=this.currentCell,r;if(this.invalidEdit=!1,i){for(this.currentCell=!1,r=i.getElement(),this.dispatch("edit-editor-clear",i,e),r.classList.remove("tabulator-editing");r.firstChild;)r.removeChild(r.firstChild);i.row.getElement().classList.remove("tabulator-editing"),i.table.element.classList.remove("tabulator-editing")}}cancelEdit(){if(this.currentCell){var e=this.currentCell,i=this.currentCell.getComponent();this.clearEditor(!0),e.setValueActual(e.getValue()),e.cellRendered(),(e.column.definition.editor=="textarea"||e.column.definition.variableHeight)&&e.row.normalizeHeight(!0),e.column.definition.cellEditCancelled&&e.column.definition.cellEditCancelled.call(this.table,i),this.dispatch("edit-cancelled",e),this.dispatchExternal("cellEditCancelled",i)}}bindEditor(e){if(e.column.modules.edit){var i=this,r=e.getElement(!0);this.updateCellClass(e),r.setAttribute("tabindex",0),r.addEventListener("mousedown",function(n){n.button===2?n.preventDefault():i.mouseClick=!0}),this.options("editTriggerEvent")==="dblclick"&&r.addEventListener("dblclick",function(n){r.classList.contains("tabulator-editing")||(r.focus({preventScroll:!0}),i.edit(e,n,!1))}),(this.options("editTriggerEvent")==="focus"||this.options("editTriggerEvent")==="click")&&r.addEventListener("click",function(n){r.classList.contains("tabulator-editing")||(r.focus({preventScroll:!0}),i.edit(e,n,!1))}),this.options("editTriggerEvent")==="focus"&&r.addEventListener("focus",function(n){i.recursionBlock||i.edit(e,n,!1)})}}focusCellNoEvent(e,i){this.recursionBlock=!0,i&&this.table.browser==="ie"||e.getElement().focus({preventScroll:!0}),this.recursionBlock=!1}editCell(e,i){this.focusCellNoEvent(e),this.edit(e,!1,i)}focusScrollAdjust(e){if(this.table.rowManager.getRenderMode()=="virtual"){var i=this.table.rowManager.element.scrollTop,r=this.table.rowManager.element.clientHeight+this.table.rowManager.element.scrollTop,n=e.row.getElement();n.offsetTop<i?this.table.rowManager.element.scrollTop-=i-n.offsetTop:n.offsetTop+n.offsetHeight>r&&(this.table.rowManager.element.scrollTop+=n.offsetTop+n.offsetHeight-r);var a=this.table.rowManager.element.scrollLeft,s=this.table.rowManager.element.clientWidth+this.table.rowManager.element.scrollLeft,o=e.getElement();this.table.modExists("frozenColumns")&&(a+=parseInt(this.table.modules.frozenColumns.leftMargin||0),s-=parseInt(this.table.modules.frozenColumns.rightMargin||0)),this.table.options.renderHorizontal==="virtual"&&(a-=parseInt(this.table.columnManager.renderer.vDomPadLeft),s-=parseInt(this.table.columnManager.renderer.vDomPadLeft)),o.offsetLeft<a?this.table.rowManager.element.scrollLeft-=a-o.offsetLeft:o.offsetLeft+o.offsetWidth>s&&(this.table.rowManager.element.scrollLeft+=o.offsetLeft+o.offsetWidth-s)}}allowEdit(e){var i=!!e.column.modules.edit;if(e.column.modules.edit)switch(typeof e.column.modules.edit.check){case"function":e.row.initialized&&(i=e.column.modules.edit.check(e.getComponent()));break;case"string":i=!!e.row.data[e.column.modules.edit.check];break;case"boolean":i=e.column.modules.edit.check;break}return i}edit(e,i,r){var n=this,a=!0,s=function(){},o=e.getElement(),l=!1,u,c,d;if(this.currentCell){!this.invalidEdit&&this.currentCell!==e&&this.cancelEdit();return}function p(I){if(n.currentCell===e&&!l){var v=n.chain("edit-success",[e,I],!0,!0);return v===!0||n.table.options.validationMode==="highlight"?(l=!0,n.clearEditor(),e.modules.edit||(e.modules.edit={}),e.modules.edit.edited=!0,n.editedCells.indexOf(e)==-1&&n.editedCells.push(e),I=n.transformEmptyValues(I,e),e.setValue(I,!0),v===!0):(l=!0,n.invalidEdit=!0,n.focusCellNoEvent(e,!0),s(),setTimeout(()=>{l=!1},10),!1)}}function f(){n.currentCell===e&&!l&&n.cancelEdit()}function m(I){s=I}if(e.column.modules.edit.blocked)return this.mouseClick=!1,this.blur(o),!1;if(i&&i.stopPropagation(),a=this.allowEdit(e),a||r){if(n.cancelEdit(),n.currentCell=e,this.focusScrollAdjust(e),c=e.getComponent(),this.mouseClick&&(this.mouseClick=!1,e.column.definition.cellClick&&e.column.definition.cellClick.call(this.table,i,c)),e.column.definition.cellEditing&&e.column.definition.cellEditing.call(this.table,c),this.dispatch("cell-editing",e),this.dispatchExternal("cellEditing",c),d=typeof e.column.modules.edit.params=="function"?e.column.modules.edit.params(c):e.column.modules.edit.params,u=e.column.modules.edit.editor.call(n,c,m,p,f,d),this.currentCell&&u!==!1)if(u instanceof Node){for(o.classList.add("tabulator-editing"),e.row.getElement().classList.add("tabulator-editing"),e.table.element.classList.add("tabulator-editing");o.firstChild;)o.removeChild(o.firstChild);o.appendChild(u),s();for(var h=o.children,g=0;g<h.length;g++)h[g].addEventListener("click",function(I){I.stopPropagation()})}else return console.warn("Edit Error - Editor should return an instance of Node, the editor returned:",u),this.blur(o),!1;else return this.blur(o),!1;return!0}else return this.mouseClick=!1,this.blur(o),!1}emptyValueCheck(e){return e===""||e===null||typeof e>"u"}transformEmptyValues(e,i){var r=i.column.modules.edit,n=r.convertEmptyValues||this.convertEmptyValues,a;return n&&(a=r.editorEmptyValueFunc||this.options("editorEmptyValueFunc"),a&&a(e)&&(e=r.convertEmptyValues?r.editorEmptyValue:this.options("editorEmptyValue"))),e}blur(e){this.confirm("edit-blur",[e])||e.blur()}getEditedCells(){var e=[];return this.editedCells.forEach(i=>{e.push(i.getComponent())}),e}clearEdited(e){var i;e.modules.edit&&e.modules.edit.edited&&(e.modules.edit.edited=!1,this.dispatch("edit-edited-clear",e)),i=this.editedCells.indexOf(e),i>-1&&this.editedCells.splice(i,1)}}class JW{constructor(e,i,r,n){this.type=e,this.columns=i,this.component=r||!1,this.indent=n||0}}class BA{constructor(e,i,r,n,a){this.value=e,this.component=i||!1,this.width=r,this.height=n,this.depth=a}}var yMe={},bMe={visible:function(){return this.rowManager.getVisibleRows(!1,!0)},all:function(){return this.rowManager.rows},selected:function(){return this.modules.selectRow.selectedRows},active:function(){return this.options.pagination?this.rowManager.getDisplayRows(this.rowManager.displayRows.length-2):this.rowManager.getDisplayRows()}};class $y extends si{static moduleName="export";static columnLookups=yMe;static rowLookups=bMe;constructor(e){super(e),this.config={},this.cloneTableStyle=!0,this.colVisProp="",this.colVisPropAttach="",this.registerTableOption("htmlOutputConfig",!1),this.registerColumnOption("htmlOutput"),this.registerColumnOption("titleHtmlOutput")}initialize(){this.registerTableFunction("getHtml",this.getHtml.bind(this))}generateExportList(e,i,r,n){var a,s,o,l;return this.cloneTableStyle=i,this.config=e||{},this.colVisProp=n,this.colVisPropAttach=this.colVisProp.charAt(0).toUpperCase()+this.colVisProp.slice(1),l=$y.columnLookups[r],l&&(o=l.call(this.table),o=o.filter(u=>this.columnVisCheck(u))),a=this.config.columnHeaders!==!1?this.headersToExportRows(this.generateColumnGroupHeaders(o)):[],o&&(o=o.map(u=>u.getComponent())),s=this.bodyToExportRows(this.rowLookup(r),o),a.concat(s)}generateTable(e,i,r,n){var a=this.generateExportList(e,i,r,n);return this.generateTableElement(a)}rowLookup(e){var i=[],r;return typeof e=="function"?e.call(this.table).forEach(n=>{n=this.table.rowManager.findRow(n),n&&i.push(n)}):(r=$y.rowLookups[e]||$y.rowLookups.active,i=r.call(this.table)),Object.assign([],i)}generateColumnGroupHeaders(e){var i=[];return e||(e=this.config.columnGroups!==!1?this.table.columnManager.columns:this.table.columnManager.columnsByIndex),e.forEach(r=>{var n=this.processColumnGroup(r);n&&i.push(n)}),i}processColumnGroup(e){var i=e.columns,r=0,n=e.definition["title"+this.colVisPropAttach]||e.definition.title,a={title:n,column:e,depth:1};if(i.length){if(a.subGroups=[],a.width=0,i.forEach(s=>{var o=this.processColumnGroup(s);o&&(a.width+=o.width,a.subGroups.push(o),o.depth>r&&(r=o.depth))}),a.depth+=r,!a.width)return!1}else if(this.columnVisCheck(e))a.width=1;else return!1;return a}columnVisCheck(e){var i=e.definition[this.colVisProp];return this.config.rowHeaders===!1&&e.isRowHeader?!1:(typeof i=="function"&&(i=i.call(this.table,e.getComponent())),i===!1||i===!0?i:e.visible&&e.field)}headersToExportRows(e){var i=[],r=0,n=[];function a(s,o){var l=r-o;if(typeof i[o]>"u"&&(i[o]=[]),s.height=s.subGroups?1:l-s.depth+1,i[o].push(s),s.height>1)for(let u=1;u<s.height;u++)typeof i[o+u]>"u"&&(i[o+u]=[]),i[o+u].push(!1);if(s.width>1)for(let u=1;u<s.width;u++)i[o].push(!1);s.subGroups&&s.subGroups.forEach(function(u){a(u,o+1)})}return e.forEach(function(s){s.depth>r&&(r=s.depth)}),e.forEach(function(s){a(s,0)}),i.forEach(s=>{var o=[];s.forEach(l=>{if(l){let u=typeof l.title>"u"?"":l.title;o.push(new BA(u,l.column.getComponent(),l.width,l.height,l.depth))}else o.push(null)}),n.push(new JW("header",o))}),n}bodyToExportRows(e,i=[]){var r=[];return i.length===0&&this.table.columnManager.columnsByIndex.forEach(n=>{this.columnVisCheck(n)&&i.push(n.getComponent())}),this.config.columnCalcs!==!1&&this.table.modExists("columnCalcs")&&(this.table.modules.columnCalcs.topInitialized&&e.unshift(this.table.modules.columnCalcs.topRow),this.table.modules.columnCalcs.botInitialized&&e.push(this.table.modules.columnCalcs.botRow)),e=e.filter(n=>{switch(n.type){case"group":return this.config.rowGroups!==!1;case"calc":return this.config.columnCalcs!==!1;case"row":return!(this.table.options.dataTree&&this.config.dataTree===!1&&n.modules.dataTree.parent)}return!0}),e.forEach((n,a)=>{var s=n.getData(this.colVisProp),o=[],l=0;switch(n.type){case"group":l=n.level,o.push(new BA(n.key,n.getComponent(),i.length,1));break;case"calc":case"row":i.forEach(u=>{o.push(new BA(u._column.getFieldValue(s),u,1,1))}),this.table.options.dataTree&&this.config.dataTree!==!1&&(l=n.modules.dataTree.index);break}r.push(new JW(n.type,o,n.getComponent(),l))}),r}generateTableElement(e){var i=document.createElement("table"),r=document.createElement("thead"),n=document.createElement("tbody"),a=this.lookupTableStyles(),s=this.table.options["rowFormatter"+this.colVisPropAttach],o={};return o.rowFormatter=s!==null?s:this.table.options.rowFormatter,this.table.options.dataTree&&this.config.dataTree!==!1&&this.table.modExists("columnCalcs")&&(o.treeElementField=this.table.modules.dataTree.elementField),o.groupHeader=this.table.options["groupHeader"+this.colVisPropAttach],o.groupHeader&&!Array.isArray(o.groupHeader)&&(o.groupHeader=[o.groupHeader]),i.classList.add("tabulator-print-table"),this.mapElementStyles(this.table.columnManager.getHeadersElement(),r,["border-top","border-left","border-right","border-bottom","background-color","color","font-weight","font-family","font-size"]),e.length>1e3&&console.warn("It may take a long time to render an HTML table with more than 1000 rows"),e.forEach((l,u)=>{let c;switch(l.type){case"header":r.appendChild(this.generateHeaderElement(l,o,a));break;case"group":n.appendChild(this.generateGroupElement(l,o,a));break;case"calc":n.appendChild(this.generateCalcElement(l,o,a));break;case"row":c=this.generateRowElement(l,o,a),this.mapElementStyles(u%2&&a.evenRow?a.evenRow:a.oddRow,c,["border-top","border-left","border-right","border-bottom","color","font-weight","font-family","font-size","background-color"]),n.appendChild(c);break}}),r.innerHTML&&i.appendChild(r),i.appendChild(n),this.mapElementStyles(this.table.element,i,["border-top","border-left","border-right","border-bottom"]),i}lookupTableStyles(){var e={};return this.cloneTableStyle&&window.getComputedStyle&&(e.oddRow=this.table.element.querySelector(".tabulator-row-odd:not(.tabulator-group):not(.tabulator-calcs)"),e.evenRow=this.table.element.querySelector(".tabulator-row-even:not(.tabulator-group):not(.tabulator-calcs)"),e.calcRow=this.table.element.querySelector(".tabulator-row.tabulator-calcs"),e.firstRow=this.table.element.querySelector(".tabulator-row:not(.tabulator-group):not(.tabulator-calcs)"),e.firstGroup=this.table.element.getElementsByClassName("tabulator-group")[0],e.firstRow&&(e.styleCells=e.firstRow.getElementsByClassName("tabulator-cell"),e.styleRowHeader=e.firstRow.getElementsByClassName("tabulator-row-header")[0],e.firstCell=e.styleCells[0],e.lastCell=e.styleCells[e.styleCells.length-1])),e}generateHeaderElement(e,i,r){var n=document.createElement("tr");return e.columns.forEach(a=>{if(a){var s=document.createElement("th"),o=a.component._column.definition.cssClass?a.component._column.definition.cssClass.split(" "):[];s.colSpan=a.width,s.rowSpan=a.height,s.innerHTML=a.value,this.cloneTableStyle&&(s.style.boxSizing="border-box"),o.forEach(function(l){s.classList.add(l)}),this.mapElementStyles(a.component.getElement(),s,["text-align","border-left","border-right","background-color","color","font-weight","font-family","font-size"]),this.mapElementStyles(a.component._column.contentElement,s,["padding-top","padding-left","padding-right","padding-bottom"]),a.component._column.visible?this.mapElementStyles(a.component.getElement(),s,["width"]):a.component._column.definition.width&&(s.style.width=a.component._column.definition.width+"px"),a.component._column.parent&&a.component._column.parent.isGroup?this.mapElementStyles(a.component._column.parent.groupElement,s,["border-top"]):this.mapElementStyles(a.component.getElement(),s,["border-top"]),a.component._column.isGroup?this.mapElementStyles(a.component.getElement(),s,["border-bottom"]):this.mapElementStyles(this.table.columnManager.getElement(),s,["border-bottom"]),n.appendChild(s)}}),n}generateGroupElement(e,i,r){var n=document.createElement("tr"),a=document.createElement("td"),s=e.columns[0];return n.classList.add("tabulator-print-table-row"),i.groupHeader&&i.groupHeader[e.indent]?s.value=i.groupHeader[e.indent](s.value,e.component._group.getRowCount(),e.component._group.getData(),e.component):i.groupHeader!==!1&&(s.value=e.component._group.generator(s.value,e.component._group.getRowCount(),e.component._group.getData(),e.component)),a.colSpan=s.width,a.innerHTML=s.value,n.classList.add("tabulator-print-table-group"),n.classList.add("tabulator-group-level-"+e.indent),s.component.isVisible()&&n.classList.add("tabulator-group-visible"),this.mapElementStyles(r.firstGroup,n,["border-top","border-left","border-right","border-bottom","color","font-weight","font-family","font-size","background-color"]),this.mapElementStyles(r.firstGroup,a,["padding-top","padding-left","padding-right","padding-bottom"]),n.appendChild(a),n}generateCalcElement(e,i,r){var n=this.generateRowElement(e,i,r);return n.classList.add("tabulator-print-table-calcs"),this.mapElementStyles(r.calcRow,n,["border-top","border-left","border-right","border-bottom","color","font-weight","font-family","font-size","background-color"]),n}generateRowElement(e,i,r){var n=document.createElement("tr");if(n.classList.add("tabulator-print-table-row"),e.columns.forEach((a,s)=>{if(a){var o=document.createElement("td"),l=a.component._column,u=this.table,c=u.columnManager.findColumnIndex(l),d=a.value,p,f,m={modules:{},getValue:function(){return d},getField:function(){return l.definition.field},getElement:function(){return o},getType:function(){return"cell"},getColumn:function(){return l.getComponent()},getData:function(){return e.component.getData()},getRow:function(){return e.component},getTable:function(){return u},getComponent:function(){return m},column:l},h=l.definition.cssClass?l.definition.cssClass.split(" "):[];if(h.forEach(function(g){o.classList.add(g)}),this.table.modExists("format")&&this.config.formatCells!==!1)d=this.table.modules.format.formatExportValue(m,this.colVisProp);else switch(typeof d){case"object":d=d!==null?JSON.stringify(d):"";break;case"undefined":d="";break}d instanceof Node?o.appendChild(d):o.innerHTML=d,f=["padding-top","padding-left","padding-right","padding-bottom","border-top","border-left","border-right","border-bottom","color","font-weight","font-family","font-size","text-align"],l.isRowHeader?(p=r.styleRowHeader,f.push("background-color")):p=r.styleCells&&r.styleCells[c]?r.styleCells[c]:r.firstCell,p&&(this.mapElementStyles(p,o,f),l.definition.align&&(o.style.textAlign=l.definition.align)),this.table.options.dataTree&&this.config.dataTree!==!1&&(i.treeElementField&&i.treeElementField==l.field||!i.treeElementField&&s==0)&&(e.component._row.modules.dataTree.controlEl&&o.insertBefore(e.component._row.modules.dataTree.controlEl.cloneNode(!0),o.firstChild),e.component._row.modules.dataTree.branchEl&&o.insertBefore(e.component._row.modules.dataTree.branchEl.cloneNode(!0),o.firstChild)),n.appendChild(o),m.modules.format&&m.modules.format.renderedCallback&&m.modules.format.renderedCallback()}}),i.rowFormatter&&e.type==="row"&&this.config.formatCells!==!1){let a=Object.assign(e.component);a.getElement=function(){return n},i.rowFormatter(e.component)}return n}generateHTMLTable(e){var i=document.createElement("div");return i.appendChild(this.generateTableElement(e)),i.innerHTML}getHtml(e,i,r,n){var a=this.generateExportList(r||this.table.options.htmlOutputConfig,i,e,n||"htmlOutput");return this.generateHTMLTable(a)}mapElementStyles(e,i,r){if(this.cloneTableStyle&&e&&i){var n={"background-color":"backgroundColor",color:"fontColor",width:"width","font-weight":"fontWeight","font-family":"fontFamily","font-size":"fontSize","text-align":"textAlign","border-top":"borderTop","border-left":"borderLeft","border-right":"borderRight","border-bottom":"borderBottom","padding-top":"paddingTop","padding-left":"paddingLeft","padding-right":"paddingRight","padding-bottom":"paddingBottom"};if(window.getComputedStyle){var a=window.getComputedStyle(e);r.forEach(function(s){i.style[n[s]]||(i.style[n[s]]=a.getPropertyValue(s))})}}}}var wMe={"=":function(t,e,i,r){return e==t},"<":function(t,e,i,r){return e<t},"<=":function(t,e,i,r){return e<=t},">":function(t,e,i,r){return e>t},">=":function(t,e,i,r){return e>=t},"!=":function(t,e,i,r){return e!=t},regex:function(t,e,i,r){return typeof t=="string"&&(t=new RegExp(t)),t.test(e)},like:function(t,e,i,r){return t===null||typeof t>"u"?e===t:typeof e<"u"&&e!==null?String(e).toLowerCase().indexOf(t.toLowerCase())>-1:!1},keywords:function(t,e,i,r){var n=t.toLowerCase().split(typeof r.separator>"u"?" ":r.separator),a=String(e===null||typeof e>"u"?"":e).toLowerCase(),s=[];return n.forEach(o=>{a.includes(o)&&s.push(!0)}),r.matchAll?s.length===n.length:!!s.length},starts:function(t,e,i,r){return t===null||typeof t>"u"?e===t:typeof e<"u"&&e!==null?String(e).toLowerCase().startsWith(t.toLowerCase()):!1},ends:function(t,e,i,r){return t===null||typeof t>"u"?e===t:typeof e<"u"&&e!==null?String(e).toLowerCase().endsWith(t.toLowerCase()):!1},in:function(t,e,i,r){return Array.isArray(t)?t.length?t.indexOf(e)>-1:!0:(console.warn("Filter Error - filter value is not an array:",t),!1)}};class Gf extends si{static moduleName="filter";static filters=wMe;constructor(e){super(e),this.filterList=[],this.headerFilters={},this.headerFilterColumns=[],this.prevHeaderFilterChangeCheck="",this.prevHeaderFilterChangeCheck="{}",this.changed=!1,this.tableInitialized=!1,this.registerTableOption("filterMode","local"),this.registerTableOption("initialFilter",!1),this.registerTableOption("initialHeaderFilter",!1),this.registerTableOption("headerFilterLiveFilterDelay",300),this.registerTableOption("placeholderHeaderFilter",!1),this.registerColumnOption("headerFilter"),this.registerColumnOption("headerFilterPlaceholder"),this.registerColumnOption("headerFilterParams"),this.registerColumnOption("headerFilterEmptyCheck"),this.registerColumnOption("headerFilterFunc"),this.registerColumnOption("headerFilterFuncParams"),this.registerColumnOption("headerFilterLiveFilter"),this.registerTableFunction("searchRows",this.searchRows.bind(this)),this.registerTableFunction("searchData",this.searchData.bind(this)),this.registerTableFunction("setFilter",this.userSetFilter.bind(this)),this.registerTableFunction("refreshFilter",this.userRefreshFilter.bind(this)),this.registerTableFunction("addFilter",this.userAddFilter.bind(this)),this.registerTableFunction("getFilters",this.getFilters.bind(this)),this.registerTableFunction("setHeaderFilterFocus",this.userSetHeaderFilterFocus.bind(this)),this.registerTableFunction("getHeaderFilterValue",this.userGetHeaderFilterValue.bind(this)),this.registerTableFunction("setHeaderFilterValue",this.userSetHeaderFilterValue.bind(this)),this.registerTableFunction("getHeaderFilters",this.getHeaderFilters.bind(this)),this.registerTableFunction("removeFilter",this.userRemoveFilter.bind(this)),this.registerTableFunction("clearFilter",this.userClearFilter.bind(this)),this.registerTableFunction("clearHeaderFilter",this.userClearHeaderFilter.bind(this)),this.registerComponentFunction("column","headerFilterFocus",this.setHeaderFilterFocus.bind(this)),this.registerComponentFunction("column","reloadHeaderFilter",this.reloadHeaderFilter.bind(this)),this.registerComponentFunction("column","getHeaderFilterValue",this.getHeaderFilterValue.bind(this)),this.registerComponentFunction("column","setHeaderFilterValue",this.setHeaderFilterValue.bind(this))}initialize(){this.subscribe("column-init",this.initializeColumnHeaderFilter.bind(this)),this.subscribe("column-width-fit-before",this.hideHeaderFilterElements.bind(this)),this.subscribe("column-width-fit-after",this.showHeaderFilterElements.bind(this)),this.subscribe("table-built",this.tableBuilt.bind(this)),this.subscribe("placeholder",this.generatePlaceholder.bind(this)),this.table.options.filterMode==="remote"&&this.subscribe("data-params",this.remoteFilterParams.bind(this)),this.registerDataHandler(this.filter.bind(this),10)}tableBuilt(){this.table.options.initialFilter&&this.setFilter(this.table.options.initialFilter),this.table.options.initialHeaderFilter&&this.table.options.initialHeaderFilter.forEach(e=>{var i=this.table.columnManager.findColumn(e.field);if(i)this.setHeaderFilterValue(i,e.value);else return console.warn("Column Filter Error - No matching column found:",e.field),!1}),this.tableInitialized=!0}remoteFilterParams(e,i,r,n){return n.filter=this.getFilters(!0,!0),n}generatePlaceholder(e){if(this.table.options.placeholderHeaderFilter&&Object.keys(this.headerFilters).length)return this.table.options.placeholderHeaderFilter}userSetFilter(e,i,r,n){this.setFilter(e,i,r,n),this.refreshFilter()}userRefreshFilter(){this.refreshFilter()}userAddFilter(e,i,r,n){this.addFilter(e,i,r,n),this.refreshFilter()}userSetHeaderFilterFocus(e){var i=this.table.columnManager.findColumn(e);if(i)this.setHeaderFilterFocus(i);else return console.warn("Column Filter Focus Error - No matching column found:",e),!1}userGetHeaderFilterValue(e){var i=this.table.columnManager.findColumn(e);if(i)return this.getHeaderFilterValue(i);console.warn("Column Filter Error - No matching column found:",e)}userSetHeaderFilterValue(e,i){var r=this.table.columnManager.findColumn(e);if(r)this.setHeaderFilterValue(r,i);else return console.warn("Column Filter Error - No matching column found:",e),!1}userRemoveFilter(e,i,r){this.removeFilter(e,i,r),this.refreshFilter()}userClearFilter(e){this.clearFilter(e),this.refreshFilter()}userClearHeaderFilter(){this.clearHeaderFilter(),this.refreshFilter()}searchRows(e,i,r){return this.search("rows",e,i,r)}searchData(e,i,r){return this.search("data",e,i,r)}initializeColumnHeaderFilter(e){var i=e.definition;i.headerFilter&&this.initializeColumn(e)}initializeColumn(e,i){var r=this,n=e.getField();function a(s){var o=e.modules.filter.tagType=="input"&&e.modules.filter.attrType=="text"||e.modules.filter.tagType=="textarea"?"partial":"match",l="",u="",c;if(typeof e.modules.filter.prevSuccess>"u"||e.modules.filter.prevSuccess!==s){if(e.modules.filter.prevSuccess=s,e.modules.filter.emptyFunc(s))delete r.headerFilters[n];else{switch(e.modules.filter.value=s,typeof e.definition.headerFilterFunc){case"string":Gf.filters[e.definition.headerFilterFunc]?(l=e.definition.headerFilterFunc,c=function(d){var p=e.definition.headerFilterFuncParams||{},f=e.getFieldValue(d);return p=typeof p=="function"?p(s,f,d):p,Gf.filters[e.definition.headerFilterFunc](s,f,d,p)}):console.warn("Header Filter Error - Matching filter function not found: ",e.definition.headerFilterFunc);break;case"function":c=function(d){var p=e.definition.headerFilterFuncParams||{},f=e.getFieldValue(d);return p=typeof p=="function"?p(s,f,d):p,e.definition.headerFilterFunc(s,f,d,p)},l=c;break}c||(o==="partial"?(c=function(d){var p=e.getFieldValue(d);return typeof p<"u"&&p!==null?String(p).toLowerCase().indexOf(String(s).toLowerCase())>-1:!1},l="like"):(c=function(d){return e.getFieldValue(d)==s},l="=")),r.headerFilters[n]={value:s,func:c,type:l}}e.modules.filter.value=s,u=JSON.stringify(r.headerFilters),r.prevHeaderFilterChangeCheck!==u&&(r.prevHeaderFilterChangeCheck=u,r.trackChanges(),r.refreshFilter())}return!0}e.modules.filter={success:a,attrType:!1,tagType:!1,emptyFunc:!1},this.generateHeaderFilterElement(e)}generateHeaderFilterElement(e,i,r){var n=this,a=e.modules.filter.success,s=e.getField(),o,l,u,c,d,p,f,m;e.modules.filter.value=i;function h(){}function g(I){m=I}if(e.modules.filter.headerElement&&e.modules.filter.headerElement.parentNode&&e.contentElement.removeChild(e.modules.filter.headerElement.parentNode),s){switch(e.modules.filter.emptyFunc=e.definition.headerFilterEmptyCheck||function(I){return!I&&I!==0},o=document.createElement("div"),o.classList.add("tabulator-header-filter"),typeof e.definition.headerFilter){case"string":n.table.modules.edit.editors[e.definition.headerFilter]?(l=n.table.modules.edit.editors[e.definition.headerFilter],(e.definition.headerFilter==="tick"||e.definition.headerFilter==="tickCross")&&!e.definition.headerFilterEmptyCheck&&(e.modules.filter.emptyFunc=function(I){return I!==!0&&I!==!1})):console.warn("Filter Error - Cannot build header filter, No such editor found: ",e.definition.editor);break;case"function":l=e.definition.headerFilter;break;case"boolean":e.modules.edit&&e.modules.edit.editor?l=e.modules.edit.editor:e.definition.formatter&&n.table.modules.edit.editors[e.definition.formatter]?(l=n.table.modules.edit.editors[e.definition.formatter],(e.definition.formatter==="tick"||e.definition.formatter==="tickCross")&&!e.definition.headerFilterEmptyCheck&&(e.modules.filter.emptyFunc=function(I){return I!==!0&&I!==!1})):l=n.table.modules.edit.editors.input;break}if(l){if(c={getValue:function(){return typeof i<"u"?i:""},getField:function(){return e.definition.field},getElement:function(){return o},getColumn:function(){return e.getComponent()},getTable:()=>this.table,getType:()=>"header",getRow:function(){return{normalizeHeight:function(){}}}},f=e.definition.headerFilterParams||{},f=typeof f=="function"?f.call(n.table,c):f,u=l.call(this.table.modules.edit,c,g,a,h,f),!u){console.warn("Filter Error - Cannot add filter to "+s+" column, editor returned a value of false");return}if(!(u instanceof Node)){console.warn("Filter Error - Cannot add filter to "+s+" column, editor should return an instance of Node, the editor returned:",u);return}n.langBind("headerFilters|columns|"+e.definition.field,function(I){u.setAttribute("placeholder",typeof I<"u"&&I?I:e.definition.headerFilterPlaceholder||n.langText("headerFilters|default"))}),u.addEventListener("click",function(I){I.stopPropagation(),u.focus()}),u.addEventListener("focus",I=>{var v=this.table.columnManager.contentsElement.scrollLeft,w=this.table.rowManager.element.scrollLeft;v!==w&&(this.table.rowManager.scrollHorizontal(v),this.table.columnManager.scrollHorizontal(v))}),d=!1,p=function(I){d&&clearTimeout(d),d=setTimeout(function(){a(u.value)},n.table.options.headerFilterLiveFilterDelay)},e.modules.filter.headerElement=u,e.modules.filter.attrType=u.hasAttribute("type")?u.getAttribute("type").toLowerCase():"",e.modules.filter.tagType=u.tagName.toLowerCase(),e.definition.headerFilterLiveFilter!==!1&&(e.definition.headerFilter==="autocomplete"||e.definition.headerFilter==="tickCross"||(e.definition.editor==="autocomplete"||e.definition.editor==="tickCross")&&e.definition.headerFilter===!0||(u.addEventListener("keyup",p),u.addEventListener("search",p),e.modules.filter.attrType=="number"&&u.addEventListener("change",function(I){a(u.value)}),e.modules.filter.attrType=="text"&&this.table.browser!=="ie"&&u.setAttribute("type","search")),(e.modules.filter.tagType=="input"||e.modules.filter.tagType=="select"||e.modules.filter.tagType=="textarea")&&u.addEventListener("mousedown",function(I){I.stopPropagation()})),o.appendChild(u),e.contentElement.appendChild(o),r||n.headerFilterColumns.push(e),m&&m()}}else console.warn("Filter Error - Cannot add header filter, column has no field set:",e.definition.title)}hideHeaderFilterElements(){this.headerFilterColumns.forEach(function(e){e.modules.filter&&e.modules.filter.headerElement&&(e.modules.filter.headerElement.style.display="none")})}showHeaderFilterElements(){this.headerFilterColumns.forEach(function(e){e.modules.filter&&e.modules.filter.headerElement&&(e.modules.filter.headerElement.style.display="")})}setHeaderFilterFocus(e){e.modules.filter&&e.modules.filter.headerElement?e.modules.filter.headerElement.focus():console.warn("Column Filter Focus Error - No header filter set on column:",e.getField())}getHeaderFilterValue(e){if(e.modules.filter&&e.modules.filter.headerElement)return e.modules.filter.value;console.warn("Column Filter Error - No header filter set on column:",e.getField())}setHeaderFilterValue(e,i){e&&(e.modules.filter&&e.modules.filter.headerElement?(this.generateHeaderFilterElement(e,i,!0),e.modules.filter.success(i)):console.warn("Column Filter Error - No header filter set on column:",e.getField()))}reloadHeaderFilter(e){e&&(e.modules.filter&&e.modules.filter.headerElement?this.generateHeaderFilterElement(e,e.modules.filter.value,!0):console.warn("Column Filter Error - No header filter set on column:",e.getField()))}refreshFilter(){this.tableInitialized&&(this.table.options.filterMode==="remote"?this.reloadData(null,!1,!1):this.refreshData(!0))}trackChanges(){this.changed=!0,this.dispatch("filter-changed")}hasChanged(){var e=this.changed;return this.changed=!1,e}setFilter(e,i,r,n){this.filterList=[],Array.isArray(e)||(e=[{field:e,type:i,value:r,params:n}]),this.addFilter(e)}addFilter(e,i,r,n){var a=!1;Array.isArray(e)||(e=[{field:e,type:i,value:r,params:n}]),e.forEach(s=>{s=this.findFilter(s),s&&(this.filterList.push(s),a=!0)}),a&&this.trackChanges()}findFilter(e){var i;if(Array.isArray(e))return this.findSubFilters(e);var r=!1;return typeof e.field=="function"?r=function(n){return e.field(n,e.type||{})}:Gf.filters[e.type]?(i=this.table.columnManager.getColumnByField(e.field),i?r=function(n){return Gf.filters[e.type](e.value,i.getFieldValue(n),n,e.params||{})}:r=function(n){return Gf.filters[e.type](e.value,n[e.field],n,e.params||{})}):console.warn("Filter Error - No such filter type found, ignoring: ",e.type),e.func=r,e.func?e:!1}findSubFilters(e){var i=[];return e.forEach(r=>{r=this.findFilter(r),r&&i.push(r)}),i.length?i:!1}getFilters(e,i){var r=[];return e&&(r=this.getHeaderFilters()),i&&r.forEach(function(n){typeof n.type=="function"&&(n.type="function")}),r=r.concat(this.filtersToArray(this.filterList,i)),r}filtersToArray(e,i){var r=[];return e.forEach(n=>{var a;Array.isArray(n)?r.push(this.filtersToArray(n,i)):(a={field:n.field,type:n.type,value:n.value},i&&typeof a.type=="function"&&(a.type="function"),r.push(a))}),r}getHeaderFilters(){var e=[];for(var i in this.headerFilters)e.push({field:i,type:this.headerFilters[i].type,value:this.headerFilters[i].value});return e}removeFilter(e,i,r){Array.isArray(e)||(e=[{field:e,type:i,value:r}]),e.forEach(n=>{var a=-1;typeof n.field=="object"?a=this.filterList.findIndex(s=>n===s):a=this.filterList.findIndex(s=>n.field===s.field&&n.type===s.type&&n.value===s.value),a>-1?this.filterList.splice(a,1):console.warn("Filter Error - No matching filter type found, ignoring: ",n.type)}),this.trackChanges()}clearFilter(e){this.filterList=[],e&&this.clearHeaderFilter(),this.trackChanges()}clearHeaderFilter(){this.headerFilters={},this.prevHeaderFilterChangeCheck="{}",this.headerFilterColumns.forEach(e=>{typeof e.modules.filter.value<"u"&&delete e.modules.filter.value,e.modules.filter.prevSuccess=void 0,this.reloadHeaderFilter(e)}),this.trackChanges()}search(e,i,r,n){var a=[],s=[];return Array.isArray(i)||(i=[{field:i,type:r,value:n}]),i.forEach(o=>{o=this.findFilter(o),o&&s.push(o)}),this.table.rowManager.rows.forEach(o=>{var l=!0;s.forEach(u=>{this.filterRecurse(u,o.getData())||(l=!1)}),l&&a.push(e==="data"?o.getData("data"):o.getComponent())}),a}filter(e,i){var r=[],n=[];return this.subscribedExternal("dataFiltering")&&this.dispatchExternal("dataFiltering",this.getFilters(!0)),this.table.options.filterMode!=="remote"&&(this.filterList.length||Object.keys(this.headerFilters).length)?e.forEach(a=>{this.filterRow(a)&&r.push(a)}):r=e.slice(0),this.subscribedExternal("dataFiltered")&&(r.forEach(a=>{n.push(a.getComponent())}),this.dispatchExternal("dataFiltered",this.getFilters(!0),n)),r}filterRow(e,i){var r=!0,n=e.getData();this.filterList.forEach(s=>{this.filterRecurse(s,n)||(r=!1)});for(var a in this.headerFilters)this.headerFilters[a].func(n)||(r=!1);return r}filterRecurse(e,i){var r=!1;return Array.isArray(e)?e.forEach(n=>{this.filterRecurse(n,i)&&(r=!0)}):r=e.func(i),r}}function SMe(t,e,i){return this.emptyToSpace(this.sanitizeHTML(t.getValue()))}function UMe(t,e,i){return t.getValue()}function TMe(t,e,i){return t.getElement().style.whiteSpace="pre-wrap",this.emptyToSpace(this.sanitizeHTML(t.getValue()))}function DMe(t,e,i){var r=parseFloat(t.getValue()),n="",a,s,o,l,u,c=e.decimal||".",d=e.thousand||",",p=e.negativeSign||"-",f=e.symbol||"",m=!!e.symbolAfter,h=typeof e.precision<"u"?e.precision:2;if(isNaN(r))return this.emptyToSpace(this.sanitizeHTML(t.getValue()));if(r<0&&(r=Math.abs(r),n=p),a=h!==!1?r.toFixed(h):r,a=String(a).split("."),s=a[0],o=a.length>1?c+a[1]:"",e.thousand!==!1)for(l=/(\d+)(\d{3})/;l.test(s);)s=s.replace(l,"$1"+d+"$2");return u=s+o,n===!0?(u="("+u+")",m?u+f:f+u):m?n+u+f:n+f+u}function PMe(t,e,i){var r=t.getValue(),n=e.urlPrefix||"",a=e.download,s=r,o=document.createElement("a"),l;function u(c,d){var p=c.shift(),f=d[p];return c.length&&typeof f=="object"?u(c,f):f}if(e.labelField&&(l=t.getData(),s=u(e.labelField.split(this.table.options.nestedFieldSeparator),l)),e.label)switch(typeof e.label){case"string":s=e.label;break;case"function":s=e.label(t);break}if(s){if(e.urlField&&(l=t.getData(),r=gr.retrieveNestedData(this.table.options.nestedFieldSeparator,e.urlField,l)),e.url)switch(typeof e.url){case"string":r=e.url;break;case"function":r=e.url(t);break}return o.setAttribute("href",n+r),e.target&&o.setAttribute("target",e.target),e.download&&(typeof a=="function"?a=a(t):a=a===!0?"":a,o.setAttribute("download",a)),o.innerHTML=this.emptyToSpace(this.sanitizeHTML(s)),o}else return"&nbsp;"}function EMe(t,e,i){var r=document.createElement("img"),n=t.getValue();switch(e.urlPrefix&&(n=e.urlPrefix+t.getValue()),e.urlSuffix&&(n=n+e.urlSuffix),r.setAttribute("src",n),typeof e.height){case"number":r.style.height=e.height+"px";break;case"string":r.style.height=e.height;break}switch(typeof e.width){case"number":r.style.width=e.width+"px";break;case"string":r.style.width=e.width;break}return r.addEventListener("load",function(){t.getRow().normalizeHeight()}),r}function RMe(t,e,i){var r=t.getValue(),n=t.getElement(),a=e.allowEmpty,s=e.allowTruthy,o=Object.keys(e).includes("trueValue"),l=typeof e.tickElement<"u"?e.tickElement:'<svg enable-background="new 0 0 24 24" height="14" width="14" viewBox="0 0 24 24" xml:space="preserve" ><path fill="#2DC214" clip-rule="evenodd" d="M21.652,3.211c-0.293-0.295-0.77-0.295-1.061,0L9.41,14.34  c-0.293,0.297-0.771,0.297-1.062,0L3.449,9.351C3.304,9.203,3.114,9.13,2.923,9.129C2.73,9.128,2.534,9.201,2.387,9.351  l-2.165,1.946C0.078,11.445,0,11.63,0,11.823c0,0.194,0.078,0.397,0.223,0.544l4.94,5.184c0.292,0.296,0.771,0.776,1.062,1.07  l2.124,2.141c0.292,0.293,0.769,0.293,1.062,0l14.366-14.34c0.293-0.294,0.293-0.777,0-1.071L21.652,3.211z" fill-rule="evenodd"/></svg>',u=typeof e.crossElement<"u"?e.crossElement:'<svg enable-background="new 0 0 24 24" height="14" width="14"  viewBox="0 0 24 24" xml:space="preserve" ><path fill="#CE1515" d="M22.245,4.015c0.313,0.313,0.313,0.826,0,1.139l-6.276,6.27c-0.313,0.312-0.313,0.826,0,1.14l6.273,6.272  c0.313,0.313,0.313,0.826,0,1.14l-2.285,2.277c-0.314,0.312-0.828,0.312-1.142,0l-6.271-6.271c-0.313-0.313-0.828-0.313-1.141,0  l-6.276,6.267c-0.313,0.313-0.828,0.313-1.141,0l-2.282-2.28c-0.313-0.313-0.313-0.826,0-1.14l6.278-6.269  c0.313-0.312,0.313-0.826,0-1.14L1.709,5.147c-0.314-0.313-0.314-0.827,0-1.14l2.284-2.278C4.308,1.417,4.821,1.417,5.135,1.73  L11.405,8c0.314,0.314,0.828,0.314,1.141,0.001l6.276-6.267c0.312-0.312,0.826-0.312,1.141,0L22.245,4.015z"/></svg>';return o&&r===e.trueValue||!o&&(s&&r||r===!0||r==="true"||r==="True"||r===1||r==="1")?(n.setAttribute("aria-checked",!0),l||""):a&&(r==="null"||r===""||r===null||typeof r>"u")?(n.setAttribute("aria-checked","mixed"),""):(n.setAttribute("aria-checked",!1),u||"")}function CMe(t,e,i){var r=this.table.dependencyRegistry.lookup(["luxon","DateTime"],"DateTime"),n=e.inputFormat||"yyyy-MM-dd HH:mm:ss",a=e.outputFormat||"dd/MM/yyyy HH:mm:ss",s=typeof e.invalidPlaceholder<"u"?e.invalidPlaceholder:"",o=t.getValue();if(typeof r<"u"){var l;return r.isDateTime(o)?l=o:n==="iso"?l=r.fromISO(String(o)):l=r.fromFormat(String(o),n),l.isValid?(e.timezone&&(l=l.setZone(e.timezone)),l.toFormat(a)):s===!0||!o?o:typeof s=="function"?s(o):s}else console.error("Format Error - 'datetime' formatter is dependant on luxon.js")}function MMe(t,e,i){var r=this.table.dependencyRegistry.lookup(["luxon","DateTime"],"DateTime"),n=e.inputFormat||"yyyy-MM-dd HH:mm:ss",a=typeof e.invalidPlaceholder<"u"?e.invalidPlaceholder:"",s=typeof e.suffix<"u"?e.suffix:!1,o=typeof e.unit<"u"?e.unit:"days",l=typeof e.humanize<"u"?e.humanize:!1,u=typeof e.date<"u"?e.date:r.now(),c=t.getValue();if(typeof r<"u"){var d;return r.isDateTime(c)?d=c:n==="iso"?d=r.fromISO(String(c)):d=r.fromFormat(String(c),n),d.isValid?l?d.diff(u,o).toHuman()+(s?" "+s:""):parseInt(d.diff(u,o)[o])+(s?" "+s:""):a===!0?c:typeof a=="function"?a(c):a}else console.error("Format Error - 'datetimediff' formatter is dependant on luxon.js")}function NMe(t,e,i){var r=t.getValue();return typeof e[r]>"u"?(console.warn("Missing display value for "+r),r):e[r]}function AMe(t,e,i){var r=t.getValue(),n=t.getElement(),a=e&&e.stars?e.stars:5,s=document.createElement("span"),o=document.createElementNS("http://www.w3.org/2000/svg","svg"),l='<polygon fill="#FFEA00" stroke="#C1AB60" stroke-width="37.6152" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" points="259.216,29.942 330.27,173.919 489.16,197.007 374.185,309.08 401.33,467.31 259.216,392.612 117.104,467.31 144.25,309.08 29.274,197.007 188.165,173.919 "/>',u='<polygon fill="#D2D2D2" stroke="#686868" stroke-width="37.6152" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" points="259.216,29.942 330.27,173.919 489.16,197.007 374.185,309.08 401.33,467.31 259.216,392.612 117.104,467.31 144.25,309.08 29.274,197.007 188.165,173.919 "/>';s.style.verticalAlign="middle",o.setAttribute("width","14"),o.setAttribute("height","14"),o.setAttribute("viewBox","0 0 512 512"),o.setAttribute("xml:space","preserve"),o.style.padding="0 1px",r=r&&!isNaN(r)?parseInt(r):0,r=Math.max(0,Math.min(r,a));for(var c=1;c<=a;c++){var d=o.cloneNode(!0);d.innerHTML=c<=r?l:u,s.appendChild(d)}return n.style.whiteSpace="nowrap",n.style.overflow="hidden",n.style.textOverflow="ellipsis",n.setAttribute("aria-label",r),s}function kMe(t,e,i){var r=this.sanitizeHTML(t.getValue())||0,n=document.createElement("span"),a=e&&e.max?e.max:100,s=e&&e.min?e.min:0,o=e&&typeof e.color<"u"?e.color:["red","orange","green"],l="#666666",u,c;if(!(isNaN(r)||typeof t.getValue()>"u")){switch(n.classList.add("tabulator-traffic-light"),c=parseFloat(r)<=a?parseFloat(r):a,c=parseFloat(c)>=s?parseFloat(c):s,u=(a-s)/100,c=Math.round((c-s)/u),typeof o){case"string":l=o;break;case"function":l=o(r);break;case"object":if(Array.isArray(o)){var d=100/o.length,p=Math.floor(c/d);p=Math.min(p,o.length-1),p=Math.max(p,0),l=o[p];break}}return n.style.backgroundColor=l,n}}function OMe(t,e={},i){var r=this.sanitizeHTML(t.getValue())||0,n=t.getElement(),a=e.max?e.max:100,s=e.min?e.min:0,o=e.legendAlign?e.legendAlign:"center",l,u,c,d,p;switch(u=parseFloat(r)<=a?parseFloat(r):a,u=parseFloat(u)>=s?parseFloat(u):s,l=(a-s)/100,u=Math.round((u-s)/l),typeof e.color){case"string":c=e.color;break;case"function":c=e.color(r);break;case"object":if(Array.isArray(e.color)){let g=100/e.color.length,I=Math.floor(u/g);I=Math.min(I,e.color.length-1),I=Math.max(I,0),c=e.color[I];break}default:c="#2DC214"}switch(typeof e.legend){case"string":d=e.legend;break;case"function":d=e.legend(r);break;case"boolean":d=r;break;default:d=!1}switch(typeof e.legendColor){case"string":p=e.legendColor;break;case"function":p=e.legendColor(r);break;case"object":if(Array.isArray(e.legendColor)){let g=100/e.legendColor.length,I=Math.floor(u/g);I=Math.min(I,e.legendColor.length-1),I=Math.max(I,0),p=e.legendColor[I]}break;default:p="#000"}n.style.minWidth="30px",n.style.position="relative",n.setAttribute("aria-label",u);var f=document.createElement("div");f.style.display="inline-block",f.style.width=u+"%",f.style.backgroundColor=c,f.style.height="100%",f.setAttribute("data-max",a),f.setAttribute("data-min",s);var m=document.createElement("div");if(m.style.position="relative",m.style.width="100%",m.style.height="100%",d){var h=document.createElement("div");h.style.position="absolute",h.style.top=0,h.style.left=0,h.style.textAlign=o,h.style.width="100%",h.style.color=p,h.innerHTML=d}return i(function(){if(!(t instanceof ree)){var g=document.createElement("div");g.style.position="absolute",g.style.top="4px",g.style.bottom="4px",g.style.left="4px",g.style.right="4px",n.appendChild(g),n=g}n.appendChild(m),m.appendChild(f),d&&m.appendChild(h)}),""}function xMe(t,e,i){return t.getElement().style.backgroundColor=this.sanitizeHTML(t.getValue()),""}function FMe(t,e,i){return'<svg enable-background="new 0 0 24 24" height="14" width="14" viewBox="0 0 24 24" xml:space="preserve" ><path fill="#2DC214" clip-rule="evenodd" d="M21.652,3.211c-0.293-0.295-0.77-0.295-1.061,0L9.41,14.34  c-0.293,0.297-0.771,0.297-1.062,0L3.449,9.351C3.304,9.203,3.114,9.13,2.923,9.129C2.73,9.128,2.534,9.201,2.387,9.351  l-2.165,1.946C0.078,11.445,0,11.63,0,11.823c0,0.194,0.078,0.397,0.223,0.544l4.94,5.184c0.292,0.296,0.771,0.776,1.062,1.07  l2.124,2.141c0.292,0.293,0.769,0.293,1.062,0l14.366-14.34c0.293-0.294,0.293-0.777,0-1.071L21.652,3.211z" fill-rule="evenodd"/></svg>'}function LMe(t,e,i){return'<svg enable-background="new 0 0 24 24" height="14" width="14" viewBox="0 0 24 24" xml:space="preserve" ><path fill="#CE1515" d="M22.245,4.015c0.313,0.313,0.313,0.826,0,1.139l-6.276,6.27c-0.313,0.312-0.313,0.826,0,1.14l6.273,6.272  c0.313,0.313,0.313,0.826,0,1.14l-2.285,2.277c-0.314,0.312-0.828,0.312-1.142,0l-6.271-6.271c-0.313-0.313-0.828-0.313-1.141,0  l-6.276,6.267c-0.313,0.313-0.828,0.313-1.141,0l-2.282-2.28c-0.313-0.313-0.313-0.826,0-1.14l6.278-6.269  c0.313-0.312,0.313-0.826,0-1.14L1.709,5.147c-0.314-0.313-0.314-0.827,0-1.14l2.284-2.278C4.308,1.417,4.821,1.417,5.135,1.73  L11.405,8c0.314,0.314,0.828,0.314,1.141,0.001l6.276-6.267c0.312-0.312,0.826-0.312,1.141,0L22.245,4.015z"/></svg>'}function _Me(t,e,i){var r=t.getValue(),n=e.size||15,a=n+"px",s,o,l=e.hasOwnProperty("onValue")?e.onValue:!0,u=e.hasOwnProperty("offValue")?e.offValue:!1,c=e.onTruthy?r:r===l;return s=document.createElement("div"),s.classList.add("tabulator-toggle"),c?(s.classList.add("tabulator-toggle-on"),s.style.flexDirection="row-reverse",e.onColor&&(s.style.background=e.onColor)):e.offColor&&(s.style.background=e.offColor),s.style.width=2.5*n+"px",s.style.borderRadius=a,e.clickable&&s.addEventListener("click",d=>{t.setValue(c?u:l)}),o=document.createElement("div"),o.classList.add("tabulator-toggle-switch"),o.style.height=a,o.style.width=a,o.style.borderRadius=a,s.appendChild(o),s}function $Me(t,e,i){var r=document.createElement("span"),n=t.getRow(),a=t.getTable();return n.watchPosition(s=>{e.relativeToPage&&(s+=a.modules.page.getPageSize()*(a.modules.page.getPage()-1)),r.innerText=s}),r}function BMe(t,e,i){return t.getElement().classList.add("tabulator-row-handle"),"<div class='tabulator-row-handle-box'><div class='tabulator-row-handle-bar'></div><div class='tabulator-row-handle-bar'></div><div class='tabulator-row-handle-bar'></div></div>"}function VMe(t,e,i){var r,n,a;function s(o){var l=o.getValue(),u="plaintext";switch(typeof l){case"boolean":u="tickCross";break;case"string":l.includes(`
`)&&(u="textarea");break}return u}return r=e.formatterLookup?e.formatterLookup(t):s(t),e.paramsLookup&&(a=typeof e.paramsLookup=="function"?e.paramsLookup(r,t):e.paramsLookup[r]),n=this.table.modules.format.lookupFormatter(r),n.call(this,t,a||{},i)}function jMe(t,e,i){var r=e.delimiter||",",n=t.getValue(),a=this.table,s;return e.valueMap&&(typeof e.valueMap=="string"?s=function(o){return o.map(l=>gr.retrieveNestedData(a.options.nestedFieldSeparator,e.valueMap,l))}:s=e.valueMap),Array.isArray(n)?(s&&(n=s(n)),n.join(r)):n}function GMe(t,e,i){var r=e.indent||"	",n=typeof e.multiline>"u"?!0:e.multiline,a=e.replacer||null,s=t.getValue();return n&&(t.getElement().style.whiteSpace="pre-wrap"),JSON.stringify(s,a,r)}var HMe={plaintext:SMe,html:UMe,textarea:TMe,money:DMe,link:PMe,image:EMe,tickCross:RMe,datetime:CMe,datetimediff:MMe,lookup:NMe,star:AMe,traffic:kMe,progress:OMe,color:xMe,buttonTick:FMe,buttonCross:LMe,toggle:_Me,rownum:$Me,handle:BMe,adaptable:VMe,array:jMe,json:GMe};class Cg extends si{static moduleName="format";static formatters=HMe;constructor(e){super(e),this.registerColumnOption("formatter"),this.registerColumnOption("formatterParams"),this.registerColumnOption("formatterPrint"),this.registerColumnOption("formatterPrintParams"),this.registerColumnOption("formatterClipboard"),this.registerColumnOption("formatterClipboardParams"),this.registerColumnOption("formatterHtmlOutput"),this.registerColumnOption("formatterHtmlOutputParams"),this.registerColumnOption("titleFormatter"),this.registerColumnOption("titleFormatterParams")}initialize(){this.subscribe("cell-format",this.formatValue.bind(this)),this.subscribe("cell-rendered",this.cellRendered.bind(this)),this.subscribe("column-layout",this.initializeColumn.bind(this)),this.subscribe("column-format",this.formatHeader.bind(this))}initializeColumn(e){e.modules.format=this.lookupTypeFormatter(e,""),typeof e.definition.formatterPrint<"u"&&(e.modules.format.print=this.lookupTypeFormatter(e,"Print")),typeof e.definition.formatterClipboard<"u"&&(e.modules.format.clipboard=this.lookupTypeFormatter(e,"Clipboard")),typeof e.definition.formatterHtmlOutput<"u"&&(e.modules.format.htmlOutput=this.lookupTypeFormatter(e,"HtmlOutput"))}lookupTypeFormatter(e,i){var r={params:e.definition["formatter"+i+"Params"]||{}},n=e.definition["formatter"+i];return r.formatter=this.lookupFormatter(n),r}lookupFormatter(e){var i;switch(typeof e){case"string":Cg.formatters[e]?i=Cg.formatters[e]:(console.warn("Formatter Error - No such formatter found: ",e),i=Cg.formatters.plaintext);break;case"function":i=e;break;default:i=Cg.formatters.plaintext;break}return i}cellRendered(e){e.modules.format&&e.modules.format.renderedCallback&&!e.modules.format.rendered&&(e.modules.format.renderedCallback(),e.modules.format.rendered=!0)}formatHeader(e,i,r){var n,a,s,o;return e.definition.titleFormatter?(n=this.lookupFormatter(e.definition.titleFormatter),s=l=>{e.titleFormatterRendered=l},o={getValue:function(){return i},getElement:function(){return r},getType:function(){return"header"},getColumn:function(){return e.getComponent()},getTable:()=>this.table},a=e.definition.titleFormatterParams||{},a=typeof a=="function"?a():a,n.call(this,o,a,s)):i}formatValue(e){var i=e.getComponent(),r=typeof e.column.modules.format.params=="function"?e.column.modules.format.params(i):e.column.modules.format.params;function n(a){e.modules.format||(e.modules.format={}),e.modules.format.renderedCallback=a,e.modules.format.rendered=!1}return e.column.modules.format.formatter.call(this,i,r,n)}formatExportValue(e,i){var r=e.column.modules.format[i],n;if(r){let s=function(o){e.modules.format||(e.modules.format={}),e.modules.format.renderedCallback=o,e.modules.format.rendered=!1};var a=s;return n=typeof r.params=="function"?r.params(e.getComponent()):r.params,r.formatter.call(this,e.getComponent(),n,s)}else return this.formatValue(e)}sanitizeHTML(e){if(e){var i={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};return String(e).replace(/[&<>"'`=/]/g,function(r){return i[r]})}else return e}emptyToSpace(e){return e===null||typeof e>"u"||e===""?"&nbsp;":e}}class WMe extends si{static moduleName="frozenColumns";constructor(e){super(e),this.leftColumns=[],this.rightColumns=[],this.initializationMode="left",this.active=!1,this.blocked=!0,this.registerColumnOption("frozen")}reset(){this.initializationMode="left",this.leftColumns=[],this.rightColumns=[],this.active=!1}initialize(){this.subscribe("cell-layout",this.layoutCell.bind(this)),this.subscribe("column-init",this.initializeColumn.bind(this)),this.subscribe("column-width",this.layout.bind(this)),this.subscribe("row-layout-after",this.layoutRow.bind(this)),this.subscribe("table-layout",this.layout.bind(this)),this.subscribe("columns-loading",this.reset.bind(this)),this.subscribe("column-add",this.reinitializeColumns.bind(this)),this.subscribe("column-deleted",this.reinitializeColumns.bind(this)),this.subscribe("column-hide",this.reinitializeColumns.bind(this)),this.subscribe("column-show",this.reinitializeColumns.bind(this)),this.subscribe("columns-loaded",this.reinitializeColumns.bind(this)),this.subscribe("table-redraw",this.layout.bind(this)),this.subscribe("layout-refreshing",this.blockLayout.bind(this)),this.subscribe("layout-refreshed",this.unblockLayout.bind(this)),this.subscribe("scrollbar-vertical",this.adjustForScrollbar.bind(this))}blockLayout(){this.blocked=!0}unblockLayout(){this.blocked=!1}layoutCell(e){this.layoutElement(e.element,e.column)}reinitializeColumns(){this.reset(),this.table.columnManager.columnsByIndex.forEach(e=>{this.initializeColumn(e)}),this.layout()}initializeColumn(e){var i={margin:0,edge:!1};e.isGroup||(this.frozenCheck(e)?(i.position=this.initializationMode,this.initializationMode=="left"?this.leftColumns.push(e):this.rightColumns.unshift(e),this.active=!0,e.modules.frozen=i):this.initializationMode="right")}frozenCheck(e){return e.parent.isGroup&&e.definition.frozen&&console.warn("Frozen Column Error - Parent column group must be frozen, not individual columns or sub column groups"),e.parent.isGroup?this.frozenCheck(e.parent):e.definition.frozen}layoutCalcRows(){this.table.modExists("columnCalcs")&&(this.table.modules.columnCalcs.topInitialized&&this.table.modules.columnCalcs.topRow&&this.layoutRow(this.table.modules.columnCalcs.topRow),this.table.modules.columnCalcs.botInitialized&&this.table.modules.columnCalcs.botRow&&this.layoutRow(this.table.modules.columnCalcs.botRow),this.table.modExists("groupRows")&&this.layoutGroupCalcs(this.table.modules.groupRows.getGroups()))}layoutGroupCalcs(e){e.forEach(i=>{i.calcs.top&&this.layoutRow(i.calcs.top),i.calcs.bottom&&this.layoutRow(i.calcs.bottom),i.groupList&&i.groupList.length&&this.layoutGroupCalcs(i.groupList)})}layoutColumnPosition(e){var i=[],r=0,n=0;this.leftColumns.forEach((a,s)=>{if(a.modules.frozen.marginValue=r,a.modules.frozen.margin=a.modules.frozen.marginValue+"px",a.visible&&(r+=a.getWidth()),s==this.leftColumns.length-1?a.modules.frozen.edge=!0:a.modules.frozen.edge=!1,a.parent.isGroup){var o=this.getColGroupParentElement(a);i.includes(o)||(this.layoutElement(o,a),i.push(o)),o.classList.toggle("tabulator-frozen-left",a.modules.frozen.edge&&a.modules.frozen.position==="left"),o.classList.toggle("tabulator-frozen-right",a.modules.frozen.edge&&a.modules.frozen.position==="right")}else this.layoutElement(a.getElement(),a);e&&a.cells.forEach(l=>{this.layoutElement(l.getElement(!0),a)})}),this.rightColumns.forEach((a,s)=>{a.modules.frozen.marginValue=n,a.modules.frozen.margin=a.modules.frozen.marginValue+"px",a.visible&&(n+=a.getWidth()),s==this.rightColumns.length-1?a.modules.frozen.edge=!0:a.modules.frozen.edge=!1,a.parent.isGroup?this.layoutElement(this.getColGroupParentElement(a),a):this.layoutElement(a.getElement(),a),e&&a.cells.forEach(o=>{this.layoutElement(o.getElement(!0),a)})})}getColGroupParentElement(e){return e.parent.isGroup?this.getColGroupParentElement(e.parent):e.getElement()}layout(){this.active&&!this.blocked&&(this.layoutColumnPosition(),this.reinitializeRows(),this.layoutCalcRows())}reinitializeRows(){var e=this.table.rowManager.getVisibleRows(!0),i=this.table.rowManager.getRows().filter(r=>!e.includes(r));i.forEach(r=>{r.deinitialize()}),e.forEach(r=>{r.type==="row"&&this.layoutRow(r)})}layoutRow(e){this.table.options.layout==="fitDataFill"&&this.rightColumns.length&&(this.table.rowManager.getTableElement().style.minWidth="calc(100% - "+this.rightMargin+")"),this.leftColumns.forEach(i=>{var r=e.getCell(i);r&&this.layoutElement(r.getElement(!0),i)}),this.rightColumns.forEach(i=>{var r=e.getCell(i);r&&this.layoutElement(r.getElement(!0),i)})}layoutElement(e,i){var r;i.modules.frozen&&e&&(e.style.position="sticky",this.table.rtl?r=i.modules.frozen.position==="left"?"right":"left":r=i.modules.frozen.position,e.style[r]=i.modules.frozen.margin,e.classList.add("tabulator-frozen"),e.classList.toggle("tabulator-frozen-left",i.modules.frozen.edge&&i.modules.frozen.position==="left"),e.classList.toggle("tabulator-frozen-right",i.modules.frozen.edge&&i.modules.frozen.position==="right"))}adjustForScrollbar(e){this.rightColumns.length&&(this.table.columnManager.getContentsElement().style.width="calc(100% - "+e+"px)")}getFrozenColumns(){return this.leftColumns.concat(this.rightColumns)}_calcSpace(e,i){var r=0;for(let n=0;n<i;n++)e[n].visible&&(r+=e[n].getWidth());return r}}class zMe extends si{static moduleName="frozenRows";constructor(e){super(e),this.topElement=document.createElement("div"),this.rows=[],this.registerComponentFunction("row","freeze",this.freezeRow.bind(this)),this.registerComponentFunction("row","unfreeze",this.unfreezeRow.bind(this)),this.registerComponentFunction("row","isFrozen",this.isRowFrozen.bind(this)),this.registerTableOption("frozenRowsField","id"),this.registerTableOption("frozenRows",!1)}initialize(){var e=document.createDocumentFragment();this.rows=[],this.topElement.classList.add("tabulator-frozen-rows-holder"),e.appendChild(document.createElement("br")),e.appendChild(this.topElement),this.table.columnManager.getContentsElement().insertBefore(e,this.table.columnManager.headersElement.nextSibling),this.subscribe("row-deleting",this.detachRow.bind(this)),this.subscribe("rows-visible",this.visibleRows.bind(this)),this.registerDisplayHandler(this.getRows.bind(this),10),this.table.options.frozenRows&&(this.subscribe("data-processed",this.initializeRows.bind(this)),this.subscribe("row-added",this.initializeRow.bind(this)),this.subscribe("table-redrawing",this.resizeHolderWidth.bind(this)),this.subscribe("column-resized",this.resizeHolderWidth.bind(this)),this.subscribe("column-show",this.resizeHolderWidth.bind(this)),this.subscribe("column-hide",this.resizeHolderWidth.bind(this))),this.resizeHolderWidth()}resizeHolderWidth(){this.topElement.style.minWidth=this.table.columnManager.headersElement.offsetWidth+"px"}initializeRows(){this.table.rowManager.getRows().forEach(e=>{this.initializeRow(e)})}initializeRow(e){var i=this.table.options.frozenRows,r=typeof i;r==="number"?e.getPosition()&&e.getPosition()+this.rows.length<=i&&this.freezeRow(e):r==="function"?i.call(this.table,e.getComponent())&&this.freezeRow(e):Array.isArray(i)&&i.includes(e.data[this.options("frozenRowsField")])&&this.freezeRow(e)}isRowFrozen(e){var i=this.rows.indexOf(e);return i>-1}isFrozen(){return!!this.rows.length}visibleRows(e,i){return this.rows.forEach(r=>{i.push(r)}),i}getRows(e){var i=e.slice(0);return this.rows.forEach(function(r){var n=i.indexOf(r);n>-1&&i.splice(n,1)}),i}freezeRow(e){e.modules.frozen?console.warn("Freeze Error - Row is already frozen"):(e.modules.frozen=!0,this.topElement.appendChild(e.getElement()),e.initialize(),e.normalizeHeight(),this.rows.push(e),this.refreshData(!1,"display"),this.table.rowManager.adjustTableSize(),this.styleRows())}unfreezeRow(e){e.modules.frozen?(e.modules.frozen=!1,this.detachRow(e),this.table.rowManager.adjustTableSize(),this.refreshData(!1,"display"),this.rows.length&&this.styleRows()):console.warn("Freeze Error - Row is already unfrozen")}detachRow(e){var i=this.rows.indexOf(e);if(i>-1){var r=e.getElement();r.parentNode&&r.parentNode.removeChild(r),this.rows.splice(i,1)}}styleRows(e){this.rows.forEach((i,r)=>{this.table.rowManager.styleRow(i,r)})}}class qMe{constructor(e){return this._group=e,this.type="GroupComponent",new Proxy(this,{get:function(i,r,n){return typeof i[r]<"u"?i[r]:i._group.groupManager.table.componentFunctionBinder.handle("group",i._group,r)}})}getKey(){return this._group.key}getField(){return this._group.field}getElement(){return this._group.element}getRows(){return this._group.getRows(!0)}getSubGroups(){return this._group.getSubGroups(!0)}getParentGroup(){return this._group.parent?this._group.parent.getComponent():!1}isVisible(){return this._group.visible}show(){this._group.show()}hide(){this._group.hide()}toggle(){this._group.toggleVisibility()}scrollTo(e,i){return this._group.groupManager.table.rowManager.scrollToRow(this._group,e,i)}_getSelf(){return this._group}getTable(){return this._group.groupManager.table}}class Mg{constructor(e,i,r,n,a,s,o){this.groupManager=e,this.parent=i,this.key=n,this.level=r,this.field=a,this.hasSubGroups=r<e.groupIDLookups.length-1,this.addRow=this.hasSubGroups?this._addRowToGroup:this._addRow,this.type="group",this.old=o,this.rows=[],this.groups=[],this.groupList=[],this.generator=s,this.element=!1,this.elementContents=!1,this.height=0,this.outerHeight=0,this.initialized=!1,this.calcs={},this.initialized=!1,this.modules={},this.arrowElement=!1,this.visible=o?o.visible:typeof e.startOpen[r]<"u"?e.startOpen[r]:e.startOpen[0],this.component=null,this.createElements(),this.addBindings(),this.createValueGroups()}wipe(e){e||(this.groupList.length?this.groupList.forEach(function(i){i.wipe()}):this.rows.forEach(i=>{i.modules&&delete i.modules.group})),this.element=!1,this.arrowElement=!1,this.elementContents=!1}createElements(){var e=document.createElement("div");e.classList.add("tabulator-arrow"),this.element=document.createElement("div"),this.element.classList.add("tabulator-row"),this.element.classList.add("tabulator-group"),this.element.classList.add("tabulator-group-level-"+this.level),this.element.setAttribute("role","rowgroup"),this.arrowElement=document.createElement("div"),this.arrowElement.classList.add("tabulator-group-toggle"),this.arrowElement.appendChild(e),this.groupManager.table.options.movableRows!==!1&&this.groupManager.table.modExists("moveRow")&&this.groupManager.table.modules.moveRow.initializeGroupHeader(this)}createValueGroups(){var e=this.level+1;this.groupManager.allowedValues&&this.groupManager.allowedValues[e]&&this.groupManager.allowedValues[e].forEach(i=>{this._createGroup(i,e)})}addBindings(){var e;this.groupManager.table.options.groupToggleElement&&(e=this.groupManager.table.options.groupToggleElement=="arrow"?this.arrowElement:this.element,e.addEventListener("click",i=>{this.groupManager.table.options.groupToggleElement==="arrow"&&(i.stopPropagation(),i.stopImmediatePropagation()),setTimeout(()=>{this.toggleVisibility()})}))}_createGroup(e,i){var r=i+"_"+e,n=new Mg(this.groupManager,this,i,e,this.groupManager.groupIDLookups[i].field,this.groupManager.headerGenerator[i]||this.groupManager.headerGenerator[0],this.old?this.old.groups[r]:!1);this.groups[r]=n,this.groupList.push(n)}_addRowToGroup(e){var i=this.level+1;if(this.hasSubGroups){var r=this.groupManager.groupIDLookups[i].func(e.getData()),n=i+"_"+r;this.groupManager.allowedValues&&this.groupManager.allowedValues[i]?this.groups[n]&&this.groups[n].addRow(e):(this.groups[n]||this._createGroup(r,i),this.groups[n].addRow(e))}}_addRow(e){this.rows.push(e),e.modules.group=this}insertRow(e,i,r){var n=this.conformRowData({});e.updateData(n);var a=this.rows.indexOf(i);a>-1?r?this.rows.splice(a+1,0,e):this.rows.splice(a,0,e):r?this.rows.push(e):this.rows.unshift(e),e.modules.group=this,this.groupManager.table.modExists("columnCalcs")&&this.groupManager.table.options.columnCalcs!="table"&&this.groupManager.table.modules.columnCalcs.recalcGroup(this),this.groupManager.updateGroupRows(!0)}scrollHeader(e){this.arrowElement&&(this.arrowElement.style.marginLeft=e,this.groupList.forEach(function(i){i.scrollHeader(e)}))}getRowIndex(e){}conformRowData(e){return this.field?e[this.field]=this.key:console.warn("Data Conforming Error - Cannot conform row data to match new group as groupBy is a function"),this.parent&&(e=this.parent.conformRowData(e)),e}removeRow(e){var i=this.rows.indexOf(e),r=e.getElement();i>-1&&this.rows.splice(i,1),!this.groupManager.table.options.groupValues&&!this.rows.length?(this.parent?this.parent.removeGroup(this):this.groupManager.removeGroup(this),this.groupManager.updateGroupRows(!0)):(r.parentNode&&r.parentNode.removeChild(r),this.groupManager.blockRedraw||(this.generateGroupHeaderContents(),this.groupManager.table.modExists("columnCalcs")&&this.groupManager.table.options.columnCalcs!="table"&&this.groupManager.table.modules.columnCalcs.recalcGroup(this)))}removeGroup(e){var i=e.level+"_"+e.key,r;this.groups[i]&&(delete this.groups[i],r=this.groupList.indexOf(e),r>-1&&this.groupList.splice(r,1),this.groupList.length||(this.parent?this.parent.removeGroup(this):this.groupManager.removeGroup(this)))}getHeadersAndRows(){var e=[];return e.push(this),this._visSet(),this.calcs.top&&(this.calcs.top.detachElement(),this.calcs.top.deleteCells()),this.calcs.bottom&&(this.calcs.bottom.detachElement(),this.calcs.bottom.deleteCells()),this.visible?this.groupList.length?this.groupList.forEach(function(i){e=e.concat(i.getHeadersAndRows())}):(this.groupManager.table.options.columnCalcs!="table"&&this.groupManager.table.modExists("columnCalcs")&&this.groupManager.table.modules.columnCalcs.hasTopCalcs()&&(this.calcs.top=this.groupManager.table.modules.columnCalcs.generateTopRow(this.rows),e.push(this.calcs.top)),e=e.concat(this.rows),this.groupManager.table.options.columnCalcs!="table"&&this.groupManager.table.modExists("columnCalcs")&&this.groupManager.table.modules.columnCalcs.hasBottomCalcs()&&(this.calcs.bottom=this.groupManager.table.modules.columnCalcs.generateBottomRow(this.rows),e.push(this.calcs.bottom))):!this.groupList.length&&this.groupManager.table.options.columnCalcs!="table"&&this.groupManager.table.modExists("columnCalcs")&&(this.groupManager.table.modules.columnCalcs.hasTopCalcs()&&this.groupManager.table.options.groupClosedShowCalcs&&(this.calcs.top=this.groupManager.table.modules.columnCalcs.generateTopRow(this.rows),e.push(this.calcs.top)),this.groupManager.table.modules.columnCalcs.hasBottomCalcs()&&this.groupManager.table.options.groupClosedShowCalcs&&(this.calcs.bottom=this.groupManager.table.modules.columnCalcs.generateBottomRow(this.rows),e.push(this.calcs.bottom))),e}getData(e,i){var r=[];return this._visSet(),(!e||e&&this.visible)&&this.rows.forEach(n=>{r.push(n.getData(i||"data"))}),r}getRowCount(){var e=0;return this.groupList.length?this.groupList.forEach(i=>{e+=i.getRowCount()}):e=this.rows.length,e}toggleVisibility(){this.visible?this.hide():this.show()}hide(){this.visible=!1,this.groupManager.table.rowManager.getRenderMode()=="basic"&&!this.groupManager.table.options.pagination?(this.element.classList.remove("tabulator-group-visible"),this.groupList.length?this.groupList.forEach(e=>{var i=e.getHeadersAndRows();i.forEach(r=>{r.detachElement()})}):this.rows.forEach(e=>{var i=e.getElement();i.parentNode.removeChild(i)}),this.groupManager.updateGroupRows(!0)):this.groupManager.updateGroupRows(!0),this.groupManager.table.externalEvents.dispatch("groupVisibilityChanged",this.getComponent(),!1)}show(){if(this.visible=!0,this.groupManager.table.rowManager.getRenderMode()=="basic"&&!this.groupManager.table.options.pagination){this.element.classList.add("tabulator-group-visible");var e=this.generateElement();this.groupList.length?this.groupList.forEach(i=>{var r=i.getHeadersAndRows();r.forEach(n=>{var a=n.getElement();e.parentNode.insertBefore(a,e.nextSibling),n.initialize(),e=a})}):this.rows.forEach(i=>{var r=i.getElement();e.parentNode.insertBefore(r,e.nextSibling),i.initialize(),e=r}),this.groupManager.updateGroupRows(!0)}else this.groupManager.updateGroupRows(!0);this.groupManager.table.externalEvents.dispatch("groupVisibilityChanged",this.getComponent(),!0)}_visSet(){var e=[];typeof this.visible=="function"&&(this.rows.forEach(function(i){e.push(i.getData())}),this.visible=this.visible(this.key,this.getRowCount(),e,this.getComponent()))}getRowGroup(e){var i=!1;return this.groupList.length?this.groupList.forEach(function(r){var n=r.getRowGroup(e);n&&(i=n)}):this.rows.find(function(r){return r===e})&&(i=this),i}getSubGroups(e){var i=[];return this.groupList.forEach(function(r){i.push(e?r.getComponent():r)}),i}getRows(e,i){var r=[];return i&&this.groupList.length?this.groupList.forEach(n=>{r=r.concat(n.getRows(e,i))}):this.rows.forEach(function(n){r.push(e?n.getComponent():n)}),r}generateGroupHeaderContents(){var e=[],i=this.getRows(!1,!0);for(i.forEach(function(r){e.push(r.getData())}),this.elementContents=this.generator(this.key,this.getRowCount(),e,this.getComponent());this.element.firstChild;)this.element.removeChild(this.element.firstChild);typeof this.elementContents=="string"?this.element.innerHTML=this.elementContents:this.element.appendChild(this.elementContents),this.element.insertBefore(this.arrowElement,this.element.firstChild)}getPath(e=[]){return e.unshift(this.key),this.parent&&this.parent.getPath(e),e}getElement(){return this.elementContents?this.element:this.generateElement()}generateElement(){this.addBindings=!1,this._visSet(),this.visible?this.element.classList.add("tabulator-group-visible"):this.element.classList.remove("tabulator-group-visible");for(var e=0;e<this.element.childNodes.length;++e)this.element.childNodes[e].parentNode.removeChild(this.element.childNodes[e]);return this.generateGroupHeaderContents(),this.element}detachElement(){this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element)}normalizeHeight(){this.setHeight(this.element.clientHeight)}initialize(e){(!this.initialized||e)&&(this.normalizeHeight(),this.initialized=!0)}reinitialize(){this.initialized=!1,this.height=0,gr.elVisible(this.element)&&this.initialize(!0)}setHeight(e){this.height!=e&&(this.height=e,this.outerHeight=this.element.offsetHeight)}getHeight(){return this.outerHeight}getGroup(){return this}reinitializeHeight(){}calcHeight(){}setCellHeight(){}clearCellHeight(){}deinitializeHeight(){}rendered(){}getComponent(){return this.component||(this.component=new qMe(this)),this.component}}class YMe extends si{static moduleName="groupRows";constructor(e){super(e),this.groupIDLookups=!1,this.startOpen=[function(){return!1}],this.headerGenerator=[function(){return""}],this.groupList=[],this.allowedValues=!1,this.groups={},this.displayHandler=this.getRows.bind(this),this.blockRedraw=!1,this.registerTableOption("groupBy",!1),this.registerTableOption("groupStartOpen",!0),this.registerTableOption("groupValues",!1),this.registerTableOption("groupUpdateOnCellEdit",!1),this.registerTableOption("groupHeader",!1),this.registerTableOption("groupHeaderPrint",null),this.registerTableOption("groupHeaderClipboard",null),this.registerTableOption("groupHeaderHtmlOutput",null),this.registerTableOption("groupHeaderDownload",null),this.registerTableOption("groupToggleElement","arrow"),this.registerTableOption("groupClosedShowCalcs",!1),this.registerTableFunction("setGroupBy",this.setGroupBy.bind(this)),this.registerTableFunction("setGroupValues",this.setGroupValues.bind(this)),this.registerTableFunction("setGroupStartOpen",this.setGroupStartOpen.bind(this)),this.registerTableFunction("setGroupHeader",this.setGroupHeader.bind(this)),this.registerTableFunction("getGroups",this.userGetGroups.bind(this)),this.registerTableFunction("getGroupedData",this.userGetGroupedData.bind(this)),this.registerComponentFunction("row","getGroup",this.rowGetGroup.bind(this))}initialize(){this.subscribe("table-destroy",this._blockRedrawing.bind(this)),this.subscribe("rows-wipe",this._blockRedrawing.bind(this)),this.subscribe("rows-wiped",this._restore_redrawing.bind(this)),this.table.options.groupBy&&(this.table.options.groupUpdateOnCellEdit&&(this.subscribe("cell-value-updated",this.cellUpdated.bind(this)),this.subscribe("row-data-changed",this.reassignRowToGroup.bind(this),0)),this.subscribe("table-built",this.configureGroupSetup.bind(this)),this.subscribe("row-deleting",this.rowDeleting.bind(this)),this.subscribe("row-deleted",this.rowsUpdated.bind(this)),this.subscribe("scroll-horizontal",this.scrollHeaders.bind(this)),this.subscribe("rows-wipe",this.wipe.bind(this)),this.subscribe("rows-added",this.rowsUpdated.bind(this)),this.subscribe("row-moving",this.rowMoving.bind(this)),this.subscribe("row-adding-index",this.rowAddingIndex.bind(this)),this.subscribe("rows-sample",this.rowSample.bind(this)),this.subscribe("render-virtual-fill",this.virtualRenderFill.bind(this)),this.registerDisplayHandler(this.displayHandler,20),this.initialized=!0)}_blockRedrawing(){this.blockRedraw=!0}_restore_redrawing(){this.blockRedraw=!1}configureGroupSetup(){if(this.table.options.groupBy){var e=this.table.options.groupBy,i=this.table.options.groupStartOpen,r=this.table.options.groupHeader;if(this.allowedValues=this.table.options.groupValues,Array.isArray(e)&&Array.isArray(r)&&e.length>r.length&&console.warn("Error creating group headers, groupHeader array is shorter than groupBy array"),this.headerGenerator=[function(){return""}],this.startOpen=[function(){return!1}],this.langBind("groups|item",(a,s)=>{this.headerGenerator[0]=(o,l,u)=>(typeof o>"u"?"":o)+"<span>("+l+" "+(l===1?a:s.groups.items)+")</span>"}),this.groupIDLookups=[],e)this.table.modExists("columnCalcs")&&this.table.options.columnCalcs!="table"&&this.table.options.columnCalcs!="both"&&this.table.modules.columnCalcs.removeCalcs();else if(this.table.modExists("columnCalcs")&&this.table.options.columnCalcs!="group"){var n=this.table.columnManager.getRealColumns();n.forEach(a=>{a.definition.topCalc&&this.table.modules.columnCalcs.initializeTopRow(),a.definition.bottomCalc&&this.table.modules.columnCalcs.initializeBottomRow()})}Array.isArray(e)||(e=[e]),e.forEach((a,s)=>{var o,l;typeof a=="function"?o=a:(l=this.table.columnManager.getColumnByField(a),l?o=function(u){return l.getFieldValue(u)}:o=function(u){return u[a]}),this.groupIDLookups.push({field:typeof a=="function"?!1:a,func:o,values:this.allowedValues?this.allowedValues[s]:!1})}),i&&(Array.isArray(i)||(i=[i]),i.forEach(a=>{}),this.startOpen=i),r&&(this.headerGenerator=Array.isArray(r)?r:[r])}else this.groupList=[],this.groups={}}rowSample(e,i){if(this.table.options.groupBy){var r=this.getGroups(!1)[0];i.push(r.getRows(!1)[0])}return i}virtualRenderFill(){var e=this.table.rowManager.tableElement,i=this.table.rowManager.getVisibleRows();if(this.table.options.groupBy)i=i.filter(r=>r.type!=="group"),e.style.minWidth=i.length?"":this.table.columnManager.getWidth()+"px";else return i}rowAddingIndex(e,i,r){if(this.table.options.groupBy){this.assignRowToGroup(e);var n=e.modules.group.rows;return n.length>1&&(!i||i&&n.indexOf(i)==-1?r?n[0]!==e&&(i=n[0],this.table.rowManager.moveRowInArray(e.modules.group.rows,e,i,!r)):n[n.length-1]!==e&&(i=n[n.length-1],this.table.rowManager.moveRowInArray(e.modules.group.rows,e,i,!r)):this.table.rowManager.moveRowInArray(e.modules.group.rows,e,i,!r)),i}}trackChanges(){this.dispatch("group-changed")}setGroupBy(e){this.table.options.groupBy=e,this.initialized||this.initialize(),this.configureGroupSetup(),!e&&this.table.modExists("columnCalcs")&&this.table.options.columnCalcs===!0&&this.table.modules.columnCalcs.reinitializeCalcs(),this.refreshData(),this.trackChanges()}setGroupValues(e){this.table.options.groupValues=e,this.configureGroupSetup(),this.refreshData(),this.trackChanges()}setGroupStartOpen(e){this.table.options.groupStartOpen=e,this.configureGroupSetup(),this.table.options.groupBy?(this.refreshData(),this.trackChanges()):console.warn("Grouping Update - cant refresh view, no groups have been set")}setGroupHeader(e){this.table.options.groupHeader=e,this.configureGroupSetup(),this.table.options.groupBy?(this.refreshData(),this.trackChanges()):console.warn("Grouping Update - cant refresh view, no groups have been set")}userGetGroups(e){return this.getGroups(!0)}userGetGroupedData(){return this.table.options.groupBy?this.getGroupedData():this.getData()}rowGetGroup(e){return e.modules.group?e.modules.group.getComponent():!1}rowMoving(e,i,r){if(this.table.options.groupBy){!r&&i instanceof Mg&&(i=this.table.rowManager.prevDisplayRow(e)||i);var n=i instanceof Mg?i:i.modules.group,a=e instanceof Mg?e:e.modules.group;n===a?this.table.rowManager.moveRowInArray(n.rows,e,i,r):(a&&a.removeRow(e),n.insertRow(e,i,r))}}rowDeleting(e){this.table.options.groupBy&&e.modules.group&&e.modules.group.removeRow(e)}rowsUpdated(e){this.table.options.groupBy&&this.updateGroupRows(!0)}cellUpdated(e){this.table.options.groupBy&&this.reassignRowToGroup(e.row)}getRows(e){return this.table.options.groupBy&&this.groupIDLookups.length?(this.dispatchExternal("dataGrouping"),this.generateGroups(e),this.subscribedExternal("dataGrouped")&&this.dispatchExternal("dataGrouped",this.getGroups(!0)),this.updateGroupRows()):e.slice(0)}getGroups(e){var i=[];return this.groupList.forEach(function(r){i.push(e?r.getComponent():r)}),i}getChildGroups(e){var i=[];return e||(e=this),e.groupList.forEach(r=>{r.groupList.length?i=i.concat(this.getChildGroups(r)):i.push(r)}),i}wipe(){this.table.options.groupBy&&(this.groupList.forEach(function(e){e.wipe()}),this.groupList=[],this.groups={})}pullGroupListData(e){var i=[];return e.forEach(r=>{var n={};n.level=0,n.rowCount=0,n.headerContent="";var a=[];r.hasSubGroups?(a=this.pullGroupListData(r.groupList),n.level=r.level,n.rowCount=a.length-r.groupList.length,n.headerContent=r.generator(r.key,n.rowCount,r.rows,r),i.push(n),i=i.concat(a)):(n.level=r.level,n.headerContent=r.generator(r.key,r.rows.length,r.rows,r),n.rowCount=r.getRows().length,i.push(n),r.getRows().forEach(s=>{i.push(s.getData("data"))}))}),i}getGroupedData(){return this.pullGroupListData(this.groupList)}getRowGroup(e){var i=!1;return this.options("dataTree")&&(e=this.table.modules.dataTree.getTreeParentRoot(e)),this.groupList.forEach(r=>{var n=r.getRowGroup(e);n&&(i=n)}),i}countGroups(){return this.groupList.length}generateGroups(e){var i=this.groups;this.groups={},this.groupList=[],this.allowedValues&&this.allowedValues[0]?(this.allowedValues[0].forEach(r=>{this.createGroup(r,0,i)}),e.forEach(r=>{this.assignRowToExistingGroup(r,i)})):e.forEach(r=>{this.assignRowToGroup(r,i)}),Object.values(i).forEach(r=>{r.wipe(!0)})}createGroup(e,i,r){var n=i+"_"+e,a;r=r||[],a=new Mg(this,!1,i,e,this.groupIDLookups[0].field,this.headerGenerator[0],r[n]),this.groups[n]=a,this.groupList.push(a)}assignRowToExistingGroup(e,i){var r=this.groupIDLookups[0].func(e.getData()),n="0_"+r;this.groups[n]&&this.groups[n].addRow(e)}assignRowToGroup(e,i){var r=this.groupIDLookups[0].func(e.getData()),n=!this.groups["0_"+r];return n&&this.createGroup(r,0,i),this.groups["0_"+r].addRow(e),!n}reassignRowToGroup(e){if(e.type==="row"){var i=e.modules.group,r=i.getPath(),n=this.getExpectedPath(e),a;a=r.length==n.length&&r.every((s,o)=>s===n[o]),a||(i.removeRow(e),this.assignRowToGroup(e,this.groups),this.refreshData(!0))}}getExpectedPath(e){var i=[],r=e.getData();return this.groupIDLookups.forEach(n=>{i.push(n.func(r))}),i}updateGroupRows(e){var i=[];return this.blockRedraw||(this.groupList.forEach(r=>{i=i.concat(r.getHeadersAndRows())}),e&&this.refreshData(!0)),i}scrollHeaders(e){this.table.options.groupBy&&(this.table.options.renderHorizontal==="virtual"&&(e-=this.table.columnManager.renderer.vDomPadLeft),e=e+"px",this.groupList.forEach(i=>{i.scrollHeader(e)}))}removeGroup(e){var i=e.level+"_"+e.key,r;this.groups[i]&&(delete this.groups[i],r=this.groupList.indexOf(e),r>-1&&this.groupList.splice(r,1))}checkBasicModeGroupHeaderWidth(){var e=this.table.rowManager.tableElement,i=!0;this.table.rowManager.getDisplayRows().forEach((r,n)=>{this.table.rowManager.styleRow(r,n),e.appendChild(r.getElement()),r.initialize(!0),r.type!=="group"&&(i=!1)}),i?e.style.minWidth=this.table.columnManager.getWidth()+"px":e.style.minWidth=""}}var KMe={cellEdit:function(t){t.component.setValueProcessData(t.data.oldValue),t.component.cellRendered()},rowAdd:function(t){t.component.deleteActual(),this.table.rowManager.checkPlaceholder()},rowDelete:function(t){var e=this.table.rowManager.addRowActual(t.data.data,t.data.pos,t.data.index);this.table.options.groupBy&&this.table.modExists("groupRows")&&this.table.modules.groupRows.updateGroupRows(!0),this._rebindRow(t.component,e),this.table.rowManager.checkPlaceholder()},rowMove:function(t){var e=t.data.posFrom-t.data.posTo>0;this.table.rowManager.moveRowActual(t.component,this.table.rowManager.getRowFromPosition(t.data.posFrom),e),this.table.rowManager.regenerateRowPositions(),this.table.rowManager.reRenderInPosition()}},XMe={cellEdit:function(t){t.component.setValueProcessData(t.data.newValue),t.component.cellRendered()},rowAdd:function(t){var e=this.table.rowManager.addRowActual(t.data.data,t.data.pos,t.data.index);this.table.options.groupBy&&this.table.modExists("groupRows")&&this.table.modules.groupRows.updateGroupRows(!0),this._rebindRow(t.component,e),this.table.rowManager.checkPlaceholder()},rowDelete:function(t){t.component.deleteActual(),this.table.rowManager.checkPlaceholder()},rowMove:function(t){this.table.rowManager.moveRowActual(t.component,this.table.rowManager.getRowFromPosition(t.data.posTo),t.data.after),this.table.rowManager.regenerateRowPositions(),this.table.rowManager.reRenderInPosition()}},JMe={undo:["ctrl + 90","meta + 90"],redo:["ctrl + 89","meta + 89"]},QMe={undo:function(t){var e=!1;this.table.options.history&&this.table.modExists("history")&&this.table.modExists("edit")&&(e=this.table.modules.edit.currentCell,e||(t.preventDefault(),this.table.modules.history.undo()))},redo:function(t){var e=!1;this.table.options.history&&this.table.modExists("history")&&this.table.modExists("edit")&&(e=this.table.modules.edit.currentCell,e||(t.preventDefault(),this.table.modules.history.redo()))}},ZMe={keybindings:{bindings:JMe,actions:QMe}};class vP extends si{static moduleName="history";static moduleExtensions=ZMe;static undoers=KMe;static redoers=XMe;constructor(e){super(e),this.history=[],this.index=-1,this.registerTableOption("history",!1)}initialize(){this.table.options.history&&(this.subscribe("cell-value-updated",this.cellUpdated.bind(this)),this.subscribe("cell-delete",this.clearComponentHistory.bind(this)),this.subscribe("row-delete",this.rowDeleted.bind(this)),this.subscribe("rows-wipe",this.clear.bind(this)),this.subscribe("row-added",this.rowAdded.bind(this)),this.subscribe("row-move",this.rowMoved.bind(this))),this.registerTableFunction("undo",this.undo.bind(this)),this.registerTableFunction("redo",this.redo.bind(this)),this.registerTableFunction("getHistoryUndoSize",this.getHistoryUndoSize.bind(this)),this.registerTableFunction("getHistoryRedoSize",this.getHistoryRedoSize.bind(this)),this.registerTableFunction("clearHistory",this.clear.bind(this))}rowMoved(e,i,r){this.action("rowMove",e,{posFrom:e.getPosition(),posTo:i.getPosition(),to:i,after:r})}rowAdded(e,i,r,n){this.action("rowAdd",e,{data:i,pos:r,index:n})}rowDeleted(e){var i,r;this.table.options.groupBy?(r=e.getComponent().getGroup()._getSelf().rows,i=r.indexOf(e),i&&(i=r[i-1])):(i=e.table.rowManager.getRowIndex(e),i&&(i=e.table.rowManager.rows[i-1])),this.action("rowDelete",e,{data:e.getData(),pos:!i,index:i})}cellUpdated(e){this.action("cellEdit",e,{oldValue:e.oldValue,newValue:e.value})}clear(){this.history=[],this.index=-1}action(e,i,r){this.history=this.history.slice(0,this.index+1),this.history.push({type:e,component:i,data:r}),this.index++}getHistoryUndoSize(){return this.index+1}getHistoryRedoSize(){return this.history.length-(this.index+1)}clearComponentHistory(e){var i=this.history.findIndex(function(r){return r.component===e});i>-1&&(this.history.splice(i,1),i<=this.index&&this.index--,this.clearComponentHistory(e))}undo(){if(this.index>-1){let e=this.history[this.index];return vP.undoers[e.type].call(this,e),this.index--,this.dispatchExternal("historyUndo",e.type,e.component.getComponent(),e.data),!0}else return console.warn(this.options("history")?"History Undo Error - No more history to undo":"History module not enabled"),!1}redo(){if(this.history.length-1>this.index){this.index++;let e=this.history[this.index];return vP.redoers[e.type].call(this,e),this.dispatchExternal("historyRedo",e.type,e.component.getComponent(),e.data),!0}else return console.warn(this.options("history")?"History Redo Error - No more history to redo":"History module not enabled"),!1}_rebindRow(e,i){this.history.forEach(function(r){if(r.component instanceof Ca)r.component===e&&(r.component=i);else if(r.component instanceof $S&&r.component.row===e){var n=r.component.column.getField();n&&(r.component=i.getCell(n))}})}}class eNe extends si{static moduleName="htmlTableImport";constructor(e){super(e),this.fieldIndex=[],this.hasIndex=!1}initialize(){this.tableElementCheck()}tableElementCheck(){this.table.originalElement&&this.table.originalElement.tagName==="TABLE"&&(this.table.originalElement.childNodes.length?this.parseTable():console.warn("Unable to parse data from empty table tag, Tabulator should be initialized on a div tag unless importing data from a table element."))}parseTable(){var e=this.table.originalElement,i=this.table.options,r=e.getElementsByTagName("th"),n=e.getElementsByTagName("tbody")[0],a=[];this.hasIndex=!1,this.dispatchExternal("htmlImporting"),n=n?n.getElementsByTagName("tr"):[],this._extractOptions(e,i),r.length?this._extractHeaders(r,n):this._generateBlankHeaders(r,n);for(var s=0;s<n.length;s++){var o=n[s],l=o.getElementsByTagName("td"),u={};this.hasIndex||(u[i.index]=s);for(var c=0;c<l.length;c++){var d=l[c];typeof this.fieldIndex[c]<"u"&&(u[this.fieldIndex[c]]=d.innerHTML)}a.push(u)}i.data=a,this.dispatchExternal("htmlImported")}_extractOptions(e,i,r){var n=e.attributes,a=Object.keys(r||i),s={};a.forEach(c=>{s[c.toLowerCase()]=c});for(var o in n){var l=n[o],u;l&&typeof l=="object"&&l.name&&l.name.indexOf("tabulator-")===0&&(u=l.name.replace("tabulator-",""),typeof s[u]<"u"&&(i[s[u]]=this._attribValue(l.value)))}}_attribValue(e){return e==="true"?!0:e==="false"?!1:e}_findCol(e){var i=this.table.options.columns.find(r=>r.title===e);return i||!1}_extractHeaders(e,i){for(var r=0;r<e.length;r++){var n=e[r],a=!1,s=this._findCol(n.textContent),o;s?a=!0:s={title:n.textContent.trim()},s.field||(s.field=n.textContent.trim().toLowerCase().replaceAll(" ","_")),o=n.getAttribute("width"),o&&!s.width&&(s.width=o),this._extractOptions(n,s,this.table.columnManager.optionsList.registeredDefaults),this.fieldIndex[r]=s.field,s.field==this.table.options.index&&(this.hasIndex=!0),a||this.table.options.columns.push(s)}}_generateBlankHeaders(e,i){for(var r=0;r<e.length;r++){var n=e[r],a={title:"",field:"col"+r};this.fieldIndex[r]=a.field;var s=n.getAttribute("width");s&&(a.width=s),this.table.options.columns.push(a)}}}function tNe(t){var e=[],i=0,r=0,n=!1;for(let a=0;a<t.length;a++){let s=t[a],o=t[a+1];if(e[i]||(e[i]=[]),e[i][r]||(e[i][r]=""),s=='"'&&n&&o=='"'){e[i][r]+=s,a++;continue}if(s=='"'){n=!n;continue}if(s==","&&!n){r++;continue}if(s=="\r"&&o==`
`&&!n){r=0,i++,a++;continue}if((s=="\r"||s==`
`)&&!n){r=0,i++;continue}e[i][r]+=s}return e}function iNe(t){try{return JSON.parse(t)}catch(e){return console.warn("JSON Import Error - File contents is invalid JSON",e),Promise.reject()}}function rNe(t){return t}function nNe(t){var e=this.dependencyRegistry.lookup("XLSX"),i=e.read(t),r=i.Sheets[i.SheetNames[0]];return e.utils.sheet_to_json(r,{header:1})}var aNe={csv:tNe,json:iNe,array:rNe,xlsx:nNe};class P$ extends si{static moduleName="import";static importers=aNe;constructor(e){super(e),this.registerTableOption("importFormat"),this.registerTableOption("importReader","text"),this.registerTableOption("importHeaderTransform"),this.registerTableOption("importValueTransform"),this.registerTableOption("importDataValidator"),this.registerTableOption("importFileValidator")}initialize(){this.registerTableFunction("import",this.importFromFile.bind(this)),this.table.options.importFormat&&(this.subscribe("data-loading",this.loadDataCheck.bind(this),10),this.subscribe("data-load",this.loadData.bind(this),10))}loadDataCheck(e){return this.table.options.importFormat&&(typeof e=="string"||Array.isArray(e)&&e.length&&Array.isArray(e))}loadData(e,i,r,n,a){return this.importData(this.lookupImporter(),e).then(this.structureData.bind(this)).catch(s=>(console.error("Import Error:",s||"Unable to import data"),Promise.reject(s)))}lookupImporter(e){var i;return e||(e=this.table.options.importFormat),typeof e=="string"?i=P$.importers[e]:i=e,i||console.error("Import Error - Importer not found:",e),i}importFromFile(e,i,r){var n=this.lookupImporter(e);if(n)return this.pickFile(i,r).then(this.importData.bind(this,n)).then(this.structureData.bind(this)).then(this.mutateData.bind(this)).then(this.validateData.bind(this)).then(this.setData.bind(this)).catch(a=>(this.dispatch("import-error",a),this.dispatchExternal("importError",a),console.error("Import Error:",a||"Unable to import file"),this.table.dataLoader.alertError(),setTimeout(()=>{this.table.dataLoader.clearAlert()},3e3),Promise.reject(a)))}pickFile(e,i){return new Promise((r,n)=>{var a=document.createElement("input");a.type="file",a.accept=e,a.addEventListener("change",s=>{var o=a.files[0],l=new FileReader,u=this.validateFile(o);if(u===!0){switch(this.dispatch("import-importing",a.files),this.dispatchExternal("importImporting",a.files),i||this.table.options.importReader){case"buffer":l.readAsArrayBuffer(o);break;case"binary":l.readAsBinaryString(o);break;case"url":l.readAsDataURL(o);break;default:l.readAsText(o)}l.onload=c=>{r(l.result)},l.onerror=c=>{console.warn("File Load Error - Unable to read file"),n(c)}}else n(u)}),this.dispatch("import-choose"),this.dispatchExternal("importChoose"),a.click()})}importData(e,i){var r;return this.table.dataLoader.alertLoader(),new Promise((n,a)=>{setTimeout(()=>{r=e.call(this.table,i),r instanceof Promise||r?n(r):a()},10)})}structureData(e){var i=[];return Array.isArray(e)&&e.length&&Array.isArray(e[0])?(this.table.options.autoColumns?i=this.structureArrayToObject(e):i=this.structureArrayToColumns(e),i):e}mutateData(e){var i=[];return Array.isArray(e)?e.forEach(r=>{i.push(this.table.modules.mutator.transformRow(r,"import"))}):i=e,i}transformHeader(e){var i=[];if(this.table.options.importHeaderTransform)e.forEach(r=>{i.push(this.table.options.importHeaderTransform.call(this.table,r,e))});else return e;return i}transformData(e){var i=[];if(this.table.options.importValueTransform)e.forEach(r=>{i.push(this.table.options.importValueTransform.call(this.table,r,e))});else return e;return i}structureArrayToObject(e){var i=this.transformHeader(e.shift()),r=e.map(n=>{var a={};return n=this.transformData(n),i.forEach((s,o)=>{a[s]=n[o]}),a});return r}structureArrayToColumns(e){var i=[],r=this.transformHeader(e[0]),n=this.table.getColumns();return n[0]&&r[0]&&n[0].getDefinition().title===r[0]&&e.shift(),e.forEach(a=>{var s={};a=this.transformData(a),a.forEach((o,l)=>{var u=n[l];u&&(s[u.getField()]=o)}),i.push(s)}),i}validateFile(e){return this.table.options.importFileValidator?this.table.options.importFileValidator.call(this.table,e):!0}validateData(e){var i;return this.table.options.importDataValidator?(i=this.table.options.importDataValidator.call(this.table,e),i===!0?e:Promise.reject(i)):e}setData(e){return this.dispatch("import-imported",e),this.dispatchExternal("importImported",e),this.table.dataLoader.clearAlert(),this.table.setData(e)}}class sNe extends si{static moduleName="interaction";constructor(e){super(e),this.eventMap={rowClick:"row-click",rowDblClick:"row-dblclick",rowContext:"row-contextmenu",rowMouseEnter:"row-mouseenter",rowMouseLeave:"row-mouseleave",rowMouseOver:"row-mouseover",rowMouseOut:"row-mouseout",rowMouseMove:"row-mousemove",rowMouseDown:"row-mousedown",rowMouseUp:"row-mouseup",rowTap:"row",rowDblTap:"row",rowTapHold:"row",cellClick:"cell-click",cellDblClick:"cell-dblclick",cellContext:"cell-contextmenu",cellMouseEnter:"cell-mouseenter",cellMouseLeave:"cell-mouseleave",cellMouseOver:"cell-mouseover",cellMouseOut:"cell-mouseout",cellMouseMove:"cell-mousemove",cellMouseDown:"cell-mousedown",cellMouseUp:"cell-mouseup",cellTap:"cell",cellDblTap:"cell",cellTapHold:"cell",headerClick:"column-click",headerDblClick:"column-dblclick",headerContext:"column-contextmenu",headerMouseEnter:"column-mouseenter",headerMouseLeave:"column-mouseleave",headerMouseOver:"column-mouseover",headerMouseOut:"column-mouseout",headerMouseMove:"column-mousemove",headerMouseDown:"column-mousedown",headerMouseUp:"column-mouseup",headerTap:"column",headerDblTap:"column",headerTapHold:"column",groupClick:"group-click",groupDblClick:"group-dblclick",groupContext:"group-contextmenu",groupMouseEnter:"group-mouseenter",groupMouseLeave:"group-mouseleave",groupMouseOver:"group-mouseover",groupMouseOut:"group-mouseout",groupMouseMove:"group-mousemove",groupMouseDown:"group-mousedown",groupMouseUp:"group-mouseup",groupTap:"group",groupDblTap:"group",groupTapHold:"group"},this.subscribers={},this.touchSubscribers={},this.columnSubscribers={},this.touchWatchers={row:{tap:null,tapDbl:null,tapHold:null},cell:{tap:null,tapDbl:null,tapHold:null},column:{tap:null,tapDbl:null,tapHold:null},group:{tap:null,tapDbl:null,tapHold:null}},this.registerColumnOption("headerClick"),this.registerColumnOption("headerDblClick"),this.registerColumnOption("headerContext"),this.registerColumnOption("headerMouseEnter"),this.registerColumnOption("headerMouseLeave"),this.registerColumnOption("headerMouseOver"),this.registerColumnOption("headerMouseOut"),this.registerColumnOption("headerMouseMove"),this.registerColumnOption("headerMouseDown"),this.registerColumnOption("headerMouseUp"),this.registerColumnOption("headerTap"),this.registerColumnOption("headerDblTap"),this.registerColumnOption("headerTapHold"),this.registerColumnOption("cellClick"),this.registerColumnOption("cellDblClick"),this.registerColumnOption("cellContext"),this.registerColumnOption("cellMouseEnter"),this.registerColumnOption("cellMouseLeave"),this.registerColumnOption("cellMouseOver"),this.registerColumnOption("cellMouseOut"),this.registerColumnOption("cellMouseMove"),this.registerColumnOption("cellMouseDown"),this.registerColumnOption("cellMouseUp"),this.registerColumnOption("cellTap"),this.registerColumnOption("cellDblTap"),this.registerColumnOption("cellTapHold")}initialize(){this.initializeExternalEvents(),this.subscribe("column-init",this.initializeColumn.bind(this)),this.subscribe("cell-dblclick",this.cellContentsSelectionFixer.bind(this)),this.subscribe("scroll-horizontal",this.clearTouchWatchers.bind(this)),this.subscribe("scroll-vertical",this.clearTouchWatchers.bind(this))}clearTouchWatchers(){var e=Object.values(this.touchWatchers);e.forEach(i=>{for(let r in i)i[r]=null})}cellContentsSelectionFixer(e,i){var r;if(!(this.table.modExists("edit")&&this.table.modules.edit.currentCell===i)){e.preventDefault();try{document.selection?(r=document.body.createTextRange(),r.moveToElementText(i.getElement()),r.select()):window.getSelection&&(r=document.createRange(),r.selectNode(i.getElement()),window.getSelection().removeAllRanges(),window.getSelection().addRange(r))}catch{}}}initializeExternalEvents(){for(let e in this.eventMap)this.subscriptionChangeExternal(e,this.subscriptionChanged.bind(this,e))}subscriptionChanged(e,i){i?this.subscribers[e]||(this.eventMap[e].includes("-")?(this.subscribers[e]=this.handle.bind(this,e),this.subscribe(this.eventMap[e],this.subscribers[e])):this.subscribeTouchEvents(e)):this.eventMap[e].includes("-")?this.subscribers[e]&&!this.columnSubscribers[e]&&!this.subscribedExternal(e)&&(this.unsubscribe(this.eventMap[e],this.subscribers[e]),delete this.subscribers[e]):this.unsubscribeTouchEvents(e)}subscribeTouchEvents(e){var i=this.eventMap[e];this.touchSubscribers[i+"-touchstart"]||(this.touchSubscribers[i+"-touchstart"]=this.handleTouch.bind(this,i,"start"),this.touchSubscribers[i+"-touchend"]=this.handleTouch.bind(this,i,"end"),this.subscribe(i+"-touchstart",this.touchSubscribers[i+"-touchstart"]),this.subscribe(i+"-touchend",this.touchSubscribers[i+"-touchend"])),this.subscribers[e]=!0}unsubscribeTouchEvents(e){var i=!0,r=this.eventMap[e];if(this.subscribers[e]&&!this.subscribedExternal(e)){delete this.subscribers[e];for(let n in this.eventMap)this.eventMap[n]===r&&this.subscribers[n]&&(i=!1);i&&(this.unsubscribe(r+"-touchstart",this.touchSubscribers[r+"-touchstart"]),this.unsubscribe(r+"-touchend",this.touchSubscribers[r+"-touchend"]),delete this.touchSubscribers[r+"-touchstart"],delete this.touchSubscribers[r+"-touchend"])}}initializeColumn(e){var i=e.definition;for(let r in this.eventMap)i[r]&&(this.subscriptionChanged(r,!0),this.columnSubscribers[r]||(this.columnSubscribers[r]=[]),this.columnSubscribers[r].push(e))}handle(e,i,r){this.dispatchEvent(e,i,r)}handleTouch(e,i,r,n){var a=this.touchWatchers[e];switch(e==="column"&&(e="header"),i){case"start":a.tap=!0,clearTimeout(a.tapHold),a.tapHold=setTimeout(()=>{clearTimeout(a.tapHold),a.tapHold=null,a.tap=null,clearTimeout(a.tapDbl),a.tapDbl=null,this.dispatchEvent(e+"TapHold",r,n)},1e3);break;case"end":a.tap&&(a.tap=null,this.dispatchEvent(e+"Tap",r,n)),a.tapDbl?(clearTimeout(a.tapDbl),a.tapDbl=null,this.dispatchEvent(e+"DblTap",r,n)):a.tapDbl=setTimeout(()=>{clearTimeout(a.tapDbl),a.tapDbl=null},300),clearTimeout(a.tapHold),a.tapHold=null;break}}dispatchEvent(e,i,r){var n=r.getComponent(),a;this.columnSubscribers[e]&&(r instanceof $S?a=r.column.definition[e]:r instanceof Wu&&(a=r.definition[e]),a&&a(i,n)),this.dispatchExternal(e,i,n)}}var oNe={navPrev:"shift + 9",navNext:9,navUp:38,navDown:40,navLeft:37,navRight:39,scrollPageUp:33,scrollPageDown:34,scrollToStart:36,scrollToEnd:35},lNe={keyBlock:function(t){t.stopPropagation(),t.preventDefault()},scrollPageUp:function(t){var e=this.table.rowManager,i=e.scrollTop-e.element.clientHeight;t.preventDefault(),e.displayRowsCount&&(i>=0?e.element.scrollTop=i:e.scrollToRow(e.getDisplayRows()[0])),this.table.element.focus()},scrollPageDown:function(t){var e=this.table.rowManager,i=e.scrollTop+e.element.clientHeight,r=e.element.scrollHeight;t.preventDefault(),e.displayRowsCount&&(i<=r?e.element.scrollTop=i:e.scrollToRow(e.getDisplayRows()[e.displayRowsCount-1])),this.table.element.focus()},scrollToStart:function(t){var e=this.table.rowManager;t.preventDefault(),e.displayRowsCount&&e.scrollToRow(e.getDisplayRows()[0]),this.table.element.focus()},scrollToEnd:function(t){var e=this.table.rowManager;t.preventDefault(),e.displayRowsCount&&e.scrollToRow(e.getDisplayRows()[e.displayRowsCount-1]),this.table.element.focus()},navPrev:function(t){this.dispatch("keybinding-nav-prev",t)},navNext:function(t){this.dispatch("keybinding-nav-next",t)},navLeft:function(t){this.dispatch("keybinding-nav-left",t)},navRight:function(t){this.dispatch("keybinding-nav-right",t)},navUp:function(t){this.dispatch("keybinding-nav-up",t)},navDown:function(t){this.dispatch("keybinding-nav-down",t)}};class By extends si{static moduleName="keybindings";static bindings=oNe;static actions=lNe;constructor(e){super(e),this.watchKeys=null,this.pressedKeys=null,this.keyupBinding=!1,this.keydownBinding=!1,this.registerTableOption("keybindings",{}),this.registerTableOption("tabEndNewRow",!1)}initialize(){var e=this.table.options.keybindings,i={};this.watchKeys={},this.pressedKeys=[],e!==!1&&(Object.assign(i,By.bindings),Object.assign(i,e),this.mapBindings(i),this.bindEvents()),this.subscribe("table-destroy",this.clearBindings.bind(this))}mapBindings(e){for(let i in e)By.actions[i]?e[i]&&(typeof e[i]!="object"&&(e[i]=[e[i]]),e[i].forEach(r=>{var n=Array.isArray(r)?r:[r];n.forEach(a=>{this.mapBinding(i,a)})})):console.warn("Key Binding Error - no such action:",i)}mapBinding(e,i){var r={action:By.actions[e],keys:[],ctrl:!1,shift:!1,meta:!1},n=i.toString().toLowerCase().split(" ").join("").split("+");n.forEach(a=>{switch(a){case"ctrl":r.ctrl=!0;break;case"shift":r.shift=!0;break;case"meta":r.meta=!0;break;default:a=isNaN(a)?a.toUpperCase().charCodeAt(0):parseInt(a),r.keys.push(a),this.watchKeys[a]||(this.watchKeys[a]=[]),this.watchKeys[a].push(r)}})}bindEvents(){var e=this;this.keyupBinding=function(i){var r=i.keyCode,n=e.watchKeys[r];n&&(e.pressedKeys.push(r),n.forEach(function(a){e.checkBinding(i,a)}))},this.keydownBinding=function(i){var r=i.keyCode,n=e.watchKeys[r];if(n){var a=e.pressedKeys.indexOf(r);a>-1&&e.pressedKeys.splice(a,1)}},this.table.element.addEventListener("keydown",this.keyupBinding),this.table.element.addEventListener("keyup",this.keydownBinding)}clearBindings(){this.keyupBinding&&this.table.element.removeEventListener("keydown",this.keyupBinding),this.keydownBinding&&this.table.element.removeEventListener("keyup",this.keydownBinding)}checkBinding(e,i){var r=!0;return e.ctrlKey==i.ctrl&&e.shiftKey==i.shift&&e.metaKey==i.meta?(i.keys.forEach(n=>{var a=this.pressedKeys.indexOf(n);a==-1&&(r=!1)}),r&&i.action.call(this,e),!0):!1}}class uNe extends si{static moduleName="menu";constructor(e){super(e),this.menuContainer=null,this.nestedMenuBlock=!1,this.currentComponent=null,this.rootPopup=null,this.columnSubscribers={},this.registerTableOption("rowContextMenu",!1),this.registerTableOption("rowClickMenu",!1),this.registerTableOption("rowDblClickMenu",!1),this.registerTableOption("groupContextMenu",!1),this.registerTableOption("groupClickMenu",!1),this.registerTableOption("groupDblClickMenu",!1),this.registerColumnOption("headerContextMenu"),this.registerColumnOption("headerClickMenu"),this.registerColumnOption("headerDblClickMenu"),this.registerColumnOption("headerMenu"),this.registerColumnOption("headerMenuIcon"),this.registerColumnOption("contextMenu"),this.registerColumnOption("clickMenu"),this.registerColumnOption("dblClickMenu")}initialize(){this.deprecatedOptionsCheck(),this.initializeRowWatchers(),this.initializeGroupWatchers(),this.subscribe("column-init",this.initializeColumn.bind(this))}deprecatedOptionsCheck(){}initializeRowWatchers(){this.table.options.rowContextMenu&&(this.subscribe("row-contextmenu",this.loadMenuEvent.bind(this,this.table.options.rowContextMenu)),this.table.on("rowTapHold",this.loadMenuEvent.bind(this,this.table.options.rowContextMenu))),this.table.options.rowClickMenu&&this.subscribe("row-click",this.loadMenuEvent.bind(this,this.table.options.rowClickMenu)),this.table.options.rowDblClickMenu&&this.subscribe("row-dblclick",this.loadMenuEvent.bind(this,this.table.options.rowDblClickMenu))}initializeGroupWatchers(){this.table.options.groupContextMenu&&(this.subscribe("group-contextmenu",this.loadMenuEvent.bind(this,this.table.options.groupContextMenu)),this.table.on("groupTapHold",this.loadMenuEvent.bind(this,this.table.options.groupContextMenu))),this.table.options.groupClickMenu&&this.subscribe("group-click",this.loadMenuEvent.bind(this,this.table.options.groupClickMenu)),this.table.options.groupDblClickMenu&&this.subscribe("group-dblclick",this.loadMenuEvent.bind(this,this.table.options.groupDblClickMenu))}initializeColumn(e){var i=e.definition;i.headerContextMenu&&!this.columnSubscribers.headerContextMenu&&(this.columnSubscribers.headerContextMenu=this.loadMenuTableColumnEvent.bind(this,"headerContextMenu"),this.subscribe("column-contextmenu",this.columnSubscribers.headerContextMenu),this.table.on("headerTapHold",this.loadMenuTableColumnEvent.bind(this,"headerContextMenu"))),i.headerClickMenu&&!this.columnSubscribers.headerClickMenu&&(this.columnSubscribers.headerClickMenu=this.loadMenuTableColumnEvent.bind(this,"headerClickMenu"),this.subscribe("column-click",this.columnSubscribers.headerClickMenu)),i.headerDblClickMenu&&!this.columnSubscribers.headerDblClickMenu&&(this.columnSubscribers.headerDblClickMenu=this.loadMenuTableColumnEvent.bind(this,"headerDblClickMenu"),this.subscribe("column-dblclick",this.columnSubscribers.headerDblClickMenu)),i.headerMenu&&this.initializeColumnHeaderMenu(e),i.contextMenu&&!this.columnSubscribers.contextMenu&&(this.columnSubscribers.contextMenu=this.loadMenuTableCellEvent.bind(this,"contextMenu"),this.subscribe("cell-contextmenu",this.columnSubscribers.contextMenu),this.table.on("cellTapHold",this.loadMenuTableCellEvent.bind(this,"contextMenu"))),i.clickMenu&&!this.columnSubscribers.clickMenu&&(this.columnSubscribers.clickMenu=this.loadMenuTableCellEvent.bind(this,"clickMenu"),this.subscribe("cell-click",this.columnSubscribers.clickMenu)),i.dblClickMenu&&!this.columnSubscribers.dblClickMenu&&(this.columnSubscribers.dblClickMenu=this.loadMenuTableCellEvent.bind(this,"dblClickMenu"),this.subscribe("cell-dblclick",this.columnSubscribers.dblClickMenu))}initializeColumnHeaderMenu(e){var i=e.definition.headerMenuIcon,r;r=document.createElement("span"),r.classList.add("tabulator-header-popup-button"),i?(typeof i=="function"&&(i=i(e.getComponent())),i instanceof HTMLElement?r.appendChild(i):r.innerHTML=i):r.innerHTML="&vellip;",r.addEventListener("click",n=>{n.stopPropagation(),n.preventDefault(),this.loadMenuEvent(e.definition.headerMenu,n,e)}),e.titleElement.insertBefore(r,e.titleElement.firstChild)}loadMenuTableCellEvent(e,i,r){r._cell&&(r=r._cell),r.column.definition[e]&&this.loadMenuEvent(r.column.definition[e],i,r)}loadMenuTableColumnEvent(e,i,r){r._column&&(r=r._column),r.definition[e]&&this.loadMenuEvent(r.definition[e],i,r)}loadMenuEvent(e,i,r){r._group?r=r._group:r._row&&(r=r._row),e=typeof e=="function"?e.call(this.table,i,r.getComponent()):e,this.loadMenu(i,r,e)}loadMenu(e,i,r,n,a){var s=!(e instanceof MouseEvent),o=document.createElement("div"),l;if(o.classList.add("tabulator-menu"),s||e.preventDefault(),!(!r||!r.length)){if(n)l=a.child(o);else{if(this.nestedMenuBlock){if(this.rootPopup)return}else this.nestedMenuBlock=setTimeout(()=>{this.nestedMenuBlock=!1},100);this.rootPopup&&this.rootPopup.hide(),this.rootPopup=l=this.popup(o)}r.forEach(u=>{var c=document.createElement("div"),d=u.label,p=u.disabled;u.separator?c.classList.add("tabulator-menu-separator"):(c.classList.add("tabulator-menu-item"),typeof d=="function"&&(d=d.call(this.table,i.getComponent())),d instanceof Node?c.appendChild(d):c.innerHTML=d,typeof p=="function"&&(p=p.call(this.table,i.getComponent())),p?(c.classList.add("tabulator-menu-item-disabled"),c.addEventListener("click",f=>{f.stopPropagation()})):u.menu&&u.menu.length?c.addEventListener("click",f=>{f.stopPropagation(),this.loadMenu(f,i,u.menu,c,l)}):u.action&&c.addEventListener("click",f=>{u.action(f,i.getComponent())}),u.menu&&u.menu.length&&c.classList.add("tabulator-menu-item-submenu")),o.appendChild(c)}),o.addEventListener("click",u=>{this.rootPopup&&this.rootPopup.hide()}),l.show(n||e),l===this.rootPopup&&(this.rootPopup.hideOnBlur(()=>{this.rootPopup=null,this.currentComponent&&(this.dispatch("menu-closed",r,l),this.dispatchExternal("menuClosed",this.currentComponent.getComponent()),this.currentComponent=null)}),this.currentComponent=i,this.dispatch("menu-opened",r,l),this.dispatchExternal("menuOpened",i.getComponent()))}}}class cNe extends si{static moduleName="moveColumn";constructor(e){super(e),this.placeholderElement=this.createPlaceholderElement(),this.hoverElement=!1,this.checkTimeout=!1,this.checkPeriod=250,this.moving=!1,this.toCol=!1,this.toColAfter=!1,this.startX=0,this.autoScrollMargin=40,this.autoScrollStep=5,this.autoScrollTimeout=!1,this.touchMove=!1,this.moveHover=this.moveHover.bind(this),this.endMove=this.endMove.bind(this),this.registerTableOption("movableColumns",!1)}createPlaceholderElement(){var e=document.createElement("div");return e.classList.add("tabulator-col"),e.classList.add("tabulator-col-placeholder"),e}initialize(){this.table.options.movableColumns&&(this.subscribe("column-init",this.initializeColumn.bind(this)),this.subscribe("alert-show",this.abortMove.bind(this)))}abortMove(){clearTimeout(this.checkTimeout)}initializeColumn(e){var i=this,r={},n;!e.modules.frozen&&!e.isGroup&&!e.isRowHeader&&(n=e.getElement(),r.mousemove=(function(a){e.parent===i.moving.parent&&((i.touchMove?a.touches[0].pageX:a.pageX)-gr.elOffset(n).left+i.table.columnManager.contentsElement.scrollLeft>e.getWidth()/2?(i.toCol!==e||!i.toColAfter)&&(n.parentNode.insertBefore(i.placeholderElement,n.nextSibling),i.moveColumn(e,!0)):(i.toCol!==e||i.toColAfter)&&(n.parentNode.insertBefore(i.placeholderElement,n),i.moveColumn(e,!1)))}).bind(i),n.addEventListener("mousedown",function(a){i.touchMove=!1,a.which===1&&(i.checkTimeout=setTimeout(function(){i.startMove(a,e)},i.checkPeriod))}),n.addEventListener("mouseup",function(a){a.which===1&&i.checkTimeout&&clearTimeout(i.checkTimeout)}),i.bindTouchEvents(e)),e.modules.moveColumn=r}bindTouchEvents(e){var i=e.getElement(),r=!1,n,a,s,o,l,u;i.addEventListener("touchstart",c=>{this.checkTimeout=setTimeout(()=>{this.touchMove=!0,n=e.nextColumn(),s=n?n.getWidth()/2:0,a=e.prevColumn(),o=a?a.getWidth()/2:0,l=0,u=0,r=!1,this.startMove(c,e)},this.checkPeriod)},{passive:!0}),i.addEventListener("touchmove",c=>{var d,p;this.moving&&(this.moveHover(c),r||(r=c.touches[0].pageX),d=c.touches[0].pageX-r,d>0?n&&d-l>s&&(p=n,p!==e&&(r=c.touches[0].pageX,p.getElement().parentNode.insertBefore(this.placeholderElement,p.getElement().nextSibling),this.moveColumn(p,!0))):a&&-d-u>o&&(p=a,p!==e&&(r=c.touches[0].pageX,p.getElement().parentNode.insertBefore(this.placeholderElement,p.getElement()),this.moveColumn(p,!1))),p&&(n=p.nextColumn(),l=s,s=n?n.getWidth()/2:0,a=p.prevColumn(),u=o,o=a?a.getWidth()/2:0))},{passive:!0}),i.addEventListener("touchend",c=>{this.checkTimeout&&clearTimeout(this.checkTimeout),this.moving&&this.endMove(c)})}startMove(e,i){var r=i.getElement(),n=this.table.columnManager.getContentsElement(),a=this.table.columnManager.getHeadersElement();this.table.modules.selectRange&&this.table.modules.selectRange.columnSelection&&this.table.modules.selectRange.mousedown&&this.table.modules.selectRange.selecting==="column"||(this.moving=i,this.startX=(this.touchMove?e.touches[0].pageX:e.pageX)-gr.elOffset(r).left,this.table.element.classList.add("tabulator-block-select"),this.placeholderElement.style.width=i.getWidth()+"px",this.placeholderElement.style.height=i.getHeight()+"px",r.parentNode.insertBefore(this.placeholderElement,r),r.parentNode.removeChild(r),this.hoverElement=r.cloneNode(!0),this.hoverElement.classList.add("tabulator-moving"),n.appendChild(this.hoverElement),this.hoverElement.style.left="0",this.hoverElement.style.bottom=n.clientHeight-a.offsetHeight+"px",this.touchMove||(this._bindMouseMove(),document.body.addEventListener("mousemove",this.moveHover),document.body.addEventListener("mouseup",this.endMove)),this.moveHover(e),this.dispatch("column-moving",e,this.moving))}_bindMouseMove(){this.table.columnManager.columnsByIndex.forEach(function(e){e.modules.moveColumn.mousemove&&e.getElement().addEventListener("mousemove",e.modules.moveColumn.mousemove)})}_unbindMouseMove(){this.table.columnManager.columnsByIndex.forEach(function(e){e.modules.moveColumn.mousemove&&e.getElement().removeEventListener("mousemove",e.modules.moveColumn.mousemove)})}moveColumn(e,i){var r=this.moving.getCells();this.toCol=e,this.toColAfter=i,i?e.getCells().forEach(function(n,a){var s=n.getElement(!0);s.parentNode&&r[a]&&s.parentNode.insertBefore(r[a].getElement(),s.nextSibling)}):e.getCells().forEach(function(n,a){var s=n.getElement(!0);s.parentNode&&r[a]&&s.parentNode.insertBefore(r[a].getElement(),s)})}endMove(e){(e.which===1||this.touchMove)&&(this._unbindMouseMove(),this.placeholderElement.parentNode.insertBefore(this.moving.getElement(),this.placeholderElement.nextSibling),this.placeholderElement.parentNode.removeChild(this.placeholderElement),this.hoverElement.parentNode.removeChild(this.hoverElement),this.table.element.classList.remove("tabulator-block-select"),this.toCol&&this.table.columnManager.moveColumnActual(this.moving,this.toCol,this.toColAfter),this.moving=!1,this.toCol=!1,this.toColAfter=!1,this.touchMove||(document.body.removeEventListener("mousemove",this.moveHover),document.body.removeEventListener("mouseup",this.endMove)))}moveHover(e){var i=this.table.columnManager.getContentsElement(),r=i.scrollLeft,n=(this.touchMove?e.touches[0].pageX:e.pageX)-gr.elOffset(i).left+r,a;this.hoverElement.style.left=n-this.startX+"px",n-r<this.autoScrollMargin&&(this.autoScrollTimeout||(this.autoScrollTimeout=setTimeout(()=>{a=Math.max(0,r-5),this.table.rowManager.getElement().scrollLeft=a,this.autoScrollTimeout=!1},1))),r+i.clientWidth-n<this.autoScrollMargin&&(this.autoScrollTimeout||(this.autoScrollTimeout=setTimeout(()=>{a=Math.min(i.clientWidth,r+5),this.table.rowManager.getElement().scrollLeft=a,this.autoScrollTimeout=!1},1)))}}var dNe={delete:function(t,e,i){t.delete()}},pNe={insert:function(t,e,i){return this.table.addRow(t.getData(),void 0,e),!0},add:function(t,e,i){return this.table.addRow(t.getData()),!0},update:function(t,e,i){return e?(e.update(t.getData()),!0):!1},replace:function(t,e,i){return e?(this.table.addRow(t.getData(),void 0,e),e.delete(),!0):!1}};class yP extends si{static moduleName="moveRow";static senders=dNe;static receivers=pNe;constructor(e){super(e),this.placeholderElement=this.createPlaceholderElement(),this.hoverElement=!1,this.checkTimeout=!1,this.checkPeriod=150,this.moving=!1,this.toRow=!1,this.toRowAfter=!1,this.hasHandle=!1,this.startY=0,this.startX=0,this.moveHover=this.moveHover.bind(this),this.endMove=this.endMove.bind(this),this.tableRowDropEvent=!1,this.touchMove=!1,this.connection=!1,this.connectionSelectorsTables=!1,this.connectionSelectorsElements=!1,this.connectionElements=[],this.connections=[],this.connectedTable=!1,this.connectedRow=!1,this.registerTableOption("movableRows",!1),this.registerTableOption("movableRowsConnectedTables",!1),this.registerTableOption("movableRowsConnectedElements",!1),this.registerTableOption("movableRowsSender",!1),this.registerTableOption("movableRowsReceiver","insert"),this.registerColumnOption("rowHandle")}createPlaceholderElement(){var e=document.createElement("div");return e.classList.add("tabulator-row"),e.classList.add("tabulator-row-placeholder"),e}initialize(){this.table.options.movableRows&&(this.connectionSelectorsTables=this.table.options.movableRowsConnectedTables,this.connectionSelectorsElements=this.table.options.movableRowsConnectedElements,this.connection=this.connectionSelectorsTables||this.connectionSelectorsElements,this.subscribe("cell-init",this.initializeCell.bind(this)),this.subscribe("column-init",this.initializeColumn.bind(this)),this.subscribe("row-init",this.initializeRow.bind(this)))}initializeGroupHeader(e){var i=this,r={};r.mouseup=(function(n){i.tableRowDrop(n,e)}).bind(i),r.mousemove=(function(n){var a;n.pageY-gr.elOffset(e.element).top+i.table.rowManager.element.scrollTop>e.getHeight()/2?(i.toRow!==e||!i.toRowAfter)&&(a=e.getElement(),a.parentNode.insertBefore(i.placeholderElement,a.nextSibling),i.moveRow(e,!0)):(i.toRow!==e||i.toRowAfter)&&(a=e.getElement(),a.previousSibling&&(a.parentNode.insertBefore(i.placeholderElement,a),i.moveRow(e,!1)))}).bind(i),e.modules.moveRow=r}initializeRow(e){var i=this,r={},n;r.mouseup=(function(a){i.tableRowDrop(a,e)}).bind(i),r.mousemove=(function(a){var s=e.getElement();a.pageY-gr.elOffset(s).top+i.table.rowManager.element.scrollTop>e.getHeight()/2?(i.toRow!==e||!i.toRowAfter)&&(s.parentNode.insertBefore(i.placeholderElement,s.nextSibling),i.moveRow(e,!0)):(i.toRow!==e||i.toRowAfter)&&(s.parentNode.insertBefore(i.placeholderElement,s),i.moveRow(e,!1))}).bind(i),this.hasHandle||(n=e.getElement(),n.addEventListener("mousedown",function(a){a.which===1&&(i.checkTimeout=setTimeout(function(){i.startMove(a,e)},i.checkPeriod))}),n.addEventListener("mouseup",function(a){a.which===1&&i.checkTimeout&&clearTimeout(i.checkTimeout)}),this.bindTouchEvents(e,e.getElement())),e.modules.moveRow=r}initializeColumn(e){e.definition.rowHandle&&this.table.options.movableRows!==!1&&(this.hasHandle=!0)}initializeCell(e){if(e.column.definition.rowHandle&&this.table.options.movableRows!==!1){var i=this,r=e.getElement(!0);r.addEventListener("mousedown",function(n){n.which===1&&(i.checkTimeout=setTimeout(function(){i.startMove(n,e.row)},i.checkPeriod))}),r.addEventListener("mouseup",function(n){n.which===1&&i.checkTimeout&&clearTimeout(i.checkTimeout)}),this.bindTouchEvents(e.row,r)}}bindTouchEvents(e,i){var r=!1,n,a,s,o,l,u;i.addEventListener("touchstart",c=>{this.checkTimeout=setTimeout(()=>{this.touchMove=!0,n=e.nextRow(),s=n?n.getHeight()/2:0,a=e.prevRow(),o=a?a.getHeight()/2:0,l=0,u=0,r=!1,this.startMove(c,e)},this.checkPeriod)},{passive:!0}),this.moving,this.toRow,this.toRowAfter,i.addEventListener("touchmove",c=>{var d,p;this.moving&&(c.preventDefault(),this.moveHover(c),r||(r=c.touches[0].pageY),d=c.touches[0].pageY-r,d>0?n&&d-l>s&&(p=n,p!==e&&(r=c.touches[0].pageY,p.getElement().parentNode.insertBefore(this.placeholderElement,p.getElement().nextSibling),this.moveRow(p,!0))):a&&-d-u>o&&(p=a,p!==e&&(r=c.touches[0].pageY,p.getElement().parentNode.insertBefore(this.placeholderElement,p.getElement()),this.moveRow(p,!1))),p&&(n=p.nextRow(),l=s,s=n?n.getHeight()/2:0,a=p.prevRow(),u=o,o=a?a.getHeight()/2:0))}),i.addEventListener("touchend",c=>{this.checkTimeout&&clearTimeout(this.checkTimeout),this.moving&&(this.endMove(c),this.touchMove=!1)})}_bindMouseMove(){this.table.rowManager.getDisplayRows().forEach(e=>{(e.type==="row"||e.type==="group")&&e.modules.moveRow&&e.modules.moveRow.mousemove&&e.getElement().addEventListener("mousemove",e.modules.moveRow.mousemove)})}_unbindMouseMove(){this.table.rowManager.getDisplayRows().forEach(e=>{(e.type==="row"||e.type==="group")&&e.modules.moveRow&&e.modules.moveRow.mousemove&&e.getElement().removeEventListener("mousemove",e.modules.moveRow.mousemove)})}startMove(e,i){var r=i.getElement();this.setStartPosition(e,i),this.moving=i,this.table.element.classList.add("tabulator-block-select"),this.placeholderElement.style.width=i.getWidth()+"px",this.placeholderElement.style.height=i.getHeight()+"px",this.connection?(this.table.element.classList.add("tabulator-movingrow-sending"),this.connectToTables(i)):(r.parentNode.insertBefore(this.placeholderElement,r),r.parentNode.removeChild(r)),this.hoverElement=r.cloneNode(!0),this.hoverElement.classList.add("tabulator-moving"),this.connection?(document.body.appendChild(this.hoverElement),this.hoverElement.style.left="0",this.hoverElement.style.top="0",this.hoverElement.style.width=this.table.element.clientWidth+"px",this.hoverElement.style.whiteSpace="nowrap",this.hoverElement.style.overflow="hidden",this.hoverElement.style.pointerEvents="none"):(this.table.rowManager.getTableElement().appendChild(this.hoverElement),this.hoverElement.style.left="0",this.hoverElement.style.top="0",this._bindMouseMove()),document.body.addEventListener("mousemove",this.moveHover),document.body.addEventListener("mouseup",this.endMove),this.dispatchExternal("rowMoving",i.getComponent()),this.moveHover(e)}setStartPosition(e,i){var r=this.touchMove?e.touches[0].pageX:e.pageX,n=this.touchMove?e.touches[0].pageY:e.pageY,a,s;a=i.getElement(),this.connection?(s=a.getBoundingClientRect(),this.startX=s.left-r+window.pageXOffset,this.startY=s.top-n+window.pageYOffset):this.startY=n-a.getBoundingClientRect().top}endMove(e){(!e||e.which===1||this.touchMove)&&(this._unbindMouseMove(),this.connection||(this.placeholderElement.parentNode.insertBefore(this.moving.getElement(),this.placeholderElement.nextSibling),this.placeholderElement.parentNode.removeChild(this.placeholderElement)),this.hoverElement.parentNode.removeChild(this.hoverElement),this.table.element.classList.remove("tabulator-block-select"),this.toRow?this.table.rowManager.moveRow(this.moving,this.toRow,this.toRowAfter):this.dispatchExternal("rowMoveCancelled",this.moving.getComponent()),this.moving=!1,this.toRow=!1,this.toRowAfter=!1,document.body.removeEventListener("mousemove",this.moveHover),document.body.removeEventListener("mouseup",this.endMove),this.connection&&(this.table.element.classList.remove("tabulator-movingrow-sending"),this.disconnectFromTables()))}moveRow(e,i){this.toRow=e,this.toRowAfter=i}moveHover(e){this.connection?this.moveHoverConnections.call(this,e):this.moveHoverTable.call(this,e)}moveHoverTable(e){var i=this.table.rowManager.getElement(),r=i.scrollTop,n=(this.touchMove?e.touches[0].pageY:e.pageY)-i.getBoundingClientRect().top+r;this.hoverElement.style.top=Math.min(n-this.startY,this.table.rowManager.element.scrollHeight-this.hoverElement.offsetHeight)+"px"}moveHoverConnections(e){this.hoverElement.style.left=this.startX+(this.touchMove?e.touches[0].pageX:e.pageX)+"px",this.hoverElement.style.top=this.startY+(this.touchMove?e.touches[0].pageY:e.pageY)+"px"}elementRowDrop(e,i,r){this.dispatchExternal("movableRowsElementDrop",e,i,r?r.getComponent():!1)}connectToTables(e){var i;this.connectionSelectorsTables&&(i=this.commsConnections(this.connectionSelectorsTables),this.dispatchExternal("movableRowsSendingStart",i),this.commsSend(this.connectionSelectorsTables,"moveRow","connect",{row:e})),this.connectionSelectorsElements&&(this.connectionElements=[],Array.isArray(this.connectionSelectorsElements)||(this.connectionSelectorsElements=[this.connectionSelectorsElements]),this.connectionSelectorsElements.forEach(r=>{typeof r=="string"?this.connectionElements=this.connectionElements.concat(Array.prototype.slice.call(document.querySelectorAll(r))):this.connectionElements.push(r)}),this.connectionElements.forEach(r=>{var n=a=>{this.elementRowDrop(a,r,this.moving)};r.addEventListener("mouseup",n),r.tabulatorElementDropEvent=n,r.classList.add("tabulator-movingrow-receiving")}))}disconnectFromTables(){var e;this.connectionSelectorsTables&&(e=this.commsConnections(this.connectionSelectorsTables),this.dispatchExternal("movableRowsSendingStop",e),this.commsSend(this.connectionSelectorsTables,"moveRow","disconnect")),this.connectionElements.forEach(i=>{i.classList.remove("tabulator-movingrow-receiving"),i.removeEventListener("mouseup",i.tabulatorElementDropEvent),delete i.tabulatorElementDropEvent})}connect(e,i){return this.connectedTable?(console.warn("Move Row Error - Table cannot accept connection, already connected to table:",this.connectedTable),!1):(this.connectedTable=e,this.connectedRow=i,this.table.element.classList.add("tabulator-movingrow-receiving"),this.table.rowManager.getDisplayRows().forEach(r=>{r.type==="row"&&r.modules.moveRow&&r.modules.moveRow.mouseup&&r.getElement().addEventListener("mouseup",r.modules.moveRow.mouseup)}),this.tableRowDropEvent=this.tableRowDrop.bind(this),this.table.element.addEventListener("mouseup",this.tableRowDropEvent),this.dispatchExternal("movableRowsReceivingStart",i,e),!0)}disconnect(e){e===this.connectedTable?(this.connectedTable=!1,this.connectedRow=!1,this.table.element.classList.remove("tabulator-movingrow-receiving"),this.table.rowManager.getDisplayRows().forEach(i=>{i.type==="row"&&i.modules.moveRow&&i.modules.moveRow.mouseup&&i.getElement().removeEventListener("mouseup",i.modules.moveRow.mouseup)}),this.table.element.removeEventListener("mouseup",this.tableRowDropEvent),this.dispatchExternal("movableRowsReceivingStop",e)):console.warn("Move Row Error - trying to disconnect from non connected table")}dropComplete(e,i,r){var n=!1;if(r){switch(typeof this.table.options.movableRowsSender){case"string":n=yP.senders[this.table.options.movableRowsSender];break;case"function":n=this.table.options.movableRowsSender;break}n?n.call(this,this.moving?this.moving.getComponent():void 0,i?i.getComponent():void 0,e):this.table.options.movableRowsSender&&console.warn("Mover Row Error - no matching sender found:",this.table.options.movableRowsSender),this.dispatchExternal("movableRowsSent",this.moving.getComponent(),i?i.getComponent():void 0,e)}else this.dispatchExternal("movableRowsSentFailed",this.moving.getComponent(),i?i.getComponent():void 0,e);this.endMove()}tableRowDrop(e,i){var r=!1,n=!1;switch(e.stopImmediatePropagation(),typeof this.table.options.movableRowsReceiver){case"string":r=yP.receivers[this.table.options.movableRowsReceiver];break;case"function":r=this.table.options.movableRowsReceiver;break}r?n=r.call(this,this.connectedRow.getComponent(),i?i.getComponent():void 0,this.connectedTable):console.warn("Mover Row Error - no matching receiver found:",this.table.options.movableRowsReceiver),n?this.dispatchExternal("movableRowsReceived",this.connectedRow.getComponent(),i?i.getComponent():void 0,this.connectedTable):this.dispatchExternal("movableRowsReceivedFailed",this.connectedRow.getComponent(),i?i.getComponent():void 0,this.connectedTable),this.commsSend(this.connectedTable,"moveRow","dropcomplete",{row:i,success:n})}commsReceived(e,i,r){switch(i){case"connect":return this.connect(e,r.row);case"disconnect":return this.disconnect(e);case"dropcomplete":return this.dropComplete(e,r.row,r.success)}}}var fNe={};class bP extends si{static moduleName="mutator";static mutators=fNe;constructor(e){super(e),this.allowedTypes=["","data","edit","clipboard","import"],this.enabled=!0,this.registerColumnOption("mutator"),this.registerColumnOption("mutatorParams"),this.registerColumnOption("mutatorData"),this.registerColumnOption("mutatorDataParams"),this.registerColumnOption("mutatorEdit"),this.registerColumnOption("mutatorEditParams"),this.registerColumnOption("mutatorClipboard"),this.registerColumnOption("mutatorClipboardParams"),this.registerColumnOption("mutatorImport"),this.registerColumnOption("mutatorImportParams"),this.registerColumnOption("mutateLink")}initialize(){this.subscribe("cell-value-changing",this.transformCell.bind(this)),this.subscribe("cell-value-changed",this.mutateLink.bind(this)),this.subscribe("column-layout",this.initializeColumn.bind(this)),this.subscribe("row-data-init-before",this.rowDataChanged.bind(this)),this.subscribe("row-data-changing",this.rowDataChanged.bind(this))}rowDataChanged(e,i,r){return this.transformRow(i,"data",r)}initializeColumn(e){var i=!1,r={};this.allowedTypes.forEach(n=>{var a="mutator"+(n.charAt(0).toUpperCase()+n.slice(1)),s;e.definition[a]&&(s=this.lookupMutator(e.definition[a]),s&&(i=!0,r[a]={mutator:s,params:e.definition[a+"Params"]||{}}))}),i&&(e.modules.mutate=r)}lookupMutator(e){var i=!1;switch(typeof e){case"string":bP.mutators[e]?i=bP.mutators[e]:console.warn("Mutator Error - No such mutator found, ignoring: ",e);break;case"function":i=e;break}return i}transformRow(e,i,r){var n="mutator"+(i.charAt(0).toUpperCase()+i.slice(1)),a;return this.enabled&&this.table.columnManager.traverse(s=>{var o,l,u;s.modules.mutate&&(o=s.modules.mutate[n]||s.modules.mutate.mutator||!1,o&&(a=s.getFieldValue(typeof r<"u"?r:e),(i=="data"&&!r||typeof a<"u")&&(u=s.getComponent(),l=typeof o.params=="function"?o.params(a,e,i,u):o.params,s.setFieldValue(e,o.mutator(a,e,i,l,u)))))}),e}transformCell(e,i){if(e.column.modules.mutate){var r=e.column.modules.mutate.mutatorEdit||e.column.modules.mutate.mutator||!1,n={};if(r)return n=Object.assign(n,e.row.getData()),e.column.setFieldValue(n,i),r.mutator(i,n,"edit",r.params,e.getComponent())}return i}mutateLink(e){var i=e.column.definition.mutateLink;i&&(Array.isArray(i)||(i=[i]),i.forEach(r=>{var n=e.row.getCell(r);n&&n.setValue(n.getValue(),!0,!0)}))}enable(){this.enabled=!0}disable(){this.enabled=!1}}function mNe(t,e,i,r,n){var a=document.createElement("span"),s=document.createElement("span"),o=document.createElement("span"),l=document.createElement("span"),u=document.createElement("span"),c=document.createElement("span");return this.table.modules.localize.langBind("pagination|counter|showing",d=>{s.innerHTML=d}),this.table.modules.localize.langBind("pagination|counter|of",d=>{l.innerHTML=d}),this.table.modules.localize.langBind("pagination|counter|rows",d=>{c.innerHTML=d}),r?(o.innerHTML=" "+e+"-"+Math.min(e+t-1,r)+" ",u.innerHTML=" "+r+" ",a.appendChild(s),a.appendChild(o),a.appendChild(l),a.appendChild(u),a.appendChild(c)):(o.innerHTML=" 0 ",a.appendChild(s),a.appendChild(o),a.appendChild(c)),a}function hNe(t,e,i,r,n){var a=document.createElement("span"),s=document.createElement("span"),o=document.createElement("span"),l=document.createElement("span"),u=document.createElement("span"),c=document.createElement("span");return this.table.modules.localize.langBind("pagination|counter|showing",d=>{s.innerHTML=d}),o.innerHTML=" "+i+" ",this.table.modules.localize.langBind("pagination|counter|of",d=>{l.innerHTML=d}),u.innerHTML=" "+n+" ",this.table.modules.localize.langBind("pagination|counter|pages",d=>{c.innerHTML=d}),a.appendChild(s),a.appendChild(o),a.appendChild(l),a.appendChild(u),a.appendChild(c),a}var gNe={rows:mNe,pages:hNe};class E$ extends si{static moduleName="page";static pageCounters=gNe;constructor(e){super(e),this.mode="local",this.progressiveLoad=!1,this.element=null,this.pageCounterElement=null,this.pageCounter=null,this.size=0,this.page=1,this.count=5,this.max=1,this.remoteRowCountEstimate=null,this.initialLoad=!0,this.dataChanging=!1,this.pageSizes=[],this.registerTableOption("pagination",!1),this.registerTableOption("paginationMode","local"),this.registerTableOption("paginationSize",!1),this.registerTableOption("paginationInitialPage",1),this.registerTableOption("paginationCounter",!1),this.registerTableOption("paginationCounterElement",!1),this.registerTableOption("paginationButtonCount",5),this.registerTableOption("paginationSizeSelector",!1),this.registerTableOption("paginationElement",!1),this.registerTableOption("paginationAddRow","page"),this.registerTableOption("paginationOutOfRange",!1),this.registerTableOption("progressiveLoad",!1),this.registerTableOption("progressiveLoadDelay",0),this.registerTableOption("progressiveLoadScrollMargin",0),this.registerTableFunction("setMaxPage",this.setMaxPage.bind(this)),this.registerTableFunction("setPage",this.setPage.bind(this)),this.registerTableFunction("setPageToRow",this.userSetPageToRow.bind(this)),this.registerTableFunction("setPageSize",this.userSetPageSize.bind(this)),this.registerTableFunction("getPageSize",this.getPageSize.bind(this)),this.registerTableFunction("previousPage",this.previousPage.bind(this)),this.registerTableFunction("nextPage",this.nextPage.bind(this)),this.registerTableFunction("getPage",this.getPage.bind(this)),this.registerTableFunction("getPageMax",this.getPageMax.bind(this)),this.registerComponentFunction("row","pageTo",this.setPageToRow.bind(this))}initialize(){this.table.options.pagination?(this.subscribe("row-deleted",this.rowsUpdated.bind(this)),this.subscribe("row-added",this.rowsUpdated.bind(this)),this.subscribe("data-processed",this.initialLoadComplete.bind(this)),this.subscribe("table-built",this.calculatePageSizes.bind(this)),this.subscribe("footer-redraw",this.footerRedraw.bind(this)),this.table.options.paginationAddRow=="page"&&this.subscribe("row-adding-position",this.rowAddingPosition.bind(this)),this.table.options.paginationMode==="remote"&&(this.subscribe("data-params",this.remotePageParams.bind(this)),this.subscribe("data-loaded",this._parseRemoteData.bind(this))),this.table.options.progressiveLoad&&console.error("Progressive Load Error - Pagination and progressive load cannot be used at the same time"),this.registerDisplayHandler(this.restOnRenderBefore.bind(this),40),this.registerDisplayHandler(this.getRows.bind(this),50),this.createElements(),this.initializePageCounter(),this.initializePaginator()):this.table.options.progressiveLoad&&(this.subscribe("data-params",this.remotePageParams.bind(this)),this.subscribe("data-loaded",this._parseRemoteData.bind(this)),this.subscribe("table-built",this.calculatePageSizes.bind(this)),this.subscribe("data-processed",this.initialLoadComplete.bind(this)),this.initializeProgressive(this.table.options.progressiveLoad),this.table.options.progressiveLoad==="scroll"&&this.subscribe("scroll-vertical",this.scrollVertical.bind(this)))}rowAddingPosition(e,i){var r=this.table.rowManager,n=r.getDisplayRows(),a;return i?n.length?a=n[0]:r.activeRows.length&&(a=r.activeRows[r.activeRows.length-1],i=!1):n.length&&(a=n[n.length-1],i=!(n.length<this.size)),{index:a,top:i}}calculatePageSizes(){var e,i;this.table.options.paginationSize?this.size=this.table.options.paginationSize:(e=document.createElement("div"),e.classList.add("tabulator-row"),e.style.visibility="hidden",i=document.createElement("div"),i.classList.add("tabulator-cell"),i.innerHTML="Page Row Test",e.appendChild(i),this.table.rowManager.getTableElement().appendChild(e),this.size=Math.floor(this.table.rowManager.getElement().clientHeight/e.offsetHeight),this.table.rowManager.getTableElement().removeChild(e)),this.dispatchExternal("pageSizeChanged",this.size),this.generatePageSizeSelectList()}initialLoadComplete(){this.initialLoad=!1}remotePageParams(e,i,r,n){return this.initialLoad||(this.progressiveLoad&&!r||!this.progressiveLoad&&!this.dataChanging)&&this.reset(!0),n.page=this.page,this.size&&(n.size=this.size),n}userSetPageToRow(e){return this.table.options.pagination&&(e=this.table.rowManager.findRow(e),e)?this.setPageToRow(e):Promise.reject()}userSetPageSize(e){return this.table.options.pagination?(this.setPageSize(e),this.setPage(1)):!1}scrollVertical(e,i){var r,n,a;!i&&!this.table.dataLoader.loading&&(r=this.table.rowManager.getElement(),n=r.scrollHeight-r.clientHeight-e,a=this.table.options.progressiveLoadScrollMargin||r.clientHeight*2,n<a&&this.nextPage().catch(()=>{}))}restOnRenderBefore(e,i){return i||this.mode==="local"&&this.reset(),e}rowsUpdated(){this.refreshData(!0,"all")}createElements(){var e;this.element=document.createElement("span"),this.element.classList.add("tabulator-paginator"),this.pagesElement=document.createElement("span"),this.pagesElement.classList.add("tabulator-pages"),e=document.createElement("button"),e.classList.add("tabulator-page"),e.setAttribute("type","button"),e.setAttribute("role","button"),e.setAttribute("aria-label",""),e.setAttribute("title",""),this.firstBut=e.cloneNode(!0),this.firstBut.setAttribute("data-page","first"),this.prevBut=e.cloneNode(!0),this.prevBut.setAttribute("data-page","prev"),this.nextBut=e.cloneNode(!0),this.nextBut.setAttribute("data-page","next"),this.lastBut=e.cloneNode(!0),this.lastBut.setAttribute("data-page","last"),this.table.options.paginationSizeSelector&&(this.pageSizeSelect=document.createElement("select"),this.pageSizeSelect.classList.add("tabulator-page-size"))}generatePageSizeSelectList(){var e=[];if(this.pageSizeSelect){if(Array.isArray(this.table.options.paginationSizeSelector))e=this.table.options.paginationSizeSelector,this.pageSizes=e,this.pageSizes.indexOf(this.size)==-1&&e.unshift(this.size);else if(this.pageSizes.indexOf(this.size)==-1){e=[];for(let i=1;i<5;i++)e.push(this.size*i);this.pageSizes=e}else e=this.pageSizes;for(;this.pageSizeSelect.firstChild;)this.pageSizeSelect.removeChild(this.pageSizeSelect.firstChild);e.forEach(i=>{var r=document.createElement("option");r.value=i,i===!0?this.langBind("pagination|all",function(n){r.innerHTML=n}):r.innerHTML=i,this.pageSizeSelect.appendChild(r)}),this.pageSizeSelect.value=this.size}}initializePageCounter(){var e=this.table.options.paginationCounter,i=null;e&&(typeof e=="function"?i=e:i=E$.pageCounters[e],i?(this.pageCounter=i,this.pageCounterElement=document.createElement("span"),this.pageCounterElement.classList.add("tabulator-page-counter")):console.warn("Pagination Error - No such page counter found: ",e))}initializePaginator(e){var i,r;e||(this.langBind("pagination|first",n=>{this.firstBut.innerHTML=n}),this.langBind("pagination|first_title",n=>{this.firstBut.setAttribute("aria-label",n),this.firstBut.setAttribute("title",n)}),this.langBind("pagination|prev",n=>{this.prevBut.innerHTML=n}),this.langBind("pagination|prev_title",n=>{this.prevBut.setAttribute("aria-label",n),this.prevBut.setAttribute("title",n)}),this.langBind("pagination|next",n=>{this.nextBut.innerHTML=n}),this.langBind("pagination|next_title",n=>{this.nextBut.setAttribute("aria-label",n),this.nextBut.setAttribute("title",n)}),this.langBind("pagination|last",n=>{this.lastBut.innerHTML=n}),this.langBind("pagination|last_title",n=>{this.lastBut.setAttribute("aria-label",n),this.lastBut.setAttribute("title",n)}),this.firstBut.addEventListener("click",()=>{this.setPage(1)}),this.prevBut.addEventListener("click",()=>{this.previousPage()}),this.nextBut.addEventListener("click",()=>{this.nextPage()}),this.lastBut.addEventListener("click",()=>{this.setPage(this.max)}),this.table.options.paginationElement&&(this.element=this.table.options.paginationElement),this.pageSizeSelect&&(i=document.createElement("label"),this.langBind("pagination|page_size",n=>{this.pageSizeSelect.setAttribute("aria-label",n),this.pageSizeSelect.setAttribute("title",n),i.innerHTML=n}),this.element.appendChild(i),this.element.appendChild(this.pageSizeSelect),this.pageSizeSelect.addEventListener("change",n=>{this.setPageSize(this.pageSizeSelect.value=="true"?!0:this.pageSizeSelect.value),this.setPage(1)})),this.element.appendChild(this.firstBut),this.element.appendChild(this.prevBut),this.element.appendChild(this.pagesElement),this.element.appendChild(this.nextBut),this.element.appendChild(this.lastBut),this.table.options.paginationElement||(this.table.options.paginationCounter&&(this.table.options.paginationCounterElement?this.table.options.paginationCounterElement instanceof HTMLElement?this.table.options.paginationCounterElement.appendChild(this.pageCounterElement):typeof this.table.options.paginationCounterElement=="string"&&(r=document.querySelector(this.table.options.paginationCounterElement),r?r.appendChild(this.pageCounterElement):console.warn("Pagination Error - Unable to find element matching paginationCounterElement selector:",this.table.options.paginationCounterElement)):this.footerAppend(this.pageCounterElement)),this.footerAppend(this.element)),this.page=this.table.options.paginationInitialPage,this.count=this.table.options.paginationButtonCount),this.mode=this.table.options.paginationMode}initializeProgressive(e){this.initializePaginator(!0),this.mode="progressive_"+e,this.progressiveLoad=!0}trackChanges(){this.dispatch("page-changed")}setMaxRows(e){e?this.max=this.size===!0?1:Math.ceil(e/this.size):this.max=1,this.page>this.max&&(this.page=this.max)}reset(e){this.initialLoad||(this.mode=="local"||e)&&(this.page=1,this.trackChanges())}setMaxPage(e){e=parseInt(e),this.max=e||1,this.page>this.max&&(this.page=this.max,this.trigger())}setPage(e){switch(e){case"first":return this.setPage(1);case"prev":return this.previousPage();case"next":return this.nextPage();case"last":return this.setPage(this.max)}return e=parseInt(e),e>0&&e<=this.max||this.mode!=="local"?(this.page=e,this.trackChanges(),this.trigger()):(console.warn("Pagination Error - Requested page is out of range of 1 - "+this.max+":",e),Promise.reject())}setPageToRow(e){var i=this.displayRows(-1),r=i.indexOf(e);if(r>-1){var n=this.size===!0?1:Math.ceil((r+1)/this.size);return this.setPage(n)}else return console.warn("Pagination Error - Requested row is not visible"),Promise.reject()}setPageSize(e){e!==!0&&(e=parseInt(e)),e>0&&(this.size=e,this.dispatchExternal("pageSizeChanged",e)),this.pageSizeSelect&&this.generatePageSizeSelectList(),this.trackChanges()}_setPageCounter(e,i,r){var n;if(this.pageCounter)switch(this.mode==="remote"&&(i=this.size,r=(this.page-1)*this.size+1,e=this.remoteRowCountEstimate),n=this.pageCounter.call(this,i,r,this.page,e,this.max),typeof n){case"object":if(n instanceof Node){for(;this.pageCounterElement.firstChild;)this.pageCounterElement.removeChild(this.pageCounterElement.firstChild);this.pageCounterElement.appendChild(n)}else this.pageCounterElement.innerHTML="",n!=null&&console.warn("Page Counter Error - Page Counter has returned a type of object, the only valid page counter object return is an instance of Node, the page counter returned:",n);break;case"undefined":this.pageCounterElement.innerHTML="";break;default:this.pageCounterElement.innerHTML=n}}_setPageButtons(){let e=Math.floor((this.count-1)/2),i=Math.ceil((this.count-1)/2),r=this.max-this.page+e+1<this.count?this.max-this.count+1:Math.max(this.page-e,1),n=this.page<=i?Math.min(this.count,this.max):Math.min(this.page+i,this.max);for(;this.pagesElement.firstChild;)this.pagesElement.removeChild(this.pagesElement.firstChild);this.page==1?(this.firstBut.disabled=!0,this.prevBut.disabled=!0):(this.firstBut.disabled=!1,this.prevBut.disabled=!1),this.page==this.max?(this.lastBut.disabled=!0,this.nextBut.disabled=!0):(this.lastBut.disabled=!1,this.nextBut.disabled=!1);for(let a=r;a<=n;a++)a>0&&a<=this.max&&this.pagesElement.appendChild(this._generatePageButton(a));this.footerRedraw()}_generatePageButton(e){var i=document.createElement("button");return i.classList.add("tabulator-page"),e==this.page&&i.classList.add("active"),i.setAttribute("type","button"),i.setAttribute("role","button"),this.langBind("pagination|page_title",r=>{i.setAttribute("aria-label",r+" "+e),i.setAttribute("title",r+" "+e)}),i.setAttribute("data-page",e),i.textContent=e,i.addEventListener("click",r=>{this.setPage(e)}),i}previousPage(){return this.page>1?(this.page--,this.trackChanges(),this.trigger()):(console.warn("Pagination Error - Previous page would be less than page 1:",0),Promise.reject())}nextPage(){return this.page<this.max?(this.page++,this.trackChanges(),this.trigger()):(this.progressiveLoad||console.warn("Pagination Error - Next page would be greater than maximum page of "+this.max+":",this.max+1),Promise.reject())}getPage(){return this.page}getPageMax(){return this.max}getPageSize(e){return this.size}getMode(){return this.mode}getRows(e){var i=0,r,n,a,s,o=e.filter(l=>l.type==="row");if(this.mode=="local"){r=[],this.setMaxRows(e.length),this.size===!0?(n=0,a=e.length):(n=this.size*(this.page-1),a=n+parseInt(this.size)),this._setPageButtons();for(let l=n;l<a;l++){let u=e[l];u&&(r.push(u),u.type==="row"&&(s||(s=u),i++))}return this._setPageCounter(o.length,i,s?o.indexOf(s)+1:0),r}else return this._setPageButtons(),this._setPageCounter(o.length),e.slice(0)}trigger(){var e;switch(this.mode){case"local":return e=this.table.rowManager.scrollLeft,this.refreshData(),this.table.rowManager.scrollHorizontal(e),this.dispatchExternal("pageLoaded",this.getPage()),Promise.resolve();case"remote":return this.dataChanging=!0,this.reloadData(null).finally(()=>{this.dataChanging=!1});case"progressive_load":case"progressive_scroll":return this.reloadData(null,!0);default:return console.warn("Pagination Error - no such pagination mode:",this.mode),Promise.reject()}}_parseRemoteData(e){var i,r;if(typeof e.last_page>"u"&&console.warn("Remote Pagination Error - Server response missing '"+(this.options("dataReceiveParams").last_page||"last_page")+"' property"),e.data)if(this.max=parseInt(e.last_page)||1,this.remoteRowCountEstimate=typeof e.last_row<"u"?e.last_row:e.last_page*this.size-(this.page==e.last_page?this.size-e.data.length:0),this.progressiveLoad){switch(this.mode){case"progressive_load":this.page==1?this.table.rowManager.setData(e.data,!1,this.page==1):this.table.rowManager.addRows(e.data),this.page<this.max&&setTimeout(()=>{this.nextPage()},this.table.options.progressiveLoadDelay);break;case"progressive_scroll":e=this.page===1?e.data:this.table.rowManager.getData().concat(e.data),this.table.rowManager.setData(e,this.page!==1,this.page==1),i=this.table.options.progressiveLoadScrollMargin||this.table.rowManager.element.clientHeight*2,this.table.rowManager.element.scrollHeight<=this.table.rowManager.element.clientHeight+i&&this.page<this.max&&setTimeout(()=>{this.nextPage()});break}return!1}else{if(this.page>this.max&&(console.warn("Remote Pagination Error - Server returned last page value lower than the current page"),r=this.options("paginationOutOfRange"),r))return this.setPage(typeof r=="function"?r.call(this,this.page,this.max):r);this.dispatchExternal("pageLoaded",this.getPage())}else console.warn("Remote Pagination Error - Server response missing '"+(this.options("dataReceiveParams").data||"data")+"' property");return e.data}footerRedraw(){var e=this.table.footerManager.containerElement;Math.ceil(e.clientWidth)-e.scrollWidth<0?this.pagesElement.style.display="none":(this.pagesElement.style.display="",Math.ceil(e.clientWidth)-e.scrollWidth<0&&(this.pagesElement.style.display="none"))}}var INe={local:function(t,e){var i=localStorage.getItem(t+"-"+e);return i?JSON.parse(i):!1},cookie:function(t,e){var i=document.cookie,r=t+"-"+e,n=i.indexOf(r+"="),a,s;return n>-1&&(i=i.slice(n),a=i.indexOf(";"),a>-1&&(i=i.slice(0,a)),s=i.replace(r+"=","")),s?JSON.parse(s):!1}},vNe={local:function(t,e,i){localStorage.setItem(t+"-"+e,JSON.stringify(i))},cookie:function(t,e,i){var r=new Date;r.setDate(r.getDate()+1e4),document.cookie=t+"-"+e+"="+JSON.stringify(i)+"; expires="+r.toUTCString()}};class _u extends si{static moduleName="persistence";static moduleInitOrder=-10;static readers=INe;static writers=vNe;constructor(e){super(e),this.mode="",this.id="",this.defWatcherBlock=!1,this.config={},this.readFunc=!1,this.writeFunc=!1,this.registerTableOption("persistence",!1),this.registerTableOption("persistenceID",""),this.registerTableOption("persistenceMode",!0),this.registerTableOption("persistenceReaderFunc",!1),this.registerTableOption("persistenceWriterFunc",!1)}localStorageTest(){var e="_tabulator_test";try{return window.localStorage.setItem(e,e),window.localStorage.removeItem(e),!0}catch{return!1}}initialize(){if(this.table.options.persistence){var e=this.table.options.persistenceMode,i=this.table.options.persistenceID,r;this.mode=e!==!0?e:this.localStorageTest()?"local":"cookie",this.table.options.persistenceReaderFunc?typeof this.table.options.persistenceReaderFunc=="function"?this.readFunc=this.table.options.persistenceReaderFunc:_u.readers[this.table.options.persistenceReaderFunc]?this.readFunc=_u.readers[this.table.options.persistenceReaderFunc]:console.warn("Persistence Read Error - invalid reader set",this.table.options.persistenceReaderFunc):_u.readers[this.mode]?this.readFunc=_u.readers[this.mode]:console.warn("Persistence Read Error - invalid reader set",this.mode),this.table.options.persistenceWriterFunc?typeof this.table.options.persistenceWriterFunc=="function"?this.writeFunc=this.table.options.persistenceWriterFunc:_u.writers[this.table.options.persistenceWriterFunc]?this.writeFunc=_u.writers[this.table.options.persistenceWriterFunc]:console.warn("Persistence Write Error - invalid reader set",this.table.options.persistenceWriterFunc):_u.writers[this.mode]?this.writeFunc=_u.writers[this.mode]:console.warn("Persistence Write Error - invalid writer set",this.mode),this.id="tabulator-"+(i||this.table.element.getAttribute("id")||""),this.config={sort:this.table.options.persistence===!0||this.table.options.persistence.sort,filter:this.table.options.persistence===!0||this.table.options.persistence.filter,headerFilter:this.table.options.persistence===!0||this.table.options.persistence.headerFilter,group:this.table.options.persistence===!0||this.table.options.persistence.group,page:this.table.options.persistence===!0||this.table.options.persistence.page,columns:this.table.options.persistence===!0?["title","width","visible"]:this.table.options.persistence.columns},this.config.page&&(r=this.retrieveData("page"),r&&(typeof r.paginationSize<"u"&&(this.config.page===!0||this.config.page.size)&&(this.table.options.paginationSize=r.paginationSize),typeof r.paginationInitialPage<"u"&&(this.config.page===!0||this.config.page.page)&&(this.table.options.paginationInitialPage=r.paginationInitialPage))),this.config.group&&(r=this.retrieveData("group"),r&&(typeof r.groupBy<"u"&&(this.config.group===!0||this.config.group.groupBy)&&(this.table.options.groupBy=r.groupBy),typeof r.groupStartOpen<"u"&&(this.config.group===!0||this.config.group.groupStartOpen)&&(this.table.options.groupStartOpen=r.groupStartOpen),typeof r.groupHeader<"u"&&(this.config.group===!0||this.config.group.groupHeader)&&(this.table.options.groupHeader=r.groupHeader))),this.config.columns&&(this.table.options.columns=this.load("columns",this.table.options.columns),this.subscribe("column-init",this.initializeColumn.bind(this)),this.subscribe("column-show",this.save.bind(this,"columns")),this.subscribe("column-hide",this.save.bind(this,"columns")),this.subscribe("column-moved",this.save.bind(this,"columns"))),this.subscribe("table-built",this.tableBuilt.bind(this),0),this.subscribe("table-redraw",this.tableRedraw.bind(this)),this.subscribe("filter-changed",this.eventSave.bind(this,"filter")),this.subscribe("filter-changed",this.eventSave.bind(this,"headerFilter")),this.subscribe("sort-changed",this.eventSave.bind(this,"sort")),this.subscribe("group-changed",this.eventSave.bind(this,"group")),this.subscribe("page-changed",this.eventSave.bind(this,"page")),this.subscribe("column-resized",this.eventSave.bind(this,"columns")),this.subscribe("column-width",this.eventSave.bind(this,"columns")),this.subscribe("layout-refreshed",this.eventSave.bind(this,"columns"))}this.registerTableFunction("getColumnLayout",this.getColumnLayout.bind(this)),this.registerTableFunction("setColumnLayout",this.setColumnLayout.bind(this))}eventSave(e){this.config[e]&&this.save(e)}tableBuilt(){var e,i,r;this.config.sort&&(e=this.load("sort"),e&&(this.table.options.initialSort=e)),this.config.filter&&(i=this.load("filter"),i&&(this.table.options.initialFilter=i)),this.config.headerFilter&&(r=this.load("headerFilter"),r&&(this.table.options.initialHeaderFilter=r))}tableRedraw(e){e&&this.config.columns&&this.save("columns")}getColumnLayout(){return this.parseColumns(this.table.columnManager.getColumns())}setColumnLayout(e){return this.table.columnManager.setColumns(this.mergeDefinition(this.table.options.columns,e,!0)),!0}initializeColumn(e){var i,r;this.config.columns&&(this.defWatcherBlock=!0,i=e.getDefinition(),r=this.config.columns===!0?Object.keys(i):this.config.columns,r.forEach(n=>{var a=Object.getOwnPropertyDescriptor(i,n),s=i[n];a&&Object.defineProperty(i,n,{set:o=>{s=o,this.defWatcherBlock||this.save("columns"),a.set&&a.set(o)},get:()=>(a.get&&a.get(),s)})}),this.defWatcherBlock=!1)}load(e,i){var r=this.retrieveData(e);return i&&(r=r?this.mergeDefinition(i,r):i),r}retrieveData(e){return this.readFunc?this.readFunc(this.id,e):!1}mergeDefinition(e,i,r){var n=[];return i=i||[],i.forEach((a,s)=>{var o=this._findColumn(e,a),l;o&&(r?l=Object.keys(a):this.config.columns===!0||this.config.columns==null?(l=Object.keys(o),l.push("width")):l=this.config.columns,l.forEach(u=>{u!=="columns"&&typeof a[u]<"u"&&(o[u]=a[u])}),o.columns&&(o.columns=this.mergeDefinition(o.columns,a.columns)),n.push(o))}),e.forEach((a,s)=>{var o=this._findColumn(i,a);o||(n.length>s?n.splice(s,0,a):n.push(a))}),n}_findColumn(e,i){var r=i.columns?"group":i.field?"field":"object";return e.find(function(n){switch(r){case"group":return n.title===i.title&&n.columns.length===i.columns.length;case"field":return n.field===i.field;case"object":return n===i}})}save(e){var i={};switch(e){case"columns":i=this.parseColumns(this.table.columnManager.getColumns());break;case"filter":i=this.table.modules.filter.getFilters();break;case"headerFilter":i=this.table.modules.filter.getHeaderFilters();break;case"sort":i=this.validateSorters(this.table.modules.sort.getSort());break;case"group":i=this.getGroupConfig();break;case"page":i=this.getPageConfig();break}this.writeFunc&&this.writeFunc(this.id,e,i)}validateSorters(e){return e.forEach(function(i){i.column=i.field,delete i.field}),e}getGroupConfig(){var e={};return this.config.group&&((this.config.group===!0||this.config.group.groupBy)&&(e.groupBy=this.table.options.groupBy),(this.config.group===!0||this.config.group.groupStartOpen)&&(e.groupStartOpen=this.table.options.groupStartOpen),(this.config.group===!0||this.config.group.groupHeader)&&(e.groupHeader=this.table.options.groupHeader)),e}getPageConfig(){var e={};return this.config.page&&((this.config.page===!0||this.config.page.size)&&(e.paginationSize=this.table.modules.page.getPageSize()),(this.config.page===!0||this.config.page.page)&&(e.paginationInitialPage=this.table.modules.page.getPage())),e}parseColumns(e){var i=[],r=["headerContextMenu","headerMenu","contextMenu","clickMenu"];return e.forEach(n=>{var a={},s=n.getDefinition(),o;n.isGroup?(a.title=s.title,a.columns=this.parseColumns(n.getColumns())):(a.field=n.getField(),this.config.columns===!0||this.config.columns==null?(o=Object.keys(s),o.push("width"),o.push("visible")):o=this.config.columns,o.forEach(l=>{switch(l){case"width":a.width=n.getWidth();break;case"visible":a.visible=n.visible;break;default:typeof s[l]!="function"&&r.indexOf(l)===-1&&(a[l]=s[l])}})),i.push(a)}),i}}class yNe extends si{static moduleName="popup";constructor(e){super(e),this.columnSubscribers={},this.registerTableOption("rowContextPopup",!1),this.registerTableOption("rowClickPopup",!1),this.registerTableOption("rowDblClickPopup",!1),this.registerTableOption("groupContextPopup",!1),this.registerTableOption("groupClickPopup",!1),this.registerTableOption("groupDblClickPopup",!1),this.registerColumnOption("headerContextPopup"),this.registerColumnOption("headerClickPopup"),this.registerColumnOption("headerDblClickPopup"),this.registerColumnOption("headerPopup"),this.registerColumnOption("headerPopupIcon"),this.registerColumnOption("contextPopup"),this.registerColumnOption("clickPopup"),this.registerColumnOption("dblClickPopup"),this.registerComponentFunction("cell","popup",this._componentPopupCall.bind(this)),this.registerComponentFunction("column","popup",this._componentPopupCall.bind(this)),this.registerComponentFunction("row","popup",this._componentPopupCall.bind(this)),this.registerComponentFunction("group","popup",this._componentPopupCall.bind(this))}initialize(){this.initializeRowWatchers(),this.initializeGroupWatchers(),this.subscribe("column-init",this.initializeColumn.bind(this))}_componentPopupCall(e,i,r){this.loadPopupEvent(i,null,e,r)}initializeRowWatchers(){this.table.options.rowContextPopup&&(this.subscribe("row-contextmenu",this.loadPopupEvent.bind(this,this.table.options.rowContextPopup)),this.table.on("rowTapHold",this.loadPopupEvent.bind(this,this.table.options.rowContextPopup))),this.table.options.rowClickPopup&&this.subscribe("row-click",this.loadPopupEvent.bind(this,this.table.options.rowClickPopup)),this.table.options.rowDblClickPopup&&this.subscribe("row-dblclick",this.loadPopupEvent.bind(this,this.table.options.rowDblClickPopup))}initializeGroupWatchers(){this.table.options.groupContextPopup&&(this.subscribe("group-contextmenu",this.loadPopupEvent.bind(this,this.table.options.groupContextPopup)),this.table.on("groupTapHold",this.loadPopupEvent.bind(this,this.table.options.groupContextPopup))),this.table.options.groupClickPopup&&this.subscribe("group-click",this.loadPopupEvent.bind(this,this.table.options.groupClickPopup)),this.table.options.groupDblClickPopup&&this.subscribe("group-dblclick",this.loadPopupEvent.bind(this,this.table.options.groupDblClickPopup))}initializeColumn(e){var i=e.definition;i.headerContextPopup&&!this.columnSubscribers.headerContextPopup&&(this.columnSubscribers.headerContextPopup=this.loadPopupTableColumnEvent.bind(this,"headerContextPopup"),this.subscribe("column-contextmenu",this.columnSubscribers.headerContextPopup),this.table.on("headerTapHold",this.loadPopupTableColumnEvent.bind(this,"headerContextPopup"))),i.headerClickPopup&&!this.columnSubscribers.headerClickPopup&&(this.columnSubscribers.headerClickPopup=this.loadPopupTableColumnEvent.bind(this,"headerClickPopup"),this.subscribe("column-click",this.columnSubscribers.headerClickPopup)),i.headerDblClickPopup&&!this.columnSubscribers.headerDblClickPopup&&(this.columnSubscribers.headerDblClickPopup=this.loadPopupTableColumnEvent.bind(this,"headerDblClickPopup"),this.subscribe("column-dblclick",this.columnSubscribers.headerDblClickPopup)),i.headerPopup&&this.initializeColumnHeaderPopup(e),i.contextPopup&&!this.columnSubscribers.contextPopup&&(this.columnSubscribers.contextPopup=this.loadPopupTableCellEvent.bind(this,"contextPopup"),this.subscribe("cell-contextmenu",this.columnSubscribers.contextPopup),this.table.on("cellTapHold",this.loadPopupTableCellEvent.bind(this,"contextPopup"))),i.clickPopup&&!this.columnSubscribers.clickPopup&&(this.columnSubscribers.clickPopup=this.loadPopupTableCellEvent.bind(this,"clickPopup"),this.subscribe("cell-click",this.columnSubscribers.clickPopup)),i.dblClickPopup&&!this.columnSubscribers.dblClickPopup&&(this.columnSubscribers.dblClickPopup=this.loadPopupTableCellEvent.bind(this,"dblClickPopup"),this.subscribe("cell-click",this.columnSubscribers.dblClickPopup))}initializeColumnHeaderPopup(e){var i=e.definition.headerPopupIcon,r;r=document.createElement("span"),r.classList.add("tabulator-header-popup-button"),i?(typeof i=="function"&&(i=i(e.getComponent())),i instanceof HTMLElement?r.appendChild(i):r.innerHTML=i):r.innerHTML="&vellip;",r.addEventListener("click",n=>{n.stopPropagation(),n.preventDefault(),this.loadPopupEvent(e.definition.headerPopup,n,e)}),e.titleElement.insertBefore(r,e.titleElement.firstChild)}loadPopupTableCellEvent(e,i,r){r._cell&&(r=r._cell),r.column.definition[e]&&this.loadPopupEvent(r.column.definition[e],i,r)}loadPopupTableColumnEvent(e,i,r){r._column&&(r=r._column),r.definition[e]&&this.loadPopupEvent(r.definition[e],i,r)}loadPopupEvent(e,i,r,n){var a;function s(o){a=o}r._group?r=r._group:r._row&&(r=r._row),e=typeof e=="function"?e.call(this.table,i,r.getComponent(),s):e,this.loadPopup(i,r,e,a,n)}loadPopup(e,i,r,n,a){var s=!(e instanceof MouseEvent),o,l;r instanceof HTMLElement?o=r:(o=document.createElement("div"),o.innerHTML=r),o.classList.add("tabulator-popup"),o.addEventListener("click",u=>{u.stopPropagation()}),s||e.preventDefault(),l=this.popup(o),typeof n=="function"&&l.renderCallback(n),e?l.show(e):l.show(i.getElement(),a||"center"),l.hideOnBlur(()=>{this.dispatchExternal("popupClosed",i.getComponent())}),this.dispatchExternal("popupOpened",i.getComponent())}}class bNe extends si{static moduleName="print";constructor(e){super(e),this.element=!1,this.manualBlock=!1,this.beforeprintEventHandler=null,this.afterprintEventHandler=null,this.registerTableOption("printAsHtml",!1),this.registerTableOption("printFormatter",!1),this.registerTableOption("printHeader",!1),this.registerTableOption("printFooter",!1),this.registerTableOption("printStyled",!0),this.registerTableOption("printRowRange","visible"),this.registerTableOption("printConfig",{}),this.registerColumnOption("print"),this.registerColumnOption("titlePrint")}initialize(){this.table.options.printAsHtml&&(this.beforeprintEventHandler=this.replaceTable.bind(this),this.afterprintEventHandler=this.cleanup.bind(this),window.addEventListener("beforeprint",this.beforeprintEventHandler),window.addEventListener("afterprint",this.afterprintEventHandler),this.subscribe("table-destroy",this.destroy.bind(this))),this.registerTableFunction("print",this.printFullscreen.bind(this))}destroy(){this.table.options.printAsHtml&&(window.removeEventListener("beforeprint",this.beforeprintEventHandler),window.removeEventListener("afterprint",this.afterprintEventHandler))}replaceTable(){this.manualBlock||(this.element=document.createElement("div"),this.element.classList.add("tabulator-print-table"),this.element.appendChild(this.table.modules.export.generateTable(this.table.options.printConfig,this.table.options.printStyled,this.table.options.printRowRange,"print")),this.table.element.style.display="none",this.table.element.parentNode.insertBefore(this.element,this.table.element))}cleanup(){document.body.classList.remove("tabulator-print-fullscreen-hide"),this.element&&this.element.parentNode&&(this.element.parentNode.removeChild(this.element),this.table.element.style.display="")}printFullscreen(e,i,r){var n=window.scrollX,a=window.scrollY,s=document.createElement("div"),o=document.createElement("div"),l=this.table.modules.export.generateTable(typeof r<"u"?r:this.table.options.printConfig,typeof i<"u"?i:this.table.options.printStyled,e||this.table.options.printRowRange,"print"),u,c;this.manualBlock=!0,this.element=document.createElement("div"),this.element.classList.add("tabulator-print-fullscreen"),this.table.options.printHeader&&(s.classList.add("tabulator-print-header"),u=typeof this.table.options.printHeader=="function"?this.table.options.printHeader.call(this.table):this.table.options.printHeader,typeof u=="string"?s.innerHTML=u:s.appendChild(u),this.element.appendChild(s)),this.element.appendChild(l),this.table.options.printFooter&&(o.classList.add("tabulator-print-footer"),c=typeof this.table.options.printFooter=="function"?this.table.options.printFooter.call(this.table):this.table.options.printFooter,typeof c=="string"?o.innerHTML=c:o.appendChild(c),this.element.appendChild(o)),document.body.classList.add("tabulator-print-fullscreen-hide"),document.body.appendChild(this.element),this.table.options.printFormatter&&this.table.options.printFormatter(this.element,l),window.print(),this.cleanup(),window.scrollTo(n,a),this.manualBlock=!1}}class wNe extends si{static moduleName="reactiveData";constructor(e){super(e),this.data=!1,this.blocked=!1,this.origFuncs={},this.currentVersion=0,this.registerTableOption("reactiveData",!1)}initialize(){this.table.options.reactiveData&&(this.subscribe("cell-value-save-before",this.block.bind(this,"cellsave")),this.subscribe("cell-value-save-after",this.unblock.bind(this,"cellsave")),this.subscribe("row-data-save-before",this.block.bind(this,"rowsave")),this.subscribe("row-data-save-after",this.unblock.bind(this,"rowsave")),this.subscribe("row-data-init-after",this.watchRow.bind(this)),this.subscribe("data-processing",this.watchData.bind(this)),this.subscribe("table-destroy",this.unwatchData.bind(this)))}watchData(e){var i=this,r;this.currentVersion++,r=this.currentVersion,this.unwatchData(),this.data=e,this.origFuncs.push=e.push,Object.defineProperty(this.data,"push",{enumerable:!1,configurable:!0,value:function(){var n=Array.from(arguments),a;return!i.blocked&&r===i.currentVersion&&(i.block("data-push"),n.forEach(s=>{i.table.rowManager.addRowActual(s,!1)}),a=i.origFuncs.push.apply(e,arguments),i.unblock("data-push")),a}}),this.origFuncs.unshift=e.unshift,Object.defineProperty(this.data,"unshift",{enumerable:!1,configurable:!0,value:function(){var n=Array.from(arguments),a;return!i.blocked&&r===i.currentVersion&&(i.block("data-unshift"),n.forEach(s=>{i.table.rowManager.addRowActual(s,!0)}),a=i.origFuncs.unshift.apply(e,arguments),i.unblock("data-unshift")),a}}),this.origFuncs.shift=e.shift,Object.defineProperty(this.data,"shift",{enumerable:!1,configurable:!0,value:function(){var n,a;return!i.blocked&&r===i.currentVersion&&(i.block("data-shift"),i.data.length&&(n=i.table.rowManager.getRowFromDataObject(i.data[0]),n&&n.deleteActual()),a=i.origFuncs.shift.call(e),i.unblock("data-shift")),a}}),this.origFuncs.pop=e.pop,Object.defineProperty(this.data,"pop",{enumerable:!1,configurable:!0,value:function(){var n,a;return!i.blocked&&r===i.currentVersion&&(i.block("data-pop"),i.data.length&&(n=i.table.rowManager.getRowFromDataObject(i.data[i.data.length-1]),n&&n.deleteActual()),a=i.origFuncs.pop.call(e),i.unblock("data-pop")),a}}),this.origFuncs.splice=e.splice,Object.defineProperty(this.data,"splice",{enumerable:!1,configurable:!0,value:function(){var n=Array.from(arguments),a=n[0]<0?e.length+n[0]:n[0],s=n[1],o=n[2]?n.slice(2):!1,l,u;if(!i.blocked&&r===i.currentVersion){if(i.block("data-splice"),o&&(l=e[a]?i.table.rowManager.getRowFromDataObject(e[a]):!1,l?o.forEach(d=>{i.table.rowManager.addRowActual(d,!0,l,!0)}):(o=o.slice().reverse(),o.forEach(d=>{i.table.rowManager.addRowActual(d,!0,!1,!0)}))),s!==0){var c=e.slice(a,typeof n[1]>"u"?n[1]:a+s);c.forEach((d,p)=>{var f=i.table.rowManager.getRowFromDataObject(d);f&&f.deleteActual(p!==c.length-1)})}(o||s!==0)&&i.table.rowManager.reRenderInPosition(),u=i.origFuncs.splice.apply(e,arguments),i.unblock("data-splice")}return u}})}unwatchData(){if(this.data!==!1)for(var e in this.origFuncs)Object.defineProperty(this.data,e,{enumerable:!0,configurable:!0,writable:!0,value:this.origFuncs.key})}watchRow(e){var i=e.getData();for(var r in i)this.watchKey(e,i,r);this.table.options.dataTree&&this.watchTreeChildren(e)}watchTreeChildren(e){var i=this,r=e.getData()[this.table.options.dataTreeChildField],n={};r&&(n.push=r.push,Object.defineProperty(r,"push",{enumerable:!1,configurable:!0,value:()=>{if(!i.blocked){i.block("tree-push");var a=n.push.apply(r,arguments);this.rebuildTree(e),i.unblock("tree-push")}return a}}),n.unshift=r.unshift,Object.defineProperty(r,"unshift",{enumerable:!1,configurable:!0,value:()=>{if(!i.blocked){i.block("tree-unshift");var a=n.unshift.apply(r,arguments);this.rebuildTree(e),i.unblock("tree-unshift")}return a}}),n.shift=r.shift,Object.defineProperty(r,"shift",{enumerable:!1,configurable:!0,value:()=>{if(!i.blocked){i.block("tree-shift");var a=n.shift.call(r);this.rebuildTree(e),i.unblock("tree-shift")}return a}}),n.pop=r.pop,Object.defineProperty(r,"pop",{enumerable:!1,configurable:!0,value:()=>{if(!i.blocked){i.block("tree-pop");var a=n.pop.call(r);this.rebuildTree(e),i.unblock("tree-pop")}return a}}),n.splice=r.splice,Object.defineProperty(r,"splice",{enumerable:!1,configurable:!0,value:()=>{if(!i.blocked){i.block("tree-splice");var a=n.splice.apply(r,arguments);this.rebuildTree(e),i.unblock("tree-splice")}return a}}))}rebuildTree(e){this.table.modules.dataTree.initializeRow(e),this.table.modules.dataTree.layoutRow(e),this.table.rowManager.refreshActiveData("tree",!1,!0)}watchKey(e,i,r){var n=this,a=Object.getOwnPropertyDescriptor(i,r),s=i[r],o=this.currentVersion;Object.defineProperty(i,r,{set:l=>{if(s=l,!n.blocked&&o===n.currentVersion){n.block("key");var u={};u[r]=l,e.updateData(u),n.unblock("key")}a.set&&a.set(l)},get:()=>(a.get&&a.get(),s)})}unwatchRow(e){var i=e.getData();for(var r in i)Object.defineProperty(i,r,{value:i[r]})}block(e){this.blocked||(this.blocked=e)}unblock(e){this.blocked===e&&(this.blocked=!1)}}class SNe extends si{static moduleName="resizeColumns";constructor(e){super(e),this.startColumn=!1,this.startX=!1,this.startWidth=!1,this.latestX=!1,this.handle=null,this.initialNextColumn=null,this.nextColumn=null,this.initialized=!1,this.registerColumnOption("resizable",!0),this.registerTableOption("resizableColumnFit",!1),this.registerTableOption("resizableColumnGuide",!1)}initialize(){this.subscribe("column-rendered",this.layoutColumnHeader.bind(this))}initializeEventWatchers(){this.initialized||(this.subscribe("cell-rendered",this.layoutCellHandles.bind(this)),this.subscribe("cell-delete",this.deInitializeComponent.bind(this)),this.subscribe("cell-height",this.resizeHandle.bind(this)),this.subscribe("column-moved",this.columnLayoutUpdated.bind(this)),this.subscribe("column-hide",this.deInitializeColumn.bind(this)),this.subscribe("column-show",this.columnLayoutUpdated.bind(this)),this.subscribe("column-width",this.columnWidthUpdated.bind(this)),this.subscribe("column-delete",this.deInitializeComponent.bind(this)),this.subscribe("column-height",this.resizeHandle.bind(this)),this.initialized=!0)}layoutCellHandles(e){e.row.type==="row"&&(this.deInitializeComponent(e),this.initializeColumn("cell",e,e.column,e.element))}layoutColumnHeader(e){e.definition.resizable&&(this.initializeEventWatchers(),this.deInitializeComponent(e),this.initializeColumn("header",e,e,e.element))}columnLayoutUpdated(e){var i=e.prevColumn();this.reinitializeColumn(e),i&&this.reinitializeColumn(i)}columnWidthUpdated(e){e.modules.frozen&&(this.table.modules.frozenColumns.leftColumns.includes(e)?this.table.modules.frozenColumns.leftColumns.forEach(i=>{this.reinitializeColumn(i)}):this.table.modules.frozenColumns.rightColumns.includes(e)&&this.table.modules.frozenColumns.rightColumns.forEach(i=>{this.reinitializeColumn(i)}))}frozenColumnOffset(e){var i=!1;return e.modules.frozen&&(i=e.modules.frozen.marginValue,e.modules.frozen.position==="left"?i+=e.getWidth()-3:i&&(i-=3)),i!==!1?i+"px":!1}reinitializeColumn(e){var i=this.frozenColumnOffset(e);e.cells.forEach(r=>{r.modules.resize&&r.modules.resize.handleEl&&(i&&(r.modules.resize.handleEl.style[e.modules.frozen.position]=i,r.modules.resize.handleEl.style["z-index"]=11),r.element.after(r.modules.resize.handleEl))}),e.modules.resize&&e.modules.resize.handleEl&&(i&&(e.modules.resize.handleEl.style[e.modules.frozen.position]=i),e.element.after(e.modules.resize.handleEl))}initializeColumn(e,i,r,n){var a=this,s=!1,o=r.definition.resizable,l={},u=r.getLastColumn();if(e==="header"&&(s=r.definition.formatter=="textarea"||r.definition.variableHeight,l={variableHeight:s}),(o===!0||o==e)&&this._checkResizability(u)){var c=document.createElement("span");c.className="tabulator-col-resize-handle",c.addEventListener("click",function(p){p.stopPropagation()});var d=function(p){a.startColumn=r,a.initialNextColumn=a.nextColumn=u.nextColumn(),a._mouseDown(p,u,c)};c.addEventListener("mousedown",d),c.addEventListener("touchstart",d,{passive:!0}),c.addEventListener("dblclick",p=>{var f=u.getWidth();p.stopPropagation(),u.reinitializeWidth(!0),f!==u.getWidth()&&(a.dispatch("column-resized",u),a.dispatchExternal("columnResized",u.getComponent()))}),r.modules.frozen&&(c.style.position="sticky",c.style[r.modules.frozen.position]=this.frozenColumnOffset(r)),l.handleEl=c,n.parentNode&&r.visible&&n.after(c)}i.modules.resize=l}deInitializeColumn(e){this.deInitializeComponent(e),e.cells.forEach(i=>{this.deInitializeComponent(i)})}deInitializeComponent(e){var i;e.modules.resize&&(i=e.modules.resize.handleEl,i&&i.parentElement&&i.parentElement.removeChild(i))}resizeHandle(e,i){e.modules.resize&&e.modules.resize.handleEl&&(e.modules.resize.handleEl.style.height=i)}resize(e,i){var r=typeof e.clientX>"u"?e.touches[0].clientX:e.clientX,n=r-this.startX,a=r-this.latestX,s,o;if(this.latestX=r,this.table.rtl&&(n=-n,a=-a),s=i.width==i.minWidth||i.width==i.maxWidth,i.setWidth(this.startWidth+n),o=i.width==i.minWidth||i.width==i.maxWidth,a<0&&(this.nextColumn=this.initialNextColumn),this.table.options.resizableColumnFit&&this.nextColumn&&!(s&&o)){let l=this.nextColumn.getWidth();a>0&&l<=this.nextColumn.minWidth&&(this.nextColumn=this.nextColumn.nextColumn()),this.nextColumn&&this.nextColumn.setWidth(this.nextColumn.getWidth()-a)}this.table.columnManager.rerenderColumns(!0),!this.table.browserSlow&&i.modules.resize&&i.modules.resize.variableHeight&&i.checkCellHeights()}calcGuidePosition(e,i,r){var n=typeof e.clientX>"u"?e.touches[0].clientX:e.clientX,a=r.getBoundingClientRect().x-this.table.element.getBoundingClientRect().x,s=this.table.element.getBoundingClientRect().x,o=i.element.getBoundingClientRect().left-s,l=n-this.startX,u=Math.max(a+l,o+i.minWidth);return i.maxWidth&&(u=Math.min(u,o+i.maxWidth)),u}_checkResizability(e){return e.definition.resizable}_mouseDown(e,i,r){var n=this,a;this.dispatchExternal("columnResizing",i.getComponent()),n.table.options.resizableColumnGuide&&(a=document.createElement("span"),a.classList.add("tabulator-col-resize-guide"),n.table.element.appendChild(a),setTimeout(()=>{a.style.left=n.calcGuidePosition(e,i,r)+"px"})),n.table.element.classList.add("tabulator-block-select");function s(l){n.table.options.resizableColumnGuide?a.style.left=n.calcGuidePosition(l,i,r)+"px":n.resize(l,i)}function o(l){n.table.options.resizableColumnGuide&&(n.resize(l,i),a.remove()),n.startColumn.modules.edit&&(n.startColumn.modules.edit.blocked=!1),n.table.browserSlow&&i.modules.resize&&i.modules.resize.variableHeight&&i.checkCellHeights(),document.body.removeEventListener("mouseup",o),document.body.removeEventListener("mousemove",s),r.removeEventListener("touchmove",s),r.removeEventListener("touchend",o),n.table.element.classList.remove("tabulator-block-select"),n.startWidth!==i.getWidth()&&(n.table.columnManager.verticalAlignHeaders(),n.dispatch("column-resized",i),n.dispatchExternal("columnResized",i.getComponent()))}e.stopPropagation(),n.startColumn.modules.edit&&(n.startColumn.modules.edit.blocked=!0),n.startX=typeof e.clientX>"u"?e.touches[0].clientX:e.clientX,n.latestX=n.startX,n.startWidth=i.getWidth(),document.body.addEventListener("mousemove",s),document.body.addEventListener("mouseup",o),r.addEventListener("touchmove",s,{passive:!0}),r.addEventListener("touchend",o)}}class UNe extends si{static moduleName="resizeRows";constructor(e){super(e),this.startColumn=!1,this.startY=!1,this.startHeight=!1,this.handle=null,this.prevHandle=null,this.registerTableOption("resizableRows",!1),this.registerTableOption("resizableRowGuide",!1)}initialize(){this.table.options.resizableRows&&this.subscribe("row-layout-after",this.initializeRow.bind(this))}initializeRow(e){var i=this,r=e.getElement(),n=document.createElement("div");n.className="tabulator-row-resize-handle";var a=document.createElement("div");a.className="tabulator-row-resize-handle prev",n.addEventListener("click",function(l){l.stopPropagation()});var s=function(l){i.startRow=e,i._mouseDown(l,e,n)};n.addEventListener("mousedown",s),n.addEventListener("touchstart",s,{passive:!0}),a.addEventListener("click",function(l){l.stopPropagation()});var o=function(l){var u=i.table.rowManager.prevDisplayRow(e);u&&(i.startRow=u,i._mouseDown(l,u,a))};a.addEventListener("mousedown",o),a.addEventListener("touchstart",o,{passive:!0}),r.appendChild(n),r.appendChild(a)}resize(e,i){i.setHeight(this.startHeight+((typeof e.screenY>"u"?e.touches[0].screenY:e.screenY)-this.startY))}calcGuidePosition(e,i,r){var n=typeof e.screenY>"u"?e.touches[0].screenY:e.screenY,a=r.getBoundingClientRect().y-this.table.element.getBoundingClientRect().y,s=this.table.element.getBoundingClientRect().y,o=i.element.getBoundingClientRect().top-s,l=n-this.startY;return Math.max(a+l,o)}_mouseDown(e,i,r){var n=this,a;n.dispatchExternal("rowResizing",i.getComponent()),n.table.options.resizableRowGuide&&(a=document.createElement("span"),a.classList.add("tabulator-row-resize-guide"),n.table.element.appendChild(a),setTimeout(()=>{a.style.top=n.calcGuidePosition(e,i,r)+"px"})),n.table.element.classList.add("tabulator-block-select");function s(l){n.table.options.resizableRowGuide?a.style.top=n.calcGuidePosition(l,i,r)+"px":n.resize(l,i)}function o(l){n.table.options.resizableRowGuide&&(n.resize(l,i),a.remove()),document.body.removeEventListener("mouseup",s),document.body.removeEventListener("mousemove",s),r.removeEventListener("touchmove",s),r.removeEventListener("touchend",o),n.table.element.classList.remove("tabulator-block-select"),n.dispatchExternal("rowResized",i.getComponent())}e.stopPropagation(),n.startY=typeof e.screenY>"u"?e.touches[0].screenY:e.screenY,n.startHeight=i.getHeight(),document.body.addEventListener("mousemove",s),document.body.addEventListener("mouseup",o),r.addEventListener("touchmove",s,{passive:!0}),r.addEventListener("touchend",o)}}class TNe extends si{static moduleName="resizeTable";constructor(e){super(e),this.binding=!1,this.visibilityObserver=!1,this.resizeObserver=!1,this.containerObserver=!1,this.tableHeight=0,this.tableWidth=0,this.containerHeight=0,this.containerWidth=0,this.autoResize=!1,this.visible=!1,this.initialized=!1,this.initialRedraw=!1,this.registerTableOption("autoResize",!0)}initialize(){if(this.table.options.autoResize){var e=this.table,i;this.tableHeight=e.element.clientHeight,this.tableWidth=e.element.clientWidth,e.element.parentNode&&(this.containerHeight=e.element.parentNode.clientHeight,this.containerWidth=e.element.parentNode.clientWidth),typeof IntersectionObserver<"u"&&typeof ResizeObserver<"u"&&e.rowManager.getRenderMode()==="virtual"?(this.initializeVisibilityObserver(),this.autoResize=!0,this.resizeObserver=new ResizeObserver(r=>{if(!e.browserMobile||e.browserMobile&&(!e.modules.edit||e.modules.edit&&!e.modules.edit.currentCell)){var n=Math.floor(r[0].contentRect.height),a=Math.floor(r[0].contentRect.width);(this.tableHeight!=n||this.tableWidth!=a)&&(this.tableHeight=n,this.tableWidth=a,e.element.parentNode&&(this.containerHeight=e.element.parentNode.clientHeight,this.containerWidth=e.element.parentNode.clientWidth),this.redrawTable())}}),this.resizeObserver.observe(e.element),i=window.getComputedStyle(e.element),this.table.element.parentNode&&!this.table.rowManager.fixedHeight&&(i.getPropertyValue("max-height")||i.getPropertyValue("min-height"))&&(this.containerObserver=new ResizeObserver(r=>{if(!e.browserMobile||e.browserMobile&&(!e.modules.edit||e.modules.edit&&!e.modules.edit.currentCell)){var n=Math.floor(r[0].contentRect.height),a=Math.floor(r[0].contentRect.width);(this.containerHeight!=n||this.containerWidth!=a)&&(this.containerHeight=n,this.containerWidth=a,this.tableHeight=e.element.clientHeight,this.tableWidth=e.element.clientWidth),this.redrawTable()}}),this.containerObserver.observe(this.table.element.parentNode)),this.subscribe("table-resize",this.tableResized.bind(this))):(this.binding=function(){(!e.browserMobile||e.browserMobile&&(!e.modules.edit||e.modules.edit&&!e.modules.edit.currentCell))&&(e.columnManager.rerenderColumns(!0),e.redraw())},window.addEventListener("resize",this.binding)),this.subscribe("table-destroy",this.clearBindings.bind(this))}}initializeVisibilityObserver(){this.visibilityObserver=new IntersectionObserver(e=>{this.visible=e[0].isIntersecting,this.initialized?this.visible&&(this.redrawTable(this.initialRedraw),this.initialRedraw=!1):(this.initialized=!0,this.initialRedraw=!this.visible)}),this.visibilityObserver.observe(this.table.element)}redrawTable(e){this.initialized&&this.visible&&(this.table.columnManager.rerenderColumns(!0),this.table.redraw(e))}tableResized(){this.table.rowManager.redraw()}clearBindings(){this.binding&&window.removeEventListener("resize",this.binding),this.resizeObserver&&this.resizeObserver.unobserve(this.table.element),this.visibilityObserver&&this.visibilityObserver.unobserve(this.table.element),this.containerObserver&&this.containerObserver.unobserve(this.table.element.parentNode)}}function DNe(t,e,i){var r=document.createElement("div"),n=t.getRow()._row.modules.responsiveLayout;r.classList.add("tabulator-responsive-collapse-toggle"),r.innerHTML=`<svg class='tabulator-responsive-collapse-toggle-open' viewbox="0 0 24 24">
  <line x1="7" y1="12" x2="17" y2="12" fill="none" stroke-width="3" stroke-linecap="round" />
  <line y1="7" x1="12" y2="17" x2="12" fill="none" stroke-width="3" stroke-linecap="round" />
</svg>

<svg class='tabulator-responsive-collapse-toggle-close' viewbox="0 0 24 24">
  <line x1="7" y1="12" x2="17" y2="12"  fill="none" stroke-width="3" stroke-linecap="round" />
</svg>`,t.getElement().classList.add("tabulator-row-handle");function a(s){var o=n.element;n.open=s,o&&(n.open?(r.classList.add("open"),o.style.display=""):(r.classList.remove("open"),o.style.display="none"))}return r.addEventListener("click",function(s){s.stopImmediatePropagation(),a(!n.open),t.getTable().rowManager.adjustTableSize()}),a(n.open),r}var PNe={format:{formatters:{responsiveCollapse:DNe}}};class ENe extends si{static moduleName="responsiveLayout";static moduleExtensions=PNe;constructor(e){super(e),this.columns=[],this.hiddenColumns=[],this.mode="",this.index=0,this.collapseFormatter=[],this.collapseStartOpen=!0,this.collapseHandleColumn=!1,this.registerTableOption("responsiveLayout",!1),this.registerTableOption("responsiveLayoutCollapseStartOpen",!0),this.registerTableOption("responsiveLayoutCollapseUseFormatters",!0),this.registerTableOption("responsiveLayoutCollapseFormatter",!1),this.registerColumnOption("responsive")}initialize(){this.table.options.responsiveLayout&&(this.subscribe("column-layout",this.initializeColumn.bind(this)),this.subscribe("column-show",this.updateColumnVisibility.bind(this)),this.subscribe("column-hide",this.updateColumnVisibility.bind(this)),this.subscribe("columns-loaded",this.initializeResponsivity.bind(this)),this.subscribe("column-moved",this.initializeResponsivity.bind(this)),this.subscribe("column-add",this.initializeResponsivity.bind(this)),this.subscribe("column-delete",this.initializeResponsivity.bind(this)),this.subscribe("table-redrawing",this.tableRedraw.bind(this)),this.table.options.responsiveLayout==="collapse"&&(this.subscribe("row-data-changed",this.generateCollapsedRowContent.bind(this)),this.subscribe("row-init",this.initializeRow.bind(this)),this.subscribe("row-layout",this.layoutRow.bind(this))))}tableRedraw(e){["fitColumns","fitDataStretch"].indexOf(this.layoutMode())===-1&&(e||this.update())}initializeResponsivity(){var e=[];this.mode=this.table.options.responsiveLayout,this.collapseFormatter=this.table.options.responsiveLayoutCollapseFormatter||this.formatCollapsedData,this.collapseStartOpen=this.table.options.responsiveLayoutCollapseStartOpen,this.hiddenColumns=[],this.collapseFormatter&&(this.collapseFormatter=this.collapseFormatter.bind(this.table)),this.table.columnManager.columnsByIndex.forEach((i,r)=>{i.modules.responsive&&i.modules.responsive.order&&i.modules.responsive.visible&&(i.modules.responsive.index=r,e.push(i),!i.visible&&this.mode==="collapse"&&this.hiddenColumns.push(i))}),e=e.reverse(),e=e.sort((i,r)=>{var n=r.modules.responsive.order-i.modules.responsive.order;return n||r.modules.responsive.index-i.modules.responsive.index}),this.columns=e,this.mode==="collapse"&&this.generateCollapsedContent();for(let i of this.table.columnManager.columnsByIndex)if(i.definition.formatter=="responsiveCollapse"){this.collapseHandleColumn=i;break}this.collapseHandleColumn&&(this.hiddenColumns.length?this.collapseHandleColumn.show():this.collapseHandleColumn.hide())}initializeColumn(e){var i=e.getDefinition();e.modules.responsive={order:typeof i.responsive>"u"?1:i.responsive,visible:i.visible!==!1}}initializeRow(e){var i;e.type!=="calc"&&(i=document.createElement("div"),i.classList.add("tabulator-responsive-collapse"),e.modules.responsiveLayout={element:i,open:this.collapseStartOpen},this.collapseStartOpen||(i.style.display="none"))}layoutRow(e){var i=e.getElement();e.modules.responsiveLayout&&(i.appendChild(e.modules.responsiveLayout.element),this.generateCollapsedRowContent(e))}updateColumnVisibility(e,i){!i&&e.modules.responsive&&(e.modules.responsive.visible=e.visible,this.initializeResponsivity())}hideColumn(e){var i=this.hiddenColumns.length;e.hide(!1,!0),this.mode==="collapse"&&(this.hiddenColumns.unshift(e),this.generateCollapsedContent(),this.collapseHandleColumn&&!i&&this.collapseHandleColumn.show())}showColumn(e){var i;e.show(!1,!0),e.setWidth(e.getWidth()),this.mode==="collapse"&&(i=this.hiddenColumns.indexOf(e),i>-1&&this.hiddenColumns.splice(i,1),this.generateCollapsedContent(),this.collapseHandleColumn&&!this.hiddenColumns.length&&this.collapseHandleColumn.hide())}update(){for(var e=!0;e;){let i=this.table.modules.layout.getMode()=="fitColumns"?this.table.columnManager.getFlexBaseWidth():this.table.columnManager.getWidth(),r=(this.table.options.headerVisible?this.table.columnManager.element.clientWidth:this.table.element.clientWidth)-i;if(r<0){let n=this.columns[this.index];n?(this.hideColumn(n),this.index++):e=!1}else{let n=this.columns[this.index-1];n&&r>0&&r>=n.getWidth()?(this.showColumn(n),this.index--):e=!1}this.table.rowManager.activeRowsCount||this.table.rowManager.renderEmptyScroll()}}generateCollapsedContent(){var e=this.table.rowManager.getDisplayRows();e.forEach(i=>{this.generateCollapsedRowContent(i)})}generateCollapsedRowContent(e){var i,r;if(e.modules.responsiveLayout){for(i=e.modules.responsiveLayout.element;i.firstChild;)i.removeChild(i.firstChild);r=this.collapseFormatter(this.generateCollapsedRowData(e)),r&&i.appendChild(r),e.calcHeight(!0)}}generateCollapsedRowData(e){var i=e.getData(),r=[],n;return this.hiddenColumns.forEach(a=>{var s=a.getFieldValue(i);if(a.definition.title&&a.field)if(a.modules.format&&this.table.options.responsiveLayoutCollapseUseFormatters){let l=function(u){u()};var o=l;n={value:!1,data:{},getValue:function(){return s},getData:function(){return i},getType:function(){return"cell"},getElement:function(){return document.createElement("div")},getRow:function(){return e.getComponent()},getColumn:function(){return a.getComponent()},getTable:()=>this.table},r.push({field:a.field,title:a.definition.title,value:a.modules.format.formatter.call(this.table.modules.format,n,a.modules.format.params,l)})}else r.push({field:a.field,title:a.definition.title,value:s})}),r}formatCollapsedData(e){var i=document.createElement("table");return e.forEach(r=>{var n=document.createElement("tr"),a=document.createElement("td"),s=document.createElement("td"),o,l=document.createElement("strong");a.appendChild(l),this.modules.localize.bind("columns|"+r.field,function(u){l.innerHTML=u||r.title}),r.value instanceof Node?(o=document.createElement("div"),o.appendChild(r.value),s.appendChild(o)):s.innerHTML=r.value,n.appendChild(a),n.appendChild(s),i.appendChild(n)}),Object.keys(e).length?i:""}}function RNe(t,e,i){var r=document.createElement("input"),n=!1;if(r.type="checkbox",r.setAttribute("aria-label","Select Row"),this.table.modExists("selectRow",!0))if(r.addEventListener("click",s=>{s.stopPropagation()}),typeof t.getRow=="function"){var a=t.getRow();a instanceof zC?(r.addEventListener("change",s=>{this.table.options.selectableRowsRangeMode==="click"&&n?n=!1:a.toggleSelect()}),this.table.options.selectableRowsRangeMode==="click"&&r.addEventListener("click",s=>{n=!0,this.table.modules.selectRow.handleComplexRowClick(a._row,s)}),r.checked=a.isSelected&&a.isSelected(),this.table.modules.selectRow.registerRowSelectCheckbox(a,r)):r=""}else r.addEventListener("change",s=>{this.table.modules.selectRow.selectedRows.length?this.table.deselectRow():this.table.selectRow(e.rowRange)}),this.table.modules.selectRow.registerHeaderSelectCheckbox(r);return r}var CNe={format:{formatters:{rowSelection:RNe}}};class MNe extends si{static moduleName="selectRow";static moduleExtensions=CNe;constructor(e){super(e),this.selecting=!1,this.lastClickedRow=!1,this.selectPrev=[],this.selectedRows=[],this.headerCheckboxElement=null,this.registerTableOption("selectableRows","highlight"),this.registerTableOption("selectableRowsRangeMode","drag"),this.registerTableOption("selectableRowsRollingSelection",!0),this.registerTableOption("selectableRowsPersistence",!0),this.registerTableOption("selectableRowsCheck",function(i,r){return!0}),this.registerTableFunction("selectRow",this.selectRows.bind(this)),this.registerTableFunction("deselectRow",this.deselectRows.bind(this)),this.registerTableFunction("toggleSelectRow",this.toggleRow.bind(this)),this.registerTableFunction("getSelectedRows",this.getSelectedRows.bind(this)),this.registerTableFunction("getSelectedData",this.getSelectedData.bind(this)),this.registerComponentFunction("row","select",this.selectRows.bind(this)),this.registerComponentFunction("row","deselect",this.deselectRows.bind(this)),this.registerComponentFunction("row","toggleSelect",this.toggleRow.bind(this)),this.registerComponentFunction("row","isSelected",this.isRowSelected.bind(this))}initialize(){this.deprecatedOptionsCheck(),this.table.options.selectableRows==="highlight"&&this.table.options.selectableRange&&(this.table.options.selectableRows=!1),this.table.options.selectableRows!==!1&&(this.subscribe("row-init",this.initializeRow.bind(this)),this.subscribe("row-deleting",this.rowDeleted.bind(this)),this.subscribe("rows-wipe",this.clearSelectionData.bind(this)),this.subscribe("rows-retrieve",this.rowRetrieve.bind(this)),this.table.options.selectableRows&&!this.table.options.selectableRowsPersistence&&this.subscribe("data-refreshing",this.deselectRows.bind(this)))}deprecatedOptionsCheck(){}rowRetrieve(e,i){return e==="selected"?this.selectedRows:i}rowDeleted(e){this._deselectRow(e,!0)}clearSelectionData(e){var i=this.selectedRows.length;this.selecting=!1,this.lastClickedRow=!1,this.selectPrev=[],this.selectedRows=[],i&&e!==!0&&this._rowSelectionChanged()}initializeRow(e){var i=this,r=i.checkRowSelectability(e),n=e.getElement(),a=function(){setTimeout(function(){i.selecting=!1},50),document.body.removeEventListener("mouseup",a)};e.modules.select={selected:!1},n.classList.toggle("tabulator-selectable",r),n.classList.toggle("tabulator-unselectable",!r),i.checkRowSelectability(e)&&i.table.options.selectableRows&&i.table.options.selectableRows!="highlight"&&(i.table.options.selectableRowsRangeMode==="click"?n.addEventListener("click",this.handleComplexRowClick.bind(this,e)):(n.addEventListener("click",function(s){(!i.table.modExists("edit")||!i.table.modules.edit.getCurrentCell())&&i.table._clearSelection(),i.selecting||i.toggleRow(e)}),n.addEventListener("mousedown",function(s){if(s.shiftKey)return i.table._clearSelection(),i.selecting=!0,i.selectPrev=[],document.body.addEventListener("mouseup",a),document.body.addEventListener("keyup",a),i.toggleRow(e),!1}),n.addEventListener("mouseenter",function(s){i.selecting&&(i.table._clearSelection(),i.toggleRow(e),i.selectPrev[1]==e&&i.toggleRow(i.selectPrev[0]))}),n.addEventListener("mouseout",function(s){i.selecting&&(i.table._clearSelection(),i.selectPrev.unshift(e))})))}handleComplexRowClick(e,i){if(i.shiftKey){this.table._clearSelection(),this.lastClickedRow=this.lastClickedRow||e;var r=this.table.rowManager.getDisplayRowIndex(this.lastClickedRow),n=this.table.rowManager.getDisplayRowIndex(e),a=r<=n?r:n,s=r>=n?r:n,o=this.table.rowManager.getDisplayRows().slice(0),l=o.splice(a,s-a+1);i.ctrlKey||i.metaKey?(l.forEach(u=>{u!==this.lastClickedRow&&(this.table.options.selectableRows!==!0&&!this.isRowSelected(e)?this.selectedRows.length<this.table.options.selectableRows&&this.toggleRow(u):this.toggleRow(u))}),this.lastClickedRow=e):(this.deselectRows(void 0,!0),this.table.options.selectableRows!==!0&&l.length>this.table.options.selectableRows&&(l=l.slice(0,this.table.options.selectableRows)),this.selectRows(l)),this.table._clearSelection()}else i.ctrlKey||i.metaKey?(this.toggleRow(e),this.lastClickedRow=e):(this.deselectRows(void 0,!0),this.selectRows(e),this.lastClickedRow=e)}checkRowSelectability(e){return e&&e.type==="row"?this.table.options.selectableRowsCheck.call(this.table,e.getComponent()):!1}toggleRow(e){this.checkRowSelectability(e)&&(e.modules.select&&e.modules.select.selected?this._deselectRow(e):this._selectRow(e))}selectRows(e){var i=[],r,n;switch(typeof e){case"undefined":r=this.table.rowManager.rows;break;case"number":r=this.table.rowManager.findRow(e);break;case"string":r=this.table.rowManager.findRow(e),r||(r=this.table.rowManager.getRows(e));break;default:r=e;break}Array.isArray(r)?r.length&&(r.forEach(a=>{n=this._selectRow(a,!0,!0),n&&i.push(n)}),this._rowSelectionChanged(!1,i)):r&&this._selectRow(r,!1,!0)}_selectRow(e,i,r){if(!isNaN(this.table.options.selectableRows)&&this.table.options.selectableRows!==!0&&!r&&this.selectedRows.length>=this.table.options.selectableRows)if(this.table.options.selectableRowsRollingSelection)this._deselectRow(this.selectedRows[0]);else return!1;var n=this.table.rowManager.findRow(e);if(n){if(this.selectedRows.indexOf(n)==-1)return n.getElement().classList.add("tabulator-selected"),n.modules.select||(n.modules.select={}),n.modules.select.selected=!0,n.modules.select.checkboxEl&&(n.modules.select.checkboxEl.checked=!0),this.selectedRows.push(n),this.table.options.dataTreeSelectPropagate&&this.childRowSelection(n,!0),this.dispatchExternal("rowSelected",n.getComponent()),this._rowSelectionChanged(i,n),n}else i||console.warn("Selection Error - No such row found, ignoring selection:"+e)}isRowSelected(e){return this.selectedRows.indexOf(e)!==-1}deselectRows(e,i){var r=[],n,a;switch(typeof e){case"undefined":n=Object.assign([],this.selectedRows);break;case"number":n=this.table.rowManager.findRow(e);break;case"string":n=this.table.rowManager.findRow(e),n||(n=this.table.rowManager.getRows(e));break;default:n=e;break}Array.isArray(n)?n.length&&(n.forEach(s=>{a=this._deselectRow(s,!0,!0),a&&r.push(a)}),this._rowSelectionChanged(i,[],r)):n&&this._deselectRow(n,i,!0)}_deselectRow(e,i){var r=this,n=r.table.rowManager.findRow(e),a,s;if(n){if(a=r.selectedRows.findIndex(function(o){return o==n}),a>-1)return s=n.getElement(),s&&s.classList.remove("tabulator-selected"),n.modules.select||(n.modules.select={}),n.modules.select.selected=!1,n.modules.select.checkboxEl&&(n.modules.select.checkboxEl.checked=!1),r.selectedRows.splice(a,1),this.table.options.dataTreeSelectPropagate&&this.childRowSelection(n,!1),this.dispatchExternal("rowDeselected",n.getComponent()),r._rowSelectionChanged(i,void 0,n),n}else i||console.warn("Deselection Error - No such row found, ignoring selection:"+e)}getSelectedData(){var e=[];return this.selectedRows.forEach(function(i){e.push(i.getData())}),e}getSelectedRows(){var e=[];return this.selectedRows.forEach(function(i){e.push(i.getComponent())}),e}_rowSelectionChanged(e,i=[],r=[]){this.headerCheckboxElement&&(this.selectedRows.length===0?(this.headerCheckboxElement.checked=!1,this.headerCheckboxElement.indeterminate=!1):this.table.rowManager.rows.length===this.selectedRows.length?(this.headerCheckboxElement.checked=!0,this.headerCheckboxElement.indeterminate=!1):(this.headerCheckboxElement.indeterminate=!0,this.headerCheckboxElement.checked=!1)),e||(Array.isArray(i)||(i=[i]),i=i.map(n=>n.getComponent()),Array.isArray(r)||(r=[r]),r=r.map(n=>n.getComponent()),this.dispatchExternal("rowSelectionChanged",this.getSelectedData(),this.getSelectedRows(),i,r))}registerRowSelectCheckbox(e,i){e._row.modules.select||(e._row.modules.select={}),e._row.modules.select.checkboxEl=i}registerHeaderSelectCheckbox(e){this.headerCheckboxElement=e}childRowSelection(e,i){var r=this.table.modules.dataTree.getChildren(e,!0,!0);if(i)for(let n of r)this._selectRow(n,!0);else for(let n of r)this._deselectRow(n,!0)}}class NNe{constructor(e){return this._range=e,new Proxy(this,{get:function(i,r,n){return typeof i[r]<"u"?i[r]:i._range.table.componentFunctionBinder.handle("range",i._range,r)}})}getElement(){return this._range.element}getData(){return this._range.getData()}getCells(){return this._range.getCells(!0,!0)}getStructuredCells(){return this._range.getStructuredCells()}getRows(){return this._range.getRows().map(e=>e.getComponent())}getColumns(){return this._range.getColumns().map(e=>e.getComponent())}getBounds(){return this._range.getBounds()}getTopEdge(){return this._range.top}getBottomEdge(){return this._range.bottom}getLeftEdge(){return this._range.left}getRightEdge(){return this._range.right}setBounds(e,i){this._range.destroyedGuard("setBounds")&&this._range.setBounds(e&&e._cell,i&&i._cell)}setStartBound(e){this._range.destroyedGuard("setStartBound")&&(this._range.setEndBound(e&&e._cell),this._range.rangeManager.layoutElement())}setEndBound(e){this._range.destroyedGuard("setEndBound")&&(this._range.setEndBound(e&&e._cell),this._range.rangeManager.layoutElement())}clearValues(){this._range.destroyedGuard("clearValues")&&this._range.clearValues()}remove(){this._range.destroyedGuard("remove")&&this._range.destroy(!0)}}class ANe extends Ra{constructor(e,i,r,n){super(e),this.rangeManager=i,this.element=null,this.initialized=!1,this.initializing={start:!1,end:!1},this.destroyed=!1,this.top=0,this.bottom=0,this.left=0,this.right=0,this.table=e,this.start={row:0,col:0},this.end={row:0,col:0},this.rangeManager.rowHeader&&(this.left=1,this.right=1,this.start.col=1,this.end.col=1),this.initElement(),setTimeout(()=>{this.initBounds(r,n)})}initElement(){this.element=document.createElement("div"),this.element.classList.add("tabulator-range")}initBounds(e,i){this._updateMinMax(),e&&this.setBounds(e,i||e)}setStart(e,i){(this.start.row!==e||this.start.col!==i)&&(this.start.row=e,this.start.col=i,this.initializing.start=!0,this._updateMinMax())}setEnd(e,i){(this.end.row!==e||this.end.col!==i)&&(this.end.row=e,this.end.col=i,this.initializing.end=!0,this._updateMinMax())}setBounds(e,i,r){e&&this.setStartBound(e),this.setEndBound(i||e),this.rangeManager.layoutElement(r)}setStartBound(e){var i,r;e.type==="column"?this.rangeManager.columnSelection&&this.setStart(0,e.getPosition()-1):(i=e.row.position-1,r=e.column.getPosition()-1,e.column===this.rangeManager.rowHeader?this.setStart(i,1):this.setStart(i,r))}setEndBound(e){var i=this._getTableRows().length,r,n,a;e.type==="column"?this.rangeManager.columnSelection&&(this.rangeManager.selecting==="column"?this.setEnd(i-1,e.getPosition()-1):this.rangeManager.selecting==="cell"&&this.setEnd(0,e.getPosition()-1)):(r=e.row.position-1,n=e.column.getPosition()-1,a=e.column===this.rangeManager.rowHeader,this.rangeManager.selecting==="row"?this.setEnd(r,this._getTableColumns().length-1):this.rangeManager.selecting!=="row"&&a?this.setEnd(r,0):this.rangeManager.selecting==="column"?this.setEnd(i-1,n):this.setEnd(r,n))}_updateMinMax(){this.top=Math.min(this.start.row,this.end.row),this.bottom=Math.max(this.start.row,this.end.row),this.left=Math.min(this.start.col,this.end.col),this.right=Math.max(this.start.col,this.end.col),this.initialized?this.dispatchExternal("rangeChanged",this.getComponent()):this.initializing.start&&this.initializing.end&&(this.initialized=!0,this.dispatchExternal("rangeAdded",this.getComponent()))}_getTableColumns(){return this.table.columnManager.getVisibleColumnsByIndex()}_getTableRows(){return this.table.rowManager.getDisplayRows().filter(e=>e.type==="row")}layout(){var e=this.table.rowManager.renderer.vDomTop,i=this.table.rowManager.renderer.vDomBottom,r=this.table.columnManager.renderer.leftCol,n=this.table.columnManager.renderer.rightCol,a,s,o,l,u,c,d,p,f,m;this.table.options.renderHorizontal==="virtual"&&this.rangeManager.rowHeader&&(n+=1),e==null&&(e=0),i==null&&(i=1/0),r==null&&(r=0),n==null&&(n=1/0),this.overlaps(r,e,n,i)&&(a=Math.max(this.top,e),s=Math.min(this.bottom,i),o=Math.max(this.left,r),l=Math.min(this.right,n),u=this.rangeManager.getCell(a,o),c=this.rangeManager.getCell(s,l),d=u.getElement(),p=c.getElement(),f=u.row.getElement(),m=c.row.getElement(),this.element.classList.add("tabulator-range-active"),this.table.rtl?(this.element.style.right=f.offsetWidth-d.offsetLeft-d.offsetWidth+"px",this.element.style.width=d.offsetLeft+d.offsetWidth-p.offsetLeft+"px"):(this.element.style.left=f.offsetLeft+d.offsetLeft+"px",this.element.style.width=p.offsetLeft+p.offsetWidth-d.offsetLeft+"px"),this.element.style.top=f.offsetTop+"px",this.element.style.height=m.offsetTop+m.offsetHeight-f.offsetTop+"px")}atTopLeft(e){return e.row.position-1===this.top&&e.column.getPosition()-1===this.left}atBottomRight(e){return e.row.position-1===this.bottom&&e.column.getPosition()-1===this.right}occupies(e){return this.occupiesRow(e.row)&&this.occupiesColumn(e.column)}occupiesRow(e){return this.top<=e.position-1&&e.position-1<=this.bottom}occupiesColumn(e){return this.left<=e.getPosition()-1&&e.getPosition()-1<=this.right}overlaps(e,i,r,n){return!(this.left>r||e>this.right||this.top>n||i>this.bottom)}getData(){var e=[],i=this.getRows(),r=this.getColumns();return i.forEach(n=>{var a=n.getData(),s={};r.forEach(o=>{s[o.field]=a[o.field]}),e.push(s)}),e}getCells(e,i){var r=[],n=this.getRows(),a=this.getColumns();return e?r=n.map(s=>{var o=[];return s.getCells().forEach(l=>{a.includes(l.column)&&o.push(i?l.getComponent():l)}),o}):n.forEach(s=>{s.getCells().forEach(o=>{a.includes(o.column)&&r.push(i?o.getComponent():o)})}),r}getStructuredCells(){return this.getCells(!0,!0)}getRows(){return this._getTableRows().slice(this.top,this.bottom+1)}getColumns(){return this._getTableColumns().slice(this.left,this.right+1)}clearValues(){var e=this.getCells(),i=this.table.options.selectableRangeClearCellsValue;this.table.blockRedraw(),e.forEach(r=>{r.setValue(i)}),this.table.restoreRedraw()}getBounds(e){var i=this.getCells(!1,e),r={start:null,end:null};return i.length?(r.start=i[0],r.end=i[i.length-1]):console.warn("No bounds defined on range"),r}getComponent(){return this.component||(this.component=new NNe(this)),this.component}destroy(e){this.destroyed=!0,this.element.remove(),e&&this.rangeManager.rangeRemoved(this),this.initialized&&this.dispatchExternal("rangeRemoved",this.getComponent())}destroyedGuard(e){return this.destroyed&&console.warn("You cannot call the "+e+" function on a destroyed range"),!this.destroyed}}var kNe={rangeJumpUp:["ctrl + 38","meta + 38"],rangeJumpDown:["ctrl + 40","meta + 40"],rangeJumpLeft:["ctrl + 37","meta + 37"],rangeJumpRight:["ctrl + 39","meta + 39"],rangeExpandUp:"shift + 38",rangeExpandDown:"shift + 40",rangeExpandLeft:"shift + 37",rangeExpandRight:"shift + 39",rangeExpandJumpUp:["ctrl + shift + 38","meta + shift + 38"],rangeExpandJumpDown:["ctrl + shift + 40","meta + shift + 40"],rangeExpandJumpLeft:["ctrl + shift + 37","meta + shift + 37"],rangeExpandJumpRight:["ctrl + shift + 39","meta + shift + 39"]},ONe={rangeJumpLeft:function(t){this.dispatch("keybinding-nav-range",t,"left",!0,!1)},rangeJumpRight:function(t){this.dispatch("keybinding-nav-range",t,"right",!0,!1)},rangeJumpUp:function(t){this.dispatch("keybinding-nav-range",t,"up",!0,!1)},rangeJumpDown:function(t){this.dispatch("keybinding-nav-range",t,"down",!0,!1)},rangeExpandLeft:function(t){this.dispatch("keybinding-nav-range",t,"left",!1,!0)},rangeExpandRight:function(t){this.dispatch("keybinding-nav-range",t,"right",!1,!0)},rangeExpandUp:function(t){this.dispatch("keybinding-nav-range",t,"up",!1,!0)},rangeExpandDown:function(t){this.dispatch("keybinding-nav-range",t,"down",!1,!0)},rangeExpandJumpLeft:function(t){this.dispatch("keybinding-nav-range",t,"left",!0,!0)},rangeExpandJumpRight:function(t){this.dispatch("keybinding-nav-range",t,"right",!0,!0)},rangeExpandJumpUp:function(t){this.dispatch("keybinding-nav-range",t,"up",!0,!0)},rangeExpandJumpDown:function(t){this.dispatch("keybinding-nav-range",t,"down",!0,!0)}},xNe={range:function(t){var e=[],i=this.table.modules.selectRange.activeRange,r=!1,n,a,s,o,l;return l=t.length,i&&(n=i.getBounds(),a=n.start,n.start===n.end&&(r=!0),a&&(e=this.table.rowManager.activeRows.slice(),s=e.indexOf(a.row),r?o=t.length:o=e.indexOf(n.end.row)-s+1,s>-1&&(this.table.blockRedraw(),e=e.slice(s,s+o),e.forEach((u,c)=>{u.updateData(t[c%l])}),this.table.restoreRedraw()))),e}},FNe={range:function(t){var e=[],i=[],r=this.table.modules.selectRange.activeRange,n=!1,a,s,o,l,u;return r&&(a=r.getBounds(),s=a.start,a.start===a.end&&(n=!0),s&&(t=t.split(`
`),t.forEach(function(c){e.push(c.split("	"))}),e.length&&(l=this.table.columnManager.getVisibleColumnsByIndex(),u=l.indexOf(s.column),u>-1)))?(n?o=e[0].length:o=l.indexOf(a.end.column)-u+1,l=l.slice(u,u+o),e.forEach(c=>{var d={},p=c.length;l.forEach(function(f,m){d[f.field]=c[m%p]}),i.push(d)}),i):!1}},LNe={range:function(){var t=this.modules.selectRange.selectedColumns();return this.columnManager.rowHeader&&t.unshift(this.columnManager.rowHeader),t}},_Ne={range:function(){return this.modules.selectRange.selectedRows()}},$Ne={keybindings:{bindings:kNe,actions:ONe},clipboard:{pasteActions:xNe,pasteParsers:FNe},export:{columnLookups:LNe,rowLookups:_Ne}};class BNe extends si{static moduleName="selectRange";static moduleInitOrder=1;static moduleExtensions=$Ne;constructor(e){super(e),this.selecting="cell",this.mousedown=!1,this.ranges=[],this.overlay=null,this.rowHeader=null,this.layoutChangeTimeout=null,this.columnSelection=!1,this.rowSelection=!1,this.maxRanges=0,this.activeRange=!1,this.blockKeydown=!1,this.keyDownEvent=this._handleKeyDown.bind(this),this.mouseUpEvent=this._handleMouseUp.bind(this),this.registerTableOption("selectableRange",!1),this.registerTableOption("selectableRangeColumns",!1),this.registerTableOption("selectableRangeRows",!1),this.registerTableOption("selectableRangeClearCells",!1),this.registerTableOption("selectableRangeClearCellsValue",void 0),this.registerTableOption("selectableRangeAutoFocus",!0),this.registerTableFunction("getRangesData",this.getRangesData.bind(this)),this.registerTableFunction("getRanges",this.getRanges.bind(this)),this.registerTableFunction("addRange",this.addRangeFromComponent.bind(this)),this.registerComponentFunction("cell","getRanges",this.cellGetRanges.bind(this)),this.registerComponentFunction("row","getRanges",this.rowGetRanges.bind(this)),this.registerComponentFunction("column","getRanges",this.colGetRanges.bind(this))}initialize(){this.options("selectableRange")&&(this.options("selectableRows")?console.warn("SelectRange functionality cannot be used in conjunction with row selection"):(this.maxRanges=this.options("selectableRange"),this.initializeTable(),this.initializeWatchers()),this.options("columns").findIndex(e=>e.frozen)>0&&console.warn("Having frozen column in arbitrary position with selectRange option may result in unpredictable behavior."),this.options("columns").filter(e=>e.frozen)>1&&console.warn("Having multiple frozen columns with selectRange option may result in unpredictable behavior."))}initializeTable(){this.overlay=document.createElement("div"),this.overlay.classList.add("tabulator-range-overlay"),this.rangeContainer=document.createElement("div"),this.rangeContainer.classList.add("tabulator-range-container"),this.activeRangeCellElement=document.createElement("div"),this.activeRangeCellElement.classList.add("tabulator-range-cell-active"),this.overlay.appendChild(this.rangeContainer),this.overlay.appendChild(this.activeRangeCellElement),this.table.rowManager.element.addEventListener("keydown",this.keyDownEvent),this.resetRanges(),this.table.rowManager.element.appendChild(this.overlay),this.table.columnManager.element.setAttribute("tabindex",0),this.table.element.classList.add("tabulator-ranges")}initializeWatchers(){this.columnSelection=this.options("selectableRangeColumns"),this.rowSelection=this.options("selectableRangeRows"),this.subscribe("column-init",this.initializeColumn.bind(this)),this.subscribe("column-mousedown",this.handleColumnMouseDown.bind(this)),this.subscribe("column-mousemove",this.handleColumnMouseMove.bind(this)),this.subscribe("column-resized",this.handleColumnResized.bind(this)),this.subscribe("column-moving",this.handleColumnMoving.bind(this)),this.subscribe("column-moved",this.handleColumnMoved.bind(this)),this.subscribe("column-width",this.layoutChange.bind(this)),this.subscribe("column-height",this.layoutChange.bind(this)),this.subscribe("column-resized",this.layoutChange.bind(this)),this.subscribe("columns-loaded",this.updateHeaderColumn.bind(this)),this.subscribe("cell-height",this.layoutChange.bind(this)),this.subscribe("cell-rendered",this.renderCell.bind(this)),this.subscribe("cell-mousedown",this.handleCellMouseDown.bind(this)),this.subscribe("cell-mousemove",this.handleCellMouseMove.bind(this)),this.subscribe("cell-click",this.handleCellClick.bind(this)),this.subscribe("cell-editing",this.handleEditingCell.bind(this)),this.subscribe("page-changed",this.redraw.bind(this)),this.subscribe("scroll-vertical",this.layoutChange.bind(this)),this.subscribe("scroll-horizontal",this.layoutChange.bind(this)),this.subscribe("data-destroy",this.tableDestroyed.bind(this)),this.subscribe("data-processed",this.resetRanges.bind(this)),this.subscribe("table-layout",this.layoutElement.bind(this)),this.subscribe("table-redraw",this.redraw.bind(this)),this.subscribe("table-destroy",this.tableDestroyed.bind(this)),this.subscribe("edit-editor-clear",this.finishEditingCell.bind(this)),this.subscribe("edit-blur",this.restoreFocus.bind(this)),this.subscribe("keybinding-nav-prev",this.keyNavigate.bind(this,"left")),this.subscribe("keybinding-nav-next",this.keyNavigate.bind(this,"right")),this.subscribe("keybinding-nav-left",this.keyNavigate.bind(this,"left")),this.subscribe("keybinding-nav-right",this.keyNavigate.bind(this,"right")),this.subscribe("keybinding-nav-up",this.keyNavigate.bind(this,"up")),this.subscribe("keybinding-nav-down",this.keyNavigate.bind(this,"down")),this.subscribe("keybinding-nav-range",this.keyNavigateRange.bind(this))}initializeColumn(e){this.columnSelection&&e.definition.headerSort&&this.options("headerSortClickElement")!=="icon"&&console.warn("Using column headerSort with selectableRangeColumns option may result in unpredictable behavior. Consider using headerSortClickElement: 'icon'."),e.modules.edit}updateHeaderColumn(){var e;this.rowSelection&&(this.rowHeader=this.table.columnManager.getVisibleColumnsByIndex()[0],this.rowHeader&&(this.rowHeader.definition.cssClass=this.rowHeader.definition.cssClass+" tabulator-range-row-header",this.rowHeader.definition.headerSort&&console.warn("Using column headerSort with selectableRangeRows option may result in unpredictable behavior"),this.rowHeader.definition.editor&&console.warn("Using column editor with selectableRangeRows option may result in unpredictable behavior"))),this.table.modules.frozenColumns&&this.table.modules.frozenColumns.active&&(e=this.table.modules.frozenColumns.getFrozenColumns(),(e.length>1||e.length===1&&e[0]!==this.rowHeader)&&console.warn("Using frozen columns that are not the range header in combination with the selectRange option may result in unpredictable behavior"))}getRanges(){return this.ranges.map(e=>e.getComponent())}getRangesData(){return this.ranges.map(e=>e.getData())}addRangeFromComponent(e,i){return e=e?e._cell:null,i=i?i._cell:null,this.addRange(e,i)}cellGetRanges(e){var i=[];return e.column===this.rowHeader?i=this.ranges.filter(r=>r.occupiesRow(e.row)):i=this.ranges.filter(r=>r.occupies(e)),i.map(r=>r.getComponent())}rowGetRanges(e){var i=this.ranges.filter(r=>r.occupiesRow(e));return i.map(r=>r.getComponent())}colGetRanges(e){var i=this.ranges.filter(r=>r.occupiesColumn(e));return i.map(r=>r.getComponent())}_handleMouseUp(e){this.mousedown=!1,document.removeEventListener("mouseup",this.mouseUpEvent)}_handleKeyDown(e){if(!this.blockKeydown&&(!this.table.modules.edit||this.table.modules.edit&&!this.table.modules.edit.currentCell)){if(e.key==="Enter"){if(this.table.modules.edit&&this.table.modules.edit.currentCell)return;this.table.modules.edit.editCell(this.getActiveCell()),e.preventDefault()}(e.key==="Backspace"||e.key==="Delete")&&this.options("selectableRangeClearCells")&&this.activeRange&&this.activeRange.clearValues()}}initializeFocus(e){var i;this.restoreFocus();try{document.selection?(i=document.body.createTextRange(),i.moveToElementText(e.getElement()),i.select()):window.getSelection&&(i=document.createRange(),i.selectNode(e.getElement()),window.getSelection().removeAllRanges(),window.getSelection().addRange(i))}catch{}}restoreFocus(e){return this.table.rowManager.element.focus(),!0}handleColumnResized(e){var i;this.selecting!=="column"&&this.selecting!=="all"||(i=this.ranges.some(r=>r.occupiesColumn(e)),i&&this.ranges.forEach(r=>{var n=r.getColumns(!0);n.forEach(a=>{a!==e&&a.setWidth(e.width)})}))}handleColumnMoving(e,i){this.resetRanges().setBounds(i),this.overlay.style.visibility="hidden"}handleColumnMoved(e,i,r){this.activeRange.setBounds(e),this.layoutElement()}handleColumnMouseDown(e,i){e.button===2&&(this.selecting==="column"||this.selecting==="all")&&this.activeRange.occupiesColumn(i)||this.table.options.movableColumns&&this.selecting==="column"&&this.activeRange.occupiesColumn(i)||(this.mousedown=!0,document.addEventListener("mouseup",this.mouseUpEvent),this.newSelection(e,i))}handleColumnMouseMove(e,i){i===this.rowHeader||!this.mousedown||this.selecting==="all"||this.activeRange.setBounds(!1,i,!0)}renderCell(e){var i=e.getElement(),r=this.ranges.findIndex(n=>n.occupies(e));i.classList.toggle("tabulator-range-selected",r!==-1),i.classList.toggle("tabulator-range-only-cell-selected",this.ranges.length===1&&this.ranges[0].atTopLeft(e)&&this.ranges[0].atBottomRight(e)),i.dataset.range=r}handleCellMouseDown(e,i){e.button===2&&(this.activeRange.occupies(i)||(this.selecting==="row"||this.selecting==="all")&&this.activeRange.occupiesRow(i.row))||(this.mousedown=!0,document.addEventListener("mouseup",this.mouseUpEvent),this.newSelection(e,i))}handleCellMouseMove(e,i){!this.mousedown||this.selecting==="all"||this.activeRange.setBounds(!1,i,!0)}handleCellClick(e,i){this.initializeFocus(i)}handleEditingCell(e){this.activeRange&&this.activeRange.setBounds(e)}finishEditingCell(){this.blockKeydown=!0,this.table.rowManager.element.focus(),setTimeout(()=>{this.blockKeydown=!1},10)}keyNavigate(e,i){this.navigate(!1,!1,e),i.preventDefault()}keyNavigateRange(e,i,r,n){this.navigate(r,n,i),e.preventDefault()}navigate(e,i,r){var n=!1,a,s,o,l,u,c,d,p,f,m,h;if(this.table.modules.edit&&this.table.modules.edit.currentCell)return!1;if(this.ranges.length>1&&(this.ranges=this.ranges.filter(g=>g===this.activeRange?(g.setEnd(g.start.row,g.start.col),!0):(g.destroy(),!1))),a=this.activeRange,o={top:a.top,bottom:a.bottom,left:a.left,right:a.right},s=i?a.end:a.start,l=s.row,u=s.col,e)switch(r){case"left":u=this.findJumpCellLeft(a.start.row,s.col);break;case"right":u=this.findJumpCellRight(a.start.row,s.col);break;case"up":l=this.findJumpCellUp(s.row,a.start.col);break;case"down":l=this.findJumpCellDown(s.row,a.start.col);break}else{if(i&&(this.selecting==="row"&&(r==="left"||r==="right")||this.selecting==="column"&&(r==="up"||r==="down")))return;switch(r){case"left":u=Math.max(u-1,0);break;case"right":u=Math.min(u+1,this.getTableColumns().length-1);break;case"up":l=Math.max(l-1,0);break;case"down":l=Math.min(l+1,this.getTableRows().length-1);break}}if(this.rowHeader&&u===0&&(u=1),i||a.setStart(l,u),a.setEnd(l,u),i||(this.selecting="cell"),n=o.top!==a.top||o.bottom!==a.bottom||o.left!==a.left||o.right!==a.right,n)return c=this.getRowByRangePos(a.end.row),d=this.getColumnByRangePos(a.end.col),p=c.getElement().getBoundingClientRect(),m=d.getElement().getBoundingClientRect(),f=this.table.rowManager.getElement().getBoundingClientRect(),h=this.table.columnManager.getElement().getBoundingClientRect(),p.top>=f.top&&p.bottom<=f.bottom||(c.getElement().parentNode&&d.getElement().parentNode?this.autoScroll(a,c.getElement(),d.getElement()):c.getComponent().scrollTo(void 0,!1)),m.left>=h.left+this.getRowHeaderWidth()&&m.right<=h.right||(c.getElement().parentNode&&d.getElement().parentNode?this.autoScroll(a,c.getElement(),d.getElement()):d.getComponent().scrollTo(void 0,!1)),this.layoutElement(),!0}rangeRemoved(e){this.ranges=this.ranges.filter(i=>i!==e),this.activeRange===e&&(this.ranges.length?this.activeRange=this.ranges[this.ranges.length-1]:this.addRange()),this.layoutElement()}findJumpRow(e,i,r,n,a){return r&&(i=i.reverse()),this.findJumpItem(n,a,i,function(s){return s.getData()[e.getField()]})}findJumpCol(e,i,r,n,a){return r&&(i=i.reverse()),this.findJumpItem(n,a,i,function(s){return e.getData()[s.getField()]})}findJumpItem(e,i,r,n){var a;for(let s of r){let o=n(s);if(e){if(a=s,o)break}else if(i){if(a=s,o)break}else if(o)a=s;else break}return a}findJumpCellLeft(e,i){var r=this.getRowByRangePos(e),n=this.getTableColumns(),a=this.isEmpty(r.getData()[n[i].getField()]),s=n[i-1]?this.isEmpty(r.getData()[n[i-1].getField()]):!1,o=this.rowHeader?n.slice(1,i):n.slice(0,i),l=this.findJumpCol(r,o,!0,a,s);return l?l.getPosition()-1:i}findJumpCellRight(e,i){var r=this.getRowByRangePos(e),n=this.getTableColumns(),a=this.isEmpty(r.getData()[n[i].getField()]),s=n[i+1]?this.isEmpty(r.getData()[n[i+1].getField()]):!1,o=this.findJumpCol(r,n.slice(i+1,n.length),!1,a,s);return o?o.getPosition()-1:i}findJumpCellUp(e,i){var r=this.getColumnByRangePos(i),n=this.getTableRows(),a=this.isEmpty(n[e].getData()[r.getField()]),s=n[e-1]?this.isEmpty(n[e-1].getData()[r.getField()]):!1,o=this.findJumpRow(r,n.slice(0,e),!0,a,s);return o?o.position-1:e}findJumpCellDown(e,i){var r=this.getColumnByRangePos(i),n=this.getTableRows(),a=this.isEmpty(n[e].getData()[r.getField()]),s=n[e+1]?this.isEmpty(n[e+1].getData()[r.getField()]):!1,o=this.findJumpRow(r,n.slice(e+1,n.length),!1,a,s);return o?o.position-1:e}newSelection(e,i){var r;if(i.type==="column"){if(!this.columnSelection)return;if(i===this.rowHeader){r=this.resetRanges(),this.selecting="all";var n,a=this.getCell(-1,-1);this.rowHeader?n=this.getCell(0,1):n=this.getCell(0,0),r.setBounds(n,a);return}else this.selecting="column"}else i.column===this.rowHeader?this.selecting="row":this.selecting="cell";e.shiftKey?this.activeRange.setBounds(!1,i):e.ctrlKey?this.addRange().setBounds(i):this.resetRanges().setBounds(i)}autoScroll(e,i,r){var n=this.table.rowManager.element,a,s,o,l;typeof i>"u"&&(i=this.getRowByRangePos(e.end.row).getElement()),typeof r>"u"&&(r=this.getColumnByRangePos(e.end.col).getElement()),a={left:r.offsetLeft,right:r.offsetLeft+r.offsetWidth,top:i.offsetTop,bottom:i.offsetTop+i.offsetHeight},s={left:n.scrollLeft+this.getRowHeaderWidth(),right:Math.ceil(n.scrollLeft+n.clientWidth),top:n.scrollTop,bottom:n.scrollTop+n.offsetHeight-this.table.rowManager.scrollbarWidth},o=s.left<a.left&&a.left<s.right&&s.left<a.right&&a.right<s.right,l=s.top<a.top&&a.top<s.bottom&&s.top<a.bottom&&a.bottom<s.bottom,o||(a.left<s.left?n.scrollLeft=a.left-this.getRowHeaderWidth():a.right>s.right&&(n.scrollLeft=Math.min(a.right-n.clientWidth,a.left-this.getRowHeaderWidth()))),l||(a.top<s.top?n.scrollTop=a.top:a.bottom>s.bottom&&(n.scrollTop=a.bottom-n.clientHeight))}layoutChange(){this.overlay.style.visibility="hidden",clearTimeout(this.layoutChangeTimeout),this.layoutChangeTimeout=setTimeout(this.layoutRanges.bind(this),200)}redraw(e){e&&(this.selecting="cell",this.resetRanges(),this.layoutElement())}layoutElement(e){var i;e?i=this.table.rowManager.getVisibleRows(!0):i=this.table.rowManager.getRows(),i.forEach(r=>{r.type==="row"&&(this.layoutRow(r),r.cells.forEach(n=>this.renderCell(n)))}),this.getTableColumns().forEach(r=>{this.layoutColumn(r)}),this.layoutRanges()}layoutRow(e){var i=e.getElement(),r=!1,n=this.ranges.some(a=>a.occupiesRow(e));this.selecting==="row"?r=n:this.selecting==="all"&&(r=!0),i.classList.toggle("tabulator-range-selected",r),i.classList.toggle("tabulator-range-highlight",n)}layoutColumn(e){var i=e.getElement(),r=!1,n=this.ranges.some(a=>a.occupiesColumn(e));this.selecting==="column"?r=n:this.selecting==="all"&&(r=!0),i.classList.toggle("tabulator-range-selected",r),i.classList.toggle("tabulator-range-highlight",n)}layoutRanges(){var e,i,r;this.table.initialized&&(e=this.getActiveCell(),e&&(i=e.getElement(),r=e.row.getElement(),this.table.rtl?this.activeRangeCellElement.style.right=r.offsetWidth-i.offsetLeft-i.offsetWidth+"px":this.activeRangeCellElement.style.left=r.offsetLeft+i.offsetLeft+"px",this.activeRangeCellElement.style.top=r.offsetTop+"px",this.activeRangeCellElement.style.width=i.offsetWidth+"px",this.activeRangeCellElement.style.height=r.offsetHeight+"px",this.ranges.forEach(n=>n.layout()),this.overlay.style.visibility="visible"))}getCell(e,i){var r;return i<0&&(i=this.getTableColumns().length+i,i<0)?null:(e<0&&(e=this.getTableRows().length+e),r=this.table.rowManager.getRowFromPosition(e+1),r?r.getCells(!1,!0).filter(n=>n.column.visible)[i]:null)}getActiveCell(){return this.getCell(this.activeRange.start.row,this.activeRange.start.col)}getRowByRangePos(e){return this.getTableRows()[e]}getColumnByRangePos(e){return this.getTableColumns()[e]}getTableRows(){return this.table.rowManager.getDisplayRows().filter(e=>e.type==="row")}getTableColumns(){return this.table.columnManager.getVisibleColumnsByIndex()}addRange(e,i){var r;return this.maxRanges!==!0&&this.ranges.length>=this.maxRanges&&this.ranges.shift().destroy(),r=new ANe(this.table,this,e,i),this.activeRange=r,this.ranges.push(r),this.rangeContainer.appendChild(r.element),r}resetRanges(){var e,i,r;return this.ranges.forEach(n=>n.destroy()),this.ranges=[],e=this.addRange(),this.table.rowManager.activeRows.length&&(r=this.table.rowManager.activeRows[0].cells.filter(n=>n.column.visible),i=r[this.rowHeader?1:0],i&&(e.setBounds(i),this.options("selectableRangeAutoFocus")&&this.initializeFocus(i))),e}tableDestroyed(){document.removeEventListener("mouseup",this.mouseUpEvent),this.table.rowManager.element.removeEventListener("keydown",this.keyDownEvent)}selectedRows(e){return e?this.activeRange.getRows().map(i=>i.getComponent()):this.activeRange.getRows()}selectedColumns(e){return e?this.activeRange.getColumns().map(i=>i.getComponent()):this.activeRange.getColumns()}getRowHeaderWidth(){return this.rowHeader?this.rowHeader.getElement().offsetWidth:0}isEmpty(e){return e==null||e===""}}function VNe(t,e,i,r,n,a,s){var o=s.alignEmptyValues,l=s.decimalSeparator,u=s.thousandSeparator,c=0;if(t=String(t),e=String(e),u&&(t=t.split(u).join(""),e=e.split(u).join("")),l&&(t=t.split(l).join("."),e=e.split(l).join(".")),t=parseFloat(t),e=parseFloat(e),isNaN(t))c=isNaN(e)?0:-1;else if(isNaN(e))c=1;else return t-e;return(o==="top"&&a==="desc"||o==="bottom"&&a==="asc")&&(c*=-1),c}function jNe(t,e,i,r,n,a,s){var o=s.alignEmptyValues,l=0,u;if(!t)l=e?-1:0;else if(!e)l=1;else{switch(typeof s.locale){case"boolean":s.locale&&(u=this.langLocale());break;case"string":u=s.locale;break}return String(t).toLowerCase().localeCompare(String(e).toLowerCase(),u)}return(o==="top"&&a==="desc"||o==="bottom"&&a==="asc")&&(l*=-1),l}function R$(t,e,i,r,n,a,s){var o=this.table.dependencyRegistry.lookup(["luxon","DateTime"],"DateTime"),l=s.format||"dd/MM/yyyy HH:mm:ss",u=s.alignEmptyValues,c=0;if(typeof o<"u"){if(o.isDateTime(t)||(l==="iso"?t=o.fromISO(String(t)):t=o.fromFormat(String(t),l)),o.isDateTime(e)||(l==="iso"?e=o.fromISO(String(e)):e=o.fromFormat(String(e),l)),!t.isValid)c=e.isValid?-1:0;else if(!e.isValid)c=1;else return t-e;return(u==="top"&&a==="desc"||u==="bottom"&&a==="asc")&&(c*=-1),c}else console.error("Sort Error - 'datetime' sorter is dependant on luxon.js")}function GNe(t,e,i,r,n,a,s){return s.format||(s.format="dd/MM/yyyy"),R$.call(this,t,e,i,r,n,a,s)}function HNe(t,e,i,r,n,a,s){return s.format||(s.format="HH:mm"),R$.call(this,t,e,i,r,n,a,s)}function WNe(t,e,i,r,n,a,s){var o=t===!0||t==="true"||t==="True"||t===1?1:0,l=e===!0||e==="true"||e==="True"||e===1?1:0;return o-l}function zNe(t,e,i,r,n,a,s){var o=s.type||"length",l=s.alignEmptyValues,u=0,c=this.table,d;s.valueMap&&(typeof s.valueMap=="string"?d=function(f){return f.map(m=>gr.retrieveNestedData(c.options.nestedFieldSeparator,s.valueMap,m))}:d=s.valueMap);function p(f){var m;switch(d&&(f=d(f)),o){case"length":m=f.length;break;case"sum":m=f.reduce(function(h,g){return h+g});break;case"max":m=Math.max.apply(null,f);break;case"min":m=Math.min.apply(null,f);break;case"avg":m=f.reduce(function(h,g){return h+g})/f.length;break;case"string":m=f.join("");break}return m}if(!Array.isArray(t))u=Array.isArray(e)?-1:0;else if(!Array.isArray(e))u=1;else return o==="string"?String(p(t)).toLowerCase().localeCompare(String(p(e)).toLowerCase()):p(e)-p(t);return(l==="top"&&a==="desc"||l==="bottom"&&a==="asc")&&(u*=-1),u}function qNe(t,e,i,r,n,a,s){var o=typeof t>"u"?0:1,l=typeof e>"u"?0:1;return o-l}function YNe(t,e,i,r,n,a,s){var o,l,u,c,d=0,p,f=/(\d+)|(\D+)/g,m=/\d/,h=s.alignEmptyValues,g=0;if(!t&&t!==0)g=!e&&e!==0?0:-1;else if(!e&&e!==0)g=1;else{if(isFinite(t)&&isFinite(e))return t-e;if(o=String(t).toLowerCase(),l=String(e).toLowerCase(),o===l)return 0;if(!(m.test(o)&&m.test(l)))return o>l?1:-1;for(o=o.match(f),l=l.match(f),p=o.length>l.length?l.length:o.length;d<p;)if(u=o[d],c=l[d++],u!==c)return isFinite(u)&&isFinite(c)?(u.charAt(0)==="0"&&(u="."+u),c.charAt(0)==="0"&&(c="."+c),u-c):u>c?1:-1;return o.length>l.length}return(h==="top"&&a==="desc"||h==="bottom"&&a==="asc")&&(g*=-1),g}var KNe={number:VNe,string:jNe,date:GNe,time:HNe,datetime:R$,boolean:WNe,array:zNe,exists:qNe,alphanum:YNe};class Vy extends si{static moduleName="sort";static sorters=KNe;constructor(e){super(e),this.sortList=[],this.changed=!1,this.registerTableOption("sortMode","local"),this.registerTableOption("initialSort",!1),this.registerTableOption("columnHeaderSortMulti",!0),this.registerTableOption("sortOrderReverse",!1),this.registerTableOption("headerSortElement","<div class='tabulator-arrow'></div>"),this.registerTableOption("headerSortClickElement","header"),this.registerColumnOption("sorter"),this.registerColumnOption("sorterParams"),this.registerColumnOption("headerSort",!0),this.registerColumnOption("headerSortStartingDir"),this.registerColumnOption("headerSortTristate")}initialize(){this.subscribe("column-layout",this.initializeColumn.bind(this)),this.subscribe("table-built",this.tableBuilt.bind(this)),this.registerDataHandler(this.sort.bind(this),20),this.registerTableFunction("setSort",this.userSetSort.bind(this)),this.registerTableFunction("getSorters",this.getSort.bind(this)),this.registerTableFunction("clearSort",this.clearSort.bind(this)),this.table.options.sortMode==="remote"&&this.subscribe("data-params",this.remoteSortParams.bind(this))}tableBuilt(){this.table.options.initialSort&&this.setSort(this.table.options.initialSort)}remoteSortParams(e,i,r,n){var a=this.getSort();return a.forEach(s=>{delete s.column}),n.sort=a,n}userSetSort(e,i){this.setSort(e,i),this.refreshSort()}clearSort(){this.clear(),this.refreshSort()}initializeColumn(e){var i=!1,r,n;switch(typeof e.definition.sorter){case"string":Vy.sorters[e.definition.sorter]?i=Vy.sorters[e.definition.sorter]:console.warn("Sort Error - No such sorter found: ",e.definition.sorter);break;case"function":i=e.definition.sorter;break}if(e.modules.sort={sorter:i,dir:"none",params:e.definition.sorterParams||{},startingDir:e.definition.headerSortStartingDir||"asc",tristate:e.definition.headerSortTristate},e.definition.headerSort!==!1){switch(r=e.getElement(),r.classList.add("tabulator-sortable"),n=document.createElement("div"),n.classList.add("tabulator-col-sorter"),this.table.options.headerSortClickElement){case"icon":n.classList.add("tabulator-col-sorter-element");break;case"header":r.classList.add("tabulator-col-sorter-element");break;default:r.classList.add("tabulator-col-sorter-element");break}switch(this.table.options.headerSortElement){case"function":break;case"object":n.appendChild(this.table.options.headerSortElement);break;default:n.innerHTML=this.table.options.headerSortElement}e.titleHolderElement.appendChild(n),e.modules.sort.element=n,this.setColumnHeaderSortIcon(e,"none"),this.table.options.headerSortClickElement==="icon"&&n.addEventListener("mousedown",a=>{a.stopPropagation()}),(this.table.options.headerSortClickElement==="icon"?n:r).addEventListener("click",a=>{var s="",o=[],l=!1;if(e.modules.sort){if(e.modules.sort.tristate)e.modules.sort.dir=="none"?s=e.modules.sort.startingDir:e.modules.sort.dir==e.modules.sort.startingDir?s=e.modules.sort.dir=="asc"?"desc":"asc":s="none";else switch(e.modules.sort.dir){case"asc":s="desc";break;case"desc":s="asc";break;default:s=e.modules.sort.startingDir}this.table.options.columnHeaderSortMulti&&(a.shiftKey||a.ctrlKey)?(o=this.getSort(),l=o.findIndex(u=>u.field===e.getField()),l>-1?(o[l].dir=s,l=o.splice(l,1)[0],s!="none"&&o.push(l)):s!="none"&&o.push({column:e,dir:s}),this.setSort(o)):s=="none"?this.clear():this.setSort(e,s),this.refreshSort()}})}}refreshSort(){this.table.options.sortMode==="remote"?this.reloadData(null,!1,!1):this.refreshData(!0)}hasChanged(){var e=this.changed;return this.changed=!1,e}getSort(){var e=this,i=[];return e.sortList.forEach(function(r){r.column&&i.push({column:r.column.getComponent(),field:r.column.getField(),dir:r.dir})}),i}setSort(e,i){var r=this,n=[];Array.isArray(e)||(e=[{column:e,dir:i}]),e.forEach(function(a){var s;s=r.table.columnManager.findColumn(a.column),s?(a.column=s,n.push(a),r.changed=!0):console.warn("Sort Warning - Sort field does not exist and is being ignored: ",a.column)}),r.sortList=n,this.dispatch("sort-changed")}clear(){this.setSort([])}findSorter(e){var i=this.table.rowManager.activeRows[0],r="string",n,a;if(i&&(i=i.getData(),n=e.getField(),n))switch(a=e.getFieldValue(i),typeof a){case"undefined":r="string";break;case"boolean":r="boolean";break;default:!isNaN(a)&&a!==""?r="number":a.match(/((^[0-9]+[a-z]+)|(^[a-z]+[0-9]+))+$/i)&&(r="alphanum");break}return Vy.sorters[r]}sort(e,i){var r=this,n=this.table.options.sortOrderReverse?r.sortList.slice().reverse():r.sortList,a=[],s=[];return this.subscribedExternal("dataSorting")&&this.dispatchExternal("dataSorting",r.getSort()),i||r.clearColumnHeaders(),this.table.options.sortMode!=="remote"?(n.forEach(function(o,l){var u;o.column&&(u=o.column.modules.sort,u&&(u.sorter||(u.sorter=r.findSorter(o.column)),o.params=typeof u.params=="function"?u.params(o.column.getComponent(),o.dir):u.params,a.push(o)),i||r.setColumnHeader(o.column,o.dir))}),a.length&&r._sortItems(e,a)):i||n.forEach(function(o,l){r.setColumnHeader(o.column,o.dir)}),this.subscribedExternal("dataSorted")&&(e.forEach(o=>{s.push(o.getComponent())}),this.dispatchExternal("dataSorted",r.getSort(),s)),e}clearColumnHeaders(){this.table.columnManager.getRealColumns().forEach(e=>{e.modules.sort&&(e.modules.sort.dir="none",e.getElement().setAttribute("aria-sort","none"),this.setColumnHeaderSortIcon(e,"none"))})}setColumnHeader(e,i){e.modules.sort.dir=i,e.getElement().setAttribute("aria-sort",i==="asc"?"ascending":"descending"),this.setColumnHeaderSortIcon(e,i)}setColumnHeaderSortIcon(e,i){var r=e.modules.sort.element,n;if(e.definition.headerSort&&typeof this.table.options.headerSortElement=="function"){for(;r.firstChild;)r.removeChild(r.firstChild);n=this.table.options.headerSortElement.call(this.table,e.getComponent(),i),typeof n=="object"?r.appendChild(n):r.innerHTML=n}}_sortItems(e,i){var r=i.length-1;e.sort((n,a)=>{for(var s,o=r;o>=0;o--){let l=i[o];if(s=this._sortRow(n,a,l.column,l.dir,l.params),s!==0)break}return s})}_sortRow(e,i,r,n,a){var s,o,l=n=="asc"?e:i,u=n=="asc"?i:e;return e=r.getFieldValue(l.getData()),i=r.getFieldValue(u.getData()),e=typeof e<"u"?e:"",i=typeof i<"u"?i:"",s=l.getComponent(),o=u.getComponent(),r.modules.sort.sorter.call(this,e,i,s,o,r.getComponent(),n,a)}}class XNe{constructor(e,i){this.columnCount=e,this.rowCount=i,this.columnString=[],this.columns=[],this.rows=[]}genColumns(e){var i=Math.max(this.columnCount,Math.max(...e.map(r=>r.length)));this.columnString=[],this.columns=[];for(let r=1;r<=i;r++)this.incrementChar(this.columnString.length-1),this.columns.push(this.columnString.join(""));return this.columns}genRows(e){var i=Math.max(this.rowCount,e.length);this.rows=[];for(let r=1;r<=i;r++)this.rows.push(r);return this.rows}incrementChar(e){let i=this.columnString[e];i?i!=="Z"?this.columnString[e]=String.fromCharCode(this.columnString[e].charCodeAt(0)+1):(this.columnString[e]="A",e?this.incrementChar(e-1):this.columnString.push("A")):this.columnString.push("A")}setRowCount(e){this.rowCount=e}setColumnCount(e){this.columnCount=e}}class see{constructor(e){return this._sheet=e,new Proxy(this,{get:function(i,r,n){return typeof i[r]<"u"?i[r]:i._sheet.table.componentFunctionBinder.handle("sheet",i._sheet,r)}})}getTitle(){return this._sheet.title}getKey(){return this._sheet.key}getDefinition(){return this._sheet.getDefinition()}getData(){return this._sheet.getData()}setData(e){return this._sheet.setData(e)}clear(){return this._sheet.clear()}remove(){return this._sheet.remove()}active(){return this._sheet.active()}setTitle(e){return this._sheet.setTitle(e)}setRows(e){return this._sheet.setRows(e)}setColumns(e){return this._sheet.setColumns(e)}}class QW extends Ra{constructor(e,i){super(e.table),this.spreadsheetManager=e,this.definition=i,this.title=this.definition.title||"",this.key=this.definition.key||this.definition.title,this.rowCount=this.definition.rows,this.columnCount=this.definition.columns,this.data=this.definition.data||[],this.element=null,this.isActive=!1,this.grid=new XNe(this.columnCount,this.rowCount),this.defaultColumnDefinition={width:100,headerHozAlign:"center",headerSort:!1},this.columnDefinition=Object.assign(this.defaultColumnDefinition,this.options("spreadsheetColumnDefinition")),this.columnDefs=[],this.rowDefs=[],this.columnFields=[],this.columns=[],this.rows=[],this.scrollTop=null,this.scrollLeft=null,this.initialize(),this.dispatchExternal("sheetAdded",this.getComponent())}initialize(){this.initializeElement(),this.initializeColumns(),this.initializeRows()}reinitialize(){this.initializeColumns(),this.initializeRows()}initializeElement(){this.element=document.createElement("div"),this.element.classList.add("tabulator-spreadsheet-tab"),this.element.innerText=this.title,this.element.addEventListener("click",()=>{this.spreadsheetManager.loadSheet(this)})}initializeColumns(){this.grid.setColumnCount(this.columnCount),this.columnFields=this.grid.genColumns(this.data),this.columnDefs=[],this.columnFields.forEach(e=>{var i=Object.assign({},this.columnDefinition);i.field=e,i.title=e,this.columnDefs.push(i)})}initializeRows(){var e;this.grid.setRowCount(this.rowCount),e=this.grid.genRows(this.data),this.rowDefs=[],e.forEach((i,r)=>{var n={_id:i},a=this.data[r];a&&a.forEach((s,o)=>{var l=this.columnFields[o];l&&(n[l]=s)}),this.rowDefs.push(n)})}unload(){this.isActive=!1,this.scrollTop=this.table.rowManager.scrollTop,this.scrollLeft=this.table.rowManager.scrollLeft,this.data=this.getData(!0),this.element.classList.remove("tabulator-spreadsheet-tab-active")}load(){var e=!this.isActive;this.isActive=!0,this.table.blockRedraw(),this.table.setData([]),this.table.setColumns(this.columnDefs),this.table.setData(this.rowDefs),this.table.restoreRedraw(),e&&this.scrollTop!==null&&(this.table.rowManager.element.scrollLeft=this.scrollLeft,this.table.rowManager.element.scrollTop=this.scrollTop),this.element.classList.add("tabulator-spreadsheet-tab-active"),this.dispatchExternal("sheetLoaded",this.getComponent())}getComponent(){return new see(this)}getDefinition(){return{title:this.title,key:this.key,rows:this.rowCount,columns:this.columnCount,data:this.getData()}}getData(e){var i=[],r,n,a;return this.rowDefs.forEach(s=>{var o=[];this.columnFields.forEach(l=>{o.push(s[l])}),i.push(o)}),!e&&!this.options("spreadsheetOutputFull")&&(r=i.map(s=>s.findLastIndex(o=>typeof o<"u")+1),n=Math.max(...r),a=r.findLastIndex(s=>s>0)+1,i=i.slice(0,a),i=i.map(s=>s.slice(0,n))),i}setData(e){this.data=e,this.reinitialize(),this.dispatchExternal("sheetUpdated",this.getComponent()),this.isActive&&this.load()}clear(){this.setData([])}setTitle(e){this.title=e,this.element.innerText=e,this.dispatchExternal("sheetUpdated",this.getComponent())}setRows(e){this.rowCount=e,this.initializeRows(),this.dispatchExternal("sheetUpdated",this.getComponent()),this.isActive&&this.load()}setColumns(e){this.columnCount=e,this.reinitialize(),this.dispatchExternal("sheetUpdated",this.getComponent()),this.isActive&&this.load()}remove(){this.spreadsheetManager.removeSheet(this)}destroy(){this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.dispatchExternal("sheetRemoved",this.getComponent())}active(){this.spreadsheetManager.loadSheet(this)}}class JNe extends si{static moduleName="spreadsheet";constructor(e){super(e),this.sheets=[],this.element=null,this.registerTableOption("spreadsheet",!1),this.registerTableOption("spreadsheetRows",50),this.registerTableOption("spreadsheetColumns",50),this.registerTableOption("spreadsheetColumnDefinition",{}),this.registerTableOption("spreadsheetOutputFull",!1),this.registerTableOption("spreadsheetData",!1),this.registerTableOption("spreadsheetSheets",!1),this.registerTableOption("spreadsheetSheetTabs",!1),this.registerTableOption("spreadsheetSheetTabsElement",!1),this.registerTableFunction("setSheets",this.setSheets.bind(this)),this.registerTableFunction("addSheet",this.addSheet.bind(this)),this.registerTableFunction("getSheets",this.getSheets.bind(this)),this.registerTableFunction("getSheetDefinitions",this.getSheetDefinitions.bind(this)),this.registerTableFunction("setSheetData",this.setSheetData.bind(this)),this.registerTableFunction("getSheet",this.getSheet.bind(this)),this.registerTableFunction("getSheetData",this.getSheetData.bind(this)),this.registerTableFunction("clearSheet",this.clearSheet.bind(this)),this.registerTableFunction("removeSheet",this.removeSheetFunc.bind(this)),this.registerTableFunction("activeSheet",this.activeSheetFunc.bind(this))}initialize(){this.options("spreadsheet")&&(this.subscribe("table-initialized",this.tableInitialized.bind(this)),this.subscribe("data-loaded",this.loadRemoteData.bind(this)),this.table.options.index="_id",this.options("spreadsheetData")&&this.options("spreadsheetSheets")&&(console.warn("You cannot use spreadsheetData and spreadsheetSheets at the same time, ignoring spreadsheetData"),this.table.options.spreadsheetData=!1),this.compatibilityCheck(),this.options("spreadsheetSheetTabs")&&this.initializeTabset())}compatibilityCheck(){this.options("data")&&console.warn("Do not use the data option when working with spreadsheets, use either spreadsheetData or spreadsheetSheets to pass data into the table"),this.options("pagination")&&console.warn("The spreadsheet module is not compatible with the pagination module"),this.options("groupBy")&&console.warn("The spreadsheet module is not compatible with the row grouping module"),this.options("responsiveCollapse")&&console.warn("The spreadsheet module is not compatible with the responsive collapse module")}initializeTabset(){this.element=document.createElement("div"),this.element.classList.add("tabulator-spreadsheet-tabs");var e=this.options("spreadsheetSheetTabsElement");e&&!(e instanceof HTMLElement)&&(e=document.querySelector(e),e||console.warn("Unable to find element matching spreadsheetSheetTabsElement selector:",this.options("spreadsheetSheetTabsElement"))),e?e.appendChild(this.element):this.footerAppend(this.element)}tableInitialized(){this.sheets.length?this.loadSheet(this.sheets[0]):this.options("spreadsheetSheets")?this.loadSheets(this.options("spreadsheetSheets")):this.options("spreadsheetData")&&this.loadData(this.options("spreadsheetData"))}loadRemoteData(e,i,r){return console.log("data",e,i,r),Array.isArray(e)?(this.table.dataLoader.clearAlert(),this.dispatchExternal("dataLoaded",e),!e.length||Array.isArray(e[0])?this.loadData(e):this.loadSheets(e)):console.error(`Spreadsheet Loading Error - Unable to process remote data due to invalid data type 
Expecting: array 
Received: `,typeof e,`
Data:     `,e),!1}loadData(e){var i={data:e};this.loadSheet(this.newSheet(i))}destroySheets(){this.sheets.forEach(e=>{e.destroy()}),this.sheets=[],this.activeSheet=null}loadSheets(e){Array.isArray(e)||(e=[]),this.destroySheets(),e.forEach(i=>{this.newSheet(i)}),this.loadSheet(this.sheets[0])}loadSheet(e){this.activeSheet!==e&&(this.activeSheet&&this.activeSheet.unload(),this.activeSheet=e,e.load())}newSheet(e={}){var i;return e.rows||(e.rows=this.options("spreadsheetRows")),e.columns||(e.columns=this.options("spreadsheetColumns")),i=new QW(this,e),this.sheets.push(i),this.element&&this.element.appendChild(i.element),i}removeSheet(e){var i=this.sheets.indexOf(e),r;this.sheets.length>1?i>-1&&(this.sheets.splice(i,1),e.destroy(),this.activeSheet===e&&(r=this.sheets[i-1]||this.sheets[0],r?this.loadSheet(r):this.activeSheet=null)):console.warn("Unable to remove sheet, at least one sheet must be active")}lookupSheet(e){return e?e instanceof QW?e:e instanceof see?e._sheet:this.sheets.find(i=>i.key===e)||!1:this.activeSheet}setSheets(e){return this.loadSheets(e),this.getSheets()}addSheet(e){return this.newSheet(e).getComponent()}getSheetDefinitions(){return this.sheets.map(e=>e.getDefinition())}getSheets(){return this.sheets.map(e=>e.getComponent())}getSheet(e){var i=this.lookupSheet(e);return i?i.getComponent():!1}setSheetData(e,i){e&&!i&&(i=e,e=!1);var r=this.lookupSheet(e);return r?r.setData(i):!1}getSheetData(e){var i=this.lookupSheet(e);return i?i.getData():!1}clearSheet(e){var i=this.lookupSheet(e);return i?i.clear():!1}removeSheetFunc(e){var i=this.lookupSheet(e);i&&this.removeSheet(i)}activeSheetFunc(e){var i=this.lookupSheet(e);return i?this.loadSheet(i):!1}}class QNe extends si{static moduleName="tooltip";constructor(e){super(e),this.tooltipSubscriber=null,this.headerSubscriber=null,this.timeout=null,this.popupInstance=null,this.registerTableOption("tooltipDelay",300),this.registerColumnOption("tooltip"),this.registerColumnOption("headerTooltip")}initialize(){this.deprecatedOptionsCheck(),this.subscribe("column-init",this.initializeColumn.bind(this))}deprecatedOptionsCheck(){}initializeColumn(e){e.definition.headerTooltip&&!this.headerSubscriber&&(this.headerSubscriber=!0,this.subscribe("column-mousemove",this.mousemoveCheck.bind(this,"headerTooltip")),this.subscribe("column-mouseout",this.mouseoutCheck.bind(this,"headerTooltip"))),e.definition.tooltip&&!this.tooltipSubscriber&&(this.tooltipSubscriber=!0,this.subscribe("cell-mousemove",this.mousemoveCheck.bind(this,"tooltip")),this.subscribe("cell-mouseout",this.mouseoutCheck.bind(this,"tooltip")))}mousemoveCheck(e,i,r){var n=e==="tooltip"?r.column.definition.tooltip:r.definition.headerTooltip;n&&(this.clearPopup(),this.timeout=setTimeout(this.loadTooltip.bind(this,i,r,n),this.table.options.tooltipDelay))}mouseoutCheck(e,i,r){this.popupInstance||this.clearPopup()}clearPopup(e,i,r){clearTimeout(this.timeout),this.timeout=null,this.popupInstance&&this.popupInstance.hide()}loadTooltip(e,i,r){var n,a,s;function o(l){a=l}typeof r=="function"&&(r=r(e,i.getComponent(),o)),r instanceof HTMLElement?n=r:(n=document.createElement("div"),r===!0&&(i instanceof $S?r=i.value:i.definition.field?this.langBind("columns|"+i.definition.field,l=>{n.innerHTML=r=l||i.definition.title}):r=i.definition.title),n.innerHTML=r),(r||r===0||r===!1)&&(n.classList.add("tabulator-tooltip"),n.addEventListener("mousemove",l=>l.preventDefault()),this.popupInstance=this.popup(n),typeof a=="function"&&this.popupInstance.renderCallback(a),s=this.popupInstance.containerEventCoords(e),this.popupInstance.show(s.x+15,s.y+15).hideOnBlur(()=>{this.dispatchExternal("TooltipClosed",i.getComponent()),this.popupInstance=null}),this.dispatchExternal("TooltipOpened",i.getComponent()))}}var ZNe={integer:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:(e=Number(e),!isNaN(e)&&isFinite(e)&&Math.floor(e)===e)},float:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:(e=Number(e),!isNaN(e)&&isFinite(e)&&e%1!==0)},numeric:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:!isNaN(e)},string:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:isNaN(e)},alphanumeric:function(t,e,i){if(e===""||e===null||typeof e>"u")return!0;var r=new RegExp(/^[a-z0-9]+$/i);return r.test(e)},max:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:parseFloat(e)<=i},min:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:parseFloat(e)>=i},starts:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:String(e).toLowerCase().startsWith(String(i).toLowerCase())},ends:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:String(e).toLowerCase().endsWith(String(i).toLowerCase())},minLength:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:String(e).length>=i},maxLength:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:String(e).length<=i},in:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:(typeof i=="string"&&(i=i.split("|")),i.indexOf(e)>-1)},regex:function(t,e,i){if(e===""||e===null||typeof e>"u")return!0;var r=new RegExp(i);return r.test(e)},unique:function(t,e,i){if(e===""||e===null||typeof e>"u")return!0;var r=!0,n=t.getData(),a=t.getColumn()._getSelf();return this.table.rowManager.rows.forEach(function(s){var o=s.getData();o!==n&&e==a.getFieldValue(o)&&(r=!1)}),r},required:function(t,e,i){return e!==""&&e!==null&&typeof e<"u"}};class C$ extends si{static moduleName="validate";static validators=ZNe;constructor(e){super(e),this.invalidCells=[],this.registerTableOption("validationMode","blocking"),this.registerColumnOption("validator"),this.registerTableFunction("getInvalidCells",this.getInvalidCells.bind(this)),this.registerTableFunction("clearCellValidation",this.userClearCellValidation.bind(this)),this.registerTableFunction("validate",this.userValidate.bind(this)),this.registerComponentFunction("cell","isValid",this.cellIsValid.bind(this)),this.registerComponentFunction("cell","clearValidation",this.clearValidation.bind(this)),this.registerComponentFunction("cell","validate",this.cellValidate.bind(this)),this.registerComponentFunction("column","validate",this.columnValidate.bind(this)),this.registerComponentFunction("row","validate",this.rowValidate.bind(this))}initialize(){this.subscribe("cell-delete",this.clearValidation.bind(this)),this.subscribe("column-layout",this.initializeColumnCheck.bind(this)),this.subscribe("edit-success",this.editValidate.bind(this)),this.subscribe("edit-editor-clear",this.editorClear.bind(this)),this.subscribe("edit-edited-clear",this.editedClear.bind(this))}editValidate(e,i,r){var n=this.table.options.validationMode!=="manual"?this.validate(e.column.modules.validate,e,i):!0;return n!==!0&&setTimeout(()=>{e.getElement().classList.add("tabulator-validation-fail"),this.dispatchExternal("validationFailed",e.getComponent(),i,n)}),n}editorClear(e,i){i&&e.column.modules.validate&&this.cellValidate(e),e.getElement().classList.remove("tabulator-validation-fail")}editedClear(e){e.modules.validate&&(e.modules.validate.invalid=!1)}cellIsValid(e){return e.modules.validate&&e.modules.validate.invalid||!0}cellValidate(e){return this.validate(e.column.modules.validate,e,e.getValue())}columnValidate(e){var i=[];return e.cells.forEach(r=>{this.cellValidate(r)!==!0&&i.push(r.getComponent())}),i.length?i:!0}rowValidate(e){var i=[];return e.cells.forEach(r=>{this.cellValidate(r)!==!0&&i.push(r.getComponent())}),i.length?i:!0}userClearCellValidation(e){e||(e=this.getInvalidCells()),Array.isArray(e)||(e=[e]),e.forEach(i=>{this.clearValidation(i._getSelf())})}userValidate(e){var i=[];return this.table.rowManager.rows.forEach(r=>{r=r.getComponent();var n=r.validate();n!==!0&&(i=i.concat(n))}),i.length?i:!0}initializeColumnCheck(e){typeof e.definition.validator<"u"&&this.initializeColumn(e)}initializeColumn(e){var i=this,r=[],n;e.definition.validator&&(Array.isArray(e.definition.validator)?e.definition.validator.forEach(a=>{n=i._extractValidator(a),n&&r.push(n)}):(n=this._extractValidator(e.definition.validator),n&&r.push(n)),e.modules.validate=r.length?r:!1)}_extractValidator(e){var i,r,n;switch(typeof e){case"string":return n=e.indexOf(":"),n>-1?(i=e.substring(0,n),r=e.substring(n+1)):i=e,this._buildValidator(i,r);case"function":return this._buildValidator(e);case"object":return this._buildValidator(e.type,e.parameters)}}_buildValidator(e,i){var r=typeof e=="function"?e:C$.validators[e];return r?{type:typeof e=="function"?"function":e,func:r,params:i}:(console.warn("Validator Setup Error - No matching validator found:",e),!1)}validate(e,i,r){var n=this,a=[],s=this.invalidCells.indexOf(i);return e&&e.forEach(o=>{o.func.call(n,i.getComponent(),r,o.params)||a.push({type:o.type,parameters:o.params})}),i.modules.validate||(i.modules.validate={}),a.length?(i.modules.validate.invalid=a,this.table.options.validationMode!=="manual"&&i.getElement().classList.add("tabulator-validation-fail"),s==-1&&this.invalidCells.push(i)):(i.modules.validate.invalid=!1,i.getElement().classList.remove("tabulator-validation-fail"),s>-1&&this.invalidCells.splice(s,1)),a.length?a:!0}getInvalidCells(){var e=[];return this.invalidCells.forEach(i=>{e.push(i.getComponent())}),e}clearValidation(e){var i;e.modules.validate&&e.modules.validate.invalid&&(e.getElement().classList.remove("tabulator-validation-fail"),e.modules.validate.invalid=!1,i=this.invalidCells.indexOf(e),i>-1&&this.invalidCells.splice(i,1))}}var VA=Object.freeze({__proto__:null,AccessorModule:hP,AjaxModule:Eg,ClipboardModule:gP,ColumnCalcsModule:Rg,DataTreeModule:JCe,DownloadModule:IP,EditModule:D$,ExportModule:$y,FilterModule:Gf,FormatModule:Cg,FrozenColumnsModule:WMe,FrozenRowsModule:zMe,GroupRowsModule:YMe,HistoryModule:vP,HtmlTableImportModule:eNe,ImportModule:P$,InteractionModule:sNe,KeybindingsModule:By,MenuModule:uNe,MoveColumnsModule:cNe,MoveRowsModule:yP,MutatorModule:bP,PageModule:E$,PersistenceModule:_u,PopupModule:yNe,PrintModule:bNe,ReactiveDataModule:wNe,ResizeColumnsModule:SNe,ResizeRowsModule:UNe,ResizeTableModule:TNe,ResponsiveLayoutModule:ENe,SelectRangeModule:BNe,SelectRowModule:MNe,SortModule:Vy,SpreadsheetModule:JNe,TooltipModule:QNe,ValidateModule:C$}),eAe={debugEventsExternal:!1,debugEventsInternal:!1,debugInvalidOptions:!0,debugInvalidComponentFuncs:!0,debugInitialization:!0,debugDeprecation:!0,height:!1,minHeight:!1,maxHeight:!1,columnHeaderVertAlign:"top",popupContainer:!1,columns:[],columnDefaults:{},rowHeader:!1,data:!1,autoColumns:!1,autoColumnsDefinitions:!1,nestedFieldSeparator:".",footerElement:!1,index:"id",textDirection:"auto",addRowPos:"bottom",headerVisible:!0,renderVertical:"virtual",renderHorizontal:"basic",renderVerticalBuffer:0,scrollToRowPosition:"top",scrollToRowIfVisible:!0,scrollToColumnPosition:"left",scrollToColumnIfVisible:!0,rowFormatter:!1,rowFormatterPrint:null,rowFormatterClipboard:null,rowFormatterHtmlOutput:null,rowHeight:null,placeholder:!1,dataLoader:!0,dataLoaderLoading:!1,dataLoaderError:!1,dataLoaderErrorTimeout:3e3,dataSendParams:{},dataReceiveParams:{},dependencies:{}};class oee{constructor(e,i,r={}){this.table=e,this.msgType=i,this.registeredDefaults=Object.assign({},r)}register(e,i){this.registeredDefaults[e]=i}generate(e,i={}){var r=Object.assign({},this.registeredDefaults),n=this.table.options.debugInvalidOptions||i.debugInvalidOptions===!0;Object.assign(r,e);for(let a in i)r.hasOwnProperty(a)||(n&&console.warn("Invalid "+this.msgType+" option:",a),r[a]=i.key);for(let a in r)a in i?r[a]=i[a]:Array.isArray(r[a])?r[a]=Object.assign([],r[a]):typeof r[a]=="object"&&r[a]!==null?r[a]=Object.assign({},r[a]):typeof r[a]>"u"&&delete r[a];return r}}class YC extends Ra{constructor(e){super(e),this.elementVertical=e.rowManager.element,this.elementHorizontal=e.columnManager.element,this.tableElement=e.rowManager.tableElement,this.verticalFillMode="fit"}initialize(){}clearRows(){}clearColumns(){}reinitializeColumnWidths(e){}renderRows(){}renderColumns(){}rerenderRows(e){e&&e()}rerenderColumns(e,i){}renderRowCells(e){}rerenderRowCells(e,i){}scrollColumns(e,i){}scrollRows(e,i){}resize(){}scrollToRow(e){}scrollToRowNearestTop(e){}visibleRows(e){return[]}rows(){return this.table.rowManager.getDisplayRows()}styleRow(e,i){var r=e.getElement();i%2?(r.classList.add("tabulator-row-even"),r.classList.remove("tabulator-row-odd")):(r.classList.add("tabulator-row-odd"),r.classList.remove("tabulator-row-even"))}clear(){this.clearRows(),this.clearColumns()}render(){this.renderRows(),this.renderColumns()}rerender(e){this.rerenderRows(),this.rerenderColumns()}scrollToRowPosition(e,i,r){var n=this.rows().indexOf(e),a=e.getElement(),s=0;return new Promise((o,l)=>{if(n>-1){if(typeof r>"u"&&(r=this.table.options.scrollToRowIfVisible),!r&&gr.elVisible(a)&&(s=gr.elOffset(a).top-gr.elOffset(this.elementVertical).top,s>0&&s<this.elementVertical.clientHeight-a.offsetHeight))return o(),!1;switch(typeof i>"u"&&(i=this.table.options.scrollToRowPosition),i==="nearest"&&(i=this.scrollToRowNearestTop(e)?"top":"bottom"),this.scrollToRow(e),i){case"middle":case"center":this.elementVertical.scrollHeight-this.elementVertical.scrollTop==this.elementVertical.clientHeight?this.elementVertical.scrollTop=this.elementVertical.scrollTop+(a.offsetTop-this.elementVertical.scrollTop)-(this.elementVertical.scrollHeight-a.offsetTop)/2:this.elementVertical.scrollTop=this.elementVertical.scrollTop-this.elementVertical.clientHeight/2;break;case"bottom":this.elementVertical.scrollHeight-this.elementVertical.scrollTop==this.elementVertical.clientHeight?this.elementVertical.scrollTop=this.elementVertical.scrollTop-(this.elementVertical.scrollHeight-a.offsetTop)+a.offsetHeight:this.elementVertical.scrollTop=this.elementVertical.scrollTop-this.elementVertical.clientHeight+a.offsetHeight;break;case"top":this.elementVertical.scrollTop=a.offsetTop;break}o()}else console.warn("Scroll Error - Row not visible"),l("Scroll Error - Row not visible")})}}class tAe extends YC{constructor(e){super(e)}renderRowCells(e,i){const r=document.createDocumentFragment();e.cells.forEach(n=>{r.appendChild(n.getElement())}),e.element.appendChild(r),i||e.cells.forEach(n=>{n.cellRendered()})}reinitializeColumnWidths(e){e.forEach(function(i){i.reinitializeWidth()})}}class iAe extends YC{constructor(e){super(e),this.leftCol=0,this.rightCol=0,this.scrollLeft=0,this.vDomScrollPosLeft=0,this.vDomScrollPosRight=0,this.vDomPadLeft=0,this.vDomPadRight=0,this.fitDataColAvg=0,this.windowBuffer=200,this.visibleRows=null,this.initialized=!1,this.isFitData=!1,this.columns=[]}initialize(){this.compatibilityCheck(),this.layoutCheck(),this.vertScrollListen()}compatibilityCheck(){this.options("layout")=="fitDataTable"&&console.warn("Horizontal Virtual DOM is not compatible with fitDataTable layout mode"),this.options("responsiveLayout")&&console.warn("Horizontal Virtual DOM is not compatible with responsive columns"),this.options("rtl")&&console.warn("Horizontal Virtual DOM is not currently compatible with RTL text direction")}layoutCheck(){this.isFitData=this.options("layout").startsWith("fitData")}vertScrollListen(){this.subscribe("scroll-vertical",this.clearVisRowCache.bind(this)),this.subscribe("data-refreshed",this.clearVisRowCache.bind(this))}clearVisRowCache(){this.visibleRows=null}renderColumns(e,i){this.dataChange()}scrollColumns(e,i){this.scrollLeft!=e&&(this.scrollLeft=e,this.scroll(e-(this.vDomScrollPosLeft+this.windowBuffer)))}calcWindowBuffer(){var e=this.elementVertical.clientWidth;this.table.columnManager.columnsByIndex.forEach(i=>{if(i.visible){var r=i.getWidth();r>e&&(e=r)}}),this.windowBuffer=e*2}rerenderColumns(e,i){var r={cols:this.columns,leftCol:this.leftCol,rightCol:this.rightCol},n=0;e&&!this.initialized||(this.clear(),this.calcWindowBuffer(),this.scrollLeft=this.elementVertical.scrollLeft,this.vDomScrollPosLeft=this.scrollLeft-this.windowBuffer,this.vDomScrollPosRight=this.scrollLeft+this.elementVertical.clientWidth+this.windowBuffer,this.table.columnManager.columnsByIndex.forEach(a=>{var s={},o;a.visible&&(a.modules.frozen||(o=a.getWidth(),s.leftPos=n,s.rightPos=n+o,s.width=o,this.isFitData&&(s.fitDataCheck=a.modules.vdomHoz?a.modules.vdomHoz.fitDataCheck:!0),n+o>this.vDomScrollPosLeft&&n<this.vDomScrollPosRight?(this.leftCol==-1&&(this.leftCol=this.columns.length,this.vDomPadLeft=n),this.rightCol=this.columns.length):this.leftCol!==-1&&(this.vDomPadRight+=o),this.columns.push(a),a.modules.vdomHoz=s,n+=o))}),this.tableElement.style.paddingLeft=this.vDomPadLeft+"px",this.tableElement.style.paddingRight=this.vDomPadRight+"px",this.initialized=!0,i||(!e||this.reinitChanged(r))&&this.reinitializeRows(),this.elementVertical.scrollLeft=this.scrollLeft)}renderRowCells(e){if(this.initialized)this.initializeRow(e);else{const i=document.createDocumentFragment();e.cells.forEach(r=>{i.appendChild(r.getElement())}),e.element.appendChild(i),e.cells.forEach(r=>{r.cellRendered()})}}rerenderRowCells(e,i){this.reinitializeRow(e,i)}reinitializeColumnWidths(e){for(let i=this.leftCol;i<=this.rightCol;i++){let r=this.columns[i];r&&r.reinitializeWidth()}}deinitialize(){this.initialized=!1}clear(){this.columns=[],this.leftCol=-1,this.rightCol=0,this.vDomScrollPosLeft=0,this.vDomScrollPosRight=0,this.vDomPadLeft=0,this.vDomPadRight=0}dataChange(){var e=!1,i,r;if(this.isFitData){if(this.table.columnManager.columnsByIndex.forEach(n=>{!n.definition.width&&n.visible&&(e=!0)}),e&&this.table.rowManager.getDisplayRows().length&&(this.vDomScrollPosRight=this.scrollLeft+this.elementVertical.clientWidth+this.windowBuffer,i=this.chain("rows-sample",[1],[],()=>this.table.rowManager.getDisplayRows())[0],i)){r=i.getElement(),i.generateCells(),this.tableElement.appendChild(r);for(let n=0;n<i.cells.length;n++){let a=i.cells[n];r.appendChild(a.getElement()),a.column.reinitializeWidth()}r.parentNode.removeChild(r),this.rerenderColumns(!1,!0)}}else this.options("layout")==="fitColumns"&&(this.layoutRefresh(),this.rerenderColumns(!1,!0))}reinitChanged(e){var i=!0;return e.cols.length!==this.columns.length||e.leftCol!==this.leftCol||e.rightCol!==this.rightCol?!0:(e.cols.forEach((r,n)=>{r!==this.columns[n]&&(i=!1)}),!i)}reinitializeRows(){var e=this.getVisibleRows(),i=this.table.rowManager.getRows().filter(r=>!e.includes(r));e.forEach(r=>{this.reinitializeRow(r,!0)}),i.forEach(r=>{r.deinitialize()})}getVisibleRows(){return this.visibleRows||(this.visibleRows=this.table.rowManager.getVisibleRows()),this.visibleRows}scroll(e){this.vDomScrollPosLeft+=e,this.vDomScrollPosRight+=e,Math.abs(e)>this.windowBuffer/2?this.rerenderColumns():e>0?(this.addColRight(),this.removeColLeft()):(this.addColLeft(),this.removeColRight())}colPositionAdjust(e,i,r){for(let n=e;n<i;n++){let a=this.columns[n];a.modules.vdomHoz.leftPos+=r,a.modules.vdomHoz.rightPos+=r}}addColRight(){for(var e=!1,i=!0;i;){let r=this.columns[this.rightCol+1];r&&r.modules.vdomHoz.leftPos<=this.vDomScrollPosRight?(e=!0,this.getVisibleRows().forEach(n=>{if(n.type!=="group"){var a=n.getCell(r);n.getElement().insertBefore(a.getElement(),n.getCell(this.columns[this.rightCol]).getElement().nextSibling),a.cellRendered()}}),this.fitDataColActualWidthCheck(r),this.rightCol++,this.getVisibleRows().forEach(n=>{n.type!=="group"&&(n.modules.vdomHoz.rightCol=this.rightCol)}),this.rightCol>=this.columns.length-1?this.vDomPadRight=0:this.vDomPadRight-=r.getWidth()):i=!1}e&&(this.tableElement.style.paddingRight=this.vDomPadRight+"px")}addColLeft(){for(var e=!1,i=!0;i;){let r=this.columns[this.leftCol-1];if(r)if(r.modules.vdomHoz.rightPos>=this.vDomScrollPosLeft){e=!0,this.getVisibleRows().forEach(a=>{if(a.type!=="group"){var s=a.getCell(r);a.getElement().insertBefore(s.getElement(),a.getCell(this.columns[this.leftCol]).getElement()),s.cellRendered()}}),this.leftCol--,this.getVisibleRows().forEach(a=>{a.type!=="group"&&(a.modules.vdomHoz.leftCol=this.leftCol)}),this.leftCol<=0?this.vDomPadLeft=0:this.vDomPadLeft-=r.getWidth();let n=this.fitDataColActualWidthCheck(r);n&&(this.scrollLeft=this.elementVertical.scrollLeft=this.elementVertical.scrollLeft+n,this.vDomPadRight-=n)}else i=!1;else i=!1}e&&(this.tableElement.style.paddingLeft=this.vDomPadLeft+"px")}removeColRight(){for(var e=!1,i=!0;i;){let r=this.columns[this.rightCol];r&&r.modules.vdomHoz.leftPos>this.vDomScrollPosRight?(e=!0,this.getVisibleRows().forEach(n=>{if(n.type!=="group"){var a=n.getCell(r);try{n.getElement().removeChild(a.getElement())}catch(s){console.warn("Could not removeColRight",s.message)}}}),this.vDomPadRight+=r.getWidth(),this.rightCol--,this.getVisibleRows().forEach(n=>{n.type!=="group"&&(n.modules.vdomHoz.rightCol=this.rightCol)})):i=!1}e&&(this.tableElement.style.paddingRight=this.vDomPadRight+"px")}removeColLeft(){for(var e=!1,i=!0;i;){let r=this.columns[this.leftCol];r&&r.modules.vdomHoz.rightPos<this.vDomScrollPosLeft?(e=!0,this.getVisibleRows().forEach(n=>{if(n.type!=="group"){var a=n.getCell(r);try{n.getElement().removeChild(a.getElement())}catch(s){console.warn("Could not removeColLeft",s.message)}}}),this.vDomPadLeft+=r.getWidth(),this.leftCol++,this.getVisibleRows().forEach(n=>{n.type!=="group"&&(n.modules.vdomHoz.leftCol=this.leftCol)})):i=!1}e&&(this.tableElement.style.paddingLeft=this.vDomPadLeft+"px")}fitDataColActualWidthCheck(e){var i,r;return e.modules.vdomHoz.fitDataCheck&&(e.reinitializeWidth(),i=e.getWidth(),r=i-e.modules.vdomHoz.width,r&&(e.modules.vdomHoz.rightPos+=r,e.modules.vdomHoz.width=i,this.colPositionAdjust(this.columns.indexOf(e)+1,this.columns.length,r)),e.modules.vdomHoz.fitDataCheck=!1),r}initializeRow(e){if(e.type!=="group"){e.modules.vdomHoz={leftCol:this.leftCol,rightCol:this.rightCol},this.table.modules.frozenColumns&&this.table.modules.frozenColumns.leftColumns.forEach(i=>{this.appendCell(e,i)});for(let i=this.leftCol;i<=this.rightCol;i++)this.appendCell(e,this.columns[i]);this.table.modules.frozenColumns&&this.table.modules.frozenColumns.rightColumns.forEach(i=>{this.appendCell(e,i)})}}appendCell(e,i){if(i&&i.visible){let r=e.getCell(i);e.getElement().appendChild(r.getElement()),r.cellRendered()}}reinitializeRow(e,i){if(e.type!=="group"&&(i||!e.modules.vdomHoz||e.modules.vdomHoz.leftCol!==this.leftCol||e.modules.vdomHoz.rightCol!==this.rightCol)){for(var r=e.getElement();r.firstChild;)r.removeChild(r.firstChild);this.initializeRow(e)}}}class rAe extends Ra{constructor(e){super(e),this.blockHozScrollEvent=!1,this.headersElement=null,this.contentsElement=null,this.rowHeader=null,this.element=null,this.columns=[],this.columnsByIndex=[],this.columnsByField={},this.scrollLeft=0,this.optionsList=new oee(this.table,"column definition",aee),this.redrawBlock=!1,this.redrawBlockUpdate=null,this.renderer=null}initialize(){this.initializeRenderer(),this.headersElement=this.createHeadersElement(),this.contentsElement=this.createHeaderContentsElement(),this.element=this.createHeaderElement(),this.contentsElement.insertBefore(this.headersElement,this.contentsElement.firstChild),this.element.insertBefore(this.contentsElement,this.element.firstChild),this.initializeScrollWheelWatcher(),this.subscribe("scroll-horizontal",this.scrollHorizontal.bind(this)),this.subscribe("scrollbar-vertical",this.padVerticalScrollbar.bind(this))}padVerticalScrollbar(e){this.table.rtl?this.headersElement.style.marginLeft=e+"px":this.headersElement.style.marginRight=e+"px"}initializeRenderer(){var e,i={virtual:iAe,basic:tAe};typeof this.table.options.renderHorizontal=="string"?e=i[this.table.options.renderHorizontal]:e=this.table.options.renderHorizontal,e?(this.renderer=new e(this.table,this.element,this.tableElement),this.renderer.initialize()):console.error("Unable to find matching renderer:",this.table.options.renderHorizontal)}createHeadersElement(){var e=document.createElement("div");return e.classList.add("tabulator-headers"),e.setAttribute("role","row"),e}createHeaderContentsElement(){var e=document.createElement("div");return e.classList.add("tabulator-header-contents"),e.setAttribute("role","rowgroup"),e}createHeaderElement(){var e=document.createElement("div");return e.classList.add("tabulator-header"),e.setAttribute("role","rowgroup"),this.table.options.headerVisible||e.classList.add("tabulator-header-hidden"),e}getElement(){return this.element}getContentsElement(){return this.contentsElement}getHeadersElement(){return this.headersElement}scrollHorizontal(e){this.contentsElement.scrollLeft=e,this.scrollLeft=e,this.renderer.scrollColumns(e)}initializeScrollWheelWatcher(){this.contentsElement.addEventListener("wheel",e=>{var i;e.deltaX&&(i=this.contentsElement.scrollLeft+e.deltaX,this.table.rowManager.scrollHorizontal(i),this.table.columnManager.scrollHorizontal(i))})}generateColumnsFromRowData(e){var i=[],r={},n=this.table.options.autoColumns==="full"?e:[e[0]],a=this.table.options.autoColumnsDefinitions;if(e&&e.length){if(n.forEach(s=>{Object.keys(s).forEach((o,l)=>{let u=s[o],c;r[o]?r[o]!==!0&&typeof u<"u"&&(r[o].sorter=this.calculateSorterFromValue(u),r[o]=!0):(c={field:o,title:o,sorter:this.calculateSorterFromValue(u)},i.splice(l,0,c),r[o]=typeof u>"u"?c:!0)})}),a)switch(typeof a){case"function":this.table.options.columns=a.call(this.table,i);break;case"object":Array.isArray(a)?i.forEach(s=>{var o=a.find(l=>l.field===s.field);o&&Object.assign(s,o)}):i.forEach(s=>{a[s.field]&&Object.assign(s,a[s.field])}),this.table.options.columns=i;break}else this.table.options.columns=i;this.setColumns(this.table.options.columns)}}calculateSorterFromValue(e){var i;switch(typeof e){case"undefined":i="string";break;case"boolean":i="boolean";break;case"number":i="number";break;case"object":Array.isArray(e)?i="array":i="string";break;default:!isNaN(e)&&e!==""?i="number":e.match(/((^[0-9]+[a-z]+)|(^[a-z]+[0-9]+))+$/i)?i="alphanum":i="string";break}return i}setColumns(e,i){for(;this.headersElement.firstChild;)this.headersElement.removeChild(this.headersElement.firstChild);this.columns=[],this.columnsByIndex=[],this.columnsByField={},this.dispatch("columns-loading"),this.dispatchExternal("columnsLoading"),this.table.options.rowHeader&&(this.rowHeader=new Wu(this.table.options.rowHeader===!0?{}:this.table.options.rowHeader,this,!0),this.columns.push(this.rowHeader),this.headersElement.appendChild(this.rowHeader.getElement()),this.rowHeader.columnRendered()),e.forEach((r,n)=>{this._addColumn(r)}),this._reIndexColumns(),this.dispatch("columns-loaded"),this.subscribedExternal("columnsLoaded")&&this.dispatchExternal("columnsLoaded",this.getComponents()),this.rerenderColumns(!1,!0),this.redraw(!0)}_addColumn(e,i,r){var n=new Wu(e,this),a=n.getElement(),s=r&&this.findColumnIndex(r);if(i&&this.rowHeader&&(!r||r===this.rowHeader)&&(i=!1,r=this.rowHeader,s=0),r&&s>-1){var o=r.getTopColumn(),l=this.columns.indexOf(o),u=o.getElement();i?(this.columns.splice(l,0,n),u.parentNode.insertBefore(a,u)):(this.columns.splice(l+1,0,n),u.parentNode.insertBefore(a,u.nextSibling))}else i?(this.columns.unshift(n),this.headersElement.insertBefore(n.getElement(),this.headersElement.firstChild)):(this.columns.push(n),this.headersElement.appendChild(n.getElement()));return n.columnRendered(),n}registerColumnField(e){e.definition.field&&(this.columnsByField[e.definition.field]=e)}registerColumnPosition(e){this.columnsByIndex.push(e)}_reIndexColumns(){this.columnsByIndex=[],this.columns.forEach(function(e){e.reRegisterPosition()})}verticalAlignHeaders(){var e=0;this.redrawBlock||(this.headersElement.style.height="",this.columns.forEach(i=>{i.clearVerticalAlign()}),this.columns.forEach(i=>{var r=i.getHeight();r>e&&(e=r)}),this.headersElement.style.height=e+"px",this.columns.forEach(i=>{i.verticalAlign(this.table.options.columnHeaderVertAlign,e)}),this.table.rowManager.adjustTableSize())}findColumn(e){var i;if(typeof e=="object"){if(e instanceof Wu)return e;if(e instanceof nee)return e._getSelf()||!1;if(typeof HTMLElement<"u"&&e instanceof HTMLElement)return i=[],this.columns.forEach(n=>{i.push(n),i=i.concat(n.getColumns(!0))}),i.find(n=>n.element===e)||!1}else return this.columnsByField[e]||!1;return!1}getColumnByField(e){return this.columnsByField[e]}getColumnsByFieldRoot(e){var i=[];return Object.keys(this.columnsByField).forEach(r=>{var n=this.table.options.nestedFieldSeparator?r.split(this.table.options.nestedFieldSeparator)[0]:r;n===e&&i.push(this.columnsByField[r])}),i}getColumnByIndex(e){return this.columnsByIndex[e]}getFirstVisibleColumn(){var e=this.columnsByIndex.findIndex(i=>i.visible);return e>-1?this.columnsByIndex[e]:!1}getVisibleColumnsByIndex(){return this.columnsByIndex.filter(e=>e.visible)}getColumns(){return this.columns}findColumnIndex(e){return this.columnsByIndex.findIndex(i=>e===i)}getRealColumns(){return this.columnsByIndex}traverse(e){this.columnsByIndex.forEach((i,r)=>{e(i,r)})}getDefinitions(e){var i=[];return this.columnsByIndex.forEach(r=>{(!e||e&&r.visible)&&i.push(r.getDefinition())}),i}getDefinitionTree(){var e=[];return this.columns.forEach(i=>{e.push(i.getDefinition(!0))}),e}getComponents(e){var i=[],r=e?this.columns:this.columnsByIndex;return r.forEach(n=>{i.push(n.getComponent())}),i}getWidth(){var e=0;return this.columnsByIndex.forEach(i=>{i.visible&&(e+=i.getWidth())}),e}moveColumn(e,i,r){i.element.parentNode.insertBefore(e.element,i.element),r&&i.element.parentNode.insertBefore(i.element,e.element),this.moveColumnActual(e,i,r),this.verticalAlignHeaders(),this.table.rowManager.reinitialize()}moveColumnActual(e,i,r){e.parent.isGroup?this._moveColumnInArray(e.parent.columns,e,i,r):this._moveColumnInArray(this.columns,e,i,r),this._moveColumnInArray(this.columnsByIndex,e,i,r,!0),this.rerenderColumns(!0),this.dispatch("column-moved",e,i,r),this.subscribedExternal("columnMoved")&&this.dispatchExternal("columnMoved",e.getComponent(),this.table.columnManager.getComponents())}_moveColumnInArray(e,i,r,n,a){var s=e.indexOf(i),o,l=[];s>-1&&(e.splice(s,1),o=e.indexOf(r),o>-1?n&&(o=o+1):o=s,e.splice(o,0,i),a&&(l=this.chain("column-moving-rows",[i,r,n],null,[])||[],l=l.concat(this.table.rowManager.rows),l.forEach(function(u){if(u.cells.length){var c=u.cells.splice(s,1)[0];u.cells.splice(o,0,c)}})))}scrollToColumn(e,i,r){var n=0,a=e.getLeftOffset(),s=0,o=e.getElement();return new Promise((l,u)=>{if(typeof i>"u"&&(i=this.table.options.scrollToColumnPosition),typeof r>"u"&&(r=this.table.options.scrollToColumnIfVisible),e.visible){switch(i){case"middle":case"center":s=-this.element.clientWidth/2;break;case"right":s=o.clientWidth-this.headersElement.clientWidth;break}if(!r&&a>0&&a+o.offsetWidth<this.element.clientWidth)return!1;n=a+s,n=Math.max(Math.min(n,this.table.rowManager.element.scrollWidth-this.table.rowManager.element.clientWidth),0),this.table.rowManager.scrollHorizontal(n),this.scrollHorizontal(n),l()}else console.warn("Scroll Error - Column not visible"),u("Scroll Error - Column not visible")})}generateCells(e){var i=[];return this.columnsByIndex.forEach(r=>{i.push(r.generateCell(e))}),i}getFlexBaseWidth(){var e=this.table.element.clientWidth,i=0;return this.table.rowManager.element.scrollHeight>this.table.rowManager.element.clientHeight&&(e-=this.table.rowManager.element.offsetWidth-this.table.rowManager.element.clientWidth),this.columnsByIndex.forEach(function(r){var n,a,s;r.visible&&(n=r.definition.width||0,a=parseInt(r.minWidth),typeof n=="string"?n.indexOf("%")>-1?s=e/100*parseInt(n):s=parseInt(n):s=n,i+=s>a?s:a)}),i}addColumn(e,i,r){return new Promise((n,a)=>{var s=this._addColumn(e,i,r);this._reIndexColumns(),this.dispatch("column-add",e,i,r),this.layoutMode()!="fitColumns"&&s.reinitializeWidth(),this.redraw(!0),this.table.rowManager.reinitialize(),this.rerenderColumns(),n(s)})}deregisterColumn(e){var i=e.getField(),r;i&&delete this.columnsByField[i],r=this.columnsByIndex.indexOf(e),r>-1&&this.columnsByIndex.splice(r,1),r=this.columns.indexOf(e),r>-1&&this.columns.splice(r,1),this.verticalAlignHeaders(),this.redraw()}rerenderColumns(e,i){this.redrawBlock?(e===!1||e===!0&&this.redrawBlockUpdate===null)&&(this.redrawBlockUpdate=e):this.renderer.rerenderColumns(e,i)}blockRedraw(){this.redrawBlock=!0,this.redrawBlockUpdate=null}restoreRedraw(){this.redrawBlock=!1,this.verticalAlignHeaders(),this.renderer.rerenderColumns(this.redrawBlockUpdate)}redraw(e){gr.elVisible(this.element)&&this.verticalAlignHeaders(),e&&(this.table.rowManager.resetScroll(),this.table.rowManager.reinitialize()),this.confirm("table-redrawing",e)||this.layoutRefresh(e),this.dispatch("table-redraw",e),this.table.footerManager.redraw()}}class nAe extends YC{constructor(e){super(e),this.verticalFillMode="fill",this.scrollTop=0,this.scrollLeft=0,this.scrollTop=0,this.scrollLeft=0}clearRows(){for(var e=this.tableElement;e.firstChild;)e.removeChild(e.firstChild);e.scrollTop=0,e.scrollLeft=0,e.style.minWidth="",e.style.minHeight="",e.style.display="",e.style.visibility=""}renderRows(){var e=this.tableElement,i=!0,r=document.createDocumentFragment(),n=this.rows();n.forEach((a,s)=>{this.styleRow(a,s),a.initialize(!1,!0),a.type!=="group"&&(i=!1),r.appendChild(a.getElement())}),e.appendChild(r),n.forEach(a=>{a.rendered(),a.heightInitialized||a.calcHeight(!0)}),n.forEach(a=>{a.heightInitialized||a.setCellHeight()}),i?e.style.minWidth=this.table.columnManager.getWidth()+"px":e.style.minWidth=""}rerenderRows(e){this.clearRows(),e&&e(),this.renderRows(),this.rows().length||this.table.rowManager.tableEmpty()}scrollToRowNearestTop(e){var i=gr.elOffset(e.getElement()).top;return!(Math.abs(this.elementVertical.scrollTop-i)>Math.abs(this.elementVertical.scrollTop+this.elementVertical.clientHeight-i))}scrollToRow(e){var i=e.getElement();this.elementVertical.scrollTop=gr.elOffset(i).top-gr.elOffset(this.elementVertical).top+this.elementVertical.scrollTop}visibleRows(e){return this.rows()}}class aAe extends YC{constructor(e){super(e),this.verticalFillMode="fill",this.scrollTop=0,this.scrollLeft=0,this.vDomRowHeight=20,this.vDomTop=0,this.vDomBottom=0,this.vDomScrollPosTop=0,this.vDomScrollPosBottom=0,this.vDomTopPad=0,this.vDomBottomPad=0,this.vDomMaxRenderChain=90,this.vDomWindowBuffer=0,this.vDomWindowMinTotalRows=20,this.vDomWindowMinMarginRows=5,this.vDomTopNewRows=[],this.vDomBottomNewRows=[]}clearRows(){for(var e=this.tableElement;e.firstChild;)e.removeChild(e.firstChild);e.style.paddingTop="",e.style.paddingBottom="",e.style.minHeight="",e.style.display="",e.style.visibility="",this.elementVertical.scrollTop=0,this.elementVertical.scrollLeft=0,this.scrollTop=0,this.scrollLeft=0,this.vDomTop=0,this.vDomBottom=0,this.vDomTopPad=0,this.vDomBottomPad=0,this.vDomScrollPosTop=0,this.vDomScrollPosBottom=0}renderRows(){this._virtualRenderFill()}rerenderRows(e){for(var i=this.elementVertical.scrollTop,r=!1,n=!1,a=this.table.rowManager.scrollLeft,s=this.rows(),o=this.vDomTop;o<=this.vDomBottom;o++)if(s[o]){var l=i-s[o].getElement().offsetTop;if(n===!1||Math.abs(l)<n)n=l,r=o;else break}s.forEach(u=>{u.deinitializeHeight()}),e&&e(),this.rows().length?this._virtualRenderFill(r===!1?this.rows.length-1:r,!0,n||0):(this.clear(),this.table.rowManager.tableEmpty()),this.scrollColumns(a)}scrollColumns(e){this.table.rowManager.scrollHorizontal(e)}scrollRows(e,i){var r=e-this.vDomScrollPosTop,n=e-this.vDomScrollPosBottom,a=this.vDomWindowBuffer*2,s=this.rows();if(this.scrollTop=e,-r>a||n>a){var o=this.table.rowManager.scrollLeft;this._virtualRenderFill(Math.floor(this.elementVertical.scrollTop/this.elementVertical.scrollHeight*s.length)),this.scrollColumns(o)}else i?(r<0&&this._addTopRow(s,-r),n<0&&(this.vDomScrollHeight-this.scrollTop>this.vDomWindowBuffer?this._removeBottomRow(s,-n):this.vDomScrollPosBottom=this.scrollTop)):(n>=0&&this._addBottomRow(s,n),r>=0&&(this.scrollTop>this.vDomWindowBuffer?this._removeTopRow(s,r):this.vDomScrollPosTop=this.scrollTop))}resize(){this.vDomWindowBuffer=this.table.options.renderVerticalBuffer||this.elementVertical.clientHeight}scrollToRowNearestTop(e){var i=this.rows().indexOf(e);return!(Math.abs(this.vDomTop-i)>Math.abs(this.vDomBottom-i))}scrollToRow(e){var i=this.rows().indexOf(e);i>-1&&this._virtualRenderFill(i,!0)}visibleRows(e){var i=this.elementVertical.scrollTop,r=this.elementVertical.clientHeight+i,n=!1,a=0,s=0,o=this.rows();if(e)a=this.vDomTop,s=this.vDomBottom;else for(var l=this.vDomTop;l<=this.vDomBottom;l++)if(o[l])if(n)if(r-o[l].getElement().offsetTop>=0)s=l;else break;else if(i-o[l].getElement().offsetTop>=0)a=l;else if(n=!0,r-o[l].getElement().offsetTop>=0)s=l;else break;return o.slice(a,s+1)}_virtualRenderFill(e,i,r){var n=this.tableElement,a=this.elementVertical,s=0,o=0,l=0,u=0,c=0,d=0,p=this.rows(),f=p.length,m=0,h,g,I=[],v=0,w=0,y=this.table.rowManager.fixedHeight,b=this.elementVertical.clientHeight,S=this.table.options.rowHeight,U=!0;if(e=e||0,r=r||0,!e)this.clear();else{for(;n.firstChild;)n.removeChild(n.firstChild);u=(f-e+1)*this.vDomRowHeight,u<b&&(e-=Math.ceil((b-u)/this.vDomRowHeight),e<0&&(e=0)),s=Math.min(Math.max(Math.floor(this.vDomWindowBuffer/this.vDomRowHeight),this.vDomWindowMinMarginRows),e),e-=s}if(f&&gr.elVisible(this.elementVertical)){for(this.vDomTop=e,this.vDomBottom=e-1,y||this.table.options.maxHeight?(S&&(w=b/S+this.vDomWindowBuffer/S),w=Math.max(this.vDomWindowMinTotalRows,Math.ceil(w))):w=f;(w==f||o<=b+this.vDomWindowBuffer||v<this.vDomWindowMinTotalRows)&&this.vDomBottom<f-1;){for(I=[],g=document.createDocumentFragment(),d=0;d<w&&this.vDomBottom<f-1;)m=this.vDomBottom+1,h=p[m],this.styleRow(h,m),h.initialize(!1,!0),!h.heightInitialized&&!this.table.options.rowHeight&&h.clearCellHeight(),g.appendChild(h.getElement()),I.push(h),this.vDomBottom++,d++;if(!I.length)break;n.appendChild(g),I.forEach(T=>{T.rendered(),T.heightInitialized||T.calcHeight(!0)}),I.forEach(T=>{T.heightInitialized||T.setCellHeight()}),I.forEach(T=>{l=T.getHeight(),v<s?c+=l:o+=l,l>this.vDomWindowBuffer&&(this.vDomWindowBuffer=l*2),v++}),U=this.table.rowManager.adjustTableSize(),b=this.elementVertical.clientHeight,U&&(y||this.table.options.maxHeight)&&(S=o/v,w=Math.max(this.vDomWindowMinTotalRows,Math.ceil(b/S+this.vDomWindowBuffer/S)))}e?(this.vDomTopPad=i?this.vDomRowHeight*this.vDomTop+r:this.scrollTop-c,this.vDomBottomPad=this.vDomBottom==f-1?0:Math.max(this.vDomScrollHeight-this.vDomTopPad-o-c,0)):(this.vDomTopPad=0,this.vDomRowHeight=Math.floor((o+c)/v),this.vDomBottomPad=this.vDomRowHeight*(f-this.vDomBottom-1),this.vDomScrollHeight=c+o+this.vDomBottomPad-b),n.style.paddingTop=this.vDomTopPad+"px",n.style.paddingBottom=this.vDomBottomPad+"px",i&&(this.scrollTop=this.vDomTopPad+c+r-(this.elementVertical.scrollWidth>this.elementVertical.clientWidth?this.elementVertical.offsetHeight-b:0)),this.scrollTop=Math.min(this.scrollTop,this.elementVertical.scrollHeight-b),this.elementVertical.scrollWidth>this.elementVertical.clientWidth&&i&&(this.scrollTop+=this.elementVertical.offsetHeight-b),this.vDomScrollPosTop=this.scrollTop,this.vDomScrollPosBottom=this.scrollTop,a.scrollTop=this.scrollTop,this.dispatch("render-virtual-fill")}}_addTopRow(e,i){for(var r=this.tableElement,n=[],a=0,s=this.vDomTop-1,o=0,l=!0;l;)if(this.vDomTop){let u=e[s],c,d;u&&o<this.vDomMaxRenderChain?(c=u.getHeight()||this.vDomRowHeight,d=u.initialized,i>=c?(this.styleRow(u,s),r.insertBefore(u.getElement(),r.firstChild),(!u.initialized||!u.heightInitialized)&&n.push(u),u.initialize(),d||(c=u.getElement().offsetHeight,c>this.vDomWindowBuffer&&(this.vDomWindowBuffer=c*2)),i-=c,a+=c,this.vDomTop--,s--,o++):l=!1):l=!1}else l=!1;for(let u of n)u.clearCellHeight();this._quickNormalizeRowHeight(n),a&&(this.vDomTopPad-=a,this.vDomTopPad<0&&(this.vDomTopPad=s*this.vDomRowHeight),s<1&&(this.vDomTopPad=0),r.style.paddingTop=this.vDomTopPad+"px",this.vDomScrollPosTop-=a)}_removeTopRow(e,i){for(var r=[],n=0,a=0,s=!0;s;){let o=e[this.vDomTop],l;o&&a<this.vDomMaxRenderChain?(l=o.getHeight()||this.vDomRowHeight,i>=l?(this.vDomTop++,i-=l,n+=l,r.push(o),a++):s=!1):s=!1}for(let o of r){let l=o.getElement();l.parentNode&&l.parentNode.removeChild(l)}n&&(this.vDomTopPad+=n,this.tableElement.style.paddingTop=this.vDomTopPad+"px",this.vDomScrollPosTop+=this.vDomTop?n:n+this.vDomWindowBuffer)}_addBottomRow(e,i){for(var r=this.tableElement,n=[],a=0,s=this.vDomBottom+1,o=0,l=!0;l;){let u=e[s],c,d;u&&o<this.vDomMaxRenderChain?(c=u.getHeight()||this.vDomRowHeight,d=u.initialized,i>=c?(this.styleRow(u,s),r.appendChild(u.getElement()),(!u.initialized||!u.heightInitialized)&&n.push(u),u.initialize(),d||(c=u.getElement().offsetHeight,c>this.vDomWindowBuffer&&(this.vDomWindowBuffer=c*2)),i-=c,a+=c,this.vDomBottom++,s++,o++):l=!1):l=!1}for(let u of n)u.clearCellHeight();this._quickNormalizeRowHeight(n),a&&(this.vDomBottomPad-=a,(this.vDomBottomPad<0||s==e.length-1)&&(this.vDomBottomPad=0),r.style.paddingBottom=this.vDomBottomPad+"px",this.vDomScrollPosBottom+=a)}_removeBottomRow(e,i){for(var r=[],n=0,a=0,s=!0;s;){let o=e[this.vDomBottom],l;o&&a<this.vDomMaxRenderChain?(l=o.getHeight()||this.vDomRowHeight,i>=l?(this.vDomBottom--,i-=l,n+=l,r.push(o),a++):s=!1):s=!1}for(let o of r){let l=o.getElement();l.parentNode&&l.parentNode.removeChild(l)}n&&(this.vDomBottomPad+=n,this.vDomBottomPad<0&&(this.vDomBottomPad=0),this.tableElement.style.paddingBottom=this.vDomBottomPad+"px",this.vDomScrollPosBottom-=n)}_quickNormalizeRowHeight(e){for(let i of e)i.calcHeight();for(let i of e)i.setCellHeight()}}class sAe extends Ra{constructor(e){super(e),this.element=this.createHolderElement(),this.tableElement=this.createTableElement(),this.heightFixer=this.createTableElement(),this.placeholder=null,this.placeholderContents=null,this.firstRender=!1,this.renderMode="virtual",this.fixedHeight=!1,this.rows=[],this.activeRowsPipeline=[],this.activeRows=[],this.activeRowsCount=0,this.displayRows=[],this.displayRowsCount=0,this.scrollTop=0,this.scrollLeft=0,this.redrawBlock=!1,this.redrawBlockRestoreConfig=!1,this.redrawBlockRenderInPosition=!1,this.dataPipeline=[],this.displayPipeline=[],this.scrollbarWidth=0,this.renderer=null}createHolderElement(){var e=document.createElement("div");return e.classList.add("tabulator-tableholder"),e.setAttribute("tabindex",0),e}createTableElement(){var e=document.createElement("div");return e.classList.add("tabulator-table"),e.setAttribute("role","rowgroup"),e}initializePlaceholder(){var e=this.table.options.placeholder;if(typeof e=="function"&&(e=e.call(this.table)),e=this.chain("placeholder",[e],e,e)||e,e){let i=document.createElement("div");if(i.classList.add("tabulator-placeholder"),typeof e=="string"){let r=document.createElement("div");r.classList.add("tabulator-placeholder-contents"),r.innerHTML=e,i.appendChild(r),this.placeholderContents=r}else typeof HTMLElement<"u"&&e instanceof HTMLElement?(i.appendChild(e),this.placeholderContents=e):(console.warn("Invalid placeholder provided, must be string or HTML Element",e),this.el=null);this.placeholder=i}}getElement(){return this.element}getTableElement(){return this.tableElement}initialize(){this.initializePlaceholder(),this.initializeRenderer(),this.element.appendChild(this.tableElement),this.firstRender=!0,this.element.addEventListener("scroll",()=>{var e=this.element.scrollLeft,i=this.scrollLeft>e,r=this.element.scrollTop,n=this.scrollTop>r;this.scrollLeft!=e&&(this.scrollLeft=e,this.dispatch("scroll-horizontal",e,i),this.dispatchExternal("scrollHorizontal",e,i),this._positionPlaceholder()),this.scrollTop!=r&&(this.scrollTop=r,this.renderer.scrollRows(r,n),this.dispatch("scroll-vertical",r,n),this.dispatchExternal("scrollVertical",r,n))})}findRow(e){if(typeof e=="object"){if(e instanceof Ca)return e;if(e instanceof zC)return e._getSelf()||!1;if(typeof HTMLElement<"u"&&e instanceof HTMLElement)return this.rows.find(r=>r.getElement()===e)||!1;if(e===null)return!1}else return typeof e>"u"?!1:this.rows.find(r=>r.data[this.table.options.index]==e)||!1;return!1}getRowFromDataObject(e){var i=this.rows.find(r=>r.data===e);return i||!1}getRowFromPosition(e){return this.getDisplayRows().find(i=>i.type==="row"&&i.getPosition()===e&&i.isDisplayed())}scrollToRow(e,i,r){return this.renderer.scrollToRowPosition(e,i,r)}setData(e,i,r){return new Promise((n,a)=>{i&&this.getDisplayRows().length?this.table.options.pagination?this._setDataActual(e,!0):this.reRenderInPosition(()=>{this._setDataActual(e)}):(this.table.options.autoColumns&&r&&this.table.initialized&&this.table.columnManager.generateColumnsFromRowData(e),this.resetScroll(),this._setDataActual(e)),n()})}_setDataActual(e,i){this.dispatchExternal("dataProcessing",e),this._wipeElements(),Array.isArray(e)?(this.dispatch("data-processing",e),e.forEach((r,n)=>{if(r&&typeof r=="object"){var a=new Ca(r,this);this.rows.push(a)}else console.warn("Data Loading Warning - Invalid row data detected and ignored, expecting object but received:",r)}),this.refreshActiveData(!1,!1,i),this.dispatch("data-processed",e),this.dispatchExternal("dataProcessed",e)):console.error(`Data Loading Error - Unable to process data due to invalid data type 
Expecting: array 
Received: `,typeof e,`
Data:     `,e)}_wipeElements(){this.dispatch("rows-wipe"),this.destroy(),this.adjustTableSize(),this.dispatch("rows-wiped")}destroy(){this.rows.forEach(e=>{e.wipe()}),this.rows=[],this.activeRows=[],this.activeRowsPipeline=[],this.activeRowsCount=0,this.displayRows=[],this.displayRowsCount=0}deleteRow(e,i){var r=this.rows.indexOf(e),n=this.activeRows.indexOf(e);n>-1&&this.activeRows.splice(n,1),r>-1&&this.rows.splice(r,1),this.setActiveRows(this.activeRows),this.displayRowIterator(a=>{var s=a.indexOf(e);s>-1&&a.splice(s,1)}),i||this.reRenderInPosition(),this.regenerateRowPositions(),this.dispatchExternal("rowDeleted",e.getComponent()),this.displayRowsCount||this.tableEmpty(),this.subscribedExternal("dataChanged")&&this.dispatchExternal("dataChanged",this.getData())}addRow(e,i,r,n){var a=this.addRowActual(e,i,r,n);return a}addRows(e,i,r,n){var a=[];return new Promise((s,o)=>{i=this.findAddRowPos(i),Array.isArray(e)||(e=[e]),(typeof r>"u"&&i||typeof r<"u"&&!i)&&e.reverse(),e.forEach((l,u)=>{var c=this.addRow(l,i,r,!0);a.push(c),this.dispatch("row-added",c,l,i,r)}),this.refreshActiveData(n?"displayPipeline":!1,!1,!0),this.regenerateRowPositions(),this.displayRowsCount&&this._clearPlaceholder(),s(a)})}findAddRowPos(e){return typeof e>"u"&&(e=this.table.options.addRowPos),e==="pos"&&(e=!0),e==="bottom"&&(e=!1),e}addRowActual(e,i,r,n){var a=e instanceof Ca?e:new Ca(e||{},this),s=this.findAddRowPos(i),o=-1,l,u;return r||(u=this.chain("row-adding-position",[a,s],null,{index:r,top:s}),r=u.index,s=u.top),typeof r<"u"&&(r=this.findRow(r)),r=this.chain("row-adding-index",[a,r,s],null,r),r&&(o=this.rows.indexOf(r)),r&&o>-1?(l=this.activeRows.indexOf(r),this.displayRowIterator(function(c){var d=c.indexOf(r);d>-1&&c.splice(s?d:d+1,0,a)}),l>-1&&this.activeRows.splice(s?l:l+1,0,a),this.rows.splice(s?o:o+1,0,a)):s?(this.displayRowIterator(function(c){c.unshift(a)}),this.activeRows.unshift(a),this.rows.unshift(a)):(this.displayRowIterator(function(c){c.push(a)}),this.activeRows.push(a),this.rows.push(a)),this.setActiveRows(this.activeRows),this.dispatchExternal("rowAdded",a.getComponent()),this.subscribedExternal("dataChanged")&&this.dispatchExternal("dataChanged",this.table.rowManager.getData()),n||this.reRenderInPosition(),a}moveRow(e,i,r){this.dispatch("row-move",e,i,r),this.moveRowActual(e,i,r),this.regenerateRowPositions(),this.dispatch("row-moved",e,i,r),this.dispatchExternal("rowMoved",e.getComponent())}moveRowActual(e,i,r){this.moveRowInArray(this.rows,e,i,r),this.moveRowInArray(this.activeRows,e,i,r),this.displayRowIterator(n=>{this.moveRowInArray(n,e,i,r)}),this.dispatch("row-moving",e,i,r)}moveRowInArray(e,i,r,n){var a,s,o,l;if(i!==r&&(a=e.indexOf(i),a>-1&&(e.splice(a,1),s=e.indexOf(r),s>-1?n?e.splice(s+1,0,i):e.splice(s,0,i):e.splice(a,0,i)),e===this.getDisplayRows())){o=a<s?a:s,l=s>a?s:a+1;for(let u=o;u<=l;u++)e[u]&&this.styleRow(e[u],u)}}clearData(){this.setData([])}getRowIndex(e){return this.findRowIndex(e,this.rows)}getDisplayRowIndex(e){var i=this.getDisplayRows().indexOf(e);return i>-1?i:!1}nextDisplayRow(e,i){var r=this.getDisplayRowIndex(e),n=!1;return r!==!1&&r<this.displayRowsCount-1&&(n=this.getDisplayRows()[r+1]),n&&(!(n instanceof Ca)||n.type!="row")?this.nextDisplayRow(n,i):n}prevDisplayRow(e,i){var r=this.getDisplayRowIndex(e),n=!1;return r&&(n=this.getDisplayRows()[r-1]),i&&n&&(!(n instanceof Ca)||n.type!="row")?this.prevDisplayRow(n,i):n}findRowIndex(e,i){var r;return e=this.findRow(e),e&&(r=i.indexOf(e),r>-1)?r:!1}getData(e,i){var r=[],n=this.getRows(e);return n.forEach(function(a){a.type=="row"&&r.push(a.getData(i||"data"))}),r}getComponents(e){var i=[],r=this.getRows(e);return r.forEach(function(n){i.push(n.getComponent())}),i}getDataCount(e){var i=this.getRows(e);return i.length}scrollHorizontal(e){this.scrollLeft=e,this.element.scrollLeft=e,this.dispatch("scroll-horizontal",e)}registerDataPipelineHandler(e,i){typeof i<"u"?(this.dataPipeline.push({handler:e,priority:i}),this.dataPipeline.sort((r,n)=>r.priority-n.priority)):console.error("Data pipeline handlers must have a priority in order to be registered")}registerDisplayPipelineHandler(e,i){typeof i<"u"?(this.displayPipeline.push({handler:e,priority:i}),this.displayPipeline.sort((r,n)=>r.priority-n.priority)):console.error("Display pipeline handlers must have a priority in order to be registered")}refreshActiveData(e,i,r){var n=this.table,a="",s=0,o=["all","dataPipeline","display","displayPipeline","end"];if(!this.table.destroyed){if(typeof e=="function")if(s=this.dataPipeline.findIndex(l=>l.handler===e),s>-1)a="dataPipeline",i&&(s==this.dataPipeline.length-1?a="display":s++);else if(s=this.displayPipeline.findIndex(l=>l.handler===e),s>-1)a="displayPipeline",i&&(s==this.displayPipeline.length-1?a="end":s++);else{console.error("Unable to refresh data, invalid handler provided",e);return}else a=e||"all",s=0;if(this.redrawBlock){(!this.redrawBlockRestoreConfig||this.redrawBlockRestoreConfig&&(this.redrawBlockRestoreConfig.stage===a&&s<this.redrawBlockRestoreConfig.index||o.indexOf(a)<o.indexOf(this.redrawBlockRestoreConfig.stage)))&&(this.redrawBlockRestoreConfig={handler:e,skipStage:i,renderInPosition:r,stage:a,index:s});return}else gr.elVisible(this.element)?r?this.reRenderInPosition(this.refreshPipelines.bind(this,e,a,s,r)):(this.refreshPipelines(e,a,s,r),e||this.table.columnManager.renderer.renderColumns(),this.renderTable(),n.options.layoutColumnsOnNewData&&this.table.columnManager.redraw(!0)):this.refreshPipelines(e,a,s,r),this.dispatch("data-refreshed")}}refreshPipelines(e,i,r,n){switch(this.dispatch("data-refreshing"),(!e||!this.activeRowsPipeline[0])&&(this.activeRowsPipeline[0]=this.rows.slice(0)),i){case"all":case"dataPipeline":for(let a=r;a<this.dataPipeline.length;a++){let s=this.dataPipeline[a].handler(this.activeRowsPipeline[a].slice(0));this.activeRowsPipeline[a+1]=s||this.activeRowsPipeline[a].slice(0)}this.setActiveRows(this.activeRowsPipeline[this.dataPipeline.length]);case"display":r=0,this.resetDisplayRows();case"displayPipeline":for(let a=r;a<this.displayPipeline.length;a++){let s=this.displayPipeline[a].handler((a?this.getDisplayRows(a-1):this.activeRows).slice(0),n);this.setDisplayRows(s||this.getDisplayRows(a-1).slice(0),a)}case"end":this.regenerateRowPositions()}this.getDisplayRows().length&&this._clearPlaceholder()}regenerateRowPositions(){var e=this.getDisplayRows(),i=1;e.forEach(r=>{r.type==="row"&&(r.setPosition(i),i++)})}setActiveRows(e){this.activeRows=this.activeRows=Object.assign([],e),this.activeRowsCount=this.activeRows.length}resetDisplayRows(){this.displayRows=[],this.displayRows.push(this.activeRows.slice(0)),this.displayRowsCount=this.displayRows[0].length}setDisplayRows(e,i){this.displayRows[i]=e,i==this.displayRows.length-1&&(this.displayRowsCount=this.displayRows[this.displayRows.length-1].length)}getDisplayRows(e){return typeof e>"u"?this.displayRows.length?this.displayRows[this.displayRows.length-1]:[]:this.displayRows[e]||[]}getVisibleRows(e,i){var r=Object.assign([],this.renderer.visibleRows(!i));return e&&(r=this.chain("rows-visible",[i],r,r)),r}displayRowIterator(e){this.activeRowsPipeline.forEach(e),this.displayRows.forEach(e),this.displayRowsCount=this.displayRows[this.displayRows.length-1].length}getRows(e){var i=[];switch(e){case"active":i=this.activeRows;break;case"display":i=this.table.rowManager.getDisplayRows();break;case"visible":i=this.getVisibleRows(!1,!0);break;default:i=this.chain("rows-retrieve",e,null,this.rows)||this.rows}return i}reRenderInPosition(e){this.redrawBlock?e?e():this.redrawBlockRenderInPosition=!0:(this.dispatchExternal("renderStarted"),this.renderer.rerenderRows(e),this.fixedHeight||this.adjustTableSize(),this.scrollBarCheck(),this.dispatchExternal("renderComplete"))}scrollBarCheck(){var e=0;this.element.scrollHeight>this.element.clientHeight&&(e=this.element.offsetWidth-this.element.clientWidth),e!==this.scrollbarWidth&&(this.scrollbarWidth=e,this.dispatch("scrollbar-vertical",e))}initializeRenderer(){var e,i={virtual:aAe,basic:nAe};typeof this.table.options.renderVertical=="string"?e=i[this.table.options.renderVertical]:e=this.table.options.renderVertical,e?(this.renderMode=this.table.options.renderVertical,this.renderer=new e(this.table,this.element,this.tableElement),this.renderer.initialize(),(this.table.element.clientHeight||this.table.options.height)&&!(this.table.options.minHeight&&this.table.options.maxHeight)?this.fixedHeight=!0:this.fixedHeight=!1):console.error("Unable to find matching renderer:",this.table.options.renderVertical)}getRenderMode(){return this.renderMode}renderTable(){this.dispatchExternal("renderStarted"),this.element.scrollTop=0,this._clearTable(),this.displayRowsCount?(this.renderer.renderRows(),this.firstRender&&(this.firstRender=!1,this.fixedHeight||this.adjustTableSize(),this.layoutRefresh(!0))):this.renderEmptyScroll(),this.fixedHeight||this.adjustTableSize(),this.dispatch("table-layout"),this.displayRowsCount||this._showPlaceholder(),this.scrollBarCheck(),this.dispatchExternal("renderComplete")}renderEmptyScroll(){this.placeholder?this.tableElement.style.display="none":this.tableElement.style.minWidth=this.table.columnManager.getWidth()+"px"}_clearTable(){this._clearPlaceholder(),this.scrollTop=0,this.scrollLeft=0,this.renderer.clearRows()}tableEmpty(){this.renderEmptyScroll(),this._showPlaceholder()}checkPlaceholder(){this.displayRowsCount?this._clearPlaceholder():this.tableEmpty()}_showPlaceholder(){this.placeholder&&(this.placeholder&&this.placeholder.parentNode&&this.placeholder.parentNode.removeChild(this.placeholder),this.initializePlaceholder(),this.placeholder.setAttribute("tabulator-render-mode",this.renderMode),this.getElement().appendChild(this.placeholder),this._positionPlaceholder(),this.adjustTableSize())}_clearPlaceholder(){this.placeholder&&this.placeholder.parentNode&&this.placeholder.parentNode.removeChild(this.placeholder),this.tableElement.style.minWidth="",this.tableElement.style.display=""}_positionPlaceholder(){this.placeholder&&this.placeholder.parentNode&&(this.placeholder.style.width=this.table.columnManager.getWidth()+"px",this.placeholderContents.style.width=this.table.rowManager.element.clientWidth+"px",this.placeholderContents.style.marginLeft=this.scrollLeft+"px")}styleRow(e,i){var r=e.getElement();i%2?(r.classList.add("tabulator-row-even"),r.classList.remove("tabulator-row-odd")):(r.classList.add("tabulator-row-odd"),r.classList.remove("tabulator-row-even"))}normalizeHeight(e){this.activeRows.forEach(function(i){i.normalizeHeight(e)})}adjustTableSize(){let e=this.element.clientHeight,i,r=!1;if(this.renderer.verticalFillMode==="fill"){let n=Math.floor(this.table.columnManager.getElement().getBoundingClientRect().height+(this.table.footerManager&&this.table.footerManager.active&&!this.table.footerManager.external?this.table.footerManager.getElement().getBoundingClientRect().height:0));if(this.fixedHeight){i=isNaN(this.table.options.minHeight)?this.table.options.minHeight:this.table.options.minHeight+"px";const a="calc(100% - "+n+"px)";this.element.style.minHeight=i||"calc(100% - "+n+"px)",this.element.style.height=a,this.element.style.maxHeight=a}else this.element.style.height="",this.element.style.height=this.table.element.clientHeight-n+"px",this.element.scrollTop=this.scrollTop;this.renderer.resize(),!this.fixedHeight&&e!=this.element.clientHeight&&(r=!0,this.subscribed("table-resize")?this.dispatch("table-resize"):this.redraw()),this.scrollBarCheck()}return this._positionPlaceholder(),r}reinitialize(){this.rows.forEach(function(e){e.reinitialize(!0)})}blockRedraw(){this.redrawBlock=!0,this.redrawBlockRestoreConfig=!1}restoreRedraw(){this.redrawBlock=!1,this.redrawBlockRestoreConfig?(this.refreshActiveData(this.redrawBlockRestoreConfig.handler,this.redrawBlockRestoreConfig.skipStage,this.redrawBlockRestoreConfig.renderInPosition),this.redrawBlockRestoreConfig=!1):this.redrawBlockRenderInPosition&&this.reRenderInPosition(),this.redrawBlockRenderInPosition=!1}redraw(e){this.adjustTableSize(),this.table.tableWidth=this.table.element.clientWidth,e?this.renderTable():(this.reRenderInPosition(),this.scrollHorizontal(this.scrollLeft))}resetScroll(){if(this.element.scrollLeft=0,this.element.scrollTop=0,this.table.browser==="ie"){var e=document.createEvent("Event");e.initEvent("scroll",!1,!0),this.element.dispatchEvent(e)}else this.element.dispatchEvent(new Event("scroll"))}}class oAe extends Ra{constructor(e){super(e),this.active=!1,this.element=this.createElement(),this.containerElement=this.createContainerElement(),this.external=!1}initialize(){this.initializeElement()}createElement(){var e=document.createElement("div");return e.classList.add("tabulator-footer"),e}createContainerElement(){var e=document.createElement("div");return e.classList.add("tabulator-footer-contents"),this.element.appendChild(e),e}initializeElement(){this.table.options.footerElement&&(typeof this.table.options.footerElement==="string"?this.table.options.footerElement[0]==="<"?this.containerElement.innerHTML=this.table.options.footerElement:(this.external=!0,this.containerElement=document.querySelector(this.table.options.footerElement)):this.element=this.table.options.footerElement)}getElement(){return this.element}append(e){this.activate(),this.containerElement.appendChild(e),this.table.rowManager.adjustTableSize()}prepend(e){this.activate(),this.element.insertBefore(e,this.element.firstChild),this.table.rowManager.adjustTableSize()}remove(e){e.parentNode.removeChild(e),this.deactivate()}deactivate(e){(!this.element.firstChild||e)&&(this.external||this.element.parentNode.removeChild(this.element),this.active=!1)}activate(){this.active||(this.active=!0,this.external||(this.table.element.appendChild(this.getElement()),this.table.element.style.display=""))}redraw(){this.dispatch("footer-redraw")}}class lAe extends Ra{constructor(e){super(e),this.el=null,this.abortClasses=["tabulator-headers","tabulator-table"],this.previousTargets={},this.listeners=["click","dblclick","contextmenu","mouseenter","mouseleave","mouseover","mouseout","mousemove","mouseup","mousedown","touchstart","touchend"],this.componentMap={"tabulator-cell":"cell","tabulator-row":"row","tabulator-group":"group","tabulator-col":"column"},this.pseudoTrackers={row:{subscriber:null,target:null},cell:{subscriber:null,target:null},group:{subscriber:null,target:null},column:{subscriber:null,target:null}},this.pseudoTracking=!1}initialize(){this.el=this.table.element,this.buildListenerMap(),this.bindSubscriptionWatchers()}buildListenerMap(){var e={};this.listeners.forEach(i=>{e[i]={handler:null,components:[]}}),this.listeners=e}bindPseudoEvents(){Object.keys(this.pseudoTrackers).forEach(e=>{this.pseudoTrackers[e].subscriber=this.pseudoMouseEnter.bind(this,e),this.subscribe(e+"-mouseover",this.pseudoTrackers[e].subscriber)}),this.pseudoTracking=!0}pseudoMouseEnter(e,i,r){this.pseudoTrackers[e].target!==r&&(this.pseudoTrackers[e].target&&this.dispatch(e+"-mouseleave",i,this.pseudoTrackers[e].target),this.pseudoMouseLeave(e,i),this.pseudoTrackers[e].target=r,this.dispatch(e+"-mouseenter",i,r))}pseudoMouseLeave(e,i){var r=Object.keys(this.pseudoTrackers),n={row:["cell"],cell:["row"]};r=r.filter(a=>{var s=n[e];return a!==e&&(!s||s&&!s.includes(a))}),r.forEach(a=>{var s=this.pseudoTrackers[a].target;this.pseudoTrackers[a].target&&(this.dispatch(a+"-mouseleave",i,s),this.pseudoTrackers[a].target=null)})}bindSubscriptionWatchers(){var e=Object.keys(this.listeners),i=Object.values(this.componentMap);for(let r of i)for(let n of e){let a=r+"-"+n;this.subscriptionChange(a,this.subscriptionChanged.bind(this,r,n))}this.subscribe("table-destroy",this.clearWatchers.bind(this))}subscriptionChanged(e,i,r){var n=this.listeners[i].components,a=n.indexOf(e),s=!1;r?a===-1&&(n.push(e),s=!0):this.subscribed(e+"-"+i)||a>-1&&(n.splice(a,1),s=!0),(i==="mouseenter"||i==="mouseleave")&&!this.pseudoTracking&&this.bindPseudoEvents(),s&&this.updateEventListeners()}updateEventListeners(){for(let e in this.listeners){let i=this.listeners[e];i.components.length?i.handler||(i.handler=this.track.bind(this,e),this.el.addEventListener(e,i.handler)):i.handler&&(this.el.removeEventListener(e,i.handler),i.handler=null)}}track(e,i){var r=i.composedPath&&i.composedPath()||i.path,n=this.findTargets(r);n=this.bindComponents(e,n),this.triggerEvents(e,i,n),this.pseudoTracking&&(e=="mouseover"||e=="mouseleave")&&!Object.keys(n).length&&this.pseudoMouseLeave("none",i)}findTargets(e){var i={};let r=Object.keys(this.componentMap);for(let n of e){let a=n.classList?[...n.classList]:[];if(a.filter(l=>this.abortClasses.includes(l)).length)break;let o=a.filter(l=>r.includes(l));for(let l of o)i[this.componentMap[l]]||(i[this.componentMap[l]]=n)}return i.group&&i.group===i.row&&delete i.row,i}bindComponents(e,i){var r=Object.keys(i).reverse(),n=this.listeners[e],a={},s={},o={};for(let l of r){let u,c=i[l],d=this.previousTargets[l];if(d&&d.target===c)u=d.component;else switch(l){case"row":case"group":(n.components.includes("row")||n.components.includes("cell")||n.components.includes("group"))&&(u=this.table.rowManager.getVisibleRows(!0).find(f=>f.getElement()===c),i.row&&i.row.parentNode&&i.row.parentNode.closest(".tabulator-row")&&(i[l]=!1));break;case"column":n.components.includes("column")&&(u=this.table.columnManager.findColumn(c));break;case"cell":n.components.includes("cell")&&(a.row instanceof Ca?u=a.row.findCell(c):i.row&&console.warn("Event Target Lookup Error - The row this cell is attached to cannot be found, has the table been reinitialized without being destroyed first?"));break}u&&(a[l]=u,o[l]={target:c,component:u})}return this.previousTargets=o,Object.keys(i).forEach(l=>{let u=a[l];s[l]=u}),s}triggerEvents(e,i,r){var n=this.listeners[e];for(let a in r)r[a]&&n.components.includes(a)&&this.dispatch(a+"-"+e,i,r[a])}clearWatchers(){for(let e in this.listeners){let i=this.listeners[e];i.handler&&(this.el.removeEventListener(e,i.handler),i.handler=null)}}}class uAe{constructor(e){this.table=e,this.bindings={}}bind(e,i,r){this.bindings[e]||(this.bindings[e]={}),this.bindings[e][i]?console.warn("Unable to bind component handler, a matching function name is already bound",e,i,r):this.bindings[e][i]=r}handle(e,i,r){if(this.bindings[e]&&this.bindings[e][r]&&typeof this.bindings[e][r].bind=="function")return this.bindings[e][r].bind(null,i);r!=="then"&&typeof r=="string"&&!r.startsWith("_")&&this.table.options.debugInvalidComponentFuncs&&console.error("The "+e+" component does not have a "+r+" function, have you checked that you have the correct Tabulator module installed?")}}class cAe extends Ra{constructor(e){super(e),this.requestOrder=0,this.loading=!1}initialize(){}load(e,i,r,n,a,s){var o=++this.requestOrder;if(this.table.destroyed)return Promise.resolve();if(this.dispatchExternal("dataLoading",e),e&&(e.indexOf("{")==0||e.indexOf("[")==0)&&(e=JSON.parse(e)),this.confirm("data-loading",[e,i,r,a])){this.loading=!0,a||this.alertLoader(),i=this.chain("data-params",[e,r,a],i||{},i||{}),i=this.mapParams(i,this.table.options.dataSendParams);var l=this.chain("data-load",[e,i,r,a],!1,Promise.resolve([]));return l.then(u=>{if(this.table.destroyed)console.warn("Data Load Response Blocked - Table has been destroyed");else{!Array.isArray(u)&&typeof u=="object"&&(u=this.mapParams(u,this.objectInvert(this.table.options.dataReceiveParams)));var c=this.chain("data-loaded",[u],null,u);o==this.requestOrder?(this.clearAlert(),c!==!1&&(this.dispatchExternal("dataLoaded",c),this.table.rowManager.setData(c,n,typeof s>"u"?!n:s))):console.warn("Data Load Response Blocked - An active data load request was blocked by an attempt to change table data while the request was being made")}}).catch(u=>{console.error("Data Load Error: ",u),this.dispatchExternal("dataLoadError",u),a||this.alertError(),setTimeout(()=>{this.clearAlert()},this.table.options.dataLoaderErrorTimeout)}).finally(()=>{this.loading=!1})}else return this.dispatchExternal("dataLoaded",e),e||(e=[]),this.table.rowManager.setData(e,n,typeof s>"u"?!n:s),Promise.resolve()}mapParams(e,i){var r={};for(let n in e)r[i.hasOwnProperty(n)?i[n]:n]=e[n];return r}objectInvert(e){var i={};for(let r in e)i[e[r]]=r;return i}blockActiveLoad(){this.requestOrder++}alertLoader(){var e=typeof this.table.options.dataLoader=="function"?this.table.options.dataLoader():this.table.options.dataLoader;e&&this.table.alertManager.alert(this.table.options.dataLoaderLoading||this.langText("data|loading"))}alertError(){this.table.alertManager.alert(this.table.options.dataLoaderError||this.langText("data|error"),"error")}clearAlert(){this.table.alertManager.clear()}}class dAe{constructor(e,i,r){this.table=e,this.events={},this.optionsList=i||{},this.subscriptionNotifiers={},this.dispatch=r?this._debugDispatch.bind(this):this._dispatch.bind(this),this.debug=r}subscriptionChange(e,i){this.subscriptionNotifiers[e]||(this.subscriptionNotifiers[e]=[]),this.subscriptionNotifiers[e].push(i),this.subscribed(e)&&this._notifySubscriptionChange(e,!0)}subscribe(e,i){this.events[e]||(this.events[e]=[]),this.events[e].push(i),this._notifySubscriptionChange(e,!0)}unsubscribe(e,i){var r;if(this.events[e])if(i)if(r=this.events[e].findIndex(n=>n===i),r>-1)this.events[e].splice(r,1);else{console.warn("Cannot remove event, no matching event found:",e,i);return}else delete this.events[e];else{console.warn("Cannot remove event, no events set on:",e);return}this._notifySubscriptionChange(e,!1)}subscribed(e){return this.events[e]&&this.events[e].length}_notifySubscriptionChange(e,i){var r=this.subscriptionNotifiers[e];r&&r.forEach(n=>{n(i)})}_dispatch(){var e=Array.from(arguments),i=e.shift(),r;return this.events[i]&&this.events[i].forEach((n,a)=>{let s=n.apply(this.table,e);a||(r=s)}),r}_debugDispatch(){var e=Array.from(arguments),i=e[0];return e[0]="ExternalEvent:"+e[0],(this.debug===!0||this.debug.includes(i))&&console.log(...e),this._dispatch(...arguments)}}class pAe{constructor(e){this.events={},this.subscriptionNotifiers={},this.dispatch=e?this._debugDispatch.bind(this):this._dispatch.bind(this),this.chain=e?this._debugChain.bind(this):this._chain.bind(this),this.confirm=e?this._debugConfirm.bind(this):this._confirm.bind(this),this.debug=e}subscriptionChange(e,i){this.subscriptionNotifiers[e]||(this.subscriptionNotifiers[e]=[]),this.subscriptionNotifiers[e].push(i),this.subscribed(e)&&this._notifySubscriptionChange(e,!0)}subscribe(e,i,r=1e4){this.events[e]||(this.events[e]=[]),this.events[e].push({callback:i,priority:r}),this.events[e].sort((n,a)=>n.priority-a.priority),this._notifySubscriptionChange(e,!0)}unsubscribe(e,i){var r;if(this.events[e]){if(i)if(r=this.events[e].findIndex(n=>n.callback===i),r>-1)this.events[e].splice(r,1);else{console.warn("Cannot remove event, no matching event found:",e,i);return}}else{console.warn("Cannot remove event, no events set on:",e);return}this._notifySubscriptionChange(e,!1)}subscribed(e){return this.events[e]&&this.events[e].length}_chain(e,i,r,n){var a=r;return Array.isArray(i)||(i=[i]),this.subscribed(e)?(this.events[e].forEach((s,o)=>{a=s.callback.apply(this,i.concat([a]))}),a):typeof n=="function"?n():n}_confirm(e,i){var r=!1;return Array.isArray(i)||(i=[i]),this.subscribed(e)&&this.events[e].forEach((n,a)=>{n.callback.apply(this,i)&&(r=!0)}),r}_notifySubscriptionChange(e,i){var r=this.subscriptionNotifiers[e];r&&r.forEach(n=>{n(i)})}_dispatch(){var e=Array.from(arguments),i=e.shift();this.events[i]&&this.events[i].forEach(r=>{r.callback.apply(this,e)})}_debugDispatch(){var e=Array.from(arguments),i=e[0];return e[0]="InternalEvent:"+i,(this.debug===!0||this.debug.includes(i))&&console.log(...e),this._dispatch(...arguments)}_debugChain(){var e=Array.from(arguments),i=e[0];return e[0]="InternalEvent:"+i,(this.debug===!0||this.debug.includes(i))&&console.log(...e),this._chain(...arguments)}_debugConfirm(){var e=Array.from(arguments),i=e[0];return e[0]="InternalEvent:"+i,(this.debug===!0||this.debug.includes(i))&&console.log(...e),this._confirm(...arguments)}}class fAe extends Ra{constructor(e){super(e)}_warnUser(){this.options("debugDeprecation")&&console.warn(...arguments)}check(e,i,r){var n="";return typeof this.options(e)<"u"?(n="Deprecated Setup Option - Use of the %c"+e+"%c option is now deprecated",i?(n=n+", Please use the %c"+i+"%c option instead",this._warnUser(n,"font-weight: bold;","font-weight: normal;","font-weight: bold;","font-weight: normal;"),r&&(this.table.options[i]=this.table.options[e])):this._warnUser(n,"font-weight: bold;","font-weight: normal;"),!1):!0}checkMsg(e,i){return typeof this.options(e)<"u"?(this._warnUser("%cDeprecated Setup Option - Use of the %c"+e+" %c option is now deprecated, "+i,"font-weight: normal;","font-weight: bold;","font-weight: normal;"),!1):!0}msg(e){this._warnUser(e)}}class mAe extends Ra{constructor(e){super(e),this.deps={},this.props={}}initialize(){this.deps=Object.assign({},this.options("dependencies"))}lookup(e,i,r){if(Array.isArray(e)){for(const a of e){var n=this.lookup(a,i,!0);if(n)break}if(n)return n;this.error(e)}else return i?this.lookupProp(e,i,r):this.lookupKey(e,r)}lookupProp(e,i,r){var n;if(this.props[e]&&this.props[e][i])return this.props[e][i];if(n=this.lookupKey(e,r),n)return this.props[e]||(this.props[e]={}),this.props[e][i]=n[i]||n,this.props[e][i]}lookupKey(e,i){var r;return this.deps[e]?r=this.deps[e]:window[e]?(this.deps[e]=window[e],r=this.deps[e]):i||this.error(e),r}error(e){console.error("Unable to find dependency",e,"Please check documentation and ensure you have imported the required library into your project")}}function hAe(t,e){e&&this.table.columnManager.renderer.reinitializeColumnWidths(t),this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&this.table.modules.responsiveLayout.update()}function ZW(t,e){t.forEach(function(i){i.reinitializeWidth()}),this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&this.table.modules.responsiveLayout.update()}function gAe(t,e){var i=0,r=this.table.rowManager.element.clientWidth,n=0,a=!1;t.forEach((s,o)=>{s.widthFixed||s.reinitializeWidth(),(this.table.options.responsiveLayout?s.modules.responsive.visible:s.visible)&&(a=s),s.visible&&(i+=s.getWidth())}),a?(n=r-i+a.getWidth(),this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&(a.setWidth(0),this.table.modules.responsiveLayout.update()),n>0?a.setWidth(n):a.reinitializeWidth()):this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&this.table.modules.responsiveLayout.update()}function IAe(t,e){var i=this.table.rowManager.element.getBoundingClientRect().width,r=0,n=0,a=0,s=0,o=[],l=[],u=0,c=0,d=0;function p(m){var h;return typeof m=="string"?m.indexOf("%")>-1?h=i/100*parseInt(m):h=parseInt(m):h=m,h}function f(m,h,g,I){var v=[],w=0,y=0,b=0,S=a,U=0,T=0,P=[];function D(R){return g*(R.column.definition.widthGrow||1)}function E(R){return p(R.width)-g*(R.column.definition.widthShrink||0)}return m.forEach(function(R,C){var M=I?E(R):D(R);R.column.minWidth>=M?v.push(R):R.column.maxWidth&&R.column.maxWidth<M?(R.width=R.column.maxWidth,h-=R.column.maxWidth,S-=I?R.column.definition.widthShrink||1:R.column.definition.widthGrow||1,S&&(g=Math.floor(h/S))):(P.push(R),T+=I?R.column.definition.widthShrink||1:R.column.definition.widthGrow||1)}),v.length?(v.forEach(function(R){w+=I?R.width-R.column.minWidth:R.column.minWidth,R.width=R.column.minWidth}),y=h-w,b=T?Math.floor(y/T):y,U=f(P,y,b,I)):(U=T?h-Math.floor(h/T)*T:h,P.forEach(function(R){R.width=I?E(R):D(R)})),U}this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&this.table.modules.responsiveLayout.update(),this.table.rowManager.element.scrollHeight>this.table.rowManager.element.clientHeight&&(i-=this.table.rowManager.element.offsetWidth-this.table.rowManager.element.clientWidth),t.forEach(function(m){var h,g,I;m.visible&&(h=m.definition.width,g=parseInt(m.minWidth),h?(I=p(h),r+=I>g?I:g,m.definition.widthShrink&&(l.push({column:m,width:I>g?I:g}),u+=m.definition.widthShrink)):(o.push({column:m,width:0}),a+=m.definition.widthGrow||1))}),n=i-r,s=Math.floor(n/a),d=f(o,n,s,!1),o.length&&d>0&&(o[o.length-1].width+=d),o.forEach(function(m){n-=m.width}),c=Math.abs(d)+n,c>0&&u&&(d=f(l,c,Math.floor(c/u),!0)),d&&l.length&&(l[l.length-1].width-=d),o.forEach(function(m){m.column.setWidth(m.width)}),l.forEach(function(m){m.column.setWidth(m.width)})}var vAe={fitData:hAe,fitDataFill:ZW,fitDataTable:ZW,fitDataStretch:gAe,fitColumns:IAe};class wP extends si{static moduleName="layout";static modes=vAe;constructor(e){super(e,"layout"),this.mode=null,this.registerTableOption("layout","fitData"),this.registerTableOption("layoutColumnsOnNewData",!1),this.registerColumnOption("widthGrow"),this.registerColumnOption("widthShrink")}initialize(){var e=this.table.options.layout;wP.modes[e]?this.mode=e:(console.warn("Layout Error - invalid mode set, defaulting to 'fitData' : "+e),this.mode="fitData"),this.table.element.setAttribute("tabulator-layout",this.mode),this.subscribe("column-init",this.initializeColumn.bind(this))}initializeColumn(e){e.definition.widthGrow&&(e.definition.widthGrow=Number(e.definition.widthGrow)),e.definition.widthShrink&&(e.definition.widthShrink=Number(e.definition.widthShrink))}getMode(){return this.mode}layout(e){var i=this.table.columnManager.columnsByIndex.find(r=>r.definition.variableHeight||r.definition.formatter==="textarea");this.dispatch("layout-refreshing"),wP.modes[this.mode].call(this,this.table.columnManager.columnsByIndex,e),i&&this.table.rowManager.normalizeHeight(!0),this.dispatch("layout-refreshed")}}var yAe={default:{groups:{item:"item",items:"items"},columns:{},data:{loading:"Loading",error:"Error"},pagination:{page_size:"Page Size",page_title:"Show Page",first:"First",first_title:"First Page",last:"Last",last_title:"Last Page",prev:"Prev",prev_title:"Prev Page",next:"Next",next_title:"Next Page",all:"All",counter:{showing:"Showing",of:"of",rows:"rows",pages:"pages"}},headerFilters:{default:"filter column...",columns:{}}}};class M$ extends si{static moduleName="localize";static langs=yAe;constructor(e){super(e),this.locale="default",this.lang=!1,this.bindings={},this.langList={},this.registerTableOption("locale",!1),this.registerTableOption("langs",{})}initialize(){this.langList=gr.deepClone(M$.langs),this.table.options.columnDefaults.headerFilterPlaceholder!==!1&&this.setHeaderFilterPlaceholder(this.table.options.columnDefaults.headerFilterPlaceholder);for(let e in this.table.options.langs)this.installLang(e,this.table.options.langs[e]);this.setLocale(this.table.options.locale),this.registerTableFunction("setLocale",this.setLocale.bind(this)),this.registerTableFunction("getLocale",this.getLocale.bind(this)),this.registerTableFunction("getLang",this.getLang.bind(this))}setHeaderFilterPlaceholder(e){this.langList.default.headerFilters.default=e}installLang(e,i){this.langList[e]?this._setLangProp(this.langList[e],i):this.langList[e]=i}_setLangProp(e,i){for(let r in i)e[r]&&typeof e[r]=="object"?this._setLangProp(e[r],i[r]):e[r]=i[r]}setLocale(e){e=e||"default";function i(r,n){for(var a in r)typeof r[a]=="object"?(n[a]||(n[a]={}),i(r[a],n[a])):n[a]=r[a]}if(e===!0&&navigator.language&&(e=navigator.language.toLowerCase()),e&&!this.langList[e]){let r=e.split("-")[0];this.langList[r]?(console.warn("Localization Error - Exact matching locale not found, using closest match: ",e,r),e=r):(console.warn("Localization Error - Matching locale not found, using default: ",e),e="default")}this.locale=e,this.lang=gr.deepClone(this.langList.default||{}),e!="default"&&i(this.langList[e],this.lang),this.dispatchExternal("localized",this.locale,this.lang),this._executeBindings()}getLocale(e){return this.locale}getLang(e){return e?this.langList[e]:this.lang}getText(e,i){var r=i?e+"|"+i:e,n=r.split("|"),a=this._getLangElement(n,this.locale);return a||""}_getLangElement(e,i){var r=this.lang;return e.forEach(function(n){var a;r&&(a=r[n],typeof a<"u"?r=a:r=!1)}),r}bind(e,i){this.bindings[e]||(this.bindings[e]=[]),this.bindings[e].push(i),i(this.getText(e),this.lang)}_executeBindings(){for(let e in this.bindings)this.bindings[e].forEach(i=>{i(this.getText(e),this.lang)})}}class bAe extends si{static moduleName="comms";constructor(e){super(e)}initialize(){this.registerTableFunction("tableComms",this.receive.bind(this))}getConnections(e){var i=[],r;return r=this.table.constructor.registry.lookupTable(e),r.forEach(n=>{this.table!==n&&i.push(n)}),i}send(e,i,r,n){var a=this.getConnections(e);a.forEach(s=>{s.tableComms(this.table.element,i,r,n)}),!a.length&&e&&console.warn("Table Connection Error - No tables matching selector found",e)}receive(e,i,r,n){if(this.table.modExists(i))return this.table.modules[i].commsReceived(e,r,n);console.warn("Inter-table Comms Error - no such module:",i)}}var wAe=Object.freeze({__proto__:null,CommsModule:bAe,LayoutModule:wP,LocalizeModule:M$});class _o{static registry={tables:[],register(e){_o.registry.tables.push(e)},deregister(e){var i=_o.registry.tables.indexOf(e);i>-1&&_o.registry.tables.splice(i,1)},lookupTable(e,i){var r=[],n,a;if(typeof e=="string"){if(n=document.querySelectorAll(e),n.length)for(var s=0;s<n.length;s++)a=_o.registry.matchElement(n[s]),a&&r.push(a)}else typeof HTMLElement<"u"&&e instanceof HTMLElement||e instanceof _o?(a=_o.registry.matchElement(e),a&&r.push(a)):Array.isArray(e)?e.forEach(function(o){r=r.concat(_o.registry.lookupTable(o))}):i||console.warn("Table Connection Error - Invalid Selector",e);return r},matchElement(e){return _o.registry.tables.find(function(i){return e instanceof _o?i===e:i.element===e})}};static findTable(e){var i=_o.registry.lookupTable(e,!0);return Array.isArray(i)&&!i.length?!1:i}}class Or extends _o{static moduleBindings={};static moduleExtensions={};static modulesRegistered=!1;static defaultModules=!1;constructor(){super()}static initializeModuleBinder(e){Or.modulesRegistered||(Or.modulesRegistered=!0,Or._registerModules(wAe,!0),e&&Or._registerModules(e))}static _extendModule(e,i,r){if(Or.moduleBindings[e]){var n=Or.moduleBindings[e][i];if(n)if(typeof r=="object")for(let a in r)n[a]=r[a];else console.warn("Module Error - Invalid value type, it must be an object");else console.warn("Module Error - property does not exist:",i)}else console.warn("Module Error - module does not exist:",e)}static _registerModules(e,i){var r=Object.values(e);i&&r.forEach(n=>{n.prototype.moduleCore=!0}),Or._registerModule(r)}static _registerModule(e){Array.isArray(e)||(e=[e]),e.forEach(i=>{Or._registerModuleBinding(i),Or._registerModuleExtensions(i)})}static _registerModuleBinding(e){e.moduleName?Or.moduleBindings[e.moduleName]=e:console.error("Unable to bind module, no moduleName defined",e.moduleName)}static _registerModuleExtensions(e){var i=e.moduleExtensions;if(e.moduleExtensions)for(let r in i){let n=i[r];if(Or.moduleBindings[r])for(let a in n)Or._extendModule(r,a,n[a]);else{Or.moduleExtensions[r]||(Or.moduleExtensions[r]={});for(let a in n)Or.moduleExtensions[r][a]||(Or.moduleExtensions[r][a]={}),Object.assign(Or.moduleExtensions[r][a],n[a])}}Or._extendModuleFromQueue(e)}static _extendModuleFromQueue(e){var i=Or.moduleExtensions[e.moduleName];if(i)for(let r in i)Or._extendModule(e.moduleName,r,i[r])}_bindModules(){var e=[],i=[],r=[];this.modules={};for(var n in Or.moduleBindings){let a=Or.moduleBindings[n],s=new a(this);this.modules[n]=s,a.prototype.moduleCore?this.modulesCore.push(s):a.moduleInitOrder?a.moduleInitOrder<0?e.push(s):i.push(s):r.push(s)}e.sort((a,s)=>a.moduleInitOrder>s.moduleInitOrder?1:-1),i.sort((a,s)=>a.moduleInitOrder>s.moduleInitOrder?1:-1),this.modulesRegular=e.concat(r.concat(i))}}class SAe extends Ra{constructor(e){super(e),this.element=this._createAlertElement(),this.msgElement=this._createMsgElement(),this.type=null,this.element.appendChild(this.msgElement)}_createAlertElement(){var e=document.createElement("div");return e.classList.add("tabulator-alert"),e}_createMsgElement(){var e=document.createElement("div");return e.classList.add("tabulator-alert-msg"),e.setAttribute("role","alert"),e}_typeClass(){return"tabulator-alert-state-"+this.type}alert(e,i="msg"){if(e){for(this.clear(),this.dispatch("alert-show",i),this.type=i;this.msgElement.firstChild;)this.msgElement.removeChild(this.msgElement.firstChild);this.msgElement.classList.add(this._typeClass()),typeof e=="function"&&(e=e()),e instanceof HTMLElement?this.msgElement.appendChild(e):this.msgElement.innerHTML=e,this.table.element.appendChild(this.element)}}clear(){this.dispatch("alert-hide",this.type),this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.msgElement.classList.remove(this._typeClass())}}class rp extends Or{static defaultOptions=eAe;static extendModule(){rp.initializeModuleBinder(),rp._extendModule(...arguments)}static registerModule(){rp.initializeModuleBinder(),rp._registerModule(...arguments)}constructor(e,i,r){super(),rp.initializeModuleBinder(r),this.options={},this.columnManager=null,this.rowManager=null,this.footerManager=null,this.alertManager=null,this.vdomHoz=null,this.externalEvents=null,this.eventBus=null,this.interactionMonitor=!1,this.browser="",this.browserSlow=!1,this.browserMobile=!1,this.rtl=!1,this.originalElement=null,this.componentFunctionBinder=new uAe(this),this.dataLoader=!1,this.modules={},this.modulesCore=[],this.modulesRegular=[],this.deprecationAdvisor=new fAe(this),this.optionsList=new oee(this,"table constructor"),this.dependencyRegistry=new mAe(this),this.initialized=!1,this.destroyed=!1,this.initializeElement(e)&&(this.initializeCoreSystems(i),setTimeout(()=>{this._create()})),this.constructor.registry.register(this)}initializeElement(e){return typeof HTMLElement<"u"&&e instanceof HTMLElement?(this.element=e,!0):typeof e=="string"?(this.element=document.querySelector(e),this.element?!0:(console.error("Tabulator Creation Error - no element found matching selector: ",e),!1)):(console.error("Tabulator Creation Error - Invalid element provided:",e),!1)}initializeCoreSystems(e){this.columnManager=new rAe(this),this.rowManager=new sAe(this),this.footerManager=new oAe(this),this.dataLoader=new cAe(this),this.alertManager=new SAe(this),this._bindModules(),this.options=this.optionsList.generate(rp.defaultOptions,e),this._clearObjectPointers(),this._mapDeprecatedFunctionality(),this.externalEvents=new dAe(this,this.options,this.options.debugEventsExternal),this.eventBus=new pAe(this.options.debugEventsInternal),this.interactionMonitor=new lAe(this),this.dataLoader.initialize(),this.footerManager.initialize(),this.dependencyRegistry.initialize()}_mapDeprecatedFunctionality(){}_clearSelection(){this.element.classList.add("tabulator-block-select"),window.getSelection?window.getSelection().empty?window.getSelection().empty():window.getSelection().removeAllRanges&&window.getSelection().removeAllRanges():document.selection&&document.selection.empty(),this.element.classList.remove("tabulator-block-select")}_create(){this.externalEvents.dispatch("tableBuilding"),this.eventBus.dispatch("table-building"),this._rtlCheck(),this._buildElement(),this._initializeTable(),this.initialized=!0,this._loadInitialData().finally(()=>{this.eventBus.dispatch("table-initialized"),this.externalEvents.dispatch("tableBuilt")})}_rtlCheck(){var e=window.getComputedStyle(this.element);switch(this.options.textDirection){case"auto":if(e.direction!=="rtl")break;case"rtl":this.element.classList.add("tabulator-rtl"),this.rtl=!0;break;case"ltr":this.element.classList.add("tabulator-ltr");default:this.rtl=!1}}_clearObjectPointers(){this.options.columns=this.options.columns.slice(0),Array.isArray(this.options.data)&&!this.options.reactiveData&&(this.options.data=this.options.data.slice(0))}_buildElement(){var e=this.element,i=this.options,r;if(e.tagName==="TABLE"){this.originalElement=this.element,r=document.createElement("div");var n=e.attributes;for(var a in n)typeof n[a]=="object"&&r.setAttribute(n[a].name,n[a].value);e.parentNode.replaceChild(r,e),this.element=e=r}for(e.classList.add("tabulator"),e.setAttribute("role","grid");e.firstChild;)e.removeChild(e.firstChild);i.height&&(i.height=isNaN(i.height)?i.height:i.height+"px",e.style.height=i.height),i.minHeight!==!1&&(i.minHeight=isNaN(i.minHeight)?i.minHeight:i.minHeight+"px",e.style.minHeight=i.minHeight),i.maxHeight!==!1&&(i.maxHeight=isNaN(i.maxHeight)?i.maxHeight:i.maxHeight+"px",e.style.maxHeight=i.maxHeight)}_initializeTable(){var e=this.element,i=this.options;this.interactionMonitor.initialize(),this.columnManager.initialize(),this.rowManager.initialize(),this._detectBrowser(),this.modulesCore.forEach(r=>{r.initialize()}),e.appendChild(this.columnManager.getElement()),e.appendChild(this.rowManager.getElement()),i.footerElement&&this.footerManager.activate(),i.autoColumns&&i.data&&this.columnManager.generateColumnsFromRowData(this.options.data),this.modulesRegular.forEach(r=>{r.initialize()}),this.columnManager.setColumns(i.columns),this.eventBus.dispatch("table-built")}_loadInitialData(){return this.dataLoader.load(this.options.data).finally(()=>{this.columnManager.verticalAlignHeaders()})}destroy(){var e=this.element;for(this.destroyed=!0,this.constructor.registry.deregister(this),this.eventBus.dispatch("table-destroy"),this.rowManager.destroy();e.firstChild;)e.removeChild(e.firstChild);e.classList.remove("tabulator"),this.externalEvents.dispatch("tableDestroyed")}_detectBrowser(){var e=navigator.userAgent||navigator.vendor||window.opera;e.indexOf("Trident")>-1?(this.browser="ie",this.browserSlow=!0):e.indexOf("Edge")>-1?(this.browser="edge",this.browserSlow=!0):e.indexOf("Firefox")>-1?(this.browser="firefox",this.browserSlow=!1):e.indexOf("Mac OS")>-1?(this.browser="safari",this.browserSlow=!1):(this.browser="other",this.browserSlow=!1),this.browserMobile=/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw-(n|u)|c55\/|capi|ccwa|cdm-|cell|chtm|cldc|cmd-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc-s|devi|dica|dmob|do(c|p)o|ds(12|-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(-|_)|g1 u|g560|gene|gf-5|g-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd-(m|p|t)|hei-|hi(pt|ta)|hp( i|ip)|hs-c|ht(c(-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i-(20|go|ma)|i230|iac( |-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|-[a-w])|libw|lynx|m1-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|-([1-8]|c))|phil|pire|pl(ay|uc)|pn-2|po(ck|rt|se)|prox|psio|pt-g|qa-a|qc(07|12|21|32|60|-[2-7]|i-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h-|oo|p-)|sdk\/|se(c(-|0|1)|47|mc|nd|ri)|sgh-|shar|sie(-|m)|sk-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h-|v-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl-|tdg-|tel(i|m)|tim-|t-mo|to(pl|sh)|ts(70|m-|m3|m5)|tx-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas-|your|zeto|zte-/i.test(e.slice(0,4))}initGuard(e,i){var r,n;return this.options.debugInitialization&&!this.initialized&&(e||(r=new Error().stack.split(`
`),n=r[0]=="Error"?r[2]:r[1],n[0]==" "?e=n.trim().split(" ")[1].split(".")[1]:e=n.trim().split("@")[0]),console.warn("Table Not Initialized - Calling the "+e+" function before the table is initialized may result in inconsistent behavior, Please wait for the `tableBuilt` event before calling this function."+(i?" "+i:""))),this.initialized}blockRedraw(){this.initGuard(),this.eventBus.dispatch("redraw-blocking"),this.rowManager.blockRedraw(),this.columnManager.blockRedraw(),this.eventBus.dispatch("redraw-blocked")}restoreRedraw(){this.initGuard(),this.eventBus.dispatch("redraw-restoring"),this.rowManager.restoreRedraw(),this.columnManager.restoreRedraw(),this.eventBus.dispatch("redraw-restored")}setData(e,i,r){return this.initGuard(!1,"To set initial data please use the 'data' property in the table constructor."),this.dataLoader.load(e,i,r,!1)}clearData(){this.initGuard(),this.dataLoader.blockActiveLoad(),this.rowManager.clearData()}getData(e){return this.rowManager.getData(e)}getDataCount(e){return this.rowManager.getDataCount(e)}replaceData(e,i,r){return this.initGuard(),this.dataLoader.load(e,i,r,!0,!0)}updateData(e){var i=0;return this.initGuard(),new Promise((r,n)=>{this.dataLoader.blockActiveLoad(),typeof e=="string"&&(e=JSON.parse(e)),e&&e.length>0?e.forEach(a=>{var s=this.rowManager.findRow(a[this.options.index]);s?(i++,s.updateData(a).then(()=>{i--,i||r()}).catch(o=>{n("Update Error - Unable to update row",a,o)})):n("Update Error - Unable to find row",a)}):(console.warn("Update Error - No data provided"),n("Update Error - No data provided"))})}addData(e,i,r){return this.initGuard(),new Promise((n,a)=>{this.dataLoader.blockActiveLoad(),typeof e=="string"&&(e=JSON.parse(e)),e?this.rowManager.addRows(e,i,r).then(s=>{var o=[];s.forEach(function(l){o.push(l.getComponent())}),n(o)}):(console.warn("Update Error - No data provided"),a("Update Error - No data provided"))})}updateOrAddData(e){var i=[],r=0;return this.initGuard(),new Promise((n,a)=>{this.dataLoader.blockActiveLoad(),typeof e=="string"&&(e=JSON.parse(e)),e&&e.length>0?e.forEach(s=>{var o=this.rowManager.findRow(s[this.options.index]);r++,o?o.updateData(s).then(()=>{r--,i.push(o.getComponent()),r||n(i)}):this.rowManager.addRows(s).then(l=>{r--,i.push(l[0].getComponent()),r||n(i)})}):(console.warn("Update Error - No data provided"),a("Update Error - No data provided"))})}getRow(e){var i=this.rowManager.findRow(e);return i?i.getComponent():(console.warn("Find Error - No matching row found:",e),!1)}getRowFromPosition(e){var i=this.rowManager.getRowFromPosition(e);return i?i.getComponent():(console.warn("Find Error - No matching row found:",e),!1)}deleteRow(e){var i=[];this.initGuard(),Array.isArray(e)||(e=[e]);for(let r of e){let n=this.rowManager.findRow(r,!0);if(n)i.push(n);else return console.error("Delete Error - No matching row found:",r),Promise.reject("Delete Error - No matching row found")}return i.sort((r,n)=>this.rowManager.rows.indexOf(r)>this.rowManager.rows.indexOf(n)?1:-1),i.forEach(r=>{r.delete()}),this.rowManager.reRenderInPosition(),Promise.resolve()}addRow(e,i,r){return this.initGuard(),typeof e=="string"&&(e=JSON.parse(e)),this.rowManager.addRows(e,i,r,!0).then(n=>n[0].getComponent())}updateOrAddRow(e,i){var r=this.rowManager.findRow(e);return this.initGuard(),typeof i=="string"&&(i=JSON.parse(i)),r?r.updateData(i).then(()=>r.getComponent()):this.rowManager.addRows(i).then(n=>n[0].getComponent())}updateRow(e,i){var r=this.rowManager.findRow(e);return this.initGuard(),typeof i=="string"&&(i=JSON.parse(i)),r?r.updateData(i).then(()=>Promise.resolve(r.getComponent())):(console.warn("Update Error - No matching row found:",e),Promise.reject("Update Error - No matching row found"))}scrollToRow(e,i,r){var n=this.rowManager.findRow(e);return n?this.rowManager.scrollToRow(n,i,r):(console.warn("Scroll Error - No matching row found:",e),Promise.reject("Scroll Error - No matching row found"))}moveRow(e,i,r){var n=this.rowManager.findRow(e);this.initGuard(),n?n.moveToRow(i,r):console.warn("Move Error - No matching row found:",e)}getRows(e){return this.rowManager.getComponents(e)}getRowPosition(e){var i=this.rowManager.findRow(e);return i?i.getPosition():(console.warn("Position Error - No matching row found:",e),!1)}setColumns(e){this.initGuard(!1,"To set initial columns please use the 'columns' property in the table constructor"),this.columnManager.setColumns(e)}getColumns(e){return this.columnManager.getComponents(e)}getColumn(e){var i=this.columnManager.findColumn(e);return i?i.getComponent():(console.warn("Find Error - No matching column found:",e),!1)}getColumnDefinitions(){return this.columnManager.getDefinitionTree()}showColumn(e){var i=this.columnManager.findColumn(e);if(this.initGuard(),i)i.show();else return console.warn("Column Show Error - No matching column found:",e),!1}hideColumn(e){var i=this.columnManager.findColumn(e);if(this.initGuard(),i)i.hide();else return console.warn("Column Hide Error - No matching column found:",e),!1}toggleColumn(e){var i=this.columnManager.findColumn(e);if(this.initGuard(),i)i.visible?i.hide():i.show();else return console.warn("Column Visibility Toggle Error - No matching column found:",e),!1}addColumn(e,i,r){var n=this.columnManager.findColumn(r);return this.initGuard(),this.columnManager.addColumn(e,i,n).then(a=>a.getComponent())}deleteColumn(e){var i=this.columnManager.findColumn(e);return this.initGuard(),i?i.delete():(console.warn("Column Delete Error - No matching column found:",e),Promise.reject())}updateColumnDefinition(e,i){var r=this.columnManager.findColumn(e);return this.initGuard(),r?r.updateDefinition(i):(console.warn("Column Update Error - No matching column found:",e),Promise.reject())}moveColumn(e,i,r){var n=this.columnManager.findColumn(e),a=this.columnManager.findColumn(i);this.initGuard(),n?a?this.columnManager.moveColumn(n,a,r):console.warn("Move Error - No matching column found:",a):console.warn("Move Error - No matching column found:",e)}scrollToColumn(e,i,r){return new Promise((n,a)=>{var s=this.columnManager.findColumn(e);return s?this.columnManager.scrollToColumn(s,i,r):(console.warn("Scroll Error - No matching column found:",e),Promise.reject("Scroll Error - No matching column found"))})}redraw(e){this.initGuard(),this.columnManager.redraw(e),this.rowManager.redraw(e)}setHeight(e){this.options.height=isNaN(e)?e:e+"px",this.element.style.height=this.options.height,this.rowManager.initializeRenderer(),this.rowManager.redraw(!0)}on(e,i){this.externalEvents.subscribe(e,i)}off(e,i){this.externalEvents.unsubscribe(e,i)}dispatchEvent(){var e=Array.from(arguments);e.shift(),this.externalEvents.dispatch(...arguments)}alert(e,i){this.initGuard(),this.alertManager.alert(e,i)}clearAlert(){this.initGuard(),this.alertManager.clear()}modExists(e,i){return this.modules[e]?!0:(i&&console.error("Tabulator Module Not Installed: "+e),!1)}module(e){var i=this.modules[e];return i||console.error("Tabulator module not installed: "+e),i}}var dy=rp;class UAe extends dy{static extendModule(){dy.initializeModuleBinder(VA),dy._extendModule(...arguments)}static registerModule(){dy.initializeModuleBinder(VA),dy._registerModule(...arguments)}constructor(e,i,r){super(e,i,VA)}}var BS=UAe;function KC({anchorId:t}){const e=BS.findTable(`#${t}`)[0];e&&e.destroy()}function TAe(t,e){return t?HC.dateTime.convertTime(t,e):""}function lee(t){const e=document.createElement("span");if(!t.getColumn().getDefinition().field)return e.className="schedule-cell",e;const r=t.getValue(),{potentialParticipants:n,eventName:a="",roundName:s="",schedule:o={},winningSide:l,matchUpId:u,sides:c}=r||{},{courtOrder:d="",scheduledTime:p="",courtId:f="",timeModifiers:m,venueId:h=""}=o;if(e.setAttribute("courtOrder",d),e.setAttribute("courtId",f),e.setAttribute("venueId",h),e.className="schedule-cell dragdrop",e.ondragover=R=>R.preventDefault(),u&&(e.draggable=!0,e.id=u,l&&e.classList.add("matchup-complete")),!u)return e;const g=`${a} ${s}`,I=R=>R.person?.standardFamilyName?.toUpperCase()||R.participantName,v=n?.map(R=>R?.map(C=>`<span class='potential nowrap'>${I(C)}</span>`).join('<span style="font-weight: bold">&nbsp;or&nbsp;</span>')),w=R=>{const C=c?.find(M=>R===M.sideNumber)?.participant?.participantName;if(C)return l===R?`<span style='font-weight: bold'>${C}</span>`:C},y=w(1)||v?.shift()||"Unkown",b=w(2)||v?.shift()||"Unknown";e.id=u;const S=document.createElement("div");S.className="header flexrow",S.innerHTML=(m?.[0]&&FCe[m[0]]+"&nbsp;"||"")+TAe(p,!1),e.appendChild(S);const U=document.createElement("div");U.className="catround",U.innerHTML=g,e.appendChild(U);const T=document.createElement("div");T.className="scheduled_teams";const P=document.createElement("div");P.className="scheduled_team",P.style.fontSize="1em",P.innerHTML=y,T.appendChild(P);const D=document.createElement("div");D.className="divider",D.innerHTML="vs.",T.appendChild(D);const E=document.createElement("div");if(E.className="scheduled_team",E.style.fontSize="1em",E.innerHTML=b,T.appendChild(E),l){const R=document.createElement("div");R.innerHTML=r.score?.scoreStringSide1||"",T.appendChild(R)}return e.appendChild(T),e}function DAe({count:t}){return t>0?HC.generateRange(0,t).map(()=>({headerHozAlign:Gi,formatter:lee,headerSort:!1,resizable:!1,minWidth:150})):[]}function PAe(t){t.getElement().style.backgroundColor="var(--chc-bg-primary)";const e=document.createElement("span"),i=t.getRow().getData();return e.innerHTML=i.rowNumber,e}function EAe(){return{formatter:PAe,headerSort:!1,resizable:!1,hozAlign:Gi,frozen:!0,width:55}}function RAe({courtsData:t,courtPrefix:e}){const i=xCe-t?.length||0,r=i<=0?1:i,n=DAe({count:r}),a=EAe(),s=(o,l)=>({field:`${e}${l}`,title:o.courtName,headerHozAlign:Gi,formatter:lee,headerSort:!1,resizable:!1,hozAlign:Gi,minWidth:150});return[].concat([a],t?.map(s),n)}function CAe(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var nD={exports:{}},MAe=nD.exports,ez;function NAe(){return ez||(ez=1,(function(t,e){(function(i,r){t.exports=r()})(MAe,(function(){var i=1e3,r=6e4,n=36e5,a="millisecond",s="second",o="minute",l="hour",u="day",c="week",d="month",p="quarter",f="year",m="date",h="Invalid Date",g=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,I=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,v={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(M){var N=["th","st","nd","rd"],A=M%100;return"["+M+(N[(A-20)%10]||N[A]||N[0])+"]"}},w=function(M,N,A){var O=String(M);return!O||O.length>=N?M:""+Array(N+1-O.length).join(A)+M},y={s:w,z:function(M){var N=-M.utcOffset(),A=Math.abs(N),O=Math.floor(A/60),k=A%60;return(N<=0?"+":"-")+w(O,2,"0")+":"+w(k,2,"0")},m:function M(N,A){if(N.date()<A.date())return-M(A,N);var O=12*(A.year()-N.year())+(A.month()-N.month()),k=N.clone().add(O,d),F=A-k<0,x=N.clone().add(O+(F?-1:1),d);return+(-(O+(A-k)/(F?k-x:x-k))||0)},a:function(M){return M<0?Math.ceil(M)||0:Math.floor(M)},p:function(M){return{M:d,y:f,w:c,d:u,D:m,h:l,m:o,s,ms:a,Q:p}[M]||String(M||"").toLowerCase().replace(/s$/,"")},u:function(M){return M===void 0}},b="en",S={};S[b]=v;var U="$isDayjsObject",T=function(M){return M instanceof R||!(!M||!M[U])},P=function M(N,A,O){var k;if(!N)return b;if(typeof N=="string"){var F=N.toLowerCase();S[F]&&(k=F),A&&(S[F]=A,k=F);var x=N.split("-");if(!k&&x.length>1)return M(x[0])}else{var L=N.name;S[L]=N,k=L}return!O&&k&&(b=k),k||!O&&b},D=function(M,N){if(T(M))return M.clone();var A=typeof N=="object"?N:{};return A.date=M,A.args=arguments,new R(A)},E=y;E.l=P,E.i=T,E.w=function(M,N){return D(M,{locale:N.$L,utc:N.$u,x:N.$x,$offset:N.$offset})};var R=(function(){function M(A){this.$L=P(A.locale,null,!0),this.parse(A),this.$x=this.$x||A.x||{},this[U]=!0}var N=M.prototype;return N.parse=function(A){this.$d=(function(O){var k=O.date,F=O.utc;if(k===null)return new Date(NaN);if(E.u(k))return new Date;if(k instanceof Date)return new Date(k);if(typeof k=="string"&&!/Z$/i.test(k)){var x=k.match(g);if(x){var L=x[2]-1||0,$=(x[7]||"0").substring(0,3);return F?new Date(Date.UTC(x[1],L,x[3]||1,x[4]||0,x[5]||0,x[6]||0,$)):new Date(x[1],L,x[3]||1,x[4]||0,x[5]||0,x[6]||0,$)}}return new Date(k)})(A),this.init()},N.init=function(){var A=this.$d;this.$y=A.getFullYear(),this.$M=A.getMonth(),this.$D=A.getDate(),this.$W=A.getDay(),this.$H=A.getHours(),this.$m=A.getMinutes(),this.$s=A.getSeconds(),this.$ms=A.getMilliseconds()},N.$utils=function(){return E},N.isValid=function(){return this.$d.toString()!==h},N.isSame=function(A,O){var k=D(A);return this.startOf(O)<=k&&k<=this.endOf(O)},N.isAfter=function(A,O){return D(A)<this.startOf(O)},N.isBefore=function(A,O){return this.endOf(O)<D(A)},N.$g=function(A,O,k){return E.u(A)?this[O]:this.set(k,A)},N.unix=function(){return Math.floor(this.valueOf()/1e3)},N.valueOf=function(){return this.$d.getTime()},N.startOf=function(A,O){var k=this,F=!!E.u(O)||O,x=E.p(A),L=function(Y,X){var Z=E.w(k.$u?Date.UTC(k.$y,X,Y):new Date(k.$y,X,Y),k);return F?Z:Z.endOf(u)},$=function(Y,X){return E.w(k.toDate()[Y].apply(k.toDate("s"),(F?[0,0,0,0]:[23,59,59,999]).slice(X)),k)},V=this.$W,_=this.$M,B=this.$D,G="set"+(this.$u?"UTC":"");switch(x){case f:return F?L(1,0):L(31,11);case d:return F?L(1,_):L(0,_+1);case c:var j=this.$locale().weekStart||0,K=(V<j?V+7:V)-j;return L(F?B-K:B+(6-K),_);case u:case m:return $(G+"Hours",0);case l:return $(G+"Minutes",1);case o:return $(G+"Seconds",2);case s:return $(G+"Milliseconds",3);default:return this.clone()}},N.endOf=function(A){return this.startOf(A,!1)},N.$set=function(A,O){var k,F=E.p(A),x="set"+(this.$u?"UTC":""),L=(k={},k[u]=x+"Date",k[m]=x+"Date",k[d]=x+"Month",k[f]=x+"FullYear",k[l]=x+"Hours",k[o]=x+"Minutes",k[s]=x+"Seconds",k[a]=x+"Milliseconds",k)[F],$=F===u?this.$D+(O-this.$W):O;if(F===d||F===f){var V=this.clone().set(m,1);V.$d[L]($),V.init(),this.$d=V.set(m,Math.min(this.$D,V.daysInMonth())).$d}else L&&this.$d[L]($);return this.init(),this},N.set=function(A,O){return this.clone().$set(A,O)},N.get=function(A){return this[E.p(A)]()},N.add=function(A,O){var k,F=this;A=Number(A);var x=E.p(O),L=function(_){var B=D(F);return E.w(B.date(B.date()+Math.round(_*A)),F)};if(x===d)return this.set(d,this.$M+A);if(x===f)return this.set(f,this.$y+A);if(x===u)return L(1);if(x===c)return L(7);var $=(k={},k[o]=r,k[l]=n,k[s]=i,k)[x]||1,V=this.$d.getTime()+A*$;return E.w(V,this)},N.subtract=function(A,O){return this.add(-1*A,O)},N.format=function(A){var O=this,k=this.$locale();if(!this.isValid())return k.invalidDate||h;var F=A||"YYYY-MM-DDTHH:mm:ssZ",x=E.z(this),L=this.$H,$=this.$m,V=this.$M,_=k.weekdays,B=k.months,G=k.meridiem,j=function(X,Z,J,ae){return X&&(X[Z]||X(O,F))||J[Z].slice(0,ae)},K=function(X){return E.s(L%12||12,X,"0")},Y=G||function(X,Z,J){var ae=X<12?"AM":"PM";return J?ae.toLowerCase():ae};return F.replace(I,(function(X,Z){return Z||(function(J){switch(J){case"YY":return String(O.$y).slice(-2);case"YYYY":return E.s(O.$y,4,"0");case"M":return V+1;case"MM":return E.s(V+1,2,"0");case"MMM":return j(k.monthsShort,V,B,3);case"MMMM":return j(B,V);case"D":return O.$D;case"DD":return E.s(O.$D,2,"0");case"d":return String(O.$W);case"dd":return j(k.weekdaysMin,O.$W,_,2);case"ddd":return j(k.weekdaysShort,O.$W,_,3);case"dddd":return _[O.$W];case"H":return String(L);case"HH":return E.s(L,2,"0");case"h":return K(1);case"hh":return K(2);case"a":return Y(L,$,!0);case"A":return Y(L,$,!1);case"m":return String($);case"mm":return E.s($,2,"0");case"s":return String(O.$s);case"ss":return E.s(O.$s,2,"0");case"SSS":return E.s(O.$ms,3,"0");case"Z":return x}return null})(X)||x.replace(":","")}))},N.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},N.diff=function(A,O,k){var F,x=this,L=E.p(O),$=D(A),V=($.utcOffset()-this.utcOffset())*r,_=this-$,B=function(){return E.m(x,$)};switch(L){case f:F=B()/12;break;case d:F=B();break;case p:F=B()/3;break;case c:F=(_-V)/6048e5;break;case u:F=(_-V)/864e5;break;case l:F=_/n;break;case o:F=_/r;break;case s:F=_/i;break;default:F=_}return k?F:E.a(F)},N.daysInMonth=function(){return this.endOf(d).$D},N.$locale=function(){return S[this.$L]},N.locale=function(A,O){if(!A)return this.$L;var k=this.clone(),F=P(A,O,!0);return F&&(k.$L=F),k},N.clone=function(){return E.w(this.$d,this)},N.toDate=function(){return new Date(this.valueOf())},N.toJSON=function(){return this.isValid()?this.toISOString():null},N.toISOString=function(){return this.$d.toISOString()},N.toString=function(){return this.$d.toUTCString()},M})(),C=R.prototype;return D.prototype=C,[["$ms",a],["$s",s],["$m",o],["$H",l],["$W",u],["$M",d],["$y",f],["$D",m]].forEach((function(M){C[M[1]]=function(N){return this.$g(N,M[0],M[1])}})),D.extend=function(M,N){return M.$i||(M(N,R,D),M.$i=!0),D},D.locale=P,D.isDayjs=T,D.unix=function(M){return D(1e3*M)},D.en=S[b],D.Ls=S,D.p={},D}))})(nD)),nD.exports}var AAe=NAe();const kAe=CAe(AAe);function OAe(t){const{dateMatchUps:e=[],completedMatchUps:i=[],groupInfo:r,mappedParticipants:n}=t?.data??{},a=e.concat(...i),s=a.reduce((b,S)=>{const U=S?.schedule?.scheduledDate;return U&&!b.includes(U)&&b.push(U),b},[]),o=s[0];let l;const u=b=>{for(const S of b.sides||[])S.participantId&&(S.participant=n[S.participantId],S.participant?.individualParticipantIds&&(S.participant.individualParticipants=S.participant.individualParticipantIds.map(U=>n[U])))},c=({scheduledDate:b})=>{const S=t?.data?.courtsData.map(D=>{const{matchUps:E,...R}=D;return E.forEach(u),{...R,matchUps:E.filter(C=>C.schedule?.scheduledDate===b)}}),U="C|",T=Y_.courtGridRows({courtsData:S,courtPrefix:U,minRowsCount:10,scheduledDate:b}).rows,P=RAe({courtsData:S,courtPrefix:U});return T?.forEach((D,E)=>{D.rowId=`rowId-${E+1}`,D.rowNumber=E+1}),{rows:T,columns:P,courtsCount:S?.length??0,courtsData:S,groupInfo:r}},d=({scheduledDate:b})=>{const{rows:S}=c({scheduledDate:b});l?.replaceData(S),l.matchUps=a},p=b=>kAe(b).format("dddd MMM D"),f=s.map(b=>({onClick:()=>d({scheduledDate:b}),label:p(b),value:b,close:!0})),m={label:p(o),options:f,id:"dateSelector",modifyLabel:!0,selection:!0},h=document.getElementById("scheduleHeader");LCe(h);const g=lm({button:m});h.appendChild(g),KC({anchorId:"tournamentSchedule"});const I=document.getElementById("tournamentSchedule"),{rows:v=[],columns:w=[],courtsCount:y}=c({scheduledDate:o});return l=new BS(I,{height:window.innerHeight*.84,renderHorizontal:"virtual",placeholder:"No courts",index:"rowId",data:v,columns:w}),{table:l,courtsCount:y}}function xAe(){return"tmxToken"}function uee(t,e){return function(){return t.apply(e,arguments)}}const{toString:FAe}=Object.prototype,{getPrototypeOf:N$}=Object,{iterator:XC,toStringTag:cee}=Symbol,JC=(t=>e=>{const i=FAe.call(e);return t[i]||(t[i]=i.slice(8,-1).toLowerCase())})(Object.create(null)),Mu=t=>(t=t.toLowerCase(),e=>JC(e)===t),QC=t=>e=>typeof e===t,{isArray:Dv}=Array,fI=QC("undefined");function VS(t){return t!==null&&!fI(t)&&t.constructor!==null&&!fI(t.constructor)&&_s(t.constructor.isBuffer)&&t.constructor.isBuffer(t)}const dee=Mu("ArrayBuffer");function LAe(t){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(t):e=t&&t.buffer&&dee(t.buffer),e}const _Ae=QC("string"),_s=QC("function"),pee=QC("number"),jS=t=>t!==null&&typeof t=="object",$Ae=t=>t===!0||t===!1,aD=t=>{if(JC(t)!=="object")return!1;const e=N$(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(cee in t)&&!(XC in t)},BAe=t=>{if(!jS(t)||VS(t))return!1;try{return Object.keys(t).length===0&&Object.getPrototypeOf(t)===Object.prototype}catch{return!1}},VAe=Mu("Date"),jAe=Mu("File"),GAe=Mu("Blob"),HAe=Mu("FileList"),WAe=t=>jS(t)&&_s(t.pipe),zAe=t=>{let e;return t&&(typeof FormData=="function"&&t instanceof FormData||_s(t.append)&&((e=JC(t))==="formdata"||e==="object"&&_s(t.toString)&&t.toString()==="[object FormData]"))},qAe=Mu("URLSearchParams"),[YAe,KAe,XAe,JAe]=["ReadableStream","Request","Response","Headers"].map(Mu),QAe=t=>t.trim?t.trim():t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function GS(t,e,{allOwnKeys:i=!1}={}){if(t===null||typeof t>"u")return;let r,n;if(typeof t!="object"&&(t=[t]),Dv(t))for(r=0,n=t.length;r<n;r++)e.call(null,t[r],r,t);else{if(VS(t))return;const a=i?Object.getOwnPropertyNames(t):Object.keys(t),s=a.length;let o;for(r=0;r<s;r++)o=a[r],e.call(null,t[o],o,t)}}function fee(t,e){if(VS(t))return null;e=e.toLowerCase();const i=Object.keys(t);let r=i.length,n;for(;r-- >0;)if(n=i[r],e===n.toLowerCase())return n;return null}const qf=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,mee=t=>!fI(t)&&t!==qf;function WO(){const{caseless:t,skipUndefined:e}=mee(this)&&this||{},i={},r=(n,a)=>{if(a==="__proto__"||a==="constructor"||a==="prototype")return;const s=t&&fee(i,a)||a;aD(i[s])&&aD(n)?i[s]=WO(i[s],n):aD(n)?i[s]=WO({},n):Dv(n)?i[s]=n.slice():(!e||!fI(n))&&(i[s]=n)};for(let n=0,a=arguments.length;n<a;n++)arguments[n]&&GS(arguments[n],r);return i}const ZAe=(t,e,i,{allOwnKeys:r}={})=>(GS(e,(n,a)=>{i&&_s(n)?Object.defineProperty(t,a,{value:uee(n,i),writable:!0,enumerable:!0,configurable:!0}):Object.defineProperty(t,a,{value:n,writable:!0,enumerable:!0,configurable:!0})},{allOwnKeys:r}),t),eke=t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),tke=(t,e,i,r)=>{t.prototype=Object.create(e.prototype,r),Object.defineProperty(t.prototype,"constructor",{value:t,writable:!0,enumerable:!1,configurable:!0}),Object.defineProperty(t,"super",{value:e.prototype}),i&&Object.assign(t.prototype,i)},ike=(t,e,i,r)=>{let n,a,s;const o={};if(e=e||{},t==null)return e;do{for(n=Object.getOwnPropertyNames(t),a=n.length;a-- >0;)s=n[a],(!r||r(s,t,e))&&!o[s]&&(e[s]=t[s],o[s]=!0);t=i!==!1&&N$(t)}while(t&&(!i||i(t,e))&&t!==Object.prototype);return e},rke=(t,e,i)=>{t=String(t),(i===void 0||i>t.length)&&(i=t.length),i-=e.length;const r=t.indexOf(e,i);return r!==-1&&r===i},nke=t=>{if(!t)return null;if(Dv(t))return t;let e=t.length;if(!pee(e))return null;const i=new Array(e);for(;e-- >0;)i[e]=t[e];return i},ake=(t=>e=>t&&e instanceof t)(typeof Uint8Array<"u"&&N$(Uint8Array)),ske=(t,e)=>{const r=(t&&t[XC]).call(t);let n;for(;(n=r.next())&&!n.done;){const a=n.value;e.call(t,a[0],a[1])}},oke=(t,e)=>{let i;const r=[];for(;(i=t.exec(e))!==null;)r.push(i);return r},lke=Mu("HTMLFormElement"),uke=t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(i,r,n){return r.toUpperCase()+n}),tz=(({hasOwnProperty:t})=>(e,i)=>t.call(e,i))(Object.prototype),cke=Mu("RegExp"),hee=(t,e)=>{const i=Object.getOwnPropertyDescriptors(t),r={};GS(i,(n,a)=>{let s;(s=e(n,a,t))!==!1&&(r[a]=s||n)}),Object.defineProperties(t,r)},dke=t=>{hee(t,(e,i)=>{if(_s(t)&&["arguments","caller","callee"].indexOf(i)!==-1)return!1;const r=t[i];if(_s(r)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+i+"'")})}})},pke=(t,e)=>{const i={},r=n=>{n.forEach(a=>{i[a]=!0})};return Dv(t)?r(t):r(String(t).split(e)),i},fke=()=>{},mke=(t,e)=>t!=null&&Number.isFinite(t=+t)?t:e;function hke(t){return!!(t&&_s(t.append)&&t[cee]==="FormData"&&t[XC])}const gke=t=>{const e=new Array(10),i=(r,n)=>{if(jS(r)){if(e.indexOf(r)>=0)return;if(VS(r))return r;if(!("toJSON"in r)){e[n]=r;const a=Dv(r)?[]:{};return GS(r,(s,o)=>{const l=i(s,n+1);!fI(l)&&(a[o]=l)}),e[n]=void 0,a}}return r};return i(t,0)},Ike=Mu("AsyncFunction"),vke=t=>t&&(jS(t)||_s(t))&&_s(t.then)&&_s(t.catch),gee=((t,e)=>t?setImmediate:e?((i,r)=>(qf.addEventListener("message",({source:n,data:a})=>{n===qf&&a===i&&r.length&&r.shift()()},!1),n=>{r.push(n),qf.postMessage(i,"*")}))(`axios@${Math.random()}`,[]):i=>setTimeout(i))(typeof setImmediate=="function",_s(qf.postMessage)),yke=typeof queueMicrotask<"u"?queueMicrotask.bind(qf):typeof process<"u"&&process.nextTick||gee,bke=t=>t!=null&&_s(t[XC]),he={isArray:Dv,isArrayBuffer:dee,isBuffer:VS,isFormData:zAe,isArrayBufferView:LAe,isString:_Ae,isNumber:pee,isBoolean:$Ae,isObject:jS,isPlainObject:aD,isEmptyObject:BAe,isReadableStream:YAe,isRequest:KAe,isResponse:XAe,isHeaders:JAe,isUndefined:fI,isDate:VAe,isFile:jAe,isBlob:GAe,isRegExp:cke,isFunction:_s,isStream:WAe,isURLSearchParams:qAe,isTypedArray:ake,isFileList:HAe,forEach:GS,merge:WO,extend:ZAe,trim:QAe,stripBOM:eke,inherits:tke,toFlatObject:ike,kindOf:JC,kindOfTest:Mu,endsWith:rke,toArray:nke,forEachEntry:ske,matchAll:oke,isHTMLForm:lke,hasOwnProperty:tz,hasOwnProp:tz,reduceDescriptors:hee,freezeMethods:dke,toObjectSet:pke,toCamelCase:uke,noop:fke,toFiniteNumber:mke,findKey:fee,global:qf,isContextDefined:mee,isSpecCompliantForm:hke,toJSONObject:gke,isAsyncFn:Ike,isThenable:vke,setImmediate:gee,asap:yke,isIterable:bke};let Mt=class Iee extends Error{static from(e,i,r,n,a,s){const o=new Iee(e.message,i||e.code,r,n,a);return o.cause=e,o.name=e.name,s&&Object.assign(o,s),o}constructor(e,i,r,n,a){super(e),this.name="AxiosError",this.isAxiosError=!0,i&&(this.code=i),r&&(this.config=r),n&&(this.request=n),a&&(this.response=a,this.status=a.status)}toJSON(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:he.toJSONObject(this.config),code:this.code,status:this.status}}};Mt.ERR_BAD_OPTION_VALUE="ERR_BAD_OPTION_VALUE";Mt.ERR_BAD_OPTION="ERR_BAD_OPTION";Mt.ECONNABORTED="ECONNABORTED";Mt.ETIMEDOUT="ETIMEDOUT";Mt.ERR_NETWORK="ERR_NETWORK";Mt.ERR_FR_TOO_MANY_REDIRECTS="ERR_FR_TOO_MANY_REDIRECTS";Mt.ERR_DEPRECATED="ERR_DEPRECATED";Mt.ERR_BAD_RESPONSE="ERR_BAD_RESPONSE";Mt.ERR_BAD_REQUEST="ERR_BAD_REQUEST";Mt.ERR_CANCELED="ERR_CANCELED";Mt.ERR_NOT_SUPPORT="ERR_NOT_SUPPORT";Mt.ERR_INVALID_URL="ERR_INVALID_URL";const wke=null;function zO(t){return he.isPlainObject(t)||he.isArray(t)}function vee(t){return he.endsWith(t,"[]")?t.slice(0,-2):t}function iz(t,e,i){return t?t.concat(e).map(function(n,a){return n=vee(n),!i&&a?"["+n+"]":n}).join(i?".":""):e}function Ske(t){return he.isArray(t)&&!t.some(zO)}const Uke=he.toFlatObject(he,{},null,function(e){return/^is[A-Z]/.test(e)});function ZC(t,e,i){if(!he.isObject(t))throw new TypeError("target must be an object");e=e||new FormData,i=he.toFlatObject(i,{metaTokens:!0,dots:!1,indexes:!1},!1,function(h,g){return!he.isUndefined(g[h])});const r=i.metaTokens,n=i.visitor||c,a=i.dots,s=i.indexes,l=(i.Blob||typeof Blob<"u"&&Blob)&&he.isSpecCompliantForm(e);if(!he.isFunction(n))throw new TypeError("visitor must be a function");function u(m){if(m===null)return"";if(he.isDate(m))return m.toISOString();if(he.isBoolean(m))return m.toString();if(!l&&he.isBlob(m))throw new Mt("Blob is not supported. Use a Buffer instead.");return he.isArrayBuffer(m)||he.isTypedArray(m)?l&&typeof Blob=="function"?new Blob([m]):Buffer.from(m):m}function c(m,h,g){let I=m;if(m&&!g&&typeof m=="object"){if(he.endsWith(h,"{}"))h=r?h:h.slice(0,-2),m=JSON.stringify(m);else if(he.isArray(m)&&Ske(m)||(he.isFileList(m)||he.endsWith(h,"[]"))&&(I=he.toArray(m)))return h=vee(h),I.forEach(function(w,y){!(he.isUndefined(w)||w===null)&&e.append(s===!0?iz([h],y,a):s===null?h:h+"[]",u(w))}),!1}return zO(m)?!0:(e.append(iz(g,h,a),u(m)),!1)}const d=[],p=Object.assign(Uke,{defaultVisitor:c,convertValue:u,isVisitable:zO});function f(m,h){if(!he.isUndefined(m)){if(d.indexOf(m)!==-1)throw Error("Circular reference detected in "+h.join("."));d.push(m),he.forEach(m,function(I,v){(!(he.isUndefined(I)||I===null)&&n.call(e,I,he.isString(v)?v.trim():v,h,p))===!0&&f(I,h?h.concat(v):[v])}),d.pop()}}if(!he.isObject(t))throw new TypeError("data must be an object");return f(t),e}function rz(t){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(r){return e[r]})}function A$(t,e){this._pairs=[],t&&ZC(t,this,e)}const yee=A$.prototype;yee.append=function(e,i){this._pairs.push([e,i])};yee.toString=function(e){const i=e?function(r){return e.call(this,r,rz)}:rz;return this._pairs.map(function(n){return i(n[0])+"="+i(n[1])},"").join("&")};function Tke(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function bee(t,e,i){if(!e)return t;const r=i&&i.encode||Tke,n=he.isFunction(i)?{serialize:i}:i,a=n&&n.serialize;let s;if(a?s=a(e,n):s=he.isURLSearchParams(e)?e.toString():new A$(e,n).toString(r),s){const o=t.indexOf("#");o!==-1&&(t=t.slice(0,o)),t+=(t.indexOf("?")===-1?"?":"&")+s}return t}class nz{constructor(){this.handlers=[]}use(e,i,r){return this.handlers.push({fulfilled:e,rejected:i,synchronous:r?r.synchronous:!1,runWhen:r?r.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){he.forEach(this.handlers,function(r){r!==null&&e(r)})}}const k$={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1,legacyInterceptorReqResOrdering:!0},Dke=typeof URLSearchParams<"u"?URLSearchParams:A$,Pke=typeof FormData<"u"?FormData:null,Eke=typeof Blob<"u"?Blob:null,Rke={isBrowser:!0,classes:{URLSearchParams:Dke,FormData:Pke,Blob:Eke},protocols:["http","https","file","blob","url","data"]},O$=typeof window<"u"&&typeof document<"u",qO=typeof navigator=="object"&&navigator||void 0,Cke=O$&&(!qO||["ReactNative","NativeScript","NS"].indexOf(qO.product)<0),Mke=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",Nke=O$&&window.location.href||"http://localhost",Ake=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:O$,hasStandardBrowserEnv:Cke,hasStandardBrowserWebWorkerEnv:Mke,navigator:qO,origin:Nke},Symbol.toStringTag,{value:"Module"})),Ma={...Ake,...Rke};function kke(t,e){return ZC(t,new Ma.classes.URLSearchParams,{visitor:function(i,r,n,a){return Ma.isNode&&he.isBuffer(i)?(this.append(r,i.toString("base64")),!1):a.defaultVisitor.apply(this,arguments)},...e})}function Oke(t){return he.matchAll(/\w+|\[(\w*)]/g,t).map(e=>e[0]==="[]"?"":e[1]||e[0])}function xke(t){const e={},i=Object.keys(t);let r;const n=i.length;let a;for(r=0;r<n;r++)a=i[r],e[a]=t[a];return e}function wee(t){function e(i,r,n,a){let s=i[a++];if(s==="__proto__")return!0;const o=Number.isFinite(+s),l=a>=i.length;return s=!s&&he.isArray(n)?n.length:s,l?(he.hasOwnProp(n,s)?n[s]=[n[s],r]:n[s]=r,!o):((!n[s]||!he.isObject(n[s]))&&(n[s]=[]),e(i,r,n[s],a)&&he.isArray(n[s])&&(n[s]=xke(n[s])),!o)}if(he.isFormData(t)&&he.isFunction(t.entries)){const i={};return he.forEachEntry(t,(r,n)=>{e(Oke(r),n,i,0)}),i}return null}function Fke(t,e,i){if(he.isString(t))try{return(e||JSON.parse)(t),he.trim(t)}catch(r){if(r.name!=="SyntaxError")throw r}return(i||JSON.stringify)(t)}const HS={transitional:k$,adapter:["xhr","http","fetch"],transformRequest:[function(e,i){const r=i.getContentType()||"",n=r.indexOf("application/json")>-1,a=he.isObject(e);if(a&&he.isHTMLForm(e)&&(e=new FormData(e)),he.isFormData(e))return n?JSON.stringify(wee(e)):e;if(he.isArrayBuffer(e)||he.isBuffer(e)||he.isStream(e)||he.isFile(e)||he.isBlob(e)||he.isReadableStream(e))return e;if(he.isArrayBufferView(e))return e.buffer;if(he.isURLSearchParams(e))return i.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let o;if(a){if(r.indexOf("application/x-www-form-urlencoded")>-1)return kke(e,this.formSerializer).toString();if((o=he.isFileList(e))||r.indexOf("multipart/form-data")>-1){const l=this.env&&this.env.FormData;return ZC(o?{"files[]":e}:e,l&&new l,this.formSerializer)}}return a||n?(i.setContentType("application/json",!1),Fke(e)):e}],transformResponse:[function(e){const i=this.transitional||HS.transitional,r=i&&i.forcedJSONParsing,n=this.responseType==="json";if(he.isResponse(e)||he.isReadableStream(e))return e;if(e&&he.isString(e)&&(r&&!this.responseType||n)){const s=!(i&&i.silentJSONParsing)&&n;try{return JSON.parse(e,this.parseReviver)}catch(o){if(s)throw o.name==="SyntaxError"?Mt.from(o,Mt.ERR_BAD_RESPONSE,this,null,this.response):o}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Ma.classes.FormData,Blob:Ma.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};he.forEach(["delete","get","head","post","put","patch"],t=>{HS.headers[t]={}});const Lke=he.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),_ke=t=>{const e={};let i,r,n;return t&&t.split(`
`).forEach(function(s){n=s.indexOf(":"),i=s.substring(0,n).trim().toLowerCase(),r=s.substring(n+1).trim(),!(!i||e[i]&&Lke[i])&&(i==="set-cookie"?e[i]?e[i].push(r):e[i]=[r]:e[i]=e[i]?e[i]+", "+r:r)}),e},az=Symbol("internals");function py(t){return t&&String(t).trim().toLowerCase()}function sD(t){return t===!1||t==null?t:he.isArray(t)?t.map(sD):String(t)}function $ke(t){const e=Object.create(null),i=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let r;for(;r=i.exec(t);)e[r[1]]=r[2];return e}const Bke=t=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(t.trim());function jA(t,e,i,r,n){if(he.isFunction(r))return r.call(this,e,i);if(n&&(e=i),!!he.isString(e)){if(he.isString(r))return e.indexOf(r)!==-1;if(he.isRegExp(r))return r.test(e)}}function Vke(t){return t.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,i,r)=>i.toUpperCase()+r)}function jke(t,e){const i=he.toCamelCase(" "+e);["get","set","has"].forEach(r=>{Object.defineProperty(t,r+i,{value:function(n,a,s){return this[r].call(this,e,n,a,s)},configurable:!0})})}let $s=class{constructor(e){e&&this.set(e)}set(e,i,r){const n=this;function a(o,l,u){const c=py(l);if(!c)throw new Error("header name must be a non-empty string");const d=he.findKey(n,c);(!d||n[d]===void 0||u===!0||u===void 0&&n[d]!==!1)&&(n[d||l]=sD(o))}const s=(o,l)=>he.forEach(o,(u,c)=>a(u,c,l));if(he.isPlainObject(e)||e instanceof this.constructor)s(e,i);else if(he.isString(e)&&(e=e.trim())&&!Bke(e))s(_ke(e),i);else if(he.isObject(e)&&he.isIterable(e)){let o={},l,u;for(const c of e){if(!he.isArray(c))throw TypeError("Object iterator must return a key-value pair");o[u=c[0]]=(l=o[u])?he.isArray(l)?[...l,c[1]]:[l,c[1]]:c[1]}s(o,i)}else e!=null&&a(i,e,r);return this}get(e,i){if(e=py(e),e){const r=he.findKey(this,e);if(r){const n=this[r];if(!i)return n;if(i===!0)return $ke(n);if(he.isFunction(i))return i.call(this,n,r);if(he.isRegExp(i))return i.exec(n);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,i){if(e=py(e),e){const r=he.findKey(this,e);return!!(r&&this[r]!==void 0&&(!i||jA(this,this[r],r,i)))}return!1}delete(e,i){const r=this;let n=!1;function a(s){if(s=py(s),s){const o=he.findKey(r,s);o&&(!i||jA(r,r[o],o,i))&&(delete r[o],n=!0)}}return he.isArray(e)?e.forEach(a):a(e),n}clear(e){const i=Object.keys(this);let r=i.length,n=!1;for(;r--;){const a=i[r];(!e||jA(this,this[a],a,e,!0))&&(delete this[a],n=!0)}return n}normalize(e){const i=this,r={};return he.forEach(this,(n,a)=>{const s=he.findKey(r,a);if(s){i[s]=sD(n),delete i[a];return}const o=e?Vke(a):String(a).trim();o!==a&&delete i[a],i[o]=sD(n),r[o]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const i=Object.create(null);return he.forEach(this,(r,n)=>{r!=null&&r!==!1&&(i[n]=e&&he.isArray(r)?r.join(", "):r)}),i}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,i])=>e+": "+i).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...i){const r=new this(e);return i.forEach(n=>r.set(n)),r}static accessor(e){const r=(this[az]=this[az]={accessors:{}}).accessors,n=this.prototype;function a(s){const o=py(s);r[o]||(jke(n,s),r[o]=!0)}return he.isArray(e)?e.forEach(a):a(e),this}};$s.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);he.reduceDescriptors($s.prototype,({value:t},e)=>{let i=e[0].toUpperCase()+e.slice(1);return{get:()=>t,set(r){this[i]=r}}});he.freezeMethods($s);function GA(t,e){const i=this||HS,r=e||i,n=$s.from(r.headers);let a=r.data;return he.forEach(t,function(o){a=o.call(i,a,n.normalize(),e?e.status:void 0)}),n.normalize(),a}function See(t){return!!(t&&t.__CANCEL__)}let WS=class extends Mt{constructor(e,i,r){super(e??"canceled",Mt.ERR_CANCELED,i,r),this.name="CanceledError",this.__CANCEL__=!0}};function Uee(t,e,i){const r=i.config.validateStatus;!i.status||!r||r(i.status)?t(i):e(new Mt("Request failed with status code "+i.status,[Mt.ERR_BAD_REQUEST,Mt.ERR_BAD_RESPONSE][Math.floor(i.status/100)-4],i.config,i.request,i))}function Gke(t){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(t);return e&&e[1]||""}function Hke(t,e){t=t||10;const i=new Array(t),r=new Array(t);let n=0,a=0,s;return e=e!==void 0?e:1e3,function(l){const u=Date.now(),c=r[a];s||(s=u),i[n]=l,r[n]=u;let d=a,p=0;for(;d!==n;)p+=i[d++],d=d%t;if(n=(n+1)%t,n===a&&(a=(a+1)%t),u-s<e)return;const f=c&&u-c;return f?Math.round(p*1e3/f):void 0}}function Wke(t,e){let i=0,r=1e3/e,n,a;const s=(u,c=Date.now())=>{i=c,n=null,a&&(clearTimeout(a),a=null),t(...u)};return[(...u)=>{const c=Date.now(),d=c-i;d>=r?s(u,c):(n=u,a||(a=setTimeout(()=>{a=null,s(n)},r-d)))},()=>n&&s(n)]}const SP=(t,e,i=3)=>{let r=0;const n=Hke(50,250);return Wke(a=>{const s=a.loaded,o=a.lengthComputable?a.total:void 0,l=s-r,u=n(l),c=s<=o;r=s;const d={loaded:s,total:o,progress:o?s/o:void 0,bytes:l,rate:u||void 0,estimated:u&&o&&c?(o-s)/u:void 0,event:a,lengthComputable:o!=null,[e?"download":"upload"]:!0};t(d)},i)},sz=(t,e)=>{const i=t!=null;return[r=>e[0]({lengthComputable:i,total:t,loaded:r}),e[1]]},oz=t=>(...e)=>he.asap(()=>t(...e)),zke=Ma.hasStandardBrowserEnv?((t,e)=>i=>(i=new URL(i,Ma.origin),t.protocol===i.protocol&&t.host===i.host&&(e||t.port===i.port)))(new URL(Ma.origin),Ma.navigator&&/(msie|trident)/i.test(Ma.navigator.userAgent)):()=>!0,qke=Ma.hasStandardBrowserEnv?{write(t,e,i,r,n,a,s){if(typeof document>"u")return;const o=[`${t}=${encodeURIComponent(e)}`];he.isNumber(i)&&o.push(`expires=${new Date(i).toUTCString()}`),he.isString(r)&&o.push(`path=${r}`),he.isString(n)&&o.push(`domain=${n}`),a===!0&&o.push("secure"),he.isString(s)&&o.push(`SameSite=${s}`),document.cookie=o.join("; ")},read(t){if(typeof document>"u")return null;const e=document.cookie.match(new RegExp("(?:^|; )"+t+"=([^;]*)"));return e?decodeURIComponent(e[1]):null},remove(t){this.write(t,"",Date.now()-864e5,"/")}}:{write(){},read(){return null},remove(){}};function Yke(t){return typeof t!="string"?!1:/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)}function Kke(t,e){return e?t.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):t}function Tee(t,e,i){let r=!Yke(e);return t&&(r||i==!1)?Kke(t,e):e}const lz=t=>t instanceof $s?{...t}:t;function Fm(t,e){e=e||{};const i={};function r(u,c,d,p){return he.isPlainObject(u)&&he.isPlainObject(c)?he.merge.call({caseless:p},u,c):he.isPlainObject(c)?he.merge({},c):he.isArray(c)?c.slice():c}function n(u,c,d,p){if(he.isUndefined(c)){if(!he.isUndefined(u))return r(void 0,u,d,p)}else return r(u,c,d,p)}function a(u,c){if(!he.isUndefined(c))return r(void 0,c)}function s(u,c){if(he.isUndefined(c)){if(!he.isUndefined(u))return r(void 0,u)}else return r(void 0,c)}function o(u,c,d){if(d in e)return r(u,c);if(d in t)return r(void 0,u)}const l={url:a,method:a,data:a,baseURL:s,transformRequest:s,transformResponse:s,paramsSerializer:s,timeout:s,timeoutMessage:s,withCredentials:s,withXSRFToken:s,adapter:s,responseType:s,xsrfCookieName:s,xsrfHeaderName:s,onUploadProgress:s,onDownloadProgress:s,decompress:s,maxContentLength:s,maxBodyLength:s,beforeRedirect:s,transport:s,httpAgent:s,httpsAgent:s,cancelToken:s,socketPath:s,responseEncoding:s,validateStatus:o,headers:(u,c,d)=>n(lz(u),lz(c),d,!0)};return he.forEach(Object.keys({...t,...e}),function(c){if(c==="__proto__"||c==="constructor"||c==="prototype")return;const d=he.hasOwnProp(l,c)?l[c]:n,p=d(t[c],e[c],c);he.isUndefined(p)&&d!==o||(i[c]=p)}),i}const Dee=t=>{const e=Fm({},t);let{data:i,withXSRFToken:r,xsrfHeaderName:n,xsrfCookieName:a,headers:s,auth:o}=e;if(e.headers=s=$s.from(s),e.url=bee(Tee(e.baseURL,e.url,e.allowAbsoluteUrls),t.params,t.paramsSerializer),o&&s.set("Authorization","Basic "+btoa((o.username||"")+":"+(o.password?unescape(encodeURIComponent(o.password)):""))),he.isFormData(i)){if(Ma.hasStandardBrowserEnv||Ma.hasStandardBrowserWebWorkerEnv)s.setContentType(void 0);else if(he.isFunction(i.getHeaders)){const l=i.getHeaders(),u=["content-type","content-length"];Object.entries(l).forEach(([c,d])=>{u.includes(c.toLowerCase())&&s.set(c,d)})}}if(Ma.hasStandardBrowserEnv&&(r&&he.isFunction(r)&&(r=r(e)),r||r!==!1&&zke(e.url))){const l=n&&a&&qke.read(a);l&&s.set(n,l)}return e},Xke=typeof XMLHttpRequest<"u",Jke=Xke&&function(t){return new Promise(function(i,r){const n=Dee(t);let a=n.data;const s=$s.from(n.headers).normalize();let{responseType:o,onUploadProgress:l,onDownloadProgress:u}=n,c,d,p,f,m;function h(){f&&f(),m&&m(),n.cancelToken&&n.cancelToken.unsubscribe(c),n.signal&&n.signal.removeEventListener("abort",c)}let g=new XMLHttpRequest;g.open(n.method.toUpperCase(),n.url,!0),g.timeout=n.timeout;function I(){if(!g)return;const w=$s.from("getAllResponseHeaders"in g&&g.getAllResponseHeaders()),b={data:!o||o==="text"||o==="json"?g.responseText:g.response,status:g.status,statusText:g.statusText,headers:w,config:t,request:g};Uee(function(U){i(U),h()},function(U){r(U),h()},b),g=null}"onloadend"in g?g.onloadend=I:g.onreadystatechange=function(){!g||g.readyState!==4||g.status===0&&!(g.responseURL&&g.responseURL.indexOf("file:")===0)||setTimeout(I)},g.onabort=function(){g&&(r(new Mt("Request aborted",Mt.ECONNABORTED,t,g)),g=null)},g.onerror=function(y){const b=y&&y.message?y.message:"Network Error",S=new Mt(b,Mt.ERR_NETWORK,t,g);S.event=y||null,r(S),g=null},g.ontimeout=function(){let y=n.timeout?"timeout of "+n.timeout+"ms exceeded":"timeout exceeded";const b=n.transitional||k$;n.timeoutErrorMessage&&(y=n.timeoutErrorMessage),r(new Mt(y,b.clarifyTimeoutError?Mt.ETIMEDOUT:Mt.ECONNABORTED,t,g)),g=null},a===void 0&&s.setContentType(null),"setRequestHeader"in g&&he.forEach(s.toJSON(),function(y,b){g.setRequestHeader(b,y)}),he.isUndefined(n.withCredentials)||(g.withCredentials=!!n.withCredentials),o&&o!=="json"&&(g.responseType=n.responseType),u&&([p,m]=SP(u,!0),g.addEventListener("progress",p)),l&&g.upload&&([d,f]=SP(l),g.upload.addEventListener("progress",d),g.upload.addEventListener("loadend",f)),(n.cancelToken||n.signal)&&(c=w=>{g&&(r(!w||w.type?new WS(null,t,g):w),g.abort(),g=null)},n.cancelToken&&n.cancelToken.subscribe(c),n.signal&&(n.signal.aborted?c():n.signal.addEventListener("abort",c)));const v=Gke(n.url);if(v&&Ma.protocols.indexOf(v)===-1){r(new Mt("Unsupported protocol "+v+":",Mt.ERR_BAD_REQUEST,t));return}g.send(a||null)})},Qke=(t,e)=>{const{length:i}=t=t?t.filter(Boolean):[];if(e||i){let r=new AbortController,n;const a=function(u){if(!n){n=!0,o();const c=u instanceof Error?u:this.reason;r.abort(c instanceof Mt?c:new WS(c instanceof Error?c.message:c))}};let s=e&&setTimeout(()=>{s=null,a(new Mt(`timeout of ${e}ms exceeded`,Mt.ETIMEDOUT))},e);const o=()=>{t&&(s&&clearTimeout(s),s=null,t.forEach(u=>{u.unsubscribe?u.unsubscribe(a):u.removeEventListener("abort",a)}),t=null)};t.forEach(u=>u.addEventListener("abort",a));const{signal:l}=r;return l.unsubscribe=()=>he.asap(o),l}},Zke=function*(t,e){let i=t.byteLength;if(i<e){yield t;return}let r=0,n;for(;r<i;)n=r+e,yield t.slice(r,n),r=n},eOe=async function*(t,e){for await(const i of tOe(t))yield*Zke(i,e)},tOe=async function*(t){if(t[Symbol.asyncIterator]){yield*t;return}const e=t.getReader();try{for(;;){const{done:i,value:r}=await e.read();if(i)break;yield r}}finally{await e.cancel()}},uz=(t,e,i,r)=>{const n=eOe(t,e);let a=0,s,o=l=>{s||(s=!0,r&&r(l))};return new ReadableStream({async pull(l){try{const{done:u,value:c}=await n.next();if(u){o(),l.close();return}let d=c.byteLength;if(i){let p=a+=d;i(p)}l.enqueue(new Uint8Array(c))}catch(u){throw o(u),u}},cancel(l){return o(l),n.return()}},{highWaterMark:2})},cz=64*1024,{isFunction:TT}=he,iOe=(({Request:t,Response:e})=>({Request:t,Response:e}))(he.global),{ReadableStream:dz,TextEncoder:pz}=he.global,fz=(t,...e)=>{try{return!!t(...e)}catch{return!1}},rOe=t=>{t=he.merge.call({skipUndefined:!0},iOe,t);const{fetch:e,Request:i,Response:r}=t,n=e?TT(e):typeof fetch=="function",a=TT(i),s=TT(r);if(!n)return!1;const o=n&&TT(dz),l=n&&(typeof pz=="function"?(m=>h=>m.encode(h))(new pz):async m=>new Uint8Array(await new i(m).arrayBuffer())),u=a&&o&&fz(()=>{let m=!1;const h=new i(Ma.origin,{body:new dz,method:"POST",get duplex(){return m=!0,"half"}}).headers.has("Content-Type");return m&&!h}),c=s&&o&&fz(()=>he.isReadableStream(new r("").body)),d={stream:c&&(m=>m.body)};n&&["text","arrayBuffer","blob","formData","stream"].forEach(m=>{!d[m]&&(d[m]=(h,g)=>{let I=h&&h[m];if(I)return I.call(h);throw new Mt(`Response type '${m}' is not supported`,Mt.ERR_NOT_SUPPORT,g)})});const p=async m=>{if(m==null)return 0;if(he.isBlob(m))return m.size;if(he.isSpecCompliantForm(m))return(await new i(Ma.origin,{method:"POST",body:m}).arrayBuffer()).byteLength;if(he.isArrayBufferView(m)||he.isArrayBuffer(m))return m.byteLength;if(he.isURLSearchParams(m)&&(m=m+""),he.isString(m))return(await l(m)).byteLength},f=async(m,h)=>{const g=he.toFiniteNumber(m.getContentLength());return g??p(h)};return async m=>{let{url:h,method:g,data:I,signal:v,cancelToken:w,timeout:y,onDownloadProgress:b,onUploadProgress:S,responseType:U,headers:T,withCredentials:P="same-origin",fetchOptions:D}=Dee(m),E=e||fetch;U=U?(U+"").toLowerCase():"text";let R=Qke([v,w&&w.toAbortSignal()],y),C=null;const M=R&&R.unsubscribe&&(()=>{R.unsubscribe()});let N;try{if(S&&u&&g!=="get"&&g!=="head"&&(N=await f(T,I))!==0){let L=new i(h,{method:"POST",body:I,duplex:"half"}),$;if(he.isFormData(I)&&($=L.headers.get("content-type"))&&T.setContentType($),L.body){const[V,_]=sz(N,SP(oz(S)));I=uz(L.body,cz,V,_)}}he.isString(P)||(P=P?"include":"omit");const A=a&&"credentials"in i.prototype,O={...D,signal:R,method:g.toUpperCase(),headers:T.normalize().toJSON(),body:I,duplex:"half",credentials:A?P:void 0};C=a&&new i(h,O);let k=await(a?E(C,D):E(h,O));const F=c&&(U==="stream"||U==="response");if(c&&(b||F&&M)){const L={};["status","statusText","headers"].forEach(B=>{L[B]=k[B]});const $=he.toFiniteNumber(k.headers.get("content-length")),[V,_]=b&&sz($,SP(oz(b),!0))||[];k=new r(uz(k.body,cz,V,()=>{_&&_(),M&&M()}),L)}U=U||"text";let x=await d[he.findKey(d,U)||"text"](k,m);return!F&&M&&M(),await new Promise((L,$)=>{Uee(L,$,{data:x,headers:$s.from(k.headers),status:k.status,statusText:k.statusText,config:m,request:C})})}catch(A){throw M&&M(),A&&A.name==="TypeError"&&/Load failed|fetch/i.test(A.message)?Object.assign(new Mt("Network Error",Mt.ERR_NETWORK,m,C,A&&A.response),{cause:A.cause||A}):Mt.from(A,A&&A.code,m,C,A&&A.response)}}},nOe=new Map,Pee=t=>{let e=t&&t.env||{};const{fetch:i,Request:r,Response:n}=e,a=[r,n,i];let s=a.length,o=s,l,u,c=nOe;for(;o--;)l=a[o],u=c.get(l),u===void 0&&c.set(l,u=o?new Map:rOe(e)),c=u;return u};Pee();const x$={http:wke,xhr:Jke,fetch:{get:Pee}};he.forEach(x$,(t,e)=>{if(t){try{Object.defineProperty(t,"name",{value:e})}catch{}Object.defineProperty(t,"adapterName",{value:e})}});const mz=t=>`- ${t}`,aOe=t=>he.isFunction(t)||t===null||t===!1;function sOe(t,e){t=he.isArray(t)?t:[t];const{length:i}=t;let r,n;const a={};for(let s=0;s<i;s++){r=t[s];let o;if(n=r,!aOe(r)&&(n=x$[(o=String(r)).toLowerCase()],n===void 0))throw new Mt(`Unknown adapter '${o}'`);if(n&&(he.isFunction(n)||(n=n.get(e))))break;a[o||"#"+s]=n}if(!n){const s=Object.entries(a).map(([l,u])=>`adapter ${l} `+(u===!1?"is not supported by the environment":"is not available in the build"));let o=i?s.length>1?`since :
`+s.map(mz).join(`
`):" "+mz(s[0]):"as no adapter specified";throw new Mt("There is no suitable adapter to dispatch the request "+o,"ERR_NOT_SUPPORT")}return n}const Eee={getAdapter:sOe,adapters:x$};function HA(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new WS(null,t)}function hz(t){return HA(t),t.headers=$s.from(t.headers),t.data=GA.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),Eee.getAdapter(t.adapter||HS.adapter,t)(t).then(function(r){return HA(t),r.data=GA.call(t,t.transformResponse,r),r.headers=$s.from(r.headers),r},function(r){return See(r)||(HA(t),r&&r.response&&(r.response.data=GA.call(t,t.transformResponse,r.response),r.response.headers=$s.from(r.response.headers))),Promise.reject(r)})}const Ree="1.13.5",eM={};["object","boolean","number","function","string","symbol"].forEach((t,e)=>{eM[t]=function(r){return typeof r===t||"a"+(e<1?"n ":" ")+t}});const gz={};eM.transitional=function(e,i,r){function n(a,s){return"[Axios v"+Ree+"] Transitional option '"+a+"'"+s+(r?". "+r:"")}return(a,s,o)=>{if(e===!1)throw new Mt(n(s," has been removed"+(i?" in "+i:"")),Mt.ERR_DEPRECATED);return i&&!gz[s]&&(gz[s]=!0,console.warn(n(s," has been deprecated since v"+i+" and will be removed in the near future"))),e?e(a,s,o):!0}};eM.spelling=function(e){return(i,r)=>(console.warn(`${r} is likely a misspelling of ${e}`),!0)};function oOe(t,e,i){if(typeof t!="object")throw new Mt("options must be an object",Mt.ERR_BAD_OPTION_VALUE);const r=Object.keys(t);let n=r.length;for(;n-- >0;){const a=r[n],s=e[a];if(s){const o=t[a],l=o===void 0||s(o,a,t);if(l!==!0)throw new Mt("option "+a+" must be "+l,Mt.ERR_BAD_OPTION_VALUE);continue}if(i!==!0)throw new Mt("Unknown option "+a,Mt.ERR_BAD_OPTION)}}const oD={assertOptions:oOe,validators:eM},Lo=oD.validators;let um=class{constructor(e){this.defaults=e||{},this.interceptors={request:new nz,response:new nz}}async request(e,i){try{return await this._request(e,i)}catch(r){if(r instanceof Error){let n={};Error.captureStackTrace?Error.captureStackTrace(n):n=new Error;const a=n.stack?n.stack.replace(/^.+\n/,""):"";try{r.stack?a&&!String(r.stack).endsWith(a.replace(/^.+\n.+\n/,""))&&(r.stack+=`
`+a):r.stack=a}catch{}}throw r}}_request(e,i){typeof e=="string"?(i=i||{},i.url=e):i=e||{},i=Fm(this.defaults,i);const{transitional:r,paramsSerializer:n,headers:a}=i;r!==void 0&&oD.assertOptions(r,{silentJSONParsing:Lo.transitional(Lo.boolean),forcedJSONParsing:Lo.transitional(Lo.boolean),clarifyTimeoutError:Lo.transitional(Lo.boolean),legacyInterceptorReqResOrdering:Lo.transitional(Lo.boolean)},!1),n!=null&&(he.isFunction(n)?i.paramsSerializer={serialize:n}:oD.assertOptions(n,{encode:Lo.function,serialize:Lo.function},!0)),i.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?i.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:i.allowAbsoluteUrls=!0),oD.assertOptions(i,{baseUrl:Lo.spelling("baseURL"),withXsrfToken:Lo.spelling("withXSRFToken")},!0),i.method=(i.method||this.defaults.method||"get").toLowerCase();let s=a&&he.merge(a.common,a[i.method]);a&&he.forEach(["delete","get","head","post","put","patch","common"],m=>{delete a[m]}),i.headers=$s.concat(s,a);const o=[];let l=!0;this.interceptors.request.forEach(function(h){if(typeof h.runWhen=="function"&&h.runWhen(i)===!1)return;l=l&&h.synchronous;const g=i.transitional||k$;g&&g.legacyInterceptorReqResOrdering?o.unshift(h.fulfilled,h.rejected):o.push(h.fulfilled,h.rejected)});const u=[];this.interceptors.response.forEach(function(h){u.push(h.fulfilled,h.rejected)});let c,d=0,p;if(!l){const m=[hz.bind(this),void 0];for(m.unshift(...o),m.push(...u),p=m.length,c=Promise.resolve(i);d<p;)c=c.then(m[d++],m[d++]);return c}p=o.length;let f=i;for(;d<p;){const m=o[d++],h=o[d++];try{f=m(f)}catch(g){h.call(this,g);break}}try{c=hz.call(this,f)}catch(m){return Promise.reject(m)}for(d=0,p=u.length;d<p;)c=c.then(u[d++],u[d++]);return c}getUri(e){e=Fm(this.defaults,e);const i=Tee(e.baseURL,e.url,e.allowAbsoluteUrls);return bee(i,e.params,e.paramsSerializer)}};he.forEach(["delete","get","head","options"],function(e){um.prototype[e]=function(i,r){return this.request(Fm(r||{},{method:e,url:i,data:(r||{}).data}))}});he.forEach(["post","put","patch"],function(e){function i(r){return function(a,s,o){return this.request(Fm(o||{},{method:e,headers:r?{"Content-Type":"multipart/form-data"}:{},url:a,data:s}))}}um.prototype[e]=i(),um.prototype[e+"Form"]=i(!0)});let lOe=class Cee{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let i;this.promise=new Promise(function(a){i=a});const r=this;this.promise.then(n=>{if(!r._listeners)return;let a=r._listeners.length;for(;a-- >0;)r._listeners[a](n);r._listeners=null}),this.promise.then=n=>{let a;const s=new Promise(o=>{r.subscribe(o),a=o}).then(n);return s.cancel=function(){r.unsubscribe(a)},s},e(function(a,s,o){r.reason||(r.reason=new WS(a,s,o),i(r.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const i=this._listeners.indexOf(e);i!==-1&&this._listeners.splice(i,1)}toAbortSignal(){const e=new AbortController,i=r=>{e.abort(r)};return this.subscribe(i),e.signal.unsubscribe=()=>this.unsubscribe(i),e.signal}static source(){let e;return{token:new Cee(function(n){e=n}),cancel:e}}};function uOe(t){return function(i){return t.apply(null,i)}}function cOe(t){return he.isObject(t)&&t.isAxiosError===!0}const YO={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511,WebServerIsDown:521,ConnectionTimedOut:522,OriginIsUnreachable:523,TimeoutOccurred:524,SslHandshakeFailed:525,InvalidSslCertificate:526};Object.entries(YO).forEach(([t,e])=>{YO[e]=t});function Mee(t){const e=new um(t),i=uee(um.prototype.request,e);return he.extend(i,um.prototype,e,{allOwnKeys:!0}),he.extend(i,e,null,{allOwnKeys:!0}),i.create=function(n){return Mee(Fm(t,n))},i}const wn=Mee(HS);wn.Axios=um;wn.CanceledError=WS;wn.CancelToken=lOe;wn.isCancel=See;wn.VERSION=Ree;wn.toFormData=ZC;wn.AxiosError=Mt;wn.Cancel=wn.CanceledError;wn.all=function(e){return Promise.all(e)};wn.spread=uOe;wn.isAxiosError=cOe;wn.mergeConfig=Fm;wn.AxiosHeaders=$s;wn.formToJSON=t=>wee(he.isHTMLForm(t)?new FormData(t):t);wn.getAdapter=Eee.getAdapter;wn.HttpStatusCode=YO;wn.default=wn;const{Axios:RQe,AxiosError:CQe,CanceledError:MQe,isCancel:NQe,CancelToken:AQe,VERSION:kQe,all:OQe,Cancel:xQe,isAxiosError:FQe,spread:LQe,toFormData:_Qe,AxiosHeaders:$Qe,HttpStatusCode:BQe,formToJSON:VQe,getAdapter:jQe,mergeConfig:GQe}=wn,Nee=xAe(),dOe=globalThis.location.host.includes("localhost")||globalThis.location.hostname==="127.0.0.1",pOe=window.dev?.baseURL||(dOe?"http://localhost:8383":"https://courthive.net"),zS=wn.create({baseURL:pOe});zS.interceptors.request.use(t=>{const e=localStorage.getItem(Nee);return e&&(t.headers.Authorization=`Bearer ${e}`),t},t=>Promise.reject(t));zS.interceptors.response.use(t=>t,t=>{if(t.message==="Network Error"&&console.log("network error"),t.response){t.response?.status===401&&Aee();const e=t.response.data.message||t.response.data.error||t.response.data;console.log({message:e})}});const fOe=()=>{const t=localStorage.getItem(Nee);zS.defaults.headers.common.Authorization=`Bearer ${t}`},Aee=()=>{zS.defaults.headers.common.Authorization=void 0},Pv={...zS,addAuthorization:fOe,removeAuthorization:Aee},F$="Missing tournamentId";async function kee(t){if(!t?.tournamentId)throw new Error(F$);return await Pv.post("/factory/tournamentinfo",t)}async function KO({providerAbbr:t}){if(!t)throw new Error("missing provicerAbbr");return await Pv.post("/provider/calendar",{providerAbbr:t})}async function Oee(t){if(!t?.tournamentId)throw new Error(F$);if(!t?.eventId)throw new Error("missing eventId");return await Pv.post("/factory/eventdata",t)}async function mOe(t){if(!t?.tournamentId)throw new Error(F$);return Object.assign(t,{courtCompletedMatchUps:!0,withCourtGridRows:!0,usePublishState:!0,minCourtGridRows:10,nextMatchUps:!0}),await Pv.post("/factory/scheduledmatchUps",{params:t})}async function hOe(){return await Pv.get("/factory/version")}const gOe=t=>{let e;const i=Array.isArray(t)?t:[t];return r=>{if(e&&i.forEach(n=>n.removeFilter(e)),r){const n=r?.toLowerCase();e=a=>a.searchText?.includes(n),i.forEach(a=>a.addFilter(e))}else e=void 0}},xee=t=>(e,i)=>{const r=e.getDefinition();return t.includes(r.field)?"":i==="asc"&&"<div><i class='fas fa-sort-up'></div>"||i==="desc"&&"<div><i class=' fas fa-sort-down'></div>"||"<div><i class='fas fa-sort'></div>"};function IOe(t,e,i,r){const n=e>1?"items":"item";return t+`<span style='color:blue; margin-left:10px;'>(${e} ${n})</span>`}function vOe(t,e){return t.pctSpread&&!e.pctSpread?-1:e.pctSpread&&!t.pctSpread?1:!t.pctSpread&&!e.pctSpread?0:e.pctSpread-t.pctSpread}function L$(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Iz={exports:{}},vz;function yOe(){return vz||(vz=1,(function(t){(function(){var e={}.hasOwnProperty;function i(){for(var a="",s=0;s<arguments.length;s++){var o=arguments[s];o&&(a=n(a,r(o)))}return a}function r(a){if(typeof a=="string"||typeof a=="number")return a;if(typeof a!="object")return"";if(Array.isArray(a))return i.apply(null,a);if(a.toString!==Object.prototype.toString&&!a.toString.toString().includes("[native code]"))return a.toString();var s="";for(var o in a)e.call(a,o)&&a[o]&&(s=n(s,o));return s}function n(a,s){return s?a?a+" "+s:a+s:a}t.exports?(i.default=i,t.exports=i):window.classNames=i})()})(Iz)),Iz.exports}var bOe=yOe();const hn=L$(bOe);function wOe({variant:t}){return hn("chc-placeholder",t==="showAddress"&&"chc-placeholder--show-address")}const SOe=t=>"chc-participant",UOe=t=>hn("chc-participant-name",t?.variant&&`chc-participant-name--${t.variant}`),TOe=t=>hn("chc-participant-type",t?.variant&&`chc-participant-type--${t.variant}`);function DOe({drawPosition:t,sideNumber:e}){const i=hn("chc-participant-container",e===1&&"chc-participant-container--side1");return t?`${i} chc-has-draw-position`:i}function POe({winnerChevron:t,isDoubles:e}){return t?e?"chc-chevron-doubles--winner":"chc-chevron--winner":""}const _$=()=>"chc-participant-detail";function EOe({individualParticipant:t,className:e}){const{city:i,state:r,countryCode:n}=t?.person?.addresses?.[0]||{},a=[i,r,n].filter(Boolean).join(", ")||" ",s=document.createElement("div");return s.className=hn(_$(),e),s.innerHTML=a,s}function da(t){return typeof t=="function"}function ROe(t){return typeof t=="string"}function COe({element:t,attr:e}){if(!ROe(e))return;const i=e.split(".");for(const r of i)if(t=t?.[r],!t)return;return t}function MOe({individualParticipant:t,attribute:e,className:i}){const r=t?.person,n=COe({element:r,attr:e});if(!n)return"";const a=document.createElement("div");return a.className=hn(_$(),i),a.innerHTML=n,a}function NOe({individualParticipant:t,className:e}){const i=t?.teams?.[0],r=i?.participantName||" ",n=document.createElement("div");return n.className=hn(_$(),e),n.classList.add("tmx-tm"),n.setAttribute("id",i?.participantId||""),n.innerHTML=r,n}function AOe(t){const e=t?.composition?.configuration?.participantDetail;if(e==="TEAM")return NOe(t);if(t?.composition?.configuration?.showAddress??e==="ADDRESS")return EOe(t);if(e){const i=MOe({...t,attribute:e});if(i&&typeof i!="string")return i}return document.createElement("div")}function po(t){return typeof t=="function"}var yz={exports:{}},bz;function kOe(){return bz||(bz=1,(function(t){(function(){var e=function(l,u){var c=this;e.count=(e.count||0)+1,this.count=e.count,this.isOpened=!1,this.input=a(l),this.input.setAttribute("autocomplete","off"),this.input.setAttribute("aria-autocomplete","list"),this.input.setAttribute("aria-expanded","false"),this.input.setAttribute("aria-controls","awesomplete_list_"+this.count),this.input.setAttribute("aria-owns","awesomplete_list_"+this.count),this.input.setAttribute("role","combobox"),this.options=u=u||{},r(this,{minChars:2,maxItems:10,autoFirst:!1,data:e.DATA,filter:e.FILTER_CONTAINS,sort:u.sort===!1?!1:e.SORT_BYLENGTH,container:e.CONTAINER,item:e.ITEM,replace:e.REPLACE,tabSelect:!1,listLabel:"Results List",statusNoResults:"No results found",statusXResults:"{0} results found",statusTypeXChar:"Type {0} or more characters for results"},u),this.index=-1,this.container=this.container(l),this.ul=a.create("ul",{hidden:"hidden",role:"listbox",id:"awesomplete_list_"+this.count,inside:this.container,"aria-label":this.listLabel}),this.status=a.create("span",{className:"visually-hidden",role:"status","aria-live":"assertive","aria-atomic":!0,inside:this.container,textContent:""}),this._events={input:{input:this.evaluate.bind(this),blur:this.close.bind(this,{reason:"blur"}),keydown:function(d){var p=d.keyCode;c.opened&&(p===13&&c.selected||p===9&&c.selected&&c.tabSelect?(d.preventDefault(),c.select(void 0,void 0,d)):p===27?c.close({reason:"esc"}):(p===38||p===40)&&(d.preventDefault(),c[p===38?"previous":"next"]()))}},form:{submit:this.close.bind(this,{reason:"submit"})},ul:{mousedown:function(d){d.preventDefault()},click:function(d){var p=d.target;if(p!==this){for(;p&&!/li/i.test(p.nodeName);)p=p.parentNode;p&&d.button===0&&(d.preventDefault(),c.select(p,d.target,d))}}}},a.bind(this.input,this._events.input),a.bind(this.input.form,this._events.form),a.bind(this.ul,this._events.ul),this.input.hasAttribute("list")?(this.list="#"+this.input.getAttribute("list"),this.input.removeAttribute("list")):this.list=this.input.getAttribute("data-list")||u.list||[],e.all.push(this)};e.prototype={set list(l){if(Array.isArray(l))this._list=l;else if(typeof l=="string"&&l.indexOf(",")>-1)this._list=l.split(/\s*,\s*/);else if(l=a(l),l&&l.children){var u=[];n.apply(l.children).forEach(function(c){if(!c.disabled){var d=c.textContent.trim(),p=c.value||d,f=c.label||d;p!==""&&u.push({label:f,value:p})}}),this._list=u}document.activeElement===this.input&&this.evaluate()},get selected(){return this.index>-1},get opened(){return this.isOpened},close:function(l){this.opened&&(this.input.setAttribute("aria-expanded","false"),this.ul.setAttribute("hidden",""),this.isOpened=!1,this.index=-1,this.status.setAttribute("hidden",""),this.input.setAttribute("aria-activedescendant",""),a.fire(this.input,"awesomplete-close",l||{}))},open:function(){this.input.setAttribute("aria-expanded","true"),this.ul.removeAttribute("hidden"),this.isOpened=!0,this.status.removeAttribute("hidden"),this.autoFirst&&this.index===-1&&this.goto(0),a.fire(this.input,"awesomplete-open")},destroy:function(){if(a.unbind(this.input,this._events.input),a.unbind(this.input.form,this._events.form),!this.options.container){var l=this.container.parentNode;l.insertBefore(this.input,this.container),l.removeChild(this.container)}this.input.removeAttribute("autocomplete"),this.input.removeAttribute("aria-autocomplete"),this.input.removeAttribute("aria-expanded"),this.input.removeAttribute("aria-controls"),this.input.removeAttribute("aria-owns"),this.input.removeAttribute("role");var u=e.all.indexOf(this);u!==-1&&e.all.splice(u,1)},next:function(){var l=this.ul.children.length;this.goto(this.index<l-1?this.index+1:l?0:-1)},previous:function(){var l=this.ul.children.length,u=this.index-1;this.goto(this.selected&&u!==-1?u:l-1)},goto:function(l){var u=this.ul.children;this.selected&&u[this.index].setAttribute("aria-selected","false"),this.index=l,l>-1&&u.length>0&&(u[l].setAttribute("aria-selected","true"),this.input.setAttribute("aria-activedescendant",this.ul.id+"_item_"+this.index),this.ul.scrollTop=u[l].offsetTop-this.ul.clientHeight+u[l].clientHeight,a.fire(this.input,"awesomplete-highlight",{text:this.suggestions[this.index]}))},select:function(l,u,c){if(l?this.index=a.siblingIndex(l):l=this.ul.children[this.index],l){var d=this.suggestions[this.index],p=a.fire(this.input,"awesomplete-select",{text:d,origin:u||l,originalEvent:c});p&&(this.replace(d),this.close({reason:"select"}),a.fire(this.input,"awesomplete-selectcomplete",{text:d,originalEvent:c}))}},evaluate:function(){var l=this,u=this.input.value;u.length>=this.minChars&&this._list&&this._list.length>0?(this.index=-1,this.ul.innerHTML="",this.suggestions=this._list.map(function(c){return new i(l.data(c,u))}).filter(function(c){return l.filter(c,u)}),this.sort!==!1&&(this.suggestions=this.suggestions.sort(this.sort)),this.suggestions=this.suggestions.slice(0,this.maxItems),this.suggestions.forEach(function(c,d){l.ul.appendChild(l.item(c,u,d))}),this.ul.children.length===0?(this.status.textContent=this.statusNoResults,this.close({reason:"nomatches"})):(this.input.setAttribute("aria-activedescendant",""),this.open(),this.status.textContent=this.statusXResults.replaceAll("{0}",this.ul.children.length))):(this.close({reason:"nomatches"}),this.minChar<=1||u.length>=this.minChars?this.status.textContent=this.statusNoResults:this.status.textContent=this.statusTypeXChar.replaceAll("{0}",this.minChars))}},e.all=[],e.FILTER_CONTAINS=function(l,u){return RegExp(a.regExpEscape(u.trim()),"i").test(l)},e.FILTER_STARTSWITH=function(l,u){return RegExp("^"+a.regExpEscape(u.trim()),"i").test(l)},e.SORT_BYLENGTH=function(l,u){return l.length!==u.length?l.length-u.length:l<u?-1:1},e.CONTAINER=function(l){return a.create("div",{className:"awesomplete",around:l})},e.ITEM=function(l,u,c){var d=u.trim()===""?l:l.replace(RegExp(a.regExpEscape(u.trim()),"gi"),"<mark>$&</mark>");return a.create("li",{innerHTML:d,role:"option","aria-selected":"false",tabindex:"-1",id:"awesomplete_list_"+this.count+"_item_"+c})},e.REPLACE=function(l){this.input.value=l.value},e.DATA=function(l){return l};function i(l){var u=Array.isArray(l)?{label:l[0],value:l[1]}:typeof l=="object"&&"label"in l&&"value"in l?l:{label:l,value:l};this.label=u.label||u.value,this.value=u.value}Object.defineProperty(i.prototype=Object.create(String.prototype),"length",{get:function(){return this.label.length}}),i.prototype.toString=i.prototype.valueOf=function(){return""+this.label};function r(l,u,c){for(var d in u){var p=u[d],f=l.input.getAttribute("data-"+d.toLowerCase());typeof p=="number"?l[d]=parseInt(f):p===!1?l[d]=f!==null:p instanceof Function?l[d]=null:l[d]=f,!l[d]&&l[d]!==0&&(l[d]=d in c?c[d]:p)}}var n=Array.prototype.slice;function a(l,u){return typeof l=="string"?(u||document).querySelector(l):l||null}function s(l,u){return n.call((u||document).querySelectorAll(l))}a.create=function(l,u){var c=document.createElement(l);for(var d in u){var p=u[d];if(d==="inside")a(p).appendChild(c);else if(d==="around"){var f=a(p);f.parentNode.insertBefore(c,f),c.appendChild(f),f.getAttribute("autofocus")!=null&&f.focus()}else d in c?c[d]=p:c.setAttribute(d,p)}return c},a.bind=function(l,u){if(l)for(var c in u){var d=u[c];c.split(/\s+/).forEach(function(p){l.addEventListener(p,d)})}},a.unbind=function(l,u){if(l)for(var c in u){var d=u[c];c.split(/\s+/).forEach(function(p){l.removeEventListener(p,d)})}},a.fire=function(l,u,c){var d=document.createEvent("HTMLEvents");d.initEvent(u,!0,!0);for(var p in c)d[p]=c[p];return l.dispatchEvent(d)},a.regExpEscape=function(l){return l.replace(/[-\\^$*+?.()|[\]{}]/g,"\\$&")},a.siblingIndex=function(l){for(var u=0;l=l.previousElementSibling;u++);return u};function o(){s("input.awesomplete").forEach(function(l){new e(l)})}return typeof self<"u"&&(self.Awesomplete=e),typeof Document<"u"&&(document.readyState!=="loading"?o():document.addEventListener("DOMContentLoaded",o)),e.$=a,e.$$=s,t.exports&&(t.exports=e),e})()})(yz)),yz.exports}var OOe=kOe();const xOe=L$(OOe);function FOe({list:t,element:e,callback:i,currentValue:r,withCatchTab:n,onChange:a,onSelectComplete:s,listProvider:o}){const l=new xOe(e,{list:t});e.parentElement&&(e.parentElement.style.width="100%"),po(o)&&e.addEventListener("focus",()=>{const d=o();l.list=d});let u=!1;const c=d=>{u=!0,po(i)&&i(d.text.value),e.value=d.text.label,l.suggestions=[],po(s)&&setTimeout(()=>s(),0)};if(n){const d=p=>p.key==="Tab"&&p.preventDefault();e.addEventListener("keydown",d,!1),e.addEventListener("keyup",d,!1)}if(typeof a=="function"&&e.addEventListener("change",a),e.setAttribute("autocomplete","off"),e.addEventListener("awesomplete-selectcomplete",d=>c(d),!1),e.addEventListener("keyup",function(d){const p=d.key==="Tab"&&d.shiftKey;if((d.key==="Enter"||d.key==="Tab"&&!p)&&!u){const f=e.value.trim()==="";if(d.key==="Enter"&&f){po(i)&&i(""),e.value="",l.suggestions=[],po(s)&&setTimeout(()=>s(),0);return}l.suggestions?.length&&!f&&(l.next(),l.select(0))}u=!1}),r){const d=t.find(p=>p.value===r)?.label;d&&(e.value=d)}return{typeAhead:l}}function $$(t){return t[t.length-1]}function qS(t,...e){return e.forEach(i=>{t.includes(i)||t.push(i)}),t}function wz(t,e){return t?t.split(e):[]}function B$(t,e,i){const r=e===void 0||t>=e,n=i===void 0||t<=i;return r&&n}function Fee(t,e,i){return t<e?e:t>i?i:t}function mI(t,e,i={},r=0,n=""){const a=Object.keys(i).reduce((o,l)=>{let u=i[l];return typeof u=="function"&&(u=u(r)),`${o} ${l}="${u}"`},t);n+=`<${a}></${t}>`;const s=r+1;return s<e?mI(t,e,i,s,n):n}function V$(t){return t.replace(/>\s+/g,">").replace(/\s+</,"<")}function XO(t){return new Date(t).setHours(0,0,0,0)}function Eh(){return new Date().setHours(0,0,0,0)}function hI(...t){switch(t.length){case 0:return Eh();case 1:return XO(t[0])}const e=new Date(0);return e.setFullYear(...t),e.setHours(0,0,0,0)}function xb(t,e){const i=new Date(t);return i.setDate(i.getDate()+e)}function LOe(t,e){return xb(t,e*7)}function UP(t,e){const i=new Date(t),r=i.getMonth()+e;let n=r%12;n<0&&(n+=12);const a=i.setMonth(r);return i.getMonth()!==n?i.setDate(0):a}function Fb(t,e){const i=new Date(t),r=i.getMonth(),n=i.setFullYear(i.getFullYear()+e);return r===1&&i.getMonth()===2?i.setDate(0):n}function Sz(t,e){return(t-e+7)%7}function cm(t,e,i=0){const r=new Date(t).getDay();return xb(t,Sz(e,i)-Sz(r,i))}function Lee(t,e){return Math.round((t-e)/6048e5)+1}function _Oe(t){const e=cm(t,4,1),i=cm(new Date(e).setMonth(0,4),4,1);return Lee(e,i)}function _ee(t,e){const i=cm(new Date(t).setMonth(0,1),e,e),r=cm(t,e,e),n=Lee(r,i);if(n<53)return n;const a=cm(new Date(t).setDate(32),e,e);return r===a?1:n}function $Oe(t){return _ee(t,0)}function BOe(t){return _ee(t,6)}function lg(t,e){const i=new Date(t).getFullYear();return Math.floor(i/e)*e}function gp(t,e,i){if(e!==1&&e!==2)return t;const r=new Date(t);return e===1?i?r.setMonth(r.getMonth()+1,0):r.setDate(1):i?r.setFullYear(r.getFullYear()+1,0,0):r.setMonth(0,1),r.setHours(0,0,0,0)}const JO=/dd?|DD?|mm?|MM?|yy?(?:yy)?/,VOe=/[\s!-/:-@[-`{-~å¹´ææ¥]+/;let WA={};const Uz={y(t,e){return new Date(t).setFullYear(parseInt(e,10))},m(t,e,i){const r=new Date(t);let n=parseInt(e,10)-1;if(isNaN(n)){if(!e)return NaN;const a=e.toLowerCase(),s=o=>o.toLowerCase().startsWith(a);if(n=i.monthsShort.findIndex(s),n<0&&(n=i.months.findIndex(s)),n<0)return NaN}return r.setMonth(n),r.getMonth()!==$ee(n)?r.setDate(0):r.getTime()},d(t,e){return new Date(t).setDate(parseInt(e,10))}},jOe={d(t){return t.getDate()},dd(t){return DT(t.getDate(),2)},D(t,e){return e.daysShort[t.getDay()]},DD(t,e){return e.days[t.getDay()]},m(t){return t.getMonth()+1},mm(t){return DT(t.getMonth()+1,2)},M(t,e){return e.monthsShort[t.getMonth()]},MM(t,e){return e.months[t.getMonth()]},y(t){return t.getFullYear()},yy(t){return DT(t.getFullYear(),2).slice(-2)},yyyy(t){return DT(t.getFullYear(),4)}};function $ee(t){return t>-1?t%12:$ee(t+12)}function DT(t,e){return t.toString().padStart(e,"0")}function Bee(t){if(typeof t!="string")throw new Error("Invalid date format.");if(t in WA)return WA[t];const e=t.split(JO),i=t.match(new RegExp(JO,"g"));if(e.length===0||!i)throw new Error("Invalid date format.");const r=i.map(a=>jOe[a]),n=Object.keys(Uz).reduce((a,s)=>(i.find(o=>o[0]!=="D"&&o[0].toLowerCase()===s)&&a.push(s),a),[]);return WA[t]={parser(a,s){const o=a.split(VOe).reduce((l,u,c)=>{if(u.length>0&&i[c]){const d=i[c][0];d==="M"?l.m=u:d!=="D"&&(l[d]=u)}return l},{});return n.reduce((l,u)=>{const c=Uz[u](l,o[u],s);return isNaN(c)?l:c},Eh())},formatter(a,s){let o=r.reduce((l,u,c)=>l+=`${e[c]}${u(a,s)}`,"");return o+=$$(e)}}}function Lm(t,e,i){if(t instanceof Date||typeof t=="number"){const r=XO(t);return isNaN(r)?void 0:r}if(t){if(t==="today")return Eh();if(e&&e.toValue){const r=e.toValue(t,e,i);return isNaN(r)?void 0:XO(r)}return Bee(e).parser(t,i)}}function tM(t,e,i){if(isNaN(t)||!t&&t!==0)return"";const r=typeof t=="number"?new Date(t):t;return e.toDisplay?e.toDisplay(r,e,i):Bee(e).formatter(r,i)}const GOe=document.createRange();function wd(t){return GOe.createContextualFragment(t)}function Vee(t){return t.parentElement||(t.parentNode instanceof ShadowRoot?t.parentNode.host:void 0)}function iM(t){return t.getRootNode().activeElement===t}function jy(t){t.style.display!=="none"&&(t.style.display&&(t.dataset.styleDisplay=t.style.display),t.style.display="none")}function Gy(t){t.style.display==="none"&&(t.dataset.styleDisplay?(t.style.display=t.dataset.styleDisplay,delete t.dataset.styleDisplay):t.style.display="")}function TP(t){t.firstChild&&(t.removeChild(t.firstChild),TP(t))}function HOe(t,e){TP(t),e instanceof DocumentFragment?t.appendChild(e):typeof e=="string"?t.appendChild(wd(e)):typeof e.forEach=="function"&&e.forEach(i=>{t.appendChild(i)})}const DP=new WeakMap,{addEventListener:WOe,removeEventListener:zOe}=EventTarget.prototype;function QO(t,e){let i=DP.get(t);i||(i=[],DP.set(t,i)),e.forEach(r=>{WOe.call(...r),i.push(r)})}function qOe(t){let e=DP.get(t);e&&(e.forEach(i=>{zOe.call(...i)}),DP.delete(t))}if(!Event.prototype.composedPath){const t=(e,i=[])=>{i.push(e);let r;return e.parentNode?r=e.parentNode:e.host?r=e.host:e.defaultView&&(r=e.defaultView),r?t(r,i):i};Event.prototype.composedPath=function(){return t(this.target)}}function jee(t,e,i){const[r,...n]=t;if(e(r))return r;if(!(r===i||r.tagName==="HTML"||n.length===0))return jee(n,e,i)}function Gee(t,e){const i=typeof e=="function"?e:r=>r instanceof Element&&r.matches(e);return jee(t.composedPath(),i,t.currentTarget)}const fy={en:{days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],daysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],daysMin:["Su","Mo","Tu","We","Th","Fr","Sa"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],today:"Today",clear:"Clear",titleFormat:"MM y"}},j$={autohide:!1,beforeShowDay:null,beforeShowDecade:null,beforeShowMonth:null,beforeShowYear:null,clearButton:!1,dateDelimiter:",",datesDisabled:[],daysOfWeekDisabled:[],daysOfWeekHighlighted:[],defaultViewDate:void 0,disableTouchKeyboard:!1,enableOnReadonly:!0,format:"mm/dd/yyyy",language:"en",maxDate:null,maxNumberOfDates:1,maxView:3,minDate:null,nextArrow:"Â»",orientation:"auto",pickLevel:0,prevArrow:"Â«",showDaysOfWeek:!0,showOnClick:!0,showOnFocus:!0,startView:0,title:"",todayButton:!1,todayButtonMode:0,todayHighlight:!1,updateOnBlur:!0,weekNumbers:0,weekStart:0},{language:zA,format:YOe,weekStart:KOe}=j$;function Tz(t,e){return t.length<6&&e>=0&&e<7?qS(t,e):t}function Hee(t,e){switch(t===4?e===6?3:!e+1:t){case 1:return _Oe;case 2:return $Oe;case 3:return BOe}}function Dz(t,e,i){return e.weekStart=t,e.weekEnd=(t+6)%7,i===4&&(e.getWeekNumber=Hee(4,t)),t}function Pz(t,e,i,r){const n=Lm(t,e,i);return n!==void 0?n:r}function qA(t,e,i=3){const r=parseInt(t,10);return r>=0&&r<=i?r:e}function PT(t,e,i,r=void 0){e in t&&(i in t||(t[i]=r?r(t[e]):t[e]),delete t[e])}function YA(t,e){const i=Object.assign({},t),r={},n=e.constructor.locales,a=!!e.rangeSideIndex;let{datesDisabled:s,format:o,language:l,locale:u,maxDate:c,maxView:d,minDate:p,pickLevel:f,startView:m,weekNumbers:h,weekStart:g}=e.config||{};if(PT(i,"calendarWeeks","weekNumbers",S=>S?1:0),PT(i,"clearBtn","clearButton"),PT(i,"todayBtn","todayButton"),PT(i,"todayBtnMode","todayButtonMode"),i.language){let S;if(i.language!==l&&(n[i.language]?S=i.language:(S=i.language.split("-")[0],n[S]||(S=!1))),delete i.language,S){l=r.language=S;const U=u||n[zA];u=Object.assign({format:YOe,weekStart:KOe},n[zA]),l!==zA&&Object.assign(u,n[l]),r.locale=u,o===U.format&&(o=r.format=u.format),g===U.weekStart&&(g=Dz(u.weekStart,r,h))}}if(i.format){const S=typeof i.format.toDisplay=="function",U=typeof i.format.toValue=="function",T=JO.test(i.format);(S&&U||T)&&(o=r.format=i.format),delete i.format}let I=f;"pickLevel"in i&&(I=qA(i.pickLevel,f,2),delete i.pickLevel),I!==f&&(I>f&&("minDate"in i||(i.minDate=p),"maxDate"in i||(i.maxDate=c)),s&&!i.datesDisabled&&(i.datesDisabled=[]),f=r.pickLevel=I);let v=p,w=c;if("minDate"in i){const S=hI(0,0,1);v=i.minDate===null?S:Pz(i.minDate,o,u,v),v!==S&&(v=gp(v,f,!1)),delete i.minDate}if("maxDate"in i&&(w=i.maxDate===null?void 0:Pz(i.maxDate,o,u,w),w!==void 0&&(w=gp(w,f,!0)),delete i.maxDate),w<v?(p=r.minDate=w,c=r.maxDate=v):(p!==v&&(p=r.minDate=v),c!==w&&(c=r.maxDate=w)),i.datesDisabled){const S=i.datesDisabled;if(typeof S=="function")r.datesDisabled=null,r.checkDisabled=(U,T)=>S(new Date(U),T,a);else{const U=r.datesDisabled=S.reduce((T,P)=>{const D=Lm(P,o,u);return D!==void 0?qS(T,gp(D,f,a)):T},[]);r.checkDisabled=T=>U.includes(T)}delete i.datesDisabled}if("defaultViewDate"in i){const S=Lm(i.defaultViewDate,o,u);S!==void 0&&(r.defaultViewDate=S),delete i.defaultViewDate}if("weekStart"in i){const S=Number(i.weekStart)%7;isNaN(S)||(g=Dz(S,r,h)),delete i.weekStart}if(i.daysOfWeekDisabled&&(r.daysOfWeekDisabled=i.daysOfWeekDisabled.reduce(Tz,[]),delete i.daysOfWeekDisabled),i.daysOfWeekHighlighted&&(r.daysOfWeekHighlighted=i.daysOfWeekHighlighted.reduce(Tz,[]),delete i.daysOfWeekHighlighted),"weekNumbers"in i){let S=i.weekNumbers;if(S){const U=typeof S=="function"?(T,P)=>S(new Date(T),P):Hee(S=parseInt(S,10),g);U&&(h=r.weekNumbers=S,r.getWeekNumber=U)}else h=r.weekNumbers=0,r.getWeekNumber=null;delete i.weekNumbers}if("maxNumberOfDates"in i){const S=parseInt(i.maxNumberOfDates,10);S>=0&&(r.maxNumberOfDates=S,r.multidate=S!==1),delete i.maxNumberOfDates}i.dateDelimiter&&(r.dateDelimiter=String(i.dateDelimiter),delete i.dateDelimiter);let y=d;"maxView"in i&&(y=qA(i.maxView,d),delete i.maxView),y=f>y?f:y,y!==d&&(d=r.maxView=y);let b=m;if("startView"in i&&(b=qA(i.startView,b),delete i.startView),b<f?b=f:b>d&&(b=d),b!==m&&(r.startView=b),i.prevArrow){const S=wd(i.prevArrow);S.childNodes.length>0&&(r.prevArrow=S.childNodes),delete i.prevArrow}if(i.nextArrow){const S=wd(i.nextArrow);S.childNodes.length>0&&(r.nextArrow=S.childNodes),delete i.nextArrow}if("disableTouchKeyboard"in i&&(r.disableTouchKeyboard="ontouchstart"in document&&!!i.disableTouchKeyboard,delete i.disableTouchKeyboard),i.orientation){const S=i.orientation.toLowerCase().split(/\s+/g);r.orientation={x:S.find(U=>U==="left"||U==="right")||"auto",y:S.find(U=>U==="top"||U==="bottom")||"auto"},delete i.orientation}if("todayButtonMode"in i){switch(i.todayButtonMode){case 0:case 1:r.todayButtonMode=i.todayButtonMode}delete i.todayButtonMode}return Object.entries(i).forEach(([S,U])=>{U!==void 0&&S in j$&&(r[S]=U)}),r}const Ez={show:{key:"ArrowDown"},hide:null,toggle:{key:"Escape"},prevButton:{key:"ArrowLeft",ctrlOrMetaKey:!0},nextButton:{key:"ArrowRight",ctrlOrMetaKey:!0},viewSwitch:{key:"ArrowUp",ctrlOrMetaKey:!0},clearButton:{key:"Backspace",ctrlOrMetaKey:!0},todayButton:{key:".",ctrlOrMetaKey:!0},exitEditMode:{key:"ArrowDown",ctrlOrMetaKey:!0}};function XOe(t){return Object.keys(Ez).reduce((e,i)=>{const r=t[i]===void 0?Ez[i]:t[i],n=r&&r.key;if(!n||typeof n!="string")return e;const a={key:n,ctrlOrMetaKey:!!(r.ctrlOrMetaKey||r.ctrlKey||r.metaKey)};return n.length>1&&(a.altKey=!!r.altKey,a.shiftKey=!!r.shiftKey),e[i]=a,e},{})}const Rz=t=>t.map(e=>`<button type="button" class="%buttonClass% ${e}" tabindex="-1"></button>`).join(""),JOe=V$(`<div class="datepicker">
  <div class="datepicker-picker">
    <div class="datepicker-header">
      <div class="datepicker-title"></div>
      <div class="datepicker-controls">
        ${Rz(["prev-button prev-btn","view-switch","next-button next-btn"])}
      </div>
    </div>
    <div class="datepicker-main"></div>
    <div class="datepicker-footer">
      <div class="datepicker-controls">
        ${Rz(["today-button today-btn","clear-button clear-btn"])}
      </div>
    </div>
  </div>
</div>`),QOe=V$(`<div class="days">
  <div class="days-of-week">${mI("span",7,{class:"dow"})}</div>
  <div class="datepicker-grid">${mI("span",42)}</div>
</div>`),ZOe=V$(`<div class="week-numbers calendar-weeks">
  <div class="days-of-week"><span class="dow"></span></div>
  <div class="weeks">${mI("span",6,{class:"week"})}</div>
</div>`);class G${constructor(e,i){Object.assign(this,i,{picker:e,element:wd('<div class="datepicker-view"></div>').firstChild,selected:[],isRangeEnd:!!e.datepicker.rangeSideIndex}),this.init(this.picker.datepicker.config)}init(e){"pickLevel"in e&&(this.isMinView=this.id===e.pickLevel),this.setOptions(e),this.updateFocus(),this.updateSelection()}prepareForRender(e,i,r){this.disabled=[];const n=this.picker;n.setViewSwitchLabel(e),n.setPrevButtonDisabled(i),n.setNextButtonDisabled(r)}setDisabled(e,i){i.add("disabled"),qS(this.disabled,e)}performBeforeHook(e,i){let r=this.beforeShow(new Date(i));switch(typeof r){case"boolean":r={enabled:r};break;case"string":r={classes:r}}if(r){const n=e.classList;if(r.enabled===!1&&this.setDisabled(i,n),r.classes){const a=r.classes.split(/\s+/);n.add(...a),a.includes("disabled")&&this.setDisabled(i,n)}r.content&&HOe(e,r.content)}}renderCell(e,i,r,n,{selected:a,range:s},o,l=[]){e.textContent=i,this.isMinView&&(e.dataset.date=n);const u=e.classList;if(e.className=`datepicker-cell ${this.cellClass}`,r<this.first?u.add("prev"):r>this.last&&u.add("next"),u.add(...l),(o||this.checkDisabled(n,this.id))&&this.setDisabled(n,u),s){const[c,d]=s;r>c&&r<d&&u.add("range"),r===c&&u.add("range-start"),r===d&&u.add("range-end")}a.includes(r)&&u.add("selected"),r===this.focused&&u.add("focused"),this.beforeShow&&this.performBeforeHook(e,n)}refreshCell(e,i,r,[n,a]){const s=e.classList;s.remove("range","range-start","range-end","selected","focused"),i>n&&i<a&&s.add("range"),i===n&&s.add("range-start"),i===a&&s.add("range-end"),r.includes(i)&&s.add("selected"),i===this.focused&&s.add("focused")}changeFocusedCell(e){this.grid.querySelectorAll(".focused").forEach(i=>{i.classList.remove("focused")}),this.grid.children[e].classList.add("focused")}}class exe extends G${constructor(e){super(e,{id:0,name:"days",cellClass:"day"})}init(e,i=!0){if(i){const r=wd(QOe).firstChild;this.dow=r.firstChild,this.grid=r.lastChild,this.element.appendChild(r)}super.init(e)}setOptions(e){let i;if("minDate"in e&&(this.minDate=e.minDate),"maxDate"in e&&(this.maxDate=e.maxDate),e.checkDisabled&&(this.checkDisabled=e.checkDisabled),e.daysOfWeekDisabled&&(this.daysOfWeekDisabled=e.daysOfWeekDisabled,i=!0),e.daysOfWeekHighlighted&&(this.daysOfWeekHighlighted=e.daysOfWeekHighlighted),"todayHighlight"in e&&(this.todayHighlight=e.todayHighlight),"weekStart"in e&&(this.weekStart=e.weekStart,this.weekEnd=e.weekEnd,i=!0),e.locale){const r=this.locale=e.locale;this.dayNames=r.daysMin,this.switchLabelFormat=r.titleFormat,i=!0}if("beforeShowDay"in e&&(this.beforeShow=typeof e.beforeShowDay=="function"?e.beforeShowDay:void 0),"weekNumbers"in e)if(e.weekNumbers&&!this.weekNumbers){const r=wd(ZOe).firstChild;this.weekNumbers={element:r,dow:r.firstChild,weeks:r.lastChild},this.element.insertBefore(r,this.element.firstChild)}else this.weekNumbers&&!e.weekNumbers&&(this.element.removeChild(this.weekNumbers.element),this.weekNumbers=null);"getWeekNumber"in e&&(this.getWeekNumber=e.getWeekNumber),"showDaysOfWeek"in e&&(e.showDaysOfWeek?(Gy(this.dow),this.weekNumbers&&Gy(this.weekNumbers.dow)):(jy(this.dow),this.weekNumbers&&jy(this.weekNumbers.dow))),i&&Array.from(this.dow.children).forEach((r,n)=>{const a=(this.weekStart+n)%7;r.textContent=this.dayNames[a],r.className=this.daysOfWeekDisabled.includes(a)?"dow disabled":"dow"})}updateFocus(){const e=new Date(this.picker.viewDate),i=e.getFullYear(),r=e.getMonth(),n=hI(i,r,1),a=cm(n,this.weekStart,this.weekStart);this.first=n,this.last=hI(i,r+1,0),this.start=a,this.focused=this.picker.viewDate}updateSelection(){const{dates:e,rangepicker:i}=this.picker.datepicker;this.selected=e,i&&(this.range=i.dates)}render(){if(this.today=this.todayHighlight?Eh():void 0,this.prepareForRender(tM(this.focused,this.switchLabelFormat,this.locale),this.first<=this.minDate,this.last>=this.maxDate),this.weekNumbers){const e=this.weekStart,i=cm(this.first,e,e);Array.from(this.weekNumbers.weeks.children).forEach((r,n)=>{const a=LOe(i,n);r.textContent=this.getWeekNumber(a,e),n>3&&r.classList[a>this.last?"add":"remove"]("next")})}Array.from(this.grid.children).forEach((e,i)=>{const r=xb(this.start,i),n=new Date(r),a=n.getDay(),s=[];this.today===r&&s.push("today"),this.daysOfWeekHighlighted.includes(a)&&s.push("highlighted"),this.renderCell(e,n.getDate(),r,r,this,r<this.minDate||r>this.maxDate||this.daysOfWeekDisabled.includes(a),s)})}refresh(){const e=this.range||[];Array.from(this.grid.children).forEach(i=>{this.refreshCell(i,Number(i.dataset.date),this.selected,e)})}refreshFocus(){this.changeFocusedCell(Math.round((this.focused-this.start)/864e5))}}function Cz(t,e){if(!t||!t[0]||!t[1])return;const[[i,r],[n,a]]=t;if(!(i>e||n<e))return[i===e?r:-1,n===e?a:12]}class txe extends G${constructor(e){super(e,{id:1,name:"months",cellClass:"month"})}init(e,i=!0){i&&(this.grid=this.element,this.element.classList.add("months","datepicker-grid"),this.grid.appendChild(wd(mI("span",12,{"data-month":r=>r}))),this.first=0,this.last=11),super.init(e)}setOptions(e){if(e.locale&&(this.monthNames=e.locale.monthsShort),"minDate"in e)if(e.minDate===void 0)this.minYear=this.minMonth=this.minDate=void 0;else{const i=new Date(e.minDate);this.minYear=i.getFullYear(),this.minMonth=i.getMonth(),this.minDate=i.setDate(1)}if("maxDate"in e)if(e.maxDate===void 0)this.maxYear=this.maxMonth=this.maxDate=void 0;else{const i=new Date(e.maxDate);this.maxYear=i.getFullYear(),this.maxMonth=i.getMonth(),this.maxDate=hI(this.maxYear,this.maxMonth+1,0)}e.checkDisabled&&(this.checkDisabled=this.isMinView||e.datesDisabled===null?e.checkDisabled:()=>!1),"beforeShowMonth"in e&&(this.beforeShow=typeof e.beforeShowMonth=="function"?e.beforeShowMonth:void 0)}updateFocus(){const e=new Date(this.picker.viewDate);this.year=e.getFullYear(),this.focused=e.getMonth()}updateSelection(){const{dates:e,rangepicker:i}=this.picker.datepicker;this.selected=e.reduce((r,n)=>{const a=new Date(n),s=a.getFullYear(),o=a.getMonth();return r[s]===void 0?r[s]=[o]:qS(r[s],o),r},{}),i&&i.dates&&(this.range=i.dates.map(r=>{const n=new Date(r);return isNaN(n)?void 0:[n.getFullYear(),n.getMonth()]}))}render(){this.prepareForRender(this.year,this.year<=this.minYear,this.year>=this.maxYear);const e=this.selected[this.year]||[],i=this.year<this.minYear||this.year>this.maxYear,r=this.year===this.minYear,n=this.year===this.maxYear,a=Cz(this.range,this.year);Array.from(this.grid.children).forEach((s,o)=>{const l=gp(new Date(this.year,o,1),1,this.isRangeEnd);this.renderCell(s,this.monthNames[o],o,l,{selected:e,range:a},i||r&&o<this.minMonth||n&&o>this.maxMonth)})}refresh(){const e=this.selected[this.year]||[],i=Cz(this.range,this.year)||[];Array.from(this.grid.children).forEach((r,n)=>{this.refreshCell(r,n,e,i)})}refreshFocus(){this.changeFocusedCell(this.focused)}}function ixe(t){return[...t].reduce((e,i,r)=>e+=r?i:i.toUpperCase(),"")}class Mz extends G${constructor(e,i){super(e,i)}init(e,i=!0){i&&(this.navStep=this.step*10,this.beforeShowOption=`beforeShow${ixe(this.cellClass)}`,this.grid=this.element,this.element.classList.add(this.name,"datepicker-grid"),this.grid.appendChild(wd(mI("span",12)))),super.init(e)}setOptions(e){if("minDate"in e&&(e.minDate===void 0?this.minYear=this.minDate=void 0:(this.minYear=lg(e.minDate,this.step),this.minDate=hI(this.minYear,0,1))),"maxDate"in e&&(e.maxDate===void 0?this.maxYear=this.maxDate=void 0:(this.maxYear=lg(e.maxDate,this.step),this.maxDate=hI(this.maxYear,11,31))),e.checkDisabled&&(this.checkDisabled=this.isMinView||e.datesDisabled===null?e.checkDisabled:()=>!1),this.beforeShowOption in e){const i=e[this.beforeShowOption];this.beforeShow=typeof i=="function"?i:void 0}}updateFocus(){const e=new Date(this.picker.viewDate),i=lg(e,this.navStep),r=i+9*this.step;this.first=i,this.last=r,this.start=i-this.step,this.focused=lg(e,this.step)}updateSelection(){const{dates:e,rangepicker:i}=this.picker.datepicker;this.selected=e.reduce((r,n)=>qS(r,lg(n,this.step)),[]),i&&i.dates&&(this.range=i.dates.map(r=>{if(r!==void 0)return lg(r,this.step)}))}render(){this.prepareForRender(`${this.first}-${this.last}`,this.first<=this.minYear,this.last>=this.maxYear),Array.from(this.grid.children).forEach((e,i)=>{const r=this.start+i*this.step,n=gp(new Date(r,0,1),2,this.isRangeEnd);e.dataset.year=r,this.renderCell(e,r,r,n,this,r<this.minYear||r>this.maxYear)})}refresh(){const e=this.range||[];Array.from(this.grid.children).forEach(i=>{this.refreshCell(i,Number(i.textContent),this.selected,e)})}refreshFocus(){this.changeFocusedCell(Math.round((this.focused-this.start)/this.step))}}function vg(t,e){const i={bubbles:!0,cancelable:!0,detail:{date:t.getDate(),viewDate:new Date(t.picker.viewDate),viewId:t.picker.currentView.id,datepicker:t}};t.element.dispatchEvent(new CustomEvent(e,i))}function PP(t,e){const{config:i,picker:r}=t,{currentView:n,viewDate:a}=r;let s;switch(n.id){case 0:s=UP(a,e);break;case 1:s=Fb(a,e);break;default:s=Fb(a,e*n.navStep)}s=Fee(s,i.minDate,i.maxDate),r.changeFocus(s).render()}function Wee(t){const e=t.picker.currentView.id;e!==t.config.maxView&&t.picker.changeView(e+1).render()}function zee(t){t.setDate({clear:!0})}function qee(t){const e=Eh();t.config.todayButtonMode===1?t.setDate(e,{forceRefresh:!0,viewDate:e}):t.setFocusedDate(e,!0)}function Yee(t){const e=()=>{t.config.updateOnBlur?t.update({revert:!0}):t.refresh("input"),t.hide()},i=t.element;iM(i)?i.addEventListener("blur",e,{once:!0}):e()}function Nz(t,e){const i=t.picker,r=new Date(i.viewDate),n=i.currentView.id,a=n===1?UP(r,e-r.getMonth()):Fb(r,e-r.getFullYear());i.changeFocus(a).changeView(n-1).render()}function rxe(t){Wee(t)}function nxe(t){PP(t,-1)}function axe(t){PP(t,1)}function sxe(t,e){const i=Gee(e,".datepicker-cell");if(!i||i.classList.contains("disabled"))return;const{id:r,isMinView:n}=t.picker.currentView,a=i.dataset;n?t.setDate(Number(a.date)):r===1?Nz(t,Number(a.month)):Nz(t,Number(a.year))}function oxe(t){t.preventDefault()}const KA=["left","top","right","bottom"].reduce((t,e)=>(t[e]=`datepicker-orient-${e}`,t),{}),Az=t=>t&&`${t}px`;function kz(t,e){if("title"in e&&(e.title?(t.controls.title.textContent=e.title,Gy(t.controls.title)):(t.controls.title.textContent="",jy(t.controls.title))),e.prevArrow){const i=t.controls.prevButton;TP(i),e.prevArrow.forEach(r=>{i.appendChild(r.cloneNode(!0))})}if(e.nextArrow){const i=t.controls.nextButton;TP(i),e.nextArrow.forEach(r=>{i.appendChild(r.cloneNode(!0))})}if(e.locale&&(t.controls.todayButton.textContent=e.locale.today,t.controls.clearButton.textContent=e.locale.clear),"todayButton"in e&&(e.todayButton?Gy(t.controls.todayButton):jy(t.controls.todayButton)),"minDate"in e||"maxDate"in e){const{minDate:i,maxDate:r}=t.datepicker.config;t.controls.todayButton.disabled=!B$(Eh(),i,r)}"clearButton"in e&&(e.clearButton?Gy(t.controls.clearButton):jy(t.controls.clearButton))}function Oz(t){const{dates:e,config:i,rangeSideIndex:r}=t,n=e.length>0?$$(e):gp(i.defaultViewDate,i.pickLevel,r);return Fee(n,i.minDate,i.maxDate)}function xz(t,e){!("_oldViewDate"in t)&&e!==t.viewDate&&(t._oldViewDate=t.viewDate),t.viewDate=e;const{id:i,year:r,first:n,last:a}=t.currentView,s=new Date(e).getFullYear();switch(i){case 0:return e<n||e>a;case 1:return s!==r;default:return s<n||s>a}}function XA(t){return window.getComputedStyle(t).direction}function Kee(t){const e=Vee(t);if(!(e===document.body||!e))return window.getComputedStyle(e).overflow!=="visible"?e:Kee(e)}class lxe{constructor(e){const{config:i,inputField:r}=this.datepicker=e,n=JOe.replace(/%buttonClass%/g,i.buttonClass),a=this.element=wd(n).firstChild,[s,o,l]=a.firstChild.children,u=s.firstElementChild,[c,d,p]=s.lastElementChild.children,[f,m]=l.firstChild.children,h={title:u,prevButton:c,viewSwitch:d,nextButton:p,todayButton:f,clearButton:m};this.main=o,this.controls=h;const g=r?"dropdown":"inline";a.classList.add(`datepicker-${g}`),kz(this,i),this.viewDate=Oz(e),QO(e,[[a,"mousedown",oxe],[o,"click",sxe.bind(null,e)],[h.viewSwitch,"click",rxe.bind(null,e)],[h.prevButton,"click",nxe.bind(null,e)],[h.nextButton,"click",axe.bind(null,e)],[h.todayButton,"click",qee.bind(null,e)],[h.clearButton,"click",zee.bind(null,e)]]),this.views=[new exe(this),new txe(this),new Mz(this,{id:2,name:"years",cellClass:"year",step:1}),new Mz(this,{id:3,name:"decades",cellClass:"decade",step:10})],this.currentView=this.views[i.startView],this.currentView.render(),this.main.appendChild(this.currentView.element),i.container?i.container.appendChild(this.element):r.after(this.element)}setOptions(e){kz(this,e),this.views.forEach(i=>{i.init(e,!1)}),this.currentView.render()}detach(){this.element.remove()}show(){if(this.active)return;const{datepicker:e,element:i}=this,r=e.inputField;if(r){const n=XA(r);n!==XA(Vee(i))?i.dir=n:i.dir&&i.removeAttribute("dir"),this.place(),i.classList.add("active"),e.config.disableTouchKeyboard&&r.blur()}else i.classList.add("active");this.active=!0,vg(e,"show")}hide(){this.active&&(this.datepicker.exitEditMode(),this.element.classList.remove("active"),this.active=!1,vg(this.datepicker,"hide"))}place(){const{classList:e,style:i}=this.element;i.display="block";const{width:r,height:n}=this.element.getBoundingClientRect(),a=this.element.offsetParent;i.display="";const{config:s,inputField:o}=this.datepicker,{left:l,top:u,right:c,bottom:d,width:p,height:f}=o.getBoundingClientRect();let{x:m,y:h}=s.orientation,g=l,I=u;if(a===document.body||!a)g+=window.scrollX,I+=window.scrollY;else{const T=a.getBoundingClientRect();g-=T.left-a.scrollLeft,I-=T.top-a.scrollTop}const v=Kee(o);let w=0,y=0,{clientWidth:b,clientHeight:S}=document.documentElement;if(v){const T=v.getBoundingClientRect();T.top>0&&(y=T.top),T.left>0&&(w=T.left),T.right<b&&(b=T.right),T.bottom<S&&(S=T.bottom)}let U=0;m==="auto"&&(l<w?(m="left",U=w-l):l+r>b?(m="right",b<c&&(U=b-c)):XA(o)==="rtl"?m=c-r<w?"left":"right":m="left"),m==="right"&&(g+=p-r),g+=U,h==="auto"&&(u-n>y?h=d+n>S?"top":"bottom":h="bottom"),h==="top"?I-=n:I+=f,e.remove(...Object.values(KA)),e.add(KA[m],KA[h]),i.left=Az(g),i.top=Az(I)}setViewSwitchLabel(e){this.controls.viewSwitch.textContent=e}setPrevButtonDisabled(e){this.controls.prevButton.disabled=e}setNextButtonDisabled(e){this.controls.nextButton.disabled=e}changeView(e){const i=this.currentView;return e!==i.id&&(this._oldView||(this._oldView=i),this.currentView=this.views[e],this._renderMethod="render"),this}changeFocus(e){return this._renderMethod=xz(this,e)?"render":"refreshFocus",this.views.forEach(i=>{i.updateFocus()}),this}update(e=void 0){const i=e===void 0?Oz(this.datepicker):e;return this._renderMethod=xz(this,i)?"render":"refresh",this.views.forEach(r=>{r.updateFocus(),r.updateSelection()}),this}render(e=!0){const{currentView:i,datepicker:r,_oldView:n}=this,a=new Date(this._oldViewDate),s=e&&this._renderMethod||"render";if(delete this._oldView,delete this._oldViewDate,delete this._renderMethod,i[s](),n&&(this.main.replaceChild(i.element,n.element),vg(r,"changeView")),!isNaN(a)){const o=new Date(this.viewDate);o.getFullYear()!==a.getFullYear()&&vg(r,"changeYear"),o.getMonth()!==a.getMonth()&&vg(r,"changeMonth")}}}function Xee(t,e,i,r,n,a){if(B$(t,n,a)){if(r(t)){const s=e(t,i);return Xee(s,e,i,r,n,a)}return t}}function uxe(t,e,i){const r=t.picker,n=r.currentView,a=n.step||1;let s=r.viewDate,o;switch(n.id){case 0:s=xb(s,i?e*7:e),o=xb;break;case 1:s=UP(s,i?e*4:e),o=UP;break;default:s=Fb(s,e*(i?4:1)*a),o=Fb}s=Xee(s,o,e<0?-a:a,l=>n.disabled.includes(l),n.minDate,n.maxDate),s!==void 0&&r.changeFocus(s).render()}function cxe(t,e){const{config:i,picker:r,editMode:n}=t,a=r.active,{key:s,altKey:o,shiftKey:l}=e,u=e.ctrlKey||e.metaKey,c=()=>{e.preventDefault(),e.stopPropagation()};if(s==="Tab"){Yee(t);return}if(s==="Enter"){if(!a)t.update();else if(n)t.exitEditMode({update:!0,autohide:i.autohide});else{const h=r.currentView;h.isMinView?t.setDate(r.viewDate):(r.changeView(h.id-1).render(),c())}return}const d=i.shortcutKeys,p={key:s,ctrlOrMetaKey:u,altKey:o,shiftKey:l},f=Object.keys(d).find(h=>{const g=d[h];return!Object.keys(g).find(I=>g[I]!==p[I])});if(f){let h;if(f==="toggle"?h=f:n?f==="exitEditMode"&&(h=f):a?f==="hide"?h=f:f==="prevButton"?h=[PP,[t,-1]]:f==="nextButton"?h=[PP,[t,1]]:f==="viewSwitch"?h=[Wee,[t]]:i.clearButton&&f==="clearButton"?h=[zee,[t]]:i.todayButton&&f==="todayButton"&&(h=[qee,[t]]):f==="show"&&(h=f),h){Array.isArray(h)?h[0].apply(null,h[1]):t[h](),c();return}}if(!a||n)return;const m=(h,g)=>{l||u||o?t.enterEditMode():(uxe(t,h,g),e.preventDefault())};s==="ArrowLeft"?m(-1,!1):s==="ArrowRight"?m(1,!1):s==="ArrowUp"?m(-1,!0):s==="ArrowDown"?m(1,!0):(s==="Backspace"||s==="Delete"||s&&s.length===1&&!u)&&t.enterEditMode()}function dxe(t){t.config.showOnFocus&&!t._showing&&t.show()}function pxe(t,e){const i=e.target;(t.picker.active||t.config.showOnClick)&&(i._active=iM(i),i._clicking=setTimeout(()=>{delete i._active,delete i._clicking},2e3))}function fxe(t,e){const i=e.target;i._clicking&&(clearTimeout(i._clicking),delete i._clicking,i._active&&t.enterEditMode(),delete i._active,t.config.showOnClick&&t.show())}function mxe(t,e){e.clipboardData.types.includes("text/plain")&&t.enterEditMode()}function hxe(t,e){const{element:i,picker:r}=t;if(!r.active&&!iM(i))return;const n=r.element;Gee(e,a=>a===i||a===n)||Yee(t)}function Jee(t,e){return t.map(i=>tM(i,e.format,e.locale)).join(e.dateDelimiter)}function Qee(t,e,i=!1){if(e.length===0)return i?[]:void 0;const{config:r,dates:n,rangeSideIndex:a}=t,{pickLevel:s,maxNumberOfDates:o}=r;let l=e.reduce((u,c)=>{let d=Lm(c,r.format,r.locale);return d===void 0||(d=gp(d,s,a),B$(d,r.minDate,r.maxDate)&&!u.includes(d)&&!r.checkDisabled(d,s)&&(s>0||!r.daysOfWeekDisabled.includes(new Date(d).getDay()))&&u.push(d)),u},[]);if(l.length!==0)return r.multidate&&!i&&(l=l.reduce((u,c)=>(n.includes(c)||u.push(c),u),n.filter(u=>!l.includes(u)))),o&&l.length>o?l.slice(o*-1):l}function EP(t,e=3,i=!0,r=void 0){const{config:n,picker:a,inputField:s}=t;if(e&2){const o=a.active?n.pickLevel:n.startView;a.update(r).changeView(o).render(i)}e&1&&s&&(s.value=Jee(t.dates,n))}function Fz(t,e,i){const r=t.config;let{clear:n,render:a,autohide:s,revert:o,forceRefresh:l,viewDate:u}=i;a===void 0&&(a=!0),a?s===void 0&&(s=r.autohide):s=l=!1,u=Lm(u,r.format,r.locale);const c=Qee(t,e,n);!c&&!o||(c&&c.toString()!==t.dates.toString()?(t.dates=c,EP(t,a?3:1,!0,u),vg(t,"changeDate")):EP(t,l?3:1,!0,u),s&&t.hide())}function Lz(t,e){return e?i=>tM(i,e,t.config.locale):i=>new Date(i)}class gxe{constructor(e,i={},r=void 0){e.datepicker=this,this.element=e,this.dates=[];const n=this.config=Object.assign({buttonClass:i.buttonClass&&String(i.buttonClass)||"button",container:null,defaultViewDate:Eh(),maxDate:void 0,minDate:void 0},YA(j$,this));let a;if(e.tagName==="INPUT"?(a=this.inputField=e,a.classList.add("datepicker-input"),i.container&&(n.container=i.container instanceof HTMLElement?i.container:document.querySelector(i.container))):n.container=e,r){const c=r.inputs.indexOf(a),d=r.datepickers;if(c<0||c>1||!Array.isArray(d))throw Error("Invalid rangepicker object.");d[c]=this,this.rangepicker=r,this.rangeSideIndex=c}this._options=i,Object.assign(n,YA(i,this)),n.shortcutKeys=XOe(i.shortcutKeys||{});const s=wz(e.value||e.dataset.date,n.dateDelimiter);delete e.dataset.date;const o=Qee(this,s);o&&o.length>0&&(this.dates=o),a&&(a.value=Jee(this.dates,n));const l=this.picker=new lxe(this),u=[e,"keydown",cxe.bind(null,this)];a?QO(this,[u,[a,"focus",dxe.bind(null,this)],[a,"mousedown",pxe.bind(null,this)],[a,"click",fxe.bind(null,this)],[a,"paste",mxe.bind(null,this)],[document,"mousedown",hxe.bind(null,this)],[window,"resize",l.place.bind(l)]]):(QO(this,[u]),this.show())}static formatDate(e,i,r){return tM(e,i,r&&fy[r]||fy.en)}static parseDate(e,i,r){return Lm(e,i,r&&fy[r]||fy.en)}static get locales(){return fy}get active(){return!!(this.picker&&this.picker.active)}get pickerElement(){return this.picker?this.picker.element:void 0}setOptions(e){const i=YA(e,this);Object.assign(this._options,e),Object.assign(this.config,i),this.picker.setOptions(i),EP(this,3)}show(){if(this.inputField){const{config:e,inputField:i}=this;if(i.disabled||i.readOnly&&!e.enableOnReadonly)return;!iM(i)&&!e.disableTouchKeyboard&&(this._showing=!0,i.focus(),delete this._showing)}this.picker.show()}hide(){this.inputField&&(this.picker.hide(),this.picker.update().changeView(this.config.startView).render())}toggle(){this.picker.active?this.inputField&&this.picker.hide():this.show()}destroy(){this.hide(),qOe(this),this.picker.detach();const e=this.element;return e.classList.remove("datepicker-input"),delete e.datepicker,this}getDate(e=void 0){const i=Lz(this,e);if(this.config.multidate)return this.dates.map(i);if(this.dates.length>0)return i(this.dates[0])}setDate(...e){const i=[...e],r={},n=$$(e);n&&typeof n=="object"&&!Array.isArray(n)&&!(n instanceof Date)&&Object.assign(r,i.pop());const a=Array.isArray(i[0])?i[0]:i;Fz(this,a,r)}update(e=void 0){if(!this.inputField)return;const i=Object.assign(e||{},{clear:!0,render:!0,viewDate:void 0}),r=wz(this.inputField.value,this.config.dateDelimiter);Fz(this,r,i)}getFocusedDate(e=void 0){return Lz(this,e)(this.picker.viewDate)}setFocusedDate(e,i=!1){const{config:r,picker:n,active:a,rangeSideIndex:s}=this,o=r.pickLevel,l=Lm(e,r.format,r.locale);l!==void 0&&(n.changeFocus(gp(l,o,s)),a&&i&&n.changeView(o),n.render())}refresh(e=void 0,i=!1){e&&typeof e!="string"&&(i=e,e=void 0);let r;e==="picker"?r=2:e==="input"?r=1:r=3,EP(this,r,!i)}enterEditMode(){const e=this.inputField;!e||e.readOnly||!this.picker.active||this.editMode||(this.editMode=!0,e.classList.add("in-edit"))}exitEditMode(e=void 0){if(!this.inputField||!this.editMode)return;const i=Object.assign({update:!1},e);delete this.editMode,this.inputField.classList.remove("in-edit"),i.update&&this.update(i)}}function Ixe(t,e,i,r,n){if(n){const a=e.target.value;n(a)?(r.innerHTML="",r.classList.remove("is-danger"),i.classList.remove("is-danger"),i.classList.add("is-success")):(r.innerHTML=t.error||"Invalid",i.classList.remove("is-success"),i.classList.add("is-danger"),r.classList.add("is-danger"))}}function vxe(t){const e=new Set(t.options.filter(m=>m.selected).map(m=>m.value)),i=document.createElement("div");i.style.cssText="position: relative; width: 100%;";const r=document.createElement("div");r.style.cssText=["display: flex","align-items: center","flex-wrap: wrap","gap: 4px","min-height: 2.5em","padding: 4px 8px","border: 1px solid var(--chc-input-border, #7a7a7a)","border-radius: 4px","background: var(--chc-input-bg, #fff)","cursor: pointer","box-sizing: border-box"].join("; ");const n=document.createElement("div");n.style.cssText="display: flex; flex-wrap: wrap; gap: 4px; flex: 1; min-width: 0;";const a=document.createElement("span");a.textContent="â¾",a.style.cssText="margin-left: auto; padding-left: 8px; user-select: none; color: var(--chc-text-secondary, #666);",r.appendChild(n),r.appendChild(a);const s=document.createElement("div");s.style.cssText=["display: none","position: absolute","top: 100%","left: 0","right: 0","z-index: 50","max-height: 220px","overflow-y: auto","border: 1px solid var(--chc-border-primary, #dbdbdb)","border-top: none","border-radius: 0 0 4px 4px","background: var(--chc-dropdown-bg, #fff)","box-shadow: 0 4px 8px rgba(0,0,0,0.1)"].join("; ");const o=new Map;for(const m of t.options){const h=document.createElement("label");h.style.cssText=["display: flex","align-items: center","gap: 8px","padding: 6px 10px","cursor: pointer","color: var(--chc-text-primary, #363636)"].join("; "),h.addEventListener("mouseenter",()=>{h.style.background="var(--chc-hover-bg, #f5f5f5)"}),h.addEventListener("mouseleave",()=>{h.style.background=""});const g=document.createElement("input");g.type="checkbox",g.value=m.value,g.checked=!!m.selected,m.disabled&&(g.disabled=!0),g.style.cssText="margin: 0; cursor: pointer;";const I=document.createElement("span");I.textContent=m.label,h.appendChild(g),h.appendChild(I),s.appendChild(h),o.set(m.value,g)}i.appendChild(r),i.appendChild(s);let l=!1;function u(){l=!l,s.style.display=l?"block":"none"}function c(){l=!1,s.style.display="none"}function d(){if(n.innerHTML="",e.size===0){const m=document.createElement("span");m.textContent="Selectâ¦",m.style.cssText="color: var(--chc-text-muted, #999); user-select: none;",n.appendChild(m);return}for(const m of e){const h=t.options.find(v=>v.value===m);if(!h)continue;const g=document.createElement("span");g.style.cssText=["display: inline-flex","align-items: center","gap: 4px","padding: 2px 6px","border-radius: 3px","background: var(--chc-status-info, blue)","color: var(--chc-text-inverse, #fff)","font-size: 0.85em","white-space: nowrap"].join("; "),g.textContent=h.label;const I=document.createElement("span");I.textContent="Ã",I.style.cssText="cursor: pointer; margin-left: 2px; font-weight: bold;",I.addEventListener("click",v=>{v.stopPropagation(),e.delete(m);const w=o.get(m);w&&(w.checked=!1),d(),p()}),g.appendChild(I),n.appendChild(g)}}function p(){if(po(t.onChange)){const m=new Event("change",{bubbles:!0});f.dispatchEvent(m),t.onChange(m,t)}}r.addEventListener("click",()=>u()),document.addEventListener("click",m=>{l&&!i.contains(m.target)&&c()});for(const[m,h]of o)h.addEventListener("change",()=>{h.checked?e.add(m):e.delete(m),d(),p()});d();const f=i;return Object.defineProperty(f,"selectedValues",{get:()=>[...e],enumerable:!0}),Object.defineProperty(f,"value",{get:()=>[...e].join(","),enumerable:!0}),{container:i,element:f}}const JA="none";function yxe(t,e){for(const i of e.options){if(i.hide)continue;const r=document.createElement("option");r.className="font-medium",i.value&&r.setAttribute("value",i.value),(i.selected||e.value===i.value)&&r.setAttribute("selected","true"),i.disabled&&r.setAttribute("disabled","true"),r.innerHTML=i.label,t.appendChild(r)}}function bxe(t){const e=document.createElement("div");if(e.className="field font-medium",t.class&&e.classList.add(t.class),t.width?e.style.cssText=`width: ${t.width}`:e.style.cssText="flex-grow: 1",t.label&&!t.checkbox){const s=document.createElement("label");s.style.cssText=t.labelStyle||"font-weight: bold; font-size: larger;",s.innerHTML=t.label,e.appendChild(s)}let i,r,n=[];const a=document.createElement("div");if(a.className="control font-medium",t.controlVisible===!1&&(a.style.display=JA),t.controlId&&(a.id=t.controlId),t.text){const s=document.createElement("div");t.id&&(s.id=t.id),s.className="content",s.innerHTML=t.text,a.appendChild(s)}else if(t.radio){const s=document.createElement("div");s.id=t.id,s.className="control";for(const o of t.options??[]){const l=document.createElement("label");l.className="radio";const u=document.createElement("input");o.field&&n.push({input:u,field:o.field}),o.id&&(u.id=o.id),u.name=t.id,u.type="radio",u.value=o.text,o.checked&&(u.checked=!0),po(t.onChange)&&u.addEventListener("change",d=>t.onChange(d,t)),l.appendChild(u),s.appendChild(l);const c=document.createElement("span");c.style.marginLeft=".25em",c.style.marginRight="1em",c.style.color="var(--chc-text-primary)",c.innerHTML=o.text,s.appendChild(c)}a.appendChild(s),i=s}else if(t.options&&t.multiple){const{container:s,element:o}=vxe(t);t.id&&(s.id=t.id),a.appendChild(s),i=o}else if(t.options){const s=document.createElement("div");s.className="select font-medium",s.style.cssText="width: 100%",t.zIndex&&(s.style.zIndex=t.zIndex);const o=document.createElement("select");if(t.dataPlaceholder&&o.setAttribute("data-placeholder",t.dataPlaceholder),t.dataType&&o.setAttribute("data-type",t.dataType),t.disabled&&(o.disabled=!0),t.id&&(s.id=t.id),o.style.cssText="width: 100%",yxe(o,t),s.appendChild(o),a.appendChild(s),t.help){const l=document.createElement("p");l.className="help font-medium is-info",l.innerHTML=t.help?.text,l.style.display=t.help?.visible?"":JA,a.appendChild(l)}i=o,po(t.onChange)&&o.addEventListener("change",l=>t.onChange(l,t))}else if(t.checkbox){const s=document.createElement("div");s.className="flexrow nowrap",s.style.display="inline-block";const o=document.createElement("input");po(t.onChange)&&o.addEventListener("change",c=>t.onChange(c,t)),i=o;const l=t.intent??"is-success";o.className=`is-checkradio ${l}`,o.type="checkbox",o.id=t.id,t.checked&&(o.checked=!0),s.appendChild(o);const u=document.createElement("label");u.setAttribute("for",t.id),t.color&&(u.style.color=t.color),u.innerHTML=t.label,s.appendChild(u),a.appendChild(s)}else{const s=document.createElement("input");if(s.className="input font-medium",t.class&&s.classList.add(t.class),s.setAttribute("type",t.type||"text"),s.setAttribute("autocomplete",t.autocomplete||"off"),s.setAttribute("placeholder",t.placeholder||""),t.disabled&&s.setAttribute("disabled","true"),t.id&&s.setAttribute("id",t.id),a.appendChild(s),t.iconLeft){a.classList.add("has-icons-left");const l=document.createElement("span");l.className="icon is-small is-left font-medium";const u=document.createElement("i");u.className=t.iconLeft,l.appendChild(u),a.appendChild(l)}if(t.type==="password"){a.classList.add("has-icons-right");const l=document.createElement("span");l.className="icon is-small is-right font-medium";const u=document.createElement("i");u.className=t.iconRight,l.appendChild(u),a.appendChild(l)}i=s;const o=document.createElement("p");if(o.className="help font-medium",a.appendChild(o),t.validator&&s.addEventListener("input",l=>Ixe(t,l,s,o,t.validator)),t.date){const l=t.maxNumberOfDates||1,u=!t.maxNumberOfDates||l===1;r=new gxe(s,{maxDate:t.maxDate,minDate:t.minDate,format:"yyyy-mm-dd",maxNumberOfDates:l,autohide:u})}else t.typeAhead&&FOe({...t.typeAhead,element:s});po(t.onKeyDown)&&s.addEventListener("keydown",l=>t.onKeyDown(l,t)),po(t.onChange)&&s.addEventListener("change",l=>t.onChange(l,t)),po(t.onInput)&&s.addEventListener("input",l=>t.onInput(l,t)),po(t.onKeyUp)&&s.addEventListener("keyup",l=>t.onKeyUp(l,t)),t.value!==void 0&&(s.value=t.value),t.selectOnFocus&&s.addEventListener("focus",()=>s.select())}return e.appendChild(a),t.visible===!1&&(e.style.display=JA),{field:e,inputElement:i,datepicker:r,subFields:n}}const QA="__BYE__",ZA="__QUALIFIER__";function wxe({matchUp:t,side:e,sideNumber:i,eventHandlers:r,composition:n,position:a,currentParticipant:s}){const o=n?.configuration,l=e?.drawPosition,u=()=>{const y=da(o?.participantProvider)?o.participantProvider():[],b=o?.persistInputFields;let S=y;b&&s&&(y.some(E=>E.participantId===s.participantId)||(S=[s,...y]));const U=S.map(E=>({label:E.participantName||E.participantId,value:E.participantId})),T=s?.participantId===QA,P=s?.participantId===ZA,D=[];return T||D.push({label:"â BYE â",value:QA}),o?.hasQualifying&&!P&&D.push({label:"â QUALIFIER â",value:ZA}),[...D,...U]},c=u(),d=y=>{if(!e)return;if(!y||y.trim()===""){da(r?.removeAssignment)&&r.removeAssignment({matchUp:t,side:e,sideNumber:i||1});return}if(y===QA){da(r?.assignBye)&&r.assignBye({matchUp:t,side:e,sideNumber:i||1});return}if(y===ZA){da(r?.assignQualifier)&&r.assignQualifier({matchUp:t,side:e,sideNumber:i||1});return}const b=(da(o?.participantProvider)?o.participantProvider():[]).find(S=>S.participantId===y);b&&da(r?.assignParticipant)&&r.assignParticipant({matchUp:t,side:e,sideNumber:i||1,participant:b})};let p=!1;const f=()=>{if(p){p=!1;return}const y=Array.from(document.querySelectorAll(".participant-assignment-input input")),b=y.findIndex(S=>S.id===h);if(b!==-1&&b<y.length-1){const S=y[b+1];setTimeout(()=>{S.focus()},100)}},m=a?`-p${a}`:"",h=`assign-${t.matchUpId}-side${i}${m}`,g=s?.participantId,{field:I}=bxe({typeAhead:{list:c,callback:d,onSelectComplete:f,listProvider:u,currentValue:g},placeholder:a?`Partner ${a}`:"Type participant name...",field:h,id:h,class:"participant-assignment-input"});l&&(I.dataset.drawPosition=l.toString());const v=I.querySelector("input");v&&v.addEventListener("keydown",y=>{y.key==="Tab"&&(p=!0,setTimeout(()=>{p=!1},500))}),I.style.width="100%",I.style.margin="0";const w=o?.assignmentInputFontSize;return w&&(I.style.fontSize=w),setTimeout(()=>{const y=I.querySelector("input");if(y){let b=y.parentElement,S=0;for(;b&&S<15;){const U=window.getComputedStyle(b);(U.overflow!=="visible"||U.overflowX!=="visible"||U.overflowY!=="visible")&&(b.style.setProperty("overflow","visible","important"),b.style.setProperty("overflow-x","visible","important"),b.style.setProperty("overflow-y","visible","important")),b=b.parentElement,S++}}},100),I}const Sxe=()=>"chc-seed";function Uxe({className:t,composition:e,side:i}){const r=i?.seedValue==="~"?"":i?.seedValue!==void 0&&i.seedValue||i?.seedNumber;if(!r)return"";const n=e?.configuration||{},{bracketedSeeds:a}=n,s=typeof a=="boolean"&&["(",")"]||a==="square"&&["[","]"]||["",""],o=`${s[0]}${r}${s[1]}`,l=n.seedingElement==="sup"?"sup":"span",u=document.createElement(l);return u.className=t||"",u.innerHTML=o,u}const Txe=t=>hn("chc-scale",t?.color&&`chc-scale--${t.color}`);function Dxe({individualParticipant:t,composition:e,className:i,matchUp:r,spacer:n}){const a=e?.configuration,s=a?.scaleAttributes?.eventType||r?.matchUpType||"SINGLES",o=t?.rankings,l=t?.ratings,u=a?.scaleAttributes,c=u?.scaleType,d=u?.scaleName,p=u?.accessor,f=c==="RATING"?l:o,m=f?.SINGLES?.find(T=>T?.scaleName===d)?.scaleValue,h=f?.DOUBLES?.find(T=>T?.scaleName===d)?.scaleValue,g=m&&p?m[p]:m||"",I=h&&p?h[p]:h||"",v=s==="SINGLES"?g:I,w=a?.scaleAttributes?.fallback,y=!n&&(v||w&&(g||I)),b=document.createElement("span"),S=a?.scaleAttributes?.scaleColor,U=S==="green"||S==="red"?S:void 0;return y&&(b.className=hn(i,Txe(U?{color:U}:{}))),b.innerHTML=y||"",b}var Pxe=Object.defineProperty,dt=(t,e)=>{for(var i in e)Pxe(t,i,{get:e[i],enumerable:!0})};function rM(){return"2.4.6-beta.2"}var H$={};dt(H$,{competitionGovernor:()=>Zee,drawsGovernor:()=>ane,entriesGovernor:()=>Ole,eventGovernor:()=>Vle,generationGovernor:()=>nue,matchUpFormatGovernor:()=>mue,matchUpGovernor:()=>hue,mocksGovernor:()=>rG,participantGovernor:()=>uce,policyGovernor:()=>lle,publishingGovernor:()=>Ace,queryGovernor:()=>fle,rankingGovernor:()=>gG,reportGovernor:()=>zce,scheduleGovernor:()=>qce,scoreGovernor:()=>RV,temporalGovernor:()=>Cde,tieFormatGovernor:()=>ode,tournamentGovernor:()=>gde,venueGovernor:()=>npe});var Zee={};dt(Zee,{getLinkedTournamentIds:()=>fU,getTournamentIds:()=>dU,linkTournaments:()=>tne,mutate:()=>ete,query:()=>nne,unlinkTournament:()=>rne,unlinkTournaments:()=>ine});var ete={};dt(ete,{linkTournaments:()=>tne,unlinkTournament:()=>rne,unlinkTournaments:()=>ine});var dm="SINGLES",zt="SINGLES",Lp="DOUBLES",Bt="DOUBLES",La="TEAM",ei="TEAM",Exe={SINGLES_MATCHUP:dm,SINGLES:zt,DOUBLES_MATCHUP:Lp,DOUBLES:Bt,TEAM_MATCHUP:La,TEAM:ei},tte={[zt]:[zt,"S"],[Bt]:[Bt,"D"],[ei]:[ei,"T"],S:[zt,"S"],D:[Bt,"D"],T:[ei,"T"]};function nr(t,e){return(t??0)-(e??0)}function Ke(t){return typeof t=="number"?parseInt(t.toString()):typeof t=="string"?parseInt(t):0}function fa(t){return typeof t=="function"}function ni(t){return typeof t=="string"}function wt(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)}function Rxe(t,e){if(!wt(t)||!wt(e))return!1;let i=Object.keys(t),r=Object.keys(e);if(i.length!==r.length)return!1;for(let n of i)if(t[n]!==e[n])return!1;return!0}function ite(t,e){return Array.isArray(t)?Object.assign({},...(t??[]).filter(wt).map(i=>i[e]&&{[i[e]]:i}).filter(Boolean)):{}}var Cxe=t=>e=>Object.keys(t).every(i=>e[i]===t[i]);function ZO(t,e){if(t===void 0)return null;if(!wt(t)||t===null)return t;let i=Object.keys(t),r=n=>n===void 0?null:n;return Object.assign({},...i.map(n=>Array.isArray(t[n])?{[n]:e?t[n]:t[n].map(a=>ZO(a))}:{[n]:e?r(t[n]):ZO(t[n])}))}function ex(t){return Array.isArray(t)?t.length+t.map(ex).reduce((e,i)=>e+i,0):wt(t)&&t!==null?Object.keys(t).length+Object.keys(t).map(e=>ex(t[e])).reduce((e,i)=>e+i,0):0}function Mxe(t){if(t===null||typeof t!="object")return;let e=JSON.stringify(t),i=ex(t),r=e.split("").reduce((n,a)=>n+a.charCodeAt(0),0);return[e.length,i,r].map(n=>n.toString(36)).join("")}function Ro(t){return Number.isNaN(Number(t))?!1:t>0&&(t&t-1)===0}function _z(t){if(!t.length)return;let e=[...t].sort(nr),i=Math.floor(e.length/2);return e.length%2?e[i]:(e[i-1]+e[i])/2}function Nxe(t){if(t===1||Number.isNaN(Number(t))||!Ro(t))return!1;let e=t,i=1;for(;e!==2;)i+=1,e=e/2;return i}function W$(t){return Number.isNaN(Number(t))?0:t%2&&t+1||t}function z$(t){return Math.pow(2,Math.round(Math.log(t)/Math.log(2)))}function Ai(t){return!Number.isNaN(Number.parseFloat(t))}function rte(t){let e=Ke(t);if(!Number.isNaN(e))return e===0?!1:(e&-e)===1}function Ev(t){if(Number.isNaN(Number(t)))return!1;for(;!Ro(t);)t++;return t}function is(t,e){return t=Math.ceil(t),e=Math.floor(e),Math.floor(Math.random()*(e-t+1))+t}function lt(t){return ni(t)&&!t.trim().length?!1:Number.isSafeInteger(typeof t=="string"?+t:t)}function Axe(t=1,e=3,i=!0){let r=0;for(let n=0;n<e;n++)r+=Math.random()*(t/e);return i&&t>1?Math.round(r):r}function kxe(t,e){e||(e=1);let i=1/e;return Math.round(t*i)/i}function nte(t,e,i,r,n=2){let a=1-Math.random(),s=1-Math.random(),o=Math.sqrt(-2*Math.log(a))*Math.cos(2*Math.PI*s);return o=o/10+.5,o>1||o<0?o=nte(t,e,i):(o=Math.pow(o,i),o*=e-t,o+=t),r&&(o=kxe(o,r)),Number.parseFloat(o.toFixed(n))}function RP(t,e=2){return Number.parseFloat(Number(Math.round(t*1e3)/1e3).toFixed(e))}function nt(t){return Array.isArray(t)?t?.filter((e,i,r)=>r.lastIndexOf(e)===i):[]}function Oxe(t){return Array.isArray(t)?t?.map(e=>e===null?void 0:e):t}function Cn(t){return Array.isArray(t)?t.map(e=>[Math.random(),e]).sort((e,i)=>e[0]-i[0]).map(e=>e[1]):[]}function gI(t){return lt(t)?t:1/0}function Sa(t){return Array.isArray(t)?t.reduce((e,i)=>(e[i]||(e[i]=0),e[i]++,e),{}):{}}function xxe(t){return ate(Sa(t))}function ate(t){return Object.keys(t).reduce((e,i)=>{let r=t[i];return e[r]?e[r].push(i):e[r]=[i],e},{})}function Fxe(t,e,i){return i.indexOf(t)===e}function ste(t){return t.filter(Fxe)}function ha(t){return Array.isArray(t)&&t.length?t.splice(Math.floor(Math.random()*t.length),1)[0]:void 0}function Ns(t){let e=Math.floor(Math.random()*t.length);return t[e]}function Ce(t,e){return Array.from({length:e-t},(i,r)=>r+t)}function Xo(t,e){return e.reduce((i,r,n)=>(r===t&&i.push(n),i),[])}function Li(t,e){return!Array.isArray(t)||!Array.isArray(e)?[]:t.filter(i=>e.indexOf(i)!==-1).filter((i,r,n)=>n.indexOf(i)===r)}function $z(t,e){return!Array.isArray(t)||!Array.isArray(e)?[]:t.filter(i=>!e.includes(i))}function xn(t,e){return!Array.isArray(t)||!Array.isArray(e)?!1:t.some(i=>e.includes(i))}function Lxe(t,e){return Array.isArray(e)&&e.reduce((i,r)=>(i[r]=1+i[r]||1,i),{})[t]||0}function _xe(t,e,i,r){return Array.isArray(t)?[].concat(...t.slice(0,e),...t.slice(e,e+i).sort(r),...t.slice(e+i,t.length)):[]}function wr(t,e){return Array.isArray(t)?t.reduce((i,r,n)=>{let a=Math.floor(n/e);return i[a]=[].concat(i[a]||[],r),i},[]):[]}function ote(t,[e,...i]){return t.length?[t.slice(0,e),...ote(t.slice(e),[...i,e])]:[]}function $xe(t){return t.reduce((e,i)=>{let r=e[e.length-1];return(!r||r[r.length-1]!==i-1)&&e.push([]),e[e.length-1].push(i),e},[])}function lte(t){return Array.isArray(t)?t.reduce((e,i)=>!isNaN(parseInt(i))&&e,!0):!1}function ute(t){return Array.isArray(t)?t.reduce((e,i)=>isNaN(parseInt(i))&&e,!0):!1}function tx(t,e,i){return Array.isArray(t)?t.reduce((r,n,a)=>{let s=i?!!(Math.floor(a/e)%2):!1,o=a%e,l=s?e-1-o:o;return r[l]||(r[l]=[]),r[l].push(n),r},[]):[]}function Bxe(t,e=1){if(!Array.isArray(t)||!t.every(lt))return[];let i=Math.min(...t,e),r=Math.max(...t);return Ce(i,r+1).filter(n=>!t.includes(n))}function pm(t,e){return!Array.isArray(t)||!ni(e)?!1:Li(t,tte[e]).length}var W={success:!0},cte="error",Vxe={SUCCESS:W,ERROR:cte};function dte({collectionValueProfiles:t,matchUpCount:e}){let i=[];if(!Array.isArray(t))return i.push(`collectionValueProfiles is not an array: ${t}`),{errors:i};if(t.length&&t.length!==e)return i.push("collectionValueProfiles do not align with matchUpsCount"),{errors:i};for(let n of t){if(typeof n!="object")return i.push(`valueProfile is not type object: ${n}`),{errors:i};let{matchUpValue:a,collectionPosition:s}=n;if(typeof a!="number"||typeof s!="number"||s>e||s<1)return i.push("Invalid value profile: value and collectionPosition must be numeric. collectionPosition cannot be greater than matchUpCount"),{errors:i}}let r=t.map(n=>n.collectionPosition);return r.length!==nt(r).length?(i.push("collectionPositions are not unique"),{errors:i}):{...W}}var jxe={};dt(jxe,{addNotice:()=>st,callListener:()=>dx,createInstanceState:()=>D1e,cycleMutationStatus:()=>bB,deepCopyEnabled:()=>yB,deleteNotice:()=>wB,deleteNotices:()=>iU,disableNotifications:()=>Cie,enableNotifications:()=>gM,getDevContext:()=>oa,getMethods:()=>Aie,getNotices:()=>kie,getProvider:()=>px,getTopics:()=>bs,getTournamentId:()=>Ah,getTournamentRecord:()=>SB,getTournamentRecords:()=>kh,globalLog:()=>Fie,handleCaughtError:()=>yM,hasTopic:()=>IM,removeTournamentRecord:()=>xie,setDeepCopy:()=>Bb,setDevContext:()=>$b,setGlobalLog:()=>Rie,setGlobalMethods:()=>Mie,setGlobalSubscriptions:()=>E1e,setMethods:()=>Nie,setStateMethods:()=>Lie,setStateProvider:()=>T1e,setSubscriptions:()=>R1e,setTournamentId:()=>Vb,setTournamentRecord:()=>Oie,setTournamentRecords:()=>vM,timeKeeper:()=>P1e});var ix={message:"Chronological error; time violation.",code:"ANACHRONISM"},Lb={message:"Duplicate entry",code:"DUPLICATE_ENTRY"},pte={message:"Cannot remove main structure",code:"ERR_CANNOT_REMOVE_MAIN_STRUCTURE"},rx={message:"records must be an object with tournamentId keys",code:"ERR_INVALID_TOURNAMENTS"},Mi={message:"Missing tournamentRecords",code:"ERR_MISSING_TOURNAMENTS"},ve={message:"Missing tournamentRecord",code:"ERR_MISSING_TOURNAMENT"},YS={message:"Invalid tournamentRecord",code:"ERR_INVALID_TOURNAMENT"},II={message:"Missing tournamentId",code:"ERR_MISSING_TOURNAMENT_ID"},fm={message:"Invalid drawDefinition",code:"ERR_INVALID_DRAWDEF"},$e={message:"Missing drawDefinition",code:"ERR_MISSING_DRAWDEF"},fte={message:"Existing drawDefinition(s)",code:"ERR_EXISTING_DRAWDEFS"},_a={message:"drawDefinition not found",code:"ERR_NOT_FOUND_DRAWDEF"},ff={message:"Invalid structure",code:"ERR_INVALID_STRUCTURE"},q$={message:"Incomplete source structure",code:"ERR_INCOMPLETE_STRUCTURE"},Y$={message:"Invalid drawPosition for seedAssignment",code:"ERR_INVALID_SEEDING_POSITION"},vI={message:"drawPosition already assigned",code:"ERR_EXISTING_POSITION_ASSIGNMENT"},mte={message:"Schedule not cleared",code:"ERR_UNCHANGED_SCHEDULE_NOT_CLEARED"},hte={message:"Schedule conflict: court slot already occupied",code:"ERR_SCHEDULE_CONFLICT_DOUBLE_BOOKING"},gte={message:"drawPosition not cleared",code:"ERR_FAILURE_POSITION_NOT_CLEARED"},Gxe={message:"drawPosition not found",code:"ERR_NOT_FOUND_DRAW_POSITION"},K$={message:"Unrecognized drawType",code:"ERR_UNRECOGNIZED_DRAW_TYPE"},KS={message:"Missing drawPositions",code:"ERR_MISSING_DRAW_POSITIONS"},XS={message:"drawPosition is active",code:"ERR_ACTIVE_DRAW_POSITION"},Hxe={message:"drawPosition is occupied",code:"ERR_OCCUPIED_DRAW_POSITION"},Rh={message:"Invlid drawPosition",code:"ERR_INVALID_DRAW_POSITION"},Rv={message:"Missing drawPosition",code:"ERR_MISSING_DRAW_POSITION"},X$={message:"Invalid drawType",code:"ERR_INVALID_DRAW_TYPE"},nM={message:"Invalid drawSize",code:"ERR_INVALID_DRAW_SIZE"},Ite={message:"Cannot set drawSize to be less than existing entries",code:"ERR_INVALID_DRAW_SIZE_MISMATCH"},JS={message:"Missing drawSize",code:"ERR_MISSING_DRAW_SIZE"},xo={message:"Missing drawId",code:"ERR_MISSING_DRAW_ID"},vte={message:"drawId exists",code:"ERR_EXISTING_DRAW_ID"},yte={message:"participantId cannot be assigned to multiple seedNumbers",code:"INVALID_PARTICIPANT_SEEDING"},bte={message:"seedsCount greater than drawSize",code:"ERR_INVALID_SEED_COUNT"},wte={message:"Missing seedCountThresholds",code:"ERR_MISSING_SEED_COUNT_THRESHOLD"},Ste={message:"Invalid action",code:"ERR_INVALID_ACTION"},nx={message:"Invalid assignment",code:"ERR_INVALID_ASSIGNMENT"},Ute={message:"Missing seedAssignments",code:"ERR_MISSING_SEED_ASSIGNMENTS"},Tte={message:"Invalid seedNumber",code:"ERR_INVALID_SEED_NUMBER"},Dte={message:"Invalid seedPosition",code:"ERR_INVALID_SEED_POSITION"},J$={message:"Missing targetLink",code:"ERR_MISSING_LINK_TARGET"},Pte={message:"Existing round",code:"ERR_EXISTING_ROUND"},Wxe={message:"Missing roundNumber",code:"ERR_MISSING_ROUND_NUMBER"},qa={message:"Missing structureId",code:"ERR_MISSING_STRUCTURE_ID"},vi={message:"structure not found",code:"ERR_NOT_FOUND_STRUCTURE"},Q$={message:"Missing structures",code:"ERR_MISSING_STRUCTURES"},mf={message:"Missing structure",code:"ERR_MISSING_STRUCTURE"},Z$={message:"Missing MAIN structure",code:"ERR_MISSING_MAIN_STRUCTURE"},Ete={message:"drawDefinition contains unlinked structures",code:"ERR_MISSING_STRUCTURE_LINKS"},cu={message:"Invalid eventType",code:"ERR_INVALID_EVENT_TYPE"},ui={message:"Missing event / eventId",code:"ERR_MISSING_EVENT_ID"},ps={message:"Event not found",code:"ERR_NOT_FOUND_EVENT"},Rte={message:"Event exists",code:"ERR_EXISTING_EVENT"},Cte={message:"Missing entries",code:"ERR_MISSING_ENTRIES"},Mte={message:"Invalid entries",code:"ERR_INVALID_ENTRIES"},eB={message:"Missing assignments",code:"ERR_MISSING_ASSIGNMENTS"},Nte={message:"Missing stage",code:"ERR_MISSING_STAGE"},hf={message:"Invalid stage",code:"ERR_INVALID_STAGE"},Ate={message:"stageSequence limit",code:"ERR_LIMIT_STAGE_SEQUENCE"},kte={message:"Missing positionAssignments",code:"ERR_MISSING_POSITION_ASSIGNMENTS"},Ote={message:"Cannot Assign BYE status if no assignment: { bye: true }",code:"ERR_UNCHANGED_CANNOT_ASSIGN_BYE"},ax={message:"Unrecognized matchUpStatus",code:"ERR_UNRECOGNIZED_MATCHUP_STATUS"},QS={message:"Unrecognized matchUpFormat",code:"ERR_UNRECOGNIZED_MATCHUP_FORMAT"},lD={message:"Incompatible matchUpStatus",code:"ERR_INCOMPATIBLE_MATCHUP_STATUS"},zxe={message:"Propagated exits downstream",code:"ERR_PROPAGATED_EXITS_DOWNSTREAM"},Cv={message:"Invalid matchUpStatus",code:"ERR_INVALID_MATCHUP_STATUS"},ql={message:"Invalid tieFormat",code:"ERR_INVALID_TIE_FORMAT"},xte={message:"Invalid matchUpFormat",code:"ERR_INVALID_MATCHUP_FORMAT"},Fte={message:"Missing matchUpFormat",code:"ERR_MISSING_MATCHUP_FORMAT"},Lte={message:"Missing collectionDefinition",code:"ERR_MISSING_COLLECTION_DEFINITION"},Mv={message:"Missing tieFormat",code:"ERR_MISSING_TIE_FORMAT"},Tn={message:"Missing matchUpId",code:"ERR_MISSING_MATCHUP_ID"},Ch={message:"Missing matchUpIds",code:"ERR_MISSING_MATCHUP_IDS"},dn={message:"matchUp not found",code:"ERR_NOT_FOUND_MATCHUP"},Nu={message:"Missing matchUps",code:"ERR_MISSING_MATCHUPS"},aa={message:"Missing matchUp",code:"ERR_MISSING_MATCHUP"},sa={message:"Invalid matchUp",code:"ERR_INVALID_MATCHUP"},tB={message:"Missing policyType",code:"ERR_MISSING_POLICY_TYPE"},aM={message:"Missing policyDefinitions",code:"ERR_MISSING_POLICY_DEFINITIONS"},qxe={message:"Missing seeding policy",code:"ERR_MISSING_POLICY_SEEDING"},_te={message:"Missing avoidance policy",code:"ERR_MISSING_POLICY_AVOIDANCE"},iB={message:"Missing policy attributes",code:"ERR_MISSING_POLICY_ATTRIBUTES"},$te={message:"Invalid policyDefinitions",code:"ERR_INVALID_POLICY_DEFINITIONS"},rB={message:"existing policyType",code:"ERR_EXISTING_POLICY_TYPE"},Yxe={message:"Policy not attached",code:"ERR_FAILURE_POLICY_NOT_ATTACHED"},ZS={message:"Policy not found",code:"ERR_NOT_FOUND_POLICY"},Kxe={message:"Missing scoring policy / matchUpFormats",code:"ERR_MISSING_POLICY_SCORING_MATCHUP_FORMATS"},Bte={message:"Invalid sideNumber",code:"ERR_INVALID_SIDE_NUMBER"},Xxe={message:"Invalid setNumber",code:"ERR_INVALID_SET_NUMBER"},sM={message:"Missing setObject",code:"ERR_MISSING_SET_ATTRIBUTE"},Jxe={message:"Missing setNumber",code:"ERR_MISSING_SET_NUMBER"},Qxe={message:"Missing sideNumber",code:"ERR_MISSING_SIDE_NUMBER"},Mh={message:"Missing courtId",code:"ERR_MISSING_COURT_ID"},Je={message:"Missing value",code:"ERR_MISSING_VALUE"},Vte={message:"Missing birthdate",code:"ERR_MISSING_BIRTH_DATE"},jte={message:"Missing date",code:"ERR_MISSING_DATE"},Gte={message:"No valid dates",code:"ERR_NO_VALID_DATES"},CP={message:"Invalid bookings",code:"ERR_INVALID_BOOKINGS"},uD={message:"Invalid dateAvailability",code:"ERR_INVALID_DATE_AVAILABILITY"},Hte={message:"Missing dateAvailability",code:"ERR_MISSING_DATE_AVAILABILITY"},or={message:"Invalid Date",code:"ERR_INVALID_DATE"},Es={message:"Invalid time",code:"ERR_INVALID_TIME"},Wte={message:"Invalid tournament dates",code:"ERR_INVALID_DATES_TOURNAMENT"},Zxe={message:"Missing date range",info:"Event or tournament must have start and end dates",code:"ERR_MISSING_DATE_RANGE"},oM={message:"Invalid Time Zone",code:"ERR_INVALID_TIME_ZONE"},Ng={message:"Invalid embargo: must be an ISO 8601 datetime with timezone (Z or Â±HH:MM offset)",code:"ERR_INVALID_EMBARGO"},sx={message:"Invalid game scores",code:"ERR_INVALID_SCORES_GAME"},zte={message:"Invalid score",code:"ERR_INVALID_SCORE"},lM={message:"Invalid winningSide",code:"ERR_INVALID_WINNING_SIDE"},e1e={message:"No participants generated",code:"ERR_NO_PARTICIPANTS_GENERATED"},nB={message:"Cannot modify tieFormat",code:"ERR_UNCHANGED_CANNOT_MODIFY_TIEFORMAT"},qte={message:"Cannot modify participantType",code:"ERR_UNCHANGED_CANNOT_MODIFY_PARTICIPANT_TYPE"},uM={message:"Cannot remove participants",code:"ERR_UNCHANGED_CANNOT_REMOVE_PARTICIPANTS"},Yte={message:"Participant category mismatch",code:"ERR_CATEGORY_MISMATCH"},cM={message:"Cannot change winningSide",code:"ERR_UNCHANGED_CANNOT_CHANGE_WINNING_SIDE"},_p={message:"Invalid participant",code:"ERR_INVALID_PARTICIPANT"},Co={message:"Invalid participantId",code:"ERR_INVALID_PARTICIPANT_ID"},Ia={message:"Invalid participantIds",code:"ERR_INVALID_PARTICIPANT_IDS"},Kte={message:"Invalid participantRole",code:"ERR_INVALID_PARTICIPANT_ROLE"},Mo={message:"Invalid participantType",code:"ERR_INVALID_PARTICIPANT_TYPE"},Xte={message:"Missing participantRole",code:"ERR_MISSING_PARTICIPANT_ROLE"},Nh={message:"Missing participant",code:"ERR_MISSING_PARTICIPANT"},eU={message:"Missing participants",code:"ERR_MISSING_PARTICIPANTS"},dr={message:"Missing participantId",code:"ERR_MISSING_PARTICIPANT_ID"},Jte={message:"Missing qualified participants",code:"ERR_MISSING_QUALIFIED_PARTICIPANTS"},ji={message:"Participant Not Found",code:"ERR_NOT_FOUND_PARTICIPANT"},Qte={message:"participantId exists",code:"ERR_EXISTING_PARTICIPANT_ID"},t1e={message:"participant pair exists",code:"ERR_EXISTING_PARTICIPANT_PAIR"},Zte={message:"No participant removed",code:"ERR_UNCHANGED_NO_PARTICIPANT_REMOVED"},Wd={message:"Missing participantIds",code:"ERR_MISSING_PARTICIPANT_IDS"},eie={message:"Missing participantsCount",code:"ERR_MISSING_PARTICIPANT_COUNT"},tie={message:"Participant not checked in",code:"ERR_UNCHANGED_PARTICIPANT_NOT_CHECKED_IN"},iie={message:"Missing person details",code:"ERR_MISSING_PERSON_DETAILS"},Nv={message:"Existing participant drawPosition assignment",code:"ERR_EXISTING_PARTICIPANT_DRAW_POSITION_ASSIGNMENT"},dM={message:"Existing participant",code:"ERR_EXISTING_PARTICIPANT"},aB={message:"participantsCount exceeds drawSize",code:"ERR_INVALID_PARTICIPANT_COUNT"},ox={message:"Invalid entry status",code:"ERR_INVALID_ENTRY_STATUS"},rie={message:"Participant Entry Not Found",code:"ERR_NOT_FOUND_PARTICIPANT_ENTRY"},i1e={message:"Participant not entered in stage",code:"ERR_UNCHANGED_PARTICIPANT_NOT_ENTERED"},r1e={message:"Participant not found in stageSequence",code:"ERR_NOT_FOUND_PARTICIPANT_IN_STAGE"},nie={message:"entryStatus not allowed in stage",code:"ERR_INVALID_ENTRY_STATUS_IN_STAGE"},aie={message:"entryStatus not allowed for event",code:"ERR_INVALID_ENTRY_STATUS_IN_EVENT"},lx={message:"No stage space available for entryStatus",code:"ERR_UNCHANGED_NO_AVAILABLE_STAGE_SPACE"},sB={message:"Insufficient drawPositions to accommodate qualifiers",code:"ERR_UNCHANGED_NO_DRAW_POSITIONS_FOR_QUALIFIERS"},oB={message:"Insufficient drawPositions to accommodate entries",code:"ERR_INSUFFICIENT_DRAW_POSITIONS"},sie={message:"Missing penaltyType",code:"ERR_MISSING_PENALTY_TYPE"},lB={message:"Missing penaltyId",code:"ERR_MISSING_PENALTY_ID"},yI={message:"Penalty not found",code:"ERR_NOT_FOUND_PENALTY"},oie={message:"Missing courtsCount/courtNames",code:"ERR_MISSING_COURTS_INFO"},Ic={message:"Court not found",code:"ERR_NOT_FOUND_COURT"},lie={message:"Court exists",code:"ERR_EXISTING_COURT"},ux={message:"Booking not found",code:"ERR_NOT_FOUND_BOOKING"},uie={message:"Existing matchUps conflict with booking",code:"ERR_EXISTING_MATCHUPS"},cie={message:"Venue exists",code:"ERR_EXISTING_VENUE"},gf={message:"Venue not found",code:"ERR_NOT_FOUND_VENUE"},zd={message:"Missing venueId",code:"ERR_MISSING_VENUE_ID"},die={message:"Invalid endTime",code:"ERR_INVALID_END_TIME"},uB={message:"Existing endTime",code:"ERR_EXISTING_END_TIME"},pie={message:"Invalid stopTime",code:"ERR_INVALID_STOP_TIME"},fie={message:"Invalid startTime",code:"ERR_INVALID_START_TIME"},n1e={message:"Invalid resumeTime",code:"ERR_INVALID_RESUME_TIME"},cB={message:"Invalid timeItem",code:"ERR_INVALID_TIME_ITEMS"},mie={message:"Missing async state provider",code:"ERR_MISSING_ASYNC_STATE_PROVIDER"},dB={message:"Missing timeItem",code:"ERR_MISSING_TIME_ITEM"},pB={message:"Missing timeItems",code:"ERR_MISSING_TIME_ITEMS"},pM={message:"Missing context",code:"ERR_MISSING_CONTEXT"},hie={message:"Missing schedule",code:"ERR_MISSING_SCHEDULE"},_m={message:"Invalid scaleItem",code:"ERR_INVALID_SCALE_ITEM"},gie={message:"Modifications failed",code:"ERR_FAILURE_MODIFICATIONS"},Av={message:"No modifications applied",code:"ERR_UNCHANGED_NO_MODIFICATIONS_APPLIED"},Iie={message:"Unable to assign court",code:"ERR_UNCHANGED_COURT_NOT_ASSIGNED"},fM={message:"No Candidates",code:"ERR_UNCHANGED_NO_CANDIDATES"},vie={message:"Invalid configuration",code:"ERR_INVALID_CONFIG"},yie={message:"Invalid collectionDefinition",code:"ERR_INVALID_COLLECTION_DEFINITION"},$c={message:"Invalid object",code:"ERR_INVALID_OBJECT"},Hy={message:"Invalid gender",code:"ERR_INVALID_GENDER"},_b={message:"Invalid category",code:"ERR_INVALID_CATEGORY"},re={message:"Invalid values",code:"ERR_INVALID_VALUES"},bie={message:"Duplicate value",code:"ERR_DUPLICATE_VALUE"},fB={message:"Team not found",code:"ERR_NOT_FOUND_TEAM"},wie={message:"No valid actions",code:"ERR_NO_VALID_ACTIONS"},mM={message:"No valid attributes",code:"ERR_NO_VALID_ATTRIBUTES"},mB={message:"Value unchanged",code:"ABORT_UNCHANGED"},Br={message:"Not found",code:"ERR_NOT_FOUND"},hB={message:"Not implemented",code:"ERR_NOT_IMPLEMENTED"},Sie={message:"Existing flight",code:"ERR_EXISTING_FLIGHT"},gB={message:"Existing flight profile",code:"ERR_EXISTING_FLIGHT_PROFILE"},Uie={message:"Existing outcome",code:"ERR_EXISTING_OUTCOME"},Tie={message:"Existing matchUpId",code:"ERR_EXISTING_MATCHUP_ID"},cx={message:"Existing stage",code:"ERR_EXISTING_STAGE"},IB={message:"Existing structure",code:"ERR_EXISTING_STRUCTURE"},hM={message:"Method not found",code:"ERR_NOT_FOUND_METHOD"},Die={message:"Scheduled matchUps",code:"ERR_SCHEDULED_MATCHUPS"},tU={message:"Scores present",code:"ERR_SCORES_PRESENT"},a1e={ANACHRONISM:ix,BOOKING_NOT_FOUND:ux,CANNOT_CHANGE_WINNING_SIDE:cM,CANNOT_MODIFY_TIEFORMAT:nB,CANNOT_MODIFY_PARTICIPANT_TYPE:qte,CANNOT_REMOVE_MAIN_STRUCTURE:pte,CANNOT_REMOVE_PARTICIPANTS:uM,CATEGORY_MISMATCH:Yte,COURT_EXISTS:lie,COURT_NOT_FOUND:Ic,EXISTING_MATCHUPS:uie,DRAW_DEFINITION_NOT_FOUND:_a,DRAW_ID_EXISTS:vte,DRAW_POSITION_ACTIVE:XS,DRAW_POSITION_ASSIGNED:vI,DRAW_POSITION_NOT_CLEARED:gte,DRAW_POSITION_NOT_FOUND:Gxe,DRAW_SIZE_MISMATCH:Ite,DUPLICATE_ENTRY:Lb,DUPLICATE_VALUE:bie,ENTRY_STATUS_NOT_ALLOWED_FOR_EVENT:aie,ENTRY_STATUS_NOT_ALLOWED_IN_STAGE:nie,EVENT_EXISTS:Rte,EVENT_NOT_FOUND:ps,EXISTING_DRAW_DEFINITIONS:fte,EXISTING_END_TIME:uB,EXISTING_FLIGHT:Sie,EXISTING_MATCHUP_ID:Tie,EXISTING_OUTCOME:Uie,EXISTING_PARTICIPANT_DRAW_POSITION_ASSIGNMENT:Nv,EXISTING_PARTICIPANT:dM,EXISTING_POLICY_TYPE:rB,EXISTING_PROFILE:gB,EXISTING_ROUND:Pte,EXISTING_STAGE:cx,EXISTING_STRUCTURE:IB,INCOMPATIBLE_MATCHUP_STATUS:lD,INCOMPLETE_SOURCE_STRUCTURE:q$,INSUFFICIENT_DRAW_POSITIONS:oB,INVALID_ACTION:Ste,INVALID_ASSIGNMENT:nx,INVALID_BOOKINGS:CP,INVALID_CATEGORY:_b,INVALID_COLLECTION_DEFINITION:yie,INVALID_CONFIGURATION:vie,INVALID_DATE_AVAILABILITY:uD,INVALID_DATE:or,INVALID_DRAW_DEFINITION:fm,INVALID_DRAW_POSITION_FOR_SEEDING:Y$,INVALID_DRAW_POSITION:Rh,INVALID_DRAW_SIZE:nM,INVALID_END_TIME:die,INVALID_ENTRIES:Mte,INVALID_EVENT_TYPE:cu,INVALID_GAME_SCORES:sx,INVALID_GENDER:Hy,INVALID_MATCHUP_FORMAT:xte,INVALID_MATCHUP_STATUS:Cv,INVALID_MATCHUP_STATUS_BYE:Ote,INVALID_MATCHUP:sa,INVALID_OBJECT:$c,INVALID_PARTICIPANT_ID:Co,INVALID_PARTICIPANT_IDS:Ia,INVALID_PARTICIPANT_ROLE:Kte,INVALID_PARTICIPANT_SEEDING:yte,INVALID_PARTICIPANT_TYPE:Mo,INVALID_PARTICIPANT:_p,INVALID_POLICY_DEFINITION:$te,INVALID_RECORDS:rx,INVALID_SCALE_ITEM:_m,INVALID_SEED_NUMBER:Tte,INVALID_SEED_POSITION:Dte,INVALID_SET_NUMBER:Xxe,INVALID_SIDE_NUMBER:Bte,INVALID_SCORE:zte,INVALID_STAGE:hf,INVALID_START_TIME:fie,INVALID_STRUCTURE:ff,INVALID_STOP_TIME:pie,INVALID_TIE_FORMAT:ql,INVALID_TIME:Es,INVALID_TIME_ITEM:cB,INVALID_TOURNAMENT_DATES:Wte,INVALID_TOURNAMENT_RECORD:YS,INVALID_VALUES:re,INVALID_WINNING_SIDE:lM,MATCHUP_NOT_FOUND:dn,METHOD_NOT_FOUND:hM,MISSING_ASSIGNMENTS:eB,MISSING_ASYNC_STATE_PROVIDER:mie,MISSING_AVOIDANCE_POLICY:_te,MISSING_BIRTH_DATE:Vte,MISSING_COLLECTION_DEFINITION:Lte,MISSING_COURT_ID:Mh,MISSING_COURTS_INFO:oie,MISSING_DATE_AVAILABILITY:Hte,MISSING_DATE:jte,MISSING_DRAW_DEFINITION:$e,MISSING_DRAW_ID:xo,MISSING_DRAW_POSITION:Rv,MISSING_DRAW_POSITIONS:KS,MISSING_DRAW_SIZE:JS,MISSING_ENTRIES:Cte,MISSING_EVENT:ui,MISSING_QUALIFIED_PARTICIPANTS:Jte,MISSING_MATCHUP_FORMAT:Fte,MISSING_MATCHUP_ID:Tn,MISSING_MATCHUP_IDS:Ch,MISSING_MATCHUP:aa,MISSING_MATCHUPS:Nu,MISSING_PARTICIPANT_COUNT:eie,MISSING_PARTICIPANT_ID:dr,MISSING_PARTICIPANT_IDS:Wd,MISSING_PARTICIPANT_ROLE:Xte,MISSING_PARTICIPANT:Nh,MISSING_PARTICIPANTS:eU,MISSING_PENALTY_ID:lB,MISSING_PENALTY_TYPE:sie,MISSING_PERSON_DETAILS:iie,MISSING_POLICY_ATTRIBUTES:iB,MISSING_POLICY_DEFINITION:aM,MISSING_POLICY_TYPE:tB,MISSING_POSITION_ASSIGNMENTS:kte,MISSING_ROUND_NUMBER:Wxe,MISSING_SCHEDULE:hie,MISSING_SCORING_POLICY:Kxe,MISSING_SEED_ASSIGNMENTS:Ute,MISSING_SEEDCOUNT_THRESHOLDS:wte,MISSING_SEEDING_POLICY:qxe,MISSING_SET_NUMBER:Jxe,MISSING_SET_OBJECT:sM,MISSING_SIDE_NUMBER:Qxe,MISSING_STAGE:Nte,MISSING_STRUCTURE_ID:qa,MISSING_STRUCTURE:mf,MISSING_MAIN_STRUCTURE:Z$,MISSING_STRUCTURES:Q$,MISSING_TARGET_LINK:J$,MISSING_TIE_FORMAT:Mv,MISSING_TIME_ITEM:dB,MISSING_TIME_ITEMS:pB,MISSING_TOURNAMENT_ID:II,MISSING_TOURNAMENT_RECORD:ve,MISSING_TOURNAMENT_RECORDS:Mi,MISSING_VALUE:Je,MISSING_VENUE_ID:zd,MODIFICATIONS_FAILED:gie,NO_CANDIDATES:fM,NO_DRAW_POSITIONS_AVAILABLE_FOR_QUALIFIERS:sB,NO_MODIFICATIONS_APPLIED:Av,NO_STAGE_SPACE_AVAILABLE_FOR_ENTRY_STATUS:lx,NO_PARTICIPANT_REMOVED:Zte,NO_VALID_ACTIONS:wie,NO_VALID_ATTRIBUTES:mM,NO_VALID_DATES:Gte,NOT_FOUND:Br,NOT_IMPLEMENTED:hB,PARTICIPANT_COUNT_EXCEEDS_DRAW_SIZE:aB,PARTICIPANT_ID_EXISTS:Qte,PARTICIPANT_NOT_CHECKED_IN:tie,PARTICIPANT_NOT_FOUND:ji,PARTICIPANT_PAIR_EXISTS:t1e,PENALTY_NOT_FOUND:yI,POLICY_NOT_ATTACHED:Yxe,POLICY_NOT_FOUND:ZS,SCHEDULE_NOT_CLEARED:mte,SCHEDULE_CONFLICT_DOUBLE_BOOKING:hte,SCHEDULED_MATCHUPS:Die,SCORES_PRESENT:tU,SEEDSCOUNT_GREATER_THAN_DRAW_SIZE:bte,STAGE_SEQUENCE_LIMIT:Ate,STRUCTURE_NOT_FOUND:vi,TEAM_NOT_FOUND:fB,UNABLE_TO_ASSIGN_COURT:Iie,UNLINKED_STRUCTURES:Ete,UNRECOGNIZED_DRAW_TYPE:K$,UNRECOGNIZED_MATCHUP_FORMAT:QS,UNRECOGNIZED_MATCHUP_STATUS:ax,VALUE_UNCHANGED:mB,VENUE_EXISTS:cie},gi={disableNotifications:!1,tournamentId:void 0,tournamentRecords:{},subscriptions:{},modified:!1,methods:{},notices:[]},Pie={addNotice:I1e,callListener:S1e,cycleMutationStatus:g1e,deleteNotice:b1e,deleteNotices:y1e,disableNotifications:s1e,enableNotifications:o1e,getMethods:vB,getNotices:v1e,getTopics:w1e,getTournamentId:Eie,getTournamentRecord:l1e,getTournamentRecords:u1e,removeTournamentRecord:f1e,setMethods:h1e,setSubscriptions:m1e,setTournamentId:d1e,setTournamentRecord:c1e,setTournamentRecords:p1e,handleCaughtError:U1e};function s1e(){gi.disableNotifications=!0}function o1e(){gi.disableNotifications=!1}function Eie(){return gi.tournamentId}function l1e(t){return gi.tournamentRecords[t]}function u1e(){return gi.tournamentRecords}function c1e(t){let e=t?.tournamentId;return e?(gi.tournamentRecords[e]=t,{success:!0}):{error:YS}}function d1e(t){return t?gi.tournamentRecords[t]?(gi.tournamentId=t,{success:!0}):{error:ve}:(gi.tournamentId=void 0,{success:!0})}function p1e(t){gi.tournamentRecords=t;let e=Object.keys(t);e.length===1?gi.tournamentId=e[0]:e.length||(gi.tournamentId=void 0)}function f1e(t){if(typeof t!="string")return{error:re};if(!gi.tournamentRecords[t])return{error:Br};delete gi.tournamentRecords[t];let e=Object.keys(gi.tournamentRecords);return e.length===1?gi.tournamentId=e[0]:e.length||(gi.tournamentId=void 0),{success:!0}}function m1e(t){return t.subscriptions===null||Object.keys(t.subscriptions).length===0?(gi.subscriptions={},{...W}):typeof t.subscriptions!="object"?{error:re}:(Object.keys(t.subscriptions).forEach(e=>{typeof t.subscriptions[e]=="function"?gi.subscriptions[e]=t.subscriptions[e]:delete gi.subscriptions[e]}),{...W})}function h1e(t){return typeof t!="object"?{error:re}:(Object.keys(t).forEach(e=>{typeof t[e]=="function"&&(gi.methods[e]=t[e])}),{...W})}function g1e(){let t=gi.modified;return gi.modified=!1,t}function I1e({topic:t,payload:e,key:i},r){if(!(typeof t!="string"||typeof e!="object")&&(gi.disableNotifications||(gi.modified=!0),!(gi.disableNotifications||!gi.subscriptions[t]&&!r)))return i&&(gi.notices=gi.notices.filter(n=>!(n.topic===t&&n.key===i))),gi.notices.push({topic:t,payload:e,key:i}),{...W}}function vB(){return gi.methods??{}}function v1e({topic:t}){return gi.notices.filter(e=>e.topic===t).map(e=>e.payload)}function y1e(){gi.notices=[]}function b1e({topic:t,key:e}){gi.notices=gi.notices.filter(i=>(!t||i.topic===t)&&i.key!==e)}function w1e(){return{topics:Object.keys(gi.subscriptions)}}function S1e({topic:t,notices:e},i){let r=gi.subscriptions[t];r&&typeof r=="function"&&r(e);let n=i?.[t];n&&typeof n=="function"&&n(e)}function U1e({engineName:t,methodName:e,params:i,err:r}){let n;return typeof r=="string"?n=r.toUpperCase():r instanceof Error&&(n=r.message),console.log("ERROR",{tournamentId:Eie(),params:JSON.stringify(i),engine:t,methodName:e,error:n}),{error:n}}var Jt={timers:{default:{elapsedTime:0}},globalSubscriptions:{},deepCopyAttributes:{stringify:[],ignore:[],toJSON:[]},globalMethods:[],deepCopy:!0},Nr=Pie,Bz=["addNotice","callListener","cycleMutationStatus","deleteNotice","deleteNotices","disableNotifications","enableNotifications","getMethods","getNotices","getTopics","getTournamentId","getTournamentRecord","getTournamentRecords","removeTournamentRecord","setSubscriptions","setTournamentId","setTournamentRecord","setTournamentRecords"];function T1e(t){if(typeof t!="object")throw new Error("Global state provider can not be undefined or null");if(Li(Object.keys(t),Bz).length!==Bz.length)throw new Error("Global state provider is missing required methods");return Nr=t,{success:!0}}function D1e(){if(Nr.createInstanceState){try{Nr.createInstanceState()}catch(t){return{error:t}}return{success:!0}}else return{error:mie}}function oa(t){return!t||typeof t!="object"?Jt.devContext??!1:typeof Jt.devContext!="object"?!1:Object.keys(t).every(e=>Jt.devContext?.[e]===t[e])&&Jt.devContext}function P1e(t="reset",e="default"){let i=Date.now();if(t==="report"){if(e==="allTimers")return Object.keys(Jt.timers).filter(r=>r!=="default"||Jt.timers[r].startTime).map(r=>{let n=Jt.timers[r],a=n.state==="stopped"?0:(i-(n?.startTime??0))/1e3,s=n.elapsedTime+a;return{state:Jt.timers[r].state,elapsedTime:s.toFixed(2),timer:r}});{let r=Jt.timers[e].state==="stopped"?0:(i-(Jt.timers[e]?.startTime??0))/1e3,n=Jt.timers[e].elapsedTime+r;return{state:Jt.timers[e].state,elapsedTime:n.toFixed(2),timer:e}}}if(!Jt.timers[e]||t==="reset"){if(e==="allTimers")return Jt.timers={default:{elapsedTime:0}},!0;Jt.timers[e]={startTime:i,state:"active",elapsedTime:0}}return Jt.timers[e].elapsedTime||(Jt.timers[e].elapsedTime=0),t==="stop"&&Jt.timers[e].state!=="stopped"&&(Jt.timers[e].state="stopped")&&(Jt.timers[e].elapsedTime+=(i-(Jt.timers[e]?.startTime??0))/1e3),t==="start"&&(Jt.timers[e].startTime=i)&&(Jt.timers[e].state="active"),Jt.timers[e]}function Rie(t){fa(t)?Jt.globalLog=t:delete Jt.globalLog}function $b(t){Jt.devContext=t}function Cie(){Nr.disableNotifications()}function gM(){Nr.enableNotifications()}function Bb(t,e){typeof t=="boolean"&&(Jt.deepCopy=t),typeof e=="object"&&(Array.isArray(e.ignore)&&(Jt.deepCopyAttributes.ignore=e.ignore),Array.isArray(e.toJSON)&&(Jt.deepCopyAttributes.toJSON=e.toJSON),Array.isArray(e.stringify)&&(Jt.deepCopyAttributes.stringify=e.stringify),e.threshold&&(Jt.deepCopyAttributes.threshold=e.threshold))}function yB(){return{enabled:Jt.deepCopy,...Jt.deepCopyAttributes}}function E1e(t){return t?.subscriptions?(Object.keys(t.subscriptions).forEach(e=>{Jt.globalSubscriptions[e]=t.subscriptions[e]}),{...W}):{error:Je,info:"missing subscriptions"}}function R1e(t){return t?.subscriptions?Nr.setSubscriptions({subscriptions:t.subscriptions}):{error:Je,info:"missing subscriptions"}}function Mie(t){return t?typeof t!="object"?{error:re}:(Object.keys(t).forEach(e=>{fa(t[e])&&(Jt.globalMethods[e]=t[e])}),{...W}):{error:Je,info:"missing method declarations"}}function Nie(t){return t?typeof t!="object"?{error:re}:Nr.setMethods(t):{error:Je,info:"missing method declarations"}}function bB(){return Nr.cycleMutationStatus()}function st(t){if(typeof t?.topic!="string")return;let e=Jt.globalSubscriptions[t.topic];return Nr.addNotice(t,e)}function Aie(){return{...Jt.globalMethods,...Nr.getMethods()}}function kie(t){return Nr.getNotices(t)}function wB({key:t,topic:e}){return Nr.deleteNotice({key:t,topic:e})}function iU(){return Nr.deleteNotices()}function bs(){return Nr.getTopics()}function IM(t){return bs()?.topics?.includes(t)}async function dx(t){return Nr.callListener(t,Jt.globalSubscriptions)}function Ah(){return Nr.getTournamentId()}function SB(t){return Nr.getTournamentRecord(t)}function kh(){return Nr.getTournamentRecords()}function Oie(t){return Nr.setTournamentRecord(t)}function vM(t){return Nr.setTournamentRecords(t)}function Vb(t){return Nr.setTournamentId(t)}function xie(t){return Nr.removeTournamentRecord(t)}function px(){return Nr}function yM({engineName:t,methodName:e,params:i,err:r}){let n=fa(Nr.handleCaughtError)&&Nr.handleCaughtError||Pie.handleCaughtError,{tournamentRecord:a,...s}=i;return n({params:s,engineName:t,methodName:e,err:r})}function Fie(t,e){if(Jt.globalLog)try{Jt.globalLog({log:t,engine:e})}catch(i){console.log("globalLog error",i),console.log(e,t),Rie()}else console.log(e,t)}function Lie(t,e,i,r){if(!wt(t))return{error:re};Ai||(i=1);let n=Array.isArray(e)?e:[],a={},s=(o,l=0)=>{Object.keys(o).forEach(u=>{fa(o[u])?a[u]=o[u]:wt(o[u])&&(e===!0||n?.includes(u))&&(i===void 0||l<i)&&s(o[u],l+1)})};return s(t),r?Mie(a):Nie(a),{methods:a}}function C1e(t,e,i){return Object.keys(t).filter(r=>!e.includes(t[r])&&(!i||(Array.isArray(t[r])?t[r].length:!0)))}function je(t,e,i,r){if(typeof t!="object"||t===null)return t;yB()?.enabled||(r=!0);let n=["",void 0,null];e&&n.push(!1);let a=C1e(t,n,i);return Object.assign({},...a.map(s=>Array.isArray(t[s])?{[s]:r?t[s]:t[s].map(o=>je(o))}:{[s]:r?t[s]:je(t[s])}))}function q({context:t,result:e,stack:i,info:r}){return e&&!Array.isArray(e?.stack)&&(e.stack=[]),e&&Array.isArray(e?.stack)&&typeof i=="string"&&e.stack.push(i),e&&r&&(e.info=r),e&&typeof t=="object"&&Object.keys(t).length&&(e.context||(e.context={}),Object.assign(e.context,je(t))),e&&!e?.error&&!e?.success&&Object.assign(e,{...W}),e??{success:!0}}var zr="FEMALE",zu="OTHER",Oh="MIXED",tr="MALE",UB={FEMALE_ABBR:"F",OTHER_ABBR:"O",MIXED_ABBR:"X",MALE_ABBR:"M",ANY_ABBR:"A",FEMALE:zr,MIXED:Oh,OTHER:zu,MALE:tr,ANY:"ANY"};function up(t){return[zr,"F"].includes(t)}function Yf(t){return[tr,"M"].includes(t)}function Aa(t){return[Oh,"X"].includes(t)}function du(t){return["ANY","A"].includes(t)}function ln(t){if(t){if(up(t))return zr;if(Aa(t))return Oh;if(Yf(t))return tr;if(du(t))return"ANY"}return zu}function cl(t){return up(t)||Yf(t)}var M1e="MIXED events can not contain mixed singles or { gender: ANY } collections",N1e="events with { gender: ANY } can not contain MIXED singles collections";function bM(t){let e="tieFormatGenderValidityCheck",{referenceGender:i,matchUpType:r,gender:n}=t;return i&&n&&cl(i)&&ln(i)!==ln(n)?q({result:{valid:!1,error:Hy},context:{gender:n},stack:e}):Aa(i)&&(du(n)||Aa(n)&&r!==Bt)?q({result:{error:Hy,valid:!1},info:M1e,stack:e}):du(i)&&Aa(n)&&r!==Bt?q({result:{error:Hy,valid:!1},info:N1e,stack:e}):{valid:!0}}var A1e="normal",Vz="timed",k1e="final",TB="NOAD",_ie=["SET","HAL","QTR","PER","INN","RND","FRM","MAP","MAT"],$ie="CONSECUTIVE",Bie="TRADITIONAL",O1e={S:A1e,F:k1e,G:"game"};function wM(t,e){if(wt(t)&&(t?.bestOf||t?.exactly)&&t?.setFormat)return F1e(t,e)}function jb(t){return!Number.isNaN(Number(t))&&Number(t)}function Vie(t){let e=`T${t.minutes}`;return t.based==="P"&&(e+="P"),t.tiebreakFormat?.tiebreakTo&&(e+=`/TB${t.tiebreakFormat.tiebreakTo}`),t.modifier&&(e+=`@${t.modifier}`),e}function x1e(t){let e=t?.deuceAfter?`${t.deuceAfter}D`:"";if(t?.type===Bie)return`TN${e}`;if(t?.type===$ie&&Number.isInteger(t.count))return`${t.count}C${e}`}function F1e(t,e){let i=jb(t.bestOf)||void 0,r=jb(t.exactly)||void 0,n=i||r;if(t.setFormat?.timed&&t.simplified&&n===1)return Vie(t.setFormat);let a=t.matchRoot||"SET",s=r&&r!==1?"X":"",o=t.aggregate?"A":"",l=n&&`${a}${n}${s}${o}`||"",u=jz(t.setFormat,e),c=u&&`S:${u}`||"",d=jz(t.finalSetFormat,e),p=n&&n>1&&d&&u!==d&&`F:${d}`||"",f=t.gameFormat?`G:${x1e(t.gameFormat)}`:"";if(l&&u)return[l,c,f,p].filter(Boolean).join("-")}function jz(t,e){if(typeof t=="object"&&Object.keys(t).length){if(t.timed)return Vie(t);if(t.tiebreakSet)return Gz(t.tiebreakSet);let i=jb(t.setTo);if(i){let r=t.NoAD&&TB||"",n=Gz(t.tiebreakFormat),a=n&&`/${n}`||"",s=jb(t.tiebreakAt),o=s&&(s!==i||e)&&`@${s}`||"";if(n!==!1)return`${i}${r}${a}${o}`}}}function Gz(t){if(t){if(typeof t=="object"&&!t.tiebreakTo)return"";if(typeof t=="object"&&jb(t.tiebreakTo)){let e=`TB${t.tiebreakTo}${t.NoAD?TB:""}`;return t.modifier&&(e+=`@${t.modifier}`),e}else return!1}}function qi(t){if(ni(t)){let e=t.startsWith("T")&&Vz||_ie.some(i=>t.startsWith(i))&&"SET"||"";if(e===Vz){let i=Hie(t),r={simplified:!0,setFormat:i,bestOf:1};if(i)return r}if(e==="SET")return $1e(t)}}function L1e(t){let e=_ie.find(u=>t.startsWith(u));if(!e)return;let i=t.slice(e.length),r=/^(\d+)([A-Z]*)$/.exec(i);if(!r)return;let n=bI(r[1]);if(!n)return;let a=r[2],s=!1,o=!1,l=[];for(let u of a)u==="X"?s=!0:u==="A"?o=!0:l.push(u);return{matchRoot:e,count:n,exactly:s,aggregate:o,matchMods:l}}function _1e(t){let e=/^(.+?)(\d+D)$/.exec(t),i=e?e[1]:t,r=e?Number(e[2].slice(0,-1)):void 0;if(r!==void 0&&(r<1||!Number.isInteger(r)))return;if(i==="TN"){let a={type:Bie};return r&&(a.deuceAfter=r),a}let n=/^([1-9]\d*)C$/.exec(i);if(n){let a={type:$ie,count:Number(n[1])};return r&&(a.deuceAfter=r),a}}function $1e(t){let e=t.split("-"),i=L1e(e[0]);if(!i)return;let{matchRoot:r,count:n,exactly:a,aggregate:s,matchMods:o}=i,l=a&&n!==1?void 0:n,u=a&&n!==1?n:void 0,c,d,p,f=0,m=0,h=0;for(let v=1;v<e.length;v++){let w=e[v].indexOf(":");if(w<0)return;let y=e[v].slice(0,w),b=e[v].slice(w+1);if(!(y in O1e))return;if(y==="S"){if(f++,f>1)return;c=Hz(e[v],b)}else if(y==="F"){if(m++,m>1)return;d=Hz(e[v],b)}else if(y==="G"&&(h++,h>1||(p=_1e(b),!p)))return}let g=c&&c.timed||d&&d.timed;if(r==="SET"&&!(l&&l<6||g&&u)||!c||!(!d||d))return;let I=je({setFormat:c,exactly:u,bestOf:l});return r!=="SET"&&(I.matchRoot=r),s&&(I.aggregate=!0),o.length>0&&(I.matchMods=o),d&&(I.finalSetFormat=d),p&&(I.gameFormat=p),I}function Hz(t,e){return e.startsWith("TB")?B1e(e):e.startsWith("T")?Hie(e):V1e(t,e)}function B1e(t){let e=Gie(t);return e===!1?!1:typeof e=="object"?{tiebreakSet:e}:void 0}function V1e(t,e){let i=/^[FS]:(\d+)([A-Za-z]*)/.exec(t),r=i&&Wie(i[2])||!1,n=!i?.[2]||r,a=i?bI(i[1]):void 0,s=jie(e),o=s!==!1,l=o&&s||a,u=Gie(e.split("/")[1]);return!a||!n||u===!1||!o?!1:j1e(a,r,u,l)}function j1e(t,e,i,r){let n={setTo:t};return e&&(n.NoAD=!0),i?(n.tiebreakFormat=i,n.tiebreakAt=r):n.noTiebreak=!0,n}function jie(t,e=!0){let i=t?.indexOf("@")>0&&t.split("@");if(i)return(e?bI(i[1]):i[1])||!1}function Gie(t){if(t)return t.startsWith("TB")?G1e(t):!1}function G1e(t){let e=jie(t,!1),i=/^TB(\d+)([A-Za-z]*)/.exec(t),r=i?.[1],n=i&&Wie(i[2]),a=!i?.[2]||n,s=bI(r);if(!s||!a)return!1;let o={tiebreakTo:s};return e&&typeof e=="string"&&!lt(e)&&(o.modifier=e),n&&(o.NoAD=!0),o}function Hie(t){let e=t.slice(1),i=/^(\d+)([PG])?(?:\/TB(\d+))?(@[A-Za-z]+)?$/.exec(e),r=bI(i?.[1]);if(!r)return;let n={timed:!0,minutes:r},a=i?.[2];a==="P"?n.based="P":a==="G"&&(n.based="G");let s=i?.[3];if(s){let u=bI(s);u&&(n.tiebreakFormat={tiebreakTo:u})}let o=i?.[4],l=[void 0,"P","G",""].includes(o);if(o&&!l){let u=/^(\d+)([PGA])?(?:\/TB\d+)?(@)([A-Za-z]+)$/.exec(e)?.[4];return u?(n.modifier=u,n):void 0}return o&&(n.based=o),n}function Wie(t){return t?.includes(TB)}function bI(t){let e=Number(t);return Number.isNaN(e)?0:e}function H1e(t){return t.replaceAll(/T(\d+)G(?=\/TB|@|-|$)/g,"T$1")}function $a({matchUpFormat:t}){if(!ni(t)||t==="")return!1;let e=qi(t),i=/-S:(\d+)\/TB(\d{1,2})@?(\d?)/.exec(t),r=i?.[1],n=i?.[2],a=i?.[3],s=/-F:(\d+)\/TB(\d{1,2})@?(\d?)/.exec(t),o=s?.[1],l=s?.[2],u=s?.[3];return wM(e,!!(i&&n&&r===a||s&&l&&o===u))===H1e(t)}var MP=/^\d{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2]\d|3[0-1])$/,zie=/^((0\d|1\d|2[0-3]):[0-5]\d(:[0-5]\d)?)([.,]\d{3})?$/,dl=/^(\d{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2]\d|3[0-1]))([ T](0\d|1\d|2[0-3]):[0-5]\d(:[0-5]\d)?)?([.,]\d{3})?Z?$/,cp=/^(\d{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2]\d|3[0-1]))?([ T]?(0\d|1\d|2[0-3]):[0-5]\d(:[0-5]\d)?)?([.,]\d{3})?Z?$/;function NP(t){let{scheduledDate:e}=t;if(!e&&t.scheduledTime&&(e=Ze(t.scheduledTime)),!e)return;let i=pi(t.scheduledTime),r=Ze(e);return r&&i&&(r+=`T${i}`),r}function W1e(t){return typeof t!="object"||Array.isArray(t)?!1:Object.prototype.toString.call(t)==="[object Date]"}function kv(t){let e=typeof t=="string"?t?.split(" "):[];if(t&&e?.length>1&&!["AM","PM"].includes(e[1].toUpperCase()))return!1;let i=xh(t,!0,!0);return!!(!t||i&&cp.test(i))}function Mn(t){return vc(t)||MP.test(t)}function z1e(t){let e=new Date(t),i=e.getSeconds()+60*e.getMinutes()+3600*e.getHours();return q1e(i,{displaySeconds:!1})}function q1e(t,e){let i=Number.parseInt(t,10),r=Math.floor(i/3600),n=Math.floor((i-r*3600)/60),a=i-r*3600-n*60;return(!e||e?.displaySeconds?r+":"+n+":"+a:r+":"+n).split(":").map(as).join(":")}var DB=t=>{let e=Gb(t)||vc(t)?new Date(t):new Date,i=e.getUTCMonth()+1,r=i<10?`0${i}`:`${i}`;return`${e.getUTCFullYear()}-${as(r)}-${as(e.getUTCDate())}`};function Y1e(t){let e=Gb(t)||vc(t)?new Date(t):new Date;return Date.UTC(e.getFullYear(),e.getMonth(),e.getDate())}function Bs(t,e="-",i="YMD"){if(!t)return"";typeof t=="string"&&!t.includes("T")&&(t=t+"T00:00");let r=new Date(t),n=""+(r.getMonth()+1),a=""+r.getDate(),s=r.getFullYear();return n.length<2&&(n="0"+n),a.length<2&&(a="0"+a),i==="DMY"?[a,n,s].join(e):i==="MDY"?[n,a,s].join(e):i==="YDM"?[s,a,n].join(e):i==="DYM"?[a,s,n].join(e):i==="MYD"?[n,s,a].join(e):[s,n,a].join(e)}function AP(t){let e=t?new Date(t):new Date,i=e.getTimezoneOffset();return new Date(e.getTime()-i*60*1e3)}function K1e(t){return AP(t).getTime()}function Gb(t){if(typeof t=="boolean")return!1;let e=t instanceof Date&&t||!Number.isNaN(Number(t))&&new Date(t)||!1;return e&&!Number.isNaN(Number(e.valueOf()))}function X1e(t,e){return t<=e}function wI(t,e){if(!Mn(t)||!Mn(e))return[];let i=Ze(t)+"T00:00",r=Ze(e)+"T00:00",n=new Date(i),a=new Date(r),s=Gb(a)&&Gb(n)&&X1e(n,a),o=[],l=0;if(s){let u=n,c=u.getTime();for(;c<=a.getTime()&&l<300;)l+=1,o.push(new Date(u)),c=u.setDate(u.getDate()+1)}return o.map(u=>Bs(u))}var J1e=/^([+-]?\d{4}(?!\d{2}\b))((-?)((0[1-9]|1[0-2])(\3([12]\d|0[1-9]|3[01]))?|W([0-4]\d|5[0-2])(-?[1-7])?|(00[1-9]|0[1-9]\d|[12]\d{2}|3([0-5]\d|6[1-6])))([T\s]((([01]\d|2[0-3])((:?)[0-5]\d)?|24:?00)([.,]\d+(?!:))?)?(\17[0-5]\d([.,]\d+)?)?([zZ]|([+-])([01]\d|2[0-3]):?([0-5]\d)?)?)?)?$/;function vc(t){return typeof t!="string"?!1:J1e.test(t)}function rd(t){return typeof t!="string"||!vc(t)?!1:/([zZ]|[+-]\d{2}:?\d{2})$/.test(t)}function PB(t){if(typeof t!="string")return!1;let e=t.split("Z")[0].split(":"),i=e.every(r=>!Number.isNaN(Number.parseInt(r)));return!(e.length<2||!i||Number.parseInt(e[0])>23||Number.parseInt(e[1])>60)}function Rt(t){let e=pi(t);if(!e)return 0;let[i,r]=e.split(":").map(n=>Number.parseInt(n));return i*60+r}function Q1e(t){let e=Math.floor(t/60),i=t-e*60;return e>23&&(e=e%24),[as(e),as(i)].join(":")}function kP(t){return PB(t)?t.split(":").slice(0,2).map(as).join(":"):void 0}function pi(t){return vc(t)&&t.indexOf("T")>0?kP(t.split("T").reverse()[0]):kP(t)}function Ze(t){return vc(t)||dl.test(t)?t.split("T")[0]:""}function Sy(t,e){let i=new Date(t);return i.setDate(i.getDate()+e),Ze(i.toISOString())}function OP(t){t=typeof t=="string"?t:"00:00";let e={},i={};return{0:e.time,1:e.ampm}=t.split(" ")||[],{0:i.hours,1:i.minutes}=e.time.split(":")||[],i.ampm=e.ampm,Number.isNaN(Number.parseInt(i.hours))||Number.isNaN(Number.parseInt(i.minutes))||i.ampm&&!["AM","PM"].includes(i.ampm.toUpperCase())?{}:i}function Z1e(t){let e=OP(t);return e.ampm&&e.hours&&(e.ampm.toLowerCase()==="pm"&&Number.parseInt(e.hours)<12&&(e.hours=(e.hours&&Number.parseInt(e.hours)||0)+12),e.ampm.toLowerCase()==="am"&&e.hours==="12"&&(e.hours="00")),`${e.hours||"12"}:${e.minutes||"00"}`.split(":").map(as).join(":")}function eFe(t){let e=OP(t);if(!(typeof e=="object"&&!Object.keys(e).length))return e.ampm?t:(e.hours>12?(e.hours-=12,e.ampm="PM"):e.hours==="12"?e.ampm="PM":(e.hours==="00"&&(e.hours="12"),e.ampm="AM"),e.hours?.[0]==="0"&&(e.hours=e.hours.slice(1)),`${e.hours||"12"}:${e.minutes||"00"} ${e.ampm}`)}function xh(t,e,i){let r=Ze(t),n=pi(t),a=r?n:t;return t?e&&(r&&i&&t||Z1e(a))||eFe(a):void 0}function qie(t,e){let i=OP(t),r=OP(e);if(Number.parseInt(i.hours)<Number.parseInt(r.hours))return-1;if(Number.parseInt(i.hours)>Number.parseInt(r.hours))return 1;if(i.hours===r.hours){if(Number.parseInt(i.minutes)<Number.parseInt(r.minutes))return-1;if(Number.parseInt(i.minutes)>Number.parseInt(r.minutes))return 1}return 0}function EB(t,e=7){let i=Ze(t)+"T00:00",r=new Date(i),n=new Date(r.setDate(r.getDate()+e));return Bs(n)}function tFe(t){return EB(t)}function iFe(t,e,i,r=!1){let n=new Date(e,0,1+(t-1)*7),a=r?0:1;return n.setDate(n.getDate()+(a-n.getDay())),Bs(n,i)}function rFe(t,e,i){let r=new Date(t,0);return Bs(new Date(r.setDate(e)),i)}function Ji(t,e=void 0){let[i,r]=(t||"00:00").split(":").map(as),n=AP(e).setHours(i,r,0,0);return AP(n)}function rU(t,e,i=!0){let r=new Date(t),n=(new Date(e).getTime()-r.getTime())/1e3/60;return i?Math.abs(Math.round(n)):Math.round(n)}function Qn(t,e){let i=pi(t);if(!i)return"00:00";let r=Number.isNaN(e)?0:e;return pi(RB(Ji(i),r).toISOString())||"00:00"}function RB(t,e){let i=new Date(t);return new Date(i.getTime()+e*6e4)}function as(t){return t.toString()[1]?t:"0"+t}function pu(t,e){let i=new Date(t),r=new Date(e);return i.getFullYear()===r.getFullYear()&&i.getMonth()===r.getMonth()&&i.getDate()===r.getDate()}var Yie={addDays:EB,addWeek:tFe,addMinutesToTimeString:Qn,convertTime:xh,getIsoDateString:NP,getUTCdateString:DB,DateHHMM:z1e,extractDate:Ze,extractTime:pi,formatDate:Bs,getDateByWeek:iFe,isISODateString:vc,isValidEmbargoDate:rd,isDate:Gb,isTimeString:PB,offsetDate:AP,offsetTime:K1e,sameDay:pu,timeStringMinutes:Rt,timeToDate:Ji,timeUTC:Y1e,validTimeValue:kv,validDateString:MP,timeValidation:cp,dateValidation:dl},nFe=(t,e)=>t.filter(Boolean).every(i=>typeof i===e),aFe=t=>t.filter(Boolean).every(Ai);function ug(t,e){return`${t}-${e}`}function $p(t){let e=t.category;if(typeof e!="object"||!e)return{error:_b};let{ageCategoryCode:i,ageMaxDate:r,ageMinDate:n,ageMax:a,ageMin:s}=e,o=e.categoryName,l;if(!(nFe([i,r,n,o],"string")&&aFe([a,s])&&[r,n].filter(Boolean).every(Mn)))return{error:_b};let u=t.consideredDate??Ze(new Date().toLocaleDateString("sv"));if(!u||!Mn(u))return{error:or};let[c]=u.split("-").slice(0,3).map(L=>Number.parseInt(L)),d=Sy(u,-1);if(!d)return{error:or};let[p,f]=d.split("-").slice(1,3).map(L=>Number.parseInt(L)),m=`${as(p)}-${as(f)}`,h=Sy(u,1);if(!h)return{error:or};let[g,I]=h.split("-").slice(1,3).map(L=>Number.parseInt(L)),v=`${as(g)}-${as(I)}`,w=s&&Sy(u,-1*365*s),y=a&&Sy(u,-1*365*a),b=[],S=L=>!b.includes(L)&&b.push(L);i=i??o;let U=/^([UO]?)(\d{1,2})([UO]?)$/,T=/^C(\d{1,2})-(\d{1,2})$/,P=i?.includes("-"),D=P&&i?.match(T),E=i?.match(U);function R(L){let $=c-L,V=ug($,v);e.ageMinDate&&e.ageMinDate!==V&&S(`Invalid submitted ageMinDate: ${n}`),n=V,i&&(e.ageMax&&e.ageMax!==L-1&&(S(`Invalid submitted ageMax: ${a}`),y=void 0),a=L-1)}function C(L){let $=c-L-1,V=ug($,v);e.ageMin&&e.ageMin>L&&S(`Invalid submitted ageMin: ${s}`),e.ageMax&&e.ageMax>L&&S(`Invalid submitted ageMax: ${a}`),e.ageMinDate&&e.ageMinDate!==V&&S(`Invalid submitted ageMinDate: ${n}`),n=V,i&&(e.ageMax&&e.ageMax!==L&&(S(`Invalid submitted ageMax: ${a}`),w=void 0),a=L)}function M(L){let $=c-L,V=ug($,m);e.ageMaxDate&&e.ageMaxDate!==V&&S(`Invalid submitted ageMaxDate: ${r}`),r=V,i&&(e.ageMin&&e.ageMin!==L+1&&(S(`Invalid submitted ageMin: ${s}`),w=void 0),s=L+1)}function N(L){let $=c-L-1,V=ug($,m);e.ageMaxDate&&e.ageMaxDate!==V&&S(`Invalid submitted ageMaxDate: ${r}`),r=V,i&&(e.ageMin&&e.ageMin!==L&&(S(`Invalid submitted ageMin: ${s}`),w=void 0),s=L)}function A(L){let $=U.exec(L)||[],[V,_,B]=$.slice(1),G=Number.parseInt(_);V==="U"?(e.ageMaxDate&&e.ageMaxDate!==r&&S(`Invalid submitted ageMaxDate: ${e.ageMaxDate}`),R(G)):V==="O"&&M(G),B==="U"?(e.ageMaxDate&&e.ageMaxDate!==r&&S(`Invalid submitted ageMaxDate: ${e.ageMaxDate}`),C(G)):B==="O"&&N(G),r=(r??w)||void 0,n=(n??y)||void 0}function O(){if(r=void 0,n=void 0,a=void 0,s=void 0,e.ageMin){let V=c-e.ageMin;r=ug(V,m)}if(e.ageMax){let V=c-e.ageMax-1;n=ug(V,v)}let[L,$]=(i?.match(T)??[]).slice(1).map(V=>Number.parseInt(V));L<=$?(s=L,a=$,l=!0):S(`Invalid combined age range ${i}`)}function k(){s&&M(s),a&&C(a)}function F(){D?O():P?i?.split("-").forEach(A):E&&i?A(i):k()}F(),a&&e?.ageMin&&e?.ageMin>a&&(S(`Invalid submitted ageMin: ${e?.ageMin}`),s=void 0);let x=je({consideredDate:u,combinedAge:l,ageMaxDate:r,ageMinDate:n,ageMax:a,ageMin:s});return b.length&&(x.errors=b),x}function Hb({category:t}){if(!wt(t))return{error:re};let e=$p({category:t});if(e.error)return{error:e};let{ratingMax:i,ratingMin:r}=t;return i&&!Ai(i)?q({result:{error:re},context:{ratingMax:i}}):r&&!Ai(r)?q({result:{error:re},context:{ratingMin:r}}):{...e}}function nU({childCategory:t,withDetails:e,category:i}){let r=Hb({category:i}),n=Hb({category:t}),a=n.ageMin&&(r.ageMin&&n.ageMin<r.ageMin||r.ageMax&&n.ageMin>r.ageMax),s=n.ageMax&&(r.ageMax&&n.ageMax>r.ageMax||r.ageMin&&n.ageMax<r.ageMin),o=n.ageMinDate&&r.ageMaxDate&&new Date(n.ageMinDate)>new Date(r.ageMaxDate),l=n.ageMaxDate&&r.ageMinDate&&new Date(n.ageMaxDate)<new Date(r.ageMinDate),u=i?.ratingType&&t?.ratingType&&i.ratingType===t.ratingType&&(i.ratingMin&&t.ratingMin&&t.ratingMin<i.ratingMin||i.ratingMax&&t.ratingMax&&t.ratingMax>i.ratingMax||i.ratingMin&&t.ratingMax&&t.ratingMax<i.ratingMin||i.ratingMax&&t.ratingMin&&t.ratingMin>i.ratingMax),c=i?.ballType&&t?.ballType&&i.ballType!==t.ballType,d=je({invalidRatingRange:u,invalidAgeMinDate:o,invalidAgeMaxDate:l,invalidBallType:c,invalidAgeMax:s,invalidAgeMin:a,valid:!u&&!o&&!l&&!c&&!s&&!a},!0);return e&&Object.assign(d,{categoryDetails:r,childCategoryDetails:n}),d}function aU({checkCategory:t=!0,collectionDefinition:e,checkCollectionIds:i,checkGender:r=!0,referenceCategory:n,referenceGender:a,event:s}){a=a??s?.gender;let o="validateCollectionDefinition",l=[];if(typeof e!="object")return l.push(`collectionDefinition must be an object: ${e}`),q({result:{errors:l,error:$c},stack:o});let{collectionValueProfiles:u,collectionGroupNumber:c,collectionValue:d,collectionId:p,matchUpCount:f,matchUpFormat:m,matchUpValue:h,matchUpType:g,scoreValue:I,setValue:v,category:w,gender:y}=e;if(i&&typeof p!="string"&&l.push(`collectionId is not type string: ${p}`),typeof f!="number"&&l.push(`matchUpCount is not type number: ${f}`),g&&!pm([zt,Bt],g)&&l.push(`matchUpType must be SINGLES or DOUBLES: ${g}`),[!!u?.length].concat([h,d,I,v].map(lt)).filter(Boolean).length!==1&&l.push("Missing value definition for matchUps: matchUpValue, collectionValue, or collectionValueProfiles"),h&&typeof h!="number"&&l.push(`matchUpValue is not type number: ${h}`),d&&typeof d!="number"&&l.push(`collectionValue is not type number: ${d}`),u&&f){let b=dte({collectionValueProfiles:u,matchUpCount:f});b.errors&&l.push(...b.errors)}if(c&&typeof c!="number"&&l.push(`collectionGroupNumber is not type number: ${d}`),m&&!$a({matchUpFormat:m})&&l.push(`Invalid matchUpFormat: ${m}`),r){let b=bM({referenceGender:a,matchUpType:g,gender:y});if(b.error)return q({context:{referenceGender:a,gender:y},result:b,stack:o})}if(t&&n&&w){let b=nU({category:n,childCategory:w});if(!b.valid)return q({result:{error:_b},context:b,stack:o})}return l.length?q({result:{errors:l,error:yie},stack:o}):{valid:!0}}function Gn(t){let e=!!(t?.enforceCategory!==!1&&t?.category),i=!!(t?.enforceGender!==!1&&t?.gender),r=t?.checkCollectionIds,n=t?.tieFormat,a=t?.event,s="validateTieFormat",o=[],l=sFe({...t,stack:s});if(l?.error)return l;let u,c=n.collectionDefinitions.every(h=>{let{setValue:g,scoreValue:I,collectionValue:v}=h;(g||I)&&!v&&(u=!0);let{valid:w,errors:y}=aU({referenceCategory:t.category,referenceGender:t.gender,collectionDefinition:h,checkCollectionIds:r,checkCategory:e,checkGender:i,event:a});return w?!0:(Array.isArray(y)&&o.push(...y),!1)}),d=typeof n.winCriteria?.valueGoal=="number"&&n.winCriteria?.valueGoal>0&&!u||n.winCriteria?.aggregateValue;if(!(d||n.winCriteria?.aggregateValue))return u?o.push("aggregateValue is required"):o.push("Either non-zero valueGoal, or { aggregateValue: true } must be specified in winCriteria"),q({context:{tieFormat:n,errors:o,aggregateValueImperative:u},result:{error:ql},stack:s});let p=n.collectionDefinitions.map(({collectionId:h})=>h),f=!r||p.length===nt(p).length,m=c&&d&&f;return m?{valid:m,errors:o}:q({result:{error:ql},context:{tieFormat:n,errors:o},stack:s})}function sFe(t){let{tieFormat:e,stack:i}=t;return!t||!e||!wt(e)?q({result:{error:ql},context:{tieFormat:e,message:"tieformat must be an object"},stack:i}):wt(e.winCriteria)?Array.isArray(e.collectionDefinitions)?{...W}:q({result:{error:ql},context:{tieFormat:e,message:"collectionDefinitions must be an array"},stack:i}):q({result:{error:ql},context:{tieFormat:e,message:"tieformat.winCritiera must be an object"},stack:i})}var xP="resourceSubType",FP="resourceType",SI="identifier",fx="name",oFe={RESOURCE_SUB_TYPE:xP,RESOURCE_TYPE:FP,IDENTIFIER:SI,NAME:fx};function Oe(t,e,i,r,n=0){if(px().makeDeepCopy)return px().makeDeepCopy(t,e,i,r);let a=yB(),{stringify:s,toJSON:o,ignore:l,modulate:u}=a||{};if(!a?.enabled&&!i||typeof t!="object"||fa(t)||t===null||typeof a?.threshold=="number"&&n>=a.threshold)return t;let c=Array.isArray(t)?[]:{},d=Object.keys(t).filter(f=>!i||!l||Array.isArray(l)&&!l.includes(f)||fa(l)&&!l(f)),p=(f,m)=>{c[f]=fa(m?.toString)?m.toString():JSON.stringify(m)};for(let f of d){let m=t[f],h=fa(u)?u(m):void 0;if(h!==void 0)c[f]=h;else if(e&&f==="extensions"&&Array.isArray(m)){let g=CB(m);Object.assign(c,...g)}else r&&f==="extensions"?c[f]=[]:Array.isArray(s)&&s.includes(f)?p(f,m):Array.isArray(o)&&o.includes(f)&&fa(m?.toJSON)?c[f]=m.toJSON():m===null?c[f]=void 0:W1e(m)?c[f]=new Date(m).toISOString():c[f]=Oe(m,e,i,r,n+1)}return c}function CB(t){return t?.map(e=>{let{name:i,value:r}=e;return i&&r&&{[`_${i}`]:r}}).filter(Boolean)}function Kie(t=1,e){return Ce(0,t).map(()=>Ct(e))}function Ct(t){let e=[];for(let o=0;o<256;o++)e[o]=(o<16?"0":"")+o.toString(16);let i=Math.trunc(Math.random()*4294967295),r=Math.trunc(Math.random()*4294967295),n=Math.trunc(Math.random()*4294967295),a=Math.trunc(Math.random()*4294967295),s=e[i&255]+e[i>>8&255]+e[i>>16&255]+e[i>>24&255]+"-"+e[r&255]+e[r>>8&255]+"-"+e[r>>16&15|64]+e[r>>24&255]+"-"+e[n&63|128]+e[n>>8&255]+"-"+e[n>>16&255]+e[n>>24&255]+e[a&255]+e[a>>8&255]+e[a>>16&255]+e[a>>24&255];return typeof t=="string"?`${t}_${s.replaceAll("-","")}`:s}var Xie={collectionDefinitions:[{collectionName:"Male Singles",matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpCount:4,matchUpValue:1,gender:"MALE"},{collectionName:"Female Singles",matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:4,matchUpValue:1},{collectionName:"Male Doubles",matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpCount:2,matchUpValue:1,gender:"MALE"},{collectionName:"Female Doubles",matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:2,matchUpValue:1},{collectionName:"Mixed Doubles",matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpCount:4,matchUpValue:1,gender:"MIXED"}],tieFormatName:"USTA_GOLD_TEAM_CHALLENGE",winCriteria:{valueGoal:9}},Jie={collectionDefinitions:[{collectionName:"Round 1",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Round 2",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Round 3",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"Doubles Shuffle",unrestrictedSelections:!0,winCriteria:{aggregateValue:!0}},Qie={collectionDefinitions:[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_SOUTHERN_LEVEL_5",winCriteria:{valueGoal:8}},Zie={collectionDefinitions:[{category:{ageCategoryCode:"16U"},collectionName:"16U Singles",matchUpCount:4,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Singles",matchUpCount:4,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Doubles",matchUpCount:2,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Doubles",matchUpCount:2,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Tiebreak Doubles",matchUpCount:1,matchUpFormat:"SET1-S:TB10",matchUpType:"DOUBLES",matchUpValue:1,processCodes:["RANKING.IGNORE"]}],tieFormatName:"USTA_SECTION_BATTLE",winCriteria:{valueGoal:9}},ere={collectionDefinitions:[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_INTERSECTIONAL",winCriteria:{valueGoal:8}},tre={collectionDefinitions:[{scoreValue:1,matchUpType:"SINGLES",collectionName:"Men's Singles",matchUpFormat:"SET1-S:T60",gender:"MALE",matchUpCount:1},{scoreValue:1,matchUpType:"SINGLES",collectionName:"Women's Singles",matchUpFormat:"SET1-S:T60",gender:"FEMALE",matchUpCount:1},{matchUpValue:1,matchUpType:"DOUBLES",collectionName:"Mixed Doubles",matchUpFormat:"SET1-S:T60",gender:"MIXED",matchUpCount:1}],tieFormatName:"Time Tennis Pro Circuit",winCriteria:{aggregateValue:!0}},ire={collectionDefinitions:[{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"DOMINANT_DUO_MIXED",winCriteria:{valueGoal:2}},rre={collectionDefinitions:[{scoreValue:1,matchUpType:"SINGLES",collectionName:"Men's Singles",matchUpFormat:"SET1-S:T60",gender:"MALE",matchUpCount:3},{scoreValue:1,matchUpType:"SINGLES",collectionName:"Women's Singles",matchUpFormat:"SET1-S:T60",gender:"FEMALE",matchUpCount:3},{scoreValue:1,matchUpType:"DOUBLES",collectionName:"Men's Doubles",matchUpFormat:"SET1-S:T60",gender:"MALE",matchUpCount:1},{matchUpValue:1,matchUpType:"DOUBLES",collectionName:"Women's Doubles",matchUpFormat:"SET1-S:T60",gender:"FEMALE",matchUpCount:1},{matchUpValue:1,matchUpType:"DOUBLES",collectionName:"Mixed Doubles",matchUpFormat:"SET1-S:T60",gender:"MIXED",matchUpCount:1}],tieFormatName:"Time Tennis Dual",winCriteria:{aggregateValue:!0}},nre={collectionDefinitions:[{category:{ageCategoryCode:"14U"},collectionName:"14U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],collectionGroups:[{groupNumber:1,groupName:"Doubles",groupValue:1,winCriteria:{valueGoal:2}}],tieFormatName:"USTA_BREWER_CUP",winCriteria:{valueGoal:4}},are={winCriteria:{valueGoal:23},tieFormatName:"USTA_OZAKI_CUP",collectionDefinitions:[{category:{ageCategoryCode:"18U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"18U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"18U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"18U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"18U"},collectionName:"18U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"16U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"16U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"16U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"16U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"16U"},collectionName:"16U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"14U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"14U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"14U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"14U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"14U"},collectionName:"14U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"12U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"12U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"12U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"12U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"12U"},collectionName:"12U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"12U"},collectionName:"12U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"12U"},collectionName:"12U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1}]},Vs="SET3-S:6/TB7",lFe="SET3-S:6NOAD",sre="SET3-S:6/TB7-F:TB10",uFe="SET3-S:4/TB7",cFe="SET3-S:4/TB5@3",dFe="SET1-S:T20",pFe="SET1-S:8/TB7",fFe="SET1-S:8/TB7@7",mFe={FORMAT_STANDARD:Vs,FORMAT_STANDARD_NOAD:lFe,FORMAT_ATP_DOUBLES:sre,FORMAT_SHORT_SETS:uFe,FORMAT_FAST4:cFe,FORMAT_PRO_SET:pFe,FORMAT_COLLEGE_PRO_SET:fFe,TIMED20:dFe},ore={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"DOMINANT_DUO",winCriteria:{valueGoal:2}},lre={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",collectionValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"USTA_COLLEGE",winCriteria:{valueGoal:4}},ure={collectionDefinitions:[{collectionName:"Male Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_LEVEL_1",winCriteria:{valueGoal:10}},cre={collectionDefinitions:[{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Overtime",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"USTA_WTT_ITT",winCriteria:{aggregateValue:!0}},dre={collectionDefinitions:[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_ZONAL",winCriteria:{valueGoal:10}},pre={collectionDefinitions:[{collectionGroupNumber:1,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:1},{collectionGroupNumber:1,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:1},{collectionGroupNumber:2,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:2},{collectionGroupNumber:2,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:2},{collectionGroupNumber:3,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:3},{collectionGroupNumber:3,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:3}],collectionGroups:[{groupNumber:1,groupName:"Day 1"},{groupNumber:2,groupName:"Day 2"},{groupNumber:3,groupName:"Day 3"}],tieFormatName:"LAVER_CUP",winCriteria:{valueGoal:13}},fre={collectionDefinitions:[{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Overtime",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"USTA_TOC",winCriteria:{aggregateValue:!0}},LP="COLLEGE_DEFAULT",mx="COLLEGE_JUCO",hx="COLLEGE_D3",mre="DOMINANT_DUO",hre="DOMINANT_DUO_MIXED",gre="LAVER_CUP",Ire="TEAM_DOUBLES_3_AGGREGATION",vre="TIME_TENNIS_DUAL",yre="TIME_TENNIS_PRO_CIRCUIT",bre="USTA_BREWER_CUP",wre="USTA_OZAKI_CUP",Sre="USTA_COLLEGE",Ure="USTA_GOLD_TEAM_CHALLENGE",Tre="USTA_LEVEL_1",Dre="USTA_INTERSECTIONAL",Pre="USTA_SECTION_BATTLE",Ere="USTA_SOUTHERN_LEVEL_5",Rre="USTA_TOC",Cre="USTA_WTT_ITT",Mre="USTA_ZONAL",hFe={COLLEGE_D3:hx,COLLEGE_DEFAULT:LP,COLLEGE_JUCO:mx,DOMINANT_DUO:mre,DOMINANT_DUO_MIXED:hre,LAVER_CUP:gre,TEAM_DOUBLES_3_AGGREGATION:Ire,TIME_TENNIS_DUAL:vre,TIME_TENNIS_PRO_CIRCUIT:yre,USTA_BREWER_CUP:bre,USTA_OZAKI_CUP:wre,USTA_COLLEGE:Sre,USTA_GOLD_TEAM_CHALLENGE:Ure,USTA_INTERSECTIONAL:Dre,USTA_LEVEL_1:Tre,USTA_SECTION_BATTLE:Pre,USTA_SOUTHERN_LEVEL_5:Ere,USTA_TOC:Rre,USTA_WTT_ITT:Cre,USTA_ZONAL:Mre},Nre="STANDARD",Wz={[Nre]:{hydrate:!0,doubles:{matchUpCount:3,matchUpValue:1},singles:{matchUpCount:6,matchUpValue:1},valueGoal:5},[hx]:{hydrate:!0,doubles:{matchUpFormat:"SET1-S:8/TB7@7",matchUpCount:3,matchUpValue:1},singles:{matchUpFormat:Vs,matchUpCount:6,matchUpValue:1},tieFormatName:hx,valueGoal:5},[LP]:{hydrate:!0,doubles:{matchUpFormat:"SET1-S:6/TB7",collectionValue:1,matchUpCount:3},singles:{matchUpFormat:Vs,matchUpCount:6,matchUpValue:1},tieFormatName:LP,valueGoal:4},[mx]:{hydrate:!0,doubles:{matchUpFormat:"SET1-S:8/TB7",matchUpCount:3,matchUpValue:1},singles:{matchUpFormat:Vs,matchUpCount:6,matchUpValue:1},tieFormatName:mx,valueGoal:5},[gre]:pre,[mre]:ore,[hre]:ire,[Ire]:Jie,[vre]:rre,[yre]:tre,[bre]:nre,[wre]:are,[Sre]:lre,[Ure]:Xie,[Dre]:ere,[Tre]:ure,[Pre]:Zie,[Ere]:Qie,[Cre]:cre,[Rre]:fre,[Mre]:dre},gFe=t=>{let e=t?.namedFormat&&Object.keys(Wz).includes(t.namedFormat)?t.namedFormat:Nre,i=Array.isArray(t?.uuids)?t?.uuids:[],r,{category:n,gender:a}=t?.event??{},s=Oe(Wz[e],!1,!0),o=l=>{if(!t?.isMock&&!t?.event?.isMock||!t.event)return i?.pop()??Ct();let u=t?.event?.eventId;return i.pop()??`${u}-COL-${l+1}`};return s.hydrate?(r={winCriteria:{valueGoal:s.valueGoal},collectionDefinitions:[{collectionId:o(0),matchUpFormat:sre,collectionName:"Doubles",matchUpType:Bt,...s.doubles},{collectionId:o(1),matchUpFormat:Vs,collectionName:"Singles",matchUpType:zt,...s.singles}]},s.tieFormatName&&(r.tieFormatName=s.tieFormatName)):(s.collectionDefinitions.forEach((l,u)=>l.collectionId=o(u)),r=s),t?.hydrateCollections&&r.collectionDefinitions.forEach(l=>{n&&!l.category&&(l.category=n),a&&!l.gender&&(l.gender=a)}),r},yc=gFe,pl="SINGLES",$m="SINGLES",fs="DOUBLES",bc="DOUBLES",ar="TEAM",Ua="TEAM",IFe="RATING",vFe="BOTH",yFe={AGE:"AGE",BOTH:vFe,DOUBLES:fs,DOUBLES_EVENT:bc,RATING:IFe,SINGLES:pl,SINGLES_EVENT:$m,TEAM_EVENT:Ua,TEAM:ar},Ae="MAIN",ze="QUALIFYING",tn="CONSOLATION",Rr="VOLUNTARY_CONSOLATION",Ti="PLAY_OFF",SM=[Ae,ze,tn,Ti,Rr],Bm={[ze]:1,[Ae]:2,[Ti]:3,[tn]:3,[Rr]:4},Are="finishingPositions",kre="aggregateEventStructures",Ore={[Ae]:1,[Ti]:2,[tn]:3,[ze]:4,[Rr]:5},bFe={[Ti]:1,[Ae]:2,[tn]:3,[ze]:4,[Rr]:5},sU="CLUSTER",UM="ADJACENT",xre="SEPARATE",Bp="WATERFALL",TM="ITEM",gn="CONTAINER",ho="DRAW",DM="RANDOM",As="TOP_DOWN",Vp="BOTTOM_UP",fu="POSITION",mu="WINNER",hu="LOSER",fl="FIRST_MATCHUP",la="AD_HOC",wFe="AD_HOC",Ov="FEED_IN",UI="COMPASS",TI="OLYMPIC",SFe="SINGLE_ELIMINATION",Jo="SINGLE_ELIMINATION",oU="DOUBLE_ELIMINATION",DI="FIRST_MATCH_LOSER_CONSOLATION",lU="FIRST_ROUND_LOSER_CONSOLATION",If="LUCKY_DRAW",PM="CURTIS_CONSOLATION",UFe="CURTIS_CONSOLATION",MB="FEED_IN_CHAMPIONSHIP_TO_SF",Wb="FEED_IN_CHAMPIONSHIP_TO_SF",NB="FEED_IN_CHAMPIONSHIP_TO_QF",zb="FEED_IN_CHAMPIONSHIP_TO_QF",AB="FEED_IN_CHAMPIONSHIP_TO_R16",qb="FEED_IN_CHAMPIONSHIP_TO_R16",Fre="MODIFIED_FEED_IN_CHAMPIONSHIP",Yb="MODIFIED_FEED_IN_CHAMPIONSHIP",uU="FEED_IN_CHAMPIONSHIP",TFe="DOUBLE_ROUND_ROBIN",eo="ROUND_ROBIN",gu="ROUND_ROBIN_WITH_PLAYOFF",Lre="DECIDER",_re="BACKDRAW",kB={0:{name:"East",abbreviation:"E"},"0-1":{name:"West",abbreviation:"W"},"0-2":{name:"North",abbreviation:"N"},"0-3":{name:"Northeast",abbreviation:"NE"},"0-1-1":{name:"South",abbreviation:"S"},"0-1-2":{name:"Southwest",abbreviation:"SW"},"0-2-1":{name:"Northwest",abbreviation:"NW"},"0-1-1-1":{name:"Southeast",abbreviation:"SE"}},OB={0:{name:"East",abbreviation:"E"},"0-1":{name:"West",abbreviation:"W"},"0-2":{name:"North",abbreviation:"N"},"0-1-1":{name:"South",abbreviation:"S"}},jp="WIN_RATIO",Fh="ROUND_OUTCOME",$re=[UI,PM,zb,qb,Wb,uU,NB,AB,MB,DI,lU,If,Yb,TI,Ti,gu],DFe=[la,UI,PM,oU,zb,qb,Wb,uU,Ov,DI,lU,If,Yb,TI,Ti,eo,gu,Jo],Bre={MAIN:Ae,QUALIFYING:ze,CONSOLATION:tn,ITEM:TM,CONTAINER:gn,FIRST_MATCHUP:fl,WINNER:mu,LOSER:hu,AD_HOC:la,FEED_IN:Ov,FLEX_ROUNDS:wFe,COMPASS:UI,PLAY_OFF:Ti,OLYMPIC:TI,KNOCKOUT:SFe,SINGLE_ELIMINATION:Jo,DOUBLE_ELIMINATION:oU,CURTIS:PM,FICSF:MB,FICQF:NB,FICR16:AB,MFIC:Fre,VOLUNTARY_CONSOLATION:Rr,FIRST_MATCH_LOSER_CONSOLATION:DI,FIRST_ROUND_LOSER_CONSOLATION:lU,MODIFIED_FEED_IN_CHAMPIONSHIP:Yb,FEED_IN_CHAMPIONSHIP_TO_R16:qb,FEED_IN_CHAMPIONSHIP_TO_QF:zb,FEED_IN_CHAMPIONSHIP_TO_SF:Wb,FEED_IN_CHAMPIONSHIP:uU,LUCKY_DRAW:If,ROUND_ROBIN_WITH_PLAYOFF:gu,ROUND_ROBIN:eo,DECIDER:Lre,BACKDRAW:_re,COMPASS_ATTRIBUTES:kB,OLYMPIC_ATTRIBUTES:OB,DRAW:ho,RANDOM:DM,TOP_DOWN:As,BOTTOM_UP:Vp,CLUSTER:sU,ADJACENT:UM,SEPARATE:xre,WATERFALL:Bp,WIN_RATIO:jp,ROUND_OUTCOME:Fh,MULTI_STRUCTURE_DRAWS:$re,generatedDrawTypes:DFe,stageOrder:Bm,finishOrder:Ore,AGGREGATE_EVENT_STRUCTURES:kre,FINISHING_POSITIONS:Are},PFe=Bre,pn="tournamentRecords",xB="policyDefinitions",hr="tournamentRecord",FB="onlineResource",In="drawDefinition",Vre="tieFormatName",LB="matchUpFormat",Iu="participantId",jre="scheduleDates",EFe="tournamentId",RFe="scheduleDate",CFe="roundNumber",EM="structureId",_B="participant",cU="matchUpIds",Gre="entryStage",MFe="policyType",Hre="structures",$B="eventType",Pl="matchUpId",RM="tieFormat",CM="inContext",MM="structure",NM="courtIds",NFe="personId",AM="venueIds",BB="matchUps",Wre="courtId",zre="eventId",Au="matchUp",qre="drawId",js="error",Bc="event",xv="param",VB="uuids",AFe="averageMatchUpMinutes",kFe="recoveryMinutes",OFe="periodLength",xFe="number",Kn="object",sn="array",qr="_validate",Yre="_message",Ba="_invalid",qn="_ofType",jB="_anyOf",PI="_oneOf",zz={[FB]:t=>Li(Object.keys(t),[xP,FP,SI]).length===3,[Vre]:t=>t&&yc({namedFormat:t}),[VB]:t=>!t||Array.isArray(t)&&t.every(ni),[RM]:t=>!Gn({tieFormat:t}).error,[$B]:t=>[pl,fs,ar].includes(t),[Gre]:t=>SM.includes(t)},FFe={[pn]:Mi,[hr]:ve,[xB]:aM,[In]:$e,[Iu]:dr,[LB]:Fte,[EFe]:II,[EM]:qa,[cU]:Ch,[_B]:Nh,[FB]:$c,[$B]:cu,[Hre]:Q$,[Pl]:Tn,[RM]:ql,[MM]:mf,[Wre]:Mh,[BB]:Nu,[zre]:ps,[Au]:aa,[NM]:Je,[AM]:Je,[qre]:xo,[Bc]:ui},LFe={[pn]:Kn,[xB]:Kn,[hr]:Kn,[In]:Kn,[FB]:Kn,[jre]:sn,[_B]:Kn,[cU]:sn,[Hre]:sn,[RM]:Kn,[MM]:Kn,[NM]:sn,[AM]:sn,[BB]:sn,[Au]:Kn,[Bc]:Kn,[VB]:sn};function He(t,e,i){if(!t&&!wt(t))return{error:re};if(!e?.length||t?._bypassParamCheck)return{valid:!0};if(!Array.isArray(e))return{error:re};let{paramError:r,errorParam:n}=BFe(t,e);if(!r)return{valid:!0};let a=r[qr]&&(r[js]||r[Ba])||t?.[n]===void 0&&(r[js]||r[Ba]||FFe[n]||re)||re,s=n??(r[PI]&&Object.keys(r[PI]).join(", "));return q({info:{param:s,message:r[Yre]},result:{error:a},stack:i})}function Kre(t,e){let i=Object.keys(t),r=Object.keys(e);return Li(i,r)}function _Fe(t,e){if(!e)return;let i=Kre(t,e);return i.length!==1?{error:re}:i.reduce((r,n)=>({...r,[n]:!0}),{})}function $Fe(t,e){if(!e)return;let i=Kre(t,e).filter(r=>t[r]);return i.length<1?{error:re}:i.reduce((r,n)=>({...r,[n]:!0}),{})}function BFe(t,e){let i,r;return{paramError:e.find(({_ofType:n,_oneOf:a,_anyOf:s,_validate:o,_info:l,...u})=>{let c=a&&_Fe(t,a);if(c?.error)return c.error;c&&Object.assign(u,c);let d=s&&$Fe(t,s);if(d?.error)return d.error;d&&Object.assign(u,d);let p=Object.keys(u).filter(m=>typeof u[m]=="boolean"),f=p.find(m=>{let h=o&&!fa(o),g=t[m]!==void 0&&!o&&VFe(t,m,n),I=u[m]&&[void 0,null].includes(t[m]),v=h||g||I||o&&t[m]!==void 0&&!jFe(t[m],o)||zz[m]&&!zz[m](t[m]);return v&&(i=m,r=l),v});return!p.length||f}),errorParam:i,paramInfo:r}}function VFe(t,e,i){return i=i||LFe[e]||"string",i==="array"?!Array.isArray(t[e]):typeof t[e]!==i}function jFe(t,e){return fa(e)?e(t):!0}var GB="DYNAMIC",vu="RANKING",ld="RATING",Sd="SCALE",Yl="SEEDING",GFe={RANKING:vu,RATING:ld,SCALE:Sd,SEEDING:Yl};function Fv(t){let e=He(t,[{[_B]:!0}]);if(e.error)return e;let i=t.participant.timeItems?.filter(({itemType:n})=>n?.startsWith(Sd)&&[vu,ld,Yl].includes(n.split(".")[1])),r={ratings:{},rankings:{},seedings:{}};if(i?.length){let n=s=>i.filter(o=>o?.itemType===s).sort((o,l)=>new Date(o.createdAt||void 0).getTime()-new Date(l.createdAt||void 0).getTime()).pop(),a=nt(i.map(({itemType:s})=>s));for(let s of a){let o=n(s);if(o){let[,l,u,c,d]=o.itemType.split("."),p=d?`${c}.${d}`:c,f=l===Yl&&"seedings"||l===vu&&"rankings"||"ratings";r[f][u]||(r[f][u]=[]),r[f][u].push({scaleValue:o.itemValue,scaleDate:o.itemDate,scaleName:p})}}}return{...W,...r}}function Vm(t){if(t===null)return{};let{source:e,template:i}=t||{};if(!i)return e;let r={};return n(e,i,r),r;function n(a,s,o){if(!a||!s)return;let l=Object.keys(a),u=Object.keys(s),c=Object.assign({},...u.filter(f=>f.indexOf("||")).map(f=>f.split("||").map(m=>({[m]:f}))).flat()),d=u.concat(...Object.keys(c)),p=d.includes("*");for(let f of l)if(d.indexOf(f)>=0||p){let m=c[f]||f,h=s[m]||p,g=a[f];if(typeof h=="object"&&typeof g!="function"&&!Array.isArray(h))if(Array.isArray(g)){let I=g.map(v=>{let w={};return n(v,h,w)!==!1?w:void 0}).filter(Boolean);o[f]=I}else g&&(o[f]={},n(g,h,o[f]));else{let I=a[f];if(Array.isArray(h)&&!h.includes(I))return!1;(s[f]||p&&s[f]!==!1)&&(o[f]=I)}}}}var gx="voluntaryConsolation",qu="competitiveBands",HB="roundRobinTally",yu="positionActions",Cr="matchUpActions",cD="rankingPoints",wc="roundNaming",Lv="participant",Kb="progression",qd="scheduling",Xb="avoidance",HFe="participant",WFe="display",ms="scoring",Rs="seeding",EI="feedIn",zFe="audit",_P="draws",qFe={POLICY_TYPE_VOLUNTARY_CONSOLATION:gx,POLICY_TYPE_COMPETITIVE_BANDS:qu,POLICY_TYPE_ROUND_ROBIN_TALLY:HB,POLICY_TYPE_POSITION_ACTIONS:yu,POLICY_TYPE_MATCHUP_ACTIONS:Cr,POLICY_TYPE_RANKING_POINTS:cD,POLICY_TYPE_ROUND_NAMING:wc,POLICY_TYPE_PARTICIPANT:Lv,POLICY_TYPE_PROGRESSION:Kb,POLICY_TYPE_SCHEDULING:qd,POLICY_TYPE_AVOIDANCE:Xb,POLICY_TYPE_DISPLAY:WFe,POLICY_TYPE_PRIVACY:HFe,POLICY_TYPE_FEED_IN:EI,POLICY_TYPE_SCORING:ms,POLICY_TYPE_SEEDING:Rs,POLICY_TYPE_AUDIT:zFe,POLICY_TYPE_DRAWS:_P};function Ud({tournamentParticipants:t=[],policyDefinitions:e={},contextProfile:i,participantId:r,internalUse:n,personId:a}){let s=t.find(l=>r&&l.participantId===r||a&&l.person&&l.person.personId===a),o=Oe(s,!1,n);if(o){let l=e?.[Lv];if(i?.withScaleValues){let{ratings:u,rankings:c}=Fv({participant:o});o.rankings=c,o.ratings=u}if(l?.participant)return Vm({template:l.participant,source:o})}return o}var YFe="element required",KFe="missing name";function Nn(t){if(!t||typeof t!="object")return{error:Je};if(t.element&&typeof t?.element!="object")return{error:re};if(!t?.name)return{error:Je,info:KFe};if(!t?.element){if(t.discover&&t.tournamentRecords){for(let e of Object.keys(t.tournamentRecords)){let i=t.tournamentRecords[e],r=Nn({element:i,name:t.name});if(r.error)return q({result:r,stack:"removeExtension"})}return{...W}}return{error:Je,info:YFe}}return t?.element.extensions?(t.element.extensions=t.element.extensions.filter(e=>e?.name!==t.name),{...W}):{...W,info:Br}}function ml({requiredAttributes:t=["name","value"],extension:e}){if(!e||typeof e!="object"||typeof e.name!="string")return!1;let i=Object.keys(e);return t.filter(r=>i.includes(r)).length===t.length}function Ft(t){if(typeof t!="object")return{error:Je};let e="addExtension";if(t?.element&&typeof t.element!="object")return q({result:{error:re},stack:e});if(!ml({extension:t.extension}))return q({result:{error:re,info:"invalid extension"},stack:e});if(!t.element)if(t.discover&&!t.tournamentId&&t.tournamentRecords){for(let r of Object.values(t.tournamentRecords)){let n=Ft({extension:t.extension,element:r});if(n.error)return q({result:n,stack:e})}return{...W}}else return q({result:{error:Je},stack:e});if(t.element.extensions||(t.element.extensions=[]),t?.creationTime??!0){let r=new Date().toISOString();Object.assign(t.extension,{createdAt:r})}let i=t.element.extensions.find(({name:r})=>r===t.extension.name);return i?i.value=t.extension.value:t.extension.value&&t.element.extensions.push(t.extension),{...W}}function WB(t){return!t||typeof t!="object"?{error:Je}:t.tournamentRecord?Ft({creationTime:t.creationTime,element:t.tournamentRecord,extension:t.extension}):{error:ve}}function kM(t){return!t||typeof t!="object"?{error:Je}:t.drawDefinition?Ft({creationTime:t.creationTime,element:t.drawDefinition,extension:t.extension}):{error:_a}}function Yd(t){return!t||typeof t!="object"?{error:Je}:t.event?Ft({creationTime:t.creationTime,extension:t.extension,element:t.event}):{error:ps}}function Xre(t){if(!t||typeof t!="object")return{error:Je};if(!t.participantId)return{error:dr};let e=t.tournamentRecord?.participants||[],i=Ud({participantId:t.participantId,tournamentParticipants:e});return i?Ft({creationTime:t.creationTime,extension:t.extension,element:i}):{error:ji}}function zB(t){return!t||typeof t!="object"?{error:Je}:t.tournamentRecord?Nn({element:t.tournamentRecord,name:t.name}):{error:ve}}function Jre(t){return!t||typeof t!="object"?{error:Je}:t.drawDefinition?Nn({element:t.drawDefinition,name:t.name}):{error:_a}}function OM(t){return!t||typeof t!="object"?{error:Je}:t?.event?Nn({element:t.event,name:t.name}):{error:ps}}function Qre(t){if(!t||typeof t!="object")return{error:Je};if(!t.participantId)return{error:dr};let e=t.tournamentRecord?.participants||[],i=Ud({participantId:t.participantId,tournamentParticipants:e});return i?Nn({element:i,name:t.name}):{error:ji}}function dU({tournamentRecords:t}){return{tournamentIds:wt(t)?Object.keys(t):[],...W}}var XFe="extensionQueries";function ht({discover:t,element:e,name:i,...r}){if(!e||!i){if(t&&r){let a=Object.keys(r).filter(l=>typeof t=="boolean"||Array.isArray(t)&&t.includes(l)).find(l=>Array.isArray(r[l]?.extensions)?r[l].extensions.find(u=>u?.name===i):!1),s=a&&r[a];!s&&r.tournamentRecords&&(s=Object.values(r.tournamentRecords).find(l=>l.extensions?.length));let o=s?.extensions?.find(l=>l?.name===i);return{extension:o,info:o?void 0:Br}}return q({result:{error:Je},stack:XFe})}if(!Array.isArray(e.extensions))return{info:"no extensions"};let n=e.extensions.find(a=>a?.name===i);return{extension:n,info:n?void 0:Br}}var JFe="activeSuspension",Jb="appliedPolicies",Zre="context",xM="delegatedOutcome",bo="disabled",jm="disableAutoCalc",FM="disableLinks",$P="display",Ip="drawDeletions",QFe="drawProfile",BP="entryProfile",ZFe="eventProfile",eLe="eventWithdrawalRequests",tLe="factory",to="flightProfile",Ix="groupingAttribute",Sc="lineUps",Gp="linkedTournamentsIds",qB="participantRepresentatives",_v="personRequests",Bg="positionActions",iLe="rankingPoints",rLe="registration",El="roundTarget",pU="scheduleLimits",Uc="scheduleTiming",Gm="schedulingProfile",nLe="statusDetail",RI="subOrder",Tc="tally",Wy="tieFormatModification",ene={ACTIVE_SUSPENSION:JFe,APPLIED_POLICIES:Jb,CONTEXT:Zre,DELEGATED_OUTCOME:xM,DISABLED:bo,DISABLE_LINKS:FM,DISABLE_AUTO_CALC:jm,DISPLAY:$P,DRAW_DELETIONS:Ip,DRAW_PROFILE:QFe,ENTRY_PROFILE:BP,EVENT_PROFILE:ZFe,EVENT_WITHDRAWAL_REQUESTS:eLe,FLIGHT_PROFILE:to,GROUPING_ATTRIBUTE:Ix,LINEUPS:Sc,LINKED_TOURNAMENTS:Gp,PARTICIPANT_REPRESENTATIVES:qB,PERSON_REQUESTS:_v,POSITION_ACTIONS:Bg,RANKING_POINTS:iLe,REGISTRATION:rLe,ROUND_TARGET:El,SCHEDULE_LIMITS:pU,SCHEDULE_TIMING:Uc,SCHEDULING_PROFILE:Gm,STATUS_DETAIL:nLe,SUB_ORDER:RI,TALLY:Tc,TIE_FORMAT_MODIFICATIONS:Wy,FACTORY:tLe},qz=[xM,bo,jm,FM,to,Sc,Gp,qB,_v,El,pU,Uc,Gm,RI,Tc,Wy];function tne({tournamentRecords:t}){if(typeof t!="object"||!Object.keys(t).length)return{error:Mi};let e=dU({tournamentRecords:t}),{tournamentIds:i}=e;return i?.length>1?Ft({tournamentRecords:t,discover:!0,extension:{name:Gp,value:{tournamentIds:i}}}):{...W}}function ine({tournamentRecords:t}){if(typeof t!="object"||!Object.keys(t).length)return{error:Mi};let e=Nn({name:Gp,tournamentRecords:t,discover:!0});return q({result:e,stack:"unlinkTournaments"})}function rne({tournamentRecords:t,tournamentId:e}){if(typeof t!="object")return{error:re};if(!e)return{error:II};let i=dU({tournamentRecords:t}),{tournamentIds:r}=i;if(!r.includes(e))return{error:II};let n;return r.every(a=>{let s=t[a],{extension:o}=ht({element:s,name:Gp});if(!o)return!0;let l=o?.value?.tournamentIds||[];if(!l?.length||l.length===1&&l.includes(e)||a===e){let d=zB({name:Gp,tournamentRecord:s});return d.error&&(n=d.error),d.success}let u=l.filter(d=>d!==e);o.value={tournamentIds:u};let c=WB({tournamentRecord:s,extension:o});return c.error&&(n=c.error),c.success}),n?{error:n}:{...W}}var nne={};dt(nne,{getLinkedTournamentIds:()=>fU,getTournamentIds:()=>dU});function fU({tournamentRecords:t}){return typeof t!="object"||!Object.keys(t).length?{error:Mi}:{linkedTournamentIds:Object.assign({},...Object.keys(t).map(e=>{let i=t[e],r=i?.tournamentId,{extension:n}=ht({element:i,name:Gp}),a=(n?.value?.tournamentIds||[]).filter(s=>s!==r);return{[e]:a}}))}}var ane={};dt(ane,{adHocPositionSwap:()=>Ise,addAdHocMatchUps:()=>dN,addDrawDefinitionTimeItem:()=>eV,addFinishingRounds:()=>CU,addGoesTo:()=>Wp,addPlayoffStructures:()=>cN,addQualifyingStructure:()=>gse,addVoluntaryConsolationStage:()=>use,addVoluntaryConsolationStructure:()=>V2,allPlayoffPositionsFilled:()=>J2,alternateDrawPositionAssignment:()=>Kae,assignDrawPosition:()=>kse,assignDrawPositionBye:()=>Ja,attachConsolationStructures:()=>Cse,attachPlayoffStructures:()=>mV,attachQualifyingStructure:()=>Z2,attachStructures:()=>uN,autoSeeding:()=>XGe,automatedPlayoffPositioning:()=>qv,automatedPositioning:()=>$U,buildDrawHierarchy:()=>YGe,checkValidEntries:()=>hN,deleteAdHocMatchUps:()=>xse,drawMatic:()=>JV,findDrawDefinition:()=>yV,generateAdHocMatchUps:()=>gN,generateAdHocRounds:()=>XV,generateAndPopulatePlayoffStructures:()=>pV,generateDrawDefinition:()=>iT,generateDrawMaticRound:()=>EV,generateDrawStructuresAndLinks:()=>TV,generateDrawTypeAndModifyDrawDefinition:()=>DV,generateQualifyingStructure:()=>sV,generateVoluntaryConsolation:()=>foe,getAssignedParticipantIds:()=>Df,getAvailableMatchUpsCount:()=>pN,getAvailablePlayoffProfiles:()=>jU,getDrawDefinitionTimeItem:()=>f2,getDrawParticipantRepresentativeIds:()=>IV,getDrawStructures:()=>io,getDrawTypeCoercion:()=>KU,getEligibleVoluntaryConsolationParticipants:()=>gV,getMatchUpsMap:()=>kr,getParticipantIdFinishingPositions:()=>vV,getPositionAssignments:()=>AI,getPositionsPlayedOff:()=>Yv,getRandomQualifierList:()=>SV,getSeedingThresholds:()=>W2,getSeedsCount:()=>XU,getStructureSeedAssignments:()=>hs,getTeamLineUp:()=>Hp,getValidGroupSizes:()=>LU,isAdHoc:()=>Hn,isCompletedStructure:()=>Su,isValidForQualifying:()=>UV,luckyLoserDrawPositionAssignment:()=>Gae,modifyDrawDefinition:()=>Mse,modifyDrawName:()=>hV,modifySeedAssignment:()=>ise,mutate:()=>sne,positionActions:()=>wV,pruneDrawDefinition:()=>Ase,qualifierDrawPositionAssignment:()=>Q2,qualifierProgression:()=>rse,query:()=>_se,removeDrawPositionAssignment:()=>iw,removeRoundMatchUps:()=>Fse,removeSeededParticipant:()=>hse,removeStructure:()=>ose,renameStructures:()=>sse,resetDrawDefinition:()=>Nse,resetQualifyingStructure:()=>cse,resetVoluntaryConsolationStructure:()=>Sne,setDrawParticipantRepresentativeIds:()=>one,setPositionAssignments:()=>qae,setStructureOrder:()=>nse,setSubOrder:()=>Lse,shiftAdHocRounds:()=>zae,swapAdHocRounds:()=>Yae,swapDrawPositionAssignments:()=>fse,updateTeamLineUp:()=>Kh,withdrawParticipantAtDrawPosition:()=>xae});var sne={};dt(sne,{adHocPositionSwap:()=>Ise,addAdHocMatchUps:()=>dN,addDrawDefinitionTimeItem:()=>eV,addPlayoffStructures:()=>cN,addQualifyingStructure:()=>gse,addVoluntaryConsolationStage:()=>use,addVoluntaryConsolationStructure:()=>V2,alternateDrawPositionAssignment:()=>Kae,assignDrawPosition:()=>kse,assignDrawPositionBye:()=>Ja,attachConsolationStructures:()=>Cse,attachPlayoffStructures:()=>mV,attachQualifyingStructure:()=>Z2,attachStructures:()=>uN,automatedPlayoffPositioning:()=>qv,automatedPositioning:()=>$U,deleteAdHocMatchUps:()=>xse,luckyLoserDrawPositionAssignment:()=>Gae,modifyDrawDefinition:()=>Mse,modifyDrawName:()=>hV,modifySeedAssignment:()=>ise,pruneDrawDefinition:()=>Ase,qualifierDrawPositionAssignment:()=>Q2,qualifierProgression:()=>rse,removeDrawPositionAssignment:()=>iw,removeRoundMatchUps:()=>Fse,removeSeededParticipant:()=>hse,removeStructure:()=>ose,renameStructures:()=>sse,resetDrawDefinition:()=>Nse,resetQualifyingStructure:()=>cse,resetVoluntaryConsolationStructure:()=>Sne,setDrawParticipantRepresentativeIds:()=>one,setPositionAssignments:()=>qae,setStructureOrder:()=>nse,setSubOrder:()=>Lse,shiftAdHocRounds:()=>zae,swapAdHocRounds:()=>Yae,swapDrawPositionAssignments:()=>fse,updateTeamLineUp:()=>Kh,withdrawParticipantAtDrawPosition:()=>xae});var YB=t=>e=>t[e],KB=(t=[])=>t.map(vr).filter(Boolean),vx=(t=[])=>t.map(yt).filter(Boolean),yt=(t={})=>YB(t)("participantId"),vr=(t={})=>YB(t)("matchUpId"),Qb=(t={})=>YB(t)("drawId");function one({representativeParticipantIds:t,drawDefinition:e}){if(!e)return{error:_a};if(!Array.isArray(t))return{error:re};let i=vx(e?.entries||[]);return t.length&&Li(t,i).length<t.length?{error:re}:kM({drawDefinition:e,extension:{name:qB,value:t}})}var Ta="ABANDONED",Lh="AWAITING_RESULT",Rl="CANCELLED",Oi="COMPLETED",$v="DEAD_RUBBER",qt="DEFAULTED",Wi="DOUBLE_DEFAULT",Si="DOUBLE_WALKOVER",lo="IN_PROGRESS",Da="INCOMPLETE",XB="NOT_PLAYED",Sr="RETIRED",Kd="SUSPENDED",_i="TO_BE_PLAYED",ai="WALKOVER",aLe=[Lh,Oi,qt,lo,Da,Sr,Kd],lne=[Lh,Oi,qt,Si,Wi,lo,Da,Sr,Kd,ai],une=[Ta,Lh,"BYE",Rl,Oi,$v,qt,Si,Wi,lo,Da,XB,Sr,Kd,_i,ai],cne=["BYE",Si,Wi,Oi,qt,Sr,ai],dne=[Ta,Lh,Rl,$v,lo,Da,XB,Kd,_i,void 0],Ki=[Rl,Ta,Oi,$v,qt,Si,Wi,Sr,ai],JB=[Ta,Oi,qt,Si,Wi,lo,Sr,ai],pne=[lo,Da,Kd,_i],LM={ABANDONED:Ta,AWAITING_RESULT:Lh,BYE:"BYE",CANCELLED:Rl,COMPLETED:Oi,DEAD_RUBBER:$v,DEFAULTED:qt,DOUBLE_WALKOVER:Si,DOUBLE_DEFAULT:Wi,IN_PROGRESS:lo,INCOMPLETE:Da,NOT_PLAYED:XB,RETIRED:Sr,SUSPENDED:Kd,TO_BE_PLAYED:_i,WALKOVER:ai};function _h(t,e,i){let r=d=>ht({element:d,name:El})?.extension?.value,n=i?.deprioritizeCompleted,a=i?.mode===kre&&bFe,s=i?.mode===Are&&Ore,o=s||a||Bm,l=d=>d?.stage===Ae&&d?.stageSequence===1,u=d=>l(d)?-1:o[d?.stage],c=d=>d?.matchUps.every(({matchUpStatus:p})=>Ki.includes(p)?1:-1);return n&&c(t)-c(e)||a&&u(t)-u(e)||(t?.stage&&o[t.stage]||0)-(e?.stage&&o[e.stage]||0)||(r(t)||0)-(r(e)||0)||!s&&!a&&(e?.positionAssignments?.length??1/0)-(t?.positionAssignments?.length??1/0)||(t?.stageSequence??0)-(e?.stageSequence??0)||(VP(t)||0)-(VP(e)||0)}function VP(t){return(t?.matchUps||[]).reduce((e,i)=>{let r=(i.finishingPositionRange?.winner||[]).reduce((n,a)=>n+a,0);return!e||r<e?r:e},void 0)}function tt(t){let e=He(t,[{[In]:!0,[EM]:!0}]);if(e.error)return e;let{drawDefinition:i,structureId:r}=t,{structures:n}=io({drawDefinition:i}),a=n?.flatMap(l=>l.structures?[...l.structures].concat(l):l),s=a?.find(l=>l.structureId===r);if(!s)return{error:vi};let o=s.structureType===TM?a?.find(l=>l.structures?.some(u=>u.structureId===r)):void 0;return{structure:s,containingStructure:o}}function io({withStageGrouping:t,drawDefinition:e,stageSequences:i,stageSequence:r,roundTarget:n,sortConfig:a,stages:s,stage:o}){let l=!e&&$e||!e?.structures&&Q$||void 0;if(l)return{error:l,structures:[],stageStructures:{}};let u=m=>{let h=ht({element:m,name:El})?.extension?.value;return!n||n===h},c=e?.structures?.filter(p).filter(f).filter(u).sort((m,h)=>_h(m,h,a))??[],d=t?Object.assign({},...SM.map(m=>{let h=c?.filter(g=>g.stage===m);return h?.length&&{[m]:h}}).filter(Boolean)):{};return{structures:c,stageStructures:d};function p(m){return!o&&!Array.isArray(s)||o&&m.stage===o||Array.isArray(s)&&s.includes(m.stage)}function f(m){return!r&&!Array.isArray(i)||r&&m.stageSequence===r||Array.isArray(i)&&i.includes(m.stageSequence)}}function fne({drawDefinition:t}){if(!t)return{error:$e};let e={};return{allPositionedParticipantIds:(t.structures||[]).map(i=>{let r=i.stage;e[r]||(e[r]=[]);let{positionAssignments:n}=Kt({structure:i}),a=n?.map(yt).filter(Boolean)??[];return e[r].push(...a),a}).flat(),stagePositionedParticipantIds:e}}function Kt({drawDefinition:t,structureId:e,structure:i}){let r,n=[];if(!i){if(!t)return{positionAssignments:n,error:$e};if({structure:i,error:r}=tt({drawDefinition:t,structureId:e}),r)return{positionAssignments:n,error:r}}return i.structures?n=[].concat(...i.structures.map(a=>Kt({structure:a}).positionAssignments)):i.positionAssignments?n=i.positionAssignments:r=kte,{positionAssignments:n,error:r}}function pr({drawDefinition:t,structureId:e,structure:i}){let r=Kt({drawDefinition:t,structureId:e,structure:i})?.positionAssignments||[],n=r?.filter(u=>u.participantId??u.bye??u.qualifier),a=r&&r?.length===n?.length,s=r?.filter(u=>!u.participantId&&!u.bye&&!u.qualifier),o=r?.filter(u=>!u.participantId&&u.bye),l=r?.filter(u=>!u.participantId&&u.qualifier);return{allPositionsAssigned:a,positionAssignments:r,unassignedPositions:s,assignedPositions:n,qualifierPositions:l,byePositions:o}}var QB="addDrawDefinition",_M="addMatchUps",Td="addParticipants",ZB="addScaleItems",mne="addEvent",hne="addVenue",Zu="audit",e2="dataIssue",t2="deleteParticipants",i2="deleteVenue",r2="deletedDrawIds",n2="deletedMatchUpIds",a2="modifyDrawDefinition",gne="modifyDrawEntries",Ine="modifyEventEntries",s2="modifyMatchUp",rn="modifyParticipants",o2="modifyPositionAssignments",l2="modifySeedAssignments",vf="modifyTournamentDetail",Vc="modifyVenue",yx="mutations",bx="publishEvent",vne="publishEventSeeding",yne="publishOrderOfPlay",bne="publishParticipants",u2="unPublishEvent",c2="unPublishEventSeeding",d2="unPublishOrderOfPlay",sLe="unPublishParticipants",$M="updateInContextMatchUp",oLe={ADD_DRAW_DEFINITION:QB,ADD_MATCHUPS:_M,ADD_PARTICIPANTS:Td,ADD_SCALE_ITEMS:ZB,ADD_EVENT:mne,ADD_VENUE:hne,AUDIT:Zu,DATA_ISSUE:e2,DELETE_PARTICIPANTS:t2,DELETE_VENUE:i2,DELETED_DRAW_IDS:r2,DELETED_MATCHUP_IDS:n2,MODIFY_DRAW_DEFINITION:a2,MODIFY_DRAW_ENTRIES:gne,MODIFY_EVENT_ENTRIES:Ine,MODIFY_MATCHUP:s2,MODIFY_PARTICIPANTS:rn,MODIFY_POSITION_ASSIGNMENTS:o2,MODIFY_SEED_ASSIGNMENTS:l2,MODIFY_TOURNAMENT_DETAIL:vf,MODIFY_VENUE:Vc,MUTATIONS:yx,PUBLISH_EVENT_SEEDING:vne,PUBLISH_EVENT:bx,PUBLISH_ORDER_OF_PLAY:yne,PUBLISH_PARTICIPANTS:bne,UNPUBLISH_EVENT_SEEDING:c2,UNPUBLISH_EVENT:u2,UNPUBLISH_ORDER_OF_PLAY:d2,UPDATE_INCONTEXT_MATCHUP:$M};function BM(t,e){if(!t)return{error:$e};let i=Date.now();t.updatedAt&&i===new Date(t.updatedAt).getTime()&&(i+=1);let r=new Date(i).toISOString(),n=e?.filter(Boolean);return t.updatedAt=r,t.structures?.filter(Boolean).forEach(a=>{(!n?.length||n?.includes(a.structureId))&&(a.updatedAt=r)}),{...W}}function Dd({drawDefinition:t,tournamentId:e,matchUps:i,eventId:r}){return t&&BM(t),st({payload:{matchUps:i,tournamentId:e,eventId:r},topic:_M}),{...W}}function ku({drawDefinition:t,tournamentId:e,matchUpIds:i,eventId:r,action:n}){t&&BM(t),st({topic:n2,payload:{tournamentId:e,matchUpIds:i,eventId:r,action:n}});for(let a of i)wB({key:a});return{...W}}function Ut({drawDefinition:t,tournamentId:e,structureId:i,context:r,eventId:n,matchUp:a}){return a?(t&&ii({drawDefinition:t,structureIds:i?[i]:void 0,tournamentId:e,eventId:n}),st({topic:s2,payload:{matchUp:a,tournamentId:e,context:r},key:a.matchUpId}),{...W}):(console.log(aa),{error:aa})}function lLe({tournamentId:t,inContextMatchUp:e}){return e?(st({payload:{inContextMatchUp:e,tournamentId:t},topic:$M,key:e.matchUpId}),{...W}):{error:aa}}function mU({tournamentId:t,eventId:e,drawDefinition:i}){return i?(BM(i),st({payload:{drawDefinition:i,tournamentId:t,eventId:e},topic:QB,key:i.drawId}),{...W}):(console.log($e),{error:$e})}function uLe({tournamentId:t,eventId:e,drawId:i}){return st({payload:{drawId:i,tournamentId:t,eventId:e},topic:r2,key:i}),wB({key:i}),{...W}}function ii({drawDefinition:t,tournamentId:e,structureIds:i,eventId:r}){return t?(BM(t,i),st({payload:{tournamentId:e,eventId:r,drawDefinition:t},topic:a2,key:t.drawId}),{...W}):{error:$e}}function wne({drawDefinition:t,tournamentId:e,structure:i,eventId:r}){if(!t)return{error:$e};if(!i)return{error:mf};let n=i.seedAssignments,a=i.structureId,s=t.drawId;return st({payload:{tournamentId:e,eventId:r,drawId:s,structureId:a,seedAssignments:n},topic:l2,key:t.drawId}),ii({structureIds:[a],drawDefinition:t,tournamentId:e,eventId:r}),{...W}}function Dc({drawDefinition:t,tournamentId:e,structure:i,event:r}){if(!t)return{error:$e};if(!i)return{error:mf};let n=Kt({structure:i}),a=i.structureId,s=t.drawId,o=r?.eventId;return st({topic:o2,payload:{positionAssignments:n,tournamentId:e,structureId:a,eventId:o,drawId:s},key:a}),ii({structureIds:[a],drawDefinition:t,tournamentId:e,eventId:o}),{...W}}function Sne({tournamentRecord:t,drawDefinition:e,resetEntries:i,event:r}){if(!e)return{error:$e};let n=e.structures?.find(s=>s.stage===Rr);if(!n)return{error:vi};let a=n.matchUps?.map(({matchUpId:s})=>s)||[];return n.positionAssignments=[],n.seedAssignments=[],n.matchUps=[],ku({tournamentId:t?.tournamentId,action:"resetVoluntaryConsolationStructure",matchUpIds:a,drawDefinition:e}),i&&(e.entries=e.entries.filter(s=>s.entryStage!==Rr)),ii({tournamentId:t?.tournamentId,eventId:r?.eventId,drawDefinition:e,structureIds:[n.structureId]}),{...W}}function p2({drawPositions:t,structure:e}){if([ze,Ae].includes(e.stage)&&e.stageSequence===1)return;let{positionAssignments:i}=Kt({structure:e});i?.filter(({drawPosition:r})=>t?.includes(r))?.forEach(r=>{Ft({element:r,extension:{name:FM,value:!0}})})}function hU(t){let{appliedPolicies:e,positionAction:i,drawDefinition:r}=t;if(e?.audit?.[Bg]===!1)return;let{extension:n}=ht({name:Bg,element:r}),a=Array.isArray(n?.value)?n?.value??[]:[];if(!a?.length){let o=r.structures.find(l=>l.stage===Ae);if(o){let l=Kt({structure:o}).positionAssignments?.map(({drawPosition:u,participantId:c,bye:d,qualifier:p})=>({drawPosition:u,participantId:c,qualifier:p,bye:d}));a.push({name:"initialMainAssignments",initialAssignments:l})}}let s={value:a.concat(i),name:Bg};Ft({element:r,extension:s})}function Bv({tournamentRecord:t,drawDefinition:e,event:i}){let r=(t?.events||i&&[i])?.map(o=>o?.drawDefinitions).flat().filter(Boolean)||e&&[e]||[],n={},a={},s=r.map(o=>o?.structures?.filter(l=>l?.structures)).flat().filter(Boolean);for(let o of s){let{structures:l,structureId:u}=o??{};l&&u&&(n[u]=l?.map(c=>c.structureId))&&l.forEach(c=>a[c.structureId]=o?.structureId)}return{containedStructures:n,containerStructures:a}}function VM(t){let{sides:e,matchUpType:i}=t||{},r=t.potentialParticipants?.length?t.potentialParticipants.flat().map(a=>i===Bt?a?.individualParticipantIds||[]:a.participantId).flat():[],n=(e||[]).map(a=>i===Bt&&(a?.participant?.individualParticipantIds||[])||a?.participantId&&[a.participantId]||[]).flat();return{individualParticipantIds:n.concat(r).flat(),enteredIndividualParticipantIds:n,potentialIndividualParticipantIds:r}}function ws(t){return t?.tournamentRecords??(t?.tournamentRecord&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord})??{}}var gU="SIGN_IN_STATUS",Une="SIGNED_OUT",Zb="SIGNED_IN",$n="TEAM",It="INDIVIDUAL",Ya="GROUP",ft="PAIR",_t="TEAM",zy={TEAM_PARTICIPANT:$n,INDIVIDUAL:It,GROUP:Ya,TEAM:_t,PAIR:ft},cLe={INDIVIDUAL:It,GROUP:Ya,PAIR:ft,TEAM:_t,SIGN_IN_STATUS:gU,SIGNED_OUT:Une,SIGNED_IN:Zb};function jM({participantsProfile:t,participants:e=[],deepCopy:i}){let r=new Map,n=i!==!1?Oe(e,t?.convertExtensions,!0):e,a=n.filter(l=>l.participantType===_t),s=n.filter(l=>l.participantType===Ya),o=n.filter(l=>l.participantType===ft);return n.forEach(l=>{if(l.participantType===It){let{participantId:u}=l;l.groupParticipantIds=[],l.teamParticipantIds=[],l.pairParticipantIds=[],l.groups=[],l.teams=[],a.forEach(c=>{(c?.individualParticipantIds||[]).forEach(d=>{d===u&&!l.teamParticipantIds?.includes(c.participantId)&&(l.teamParticipantIds.push(c.participantId),r.get(c.participantId)||r.set(c.participantId,{participantName:c.participantName,participantId:c.participantId}),l.teams.push({participantRoleResponsibilities:c.participantRoleResponsibilities,participantOtherName:c.participantOtherName,participantName:c.participantName,participantId:c.participantId,teamId:c.teamId}))})}),o.forEach(c=>{(c?.individualParticipantIds||[]).forEach(d=>{d===u&&!l.pairParticipantIds.includes(c.participantId)&&l.pairParticipantIds.push(c.participantId)})}),s.forEach(c=>{(c?.individualParticipantIds||[]).forEach(d=>{d===u&&!l.groupParticipantIds.includes(c.participantId)&&(l.groupParticipantIds.push(c.participantId),l.groups.push({participantRoleResponsibilities:c.participantRoleResponsibilities,participantOtherName:c.participantOtherName,participantName:c.participantName,participantId:c.participantId}))})})}}),{participantsWithGroupings:n,groupInfo:Object.fromEntries(r)}}function Tne(t){return t&&typeof String.fromCodePoint<"u"?t.toUpperCase().replace(/./g,e=>String.fromCodePoint(e.charCodeAt(0)+127397)):t}function dLe(t){let e=Object.assign({},...ud.filter(i=>i.ioc).map(i=>({[i.ioc]:i.iso})));return Tne(e[t])}var ud=[{ioc:"",iso2:"",iso:"",label:"NONE",phone:""},{ioc:"AND",iso2:"AD",iso:"AND",label:"Andorra",phone:"376"},{ioc:"UAE",iso2:"AE",iso:"ARE",label:"United Arab Emirates",phone:"971"},{ioc:"AFG",iso2:"AF",iso:"AFG",label:"Afghanistan",phone:"93"},{ioc:"ANT",iso2:"AG",iso:"ATG",label:"Antigua and Barbuda",phone:"1-268"},{ioc:"AIA",iso2:"AI",iso:"AIA",label:"Anguilla",phone:"1-264"},{ioc:"ALB",iso2:"AL",iso:"ALB",label:"Albania",phone:"355"},{ioc:"ARM",iso2:"AM",iso:"ARM",label:"Armenia",phone:"374"},{ioc:"ANG",iso2:"AO",iso:"AGO",label:"Angola",phone:"244"},{ioc:"",iso2:"AQ",iso:"ATA",label:"Antarctica",phone:"672"},{ioc:"ARG",iso2:"AR",iso:"ARG",label:"Argentina",phone:"54"},{ioc:"ASA",iso2:"AS",iso:"ASM",label:"American Samoa",phone:"1-684"},{ioc:"AUT",iso2:"AT",iso:"AUT",label:"Austria",phone:"43"},{ioc:"AUS",iso2:"AU",iso:"AUS",label:"Australia",phone:"61",suggested:!0},{ioc:"ARU",iso2:"AW",iso:"ABW",label:"Aruba",phone:"297"},{ioc:"AZE",iso2:"AZ",iso:"AZE",label:"Azerbaijan",phone:"994"},{ioc:"BIH",iso2:"BA",iso:"BIH",label:"Bosnia and Herzegovina",phone:"387"},{ioc:"BAR",iso2:"BB",iso:"BRB",label:"Barbados",phone:"1-246"},{ioc:"BAN",iso2:"BD",iso:"BGD",label:"Bangladesh",phone:"880"},{ioc:"BEL",iso2:"BE",iso:"BEL",label:"Belgium",phone:"32"},{ioc:"BUR",iso2:"BF",iso:"BFA",label:"Burkina Faso",phone:"226"},{ioc:"BUL",iso2:"BG",iso:"BGR",label:"Bulgaria",phone:"359"},{ioc:"BRN",iso2:"BH",iso:"BHR",label:"Bahrain",phone:"973"},{ioc:"BDI",iso2:"BI",iso:"BDI",label:"Burundi",phone:"257"},{ioc:"BEN",iso2:"BJ",iso:"BEN",label:"Benin",phone:"229"},{ioc:"",iso2:"BL",iso:"BLM",label:"Saint Barthelemy",phone:"590"},{ioc:"BER",iso2:"BM",iso:"BMU",label:"Bermuda",phone:"1-441"},{ioc:"BRU",iso2:"BN",iso:"BRN",label:"Brunei Darussalam",phone:"673"},{ioc:"BOL",iso2:"BO",iso:"BOL",label:"Bolivia",phone:"591"},{ioc:"BRA",iso2:"BR",iso:"BRA",label:"Brazil",phone:"55"},{ioc:"BAH",iso2:"BS",iso:"BHS",label:"Bahamas",phone:"1-242"},{ioc:"BHU",iso2:"BT",iso:"BTN",label:"Bhutan",phone:"975"},{ioc:"",iso2:"BV",iso:"BVT",label:"Bouvet Island",phone:"47"},{ioc:"BOT",iso2:"BW",iso:"BWA",label:"Botswana",phone:"267"},{ioc:"BLR",iso2:"BY",iso:"BLR",label:"Belarus",phone:"375"},{ioc:"BIZ",iso2:"BZ",iso:"BLZ",label:"Belize",phone:"501"},{ioc:"CAN",iso2:"CA",iso:"CAN",label:"Canada",phone:"1",suggested:!0},{ioc:"",iso2:"CC",iso:"CCK",label:"Cocos (Keeling) Islands",phone:"61"},{ioc:"CGO",iso2:"CD",iso:"COG",label:"Congo, Republic of the",phone:"242"},{ioc:"CAF",iso2:"CF",iso:"CAF",label:"Central African Republic",phone:"236"},{ioc:"COD",iso2:"CG",iso:"CGD",label:"Congo, Democratic Republic of the",phone:"243"},{ioc:"SUI",iso2:"CH",iso:"CHE",label:"Switzerland",phone:"41"},{ioc:"CIV",iso2:"CI",iso:"CIV",label:"Cote d'Ivoire",phone:"225"},{ioc:"COK",iso2:"CK",iso:"COK",label:"Cook Islands",phone:"682"},{ioc:"CHI",iso2:"CL",iso:"CHL",label:"Chile",phone:"56"},{ioc:"CMR",iso2:"CM",iso:"CMR",label:"Cameroon",phone:"237"},{ioc:"CHN",iso2:"CN",iso:"CHN",label:"China",phone:"86"},{ioc:"COL",iso2:"CO",iso:"COL",label:"Colombia",phone:"57"},{ioc:"CRC",iso2:"CR",iso:"CRI",label:"Costa Rica",phone:"506"},{ioc:"CUB",iso2:"CU",iso:"CUB",label:"Cuba",phone:"53"},{ioc:"CPV",iso2:"CV",iso:"CPV",label:"Cape Verde",phone:"238"},{ioc:"CUW",iso2:"CW",iso:"CUW",label:"Curacao",phone:"599"},{ioc:"CXR",iso2:"CX",iso:"CXR",label:"Christmas Island",phone:"61"},{ioc:"CYP",iso2:"CY",iso:"CYP",label:"Cyprus",phone:"357"},{ioc:"CZE",iso2:"CZ",iso:"CZE",label:"Czech Republic",phone:"420"},{ioc:"GER",iso2:"DE",iso:"DEU",label:"Germany",phone:"49",suggested:!0},{ioc:"DJI",iso2:"DJ",iso:"DJI",label:"Djibouti",phone:"253"},{ioc:"DEN",iso2:"DK",iso:"DNK",label:"Denmark",phone:"45"},{ioc:"DMA",iso2:"DM",iso:"DMA",label:"Dominica",phone:"1-767"},{ioc:"DOM",iso2:"DO",iso:"DOM",label:"Dominican Republic",phone:"1-809"},{ioc:"ALG",iso2:"DZ",iso:"DZA",label:"Algeria",phone:"213"},{ioc:"ECU",iso2:"EC",iso:"ECU",label:"Ecuador",phone:"593"},{ioc:"EST",iso2:"EE",iso:"ESE",label:"Estonia",phone:"372"},{ioc:"EGY",iso2:"EG",iso:"EGY",label:"Egypt",phone:"20"},{ioc:"",iso2:"EH",iso:"ESH",label:"Western Sahara",phone:"212"},{ioc:"ERI",iso2:"ER",iso:"ERI",label:"Eritrea",phone:"291"},{ioc:"ESP",iso2:"ES",iso:"ESP",label:"Spain",phone:"34"},{ioc:"ETH",iso2:"ET",iso:"ETH",label:"Ethiopia",phone:"251"},{ioc:"FIN",iso2:"FI",iso:"FIN",label:"Finland",phone:"358"},{ioc:"FIJ",iso2:"FJ",iso:"FJI",label:"Fiji",phone:"679"},{ioc:"FLK",iso2:"FK",iso:"FLK",label:"Falkland Islands (Malvinas)",phone:"500"},{ioc:"FSM",iso2:"FM",iso:"FSM",label:"Micronesia, Federated States of",phone:"691"},{ioc:"FAR",iso2:"FO",iso:"FRO",label:"Faroe Islands",phone:"298"},{ioc:"FRA",iso2:"FR",iso:"FRA",label:"France",phone:"33",suggested:!0},{ioc:"GAB",iso2:"GA",iso:"GAB",label:"Gabon",phone:"241"},{ioc:"GBR",iso2:"GB",iso:"GBR",label:"United Kingdom",phone:"44"},{ioc:"GRN",iso2:"GD",iso:"GRD",label:"Grenada",phone:"1-473"},{ioc:"GEO",iso2:"GE",iso:"GEO",label:"Georgia",phone:"995"},{ioc:"FGU",iso2:"GF",iso:"GUF",label:"French Guiana",phone:"594"},{ioc:"",iso2:"GG",iso:"GGY",label:"Guernsey",phone:"44"},{ioc:"",iso2:"GH",iso:"GHA",label:"Ghana",phone:"233"},{ioc:"GIB",iso2:"GI",iso:"GIB",label:"Gibraltar",phone:"350"},{ioc:"GRL",iso2:"GL",iso:"GRL",label:"Greenland",phone:"299"},{ioc:"GAM",iso2:"GM",iso:"GMB",label:"Gambia",phone:"220"},{ioc:"GUI",iso2:"GN",iso:"GIN",label:"Guinea",phone:"224"},{ioc:"GUD",iso2:"GP",iso:"GLP",label:"Guadeloupe",phone:"590"},{ioc:"GEQ",iso2:"GQ",iso:"GNQ",label:"Equatorial Guinea",phone:"240"},{ioc:"GRE",iso2:"GR",iso:"GRC",label:"Greece",phone:"30"},{ioc:"",iso2:"GS",iso:"SGS",label:"South Georgia and the South Sandwich Islands",phone:"500"},{ioc:"GUA",iso2:"GT",iso:"GTM",label:"Guatemala",phone:"502"},{ioc:"GUM",iso2:"GU",iso:"GUM",label:"Guam",phone:"1-671"},{ioc:"GBS",iso2:"GW",iso:"GNB",label:"Guinea-Bissau",phone:"245"},{ioc:"GUY",iso2:"GY",iso:"GUY",label:"Guyana",phone:"592"},{ioc:"HKG",iso2:"HK",iso:"HKG",label:"Hong Kong",phone:"852"},{ioc:"",iso2:"HM",iso:"HMD",label:"Heard Island and McDonald Islands",phone:"672"},{ioc:"HON",iso2:"HN",iso:"HND",label:"Honduras",phone:"504"},{ioc:"CRO",iso2:"HR",iso:"HRV",label:"Croatia",phone:"385"},{ioc:"HAI",iso2:"HT",iso:"HTI",label:"Haiti",phone:"509"},{ioc:"HUN",iso2:"HU",iso:"HUN",label:"Hungary",phone:"36"},{ioc:"INA",iso2:"ID",iso:"IDN",label:"Indonesia",phone:"62"},{ioc:"IRL",iso2:"IE",iso:"IRL",label:"Ireland",phone:"353"},{ioc:"ISR",iso2:"IL",iso:"ISR",label:"Israel",phone:"972"},{ioc:"",iso2:"IM",iso:"IMN",label:"Isle of Man",phone:"44"},{ioc:"IND",iso2:"IN",iso:"IND",label:"India",phone:"91"},{ioc:"",iso2:"IO",iso:"IOT",label:"British Indian Ocean Territory",phone:"246"},{ioc:"IRQ",iso2:"IQ",iso:"IRQ",label:"Iraq",phone:"964"},{ioc:"IRI",iso2:"IR",iso:"IRN",label:"Iran, Islamic Republic of",phone:"98"},{ioc:"ISL",iso2:"IS",iso:"ISL",label:"Iceland",phone:"354"},{ioc:"ITA",iso2:"IT",iso:"ITA",label:"Italy",phone:"39"},{ioc:"",iso2:"JE",iso:"JEY",label:"Jersey",phone:"44"},{ioc:"JAM",iso2:"JM",iso:"JAM",label:"Jamaica",phone:"1-876"},{ioc:"JOR",iso2:"JO",iso:"JOR",label:"Jordan",phone:"962"},{ioc:"JPN",iso2:"JP",iso:"JPN",label:"Japan",phone:"81",suggested:!0},{ioc:"KEN",iso2:"KE",iso:"KEN",label:"Kenya",phone:"254"},{ioc:"KGZ",iso2:"KG",iso:"KGZ",label:"Kyrgyzstan",phone:"996"},{ioc:"CAM",iso2:"KH",iso:"KHM",label:"Cambodia",phone:"855"},{ioc:"KIR",iso2:"KI",iso:"KIR",label:"Kiribati",phone:"686"},{ioc:"COM",iso2:"KM",iso:"COM",label:"Comoros",phone:"269"},{ioc:"SKN",iso2:"KN",iso:"KNA",label:"Saint Kitts and Nevis",phone:"1-869"},{ioc:"KOR",iso2:"KP",iso:"KOR",label:"Korea, Democratic People's Republic of",phone:"850"},{ioc:"PRK",iso2:"KR",iso:"PRK",label:"Korea, Republic of",phone:"82"},{ioc:"KUW",iso2:"KW",iso:"KWT",label:"Kuwait",phone:"965"},{ioc:"CAY",iso2:"KY",iso:"CYM",label:"Cayman Islands",phone:"1-345"},{ioc:"KAZ",iso2:"KZ",iso:"KAZ",label:"Kazakhstan",phone:"7"},{ioc:"LAO",iso2:"LA",iso:"LAO",label:"Lao People's Democratic Republic",phone:"856"},{ioc:"LIB",iso2:"LB",iso:"LBN",label:"Lebanon",phone:"961"},{ioc:"LCA",iso2:"LC",iso:"LCA",label:"Saint Lucia",phone:"1-758"},{ioc:"LIE",iso2:"LI",iso:"LIE",label:"Liechtenstein",phone:"423"},{ioc:"SRI",iso2:"LK",iso:"LKA",label:"Sri Lanka",phone:"94"},{ioc:"LBR",iso2:"LR",iso:"LBR",label:"Liberia",phone:"231"},{ioc:"LES",iso2:"LS",iso:"LSO",label:"Lesotho",phone:"266"},{ioc:"LTU",iso2:"LT",iso:"LTU",label:"Lithuania",phone:"370"},{ioc:"LUX",iso2:"LU",iso:"LUX",label:"Luxembourg",phone:"352"},{ioc:"LAT",iso2:"LV",iso:"LVA",label:"Latvia",phone:"371"},{ioc:"LBA",iso2:"LY",iso:"LBY",label:"Libya",phone:"218"},{ioc:"MAR",iso2:"MA",iso:"MAR",label:"Morocco",phone:"212"},{ioc:"MON",iso2:"MC",iso:"MCO",label:"Monaco",phone:"377"},{ioc:"MDA",iso2:"MD",iso:"MDA",label:"Moldova, Republic of",phone:"373"},{ioc:"MNE",iso2:"ME",iso:"MNE",label:"Montenegro",phone:"382"},{ioc:"",iso2:"MF",iso:"MAF",label:"Saint Martin (French part)",phone:"590"},{ioc:"MAD",iso2:"MG",iso:"MDG",label:"Madagascar",phone:"261"},{ioc:"MSH",iso2:"MH",iso:"MHL",label:"Marshall Islands",phone:"692"},{ioc:"MKD",iso2:"MK",iso:"MKD",label:"Macedonia, the Former Yugoslav Republic of",phone:"389"},{ioc:"MLI",iso2:"ML",iso:"MLI",label:"Mali",phone:"223"},{ioc:"MYA",iso2:"MM",iso:"MMR",label:"Myanmar",phone:"95"},{ioc:"MGL",iso2:"MN",iso:"MNG",label:"Mongolia",phone:"976"},{ioc:"MAC",iso2:"MO",iso:"MAC",label:"Macao",phone:"853"},{ioc:"NMA",iso2:"MP",iso:"NMP",label:"Northern Mariana Islands",phone:"1-670"},{ioc:"MRT",iso2:"MQ",iso:"MTQ",label:"Martinique",phone:"596"},{ioc:"MTN",iso2:"MR",iso:"MRT",label:"Mauritania",phone:"222"},{ioc:"MNT",iso2:"MS",iso:"MSR",label:"Montserrat",phone:"1-664"},{ioc:"MLT",iso2:"MT",iso:"MLT",label:"Malta",phone:"356"},{ioc:"MRI",iso2:"MU",iso:"MUS",label:"Mauritius",phone:"230"},{ioc:"MDV",iso2:"MV",iso:"MDV",label:"Maldives",phone:"960"},{ioc:"MAW",iso2:"MW",iso:"MWI",label:"Malawi",phone:"265"},{ioc:"MEX",iso2:"MX",iso:"MEX",label:"Mexico",phone:"52"},{ioc:"MAS",iso2:"MY",iso:"MYS",label:"Malaysia",phone:"60"},{ioc:"MOZ",iso2:"MZ",iso:"MOZ",label:"Mozambique",phone:"258"},{ioc:"NAM",iso2:"NA",iso:"NAM",label:"Namibia",phone:"264"},{ioc:"NCL",iso2:"NC",iso:"NCL",label:"New Caledonia",phone:"687"},{ioc:"NIG",iso2:"NE",iso:"NER",label:"Niger",phone:"227"},{ioc:"NFI",iso2:"NF",iso:"NFK",label:"Norfolk Island",phone:"672"},{ioc:"NGR",iso2:"NG",iso:"NGA",label:"Nigeria",phone:"234"},{ioc:"NCA",iso2:"NI",iso:"NIC",label:"Nicaragua",phone:"505"},{ioc:"NED",iso2:"NL",iso:"NLD",label:"Netherlands",phone:"31"},{ioc:"NOR",iso2:"NO",iso:"NOR",label:"Norway",phone:"47"},{ioc:"NEP",iso2:"NP",iso:"NPL",label:"Nepal",phone:"977"},{ioc:"NRU",iso2:"NR",iso:"NRU",label:"Nauru",phone:"674"},{ioc:"NIU",iso2:"NU",iso:"NIU",label:"Niue",phone:"683"},{ioc:"NZL",iso2:"NZ",iso:"NZL",label:"New Zealand",phone:"64"},{ioc:"OMA",iso2:"OM",iso:"OMN",label:"Oman",phone:"968"},{ioc:"PAN",iso2:"PA",iso:"PAN",label:"Panama",phone:"507"},{ioc:"PER",iso2:"PE",iso:"PER",label:"Peru",phone:"51"},{ioc:"FPO",iso2:"PF",iso:"PYF",label:"French Polynesia",phone:"689"},{ioc:"PNG",iso2:"PG",iso:"PNG",label:"Papua New Guinea",phone:"675"},{ioc:"PHI",iso2:"PH",iso:"PHL",label:"Philippines",phone:"63"},{ioc:"PAK",iso2:"PK",iso:"PAK",label:"Pakistan",phone:"92"},{ioc:"POL",iso2:"PL",iso:"POL",label:"Poland",phone:"48"},{ioc:"SPM",iso2:"PM",iso:"SPM",label:"Saint Pierre and Miquelon",phone:"508"},{ioc:"",iso2:"PN",iso:"PCN",label:"Pitcairn",phone:"870"},{ioc:"PUR",iso2:"PR",iso:"PRI",label:"Puerto Rico",phone:"1"},{ioc:"PLE",iso2:"PS",iso:"PSE",label:"Palestine, State of",phone:"970"},{ioc:"POR",iso2:"PT",iso:"PRT",label:"Portugal",phone:"351"},{ioc:"PLW",iso2:"PW",iso:"PLW",label:"Palau",phone:"680"},{ioc:"PAR",iso2:"PY",iso:"PRY",label:"Paraguay",phone:"595"},{ioc:"QAT",iso2:"QA",iso:"QAT",label:"Qatar",phone:"974"},{ioc:"REU",iso2:"RE",iso:"REU",label:"Reunion",phone:"262"},{ioc:"ROU",iso2:"RO",iso:"ROU",label:"Romania",phone:"40"},{ioc:"SRB",iso2:"RS",iso:"SRB",label:"Serbia",phone:"381"},{ioc:"RUS",iso2:"RU",iso:"RUS",label:"Russia",phone:"7"},{ioc:"RWA",iso2:"RW",iso:"RWA",label:"Rwanda",phone:"250"},{ioc:"KSA",iso2:"SA",iso:"SAU",label:"Saudi Arabia",phone:"966"},{ioc:"SOL",iso2:"SB",iso:"SLB",label:"Solomon Islands",phone:"677"},{ioc:"SEY",iso2:"SC",iso:"SYC",label:"Seychelles",phone:"248"},{ioc:"SUD",iso2:"SD",iso:"SDN",label:"Sudan",phone:"249"},{ioc:"SWE",iso2:"SE",iso:"SWE",label:"Sweden",phone:"46"},{ioc:"SIN",iso2:"SG",iso:"SGP",label:"Singapore",phone:"65"},{ioc:"HEL",iso2:"SH",iso:"SHN",label:"Saint Helena",phone:"290"},{ioc:"SLO",iso2:"SI",iso:"SVN",label:"Slovenia",phone:"386"},{ioc:"",iso2:"SJ",iso:"SJM",label:"Svalbard and Jan Mayen",phone:"47"},{ioc:"SVK",iso2:"SK",iso:"SVK",label:"Slovakia",phone:"421"},{ioc:"SLE",iso2:"SL",iso:"SLE",label:"Sierra Leone",phone:"232"},{ioc:"SMR",iso2:"SM",iso:"SMR",label:"San Marino",phone:"378"},{ioc:"SEN",iso2:"SN",iso:"SEN",label:"Senegal",phone:"221"},{ioc:"SOM",iso2:"SO",iso:"SOM",label:"Somalia",phone:"252"},{ioc:"SUR",iso2:"SR",iso:"SUR",label:"Suriname",phone:"597"},{ioc:"",iso2:"SS",iso:"SSD",label:"South Sudan",phone:"211"},{ioc:"STP",iso2:"ST",iso:"STP",label:"Sao Tome and Principe",phone:"239"},{ioc:"ESA",iso2:"SV",iso:"SLV",label:"El Salvador",phone:"503"},{ioc:"",iso2:"SX",iso:"SMX",label:"Sint Maarten",phone:"1-721"},{ioc:"SYR",iso2:"SY",iso:"SYR",label:"Syria",phone:"963"},{ioc:"",iso2:"SZ",iso:"SWZ",label:"Swaziland",phone:"268"},{ioc:"TKS",iso2:"TC",iso:"TCA",label:"Turks and Caicos Islands",phone:"1-649"},{ioc:"CHA",iso2:"TD",iso:"TCD",label:"Chad",phone:"235"},{ioc:"",iso2:"TF",iso:"ATF",label:"French Southern Territories",phone:"262"},{ioc:"TOG",iso2:"TG",iso:"TGO",label:"Togo",phone:"228"},{ioc:"THA",iso2:"TH",iso:"THA",label:"Thailand",phone:"66"},{ioc:"TJK",iso2:"TJ",iso:"TJK",label:"Tajikistan",phone:"992"},{ioc:"",iso2:"TK",iso:"TKL",label:"Tokelau",phone:"690"},{ioc:"TLS",iso2:"TL",iso:"TLS",label:"Timor-Leste",phone:"670"},{ioc:"TKM",iso2:"TM",iso:"TKM",label:"Turkmenistan",phone:"993"},{ioc:"TUN",iso2:"TN",iso:"TUN",label:"Tunisia",phone:"216"},{ioc:"TGA",iso2:"TO",iso:"TON",label:"Tonga",phone:"676"},{ioc:"TUR",iso2:"TR",iso:"TUR",label:"Turkey",phone:"90"},{ioc:"TTO",iso2:"TT",iso:"TTO",label:"Trinidad and Tobago",phone:"1-868"},{ioc:"TUV",iso2:"TV",iso:"TUV",label:"Tuvalu",phone:"688"},{ioc:"TPE",iso2:"TW",iso:"TWN",label:"Taiwan",phone:"886"},{ioc:"TAN",iso2:"TZ",iso:"TZA",label:"United Republic of Tanzania",phone:"255"},{ioc:"UKR",iso2:"UA",iso:"UKR",label:"Ukraine",phone:"380"},{ioc:"UGA",iso2:"UG",iso:"UGA",label:"Uganda",phone:"256"},{ioc:"USA",iso2:"US",label:"United States",phone:"1",suggested:!0,iso:"USA"},{ioc:"URU",iso2:"UY",iso:"URY",label:"Uruguay",phone:"598"},{ioc:"UZB",iso2:"UZ",iso:"UZB",label:"Uzbekistan",phone:"998"},{ioc:"",iso2:"VA",iso:"VAT",label:"Holy See (Vatican City State)",phone:"379"},{ioc:"VIN",iso2:"VC",iso:"VCT",label:"Saint Vincent and the Grenadines",phone:"1-784"},{ioc:"VEN",iso2:"VE",iso:"VEN",label:"Venezuela",phone:"58"},{ioc:"IVB",iso2:"VG",iso:"VGB",label:"British Virgin Islands",phone:"1-284"},{ioc:"ISV",iso2:"VI",iso:"VIR",label:"US Virgin Islands",phone:"1-340"},{ioc:"VIE",iso2:"VN",iso:"VNM",label:"Vietnam",phone:"84"},{ioc:"VAN",iso2:"VU",iso:"VUT",label:"Vanuatu",phone:"678"},{ioc:"WAF",iso2:"WF",iso:"WLF",label:"Wallis and Futuna",phone:"681"},{ioc:"SAM",iso2:"WS",iso:"WSM",label:"Samoa",phone:"685"},{ioc:"KOS",iso2:"XK",iso:"KOS",label:"Kosovo",phone:"383"},{ioc:"YEM",iso2:"YE",iso:"YEM",label:"Yemen",phone:"967"},{ioc:"MAY",iso2:"YT",iso:"MYT",label:"Mayotte",phone:"262"},{ioc:"RSA",iso2:"ZA",iso:"ZAF",label:"South Africa",phone:"27"},{ioc:"ZAM",iso2:"ZM",iso:"ZMB",label:"Zambia",phone:"260"},{ioc:"ZIM",iso2:"ZW",iso:"ZWE",label:"Zimbabwe",phone:"263"}];function Dne({participant:t,withISO2:e,withIOC:i}){let{person:r,individualParticipants:n}=t,a=[r,n?.map(({person:o})=>o)].flat().filter(Boolean);function s(o){let{nationalityCode:l}=o||{};if(l){let u=ud.find(({iso:c})=>c===l);i&&u?.ioc&&!o.iocNationalityCode&&(o.iocNationalityCode=u.ioc),e&&u?.iso2&&!o.iso2NationalityCode&&(o.iso2NationalityCode=u.iso2),u?.label&&!o.countryName&&(o.countryName=u.label)}}a.forEach(s)}function pLe({participantMap:t,template:e}){let i=Object.values(t);for(let r of i){let n=r.participant;if(n.individualParticipantIds?.length){n.individualParticipants=[];for(let a of n.individualParticipantIds){let s=t[a].participant;n.individualParticipants.push(e?Vm({template:e,source:s}):s)}}}}function Xd(t){let{tournamentRecord:e,participantId:i}=t,r=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};for(let n of Object.values(r)){let a=n.participants?.find(s=>s.participantId===i);if(a)return{participant:a,tournamentId:n.tournamentId}}return{error:ji}}function Pne(t){let{tournamentRecord:e,participantId:i}=t;if(i){let r=Xd({tournamentRecord:e,participantId:i});return r.participant??r}return t.element||t.drawDefinition||t.event||t.tournamentRecord||{error:Je}}function Ss(t){let{returnPreviousValues:e,itemSubTypes:i,itemType:r}=t,n=Pne(t);if(n.error)return n;if(i&&!Array.isArray(i))return{error:re,context:{itemSubTypes:i}};if(!Array.isArray(n.timeItems))return{error:pB};let a=n.timeItems.filter(o=>o?.itemType===r).filter(o=>!i?.length||i.some(l=>o?.itemSubTypes?.includes(l))).sort((o,l)=>{let u=new Date(o.createdAt||void 0).getTime(),c=new Date(l.createdAt||void 0).getTime();return u-c}),s=Oe(a.pop(),!1,!0);if(s){let o={timeItem:s,...W};return e&&Object.assign(o,{previousItems:a}),o}else return{info:Br}}function f2({returnPreviousValues:t,drawDefinition:e,itemSubTypes:i,itemType:r}){if(!e)return{error:xo};if(!e.timeItems)return{info:Br};let{timeItem:n,previousItems:a,info:s}=Ss({element:e,returnPreviousValues:t,itemSubTypes:i,itemType:r});return n&&{timeItem:n,previousItems:a}||{info:s}}function IU({returnPreviousValues:t,itemSubTypes:e,itemType:i,event:r}){if(!r)return{error:ui};if(!r.timeItems)return{info:Br};let{timeItem:n,previousItems:a,info:s}=Ss({returnPreviousValues:t,element:r,itemSubTypes:e,itemType:i});return n&&{timeItem:n,previousItems:a}||{info:s}}function GM({returnPreviousValues:t,tournamentRecord:e,itemSubTypes:i,itemType:r}){if(!e)return{error:ve};if(!e.timeItems)return{info:Br};let{timeItem:n,previousItems:a,info:s}=Ss({element:e,returnPreviousValues:t,itemSubTypes:i,itemType:r});return n&&{timeItem:n,previousItems:a}||{info:s}}function m2({returnPreviousValues:t,tournamentRecord:e,participantId:i,itemSubTypes:r,itemType:n}){if(!e)return{error:ve};if(!i)return{error:dr};let a=Xd({tournamentRecord:e,participantId:i});if(a.error)return a;let{participant:s}=a;if(!s?.timeItems)return{info:Br};let{timeItem:o,previousItems:l,info:u}=Ss({element:a.participant,returnPreviousValues:t,itemSubTypes:r,itemType:n});return o&&{timeItem:o,previousItems:l}||{info:u}}var fLe={[Ya]:"groupParticipantIds",[ft]:"pairParticipantIds",[_t]:"teamParticipantIds"},mLe={[Ya]:"groups",[_t]:"teams"};function Ene({withIndividualParticipants:t,convertExtensions:e,tournamentRecord:i,withSignInStatus:r,withScaleValues:n,withGroupings:a,internalUse:s,withISO2:o,withIOC:l}){let u=[],c={};for(let p of i.participants??[]){let f=p?.participantId;f&&ILe({participantMap:c,participantId:f})}for(let p of i.participants??[]){let f=Oe(p,e,s),{participantId:m,individualParticipantIds:h,participantType:g}=f;if(!c[m]){u.push(m);continue}if(Object.assign(c[m].participant,f),h){let I=gLe({individualParticipantIds:h,participantCopy:f,participantMap:c,participantType:g,participantId:m});I.missingParticipantIds.length&&u.push(...I.missingParticipantIds)}if(r&&(c[m].participant.signedIn=hLe(f)),n){let{ratings:I,rankings:v,seedings:w}=Fv({participant:f});c[m].participant.seedings=w,c[m].participant.rankings=v,c[m].participant.ratings=I}(l||o)&&Dne({participant:c[m].participant,withISO2:o,withIOC:l})}if(t){let p=wt(t)?t:void 0;pLe({participantMap:c,template:p})}let d;return a&&(d=jM({participants:Object.values(c).map(({participant:p})=>p),participantsProfile:{convertExtensions:e},deepCopy:!1}).groupInfo),{missingParticipantIds:u,participantMap:c,groupInfo:d}}function hLe(t){let{timeItem:e}=Ss({itemType:gU,element:t});return e?.itemValue===Zb}function gLe({individualParticipantIds:t,participantCopy:e,participantMap:i,participantType:r,participantId:n}){let a=[];for(let s of t){let o=i[s]?.participant;if(!o){a.push(s);continue}if(o[fLe[r]].push(n),[_t,Ya].includes(r)){let{participantRoleResponsibilities:l,participantOtherName:u,participantName:c,participantId:d,teamId:p}=e,f=mLe[r];o[f].push({participantRoleResponsibilities:l,participantOtherName:u,participantName:c,participantId:d,teamId:p})}if(r===ft){let l=t.find(u=>u!==s);i[s].pairIdMap[n]=l,i[s].pairIdMap[l]=n}}return{missingParticipantIds:a}}function ILe({participantMap:t,participantId:e}){if(t[e])return;let i={walkoverWins:0,defaultWins:0,walkovers:0,defaults:0,losses:0,wins:0};t[e]={structureParticipation:{},potentialMatchUps:{},scheduleConflicts:{},scheduleItems:[],participant:{groupParticipantIds:[],pairParticipantIds:[],teamParticipantIds:[],seedings:{},rankings:{},ratings:{},groups:[],teams:[]},statistics:{},opponents:{},pairIdMap:{},matchUps:{},events:{},draws:{},counters:{[zt]:{...i},[Bt]:{...i},[_t]:{...i},...i}}}function yf({participantsProfile:t,useParticipantMap:e,tournamentRecord:i,contextProfile:r,inContext:n}){if(e)return Ene({...t,...r,tournamentRecord:i});let a=Oe(i.participants,!1,!0)||[];(t?.withIOC||t?.withISO2)&&a.forEach(o=>Dne({participant:o,...t}));let s;if((n||t?.withGroupings)&&a?.length&&({participantsWithGroupings:a,groupInfo:s}=jM({participantsProfile:t,deepCopy:!1,participants:a})),t?.withScaleValues&&a?.length)for(let o of a){let{ratings:l,rankings:u}=Fv({participant:o});o.rankings=u,o.ratings=l}return{participants:a,groupInfo:s}}function Dt({onlySpecifiedPolicyTypes:t=!1,policyTypes:e=[],tournamentRecord:i,drawDefinition:r,structure:n,event:a}){if(!Array.isArray(e))return{error:tB};let s={};return i&&o(i),a&&o(a),r&&o(r),n&&o(n),{appliedPolicies:s,...W};function o(l){let u=l?.extensions?.find(c=>c.name===Jb)?.value;if(u)for(let c of Object.keys(u))(t?e.includes(c):!e.length||e.includes(c))&&(s[c]=Oe(u[c],!1,!0))}}function jc({policyTypes:t=[],tournamentRecord:e,drawDefinition:i,structure:r,event:n}){if(!Array.isArray(t))return{error:tB};let{appliedPolicies:a}=Dt({tournamentRecord:e,drawDefinition:i,structure:r,event:n}),s={};for(let o of t){let l=a?.[o];l&&(s[o]=l)}return Object.keys(s).length?{policyDefinitions:s}:{info:ZS.message}}var Rne="WALKOVER",Yz="RETIRED",h2="COMPETITIVE",ew="ROUTINE",tw="DECISIVE",dD="winRatio",vLe={[qu]:{policyName:"Competitive Bands Default",profileBands:{[tw]:20,[ew]:50}}},g2=vLe;function Gc({policyDefinitions:t,tournamentRecord:e,contextProfile:i,drawDefinition:r,event:n}){let a={policies:{}};if(!i)return a;let s=jc({tournamentRecord:e,drawDefinition:r,event:n}).policyDefinitions;if(i.withCompetitiveness){let o=t?.[qu]??s?.[qu]??g2[qu];a.policies[qu]=o}return a}function bf({tournamentRecord:t,drawDefinition:e,policyType:i,structure:r,event:n}){if(!t)return{error:ve};let{appliedPolicies:a}=Dt({tournamentRecord:t,drawDefinition:e,structure:r,event:n});return a?.[i]?{policy:a[i]}:{info:ZS?.message}}function vU({tournamentRecord:t,categoryName:e,categoryType:i,event:r}){e=e??r?.category?.categoryName??r?.category?.ageCategoryCode,i=i??r?.category?.categoryType??r?.category?.subType;let{policy:n}=bf({policyType:qd,tournamentRecord:t,event:r}),a=(t?ht({element:t,name:Uc}).extension:void 0)?.value,s=(r&&ht({name:Uc,element:r}).extension)?.value;return{scheduleTiming:{tournamentScheduling:a,eventScheduling:s,categoryName:e,categoryType:i,policy:n}}}function I2({drawDefinition:t,attributes:e}){let{extension:i}=ht({element:t,name:BP}),r=i?.value||{};return e.forEach(n=>{Object.keys(n).forEach(a=>{r[a]?Object.assign(r[a],n[a]):r[a]=n[a]})}),i={name:BP,value:r},kM({drawDefinition:t,extension:i}),{entryProfile:r}}function yU({drawDefinition:t}){let{extension:e}=ht({element:t,name:BP});return{entryProfile:e?.value||{}}}var Gs="ALTERNATE",bU="CONFIRMED",ua="DIRECT_ACCEPTANCE",wU="FEED_IN",SU="JUNIOR_EXEMPT",Pc="LUCKY_LOSER",UU="ORGANISER_ACCEPTANCE",TU="QUALIFIER",yLe="REGISTERED",DU="SPECIAL_EXEMPT",Us="UNGROUPED",wf="UNPAIRED",CI="WILDCARD",bu="WITHDRAWN",pD=[bU,ua,SU,UU,DU],Cne=[wU,Pc,TU],Sf=[bU,ua,wU,SU,UU,DU,CI],uo=[bU,ua,SU,Pc,TU,UU,DU,CI],Mne=[Gs,bU,ua,wU,SU,Pc,UU,TU,yLe,DU,Us,wf,CI,bu],bLe={ALTERNATE:Gs,CONFIRMED:bU,DIRECT_ACCEPTANCE:ua,DIRECT_ENTRY_STATUSES:Sf,DRAW_SPECIFIC_STATUSES:Cne,EQUIVALENT_ACCEPTANCE_STATUSES:pD,FEED_IN:wU,JUNIOR_EXEMPT:SU,LUCKY_LOSER:Pc,ORGANISER_ACCEPTANCE:UU,QUALIFIER:TU,SPECIAL_EXEMPT:DU,STRUCTURE_SELECTED_STATUSES:uo,UNGROUPED:Us,UNPAIRED:wf,VALID_ENTRY_STATUSES:Mne,WILDCARD:CI,WITHDRAWN:bu};function v2({stage:t,drawDefinition:e}){let{entryProfile:i}=yU({drawDefinition:e}),r=Object.keys(i).includes(t);if(!r&&SM.includes(t)){let n=[{[t]:{drawSize:void 0,alternates:!0}}];return I2({drawDefinition:e,attributes:n}),!0}return r}function wLe({stage:t,drawDefinition:e}){let{entryProfile:i}=yU({drawDefinition:e});return i[t]?.alternates||0}function SLe({stage:t,drawDefinition:e}){let{entryProfile:i}=yU({drawDefinition:e});return i[t]?.wildcardsCount||0}function wx({stage:t,drawDefinition:e,entryStatus:i}){return e.entries.reduce((r,n)=>n.entryStage===t&&n.entryStatus===i?r+1:r,0)}function $h({provisionalPositioning:t,placementGroup:e,drawDefinition:i,stageSequence:r,entryStatuses:n,structureId:a,roundTarget:s,stages:o,stage:l}){let u=i.entries?.reduce((c,d)=>{let p=ht({name:El,element:d})?.extension?.value,f=l&&d.entryStage===l||o?.length&&d.entryStage&&o.includes(d.entryStage),m=!n||d.entryStatus&&n.includes(d.entryStatus),h=d.entryStageSequence??1;return f&&(!r||h===r)&&m&&(!s||!p||s===p)?c.concat(d):c},[])??[];if(a&&l===Ti){let{playoffEntries:c,error:d}=ULe({provisionalPositioning:t,drawDefinition:i,structureId:a});return d&&console.log("playoff entries error"),(c?.length?c:u).filter(p=>!e||p.placementGroup===e)}return u}function ULe({provisionalPositioning:t,drawDefinition:e,structureId:i}){let r=[],n=(e.links??[]).find(a=>a.linkType===fu&&a.target.structureId===i);if(n){let{finishingPositions:a,structureId:s}=n.source,{structure:o}=tt({drawDefinition:e,structureId:s});o?.structureType===gn&&(o.structures??[]).forEach(l=>{let u=l.positionAssignments??[],{structureId:c}=l,d=c,p=Object.assign({},...u.map(h=>{let{participantId:g}=h,I=ht({element:h,name:Tc}).extension?.value;return I&&g?{[g]:I}:void 0}).filter(Boolean)),f=Object.keys(p).reduce((h,g)=>{let I=p[g],v=I.groupOrder||t&&I.provisionalOrder;return h.includes(v)||h.push(v),h},[]).length===Object.keys(p).length,m=Object.keys(p).filter(h=>{let g=p[h],I=g.groupOrder||t&&g.provisionalOrder;return a?.includes(I)});(!t||f)&&m.forEach(h=>{let g=p[h],{groupOrder:I,provisionalOrder:v,GEMscore:w}=g,y=I||t&&v,b=[...a??[]].sort(nr).indexOf(y)+1;r.push({entryStage:Ti,entryStatus:wU,placementGroup:b,groupingValue:d,participantId:h,GEMscore:w})})})}return{playoffEntries:r}}function TLe({stage:t,drawDefinition:e}){return Sf.reduce((i,r)=>(wx({drawDefinition:e,entryStatus:r,stage:t})||0)+i,0)}function hs({provisionalPositioning:t,returnAllProxies:e,drawDefinition:i,structureId:r,structure:n}){let a,s=[];n||({structure:n,error:a}=tt({drawDefinition:i,structureId:r}));let o=Kt({structure:n}).positionAssignments;if(a||!n)return{seedAssignments:[],error:vi};r||(r=n.structureId);let{stage:l,stageSequence:u}=n,c=l===Ti&&i&&$h({provisionalPositioning:t,drawDefinition:i,stageSequence:u,structureId:r,stage:l}),d=c?c.filter(m=>m.placementGroup===1).sort((m,h)=>m.GEMscore<h.GEMscore&&1||m.GEMscore>h.GEMscore&&-1||0).map((m,h)=>{let g=h+1;return{participantId:m.participantId,seedValue:g,seedProxy:!0,seedNumber:g}}):[],p=d?.slice(0,e?d.length:o.length/2);p.length?s=p:n.seedAssignments?s=n.seedAssignments:a=Ute;let f=n.seedLimit??n?.positionAssignments?.length;return{seedAssignments:s,stageSequence:u,seedLimit:f,stage:l,error:a}}function Vo(t){if(!t)return;let{tieFormatId:e,tieFormats:i}=t;if(t.tieFormat)return t.tieFormat;if(e&&Array.isArray(i))return i.find(r=>r.tieFormatId===e)}function qy({item:t,drawDefinition:e,structure:i,event:r}){if(t){if(t.tieFormat)return t.tieFormat;if(t.tieFormatId)return e.tieFormat?e.tieFormat:e.tieFormats?.find(n=>t.tieFormatId===n.tieFormatId)||(r.tieFormat?r.tieFormat:r.tieFormats?.find(n=>t.tieFormatId===n.tieFormatId));if(i?.tieFormat)return i.tieFormat;if(i?.tieFormatId){let n=e.tieFormats?.find(a=>i.tieFormatId===a.tieFormatId);if(n)return n}}}function yn({drawDefinition:t,structure:e,matchUp:i,event:r}){return{tieFormat:qy({item:i,drawDefinition:t,structure:e,event:r})||qy({item:e,drawDefinition:t,structure:e,event:r})||Vo(t)||Vo(r)}}function DLe({matchUps:t}){let e=t.reduce((i,r)=>!r.collectionPosition||i.includes(r.collectionPosition)?i:i.concat(r.collectionPosition),[]).map(i=>({[i]:t.filter(r=>r.collectionPosition===i)}));return{collectionPositionMatchUps:Object.assign({},...e)}}function kr({drawDefinition:t,structure:e}){let i={},r=[];return(t?.structures??[e]).filter(n=>n&&typeof n=="object").forEach(n=>{if(!n)return;let{structureId:a,matchUps:s,structures:o}=n,l=Array.isArray(o);if(l)l&&o.forEach(u=>{let{structureName:c}=u,d=u.matchUps;i[u.structureId]={matchUps:d,itemStructureIds:[],structureName:c},d&&(r.push(...d),d.forEach(p=>{p.tieMatchUps&&r.push(...p.tieMatchUps)})),i[a]||(i[a]={itemStructureIds:[],matchUps:[]}),i[a].itemStructureIds||(i[a].itemStructureIds=[]),i[a].itemStructureIds.push(u.structureId)});else{let u=s;i[a]={matchUps:u,itemStructureIds:[]},u?.forEach(c=>{r.push(c),c.tieMatchUps&&r.push(...c.tieMatchUps)})}}),{mappedMatchUps:i,drawMatchUps:r}}function Pd({mappedMatchUps:t,matchUpsMap:e,structureId:i,inContext:r}){t=e?.mappedMatchUps??t;let n=t[i],a=(n?.itemStructureIds||[]).map(s=>{let{matchUps:o,structureName:l}=t[s];return r?o.map(u=>Object.assign(Oe(u,!0,!0),{containerStructureId:i,structureId:s,structureName:l})):o}).flat();return(n?.matchUps||[]).concat(...a)}function Nne({groupedOrder:t,roundPositionsCount:e}){if(!t||t?.length<=e)return t;let i=wr(t,t.length/e).map(n=>n.reduce((a,s)=>a+s)),r=i.slice().sort(nr);return i.map(n=>r.indexOf(n)+1)}function HM(t){if(!wt(t))return!1;let{matchUpId:e,drawPositions:i}=t,r=typeof e=="string",n=!i||Array.isArray(i)&&i.length<=2&&i.every(a=>lt(a)||a===void 0||a===null);return r&&n}function Ka(t){return Array.isArray(t)?t.every(HM):!1}function PLe(t,e){return e?.find(i=>t.includes(i))}function Sn({matchUps:t=[],interpolate:e}){if(!Ka(t))return{roundMatchUps:[],error:re};let i=t.reduce((d,p)=>{let f=typeof p.roundNumber=="string"?Ke(p.roundNumber):p.roundNumber;return!p.roundNumber||d.includes(f)?d:d.concat(f)},[]).sort(nr).map(d=>{let p=t.filter(h=>h.roundNumber===d),f=p.find(({matchUpType:h})=>h===ei)?p.filter(({matchUpType:h})=>h===ei):p,m=h=>h.sort((g,I)=>nr(g.roundPosition,I.roundPosition));return{[d]:m(f)}}),r=t.reduce((d,p)=>{let f=typeof p.roundNumber=="string"?Ke(p.roundNumber):p.roundNumber;return d[f]||(d[f]=je({abbreviatedRoundName:p.abbreviatedRoundName,finishingRound:p.finishingRound,roundName:p.roundName})),d},{}),n=Object.assign({},...i);if(e){let d=Math.max(...Object.keys(n).map(f=>Ke(f)).filter(f=>!Number.isNaN(f))),p=n[d]?.length;if(p>1&&Ro(p)){let f=d+1,m=f+p/2;Ce(f,m).forEach((h,g)=>{n[h]=Ce(0,p/(2+g*2)).map(()=>({}))})}}let a=0,s=Object.assign({},...Object.keys(n).map(d=>{let p=n[d]?.length,f=n[d]?.filter(h=>!Ki.includes(h.matchUpStatus)&&!h.score?.scoreStringSide1)?.length,m=p&&p===f;return a=Math.max(a,p),{[d]:{matchUpsCount:p,inactiveCount:f,inactiveRound:m}}})),o=0,l=0,u=Object.keys(n).map(d=>Ke(d)).filter(d=>!Number.isNaN(d));u.forEach(d=>{let p=n[d].sort((m,h)=>m.roundPosition-h.roundPosition),f=p.flatMap(m=>m?.drawPositions||[]);if(s[d].roundNumber=d,s[d].roundFactor=s[d].matchUpsCount?a/s[d].matchUpsCount:1,s[d].finishingRound=r[d]?.finishingRound,s[d].roundName=r[d]?.roundName,s[d].abbreviatedRoundName=r[d]?.abbreviatedRoundName,s[d].finishingPositionRange=n[d]?.[0]?.finishingPositionRange,d===1||!s[d-1]){let m=f.sort(nr),h=wr(m,2);s[d].drawPositions=m,s[d].pairedDrawPositions=h}else{let m=s[d-1],h=m.drawPositions,g=m.matchUpsCount/s[d].matchUpsCount,I=wr(h,g),v=p.map(w=>{let{roundPosition:y}=w,b=[...w.drawPositions||[],void 0,void 0].slice(0,2);if(!y)return b;let S=b?.filter(Boolean)||[];if(!S?.length)return[void 0,void 0];if(d<3&&S?.length===2)return b?.slice().sort(nr);let U=Li(h,S).length!==S?.length;if(S?.length&&U)return S?.length===1?[S[0],void 0]:b?.slice().sort(nr);let T=(y-1)*2;return I.slice(T,T+2).map(P=>PLe(P,S))});s[d].drawPositions=v?.flat(),s[d].pairedDrawPositions=v}s[d+1]?.matchUpsCount===s[d].matchUpsCount&&(s[d+1].feedRound=!0,s[d+1].feedRoundIndex=l,s[d].preFeedRound=!0,l+=1),s[d]&&!s[d].feedRound&&(s[d].roundIndex=o,o+=1)});let c=!!Object.values(s).some(({matchUpsCount:d})=>!Ro(d));return{hasNoRoundPositions:t.some(d=>!d.roundPosition),roundsNotPowerOf2:c,maxMatchUpsCount:a,roundMatchUps:n,roundNumbers:u,roundProfile:s,...W}}function fD(t){if(!Array.isArray(t))return"";let e=t.filter(Ai);return e.length?nt([Math.min(...e),Math.max(...e)]).join("-"):""}function ELe({drawDefinition:t,structureId:e,matchUpsMap:i}){if(!t)return{error:$e};if(!e)return{error:qa};let{structure:r}=tt({drawDefinition:t,structureId:e});if(r?.stage!==tn)return{error:hf,info:"Structure is not CONSOLATION stage"};let{links:n}=t,a=n?.filter(d=>d.target.structureId===e)||[],s=a?.reduce((d,p)=>{let{structureId:f}=p.source;return d.includes(f)?d:d.concat(f)},[])||[],o=Object.assign({},...s.map(d=>{let p=Pd({structureId:d,matchUpsMap:i}),f=Sn({matchUps:p}).roundProfile;return{[d]:f}})),l=Pd({matchUpsMap:i,structureId:e}),{roundProfile:u}=Sn({matchUps:l}),c={};return a?.forEach(d=>{let{structureId:p,roundNumber:f}=d.source,{feedProfile:m,groupedOrder:h,positionInterleave:g,roundNumber:I}=d.target,v=o[p],w=v[1]?.drawPositions,y=v[f]?.matchUpsCount;if(!y)return;let b=y?w.length/y:0,S=w.length/b,U=w.slice(),T=Nne({roundPositionsCount:S,groupedOrder:h}),P=T?.length||1;if(P<=S){let R=w.length/P,C=wr(U,R);m===Vp&&C.forEach(M=>M.reverse()),U=T?.length&&T?.map(M=>C[M-1]).flat()||C.flat()}let D=wr(U,b);if(g){let R=Ce(0,g.interleave).map(()=>{}),C=Ce(0,g.offset).map(()=>{});D=D.map(N=>[N,...R]),D.unshift(C),D=D.flat(1);let M=D.length-g.offset;D=D.slice(0,M)}c[I]||(c[I]={});let E=u?.[I]?.feedRound?2:1;D.forEach((R,C)=>{let M=1+C*E;c[I][M]||(c[I][M]=fD(R))})}),{sourceDrawPositionRanges:c}}function Ane({drawDefinition:t}){if(typeof t!="object")return{error:fm};let e={},{structures:i=[],links:r=[]}=t||{},n=i.reduce((s,o)=>{let{stage:l}=o;return s[l]?s[l].push(o):s[l]=[o],s},{});for(let s of Object.keys(n)){let o=n[s].find(({stageSequence:u})=>u===1);if(!o)continue;let{structureId:l}=o;a({aggregator:{},targetRound:0,exitProfiles:e,exitProfile:"0",structureId:l,stage:s})}return{exitProfiles:e};function a({exitProfiles:s,exitProfile:o,structureId:l,targetRound:u,aggregator:c,stage:d}){s[l]||(s[l]=[]),o==="0"&&[tn,Ti].includes(d)||s[l].push(o);let p=r.filter(f=>f.source.structureId===l&&f.source.roundNumber>=u);for(let f of p){let m=f.source.roundNumber,h=f.target.roundNumber,g=f.target.structureId,I=i.find(w=>w.structureId===g).stage,v=[I,g,h,m].join("|");if(c[v])return;c[v]=!0,a({exitProfile:`${o}-${m}`,structureId:g,exitProfiles:s,targetRound:h,aggregator:c,stage:I})}}}function RLe({drawDefinition:t,roundProfile:e,structureId:i,matchUpsMap:r}){if(!t)return{error:$e};if(!i)return{error:qa};if(!e){let s=Pd({matchUpsMap:r,structureId:i});if({roundProfile:e}=Sn({matchUps:s}),!e)return{error:Je}}let n=(Math.min(...e?.[1]?.drawPositions??[])||1)-1,a=Object.keys(e);return{drawPositionsRanges:Object.assign({},...(a||[]).map(s=>{let o=e?.[s]?.matchUpsCount,l=e?.[1]?.drawPositions??[],u=wr(l,l.length/o),c=u.map(fD),d=u.map(g=>g.map(I=>I-n)).map(fD),p=a.map(g=>{if(g>s)return;let I=e?.[g]?.drawPositions??[];return wr(I,I.length/o)}).filter(Boolean),f=Ce(0,o).map(g=>p.map(I=>I[g]).flat().filter(Boolean).sort(nr)).map(g=>nt(g)),m=f.map(g=>$xe(g).map(fD).join(", ")),h=Object.assign({},...Ce(0,o).map(g=>({[g+1]:{firstRoundDrawPositionsRange:c[g],firstRoundOffsetDrawPositionsRange:d[g],possibleDrawPositions:f[g],drawPositionsRange:m[g]}})));return{[s]:h}}))}}function y2({roundsNotPowerOf2:t,drawDefinition:e,structure:i,matchUps:r}){if(!i)return!1;r=r??i.matchUps??[],t=t??Sn({matchUps:r}).roundsNotPowerOf2;let n=!!i.positionAssignments?.find(({drawPosition:a})=>a)||!!r?.find(({drawPositions:a})=>a?.length);return(!e?.drawType||e.drawType!==If)&&!i?.structures&&t&&n}function Hn({structure:t}){if(!t)return!1;let e=t.matchUps||t.roundMatchUps&&Object.values(t.roundMatchUps).flat(),i=!!e?.find(n=>n?.roundPosition),r=!!e?.find(n=>n?.drawPositions?.length);return!t?.structures&&t?.stage!==Rr&&(!e.length||!i&&!r)}var b2={[wc]:{policyName:"Round Naming Default",namingConventions:{round:"Round",pre:"Pre"},qualifyingFinishMap:{1:"Final"},abbreviatedRoundNamingMap:{1:"F",2:"SF",4:"QF"},roundNamingMap:{1:"Final",2:"Semifinal",4:"Quarterfinal"},affixes:{roundNumber:"R",preFeedRound:"Q",preQualifying:"P"},stageConstants:{[Ae]:"",[Ti]:"P",[ze]:"Q",[tn]:"C"}}},CLe=b2;function kne({roundNamingPolicy:t,drawDefinition:e,structure:i,matchUps:r}){let{roundProfile:n,roundMatchUps:a}=Sn({matchUps:r}),{structureAbbreviation:s,stage:o}=i,l=Hn({structure:i}),u=y2({structure:i}),c=i.structures,d={},p=b2[wc],f=i.stage===ze,m=f?Math.max(...(e?.structures??[]).filter(R=>R.stage===ze).map(({stageSequence:R})=>R??1),0):0,h=(i.stageSequence??1)<m?i.stageSequence??1:"",g=h&&(t?.affixes?.preQualifying||p.affixes.preQualifying)||"",I=t?.roundNamingMap||p.roundNamingMap||{},v=t?.abbreviatedRoundNamingMap||p.abbreviatedRoundNamingMap||{},w=t?.affixes?.preFeedRound||p.affixes.preFeedRound,y=t?.affixes?.roundNumber||p.affixes.roundNumber,b=(t?.namingConventions||p.namingConventions).round,S=o&&o!==Ae?o[0]:"",U=t?.stageConstants||p.stageConstants,T=o&&U?.[o]||S,P=`${g}${T}${h}`,D=n?Object.keys(n):[],E=f&&U?.[ze]?`${U?.[ze]}-`:"";if(c||l||u)Object.assign(d,...D.map(R=>{let C=`${E}${b} ${R}`,M=`${y}${R}`;return{[R]:{roundName:C,abbreviatedRoundName:M}}}));else{let R=f&&(t?.qualifyingFinishMap||p?.qualifyingFinishMap||{});Object.assign(d,...D.map(C=>{if(!n?.[C])return;let{matchUpsCount:M,preFeedRound:N}=n[C],A=M*2,O=R?.[n?.[C].finishingRound]||R&&`${y}${A}`||I[M]||`${y}${A}`,k=N?`-${w}`:"",F=`${O}${k}`,x=[P,s,F].filter(Boolean).join("-"),L=`${v[M]||`${y}${A}`}${k}`,$=[P,s,L].filter(Boolean).join("-");return{[C]:{abbreviatedRoundName:$,roundName:x}}}))}return{roundNamingProfile:d,roundProfile:n,roundMatchUps:a}}var MLe=(t,e)=>(t||0)+(e||0);function One(t,e){let i=Array.isArray(t)?t[0]:t;return Number.isNaN(i)&&Rne||i<=e[tw]&&tw||i<=e[ew]&&ew||h2}function xne({score:t}){let e=t?.sets||[],i=e.reduce((n,a)=>(n[0]+=a.side1Score||0,n[1]+=a.side2Score||0,n),[0,0]),r=e.reduce((n,a)=>(n[0]+=a.side1TiebreakScore||0,n[1]+=a.side2TiebreakScore||0,n),[0,0]);return r.reduce(MLe)&&(i[r[0]>r[1]?0:1]+=1),{sets:e,games:i,score:t}}function NLe(t){let e=Math.min(...t.games),i=Math.max(...t.games);return Math.round(e/i*100)}function Fne(t){return t.map(NLe).sort().map(e=>parseFloat(e.toFixed(2)))}function PU({tournamentRecord:t,profileBands:e,matchUp:i}){if(!i)return{error:aa};let{score:r,winningSide:n}=i;if(!n)return{error:re};let a=!e&&t&&bf({policyType:qu,tournamentRecord:t}).policy,s=e||a?.profileBands||g2[qu].profileBands,o=xne({score:r}),l=Fne([o]),u=One(l,s),c=Array.isArray(l)?l[0]:l;return{...W,competitiveness:u,pctSpread:c}}function Lne({matchUp:t}){if(!t)return{error:aa};if(t&&!t.sides)return{error:sa};if(t&&!t.hasContext)return{error:pM};let e=(t.sides??[])?.map(s=>s?.participantId).filter(Boolean),i=t.sides?.filter(s=>s.participant?.participantType===It).map(s=>s.participantId).filter(Boolean)??[],r=((t.sides??[])?.map(s=>s.participant?.individualParticipants).filter(Boolean)??[]).map(s=>(s??[]).map(o=>o?.participantId).filter(Boolean)),n=[...i,...r.flat()].filter(Boolean)??[],a=nt(n.concat(e)).filter(Boolean)??[];return{nestedIndividualParticipantIds:r,allRelevantParticipantIds:a,individualParticipantIds:n,sideParticipantIds:e,...W}}var jP="CHECK_IN",GP="CHECK_OUT",ALe="SCHEDULE",Bh="SCHEDULE.ASSIGNMENT.VENUE",wu="SCHEDULE.ALLOCATION.COURTS",Ed="SCHEDULE.ASSIGNMENT.COURT",WM="SCHEDULE.COURT.ORDER",Vh="SCHEDULE.DATE",kLe="COMPLETED.DATE",w2="HOME_PARTICIPANT_ID",S2="SCHEDULE.ASSIGN.OFFICIAL",jh="SCHEDULE.TIME.SCHEDULED",go="SCHEDULE.TIME.START",ec="SCHEDULE.TIME.STOP",Kl="SCHEDULE.TIME.RESUME",Ec="SCHEDULE.TIME.END",zM="SCHEDULE.TIME.MODIFIERS",_ne="TO_BE_ANNOUNCED",$ne="NEXT_AVAILABLE",Bne="FOLLOWED_BY",Vne="AFTER_REST",jne="RAIN_DELAY",OLe="NOT_BEFORE",Sx=[_ne,$ne,Bne,Vne,jne],xLe="ELIGIBILITY",FLe="REGISTRATION",LLe="SUSPENSION",_Le="MEDICAL",$Le="PENALTY",Gne="SCALE",Hne="RATING",Wne="RANKING",U2="SEEDING",Jd="PUBLISH",Xa="PUBLIC",Qd="STATUS",BLe="MODIFICATION",VLe="RETRIEVAL",jLe="other",GLe={MUTUALLY_EXCLUSIVE_TIME_MODIFIERS:Sx,AFTER_REST:Vne,ALLOCATE_COURTS:wu,ASSIGN_COURT:Ed,ASSIGN_OFFICIAL:S2,ASSIGN_VENUE:Bh,CHECK_IN:jP,CHECK_OUT:GP,COMPLETED_DATE:kLe,COURT_ORDER:WM,ELIGIBILITY:xLe,END_TIME:Ec,FOLLOWED_BY:Bne,MEDICAL:_Le,MODIFICATION:BLe,NEXT_AVAILABLE:$ne,NOT_BEFORE:OLe,OTHER:jLe,PENALTY:$Le,PUBLIC:Xa,PUBLISH:Jd,RANKING:Wne,RATING:Hne,RAIN_DELAY:jne,REGISTRATION:FLe,RESUME_TIME:Kl,RETRIEVAL:VLe,SCALE:Gne,SCHEDULE:ALe,SCHEDULED_DATE:Vh,SCHEDULED_TIME:jh,SEEDING:U2,START_TIME:go,STATUS:Qd,STOP_TIME:ec,SUSPENSION:LLe,TIME_MODIFIERS:zM,TO_BE_ANNOUNCED:_ne};function Gh({matchUp:t}){if(!t)return{error:aa};if(!t.hasContext)return{error:pM};if(!t.sides||t?.sides.filter(Boolean).length!==2)return{error:sa};let{nestedIndividualParticipantIds:e,allRelevantParticipantIds:i,sideParticipantIds:r}=Lne({matchUp:t}),n=(t.timeItems??[]).filter(o=>o?.itemType&&[jP,GP].includes(o.itemType)).sort((o,l)=>(o.createdAt?new Date(o.createdAt).getTime():0)-(l.createdAt?new Date(l.createdAt).getTime():0)),a=n.map(o=>o.itemValue).filter(o=>n.filter(l=>l?.itemValue===o).reverse()[0].itemType===jP);e?.forEach((o,l)=>{let u=r?.[l],c=o?.length&&o.every(d=>a.includes(d));u&&c&&!a.includes(u)&&a.push(u)}),r?.forEach((o,l)=>{a.includes(o)&&(e?.[l]??[]).forEach(u=>{u&&!a.includes(u)&&a.push(u)})});let s=r?.reduce((o,l)=>a.includes(l)&&o,!0);return{allRelevantParticipantIds:i,allParticipantsCheckedIn:s,checkedInParticipantIds:a,...W}}var Pi=t=>e=>{let i=wt(e)&&e?.matchUpType||ni(e)&&e;return i&&tte[t].includes(i)};function Yy(t){let{matchUpAverageTimes:e,matchUpFormat:i}=t||{},r=e?.map(({matchUpFormatCodes:a})=>a?.filter(s=>s===i)).flat().filter(Boolean).sort((a,s)=>(a?.length||0)-(s?.length||0))||[],n=r.includes(i)?i:r[0];return e?.find(({matchUpFormatCodes:a,averageTimes:s})=>a?.find(o=>n===o)&&s)?.averageTimes}function Ky(t){let{matchUpRecoveryTimes:e,averageMinutes:i,matchUpFormat:r}=t||{};return e?.find(({matchUpFormatCodes:n,averageTimes:a,recoveryTimes:s})=>{if(a&&i){let{greaterThan:o=0,lessThan:l=360}=a;if(i>o&&i<l)return!0}return n?.find(o=>o===r)&&s})?.recoveryTimes}function zne({timesBlockArray:t,categoryName:e,categoryType:i}){return t.filter(r=>Array.isArray(r)).map(r=>r.sort((n,a)=>(a.categoryNames?.length||0)-(n.categoryNames?.length||0)).find(({categoryTypes:n,categoryNames:a})=>!a?.length&&!n?.length||a?.includes(e)||n?.includes(i))).find(Boolean)}function HLe({tournamentScheduling:t,eventScheduling:e,averageMinutes:i,defaultTiming:r,matchUpFormat:n,categoryName:a,categoryType:s,policy:o}){let l=e?.matchUpRecoveryTimes&&Ky({...e,averageMinutes:i,matchUpFormat:n}),u=t?.matchUpRecoveryTimes&&Ky({...t,averageMinutes:i,matchUpFormat:n}),c=o?.matchUpRecoveryTimes&&Ky({...o,averageMinutes:i,matchUpFormat:n}),d=[l,u,c,o?.defaultTimes?.recoveryTimes,r?.recoveryTimes];return zne({categoryName:a,categoryType:s,timesBlockArray:d})}function WLe({matchUpFormat:t,categoryName:e,categoryType:i,defaultTiming:r,tournamentScheduling:n,eventScheduling:a,policy:s}){let o=a?.matchUpAverageTimes&&Yy({...a,matchUpFormat:t}),l=n?.matchUpAverageTimes&&Yy({...n,matchUpFormat:t}),u=s?.matchUpAverageTimes&&Yy({...s,matchUpFormat:t}),c=[o,l,u,s?.defaultTimes?.averageTimes,r?.averageTimes];return zne({categoryName:e,categoryType:i,timesBlockArray:c})}var qne="DOUBLES_SINGLES",Yne="SINGLES_DOUBLES",Hs="total",Ux="participantConflict",Tx="potentialParticipantConflict",es="matchUpConflict",Kne="courtDoubleBooking",Xne="positionLinkConflict",Jne="ISSUE_IDS",xl="CONFLICT",Fl="WARNING",Uy="ERROR",Ty="ISSUE",mD="STATE",zLe="BLOCKED",qLe="PRACTICE",YLe="MAINTENANCE",KLe={SINGLES_DOUBLES:Yne,DOUBLES_SINGLES:qne,TOTAL:Hs,CONFLICT_MATCHUP_ORDER:es,CONFLICT_PARTICIPANTS:Ux,CONFLICT_POTENTIAL_PARTICIPANTS:Tx,CONFLICT_COURT_DOUBLE_BOOKING:Kne,CONFLICT_POSITION_LINK:Xne,SCHEDULE_ISSUE_IDS:Jne,SCHEDULE_CONFLICT:xl,SCHEDULE_WARNING:Fl,SCHEDULE_ERROR:Uy,SCHEDULE_ISSUE:Ty,SCHEDULE_STATE:mD,BLOCKED:zLe,PRACTICE:qLe,MAINTENANCE:YLe};function EU({defaultAverageMinutes:t=90,defaultRecoveryMinutes:e=0,tournamentRecord:i,matchUpFormat:r,categoryName:n,categoryType:a,eventType:s,event:o}){if(!i)return{error:ve};s=s??o?.eventType??$m;let l={averageTimes:[{minutes:{default:t}}],recoveryTimes:[{minutes:{default:e}}]},{scheduleTiming:u}=vU({tournamentRecord:i,categoryName:n,categoryType:a,event:o}),c={...u,matchUpFormat:r,categoryType:a,defaultTiming:l};return qM({eventType:s,timingDetails:c})}function qM({timingDetails:t,eventType:e}){let i=WLe(t),r=Object.keys(i?.minutes||{}),n=i?.minutes&&(r?.includes(e)&&i.minutes[e]||i.minutes.default),a=HLe({...t,averageMinutes:n}),s=Object.keys(a?.minutes||{}),o=a?.minutes&&(s?.includes(e)&&a.minutes[e]||a.minutes.default),l=Pi($m)(e)?Yne:qne,u=a?.minutes&&(s?.includes(l)&&a.minutes[l]||o);return{averageMinutes:n,recoveryMinutes:o,typeChangeRecoveryMinutes:u}}function ek(t){return t.createdAt?new Date(t.createdAt).getTime():0}function Uf({timeItems:t,itemType:e}){let i=t.filter(n=>n&&n.itemType===e).sort((n,a)=>ek(n)-ek(a)).pop(),r=i&&ek(i);return{itemValue:i?.itemValue,timeStamp:r}}function T2({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:r,timeStamp:n}=Uf({timeItems:i?.timeItems||[],itemType:jh});return!e||n&&t&&new Date(n).getTime()>new Date(t).getTime()?{scheduledTime:r}:e}function Tf({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:r,timeStamp:n}=Uf({timeItems:i?.timeItems||[],itemType:Vh});return!e||n&&t&&new Date(n).getTime()>new Date(t).getTime()?{scheduledDate:r}:e}function kf(t){if(zie.test(t)){let e=DB();return new Date(`${e}T${t}`)}else return new Date(t)}function XLe({matchUp:t}){if(!t)return{error:aa};if(!t.timeItems)return{error:pB};let e=t.timeItems.filter(r=>[go,ec,Kl,Ec].includes(r?.itemType)).sort((r,n)=>kf(r.itemValue).getTime()-kf(n.itemValue).getTime()),i=e.reduce((r,n)=>{let a,s=n?.itemType?.split("."),o=`SCHEDULE.TIME.${n?.itemType?.startsWith("SCHEDULE.TIME")&&s[2]}`;switch(o){case go:a=0;break;case Ec:if(r.lastValue&&[go,Kl].includes(r.lastType)){let l=kf(n.itemValue).getTime()-kf(r.lastValue).getTime();a=r.milliseconds+l}else a=r.milliseconds;break;case ec:if([go,"SCHECULE.TIME.RESUME"].includes(r.lastType)){let l=kf(n.itemValue).getTime()-kf(r.lastValue).getTime();a=r.milliseconds+l}else a=r.milliseconds;break;default:a=r.milliseconds;break}return{milliseconds:a,lastType:o,lastValue:n.itemValue}},{milliseconds:0,lastType:void 0,lastValue:void 0});if([go,Kl].includes(i.lastType)){let r=new Date().getTime()-kf(i.lastValue).getTime();i.milliseconds+=r}return{milliseconds:i.milliseconds,time:JLe(i.milliseconds),relevantTimeItems:e}}function JLe(t){let e=(i,r=2)=>("00"+i).slice(-r);return e(t/36e5|0)+":"+e(t%36e5/6e4|0)+":"+e(t%6e4/1e3|0)}function QLe({matchUp:t}){let e=t?.timeItems||[],i=r=>r.createdAt?new Date(r.createdAt).getTime():0;return{startTime:e.reduce((r,n)=>{let a=n.itemType===go&&n;return a&&(!r||i(a)<i(r))?a:r},void 0)?.itemValue}}function HP(t){return parseInt(t)}function WP({startTime:t="",endTime:e=""}={}){if(!t||!e||!cp.test(t)||!cp.test(e))return!1;let[i,r]=t.split(":").map(HP),[n,a]=e.split(":").map(HP);return n<i?!1:!(i===n&&a<r)}function ZLe(t,e){let[i,r]=t.startTime.split(":").map(HP),[n,a]=e.startTime.split(":").map(HP);return i<n?-1:i>n?1:r<a?-1:r>a?1:0}function YM({dateAvailability:t}){if(!t)return{error:Hte};if(!Array.isArray(t))return{error:uD};let e="Dates must be formated => YYYY-MM-DD",i="Times must be 24 hour => 00:00";for(let r of t){if(typeof r!="object")return{error:uD};let{date:n,startTime:a,endTime:s,bookings:o=[]}=r;if(!a||!s)return{error:uD};if(n&&!dl.test(n))return{error:or,dateAvailability:{date:n},info:e};if(!cp.test(a))return{error:Es,dateAvailability:{startTime:a},info:i};if(!cp.test(s))return{error:Es,dateAvailability:{endTime:s},info:i};if(a===s)return{error:Es,dateAvailability:{startTime:a,endTime:s},info:"startTime and endTime are equivalent"};if(!WP({startTime:a,endTime:s}))return{error:Es,dateAvailability:{startTime:a,endTime:s},info:"endTime must be after startTime"};if(o){if(!Array.isArray(o))return{error:CP};for(let l of o){if(typeof l!="object")return{error:CP};let{startTime:u,endTime:c}=l;if(!cp.test(u))return{error:Es,booking:{startTime:u},info:i};if(!cp.test(c))return{error:Es,booking:{endTime:c},info:i};if(u===c)return{error:Es,dateAvailability:{startTime:u,endTime:c},info:"startTime and endTime are equivalent"};if(!WP({startTime:u,endTime:c}))return{error:Es,dateAvailability:{startTime:u,endTime:c},info:"endTime must be after startTime"}}}}return{valid:!0}}function Qne({tournamentRecord:t}){for(let e of t.venues??[])e.isPrimary&&delete e.isPrimary}function RU(t){let{disableNotice:e,venue:i,context:r}=t;if(typeof i!="object")return{error:re};let n=ws(t);i.venueId||(i.venueId=Ct());let a;for(let s of Object.values(n)){let o=e0e({disableNotice:!0,tournamentRecord:s,context:r,venue:i});if(o?.error)return o;a=o.venue}return e||st({topic:hne,payload:{venue:i}}),je({...W,venue:a})}function e0e({tournamentRecord:t,disableNotice:e,context:i,venue:r}){if(!t)return{error:ve};if(!r)return{error:Je,info:"missing venue"};if(t.venues||(t.venues=[]),r.venueId||(r.venueId=Ct()),t.venues.reduce((n,a)=>n||a.venueId===r.venueId,void 0))return{error:cie};if(r.dateAvailability?.length){let n=YM({dateAvailability:r.dateAvailability});if(n.error)return n}if(r.defaultStartTime||r.defaultEndTime){if(!r.defaultStartTime||!r.defaultEndTime)return{error:re,info:"both defaultStartTime and defaultEndTime are required"};if(!WP({startTime:r.defaultStartTime,endTime:r.defaultEndTime}))return{error:re,info:"defaultEndTime must be after defaultStartTime"}}return i&&Ft({element:r,extension:{value:i,name:Zre}}),r.isPrimary&&Qne({tournamentRecord:t}),t.venues.push(r),{...W,venue:Oe(r)}}function Ou({tournamentRecords:t,tournamentRecord:e,venueId:i}){if(!e)return{error:ve};if(!i)return{error:zd};let r=(e.venues??[]).reduce((n,a)=>a.venueId===i?a:n,void 0);if(!r&&t){let n=(fU({tournamentRecords:t}).linkedTournamentIds??[])[e.tournamentId];for(let a of n){let s=t[a],o=Ou({tournamentRecord:s,venueId:i});if(o.success&&o.venue)return RU({tournamentRecord:e,venue:o.venue}),{...W,venue:r}}}return r?{...W,venue:r}:{error:gf}}function D2({convertExtensions:t,...e}){let{tournamentRecords:i,tournamentRecord:r,venueId:n}=e,a=Ou({tournamentRecords:i,tournamentRecord:r,venueId:n});return Oe(a,t,!0)}function Zd({tournamentRecords:t,tournamentRecord:e,courtId:i}){if(!e)return{error:ve};if(!i)return{error:Mh};let r="findCourt",n,a;if((e.venues??[]).forEach(s=>{(s.courts??[]).forEach(o=>{o.courtId===i&&(n=o,a=s)})}),n)return{...W,court:n,venue:a};if(t){let s=(fU({tournamentRecords:t}).linkedTournamentIds??[])[e.tournamentId];for(let o of s){let l=t[o],u=Zd({tournamentRecord:l,courtId:i});if(u.success)return u.venue&&RU({tournamentRecord:e,venue:u.venue}),{...W,court:n,venue:a}}}return q({result:{error:Ic},stack:r})}function P2(t){return Oe(Zd(t),!1,!0)}function KM({tournamentRecord:t,internalUse:e,courtId:i}){if(!t)return{error:ve};if(!i)return{error:Mh};let r=Zd({tournamentRecord:t,courtId:i});if(r.error)return r;let n=r.court&&(({altitude:a,courtId:s,courtName:o,courtDimensions:l,latitude:u,longitude:c,surfaceCategory:d,surfaceType:p,surfacedDate:f,pace:m,notes:h})=>({altitude:a,courtId:s,courtName:o,courtDimensions:l,latitude:u,longitude:c,surfaceCategory:d,surfaceType:p,surfacedDate:f,pace:m,notes:h}))(r.court);return{...W,courtInfo:Oe(n,!1,e)}}function MI(t){let e=He(t,[{[hr]:!0},{venueId:!0,[js]:zd}]);if(e.error)return e;let{tournamentRecord:i,venueId:r}=t,n=Ou({tournamentRecord:i,venueId:r});if(n.error)return n;let a=(n.venue?.courts??[]).map(l=>(({courtInfo:u})=>({...u}))(KM({courtId:l.courtId,internalUse:!0,tournamentRecord:i}))),s=n.venue&&(({venueId:l,venueName:u,venueAbbreviation:c})=>({venueAbbreviation:c,venueName:u,venueId:l}))(n.venue),o=s&&{...s,courtsInfo:a};return{...W,venueData:Oe(o,!1,!0)}}function t0e({matchUp:t}){let e=t?.timeItems||[],i=r=>r.createdAt?new Date(r.createdAt).getTime():0;return{endTime:e.reduce((r,n)=>{let a=n.itemType===Ec&&n;return a&&(!r||i(a)>i(r))?a:r},void 0)?.itemValue}}function Bi({event:t,eventId:e}){if(!t)return{error:ui};let i=ht({name:to,element:t})?.extension,r=e?Oe(i?.value,!1,!0):i?.value;return e&&t.drawDefinitions?.forEach(n=>{r?.flights?.forEach(a=>{a.drawId===n.drawId&&Object.assign(a,{drawDefinition:n})})}),{flightProfile:r}}function Wn(t){let{tournamentRecord:e,eventId:i,drawId:r}=t,n="findEvent",a={},s=t.tournamentRecords??(e&&{[e.tournamentId]:e})??{},o=Object.values(s).map(({events:u,tournamentId:c})=>(u&&u.forEach(d=>{a[d.eventId]={tournamentId:c}}),u??[])).flat(),l;if(r){let u,c=o.find(d=>{let p=(d?.drawDefinitions??[]).find(f=>f.drawId===r);if(p)u=p,l=a[d.eventId].tournamentId;else{let f=(d&&Bi({event:d})?.flightProfile)?.flights?.find(m=>m.drawId===r);if(f)return l=a[d.eventId].tournamentId,{entries:f.drawEntries,drawName:f.drawName,tournamentId:l,drawId:r}}return p});if(c)return{event:c,drawDefinition:u,tournamentId:l}}if(i){let u=o.find(c=>c?.eventId===i);if(u)l=a[u.eventId].tournamentId;else return{event:void 0,drawDefinition:void 0,...q({result:{error:ps},stack:n})};return{event:u,drawDefinition:void 0,tournamentId:l}}return{event:void 0,drawDefinition:void 0,...q({result:{error:_a},context:{drawId:r,eventId:i},stack:n})}}function XM(t){let e=t.event,i=t.matchUpType,{scheduleVisibilityFilters:r,afterRecoveryTimes:n,tournamentRecord:a,usePublishState:s,scheduleTiming:o,matchUpFormat:l,publishStatus:u,matchUp:c}=t;if(!c)return{error:aa};if(n&&!c.matchUpType&&!t.matchUpType&&(e||a)&&c.drawId){let b=t.drawDefinition||e?.drawDefinitions?.find(U=>U.drawId===c.drawId);!b&&a&&({drawDefinition:b,event:e}=Wn({drawId:c.drawId,tournamentRecord:a}));let S=c.structureId&&b?.structures?.find(({structureId:U})=>U===c.structureId);i=t.matchUpType||S?.matchUpType||b?.matchUpType||e?.eventType!==ar&&e?.eventType}let{milliseconds:d,time:p}=XLe({matchUp:c}),{startTime:f}=QLe({matchUp:c}),{endTime:m}=t0e({matchUp:c}),h,{eventIds:g,drawIds:I}=r??{};if((!g||g.includes(c.eventId))&&(!I||I.includes(c.drawId))){let b=X=>X.createdAt?new Date(X.createdAt).getTime():0,S=new Map,U=c.timeItems?.toSorted((X,Z)=>b(X)-b(Z))??[];for(let X of U)S.set(X.itemType,X.itemValue);let T=S.get(w2),P=S.get(wu),D=S.get(jh),E=S.get(zM),R=S.get(Vh),C=S.get(S2),M=S.get(WM),N=S.get(Bh),A=S.get(Ed),O,k,F,x,L,$=c.matchUpType??i;if(o&&D&&n&&$){let X={matchUpFormat:c.matchUpFormat??l,...o};({averageMinutes:k=0,recoveryMinutes:F=0,typeChangeRecoveryMinutes:x=0}=qM({timingDetails:X,eventType:$})),(k||F)&&(O=m?Qn(pi(m),F):Qn(D,k+F)),x&&(L=m?Qn(pi(m),x):Qn(D,k+x))}!R&&D&&(R=Ze(D));let V=NP({scheduledDate:R,scheduledTime:D}),_={},B=(a&&N&&MI({tournamentRecord:a,venueId:N}))?.venueData||{};N&&(_[N]=B);let{venueName:G,venueAbbreviation:j,courtsInfo:K}=B,Y=(A&&K?.find(X=>X.courtId===A))?.courtName;for(let X of P||[]){if(!a)break;X.venueId&&!_[X.venueid]&&(_[X.venueId]=MI({venueId:X.venueId,tournamentRecord:a})?.venueData);let Z=_[X.venueId];X.venueName=Z?.venueName;let J=Z?.courtsInfo?.find(ae=>ae.courtId===X.courtId);X.courtName=J?.courtName}h=je({typeChangeTimeAfterRecovery:L,timeAfterRecovery:O,scheduledDate:R,scheduledTime:D,isoDateString:V,homeParticipantId:T,venueAbbreviation:j,allocatedCourts:P,timeModifiers:E,venueName:G,venueId:N,courtOrder:M,courtName:Y,courtId:A,official:C,typeChangeRecoveryMinutes:x,recoveryMinutes:F,averageMinutes:k,milliseconds:d,startTime:f,endTime:m,time:p})}else h=je({milliseconds:d,startTime:f,endTime:m,time:p});let{scheduledDate:v}=Tf({matchUp:c}),{scheduledTime:w}=T2({matchUp:c});if(s&&u?.displaySettings?.draws){let b=u.displaySettings.draws,S=(b?.[c.drawId]??b?.default)?.scheduleDetails;if(S){let U=(S.find(T=>v&&T.dates?.includes(v))??S.find(T=>!T.dates?.length))?.attributes;if(U){let T=Object.assign({},...Object.keys(h).map(P=>({[P]:!0})),U);h=Vm({source:h,template:T})}}}let y=c.matchUpStatus&&Ki.includes(c.matchUpStatus)&&(Ze(m)||Ze(v)||Ze(w))||void 0;return{schedule:h,endDate:y}}function i0e({drawPositions:t,roundProfile:e,roundNumber:i}){let r=[void 0,void 0];if(ute(t))return{orderedDrawPositions:r,displayOrder:r};let n=e?.[i],a=n?.pairedDrawPositions?.find(o=>xn(o||[],t.filter(Boolean)))??r,s=n?.feedRound;if(lte(t)){let o=[...t].sort(nr);return{orderedDrawPositions:o.length===2?o:a,displayOrder:s?o:a}}if(s){let o=[t.find(l=>!isNaN(Ke(l))),void 0];return{orderedDrawPositions:o,displayOrder:o}}return{orderedDrawPositions:a,displayOrder:a}}function zP({collectionPosition:t,collectionId:e,lineUp:i}){let r=[],n=[];if(i){let a=o=>o===void 0?-1:o,s=i.map(o=>{let{collectionAssignments:l,participantId:u}=o,c=l?.find(d=>d.collectionPosition===t&&d.collectionId===e);return c&&{participantId:u,...c}}).filter(Boolean).sort((o,l)=>a(o.substitutionOrder)-a(l.substitutionOrder));for(let o of s){let{participantId:l,previousParticipantId:u,substitutionOrder:c}=o;r.includes(l)||(u&&n.push({previousParticipantId:u,substitutionOrder:c,participantId:l}),r=r.filter(d=>d!==u),r.push(l))}}return{assignedParticipantIds:r,substitutions:n}}function ro({tournamentParticipants:t,tournamentRecord:e,participantIds:i}){let r="getPairedParticipant";if(!t&&!e)return{error:ve};if(!Array.isArray(i)||i.length>2)return{error:Ia};if(!i.length)return q({result:{error:Wd},stack:r});t=t??e?.participants??[];let n=t.filter(o=>o.participantType===ft&&Li(i,o.individualParticipantIds).length===i.length&&o.individualParticipantIds.length===i.length),a=n[0];if(!a)return q({result:{error:ji},stack:r});let s=Oe(n.slice(1),!1,!0);return{participant:Oe(a),duplicatedPairParticipants:s,...W}}function Hp({drawDefinition:t,participantId:e}){if(typeof t!="object")return{error:$e};if(typeof e!="string")return{error:dr};let{extension:i}=ht({element:t,name:Sc});return{lineUp:(i?.value||{})[e]}}function r0e({tournamentParticipants:t,positionAssignments:e,collectionPosition:i,drawPositions:r=[],participantMap:n,drawDefinition:a,collectionId:s,sideLineUps:o,matchUpType:l}){if(!s||!i)return{};let u=({attribute:d,lineUp:p,teamParticipant:f})=>{let{assignedParticipantIds:m,substitutions:h}=zP({collectionPosition:i,collectionId:s,lineUp:p});if(l===Bt){if(m?.length<=2){let g=n?.[m[0]]?.pairIdMap?.[m[1]],I=(g&&n[g]?.participant||ro({participantIds:m,tournamentParticipants:t}).participant)?.participantId;return{[d]:{participantId:I,teamParticipant:f,substitutions:h}}}else if(m?.length>2)return{[d]:{teamParticipant:f,substitutions:h}}}else{let g=m?.[0];return g&&{[d]:{participantId:g,teamParticipant:f,substitutions:h}}}};if(!r?.length){let d=o?.map(p=>{let{teamParticipant:f,sideNumber:m}=p,h=p.lineUp||Hp({participantId:f.teamParticipantId,drawDefinition:a})?.lineUp;return u({attribute:m,lineUp:h,teamParticipant:f})}).filter(Boolean)||{};return{sideNumberCollectionAssignment:Object.assign({},...d)}}let c=r?.map(d=>{let p=e.find(g=>g.drawPosition===d)?.participantId,f=o?.find(g=>g?.drawPosition===d),m=f?.teamParticipant||p&&n?.[p]?.participant||t?.find(({participantId:g})=>g===p),h=f?.lineUp||Hp({participantId:p,drawDefinition:a})?.lineUp;return u({attribute:d,lineUp:h,teamParticipant:m})}).filter(Boolean)||{};return{drawPositionCollectionAssignment:Object.assign({},...c)}}function JM(t){let e=He(t,[{[Au]:!0}]);if(e.error)return e;let i=t?.matchUp,r=i?.matchUpType;if(!r&&i?.sides?.length){let n=i.sides.find(({participant:a})=>a)?.participant?.participantType;r=n===It&&zt||n===ft&&Bt||n===_t&&_t||void 0}return{matchUpType:r}}function n0e({drawPositionCollectionAssignment:t,sideNumberCollectionAssignment:e,positionAssignments:i,displaySideNumber:r,seedAssignments:n,drawPosition:a,isFeedRound:s,sideNumber:o}){let l=i.find(f=>f.drawPosition&&f.drawPosition===a),u=a&&t,c=o&&e,d=u?u[a]?.participantId:l?.participantId,p=l?a0e({displaySideNumber:r,seedAssignments:n,participantId:d,assignment:l,sideNumber:o}):{...c?.[o]};if(s&&(o===1?Object.assign(p,{participantFed:!0}):Object.assign(p,{participantAdvanced:!0})),a&&u){let f=u[a]?.teamParticipant,m=u[a]?.participant,h=u[a]?.substitutions;m&&(p.participant=m),h&&(p.substitutions=h),f&&(p.teamParticipant=f)}return p}function a0e({displaySideNumber:t,seedAssignments:e,participantId:i,assignment:r,sideNumber:n}){let a={drawPosition:r.drawPosition,displaySideNumber:t,sideNumber:n};if(i){let s=s0e({seedAssignments:e,participantId:i});Object.assign(a,s,{participantId:i}),s?.seedNumber&&s?.seedValue===""&&(a.seedValue="~")}else r.bye&&Object.assign(a,{bye:!0});return r.qualifier&&Object.assign(a,{qualifier:!0}),a}function s0e({seedAssignments:t,participantId:e}){return t?.find(i=>!i.seedProxy&&i.participantId===e)}function Zne({scheduleVisibilityFilters:t,sourceDrawPositionRanges:e,tournamentParticipants:i,positionAssignments:r,drawPositionsRanges:n,hydrateParticipants:a,afterRecoveryTimes:s,initialRoundOfPlay:o,additionalContext:l,roundNamingProfile:u,tournamentRecord:c,tieDrawPositions:d,appliedPolicies:p,isCollectionBye:f,seedAssignments:m,usePublishState:h,participantMap:g,contextContent:I,scheduleTiming:v,contextProfile:w,drawDefinition:y,publishStatus:b,scoringActive:S,matchUpTieId:U,isRoundRobin:T,roundProfile:P,sideLineUps:D,structure:E,context:R,matchUp:C,event:M}){l=l??{};let N=yn({drawDefinition:y,structure:E,matchUp:C,event:M})?.tieFormat,{roundOffset:A,structureId:O,structureName:k,stage:F,stageSequence:x}=E,{drawId:L,drawName:$,drawType:V}=y??{},_=N?.collectionDefinitions,B=C.collectionId&&_?.find(Q=>Q.collectionId===C.collectionId),G=C.collectionId?B?.matchUpFormat:C.matchUpFormat??E?.matchUpFormat??y?.matchUpFormat??M?.matchUpFormat,j=C.matchUpType||B?.matchUpType||E?.matchUpType||y?.matchUpType||!Pi(ar)(M?.eventType)&&M?.eventType,K=f?"BYE":C.matchUpStatus,{schedule:Y,endDate:X}=XM({scheduleVisibilityFilters:t,afterRecoveryTimes:s,tournamentRecord:c,usePublishState:h,scheduleTiming:v,drawDefinition:y,matchUpFormat:G,publishStatus:b,matchUpType:j,matchUp:C,event:M}),Z=d??C.drawPositions??[],{collectionPosition:J,collectionId:ae,roundPosition:te}=C,ne=C.roundNumber??l.roundNumber,le=ae?r0e({tournamentParticipants:i,positionAssignments:r,collectionPosition:J,participantMap:g,drawDefinition:y,drawPositions:Z,collectionId:ae,sideLineUps:D,matchUpType:j}):void 0,de=u?.[ne]?.roundName||l.roundName,pe=u?.[ne]?.abbreviatedRoundName||l.abbreviatedRoundName,ge=P?.[ne]?.feedRound,Me=P?.[ne]?.preFeedRound,Pe=P?.[ne]?.roundFactor,Be=n?.[ne],fe=te?Be?.[te]:void 0,Te=e?.[ne],ce=B?.category?{...R?.category,...B.category}:R?.category??M?.category,ye=C.processCodes?.length&&C.processCodes||B?.processCodes?.length&&B?.processCodes||E?.processCodes?.length&&E?.processCodes||y?.processCodes?.length&&y?.processCodes||M?.processCodes?.length&&M?.processCodes||c?.processCodes,be=w?.withCompetitiveness&&PU({...I,matchUp:C}),Fe=C.finishingPositionRange??l.finishingPositionRange,we=F!==ze&&lt(o)&&o+(ne||0),Ne=Q=>je(Q,void 0,!0),me={...Ne(R),...Ne({matchUpFormat:j===ar?void 0:G,tieFormat:j===ar?N:void 0,gender:B?.gender??M?.gender,endDate:C.endDate??X,discipline:M?.discipline,category:ce,finishingPositionRange:Fe,abbreviatedRoundName:pe,drawPositionsRange:fe,competitiveProfile:be,structureName:k,stageSequence:x,drawPositions:Z,matchUpStatus:K,processCodes:ye,isRoundRobin:T,matchUpTieId:U,preFeedRound:Me,matchUpType:j,roundFactor:Pe,roundOffset:A,structureId:O,roundNumber:ne,roundOfPlay:we,feedRound:ge,roundName:de,drawName:$,drawType:V,schedule:Y,drawId:L,stage:F}),...Oe(Ne(C),!0,!0)};if(G&&C.score?.scoreStringSide1){let Q=qi(G),{bestOf:se,finalSetFormat:oe,setFormat:ue}=Q??{};(oe?.tiebreakSet||ue?.tiebreakSet||ue?.timed)&&(me.score.sets=me.score.sets.sort((ee,Se)=>ee.setNumber-Se.setNumber).map((ee,Se)=>{let De=Se+1===se&&oe?oe:ue,it=De?.tiebreakSet&&!De?.timed,Ue=De?.timed;return it?(ee.tiebreakSet=!0,[1,2].includes(ee.winningSide)&&(ee.side1Score=ee.winningSide===1?1:0,ee.side2Score=ee.winningSide===2?1:0)):Ue&&(ee.timed=!0),ee}))}if(Array.isArray(Z)){let{orderedDrawPositions:Q,displayOrder:se}=i0e({drawPositions:Z,roundProfile:P,roundNumber:ne}),oe=P?.[ne]?.feedRound,ue=se[0]!==Q[0],ee=Q.concat(void 0,void 0).slice(0,2).map((Se,De)=>{let it=De+1,Ue=ue?3-it:it,ut=n0e({...le,positionAssignments:r,displaySideNumber:Ue,seedAssignments:m,drawPosition:Se,isFeedRound:oe,sideNumber:it}),yi=C.sides?.find(oi=>oi.sideNumber===it),qe=te?(te-1)*2+De+1:void 0,bi=qe?Te?.[qe]:void 0;return Ne({sourceDrawPositionRange:bi,...yi,...ut})});Object.assign(me,Oe({sides:ee},!0,!0))}if(i&&me.sides){let Q=p?.[Lv],se=oe=>{let ue=g?.[oe]?.participant;return ue&&Vm({template:Q?.participant,source:ue})};if(me.sides.filter(Boolean).forEach(oe=>{if(oe.participantId){let ue=Oe(se(oe.participantId)||(i?Ud({policyDefinitions:p,participantId:oe.participantId,tournamentParticipants:i,internalUse:!0,contextProfile:w}):void 0),void 0,!0);if(ue){let ee,Se;if(y?.entries){let De=y.entries.find(Ue=>Ue.participantId===oe.participantId),it=M?.entries?.find(Ue=>Ue.participantId===oe.participantId);ee=De?.entryStatus||it?.entryStatus,ue.entryStatus=ee,De?.entryStage&&(Se=De.entryStage,ue.entryStage=Se)}a===!1?Object.assign(oe,{participant:{entryStage:Se,entryStatus:ee}}):Object.assign(oe,{participant:ue})}}if(oe?.participant?.individualParticipantIds?.length&&!oe.participant.individualParticipants?.length){let ue=oe.participant.individualParticipantIds.map(ee=>se(ee)||(i?Ud({policyDefinitions:p,tournamentParticipants:i,internalUse:!0,contextProfile:w,participantId:ee}):void 0));a!==!1&&Object.assign(oe.participant,{individualParticipants:ue})}}),!me.matchUpType){let{matchUpType:oe}=JM({matchUp:me});oe&&Object.assign(me,{matchUpType:oe})}if(w?.inferGender&&(!me.gender||me.gender===Oh)&&me.sides?.length===2&&me.matchUpType!==ar){let oe=me.sides.map(ue=>{if(Pi(zt)(me.matchUpType))return ue.participant?.person?.sex;if(ue.participant?.individualParticipants?.length===2){let ee=nt(ue.participant.individualParticipants.map(Se=>Se.person?.sex)).filter(Boolean);if(ee.length===1)return ee[0]}});if(oe.filter(Boolean).length===2&&nt(oe).length===1){let ue=oe[0];me.inferredGender=ue}}}if(me.tieMatchUps){let Q=me.matchUpStatus==="BYE",se=me.sides?.map(({participant:oe,drawPosition:ue,sideNumber:ee,lineUp:Se})=>{let De=oe?.participantType===ar&&oe;return{teamParticipant:De&&je({participantRoleResponsibilities:De.participantRoleResponsibilities,participantOtherName:De.participanOthertName,participantName:De.participantName,participantId:De.participantId,teamId:De.teamId}),drawPosition:ue,sideNumber:ee,lineUp:Se}});me.tieMatchUps=me.tieMatchUps.map(oe=>{let ue=me.matchUpId,ee={finishingPositionRange:me.finishingPositionRange,abbreviatedRoundName:pe,roundNumber:ne,roundName:de};return Zne({tieDrawPositions:Z,scheduleVisibilityFilters:t,sourceDrawPositionRanges:e,sideLineUps:se,drawPositionsRanges:n,initialRoundOfPlay:o,roundNamingProfile:u,additionalContext:ee,appliedPolicies:p,isCollectionBye:Q,usePublishState:h,publishStatus:b,matchUpTieId:ue,isRoundRobin:T,roundProfile:P,matchUp:oe,event:M,tournamentParticipants:i,positionAssignments:r,tournamentRecord:c,seedAssignments:m,participantMap:g,contextContent:I,scheduleTiming:v,contextProfile:w,drawDefinition:y,scoringActive:S,structure:E,context:R})})}let Ee=me.sides?.filter(Q=>Q?.participantId).length===2,Le=!me.winningSide;if(Object.assign(me,{readyToScore:S&&Ee&&Le,hasContext:!0}),Ee){let{allParticipantsCheckedIn:Q,checkedInParticipantIds:se}=Gh({matchUp:me});Object.assign(me,{allParticipantsCheckedIn:Q,checkedInParticipantIds:se})}return Array.isArray(w?.exclude)&&w?.exclude.forEach(Q=>delete me[Q]),me}function o0e({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:r,timeStamp:n}=Uf({timeItems:i?.timeItems||[],itemType:wu});return!e||n&&t&&new Date(n).getTime()>new Date(t).getTime()?{allocatedCourts:Oe(r,!1,!0)}:e}function l0e({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:r,timeStamp:n}=Uf({timeItems:i?.timeItems||[],itemType:Ed});return!e||n&&t&&new Date(n).getTime()>new Date(t).getTime()?{courtId:r}:e}function u0e({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:r,timeStamp:n}=Uf({timeItems:i?.timeItems||[],itemType:Bh});return!e||n&&t&&new Date(n).getTime()>new Date(t).getTime()?{venueId:r}:e}function Yu(t){if(!Array.isArray(t.matchUps))return[];let{matchUps:e,excludeMatchUpStatuses:i,hasParticipantsCount:r,isCollectionMatchUp:n,matchUpStatuses:a,hasWinningSide:s,matchUpFormats:o,roundPositions:l,matchUpFormat:u,collectionIds:c,isMatchUpTie:d,roundNumbers:p,matchUpIds:f,roundNames:m,filterMatchUpTypes:h=!0,filterMatchUpIds:g=!0,stageSequences:I,scheduledDates:v,scheduledDate:w,participantIds:y,processContext:b,tournamentIds:S,matchUpTypes:U,structureIds:T,readyToScore:P,courtIds:D,eventIds:E,venueIds:R,drawIds:C,stages:M}=t,N=Array.isArray(y)?y.filter(Boolean):[],A=Array.isArray(a)?a.filter(Boolean):[],O=Array.isArray(i)?i.filter(Boolean):[],k=Array.isArray(M)?M.filter(Boolean):[],F=Array.isArray(I)?I.filter(Boolean):[],x=Array.isArray(c)?c.filter(Boolean):[],L=Array.isArray(m)?m.filter(Boolean):[],$=Array.isArray(p)?p.filter(Boolean):[],V=Array.isArray(l)?l.filter(Boolean):[],_=Array.isArray(f)&&g?f.filter(Boolean):[],B=Array.isArray(U)&&h?U.filter(Boolean):[],G=Array.isArray(D)?D.filter(Boolean):[],j=Array.isArray(R)?R.filter(Boolean):[],K=Array.isArray(o)&&o.filter(Boolean)||typeof u=="string"&&[u]||[],Y=Array.isArray(v)&&v.filter(Boolean)||typeof w=="string"&&w.length&&[w]||[],X=Array.isArray(S)?S.filter(Boolean):[],Z=Array.isArray(E)?E.filter(Boolean):[],J=Array.isArray(C)?C.filter(Boolean):[],ae=Array.isArray(T)?T.filter(Boolean):[];return e.filter(te=>{if(P&&!Pi(La)(te)&&!te.readyToScore||te.winningSide&&s&&![1,2].includes(te.winningSide)||d!==void 0&&(d&&!te.tieMatchUps||!d&&te.tieMatchUps)||n!==void 0&&(n&&!te.collectionId||!n&&te.collectionId)||k.length&&!k.includes(te.stage)||F.length&&!F.includes(te.stageSequence)||x.length&&(!te.collectionId||!x.includes(te.collectionId))||L.length&&(!te.roundName||!L.includes(te.roundName))||$.length&&(!te.roundNumber||!$.includes(te.roundNumber))||V.length&&(!te.roundPosition||!V.includes(te.roundPosition))||A.length&&(!te.matchUpStatus||!A.includes(te.matchUpStatus))||O.length&&te.matchUpStatus&&O.includes(te.matchUpStatus)||_.length&&!_.includes(te.matchUpId)||B.length&&(!te.matchUpType||!pm(B,te.matchUpType))||K.length&&(!te.matchUpFormat||!K.includes(te.matchUpFormat)))return!1;if(Y?.length){let{scheduledTime:ne}=T2({matchUp:te}),{scheduledDate:le}=Tf({matchUp:te}),de=Ze(ne)||le;if(!Y.some(pe=>pu(pe,de)))return!1}if(G.length){let{courtId:ne}=l0e({matchUp:te}),{allocatedCourts:le}=o0e({matchUp:te}),de=le?.map(({courtId:pe})=>pe);if(!G.filter(Boolean).includes(ne)||de?.includes(ne))return!1}if(j.length){let{venueId:ne}=u0e({matchUp:te});if(!j.filter(Boolean).includes(ne))return!1}if(b){if(X.length&&!X.includes(te.tournamentId)||Z.length&&!Z.includes(te.eventId)||J.length&&!J.includes(te.drawId)||ae.length&&!ae.includes(te.structureId))return!1;let ne=te.sides?.map(({participantId:le})=>le).filter(Boolean)??[];if(r&&ne.length<r||N.length&&!N.some(le=>ne.includes(le)))return!1}return!0})}function At(t){let{provisionalPositioning:e,tournamentRecord:i,contextFilters:r,matchUpFilters:n,contextProfile:a,drawDefinition:s,context:o={},structure:l,inContext:u,event:c}=t,{seedAssignments:d,contextContent:p,exitProfiles:f,matchUpsMap:m}=t,h={},g={};if(!l)return{collectionPositionMatchUps:h,error:mf,roundMatchUps:g,matchUps:[]};let I=Array.isArray(n?.eventIds)?n?.eventIds.filter(Boolean):[],v=Array.isArray(n?.structureIds)?n?.structureIds.filter(Boolean):[],w=Array.isArray(n?.drawIds)?n?.drawIds.filter(Boolean):[],y=!o?.eventId||!I?.length&&!r?.eventIds?.filter(Boolean).length||I?.includes(o.eventId)||r?.eventIds?.includes(o.eventId),b=!v?.length||v.includes(l.structureId),S=!s||!w?.length||w.includes(s.drawId);if(!y||!b||!S)return{collectionPositionMatchUps:h,roundMatchUps:g,matchUps:[]};a&&!p&&(p=Gc({tournamentRecord:i,contextProfile:a,drawDefinition:s}));let{appliedPolicies:U}=Dt({drawDefinition:s}),T={...t.tournamentAppliedPolicies,...U,...t.policyDefinitions},P=T?.scoring?.structures,D=l.stage&&P?.stage?.[l.stage],E=l.stageSequence&&D?.stageSequence?.[l.stageSequence],R=T?.scoring?.requireAllPositionsAssigned||D?.requireAllPositionsAssigned||E?.requireAllPositionsAssigned;m||(m=kr({drawDefinition:s,structure:l}));let{positionAssignments:C,allPositionsAssigned:M}=pr({structure:l}),N=!R||M,{seedAssignments:A}=hs({provisionalPositioning:e,drawDefinition:s,structure:l});d=d??A;let{structureId:O}=l;f=f||s&&Ane({drawDefinition:s}).exitProfiles;let k=f?.[O],F=k?.length&&(k[0].split("-").map(G=>parseInt(G)).reduce((G,j)=>G+j)||0),x=!!l.structures,L=Pd({matchUpsMap:m,structureId:O,inContext:u}),$=T?.[wc],V=kne({roundNamingPolicy:$,drawDefinition:s,structure:l,matchUps:L}),{roundNamingProfile:_,roundProfile:B}=V;if(g=V?.roundMatchUps??[],n&&(L=Yu({matchUps:L,...n,filterMatchUpTypes:!1,filterMatchUpIds:!1})),u){let{sourceDrawPositionRanges:G}=ELe({drawDefinition:s,matchUpsMap:m,structureId:O}),j=s?RLe({drawDefinition:s,roundProfile:B,matchUpsMap:m,structureId:O}).drawPositionsRanges:void 0,K=t.tournamentParticipants,Y=t.participantMap;!K?.length&&!Y&&i&&({participants:K=[],participantMap:Y}=yf({participantsProfile:t.participantsProfile,useParticipantMap:t.useParticipantMap,policyDefinitions:t.policyDefinitions,tournamentRecord:i,contextProfile:a,inContext:u})),L=L.map(X=>Zne({scheduleVisibilityFilters:t.scheduleVisibilityFilters,hydrateParticipants:t.hydrateParticipants,afterRecoveryTimes:t.afterRecoveryTimes,usePublishState:t.usePublishState,scheduleTiming:t.scheduleTiming,publishStatus:t.publishStatus,sourceDrawPositionRanges:G,tournamentParticipants:K,positionAssignments:C,drawPositionsRanges:j,initialRoundOfPlay:F,roundNamingProfile:_,tournamentRecord:i,appliedPolicies:T,seedAssignments:d,contextContent:p,participantMap:Y,contextProfile:a,drawDefinition:s,scoringActive:N,isRoundRobin:x,roundProfile:B,structure:l,context:o,matchUp:X,event:c})),(L?.filter(X=>Array.isArray(X.tieMatchUps))).forEach(X=>{let Z=X.tieMatchUps;L=L.concat(...Z)}),r&&(L=Yu({processContext:!0,...r,matchUps:L}))}else(L?.filter(G=>Array.isArray(G.tieMatchUps))).forEach(G=>{let j=G.tieMatchUps;L=L.concat(...j)});return n&&(L=Yu({matchUps:L,...n,filterMatchUpTypes:!1,filterMatchUpIds:!1})),(n?.matchUpTypes||n?.matchUpIds)&&(L=Yu({matchUpTypes:n.matchUpTypes,matchUpIds:n.matchUpIds,matchUps:L})),(n?.matchUpTypes||n?.matchUpIds||u)&&(g=Sn({matchUps:L}).roundMatchUps??[]),yn({drawDefinition:s,structure:l,event:c})?.tieFormat&&({collectionPositionMatchUps:h}=DLe({matchUps:L})),{collectionPositionMatchUps:h,roundMatchUps:g,isRoundRobin:x,roundProfile:B,matchUpsMap:m,matchUps:L}}function vp({matchUp:t}){return t?Ki.includes(t?.matchUpStatus)||t?.winningSide:!1}function QM({requireParticipants:t=!0,scheduleVisibilityFilters:e,tournamentAppliedPolicies:i,tournamentParticipants:r,hydrateParticipants:n,afterRecoveryTimes:a,policyDefinitions:s,tournamentRecord:o,usePublishState:l,matchUpFilters:u,contextFilters:c,contextContent:d,participantMap:p,scheduleTiming:f,publishStatus:m,contextProfile:h,drawDefinition:g,exitProfiles:I,matchUpsMap:v,structureId:w,inContext:y,structure:b,context:S,event:U}){!b&&w&&({structure:b}=tt({drawDefinition:g,structureId:w}));let T=At({tournamentAppliedPolicies:i,scheduleVisibilityFilters:e,tournamentParticipants:r,hydrateParticipants:n,afterRecoveryTimes:a,policyDefinitions:s,tournamentRecord:o,usePublishState:l,matchUpFilters:u,contextFilters:c,contextContent:d,participantMap:p,scheduleTiming:f,publishStatus:m,contextProfile:h,drawDefinition:g,exitProfiles:I,matchUpsMap:v,structure:b,inContext:y,context:S,event:U}),P=[],D=[],E=[],R=[],C=[];if(T.error)return T;let{matchUps:M}=T,{assignedPositions:N}=pr({structure:b}),A=N?.filter(k=>k.participantId).map(k=>k.drawPosition),O;return M.filter(k=>{let F=u?.matchUpTypes?.length===1&&u.matchUpTypes[0]===ei;return!(k.matchUpType!==ei&&F)}).forEach(k=>{if(k.matchUpStatus===Ta){P.push(k);return}k.matchUpType===ei&&(O=!0);let F=!!k.collectionId,x=F&&k.sides?.every(G=>G.participantId),L=!F&&k.drawPositions?.filter(Boolean).length===2,$=!F&&k.drawPositions?.every(G=>A?.includes(G)),V=N?.filter(G=>G.bye).map(G=>G.drawPosition),_=!F&&k.drawPositions?.find(G=>V?.includes(G)),B=pne.includes(k.matchUpStatus)&&(x||L&&(!t||$));return _?C.push(k):vp({matchUp:k})?D.push(k):B?E.push(k):R.push(k)}),{includesTeamMatchUps:O,abandonedMatchUps:P,completedMatchUps:D,upcomingMatchUps:E,pendingMatchUps:R,byeMatchUps:C,structure:b}}function c0e({drawDefinition:t,roundNumber:e,structureId:i}){if(!t)return{error:$e};if(!i)return{error:qa};let{links:r}=Vv({drawDefinition:t,structureId:i}),n=r.source.reduce((s,o)=>!o.source.roundNumber||o.source.roundNumber===e?s.concat(o):s,[]),a=r.target.reduce((s,o)=>!o.target.roundNumber||o.target.roundNumber===e?s.concat(o):s,[]);return{links:{source:n,target:a}}}function tk({finishingPositions:t,linkCondition:e,linkType:i,source:r}){let n=r.find(a=>{let s=!a.source?.finishingPositions||!t||xn(t,a.source?.finishingPositions);return e===a.linkCondition&&s&&a.linkType===i});return[mu,hu].includes(n?.linkType)&&!n?.source?.roundNumber?q({result:{error:re},stack:"getTargetLink",context:n}):n}function Vv({drawDefinition:t,structureId:e,roundNumber:i}){return t?e?{links:(t.links||[]).filter(Boolean).reduce((r,n)=>(n.source?.structureId===e&&(!i||n.source.roundNumber===i)&&(r.source=r.source.concat(n)),n.target?.structureId===e&&(!i||n.target.roundNumber===i)&&(r.target=r.target.concat(n)),r),{source:[],target:[]})}:{error:qa}:{error:$e}}function d0e({structureMatchUps:t,matchUp:e}){let{roundNumber:i,roundPosition:r}=e,n=t.filter(s=>s.roundNumber===i&&!s.matchUpTieId),a=t.filter(s=>s.roundNumber===i+1&&!s.matchUpTieId);if(a.length){let s;return a.length===n.length?s=a.find(o=>o.roundPosition===r):a.length===n.length/2&&(s=a.find(o=>o.roundPosition===Math.ceil(r/2))),{matchUp:s}}return{message:"no progression found"}}function ik({sourceRoundMatchUpCount:t,inContextDrawMatchUps:e,sourceRoundPosition:i,drawDefinition:r,targetLink:n}){if(!n)return{error:J$};let{target:{structureId:a,feedProfile:s,groupedOrder:o,roundNumber:l,positionInterleave:u}}=n,{structure:c}=tt({drawDefinition:r,structureId:a}),{positionAssignments:d}=Kt({structure:c}),p=(e?.filter(P=>P.structureId===c?.structureId)).filter(P=>P.roundNumber===l&&!P.matchUpTieId),f=p.length,m=Ce(1,f+1),h=f/t,g=Math.ceil(h*i),I=1-i%2;if(u?.interleave&&h!==.5){let P=u.offset+(i-1)*u.interleave,D=i+P;g=Math.ceil(D/2),I=1-D%2}let v=m,w=m[g-1],y=Nne({roundPositionsCount:m.length,groupedOrder:o}),b=y?.length||1;if(b<=m.length){let P=f/b,D=wr(m,P);s===Vp&&D.forEach(E=>E.reverse()),v=y?.length&&y?.map(E=>D[E-1]).flat()||v}s===As?w=v[g-1]:s===Vp?((!y?.length||b>m.length)&&(g=p.length+1-g),w=v[g-1]):s===DM&&oa()&&console.log(hB,{feedProfile:s});let S=w&&p.reduce((P,D)=>D.roundPosition===w?D:P,void 0),U;S?.feedRound?(I=0,U=Math.min(...(S.drawPositions||[]).filter(Boolean))):U=S?.drawPositions?.length===2&&S?.drawPositions[I];let T=d?.find(({drawPosition:P})=>P===U);if(T){let{extension:P}=ht({element:T,name:FM});if(P?.value)return{disabledDrawPosition:U}}return{matchUp:S,targetDrawPosition:U,matchUpDrawPositionIndex:I}}function Fn({inContextDrawMatchUps:t=[],useTargetMatchUpIds:e,inContextMatchUp:i,drawDefinition:r,matchUpId:n}){let a=i;t.length&&!a&&(a=t.find(o=>o.matchUpId===n));let{structure:s}=tt({structureId:a?.structureId,drawDefinition:r});return s?.finishingPosition===Fh?p0e({inContextDrawMatchUps:t,useTargetMatchUpIds:e,drawDefinition:r,structure:s,matchUp:a}):f0e({matchUp:a})}function p0e({inContextDrawMatchUps:t,useTargetMatchUpIds:e,drawDefinition:i,structure:r,matchUp:n}){let{winnerMatchUpId:a,loserMatchUpId:s}=n,{links:o}=c0e({roundNumber:n.roundNumber,structureId:r.structureId,drawDefinition:i}),l=o?.source,u=tk({source:l,linkType:mu}),c=tk({linkCondition:fl,linkType:hu,source:l}),d=tk({source:l,linkType:hu}),p=c&&d;d||(d=c);let f=u?.target?.feedProfile,m=d?.target?.feedProfile,h=c?.target?.feedProfile,g,I,v,w,y,b,S,U,T,P;if(e&&(a||s)&&(S=a&&f!==ho&&t.find(({matchUpId:R})=>R===a),w=s&&m!==ho&&t.find(({matchUpId:R})=>R===s),S||w))return{matchUp:n,targetLinks:{loserTargetLink:d,winnerTargetLink:u},targetMatchUps:{loserMatchUp:w,winnerMatchUp:S}};let{roundPosition:D}=n;P=P||t.filter(R=>R.structureId===r.structureId);let E=P.reduce((R,C)=>C.roundNumber===n.roundNumber&&!C.matchUpTieId?R+1:R,0);return d&&!w&&m!==ho&&({matchUpDrawPositionIndex:b,targetDrawPosition:y,matchUp:w}=ik({targetLink:d,sourceRoundMatchUpCount:E,inContextDrawMatchUps:t,sourceRoundPosition:D,drawDefinition:i})),p&&h!==ho&&({matchUpDrawPositionIndex:v,targetDrawPosition:I,matchUp:g}=ik({targetLink:c,sourceRoundMatchUpCount:E,inContextDrawMatchUps:t,sourceRoundPosition:D,drawDefinition:i})),u&&!S&&f!==ho&&({matchUpDrawPositionIndex:T,targetDrawPosition:U,matchUp:S}=ik({targetLink:u,sourceRoundMatchUpCount:E,inContextDrawMatchUps:t,sourceRoundPosition:D,drawDefinition:i})),S||(P=P||t.filter(R=>R.structureId===r.structureId),{matchUp:S}=d0e({structureMatchUps:P,matchUp:n})),je({matchUp:n,targetLinks:{loserTargetLink:d,winnerTargetLink:u,byeTargetLink:c},targetMatchUps:{winnerMatchUpDrawPositionIndex:T,loserMatchUpDrawPositionIndex:b,byeMatchUpDrawPositionIndex:v,winnerTargetDrawPosition:U,loserTargetDrawPosition:y,byeTargetDrawPosition:I,winnerMatchUp:S,loserMatchUp:w,byeMatchUp:g},targetMatchUpIds:!!(a||s)})}function f0e({matchUp:t}){return{targetLinks:{loserTargetLink:void 0,winnerTargetLink:void 0},targetMatchUps:{loserMatchUp:void 0,winnerMatchUp:void 0},matchUp:t}}function m0e({drawDefinition:t,inContextDrawMatchUps:e}){let i={};return e.forEach(r=>{let{matchUpId:n,structureId:a,drawPositions:s=[]}=r,{structure:o}=tt({drawDefinition:t,structureId:a});if(o?.finishingPosition===jp){let{roundNumber:l}=r,u=l&&Ke(l)+1,c=o.matchUps??[],{roundMatchUps:d}=Sn({matchUps:c});if(u&&d?.[u]){let p=[...s].sort(nr).map((f,m)=>{let h=d[u].find(g=>g.drawPositions?.includes(f));return{matchUpId:h?.matchUpId,roundNumber:u,schedule:h?.schedule,sideNumber:m+1,structureName:o.structureName}});Object.assign(r,{sidesTo:p})}}else{let l=Fn({useTargetMatchUpIds:!0,inContextDrawMatchUps:e,inContextMatchUp:r,drawDefinition:t,matchUpId:n}),{winnerMatchUp:u}=l.targetMatchUps,{loserMatchUp:c}=l.targetMatchUps;!r.winnerMatchUpId&&u&&(r.winnerMatchUpId=u.matchUpId),!r.loserMatchUpId&&c&&(r.loserMatchUpId=c.matchUpId);let d=rk({upcomingMatchUp:u}),p=rk({upcomingMatchUp:c});if(r.matchUpStatus!=="BYE"&&c?.matchUpStatus==="BYE"){let{matchUp:m}=eae({matchUp:c,drawDefinition:t,inContextDrawMatchUps:e})||{};p=m&&rk({upcomingMatchUp:m})||p}let f=r.schedule?.timeAfterRecovery;if(f&&(d?.schedule?.scheduledTime&&Rt(d.schedule.scheduledTime)<Rt(f)&&(i[d.matchUpId]=r.matchUpId,d.schedule.scheduleConflict=r.matchUpId),p?.schedule?.scheduledTime&&Rt(p.schedule.scheduledTime)<Rt(f)&&(i[p.matchUpId]=r.matchUpId,p.schedule.scheduleConflict=r.matchUpId)),Object.assign(r,{winnerTo:d,loserTo:p}),r.drawPositions?.filter(Boolean).length){let m=l.targetLinks?.loserTargetLink?.linkCondition===fl,h=h0e(r);if(h.length){let g=vx(u?.sides),I=vx(c?.sides),v=h.find(({participantId:y})=>g.includes(y))?[]:h,w=h.find(({participantId:y})=>I.includes(y))?[]:h;c&&m&&w.length<2&&w.push({bye:!0,tbd:!0}),v?.length&&u&&(!l.targetMatchUpIds&&u&&(u=e.find(({matchUpId:y})=>y===u.matchUpId)),u.potentialParticipants||(u.potentialParticipants=[]),u.potentialParticipants.push(v)),w?.length&&c&&(l.targetMatchUpIds||(u=e.find(({matchUpId:y})=>y===c.matchUpId)),c.potentialParticipants||(c.potentialParticipants=[]),c.potentialParticipants.push(w))}}}}),Object.keys(i).length&&e.forEach(r=>{Object.keys(i).includes(r.matchUpId)&&(r.schedule.scheduleConflict=i[r.matchUpId])}),{scheduleConflictMatchUpIds:i}}function h0e(t){return t?.sides?.map(({participant:e,participantId:i,qualifier:r})=>e||i&&{participantId:i}||r&&{qualifier:r}).filter(Boolean)||[]}function eae({matchUp:t,drawDefinition:e,inContextDrawMatchUps:i}){let{matchUpId:r,matchUpStatus:n,structureId:a}=t||{};if(!t||!a||t?.matchUpStatus===_i)return{matchUp:t};if(n==="BYE"){let s;return t.winnerMatchUpId?s=i.find(({matchUpId:o})=>o===t.winnerMatchUpId):{winnerMatchUp:s}=Fn({inContextDrawMatchUps:i,drawDefinition:e,matchUpId:r})?.targetMatchUps||{},eae({matchUp:s,drawDefinition:e,inContextDrawMatchUps:i})}return{matchUp:void 0}}function rk(t){if(t?.upcomingMatchUp)return(({matchUpId:e,structureId:i,schedule:r,roundNumber:n,roundPosition:a,structureName:s})=>({matchUpId:e,structureId:i,schedule:r,roundNumber:n,roundPosition:a,structureName:s}))(t.upcomingMatchUp)}function Zi(t){let e="getAllDrawMatchUps";Object.assign(t,{requireParticipants:!1});let i=jv(t);if(i.error)return q({result:i,stack:e});let{abandonedMatchUps:r,completedMatchUps:n,upcomingMatchUps:a,pendingMatchUps:s,byeMatchUps:o,matchUpsMap:l}=i;return{matchUps:(r??[]).concat(...n??[],...a??[],...s??[],...o??[]),matchUpsMap:l}}function jv(t){if(!t?.drawDefinition)return{error:$e};let{tournamentParticipants:e,contextContent:i,matchUpsMap:r}=t,{scheduleVisibilityFilters:n,tournamentAppliedPolicies:a,requireParticipants:s,participantsProfile:o,afterRecoveryTimes:l,policyDefinitions:u,tournamentRecord:c,usePublishState:d,contextFilters:p,matchUpFilters:f,scheduleTiming:m,participantMap:h,publishStatus:g,contextProfile:I,drawDefinition:v,nextMatchUps:w,inContext:y,context:b,event:S}=t,U=[],T=[],P=[],D=[],E=[];I&&!i&&(i=Gc({policyDefinitions:u,tournamentRecord:c,contextProfile:I,event:S}));let R;!e?.length&&c&&(e=c?.participants,(y||o?.withGroupings)&&e?.length&&({participantsWithGroupings:e,groupInfo:R}=jM({participants:e,participantsProfile:o})));let{structures:C}=io({drawDefinition:v});if(!C)return{error:vi};r||(r=kr({drawDefinition:v}));let M=v&&Ane({drawDefinition:v}).exitProfiles;C.forEach(O=>{let{byeMatchUps:k=[],pendingMatchUps:F=[],upcomingMatchUps:x=[],completedMatchUps:L=[],abandonedMatchUps:$=[]}=QM({matchUpFilters:w?void 0:f,contextFilters:w?void 0:p,inContext:y||w||p,hydrateParticipants:t.hydrateParticipants,tournamentAppliedPolicies:a,scheduleVisibilityFilters:n,tournamentParticipants:e,requireParticipants:s,afterRecoveryTimes:l,policyDefinitions:u,tournamentRecord:c,usePublishState:d,contextContent:i,participantMap:h,scheduleTiming:m,publishStatus:g,contextProfile:I,drawDefinition:v,exitProfiles:M,matchUpsMap:r,structure:O,context:b,event:S});U=U.concat(...$),T=T.concat(...L),P=P.concat(...x),D=D.concat(...F),E=E.concat(...k)});let N=O=>(!f&&!w&&!p||(f&&(O=Yu({matchUps:O,...f})),p&&(O=Yu({matchUps:O,...p,processContext:!0}))),O),A={abandonedMatchUps:N(U),completedMatchUps:N(T),upcomingMatchUps:N(P),pendingMatchUps:N(D),byeMatchUps:N(E),matchUpsMap:r,...W,groupInfo:R};if(w){let O=typeof w=="object"||{abandoned:!0,completed:!0,upcoming:!0,pending:!0,bye:!0},{abandoned:k,completed:F,upcoming:x,pending:L,bye:$}=O,V=[].concat(...k&&U||[],...F&&T||[],...x&&P||[],...L&&D||[],...$&&E||[]);m0e({inContextDrawMatchUps:V,drawDefinition:v})}return A}function xu(t){let{participants:e=[],contextContent:i,participantMap:r}=t,{scheduleVisibilityFilters:n,tournamentAppliedPolicies:a,participantsProfile:s,afterRecoveryTimes:o,policyDefinitions:l,useParticipantMap:u,tournamentRecord:c,usePublishState:d,contextFilters:p,matchUpFilters:f,contextProfile:m,nextMatchUps:h,inContext:g,context:I,event:v}=t;if(!v)return{error:ui};let{eventId:w,eventName:y,endDate:b,eventType:S,category:U,gender:T,matchUpFormat:P}=v??{},D={...I,...je({indoorOutDoor:v.indoorOutdoor??c?.indoorOutdoor,surfaceCategory:v.surfaceCategory??c?.surfaceCategory,endDate:v.endDate??c?.endDate,tournamentId:c?.tournamentId,matchUpFormat:P,eventName:y,eventType:S,category:U,eventId:w,gender:T})};b&&(D.endDate=b),m&&!i&&(i=Gc({policyDefinitions:l,tournamentRecord:c,contextProfile:m,event:v}));let E;if(!e?.length&&!r&&c){let M=yf({participantsProfile:s,useParticipantMap:u,tournamentRecord:c,contextProfile:m,inContext:g});r=M.participantMap,e=M.participants??[],E=M.groupInfo}let R=v.drawDefinitions??[],C=vU({tournamentRecord:c,event:v}).scheduleTiming;return{matchUps:R.flatMap(M=>{let{matchUps:N}=Zi({tournamentParticipants:e,tournamentAppliedPolicies:a,scheduleVisibilityFilters:n,context:D,participantsProfile:s,afterRecoveryTimes:o,policyDefinitions:l,tournamentRecord:c,usePublishState:d,contextFilters:p,contextProfile:m,drawDefinition:M,contextContent:i,matchUpFilters:f,participantMap:r,scheduleTiming:C,nextMatchUps:h,inContext:g,event:v});return N??[]}),groupInfo:E}}function Ur(t){let e=He(t,[{tournamentRecord:!0}]);if(e.error)return e;if(!t?.tournamentRecord)return{error:ve};let{participantMap:i,participants:r}=t,{scheduleVisibilityFilters:n,participantsProfile:a,afterRecoveryTimes:s,useParticipantMap:o,policyDefinitions:l,tournamentRecord:u,inContext:c=!0,usePublishState:d,contextProfile:p,matchUpFilters:f,contextFilters:m,nextMatchUps:h,context:g}=t,I=t.tournamentId??u.tournamentId,v=u?.events??[];r||({participants:r,participantMap:i}=yf({participantsProfile:a,useParticipantMap:o,tournamentRecord:u,contextProfile:p,inContext:c}));let{appliedPolicies:w}=Dt({tournamentRecord:u}),y={...g,tournamentId:I,indoorOutDoor:u.indoorOutdoor,surfaceCategory:u.surfaceCategory,endDate:u.endDate},b=Gc({policyDefinitions:l,tournamentRecord:u,contextProfile:p});return{matchUps:v.flatMap(S=>(y.eventDrawsCount=S.drawDefinitions?.length??0,xu({context:y,scheduleVisibilityFilters:n,tournamentAppliedPolicies:w,participantsProfile:a,afterRecoveryTimes:s,policyDefinitions:l,tournamentRecord:u,usePublishState:d,contextContent:b,contextFilters:m,contextProfile:p,matchUpFilters:f,participantMap:i,nextMatchUps:h,participants:r,inContext:c,event:S}).matchUps??[])).concat(...u.matchUps??[])}}function No({scheduleVisibilityFilters:t,afterRecoveryTimes:e,participantsProfile:i,tournamentRecords:r,policyDefinitions:n,usePublishState:a,matchUpFilters:s,contextFilters:o,nextMatchUps:l,inContext:u}){if(typeof r!="object"||!Object.keys(r).length)return{error:Mi};let c=Object.keys(r).map(d=>{let p=r[d];return Ur({scheduleVisibilityFilters:t,afterRecoveryTimes:e,participantsProfile:i,policyDefinitions:n,tournamentRecord:p,usePublishState:a,matchUpFilters:s,contextFilters:o,nextMatchUps:l,inContext:u}).matchUps??[]}).flat();return{...W,matchUps:c}}function Hh(t,e){return g0e(t,e)||(t?.stageSequence||0)-(e?.stageSequence||0)||t?.roundNumber&&e.roundNumber&&t?.roundNumber-e?.roundNumber||(t?.roundPosition??0)-(e?.roundPosition??0)}function g0e(t,e){return(Bm[t?.stage]||0)-(Bm[e?.stage]||0)}function An(t){let{participants:e,participantMap:i,contextContent:r}=t,{scheduleVisibilityFilters:n,tournamentAppliedPolicies:a,participantsProfile:s,afterRecoveryTimes:o,policyDefinitions:l,useParticipantMap:u,tournamentRecord:c,matchUpFilters:d,contextFilters:p,contextProfile:f,drawDefinition:m,nextMatchUps:h,inContext:g,context:I,event:v}=t,{eventId:w,eventName:y,endDate:b,eventType:S,category:U,gender:T,matchUpFormat:P}=v??{},D={...I,surfaceCategory:v?.surfaceCategory??c?.surfaceCategory,indoorOutDoor:v?.indoorOutdoor??c?.indoorOutdoor,matchUpFormat:P,eventType:S,eventName:y,category:U,eventId:w,endDate:b,gender:T},E;return!e?.length&&!i&&c&&({participants:e=[],participantMap:i,groupInfo:E}=yf({participantsProfile:s,useParticipantMap:u,tournamentRecord:c,contextProfile:f,inContext:g})),f&&!r&&(r=Gc({policyDefinitions:l,tournamentRecord:c,contextProfile:f,drawDefinition:m,event:v})),{...Zi({context:D,tournamentAppliedPolicies:a,scheduleVisibilityFilters:n,tournamentParticipants:e,participantsProfile:s,afterRecoveryTimes:o,policyDefinitions:l,tournamentRecord:c,drawDefinition:m,contextContent:r,contextFilters:p,contextProfile:f,matchUpFilters:d,participantMap:i,nextMatchUps:h,inContext:g,event:v}),groupInfo:E}}function yp({element:t,accessor:e}){if(typeof e!="string")return{values:[]};let i=Oe(t),r=e.split("."),n=[],a;o({targetElement:i,attributes:r});let s={value:a};return n.length&&(s.values=n),s;function o({targetElement:l,attributes:u=[],significantCharacters:c}){for(let[p,f]of u.entries())if(l?.[f]){let m=u.slice(p+1);m.length?Array.isArray(l[f])?l[f].forEach(h=>o({targetElement:h,attributes:m})):(l=l[f],d({targetElement:l,index:p})):(a||(a=l[f]),n.includes(l[f])||n.push(l[f]))}function d({targetElement:p,index:f}){if(p&&f===u.length-1&&["string","number"].includes(typeof p)){let m=c?p.slice(0,c):p;a?n.includes(m)||n.push(m):(a=m,n.push(m))}}}}var tae=t=>e=>!t||typeof e!="object"?void 0:Array.isArray(t)&&t.map(i=>({[i]:yp({element:e,accessor:i})?.value}))||typeof t=="object"&&Object.keys(t).map(i=>({[i]:yp({element:e,accessor:i})?.value}))||(typeof t=="string"&&yp({element:e,accessor:t}))?.value,Pa=tae;function CU({finishingPositionOffset:t=0,finishingPositionLimit:e,positionsFed:i,roundsCount:r,roundLimit:n,matchUps:a,lucky:s,fmlc:o}){if(!Ka(a))return[];let{roundProfile:l,roundNumbers:u=[]}=Sn({interpolate:!0,matchUps:a});r=r??Math.max(...u,0);let c=n?r-n:0,d=c&&l?.[r-c]?.matchUpsCount,p=l&&Object.values(l).map(Pa("matchUpsCount")),f=(g,I)=>{let v=Math.min(...g);d&&I&&v===1&&(v=d);let w=Math.max(...g);return e&&w>e&&(w=e),[v,w]},m=l&&Object.assign({},...u.map(g=>{let I=(r??0)+1-g-c,v=l[g].matchUpsCount,w={finishingPositionRange:{},finishingRound:I},y=p?.slice(g-1).reduce((R,C)=>R+(C||0),0),b=o&&g!==1,S=1+t+(b?i??0:0),U=1,T=Ce(S,s?S+v*2:y+S+U),P=y+U-v,D=f(T.slice(P)),E=f(T.slice(0,P),!0);return w.finishingPositionRange={loser:D,winner:E},{[g]:w}})),h=oa({finishingRound:!0});return a.filter(Boolean).forEach(g=>{let I=g.roundNumber&&m[g.roundNumber];h&&!I&&console.log({roundFinishingData:m,matchUp:g}),g.finishingRound=I?.finishingRound,g.finishingPositionRange=I?.finishingPositionRange}),a}function Wp({inContextDrawMatchUps:t,drawDefinition:e,matchUpsMap:i}){if(!e)return{error:$e};let r={loserMatchUpIds:{},winnerMatchUpIds:{}};if(t||({matchUps:t,matchUpsMap:i}=Zi({inContext:!0,drawDefinition:e,matchUpsMap:i})),!i?.drawMatchUps.some(n=>n.finishingPositionRange)&&e?.structures?.length===1&&!e?.structures[0].structures){let n=i?.drawMatchUps??[];CU({matchUps:n})}return(t??[]).filter(({collectionId:n})=>!n).forEach(n=>{let{matchUpId:a,structureId:s}=n,o=Fn({inContextDrawMatchUps:t,drawDefinition:e,matchUpId:a}),{winnerMatchUp:l,loserMatchUp:u}=o.targetMatchUps,c=l?.matchUpId,d=u?.matchUpId,p=Pd({matchUpsMap:i,structureId:s}).find(f=>f.matchUpId===a);if(p&&(c&&(r.winnerMatchUpIds[p.matchUpId]=c,Object.assign(p,{winnerMatchUpId:c}),Object.assign(n,{winnerMatchUpId:c})),d&&(r.loserMatchUpIds[p.matchUpId]=d,n.loserMatchUpId=d,p.loserMatchUpId=d,n.finishingPositionRange))){let f=u.finishingPositionRange&&[...n.finishingPositionRange.loser,...u.finishingPositionRange.loser],m=f&&[Math.min(...f),Math.max(...f)];n.finishingPositionRange.loser=m,p.finishingPositionRange.loser=m}}),{inContextDrawMatchUps:t,goesToMap:r}}function co(t){let e=ws(t),i=t.matchUps??[],r=t.drawIds??[],{includeParticipantDependencies:n,tournamentRecord:a,drawDefinition:s}=t;if(!Array.isArray(i))return{error:Nu};if(!Array.isArray(r))return{error:xo};let o=t.matchUpIds?.length?t.matchUpIds:i.map(v=>v.matchUpId);if(!Array.isArray(o))return{error:Ch};let l={},u={},c={},d={};a&&!Object.keys(e).length&&(e={[a.tournamentId]:a});let p=Object.values(e),f=p.reduce((v,w)=>v.concat(w.events??[]).map(y=>(y.drawDefinitions||[]).map(b=>b.links||[])).flat(1/0),[]).filter(({linkType:v})=>v===fu),m=i;if(f.length){m=No({nextMatchUps:!0,tournamentRecords:e}).matchUps;let v=f.reduce((w,y)=>{let b=y.source?.structureId,S=y.target?.structureId;return b&&S&&(c[S]=b),b&&!w.includes(b)&&w.push(b),w},[]);for(let w of v)l[w]=[];for(let w of m??[]){let y=w.containerStructureId||w.structureId;v.includes(y)&&l[y].push(w.matchUpId)}}let h=v=>{u[v]||(u[v]={dependentMatchUpIds:[],participantIds:[],matchUpIds:[],sources:[]},d[v]=[])},g=(v,w)=>{u[v].matchUpIds.forEach(y=>{u[w].matchUpIds.push(y)}),u[w].matchUpIds.push(v),u[v].dependentMatchUpIds.push(w),n&&u[v].participantIds.forEach(y=>u[w].participantIds.push(y))},I=v=>{let w=Object.keys(l).length;for(let y of v||[]){let{matchUpId:b,winnerMatchUpId:S,loserMatchUpId:U}=y;if(!o.length||o.includes(b)){if(h(b),n){let{individualParticipantIds:D}=VM(y);u[b].participantIds=D}S&&(h(S),g(b,S),d[S].push(b)),U&&(h(U),g(b,U),d[U].push(b)),u[b].sources.push(d[b]);let T=d[b].map(D=>u[D].sources[0]).flat(),P=d[b].map(D=>u[D].sources[1]).flat();if(u[b].sources.push(T,P),w){let D=y.containerStructureId||y.structureId,E=c[D];if(l[E])for(let R of l[E])h(R),g(R,b),d[R].push(b)}}}};if(s)Wp({drawDefinition:s}),m?.length||(m=An({drawDefinition:s}).matchUps),I(m);else{if(m?.length||(m=No({nextMatchUps:!0,tournamentRecords:e}).matchUps),!r.length){let v=p?.length?p.map(({events:w=[]})=>w.map(({drawDefinitions:y=[]})=>y.map(({drawId:b})=>b))).flat(1/0):[];v&&(r=v)}for(let v of r){let w=m?.filter(y=>y.drawId===v).sort(Hh);if(!w?.find(({roundPosition:y})=>!y)){let y=w?.find(({tournamentId:S})=>S),{drawDefinition:b}=Wn({tournamentRecord:e[y?.tournamentId],drawId:v});b&&Wp({drawDefinition:b})}I(w)}}return{positionDependencies:l,matchUpDependencies:u,sourceMatchUpIds:d,matchUps:m,...W}}function fr(t){let e=t?.matchUp,i=t?.score||e?.score,r=i?.sets?.[0],{side1Score:n,side2Score:a,side1TiebreakScore:s,side2TiebreakScore:o,side1PointScore:l,side2PointScore:u}=r||{},c=n||a||s||o||l||u;return!!(i?.sets?.length>1||c)}function MU({matchUpStatus:t}){return cne.includes(t)}function I0e({matchUpStatus:t}){return JB.includes(t)}function Dx({matchUpStatus:t}){return dne.includes(t)}function E2({matchUpStatus:t,winningSide:e,tieMatchUps:i,sides:r,score:n}){let a=r?.find(({participantId:o})=>o),s=i?.filter(E2)?.length;return fr({score:n})||s||e&&a||t&&I0e({matchUpStatus:t})&&![qt,ai,lo].includes(t)}function Gv(t){let{drawDefinition:e,findContainer:i,structureId:r,event:n}=t,a=t.structure,{containedStructures:s}=Bv({drawDefinition:e}),o=r?s[r]||[]:[],l={isCollectionMatchUp:!1};if(!a){let U=tt({drawDefinition:e,structureId:r});if(U.error)return U;a=i?U.containingStructure??U.structure:U.structure}if(Hn({structure:a}))return{structure:a,isAdHoc:!0,error:Rh};let{matchUps:u}=Zi({inContext:!0,matchUpFilters:l,drawDefinition:e,event:n}),c=u?.filter(U=>U.structureId===r||o.includes(U.structureId)),{matchUpDependencies:d}=co({drawIds:[e.drawId],matchUps:u,drawDefinition:e}),p=[],f=[],m={},h=[];for(let U of u??[]){if(U.structureId===r||o.includes(U.structureId)){f.push(...U.drawPositions??[]);let T=U.roundNumber;for(let P of(U.drawPositions??[]).filter(Boolean))(!m[P]||T&&m[P]>T)&&(m[P]=T)}E2(U)&&(h.push(U),p.push(U.matchUpId,...d?.[U?.matchUpId]?.matchUpIds||[]))}let g=nt(f.filter(Boolean)).sort(nr),I=nt(p),v=nt(c?.map(({matchUpId:U,drawPositions:T})=>I.includes(U)?T:[]).flat().filter(Boolean)).sort(nr),{positionAssignments:w}=Kt({drawDefinition:e,structure:a}),y=w?.filter(U=>U.bye).map(U=>U.drawPosition),b=w?.filter(U=>U.qualifier).map(U=>U.drawPosition),S=g?.filter(U=>!v.includes(U))||[];return{allDrawPositions:g,inContextStructureMatchUps:c,drawPositionInitialRounds:m,activeDependentMatchUpIds:I,qualifyingDrawPositions:b,inactiveDrawPositions:S,positionAssignments:w,activeDrawPositions:v,byeDrawPositions:y,activeMatchUps:h,structure:a}}function Hm({drawPosition:t,matchUps:e=[]}){return{initialRoundNumber:e.filter(({drawPositions:i})=>t&&i?.includes(t)).map(({roundNumber:i})=>i).sort(nr)[0]}}var Yc={reset:"\x1B[0m",bright:"\x1B[1m",dim:"\x1B[2m",red:"\x1B[31m",brightred:"\x1B[91m",green:"\x1B[32m",brightgreen:"\x1B[92m",yellow:"\x1B[33m",brightyellow:"\x1B[93m",blue:"\x1B[34m",brightblue:"\x1B[94m",lightblue:"\x1B[105m",magenta:"\x1B[35m",brightmagenta:"\x1B[95m",cyan:"\x1B[36m",brightcyan:"\x1B[96m",white:"\x1B[37m",brightwhite:"\x1B[97m"},R2=[];function Ht(t,e){ni(t)&&(t={method:t}),(e||oa())&&R2.push(t)}function v0e(t){return R2.slice()}function y0e(t){let e=v0e().map(i=>{let{color:r,keyColors:n,method:a,newline:s}=i,o=Object.keys(Yc).includes(r)?Yc[r]:Yc.cyan,l=Object.keys(i).filter(c=>!["color","keyColors","method","newline"].includes(c)).map(c=>{let d=n&&Object.keys(n).includes(c)&&Yc[n[c]]?Yc[n[c]]:Yc.brightwhite;return`${Yc.white}${c}: ${d}${i[c]}`}).join(", "),u=a?.length<15?"		":"	";return[s?`
`:"",o,a,u,Yc.white,l,Yc.reset,`
`].join("")});e?.length&&console.log(...e)}function b0e(){R2.length=0}function C2(t){let e=t.bye,i=t.qualifier,r=t.participantId;return{containsBye:e,containsQualifier:i,containsParticipant:r,filled:e||i||r}}function Lr(t){return[qt,ai,Sr].includes(t)}function Ja({provisionalPositioning:t,isPositionAction:e,tournamentRecord:i,drawDefinition:r,drawPosition:n,loserMatchUp:a,matchUpsMap:s,structureId:o,structure:l,event:u}){if(!r)return{error:$e};if(l||({structure:l}=tt({drawDefinition:r,structureId:o})),!l)return{error:vi};o||({structureId:o}=l);let c="assignDrawPositionBye";Ht({method:c,color:"cyan",drawPosition:n}),s??=kr({drawDefinition:r});let{positionAssignments:d}=Kt({structure:l}),{activeDrawPositions:p}=Gv({drawDefinition:r,structureId:o});if(d?.find(E=>E.drawPosition===n)?.bye)return{...W};let f=!!(a&&s.drawMatchUps.some(E=>E.loserMatchUpId===a?.matchUpId&&Lr(E.matchUpStatus)));if(p?.includes(n)&&!f)return{error:XS};let m=d?.find(E=>E.drawPosition===n);if(!m)return{error:Rh};let{filled:h,containsBye:g,containsParticipant:I}=C2(m);if(g)return{...W};if(h&&!g&&!f)return q({result:{error:vI},stack:c});let v=Dt({tournamentRecord:i,drawDefinition:r,event:u}).appliedPolicies??{},w=Zi({inContext:!0,drawDefinition:r,matchUpsMap:s}).matchUps??[],y={isCollectionMatchUp:!1},{matchUps:b}=At({provisionalPositioning:t,drawDefinition:r,matchUpFilters:y,matchUpsMap:s,structure:l});if(d?.forEach(E=>{E.drawPosition===n&&(E.bye=!0,f&&(E.participantId=void 0))}),l.structureType===gn)return w0e({tournamentRecord:i,drawDefinition:r,drawPosition:n,matchUps:b}),Dc({tournamentId:i?.tournamentId,drawDefinition:r,structure:l,event:u}),Kz({assignedParticipantId:I,isPositionAction:e,appliedPolicies:v,drawDefinition:r,drawPosition:n,structureId:o,stack:c});let{roundProfile:S,roundMatchUps:U}=Sn({matchUps:b}),T=(S&&Object.keys(S).map(E=>Number.parseInt(E)).reverse())?.find(E=>S?.[E].drawPositions?.includes(n)),P=T?U?.[T].find(({drawPositions:E})=>E?.includes(n)):void 0;P&&iae({tournamentRecord:i,drawDefinition:r,matchUp:P,event:u});let D=P?.drawPositions?.find(E=>E!==n);if(P&&D){let E=M2({sourceDrawPositions:P.drawPositions,matchUpId:P.matchUpId,inContextDrawMatchUps:w,drawPositionToAdvance:D,tournamentRecord:i,drawDefinition:r,matchUpsMap:s});if(E.error)return E}return Dc({tournamentId:i?.tournamentId,drawDefinition:r,structure:l,event:u}),Kz({assignedParticipantId:I,isPositionAction:e,appliedPolicies:v,drawDefinition:r,drawPosition:n,structureId:o,stack:c})}function Kz({assignedParticipantId:t,isPositionAction:e,appliedPolicies:i,drawDefinition:r,drawPosition:n,structureId:a,stack:s}){return e&&hU({appliedPolicies:i,drawDefinition:r,positionAction:{removedParticipantId:t,drawPosition:n,structureId:a,name:s}}),q({result:{...W},stack:s})}function iae({tournamentRecord:t,drawDefinition:e,eventId:i,matchUp:r,event:n}){Object.assign(r,{matchUpStatus:"BYE",score:void 0,winningSide:void 0}),Ut({tournamentId:t?.tournamentId,eventId:i??n?.eventId,context:"setMatchUpStatusBye",drawDefinition:e,matchUp:r})}function w0e({tournamentRecord:t,drawDefinition:e,drawPosition:i,matchUps:r,event:n}){r.forEach(a=>{a.drawPositions?.includes(i)&&iae({eventId:n?.eventId,tournamentRecord:t,drawDefinition:e,matchUp:a})})}function M2({drawPositionToAdvance:t,inContextDrawMatchUps:e,sourceDrawPositions:i,tournamentRecord:r,drawDefinition:n,matchUpsMap:a,matchUpId:s,event:o}){Ht({method:"advanceDrawPosition",color:"cyan",drawPositionToAdvance:t});let l=a.drawMatchUps.find(w=>w.matchUpId===s),u=e.find(w=>w.matchUpId===s)?.structureId,{structure:c}=tt({drawDefinition:n,structureId:u}),{positionAssignments:d}=Kt({structure:c}),p=d?.filter(w=>w.bye).map(w=>w.drawPosition),f=l?.drawPositions?.find(w=>w!==t),m=f&&p?.includes(f),{targetLinks:{loserTargetLink:h},targetMatchUps:{loserMatchUp:g,winnerMatchUp:I,loserTargetDrawPosition:v}}=Fn({inContextDrawMatchUps:e,drawDefinition:n,matchUpId:s});if(I&&I.structureId===c?.structureId&&S0e({drawPositionToAdvance:t,inContextDrawMatchUps:e,sourceDrawPositions:i,tournamentRecord:r,drawDefinition:n,winnerMatchUp:I,matchUpsMap:a,event:o}),g&&m&&g.structureId!==c?.structureId){let{roundNumber:w}=g;if(w===1){let y=Ja({structureId:h.target.structureId,drawPosition:v,tournamentRecord:r,drawDefinition:n,event:o});if(y.error)return y}else rae({loserTargetDrawPosition:v,tournamentRecord:r,loserTargetLink:h,drawDefinition:n,loserMatchUp:g,matchUpsMap:a,event:o})}return{...W}}function S0e({drawPositionToAdvance:t,inContextDrawMatchUps:e,sourceDrawPositions:i,tournamentRecord:r,drawDefinition:n,winnerMatchUp:a,matchUpsMap:s,event:o}){let l="advanceWinner",u=s.drawMatchUps.find(M=>M.matchUpId===a.matchUpId),c=e.find(M=>M.matchUpId===a.matchUpId)?.structureId,{structure:d}=tt({drawDefinition:n,structureId:c}),{positionAssignments:p}=Kt({structure:d}),f=p?.find(({drawPosition:M})=>M===t)?.bye,m=u.drawPositions?.filter(Boolean),h=p?.filter(M=>m?.includes(M.drawPosition)),g=p?.find(({drawPosition:M})=>M===t),I=i?.find(M=>M!==t),v=(I&&h?.find(({drawPosition:M})=>M===I))?.bye,w=f&&v;if(w&&console.log({isByeAdvancedBye:w}),m?.length>1&&f&&!v)return q({result:{error:vI},stack:l});let y=m?.find(M=>M!==t),b=w,S=[...(u.drawPositions||[]).filter(Boolean),void 0,void 0].slice(0,2),U=S.map(M=>!M&&!b||M===t?(b=!0,t):M).sort(nr);if(!b)return console.log("@@@@@@@",{advancingAssignmentIsBye:g,drawPositionToAdvance:t,existingAssignments:h}),q({result:{error:vI},stack:l});let T=p?.find(({drawPosition:M})=>M===y)?.bye,P=p?.find(({drawPosition:M})=>M===t)?.bye;Object.assign(u,{matchUpStatus:P||T?"BYE":_i,score:void 0,winningSide:void 0,drawPositions:U});let D=u.drawPositions.find(M=>!S.includes(M));Ht({method:l,color:"brightyellow",changedDrawPosition:D,pairedDrawPositionIsBye:T,drawPositionIsBye:P}),Ut({tournamentId:r?.tournamentId,matchUp:u,eventId:o?.eventId,context:l,drawDefinition:n});let{targetLinks:{loserTargetLink:E},targetMatchUps:{loserMatchUp:R,loserTargetDrawPosition:C}}=Fn({matchUpId:a.matchUpId,inContextDrawMatchUps:e,drawDefinition:n});if(T||P){let M=T?t:y;if(M)M2({drawPositionToAdvance:M,matchUpId:a.matchUpId,inContextDrawMatchUps:e,tournamentRecord:r,drawDefinition:n,matchUpsMap:s});else if(P&&E&&R)if(R.feedRound)rae({loserTargetDrawPosition:C,tournamentRecord:r,loserTargetLink:E,drawDefinition:n,loserMatchUp:R,matchUpsMap:s});else{let N=1-a.roundPosition%2,A=R.drawPositions[N],O=Ja({structureId:E.target.structureId,drawPosition:A,tournamentRecord:r,drawDefinition:n,event:o});if(O.error)return O}}}function rae({loserTargetDrawPosition:t,tournamentRecord:e,loserTargetLink:i,drawDefinition:r,loserMatchUp:n,matchUpsMap:a,event:s}){let{roundNumber:o}=n;Ht({method:"assignFedDrawPositionBye",color:"cyan",loserTargetDrawPosition:t});let l=(a?.mappedMatchUps||{})[n.structureId].matchUps,{initialRoundNumber:u}=Hm({drawPosition:t,matchUps:l});if(u===o){let c=Ja({structureId:i.target.structureId,drawPosition:t,tournamentRecord:e,drawDefinition:r,event:s});if(c.error)return c}}function nae({positionAssignments:t,tournamentRecord:e,drawDefinition:i,matchUpsMap:r,structure:n,event:a}){let{matchUps:s}=At({drawDefinition:i,matchUpsMap:r,structure:n,event:a});s.forEach(o=>{let l=t.filter(({drawPosition:u})=>o.drawPositions?.includes(u)).filter(u=>u.bye).length;o.winningSide||(Object.assign(o,{matchUpStatus:l?"BYE":_i}),Ut({tournamentId:e?.tournamentId,context:"modifyRoundRobinMatchUpsStatus",eventId:a?.eventId,drawDefinition:i,matchUp:o}))})}function NU(t){let{inContextDrawMatchUps:e,participantId:i,drawPosition:r}=t,{tournamentRecord:n,drawDefinition:a,structureId:s,matchUpsMap:o,event:l}=t,{structure:u}=tt({drawDefinition:a,structureId:s}),c=(pr({drawDefinition:a,structure:u}).positionAssignments||[]).find(p=>i&&p.participantId===i||r&&p.drawPosition===r);if(c&&i&&!r&&(r=c?.drawPosition),!r)return{error:Rv};i||(i=c?.participantId);let{activeDrawPositions:d}=Gv({drawDefinition:a,structureId:s});return d.includes(r)?{error:XS}:(e||({matchUps:e}=Zi({inContext:!0,drawDefinition:a,matchUpsMap:o})),Px({inContextDrawMatchUps:e,tournamentRecord:n,drawDefinition:a,structureId:s,drawPosition:r,matchUpsMap:o,event:l}).drawPositionCleared?(Dc({tournamentId:n?.tournamentId,drawDefinition:a,structure:u,event:l}),{...W,participantId:i}):{error:gte})}function Px({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,matchUpsMap:n,structureId:a,event:s}){let{structure:o}=tt({drawDefinition:i,structureId:a});if(!o)return{error:vi};let l=pr({drawDefinition:i,structure:o}).positionAssignments||[],u=l.some(I=>{if(I.drawPosition===r)return delete I.participantId,delete I.qualifier,delete I.bye,!0});if(o.structureType===gn)return nae({positionAssignments:l,tournamentRecord:e,drawDefinition:i,matchUpsMap:n,structure:o}),{drawPositionCleared:u,...W};let c={isCollectionMatchUp:!1},{matchUps:d}=At({drawDefinition:i,matchUpFilters:c,matchUpsMap:n,structure:o,event:s}),{roundProfile:p,roundMatchUps:f}=Sn({matchUps:d}),m=(p&&Object.keys(p))?.map(I=>Ke(I)),h=r,g=m?.map(I=>{let v=p?.[I]?.pairedDrawPositions?.find(D=>D.includes(h)),w=v?.find(D=>D!==h),y=l.find(D=>D.drawPosition===w),b=p?.[I+1],S=y?.bye,U=b?.pairedDrawPositions?.find(D=>D.includes(w)),T=S&&U&&b&&b.drawPositions?.includes(w),P=v&&{pairedDrawPositionByeAdvancedPair:!T&&U,pairedDrawPosition:w,targetDrawPosition:h,relevantPair:v,roundNumber:I};return T&&(h=w),P}).filter(I=>I?.targetDrawPosition)?.reduce((I,v)=>{let{roundNumber:w,relevantPair:y,targetDrawPosition:b,pairedDrawPosition:S,pairedDrawPositionByeAdvancedPair:U}=v,T={roundNumber:w,targetDrawPosition:b,relevantPair:y},P=U&&{roundNumber:w+1,targetDrawPosition:S,relevantPair:U,subsequentRoundRemoval:!0},D=[T,P].filter(Boolean);return I.concat(...D)},[]);return g?.forEach(({roundNumber:I,targetDrawPosition:v,relevantPair:w})=>{let y=f?.[I].find(b=>xn(b.drawPositions?.filter(Boolean),w.filter(Boolean)));y&&(U0e({inContextDrawMatchUps:t,targetDrawPosition:v,tournamentRecord:e,drawDefinition:i,structureId:a,roundNumber:I,matchUpsMap:n}),aae({inContextDrawMatchUps:t,positionAssignments:l,tournamentRecord:e,drawDefinition:i,targetMatchUp:y,drawPosition:r,matchUpsMap:n,structure:o,event:s}))}),{tasks:g,drawPositionCleared:u,positionAssignments:l}}function U0e({inContextDrawMatchUps:t,targetDrawPosition:e,tournamentRecord:i,drawDefinition:r,matchUpsMap:n,roundNumber:a,structureId:s}){let{structure:o}=tt({drawDefinition:r,structureId:s});if(!o)return{error:vi};if(o.structureType===gn)return;n=n||kr({drawDefinition:r});let l=(n?.mappedMatchUps||{})[s].matchUps,{initialRoundNumber:u}=Hm({drawPosition:e,matchUps:l}),c=l?.filter(p=>p.roundNumber>=a&&p.roundNumber!==u&&p.drawPositions?.includes(e)),d=Kt({drawDefinition:r,structureId:s}).positionAssignments??[];return c?.forEach(p=>aae({drawPosition:e,targetMatchUp:p,inContextDrawMatchUps:t,positionAssignments:d,tournamentRecord:i,drawDefinition:r,matchUpsMap:n,structure:o})),{...W}}function aae({inContextDrawMatchUps:t,positionAssignments:e,tournamentRecord:i,drawDefinition:r,targetMatchUp:n,drawPosition:a,matchUpsMap:s,structure:o,event:l}){let u="removeDrawPosition",c=n.drawPositions?.slice(),d=n.matchUpStatus,p=n.winningSide;s=s??kr({drawDefinition:r});let f=s.mappedMatchUps[o.structureId].matchUps,{initialRoundNumber:m}=Hm({drawPosition:a,matchUps:f});if(n.roundNumber&&m&&n.roundNumber>m){let U=(n.drawPositions??[]).map(T=>T===a?void 0:T);n.drawPositions=U}if(n.matchUpType===ei){let U=(t?.find(T=>T.matchUpId===n.matchUpId)?.sides??[]).reduce((T,P,D)=>P.drawPosition===a?D:T,void 0);U!==void 0&&n.sides?.[U]?.lineUp&&(delete n.sides?.[U].lineUp,Ut({tournamentId:i?.tournamentId,context:`${u}-TEAM`,eventId:l?.eventId,matchUp:n,drawDefinition:r}))}let h=Fn({matchUpId:n.matchUpId,inContextDrawMatchUps:t,drawDefinition:r}),{targetLinks:{winnerTargetLink:g},targetMatchUps:{loserMatchUp:I,winnerMatchUp:v,loserMatchUpDrawPositionIndex:w}}=h,y=e.filter(({drawPosition:U})=>n.drawPositions?.includes(U)).filter(U=>U.bye).length,b=y&&"BYE"||n.matchUpStatus&&Lr(n.matchUpStatus)&&n.matcHUpStatus||_i;n.matchUpStatus=b,n.matchUpStatus&&Lr(n.matchUpStatus)&&(n.winningSide=void 0);let S=c?.find(U=>!n.drawPositions?.includes(U));if(c?.includes(a)&&d===n.matchUpStatus&&p===n.winningSide||(S&&Ht({method:u,color:"brightyellow",removedDrawPosition:S}),Ut({tournamentId:i?.tournamentId,context:`${u}-${a}`,eventId:l?.eventId,matchUp:n,drawDefinition:r})),I&&I.structureId!==h.matchUp.structureId&&!y){let{drawPositions:U,roundNumber:T}=I;if(T===1){let P=U[w];Px({structureId:I.structureId,drawPosition:P,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:r,matchUpsMap:s})}else{let P=Math.min(...U.filter(Boolean)),D=T0e({loserMatchUpDrawPosition:P,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:r,loserMatchUp:I,matchUpsMap:s,event:l});if(D.error)return q({result:D,stack:u});let E=(s?.mappedMatchUps||{})[I.structureId].matchUps,{initialRoundNumber:R}=Hm({drawPosition:P,matchUps:E});R===1&&(Ht({method:u,color:"brightyellow",loserMatchUpDrawPosition:P}),Px({structureId:I.structureId,drawPosition:P,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:r,matchUpsMap:s}))}}return v&&v.structureId!==h.matchUp.structureId&&g.target.feedProfile,{...W}}function T0e({loserMatchUpDrawPosition:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:r,loserMatchUp:n,matchUpsMap:a,event:s}){let{structure:o}=tt({structureId:n.structureId,drawDefinition:r}),{positionAssignments:l}=Kt({structure:o});if(l?.find(u=>u.drawPosition===t)?.bye){let u=NU({drawPosition:t,structureId:n.structureId,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:r,matchUpsMap:a,event:s});if(u.error)return u}return{...W}}function Df({drawDefinition:t,stages:e}){if(!t)return{error:$e};let i=(t?.structures??[]).filter(n=>!e?.length||n.stage&&e.includes(n.stage)),r=nt(i.map(n=>{let{positionAssignments:a}=Kt({structure:n});return a?a.map(yt):[]}).flat().filter(Boolean));return{...W,assignedParticipantIds:r}}function wo(t){let e=(t?.entries??[]).filter(Boolean).reduce((r,n)=>{let{entryStage:a,entryStatus:s}=n,o=`_${a||Ae}${s||""}`;return r[o]||(r[o]=[]),r[o].push(n),r},{}),i=r=>isNaN(r)?1/0:r;return Object.keys(e).map(r=>e[r].sort((n,a)=>i(n.entryPosition)-i(a.entryPosition)).map((n,a)=>{let s=a+1;return{...n,entryPosition:s}})).flat()}function dp(t){return[wf,Us].includes(t)}function qP({autoEntryPositions:t=!0,ignoreAssignment:e,tournamentRecord:i,drawDefinition:r,participantIds:n,entryStatus:a,entryStage:s,extension:o,eventSync:l,drawId:u,stage:c,event:d}){if(!n||!Array.isArray(n))return{error:Co,method:"modifyEntriesStatus",participantIds:n};if(!r&&!d)return{error:ui};if(a&&!Mne.includes(a))return{error:ox};if(s&&!SM.includes(s))return{error:hf};let p="modifyEntriesStatus",f=[];if(!a&&!o)return q({result:{error:Je},info:"Missing entryStatus",stack:p});if(o&&!ml({extension:o,requiredAttributes:["name"]}))return q({result:{error:re},info:"Invalid extension",context:{extension:o},stack:p});let m=[];d?.drawDefinitions?.forEach(P=>{let D=Df({stages:c&&[c],drawDefinition:P}).assignedParticipantIds??[];m.push(...D)});let h=i?.participants??[];if(!n.every(P=>{let D=Ud({tournamentParticipants:h,participantId:P})?.participantType;return!(D&&[ft,$n].includes(D)&&dp(a))&&!(a&&d?.eventType&&D===It&&[fs,Ua].includes(d.eventType)&&[Gs,...pD].includes(a))}))return{error:ox};let g=d&&Bi({event:d}).flightProfile,I=g?.flights?.find(P=>P.drawId===u),v=P=>{let D=(P||[]).filter(R=>!c||!R.entryStage||c===R.entryStage).filter(({participantId:R})=>n.includes(R)),E=R=>a&&m.includes(R.participantId)&&!(pD.includes(R.entryStatus)&&pD.includes(a));return D.every(R=>E(R)&&!e?!1:(a&&(R.entryStatus=a,delete R.entryPosition),s&&(R.entryStage=s,delete R.entryPosition),o&&(o.value?Ft({element:R,extension:o}):Nn({element:R,name:o.name})),!0))?{...W}:{error:Nv}},w=({flight:P,drawDefinition:D})=>{d&&(d.entries=wo({entries:d.entries??[]})),P&&(P.drawEntries=wo({entries:P.drawEntries})),D&&(D.entries=wo({entries:D.entries}))},y=P=>{let{flight:D,drawDefinition:E}=P,R="updateDrawEntries";if(D){let C=v(D.drawEntries);if(C.error)return q({result:C,stack:R})}if(E){let C=v(E.entries);if(C.error)return q({result:C,stack:R});f.includes(E.drawId)||f.push(E.drawId)}return{...W}},b=d?.entries?.find(({entryPosition:P})=>P)??(I?.drawEntries?.find(({entryPosition:P})=>P)||r?.entries?.find(({entryPosition:P})=>P));if(t&&!b&&w({flight:I,drawDefinition:r}),I||r){let P=y({flight:I,drawDefinition:r});if(P.error)return q({result:P,stack:p})}let S=d?.drawDefinitions?.map(({drawId:P})=>P)??[],U=g?.flights?.filter(P=>!S.includes(P.drawId))||[];for(let P of U){let D=P&&y({flight:P});if(D?.error)return q({result:D,stack:p})}let T=g?.flights?.length===1&&(d?.drawDefinitions?.length??0)<=g?.flights?.length;if(!I&&!r&&a&&Cne.includes(a))return{error:aie};if(!I&&!r||a===bu||l&&T){let P=v(d?.entries);if(P?.error)return q({result:P,stack:p});let D;if(a===bu&&(g?.flights?.every(E=>{let R=v(E.drawEntries);return R.error?(D=R.error,!1):(E.drawEntries=E.drawEntries.filter(({participantId:C})=>!n.includes(C)),!0)}),d?.drawDefinitions?.every(E=>{let R=v(E.entries);return R.error?(D=R.error,!1):(E.entries=E.entries?.filter(({participantId:C})=>!n.includes(C)),!0)})),D)return q({result:{error:D},stack:p})}t&&w({flight:I,drawDefinition:r});for(let P of d?.drawDefinitions??[])f.length&&!f.includes(P.drawId)||ii({tournamentId:i.tournamentId,eventId:d?.eventId,drawDefinition:P});return{...W}}function Ag({value:t,sourceRange:e,targetRange:i}){if(!Array.isArray(e)||e.length!==2)return 0;let r=Math.min(...e),n=Math.max(...e),a=Math.min(...i),s=Math.max(...i);return(t-r)*(s-a)/(n-r)+a}var sae="NTRP",oae="DUPR",lae="UTR_P",uae="UTPR",cae="SQUASH_LEVELS",dae="US_SQUASH",pae="USATT",fae="ITTF",mae="USAR",D0e={ELO:"ELO",NTRP:sae,TRN:"TRN",UTR:"UTR",WTN:"WTN",DUPR:oae,UTR_P:lae,UTPR:uae,PSA:"PSA",SQUASH_LEVELS:cae,US_SQUASH:dae,USATT:pae,ITTF:fae,USAR:mae,BWF:"BWF"},P0e={ELO:{defaultInitialization:1500,decimalsCount:0,range:[0,3e3],ascending:!1},[sae]:{accessors:["ntrpRating","dntrpRatingHundredths"],attributes:{ustaRatingType:""},accessor:"dntrpRatingHundredths",defaultInitialization:3,decimalsCount:1,ascending:!1,range:[1,7]},UTR:{defaultInitialization:6,accessors:["utrRating"],accessor:"utrRating",decimalsCount:2,ascending:!1,range:[1,16]},WTN:{attributes:{confidence:{generator:!0,range:[60,100]}},accessors:["wtnRating","confidence"],defaultInitialization:23,accessor:"wtnRating",ascending:!0,decimalsCount:2,range:[40,1]},[oae]:{defaultInitialization:3.5,accessors:["duprRating","reliabilityScore"],accessor:"duprRating",attributes:{reliabilityScore:{generator:!0,range:[0,100]}},decimalsCount:3,ascending:!1,range:[2,8]},[lae]:{defaultInitialization:5,accessors:["utrpRating","verified"],accessor:"utrpRating",attributes:{verified:{type:"boolean"},provisional:{type:"string"}},decimalsCount:1,ascending:!1,range:[1,10]},[uae]:{defaultInitialization:3.5,accessor:"utprRating",decimalsCount:1,ascending:!1,range:[2,5],deprecated:!0},PSA:{defaultInitialization:500,accessor:"psaPoints",decimalsCount:0,ascending:!1,range:[0,3e3],attributes:{tournaments:{generator:!0,range:[1,20]},divisor:{generator:!0,range:[10,20]}}},[cae]:{defaultInitialization:2e3,accessor:"squashLevel",decimalsCount:0,ascending:!1,range:[0,7e3]},[dae]:{defaultInitialization:3.5,accessor:"usSquashRating",decimalsCount:1,ascending:!1,range:[2,6]},[pae]:{defaultInitialization:1e3,accessor:"usattRating",decimalsCount:0,ascending:!1,range:[200,3e3]},[fae]:{defaultInitialization:500,accessor:"ittfPoints",decimalsCount:0,ascending:!1,range:[0,2e4]},[mae]:{defaultInitialization:1e4,accessor:"usarRanking",decimalsCount:0,ascending:!0,range:[1,25e3]},BWF:{defaultInitialization:5e3,accessor:"bwfPoints",decimalsCount:0,ascending:!0,range:[0,15e4],attributes:{tournaments:{generator:!0,range:[1,10]}}}},Dr=P0e;function E0e({sourceRatingType:t,sourceRating:e}){let i=Dr[t]?.range,r=i?.[0]>i?.[1],n=Dr.ELO.range;return Ag({value:r?i[0]-e:e,sourceRange:i,targetRange:n})}function R0e({targetRatingType:t,sourceRating:e}){let i=Dr[t]?.decimalsCount||0,r=Dr[t]?.range,n=r?.[0]>r?.[1],a=Math.max(...r),s=Dr.ELO?.range,o=Ag({targetRange:r,sourceRange:s,value:e}),l=Number.parseFloat(o?.toFixed(i))||0;return n?a-l:l}function Xz(t){let e=He(t,[{ratings:!0,[qn]:Kn}]);if(e.error)return e;let i=t.matchUpType&&[zt,Bt].includes(t.matchUpType)?t.matchUpType:zt,r=Object.keys(Dr),n=t.targetRatingType&&r.includes(t.targetRatingType)?t.targetRatingType:"ELO",a=t.ratings[i]?t.ratings[i].reduce((p,f)=>p.includes(f.scaleName)?p:p.concat(f.scaleName),[]):[];if(!a)return{error:Br};let s=t.ratings[i]?.find(p=>p.scaleName===n)??t.ratings[i]?.[0];if(a[0]===n)return s;let o=s?.scaleName,l=Dr[s?.scaleName]?.accessor,u=l&&s.scaleValue[l]||s?.scaleValue,c=E0e({sourceRatingType:o,sourceRating:u}),d=R0e({targetRatingType:n,sourceRating:c});return d?{convertedRating:d,sourceRating:u}:{error:re}}function C0e({participantResults:t,sides:e,score:i}){let r=e?.find(({sideNumber:o})=>o===1),n=e?.find(({sideNumber:o})=>o===2),a=r?.participant?.ratings,s=n?.participant?.ratings;if(a?.[zt]&&s?.[zt]){let o="ELO",{convertedRating:l}=Xz({ratings:a,targetRatingType:o}),{convertedRating:u}=Xz({ratings:s,targetRatingType:o}),{side1pressure:c,side2pressure:d}=M0e({side1ConvertedRating:l,side2ConvertedRating:u,score:i});c&&t[r?.participantId].pressureScores.push(c),d&&t[n?.participantId].pressureScores.push(d);let p=Math.max(...Dr.ELO.range),f=RP((u-l)/p),m=RP((l-u)/p);t[r?.participantId].ratingVariation.push(f),t[n?.participantId].ratingVariation.push(m)}}function M0e({side1ConvertedRating:t,side2ConvertedRating:e,score:i}){let r=Math.max(t,e),n=Math.min(t,e),a=Math.abs(t-e),s=Dr.ELO.range,o=Math.max(...s),l=(o-r)*0,u=(r+l)/o*a,c=i?.sets?.reduce((v,w)=>v+(w?.side1Score??0),0),d=i?.sets?.reduce((v,w)=>v+(w.side2Score??0),0),p=t>e?2:1,f=(c||0)*(n+(p===1?u:0)),m=(d||0)*(n+(p===2?u:0)),h=f+m,g=h?RP(f/h):0,I=h?RP(m/h):0;return{side1pressure:g,side2pressure:I}}function N2({winningSide:t,matchUpFormat:e=Vs,matchUpStatus:i,tallyPolicy:r,score:n}){let a=[0,0],s=n?.sets,o=typeof t=="number"&&t-1,l=qi(e),u=A2(l?.bestOf??1);if(typeof o=="number"&&(i===qt&&r?.setsCreditForDefaults||i===ai&&r?.setsCreditForWalkovers))a[o]=u;else for(let c of s||[]){let{winningSide:d}=c;d&&(a[d-1]+=1)}return typeof o=="number"&&i===Sr&&(+a[1-o]===u&&(a[1-o]-=1),r?.setsCreditForRetirements&&(a[o]=u)),a}function hae({matchUpFormat:t=Vs,winningSide:e,matchUpStatus:i,tallyPolicy:r,score:n}){let{sets:a}=n||{};if(!a)return[0,0];let s=typeof e=="number"&&e-1,o=qi(t),l=o?.bestOf??1,u=A2(l),c=o?.setFormat?.tiebreakAt||0,d=[[],[]];if(typeof s=="number"&&(i===qt&&r?.gamesCreditForDefaults||i===ai&&r?.gamesCreditForWalkovers)){let p=o?.setFormat?.setTo||0,f=u*p;d[s].push(f)}else a.forEach((p,f)=>{let m=(p.setNumber||f+1)>u&&o?.finalSetFormat?"finalSetFormat":"setFormat",h=o?.[m]?.based,g=o?.[m].tiebreakSet,{side1Score:I,side2Score:v}=p;Jz(h)&&!g&&(d[0].push(Ke(I||0)),d[1].push(Ke(v||0))),g&&p.winningSide&&r?.gamesCreditForTiebreakSets!==!1&&d[p.winningSide-1].push(1)});if(i===Sr&&typeof s=="number"){let p=a.length>u&&o?.finalSetFormat?"finalSetFormat":"setFormat",f=o?.[p];if(Jz(f.based)){let m=f?.setTo||0,h=I=>{if(!(!o||I===""))return+I===c-1||+I===c?Ke(c||0)+1:+I<c?m:c},g=N2({winningSide:e,score:{sets:a},matchUpStatus:i,matchUpFormat:t,tallyPolicy:r});if(d.map(I=>I[s]<=I[1-s]).reduce((I,v)=>I+(v?1:0),0)>g[1-s]){let I=d[s].length,v=h(d[1-s][I-1]);v&&(d[s][I-1]=v)}u>d[s].length&&r?.gamesCreditForRetirements&&d[s].push(m)}}return[d[0].reduce((p,f)=>p+f,0),d[1].reduce((p,f)=>p+f,0)]}function gae({matchUpFormat:t,score:e}){let i=t?qi(t):void 0,r=i?.bestOf??1,n=A2(r),a=[0,0],s=[0,0];return e?.sets?.forEach((o,l)=>{let u=(o.setNumber||l+1)>n&&i?.finalSetFormat?"finalSetFormat":"setFormat",c=i?.[u]?.based;if(Iae(c)){let{side1Score:d,side2Score:p}=o;d&&(s[0]+=Ke(d||0)),p&&(s[1]+=Ke(p||0))}else o.side1TiebreakScore&&(s[0]+=Ke(o.side1TiebreakScore||0)),o.side2TiebreakScore&&(s[1]+=Ke(o.side2TiebreakScore||0)),(o.side1TiebreakScore||o.side2TiebreakScore)&&o.winningSide&&(a[o.winningSide-1]+=1)}),{pointsTally:s,tiebreaksTally:a}}function A2(t){return t&&Math.ceil(t/2)||1}function Iae(t){return t==="P"}function Jz(t){return!Iae(t)}function N0e({participantResults:t,groupingTotal:e,matchUpFormat:i,tallyPolicy:r,totalGames:n,perPlayer:a,totalSets:s}){let o=i&&qi(i)||{},l=o.bestOf,u=l&&Math.ceil(l/2)||1,c=o.setFormat?.setTo,d=Math.pow(10,r?.precision||3);Object.keys(t).forEach(p=>{let f=t[p].setsWon,m=t[p].setsLost,h=r?.groupTotalSetsPlayed||e==="setsPct"?s:a*u||f+m,g=Math.round(f/h*d)/d;(g===1/0||Number.isNaN(g))&&(g=h);let I=t[p].tieMatchUpsWon,v=t[p].tieMatchUpsLost,w=I+v,y=Math.round(I/w*d)/d;(y===1/0||Number.isNaN(y))&&(y=I);let b=t[p].matchUpsWon,S=t[p].matchUpsLost,U=b+S,T=Math.round(b/U*d)/d;(T===1/0||Number.isNaN(T))&&(T=b);let P=t[p].gamesWon||0,D=t[p].gamesLost||0,E=(a||0)*u*(c||0),R=r?.groupTotalGamesPlayed||e==="gamesPct"?n:Math.max(E,P+D),C=Math.round(P/R*d)/d;(C===1/0||Number.isNaN(C))&&(C=0);let M=t[p].pointsWon+t[p].pointsLost,N=Math.round(t[p].pointsWon/M*d)/d;(N===1/0||Number.isNaN(N))&&(N=0),t[p].setsWon=f,t[p].setsLost=m,t[p].setsPct=g,t[p].tieMatchUpsWon=I,t[p].tieMatchUpsPct=y,t[p].matchUpsPct=T,t[p].gamesWon=P,t[p].gamesLost=D,t[p].gamesPct=C,t[p].pointsPct=N,t[p].result=`${t[p].matchUpsWon}/${t[p].matchUpsLost}`})}function AU({participantIds:t,pressureRating:e,groupingTotal:i,matchUpFormat:r,tallyPolicy:n,perPlayer:a,matchUps:s}){let o={},l=n?.excludeMatchUpStatuses||[],u=s?.filter(f=>(f.tieMatchUps||!l.includes(f.matchUpStatus))&&(!t?.length||Li(t,[kg(f,0),kg(f,1)]).length===2)),c=u?.flatMap(({score:f,tieMatchUps:m})=>m?m.filter(({matchUpStatus:h})=>!l.includes(h)).flatMap(({score:h})=>h?.sets?.length??0):f?.sets?.length??0)?.reduce((f,m)=>f+m,0),d=f=>f?.sets?.reduce((m,h)=>m+(h?.side1Score??0)+(h?.side2Score??0),0)??0,p=u?.flatMap(({score:f,tieMatchUps:m})=>m?m.filter(({matchUpStatus:h})=>!l.includes(h)).flatMap(({score:h})=>d(h)):d(f))?.reduce((f,m)=>f+m,0);for(let f of u??[]){let{matchUpStatus:m,tieMatchUps:h,tieFormat:g,score:I,winningSide:v,sides:w}=f,y=g&&f._disableAutoCalc&&g.collectionDefinitions.every(({scoreValue:U})=>U),b=v&&A0e(f),S=v&&k0e(f);if(!b&&!S)if(m&&Ki.includes(m)){let U=kg(f,0),T=kg(f,1);U&&(Jc(o,U),o[U].matchUpsCancelled+=1),T&&(Jc(o,T),o[T].matchUpsCancelled+=1)}else if(h?.length){a=0;for(let U of h){if(U.winningSide){let T=w?.find(({sideNumber:D})=>D===U.winningSide)?.participantId,P=w?.find(({sideNumber:D})=>D===U.winningSide)?.participantId;T&&P&&(Jc(o,T),Jc(o,P),o[T].tieMatchUpsWon+=1,o[P].tieMatchUpsLost+=1,Pi(zt)(U.matchUpType)?(o[T].tieSinglesWon+=1,o[P].tieSinglesLost+=1):Pi(Bt)(U.matchUpType)&&(o[T].tieDoublesWon+=1,o[P].tieDoublesLost+=1))}Qz({score:U.score,manualGamesOverride:y,participantResults:o,sides:w})}}else Qz({manualGamesOverride:y,participantResults:o,score:I,sides:w});else if(Jc(o,b),Jc(o,S),h?.length){a=0;for(let U of h){let{matchUpType:T}=U,P=Pi(Bt)(T),D=Pi(zt)(T);U.winningSide&&(U.winningSide===v?(b&&(o[b].tieMatchUpsWon+=1,D&&(o[b].tieSinglesWon+=1),P&&(o[b].tieDoublesWon+=1)),S&&(o[S].tieMatchUpsLost+=1,D&&(o[S].tieSinglesLost+=1),P&&(o[S].tieDoublesLost+=1))):U.winningSide!==v&&(S&&(o[S].tieMatchUpsWon+=1,D&&(o[S].tieSinglesWon+=1),P&&(o[S].tieDoublesWon+=1)),b&&(o[b].tieMatchUpsLost+=1,D&&(o[b].tieSinglesLost+=1),P&&(o[b].tieDoublesLost+=1)))),Zz({matchUpFormat:U.matchUpFormat,matchUpStatus:U.matchUpStatus,matchUpType:U.matchUpType,score:U.score,sides:U.sides,winningParticipantId:b,losingParticipantId:S,manualGamesOverride:y,participantResults:o,isTieMatchUp:!0,pressureRating:e,tallyPolicy:n,winningSide:v})}vae({winningParticipantId:b,losingParticipantId:S,participantResults:o,matchUpStatus:m})}else Zz({matchUpFormat:f.matchUpFormat??r,matchUpType:f.matchUpType,isTieMatchUp:void 0,winningParticipantId:b,manualGamesOverride:y,losingParticipantId:S,participantResults:o,pressureRating:e,matchUpStatus:m,tallyPolicy:n,winningSide:v,score:I,sides:w});if(y){let U=I?.sets?.reduce((E,R)=>E+(R?.side1Score??0),0),T=I?.sets?.reduce((E,R)=>E+(R.side2Score??0),0),P=w?.find(({sideNumber:E})=>E===1)?.participantId,D=w?.find(({sideNumber:E})=>E===2)?.participantId;Jc(o,P),Jc(o,D),P&&(o[P].gamesWon+=U,o[P].gamesLost+=T),D&&(o[D].gamesWon+=T,o[D].gamesLost+=U)}}return N0e({participantResults:o,groupingTotal:i,matchUpFormat:r,tallyPolicy:n,totalGames:p,perPlayer:a,totalSets:c}),{participantResults:o}}function A0e(t){let e=t.winningSide-1;return kg(t,e)}function k0e(t){let e=1-(t.winningSide-1);return kg(t,e)}function kg(t,e){if(!t?.sides)return console.log("no sides:",{matchUp:t}),"foo";let i=t.sides[e];return i?i.participantId:(console.log("No Side",{matchUp:t,index:e}),"foo")}function Jc(t,e){e&&!t[e]&&(t[e]={allDefaults:0,defaults:0,defeats:[],gamesLost:0,gamesWon:0,matchUpsCancelled:0,matchUpsLost:0,matchUpsWon:0,pointsLost:0,pointsWon:0,pressureScores:[],ratingVariation:[],retirements:0,setsLost:0,setsWon:0,tieSinglesWon:0,tieSinglesLost:0,tieDoublesWon:0,tieDoublesLost:0,tieMatchUpsLost:0,tieMatchUpsWon:0,victories:[],walkovers:0})}function Qz({manualGamesOverride:t,participantResults:e,score:i,sides:r}){let{sets:n}=i||{},a=[[],[]],s=[0,0];for(let l of n||[]){let{winningSide:u,side1Score:c,side2Score:d}=l;u&&(s[u-1]+=1),a[0].push(Ke(c||0)),a[1].push(Ke(d||0))}let o=[a[0].reduce((l,u)=>l+u,0),a[1].reduce((l,u)=>l+u,0)];r.forEach((l,u)=>{let{participantId:c}=l;c&&(Jc(e,c),e[c].setsWon+=s[u],e[c].setsLost+=s[1-u],t||(e[c].gamesWon+=o[u],e[c].gamesLost+=o[1-u]))})}function Zz({winningParticipantId:t,manualGamesOverride:e,losingParticipantId:i,participantResults:r,pressureRating:n,matchUpFormat:a,matchUpStatus:s,isTieMatchUp:o,matchUpType:l,tallyPolicy:u,winningSide:c,score:d,sides:p}){let f=c&&c-1,m=1-f;n&&l===zt&&C0e({participantResults:r,sides:p,score:d}),o||vae({winningParticipantId:t,losingParticipantId:i,participantResults:r,matchUpStatus:s});let h=N2({matchUpStatus:s,matchUpFormat:a,tallyPolicy:u,winningSide:c,score:d}),g=hae({matchUpStatus:s,matchUpFormat:a,tallyPolicy:u,winningSide:c,score:d}),{pointsTally:I}=gae({score:d,matchUpFormat:a});t&&(r[t].setsWon+=h[f],r[t].setsLost+=h[m],e||(r[t].gamesWon+=g[f],r[t].gamesLost+=g[m]),r[t].pointsWon+=I[f],r[t].pointsLost+=I[m]),i&&(r[i].setsWon+=h[m],r[i].setsLost+=h[f],e||(r[i].gamesWon+=g[m],r[i].gamesLost+=g[f]),r[i].pointsWon+=I[m],r[i].pointsLost+=I[f])}function vae({winningParticipantId:t,losingParticipantId:e,participantResults:i,matchUpStatus:r}){e&&(r===ai&&(i[e].walkovers+=1),r===qt&&(i[e].defaults+=1),r===Sr&&(i[e].retirements+=1),Lr(r)&&(i[e].allDefaults+=1),i[e].matchUpsLost+=1),t&&(i[t].matchUpsWon+=1),e&&t&&(i[e].defeats.push(t),i[t].victories.push(e))}function O0e(t,e,i,r){t.groups&&Object.keys(t.groups).sort(r).forEach(n=>{let a=t.groups[n].map(o=>e[o]).join(", "),s=`${n} ${t.attribute}: ${a}`;i.push(s)})}function x0e(t,e,i,r){if(t.excludedDirectives?.length){let n=t.excludedDirectives.map(({attribute:o})=>o).join(", "),a=`${n.length} directives were excluded due to participants limit}`;r.push(a);let s=`Excluded: ${n}`;r.push(s)}else{let n=(u,c)=>Number.parseFloat(t.reversed?u:c)-Number.parseFloat(t.reversed?c:u),a=t.groups?Object.values(t.groups).flat(1/0).length:t.participantIds?.length??0,s=t.reversed?" in reverse order":"",o=t.groups?"grouped":"separated",l=`Step ${e+1}: ${a} particiants were ${o}${s} by ${t.attribute}`;if(r.push(l),t.idsFilter){let u=`${t.attribute} was calculated considering ONLY TIED PARTICIPANTS`;r.push(u)}O0e(t,i,r,n)}r.push("----------------------")}function F0e({matchUps:t,order:e,report:i}){let r={};t.forEach(({sides:a})=>{a.forEach(s=>{s.participantId&&s.participant&&(r[s.participantId]=s.participant.participantName)})});let n=[];return Array.isArray(i)&&i.forEach((a,s)=>{x0e(a,s,r,n)}),n.push("Final Order:"),e.forEach(a=>{let{participantId:s,resolved:o}=a,l=a.groupOrder||a.provisionalOrder;n.push(`${l}: ${r[s]} => resolved: ${!!o}`)}),n.join(`\r
`)}function yae({participantResults:t,participantIds:e,attribute:i}){return bae({participantResults:t,participantIds:e}).reduce((r,n)=>{let{participantId:a,results:s}=n,o=s?.[i];return!isNaN(o)&&a&&(r[o]?r[o].push(a):r[o]=[a]),r},{})}function bae(t){return(t.participantIds||Object.keys(t.participantResults)).reduce((e,i,r)=>(e.push({participantId:i,i:r,results:t.participantResults[i]}),e),[])}var L0e=[{attribute:"matchUpsPct",idsFilter:!1},{attribute:"allDefaults",reversed:!0,idsFilter:!1},{attribute:"defaults",reversed:!0,idsFilter:!1},{attribute:"walkovers",reversed:!0,idsFilter:!1},{attribute:"retirements",reversed:!0,idsFilter:!1},{attribute:"setsPct",idsFilter:!1},{attribute:"gamesPct",idsFilter:!1},{attribute:"pointsPct",idsFilter:!1},{attribute:"matchUpsPct",idsFilter:!0},{attribute:"setsPct",idsFilter:!0},{attribute:"gamesPct",idsFilter:!0},{attribute:"pointsPct",idsFilter:!0}],nk={matchUpsPct:20,tieMatchUpsPct:16,pointsPct:4,gamesPct:8,setsPct:12};function eq(t){let{requireCompletion:e=!0,participantResults:i,subOrderMap:r,tallyPolicy:n}=t,a=[];if(e&&!_0e(t))return{};let s=["tieMatchUpsWon","tieSinglesWon","tieDoublesWon","matchUpsWon","pointsWon","gamesWon","setsWon","gamesPct","setsPct","pointsPct","matchUpsPct"].includes(n?.groupOrderKey)?n.groupOrderKey:"matchUpsWon",o=yae({participantResults:i,attribute:s});a.push({attribute:s,groups:o});let l=Object.keys(o).map(g=>Number.parseFloat(g)).sort((g,I)=>I-g).map(g=>o[g]).map(g=>{let I=wae({participantIds:g,...t});return a.push(...I.report??[]),I.order}).flatMap((g,I)=>g.map(v=>v.resolved?v:{...v,subGroup:[I].concat(...v.subGroup??[])})),u,c=0,d=1,p;l.forEach((g,I)=>{I&&(g.resolved||p&&!g.resolved)&&(d+=1),p=g.resolved;let v=Number.parseInt(g.subGroup?.join("")||0);g.resolved?(g.position=I+1,d=g.position):(u&&v>u&&(d+=c,c=0),g.position=d,c+=1),u=v});let f=l.map(({position:g})=>g),m=Sa(f);return l.forEach(g=>{let{participantId:I,position:v}=g||{},w=i[I];g.GEMscore=h(w);let y=m[v];g?.position!==void 0&&(y>1&&(g.ties=y,r&&(g.subOrder=r[I])),g.rankOrder=v,g.groupOrder=v+(g.subOrder||1)-1)}),{groupOrder:l,report:a.flat(1/0).filter(Boolean)};function h(g){return(Array.isArray(n?.GEMscore)?Object.keys(nk).filter(I=>n.GEMscore.includes(I)):Object.keys(nk)).map(I=>(g[I]||0)*Math.pow(10,nk[I].toFixed(3))).reduce((I,v)=>I+v,0)}}function _0e({participantResults:t,participantsCount:e}){let i=bae({participantResults:t}).filter(r=>e-1===r.results.matchUpsWon+r.results.matchUpsLost+r.results.matchUpsCancelled);return e===i.length}function $0e({disableHeadToHead:t,participantIds:e,matchUpFormat:i,groupTotals:r,tallyPolicy:n,attribute:a,idsFilter:s,matchUps:o,reversed:l}){let{participantResults:u}=AU({participantIds:s&&e,groupingTotal:r&&a,matchUpFormat:i,tallyPolicy:n,matchUps:o}),c=yae({participantResults:u,participantIds:e,attribute:a}),d=[{attribute:a,reversed:l,groups:c,idsFilter:s,groupTotals:r}],p;return Object.keys(c).length>1&&e.length&&(p=Object.keys(c).map(f=>Number.parseFloat(f)).sort((f,m)=>l?f-m:m-f).map(f=>c[f]).map(f=>{let m=wae({participantResults:u,disableHeadToHead:t,participantIds:f,matchUpFormat:i,tallyPolicy:n,matchUps:o});return d.push(...m.report??[]),m.order}).flatMap((f,m)=>f.map(h=>h.resolved?h:{...h,subGroup:[m].concat(...h.subGroup??[])}))),{order:p,report:d}}function wae({participantResults:t,disableHeadToHead:e,participantIds:i,matchUpFormat:r,tallyPolicy:n,matchUps:a}){let s=[],o=[],l;if(i?.length===1)return{order:[{resolved:!0,participantId:i[0]}]};if(i?.length===2&&(!n?.headToHead||!n.headToHead.disabled&&!e)){let c=B0e({participantIds:i,participantResults:t});if(c){let d=c[0].participantId;return o.push({attribute:"head2Head",participantIds:i,headToHeadWinner:d}),{order:c,headToHeadWinner:d,report:o}}}let u=(n?.tallyDirectives||L0e).filter(c=>{let d=!(Ai(c.maxParticipants)&&i?.length>c.maxParticipants);return d||s.push(c),d});return s.length&&o.push({excludedDirectives:s,participantIds:i}),u.every(({attribute:c,reversed:d,idsFilter:p,groupTotals:f,disableHeadToHead:m})=>(l=$0e({disableHeadToHead:m,participantIds:i,matchUpFormat:r,groupTotals:f,tallyPolicy:n,attribute:c,idsFilter:p,matchUps:a,reversed:d}),o.push(l.report),!l.order)),l.order?{order:l.order,report:o}:{order:i?.map(c=>({participantId:c})),report:o}}function B0e({participantIds:t,participantResults:e}){if(t){if(e[t[0]].victories.includes(t[1]))return t.map(i=>({resolved:!0,participantId:i}));if(e[t[1]].victories.includes(t[0]))return t.reverse().map(i=>({resolved:!0,participantId:i}))}}function Wh({policyDefinitions:t,generateReport:e,pressureRating:i,matchUpFormat:r,matchUps:n=[],subOrderMap:a,perPlayer:s}){if(!n?.length||!Ka(n))return{error:Nu};let o=nt(n.map(({structureId:y})=>y));if(o.length!==1)return q({result:{error:re,info:"Maximum one structureId"},stack:"tallyParticipantResults",context:{structureIds:o}});let l=n.filter(y=>y&&y.matchUpStatus!=="BYE"),u=l.length&&nt(l.flatMap(({drawPositions:y})=>y)).length,c=l.filter(y=>vp({matchUp:y})).length===l.length;c||(s=0);let d=n.every(({matchUpType:y,tieMatchUps:b})=>y===ei&&b?.every(S=>vp({matchUp:S}))),p=t?.[HB],f=n.filter(y=>vp({matchUp:y})??y.matchUpType===ei),{participantResults:m}=AU({matchUps:f,pressureRating:i,matchUpFormat:r,tallyPolicy:p,perPlayer:s}),h,g,{groupOrder:I,report:v}=eq({matchUps:f,participantResults:m,participantsCount:u,matchUpFormat:r,subOrderMap:a,tallyPolicy:p});if(i&&V0e({participantResults:m}),c&&I)h=v,g=I,I.forEach(y=>{let{participantId:b,groupOrder:S,rankOrder:U,subOrder:T,ties:P,GEMscore:D}=y,E=m[b];Object.assign(E,{groupOrder:S,rankOrder:U,GEMscore:D,subOrder:T,ties:P})});else{let{groupOrder:y,report:b}=eq({requireCompletion:!1,participantResults:m,participantsCount:u,matchUpFormat:r,tallyPolicy:p,subOrderMap:a,matchUps:n});h=b,g=y,y&&y.forEach(S=>{let{participantId:U,groupOrder:T,GEMscore:P}=S,D=m[U];Object.assign(D,{provisionalOrder:T,GEMscore:P})})}let w={completedTieMatchUps:d,readableReport:"",participantResults:m,bracketComplete:c,order:[],report:h};if((c||d)&&(w.order=g),e||oa({tally:!0})){let y=F0e({matchUps:n,report:h,order:g});oa({tally:!0})&&console.log(y),w.readableReport=y}return w}function V0e({participantResults:t}){let e=n=>n.reduce((a,s)=>a+parseFloat(s),0),i=n=>parseFloat((e(n)/n.length).toFixed(2)),r=Object.keys(t).map(n=>{let a=t[n],{pressureScores:s}=a,o=s?.length?i(s):0;return{participantId:n,averagePressure:o}}).sort((n,a)=>(a.averagePressure||0)-(n.averagePressure||0)).map((n,a)=>({...n,order:a+1}));for(let n of r)t[n.participantId].pressureOrder=n.order}function Xl({requireTimeStamp:t,scaleAttributes:e,participant:i}){if(!i)return{error:Nh};if(!wt(e))return{error:re};if(i.timeItems??=[],Array.isArray(i.timeItems)){let{accessor:r,scaleType:n,eventType:a,scaleName:s}=e,o=[Sd,n,a,s].join("."),l=i.timeItems.filter(u=>u?.itemType===o).filter(u=>!t||u?.itemDate).sort((u,c)=>(u.createdAt?new Date(u.createdAt).getTime():0)-(c.createdAt?new Date(c.createdAt).getTime():0)).pop();if(l){let[u,c,d,p]=l.itemType?.split(".")??[];if(u!==Sd)return{error:_m};let f=r&&yp({element:l.itemValue,accessor:r}),m=f?.value||l.itemValue,h={rawValue:f&&l.itemValue,eventType:d,scaleDate:l.itemDate,scaleValue:m,scaleName:p,scaleType:c};return{...W,scaleItem:h}}}return{...W,scaleItem:void 0}}function j0e({publishedSeeding:t,usePublishState:e,withSeeding:i,participant:r,event:n}){let a={},s=c=>[Sd,Yl,n.eventType,c].join("."),o=Object.assign({},...(r.timeItems||[]).filter(({itemType:c})=>c.split(".")[1]===Yl).map(({itemType:c,itemValue:d})=>({[c]:d}))),l=(t?.stageSeedingScaleNames&&Object.values(t?.stageSeedingScaleNames)||Array.isArray(t?.seedingScaleNames)&&t.seedingScaleNames||[]).map(s),u=Li(Object.keys(o),l);if((!e||!Object.keys(o).length&&!t?.drawIds?.length||u.length)&&u.length){if(t?.stageSeedingScaleNames){let c=Object.keys(t.stageSeedingScaleNames).map(p=>{let f=s(t.stageSeedingScaleNames[p]),m=o[f];return[p,m]}).filter(p=>p[1]).map(p=>({[p[0]]:{seedValue:p[1]}})),d=Object.assign({},...c);a.seedAssignments=d}else if(u){let c=u.map(d=>o[d]);a.seedValue=c.pop()}}else if(!e&&typeof i=="object"){let c=Object.keys(i).map(p=>{let f=s(i[p]),m=o[f];return[p,m]}).filter(p=>p[1]).map(p=>({[p[0]]:{seedValue:p[1]}})),d=Object.assign({},...c);a.seedAssignments=d}else{let{categoryName:c,ageCategoryCode:d}=n.category||{},p=[d,n.eventId,c].filter(Boolean),f;for(let m of p){let h={eventType:n.eventType,scaleType:Yl,scaleName:m},g=Xl({scaleAttributes:h,participant:r});if(g.scaleItem){f=g.scaleItem;break}}if(f&&(!e||t?.published&&!t?.published?.drawIds?.length)){let m=f.scaleValue;a.seedValue=m}}return a}function k2({positionAssignments:t}){let e=(t||[]).filter(Pa(Iu)).map(n=>{let{extension:a}=ht({element:n,name:RI}),s=Ke(a?.value),o=!isNaN(s)&&s;return o&&{participantId:n.participantId,subOrder:o}}).filter(Boolean),i=e.map(({subOrder:n})=>n),r=Sa(i);return{subOrderMap:Object.assign({},...e.filter(({subOrder:n})=>r[n]===1).map(({participantId:n,subOrder:a})=>({[n]:a})))}}function G0e({convertExtensions:t,seedAssignments:e,participant:i,withSeeding:r,seedValue:n,eventId:a,ranking:s,entry:o}){let{entryStatus:l,entryStage:u,entryPosition:c,extensions:d}=o,p=d?.length&&t?Object.assign({},...CB(d??[])):{},f=Object.assign(p,{entryPosition:c,entryStatus:l,entryStage:u,ranking:s,eventId:a});i.events[a]=je(f,!1,!1,!0),r&&(e&&(i.events[a].seedAssignments=e),n&&(i.events[a].seedValue=n))}function kU(t){let e=He(t,[{[hr]:!0}]);if(e.error)return e;let{tournamentRecord:i,status:r=Xa}=t,n=`${Jd}.${Qd}`;return Oe(GM({tournamentRecord:i,itemType:n})?.timeItem?.itemValue?.[r],!1,!0)}function H0e(t){let{tournamentId:e}=t??{};return!!e}function Qa({event:t,status:e=Xa}){let i=`${Jd}.${Qd}`;return IU({itemType:i,event:t})?.timeItem?.itemValue?.[e]}function Lf(t){let e=t?.embargo;return!e||!vc(e)?!1:new Date(e).getTime()>Date.now()}function jo(t){return!!t?.published&&!Lf(t)}function O2({drawDetails:t,drawId:e,ignoreEmbargo:i=!1}){let r=t?.[e]?.publishingDetail;return i?!!r?.published:jo(r)}function zh(t){let{tournamentRecord:e,drawDefinition:i,eventIds:r,eventId:n,drawIds:a,drawId:s,event:o}=t??{};if(e&&!H0e(e))return{error:re};if(n&&!o)return{error:ps};if(Array.isArray(r)&&r?.length){let p={};for(let f of r){if(!ni(f))return{error:re};let m=Wn({tournamentRecord:e,eventId:f})?.event;if(!m)return{error:ps};let h=ak({event:m});p[f]=h}return{...W,publishState:p}}if(o){let p=ak({event:o}),f={};if(s)return i?{publishState:{status:{published:!!p.status.publishedDrawIds?.includes(s),drawDetail:p.status.drawDetails?.[s]},...W}}:{error:_a};if(Array.isArray(a)&&a?.length){let m=o.drawDefinitions?.map(Qb)??[];for(let h of a){if(!ni(h))return{error:re};if(!m.includes(h))return{error:_a};f[h]={status:{published:!!p.status.publishedDrawIds.includes(h),drawDetail:p.status.drawDetails?.[h]}}}}else f=p;return{...W,publishState:f}}let l=[],u=!1,c={};for(let p of e?.events??[]){let f=ak({event:p});c[p.eventId]=f,f.status.published&&(l.push(p.eventId),u=!0);for(let{drawId:m}of p.drawDefinitions??[]){let h=f.status?.publishedDrawIds?.includes(m);h&&(c[m]={status:{published:h}})}}let d=[];if(e){let p=kU({tournamentRecord:e});c.tournament=p??{},(p?.orderOfPlay?.published||p?.participants?.published)&&(u=!0),c.tournament.status={published:u,publishedEventIds:l},p?.orderOfPlay?.embargo&&d.push({type:"orderOfPlay",embargo:p.orderOfPlay.embargo,embargoActive:Lf(p.orderOfPlay)}),p?.participants?.embargo&&d.push({type:"participants",embargo:p.participants.embargo,embargoActive:Lf(p.participants)})}for(let p of e?.events??[]){let f=Qa({event:p})?.drawDetails??{};for(let[m,h]of Object.entries(f)){h?.publishingDetail?.embargo&&d.push({type:"draw",id:m,embargo:h.publishingDetail.embargo,embargoActive:Lf(h.publishingDetail)});for(let[g,I]of Object.entries(h?.stageDetails??{}))I?.embargo&&d.push({type:"stage",id:`${m}:${g}`,embargo:I.embargo,embargoActive:Lf(I)});for(let[g,I]of Object.entries(h?.structureDetails??{}))if(I?.embargo&&d.push({type:"structure",id:g,embargo:I.embargo,embargoActive:Lf(I)}),I?.scheduledRounds)for(let[v,w]of Object.entries(I.scheduledRounds))w?.embargo&&d.push({type:"scheduledRound",id:`${g}:round${v}`,embargo:w.embargo,embargoActive:Lf(w)})}}return d.length&&(c.embargoes=d),{...W,publishState:c}}function ak({event:t}){let e=Qa({event:t});if(!e)return{status:{published:!1}};let i={published:void 0,seedingScaleNames:[],drawIds:[]};e.seeding&&Object.assign(i,e.seeding);let r=e.drawDetails??{};for(let o of t.drawDefinitions?.map(Qb)||[])r[o]||(r[o]={publishingDetail:{published:!1}});let n=r&&Object.keys(r).length&&Object.keys(r).filter(o=>O2({drawDetails:r,drawId:o,ignoreEmbargo:!0})),a=n?.length?n:e.drawIds??[];if(a?.length&&!n?.length)for(let o of a)r[o]={publishingDetail:{published:!0}};let s=a?.length>0;return{status:{publishedDrawIds:a,publishedSeeding:i,drawDetails:r,published:s}}}function Sae(t){let{participantMap:e,participantId:i,matchUpStatus:r,roundPosition:n,structureId:a,matchUpType:s,roundNumber:o,matchUpId:l,potential:u,schedule:c,drawId:d,score:p}=t;!c||!Object.keys(c).length||r==="BYE"||e[i].scheduleItems.push({...c,scheduledDate:Ze(c?.scheduledDate),scheduledTime:pi(c?.scheduledTime),checkScoreHasValue:fr({score:p}),matchUpStatus:r,roundPosition:n,structureId:a,matchUpType:s,roundNumber:o,matchUpId:l,potential:u,drawId:d})}function W0e({finishingPositionRange:t={winner:[],loser:[]},collectionPosition:e,participantMap:i,finishingRound:r,participantWon:n,collectionId:a,matchUpStatus:s,participantId:o,stageSequence:l,roundNumber:u,structureId:c,matchUpId:d,drawId:p,stage:f}){let m=i[o],h=y=>Math.abs(y[0]-y[1]);m.structureParticipation[c]||(m.structureParticipation[c]={rankingStage:f,walkoverWinCount:0,defaultWinCount:0,stageSequence:l,winCount:0,structureId:c,drawId:p});let g=m.structureParticipation[c],{winner:I,loser:v}=t,w=n?I:v;n&&(g.winCount+=1,s===ai&&(g.walkoverWinCount+=1),s===qt&&(g.defaultWinCount+=1)),w&&(!g.finishingPositionRange||h(w)<h(g.finishingPositionRange))&&(g.finishingPositionRange=w),r&&((!g.finishingRound||r<g.finishingRound)&&(g.finishingMatchUpId=d,g.finishingRound=r,g.roundNumber=u),r===1&&(g.participantWon=n)),e&&(g.lineParticipation||(g.lineParticipation=[]),g.lineParticipation.push({collectionPosition:e,collectionId:a,won:n}))}function tq(t){let{withScheduleItems:e,scheduleAnalysis:i,withTeamMatchUps:r,participantMap:n,withOpponents:a,withMatchUps:s,withEvents:o,withDraws:l,finishingPositionRange:u,finishingRound:c,matchUpStatus:d,stageSequence:p,roundNumber:f,structureId:m,score:h,stage:g,withRankingProfile:I,collectionPosition:v,tieWinningSide:w,roundPosition:y,matchUpTieId:b,matchUpSides:S,collectionId:U,matchUpType:T,winningSide:P,matchUpId:D,schedule:E,eventId:R,drawId:C,sides:M}=t,N=a&&M?.length===2&&Object.assign({},...M.map(({sideNumber:A},O)=>{let k=M[1-O].participantId;return A&&{[A]:k}}).filter(Boolean));for(let A of M){let{participantId:O,sideNumber:k,bye:F}=A;if(F)continue;let x=P===k,L=_=>{let B=n[_]?.participant,G=B?.participantType,j=[{participantId:_,participantType:G}];if(G!==$n)for(let K of B?.individualParticipantIds||[]){let Y=n[K]?.participant;j.push({participantType:Y?.participantType,participantId:K})}return j},$=(_,B)=>{if(s){if(n[_].matchUps[D]={participantWon:x,matchUpType:T,structureId:m,sideNumber:k,matchUpId:D,eventId:R,drawId:C,stage:g},a){let G=L(B);n[_].matchUps[D].opponentParticipantInfo=G}U&&(n[_].matchUps[D].collectionId=U)}a&&B&&(n[_].opponents[B]={participantId:B,matchUpId:D,eventId:R,drawId:C}),I&&W0e({finishingPositionRange:u,collectionPosition:v,participantMap:n,participantWon:x,collectionId:U,finishingRound:c,matchUpStatus:d,participantId:_,stageSequence:p,roundNumber:f,structureId:m,matchUpId:D,drawId:C,stage:g}),(i||e)&&Sae({participantMap:n,participantId:_,matchUpStatus:d,roundPosition:y,matchUpType:T,roundNumber:f,structureId:m,matchUpId:D,schedule:E,drawId:C,score:h})},V=({participant:_,partnerParticipantId:B})=>{let G=(j,K)=>{j&&(j.partnerParticipantIds||(j.partnerParticipantIds=[]),j.partnerParticipantIds.includes(K)||j.partnerParticipantIds.push(K))};l&&G(_?.draws?.[C],B),o&&G(_?.events?.[R],B),s&&G(_?.matchUps?.[D],B)};if(O&&n[O]){let _=N?.[k];$(O,_);let B=n[O]?.participant.participantType===ft,G=n[O]?.participant.individualParticipantIds||[];if(b){if(r){let j=K=>n[K].matchUps[b]={participantWon:w===k,matchUpId:b,matchUpType:ei,sideNumber:k};j(O),G.forEach(j)}if(l&&!n[O].draws[C]){let j=S.find(X=>X.sideNumber===k)?.participant?.participantId,K=n[j]?.draws?.[C]?.entryStatus,Y=X=>n[X].draws[C]={entryStatus:K,eventId:R,drawId:C};Y(O),G.forEach(Y)}}if(B&&(G.forEach(j=>n[j]&&$(j,_)),G.forEach((j,K)=>{let Y=G[1-K],X=n[j];X&&V({participant:X,partnerParticipantId:Y})}),o&&S)){let j=S.find(K=>K.sideNumber===k)?.participant?.participantId;if(j){let K=n[j]?.events[R];K?(n[O].events[R]={...K},G.forEach(Y=>n[Y].events[R]={...K})):console.log("Missing teamEntry",{eventId:R,teamParticipantId:j})}}if(P){let j=K=>{x?(n[K].counters[T].wins+=1,n[K].counters.wins+=1,d===ai&&(n[K].counters[T].walkoverWins+=1,n[K].counters.walkoverWins+=1),d===qt&&(n[K].counters[T].defaultWins+=1,n[K].counters.defaultWins+=1)):(n[K].counters[T].losses+=1,n[K].counters.losses+=1,d===ai&&(n[K].counters[T].walkovers+=1,n[K].counters.walkovers+=1),d===qt&&(n[K].counters[T].defaults+=1,n[K].counters.defaults+=1))};j(O),G.forEach(j)}}}}function ZM(t,e){return(t||"").localeCompare(e||"")}function z0e(t){let{participantFilters:e,convertExtensions:i,policyDefinitions:r,tournamentRecord:n,usePublishState:a,contextFilters:s,matchUpFilters:o,participantMap:l,contextProfile:u,withPotentialMatchUps:c,withRankingProfile:d,withScheduleItems:p,scheduleAnalysis:f,withTeamMatchUps:m,withStatistics:h,withOpponents:g,withMatchUps:I,withSeeding:v,withEvents:w,withDraws:y}=t,b=e?.participantIds,S=k=>{let F=[k];return l[k]?.participant.individualParticipantIds?.forEach(x=>F.push(x)),F.some(x=>!b?.length||b.includes(x))?F:[]},U={withMatchUps:I||d,withEvents:w||d,withDraws:y||d,withPotentialMatchUps:c,withRankingProfile:d,withScheduleItems:p,scheduleAnalysis:f,withTeamMatchUps:m,withStatistics:h,participantMap:l,withOpponents:g,withSeeding:v},T=[],P={},D=[],E={},R={},C={},M={},N={},A=({eventType:k,scaleNames:F,participantId:x})=>l[x]?.participant?.rankings?.[k]?.find(L=>F.includes(L.scaleName))?.scaleValue;for(let k of n?.events||[]){if(e?.eventIds&&!e.eventIds.includes(k.eventId))continue;let{drawDefinitions:F=[],extensions:x=[],wheelchairClass:L,eventType:$,eventName:V,category:_,entries:B,eventId:G,gender:j}=k,{flightProfile:K}=Bi({event:k}),Y=K?.flights??[],X=zh({event:k}).publishState;X&&(E[G]=X);let Z=X?.status?.publishedSeeding;if(w||v||d){let ae=i?Object.assign({},...CB(x??[])):{};R[G]={...ae,wheelchairClass:L,eventName:V,eventType:$,category:_,eventId:G,gender:j};let te=[_?.categoryName,_?.ageCategoryCode].filter(Boolean);for(let ne of B){let{participantId:le}=ne;if(!le||!l[le])continue;let de=A({eventType:$,scaleNames:te,participantId:le}),pe,ge;if(v){let Pe=l[le].participant;({seedAssignments:pe,seedValue:ge}=j0e({publishedSeeding:Z,usePublishState:a,withSeeding:v,participant:Pe,event:k}))}let Me=Pe=>{if(l[Pe]?.events?.[G])return;let Be=l[Pe];G0e({convertExtensions:i,seedAssignments:pe,participant:Be,withSeeding:v,seedValue:ge,eventId:G,ranking:de,entry:ne})};Me(le),(l[le].participant.individualParticipantIds||[]).forEach(Me)}}let J=E?.[G]?.publishedSeeding;if(y||d||v){let ae=ne=>ne?Object.assign({},...ne.map(({participantId:le,seedValue:de,seedNumber:pe})=>({[le]:{seedValue:de,seedNumber:pe}}))):void 0,te=nt([...F.map(Qb),...Y.map(Qb)]);for(let ne of te){let le=F.find(ee=>ee.drawId===ne),de=[_?.categoryName,_?.ageCategoryCode].filter(Boolean),{structures:pe=[],drawOrder:ge,drawName:Me,drawType:Pe}=le??{},Be=Y?.find(ee=>ee.drawId===ne),fe=le?.entries||Be?.drawEntries,Te=Be?.flightNumber,ce=(le?.structures||[]).sort((ee,Se)=>_h(ee,Se)).map(({structureId:ee,structures:Se})=>[ee,...(Se||[]).map(({structureId:De})=>De)]).flat(1/0),ye,be,Fe,we,Ne=0,me=new Set(pe.filter(({stage:ee,stageSequence:Se})=>ee===Ae&&Se===1||ee===ze).flatMap(ee=>{let{positionAssignments:Se}=Kt({structure:ee}),{seedAssignments:De,stageSequence:it,stage:Ue}=ee;return Ue===Ae?(Ne=Se?.length??0,Fe=Se,we=De):it===1&&(ye=Se,be=De),Se}).map(({participantId:ee})=>ee).filter(Boolean)),Ee=ae(we),Le=ae(be),Q=le?fe.filter(({participantId:ee})=>me.has(ee)):fe,se=!a||J?.published&&(J?.drawIds?.length===0||J?.drawIds?.includes(ne));for(let ee of Q){if(!l[ee.participantId])continue;let{entryStatus:Se,entryStage:De,entryPosition:it,participantId:Ue}=ee,ut=A({participantId:Ue,scaleNames:de,eventType:$}),yi=qe=>{if(!l[qe]||l[qe].draws?.[ne])return;let bi=v&&se,oi=bi?{}:void 0,nn=bi?Ee?.[Ue]?.seedValue||Ee?.[Ue]?.seedNumber:void 0,Fo=nn?Ee?.[Ue]:void 0,Mf=bi?Le?.[Ue]?.seedValue||Le?.[Ue]?.seedNumber:void 0,Nf=Mf?Le?.[Ue]:void 0;oi&&nn&&(oi[Ae]=Fo),oi&&Mf&&(oi[ze]=Nf);let ly=nn||Mf;ly&&(l[qe].participant.seedings[$]||(l[qe].participant.seedings[$]=[]),Fo&&l[qe].participant.seedings[$].push({...Fo,scaleName:ne}),Nf&&l[qe].participant.seedings[$].push({...Nf,scaleName:ne}),oi&&(l[qe].events[G].seedAssignments||(l[qe].events[G].seedAssignments={}),Object.keys(oi).forEach(uy=>l[qe].events[G].seedAssignments[uy]=oi[uy]))),(y||d)&&(l[qe].draws[ne]=je({seedAssignments:oi,entryPosition:it,entryStatus:Se,entryStage:De,seedValue:ly,eventId:G,ranking:ut,drawId:ne},!1,!1,!0))};[Us,wf].includes(Se)||(yi(Ue),(l[Ue].participant.individualParticipantIds||[])?.forEach(yi))}let oe=(le?.structures??[]).reduce((ee,Se)=>(ee.includes(Se.stage)||ee.push(Se.stage),ee),[]),ue=(le?.links??[]).length;C[ne]={qualifyingPositionAssignments:ye,qualifyingSeedAssignments:be,mainPositionAssignments:Fe,qualifyingSeedingMap:Le,mainSeedAssignments:we,orderedStructureIds:ce,mainSeedingMap:Ee,flightNumber:Te,linksCount:ue,drawOrder:ge,drawName:Me,drawType:Pe,drawSize:Ne,drawId:ne,stages:oe}}}if(d||f||m||h||g||I||y){let ae=!!f||c,te=xu({afterRecoveryTimes:!!f,policyDefinitions:r,tournamentRecord:n,inContext:!0,participantMap:l,contextFilters:s,matchUpFilters:o,contextProfile:u,nextMatchUps:ae,event:k})?.matchUps??[];for(let ne of te){let{finishingPositionRange:le,potentialParticipants:de,tieMatchUps:pe=[],sides:ge=[],winningSide:Me,matchUpType:Pe,matchUpId:Be,eventId:fe,drawId:Te,collectionId:ce,containerStructureId:ye,stageSequence:be,finishingRound:Fe,matchUpStatus:we,roundPosition:Ne,roundNumber:me,structureId:Ee,schedule:Le,score:Q,stage:se}=ne;if(P[Be]=ne,d&&ye&&Ee&&Te&&(M[Ee]||(M[Ee]=[]),M[Ee].push(ne),!N[ye])){let ue=F.find(ee=>ee.drawId===Te);ue&&(N[ye]={drawDefinition:ue,drawId:Te})}let oe={finishingPositionRange:le,containerStructureId:ye,finishingRound:Fe,stageSequence:be,roundPosition:Ne,collectionId:ce,roundNumber:me,structureId:Ee,schedule:Le,eventId:fe,drawId:Te,score:Q,stage:se};tq({...oe,...U,matchUpStatus:we,winningSide:Me,matchUpType:Pe,matchUpId:Be,sides:ge});for(let ue of pe){let{winningSide:ee,sides:Se=[],matchUpId:De,collectionPosition:it,collectionId:Ue,matchUpStatus:ut,matchUpType:yi}=ue;tq({...oe,...U,winningSide:ee,tieWinningSide:Me,matchUpTieId:Be,matchUpId:De,sides:Se,collectionId:Ue,collectionPosition:it,matchUpSides:ge,matchUpStatus:ut,matchUpType:yi})}Array.isArray(de)&&(ae||f||p)&&de.flat().map(yt).filter(Boolean)?.forEach(ue=>{S(ue)?.forEach(ee=>{l[ee]&&(l[ee].potentialMatchUps[Be]=je({tournamentId:n?.tournamentId,matchUpId:Be,eventId:fe,drawId:Te}))}),(f||p)&&Sae({potential:!0,participantMap:l,participantId:ue,matchUpStatus:we,roundPosition:Ne,structureId:Ee,matchUpType:Pe,roundNumber:me,matchUpId:Be,schedule:Le,drawId:Te,score:Q})})}D.push(...te)}}let O={};if(d)for(let[k,F]of Object.entries(N)){let{drawDefinition:x,drawId:L}=F,$=x.structures?.find(j=>j.structureType===gn&&j.stage===Ae&&j.stageSequence===1);if(!$?.structures)continue;let V=$.structures,_=V.length,B=V.reduce((j,K)=>j+(K.positionAssignments?.length||0),0),G=x.structures?.find(j=>j.stage===Ti);O[L]||(O[L]={});for(let j of V){let K=j.structureId,Y=M[K];if(!Y?.length)continue;let X=j.positionAssignments?.length,{subOrderMap:Z}=k2({positionAssignments:j.positionAssignments}),J=Wh({matchUps:Y,subOrderMap:Z});if(J?.participantResults)for(let[ae,te]of Object.entries(J.participantResults)){let{groupOrder:ne,provisionalOrder:le}=te,de=ne||le;if(!de)continue;let pe;if(B===X&&de)pe=[de,de];else if(_>1&&de&&!G)pe=[1,_];else if(_>1&&de&&G){let ge=x.links?.find(Me=>Me.source.structureId===k)?.source?.finishingPositions;if(ge){let Me=ge.length*_;if(ge.includes(de))pe=[1,Me];else{let Pe=(X-de)*_;pe=[Me+1,B-Pe]}}}pe&&(O[L][ae]=pe)}}}if(h||d||f){let k=Object.values(l);for(let F of k){let{wins:x,losses:L,[zt]:{wins:$,losses:V},[Bt]:{wins:_,losses:B}}=F.counters,G=(j,K,Y)=>{let X=K+Y,Z=K,J=X&&Z/X;F.statistics[j]={denominator:X,numerator:Z,statValue:J,statCode:j}};if(h&&(G(dD,x,L),G(`${dD}.${zt}`,$,V),G(`${dD}.${Bt}`,_,B)),d){let j=(K=[])=>Math.abs(K[0]-K[1]);for(let K of Object.keys(F.draws)){let{orderedStructureIds:Y=[],flightNumber:X}=C[K]||{};if(F.structureParticipation&&Y.length){let Z,J=0,ae=Y.map(te=>{let ne=F.structureParticipation[te];if(!ne)return;Z||(Z=ne?.finishingPositionRange),j(Z)>j(ne?.finishingPositionRange)&&(Z=ne?.finishingPositionRange);let le=ne.stage!==ze;return le&&(J+=1),je({...ne,participationOrder:le?J:void 0,flightNumber:X})}).filter(Boolean);if(F.draws[K]){let te=F.participant.participantId,ne=O[K]?.[te];ne&&(Z=ne),F.draws[K].finishingPositionRange=Z,F.draws[K].structureParticipation=ae}}}}if(f){let j=wt(f)?f.scheduledMinutesDifference:0,K=F.scheduleItems||[],Y=F.potentialMatchUps||{},X=K.reduce((J,ae)=>{let{scheduledDate:te,scheduledTime:ne}=ae;return J[te]||(J[te]=[]),ne&&J[te].push(ae),J},{});Object.values(X).forEach(J=>J.sort(qie));for(let J of K){let{typeChangeTimeAfterRecovery:ae,timeAfterRecovery:te,scheduledDate:ne,scheduledTime:le}=J,de=X[ne],pe=Rt(le);for(let ge of de){if(ge.matchUpId===J.matchUpId||Lr(ge.matchUpStatus)&&!ge.checkScoreHasValue)continue;let Me=J.matchUpType!==ge.matchUpType&&ae||te,Pe=J.drawId===ge.drawId,Be=Y[J.matchUpId]&&Y[ge.matchUpId],fe=Rt(ge.scheduledTime),Te=Math.abs(fe-pe),ce=fe>=pe;if((j&&!Number.isNaN(j)?Te<=j:ce&&Rt(ge.scheduledTime)<Rt(Me))&&!(Be&&Pe)&&ce){let ye=[J.matchUpId,ge.matchUpId].sort(ZM).join("|");F.scheduleConflicts[ye]={priorScheduledMatchUpId:J.matchUpId,matchUpIdWithConflict:ge.matchUpId}}}}let Z=F.participant.participantId;Object.keys(F.scheduleConflicts).length&&T.push(Z),l[Z].scheduleConflicts=F.scheduleConflicts}}}return{participantIdsWithConflicts:T,eventsPublishStatuses:E,derivedEventInfo:R,derivedDrawInfo:C,mappedMatchUps:P,participantMap:l,matchUps:D}}function OU({participantFilters:t={},tournamentRecord:e,participants:i=[]}){if(!Object.keys(t).length)return i;let{accessorValues:r,drawEntryStatuses:n,positionedParticipants:a,eventEntryStatuses:s,participantRoles:o,participantRoleResponsibilities:l,participantTypes:u,participantIds:c,signInStatus:d,enableOrFiltering:p,eventIds:f,genders:m}=t,h=Nl(f)&&e?.events?.filter(y=>f?.includes(y.eventId))||e?.events||[],g=n&&q0e({drawEntryStatuses:n,tournamentEvents:h}),I=s&&Y0e({eventEntryStatuses:s,tournamentEvents:h}),v=a!==void 0&&[!0,!1].includes(a)&&h.reduce((y,b)=>y.concat(...(b.drawDefinitions||[]).map(S=>fne({drawDefinition:S}).allPositionedParticipantIds).filter(Boolean)),[]),w=y=>r?.reduce((b,S)=>{let{accessor:U,value:T}=S,{values:P}=yp({element:y,accessor:U});return b&&P?.includes(T)},!0);if(i=i?.filter(y=>{let b=Ss({element:y,itemType:gU})?.timeItem?.itemValue,{participantRoleResponsibilities:S,participantType:U,participantRole:T,participantId:P,person:D}=y,E=Array.isArray(m)&&m?.length&&D?.sex&&m.includes(D.sex);return p?m&&E||a&&v.includes(P)||a===!1&&!v.includes(P)||g?.includes(P)||I?.includes(P)||c?.includes(P)||d&&b===d||u&&U&&Nl(u)&&u.includes(U)||o&&T&&Nl(o)&&o.includes(T)||l&&Nl(S)&&Nl(l)&&l.find(R=>S?.includes(R))||r?.length&&Nl(r)&&w(y):(!m||E)&&(a===void 0||a&&v.includes(P)||a===!1&&!v.includes(P))&&(!g||g.includes(P))&&(!I||I.includes(P))&&(!c||c.includes(P))&&(!d||b===d)&&(!u||U&&Nl(u)&&u.includes(U))&&(!o||T&&Nl(o)&&o.includes(T))&&(!l||Nl(S)&&Nl(l)&&l.find(R=>S?.includes(R)))&&(!r?.length||Nl(r)&&w(y))}),h.length&&f){let y=new Set(h.filter(b=>f.includes(b.eventId)).flatMap(b=>{let S=(b.entries||[]).map(T=>T.participantId);if(Pi(pl)(b.eventType))return S;let U=(e?.participants??[]).filter(T=>S.includes(T.participantId)).flatMap(T=>T.individualParticipantIds);return S.concat(...U)}));i=i?.filter(b=>y.has(b.participantId))}return i}function Nl(t){return t&&Array.isArray(t)&&t.length}function q0e({drawEntryStatuses:t,tournamentEvents:e}){let i=({entryStatus:r})=>Array.isArray(t)?t.includes(r):!0;return nt(e.reduce((r,n)=>{let{flightProfile:a}=Bi({event:n}),s=a?.flights?.flatMap(({drawEntries:l})=>Array.isArray(l)?l.filter(i).map(yt):[])||[],o=n.drawDefinitions?.map(({entries:l})=>l?l.filter(i).map(yt):[])||[];return r.concat(...s,...o)},[]))}function Y0e({eventEntryStatuses:t,tournamentEvents:e}){return nt(e.reduce((i,r)=>{let n=(r.entries||[]).filter(({entryStatus:a})=>Array.isArray(t)?t.includes(a):!0).map(yt);return i.concat(...n)},[]))}function Ri(t){let{withIndividualParticipants:e,participantFilters:i={},withPotentialMatchUps:r,withRankingProfile:n,convertExtensions:a,policyDefinitions:s,withScheduleItems:o,tournamentRecord:l,scheduleAnalysis:u,withSignInStatus:c,withTeamMatchUps:d,withScaleValues:p,usePublishState:f,withStatistics:m,contextFilters:h,matchUpFilters:g,contextProfile:I,withOpponents:v,withMatchUps:w,internalUse:y,withSeeding:b,withEvents:S,withDraws:U,withISO2:T,withIOC:P}=t,D="getParticipants";if(!l)return q({stack:D,result:{error:ve}});(w||n)&&co({tournamentRecord:l});let E=Ene({convertExtensions:a,tournamentRecord:l,withSignInStatus:c,withScaleValues:p,internalUse:y,withISO2:T,withIOC:P}),{participantMap:R}=E,C=z0e({withMatchUps:w??n,withEvents:S??n,withDraws:U??n,withPotentialMatchUps:r,participantFilters:i,withRankingProfile:n,convertExtensions:a,withScheduleItems:o,policyDefinitions:s,tournamentRecord:l,scheduleAnalysis:u,withTeamMatchUps:d,usePublishState:f,withStatistics:m,contextFilters:h,matchUpFilters:g,participantMap:R,withOpponents:v,contextProfile:I,withSeeding:b}),{participantIdsWithConflicts:M,eventsPublishStatuses:N,derivedEventInfo:A,derivedDrawInfo:O,mappedMatchUps:k}=C,F=C.matchUps;R=C.participantMap;let x=u??r,L=({potentialMatchUps:j,scheduleConflicts:K,scheduleItems:Y,participant:X,statistics:Z,opponents:J,matchUps:ae,events:te,draws:ne})=>{let le=Object.values(ne),de=Object.values(J);return v&&le?.forEach(pe=>{pe.opponents=de.filter(ge=>ge.drawId===pe.drawId)}),je({...X,scheduleConflicts:u?Object.values(K):void 0,draws:U||n?le:void 0,events:S||n?Object.values(te):void 0,matchUps:w||n?Object.values(ae):void 0,opponents:v?de:void 0,potentialMatchUps:x?Object.values(j):void 0,statistics:m?Object.values(Z):void 0,scheduleItems:o?Y:void 0},!1,!1,!0)},$=new Map;for(let j of Object.keys(R))$.set(j,L(R[j]));let V=[...$.values()],_=s?.[Lv]?.participant,B=OU({participants:V,participantFilters:i,tournamentRecord:l});if(e){let j=wt(e)?e:void 0;for(let K of B)for(let Y of K.individualParticipantIds??[]){K.individualParticipants??=[];let X=$.get(Y),Z=j?Vm({template:j,source:X}):X;K.individualParticipants.push(Z)}}let G=_?B.map(j=>Vm({source:j,template:_})):B;return{participantMap:t.returnParticipantMap!==!1?R:void 0,mappedMatchUps:t.returnMatchUps!==!1?k:void 0,matchUps:t.returnMatchUps!==!1?F:void 0,missingParticipantIds:E.missingParticipantIds,participantIdsWithConflicts:M,eventsPublishStatuses:N,derivedEventInfo:A,derivedDrawInfo:O,participants:G,...W}}function Wm(t){let{tournamentRecord:e,scaleAttributes:i,participantId:r}=t,n=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(!r)return{error:dr};let{participant:a,tournamentId:s}=Xd({tournamentRecords:n,tournamentRecord:e,participantId:r});return a?{...Xl({participant:a,scaleAttributes:i}),tournamentId:s}:{error:ji}}function K0e(t,e){let i=t.startDate||e?.startDate,r=t.endDate||e?.endDate;return!i||!r?{error:Zxe}:!Mn(i)||!Mn(r)?{error:or}:{startDate:i,endDate:r}}function iq(t,e){let i=new Date(Ze(t)),r=new Date(Ze(e)),n=r.getFullYear()-i.getFullYear(),a=r.getMonth()-i.getMonth();return(a<0||a===0&&r.getDate()<i.getDate())&&n--,n}function rq(t,e,i){return!(e!==void 0&&t<e||i!==void 0&&t>i)}function X0e(t){return/^C\d{1,2}-\d{1,2}$/.test(t.ageCategoryCode||"")}function J0e(t,e,i,r){if(X0e(e))return{valid:!0};let n=e.ageMin,a=e.ageMax;if(e.ageCategoryCode&&!n&&!a){let d=$p({consideredDate:i,category:e});d.error||(n=d.ageMin,a=d.ageMax)}if(!n&&!a)return{valid:!0};let s=t.person?.birthDate;if(!s)return{valid:!1,reason:"Missing birthDate",details:{requiredMin:n,requiredMax:a}};let o=iq(s,i),l=iq(s,r),u=rq(o,n,a),c=rq(l,n,a);if(!u){let d=[n===void 0?null:`min: ${n}`,a===void 0?null:`max: ${a}`].filter(Boolean).join(", ");return{valid:!1,reason:`Age ${o} at event start (${i}) outside range [${d}]`,details:{birthDate:s,ageAtStart:o,ageAtEnd:l,requiredMin:n,requiredMax:a}}}if(!c){let d=[n===void 0?null:`min: ${n}`,a===void 0?null:`max: ${a}`].filter(Boolean).join(", ");return{valid:!1,reason:`Age ${l} at event end (${r}) outside range [${d}]`,details:{birthDate:s,ageAtStart:o,ageAtEnd:l,requiredMin:n,requiredMax:a}}}return{valid:!0}}function Q0e(t,e,i,r){if(!e.ratingMin&&!e.ratingMax)return{valid:!0};if(!e.ratingType)return{valid:!0};let n={scaleType:"RATING",scaleName:e.ratingType,eventType:i.eventType},{scaleItem:a}=Wm({tournamentRecord:r,participantId:t.participantId,scaleAttributes:n});if(!a?.scaleValue)return{valid:!1,reason:`Missing ${e.ratingType} rating`,details:{ratingType:e.ratingType,requiredMin:e.ratingMin,requiredMax:e.ratingMax}};let s;if(typeof a.scaleValue=="object"){let o=yp({element:a.scaleValue,accessor:a.scaleValue?.accessor});if(o===void 0)return{valid:!1,reason:`Cannot extract rating value from ${e.ratingType} scale item`,details:{ratingType:e.ratingType,requiredMin:e.ratingMin,requiredMax:e.ratingMax}};s=o}else s=a.scaleValue;return e.ratingMin!==void 0&&s<e.ratingMin?{valid:!1,reason:`${e.ratingType} rating ${s} below minimum ${e.ratingMin}`,details:{ratingType:e.ratingType,ratingValue:s,requiredMin:e.ratingMin,requiredMax:e.ratingMax}}:e.ratingMax!==void 0&&s>e.ratingMax?{valid:!1,reason:`${e.ratingType} rating ${s} above maximum ${e.ratingMax}`,details:{ratingType:e.ratingType,ratingValue:s,requiredMin:e.ratingMin,requiredMax:e.ratingMax}}:{valid:!0}}function Z0e(t){let e=t.person;if(!e)return"Unknown";let i=e.standardGivenName||e.passportGivenName,r=e.standardFamilyName||e.passportFamilyName;return[i,r].filter(Boolean).join(" ")||"Unknown"}function e_e(t,e,i,r,n,a){let s=J0e(t,e,r,n),o=Q0e(t,e,i,a);if(!s.valid||!o.valid){let l={participantId:t.participantId,participantName:Z0e(t),rejectionReasons:[]};return s.valid||l.rejectionReasons.push({type:"age",reason:s.reason,details:s.details||{}}),o.valid||l.rejectionReasons.push({type:"rating",reason:o.reason,details:o.details||{}}),l}return null}function mm({participantId:t,drawDefinition:e,entryStatus:i,entryStage:r}){if(!e)return{error:$e};let n=e.entries?.find(a=>a.participantId===t&&(!i||i===a.entryStatus)&&(!r||r===a.entryStage));return t&&n}function t_e({relevantLinks:t,drawDefinition:e,provisionalPositioning:i,roundQualifiersCounts:r}){let n=0;for(let a of t){let s=tt({structureId:a.source.structureId,drawDefinition:e})?.structure;if(s?.stage===ze){let o=a.source.roundNumber,l=a.target.roundNumber,u;if(s.structureType===gn){let c=s.structures?.length??0,d=a.source.finishingPositions?.length??0;u=c*d}else u=At({matchUpFilters:{roundNumbers:[o]},structure:s,afterRecoveryTimes:!1,provisionalPositioning:i,inContext:!1}).matchUps?.length||0;r[l]||(r[l]=0),r[l]+=u,n+=u}}return n}function Hv(t){let{provisionalPositioning:e,drawDefinition:i,stageSequence:r,structureId:n,stage:a}=t;if(!i)return{error:$e};let{entryProfile:s}=yU({drawDefinition:i}),o=a&&r&&s?.[a]?.stageSequence?.[r]?.qualifiersCount||a&&s?.[a]?.qualifiersCount||0,l={};if(!n)return{qualifiersCount:o,roundQualifiersCounts:l};let{structure:u}=tt({drawDefinition:i,structureId:n}),c=i.links?.filter(f=>f?.target?.structureId===u?.structureId),d=0;c?.length&&(d=t_e({relevantLinks:c,drawDefinition:i,provisionalPositioning:e,roundQualifiersCounts:l}));let p=Object.keys(l);if(p.length<=1){let f=p[0]||1;l[f]=Math.max(l[f]||0,o)}return d=Math.max(d,o),{qualifiersCount:d,roundQualifiersCounts:l}}function YP({stage:t,drawDefinition:e}){let{entryProfile:i}=yU({drawDefinition:e});return i?.[t]?.drawSize||0}function i_e(t){let{provisionalPositioning:e,drawDefinition:i,stageSequence:r,stage:n}=t,a=YP({stage:n,drawDefinition:i}),{qualifiersCount:s}=Hv({provisionalPositioning:e,drawDefinition:i,stageSequence:r,stage:n});return a&&a-s}function Uae({stage:t,drawDefinition:e}){return!!(t===Rr||v2({stage:t,drawDefinition:e})&&YP({stage:t,drawDefinition:e}))}function Tae({entryStatus:t=ua,drawDefinition:e,stageSequence:i,stage:r}){if(t===Gs)return wLe({stage:r,drawDefinition:e})?{positionsAvailable:1/0,...W}:{error:nie};let n=i_e({drawDefinition:e,stageSequence:i,stage:r}),a=SLe({drawDefinition:e,stage:r}),s=wx({entryStatus:CI,drawDefinition:e,stage:r}),o=wx({entryStatus:ua,drawDefinition:e,stage:r}),l=s+o,u=l>=n,c=n-l;return r!==Rr&&u?{error:lx}:t===CI?s<a?{...W}:{error:lx}:{positionsAvailable:c,...W}}function x2(t){let e=He(t,[{[In]:!0,[Gre]:!0}]);if(e.error)return e;let{suppressDuplicateEntries:i=!0,entryStatus:r=ua,entryStageSequence:n,entryStage:a=Ae,ignoreStageSpace:s,drawDefinition:o,entryPosition:l,participant:u,roundTarget:c,extensions:d,extension:p,drawType:f,event:m}=t,h="addDrawEntry";if(f!==la&&!Uae({stage:a,drawDefinition:o}))return q({result:{error:hf},stack:h});let g=Tae({stageSequence:n,stage:a,drawDefinition:o,entryStatus:r});if(!s&&!g.success&&(!f||f!==la))return{error:g.error};if(p&&!ml({extension:p}))return q({result:{error:re},info:"Invalid extension",context:{extension:p},stack:h});let I=t.participantId||u?.participantId;if(!I)return q({result:{error:dr},stack:h});let v=r===Pc&&mm({participantId:I,drawDefinition:o,entryStatus:r}),w=a===Rr&&mm({participantId:I,drawDefinition:o,entryStage:a}),y=mm({participantId:I,drawDefinition:o}),b=r!==Pc&&a!==Rr&&y;if(b)return i?(st({payload:{drawId:o.drawId,eventId:m?.eventId,error:Lb,participantId:I},topic:e2}),{...W}):q({result:{error:Lb},context:{participantId:I},stack:h});if(v||w)return q({context:{invalidEntry:b,invalidLuckyLoser:v,invalidVoluntaryConsolation:w},result:{error:dM},stack:h});let S=je({entryStageSequence:n,participantId:I,entryPosition:l,entryStatus:r,entryStage:a,extensions:d});return p&&Ft({element:S,extension:p}),c&&Ft({extension:{name:"roundEntry",value:c},element:S}),o.entries??=[],o.entries.push(S),ii({drawDefinition:o}),{...W}}function r_e(t){let e="addDrawEntries",{suppressDuplicateEntries:i=!0,entryStatus:r=ua,autoEntryPositions:n=!0,ignoreStageSpace:a,participantIds:s,drawDefinition:o,stageSequence:l,stage:u=Ae,roundTarget:c,extension:d,event:p}=t,f=o.drawType===la;if(!u)return{error:Nte};if(!o)return{error:$e};if(!Array.isArray(s))return{error:Ia};if(!f&&!Uae({stage:u,drawDefinition:o}))return{error:hf};if(d&&!ml({extension:d}))return q({result:{error:re},info:"Invalid extension",context:{extension:d},stack:e});let m=Tae({drawDefinition:o,stageSequence:l,entryStatus:r,stage:u});if(!a&&!m.success&&!f)return{error:m.error};let h=m.positionsAvailable??0;if(!a&&!f&&u!==Rr&&h<s.length)return{error:aB};let g=[],I=o.drawId,v=p?.eventId,w=s.reduce((y,b)=>{let S=r===Pc&&mm({participantId:b,drawDefinition:o,entryStatus:r}),U=u===Rr&&mm({entryStage:u,drawDefinition:o,participantId:b}),T=mm({participantId:b,drawDefinition:o});return r!==Pc&&u!==Rr&&T&&(g.push(b),i&&st({payload:{error:Lb,participantId:b,eventId:v,drawId:I},topic:e2})),S||U?y.concat(b):y},[]);return g.length&&!i?q({context:{eventId:v,drawId:I,duplicateEntries:g},result:{error:Lb},stack:e}):(s.filter(y=>y&&!w.includes(y)).forEach(y=>{let b={entryStageSequence:l,entryStage:u,participantId:y,entryStatus:r};d&&Ft({element:b,extension:d}),c&&Ft({extension:{name:El,value:c},element:b}),o.entries??=[],o.entries.push(b)}),n&&(o.entries=wo({entries:o.entries})),ii({drawDefinition:o}),w?.length||g?.length?{info:"some participantIds could not be added",participantIdsNotAdded:w,duplicateEntries:g,...W}:{...W})}function F2({suppressDuplicateEntries:t=!0,autoEntryPositions:e=!0,entryStageSequence:i,ignoreStageSpace:r,participantIds:n,drawDefinition:a,entryStatus:s,roundTarget:o,entryStage:l,extension:u,drawId:c,event:d}){if(!n?.length)return{error:Wd};if(!d)return{error:ps};if(!c)return{error:xo};let p=(d.entries||[]).map(yt);if(n.filter(h=>!p.includes(h)).length)return{error:Cte};if(a){let h=r_e({stageSequence:i,suppressDuplicateEntries:t,autoEntryPositions:e,stage:l,ignoreStageSpace:r,participantIds:n,drawDefinition:a,entryStatus:s,roundTarget:o,extension:u});if(h.error)return h}let{flightProfile:f}=Bi({event:d}),m=f?.flights.find(h=>h.drawId===c);return m?.drawEntries&&(n.forEach(h=>{let g=s===Pc&&sk({participantId:h,entryStatus:s,flight:m}),I=l===Rr&&sk({participantId:h,entryStage:l,flight:m});!(s!==Pc&&l!==Rr&&sk({flight:m,participantId:h}))&&!g&&!I&&m.drawEntries.push({participantId:h,entryStatus:s,entryStage:l})}),e&&(m.drawEntries=wo({entries:m.drawEntries}))),{...W}}function sk({participantId:t,entryStatus:e,entryStage:i,flight:r}){let n=r.drawEntries?.find(a=>a.participantId===t&&(!e||e===a.entryStatus)&&(!i||i===a.entryStage));return t&&n}function xU({autoEntryPositions:t=!0,participantIds:e=[],entryStatuses:i,stage:r,event:n}){let a="removeEventEntries";if(!n?.eventId)return{error:ui};if(!Array.isArray(e)||e.some(d=>!ni(d)))return q({result:{error:Co},stack:a});let s=(n.drawDefinitions??[]).flatMap(d=>Df({drawDefinition:d}).assignedParticipantIds??[]),o=(i?.length&&n.entries?.filter(d=>d.entryStatus&&i.includes(d.entryStatus))||[]).map(yt).filter(d=>!s.includes(d)),l=(r&&n.entries?.filter(d=>d.entryStage&&d.entryStage===r)||[]).map(yt).filter(d=>!s.includes(d));if(e.length?e=e.filter(d=>(!i?.length||o.includes(d))&&(!r||l.includes(d))):o.length&&l.length?e=Li(o,l):o.length?e=o:l.length&&(e=l),e?.length&&s.some(d=>e.includes(d)))return q({result:{error:Nv},stack:a});if(!e?.length)return{...W,participantIdsRemoved:[]};let u=[];n.entries=(n.entries??[]).filter(d=>{let p=!e.includes(d?.participantId);return p||u.push(d.participantId),p}),t&&(n.entries=wo({entries:n.entries}));let{flightProfile:c}=Bi({event:n});return c?.flights?.forEach(d=>{d.drawEntries=(d.drawEntries||[]).filter(p=>!e.includes(p.participantId))}),n.drawDefinitions?.forEach(d=>{d.entries=(d.entries??[]).filter(p=>!e.includes(p.participantId))}),{...W,participantIdsRemoved:u}}var Dae={[Cr]:{policyName:"matchUpActionsDefault",enabledStructures:[{stages:[],stageSequences:[],enabledActions:[],disabledActions:[]}],participants:{enforceCategory:!0,enforceGender:!0},processCodes:{substitution:["RANKING.IGNORE","RATING.IGNORE"]},substituteAfterCompleted:!1,substituteWithoutScore:!1}},Wv=Dae;function n_e(t,e,i,r){return e.gender&&i&&!(Aa(e.gender)||du(e.gender))&&ln(e.gender)!==ln(t.person?.sex)?(r.push({participantId:t.participantId,sex:t.person?.sex}),!1):!0}function a_e({participantIds:t,typedParticipantIds:e,checkTypedParticipants:i}){return t.filter(r=>!i||e.includes(r))}function s_e({tournamentRecord:t,participantIds:e,event:i,entryStatus:r,genderEnforced:n,mismatchedGender:a}){function s(c,d,p){return Pi(zt)(d.eventType)&&c.participantType===It&&!dp(p)}function o(c,d,p){return d.eventType===Bt&&c.participantType===ft&&!dp(p)}function l(c,d,p,f,m){return d.eventType===Bt&&c.participantType===It&&dp(p)?d.gender&&f&&!(Aa(d.gender)||du(d.gender))&&ln(d.gender)!==ln(c.person?.sex)?(m.push({participantId:c.participantId,sex:c.person?.sex}),!1):!0:!1}function u(c,d,p){return d.eventType===_t&&(c.participantType===_t||dp(p)&&c.participantType===It)}return t?.participants?.filter(c=>e.includes(c.participantId)?s(c,i,r)&&(!i.gender||!n||Aa(i.gender)||du(i.gender)||ln(i.gender)===ln(c.person?.sex))||o(c,i,r)||l(c,i,r,n,a)?!0:s(c,i,r)&&!n_e(c,i,n,a)?!1:u(c,i,r):!1).map(c=>c.participantId)??[]}function o_e({typedParticipantIds:t,categoryRejections:e,tournamentRecord:i,startDate:r,endDate:n,event:a}){let s=[];for(let o of t){let l=i.participants?.find(u=>u.participantId===o);if(l)if(a.category){let u=e_e(l,a.category,a,r,n,i);u?e.push(u):s.push(o)}else s.push(o)}return s}function l_e({enforceCategory:t,event:e,tournamentRecord:i,typedParticipantIds:r,categoryRejections:n}){if(t&&e.category&&i){let a=K0e(e,i);if(!("error"in a)){let{startDate:s,endDate:o}=a;return o_e({typedParticipantIds:r,tournamentRecord:i,event:e,startDate:s,endDate:o,categoryRejections:n})}}return r}function u_e({validParticipantIds:t,existingIds:e,entryStatus:i,entryStage:r,extensions:n,extension:a,roundTarget:s,entryStageSequence:o,addedParticipantIdEntries:l,event:u}){t.forEach(c=>{if(!e.has(c)){let d=je({participantId:c,entryStatus:i,entryStage:r,extensions:n});a&&Ft({element:d,extension:a}),s&&Ft({extension:{name:El,value:s},element:d}),o&&(d.entryStageSequence=o),l.push(d.participantId),u.entries?.push(d)}})}function c_e({tournamentRecord:t,removedEntries:e,event:i}){if(i.eventType&&[bc,Ua].includes(i.eventType)){let r=new Set((i.entries||[]).map(l=>l.participantId)),n=(i.entries||[]).filter(l=>dp(l.entryStatus)).map(l=>l.participantId),a=t?.participants??[],s=new Set(a.filter(l=>r.has(l.participantId)&&l.participantType&&[ft,_t].includes(l.participantType)).map(l=>l.individualParticipantIds).flat(1/0)),o=n.filter(l=>s.has(l));o.length&&(e.push(...o),xU({participantIds:o,autoEntryPositions:!1,event:i}))}}function d_e(t,e){if(!Array.isArray(t.participantIds))return q({result:{error:Ia},stack:e});let i=nt(t.participantIds??[]);return t.event?i?.length?t.event?.eventId?{participantIds:i}:{error:ps}:q({result:{error:Wd},stack:e}):{error:ui}}function p_e({policyDefinitions:t,tournamentRecord:e,event:i,enforceGender:r}){let n=Dt({tournamentRecord:e,event:i}).appliedPolicies??{},a=t?.[Cr]??n?.[Cr]??Wv[Cr],s=(r??a?.participants?.enforceGender)!==!1;return{matchUpActionsPolicy:a,genderEnforced:s}}function f_e(t,e,i){return t&&(!Array.isArray(t)||!t.every(r=>ml({extension:r})))||e&&!ml({extension:e})?q({context:je({extension:e,extensions:t}),result:{error:re},info:"Invalid extension(s)",stack:i}):null}function Qo(t){let{suppressDuplicateEntries:e=!0,entryStatus:i=ua,autoEntryPositions:r=!0,enforceCategory:n=!1,enforceGender:a=!0,entryStageSequence:s,policyDefinitions:o,entryStage:l=Ae,tournamentRecord:u,ignoreStageSpace:c,drawDefinition:d,roundTarget:p,extensions:f,extension:m,drawId:h,event:g}=t,I="addEventEntries",v=d_e(t,I);if("error"in v)return v;let w="participantIds"in v?v.participantIds:[],y=f_e(f,m,I);if(y)return y;let{genderEnforced:b}=p_e({policyDefinitions:o,tournamentRecord:u,event:g,enforceGender:a}),S=[],U=[],T=!!u,P=[],D,E=s_e({tournamentRecord:u,participantIds:w,event:g,entryStatus:i,genderEnforced:b,mismatchedGender:P}),R=[];E=l_e({enforceCategory:n,event:g,tournamentRecord:u,typedParticipantIds:E,categoryRejections:R});let C=a_e({participantIds:w,typedParticipantIds:E,checkTypedParticipants:T});g.entries??=[];let M=new Set(g.entries.map(O=>O.participantId||O.participant?.participantId));if(u_e({validParticipantIds:C,existingIds:M,entryStatus:i,entryStage:l,extensions:f,extension:m,roundTarget:p,entryStageSequence:s,addedParticipantIdEntries:S,event:g}),h&&!dp(l)){let O=F2({participantIds:C,suppressDuplicateEntries:e,autoEntryPositions:r,entryStageSequence:s,ignoreStageSpace:c,drawDefinition:d,entryStatus:i,roundTarget:p,entryStage:l,extension:m,drawId:h,event:g});O.error&&(D=O.error)}if(c_e({event:g,tournamentRecord:u,removedEntries:U}),C.length!==w.length)return q({context:je({categoryRejections:R.length?R:void 0,mismatchedGender:P.length?P:void 0,gender:g.gender}),result:{error:Ia},stack:I});r&&(g.entries=wo({entries:g.entries||[]}));let N=S.length,A=U.length;return q({result:{...W,addedEntriesCount:N,removedEntriesCount:A,...R.length&&{context:je({categoryRejections:R})}},stack:I,info:D})}var Pae="ADMINISTRATION",m_e="CAPTAIN",h_e="COACH",Jr="COMPETITOR",g_e="DIRECTOR",I_e="HOSPITALITY",Eae="MEDIA",Rae="MEDICAL",L2="OFFICIAL",Cae="OTHER",Mae="SECURITY",v_e="STRINGER",y_e="SUPERVISOR",b_e="TRANSPORT",w_e="VOLUNTEER",_2={ADMINISTRATION:Pae,CAPTAIN:m_e,COACH:h_e,COMPETITOR:Jr,DIRECTOR:g_e,HOSPITALITY:I_e,MEDIA:Eae,MEDICAL:Rae,OFFICIAL:L2,OTHER:Cae,SECURITY:Mae,STRINGER:v_e,SUPERVISOR:y_e,TRANSPORT:b_e,VOLUNTEER:w_e};function $2({addIndividualParticipantsToEvents:t,individualParticipantIds:e,groupingParticipantId:i,tournamentRecord:r,suppressErrors:n}){let a="removeIndividualParticipantIds";if(!r)return q({result:{error:ve},stack:a});if(!i||!e)return q({result:{error:Je},stack:a});let s=(r.participants??[]).find(c=>c.participantId===i);if(!s)return q({result:{error:ji},stack:a});if(![_t,Ya].includes(s.participantType))return q({result:{participantType:s.participantType,error:Mo},stack:a});let o=Nae({individualParticipantIds:e,groupingParticipant:s,tournamentRecord:r,suppressErrors:n}),{removed:l,error:u}=o;if(u)return q({result:o,stack:a});if(t)for(let c of r.events??[]){let d=(c.entries??[]).map(({participantId:p})=>p).filter(Boolean);if(d.includes(i)){let p=l?.filter(f=>!d.includes(f));Qo({participantIds:p,entryStatus:Us,tournamentRecord:r,event:c})}}return l&&st({topic:rn,payload:{tournamentId:r.tournamentId,participants:[s]}}),{...W,...o}}function Nae({individualParticipantIds:t=[],groupingParticipant:e,tournamentRecord:i,suppressErrors:r,mappedMatchUps:n,participants:a}){let s=[];if(!e)return{removed:s};let o=[],l=[];a||({participants:a,mappedMatchUps:n}=Ri({withMatchUps:!0,tournamentRecord:i,withEvents:!0}));let u=a?.find(({participantId:p})=>p===e.participantId)?.events?.map(({eventId:p})=>p),c=(e.individualParticipantIds??[]).filter(p=>{let f=t?.includes(p),m=f&&a?.find(g=>g.participantId===p)?.matchUps.filter(({eventId:g})=>u.includes(g)).map(({matchUpId:g})=>n?.[g]).filter(({winningSide:g,score:I})=>g||fr({score:I})),h=f&&!m?.length;if(f&&!h&&l.push(p),h){s.push(p);for(let g of i.events??[])for(let I of g.drawDefinitions??[]){let{extension:v}=ht({element:I,name:Sc}),w=v?.value[e.participantId];v&&w&&(v.value[e.participantId]=w.filter(b=>b.participantId!==p),Ft({element:I,extension:v}),mU({drawDefinition:I}));let y=An({drawDefinition:I,inContext:!1}).matchUps??[];for(let b of y){let S=b.sides??[];for(let U of S){let T=U.lineUp??[];T.find(P=>P.participantId===p)&&(U.lineUp=T.filter(P=>P.participantId!==p),Ut({tournamentId:i?.tournamentId,drawDefinition:I,matchUp:b}))}}}}else o.push(p);return!h});e.individualParticipantIds=c;let d={groupingParticipantId:e.participantId,cannotRemove:l,notRemoved:o,removed:s};return l.length&&!r&&{...d,cannotRemove:l,error:uM}||d}function eN({participantRole:t=Jr,individualParticipantIds:e=[],groupingTypes:i=[$n,Ya],tournamentRecord:r}){if(!r)return{error:ve};let n=r.participants??[],{participants:a,mappedMatchUps:s}=Ri({withMatchUps:!0,tournamentRecord:r,withEvents:!0}),o=0;return n.filter(l=>(l.participantRole===t||!l.participantRole)&&l.participantType&&i.includes(l.participantType)).forEach(l=>{let{removed:u}=Nae({groupingParticipant:l,individualParticipantIds:e,tournamentRecord:r,mappedMatchUps:s,participants:a});u&&o++}),o?W:{error:Zte}}function qh(t){let e=He(t,[{[hr]:!0},{participantIds:!0,[qn]:sn,[js]:Wd}]);if(e.error)return e;let{addIndividualParticipantsToEvents:i,tournamentRecord:r,participantIds:n}=t,a=r.participants?.length||0;if(!a)return{...W};let s=(r.events||[])?.filter(({eventType:m})=>m===ar).map(m=>m?.drawDefinitions?.map(({drawId:h})=>h)).flat(1/0),o=Ri({participantFilters:{participantIds:n},tournamentRecord:r,withDraws:!0}).participants??[],l=m=>{let h=(Ur({matchUpFilters:{drawIds:m,matchUpTypes:[Bt]},tournamentRecord:r}).matchUps??[]).flatMap(({sides:g})=>g?.map(({participantId:I})=>I||[])).filter(Boolean);return Li(h,n)},u=s?.length?l(s):[],c=o.filter(m=>m.draws?.filter(h=>(!s?.length||!s?.includes(h.drawId))&&h.positionAssignments).length);if(u?.length||c.length)return{error:Nv};let d={},p={};for(let m of r.events||[]){let h=xU({participantIds:n,event:m});if(h.error)return h;d[m.eventId]=h.participantIdsRemoved}r.participants=(r.participants??[]).filter(m=>{let h=n.includes(m.participantId)||m.participantType===ft&&m.individualParticipantIds?.some(g=>n.includes(g));if(!h&&m.participantType===ar&&m.individualParticipantIds?.some(g=>n.includes(g))&&(m.individualParticipantIds=m.individualParticipantIds.filter(g=>!n.includes(g))),h&&i&&m.participantType&&[ft,_t].includes(m.participantType))for(let g of m.individualParticipantIds||[])n.includes(g)||(p[m.participantId]||(p[m.participantId]=[]),p[m.participantId].push(g));return!h});let f=a-r.participants.length;if(eN({individualParticipantIds:n,tournamentRecord:r}),i)for(let m of r.events||[]){let h=d[m.eventId].map(g=>p[g]||[]).flat();Qo({participantIds:h,entryStatus:Us,tournamentRecord:r,event:m})}return f&&st({payload:{participantIds:n,tournamentId:r.tournamentId},topic:t2}),f?{...W,participantsRemovedCount:f}:{error:uM}}function Aae({selected:t=!0,drawDefinition:e,entryStatuses:i,drawId:r,event:n,stage:a}){let s=n.entries??[];if(r){let{flightProfile:l}=Bi({event:n}),u=l?.flights?.find(c=>c.drawId===r);u?s=u.drawEntries:e.entries&&(s=e?.entries)}let o=s.filter(l=>(!i?.length||!l.entryStatus||i.includes(l.entryStatus))&&(!a||!l.entryStage||l.entryStage===a)&&(!t||l.entryStatus&&uo.includes(l.entryStatus)));return{entries:s,stageEntries:o}}function kae({removeGroupParticipant:t,tournamentRecord:e,drawDefinition:i,participantId:r,drawId:n,stage:a,event:s}){let o="destroyGroupEntry";if(!e)return{error:ve};if(!r)return q({result:{error:dr},stack:o});if(!s)return{error:ui};if(!s.eventType||![bc,Ua].includes(s.eventType))return q({result:{error:cu},stack:o});let l=e.participants??[],u=l.find(I=>I.participantId===r);if(!u)return q({result:{error:ji},stack:o});if(!u.participantType||![ft,$n].includes(u.participantType)||u.participantType===$n&&s.eventType!==Ua||u.participantType===ft&&s.eventType!==bc)return{error:Mo};let c=(s.entries??[]).find(I=>I.participantId===r);if(!c)return{error:rie};let{stageEntries:d}=Aae({selected:!1,drawDefinition:i,drawId:n,event:s,stage:a}),p=d.map(yt),f=l.filter(({participantId:I})=>p.includes(I)).map(({individualParticipantIds:I})=>I).flat().filter(Boolean),m=u.individualParticipantIds?.filter(I=>Xo(I,f).length===1),h=xU({participantIds:[r],event:s});if(h.error||m?.length&&(h=Qo({participantIds:m,entryStatus:Us,entryStage:c.entryStage,tournamentRecord:e,drawDefinition:i,drawId:n,event:s}),h.error))return h;let g;return t&&qh({participantIds:[r],tournamentRecord:e}).success&&(g=!0),{...W,participantRemoved:g}}function B2({removeGroupParticipant:t,tournamentRecord:e,drawDefinition:i,participantId:r,drawId:n,event:a}){return kae({removeGroupParticipant:t,tournamentRecord:e,drawDefinition:i,participantId:r,drawId:n,event:a})}function Oae(t){if(!t.tournamentRecord)return{error:ve};let{participantIds:e,...i}=t,r=0,n=[];for(let a of e){let s=kae({participantId:a,...i});s.success&&(r+=1),s.error&&n.push(s.error)}return r?{destroyedCount:r,...W}:{error:n}}function iw(t){let{tournamentRecord:e,replaceWithBye:i,drawDefinition:r,destroyPair:n,entryStatus:a,matchUpsMap:s,drawId:o}=t,l="removeDrawPositionAssignment",u=NU(t);if(u.error)return q({result:u,stack:l});let{participantId:c}=u,{drawPosition:d,event:p,structureId:f}=t,m=Dt({tournamentRecord:e,drawDefinition:r,event:p}).appliedPolicies??{};if([Gs,bu].includes(a)&&c){let{tournamentRecord:g}=t,{participant:I}=Xd({tournamentRecord:g,participantId:c}),{participantType:v,individualParticipantIds:w}=I??{};if(n&&v===ft){let y=B2({tournamentRecord:g,drawDefinition:r,participantId:c,event:p});if(y.error)return q({result:y,stack:l});w&&qP({participantIds:w,tournamentRecord:g,drawDefinition:r,entryStatus:a,drawId:o,event:p})}else qP({participantIds:[c],tournamentRecord:g,drawDefinition:r,entryStatus:a,drawId:o,event:p})}if(i){let g=Ja({tournamentRecord:e,drawDefinition:r,drawPosition:d,structureId:f,matchUpsMap:s,event:p});if(g.error)return q({result:g,stack:l})}let{structure:h}=tt({drawDefinition:r,structureId:f});return p2({structure:h,drawPositions:[d]}),hU({appliedPolicies:m,drawDefinition:r,positionAction:{name:"removeDrawPositionAssignment",replaceWithBye:i,drawPosition:d,entryStatus:a,structureId:f}}),u}function xae(t){return Object.assign(t,{entryStatus:bu}),iw(t)}var cd=({finishingPosition:t=Fh,hasExistingDrawDefinition:e,qualifyingRoundNumber:i,structureAbbreviation:r,seedAssignments:n=[],stageSequence:a=1,qualifyingOnly:s,structureOrder:o,seedingProfile:l,matchUpFormat:u,structureType:c,structureName:d,matchUps:p=[],matchUpType:f,structureId:m,roundOffset:h,roundLimit:g,stageOrder:I,structures:v,tieFormat:w,stage:y})=>{let b={structureId:m??Ct(),structureAbbreviation:r,finishingPosition:t,seedAssignments:n,matchUpFormat:u,stageSequence:a,structureName:d};(s||e&&w)&&(b.tieFormat=w),o&&(b.structureOrder=o),c&&(b.structureType=c),l&&(typeof l=="string"?b.seedingProfile=l:typeof l=="object"&&typeof l.positioning=="string"&&(b.seedingProfile=l.positioning)),f&&(b.matchUpType=f),h&&(b.roundOffset=h),I&&(b.stageOrder=I),g&&(b.roundLimit=g),y&&(b.stage=y),i&&(b.qualifyingRoundNumber=i);let S=p.flatMap(({drawPositions:U})=>U).filter(Boolean);return v?b.structures=v:(b.matchUps=p,b.positionAssignments=nt(S).sort((U,T)=>U-T).map(U=>({drawPosition:U}))),b},ss=cd;function Ex(t){return ni(t)?t.split(" ").map(e=>e.split("").map((i,r)=>r?i.toLowerCase():i.toUpperCase()).join("")).join(" "):t}function Qr(t){return ni(t)?Ex(t.replace(/_/g," ")):""}function V2({structureName:t=Qr(Rr),structureAbbreviation:e,drawDefinition:i,matchUpType:r,structureId:n}){if(!i)return{error:$e};let a=ss({stage:Rr,structureAbbreviation:e,structureName:t,matchUps:[],structureId:n,matchUpType:r});return i.structures||(i.structures=[]),i.structures.push(a),ii({drawDefinition:i,structureIds:[a.structureId]}),{...W}}function S_e({size:t}){let e=[t],i=t;for(;i/2===Math.floor(i/2);)i=i/2,e.push(i);return e.includes(1)||e.push(1),e.sort(nr),e.reverse(),e}function U_e({blockPattern:t,index:e}){let i=0;for(let r of t){if(i===e)return r;let n=0;for(;n<r.length;){if(i===e)return r;i+=1,n++}}}function T_e({positioning:t,size:e}){let i=S_e({size:e}),r=[],n=[],a=p=>p[0],s=p=>p[p.length-1],o=(p,f)=>(t&&[sU,UM,Bp].includes(t)&&f%2?s(p):a(p))||a(p),l=(p,f)=>{if(p.every(m=>!n.includes(m))){let m=o(p,f);return n.push(m),m}},u=p=>{let f=p.filter(m=>!n.includes(m));if(f.length)return n.push(...f),f},c=(p,f)=>{let m=o(p,f);if(!n.includes(m))return n.push(m),m},d=Ce(1,e+1);for(let p of i)if(p===1){let f=wr(d,2),m=f.map(l).filter(Boolean);m.length&&r.push(m);let h=f.flatMap(u).filter(Boolean);h.length&&r.push(h)}else{let f=wr(d,p).map(c).filter(Boolean);f.length&&r.push(f)}return{divisions:i,divisionGroupings:r}}function j2({drawPositions:t}){if(!t?.length)return{error:KS};let e=n=>t.filter(a=>a!==n).map(a=>[n,a]),i=[].concat(...(t??[]).map(e)),r=nt(i.map(tN)).map(n=>n.split("|").map(a=>+a));return{groupMatchUps:i,uniqueMatchUpGroupings:r}}function tN(t=[]){return!Array.isArray(t)||!t.length?"":[...t].sort(nr).join("|")}function Fae({groupSize:t,drawPositionOffset:e}){if(!t)return[];let i=d=>[...Array(d)].map((p,f)=>f),r=i(2*Math.round(t/2)+1).slice(1),n=i(r.length-1).map(()=>[]),a=r.slice(0,r.length/2),s=r.slice(r.length/2);r.slice(1).forEach((d,p)=>{a.forEach((g,I)=>{n[p].push([a[I],s[I]])});let f=a.shift(),m=a.pop(),h=s.shift();a=[f,h,...a].filter(Boolean),s=[...s,m].filter(Boolean)});let o=a.shift(),l=a.pop(),u=s.shift();a=[o,u,...a].filter(Boolean),s=[...s,l].filter(Boolean);let c=d=>d[0].reduce((p,f)=>p+f);return[...n].reverse().sort((d,p)=>c(d)-c(p)).map(d=>d.filter(p=>p.every(f=>f<=t)).map(p=>{let f=p.map(m=>m+e);return tN(f)}))}function D_e({rounds:t,hash:e}){return t?.length?t?.reduce((i,r,n)=>r.includes(e)?n+1:i,void 0):{error:Je}}var P_e={getRoundRobinGroupMatchUps:j2,determineRoundNumber:D_e,drawPositionsHash:tN,groupRounds:Fae};function FU(t){let{hasExistingDrawDefinition:e,groupNameBase:i="Group",playoffAttributes:r,stageSequence:n=1,structureOptions:a,appliedPolicies:s,qualifyingOnly:o,seedingProfile:l,stage:u=Ae,matchUpType:c,roundTarget:d,structureId:p,groupNames:f,tieFormat:m,drawSize:h,idPrefix:g,isMock:I,uuids:v}=t,w=t.structureName??r?.["0"]?.name??Qr(Ae),{groupCount:y,groupSize:b}=E_e({structureOptions:a,appliedPolicies:s,drawSize:h}),S=jp,U,T=Ce(1,y+1).map(D=>{let E=R_e({groupSize:b,structureOrder:D,matchUpType:c,drawSize:h,idPrefix:g,isMock:I});U=Array.isArray(E)?Math.max(...E.map(({roundNumber:C})=>C??0)):0;let R=f?.[D-1]??`${i} ${D}`;return cd({structureId:v?.pop(),hasExistingDrawDefinition:e,structureType:TM,finishingPosition:S,qualifyingOnly:o,structureOrder:D,structureName:R,tieFormat:m,matchUps:E})}),P=cd({structureId:p??v?.pop(),hasExistingDrawDefinition:e,structureType:gn,finishingPosition:S,seedingProfile:l,structureName:w,stageSequence:n,structures:T,tieFormat:m,stage:u});return d&&Ft({extension:{name:El,value:d},element:P}),{structures:[P],maxRoundNumber:U,groupCount:y,links:[],groupSize:b,...W}}function E_e({appliedPolicies:t,structureOptions:e,drawSize:i}){let r=e?.groupSize,n=e?.groupSizeLimit||8,{validGroupSizes:a}=LU({groupSizeLimit:n,drawSize:i}),s=a&&Math.max(...a);r&&a?.includes(r)||(r&&r>4||!a?.includes(4)?r=s:r=4);let o=Math.ceil(i/r);return{groupSize:r,groupCount:o}}function LU(t){let{groupSizeLimit:e=10,drawSize:i=0}=t??{},r=Ce(3,e+1).filter(n=>{let a=Math.ceil(i/n),s=a*n-i,o=Math.ceil(i/a),l=Math.ceil(s/a);return(!s||s<n)&&o===n&&o>=3&&l<2});return{...W,validGroupSizes:r}}function R_e({structureOrder:t,matchUpType:e,groupSize:i,drawSize:r,idPrefix:n,isMock:a,uuids:s}){let o=(t-1)*i,l=Ce(1+o,i+1+o),u=j2({drawPositions:l}).uniqueMatchUpGroupings??[],c=Fae({groupSize:i,drawPositionOffset:o});return u.map(p).sort((f,m)=>(f.roundNumber??1/0)-(m.roundNumber??1/0));function d(f){return c.reduce((m,h,g)=>h.includes(f)?g+1:m,void 0)}function p(f){let m=tN(f),h=d(m),g=[1,r],I=C_e({structureOrder:t,drawPositions:f,roundNumber:h,idPrefix:n,uuids:s}),v={matchUpStatus:h?_i:"BYE",matchUpType:e,finishingPositionRange:{winner:g,loser:g},drawPositions:f,roundNumber:h,matchUpId:I};return a&&(v.isMock=!0),v}}function C_e({structureOrder:t,drawPositions:e,roundNumber:i,idPrefix:r,uuids:n}){return r?`${r}-${t}-${i}-DP-${e.join("-")}`:n?.pop()||Ct()}function G2(t){let{roundRobinGroupsCount:e,participantsCount:i,cluster:r}=t;if(!lt(i))return{seedBlocks:void 0,...q({result:{error:re},context:{participantsCount:i},stack:"getSeedBlocks"})};let n=Ev(i);if(e){let f=Math.min(e,n),m=[],h=1;for(Ce(0,f).forEach(()=>{m.push([h]),h++});h<n;){let g=Ce(h,h+f);h+=f,m.push(g)}return{...W,seedBlocks:m}}let a=Ce(1,n+1),s=[],o=n/2;for(;o>1;){let f=wr(a,o),m=f.length;f.forEach((h,g)=>{let I,v=g<m/2,w=g%2===0,y=h[0],b=h[h.length-1];r&&m>4?m===8?I=v?b:y:I=w?y:b:I=v?y:b,xn(h,s)||s.push(I)}),o=o/2}let l=a.filter(f=>!s.includes(f));for(;l.length;)l.length%2===0?s.push(l.pop()):s.push(l.shift());let u=Ce(0,20).map(f=>Math.pow(2,f));u.unshift(1);let c=u.indexOf(n),d=0,p=[];return Ce(0,c).forEach(f=>{p.push(s.slice(d,d+u[f])),d+=u[f]}),{...W,seedBlocks:p}}function H2({roundRobinGroupsCount:t,drawSize:e}){let i="getSeedGroups";if(!lt(e))return{seedGroups:void 0,...q({result:{error:re},context:{drawSize:e},stack:i})};if(t){if(!lt(t))return{seedGroups:void 0,...q({context:{roundRobinGroupsCount:t},result:{error:re},stack:i})};let r=1,n=Math.floor(e/t);return{seedGroups:Ce(0,n).map(()=>{let a=Ce(r,r+t);return r+=t,a})}}else{let{seedBlocks:r}=G2({participantsCount:e,roundRobinGroupsCount:t}),n=0;return{seedGroups:(r||[]).map(a=>(a||[]).map(()=>(n+=1,n)))}}}function W2({roundRobinGroupsCount:t,participantsCount:e}){if(t){let{validGroupSizes:n}=LU({drawSize:e});if(!n?.map(a=>Math.ceil(e/a))?.includes(t))return q({context:{roundRobinGroupsCount:t},result:{error:re}})}let{seedGroups:i}=H2({drawSize:e,roundRobinGroupsCount:t}),r=i?.map(n=>Math.min(...n))||[];return{...W,seedingThresholds:r}}function NI(t){if(!t)return 1/0;if(lt(t))return Ke(t);let e=t.split("-")[0];return lt(e)?Ke(e):1/0}function Yh({provisionalPositioning:t,returnAllProxies:e,appliedPolicies:i,seedingProfile:r,drawDefinition:n,allPositions:a,structure:s}){let o=[];if(!s)return{error:mf};let{matchUps:l,roundMatchUps:u}=At({matchUpFilters:{roundNumbers:[1]},provisionalPositioning:t,structure:s}),{seedAssignments:c}=hs({provisionalPositioning:t,returnAllProxies:e,drawDefinition:n,structure:s}),{positionAssignments:d}=pr({structure:s}),p=d?.length,f=c?.length??0,m=[],h=Object.keys(u).map(A=>Number.parseInt(A)).sort((A,O)=>A-O).map(A=>{let O=u[A].map(F=>F.drawPositions).flat(1/0).filter(Boolean),k=O.filter(F=>!m.includes(F));return m=m.concat(...O),k}).filter(A=>A.length).reverse(),g=h.pop()??[],I=g&&Math.min(...g)-1||0;r=r??i?.seeding?.seedingProfile;let v=g?.length||0,w=h.filter(A=>A.filter(O=>O<=f).length),{stage:y,structureType:b,roundLimit:S}=s,U=b===gn,T=!U&&h?.length,P=!U&&y===ze&&S,D=w.flat(1/0),E=T?D?.length:0,R=a?p:f,C=y2({drawDefinition:n,structure:s,matchUps:l}),M=C?0:!T&&R||R&&D.length<R&&R-D.length||0;if(P){let A=s?.matchUps?s.matchUps.filter(({roundNumber:k})=>k===s.roundLimit).length:0,O=g.length/A;if(!T){let k=_U(r),F=wr(g,O),x=1,L=Ce(0,F[0].length).map(()=>{let $=Ce(x,x+F.length);return x+=F.length,$});({validSeedBlocks:o}=Lae({drawPositionBlocks:F,nonRandom:r?.nonRandom,positioning:k,seedGroups:L}))}}else U?{validSeedBlocks:o}=M_e({nonRandom:r?.nonRandom,seedingProfile:r,structure:s}):T?o=w.map(A=>({seedNumbers:A,drawPositions:A})):C&&wr(g,2).map((A,O)=>({drawPositions:[A[0]],seedNumbers:[O+1]})).forEach(A=>o.push(A));if(!U&&!C&&!P){let{blocks:A}=N_e({drawPositionOffset:I,seedNumberOffset:E,seedCountGoal:M,seedingProfile:r,baseDrawSize:v});A.forEach(O=>o.push(O))}let N=o.flatMap(A=>A.drawPositions).reduce((A,O)=>g?.includes(O)&&A,!0);return!C&&!T&&!U&&!N?{error:Dte,validSeedBlocks:[],isContainer:U,isFeedIn:T}:{isLuckyStructure:C,validSeedBlocks:o,isContainer:U,isFeedIn:T}}function M_e({seedingProfile:t,structure:e,nonRandom:i}){let r=e.structures||[],n=r.length,a=Kt({structure:e})?.positionAssignments,s=_U(t),o=a?.length??0,{seedGroups:l}=H2({roundRobinGroupsCount:n,drawSize:o}),u=r.map(c=>Kt({structure:c}).positionAssignments?.map(d=>d.drawPosition));return Lae({drawPositionBlocks:u,positioning:s,seedGroups:l,nonRandom:i})}function Lae({drawPositionBlocks:t,positioning:e,seedGroups:i,nonRandom:r}){let n=[],{divisionGroupings:a}=T_e({size:i.length,positioning:e}),s=[];return i.forEach((o,l)=>{let u=U_e({blockPattern:a,index:l});o.forEach((c,d)=>{let p=l%2?t.length-d-1:d,f=t[p].slice().filter((h,g)=>u.includes(g+1)&&h);e!==Bp?f=r?f:Cn(f):l%2&&f.reverse();let m=f.find(h=>!s.includes(h));m&&(s.push(m),n.push({drawPositions:[m],seedNumbers:[c]}))})}),{validSeedBlocks:n}}function N_e(t){let{drawPositionOffset:e=0,roundRobinGroupsCount:i,seedNumberOffset:r=0,seedingProfile:n,seedCountGoal:a,baseDrawSize:s}=t,o,l=[],{seedBlocks:u}=G2({cluster:[sU,UM].includes(_U(n)),participantsCount:s,roundRobinGroupsCount:i});o=0;for(let c of u){if(o+1>a)break;let d=c.map(f=>f+e),p=A_e(o+1,c.length).map(f=>+f+r);o+=c.length,l.push({drawPositions:d,seedNumbers:p})}return{blocks:l}}function A_e(t,e){return Array.from(new Array(e),(i,r)=>r+t)}function KP({appliedPolicies:t,drawDefinition:e,seedBlockInfo:i,drawPosition:r,structureId:n,seedNumber:a}){let{structure:s}=tt({drawDefinition:e,structureId:n});t??=Dt({drawDefinition:e}).appliedPolicies;let o=i?.validSeedBlocks;return!o&&s&&(o=Yh({appliedPolicies:t,drawDefinition:e,structure:s})?.validSeedBlocks),t?.seeding?.validSeedPositions?.ignore?!0:t?.seeding?.validSeedPositions?.strict?(o.find(l=>l.seedNumbers.includes(a))?.drawPositions||[]).includes(r):o.flatMap(l=>l.drawPositions).includes(r)}function _ae(t){let{provisionalPositioning:e,drawDefinition:i,seedingProfile:r,seedBlockInfo:n,structureId:a,randomize:s}=t,{structure:o}=tt({drawDefinition:i,structureId:a}),{seedAssignments:l}=hs({returnAllProxies:t.returnAllProxies,provisionalPositioning:e,drawDefinition:i,structure:o}),{positionAssignments:u}=pr({structure:o}),c=u?.filter(R=>R.participantId??R.bye??R.qualifier)?.map(R=>R.drawPosition).filter(Boolean),{appliedPolicies:d}=Dt({drawDefinition:i}),p=(n?.validSeedBlocks||o&&Yh({returnAllProxies:t.returnAllProxies,provisionalPositioning:e,appliedPolicies:d,drawDefinition:i,seedingProfile:r,structure:o})?.validSeedBlocks||[]).find(R=>R.drawPositions.filter(C=>!c?.includes(C)).length),f=l?.map(R=>R.participantId).filter(Boolean),m=u?.map(R=>R.participantId).filter(Boolean),h=f?.filter(R=>m?.includes(R)),g=f?.filter(R=>!m?.includes(R)),I=l?.filter(R=>g?.includes(R.participantId)),v=l?.filter(R=>!R.participantId),w=(I?.length&&I.length>0?I.length:v?.length??0)&&p?.drawPositions.filter(R=>!c?.includes(R))||[],y=s?Cn(w):w,b=[],S=y.map(()=>{let R=E(I,b)?.participantId;return R&&b.push(R),R}).filter(Boolean),U=l?.filter(R=>h?.includes(R.participantId)).map(R=>R.seedNumber),T=(p?.seedNumbers||[]).filter(R=>!U?.includes(R)),P=l?.filter(R=>T.includes(R.seedNumber)).map(R=>R.participantId),D=d?.seeding?.duplicateSeedNumbers;return{nextSeedBlock:p,unplacedSeedParticipantIds:typeof D!="boolean"||D?S:P,unplacedSeedNumbers:T,unfilledPositions:y,unplacedSeedAssignments:I};function E(R,C){let M=R.filter(O=>!C.includes(O.participantId)),N=Math.min(...M.map(O=>NI(O.seedValue))),A=M.filter(O=>NI(O.seedValue)===N);return Cn(A).pop()}}function _U(t){if(typeof t=="string")return t;if(typeof t=="object")return t.positioning}function zv({provisionalPositioning:t,tournamentRecord:e,drawDefinition:i,seedingProfile:r,participantId:n,seedBlockInfo:a,structureId:s,seedNumber:o,seedValue:l,eventId:u,event:c}){let d="assignSeed",{structure:p}=tt({drawDefinition:i,structureId:s}),{positionAssignments:f}=pr({structure:p}),m=hs({provisionalPositioning:t,drawDefinition:i,structure:p}).seedAssignments,h=m.map(b=>b.seedNumber),g=mm({drawDefinition:i,participantId:n});if(n&&!g)return q({result:{error:Co},context:{participantId:n},stack:d});let I=c?Bi({event:c}).flightProfile?.flights?.length:0,v=I&&I>1,w=f?.find(b=>b.participantId===n)?.drawPosition;if(w&&!KP({drawPosition:w,drawDefinition:i,seedBlockInfo:a,structureId:s,seedNumber:o}))return q({result:{error:Y$},context:{assignedDrawPosition:w},info:"invalid seed position",stack:d});h.includes(o)||m.push({seedNumber:o,seedValue:l});let y;return m.forEach(b=>{b.participantId===n&&b.seedNumber!==o&&(b.participantId=void 0),b.seedNumber===o&&(b.participantId=n,!r?.groupSeedingThreshold&&!v&&(b.seedValue=l??o),y=!0)}),y?(wne({tournamentId:e?.tournamentId,drawDefinition:i,structure:p,eventId:u}),{...W}):q({result:{error:Tte},stack:d})}function z2({inContextTargetMatchUp:t,drawPositionSideIndex:e,teamParticipantId:i,tournamentRecord:r,drawDefinition:n,matchUp:a,event:s}){let o=t?.sides?.[e]?.sideNumber,l=o&&a.sides?.find(p=>p.sideNumber===o),{extension:u}=ht({element:n,name:Sc}),c=u?.value||{},d=Oe(c[i],!1,!0);if(l)a?.sides?.forEach(p=>{p.sideNumber===o&&(p.lineUp=d)});else{a.sides=[1,2].map(f=>({...a.sides?.find(m=>m.sideNumber===f)??{},sideNumber:f}));let p=a.sides.find(f=>f.sideNumber===o);p&&(p.lineUp=d)}Ut({tournamentId:r?.tournamentId,context:"updateSidLineUp",eventId:s?.eventId,drawDefinition:n,matchUp:a})}function $ae(t){let{sourceMatchUp:e}=t,{targetMatchUp:i,structure:r,matchUpsMap:n,drawPosition:a}=t,s=i.roundNumber>1&&i.roundNumber-1,o=Pd({structureId:r.structureId,matchUpsMap:n});Ht({method:"getPairedPreviousMatchUpIsDoubleExit",color:"brightcyan",keyColors:{structureId:"brightyellow",sourceMatchUpId:"brightmagenta"},structureId:r.structureId?.slice(0,8),targetMatchUpId:i.matchUpId,targetRound:[i.roundNumber,i.roundPosition],previousRoundNumber:s,sourceMatchUpId:e?.matchUpId,sourceStructureId:e?.structureId?.slice(0,8),sourceRound:e?[e.roundNumber,e.roundPosition]:void 0,drawPosition:a,structureMatchUpCount:o?.length}),e&&e.structureId!==r.structureId&&a?(Ht({method:"getPairedPreviousMatchUpIsDoubleExit",color:"cyan",info:"cross_structure_sourceMatchUp_resolving_in_target",originalSourceId:e?.matchUpId,originalSourceStructure:e?.structureId?.slice(0,8),targetStructure:r.structureId?.slice(0,8)}),e=o.find(({drawPositions:m,roundNumber:h})=>h===s&&m?.includes(a)),Ht({method:"getPairedPreviousMatchUpIsDoubleExit",color:"cyan",info:"resolved_cross_structure_sourceMatchUp",resolvedMatchUpId:e?.matchUpId,resolvedRound:e?[e.roundNumber,e.roundPosition]:void 0,resolvedStatus:e?.matchUpStatus})):!e&&a&&(e=o.find(({drawPositions:m,roundNumber:h})=>h===s&&m?.includes(a)),Ht({method:"getPairedPreviousMatchUpIsDoubleExit",color:"cyan",info:"resolved_sourceMatchUp_from_drawPosition",resolvedMatchUpId:e?.matchUpId,resolvedRound:e?[e.roundNumber,e.roundPosition]:void 0,resolvedStatus:e?.matchUpStatus}));let l=e?.roundPosition,u=l%2?1:-1,c=l+u,d=s&&o.find(({roundNumber:m,roundPosition:h})=>m===s&&h===c),p=d?.matchUpStatus,f=[Si,Wi].includes(p);return Ht({method:"getPairedPreviousMatchUpIsDoubleExit",color:f?"brightred":"brightgreen",keyColors:{pairedMatchUpId:"brightcyan",isDoubleExit:f?"brightred":"brightgreen"},sourceRoundPosition:l,offset:u,pairedRoundPosition:c,pairedMatchUpId:d?.matchUpId,pairedRound:d?[d.roundNumber,d.roundPosition]:void 0,pairedStatus:p,isDoubleExit:f}),{pairedPreviousMatchUp:d,pairedPreviousMatchUpIsDoubleExit:f}}function k_e({drawPosition:t,drawPositions:e}){let i=!1,r=!!e?.includes(t);return{updatedDrawPositions:r?e||[]:[...e,void 0,void 0].slice(0,2).map(n=>!n&&!r?(r=!0,i=!0,t):n).sort(nr).filter(Boolean),positionAdded:i,positionAssigned:r}}function Bae({structureId:t,matchUpsMap:e,matchUp:i}){let r=i?.roundPosition,n=r%2?1:-1,a=r+n;return{pairedPreviousMatchUp:Pd({matchUpsMap:e,structureId:t}).find(({roundNumber:s,roundPosition:o})=>s===i?.roundNumber&&o===a)}}function Vae({inContextDrawMatchUps:t,sourceMatchUpStatus:e,sourceMatchUpId:i,matchUpsMap:r,matchUp:n}){let a=t.find(o=>o.matchUpId===i),{pairedPreviousMatchUp:s}=Bae({structureId:a?.structureId,matchUp:a,matchUpsMap:r});if(a&&s){let o=s?.matchUpId,l=t.find(c=>c.matchUpId===o),u=a?.structureId===l?.structureId?a?.roundPosition<l?.roundPosition&&1||2:a.structureId===l?.structureId&&2||1;n.matchUpStatusCodes=(n.matchUpStatusCodes??[]).map(c=>{let d=ni(c)||!isNaN(c)?{code:c}:c;return d.sideNumber===u?{...d,previousMatchUpStatus:e}:d})}}function hD({inContextDrawMatchUps:t,drawPosition:e,matchUpId:i}){let r=t.filter(({winnerMatchUpId:n,loserMatchUpId:a})=>a===i||n===i).sort((n,a)=>n.roundPosition-a.roundPosition);return t.find(n=>n.matchUpId===i).feedRound?1:r.reduce((n,a,s)=>a.drawPositions?.includes(e)?s+1:n,void 0)}function hm({inContextDrawMatchUps:t,sourceMatchUpStatus:e,tournamentRecord:i,sourceMatchUpId:r,drawDefinition:n,matchUpStatus:a,drawPosition:s,matchUpsMap:o,matchUpId:l,event:u}){let c="assignMatchUpDrawPosition";o||(o=kr({drawDefinition:n})),t||(t=Zi({inContext:!0,drawDefinition:n,matchUpsMap:o}).matchUps??[]);let d=t.find(C=>C.matchUpId===l),p=d?.structureId,f=n?.structures?.find(C=>C.structureId===p);if(!f)return{error:vi};let m=o?.drawMatchUps?.find(C=>C.matchUpId===l),h=m?.drawPositions??[],{positionAdded:g,positionAssigned:I,updatedDrawPositions:v}=k_e({drawPositions:h,drawPosition:s}),{positionAssignments:w}=Kt({drawDefinition:n,structure:f}),y=w?.filter(C=>v.includes(C.drawPosition))?.find(({bye:C})=>C),b=m?.matchUpStatus&&Lr(m.matchUpStatus)&&v.filter(Boolean).length<2;a=y&&"BYE"||a||b&&m.matchUpStatus||m?.matchUpStatus&&[Si,Wi].includes(m.matchUpStatus)&&m.matchUpStatus||_i;let S=!!(Lr(m?.matchUpStatus)&&m?.winningSide);if(m&&g){t=Zi({inContext:!0,drawDefinition:n,matchUpsMap:o}).matchUps??[];let C=b&&hD({inContextDrawMatchUps:t,drawPosition:s,matchUpId:l})||S&&m.winningSide||void 0;m?.matchUpStatusCodes&&Vae({inContextDrawMatchUps:t,sourceMatchUpStatus:e,sourceMatchUpId:r,matchUpsMap:o,matchUp:m}),Object.assign(m,{drawPositions:v,winningSide:C,matchUpStatus:S?m?.matchUpStatus:a}),Ut({tournamentId:i?.tournamentId,eventId:d?.eventId,context:c,drawDefinition:n,matchUp:m})}let U=Fn({inContextDrawMatchUps:t,inContextMatchUp:d,drawDefinition:n,matchUpId:l}),{targetMatchUps:{winnerMatchUp:T,loserMatchUp:P,loserTargetDrawPosition:D},targetLinks:{loserTargetLink:E}}=U,R=Pd({structureId:f.structureId,matchUpsMap:o});if(I&&y){if(T)if(["BYE",Si,Wi].includes(a)){let C=hm({matchUpId:T.matchUpId,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:n,drawPosition:s,matchUpsMap:o});if(C.error)return C}else{let{structureId:C}=T;C!==f.structureId&&console.log("winnerMatchUp in different structure... participant is in different targetDrawPosition")}}else if(I&&S){if(T){let C=hm({matchUpId:T.matchUpId,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:n,drawPosition:s,matchUpsMap:o});if(C.error)return C}}else if(T&&d&&!d.feedRound){let{pairedPreviousMatchUpIsDoubleExit:C}=$ae({targetMatchUp:m,drawPosition:s,matchUpsMap:o,structure:f});if(C){let M=hm({matchUpId:T.matchUpId,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:n,drawPosition:s,matchUpsMap:o});if(M.error)return M}}if(m?.matchUpType===ei){let C=t?.find(({matchUpId:A})=>A===m.matchUpId),M=(C?.sides??[]).reduce((A,O,k)=>O.drawPosition===s?k:A,void 0),N=w?.find(A=>A.drawPosition===s)?.participantId;N&&M!==void 0&&z2({inContextTargetMatchUp:C,drawPositionSideIndex:M,teamParticipantId:N,tournamentRecord:i,drawDefinition:n,matchUp:m})}if(E?.linkCondition===fl&&v.filter(Boolean).length===2&&!y&&R.filter(({drawPositions:C,roundNumber:M})=>M===1&&xn(C,v)).every(({matchUpStatus:C})=>[Oi,Sr].includes(C))&&P){let{structureId:C}=P,M=Ja({drawPosition:D,tournamentRecord:i,drawDefinition:n,structureId:C,matchUpsMap:o,event:u});if(M.error)return M}return I?{...W}:q({result:{error:vI},context:{drawPosition:s},stack:c})}function jae({inContextDrawMatchUps:t,drawDefinition:e,assignments:i,matchUpsMap:r,structure:n}){let a=Bv({drawDefinition:e})?.containedStructures?.[n.structureId]?.map(({structureId:c})=>c)||[];a.push(n?.structureId);let s=i?.map(({drawPosition:c})=>c)||[],o=t?.filter(c=>a.includes(c.structureId)&&Li(c.drawPositions??[],s).length)??[],l=o.map(({matchUpId:c})=>c),u=r?.drawMatchUps?.filter(c=>l.includes(c.matchUpId))??[];return{drawPositions:s,matchUps:u,targetMatchUps:o}}function q2({lineUp:t}){if(!Array.isArray(t))return;let e={};return nt(t.flatMap(({collectionAssignments:i})=>i?.map(({collectionId:r,collectionPosition:n})=>[r,n].join("|"))).filter(Boolean)).forEach(i=>{let[r,n]=i.split("|"),a=parseInt(n),{assignedParticipantIds:s}=zP({collectionPosition:a,collectionId:r,lineUp:t});s.forEach(o=>{e[o]||(e[o]=[]),e[o].push({collectionId:r,collectionPosition:a})})}),Object.keys(e).map(i=>({participantId:i,collectionAssignments:e[i]}))}function zp(t){return`${t} must be an array`}function iN({lineUp:t,tieFormat:e}){let i=[];if(!Array.isArray(t))return i.push(zp("lineUp")),{valid:!1,errors:i,error:re};let r=t.every(a=>{if(typeof a!="object")return i.push("lineUp entries must be objects"),!1;let{participantId:s,collectionAssignments:o}=a;return s?typeof s!="string"?(i.push("participantIds must be strings"),!1):Array.isArray(o)?o.every(l=>{if(typeof l!="object")return i.push("collectionAssignments must be objects"),!1;let{collectionPosition:u}=l;return typeof u!="number"?(i.push("collectionPosition must be a number"),!1):!0}):(i.push(zp("collectionAssignments")),!1):(i.push("Missing participantId"),!1)}),n=nt(t.map(yt)).length===t.length;return n||i.push("Duplicated participantId(s)"),{valid:r&&n,errors:i,error:i.length?re:void 0}}function Kh({drawDefinition:t,participantId:e,tieFormat:i,lineUp:r}){if(typeof t!="object")return{error:$e};if(typeof e!="string")return{error:dr};let n=iN({lineUp:r,tieFormat:i});if(!n.valid)return n;let{extension:a}=ht({element:t,name:Sc}),s=a?.value||{};return s[e]=q2({lineUp:r}),Ft({element:t,extension:{name:Sc,value:s}}),mU({drawDefinition:t}),{...W}}function Y2({inContextDrawMatchUps:t,inheritance:e=!0,tournamentRecord:i,drawDefinition:r,matchUpsMap:n,assignments:a,structure:s,event:o}){if(!r)return{error:$e};let{drawPositions:l,matchUps:u,targetMatchUps:c}=jae({inContextDrawMatchUps:t,matchUpsMap:n,assignments:a,structure:s});for(let d of c)d.matchUpType===La&&(d.sides??[]).forEach((p,f)=>{if(p?.drawPosition&&l?.includes(p.drawPosition)){let m=u.find(({matchUpId:h})=>h===d.matchUpId);if(m?.sides?.[f]){if(delete m.sides[f].lineUp,e===!1){let h=d.tieFormat,g=p.participantId;h&&g&&Kh({drawDefinition:r,participantId:g,lineUp:[],tieFormat:h})}Ut({tournamentId:i?.tournamentId,context:"resetLineUps",eventId:o?.eventId,drawDefinition:r,matchUp:m})}}});return{...W}}function hl({provisionalPositioning:t,inContextDrawMatchUps:e,isQualifierPosition:i,sourceMatchUpStatus:r,tournamentRecord:n,drawDefinition:a,seedingProfile:s,participantId:o,seedBlockInfo:l,drawPosition:u,matchUpsMap:c,structureId:d,event:p}){let f="assignDrawPosition";if(!o&&!i)return q({result:{error:dr},stack:f});c=c??kr({drawDefinition:a}),e||({matchUps:e}=Zi({inContext:!0,drawDefinition:a,matchUpsMap:c}));let m=tt({drawDefinition:a,structureId:d});if(m.error)return q({result:m,stack:f});let{structure:h}=m;if(!h)return{error:vi};if(Hn({structure:h}))return q({result:{error:sa},stack:f});let{seedAssignments:g}=hs({provisionalPositioning:t,drawDefinition:a,structure:h}),I=g?.find(P=>P.participantId===o)?.seedNumber,{appliedPolicies:v}=Dt({tournamentRecord:n,drawDefinition:a,structure:h,event:p});if(I&&!KP({seedNumber:I,appliedPolicies:v,drawDefinition:a,seedBlockInfo:l,drawPosition:u,structureId:d}))return q({result:{error:Y$},context:{drawPosition:u},stack:f});let w=pr({structure:h}).positionAssignments||[],y=w?.find(P=>P.drawPosition===u);if(!y)return q({result:{error:Rh},context:{drawPosition:u},stack:f});if(w?.map(yt).includes(o))return q({result:{error:Nv},context:{drawPosition:u},stack:f});let{containsParticipant:b,containsBye:S}=C2(y);if(S){let P=NU({inContextDrawMatchUps:e,tournamentRecord:n,drawDefinition:a,drawPosition:u,structureId:d,matchUpsMap:c,event:p});if(P.error)return q({result:P,stack:f})}if(b&&y.participantId!==o){let{activeDrawPositions:P}=Gv({drawDefinition:a,structureId:d});if(P.includes(u))return q({result:{error:XS},stack:f});Y2({assignments:[y],inContextDrawMatchUps:e,tournamentRecord:n,drawDefinition:a,matchUpsMap:c,structure:h})}if(y.participantId=o,i&&(y.qualifier=!0),h.stage===Ae&&(!h.stageSequence||h.stageSequence>1)||h.stage&&[tn,Ti].includes(h.stage)){let P=h.stage===ze?ze:Ae,D=(a.structures?.find(E=>E?.stage===P&&E?.stageSequence===1)?.seedAssignments??[]).find(E=>E.participantId===o);if(D?.participantId){let{participantId:E,seedNumber:R,seedValue:C}=D;zv({eventId:p?.eventId,provisionalPositioning:t,tournamentRecord:n,drawDefinition:a,seedingProfile:s,participantId:E,seedNumber:R,seedValue:C,structureId:d,event:p})}}if(h.structureType===gn){nae({positionAssignments:w,tournamentRecord:n,drawDefinition:a,matchUpsMap:c,structure:h});let{drawPositions:P,matchUps:D,targetMatchUps:E}=jae({assignments:[y],inContextDrawMatchUps:e,drawDefinition:a,matchUpsMap:c,structure:h});if(P&&D?.length===1&&D[0].matchUpType===ei){let R=(E?.[0].sides??[]).reduce((C,M,N)=>P?.includes(M.drawPosition)?N:C,void 0);z2({inContextTargetMatchUp:E[0],teamParticipantId:o,matchUp:D[0],drawPositionSideIndex:R,tournamentRecord:n,drawDefinition:a})}}else O_e({provisionalPositioning:t,inContextDrawMatchUps:e,sourceMatchUpStatus:r,tournamentRecord:n,drawDefinition:a,drawPosition:u,matchUpsMap:c,structure:h,event:p});let U=a.entries?.find(P=>P.participantId===o),T=p?.entries?.find(P=>P.participantId===o);return!U&&T&&x2({entryStatus:T.entryStatus,entryStage:h.stage,ignoreStageSpace:!0,drawDefinition:a,participantId:o,event:p}),Dc({tournamentId:n?.tournamentId,drawDefinition:a,structure:h,event:p}),{positionAssignments:w,...W}}function O_e({provisionalPositioning:t,inContextDrawMatchUps:e,sourceMatchUpStatus:i,tournamentRecord:r,drawDefinition:n,drawPosition:a,matchUpsMap:s,structure:o,event:l}){let u={isCollectionMatchUp:!1},{matchUps:c}=At({provisionalPositioning:t,matchUpFilters:u,drawDefinition:n,matchUpsMap:s,structure:o,event:l}),{roundMatchUps:d}=Sn({matchUps:c}),{initialRoundNumber:p}=Hm({drawPosition:a,matchUps:c}),f=p&&d?.[p].find(m=>m.drawPositions?.includes(a));if(f){let m=hm({matchUpId:f.matchUpId,inContextDrawMatchUps:e,sourceMatchUpStatus:i,tournamentRecord:r,drawDefinition:n,drawPosition:a,matchUpsMap:s});if(m.error)return q({stack:"assignDrawPositionToMatchUps",context:{drawPosition:a},result:m})}return{...W}}function K2(t){let{participantIdAttributeName:e="participantId",isQualifierPosition:i,positionActionName:r,tournamentRecord:n,drawDefinition:a,participantId:s,drawPosition:o,structureId:l,event:u}=t,c="positionParticipantAction";if(!a)return{error:$e};let d=Dt({tournamentRecord:n,drawDefinition:a,event:u}).appliedPolicies??{},{inContextDrawMatchUps:p,matchUpsMap:f}=t;f||(f=kr({drawDefinition:a}),Object.assign(t,{matchUpsMap:f})),p||({matchUps:p}=Zi({inContext:!0,drawDefinition:a,matchUpsMap:f}),Object.assign(t,{inContextDrawMatchUps:p}));let{positionAssignments:m}=Kt({drawDefinition:a,structureId:l}),h=m?.find(y=>y.drawPosition===o);if(h?.participantId){let y=h.participantId,b=hl({inContextDrawMatchUps:p,tournamentRecord:n,drawDefinition:a,participantId:s,drawPosition:o,structureId:l,matchUpsMap:f,event:u});return b.success?w({appliedPolicies:d,removedParticipantId:y}):q({result:b,stack:c})}let g=NU({inContextDrawMatchUps:p,tournamentRecord:n,drawDefinition:a,drawPosition:o,structureId:l,matchUpsMap:f,event:u});if(g.error)return q({result:g,stack:c});let I=g.participantId,v=hl({inContextDrawMatchUps:p,isQualifierPosition:i,tournamentRecord:n,drawDefinition:a,participantId:s,drawPosition:o,structureId:l,matchUpsMap:f,event:u});if(!v.success)return q({result:v,stack:c});return w({appliedPolicies:d,removedParticipantId:I});function w({appliedPolicies:y,removedParticipantId:b}){let{structure:S}=tt({drawDefinition:a,structureId:l});p2({drawPositions:[o],structure:S});let U={[e]:s,name:r,drawPosition:o,structureId:l};return hU({appliedPolicies:y,drawDefinition:a,positionAction:U}),q({context:{removedParticipantId:b},result:{...W},stack:c})}}function x_e({luckyLoserParticipantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,structureId:n}){return K2({positionActionName:"luckyLoserDrawPositionAssignment",participantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,structureId:n})}function Gae(t){return x_e(t)}function Hae({params:t,modMap:e,structure:i}){let{tournamentRecord:r,drawDefinition:n,event:a}=t;for(let s of i.matchUps)e[s.matchUpId]&&(s.roundNumber=e[s.matchUpId],Ut({tournamentId:r?.tournamentId,eventId:a?.eventId,drawDefinition:n,matchUp:s}))}function Wae(t,e){let i=[{drawDefinition:!0,structureId:!0}];Array.isArray(e)&&i.push(...e);let r=He(t,i);if(r.error)return r;let n=tt(t);if(n.error)return n;let a=n.structure;if(!Hn({structure:a}))return q({result:{error:ff,message:"structure must be adHoc"}});let{roundMatchUps:s=[],roundNumbers:o}=Sn({matchUps:a?.matchUps});return o?.length?{valid:!0,structure:a,roundMatchUps:s,roundNumbers:o}:{error:Nu}}function zae(t){let e=Wae(t,[{targetRoundNumber:!0,roundNumber:!0,[qn]:xFe}]);if(e.error)return e;let{structure:i,roundMatchUps:r,roundNumbers:n}=e,{targetRoundNumber:a,roundNumber:s}=t;if(!n?.includes(s)||!n?.includes(a))return q({result:{error:re},info:"roundNumbers must be valid rounds"});let o=a>s,l=o?Ce(s+1,a+1):Ce(a,s),u={};return l.forEach(c=>(r?.[c]??[]).forEach(({matchUpId:d})=>{u[d]=c-(o?1:-1)})),r?.[s]?.forEach(({matchUpId:c})=>u[c]=a),Hae({params:t,modMap:u,structure:i}),{...W}}function qae({structurePositionAssignments:t,provisionalPositioning:e,tournamentRecord:i,drawDefinition:r,event:n}){if(!r)return{error:$e};if(!Array.isArray(t))return{error:re};let a="setPositionAssignments";for(let o of t){let{structureId:l,positionAssignments:u}=o;if(!u)continue;let c=tt({drawDefinition:r,structureId:l});if(c.error)return c;let d=c.structure;if(!d)return{error:vi};let p=Kt({structure:d}).positionAssignments?.map(({drawPosition:g})=>g),f=u?.map(({drawPosition:g})=>g);if(Li(p,f).length!==p?.length)return q({result:{error:re},info:"drawPositions do not match",stack:a});let m=kr({drawDefinition:r}),{matchUps:h}=Zi({inContext:!0,drawDefinition:r,matchUpsMap:m});for(let g of u||[]){let{drawPosition:I,participantId:v,bye:w,qualifier:y}=g;if(w){let b=Ja({tournamentRecord:i,drawDefinition:r,drawPosition:I,matchUpsMap:m,structureId:l,structure:d,event:n});if(b?.error)return b}else if(y)u.forEach(b=>{b.drawPosition===I&&(b.qualifier=!0,delete b.participantId,delete b.bye)});else if(v){let b=hl({provisionalPositioning:e,inContextDrawMatchUps:h,tournamentRecord:i,drawDefinition:r,participantId:v,drawPosition:I,matchUpsMap:m,structureId:l,event:n});if(b?.error)return b}}Dc({tournamentId:i?.tournamentId,drawDefinition:r,structure:d,event:n})}let s=t.map(({structureId:o})=>o);return ii({tournamentId:i?.tournamentId,eventId:n?.eventId,drawDefinition:r,structureIds:s}),{...W}}function Yae(t){let e=Wae(t,[{roundNumbers:!0,[qn]:sn,[qr]:s=>s.length===2&&s.every(Ai)}]);if(e.error)return e;let{structure:i,roundMatchUps:r,roundNumbers:n}=e;if(!t.roundNumbers.every(s=>n?.includes(s)))return q({result:{error:re,message:"roundNumbers must be valid rounds"}});let a={};return t.roundNumbers.forEach((s,o)=>(r?.[s]??[]).forEach(({matchUpId:l})=>{a[l]=t.roundNumbers[1-o]})),Hae({params:t,modMap:a,structure:i}),{...W}}function Kae({alternateParticipantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,structureId:n,event:a}){return K2({positionActionName:"alternateDrawPositionAssignment",participantIdAttributeName:"alternateParticipantid",participantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,structureId:n,event:a})}function Xae({drawDefinition:t,structureId:e}){if(!t)return{error:$e};let{structure:i}=tt({drawDefinition:t,structureId:e}),r=(t?.links||[]).filter(n=>n.source?.structureId===e).map(n=>n.target?.structureId);return{playoffStructures:(t?.structures||[]).filter(n=>r.includes(n.structureId)),structure:i}}function rN({withStageGrouping:t,stageSequences:e,stageSequence:i,roundTarget:r,stages:n,event:a,stage:s}){if(!a)return{error:ui};let o={},l=[];for(let u of a.drawDefinitions||[]){let{structures:c,stageStructures:d}=io({withStageGrouping:t,stageSequences:e,drawDefinition:u,stageSequence:i,roundTarget:r,stages:n,stage:s});if(l.push(...c),d)for(let p of Object.keys(d))o[p]||(o[p]=[]),o[p].push(...d[p])}return{structures:l,stageStructures:o}}function X2({withStageGrouping:t,tournamentRecord:e,stageSequences:i,stageSequence:r,roundTarget:n,stages:a,stage:s}){if(!e)return{error:ve};let o={},l=[];for(let u of e.events||[]){let{structures:c,stageStructures:d}=rN({withStageGrouping:t,stageSequences:i,stageSequence:r,roundTarget:n,stages:a,event:u,stage:s});if(c&&l.push(...c),d)for(let p of Object.keys(d))o[p]||(o[p]=[]),o[p].push(...d[p])}return{structures:l,stageStructures:o}}function Su(t){if(!t?.drawDefinition)return!1;let e=QM(t),i=e?.includesTeamMatchUps,{completedMatchUps:r,pendingMatchUps:n,upcomingMatchUps:a}=e||{};return i&&(r=r?.filter(({matchUpType:s})=>s===ei),n=n?.filter(({matchUpType:s})=>s===ei),a=a?.filter(({matchUpType:s})=>s===ei)),!!(r?.length&&!n?.length&&!a?.length)}function J2(t){let{drawDefinition:e,structureId:i}=t;if(!e)return{error:$e};let{playoffStructures:r}=Xae({drawDefinition:e,structureId:i});if(!r?.length)return!1;let n=e?.entries?.filter(s=>s?.entryStatus&&uo.includes(s.entryStatus))?.length??0,a=0;return(r||[]).reduce((s,o)=>!!((Kt({structure:o}).positionAssignments??[])?.filter(l=>(l.participantId&&a++,l?.bye??l?.participantId)).length&&s),!!r.length)||a===n}function Rx({significantCharacters:t,accessors:e=[],value:i}){let r=[],n=e[0];if(i?.[n]){let s=e.slice(1);if(Array.isArray(i[n]))i[n].forEach(o=>{let l=Rx({accessors:s,significantCharacters:t,value:o});r.push(...l)});else if(i=i[n],s.length){let o=Rx({accessors:s,significantCharacters:t,value:i});r.push(...o)}else a({value:i})}function a({value:s}){if(s&&["string","number"].includes(typeof s)){let o=t?s.slice(0,t):s;r.push(o)}}return r}function F_e({targetParticipantIds:t,policyAttributes:e,idCollections:i,participants:r}){if(!Array.isArray(e))return{error:iB};if(!Array.isArray(r))return{error:eU};let n={};return t.forEach(a=>{let s=r.find(l=>l.participantId===a),{values:o}=Jae({policyAttributes:e,idCollections:i,participants:r,participant:s});o&&o.forEach(l=>{n[l]||(n[l]=[]),n[l].includes(a)||n[l].push(a)})}),n}function Jae({policyAttributes:t,idCollections:e,participants:i,participant:r}){if(!Array.isArray(t))return{error:iB};if(!r)return{error:Nh};let n=[];return t.forEach(a=>{let{directive:s,groupings:o,key:l,significantCharacters:u}=a||{};if(l){let c=l.split(".");n.push(...Rx({significantCharacters:u,value:r,accessors:c}))}else if(s){let c=a?.includeIds,d=(e?.[s]||[]).filter(p=>!c||c.includes(p));d?.length&&i?.length&&d.forEach(p=>{let f=i.find(m=>m.participantId===p);if(f?.individualParticipantIds?.includes(r.participantId)){let m=f?.participantId;n.push(m)}})}else o&&Object.keys(o).forEach(c=>{o[c].includes(r.participantId)&&n.push(c)})}),{values:nt(n)}}function nq({candidatePositionAssignments:t,participantsWithGroupings:e,policyAttributes:i,idCollections:r}){let n=Object.assign({},...e.map(a=>({[a.participantId]:a})));return t.map(a=>{let s=n[a.participantId],{values:o}=Jae({participants:e,policyAttributes:i,idCollections:r,participant:s});return{...a,values:o}})}function Qae({participantIdGroups:t,positionAssignments:e,groupsToAvoid:i}){return Object.assign({},...e.filter(r=>r?.participantId).map(r=>{let{drawPosition:n,participantId:a}=r,s=t?t[a]||[]:[],o=!!i.some(l=>s.includes(l));return{[n]:{participantGroups:s,includesGroupsToAvoid:o}}}))}function L_e(t){let{unfilledPositions:e,chunkedDrawPositions:i}=t,r=Qae(t);return i.map(a=>{let s=e.filter(u=>a.includes(u)),o=n(s),l=s.filter(u=>!o.includes(u)).filter(u=>{let c=aq(u);return!r[c]?.includesGroupsToAvoid});return{unassigned:s,unpaired:o,pairedNoConflict:l}});function n(a){return a.filter(o=>!s(o));function s(o){let l=aq(o);return!a.includes(l)}}}function __e(t){let{unfilledPositions:e,chunkedDrawPositions:i}=t,r=Qae(t);return i.map(n=>{let a=e.filter(l=>n.includes(l)),s=a.length===n.length?a:[],o=n.filter(l=>r[l]?.includesGroupsToAvoid).length;return{unassigned:a,unpaired:s,pairedNoConflict:o?[]:a,conflictsCount:o}})}function aq(t){return Number(t%2?t+1:t-1)}function $_e({allGroups:t,participantId:e}){return Object.keys(t).filter(i=>t[i].includes(e))}function B_e({selectedParticipantGroups:t,participantIdGroups:e,positionAssignments:i,drawPositionChunks:r,unfilledPositions:n,isRoundRobin:a}){let s=r.map(o=>a?__e({groupsToAvoid:t,chunkedDrawPositions:o,participantIdGroups:e,positionAssignments:i,unfilledPositions:n}):L_e({groupsToAvoid:t,chunkedDrawPositions:o,participantIdGroups:e,positionAssignments:i,unfilledPositions:n}));if(a){let o=s.map(c=>c.map(d=>d.unassigned).filter(d=>d?.length)).filter(c=>c?.length).sort((c,d)=>(d.length||0)-(c.length||0)),l=s.map(c=>c.map(d=>d.unpaired).filter(d=>d?.length)).filter(c=>c?.length),u=s.map(c=>c.map(d=>d.pairedNoConflict).filter(d=>d?.length)).filter(c=>c?.length).sort((c,d)=>(d.length||0)-(c.length||0));return{unassigned:o,unpaired:l,pairedNoConflict:u}}else{let o=s.map(c=>c.map(d=>d.unassigned).filter(d=>d?.length)).filter(c=>c?.length),l=s.map(c=>c.map(d=>d.unpaired).filter(d=>d?.length)).filter(c=>c?.length),u=s.map(c=>c.map(d=>d.pairedNoConflict).filter(d=>d?.length)).filter(c=>c?.length);return{unassigned:o,unpaired:l,pairedNoConflict:u}}}function Zae({positionAssignments:t,participantIds:e}){let i=t.map(r=>r.participantId);return e.filter(r=>!i.includes(r))}function V_e({useSpecifiedGroupKey:t=!1,targetParticipantIds:e,largestFirst:i=!0,allGroups:r,groupKey:n}){let a=Object.assign({},...Object.keys(r).map(u=>[u,r[u].filter(c=>e.includes(c))]).filter(u=>u[1].length).map(([u,c])=>({[u]:c}))),s=Object.keys(a).reduce((u,c)=>a[c].length>u?a[c].length:u,0),o=Object.keys(a).filter(u=>a[u].length===s),l=Ns(i?o:Object.keys(a));return n=t&&a[n]?.length?n:l,{participantId:n&&a[n]?Ns(a[n]):Ns(e),groupKey:n}}function j_e({drawPositionGroups:t,positionAssignments:e}){let i=Object.assign({},...e.map(r=>({[r.drawPosition]:r})));return t.map(r=>r.filter(Boolean).map(n=>i[n]).filter(Boolean).filter(n=>!n.participantId&&!n.bye).map(n=>n.drawPosition)).flat().filter(Boolean)}function G_e({candidatePositionAssignments:t,unseededParticipantIds:e,participantIdGroups:i,drawPositionChunks:r,drawPositionGroups:n,pairedPriority:a,allGroups:s,groupKey:o}){let l=n.reduce((T,P)=>P.length>T?P.length:T,0)<=2,u=Zae({positionAssignments:t,participantIds:e}),c=j_e({positionAssignments:t,drawPositionGroups:n}),{participantId:d,groupKey:p}=V_e({targetParticipantIds:u,useSpecifiedGroupKey:l,allGroups:s,groupKey:o}),f=$_e({participantId:d,allGroups:s}),m=B_e({positionAssignments:t,isRoundRobin:l,selectedParticipantGroups:f,participantIdGroups:i,drawPositionChunks:r,unfilledPositions:c}),{unassigned:h,unpaired:g,pairedNoConflict:I}=m,v=I?.length&&I[0],w=g?.length&&g[0],y=a&&v?v:w,b=a?w:v,S=y?.length&&y||b?.length&&b,U;if(S?.length){let T=ha(S);U=ha(T)}else{let T=ha(h[0]);U=ha(T)}return{newGroupKey:p,selectedParticipantId:d,targetDrawPosition:U}}function Cx({isRoundRobin:t,groupedParticipants:e}){let i=[];return t?e.forEach(r=>{let n=r.map(o=>o.drawPosition),a=j2({drawPositions:n}).uniqueMatchUpGroupings??[],s=Object.assign({},...r.map(o=>({[o.drawPosition]:o})));a.forEach(o=>{xn(s[o[0]].values||[],s[o[1]].values||[])&&(i.push(o),r.conflict=!0)})}):e.forEach(r=>{xn(r[0]?.values||[],r[1]?.values||[])&&(i.push(r),r.conflict=!0)}),i}function H_e(t,e){let i=t.find(r=>r.includes(e));if(i)return i.find(r=>r!==e)}function sq(t,e){return t.find(i=>i.drawPosition===e)}function W_e({moveableParticipant:t,possibleDrawPosition:e,positionedParticipants:i,drawPositionGroups:r,isRoundRobin:n,getAvoidanceConflicts:a}){let s=H_e(r,e),o=sq(i,s),l=a({isRoundRobin:n,groupedParticipants:[[t,o]]}),u=[sq(i,e),o],c=a({isRoundRobin:n,groupedParticipants:[u]});return!l.length&&!c.length}function z_e({positionedParticipants:t,potentialDrawPositions:e,drawPositionGroups:i,avoidanceConflicts:r,isRoundRobin:n}){return r.flatMap(a=>{let s=a.map(o=>o.drawPosition);return a.filter(o=>e.includes(o.drawPosition)).map(o=>{let l=e.filter(u=>!s?.includes(u)).filter(u=>W_e({moveableParticipant:o,possibleDrawPosition:u,positionedParticipants:t,drawPositionGroups:i,isRoundRobin:n,getAvoidanceConflicts:Cx}));if(l.length)return{drawPosition:o.drawPosition,possibleDrawPositions:l}}).filter(Boolean)})}function oq(t){let{initialPositionAssignments:e,participantsWithGroupings:i,opponentsToPlaceCount:r,unseededByePositions:n,drawPositionGroups:a,policyAttributes:s,idCollections:o,allGroups:l}=t,u=[],c,d=Math.min(...(a||[]).map(w=>w?.length).filter(Boolean)),p=d>2,f=Oe(e,!1,!0).filter(w=>!w.qualifier),m=e.filter(w=>!w.participantId&&(!w.bye||n?.includes(w.drawPosition))).map(w=>w.drawPosition);Ce(0,r).forEach(()=>{let{newGroupKey:w,selectedParticipantId:y,targetDrawPosition:b}=G_e({...t,candidatePositionAssignments:f,allGroups:l,groupKey:c});c=w,f.forEach(S=>{S.drawPosition===b&&(S.participantId=y)})});let h=nq({candidatePositionAssignments:f,participantsWithGroupings:i,policyAttributes:s,idCollections:o}),g=wr(h,d),I=Cx({groupedParticipants:g,isRoundRobin:p}),v=0;for(;v<20&&I.length;){let w=z_e({positionedParticipants:h,potentialDrawPositions:m,avoidanceConflicts:I,drawPositionGroups:a,isRoundRobin:p});if(w.length){let y=q_e({candidatePositionAssignments:f,swapOptions:w});y.error&&console.log({result:y}),h=nq({candidatePositionAssignments:f,participantsWithGroupings:i,policyAttributes:s,idCollections:o}),g=wr(h,d),I=Cx({groupedParticipants:g,isRoundRobin:p}),v++}else v=20}return f.forEach(w=>{if(w.bye&&w.participantId){let y=nx;u.push(y)}if(w.qualifier&&w.participantId){let y=nx;u.push(y)}}),{positionAssignments:f,conflicts:I.length,groupedParticipants:g,errors:u}}function q_e({candidatePositionAssignments:t,swapOptions:e}){let i=ha(e);if(!i)return{error:{message:"No swap options"}};let r=i.drawPosition,n=ha(i.possibleDrawPositions),a=t.find(u=>u.drawPosition===r),s=t.find(u=>u.drawPosition===n)??{},o={participantId:s?.participantId,qualifier:s?.qualifier,bye:s?.bye},l={participantId:a.participantId,qualifier:a.qualifier,bye:a.bye};return Object.assign(a,o),Object.assign(s,l),{...W}}function Y_e({provisionalPositioning:t,unseededParticipantIds:e,inContextDrawMatchUps:i,unseededByePositions:r,tournamentRecord:n,drawDefinition:a,seedBlockInfo:s,participants:o,matchUpsMap:l,structureId:u,avoidance:c,drawSize:d,event:p}){if(!c)return{error:_te};let{candidatesCount:f=1,policyAttributes:m,targetDivisions:h}=c,{roundsToSeparate:g}=c,I="randomUnseededSeparation",{structure:v}=tt({drawDefinition:a,structureId:u}),{matchUps:w}=At({provisionalPositioning:t,matchUpsMap:l,structure:v,event:p});if(h&&Ro(h)&&!g){let L=Nxe(h)||0,$=w.reduce((V,_)=>_.roundNumber>V?_.roundNumber:V,0);g=$<L?1:$-L+1}let{positionAssignments:y}=pr({structure:v}),b=jM({participantsProfile:{convertExtensions:!0},deepCopy:!1,participants:o}).participantsWithGroupings,S=y?.filter(L=>!L.participantId),U=y?.map(L=>L.drawPosition),T=v?.structureType===gn,P=T?{structure:v,matchUps:w,allDrawPositions:U,roundsToSeparate:g}:{matchUps:w,allDrawPositions:U,roundsToSeparate:g},{drawPositionGroups:D,drawPositionChunks:E}=T?K_e(P):X_e(P),R={groupParticipants:o.filter(L=>L.participantType===Ya).map(L=>L.participantId),teamParticipants:o.filter(L=>L.participantType===_t).map(L=>L.participantId),pairParticipants:o.filter(L=>L.participantType===ft).map(L=>L.participantId)},C=F_e({targetParticipantIds:e,policyAttributes:m,idCollections:R,participants:o});if(C.error)return q({result:C,stack:I});let M=Object.assign({},...e.map(L=>{let $=Object.keys(C).filter(V=>(C[V]??[]).includes(L));return{[L]:$}})),N=Zae({participantIds:e,positionAssignments:y});if(N.length>(S?.length||0))return{error:oB};let A,O=N.length,k=Ce(0,f).map(()=>oq({initialPositionAssignments:y,participantsWithGroupings:b,unseededParticipantIds:e,opponentsToPlaceCount:O,pairedPriority:!1,unseededByePositions:r,participantIdGroups:M,drawPositionChunks:E,drawPositionGroups:D,policyAttributes:m,idCollections:R,allGroups:C,drawSize:d}));if(A=k.reduce((L,$)=>!L||($.conflicts||0)<(L.conflicts||0)?$:L,void 0),!A||A.conflicts){let L=Ce(0,f).map(()=>oq({initialPositionAssignments:y,participantsWithGroupings:b,unseededParticipantIds:e,opponentsToPlaceCount:O,pairedPriority:!0,unseededByePositions:r,participantIdGroups:M,drawPositionChunks:E,drawPositionGroups:D,policyAttributes:m,idCollections:R,allGroups:C,drawSize:d}));A=k.concat(...L).filter($=>!$.errors?.length).reduce(($,V)=>!$||(V.conflicts||0)<($.conflicts||0)?V:$,void 0)}if(!A)return{error:fM};let F=(Kt({structure:v})?.positionAssignments??[]).filter(L=>L.participantId).map(L=>L.participantId),x=A.positionAssignments.filter(L=>!F.includes(L.participantId));for(let L of x)if(L.bye){let $=Ja({tournamentRecord:n,drawDefinition:a,structureId:u,matchUpsMap:l,event:p,...L});if($.error)return q({result:$,stack:I})}else if(L.participantId){let $=hl({inContextDrawMatchUps:i,tournamentRecord:n,drawDefinition:a,seedBlockInfo:s,structureId:u,matchUpsMap:l,event:p,...L});if($.error)return q({result:$,stack:I,context:{assignment:L}})}return{...W}}function K_e(t){let{structure:{structures:e}}=t,i=e.map(r=>r.positionAssignments.map(n=>n.drawPosition));return{drawPositionGroups:i,drawPositionChunks:[i]}}function X_e({allDrawPositions:t,roundsToSeparate:e,matchUps:i}){let r=i.filter(c=>c.roundNumber===1).map(c=>c.drawPositions),n=r.flat().sort(nr),a=Math.max(...n),s=t.filter(c=>c>a),o=n.length,l=Ce(o===2?1:2,o).filter(c=>c===z$(c)),u=l.slice(0,e||l.length).reverse().map(c=>wr(n,c));return s.length&&console.log({fedDrawPositions:s}),{drawPositionGroups:r,drawPositionChunks:u}}function J_e({provisionalPositioning:t,inContextDrawMatchUps:e,unseededByePositions:i,multipleStructures:r,tournamentRecord:n,drawDefinition:a,seedBlockInfo:s,participants:o,matchUpsMap:l,structureId:u,structure:c,drawSize:d,event:p}){let f="positionUnseededParticipants";c||({structure:c}=tt({drawDefinition:a,structureId:u})),u||({structureId:u}=c);let{positionAssignments:m}=pr({structure:c}),{seedAssignments:h}=hs({provisionalPositioning:t,drawDefinition:a,structure:c}),g=h?.map(P=>P.participantId).filter(Boolean),{stage:I,stageSequence:v}=c,w=I===ze?ht({element:c,name:El})?.extension?.value:void 0,y=$h({provisionalPositioning:t,drawDefinition:a,stageSequence:v,entryStatuses:Sf,structureId:u,roundTarget:w,stage:I}),b=y.filter(P=>!g?.includes(P.participantId)).map(P=>P.participantId),S=m?.filter(P=>!P.participantId&&!P.bye&&!P.qualifier).map(P=>P.drawPosition);if(!r&&b.length>(S?.length||0))return q({result:{error:oB},context:{unseededParticipantsCount:b.length,unfilledDrawPositionsCount:S?.length},stack:f});let{appliedPolicies:U}=Dt({tournamentRecord:n,drawDefinition:a,event:p}),T=U?.[Xb];if(c.stage===Ti){let P=y.reduce((D,E)=>(D[E.groupingValue]||(D[E.groupingValue]=[]),D[E.groupingValue].push(E.participantId),D),{});Object.keys(P).length&&(T||(T={policyName:"Playoff Avoidance"}),T.policyAttributes||(T.policyAttributes=[]),T.policyAttributes.push({groupings:P}))}return T&&o?Y_e({provisionalPositioning:t,unseededParticipantIds:b,inContextDrawMatchUps:e,unseededByePositions:i,tournamentRecord:n,drawDefinition:a,seedBlockInfo:s,participants:o,matchUpsMap:l,structureId:u,avoidance:T,drawSize:d}):Q_e({provisionalPositioning:t,unseededParticipantIds:b,inContextDrawMatchUps:e,unfilledDrawPositions:S,multipleStructures:r,tournamentRecord:n,drawDefinition:a,seedBlockInfo:s,structureId:u,matchUpsMap:l,drawSize:d,event:p})}function Q_e({provisionalPositioning:t,unseededParticipantIds:e,inContextDrawMatchUps:i,unfilledDrawPositions:r,multipleStructures:n,tournamentRecord:a,drawDefinition:s,seedBlockInfo:o,matchUpsMap:l,structureId:u,drawSize:c,event:d}){let p=c>2?Cn(r):r.reverse();for(let f of e){let m=p.pop();if(!n||m){let h=hl({provisionalPositioning:t,inContextDrawMatchUps:i,tournamentRecord:a,drawDefinition:s,seedBlockInfo:o,participantId:f,drawPosition:m,matchUpsMap:l,structureId:u,event:d});if(h?.error&&console.log("!!!!!",{result:h}),h?.error)return q({result:h,stack:"randomUnseededDistribution"})}}return{...W}}function Z_e(t){let e=t.structure??tt(t).structure,i="positionQualifiers",r=[];if(e.stage===tn)return q({result:{error:hf},stack:i});let{unplacedRoundQualifierCounts:n,positionAssignments:a,roundDrawPositions:s}=e$e(t);for(let o of Object.keys(n)){let l=a?.filter(u=>s[o].includes(u.drawPosition)&&!u.participantId&&!u.qualifier&&!u.bye).map(u=>u.drawPosition);if(n[o]>(l||0))return q({result:{error:sB},context:{unfilledDrawPositions:l},stack:i});Ce(0,n[o]).forEach(()=>{let u=ha(l);r.push(u),a?.forEach(c=>{c.drawPosition===u&&(c.qualifier=!0,delete c.participantId,delete c.bye)})})}return{...W,qualifierDrawPositions:r}}function e$e({drawDefinition:t,structure:e,structureId:i}){e||({structure:e}=tt({drawDefinition:t,structureId:i})),i||({structureId:i}=e);let{positionAssignments:r}=pr({structure:e}),{stage:n,stageSequence:a}=e,{qualifiersCount:s,roundQualifiersCounts:o}=Hv({drawDefinition:t,stageSequence:a,structureId:i,stage:n}),l=(o?Object.keys(o):[]).map(h=>Ke(h)),{matchUps:u}=At({structure:e}),{roundProfile:c}=Sn({matchUps:u}),d=Object.assign({},...l.filter(h=>c?.[h]).map(h=>({[h]:c?.[h]?.drawPositions?.filter(Boolean)??[]}))),p=r?.filter(h=>h.qualifier).map(h=>h.drawPosition),f=s-(p?.length??0),m=p?.length;return{unplacedRoundQualifierCounts:Object.assign({},...l.map(h=>{let g=r?.filter(I=>I.qualifier&&d[h]?.drawPositions?.includes(I.drawPosition)).map(I=>I.drawPosition);return{[h]:(o?.[h]??0)-(g?.length??0)}})),unplacedQualifiersCount:f,placedQualifiersCount:m,roundQualifiersCounts:o,positionAssignments:r,roundDrawPositions:d,qualifiersCount:s}}function ese({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,appliedPolicies:r,validSeedBlocks:n,drawDefinition:a,seedingProfile:s,seedBlockInfo:o,participants:l,groupsCount:u,structureId:c,matchUpsMap:d,structure:p,event:f}){let m=[],h=[],g=0;if(p||({structure:p}=tt({drawDefinition:a,structureId:c})),c||(c=p?.structureId),r||(r=Dt({drawDefinition:a}).appliedPolicies),!n){let I=p&&Yh({provisionalPositioning:t,appliedPolicies:r,drawDefinition:a,seedingProfile:s,structure:p});I?.error&&h.push(I.error),n=I?.validSeedBlocks}return u=u??n?.length??0,Ce(0,u).forEach(()=>{if(g<(u||0)){let I=t$e({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:a,seedingProfile:s,seedBlockInfo:o,participants:l,structureId:c,matchUpsMap:d,event:f});I?.success&&(g++,m.push(...I.seedPositions??[])),I.error&&h.push({seedPositionError:I.error})}}),h.length?{error:h}:{...W,seedPositions:m}}function t$e({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:r,seedingProfile:n,seedBlockInfo:a,participants:s,structureId:o,matchUpsMap:l,event:u}){let{unplacedSeedParticipantIds:c,unfilledPositions:d}=_ae({provisionalPositioning:t,randomize:!0,drawDefinition:r,seedingProfile:n,seedBlockInfo:a,structureId:o}),{appliedPolicies:p}=Dt({drawDefinition:r}),{avoidance:f}=p??{};f&&s&&c?.length>2;let m=[];for(let h of c){let g=d.pop();if(!g)return{error:Rv};m.push(g);let I=hl({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:r,seedingProfile:n,participantId:h,seedBlockInfo:a,drawPosition:g,matchUpsMap:l,structureId:o,event:u});if(!I.success)return I}return{...W,seedPositions:m}}function i$e({provisionalPositioning:t,drawDefinition:e,structure:i}){let{positionAssignments:r}=pr({structure:i}),{seedAssignments:n}=hs({provisionalPositioning:t,drawDefinition:e,structure:i}),a=Object.assign({},...(n||[]).filter(s=>s.participantId).map(s=>({[s.participantId]:s})));return r?.map(s=>a[s.participantId]?{...s,seedNumber:a[s.participantId].seedNumber,seedValue:a[s.participantId].seedValue}:"").filter(Boolean)}function r$e({orderedSortedFirstRoundSeededDrawPositions:t,validSeedBlocks:e,byesToPlace:i}){let r=[];e.forEach(a=>n$e(a,i,r,t));let n=r.map(a=>Array.isArray(a)?Cn(a):a).flat(1/0);return rte(i)&&e.map(a=>a.seedNumbers[0]).includes(i)?t:n}function n$e(t,e,i,r){if(e-i.length>t.drawPositions.length)i.push(...t.drawPositions);else{let n=Mx(wr(t.drawPositions,2));a$e(n,i,r)}}function a$e(t,e,i){let r,n=i[e.length];for(;r=gD(t,n);)e.push(r),n=i[e.length]}function gD(t,e){return Array.isArray(t)&&t.length!==2?t.pop():Array.isArray(t[0])?o$e(t,e):s$e(t,e)}function s$e(t,e){return t.includes(e)?t.indexOf(e)?t.pop():t.shift():Math.round(Math.random())?t.pop():t.shift()}function o$e(t,e){let i=t[0].flat(1/0).length,r=t[1].flat(1/0).length;if(i===r){let n=t[0].flat(1/0).includes(e)?t[0]:t[1];return gD(e?n:t[Math.round(Math.random())],e)}return i<r?gD(t[1],e):gD(t[0],e)}function Mx(t){let e=Math.floor(t.length/2);return t.length>2?[Mx(t.slice(0,e)),Mx(t.slice(e))]:t}function l$e({provisionalPositioning:t,relevantMatchUps:e,appliedPolicies:i,drawDefinition:r,seedingProfile:n,seedBlockInfo:a,byesToPlace:s,structure:o}){a||(a=Yh({provisionalPositioning:t,appliedPolicies:i,drawDefinition:r,seedingProfile:n,structure:o}));let{isFeedIn:l,isLuckyStructure:u,isContainer:c}=a,{validSeedBlocks:d}=a;i?.seeding?.containerByesIgnoreSeeding&&(d=[]);let p=i$e({provisionalPositioning:t,drawDefinition:r,structure:o})??[],f=nt([].concat(...e.map(y=>y.drawPositions))),m=p.filter(y=>f.includes(y.drawPosition)),h=(y,b)=>NI(y.seedValue)-NI(b.seedValue),g=d.reduce((y,b)=>{let S=m.filter(U=>b.drawPositions?.includes(U.drawPosition)).sort(h);return y.concat(...S)},[]).map(y=>y.drawPosition),I=r$e({orderedSortedFirstRoundSeededDrawPositions:g,validSeedBlocks:d,byesToPlace:s}),v=lq({orderedSeedDrawPositions:g,relevantMatchUps:e}).slice(0,s),w=lq({orderedSeedDrawPositions:I,relevantMatchUps:e}).slice(0,s);return{strictSeedOrderByePositions:v,blockSeedOrderByePositions:w,isLuckyStructure:u,positionedSeeds:p,isContainer:c,isFeedIn:l}}function lq({orderedSeedDrawPositions:t,relevantMatchUps:e}){let i=e.map(r=>r.drawPositions).map(r=>r?.sort((n,a)=>n-a)).filter(r=>r?.[0]+1===r?.[1]);return t.map(r=>i.find(n=>n?.includes(r))).filter(Boolean).map(r=>r?.reduce((n,a)=>t.includes(a)?n:a,void 0)).filter(Boolean)}function u$e({provisionalPositioning:t,seedOrderByePositions:e,isLuckyStructure:i,appliedPolicies:r,drawDefinition:n,seedLimit:a,structure:s,isFeedIn:o}){let l=r?.seeding?.seedingProfile,u=s.stage===ze,{positionAssignments:c}=pr({structure:s}),d=c?.filter(N=>N.participantId).map(N=>N.drawPosition),p={isCollectionMatchUp:!1},{matchUps:f,roundMatchUps:m}=At({provisionalPositioning:t,matchUpFilters:p,structure:s}),h=m?.[1]||[],g=s.structureType===gn?f:h,I=nt([].concat(...g.map(N=>N.drawPositions))),v=Math.min(...I)-1,w=d?.filter(N=>I.includes(N)),y=N=>{let A=Math.ceil(N.length/2),O=[N.slice(0,A),N.slice(A)],k=O.map(G=>[].concat(...G.flat(1/0)).length),F=Math.min(...k.flat(1/0)),x=Math.max(...k.flat(1/0)),L=k.indexOf(x),$=F!==x,V=Cn(O),[_,B]=!F||$?[O[L],O[1-L]]:[V[0],V[1]];return{greaterHalf:_,lesserHalf:B}},b=N=>{let{greaterHalf:A,lesserHalf:O}=y(N),{greaterHalf:k,lesserHalf:F}=y(A),x=Cn(k.flat(1/0)).pop(),L=k.flat().filter($=>$!==x);return{newlyFilteredChunks:[...O,...F,L],drawPosition:x}},S=N=>!e.includes(N),U=N=>!w?.includes(N),T=N=>{let A=wr(N.sort(nr),Math.ceil(N.length/4)).map(F=>F.filter(U)),O=[].concat(...A.flat(1/0)).length,k=[];for(let F=0;F<O;F++){let{newlyFilteredChunks:x,drawPosition:L}=b(A);k.push(L),A=x}return k},{validSeedBlocks:P}=Yh({provisionalPositioning:t,allPositions:!0,appliedPolicies:r,drawDefinition:n,structure:s}),D=P?.map(N=>N.drawPositions?.map(A=>A+v)),E;if(o){let N=I.length,{seedBlocks:A}=G2({cluster:[sU,UM].includes(_U(l)),participantsCount:N});E=A.map(O=>O.map(k=>k+v)).map(T).filter(O=>O.length)}else u?E=D?.map(N=>N.filter(U)):E=D?.map(T).filter(N=>N.length);let R=g.map(N=>N.drawPositions).map(N=>N?.sort((A,O)=>A-O)).filter(N=>N?.[0]+1===N?.[1]),C=N=>R.reduce((A,O)=>O.includes(N)?O.reduce((k,F)=>F!==N?F:k,void 0):A,void 0),M=E.map(N=>N.map(C)).flat(1/0).filter(U).filter(S).filter(Boolean);if(u&&!s.structures){let N=a%4,A=M.slice(0,N),O=m[s.roundLimit]?.length,k=wr(M.slice(N),O).map(Cn).flat();M=A.concat(k)}return{unseededByePositions:M}}function c$e({provisionalPositioning:t,drawDefinition:e,matchUpsMap:i,structure:r,event:n}){let a={isCollectionMatchUp:!1},{matchUps:s,roundMatchUps:o}=At({afterRecoveryTimes:!1,provisionalPositioning:t,drawDefinition:e,matchUpFilters:a,matchUpsMap:i,structure:r,event:n}),l=o?.[1]||[],u=r?.structureType===gn,c=u?s:l,d=u?r?.structures?.length||0:s.length,{structureId:p,stage:f,stageSequence:m}=r,h=$h({entryStatuses:uo,provisionalPositioning:t,drawDefinition:e,stageSequence:m,structureId:p,stage:f}),{qualifiersCount:g}=Hv({provisionalPositioning:t,drawDefinition:e,stageSequence:m,structureId:p,stage:f}),I=h.length+g,{positionAssignments:v,unassignedPositions:w}=pr({structure:r}),y=w?.map(D=>D.drawPosition),b=v?.filter(D=>D.bye).length,S=v?.filter(D=>D.bye).map(D=>D.drawPosition),U=c.map(D=>D.drawPositions).filter(D=>D?.reduce((E,R)=>!S?.includes(R)&&E,!0)).flat(1/0).filter(D=>y?.includes(D)),T=v?.length,P=T?T-I:0;return P>d&&r.stageSequence===1&&r.stage!==tn&&(P=d),{placedByes:b,byesCount:P,relevantMatchUps:c,placedByePositions:S,roundMatchUps:o,positionsToAvoidDoubleBye:U}}function tse({provisionalPositioning:t,tournamentRecord:e,appliedPolicies:i,drawDefinition:r,seedBlockInfo:n,seedingProfile:a,matchUpsMap:s,structureId:o,structure:l,seedLimit:u,seedsOnly:c,event:d}){l||({structure:l}=tt({drawDefinition:r,structureId:o})),o||(o=l?.structureId);let p=!(l?.structures??l?.stage===ze),{byesCount:f,placedByes:m,relevantMatchUps:h}=c$e({provisionalPositioning:t,drawDefinition:r,matchUpsMap:s,structure:l,event:d}),g=f-(m||0);if(g<=0)return{...W};let{strictSeedOrderByePositions:I,blockSeedOrderByePositions:v,isLuckyStructure:w,isFeedIn:y}=l$e({provisionalPositioning:t,relevantMatchUps:h,appliedPolicies:i,drawDefinition:r,seedingProfile:a,seedBlockInfo:n,byesToPlace:g,structure:l}),b=l?.structureType&&[gn,TM].includes(l.structureType)&&i?.seeding?.containerByesIgnoreSeeding,S=p&&v?.length?v:I,{unseededByePositions:U}=u$e({provisionalPositioning:t,seedOrderByePositions:S,isLuckyStructure:w,appliedPolicies:i,drawDefinition:r,seedLimit:u,structure:l,isFeedIn:y}),T=R=>R%2,P=(R,C)=>(R||[]).every(M=>T(M)?C!==M+1:C!==M-1),D=[].concat(...S);if(!c)for(;U.length;){let R=U.find(C=>P(D,C));R?(D.push(R),U=U.filter(C=>C!==R)):(D.push(...U),U=[])}b&&(D=Cn(D),oa({ignoreSeededByes:b})&&console.log({byePositions:D}));let E=D.slice(0,g);for(let R of E){let C=Ja({provisionalPositioning:t,tournamentRecord:e,drawDefinition:r,drawPosition:R,matchUpsMap:s,structureId:o,structure:l,event:d});if(C?.error)return C}return{...W,unseededByePositions:U,byeDrawPositions:E}}function my(t,e){return e||gM(),q({result:t,stack:"automatedPositioning"})}function d$e(t,e){return e||gM(),t}function p$e(t,e,i,r){let n=tt({drawDefinition:e,structureId:i});if(n.error)return{error:n.error};let a=n.structure;if(!a)return{error:vi};let s=t.appliedPolicies||Dt({drawDefinition:e,structure:a,event:r})?.appliedPolicies,{qualifiersCount:o}=Hv({stageSequence:a.stageSequence,provisionalPositioning:t.provisionalPositioning,stage:a.stage,drawDefinition:e,structureId:i}),l=Sf,u=$h({stageSequence:a.stageSequence,provisionalPositioning:t.provisionalPositioning,stage:a.stage,placementGroup:t.placementGroup,drawDefinition:e,entryStatuses:l,structureId:i});return{structure:a,appliedPolicies:s,qualifiersCount:o,entries:u}}function f$e({placeByes:t,provisionalPositioning:e,tournamentRecord:i,appliedPolicies:r,drawDefinition:n,seedBlockInfo:a,matchUpsMap:s,structure:o,seedLimit:l,seedsOnly:u,event:c,structureSeedingProfile:d,seedingProfile:p,inContextDrawMatchUps:f,participants:m,positioningReport:h}){let g=t?tse({provisionalPositioning:e,tournamentRecord:i,appliedPolicies:r,drawDefinition:n,seedBlockInfo:a,matchUpsMap:s,structure:o,seedLimit:l,seedsOnly:u,event:c}):void 0;if(g?.error)return{error:g.error};let I=g?.unseededByePositions;return h.push({action:"positionByes",unseededByePositions:I}),g=ese({seedingProfile:d?{positioning:d}:p,provisionalPositioning:e,inContextDrawMatchUps:f,tournamentRecord:i,appliedPolicies:r,validSeedBlocks:a.validSeedBlocks,drawDefinition:n,seedBlockInfo:a,participants:m,matchUpsMap:s,structure:o,event:c}),g.error?{error:g.error}:(h.push({seedPositions:g.seedPositions,action:"positionSeedBlocks"}),{unseededByePositions:I})}function m$e({drawType:t,LUCKY_DRAW:e,structureSeedingProfile:i,seedingProfile:r,provisionalPositioning:n,inContextDrawMatchUps:a,tournamentRecord:s,appliedPolicies:o,validSeedBlocks:l,drawDefinition:u,seedBlockInfo:c,participants:d,matchUpsMap:p,structure:f,event:m,placeByes:h,seedLimit:g,seedsOnly:I,positioningReport:v}){let w;if(t!==e){let b=ese({seedingProfile:i?{positioning:i}:r,provisionalPositioning:n,inContextDrawMatchUps:a,tournamentRecord:s,appliedPolicies:o,validSeedBlocks:l,drawDefinition:u,seedBlockInfo:c,participants:d,matchUpsMap:p,structure:f,event:m});if(b.error)return{error:b.error};v.push({action:"positionSeedBlocks",seedPositions:b.seedPositions})}let y=h?tse({provisionalPositioning:n,tournamentRecord:s,appliedPolicies:o,drawDefinition:u,seedBlockInfo:c,matchUpsMap:p,structure:f,seedLimit:g,seedsOnly:I,event:m}):void 0;return y?.error?{error:y.error}:(w=y?.unseededByePositions,v.push({action:"positionByes",byeDrawPositions:y?.byeDrawPositions,unseededByePositions:w}),{unseededByePositions:w})}function h$e({seedsOnly:t,inContextDrawMatchUps:e,tournamentRecord:i,appliedPolicies:r,validSeedBlocks:n,drawDefinition:a,seedBlockInfo:s,participants:o,matchUpsMap:l,structure:u,positionQualifiers:c,positionUnseededParticipants:d,provisionalPositioning:p,unseededByePositions:f,multipleStructures:m,structureId:h,drawSize:g,event:I,positioningReport:v,conflicts:w}){if(t)return{};let y=c({inContextDrawMatchUps:e,tournamentRecord:i,appliedPolicies:r,validSeedBlocks:n,drawDefinition:a,seedBlockInfo:s,participants:o,matchUpsMap:l,structure:u});return y.error?{error:y.error}:(y.conflicts&&(w.qualifierConflicts=y.conflicts),v.push({action:"positionQualifiers",qualifierDrawPositions:y.qualifierDrawPositions}),y=d({provisionalPositioning:p,inContextDrawMatchUps:e,unseededByePositions:f,multipleStructures:m,tournamentRecord:i,drawDefinition:a,seedBlockInfo:s,participants:o,matchUpsMap:l,structureId:h,structure:u,drawSize:g,event:I}),y.error?{error:y.error}:(y.conflicts&&(w.unseededConflicts=y.conflicts),v.push({action:"positionUnseededParticipants"}),{}))}function $U(t){let{drawDefinition:e}=t,{applyPositioning:i=!0,provisionalPositioning:r,multipleStructures:n,placeByes:a=!0,tournamentRecord:s,seedingProfile:o,structureId:l,seedLimit:u,seedsOnly:c,drawType:d,drawSize:p,event:f}=t,m=[];i||(Cie(),e=Oe(e,!1,!0));let{structure:h,appliedPolicies:g,qualifiersCount:I,entries:v,error:w}=p$e(t,e,l,f);if(w)return my(w,i);if(!v?.length&&!I)return d$e({...W},i);let y=t.matchUpsMap??kr({drawDefinition:e}),b=t.inContextDrawMatchUps??Zi({inContext:!0,drawDefinition:e,matchUpsMap:y})?.matchUps,S=Yh({provisionalPositioning:r,appliedPolicies:g,drawDefinition:e,seedingProfile:o,structure:h});if(S.error)return my(S,i);let{validSeedBlocks:U}=S;m.push({validSeedBlocks:U});let T=t.participants||(s?Ri({withIndividualParticipants:!0,convertExtensions:!0,tournamentRecord:s})?.participants:[]),P;if(_U(h.seedingProfile||o)===Bp){let C=f$e({placeByes:a,provisionalPositioning:r,tournamentRecord:s,appliedPolicies:g,drawDefinition:e,seedBlockInfo:S,matchUpsMap:y,structure:h,seedLimit:u,seedsOnly:c,event:f,structureSeedingProfile:h.seedingProfile,seedingProfile:o,inContextDrawMatchUps:b,participants:T,positioningReport:m});if(C?.error)return my(C.error,i);P=C.unseededByePositions}else{let C=m$e({drawType:d,LUCKY_DRAW:If,structureSeedingProfile:h.seedingProfile,seedingProfile:o,provisionalPositioning:r,inContextDrawMatchUps:b,tournamentRecord:s,appliedPolicies:g,validSeedBlocks:U,drawDefinition:e,seedBlockInfo:S,participants:T,matchUpsMap:y,structure:h,event:f,placeByes:a,seedLimit:u,seedsOnly:c,positioningReport:m});if(C?.error)return my(C.error,i);P=C.unseededByePositions}let D={},E=h$e({seedsOnly:c,inContextDrawMatchUps:b,tournamentRecord:s,appliedPolicies:g,validSeedBlocks:U,drawDefinition:e,seedBlockInfo:S,participants:T,matchUpsMap:y,structure:h,positionQualifiers:Z_e,positionUnseededParticipants:J_e,provisionalPositioning:r,unseededByePositions:P,multipleStructures:n,structureId:l,drawSize:p,event:f,positioningReport:m,conflicts:D});if(E?.error)return my(E.error,i);let{positionAssignments:R}=Kt({drawDefinition:e,structure:h});return ii({drawDefinition:e,structureIds:[l]}),i||gM(),{positionAssignments:R,conflicts:D,...W,positioningReport:m}}function qv(t){let{applyPositioning:e=!0,provisionalPositioning:i,tournamentRecord:r,drawDefinition:n,seedingProfile:a,structureId:s,placeByes:o,seedsOnly:l}=t;if(!n)return{error:_a};if(!Su({drawDefinition:n,structureId:s})&&!i)return{error:q$};let u=Xae({drawDefinition:n,structureId:s}).playoffStructures?.sort((p,f)=>VP(p)-VP(f)),c=[],d=[];if(u)for(let p of u){let{structureId:f}=p,m=$U({structureId:f,provisionalPositioning:i,applyPositioning:e,tournamentRecord:r,drawDefinition:n,seedingProfile:a,placeByes:o,seedsOnly:l});if(m.error)return m;m.positionAssignments&&c.push({positionAssignments:m.positionAssignments,structureId:f}),m.positioningReport&&d.push(m.positioningReport)}return{...W,structurePositionAssignments:c,positioningReports:d}}function ise({validation:t=!0,tournamentRecord:e,drawDefinition:i,participantId:r,structureId:n,seedValue:a,event:s}){if(!i)return{error:$e};if(!n)return{error:qa};let o=(e?.participants??[]).find(p=>p.participantId===r);if(e&&!o)return{error:Co};let{structure:l}=tt({drawDefinition:i,structureId:n});if(!l)return{error:vi};if(!(!t||Ai(a)||a===void 0||a===""||typeof a=="string"&&a.split("-").every(p=>Ai(p)&&Ke(p)>0)))return{error:re};let{seedAssignments:u}=hs({drawDefinition:i,structure:l}),c=u?.map(p=>p.seedNumber),d=u?.find(p=>p.participantId===r);if(d){let p=typeof a=="string"?a.includes("-")&&a.split("-").map(f=>parseInt(f)).join("-")||parseInt(a)>0&&parseInt(a)||"":a&&a>0&&a||"";d.seedValue=p}else{let p={seedNumber:Math.max(0,...c||[])+1,participantId:r};a&&(p.seedValue=a),l.seedAssignments||(l.seedAssignments=[]),l.seedAssignments.push(p)}return wne({tournamentId:e?.tournamentId,eventId:s?.eventId,drawDefinition:i,structure:l}),{...W}}function Q2({qualifyingParticipantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,structureId:n}){return K2({positionActionName:"qualifierDrawPositionAssignment",participantId:t,isQualifierPosition:!0,tournamentRecord:e,drawDefinition:i,drawPosition:r,structureId:n})}function rw({targetRoundNumber:t,finishingPosition:e,drawDefinition:i,structureId:r,linkType:n}){let{links:a}=Vv({drawDefinition:i,structureId:r})||{},s=(a?.target||[]).filter(({linkType:o})=>o===n).filter(({target:o})=>!t||t===o.roundNumber).map(o=>{let l=o.source.structureId,{structure:u}=tt({structureId:l,drawDefinition:i});if(!(e&&u?.finishingPosition!==e))return o}).filter(Boolean);return{sourceStructureIds:s.map(({source:o})=>o.structureId),relevantLinks:s}}var g$e=(t,e)=>{let i=[...new Set(e.slice(0,t.length))],r=[...i].sort((o,l)=>o-l),n=new Set,a=[];i.forEach(o=>{let l=t.indexOf(o);if(l!==-1&&!n.has(l))a.push(l),n.add(l);else{let u=r.indexOf(o),c=t.findIndex((d,p)=>!n.has(p));for(;n.has(c)&&c===-1&&n.size<t.length;)c=t.findIndex((d,p)=>!n.has(p)&&p>c);a.push(u),n.add(u)}});let s=t.filter((o,l)=>!n.has(l));return[...a,...s]};function rse({targetRoundNumber:t=1,tournamentRecord:e,drawDefinition:i,event:r,randomList:n}){let a=He({drawDefinition:i,event:r,tournamentRecord:e},[{[In]:!0,[Bc]:!0,[hr]:!0}]);if(a.error)return a;let s=[],o=[],l=i.structures?.find(g=>g.stage===Ae&&g.stageSequence===1);if(!l)return q({result:{error:Z$}});let u=(Dt({tournamentRecord:e,drawDefinition:i,structure:l,event:r}).appliedPolicies??{})[yu]?.requireCompletedStructures,{qualifierPositions:c,positionAssignments:d}=pr({structure:l});if(!c.length)return q({result:{error:sB}});let p=Ce(0,c.length);n&&(p=g$e(p,n));let f=d.map(g=>g.participantId).filter(Boolean),{relevantLinks:m}=rw({structureId:l.structureId,targetRoundNumber:t,linkType:mu,drawDefinition:i})||{},{relevantLinks:h}=rw({structureId:l.structureId,targetRoundNumber:t,linkType:fu,drawDefinition:i})||{};for(let g of m){let I=i.structures?.find(w=>w.structureId===g.source.structureId);if(I?.stage!==ze)continue;let v=Su({structureId:g.source.structureId,drawDefinition:i});if(!u||v){let w=I.qualifyingRoundNumber,{matchUps:y}=At({matchUpFilters:{...w&&{roundNumbers:[w]},isCollectionMatchUp:!1,hasWinningSide:!0},afterRecoveryTimes:!1,inContext:!0,structure:I});for(let b of y){let S=b.matchUpStatus==="BYE"&&b.sides?.find(({participantId:T})=>T),U=b.sides.find(T=>T?.sideNumber===b.winningSide);if(U||S){let{participantId:T}=U||S||{};T&&!f.includes(T)&&o.push(T)}}}}for(let g of h){let I=i?.structures?.find(v=>v.structureId===g.source.structureId);if(I?.stage===ze&&Su({structureId:g.source.structureId,drawDefinition:i})){let{positionAssignments:v}=Kt({structure:I}),w=v?.map(y=>{let b=y.participantId,S=ht({element:y,name:Tc}).extension?.value;return S?{participantId:b,groupOrder:S?.groupOrder}:{}}).filter(({groupOrder:y,participantId:b})=>y===1&&!f.includes(b)).map(({participantId:y})=>y)??[];w&&o.push(...w)}}return o.length?(p.forEach((g,I)=>{let v=o[I],w=c[g].drawPosition;v&&Q2({qualifyingParticipantId:v,structureId:l.structureId,drawPosition:w,tournamentRecord:e,drawDefinition:i})?.success&&s.push({participantId:v,drawPosition:w})}),q({result:je({...W,assignedParticipants:s})})):q({result:{error:Jte}})}function nse({drawDefinition:t,orderMap:e}){return t?((typeof e!="object"||!Object.values(e).every(i=>lt(i)))&&q({result:{error:re},context:{orderMap:e}}),t.structures||(t.structures=[]),t.structures.forEach(i=>{let r=e[i.structureId];r&&(i.structureOrder=r)}),t.structures.sort((i,r)=>gI(i.structureOrder)-gI(r.structureOrder)),{...W}):{error:$e}}function nN({drawDefinition:t}){let e=t.structures??[],i=t.links??[],r=new Map,n=g=>{let I=r.get(g)||r.set(g,{drawSources:[],drawTargets:[],progeny:[],sources:[],targets:[]})&&r.get(g);if(I&&!I?.stage){let v=e.find(w=>w.structureId===g);I.stage=v?.stage}return I},a={},s={},o=i.map(g=>{let I=g.source.structureId,v=g.target.structureId,w=n(I),y=n(v);return[Vp,As,DM,Bp].includes(g.target.feedProfile)?(w?.targets.push(v),y?.sources.push(I)):g.target.feedProfile===ho&&(y?.drawSources.push(I),w?.drawTargets.push(v)),s[v]=s[v]||g.target.feedProfile===ho,a[v]=nt([...a[v]||[],I]).filter(Boolean),[g.source.structureId,g.target.structureId]});for(let g of r.keys()){let I=r.get(g);if(I){let v=I.targets??[];for(;v.length;){let w=v.pop(),y=w&&r[w];y?.targets?.length?v.push(...y.targets):y&&(I.rootStage=y.stage)}if(I.rootStage||(I.rootStage=I.stage),!I.targets?.length){let w=I.sources??[];for(;w.length;){let y=w.pop(),b=y&&r[y];if(b?.sources?.length){for(let S of b.sources)I.progeny?.includes(S)||I.progeny?.push(S);w.push(...b.sources)}}}}}let l=0;for(let g of r.keys()){let I=r.get(g);if(I&&I.rootStage===ze){let v=[I.drawTargets?.[0]],w=0;for(;v.length;){w+=1;let y=v.pop(),b=y?r.get(y):void 0;b?.drawTargets?.length&&v.push(b.drawTargets[0])}I.distanceFromMain=w,w>l&&(l=w)}}let u=o.length;Ce(0,Math.ceil(u/2)).forEach(()=>{o=Ce(0,u).map(g=>{let I=o[g],v=o.reduce((w,y)=>xn(I,y)?w.concat(...y):w,[])||[];return nt(I.concat(...v))})});let c=o[0],d=(g,I)=>Li(g,I).length===g.length,p=o.slice(1).reduce((g,I)=>g&&d(I,c),!0),f=[c].filter(Boolean),m=[c].filter(Boolean);e.forEach(g=>{let{structureId:I,stage:v}=g;f.find(w=>w.includes(I))||(f.push([I]),v!==Rr&&m.push([I]))});let h=p&&m.length===1;return!i?.length&&e.length===1&&n(e[0].structureId),{structureProfiles:Object.fromEntries(r),allStructuresLinked:h,maxQualifyingDepth:l,sourceStructureIds:a,hasDrawFeedProfile:s,structureGroups:f}}function ase({drawDefinition:t}){let{maxQualifyingDepth:e,structureProfiles:i}=nN({drawDefinition:t});for(let r of t.structures){let n=i[r.structureId];n.distanceFromMain&&(r.stageSequence=e+1-n.distanceFromMain)}return{...W}}function Z2(t){let e=He(t,[{[hr]:!0,[In]:!0}]);if(e.error)return e;let{tournamentRecord:i,drawDefinition:r,structure:n,link:a}=t;return I$e({tournamentId:i.tournamentId,drawDefinition:r,structure:n,link:a})}function I$e(t){let e=He(t,[{[In]:!0,[MM]:!0},{link:!0,[qn]:Kn,[cte]:J$}]);if(e.error)return e;let{drawDefinition:i,tournamentId:r,structure:n,eventId:a,link:s}=t,o=s.target.structureId,l=tt({drawDefinition:i,structureId:o});if(l.error)return q({stack:"attachQualifyingStructure",context:{targetStructureId:o},result:l});i.structures||(i.structures=[]),i.links||(i.links=[]),i.structures.push(n),i.links.push(s),ase({drawDefinition:i});let u=At({structure:n})?.matchUps||[];return Dd({drawDefinition:i,tournamentId:r,matchUps:u,eventId:a}),ii({drawDefinition:i,structureIds:[n.structureId]}),{...W}}function sse({drawDefinition:t,structureDetails:e}){if(!Array.isArray(e))return{error:re};if(!t)return{error:$e};let i=Object.assign({},...e.map(r=>{if(!wt(r))return;let{structureId:n,structureName:a}=r||{};if(!(!n||!a))return{[n]:a}}).filter(Boolean));if(!Object.values(i).length)return{error:Je};for(let r of t.structures||[]){let n=i[r.structureId];if(n&&(r.structureName=n),r.structures)for(let a of r.structures){let s=i[a.structureId];s&&(a.structureName=s)}}return{...W}}function eV({drawDefinition:t,timeItem:e}){if(!t)return{error:_a};if(!e)return{error:dB};let i=e&&Object.keys(e),r=["itemType","itemValue"];if(r.filter(a=>i.includes(a)).length!==r.length)return{error:cB};t.timeItems||(t.timeItems=[]);let n=new Date().toISOString();return Object.assign(e,{createdAt:n}),t.timeItems.push(e),mU({drawDefinition:t}),{...W}}function ose(t){let{tournamentRecord:e,drawDefinition:i,structureId:r,event:n}=t,a=He(t,[{drawDefinition:!0,structureId:!0}]);if(a.error)return a;let s=i.structures??[],o=s.find(I=>I.structureId===r);if(!o)return{error:vi};let l=s.find(({stage:I,stageSequence:v})=>I===Ae&&v===1),u=r===l?.structureId,c=s.filter(({stage:I})=>I===ze).map(Pa("structureId"));if(u&&!c.length)return{error:pte};let d=c.includes(r),p=v$e({isQualifyingStructure:d,structure:o,...t});if(p?.error)return p;let{structureIdsToRemove:f,relatedStructureIdsMap:m}=b$e({qualifyingStructureIds:c,isQualifyingStructure:d,isMainStageSequence1:u,mainStageSequence1:l,drawDefinition:i,structureId:r}),{removedMatchUpIds:h,removedStructureIds:g}=w$e({relatedStructureIdsMap:m,qualifyingStructureIds:c,isMainStageSequence1:u,mainStageSequence1:l,drawDefinition:i,structureIdsToRemove:f,structureId:r});if(y$e({removedMatchUpIds:h,drawDefinition:i}),u){let I=(l.matchUps??[])?.map(Pa("matchUpId"));h.push(...I),l.positionAssignments=[],l.seedAssignments=[],l.matchUps=[],l.extensions&&(l.extensions=[])}return d&&ase({drawDefinition:i}),ku({tournamentId:e?.tournamentId,matchUpIds:h,action:"removeStructure",eventId:n?.eventId,drawDefinition:i}),ii({drawDefinition:i,eventId:n?.eventId}),{...W,removedMatchUpIds:h,removedStructureIds:g}}function v$e({isQualifyingStructure:t,tournamentRecord:e,drawDefinition:i,structureId:r,structure:n,event:a,force:s}){let o=[r];if(t){let l=c=>i.links?.find(d=>d.target.structureId===c),u=l(r)?.source.structureId;for(;u;)o.push(u),u=l(u)?.source.structureId}if(Zi({matchUpFilters:{structureIds:o},drawDefinition:i}).matchUps?.some(({score:l})=>fr({score:l}))){let l=Dt({tournamentRecord:e,drawDefinition:i,structure:n,event:a})?.appliedPolicies;if(!(s??l?.[ms]?.allowDeletionWithScoresPresent?.structures))return{error:tU}}return{...W}}function y$e({removedMatchUpIds:t,drawDefinition:e}){let{matchUps:i}=Zi({drawDefinition:e});i?.forEach(r=>{r.winnerMatchUpId&&t.includes(r.winnerMatchUpId)&&delete r.winnerMatchUpId,r.loserMatchUpId&&t.includes(r.loserMatchUpId)&&delete r.loserMatchUpId})}function b$e({qualifyingStructureIds:t,isQualifyingStructure:e,isMainStageSequence1:i,mainStageSequence1:r,drawDefinition:n,structureId:a}){let s=(n.structures??[]).map(Pa("structureId")),o=c=>n.links?.map(d=>d.source.structureId===c&&d.target.structureId!==r?.structureId&&d.target.structureId).filter(Boolean)??[],l=c=>n.links?.map(d=>t.includes(d.source.structureId)&&d.target.structureId===c&&d.source.structureId).filter(Boolean)??[],u=new Map;return s.forEach(c=>u.set(c,e?l(c):o(c))),{structureIdsToRemove:i?u.get(a):[a],relatedStructureIdsMap:u}}function w$e({relatedStructureIdsMap:t,qualifyingStructureIds:e,isMainStageSequence1:i,mainStageSequence1:r,drawDefinition:n,structureIdsToRemove:a,structureId:s}){let o=[],l=[];for(;a?.length;){let u=a.pop();l.push(...T$e({idBeingRemoved:u,drawDefinition:n}));let c=U$e({qualifyingStructureIds:e,isMainStageSequence1:i,idBeingRemoved:u,drawDefinition:n,structureId:s});o.push(...c.removedStructureIds);let d=S$e({relatedStructureIdsMap:t,mainStageSequence1:r,idBeingRemoved:u,structureId:s});d?.length&&a.push(...d)}return{removedMatchUpIds:l,removedStructureIds:o}}function S$e({idBeingRemoved:t,relatedStructureIdsMap:e,mainStageSequence1:i,structureId:r}){return t&&e.get(t)?.filter(n=>n!==i?.structureId||r===i.structureId)}function U$e({qualifyingStructureIds:t,isMainStageSequence1:e,idBeingRemoved:i,drawDefinition:r,structureId:n}){let a=[];return r.links=r.links?.filter(s=>s.source.structureId!==i&&s.target.structureId!==i)??[],(!e||e&&t.length||i!==n)&&(r.structures=(r.structures??[]).filter(s=>(i&&i===s.structureId&&a.push(i),s.structureId!==i))),{removedStructureIds:a}}function T$e({idBeingRemoved:t,drawDefinition:e}){let{structure:i}=tt({structureId:t,drawDefinition:e}),r=At({structure:i}).matchUps;return KB(r)}function XP({stageSequence:t=1,drawDefinition:e,drawSize:i,stage:r}){if(!e)return{error:$e};if(!v2({drawDefinition:e,stage:r}))return{error:hf};let n=TLe({drawDefinition:e,stage:r}),{qualifiersCount:a}=Hv({drawDefinition:e,stageSequence:t,stage:r}),s=n+a;if(i<s)return{error:Ite};let{entryProfile:o}=I2({attributes:[{[r]:{drawSize:i}}],drawDefinition:e});return ii({drawDefinition:e}),{...W,entryProfile:o}}function lse({qualifiersCount:t=0,drawDefinition:e,stage:i}){return e?v2({drawDefinition:e,stage:i})?(I2({attributes:[{[i]:{qualifiersCount:t}}],drawDefinition:e}),ii({drawDefinition:e}),{...W}):{error:hf}:{error:$e}}function D$e({drawDefinition:t,drawSize:e}){if(!t)return{error:$e};let i=XP({stage:Rr,stageSequence:1,drawDefinition:t,drawSize:e});return i.error?i:(ii({drawDefinition:t}),{...W})}function use(t){return D$e(t)}function cse({tournamentRecord:t,drawDefinition:e,event:i,structureId:r}){if(!e)return{error:$e};let n=e.structures?.find(s=>s.stage===ze&&s.structureId===r);if(!n)return{error:vi};if(n.matchUps?.some(({matchUpStatus:s,score:o})=>fr({score:o})??Ki.includes(s)))return{error:tU};let a=n.matchUps?.map(({matchUpId:s})=>s)||[];return n.positionAssignments=[],n.seedAssignments=[],n.matchUps=[],ku({tournamentId:t?.tournamentId,action:"resetVoluntaryConsolationStructure",matchUpIds:a,drawDefinition:e}),ii({tournamentId:t?.tournamentId,eventId:i?.eventId,drawDefinition:e,structureIds:[n.structureId]}),{...W}}var P$e="qualifierDrawPositionAssignment",E$e="withdrawParticipantAtDrawPosition",R$e="alternateDrawPositionAssignment",C$e="luckyLoserDrawPositionAssignment",uq="removeDrawPositionAssignment",dse="swapDrawPositionAssignments",M$e="modifyPairAssignment",N$e="adHocPositionSwap",A$e="modifyParticipantOtherName",cq="assignDrawPosition",k$e="removeSeededParticipant",O$e="assignDrawPositionBye",x$e="modifySeedAssignment",pse="addPenalty",tV="MODIFY_PAIR",aN="QUALIFIER",iV="ALTERNATE",rV="WITHDRAW",zm="ASSIGN",Nx="REMOVE",nV="LUCKY",Xy="REMOVE_SEED",sN="SWAP",nw="NICKNAME",gm="SEED_VALUE",qm="PENALTY",F$e={MODIFY_PAIR_ASSIGNMENT:tV,QUALIFYING_PARTICIPANT:aN,ALTERNATE_PARTICIPANT:iV,WITHDRAW_PARTICIPANT:rV,ASSIGN_PARTICIPANT:zm,LUCKY_PARTICIPANT:nV,REMOVE_ASSIGNMENT:Nx,SWAP_PARTICIPANTS:sN,ADD_NICKNAME:nw,REMOVE_SEED:Xy,ADD_PENALTY:qm,ASSIGN_BYE:"BYE",SEED_VALUE:gm};function fse({tournamentRecord:t,drawDefinition:e,drawPositions:i,structureId:r,event:n}){if(!e)return{error:$e};if(!r)return{error:qa};if(i?.length!==2)return{error:re,drawPositions:i};let a=kr({drawDefinition:e}),{matchUps:s}=Zi({inContext:!0,drawDefinition:e,matchUpsMap:a}),{structure:o}=tt({drawDefinition:e,structureId:r});if(!o)return{error:vi};let l=Dt({tournamentRecord:t,drawDefinition:e,event:n}).appliedPolicies??{},u;if(o.structureType===gn?u=$$e({inContextDrawMatchUps:s,tournamentRecord:t,drawDefinition:e,drawPositions:i,matchUpsMap:a,structure:o,event:n}):u=L$e({inContextDrawMatchUps:s,tournamentRecord:t,drawDefinition:e,drawPositions:i,matchUpsMap:a,structure:o,event:n}),u.error)return u;if(p2({structure:o,drawPositions:i}),hU({appliedPolicies:l,drawDefinition:e,positionAction:{name:dse,drawPositions:i,structureId:r}}),Dc({tournamentId:t?.tournamentId,drawDefinition:e,structure:o,event:n}),n.eventType===Ua){let c=At({matchUpFilters:{matchUpTypes:[La]},inContext:!0,structure:o}).matchUps.filter(p=>p.drawPositions?.some(f=>i.includes(f))),d=At({matchUpFilters:{matchUpTypes:[La]},structure:o}).matchUps;c.forEach(p=>{(p.sides||[]).forEach(f=>{let m=f?.drawPosition;if(i.includes(m)){let h=f.participantId,g=d.find(({matchUpId:v})=>v===p.matchUpId),I=p?.sides?.reduce((v,w,y)=>w.drawPosition===m?y:v,void 0);z2({inContextTargetMatchUp:p,drawPositionSideIndex:I,teamParticipantId:h,tournamentRecord:t,drawDefinition:e,matchUp:g,event:n})}})})}return ii({drawDefinition:e,structureIds:[r]}),{...W}}function L$e({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPositions:r,matchUpsMap:n,structure:a,event:s}){let o=a?.positionAssignments.filter(u=>r?.includes(u.drawPosition));if(!o)return{error:re,structure:a,info:"Missing positionAssignments"};if(o.filter(({bye:u})=>u).length===2)return{...W};if(o.filter(({qualifier:u})=>u).length===2)return{...W};let l=o.some(({qualifier:u})=>u);return o.some(({bye:u})=>u)&&!l?mse({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:o,matchUpsMap:n,structure:a,event:s}):_$e({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:o,matchUpsMap:n,structure:a,event:s})}function mse({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:r,matchUpsMap:n,structure:a,event:s}){let o=r.find(({bye:m})=>m),l=r.find(({participantId:m})=>m),u=o.drawPosition,{participantId:c,drawPosition:d}=l,{structureId:p}=a,f=iw({drawPosition:u,inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:p,matchUpsMap:n});return f.error||(f=iw({drawPosition:d,inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:p,matchUpsMap:n}),f.error)||(Ja({drawPosition:d,tournamentRecord:e,drawDefinition:i,structureId:p,matchUpsMap:n,event:s}),f=hl({drawPosition:u,inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:p,participantId:c,matchUpsMap:n,event:s}),f.error)?f:{...W}}function _$e({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:r,matchUpsMap:n,structure:a,event:s}){let o=Object.assign({},...r.map((l,u)=>{let{drawPosition:c}=l,d={...r[1-u],drawPosition:c};return{[c]:d}}));return a.positionAssignments=a.positionAssignments.map(l=>o[l.drawPosition]||l),Y2({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,matchUpsMap:n,assignments:r,structure:a,event:s}),{...W}}function $$e({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPositions:r,matchUpsMap:n,structure:a,event:s}){let o=a.structures?.reduce((u,c)=>{let d=c?.positionAssignments.filter(p=>r?.includes(p.drawPosition));return d&&u.push(...d),u},[]);if(o.filter(({bye:u})=>u).length===2)return{...W};if(o.filter(({qualifier:u})=>u).length===2)return{...W};Y2({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,matchUpsMap:n,assignments:o,structure:a,event:s});let l=o.some(({qualifier:u})=>u);if(o.some(({bye:u})=>u)&&!l)mse({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:o,matchUpsMap:n,structure:a,event:s});else{let u=Oe(o,!1,!0);o.forEach((c,d)=>{let p=u[1-d].participantId;c.qualifier=u[1-d].qualifier,c.participantId=p})}return{...W}}function hse({tournamentRecord:t,drawDefinition:e,participantId:i,structureId:r}){let n="removeSeededParticipant";if(!t)return{error:ve};if(!e)return{error:$e};let a=(e.structures??[]).find(s=>s.structureId===r);return a?!a.stage||![Ae,ze].includes(a.stage)||a.stage===Ae&&a.stageSequence!==1?q({result:{error:ff},stack:n}):a.seedAssignments?.find(s=>s.participantId===i)?{...W}:q({info:"participant not seeded",result:{error:Br},context:{participantId:i}}):q({result:{error:vi},stack:n})}function BU({targetEntryRound:t=1,finishingPositions:e,sourceRoundNumber:i,sourceStructureId:r,targetStructureId:n,linkType:a=mu}){return!r||!n?{error:qa}:{link:je({linkType:a,source:{roundNumber:i,structureId:r,finishingPositions:e},target:{feedProfile:ho,roundNumber:t,structureId:n}})}}function Xh({matchUp:t,tieFormat:e,isMock:i,uuids:r}){let{collectionDefinitions:n}=e??{};return{tieMatchUps:(n??[]).map(a=>VU({matchUp:t,collectionDefinition:a,uuids:r,isMock:i})).filter(Boolean).flat()}}function VU({collectionPositionOffset:t=0,collectionDefinition:e,matchUpsLimit:i,matchUp:r,isMock:n,uuids:a}){let{matchUpCount:s,matchUpType:o,collectionId:l,processCodes:u}=e||{},c=i??s??0,d=p=>{if(!n&&!r?.isMock)return a?.pop()??Ct();let f=e?.collectionId;return a?.pop()??`${r?.matchUpId}-${f}-TMU-${p+1}`};return Ce(0,c).map(p=>{let f=t+p+1;return{sides:[{sideNumber:1},{sideNumber:2}],matchUpId:d(p),matchUpStatus:_i,collectionPosition:f,collectionId:l,processCodes:u,matchUpType:o,isMock:n}})}function aV({roundPosition:t,roundNumber:e,idPrefix:i,uuids:r}){return i?`${i}-${e}-${t}`:r?.pop()||Ct()}function JP({includeMatchUpType:t,matchUpType:e,roundNumber:i,matchUps:r,idPrefix:n,isMock:a,uuids:s,nodes:o}){let l=0,u=[],c=1,d=i-1,p=o?.length;for(;l<(p||0);){let f=o?.[l],m=o?.[l+1];d&&(f.roundNumber=d),m&&d&&(m.roundNumber=d);let h=aV({roundPosition:c,roundNumber:i,idPrefix:n,uuids:s}),g={roundPosition:c,children:[f,m],matchUpId:h};u.push(g);let I={drawPositions:g.children.map(v=>v?.drawPosition).filter(Boolean),matchUpStatus:_i,matchUpId:g.matchUpId,roundPosition:c,roundNumber:i};t&&e&&(I.matchUpType=e),a&&(I.isMock=!0),r.push(I),c++,l+=2}return{roundNodes:u,matchUps:r}}function gl({finishingPositionOffset:t,finishingPositionLimit:e,qualifyingRoundNumber:i,qualifyingPositions:r,matchUpType:n,roundLimit:a,idPrefix:s,drawSize:o,isMock:l,uuids:u}){if(isNaN(o)||o<2||r&&o<=r)return{matchUps:[],roundsCount:0};if(r&&(!Ro(o)||o%r)){let g=r;for(;g<o;)g=2*g;o=g}let c=r&&!(o%2)&&(!isNaN(r)||i&&!isNaN(i))&&(o/r===Math.round(o/r)||i&&o/i===Math.round(o/i));if(!Ro(o)&&!c)return{matchUps:[],roundsCount:0};let d=Ce(1,o+1).map(g=>({drawPosition:g})),p,f=[],m=1;for({roundNodes:p,matchUps:f}=JP({matchUpType:n,roundNumber:m,idPrefix:s,matchUps:f,isMock:l,nodes:d,uuids:u}),m++,a=a??i;p.length>1;)r&&p.length===r&&(a=m-1),{roundNodes:p,matchUps:f}=JP({nodes:p,matchUpType:n,roundNumber:m,idPrefix:s,matchUps:f,isMock:l,uuids:u}),m++;let h=m-1;return f=CU({finishingPositionOffset:t,finishingPositionLimit:e,roundsCount:h,roundLimit:a,matchUps:f}),a?f=f.filter(g=>a&&(g.roundNumber??0)<=a):a=m-1,{drawSize:o,matchUps:f,roundsCount:h,roundLimit:a}}function B$e(t,e){return t.drawDefinition?t.drawSize&&!lt(t.drawSize)||t.participantsCount&&!lt(t.participantsCount)||t.qualifyingPositions&&!lt(t.qualifyingPositions)?q({result:{error:re},stack:e}):t.drawSize?t.qualifyingPositions&&t.qualifyingPositions>=t.drawSize?q({result:{error:re},context:{drawSize:t.drawSize,qualifyingPositions:t.qualifyingPositions},stack:e}):null:q({result:{error:JS},context:{drawSize:t.drawSize},stack:e}):q({result:{error:$e},stack:e})}function V$e(t,e,i){let{structureProfiles:r}=nN({drawDefinition:t});return r[e]||q({result:{error:vi},context:{targetStructureId:e},stack:i})}function j$e(t){let{maxRoundNumber:e,structures:i,groupCount:r}=FU(t);return{qualifiersCount:r,roundLimit:e,structure:i[0],finishingPositions:[1]}}function G$e(t){let{drawSize:e,matchUps:i,roundLimit:r,roundsCount:n}=gl(t);r||(r=n);let a=ss({structureName:t.structureName,structureId:t.structureId,qualifyingRoundNumber:r,stage:ze,matchUpFormat:t.matchUpFormat,stageSequence:t.stageSequence,matchUpType:t.matchUpType,roundLimit:r,matchUps:i});t.roundTarget&&Ft({extension:{name:El,value:t.roundTarget},element:a});let s=i?.filter(o=>o.roundNumber===r)?.length??0;return{drawSize:e,structure:a,matchUps:i,roundLimit:r,qualifiersCount:s}}function sV(t){let e="generateQualifyingStructure",i=B$e(t,e);if(i)return i;let r=t.drawSize??W$(t.participantsCount),{hasExistingDrawDefinition:n,qualifyingRoundNumber:a,qualifyingPositions:s,targetStructureId:o,structureOptions:l,appliedPolicies:u,qualifyingOnly:c,drawDefinition:d,matchUpFormat:p,structureName:f,structureId:m,roundTarget:h,tieFormat:g,drawType:I,idPrefix:v,isMock:w,uuids:y}=t,b=V$e(d,o,e);if(b?.error)return b;let S=d.matchUpType,U=1,T=h?`${h}-`:"",P=typeof b=="object"&&"stage"in b&&b.stage===ze,D=u?.[wc]?.namingConventions?.pre??CLe[wc]?.namingConventions?.pre,E=P&&D?`${D}-`:"",R=f??(T?`${E}${Qr(ze)} ${T}`:`${E}${Qr(ze)}`),C,M,N,A,O;if(I===eo){let x=j$e({structureName:f??R,structureId:m??y?.pop(),hasExistingDrawDefinition:n,stage:ze,structureOptions:l,appliedPolicies:u,qualifyingOnly:c,stageSequence:U,matchUpType:S,roundTarget:h,tieFormat:g,idPrefix:v,drawSize:r,isMock:w,uuids:y});A=x.qualifiersCount,N=x.roundLimit,C=x.structure,O=x.finishingPositions}else{let x=G$e({qualifyingRoundNumber:a,qualifyingPositions:s,matchUpType:S,idPrefix:v,drawSize:r,isMock:w,uuids:y,structureName:f??R,structureId:m??y?.pop(),matchUpFormat:p,stageSequence:U,roundTarget:h});r=x.drawSize,C=x.structure,N=x.roundLimit,A=x.qualifiersCount}let k=I===eo?fu:mu,F=C&&N&&BU({sourceStructureId:C.structureId,sourceRoundNumber:N,targetStructureId:o,finishingPositions:O,linkType:k})?.link;return g&&(M=At({structure:C})?.matchUps||[],M?.forEach(x=>{let{tieMatchUps:L}=Xh({tieFormat:g,matchUp:x,isMock:w});Object.assign(x,{tieMatchUps:L,matchUpType:S})})),{qualifyingDrawPositionsCount:r,qualifiersCount:A,...W,structure:C,link:F}}function gse(t){if(!t.tournamentRecord)return{error:ve};let e=H$e(t);return e.error,e}function H$e(t){if(!t.drawDefinition)return{error:$e};if(!t.targetStructureId)return{error:qa};let e=sV(t);if(e.error)return e;let{structure:i,link:r}=e;return!i||!r?{error:re}:Z2({tournamentRecord:t.tournamentRecord,drawDefinition:t.drawDefinition,structure:i,link:r})}function Ise(t){let e=He(t,[{[In]:!0,[EM]:!0,[Pl]:!0},{[CFe]:!0,[qr]:d=>Number.isInteger(d)&&d>0},{[qr]:d=>Array.isArray(d)&&d.length===2&&d.every(ni),[Ba]:Ia,participantIds:!0}]);if(e.error)return e;let{drawDefinition:i,structureId:r,tournamentRecord:n,event:a}=t,{structure:s}=tt({drawDefinition:i,structureId:r});if(!s)return{error:vi};if(!Hn({structure:s}))return{error:ff};let o=d=>d.sides?.map(p=>p.participantId).some(p=>t.participantIds.includes(p)),l=d=>d.roundNumber===t.roundNumber,u=d=>!fr(d),c=(s?.matchUps??[]).filter(l).filter(u).filter(o);if(c.length!==2)return{error:Ia};for(let d of c){let p=d?.sides?.find(f=>t.participantIds.includes(f?.participantId));if(p){let f=t.participantIds.find(m=>m!==p?.participantId);p.participantId=f,Ut({tournamentId:n?.tournamentId,eventId:a?.eventId,drawDefinition:i,matchUp:d})}}return ii({drawDefinition:i,structureIds:[r]}),{...W}}function W$e({includeMatchUpType:t,drawPosition:e,roundNumber:i,matchUpType:r,idPrefix:n,matchUps:a,isMock:s,uuids:o,nodes:l,fed:u}){let c=l.length,d=e?e-c:void 0,p=Ce(0,c).map(h=>d?d+h:void 0),f=[];for(let h=0;h<c;h++){let g=p.shift(),I={drawPosition:g,fed:u+1,feed:!0},v=l[h];v.roundNumber=i-1;let w=aV({roundPosition:v.roundPosition,roundNumber:i,idPrefix:n,uuids:o}),y={roundPosition:v.roundPosition,drawPositions:[g],matchUpStatus:_i,roundNumber:i,matchUpId:w};t&&(y.matchUpType=r),s&&(y.isMock=!0),a.push(y);let b={children:[v,I]};f.push(b)}let m=e?e-c:void 0;return{roundNodes:f,matchUps:a,drawPosition:m}}function Rd(t){let e=t.drawSize,{feedRoundsProfile:i,feedRounds:r=0,skipRounds:n=0,baseDrawSize:a}=t,{linkFedFinishingRoundNumbers:s,finishingPositionOffset:o,linkFedRoundNumbers:l,feedsFromFinal:u,isConsolation:c,matchUpType:d,idPrefix:p,isMock:f,uuids:m,fmlc:h}=t;a=a??M(e);let g=z$e({drawSize:a}),I=g.length,v=0;if(i?.length)v=i.reduce((N,A)=>N+A,0);else if(e){let N=e-a;i=g.filter(A=>A<=N?(N-=A,!0):!1),v=i.reduce((A,O)=>A+O,0),r=i.length}else n>=I?r=0:u&&(r=I-u,n=0),i=g.filter((N,A)=>u&&!r||r&&A>=n+r||A<n?0:N),v=i.reduce((N,A)=>N+A,0),r=i.length;let w=[...g,...i].sort((N,A)=>A-N),y=w.length,b=[...(l??[]).map(N=>N-1),...(s??[]).map(N=>y-N)].map(N=>w[N]).reduce((N,A)=>N+A,0);v=v-b;let S=0,U=[],T,P=1,D=Ce(0,a).map((N,A)=>({drawPosition:A+1+v})),E=v+1;for(let N of g){if({roundNodes:T,matchUps:U}=JP({matchUpType:d,roundNumber:P,idPrefix:p,matchUps:U,isMock:f,nodes:D,uuids:m}),P++,i.includes(N)){let A=Sa(i)[N],O=Ce(0,A),k=y+1-P,F=s?.includes(k)??l?.includes(P);O.forEach(()=>{({roundNodes:T,matchUps:U,drawPosition:E}=W$e({drawPosition:!F&&E||void 0,nodes:T,matchUpType:d,roundNumber:P,idPrefix:p,matchUps:U,isMock:f,uuids:m,fed:S})),P++,S+=1})}D=T}y!==P-1&&console.log("ERROR");let R=a-v;U=CU({finishingPositionOffset:c?R:o,positionsFed:v,roundsCount:y,matchUps:U,fmlc:h});let C=T?.length?T[0]:T;return C&&(C.roundNumber=P-1,C.matchUps=U),{draw:C,matchUps:U,roundsCount:y};function M(N){let A=z$(N);return A>N?A/2:A}}function z$e({drawSize:t}){let e=Math.ceil(Math.log(t)/Math.log(2));return Ce(0,e).reverse().map(i=>Math.pow(2,i))}function Vg(t){let{finishingPositionOffset:e=0,addNameBaseToAttributeName:i,playoffStructureNameBase:r,finishingPositionNaming:n,finishingPositionLimit:a,playoffAttributes:s,stageSequence:o=1,exitProfile:l="0",exitProfileLimit:u,roundOffsetLimit:c,roundOffset:d=0,drawDefinition:p,staggeredEntry:f,sequenceLimit:m,stage:h=Ae,drawSize:g,idPrefix:I,isMock:v,uuids:w}=t;if(!(!s||!u||s?.[l])||g<2||m&&o>m)return{};let y=[],b=[],S=[],U=t.matchUpType??p?.matchUpType,T=e+1,P=e+g,D=`${T}-${P}`,E=s?.[l],R=r&&`${r} `||"",C=s?.[D]??n?.[D],M=t.structureName||C?.name||E?.name&&(i?`${R}${E?.name}`:E.name)||`${R}${D}`,N=C?.abbreviation??E?.abbreviation,A=t.structureId??E?.structureId??w?.pop(),O={idPrefix:I&&`${I}-${M}-RP`,finishingPositionOffset:e,matchUpType:U,drawSize:g,isMock:v,uuids:w},{matchUps:k}=f?Rd(O):gl(O),F=ss({structureAbbreviation:N,stageSequence:o,structureName:M,matchUpType:U,roundOffset:d,structureId:A,matchUps:k,stage:h});y.push(...k),b.push(F);let x=Math.ceil(Math.log(g)/Math.log(2)),L=c?Math.min(c-d,x):(!a||T<a)&&x||0;return g>2&&Ce(1,L+1).forEach(V=>$(V)),{structureId:F.structureId,matchUps:y,structureName:M,structures:b,links:S,...W};function $(V){let _=g/Math.pow(2,V);if(_<2)return;let B=g/Math.pow(2,V)+e;if(a&&B+1>a)return;let{structures:G,structureId:j,matchUps:K,links:Y}=Vg({finishingPositionOffset:B,exitProfile:`${l}-${V}`,roundOffset:d+V,stageSequence:o+1,drawSize:_,addNameBaseToAttributeName:i,playoffStructureNameBase:r,finishingPositionNaming:n,finishingPositionLimit:a,playoffAttributes:s,exitProfileLimit:u,roundOffsetLimit:c,drawDefinition:p,sequenceLimit:m,matchUpType:U,idPrefix:I,uuids:w,stage:h});if(F.structureId&&j){let X={linkType:hu,source:{roundNumber:V,structureId:F.structureId},target:{roundNumber:1,feedProfile:As,structureId:j}};Y&&F&&Y.push(X),Y?.length&&S.push(...Y)}return G?.length&&b.push(...G),K?.length&&y.push(...K),{structureId:j,childLinks:Y,structures:b}}}function oV({drawDefinition:t,matchUpsMap:e,structureId:i}){let r=tt({drawDefinition:t,structureId:i});if(r.error)return q({result:r});let{matchUps:n}=At({structure:r.structure,matchUpsMap:e});return{...Sn({matchUps:n}),matchUps:n,matchUpsMap:e}}function dq({finishingPositions:t,drawDefinition:e,structureId:i}){let{roundProfile:r}=oV({drawDefinition:e,structureId:i});return(r&&Object.keys(r))?.reduce((n,a)=>(vse(r?.[a]).forEach(s=>{t.forEach(o=>{q$e({position:o,rangeDefinition:s})&&(n[o]={roundNumber:a})})}),n),{})}function q$e({position:t,rangeDefinition:e}){if(!Array.isArray(e)||e.reduce((n,a)=>n||isNaN(a),!1))return!1;let[i,r]=e;return Ce(i,(r||i)+1).includes(t)}function vse(t){return[nt(t?.finishingPositionRange?.loser||[]),nt(t?.finishingPositionRange?.winner||[])]}function Y$e(t){return vse(t).map(e=>Ce(e[0],e[1]&&e[1]+1||e[0]+1))}function Yv({drawDefinition:t,structureIds:e,matchUpsMap:i}){if(e&&!Array.isArray(e))return{error:re,context:{structureIds:e}};if(!t)return{error:$e};e=e??(t.structures??[]).filter(a=>a.stage!==ze).map(({structureId:a})=>a);let r=e.map(a=>{let{roundProfile:s}=oV({drawDefinition:t,matchUpsMap:i,structureId:a});return(s&&Object.values(s))?.map(Y$e).flat()}).flat(),n=r.filter(a=>a?.length===1).sort(nr).flat();return{positionsNotPlayedOff:nt(r.flat()).filter(a=>!n.includes(a)),positionsPlayedOff:n}}function yse({excludeRoundNumbers:t=[],playoffPositions:e=[],drawDefinition:i,structureId:r}){if(!i)return{error:$e};if(!r)return{error:qa};if(!e)return{error:Je,info:"missing playoffPositions"};let n=Yv({drawDefinition:i});if(n.error)return n;let a=n.positionsPlayedOff,s=e.filter(I=>!a.includes(I)),o=dq({finishingPositions:s,drawDefinition:i,structureId:r}),l=Object.values(o).reduce((I,v)=>I.includes(v.roundNumber)?I:I.concat(v.roundNumber),[]).map(I=>Ke(I)).filter(I=>!t.includes(I)),u=dq({finishingPositions:a,drawDefinition:i,structureId:r}),c=u?Object.values(u):[],d=u?c.reduce((I,v)=>I.includes(v.roundNumber)?I:I.concat(v.roundNumber),[]).map(I=>Ke(I)):[],p=l.filter(I=>!d.includes(I)).sort(nr),{roundProfile:f}=oV({drawDefinition:i,structureId:r}),m=p.map(I=>{let v=f?.[I].finishingPositionRange.loser,[w,y]=v??[0,0];return Ce(w,(y||w)+1)}).flat().sort(nr),{playoffRoundsRanges:h}=K$e({playoffSourceRounds:p,roundProfile:f}),g=[...p,...d];return{playoffPositionsReturned:m,playedOffSourceRounds:d,playoffRoundsRanges:h,playoffSourceRounds:p,sourceRounds:g,roundProfile:f}}function K$e({playoffSourceRounds:t,roundProfile:e}){return{playoffRoundsRanges:t.map(i=>{let r=e[i].finishingPositionRange.loser,[n,a]=r,s=Ce(n,(a||n)+1);return{finishingPositionRange:r.join("-"),finishingPositions:s,roundNumber:i}})}}function jU({drawDefinition:t,structureId:e}){if(!t)return{error:$e};let{matchUps:i,matchUpsMap:r}=An({inContext:!0,drawDefinition:t}),{positionsNotPlayedOff:n,positionsPlayedOff:a}=Yv({drawDefinition:t,matchUpsMap:r}),{structures:s}=io({drawDefinition:t}),o=s.filter(u=>!e&&u.stage!==Rr||u.structureId===e),l={};for(let u of o){let c=u?.structureId,d=X$e({playoffPositions:n,drawDefinition:t,structure:u,matchUps:i}),{error:p,...f}=d;if(p)return d;l[c]={structureId:c,...f}}return e?{positionsPlayedOff:a,...l[e]}:{availablePlayoffProfiles:Object.values(l),availablePlayoffRounds:Object.values(l),positionsPlayedOff:a}}function X$e({playoffPositions:t,drawDefinition:e,structure:i,matchUps:r}){let n=i?.structureId,{links:a}=Vv({drawDefinition:e,structureId:n});if(i.structureType===gn||i.structures){let f=Kt({structure:i})?.positionAssignments?.length,m=i.structures.length,h=(f??0)/m,g=a.source?.flatMap(({source:D})=>D?.finishingPositions||[])||[],I=Ce(1,h+1).filter(D=>!g.includes(D)),v=r.find(D=>D.containerStructureId===n&&D.finishingPositionRange)?.finishingPositionRange?.winner||[0,1],w=a?.source.map(({target:D})=>D.structureId),{positionsPlayedOff:y=[],positionsNotPlayedOff:b=[]}=Yv({structureIds:w,drawDefinition:e}),S=new Set([...y,...b]),U=Ce(v[0],v[1]+1).filter(D=>!S.has(D)),T=wr(U,U.length/I.length),P=I.map((D,E)=>{let R=T[E],C=[Math.min(...R||[]),Math.max(...R||[])].join("-");return{finishingPosition:D,finishingPositions:R,finishingPositionRange:C}});return{positionsNotPlayedOff:U,playoffFinishingPositionRanges:P,finishingPositionsAvailable:I,finishingPositionsPlayedOff:g,positionsPlayedOff:y,groupCount:m,groupSize:h}}let s=a?.source?.filter(f=>f.linkCondition!==fl).map(f=>f.source?.roundNumber)||[],o=a?.source?.filter(f=>f.linkCondition===fl).map(f=>f.source?.roundNumber)||[],l=yse({excludeRoundNumbers:s,playoffPositions:t,drawDefinition:e,structureId:n}),u=l?.playoffSourceRounds?[...l?.playoffSourceRounds||[]]:void 0,c=[...l?.playoffRoundsRanges||[]],{roundProfile:d,error:p}=l;for(let f of o){let m=a?.source.find(w=>w.source.roundNumber===f),h=m?.target.roundNumber,g=m?.target.structureId,I=r.filter(({roundNumber:w,structureId:y})=>y===g&&w===h),v=I.filter(({sides:w})=>w.find(y=>y.participantFed&&!y.participantId)).length;if(u&&v===I.length){u.push(f);let w=d?.[f]?.finishingPositionRange?.loser;if(w){let y=Math.min(...w),b=y+v,S=Ce(y,b),U={finishingPositionRange:[y,b-1].join("-"),finishingPositions:S,roundNumber:f};c.push(U)}}}return u&&u.sort(nr),c.sort((f,m)=>f.roundNumber-m.roundNumber),{playoffRounds:u,playoffRoundsRanges:c,error:p}}function J$e({playoffGroups:t,drawDefinition:e,structureId:i}){if(!e)return{error:$e};if(!ni(i)||!Array.isArray(t))return{error:re};let r=t.map(({finishingPositions:n})=>n).flat();return{positionRangeMap:jU({drawDefinition:e,structureId:i}).playoffFinishingPositionRanges?.filter(n=>r.includes(n.finishingPosition))?.reduce((n,a)=>(n[a.finishingPosition]=a,n),{})}}function bse(t){let{finishingPositionOffset:e=0,playoffAttributes:i,stageSequence:r=1,staggeredEntry:n,structureName:a,stage:s=Ae,matchUpType:o,structureId:l,idPrefix:u,drawSize:c,isMock:d,uuids:p}=t,f={finishingPositionOffset:e,matchUpType:o,drawSize:c,idPrefix:u,isMock:d,uuids:p},{matchUps:m}=n?Rd(f):gl(f),h=ss({structureName:a||i?.["0"]?.name||Qr(Ae),structureId:l||p?.pop(),stageSequence:r,matchUpType:o,matchUps:m,stage:s}),g=[h],I=[];if(c>2){let v=c/2,{matchUps:w}=gl({finishingPositionOffset:e+v,idPrefix:u&&`${u}-c`,drawSize:v,matchUpType:o,isMock:d}),y=Qr(tn),b=i?.["0-1"]?.name??t.consolationStructureName??(a?`${a} ${y}`:y),S=ss({structureName:b,matchUps:w,structureId:p?.pop(),stage:tn,stageSequence:1,matchUpType:o});g.push(S);let U={linkType:hu,source:{roundNumber:1,structureId:h.structureId},target:{roundNumber:1,feedProfile:As,structureId:S.structureId}};I.push(U)}return{...W,structures:g,links:I}}function wse({consolationStructure:t,roundOffset:e=0,mainStructure:i,roundsCount:r,feedPolicy:n,fmlc:a}){let s=t.matchUps.reduce((u,c)=>(c.drawPositions||[]).filter(Boolean).length&&!u.includes(c.roundNumber)?u.concat(c.roundNumber):u,[]),o=n?.roundGroupedOrder||[],l=n?.roundFeedProfiles;return Ce(1+e,r+1+e).map(u=>{let c=l?.[u-1]?l[u-1]:u%2&&As||Vp,d=u-e<=2?u-e:(u-e-2)*2+2,p={linkType:hu,source:{roundNumber:u,structureId:i.structureId},target:{feedProfile:c,roundNumber:d,structureId:t.structureId}},f=o[u-1];return f&&(p.target.groupedOrder=f),oa()&&(p.source.structureName=i.structureName,p.target.structureName=t.structureName),u===2&&a&&(p.linkCondition=fl,p.target.feedProfile=As),s.includes(d)?p:void 0}).filter(Boolean)}function Sse(t){let{playoffStructureNameBase:e,finishingPositionOffset:i,stageSequence:r=1,playoffAttributes:n,structureNameMap:a,staggeredEntry:s,stage:o=Ae,matchUpType:l,structureId:u,drawSize:c,idPrefix:d,isMock:p,uuids:f}=t,m={finishingPositionOffset:i,matchUpType:l,drawSize:c,idPrefix:d,isMock:p,uuids:f},{matchUps:h,roundsCount:g}=s?Rd(m):gl(m),I=t.structureName??n?.["0"]?.name??Qr(Ae),v=cd({structureId:u||f?.pop(),structureName:I,stageSequence:r,matchUpType:l,matchUps:h,stage:o}),w=[v],y=[];if(c>2){let b=[0,2].slice(0,c/16).map((S,U)=>{let T=U+1,{consolationStructure:P}=Q$e({idPrefix:d&&`${d}-c${U}`,structureId:f?.pop(),playoffStructureNameBase:e,playoffAttributes:n,structureNameMap:a,stageSequence:T,roundOffset:S,matchUpType:l,drawSize:c,isMock:p,index:U,uuids:f});w.push(P);let D=wse({consolationStructure:P,roundsCount:2,mainStructure:v,roundOffset:S});return{consolationStructure:P,links:D}}).map(S=>S.links).flat();if(y.push(...b),c>=4&&c<=16||c>32){let{matchUps:S}=gl({idPrefix:d&&`${d}-p3t4`,finishingPositionOffset:2,drawSize:2,matchUpType:l,isMock:p}),U=n?.["3-4"]?.name??Qr(Ti),T=a?.[U]||U,P=e?`${e} ${T}`:T,D=cd({structureId:f?.pop(),matchUps:S,stageSequence:2,stage:Ti,structureName:P,matchUpType:l}),E={linkType:hu,source:{roundNumber:g-1,structureId:v.structureId},target:{structureId:D.structureId,feedProfile:As,roundNumber:1}};w.push(D),y.push(E)}}return{structures:w,links:y,...W}}function Q$e({playoffStructureNameBase:t,stageSequence:e=1,playoffAttributes:i,structureNameMap:r,roundOffset:n=0,matchUpType:a,structureId:s,idPrefix:o,drawSize:l,isMock:u,index:c,uuids:d}){let p=l/(2*Math.pow(2,n)),{matchUps:f,roundsCount:m}=Rd({finishingPositionOffset:p,baseDrawSize:p,isConsolation:!0,feedRounds:1,matchUpType:a,idPrefix:o,isMock:u,uuids:d}),h=c===0&&i?.["0-1"]?.name||c===1&&i?.["0-3"]?.name||`${Qr(tn)} ${c+1}`,g=r?.[h]||h,I=t?`${t} ${g}`:g;return{consolationStructure:cd({matchUps:f,stage:tn,structureName:I,stageSequence:e,matchUpType:a,structureId:s}),consolationRoundsCount:m}}function _f(t){let{finishingPositionOffset:e,stageSequence:i=1,playoffAttributes:r,feedsFromFinal:n,staggeredEntry:a,structureName:s,stage:o=Ae,structureId:l,matchUpType:u,skipRounds:c,feedRounds:d,idPrefix:p,drawSize:f,isMock:m,uuids:h,fmlc:g}=t,I=t.feedPolicy||t.policyDefinitions?.[EI]||t.appliedPolicies?.[EI],v={finishingPositionOffset:e,matchUpType:u,skipRounds:c,drawSize:f,idPrefix:p,isMock:m,uuids:h},{matchUps:w}=a?Rd(v):gl(v),y=ss({structureName:s||r?.["0"]?.name||Qr(Ae),structureId:l||h?.pop(),stageSequence:i,matchUpType:u,matchUps:w,stage:o}),b=[y],S=[],U=f/2,{matchUps:T,roundsCount:P}=Rd({finishingPositionOffset:U,idPrefix:p&&`${p}-c`,isConsolation:!0,feedsFromFinal:n,baseDrawSize:U,matchUpType:u,feedRounds:d,skipRounds:c,isMock:m,uuids:h,fmlc:g});if(f>2){let D=r?.["0-1"]?.name??Qr(tn),E=t.playoffStructureNameBase?`${t.playoffStructureNameBase} ${D}`:D,R=ss({matchUps:T,structureId:h?.pop(),stage:tn,stageSequence:1,structureName:E,matchUpType:u});b.push(R);let C=wse({consolationStructure:R,mainStructure:y,roundsCount:P,feedPolicy:I,fmlc:g});S.push(...C)}return{...W,structures:b,links:S}}function Use({requireSequential:t=!0,playoffMatchUpFormat:e,playoffAttributes:i,sourceStructureId:r,policyDefinitions:n,stageSequence:a,drawDefinition:s,playoffGroups:o,matchUpType:l,feedPolicy:u,groupCount:c,idPrefix:d,isMock:p,uuids:f}){u=u||n?.[EI];let m="processPlayoffGroups",h=0,g=[],I=[],v=[],{error:w,positionRangeMap:y}=J$e({structureId:r,drawDefinition:s,playoffGroups:o});if(w)return q({result:{error:w},stack:m});if(!(!y||o?.every(b=>{let{finishingPositions:S=[]}=b;if(!S.length)return!1;let U=[...S].sort(nr).map((T,P)=>(S[P+1]||T)-T).every(T=>T<2);return(!t||U)&&S.every(T=>y[T])})))return q({context:{validFinishingPositions:Object.values(y)},result:{error:re},stack:m});for(let b of o){let S=b.finishingPositions,U=y&&S.flatMap(N=>y[N]?.finishingPositions??[]),T=c*S.length,P=Ev(T),D=P===2&&Jo||b.drawType||Jo;U&&(h=Math.min(...U)-1);let E=U&&`${Math.min(...U)}-${Math.max(...U)}`,R=b.structureName||E&&b.playoffAttributes?.[E]?.name||b.playoffAttributes?.["0"]?.name,C={addNameBaseToAttributeName:b.addNameBaseToAttributeName,playoffStructureNameBase:b.playoffStructureNameBase,finishingPositionNaming:b.finishingPositionNaming,finishingPositionLimit:b.finishingPositionLimit,structureId:b.structureId??f?.pop(),playoffAttributes:b.playoffAttributes,structureNameMap:b.structureNameMap,sequenceLimit:b.sequenceLimit,structureName:R,idPrefix:d&&`${d}-po`,appliedPolicies:n,finishingPositionOffset:h,stage:Ti,stageSequence:a,matchUpType:l,drawSize:P,isMock:p,uuids:f},M=({playoffStructures:N,playoffLinks:A})=>{let[O]=N,k=ET({playoffStructureId:O.structureId,finishingPositions:S,sourceStructureId:r});v.push(k,...A),I.push(...N),g.push({structureId:O.structureId,finishingPositions:S}),h+=T};if(D===Jo){let{matchUps:N}=gl({finishingPositionLimit:h+T,idPrefix:d&&`${d}-po`,finishingPositionOffset:h,matchUpType:l,drawSize:P,isMock:p,uuids:f}),A=ss({structureId:b.structureId??f?.pop(),matchUpFormat:e,stage:Ti,structureName:R,stageSequence:a,matchUps:N});I.push(A);let O=ET({playoffStructureId:A.structureId,finishingPositions:S,sourceStructureId:r});v.push(O),h+=T,g.push({structureId:A.structureId,finishingPositions:S})}else if([UI,TI,Ti].includes(D)){let N={playoffAttributes:b.playoffAttributes??i,playoffStructureNameBase:b.playoffStructureNameBase,structureId:b.structureId??f?.pop(),structureName:b.structureName,idPrefix:d&&`${d}-po`,addNameBaseToAttributeName:!0,finishingPositionOffset:h,stage:Ti,roundOffset:0,stageSequence:a,drawSize:P,isMock:p,uuids:f};D===UI?Object.assign(N,{playoffAttributes:b?.playoffAttributes??i??kB,roundOffsetLimit:3}):D===TI&&Object.assign(N,{playoffAttributes:b?.playoffAttributes??i??OB,roundOffsetLimit:2});let A=Vg(N);if(A.error)return A;if(A.links?.length&&v.push(...A.links),A.structures?.length&&I.push(...A.structures),I.sort(_h),A.structureId){let O=ET({playoffStructureId:A.structureId,finishingPositions:S,sourceStructureId:r});v.push(O),g.push({structureId:A.structureId,finishingPositions:S})}h+=T}else if([DI,uU,qb,zb,Wb,Yb].includes(D)){let N=[f?.pop(),f?.pop()],A={playoffStructureNameBase:b.playoffStructureNameBase,structureId:b.structureId??f?.pop(),playoffAttributes:b.playoffAttributes,idPrefix:d&&`${d}-po`,finishingPositionOffset:h,uuids:N,stage:Ti,structureName:R,matchUpType:l,feedPolicy:u,drawSize:P,isMock:p},O={[DI]:{fmlc:!0,feedRounds:1},[Yb]:{feedRounds:1},[qb]:{feedsFromFinal:3},[zb]:{feedsFromFinal:2},[Wb]:{feedsFromFinal:1}};Object.assign(A,O[D]||{});let{structures:k,links:F}=_f(A),[x]=k,L=ET({playoffStructureId:x.structureId,finishingPositions:S,sourceStructureId:r});v.push(L,...F),I.push(...k),g.push({structureId:x.structureId,finishingPositions:S}),h+=T}else if([eo].includes(D)){let{structures:N,links:A}=FU({...C,structureOptions:b.structureOptions||{groupSize:4}});M({playoffStructures:N,playoffLinks:A})}else if([lU].includes(D)){let{structures:N,links:A}=bse(C);M({playoffStructures:N,playoffLinks:A})}else if([UFe].includes(D)){let{structures:N,links:A}=Sse(C);M({playoffStructures:N,playoffLinks:A})}else if([la].includes(D)){let N=ss({structureId:b.structureId??f?.pop(),structureName:b.structureName,finishingPosition:dD,stage:Ti,stageSequence:a,matchUps:[]});M({playoffStructures:[N],playoffLinks:[]})}}return{finishingPositionTargets:g,positionRangeMap:y,structures:I,links:v}}function ET({playoffStructureId:t,finishingPositions:e,sourceStructureId:i}){return{linkType:fu,source:{structureId:i,finishingPositions:e},target:{structureId:t,feedProfile:ho,roundNumber:1}}}function Z$e(t){let e="generateAndPopulateRRplayoffStructures";if(!t.playoffGroups)return q({result:{error:Je},info:"playoffGroups required",stack:e});let{sourceStructureId:i,requireSequential:r,tournamentRecord:n,drawDefinition:a,playoffGroups:s,groupCount:o,groupSize:l,event:u}=t,c=Use({requireSequential:r,sourceStructureId:i,playoffGroups:s,groupCount:o,...t});if(c.error)return q({result:c,stack:e});let{structures:d=[],links:p=[],finishingPositionTargets:f,positionRangeMap:m}=c,h=f?.flatMap(({finishingPositions:T})=>T).flatMap(T=>m[T].finishingPositions);a.structures.push(...d),a.links.push(...p);let{matchUps:g,matchUpsMap:I}=Zi({inContext:!0,drawDefinition:a}),v=new Set(d.map(({structureId:T})=>T)),w=g?.filter(({structureId:T})=>v.has(T)).map(vr),y=I?.drawMatchUps?.filter(({matchUpId:T})=>w?.includes(T));if(y?.length){let T=yn({drawDefinition:a,event:u})?.tieFormat;T&&y.forEach(P=>{let{tieMatchUps:D}=Xh({isMock:t.isMock,tieFormat:T,matchUp:P});Object.assign(P,{tieMatchUps:D,matchUpType:La})})}let{positionAssignments:b}=Kt({structureId:i,drawDefinition:a}),S={};b?.forEach(T=>{let P=ht({element:T,name:Tc})?.extension?.value?.groupOrder;P&&(S[P]||(S[P]=[]),S[P].push(T.participantId))});let U=qv({provisionalPositioning:t.provisionalPositioning,structureId:i,applyPositioning:!0,event:t.event,tournamentRecord:n,drawDefinition:a});return U.error&&U.error?.code!==q$.code?q({result:U,stack:e}):{structures:d,links:p,positionsPlayedOff:h,drawDefinition:a,...W}}function lV({positionAssignments:t,tournamentRecord:e,drawDefinition:i,matchUpFormat:r,matchUps:n,event:a}){if(!Ka(n))return{error:re};if(!t)return{error:re};let{policyDefinitions:s}=jc({policyTypes:[HB],tournamentRecord:e,drawDefinition:i,event:a}),{subOrderMap:o}=k2({positionAssignments:t}),l=n.length?Wh({policyDefinitions:s,matchUpFormat:r,subOrderMap:o,matchUps:n}):void 0;if(l?.error)return l;let{participantResults:u={},bracketComplete:c,report:d}=l??{},p=Object.keys(u);return t.forEach(f=>{let{participantId:m}=f;if(p.includes(m)){let h={value:u[m],name:Tc};Ft({element:f,extension:h}),u[m].ties||Nn({element:f,name:RI})}else Nn({element:f,name:Tc}),Nn({element:f,name:RI})}),ii({drawDefinition:i}),{...W,participantResults:u,bracketComplete:c,report:d}}function Tse({matchUps:t,matchUpId:e}){return{matchUp:(t||[]).find(i=>i.matchUpId===e)}}function fi(t){let e=He(t,[{[In]:!0,[Pl]:!0}]);if(e.error)return e;let{tournamentParticipants:i,afterRecoveryTimes:r,contextProfile:n,drawDefinition:a,matchUpsMap:s,matchUpId:o,inContext:l,context:u,event:c}=t,{structures:d=[]}=io({drawDefinition:a}),p=t.contextContent||n&&Gc({contextProfile:n,drawDefinition:a});for(let f of d){let{matchUps:m}=At({tournamentParticipants:i,afterRecoveryTimes:r,contextContent:p,drawDefinition:a,contextProfile:n,matchUpsMap:s,inContext:l,structure:f,context:u,event:c}),{matchUp:h}=Tse({matchUps:m,matchUpId:o});if(h)return{matchUp:h,structure:f}}return{error:dn}}function oN(t){return!wt(t)||!t.notes?{error:Je}:wt(t.element)?!ni(t.notes)&&!t.notes?.testing?{error:re}:(Object.assign(t.element,{notes:t.notes}),{...W}):{error:re}}function uV(t){return wt(t)?wt(t.element)?(t.element.notes&&delete t.element.notes,{...W}):{error:re}:{error:Je}}var lN={matchUpStatus:_i,matchUpStatusCodes:[],score:{scoreStringSide1:"",scoreStringSide2:"",sets:void 0},matchUpFormat:void 0,winningSide:void 0};function So(t){let e="modifyMatchUpScore",i=t.matchUpFormat,r=t.matchUp,n,{matchUpStatusCodes:a,tournamentRecord:s,drawDefinition:o,matchUpStatus:l,removeScore:u,winningSide:c,matchUpId:d,event:p,notes:f,score:m}=t,h=t.appliedPolicies&&Object.keys(t.appliedPolicies).length?t.appliedPolicies:Dt({policyTypes:[ms],tournamentRecord:s,drawDefinition:o,structure:n,event:p})?.appliedPolicies,g=r.matchUpType===ei;if(g&&o){if(d&&r.matchUpId!==d){let U=fi({drawDefinition:o,matchUpId:d,event:p});if(!U.matchUp)return{error:dn};({matchUp:r,structure:n}=U)}}else r.matchUpId!==d&&console.log("!!!!!");l&&[ai,Si].includes(l)||u?Object.assign(r,{...lN}):m&&(r.score=m);let I=l&&r?.matchUpStatus===qt&&l!==qt;l&&(r.matchUpStatus=l),i&&(r.matchUpFormat=i),a&&(r.matchUpStatusCodes=a),c&&(r.winningSide=c),t.removeWinningSide&&(r.winningSide=void 0),!n&&o&&({structure:n}=fi({drawDefinition:o,matchUpId:d,event:p})),l&&!r.winningSide&&fr(r)&&!Ki.includes(l)&&![Lh,Kd,Da].includes(l)&&(r.matchUpStatus=lo);let v;if((I&&r?.processCodes?.length||l===qt)&&(v=h?.[ms]?.processCodes?.incompleteAssignmentsOnDefault),!r.collectionId){let U=n?.structureType===gn,T=Hn({structure:n});if(y2({drawDefinition:o,structure:n})||T||U){let P=R=>{i=g?"SET1-S:T100":i??r.matchUpFormat??R?.matchUpFormat??o?.matchUpFormat??p?.matchUpFormat;let C=g?{matchUpTypes:[ei]}:void 0,{matchUps:M}=At({afterRecoveryTimes:!1,tournamentRecord:s,inContext:!0,matchUpFilters:C,drawDefinition:o,structure:R,event:p});return T&&(R.positionAssignments=nt(M.flatMap(N=>(N.sides??[]).map(A=>A.participantId)).filter(Boolean)).map(N=>({participantId:N}))),lV({positionAssignments:R.positionAssignments,tournamentRecord:s,drawDefinition:o,matchUpFormat:i,matchUps:M,event:p})},D=U&&n.structures.find(R=>R?.matchUps.find(C=>C.matchUpId===d)),E=P(D||n);if(E.error)return q({result:E,stack:e})}}if(f){let U=oN({element:r,notes:f});if(U.error)return q({result:U,stack:e})}let w=s?.tournamentId,y=bs().topics.includes($M),b=(y||v)&&kr({drawDefinition:o}),S=b&&Zi({matchUpFilters:{matchUpIds:[d]},nextMatchUps:!0,tournamentRecord:s,inContext:!0,drawDefinition:o,matchUpsMap:b}).matchUps?.[0];if(y&&S&&lLe({tournamentId:w,inContextMatchUp:S}),Array.isArray(v)&&S&&!S.sides?.every(({participantId:U})=>U))if(l===qt)r.processCodes=nt([...r.processCodes??[],...v]);else for(let U of v||[]){let T=U&&r?.processCodes?.lastIndexOf(U);r?.processCodes?.splice(T,1)}return Ut({eventId:p?.eventId,context:e,drawDefinition:o,tournamentId:w,matchUp:r}),{...W}}function cV(t){let{propagateExitStatus:e,matchUpStatusCodes:i,autoCalcDisabled:r,inContextMatchUp:n,matchUpStatus:a,dualMatchUp:s,structure:o,matchUp:l}=t,u=MU({matchUpStatus:a})||[Rl,Ta].includes(a)&&s||r,c=l?.sides?.map(h=>h.participantId).filter(Boolean).length||n?.sides?.map(h=>h.participantId).filter(Boolean).length,d="attemptToModifyScore";if(!(Hn({structure:o})&&c===1||a===qt&&c||eBe({structure:o,matchUp:l,inContextMatchUp:n})||t.appliedPolicies?.[ms]?.requireParticipantsForScoring===!1||Lr(a)&&c===1&&e))return q({result:{error:eB},stack:d});let p=[ai].includes(a),f=u?a:t.winningSide&&Oi||Da,m=So({...t,winningSide:t.winningSide,matchUpStatusCodes:u&&i||[],matchUpStatus:f,removeScore:p});return q({result:m,stack:d})}function eBe({structure:t,matchUp:e,inContextMatchUp:i}){let{drawPositions:r}=e,{positionAssignments:n}=pr({structure:t}),a=n?.filter(o=>r?.includes(o.drawPosition)&&o.participantId),s=i?.sides?.every(o=>o.participantId);return a?.length===2||s}function Dse({collectionGroups:t=[]}){let e=Object.assign({},...t.filter(r=>lt(r?.groupValue)&&r?.groupNumber).map(r=>({[r.groupNumber]:{...r,allGroupMatchUpsCompleted:!0,matchUpsCount:0,sideWins:[0,0],values:[0,0]}}))),i=Object.keys(e).map(r=>Ke(r));return{groupValueGroups:e,groupValueNumbers:i}}function tBe({collectionDefinition:t,groupValueNumbers:e,groupValueGroups:i,sideTieValues:r,tieMatchUps:n}){let a=n.filter(v=>v.collectionId===t.collectionId),s=[0,0],o=[0,0],l=a.every(v=>Ki.includes(v.matchUpStatus)),{collectionValueProfiles:u,collectionGroupNumber:c,collectionValue:d,matchUpValue:p,winCriteria:f,scoreValue:m,setValue:h}=t,g=c&&e.includes(c),I=[0,0];if(a.forEach(v=>{v.winningSide&&(I[v.winningSide-1]+=1)}),lt(p)?a.forEach(v=>{v.winningSide&&(s[v.winningSide-1]+=p)}):lt(h)?a.forEach(v=>{v.score?.sets?.forEach(w=>{w.winningSide&&(s[w.winningSide-1]+=h)})}):lt(m)?a.forEach(v=>{v.score?.sets?.forEach(w=>{let{side1TiebreakScore:y=0,side2TiebreakScore:b=0,side1Score:S=0,side2Score:U=0}=w;(v.matchUpStatus===Oi||v.winningSide||w.winningSide)&&(S||U?(s[0]+=S,s[1]+=U):(y||b)&&w.winningSide&&(s[w.winningSide-1]+=1))})}):Array.isArray(u)&&a.forEach(v=>{if(v.winningSide){let w=v.collectionPosition,y=iBe({collectionDefinition:t,collectionPosition:w});lt(y)&&(s[v.winningSide-1]+=y)}}),lt(d)){let v;if(f?.aggregateValue)l&&(lt(p||h||m)&&s[0]!==s[1]?v=s[0]>s[1]?1:2:I[0]!==I[1]&&(v=I[0]>I[1]?1:2));else if(f?.valueGoal)v=s.reduce((w,y,b)=>y>=f.valueGoal?b+1:w,0);else{let w=Math.floor(t.matchUpCount/2)+1;v=I.reduce((y,b,S)=>b>=w?S+1:y,0)}v&&(g?i[c].values[v-1]+=d:o[v-1]+=d)}else g?(i[c].values[0]+=s[0]||0,i[c].values[1]+=s[1]||0):o=s;g?(i[c].sideWins[0]+=I[0]||0,i[c].sideWins[1]+=I[1]||0,i[c].allGroupMatchUpsCompleted=i[c].allGroupMatchUpsCompleted&&l,i[c].matchUpsCount+=a.length):o.forEach((v,w)=>r[w]+=v||0)}function iBe({collectionDefinition:t,collectionPosition:e}){return(t.collectionValueProfiles||[])?.find(i=>i.collectionPosition===e)?.matchUpValue}function GU(t){let{sideAdjustments:e=[0,0],separator:i="-",drawDefinition:r,matchUpsMap:n,structure:a,matchUp:s,event:o}=t;if(!Array.isArray(e)||e.length!==2||Number.isNaN(e.reduce((y,b)=>y+b)))return{error:re};if(!s)return{error:aa};let l=yn({matchUp:s,drawDefinition:r,structure:a,event:o})?.tieFormat||t?.tieFormat;if(!l)return{error:Mv};let u=Gn({tieFormat:l});if(u.error)return u;let c=l?.collectionDefinitions||[],d=s?.tieMatchUps??[],p=[0,0],{groupValueGroups:f,groupValueNumbers:m}=Dse(l);for(let y of c)tBe({collectionDefinition:y,groupValueNumbers:m,groupValueGroups:f,sideTieValues:p,tieMatchUps:d});for(let y of m){let b=f[y],{allGroupMatchUpsCompleted:S,matchUpCount:U,winCriteria:T,groupValue:P,sideWins:D,values:E}=b,R;if(T?.aggregateValue)S&&E[0]!==E[1]&&(R=E[0]>E[1]?1:2);else if(T?.valueGoal)R=E.reduce((C,M,N)=>M>=T.valueGoal?N+1:C,void 0);else{let C=Math.floor(U/2)+1;R=D.reduce((M,N,A)=>N>=C?A+1:M,void 0)}R&&(p[R-1]+=P||0)}let h=p.map((y,b)=>(y||0)+e[b]),g={side1Score:h[0],side2Score:h[1],winningSide:void 0},I=h.join(i),v=h.slice().reverse().join(i),w;if(l?.winCriteria){let{valueGoal:y,aggregateValue:b,tallyDirectives:S}=l.winCriteria;if(y?w=h.map((U,T)=>({sideNumber:T+1,points:U})).find(({points:U})=>U>=y)?.sideNumber:b&&d.every(U=>U.matchUpStatus&&Ki.includes(U.matchUpStatus)||U.winningSide)&&h[0]!==h[1]&&(w=h[0]>h[1]?1:2),!w&&S){let U=s.matchUpId,T=s.hasContext?s:n?.drawMatchUps?.[U]||r&&fi({inContext:!0,drawDefinition:r,matchUpId:U})?.matchUp;if(T){let{completedTieMatchUps:P,order:D}=Wh({matchUps:[T]});if(P&&D?.length){let E=D[0].participantId;w=T.sides.find(({participantId:R})=>R===E)?.sideNumber}}}}return w&&(g.winningSide=w),{scoreStringSide1:I,scoreStringSide2:v,winningSide:w,set:g}}function HU({inContextDualMatchUp:t,drawDefinition:e,tournamentId:i,dualMatchUp:r,eventId:n}){if(r){t||(t=fi({matchUpId:r.matchUpId,inContext:!0,drawDefinition:e})?.matchUp);let{extension:a}=ht({element:e,name:Sc}),s=Oe(a?.value||{},!1,!0),o=({displaySideNumber:l,drawPosition:u,sideNumber:c})=>({drawPosition:u,sideNumber:c,displaySideNumber:l});r.sides=t?.sides?.map(l=>{let u=l.participantId,c=u&&s[u]||void 0,{lineUp:d,...p}=r.sides?.find(({sideNumber:m})=>m===l.sideNumber)??{},f=d?.length?d:c;return{...o(l),...p,lineUp:f}}),Ut({context:"ensureSidLineUps",matchUp:r,drawDefinition:e,tournamentId:i,eventId:n})}}function Gr(t){if(t)return Oe(t,!1,!0)}function dV(t){let e=He(t,[{[pn]:!0}]);return e.error?e:Object.keys(t.tournamentRecords).reduce((i,r)=>{i.tournamentIdMap[r]=[];let n=t.tournamentRecords[r].events??[],a=n.map(({eventId:o})=>o),s=n.map(o=>(o.drawDefinitions??[]).map(({drawId:l})=>l)).flat();return i.tournamentIdMap[r].push(...a,...s),i.eventIds.push(...a),i.drawIds.push(...s),i},{eventIds:[],drawIds:[],tournamentIdMap:{}})}function Pse({tournamentRecords:t,eventId:e,drawId:i}){let{tournamentIdMap:r}=dV({tournamentRecords:t});return(r?Object.keys(r):[]).find(n=>e&&r?.[n].includes(e)||i&&r?.[n].includes(i))}function Hc(t){let{exitWhenNoValues:e,drawDefinition:i,matchUpStatus:r,removeScore:n,matchUpsMap:a,matchUpId:s,event:o}=t,l=t.tournamentRecords||t.tournamentRecord&&{[t.tournamentRecord?.tournamentId]:t.tournamentRecord}||{},u=t.tournamentId||t.tournamentRecord?.tournamentId;l&&Pse({tournamentRecords:l,...t});let c=u&&l[u];if(!c)return{error:ve};let d=fi({drawDefinition:i,event:o,matchUpId:s});if(d.error)return d;if(!d.matchUp)return{error:dn};let{matchUp:p,structure:f}=d;if(!p.tieMatchUps)return{error:sa};HU({tournamentId:c?.tournamentId,eventId:o?.eventId,dualMatchUp:p,drawDefinition:i});let{extension:m}=ht({name:jm,element:p});if(m?.value)if(n)Nn({element:p,name:jm});else return{...W,score:p.score};let h=yn({drawDefinition:i,structure:f,matchUp:p,event:o})?.tieFormat;p.tieFormat=Gr(h);let g=GU({drawDefinition:i,matchUpsMap:a,structure:f,matchUp:p,event:o}),{winningSide:I,set:v,scoreStringSide1:w,scoreStringSide2:y}=g,b=v?.side1Score||v?.side2Score;if(e&&!p.score&&!b)return{...W};let S={scoreStringSide1:w,scoreStringSide2:y,sets:v?[v]:[]},U=I&&[1,2].includes(I),T=U&&Oi||E2({matchUpStatus:r??p.matchUpStatus,tieMatchUps:p.tieMatchUps,winningSide:p.winningSide,score:S})&&lo||_i,P=!!(p.winningSide&&!U),D=p.tieMatchUps.find(({score:R,winningSide:C,matchUpStatus:M})=>R?.sets?.length&&(R.sets[0].side1Score||R.sets[0].side2Score)||M&&Ki.includes(M)||C),E;if(p.tieFormat&&!U&&!D){let R=yn({drawDefinition:i,structure:f,event:o})?.tieFormat;R&&JSON.stringify(h)===JSON.stringify(R)&&(p.tieFormatId=void 0,p.tieFormat=void 0,E=!0)}return So({appliedPolicies:t.appliedPolicies,matchUpStatus:T,score:S,removeWinningSide:P,tournamentRecord:c,drawDefinition:i,removeScore:n,winningSide:I,matchUpId:s,matchUp:p,event:o}),{...W,score:S,removeWinningSide:P,tieFormatRemoved:E,winningSide:I}}function rBe({winnerMatchUpDrawPositionIndex:t,inContextDrawMatchUps:e,projectedWinningSide:i,sourceMatchUpStatus:r,winningDrawPosition:n,tournamentRecord:a,winnerTargetLink:s,sourceMatchUpId:o,drawDefinition:l,winnerMatchUp:u,dualMatchUp:c,matchUpsMap:d,event:p}){let f="directWinner";if(s){let m=u.drawPositions||[],h=m[t],g=s.source.structureId,I=tt({structureId:g,drawDefinition:l});if(I.error)return I;let{structure:v}=I,{positionAssignments:w}=pr({structureId:g,drawDefinition:l}),y=w?.find(D=>D.drawPosition===n)?.participantId,b=s.target.structureId,{positionAssignments:S}=pr({structureId:b,drawDefinition:l}),U=S?.find(D=>D.participantId===y)?.drawPosition,T=S?.filter(D=>{let E=m.includes(D.drawPosition),R=!D.participantId&&!D.bye&&!D.qualifier;return E&&R}).map(D=>D.drawPosition),P=T?.includes(h);if(y&&s.target.roundNumber===1&&P)hl({drawPosition:h,participantId:y,structureId:b,inContextDrawMatchUps:e,sourceMatchUpStatus:r,tournamentRecord:a,drawDefinition:l,matchUpsMap:d,event:p});else if(y&&T?.length){let D=T.pop();D&&hl({participantId:y,structureId:b,inContextDrawMatchUps:e,sourceMatchUpStatus:r,tournamentRecord:a,drawDefinition:l,drawPosition:D,matchUpsMap:d,event:p})}else if(U){let D=hm({drawPosition:U,matchUpId:u.matchUpId,inContextDrawMatchUps:e,sourceMatchUpStatus:r,tournamentRecord:a,sourceMatchUpId:o,drawDefinition:l,matchUpsMap:d});if(D.error)return q({result:D,stack:f})}else if(v?.stage!==ze){let D="winner target position unavaiallble";console.log(D),q({stack:f,result:{error:D}})}if(v?.seedAssignments&&v.structureId!==b){let D=v.seedAssignments.find(({participantId:R})=>R===y),E=D?.participantId;D&&E&&zv({eventId:u?.eventId,structureId:b,...D,tournamentRecord:a,drawDefinition:l,participantId:E})}}else{let m=hm({matchUpId:u.matchUpId,drawPosition:n,inContextDrawMatchUps:e,sourceMatchUpStatus:r,tournamentRecord:a,sourceMatchUpId:o,drawDefinition:l,matchUpsMap:d});if(m.error)return m}if(c&&i){let m=c.sides?.find(h=>h.sideNumber===i);if(m?.lineUp){let h=c.roundPosition,g=u.roundPosition,I=h===g&&h!==1||Math.floor(h/2)===g?2:1,v=d?.drawMatchUps?.find(({matchUpId:b})=>b===u.matchUpId),w=[1,2].map(b=>({...v.sides?.find(S=>S.sideNumber===b)||{},sideNumber:b}));v.sides=w;let y=v.sides.find(b=>b.sideNumber===I);if(y){let b=m.lineUp?.filter(S=>S?.participantId);y.lineUp=q2({lineUp:b}),Ut({tournamentId:a?.tournamentId,eventId:u?.eventId,matchUp:v,context:f,drawDefinition:l})}}}return{...W}}function nBe(t){let{loserMatchUpDrawPositionIndex:e,inContextDrawMatchUps:i,projectedWinningSide:r,propagateExitStatus:n,sourceMatchUpStatus:a,loserDrawPosition:s,tournamentRecord:o,loserTargetLink:l,drawDefinition:u,loserMatchUp:c,dualMatchUp:d,matchUpsMap:p,event:f}=t,m="directLoser",h=l.linkCondition,g=c.drawPositions||[],I=h===fl&&c.roundNumber===2&&Math.min(...g.filter(Boolean)),v=I||g[e],w=I||g[1-e],y=l.source.structureId,{structure:b}=tt({structureId:y,drawDefinition:u}),{matchUps:S}=At({afterRecoveryTimes:!1,inContext:!0,drawDefinition:u,structure:b,event:f}),U=S.filter(_=>_.drawPositions?.includes(s)).filter(_=>{let B=_.sides.find(j=>j.drawPosition===s),G=_.matchUpStatus===ai||_.matchUpStatus===qt&&!fr(_);return B?.sideNumber===_.winningSide&&!G}),T=h===fl&&U.length===0,{positionAssignments:P}=pr({structureId:y,drawDefinition:u}),D=P?.find(_=>_.drawPosition===s)?.participantId,E={loserParticipantId:D},R=l.target.structureId,{positionAssignments:C}=pr({structureId:R,drawDefinition:u}),M=C?.filter(({drawPosition:_})=>g.includes(_)),N=M?.some(_=>_.participantId&&D&&_.participantId===D),A=n&&[Sr,ai,qt].includes(a||"");if(N)return{...W,stack:m};let O=M?.filter(_=>{let B=g.includes(_.drawPosition),G=!_.participantId&&!_.bye&&!_.qualifier;return B&&G}).map(_=>_.drawPosition),k=O?.includes(v),F=l.target.roundNumber>1&&O?.length,x=l.target.roundNumber===1&&k;if(I){let _=L();if(_.context&&Object.assign(E,_.context),_.error)return q({result:_,stack:m})}else if(x){let _=V();if(_.context&&Object.assign(E,_.context),_.error)return q({result:_,stack:m})}else if(D&&F){O.sort(nr);let _=O[0],B=hl({participantId:D,structureId:R,drawPosition:_,inContextDrawMatchUps:i,sourceMatchUpStatus:a,tournamentRecord:o,drawDefinition:u,matchUpsMap:p,event:f});if(B.error)return q({result:B,stack:m});if(!B.error&&A&&n)return{stack:m,context:{progressExitStatus:!0,loserParticipantId:D}}}else return q({context:{loserDrawPosition:s,loserTargetLink:l,targetDrawPositionIsUnfilled:k},result:{error:k?Rh:Hxe},stack:m});if(b?.seedAssignments&&b.structureId!==R){let _=b.seedAssignments.find(({participantId:G})=>G===D),B=_?.participantId;_&&B&&zv({eventId:c?.eventId,structureId:R,..._,tournamentRecord:o,drawDefinition:u,participantId:B})}if(d&&r){let _=d.sides?.find(B=>B.sideNumber===3-r);if(_?.lineUp){let{roundNumber:B,eventId:G}=c,{roundPosition:j}=d,K=B===1?2-j%2:1,Y=p?.drawMatchUps?.find(({matchUpId:J})=>J===c.matchUpId),X=[1,2].map(J=>({...Y.sides?.find(ae=>ae.sideNumber===J)||{},sideNumber:J}));Y.sides=X;let Z=Y.sides.find(J=>J.sideNumber===K);Z&&(Z.lineUp=q2({lineUp:_.lineUp}),Ut({tournamentId:o?.tournamentId,matchUp:Y,context:m,drawDefinition:u,eventId:G}))}}return q({result:{...W},stack:m,context:E});function L(){let _="loserLinkFedFMLC";return q(T?{result:V(),stack:_}:{result:$(),stack:_})}function $(){let _=Ja({drawPosition:w,structureId:R,tournamentRecord:o,drawDefinition:u,event:f});return q({result:_,stack:"assignLoserPositionBye"})}function V(){let _=D?hl({drawPosition:v,participantId:D,structureId:R,inContextDrawMatchUps:i,sourceMatchUpStatus:a,tournamentRecord:o,drawDefinition:u,matchUpsMap:p,event:f}):{error:dr};return!_.error&&A&&n?{stack:m,context:{progressExitStatus:!0}}:q({result:_,stack:"assignLoserDrawPosition"})}}function Ese(t){let e="directParticipants",i=cV(t);if(i.error)return q({result:i,stack:e});let r=MU({matchUpStatus:t.matchUpStatus}),{dualWinningSideChange:n,inContextDrawMatchUps:a,projectedWinningSide:s,propagateExitStatus:o,matchUpStatusCodes:l,tournamentRecord:u,drawDefinition:c,matchUpStatus:d,dualMatchUp:p,matchUpsMap:f,winningSide:m,targetData:h,matchUpId:g,structure:I,matchUp:v,event:w}=t,y=!!v.collectionId,b=Hn({structure:I}),S=v.drawPositions,U;if(y){let{matchUpTieId:T,matchUpsMap:P}=t,D=Hc({appliedPolicies:t.appliedPolicies,matchUpId:T,tournamentRecord:u,drawDefinition:c,matchUpsMap:P,event:w});if(U=D&&{tieMatchUpResult:D},S=a.find(({matchUpId:E})=>E===T)?.drawPositions,!n)return q({result:{...W,...U},stack:e})}if(b)return q({result:{...W,...U},stack:e});if(S){let T=s?s-1:m-1,P=1-T,D=S[T],E=S[P],R={},{targetLinks:{loserTargetLink:C,winnerTargetLink:M,byeTargetLink:N},targetMatchUps:{winnerMatchUpDrawPositionIndex:A,loserMatchUpDrawPositionIndex:O,winnerMatchUp:k,loserMatchUp:F,byeMatchUp:x}}=h;if(k){let L=rBe({sourceMatchUpStatus:r&&d||Oi,winnerMatchUpDrawPositionIndex:A,sourceMatchUpId:g,inContextDrawMatchUps:a,projectedWinningSide:s,winningDrawPosition:D,tournamentRecord:u,winnerTargetLink:M,drawDefinition:c,winnerMatchUp:k,dualMatchUp:p,matchUpsMap:f,event:w});if(L.error)return q({result:L,stack:e})}if(F){let L=nBe({sourceMatchUpStatus:r&&d||Oi,loserMatchUpDrawPositionIndex:O,inContextDrawMatchUps:a,projectedWinningSide:s,propagateExitStatus:o,loserDrawPosition:E,tournamentRecord:u,loserTargetLink:C,drawDefinition:c,loserMatchUp:F,matchUpsMap:f,dualMatchUp:p,event:w});if(L.context?.progressExitStatus&&Object.assign(R,L.context,{sourceMatchUpStatus:r&&d||Oi,sourceMatchUpStatusCodes:l||[],loserMatchUp:F,matchUpsMap:f}),L.error)return q({result:L,stack:e})}if(x){let L=x.drawPositions||[],$=Math.min(...L.filter(Boolean)),V=N.target.structureId,_=Ja({drawPosition:$,structureId:V,tournamentRecord:u,drawDefinition:c,event:w});if(_.error)return q({result:_,stack:e})}return q({result:{...W,...U},stack:e,context:R})}else return q({result:{error:KS},stack:e})}function pV(t){let e="genPlayoffStructure";if(!t.drawDefinition)return q({result:{error:$e},stack:e});let i=jU(t);if(i.error)return q({result:i,stack:e});let{structureId:r,addNameBaseToAttributeName:n,playoffStructureNameBase:a,finishingPositionNaming:s,finishingPositionLimit:o,playoffAttributes:l,playoffPositions:u,roundOffsetLimit:c,tournamentRecord:d,exitProfileLimit:p,roundProfiles:f,roundNumbers:m,idPrefix:h,isMock:g,event:I,uuids:v}=t,w=Oe(t.drawDefinition,!1,!0),{structure:y}=tt({structureId:r,drawDefinition:w});if(!y)return q({result:{error:vi},stack:e});if(y.structureType===gn||y.structures)return Z$e({sourceStructureId:y.structureId,...t,...i,drawDefinition:w});let{playoffRoundsRanges:b,playoffRounds:S}=i,{playoffPositionsReturned:U,error:T,playoffSourceRounds:P,playoffRoundsRanges:D}=yse(t);if(T)return q({result:{error:T},stack:e});let E=f?.length&&Object.assign({},...f),R=m||typeof f=="object"&&f.map(j=>Object.keys(j)).flat(),C=Array.isArray(R)&&R.map(j=>!isNaN(j)&&Ke(j)).filter(Boolean);if(C){if(!Array.isArray(C))return q({result:{error:re},context:{validRoundNumbers:C},stack:e});C.forEach(j=>{if(!S?.includes(j))return q({result:{error:re},context:{roundNumber:j},stack:e})})}u&&u.forEach(j=>{if(!U?.includes(j))return q({result:{error:re},context:{playoffPosition:j},stack:e})});let M=C||P,N=C?b:D,A=[],O=[];for(let j of M??[]){let K=N?.find(le=>le.roundNumber===j);if(!K)return q({result:{error:re},context:{roundNumber:j},stack:e});let Y=K.finishingPositions.length,X=Math.min(...K.finishingPositions)-1,Z=2,J=j&&E?.[j]&&Z+E[j]-1,ae=Vg({exitProfile:`0-${j}`,addNameBaseToAttributeName:n,playoffStructureNameBase:a,finishingPositionOffset:X,playoffAttributes:l,exitProfileLimit:p,stage:Ti,roundOffset:0,drawDefinition:w,sequenceLimit:J,stageSequence:Z,drawSize:Y,idPrefix:h,isMock:g,uuids:v,finishingPositionNaming:s,finishingPositionLimit:o,roundOffsetLimit:c});if(ae.error)return q({result:ae,stack:e});let{structures:te,links:ne}=ae;if(te?.length&&A.push(...te),ne?.length&&O.push(...ne),ae.structureId&&j){let le={linkType:hu,source:{structureId:r,roundNumber:j},target:{structureId:ae.structureId,feedProfile:As,roundNumber:1}};O.push(le)}}if(!A.length)return q({result:{error:re},info:"No structures generated",stack:e});w.structures.push(...A),w.links.push(...O);let{matchUps:k,matchUpsMap:F}=Zi({inContext:!0,drawDefinition:w}),x=A.map(({structureId:j})=>j),L=k?.filter(({structureId:j})=>x.includes(j)).map(vr),$=F?.drawMatchUps?.filter(({matchUpId:j})=>L?.includes(j));if($?.length){let j=yn({drawDefinition:w,event:I})?.tieFormat;j&&$.forEach(K=>{let{tieMatchUps:Y}=Xh({matchUp:K,tieFormat:j,isMock:g});Object.assign(K,{tieMatchUps:Y,matchUpType:ei})})}k?.filter(j=>vp({matchUp:j})&&j.structureId===r)?.forEach(j=>{let{matchUpId:K,score:Y,winningSide:X}=j,Z=Fn({inContextDrawMatchUps:k,drawDefinition:w,matchUpId:K}),J=Ese({inContextDrawMatchUps:k,tournamentRecord:d,drawDefinition:w,matchUpsMap:F,winningSide:X,targetData:Z,matchUpId:K,structure:y,matchUp:j,score:Y,event:I});J.error&&console.log(J.error)}),k?.filter(j=>j.matchUpStatus==="BYE"&&j.structureId===r)?.forEach(j=>{let{matchUpId:K}=j,Y=Fn({inContextDrawMatchUps:k,drawDefinition:w,matchUpId:K}),{targetLinks:{loserTargetLink:X},targetMatchUps:{loserMatchUpDrawPositionIndex:Z,loserMatchUp:J}}=Y;if(X&&J){let ae=X.target.structureId,te=J.drawPositions[Z],ne=Ja({drawPosition:te,structureId:ae,tournamentRecord:d,drawDefinition:w,event:I});ne.error&&console.log(ne.error)}});let V=[],_=Wp({inContextDrawMatchUps:k,drawDefinition:w,matchUpsMap:F}).goesToMap,{structure:B}=tt({drawDefinition:t.drawDefinition,structureId:r}),{matchUps:G}=At({structure:B});return G.forEach(j=>{let K=_?.loserMatchUpIds[j.matchUpId];if(K&&j.loserMatchUpId!==K){j.loserMatchUpId=K;let X={tournamentId:d?.tournamentId,eventId:t.event?.eventId,context:e,matchUp:j};V.push(X)}let Y=_?.winnerMatchUpIds[j.matchUpId];if(Y&&j.winnerMatchUpId!==Y){j.winnerMatchUpId=Y;let X={tournamentId:d?.tournamentId,eventId:t.event?.eventId,context:e,matchUp:j};V.push(X)}}),{structures:A,matchUpModifications:V,links:O,drawDefinition:w,...W}}function Rse({element:t}){if(!t)return{error:re};if(!t.timeItems)return{};if(!Array.isArray(t.timeItems))return{error:re};let e=(i,r)=>(n,a)=>(a[i]&&(n[a[i]]=a[r]),n);return t.timeItems.reduce(e("itemType","itemValue"),{})}function Cl(t){let{duplicateValues:e=!0,creationTime:i=!0,removePriorValues:r,timeItem:n}=t;if(!n)return{error:dB};let a=Pne(t);if(a.error)return a;if(!(wt(n)&&ni(n.itemType)&&Object.keys(n).includes("itemValue")))return{error:cB};if(!a.timeItems)a.timeItems=[];else if(aBe({element:a,duplicateValues:e,timeItem:n}))return{...W};if(n.itemSubTypes&&!n.itemSubTypes.length&&delete n.itemSubTypes,i){let s=new Date().toISOString();Object.assign(n,{createdAt:s})}return r&&(a.timeItems=a.timeItems.filter(({itemType:s})=>n.itemType!==s)),r&&!n.itemValue||a.timeItems.push(n),{...W}}function aBe({element:t,duplicateValues:e,timeItem:i}){let{itemType:r,itemSubTypes:n,itemValue:a}=i,s=r&&Ss({itemSubTypes:n,itemType:r,element:t})?.timeItem;return s&&JSON.stringify(s?.itemValue)===JSON.stringify(a)&&!e}function fV({creationTime:t=!0,removePriorValues:e,tournamentRecord:i,duplicateValues:r,participantId:n,timeItem:a}){if(!i)return{error:ve};if(!n)return{error:dr};let s=Xd({tournamentRecord:i,participantId:n});return s.error?s:Cl({element:s.participant,removePriorValues:e,duplicateValues:r,creationTime:t,timeItem:a})}function WU(t){let{removePriorValues:e,tournamentRecord:i,duplicateValues:r,creationTime:n,timeItem:a}=t;if(!i)return{error:ve};let s=Cl({element:i,removePriorValues:e,duplicateValues:r,creationTime:n,timeItem:a});if(s.error)return s;let o=Rse({element:i});return st({payload:{parentOrganisation:i.parentOrganisation,tournamentId:i.tournamentId,timeItemValues:o},topic:vf}),s}function Jh(t){let{removePriorValues:e,duplicateValues:i,creationTime:r,timeItem:n,event:a}=t;return a?Cl({removePriorValues:e,duplicateValues:i,element:a,creationTime:r,timeItem:n}):{error:ps}}function Cse(t){return uN({...t,itemType:"attachConsolationStructures"})}function mV(t){return uN({...t,itemType:"attachPlayoffStructures"})}function uN({itemType:t="attachStructures",matchUpModifications:e,tournamentRecord:i,drawDefinition:r,structures:n,links:a=[],event:s}){let o="attachStructures";if(!r)return{error:$e};if(!Array.isArray(n)||!Array.isArray(a))return q({result:{error:re},stack:o});let l=g=>[g.source.structureId,g.source.roundNumber||g.source.finishingPositions?.join("|"),g.target.roundNumber].join("|"),u=r.links?.map(l);if(a.some(g=>{let I=l(g);return u?.includes(I)}))return q({result:{error:IB},info:"playoff structure exists",stack:o});a.length&&r.links?.push(...a);let c=n.map(({structureId:g})=>g),d=r.structures?.map(({structureId:g})=>g);r.structures=(r.structures??[]).map(g=>c.includes(g.structureId)?n.find(({structureId:I})=>I===g.structureId):g);let p=n?.filter(({structureId:g})=>!d?.includes(g));p.length&&r.structures.push(...p),Wp({drawDefinition:r});let f=n.map(g=>At({structure:g})?.matchUps||[]).flat();Dd({tournamentId:i?.tournamentId,eventId:s?.eventId,drawDefinition:r,matchUps:f});let m=n.map(({structureId:g})=>g);if(ii({drawDefinition:r,structureIds:m}),e?.length){let g={};e.forEach(v=>{let w=v.matchUp?.matchUpId;w&&(g[w]=v)});let I=v=>{v.matchUps.forEach(w=>{if(g[w.matchUpId]){let{tieMatchUps:y,...b}=g[w.matchUpId].matchUp;if(Object.assign(w,b),y?.length){let S={};y.forEach(U=>g[U.matchUpId]=U),w.tieMatchUps.forEach(U=>Object.assign(U,S[U.matchUpId]))}g[w.matchUpId].matchUp=w,Ut(g[w.matchUpId])}})};r.structures.forEach(v=>{if(d?.includes(v.structureId))if(v.structures)for(let w of v.structures)I(w);else I(v)})}let h=p.map(Pa("structureId"));if(i){let g={itemValue:{structureIds:m,drawId:r.drawId},itemType:t};Cl({element:i,timeItem:g})}return{...W,addedStructureIds:h}}function cN(t){let{structures:e,links:i,matchUpModifications:r,error:n}=pV(t);if(n)return{error:n};let a=t.drawDefinition;return mV({tournamentId:t.tournamentRecord?.tournamentId,eventId:t.event?.eventId||t.eventId,matchUpModifications:r,drawDefinition:a,structures:e,links:i})}function qp(t){let e=He(t,[{_anyOf:{[pn]:!1,[hr]:!1,[In]:!1,[Bc]:!1},[xB]:!0}]);if(e.error)return e;let i=[],r=t.drawDefinition??t.event??((t.tournamentId||!t.tournamentRecords)&&t.tournamentRecord);if(r){let n=pq(t,r);if(n.error)return n;i.push(...n?.applied??[]),t.drawDefinition&&ii({drawDefinition:t.drawDefinition,tournamentId:t.tournamentId})}else if(t.tournamentRecords){let n=Object.keys(t.tournamentRecords);if(!n.length)return{error:ve};for(let a of n){let s=t.tournamentRecords[a],o=pq(t,s);if(o.error)return o;i.push(...o?.applied??[])}}else return{error:ve};return i.length?{...W,applied:i}:{error:rB}}function pq(t,e){let i=Dt(t).appliedPolicies??{};e.extensions||(e.extensions=[]);let r=[],n=Object.keys(t.policyDefinitions);if(!n.length)return{error:aM};for(let a of n)if(!i[a]||t.allowReplacement){let s=t.policyDefinitions[a];if(!s)continue;if(!wt(s))return{error:re};let{policyName:o,...l}=s;if(!l||!Object.keys(l).length||o&&!ni(o))return{error:re};i[a]=t.policyDefinitions[a],r.push(a)}return r?.length?{...Ft({element:e,extension:{name:Jb,value:i}}),applied:r}:{applied:r,error:rB}}function hV({tournamentRecord:t,drawDefinition:e,flightProfile:i,drawName:r,drawId:n,event:a}){if(!r||typeof r!="string")return q({result:{error:re},context:{drawName:r}});i||(i=Bi({event:a}).flightProfile);let s=i?.flights?.find(o=>o.drawId===n);if(s){s.drawName=r;let o={name:to,value:{...i,flights:i.flights}};Yd({event:a,extension:o})}return e&&(e.drawName=r,ii({tournamentId:t?.tournamentId,drawDefinition:e})),!s&&!e?{error:$e}:{...W,flight:s}}function Mse({tournamentRecord:t,drawDefinition:e,drawUpdates:i,drawId:r,event:n}){if(!wt(i))return{error:re};let a=Bi({event:n}).flightProfile,s=i.drawName&&hV({drawName:i.drawName,tournamentRecord:t,drawDefinition:e,flightProfile:a,drawId:r,event:n});if(s?.error)return s?.error;let o=s?.flight||a?.flights?.find(l=>l.drawId===r);if(!o&&!e)return{error:$e};if(o){let l={name:to,value:{...a,flights:a.flights}};Yd({event:n,extension:l})}return e&&(i.policyDefinitions&&qp({policyDefinitions:i.policyDefinitions,drawDefinition:e}),ii({tournamentId:t?.tournamentId,drawDefinition:e})),{...W}}function Nse({tournamentRecord:t,removeScheduling:e,drawDefinition:i}){if(!i)return{error:$e};let r=kr({drawDefinition:i}),n=s=>r?.drawMatchUps?.find(o=>o.matchUpId===s);for(let s of i.structures||[]){let{positionAssignments:o,stage:l,stageSequence:u}=s;o&&(u!==1||![ze,Ae].includes(l))&&(s.positionAssignments=o.map(p=>(delete p.participantId,p)),s.seedAssignments=[]);let{matchUps:c,isRoundRobin:d}=At({afterRecoveryTimes:!1,inContext:!0,matchUpsMap:r,structure:s});for(let p of c){let{matchUpId:f,roundNumber:m}=p,h=p.sides||[],g=n(f);if(g){if(delete g.extensions,delete g.notes,g.matchUpStatus!=="BYE"&&Object.assign(g,lN),m&&m>1&&g.drawPositions?.length&&!d){let I=h?.map(({drawPosition:w,participantFed:y})=>!y&&w).filter(Boolean),v=g.drawPositions.map(w=>I.includes(w)?void 0:w);g.drawPositions=v}e?delete g.timeItems:g.timeItems?.length&&(g.timeItems=g.timeItems.filter(I=>I.itemType&&![wu,Ed,Bh,S2,Vh,jh].includes(I.itemType))),Ut({tournamentId:t?.tournamentId,context:"resetDrawDefiniton",drawDefinition:i,matchUp:g})}}}i.extensions=i.extensions.filter(s=>s.name!==Bg);let a=(i.structures||[]).map(({structureId:s})=>s);return ii({drawDefinition:i,structureIds:a}),{...W}}function zU({tournamentRecord:t}){if(!t)return{error:ve};let e={positionsNoOutcomes:[],canBePruned:[],matchPlay:[],inactive:[],drawAnalysis:{}},i={};return(t.events?.flatMap(r=>{let n=r.eventId;return i[n]=r,(r?.drawDefinitions||[]).map(a=>({drawDefinition:a,eventId:n}))}).filter(Boolean)).forEach(({drawDefinition:r,eventId:n})=>{let a=0,s=0,o=0,{allStructuresLinked:l}=nN({drawDefinition:r}),u=i[n],c=(r?.structures||[]).map(w=>{let{stage:y,stageSequence:b,structureId:S}=w,U=Bm[y],{inContextStructureMatchUps:T}=Gv({drawDefinition:r,structureId:S,structure:w,event:u}),P=T?.filter(({winningSide:$})=>$),D=P.filter(Boolean).length||0;s+=D,o+=T.length-s;let E=Math.max(P.filter(({roundNumber:$})=>$===1).map(({roundPosition:$})=>$)),{positionAssignments:R}=Kt({structure:w}),C=R?.filter(({participantId:$})=>$);a+=C?.length??0;let M=(R?.length??0)-(C?.length??0),{roundMatchUps:N,roundProfile:A,roundNumbers:O,maxMatchUpsCount:k}=Sn({matchUps:T}),F=A&&Object.keys(A).filter($=>!A[$].inactiveRound).map($=>Number.parseInt($)),x=A&&Object.keys(A).filter($=>A[$].inactiveRound).map($=>Number.parseInt($)),L=A&&Object.values(A).every($=>$.inactiveRound);return{positionsAssignedCount:C?.length??0,maxWinningSideFirstRoundPosition:E,unassignedPositionsCount:M,inactiveStructure:L,maxMatchUpsCount:k,inactiveRounds:x,roundMatchUps:N,activeRounds:F,roundNumbers:O,roundProfile:A,structureId:S,stageSequence:b,orderNumber:U,stage:y}}),d=c.find(w=>w.orderNumber===2&&w.stageSequence===1),p=c.filter(({inactiveStructure:w})=>!w).length,{links:f}=Vv({structureId:d.structureId,drawDefinition:r}),m=Ke(d.activeRounds[0])===1&&d.activeRounds.length===1&&p===1,h=c?.every(({inactiveStructure:w})=>w),g=!f.length&&d.activeRounds.length&&(d.roundProfile[1].inactiveCount||d.inactiveRounds.length),I=r.drawId;a&&!s&&e.positionsNoOutcomes.push(I),h&&e.inactive.push(I),m&&e.matchPlay.push(I),g&&e.canBePruned.push(I);let v={matchUpsWithWinningSideCount:s,matchUpsNoOutcomeCount:o,positionsAssignedCount:a,allStructuresLinked:l,structuresData:c,inactiveDraw:h,isMatchPlay:m,drawId:I};e.drawAnalysis[I]=v}),{...W,drawsAnalysis:e}}function Ase({matchPlayDrawPositions:t=!0,tournamentRecord:e,drawDefinition:i,drawId:r}){if(!e)return{error:ve};if(!i)return{error:$e};let n=[],{drawsAnalysis:a}=zU({tournamentRecord:e});if(a.canBePruned.includes(r)){let s=a.matchPlay.includes(r),o=a.drawAnalysis[r],{structures:[l]}=io({stageSequence:1,drawDefinition:i,stage:Ae}),u=o.structuresData.find(({structureId:f})=>l.structureId===f),c=(l.matchUps??[]).sort((f,m)=>f.roundPosition-m.roundPosition);n=c.filter(({roundNumber:f})=>!u.inactiveRounds.includes(f));let d=n.map(vr),p=c.map(vr).filter(f=>!d.includes(f));if(s){let f=n.filter(({roundNumber:v})=>!u.inactiveRounds.includes(v)).filter(({winningSide:v})=>v),m=f.map(vr),h=d.filter(v=>!m.includes(v));p.push(...h);let g=f.flatMap(v=>v.drawPositions??[]).filter(Boolean).flat(),I=Object.assign({},...g.map((v,w)=>({[v]:w+1})));if(f.forEach(v=>{t?v.drawPositions=v.drawPositions.map(w=>I[w]):delete v.drawPositions}),t){let v=l?.positionAssignments?.filter(w=>g.includes(w.drawPosition)).map(w=>(w.drawPosition=I[w.drawPosition],w));l.positionAssignments=v}else l.positionAssignments=[];l.matchUps=f,n=f}ku({tournamentId:e?.tournamentId,matchUpIds:p,drawDefinition:i}),ii({drawDefinition:i})}return{...W,matchUps:n}}function sBe({isPositionAction:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,loserMatchUp:n,matchUpsMap:a,structureId:s,structure:o,event:l}){if(!i)return{error:$e};if(o||({structure:o}=tt({drawDefinition:i,structureId:s})),!o)return{error:vi};s||({structureId:s}=o);let u="assignDrawPositionQualifier";Ht({method:u,color:"cyan",drawPosition:r}),a??=kr({drawDefinition:i});let{positionAssignments:c}=Kt({structure:o}),{activeDrawPositions:d}=Gv({drawDefinition:i,structureId:s});if(c?.find(I=>I.drawPosition===r)?.qualifier)return{...W};let p=!!(n&&a.drawMatchUps.some(I=>I.loserMatchUpId===n?.matchUpId&&Lr(I.matchUpStatus)));if(d?.includes(r)&&!p)return{error:XS};let f=c?.find(I=>I.drawPosition===r);if(!f)return{error:Rh};let{containsQualifier:m,containsParticipant:h}=C2(f);if(m)return{...W};let g=Dt({tournamentRecord:e,drawDefinition:i,event:l}).appliedPolicies??{};return c?.forEach(I=>{I.drawPosition===r&&(I.qualifier=!0,p&&(I.participantId=void 0,console.log("oddity: invalid participantId on qualifier position cleared")))}),Dc({tournamentId:e?.tournamentId,drawDefinition:i,structure:o,event:l}),oBe({assignedParticipantId:h,isPositionAction:t,appliedPolicies:g,drawDefinition:i,drawPosition:r,structureId:s,stack:u})}function oBe({assignedParticipantId:t,isPositionAction:e,appliedPolicies:i,drawDefinition:r,drawPosition:n,structureId:a,stack:s}){return e&&hU({appliedPolicies:i,drawDefinition:r,positionAction:{removedParticipantId:t,drawPosition:n,structureId:a,name:s}}),q({result:{...W},stack:s})}function kse({tournamentRecord:t,drawDefinition:e,participantId:i,drawPosition:r,structureId:n,qualifier:a,event:s,bye:o}){if(!e)return{error:$e};if(!r)return{error:Rv};if(!n)return{error:qa};if(o){let l=Ja({tournamentRecord:t,drawDefinition:e,drawPosition:r,structureId:n,event:s});if(l.error)return l}else if(a){let l=sBe({tournamentRecord:t,drawDefinition:e,drawPosition:r,structureId:n,event:s});if(l.error)return l}else{let l=hl({participantId:i,tournamentRecord:t,drawDefinition:e,drawPosition:r,structureId:n,event:s});if(l.error)return l}return{...W}}function Ose(t){let e=t.matchUpIds??[],{drawDefinition:i}=t,r=t.structureId??i?.structures?.find(l=>l.matchUps?.some(({matchUpId:u})=>e.includes(u)))?.structureId??i?.structures?.[0]?.structureId;if(!r)return{error:vi};let n=i.structures?.find(l=>l.structureId===r);if(!n)return{error:vi};let a=n?.matchUps,s=a?.find(l=>!!l.roundPosition);if(n.structures||s||n.finishingPosition===Fh)return{error:ff};let o=a.filter(({roundNumber:l})=>t.roundNumbers?.includes(l)).map(vr);return e=e.filter(l=>!o.includes(l)),t.roundNumbers&&!e.length&&(e=o),{existingMatchUps:a,matchUpIds:e,structureId:r,structure:n}}function xse(t){let e=He(t,[{[In]:!0},{[PI]:{[cU]:!1,roundNumbers:!1},[Ba]:re,[qn]:sn}]);if(e.error)return e;let{removeIncomplete:i=!1,removeUnAssigned:r=!0,removeCompleted:n=!1,tournamentRecord:a,drawDefinition:s,event:o}=t,l=Ose(t);if(l.error)return l;let{structure:u,structureId:c,existingMatchUps:d,matchUpIds:p}=l,f=[],m=d?.filter(({matchUpId:I,score:v,winningSide:w})=>{if(w&&!n)return!1;if(w||fr({score:v})){if(!w&&!i)return!1;f.push(I)}else if(!r)return!1;return p?.includes(I)})??[],h=m.map(vr),g=m.map(({tieMatchUps:I})=>I?.map(vr)).filter(Boolean).flat();if(h.length){u.matchUps=(u.matchUps??[]).filter(({matchUpId:w})=>!h.includes(w)),ku({tournamentId:a?.tournamentId,matchUpIds:[...g,...h],action:"deleteAdHocMatchUps",eventId:o?.eventId,drawDefinition:s});let I=nt(u.matchUps.map(Pa("roundNumber"))),v=Bxe(I);if(v.length){v.reverse();for(let w of v)u.matchUps.forEach(y=>{y.roundNumber&&y.roundNumber>w&&(y.roundNumber-=1,Ut({tournamentId:a?.tournamentId,context:["adHoc round deletion"],eventId:o?.eventId,drawDefinition:s,matchUp:y}))})}if(f.length){u.positionAssignments=nt(u.matchUps.flatMap(U=>(U.sides??[]).map(T=>T.participantId)).filter(Boolean)).map(U=>({participantId:U}));let w=u?.matchUpFormat??s?.matchUpFormat??o?.matchUpFormat,y=l.existingMatchUps.some(U=>U.matchUpType===La)?{matchUpTypes:[La]}:void 0,{matchUps:b}=At({afterRecoveryTimes:!1,inContext:!0,matchUpFilters:y,structure:u,event:o});Hn({structure:u})&&(u.positionAssignments=nt(b.flatMap(U=>(U.sides??[]).map(T=>T.participantId)).filter(Boolean)).map(U=>({participantId:U})));let S=lV({positionAssignments:u.positionAssignments,tournamentRecord:a,drawDefinition:s,matchUpFormat:w,matchUps:b,event:o});S.error&&console.log(S)}ii({structureIds:[c],eventId:o?.eventId,drawDefinition:s})}return!h.length&&p.length?{error:tU}:{...W,deletedMatchUpsCount:[...h,...g].length}}function Fse({removeCompletedMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:r,roundNumber:n,event:a}){if(!e)return{error:ve};if(!i)return{error:$e};if(!n)return q({result:{error:Je},info:"roundNumber required"});let s=tt({drawDefinition:i,structureId:r});if(s.error)return s;let o=s.structure;return o?.structures?{error:ff}:Hn({structure:o})?lBe({tournamentId:e.tournamentId,removeCompletedMatchUps:t,eventId:a.eventId,drawDefinition:i,roundNumber:n,structure:o}):(console.log("not implemented"),{...W})}function lBe({removeCompletedMatchUps:t,drawDefinition:e,tournamentId:i,roundNumber:r,structure:n,eventId:a}){let s=n?.matchUps??[],o=[],l=[],u=!1;if(s.reduce((c,d)=>{let p=d?.roundNumber;return p?c.includes(p)?c:c.concat(p):c},[]).sort(nr).includes(r)){let c=s.filter(d=>{let p=d.roundNumber===r&&(!Ki.includes(d.matchUpStatus)||t);return p&&(l.push(d.matchUpId),d.tieMatchUps&&o.push(...d.tieMatchUps.map(vr))),!p});l.length&&(ku({matchUpIds:[...o,...l],drawDefinition:e,tournamentId:i,eventId:a}),c.some(d=>d.roundNumber===r)||(c.forEach(d=>{d.roundNumber>r&&(d.roundNumber-=1,Ut({drawDefinition:e,tournamentId:i,eventId:a,matchUp:d}))}),u=!0),n.matchUps=c)}return{deletedMatchUpsCount:l.length,roundRemoved:u,...W}}function dN(t){let{suppressNotifications:e,tournamentRecord:i,drawDefinition:r,matchUps:n,event:a}=t;if(typeof r!="object")return{error:$e};let s=t?.structureId;if(!s&&r.structures?.length===1&&(s=r.structures?.[0]?.structureId),typeof s!="string")return{error:qa};if(!Ka(n))return{error:re,info:zp("matchUps")};let o=r.structures?.find(p=>p.structureId===s);if(!o)return{error:vi};let l=(o?.matchUps).find(p=>!!p.roundPosition);if(o.structures||l||o.finishingPosition===Fh)return{error:ff};let u=Ur({tournamentRecord:i,inContext:!1})?.matchUps?.map(vr)??[],c=n.map(vr);if(xn(u,c))return{error:Tie,info:"One or more matchUpIds already present in tournamentRecord"};o.matchUps.push(...n);let d=n.map(({tieMatchUps:p})=>p).filter(Boolean).flat();return e||(Dd({tournamentId:i?.tournamentId,matchUps:[...d,...n],eventId:a?.eventId,drawDefinition:r}),ii({drawDefinition:r,structureIds:[s]})),{...W}}function Lse({tournamentRecord:t,drawDefinition:e,drawPosition:i,structureId:r,subOrder:n,event:a}){if(!e)return{error:$e};if(!r)return{error:qa};if(!i)return{error:Rv};let{structure:s}=tt({drawDefinition:e,structureId:r});if(!s)return{error:vi};let o=s;s.structures&&s.structureType===gn&&(o=s.structures?.find(f=>f.positionAssignments?.find(m=>m.drawPosition===i)));let l=o?.positionAssignments,u=l?.find(f=>f.drawPosition===i);u&&Ft({element:u,extension:{name:RI,value:n}});let c=(a?.eventType===ei||e.matchUpType===ei||(a?.tieFormat??e?.tieFormat??s?.tieFormat))&&{matchUpTypes:[ei]},{matchUps:d}=At({structure:o,afterRecoveryTimes:!1,inContext:!0,matchUpFilters:c,event:a}),p=s?.matchUpFormat??e.matchUpFormat;return lV({positionAssignments:l,tournamentRecord:t,drawDefinition:e,matchUpFormat:p,matchUps:d,event:a}),ii({drawDefinition:e,structureIds:[r]}),{...W}}var _se={};dt(_se,{addGoesTo:()=>Wp,allPlayoffPositionsFilled:()=>J2,checkValidEntries:()=>hN,findDrawDefinition:()=>yV,getAssignedParticipantIds:()=>Df,getAvailableMatchUpsCount:()=>pN,getAvailablePlayoffProfiles:()=>jU,getDrawDefinitionTimeItem:()=>f2,getDrawParticipantRepresentativeIds:()=>IV,getDrawStructures:()=>io,getDrawTypeCoercion:()=>KU,getEligibleVoluntaryConsolationParticipants:()=>gV,getMatchUpsMap:()=>kr,getParticipantIdFinishingPositions:()=>vV,getPositionAssignments:()=>AI,getPositionsPlayedOff:()=>Yv,getRandomQualifierList:()=>SV,getSeedingThresholds:()=>W2,getSeedsCount:()=>XU,getStructureSeedAssignments:()=>hs,getTeamLineUp:()=>Hp,getValidGroupSizes:()=>LU,isAdHoc:()=>Hn,isCompletedStructure:()=>Su,isValidForQualifying:()=>UV,positionActions:()=>wV});function gV({excludedMatchUpStatuses:t=[],includeEventParticipants:e,includeQualifyingStage:i,finishingRoundLimit:r,policyDefinitions:n,roundNumberLimit:a,tournamentRecord:s,drawDefinition:o,matchUpsLimit:l,requirePlay:u,requireLoss:c,allEntries:d,winsLimit:p,event:f}){if(!o)return{error:$e};let m=[Ae,Ti];i&&m.push(ze);let h=f?.eventType?{matchUpTypes:[f.eventType]}:void 0,g=o?.matchUpType?{matchUpTypes:[o.matchUpType]}:void 0,I=e&&f?xu({contextFilters:{stages:m},matchUpFilters:h,tournamentRecord:s,inContext:!0,event:f})?.matchUps??[]:An({contextFilters:{stages:m},matchUpFilters:g,tournamentRecord:s,inContext:!0,drawDefinition:o})?.matchUps??[],v=$h({stage:Rr,drawDefinition:o}),w=new Set(v.map(({participantId:F})=>F)),y={},b={},S={},U={};n??=jc({policyTypes:[gx],tournamentRecord:s,drawDefinition:o,event:f}).policyDefinitions;let T=n?.[gx];t=t.length&&t||T?.excludedMatchUpStatuses||[],e=e??T?.includeEventParticipants,d=d??T?.allEntries,r=r??T?.finishingRoundLimit,a=a??T?.roundNumberLimit,l=l??T?.matchUpsLimit,u??=T?.requirePlay??!0,c??=T?.requireLoss??!0,p=p??T?.winsLimit;for(let F of I){if(u&&F.winningSide&&![1,2].includes(F.winningSide)&&F.matchUpStatus!==Si||F.finishingRound&&r&&F.finishingRound>=r||F.finishingRound&&a&&F.finishingRound<=a)continue;let x=F.sides?.find(({sideNumber:$})=>F.winningSide&&$===3-F.winningSide),L=F.sides?.find(({sideNumber:$})=>F.winningSide&&$===F.winningSide);if(F.sides?.forEach($=>{let V=$?.participant?.participantId;V&&(S[V]=$.participant,F.matchUpStatus===Si&&!u&&(b[V]=$.participant,y[V]||(y[V]=0),(!F.matchUpStatus||!t.includes(F.matchUpStatus))&&(y[V]+=1)))}),x?.participant){let $=x.participant.participantId;b[$]=x.participant,y[$]||(y[$]=0),F.matchUpStatus&&!t.includes(F.matchUpStatus)&&(y[$]+=1)}if(L?.participant){let $=L.participant.participantId;U[$]||(U[$]=0),U[$]+=1,y[$]||(y[$]=0),F.matchUpStatus&&!t.includes(F.matchUpStatus)&&(y[$]+=1)}}let P=s?.participants&&!u&&!c&&d,D;e&&f?D=f.entries:D=o.entries;let E=P?(D??[]).filter(F=>![bu,Us].includes(F.entryStatus)).map(({participantId:F})=>F):[],R=Object.keys(b),C=P?(s?.participants??[]).filter(({participantId:F})=>E.includes(F)):c&&Object.values(b)||Object.values(S),M=F=>!c||R.includes(F),N=F=>!u||(y[F]||0)>=0,A=F=>!p||(U[F]||0)<=p,O=F=>!l||y[F]<=l,k=F=>!w.has(F);return{eligibleParticipants:C.filter(F=>M(F.participantId)&&N(F.participantId)&&A(F.participantId)&&O(F.participantId)&&k(F.participantId)).map(F=>({...F,individualParticipants:F.individualParticipantIds?.map(x=>s?.participants?.find(L=>L.participantId===x))})),losingParticipantIds:R,...W}}function pN(t){let e=He(t,[{drawDefinition:!0}]);if(e.error)return e;let{drawDefinition:i,roundNumber:r}=t,n=t.structureId??(i.structures?.length===1&&i.structures?.[0]?.structureId);if(typeof n!="string")return{error:qa};let a=i.structures?.find(m=>m.structureId===n);if(!a)return{error:vi};let s,o=(a.matchUps??[])?.reduce((m,h)=>(h.roundPosition&&(s=!0),(h?.roundNumber||0)>m?h.roundNumber:m),0);if(a.structures||s||a.finishingPosition===Fh)return{error:ff};let l=i?.entries?.filter(m=>{let h=m.entryStatus;return uo.includes(h)})??[],u=Math.floor(l?.length/2)||1,c=r??o??1,d=a.matchUps?.filter(m=>m.roundNumber===c)?.length??0,p=u-d,f=p>0?p:0;return{...W,availableMatchUpsCount:f,lastRoundNumber:o,roundMatchUpsCount:u}}function IV({drawDefinition:t}){let e=ht({name:"participantRepresentatives",element:t});return e.error?e:{representativeParticipantIds:e.extension?.value||[]}}function uBe({tournamentParticipants:t,drawDefinition:e,event:i}){if(!e)return{error:$e};let r=Zi({tournamentParticipants:t,inContext:!0,drawDefinition:e,event:i}),n=Oe(r.matchUps,!1,!0),a=nt(n.reduce((o,l)=>o.concat(...l.sides.map(u=>u.participantId).filter(Boolean)),[])),s=Object.assign({},...a.map(o=>{let l=n.filter(u=>u.sides.map(c=>c.participantId).filter(Boolean).includes(o));return{[o]:l}}));return{participantIds:a,participantIdMatchUps:s}}function AI({tournamentRecord:t,drawDefinition:e,stage:i=Ae,structureId:r,structure:n}){if(!t)return{error:ve};if(!n&&!e)return{error:$e};if(!n&&!r&&e?.structures?.filter(o=>o.stage===i).length===1&&(n=e.structures.find(o=>o.stage===i)),!n&&!r)return{error:qa};let{error:a,positionAssignments:s}=Kt({drawDefinition:e,structureId:r,structure:n});return{positionAssignments:s??[],structureId:n?.structureId,error:a}}function $se({dates:t=[],extension:e}){if(!e)return!1;if(typeof e.value=="boolean"&&e.value)return!0;if(!t.length)return!1;let i=wt(e.value)?e.value?.dates:void 0;if(Array.isArray(i))return i?.length?!!i.filter(r=>!t.length||t.includes(r)).length:!1}function cBe({inContextCourt:t,venue:e}){let{defaultStartTime:i,defaultEndTime:r,dateAvailability:n}=e;if(!(i||r||n?.length))return;let a=t.dateAvailability;if(!a?.length){n?.length?t.dateAvailability=n.map(s=>({...s})):i&&r&&(t.dateAvailability=[{startTime:i,endTime:r}]);return}t.dateAvailability=a.map(s=>{let o=dBe({date:s.date,venueDateAvailability:n,defaultStartTime:i,defaultEndTime:r});if(!o)return s;let l=pBe(s.startTime,o.startTime),u=fBe(s.endTime,o.endTime),c=mBe(s.bookings,o.bookings);return{...s,startTime:l,endTime:u,...c.length?{bookings:c}:{}}})}function dBe({date:t,venueDateAvailability:e,defaultStartTime:i,defaultEndTime:r}){if(e?.length){if(t){let a=e.find(s=>s.date===t);if(a)return a}let n=e.find(a=>!a.date);if(n)return n}if(i||r)return{startTime:i,endTime:r}}function pBe(t,e){return t?e?t>e?t:e:t:e}function fBe(t,e){return t?e?t<e?t:e:t:e}function mBe(t,e){let i=[];return t?.length&&i.push(...t),e?.length&&i.push(...e),i}function Bse({convertExtensions:t,ignoreDisabled:e,venue:i,court:r}){let n={...Oe(r,t,!0),venueId:i.venueId},{extension:a}=ht({name:bo,element:r});if(e&&a){let s=wt(a.value)?a.value?.dates:void 0,o=a?.value===!0?[]:n.dateAvailability.map(l=>{let u=l.date;if(!(!u||s.includes(u)))return l}).filter(Boolean);n.dateAvailability=o}return cBe({inContextCourt:n,venue:i}),{inContextCourt:n}}function hBe(t,e,i){if(e.length&&!e.includes(t.venueId))return!1;if(i){let{extension:r}=ht({name:bo,element:t});if(r?.value)return!1}return!0}function gBe({venue:t,convertExtensions:e,ignoreDisabled:i,dates:r,uniqueVenueIds:n,venues:a,uniqueCourtIds:s,courts:o}){n.includes(t.venueId)||(a.push(Oe(t,e,!0)),n.push(t.venueId));for(let l of t.courts??[])if(!s.includes(l.courtId)){if(i){let{extension:c}=ht({name:bo,element:l});if($se({extension:c,dates:r}))continue}let{inContextCourt:u}=Bse({convertExtensions:e,ignoreDisabled:i,venue:t,court:l});o.push(u),s.push(l.courtId)}}function Fu(t){let{convertExtensions:e,ignoreDisabled:i,venueIds:r=[],dates:n}=t,a=t.tournamentRecords||t.tournamentRecord&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord}||{},s=[],o=[],l=[],u=[];return Object.keys(a).filter(c=>!t.tournamentId||c===t.tournamentId).forEach(c=>{let d=a[c];for(let p of d.venues??[])hBe(p,r,!!i)&&gBe({venue:p,convertExtensions:e,ignoreDisabled:i,dates:n,uniqueVenueIds:s,venues:u,uniqueCourtIds:o,courts:l})}),{courts:l,venues:u,...W}}function IBe({convertExtensions:t,tournamentRecord:e,ignoreDisabled:i,dates:r}){if(!e)return{error:Mi};let n=Oe(e.venues??[],t).filter(s=>{if(!i)return s;let{extension:o}=ht({name:bo,element:s});return!o?.value&&s}).filter(Boolean),a=n.reduce((s,o)=>{let l=(o?.courts||[]).filter(u=>{if(!i&&!r?.length)return u;let{extension:c}=ht({name:bo,element:u});return $se({extension:c,dates:r})}).filter(Boolean).map(u=>{let{inContextCourt:c}=Bse({convertExtensions:t,ignoreDisabled:i,venue:o,court:u});return c});return l.length?s.concat(l):s},[]);return{venues:n,courts:a}}function qU({tournamentRecords:t,requireCourts:e,dates:i}){return typeof t!="object"||!Object.keys(t).length?{error:Mi}:Object.keys(t).reduce((r,n)=>{let a=t[n],{venues:s}=IBe({tournamentRecord:a,dates:i});return s?.forEach(o=>{let{venueId:l,courts:u}=o;(!e||u?.length)&&!r.venueIds.includes(l)&&(r.venues.push(o),r.venueIds.push(l))}),r},{venues:[],venueIds:[]})}function Vse({event:t}){let{surfaceCategory:e,onlineResources:i,matchUpFormat:r,discipline:n,eventLevel:a,eventName:s,eventType:o,startDate:l,category:u,ballType:c,eventId:d,endDate:p,gender:f,notes:m}=t;return{eventInfo:{drawDefinitionCount:t.drawDefinitions?.length,surfaceCategory:e,onlineResources:i,matchUpFormat:r,discipline:n,eventLevel:a,eventName:s,eventType:o,ballType:c,startDate:l,category:u,endDate:p,eventId:d,gender:f,notes:m}}}var vBe="IN_PROGRESS",yBe="ABANDONED",bBe="CANCELLED",wBe="COMPLETED",SBe="ACTIVE",jse="tournamentImage",Gse={TOURNAMENT_IMAGE_RESOURCE_NAME:jse,IN_PROGRESS:vBe,ABANDONED:yBe,CANCELLED:bBe,COMPLETED:wBe,ACTIVE:SBe},UBe={[Lv]:{policyName:"Staff Privacy Policy",participant:{contacts:!1,individualParticipants:!1,individualParticipantIds:!1,onlineResources:!1,participantName:!0,participantOtherName:!0,participantId:!0,participantRole:!0,participantRoleResponsibilities:!0,participantStatus:!0,penalties:!1,representing:!0,participantType:!0,person:{addresses:!1,biographicalInformation:!1,birthDate:!1,contacts:!1,nationalityCode:!0,nativeFamilyName:!1,nativeGivenName:!1,onlineResources:!1,otherNames:!0,parentOrganisationId:!1,passportFamilyName:!1,passportGivenName:!1,personId:!1,personOtherIds:!1,previousNames:!1,sex:!1,standardFamilyName:!0,standardGivenName:!0,status:!1,tennisId:!1,wheelchair:!0}}}},TBe=UBe;function Qh(t){let{tournamentRecord:e,withMatchUpStats:i,withStructureDetails:r,withVenueData:n}=t??{};if(!e)return{error:ve};let a=(({tournamentId:m,tournamentRank:h,tournamentStatus:g,formalName:I,tournamentName:v,promotionalName:w,onlineResources:y,localTimeZone:b,activeDates:S,startDate:U,endDate:T,hostCountryCode:P,venues:D,notes:E,updatedAt:R})=>({tournamentId:m,tournamentRank:h,tournamentStatus:g,formalName:I,tournamentName:v,promotionalName:w,onlineResources:y,localTimeZone:b,activeDates:S,startDate:U,endDate:T,hostCountryCode:P,venues:D,notes:E,updatedAt:R}))(e),s=e.venues?.find(m=>m.isPrimary);s?.addresses?.length&&(a.tournamentAddress=s.addresses[0]);let o=Ri({participantFilters:{participantRoles:[Pae,L2,Eae,Rae,Mae]},policyDefinitions:TBe,tournamentRecord:e})?.participants??[];o&&(a.tournamentContacts=o);let l=e?.onlineResources?.find(m=>m.name===jse&&m.resourceType==="URL")?.identifier;l&&(a.imageUrl=l);let u=zh({tournamentRecord:e})?.publishState,c=u?.tournament?.status?.publishedEventIds||[],d=[];for(let m of e.events??[])if(!t?.usePublishState||c.includes(m.eventId)){let h=Vse({event:m}).eventInfo;h&&d.push(h)}a.timeItemValues=Rse({element:e}),a.publishState=u?.tournament,a.eventInfo=d;let p=[],f=[];if(i||r)for(let m of e.events??[])for(let h of m.drawDefinitions??[])for(let g of h.structures??[])f.push(...g.matchUps??[]),p.push(je({eventId:m.eventId,eventName:m.eventName,eventType:m.eventType,drawId:h.drawId,drawName:h.drawName,drawType:h.drawType,structureId:g.structureId,structureName:g.structureName,stage:g.stage,stageSequence:g.stageSequence,positionAssignments:g.positionAssignments,seedAssignments:g.seedAssignments,matchUpFormat:g.matchUpFormat}));if(r&&(a.structures=p),i){let m=e.participants?.filter(S=>S.participantType===It).length??0,h=e.participants?.filter(S=>S.participantType===_t).length??0,g=e.events?.length??0,I=f?.filter(S=>S.matchUpStatus!=="BYE"),v=I?.length,w=I?.filter(S=>Ki.includes(S.matchUpStatus)||S.winningSide)?.length,y=I?.filter(S=>Tf({matchUp:S})?.scheduledDate||T2({matchUp:S})?.scheduledTime)?.length,b=v>0?Math.round(w/v*100):0;a.matchUpStats={total:v,completed:w,scheduled:y,percentComplete:b},a.individualParticipantCount=m,a.teamParticipantCount=h,a.eventCount=g}if(n){let{venues:m}=Fu({tournamentRecord:e});a.venues=m??[]}return{tournamentInfo:Oe(je(a),!1,!0),...W}}function Hse({publishStatus:t,drawId:e}){return t?.drawDetails?jo(t.drawDetails?.[e]?.publishingDetail):t?.drawIds?t.drawIds.includes(e):!0}var Wse="PUBLIC",DBe="ADMIN",PBe={PUBLIC_DISPLAY:Wse,ADMIN_DISPLAY:DBe};function fN(t){let{tournamentParticipants:e=[],includePositionAssignments:i,policyDefinitions:r,tournamentRecord:n,inContext:a=!0,usePublishState:s,status:o=Xa,pressureRating:l,refreshResults:u,contextProfile:c,drawDefinition:d,noDeepCopy:p,sortConfig:f,context:m,event:h}=t;if(!d)return{error:$e};let{matchUpFormat:g,updatedAt:I,drawType:v,drawName:w,drawId:y}=d,b={matchUpFormat:g,updatedAt:I,drawName:w,drawType:v,drawId:y};b.display=ht({element:d,name:$P}).extension?.value;let S={},U,T,{allStructuresLinked:P,sourceStructureIds:D,hasDrawFeedProfile:E,structureGroups:R}=nN({drawDefinition:d});if(!P)return{error:Ete};let C=t?.eventPublishState??zh({event:h}).publishState,M=t?.publishStatus??Qa({event:h,status:o}),N=C?.status?.drawDetails?.[d.drawId],A=!!C?.status?.published,O=N?.structureDetails,k=!1,F=!1,x=R.map(L=>{let $={},V=L.map(_=>{let{structure:B}=tt({drawDefinition:d,structureId:_}),{seedAssignments:G}=hs({drawDefinition:d,structure:B});return B?.stage===Ae&&B.stageSequence===1&&(U=G),B?.stage===ze&&(S[B.stageSequence??0]=G),B}).sort((_,B)=>_h(_,B,f)).map(_=>{if(!_)return;let B=_?.structureId,G=[];_.stage&&[Ae,tn,Ti].includes(_.stage)&&(G=U),_?.stage===ze&&(G=S[_.stageSequence??0]);let{matchUps:j,roundMatchUps:K,roundProfile:Y}=At({seedAssignments:_?.seedAssignments?.length?void 0:G,context:{drawId:b.drawId,...m},hydrateParticipants:t.hydrateParticipants,participantsProfile:t.participantsProfile,tournamentParticipants:e,policyDefinitions:r,tournamentRecord:n,usePublishState:s,publishStatus:M,contextProfile:c,drawDefinition:d,inContext:a,structure:_,event:h}),{positionAssignments:X}=Kt({structure:_}),Z=X?.filter(Pa(Iu)).map(ne=>{let le=ht({element:ne,name:Tc})?.extension?.value,{drawPosition:de,participantId:pe}=ne;return F=!0,{participantResult:le,participantId:pe,drawPosition:de}});if(j.length&&(!Z?.length&&t.allParticipantResults||u&&!_.structures)){let{subOrderMap:ne}=k2({positionAssignments:X}),le=j.some(pe=>pe.matchUpType===La)?j.filter(pe=>pe.matchUpType===La):j,de=Wh({matchUpFormat:_.matchUpFormat,matchUps:le,policyDefinitions:r,pressureRating:l,subOrderMap:ne});T=de?.report,Z=X?.filter(Pa(Iu)).map(pe=>{let{drawPosition:ge,participantId:Me}=pe;return F=!0,{participantResult:Me&&de?.participantResults?.[Me],participantId:Me,drawPosition:ge}})}let J=_?{stageSequence:_.stageSequence,structureName:_.structureName,structureType:_.structureType,matchUpFormat:_.matchUpFormat,stage:_.stage}:{},ae=ht({element:_,name:$P}).extension?.value;J.display=ae?.[Wse]??ae,J.sourceStructureIds=D[B],J.hasDrawFeedProfile=E[B],J.positionAssignments=X,J.structureActive=j.reduce((ne,le)=>{let de=[Si,Wi,lo,Oi,Rl,qt,Sr,ai].includes(le.matchUpStatus);return ne||de||!!le.winningSide||!!le.score?.scoreStringSide1},!1);let te=j.every(ne=>[...Ki,"BYE"].includes(ne.matchUpStatus));return J.structureCompleted=te,$[B]=te,J.structureActive&&(k=!0),{...J,participantResults:Z,seedAssignments:G,roundMatchUps:K,roundProfile:Y,structureId:B,report:T}});return V.forEach(_=>{i||delete _.positionAssignments,_.sourceStructuresComplete=_.sourceStructureIds?.every(B=>$[B])}),V}).flat().filter(L=>!s||jo(O?.[L?.structureId])||!0);return b.drawActive=k,b.participantPlacements=F,b.drawGenerated=x?.reduce((L,$)=>L||!!$?.roundMatchUps,!1),b.drawCompleted=x?.reduce((L,$)=>L&&$.structureCompleted,!0),b.drawPublished=s?A&&Hse({publishStatus:M,drawId:b.drawId}):void 0,{structures:!s||b.drawPublished?p&&x||Oe(x,!1,!0):void 0,drawInfo:p?b:Oe(b,!1,!0),...W}}function YU(t){let{includePositionAssignments:e,participantsProfile:i,policyDefinitions:r,usePublishState:n,status:a=Xa,contextProfile:s,sortConfig:o}=t,l=He(t,[{tournamentRecord:!0},{[jB]:{event:!1,eventId:!1}}]);if(l.error)return l;let u=Oe(t.tournamentRecord,!1,!0),c=t.event==null?Wn({tournamentRecord:u,eventId:t.eventId}).event:void 0,d=t.event?Oe(t.event,!1,!0):c&&Oe(c,!1,!0)||void 0;if(!d)return{error:ps};let{eventId:p}=d,{tournamentId:f,endDate:m}=u,h=Qa({event:d,status:a}),g=zh({event:d}).publishState??{},I=!!g?.status?.published,{participants:v}=Ri({participantFilters:t.participantFilters,withEvents:!1,withDraws:!1,policyDefinitions:r,...i,tournamentRecord:u}),w=({stage:C,drawId:M})=>{if(!n)return!0;let N=h?.drawDetails?.[M]?.stageDetails;return!N||!Object.keys(N).length?!0:jo(N[C])},y=({structureId:C,drawId:M})=>{if(!n)return!0;let N=h?.drawDetails?.[M]?.structureDetails;return!N||!Object.keys(N).length?!0:jo(N[C])},b=({drawId:C})=>n?Hse({publishStatus:h,drawId:C}):!0,S=({drawId:C,drawType:M,structure:N})=>{if(!n||M!==la)return N;let A=h?.drawDetails?.[C]?.structureDetails?.[N.structureId]?.roundLimit;if(lt(A)){let O=Ce(1,A+1),k={},F={};for(let x of O)N.roundMatchUps[x]&&(k[x]=N.roundMatchUps[x],F[x]=N.roundProfile[x]);N.roundMatchUps=k,N.roundProfile=F}return N},U=d.drawDefinitions||[],T=!n||I?U.filter(b).map(C=>(({drawInfo:M,structures:N})=>({...M,structures:N}))(fN({allParticipantResults:t.allParticipantResults,hydrateParticipants:t.hydrateParticipants,context:{eventId:p,tournamentId:f,endDate:m},pressureRating:t.pressureRating,refreshResults:t.refreshResults,includePositionAssignments:e,tournamentParticipants:v,eventPublishState:g,noDeepCopy:!0,policyDefinitions:r,tournamentRecord:u,usePublishState:n,contextProfile:s,drawDefinition:C,publishStatus:h,sortConfig:o,event:d}))).map(({structures:C,...M})=>{let N=C?.filter(({stage:A,structureId:O})=>y({structureId:O,drawId:M.drawId})&&w({stage:A,drawId:M.drawId})).map(A=>S({drawId:M.drawId,drawType:M.drawType,structure:A}));return{...M,structures:N}}).filter(C=>C.structures?.length):void 0,P=(Array.isArray(u.venues)?u.venues:[]).map(C=>{let{venueData:M}=MI({venueId:C.venueId,tournamentRecord:u});return{...M}}),D=(({eventId:C,eventName:M,eventType:N,eventLevel:A,surfaceCategory:O,matchUpFormat:k,category:F,gender:x,startDate:L,endDate:$,ballType:V,discipline:_})=>({eventId:C,eventName:M,eventType:N,eventLevel:A,surfaceCategory:O,matchUpFormat:k,category:F,gender:x,startDate:L,endDate:$,ballType:V,discipline:_}))(d);D.display=ht({element:d,name:$P}).extension?.value;let{tournamentInfo:E}=Qh({tournamentRecord:u}),R={tournamentInfo:E,venuesData:P,eventInfo:D,drawsData:T};return R.eventInfo.publishState=g,R.eventInfo.published=g?.status?.published,{...W,eventData:R,participants:v}}function vV({byeAdvancements:t=!1,tournamentRecord:e,drawDefinition:i,event:r}){if(!i)return{error:$e};let{participantIds:n,participantIdMatchUps:a}=uBe({tournamentParticipants:e?.participants,drawDefinition:i}),s=Object.values(a).some(p=>p.some(f=>f.containerStructureId)),o=(s&&YU({tournamentRecord:e,event:r}))?.eventData?.drawsData?.find(p=>p.drawId===i.drawId)?.structures,l=i?.structures?.find(p=>p.stage===Ae&&p.stageSequence===1),u=l?.structureType===gn&&l.structures,c=(s?AI({tournamentRecord:e,drawDefinition:i,structureId:l?.structureId})?.positionAssignments:void 0)?.length||0,d=n?.map(p=>{let f=a[p].filter(I=>[Oi,"BYE"].includes(I.matchUpStatus)||I.winningSide),m=f.map(I=>{let v=I.sides.find(y=>y.bye),w=I.sides.find(y=>y.participantId===p).sideNumber;if(I.containerStructureId){let y=EBe({containedStructures:u,drawPositionsCount:c,drawDataStructures:o,drawDefinition:i,participantId:p,matchUp:I});if(y)return y}return(I.winningSide||t&&v&&w)===w?I.finishingPositionRange.winner:I.finishingPositionRange.loser}),h=I=>Math.abs(I[0]-I[1]),g=m.reduce((I,v)=>I&&h(I)<h(v)?I:v,void 0);return{[p]:{finishingPositionRanges:m,finishingPositionRange:g,relevantMatchUps:f}}})||[];return Object.assign({},...d)}function EBe({containedStructures:t,drawPositionsCount:e,drawDataStructures:i,drawDefinition:r,participantId:n,matchUp:a}){let s=t?.find(f=>f.structureId===a.structureId)?.positionAssignments?.length,o=i.find(f=>f.structureId===a.containerStructureId)?.participantResults?.find(f=>f.participantId===n)?.participantResult,{ties:l,groupOrder:u,provisionalOrder:c}=o||{},d=t?.length,p=r.structure?.find(f=>f.stage===Ti);if(oa()&&console.log({drawPositionsCount:e,provisionalOrder:c,bracketsCount:d,bracketSize:s,groupOrder:u,ties:l}),e===s&&u)return[u,u];if(d>1&&u&&!p)return[1,d];if(d>1&&u&&p){let f=r.links?.find(h=>h.source.structureId===a.containerStructureId)?.source?.finishingPositions,m=f.length*d;if(u in f)return[1,m];{let h=(s-u)*d;return[m+1,e-h]}}}function ep({tournamentRecords:t,tournamentRecord:e,tournamentId:i,drawId:r}){if(!e&&!t)return{error:ve};if(!r)return{error:xo};if(!e&&t){if(typeof i!="string"&&(i=Pse({tournamentRecords:t,drawId:r}),!i))return{error:II};if(e=t[i],!e)return{error:ve}}let n=e&&Wn({tournamentRecord:e,drawId:r});return n?.drawDefinition?{drawDefinition:n.drawDefinition,event:n.event,tournamentRecord:e,...W}:q({result:{error:_a},stack:"findDrawDefinition"})}function yV(t){let{drawDefinition:e,error:i}=ep(t);return i?{error:i}:{drawDefinition:Oe(e)}}function RBe({tournamentParticipants:t,returnParticipants:e,drawPosition:i,participant:r,drawId:n,event:a}){let s=a?.entries?.filter(({entryStatus:o})=>[Us,wf].includes(o)).map(({participantId:o})=>o)||[];if(s.length){let o=r.individualParticipantIds,l=e?t.filter(({participantId:c})=>s.includes(c)):void 0,u=e?t.filter(({participantId:c})=>o.includes(c)):void 0;return{validModifyAssignedPairAction:je({payload:{participantId:r.participantId,replacementIndividualParticipantId:void 0,existingIndividualParticipantId:void 0,drawPosition:i,drawId:n},method:M$e,availableIndividualParticipantIds:s,availableIndividualParticipants:l,existingIndividualParticipantIds:o,existingIndividualParticipants:u,type:tV},!1,!1,!0)}}return{}}function Yp(t){let{inContextDrawMatchUps:e,targetData:i,drawDefinition:r,relevantLink:n}=t;if(n?.linkCondition===fl&&i?.matchUp?.matchUpStatus==="BYE")return!1;let{targetMatchUps:{loserMatchUp:a,winnerMatchUp:s},targetLinks:o}=i,l=a&&Fn({matchUpId:a.matchUpId,inContextDrawMatchUps:e,drawDefinition:r}),u=l?.targetMatchUps?.loserMatchUp,c=l?.targetMatchUps?.loserMatchUpDrawPositionIndex,d=u?.sides[c]?.participant,p=Lr(a?.matchUpStatus),f=p&&!d,m=a?.sides?.filter(w=>w?.participant).length??0,h=a?.winningSide&&p&&m===1,g=s?.drawPositions?.filter(Boolean).length||0;if(!h&&(a?.winningSide&&!f||s?.winningSide&&g===2&&(!s.feedRound||!Lr(s?.matchUpStatus))))return!0;let I=s&&Fn({matchUpId:s.matchUpId,inContextDrawMatchUps:e,drawDefinition:r}),v=l&&Yp({relevantLink:o?.loserTargetLink,targetData:l,inContextDrawMatchUps:e,drawDefinition:r});return!!(I&&Yp({targetData:I,inContextDrawMatchUps:e,drawDefinition:r})||v)}var zse={[yu]:{policyName:"positionActionsDefault",enabledStructures:[{stages:[ze,Ae],stageSequences:[1],enabledActions:[],disabledActions:[]},{stages:[],stageSequences:[],enabledActions:[nw,qm,aN,gm],disabledActions:[]}],disbledStructures:[],otherFlightEntries:!1,activePositionOverrides:[]}},ID="positionAction",Ax="matchUpAction";function qse({actionType:t=ID,appliedPolicies:e,drawDefinition:i,structure:r}){let n=t===ID&&yu||t===Ax&&Cr,a=t===ID&&zse||t===Ax&&Dae,s=n&&(e?.[n]||a?.[n]),o=i.links?.filter(d=>d?.target?.structureId===r?.structureId)?.map(({target:d})=>d.feedProfile)??[],{enabledStructures:l,disabledStructures:u}=s||{},c=u?.find(d=>{let{stages:p,stageSequences:f,structureTypes:m,feedProfiles:h}=d;return(!h?.length||Array.isArray(h)&&h.some(g=>o.includes(g)))&&(!p?.length||Array.isArray(p)&&p?.includes(r?.stage))&&(!m?.length||Array.isArray(m)&&m?.includes(r?.structureType))&&(!f?.length||Array.isArray(f)&&f.includes(r?.stageSequence))});return{enabledStructures:l,actionsDisabled:c,actionsPolicy:s}}function CBe({activePositionOverrides:t,activeDrawPositions:e,action:i}){return i&&t.includes(i)?!0:!e.length}function Yse({enabledStructures:t,drawDefinition:e,structure:i}){if(t===!1)return{};if(!t?.length)return{policyActions:{enabledActions:[],disabledActions:[]}};let{stage:r,stageSequence:n,structureType:a}=i||{},s=e.links?.filter(o=>o?.target?.structureId===i?.structureId)?.map(({target:o})=>o.feedProfile)||[];return{policyActions:t.find(o=>{let{stages:l,stageSequences:u,structureTypes:c,feedProfiles:d}=o||{},p=!l?.length||Array.isArray(l)&&l.includes(r),f=!u?.length||Array.isArray(u)&&u.includes(n),m=!c?.length||Array.isArray(c)&&c.includes(a),h=!d?.length||Array.isArray(d)&&d.some(g=>s.includes(g));return f&&m&&h&&o&&p})}}function Zn({action:t,policyActions:e}){let i=!e?.enabledActions||e?.disabledActions?.length&&e.disabledActions.includes(t);return i?!1:(e?.enabledActions.length===0||e?.enabledActions.includes(t))&&!i}var Kse="replaceTieMatchUpParticipantId",Xse="assignTieMatchUpParticipantId",kx="removeTieMatchUpParticipantId",fq="assignMatchUpSideParticipant",MBe="removeMatchUpSideParticipant",Jse="substituteParticipant",Ox="REMOVE_SUBSTITUTION",Qse="REPLACE_PARTICIPANT",bV="REMOVE_PARTICIPANT",xx="setMatchUpStatus",Fx="SUBSTITUTION",Zse="SCHEDULE",NBe="PENALTY",Lx="REFEREE",eoe="STATUS",_x="START",toe="SCORE",ABe={REPLACE_TEAM_POSITION_METHOD:Kse,ASSIGN_TEAM_POSITION_METHOD:Xse,REMOVE_TEAM_POSITION_METHOD:kx,REPLACE_PARTICIPANT:Qse,SUBSTITUTION_METHOD:Jse,REMOVE_SUBSTITUTION:Ox,REMOVE_PARTICIPANT:bV,SCHEDULE_METHOD:xx,SUBSTITUTION:Fx,SCHEDULE:Zse,PENALTY:NBe,REFEREE:Lx,STATUS:eoe,SCORE:toe,START:_x,END:"END"};function kBe({specifiedPolicyDefinitions:t,inContextDrawMatchUps:e,matchUpParticipantIds:i,matchUpActionsPolicy:r,inContextMatchUp:n,policyActions:a,enforceGender:s,participantId:o,sideNumber:l,matchUpId:u,matchUp:c,drawId:d,side:p}){let f=[],m=n.sides?.find(M=>M.participant),h=Aa(n.gender)&&n.sideNumber&&n.sides?.filter(M=>M.particiapntId).length===1&&m?.participant?.person?.sex,g=n.matchUpType,I=(s??r?.participants?.enforceGender)!==!1?n.gender:void 0,v=n.sides?.flatMap(M=>M.participant?.individualParticipants||M.participant).filter(Boolean)?.map(yt),w=n.sides?.filter(M=>!l||M.sideNumber===l).flatMap(M=>M.participant?.individualParticipants||M.participant).filter(Boolean),y=w?.map(yt),b=e?.find(M=>M.matchUpId===n.matchUpTieId)?.sides?.map(M=>M?.participant?.individualParticipants?.filter(({participantId:N,person:A})=>!y?.includes(N)&&(!I||du(I)||A.sex===I||Aa(I)&&!h||h&&A.sex!==h))),S=l?b?.[l-1]:b?.map((M,N)=>({participants:M,sideNumber:N+1})),U=l?b?.[l-1]?.map(yt):b?.map((M,N)=>({participants:M?.map(yt),sideNumber:N+1})),T=l&&(Pi(dm)(g)&&!y?.length||Pi(Lp)(g)&&(y?.length??0)<2)||!l&&(Pi(dm)(g)&&(y?.length??0)<2||Pi(Lp)(g)&&(y?.length??0)<4),P=U?.filter(M=>!v?.includes(M)),D=S?.filter(({participantId:M})=>P.includes(M));if(T&&P?.length&&f.push({availableParticipantIds:P,method:Xse,availableParticipants:D,type:zm,payload:{participantId:void 0,tieMatchUpId:u,sideNumber:l,drawId:d}}),y?.length&&(!fr(c)||p?.substitutions?.length)&&f.push({method:kx,type:bV,existingParticipantIds:y,payload:{participantId:void 0,tieMatchUpId:u,drawId:d}}),D?.length&&(!l&&y?.length||l&&p?.participant)&&f.push({availableParticipantIds:P,method:Kse,availableParticipants:D,type:Qse,existingParticipantIds:y,payload:{existingParticipantId:void 0,participantId:void 0,tieMatchUpId:u,drawId:d}}),Zn({policyActions:a,action:Ox})&&p?.substitutions?.length){let M=p.participant?.participantType===It&&[p.participantId]||p.participant?.participantType===ft&&p.participant.individualParticipantIds||[],N=p.substitutions.map(A=>A.participantId).filter(A=>M.includes(A));(!o||N.includes(o))&&f.push({method:kx,type:Ox,substitutedParticipantIds:N,payload:{participantId:void 0,tieMatchUpId:u,drawId:d}})}let E=t?.[Cr],R=E?.substituteWithoutScore,C=E?.substituteAfterCompleted;if(Zn({policyActions:a,action:Fx})&&i.length===2&&(!l&&y?.length||l&&p?.participant)&&(R||fr(c))&&(C||c.matchUpStatus&&!Ki.includes(c.matchUpStatus))&&w?.length&&S.length){let M=w.map(yt);f.push({info:"list of team players available for substitution",method:Jse,availableParticipantIds:U,existingParticipantIds:M,availableParticipants:S,existingParticipants:w,type:Fx,payload:{substituteParticipantId:void 0,existingParticipantId:void 0,sideNumber:l,matchUpId:u,drawId:d}})}return f}function OBe({tournamentParticipants:t=[],possiblyDisablingAction:e,activeDrawPositions:i,positionAssignments:r,returnParticipants:n,appliedPolicies:a,drawDefinition:s,drawPosition:o,validActions:l,structureId:u,structure:c,drawId:d,event:p}){if(i.includes(o))return{};let f=l.find(U=>U.type===zm)?.availableParticipantIds,m=a?.[yu]?.otherFlightEntries,h=a?.[yu]?.restrictQualifyingAlternates,g=(s.entries??[]).filter(({entryStage:U})=>!h||(c.stage===ze?U===ze:U!==ze)).sort((U,T)=>(U.entryPosition??1/0)-(T.entryPosition??1/0)).map(({participantId:U})=>U).filter(Boolean),{allPositionedParticipantIds:I}=fne({drawDefinition:s}),v=r.map(U=>U.participantId).filter(Boolean),w=g.filter(U=>c.stage&&[ze,Ae,Ti].includes(c.stage)?!I?.includes(U):!v.includes(U)),y=(p?.entries??[]).filter(U=>U.entryStatus===Gs&&ioe({restrictQualifyingAlternates:h,structure:c,entry:U})&&(c.stage&&[ze,Ae,Ti].includes(c.stage)?!I?.includes(U.participantId):!v.includes(U.participantId))).sort((U,T)=>(U.entryPosition??1/0)-(T.entryPosition??1/0)).map(U=>U.participantId),b=nt(w.concat(y));if(m){let U=(p?Bi({event:p}).flightProfile:void 0)?.flights?.filter(T=>T.drawId!==d).map(T=>T.drawEntries.filter(P=>P.participantId&&![bu,Us,wf].includes(P.entryStatus)&&!g.includes(P.participantId)).map(({participantId:P})=>P)).flat().filter(Boolean);U?.length&&b.push(...U)}f?.length&&(b=b.filter(U=>!f.includes(U)));let S=n?t?.filter(U=>b.includes(U.participantId)):void 0;return S?.forEach(U=>{let T=(s.entries??[]).find(P=>P.participantId===U.participantId);U.entryPosition=T?.entryPosition}),S?.sort((U,T)=>(U.entryPosition||1/0)-(T.entryPosition||1/0)),b.length?{validAlternatesAction:je({payload:{drawId:d,structureId:u,drawPosition:o},willDisableLinks:e,method:R$e,availableAlternatesParticipantIds:b,type:iV,availableAlternates:S})}:{}}function ioe({restrictQualifyingAlternates:t,structure:e,entry:i}){let{stage:r}=e;if(!i.entryStage||i.entryStage===r||r===ze&&!t||i.entryStage===Ae&&r===tn)return!0}function xBe({eventEntries:t,structure:e}){let i=n=>n.entryStatus===Gs&&ioe({structure:e,entry:n}),r=(n,a)=>(n.entryPosition||1/0)-(a.entryPosition||1/0);return t.filter(i).sort(r).map(yt)}function FBe({restrictAdHocRoundParticipants:t,tournamentParticipants:e,matchUpParticipantIds:i,otherFlightEntries:r,drawDefinition:n,structureId:a,sideNumber:s,matchUpId:o,structure:l,matchUp:u,drawId:c,event:d}){let p=[],f=l?.matchUps??[],m=u.sides?.find(T=>T.sideNumber===s)?.participantId,h=f.filter(({roundNumber:T})=>T===u.roundNumber),g=n?.entries?.filter(({entryStatus:T})=>T&&Sf.includes(T)).map(yt)??[],I=h.map(T=>(T.sides??[]).flatMap(yt)).flat().filter(Boolean),v=g.filter(T=>!i.includes(T)&&(!t||!I.includes(T))),w=e?.filter(T=>v?.includes(T.participantId)).map(T=>Oe(T,void 0,!0));w?.forEach(T=>{let P=(n.entries??[]).find(D=>D.participantId===T.participantId);T.entryPosition=P?.entryPosition}),v.length&&p.push({payload:{drawId:c,matchUpId:o,structureId:a,sideNumber:s},method:fq,type:zm,availableParticipantIds:v,participantsAvailable:w});let y=d?.entries??[],b=xBe({eventEntries:y,structure:l}),S=nt(g.concat(b));if(r){let T=(d?Bi({event:d}):void 0)?.flights?.filter(P=>P.drawId!==c).flatMap(P=>P.drawEntries.filter(D=>D.participantId&&![bu,Us,wf].includes(D.entryStatus)).map(({participantId:D})=>D)).filter(Boolean);T?.length&&S.push(...T)}S=S.filter(T=>!i.includes(T)&&!v.includes(T)&&(!t||!I.includes(T)));let U=e?.filter(T=>S.includes(T.participantId)).map(T=>Oe(T,void 0,!0));if(U?.forEach(T=>{let P=(n.entries??[]).find(D=>D.participantId===T.participantId);T.entryPosition=P?.entryPosition}),U?.sort((T,P)=>(T.entryPosition||1/0)-(P.entryPosition||1/0)),S.length&&p.push({payload:{drawId:c,matchUpId:o,structureId:a,sideNumber:s},availableParticipantIds:S,participantsAvailable:U,method:fq,type:Gs}),!fr(u)&&s&&m){p.push({payload:{drawId:c,matchUpId:o,structureId:a,sideNumber:s},method:MBe,type:bV});let T=A=>A.sides.map(yt),P=({matchUpId:A})=>A!==u.matchUpId,D=A=>!fr(A),E=u.sides?.find(A=>A.sideNumber!==s)?.participantId,R=f.filter(({roundNumber:A})=>A!==u.roundNumber).filter(P).map(T),C=[E,...R.filter(A=>A.includes(m)).flat()].filter(Boolean),M=A=>!C.flat().includes(A),N=h.filter(D).filter(P).map(T).flat().filter(M);if(N.length){let A=e?.filter(O=>N.includes(O.participantId)).map(O=>Oe(O,void 0,!0));p.push({payload:{participantIds:[m],roundNumber:u.roundNumber,structureId:a,sideNumber:s,matchUpId:o,drawId:c},swappableParticipantIds:N,method:N$e,type:sN,swappableParticipants:A})}}return p}function mN(t){if(!t)return{error:re};let{drawDefinition:e,event:i}=t,{restrictAdHocRoundParticipants:r=!0,policyDefinitions:n,enforceGender:a,participantId:s,sideNumber:o,matchUpId:l}=t,u=t.tournamentRecord??(t.tournamentId&&ni(t.tournamentId)&&t.tournamentRecords?.[t.tournamentId]);if(!u)return{error:ve};if(!l||!ni(l))return{error:Tn};if(o&&![1,2].includes(o))return q({result:{error:re},context:{sideNumber:o}});if(!e){let Y=(Ur({tournamentRecord:u}).matchUps??[]).find(Z=>Z.matchUpId===l);i=(u?.events??[]).find(Z=>Z.eventId===Y?.eventId);let X=(i?.drawDefinitions??[]).find(Z=>Z.drawId===Y?.drawId);X&&(e=X)}if(!e)return{error:$e};let c=Ri({withIndividualParticipants:!0,tournamentRecord:u}).participants,{drawId:d}=e,{matchUp:p,structure:f}=fi({drawDefinition:e,matchUpId:l,event:i});if(!p)return{error:dn};let m=Dt({tournamentRecord:u,drawDefinition:e,structure:f,event:i}).appliedPolicies??{};Object.assign(m,n??{});let h=m?.[yu]?.otherFlightEntries,g=m?.[Cr]??Wv[Cr],{enabledStructures:I}=qse({actionType:Ax,appliedPolicies:m,drawDefinition:e,structure:f}),{policyActions:v}=Yse({enabledStructures:I,drawDefinition:e,structure:f}),w=t.matchUpsMap??kr({drawDefinition:e}),y=t.inContextDrawMatchUps??Zi({tournamentParticipants:c,inContext:!0,drawDefinition:e,matchUpsMap:w,event:i}).matchUps,b=y?.find(Y=>Y.matchUpId===l),S=o&&b?.sides?.find(Y=>Y.sideNumber===o),U=b?.sides?.map(Y=>Y.participantId||Y.participant?.participantid).filter(Boolean)??[],{assignedPositions:T,allPositionsAssigned:P}=pr({structure:f}),{structureId:D}=f??{},E=[];if(!D)return{validActions:E};let R=Hn({structure:f}),C=!!p.collectionId;if(R&&!C){let Y=FBe({restrictAdHocRoundParticipants:r,tournamentParticipants:c,matchUpParticipantIds:U,otherFlightEntries:h,drawDefinition:e,structureId:D,sideNumber:o,matchUpId:l,structure:f,matchUp:p,drawId:d,event:i});E.push(...Y)}let M=Su({drawDefinition:e,structure:f}),N=T?.filter(Y=>Y.participantId).map(Y=>Y.drawPosition),A=T?.filter(Y=>Y.bye).map(Y=>Y.drawPosition),O=p.matchUpStatus==="BYE"||!C&&p.drawPositions?.reduce((Y,X)=>A?.includes(X)||Y,!1);if(O)return{validActions:E,isByeMatchUp:O};Zn({policyActions:v,action:Lx})&&E.push({type:Lx,payload:{matchUpId:l}});let k=!MU({matchUpStatus:p.matchUpStatus}),F=m?.scoring?.structures,x=f?.stage&&F?.stage?.[f.stage],L=f?.stageSequence&&x?.stageSequence?.[f.stageSequence],$=!(m?.scoring?.requireAllPositionsAssigned||x?.requireAllPositionsAssigned||L?.requireAllPositionsAssigned)||P,V=p.sides?.filter(Y=>Y?.participantId).length===2,_=p.matchUpStatus&&[Si,Wi].includes(p.matchUpStatus),B=Fn({inContextDrawMatchUps:y,drawDefinition:e,matchUpId:l}),G=Yp({inContextDrawMatchUps:y,drawDefinition:e,targetData:B}),j=(b?.drawPositions?.length===2&&b.drawPositions.every(Y=>N?.includes(Y))&&b?.sides?.length===2&&b.sides.every(({participantId:Y})=>Y)||V)&&!(_&&G),K={method:pse,type:qm,payload:{drawId:d,matchUpId:l,penaltyCode:void 0,penaltyType:void 0,participantIds:[],notes:void 0}};if(k&&E.push({payload:{drawId:d,matchUpId:l,schedule:{}},method:xx,type:Zse}),Zn({policyActions:v,action:qm})&&(S?.participant||!o&&U?.length)&&E.push(K),k&&j&&E.push({type:eoe}),$&&j){let{matchUpId:Y,matchUpFormat:X}=p,Z={drawId:d,matchUpId:Y,matchUpFormat:X,outcome:{scoreStringSide1:void 0,scoreStringSide2:void 0,sets:[]},winningSide:void 0};E.push({info:"set outcome and winningSide",method:xx,type:toe,payload:Z}),Zn({policyActions:v,action:_x})&&E.push({type:_x}),Zn({policyActions:v,action:"END"})&&E.push({type:"END"})}if(C&&b){let Y=kBe({specifiedPolicyDefinitions:n,inContextDrawMatchUps:y,matchUpParticipantIds:U,matchUpActionsPolicy:g,inContextMatchUp:b,policyActions:v,enforceGender:a,participantId:s,sideNumber:o,matchUpId:l,matchUp:p,drawId:d,side:S});E.push(...Y)}return{structureIsComplete:M,validActions:E,isDoubleExit:_,...W}}function LBe({tournamentParticipants:t=[],sourceStructuresComplete:e,possiblyDisablingAction:i,isWinRatioFedStructure:r,activeDrawPositions:n,positionAssignments:a,drawDefinition:s,drawPosition:o,structureId:l,structure:u,drawId:c,event:d}){if(n.includes(o)||r&&!e)return{};let{sourceStructureIds:p,targetStructureIds:f}=s.links?.reduce((I,v)=>{let w=v.source?.structureId,y=v.target?.structureId;return I.sourceStructureIds.includes(w)||I.sourceStructureIds.push(w),I.targetStructureIds.includes(y)||I.targetStructureIds.push(y),I},{sourceStructureIds:[],targetStructureIds:[]})||{},m=[],h=s.links?.filter(I=>I.target?.structureId===u.structureId)??[];for(let I of h){let v=I?.source?.structureId,{structure:w}=tt({structureId:v,drawDefinition:s}),y=w?.finishingPosition===Fh&&(p?.length!==1||f?.length!==1),b={};if(y){let{matchUps:T}=At({drawDefinition:s,structure:u,event:d}),{initialRoundNumber:P}=Hm({drawPosition:o,matchUps:T}),D=s.links?.find(E=>E.target?.structureId===u?.structureId&&E.target.roundNumber===P)?.source?.roundNumber;b.roundNumbers=[D]}let{completedMatchUps:S}=QM({structureId:v,inContext:!0,matchUpFilters:b,drawDefinition:s}),U=a.map(T=>T.participantId).filter(Boolean);S?.filter(({matchUpType:T,winningSide:P})=>P&&(d?.eventType!==ar||T===ar)).map(({winningSide:T,sides:P})=>T&&P?.[1-(T-1)]).map(yt).filter(T=>T&&!U.includes(T))?.forEach(T=>{m.includes(T)||m.push(T)})}let g=t?.filter(I=>m?.includes(I.participantId));return g?.forEach(I=>{let v=(s.entries??[]).find(w=>w.participantId===I.participantId);I.entryPosition=v?.entryPosition}),m?.length?{validLuckyLosersAction:{type:nV,method:C$e,availableLuckyLosers:g,availableLuckyLoserParticipantIds:m,willDisableLinks:i,payload:{drawId:c,structureId:l,drawPosition:o}}}:{}}function _Be({positionSourceStructureIds:t,unassignedParticipantIds:e,possiblyDisablingAction:i,provisionalPositioning:r,tournamentParticipants:n,isWinRatioFedStructure:a,positionAssignments:s,returnParticipants:o,appliedPolicies:l,drawDefinition:u,seedingProfile:c,isByePosition:d,drawPosition:p,structureId:f,event:m}){let{drawId:h}=u,g=[],I,v,w=[],y=l?.[Rs]?.validSeedPositions?.ignore;if(y||({unplacedSeedParticipantIds:I,unplacedSeedAssignments:v,unfilledPositions:w}=_ae({provisionalPositioning:r,returnAllProxies:!0,randomize:!0,drawDefinition:u,seedingProfile:c,structureId:f})),w?.length||(w=s.filter(b=>!b.participantId&&!b.bye&&!b.qualifier).map(b=>b.drawPosition)),d||g.push({payload:{drawId:h,structureId:f,drawPosition:p,isPositionAction:!0},willDisableLinks:i,method:O$e,type:"BYE"}),a&&y){let b=s.map(D=>D.participantId).filter(Boolean),S={structureIds:t},{completedMatchUps:U}=jv({inContext:!0,matchUpFilters:S,drawDefinition:u}),T=nt((U??[]).filter(({matchUpType:D})=>m?.eventType!==ar||D===ar)?.map(({sides:D})=>D?.map(yt)).flat().filter(D=>D&&!b.includes(D))),P=o?n?.filter(D=>T?.includes(D.participantId)).map(D=>Oe(D,void 0,!0)):void 0;return P?.forEach(D=>{let E=(u.entries??[]).find(R=>R.participantId===D.participantId);D.entryPosition=E?.entryPosition}),P?.length&&g.push(je({payload:{drawId:h,structureId:f,drawPosition:p},willDisableLinks:i,method:cq,type:zm,availableParticipantIds:T,participantsAvailable:P})),{validAssignmentActions:g}}if(w.includes(p)||d){let b;if(v?.length){let U=v.filter(T=>I?.includes(T.participantId));U.sort($Be),b=U.map(T=>T.participantId)}else b=e;let S=o?n?.filter(U=>b.includes(U.participantId)).map(U=>Oe(U,void 0,!0)):void 0;S?.length&&g.push(je({payload:{drawId:h,structureId:f,drawPosition:p},willDisableLinks:i,method:cq,type:zm,availableParticipantIds:b,participantsAvailable:S}))}return{validAssignmentActions:g}}function $Be(t,e){return t.bye||NI(t.seedValue)<NI(e.seedValue)||t.seedValue&&!e.seedValue?-1:(t.seedNumber||0)-(e.seedNumber||0)}function BBe({drawPositionInitialRounds:t,tournamentParticipants:e,positionAssignments:i,returnParticipants:r,appliedPolicies:n,drawDefinition:a,drawPosition:s,structureId:o,drawId:l}){let u=[],c=[],d=[],p=[],f=new Set(i.map(b=>b.participantId).filter(Boolean)),m=n?.[yu],h=!m?.disableRoundRestrictions&&t[s],g=m?.requireCompletedStructures,{sourceStructureIds:I,relevantLinks:v}=rw({targetRoundNumber:h,linkType:mu,drawDefinition:a,structureId:o})||{};I?.length&&p.push(...I);let{sourceStructureIds:w,relevantLinks:y}=rw({targetRoundNumber:h,linkType:fu,drawDefinition:a,structureId:o})||{};w?.length&&p.push(...w);for(let b of v){let S=a.structures?.find(T=>T.structureId===b.source.structureId);if(S?.stage!==ze)continue;let U=Su({structureId:b.source.structureId,drawDefinition:a});if(!g||U){let T=S.qualifyingRoundNumber,{matchUps:P}=At({matchUpFilters:{roundNumbers:[T],isCollectionMatchUp:!1,hasWinningSide:!0},afterRecoveryTimes:!1,tournamentParticipants:e,inContext:!0,structure:S});for(let D of P){let E=D.sides.find(C=>C?.sideNumber===D.winningSide),R=D.matchUpStatus==="BYE"&&D.sides?.find(({participantId:C})=>C);if(E||R){let{participantId:C,participant:M}=E||R||{};C&&!f.has(C)&&(M&&r&&u.push(M),c.push(C))}}}}for(let b of y){let S=a.structures?.find(T=>T.structureId===b.source.structureId);if(S?.stage!==ze)continue;let U=Su({structureId:b.source.structureId,drawDefinition:a});if(!g||U){let{positionAssignments:T}=Kt({structure:S}),P=T?.map(D=>{let E=D.participantId,R=ht({element:D,name:Tc}).extension?.value;return R?{participantId:E,groupOrder:R?.groupOrder}:{}}).filter(({groupOrder:D,participantId:E})=>D===1&&!f.has(E)).map(({participantId:D})=>D)??[];if(P&&c.push(...P),r){let D=e.filter(({participantId:E})=>P.includes(E));u.push(...D)}}}return c.length&&d.push(je({qualifyingParticipants:r?u:void 0,method:P$e,type:aN,qualifyingParticipantIds:c,payload:{qualifyingParticipantId:void 0,drawPosition:s,structureId:o,drawId:l}})),{validAssignmentActions:d,sourceStructureIds:p}}function VBe({onlyAssignedPositions:t=!0,possiblyDisablingAction:e,tournamentParticipants:i,inactiveDrawPositions:r,activeDrawPositions:n,positionAssignments:a,returnParticipants:s,byeDrawPositions:o,drawDefinition:l,isByePosition:u,drawPosition:c,structureId:d,structure:p,drawId:f,event:m}){if(n.includes(c))return{};let h=D=>!t||D.participantId||D.qualifier||D.bye,g=r?.filter(D=>D!==c&&!(u&&o.includes(D))),I=a?.filter(D=>h(D)&&g?.includes(D.drawPosition))??[],v=I.map(({drawPosition:D})=>D),{matchUps:w}=At({afterRecoveryTimes:!1,inContext:!0,drawDefinition:l,structure:p,event:m}),y=w.filter(({drawPositions:D})=>xn(D,v)),b=Object.assign({},...y.map(D=>D.sides?.filter(({sourceDrawPositionRange:E})=>E).map(({drawPosition:E,sourceDrawPositionRange:R})=>({[E]:R}))).flat()),S=I.map(D=>D.participantId).filter(Boolean),U=(i??[]).filter(D=>S.includes(D.participantId)),T=Object.assign({},...U.map(D=>({[D.participantId]:D}))),P=I.map(D=>{let E=T?.[D.participantId],R=b[D.drawPosition];return je({...D,participant:s?Oe(E,!1,!0):void 0,sourceDrawPositionRange:R})});return P.length?{validSwapAction:{payload:{drawId:f,structureId:d,drawPositions:[c]},willDisableLinks:e,method:dse,type:sN,availableAssignments:P}}:{}}function jBe(t,e){return t.filter(i=>!e.includes(i.participantId)).map(i=>i.participantId)}function GBe({validActions:t,policyActions:e,isActiveDrawPosition:i,positionAssignments:r,disablePlacementActions:n,positionAssignment:a,isByePosition:s,getValidAssignmentActions:o,positionSourceStructureIds:l,unassignedParticipantIds:u,possiblyDisablingAction:c,isWinRatioFedStructure:d,tournamentParticipants:p,returnParticipants:f,appliedPolicies:m,drawDefinition:h,drawPosition:g,structureId:I,event:v}){if(Zn({policyActions:e,action:zm})&&!i&&r&&!n&&(!a||s)){let{validAssignmentActions:w}=o({positionSourceStructureIds:l,unassignedParticipantIds:u,possiblyDisablingAction:c,isWinRatioFedStructure:d,tournamentParticipants:p,positionAssignments:r,returnParticipants:f,appliedPolicies:m,drawDefinition:h,isByePosition:s,drawPosition:g,structureId:I,event:v});w?.forEach(y=>t.push(y))}}function HBe({validActions:t,policyActions:e,isActiveDrawPosition:i,getValidQualifiersAction:r,drawPositionInitialRounds:n,tournamentParticipants:a,positionAssignments:s,returnParticipants:o,appliedPolicies:l,drawDefinition:u,drawPosition:c,structureId:d,drawId:p}){if(Zn({policyActions:e,action:aN})&&!i){let{validAssignmentActions:f}=r({drawPositionInitialRounds:n,tournamentParticipants:a,positionAssignments:s,returnParticipants:o,appliedPolicies:l,drawDefinition:u,drawPosition:c,structureId:d,drawId:p});f?.forEach(m=>t.push(m))}}function WBe({validActions:t,policyActions:e,isActiveDrawPosition:i,drawId:r,structureId:n,drawPosition:a,possiblyDisablingAction:s,isByePosition:o}){Zn({policyActions:e,action:Nx})&&!i&&(t.push({type:Nx,method:uq,payload:{drawId:r,structureId:n,drawPosition:a},willDisableLinks:s}),o||t.push({type:rV,method:E$e,payload:{drawId:r,structureId:n,drawPosition:a},willDisableLinks:s}),Zn({policyActions:e,action:"BYE"})&&!o&&t.push({type:"BYE",method:uq,payload:{drawId:r,structureId:n,drawPosition:a,replaceWithBye:!0},willDisableLinks:s}))}function zBe({validActions:t,policyActions:e,activePositionsCheck:i,activePositionOverrides:r,activeDrawPositions:n,drawDefinition:a,structureId:s,drawPosition:o,structure:l,isByePosition:u,participantId:c,participant:d,drawId:p}){let f=l.stage===ze||l.stage===Ae&&l.stageSequence===1;if(!u&&i({activePositionOverrides:r,activeDrawPositions:n,action:gm})&&Zn({policyActions:e,action:gm})&&KP({drawDefinition:a,structureId:s,drawPosition:o})&&f){let{seedAssignments:m}=hs({returnAllProxies:!0,drawDefinition:a,structure:l}),{seedNumber:h,seedValue:g}=m?.find(I=>I.participantId===c)??{};t.push({type:gm,method:x$e,participant:d,seedNumber:h,payload:{drawId:p,structureId:s,participantId:c,seedValue:g}})}if(!u&&i({activePositionOverrides:r,activeDrawPositions:n,action:Xy})&&Zn({policyActions:e,action:Xy})&&KP({drawDefinition:a,structureId:s,drawPosition:o})&&f){let{seedAssignments:m}=hs({returnAllProxies:!0,drawDefinition:a,structure:l}),{seedNumber:h}=m?.find(g=>g.participantId===c)??{};t.push({method:k$e,type:Xy,participant:d,seedNumber:h,payload:{participantId:c,structureId:s,drawId:p}})}}function qBe({validActions:t,policyActions:e,isByePosition:i,participantId:r,participant:n,drawId:a}){if(!i&&r){if(Zn({policyActions:e,action:qm})){let s={type:qm,method:pse,participant:n,payload:{penaltyCode:void 0,penaltyType:void 0,participantIds:[],notes:void 0,drawId:a}};t.push(s)}if(Zn({policyActions:e,action:nw})){let s={type:nw,method:A$e,participant:n,payload:{participantId:r,otherName:void 0}};t.push(s)}}}function YBe({validActions:t,policyActions:e,getValidSwapAction:i,possiblyDisablingAction:r,tournamentParticipants:n,inactiveDrawPositions:a,activeDrawPositions:s,positionAssignments:o,returnParticipants:l,byeDrawPositions:u,drawDefinition:c,isByePosition:d,drawPosition:p,structureId:f,structure:m,drawId:h}){if(Zn({policyActions:e,action:sN})){let{validSwapAction:g}=i({possiblyDisablingAction:r,tournamentParticipants:n,inactiveDrawPositions:a,activeDrawPositions:s,positionAssignments:o,returnParticipants:l,byeDrawPositions:u,drawDefinition:c,isByePosition:d,drawPosition:p,structureId:f,structure:m,drawId:h});g&&t.push(g)}}function KBe({validActions:t,policyActions:e,getValidAlternatesAction:i,possiblyDisablingAction:r,tournamentParticipants:n,positionAssignments:a,activeDrawPositions:s,returnParticipants:o,appliedPolicies:l,drawDefinition:u,drawPosition:c,structureId:d,structure:p,drawId:f,event:m,disablePlacementActions:h}){if(Zn({policyActions:e,action:iV})&&!h){let{validAlternatesAction:g}=i({possiblyDisablingAction:r,tournamentParticipants:n,positionAssignments:a,activeDrawPositions:s,returnParticipants:o,appliedPolicies:l,drawDefinition:u,drawPosition:c,validActions:t,structureId:d,structure:p,drawId:f,event:m});g&&t.push(g)}}function XBe({validActions:t,policyActions:e,getValidLuckyLosersAction:i,sourceStructuresComplete:r,possiblyDisablingAction:n,isWinRatioFedStructure:a,tournamentParticipants:s,activeDrawPositions:o,positionAssignments:l,drawDefinition:u,drawPosition:c,structureId:d,structure:p,drawId:f,disablePlacementActions:m,isActiveDrawPosition:h}){if(Zn({policyActions:e,action:nV})&&!m&&!h&&l){let{validLuckyLosersAction:g}=i({sourceStructuresComplete:r,possiblyDisablingAction:n,isWinRatioFedStructure:a,tournamentParticipants:s,activeDrawPositions:o,positionAssignments:l,drawDefinition:u,drawPosition:c,structureId:d,structure:p,drawId:f});g&&t.push(g)}}function JBe({validActions:t,policyActions:e,getValidModifyAssignedPairAction:i,participant:r,tournamentParticipants:n,returnParticipants:a,drawPosition:s,drawId:o,event:l}){if(r?.participantType===ft&&Zn({policyActions:e,action:tV})){let{validModifyAssignedPairAction:u}=i({tournamentParticipants:n,returnParticipants:a,drawPosition:s,participant:r,drawId:o,event:l});u&&t.push(u)}}function wV(t){return QBe(t)}function QBe(t){let e=He(t,[{event:!0,drawDefinition:!0,structureId:!0}]);if(e.error)return e;let{policyDefinitions:i,returnParticipants:r=!0,provisionalPositioning:n,tournamentRecord:a,drawDefinition:s,drawPosition:o,event:l}=t,u=t.tournamentParticipants??(a&&Ri({withIndividualParticipants:!0,tournamentRecord:a}).participants)??[],c=tt({structureId:t.structureId,drawDefinition:s});if(c.error)return c;let d=c.containingStructure||c.structure;if(!d)return{error:vi};let p=d.structureId;if(c=Gv({drawDefinition:s,structureId:p}),o===void 0&&!c.isAdHoc)return{error:Rv};if(c.isAdHoc)return mN(t);if(c.error)return c;let{drawPositionInitialRounds:f,inactiveDrawPositions:m,activeDrawPositions:h,byeDrawPositions:g}=c,I=Dt({tournamentRecord:a,drawDefinition:s,structure:d,event:l}).appliedPolicies??{};Object.assign(I,i??{});let{actionsPolicy:v,enabledStructures:w,actionsDisabled:y}=qse({actionType:ID,appliedPolicies:I,drawDefinition:s,structure:d}),b=v?.activePositionOverrides||[],{sourceStructureIds:S}=rw({finishingPosition:jp,targetRoundNumber:1,linkType:fu,drawDefinition:s,structureId:p})||{},U;S?.length&&(U=S.every(K=>Su({structureId:K,drawDefinition:s})));let T=S.length,P=S.length&&!U,{policyActions:D}=Yse({enabledStructures:w,drawDefinition:s,structure:d}),E=![ze,Ae].includes(d.stage)||d.stageSequence!==1,{drawId:R}=s,C=[],{assignedPositions:M,positionAssignments:N}=pr({structure:d}),A=M?.find(K=>K.drawPosition===o),O=!!A;if(!N?.map(K=>K.drawPosition)?.includes(o))return{error:Rh};let{stage:k,stageSequence:F}=d,x=[k];k===tn&&x.push(Ae),k===Ae&&x.push(tn);let L=$h({entryStatuses:Sf,provisionalPositioning:n,drawDefinition:s,stageSequence:F,structureId:p,stages:x}),$=Df({drawDefinition:s,stages:x}).assignedParticipantIds??[],V=jBe(L,$),_=g.includes(o),B=h.includes(o);if(y)return{info:"Actions Disabled for structure",isActiveDrawPosition:B,isDrawPosition:!0,hasPositionAssigned:O,validActions:[],isByePosition:_};GBe({validActions:C,policyActions:D,isActiveDrawPosition:B,positionAssignments:N,disablePlacementActions:P,positionAssignment:A,isByePosition:_,getValidAssignmentActions:_Be,positionSourceStructureIds:S,unassignedParticipantIds:V,possiblyDisablingAction:E,isWinRatioFedStructure:T,tournamentParticipants:u,returnParticipants:r,appliedPolicies:I,drawDefinition:s,drawPosition:o,structureId:p,event:l}),HBe({validActions:C,policyActions:D,isActiveDrawPosition:B,getValidQualifiersAction:BBe,drawPositionInitialRounds:f,tournamentParticipants:u,positionAssignments:N,returnParticipants:r,appliedPolicies:I,drawDefinition:s,drawPosition:o,structureId:p,drawId:R});let{participantId:G}=A||{},j=G&&u.find(K=>K.participantId===G);return A&&(WBe({validActions:C,policyActions:D,isActiveDrawPosition:B,drawId:R,structureId:p,drawPosition:o,possiblyDisablingAction:E,isByePosition:_}),zBe({validActions:C,policyActions:D,activePositionsCheck:CBe,activePositionOverrides:b,activeDrawPositions:h,drawDefinition:s,structureId:p,drawPosition:o,structure:d,isByePosition:_,participantId:G,participant:j,drawId:R}),qBe({validActions:C,policyActions:D,isByePosition:_,participantId:G,participant:j,drawId:R}),YBe({validActions:C,policyActions:D,getValidSwapAction:VBe,possiblyDisablingAction:E,tournamentParticipants:u,inactiveDrawPositions:m,activeDrawPositions:h,positionAssignments:N,returnParticipants:r,byeDrawPositions:g,drawDefinition:s,isByePosition:_,drawPosition:o,structureId:p,structure:d,drawId:R})),KBe({validActions:C,policyActions:D,getValidAlternatesAction:OBe,possiblyDisablingAction:E,tournamentParticipants:u,positionAssignments:N,activeDrawPositions:h,returnParticipants:r,appliedPolicies:I,drawDefinition:s,drawPosition:o,structureId:p,structure:d,drawId:R,event:l,disablePlacementActions:P}),XBe({validActions:C,policyActions:D,getValidLuckyLosersAction:LBe,sourceStructuresComplete:U,possiblyDisablingAction:E,isWinRatioFedStructure:T,tournamentParticipants:u,activeDrawPositions:h,positionAssignments:N,drawDefinition:s,drawPosition:o,structureId:p,structure:d,drawId:R,disablePlacementActions:P,isActiveDrawPosition:B}),JBe({validActions:C,policyActions:D,getValidModifyAssignedPairAction:RBe,participant:j,tournamentParticipants:u,returnParticipants:r,drawPosition:o,drawId:R,event:l}),{isActiveDrawPosition:B,isDrawPosition:!0,hasPositionAssigned:O,isByePosition:_,validActions:C,...W}}function KU({policyDefinitions:t,appliedPolicies:e,drawType:i}){let r=t?.[_P]?.drawTypeCoercion,n=e?.[_P]?.drawTypeCoercion;return(typeof r=="boolean"?r:void 0)??(i&&r?.[i])??(typeof n=="boolean"?n:void 0)??(i&&n?.[i])??!0}var SV=({drawDefinition:t})=>{let e=He({drawDefinition:t},[{[In]:!0}]);if(e.error)return e;let i=t.structures?.find(n=>n.stage===Ae&&n.stageSequence===1);if(!i)return q({result:{error:Z$}});let{qualifierPositions:r}=pr({structure:i});return Ce(0,r.length).sort(()=>Math.random()-.5)};function UV({structureId:t,drawDefinition:e}){if(!e)return{error:$e};if(!ni(t))return{error:re};let i=Vv({drawDefinition:e,structureId:t});if(i.error)return i;let r=i.links.target.flatMap(a=>a.target.feedProfile).filter(Boolean),n=!Li([Vp,As,DM,Bp],r).length;return{...W,valid:n}}function roe({participantsCount:t,participantCount:e}){if(t=t??e,!t)return{error:re};let i=Ev(t);return i?{drawSize:i}:q({result:{error:re},stack:"getEliminationDrawSize",context:{participantsCount:t}})}function XU(t){let{drawSizeProgression:e=!1,policyDefinitions:i,drawSize:r}=t||{},{requireParticipantCount:n=!0,tournamentRecord:a,drawDefinition:s,event:o}=t||{},l="getSeedsCount",u=t?.participantsCount??t?.participantCount;if(!i){let m=jc({tournamentRecord:a,drawDefinition:s,event:o});if(m.error)return q({result:m,stack:l});i=m.policyDefinitions}let c=lt(u);if(u&&!c)return q({result:{error:re},context:{participantsCount:u},stack:l});if(n&&!c)return q({result:{error:eie},stack:l});if(Number.isNaN(Number(r)))if(u)({drawSize:r}=roe({participantsCount:u}));else return q({result:{error:JS},stack:l});let d=n&&u||r;if(d&&d>r)return{error:aB};let p=i?.[Rs];if(!p)return{error:$te};let f=p.seedsCountThresholds;return f?(p.drawSizeProgression!==void 0&&(e=p.drawSizeProgression),{seedsCount:f.filter(m=>e?m.drawSize<=r:r===m.drawSize).reduce((m,h)=>u&&u>=h.minimumParticipantCount?h.seedsCount:m,0)}):{error:wte}}function hN({consideredEntries:t,policyDefinitions:e,tournamentRecord:i,appliedPolicies:r,participantMap:n,enforceGender:a,participants:s,event:o}){if((!s||!n)&&i&&({participants:s,participantMap:n}=Ri({tournamentRecord:i})),!s)return{error:eU};if(!Array.isArray(s))return{error:re};if(!o)return{error:ui};let l=e?.[Cr]??r?.[Cr]??Wv[Cr],u=(a??l?.participants?.enforceGender)!==!1,{eventType:c,gender:d}=o,p=c===bc,f=c===Ua&&_t||p&&ft||It,m=Object.assign({},...(t??o.entries??[]).map(I=>({[I.participantId]:I.entryStatus}))),h=Object.keys(m),g=s.filter(I=>h.includes(I.participantId)).filter(I=>{let v=ZBe({participant:I,participantType:f,eventType:c,entryStatusMap:m}),w=e2e({genderEnforced:u,participantMap:n,eventGender:d,participant:I,isDoubles:p,mismatch:v});return v||!w});if(g.length){let I=g.map(v=>v.participantId);return{error:Mte,invalidParticipantIds:I}}return{...W,valid:!0}}function ZBe({participant:t,participantType:e,eventType:i,entryStatusMap:r}){let n=r[t.participantId],a=i&&[bc,Ua].includes(i)&&t.participantType===It&&(dp(n)||n===bu);return t.participantType!==e&&!a}function e2e(t){let{participant:e,participantMap:i,eventGender:r,mismatch:n,isDoubles:a,genderEnforced:s}=t,o=!n&&a&&nt(e?.individualParticipantIds?.map(d=>i?.[d]?.participant?.person?.sex).filter(Boolean)??[])||[],l=!r||!o?.length||du(r)||cl(r)&&ln(o[0])===ln(r)||Aa(r)&&(o.length===1&&e.individualParticipantIds?.length===1||o.length===2),u=e?.person?.sex,c=!e?.person||!r||Aa(r)||du(r)||cl(r)&&ln(u)===ln(r);return!s||l&&c}function noe({hasExistingDrawDefinition:t,qualifyingProfiles:e,appliedPolicies:i,qualifyingOnly:r,tieFormat:n,idPrefix:a,isMock:s,uuids:o}){let l="generateQualifyingSTructures",u=[],c=[],d=[],p=(v,w)=>v.stageSequence-w.stageSequence,f=(v,w)=>v.roundTarget-w.roundTarget,m=0,h=0,g,I=1;for(let v of e.sort(f)){let w=v.structureProfiles||[];I=v.roundTarget||I;let y=1,b=0,S,U,T;for(let P of(w||[]).sort(p)){let D=W$(P.drawSize||P.participantsCount),{qualifyingRoundNumber:E,structureOptions:R,matchUpFormat:C,structureName:M,structureId:N,drawType:A}=P,O=P.matchUpType,k=P.qualifyingPositions||t2e({drawSize:D,qualifyingRoundNumber:E}),F,x,L;if(!lt(D))return q({result:{error:JS},stack:l});let $=e.length>1?`${I}-`:"",V=w.length>1||$?y:"",_=M||($||V?`${Qr(ze)} ${$}${V}`:Qr(ze));if(A===eo){let{structures:B,groupCount:G,maxRoundNumber:j}=FU({structureName:P.structureName||_,structureId:N||o?.pop(),hasExistingDrawDefinition:t,stage:ze,structureOptions:R,appliedPolicies:i,qualifyingOnly:r,stageSequence:y,matchUpType:O,roundTarget:I,tieFormat:n,drawSize:D,idPrefix:a,isMock:s,uuids:o});b=G,F=j,x=B[0],g=[1]}else({drawSize:D,matchUps:L,roundLimit:F}=gl({qualifyingRoundNumber:E,qualifyingPositions:k,matchUpType:O,drawSize:D,idPrefix:a,isMock:s,uuids:o})),x=ss({structureName:P.structureName||_,structureId:N||o?.pop(),qualifyingRoundNumber:F,hasExistingDrawDefinition:t,stage:ze,qualifyingOnly:r,matchUpFormat:C,stageSequence:y,matchUpType:O,roundLimit:F,tieFormat:n,matchUps:L}),I&&Ft({extension:{name:El,value:I},element:x}),b=L?.filter(B=>B.roundNumber===F)?.length||0;if(y>1){let{link:B}=BU({sourceStructureId:U,sourceRoundNumber:S,targetStructureId:x.structureId,finishingPositions:T===fu?[1]:void 0,linkType:T});d.push(B),m+=(D||0)-b}else m+=D||0;T=A===eo?fu:mu,U=x.structureId,S=F,n&&(L=At({structure:x})?.matchUps||[],L?.forEach(B=>{let{tieMatchUps:G}=Xh({tieFormat:n,matchUp:B,isMock:s});Object.assign(B,{tieMatchUps:G,matchUpType:O})})),c.push(x),y+=1}h+=b,u.push({qualifiersCount:b,finalQualifyingRoundNumber:S,finalQualifyingStructureId:U,finishingPositions:g,roundTarget:I,linkType:T}),I+=1}return{qualifiersCount:h,qualifyingDrawPositionsCount:m,qualifyingDetails:u,structures:c,...W,links:d}}function t2e({drawSize:t,qualifyingRoundNumber:e}){let i=t,r=0;for(;r<e;)i=Math.floor(i/2),r+=1;return i}function aoe(t){let{drawTypeCoercion:e,enforceMinimumDrawSize:i}=t,r=Ke(t.drawSize),n=e&&t.drawType!==la&&(typeof e=="boolean"||e<=2)&&r===2&&Jo||t.drawType||Jo,a=$re.includes(n);if(r&&a){if(e&&(typeof e=="boolean"&&r<4||r<=e))n=Jo;else if(r<4&&i)return{...q({context:{enforceMinimumDrawSize:i,drawSize:r,drawType:n},result:{error:nM},stack:"getCoercedDrawType"}),drawType:n}}return{drawType:n}}function i2e(t){let{drawDefinition:e,structureOptions:i,requireSequential:r}=t,n={structureName:Qr(Ae),...t,stage:Ae},{structures:a,groupCount:s}=FU(n);if(s<1)return{error:vie};let o=i?.playoffGroups||[{finishingPositions:[1],structureName:Qr(Ti)}],[l]=a,{structures:u,links:c}=Use({sourceStructureId:l.structureId,requireSequential:r,drawDefinition:e,playoffGroups:o,groupCount:s,...t});return u&&a.push(...u),{...W,structures:a,links:c}}function r2e({mainStructure:t,consolationStructure:e,deciderStructure:i}){let r=e.matchUps.reduce((u,c)=>(c.drawPositions||[]).filter(Boolean).length&&!u.includes(c.roundNumber)?u.concat(c.roundNumber):u,[]),n=t.matchUps.reduce((u,c)=>!u||c.roundNumber>u?c.roundNumber:u,void 0),a=e.matchUps.reduce((u,c)=>!u||c.roundNumber>u?c.roundNumber:u,void 0),s=r.map((u,c)=>{let d=r.indexOf(u)%2?As:Vp,p=1+c;return{linkType:hu,source:{roundNumber:p,structureId:t.structureId},target:{feedProfile:d,roundNumber:u,structureId:e.structureId}}}),o={linkType:mu,source:{roundNumber:a,structureId:e.structureId},target:{feedProfile:As,roundNumber:n,structureId:t.structureId}},l=[{linkType:mu,source:{roundNumber:n,structureId:t.structureId},target:{feedProfile:As,roundNumber:1,structureId:i.structureId}},{linkType:hu,source:{roundNumber:n,structureId:t.structureId},target:{feedProfile:As,roundNumber:1,structureId:i.structureId}}];return[...s,o,...l]}function n2e({structureName:t,matchUpType:e,idPrefix:i,drawSize:r,isMock:n,uuids:a}){let s=[],{matchUps:o}=Rd({linkFedFinishingRoundNumbers:[1],drawSize:r+1,matchUpType:e,idPrefix:i,isMock:n}),l=cd({structureName:t||Qr(Ae),structureId:a?.pop(),stageSequence:1,stage:Ae,matchUpType:e,matchUps:o});s.push(l);let u=r/2,{matchUps:c}=Rd({finishingPositionOffset:u,idPrefix:i&&`${i}-c`,drawSize:r-1,isConsolation:!0,matchUpType:e,isMock:n,uuids:a}),d=cd({structureName:Qr(_re),matchUps:c,structureId:a?.pop(),stage:tn,stageSequence:2,matchUpType:e});s.push(d);let{matchUps:p}=gl({idPrefix:i&&`${i}-p1t2`,drawSize:2,matchUpType:e,isMock:n}),f=cd({structureName:Qr(Lre),matchUps:p,structureId:a?.pop(),stageSequence:3,stage:Ti,matchUpType:e});s.push(f);let m=r2e({mainStructure:l,consolationStructure:d,deciderStructure:f});return{structures:s,links:m,...W}}function a2e(t){let{qualifyingRoundNumber:e,finishingPositionOffset:i,qualifyingPositions:r,matchUpType:n,idPrefix:a,drawSize:s,isMock:o,uuids:l}=t;if(!lt(s)||s<2)return{matchUps:[],roundsCount:0};if(Ro(s))return gl(t);let u=s2e(s),c=u.shift(),d=Ce(1,(c?.participantsCount||0)+1).map(g=>({drawPosition:g})),p=[],f=1;({matchUps:p}=JP({roundNumber:f,matchUpType:n,idPrefix:a,matchUps:p,isMock:o,nodes:d,uuids:l})),f++;let m=t.roundLimit||e;for(let g of u){let I=g.participantsCount/2,v=Ce(1,I+1);r&&I===r&&(m=f-1);let w=v.map(y=>{let b=aV({roundPosition:y,roundNumber:f,idPrefix:a,uuids:l});return{roundPosition:y,roundNumber:f,matchUpId:b}});p.push(...w),f++}let h=f-1;return p=CU({finishingPositionOffset:i,lucky:!0,roundsCount:h,roundLimit:m,matchUps:p}),m&&(p=p.filter(g=>g.roundNumber<=m)),{matchUps:p,roundsCount:h,roundLimit:m}}function s2e(t){let e=Ke(t),i=e%2?e+1:e,r=!!(Math.ceil(i/2)%2),n=[{participantsCount:i,preFeedRound:r}];for(;i>2;){let a=Math.ceil(i/2),s=a===1,o=!!(!s&&a%2);i=!s&&o?a+1:a;let l=!!(i!==2&&Math.ceil(i/2)%2);n.push({participantsCount:i,preFeedRound:l,feedRound:o})}return n}function soe(t){let{playoffAttributes:e,stageSequence:i=1,stage:r=Ae,tieFormat:n,matchUpType:a,drawSize:s,uuids:o}=t,l=()=>!t.isMock&&!t.idPrefix?void 0:`${t.drawDefinition.drawId}-s-0`,u=t.structureId||l()||o?.pop(),c=t.appliedPolicies??Dt(t),d=t.policyDefinitions?.[EI]||c?.[EI];t.skipRounds=t.skipRounds||s<=4&&(d?.feedFromMainFinal?0:1)||0;let p=t.structureName??e?.["0"]?.name??Qr(Ae),f=()=>{let{matchUps:m}=gl(t);return{structures:[ss({stageSequence:i,structureName:p,matchUpType:a,structureId:u,tieFormat:n,matchUps:m,stage:r})],links:[],...W}};return{generators:{[la]:()=>({structures:[ss({finishingPosition:jp,stageSequence:i,structureName:p,matchUps:[],matchUpType:a,structureId:u,stage:r})],links:[],...W}),[If]:()=>{let{matchUps:m}=a2e(t);return{structures:[ss({stageSequence:i,structureName:p,matchUpType:a,structureId:u,matchUps:m,stage:r})],links:[],...W}},[Jo]:()=>f(),[oU]:()=>n2e(t),[UI]:()=>Vg({...t,roundOffsetLimit:3,playoffAttributes:e??kB}),[TI]:()=>Vg({...t,roundOffsetLimit:2,playoffAttributes:e??OB}),[Ti]:()=>Vg(t),[Ov]:()=>{let{matchUps:m}=Rd({drawSize:s,uuids:o,matchUpType:a});return{structures:[ss({stageSequence:i,structureName:p,matchUpType:a,structureId:u,stage:Ae,tieFormat:n,matchUps:m})],links:[],...W}},[lU]:()=>bse(t),[DI]:()=>_f({...t,feedRounds:1,fmlc:!0}),[Fre]:()=>_f({...t,feedRounds:1}),[MB]:()=>_f({...t,feedsFromFinal:1}),[NB]:()=>_f({...t,feedsFromFinal:2}),[AB]:()=>_f({...t,feedsFromFinal:3}),[uU]:()=>_f(t),[PM]:()=>Sse(t),[eo]:()=>FU(t),[gu]:()=>i2e(t)}}}function TV(t){let{enforceMinimumDrawSize:e=!0,overwriteExisting:i,appliedPolicies:r,qualifyingOnly:n,staggeredEntry:a,drawDefinition:s,tieFormat:o,isMock:l,uuids:u}=t||{},c=Ke(t.drawSize),d=t.drawTypeCoercion??KU({appliedPolicies:r,drawType:t.drawType}),p="generateDrawStructuresAndLinks",f=aoe({drawType:t.drawType,enforceMinimumDrawSize:e,drawTypeCoercion:d,drawSize:c});if(f.error)return f;let m=f.drawType,h=[],g=[],I=t?.matchUpType??zt,v=s?.structures?.filter(({stage:V})=>V===ze);v&&h.push(...v);let w=v?.map(({structureId:V})=>V),y=s?.structures?.find(({stage:V,stageSequence:_})=>V===Ae&&_===1),b=s?.links?.filter(V=>V.target.structureId===y?.structureId&&w?.includes(V.source.structureId)),S=(V,_)=>{if(V.linkType===fu&&_?.structures){let B=V.source.finishingPositions||[];return _.structures.length*B.length}else if(V.linkType===mu&&_?.matchUps?.length){let B=V.source.roundNumber;return _.matchUps.filter(({roundNumber:G})=>G===B).length}},U=v?.map(V=>{let _=b?.find(Y=>Y.target.structureId===V.structureId),B=Kt({structure:V})?.positionAssignments?.length??0;if(!_)return B;let G=_?.source.structureId,j=s.structures?.find(Y=>Y.structureId===G),K=S(_,j)||0;return B-K}).filter(Boolean).reduce((V,_)=>V+_,0),T=b?.map(V=>{let _=V.source.structureId,B=v?.find(G=>G.structureId===_);return S(V,B)}).filter(Boolean).reduce((V,_)=>V+_,0),P=!!(y&&!y?.matchUps?.length);if(v?.length&&!P)return{error:cx};let D=!v?.length&&t.qualifyingProfiles,E=D?.length&&noe({idPrefix:t.idPrefix,qualifyingProfiles:D,appliedPolicies:r,qualifyingOnly:n,tieFormat:o,isMock:l,uuids:u});if(E?.error)return E;let{qualifyingDrawPositionsCount:R,qualifyingDetails:C,qualifiersCount:M}=E||{qualifyingDrawPositionsCount:U,qualifiersCount:T};R&&(E?.structures&&h.push(...E.structures),E?.links&&g.push(...E.links)),Object.assign(t,je({drawSize:c,matchUpType:I,tieFormat:o}));let N=m!==la&&(!c||c<2||!a&&![Ov,If].includes(m)&&([gu,eo].includes(m)&&c<3||![eo,gu].includes(m)&&!Ro(c)));if(N&&!R)return q({context:{drawSize:c,invalidDrawSize:N},result:{error:nM},stack:p});let{generators:A,error:O}=soe(t);if(O)return{error:O};let k=A[m];if(!k)return{error:K$};let F=k?.();if(F.error)return F;let{structures:x,links:L}=F;if(x?.length){let V=x.find(({stage:_,stageSequence:B})=>_===Ae&&B===1);if(y&&V){if(P){let _=V.structureId;if(V.structureId=y.structureId,L?.length)for(let B of L)B.source.structureId===_&&(B.source.structureId=y.structureId),B.target.structureId===_&&(B.target.structureId=y.structureId)}else if(!i)return{error:cx}}h.push(...x)}h.sort(_h),L?.length&&g.push(...L);let $=F.structures.find(({stage:V,stageSequence:_})=>V===Ae&&_===1);for(let V of C||[]){let{finalQualifyingRoundNumber:_,finalQualifyingStructureId:B,roundTarget:G,finishingPositions:j,linkType:K}=V,Y=$&&BU({targetStructureId:$.structureId,sourceStructureId:B,sourceRoundNumber:_,finishingPositions:j,targetEntryRound:G,linkType:K})?.link;if(Y?.error)return Y;Y&&g.push(Y)}return b&&g.push(...b),{...W,qualifyingResult:{qualifyingDrawPositionsCount:R,qualifiersCount:M},structures:h,links:g}}function DV(t){let{modifyOriginal:e=!0,stageSequence:i=1,isMock:r}=t||{},n="generateDrawTypeAndModifyDrawDefinition";if(!t.drawDefinition)return q({result:{error:$e},stack:n});let a=e?t.drawDefinition:Oe(t.drawDefinition,!1,!0),{tieFormat:s,matchUpType:o}=t;if(s){let w=Gn({tieFormat:s});if(w.error)return w}s=Gr(s??yn({drawDefinition:a})?.tieFormat),o=o??(a.matchUpType||zt),t.tieFormat=s,t.matchUpType=o;let l=YP({drawDefinition:a,stage:Ae});t.drawSize=t.drawSize??l,!l&&t.drawSize&&XP({drawSize:t.drawSize,drawDefinition:a,stageSequence:i,stage:Ae});let u=kr({drawDefinition:a}).drawMatchUps.map(vr),c=TV(t);if(c.error)return q({result:c,stack:n});let{structures:d,links:p,qualifyingResult:f}=c;a.structures=d,a.links=p;let m=Math.max(t.qualifiersCount??0,f?.qualifiersCount||0);if(f?.qualifyingDrawPositionsCount&&!YP({stage:ze,drawDefinition:a})){let w=XP({drawSize:f.qualifyingDrawPositionsCount,stage:ze,drawDefinition:a});if(w.error)return w}if(m){let w=lse({qualifiersCount:m,drawDefinition:a,stage:Ae});if(w.error)return w}let h=t.drawSize??l;Object.assign(t,je({drawSize:h,matchUpType:o,tieFormat:s}));let{matchUps:g,matchUpsMap:I}=Zi({drawDefinition:a});s&&g?.forEach(w=>{if(!u.includes(w.matchUpId)){let{tieMatchUps:y}=Xh({tieFormat:s,matchUp:w,isMock:r});Object.assign(w,{tieMatchUps:y,matchUpType:o})}});let{inContextDrawMatchUps:v}=Wp({drawDefinition:a,matchUpsMap:I});return ii({tournamentId:t.tournamentRecord?.tournamentId,drawDefinition:a}),{inContextDrawMatchUps:v,drawDefinition:a,matchUpsMap:I,...W,structures:d,matchUps:g,links:p}}function Kv(t){let{removePriorValues:e,tournamentRecord:i,participantId:r,scaleItem:n}=t,a,s;if(!loe({scaleItem:n}))return{error:_m};if(r&&Array.isArray(i.participants)&&(s=i.participants.find(o=>o.participantId===r),s)){if(s.participantType===$n&&n?.eventType!==Ua)return{error:_m};let o=uoe({removePriorValues:e,participant:s,scaleItem:n});if(o.error)return o;a=!o.valueChanged;let{topics:l}=bs();l.includes(rn)&&st({topic:rn,payload:{tournamentId:i.tournamentId,participants:[s]}})}return a&&{...W,info:mB,existingValue:n?.scaleValue}||s&&{...W,newValue:n?.scaleValue}||{error:ji}}function ooe(t){let{scaleItemsWithParticipantIds:e=[],removePriorValues:i,tournamentRecord:r,auditData:n,context:a}=t;if(!r)return{error:ve};if(!r.participants)return{error:eU};let s=0,o={},l=[];for(let d of e){let p=d?.participantId;if(Array.isArray(d?.scaleItems))for(let f of d.scaleItems)if(loe({scaleItem:f}))Array.isArray(o[p])||(o[p]=[]),o[p].push(f);else return{error:_m}}for(let d of r.participants){let{participantId:p}=d||{};if(Array.isArray(o[p]))for(let f of o[p]){if(d.participantType===$n&&f?.eventType!==Ua)return q({context:{participantId:p,scaleItem:f,participantType:d.participantType},info:"Invalid participantType for eventType",result:{error:_m}});uoe({participant:d,scaleItem:f,removePriorValues:i}),l.push(d),s++}}let u=s?void 0:Av,{topics:c}=bs();if(c.includes(rn)&&s&&st({topic:rn,payload:{tournamentId:r.tournamentId,participants:l}}),a){let{eventId:d,drawId:p,...f}=a,m=f.scaleAttributes?.scaleType&&[f.scaleAttributes.scaleType];if(Object.keys(f).length){let h={itemType:ZB,itemValue:f};if(m&&(h.itemSubTypes=m),p||d){let{drawDefinition:g,event:I}=Wn({tournamentRecord:r,eventId:d,drawId:p});p&&eV({drawDefinition:g,timeItem:h}),d&&Jh({event:I,timeItem:h})}else WU({tournamentRecord:r,timeItem:h})}}return n&&c.includes(Zu)&&st({topic:Zu,payload:n}),je({...W,modificationsApplied:s,info:u})}function loe({scaleItem:t}){let e=t&&Object.keys(t),i=["scaleType","eventType","scaleName"];return i.filter(r=>e?.includes(r)).length===i.length}function uoe({removePriorValues:t,participant:e,scaleItem:i}){if(!e)return{error:Nh};let r=i&&Object.keys(i),n=["scaleType","eventType","scaleName"];if(n.filter(u=>r.includes(u)&&i[u]).length!==n.length)return{error:_m};let a=new Date().toISOString();e.timeItems||(e.timeItems=[]);let{scaleItem:s}=Xl({scaleAttributes:i,participant:e}),o=u=>[void 0,null,""].includes(u),l=!(o(s?.scaleValue)&&o(i.scaleValue))&&JSON.stringify(s?.scaleValue)!==JSON.stringify(i.scaleValue);if(l){let{scaleType:u,eventType:c,scaleName:d}=i,p=[Sd,u,c,d].join("."),f=je({itemValue:i.scaleValue,itemDate:i.scaleDate,createdAt:a,itemType:p});i.scaleId&&(f.itemSubTypes=[i.scaleId]),t&&(e.timeItems=e.timeItems.filter(m=>m.itemType!==p)),e.timeItems.push(f)}return{...W,valueChanged:l,newValue:i.scaleValue}}function PV(t){let{tournamentRecord:e,modifiedScaleValues:i,removePriorValues:r}=t,n=He(t,[{[hr]:!0},{modifiedScaleValues:!0,[qn]:Kn}]);if(n.error)return n;for(let a in i){let s=Kv({scaleItem:i[a],removePriorValues:r,tournamentRecord:e,participantId:a});if(s.error)return s}return{...W}}var o2e=(t=0)=>250/Math.pow(t+5,.4),l2e=()=>1;function u2e(t=3,e=2){let i=t/e;return Number.isNaN(i)?yg.kDefault():i}var yg={nSpread:400,diffThreshold:.125,kCalc:o2e,kMultiplier:u2e,kDefault:l2e};function coe(t){let{winnerRating:e,loserRating:i}=t,{ratings:r=Dr,winnerCountables:n=1,loserCountables:a=0,ratingType:s="ELO",maxCountables:o,countables:l}=t||{},u=r?.[s];if(!u)return{error:Je};let c=u.range||t.ratingRange;e=e||u.defaultInitialization,i=i||u.defaultInitialization;let d=c[0]>c[1],p=u.decimalsCount||0,f=d?c.slice().reverse():c,m=(A,O)=>Number.parseFloat(O)>=Math.min(...A)&&Number.parseFloat(O)<=Math.max(...A);(!m(c,e)||!m(c,i))&&(m(c,e)||(e=u.defaultInitialization),m(c,i)||(i=u.defaultInitialization));let h=Ag({targetRange:Dr.ELO.range,sourceRange:f,value:d?c[0]-e:e}),g=Ag({targetRange:Dr.ELO.range,sourceRange:f,value:d?c[0]-i:i}),I=(A,O)=>1/(1+Math.pow(10,(O-A)/yg.nSpread)),v=I(h,g),w=I(g,h),y=yg.kCalc(n),b=yg.kCalc(a),S=yg.kMultiplier(o,l),U=h+S*y*(1-v),T=g+S*b*(0-w),P=Ag({sourceRange:Dr.ELO.range,value:U,targetRange:f}),D=Ag({sourceRange:Dr.ELO.range,value:T,targetRange:f}),E=d?c[0]-P:P,R=Number.parseFloat(E.toFixed(p)),C=d?c[0]-D:D,M=Number.parseFloat(C.toFixed(p)),N=Math.max(...c)?Math.abs(e-i)/Math.max(...c):0;return(P>D&&N>yg.diffThreshold||R<0||M<0)&&(R=e,M=i),{newWinnerRating:R,newLoserRating:M}}var c2e=t=>t?.reduce((e,i)=>(i.winningSide&&(e[i.winningSide-1]+=1),e),[0,0])||[0,0];function doe(t){let e=He(t,[{[hr]:!0},{matchUpIds:!0,[qn]:sn,[js]:Ch},{ratingType:!1,[qr]:v=>Dr[v]}]);if(e.error)return e;let{updateParticipantRatings:i,removePriorValues:r=!0,tournamentRecord:n,ratingType:a="ELO",refreshDynamic:s,considerGames:o,drawDefinition:l,matchUpIds:u,asDynamic:c}=t,d=Dr[a],{accessor:p}=d,f={},m=(t.matchUps||s&&An({drawDefinition:l,tournamentRecord:n,inContext:!0,matchUpFilters:{matchUpStatuses:Ki}}).matchUps||Ur({matchUpFilters:{matchUpIds:u,matchUpStatuses:Ki},tournamentRecord:n,inContext:!0}).matchUps)??[],h=`${a}.${GB}`,g=c?h:a;m.sort(Hh);for(let v of m){let{endDate:w,matchUpFormat:y,score:b,sides:S,winningSide:U}=v,T=v.matchUpType,P={eventType:T,scaleName:a,scaleType:ld},D={scaleName:h,eventType:T,scaleType:ld},E=Object.assign({},...(S??[]).map(x=>{let{sideNumber:L,participant:$}=x;return L&&{[L]:[$?.participantId,...$?.individualParticipantIds??[]].filter(Boolean).flat()}})),R=Object.assign({},...Object.values(E).flat().map(x=>{let L=f[x],$=!s||L?Wm({scaleAttributes:D,tournamentRecord:n,participantId:x}).scaleItem:void 0,V=Wm({tournamentRecord:n,scaleAttributes:P,participantId:x}).scaleItem,_=p?{[p]:void 0}:void 0;return x&&{[x]:$??V??{scaleName:g,eventType:T,scaleDate:w,scaleType:ld,scaleValue:_}}})),C=y?qi(y):{},M=C?.bestOf||1,N=C?.setsTo||1,A=o?M&N:M,O=b?.sets&&c2e(b.sets)||U===1&&[1,0]||[0,1],k=U?E[U]:[],F=U?E[3-U]:[];for(let x of k){let L=R[x]?.scaleValue,$=typeof L=="object"?L[p]:L;for(let V of F){let _=R[V]?.scaleValue,B=typeof _=="object"?_[p]:_,G=U?O[U]:[0,0],j=U?O[3-U]:[0,0],{newWinnerRating:K,newLoserRating:Y}=coe({winnerCountables:G,loserCountables:j,maxCountables:A,winnerRating:$,loserRating:B,ratingType:a}),X=p?{...L,[p]:K}:K,Z=p?{..._,[p]:Y}:Y;R[x].scaleValue=X,R[V].scaleValue=Z,R[x].scaleName=g,R[V].scaleName=g}}Object.assign(f,R),i&&PV({tournamentRecord:n,modifiedScaleValues:f,removePriorValues:r})}let I=m.map(({matchUpId:v})=>v);return{...W,modifiedScaleValues:f,outputScaleName:g,processedMatchUpIds:I}}function gN(t){let{matchUpIds:e=[],drawDefinition:i,roundNumber:r,newRound:n,isMock:a,event:s}=t;if(typeof i!="object")return{error:$e};let{participantIdPairings:o,matchUpsCount:l}=t,u=pN(t);if(u.error)return q({result:u});let{lastRoundNumber:c,availableMatchUpsCount:d=0,roundMatchUpsCount:p=0}=u;if(!l)n?l=p:d>0&&(l=d);else if(l>p&&t.restrictMatchUpsCount!==!1)return q({result:{error:re,info:"matchUpsCount error",context:{roundMatchUpsCount:p}}});if(o&&!Array.isArray(o)||l&&!lt(l)||e&&!Array.isArray(e)||!o&&!l)return{error:re,info:"matchUpsCount or pairings error"};if(l&&t.restrictMatchUpsCount!==!1&&l>32)return{error:re,info:"matchUpsCount must be less than 33"};if(r&&!t.ignoreLastRoundNumber&&r-1>(c||0))return{error:re,info:"roundNumber error"};let f=r??(n&&(c??0)+1||c||1);o=o??Ce(0,l).map(()=>({participantIds:[void 0,void 0]}));let m=g=>{if(!t.idPrefix)return;let I=i.drawId,v=t.idPrefix??"ah";return`${I}-${v}-${f}-${g}`},h=o?.map((g,I)=>{let v=g?.participantIds??[void 0,void 0];v.push(void 0,void 0);let w=v.slice(0,2).map((b,S)=>je({sideNumber:S+1,participantId:b})),y=e[I]??m(I)??Ct();return{roundNumber:f,matchUpStatus:_i,matchUpId:y,sides:w}});if(h?.length){let g=yn({drawDefinition:i,event:s})?.tieFormat;g&&h.forEach(I=>{let{tieMatchUps:v}=Xh({tieFormat:g,matchUp:I,isMock:a});Object.assign(I,{tieMatchUps:v,matchUpType:ei})})}return{roundNumber:f,matchUpsCount:h?.length??0,matchUps:h,...W}}function d2e({maxIterations:t=4e3,valueSortedPairings:e,pairingValues:i,valueObjects:r,deltaObjects:n}){let a=Object.assign({},...e.map(v=>({[v.pairing]:v.value}))),s=Object.keys(i),o=[],l=mq({actorsCount:s.length,valueSortedPairings:e,pairingValueMap:a,deltaObjects:n,valueObjects:r}),u=[ok(l)];o.push(l);let c=l.value,d=l,p=1,f=0,m=s.length,h;do m-=1,h=s.length*i[s[0]].length;while(h>t&&m>5);let g=[];s.forEach(v=>{i[v].slice(0,m).forEach(w=>{f+=1;let y=Im(v,w.opponent);if(!g.includes(y)){let b=mq({stipulated:[[v,w.opponent]],actorsCount:s.length,valueSortedPairings:e,pairingValueMap:a,deltaObjects:n,valueObjects:r});if(!u.includes(ok(b))){u.push(ok(b)),o.push(b);let{maxDelta:S,value:U}=b;S<d.maxDelta&&(d=b),(U<c||U===c&&Math.round(Math.random()))&&(c=U),g.push(y),p+=1}}}),o=o.filter(w=>Math.abs(w.value-c)<5)}),o.sort((v,w)=>v.maxDiff-w.maxDiff);let I=ha(o);return{candidatesCount:p,deltaCandidate:d,maxIterations:t,iterations:f,candidate:I}}function ok(t){return t.participantIdPairings.map(({participantIds:e})=>e.sort().join("|")).sort().join("/")}function mq({valueSortedPairings:t,stipulated:e=[],pairingValueMap:i,deltaObjects:r,valueObjects:n,actorsCount:a}){let s=e.flat(),o=[],l=0;e.filter(Boolean).forEach(d=>{let[p,f]=d,m=Im(p,f),h=i[m];o.push({participantIds:d,value:h}),l+=i[m]}),wr(t,a).flatMap(d=>Cn(d).map(p=>({...p,value:p.value+Math.random()*Math.round(Math.random())}))).forEach(d=>{let p=d.pairing.split("|");if(!p.reduce((f,m)=>s.includes(m)||f,!1)){s.push(...p);let f=d.value;l+=f,o.push({participantIds:p,value:f})}}),o.sort((d,p)=>d.value-p.value);let u=o.reduce((d,p)=>{let[f,m]=p.participantIds,h=Im(f,m),g=r[h];return Math.max(g,d)},0),c=o.reduce((d,p)=>{let[f,m]=p.participantIds,h=Im(f,m),g=n[h];return Math.max(g,d)},0);return{value:l,participantIdPairings:o,maxDelta:u,maxDiff:c}}function Im(t,e){return[t,e].sort(ZM).join("|")}function poe({participantIds:t}){let e={},i=[];t.forEach(n=>{e[n]=t.filter(a=>a!==n),e[n].forEach(a=>{let s=Im(a,n);i.includes(s)||i.push(s)})});let r=Object.assign({},...i.map(n=>({[n]:0})));return{uniquePairings:i,possiblePairings:e,deltaObjects:r}}function p2e({matchUps:t}){let e=[];for(let i of t){let r=i.sides.map(yt);if(r.length===2){let[n,a]=r,s=Im(n,a);e.includes(s)||e.push(s)}}return{encounters:e}}function f2e({possiblePairings:t,valueObjects:e}){let i={};for(let n of Object.keys(t)){let a=t[n].map(s=>r(n,s));i[n]=a.sort((s,o)=>s.value-o.value)}function r(n,a){let s=Im(n,a);return{opponent:a,value:e[s]}}return{pairingValues:i}}var m2e=0;function h2e({tournamentParticipants:t,adHocRatings:e,eventType:i,scaleName:r,pairing:n}){let a=Dr[r]?.defaultInitialization??m2e;return n.split("|").map(s=>{if(i===fs){let o=t?.find(l=>l.participantId===s)?.individualParticipantIds;return o?o?.map(l=>e[l]||a):a*2}else return e[s]||a})}function g2e(t){let{tournamentParticipants:e,adHocRatings:i={},possiblePairings:r,uniquePairings:n,maxIterations:a,minimizeDelta:s,deltaObjects:o,valueObjects:l,eventType:u,scaleName:c,salted:d}=t;n.forEach(w=>{let y=h2e({tournamentParticipants:e,adHocRatings:i,scaleName:c,eventType:u,pairing:w}),b=typeof d=="number"&&d||.5,S=d&&(Math.round(Math.random())?b:b*-1)||0,U=Math.abs(y[0]-y[1])+S,T=Math.abs(y[0]-y[1]);o[w]=T,l[w]||(l[w]=0),l[w]+=U?Math.pow(U,2):0});let p=n.map(w=>({pairing:w,value:l[w]})).sort((w,y)=>w.value-y.value),{pairingValues:f}=f2e({possiblePairings:r,valueObjects:l}),{candidate:m,candidatesCount:h,deltaCandidate:g,iterations:I}=d2e({valueSortedPairings:p,maxIterations:a,pairingValues:f,deltaObjects:o,valueObjects:l}),{participantIdPairings:v}=s?g:m;return{participantIdPairings:v,candidatesCount:h,deltaCandidate:g,iterations:I,candidate:m}}var I2e=100,v2e=100,y2e=4e3;function EV(t){let{encounterValue:e=I2e,sameTeamValue:i=v2e,maxIterations:r=y2e,updateParticipantRatings:n,generateMatchUps:a=!0,ignoreLastRoundNumber:s,iterationMatchUps:o,tournamentRecord:l,dynamicRatings:u,refreshDynamic:c,participantIds:d,drawDefinition:p,roundNumber:f,structureId:m,matchUpIds:h,eventType:g,scaleName:I,idPrefix:v,isMock:w,salted:y,event:b}=t;if(!p)return{error:$e};if(!t.structure&&!m)return{error:vi};let S=t.structure||tt({drawDefinition:p,structureId:m}).structure;if(!wt(S))return{error:mf};if(!d?.length)return{error:Wd};let U=[...o??[],...S?.matchUps??[]],{encounters:T}=p2e({matchUps:U}),P=l?.participants??[],D={};if(u){let G=nt(S?.matchUps?S.matchUps.map(({roundNumber:K})=>K):[]),j=Math.max(...G,0);if(j){let K=S?.matchUps?.filter(({roundNumber:X})=>X===j).map(({matchUpId:X})=>X),Y=doe({ratingType:I??b?.category?.ratingType,updateParticipantRatings:n,tournamentRecord:l,asDynamic:!0,refreshDynamic:c,drawDefinition:p,matchUpIds:K});if(Y.error)return Y;Y.modifiedScaleValues&&(D=Y.modifiedScaleValues)}}let{valueObjects:E}=b2e({tournamentParticipants:P,encounterValue:e,sameTeamValue:i,encounters:T}),{uniquePairings:R,possiblePairings:C,deltaObjects:M}=poe({participantIds:d}),N=Object.values(D).length?D:t.adHocRatings,A={tournamentParticipants:P,possiblePairings:C,uniquePairings:R,maxIterations:r,adHocRatings:N,deltaObjects:M,valueObjects:E,eventType:g,scaleName:I,salted:y},{candidatesCount:O,participantIdPairings:k,deltaCandidate:F,iterations:x,candidate:L}=g2e(A);if(!O)return{error:fM};let $,V;if(a){let G=gN({structureId:S?.structureId,ignoreLastRoundNumber:s,participantIdPairings:k,newRound:!0,drawDefinition:p,roundNumber:f,matchUpIds:h,idPrefix:v,isMock:w,event:b});if(G.error)return G;$=G.roundNumber,V=G.matchUps}let{maxDelta:_,maxDiff:B}=L;return{roundNumber:$,participantIdPairings:k,modifiedScaleValues:D,candidatesCount:O,deltaCandidate:F,...W,iterations:x,matchUps:V,maxDelta:_,maxDiff:B}}function b2e({encounters:t,tournamentParticipants:e,encounterValue:i,sameTeamValue:r}){let n={};for(let s of t)n[s]||(n[s]=0),n[s]+=i;let a=e?.filter(({participantType:s})=>s===_t);if(a)for(let s of a){let o=s.individualParticipantIds??[],{uniquePairings:l}=poe({participantIds:o});for(let u of l)n[u]||(n[u]=0),n[u]+=r}return{valueObjects:n}}function foe(t){let{drawType:e=Jo,attachConsolation:i=!0,applyPositioning:r=!0,tournamentRecord:n,staggeredEntry:a,automated:s,placeByes:o,isMock:l,event:u}=t,c=t?.drawDefinition;if(!c)return{error:$e};let d=Rr,p=$h({stageSequence:1,drawDefinition:c,stage:d}),f=[eo,oU,gu].includes(e)?p.length:Ev(p.length);if(!a&&e===Ov&&p.length<2||e===eo&&p.length<3)return{error:nM};let{tieFormat:m,matchUpType:h}=t;if(m){let E=Gn({tieFormat:m});if(E.error)return E}m=Gr(m??yn({drawDefinition:c})?.tieFormat),h=h??c.matchUpType;let{structures:g}=io({stageSequence:1,drawDefinition:c,stage:d});if(g.length>1)return{error:Ate};if(g?.[0]?.matchUps?.length)return{error:IB};let I=g?.[0]?.structureId;Object.assign(t,je({structureName:t.structureName??Qr(Rr),structureId:I,matchUpType:h,tieFormat:m,drawSize:f,stage:d}));let v=soe(t);if(v.error)return v;let w=v.generators[e];if(!w)return{error:K$};let y=w?.();if(y.error)return y;let{structures:b,links:S}=y,U=b.flatMap(E=>At({structure:E}).matchUps);m&&U.forEach(E=>{let{tieMatchUps:R}=Xh({matchUp:E,tieFormat:m,isMock:l});Object.assign(E,{tieMatchUps:R,matchUpType:h})}),(!r||!i)&&(c=Oe(c,!1,!0)),c.links??=[],S.length&&c.links.push(...S);let T=new Set(b.map(({structureId:E})=>E));c.structures??=[];let P=new Set(c.structures.map(({structureId:E})=>E));c.structures=c.structures.map(E=>T.has(E.structureId)?b.find(({structureId:R})=>R===E.structureId):E);let D=b.filter(({structureId:E})=>!P.has(E));return D.length&&c.structures.push(...D),s&&$U({seedingProfile:t.seedingProfile,applyPositioning:r,tournamentRecord:n,drawDefinition:c,structureId:I,placeByes:o,drawSize:f,event:u}),i&&ii({drawDefinition:c}),{links:S,structures:b,...W}}var RV={};dt(RV,{ScoringEngine:()=>boe,addPoint:()=>bp,analyzeScore:()=>qV,analyzeSequence:()=>ele,analyzeSet:()=>sw,calculateMatchStatistics:()=>$V,calculatePointsTo:()=>vN,checkScoreHasValue:()=>fr,checkSetIsComplete:()=>SN,createMatchUp:()=>nd,deduceMatchUpFormat:()=>RN,enrichPointHistory:()=>voe,exportMatchUpJSON:()=>$je,generate:()=>moe,generateScoreString:()=>Jl,generateTieMatchUpScore:()=>GU,getEpisodes:()=>_V,getQuickStats:()=>yoe,getScore:()=>Cd,getScoreboard:()=>xV,getSetComplement:()=>KV,getSetScoreString:()=>Sje,getTiebreakComplement:()=>EN,getWinner:()=>FV,groupByMatch:()=>nle,helpers:()=>Soe,inferServeSide:()=>MV,isComplete:()=>LV,isValidMatchUpFormat:()=>$a,keyValueScore:()=>Goe,mcpValidator:()=>_je,mutate:()=>woe,parseCSV:()=>rle,parseMCPPoint:()=>ile,parseMatchUpFormat:()=>qi,parseScoreString:()=>JU,pbpValidator:()=>Tje,pointParser:()=>tle,query:()=>Yoe,resolvePointValue:()=>NV,reverseScore:()=>hoe,shotParser:()=>Gx,shotSplitter:()=>Zoe,stringifyMatchUpFormat:()=>wM,tidyScore:()=>qoe,toStatObjects:()=>BV,validateMCPMatch:()=>ale,validateMatchUp:()=>Xoe,validateMatchUpScore:()=>Koe,validateScore:()=>YV,validateSet:()=>Uje,validateSetScore:()=>zV,validateTieFormat:()=>Gn});var moe={};dt(moe,{ScoringEngine:()=>boe,generateScoreString:()=>Jl,generateTieMatchUpScore:()=>GU,reverseScore:()=>hoe});function Jl(t){let{winnerFirst:e=!0,setTBlast:i=!0,addOutcomeString:r,reversed:n=!1,matchUpStatus:a,matchUpFormat:s,autoComplete:o,winningSide:l,sets:u}=t;if(!u)return{error:Je,info:"missing sets"};let c=s&&qi(s),{bestOf:d,finalSetFormat:p,setFormat:f}=c??{},m=n||!(!e||!l||l===1),h=r?w2e({matchUpStatus:a}):"",g=u?.sort(S2e).map(I).filter(Boolean).join(" ")||"";if(!h)return g;if(l===2)return`${h} ${g}`;return`${g} ${h}`;function I(v){let w=d&&v.setNumber===d&&p?p:f,y=V=>Ai(V?.side1Score)||Ai(V?.side2Score),b=(V=>Ai(V?.side1TiebreakScore)||Ai(V?.side2TiebreakScore))(v),S=w?.tiebreakSet||!y(v)&&b,{side1Score:U,side2Score:T,side1TiebreakScore:P,side2TiebreakScore:D}=v,E=P||(Ai(P)||b&&o?0:""),R=D||(Ai(D)||b&&o?0:"");if(S){let V=y(v)&&!b,_=V?U:E,B=V?T:R;return`[${(m?[B,_]:[_,B]).join("-")}]`}let C=b?Math.min(E,R):"",M=C===E?1:2,N=Ai(C)?`(${C})`:"",A=U||(Ai(U)||o?0:""),O=T||(Ai(T)||o?0:""),k=V=>!i&&M===V?N:"",F=`${A}${k(1)}`,x=`${O}${k(2)}`,L=i&&b?`(${C})`:"",$=m?`${[x,F].join("-")}${L}`:`${[F,x].join("-")}${L}`;return["-"," "].includes($)&&($=""),$}}function w2e({matchUpStatus:t}){let e={[Sr]:"RET",[ai]:"WO",[Wi]:"DF/DF",[Si]:"WO/WO",[Kd]:"SUS",[Ta]:"ABN",[qt]:"DEF",[$v]:"DR"};return t&&e[t]||""}function S2e(t,e){return t.setNumber-e.setNumber}function hoe(t){if(!t?.score)return{error:Je};let{sets:e}=t.score,i=e.map(s=>{let{side1TiebreakScore:o,side2TiebreakScore:l,winningSide:u,side1Score:c,side2Score:d,setNumber:p}=s;return je({winningSide:u?3-u:void 0,side1TiebreakScore:l,side2TiebreakScore:o,side1Score:d,side2Score:c,setNumber:p})}),r=t?.setTBlast,n=Jl({setTBlast:r,sets:i}),a=Jl({sets:i,reversed:!0,setTBlast:r});return{reversedScore:{sets:i,scoreStringSide1:n,scoreStringSide2:a},...W}}function nd(t){let{matchUpId:e=Ct(),matchUpFormat:i,participants:r=[],isDoubles:n=!1,matchUpType:a}=t,s=a||(n?"DOUBLES":"SINGLES"),o=r.map((l,u)=>({sideNumber:u+1,participantId:l.participantId,participant:l}));return o.length===0&&o.push({sideNumber:1},{sideNumber:2}),{matchUpId:e,matchUpFormat:i,matchUpStatus:"TO_BE_PLAYED",matchUpType:s,sides:o,score:{sets:[]},createdAt:new Date().toISOString()}}function CV(t){return t?!!t.aggregate:!1}function IN(t,e){let i=t.bestOf||t.exactly||3,r=Math.ceil(i/2);if(e[0]===r-1&&e[1]===r-1&&t.finalSetFormat){let a=t.finalSetFormat;return a.tiebreakSet?"matchTiebreak":a.timed?"timed":"standard"}let n=t.setFormat;return n?n.tiebreakSet?"tiebreakOnly":n.timed?"timed":"standard":"standard"}function vN(t,e,i,r,n){if(i==="timed"||!r)return;let a=U2e(t),s=T2e(t),o=e.exactly||e.bestOf||3,l=Math.ceil(o/2),{side1Points:u,side2Points:c}=D2e(a),d=P2e(u,c,r,i,e,a),p=R2e(a,r,i),f=C2e(d,p,r,i),m=M2e(f,s,l,e),h=A2e(d,n);return{pointsToGame:d,pointsToSet:f,pointsToMatch:m,gamesToSet:p,isBreakpoint:h}}function U2e(t){let e=t.score.sets;if(e.length===0)return;let i=e.at(-1);return i?.winningSide===void 0?i:void 0}function T2e(t){let e=[0,0];return t.score.sets.forEach(i=>{i.winningSide===1&&e[0]++,i.winningSide===2&&e[1]++}),e}function D2e(t){if(!t)return{side1Points:0,side2Points:0};let e=t.side1GameScores||[],i=t.side2GameScores||[];if(e.length===0&&i.length===0)return{side1Points:0,side2Points:0};let r=Math.max(e.length,i.length)-1;return{side1Points:e[r]??0,side2Points:i[r]??0}}function P2e(t,e,i,r,n,a){if(r==="tiebreakOnly"){let s=i.tiebreakSet?.tiebreakTo||11,o=i.tiebreakSet?.NoAD||!1;return lk(t,e,s,o)}if(r==="matchTiebreak"){let s=n.finalSetFormat?.tiebreakSet?.tiebreakTo||10,o=n.finalSetFormat?.tiebreakSet?.NoAD||!1;return lk(t,e,s,o)}if(a){let s=a.side1Score||0,o=a.side2Score||0,l=i.setTo||6,u=(typeof i.tiebreakAt=="number"?i.tiebreakAt:void 0)??l;if(!i.noTiebreak&&s===u&&o===u){let c=i.tiebreakFormat?.tiebreakTo||7,d=i.tiebreakFormat?.NoAD||!1;return lk(t,e,c,d)}}if(n.gameFormat?.type==="CONSECUTIVE"){let s=n.gameFormat.count||3;return[s,s]}return E2e(t,e,i)}function E2e(t,e,i){let r=i.gameFormat?.NoAD||i.NoAD||!1,n=4;return[hq(t,e,n,r),hq(e,t,n,r)]}function hq(t,e,i,r){if(t>=i-1&&e>=i-1){if(r)return t>e?0:t===e?1:2;let n=t-e;return n>=2?0:n===1?1:2}return t>=i?0:i-t}function lk(t,e,i,r){return[gq(t,e,i,r),gq(e,t,i,r)]}function gq(t,e,i,r){if(t>=i&&(t-e>=2||r&&t>e))return 0;if(t>=i-1&&e>=i-1){if(r)return t>e?0:t===e?1:2;let n=t-e;return n>=2?0:n===1?1:2}return t>=i?0:i-t}function R2e(t,e,i){if(i==="tiebreakOnly"||i==="matchTiebreak")return!t||t.winningSide!==void 0?[1,1]:[1,1];let r=t?.side1Score||0,n=t?.side2Score||0,a=e.setTo||6,s=(typeof e.tiebreakAt=="number"?e.tiebreakAt:void 0)??a,o=e.noTiebreak||!1,l=e.winBy||2;return[Iq(r,n,a,s,o,l),Iq(n,r,a,s,o,l)]}function Iq(t,e,i,r,n,a){if(!n&&t===r&&e===r)return 1;if(t>=i){let o=t-e;return o>=a?0:a-o}let s=i-t;if(e>=i-1&&t>=i-1){if(!n)return Math.max(1,i-t);let o=t-e;return o>=a?0:a-o}return s}function C2e(t,e,i,r){if(r==="tiebreakOnly"||r==="matchTiebreak")return[...t];let n=4;return[vq(t[0],e[0],n),vq(t[1],e[1],n)]}function vq(t,e,i){if(e<=0)return 0;let r=Math.max(0,e-1);return t+r*i}function M2e(t,e,i,r){let n=r.setFormat,a=N2e(n,r);return[yq(t[0],e[0],i,a),yq(t[1],e[1],i,a)]}function N2e(t,e){if(!t)return 24;if(t.tiebreakSet)return t.tiebreakSet.tiebreakTo||11;if(t.timed)return 0;let i=t.setTo||6,r=e.gameFormat?.type==="CONSECUTIVE"?e.gameFormat?.count||3:4;return i*r}function yq(t,e,i,r){if(e>=i)return 0;let n=Math.max(0,i-e-1);return t+n*r}function A2e(t,e){if(e===void 0)return!1;let i=1-e;return t[i]===1}function MV(t,e,i){if(i==="timed")return;let r=k2e(t);return CV(e)?O2e(t,r):i==="tiebreakOnly"||i==="matchTiebreak"?x2e(r):F2e(t,e,r)}function k2e(t){let e=t.score.sets;if(e.length===0)return;let i=e[e.length-1];return i.winningSide===void 0?i:void 0}function O2e(t,e){let i=0;for(let r of t.score.sets)r.winningSide!==void 0&&(r.side1TiebreakScore!==void 0?i+=(r.side1TiebreakScore??0)+(r.side2TiebreakScore??0):i+=(r.side1Score??0)+(r.side2Score??0));if(e&&e.winningSide===void 0){let r=e.side1GameScores||[],n=e.side2GameScores||[];if(r.length>0||n.length>0){let a=Math.max(r.length,n.length)-1;i+=(r[a]??0)+(n[a]??0)}else i+=(e.side1Score??0)+(e.side2Score??0)}return i%2===0?"deuce":"ad"}function x2e(t){if(!t)return"deuce";let e=t.side1GameScores||[],i=t.side2GameScores||[];return e.length===0&&i.length===0||((e[0]??0)+(i[0]??0))%2===0?"deuce":"ad"}function F2e(t,e,i){if(!i)return"deuce";let r=i.side1GameScores||[],n=i.side2GameScores||[];if(r.length===0&&n.length===0)return"deuce";let a=Math.max(r.length,n.length)-1;return((r[a]??0)+(n[a]??0))%2===0?"deuce":"ad"}function NV(t,e){if(!e.length)return 1;for(let{condition:i,value:r}of e)if(i.results&&t.result&&i.results.includes(t.result)||i.strokes&&t.stroke&&i.strokes.includes(t.stroke))return r;return 1}function bp(t,e,i){if(!wt(e)||e.winner===void 0||e.winner===null)return t;let r=t,{winner:n,server:a,timestamp:s}=e;r.history??={points:[]};let o=qi(t.matchUpFormat);if(!o)throw new Error(`Invalid matchUpFormat: ${t.matchUpFormat}`);let l=o.exactly||o.bestOf||3,u=Math.ceil(l/2),c=r.history.points.length+1,d=r.history.points.length,p=[0,0];r.score.sets.forEach(U=>{U.winningSide===1&&p[0]++,U.winningSide===2&&p[1]++});let f=IN(o,p),m=p[0]===u-1&&p[1]===u-1,h=m&&o.finalSetFormat?o.finalSetFormat:o.setFormat,g=h?.tiebreakSet?.modifier==="RALLY"||h?.modifier==="RALLY";a===void 0&&!g&&(a=OV(r,o,f));let I=e.code;!I&&n!==void 0&&a!==void 0&&(I=n===a?"S":"R");let v={...e,pointNumber:c,winner:n,server:a,timestamp:s||new Date().toISOString()};I&&(v.code=I),v.index=d;let w=vN(r,o,f,h,a);w&&(v.pointsToGame=w.pointsToGame,v.pointsToSet=w.pointsToSet,v.pointsToMatch=w.pointsToMatch,v.gamesToSet=w.gamesToSet,v.isBreakpoint=w.isBreakpoint);let y=MV(r,o,f);y!==void 0&&(v.serveSide=y);let b=i?.pointMultipliers||[],S=NV(v,b);switch(S!==1&&(v.scoreValue=S),r.history.points.push(v),r.matchUpStatus==="TO_BE_PLAYED"&&(r.matchUpStatus="IN_PROGRESS"),f){case"tiebreakOnly":_2e(r,v,n,o,h,p,u,S);break;case"matchTiebreak":$2e(r,v,n,o,p,u,S);break;case"timed":B2e(r,v,n,h,S);break;default:L2e(r,v,n,o,h,p,u,m);break}return r}function L2e(t,e,i,r,n,a,s,o){let l=yN(t,!1,!1),u=t.score.sets.indexOf(l),c=l.side1Score||0,d=l.side2Score||0,p=l.side1GameScores||[],f=l.side2GameScores||[];p.length===0&&f.length===0&&(p.push(0),f.push(0));let m=Math.max(p.length,f.length)-1,h=m>=0?p[m]??0:0,g=m>=0?f[m]??0:0;e.set=u,e.game=m,e.number=h+g;let I=n.setTo||6,v=(typeof n.tiebreakAt=="number"?n.tiebreakAt:void 0)??I,w=o&&r.finalSetFormat?.noTiebreak;i===0?(h++,p[p.length-1]=h):(g++,f[f.length-1]=g),l.side1GameScores=p,l.side2GameScores=f;let y=r.gameFormat?.type==="CONSECUTIVE",b=r.gameFormat?.count||3;if(y){let P=l.currentStreak;P&&P.side===i?l.currentStreak={side:i,count:P.count+1}:l.currentStreak={side:i,count:1}}let S=!w&&c===v&&d===v,U;y&&!S?U=l.currentStreak.count>=b?l.currentStreak.side:void 0:U=V2e(h,g,n,S);let T=U===void 0?goe(h,g,S,y&&!S):"0-0";if(e.score=T,U!==void 0){y&&(l.currentStreak=void 0),U===0?l.side1Score=c+1:l.side2Score=d+1,S&&(l.side1TiebreakScore=h,l.side2TiebreakScore=g);let P=j2e(l.side1Score||0,l.side2Score||0,n,o,r.finalSetFormat);typeof P=="number"?(l.winningSide=P+1,AV(t,r,s)):(l.side1GameScores.push(0),l.side2GameScores.push(0))}}function _2e(t,e,i,r,n,a,s,o=1){let l=yN(t,!0,!1),u=t.score.sets.indexOf(l),c=n.tiebreakSet.tiebreakTo||11,d=n.tiebreakSet.NoAD||!1,p=l.side1GameScores||[],f=l.side2GameScores||[];p.length===0&&f.length===0&&(p.push(0),f.push(0),l.side1GameScores=p,l.side2GameScores=f);let m=p[0]||0,h=f[0]||0;e.set=u,e.game=0,e.number=m+h,i===0?(m+=o,p[0]=m):(h+=o,f[0]=h),l.side1GameScores=p,l.side2GameScores=f;let g=kV(m,h,c,d);e.score=g===void 0?`${m}-${h}`:"0-0",g!==void 0&&(l.winningSide=g+1,l.side1TiebreakScore=m,l.side2TiebreakScore=h,l.side1Score=g===0?1:0,l.side2Score=g===0?0:1,AV(t,r,s))}function $2e(t,e,i,r,n,a,s=1){let o=r.finalSetFormat?.tiebreakSet?.tiebreakTo||10,l=r.finalSetFormat?.tiebreakSet?.NoAD||!1,u=yN(t,!1,!1),c=t.score.sets.indexOf(u),d=u.side1GameScores||[],p=u.side2GameScores||[];d.length===0&&p.length===0&&(d.push(0),p.push(0),u.side1GameScores=d,u.side2GameScores=p);let f=d[0]||0,m=p[0]||0;e.set=c,e.game=0,e.number=f+m,i===0?(f+=s,d[0]=f):(m+=s,p[0]=m),u.side1GameScores=d,u.side2GameScores=p;let h=kV(f,m,o,l);e.score=h===void 0?`${f}-${m}`:"0-0",h!==void 0&&(u.side1TiebreakScore=f,u.side2TiebreakScore=m,u.side1Score=h===0?1:0,u.side2Score=h===0?0:1,u.winningSide=h+1,AV(t,r,a))}function B2e(t,e,i,r,n=1){let a=yN(t,!1,!0),s=t.score.sets.indexOf(a);e.set=s,e.game=0,e.number=(a.side1Score||0)+(a.side2Score||0),i===0?a.side1Score=(a.side1Score||0)+n:a.side2Score=(a.side2Score||0)+n;let o=a.side1Score||0,l=a.side2Score||0;e.score=`${o}-${l}`}function yN(t,e,i){let r=t.score.sets.length-1;if(r>=0&&t.score.sets[r].winningSide===void 0)return t.score.sets[r];let n={setNumber:t.score.sets.length+1,side1Score:0,side2Score:0,side1GameScores:[],side2GameScores:[]};return e&&(n.isTiebreakOnly=!0),i&&(n.isTimed=!0),t.score.sets.push(n),n}function AV(t,e,i){let r=[0,0];t.score.sets.forEach(o=>{o.winningSide===1&&r[0]++,o.winningSide===2&&r[1]++});let n=CV(e),a=e.exactly;if(n){let o=a||e.bestOf||3;if(t.score.sets.filter(u=>u.winningSide!==void 0).length<o)return;let l=t.score.sets.reduce((u,c)=>(c.side1TiebreakScore!==void 0&&c.side2TiebreakScore!==void 0?(u[0]+=c.side1TiebreakScore,u[1]+=c.side2TiebreakScore):(u[0]+=c.side1Score??0,u[1]+=c.side2Score??0),u),[0,0]);l[0]!==l[1]&&(t.matchUpStatus="COMPLETED",t.winningSide=l[0]>l[1]?1:2,t.endTime=new Date().toISOString());return}if(!(r[0]>=i||r[1]>=i)||a&&t.score.sets.filter(o=>o.winningSide!==void 0).length<a)return;let s=r[0]>=i?0:1;t.matchUpStatus="COMPLETED",t.winningSide=s+1,t.endTime=new Date().toISOString()}function kV(t,e,i,r=!1){let n=Math.abs(t-e),a=r?1:2;if((t>=i||e>=i)&&n>=a)return t>e?0:1}function V2e(t,e,i,r){let n=i.gameFormat?.NoAD||i.NoAD||!1;if(r){let o=i.tiebreakFormat?.tiebreakTo||7,l=i.tiebreakFormat?.NoAD||!1;return kV(t,e,o,l)}let a=4,s=Math.abs(t-e);if(n)return t>=a||e>=a?t>e?0:1:void 0;if((t>=a||e>=a)&&s>=2)return t>e?0:1}function j2e(t,e,i,r,n){let a=i.setTo||6,s=(typeof i.tiebreakAt=="number"?i.tiebreakAt:void 0)??a,o=r&&n?.noTiebreak;if(a===1)return t>=1||e>=1?t>e?0:1:void 0;let l=(r&&n?n:i).winBy||2;if(!o&&(t===s+1||e===s+1)||(t>=a||e>=a)&&Math.abs(t-e)>=l)return t>e?0:1}function OV(t,e,i){let r=G2e(t,e,i);return t.history?.points?.[0]?.server===1?1-r:r}function G2e(t,e,i){let r=t.score.sets.length-1,n=r>=0?t.score.sets[r]:void 0;if(i==="tiebreakOnly"||i==="matchTiebreak"){let u=n?.side1GameScores||[],c=n?.side2GameScores||[],d=(u[0]||0)+(c[0]||0),p=0;for(let h=0;h<t.score.sets.length-1;h++){let g=t.score.sets[h];p+=(g.side1Score||0)+(g.side2Score||0)}let f=p%2,m=Math.floor(d/2)%2;return(f+m)%2}if(i==="timed")return((n?.side1Score||0)+(n?.side2Score||0))%2;let a=n?.side1Score||0,s=n?.side2Score||0,o=e.setFormat?.setTo||6,l=(typeof e.setFormat?.tiebreakAt=="number"?e.setFormat.tiebreakAt:void 0)??o;if(!e.finalSetFormat?.noTiebreak&&a===l&&s===l){let u=n?.side1GameScores||[],c=n?.side2GameScores||[],d=(u.at(-1)||0)+(c.at(-1)||0),p=(a+s)%2,f=Math.floor(d/2)%2;return(p+f)%2}return(a+s)%2}function goe(t,e,i,r){if(i||r)return`${t}-${e}`;let n=["0","15","30","40"];if(t<4&&e<4)return`${n[t]}-${n[e]}`;if(t>=3&&e>=3&&t===e)return"40-40";if(t>=3&&e>=3){let a=t-e;if(a===1)return"A-40";if(a===-1)return"40-A";if(a>=2)return"G-40";if(a<=-2)return"40-G"}return t>=3?`40-${e<4?n[e]:"40"}`:e>=3?`${t<4?n[t]:"40"}-40`:`${t<4?n[t]:"0"}-${e<4?n[e]:"0"}`}function Cd(t,e){let i=t.score.sets,r=z2e(t,e?.useBracketNotation),n=i.length>0?i.at(-1):null,a=n&&n.winningSide===void 0?[n.side1Score||0,n.side2Score||0]:[0,0],s=[0,0];if(n?.side1GameScores&&n.side2GameScores){let u=Math.max(n.side1GameScores.length,n.side2GameScores.length)-1;u>=0&&(s=[n.side1GameScores[u]||0,n.side2GameScores[u]||0])}let o=H2e(t,s),l=W2e(t);return{sets:i,scoreString:r,games:a,points:s,pointDisplay:o,situation:l}}function H2e(t,e){if(t.matchUpStatus==="COMPLETED"||t.matchUpStatus==="TO_BE_PLAYED")return;let i=qi(t.matchUpFormat);if(!i)return;let r=t.score.sets.at(-1);if(!r||r.winningSide!==void 0)return;let n=[0,0];t.score.sets.forEach(c=>{c.winningSide===1&&n[0]++,c.winningSide===2&&n[1]++});let a=IN(i,n),s=a==="tiebreakOnly"||a==="matchTiebreak",o=i.gameFormat?.type==="CONSECUTIVE",l=s;if(!l&&a==="standard"){let c=i.exactly||i.bestOf||3,d=Math.ceil(c/2),p=n[0]===d-1&&n[1]===d-1,f=p&&i.finalSetFormat?i.finalSetFormat:i.setFormat;if(f){let m=r.side1Score||0,h=r.side2Score||0,g=f.setTo||6,I=(typeof f.tiebreakAt=="number"?f.tiebreakAt:void 0)??g,v=f.noTiebreak||!1,w=p&&i.finalSetFormat?.noTiebreak;l=!v&&!w&&m===I&&h===I}}let u=goe(e[0],e[1],l,o&&!l).split("-");return u.length===2?[u[0],u[1]]:[String(e[0]),String(e[1])]}function W2e(t){if(t.matchUpStatus==="COMPLETED"||t.matchUpStatus==="TO_BE_PLAYED")return;let e=qi(t.matchUpFormat);if(!e)return;let i=e.exactly||e.bestOf||3,r=Math.ceil(i/2),n=[0,0];t.score.sets.forEach(y=>{y.winningSide===1&&n[0]++,y.winningSide===2&&n[1]++});let a=IN(e,n),s=n[0]===r-1&&n[1]===r-1,o=s&&e.finalSetFormat?e.finalSetFormat:e.setFormat,l=o?.tiebreakSet?.modifier==="RALLY"||o?.modifier==="RALLY",u;l||(u=OV(t,e,a));let c=vN(t,e,a,o,u);if(!c)return{isBreakPoint:!1,isGamePoint:!1,isSetPoint:!1,isMatchPoint:!1,isGoldenPoint:!1,isTiebreak:!1,server:u};let{pointsToGame:d,pointsToSet:p,pointsToMatch:f,isBreakpoint:m}=c,h=a==="tiebreakOnly"||a==="matchTiebreak";if(!h&&a==="standard"&&o){let y=t.score.sets.at(-1);if(y){let b=y.side1Score||0,S=y.side2Score||0,U=o.setTo||6,T=(typeof o.tiebreakAt=="number"?o.tiebreakAt:void 0)??U,P=o.noTiebreak||!1,D=s&&e.finalSetFormat?.noTiebreak;h=!P&&!D&&b===T&&S===T}}let g=!!(o?.NoAD||o?.gameFormat?.NoAD||h&&(o?.tiebreakFormat?.NoAD||o?.tiebreakSet?.NoAD||e.finalSetFormat?.tiebreakSet?.NoAD))&&d[0]===1&&d[1]===1,I=u===void 0?!1:d[u]===1,v=Math.min(p[0],p[1])===1,w=Math.min(f[0],f[1])===1;return{isBreakPoint:m,isGamePoint:I,isSetPoint:v,isMatchPoint:w,isGoldenPoint:g,isTiebreak:h,server:u}}function z2e(t,e=!1){let i=t.score.sets;return i.length===0?"0-0":i.map(r=>{let n=r.side1Score||0,a=r.side2Score||0;if(r.side1TiebreakScore!==void 0||r.side2TiebreakScore!==void 0){let s=r.side1TiebreakScore||0,o=r.side2TiebreakScore||0;return e&&(n===0&&a===1||n===1&&a===0)?`[${s}-${o}]`:n>a?`${n}-${a}(${o})`:`${n}(${s})-${a}`}return`${n}-${a}`}).join(", ")}function xV(t,e){let i=t.score.sets;if(i.length===0)return"0-0";let r=e?.perspective,n=i.map(s=>{let o=s.side1Score||0,l=s.side2Score||0;if(r===1&&([o,l]=[l,o]),s.side1TiebreakScore!==void 0||s.side2TiebreakScore!==void 0){let u=s.side1TiebreakScore||0,c=s.side2TiebreakScore||0;return r===1&&([u,c]=[c,u]),o>l?`${o}-${l}(${c})`:`${o}(${u})-${l}`}return`${o}-${l}`}),a=i.at(-1);if(t.matchUpStatus==="IN_PROGRESS"&&a&&!a.winningSide){let s=a.side1GameScores||[],o=s.length-1;if(o>=0&&s.length>0){let l=s[o]||0,u=(a.side2GameScores||[])[o]||0;if(l===0&&u===0)return n.join(", ");r===1&&([l,u]=[u,l]);let c=a.side1Score||0,d=a.side2Score||0,p=t.matchUpFormat?qi(t.matchUpFormat):void 0,f=p?.setFormat?.setTo||6,m=(typeof p?.setFormat?.tiebreakAt=="number"?p.setFormat.tiebreakAt:void 0)??f,h=c===m&&d===m,g=p?.gameFormat?.type==="CONSECUTIVE",I=n.at(-1),v=`${n.slice(0,-1).join(", ")}${n.length>1?", ":""}${I}`;if(h||g)return`${v} (${l}-${u})`;{let w=q2e(l,u);return`${v} (${w})`}}}return n.join(", ")}function q2e(t,e){let i=["0","15","30","40"];if(t<=3&&e<=3)return`${i[t]}-${i[e]}`;if(t>=3&&e>=3){let r=t-e;return r===0?"40-40":r===1?"A-40":r===-1?"40-A":r>=2?"G-40":"40-G"}return t>=3?"G-40":e>=3?"40-G":`${i[t]}-${i[e]}`}function FV(t){if(t.matchUpStatus==="COMPLETED")return t.winningSide}function LV(t){return t.matchUpStatus==="COMPLETED"}function _V(t){if(!t)return[];let e=t.history?.points;if(!e||e.length===0)return[];let i=[];for(let r=0;r<e.length;r++){let n=e[r],a=r<e.length-1?e[r+1]:void 0,s=n.set??0,o=n.game??0,l=n.number??0,u=a?a.set??0:void 0,c=a?a.game??0:void 0,d=r===e.length-1,p=d?t.matchUpStatus==="COMPLETED"||u===void 0&&c===void 0:u!==s||c!==o,f=d?t.matchUpStatus==="COMPLETED"||!1:a!==void 0&&u!==s,m;p&&(m=n.winner);let h;if(f){let b=t.score.sets[s];b?.winningSide!==void 0&&(h=b.winningSide-1)}let g={};n.pointsToGame&&(g.pointsToGame=n.pointsToGame),n.pointsToSet&&(g.pointsToSet=n.pointsToSet),n.pointsToMatch&&(g.pointsToMatch=n.pointsToMatch),n.gamesToSet&&(g.gamesToSet=n.gamesToSet),n.isBreakpoint!==void 0&&(g.isBreakpoint=n.isBreakpoint);let I=a?.server??n.server??0,v=t.score.sets[s],w=!!(v?.isTiebreakOnly||o>0&&v&&v.side1Score!==void 0&&v.side2Score!==void 0&&!v.isTiebreakOnly),y={action:"addPoint",point:{index:r,number:l,winner:n.winner,server:n.server,score:n.score,result:n.result},game:{index:o,isTiebreak:w,complete:p,winner:m},set:{index:s,complete:f,winner:h},needed:g,nextService:I,result:n.result,complete:d&&t.matchUpStatus==="COMPLETED"};i.push(y)}return i}var Y2e={A:"Ace",D:"Double Fault",S:"Serve Winner",R:"Return Winner",W:"Winner",E:"Unforced Error",F:"Forced Error"},K2e=new Set(["A","S"]),X2e=new Set(["D","R","E","F"]);function J2e(t,e){let i={...t};return i.server=e.server,i.index=e.index,i.set=e.set,i.game=e.game,i.code&&!i.winner&&(i.winner=Q2e(i.code,e.server)),i.code&&!i.result&&(i.result=Y2e[i.code]),i.first_serve?i.serve=2:i.serve||(i.serve=1),i}function Q2e(t,e){return K2e.has(t)?e:X2e.has(t)?1-e:e}function Z2e(t){let e=[],i=[],r=t.result?.toLowerCase()||"";return r.includes("ace")&&e.push("aces"),(r.includes("winner")||r.includes("ace"))&&e.push("winners"),r.includes("double fault")&&i.push("doubleFaults"),r.includes("unforced error")&&i.push("unforcedErrors"),r.includes("forced error")&&i.push("forcedErrors"),t.winner===t.server?(e.push("servesWon"),t.serve===1?e.push("serves1stWon"):t.serve===2&&e.push("serves2ndWon")):(e.push("returns"),t.serve===1?e.push("received1stWon"):t.serve===2&&e.push("received2ndWon")),e.push("pointsWon"),{winner:e,loser:i}}function Ioe(t,e){let i={players:{},teams:{}};for(let a=0;a<2;a++)i.players[a]={},i.teams[a]={};let r=t;e?.setFilter!==void 0&&(r=t.filter(a=>a.set===e.setFilter));let n;return r.forEach((a,s)=>{if(a.winner===void 0){console.warn("Point missing winner:",a);return}let{winner:o,loser:l}=Z2e(a),u=a.winner,c=1-u;if(o.forEach(d=>{i.teams[u][d]||(i.teams[u][d]=[]),i.teams[u][d].push(a),i.players[u][d]||(i.players[u][d]=[]),i.players[u][d].push(a)}),l.forEach(d=>{i.teams[c][d]||(i.teams[c][d]=[]),i.teams[c][d].push(a),i.players[c][d]||(i.players[c][d]=[]),i.players[c][d].push(a)}),a.server!==void 0){let d=a.server;i.teams[d].pointsServed||(i.teams[d].pointsServed=[]),i.teams[d].pointsServed.push(a),a.serve===1?(i.teams[d].serves1stIn||(i.teams[d].serves1stIn=[]),i.teams[d].serves1stIn.push(a)):a.serve===2&&(i.teams[d].serves2ndIn||(i.teams[d].serves2ndIn=[]),i.teams[d].serves2ndIn.push(a))}if(a.hand){let d=a.hand;i.teams[u][d]||(i.teams[u][d]=[]),i.teams[u][d].push({point:a,index:s})}if(eVe(a,n)&&n?.winner!==void 0){let d=n.winner;i.teams[d].gamesWon||(i.teams[d].gamesWon=[]),i.teams[d].gamesWon.push(n),i.players[d].gamesWon||(i.players[d].gamesWon=[]),i.players[d].gamesWon.push(n)}if(a.breakpoint){let d=a.server;i.teams[d].breakpointsFaced||(i.teams[d].breakpointsFaced=[]),i.teams[d].breakpointsFaced.push(a),u===d&&(i.teams[d].breakpointsSaved||(i.teams[d].breakpointsSaved=[]),i.teams[d].breakpointsSaved.push(a))}n=a}),i}function eVe(t,e){return e&&t.game!==void 0&&e.game!==void 0?t.game!==e.game:!1}function tVe(t){let e={totalPoints:0,byTeam:[0,0],byCategory:{}};for(let r=0;r<2;r++)if(t.teams[r].pointsWon){let n=t.teams[r].pointsWon.length;e.byTeam[r]=n,e.totalPoints+=n}let i=new Set;for(let r=0;r<2;r++)Object.keys(t.teams[r]).forEach(n=>i.add(n));return i.forEach(r=>{e.byCategory[r]=0;for(let n=0;n<2;n++)t.teams[n][r]&&(e.byCategory[r]+=t.teams[n][r].length)}),e}function iVe(t){if(!t?.teams)return[];let e=[];return Object.values({Aces:{category:"Aces",numerators:["aces"],calc:"number"},"Double Faults":{category:"Double Faults",numerators:["doubleFaults"],calc:"number"},Winners:{category:"Winners",numerators:["winners"],calc:"number"},"Unforced Errors":{category:"Unforced Errors",numerators:["unforcedErrors"],calc:"number"},"Forced Errors":{category:"Forced Errors",numerators:["forcedErrors"],calc:"number"},"Total Points Won":{category:"Total Points Won",numerators:["pointsWon"],calc:"number"},"Max Pts/Row":{category:"Max Pts/Row",numerators:["pointsWon"],calc:"maxConsecutive",attribute:"index"},"Max Games/Row":{category:"Max Games/Row",numerators:["gamesWon"],calc:"maxConsecutive",attribute:"game"},"First Serve %":{category:"First Serve %",numerators:["serves1stIn"],denominators:["pointsServed"],calc:"percentage"},"Points Won 1st":{category:"Points Won 1st",numerators:["serves1stWon"],denominators:["serves1stIn"],calc:"percentage"},"Points Won 2nd":{category:"Points Won 2nd",numerators:["serves2ndWon"],denominators:["serves2ndIn"],calc:"percentage"},"Points Won Receiving":{category:"Points Won Receiving",numerators:["received1stWon","received2ndWon"],denominators:["-pointsServed"],calc:"percentage"},"Breakpoints Saved":{category:"Breakpoints Saved",numerators:["breakpointsSaved"],denominators:["breakpointsFaced"],calc:"percentage"},"Breakpoints Converted":{category:"Breakpoints Converted",numerators:["-breakpointsSaved"],denominators:["-breakpointsFaced"],calc:"difference"},"Games Won":{category:"Games Won",numerators:["gamesWon"],calc:"number"},"Service Points Won":{category:"Service Points Won",numerators:["servesWon"],denominators:["pointsServed"],calc:"percentage"},"Aggressive Margin":{category:"Aggressive Margin",numerators:["*doubleFaults","*unforcedErrors"],denominators:["*aces","*winners","-*forcedErrors"],calc:"aggressiveMargin"}}).forEach(i=>{let r=[bq(i,t.teams,0),bq(i,t.teams,1)];(r[0].value!==0||r[1].value!==0)&&e.push({category:i.category,teams:r})}),e}function bq(t,e,i){switch(t.calc){case"number":return rVe(t,e,i);case"percentage":return nVe(t,e,i);case"maxConsecutive":return aVe(t,e,i);case"difference":return sVe(t,e,i);case"aggressiveMargin":return oVe(t,e,i)}}function rVe(t,e,i){let r=Ym(t.numerators,e,i);return{value:r,display:String(r),numerators:t.numerators}}function nVe(t,e,i){let r=Ym(t.numerators,e,i),n=Ym(t.denominators||[],e,i);if(!n)return{value:0,display:"0",numerators:t.numerators};let a=Math.round(r/n*100);return{value:a,display:`${a}% (${r}/${n})`,numerators:t.numerators}}function aVe(t,e,i){let r=t.numerators[0],n=t.attribute||"index";if(!e[i][r])return{value:0,display:"0"};let a=e[i][r],s=0,o=a.length?1:0,l;return a.forEach(u=>{let c=u[n];l!==void 0&&c===l+1?o++:(o>s&&(s=o),o=1),l=c}),o>s&&(s=o),{value:s,display:String(s)}}function sVe(t,e,i){let r=Ym(t.numerators,e,i),n=Ym(t.denominators||[],e,i);if(!n)return{value:0,display:"0",numerators:t.numerators};let a=Math.abs(n-r),s=Math.round(a/n*100);return{value:s,display:`${s}% (${a}/${n})`,numerators:t.numerators}}function oVe(t,e,i){let r=Ym(t.denominators||[],e,i),n=Ym(t.numerators,e,i),a=r-n;return{value:a,display:String(a)}}function Ym(t,e,i){return t?t.reduce((r,n)=>{let a=n.startsWith("-");n.includes("*");let s=n.replace("-","").replace("*",""),o=a?1-i:i,l=e[o]?.[s];return l?r+l.length:r},0):0}function $V(t,e,i){let r=Ioe(e||[],i),n=iVe(r),a=tVe(r);return{counters:r,calculated:n,summary:a}}function voe(t){if(!t)return[];let e=[],i=0,r=0,n=0;return t.forEach((a,s)=>{let o=J2e(a,{server:i,index:s,set:r,game:n});e.push(o)}),e}function yoe(t,e){let i=Ioe(t||[],e);return{aces:[i.teams[0].aces?.length||0,i.teams[1].aces?.length||0],doubleFaults:[i.teams[0].doubleFaults?.length||0,i.teams[1].doubleFaults?.length||0],winners:[i.teams[0].winners?.length||0,i.teams[1].winners?.length||0],unforcedErrors:[i.teams[0].unforcedErrors?.length||0,i.teams[1].unforcedErrors?.length||0],totalPoints:[i.teams[0].pointsWon?.length||0,i.teams[1].pointsWon?.length||0]}}function jt(t,e,i){return t.teams[e]?.[i]?.length??0}function Ds(t,e){return!e||!t?0:Number.parseFloat((t/e*100).toFixed(2))}function RT(t,e,i){return t.find(r=>r.category===e)?.teams[i]?.value??0}function BV(t){if(!t?.counters?.teams)return[];let{counters:e,calculated:i}=t,r=[];r.push({name:"Aces",numerator:[jt(e,0,"aces"),jt(e,1,"aces")],default:"numerator"},{name:"Double Faults",numerator:[jt(e,0,"doubleFaults"),jt(e,1,"doubleFaults")],default:"numerator"});let n=[jt(e,0,"serves1stWon"),jt(e,1,"serves1stWon")],a=[jt(e,0,"servesWon"),jt(e,1,"servesWon")];if(n[0]+n[1]>0&&(a[0]!==n[0]||a[1]!==n[1])){let y=[jt(e,0,"pointsServed"),jt(e,1,"pointsServed")],b=[jt(e,0,"serves1stIn"),jt(e,1,"serves1stIn")],S=[jt(e,0,"serves2ndWon"),jt(e,1,"serves2ndWon")],U=[jt(e,0,"serves2ndIn"),jt(e,1,"serves2ndIn")];r.push({name:"1st Serve In",numerator:b,denominator:y,pct:[Ds(b[0],y[0]),Ds(b[1],y[1])]},{name:"1st Serve Points Won",numerator:n,denominator:b,pct:[Ds(n[0],b[0]),Ds(n[1],b[1])]},{name:"2nd Serve Points Won",numerator:S,denominator:U,pct:[Ds(S[0],U[0]),Ds(S[1],U[1])]})}r.push({name:"Total Points Won",numerator:[jt(e,0,"pointsWon"),jt(e,1,"pointsWon")],default:"numerator"});let s=jt(e,0,"received1stWon")+jt(e,0,"received2ndWon"),o=jt(e,1,"received1stWon")+jt(e,1,"received2ndWon"),l=jt(e,1,"pointsServed"),u=jt(e,0,"pointsServed");r.push({name:"Receiving Points Won",numerator:[s,o],denominator:[l,u],pct:[Ds(s,l),Ds(o,u)]});let c=jt(e,1,"breakpointsFaced")-jt(e,1,"breakpointsSaved"),d=jt(e,0,"breakpointsFaced")-jt(e,0,"breakpointsSaved"),p=jt(e,1,"breakpointsFaced"),f=jt(e,0,"breakpointsFaced");r.push({name:"Break Points Won",numerator:[c,d],denominator:[p,f],pct:[Ds(c,p),Ds(d,f)]});let m=jt(e,0,"breakpointsSaved"),h=jt(e,1,"breakpointsSaved"),g=jt(e,0,"breakpointsFaced"),I=jt(e,1,"breakpointsFaced");r.push({name:"Break Points Saved",numerator:[m,h],denominator:[g,I],pct:[Ds(m,g),Ds(h,I)]},{name:"Winners",numerator:[jt(e,0,"winners"),jt(e,1,"winners")],default:"numerator"},{name:"Unforced Errors",numerator:[jt(e,0,"unforcedErrors"),jt(e,1,"unforcedErrors")],default:"numerator"},{name:"Forced Errors",numerator:[jt(e,0,"forcedErrors"),jt(e,1,"forcedErrors")],default:"numerator"});let v=a,w=[jt(e,0,"pointsServed"),jt(e,1,"pointsServed")];return r.push({name:"Service Points Won",numerator:v,denominator:w,pct:[Ds(v[0],w[0]),Ds(v[1],w[1])]},{name:"Games Won",numerator:[jt(e,0,"gamesWon"),jt(e,1,"gamesWon")]},{name:"Most Consecutive Points Won",numerator:[RT(i,"Max Pts/Row",0),RT(i,"Max Pts/Row",1)]},{name:"Most Consecutive Games Won",numerator:[RT(i,"Max Games/Row",0),RT(i,"Max Games/Row",1)]}),r}var boe=class{constructor(t={}){this.redoStack=[],this.pointMultipliers=[],t.competitionFormat?(this.competitionFormat=t.competitionFormat,this.matchUpFormat=t.matchUpFormat||t.competitionFormat.matchUpFormat||"SET3-S:6/TB7",this.pointMultipliers=t.pointMultipliers||t.competitionFormat.pointMultipliers||[]):(this.matchUpFormat=t.matchUpFormat||"SET3-S:6/TB7",this.pointMultipliers=t.pointMultipliers||[]),this.matchUpId=t.matchUpId,this.isDoubles=t.isDoubles||!1,this.eventHandlers=t.eventHandlers,this.state=nd({matchUpFormat:this.matchUpFormat,matchUpId:this.matchUpId,isDoubles:this.isDoubles}),this.cacheFormatStructure()}setState(t){this.state=t,this.matchUpFormat=t.matchUpFormat,this.matchUpId=t.matchUpId,this.isDoubles=t.matchUpType==="DOUBLES",this.redoStack=[],this.initialScore=void 0,this.cacheFormatStructure()}getState(){return this.state}addPoint(t){let e=this.state.history?.points.length||0,i=this.state.score.sets.reduce((s,o)=>s+(o.side1Score||0)+(o.side2Score||0),0),r=this.state.score.sets.filter(s=>s.winningSide!==void 0).length,n=this.state.matchUpStatus==="COMPLETED",a=this.hasLineUp()?this.getActivePlayers():void 0;if(this.state=bp(this.state,t,{pointMultipliers:this.pointMultipliers}),a){let s=this.state.history.points[this.state.history.points.length-1];this.isDoubles?s.activePlayers=[a.side1,a.side2]:s.activePlayers=[a.side1[0]||"",a.side2[0]||""]}if(t.penaltyType){let s=this.state.history.points[this.state.history.points.length-1];s.penaltyType=t.penaltyType}if(this.ensureHistory(),this.state.history.entries.push({type:"point",data:{winner:t.winner,server:t.server,timestamp:t.timestamp,rallyLength:t.rallyLength,result:t.result,penaltyType:t.penaltyType},timestamp:t.timestamp||new Date().toISOString(),pointIndex:e}),this.redoStack=[],this.eventHandlers){let s=this.buildEventContext();if(this.eventHandlers.onPoint?.(s),this.state.score.sets.reduce((o,l)=>o+(l.side1Score||0)+(l.side2Score||0),0)>i&&this.eventHandlers.onGameComplete?.({...s,gameWinner:t.winner}),this.state.score.sets.filter(o=>o.winningSide!==void 0).length>r){let o=this.state.score.sets.findLast(l=>l.winningSide!==void 0)?.winningSide===1?0:1;this.eventHandlers.onSetComplete?.({...s,setWinner:o})}if(!n&&this.state.matchUpStatus==="COMPLETED"){let o=this.state.winningSide===1?0:1;this.eventHandlers.onMatchComplete?.({...s,matchWinner:o})}}}addSet(t){this.applyAddSet(t),this.ensureHistory();let e=this.state.score.sets.at(-1)?.winningSide;this.state.history.entries.push({type:"set",data:{...t,winningSide:e},timestamp:t.timestamp||new Date().toISOString()}),this.redoStack=[]}addGame(t){this.applyAddGame(t),this.ensureHistory(),this.state.history.entries.push({type:"game",data:t,timestamp:t.timestamp||new Date().toISOString()}),this.redoStack=[]}endSegment(t){this.applyEndSegment(t),this.ensureHistory();let e=(t?.setNumber??this.state.score.sets.length)-1;this.state.history.entries.push({type:"endSegment",data:{setNumber:e+1,...t},timestamp:t?.timestamp||new Date().toISOString()})}setInitialScore(t){this.initialScore=t,this.redoStack=[],this.applyInitialScore(this.state,t),this.ensureHistory(),this.state.history.entries.push({type:"setInitialScore",data:t,timestamp:new Date().toISOString()}),this.state.matchUpStatus==="TO_BE_PLAYED"&&(this.state.matchUpStatus="IN_PROGRESS")}undo(t=1){let e=this.state.history?.entries;if(e&&e.length>0){let n=Math.min(t,e.length);for(let a=0;a<n;a++){let s=e.pop();this.redoStack.push(s),s.type==="point"&&this.state.history.points.pop()}return this.rebuildFromEntries(),this.eventHandlers?.onUndo?.(this.buildEventContext()),!0}let i=this.state.history?.points||[];if(i.length===0)return!1;let r=Math.min(t,i.length);for(let n=0;n<r;n++){let a=i.pop();this.redoStack.push({type:"point",data:{winner:a.winner,server:a.server,timestamp:a.timestamp,rallyLength:a.rallyLength},timestamp:a.timestamp||""})}return this.rebuildState(),this.eventHandlers?.onUndo?.(this.buildEventContext()),!0}redo(t=1){if(this.redoStack.length===0)return!1;let e=Math.min(t,this.redoStack.length);for(let i=0;i<e;i++){let r=this.redoStack.pop();this.ensureHistory(),this.state.history.entries.push(r),r.type}return this.rebuildFromEntries(),this.eventHandlers?.onRedo?.(this.buildEventContext()),!0}canUndo(){let t=this.state.history?.entries;return t&&t.length>0?!0:(this.state.history?.points.length||0)>0}canRedo(){return this.redoStack.length>0}getUndoDepth(){let t=this.state.history?.entries;return t&&t.length>0?t.length:this.state.history?.points.length||0}getRedoDepth(){return this.redoStack.length}getScore(){return Cd(this.state)}getScoreboard(t){return xV(this.state,t)}getWinner(){return FV(this.state)}isComplete(){return LV(this.state)}getPointCount(){return this.state.history?.points.length||0}getFormat(){return this.state.matchUpFormat}getStatistics(t){let e=this.state.history?.points||[];return $V(this.state,e,t)}getStatObjects(t){return BV(this.getStatistics(t))}getNextServer(){if(this.competitionFormat?.serverRule==="WINNER_SERVES"){let i=this.state.history?.points.at(-1);return i?i.winner:0}if(!this.cachedFormatStructure)return 0;let t=[0,0];this.state.score.sets.forEach(i=>{i.winningSide===1&&t[0]++,i.winningSide===2&&t[1]++});let e=IN(this.cachedFormatStructure,t);return OV(this.state,this.cachedFormatStructure,e)}getEpisodes(){return _V(this.state)}isNoAd(){return!!(this.cachedFormatStructure?.setFormat?.NoAD||this.cachedFormatStructure?.setFormat?.gameFormat?.NoAD)}getSetsToWin(){if(!this.cachedFormatStructure)return 2;let t=this.cachedFormatStructure.exactly||this.cachedFormatStructure.bestOf||3;return Math.ceil(t/2)}getTiebreakAt(){let t=this.cachedFormatStructure?.setFormat;if(!t||t.tiebreakSet||t.timed||t.noTiebreak)return null;let e=t.setTo||6;return(typeof t.tiebreakAt=="number"?t.tiebreakAt:void 0)??e}hasFinalSetTiebreak(){let t=this.cachedFormatStructure?.finalSetFormat;return t?t.tiebreakSet?!0:t.noTiebreak?!1:!!(t.tiebreakFormat||t.tiebreakAt!==void 0):this.getTiebreakAt()!==null}getFormatStructure(){return this.cachedFormatStructure}getInputMode(){let t=this.state.history?.entries||[];if(t.length===0)return(this.state.history?.points.length||0)>0?"points":"none";let e=new Set(t.filter(i=>i.type!=="setInitialScore"&&i.type!=="endSegment").map(i=>i.type));if(e.size===0)return"none";if(e.size===1){let i=e.values().next().value;if(i==="point")return"points";if(i==="game")return"games";if(i==="set")return"sets"}return"mixed"}setLineUp(t,e){let i=this.state.sides.find(r=>r.sideNumber===t);i&&(i.lineUp=e),this.initialLineUps??={},this.initialLineUps[t]=e.map(r=>({...r}))}substitute(t){let e=this.state.sides.find(n=>n.sideNumber===t.sideNumber);if(!e?.lineUp)return;let i=e.lineUp.findIndex(n=>n.participantId===t.outParticipantId);if(i===-1)return;this.ensureHistory(),this.state.history.substitutions??=[];let r={sideNumber:t.sideNumber,outParticipantId:t.outParticipantId,inParticipantId:t.inParticipantId,beforePointIndex:this.state.history.points.length,timestamp:t.timestamp};this.state.history.substitutions.push(r),e.lineUp[i]={...e.lineUp[i],participantId:t.inParticipantId},this.state.history.entries.push({type:"substitution",data:r,timestamp:t.timestamp||new Date().toISOString()}),this.redoStack=[]}getActivePlayers(){let t=this.state.sides.find(i=>i.sideNumber===1),e=this.state.sides.find(i=>i.sideNumber===2);return{side1:t?.lineUp?.map(i=>i.participantId)||[],side2:e?.lineUp?.map(i=>i.participantId)||[]}}hasLineUp(){return this.state.sides.some(t=>t.lineUp&&t.lineUp.length>0)}setPointMultipliers(t){this.pointMultipliers=t}getPointMultipliers(){return this.pointMultipliers}getSupplementaryState(){return{redoStack:[...this.redoStack],initialLineUps:this.initialLineUps?Object.fromEntries(Object.entries(this.initialLineUps).map(([t,e])=>[t,e.map(i=>({...i}))])):void 0}}loadSupplementaryState(t){t.redoStack&&(this.redoStack=[...t.redoStack]),t.initialLineUps&&(this.initialLineUps=Object.fromEntries(Object.entries(t.initialLineUps).map(([e,i])=>[e,i.map(r=>({...r}))])))}getPenaltyProfile(){return this.competitionFormat?.penaltyProfile}getPointProfile(){return this.competitionFormat?.pointProfile}getTimerProfile(){return this.competitionFormat?.timerProfile}getTimeoutRules(){return this.competitionFormat?.timeoutRules}getSubstitutionRules(){return this.competitionFormat?.substitutionRules}getPlayerRules(){return this.competitionFormat?.playerRules}setEventHandlers(t){this.eventHandlers=t}getEventHandlers(){return this.eventHandlers}decoratePoint(t,e){let i=this.state.history?.points[t];i&&Object.assign(i,e)}markHardBoundary(t){let e=this.state.score.sets[t.setIndex];e&&(e.hardBoundaries??=[],e.hardBoundaries.includes(t.gameIndex)||(e.hardBoundaries.push(t.gameIndex),e.hardBoundaries.sort((i,r)=>i-r)))}editPoint(t,e,i){let r=this.state.history?.points;if(!r||t<0||t>=r.length)return;let n=i?.recalculate!==!1,a=r[t];if(e.winner!==void 0&&(a.winner=e.winner),e.server!==void 0&&(a.server=e.server),e.timestamp!==void 0&&(a.timestamp=e.timestamp),e.rallyLength!==void 0&&(a.rallyLength=e.rallyLength),e.wrongSide!==void 0&&(a.wrongSide=e.wrongSide),e.wrongServer!==void 0&&(a.wrongServer=e.wrongServer),e.penaltyPoint!==void 0&&(a.penaltyPoint=e.penaltyPoint),!n)return;let s=this.state.history?.entries;if(s){let o=s.find(l=>l.type==="point"&&l.pointIndex===t);o&&(e.winner!==void 0&&(o.data.winner=e.winner),e.server!==void 0&&(o.data.server=e.server))}s&&s.length>0?this.rebuildFromEntries():this.rebuildState(),this.redoStack=[]}reset(){this.state=nd({matchUpFormat:this.matchUpFormat,matchUpId:this.matchUpId,isDoubles:this.isDoubles}),this.redoStack=[],this.initialScore=void 0,this.initialLineUps=void 0,this.eventHandlers?.onReset?.(this.buildEventContext())}ensureHistory(){this.state.history??={points:[]},this.state.history.entries??=[]}buildEventContext(){return{state:this.state,score:Cd(this.state)}}cacheFormatStructure(){this.cachedFormatStructure=qi(this.matchUpFormat)}getInitialLineUps(){return this.initialLineUps}applyAddSet(t){let{side1Score:e,side2Score:i,side1TiebreakScore:r,side2TiebreakScore:n}=t,a=t.winningSide;a===void 0&&(e>i?a=1:i>e&&(a=2));let s={setNumber:this.state.score.sets.length+1,side1Score:e,side2Score:i,winningSide:a};r!==void 0&&(s.side1TiebreakScore=r),n!==void 0&&(s.side2TiebreakScore=n),this.state.score.sets.push(s),this.state.matchUpStatus==="TO_BE_PLAYED"&&(this.state.matchUpStatus="IN_PROGRESS"),a!==void 0&&this.checkMatchCompletion()}applyAddGame(t){let{winner:e,tiebreakScore:i}=t,r=this.state.score.sets.length>0?this.state.score.sets.at(-1):void 0;(!r||r.winningSide!==void 0)&&(r={setNumber:this.state.score.sets.length+1,side1Score:0,side2Score:0},this.state.score.sets.push(r)),e===0?r.side1Score=(r.side1Score||0)+1:r.side2Score=(r.side2Score||0)+1,i&&(r.side1TiebreakScore=i[0],r.side2TiebreakScore=i[1]),this.state.matchUpStatus==="TO_BE_PLAYED"&&(this.state.matchUpStatus="IN_PROGRESS"),this.checkSetCompletion(r),r.winningSide!==void 0&&this.checkMatchCompletion()}applySubstitution(t){let e=this.state.sides.find(r=>r.sideNumber===t.sideNumber);if(!e?.lineUp)return;let i=e.lineUp.findIndex(r=>r.participantId===t.outParticipantId);i!==-1&&(e.lineUp[i]={...e.lineUp[i],participantId:t.inParticipantId},this.state.history??={points:[]},this.state.history.substitutions??=[],this.state.history.substitutions.push(t))}applyEndSegment(t){let e=(t?.setNumber??this.state.score.sets.length)-1,i=this.state.score.sets[e];if(!i||i.winningSide!==void 0)return;let r=i.side1Score||0,n=i.side2Score||0;r>n?i.winningSide=1:n>r&&(i.winningSide=2),this.checkMatchCompletion()}checkSetCompletion(t){let e=qi(this.state.matchUpFormat);if(!e)return;let i=e.exactly||e.bestOf||3,r=Math.ceil(i/2),n=[0,0];this.state.score.sets.forEach(l=>{l.winningSide===1&&n[0]++,l.winningSide===2&&n[1]++});let a=n[0]===r-1&&n[1]===r-1&&e.finalSetFormat?e.finalSetFormat:e.setFormat;if(!a)return;let s=t.side1Score||0,o=t.side2Score||0;if(a.tiebreakSet){let l=a.tiebreakSet.tiebreakTo||11,u=a.tiebreakSet.NoAD?1:2;(s>=l||o>=l)&&Math.abs(s-o)>=u&&(t.winningSide=s>o?1:2)}else if(!a.timed){let l=a.setTo||6,u=(typeof a.tiebreakAt=="number"?a.tiebreakAt:void 0)??l,c=a.noTiebreak||!1,d=a.winBy||2;(!c&&t.side1TiebreakScore!==void 0&&(s===u+1||o===u+1)||(s>=l||o>=l)&&Math.abs(s-o)>=d)&&(t.winningSide=s>o?1:2)}}checkMatchCompletion(){let t=qi(this.state.matchUpFormat);if(!t)return;let e=t.exactly||t.bestOf||3,i=Math.ceil(e/2),r=CV(t),n=t.exactly;if(r){let a=n||e;if(this.state.score.sets.filter(s=>s.winningSide!==void 0).length>=a){let s=this.state.score.sets.reduce((o,l)=>(l.side1TiebreakScore===void 0?(o[0]+=l.side1Score??0,o[1]+=l.side2Score??0):(o[0]+=l.side1TiebreakScore,o[1]+=l.side2TiebreakScore??0),o),[0,0]);s[0]!==s[1]&&(this.state.matchUpStatus="COMPLETED",this.state.winningSide=s[0]>s[1]?1:2,this.state.endTime=new Date().toISOString())}}else{let a=[0,0];if(this.state.score.sets.forEach(s=>{s.winningSide===1&&a[0]++,s.winningSide===2&&a[1]++}),(a[0]>=i||a[1]>=i)&&(!n||this.state.score.sets.filter(s=>s.winningSide!==void 0).length>=n)){let s=a[0]>=i?0:1;this.state.matchUpStatus="COMPLETED",this.state.winningSide=s+1,this.state.endTime=new Date().toISOString()}}}rebuildFromEntries(){let t=this.state.history?.entries||[],e=this.getInitialLineUps(),i=nd({matchUpFormat:this.matchUpFormat,matchUpId:this.matchUpId,isDoubles:this.isDoubles});if(e)for(let r of i.sides)e[r.sideNumber]&&(r.lineUp=e[r.sideNumber].map(n=>({...n})));this.initialScore&&(this.applyInitialScore(i,this.initialScore),i.matchUpStatus==="TO_BE_PLAYED"&&(i.matchUpStatus="IN_PROGRESS")),i.history={points:[],entries:[...t]},this.state=i;for(let r of t)switch(r.type){case"point":this.state=bp(this.state,r.data,{pointMultipliers:this.pointMultipliers}),this.state.history.entries=i.history.entries;break;case"set":this.applyAddSet(r.data);break;case"game":this.applyAddGame(r.data);break;case"endSegment":this.applyEndSegment(r.data);break;case"substitution":this.applySubstitution(r.data);break}}rebuildState(){let t=this.state.history?.points||[],e=nd({matchUpFormat:this.matchUpFormat,matchUpId:this.matchUpId,isDoubles:this.isDoubles});this.initialScore&&(this.applyInitialScore(e,this.initialScore),e.matchUpStatus==="TO_BE_PLAYED"&&(e.matchUpStatus="IN_PROGRESS"));for(let i of t)e=bp(e,{winner:i.winner,server:i.server,timestamp:i.timestamp,rallyLength:i.rallyLength,result:i.result},{pointMultipliers:this.pointMultipliers});this.state=e}applyInitialScore(t,e){t.score.sets=[];for(let i=0;i<e.sets.length;i++){let r=e.sets[i],n={setNumber:i+1,side1Score:r.side1Score,side2Score:r.side2Score};r.side1TiebreakScore!==void 0&&(n.side1TiebreakScore=r.side1TiebreakScore),r.side2TiebreakScore!==void 0&&(n.side2TiebreakScore=r.side2TiebreakScore),r.winningSide!==void 0?n.winningSide=r.winningSide:r.side1Score>r.side2Score?n.winningSide=1:r.side2Score>r.side1Score&&(n.winningSide=2),t.score.sets.push(n)}if(e.currentSetScore){let i={setNumber:t.score.sets.length+1,side1Score:e.currentSetScore.side1Score,side2Score:e.currentSetScore.side2Score,side1GameScores:[],side2GameScores:[]};e.currentGameScore?(i.side1GameScores=[e.currentGameScore.side1Points],i.side2GameScores=[e.currentGameScore.side2Points]):(i.side1GameScores=[0],i.side2GameScores=[0]),t.score.sets.push(i)}}},woe={};dt(woe,{addPoint:()=>bp,calculatePointsTo:()=>vN,createMatchUp:()=>nd,inferServeSide:()=>MV,resolvePointValue:()=>NV});var Soe={};dt(Soe,{keyValueScore:()=>Goe,parseMatchUpFormat:()=>qi,stringifyMatchUpFormat:()=>wM,tidyScore:()=>qoe});var lVe="COMPLETED",uVe="WO/WO",Uoe=["RET","DEF","WO",uVe,"ABN","SUS","INT"],$x="DEFAULTED",Toe="WALKOVER",Doe="ABANDONED",Poe="SUSPENDED",Eoe="RETIRED",Roe="INTERRUPTED",cVe=[Eoe,$x,Toe],dVe="Enter Score",Km="()",Kp="[]",VV=["up","left","shift+tab"],jV=["enter","down","tab","right"],QP="backspace",Coe="r",Moe="s",Noe="a",Aoe="d",koe="w",Ooe="i",bN=[Coe,Aoe,koe,Noe,Moe,Ooe],wN="space",uk=["[","("],ZP=[...VV,...jV,wN,"]"],xoe="-",pVe="/",vm=xoe,Ql=xoe,Foe=[pVe],fVe=0,mVe=["=","+","num_1","num_2","shift+=","shift+-"],GV=["0","1","2","3","4","5","6","7","8","9"].concat(bN),Loe=GV.map(t=>`shift+${t}`),_oe=[vm,QP].concat(ZP,Foe),$oe=[GV,Loe,_oe].join(","),hVe=[$oe,VV,jV,mVe].join(","),gVe={OUTCOMEKEYS:bN,SIDE1KEYS:GV,SIDE2KEYS:Loe,MODIFIERS:_oe,PROMPT:dVe,MOVEUP:VV,MOVEDOWN:jV,HOTKEYS:hVe};function cg({scoreString:t,lowSide:e,outcome:i}){if({scoreString:t}=Boe({scoreString:t}),e===2){let r=(t&&t[t.length-1])!==" "?" ":"";return t+r+i}else return i+" "+t}function Boe({scoreString:t}){if(!t)return{scoreString:""};let e=!1;for(let i of Uoe){let r=t?.indexOf(i);r===0?t=t.slice(i.length+1).trim()+" ":r>0&&(t=t.slice(0,r)),r>=0&&(e=!0)}return t?.trim()||(t=""),{scoreString:t,removed:e}}function Bx({analysis:t,scoreString:e,sets:i,lowSide:r}){let n,a;if(!e)return{scoreString:e,sets:i};let{scoreString:s,removed:o}=Boe({scoreString:e});if(e=s,o)return{scoreString:e,sets:i,outcomeRemoved:!0};let l=i[i.length-1]||{},u=Object.values(l).filter(h=>h!==void 0).length;l.setNumber&&u===1&&(i=i.slice(0,i.length-1),l=i[i.length-1]||{});let{tiebreakSet:c}=t.setFormat,{tiebreakTo:d,NoAD:p}=c||{},{isTiebreakEntry:f}=jg({brackets:Kp,scoreString:e}),m=vVe(e);if(m>=0){n=e.slice(0,m);let{isTiebreakEntry:h}=jg({brackets:Km,scoreString:n}),{lastOpenBracketIndex:g,isTiebreakEntry:I}=jg({brackets:Kp,scoreString:n}),v=n&&n[n.length-1].trim(),w=n&&!isNaN(v),y=t.isIncompleteSetScore;if(f&&I){let b=n.slice(g+1).split(Ql),S=b?.length>0&&b[0]!==void 0&&!isNaN(parseInt(b[0]))&&parseInt(b[0])||void 0,U=b?.length>1&&b[1]!==void 0&&parseInt(b[1])||void 0,T=[S,U];if(U){let P=r===1?1:0;T[P]=(T?.[1-P]||0)+(p?1:2),(T[P]||0)<d&&(T[P]=d),n=e.slice(0,g+1),n+=T.join(Ql)}else S!==void 0?(n=e.slice(0,g+1),n+=S):(n=e.slice(0,g),y=!0);l.side1TiebreakScore=T[0]||0,l.side2TiebreakScore=T[1]||0}if(n.length||(n=void 0),y){let b=l.side1Score?.toString();if(b){let S=b?.slice(0,b.length-1);l.side1Score=!isNaN(S)&&parseInt(S)||void 0,l.side1Score===void 0&&(l.side2Score=void 0)}t.isTimedSet?(a=l.side1Score?i:i?.slice(0,i.length-1)||[],a[i.length-1]=l):a=i?.slice(0,i.length-1)||[]}else if(w){let b=l.side2Score?.toString(),S=l.side1Score?.toString();if(!t.isTiebreakEntry&&!t.isMatchTiebreak)if(l.side2Score){let U=b?.slice(0,b.length-1);l.side2Score=!isNaN(U)&&parseInt(U)||void 0}else{let U=S?.slice(0,S.length-1);l.side1Score=!isNaN(U)&&parseInt(U)||void 0}t.isTimedSet?l.side1Score?(a=i||[],a[i.length-1]=l):a=i?.slice(0,i.length-1)||[]:(a=i||[],a[i.length-1]=l),a[a.length-1]&&Object.assign(a[a.length-1],{winningSide:void 0})}else h?(a=i||[],Object.assign(a[a.length-1]||{},{winningSide:void 0,side1TiebreakScore:void 0,side2TiebreakScore:void 0})):(f&&!I?a=i?.slice(0,i.length-1)||[]:(a=i,a[i.length-1]=l),f||(a[a.length-1].side2Score=0,a[a.length-1].winningSide=void 0));return{scoreString:n,sets:a}}return{scoreString:e,sets:i}}function jg({brackets:t=Km,scoreString:e}){if(!e)return{};let[i,r]=t.split(""),n=e.split(""),a=Math.max(...Xo(i,n)),s=Math.max(...Xo(r,n));return{isTiebreakEntry:a>s,lastOpenBracketIndex:a}}function IVe({scoreString:t}){if(!t)return!1;let e=t&&t[t.length-1].trim(),i=t&&!isNaN(e),[r,n]=Kp.split(""),a=t.split(""),s=Math.max(...Xo(r,a)),o=Math.max(...Xo(n,a)),l=Math.max(...Xo(Ql,a));return i&&s>o&&l>s}function vVe(t){return t.split("").reduce((e,i,r)=>(i.match(/\d+/g)&&e.push(r),e),[]).pop()}function Voe(t){let{lowValue:e=0,NoAD:i=!1,tiebreakTo:r}=t||{},n=i?1:2;return e+1>=r?e+n:parseInt(r)}function wq({matchUpFormat:t,matchUpStatus:e,winningSide:i,sets:r}){let n=qi(t),{bestOf:a}=n,s=Math.ceil(a/2),o=r?.reduce((l,u)=>{let{winningSide:c}=u;return c&&l[c-1]++,l},[0,0])?.indexOf(s)+1||void 0;return cVe.includes(e)&&i&&(o=i),{matchUpWinningSide:o}}function SN({ignoreTiebreak:t=!1,matchUpScoringFormat:e,matchUpFormat:i,isTiebreakSet:r,isDecidingSet:n,isTimedSet:a,set:s}){if(!s)return{error:Je,info:"missing set"};e=e||i&&qi(i);let o=n&&e.finalSetFormat||e?.setFormat||{},{side1Score:l,side2Score:u}=s,{setTo:c,tiebreakAt:d}=o,p=l||u,f=UN({set:s}),m=Math.abs(l-u),h=l>=c||u>=c,g=r||l>=c&&u>=c||d&&d<c&&(l===d||u===d),I=t||g&&(f===1&&s.side1TiebreakScore>s.side2TiebreakScore||f===2&&s.side2TiebreakScore>s.side1TiebreakScore),v=!g&&o.NoAD||g||r&&o.tiebreakFormat?.NoAD?1:2,w=m>=v;return!!((a&&p||h&&(w||g)||r)&&(!g||I))}function UN({set:t}){if(t.side1Score||t.side2Score){if(t.side1Score>t.side2Score)return 1;if(t.side2Score>t.side1Score)return 2}else if(t.side1TiebreakScore||t.side2TiebreakScore){if(t.side1TiebreakScore>t.side2TiebreakScore)return 1;if(t.side2TiebreakScore>t.side1TiebreakScore)return 2}}function HV({analysis:t,set:e}){let i=UN({set:e}),{isDecidingSet:r,isTiebreakSet:n,matchUpScoringFormat:a}=t;return SN({matchUpScoringFormat:a,isDecidingSet:r,isTiebreakSet:n,set:e})&&i}function yVe({analysis:t,scoreString:e,sets:i,value:r}){let n;if(!i?.length)return{sets:[]};let a=i[i.length-1];r=Ke(r);let{validSide2Score:s,requiresTiebreak:o}=bVe({analysis:t,set:a,value:r});if(s){n=!0,e=(e||"")+r,a.side2Score=r;let l=HV({analysis:t,set:i[i.length-1]});if(a.winningSide=l||void 0,o){let u=Km.split("")[0];e+=u}else t.isDecidingSet||(e+=" ")}return{sets:i,scoreString:e,updated:n}}function bVe({analysis:t,set:e={},value:i}){let r=t.isDecidingSet&&t.matchUpScoringFormat.finalSetFormat||t.matchUpScoringFormat.setFormat,{tiebreakAt:n,setTo:a,NoAD:s}=r,{side1Score:o}=e,l,u;return n&&n<a?o===n?l=i<=a:l=i<=n:o===a?s?l=i<a:l=i<=a+1:o===a-1?s?l=i<=a:l=i<=a+1:o===a+1?l=i===a||i===a-1:l=i<=a,l&&(n&&n<a?u=o===a&&i===n||o===n&&i===a:u=o>=a&&i>=a&&o!==i),{validSide2Score:l,requiresTiebreak:u}}function joe({lowSide:t,value:e,sets:i,scoreString:r,winningSide:n,matchUpStatus:a}){let s;return e===Coe?r?(s=!0,r=cg({scoreString:r,lowSide:t,outcome:"RET"}),n=t===2?1:2,a=Eoe):(s=!0,r=cg({scoreString:r,lowSide:t,outcome:"DEF"}),n=t===2?1:2,a=$x):e===Aoe?(s=!0,r=cg({scoreString:r,lowSide:t,outcome:"DEF"}),n=t===2?1:2,a=$x):e===koe?(s=!0,i=[],r="WO",n=t===2?1:2,a=Toe):e===Moe&&r?(s=!0,r=cg({scoreString:r,lowSide:t,outcome:"SUS"}),a=Poe,n=void 0):e===Noe?(s=!0,r=cg({scoreString:r,lowSide:t,outcome:"ABN"}),a=Doe,n=void 0):e===Ooe&&r&&(s=!0,r=cg({scoreString:r,lowSide:t,outcome:"INT"}),a=Roe,n=void 0),{updated:s,sets:i,scoreString:r,matchUpStatus:a,winningSide:n}}function wVe(t){let{sets:e,info:i,scoreString:r,winningSide:n,matchUpStatus:a}=t,{analysis:s,lowSide:o,value:l}=t,u,c;!e?.length&&l!==QP&&(e=[{setNumber:1}]);let d=e.length-1;if(bN.includes(l)){let p=e[e.length-1]||{},{side1Score:f,side2Score:m}=p;f&&!m?i="missing side2Score":s.finalSetIsComplete||n?i="final set is already complete":s.isIncompleteSetScore?i="incomplete set scoreString":s.isIncompleteSetScore||({sets:e,scoreString:r,winningSide:n,matchUpStatus:a,updated:u}=joe({lowSide:o,value:l,sets:e,scoreString:r,matchUpStatus:a,winningSide:n}))}else if(l===QP){if({scoreString:r,sets:e,outcomeRemoved:c}=Bx({analysis:s,scoreString:r,sets:e}),r?.trim()===""&&(r=r.trim()),r||(e=[]),c){let p=e[e.length-1]||{},{side1Score:f,side2Score:m}=p;if(f&&m){let h=f>m&&1||m>f&&2||void 0;h&&(p.winningSide=h,e.push({setNumber:e.length+1}))}}a=void 0,n=void 0,u=!0}else if(s.hasOutcome)i="has outcome";else{if(n)return{sets:e,scoreString:r,winningSide:n,matchUpStatus:a,updated:!1,info:"matchUp is complete"};if(l===wN){let p=e[e.length-1]||{},{side1Score:f,side2Score:m}=p,h=f>m&&1||m>f&&2||void 0;h&&!n&&!s.isIncompleteSetScore&&(e[e.length-1].winningSide=h,e.push({setNumber:e.length+1}),r+=" ",u=!0)}else if(l===vm&&e[d].side1Score!==void 0&&e[d].side2Score===void 0&&r&&s.isNumericEnding)r+="-",e[d].side2Score=0,a=void 0,n=void 0,u=!0;else if(!isNaN(l)){let p;if(e[d].side2Score===void 0){let f=Ke((e[d].side1Score||0).toString()+l).toString().slice(0,2);e[d].side1Score=Ke(f),p=e[d].side1Score.toString(),u=!0}else{let f=Ke((e[d].side2Score||0).toString()+l).toString().slice(0,2);e[d].side2Score=Ke(f),p=[e[d].side1Score,e[d].side2Score].join("-"),u=!0}if(u){let f=(e.slice(0,d)||[]).filter(m=>m).map(m=>{let{side1Score:h,side2Score:g}=m;return[h,g].join("-")}).join(" ");f?r=f+" "+p:r=p}}}return{sets:e,scoreString:r,winningSide:n,matchUpStatus:a,info:i,updated:u}}function SVe({analysis:t,auto:e,lowSide:i,scoreString:r="",sets:n,value:a}){let s,o,{tiebreakSet:{tiebreakTo:l,NoAD:u}}=t.setFormat,[c]=Kp.split("");if(t.isMatchTiebreakEntry||(r+=c),n[t.setNumber-1]){let{lastOpenBracketIndex:d}=jg({brackets:Kp,scoreString:r}),p=(r.slice((d??0)+1)+(e?"":a)).split(Ql);if((p[i-1]?.length||0)>=2)o="tiebreak digit limit";else if(e){i===1&&(p[0]=(p[0]||"")+a),i===2&&(p[1]=(p[1]||"")+a);let f=[p[0]||0,p[1]||0].map(g=>Ke(g)),m=i===1?1:0;f[m]=f[1-m]+(u?1:2),f[m]<l&&(f[m]=l);let h=n[n.length-1];h.side1TiebreakScore=f[0],h.side2TiebreakScore=f[1],r=r.slice(0,(d??0)+1),r+=f.join(Ql),s=!0}else{let f=[p[0]||0,p[1]||0].map(h=>Ke(h)),m=n[n.length-1];m.side1TiebreakScore=f[0],m.side2TiebreakScore=f[1],r+=a,s=!0}}else{let d=Voe({lowValue:Ke(a||0),tiebreakTo:l,NoAD:u}),p=[Ke(a),d];i===2&&p.reverse();let f={side1TiebreakScore:p[0],side2TiebreakScore:p[1],setNumber:n?.length+1||1};n.push(f),r+=p.join(Ql),s=!0}return{info:o,scoreString:r,sets:n,updated:s}}function UVe({analysis:t,lowSide:e,scoreString:i,value:r}){let{setTo:n,tiebreakAt:a,NoAD:s}=t?.setFormat||{},o=r===parseInt(a||n);if(a&&a<n&&r>a)return{scoreString:i};if(s&&r===n||r>n)return{scoreString:i};let l=m(),u=[r,l];e===2&&u.reverse();let c=Km.split("")[0],d=u.join(vm)+(o?c:" ");i=(i||"")+d;let p={side1Score:u[0],side2Score:u[1]},f=HV({analysis:t,set:p});return p.winningSide=f||void 0,{scoreString:i,set:p};function m(){return o?r+1:r+1===n?r+(s?1:2):n}}function TVe({matchUpFormat:t,scoreString:e,winningSide:i,value:r,sets:n}){let a=(n?.filter(F=>F?.winningSide)?.length||0)+(i?0:1),s=qi(t),o=a===s?.bestOf,l=o&&s?.finalSetFormat||s?.setFormat||{},u=l?.timed,c=o&&n[s?.bestOf-1],d=c?.winningSide,{isTiebreakEntry:p}=jg({brackets:Km,scoreString:e}),{isTiebreakEntry:f}=jg({brackets:Kp,scoreString:e}),m=p||f,h=!!l.tiebreakSet,g=e?.[e.length-1]?.trim(),I=e&&!isNaN(g),v=!m&&g===vm,w=p&&uk.includes(g),y=f&&uk.includes(g),b=f&&g===Ql,S=e?.split(""),[U]=Kp.split(""),T=S&&Math.max(...Xo(U,S)),P=S&&Math.max(...Xo(Ql,S)),D=S&&P>T,E=n[n.length-1]?.winningSide,R=n?.length&&!E,C=Uoe.find(F=>e?.indexOf(F)>=0),M=!isNaN(r),N=r===wN,A=ZP.includes(r),O=e?.split("").find(F=>uk.includes(F)),k=A&&f&&!y&&(b||!IVe({scoreString:e}));return{isTiebreakSetValue:h&&M,matchUpScoringFormat:s,setNumber:a,setFormat:l,matchTiebreakHasJoiner:D,isGameScoreEntry:R,isSpace:N,isCloser:A,isTiebreakCloser:A&&O&&m&&I,isDecidingSet:o,isTiebreakSet:h,isTimedSet:u,isNumericEnding:I,isNumericValue:M,hasOpener:O,hasOutcome:C,finalSet:c,finalSetIsComplete:d,lastSetIsComplete:E,isInvalidSetTiebreakValue:N&&m&&w,isInvalidMatchTiebreakValue:k,isTiebreakEntry:m,isSetTiebreakEntry:p,isMatchTiebreakEntry:f,isIncompleteSetScore:v,isIncompleteSetTiebreak:w,isIncompleteMatchTiebreak:y,isPartialMatchTiebreakValue:b}}function Goe(t){let{lowSide:e=1,value:i}=t,{scoreString:r,sets:n,winningSide:a,matchUpStatus:s}=t,{matchUpFormat:o,shiftFirst:l,auto:u=!0}=t,c,d,p=l&&e===2||!l&&e===1;if(!$oe.includes(i))return{updated:!1,info:"invalid key"};l&&(e=3-e);let{matchUpWinningSide:f}=wq({sets:n,winningSide:a,matchUpStatus:s,matchUpFormat:o});a=f;let m=TVe({value:i,winningSide:a,scoreString:r,sets:n,matchUpFormat:o});if(Foe.includes(i)&&(i=vm),m.hasOpener&&m.isTiebreakEntry&&!m.isTiebreakSet&&p&&Ke(i)===0&&(m.isTiebreakCloser=!0),ZP.includes(i)&&m.hasOpener&&(i=""),ZP.includes(i)&&(i=wN),m.lastSetIsComplete){let h=r?.length&&r[r.length-1];r&&h!==" "&&(r+=" ")}if(m.isTimedSet)({info:d,sets:n,scoreString:r,updated:c,matchUpStatus:s,winningSide:a}=wVe({analysis:m,lowSide:e,scoreString:r,sets:n,matchUpStatus:s,winningSide:a,value:i}));else if(bN.includes(i))m.finalSetIsComplete||a?d="final set is already complete":!m.isTiebreakEntry&&!m.isIncompleteSetScore?{sets:n,scoreString:r,matchUpStatus:s,winningSide:a,updated:c}=joe({lowSide:e,sets:n,scoreString:r,matchUpStatus:s,winningSide:a,value:i}):m.isTiebreakEntry||m.isIncompleteSetScore?d="incomplete set scoreString or tiebreak entry":console.log("handle case",{value:i});else if(i===QP)c=!0,{scoreString:r,sets:n}=Bx({analysis:m,scoreString:r,sets:n,lowSide:e}),r||(n=[]),s=void 0,a=void 0;else if(m.hasOutcome)d="has outcome";else if(i===vm&&!m.isMatchTiebreakEntry)(!m.isSetTiebreakEntry||m.isSetTiebreakEntry&&!m.isNumericEnding)&&(c=!0,{scoreString:r,sets:n}=Bx({analysis:m,scoreString:r,sets:n,lowSide:e}),s=void 0);else if(i===Ql&&m.isMatchTiebreakEntry&&!m.isSetTiebreakEntry)m.matchTiebreakHasJoiner?d="existing joiner":m.isNumericEnding&&(c=!0,r+=Ql);else if([vm,Ql].includes(i))d="invalid location for joiner";else{if(a)return{updated:!1,info:"matchUp is complete"};if(m.isIncompleteSetScore)m.isNumericValue&&({sets:n,scoreString:r,updated:c}=yVe({analysis:m,scoreString:r,sets:n,value:i}));else if(m.isInvalidMatchTiebreakValue)d="invalid matchUp tiebreak character";else if(m.isInvalidSetTiebreakValue)d="invalid set tiebreak character";else if(m.isTiebreakCloser){let h=m.isSetTiebreakEntry?Km:Kp,g=h.split("").reverse()[0],I=h.split("")[0],v=n[n.length-1],{tiebreakFormat:w}=m.setFormat,{tiebreakTo:y,NoAD:b}=w||{},S=UN({set:v});if(!m.isTiebreakSet){let T=Number.parseInt(r.split(I).reverse()[0]),P=Voe({lowValue:T,tiebreakTo:y,NoAD:b});S===1?(v.side1TiebreakScore=P,v.side2TiebreakScore=T):(v.side1TiebreakScore=T,v.side2TiebreakScore=P)}r=(r||"")+g,m.isDecidingSet||(r+=" ");let U=HV({analysis:m,set:v});v.winningSide=U||void 0,c=!0}else if(m.isTiebreakSetValue)({info:d,scoreString:r,sets:n,updated:c}=SVe({analysis:m,auto:u,lowSide:e,scoreString:r,sets:n,value:i}));else if(m.isSetTiebreakEntry){let[h]=Km.split(""),g=Math.max(...Xo(h,r.split(""))),I=r.slice(g+1),v=I&&Ke(I)===fVe,w=Ke(I?I+i:i),{tiebreakFormat:y}=m.setFormat,{tiebreakTo:b,NoAD:S}=y||{};!v&&I.length<2?S&&w>b-1?d="invalid low value for NoAD tiebreak":(c=!0,r=(r||"")+i):d=v?"tiebreak begins with zero":"tiebreak digit limit"}else if(m.isCloser)d=`invalid key: ${i}`;else if(m.isGameScoreEntry)d="game scoreString entry";else if(m.lastSetIsComplete||!n.length){c=!0;let{scoreString:h,set:g}=UVe({analysis:m,lowSide:e,scoreString:r,value:Ke(i)});g&&(g.setNumber=n?.length+1||1),n=n?.concat(g).filter(Boolean)||[g],r=h||void 0}else console.log("error: unknown outcome")}if(c){n=n?.filter(Boolean);let{matchUpWinningSide:h}=wq({sets:n,winningSide:a,matchUpStatus:s,matchUpFormat:o});return a=h,h&&(!s||[_i,Da].includes(s))?(s=lVe,n=n.filter(g=>{let{side1Score:I,side2Score:v,side1TiebreakScore:w,side2TiebreakScore:y}=g;return I||v||w||y})):r&&!a&&![Poe,Doe,Roe].includes(s)&&(s=void 0),{updated:c,scoreString:r,sets:n,winningSide:a,matchUpStatus:s,info:d}}return{updated:c,scoreString:r,sets:n,winningSide:a,matchUpStatus:s,info:d}}var TN="\\d+-\\d+",aw="\\d+-\\d+\\(\\d+\\)",WV="\\[\\d+-\\d+\\]",DVe="\\d+-\\d+\\(\\d+-\\d+\\)",PVe=new RegExp(`(${TN}),`,"g"),EVe=new RegExp(`(${aw}),`,"g"),RVe=[TN,aw,WV,DVe],CVe=["0","1","2","00","01","10","11","002","012","102","112","000","001","010","100","011","101","110","111","002","012","102","112","0002","0012","0102","1002","0112","1012","1102","1112","3","03","13","013","103"],MVe=CVe.map(t=>{let e=t.split("").map(i=>RVe[i]).join(" ");return new RegExp(`^${e}$`)});function Sq(t){return!t||MVe.some(e=>e.test(t))}function NVe(t){let e="[];()",i=["[","("],r=Object.assign({},...e.split("").map(s=>({[s]:0}))),n="",a=t.split("").map(s=>{let o=e.includes(s)&&s,l=i.includes(o);if(l&&o)return r[o]+=1,n=o,s;if(!l&&o&&n&&o!==n){r[n]-=1;let u="[];".includes(n)&&"[];"||"()".includes(n)&&"()"||"",c=u.split("").find(d=>d!==n);if(u.includes(o))r[n]||(n="");else return r[o]||(n=""),c}return s}).join("");return t!==a?a:t}function vD(t){return/^\(\d+\)$/.test(t)||/^\(\d+$/.test(t)}function AVe(t){return/^\(\d+-\d+\)$/.test(t)||/^\[\d+-\d+\]$/.test(t)}function kI(t){let e=(i=>i?.split("-").join("").split("/").join(""))(t);if(/^\d+$/.test(e)&&e.length===2){let i=e.split("");return Math.abs(i.reduce((r,n)=>+r-+n))===1}return!1}function eE(t,e){let i=[t.slice(e,e+2),e?t.slice(0,1):t.slice(2)].map(n=>parseInt(n.join("")));e&&i.reverse();let r=i;if(Math.abs(r.reduce((n,a)=>+n-+a))>=2)return r.join("-")}function Uq(t){return t.length===2?t.split("").join("-"):([", ",",","/"," "].forEach(e=>t=t.split(e).join("-")),t=t.replace(/-{2,}/,"-"),t)}function kVe(t){return t.startsWith("(")&&t.endsWith(")")}function OVe({score:t,applied:e}){t=NVe(t);let i=/\)(\d+)/g;if(i.test(t))for(let S of t.match(i)){let U=S.replace(")",") ");t=t.replace(S,U)}t=t.replace(/\)\//g,") / "),t=t.replace(/\/\)/g,")");let r=/\(([\d- ]+)\)/g,n=/\(([\d- ]+)\)/,a=t.match(r);for(let S of a||[]){let[U]=S.match(n).slice(1),T=U.replace(/ /g,"");t=t.replace(S,`(${T})`)}let s=/\(\(\d-\d\)\)/g;if(s.test(t)){let S=t.match(s);S.length&&S.forEach(U=>{let T=U.match(/\((\(\d-\d\))\)/).slice(1)[0];t=t.replace(U,T)})}if(s=/\(\((\d)\)\)/g,s.test(t)){let S=t.match(s);S.length&&S.forEach(U=>{let T=U.match(/\((\(\d\))\)/).slice(1)[0];t=t.replace(U,T)})}/(^|\s)6-,/.test(t)&&(t=t.replace(/(^|\s)6-,/g,"6-0,"));let o=new RegExp(/[-,]{2,}/g);t=t.replace(o,"-"),["- "," -"].forEach(S=>{let U=new RegExp(`(\\d+)${S}(\\d+)`,"g"),T=t.match(U);T&&T.forEach(P=>t=t.replace(P,P.split(S).join("-")))}),/^[(-/,]+$/.test(t)&&(t=""),/\)[-/,]+$/.test(t)&&(t=t.slice(0,t.length-1)),/\d \/\d/.test(t)&&(t=t.replace(/ \//g,"/")),t.includes(" /")&&(t=t.replace(/ \//g," "));let l=/\(\d+, \)/g;l.test(t)&&t.match(l).forEach(S=>{let[U]=S.match(/\((\d+), \)/).slice(1);U.length===2?t=t.replace(S,`(${U})`):U.length===1&&U==="6"&&(t=t.replace(S,"(6-0)"))});let u=/\((\d+)\/\)/g;u.test(t)&&t.match(u).forEach(S=>{let[U]=S.match(/\((\d+)\/\)/).slice(1);U.length===2?t=t.replace(S,`(${U})`):U.length===1&&U==="6"?t=t.replace(S,"(6-0)"):t=t.replace(S,`(${U})`)});let c=/\d\/\d\/,/g;c.test(t)&&t.match(c).forEach(S=>{let[U]=S.match(/(\d\/\d)\/,/).slice(1);t=t.replace(S,`${U},`),e.push("slashComma")});let d=/\(\/(\d+)\)/g;d.test(t)&&t.match(d).forEach(S=>{let[U]=S.match(/\(\/(\d+)\)/).slice(1);U.length===2?t=t.replace(S,`(${U})`):U.length===1&&parseInt(U)<6?t=t.replace(S,`(6-${U})`):t=t.replace(S,`(${U})`)});let p,f,m,h,g,I=()=>{g=Sa(t.split("")),f=g["("]===(g[")"]||0)+1,p=(g["("]||0)+1===g[")"],m=g["["]===g["]"]+1,h=f&&!m};I();let v=/(\d+-\d+\(\d+)0,/;if(v.test(t)){let[S]=t.match(v).slice(1);t=t.replace(v,S+")")}if(g["("]===g[")"]&&g["("]>1){let S=t.split(")(").join(") (").split(" ");S.every(kVe)?t=S.map(U=>{let T=U.slice(1,U.length-1);return T.length>2?T:U}).join(" "):t=S.join(" ")}I();let w=/[A-Za-z]+/.test(t),y=/\d+/.test(t);if(!w&&!y)return{score:""};if(/^\[.+\]$/.test(t)&&"()/,- ".split("").some(S=>g[S])&&(t=t.slice(1,t.length-1)),/^\(.+\)$/.test(t)&&g["("]===1&&g[")"]===1&&"[]/,".split("").some(S=>g[S]>1)&&(t=t.slice(1,t.length-1)),t.startsWith("(")&&t.endsWith("))")&&(t=t.slice(1,t.length-1)),g["("]>(g[")"]||0)&&t[t.length-1]==="("&&(t=t.slice(0,t.length-1)+")",I()),g["("]===1&&!g[")"]&&t[0]==="("&&(t=t+")",I()),g["("]>(g[")"]||0)&&t.slice(0,2)==="(("&&(t=t.slice(1)),p){if(/^9\d/.test(t))t="("+t.slice(1);else if(t[0]!=="(")t="("+t;else{let S=[],U=0;for(let T of t.split("").reverse())T===")"&&(U?S.push("("):U+=1),T==="("&&(U-=1),S.push(T);S.reverse(),t=S.join("")}I()}if(g[")"]>(g["("]||0)&&t[0]===")"&&(t="("+t.slice(1),I()),h&&(t.endsWith(9)||/\d+0$/.test(t))&&(t=t.slice(0,t.length-1)+")",I()),h&&(!t.endsWith(")")||t.startsWith("(("))&&(t=t+")",I()),h){let S="",U=0;for(let T of t.split(""))T==="("&&(U?S+=")":U+=1),T===")"&&(U-=1),S+=T;t=S}I(),m&&!f&&(t=t+"]"),t.includes("([")&&t.includes("])")&&(t=t.split("([").join("[").split("])").join("]"),I()),/\(\d+0$/.test(t)&&(t=t.slice(0,t.length-1)+")"),I(),g[")"]===1&&!g["("]&&t.endsWith(")")&&(t=t.slice(0,t.length-1)),t.startsWith("(")&&t.endsWith(")")&&g["("]===1&&g[")"]===1&&(t=t.slice(1,t.length-1),I());let b=S=>{let U=S.indexOf("("),T=S.indexOf(")");return U>=0&&T>=0&&U<T};if(/^\([\d ]+.*[\d ]+\)$/.test(t)&&g["("]===g[")"]){let S=t.slice(1,t.length-1);b(S)&&(t=S,I())}return{score:t,applied:e}}function DN(t){if(!/^[\d-]+(\(\d\))*$/.test(t))return t;let e=Xo("-",t.split(""));if(!e.length)return t;let i=t.split("-"),r=!(i.length%2),n=!!(e.length%2);return r&&n&&e.length>i.length/2&&e.filter((a,s)=>s%2).forEach(a=>{t=t.substring(0,a)+" "+t.substring(a+1)}),t}function xVe({score:t,applied:e}){return t.includes("( ")&&(e.push("removeParenSpacingAfterOpen"),t=t.split("( ").map(i=>i.trim()).join("(")),t.includes(" )")&&(e.push("removeParenSpacingBeforeClose"),t=t.split(" )").map(i=>i.trim()).join(")")),[PVe,EVe].forEach(i=>{let r=t.match(i);r?.length&&(r.forEach(n=>{t=t.replace(n,n.slice(0,n.length-1)+" ")}),e.push("setsEndComma"))}),t=t.split(" ").filter(Boolean).map(DN).join(" "),{score:t,applied:e}}function FVe({score:t}){if(typeof t!="string")return{score:t};let e=p=>p?.split("-").join("").split("/").join(""),i=p=>p.split("[").join("(").split("]").join(")");t=t.split(", ").join(" ");let r=t.split(" ");t=r.map(p=>{let f=/^-(\d+)$/;if(f.test(p)){let[m]=p.match(f).slice(1);if(m.length===2)return m.split("").join("-")}return p}).join(" "),r=t.split(" ");let n=r.filter(vD),a=0,s="";for(let p of n){let f=Xo(p,r).find(I=>!a||I>a),m=r.slice(a,f-1),h=r[f-1],g=e(h);if(/^\d+$/.test(g)&&g.length===2){let I=g.split(""),v=Math.abs(I.reduce((w,y)=>+w-+y));if(v===1){let w=[m.join(" "),[h,p].join("")].join(" ");s+=w,a=f+1}else if(v===0){let w=Math.max(...I);if([4,5,6,7,8,9].includes(w)){let y=[6,4].includes(w)?w+1:w-1,b=[w,y].sort().reverse().join("-"),S=[m.join(" "),[b,p].join("")].join(" ");s+=S,a=f+1}}}}if(n.length&&s.length){let p=r.slice(a).join(" ");return s=[s,p].join(" "),{score:s.trim()}}if(r.length===2&&["(","["].some(p=>r[1].includes(p))){let p=e(r[0]).split("");if(Math.abs(p.reduce((f,m)=>+f-+m,0))===1)return r[1]=i(r[1]),{score:r.join("")}}let o=r.map(p=>AVe(p)&&"bracket"||kI(p)&&"set");if(o.includes("set")&&o.includes("bracket")){let p,f="";return r.forEach((m,h)=>{o[h]==="bracket"&&p==="set"?(m=i(m),f+=m):f+=` ${m}`,p=o[h]}),{score:f.trim()}}r=t.split(" ");let l,u=r.map(p=>{let f=new RegExp(/^(\d+)-(\d+)$/);if(f.test(p)){let[m,h]=p.match(f).slice(1),g=Math.abs([m,h].reduce((v,w)=>+v-+w,0)),I=Math.max(m,h);if(g===1)return l="tiebreakSet",l;if(g>=2&&I>=7&&l==="tiebreakSet")return l="tiebreak",l}}),c=Xo("tiebreak",u);if(c.length){let p="";r.forEach((f,m)=>{c.includes(m)?p+=`(${f}) `:c.includes(m+1)?p+=`${f}`:p+=`${f} `}),t=p.trim()}let d=/(\d+-\d+)\((\d+)-(\d+)\)$/;if(d.test(t)){let[p,f,m]=t.match(d).slice(1),h=Math.max(f,m)>=10;!kI(p)&&h&&(t=t.replace(d,`${p} [${f}-${m}]`))}return u=[],t=t.split(" ").map(p=>{let f=/^\((.*)\)$/,m=f.test(p),h=new RegExp(WV).test(p)&&"super"||new RegExp(aw).test(p)&&"tiebreak"||new RegExp(TN).test(p)&&"standard"||"unknown";return u.push(h),h==="standard"&&m?p.match(f)[1]:p}).join(" "),{score:t}}function LVe({score:t,applied:e}){for(let T of[".",","," ","/"]){let P=new RegExp(`^(\\d+)\\${T}(\\d+)$`);if(P.test(t)){let D=t.match(P).slice(1).map(R=>parseInt(R)),E=Math.abs(D[0]-D[1]);E<=10&&E>=2&&(t=t.split(T).join("-"),e.push("variedJoinerPattern"))}}t.includes(";")&&(t=t.split(";").join(" "),e.push("semicolon set separation"));let i=/(^|\s)(\d)\/(\d)(\d)\/(\d)(\(|$)/;if(i.test(t)){let[T,P,D,E,R,C]=t.match(i).slice(1);t=t.replace(i,`${T}${P}-${D} ${E}-${R}${C}`),e.push("smashSlashPattern")}/.*\s6[/-]+$/.test(t)&&(t+="0",e.push("incompleteFinalSetPattern"));let r=/\(6,\)/g;r.test(t)&&(t=t.replace(r,"(6, 0)"),e.push("missingZeroPattern1"));let n=/^\d{3,}\(/,a=/\(\d+\)\d+/;[n,a].forEach(()=>{t=t.split(" ").map(T=>(n.test(T)&&(T=T.replace("("," (")),a.test(T)&&(T=T.replace(")",") ")),T)).join(" "),e.push("spaceConsiderationPatterns")});let s=DN(t);s!==t&&(t=s,e.push("deDashMash"));let o=/^(\d)[-/,]+(\d{2})[-/,]+(\d)$/;if(o.test(t)){let[T,P,D]=t.match(o).slice(1),[E,R]=P.split("");t=`${T}-${E} ${R}-${D}`,e.push("smashSetPattern")}let l=/^(\d+)[ -](\d+)$/,u=/^([\d -]+)\/([\d -]+)$/;if(u.test(t)){let[T,P]=t.match(u).slice(1),D=T.trim(),E=P.trim();if(l.test(D)&&l.test(E)){let R=D.match(l).slice(1,3).join("-"),C=E.match(l).slice(1,3).join("-");t=`${R} ${C}`,e.push("slashSeparationPattern")}}let c=/^([\d -]+),([\d -]+)$/;if(c.test(t)){let[T,P]=t.match(c).slice(1),D=T.trim(),E=P.trim();if(l.test(D)&&l.test(E)){let R=D.match(l).slice(1,3).join("-"),C=E.match(l).slice(1,3).join("-");t=`${R} ${C}`,e.push("commaSeparationPattern")}}let d=/^\d \d,/;if(d.test(t)){let T=t.match(d)[0],P=T.slice(0,T.length-1).split(" ").join("-");t=t.replace(T,P),e.push("singleSetCommaSeparationPattern")}let p=0,f=/(\d+)-(\d{2})-(\d+)/;for(;f.test(t)&&p<3;){let[T,P,D]=t.match(f).slice(1),E=P.split(""),R=`${T}-${E[0]} ${E[1]}-${D}`;t=t.replace(f,R),e.push("noSetSeparationPattern"),p+=1}let m=/(^|\s)7-6\s(\d+)\s/g,h=t.match(m);if(h?.length){let T=/(^|\s)7-6\s(\d+)\s/;h.forEach(P=>{let D=P.match(T).slice(2)[0];t=t.replace(P,`7-6(${D}) `),e.push("floatingTiebreakPattern1")})}let g=t.match(/\d \d /);g?.forEach(T=>{let P=T.slice(0,T.length-1).split(" ").join("-");t=t.replace(T,P),e.push("spaceSeparatedSetPattern1")}),g=t.match(/ \d \d$/),g?.forEach(T=>{let P=" "+T.slice(1).split(" ").join("-");t=t.replace(T,P),e.push("spaceSeparatedSetPattern2")});let I=/^\d, *\d\/\d, *\d/;if(I.test(t)){let T=t.match(I)[0],P=T.split("/").map(D=>`(${D})`).join(" ")+" ";t=t.replace(T,P),e.push("slashCommaSetPattern")}let v=/\(6-\)/g;v.test(t)&&(t=t.replace(v,"(6-0)"),e.push("missingZeroPattern2"));let w=new RegExp("(?<!-)(\\d+)\\/(\\d+)(?!-)","g");if(w.test(t)){let T=t.match(w),P=new RegExp("(?<!-)(\\d+)\\/(\\d+)(?!-)"),D=t;T.forEach(E=>{let[R,C]=E.match(P).slice(1),M=`${R}-${C}`;D=D.replace(E,M)}),t=D,e.push("slashSetPattern")}let y=/(.*)\s(1\d)\s(\d+)$/;if(y.test(t)){let[T,P,D]=t.match(y).slice(1);T.replace(/\D/g,"").length>=4&&(t=T+` ${P}${D}`,e.push("spaceSeparatedSuperPattern"))}let b=/(^|\s)(\d+-\d+)\s(\d+)(\s|$)/g;for(let T of t.match(b)||[]){let[P,D,E,R]=T.match(/(^|\s)(\d+-\d+)\s(\d+)(\s|$)/).slice(1),[C,M]=D.split("-").map(N=>parseInt(N));Math.abs(C-M)===1&&(t=t.replace(T,`${P}${D}(${E})${R}`),e.push("spaceSeparatedSetPattern"))}let S=/\d-\d \(\d{1,2}\)(\s|$|,)/g;for(let T of t.match(S)||[]){let P=/(\d-\d) \((\d{1,2})\)(\s|$|,)/,[D,E,R]=T.match(P).slice(1),[C,M]=D.split("-").map(N=>parseInt(N));Math.abs(C-M)===1&&(t=t.replace(T,`${D}(${E})${R}`),e.push("floatingTiebreakPattern2"))}let U=/(^|\s)(\d \d)\(/g;for(let T of t.match(U)||[]){let P=/(^|\s)(\d \d)\(/,[D,E]=T.match(P).slice(1);t=t.replace(T,`${D}${E.split(" ").join("-")}(`),e.push("spacedTiebreakPattern")}return{score:t,applied:e}}function _Ve({score:t,matchUpStatus:e}){let i=t?.split(" ");t=i.map(o=>{if(o.endsWith("]")){let l=o.split("[");if(kI(l[0]))return l[0]+`(${l[1].slice(0,-1)})`}return o}).join(" ");let r=new RegExp(/(\([\d ]+\))/g);if(r.test(t))for(let o of t.match(r)){let l=o.replace(" ","-").match(/\((.*)\)/)?.[1];if(Ai(l)&&l?.[0]>2){if([2,4].includes(l.length))l=l.split("").join("-");else if(l.length===3){let u=l.indexOf("1");l=eE(l.split(""),u)}}t=t.replace(o,`(${l})`)}i=t?.split(" ");let n=new RegExp(/^(\d[-/]+\d)\((\d+)[-/]+(\d+)\)$/),a=i.length-1;t=i.map((o,l)=>{let u=[void 0,"","COMPLETED"].includes(e)||l!==a;if(n.test(o)&&u){let[c,d,p]=Array.from(o.match(n)).slice(1),f=Math.min(d,p);return`${c}(${f})`}return o}).join(" "),i=t?.split(" "),n=new RegExp(/^(\d{2})\((\d+)\)$/),t=i.map(o=>{if(n.test(o)){let[l,u]=Array.from(o.match(n)).slice(1),c=l.split("");return`${c[0]}-${c[1]}(${u})`}return o}).join(" "),i=t?.split(" "),n=new RegExp(/^\((\d[-/]+\d)\)(\d+)$/),t=i.map(o=>{if(n.test(o)){let[l,u]=Array.from(o.match(n)).slice(1);return kI(l)?`${l}(${u})`:l}return o}).join(" "),i=t?.split(" "),n=new RegExp(/^1-0\((\d+)\)$/),t=i.map(o=>{if(n.test(o)){let[l]=o.match(n).slice(1);return`[${l<9?10:Number.parseInt(l)+2}-${l}]`}return o}).join(" ");let s=/\((\d)+0 /;if(s.test(t)){let o=t.match(s)[1];t=t.replace(s,`(${o}) `)}return{score:t}}function $Ve({score:t,attributes:e,identifier:i}){if(typeof t!="string")return{score:t,identifier:i};let r=new RegExp(/\([\d,/ ]+\)/g),n=t.match(r);for(let c of n||[]){let d=c.match(/^\((.*)\)$/)?.slice(1)?.[0],p=t.split(c)[0].split(")").reverse()[0].replace(/\D/g,"");if(d?.length===2&&p?.length>=2){let h=p.slice(p.length-2).split("").map(g=>parseInt(g));if(Math.abs(h[0]-h[1])===1)continue}let f=Uq(d),m=DN(f);t=t.replace(c,`(${m})`).trim()}let a=new RegExp(/\[[\d,/ ]+\]/g);t.match(a)?.forEach(c=>{let d=Uq(c.match(/^\[(.*)\]$/)[1]);t=t.replace(c,`(${d}) `).trim()});let s=[")","]"],o=[")(","), (",") (",")[",") [","](","] ("];if(t.startsWith("(")&&s.some(c=>t.endsWith(c))&&o.some(c=>t.includes(c))){let c="",d=t.split(/[)\]]/).filter(Boolean).map(g=>(g.startsWith(",")&&(g=g.slice(1)),g.trim())),p=d.every(g=>g.includes(",")||vD(g)),f=d.every(g=>g.includes("/")||vD(g)),m=d.every(g=>g.includes("-")||vD(g)),h=p&&","||m&&"-"||f&&"/";if(h){let g;d.forEach(I=>{if(I.startsWith("("))if(g==="set"&&(c+=" "),I.includes(h))c+=I.slice(1).split(h).map(v=>v.trim()).join("-"),g="set";else{let v=I.slice(1);c+=`(${v}) `,g="tiebreak"}else if(I.startsWith("[")){let v=I.slice(1).split(h).map(y=>parseInt(y.trim())),w=Math.min(...v);g==="set"?c+=`(${w}) `:c+=`[${v.join("-")}] `,g="tiebreak"}}),t=c.trim()}}let l=Sa(t.split(""));l["("]===1&&l[")"]===1&&t.startsWith("(")&&t.endsWith(")")&&(t=t.slice(1,t.length-1),l["-"]===1&&kI(t)&&Ai(e?.removed)&&(t=t+`(${e.removed})`,e.removed=void 0));let u=/\(\)/g;return u.test(t)&&(t=t.replace(u,"").trim()),{score:t}}function Hoe({score:t}){let e=t.split(""),i=[],r,n=()=>r=[void 0,void 0,void 0],a=()=>{let o=`${r[0]}-${r[1]}`;return r[2]&&(o+=` (${r[2]})`),n(),r.push(r),o};n();let s=()=>r[0]!==void 0&&r[1]!==void 0&&Math.abs(parseInt(r[0])-parseInt(r[1]));for(;e.length;){let o=e.shift(),l=Ai(o)&&parseInt(o),u=r[0]!==void 0&&r[1]!==void 0;if(Ai(l)){if(r[0]===void 0){r[0]=l;continue}if(r[1]===void 0&&(r[1]=l,s())){i.push(a()),r=[void 0,void 0];continue}if(u&&e.length===1&&Ai(e[0])){let c=e.pop();r[0]=r[0].toString()+r[1].toString(),r[1]=c,i.push(a()),r=[void 0,void 0]}u&&s()}}return{sets:i}}function Vx(t){let e=t.indexOf("1"),i=t.split(""),r=i.every(n=>!isNaN(n));if(r&&t.length===3&&e===0){let n=eE(i,e);if(n)return n}if(r&&t.length===7&&e>3){let n=i.slice(4),a=eE(n,e-4);if(a)return`${i[0]}-${i[1]} ${i[2]}-${i[3]} ${a}`}}function Woe(t){let{score:e}=t,{applied:i,matchUpStatus:r}=t,n=e?.toString().split(""),a=n?.every(o=>Ai(o)),s=o=>Math.abs(o[0]-o[1]);if(typeof e=="number"||a){e=e.toString().toLowerCase(),a&&(e=n.join(""));let o=a?n.map(u=>parseInt(u)):e.split("").map(u=>parseInt(u)),{sets:l}=Hoe({score:e});if(o.length,e.length===3&&s(o.slice(0,2))===1){let[u,c,d]=o;e=`${u}-${c}(${d})`,i.push("numericTiebreakPattern1")}else if(e.length===3&&o[0]===1){let[u,c,d]=o;e=`[${u}${c}-${d}]`,i.push("numericTiebreakPattern2")}else if(e.length===4&&s(o.slice(0,2))===1&&"987654".split("").includes(o[0].toString())){let[u,c,d,p]=o,f=Math.min(d,p);e=`${u}-${c}(${f})`,i.push("numericTiebreakPattern3")}else if(e.length===4&&o[0]===1&&o[2]===1){let[u,c,d,p]=o;e=`[${u}${c}-${d}${p}]`,i.push("bigSuper")}else if(e.length===4){let[u,c,d,p]=o;e=`${u}${c} ${d}${p}`,i.push("split4")}else if(e.length===5&&s(o.slice(0,2))===1){let[u,c,d,p,f]=o;e=`${u}-${c}(${d}) ${p}-${f}`,i.push("numericTiebreakPattern4")}else if(e.length===5&&s(o.slice(3))===1){let[u,c,d,p,f]=o;e=`${u}-${c} ${d}-${p}(${f})`,i.push("numericTiebreakPattern5")}else if(o.length===7)if(s(o.slice(0,2))>1&&s(o.slice(2,4))>1&&o[4]===1){let[u,c,d,p,f,m,h]=o;e=`${u}-${c} ${d}-${p} [${f}${m}-${h}]`,i.push("numericTiebreakPattern6")}else if(s(o.slice(0,2))===1&&s(o.slice(3,5))>1&&s(o.slice(5,7))>1){let[u,c,d,p,f,m,h]=o;e=`${u}-${c}(${d}) ${p}-${f} ${m}-${h}`,i.push("numericTiebreakPattern7")}else if(s(o.slice(0,2))>1&&s(o.slice(2,4))===1&&s(o.slice(5,7))>1){let[u,c,d,p,f,m,h]=o;e=`${u}-${c} ${d}-${p}(${f}) ${m}-${h}`,i.push("numericTiebreakPattern8")}else if(s(o.slice(0,2))>1&&s(o.slice(2,4))>1&&s(o.slice(4,6))===1){let[u,c,d,p,f,m,h]=o;e=`${u}-${c} ${d}-${p} ${f}-${m}(${h})`,i.push("numericTiebreakPattern9")}else e=e.slice(0,2)+" "+e.slice(2,4)+" "+e.slice(4),i.push("numericMatchTiebreakPattern");else if(e.length%2){let u=Vx(e);u&&e!==u&&i.push("parsedSuperPattern"),e=u??e}else{let u=wr(e.split(""),2).map(I=>I.join("")),c=u.map(I=>{let[v,w]=I.split("").map(S=>parseInt(S)),y=Math.abs(v-w),b=v>w?1:2;return y>1&&b||b*-1}),d=c.reduce((I,v)=>I>0&&v>0,1),p=Sa(c),f=c.map(I=>Math.abs(I)),m=Sa(f),h=c[0]<0,g=!h&&c[1]<0;if(c[0]>0&&c[1]>0&&c[0]!==c[1])e=[u.slice(0,2).join(" "),u.slice(2).join("-")].join(" "),i.push("numeric3rdSetTiebreakPattern");else if(d)e=u.join(" "),i.push("chunkSplit");else if(o.length===6){if(p[1]===2||p[2]===2)if(!Object.values(m).includes(3))e=u.join(" "),i.push("chunkSplit");else{let[I,v,w,y,b,S]=o,U=c.reduce((T,P,D)=>P<0?D:T,void 0);if(U===0){let T=Math.min(w,y);e=`${I}-${v}(${T}) ${b}-${S}`,i.push("chunkSplitTiebreak1")}else if(U===1){let T=Math.min(b,S);e=`${I}-${v} ${w}-${y}(${T})`,i.push("chunkSplitTiebreak2")}else e=`${I}-${v} ${w}-${y}`,i.push("chunkSplitTrimExtraneous")}}else if(o.length===8){let[I,v,w,y,b,S,U,T]=o;h||g?o[5]===1&&(h?e=`${I}-${v}(${w}) ${y}-${b} [${S}${U}-${T}]`:e=`${I}-${v} ${w}-${y}(${b}) [${S}${U}-${T}]`):(c[0],c[1])}}}return{score:e,applied:i,matchUpStatus:r}}function zoe(t){let e=[0,0],i=[],r=t.split(" "),n=/(\d+)-(\d+)/;r.forEach(l=>{if(n.test(l)){let u=l.match(n).slice(1).map(d=>Number.parseInt(d)),c=u[0]>u[1]&&1||u[1]>u[0]&&2;c&&(e[c-1]+=1,i.push(c))}});let a=e[0]>e[1]&&1||e[1]>e[0]&&2,s=e[0]>0&&e[0]===e[1],o=e.reduce((l,u)=>l+u,0);return{setsWon:e,setsTied:s,setWinners:i,totalSets:o,winningSide:a}}function BVe({score:t,matchUpStatus:e,attributes:i}){let r=[],n,a=t.split(" "),s=a.length;t=a.map((c,d)=>{if(new RegExp(aw).test(c)){let f=c.slice(3),m=c.slice(0,3),h=m.split("-");if(!kI(m)&&!e){let g=Math.max(...h),I=m.indexOf(g),v=[g,g-1];return I&&v.reverse(),v.join("-")+f}}else if(c.length===2&&Ai(c))return c.split("").join("-");c=DN(c);let p=new RegExp(`^${WV}$`).test(c)&&"super"||new RegExp(`^${aw}$`).test(c)&&"tiebreak"||new RegExp(`^${TN}$`).test(c)&&"standard"||"unknown";if(r.push(p),s>1&&p==="standard"&&d<2){let[f,m]=c.split("-"),h=Math.abs(parseInt(f)-parseInt(m)),g=Math.max(f,m),I=Math.min(f,m),v=[parseInt(f),parseInt(m)].indexOf(I);if(g>9&&h>2){let w=g.toString().split(""),y=w.find(b=>parseInt(b)>I||d&&parseInt(b)<=n)??w[0];y&&(c=v?[y,I].join("-"):[I,y].join("-"))}g>(n||0)&&(n=g)}if(p==="standard"){let[f,m]=c.split("-");if(!Math.abs(parseInt(f)-parseInt(m))&&e!=="RETIRED")return""}return c}).filter(Boolean).join(" ");let{setsWon:o,setWinners:l,totalSets:u}=zoe(t);if(u===1&&i?.removed==="6"&&(t+=" 6-0"),t.split(" ").length>2&&Math.max(...o)>=2&&l[0]===l[1]&&(t=t.split(" ").slice(0,2).join(" ")),Math.max(...o)>2){let c=[0,0];t=t.split(" ").map((d,p)=>(c[l[p]]+=1,Math.max(...c)>2?void 0:d)).filter(Boolean).join(" ")}return{score:t,profile:r}}function VVe({score:t}){let{setsTied:e,winningSide:i}=zoe(t),r=/\s\((\d+)\)$/;if(!i&&e&&r.test(t)){let o=t.match(r).slice(1)[0],l=o<=8?10:o+2;t=t.replace(r,` [${l}-${o}]`)}let n=t.split(" "),a=n[n.length-1];if(!a.includes("-")||a.indexOf("(")>0)return{score:t};let s=a.split("(").join("").split(")").join("").split("-");if(!s.every(o=>Ai(o)))return{score:t};if(s[0]==="76"){let o=s[1].length===2?Math.min(...s[1].split("").map(l=>parseInt(l))):s[1];t=[...n.slice(0,n.length-1),`7-6(${o})`].join(" ")}else{s=s.map(u=>parseInt(u));let o=Math.max(...s),l=Math.abs(s[0]-s[1]);if(o>=10){if(l>2&&s.every(u=>+u>=10)){let u=s.map(c=>c===o?c-10:10).sort();l=Math.abs(u[0]-u[1]),l>2&&(s=u)}t=[...n.slice(0,n.length-1),`[${s.join("-")}]`].join(" ")}else n.length===3&&o>=7&&l>2&&(t=[...n.slice(0,n.length-1),`[${s.join("-")}]`].join(" "))}return{score:t}}function jVe({score:t}){return t=t?.toString().toLowerCase()||"",{score:t}}function GVe({score:t,applied:e}){return typeof t!="string"?{score:t}:(t.toLowerCase().includes("o")&&(t=t.toLowerCase().split(" ").map(i=>i.split("o").join("0")).join(" "),e.push("replaceOh")),{score:t,applied:e})}function HVe({score:t,applied:e}){return typeof t!="string"?{score:t}:(t=t.toLowerCase().split(" ").map(i=>{if(/^\d+$/.test(i)&&i.length>2){let r=i.indexOf("1");if(i.length%2){if(i.length===3&&r===0){let n=eE(i.split(""),r);return e.push("getSuper"),n}}else{let{score:n,applied:a}=Woe({score:i,applied:[]});n!==i&&(i=n,e.push(...a))}}return i}).join(" "),{score:t,applied:e})}function WVe({score:t,applied:e}){return typeof t!="string"?{score:t}:[3,4].includes(t.length)&&Vx(t)?{score:Vx(t)}:(t=t.toLowerCase().split(" ").map(i=>{if(/^\d+$/.test(i)&&i.length===1){e.push("removeErroneous1");return}return i}).filter(Boolean).join(" "),{score:t,applied:e})}function zVe({score:t,applied:e}){return["walkover","wo","w/o","w-o"].includes(t?.toString().toLowerCase())?(e.push("handleWalkover"),{matchUpStatus:"walkover",score:"",applied:e}):{score:t}}function qVe({score:t,profile:e,applied:i}){t=t?.toString().toLowerCase();let r=/^(.*\d+.*)(ret|con)+[A-Za-z ]*$/;if(r.test(t)){let[s]=t.match(r).slice(1);return i.push("handleRetired"),{score:s.trim(),matchUpStatus:"retired",applied:i}}let n=e?.matchUpStatuses?.retired,a=["rtd",...Array.isArray(n)?n:[n].filter(Boolean)].find(s=>t?.endsWith(s));return a?(i.push("handleRetired"),{matchUpStatus:"retired",score:t?.replace(a,"").trim(),applied:i}):{score:t}}function YVe({score:t,profile:e,applied:i}){t=t?.toString().toLowerCase();let r=/^(.*\d+.*)(def|defaulted)+[A-Za-z ]*$/;if(r.test(t)){let[s]=t.match(r).slice(1);return i.push("handleDefaulted"),{score:s.trim(),matchUpStatus:"defaulted",applied:i}}let n=e?.matchUpStatuses?.defaulted,a=["dft",...Array.isArray(n)?n:[n].filter(Boolean)].find(s=>t?.endsWith(s));return a?(i.push("handleDefaulted"),{matchUpStatus:"defaulted",score:t?.replace(a,"").trim(),applied:i}):{score:t}}function KVe({score:t,attributes:e}){(t.endsWith(" am")||t.endsWith(" pm"))&&(t=""),t=t.replace(/[A-Za-z]+/g,"").trim(),[".",","].some(n=>t.endsWith(n))&&(t=t.slice(0,t.length-1));let i="()/-".split("").some(n=>t.includes(n));/ \d$/.test(t)&&i&&(e={removed:t.slice(t.length-2).trim()},t=t.slice(0,t.length-2));let r=/(.*)[A-Za-z]+$/;return r.test(t)&&(t=t.match(r).slice(1)[0].trim()),{score:t,attributes:e}}function XVe({score:t}){return new RegExp(/-\d+\/\d+-/).test(t)&&(t=t.split("/").join(" ")),{score:t}}function JVe({score:t}){let e=new RegExp(/^\d+\/\d+/),i=t.split(" ");i.some(n=>e.test(n))&&(t=i.map(n=>e.test(n)?n.replace("/","-"):n).join(" "));let r=/^(\d+), *(\d+)$/;if(r.test(t)){let[n,a]=t.match(r).slice(1);t=[n,a].join("-")}return{score:t}}function QVe({score:t}){let e=new RegExp(/\(\d+\/\d+\)/g),i=t.match(e);for(let r of i||[]){let n=r.replace("/","-");t=t.replace(r,n)}return{score:t}}function ZVe({score:t}){if(t.includes(",")){let e=t.split(",").map(r=>r.trim()),i=r=>/\d \d/.test(r);e.every(i)&&(t=e.map(r=>{let n=/\d+ \d+/g;for(let a of r.match(n)){let[s,o]=a.match(/(\d+) (\d+)/).slice(1);r=r.replace(a,`${s}-${o}`)}return r}).join(" "))}if(t.includes(" ")){let e=t.replace(/[ ,]/g,"");e.split("").every(i=>Ai(i))&&e.length===4&&(t=e)}return{score:t}}function eje({score:t}){let e=new RegExp(/^\[\d+\](.*)$/);e.test(t)&&(t=t.match(e).slice(1)[0].trim());let i=/\(,/g;return i.test(t)&&(t=t.replace(i,"(")),{score:t}}var tje={handleTiebreakSlashSeparation:QVe,handleSetSlashSeparation:XVe,punctuationAdjustments:OVe,handleGameSeparation:JVe,joinFloatingTiebreak:FVe,handleBracketSpacing:xVe,handleSpaceSeparator:ZVe,separateScoreBlocks:HVe,matchKnownPatterns:LVe,removeDanglingBits:KVe,removeErroneous:WVe,handleDefaulted:YVe,handleWalkover:zVe,properTiebreak:_Ve,handleNumeric:Woe,handleRetired:qVe,containedSets:$Ve,sensibleSets:BVe,stringScore:jVe,superSquare:VVe,setBuilder:Hoe,excisions:eje,replaceOh:GVe},ck={},ije=["handleNumeric","handleWalkover","handleRetired","handleDefaulted","replaceOh","stringScore","punctuationAdjustments","excisions","handleSpaceSeparator","matchKnownPatterns","removeDanglingBits","handleBracketSpacing","matchKnownPatterns","containedSets","separateScoreBlocks","handleGameSeparation","removeErroneous","joinFloatingTiebreak","handleSetSlashSeparation","handleTiebreakSlashSeparation","properTiebreak","sensibleSets","superSquare"],rje=["handleNumeric","separateScoreBlocks","sensibleSets","superSquare"];function qoe(t){if(!t.score)return{error:re};let{score:e,sheetName:i,identifier:r,fileName:n,stepLog:a,fullLog:s,profile:o}=t,l=[],u,c=[],d,p,f=e,m=g=>{g.forEach(I=>{p=tje[I]({profile:o,identifier:r,matchUpStatus:u,attributes:d,applied:c,score:f});let v=p.score!==f;v&&l.push({method:I,score:p.score}),a&&(s||v||p.matchUpStatus!==u)&&console.log(u?{score:p.score,matchUpStatus:u}:{score:p.score},I),p.matchUpStatus&&(u=p.matchUpStatus),p.attributes&&(d=p.attributes),p.applied&&(c=p.applied),f=p.score})};m(ije);let h=Sq(f);return h||(f=e.toString().replaceAll(/\D/g,""),d?.removed&&(d.removed=void 0),m(rje),h=Sq(f),h||(f="")),c.forEach(g=>{ck[g]||(ck[g]=0),ck[g]+=1}),{matchUpStatus:u?.toUpperCase(),modifications:l,attributes:d,isValid:h,score:f}}var Yoe={};dt(Yoe,{analyzeScore:()=>qV,analyzeSet:()=>sw,calculateMatchStatistics:()=>$V,checkScoreHasValue:()=>fr,checkSetIsComplete:()=>SN,deduceMatchUpFormat:()=>RN,enrichPointHistory:()=>voe,getEpisodes:()=>_V,getQuickStats:()=>yoe,getScore:()=>Cd,getScoreboard:()=>xV,getSetComplement:()=>KV,getTiebreakComplement:()=>EN,getWinner:()=>FV,isComplete:()=>LV,isValidMatchUpFormat:()=>$a,parseScoreString:()=>JU,toStatObjects:()=>BV,validateMatchUpScore:()=>Koe,validateScore:()=>YV,validateSetScore:()=>zV,validateTieFormat:()=>Gn});function nje(t,e,i,r,n,a=!1){return n?{isValid:!0}:t===0&&e===0?{isValid:!1,error:"Tiebreak-only set requires both scores"}:t<r?{isValid:!1,error:`Tiebreak-only set winner must reach at least ${r}, got ${t}`}:i<(a?1:2)?{isValid:!1,error:a?`Tiebreak-only set (NoAD) must be won by at least 1 point, got ${t}-${e}`:`Tiebreak-only set must be won by at least 2 points, got ${t}-${e}`}:a?{isValid:!0}:t===r&&e>r-2?{isValid:!1,error:`Tiebreak-only set at ${r}-${e} requires playing past ${r}`}:t>r&&i!==2?{isValid:!1,error:`Tiebreak-only set past ${r} must be won by exactly 2 points, got ${t}-${e}`}:{isValid:!0}}function aje(t,e,i,r){let n=r===i?i+1:i,a=r;return t!==n?{isValid:!1,error:`Tiebreak set winner must have ${n} games, got ${t}`}:e!==a?{isValid:!1,error:`Tiebreak set loser must have ${a} games, got ${e}`}:{isValid:!0}}function sje(t,e,i){let r=Math.max(t||0,e||0),n=Math.min(t||0,e||0),a=r-n,s=i.tiebreakTo||7;return r<s?{isValid:!1,error:`Tiebreak winner must reach ${s} points, got ${r}`}:a<2?{isValid:!1,error:`Tiebreak must be won by 2 points, got ${r}-${n}`}:n>=s-1&&a>2?{isValid:!1,error:`Tiebreak score ${r}-${n} is invalid`}:{isValid:!0}}function oje(t,e,i,r){return r?t===i+1&&e<i-1?{isValid:!1,error:`With tiebreak format, if side 1 has ${i+1} games, side 2 must be at least ${i-1}, got ${e}`}:e===i+1&&t<i-1?{isValid:!1,error:`With tiebreak format, if side 2 has ${i+1} games, side 1 must be at least ${i-1}, got ${t}`}:{isValid:!0}:{isValid:!0}}function lje(t,e,i,r,n){if(t<r)return{isValid:!1,error:`Set winner must reach ${r} games, got ${t}`};let a=n&&t===r&&e===n&&i===1;if(i<2&&!a)return{isValid:!1,error:`Set must be won by at least 2 games, got ${t}-${e}`};if(n){if(e>=n&&!a)return{isValid:!1,error:`When tied at ${n}-${n}, must play tiebreak. Use format like ${n+1}-${n}(5)`};let s=n===r?r+1:r;if(t>s)return{isValid:!1,error:`With tiebreak format, set score cannot exceed ${s}-${n}. Got ${t}-${e}`}}else if(t>r+10)return{isValid:!1,error:`Set score ${t}-${e} exceeds reasonable limits`};return{isValid:!0}}function uje(t,e,i){let r=t.side1TiebreakScore,n=t.side2TiebreakScore,a=e&&i?r:t.side1Score||t.side1||0,s=e&&i?n:t.side2Score||t.side2||0;return{side1Score:a,side2Score:s,side1TiebreakScore:r,side2TiebreakScore:n}}function cje(t,e,i,r,n,a,s){if(i&&r){let o=aje(t,e,i,r);if(!o.isValid)return o}return(n!==void 0||a!==void 0)&&s?sje(n,a,s):{isValid:!0}}function dje(t,e,i){return i&&(t>i+10||e>i+10)?{isValid:!1,error:`Set score ${t}-${e} exceeds expected range for ${i}-game sets`}:{isValid:!0}}function pje(t,e,i){let{side1:r,side2:n,winner:a,loser:s,diff:o}=t,{setTo:l,tiebreakAt:u}=e;if(l&&u){let c=oje(r,n,l,u);if(!c.isValid)return c}return i?dje(a,s,l):l?lje(a,s,o,l,u):{isValid:!0}}function zV(t,e,i,r){if(!e)return{isValid:!0};let n=qi(e);if(!n)return{isValid:!0};let a=i&&n.finalSetFormat?n.finalSetFormat:n.setFormat;if(!a)return{isValid:!0};if(a.timed){if(!r){let S=t.side1Score??0,U=t.side2Score??0;if(S===0&&U===0)return{isValid:!1,error:"Timed set requires at least one side to have scored"};if(a.based==="P"&&S===U&&S>0&&a.tiebreakFormat&&!(t.side1TiebreakScore!==void 0||t.side2TiebreakScore!==void 0))return{isValid:!1,error:"Tied timed set requires tiebreak"}}return{isValid:!0}}let{setTo:s,tiebreakAt:o,tiebreakFormat:l,tiebreakSet:u}=a,c=u?.tiebreakTo,d=!!c&&!s,p=t.side1TiebreakScore!==void 0&&t.side2TiebreakScore!==void 0,{side1Score:f,side2Score:m,side1TiebreakScore:h,side2TiebreakScore:g}=uje(t,d,p),I=Math.max(f,m),v=Math.min(f,m),w=I-v;if(d){let S=t.NoAD??a.tiebreakSet?.NoAD??!1;return nje(I,v,w,c,r??!1,S)}let y=h!==void 0||g!==void 0,b=s&&I===s+1&&v===s;return y||b?cje(I,v,s,o,h,g,l):pje({side1:f,side2:m,winner:I,loser:v,diff:w},{setTo:s,tiebreakAt:o},r)}function Koe(t,e,i){if(!t||t.length===0)return{isValid:!0};let r=e?.match(/SET(\d+)/)?.[1],n=r?Number.parseInt(r):3,a=[Sr,ai,qt].includes(i||"");for(let s=0;s<t.length;s++){let o=t[s],l=s+1===n,u=o.winningSide!==void 0,c=zV(o,e,l,a||i===void 0&&!u);if(!c.isValid)return{isValid:!1,error:`Set ${s+1}: ${c.error}`}}return{isValid:!0}}function PN(t){return!!t?.aggregate}function fje(t,e,i,r,n,a){let{tiebreakTo:s,NoAD:o}=t||{},l=Math.max(e??0,i??0);return!(o&&l>s||l<s&&r&&(n&&!a||!n))}function mje(t,e,i,r,n,a){let s=e+1===r,{side1Score:o,side2Score:l,side1TiebreakScore:u,side2TiebreakScore:c,winningSide:d}=t,p=Math.max(o??0,l??0),f=u??c,{finalSetFormat:m,setFormat:h}=i,g=s&&m||h;return f&&!fje(g?.tiebreakFormat,u,c,d,n,a)?!1:g.setTo?!(!g.noTiebreak&&p>g.setTo+1):!0}function hje(t){let e=t.reduce((i,r)=>((r.side1Score!==void 0||r.side2Score!==void 0)&&(i[0]+=r.side1Score??0,i[1]+=r.side2Score??0),i),[0,0]);return e[0]>e[1]?1:e[1]>e[0]?2:t.find(i=>i.side1TiebreakScore!==void 0||i.side2TiebreakScore!==void 0)?.winningSide}function gje(t,e,i,r,n){return(!n||t===e)&&i===1&&r.indexOf(t)+1||void 0}function qV({existingMatchUpStatus:t,matchUpFormat:e,matchUpStatus:i,winningSide:r,score:n}){let a=n?.sets??[],s=(a?.filter(T=>T?.winningSide)||[]).reduce((T,P)=>{let{winningSide:D}=P;if(!D)return T;let E=D-1;return T[E]++,T},[0,0]),o=r?r-1:void 0,l=o!==void 0&&[0,1].includes(o)?1-o:void 0,u=o!==void 0&&s[o],c=l!==void 0&&s[l],d=e?qi(e):void 0,p=Math.max(...s),f=Sa(s)[p],m=d?.setFormat?.timed||d?.finalSetFormat?.timed,h=d?.bestOf||d?.exactly,g=h&&Math.ceil(h/2)||1,I=i??t,v=!!(I&&[qt,Sr,ai].includes(I)),w=!d||!a.length||a.every((T,P)=>mje(T,P,d,h??0,P===a.length-1,v)),y=d?.exactly,b=!y||!I||I!==Oi||v||a.length>=y,S=PN(d),U=S&&a.length>0?hje(a):gje(p,g,f,s,e);return{valid:!!(w&&b&&(r&&S&&r===U||r&&!S&&u>c&&r===U||r&&v||!r&&!U&&(![Oi,qt,Sr,ai].includes(I)||m&&I===Oi)))}}function YV({existingMatchUpStatus:t,matchUpFormat:e,matchUpStatus:i,winningSide:r,score:n}){if(typeof n!="object")return{error:re};let{sets:a,scoreStringSide1:s,scoreStringSide2:o}=n,l="scoreString must be a string!";if(s!==void 0&&typeof s!="string")return{error:re,info:l};if(o!==void 0&&typeof o!="string")return{error:re,info:l};if(a!==void 0&&!Array.isArray(a))return{error:re,info:zp("sets")};if(a?.length){let u=a.map(d=>d?.setNumber).filter(Boolean);if(u.length!==nt(u).length)return{error:re,info:"setNumbers not unique"};for(let d of a){let{side1Score:p,side2Score:f,side1TiebreakScore:m,side2TiebreakScore:h,side1PointScore:g,side2PointScore:I,winningSide:v,setNumber:w}=d;if(![[p,f],[m,h],[g,I]].filter(y=>y.some(b=>![void 0,null].includes(b))).every(y=>y.every(b=>lt(b))))return{error:re,info:"non-numeric values"};if(![w,v].filter(y=>![void 0,null].includes(y)).every(y=>lt(y)))return{error:re,info:"non-numeric values"};if(v&&![1,2].includes(v))return{error:re,info:"winningSide must be 1 or 2"}}let{valid:c}=qV({existingMatchUpStatus:t,matchUpStatus:i,matchUpFormat:e,winningSide:r,score:n});if(!c)return{error:zte,info:"score is invalid for matchUpFormat or winningSide does not match calculated winningSide"}}return{valid:!0}}var KV=t=>{let{isSide1:e,lowValue:i,setTo:r,tiebreakAt:n,NoAD:a}=t;if(i===void 0)return!1;let s=Ke(i);s?.toString().length>2&&(s=Number.parseInt(s.toString().slice(0,2))),n&&n<r&&s>n&&(s=n);let o;return a&&!n?s>r?o=r:o=s<r?r:r-1:o=s+1<r&&r||n&&n<r&&s===n&&r||!n&&s+2||r+1,[e?s:o,e?o:s]},EN=t=>{let{isSide1:e,lowValue:i,tiebreakTo:r,tiebreakNoAd:n}=t;if(i===void 0)return!1;let a=typeof i=="string"?Number.parseInt(i):i;a?.toString().length>2&&(a=Number.parseInt(a.toString().slice(0,2))),n&&a>r-1&&(a=r-1);let s=Ije({lowValue:a,NoAD:n,tiebreakTo:r});return[e?a:s,e?s:a]};function Ije(t){let{lowValue:e,NoAD:i,tiebreakTo:r}=t,n=i?1:2;return e+1>=r?e+n:r}function jx(t,e){return t>e&&1||t<e&&2||void 0}function vje(t,e){return e?{side1Score:t[0],side2Score:t[1],winningSide:jx(t[0],t[1])}:{side1TiebreakScore:t[0],side2TiebreakScore:t[1],winningSide:jx(t[0],t[1])}}function JU({tiebreakTo:t=7,scoreString:e="",matchUpFormat:i}){let r,n=3;if(i)try{r=qi(i);let c=/SET(\d+)/.exec(i)?.[1];n=c?Number.parseInt(c):3}catch{}return e?.split(" ").filter(Boolean).map((c,d)=>u({set:c,setNumber:d+1}));function a(c,d){if(!r||!d)return!1;let p=c===n&&r.finalSetFormat?r.finalSetFormat:r.setFormat;if(!p)return!1;let f=p.tiebreakSet?.tiebreakTo,m=p.setTo;return!!f&&!m}function s(c){if(!r)return t;let d=c===n&&r.finalSetFormat?r.finalSetFormat:r.setFormat;return d?.tiebreakSet?.tiebreakTo??d?.tiebreakFormat?.tiebreakTo??t}function o(c,d,p){let f=c[1],m=s(p),h=EN({lowValue:f,isSide1:d===2,tiebreakTo:m});return Array.isArray(h)?[h[0],h[1]]:[void 0,void 0]}function l(c,d,p,f){let m=(d&&c.replace(d[0],"")||p&&c.replace(p[0],"")||c).split("-").map(y=>Number.parseInt(y)),h=m[0],g=m[1],I=jx(h,g),v,w;if(d&&([v,w]=o(d,I,f)),p){let y=p[1].split("-").map(b=>Number.parseInt(b));v=y[0],w=y[1]}return{side1Score:h,side2Score:g,side1TiebreakScore:v,side2TiebreakScore:w,winningSide:I}}function u({set:c,setNumber:d}){let p=/\(([^)]+)\)/,f=/\[([^\]]+)\]/,m=p.exec(c),h=f.exec(c),g=c?.startsWith("[")&&h,I=a(d,!!g),v=s(d),w=I&&v===1,y;if(g){let b=h[1].split("-").map(S=>Number.parseInt(S));y=vje(b,I)}else y=l(c,m,h,d);return{side1Score:y.side1Score,side2Score:y.side2Score,side1TiebreakScore:y.side1TiebreakScore,side2TiebreakScore:y.side2TiebreakScore,winningSide:y.winningSide,setNumber:d,...w&&{NoAD:!0},...I&&{tiebreakSet:!0}}}}function yje({matchUpScoringFormat:t,isDecidingSet:e,isTiebreakSet:i,isTimedSet:r,setObject:n}){if(!n)return;let a=UN({set:n});return SN({matchUpScoringFormat:t,set:n,isDecidingSet:e,isTiebreakSet:i,isTimedSet:r})&&a||void 0}function sw(t){let{setObject:e,matchUpScoringFormat:i}=t;if(!e)return{error:sM};let{setNumber:r}=e||{},{bestOf:n,exactly:a}=i||{},s=n||a,o=!!(r&&s&&r===s),l=o&&i?.finalSetFormat||i?.setFormat,u=!!l?.tiebreakSet,c=!!l?.timed,d=!u&&!c,p=!!(r&&s&&r<=s),f=[e?.side1Score,e?.side2Score],m=[e?.side1PointScore,e?.side2PointScore],h=[e?.side1TiebreakScore,e?.side2TiebreakScore],g=f.filter(k=>k!==void 0).length,I=m.filter(k=>k!==void 0).length,v=h.filter(k=>k!==void 0).length,w=f?.filter(k=>!isNaN(k)).length,y=h?.filter(k=>!isNaN(k)).length,{tiebreakAt:b}=l||{},S=b&&f.filter(k=>k>=b).length===2,U=S&&(f[0]>f[1]&&1||f[1]>f[0]&&2||void 0),T=!!(y&&!w),P=!!e?.winningSide,{error:D,result:E}=bje({sideTiebreakScores:h,sideGameScores:f,setFormat:l,setObject:e}),{error:R,result:C}=wje({sideTiebreakScores:h,setObject:e,setFormat:l}),M=d&&!T&&E||u&&T&&C||c,N=p&&!(u&&!T)&&!(d&&T)&&(!P||M),A=yje({isTimedSet:c,matchUpScoringFormat:i,isDecidingSet:o,isTiebreakSet:T,setObject:e}),O={expectTiebreakSet:u,expectTimedSet:c,hasTiebreakCondition:S,isCompletedSet:P,isDecidingSet:o,isTiebreakSet:T,isValidSet:N,isValidSetNumber:p,isValidSetOutcome:M,leadingSide:U,setFormat:l,sideGameScores:f,sideGameScoresCount:g,sidePointScores:m,sidePointScoresCount:I,sideTiebreakScores:h,sideTiebreakScoresCount:v,winningSide:A};return e?.winningSide!==void 0&&(T?(O.isValidTiebreakSetOutcome=C,C||(O.tiebreakSetError=R)):(O.isValidStandardSetOutcome=E,E||(O.standardSetError=D))),O}function bje({setObject:t,setFormat:e,sideGameScores:i,sideTiebreakScores:r}){if(!t)return{result:!1,error:sM};let n=!!e?.tiebreakSet,a=!!e?.timed;if(!e||n||a)return{result:!1,error:re};if(i?.filter(U=>!isNaN(U)).length!==2)return{result:!1,error:sx};let{setTo:s,tiebreakAt:o,tiebreakFormat:l,NoAD:u}=e||{};if(!(s&&i?.find(U=>U>=s)))return{result:!1,error:sx};let c=[1,2].includes(t?.winningSide);if(!t||!c)return{result:!1,error:lM};let d=t?.winningSide-1,p=1-d,f=i[d],m=i[p],h=f-m;if(!(f>m))return{result:!1,error:{message:"winningSide game scoreString is not high"}};let g=o&&l,I=r?.filter(U=>!isNaN(U)).length===2,v=r?.[d],w=r?.[p],y=o&&i.filter(U=>U>=o).length===2;if(g){let{NoAD:U,tiebreakTo:T}=l;if(y){if(h>1)return{result:!1,error:{message:"invalid winning game scoreString (5)"}};if(!I)return{result:!1,error:{message:"invalid tiebreak scores (1)"}};if(isNaN(T))return{result:!1,error:{message:"tiebreakTo error"}};if(!(T&&r?.find(C=>C>=T)))return{result:!1,error:{message:"invalid tiebreak scores (2)"}};let P=o<s?s:s+1;if(f>P)return{result:!1,error:{message:"invalid winning game scoreString (1)"}};if(!v||!w||v<w)return{result:!1,error:{message:"winningSide tiebreak value is not high"}};let D=U?1:2,E=v-w,R=w>=T-1;if(E&&R&&E<D)return{result:!1,error:{message:"invalid tiebreak scores (3)"}}}if(f>s&&!y)return{result:!1,error:{message:"invalid winning game scoreString (2)"}}}let b=u?1:2,S=m>=s-1;return h&&S&&!y&&h<b?{result:!1,error:{message:"invalid winning game scoreString (3)"}}:h>b&&f>s?{result:!1,error:{message:"invalid winning game scoreString (4)"}}:{result:!0}}function wje({setObject:t,setFormat:e,sideTiebreakScores:i}){if(!t)return{result:!1,error:sM};let r=!!e?.tiebreakSet,n=!!e?.timed;if(!e||!r||n)return{result:!1,error:{message:"not tiebreak set"}};let a=[1,2].includes(t?.winningSide);if(!t||!a)return{result:!1,error:lM};let{tiebreakSet:s}=e||{},{NoAD:o,tiebreakTo:l}=s||{};if(i?.filter(g=>!isNaN(g)).length!==2)return{result:!1,error:{message:"invalid tiebreak scores (1)"}};if(isNaN(l))return{result:!1,error:{message:"tiebreakTo error"}};if(!i?.find(g=>g>=l))return{result:!1,error:{message:"invalid tiebreak scores (2)"}};let u=t?.winningSide-1,c=1-u,d=i[u],p=i[c];if(!d||!p||d<p)return{result:!1,error:{message:"winningSide tiebreak value is not high"}};let f=o?1:2,m=d-p,h=p>=l-1;return m&&h&&m<f?{result:!1,error:{message:"invalid tiebreak scores (3)"}}:{result:!0}}var dk="SET3-S:6/TB7";function RN(t){let e=t.split(/[\s,]+/).filter(o=>o.length>0);if(e.length===0)return dk;let i;e.length===1?i=1:e.length===2?i=3:i=5;for(let o of e){let l=o.replace(/\([^)]*\)/g,"").match(/(\d+)/g)?.map(u=>Number.parseInt(u,10))||[];if(l.length===2){let u=Math.max(...l),c=Math.min(...l),d=u-c;if(u===10||u>10&&d<=2)return`SET${i}-S:TB10`}}let r=null;for(let o of e)if(/\(/.test(o)){r=o;break}let n;if(r){let o=r.replace(/\([^)]*\)/g,"").match(/(\d+)/g)?.map(c=>parseInt(c,10))||[];if(o.length===0)return dk;let l=Math.max(...o),u=Math.min(...o);l===u+1?n=u:n=l-1}else{let o=[];for(let u of e){let c=u.replace(/\([^)]*\)/g,"").match(/(\d+)/g)?.map(d=>parseInt(d,10))||[];c.length>0&&o.push(Math.max(...c))}if(o.length===0)return dk;let l=Math.max(...o);l>=6?n=6:n=l}let a=!1;if(e.length>=3){let o=e.at(-1).replace(/\([^)]*\)/g,"").match(/(\d+)/g)?.map(l=>Number.parseInt(l,10))||[];if(o.length===2){let l=Math.max(...o),u=Math.min(...o);l>n+1&&l-u===2&&(a=!0)}}let s;return n===6?s=`SET${i}-S:6/TB7`:n===4?s=`SET${i}-S:4/TB7`:s=`SET${i}-S:${n}/TB7`,a&&(s+=`-F:${n}`),s}function Xoe(t){let{matchUp:e,expectedScore:i}=t;if(!e)return{isValid:!1,errors:["No matchUp provided"],warnings:[],actual:{sets:[],scoreString:""},expected:{sets:i?.sets,scoreString:i?.scoreString},pointsProcessed:0,pointsRejected:0};let r=[],n=[],a=nd({matchUpFormat:e?.matchUpFormat,matchUpId:e?.matchUpId,participants:e?.sides?.map(c=>c.participant).filter(c=>c!==void 0)}),s=e?.history?.points||[];s.length===0&&n.push("No points found to validate");let o=0,l=0;for(let c of s)try{a=bp(a,{winner:c.winner,server:c.server}),o++}catch(d){l++;let p=d instanceof Error?d.message:String(d);r.push(`Point ${c.pointNumber||o+1}: ${p}`)}let u=Cd(a);return i&&(i.sets&&(u.sets.length!==i.sets.length&&r.push(`Set count mismatch: expected ${i.sets.length}, got ${u.sets.length}`),i.sets.forEach((c,d)=>{let p=u.sets[d];if(!p){r.push(`Missing set ${d+1}`);return}c.side1Score!==void 0&&p.side1Score!==c.side1Score&&r.push(`Set ${d+1} side1Score: expected ${c.side1Score}, got ${p.side1Score}`),c.side2Score!==void 0&&p.side2Score!==c.side2Score&&r.push(`Set ${d+1} side2Score: expected ${c.side2Score}, got ${p.side2Score}`),c.side1TiebreakScore!==void 0&&p.side1TiebreakScore!==c.side1TiebreakScore&&r.push(`Set ${d+1} side1TiebreakScore: expected ${c.side1TiebreakScore}, got ${p.side1TiebreakScore}`),c.side2TiebreakScore!==void 0&&p.side2TiebreakScore!==c.side2TiebreakScore&&r.push(`Set ${d+1} side2TiebreakScore: expected ${c.side2TiebreakScore}, got ${p.side2TiebreakScore}`)})),i.scoreString&&u.scoreString!==i.scoreString&&r.push(`Score string mismatch: expected "${i.scoreString}", got "${u.scoreString}"`)),{isValid:r.length===0,errors:r,warnings:n,actual:{sets:u.sets,scoreString:u.scoreString},expected:{sets:i?.sets,scoreString:i?.scoreString},pointsProcessed:o,pointsRejected:l}}function Sje(t){let e=t?.side1Score||0,i=t?.side2Score||0;if(t?.side1TiebreakScore!==void 0||t?.side2TiebreakScore!==void 0){let r=t?.side1TiebreakScore||0,n=t?.side2TiebreakScore||0;return e>i?`${e}-${i}(${n})`:`${e}(${r})-${i}`}return`${e}-${i}`}function Uje(t){let{points:e,matchUpFormat:i,expectedGames:r,expectedTiebreak:n}=t,a={matchUpId:"validation",matchUpFormat:i,matchUpStatus:"TO_BE_PLAYED",matchUpType:"SINGLES",sides:[{sideNumber:1},{sideNumber:2}],score:{sets:[]},history:{points:e?.map((s,o)=>({...s,pointNumber:o+1,timestamp:"",winner:s.winner,server:s.server}))}};return Xoe({matchUp:a,expectedScore:{sets:[{side1Score:r?.[0],side2Score:r?.[1],side1TiebreakScore:n?.[0],side2TiebreakScore:n?.[1]}]}})}function Tje(t){let{points:e,expectedScore:i,matchUpFormat:r,allowExtraPoints:n=!1,debug:a=!1}=t,s=[],o=[],l=[],u,c=!1;r?u=r:i?(u=RN(i),c=!0,a&&console.log(`Deduced format: ${u} from score: ${i}`)):(u="SET3-S:6/TB7",c=!0,o.push("No format provided, using default SET3-S:6/TB7"));let d=nd({matchUpFormat:u}),p=e?.split("").map(v=>{let w=Number.parseInt(v,10);return Number.isNaN(w)||w!==0&&w!==1?null:w}).filter(v=>v!==null);if(p?.length===0)return s.push("No valid points found in point string"),{valid:!1,errors:s,warnings:o,pointsProcessed:0,pointsRejected:[],actualScore:"0-0",matchUpFormat:u,formatDeduced:c,sets:[]};let f=0;for(let v=0;v<p?.length;v++){let w=p[v];if(d.matchUpStatus==="COMPLETED"&&!n){l.push(w),a&&console.log(`Point ${v+1}: Rejected (match complete)`);continue}try{if(d=bp(d,{winner:w}),f++,a){let y=Cd(d);console.log(`Point ${v+1}: ${w} â ${y.scoreString}`)}}catch(y){l.push(w);let b=y instanceof Error?y.message:String(y);s.push(`Point ${v+1}: ${b}`),a&&console.log(`Point ${v+1}: Error - ${b}`)}}let m=Cd(d),h=m.scoreString,g=m.sets.map(v=>{let w=[v.side1Score||0,v.side2Score||0],y=v.side1TiebreakScore===void 0?void 0:[v.side1TiebreakScore,v.side2TiebreakScore||0],b=`${w[0]}-${w[1]}`;return y&&(b=w[0]>w[1]?`${w[0]}-${w[1]}(${y[1]})`:`${w[0]}(${y[0]})-${w[1]}`),{games:w,tiebreak:y,scoreString:b}}),I=!0;if(i){let v=Tq(i),w=Tq(h);v!==w&&(I=!1,s.push(`Score mismatch: expected "${i}", got "${h}"`))}return l.length>0&&o.push(`${l.length} excess points after match complete`),s.length>0&&(I=!1),{valid:I,errors:s,warnings:o,pointsProcessed:f,pointsRejected:l,expectedScore:i,actualScore:h,matchUpFormat:u,formatDeduced:c,sets:g}}function Tq(t){return t.replace(/\s+/g,"").replace(/,/g,", ").toLowerCase()}var Dje={4:"Wide",5:"Body",6:"T"},Joe={f:"Forehand",r:"Forehand Slice",v:"Forehand Volley",o:"Overhead Smash",u:"Forehand Drop Shot",l:"Forehand Lob",h:"Forehand Half-volley",j:"Forehand Drive Volley"},Qoe={b:"Backhand",s:"Backhand Slice",z:"Backhand Volley",p:"Backhand Overhead Smash",y:"Backhand Drop Shot",m:"Backhand Lob",i:"Backhand Half-volley",k:"Backhand Drive Volley"},Pje={t:"Trick Shot",q:"Unknown Shot"},Eje={...Joe,...Qoe,...Pje},Rje={7:"shallow",8:"deep",9:"very deep"},Cje={1:1,2:2,3:3},Mje={"+":"approach","-":"net","=":"baseline"},$f={n:"Net",w:"Out Wide",d:"Out Long",x:"Out Wide and Long",g:"Foot Fault",e:"Unknown","!":"Shank"};function Nje(t,e){return t.PtWinner===t.Svr?e:1-e}function Zoe(t){let e=[],i="",r="fbrsvzouymlhijkpqt";for(let n=0;n<t.length;n++){let a=t[n];a&&(r.includes(a)||"456".includes(a)?(i&&e.push(i),i=a):i+=a)}return i&&e.push(i),e}function Aje(t){if(t.includes("*"))return"*";if(t.includes("#"))return"#";if(t.includes("@"))return"@"}function Ll(t){if(t){for(let e of Object.keys($f))if(t.includes(e))return e}}function kje(t){let e=[];for(let i of t){if(!i)continue;let r=i[0];if(r&&/[456]/.test(r))e.push(i);else break}return e}function ele(t){if(!ni(t))return{serves:[],rally:[]};let e,i,r,n=t.split("c").length-1;t=t.split("c").join("");let a=Zoe(t),s=a;for(let c=a.length-1;c>=0;c--){let d=a[c];if(d&&(i=Aje(d),i)){s=a.slice(0,c+1),r=a.slice(c+1),e=d;break}}let o=kje(s),l=o.length?s.slice(o.length):s;if(!i&&!o.length&&l.length===1){let c=l[0];c&&["S","P","Q","R"].includes(c)&&(e=c,l.length=0)}let u={serves:o,rally:l};return n&&(u.lets=n),i&&(u.terminator=i),e&&(u.result=e),r?.length,u}function tle(t){let e=t.join("|"),i=Gx(t[0],1);if(i.winner==="S"||!t[1])return i.serve=1,i.code=e,i;let r=Gx(t[1],2);return r.serve=2,r.first_serve={serves:i.serves},i.lets&&(r.first_serve.lets=i.lets),i.error&&(r.first_serve.error=i.error),i.parse_notes&&(r.first_serve.parse_notes=i.parse_notes),r.code=e,r}function Gx(t,e){let i=ele(t);if(["Q","S"].includes(i.result||""))return i.winner="S",i;if(["P","R"].includes(i.result||"")||!i.terminator&&!Ll(i.serves[0])&&i.serves.length>2)return i.winner="R",i;let r=(i.serves.length+i.rally.length)%2===0?"R":"S",n;if(i.rally.length>0?n=i.rally[i.rally.length-1]:i.serves.length>0&&(n=i.serves[i.serves.length-1]),!n)return{...i,winner:void 0};if(!i.rally.length){if(i.terminator==="*")i.result="Ace",i.winner="S";else if(i.terminator==="#")i.result="Serve Winner",i.winner="S";else{let a=Ll(i.serves[0]);a?(i.error=$f[a],e===2&&(i.result="Double Fault",i.winner="R")):(i.parse_notes="treated as a fault",e===2&&(i.result="Double Fault",i.winner="R"))}return i}if(i.rally.length===1&&n.includes("#")){i.result="Serve Winner",i.winner="S";let a=Ll(n);return a&&(i.error=$f[a]),i}return n.includes("#")?(i.result="Forced Error",i.error=$f[Ll(n)],i.winner=r==="R"?"S":"R"):n.includes("*")?(i.result="Winner",i.winner=r):n.includes("@")?(i.result="Unforced Error",i.error=$f[Ll(n)],i.winner=r==="R"?"S":"R"):Ll(i.serves[0])?i.rally.length===1&&Ll(n)&&(i.error=$f[Ll(n)],i.winner=r==="R"?"S":"R"):i.serves.length&&i.rally.length?(i.parse_notes="no terminator: receiver wins point",i.result="Unknown",i.winner="R"):i.rally.length===1&&Ll(n)&&(i.error=$f[Ll(n)],i.winner=r==="R"?"S":"R"),i}function Hx(t){if(t)for(let e of t){let i=Eje[e];if(i)return i}}function Oje(t){if(t)for(let e of t){let i=Dje[e];if(i)return i}}function xje(t,e,i){let r=[],n=1,a=i;if(t.length>0&&!Ll(t[t.length-1])){let s=t[t.length-1],o=Hx(s)||"Forehand";r.push({shotNumber:n++,player:a,stroke:o,code:s}),a=1-a}for(let s of e){let o=Hx(s);if(!o)continue;let l={shotNumber:n++,player:a,stroke:o,code:s};for(let u of s){let c=Cje[u];c!==void 0&&(l.direction=c)}for(let u of s){let c=Rje[u];c&&(l.depth=c)}for(let u of s){let c=Mje[u];c&&(l.position=c)}r.push(l),a=1-a}return r}function ile(t,e){let i=Nje(t,e),r=t["1st"]||"",n=t["2nd"]||"";if(!r&&!n)return{winner:i,server:e,result:"Unknown"};let a=tle([r,n]),s={winner:i,server:e};a.result&&(s.result=a.result),a.serve&&(s.serve=a.serve);let o=a.serve===1?r:n,l=Oje(o);l&&(s.serveLocation=l);let u=a.rally[a.rally.length-1];if(u){let d=Hx(u);d&&(s.stroke=d,Object.values(Joe).includes(d)?s.hand="Forehand":Object.values(Qoe).includes(d)&&(s.hand="Backhand"))}let c=xje(a.serves,a.rally,e);return c.length>0&&(s.rally=c,s.rallyLength=c.length),a.code&&(s.code=a.code),s}function rle(t){if(!t||!ni(t))return[];let e=t.trim().split(`
`);if(e.length<2)return[];let i=e[0]?.split(",")||[],r=[];for(let n=1;n<e.length;n++){let a=e[n];if(!a)continue;let s=a.split(","),o={};for(let l=0;l<i.length;l++){let u=i[l];u&&(o[u]=s[l]||"")}r.push(o)}return r}function nle(t){if(!Array.isArray(t))return[];let e=new Map;for(let i of t){let r=i.match_id;e.has(r)||e.set(r,[]),e.get(r).push(i)}return Array.from(e.entries()).map(([i,r])=>({match_id:i,points:r}))}function Fje(t){let e=t?.split("-")||[];if(e.length<6)return{player1:"Player 1",player2:"Player 2"};let i=e[0],r=e[2]?.replace(/_/g," "),n=e[4]?.replace(/_/g," ")||"Player 1",a=e[5]?.replace(/_/g," ")||"Player 2";return{player1:n,player2:a,date:i,tournament:r}}function Lje(t){if(!t||t.length===0)return;let e=t.at(-1);if(!e)return;let i=e.Set1,r=e.Set2,n=e.Set3,a=e.Set4,s=e.Set5,o=[];return i&&o.push(`${i}-${r}`),n&&o.push(`${n}-${r||"0"}`),a&&o.push(`${a}-${r||"0"}`),s&&o.push(`${s}-${r||"0"}`),o.length>0?o.join(", "):void 0}function ale(t,e={}){let{matchUpFormat:i,validateScore:r=!0,debug:n=!1}=e,a=[],s=[],o=Fje(t.match_id),l=Lje(t.points),u,c=!1;i?u=i:l?(u=RN(l),c=!0,n&&console.log(`Deduced format: ${u} from score: ${l}`)):(u="SET3-S:6/TB7",c=!0,s.push("No format provided, using default SET3-S:6/TB7")),n&&(console.log(`Validating match: ${o.player1} vs ${o.player2}`),console.log(`Format: ${u}`),console.log(`Total points: ${t.points.length}`),l&&console.log(`Expected score: ${l}`));let d=nd({matchUpFormat:u,matchUpId:t.match_id});d.sides[0]&&(d.sides[0].participant={participantId:"player1",participantName:o.player1,participantType:"INDIVIDUAL",participantRole:"COMPETITOR"}),d.sides[1]&&(d.sides[1].participant={participantId:"player2",participantName:o.player2,participantType:"INDIVIDUAL",participantRole:"COMPETITOR"});let p=0,f=0,m=0,h=0,g=0,I,v=0;for(let S=0;S<t.points?.length;S++){let U=t.points[S];if(U){I=U.Svr==="1"?0:1;try{let T=ile(U,I),P={winner:T.winner,server:T.server};if(d=bp(d,P),d.history?.points&&d.history.points.length>0){let D=d.history.points[d.history.points.length-1];D&&(T.result&&(D.result=T.result),T.stroke&&(D.stroke=T.stroke),T.hand&&(D.hand=T.hand),T.serve&&(D.serve=T.serve),T.serveLocation&&(D.serveLocation=T.serveLocation),T.rally&&(D.rally=T.rally),T.rallyLength&&(D.rallyLength=T.rallyLength),T.code&&(D.code=T.code))}if(v++,T.result==="Ace"&&p++,T.result==="Double Fault"&&f++,T.result==="Winner"&&m++,T.result==="Unforced Error"&&h++,T.result==="Forced Error"&&g++,n&&(S<5||S===t.points.length-1)){let D=Cd(d);console.log(`Point ${S+1}: ${T.result||"Rally"} â ${D.scoreString}`)}}catch(T){let P=T instanceof Error?T.message:String(T);a.push(`Point ${S+1}: ${P}`),n&&console.error(`Point ${S+1} failed:`,P)}}}let w=Cd(d).scoreString,y=d.matchUpStatus==="COMPLETED";y||s.push(`Match not complete. Final score: ${w}`);let b;if(r&&l){let S=Dq(l),U=Dq(w);b=S===U,b||a.push(`Score mismatch: expected "${l}", got "${w}"`),n&&(console.log(`Expected: ${l} â ${S}`),console.log(`Actual: ${w} â ${U}`),console.log(`Score matches: ${b}`))}return n&&(console.log(`Final score: ${w}`),console.log(`Match complete: ${y}`),console.log(`Stats: ${p} aces, ${f} DFs, ${m} winners, ${h} UEs, ${g} FEs`)),{valid:a.length===0,errors:a,warnings:s,matchUp:d,pointsProcessed:v,expectedScore:l,actualScore:w,scoreMatches:b,formatDeduced:c,aces:p,doubleFaults:f,winners:m,unforcedErrors:h,forcedErrors:g}}function Dq(t){return t.replace(/\s+/g,"").replace(/,/g,", ").toLowerCase()}function _je(t){let{csvData:e,matchId:i,matchUpFormat:r,debug:n=!1}=t,a=[],s=[],o=[],l;try{l=rle(e)}catch(I){let v=I instanceof Error?I.message:String(I);return a.push(`Failed to parse CSV: ${v}`),{valid:!1,errors:a,warnings:s,matchesProcessed:0,pointsProcessed:0,matchUps:[],totalAces:0,totalDoubleFaults:0,totalWinners:0,totalUnforcedErrors:0,totalForcedErrors:0}}let u=nle(l);n&&console.log(`Parsed ${l.length} points from ${u.length} matches`);let c=i?u.filter(I=>I.match_id===i):u;if(c.length===0)return a.push(i?`Match ID not found: ${i}`:"No matches found in CSV data"),{valid:!1,errors:a,warnings:s,matchesProcessed:0,pointsProcessed:0,matchUps:[],totalAces:0,totalDoubleFaults:0,totalWinners:0,totalUnforcedErrors:0,totalForcedErrors:0};let d=0,p=0,f=0,m=0,h=0,g=0;for(let I of c){let v=ale(I,{matchUpFormat:r,debug:n});v.valid||a.push(...v.errors),s.push(...v.warnings),o.push(v.matchUp),d+=v.pointsProcessed,p+=v.aces,f+=v.doubleFaults,m+=v.winners,h+=v.unforcedErrors,g+=v.forcedErrors}return{valid:a.length===0,errors:a,warnings:s,matchesProcessed:c.length,pointsProcessed:d,matchUps:o,totalAces:p,totalDoubleFaults:f,totalWinners:m,totalUnforcedErrors:h,totalForcedErrors:g}}function $je(t){return JSON.stringify(t,null,2)}function Bje(t){let{existingDrawDefinition:e,hydrateCollections:i,enforceGender:r,tieFormatName:n,matchUpType:a,eventType:s,isMock:o,event:l}=t,{tieFormat:u,matchUpFormat:c}=t;if(a===ar&&s===ar){let d=e?.structures?.find(({stage:p})=>p===Ae)?.tieFormat;u=u||d||n&&l?.tieFormat?.tieFormatName===n&&l.tieFormat||n&&yc({namedFormat:n,hydrateCollections:i,isMock:o,event:l})||l?.tieFormat||yc({event:l,isMock:o,hydrateCollections:i}),c=void 0}else c||(u=void 0,l?.matchUpFormat||(c=Vs));if(u){let d=Gn({gender:l?.gender,enforceGender:r,tieFormat:u});if(d.error)return d}return{tieFormat:u,matchUpFormat:c}}function Vje(t){let e=t.drawDefinition,{existingQualifyingPlaceholderStructureId:i,appliedPolicies:r,qualifyingOnly:n,drawEntries:a,structureId:s,tieFormat:o,idPrefix:l,isMock:u,event:c}=t,d=t.qualifyingProfiles,p=d?.length?noe({hasExistingDrawDefinition:!0,uuids:t.uuids,qualifyingProfiles:d,appliedPolicies:r,qualifyingOnly:n,tieFormat:o,idPrefix:l,isMock:u}):void 0;if(p?.error)return p;e.structures=e.structures?.filter(({structureId:b})=>b!==i),e.links=e.links?.filter(({source:b})=>b.structureId!==i);let{qualifiersCount:f,qualifyingDrawPositionsCount:m,qualifyingDetails:h}=p??{};m&&(p?.structures&&e.structures?.push(...p.structures),p?.links&&e.links?.push(...p.links));let g=e.structures?.find(({stage:b,stageSequence:S})=>b===Ae&&S===1),{qualifiersCount:I}=Hv({stageSequence:1,drawDefinition:e,structureId:s,stage:Ae}),v=Math.max(f??0,I??0),w=lse({qualifiersCount:v,drawDefinition:e,stage:Ae});if(w.error||(w=XP({drawSize:m,stage:ze,drawDefinition:e}),w.error))return w;jje({drawDefinition:e,drawEntries:a,event:c});let y=Gje({mainStructure:g,qualifyingDetails:h,drawDefinition:e});return y.error?y:{drawDefinition:e,structureId:s}}function jje({drawDefinition:t,drawEntries:e,event:i}){for(let r of(e??[]).filter(({entryStage:n})=>n===ze)){let n={...r,entryStage:r.entryStage??Ae,drawDefinition:t,event:i};x2(n)}}function Gje({mainStructure:t,qualifyingDetails:e,drawDefinition:i}){for(let r of e||[]){let{finalQualifyingRoundNumber:n,finalQualifyingStructureId:a,roundTarget:s,finishingPositions:o,linkType:l}=r,u=t&&BU({targetStructureId:t.structureId,sourceStructureId:a,sourceRoundNumber:n,finishingPositions:o,targetEntryRound:s,linkType:l})?.link;if(u?.error)return u;u&&(i.links||(i.links=[]),i.links.push(u))}return{error:void 0}}function sle(t){let{participantIds:e}=t,i=t.drawDefinition?.entries?.filter(r=>{let n=r.entryStatus;return!t.restrictEntryStatus||uo.includes(n)}).map(yt)??[];if(e){let r=e.filter(n=>!i?.includes(n));if(r?.length)return q({result:{error:Co},info:{invalidParticipantIds:r}})}else e=i;return t.roundsCount&&t.restrictRoundsCount!==!1&&t.roundsCount>e.length-1&&(!t.enableDoubleRobin||t.roundsCount>(e.length-1)*2)?{error:re,info:"Not enough participants for roundsCount"}:t.roundsCount&&t.restrictRoundsCount!==!1&&t.roundsCount>31?{error:re,info:"roundsCount must be less than 32"}:{participantIds:e}}function XV(t){let e=[],{roundsCount:i=1,drawDefinition:r,matchUpsCount:n,structureId:a,idPrefix:s,isMock:o,event:l}=t,u,c=sle(t);if(c.error)return c;for(let d of Ce(1,i+1)){let p=gN({restrictMatchUpsCount:t.restrictMatchUpsCount,ignoreLastRoundNumber:!!u,newRound:!u,drawDefinition:r,matchUpsCount:n,structureId:a,roundNumber:u,idPrefix:s,isMock:o,event:l});if(p.error)return q({result:p,info:{iteration:d}});p.matchUps?.length&&e.push(...p.matchUps),u=(p?.roundNumber??1)+1}return{matchUps:e}}function Hje(t){let{tournamentRecord:e,participantIds:i,scaleName:r,eventType:n,adHocRatings:a={}}=t,s=t.scaleAccessor??Dr[r]?.accessor,o=e.participants??[];for(let l of i??[]){let u=o?.find(d=>d.participantId===l),c=Pq({scaleName:`${r}.${GB}`,participant:u,eventType:n});!c&&r&&(c=Pq({scaleAccessor:s,participant:u,scaleName:r,eventType:n})),c&&!a[l]&&(a[l]=c)}return a}function Pq({scaleType:t=ld,scaleAccessor:e,participant:i,scaleName:r,eventType:n}){let a=(i&&Xl({scaleAttributes:{eventType:n??$m,scaleType:t,scaleName:r},participant:i}))?.scaleItem?.scaleValue;return e&&wt(a)?a[e]:a}function JV(t){let e=zje(t);if(e?.error)return e;let i=sle(t);if(i.error)return i;let r=Wje(t);if(r.error)return r;let n=Hje(t),a=t.tournamentRecord?.isMock??t.isMock,s=t.eventType??t.event?.eventType,o=[],l=[],u;for(let c of Ce(1,(t.roundsCount??1)+1)){let d=EV({...t,participantIds:i.participantIds,structure:r.structure,ignoreLastRoundNumber:!0,iterationMatchUps:o,adHocRatings:n,roundNumber:u,eventType:s,isMock:a});if(d.error)return d;let{matchUps:p,...f}=d;f.modifiedScaleValues&&(n=f.modifiedScaleValues),l.push({...f,iteration:c,matchUpsCount:p?.length}),u=(f?.roundNumber??1)+1,p?.length&&o.push(...p)}return{...W,matchUps:o,roundResults:l}}function Wje(t){if(t.structureId)return t.structureId;let e=t.drawDefinition,i=e?.structures?.filter(n=>n.stageSequence===1)?.reduce((n,a)=>{let s=a.stage&&Bm[a.stage];return Hn({structure:a})&&s>(Bm[n?.stage]||1)?a:n},void 0),r=e?.structures?.find(n=>n.structureId===i?.structureId);return r?Hn({structure:r})?{structure:r}:{error:fm}:{error:vi}}function zje(t){return t.roundsCount&&typeof t.roundsCount!="number"?{error:re,info:"roundsCount must be a number"}:typeof t.drawDefinition!="object"||t.drawDefinition.drawType&&t.drawDefinition.drawType!==la?{error:fm}:!Array.isArray(t.drawDefinition?.entries)&&t.participantIds&&!Array.isArray(t.participantIds)?{error:re,info:"Missing Entries"}:{error:void 0}}function qje(t){let{tournamentRecord:e,drawDefinition:i,structureId:r,idPrefix:n,isMock:a,event:s}=t,o=s?.entries?.filter(({entryStage:c,entryStatus:d})=>(!c||c===Ae)&&d&&uo.includes(d)),l=o?.map(yt),u=o?Math.floor(o.length/2):0;if(t.automated)return Yje({...t,participantIds:l});{let c=XV({roundsCount:t.roundsCount,drawDefinition:i,matchUpsCount:u,idPrefix:n,isMock:a,event:s});if(c.error)return c;c.matchUps?.length&&dN({matchUps:c.matchUps,suppressNotifications:!0,tournamentRecord:e,drawDefinition:i,structureId:r,event:s})}return{...W}}function Yje(t){let{restrictEntryStatus:e,generateMatchUps:i,structureId:r,matchUpIds:n,scaleName:a,scaleAccessor:s}=t.drawMatic??{},o=JV({...t,eventType:t.drawMatic?.eventType??t.matchUpType,generateMatchUps:i??!0,scaleAccessor:s??t.scaleAccessor,scaleName:a??t.scaleName,participantIds:t.participantIds,roundsCount:t.roundsCount,restrictEntryStatus:e,structureId:r,matchUpIds:n});return o.error?o:(o?.matchUps?.length&&dN({tournamentRecord:t.tournamentRecord,drawDefinition:t.drawDefinition,suppressNotifications:!0,matchUps:o.matchUps,event:t.event,structureId:r}),{...W})}function Kje({requireParticipantCount:t=!0,enforcePolicyLimits:e=!0,drawSizeProgression:i,participantsCount:r,participantCount:n,appliedPolicies:a,drawDefinition:s,seedingProfile:o,structureId:l,seedsCount:u}){r=r??n;let c=tt({drawDefinition:s,structureId:l});if(c.error)return c;let d=c.structure;if(!d)return{error:vi};let{positionAssignments:p}=pr({structure:d}),f=p?.length||0;if(u>f)return{error:bte};let m=d.structures?.length,h=lt(o?.groupSeedingThreshold)&&o?.groupSeedingThreshold,g=H2({roundRobinGroupsCount:m,drawSize:f})?.seedGroups,{seedsCount:I}=XU({policyDefinitions:a,requireParticipantCount:t,drawSizeProgression:i,participantsCount:r,drawSize:f});return I&&a?.[Rs]&&u>I&&e&&(u=I),d.seedLimit=u,d.seedAssignments=Ce(1,u+1).map(v=>{let w=g?.find(S=>S.includes(v)),y=w&&Math.min(...w),b=h&&v>=h?y:v;return{participantId:void 0,seedNumber:v,seedValue:b}}),ii({drawDefinition:s,structureIds:[l]}),{...W,seedLimit:u}}function Zh({sortDescending:t=!1,tournamentRecord:e,scaleAttributes:i,scaleSortMethod:r,stageSequence:n,entries:a,event:s,stage:o}){if(!e)return{error:ve};a=a??s?.entries??[];let l=a.filter(f=>(!o||!f.entryStage||f.entryStage===o)&&(!n||!f.entryStageSequence||f.entryStageSequence===n)&&uo.includes(f.entryStatus)),u={...i};return{scaledEntries:l.map(f=>{let{participantId:m}=f,{scaleItem:h}=Wm({tournamentRecord:e,scaleAttributes:i,participantId:m});return{...f,...h}}).filter(f=>{let m=f.scaleValue;return!r&&(Number.isNaN(m)||!Number.parseFloat(m))?!1:m}).sort(r||(t||u?.ascending===!1?d:c))};function c(f,m){return p(f)-p(m)}function d(f,m){return p(m)-p(f)}function p(f){return Number.parseFloat(f.scaleValue||(t?-1:1e5))}}function ole(t){let e="prepareStage",{drawDefinition:i}=t,{structures:r}=io({stageSequence:t.stageSequence||1,roundTarget:t.roundTarget,stage:t.stage,drawDefinition:i}),n=t.preparedStructureIds||[],a=r?.find(({structureId:f})=>!n.includes(f));if(!a)return q({result:{error:vi},stack:e});let s=a?.structureId,{seedsCount:o,stageEntries:l,seedLimit:u}=rGe({...t,structureId:s});(t.seededParticipants||t.event||t.seedingScaleName)&&Qje({...t,seedsCount:o,structure:a,structureId:s});let c=t.automated!==!1&&t.drawType!==la&&!(t.qualifyingOnly&&t.stage!==ze),d=(r?.length||0)>1,p=c?Jje({...t,multipleStructures:d,seedLimit:u,structureId:s}):{};return p?.error?q({result:p,stack:e}):{...p,stageEntries:l,structureId:s,seedsCount:o}}function Xje({entries:t,stage:e,stageSequence:i,roundTarget:r}){return t.filter(n=>{let a=ht({name:El,element:n})?.extension?.value;return(!n.entryStage||n.entryStage===e)&&(!i||!n.entryStageSequence||n.entryStageSequence===i)&&(!r||!a||a===r)&&Sf.includes(n.entryStatus)})}function Jje(t){let e=typeof t.automated=="object"&&t.automated.seedsOnly,i=$U({...t,seedsOnly:e});if(i.error)return i;let r=i?.positionAssignments,n=i?.positioningReport;return{conflicts:i.conflicts,positionAssignments:r,positioningReport:n}}function Qje(t){let{seededParticipants:e,seedingScaleName:i,entries:r,event:n}=t,a=r.map(yt);e?Zje({...t,enteredParticipantIds:a}):(n||i)&&eGe({...t,enteredParticipantIds:a})}function Zje(t){let{provisionalPositioning:e,enteredParticipantIds:i,seededParticipants:r,tournamentRecord:n,appliedPolicies:a,drawDefinition:s,seedingProfile:o,structureId:l,structure:u,event:c}=t,d=u?Yh({provisionalPositioning:e,appliedPolicies:a,drawDefinition:s,seedingProfile:o,structure:u}):void 0;r.filter(({participantId:p})=>i.includes(p)).filter(p=>!p.seedNumber||p.seedNumber<=r.length).sort((p,f)=>p.seedNumber<f.seedNumber?-1:p.seedNumber<f.seedNumber?1:0).forEach(p=>{let{participantId:f,seedNumber:m,seedValue:h}=p;zv({provisionalPositioning:e,tournamentRecord:n,drawDefinition:s,seedingProfile:o,participantId:f,seedBlockInfo:d,structureId:l,seedNumber:m,seedValue:h,event:c})})}function eGe(t){let e=t.seedsCount,{provisionalPositioning:i,enteredParticipantIds:r,seedAssignmentProfile:n,assignSeedsCount:a,tournamentRecord:s,drawDefinition:o,seedByRanking:l,seedingProfile:u,structureId:c,event:d}=t,{categoryName:p,ageCategoryCode:f}=d?.category||{};d?.eventType;let m=tGe({...t})||l&&iGe({...t}),h=m?.length??0;h<e&&(e=h),m?.filter(({participantId:g})=>r.includes(g)).slice(0,a||e).forEach((g,I)=>{let v=I+1,{participantId:w,scaleValue:y}=g,b=n?.[v]||y||v;zv({provisionalPositioning:i,tournamentRecord:s,drawDefinition:o,seedingProfile:u,participantId:w,structureId:c,seedNumber:v,seedValue:b,event:d})})}function tGe(t){let{tournamentRecord:e,seedingScaleName:i,stageSequence:r,entries:n,stage:a,event:s}=t,{categoryName:o,ageCategoryCode:l}=s?.category||{},u=s?.eventType,c={scaleName:i||o||l||s.eventId,scaleType:Yl,eventType:u};return Zh({scaleAttributes:c,tournamentRecord:e,stageSequence:r,entries:n,stage:a}).scaledEntries}function iGe(t){let{tournamentRecord:e,stageSequence:i,event:r,entries:n,stage:a}=t,{categoryName:s,ageCategoryCode:o}=r?.category||{},l=r?.eventType;return Zh({scaleAttributes:{scaleName:s||o,scaleType:vu,eventType:l},tournamentRecord:e,stageSequence:i,entries:n,stage:a}).scaledEntries}function rGe(t){let{seedsCount:e}=t;t.seededParticipants&&(e=t.seededParticipants.length),e>t.drawSize&&(e=t.drawSize);let i=Xje(t);e>i.length&&(e=i.length);let{seedLimit:r}=Kje({enforcePolicyLimits:t.enforcePolicyLimits??!0,appliedPolicies:t.appliedPolicies,participantsCount:i.length,seedingProfile:t.seedingProfile,drawDefinition:t.drawDefinition,structureId:t.structureId,seedsCount:e});return r&&r<e&&(e=r),{seedsCount:e,stageEntries:i,seedLimit:r}}function nGe(t){let e=DV({...t,modifyOriginal:!1});if(e.error)return e;let i=e.drawDefinition,{suppressDuplicateEntries:r=!0,ignoreStageSpace:n,appliedPolicies:a,qualifyingOnly:s,seedingProfile:o,participants:l,drawEntries:u,placeByes:c,drawSize:d,drawType:p,entries:f}=t,m=[],h=[],g=aGe({ignoreStageSpace:n,drawDefinition:i,drawEntries:u,drawType:p,entries:f});if(g.error)return g;let I=p===If?0:Ke(t.seedsCount??0),v=ole({...t,qualifyingOnly:!d||s,appliedPolicies:a,drawDefinition:i,seedingProfile:o,participants:l,stage:Ae,seedsCount:I,placeByes:c,drawSize:d,entries:f});if(v.error&&!v.conflicts)return v;v.positioningReport?.length&&m.push({[Ae]:v.positioningReport});let w=v.structureId;return v.conflicts&&(h=v.conflicts),p===la&&t.roundsCount&&qje({...t,drawDefinition:i,structureId:w}),{drawDefinition:i,positioningReports:m,conflicts:h,structureId:w}}function aGe(t){let{ignoreStageSpace:e,drawDefinition:i,drawEntries:r,drawType:n,entries:a}=t;for(let s of a){if(r&&s.entryStage&&s.entryStage!==Ae)continue;let o={...s,ignoreStageSpace:e??n===la,entryStage:s.entryStage??Ae,event:t.event,drawDefinition:i,drawType:n},l=x2(o);if(r&&l.error)return l}return{error:void 0}}var sGe=()=>({matchUpType:void 0,drawName:void 0,drawId:void 0,structures:[],entries:[],links:[]}),oGe=sGe;function lGe(t){let{drawId:e=Ct(),processCodes:i,matchUpType:r,drawType:n}=t??{},a=oGe();return Object.assign(a,{processCodes:i,matchUpType:r,drawType:n,drawId:e})}function QV(t){let e=t.structureIds,{tournamentRecord:i,drawDefinition:r,matchUpFormat:n,structureId:a,matchUpId:s,event:o}=t,l=He(t,[{[In]:!0,[LB]:!0}]);if(l.error)return l;if(!$a({matchUpFormat:n}))return{error:QS};let u="setMatchUpFormat";if(s){let c=fi({drawDefinition:r,matchUpId:s,event:o});if(c.error)return c;let d=c.matchUp;if(d?.matchUpType===ar)return{info:"Cannot set matchUpFormat when { matchUpType: TEAM }",error:sa};d&&(d.matchUpFormat=n,Ut({tournamentId:i?.tournamentId,eventId:o?.eventId,context:u,drawDefinition:r,matchUp:d}))}else if(Array.isArray(e)){if(o?.eventType===ar)return{error:cu};for(let c of e){let d=tt({drawDefinition:r,structureId:c});if(d.error)return d;d.structure&&(d.structure.matchUpFormat=n)}}else if(a){if(o?.eventType===ar)return{error:cu};let c=tt({drawDefinition:r,structureId:a});if(c.error)return c;c.structure&&(c.structure.matchUpFormat=n)}else r&&(r.matchUpFormat=n);return e=e??(a?[a]:void 0),ii({drawDefinition:r,structureIds:e}),{...W}}function uGe({tieFormat:t}){let e=Gn({checkCollectionIds:!1,tieFormat:t});if(e.error)return e;for(let i of t.collectionDefinitions)i.collectionId||(i.collectionId=Ct());return{tieFormat:t}}function cGe({existingQualifyingStructures:t,tournamentRecord:e,drawDefinition:i,matchUpFormat:r,matchUpType:n,tieFormat:a,event:s}){if((r||a)&&!(r&&s?.matchUpFormat===r||s?.tieFormat&&a&&JSON.stringify(s.tieFormat)===JSON.stringify(a))){if(a){let o=uGe({tieFormat:a});if(o.error)return o;let l=t?.every(u=>u.tieFormat);(!t?.length||l)&&(i.tieFormat=o.tieFormat??a)}else if(r){let o=QV({tournamentRecord:e,drawDefinition:i,matchUpFormat:r,event:s});if(o.error)return{info:"matchUpFormat or tieFormat error",error:o.error}}n&&(i.matchUpType=n)}return{error:void 0}}var lle={};dt(lle,{attachPolicies:()=>qp,findPolicy:()=>bf,getAppliedPolicies:()=>Dt,getPolicyDefinitions:()=>jc,mutate:()=>ule,query:()=>dle,removePolicy:()=>cle});var ule={};dt(ule,{attachPolicies:()=>qp,removePolicy:()=>cle});function cle(t){let e=He(t,[{[MFe]:!0,_anyOf:{[pn]:!1,[hr]:!1,[In]:!1,[Bc]:!1}}]);if(e.error)return e;let i,r=t.drawDefinition??t.event??((t.tournamentId||!t.tournamentRecords)&&t.tournamentRecord);if(r)return Eq(t,r);if(t.tournamentRecords){let n=Object.keys(t.tournamentRecords);if(!n.length)return{error:ve};for(let a of n){let s=t.tournamentRecords[a],o=Eq(t,s);if(o.error)return o;i=!0}}else return{error:ve};return i?{...W}:{error:ZS}}function Eq(t,e){let i=Dt(t).appliedPolicies??{};return i[t.policyType]?(delete i[t.policyType],Object.keys(i).length?Ft({element:e,extension:{name:Jb,value:i}}):Nn({element:e,name:Jb}),{...W}):{error:ZS}}var dle={};dt(dle,{findPolicy:()=>bf,getAppliedPolicies:()=>Dt,getPolicyDefinitions:()=>jc});var ple={[Rs]:{validSeedPositions:{ignore:!0},duplicateSeedNumbers:!0,drawSizeProgression:!0,seedingProfile:{drawTypes:{[gu]:{positioning:Bp},[eo]:{positioning:Bp}},positioning:xre},policyName:"USTA SEEDING",seedsCountThresholds:[{drawSize:4,minimumParticipantCount:3,seedsCount:2},{drawSize:16,minimumParticipantCount:12,seedsCount:4},{drawSize:32,minimumParticipantCount:24,seedsCount:8},{drawSize:64,minimumParticipantCount:48,seedsCount:16},{drawSize:128,minimumParticipantCount:96,seedsCount:32},{drawSize:256,minimumParticipantCount:192,seedsCount:64}]}},Wx=ple;function dGe({appliedPolicies:t,policyDefinitions:e,drawDefinition:i,stack:r}){if(e&&typeof e!="object")return q({info:"policyDefinitions must be an object",result:{error:re},stack:r});let n={[Xb]:t?.[Xb]};return e?pGe({policyDefinitions:e,appliedPolicies:t,policiesToAttach:n,drawDefinition:i}):n.avoidance&&qp({drawDefinition:i,policyDefinitions:n}),!t?.[Rs]&&!e?.[Rs]&&(qp({policyDefinitions:Wx,drawDefinition:i}),t&&Object.assign(t,Wx)),{error:void 0}}function pGe({policyDefinitions:t,appliedPolicies:e,policiesToAttach:i,drawDefinition:r}){for(let n of Object.keys(t))JSON.stringify(e?.[n])!==JSON.stringify(t[n])&&(i[n]=t[n]);Object.keys(i).length&&(qp({policyDefinitions:i,drawDefinition:r}),e&&Object.assign(e,i))}function fGe(t){let{tournamentRecord:e,policyDefinitions:i,appliedPolicies:r,matchUpFormat:n,matchUpType:a,tieFormat:s,drawType:o,stack:l,event:u}=t,c=t.drawId?u?.drawDefinitions?.find(I=>I.drawId===t.drawId):void 0,d=c?.structures?.find(I=>I.stage===Ae&&I.stageSequence===1)?.structureId,p=c?c.structures?.filter(I=>I.stage===ze):[],f=p?.length===1&&!p[0].matchUps?.length&&p[0].structureId;c&&o!==c.drawType&&(c.drawType=o);let m=c??lGe({processCodes:t.processCodes,drawId:t.drawId,drawType:o}),h=cGe({existingQualifyingStructures:p,tournamentRecord:e,drawDefinition:m,matchUpFormat:n,matchUpType:a,tieFormat:s,event:u});if(h.error)return q({result:h,stack:l});let g=dGe({appliedPolicies:r,policyDefinitions:i,drawDefinition:m,stack:l});return g.error?g:{drawDefinition:m,structureId:d,existingDrawDefinition:c,existingQualifyingPlaceholderStructureId:f}}function mGe(t){let e="generateOrGetExisting",i=[],r=[],n=fGe(t);if(n.error)return q({result:n,stack:e});let a=n.existingDrawDefinition,s,o,l=t.drawEntries??t.eventEntries??[],u=n.existingQualifyingPlaceholderStructureId&&Vje({...t,...n})||nGe({...t,...n,entries:l});return u.error?q({result:u,stack:e}):(u.positioningReports?.length&&i.push(...u.positioningReports??[]),u.conflicts?.length&&r.push(...u.conflicts??[]),s=u.drawDefinition,o=u.structureId,{existingDrawDefinition:a,positioningReports:i,drawDefinition:s,structureId:o,conflicts:r,entries:l})}function hGe(t){let{qualifyingPlaceholder:e,existingDrawDefinition:i,positioningReports:r,qualifyingProfiles:n,appliedPolicies:a,qualifyingOnly:s,drawDefinition:o,seedingProfile:l,participants:u,structureId:c,tieFormat:d,entries:p,stack:f}=t,m=e&&!n?.length&&!i,h=[];if(n){let g=(y,b)=>y.stageSequence-b.stageSequence,I=(y,b)=>y.roundTarget-b.roundTarget,v=[],w=1;n.sort(I);for(let y of n){if(!Array.isArray(y.structureProfiles))return q({info:zp("structureProfiles"),result:{error:Je},stack:f});w=y.roundTarget||w;let b=y.structureProfiles?.sort(g)||[],S=1;for(let U of b){let{qualifyingRoundNumber:T,qualifyingPositions:P,seededParticipants:D,seedingScaleName:E,seedsCount:R=0,seedByRanking:C,placeByes:M,drawSize:N}=U,A=ole({...t,seedingProfile:U.seedingProfile??l,stageSequence:S,qualifyingRoundNumber:T,preparedStructureIds:v,qualifyingPositions:P,seededParticipants:D,stage:ze,seedingScaleName:E,appliedPolicies:a,drawDefinition:o,qualifyingOnly:s,seedByRanking:C,participants:u,roundTarget:w,seedsCount:R,placeByes:M,drawSize:N,entries:p});if(A.error)return A;A.structureId&&v.push(A.structureId),S+=1,A.conflicts?.length&&h.push(...A.conflicts),A.positioningReport?.length&&r.push({[ze]:A.positioningReport})}w+=1}}else if(c&&m){let g=ss({structureName:Qr(ze),stage:ze,qualifyingOnly:s,tieFormat:d}),{link:I}=BU({sourceStructureId:g.structureId,targetStructureId:c,sourceRoundNumber:0,linkType:fu});o.structures||(o.structures=[]),o.structures.push(g),o.links||(o.links=[]),o.links.push(I)}return{qualifyingConflicts:h,error:void 0}}var fle={};dt(fle,{addGoesTo:()=>Wp,allCompetitionMatchUps:()=>No,allDrawMatchUps:()=>An,allEventMatchUps:()=>xu,allPlayoffPositionsFilled:()=>J2,allTournamentMatchUps:()=>Ur,analyzeDraws:()=>zU,analyzeMatchUp:()=>lw,analyzeTournament:()=>lj,bulkUpdatePublishedEventIds:()=>pj,calculateWinCriteria:()=>eg,categoryCanContain:()=>nU,checkMatchUpIsComplete:()=>vp,checkValidEntries:()=>hN,compareTieFormats:()=>Rc,competitionScheduleMatchUps:()=>tT,courtGridRows:()=>LN,credits:()=>gGe,drawMatchUps:()=>Pj,eventMatchUps:()=>BN,filterMatchUps:()=>Yu,filterParticipants:()=>OU,findDrawDefinition:()=>yV,findExtension:()=>ht,findVenue:()=>Ou,getAggregateTeamResults:()=>oj,getAllDrawMatchUps:()=>Zi,getAllEventData:()=>fj,getAllStructureMatchUps:()=>At,getAllowedDrawTypes:()=>CN,getAllowedMatchUpFormats:()=>nj,getAppliedPolicies:()=>Dt,getAssignedParticipantIds:()=>Df,getAvailableMatchUpsCount:()=>pN,getAvailablePlayoffProfiles:()=>jU,getCategoryAgeDetails:()=>$p,getCheckedInParticipantIds:()=>Gh,getCompetitionDateRange:()=>NN,getCompetitionMatchUps:()=>ow,getCompetitionParticipants:()=>ZV,getCompetitionPenalties:()=>aj,getCompetitionVenues:()=>qU,getCourtInfo:()=>KM,getCourts:()=>Ej,getDrawData:()=>fN,getDrawDefinitionTimeItem:()=>f2,getDrawParticipantRepresentativeIds:()=>IV,getDrawStructures:()=>io,getDrawTypeCoercion:()=>KU,getEligibleVoluntaryConsolationParticipants:()=>gV,getEntriesAndSeedsCount:()=>_N,getEvent:()=>Mj,getEventData:()=>YU,getEventMatchUpFormatTiming:()=>Ij,getEventProperties:()=>Rj,getEventPublishStatus:()=>Qa,getEventStructures:()=>rN,getEventTimeItem:()=>IU,getEvents:()=>Cj,getFlightProfile:()=>Bi,getHomeParticipantId:()=>wj,getLinkedTournamentIds:()=>fU,getMatchUpCompetitiveProfile:()=>PU,getMatchUpContextIds:()=>Sj,getMatchUpDailyLimits:()=>jN,getMatchUpDailyLimitsUpdate:()=>vj,getMatchUpDependencies:()=>co,getMatchUpFormat:()=>Uj,getMatchUpFormatTiming:()=>EU,getMatchUpFormatTimingUpdate:()=>gj,getMatchUpScheduleDetails:()=>XM,getMatchUpType:()=>JM,getMatchUpsMap:()=>kr,getMatchUpsStats:()=>Tj,getMatchUpsToSchedule:()=>kN,getMaxEntryPosition:()=>hj,getModifiedMatchUpFormatTiming:()=>$N,getPairedParticipant:()=>ro,getParticipantEventDetails:()=>ej,getParticipantIdFinishingPositions:()=>vV,getParticipantMembership:()=>tj,getParticipantResults:()=>AU,getParticipantScaleItem:()=>Wm,getParticipantSchedules:()=>ij,getParticipantSignInStatus:()=>rj,getParticipantTimeItem:()=>m2,getParticipants:()=>Ri,getPersonRequests:()=>Pf,getPolicyDefinitions:()=>jc,getPositionAssignments:()=>AI,getPositionsPlayedOff:()=>Yv,getPredictiveAccuracy:()=>bj,getProfileRounds:()=>FN,getPublishState:()=>zh,getRandomQualifierList:()=>SV,getRoundMatchUps:()=>Sn,getRounds:()=>Dj,getScaleValues:()=>Fv,getScaledEntries:()=>Zh,getScheduledRoundsDetails:()=>QU,getSchedulingProfile:()=>Wc,getSchedulingProfileIssues:()=>mj,getSeedingThresholds:()=>W2,getSeedsCount:()=>XU,getStructureSeedAssignments:()=>hs,getTeamLineUp:()=>Hp,getTieFormat:()=>AN,getTimeItem:()=>Ss,getTournamentIds:()=>dU,getTournamentInfo:()=>Qh,getTournamentPenalties:()=>MN,getTournamentPersons:()=>sj,getTournamentPoints:()=>Xv,getTournamentPublishStatus:()=>kU,getTournamentStructures:()=>X2,getTournamentTimeItem:()=>GM,getValidGroupSizes:()=>LU,getVenueData:()=>MI,getVenuesAndCourts:()=>Fu,isAdHoc:()=>Hn,isCompletedStructure:()=>Su,isValidForQualifying:()=>UV,isValidMatchUpFormat:()=>$a,matchUpActions:()=>mN,participantScaleItem:()=>Xl,participantScheduledMatchUps:()=>yj,positionActions:()=>wV,publicFindCourt:()=>P2,publicFindVenue:()=>D2,tallyParticipantResults:()=>Wh,tieFormatGenderValidityCheck:()=>bM,tournamentMatchUps:()=>VN,validMatchUp:()=>HM,validMatchUps:()=>Ka,validateCollectionDefinition:()=>aU,validateLineUp:()=>iN});function gGe(){return`
    This project would not have been possible without the generous input and patience
    of tournament organizers and directors who worked with early versions of CourtHive/TMX.

    Thanks to Miro, Pavel, Ivan, Mladen, Zdenko, Antonia, Jakov, Kreso, Barry, Jeff, Bobby... to name just a few. 

    The project would not have even begun without the support of Miro, or the introduction by Sretchko.
    The project would not have succeeded without the enthusiasm of Randy and Bruce.
    Thanks to serendipity and Luca and the ensuing TODS conversations with ITF.
    Thanks to Scott and Jake for sanity checks, suggestions, and camaraderie.
    Thanks to Zoran for inspiring the async support and getting into the weeds with subscriptions.
    Thanks to Dave for backing the conversion of TMX 1.x source into the factory repository.
    Thanks to Vuk and Pavle and Rich and Chris and Deepa for the direct engagement with the APIs.
    Thanks to Joe for repeatedly challenging me and the many pointers to useful tooling.
    Thanks to Shannon for the validation of the approach from his deep domain experience.
    Thanks to Nikola for the ongoing camaraderie and explorations of what we can do with TODS.

    And a special thanks to my family for putting up with the long days and weeks and months of coding
    and conversations at all hours.
  `}var mle={};dt(mle,{filterParticipants:()=>OU,getCompetitionParticipants:()=>ZV,getPairedParticipant:()=>ro,getParticipantEventDetails:()=>ej,getParticipantMembership:()=>tj,getParticipantScaleItem:()=>Wm,getParticipantSchedules:()=>ij,getParticipantSignInStatus:()=>rj,getParticipantTimeItem:()=>m2,getParticipants:()=>Ri,getScaleValues:()=>Fv,participantScaleItem:()=>Xl,validateLineUp:()=>iN});function ZV(t){let{tournamentRecords:e}=t||{};if(typeof e!="object"||!Object.keys(e).length)return{error:Mi};let i=[],r={},n={},a={},s=[],o={},l=[];for(let u of Object.values(e)){let{participantIdsWithConflicts:c,mappedMatchUps:d,participantMap:p,participants:f,matchUps:m,derivedEventInfo:h,derivedDrawInfo:g}=Ri({...t,tournamentRecord:u});Object.assign(o,d),Object.assign(r,p),Object.assign(n,h),Object.assign(a,g),i.push(...f??[]),s.push(...m??[]),c?.forEach(I=>{l.includes(I)||l.push(I)})}return{participantIdsWithConflicts:l,derivedEventInfo:n,derivedDrawInfo:a,participantMap:r,mappedMatchUps:o,participants:i,...W,matchUps:s}}function ej({tournamentRecord:t,participantId:e}){if(!t)return{error:ve};if(!e)return{error:dr};let i=[e].concat((t.participants??[]).filter(r=>r?.participantType&&[_t,ft].includes(r.participantType)&&r.individualParticipantIds?.includes(e)).map(r=>r.participantId));return{eventDetails:(t.events??[]).filter(r=>{let n=(r?.entries??[]).map(a=>a.participantId);return xn(n,i)}).map(r=>({eventName:r.eventName,eventId:r.eventId}))}}function tj({tournamentRecord:t,participantId:e}){if(!t)return{error:ve};if(!e)return{error:dr};let{participants:i}=Ri({participantFilters:{participantTypes:[_t,ft,Ya]},tournamentRecord:t});return(i??[]).filter(r=>r.individualParticipantIds?.includes(e)).reduce((r,n)=>{let a=n.participantType;return a&&(r[a]||(r[a]=[]),r[a].push(n)),r},{})}function ij({participantFilters:t={},tournamentRecord:e}){if(!e)return{error:ve};if(typeof t!="object")return{error:$c,context:{participantFilters:t}};let i={eventIds:t.eventIds},r=Ur({tournamentRecord:e,contextFilters:i}).matchUps??[],n=Object.assign({},...r.map(l=>({[l.matchUpId]:l}))),a=r.filter(({schedule:l})=>l&&Object.keys(l).length),s=co({tournamentRecord:e,matchUps:r}).sourceMatchUpIds??[],o={};for(let l of a){let{sides:u}=l,c,d=u?.map(f=>{if(f.participant)return[f.participant].concat(...f.participant.individualParticipants||[]);s[l.matchUpId]&&!c&&(c=(s[l.matchUpId]||[]).map(m=>n[m]).filter(({winningSide:m,bye:h})=>!m&&!h))}).filter(Boolean).flat()??[];for(let f of d){let{participantId:m}=f;o[m]||(o[m]={potentialMatchUps:[],participant:f,matchUps:[]}),o[m].matchUps.push(l)}let p=c?.map(({sides:f})=>f).flat().map(({participant:f})=>f&&[f].concat(...f.individualParticipants||[])).filter(Boolean).flat()||[];for(let f of p){let{participantId:m}=f;o[m]||(o[m]={potentialMatchUps:[],participant:f,matchUps:[]}),o[m].potentialMatchUps.push(l)}}return{participantSchedules:Object.values(o).filter(({participant:l})=>!(t.participantIds&&!t.participantIds.includes(l.participantId)||t.participantTypes&&!t.participantTypes.includes(l.participantType))),...W}}function rj({tournamentRecord:t,participantId:e}){if(!t)return{error:ve};if(!e)return{error:dr};let{participant:i}=Xd({tournamentRecord:t,participantId:e});if(!i)return{error:ji};let{timeItem:r}=Ss({itemType:gU,element:i});return r&&r.itemValue===Zb&&Zb}var hle={};dt(hle,{analyzeDraws:()=>zU,analyzeTournament:()=>lj,getAggregateTeamResults:()=>oj,getAllowedDrawTypes:()=>CN,getAllowedMatchUpFormats:()=>nj,getAppliedPolicies:()=>Dt,getCompetitionDateRange:()=>NN,getCompetitionPenalties:()=>aj,getPolicyDefinitions:()=>jc,getTournamentInfo:()=>Qh,getTournamentPenalties:()=>MN,getTournamentPersons:()=>sj,getTournamentPoints:()=>Xv,getTournamentStructures:()=>X2,getTournamentTimeItem:()=>GM});function nj({tournamentRecord:t,categoryName:e,categoryType:i}){if(!t)return{error:ve};let{appliedPolicies:r}=Dt({tournamentRecord:t});return(r?.[ms]?.matchUpFormats||[]).filter(({categoryNames:n,categoryTypes:a})=>!e&&!a||e&&n?.includes(e)||i&&a?.includes(i))}function CN({tournamentRecord:t,categoryName:e,categoryType:i}){if(!t)return{error:ve};let{appliedPolicies:r}=Dt({tournamentRecord:t});return(r?.[_P]?.allowedDrawTypes||[]).filter(({categoryNames:n,categoryTypes:a})=>!e&&!a||e&&n?.includes(e)||i&&a?.includes(i))}function MN({tournamentRecord:t}){if(!t)return{error:ve};let e=(t?.participants??[]).reduce((i,r)=>{let{participantId:n}=r;return(r.penalties??[]).forEach(a=>{let{penaltyId:s}=a||{};i[s]?i[s].participants.push(n):i[s]={...a,participantIds:[n]}}),i},{});return{penalties:Object.values(e)}}function aj({tournamentRecords:t}){if(typeof t!="object"||!Object.keys(t).length)return{error:Mi};let e=[];for(let i of Object.values(t)){let{penalties:r}=MN({tournamentRecord:i});e.push(...r??[])}return{penalties:e}}function NN({tournamentRecords:t}){if(!wt(t))return{error:Mi};let e=Object.keys(t??{}).reduce((n,a)=>{let s=t[a],{tournamentInfo:{startDate:o,endDate:l}}=Qh({tournamentRecord:s}),u=o&&Ze(o),c=u&&new Date(u);(!n.startDate||c&&c<n.startDate)&&(n.startDate=c);let d=l&&Ze(l),p=d&&new Date(d);return(!n.endDate||p&&p>n.endDate)&&(n.endDate=p),n},{startDate:void 0,endDate:void 0}),i=e.startDate&&Ze(e.startDate.toISOString()),r=e.endDate&&Ze(e.endDate.toISOString());return!i||!r?{error:jte}:{startDate:i,endDate:r}}function sj({tournamentRecord:t,participantFilters:e}){if(!t)return{error:ve};let i=t.participants||[];e&&(i=OU({participants:i,participantFilters:e,tournamentRecord:t}));let r={},n=a=>{if(a.person){let{personId:s}=a.person;r[s]?r[s].participantIds.push(a.participantId):r[s]={...a.person,participantIds:[a.participantId]}}};return i.forEach(a=>{a.person&&n(a)}),{tournamentPersons:Object.values(r)}}function oj(t){let e=He(t,[{[hr]:!0}]);if(e.error)return e;let i=t.finishingPositionRangeBounsPoints||{},r={},n=d=>{let p=d?.individualParticipants?.map(f=>f.teams?.length===1&&f.teams[0]);return d?.teams?.length===1&&d?.teams?.[0]||p?.[0].participantId===p?.[1].participantId&&p?.[0]},{matchUps:a,participants:s}=Ri({participantFilters:{participantTypes:[It]},withRankingProfile:!0,withStatistics:!0,...t});for(let d of s??[]){if(d.participantType===$n)continue;d.draws?.[0]?.drawId==="draw-0-3"&&console.log(d.participantType,d.draws[0].finishingPositionRange);let p=n(d);if(p)for(let f of d?.draws??[]){let m=f?.finishingPositionRange?.join("-");if(m&&i?.[m]){let h=p?.participantId,g=f?.drawId,I=`${h}|${g}|${m}`;r[I]=i[m]}}}let o=d=>({teamName:d,standingPoints:0,pointsPlayed:0,pointsPct:0,points:0,bonus:0,diff:0,loss:0,win:0}),l=(d,p,f)=>{d[p]===void 0&&(d[p]=0),d[p]+=f},u={},c={};for(let d of a??[]){let{sides:p,matchUpFormat:f}=d,m=f&&qi(f);if(p?.length===2&&m.setFormat?.timed&&(!m.finalSetFormat||m.finalSetFormat?.timed))for(let h of p){let g=n(h.participant),I=g?.participantId,v=h.participant?.participantId,w=g?.participantName,y=h.sideNumber,b=h.participant?.individualParticipantIds||v&&[v]||[];if(b.forEach(S=>{S&&!u[S]&&(u[S]=o(w))}),I&&y){c[I]||(c[I]=o(w));let S=[...b.map(T=>u[T]),c[I]];d.winningSide&&(y===d.winningSide?S.forEach(T=>l(T,"win",1)):S.forEach(T=>l(T,"loss",1)));let U=d.score?.sets||[];for(let T of U){let P=T?.[`side${3-y}Score`]||0,D=T?.[`side${y}Score`]||0,E=D-P;S.forEach(R=>l(R,"pointsPlayed",D+P)),S.forEach(R=>l(R,"points",D)),S.forEach(R=>l(R,"diff",E))}}}}for(let d of Object.keys(r)){let[p]=d.split("|");c[p]&&(c[p].bonus+=r[d],c[p].pointsPct=parseFloat((c[p].points/c[p].pointsPlayed).toFixed(2)),c[p].standingPoints=c[p].win+c[p].bonus)}for(let d of Object.keys(u))u[d].pointsPct=parseFloat((u[d].points/u[d].pointsPlayed).toFixed(2));return{...W,individualResults:u,teamResults:c}}function IGe(t){let e=t.participants?.filter(({participantType:a})=>a===_t)?.length===2,i=t.events?.length===1&&t.events[0],r=i?.drawDefinitions?.length===1&&i.drawDefinitions[0],n=(r?.structures?.length===1&&r.structures[0])?.positionAssignments?.length===2;return!!(i.tieFormat&&e&&n)}function lj({tournamentRecord:t}){if(!t)return{error:ve};let{drawsAnalysis:e}=zU({tournamentRecord:t}),i={isDual:IGe(t),drawsAnalysis:e},r=Ri({tournamentRecord:t});return r.missingParticipantIds?.length&&(i.missingParticipantIds=r.missingParticipantIds),{...W,analysis:i}}function Og(t,e){return t&&e&&Array.isArray(e)&&e[t-1]||typeof e=="object"&&e[t]}function uj({qualityWinProfiles:t,wonMatchUpIds:e,mappedMatchUps:i,participantSideMap:r,tournamentParticipants:n,tournamentStartDate:a,level:s}){let o=0,l=[],u={};for(let c of n)u[c.participantId]=c;for(let c of t){let{rankingScaleName:d,rankingSnapshot:p="latestAvailable",includeWalkovers:f=!1,rankingRanges:m=[],maxBonusPerTournament:h,unrankedOpponentBehavior:g="noBonus"}=c,I=0;for(let v of e){let w=i[v];if(!w)continue;let{matchUpStatus:y,sides:b=[],winningSide:S}=w;if(!f&&(y===ai||y===qt))continue;let U=r[v];if(!U||S!==U)continue;let T=b.find(R=>R.sideNumber!==U)?.participantId;if(!T)continue;let P=u[T];if(!P)continue;let D=vGe({participant:P,rankingScaleName:d,rankingSnapshot:p,tournamentStartDate:a});if(!D){if(g==="noBonus")continue;continue}let E=m.find(R=>D>=R.rankRange[0]&&D<=R.rankRange[1]);if(E){let R;if(typeof E.value=="number")R=E.value;else if(typeof E.value=="object"){let C=Og(s,E.value.level??E.value);typeof C=="number"&&(R=C)}R&&(I+=R,l.push({opponentParticipantId:T,opponentRank:D,points:R,matchUpId:v}))}}h!==void 0&&I>h&&(I=h),o+=I}return{qualityWinPoints:o,qualityWins:l}}function vGe({participant:t,rankingScaleName:e,rankingSnapshot:i,tournamentStartDate:r}){let n=(t.timeItems||[]).filter(o=>{if(!o?.itemType)return!1;let l=o.itemType.split(".");return l[0]===Sd&&l[1]===vu&&l[3]===e});if(!n.length)return;let a=n;if(i==="tournamentStart"&&r){let o=new Date(r).getTime();a=n.filter(l=>(l.itemDate?new Date(l.itemDate).getTime():0)<=o)}if(!a.length)return;a.sort((o,l)=>(o.createdAt?new Date(o.createdAt).getTime():0)-(l.createdAt?new Date(l.createdAt).getTime():0));let s=a[a.length-1]?.itemValue;return typeof s=="number"?s:void 0}var yGe="RANKING_POINTS",bGe="QUALITY_WIN",wGe="fullToEach",gle="splitEven",SGe="teamOnly",Ile=["ageCategoryCodes","genders","categoryNames","categoryTypes","ratingTypes","ballTypes","wheelchairClasses","subTypes"],vle=["eventTypes","drawTypes","drawSizes","maxDrawSize","stages","stageSequences","levels","maxLevel","flights","maxFlightNumber","participationOrder","dateRanges"],UGe={RANKING_POINTS:yGe,QUALITY_WIN:bGe,FULL_TO_EACH:wGe,SPLIT_EVEN:gle,TEAM_ONLY:SGe,CATEGORY_SCOPE_FIELDS:Ile,PROFILE_SCOPE_FIELDS:vle};function cj(t){let{participation:e={},awardProfiles:i,wheelchairClass:r,startDate:n,eventType:a,drawSize:s,drawType:o,category:l,endDate:u,gender:c,level:d}=t,{participationOrder:p,flightNumber:f,rankingStage:m}=e,h=b=>!n&&!u||!b.dateRanges?!0:b.dateRanges.some(S=>{let U=!n||!S.startDate||new Date(n)>new Date(S.startDate),T=!u||!S.endDate||new Date(u)<=new Date(S.endDate);return U&&T}),g=b=>{if(!b)return!0;let S=l||{};return!(b.ageCategoryCodes?.length&&!b.ageCategoryCodes.includes(S.ageCategoryCode)||b.genders?.length&&!b.genders.includes(c)||b.categoryNames?.length&&!b.categoryNames.includes(S.categoryName)||b.categoryTypes?.length&&!b.categoryTypes.includes(S.type)||b.ratingTypes?.length&&!b.ratingTypes.includes(S.ratingType)||b.ballTypes?.length&&!b.ballTypes.includes(S.ballType)||b.wheelchairClasses?.length&&!b.wheelchairClasses.includes(r)||b.subTypes?.length&&!b.subTypes.includes(S.subType))},I=b=>h(b)&&(!b.maxFlightNumber||f<=b.maxFlightNumber)&&(!b.drawTypes?.length||b.drawTypes?.includes(o))&&(!b.drawSizes?.length||b.drawSizes.includes(s))&&(!b.stages?.length||b.stages.includes(m))&&(!b.levels?.length||b.levels.includes(d))&&(!b.maxDrawSize||s<=b.maxDrawSize)&&(!b.drawSize||b.drawSize===s)&&(!b.maxLevel||d<=b.maxLevel)&&(!f||!b.flights?.flightNumbers?.length||b.flights.flightNumbers.includes(f))&&(!b.participationOrder||b.participationOrder===p)&&g(b.category)&&(!b.eventTypes?.length||b.eventTypes?.includes(a)),v=i.filter(I);if(v.length===0)return{awardProfile:void 0};if(v.length===1)return{awardProfile:v[0]};let w=v.filter(b=>b.priority!==void 0);if(w.length){let b=Math.max(...w.map(S=>S.priority));return{awardProfile:w.find(S=>S.priority===b)}}let y=v.map((b,S)=>({profile:b,score:TGe(b),index:S}));return y.sort((b,S)=>S.score-b.score||b.index-S.index),{awardProfile:y[0].profile}}function TGe(t){let e=0;for(let i of vle){let r=t[i];if(r!=null){if(Array.isArray(r)&&r.length===0)continue;e+=1}}if(t.category)for(let i of Ile){let r=t.category[i];Array.isArray(r)&&r.length>0&&(e+=1)}return e}function tE({participantWon:t,flightNumber:e,valueObj:i,drawSize:r,flights:n,level:a}){let s=(m,h)=>{if(m){if(Array.isArray(h)){let g=h.find(I=>I.flight===m||I.f===m);return g.value||g.v}if(typeof h=="object"){let g=h.flights||h.f;if(Array.isArray(g))return g[m-1]}}},o=(m,h)=>{let g=m?.value||m?.v||(lt(m)?m:0),I=Og(a,m?.level);return{value:s(h,I)||lt(I)&&I||g}},l=0,u,c,d,p,f=t&&"won"||t===!1&&"lost"||void 0;if(Array.isArray(i)){let m=i.find(I=>I.drawSize===r||I.drawSizes?.includes(r)),h=i.find(I=>I.drawSize&&I.threshold&&r>I.drawSize),g=i.find(I=>!I.drawSize&&!I.drawSizes?.length);f!==void 0&&(m=m?.[f],h=h?.[f],g=g?.[f]),c=o(m,e).value,d=o(h,e).value,p=o(g,e).value,l=c||d||p,u=c&&m.requireWin||d&&h.requireWin||g?.requireWin}else if(typeof i=="object"){let m=i?.drawSizes?.[r],h=i;f!==void 0&&(m=m?.[f],h=h?.[f]),c=o(m,e).value,p=o(h,e).value,l=c||p,u=c?m.requireWin:h?.requireWin}else lt(i)&&f===void 0&&(l=i);return e&&n?.pct?.[e]&&(l=Math.round(l*n.pct[e])),{awardPoints:l,requireWin:u}}function Xv({participantFilters:t,policyDefinitions:e,tournamentRecord:i,level:r}){if(!i)return{error:ve};let n=oa(),{policyDefinitions:a}=jc({policyTypes:[cD],tournamentRecord:i}),s=e?.[cD]??a?.[cD];if(!s)return{error:aM};let o=s.awardProfiles,l=s.requireWinFirstRound,u=s.requireWinForPoints,c=s.doublesAttribution,d=s.qualityWinProfiles,{participants:p,derivedEventInfo:f,derivedDrawInfo:m,mappedMatchUps:h}=Ri({withRankingProfile:!0,participantFilters:t,tournamentRecord:i}),g=p?.filter(S=>S.draws?.length),I={},v={};for(let S of i.participants||[])S.person?.personId&&(I[S.participantId]=S.person.personId),S.individualParticipantIds?.length&&(v[S.participantId]=S.individualParticipantIds);let w={},y={},b={};for(let S of g??[]){let{participantType:U,participantId:T,person:P,draws:D}=S;for(let E of D){let{drawId:R,structureParticipation:C,eventId:M}=E,N=f[M],A=m[R],O=A?.drawType,{category:k,eventType:F,gender:x,wheelchairClass:L}=N||{},$=E.startDate||N.startDate||i.startDate,V=E.endDate||N.endDate||i.endDate;if(F===Ua&&U!==$n)continue;let _;if(o){let B=u,G=0,j=0,K=0,Y=0,X,Z,J=0,ae,te,ne;for(let le of C){let{finishingPositionRange:de,participationOrder:pe,participantWon:ge,flightNumber:Me,rankingStage:Pe,winCount:Be}=le;if(G+=Be||0,Array.isArray(de)&&de.length){let ce=Math.min(...de);(te===void 0||ce<te)&&(te=ce)}let fe=A?.drawSize,{awardProfile:Te}=cj({wheelchairClass:L,awardProfiles:o,participation:le,eventType:F,startDate:$,category:k,drawSize:fe,drawType:O,endDate:V,gender:x,level:r});if(Te){if(!fe)continue;if(Te.profileName&&(Z=Te.profileName),ne||(ne=Te),ae===void 0&&Te.maxCountableMatches!==void 0){let ee=Te.maxCountableMatches;if(typeof ee=="number")ae=ee;else if(typeof ee=="object"){let Se=Og(r,ee.level??ee);typeof Se=="number"&&(ae=Se)}}let ce=Array.isArray(de)&&Math.max(...de),ye=nt(de||[]).join("-"),be=ce&&Pe!==ze&&de?.includes(fe);Te.requireWinForPoints!==void 0&&(B=Te.requireWinForPoints),Te.requireWinFirstRound!==void 0&&(l=Te.requireWinFirstRound);let{finishingPositionPoints:Fe={},finishingPositionRanges:we,finishingRound:Ne,pointsPerWin:me,flights:Ee}=Te,Le=Array.isArray(Te.perWinPoints)?Te.perWinPoints?.find(ee=>ee.participationOrders?.includes(pe)):Te.perWinPoints,Q=Fe.participationOrders,se=0,oe;if((!Q||Q.includes(pe))&&we&&ce){let ee=we[ce];ee&&({awardPoints:se,requireWin:oe}=tE({flightNumber:Me,valueObj:ee,drawSize:fe,flights:Ee,level:r}))}if(!se&&Ne&&pe===1&&ce){let ee=Ne[ce];ee&&({awardPoints:se,requireWin:oe}=tE({participantWon:ge,flightNumber:Me,valueObj:ee,drawSize:fe,flights:Ee,level:r}))}be&&l!==void 0&&(B=l),oe!==void 0&&(B=oe),se>j&&(!B||Be)&&(j=se,X=ce,ne=Te);let ue=ae!==void 0?Math.min(Be||0,Math.max(0,ae-J)):Be;if(!se&&me&&ue&&(K+=ue*me,J+=ue,X=ye),!se&&Be&&Le){let ee=Og(r,Le?.level);typeof ee=="number"?(K+=(ue||0)*ee,J+=ue||0):!ee&&Le.value&&(K+=(ue||0)*Le.value,J+=ue||0)}}if(U===$n&&Te){let ce=Array.isArray(Te.perWinPoints)?Te.perWinPoints?.find(be=>be.participationOrders?.includes(pe)):Te.perWinPoints,ye=ce&&Og(r,ce.level);if(ye){let be=(S.matchUps||[]).filter(({structureId:Fe})=>Fe===le.structureId);for(let{matchUpId:Fe}of be){let we=h[Fe],Ne=we?.sides?.find(me=>me.participantId===T)?.sideNumber;if(!(!Ne||we.winningSide!==Ne))for(let me of we.tieMatchUps||[]){if(!me.winningSide)continue;let{collectionPosition:Ee}=me,Le;if(typeof ye=="object"&&ye.line){if(ye.limit&&Ee>ye.limit)continue;Le=ye.line[Ee-1]}else typeof ye=="number"&&(Le=ye);if(Le)for(let Q of me.sides||[]){if(Q.sideNumber!==me.winningSide)continue;let se=Q.participantId;if(!se)continue;let oe=v[se]||[se];for(let ue of oe){let ee=I[ue];ee&&(w[ee]||(w[ee]=[]),w[ee].push({linePoints:Le,collectionPosition:Ee,eventType:F,drawId:R}))}}}}}}}if(ne?.bonusPoints&&te!==void 0){for(let le of ne.bonusPoints)if(le.finishingPositions?.includes(te)){let de=le.value;if(typeof de=="number")Y=de;else if(typeof de=="object"){let pe=Og(r,de.level??de);typeof pe=="number"&&(Y=pe)}break}}if(_=j+K+Y,K||j||Y){let le={winCount:G,positionPoints:j,rangeAccessor:X,perWinPoints:K,bonusPoints:Y,eventType:F,drawId:R,points:_,category:k,drawType:O,startDate:$,endDate:V,level:r};n&&Z&&(le.profileName=Z);let de=P?.personId;if(de)w[de]||(w[de]=[]),w[de].push(le);else if(U===ft){if(b[T]||(b[T]=[]),b[T].push(le),c){let pe=c===gle?.5:1,ge=v[T]||[];for(let Me of ge){let Pe=I[Me];if(!Pe)continue;let Be={...le,points:Math.round(le.points*pe),positionPoints:Math.round(le.positionPoints*pe),perWinPoints:Math.round(le.perWinPoints*pe),bonusPoints:Math.round(le.bonusPoints*pe),doublesParticipantId:T};w[Pe]||(w[Pe]=[]),w[Pe].push(Be)}}}else U===$n&&(y[T]||(y[T]=[]),y[T].push(le))}if(d?.length&&S.matchUps){let le=Object.values(S.matchUps).filter(de=>de.drawId===R&&de.participantWon);if(le.length){let de=le.map(Pe=>Pe.matchUpId),pe={};for(let Pe of le)pe[Pe.matchUpId]=Pe.sideNumber;let{qualityWinPoints:ge,qualityWins:Me}=uj({qualityWinProfiles:d,wonMatchUpIds:de,mappedMatchUps:h,participantSideMap:pe,tournamentParticipants:i.participants||[],tournamentStartDate:i.startDate,level:r});if(ge>0){let Pe=P?.personId;Pe&&(w[Pe]||(w[Pe]=[]),w[Pe].push({qualityWinPoints:ge,qualityWins:Me,eventType:F,drawId:R}))}}}}}}return{participantsWithOutcomes:g,personPoints:w,pairPoints:b,teamPoints:y,...W}}var yle={};dt(yle,{compareTieFormats:()=>Rc,getTieFormat:()=>AN,tieFormatGenderValidityCheck:()=>bM,validateCollectionDefinition:()=>aU});function iE(t){if(!t)return{};let e=[],i=t.tieFormatName,r=t.collectionDefinitions?.map(n=>{let{matchUpType:a,matchUpFormat:s,matchUpCount:o,category:l,gender:u}=n;e.includes(s)||e.push(s);let c=l?.ageCategoryCode;return[o,a===Lp?"D":"S",c,s,u].join(";")}).join("|");return{tieFormatName:t&&i||"UNNAMED",matchUpFormats:e,tieFormatDesc:r}}function Rc({considerations:t={},descendant:e,ancestor:i}){let r={},n={},{matchUpFormats:a,tieFormatDesc:s}=iE(e),{matchUpFormats:o,tieFormatDesc:l}=iE(i),u=nt((a??[]).filter(b=>!(o??[]).includes(b)).concat((o??[]).filter(b=>!(a??[]).includes(b)))),c=!!(t?.collectionName&&e.collectionDefinitions.map(({collectionName:b})=>b).join("|")!==i.collectionDefinitions.map(({collectionName:b})=>b).join("|")),d=!!(t?.collectionOrder&&e.collectionDefinitions.map(({collectionOrder:b})=>b).join("|")!==i.collectionDefinitions.map(({collectionOrder:b})=>b).join("|")),p=Object.assign({},...(e?.collectionDefinitions||[]).map(b=>({[b.collectionId]:b}))),f=Object.assign({},...(i?.collectionDefinitions||[]).map(b=>({[b.collectionId]:b})));r.collectionIds=$z(Object.keys(p),Object.keys(f)),n.collectionIds=$z(Object.keys(f),Object.keys(p)),r.collectionsValue=Rq(p),n.collectionsValue=Rq(f),r.groupsCount=i?.collectionGroups?.length??(0-(e?.collectionGroups?.length??0)||0),n.groupsCount=r.groupsCount?-1*r.groupsCount:0;let m=r.collectionsValue.totalValue-n.collectionsValue.totalValue,h=r.collectionsValue.totalMatchUps-n.collectionsValue.totalMatchUps,g=n.collectionsValue.assignmentValues.length!==r.collectionsValue.assignmentValues.length,I=n.collectionsValue.assignmentValues.some((b,S)=>{let U=r.collectionsValue.assignmentValues[S];return!U||b.valueKey!==U.valueKey||b.value!==U.value?!0:Array.isArray(b.value)?b.value.every((T,P)=>U.value[P]===T):!1}),v=c||d||l!==s||g||I||m!==0,w=[...n.collectionsValue.invalidValues,...r.collectionsValue.invalidValues],y=w.length&&w;return{matchUpFormatDifferences:u,matchUpCountDifference:h,descendantDifferences:r,ancestorDifferences:n,orderDifference:d,valueDifference:m,nameDifference:c,descendantDesc:s,ancestorDesc:l,...W,different:v,invalid:y}}function Rq(t){let e=[],i=[],r=0;return{totalValue:Object.keys(t).sort(ZM).reduce((n,a)=>{let s=t[a],{collectionValueProfiles:o,collectionValue:l,matchUpCount:u,matchUpValue:c,scoreValue:d,setValue:p}=s,f={collectionValueProfiles:o,collectionValue:l,matchUpValue:c,scoreValue:d,setValue:p},m=Object.keys(f).filter(g=>![void 0,null].includes(f[g])&&(!Array.isArray(f[g])||f[g].length>0));m.length!==1&&e.push({collectionId:a});let h=m[0];if(h){let g=h==="collectionValueProfiles"?Object.values(o):f[h];i.push({valueKey:h,value:g})}return r+=u,o?.length?n+o.reduce((g,I)=>g+I.value,0):u?lt(c)?n+c*u:lt(d)?n+d*u:lt(p)?n+p*u:n+l:n},0),totalMatchUps:r,invalidValues:e,assignmentValues:i}}function dj(t){Object.assign(t,{inContext:!0});let{matchUp:e,error:i}=ble(t);return{matchUp:Oe(e,!0,!0),error:i}}function ble({participantsProfile:t,afterRecoveryTimes:e,tournamentRecord:i,contextContent:r,contextProfile:n,drawDefinition:a,nextMatchUps:s,matchUpId:o,inContext:l,eventId:u,drawId:c,event:d}){if(!i)return{error:ve};if(typeof o!="string")return{error:Tn};if(!a||!d){let m=(Ur({tournamentRecord:i,nextMatchUps:s}).matchUps??[]).find(h=>h.matchUpId===o);if(!m)return{error:dn};({eventId:u,drawId:c}=m),{event:d,drawDefinition:a}=Wn({tournamentRecord:i,eventId:u,drawId:c})}if(!a)return{error:_a};n&&!r&&(r=Gc({tournamentRecord:i,contextProfile:n}));let p={surfaceCategory:d?.surfaceCategory??i.surfaceCategory,indoorOutDoor:d?.indoorOutdoor??i.indoorOutdoor,endDate:d?.endDate??i.endDate,tournamentId:i.tournamentId,eventId:u??d?.eventId,drawId:c},{participants:f=[]}=yf({participantsProfile:t,tournamentRecord:i,contextProfile:n,inContext:l});if(s){let m=(An({context:l?p:void 0,participants:f,afterRecoveryTimes:e,contextContent:r,contextProfile:n,drawDefinition:a,nextMatchUps:s,inContext:l,event:d}).matchUps??[]).find(g=>g.matchUpId===o);if(!m)return{error:dn};let h=a?.structures?.find(g=>g.structureId===m.structureId);return{drawDefinition:a,structure:h,matchUp:m}}else{let{matchUp:m,structure:h}=fi({context:l?p:void 0,tournamentParticipants:f,afterRecoveryTimes:e,contextContent:r,drawDefinition:a,contextProfile:n,matchUpId:o,inContext:l,event:d});return{matchUp:m,structure:h,drawDefinition:a}}}function AN({tournamentRecord:t,drawDefinition:e,structureId:i,matchUpId:r,structure:n,eventId:a,drawId:s,event:o}){if(!t)return{error:ve};if(!s&&!o&&!i&&!r)return q({result:{error:Je},stack:"getTieFormat"});a&&!o&&(o=t.events?.find(f=>f.eventId===a));let l=dj({tournamentRecord:t,drawDefinition:e,matchUpId:r,drawId:s,event:o});if(r&&l?.error)return l;if(!e&&l?.drawDefinition&&(e=l?.drawDefinition),n=n??l?.structure,!n&&i&&!r){if(!e)return{error:xo};let f=tt({drawDefinition:e,structureId:i});if(f.error)return f;n=f.structure}let u=(n?.tieFormat||n?.tieFormatId)&&yn({structure:n,drawDefinition:e,event:o})?.tieFormat,c=(e?.tieFormat||e?.tieFormatId)&&yn({drawDefinition:e,event:o})?.tieFormat,d=yn({event:o})?.tieFormat,p=yn({matchUp:l?.matchUp,drawDefinition:e,structure:n,event:o})?.tieFormat;return{...W,matchUp:l?.matchUp,structureDefaultTieFormat:Gr(u),eventDefaultTieFormat:Gr(d),drawDefaultTieFormat:Gr(c),tieFormat:Gr(p),structure:n}}var wle={};dt(wle,{bulkUpdatePublishedEventIds:()=>pj,getAllEventData:()=>fj,getCourtInfo:()=>KM,getDrawData:()=>fN,getEventData:()=>YU,getEventPublishStatus:()=>Qa,getPublishState:()=>zh,getTournamentPublishStatus:()=>kU,getVenueData:()=>MI});function pj({tournamentRecord:t,outcomes:e}){if(!t)return{error:ve};if(!e?.length)return{error:Je,info:"Missing outcomes"};let i=e.reduce((n,a)=>{let{drawId:s,eventId:o}=a;return o&&s&&(n[o]?n[o].includes(s)||n[o].push(s):n[o]=[s]),n},{}),r=Object.keys(i);return{publishedEventIds:(t.events?.filter(n=>r.includes(n.eventId))).filter(n=>{let a=Qa({event:n}),{drawDetails:s,drawIds:o}=a??{},{eventId:l}=n;return i[l].filter(u=>{let c=s?Object.keys(a.drawDetails).filter(d=>O2({drawId:d,drawDetails:s})):[];return o?.includes(u)||c.includes(u)}).length}).map(n=>n.eventId),eventIdPublishedDrawIdsMap:i}}function fj({tournamentRecord:t,policyDefinitions:e}){if(!t)return{error:ve};let i=t.events||[],r=t?.participants||[],{tournamentInfo:n}=Qh({tournamentRecord:t}),{venues:a}=Fu({tournamentRecord:t}),s=i.map(o=>{let{eventId:l}=o,u=Vse({event:o}).eventInfo,c=vU({tournamentRecord:t,event:o}).scheduleTiming,d=(o.drawDefinitions||[]).map(f=>{let{drawId:m,drawName:h,matchUpFormat:g,updatedAt:I}=f,v={drawId:m,drawName:h,matchUpFormat:g,updatedAt:I},{abandonedMatchUps:w,completedMatchUps:y,upcomingMatchUps:b,pendingMatchUps:S}=jv({requireParticipants:!0,tournamentParticipants:r,context:{eventId:l},policyDefinitions:e,tournamentRecord:t,inContext:!0,scheduleTiming:c,drawDefinition:f,event:o});return{drawInfo:v,matchUps:{abandonedMatchUps:w,completedMatchUps:y,upcomingMatchUps:b,pendingMatchUps:S}}}),p=Qa({event:o});return Object.assign(u,{drawsData:d,publish:p}),u});return{allEventData:{tournamentInfo:n,venuesData:a,eventsData:s}}}var Sle={};dt(Sle,{courtGridRows:()=>LN,findVenue:()=>Ou,getMatchUpsToSchedule:()=>kN,getPersonRequests:()=>Pf,getProfileRounds:()=>FN,getScheduledRoundsDetails:()=>QU,getSchedulingProfile:()=>Wc,getSchedulingProfileIssues:()=>mj,publicFindCourt:()=>P2});function OI({matchUpPotentialParticipantIds:t,matchUpNotBeforeTimes:e,timeAfterRecovery:i,matchUp:r}){let{individualParticipantIds:n}=VM(r);i=i??r.schedule?.timeAfterRecovery;let a=u=>{t[u]||(t[u]=[]),t[u]=nt(t[u].concat(...n))},s=u=>{i&&(!e[u]||i>e[u])&&(e[u]=i)},o=r.winnerTo?.matchUpId||r.winnerMatchUpId;o&&(i&&s(o),a(o));let l=r.loserTo?.matchUpId||r.loserMatchUpId;l&&(i&&s(l),a(l)),r.sidesTo?.length&&r.sidesTo.forEach(({matchUpId:u})=>{u&&(i&&s(u),a(u))})}function kN(t){let e=He(t,[{[BB]:!0}]);if(e.error)return e;let{matchUpPotentialParticipantIds:i,dateScheduledMatchUpIds:r=[],scheduleCompletedMatchUps:n,matchUpNotBeforeTimes:a,matchUpScheduleTimes:s,orderedMatchUpIds:o,clearDate:l,matchUps:u}=t,c=s?Object.keys(s):[],d=(o??[]).map(f=>u.find(m=>m.matchUpId===f)).filter(Boolean).filter(f=>{let m=!l&&(r.includes(f.matchUpId)||c.includes(f.matchUpId)),h=["BYE",qt,Oi,Ta,Sr,ai,Si,Wi].includes(f?.matchUpStatus);return n||!m&&!f.winningSide&&!h}),p=i&&a?d.reduce((f,m)=>{let{drawId:h,tournamentId:g}=m;return f.matchUpMap[g]||(f.matchUpMap[g]={}),f.matchUpMap[g][h]?f.matchUpMap[g][h].push(m):f.matchUpMap[g][h]=[m],OI({matchUpPotentialParticipantIds:i,matchUpNotBeforeTimes:a,matchUp:m}),f},{matchUpMap:{}}).matchUpMap:{};return{matchUpsToSchedule:d,matchUpMap:p}}function ON({defaultRecoveryMinutes:t=0,defaultAverageMinutes:e,tournamentRecords:i,matchUpFormat:r,categoryName:n,categoryType:a,tournamentId:s,eventType:o,eventId:l}){if(!$a({matchUpFormat:r}))return{error:QS};let u=Object.keys(i).filter(d=>!s||d===s),c;return u.forEach(d=>{if(c)return;let p=i[d],f=l?Wn({tournamentRecord:p,eventId:l})?.event:void 0;return c=EU({tournamentRecord:p,matchUpFormat:r,categoryName:n,categoryType:a,eventType:o,event:f}),c?.averageMinutes||c?.recoveryMinutes}),{recoveryMinutes:c?.recoveryMinutes||t,averageMinutes:c?.averageMinutes||e,typeChangeRecoveryMinutes:c?.typeChangeRecoveryMinutes||c?.recoveryMinutes||t}}function QU(t){let e=He(t,[{[jB]:{tournamentRecords:!1,tournamentRecord:!1}},{rounds:!0,[qn]:sn}]);if(e.error)return e;let{scheduleCompletedMatchUps:i,periodLength:r=30}=t,n=t.tournamentRecords||t.tournamentRecord&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord}||{};if(typeof n!="object")return{error:Mi};let a={},s=[],o=t.rounds.toSorted((m,h)=>(m.sortOrder??0)-(h.sortOrder??0)),l=t.containedStructureIds??Object.assign({},...Object.values(n).map(m=>Bv({tournamentRecord:m}).containedStructures)),u=t.matchUps??No({nextMatchUps:!0,tournamentRecords:n}).matchUps,c=0,d={},p={},f={};return{scheduledRoundsDetails:o.flatMap(m=>{let h=m.periodLength||r,g=[];l?.[m.structureId]?g.push(...l[m.structureId]):g.push(m.structureId);let I=u?Yu({tournamentIds:[m.tournamentId],roundNumbers:[m.roundNumber],matchUpIds:m.matchUpIds,eventIds:[m.eventId],drawIds:[m.drawId],processContext:!0,structureIds:g,matchUps:u}).sort(Hh):[],{segmentNumber:v,segmentsCount:w}=m.roundSegment||{};if(lt(v)&&Ro(I?.length)&&Ro(w)&&v>0&&v<=w&&w<I?.length&&!m.matchUpIds?.length){let U=I.length/w,T=U*(v-1);I=I.slice(T,T+U)}let y=n[m.tournamentId],b=Wn({drawId:m.drawId,tournamentRecord:y}).event,S=[];for(let U of I){let T=U.matchUpFormat;T&&(a[T]||(a[T]=[],a[T].push(U)),S.push(T))}for(let U of S){let{eventType:T,category:P}=b??{},{categoryName:D,ageCategoryCode:E}=P??{},{typeChangeRecoveryMinutes:R,recoveryMinutes:C,averageMinutes:M,error:N}=ON({categoryName:D??E,categoryType:P?.categoryType,tournamentId:m.tournamentId,eventId:m.eventId,tournamentRecords:n,matchUpFormat:U,eventType:T});if(N)return{error:N,round:m};let A=I.filter(k=>(i||!Ki.includes(k.matchUpStatus))&&k.matchUpStatus!=="BYE").map(vr);A.forEach(k=>{f[k]={typeChangeRecoveryMinutes:R,recoveryMinutes:C,averageMinutes:M},d[k]=C,p[k]=M}),s.push(...A),c=Math.max(M||0,c);let O=`${M}|${h}`;return{roundPeriodLength:h,recoveryMinutes:C,averageMinutes:M,matchUpIds:A,hash:O}}}),greatestAverageMinutes:c,matchUpFormatCohorts:a,recoveryMinutesMap:d,averageMinutesMap:p,orderedMatchUpIds:s,minutesMap:f,...W}}function Ule({schedulingProfile:t,venueIds:e,eventIds:i,drawIds:r}){let n=[],a=t?.map(o=>{let l=Ze(o?.scheduleDate);if(!l){n.push(`Invalid date: ${o?.scheduledDate}`);return}let u=(o?.venues||[]).map(c=>{let{rounds:d,venueId:p}=c;if(!e?.includes(p)){n.push(`Missing venueId: ${p}`);return}let f=d.filter(m=>{let h=i.includes(m.eventId)&&r.includes(m.drawId);return h||n.push(`Invalid eventId: ${m.eventId} or drawId: ${m.drawId}`),h});if(f.length)return{venueId:p,rounds:f}}).filter(Boolean);return u.length&&l&&{...o,venues:u}}).filter(Boolean),s=n.length;return{updatedSchedulingProfile:a,modifications:s,issues:n}}function xN({tournamentRecords:t,schedulingProfile:e}){if(!e)return{valid:!0};if(!Array.isArray(e))return{valid:!1,error:re};let{venueIds:i,tournamentsMap:r}=PGe({tournamentRecords:t}),n,a,s=e.every(o=>{let{scheduleDate:l,venues:u}=o;return Mn(l)?u.every(c=>{let{venueId:d,rounds:p}=c;return typeof d!="string"?(a="venueId should be a string",!1):Array.isArray(p)?i.includes(d)?!!p.every(f=>{if(!f)return a="empty round",!1;let{roundSegment:m,tournamentId:h,structureId:g,roundNumber:I,eventId:v,drawId:w}=f,y=r?.[h]?.[v]?.[w]?.[g]?.includes(I);y||(a="Invalid rounds");let{segmentNumber:b,segmentsCount:S}=m||{},U=!m||lt(b)&&Ro(S)&&b<=S;return U||(a="Invalid segment"),y&&U}):(n=gf,!1):(a="rounds should be an array",!1)}):!1});return!s&&!n&&(n=re),{valid:!!s,error:n,info:a}}function DGe(t){let{tournamentRecord:e={},tournamentMap:i={},requireCourts:r}=t,n=[],a=[],s=[],o=[],l=(e?.venues||[]).map(({venueId:c,courts:d})=>(!r||d?.length)&&c),u=e?.tournamentId;if(u){n.push(u),i[u]={};let c=e?.events||[];for(let d of c){let p=d.eventId;s.push(p),i[u][p]={};let f=m=>parseInt(m);for(let m of d.drawDefinitions||[]){let h=m.drawId;o.push(h),i[u][p][h]={};let{structures:g}=io({drawDefinition:m});for(let I of g||[]){let v=I.structureId,{matchUps:w}=At({structure:I}),{roundMatchUps:y}=Sn({matchUps:w}),b=y&&Object.keys(y).map(f);if(i[u][p][h][v]=b,a.push(v),I.structures?.length)for(let S of I.structures)a.push(S.structureId),i[u][p][h][S.structureId]=b}}}}return{tournamentMap:i,tournamentIds:n,structureIds:a,venueIds:l,eventIds:s,drawIds:o}}function PGe(t){let e=t?.tournamentRecords&&Object.values(t?.tournamentRecords)||[],i={},{venueIds:r,eventIds:n,drawIds:a,structureIds:s,tournamentIds:o}=e.reduce((l,u)=>{let{tournamentIds:c,tournamentMap:d,structureIds:p,venueIds:f,eventIds:m,drawIds:h}=DGe({tournamentRecord:u});return f.forEach(g=>{l.venueIds.includes(g)||l.venueIds.push(g)}),l.tournamentIds.push(...c),l.structureIds.push(...p),l.eventIds.push(...m),l.drawIds.push(...h),Object.assign(i,d),l},{tournamentIds:[],structureIds:[],venueIds:[],eventIds:[],drawIds:[]});return{tournamentsMap:i,tournamentIds:o,structureIds:s,venueIds:r,eventIds:n,drawIds:a}}function Wc({tournamentRecords:t,tournamentRecord:e}){if(typeof t!="object"||!Object.keys(t).length)return{error:Mi};let{extension:i}=ht({element:e,name:Gm,tournamentRecords:t,discover:!0}),r=i?.value||[];if(r.length){let{venueIds:n}=qU({requireCourts:!0,tournamentRecords:t}),{eventIds:a,drawIds:s}=dV({tournamentRecords:t}),{updatedSchedulingProfile:o,modifications:l,issues:u}=Ule({schedulingProfile:r,venueIds:n,eventIds:a,drawIds:s});if(l){r=o;let c=Jv({tournamentRecords:t,tournamentRecord:e,schedulingProfile:r});return c.error?c:{schedulingProfile:r,modifications:l,issues:u}}}return{schedulingProfile:r,modifications:0}}function Jv({tournamentRecords:t,tournamentRecord:e,schedulingProfile:i}){let r=xN({tournamentRecords:t,schedulingProfile:i});return r.error?r:i?Ft({tournamentRecords:t,discover:!0,extension:{name:Gm,value:i}}):Nn({element:e,name:Gm,tournamentRecords:t,discover:!0})}function ZU(t){let{tournamentRecord:e}=t,i=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(!t.schedulingProfile){let{modifications:u,issues:c}=Wc({tournamentRecords:i,tournamentRecord:e});return{success:!u,modifications:u,issues:c}}let{venueIds:r}=qU({tournamentRecords:i}),{eventIds:n,drawIds:a}=dV({tournamentRecords:i}),{updatedSchedulingProfile:s,modifications:o,issues:l}=Ule({schedulingProfile:t.schedulingProfile,venueIds:r,eventIds:n,drawIds:a});return o?{...Jv({schedulingProfile:s,tournamentRecords:i}),modifications:o,issues:l}:{...W,modifications:o,issues:l}}function mj(t){let{scheduleDates:e=[],tournamentRecords:i,periodLength:r=30}=t??{};if(typeof i!="object")return{error:YS};if(!Array.isArray(e))return{error:re};if(!e.every(Mn))return{error:or};let n=[],a=0,s={},{schedulingProfile:o}=Wc({tournamentRecords:i});if(!o)return{issues:n,...W};let{matchUps:l}=No({nextMatchUps:!0,tournamentRecords:i});for(let c of o){let{scheduleDate:d,venues:p=[]}=c;if(!e?.length||e.includes(d)){for(let f of p||[])if(f){let{rounds:m}=f,h=[],{orderedMatchUpIds:g,scheduledRoundsDetails:I}=QU({tournamentRecords:i,periodLength:r,matchUps:l,rounds:m}),{matchUpDependencies:v}=co({tournamentRecords:i,matchUps:l}),w=y=>{let b;return I?.find((S,U)=>{let T=S.matchUpIds.includes(y);return T&&(b=U),T}),b};if(g?.forEach((y,b)=>{let S=g.slice(b+1),U=Li(S,v?.[y]?.matchUpIds||[]);U.length&&h.push({matchUpId:y,shouldBeAfter:U})}),h.length){a+=h.length;let y=h.map(({matchUpId:b,shouldBeAfter:S})=>{let U=w(b),T=nt(S.map(w));return s[d]||(s[d]={}),s[d][U]||(s[d][U]=[]),T.forEach(P=>{s[d][U].includes(P)||s[d][U].push(P)}),{matchUpId:b,matchUpRoundIndex:U,earlierRoundIndices:T,shouldBeAfter:S}});n.push(...y)}}}}let u={matchUpIdShouldBeAfter:Object.assign({},...n.map(c=>{let{matchUpId:d,shouldBeAfter:p,earlierRoundIndices:f}=c;return{[d]:{earlierRoundIndices:f,shouldBeAfter:p}}}))};return{issuesCount:a,profileIssues:u,roundIndexShouldBeAfter:s,...W}}function Pf(t){let{tournamentRecords:e,requestType:i}=t,r=He(t,[{[pn]:!0}]);if(r.error)return r;let n={};for(let a of Object.values(e)){let{extension:s}=ht({element:a,name:_v}),o=s?.value||[];for(let l of o){let{personId:u,requests:c}=l||{};n[u]||(n[u]=[]);for(let d of c)i&&d.requestType!==i||n[u].push(d)}}return{personRequests:n,...W}}function zx(t){let{containerStructureId:e,roundSegment:i,isRoundRobin:r,tournamentId:n,roundNumber:a,structureId:s,eventId:o,drawId:l}=t,u=r?e:s,c=[n,o,l,u,a].join("|");return je({structureId:u,roundSegment:i,tournamentId:n,roundNumber:a,eventId:o,drawId:l,id:c})}function Cq({round:t,matchUps:e,events:i,tournamentRecords:r}){let n=i.find(p=>p.eventId===t.eventId),{eventType:a,category:s,categoryType:o}=n||{},{categoryName:l,ageCategoryCode:u}=s||{},c=Sa(e.map(({matchUpFormat:p})=>p)),d=0;return Object.keys(c).forEach(p=>{let f=c[p],m=ON({categoryName:l||u,tournamentId:t.tournamentId,eventId:t.eventId,tournamentRecords:r,matchUpFormat:p,categoryType:o,eventType:a});if(m.error)return m;let h=m.averageMinutes*f;isNaN(d)||(d+=h)}),{roundMinutes:d}}function EGe(t){return(t||[]).reduce((e,i)=>{let r=(i.finishingPositionRange?.winner||[]).reduce((a,s)=>a+s,0),n=(i.finishingPositionRange?.winner||[]).join("-")||"";return!e.minFinishingSum||r<e.minFinishingSum?{minFinishingSum:r,winnerFinishingPositionRange:n}:e},{minFinishingSum:0,winnerFinishingPositionRange:""})}function Mq(t){let e=t.length,i=t.filter(({sides:u})=>u?.some(({bye:c})=>c)).length||0,r=t.filter(({winningSide:u,matchUpStatus:c})=>u||Ki.includes(c)).length||0,n=t.filter(({schedule:u,matchUpStatus:c})=>u?.scheduledDate&&u?.scheduledTime&&c!=="BYE").length||0,a=e-i,s=a===r,o=a-n,l=a-n;return{unscheduledCount:o,incompleteCount:l,scheduledCount:n,completedCount:r,matchUpsCount:e,isScheduled:a===n,isComplete:s,byeCount:i}}function FN({tournamentRecords:t,schedulingProfile:e,tournamentRecord:i,withRoundId:r}){if(i&&!t){if(typeof i!="object")return{error:YS};t={[i.tournamentId]:i}}if(e){let a=xN({tournamentRecords:t,schedulingProfile:e});if(a.error)return a}if(!e&&t){let a=Wc({tournamentRecords:t});if(a.error)return a;e=a.schedulingProfile}if(!e)return{error:Br};let n={};return{profileRounds:e.map(({venues:a,scheduleDate:s})=>a.map(({rounds:o})=>o.map(l=>{let u=zx(l);return u.roundSegment?.segmentsCount&&(n[u.id]=u.roundSegment.segmentsCount),je({id:r?u.id:void 0,scheduleDate:s,...u})}))).flat(1/0),segmentedRounds:n}}function Md({court:t,date:e}){let i=e&&t.dateAvailability?.find(n=>pu(n.date,e)),r=t.dateAvailability?.find(n=>!n.date);return i||r}function RGe({court:t,date:e}){let i=Md({court:t,date:e}),r=new Map,n=[];return(i?.bookings||[]).forEach(a=>{if(typeof a.courtOrder=="number"){let s=a.rowCount||1;for(let o=0;o<s;o++)r.set(a.courtOrder+o,a)}else n.push(a)}),{gridBookings:r,timeBookings:n}}function LN({courtPrefix:t="C|",minRowsCount:e,courtsData:i,scheduledDate:r}){if(!Array.isArray(i))return{error:re};let n=i?.reduce((o,l)=>{let u=l.matchUps||[],c=Math.max(0,...u.map(d=>d.schedule.courtOrder||0));return Math.max(c,o)},1),a=Math.max(e||0,n),s=Ce(0,a).map(o=>({matchUps:Ce(0,i.length).map(l=>{let u=i[l],{courtId:c,venueId:d}=u;if(r){let{gridBookings:p}=RGe({court:u,date:r});if(p.has(o+1)){let f=p.get(o+1);return{schedule:{courtOrder:o+1,venueId:d,courtId:c},isBlocked:!0,booking:f}}}return{schedule:{courtOrder:o+1,venueId:d,courtId:c}}})}));return i.forEach((o,l)=>{for(let u of o.matchUps){let c=u.schedule?.courtOrder;c&&(s[c-1].matchUps[l]=u)}}),{courtPrefix:t,rows:s.map((o,l)=>Object.assign({rowId:`rowId-${l+1}`},...o.matchUps.map((u,c)=>({[`${t}${c}`]:u}))))}}var Tle={};dt(Tle,{getEntriesAndSeedsCount:()=>_N,getMaxEntryPosition:()=>hj});function _N({policyDefinitions:t,drawDefinition:e,drawSize:i,drawId:r,event:n,stage:a}){if(!n)return{error:ui};let{entries:s,stageEntries:o}=Aae({drawDefinition:e,drawId:r,stage:a,event:n}),l=o.length,{drawSize:u}=roe({participantsCount:l}),c=XU({drawSize:i??u,participantsCount:l,policyDefinitions:t});if(c.error)return q({result:c,stack:"getEntriesAndSeedsCount"});let{seedsCount:d}=c;return{entries:s,seedsCount:d,stageEntries:o}}function hj(t){let{entries:e=[],entryStatus:i,stage:r}=t;return Math.max(...e.filter(n=>(!r||r===n.entryStage)&&(!i||n.entryStatus===i)&&!isNaN(n.entryPosition)).map(({entryPosition:n})=>Ke(n||0)),0)}var Dle={};dt(Dle,{allCompetitionMatchUps:()=>No,allDrawMatchUps:()=>An,allEventMatchUps:()=>xu,allTournamentMatchUps:()=>Ur,analyzeMatchUp:()=>lw,calculateWinCriteria:()=>eg,checkMatchUpIsComplete:()=>vp,competitionScheduleMatchUps:()=>tT,drawMatchUps:()=>Pj,eventMatchUps:()=>BN,filterMatchUps:()=>Yu,getAllDrawMatchUps:()=>Zi,getAllStructureMatchUps:()=>At,getCheckedInParticipantIds:()=>Gh,getCompetitionMatchUps:()=>ow,getEventMatchUpFormatTiming:()=>Ij,getHomeParticipantId:()=>wj,getMatchUpCompetitiveProfile:()=>PU,getMatchUpContextIds:()=>Sj,getMatchUpDailyLimits:()=>jN,getMatchUpDailyLimitsUpdate:()=>vj,getMatchUpDependencies:()=>co,getMatchUpFormat:()=>Uj,getMatchUpFormatTiming:()=>EU,getMatchUpFormatTimingUpdate:()=>gj,getMatchUpScheduleDetails:()=>XM,getMatchUpType:()=>JM,getMatchUpsStats:()=>Tj,getModifiedMatchUpFormatTiming:()=>$N,getParticipantResults:()=>AU,getPredictiveAccuracy:()=>bj,getRoundMatchUps:()=>Sn,getRounds:()=>Dj,isValidMatchUpFormat:()=>$a,matchUpActions:()=>mN,participantScheduledMatchUps:()=>yj,tallyParticipantResults:()=>Wh,tournamentMatchUps:()=>VN,validMatchUp:()=>HM,validMatchUps:()=>Ka});function Ple({tournamentRecords:t,extensionName:e}){if(typeof t!="object"||!Object.keys(t).length)return{error:Mi};let i=[],r;for(let n of Object.values(t)){let{extension:a}=ht({element:n,name:e});a&&!r&&(i.push({params:{extension:a,discover:!0},method:"addExtension"}),r=!0);let s=n.events??[];for(let o of s){let{eventId:l}=o,{extension:u}=ht({name:e,element:o});u&&i.push({params:{eventId:l,extension:u},method:"addEventExtension"})}}return{methods:i}}function gj({tournamentRecords:t}){return Ple({extensionName:Uc,tournamentRecords:t})}var pk="ADULT",fk="JUNIOR",CT="WHEELCHAIR",Ele={[qd]:{allowModificationWhenMatchUpsScheduled:{courts:!1,venues:!1},defaultTimes:{averageTimes:[{categoryNames:[],minutes:{default:90}}],recoveryTimes:[{minutes:{[Bt]:30,default:60}}]},defaultDailyLimits:{[zt]:2,[Bt]:2,total:3},matchUpAverageTimes:[{matchUpFormatCodes:[Vs],averageTimes:[{categoryNames:[],minutes:{default:90}},{categoryTypes:[CT],minutes:{default:120}}]},{matchUpFormatCodes:["SET3-S:6/TB7-F:TB10"],averageTimes:[{categoryNames:[],minutes:{default:85}}]},{matchUpFormatCodes:["SET3-S:6/TB7-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:70}}]},{matchUpFormatCodes:["SET3-S:4NOAD-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:55}}]},{matchUpFormatCodes:["SET3-S:4/TB7"],averageTimes:[{categoryNames:[],minutes:{default:60}}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:50}}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB10"],averageTimes:[{categoryNames:[],minutes:{default:55}}]},{matchUpFormatCodes:["SET3-S:4/TB5@3"],averageTimes:[{categoryNames:[],minutes:{default:45}}]},{matchUpFormatCodes:["SET1-S:8/TB7","SET1-S:8/TB7@7"],averageTimes:[{categoryNames:[],minutes:{default:40}}]},{matchUpFormatCodes:["SET1-S:5/TB9@4"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:6/TB7"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:6NOAD"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:4/TB7","SET1-S:4/TB5@3","SET3-S:TB10","SET1-S:T20"],averageTimes:[{categoryNames:[],minutes:{default:20}}]},{matchUpFormatCodes:["SET1-S:4NOAD"],averageTimes:[{categoryNames:[],minutes:{default:20}}]},{matchUpFormatCodes:["SET1-S:TB10"],averageTimes:[{categoryNames:[],minutes:{default:10}}]}],matchUpRecoveryTimes:[{matchUpFormatCodes:["SET3-S:6/TB7","SET3-S:6/TB7-F:TB10","SET3-S:6/TB7-F:TB7"],recoveryTimes:[{categoryTypes:[pk,CT],minutes:{default:60,[Bt]:30}},{categoryTypes:[fk],minutes:{default:60,[Bt]:60}}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB7","SET3-S:4/TB7-F:TB10","SET3-S:4NOAD-F:TB7","SET3-S:4/TB7","SET3-S:4/TB5@3"],recoveryTimes:[{categoryTypes:[pk,CT],minutes:{default:30}},{categoryTypes:[fk],minutes:{default:60}}]},{matchUpFormatCodes:["SET1-S:8/TB7","SET1-S:8/TB7@7","SET1-S:5/TB9@4","SET1-S:6/TB7","SET1-S:6NOAD","SET1-S:4/TB7","SET1-S:4NOAD","SET3-S:TB10","SET1-S:T20"],recoveryTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:4/TB5@3"],recoveryTimes:[{categoryTypes:[pk,fk],minutes:{default:30}},{categoryTypes:[CT],minutes:{default:15}}]},{matchUpFormatCodes:["SET1-S:TB10"],recoveryTimes:[{categoryNames:[],minutes:{default:15}}]}],matchUpDailyLimits:[]}},CGe=Ele;function Ij({tournamentRecord:t,matchUpFormats:e,categoryType:i,event:r}){if(!r)return{error:ui};let n,a;if(e?.length){let d=[];n=e.map(p=>{let f=typeof p=="string"?{matchUpFormat:p}:p;if(!d.includes(f?.matchUpFormat)&&$a({matchUpFormat:f?.matchUpFormat}))return d.push(f.matchUpFormat),f}).filter(Boolean)}else{let{policy:d}=bf({policyType:ms,tournamentRecord:t,event:r});if(d?.matchUpFormats)n=d?.matchUpFormats;else{let{extension:p}=ht({name:Uc,element:r}),f,m;p?.value?{matchUpAverageTimes:f,matchUpRecoveryTimes:m}=p.value:{matchUpAverageTimes:f,matchUpRecoveryTimes:m}=CGe[qd],n=nt([...(f||[]).map(h=>h.matchUpFormatCodes),...(m||[]).map(h=>h.matchUpFormatCodes)].flat()).map(h=>({matchUpFormat:h})),a="default scheduling policy in use"}}let{eventType:s,eventId:o,category:l}=r,u=l?.categoryName??l?.ageCategoryCode??o;if(!o)return{error:ui};let c=n.map(({matchUpFormat:d,description:p})=>{let f=EU({tournamentRecord:t,matchUpFormat:d,categoryName:u,categoryType:i,eventType:s,event:r});return{matchUpFormat:d,description:p,...f}});return je({eventMatchUpFormatTiming:c,info:a})}function $N(t){let e=He(t,[{[hr]:!0},{[qr]:h=>$a({matchUpFormat:h}),[Ba]:QS,[LB]:!0}]);if(e.error)return e;let{tournamentRecord:i,matchUpFormat:r,event:n}=t,{extension:a}=ht({name:Uc,element:n}),s=a?.value,{extension:o}=ht({element:i,name:Uc}),l=o?.value,u=s?.matchUpAverageTimes&&Yy({...s,matchUpFormat:r}),c=l?.matchUpAverageTimes&&Yy({...l,matchUpFormat:r}),d=[u,c].find(h=>h),p=s?.matchUpRecoveryTimes&&Ky({...s,matchUpFormat:r}),f=l?.matchUpRecoveryTimes&&Ky({...l,matchUpFormat:r}),m=[p,f].find(h=>h);return{matchUpFormat:r,recoveryTimes:m,averageTimes:d}}function vj({tournamentRecords:t}){return Ple({extensionName:pU,tournamentRecords:t})}var eT=({scheduleAttributes:t=["scheduledDate","scheduledTime"],schedule:e={}})=>!!Object.keys(e).filter(i=>t.includes(i)).filter(i=>e[i]).length;function yj({scheduleAttributes:t=["scheduledDate","scheduledTime"],matchUps:e=[]}){if(!Ka(e))return{error:Nu};if(!Array.isArray(t))return{error:re};let i=e.filter(Boolean).filter(({schedule:r})=>eT({schedule:r,scheduleAttributes:t})).reduce((r,n)=>{let{schedule:a}=n,s=Ze(a?.scheduledDate),o=pi(a?.scheduledTime);return s&&o&&(r[s]?r[s].push(n):r[s]=[n]),r},{});return Object.keys(i).forEach(r=>{i[r].sort((n,a)=>qie(pi(n.schedule?.scheduledTime),pi(a.schedule?.scheduledTime)))}),{...W,scheduledMatchUps:i}}function MGe({tournamentRecords:t}){let e={},i=[];for(let r of Object.values(t))for(let n of r.events??[]){let a=Qa({event:n}),s=a?.drawDetails;wt(s)?(Object.assign(e,s),i.push(...Object.keys(s).filter(o=>O2({drawId:o,drawDetails:s})))):a?.drawIds?.length&&i.push(...a.drawIds)}return{drawIds:i,detailsMap:e}}function rE({schedulingProfile:t,matchUps:e=[]}){let i={},r=({eventId:o,drawId:l,structureId:u,roundNumber:c})=>`${o}|${l}|${u}${c}`;t?.length&&t.flatMap(({venues:o})=>o.map(({rounds:l})=>l)).forEach(o=>{o.sort((l,u)=>(l.sortOrder||0)-(u.sortOrder||0)).forEach(({eventId:l,drawId:u,structureId:c,roundNumber:d},p)=>{let f=r({eventId:l,drawId:u,structureId:c,roundNumber:d});i[f]=p})});let n=[],a={noScheduledDate:[]};for(let o of e){let l=o.schedule||{},u=l.scheduledDate&&Ze(l.scheduledDate)||l.scheduledTime&&Ze(l.scheduledTime)||"noScheduledDate";a[u]||(a[u]=[]),a[u].push(o)}let s=Object.keys(a).sort((o,l)=>o.localeCompare(l));for(let o of s){let l=a[o],u={noScheduledTime:[]};for(let d of l){let p=d.schedule||{},f=p.scheduledTime&&pi(p.scheduledTime)||"noScheduledTime";u[f]||(u[f]=[]),u[f].push(d)}for(let d of Object.keys(u)){let p=u[d].sort((f,m)=>(f.roundNumber||0)-(m.roundNumber||0));u[d]=p}let c=Object.keys(u).sort((d,p)=>d.localeCompare(p));for(let d of c){let p=u[d];p.sort((f,m)=>{let h=i[r(f)]||0,g=i[r(m)]||0;return h-g}),n.push(...p)}}return n}function BN(t){let{participants:e,contextContent:i,participantMap:r}=t,{tournamentAppliedPolicies:n,scheduleVisibilityFilters:a,participantsProfile:s,afterRecoveryTimes:o,policyDefinitions:l,useParticipantMap:u,tournamentRecord:c,usePublishState:d,contextFilters:p,matchUpFilters:f,contextProfile:m,nextMatchUps:h,tournamentId:g,inContext:I,context:v,event:w}=t;if(!w)return{error:ui};let{eventId:y,eventName:b,endDate:S,eventType:U,category:T,gender:P}=w??{},D={...v,...je({surfaceCategory:w.surfaceCategory??c?.surfaceCategory,indoorOutDoor:w.indoorOutdoor??c?.indoorOutdoor,tournamentId:g??c?.tournamentId,endDate:S??c?.endDate,eventName:b,eventType:U,category:T,eventId:y,gender:P})},E;!e&&c&&({participants:e,participantMap:r,groupInfo:E}=yf({participantsProfile:s,useParticipantMap:u,tournamentRecord:c,contextProfile:m,inContext:I})),m&&!i&&(i=Gc({policyDefinitions:l,tournamentRecord:c,contextProfile:m,event:w}));let R=Qa({event:w});return{...(w.drawDefinitions??[]).reduce((C,M)=>{let N=jv({hydrateParticipants:t.hydrateParticipants,context:D,tournamentAppliedPolicies:n,scheduleVisibilityFilters:a,tournamentParticipants:e,participantsProfile:s,afterRecoveryTimes:o,policyDefinitions:l,tournamentRecord:c,usePublishState:d,contextContent:i,contextFilters:p,matchUpFilters:f,participantMap:r,publishStatus:R,contextProfile:m,drawDefinition:M,nextMatchUps:h,inContext:I,event:w});return Object.keys(N)?.forEach(A=>{Array.isArray(N[A])&&(C[A]||(C[A]=[]),C[A]=C[A].concat(N[A]))}),C},{}),...W,groupInfo:E}}function VN(t){if(!t?.tournamentRecord)return{error:ve};let e=t.contextContent,{scheduleVisibilityFilters:i,participantsProfile:r,afterRecoveryTimes:n,policyDefinitions:a,tournamentRecord:s,inContext:o=!0,usePublishState:l,contextFilters:u,matchUpFilters:c,contextProfile:d,nextMatchUps:p,context:f}=t,m=t.tournamentId??s.tournamentId,h=s?.events??[],{participants:g,participantMap:I,groupInfo:v}=yf({participantsProfile:r,tournamentRecord:s,contextProfile:d,inContext:o});d&&!e&&(e=Gc({policyDefinitions:a,tournamentRecord:s,contextProfile:d}));let{appliedPolicies:w}=Dt({tournamentRecord:s}),y=u?.eventIds??[];return{...h.filter(b=>!y.includes(b.eventId)).map(b=>{let S={eventDrawsCount:Bi({event:b}).flightProfile?.flights?.length||b.drawDefinitions?.length||0,...f};return BN({hydrateParticipants:t.hydrateParticipants,context:S,tournamentAppliedPolicies:w,scheduleVisibilityFilters:i,participantsProfile:r,afterRecoveryTimes:n,policyDefinitions:a,tournamentRecord:s,usePublishState:l,contextFilters:u,contextProfile:d,contextContent:e,matchUpFilters:c,participantMap:I,participants:g,tournamentId:m,nextMatchUps:p,inContext:o,event:b})}).reduce((b,S)=>((S&&Object.keys(S).filter(U=>!["success","matchUpsMap"].includes(U)))?.forEach(U=>{Array.isArray(S[U])&&(b[U]||(b[U]=[]),b[U]=b[U].concat(S[U]),b.matchUpsCount!==void 0?b.matchUpsCount+=S[U].length:b.matchUpsCount=S[U].length)}),b),{matchUpsCount:0}),groupInfo:v,participants:g}}function ow({scheduleVisibilityFilters:t,hydrateParticipants:e,participantsProfile:i,tournamentRecords:r,useParticipantMap:n,policyDefinitions:a,usePublishState:s,matchUpFilters:o,contextFilters:l,nextMatchUps:u,inContext:c}){if(typeof r!="object"||!Object.keys(r).length)return{error:Mi};let d=Object.keys(r).map(m=>{let h=r[m];return VN({scheduleVisibilityFilters:t,hydrateParticipants:e,participantsProfile:i,policyDefinitions:a,tournamentRecord:h,usePublishState:s,matchUpFilters:o,contextFilters:l,nextMatchUps:u,inContext:c})}),p={},f={};return{...d.reduce((m,h)=>(Object.keys(h).forEach(g=>{if(g==="groupInfo")Object.assign(f,h[g]);else if(g==="participants")for(let I of h[g]??[])p[I.participantId]=I;else Array.isArray(h[g])&&(m[g]||(m[g]=[]),m[g]=m[g].concat(h[g]))}),m),{}),groupInfo:f,mappedParticipants:p}}function tT(t){if(typeof t?.tournamentRecords!="object"||!Object.keys(t?.tournamentRecords).length)return{error:Mi};let{courts:e,venues:i}=Fu(t),r=Wc(t).schedulingProfile,{sortDateMatchUps:n=!0,courtCompletedMatchUps:a,alwaysReturnCompleted:s,activeTournamentId:o,tournamentRecords:l,withCourtGridRows:u,minCourtGridRows:c,usePublishState:d,status:p=Xa,sortCourtsData:f}=t,m=o??Ah()??Object.keys(l)[0],h=d?kU({tournamentRecord:l[m],status:p}):void 0,g=s?ow({...t,matchUpFilters:{...t.matchUpFilters,matchUpStatuses:[Oi]},contextFilters:t.contextFilters}).completedMatchUps:[];if(d&&!jo(h?.orderOfPlay))return{completedMatchUps:g,dateMatchUps:[],courtsData:[],venues:i};let I,v;d&&({drawIds:I,detailsMap:v}=MGe({tournamentRecords:l})),I?.length&&(t.contextFilters??={},t.contextFilters.drawIds?t.contextFilters.drawIds=t.contextFilters.drawIds.filter(M=>I.includes(M)):t.contextFilters.drawIds=I),h?.eventIds?.length&&(t.matchUpFilters??={},t.matchUpFilters?.eventIds&&t.matchUpFilters.eventIds.length?t.matchUpFilters.eventIds=t.matchUpFilters.eventIds.filter(M=>h.eventIds.includes(M)):t.matchUpFilters.eventIds=h.eventIds),h?.scheduledDates?.length&&(t.matchUpFilters??={},t.matchUpFilters.scheduledDates&&t.matchUpFilters.scheduledDates.length?t.matchUpFilters.scheduledDates=t.matchUpFilters.scheduledDates.filter(M=>h.scheduledDates.includes(M)):t.matchUpFilters.scheduledDates=h.scheduledDates),s&&(t.matchUpFilters??={},t.matchUpFilters?.excludeMatchUpStatuses?.length?t.matchUpFilters.excludeMatchUpStatuses.includes(Oi)||t.matchUpFilters.excludeMatchUpStatuses.push(Oi):t.matchUpFilters.excludeMatchUpStatuses=[Oi]);let{completedMatchUps:w,upcomingMatchUps:y,pendingMatchUps:b,abandonedMatchUps:S,groupInfo:U,mappedParticipants:T}=ow({...t,matchUpFilters:t.matchUpFilters,contextFilters:t.contextFilters}),P=[...y??[],...b??[]];v&&(!I?.length||Object.keys(v).length)&&(P=P.filter(M=>{let{drawId:N,structureId:A,stage:O}=M;if(!jo(v?.[N]?.publishingDetail))return!1;let k=Object.keys(v[N].stageDetails??{});if(k.length){let x=k.filter($=>!jo(v[N].stageDetails[$])),L=k.filter($=>jo(v[N].stageDetails[$]));return x.length&&x.includes(O)?!1:L.length&&L.includes(O)?!0:x.length&&!x.includes(O)&&!L.length}let F=Object.keys(v[N].structureDetails??{});if(F.length){let x=F.filter($=>!jo(v[N].structureDetails[$])),L=F.filter($=>jo(v[N].structureDetails[$]));return x.length&&x.includes(A)?!1:L.length&&L.includes(A)?!0:x.length&&!x.includes(A)&&!L.length}return!0})),v&&d&&(P=P.filter(M=>{let{drawId:N,structureId:A,roundNumber:O}=M;if(!lt(O))return!0;let k=v[N]?.structureDetails?.[A];if(!k)return!0;let{scheduledRounds:F,roundLimit:x}=k;if(lt(x)&&O>x)return!1;if(F){let L=F[O];return L?jo(L):!1}return!0}));let D=n?rE({matchUps:P,schedulingProfile:r}):P,E=e?.map(M=>{let N=C(M);return{surfaceCategory:M?.surfaceCategory??"",matchUps:N,...M}}),R={completedMatchUps:s?g:w,mappedParticipants:t.hydrateParticipants?void 0:T,dateMatchUps:D,courtsData:E,groupInfo:U,venues:i};if(u){let M=t.matchUpFilters?.scheduledDate,{rows:N,courtPrefix:A}=LN({minRowsCount:Math.max(c||0,D.length||0),scheduledDate:M,courtsData:E});R.courtPrefix=A,R.rows=N}return{...R,...W};function C({courtId:M}){let N=(a?D.concat(w??[],S??[]):D).filter(A=>A.schedule?.courtId===M||A.schedule?.allocatedCourts?.map(({courtId:O})=>O).includes(M));return f?rE({matchUps:N,schedulingProfile:r}):N}}function jN({tournamentRecords:t,tournamentId:e}){if(typeof t!="object"||!Object.keys(t).length)return{error:Mi};let i=Object.keys(t).filter(n=>!e||n===e),r;return i.forEach(n=>{let a=t[n],{matchUpDailyLimits:s}=NGe({tournamentRecord:a});r=s}),{matchUpDailyLimits:r}}function NGe(t){let e=He(t,[{[hr]:!0}]);if(e.error)return e;let{tournamentRecord:i}=t,{policy:r}=bf({policyType:qd,tournamentRecord:i}),{extension:n}=ht({element:i,name:pU}),a=n?.value?.dailyLimits,s=r?.defaultDailyLimits;return{matchUpDailyLimits:a||s}}function bj(t){let{matchUps:e}=t,{singlesForDoubles:i,tournamentRecord:r,drawDefinition:n,excludeMargin:a,exclusionRule:s,zoneDoubling:o,matchUpType:l,scaleName:u,eventId:c,zonePct:d,drawId:p,event:f}=t;if(!r&&!e)return{error:ve};if(l&&![zt,Bt].includes(l))return{error:re,info:{matchUpType:l}};if(e&&!Ka(e))return{error:re,context:{matchUps:e}};let m=Dr[u],h=m?.ascending??t.ascending??!1,g=m?.accessor??t.valueAccessor,I=Array.isArray(m?.range)?Math.abs(m.range[0]-m.range[1]):0,v=lt(d)&&I?(d??0/100)*I:t.zoneMargin??I,w={withScaleValues:!0,withCompetitiveness:!0},y={matchUpTypes:l?[l]:[zt,Bt]},b=r?.participants;e?.[0]?.hasContext?p?e=e.filter(M=>M.drawId===p):c&&(e=e.filter(M=>M.eventId===c)):e??=p&&!n&&[]||!p&&c&&!f&&[]||p&&An({inContext:!0,drawDefinition:n,contextFilters:y,contextProfile:w,participants:b})?.matchUps||!p&&c&&xu({inContext:!0,contextFilters:y,contextProfile:w,participants:b,event:f})?.matchUps||Ur({tournamentRecord:r,contextFilters:y,contextProfile:w})?.matchUps||[],l&&(e=e.filter(M=>M.matchUpType===l));let S=e.filter(({winningSide:M,score:N,sides:A,matchUpStatus:O})=>![Sr,qt,ai,$v,Ta].includes(O??"")&&fr({score:N})&&A?.length===2&&M),U=kGe({matchUps:S,excludeMargin:a,exclusionRule:s,valueAccessor:g,ascending:h,scaleName:u}),T=!o||Pi(zt)(l)?v:(v||0)*2,P=v?S.map(({competitiveProfile:M,matchUpType:N,score:A,sides:O})=>{let k=Rle({singlesForDoubles:i,valueAccessor:g,matchUpType:N,scaleName:u,sides:O}),F=Math.abs(k[0].value-k[1].value);return{competitiveness:M?.competitiveness,valuesGap:F,score:A}}).filter(({valuesGap:M})=>M<=T):[],D=AGe({zoneData:P}),E=D&&Object.values(D).flat().length,R=E&&Object.assign({},...Object.keys(D).map(M=>({[M]:Math.round(1e4*D[M].length/E)/100}))),C=S.length-(P?.length||0);return{...W,relevantMatchUps:S,zoneDistribution:R,zoneData:P,accuracy:U,nonZone:C}}function AGe({zoneData:t}){let e={[h2]:[],[ew]:[],[tw]:[]};for(let i of t){let{competitiveness:r,score:n,valuesGap:a}=i;e[r]&&e[r].push({score:n,valuesGap:a})}return e}function Rle({singlesForDoubles:t,exclusionRule:e,valueAccessor:i,matchUpType:r,scaleName:n,sides:a}){let s=e?.range.sort(),o=l=>{let u=l?.[e?.valueAccessor];return{exclude:e&&u>=s[0]&&u<=s[1],exclusionValue:u}};return a.sort((l,u)=>l.sideNumber-u.sideNumber).map(({participant:l})=>{let u=[],c=l?.individualParticipants;if(c?.length){let d=[],p=0;for(let f of c){let{scaleValue:m,value:h}=Nq({singlesForDoubles:t,valueAccessor:i,participant:f,matchUpType:r,scaleName:n}),{exclude:g,exclusionValue:I}=o(m);g&&u.push(I),d.push(m),h&&!Number.isNaN(Number(p))?p+=h:p=void 0}return{participantName:l.participantName,exclusionValues:u,scaleValues:d,value:p}}else if(l){let{scaleValue:d,value:p}=Nq({singlesForDoubles:t,valueAccessor:i,matchUpType:r,participant:l,scaleName:n}),{exclude:f,exclusionValue:m}=o(d);return f&&u.push(m),{participantName:l.participantName,exclusionValues:u,scaleValue:d,value:p}}else return{}})}function Nq({singlesForDoubles:t,valueAccessor:e,matchUpType:i,participant:r,scaleName:n}){let a=t?zt:i,s=r?.rankings?.[a]?.find(u=>u.scaleName===n),o=(r?.ratings?.[a]?.find(u=>u.scaleName===n)||s)?.scaleValue,l=e?o?.[e]:o;return{scaleValue:o,value:l}}function kGe({excludeMargin:t,exclusionRule:e,valueAccessor:i,ascending:r,scaleName:n,matchUps:a}){let s={affirmative:[],negative:[],excluded:[]};for(let u of a)OGe({matchUp:u,accuracy:s,excludeMargin:t,exclusionRule:e,valueAccessor:i,ascending:r,scaleName:n});let o=s.affirmative.length+s.negative.length,l=o&&s.affirmative.length/o*100;return s.percent=l?Math.round(100*l)/100:0,s}function OGe({matchUp:t,accuracy:e,excludeMargin:i,exclusionRule:r,valueAccessor:n,ascending:a,scaleName:s}){let{matchUpType:o,sides:l,score:u,winningSide:c}=t;if(!c)return;if(r&&(!r.valueAccessor||!r.range)){e.error={info:"exclusionRule requires valueAccessor and range",error:Je};return}let d=c-1,p=Rle({exclusionRule:r,valueAccessor:n,matchUpType:o,scaleName:s,sides:l});if(xGe({exclusionRule:r,sideValues:p,accuracy:e,score:u,winningSide:c}))return;if(FGe(p)){e.excluded.push({scoreString:u?.scoreStringSide1,missingValues:!0,winningSide:c,sideValues:p});return}let f=p[d].value-p[1-d].value;if(LGe({excludeMargin:i,valuesGap:f})){e.excluded.push({scoreString:u?.scoreStringSide1,excludeMargin:i,winningSide:c,excludeGap:!0,sideValues:p,valuesGap:f});return}let m=a?f:f*-1,h=c===1?u?.scoreStringSide1:u?.scoreStringSide2;m>0?e.affirmative.push({winningScoreString:h,winningSide:c,sideValues:p,valuesGap:f,score:u}):e.negative.push({winningScoreString:h,winningSide:c,sideValues:p,valuesGap:f,score:u})}function xGe({exclusionRule:t,sideValues:e,accuracy:i,score:r,winningSide:n}){if(t){let a=e.flatMap(({exclusionValues:s})=>s);if(a.length)return i.excluded.push({scoreString:r?.scoreStringSide1,exclusionValues:a,winningSide:n,sideValues:e}),!0}return!1}function FGe(t){return t.filter(e=>![void 0,"",null].includes(e.value)).length<2}function LGe({excludeMargin:t,valuesGap:e}){let i=Number.parseFloat(t||0);return i&&Math.abs(e)<i}function eg({collectionDefinitions:t=[],collectionGroups:e=[]}){let i=0,{groupValueNumbers:r}=Dse({collectionGroups:e}),n;for(let a of t||[]){let{collectionValueProfiles:s,collectionGroupNumber:o,collectionValue:l,matchUpCount:u,matchUpValue:c,scoreValue:d,setValue:p}=a,f=o&&r.includes(o);if(lt(p||d))n=!0;else{if(f)continue;if(typeof l=="number"&&lt(l))i+=l;else if(Array.isArray(s)&&s?.length)for(let m of s)i+=m.matchUpValue;else typeof c=="number"&&lt(c)&&(i+=(u??0)*c)}}for(let a of e)i+=a.groupValue??0;return n||!i?{aggregateValue:!0,...W}:{valueGoal:Math.floor(i/2)+1,...W}}function wj(t){let{timeStamp:e,schedule:i,matchUp:r}=t,n=He(t,[{[Au]:!0}]);if(n.error)return n;let{itemValue:a,timeStamp:s}=Uf({timeItems:r?.timeItems||[],itemType:w2});return!i||s&&e&&new Date(s).getTime()>new Date(e).getTime()?{homeParticipantId:a}:i}function Sj({matchUps:t,matchUpId:e}){if(!Ka(t))return{error:re};let i=t.find(o=>o.matchUpId===e),{drawId:r,eventId:n,structureId:a,tournamentId:s}=i||{};return{matchUpId:e,drawId:r,eventId:n,structureId:a,tournamentId:s}}function Qv(t,e){if(!wt(t))return{error:re};if(!Array.isArray(e))return{error:re};let i={};for(let{param:r,error:n,attr:a}of e){let s=_Ge({params:t,param:r,attr:a,error:n});if(s?.error)return s;i[r]=s}return i}function _Ge({params:t,param:e,attr:i,error:r}){if(e===MM&&wt(t.drawDefinition)&&ni(t.structureId)){let n=(t.drawDefinition.structures??[]).find(({structureId:a})=>a===t.structureId);return!n.length&&r?{error:r}:{structure:n}}if(e===Au){let n=ble({...t,...i});return n.error&&r?{...n,error:r}:n}return{error:Br,info:{param:e}}}function Uj(t){let{structureId:e,matchUpId:i,event:r}=t,n=t.drawDefinition,a=He(t,[{[hr]:!0},{[jB]:{[EM]:!1,[Pl]:!1,[qre]:!1,[Bc]:!1}}]);if(a[js])return a;let s=Qv(t,[{[xv]:Au,[js]:Je}])?.matchUp;if(i&&s?.error)return s;!n&&s?.drawDefinition&&(n=s?.drawDefinition);let o=s?.structure;if(!o&&e&&!i){if(!n)return{error:xo};let p=tt({drawDefinition:n,structureId:e});if(p.error)return p;o=p.structure}let l=o?.matchUpFormat,u=n?.matchUpFormat,c=r?.matchUpFormat,d=s?.matchUp?.matchUpFormat||l||u||c;return{structureDefaultMatchUpFormat:l,eventDefaultMatchUpFormat:c,drawDefaultMatchUpFormat:u,matchUpFormat:d}}function Tj({profileBands:t,tournamentRecord:e,matchUps:i}){if(!Ka(i))return{error:Nu};let r=!t&&bf({policyType:qu,tournamentRecord:e}).policy,n=t||r?.profileBands||g2[qu].profileBands,a=i.filter(({winningSide:p})=>p),s=a.map(xne),o=(p,f)=>{let m=One(f,n);return p[m]+=1,p},l=Fne(s).reduce((p,f)=>o(p,f),{[h2]:0,[ew]:0,[tw]:0,[Rne]:0}),u=Object.keys(l).reduce((p,f)=>(l[f]||0)+p,0),c=Object.keys(l).map(p=>{let f=Number.parseFloat((l[p]/u).toFixed(4));return{[p]:f*100}}),d=a.filter(({matchUpStatus:p})=>p===Yz).length;return c.push({[Yz]:Number.parseFloat((d/u).toFixed(4))*100}),{competitiveBands:Object.assign({},...c),...W}}var{stageOrder:Aq}=PFe;function $Ge(t,e){return t.eventName.localeCompare(e.eventName)||t.eventId.localeCompare(e.eventId)||(Aq[t?.stage]||0)-(Aq[e?.stage]||0)||e.matchUpsCount-t.matchUpsCount||`${t.stageSequence}-${t.roundNumber}-${t.minFinishingSum}`.localeCompare(`${e.stageSequence}-${e.roundNumber}-${e.minFinishingSum}`)}function Dj({excludeScheduleDateProfileRounds:t,excludeScheduledRounds:e,excludeCompletedRounds:i,inContextMatchUps:r,tournamentRecords:n,schedulingProfile:a,tournamentRecord:s,withSplitRounds:o,matchUpFilters:l,scheduleDate:u,withRoundId:c,venueId:d,context:p}){if(r&&!Array.isArray(r||typeof r[0]!="object"))return{error:re,inContextMatchUps:r};if(s&&!n){if(typeof s!="object")return{error:YS};n={[s.tournamentId]:s}}let f=typeof n!="object"||!Object.keys(n).length;if((d||u||!r||!a&&(t||i||a||o))&&f)return{error:Mi};let m=Object.assign({},...Object.values(n??{}).map(({venues:S=[],tournamentId:U})=>({[U]:S?.map(({venueId:T})=>T)}))),h=Object.values(n??{}).map(({events:S=[],tournamentId:U,startDate:T,endDate:P})=>S.map(D=>({...D,validVenueIds:m[U],startDate:D.startDate??T,endDate:D.endDate??P}))).flat(),{segmentedRounds:g,profileRounds:I}=n&&(t||i||a||o)&&FN({tournamentRecords:n,schedulingProfile:a})||{},v=t&&Object.assign({},...I.map(S=>({[S.id]:S}))),w=r||n&&No({tournamentRecords:n,matchUpFilters:l})?.matchUps||[],y=[],b=w&&Object.values(w.reduce((S,U)=>{let T=zx(U).id,P=g?.[T],D=[...S[T]?.matchUps??[],U],{containerStructureId:E,stageSequence:R,structureName:C,tournamentId:M,isRoundRobin:N,matchUpType:A,roundNumber:O,roundOffset:k,structureId:F,eventName:x,roundName:L,drawName:$,eventId:V,drawId:_}=U,B=N?E:F;return{...S,[T]:{id:c?T:void 0,structureId:B,stageSequence:R,segmentsCount:P,structureName:C,tournamentId:M,matchUpType:A,roundNumber:O,roundOffset:k,eventName:x,roundName:L,drawName:$,matchUps:D,eventId:V,drawId:_}}},{})).map(S=>{let{minFinishingSum:U,winnerFinishingPositionRange:T}=EGe(S.matchUps),P=S.segmentsCount;if(P){let O=S.matchUps.length/P;return wr(S.matchUps.sort((k,F)=>k.roundPosition-F.roundPosition),O).map((k,F)=>{let{unscheduledCount:x,incompleteCount:L,matchUpsCount:$,isScheduled:V,isComplete:_,byeCount:B}=Mq(k),G=Cq({matchUps:S.matchUps,tournamentRecords:n,events:h,round:S});return je({...S,...p,roundSegment:{segmentsCount:P,segmentNumber:F+1},winnerFinishingPositionRange:T,unscheduledCount:x,incompleteCount:L,minFinishingSum:U,matchUpsCount:$,isScheduled:V,roundTiming:G,isComplete:_,byeCount:B,matchUps:k})})}let{unscheduledCount:D,incompleteCount:E,matchUpsCount:R,isScheduled:C,isComplete:M,byeCount:N}=Mq(S.matchUps),A=Cq({matchUps:S.matchUps,tournamentRecords:n,events:h,round:S});return je({...S,...p,winnerFinishingPositionRange:T,unscheduledCount:D,incompleteCount:E,minFinishingSum:U,matchUpsCount:R,isScheduled:C,roundTiming:A,isComplete:M,byeCount:N})}).flat().filter(S=>{if(t){let F=Ze(t),x=c?S.id:zx(S).id;if(F&&v[x]&&Ze(v[x].scheduleDate)===F)return!1}let{isComplete:U,isScheduled:T}=S,P=!i||!U,D=!e||!T,E=d||u?h?.find(({eventId:F})=>F===S.eventId):void 0,R=E?.startDate??s?.startDate,C=E?.endDate??s?.endDate,M=!u||!R||new Date(u)>=new Date(R),N=!u||!C||new Date(u)<=new Date(C),A=M&&N,O=!d||E?.validVenueIds.includes(d),k=P&&D&&O&&A;return k||y.push(S),k}).sort($Ge)||[];return{...W,rounds:b,excludedRounds:y}}function lw(t){let{matchUp:e,sideNumber:i,setNumber:r,isTiebreakValue:n,isPointValue:a}=t||{},{matchUpFormat:s}=t||{};if(!e)return{error:aa};s=s||e?.matchUpFormat;let o=qi(s),l=!!e?.winningSide,u=e.score?.sets,c=u?.length,d=r&&r-1,p=!!u?.find((B,G)=>B.setNumber===r&&G===d),f=u?.filter(B=>B?.winningSide)||[],m=f?.length||0,h=r&&u?.slice(r)||[],g=!!(c&&r&&h?.reduce((B,G)=>(!G||!G.side1Score&&!G.side2Score&&!G.side1TiebreakScore&&!G.side2TiebreakScore&&!G.side1PointScore&&!G.side2PointScore)&&B,!0)),I=r<=c&&u.find(B=>B.setNumber===r),v=I&&sw({setObject:I,matchUpScoringFormat:o}),{isCompletedSet:w,sideGameScores:y,sideTiebreakScores:b}=v||{},S=!!(I&&!w&&g||r&&r===c+1&&!l),U=[1,2].includes(i),T=U?i-1:0,P=I&&U&&(!n&&!a&&y[T]!==void 0&&y[T]||n&&b[T]!==void 0&&b[T]),D=!!P,E=f?.map(B=>sw({setObject:B,matchUpScoringFormat:o}).isValidSetOutcome).reduce((B,G)=>B&&G,!0),R=f.reduce((B,G)=>{let{winningSide:j}=G,K=j-1;return B[K]++,B},[0,0]),C=e?.winningSide,M=C&&C-1,N=1-M,A=R[M],O=R[N],k=Math.max(...R),F=Sa(R)[k],{bestOf:x,exactly:L}=o??{},$=Math.ceil((x||L||1)/2),V=k===$&&F===1&&R.indexOf(k)+1||void 0,_=A>O&&C===V;return{completedSetsHaveValidOutcomes:E,validMatchUpWinningSide:_,calculatedWinningSide:V,matchUpScoringFormat:o,validMatchUpOutcome:V&&E&&_,isLastSetWithValues:g,completedSetsCount:m,isCompletedMatchUp:l,isValidSideNumber:U,hasExistingValue:D,existingValue:P,isExistingSet:p,isActiveSet:S,...v}}function Pj({participants:t,tournamentAppliedPolicies:e,scheduleVisibilityFilters:i,participantsProfile:r,afterRecoveryTimes:n,policyDefinitions:a,useParticipantMap:s,tournamentRecord:o,usePublishState:l,contextFilters:u,contextContent:c,matchUpFilters:d,participantMap:p,publishStatus:f,contextProfile:m,drawDefinition:h,nextMatchUps:g,tournamentId:I,inContext:v,context:w,event:y}){let{eventId:b,eventName:S,endDate:U,eventType:T,category:P,gender:D}=y??{},E={...w,...je({surfaceCategory:y?.surfaceCategory??o?.surfaceCategory,indoorOutDoor:y?.indoorOutdoor??o?.indoorOutdoor,endDate:U??y?.endDate??o?.endDate,tournamentId:I??o?.tournamentId,eventName:S,eventType:T,category:P,eventId:b,gender:D})},R;return!t?.length&&o&&({participants:t,participantMap:p,groupInfo:R}=yf({participantsProfile:r,useParticipantMap:s,tournamentRecord:o,contextProfile:m,inContext:v})),y&&m&&!c&&(c=Gc({policyDefinitions:a,tournamentRecord:o,contextProfile:m,drawDefinition:h,event:y})),{...jv({context:E,tournamentAppliedPolicies:e,scheduleVisibilityFilters:i,tournamentParticipants:t,participantsProfile:r,afterRecoveryTimes:n,policyDefinitions:a,tournamentRecord:o,usePublishState:l,participantMap:p,contextContent:c,contextFilters:u,matchUpFilters:d,publishStatus:f,contextProfile:m,drawDefinition:h,nextMatchUps:g,inContext:v,event:y}),groupInfo:R}}var Cle={};dt(Cle,{getCompetitionVenues:()=>qU,getCourts:()=>Ej,getVenuesAndCourts:()=>Fu,publicFindVenue:()=>D2});function Ej({tournamentRecord:t,venueId:e,venueIds:i}){return t?{courts:(t.venues||[]).filter(r=>e?r.venueId===e:i?i.includes(r.venueId):!0).map(r=>{let{venueId:n}=r,a=Oe(r.courts||[]);return a.forEach(s=>Object.assign(s,{venueId:n})),a}).flat()}:{error:ve}}var Mle={};dt(Mle,{categoryCanContain:()=>nU,getCategoryAgeDetails:()=>$p,getEvent:()=>Mj,getEventProperties:()=>Rj,getEventStructures:()=>rN,getEventTimeItem:()=>IU,getEvents:()=>Cj,getFlightProfile:()=>Bi,getScaledEntries:()=>Zh});function Rj({tournamentRecord:t,event:e}){if(!t)return{error:ve};if(!e)return{error:ui};let i=e.entries||[],r=t.participants||[],n=e.category?.categoryName||e.category?.ageCategoryCode,{eventType:a}=e,s=new Set(i.map(d=>d.participantId)),o=r.filter(d=>s.has(d.participantId)),l,u,c;return{entryScaleAttributes:o.map(d=>{let{participantId:p,participantName:f,name:m}=d,h={scaleType:U2,eventType:a,scaleName:n},g=Xl({participant:d,scaleAttributes:h})?.scaleItem?.scaleValue;h={scaleType:Wne,eventType:a,scaleName:n};let I=Xl({participant:d,scaleAttributes:h})?.scaleItem?.scaleValue;h={scaleType:Hne,eventType:a,scaleName:n};let v=Xl({participant:d,scaleAttributes:h})?.scaleItem?.scaleValue;return l=!!(l||g),u=!!(u||I),c=!!(c||v),{participantId:p,participantName:f||m,seed:g,ranking:I,rating:v}}),hasSeededParticipants:l,hasRankedParticipants:u,hasRatedParticipants:c}}function Cj({tournamentRecord:t,withScaleValues:e,scaleEventType:i,inContext:r,eventIds:n,drawIds:a,context:s}){if(!t)return{error:ve};let{tournamentId:o}=t,l=(t.events??[]).filter(({eventId:c})=>!n||Array.isArray(n)&&n.includes(c)).map(c=>{let d=c.drawDefinitions?.map(Qb);if(a?.length&&!Li(a,d).length)return;let p=Oe(c);return r&&Object.assign(p,{tournamentId:o}),s&&Object.assign(p,s),p}).filter(Boolean),u={};if(e){let c=Ri({withScaleValues:!0,tournamentRecord:t}).participantMap,d=p=>p.reduce((f,m)=>f+Number.parseFloat(m),0);for(let p of l){let f=i??p.eventType,m=p.eventId;u[m]||(u[m]={ratingsStats:{},ratings:{},ranking:{},draws:{}});let h=(p.entries??[]).filter(({entryStatus:S})=>uo.includes(S)).map(yt),g=S=>{if(S?.ratings?.[f])for(let U of S?.ratings?.[f]??[]){let T=U.scaleName;u[m].ratings[T]||(u[m].ratings[T]=[]);let P=Dr[T]?.accessor;if(P){let D=Number.parseFloat(U.scaleValue?.[P]);D&&u[m].ratings[T].push(D)}}if(S?.rankings?.[f])for(let U of S?.rankings?.[f]??[]){let T=U.scaleName;u[m].ranking[T]||(u[m].ranking[T]=[]),U.scaleValue&&u[m].ranking[T].push(U.scaleValue)}};for(let S of h){let U=c?.[S]?.participant;if(U?.participantType===It)g(U);else for(let T of U?.individualParticipantIds??[]){let P=c?.[T]?.participant;g(P)}}let I=u[m].ratings;for(let S of Object.keys(I)){let U=I[S];if(!U.length)continue;let T=_z(U)?.toFixed(2);u[m].ratingsStats[S]={avg:Number.parseFloat((d(U)/U.length).toFixed(2)),median:T?Number.parseFloat(T):void 0,max:Math.max(...U),min:Math.min(...U)}}let v=(S,U)=>{let T=P=>{if(u[m].draws?.[S]&&P?.ratings?.[f])for(let D of P?.ratings?.[f]??[]){let E=D.scaleName;u[m].draws[S]?.ratings[E]||(u[m].draws[S].ratings[E]=[]);let R=Dr[E]?.accessor;if(R){let C=Number.parseFloat(D.scaleValue?.[R]);C&&u[m].draws[S].ratings[E].push(C)}}if(u[m].draws?.[S]&&P?.rankings?.[f])for(let D of P?.rankings?.[f]??[]){let E=D.scaleName;u[m].draws[S]?.ranking[E]||(u[m].draws[S].ranking[E]=[]);let R=D.scaleValue;R&&u[m].draws[S].ranking[E].push(R)}};for(let P of U.filter(Boolean)){let D=c?.[P]?.participant;if(D?.participantType===It)T(D);else for(let E of D?.individualParticipantIds??[]){let R=c?.[E]?.participant;T(R)}}},w=[],y=S=>a?.length&&a.includes(S)||w.includes(S);for(let S of p.drawDefinitions??[]){let U=S.drawId;if(y(U))continue;let T=Df({drawDefinition:S}).assignedParticipantIds??[];u[m].draws[U]||(u[m].draws[U]={ratingsStats:{},ratings:{},ranking:{}}),w.push(U),v(U,T)}let b=Bi({event:p}).flightProfile;for(let S of b?.flights??[]){let U=S.drawId;if(y(U))continue;let T=S.drawEntries.map(yt);v(U,T)}for(let S of w){let U=u[m].draws[S].ratings;for(let T of Object.keys(U)){let P=U[T];if(!P.length)continue;let D=_z(P)?.toFixed(2);u[m].draws[S].ratingsStats[T]={avg:Number.parseFloat((d(P)/P.length).toFixed(2)),median:D?Number.parseFloat(D):void 0,max:Math.max(...P),min:Math.min(...P)}}}}}return je({eventScaleValues:u,events:l,...W})}function Mj({tournamentRecord:t,drawDefinition:e,context:i,event:r}){if(!t)return{error:ve};if(!r)return{error:ui};let n=Oe(r);i&&Object.assign(n,i);let a=e&&n.drawDefinitions?.find(({drawId:s})=>e.drawId===s);return je({drawDefinition:a,event:n})}function BGe(t){let e="validateAndDeriveDrawValues",{appliedPolicies:i,policyDefinitions:r}=GGe(t),n=HGe({...t,policyDefinitions:r,appliedPolicies:i}),a=jGe(t),s=WGe({...t,consideredEntries:a,appliedPolicies:i});if(s?.error)return q({result:s,stack:e});let o=zGe({...t,consideredEntries:a}),l=VGe({...t,appliedPolicies:i,policyDefinitions:r,drawSize:o});if(l.error)return q({result:l,stack:e});let u=l.drawType;if(isNaN(o)&&u!==la)return q({result:{error:JS},stack:e});let c=r?.[Rs]??i?.[Rs],d=t.seedingProfile??c?.seedingProfile?.drawTypes?.[u??""]??c?.seedingProfile;t.seedingProfile&&(r[Rs]||(r[Rs]={...Wx[Rs]}),r[Rs].seedingProfile=d);let p=qGe({...t,drawType:u});return p?.error?q({result:p,stack:e}):{drawSize:o,drawType:u,enforceGender:n,seedingProfile:d,appliedPolicies:i,policyDefinitions:r}}function VGe(t){let{policyDefinitions:e,appliedPolicies:i,enforceMinimumDrawSize:r=!0,drawSize:n}=t,a=t.drawTypeCoercion??KU({drawType:t.drawType,policyDefinitions:e,appliedPolicies:i}),s=aoe({drawType:t.drawType,enforceMinimumDrawSize:r,drawTypeCoercion:a,drawSize:n});return s.error?s:{drawType:s.drawType}}function Nle(t){return t?.filter(e=>e.entryStatus&&[...uo,TU].includes(e.entryStatus))}function jGe({considerEventEntries:t=!0,drawEntries:e,eventEntries:i,qualifyingOnly:r}){return(r&&[]||Nle(e)||(t?i:[])).filter(({entryStage:n})=>!n||n===Ae)}function GGe(t){let{tournamentRecord:e,event:i}=t,r={...t?.appliedPolicies,...Dt({tournamentRecord:e,event:i}).appliedPolicies??{}},n=Oe(t.policyDefinitions??{},!1,!0);return{appliedPolicies:r,policyDefinitions:n}}function HGe({enforceGender:t,policyDefinitions:e,appliedPolicies:i}){return t??e?.[Cr]?.participants?.enforceGender??i?.[Cr]?.participants?.enforceGender}function WGe(t){let{consideredEntries:e,appliedPolicies:i,policyDefinitions:r,enforceGender:n,participantMap:a,participants:s,event:o}=t;return o&&s&&hN({consideredEntries:e,policyDefinitions:r,appliedPolicies:i,participantMap:a,enforceGender:n,participants:s,event:o})}function zGe(t){return!t.drawSize&&t.consideredEntries.length&&![la,oU,Ov,eo,gu].includes(t.drawType??"")&&Ev(t.consideredEntries.length)||t.drawSize&&Ke(t.drawSize)||!1}function qGe(t){let{tournamentRecord:e,event:i,ignoreAllowedDrawTypes:r,drawType:n}=t,a=!r&&e&&CN({tournamentRecord:e,categoryType:i?.category?.categoryType,categoryName:i?.category?.categoryName});return a?.length&&!a.includes(n)?{error:X$}:{...W}}function Ale(t){let{drawDefinition:e,appliedPolicies:i}=t,r=i?.[wc],n=kr({drawDefinition:e});return e.structures?.forEach(a=>{let s=Pd({structureId:a.structureId,matchUpsMap:n}),o=kne({roundNamingPolicy:r,drawDefinition:e,structure:a,matchUps:s}),{roundNamingProfile:l,roundProfile:u}=o;(a.structures||[a]).forEach(c=>{(c.matchUps??[]).forEach(d=>{let p=d?.roundNumber?.toString();if(p){let f=l?.[p]?.roundName,m=l?.[p]?.abbreviatedRoundName,h=u?.[p]?.feedRound;Object.assign(d,{abbreviatedRoundName:m,feedRound:h,roundName:f})}})})}),{drawDefinition:e}}function iT(t){let{voluntaryConsolation:e,tournamentRecord:i,event:r}=t,n="generateDrawDefinition",{participants:a,participantMap:s}=Ri({withIndividualParticipants:!0,convertExtensions:!0,internalUse:!0,tournamentRecord:i}),o=Nle(r?.entries)??[],l=BGe({...t,participantMap:s,participants:a,eventEntries:o});if(l.error)return q({result:l,stack:n});let{appliedPolicies:u,policyDefinitions:c,drawSize:d,drawType:p,enforceGender:f,seedingProfile:m}=l,h=r?.eventType,g=t.matchUpType??h,I=Bje({...t,enforceGender:f,eventType:h,matchUpType:g});if(I.error)return q({result:I,stack:n});let{matchUpFormat:v,tieFormat:w}=I;if(t.drawId&&typeof t.drawId!="string")return q({result:{error:re},stack:n});let y=mGe({...t,policyDefinitions:c,tournamentRecord:i,appliedPolicies:u,matchUpFormat:v,seedingProfile:m,participants:a,eventEntries:o,matchUpType:g,tieFormat:w,drawSize:d,drawType:p,event:r});if(y.error)return q({result:y,stack:n});let{existingDrawDefinition:b,positioningReports:S,drawDefinition:U,structureId:T,conflicts:P,entries:D}=y;if(!U)return q({result:{error:re},stack:n});let E=hGe({...t,existingDrawDefinition:b,positioningReports:S,appliedPolicies:u,drawDefinition:U,seedingProfile:m,participants:a,structureId:T,entries:D,params:t,stack:n});if(E.error)return E;let{qualifyingConflicts:R}=E;return U.drawName=t.drawName??(p&&Qr(p)),d&&typeof e=="object"&&d>=4&&V2({...e,drawDefinition:U,matchUpType:g}),t.hydrateRoundNames&&u?.[wc]&&Ale({drawDefinition:U,appliedPolicies:u}),{existingDrawDefinition:!!b,qualifyingConflicts:R,positioningReports:S,drawDefinition:U,structureId:T,...W,conflicts:P}}function YGe({matchUps:t,matchUpType:e}){if(!t)return{error:Nu};let i=[],r=[],n=0;e&&(t=t.filter(T=>T.matchUpType===e));let a=nt(t.map(({matchUpType:T})=>T));if(a.length>1)if(pm(a,ei))t=t.filter(Pi(ei));else if(pm(a,zt))t=t.filter(Pi(zt));else if(pm(a,Bt))t=t.filter(Pi(Bt));else return{};if(!Ka(t)||!t.length)return{};let s=(T,P)=>Ke(T)-Ke(P),o=nt(t.flatMap(T=>T.drawPositions).filter(Boolean)).sort(s),l=Ce(1,Math.max(...o)+1).filter(T=>!o.includes(T)).sort(s),{roundMatchUps:u}=Sn({matchUps:t}),c=u?.[1],d=u?.[2]??[],p=c?.[0],f=p?.drawId,m=p?.structureId,h=u?Object.keys(u).map(T=>Ke(T)):[],g=Math.max(...h),I=u?.[g]?.length??0,v=Math.ceil(Math.log(I)/Math.log(2)),w=Ce(1,v+1).map(T=>{let P=Math.pow(2,T-1),D=g+v-T+1;return Ce(1,P+1).map(E=>({drawId:f,structureId:m,matchUpId:Ct(),drawPositions:[],sides:[],roundNumber:D,roundPosition:E,finishingRound:T}))});v&&(t=t.concat(...w.flat()));let y=c?.map(T=>T.drawPositions)?.flat(1/0),b=d.map(T=>T.drawPositions).flat(1/0).filter(T=>!y?.includes(T)).sort(s),S=d.filter(T=>T.drawPositions?.find(P=>b.includes(P))).map(T=>{let P=T.drawPositions?.find(R=>b.includes(R)),D=P&&T.drawPositions?.indexOf(P),E=D!==void 0&&T.sides?.[D];return P&&{[P]:E}});if(l?.length&&b?.length===l?.length){let T=b.map((R,C)=>[R,l[C]].sort(s)),P=Object.assign({},...S),D=Oe(c?.[0].finishingRound,!1,!0),E=Oe(c?.[0].finishingPositionRange,!1,!0);r=T.map((R,C)=>{let M=Math.max(...R||[])/2,N=R?.map(A=>P[A]||{bye:!0,drawPosition:A});return{finishingPositionRange:E,sideNumber:C+1,matchUpStatus:"BYE",matchUpId:Ct(),finishingRound:D,roundNumber:1,drawPositions:R,roundPosition:M,structureId:m,drawId:f,sides:N}}),t=t.concat(...r)}let U=g+v;return Ce(1,U+1).forEach(T=>{let P=[],D=kq({matchUps:t,roundNumber:T}),E=kq({matchUps:t,roundNumber:T-1}),R=new Set(E.map(KGe).filter(Boolean)),C=D?.length===i?.length,M=D?.length===i?.length/2;T===1&&D.forEach(N=>{let A=N.drawPositions||[],{matchUpId:O,structureId:k}=N,F=[{...N.sides[0],drawPosition:A[0],matchUpId:O,structureId:k},{...N.sides[1],drawPosition:A[1],matchUpId:O,structureId:k}],x={...N,children:F};P.push(x)}),C?(n++,D.forEach((N,A)=>{let O=N.drawPositions||[],{matchUpId:k,structureId:F}=N,x=O.filter(Boolean).reduce((V,_)=>y?.includes(_)?V:_,void 0),L=[{...N.sides.filter(Boolean).reduce((V,_)=>_.participantId&&!R.has(_.participantId)?_:V,void 0),drawPosition:x,feedRoundNumber:n,sides:N.sides,matchUpId:k,structureId:F},i[A]],$={...N,children:L};P.push($)})):M&&D.forEach((N,A)=>{let O=[i[A*2],i[A*2+1]],k={...N,children:O};P.push(k)}),i=P}),{hierarchy:i[0],missingMatchUps:r,maxRound:g,finalRound:U,matchUps:t}}function kq({matchUps:t,roundNumber:e}){return t.filter(i=>i.roundNumber===e).sort((i,r)=>i.roundPosition-r.roundPosition)}function KGe(t){if(t.matchUpStatus==="BYE")return t.sides.reduce((e,i)=>i.participantId||e,void 0);if(t.winningSide)return t.sides.reduce((e,i)=>i.sideNumber===t.winningSide?i.participantId:e,void 0)}function kle({scaleAttributes:t,scaledEntries:e,stageEntries:i,seedsCount:r,scaleName:n}){if(!t)return{error:Je,info:"missing scaleAttributes"};let a=Object.assign({},...(e||[]).slice(0,r).map(({participantId:o},l)=>({[o]:l+1})));n=n||t.scaleName;let s=new Date().toISOString();return{scaleItemsWithParticipantIds:i.map(({participantId:o})=>({scaleItems:[{scaleValue:a[o],eventType:t.eventType,scaleType:Yl,scaleName:n,scaleDate:s}],participantId:o}))}}function XGe({tournamentRecord:t,drawDefinition:e,policyDefinitions:i,scaleAttributes:r,scaleName:n,drawSize:a,drawId:s,event:o,stage:l,sortDescending:u,scaleSortMethod:c}){let d=_N({policyDefinitions:i,drawDefinition:e,drawSize:a,drawId:s,event:o,stage:l});if(d.error)return d;let{entries:p,seedsCount:f,stageEntries:m}=d;if(!m||!f)return{error:re};let h=Zh({tournamentRecord:t,scaleAttributes:r,scaleSortMethod:c,sortDescending:u,entries:p,stage:l}).scaledEntries??[],{scaleItemsWithParticipantIds:g}=kle({scaleAttributes:r,scaledEntries:h,stageEntries:m,seedsCount:f,scaleName:n});return{scaleItemsWithParticipantIds:g}}var Ole={};dt(Ole,{addDrawEntries:()=>F2,addEventEntries:()=>Qo,addEventEntryPairs:()=>$le,destroyPairEntries:()=>Oae,destroyPairEntry:()=>B2,getEntriesAndSeedsCount:()=>_N,getMaxEntryPosition:()=>hj,modifyEntriesStatus:()=>qP,modifyEventEntries:()=>Ble,mutate:()=>xle,promoteAlternate:()=>Lle,promoteAlternates:()=>Aj,query:()=>Tle,removeDrawEntries:()=>_le,removeEventEntries:()=>xU,setEntryPosition:()=>Nj,setEntryPositions:()=>Fle});var xle={};dt(xle,{addDrawEntries:()=>F2,addEventEntries:()=>Qo,addEventEntryPairs:()=>$le,destroyPairEntries:()=>Oae,destroyPairEntry:()=>B2,modifyEntriesStatus:()=>qP,modifyEventEntries:()=>Ble,promoteAlternate:()=>Lle,promoteAlternates:()=>Aj,removeDrawEntries:()=>_le,removeEventEntries:()=>xU,setEntryPosition:()=>Nj,setEntryPositions:()=>Fle});function Nj({tournamentRecord:t,drawDefinition:e,participantId:i,entryPosition:r,skipRefresh:n,event:a}){let s="setEntryPositions";if(!t)return{error:ve};if(!i)return q({result:{error:dr},stack:s});if(r!==void 0&&!Number.isSafeInteger(r))return{error:re,entryPosition:r};(a?.entries||[]).forEach(l=>{l.participantId===i&&(l.entryPosition=r)}),(e?.entries||[]).forEach(l=>{l.participantId===i&&(l.entryPosition=r)});let o=l=>{l.entries.forEach(u=>{u.entryPosition===r&&u.participantId!==i&&(u.entryPosition+=.1)})};return n||(a?.entries&&(o(a),a.entries=wo({entries:a.entries})),e?.entries&&(o(e),e.entries=wo({entries:e.entries}))),{...W}}function Fle({tournamentRecord:t,entryPositions:e,drawDefinition:i,event:r}){if(!t)return{error:ve};if(!Array.isArray(e))return{error:re};for(let n of e){let{participantId:a,entryPosition:s}=n,o=Nj({skipRefresh:!0,tournamentRecord:t,drawDefinition:i,participantId:a,entryPosition:s,event:r});if(o.error)return o}return r?.entries&&(r.entries=wo({entries:r.entries})),i?.entries&&(i.entries=wo({entries:i.entries})),{...W}}function Lle(t){let{participantId:e}=t;return e&&typeof e!="string"?{error:re,participantId:e}:Aj({...t,participantIds:[e].filter(Boolean)})}function Aj({tournamentRecord:t,drawDefinition:e,participantIds:i,stageSequence:r,stage:n=Ae,eventId:a,event:s}){if(!t)return{error:ve};if(!Array.isArray(i))return{error:re,participantIds:i};if(!s)return{error:ui};let o="promoteAlternates";if(s){let l=Oq({element:s,participantIds:i,stageSequence:r,stage:n});if(l.error)return l}if(e){let l=Oq({element:e,participantIds:i,stageSequence:r,stage:n});if(l.error)return a?q({context:{drawPromotionError:l.error,drawId:e.drawId},result:{...W},stack:o}):l}return{...W}}function Oq({participantIds:t,stageSequence:e,element:i,stage:r}){let n=(i.entries||[]).filter(d=>d.entryStatus===Gs),a=(i.entries||[]).filter(d=>t.includes(d.participantId)),s=n.reduce((d,p)=>{let{entryPosition:f}=p;return isNaN(f)&&d||(!d||f<d.entryPosition)&&p||d},void 0),o=a.length?a:[s].filter(Boolean);if(!o?.length)return{error:rie};let l=o.filter(({entryStatus:d})=>d!==Gs);if(l.length)return{error:ox,invalidEntryStatus:l};let u=o.filter(({entryStage:d})=>d&&d!==r);if(u.length)return{error:i1e,invalidStage:u};let c=e&&o.filter(d=>d.stageSequence!==e);if(c?.length)return{error:r1e,invalidStageSequence:c};for(let d of o){d.entryStatus=ua;let p=d?.entryPosition;isNaN(p)||i.entries.forEach(m=>{m.entryStatus===Gs&&m.entryPosition>p&&(m.entryPosition=m.entryPosition-1)});let f=Math.max(...i.entries.filter(m=>m.entryStatus===ua&&!isNaN(m.entryPosition)).map(({entryPosition:m})=>Ke(m||0)),0);d.entryPosition=f||0}return{...W}}function _le({autoEntryPositions:t=!0,participantIds:e,drawDefinition:i,drawId:r,stages:n,event:a}){if(!a)return{error:ui};if(!r)return{error:xo};if(!e?.length)return{error:Wd};let s=Df({drawDefinition:i,stages:n}).assignedParticipantIds??[];if(xn(s,e))return{error:Nv};let o=c=>{let d=c.participantId;return!e.includes(d)},{flightProfile:l}=Bi({event:a}),u=l?.flights?.find(c=>c.drawId===r);return u?.drawEntries&&(u.drawEntries=u.drawEntries.filter(o),t&&(u.drawEntries=wo({entries:u.drawEntries}))),i?.entries&&(i.entries=i.entries.filter(o),t&&(i.entries=wo({entries:i.entries}))),{...W}}function Il(t){let e="addParticipant",{allowDuplicateParticipantIdPairs:i,returnParticipant:r,disableNotice:n,pairOverride:a,participant:s}=t,o=t.tournamentId?t.tournamentRecords?.[t.tournamentId]:t.tournamentRecord??(t.activeTournamentId&&t.tournamentRecords?.[t.activeTournamentId]);if(!o)return{error:ve};if(!s)return q({result:{error:Nh},stack:e});s.participantId||(s.participantId=Ct()),o.participants||(o.participants=[]);let{participantId:l,individualParticipantIds:u}=s;if(o.participants.reduce((h,g)=>g.participantId===l||h,!1))return{error:Qte};let{participantType:c,participantRole:d}=s;if(!c||!Object.keys(zy).includes(c))return{error:Mo,participantType:c};if(!d)return{error:Xte};let p=o.participants||[],f=p.filter(h=>h.participantType===It).map(h=>h.participantId);if(c!==It&&s.person)return{error:re,person:s.person};if(u&&!Array.isArray(u))return{error:re,individualParticipantIds:u};if(c===ft){if(s.person)return{error:re,person:s.person};if(s.individualParticipantIds){if(s.individualParticipantIds.length!==2&&!a)return q({info:"PAIR must be 2 individualParticipantIds",result:{error:Ia},stack:e});{let I=p.filter(v=>v.participantType===It).map(v=>v.participantId);if(!Array.isArray(s.individualParticipantIds))return q({result:{error:Ia},stack:e});if(!s.individualParticipantIds.reduce((v,w)=>I.includes(w)&&v,!0))return q({result:{error:Ia},stack:e})}}else return q({result:{error:Wd},stack:e});let h=p.filter(I=>I.participantType===ft).map(I=>({individualParticipantIds:I.individualParticipantIds,participant:I})),g=s.participantType===ft&&h.find(I=>Li(I.individualParticipantIds,s.individualParticipantIds).length===2);if(g&&!i)return{...W,existingParticipant:!0,participant:r&&Oe(g.participant)};if(!s.participantName){let I=p.filter(w=>s.individualParticipantIds?.includes(w.participantId)),v=I.map(w=>w.person?.standardFamilyName).filter(Boolean).join("/");I.length===1&&(v+="/Unknown"),s.participantName=v}}else if(c===It){if(!s.person?.standardFamilyName||!s.person?.standardGivenName)return{error:iie};if(!s.participantName){let h=`${s.person.standardFamilyName.toUpperCase()}, ${s.person.standardGivenName}`;s.participantName=h}}else if(c&&[_t,Ya].includes(c)){if(u||(s.individualParticipantIds=[]),s.individualParticipantIds?.length)for(let h of s.individualParticipantIds){if(typeof h!="string")return q({result:{participantId:h,error:re},stack:e});if(!f.includes(h))return q({result:{participantId:h,error:ji},stack:e})}}else return{error:Mo};o.participants.push(s),n||st({payload:{tournamentId:o.tournamentId,participants:[s]},topic:Td});let m={participant:r&&Oe(s),...W};return je(m)}function no({allowDuplicateParticipantIdPairs:t,returnParticipants:e,tournamentRecord:i,participants:r=[]}){if(!i)return{error:ve};i.participants||(i.participants=[]);let n=i.participants.map(d=>d.participantId)||[];r.forEach(d=>{d.participantId||(d.participantId=Ct())});let a=r.filter(d=>!n.includes(d.participantId)),s=r.filter(d=>n.includes(d.participantId)),o=a.filter(d=>d.participantType===It),l=a.filter(d=>d.participantType!==It),u=o.concat(...l),c=[];if(u.length){for(let p of u){let f=Il({allowDuplicateParticipantIdPairs:t,returnParticipant:!0,disableNotice:!0,tournamentRecord:i,participant:p});if(f.error)return f;f.success&&!f.existingParticipant&&c.push(f.participant)}c.length&&st({topic:Td,payload:{tournamentId:i.tournamentId,participants:c}});let d={participants:e&&Oe(c),addedCount:c.length,...W};return s.length&&Object.assign(d,{notAdded:s,info:dM}),je(d)}else return{info:"No new participants to add",addedCount:0,...W}}function $le(t){let e=He(t,[{[hr]:!0,[Bc]:!0}]);if(e.error)return e;let{allowDuplicateParticipantIdPairs:i,entryStatus:r=Gs,participantIdPairs:n=[],entryStage:a=Ae,tournamentRecord:s,drawDefinition:o,event:l,uuids:u}=t;if(l.eventType!==Bt)return{error:cu};let c=[],d=new Map;for(let y of s.participants??[]){let{participantType:b,participantId:S,person:U,individualParticipantIds:T}=y;b===It&&U?.sex?d.set(S,U.sex):b===ft&&T&&c.push(T)}let p=n.filter(y=>{if(y.length!==2)return!0;if(!l.gender||du(l.gender))return!1;if(!d.has(y[0])||!d.has(y[1]))return!0;let b=y.map(U=>d.get(U)),S=Yf(l.gender)&&(!Yf(b[0])||!Yf(b[1]))||up(l.gender)&&(!up(b[0])||!up(b[1]));return Aa(l.gender)&&(b.sort(ZM),(!up(b[0])||!Yf(b[1]))&&(S=!0)),S});if(p.length)return{error:Ia,invalidParticipantIdPairs:p};let f=n.map(y=>({participantId:u?.pop()??Ct(),participantRole:Jr,individualParticipantIds:y,participantType:ft})),m=i?f:f.filter(y=>!c.find(b=>Li(b,y.individualParticipantIds).length===2)),h,g=[];if(m){let y=no({allowDuplicateParticipantIdPairs:i,participants:m,returnParticipants:!0,tournamentRecord:s});if(y.error)return y;g=y.participants||[],h=y.info}let I=n.map(y=>{let b=g.find(U=>Li(U.individualParticipantIds,y).length===2);if(b)return b;let{participant:S}=ro({tournamentRecord:s,participantIds:y});return S}).map(y=>y.participantId),v=Qo({participantIds:I,tournamentRecord:s,drawDefinition:o,entryStatus:r,entryStage:a,event:l});m.length&&st({payload:{participants:m},topic:Td});let w=m.map(yt);return{...v,info:h,newParticipantIds:w}}function Ble({entryStatus:t=ua,unpairedParticipantIds:e=[],participantIdPairs:i=[],entryStage:r=Ae,tournamentRecord:n,event:a}){if(!n)return{error:ve};if(!a)return{error:ui};let s=n.participants??[],o=s.filter(h=>h.participantType===It).map(h=>h.participantId),l=e.concat(...i).flat(1/0).filter(h=>!o.includes(h));if(l.length)return{error:Ia,invalidParticipantIds:l};let u=i.filter(h=>h.length!==2);if(u.length)return{error:Ia,invalidParticipantIdPairs:u};let c=s.filter(h=>h.participantType===ft).map(h=>h.individualParticipantIds),d=i.filter(h=>!c.find(g=>Li(g,h).length===2)).map(h=>({participantType:ft,participantRole:Jr,individualParticipantIds:h})),p=no({participants:d,tournamentRecord:n});if(p.error)return p;let f=i.map(h=>{let{participant:g}=ro({tournamentRecord:n,participantIds:h});return g}).map(h=>({participantId:h,entryStatus:t,entryStage:r})),m=e.map(h=>({entryStatus:Us,participantId:h,entryStage:r}));return a.entries=(a.entries??[]).filter(h=>h.entryStage===r),a.entries=a.entries.concat(...f,...m),{...W}}var Vle={};dt(Vle,{addDrawDefinition:()=>rT,addEvent:()=>Zv,addFlight:()=>zN,assignSeedPositions:()=>eue,attachFlightProfile:()=>$j,categoryCanContain:()=>nU,deleteDrawDefinitions:()=>GN,deleteEvents:()=>iue,deleteFlightAndFlightDraw:()=>Qle,deleteFlightProfileAndFlightDraws:()=>qle,generate:()=>jle,generateEventsFromTieFormat:()=>Hle,getCategoryAgeDetails:()=>$p,getEvent:()=>Mj,getEventProperties:()=>Rj,getEventStructures:()=>rN,getEventTimeItem:()=>IU,getEvents:()=>Cj,getFlightProfile:()=>Bi,getScaledEntries:()=>Zh,modifyEvent:()=>rue,modifyEventMatchUpFormatTiming:()=>Yle,modifyPairAssignment:()=>Zle,mutate:()=>Wle,query:()=>Mle,refreshEventDrawOrder:()=>_j,removeEventMatchUpFormatTiming:()=>HN,removeScaleValues:()=>Bj,removeSeeding:()=>tue,setEventDates:()=>Fj,setEventDisplay:()=>WN,setEventEndDate:()=>xj,setEventStartDate:()=>Oj,updateDrawIdsOrder:()=>Lj,validateCategory:()=>Hb});var jle={};dt(jle,{generateEventsFromTieFormat:()=>Hle});function JGe({tournamentId:t,event:e}){return e?(st({payload:{tournamentId:t,event:e},key:e.eventId,topic:mne}),{...W}):{error:ui}}var QGe={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_D3",winCriteria:{valueGoal:5}},ZGe={collectionDefinitions:[{collectionName:"Doubles",collectionValue:1,matchUpCount:3,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES"},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_DEFAULT",winCriteria:{valueGoal:5}},eHe={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_JUCO",winCriteria:{valueGoal:5}},Gle={COLLEGE_D3:QGe,COLLEGE_DEFAULT:ZGe,COLLEGE_JUCO:eHe,DOMINANT_DUO:ore,DOMINANT_DUO_MIXED:ire,LAVER_CUP:pre,TEAM_DOUBLES_3_AGGREGATION:Jie,TIME_TENNIS_DUAL:rre,TIME_TENNIS_PRO_CIRCUIT:tre,USTA_BREWER_CUP:nre,USTA_OZAKI_CUP:are,USTA_COLLEGE:lre,USTA_GOLD_TEAM_CHALLENGE:Xie,USTA_INTERSECTIONAL:ere,USTA_LEVEL_1:ure,USTA_SECTION_BATTLE:Zie,USTA_SOUTHERN_LEVEL_5:Qie,USTA_TOC:fre,USTA_WTT_ITT:cre,USTA_ZONAL:dre};function Zv({suppressNotifications:t,tournamentRecord:e,internalUse:i,event:r}){if(!e)return{error:ve};if(e.events||(e.events=[]),!r)return{error:ui};let{startDate:n,endDate:a}=e;if(!i&&(r.entries?.length||r.drawDefinitions?.length)){let o=je({drawDefinitions:!!r.drawDefinitions?.length,entries:!!r.entries?.length});return{info:"entries/drawDefinitions cannot exist",error:re,context:o}}let s={eventType:$m,drawDefinitions:[],entries:[],startDate:n,endDate:a,...r};if(r.eventType===Ua){if(r.tieFormat){let o=Gn({tieFormat:r.tieFormat});if(o.error)return o}else if(r.tieFormatName){if(!Gle[r.tieFormatName])return{context:{tieFormatName:r.tieFormatName},error:re};let o=yc({isMock:e?.isMock,namedFormat:r.tieFormatName,event:r});s.tieFormat=o}}if(s.eventId||(s.eventId=Ct()),e.events.reduce((o,l)=>o||l.eventId===s.eventId,void 0))return{error:Rte};{let o=s;if(e.events.push(o),!t){let{topics:l}=bs();if(l.includes(_M)){let d=xu({event:r}).matchUps??[];Dd({tournamentId:e?.tournamentId,eventId:r.eventId,matchUps:d})}let{drawDefinitions:u,...c}=r;for(let d of u||[])mU({drawDefinition:d});JGe({tournamentId:e?.tournamentId,event:c})}return{...W,event:s}}}function Hle(t){let e=He(t,[{[PI]:{[RM]:!0,[Vre]:!0}},{[hr]:!0}]);if(e.error)return e;let i=t.tieFormat||yc({namedFormat:t.tieFormatName}),r=t.uuids||[Kie(i.collectionDefinitions.length)],n={[tr]:[],[zr]:[]};if(t.addEntriesFromTeams){let s=t.tournamentRecord.participants?.filter(o=>o.participantType===$n)?.flatMap(o=>o.individualParticipantIds??[]);for(let o of t.tournamentRecord.participants??[])if(s?.includes(o.participantId)){let l=o.person?.sex;if(l&&cl(l)){let u=ln(l);u&&n[u].push(o.participantId)}}}let a=[];for(let s of i.collectionDefinitions??[]){let o=r?.pop()?.toString()||Ct(),l=s.matchUpType,u=s.gender,c={matchUpFormat:s.matchUpFormat,eventName:s.collectionName,category:s.category,gender:u,eventType:l,eventId:o};if(t.addEntriesFromTeams){let d=l===bc?Us:t.entryStatus||ua,p=Aa(u)?[...n[tr],...n[zr]]:n[ln(u)||zu]??[];if(p.length){let f=Qo({participantIds:p,entryStatus:d,event:c});if(f.error)return f}}if(a.push(c),t.addEvents!==!1){let d=Zv({internalUse:!0,tournamentRecord:t.tournamentRecord,event:c});if(d.error)return d}}return{...W,events:a}}var Wle={};dt(Wle,{addDrawDefinition:()=>rT,addEvent:()=>Zv,addFlight:()=>zN,assignSeedPositions:()=>eue,attachFlightProfile:()=>$j,deleteDrawDefinitions:()=>GN,deleteEvents:()=>iue,deleteFlightAndFlightDraw:()=>Qle,deleteFlightProfileAndFlightDraws:()=>qle,modifyEvent:()=>rue,modifyEventMatchUpFormatTiming:()=>Yle,modifyPairAssignment:()=>Zle,refreshEventDrawOrder:()=>_j,removeEventMatchUpFormatTiming:()=>HN,removeScaleValues:()=>Bj,removeSeeding:()=>tue,setEventDates:()=>Fj,setEventDisplay:()=>WN,setEventEndDate:()=>xj,setEventStartDate:()=>Oj,updateDrawIdsOrder:()=>Lj,validateCategory:()=>Hb});function ey({removePriorValues:t=!0,status:e=Xa,statusObject:i,event:r}){if(!wt(i))return{error:re};let n=Qa({event:r,status:e}),a=`${Jd}.${Qd}`,s={itemValue:{[e]:{...n,...i}},itemType:a};return Jh({timeItem:s,removePriorValues:t,event:r})}function ty(t){let e=He(t,[{[hr]:!0,[Bc]:!0},{eventDataParams:!1,[qn]:Kn}]);if(e.error)return e;let{includePositionAssignments:i,removePriorValues:r,tournamentRecord:n,status:a=Xa,event:s,drawIdsToRemove:o,drawIdsToAdd:l}=t,{appliedPolicies:u}=Dt({tournamentRecord:n,event:s}),c={...u,...t.policyDefinitions},d=s?.drawDefinitions?.map(({drawId:b})=>b)??[],p=t.drawDetails?Object.keys(t.drawDetails):[],f=p.length?[]:t.drawIds,m=(l??[]).concat(...o??[],...f??[],...p),h=m.filter(b=>!d.includes(b));if(h.length)return q({result:{error:_a},context:{invalidDrawIds:h}});if(t.drawDetails)for(let b of Object.keys(t.drawDetails)){let S=t.drawDetails[b];if(S.publishingDetail?.embargo&&!rd(S.publishingDetail.embargo))return{error:Ng};if(S.stageDetails){for(let U of Object.keys(S.stageDetails))if(S.stageDetails[U].embargo&&!rd(S.stageDetails[U].embargo))return{error:Ng}}if(S.structureDetails)for(let U of Object.keys(S.structureDetails)){let T=S.structureDetails[U];if(T.embargo&&!rd(T.embargo))return{error:Ng};if(T.scheduledRounds){for(let P of Object.keys(T.scheduledRounds))if(T.scheduledRounds[P].embargo&&!rd(T.scheduledRounds[P].embargo))return{error:Ng}}}}let g=Qa({event:s,status:a}),I=Object.keys(g?.drawDetails||{}).filter(b=>d.includes(b)).reduce((b,S)=>(b[S]=g.drawDetails[S],b),{});for(let b of d)if((!m.length||m.includes(b))&&(o?.includes(b)||f?.length&&!f.includes(b)?I[b]={...I[b],publishingDetail:{published:!1}}:(l?.includes(b)||f?.includes(b)||!f?.length)&&(I[b]={...I[b],publishingDetail:{published:!0}})),t.drawDetails?.[b]){let S=t.drawDetails[b],U=S.structureDetails??I[b].structureDetails,T=S.stageDetails??I[b].stageDetails??{},{structureIdsToRemove:P=[],structureIdsToAdd:D=[],publishingDetail:E={},stagesToRemove:R=[],stagesToAdd:C=[]}=S;if((D||C)&&(E.published=!0),I[b]={publishingDetail:E,structureDetails:U,stageDetails:T},D.length||P.length){let N=(s?.drawDefinitions?.find(O=>O.drawId===b)?.structures??[]).map(({structureId:O})=>O),A=(D??[]).concat(P??[]).filter(O=>!N.includes(O));if(A.length)return q({result:{error:vi},context:{invalidStructureIds:A}});U=U??{};for(let O of N)P.includes(O)?U[O]={published:!1}:U[O]={published:!0};I[b].structureDetails=U}let M=(s?.drawDefinitions?.find(N=>N.drawId===b)?.structures??[]).map(({stage:N})=>N);if(C.length){for(let N of C)T[N]={published:!0};for(let N of M)T[N]||(T[N]={published:!1})}if(C.length||R.length){for(let N of R)T[N]={published:!1};for(let N of M)T[N]||(T[N]={published:!0})}(C.length||R.length)&&(I[b].stageDetails=T)}ey({statusObject:{drawDetails:I},removePriorValues:r,status:a,event:s});let{topics:v}=bs(),w=v.includes(bx),y=w||t.returnEventData?YU({includePositionAssignments:i,...t.eventDataParams,usePublishState:!0,tournamentRecord:n,policyDefinitions:c,event:s})?.eventData:void 0;return w&&st({payload:{eventData:y,tournamentId:n.tournamentId},topic:bx}),{...W,eventData:y}}var zle="deleteDrawDefinitions",qx="autoSchedulingAudit",yD="deleteEvents",tHe={AUTO_SCHEDULING_AUDIT:qx,DELETE_EVENTS:yD,DELETE_DRAW_DEFINITIONS:zle};function GN(t){if(!t.tournamentRecord)return{error:ve};let e="deleteDrawDefinitions",i=t.drawIds??[],r=t.event,{autoPublish:n=!0,tournamentRecord:a,auditData:s,eventId:o,force:l}=t,{appliedPolicies:u}=Dt({tournamentRecord:a,event:r}),c={...u,...t.policyDefinitions},d=Array.isArray(i)?i[0]:void 0;if(!r){let T=Wn({tournamentRecord:a,eventId:o,drawId:d});if(T.error)return T;r=T.event}let p=[],f=[],m=[];if(!r?.drawDefinitions)return q({info:"event has no drawDefinition",result:{...W},stack:e});let h=r.drawDefinitions.map(({drawId:T})=>T);if(i.length||(i=h),i=i.filter(T=>h.includes(T)),!i.length)return q({info:"nothing to do; no matching drawIds in event.",result:{...W},stack:e});let g=Oe(Bi({event:r}).flightProfile,!1,!0),I=({participantId:T,drawPosition:P,qualifier:D,bye:E})=>({bye:E,qualifier:D,drawPosition:P,participantId:T}),v=l??u?.[ms]?.allowDeletionWithScoresPresent?.drawDefinitions,w=Qa({event:r})??{},y=w.drawIds??(w.drawDetails&&Object.keys(w.drawDetails))??[],b,S=[],U=r.drawDefinitions.filter(T=>{if(i.includes(T.drawId)){let P=An({event:r,drawDefinition:T})?.matchUps??[];if(P.some(({score:F})=>fr({score:F}))&&!v)return S.push(T.drawId),!0;let{drawId:D,drawType:E,drawName:R}=T,C=g?.flights?.find(F=>F.drawId===T.drawId);C&&(C.drawEntries=C.drawEntries?.filter(F=>uo.includes(F.entryStatus))),y.includes(D)&&(y=y.filter(F=>F!==D),b=!0);let M=io({stageSequence:1,drawDefinition:T,stage:Ae})?.structures?.[0],N=(M?AI({structureId:M.structureId,tournamentRecord:a,drawDefinition:T}):void 0)?.positionAssignments?.map(I),A=io({stage:ze,drawDefinition:T})?.structures,O=A?.length?A.map(F=>{let x=F.stageSequence;return{positionAssignments:AI({structureId:F.structureId,tournamentRecord:a,drawDefinition:T})?.positionAssignments.map(I),stageSequence:x}}):void 0,k={action:zle,payload:{drawDefinitions:[T],eventId:o??r?.eventId,auditData:s}};m.push(k),p.push(je({tournamentId:a.tournamentId,eventId:o??r?.eventId,qualifyingPositionAssignments:O,positionAssignments:N,auditData:s,drawType:E,drawName:R,drawId:D})),P?.forEach(({matchUpId:F})=>f.push(F))}return!i.includes(T.drawId)});if(S.length&&!l)return q({context:{drawIdsWithScoresPresent:S},result:{error:tU},stack:e});if(r.drawDefinitions=U,g&&Yd({event:r,extension:{name:to,value:g}}),ZU({tournamentRecord:a}),b){let T={};for(let D of y)T[D]=w.drawDetails?.[D]??{published:!0};let P=ey({statusObject:{drawDetails:T},event:r});if(P.error)return{error:P.error}}if(m.length)if(IM(Zu)){let T=a.tournamentId;st({topic:Zu,payload:{tournamentId:T,detail:m}});let P=(Ss({element:r,itemType:Ip})?.timeItem?.itemValue||0)+1;Cl({element:r,timeItem:{itemType:Ip,itemValue:P},removePriorValues:!0})}else iHe({appliedPolicies:u,event:r,deletedDrawsDetail:p,auditData:s});if(f.length&&ku({tournamentId:a?.tournamentId,matchUpIds:f}),i.forEach(T=>uLe({drawId:T})),n&&b){let T=ty({...t.eventDataParams,drawIdsToRemove:i,policyDefinitions:c,tournamentRecord:a,event:r});if(T.error)return{...W,info:T.error}}return{...W}}function iHe({appliedPolicies:t,event:e,deletedDrawsDetail:i,auditData:r}){if(t?.audit?.[Ip]===!1)return;let{extension:n}=ht({name:Ip,element:e}),a={...r,deletedDrawsDetail:i},s={value:Array.isArray(n?.value)?n?.value.concat(a):[a],name:Ip};Ft({element:e,extension:s})}function qle({autoPublish:t=!0,tournamentRecord:e,auditData:i,event:r,force:n}){if(!e)return{error:ve};if(!r)return{error:ui};let{flightProfile:a}=Bi({event:r});if(a){let s=a.flights?.map(({drawId:l})=>l).filter(Boolean),o=GN({eventId:r.eventId,tournamentRecord:e,autoPublish:t,auditData:i,drawIds:s,event:r,force:n});return o.error?o:OM({event:r,name:to})}return{...W}}function kj(t){let{matchUpFormat:e,recoveryTimes:i,averageTimes:r,tournamentId:n,eventId:a}=t,s=t?.tournamentRecords??(t?.tournamentRecord&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord})??{};if(!Object.keys(s).length)return{error:Mi};let o=Object.keys(s).filter(u=>!n||n===u);if(n&&!o.includes(n))return{error:re};let l;for(let u of o){let c=s[u],{event:d}=Wn({tournamentRecord:c,eventId:a});a&&d&&(l=!0);let p=rHe({tournamentRecord:c,event:d,matchUpFormat:e,averageTimes:r,recoveryTimes:i});if(p.error)return p}return!a||l?{...W}:{error:ps}}function rHe({tournamentRecord:t,recoveryTimes:e,matchUpFormat:i,averageTimes:r,event:n}){if(!t)return{error:ve};if(r&&!Array.isArray(r))return{error:re};if(e&&!Array.isArray(e))return{error:re};let a=Uc;if(n){let{extension:s}=ht({element:n,name:a}),o=s?.value||{},l=xq({...o,matchUpFormat:i,averageTimes:r,recoveryTimes:e});Ft({element:n,extension:{name:a,value:l}})}else{let{extension:s}=ht({element:t,name:a}),o=s?.value||{},l=xq({...o,matchUpFormat:i,averageTimes:r,recoveryTimes:e});Ft({extension:{name:a,value:l},element:t})}return{...W}}function xq(t){let{matchUpRecoveryTimes:e=[],matchUpAverageTimes:i=[],matchUpFormat:r}=t,{averageTimes:n,recoveryTimes:a}=t;n=(n||[]).filter(l=>l?.categoryNames?.length||l?.categoryTypes?.length);let s=n?.length&&i.map(l=>l?.matchUpFormatCodes.includes(r)?{...l,matchUpFormatCodes:l.matchUpFormatCodes?.filter(u=>u!==r)}:l).filter(({matchUpFormatCodes:l})=>l?.length).concat({matchUpFormatCodes:[r],averageTimes:n});a=(a||[]).filter(l=>l?.categoryNames?.length||l?.categoryTypes?.length);let o=a?.length&&e.map(l=>l?.matchUpFormatCodes.includes(r)?{...l,matchUpFormatCodes:l.matchUpFormatCodes?.filter(u=>u!==r)}:l).filter(({matchUpFormatCodes:l,averageTimes:u})=>l?.length||u).concat({matchUpFormatCodes:[r],recoveryTimes:a});return{matchUpAverageTimes:s?.length&&s||i,matchUpRecoveryTimes:o?.length&&o||e}}function Yle(t){let{tournamentRecord:e,recoveryMinutes:i,averageMinutes:r,matchUpFormat:n,categoryType:a,eventId:s,event:o}=t;if(!e)return{error:ve};if(!$a({matchUpFormat:n}))return{error:re};if(!o)return{error:ui};let{averageTimes:l=[],recoveryTimes:u=[]}=$N({tournamentRecord:e,matchUpFormat:n,event:o}),c=o.category,d=c?.categoryName||c?.ageCategoryCode||o?.eventId,p={categoryNames:[d],minutes:{}},f={categoryNames:[d],minutes:{}},m=w=>{if(w.categoryTypes?.includes(a)&&console.log("encountered:",{categoryType:a}),!(w.categoryNames?.includes(d)&&(w.categoryNames=w.categoryNames.filter(y=>y!==d),p={minutes:w.minutes,categoryNames:[d]},!w.categoryNames.length)))return w},h=r&&!isNaN(Ke(r)),g=i&&!isNaN(Ke(i)),I=l.map(m).filter(w=>w?.categoryNames?.length),v=u.map(m).filter(w=>w?.categoryNames?.length);return h&&(Object.assign(p.minutes,{[o?.eventType||zt]:r}),I.push(p)),g&&(Object.assign(f.minutes,{[o?.eventType||zt]:i}),v.push(f)),!h&&!g?{error:re}:kj({averageTimes:h&&I,recoveryTimes:g&&v,tournamentRecord:e,matchUpFormat:n,eventId:s})}function HN(t){if(t.event)return Fq({event:t.event});{t.tournamentRecord&&!t.tournamentRecords&&(t.tournamentRecords={[t.tournamentRecord.tournamentId]:t.tournamentRecord});let e=He(t,[{[pn]:!0,[zre]:!0}]);if(e.error)return e;let{tournamentRecords:i,eventId:r}=t;for(let n of Object.values(i??{})){let{event:a}=Wn({tournamentRecord:n,eventId:r});if(a)return Fq({event:a})}}return{error:ps}}function Fq({event:t}){return OM({event:t,name:Uc})}var Kle={MON:"MON",TUE:"TUE",WED:"WED",THU:"THU",FRI:"FRI",SAT:"SAT",SUN:"SUN"};function Xle(t){return!Array.isArray(t)||nt(t).length!==t.length?!1:t.every(e=>Object.keys(Kle).includes(e))}function Oj({tournamentRecord:t,event:e,startDate:i}){if(!t)return{error:ve};if(!e)return{error:ui};if(!dl.test(i))return{error:or};let r=Jle(t),n="setEventStartDate";if(r.error)return q({result:r,stack:n});let{tournamentStartDate:a,tournamentEndDate:s}=r,o=new Date(Ze(i)).getTime();if(!a||!s||o<a||o>s)return q({result:{error:or},stack:n,info:"startDate must be within tournament start and end dates"});let l=e.endDate&&new Date(Ze(e.endDate)).getTime();return l&&o>l&&(e.endDate=i),e.startDate=i,{...W}}function xj(t){let{tournamentRecord:e,event:i,endDate:r}=t;if(!e)return{error:ve};if(!i)return{error:ui};if(!dl.test(r))return{error:or};let n=Jle(e);if(n.error)return n;let{tournamentStartDate:a,tournamentEndDate:s}=n,o=new Date(Ze(r)).getTime();if(!a||!s||o<a||o>s)return{error:or};let l=i.startDate&&new Date(Ze(i.startDate)).getTime();return l&&o<l&&(i.startDate=r),i.endDate=r,{...W}}function Fj(t){let e="setEventDates",i=He(t,[{tournamentRecord:!0,event:!0},{[qr]:u=>dl.test(u),[Ba]:or,startDate:!1,endDate:!1},{[qr]:u=>u.filter(Boolean).every(c=>dl.test(c)),[Ba]:or,activeDates:!1},{[qr]:Xle,weekdays:!1}]);if(i.error)return i;let{tournamentRecord:r,weekdays:n,event:a,startDate:s,endDate:o}=t,l=t.activeDates?.filter(Boolean);if(s&&o){let u=new Date(Ze(s)).getTime(),c=new Date(Ze(o)).getTime();if(u>c)return q({result:{error:re},stack:e,info:"startDate cannot be after endDate"})}if(l){let u=s||r.startDate,c=o||r.endDate,d=!u||l.every(f=>new Date(f)>=new Date(u)),p=!c||l.every(f=>new Date(f)<=new Date(c));if(!d||!p)return q({result:{error:or},stack:e})}if(s){let u=Oj({tournamentRecord:r,event:a,startDate:s});if(u.error)return q({result:u,stack:e})}if(o){let u=xj({tournamentRecord:r,event:a,endDate:o});if(u.error)return q({result:u,stack:e})}return l&&(a.activeDates=l),n&&(a.weekdays=n),{...W}}function Jle(t){let{startDate:e,endDate:i}=t;return!dl.test(e)||!dl.test(i)?q({result:{error:Wte},context:{startDate:e,endDate:i}}):{tournamentStartDate:new Date(Ze(e)).getTime(),tournamentEndDate:new Date(Ze(i)).getTime()}}function Lj({event:t,orderedDrawIdsMap:e}){if(typeof t!="object")return{error:ui};if(!e)return{error:Je,info:"Missing drawIdsOrderMap"};if(typeof e!="object")return{error:re,info:"orderedDrawIdsMap must be an object"};let i=Object.values(e);if(!i.every(n=>!Number.isNaN(Number(n))))return{error:re,info:"drawOrder must be numeric"};if(nt(i).length!==i.length)return{info:"drawOrder values must be unique",error:re};if(t.drawDefinitions?.length){let n=(t.drawDefinitions||[]).map(({drawId:s})=>s),a=Object.keys(e);if(a?.length&&Li(n,a).length!==n.length)return{error:re,info:"Missing drawIds"};t.drawDefinitions.forEach(s=>{s.drawOrder=e[s.drawId]})}let{flightProfile:r}=Bi({event:t});return r?.flights?.forEach(n=>{n.flightNumber=e[n.drawId]}),{...W}}function _j({tournamentRecord:t,event:e}){if(!t)return{error:ve};if(!e)return{error:ui};let{flightProfile:i}=Bi({event:e}),r=i?.flights?.sort((s,o)=>s.flightNumber-o.flightNumber).map(s=>s.drawId).filter(Boolean),n=e.drawDefinitions?.sort((s,o)=>s.drawOrder-o.drawOrder).map(s=>s.drawId).filter(Boolean).filter(s=>!r?.includes(s)),a=Object.assign({},...[...r||[],...n||[]].map((s,o)=>({[s]:o+1})));return a?Lj({event:e,orderedDrawIdsMap:a}):{...W}}function Qle({autoPublish:t=!0,tournamentRecord:e,auditData:i,drawId:r,event:n,force:a}){if(!e)return{error:ve};if(!r)return{error:xo};if(!n)return{error:ui};let{flightProfile:s}=Bi({event:n});if(s&&s.flights?.find(o=>o.drawId===r)){let o=s.flights.filter(u=>u.drawId!==r),l={name:to,value:{...s,flights:o}};Yd({event:n,extension:l})}if(n.drawDefinitions?.find(o=>o.drawId===r)){let o=GN({drawIds:[r],eventId:n.eventId,tournamentRecord:e,autoPublish:t,auditData:i,event:n,force:a});if(o.error)return o}return _j({tournamentRecord:e,event:n})}function Zle(t){let e=He(t,[{[Bc]:!0,[hr]:!0,[VB]:!1},{replacementIndividualParticipantId:!0,[qr]:g=>ni(g),existingIndividualParticipantId:!0,[js]:dr,participantId:!0}]),{replacementIndividualParticipantId:i,existingIndividualParticipantId:r,tournamentRecord:n,drawDefinition:a,participantId:s,event:o,uuids:l}=t;if(e.error)return e;if(o?.eventType!==fs)return{error:cu};if(!(o?.entries?.filter(({entryStatus:g})=>[Us,wf].includes(g)).map(({participantId:g})=>g)||[]).includes(i))return{error:Co};let u=(n.participants||[]).find(g=>g.participantId===s);if(u?.participantType!==ft)return{error:_p,participant:u};let c=u.individualParticipantIds,d=[i,...c.filter(g=>g!==r)],{participant:p}=ro({participantIds:d,tournamentRecord:n}),f;if(p)f=p.participantId;else{let g={participantId:l?.pop(),participantRole:Jr,individualParticipantIds:d,participantType:ft},I=Il({participant:g,returnParticipant:!0,tournamentRecord:n});if(I.error)return I;f=I.participant.participantId}let{flightProfile:m}=Bi({event:o});if(a){let g=m?.flights?.find(({drawId:I})=>I===a.drawId);g&&(g.drawEntries=g.drawEntries.map(I=>I.participantId===s?{...I,participantId:f}:I)),a.entries=a.entries.map(I=>I.participantId===s?{...I,participantId:f}:I);for(let I of a.structures||[])if(I.structures){I.positionAssignments=void 0;for(let v of I.structures)v.positionAssignments=v.positionAssignments.map(w=>w.participantId===s?{...w,participantId:f}:w)}else I.positionAssignments&&(I.positionAssignments=I.positionAssignments.map(v=>v.participantId===s?{...v,participantId:f}:v))}o.entries=o.entries.map(g=>g.participantId===s&&{...g,participantId:f}||g.participantId===i&&{...g,participantId:r}||g);let h=n.events.some(({entries:g,eventId:I,drawDefinitions:v})=>o.eventId===I?v.some(({drawId:w,entries:y})=>w===a?.drawId?!1:y?.find(b=>b.participantId===s)):g?.find(w=>w.participantId===s));if(!h){let g=qh({addIndividualParticipantsToEvents:!1,participantIds:[s],tournamentRecord:n});if(g.error)return g}return{...W,participantOtherEntries:h,newPairParticipantId:f}}function rT(t){let{flight:e,suppressNotifications:i,modifyEventEntries:r,existingDrawCount:n,allowReplacement:a,checkEntryStatus:s,tournamentRecord:o,drawDefinition:l,event:u}=t;if(!l)return{error:$e};if(!u)return{error:ui};u.drawDefinitions||(u.drawDefinitions=[]);let{drawId:c,drawName:d,entries:p}=l,{entries:f}=u,m=0;if(n!==void 0&&n!==u.drawDefinitions.length)return{error:re,info:"drawDefintions count mismatch"};let{flightProfile:h}=Bi({event:u}),g=e&&h?.flights?.find(R=>R.flightNumber===e.flightNumber),I=h?.links?.find(R=>R?.target?.drawId===c)?.source?.drawId;if(I&&!u.drawDefinitions.find(R=>R.drawId===I))return q({result:{error:$e},info:{sourceDrawId:I}});if(g&&g.drawId!==l.drawId)return q({result:{error:fm},info:{relevantFlight:g}});let v=p?.every(({participantId:R,entryStatus:C})=>{let M=g?.drawEntries.find(N=>N.participantId===R);return!C||M?.entryStatus===C}),w=!s||f&&p?.every(({participantId:R,entryStatus:C,entryStage:M})=>f.find(N=>N.participantId===R&&(!N.entryStage||N.entryStage===M))?.entryStatus===C);if(g&&!v)return q({result:{error:fm},context:{drawEntriesPresentInFlight:v,matchingEventEntries:w,relevantFlight:g},info:"Draw entries are not present in flight or do not match entryStatuses"});if(r&&p?.filter(Boolean).forEach(R=>{if(R?.entryStatus&&uo.includes(R?.entryStatus)){let C=f?.filter(Boolean).find(M=>M.participantId===R.participantId);C&&R.entryStatus&&C?.entryStatus!==R.entryStatus&&(C.entryStatus=R.entryStatus,m+=1)}}),f&&!w)return q({result:{info:"Draw entries do not match event entryStatuses",context:{matchingEventEntries:w,eventEntries:f},error:fm}});let y=h?.flights?.map(({flightNumber:R})=>!isNaN(R)&&Ke(R))?.filter(Boolean)||[],b=u.drawDefinitions.map(({drawOrder:R})=>R&&Ke(R))?.filter(Boolean)||[],S=Math.max(0,...b,...y)+1,U=h?.flights?.find(R=>R.drawId===c),T;if(U){U.drawName=l.drawName,T={name:to,value:{...h,flights:h.flights}};let R=U.flightNumber;R&&!b.includes(R)?S=R:U.flightNumber=S}else{let R=h?.flights||[];R.push({manuallyAdded:!0,flightNumber:S,drawEntries:p,drawName:d,drawId:c}),T={name:to,value:{...h||{},flights:R}}}Yd({event:u,extension:T}),Object.assign(l,{drawOrder:S});let P=u.drawDefinitions.find(R=>R.drawId===c),D=o?.tournamentId,E=u.eventId;if(P){if(!a)return{error:vte};let R=An({drawDefinition:P})?.matchUps?.map(vr)??[],C=An({drawDefinition:l})?.matchUps;if(!i){R?.length&&ku({matchUpIds:R,action:"modifyDrawDefinition",tournamentId:D,eventId:E}),C?.length&&Dd({matchUps:C,tournamentId:D,eventId:E}),u.drawDefinitions=u.drawDefinitions.map(N=>N.drawId===c?l:N);let M=l.structures?.map(({structureId:N})=>N);ii({drawDefinition:l,tournamentId:D,structureIds:M,eventId:E})}}else if(u.drawDefinitions.push(l),!i){let{matchUps:R}=An({drawDefinition:l,event:u});R&&Dd({tournamentId:o?.tournamentId,matchUps:R}),mU({drawDefinition:l,tournamentId:D,eventId:E})}return{...W,modifiedEventEntryStatusCount:m}}function eue(t){let{provisionalPositioning:e,useExistingSeedLimit:i,tournamentRecord:r,drawDefinition:n,seedingProfile:a,structureId:s,assignments:o,drawId:l,event:u}=t,c=0;if(!o?.length)return{error:eB};if(!r)return{error:ve};if(!l)return{error:xo};let d=hs({provisionalPositioning:e,drawDefinition:n,structureId:s});if(d.error)return d;let{seedAssignments:p,seedLimit:f}=d,m=Object.assign({},...(p??[]).filter(I=>I.seedNumber).map(I=>({[I.seedNumber]:I})));o.forEach(I=>{let{seedNumber:v}=I;f&&v<=f&&(!i||m[v])&&(m[v]=I)});let h=Object.values(m),g=h.map(I=>I?.participantId).filter(Boolean);if(g.length!==ste(g).length)return{error:yte};for(let I of h){let v=zv({...I,provisionalPositioning:e,tournamentRecord:r,drawDefinition:n,seedingProfile:a,structureId:s,event:u});if(v?.error)return v;v?.success&&c++}return c?{...W,modifications:c}:{error:Av}}function $j({deleteExisting:t,event:e,flightProfile:i}){let r="attachFlightProfile";if(!i)return q({result:{error:Je},stack:r});if(!e)return q({result:{error:ui},stack:r});let{flightProfile:n}=Bi({event:e});return n&&!t?q({result:{error:gB},stack:r}):e.drawDefinitions?.length?q({result:{error:fte},stack:r}):(Yd({event:e,extension:{name:to,value:i}}),{flightProfile:Oe(i,!1,!0),...W})}function nHe({tournamentRecord:t,scaleAttributes:e,participantIds:i}){if(!t)return{error:ve};if(!i)return{error:Wd};if(!e)return{error:Je,info:"scaleAttributes required"};let{scaleType:r,eventType:n,scaleName:a}=e,s=[Gne,r,n,a].join(".");return t.participants?.forEach(o=>{i.includes(o.participantId)&&o.timeItems&&(o.timeItems=o.timeItems.filter(l=>l&&l?.itemType!==s))}),{...W}}function Bj({tournamentRecord:t,scaleAttributes:e,drawDefinition:i,entryStatuses:r,drawId:n,event:a,stage:s}){if(!a)return{error:ui};if(r&&!Array.isArray(r))return q({result:{error:re},info:zp("entryStatus"),stack:"removeScaleValues"});let o=a.entries;if(n){let{flightProfile:u}=Bi({event:a}),c=u?.flights?.find(d=>d.drawId===n);c?o=c.drawEntries:o=i?.entries}let l=(o||[]).filter(u=>(!s||!u.entryStage||u.entryStage===s)&&(!r||r.includes(u.entryStatus))).map(yt);return nHe({tournamentRecord:t,scaleAttributes:e,participantIds:l})}function WN({removePriorValues:t,tournamentRecord:e,displaySettings:i,status:r=Xa,event:n}){if(!e)return q({result:{error:ve}});if(!n)return q({result:{error:ui}});if(!wt(i))return q({result:{error:Je}});if(wt(i.draws))for(let s of Object.keys(i.draws)){let o=i.draws[s].scheduleDetails??[];if(o.length){let l=[];for(let u of o){let c=l.find(d=>Rxe(d.attributes,u.attributes));c?.dates&&u.dates?c.dates.push(...u.dates):l.push(u)}i.draws[s].scheduleDetails=l}}let a=ey({statusObject:{displaySettings:i},removePriorValues:t,status:r,event:n});return a.error?a:{...W}}function tue({tournamentRecord:t,drawDefinition:e,entryStatuses:i,scaleName:r,drawId:n,event:a,stage:s}){if(!t)return{error:ve};if(!a)return{error:ui};r=r||a.category?.categoryName||a.category?.ageCategoryCode;let o={eventType:a.eventType,scaleType:Yl,scaleName:r};return Bj({tournamentRecord:t,scaleAttributes:o,drawDefinition:e,entryStatuses:i,drawId:n,event:a,stage:s})}function iue(t){let e=He(t,[{[hr]:!0},{eventIds:!0,[qn]:sn}]);if(e.error)return e;let{removePairParticipants:i,tournamentRecord:r,eventIds:n}=t,a=[],s=[],o=[],l=[];if(r.events=(r.events||[]).filter(u=>{if(n.includes(u.eventId)){let p={action:yD,payload:{events:[u]}};a.push(p),s.push({tournamentId:r.tournamentId,eventName:u.eventName,eventType:u.eventType,category:u.category,eventId:u.eventId,gender:u.gender})}let c=u.eventType===fs?(u.entries||[]).map(({entryStatus:p,participantId:f})=>p!==Us&&f).filter(Boolean):[],d=n.includes(u.eventId);return d?l.push(...c):o.push(...c),!d}),i){let u=l.filter(c=>!o.includes(c));r.participants=r.participants.filter(({participantId:c})=>!u.includes(c))}if(ZU({tournamentRecord:r}),a.length)if(IM(Zu)){let u=r.tournamentId;st({topic:Zu,payload:{type:yD,tournamentId:u,detail:a}})}else WU({tournamentRecord:r,timeItem:{itemValue:s,itemType:yD}});return{...W}}function rue(t){let e=He(t,[{tournamentRecord:!0,eventId:!0,event:!0},{eventUpdates:!0,_ofType:Kn}]);if(e.error)return e;let{eventUpdates:i,event:r}=t,n="modifyEvent",a=uHe(t),s=cHe({enteredParticipants:a}),{enteredParticipantGenders:o,enteredParticipantTypes:l}=s,u=Bi({event:r})?.flightProfile?.flights,c=!r.drawDefinitions?.length&&!u?.length,d=dHe({noFlightsNoDraws:c,enteredParticipantGenders:o,eventUpdates:i,stack:n});if(d.error)return d;let p=pHe({enteredParticipantTypes:l,eventUpdates:i,stack:n});if(p.error)return p;let f=aHe({...t,...s,enteredParticipants:a,stack:n});if(f.error)return f;let m=lHe({...t,stack:n});return m.error?m:(i.eventType&&(r.eventType=i.eventType),i.eventName&&(r.eventName=i.eventName),i.gender&&(r.gender=i.gender),{...W})}function aHe(t){let e=t.eventUpdates?.category;if(!e)return{...W};let i=Hb({category:e});if(i.error)return i;if(t.event.eventType===ar){let r=sHe(t);if(r.error)return r}if(t.enteredParticipants?.length){let r=oHe(t,e);if(r.error)return r}return{...W}}function sHe(t){let e=t.event?.drawDefinitions?.map(n=>Vo(n))??[],i=Vo(t.event),r=(xu(t)?.matchUps??[]).map(n=>Vo(n))??[];return[i,...e,...r].filter(Boolean).every(n=>n.collectionDefinitions.every(a=>!a.category||nU({category:t.eventUpdates.category,childCategory:a.category})))?{...W}:q({result:{error:_b},stack:t.stack})}function oHe(t,e){let i=t.eventUpdates.startDate||t.event.startDate||t.tournamentRecord.startDate,r=t.eventUpdates.endDate||t.event.endDate||t.tournamentRecord.endDate,n=t.enteredParticipants.flatMap(o=>o.participantType===It?[o]:o.individualParticpants??[]),a=$p({category:e,consideredDate:i}),s=$p({category:e,consideredDate:r});if(a?.ageMinDate||a?.ageMaxDate||s?.ageMinDate||s?.ageMaxDate)for(let o of n){let l=o.person?.birthDate;if(!l)return q({result:{error:Vte},stack:t.stack});let u=new Date(l).getTime(),c=Lq(u,a,t.stack);if(c)return c;let d=Lq(u,s,t.stack);if(d)return d}return{...W}}function Lq(t,e,i){if(!e)return null;if(e.ageMinDate||e.ageMaxDate){let r=new Date(e.ageMinDate).getTime(),n=new Date(e.ageMaxDate).getTime();if(t<r||t>n)return q({result:{error:Yte},stack:i})}return null}function lHe(t){let{tournamentRecord:e,eventUpdates:i,event:r,stack:n}=t;if(i.startDate||i.endDate){let a=Fj({startDate:i.startDate||r.startDate||e.startDate,endDate:i.endDate||r.endDate||e.endDate,tournamentRecord:e,event:r});if(a.error)return q({result:a,stack:n})}return{...W}}function uHe(t){let{tournamentRecord:e,event:i}=t,r=i?.entries?.filter(({entryStatus:n})=>{let a=n;return[...uo,Gs].includes(a)}).map(({participantId:n})=>n)??[];return r?Ri({participantFilters:{participantIds:r},withIndividualParticipants:!0,tournamentRecord:e}).participants??[]:[]}function cHe({enteredParticipants:t}){let e=[],i=t.reduce((n,a)=>{let s=a.person?.sex?[a.person.sex]:a.individualParticpants?.map(o=>o.person?.sex)||[];return e.push(...s),n.includes(a.participantType)?n:n.concat(a.participantType)},[]),r=nt(e);return{enteredParticipantTypes:i,enteredParticipantGenders:r}}function dHe({noFlightsNoDraws:t,enteredParticipantGenders:e,eventUpdates:i,stack:r}){let n=!e.length||!i.gender||du(i.gender)||e.length===1&&e[0]===i.gender||t&&Aa(i.gender);return i.gender&&!n?q({context:{gender:i.gender,validGender:n},result:{error:Hy},stack:r}):{...W}}function pHe({enteredParticipantTypes:t,eventUpdates:e,stack:i}){let r=(t.includes(ar)&&[ar]||t.includes(It)&&[pl]||t.includes(ft)&&[fs]||[fs,pl,ar]).includes(e.eventType??"");return e.eventType&&!r?q({context:{participantType:e.eventType,validEventType:r},result:{error:cu},stack:i}):{...W}}function zN({qualifyingPositions:t,drawEntries:e=[],drawName:i,drawId:r,event:n,stage:a}){let s="addFlight";if(!n)return q({result:{error:ui},stack:s});if(!i)return q({result:{error:Je},stack:s});if(e?.length){let f=(n.entries??[]).map(yt),m=e.map(yt);if(Li(m,f).length!==m.length)return q({result:{error:re},stack:s})}let o=Bi({event:n})?.flightProfile,l=o?.flights?.map(({flightNumber:f})=>!isNaN(f)&&Ke(f))?.filter(Boolean)||[],u=Math.max(0,...l)+1,c={drawId:r||Ct(),flightNumber:u,drawEntries:e,drawName:i};if(a&&(c.stage=a),t&&(c.qualifyingPositions=t),(o?.flights||[]).find(({drawId:f})=>f===c.drawId))return q({result:{error:Sie},stack:s});let d=(o?.flights||[]).concat(c),p={name:to,value:{...o||{},flights:d}};return Yd({event:n,extension:p})}var nue={};dt(nue,{drawMatic:()=>JV,garman:()=>cue,generateAdHocMatchUps:()=>gN,generateAdHocRounds:()=>XV,generateAndPopulatePlayoffStructures:()=>pV,generateCourts:()=>Vj,generateDrawDefinition:()=>iT,generateDrawMaticRound:()=>EV,generateDrawStructuresAndLinks:()=>TV,generateDrawTypeAndModifyDrawDefinition:()=>DV,generateFlightProfile:()=>hHe,generateLineUps:()=>uue,generateQualifyingStructure:()=>sV,generateSeedingScaleItems:()=>kle,generateStatCrew:()=>gHe,generateVoluntaryConsolation:()=>foe,roundRobinGroups:()=>P_e});var fHe="splitLevelBased",aue="splitWaterfall",sue="splitShuttle",mHe={SPLIT_LEVEL_BASED:fHe,SPLIT_WATERFALL:aue,SPLIT_SHUTTLE:sue};function hHe(t){let{drawNameRoot:e="Flight",attachFlightProfile:i,tournamentRecord:r,scaleAttributes:n,scaleSortMethod:a,deleteExisting:s,sortDescending:o,drawNames:l=[],flightsCount:u,splitMethod:c,uuids:d=[],event:p,stage:f}=t;if(!p)return{error:ui};let m=p.entries??[],{flightProfile:h}=Bi({event:p});if(h&&i&&!s)return{error:gB};let g=t.scaledEntries??Zh({tournamentRecord:r,scaleAttributes:n,scaleSortMethod:a,sortDescending:o,event:p,stage:f}).scaledEntries,I=new Set(g.map(yt)),v=Cn(m.filter(({participantId:D})=>!I.has(D)).filter(D=>(!f||!D.entryStage||D.entryStage===f)&&(!D.entryStatus||Sf.includes(D.entryStatus)))),w=g.concat(...v),y=w.length,b=Math.ceil(y/u),S=wr(w,b);c===aue?S=tx(w,u):c===sue&&(S=tx(w,u,!0));function U(D){return(D||[]).map(({participantId:E,scaleValue:R})=>{let C=m.find(M=>M.participantId===E);return C?.scaleValue&&R&&(C.scaleValue=R),C}).sort((E,R)=>E.scaleValue-R.scaleValue).map((E,R)=>(E.scaleValue&&(E.seedNumber=R+1),E))}let T=Ce(0,u).map(D=>{let E=D+1;return{flightNumber:E,drawId:d?.pop()??Ct(),drawEntries:U(S[D]),drawName:l?.length&&l[D]||`${e} ${E}`}}),P={scaleAttributes:n,splitMethod:c,flights:T};if(i){let D=$j({flightProfile:P,deleteExisting:s,event:p});return{splitEntries:oa()&&S||void 0,...D}}else return{flightProfile:P,...W}}function oue({json:t,tagName:e}){let i=Object.keys(t).filter(a=>Array.isArray(t[a])).map(a=>({key:a,value:t[a].filter(s=>typeof s=="object"&&Object.keys(s).length===1)})),r=Object.keys(t).filter(a=>typeof t[a]=="object"&&!Array.isArray(t[a])).map(a=>({key:a,value:t[a]})),n=Object.keys(t).filter(a=>["string","number"].includes(typeof t[a])).map(a=>({key:a,value:t[a]}));return lue({tagName:e,attributes:n,childArrays:i,childObjects:r})}function lue(t){let{tagName:e,attributes:i=[],childArrays:r=[],childObjects:n}=t,a=`\r
`,s=f=>{let m=Object.keys(f)[0],h=f[m];return{key:m,value:h}},o=r?.map(({key:f,value:m})=>lue({tagName:f,childObjects:m.map(s)})).join(`\r
`),l=n?.map(({key:f,value:m})=>oue({tagName:f,json:m??[]})).join(`\r
`),u=i?.map(({key:f,value:m})=>`${f}="${m}"`).join(" "),c=u?` ${u}`:"";if(e==="childArray")return l;let d=l?.length?`${a}${l}${a}`:"",p=o?.length?`${a}${o}${a}`:"";return`<${e}${c}>${d}${p}</${e}>`}function gHe(t){let e=He(t,[{[hr]:!0}]);if(e.error)return e;let{tournamentRecord:i}=t,{startDate:r,tournamentId:n,tournamentName:a}=i,{participantMap:s,matchUps:o,mappedMatchUps:l}=Ri({withMatchUps:!0,withEvents:!0,tournamentRecord:i}),u=i.participants.filter(w=>w.participantType===_t),c=o?.filter(w=>w.matchUpType===_t)??[],d=c?.reduce((w,y)=>{let b=y?.tieMatchUps??[];return b&&[...w,...b]},[])??[],p=o?.filter(w=>w.matchUpType===zt)??[],f=o?.filter(w=>w.matchUpType===Bt)??[],m=d.length===p.length+f.length,h=c.length===1&&m,g={mappedMatchUps:l,participantMap:s,tournamentName:a,tournamentId:n,tournament:m?"N":"Y",startDate:r},I=[],v=[];if(h){let w=c[0],{json:y,xml:b}=_q({teamParticipants:u,teamMatchUp:w,...g,doubles:f,singles:p});v.push(y),I.push(b)}else for(let w of c){let y=w?.sides?.map(({participant:T})=>T?.participantId).filter(Boolean);if(y?.length!==2)continue;let b=y.map(T=>T&&s?.[T]?.participant),{xml:S,json:U}=_q({doubles:w.tieMatchUps?.filter(T=>T.matchUpType===Bt),singles:w.tieMatchUps?.filter(T=>T.matchUpType===zt),teamParticipants:b,teamMatchUp:w,...g});v.push(U),I.push(S)}return{json:v,xml:I,...W}}function _q({teamParticipants:t,mappedMatchUps:e,participantMap:i,tournamentName:r,tournamentId:n,teamMatchUp:a,tournament:s,startDate:o,doubles:l,singles:u}){let c=t?.find(y=>y.participantRoleResponsibilities?.includes("Home")),d=t?.filter(y=>y.participantId!==c?.participantId),p=Bs(o,"/","MDY"),f=c?.participantName||d?.[1]?.participantName,m=c?.participantId||d?.[1]?.participantId,h=d?.[0]?.participantName,g=d?.[0]?.participantId,I={},v=t.map(y=>({team:{...yHe({teamParticipant:y,teamMatchUp:a,uniValues:I,participantMap:i,mappedMatchUps:e,homeid:m})}})),w=je({venue:{tournamentname:s?r:void 0,neutralgame:c?"N":"Y",gameid:n,officials:{},tournament:s,rules:{},homename:f,visname:h,homeid:m,visid:g,date:p},childArray:v,singles_matches:u?.map(y=>$q({matchUp:y,homeid:m,uniValues:I})),doubles_matches:l?.map(y=>$q({matchUp:y,homeid:m,uniValues:I}))});return{json:w,xml:oue({json:w,tagName:"tngame"})}}function IHe({homeid:t,uniValues:e,participant:i}){if(!i)return{};let r=i.individualParticipants?.length===2,n=r?nt(i.individualParticipants?.map(h=>h.teams?.[0]?.participantId)):[],a=r?nt(i.individualParticipants?.map(h=>h.teams?.[0]?.teamId)):[],s=!r&&i.teams?.[0]?.participantId||n?.length===1&&n[0]||void 0,o=!r&&i.teams?.[0]?.teamId||a?.length===1&&a[0]||s,l=r?void 0:i.participantName,u=i.individualParticipants?.[0]?.participantName,c=i.individualParticipants?.[1]?.participantName,d=t&&(s===t?"H":"V")||"",p=r?void 0:e[s][i.participantId],f=e[s][i.individualParticipants?.[0]?.participantId],m=e[s][i.individualParticipants?.[1]?.participantId];return je({vh:d,uni:p,uni_1:f,uni_2:m,team:o,name:l,name_1:u,name_2:c})}function vHe({sets:t,sideNumber:e}){return Object.assign({},...t?.map(i=>{let{setNumber:r,side1Score:n,side2Score:a,side1TiebreakScore:s,side2TiebreakScore:o}=i,l=`set_${r}`,u=`tie_${r}`,c=e===1?n:a,d=e===1?s:o;return{[l]:c,[u]:d}})??[])}function yHe({teamParticipant:t,teamMatchUp:e,participantMap:i,mappedMatchUps:r,homeid:n,uniValues:a}){let{participantId:s,participantName:o}=t,l=n&&(s===n?"H":"V")||"",u=i?.[s]?.matchUps,c=u&&Object.keys(u),d=e?.sides?.find(({participant:y})=>y.participantId===s)?.sideNumber,p=e?.score?.sets?.[0]?.[`side${d}Score`]??0;a[s]={};let f={SINGLES:{w:0,l:0},DOUBLES:{w:0,l:0}},m=[],h=[],g=0;for(let y of c??[]){let b=r?.[y],S=b.sides.find(({participant:T})=>T.participantId===s)?.sideNumber,U=b.score?.sets?.[0]?.[`side${S}Score`]??0;g+=U;for(let T of b.tieMatchUps??[]){let{matchUpType:P,winningSide:D}=T,E=D&&(D===S?"w":"l")||"";E&&(f[P][E]+=1);let R=E==="w"?"1":"0",C=E==="l"?"1":"0";if(P===zt){let M=h.length+1;h.push({singles_pair:{pair:M,won:R,lost:C,tied:"0"}})}else if(P===Bt){let M=m.length+1;m.push({doubles_pair:{pair:M,won:R,lost:C,tied:"0"}})}}}let I=[{singles:{childArray:h,won:f.SINGLES.w,lost:f.SINGLES.l}},{doubles:{childArray:m,won:f.DOUBLES.w,lost:f.DOUBLES.l}}],v=[],w=1;for(let y of t.individualParticipantIds){let b=i?.[y];if(b){let{participant:S,counters:U}=b,T={won:U?.DOUBLES?.wins||0,lost:U?.DOUBLES?.losses||0},P={won:U?.SINGLES?.wins||0,lost:U?.SINGLES?.losses||0},{participantName:D,participantId:E}=S;a[s][E]=w,v.push({player:{name:D,uni:w,singles:P,doubles:T}})}w+=1}return{vh:l,id:s,name:o,score:p||g,totals:I,childArray:v}}function $q({matchUp:t,homeid:e,uniValues:i}){let{collectionPosition:r,orderOfFinish:n,matchUpType:a,sides:s}=t??{},o=s?.map(l=>{let{sideNumber:u,participant:c}=l,d=vHe({sets:t.score?.sets,sideNumber:u});return{[a===zt?"singles_score":"doubles_score"]:{...IHe({homeid:e,uniValues:i,participant:c}),...d}}});return{[a===zt?"singles_match":"doubles_match"]:{match:r,order:n,childArray:o}}}var bHe="DESC",Yx="DESC",wHe={ASC:"ASC",ASCENDING:"ASC",DESC:bHe,DESCENDING:Yx};function uue(t){let{tieFormat:e}=t,{useDefaultEventRanking:i,tournamentRecord:r,drawDefinition:n,scaleAccessor:a,singlesOnly:s,attach:o,event:l}=t;if(l?.eventType!==Ua)return{error:cu};if(!r)return{error:ve};if(!e&&!n)return{error:_a};if(e=e??yn({drawDefinition:n,event:l})?.tieFormat,Gn({tieFormat:e}).error)return{error:ql};if(typeof a!="object"&&!i)return{error:re,context:{scaleAccessor:a}};let u={},c=(n?.entries??l?.entries??[]).filter(E=>E?.entryStatus===ua).map(yt),{participants:d=[]}=Ri({withIndividualParticipants:!0,withScaleValues:!0,tournamentRecord:r}),p=d.filter(({participantId:E})=>c.includes(E)),f=E=>E===vu?"rankings":"ratings",m=l?.category?.categoryName??l?.category?.ageCategoryCode,{scaleName:h=m,scaleType:g=vu,sortOrder:I,accessor:v}=a||{},w=f(g),y=(E,R)=>{let C=E[w]?.[R];if(!C&&i&&(C=E[w]?.[dm]),Array.isArray(C)){let M=C.find(N=>N.scaleName===h)?.scaleValue;if(Ai(M))return M;if(v&&typeof M=="object")return M[v]}return 0},b=(E,R,C)=>{let M=I===Yx?R:E,N=I===Yx?E:R;return y(M,C)-y(N,C)},S=(E,R)=>b(E,R,dm),U=(E,R)=>b(E,R,Lp),T=[],P=e?.collectionDefinitions??[];for(let E of p){let R=E.individualParticipants?.sort(S)??[],C=s?R:E.individualParticipants?.sort(U)??[],M={};for(let A of P){let O=[],{collectionId:k,matchUpCount:F,matchUpType:x,gender:L}=A,$=Pi(dm)(x);Ce(0,F).forEach(V=>{let _=$?R:C??[],B=V+1,G=[];Ce(0,$?1:2).forEach(j=>{let K=_?.find(Y=>{let X=ln(L),Z=X&&(cl(L)&&X||Aa(L)&&[tr,zr][j]);return(!Z||Z===Y.person?.sex)&&!O.includes(Y.participantId)})?.participantId;K&&(G.push(K),O.push(K),M[K]||(M[K]=[]),M[K].push({collectionPosition:B,collectionId:k}))}),$||T.push(G)})}let N=Object.keys(M).map(A=>({collectionAssignments:M[A],participantId:A}));u[E.participantId]=N}let D=[];for(let E of T){let{participant:R}=ro({tournamentParticipants:d,participantIds:E});if(!R){let C={individualParticipantIds:E,participantRole:Jr,participantType:ft};D.push(C)}}if(o){for(;D.length;)Il({participant:D.pop(),tournamentRecord:r});Ft({element:n,extension:{name:Sc,value:u}})}return{...W,lineUps:u,participantsToAdd:D}}function Vj(t){if(!t)return{error:Je};let e=He(t,[{dates:!1,[qr]:s=>Array.isArray(s)&&s.every(Mn)},{uuids:!1,[qr]:s=>Array.isArray(s)&&s.every(ni)},{startTime:!1,endTime:!1,[qr]:PB},{idPrefix:!1,namePrefix:!1,[qr]:ni},{count:!0,[qr]:Ai}]);if(e.error)return e;let{startDate:i,endDate:r}=t.tournamentRecord??{},n=t.dates||i&&r&&wI(i,r)||[],a=Ce(1,t.count+1).map(s=>je({courtId:t.uuids?.pop()??(t.idPrefix&&`${t.idPrefix}-${s}`)??Ct(),courtName:t.courtNames?.pop()??(t.namePrefix&&`${t.namePrefix} ${s}`),dateAvailability:n.map(o=>({startTime:t.startTime??"08:00",endTime:t.endTime??"20:00",date:o}))}));return{...W,courts:a}}var cue={};dt(cue,{default:()=>THe,garman:()=>fue});function iy(t){let e=He(t,[{courtDate:!0,_ofType:Kn}]);if(e.error)return e;let{includeBookingTypes:i=[],courtDate:r}=t,n=[],a=Ji(r.startTime);(r.bookings||[]).filter(o=>!o.bookingType||!i.includes(o.bookingType)).sort((o,l)=>(kP(o.startTime)||"").localeCompare(kP(l.startTime)||"")).forEach(o=>{let l={startTime:pi(a.toISOString()),endTime:o.startTime};Ji(o.startTime)>a&&n.push(l),Ji(o.endTime)>a&&(a=Ji(o.endTime))});let s={startTime:pi(a.toISOString()),endTime:r.endTime};return Ji(r.endTime)>a&&n.push(s),{timeSlots:n}}function SHe({averageMatchUpMinutes:t,includeBookingTypes:e,periodStartTime:i,periodEndTime:r}){let n=s=>{let{timeSlots:o}=iy({includeBookingTypes:e,courtDate:s});return!!o?.filter(a)?.length};function a(s){let o=Ji(s.startTime),l=Ji(s.endTime);return o>i||l<r?!1:rU(i,l)>=t}return{enoughTime:n}}function due(t){let e=He(t,[{periodStart:!0,date:!0},{courts:!0,_ofType:sn}]);if(e.error)return e;let{averageMatchUpMinutes:i,includeBookingTypes:r,periodStart:n,date:a}=t,s=t.courts,o=Ji(n),l=RB(o,i),{enoughTime:u}=SHe({averageMatchUpMinutes:i,includeBookingTypes:r,periodStartTime:o,periodEndTime:l});return{availableToScheduleCount:(s?.filter(c=>{if(!Array.isArray(c.dateAvailability))return!1;let d=Md({date:a,court:c});return!!(d&&u(d))})||[]).length,...W}}function qN(t){let{remainingScheduleTimes:e=[],clearScheduleDates:i,periodLength:r=30,scheduleDate:n,courts:a=[]}=t,{bookings:s=[]}=t;if(!Array.isArray(a)||!a.length)return{error:re,courts:a};if(!Array.isArray(s))return{error:CP};if(!Mn(n))return{error:or};i&&(Array.isArray(i)?i.includes(n)&&(s=[]):s=[]);let{courtBookings:o,unassignedBookings:l}=s.reduce((p,f)=>{let{courtId:m}=f;return m?p.courtBookings[m]?p.courtBookings[m].push(f):p.courtBookings[m]=[f]:p.unassignedBookings.push(f),p},{courtBookings:{},unassignedBookings:[]}),u=a.map((p,f)=>{let{courtId:m,courtName:h}=p,g=o[m]||[],I=Md({date:n,court:p})||{},{bookings:v=[],startTime:w,endTime:y,date:b}=I,S=[e[f]&&{startTime:w,endTime:e[f]},...Oe(v,!1,!0),...g].filter(Boolean);return{courtId:m,courtName:h,dateAvailability:{bookings:S,startTime:w,endTime:y,date:b}}});l.sort((p,f)=>Rt(p.startTime)-Rt(f.startTime));let c=()=>u.flatMap(p=>{let f=p.dateAvailability,{timeSlots:m=[]}=iy({courtDate:f});return{courtName:p.courtName,courtId:p.courtId,timeSlots:m}}),d=[];for(let p of l){let{startTime:f,endTime:m,averageMinutes:h,recoveryMinutes:g,matchUpId:I}=p,v=Rt(f),w=Rt(m),y=c().reduce((b,{courtId:S,courtName:U,timeSlots:T})=>{let P;return T.find(({startTime:D,endTime:E})=>{P=Rt(D)-v;let R=v>=Rt(D);return w<=Rt(E)&&b.startDifference!==0&&((P===0||P+r>=0)&&(b.startDifference===void 0||P<b.startDifference)||R)})?{courtName:U,courtId:S,startDifference:P}:b},{});if(y.courtId){let b={averageMinutes:h,recoveryMinutes:g,matchUpId:I,startTime:f,endTime:m};d.push(b),u.find(({courtId:S})=>S===y.courtId)?.dateAvailability.bookings.push(b)}else console.log({unassignedBooking:p})}return{virtualCourts:u.map(({courtId:p,courtName:f,dateAvailability:m})=>({dateAvailability:[m],courtName:f,courtId:p})),assignedBookings:d}}function YN({averageMatchUpMinutes:t,periodLength:e=30,recoveryMinutes:i}){let r=(t||90)+(i||0);return e>r?r:e||30}function pue(t){let{startTime:e="8:00",endTime:i="20:30",count:r=10,date:n}=t??{};return Ce(0,r).map(()=>({dateAvailability:[{date:n,startTime:e,endTime:i}]}))}function xI({scheduleDate:t,startTime:e,endTime:i,courts:r}){let n=e&&"startTime"||i&&"endTime"||void 0;return r.reduce((a,s)=>{let o=Md({date:t,court:s}),l=n&&(o?.[n]||s[n]);return l&&(!a||e&&Rt(l)<Rt(a)||i&&Rt(l)>Rt(a))?l:a},void 0)}function UHe({averageMinutes:t,startTime:e,endTime:i,courts:r,date:n}){e=e||xI({courts:r,scheduleDate:n,startTime:!0}),i=i||xI({courts:r,scheduleDate:n,endTime:!0});let a;if(e&&i){let s=Ji(e),o=Ji(i);for(let l of r||[]){if(!Array.isArray(l.dateAvailability))continue;let u=Md({court:l,date:n}),{timeSlots:c}=iy({courtDate:u});c?.forEach(d=>{let p=Ji(d.startTime),f=Ji(d.endTime);if(p>o||p<s||f<s)return!1;if(rU(p,f)>=t){let m=pi(p.toISOString());m&&(!a||m<a)&&(a=m)}})}}return{firstTimeSlotStartTime:a}}function jj(t){let e=He(t,[{courts:!0,_ofType:sn}]);if(e.error)return e;let{date:i=DB(),startTime:r="08:00",endTime:n="19:00",periodLength:a,courts:s}=t,{calculateStartTimeFromCourts:o=!0,remainingScheduleTimes:l,averageMatchUpMinutes:u,clearScheduleDates:c,courtsCount:d,bookings:p}=t;a=a||YN({averageMatchUpMinutes:u}),i=Ze(i),r=pi(r),n=pi(n);let f=0,m=0,h=0,g=0,I=0;!s&&d&&(s=pue({startTime:r,endTime:n,count:d,date:i}));let{virtualCourts:v}=qN({remainingScheduleTimes:l,clearScheduleDates:c,scheduleDate:i,periodLength:a,bookings:p,courts:s}),{firstTimeSlotStartTime:w}=UHe({averageMinutes:u,courts:v,startTime:r,endTime:n,date:i});o&&w&&(r=w??r);let y=Rt(r),b=Rt(n)-y,S=Math.floor(b/a),U=Ce(0,S+1).map(T=>{let P=y+T*a,D=Q1e(P),E=due({courts:v??[],averageMatchUpMinutes:u,periodStart:D,date:i});if(E.error)return{error:E.error};let{availableToScheduleCount:R=0}=E,C=R>m?R-m:0;I+=T?R:0;let M=T?I/T:R,N=a*M/u,A=T?N*(T-1)+M:M,O=R?m&&A-f||C:0;f=A,m=R,h+=O;let k=Ke(h)-g;return g+=k,{periodStart:D,add:k,availableToScheduleCount:R,newCourts:C,totalMatchUps:g}});return{scheduleTimes:U.reduce((T,P)=>{let D=Ce(0,P.add).map(()=>({scheduleTime:P.periodStart}));return T.concat(...D)},[]).flat(),timingProfile:U,totalMatchUps:g}}var fue={getCourtsAvailableAtPeriodStart:due,generateTimeSlots:iy,getScheduleTimes:jj,courtGenerator:pue},THe=fue,mue={};dt(mue,{isAggregateFormat:()=>PN,isValid:()=>$a,isValidMatchUpFormat:()=>$a,parse:()=>qi,stringify:()=>wM});var hue={};dt(hue,{allCompetitionMatchUps:()=>No,allDrawMatchUps:()=>An,allEventMatchUps:()=>xu,allTournamentMatchUps:()=>Ur,analyzeMatchUp:()=>lw,applyLineUps:()=>_ue,assignMatchUpSideParticipant:()=>Iue,assignTieMatchUpParticipantId:()=>nE,bulkMatchUpStatusUpdate:()=>Oue,calculateWinCriteria:()=>eg,checkInParticipant:()=>Hj,checkMatchUpIsComplete:()=>vp,checkOutParticipant:()=>Gj,competitionScheduleMatchUps:()=>tT,disableTieAutoCalc:()=>Nue,drawMatchUps:()=>Pj,enableTieAutoCalc:()=>Rue,eventMatchUps:()=>BN,filterMatchUps:()=>Yu,findMatchUp:()=>dj,getAllDrawMatchUps:()=>Zi,getAllStructureMatchUps:()=>At,getCheckedInParticipantIds:()=>Gh,getCompetitionMatchUps:()=>ow,getEventMatchUpFormatTiming:()=>Ij,getHomeParticipantId:()=>wj,getMatchUpCompetitiveProfile:()=>PU,getMatchUpContextIds:()=>Sj,getMatchUpDailyLimits:()=>jN,getMatchUpDailyLimitsUpdate:()=>vj,getMatchUpDependencies:()=>co,getMatchUpFormat:()=>Uj,getMatchUpFormatTiming:()=>EU,getMatchUpFormatTimingUpdate:()=>gj,getMatchUpScheduleDetails:()=>XM,getMatchUpType:()=>JM,getMatchUpsStats:()=>Tj,getModifiedMatchUpFormatTiming:()=>$N,getParticipantResults:()=>AU,getPredictiveAccuracy:()=>bj,getRoundMatchUps:()=>Sn,getRounds:()=>Dj,isValidMatchUpFormat:()=>$a,matchUpActions:()=>mN,mutate:()=>gue,participantScheduledMatchUps:()=>yj,query:()=>Dle,removeDelegatedOutcome:()=>Cue,removeMatchUpSideParticipant:()=>qj,removeTieMatchUpParticipantId:()=>yue,replaceTieMatchUpParticipantId:()=>zj,resetAdHocMatchUps:()=>Fue,resetMatchUpLineUps:()=>eG,resetScorecard:()=>iG,resetTieFormat:()=>tG,setDelegatedOutcome:()=>xue,setMatchUpFormat:()=>Aue,setMatchUpState:()=>Ef,setMatchUpStatus:()=>nT,setOrderOfFinish:()=>Lue,substituteParticipant:()=>Mue,tallyParticipantResults:()=>Wh,toggleParticipantCheckInState:()=>KN,tournamentMatchUps:()=>VN,updateTieMatchUpScore:()=>Hc,validMatchUp:()=>HM,validMatchUps:()=>Ka});var gue={};dt(gue,{applyLineUps:()=>_ue,assignMatchUpSideParticipant:()=>Iue,assignTieMatchUpParticipantId:()=>nE,bulkMatchUpStatusUpdate:()=>Oue,checkInParticipant:()=>Hj,checkOutParticipant:()=>Gj,disableTieAutoCalc:()=>Nue,enableTieAutoCalc:()=>Rue,findMatchUp:()=>dj,removeDelegatedOutcome:()=>Cue,removeMatchUpSideParticipant:()=>qj,removeTieMatchUpParticipantId:()=>yue,replaceTieMatchUpParticipantId:()=>zj,resetAdHocMatchUps:()=>Fue,resetMatchUpLineUps:()=>eG,resetScorecard:()=>iG,resetTieFormat:()=>tG,setDelegatedOutcome:()=>xue,setMatchUpFormat:()=>Aue,setMatchUpState:()=>Ef,setMatchUpStatus:()=>nT,setOrderOfFinish:()=>Lue,substituteParticipant:()=>Mue,toggleParticipantCheckInState:()=>KN,updateTieMatchUpScore:()=>Hc});function Iue({tournamentRecord:t,drawDefinition:e,participantId:i,sideNumber:r,matchUpId:n,event:a}){if(i&&typeof i!="string")return{error:Co};if(!e)return{error:$e};if(!n)return{error:Tn};let s=r===void 0;if(s&&(r=1),![1,2].includes(r))return q({result:{error:re,context:{sideNumber:r}}});let{matchUp:o,structure:l}=fi({drawDefinition:e,matchUpId:n,event:a});if(!o)return{error:dn};if(!(!l?.structures&&!(e.drawType&&e.drawType!==la)&&!l?.matchUps?.find(({roundPosition:u})=>!!u)))return{error:X$};if(!i&&(o?.score?.scoreStringSide1||Ki.includes(o?.matchUpstatus)||o?.matchUpStatus&&[Si,Wi].includes(o.matchUpStatus)))return{error:uM,info:"matchUp has completed status or score"};if(o){if(o.sides=[1,2].map(u=>{let c=o.sides?.find(d=>d.sideNumber===u)??{sideNumber:u};return r===u?{...c,participantId:i}:c}),s)for(let u of o.sides)u.sideNumber&&(u.sideNumber=3-u.sideNumber);Ut({tournamentId:t?.tournamentId,context:"assignSideParticipant",drawDefinition:e,matchUp:o})}return{...W,sidesSwapped:s}}function Ea({removePriorValues:t,tournamentRecord:e,duplicateValues:i,drawDefinition:r,disableNotice:n,matchUpId:a,timeItem:s,event:o}){let{matchUp:l}=fi({drawDefinition:r,event:o,matchUpId:a});if(!l)return{error:dn};let u=Cl({removePriorValues:t,element:l,duplicateValues:i,timeItem:s});return n||Ut({tournamentId:e?.tournamentId,eventId:o?.eventId,context:"addTimeItem",drawDefinition:r,matchUp:l}),u}function Gj(t){let e=[{[hr]:!0},{[In]:!0},{[Iu]:!0},{[Pl]:!0}],i=He(t,e);if(i.error)return i;let r=Qv(t,[{[xv]:Au,attr:{[CM]:!0}}]);if(r.error)return r;let{tournamentRecord:n,drawDefinition:a,participantId:s,matchUpId:o}=t,l=r?.matchUp?.matchUp,{matchUpStatus:u,score:c}=l??{};if(u&&JB.includes(u)||u&&Ki.includes(u)||fr({score:c}))return{error:Ste};let d=Gh({matchUp:l});if(d?.error)return d;let{checkedInParticipantIds:p,allRelevantParticipantIds:f}=d??{};if(!f?.includes(s))return{error:Co};if(!p?.includes(s))return{error:tie};let m=Lne({matchUp:l});if(m?.error)return m;let{sideParticipantIds:h,nestedIndividualParticipantIds:g}=m??{},I=h?.indexOf(s);return I!==void 0&&[0,1].includes(I)&&(g?.[I]??[]).forEach(v=>{Ea({drawDefinition:a,matchUpId:o,timeItem:{itemType:GP,itemValue:v}})}),Ea({tournamentRecord:n,drawDefinition:a,matchUpId:o,timeItem:{itemValue:s,itemType:GP}}),{...W,checkedOut:!0}}function Hj(t){let e=[{[hr]:!0},{[In]:!0},{[Iu]:!0},{[Pl]:!0}],i=He(t,e);if(i[js])return i;let r=Qv(t,[{[xv]:Au,attr:{[CM]:!0}}]);if(r[js])return r;let{tournamentRecord:n,drawDefinition:a,participantId:s,matchUpId:o}=t,l=Gh({matchUp:r?.matchUp?.matchUp});if(l?.error)return l;let{checkedInParticipantIds:u,allRelevantParticipantIds:c}=l??{};if(!c?.includes(s))return{[js]:Co};let d={...W,checkedIn:!0};return u?.includes(s)||Ea({tournamentRecord:n,drawDefinition:a,matchUpId:o,timeItem:{itemValue:s,itemType:jP}}),d}function KN(t){let e=He(t,[{[Iu]:!0,[In]:!0,[Pl]:!0}]);if(e.error)return e;let i=t.tournamentId??t.activeTournamentId,r=t.tournamentRecord??(i&&t.tournamentRecords?.[i]);if(!r)return{error:ve};let n=Qv(t,[{[xv]:Au,attr:{[CM]:!0},[js]:dn}]).matchUp?.matchUp;if(!n)return{error:dn};let{checkedInParticipantIds:a=[]}=Gh({matchUp:n}),{participantId:s,matchUpId:o,drawDefinition:l}=t;return s&&a.includes(s)?Gj({tournamentRecord:r,drawDefinition:l,participantId:s,matchUpId:o,matchUp:n}):Hj({tournamentRecord:r,drawDefinition:l,participantId:s,matchUpId:o,matchUp:n})}function Wj({tournamentRecord:t,drawDefinition:e,tieMatchUpId:i,event:r}){if(!t)return{error:ve};if(!e)return{error:xo};if(!r)return{error:ps};let n=kr({drawDefinition:e}),{matchUp:a}=fi({matchUpId:i,drawDefinition:e,matchUpsMap:n});if(!a)return{error:dn};let{matchUp:s,structure:o}=fi({tournamentParticipants:t.participants,matchUpId:i,inContext:!0,drawDefinition:e,matchUpsMap:n,event:r});if(!s)return{error:dn};let{collectionPosition:l,drawPositions:u,collectionId:c,matchUpTieId:d,matchUpType:p}=s;if(p&&!pm([zt,Bt],p))return{error:sa};let{positionAssignments:f}=Kt({structure:o}),m=f?.filter(S=>u?.includes(S.drawPosition)),{matchUp:h}=fi({matchUpId:d,drawDefinition:e,matchUpsMap:n}),g=h?.sides?.map(yt)??[],I=m?.map(yt)??[],v=[...g,...I],{participants:w}=Ri({tournamentRecord:t,participantFilters:{participantTypes:[_t],participantIds:v}}),{matchUp:y}=fi({matchUpId:d,inContext:!0,drawDefinition:e,matchUpsMap:n}),b=yn({matchUp:h,drawDefinition:e,structure:o,event:r})?.tieFormat;return{inContextDualMatchUp:y,inContextTieMatchUp:s,relevantAssignments:m,collectionPosition:l,teamParticipants:w,collectionId:c,matchUpType:p,dualMatchUp:h,tieMatchUp:a,tieFormat:b,structure:o,...W}}function zj(t){let e=Wj(t);if(e.error)return e;let i="replaceTieMatchUpParticipantid",{existingParticipantId:r,tournamentRecord:n,newParticipantId:a,drawDefinition:s,substitution:o,event:l}=t;if(!r||!a)return q({result:{error:dr},stack:i});if(r===a)return{...W};let{inContextDualMatchUp:u,inContextTieMatchUp:c,collectionPosition:d,collectionId:p,dualMatchUp:f,tieMatchUp:m,tieFormat:h}=e,g=c?.matchUpType,I=c?.sides?.find(k=>k.participant?.participantId===r||k.participant?.individualParticipantIds?.includes(r));if(!I)return{error:ji};let v=Ri({tournamentRecord:n,participantFilters:{participantIds:[r,a]}})?.participants??[];if(v.length!==2)return q({result:{error:dr},stack:i});if(v[0].participantType!==v[1].participantType)return q({result:{error:Mo},stack:i});let{appliedPolicies:w}=Dt({tournamentRecord:n,drawDefinition:s,event:l}),y=t.policyDefinitions?.[Cr]??w?.[Cr]??Wv[Cr],b=v.find(({participantId:k})=>k===a);if((t.enforceGender??y?.participants?.enforceGender)!==!1&&cl(c?.gender)&&ln(c?.gender)!==ln(b?.person?.sex))return{error:_p,info:"Gender mismatch"};let S=y?.processCodes?.substitution;HU({tournamentId:n.tournamentId,eventId:l.eventId,inContextDualMatchUp:u,drawDefinition:s,dualMatchUp:f});let U=f?.sides?.find(({sideNumber:k})=>k===I.sideNumber);if(!U)return q({result:{sideNumber:I.sideNumber,existingParticipantId:r,error:Br},stack:i});if(c?.sides?.flatMap(k=>k.participant?.individualParticipantIds||k.participant?.participantId||[])?.includes(a))return q({result:{error:dM},stack:i});let T=u?.sides?.find(({sideNumber:k})=>k===I.sideNumber)?.participantId,P=U.lineUp,D=P?.find(({participantId:k})=>a===k),E=P?.reduce((k,F)=>F.substitutionOrder>k?F.substitutionOrder:k,0),R=P?.map(k=>{let F=Oe(k,!1,!0);if(![r,a].includes(F.participantId))return F;if(!o&&[r,a].includes(F.participantId)&&(F.collectionAssignments=F.collectionAssignments?.filter(x=>!(x.collectionPosition===d&&x.collectionId===p))),o&&r===F.participantId&&(F.collectionAssignments=F.collectionAssignments.map(x=>x.collectionPosition===d&&x.collectionId===p&&x.substitutionOrder===void 0?{...x,substitutionOrder:E}:x)),F.participantId===a){F.collectionAssignments||(F.collectionAssignments=[]);let x={collectionId:p,collectionPosition:d};o&&(x.previousParticipantId=r,x.substitutionOrder=(E??0)+1),F.collectionAssignments.push(x)}return F})??[];if(!D){let k={collectionId:p,collectionPosition:d};o&&(k.substitutionOrder=(E??0)+1,k.previousParticipantId=r);let F={collectionAssignments:[k],participantId:a};R.push(F)}let C=g===Bt,{assignedParticipantIds:M}=zP({lineUp:P,collectionPosition:d,collectionId:p}),{assignedParticipantIds:N}=zP({lineUp:R,collectionPosition:d,collectionId:p});if(U.lineUp=R,T&&h){let k=Kh({participantId:T,lineUp:R,drawDefinition:s,tieFormat:h});if(k.error)return q({result:k,stack:i})}else console.log("team participantId not found");let A,O;if(C){let{tournamentRecord:k}=t,F=ro({participantIds:N,tournamentRecord:k});if(!F.participant){let L=Il({returnParticipant:!0,pairOverride:!0,tournamentRecord:k,participant:{participantRole:Jr,individualParticipantIds:N,participantType:ft}});if(L.error)return q({result:L,stack:i});A=L.participant?.participantId}F=ro({participantIds:M,tournamentRecord:k});let x=F.participant?.participantId;x&&qh({participantIds:[x],tournamentRecord:k}).success&&(O=x)}if(o||I.substitutions?.length===1){if(o)S&&m&&(m.processCodes=nt([...m?.processCodes??[],...S]));else for(let k of S||[]){let F=m?.processCodes?.lastIndexOf(k);F!==void 0&&m?.processCodes?.splice(F,1)}m&&Ut({tournamentId:n?.tournamentId,matchUp:m,context:i,drawDefinition:s})}return f&&Ut({tournamentId:n?.tournamentId,matchUp:f,context:i,drawDefinition:s}),{...W,modifiedLineUp:R,participantRemoved:O,participantAdded:A}}function vue({collectionPosition:t,teamParticipantId:e,dualMatchUpSide:i,drawDefinition:r,participantIds:n,collectionId:a}){if(!a||!t||!Array.isArray(n))return{modifiedLineUp:i?.lineUp||[],error:re};let s=i?.lineUp||Hp({participantId:e,drawDefinition:r})?.lineUp,o=[],l=[];return{modifiedLineUp:s?.map(u=>{if(!n.includes(u.participantId))return u;let c=u.collectionAssignments?.filter(d=>{let p=d.collectionId===a&&d.collectionPosition===t;return p&&(d.previousParticipantId&&o.push(d.previousParticipantId),l.push({participantId:u.participantId,...d})),!p});return{participantId:u.participantId,collectionAssignments:c}}).filter(Boolean)||[],assignmentsRemoved:l,previousParticipantIds:o}}function DHe({individualParticipantIds:t,groupingParticipantId:e,tournamentRecord:i}){let r=(i.events||[]).filter(a=>a?.eventType===ar&&a?.entries?.some(s=>s.participantId===e)),n=a=>!t.includes(a.participantId);for(let a of r){a.entries=(a.entries||[]).filter(n);let{flightProfile:s}=Bi({event:a});s?.flights?.forEach(o=>{o.drawEntries=(o.drawEntries||[]).filter(n)}),a?.drawDefinitions?.forEach(o=>{o.entries=(o.entries||[]).filter(n)})}return{...W}}function XN({individualParticipantIds:t,groupingParticipantId:e,removeFromOtherTeams:i,tournamentRecord:r}){let n="addIndividualParticipantIds";if(!r)return q({result:{error:ve},stack:n});if(!e||!t)return q({result:{error:Je},stack:n});let a=r.participants??[],s=a.find(d=>d.participantId===e);if(!s)return q({result:{error:ji},stack:n});if(s?.participantType&&![_t,Ya].includes(s.participantType))return q({context:{participantType:s.participantType},result:{error:Mo},stack:n});let o=t.filter(d=>a.find(p=>p.participantId===d)?.participantType!==It);if(o.length)return q({result:{error:Ia,invalidParticipantIds:o},stack:n});s.individualParticipantIds||(s.individualParticipantIds=[]);let l=s.individualParticipantIds,u=t.filter(d=>!l.includes(d));u.length&&(i&&eN({individualParticipantIds:u,tournamentRecord:r}),s.individualParticipantIds=s.individualParticipantIds.concat(...u));let{topics:c}=bs();if(c.includes(rn)){let d=a.find(({participantId:p})=>p===e);st({topic:rn,payload:{participants:[d]}})}return DHe({individualParticipantIds:t,groupingParticipantId:e,tournamentRecord:r}),{groupingParticipant:Oe(s,!1,!0),added:u.length,...W}}function JN(t){let{updateParticipantName:e=!0,groupingParticipantId:i,removeFromOtherTeams:r,tournamentRecord:n,pairOverride:a,participant:s}=t;if(!n)return{error:ve};if(!s)return{error:Nh};if(!s.participantId)return Il({tournamentRecord:n,participant:s});let{participant:o}=Xd({participantId:s.participantId,tournamentRecord:n});if(!o)return Il({tournamentRecord:n,participant:s});let{participantRoleResponsibilties:l,individualParticipantIds:u,participantOtherName:c,participantName:d,participantRole:p,participantType:f,onlineResources:m,contacts:h,person:g}=s;if(f&&o.participantType!==f)return{error:qte};let I={};if(h&&(I.contacts=h),m&&(I.onlineResources=m),c&&ni(c)&&(I.participantOtherName=c),d&&ni(d)&&(I.participantName=d),Array.isArray(u)){let{participants:v}=Ri({participantFilters:{participantTypes:[It]},tournamentRecord:n}),w=v?.map(yt);if(w){let y=u.filter(b=>ni(b)&&w.includes(b));([Ya,ei].includes(f||o.participantType)||f===ft&&(y.length===2||a))&&(I.individualParticipantIds=y),o.participantType===zy.PAIR&&e&&(I.participantName=PHe({individualParticipants:v,newValues:I}))}}return Object.keys(_2).includes(p)&&(I.participantRole=p),Object.keys(zy).includes(f)&&(I.participantType=f),Array.isArray(l)&&(I.participantRoleResponsibilties=l),o.participantType===zy.INDIVIDUAL&&g&&EHe({updateParticipantName:e,existingParticipant:o,newValues:I,person:g}),Object.assign(o,je(I)),i&&XN({individualParticipantIds:[o.participantId],groupingParticipantId:i,removeFromOtherTeams:r,tournamentRecord:n}),st({topic:rn,payload:{tournamentId:n.tournamentId,participants:[o]}}),{participant:Oe(o),...W}}function PHe({individualParticipants:t,newValues:e}){let i=e.individualParticipantIds,r=t.filter(({participantId:n})=>i.includes(n)).map(({person:n})=>n?.standardFamilyName).filter(Boolean).sort().join("/");return i.length===1&&(r+="/Unknown"),r}function EHe({updateParticipantName:t,existingParticipant:e,newValues:i,person:r}){let n={},{standardFamilyName:a,standardGivenName:s,nationalityCode:o,personId:l,birthdate:u,tennisId:c,sex:d}=r;d&&Object.keys(UB).includes(d)&&(n.sex=d);let p;if(ni(l)&&(n.personId=l),o&&ni(o)&&(RHe(o)||o==="")&&(n.nationalityCode=o),a&&typeof ni(a)&&a.length>1&&(n.standardFamilyName=a,p=!0),s&&typeof ni(s)&&s.length>1&&(n.standardGivenName=s,p=!0),p&&t){let f=`${n.standardGivenName} ${n.standardFamilyName}`;i.participantName=f}u&&Mn(u)&&(n.birthdate=u),c&&ni(c)&&(n.tennisId=c),Object.assign(e.person,n)}function RHe(t){return ud.flatMap(({iso:e,ioc:i})=>[e,i]).filter(Boolean).includes(t)}function nE(t){let e=Wj(t);if(e.error)return e;let i="assignTieMatchUpParticipantId",r=t.teamParticipantId,{tournamentRecord:n,drawDefinition:a,participantId:s,event:o}=t;if(!s)return q({result:{error:dr},stack:i});if(t.sideNumber&&![1,2].includes(t.sideNumber))return q({result:{error:Bte},stack:i});let{inContextDualMatchUp:l,inContextTieMatchUp:u,relevantAssignments:c,collectionPosition:d,teamParticipants:p,collectionId:f,matchUpType:m,dualMatchUp:h,tieFormat:g}=e;if(u?.sides?.flatMap(x=>x.participant?.individualParticipantIds||x.participant?.participantId||[])?.includes(s))return q({result:{...W},stack:i});r=r??(t.sideNumber?l?.sides?.find(x=>x.sideNumber===t.sideNumber)?.participantId:void 0);let I=Ri({participantFilters:{participantIds:[s]},tournamentRecord:n})?.participants?.[0];if(!I)return q({result:{error:ji},stack:i});let{appliedPolicies:v}=Dt({tournamentRecord:n,drawDefinition:a,event:o}),w=t.policyDefinitions?.[Cr]??v?.[Cr]??Wv[Cr];if((t.enforceGender??w?.participants?.enforceGender)!==!1&&cl(u?.gender)&&ln(u?.gender)!==ln(I.person?.sex))return{error:_p,info:"Gender mismatch"};let{individualParticipantIds:y,participantType:b}=I;if(Pi(zt)(m)&&b!==It)return{error:Mo};let S=b===It?[s]:y,U=r&&p?.find(({participantId:x})=>x===r)||p?.find(({individualParticipantIds:x})=>xn(S,x));if(!U)return{error:fB};if(r||(r=U.participantId),!r)return{error:ji};let T=c?.find(x=>x.participantId===U?.participantId)?.drawPosition,P=h?.sides?.find(x=>x.participantId===r)?.sideNumber,D=u?.sides?.find(x=>T&&x.drawPosition===T)?.sideNumber,E=P??D??t.sideNumber;if(!g)return{error:Mv};if(!g.collectionDefinitions?.find(x=>x.collectionId===f))return{error:Lte};HU({tournamentId:n.tournamentId,eventId:o.eventId,inContextDualMatchUp:l,drawDefinition:a,dualMatchUp:h});let R=h?.sides?.find(x=>x.sideNumber===E),C=u?.sides?.find(x=>x.sideNumber===E),M=(R?.lineUp??Hp({participantId:r,drawDefinition:a})?.lineUp)?.filter(x=>x.collectionAssignments?.find(L=>L.collectionPosition===d&&L.collectionId===f&&!L.previousParticipantId))?.map(x=>x?.participantId),N=M?.length>1&&M||(b===ft?I.individualParticipantIds:[s]),A=vue({collectionPosition:d,teamParticipantId:r,dualMatchUpSide:R,drawDefinition:a,participantIds:N,collectionId:f});if(A.error)return q({result:A,stack:i});let{modifiedLineUp:O}=A,k;if(m===Bt){if(b!==ft){let x=mk({collectionPosition:d,teamParticipantId:r,drawDefinition:a,modifiedLineUp:O,participantId:s,collectionId:f,tieFormat:g});if(x?.error)return q({result:x,stack:i});if(x=F({side:C}),x.error)return x;k=x.deletedParticipantId,R&&(R.lineUp=O),h&&Ut({tournamentId:n?.tournamentId,matchUp:h,context:i,drawDefinition:a})}else if(b===ft)for(let x of N)mk({collectionPosition:d,teamParticipantId:r,drawDefinition:a,modifiedLineUp:O,participantId:x,collectionId:f,tieFormat:g})}else{let x=mk({collectionPosition:d,teamParticipantId:r,drawDefinition:a,modifiedLineUp:O,participantId:s,collectionId:f,tieFormat:g});if(x?.error)return x}if(R&&(R.lineUp=O),h&&Ut({tournamentId:n?.tournamentId,matchUp:h,context:i,drawDefinition:a}),k){let{error:x}=qh({participantIds:[k],tournamentRecord:n});x&&console.log("cleanup")}return{...W,modifiedLineUp:O};function F({side:x}){let L;if(x.participant){let $=x.participant.individualParticipantIds||[];if($.filter(Boolean).length===1){let{participant:V}=ro({participantIds:$,tournamentRecord:n});$.push(s);let{participant:_}=ro({participantIds:$,tournamentRecord:n});if(!_&&V){V.individualParticipantIds=$;let B=JN({pairOverride:!0,tournamentRecord:n,participant:V});if(B.error)return B}else L=V?.participantId}}else{let $=Il({participant:{individualParticipantIds:[s],participantRole:Jr,participantType:ft},pairOverride:!0,tournamentRecord:n});if($.error)return $}return{...W,deletedParticipantId:L}}}function mk({collectionPosition:t,teamParticipantId:e,drawDefinition:i,modifiedLineUp:r,participantId:n,collectionId:a,tieFormat:s}){let o=Hp({participantId:e,drawDefinition:i})?.lineUp,l=(r||o)?.find(c=>c?.participantId===n),u={collectionId:a,collectionPosition:t};if(l)l.collectionAssignments.push(u);else{let c={collectionAssignments:[u],participantId:n};r.push(c)}return Kh({participantId:e,lineUp:r,drawDefinition:i,tieFormat:s})}function yue(t){let{tournamentRecord:e,drawDefinition:i,participantId:r,event:n}=t,a="removeTieMatchUpParticiapantId";if(!r)return q({result:{error:dr},stack:a});let s=Wj(t);if(s.error)return s;let{appliedPolicies:o}=Dt({tournamentRecord:e,drawDefinition:i,event:n}),l=(t.policyDefinitions?.[Cr]??o?.[Cr]??Wv[Cr])?.processCodes?.substitution,{inContextDualMatchUp:u,inContextTieMatchUp:c,relevantAssignments:d,collectionPosition:p,teamParticipants:f,collectionId:m,matchUpType:h,dualMatchUp:g,tieMatchUp:I,tieFormat:v}=s;if(!g)return q({result:{error:aa},stack:a});let w=c?.sides?.find(E=>E.participant?.participantId===r||E.participant?.individualParticipantIds?.includes(r));if(!w)return q({result:{error:ji},stack:a});let y=t.policyDefinitions?.[ms]??o?.[ms];if(!w.substitutions?.length&&(fr({score:c?.score})||c?.winningSide)&&y?.requireParticipantsForScoring!==!1)return q({result:{error:Uie},stack:a});let b=u?.sides?.find(({sideNumber:E})=>E===w.sideNumber)?.participantId;if(!b)return q({result:{error:ji},stack:a});let S=Ri({participantFilters:{participantIds:[r]},tournamentRecord:e})?.participants?.[0];if(!S)return q({result:{error:ji},stack:a});if(h===zt&&S.participantType===ft)return q({result:{error:_p},stack:a});let U=S.participantType===It?[r]:S.individualParticipantIds;HU({tournamentId:e.tournamentId,eventId:n.eventId,inContextDualMatchUp:u,drawDefinition:i,dualMatchUp:g});let T=g.sides?.find(({sideNumber:E})=>E===w.sideNumber);if(!T&&(g.sides?.filter(({lineUp:E})=>!E).length||0)<2){let E=f?.map(({participantId:R})=>({drawPosition:d?.find(C=>C.participantId===R)?.drawPosition,teamParticipantId:R}));T=g.sides?.find(R=>E?.find(({drawPosition:C})=>C===R.drawPosition)?.teamParticipantId===b)}if(!T)return q({result:{error:ji,context:{participantId:r}}});let{modifiedLineUp:P,previousParticipantIds:D}=vue({collectionPosition:p,teamParticipantId:b,dualMatchUpSide:T,participantIds:U,drawDefinition:i,collectionId:m});if(T.lineUp=P,b&&v&&Kh({participantId:b,lineUp:P,drawDefinition:i,tieFormat:v}),h===Bt&&S.participantType===It){let E=c?.sides?.find(M=>M.sideNumber===T?.sideNumber),{participantId:R}=E??{},C=R&&Ri({participantFilters:{participantIds:[R]},tournamentRecord:e,withDraws:!0})?.participants?.[0];if(C){let M=C?.individualParticipantIds?.filter(N=>N!==r)??[];if(D&&M.push(...D),M.length>2)return q({result:{error:Ia},stack:a});if(C.draws?.length){if(M.length===1){let{participant:N}=ro({participantIds:M,tournamentRecord:e});if(!N){let A=Il({participant:{participantRole:Jr,individualParticipantIds:M,participantType:ft},pairOverride:!0,tournamentRecord:e});if(A.error)return q({result:A,stack:a})}}}else if(M.length){C.individualParticipantIds=M;let N=JN({participant:C,pairOverride:!0,tournamentRecord:e});if(N.error)return q({result:N,stack:a})}else{let N=qh({participantIds:[R],tournamentRecord:e});N.error&&console.log("cleanup",{result:N})}}else return q({result:{error:ji},stack:a})}if(w.substitutions?.length===1&&!c?.sides?.find(E=>E.sideNumber!==w.sideNumber)?.substitutions?.length&&I?.processCodes?.length){for(let E of l||[]){let R=I.processCodes.lastIndexOf(E);I.processCodes.splice(R,1)}Ut({tournamentId:e?.tournamentId,matchUp:I,context:a,drawDefinition:i})}return Ut({tournamentId:e?.tournamentId,matchUp:g,context:a,drawDefinition:i}),{...W,modifiedLineUp:P}}function qj(t){let e=He(t,[{[hr]:!0,[In]:!0,[Pl]:!0}]);if(e.error)return e;let{drawDefinition:i,sideNumber:r,matchUpId:n,event:a}=t;if(r&&![1,2].includes(r))return{error:re,sideNumber:r};let{matchUp:s,structure:o}=fi({drawDefinition:i,matchUpId:n,event:a});return s?Hn({structure:o})?(s.sides?.forEach(l=>{(!r||l.sideNumber===r)&&delete l.participantId}),Ut({tournamentId:t.tournamentRecord?.tournamentId,context:"assignSideParticipant",drawDefinition:i,matchUp:s}),{...W}):{error:X$}:{error:dn}}function CHe({matchUpStatuses:t=["BYE",ai,qt],drawPositionMatchUps:e,loserDrawPosition:i,sourceMatchUps:r}){let n=e?.reduce((c,d)=>!c||d.roundNumber>c.roundNumber?d:c,void 0),a=n?.drawPositions?.find(c=>c!==i),s=r.filter(c=>c?.drawPositions?.includes(a)).map(c=>c.matchUpStatus),o=r.filter(c=>c?.drawPositions?.includes(i)).map(c=>c.matchUpStatus),l=xn(s||[],t),u=xn(o||[],t);return{sourceMatchUp:n,winnerHadMatchUpStatus:l,winnerMatchUpStatuses:s,loserHadMatchUpStatus:u,loserMatchUpStatuses:o}}function MHe({inContextDrawMatchUps:t,sourceMatchUpStatus:e,targetDrawPosition:i,tournamentRecord:r,sourceMatchUpId:n,drawDefinition:a,structureId:s,dualMatchUp:o,roundNumber:l,matchUpsMap:u,event:c}){let{structure:d}=tt({drawDefinition:a,structureId:s});if(d?.structureType===gn)return{...W};u=u??kr({drawDefinition:a});let p=(u?.mappedMatchUps||{})[s].matchUps,{initialRoundNumber:f}=Hm({drawPosition:i,matchUps:p}),m=p?.filter(g=>g.roundNumber>=l&&g.roundNumber!==f&&g.drawPositions?.includes(i)),{positionAssignments:h}=Kt({drawDefinition:a,structureId:s});for(let g of m??[])NHe({inContextDrawMatchUps:t,sourceMatchUpStatus:e,positionAssignments:h,targetDrawPosition:i,tournamentRecord:r,sourceMatchUpId:n,drawDefinition:a,dualMatchUp:o,matchUpsMap:u,matchUp:g,event:c});return{...W}}function NHe({inContextDrawMatchUps:t,positionAssignments:e,sourceMatchUpStatus:i,targetDrawPosition:r,tournamentRecord:n,sourceMatchUpId:a,drawDefinition:s,dualMatchUp:o,matchUpsMap:l,matchUp:u,event:c}){let d="removeSubsequentDrawPosition";if(o){let f=t.find(({matchUpId:h})=>u.matchUpId===h).sides?.find(h=>h.drawPosition===r)?.sideNumber,m=u.sides?.find(h=>h.sideNumber===f);m&&delete m.lineUp}u.drawPositions=(u.drawPositions||[]).map(f=>f===r?void 0:f).filter(Boolean);let p=e.filter(({drawPosition:f})=>u.drawPositions?.includes(f)).filter(f=>f.bye).length;return u.matchUpStatus=p&&"BYE"||Lr(u.matchUpStatus)&&u.matchUpStatus||_i,Lr(u.matchUpStatus)&&(u.winningSide=void 0),u.matchUpStatusCodes&&Vae({inContextDrawMatchUps:t,sourceMatchUpStatus:i,sourceMatchUpId:a,matchUpsMap:l,matchUp:u}),Ut({tournamentId:n?.tournamentId,eventId:c?.eventId,context:`${d}-${r}`,drawDefinition:s,matchUp:u}),{...W}}function ry(t){let{dualWinningSideChange:e,inContextDrawMatchUps:i,tournamentRecord:r,drawDefinition:n,matchUpStatus:a,matchUpsMap:s,dualMatchUp:o,targetData:l,matchUpId:u,structure:c,event:d}=t,p=!!t.matchUp.collectionId,f=Hn({structure:c}),{drawPositions:m,winningSide:h}=l.matchUp||{};if(!f&&!m)return{error:KS};let{targetLinks:{loserTargetLink:g,winnerTargetLink:I,byeTargetLink:v},targetMatchUps:{loserMatchUp:w,winnerMatchUp:y,byeMatchUp:b}}=l,S=So({...t,matchUpStatus:a||_i,removeWinningSide:!0});if(S.error)return S;let U;if(p){let{matchUpTieId:O,matchUpsMap:k}=t;if(U=Hc({appliedPolicies:t.appliedPolicies,matchUpId:O,tournamentRecord:r,drawDefinition:n,matchUpsMap:k,event:d}),!e&&!U.removeWinningSide)return{...W}}if(f)return{...W};let{matchUps:T}=At({afterRecoveryTimes:!1,inContext:!0,drawDefinition:n,matchUpsMap:s,structure:c}),{positionAssignments:P}=pr({structure:c}),D=h-1,E=1-D,R=m[D],C=m[E],{winnerParticipantId:M,loserParticipantId:N}=P?.reduce((O,k)=>(k.drawPosition===C&&(O.loserParticipantId=k.participantId),k.drawPosition===R&&(O.winnerParticipantId=k.participantId),O),{winnerParticipantId:void 0,loserParticipantId:void 0})||{},A=T.filter(O=>O.drawPositions?.includes(C));if(y&&bue({sourceMatchUpStatus:a,sourceMatchUpId:u,inContextDrawMatchUps:i,winningDrawPosition:R,winnerParticipantId:M,tournamentRecord:r,winnerTargetLink:I,drawDefinition:n,winnerMatchUp:y,dualMatchUp:o,matchUpsMap:s}),w){let{winnerHadMatchUpStatus:O}=CHe({drawPositionMatchUps:A,loserDrawPosition:C,sourceMatchUps:T}),k=g.linkCondition===fl;if(O&&k){let x=Math.min(...w.drawPositions);Kx({targetLink:g,inContextDrawMatchUps:i,drawDefinition:n,drawPosition:x,matchUpsMap:s,event:d})}let F=AHe({sourceMatchUpStatus:a,sourceMatchUpId:u,loserParticipantId:N,tournamentRecord:r,loserTargetLink:g,drawDefinition:n,loserMatchUp:w,dualMatchUp:o,matchUpsMap:s,event:d});if(F.error)return F}if(b){let O=Math.min(...b.drawPositions);Kx({targetLink:v,inContextDrawMatchUps:i,drawDefinition:n,drawPosition:O,matchUpsMap:s,event:d})}return{...W,...U&&{tieMatchUpResult:U}}}function bue({inContextDrawMatchUps:t,winningDrawPosition:e,sourceMatchUpStatus:i,winnerParticipantId:r,tournamentRecord:n,winnerTargetLink:a,sourceMatchUpId:s,drawDefinition:o,winnerMatchUp:l,matchUpsMap:u,dualMatchUp:c,event:d}){let{structureId:p,roundNumber:f}=l,m="removeDirectedWinner";if(a){let h=a.target.structureId,{structure:g}=tt({drawDefinition:o,structureId:h});if(!g)return{error:vi};let{positionAssignments:I}=pr({structure:g});g.seedAssignments=(g.seedAssignments??[]).filter(U=>U.participantId!==r);let v=I?.find(U=>U.participantId===r)?.drawPosition,{matchUps:w}=At({drawDefinition:o,structure:g,event:d}),y=w.map(U=>U.drawPositions).flat(1/0).filter(Boolean),b=Sa(y);if((v?b[v]:void 0)===1)I?.forEach(U=>{U.participantId===r&&delete U.participantId});else{let U=w.filter(({drawPositions:T})=>T.includes(v));console.log("not removing from position assignments since instances > 1",{drawPositionMatchUps:U,winnerTargetLink:a})}let S=u?.drawMatchUps?.find(({matchUpId:U})=>U===l.matchUpId);S&&Ut({tournamentId:n?.tournamentId,eventId:d?.eventId,matchUp:S,context:m,drawDefinition:o})}return f&&MHe({targetDrawPosition:e,inContextDrawMatchUps:t,sourceMatchUpStatus:i,tournamentRecord:n,sourceMatchUpId:s,drawDefinition:o,dualMatchUp:c,matchUpsMap:u,roundNumber:f,structureId:p}),{...W}}function AHe({sourceMatchUpStatus:t,loserParticipantId:e,tournamentRecord:i,loserTargetLink:r,sourceMatchUpId:n,drawDefinition:a,loserMatchUp:s,matchUpsMap:o,dualMatchUp:l,event:u}){let c="removeDirectedLoser",d=r.target.structureId,{structure:p}=tt({drawDefinition:a,structureId:d});if(!p)return{error:vi};let{positionAssignments:f}=pr({structure:p}),m=f?.find(h=>h.participantId===e)?.drawPosition;if(f?.forEach(h=>{h.participantId===e&&delete h.participantId}),n&&t){let h=o?.drawMatchUps?.find(({matchUpId:g})=>g===s.matchUpId);h.matchUpStatusCodes=t===Si?["WO","WO"]:[]}if(p.seedAssignments=(p.seedAssignments??[]).filter(h=>h.participantId!==e),l){let h=s?.sides.reduce((v,w,y)=>w.drawPosition===m?y:v,void 0),g=o?.drawMatchUps?.find(({matchUpId:v})=>v===s.matchUpId),I=g?.sides?.[h];I&&(delete I.lineUp,Ut({tournamentId:i?.tournamentId,eventId:u?.eventId,matchUp:g,context:c,drawDefinition:a}))}return{...W}}function Kx({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,matchUpsMap:n,targetLink:a,event:s}){let o=a.target.structureId,l="removeDirectedBye";Ht({color:"brightyellow",method:l,drawPosition:r});let u=NU({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,matchUpsMap:n,structureId:o,event:s});return q({result:u,stack:l})}function kHe(t){let{matchUpFormat:e,score:i}=t,r=i?.sets?.length,n=e&&qi(e),{setFormat:a,finalSetFormat:s,bestOf:o}=n??{};return(o&&r===o&&s||a)?.timed||!1}function OHe({tournamentRecord:t,drawDefinition:e,structure:i,matchUp:r}){let n="attemptToSetMatchUpStatusBYE";if(r?.winningSide)return q({result:{error:Cv},context:{matchUpStatus:"BYE"},stack:n});let{positionAssignments:a}=pr({structure:i}),s=a?.filter(o=>o.bye).map(o=>o.drawPosition);return r.drawPositions?.some(o=>s?.includes(o))?(r.matchUpStatus="BYE",r.matchUpStatusCodes=[],Ut({tournamentId:t?.tournamentId,context:n,drawDefinition:e,matchUp:r}),{...W}):q({result:{error:Ote},info:"matchUp does not include BYE",stack:n})}function Jy(t){let{tournamentRecord:e,appliedPolicies:i,drawDefinition:r,matchUpsMap:n,targetData:a,structure:s,event:o}=t,l="doubleExitAdvancement";if(s.structureType===gn)return q({result:{...W},stack:l});let{matchUp:u,targetMatchUps:c,targetLinks:d}=a,{loserMatchUp:p,winnerMatchUp:f,loserTargetDrawPosition:m}=c,h=Lr(p?.matchUpStatus)&&!p.sides?.map(I=>I.participantId??I.participant).filter(Boolean).length,g=p?.matchUpStatus===Si;if(Ht({method:l,newline:!0,color:"brightyellow",keyColors:{sourceMatchUpId:"brightcyan",loserMatchUpId:"brightmagenta",winnerMatchUpId:"brightgreen"},sourceMatchUpId:u?.matchUpId,sourceStatus:t.matchUpStatus,sourceDP:JSON.stringify(u?.drawPositions),loserMatchUpId:p?.matchUpId,loserStatus:p?.matchUpStatus,loserDP:JSON.stringify(p?.drawPositions),loserTargetDP:m,loserIsEmptyExit:h,loserIsDoubleExit:g,loserSides:JSON.stringify(p?.sides?.map(I=>({sn:I.sideNumber,pid:I.participantId?.slice(0,8),fed:I.participantFed}))),winnerMatchUpId:f?.matchUpId,winnerStatus:f?.matchUpStatus,winnerDP:JSON.stringify(f?.drawPositions)}),p&&p.matchUpStatus!=="BYE"){let{loserTargetLink:I}=d,v=i?.progression?.doubleExitPropagateBye,w=p.feedRound&&p.sides?.[0]?.participantFed;if(v||w){Ht({method:l,color:"cyan",decision:"advanceByeToLoserMatchUp",propagateBye:v,targetFedIn:!!w});let y=wue({loserTargetDrawPosition:m,tournamentRecord:e,loserTargetLink:I,drawDefinition:r,loserMatchUp:p,matchUpsMap:n,event:o});if(y.error)return q({result:y,stack:l})}else if(h){let y=t.matchUpStatus===Wi?Wi:Si,b=t.matchUpStatus===Wi?qt:ai,S=n.drawMatchUps.find(U=>U.matchUpId===p.matchUpId);if(Ht({method:l,color:"brightred",decision:"EMPTY_EXIT_converting_to_DOUBLE_EXIT",loserMatchUpId:p.matchUpId,currentStatus:p.matchUpStatus,newStatus:y}),S){let U=[{matchUpStatus:b,previousMatchUpStatus:y,sideNumber:1},{matchUpStatus:b,previousMatchUpStatus:t.matchUpStatus,sideNumber:2}].map(P=>je(P)),T=So({...t,matchUp:S,matchUpId:p.matchUpId,matchUpStatus:y,matchUpStatusCodes:U,winningSide:void 0,removeScore:!0});if(T.error)return q({result:T,stack:l})}}else if(g)Ht({method:l,color:"brightyellow",decision:"SKIP_loserMatchUp_already_doubleExit",loserMatchUpId:p.matchUpId});else{let{feedRound:y,drawPositions:b,matchUpId:S}=p,U=y?2:2-b.indexOf(m);Ht({method:l,color:"cyan",decision:"conditionallyAdvanceLoser",feedRound:y,walkoverWinningSide:U,loserMatchUpId:S});let T=Bq({...t,targetMatchUp:p,walkoverWinningSide:U,tournamentRecord:e,sourceMatchUp:u,matchUpId:S});if(T.error)return q({result:T,stack:l})}}if(f){Ht({method:l,color:"cyan",decision:"conditionallyAdvanceWinner",winnerMatchUpId:f.matchUpId});let I=Bq({...t,matchUpId:f.matchUpId,targetMatchUp:f,tournamentRecord:e,sourceMatchUp:u});if(I.error)return q({result:I,stack:l})}return q({result:{...W},stack:l})}function Bq(t){let{inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:r,sourceMatchUp:n,targetMatchUp:a,matchUpsMap:s}=t,o=r.structures.find(({structureId:_})=>_===a.structureId),l=t.matchUpStatus===Wi?Wi:Si,u=t.matchUpStatus===Wi?qt:ai,c="conditionallyAdvanceDrawPosition",d=s.drawMatchUps.find(_=>_.matchUpId===a.matchUpId);if(!d)return{error:aa};let p=n?.drawPositions||[],f=d.drawPositions?.filter(Boolean),m=n?.structureId===a.structureId;if(Ht({method:c,newline:!0,color:"magenta",keyColors:{targetMatchUpId:"brightcyan",sourceMatchUpId:"brightyellow"},targetMatchUpId:a.matchUpId,targetStructureId:a.structureId?.slice(0,8),targetRound:[a.roundNumber,a.roundPosition],targetDP:JSON.stringify(d.drawPositions),targetStatus:d.matchUpStatus,targetFeedRound:a.feedRound,sourceMatchUpId:n?.matchUpId,sourceStructureId:n?.structureId?.slice(0,8),sourceRound:n?[n.roundNumber,n.roundPosition]:void 0,sourceDP:JSON.stringify(p),sameStructure:m,paramMatchUpStatus:t.matchUpStatus,EXIT:u,DOUBLE_EXIT:l}),m&&xn(p,f)&&(f=f.filter(_=>!p.includes(_))),m&&f.length>1)return q({result:{error:vI},stack:c});let{pairedPreviousMatchUpIsDoubleExit:h,pairedPreviousMatchUp:g}=$ae({...t,structure:o});Ht({method:c,color:"magenta",keyColors:{pairedMatchUpId:"brightcyan"},pairedMatchUpId:g?.matchUpId,pairedRound:g?[g.roundNumber,g.roundPosition]:void 0,pairedStatus:g?.matchUpStatus,pairedStructureId:g?.structureId?.slice(0,8),pairedIsDoubleExit:h});let I=Fn({matchUpId:a.matchUpId,inContextDrawMatchUps:e,drawDefinition:r}),{targetMatchUps:v,targetLinks:w}=I,{loserTargetDrawPosition:y,winnerMatchUp:b,loserMatchUp:S}=v;if(S){let{loserTargetLink:_}=w,B=wue({loserTargetDrawPosition:y,loserMatchUp:S,tournamentRecord:i,loserTargetLink:_,drawDefinition:r,matchUpsMap:s});if(B.error)return q({result:B,stack:c})}let U=d.drawPositions?.filter(Boolean)||[],T=U.length===1,P=t.walkoverWinningSide||T&&hD({drawPosition:U[0],matchUpId:a.matchUpId,inContextDrawMatchUps:e})||void 0,D=Lr(d.matchUpStatus)&&!U.length,E=D?l:u;Ht({method:c,color:"brightyellow",keyColors:{matchUpStatus:"brightgreen",existingExit:"brightred"},existingExit:D,matchUpStatus:E,targetCurrentStatus:d.matchUpStatus,targetDP:JSON.stringify(U),hasDrawPosition:T,walkoverWinningSide:P});let R=e.find(_=>_.matchUpId===g.matchUpId),C=[],M;n&&(n?.structureId===R?.structureId?n.roundPosition<g?.roundPosition?M=1:M=2:a.feedRound?n.structureId===a.structureId?M=2:M=1:P&&(M=3-P),Ht({method:c,color:"cyan",keyColors:{sourceSideNumber:"brightgreen"},sourceSideNumber:M,sourceStructureId:n.structureId?.slice(0,8),pairedStructureId:R?.structureId?.slice(0,8),targetStructureId:a.structureId?.slice(0,8),sameStructureAsPaired:n?.structureId===R?.structureId,targetFeedRound:a.feedRound,sourceRP:n.roundPosition,pairedRP:g?.roundPosition}));let N=t.matchUpStatus,A=g?.matchUpStatus;M===1?C=[{matchUpStatus:MT(N),previousMatchUpStatus:N,sideNumber:1},{matchUpStatus:MT(A),previousMatchUpStatus:A,sideNumber:2}]:M===2&&(C=[{matchUpStatus:MT(A),previousMatchUpStatus:A,sideNumber:1},{matchUpStatus:MT(N),previousMatchUpStatus:N,sideNumber:2}]),C.length&&(C=C.map(_=>je(_))),Ht({method:c,color:"brightgreen",keyColors:{matchUpStatus:"brightcyan",winningSide:"brightyellow"},action:"modifyMatchUpScore",targetMatchUpId:d.matchUpId,matchUpStatus:E,winningSide:P,matchUpStatusCodes:JSON.stringify(C),sourceStatus:N,pairedStatus:A});let O=So({...t,winningSide:P,matchUp:d,matchUpStatusCodes:C,matchUpStatus:E});if(O.error)return q({result:O,stack:c});if(D)return Ht({method:c,color:"brightred",decision:"EXISTING_EXIT_triggers_recursive_doubleExitAdvancement",targetMatchUpId:d.matchUpId,matchUpStatus:E}),Jy({...t,matchUpStatus:E,targetData:I});if(!b)return q({result:{...W},stack:c});let k=f.length===2?f[P-1]:f[0],{positionAssignments:F}=Kt({structure:o}),x=F?.find(_=>_.drawPosition===k),L=s.drawMatchUps.find(_=>_.matchUpId===b.matchUpId),$=L?.drawPositions?.filter(Boolean),V=$.length===1;if(k){if(x?.bye){let _=Fn({matchUpId:L.matchUpId,inContextDrawMatchUps:e,drawDefinition:r});if(V){let B=$.filter(Boolean)[0],G=hD({drawPosition:B,matchUpId:L.matchUpId,inContextDrawMatchUps:e}),j=So({appliedPolicies:t.appliedPolicies,matchUpId:L.matchUpId,matchUp:L,matchUpStatus:u,matchUpStatusCodes:[],removeScore:!0,drawDefinition:r,winningSide:G});return j.error?q({result:j,stack:c}):M2({drawPositionToAdvance:B,matchUpId:L.matchUpId,inContextDrawMatchUps:e,drawDefinition:r,matchUpsMap:s})}else if(Lr(b.matchUpStatus)){let B=Jy({...t,matchUpId:L.matchUpId,matchUpStatus:E,targetData:_});if(B.error)return q({result:B,stack:c})}return q({result:{...W},stack:c})}return hm({matchUpId:b.matchUpId,drawPosition:k,inContextDrawMatchUps:e,drawDefinition:r})}else if(h){if(!L)return{error:aa};if(V){let G=$[0],j=hD({matchUpId:a.matchUpId,inContextDrawMatchUps:e,drawPosition:G});console.log("existing drawPosition is winningSide",{walkoverWinningSide:j})}let _=Lr(L.matchUpStatus)?u:l,B=So({matchUpId:L.matchUpId,appliedPolicies:t.appliedPolicies,matchUp:L,matchUpStatusCodes:[],removeScore:!0,drawDefinition:r,matchUpStatus:_});if(B.error)return q({result:B,stack:c});if(_===l){let G=Jy({...t,matchUpId:a.matchUpId,matchUpStatus:_,targetData:I});if(G.error)return G}}return q({result:{...W},stack:c})}function wue(t){let{loserTargetDrawPosition:e,tournamentRecord:i,loserTargetLink:r,drawDefinition:n,matchUpsMap:a,event:s,loserMatchUp:o}=t,l=r?.target?.structureId,{structure:u}=tt({drawDefinition:n,structureId:l});return u?Ja({drawPosition:e,tournamentRecord:i,drawDefinition:n,structureId:l,matchUpsMap:a,loserMatchUp:o,event:s}):{error:mf}}function MT(t){return t===Si?ai:t===Wi?qt:t}function xHe(t){let{tournamentRecord:e,drawDefinition:i,matchUpStatus:r,structure:n,matchUp:a}=t,s=!!(a.tieMatchUps&&!a.rondPosition&&t.inContextDrawMatchUps.find(v=>v.matchUpId===a.matchUpId).containerStructureId),o="attemptToSetMatchUpStatus",l=r==="BYE",u=a.winningSide,c=[Si,Wi].includes(r),d=MU({matchUpStatus:r}),p=Dx({matchUpStatus:r}),f=!d&&!p,m=t.matchUpTieId||u&&d&&!c,h=u&&c;Ht({method:o,newline:!0,color:"brightyellow",keyColors:{matchUpStatus:"brightcyan",matchUpId:"brightmagenta"},matchUpId:a.matchUpId,matchUpStatus:r,existingStatus:a.matchUpStatus,existingWinningSide:u,isDoubleExit:c,isBYE:l,directing:d,nonDirecting:p,unrecognized:f,onlyModifyScore:m,changeCompletedToDoubleExit:h,propagateExitStatus:t.propagateExitStatus,teamRoundRobinContext:s});let g=()=>So({...t,removeScore:[Rl,ai].includes(r),matchUpStatus:r||_i}),I=f&&"unrecognized"||m&&"onlyModifyScore"||h&&"changeCompletedToDoubleExit"||u&&"existingWinningSide_removeDirected"||p&&"nonDirecting_clearScore"||l&&"isBYE"||!d&&"notDirecting_error"||c&&"isDoubleExit_modifyAndAdvance"||s&&"teamRoundRobinContext"||t.propagateExitStatus&&"propagateExitStatus"||"fallthrough_error";return Ht({method:o,color:"brightgreen",keyColors:{route:"brightcyan"},route:I,matchUpId:a.matchUpId}),f&&{error:ax}||m&&bD(t)||h&&FHe(t)||u&&ry(t)||p&&g()||l&&OHe({tournamentRecord:e,drawDefinition:i,structure:n,matchUp:a})||!d&&{error:ax}||c&&LHe(t)||s&&bD(t)||t.propagateExitStatus&&bD(t)||q({result:{error:Cv,info:"matchUpStatus: "+r},stack:o})}function FHe(t){let e=ry(t);return e.error?e:Jy(t)}function LHe(t){let e=bD({...t,removeScore:!0});return e.error?e:Jy(t)}function bD(t){let e="scoreModification";if(t.isCollectionMatchUp&&t.dualMatchUp?.winningSide&&!t.projectedWinningSide){let n=ry(t);if(n.error)return q({result:n,stack:e})}let i=!!t.matchUp.collectionId,r=So({...t});if(i){let{matchUpTieId:n,drawDefinition:a,matchUpsMap:s}=t,o=Hc({tournamentRecord:t.tournamentRecord,appliedPolicies:t.appliedPolicies,matchUpId:n,event:t.event,drawDefinition:a,matchUpsMap:s});if(o.error)return q({result:o,stack:e});Object.assign(r,{tieMatchUpResult:o})}return q({result:r,stack:e})}function _He({drawDefinition:t,structure:e,matchUp:i}){let{drawPositions:r}=i,{positionAssignments:n}=Kt({drawDefinition:t,structure:e}),a=n?.filter(({drawPosition:l})=>r?.includes(l))?.map(l=>{let{extension:u}=ht({element:l,name:Tc});return u?.value?.groupOrder}),{containerStructures:s}=Bv({drawDefinition:t}),o=s[e.structureId];return{structureIds:Vv({drawDefinition:t,structureId:o})?.links?.source?.filter(l=>xn(a,l.source?.finishingPositions||[])).map(l=>l.source.structureId)}}function Sue({drawDefinition:t,structure:e,matchUp:i}){let r=[];if(e.finishingPosition===jp&&Su({drawDefinition:t,structure:e})){let{structureIds:n}=_He({drawDefinition:t,structure:e,matchUp:i});n?.length&&r.push(...n)}return{connectedStructureIds:r}}function $He(t){let e,{inContextDrawMatchUps:i,inContextMatchUp:r,drawDefinition:n,winningSide:a}=t,s=t.targetData.targetLinks?.winnerTargetLink;if(s.target.feedProfile===ho){let o=r.sides.find(({sideNumber:u})=>u!==a).participantId,l=i.find(u=>u.structureId===s.target.structureId&&u.roundNumber===s.target.roundNumber&&u.sides.some(({participantId:c})=>c===o));if(l?.matchUpStatus===_i){let u=Fn({matchUpId:l.matchUpId,inContextDrawMatchUps:i,drawDefinition:n});if(!Yp({inContextDrawMatchUps:i,drawDefinition:n,targetData:u})){let{structure:c}=tt({structureId:l.structureId,drawDefinition:n}),d=Kt({structure:c}).positionAssignments;for(let p of d||[])if(p.participantId===o){let f=r.sides.find(({sideNumber:m})=>m===a).participantId;if(p.participantId=f,c?.positionAssignments)c.positionAssignments=d;else if(c?.structures){let m=Object.assign({},...(d||[]).map(h=>({[h.drawPosition]:h.participantId})));for(let h of c.structures)h.positionAssignments?.forEach(g=>g.participantId=m[g.drawPosition])}Dc({tournamentId:t.tournamentRecord?.tournamentId,event:t.event,drawDefinition:n,structure:c}),e=!0}}}}return{...W,qualifierReplaced:e}}function BHe(t){let e,{inContextDrawMatchUps:i,inContextMatchUp:r,drawDefinition:n,winningSide:a}=t,s=t.targetData.targetLinks?.winnerTargetLink;if(s.target.feedProfile===ho){let o=r.sides.find(({sideNumber:c})=>c===a)?.participantId,l=i.filter(c=>c.structureId===s.target.structureId&&c.roundNumber===s.target.roundNumber&&c.sides.some(({participantId:d,qualifier:p})=>p&&!d)),u=Ns(l);if(u?.matchUpStatus===_i){let c=Fn({matchUpId:u.matchUpId,inContextDrawMatchUps:i,drawDefinition:n});if(!Yp({inContextDrawMatchUps:i,drawDefinition:n,targetData:c})){let d=u.sides.find(m=>m.qualifier&&!m.participantId)?.drawPosition,{structure:p}=tt({structureId:u.structureId,drawDefinition:n});if(!p)return{error:vi};let f=Kt({structure:p}).positionAssignments;for(let m of f||[])if(m.drawPosition===d&&!m.participantId){if(m.participantId=o,p.positionAssignments)p.positionAssignments=f;else if(p.structures){let h=Object.assign({},...(f||[]).map(g=>({[g.drawPosition]:g.participantId})));for(let g of p.structures)g.positionAssignments?.forEach(I=>I.participantId=h[I.drawPosition])}Dc({tournamentId:t.tournamentRecord?.tournamentId,event:t.event,drawDefinition:n,structure:p}),e=!0}}}}return{...W,qualifierPlaced:e}}function VHe(t){let e="attemptToSetWinningSide",i,r={},{appliedPolicies:n,disableAutoCalc:a,drawDefinition:s,dualMatchUp:o,winningSide:l,structure:u,matchUp:c}=t;if(o?._disableAutoCalc&&a!==!1)return cV(t);if(c.winningSide&&c.winningSide!==l){let{connectedStructureIds:m}=Sue({drawDefinition:s,structure:u,matchUp:c});m.length&&(console.log({connectedStructureIds:m}),i=!0);let h=ry(t);if(h.error)return h}let d=Ese(t);if(d.context?.progressExitStatus&&Object.assign(r,d.context),d.error)return q({result:d,stack:e});let p,f;return t.qualifierChanging&&n?.[Kb]?.autoReplaceQualifiers&&(p=$He(t).qualifierReplaced),t.qualifierAdvancing&&n?.[Kb]?.autoPlaceQualifiers&&(f=BHe(t).qualifierPlaced),q({result:je({...W,...d,connectedStructures:i,qualifierReplaced:p,qualifierPlaced:f,context:r}),stack:e})}var wD={drawPositionToRemove:"green",iteration:"brightred",winner:"green",loser:"brightred"};function Uue(t){let{inContextDrawMatchUps:e,appliedPolicies:i,drawDefinition:r,matchUpsMap:n,targetData:a,matchUp:s}=t,{matchUpId:o}=s,{iteration:l=0}=t;l+=1;let u="removeDoubleExit";Ht({color:"brightyellow",method:u,matchUpId:o,iteration:l,keyColors:wD});let{targetMatchUps:{loserMatchUp:c,winnerMatchUp:d,loserTargetDrawPosition:p},targetLinks:{loserTargetLink:f}}=a;if(d&&d.matchUpStatus!=="BYE"){let{stage:g,roundNumber:I,roundPosition:v,structureName:w}=d;Ht({winner:"winner",roundPosition:v,structureName:w,roundNumber:I,keyColors:wD,stage:g}),Vq({...t,targetMatchUp:d,sourceMatchUp:s,iteration:l})}let m=c?.matchUpStatus==="BYE"&&(c?.feedRound||c?.roundNumber===1),h=a?.targetLinks?.loserTargetLink?.linkCondition===fl;if(m&&h){let g=e.filter(({roundNumber:w,structureId:y})=>y===s.structureId&&w===1),I=g.map(({roundPosition:w})=>w),v=wr(I.sort(),2).find(w=>w.includes(s.roundPosition));if((g.filter(({roundPosition:w})=>v.includes(w))?.map(({matchUpStatus:w})=>w)).every(w=>[Wi,Si].includes(w)))return q({result:{...W},stack:u})}if(c&&(c.matchUpStatus!=="BYE"||m)){let g=e.find(({matchUpId:U})=>U===c.matchUpId),{structure:I}=tt({drawDefinition:r,structureId:g.structureId}),{stage:v,roundNumber:w,roundPosition:y,feedRound:b,structureName:S}=c;if(Ht({loser:"loser",roundPosition:y,structureName:S,roundNumber:w,keyColors:wD,feedRound:b,stage:v}),i?.progression?.doubleExitPropagateBye||m)Kx({drawPosition:p,targetLink:f,inContextDrawMatchUps:e,drawDefinition:r,matchUpsMap:n});else{let U=Vq({...t,targetMatchUp:c,structure:I,iteration:l});if(U.error)return q({result:U,stack:u})}}return q({result:{...W},stack:u})}function Vq(t){let{inContextDrawMatchUps:e,appliedPolicies:i,drawDefinition:r,sourceMatchUp:n,targetMatchUp:a,matchUpsMap:s,structure:o,iteration:l}=t,u="conditionallyRemoveDrawPosition";Ht({method:u,structureName:o?.structureName,iteration:l});let c=Fn({matchUpId:a.matchUpId,inContextDrawMatchUps:e,drawDefinition:r}),{targetMatchUps:{winnerMatchUp:d}}=c,p=s?.drawMatchUps.find(w=>w.matchUpId===a.matchUpId),f,m,h;if(a.feedRound)h=d?.drawPositions?.filter(Boolean)?.find(w=>a.drawPositions.includes(w));else if(n==null)h=Li(a?.drawPositions||[],d?.drawPositions||[])?.[0];else{m=Bae({structureId:o.structureId,matchUp:n,matchUpsMap:s})?.pairedPreviousMatchUp,f=[Si,Wi].includes(m?.matchUpStatus);let w=m?.drawPositions?.filter(Boolean)||[];if([...Ki,"BYE"].includes(m?.matchUpStatus)||m?.winningSide){let y=n.drawPositions||[],b=a.drawPositions?.filter(Boolean);xn(y,b)&&(b=b?.filter(S=>!y.includes(S))),h=y.concat(w).find(S=>b?.includes(S))}}if(d&&h){let{stage:w,roundNumber:y,roundPosition:b,structureName:S}=d;Ht({method:"removeDirectedWinner",drawPositionToRemove:h,color:"brightgreen",roundPosition:b,structureName:S,roundNumber:y,keyColors:wD,stage:w}),bue({winningDrawPosition:h,winnerMatchUp:d,inContextDrawMatchUps:e,drawDefinition:r,matchUpsMap:s})}let g=Uue({targetData:c,matchUp:a,inContextDrawMatchUps:e,appliedPolicies:i,drawDefinition:r,matchUpsMap:s,structure:o,iteration:l});if(g.error)return q({result:g,stack:u});let I=jHe({pairedPreviousDoubleExit:f,noContextTargetMatchUp:p}),v=!f;return g=So({...t,matchUpId:a.matchUpId,matchUp:p,removeWinningSide:!0,matchUpStatusCodes:[],matchUpStatus:I,removeScore:v,score:{scoreStringSide1:"",scoreStringSide2:"",sets:void 0}}),g.error?q({result:g,stack:u}):{...W}}function jHe({pairedPreviousDoubleExit:t,noContextTargetMatchUp:e}){return e.matchUpStatus==="BYE"?"BYE":t?[Wi,qt].includes(e?.matchUpStatus)?qt:ai:_i}function GHe(t){let e,{inContextDrawMatchUps:i,inContextMatchUp:r,drawDefinition:n}=t,a=t.targetData.targetLinks?.winnerTargetLink;if(a.target.feedProfile===ho){let s=r.sides?.find(({sideNumber:l})=>l===r.winningSide)?.participantId,o=i.find(l=>l.structureId===a.target.structureId&&l.roundNumber===a.target.roundNumber&&l.sides?.some(({participantId:u})=>u===s));if(o&&o.matchUpStatus===_i){let l=Fn({matchUpId:o.matchUpId,inContextDrawMatchUps:i,drawDefinition:n});if(!Yp({inContextDrawMatchUps:i,drawDefinition:n,targetData:l})){let{structure:u}=tt({structureId:o.structureId,drawDefinition:n}),c=Kt({structure:u}).positionAssignments;for(let d of c||[])if(d.participantId===s){if(d.participantId=void 0,u?.positionAssignments)u.positionAssignments=c;else if(u?.structures){let p=Object.assign({},...(c||[]).map(f=>({[f.drawPosition]:f.participantId})));for(let f of u?.structures||[])f.positionAssignments?.forEach(m=>m.participantId=p[m.drawPosition])}Dc({tournamentId:t.tournamentRecord?.tournamentId,event:t.event,drawDefinition:n,structure:u}),e=!0}}}}return{qualifierRemoved:e}}function HHe(t){let{matchUp:e,matchUpStatus:i,score:r,winningSide:n}=t,a="noDownStreamDependencies";if([Si,Wi].includes(e?.matchUpStatus)&&![Si,Wi].includes(i)){let g=Uue(t);if(g.error)return q({result:g,stack:a})}let s=i===Si,o=fr({score:r})&&!s&&(t.isCollectionMatchUp&&!t.projectedWinningSide||!n),l=t?.inContextMatchUp?.collectionId&&kHe(t.inContextMatchUp),u=t.removeScore||!l&&![Da,Ta].includes(i||Da),c=t.isCollectionMatchUp&&t.dualMatchUp.winningSide&&!t.projectedWinningSide||e.winningSide&&!n&&!fr({score:r}),d=g=>{let I,{structure:v,drawDefinition:w,dualMatchUp:y,disableAutoCalc:b}=t;if(y?._disableAutoCalc&&b!==!1)return cV({...t,removeWinningSide:c});let{connectedStructureIds:S}=Sue({drawDefinition:w,structure:v,matchUp:e});S.length&&(console.log({connectedStructureIds:S}),I=!0),Object.assign(t,{removeScore:g});let U=ry(t);if(U.error)return U;if(t.removingQualifier&&t.appliedPolicies?.[Kb]?.autoRemoveQualifiers){let T=GHe(t);return{...W,connectedStructures:I,...T}}return{...W,connectedStructures:I}};if(c&&n&&t.isCollectionMatchUp)return jq(t);let p=[Rl,Ta].includes(i)&&t.dualWinningSideChange,f=i&&i!==_i,m=t.propagateExitStatus&&Lr(i),h=(n||p||m)&&VHe(t)||o&&d(u)||f&&xHe(t)||c&&d(u)||e&&jq({...t,removeScore:!0})||{...W};return q({result:h,stack:a})}function jq(t){let e="ndd:scoreModification";if(t.isCollectionMatchUp&&t.dualMatchUp?.winningSide&&!t.projectedWinningSide&&!t.autoCalcDisabled){let r=ry(t);if(r.error)return r}let i=So({...t});if(t.isCollectionMatchUp){let{matchUpTieId:r,drawDefinition:n,event:a,matchUpsMap:s}=t,{removeWinningSide:o}=Hc({tournamentRecord:t.tournamentRecord,appliedPolicies:t.appliedPolicies,matchUpId:r,drawDefinition:n,matchUpsMap:s,event:a});o&&console.log("REMOVE WINNING SIDE")}return q({result:i,stack:e})}function Yj(t){let e=He(t,[{[hr]:!0,[In]:!0,[Pl]:!0},{homeParticipantId:!0,[js]:dr}]);if(e.error)return e;let i=Qv(t,[{[xv]:Au,attr:{[CM]:!0}}]);if(i.error)return i;let r=i?.matchUp?.matchUp?.sides?.map(c=>c?.participantId);if(t.homeParticipantId&&!r?.includes(t.homeParticipantId))return{error:Co};let{disableNotice:n,homeParticipantId:a,removePriorValues:s,tournamentRecord:o,drawDefinition:l,matchUpId:u}=t;return Ea({duplicateValues:!1,removePriorValues:s,tournamentRecord:o,drawDefinition:l,disableNotice:n,matchUpId:u,timeItem:{itemType:w2,itemValue:a}})}function Tue({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:r,timeStamp:n}=Uf({timeItems:i?.timeItems||[],itemType:zM});return!e||n&&t&&new Date(n).getTime()>new Date(t).getTime()?{timeModifiers:r}:e}function tp(t){let e="addMatchUpScheduledTime",i=t.matchUp,{removePriorValues:r,tournamentRecord:n,drawDefinition:a,disableNotice:s,scheduledTime:o,matchUpId:l}=t;if(!l)return q({result:{error:Tn},stack:e});if(!kv(o))return q({result:{error:Es},stack:e});if(!i){let f=fi({drawDefinition:a,matchUpId:l});if(f.error)return q({result:f,stack:e});i=f.matchUp}let u=Ze(o),c=Tf({matchUp:i}).scheduledDate,d=u&&!c;if((Tue({matchUp:i}).timeModifiers||[])?.length){let f=Due({disableNotice:!0,removePriorValues:r,tournamentRecord:n,timeModifiers:[],drawDefinition:a,matchUpId:l,matchUp:i});if(f?.error)return q({result:f,stack:e})}let p=xh(o,!0,d);return Ea({duplicateValues:!1,removePriorValues:r,tournamentRecord:n,drawDefinition:a,disableNotice:s,matchUpId:l,timeItem:{itemType:jh,itemValue:p}})}function Due({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,timeModifiers:n,matchUpId:a,matchUp:s}){let o="addMatchUpTimeModifiers";if(!a)return q({result:{error:Tn},stack:o});if(n!==void 0&&!Array.isArray(n))return q({info:zp("timeModifiers"),result:{error:re},stack:o});if(!s){let d=fi({drawDefinition:i,matchUpId:a});if(d.error)return q({result:d,stack:o});s=d.matchUp}let l=Tue({matchUp:s}).timeModifiers||[],u=n.filter(d=>!l.includes(d));if(n.length&&!u.length)return{...W};if(u.some(d=>Sx.includes(d))){l=l.filter(p=>!Sx.includes(p));let d=tp({disableNotice:!0,removePriorValues:t,scheduledTime:"",tournamentRecord:e,drawDefinition:i,matchUpId:a});if(d.error)return q({result:d,stack:o})}let c=n?.length?[...u,...l]:void 0;return Ea({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:a,timeItem:{itemType:zM,itemValue:c}})}function QN({scheduledDate:t,removePriorValues:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:a}){if(!a)return{error:Tn};let s=t&&dl.test(t);if(t&&!s)return{error:or};let o={itemValue:Ze(t),itemType:Vh};return Ea({duplicateValues:!1,removePriorValues:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:a,timeItem:o})}function ZN({removePriorValues:t,tournamentRecords:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,courtDayDate:a,matchUpId:s,courtIds:o}){if(!i&&!e)return{error:ve};if(!s)return{error:Tn};let l=fi({drawDefinition:r,matchUpId:s});if(l.error)return l;if(l?.matchUp?.matchUpType!==La)return{error:sa};if(!(o===void 0||Array.isArray(o)&&o.length&&o.every(c=>typeof c=="string")))return{error:re,context:{courtIds:o}};let u;if(o){let c=e||i&&{[i.tournamentId]:i},d=Fu({tournamentRecords:c});if(d.error)return d;let p=d.courts?.filter(f=>o.includes(f.courtId));if(p?.length!==o.length)return{error:re,context:{courtIds:o}};u=p?.map(f=>({venueId:f.venueId,courtId:f.courtId}))}return Ea({duplicateValues:!1,removePriorValues:t,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:s,timeItem:{itemType:wu,itemDate:a,itemValue:u}})}function ny({removePriorValues:t,tournamentRecords:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:a,venueId:s}){if(!i)return{error:ve};if(!a)return{error:Tn};if(s){let o=Ou({tournamentRecords:e,tournamentRecord:i,venueId:s});if(o.error)return o}return Ea({duplicateValues:!1,removePriorValues:t,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:a,timeItem:{itemType:Bh,itemValue:s}})}function tg({removePriorValues:t,tournamentRecords:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,courtDayDate:a,matchUpId:s,courtId:o}){if(!i&&!e)return{error:ve};if(!s)return{error:Tn};if(o){let l=Zd({tournamentRecords:e,tournamentRecord:i,courtId:o});if(l.error)return l;let u=l.venue?.venueId;ny({tournamentRecords:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:s,venueId:u})}return Ea({duplicateValues:!1,removePriorValues:t,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:s,timeItem:{itemType:Ed,itemDate:a,itemValue:o}})}function Wo(t,e){let i=zie.test(t)?t:pi(t),r=Ze(t)||Ze(e)||Bs(new Date);return new Date(`${r}T${i}`).getTime()}function eA(t){let e="addMatchUpScheduleItems",i=He(t,[{drawDefinition:!0,matchUpId:!0},{schedule:!0,[qn]:Kn}],e);if(i.error)return i;let{matchUpDependencies:r,inContextMatchUps:n}=t,{proConflictDetection:a=!1,errorOnAnachronism:s=!1,checkChronology:o=!0,removePriorValues:l,tournamentRecords:u,tournamentRecord:c,drawDefinition:d,disableNotice:p,drawMatchUps:f,matchUpId:m,schedule:h,event:g}=t,I,v;if(f)I=f.find(A=>A.matchUpId===m);else{let A=fi({drawDefinition:d,event:g,matchUpId:m});if(A.error)return A;I=A.matchUp}let{endTime:w,courtId:y,courtIds:b,courtOrder:S,resumeTime:U,homeParticipantId:T,scheduledDate:P,scheduledTime:D,startTime:E,stopTime:R,timeModifiers:C,venueId:M}=h;o&&(!r||!n)&&({matchUpDependencies:r,matchUps:n}=co({drawDefinition:d}));let N=r?.[m]?.matchUpIds;if(h.scheduledDate&&o&&N){let A=n?.filter(O=>(O.schedule?.scheduledDate||Ze(O.schedule?.scheduledTime))&&N.includes(O.matchUpId)).map(({schedule:O})=>{let k=NP(O);return new Date(k??"").getTime()});if(A?.length){let O=NP(h),k=new Date(O??"").getTime();if(Math.max(...A)>=k){if(s)return q({result:{error:ix},stack:e});v=ix}}}if(P!==void 0){let A=QN({disableNotice:!0,removePriorValues:l,tournamentRecord:c,drawDefinition:d,scheduledDate:P,matchUpId:m});if(A?.error)return q({result:A,stack:e,context:{scheduledDate:P}})}if(D!==void 0){let A=tp({disableNotice:!0,removePriorValues:l,tournamentRecord:c,drawDefinition:d,scheduledTime:D,matchUpId:m,matchUp:I});if(A?.error)return q({result:A,stack:e,context:{scheduledTime:D}})}if(E!==void 0){let A=Xj({disableNotice:!0,removePriorValues:l,tournamentRecord:c,drawDefinition:d,matchUpId:m,startTime:E,event:g});if(A?.error)return q({result:A,stack:e,context:{startTime:E}})}if(R!==void 0){let A=Qj({disableNotice:!0,removePriorValues:l,tournamentRecord:c,drawDefinition:d,matchUpId:m,stopTime:R,event:g});if(A?.error)return q({result:A,stack:e,context:{stopTime:R}})}if(U!==void 0){let A=Zj({disableNotice:!0,removePriorValues:l,tournamentRecord:c,drawDefinition:d,resumeTime:U,matchUpId:m,event:g});if(A?.error)return q({result:A,stack:e,context:{resumeTime:U}})}if(w!==void 0){let A=Jj({disableNotice:!0,removePriorValues:l,tournamentRecord:c,drawDefinition:d,matchUpId:m,endTime:w,event:g});if(A?.error)return q({result:A,stack:e,context:{endTime:w}})}if(b!==void 0){let A=ZN({disableNotice:!0,removePriorValues:l,tournamentRecord:c,drawDefinition:d,matchUpId:m,courtIds:b});if(A?.error)return q({result:A,stack:e,context:{courtIds:b}})}if(a&&y!==void 0&&P!==void 0&&S!==void 0&&lt(S)){let A=Ke(S),O=(Ur({tournamentRecord:c})?.matchUps??[]).find(k=>{if(k.matchUpId===m)return!1;let F=k.schedule?.courtOrder?Ke(k.schedule.courtOrder):void 0;return k.schedule?.courtId===y&&F===A&&k.schedule?.scheduledDate===P});if(O)return q({result:{error:hte,info:`Court slot already occupied by matchUp ${O.matchUpId}`},stack:e,context:{courtId:y,courtOrder:S,scheduledDate:P}})}if(y!==void 0&&P!==void 0){let A=tg({courtDayDate:P,disableNotice:!0,removePriorValues:l,tournamentRecords:u,tournamentRecord:c,drawDefinition:d,matchUpId:m,courtId:y});if(A?.error)return q({result:A,stack:e,context:{courtId:y}})}if(M!==void 0){let A=ny({disableNotice:!0,removePriorValues:l,tournamentRecords:u,tournamentRecord:c,drawDefinition:d,matchUpId:m,venueId:M});if(A?.error)return q({result:A,stack:e,context:{venueId:M}})}if(S!==void 0&&lt(S)){let A=Kj({disableNotice:!0,removePriorValues:l,tournamentRecord:c,drawDefinition:d,courtOrder:S,matchUpId:m});if(A?.error)return q({result:A,stack:e,context:{courtOrder:S}})}if(C!==void 0){let A=Due({disableNotice:!0,removePriorValues:l,tournamentRecord:c,drawDefinition:d,timeModifiers:C,matchUpId:m,matchUp:I});if(A?.error)return q({result:A,stack:e,context:{timeModifiers:C}})}return ni(T)&&Yj({disableNotice:!0,homeParticipantId:T,removePriorValues:l,tournamentRecord:c,drawDefinition:d,matchUpId:m}),p||Ut({tournamentId:c?.tournamentId,eventId:g?.eventId,context:e,drawDefinition:d,matchUp:I}),v?{...W,warnings:[v]}:{...W}}function Kj({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,courtOrder:n,matchUpId:a}){if(!a)return{error:Tn};if(n&&!lt(n))return{error:re,info:"courtOrder must be numeric"};let s=n&&Ke(n);return Ea({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:a,timeItem:{itemType:WM,itemValue:s}})}function Pue({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,participantId:n,officialType:a,matchUpId:s}){if(!s)return{error:Tn};if(!n)return{error:dr};if(e){let l=Ri({tournamentRecord:e,participantFilters:{participantTypes:[It],participantRoles:[L2]}}).participants??[];if(!Ud({tournamentParticipants:l,participantId:n}))return{error:ji}}let o={itemType:"SCHEDULE.ASSIGNMENT.OFFICIAL",itemValue:n};return a&&(o.itemSubTypes=[a]),Ea({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:s,timeItem:o})}function Xj({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:n,startTime:a,event:s}){if(!n)return{error:Tn};if(!kv(a))return{error:Es};let{matchUp:o}=fi({drawDefinition:i,event:s,matchUpId:n}),{scheduledDate:l}=Tf({matchUp:o}),u=(o?.timeItems??[]).filter(c=>[ec,Kl,Ec].includes(c?.itemType)).map(c=>Wo(c.itemValue,l)).reduce((c,d)=>!c||d<c?d:c,void 0);if(!u||Wo(a,l)<u){o?.timeItems&&(o.timeItems=o.timeItems.filter(d=>d.itemType!==go));let c=xh(a,!0,!0);return Ea({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:n,timeItem:{itemType:go,itemValue:c}})}else return{error:fie}}function Jj({validateTimeSeries:t=!0,removePriorValues:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:a,endTime:s,event:o}){if(!a)return{error:Tn};if(!kv(s))return{error:Es};let{matchUp:l}=fi({drawDefinition:r,event:o,matchUpId:a}),{scheduledDate:u}=Tf({matchUp:l}),c=(l?.timeItems??[]).filter(d=>[go,Kl,ec].includes(d?.itemType)).map(d=>Wo(d.itemValue,u)).reduce((d,p)=>!d||p>d?p:d,void 0);if(!t||!c||Wo(s,u)>c){l?.timeItems&&(l.timeItems=l.timeItems.filter(p=>p.itemType!==Ec));let d=xh(s,!0,!0);return Ea({duplicateValues:!1,removePriorValues:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:a,timeItem:{itemType:Ec,itemValue:d}})}else return{error:die}}function Qj({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:n,stopTime:a,event:s}){if(!n)return{error:Tn};if(!kv(a))return{error:Es};let{matchUp:o}=fi({drawDefinition:i,event:s,matchUpId:n}),{scheduledDate:l}=Tf({matchUp:o}),u=o?.timeItems??[];if(u.reduce((m,h)=>h.itemType===Ec||m,void 0))return{error:uB};let c=u.filter(m=>[go,Kl,ec].includes(m?.itemType)).sort((m,h)=>Wo(m.itemValue,l)-Wo(h.itemValue,l)),d=c.at(-1),p=d?.itemType===ec,f=c.filter(m=>!p||m.createdAt!==d.createdAt).map(m=>Wo(m.itemValue,l)).reduce((m,h)=>!m||h>m?h:m,void 0);if(Wo(a,l)>f){if(o?.timeItems&&p){let h=d.createdAt;o.timeItems=o.timeItems.filter(g=>g.createdAt!==h)}let m={itemValue:xh(a,!0,!0),itemType:ec};return Ea({duplicateValues:!0,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:n,timeItem:m})}else return{error:pie}}function Zj({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,resumeTime:n,matchUpId:a,event:s}){if(!a)return{error:Tn};if(!kv(n))return{error:Es};let{matchUp:o}=fi({drawDefinition:i,event:s,matchUpId:a}),{scheduledDate:l}=Tf({matchUp:o}),u=o?.timeItems??[];if(u.reduce((m,h)=>h.itemType===Ec||m,void 0))return{error:uB};let c=u.filter(m=>[go,Kl,ec].includes(m?.itemType)).sort((m,h)=>Wo(m.itemValue,l)-Wo(h.itemValue,l)),d=c.at(-1),p=d?.itemType===Kl,f=c.filter(m=>!p||m.createdAt!==d.createdAt).map(m=>Wo(m.itemValue,l)).reduce((m,h)=>!m||h>m?h:m,void 0);if(Wo(n,l)>f){if(o?.timeItems&&p){let h=d.createdAt;o.timeItems=o.timeItems.filter(g=>g.createdAt!==h)}let m={itemValue:xh(n,!0,!0),itemType:Kl};return Ea({duplicateValues:!0,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:a,timeItem:m})}else return{error:n1e}}function WHe(t){let{targetData:e,matchUpsMap:i}=t,{targetMatchUps:{loserMatchUp:r}}=e,n=Lr(r?.matchUpStatus),a=!!i?.drawMatchUps.find(s=>s.loserMatchUpId===r?.matchUpId&&Lr(s.matchUpStatus));return a&&r?.matchUpStatus===Si||a&&n}function zHe({drawDefinition:t,matchUpStatus:e,matchUpsMap:i,winningSide:r,dualMatchUp:n,tieFormat:a,structure:s,matchUp:o,event:l,score:u}){let c=Oe(n,void 0,!0);for(let p of c?.tieMatchUps||[])p.matchUpId===o.matchUpId&&(p.winningSide=r,p.score=u,!fr({score:u})&&!e?Object.assign(p,{...lN}):e&&(p.matchUpStatus=e));a=a??yn({matchUp:o,structure:s,drawDefinition:t,event:l})?.tieFormat;let{winningSide:d}=GU({matchUp:c,drawDefinition:t,matchUpsMap:i,structure:s,tieFormat:a,event:l});return{projectedWinningSide:d}}function qHe(t){let{tournamentRecord:e,inContextMatchUp:i,structure:r,drawDefinition:n}=t,a=i.roundNumber,s=i.sides.find(b=>b.sideNumber===i.winningSide),o=i.sides.find(b=>b.sideNumber!==i.winningSide),{drawPosition:l,participantId:u}=s,{drawPosition:c,participantId:d}=o,p="swapWinnerLoser",{matchUps:f}=At(t),m=f.filter(({drawPositions:b,roundNumber:S})=>b?.includes(l)&&S>a);oa({changeWinner:!0})&&console.log({existingWinnerSubsequentMatchUps:m}),m.forEach(b=>{b.drawPositions=b.drawPositions?.map(S=>S===l?c:S)||[],Ut({tournamentId:e?.tournamentId,eventId:t.event?.eventId,context:p,drawDefinition:n,matchUp:b})});let{stage:h,stageSequence:g}=r,I=n.structures.filter(({stage:b,stageSequence:S})=>b===h&&S>g).map(({structureId:b})=>b),{targetLinks:{loserTargetLink:v,winnerTargetLink:w}}=t.targetData,y=[v?.target.structureId,w?.target?.structureId].filter(Boolean);return n.structures.filter(({stage:b,structureId:S})=>b!==h&&y.includes(S)).forEach(({stage:b,stageSequence:S,structureId:U})=>{I.includes(U)||I.push(U),n.structures.filter(({stage:T,stageSequence:P})=>T===b&&P>S).forEach(({structureId:T})=>{I.includes(T)||I.push(T)})}),n.structures.filter(({structureId:b})=>I.includes(b)).forEach(b=>{let{positionAssignments:S}=Kt({structure:b}),U=S?.find(({participantId:P})=>P===u),T=S?.find(({participantId:P})=>P===d);U&&(U.participantId=d),T&&(T.participantId=u)}),So({...t})}function Ef(t){let e="setMatchUpStatus";t.matchUpStatus&&[ai,Si].includes(t.matchUpStatus)&&(t.score=void 0);let{allowChangePropagation:i,disableScoreValidation:r,propagateExitStatus:n,tournamentRecords:a,tournamentRecord:s,disableAutoCalc:o,enableAutoCalc:l,drawDefinition:u,matchUpStatus:c,winningSide:d,matchUpId:p,event:f,score:m}=t;if(!u)return{error:$e};if(c&&[Rl,Da,Ta,_i].includes(c)&&d)return{error:re,winningSide:d,matchUpStatus:c};if(![void 0,...une].includes(c))return q({result:{error:Cv},info:"matchUpStatus does not exist",stack:"setMatchUpStatus"});let h=kr({drawDefinition:u}),{matchUps:g}=Zi({nextMatchUps:!0,tournamentRecord:s,inContext:!0,drawDefinition:u,matchUpsMap:h,event:f}),I=h.drawMatchUps.find(V=>V.matchUpId===p),v=g?.find(V=>V.matchUpId===p);if(!I||!g)return{error:dn};if((I.winningSide||d)&&c==="BYE")return{context:"Cannot have Bye with winningSide",error:lD,matchUpStatus:c};let w=v?.structureId,{structure:y}=tt({drawDefinition:u,structureId:w}),b=Pi(ei)(I.matchUpType),S=v?.drawPositions?.filter(Boolean),U=v?.matchUpTieId,T=Fn({matchUpId:U||p,inContextDrawMatchUps:g,drawDefinition:u});Object.assign(t,{inContextDrawMatchUps:g,inContextMatchUp:v,matchUpTieId:U,matchUpsMap:h,targetData:T,structure:y,matchUp:I});let P=c===_i&&m?.scoreStringSide1===""&&m?.scoreStringSide2===""&&!d;if(WHe(t)&&P)return{error:zxe};let D=Yp(t),E;if(b){if(o)Ft({extension:{name:jm,value:!0},element:I});else if(l){let V=I.winningSide,{winningSide:_,scoreStringSide1:B,scoreStringSide2:G,set:j}=GU({drawDefinition:u,matchUpsMap:h,structure:y,matchUp:I,event:f}),K={scoreStringSide1:B,scoreStringSide2:G,sets:j?[j]:[]};if(E=_!==V,D&&E)return q({stack:"winningSideWithDownstreamDependencies",result:{error:cM},context:{winningSide:d,matchUp:I}});Nn({name:jm,element:I}),Object.assign(t,{winningSide:_,dualWinningSideChange:E,projectedWinningSide:_,score:K})}HU({tournamentId:s?.tournamentId,inContextDualMatchUp:v,eventId:f?.eventId,dualMatchUp:I,drawDefinition:u})}if(b&&c&&[Lh].includes(c))return{info:"Not supported for matchUpType: TEAM",error:re};if(m&&!b&&!r){let V=I.matchUpFormat??y?.matchUpFormat??u?.matchUpFormat??f?.matchUpFormat,_=YV({existingMatchUpStatus:I.matchUpStatus,matchUpFormat:V,matchUpStatus:c,winningSide:d,score:m});if(_.error)return _}let R=Dt({policyTypes:[Kb,ms],tournamentRecord:s,drawDefinition:u,event:f})?.appliedPolicies??{};wt(t.policyDefinitions)&&Object.assign(R,t.policyDefinitions);let C=KHe({assignedDrawPositions:S,propagateExitStatus:n,inContextMatchUp:v,appliedPolicies:R,drawDefinition:u,matchUpStatus:c,structure:y,matchUp:I});if(C?.error)return C;let M=v?.stage===ze&&v.finishingRound===1,N=M&&d,A=M&&I.winningSide&&!d&&(!t.matchUpStatus||t.matchUpStatus&&Dx({matchUpStatus:t.matchUpStatus}))&&(!t.outcome||!fr({outcome:t.outcome})),O=N&&d!==I.winningSide&&I.winningSide;if(Object.assign(t,{qualifierAdvancing:N,qualifierChanging:O,removingQualifier:A,appliedPolicies:R}),U){let{matchUp:V}=fi({matchUpId:U,inContext:!0,drawDefinition:u,matchUpsMap:h,event:f});if(V){let _=yn({matchUp:V,drawDefinition:u,structure:y,event:f})?.tieFormat,{projectedWinningSide:B}=zHe({drawDefinition:u,matchUpStatus:c,dualMatchUp:V,matchUpsMap:h,winningSide:d,tieFormat:_,structure:y,matchUp:I,event:f,score:m}),G=V.winningSide;E=B!==G;let j=V._disableAutoCalc;Object.assign(t,{isCollectionMatchUp:!0,dualWinningSideChange:E,projectedWinningSide:B,autoCalcDisabled:j,matchUpTieId:U,dualMatchUp:V,tieFormat:_})}}let k=MU({matchUpStatus:c});if(!U){if(D&&!d&&(c&&Dx({matchUpStatus:c})||c&&[Si,Wi].includes(c)))return{error:lD,activeDownstream:D,winningSide:d};if(d&&d===I.winningSide&&c&&!k)return{context:"winningSide must include directing matchUpStatus",error:lD,directingMatchUpStatus:k,matchUpStatus:c}}let{schedule:F}=t;if(F){let V=eA({disableNotice:!0,tournamentRecords:a,tournamentRecord:s,drawDefinition:u,matchUpId:p,schedule:F});if(V.error)return V}let x=!b&&!E&&d&&I.winningSide&&I.winningSide!==d;if(i&&x&&I.roundPosition)return qHe(t);let L=d&&!U||t.projectedWinningSide;Ht({activeDownstream:D,matchUpWinner:L,method:e,winningSide:d});let $=!D&&HHe(t)||L&&YHe(t)||(k||t.autoCalcDisabled)&&Eue(t)||{error:wie};return q({result:$,stack:e})}function YHe(t){let{matchUp:e,winningSide:i,matchUpTieId:r,dualWinningSideChange:n}=t;return i===e.winningSide||r&&!n?Eue(t):q({stack:"winningSideWithDownstreamDependencies",result:{error:cM},context:{winningSide:i,matchUp:e}})}function Eue(t){let{tournamentRecord:e,matchUp:i,event:r}=t,n=t.isCollectionMatchUp&&i.winningSide&&!t.winningSide&&!fr({score:t.score}),a=t.isCollectionMatchUp?t.matchUpStatus||n&&_i||t.winningSide&&Oi||Da:t.matchUpStatus||Oi,s=t.removeScore||[Rl,ai].includes(a)&&![Da,Ta].includes(a),o=So({...t,matchUpStatus:a,removeWinningSide:n,removeScore:s});if(o.error)return o;if(t.isCollectionMatchUp){let{matchUpTieId:l,drawDefinition:u,matchUpsMap:c}=t,d=Hc({appliedPolicies:t.appliedPolicies,matchUpId:l,tournamentRecord:e,drawDefinition:u,matchUpsMap:c,event:r});if(d.error)return d;Object.assign(o,{tieMatchUpResult:d})}return o}function KHe({assignedDrawPositions:t,propagateExitStatus:e,inContextMatchUp:i,appliedPolicies:r,drawDefinition:n,matchUpStatus:a,structure:s,matchUp:o}){if(r?.[ms]?.requireParticipantsForScoring===!1)return{...W};let l=i?.sides?.map(d=>d.participantId).filter(Boolean).length,u=o?.sides?[]:Kt({structureId:s?.structureId,drawDefinition:n}).positionAssignments,c=l&&l===2||o.collectionId&&Hn({structure:s})&&l&&l>=1||t?.length===2&&u?.filter(d=>t.includes(d.drawPosition)).every(d=>d.participantId);return a&&[ai,qt,Si].includes(a)&&l===1&&e?{...W}:a&&lne.includes(a)&&!c?q({info:"matchUpStatus requires assigned participants",context:{matchUpStatus:a,requiredParticipants:c},result:{error:Cv}}):{...W}}function Rue({tournamentRecord:t,drawDefinition:e,matchUpId:i,event:r}){if(!e)return{error:$e};let{matchUp:n}=fi({drawDefinition:e,matchUpId:i,event:r});return n?.matchUpType!==La?{error:sa}:Ef({enableAutoCalc:!0,tournamentRecord:t,drawDefinition:e,matchUpId:i,event:r})}function Cue({drawDefinition:t,event:e,matchUpId:i}){if(!t)return{error:$e};if(!i)return{error:Tn};let{matchUp:r}=fi({drawDefinition:t,event:e,matchUpId:i});return r?Nn({name:xM,element:r}):{error:dn}}function XHe({substituteParticipantId:t,existingParticipantId:e,tournamentRecord:i,drawDefinition:r,sideNumber:n,matchUpId:a,event:s}){let o="substituteParticipant";if(!r)return{error:$e};if(!a)return{error:Tn};if(!e||!t)return q({result:{error:dr},stack:o});let{matchUp:l}=fi({drawDefinition:r,matchUpId:a,event:s});if(!l)return{error:dn};if(!l.collectionId)return q({result:{error:sa},stack:o});let u=kr({drawDefinition:r}),{matchUps:c}=Zi({tournamentParticipants:i?.participants,inContext:!0,drawDefinition:r,matchUpsMap:u}),d=c?.find(f=>f.matchUpId===a),p=c?.find(f=>f.matchUpId===d?.matchUpTieId)?.sides?.find(f=>f.participant.individualParticipants.some(({participantId:m})=>m===e));return!p||n&&p.sideNumber!==n?{error:Co}:p.participant?.individualParticipants?.map(yt).filter(f=>f!==e)?.includes(t)?zj({newParticipantId:t,tieMatchUpId:a,existingParticipantId:e,substitution:!0,tournamentRecord:i,drawDefinition:r,event:s}):q({result:{error:Co},stack:o})}function Mue(t){return XHe(t)}function Nue({drawDefinition:t,matchUpId:e,event:i}){if(!t)return{error:$e};let{matchUp:r}=fi({drawDefinition:t,matchUpId:e,event:i});return Ft({extension:{name:jm,value:!0},element:r})}function Aue(t){let e="setMatchUpFormat",i=He(t,[{tournamentRecord:!0},{[qr]:b=>$a({matchUpFormat:b}),[Ba]:QS,matchUpFormat:!0}]);if(i.error)return q({result:i,stack:e});let{tournamentRecord:r,drawDefinition:n,scheduledDates:a,stageSequences:s,matchUpFormat:o,structureId:l,eventType:u,matchUpId:c,eventId:d,stages:p,drawId:f,event:m,force:h}=t;if(a&&!Array.isArray(a))return q({result:{error:re,scheduledDates:a},stack:e});if(u&&!pm([pl,fs],u))return q({result:{error:cu},stack:e});let g=0,I=t.structureIds||l&&[l].filter(Boolean)||[],v=t.eventIds||d&&[d].filter(Boolean)||[],w=t.drawIds||f&&[f].filter(Boolean)||[];if((l||I?.length)&&!n)return q({result:{error:$e},stack:e});if(f&&c&&n){let b=QV({tournamentRecord:r,drawDefinition:n,matchUpFormat:o,structureIds:I,structureId:l,matchUpId:c});if(b.error)return b;g+=1}let y=b=>{let S=[];for(let U of b.structures||[]){if(Array.isArray(p)&&!p.includes(U.stage)||Array.isArray(s)&&!s.includes(U.stageSequence)||I?.length&&!I.includes(U.structureId))continue;I?.length&&U.matchUpFormat!==o&&(U.matchUpFormat=o,S.push(U.structureId),g+=1);let T=((h||a)&&At({matchUpFilters:{matchUpStatuses:[_i]},structure:U}).matchUps)??[],P=(a&&At({matchUpFilters:{matchUpStatuses:[_i]},contextFilters:{scheduledDates:a},afterRecoveryTimes:!1,inContext:!0,structure:U}).matchUps)??[];if(T?.length){let D=P?P.map(vr):T.map(vr);for(let E of T)D.includes(E.matchUpId)&&(E.matchUpFormat=a?.length?o:void 0,Ut({tournamentId:r?.tournamentId,eventId:m?.eventId,context:e,drawDefinition:b,matchUp:E}))}}return!S.length&&b.matchUpFormat!==o&&(b.matchUpFormat=o,g+=1),S};for(let b of r?.events||[])if(!(v?.length&&!v.includes(b.eventId)||u&&u!==b.eventType||u===ar))if(Array.isArray(s)||Array.isArray(p)||I?.length||w?.length)for(let S of b.drawDefinitions||[]){if(Array.isArray(w)&&!w.includes(S.drawId))continue;let U=y(S);ii({structureIds:U,drawDefinition:S})}else b.matchUpFormat!==o&&(b.matchUpFormat=o,g+=1);return g?{...W,modificationsCount:g}:{...W,info:Av}}function eG({inheritance:t=!0,tournamentRecord:e,drawDefinition:i,matchUpId:r,event:n}){if(!i)return{error:$e};let a=fi({drawDefinition:i,matchUpId:r})?.matchUp;if(!a?.tieMatchUps)return{error:sa};let s=fi({inContext:!0,drawDefinition:i,matchUpId:r,event:n})?.matchUp,o=0;return(a?.sides||[]).forEach(l=>{l.lineUp&&delete l.lineUp}),(s?.sides||[]).forEach(l=>{if(o+=1,t===!1){let u=s?.tieFormat,c=l.participantId;u&&c&&Kh({drawDefinition:i,participantId:c,lineUp:[],tieFormat:u})}Ut({tournamentId:e?.tournamentId,context:"resetMatchUpLineUps",eventId:n?.eventId,drawDefinition:i,matchUp:a})}),{...W,modificationsCount:o}}function kue(t){let{matchUpFormat:e,matchUpStatus:i,winningSide:r,score:n,setTBlast:a}=t;if(!n)return{sets:[]};let s=n.sets||[],o=Jl({winnerFirst:!1,matchUpFormat:e,matchUpStatus:i,setTBlast:a,sets:s}),l=Jl({winnerFirst:!1,reversed:!0,matchUpFormat:e,matchUpStatus:i,setTBlast:a,sets:s}),u=Jl({matchUpFormat:e,matchUpStatus:i,winningSide:r,setTBlast:a,sets:s}),c=o===u?l:o;return r&&(o=r===1?u:c,l=r===2?u:c),{score:{sets:s,scoreStringSide1:o,scoreStringSide2:l}}}function JHe({sourceMatchUpStatusCodes:t,propagateExitStatus:e,sourceMatchUpStatus:i,loserParticipantId:r,tournamentRecord:n,drawDefinition:a,loserMatchUp:s,matchUpsMap:o,event:l}){let u="progressExitStatus";Ht({method:u,newline:!0,color:"magenta",keyColors:{loserMatchUpId:"brightcyan",sourceMatchUpStatus:"brightyellow"},loserMatchUpId:s?.matchUpId,loserMatchUpStatus:s?.matchUpStatus,sourceMatchUpStatus:i,sourceMatchUpStatusCodes:JSON.stringify(t),loserParticipantId:r?.slice(0,8),propagateExitStatus:e});let c=Lr(i)&&i!==Sr&&i||ai,d=Zi({inContext:!0,drawDefinition:a,matchUpsMap:o})?.matchUps,p=c,f=d?.find(m=>m.matchUpId===s?.matchUpId);if(Ht({method:u,color:"magenta",carryOverMatchUpStatus:c,updatedLoserMatchUpId:f?.matchUpId,updatedLoserStatus:f?.matchUpStatus,updatedLoserSides:JSON.stringify(f?.sides?.map(m=>({sn:m.sideNumber,pid:m.participantId?.slice(0,8),bye:m.bye}))),updatedLoserDP:JSON.stringify(f?.drawPositions),existingStatusCodes:JSON.stringify(f?.matchUpStatusCodes)}),f?.matchUpId&&p){let m,h=f.matchUpStatusCodes?.map(v=>typeof v=="string"?v:"WO")??[],g=f.sides?.find(v=>v.participantId===r);if(g?.sideNumber){let v=f?.sides?.reduce((w,y)=>y?.participantId?w+1:w,0);if(Ht({method:u,color:"brightyellow",keyColors:{decision:"brightgreen"},loserSideNumber:g.sideNumber,participantsCount:v,statusCodesLength:h.length,existingStatusCodes:JSON.stringify(h),loserMatchUpIsExit:Lr(s.matchUpStatus),loserMatchUpOriginalStatus:s.matchUpStatus}),v===1&&h.length===0)m=g.sideNumber===1?2:1,h[0]=t[0],Ht({method:u,color:"brightgreen",decision:"SINGLE_PARTICIPANT_no_existing_codes",winningSide:m,statusCodes:JSON.stringify(h)});else if(!Lr(s.matchUpStatus))m=g.sideNumber===1?2:1,h[0]=t[0],Ht({method:u,color:"brightgreen",decision:"TWO_PARTICIPANTS_not_exit",winningSide:m,statusCodes:JSON.stringify(h)});else{let w=h[0];h[g.sideNumber-1]=t[0];let y=g.sideNumber===1?2:1;h[y-1]=w,p=Si,m=void 0,Ht({method:u,color:"brightred",decision:"BOTH_EXITS_converting_to_DOUBLE_WALKOVER",loserMatchUpStatus:p,winningSide:m,statusCodes:JSON.stringify(h)})}}else Ht({method:u,color:"brightyellow",decision:"NO_LOSER_PARTICIPANT_SIDE_FOUND",loserParticipantId:r?.slice(0,8),availableSides:JSON.stringify(f.sides?.map(v=>({sn:v.sideNumber,pid:v.participantId?.slice(0,8)})))});Ht({method:u,color:"brightmagenta",keyColors:{finalStatus:"brightgreen",finalWinningSide:"brightyellow"},action:"calling_setMatchUpState",loserMatchUpId:s.matchUpId,finalStatus:p,finalWinningSide:m,finalStatusCodes:JSON.stringify(h)});let I=Ef({matchUpStatus:p,matchUpId:s.matchUpId,matchUpStatusCodes:h,allowChangePropagation:!0,propagateExitStatus:e,tournamentRecord:n,drawDefinition:a,winningSide:m,event:l});return q({result:I,stack:u,context:{progressExitStatus:!0}})}return q({result:{error:aa},stack:u})}function nT(t){let e=He(t,[{[Pl]:!0,[In]:!0}]);if(e.error)return e;let i="setMatchUpStatus",r=ws(t);if(!t.drawDefinition){let b=t.tournamentRecord??(t.tournamentId&&r[t.tournamentId]);t.tournamentRecord||(t.tournamentRecord=b);let S=Wn({eventId:t.eventId,drawId:t.drawId,tournamentRecord:b});if(S.error)return S;S.drawDefinition&&(t.drawDefinition=S.drawDefinition),t.event=S.event}let{disableScoreValidation:n,propagateExitStatus:a,policyDefinitions:s,tournamentRecord:o,disableAutoCalc:l,enableAutoCalc:u,drawDefinition:c,matchUpId:d,schedule:p,event:f,notes:m}=t,h=t.matchUpFormat||t.outcome?.matchUpFormat,{policy:g}=bf({policyType:ms,tournamentRecord:o,event:f}),I=t.allowChangePropagation!==void 0&&t.allowChangePropagation||g?.allowChangePropagation!==void 0&&g.allowChangePropagation||void 0,{outcome:v,setTBlast:w}=t;if(v?.winningSide&&![1,2].includes(v.winningSide))return{error:lM};if(h){let b=QV({tournamentRecord:o,drawDefinition:c,matchUpFormat:h,matchUpId:d,event:f});if(b.error)return b}if(v?.score?.sets&&!v.score.scoreStringSide1){let{score:b}=kue({...v,setTBlast:w});v.score=b,v.score.sets=v.score.sets.filter(S=>S.side1Score||S.side2Score||S.side1TiebreakScore||S.side2TiebreakScore)}let y=Ef({matchUpStatusCodes:v?.matchUpStatusCodes,matchUpStatus:v?.matchUpStatus,winningSide:v?.winningSide,allowChangePropagation:I,disableScoreValidation:n,score:v?.score,propagateExitStatus:a,tournamentRecords:r,policyDefinitions:s,tournamentRecord:o,disableAutoCalc:l,enableAutoCalc:u,drawDefinition:c,matchUpFormat:h,matchUpId:d,schedule:p,event:f,notes:m});if(y.context?.progressExitStatus){let b=!0,S=0;for(;b&&S<10;){b=!1,S+=1;let U=JHe({sourceMatchUpStatusCodes:y.context.sourceMatchUpStatusCodes,sourceMatchUpStatus:y.context.sourceMatchUpStatus,loserParticipantId:y.context.loserParticipantId,propagateExitStatus:t.propagateExitStatus,tournamentRecord:t.tournamentRecord,loserMatchUp:y.context.loserMatchUp,matchUpsMap:y.context.matchUpsMap,drawDefinition:t.drawDefinition,event:t.event});U.context?.loserMatchUp&&(Object.assign(y.context,U.context),b=!0)}}return q({result:y,stack:i})}function Oue(t){if(!t?.outcomes)return{error:Je};if(!Array.isArray(t.outcomes))return{error:Je,info:{outcomes:t.outcomes}};let e=t.tournamentRecords||t.tournamentRecord&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord}||{},i=t.outcomes??[],r=i.reduce((n,a)=>n.includes(a.tournamentId)?n:n.concat(a.tournamentId),[]);for(let n of r){let a=e[n];if(!a)return{error:ve};let s=i.filter(o=>o.tournamentId===n);if(s.length){let o=QHe({outcomes:s,tournamentRecord:a});if(o.error)return o}}return{...W}}function QHe(t){let{tournamentRecords:e,tournamentRecord:i,outcomes:r,policyDefinitions:n}=t,a={};r.forEach(s=>{let{eventId:o}=s;a[o]||(a[o]=[]),a[o].push(s)});for(let s of Object.keys(a)){let{event:o}=Wn({tournamentRecord:i,eventId:s});for(let l of a[s]){let{drawId:u}=l,c=o?.drawDefinitions?.find(d=>d.drawId===u);if(c&&u){let{matchUpFormat:d,matchUpId:p}=l,f=nT({schedule:l?.schedule,tournamentRecords:e,policyDefinitions:n,tournamentRecord:i,drawDefinition:c,matchUpFormat:d,matchUpId:p,outcome:l,drawId:u,event:o});if(f.error)return f}}}return{...W}}function ZHe({drawDefinition:t,matchUpId:e,outcome:i,matchUp:r}){if(!r&&!t)return{error:$e};if(!i)return{error:Je,info:"missing outcome"};if(!r&&!e)return{error:aa};if(!r){let n=fi({drawDefinition:t,matchUpId:e});if(n.error)return n;r=n.matchUp}return typeof i!="object"||!i.score?.scoreStringSide1||!i.score?.scoreStringSide2?{error:re}:Ft({element:r,extension:{name:xM,value:i}})}function xue(t){return ZHe(t)}function tG(t){let e="resetTieFormat",{drawDefinition:i,event:r,uuids:n}=t,a=He(t,[{[hr]:!0,[Pl]:!0}],e);if(a.error)return a;let s=Qv(t,[{[xv]:Au}]);if(s[js])return s;let o=t.tournamentRecord?.tournamentId,{matchUp:l,structure:u}=s?.matchUp??{};if(!l?.tieMatchUps)return q({result:{error:sa},info:"Must be a TEAM matchUp",stack:e});if(!l.tieFormat)return{...W};let c=yn({structure:u,drawDefinition:i,event:r})?.tieFormat;if(!c)return q({result:{error:Br},info:"No inherited tieFormat",stack:e});let d=[],p=[],f=[],m=[];for(let h of c.collectionDefinitions){let{matchUpCount:g,collectionId:I}=h;p.push(I);let v=(l.tieMatchUps||[]).filter(w=>w.collectionId===I);if(v.length>g)v.sort((w,y)=>(w.matchUpStatus===_i?1:0)-(y.matchUpStatus===_i?1:0)),f.push(...v.slice(0,g)),d.push(...v.slice(3).map(vr));else if(f.push(...v),v.length<g){let w=g-v.length,y=VU({collectionDefinition:h,matchUpsLimit:w,matchUp:l,uuids:n});m.push(...y)}}for(let h of l?.tieMatchUps||[])h.collectionId&&!p.includes(h.collectionId)&&d.push(h.matchUpId);return m.length&&(f.push(...m),Dd({eventId:r?.eventId,matchUps:m,drawDefinition:i,tournamentId:o})),d.length&&ku({matchUpIds:d,eventId:r?.eventId,drawDefinition:i,tournamentId:o}),l&&(l.tieMatchUps=f,l.tieFormatId=void 0,l.tieFormat=void 0,Ut({structureId:u?.structureId,eventId:r?.eventId,context:e,drawDefinition:i,tournamentId:o,matchUp:l})),{...W,newMatchUps:m,deletedMatchUpIds:d}}function iG(t){let{tournamentRecord:e,drawDefinition:i,matchUpId:r,event:n}=t,a="resetScorecard";if(!i)return q({result:{error:$e},stack:a});if(!r)return q({result:{error:Tn},stack:a});if(!ni(r))return q({result:{error:re,matchUpId:r},stack:a});let s=kr({drawDefinition:i}),{matchUps:o}=Zi({nextMatchUps:!0,inContext:!0,drawDefinition:i,matchUpsMap:s}),l=s.drawMatchUps.find(h=>h.matchUpId===r),u=o?.find(h=>h.matchUpId===r);if(!l||!o)return{error:dn};if(l.matchUpType!==Ua)return{error:sa};let c=Fn({inContextDrawMatchUps:o,drawDefinition:i,matchUpId:r}),d=u?.structureId,{structure:p}=tt({drawDefinition:i,structureId:d});if(Object.assign(t,{inContextDrawMatchUps:o,inContextMatchUp:u,matchUpsMap:s,targetData:c,structure:p,matchUp:l}),Yp(t))return{error:cM};if(l.tieMatchUps?.length)for(let h of l.tieMatchUps){let g=Ef({matchUpId:h.matchUpId,matchUpTieId:r,winningSide:void 0,removeScore:!0,tournamentRecord:e,drawDefinition:i,event:n});if(g.error)return q({result:g,stack:a})}let f=Dt({tournamentRecord:e,drawDefinition:i,event:n})?.appliedPolicies,m=Hc({event:t.event,removeScore:!0,tournamentRecord:e,appliedPolicies:f,drawDefinition:i,matchUpsMap:s,matchUpId:r});if(m.error)return q({result:m,stack:a});if(t.tiebreakReset&&!m.tieFormatRemoved){let h=yn({drawDefinition:i,structure:p,event:n})?.tieFormat;if(l.tieFormat&&h){let{matchUpCountDifference:g,descendantDifferences:I,ancestorDifferences:v,valueDifference:w}=Rc({descendant:l.tieFormat,ancestor:h});if(I.collectionIds.length===1&&!v.collectionIds.length&&!v.groupsCount&&g===1&&w===1){let y=tG({tournamentRecord:e,drawDefinition:i,matchUpId:r,event:n});if(y.error)return y}}}return{...W}}function Fue(t){let e=He(t,[{[In]:!0,[Bc]:!0},{[PI]:{[cU]:!1,roundNumbers:!1},[Yre]:"At least one must be provided",[qn]:sn}]);if(e.error)return e;let i=Ose(t);if(i.error)return i;let{matchUpIds:r}=i,n=Pi(Ua)(t.event.eventType),{tournamentRecord:a,drawDefinition:s,event:o}=t;for(let l of r){if(n){let c=iG({tiebreakReset:!0,tournamentRecord:a,drawDefinition:s,matchUpId:l,event:o});if(c.error||t.removeAssignments&&eG({inheritance:!1,drawDefinition:s,matchUpId:l}).error)return c}let u=Ef({winningSide:void 0,removeScore:!0,tournamentRecord:a,drawDefinition:s,matchUpId:l,event:o});if(u.error)return u;if(t.removeAssignments){let c=qj({...t,matchUpId:l});if(c.error)return c}}return{...W}}function eWe({tournamentRecord:t,drawDefinition:e,finishingOrder:i}){if(!e)return{error:$e};let r="setOrderOfFinish";if(!Array.isArray(i))return q({info:zp("finishingOrder"),result:{error:re},stack:r});let{completedMatchUps:n,matchUpsMap:a}=jv({inContext:!0,drawDefinition:e}),s=n?.map(vr)??[],o=i.map(vr),{matchUpTypes:l,roundNumbers:u,structureIds:c,matchUpTieIds:d}=(n??[]).filter(({matchUpId:v})=>o.includes(v)).reduce((v,w)=>{let{matchUpTieId:y,matchUpType:b,roundNumber:S,structureId:U}=w;return v.matchUpTypes.includes(b)||v.matchUpTypes.push(b),v.roundNumbers.includes(S)||v.roundNumbers.push(S),v.structureIds.includes(U)||v.structureIds.push(U),v.matchUpTieIds.includes(y)||v.matchUpTieIds.push(y),v},{matchUpTypes:[],roundNumbers:[],structureIds:[],matchUpTieIds:[]});if(l.length>1||d.length>1||u.length>1||c.length>1)return q({info:"matchUpType, structureId and roundNumber must be equivalent",result:{error:re},stack:r});let p,f,m={},h=[],g=[];if(!i.every(({orderOfFinish:v,matchUpId:w})=>(h.push(w),v&&g.push(v),m[w]=v,p=s.includes(w),f=v===void 0||lt(v)&&Math.floor(v)>0,p&&f)))return q({result:{error:p?re:Cv},info:!p&&"matchUps must be completed"||!f&&"orderOfFinish must be integer > 0 or undefined"||void 0,stack:r});let I=n?.filter(v=>v.structureId===c[0]&&v.roundNumber===u[0]&&v.matchUpType===l[0]&&v.matchUpTieId===d[0]&&!h.includes(v.matchUpId));for(let v of I??[]){let{orderOfFinish:w}=v||{};if(w){if(!lt(w))return q({context:{orderOfFinish:w,matchUp:v},result:{error:re},stack:r});g.push(w)}}if(ste(g).length!==g.length||Math.max(...g)>g.length)return q({info:"Values not unique or greater than expected number of values",result:{error:re},stack:r});if(c.length){let v=QM({matchUpFilters:{matchUpIds:o},structureId:c[0],drawDefinition:e,matchUpsMap:a});if(v.error)return q({result:v,stack:r});v.completedMatchUps?.forEach(w=>{w.orderOfFinish=m[w.matchUpId],Ut({tournamentId:t.tournamentId,context:"setOrderOfFinish",drawDefinition:e,matchUp:w})})}return{...W}}function Lue(t){return eWe(t)}function _ue(t){let{tournamentRecord:e,drawDefinition:i,matchUpId:r,lineUps:n,event:a}=t,s="applyLineUps",o=He(t,[{[hr]:!0,[In]:!0,[Pl]:!0},{lineUps:!0,[qn]:sn}],s);if(o.error)return o;let l=e.participants||[],u=fi({tournamentParticipants:l,inContext:!0,drawDefinition:i,matchUpId:r});if(u.error)return u;if(!u.matchUp)return{error:dn};let{matchUp:c,structure:d}=u,{drawPositions:p,matchUpType:f}=c;if(f!==ei)return{error:sa};if(!p?.length)return{error:KS};let m=yn({matchUp:c,drawDefinition:i,structure:d,event:a})?.tieFormat,h={};for(let I of n){if(!Array.isArray(I))return{error:re,lineUp:I};let v={},w=[];for(let T of I){if(typeof T!="object")return{error:re,lineUpAssignment:T};let{participantId:P,collectionAssignments:D=[]}=T;if(!Array.isArray(D))return{error:re,collectionAssignments:D};let E=l.find(C=>C.participantId===P);if(!E)return{error:ji};if(E.participantType!==It)return{error:Mo};let R=c.sides?.find(C=>C.participant?.individualParticipantIds?.includes(P))?.sideNumber;R&&w.push(R);for(let C of D){if(typeof C!="object")return{error:re,collectionAssignment:C};let{collectionId:M,collectionPosition:N}=C,A=m?.collectionDefinitions?.find(F=>F.collectionId===M);if(!A)return{error:re,collectionId:M};let O=`${M}-${N}`;v[O]||(v[O]=[]);let k=v[O].length;if(Pi(zt)(A.matchUpType)&&k||A.matchUpType===Bt&&k>1)return{info:"Excessive collectionPosition assignments",error:re};v[O].push(P)}}let y=Object.values(v);for(let T of y)if(T.length===2){let{participant:P}=ro({tournamentParticipants:l,participantIds:T});if(!P){let D=Il({participant:{participantType:ft,participantRole:Jr,individualParticipantIds:T},pairOverride:!0,tournamentRecord:e});if(D.error)return D}}let b=Sa(w),S=(b[1]||0)>(b[2]||0)&&1||(b[2]||0)>(b[1]||0)&&2||void 0,U=Object.keys(h).map(T=>parseInt(T));S&&!U.includes(S)&&(h[S]=I)}if(!Object.keys(h).length)return{error:mB};if(u=fi({drawDefinition:i,matchUpId:r}),u.error)return u;if(!u.matchUp)return{error:dn};let{matchUp:g}=u;g.sides??=[];for(let I of[1,2]){let v=g.sides.find(y=>y.sideNumber===I),w=h[I];if(w)v?v.lineUp=w:g.sides.push({lineUp:w,sideNumber:I});else continue}return Ut({tournamentId:e?.tournamentId,context:s,drawDefinition:i,matchUp:g}),{...W}}var rG={};dt(rG,{anonymizeTournamentRecord:()=>sce,generate:()=>$ue,generateEventWithDraw:()=>sA,generateOutcome:()=>dG,generateOutcomeFromScoreString:()=>nG,generateParticipants:()=>ay,generateTournamentRecord:()=>nce,modifyTournamentRecord:()=>lce,mutate:()=>ace});var $ue={};dt($ue,{generateEventWithDraw:()=>sA,generateOutcome:()=>dG,generateOutcomeFromScoreString:()=>nG,generateParticipants:()=>ay,generateTournamentRecord:()=>nce});function tWe(t){let e=t.reduce((i,r)=>((r.side1Score!==void 0||r.side2Score!==void 0)&&(i.side1+=r.side1Score??0,i.side2+=r.side2Score??0),i),{side1:0,side2:0});return e.side1>e.side2?1:e.side2>e.side1?2:t.find(i=>i.side1TiebreakScore!==void 0||i.side2TiebreakScore!==void 0)?.winningSide}function iWe(t){let e={side1:0,side2:0};if(t.forEach(i=>{i.winningSide===1?e.side1++:i.winningSide===2&&e.side2++}),e.side1>e.side2)return 1;if(e.side2>e.side1)return 2}function rWe(t,e,i){if(t||!e||!i)return t;let r=qi(e);return PN(r)?tWe(i):iWe(i)}function nWe(t,e,i){let r=JU({scoreString:t,matchUpFormat:e});return{sets:r,scoreStringSide1:Jl({sets:r,matchUpFormat:e,setTBlast:i}),scoreStringSide2:Jl({sets:r,reversed:!0,matchUpFormat:e,setTBlast:i})}}function aWe(t,e,i,r){let n=Jl({sets:t,matchUpFormat:i,setTBlast:r}),a=Jl({sets:t,reversed:!0,matchUpFormat:i,setTBlast:r});if(typeof n!="string")return n;if(typeof a!="string")return a;let s=e===2?a:n,o=e===2?n:a;return{sets:JU({scoreString:s,matchUpFormat:i}),scoreStringSide1:s,scoreStringSide2:o}}function nG(t){let{matchUpFormat:e,matchUpStatus:i,winningSide:r,scoreString:n,setTBlast:a,preserveSideOrder:s=!1}=t;if(!n)return{outcome:{...lN,winningSide:r,matchUpStatus:i}};if(r&&![1,2,void 0].includes(r))return{error:re,winningSide:r};let o=n&&JU({scoreString:n,matchUpFormat:e}),l=n?.trim().startsWith("["),u=rWe(r,e,o),c=qi(e),d=s||l||PN(c)?nWe(n,e,a):aWe(o,u,e,a);return je({outcome:{matchUpStatus:i,winningSide:u,score:d}})}function aG({matchUpScheduleTimes:t,matchUpDependencies:e,allDateMatchUpIds:i,matchUp:r}){let n=(e?.[r.matchUpId]?.matchUpIds||[]).filter(a=>i.includes(a)).filter(a=>!t[a]);return{dependenciesScheduled:!n?.length,remainingDependencies:n}}function aT({individualParticipantProfiles:t,participantId:e}){t[e]||(t[e]={typeChangeTimeAfterRecovery:void 0,timeAfterRecovery:void 0,priorMatchUpType:void 0,potentialRecovery:{},potentialCounted:{},potentialBookings:{},bookings:[],counters:{}})}function sWe({individualParticipantProfiles:t,recoveryValue:e,participantId:i,scheduleTime:r,drawId:n}){t[i].potentialRecovery[n]||(t[i].potentialRecovery[n]=[]),t[i].potentialRecovery[n].push(e),t[i].potentialBookings[n]||(t[i].potentialBookings[n]=[]),t[i].potentialBookings[n].push({timeAfterRecovery:e,scheduleTime:r})}function uw({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,typeChangeRecoveryMinutes:i,averageMatchUpMinutes:r=0,matchUpNotBeforeTimes:n,matchUpDependencies:a,recoveryMinutes:s=0,scheduleTime:o,matchUp:l}){let u=pi(l?.schedule?.endTime),c=u?Qn(u,Ke(s)):Qn(o,Ke(r)+Ke(s)),d=i&&(u?Qn(pi(u),i):Qn(o,Ke(r)+Ke(i))),p=a?.[l.matchUpId]?.participantIds||[],f=(l.roundPosition&&t[l.matchUpId]||[]).flat();p.forEach(m=>{aT({individualParticipantProfiles:e,participantId:m});let h=e[m].priorMatchUpType!==l.matchUpType&&d||c;f.includes(m)?sWe({individualParticipantProfiles:e,drawId:l.drawId,recoveryValue:h,participantId:m,scheduleTime:o}):(e[m].timeAfterRecovery=h,e[m].bookings.push({scheduleTime:o,timeAfterRecovery:h}))}),OI({matchUpPotentialParticipantIds:t,matchUpNotBeforeTimes:n,timeAfterRecovery:c,matchUp:l})}function Bue({matchUpScheduleTimes:t,matchUpDependencies:e,scheduleTime:i,matchUpId:r,details:n}){let a,s=n.minutesMap?.[r]?.recoveryMinutes,o=(n.minutesMap?.[r]?.averageMinutes||0)+(s||0),l=Qn(i,o),u=e?.[r]?.dependentMatchUpIds||[];if(u.length){let c=u.reduce((d,p)=>{let f=t[p];if(!f)return d;let m={scheduleTime:f,matchUpId:p};return f&&!d.matchUpId||Rt(f)<Rt(d.scheduleTime)?m:d},{});c.scheduleTime&&Rt(l)>Rt(c.scheduleTime)&&(a=c)}return{scheduledDependent:a}}function oWe(t){let{sides:e,matchUpType:i}=t||{};return(e||[]).map(r=>i===Bt&&(r?.participant?.individualParticipants||[])||r?.participant&&[r.participant]||[]).flat()}var sT="DO_NOT_SCHEDULE",lWe={DO_NOT_SCHEDULE:sT};function sG({averageMatchUpMinutes:t=90,requestConflicts:e={},potentials:i=!0,personRequests:r,scheduleTime:n,scheduleDate:a,matchUp:s}){let o=oWe(s).map(({person:f})=>f?.personId);if(i){let f=(s?.potentialParticipants||[]).flat().map(({person:m})=>m?.personId);o.push(...f)}let l=o.map(f=>r[f]?.map(m=>({...m,personId:f}))).filter(Boolean).flat().filter(f=>f.requestType===sT&&pu(a,f.date)),u=[],c=s?.matchUpId,d=Ji(pi(n),Ze(a)),p=pi(RB(d,t).toISOString());for(let f of l){let{requestId:m,startTime:h,endTime:g}=f;(n>h&&n<g||p&&p>h&&p<g)&&(u.push({matchUpId:c,request:f,scheduleTime:n}),e[m]?(e[m].scheduleTimes.includes(n)||e[m].scheduleTimes.push(n),e[m].matchUpIds.includes(c)||e[m].matchUpIds.push(c)):e[m]={request:f,scheduleTimes:[n],matchUpIds:[c]})}return{conflicts:u}}function Xx({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,matchUp:i,value:r}){let{matchUpType:n}=i,{individualParticipantIds:a}=VM(i),s=(t[i.matchUpId]||[]).filter(o=>!xn(o,a)).flat();[...a,...s].forEach(o=>{if(aT({individualParticipantProfiles:e,participantId:o}),!e[o].potentialCounted[i.drawId]){let l=e[o].counters;l[n]?l[n]+=r:r>0&&(l[n]=r),l[Hs]?l[Hs]+=r:r>0&&(l[Hs]=r),s.includes(o)&&(e[o].potentialCounted[i.drawId]=!0)}})}function uWe({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,dateScheduledMatchUpIds:i,greatestAverageMinutes:r,dateScheduledMatchUps:n,matchUpNotBeforeTimes:a,matchUpScheduleTimes:s,matchUpDependencies:o,clearScheduleDates:l,scheduleDate:u,minutesMap:c,matchUps:d}){let p=[];i||(n=d?.filter(h=>{let g=h.schedule||{},I=h.matchUpStatus==="BYE";return I&&p.push({tournamentId:h.tournamentId,matchUpId:h.matchUpId}),!I&&eT({schedule:g})&&(!u||h.schedule.scheduledDate===u)}),i=n.map(vr));let f=Array.isArray(l)?l.includes(u):l,m=f?[]:d.filter(({matchUpId:h})=>i.includes(h));for(let h of m){Xx({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,value:1,matchUp:h});let g=h.schedule?.scheduledTime;if(g){s[h.matchUpId]=g;let I=c?.[h.matchUpId]?.recoveryMinutes;uw({individualParticipantProfiles:e,matchUpPotentialParticipantIds:t,matchUpNotBeforeTimes:a,matchUpDependencies:o,averageMatchUpMinutes:r,recoveryMinutes:I,scheduleTime:g,matchUp:h})}}return{dateScheduledMatchUpIds:i,byeScheduledMatchUpDetails:p,dateScheduledMatchUps:n,clearDate:f}}function tA({defaultRecoveryMinutes:t=0,averageMatchUpMinutes:e=90,dateScheduledMatchUps:i,tournamentRecords:r,venueIds:n=[],periodLength:a,scheduleDate:s,matchUps:o}){if(typeof r!="object")return{error:Mi};if(!Ka(o)&&!Array.isArray(i))return{error:Nu};a=a??YN({recoveryMinutes:t,averageMatchUpMinutes:e});let l=Object.assign({},...Object.values(r).flatMap(d=>(d.events??[]).map(p=>{let{scheduleTiming:f}=vU({tournamentRecord:d,event:p});return{[p.eventId]:{event:p,scheduleTiming:f}}}))),u={averageTimes:[{minutes:{default:e}}],recoveryTimes:[{minutes:{default:t}}]};i??=o?.filter(d=>{let p=d.schedule;return eT({schedule:p})&&(!s||d.schedule.scheduledDate===s)});let c=i?.filter(d=>(!n.length||n.includes(d.schedule.venueId))&&d.matchUpStatus!=="BYE");return{bookings:c?.map(({eventId:d,schedule:p,matchUpFormat:f})=>{let{event:m,scheduleTiming:h}=l[d],g=m?.eventType,I={...h,defaultTiming:u,matchUpFormat:f},{averageMinutes:v,recoveryMinutes:w}=qM({timingDetails:I,eventType:g}),{courtId:y,venueId:b}=p,S=pi(p.scheduledTime),U=Qn(S,v);return{recoveryMinutes:w,averageMinutes:v,periodLength:a,startTime:S,courtId:y,endTime:U,venueId:b}}).filter(Boolean),relevantMatchUps:c,dateScheduledMatchUps:i}}function cWe({calculateStartTimeFromCourts:t=!0,remainingScheduleTimes:e,defaultRecoveryMinutes:i,averageMatchUpMinutes:r,clearScheduleDates:n,tournamentRecords:a,tournamentRecord:s,periodLength:o,scheduleDate:l,startTime:u,venueIds:c,matchUps:d,endTime:p}){if(s&&!a&&(a={[s.tournamentId]:s}),typeof a!="object"||!Object.keys(a).length)return{error:Mi};o=o??YN({recoveryMinutes:i,averageMatchUpMinutes:r});let{courts:f,venues:m}=Fu({dates:[l],ignoreDisabled:!0,tournamentRecords:a}),h=f?.filter(b=>!c||c.includes(b.venueId))??[];u=u??xI({courts:h,scheduleDate:l,startTime:!0}),p=p??xI({courts:h,scheduleDate:l,endTime:!0});let{bookings:g,dateScheduledMatchUps:I}=tA({defaultRecoveryMinutes:i,averageMatchUpMinutes:r,tournamentRecords:a,scheduleDate:l,periodLength:o,venueIds:c,matchUps:d}),v={calculateStartTimeFromCourts:t,remainingScheduleTimes:e,averageMatchUpMinutes:r,clearScheduleDates:n,date:l,periodLength:o,startTime:u,bookings:g,endTime:p,courts:h},{scheduleTimes:w}=jj(v),y=c?.length===1&&c[0]||m?.length===1&&m[0].venueId||void 0;return{dateScheduledMatchUpIds:I?.map(Pa("matchUpId")),dateScheduledMatchUps:I,scheduleTimes:w,venueId:y}}function dWe({scheduledRoundsDetails:t,greatestAverageMinutes:e,garmanSinglePass:i}){let r=[],n=[],a,s,o,l;for(let u of t.filter(Boolean))l||(l=u.hash),(u.hash===l||i)&&(n=n.concat(u.matchUpIds)),u.hash,o=e,s=u.recoveryMinutes,a=u.roundPeriodLength;return n.length&&r.push({matchUpIds:n,roundPeriodLength:a,recoveryMinutes:s,averageMinutes:o}),{groupedRounds:r}}function Vue({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,scheduleCompletedMatchUps:i,containedStructureIds:r,matchUpNotBeforeTimes:n,matchUpScheduleTimes:a,matchUpDependencies:s,clearScheduleDates:o,tournamentRecords:l,periodLength:u,scheduleDate:c,useGarman:d,matchUps:p,courts:f,venues:m}){let h={},g=[],I=[],v=[];for(let w of m){let{rounds:y=[],venueId:b}=w,{scheduledRoundsDetails:S,greatestAverageMinutes:U,orderedMatchUpIds:T,minutesMap:P}=QU({scheduleCompletedMatchUps:i,containedStructureIds:r,tournamentRecords:l,periodLength:u,matchUps:p,rounds:y});v.push(...T??[]);let{groupedRounds:D}=dWe({scheduledRoundsDetails:S,greatestAverageMinutes:U,garmanSinglePass:!0}),E,R=[];d&&({scheduleTimes:R,dateScheduledMatchUpIds:E}=cWe({averageMatchUpMinutes:D[0]?.averageMinutes,scheduleDate:Ze(c),venueIds:[w.venueId],clearScheduleDates:o,tournamentRecords:l,periodLength:u,matchUps:p}));let C=uWe({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,dateScheduledMatchUpIds:E,greatestAverageMinutes:U,matchUpNotBeforeTimes:n,matchUpScheduleTimes:a,matchUpDependencies:s,clearScheduleDates:o,scheduleDate:c,minutesMap:P,matchUps:p});({dateScheduledMatchUpIds:E}=C);let M=C,{byeScheduledMatchUpDetails:N,clearDate:A}=C;N?.length&&I.push(...N);let{matchUpsToSchedule:O,matchUpMap:k}=kN({matchUpPotentialParticipantIds:t,scheduleCompletedMatchUps:i,dateScheduledMatchUpIds:E,matchUpNotBeforeTimes:n,matchUpScheduleTimes:a,orderedMatchUpIds:T,clearDate:A,matchUps:p}),F=f.filter(x=>x.venueId===b);h[b]={previousRemainingScheduleTimes:[],courtsCount:F.length,greatestAverageMinutes:U,scheduledRoundsDetails:S,dateScheduledMatchUps:M,matchUpsToSchedule:O,scheduleTimes:R,groupedRounds:D,venueCourts:F,minutesMap:P,matchUpMap:k},o||g.push(...E)}return{allDateScheduledByeMatchUpDetails:I,allDateScheduledMatchUpIds:g,venueScheduledRoundDetails:h,allDateMatchUpIds:v}}function pWe(t,e){let i=Rt(t.scheduleTime),r=Rt(t.timeAfterRecovery),n=Rt(e.scheduleTime),a=Rt(e.timeAfterRecovery),s=i===n||r===a,o=i>n&&i<a,l=n>i&&n<r,u=r>n&&r<a,c=a>i&&a<r;return je({hasOverlap:s||o||u||l||c,startAisContained:o,endAisContained:u,startBisContained:l,endBisContained:c},!0)}function oG({individualParticipantProfiles:t,matchUpNotBeforeTimes:e,matchUpDependencies:i,scheduleTime:r,matchUp:n,details:a}){let s=(i?.[n.matchUpId]?.participantIds||[]).flat(),o=a?.minutesMap?.[n.matchUpId]?.averageMinutes||0,l=a?.minutesMap?.[n.matchUpId]?.recoveryMinutes||0,u=s.every(p=>{aT({individualParticipantProfiles:t,participantId:p});let f=t[p];if(!f.timeAfterRecovery)return!0;let m=pi(n?.schedule?.endTime),h=m?Qn(m,Ke(l)):Qn(r,Ke(o)+Ke(l));return![...Object.keys(f.potentialBookings).filter(g=>g!==n.drawId).map(g=>f.potentialBookings[g]).flat(),...f.bookings].find(g=>pWe({scheduleTime:r,timeAfterRecovery:h},g).hasOverlap)}),c=e[n.matchUpId],d=(c?rU(Ji(c),Ji(r),!1):0)>=0;return{enoughTime:u&&d}}function jue({autoSchedulingAudit:t,tournamentRecords:e}){st({topic:Zu,payload:t});let i=s=>s?Object.values(s).reduce((o,l)=>o+l.length||0,0):0,r=(t?.schedulingProfile||[]).reduce((s,o)=>s+o.venues.reduce((l,u)=>l+u.rounds.length,0),0),n={scheduledDatesCount:t.scheduledDates?.length,noTimeMatchUpIdsCount:i(t?.noTimeMatchUpIds),scheduledMatchUpIdsCount:i(t?.scheduledMatchUpIds),overLimitMatchUpIdsCount:i(t?.overLimitMatchUpIds),requestConflictsCount:i(t?.requestConflicts),profileRoundsCount:r},a={itemType:qx,itemValue:n};for(let s of Object.values(e)){let o=s.tournamentId;IM(Zu)?st({payload:{type:qx,tournamentId:o,detail:n},topic:Zu}):WU({tournamentRecord:s,timeItem:a})}}function lG({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,matchUpDailyLimits:i={},matchUp:r}){let{enteredIndividualParticipantIds:n}=VM(r),{matchUpId:a,matchUpType:s}=r,o=(r.roundPosition&&t[a]||[]).flat(),l=nt(n.concat(...o));return l.forEach(u=>{aT({individualParticipantProfiles:e,participantId:u})}),{participantIdsAtLimit:l.filter(u=>{let c=e[u];if(c)return[s,Hs].find(d=>{let p=c.counters?.[d]||0,f=i[d]||0;return p&&f&&p>=f})}),relevantParticipantIds:l}}function cw({scheduleCompletedMatchUps:t=!1,scheduleByeMatchUps:e=!1,errorOnAnachronism:i=!1,checkChronology:r=!0,matchUpDependencies:n,removePriorValues:a,tournamentRecords:s,tournamentRecord:o,matchUpDetails:l,matchUpIds:u,schedule:c}){if(!o)return{error:ve};if(!l&&(!u||!Array.isArray(u)))return{error:Ch};if(!l&&(!c||typeof c!="object"))return{error:hie};let d,p=[],f=0;if(r&&!n){let g=co({tournamentRecords:s,tournamentRecord:o});n=g.matchUpDependencies,d=g.matchUps}d||(d=Ur({tournamentRecord:o})?.matchUps??[]);let m=d.reduce((g,I)=>{let{matchUpId:v,drawId:w,matchUpStatus:y}=I;return(e||y!=="BYE")&&(t||!Ki.includes(y))&&(g[w]?g[w].push(v):g[w]=[v]),g},{}),h=l?.map(g=>g.matchUpId);for(let g of Object.keys(m)){let{drawDefinition:I}=ep({tournamentRecord:o,drawId:g});if(!I)continue;let v=m[g].filter(y=>u?.includes(y)??h?.includes(y)),w=An({inContext:!1,drawDefinition:I}).matchUps;for(let y of v){let b=l?.find(U=>U.matchUpId===y)?.schedule||c,S=eA({schedule:b,matchUpDependencies:n,errorOnAnachronism:i,removePriorValues:a,inContextMatchUps:d,tournamentRecords:s,tournamentRecord:o,checkChronology:r,drawDefinition:I,drawMatchUps:w,matchUpId:y});if(S?.warnings?.length&&p.push(...S.warnings),S?.success&&(f+=1),S.error)return S}}return p.length?{...W,scheduled:f,warnings:p}:{...W,scheduled:f}}function oT(t){let{scheduleCompletedMatchUps:e=!1,scheduleByeMatchUps:i=!1,errorOnAnachronism:r,matchUpContextIds:n,removePriorValues:a,tournamentRecords:s,checkChronology:o,matchUpDetails:l,schedule:u}=t;if(t.matchUpIds&&!n)return cw(t);let c=He(t,[{[pn]:!0},{[PI]:{matchUpContextIds:!1,matchUpDetails:!1},[Ba]:re,[qn]:sn}]);if(c.error)return c;if((!l||n)&&!u)return{error:Je,info:"schedule is required"};let d=[],p=0,{matchUpDependencies:f}=co({tournamentRecords:s});for(let m of Object.values(s)){let{tournamentId:h}=m,g=n?.filter(v=>v.tournamentId===h).map(vr),I=l?.filter(v=>v?.tournamentId===h);if(g?.length||I?.length){let v=cw({matchUpDetails:I,scheduleCompletedMatchUps:e,scheduleByeMatchUps:i,matchUpDependencies:f,errorOnAnachronism:r,removePriorValues:a,tournamentRecords:s,tournamentRecord:m,checkChronology:o,matchUpIds:g,schedule:u});if(v.warnings?.length&&d.push(...v.warnings),v.scheduled&&(p+=v.scheduled),v.error)return v}}return d.length?{...W,scheduled:p,warnings:d}:{...W,scheduled:p}}function fWe({schedulingProfileModifications:t,checkPotentialRequestConflicts:e,scheduleCompletedMatchUps:i,schedulingProfileIssues:r,dateSchedulingProfiles:n,containedStructureIds:a,matchUpDependencies:s,matchUpDailyLimits:o,clearScheduleDates:l,tournamentRecords:u,schedulingProfile:c,personRequests:d,periodLength:p,matchUps:f,courts:m,dryRun:h}){let g={},I={},v={},w={},y={},b={},S={},U={},T={},P={};for(let R of n){let C=Ze(R?.scheduleDate),M=R?.venues||[],N={},A={},O=(G,j)=>{G.forEach(K=>{let Y=A[K].counters;Y[j]?Y[j]+=1:Y[j]=1,Y[Hs]?Y[Hs]+=1:Y[Hs]=1})};v[C]={},w[C]={},g[C]={},I[C]={},S[C]=[],U[C]=[],T[C]=[],P[C]=[];let k={};f.forEach(G=>{G.schedule?.scheduledDate&&pu(C,Ze(G.schedule.scheduledDate))&&OI({matchUpPotentialParticipantIds:N,matchUpNotBeforeTimes:k,matchUp:G})});let{allDateScheduledByeMatchUpDetails:F,venueScheduledRoundDetails:x,allDateMatchUpIds:L}=Vue({matchUpPotentialParticipantIds:N,individualParticipantProfiles:A,scheduleCompletedMatchUps:i,containedStructureIds:a,matchUpNotBeforeTimes:k,matchUpScheduleTimes:b,matchUpDependencies:s,clearScheduleDates:l,tournamentRecords:u,useGarman:!0,periodLength:p,scheduleDate:C,matchUps:f,courts:m,venues:M}),$=10,V=0,_,B=10;for(;!_;){for(let{venueId:G}of M){let j=0,K=x[G];for(;K.courtsCount&&K.scheduleTimes?.length&&K.matchUpsToSchedule?.length&&j<=K.courtsCount;){let{scheduleTime:Y,attempts:X=0}=K.scheduleTimes.shift(),Z=K.matchUpsToSchedule.find(J=>{let{matchUpId:ae,matchUpType:te}=J,{participantIdsAtLimit:ne,relevantParticipantIds:le}=lG({matchUpPotentialParticipantIds:N,individualParticipantProfiles:A,matchUpDailyLimits:o,matchUp:J});if(ne.length)return U[C].includes(ae)||U[C].push(ae),!1;let{scheduledDependent:de}=Bue({matchUpScheduleTimes:b,matchUpDependencies:s,scheduleTime:Y,matchUpId:ae,details:K});if(de)return!1;let{dependenciesScheduled:pe,remainingDependencies:ge}=aG({matchUpScheduleTimes:b,matchUpDependencies:s,allDateMatchUpIds:L,matchUp:J});if(!pe)return w[C][ae]||(w[C][ae]=[]),w[C][ae].push({scheduleTime:Y,remainingDependencies:ge}),!1;let{enoughTime:Me}=oG({individualParticipantProfiles:A,matchUpNotBeforeTimes:k,matchUpDependencies:s,scheduleTime:Y,details:K,matchUp:J});if(!Me)return v[C][ae]||(v[C][ae]=[]),v[C][ae].push({scheduleTime:Y}),!1;let Pe=K.greatestAverageMinutes,{conflicts:Be}=sG({potentials:e,averageMatchUpMinutes:Pe,requestConflicts:P,personRequests:d,scheduleTime:Y,scheduleDate:C,matchUp:J});if(Be?.length)return y[C]||(y[C]=[]),y[C].push(...Be),!1;O(le,te);let fe=K.minutesMap?.[ae]?.recoveryMinutes;return uw({matchUpPotentialParticipantIds:N,individualParticipantProfiles:A,matchUpNotBeforeTimes:k,averageMatchUpMinutes:Pe,matchUpDependencies:s,recoveryMinutes:fe,scheduleTime:Y,matchUp:J}),b[ae]=Y,!0});K.matchUpsToSchedule=K.matchUpsToSchedule.filter(({matchUpId:J})=>J!==Z?.matchUpId),Z?j+=1:(I[C][G]||(I[C][G]=[]),I[C][G].push({scheduleTime:Y,attempts:X+1}))}K.matchUpsToSchedule?.length&&(I[C][G]=I[C][G]?.filter(Y=>{let X=Y.attempts<$;return X&&K.scheduleTimes.push(Y),!X})),(!K.scheduleTimes?.length||!K.matchUpsToSchedule?.length)&&(K.complete=!0)}V+=1,_=M.every(({venueId:G})=>x[G].complete)||V===B}for(let{venueId:G}of M){let j=x[G].matchUpMap;Object.keys(j).forEach(K=>{let Y=u[K];Y&&Object.keys(j[K]).forEach(X=>{let{drawDefinition:Z}=ep({tournamentRecord:Y,drawId:X});Z&&j[K][X].forEach(({matchUpId:J})=>{let ae=b[J];if(ae){let te=ae.split(":").map(as).join(":"),ne=`${Ze(C)}T${te}`;h?S[C].push(J):(tp({drawDefinition:Z,scheduledTime:ne,matchUpId:J}).success&&S[C].push(J),G&&ny({tournamentRecord:Y,drawDefinition:Z,matchUpId:J,venueId:G}))}})})}),T[C]=x[G].matchUpsToSchedule.map(vr),g[C][G]=x[G].scheduleTimes.sort((K,Y)=>Rt(K.scheduleTime)-Rt(Y.scheduleTime))}!h&&F?.length&&oT({matchUpDetails:F,scheduleByeMatchUps:!0,removePriorValues:!0,tournamentRecords:u,schedule:{scheduledDate:"",scheduledTime:"",courtOrder:"",courtId:"",venueId:""}});for(let G of R.venues)for(let j of G.rounds){let K=(j.matchUps?.map(({matchUpId:X})=>X)||[]).filter(X=>S[C].includes(X));j.canScheduledMatchUpIds=K;let Y=Math.round(K.length/j.matchUpsCount*1e4)/100;(Y===1/0||isNaN(Y))&&(Y=0),j.possibleToSchedulePct=Y,j.matchUpsCount===K.length&&(j.possibleToSchedule=!0)}}let D=n.map(({scheduleDate:R})=>R),E={timeStamp:Date.now(),overLimitMatchUpIds:U,scheduledMatchUpIds:S,schedulingProfile:c,noTimeMatchUpIds:T,requestConflicts:P,scheduledDates:D};return jue({tournamentRecords:u,autoSchedulingAudit:E}),{...W,schedulingProfileModifications:t,schedulingProfileIssues:r,scheduleTimesRemaining:g,dateSchedulingProfiles:n,skippedScheduleTimes:I,recoveryTimeDeferredMatchUpIds:v,dependencyDeferredMatchUpIds:w,matchUpScheduleTimes:b,overLimitMatchUpIds:U,scheduledMatchUpIds:S,noTimeMatchUpIds:T,requestConflicts:P,scheduledDates:D}}function Gq({averageMinutes:t,startTime:e,endTime:i,court:r,date:n}){if(!Array.isArray(r.dateAvailability))return{error:Je,stack:"getEarliestCourtTime"};let a=xI({scheduleDate:n,courts:[r],startTime:!0}),s=xI({scheduleDate:n,courts:[r],endTime:!0});e=e||a,i=i||s;let o=Md({court:r,date:n}),{timeSlots:l}=iy({courtDate:o}),u=Ji(e),c=Ji(i);return{earliestCourtTime:l?.reduce((d,p)=>{let f=Ji(p.startTime),m=Ji(p.endTime);if(f>c||m<u)return d;let h=u>f?u:f;if(rU(h,m)>=t){let g=pi(h.toISOString());g&&(!d||g<d)&&(d=g)}return d},void 0),courtStartTime:a,courtEndTime:s}}function mWe({schedulingProfileModifications:t,checkPotentialRequestConflicts:e,scheduleCompletedMatchUps:i,schedulingProfileIssues:r,dateSchedulingProfiles:n,containedStructureIds:a,matchUpDependencies:s,matchUpDailyLimits:o,clearScheduleDates:l,tournamentRecords:u,periodLength:c=30,schedulingProfile:d,personRequests:p,matchUps:f=[],courts:m,dryRun:h}){let g={},I={},v={},w={},y={},b={},S={},U={},T={};for(let E of n??[]){let R=Ze(E?.scheduleDate),C=E?.venues||[],M={},N={},A=(Z,J)=>{Z.forEach(ae=>{let te=N[ae].counters;te[J]?te[J]+=1:te[J]=1,te[Hs]?te[Hs]+=1:te[Hs]=1})};g[R]={},I[R]={},b[R]=[],S[R]=[],U[R]=[],T[R]=[];let O={};f?.forEach(Z=>{Z.schedule?.scheduledDate&&pu(R,Ze(Z.schedule.scheduledDate))&&OI({matchUpPotentialParticipantIds:M,matchUpNotBeforeTimes:O,matchUp:Z})});let{allDateScheduledByeMatchUpDetails:k,allDateScheduledMatchUpIds:F,venueScheduledRoundDetails:x,allDateMatchUpIds:L}=Vue({matchUpPotentialParticipantIds:M,individualParticipantProfiles:N,scheduleCompletedMatchUps:i,containedStructureIds:a,matchUpNotBeforeTimes:O,matchUpScheduleTimes:y,matchUpDependencies:s,clearScheduleDates:l,tournamentRecords:u,periodLength:c,scheduleDate:R,matchUps:f,courts:m,venues:C}),$=f?.filter(({matchUpId:Z})=>F.includes(Z)),{bookings:V}=tA({dateScheduledMatchUps:$,tournamentRecords:u,scheduleDate:R,periodLength:c}),{virtualCourts:_}=qN({scheduleDate:R,periodLength:c,bookings:V,courts:m}),B=_?.reduce((Z,J)=>{let{earliestCourtTime:ae,courtEndTime:te}=Gq({date:R,averageMinutes:0,court:J});return(!Z.startTime||Ji(ae)<Ji(Z.startTime))&&(Z.startTime=ae),(!Z.endTime||Ji(te)>Ji(Z.endTime))&&(Z.endTime=te),Z},{}),G=B.startTime,j=({courtId:Z,booking:J})=>_?.find(ae=>ae.courtId===Z)?.dateAvailability[0].bookings.push(J),K=10,Y=0,X;for(;!X;){for(let{venueId:Z}of C){let J=x[Z],ae=J.matchUpsToSchedule.length,te=[],ne=[],le,de=0;for(;!le;){for(let pe of J.matchUpsToSchedule){if(ne.length===J.courtsCount||te.length===J.courtsCount){le=!0;break}let{matchUpId:ge,matchUpType:Me}=pe,{participantIdsAtLimit:Pe,relevantParticipantIds:Be}=lG({matchUpPotentialParticipantIds:M,individualParticipantProfiles:N,matchUpDailyLimits:o,matchUp:pe});if(Pe.length){S[R].includes(ge)||S[R].push(ge);continue}let{dependenciesScheduled:fe,remainingDependencies:Te}=aG({matchUpScheduleTimes:y,matchUpDependencies:s,allDateMatchUpIds:L,matchUp:pe});if(!fe){I[R][ge]||(I[R][ge]=[]),I[R][ge].push({remainingDependencies:Te});continue}let ce=[],ye=_?.reduce((be,Fe)=>{if(ne.includes(Fe.courtId))return be;let{earliestCourtTime:we}=Gq({averageMinutes:J.greatestAverageMinutes,startTime:G,date:R,court:Fe});if(be.scheduleTime&&Rt(we)>=Rt(be.scheduleTime))return be;let{scheduledDependent:Ne}=Bue({matchUpScheduleTimes:y,matchUpDependencies:s,scheduleTime:we,matchUpId:ge,details:J});if(Ne)return be;let{enoughTime:me}=oG({individualParticipantProfiles:N,matchUpNotBeforeTimes:O,matchUpDependencies:s,scheduleTime:we,details:J,matchUp:pe});if(!me)return g[R][ge]||(g[R][ge]=[]),g[R][ge].includes(we)||g[R][ge].push(we),be;let Ee=J.minutesMap?.[ge]?.averageMinutes||J.greatestAverageMinutes,{conflicts:Le}=sG({potentials:e,averageMatchUpMinutes:Ee,requestConflicts:T,personRequests:p,scheduleTime:we,scheduleDate:R,matchUp:pe});if(Le?.length)return ce.push(...Le),!1;A(Be,Me);let Q=J.minutesMap?.[ge]?.recoveryMinutes;return uw({matchUpPotentialParticipantIds:M,individualParticipantProfiles:N,matchUpNotBeforeTimes:O,averageMatchUpMinutes:Ee,matchUpDependencies:s,recoveryMinutes:Q,scheduleTime:we,matchUp:pe}),(!be.scheduleTime||Rt(we)<Rt(be.scheduleTime))&&(be.averageMatchUpMinutes=Ee,be.recoveryMinutes=Q,be.scheduleTime=we,be.courtName=Fe.courtName,be.courtId=Fe.courtId),be},{});if(ye.scheduleTime){let{averageMatchUpMinutes:be,recoveryMinutes:Fe,scheduleTime:we,courtId:Ne}=ye;y[ge]=we,w[ge]=Ne,te.push(ge),ne.push(Ne);let me=we,Ee=Qn(me,be);j({courtId:Ne,booking:{averageMatchUpMinutes:be,recoveryMinutes:Fe,periodLength:c,matchUpId:ge,startTime:me,courtId:Ne,endTime:Ee,venueId:Z}}),J.matchUpsToSchedule=J.matchUpsToSchedule.filter(Le=>Le.matchUpId!==ge)}else ce?.length&&(v[R]||(v[R]=[]),v[R].push(...ce))}(ne.length===J.courtsCount||te.length===J.courtsCount||!J.matchUpsToSchedule.length)&&(le=!0),J.matchUpsToSchedule.length&&te<J.courtsCount&&(Ji(G)<Ji(B.endTime)?G=Qn(G,c):(le=!0,J.complete=!0)),de+=1,!le&&de>=ae&&(le=!0)}J.matchUpsToSchedule?.length||(J.complete=!0)}Y+=1,X=C.every(({venueId:Z})=>x[Z].complete)||Y===K}for(let{venueId:Z}of C){let J=x[Z].matchUpMap;Object.keys(J).forEach(ae=>{let te=u[ae];te&&Object.keys(J[ae]).forEach(ne=>{let{drawDefinition:le}=ep({tournamentRecord:te,drawId:ne});le&&J[ae][ne].forEach(({matchUpId:de})=>{let pe=y[de],ge=w[de];if(pe){let Me=pe.split(":").map(as).join(":"),Pe=`${Ze(R)}T${Me}`;h||(tp({drawDefinition:le,scheduledTime:Pe,matchUpId:de}),tg({courtDayDate:R,tournamentRecords:u,tournamentRecord:te,drawDefinition:le,matchUpId:de,courtId:ge})),b[R].push(de)}})})}),U[R]=x[Z].matchUpsToSchedule.map(vr)}!h&&k?.length&&oT({matchUpDetails:k,scheduleByeMatchUps:!0,removePriorValues:!0,tournamentRecords:u,schedule:{scheduledDate:"",scheduledTime:"",courtOrder:"",courtId:"",venueId:""}});for(let Z of E.venues)for(let J of Z.rounds){let ae=(J.matchUps??[]).map(({matchUpId:ne})=>ne)?.filter(ne=>b[R].includes(ne));J.canScheduledMatchUpIds=ae;let te=Math.round((ae?.length||0)/J.matchUpsCount*1e4)/100;(te===1/0||isNaN(te))&&(te=void 0),J.possibleToSchedulePct=te,J.matchUpsCount===ae?.length&&(J.possibleToSchedule=!0)}}let P=(n??[]).map(({scheduleDate:E})=>E),D={timeStamp:Date.now(),overLimitMatchUpIds:S,scheduledMatchUpIds:b,schedulingProfile:d,noTimeMatchUpIds:U,requestConflicts:T,scheduledDates:P};return jue({tournamentRecords:u,autoSchedulingAudit:D}),{...W,schedulingProfileModifications:t,schedulingProfileIssues:r,dateSchedulingProfiles:n,recoveryTimeDeferredMatchUpIds:g,dependencyDeferredMatchUpIds:I,matchUpScheduleTimes:y,overLimitMatchUpIds:S,scheduledMatchUpIds:b,noTimeMatchUpIds:U,requestConflicts:T,scheduledDates:P}}function iA(t){let{scheduleAttributes:e=["scheduledDate","scheduledTime","courtOrder"],ignoreMatchUpStatuses:i=Ki,scheduledDates:r,venueIds:n}=t,a=ws(t),s=wt(a)?Object.values(a).map(({tournamentId:l})=>l).filter(Boolean):[];if(!s?.length)return{error:Mi};let o=0;for(let l of s){let u=a[l],c=hWe({ignoreMatchUpStatuses:i,scheduleAttributes:e,tournamentRecord:u,scheduledDates:r,venueIds:n});if(c.error)return c;o+=c.clearedScheduleCount??0}return{...W,clearedScheduleCount:o}}function hWe({scheduleAttributes:t=["scheduledDate","scheduledTime","courtOrder"],ignoreMatchUpStatuses:e=Ki,tournamentRecord:i,scheduledDates:r,venueIds:n=[]}){if(typeof i!="object")return{error:ve};if(!Array.isArray(e)||!Array.isArray(n))return{error:re};n.length&&t.push("venueId");let a=Ur({matchUpFilters:{scheduledDates:r},tournamentRecord:i}).matchUps??[],s={};a.forEach(({matchUpStatus:u,schedule:c,drawId:d,matchUpId:p})=>{(!u||!e.includes(u))&&eT({schedule:c,scheduleAttributes:t})&&(!n?.length||n.includes(c.venueId))&&(s[d]||(s[d]=[]),s[d].push(p))});let o=i.tournamentId,l=0;for(let u in s){let{event:c,drawDefinition:d}=Wn({tournamentRecord:i,drawId:u}),p=An({drawDefinition:d,matchUpFilters:{matchUpIds:s[u]}}).matchUps??[];for(let f of p){let m=!1;f.timeItems=(f.timeItems??[]).filter(h=>{let g=h?.itemType&&![wu,Ed,Bh,WM,Vh,jh].includes(h?.itemType);return g||(m=!0),g}),m&&(Ut({context:"clear schedules",eventId:c?.eventId,drawDefinition:d,tournamentId:o,matchUp:f}),l+=1)}}return{...W,clearedScheduleCount:l}}function rA(t){let{checkPotentialRequestConflicts:e=!0,scheduleCompletedMatchUps:i,clearScheduleDates:r,scheduleDates:n=[],tournamentRecords:a,periodLength:s,useGarman:o,dryRun:l,pro:u}=t,c=He(t,[{[pn]:!0},{[qr]:P=>!P||Array.isArray(P)&&P.every(Mn),[jre]:!1,[qn]:sn}]);if(c.error)return c;let d=Wc({tournamentRecords:a});if(d.error)return d;if(!d.schedulingProfile.length)return{...W};let{modifications:p,issues:f=[],schedulingProfile:m=[]}=d,h=Object.assign({},...Object.values(a).map(P=>Bv({tournamentRecord:P}).containedStructures)),g=new Set(n.map(P=>{if(Mn(P))return Ze(P)}).filter(Boolean)),I=m.map(P=>P.scheduleDate).map(P=>Mn(P)&&Ze(P)).filter(P=>P&&(!n.length||g.has(P)));if(!I.length)return{error:Gte};if(r&&!l){let P=Array.isArray(r)?r:[];iA({tournamentRecords:a,scheduledDates:P})}let v=Fu({ignoreDisabled:!1,tournamentRecords:a}).courts,{matchUps:w}=No({matchUpFilters:{matchUpTypes:[zt,Bt]},afterRecoveryTimes:!0,nextMatchUps:!0,tournamentRecords:a}),{matchUpDependencies:y}=co({includeParticipantDependencies:!0,tournamentRecords:a,matchUps:w}),{matchUpDailyLimits:b}=jN({tournamentRecords:a}),{personRequests:S}=Pf({requestType:sT,tournamentRecords:a}),U=m.filter(P=>{let D=Ze(P?.scheduleDate);return I.includes(D)}).sort((P,D)=>new Date(P.scheduleDate).getTime()-new Date(D.scheduleDate).getTime()),T={schedulingProfileModifications:p,checkPotentialRequestConflicts:e,scheduleCompletedMatchUps:i,schedulingProfileIssues:f,dateSchedulingProfiles:U,containedStructureIds:h,matchUpDependencies:y,matchUpDailyLimits:b,clearScheduleDates:r,tournamentRecords:a,schedulingProfile:m,personRequests:S,periodLength:s,matchUps:w,dryRun:l,courts:v};return u?mWe(T):fWe(T)}function nA(t){if(!t||typeof t!="string")return!1;try{return Intl.DateTimeFormat(void 0,{timeZone:t}),!0}catch{return!1}}function Jx(t,e){let i=e??new Date,r=new Intl.DateTimeFormat("en-US",{timeZone:t,timeZoneName:"longOffset"}).formatToParts(i).find(l=>l.type==="timeZoneName")?.value??"";if(r==="GMT")return 0;let n=r.match(/GMT([+-])(\d{2}):(\d{2})/);if(!n)return 0;let a=n[1]==="+"?1:-1,s=Number.parseInt(n[2],10),o=Number.parseInt(n[3],10);return a*(s*60+o)}function Gue(t,e,i){if(!nA(i))return{error:oM};let[r,n]=e.split(":").map(Number),[a,s,o]=t.split("-").map(Number),l=new Date(Date.UTC(a,s-1,o,r,n,0,0)),u=Jx(i,l),c=l.getTime()-u*60*1e3,d=new Date(c),p=Jx(i,d);if(p!==u){let f=l.getTime()-p*60*1e3;return new Date(f).toISOString()}return d.toISOString()}function gWe(t,e){if(!nA(e))return{error:oM};let i=new Date(t),r=new Intl.DateTimeFormat("en-CA",{timeZone:e,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!1}).formatToParts(i),n=o=>r.find(l=>l.type===o)?.value??"",a=`${n("year")}-${n("month")}-${n("day")}`,s=`${n("hour")==="24"?"00":n("hour")}:${n("minute")}`;return{date:a,time:s}}function IWe(t,e,i){let r=Gue(t,e,i);return typeof r!="string"||rd(r)?r:{error:oM}}var vWe={isValidIANATimeZone:nA,getTimeZoneOffsetMinutes:Jx,wallClockToUTC:Gue,utcToWallClock:gWe,toEmbargoUTC:IWe};function aA(t){let{tournamentRecord:e,tournamentRecords:i,activeTournamentId:r,...n}=t||{};return n.tournamentId||(n.tournamentId=Ct()),n.startDate&&!vc(n.startDate)&&!MP.test(n.startDate)?{error:or}:n.endDate&&!vc(n.endDate)&&!MP.test(n.endDate)?{error:or}:n.localTimeZone&&!nA(n.localTimeZone)?{error:oM}:(n.extensions&&(n.extensions=n.extensions.filter(ml)),{...n})}function uG({addParticipants:t=!0,participantAttribute:e,tournamentRecord:i,personAttribute:r,teamNames:n,accessor:a,uuids:s}){if(!i)return{error:ve};let o={},l=(i.participants??[]).filter(({participantType:m,participantRole:h})=>m===It&&h===Jr),u=0;for(let m of l){let h=a&&yp({element:m,accessor:a})?.value||r&&m.person?.[r]||e&&m[e];if(h){if(!Object.keys(o).includes(h)){o[h]={participantName:n?.[u]??h,participantId:s?.pop()??Ct(),individualParticipantIds:[],participantRole:Jr,participantType:_t};let g={value:r??e,name:Ix};Ft({element:o[h],extension:g}),u+=1}o[h].individualParticipantIds.push(m.participantId)}}let c=Object.keys(o),d=(i.participants??[]).map(m=>{if(m.participantType!==_t||m.participantRole!==Jr)return;let{extension:h}=ht({name:Ix,element:m}),g=h?.value;if(c.includes(g))return m.participantId}).filter(Boolean),p=0,f=[];return Object.keys(o).forEach(m=>{let h=o[m],{participantId:g}=h;d.includes(g)||(i.participants||(i.participants=[]),t&&i.participants.push(h),f.push(h),p++)}),t&&p?(st({payload:{tournamentId:i.tournamentId,participants:f},topic:Td}),{...W,participantsAdded:p}):f.length?{...W,newParticipants:f}:{error:e1e}}var yWe=[{AA:"Annexia"},{BA:"Bacteria"},{BO:"Borduria"},{BM:"Bensalem"},{BS:"Basenji"},{BI:"Balnibarbi"},{BV:"Bartovia"},{BZ:"Berzerkistan"},{CA:"Caldonia"},{CC:"Concordia"},{CH:"Chula"},{DA:"Deltora"},{DW:"Discworld"},{EA:"Eastasia"},{EP:"Ecotopia"},{ER:"Erewhon"},{FA:"Freedonia"},{FN:"Florin"},{FG:"Fogg"},{FK:"Fourecks"},{GA:"Genovia"},{GL:"Gilead"},{GD:"Gilead"},{GL:"Gondal"},{GO:"Gondor"},{GR:"Gruzinia"},{GT:"Goritania"},{GU:"Guilder"},{HA:"Heldscalla"},{HO:"Hidalgo"},{IL:"Illyria"},{KA:"Kinakuta"},{KG:"Kangan"},{KN:"Kreplachistan"},{KS:"Kallipolis"},{LH:"Lugash"},{LI:"Listenbourg"},{LT:"Lilliput"},{LU:"Luggnagg"},{LV:"Lichtenslava"},{MR:"Moher"},{NA:"Narnia"},{NV:"Novaria"},{OA:"Oceania"},{OS:"Orsinia"},{OV:"Octavia"},{PA:"Palombia"},{PG:"Penguina"},{QA:"Qasha"},{PM:"Panem"},{SA:"Solymbria"},{SD:"Syldavia"},{SG:"San Glucose"},{SL:"San Lorenzo"},{SR:"Sontar"},{SY:"Sylvania"},{TF:"Tralfamadore"},{TH:"Themyscira"},{UA:"Utopia"},{VA:"Vespugia"},{WA:"Wakanda"},{WX:"Wessex"},{ZA:"Zamunda"},{ZK:"Zubrowka"}],bWe=["Amber","Ansul","Atlantis","Braavos","Busytown","Castle Rock","Centralia","Coober Pedy","Chefchaouen","Chronopolis","Damanhur","Diaspar","Dictionopolis","Diomira","El Dorado","Elista","Ephesus","Gotham","Hadleyburg","Hallstatt","Hierusalem","Ilium","Inverness","Kowloon","Laputa","Longyearbyen","Lys","Matmata","Maycomb","Metropolis","Miyake-jima","Monowi","Nagoro","Navarre","New New York","Nimbin","Pemberley","Pseudopolis","Rivendell","Roswell","Shangri-La","Springfield","Supilinn","Thneedville","Trantor","Wobegon","Yonwood","Xanadu","Xylar","Zion"];function Hue({count:t=1,participantsCount:e=32}={}){let i=Cn(bWe),r=i.slice(0,t);return{cities:Ce(0,e).map(n=>n<Math.min(t,i.length)?r[n]:Ns(r))}}function Wue({count:t=1,participantsCount:e=32}={}){let i=Cn(yWe),r=i.slice(0,t).map(n=>Object.keys(n)).flat();return{states:Ce(0,e).map(n=>n<Math.min(t,i.length)?r[n]:Ns(r))}}function zue({count:t=1,participantsCount:e=32}={}){let i=Ce(0,t).map(()=>Ce(0,5).map(()=>is(0,9)).join(""));return{postalCodes:Ce(0,e).map(r=>r<t?i[r]:Ns(i))}}function aE({idPrefix:t,participantType:e,index:i,uuids:r}){let n=ni(e)?e[0]:"X";return t?`${t}-${n}-${i}`:r?.pop()||Ct()}function que(t){let{cities:e,states:i,postalCodes:r,nationalityCode:n,participantIndex:a}=t;return{postalCode:r?.[a],state:i?.[a],city:e?.[a],countryCode:n}}var wWe={lastNames:["Abbey","Ahern","Ampleforth","Ananiadis","Andelic","Assange","Atreides","Austen","Bach","Banks","Barrington","Batty","Bauers","Beals","Beer","Bennett","Berry","Bonaparte","Brewer","Brockovich","Bukowski","Cassidy","Catton","Calvino","Carlin","Carson","Chip","Constant","Crane","Crowne","Cummings","Curie","Dallas","Diamond","Deckard","Drazic","Dunbar","Earhart","Eisenstein","Eldritch","Elliot","Ellul","Escher","Eyre","Faulkner","Fulcher","Fukuoka","Godel","Goldstein","Greer","Hedges","Herbert","Holmgren","Humperdinck","Huxley","Illich","Jeffers","Jensen","Jevons","Johnson","Johnstone","Jovovich","Kingsnorth","Langer","Fernwright","Fuller","Le Guin","Lem","Lovelace","Mander","McLuhan","Midgely","Mond","Montoya","Moore","Murry","Nagle","Nearing","Ogden","Ophuls","Parks","Paz","Peet","Perfect","Pendejo","Pevensie","Postman","Ripley","Rodda","Rumfoord","Runciter","Rugen","Sale","Schumacher","Shaftoe","Shelley","Shepard","Smith","Stratton","Stewart","Swift","Tillich","Turing","Tyrell","Twain","Yeats","Veblen","Yates","Vonnegut","Waterhouse","Watson","Wolin","Wirt","Waschuk","Wormwood","Zecic"],firstFemale:["Ada","Amelia","Amelie","America","Anne","Antonia","Aravis","Astrid","Beatrice","Brienne","Buttercup","Caitlin","Cimorene","Cordelia","Desdemona","Ellen","Elizabeth","Emily","Emmie","Erin","Eva","Evelyn","Heather","Helen","Hermia","Hypatia","Imogen","Jane","Jasmine","Juliana","Juliet","Katniss","Leeloo","Lenina","Lilith","Linda","Lizzie","Louise","Lucy","Marie","Mary","Martha","Matilda","Milla","Miranda","Meg","Melba","Nicole","Ola","Portia","Pris","Rachael","Rachel","Rebecca","River","Rosa","Rosalind","Scout","Sharn","Susanne","Titania","Uhura","Ursula","Valentina","Viola","Virginia","Xena","Zoe"],firstMale:["Alan","Aldous","August","Axel","Barda","Barry","Bill","Bruce","Charles","Chris","Constantine","Darwin","David","Derrick","Edward","Emmanuel","Ernst","Estlin","Fezzik","Filby","Frank","Frito","George","Glen","Helmholtz","Inigo","Italo","Ivan","Jacques","James","Jared","Jerry","Joe","Johann","Julian","John Michael","Jonathan","Korben","Kirkpatrick","Kurt","Lief","Malachi","Mark","Marhsall","Masanobu","Maurits","Michael","Miro","Mustapha","Neil","Nikola","Octavio","Palmer","Paul","Pierre","Robinson","Rick","Rincewind","Roy","Shannon","Sheldon","Stafford","Stanislaw","Stanley","Syme","Thorstein","Thomas","Tyrone","Vizzini","Walton","Walker","Warren","Wendell","Westley","William","Winston","Zoran"]};function hk(t){let{count:e=100,sex:i}=t||{};if(!e||i&&!cl(i))return{personData:[],error:re};let r=Math.ceil(e*1.3),{lastNames:n,firstFemale:a,firstMale:s}=wWe,o=ud.map(({iso:h})=>h).filter(Boolean),l=Math.ceil(r/n.length),u=Math.ceil(r/a.length),c=Math.ceil(r/s.length),d=Ce(0,l).flatMap(()=>{let h=Oe(n,!1,!0);return Ce(0,n.length).map(()=>ha(h))}),p=Ce(0,u).flatMap(()=>{let h=Oe(a,!1,!0);return Ce(0,a.length).map(()=>ha(h))}),f=Ce(0,c).flatMap(()=>{let h=Oe(s,!1,!0);return Ce(0,s.length).map(()=>ha(h))}),m={};for(let h=0;h<r;h++){let g=d.pop(),I=i||Ns([tr,zr]),v=I===tr?f.pop():p.pop(),w=Ns(o);m[`${v}${g}`]={nationalityCode:w,sex:I,firstName:v,lastName:g}}return{personData:Object.values(m).slice(0,e)}}function Yue(t){let e=t?.count||1,{personExtensions:i,consideredDate:r,isMock:n=!0,gendersCount:a,personData:s,category:o,sex:l}=t||{};if(Number.isNaN(Number(e)))return{error:re};let u=a?.[tr]||Yf(l)&&e||0,c=a?.[zr]||up(l)&&e||0;e=Math.max(e,u+c);let d=e-(u+c),p=u&&hk({count:u,sex:tr}).personData||[],f=c&&hk({count:c,sex:zr}).personData||[],m=[...p,...f,...d&&hk({count:d}).personData||[]],h=m.filter(T=>!l||u&&c||T.sex===l),g=[];if(Array.isArray(s)){let T=s.filter(P=>typeof P.firstName!="string"||typeof P.lastName!="string"||P.sex&&![tr,zr].includes(P.sex)||P.nationalityCode&&(typeof P.nationalityCode!="string"||P.nationalityCode.length>3||!ud.some(({iso:D,ioc:E})=>[D,E].includes(P.nationalityCode)))?!1:(P.nationalityCode&&g.push(P.nationalityCode),!0));if(T.length)h=T;else return{error:re}}let I=s?h:Cn(h);if(I.length<e){let{maleFirstNames:T,maleLastNames:P,femaleFirstNames:D,femaleLastNames:E,nationalityCodes:R}=m.reduce((C,M)=>{let{firstName:N,lastName:A,nationalityCode:O}=M;return M.sex===tr?(C.maleFirstNames.includes(N)||C.maleFirstNames.push(N),C.maleLastNames.includes(A)||C.maleLastNames.push(A)):(C.femaleFirstNames.includes(N)||C.femaleFirstNames.push(N),C.femaleLastNames.includes(A)||C.femaleLastNames.push(A)),C.nationalityCodes.includes(O)||C.nationalityCodes.push(O),C},{maleFirstNames:[],maleLastNames:[],femaleFirstNames:[],femaleLastNames:[],nationalityCodes:[]});Ce(0,e-I.length).forEach(()=>{let C=l||Ns([tr,zr]),M=Ns(R),N=Ns(C===tr?T:D),A=Ns(C===tr?P:E),O={firstName:N,lastName:A,sex:C,nationalityCode:M};I.push(O)})}let{ageMinDate:v,ageMaxDate:w}=$p({consideredDate:r,category:o}),y=Ke(v?.slice(0,4)||0)||Ke(w?.slice(0,4)||0)-3,b=Ke(w?.slice(0,4)||0)||Ke(v?.slice(0,4)||0)+3,S=(v||w)&&[y,b],U=I.slice(0,e).map((T,P)=>{let[D,E]=S||[],R=S&&ha(Ce(D,E)),C=ha(Ce(0,365)),M=R&&rFe(R,C);return Object.assign(je({extensions:i||[{name:"regionCode",value:P+1}],birthDate:M,isMock:n}),T)});return{persons:U.length&&U||I[0],nationalityCodes:g}}var SWe=["Ace Academy","Avengers","Ball Bouncers","Baseliners","Captivators","Civil Disobedients","Continentals","Court Royal","Court Sharks","Diamond Dogs","Danger Zone","Doubles Dominators","Double Faults","Tricksters","Eliminators","Court Crusaders","Fuzz Busters","Game Changers","Goal Gurus","Good Volley","Green Machine","Hawk Eyes","Inside Outers","Killer Instinct","Line Toers","Masters of Mayhem","Matter Catchers","Cheap Shot","Mean Machines","Mindspace Invaders","Net Centric","Net Positive","Smash Mullet","Over Your Head","Spin Meisters","Aggressors","Racket Machine","Slice Happy","Refs Nightmare","Sandeaters","Sun Seekers","Slicer Dicers","Stacked Deck","Cross Stringers","The Emergence","Total Demolition","Touch and Go","Unreturnables","Upside Downers","Vertically Challenged","Visual Spectacle"];function sE({nameRoot:t="TEAM",count:e=1}={}){let i=Cn(SWe).slice(0,e);return i.length<e&&Ce(0,e-i.length).forEach(r=>i.push(`${t} ${r+1}`)),{names:i}}function ay(t){let{scaledParticipantsCount:e,rankingRange:i}=t,{ratingsParameters:r=Dr,valuesInstanceLimit:n,ratingsValues:a=[],consideredDate:s,categories:o,category:l,nationalityCodesCount:u,nationalityCodeType:c,nationalityCodes:d,participantsCount:p=32,participantType:f,teamSize:m=8,personIds:h,idPrefix:g,uuids:I,personExtensions:v,addressProps:w,gendersCount:y,matchUpType:b,personData:S,sex:U,inContext:T,withISO2:P,withIOC:D,scaleAllParticipants:E}=t,R=f===ft||b===Lp,C=f===_t||b===_t;i&&(!Array.isArray(i)||!i.every(fe=>Ai(fe))||i.length!==2)&&(i=void 0),e=E?p:e;let M=1e3,N=e&&e>M?e:M;i=i||[1,N],i[1]+=1;let A=p*(R&&2||C&&(m??8)||1),O=Yue({count:A,personExtensions:v,consideredDate:s,gendersCount:y,personData:S,category:l,sex:U});if(O.error)return O;let{nationalityCodes:k,persons:F}=O,x={},L={},$={},V={},_=fe=>{Object.assign(x,fe.doublesRankings),Object.assign(L,fe.singlesRankings),Object.assign(V,fe.doublesRatings),Object.assign($,fe.singlesRatings)};if(wt(l)){let fe=Hq({scaledParticipantsCount:e,ratingsParameters:r,participantType:f,ratingsValues:a,rankingRange:i,category:l});_(fe)}Array.isArray(o)&&o.forEach(fe=>{let Te=Hq({scaledParticipantsCount:e,ratingsParameters:r,participantType:f,ratingsValues:a,rankingRange:i,category:fe});_(Te)});let B=ud.filter(fe=>c==="IOC"&&fe.ioc||fe.iso);function G(fe){let Te=Math.ceil(A/fe);return n&&Te>n?Math.ceil(A/n):fe}let{postalCodesProfile:j,postalCodesCount:K,statesProfile:Y,citiesProfile:X,citiesCount:Z,statesCount:J}=w||{},ae=fe=>Object.keys(fe).flatMap(Te=>Ce(0,Y[Te]).map(()=>Te)),te=X&&ae(X)||w?.cities||Hue({count:Z||A,participantsCount:A}).cities,ne=Y&&ae(Y)||w?.states||Wue({count:J||A,participantsCount:A}).states,le=j&&ae(j)||w?.postalCodes||zue({count:K||A,participantsCount:A}).postalCodes,de={cities:te,states:ne,postalCodes:le},pe=G(u),ge=pe?Cn(B).slice(0,u):d&&B.filter(fe=>d.includes(fe.iso))||B,Me=Cn(Ce(0,Math.ceil(A/(pe||1))).map(()=>ge).flat(1/0)),Pe=sE({count:p}).names;return{participants:Ce(0,p).flatMap(fe=>{let Te=R&&2||C&&(m??8)||1,ce=Ce(0,Te).map(Ne=>{let me=fe*Te+Ne;return Be(me)}),ye=ce.map(Ne=>Ne.participantId),be=ce.map(Ne=>Ne.person.standardFamilyName).join("/"),Fe=R?ft:_t,we={participantId:aE({participantType:Fe,index:fe,idPrefix:g,uuids:I}),participantName:R?be:Pe[fe],participantRole:Jr,individualParticipantIds:ye,participantType:Fe};return T&&(we.individualParticipants=ce),R||C?[we,...ce]:ce}),...W};function Be(fe){let Te=F[fe],{nationalityCode:ce,participantExtensions:ye,participantTimeItems:be,extensions:Fe,firstName:we,birthDate:Ne,lastName:me,personId:Ee,sex:Le}=Te||{},Q=we||"GivenName",se=me||"FamilyName",oe=`${Q} ${se}`,ue=Me[fe],ee=k?.length&&ce||ue&&(c==="IOC"?ue.ioc||ue.iso:ue.iso||ue.ioc)||ce;Me?.length&&!ee&&!ce&&console.log("%c Invalid Nationality Code",{participantIndex:fe,country:ue});let Se=que({...de,participantIndex:fe,nationalityCode:ee}),De=je({participantId:aE({participantType:It,index:fe,idPrefix:g,uuids:I}),extensions:ye,timeItems:be,participantRole:Jr,participantType:It,participantName:oe,person:{personId:Ee||h?.length&&h[fe]||Ct(),birthDate:Mn(Ne)?Ne:void 0,addresses:[Se],standardFamilyName:se,standardGivenName:Q,nationalityCode:ee,extensions:Fe,sex:Le}});if(D&&ee){let Ue=ud.find(({iso:ut})=>ut===ee);Ue?.ioc&&(De.person.iocNationalityCode=Ue.ioc),Ue?.label&&(De.person.countryName=Ue.label)}if(P&&ee){let Ue=ud.find(({iso:ut})=>ut===ee);Ue?.iso2&&(De.person.iso2NationalityCode=Ue.iso2),Ue?.label&&(De.person.countryName=Ue.label)}let it=Ue=>{let ut=Ue.categoryName||Ue.ratingType||Ue.ageCategoryCode,yi=L[ut]?.[fe],qe=x[ut]?.[fe];NT({scaleValue:yi,eventType:$m,scaleType:vu,participant:De,category:Ue}),NT({scaleValue:qe,eventType:bc,scaleType:vu,participant:De,category:Ue});let bi=$[ut]?.[fe],oi=V[ut]?.[fe];NT({scaleValue:bi,eventType:$m,scaleType:ld,participant:De,category:Ue}),NT({scaleValue:oi,eventType:bc,scaleType:ld,participant:De,category:Ue})};return Array.isArray(o)?o.forEach(Ue=>it(Ue)):l&&it(l),De}}function NT({scaleValue:t,participant:e,eventType:i,scaleType:r,category:n}){let a=n.categoryName||n.ratingType||n.ageCategoryCode,s=[Sd,r,i,a].join("."),o={itemValue:t,itemType:s};a&&t&&(e.timeItems||(e.timeItems=[]),e.timeItems.push(o))}function Hq(t){let{category:e,scaledParticipantsCount:i,ratingsParameters:r,participantType:n,ratingsValues:a=[]}=t,s=e.rankingRange||t.rankingRange||[1,1e3],o={},l={},u={},c={},{categoryName:d,ageCategoryCode:p,ratingType:f}=e,m=e.categoryName||e.ratingType||e.ageCategoryCode;if((d||p)&&!f){let[h,g]=s||[];if(l[m]=Cn(Ce(h,g)).slice(0,i||is(20,30)),[ft,_t].includes(n)){let[I,v]=s||[];o[m]=Cn(Ce(I,v)).slice(0,i||is(20,30))}}if(f&&r[f]){let{ratingMax:h,ratingMin:g,ratingAttributes:I}=e,v={...r[f],...I||{}},{attributes:w={},decimalsCount:y,accessors:b,range:S,step:U}=v,T=C=>{let M={},N=Object.keys(C||{});for(let A of N){let O=C[A];if(typeof O=="object"&&O.generator){let{range:k}=O,[F,x]=k.slice().sort();M[A]=is(F,x)}else M[A]=O}return M},P=S[0]>S[1]?2:.7,[D,E]=S.slice().sort(),R=Ce(0,2e3).map(()=>nte(D,E,P,U,y)).filter(C=>(!h||C<=h)&&(!g||C>=g)).slice(0,i||is(20,30)).map(C=>b?Object.assign({},...b.map(M=>({[M]:C})),T(w)):C);u[m]=[...a,...R],[ft,_t].includes(n)&&(c[m]=[...a,...R])}return{singlesRankings:l,doublesRankings:o,singlesRatings:u,doublesRatings:c}}function cG(t){let{alternatesCount:e=0,tieFormatName:i,drawSize:r}=t,n=0,a=0,s=0,o=0,l={},u={[tr]:0,[zr]:0,[Oh]:0,[zu]:0,ANY:0};(wt(t.tieFormat)?t.tieFormat:yc({namedFormat:i}))?.collectionDefinitions?.filter(Boolean).forEach(f=>{let{category:m,collectionId:h,matchUpType:g,matchUpCount:I,gender:v}=f;if(cl(v)){let w=ln(v),y=I*(g===Bt?2:1);w&&u[w]<y&&(u[w]=y)}else Aa(v)&&(u[tr]<I&&(u[tr]=I),u[zr]<I&&(u[zr]=I));if(m){let w=JSON.stringify(m);l[w]=m}if(h||(f.collectionId=Ct()),Pi(Bt)(g)){let w=I;o+=I,n=Math.max(n,w)}if(Pi(zt)(g)){let w=I;s+=I,a=Math.max(a,w)}});let c=Object.keys(l).length?Math.max(s,o*2):Math.max(a,n*2),d=n*(r+e),p=a*(r+e);return{maxDoublesDraw:d,maxSinglesDraw:p,teamSize:c,genders:u}}function UWe({participantsProfile:t,eventProfiles:e,drawProfiles:i}){let{participantsCount:r,participantType:n=It}=t||{},a=r||0,s={[zr]:0,[Oh]:0,[zu]:0,[tr]:0,ANY:0},o=0,l=0,u=0,c=0,d=0,p=({alternatesCount:m=0,uniqueParticipants:h,tieFormatName:g,drawSize:I=0,eventType:v,tieFormat:w,category:y,gender:b,stage:S})=>{let U=v===fs,T=v===ar,P=!!(h||S===ze||y||b);if(T){c=Math.max(c,I+m),w=typeof w=="object"?w:yc({namedFormat:g});let{teamSize:D,maxDoublesDraw:E,maxSinglesDraw:R,genders:C}=cG({alternatesCount:m,tieFormatName:g,tieFormat:w,drawSize:I});u=Math.max(u,D),l=Math.max(l,R),P||(o=Math.max(o,E)),Object.keys(C).forEach(M=>s[M]+=C[M])}else if(U)if(P){let D=(I+m)*2;d+=D,b&&(s[b]+=D)}else I+m&&I+m>o&&(o=I+m);else if(P){let D=I+m;b&&(s[b]+=D),d+=D}else I&&I>l&&(l=I+m)};if(e?.forEach(m=>{let{tieFormatName:h,tieFormat:g,drawProfiles:I,eventType:v,category:w,gender:y}=m;if(I)for(let b of I){let{tieFormatName:S,tieFormat:U}=b;p({...b,tieFormatName:S||h,tieFormat:U||g,eventType:v,category:w,gender:y})}}),Array.isArray(i))for(let m of i)p(m);let f=Math.max(c*u,o*2,l);return o&&(n=ft),(r||a)<f&&(r=f),r&&o&&[ft,ar].includes(n)&&(l&&Math.floor(l/2)>o?r=Math.floor(l/2):(!l||o*2>=l)&&(r=Math.ceil(r/2))),r===void 0&&(r=!e?.length&&!i?.length?32:0),r<a&&(r=a),{uniqueParticipantsCount:d,participantsCount:r,largestTeamDraw:c,largestTeamSize:u,participantType:n,gendersCount:s}}function Kue({participantsProfile:t,tournamentRecord:e,eventProfiles:i,drawProfiles:r,startDate:n,uuids:a}){if(t?.participantsCount===0)return{addedCount:0,...W};let{participantsCount:s,participantType:o,largestTeamDraw:l,largestTeamSize:u,gendersCount:c}=UWe({participantsProfile:t,eventProfiles:i,drawProfiles:r}),d=t?.teamKey,p=ay({consideredDate:n,...t,participantsCount:s,participantType:o,gendersCount:c,uuids:a}).participants,f=0,m=no({tournamentRecord:e,participants:p});if(m.error)return m;if(f+=m.addedCount,d){let v=uG({tournamentRecord:e,...d});if(v.error)return v}let h=p.filter(({participantType:v})=>v===It).map(yt),g=t?.idPrefix?`${_t}-${t.idPrefix}`:void 0,I=Ce(0,l).map(v=>{let w=h.slice(v*u,(v+1)*u),y=aE({index:v,participantType:o,idPrefix:g,uuids:a});return{participantName:`Team ${v+1}`,participantRole:Jr,individualParticipantIds:w,participantType:_t,participantId:y}});return m=no({participants:I,tournamentRecord:e}),m.error?m:(f+=m.addedCount,{addedCount:f,...W})}function Xue({drawProfiles:t,category:e,gender:i}){let r={},n=t?.reduce((s,o)=>{let{qualifyingPositions:l=0,participantsCount:u=0,uniqueParticipants:c,stage:d=Ae,drawSize:p=0}=o||{};Object.keys(s).includes(d)||(s[d]=0);let f=(u||p)-l;return c||i||e||d===ze?(Object.keys(r).includes(d)||(r[d]=0),r[d]+=f):s[d]=Math.max(s[d],f),s},{}),a=Object.keys(r);return a.forEach(s=>n[s]+=r[s]),{stageParticipantsCount:n,uniqueParticipantsCount:r,uniqueParticipantStages:a}}function Jue({allUniqueParticipantIds:t,stageParticipantsCount:e,eventParticipantType:i,targetParticipants:r}){let n=e[Ae]||0,a=e[ze]||0;return{stageParticipants:{QUALIFYING:r?.filter(({participantType:s})=>s===i).filter(({participantId:s})=>!t.includes(s)).slice(0,a),MAIN:r?.filter(({participantType:s})=>s===i).filter(({participantId:s})=>!t.includes(s)).slice(a,a+n)}}}var TWe={[ai]:2,[Si]:1,[Wi]:1,[Sr]:1,[qt]:4};function dG(t){let{defaultWithScorePercent:e=2,winningSide:i}=t,{matchUpStatusProfile:r=TWe,matchUpFormat:n=Vs,pointsPerMinute:a=1,sideWeight:s=4}=t;if(!$a({matchUpFormat:n}))return{error:xte};if(typeof r!="object")return{error:re};if(e>100&&(e=100),Number.isNaN(Number(e))||Number.isNaN(Number(a))||Number.isNaN(Number(s)))return{error:re};let o=Object.keys(r).filter(D=>Object.keys(LM).includes(D)&&D!==Oi);if(Object.keys(o).reduce((D,E)=>D+r[E],0)>100)return{error:re,matchUpStatusProfile:r};let l=o.reduce((D,E)=>(D.pointer=D.pointer+r[E],D.valueMap.push([D.pointer,E]),D),{pointer:0,valueMap:[]}),u=is(1,100),c=(l.valueMap.find(D=>u<=D[0])??[100,Oi])[1],d={sets:[],scoreStringSide1:"",side2ScoreString:""};if(Lr(c)){i=i||is(1,2);let D={score:d,matchUpStatus:c,winningSide:i};if(!(c===qt&&is(1,100)>100-e))return{outcome:D}}else if([Si,Wi].includes(c))return{outcome:{score:d,matchUpStatus:c}};let p=qi(n),{bestOf:f=1,exactly:m,setFormat:h,finalSetFormat:g}=p??{},I=[],v=is(0,1),w=i?[i-1]:[...Ce(0,s).map(()=>v),1-v],y=[Sr,qt,Da,Kd].includes(c)&&(ha(Ce(1,m||f))||1),b,S=Ce(1,(m??f)+1);for(let D of S){let E=D===(m??f),{set:R,incomplete:C,winningSideNumber:M}=DWe({setFormat:E&&g||h,incomplete:y===D,pointsPerMinute:a,matchUpStatus:c,weightedRange:w,setNumber:D});if(I.push(R),C){b=M;break}if(lw({matchUp:{score:{sets:I},matchUpFormat:n}}).calculatedWinningSide)break}let U=lw({matchUp:{score:{sets:I},matchUpFormat:n,winningSide:i}}),T=b?i||b:U.calculatedWinningSide,{score:P}=kue({winningSide:T,score:{sets:I},matchUpStatus:c});return{outcome:{winningSide:T,matchUpStatus:c,score:P}}}function DWe({weightedRange:t=[0,1],pointsPerMinute:e,matchUpStatus:i,incomplete:r,setFormat:n,setNumber:a}){let s={setNumber:a},{setTo:o,tiebreakFormat:l,tiebreakAt:u,tiebreakSet:c,timed:d,minutes:p}=n,f=is(0,t.length-1),m=t[f],h;if(d){let g=p*e,I=Math.round(g*.2),v=g+ha([1,-1])*I,w=Axe(v,2),y=[w,v-w];m&&y.reverse(),h=t[f]+1;let b=y[0]>y[1]&&1||y[1]>y[0]&&2||0;if(r){let[T,P]=y;return Object.assign(s,{side1Score:T,side2Score:P}),Ki.includes(i)?{set:s,incomplete:r,winningSideNumber:h}:{set:s,incomplete:r}}b||(y[is(0,1)]+=1),b=y[0]>y[1]?1:2,b!==h&&y.reverse();let[S,U]=y;return Object.assign(s,{side1Score:S,side2Score:U,winningSide:h}),{set:s}}else{if(r)return s.side1Score=is(0,u),s.side2Score=is(0,u),Ki.includes(i)&&(h=t[f]+1),{set:s,incomplete:r,winningSideNumber:h};{let g=Ce(1,o+1).flatMap(U=>Ce(0,o+2-U).map(()=>U)),I=g[is(0,g.length-1)],v=o&&KV({isSide1:!0,tiebreakAt:u,lowValue:I,setTo:o}),w=!v,y=t.length===1&&t[f]+1;if(!w){y?(v[0]>v[1]?1:2)!==y&&v.reverse():m&&v.reverse();let[U,T]=v;Object.assign(s,{side1Score:U,side2Score:T})}let b=sw({matchUpScoringFormat:{setFormat:n},setObject:s}),S;if(b.hasTiebreakCondition||w){let{NoAD:U,tiebreakTo:T}=l||c||{},P=Ce(1,T+1).flatMap(R=>Ce(0,T+2-R).map(()=>R)),D=P[is(0,P.length-1)],E=EN({isSide1:!0,tiebreakNoAd:U,tiebreakTo:T,lowValue:D});if(E)if(w){let R=E[0]>E[1]?1:2;y?R!==y&&E.reverse():m&&E.reverse(),[s.side1TiebreakScore,s.side2TiebreakScore]=E,S=E[0]>E[1]&&1||E[1]>E[0]&&2||void 0}else b.leadingSide===2?[s.side1TiebreakScore,s.side2TiebreakScore]=E:[s.side2TiebreakScore,s.side1TiebreakScore]=E}s.winningSide=b.winningSide||b.leadingSide||y||S}}return{set:s}}function PWe({firstRoundDualMatchUps:t,event:e,tournamentRecord:i,drawDefinition:r}){let n=e?.category?.ageCategoryCode||e?.category?.categoryName;if(n){let d=uue({singlesOnly:!0,tournamentRecord:i,drawDefinition:r,scaleAccessor:{scaleName:n,sortOrder:"ASC",scaleType:vu},event:e});if(d.error)return d;let{lineUps:p,participantsToAdd:f}=d;no({tournamentRecord:i,participants:f}),Ft({element:r,extension:{name:Sc,value:p}});return}let a=t[0]?.structureId,{positionAssignments:s}=Kt({drawDefinition:r,structureId:a});if(!s?.length)return;let{participants:o}=Ri({participantFilters:{participantTypes:[ei]},tournamentRecord:i});function l(d){return o?.find(p=>{let{participantId:f}=p;return s.find(m=>m.participantId===f)?.drawPosition===d})}function u(d,p,f){d.sides.forEach(m=>{let{drawPosition:h}=m,g=l(h);if(g){let I=g.individualParticipantIds?.[p];I&&nE({teamParticipantId:g.participantId,participantId:I,tournamentRecord:i,drawDefinition:r,tieMatchUpId:f,event:e});return}})}function c(d,p,f){d.sides.forEach(m=>{let{drawPosition:h}=m,g=l(h);g&&g.individualParticipantIds?.slice(p*2,p*2+2)?.forEach(I=>{nE({teamParticipantId:g.participantId,participantId:I,tournamentRecord:i,drawDefinition:r,tieMatchUpId:f,event:e})})})}t.forEach(d=>{let p=d.tieMatchUps.filter(Pi(zt)),f=d.tieMatchUps.filter(Pi(Bt));p.forEach((m,h)=>{let g=m.matchUpId;u(m,h,g)}),f.forEach((m,h)=>{let g=m.matchUpId;c(m,h,g)})})}function EWe({structure:t,matchUpsMap:e,drawDefinition:i,tournamentRecord:r,event:n,matchUpStatusProfile:a,matchUpFormat:s,matchUpStatus:o,scoreString:l,randomWinningSide:u,completionGoal:c,completedCount:d}){let p=At({contextFilters:{matchUpTypes:[Bt,zt]},afterRecoveryTimes:!1,tournamentRecord:r,inContext:!0,drawDefinition:i,matchUpsMap:e,structure:t,event:n}).matchUps.filter(({winningSide:f})=>!f).sort(Hh).map(vr);for(let f of p){if(!Number.isNaN(Number(c))&&d.value>=c)break;let{matchUps:m}=At({matchUpFilters:{matchUpTypes:[Bt,zt]},afterRecoveryTimes:!1,tournamentRecord:r,inContext:!0,drawDefinition:i,matchUpsMap:e,structure:t,event:n}),h=m.find(I=>I.matchUpId===f),g=[Si,Wi].includes(h.matchUpStatus);if(h?.readyToScore&&!g){let I=RWe({matchUpStatusProfile:a,tournamentRecord:r,drawDefinition:i,targetMatchUp:h,matchUpFormat:s,matchUpStatus:o,scoreString:l,winningSide:!u&&1,event:n});if(I?.error)return I;d.value+=1}}}function oE(t){let{matchUpStatusProfile:e,completeAllMatchUps:i,randomWinningSide:r,tournamentRecord:n,completionGoal:a,drawDefinition:s,event:o}=t;if(!s)return{error:$e};let l=t.matchUpFormat||s.matchUpFormat||o?.matchUpFormat,u=s.structures.slice().sort(_h),c={value:0},{matchUps:d,matchUpsMap:p}=Zi({matchUpFilters:{matchUpTypes:[ei],roundNumbers:[1]},contextFilters:{stages:[Ae,ze]},inContext:!0,drawDefinition:s});if(d?.length){let I=PWe({firstRoundDualMatchUps:d,event:o,tournamentRecord:n,drawDefinition:s});if(I?.error)return I}let f=typeof i=="string"&&i,m=f&&Oi,h=u.length===2&&u[0].finishingPosition===jp&&Li(u.map(({stage:I})=>I),[Ae,Ti]).length===2,g=u.map(({structureId:I})=>I);for(let I of g){if(c.value>=a)break;let v=s.structures.find(y=>y.structureId===I),w=EWe({structure:v,matchUpsMap:p,drawDefinition:s,tournamentRecord:n,event:o,matchUpStatusProfile:e,matchUpFormat:l,matchUpStatus:m,scoreString:f,randomWinningSide:r,completionGoal:a,completedCount:c});if(w?.error)return w;h&&v.finishingPosition===jp&&t.completeRoundRobinPlayoffs&&qv({structureId:v.structureId,applyPositioning:!0,drawDefinition:s})}return{...W,completedCount:c.value}}function Que(t){let{matchUpStatusCodes:e,policyDefinitions:i,tournamentRecord:r,drawDefinition:n,targetMatchUp:a,matchUpStatus:s,matchUpFormat:o,scoreString:l,winningSide:u,event:c}=t;if(!a||a.matchUpStatus==="BYE")return;let{matchUpId:d}=a||{},{outcome:p}=nG({matchUpFormat:o,matchUpStatus:s,scoreString:l,winningSide:u});return e&&(p.matchUpStatusCodes=e),nT({tournamentRecord:r,policyDefinitions:i,drawDefinition:n,matchUpFormat:o,matchUpId:d,outcome:p,event:c})}function RWe(t){let{matchUpStatusProfile:e={},tournamentRecord:i,policyDefinitions:r,drawDefinition:n,matchUpStatus:a,matchUpFormat:s,targetMatchUp:o,scoreString:l,winningSide:u,event:c}=t;if(l||a)return Que(t);let{matchUpId:d}=o||{},{outcome:p}=dG({matchUpStatusProfile:e,matchUpFormat:s,winningSide:u});return nT({policyDefinitions:r,tournamentRecord:i,drawDefinition:n,matchUpFormat:s,matchUpId:d,outcome:p,event:c})}function Zue({matchUpStatusProfile:t,completeAllMatchUps:e,randomWinningSide:i,tournamentRecord:r,drawProfiles:n,isMock:a,event:s}){let o=Bi({event:s}).flightProfile,{eventName:l,eventType:u,category:c}=s,{startDate:d}=r,p=[],f=c?.categoryName||c?.ageCategoryCode||c?.ratingType,m=s.drawDefinitions?.map(({drawId:h})=>h);if(Array.isArray(o?.flights))for(let[h,g]of o.flights.entries()){let{drawId:I,stage:v,drawName:w,drawEntries:y}=g;p.push(g.drawId);let b=n[h],{seedsCount:S,generate:U=!0}=b||{};if(U){let T=y.filter(Pa(Iu)).map(Pa(Iu)),P=f||l;if(r&&S&&S<=T.length&&Ce(1,S+1).forEach((M,N)=>{let A={scaleValue:M,scaleName:P,scaleType:Yl,eventType:u,scaleDate:d},O=T[N];Kv({tournamentRecord:r,participantId:O,scaleItem:A})}),m?.includes(I))break;let D=iT({...b,matchUpType:u,seedingScaleName:P,tournamentRecord:r,drawEntries:y,drawName:w,drawId:I,isMock:a,event:s,stage:v});if(D.error)return{error:D.error,drawIds:[]};let{drawDefinition:E}=D;if(!E)return{error:_a};let R=n[h]?.drawExtensions;if(Array.isArray(R)&&R.filter(ml).forEach(M=>Ft({element:E,extension:M})),D=rT({suppressNotifications:!0,tournamentRecord:r,drawDefinition:E,event:s}),D.error)return{error:D.error,drawIds:[]};if(b?.withPlayoffs){let M=E.structures?.[0].structureId,N=cN({idPrefix:b.idPrefix,...b.withPlayoffs,tournamentRecord:r,drawDefinition:E,structureId:M,isMock:a,event:s});if(N?.error)return N}let C=b?.completionGoal;if(b?.automated!==!1&&(e||C)){let M=b?.matchUpFormat,N=oE({completeAllMatchUps:!C&&e,matchUpStatusProfile:t,randomWinningSide:i,tournamentRecord:r,completionGoal:C,drawDefinition:E,matchUpFormat:M,event:s});if(N.error)return{error:N.error,drawIds:[]};let A=N.completedCount;if(b?.drawType===gu){let O=E.structures?.find(x=>x.stage===Ae);if(!O)return{error:vi};let k=qv({structureId:O.structureId,tournamentRecord:r,drawDefinition:E});if(k.error)return{error:k.error,drawIds:[]};let F=C?C-(A??0):void 0;if(k=oE({completeAllMatchUps:!C&&e,completionGoal:C?F:void 0,matchUpStatusProfile:t,randomWinningSide:i,tournamentRecord:r,drawDefinition:E,matchUpFormat:M,event:s}),k.error)return{error:k.error,drawIds:[]}}}}}return{...W,drawIds:p}}function ece(t){let{participantsProfile:e={},uniqueParticipantsCount:i,ratingsParameters:r,tournamentRecord:n,eventProfile:a,eventIndex:s,event:o,uuids:l}=t,{category:u,gender:c,eventType:d}=o,p=Pi(pl)(d)&&It||Pi(fs)(d)&&ft||d,f=i[Ae]||0,m=i[ze]||0,h=a.drawProfiles?.length?f+m:a.participantsProfile?.participantsCount??0,g=cl(c)?c:void 0,I=e?.idPrefix?`E-${s}-${e?.idPrefix}`:void 0,{participants:v}=ay({uuids:a.uuids||l,...e,scaledParticipantsCount:a.scaledParticipantsCount,consideredDate:n?.startDate,rankingRange:a.rankingRange,participantType:p,participantsCount:h,ratingsParameters:r,category:u,idPrefix:I,sex:g}),w=no({tournamentRecord:n,participants:v});if(w.error)return w;let y=v?.filter(({participantType:S})=>S===p),b=v?.map(yt);return{uniqueDrawParticipants:y,uniqueParticipantIds:b}}function CWe({autoEntryPositions:t,tournamentRecord:e,drawParticipants:i,drawProfile:r,event:n}){let{drawType:a=Jo,qualifyingPositions:s=0,stage:o=Ae,drawSize:l=0,drawName:u,drawId:c}=r,d=l-s,p=i.slice(0,d).map(yt);if(p.length){let h=Qo({participantIds:p,autoEntryPositions:t,entryStage:o,tournamentRecord:e,event:n});if(h.error)return h}let f=p.map(h=>({entryStatus:ua,entryStage:o,participantId:h})),m=zN({drawName:u||a,qualifyingPositions:s,drawEntries:f,drawId:c,event:n,stage:o});return m.error?m:{...W}}function tce({uniqueDrawParticipants:t,autoEntryPositions:e,stageParticipants:i,tournamentRecord:r,drawProfiles:n,category:a,gender:s,event:o}){let l=0;for(let u of n){let{qualifyingPositions:c=0,uniqueParticipants:d,stage:p=Ae,drawSize:f=0}=u,m=f-c,h=d||s||a||p===ze,g=h?t.slice(l,l+m):i[p||Ae]||[];h&&(l+=m);let I=CWe({autoEntryPositions:e,drawParticipants:g,tournamentRecord:r,drawProfile:u,event:o});if(I.error)return I}return{...W}}function ice(t){let{allUniqueParticipantIds:e,matchUpStatusProfile:i,participantsProfile:r,completeAllMatchUps:n,autoEntryPositions:a,hydrateCollections:s,randomWinningSide:o,ratingsParameters:l,tournamentRecord:u,eventProfile:c,eventIndex:d,publish:p,isMock:f,uuids:m}=t,h=c.gender,g=c.eventName,{eventType:I=pl,policyDefinitions:v,drawProfiles:w=[],eventExtensions:y,surfaceCategory:b,tieFormatName:S,processCodes:U,discipline:T,eventLevel:P,timeItems:D,ballType:E,category:R}=c,C=c.eventId||Ct(),M=c.tieFormat||(I===ar?yc({namedFormat:S,event:{eventId:C,category:R,gender:h},hydrateCollections:s,isMock:f}):void 0),N=u.participants;for(let Y of w)!h&&Y.gender&&(h=Y?.gender);let{stageParticipantsCount:A,uniqueParticipantsCount:O,uniqueParticipantStages:k}=Xue({drawProfiles:w,category:R,gender:h}),F=Pi(pl)(I)&&It||Pi(fs)(I)&&ft||I,{uniqueDrawParticipants:x=[],uniqueParticipantIds:L=[]}=k?ece({event:{eventType:I,category:R,gender:h},uniqueParticipantsCount:O,participantsProfile:r,ratingsParameters:l,tournamentRecord:u,eventProfile:c,eventIndex:d,uuids:m}):{},{eventAttributes:$}=c;typeof $!="object"&&($={});let V=R?.categoryName||R?.ageCategoryCode||R?.ratingType;g=g||V||"Generated Event";let _={...$,surfaceCategory:b,processCodes:U,discipline:T,eventLevel:P,eventName:g,eventType:I,tieFormat:M,ballType:E,category:R,eventId:C,gender:h};if(y?.length&&Array.isArray(y)){let Y=y.filter(ml);Y?.length&&Object.assign(_,{extensions:Y})}if(Array.isArray(D)&&D.forEach(Y=>Jh({event:j,timeItem:Y})),typeof v=="object")for(let Y of Object.keys(v))qp({policyDefinitions:{[Y]:v[Y]},event:_});_.category&&(_.category.categoryName=V);let B,G=Zv({suppressNotifications:!1,internalUse:!0,tournamentRecord:u,event:_});if(G.error)return G;let j=G?.event,{stageParticipants:K}=Jue({allUniqueParticipantIds:e,stageParticipantsCount:A,eventParticipantType:F,targetParticipants:N});if(w?.length){let Y=tce({uniqueDrawParticipants:x,autoEntryPositions:a,stageParticipants:K,tournamentRecord:u,drawProfiles:w,category:R,gender:h,event:j});if(Y.error)return Y;let X=Zue({matchUpStatusProfile:i,completeAllMatchUps:n,randomWinningSide:o,tournamentRecord:u,drawProfiles:w,isMock:f,event:j});if(X.error)return X;B=X.drawIds}else if(c?.participantsProfile?.participantsCount){let Y=x.map(yt);if(Y.length){let X=Qo({participantIds:Y,autoEntryPositions:a,tournamentRecord:u,entryStage:Ae,event:j});if(X.error)return X}}return p&&ty({tournamentRecord:u,event:j}),{drawIds:B,eventId:C,uniqueParticipantIds:L}}function pG({tournamentRecords:t,scheduleDate:e,venueId:i,round:r}){if(!Mn(e))return{error:or};let n="addSchedulingProfileRound",{extension:a}=ht({name:Gm,tournamentRecords:t,discover:!0}),s=a?.value||[],o=s.find(p=>pu(e,p.scheduleDate));if(!o){let{startDate:p,endDate:f}=NN({tournamentRecords:t}),m=new Date(e);if(p&&m<new Date(p)||f&&m>new Date(f))return{error:or};o={scheduleDate:e,venues:[]},s.push(o)}let l=o.venues.find(p=>p.venueId===i);l||(l={venueId:i,rounds:[]},o.venues.push(l));let u=["notBeforeTime"],c=p=>Object.keys(p).filter(f=>!u.includes(f)).sort().map(f=>wt(p[f])?c(p[f]):p[f]).flat().join("|");if(l.rounds.find(p=>c(p)===c(r)))return q({result:{error:Pte},stack:n});l.rounds.push(r);let d=Jv({tournamentRecords:t,schedulingProfile:s});return d.error?d:{...W}}function MWe({schedulingProfile:t,tournamentRecord:e}){if(typeof t!="object")return{error:re};let i=Bv({tournamentRecord:e}).containedStructures,r=Ur({tournamentRecord:e}).matchUps??[],{tournamentId:n}=e,a=[];for(let s of t){let{scheduleDate:o,venues:l=[]}=s;for(let u of l){let{rounds:c,venueId:d}=u;for(let p of c){let{drawId:f,winnerFinishingPositionRange:m,roundSegment:h}=p,g=r.filter(I=>{let v=m?.indexOf("-")>0&&m.split("-").map(y=>+y),w=I.finishingPositionRange?.winner;return I.drawId===f&&(!p.roundNumber||I.roundNumber===p.roundNumber)&&(!w||!v||Li(w,v).length===2||nt(w).length===nt(v).length&&Li(w,v).length===nt(w).length)})[0];if(g){let{eventId:I,roundNumber:v,drawName:w,structureName:y,roundName:b}=g,S=g.structureId;v&&!m&&(S=Object.keys(i).find(P=>i[P].includes(S))??S);let U={tournamentId:n,structureId:S,roundNumber:v,roundSegment:h,eventId:I,drawId:f},T=pG({tournamentRecords:{[n]:e},round:U,scheduleDate:o,venueId:d});if(T.error)return T;a.push({structureName:y,roundName:b,drawName:w,...U})}}}}return{scheduledRounds:a}}function sA(t){let e=He(t,[{drawProfile:!0,_ofType:Kn}]);if(e.error)return e;let{allUniqueParticipantIds:i=[],participantsProfile:r={},matchUpStatusProfile:n,completeAllMatchUps:a,autoEntryPositions:s,hydrateCollections:o,randomWinningSide:l,ratingsParameters:u,tournamentRecord:c,isMock:d=!0,drawProfile:p,startDate:f,drawIndex:m,uuids:h}=t,g=Oe(p,!1,!0),{excessParticipantAlternates:I=!0,matchUpFormat:v=Vs,drawType:w=Jo,tournamentAlternates:y=0,alternatesCount:b=0,qualifyingPositions:S,qualifyingProfiles:U,generate:T=!0,eventExtensions:P,drawExtensions:D,completionGoal:E,tieFormatName:R,buildTeams:C,seedsCount:M,timeItems:N,drawName:A,category:O,idPrefix:k,publish:F,gender:x,stage:L}=g,$=g.drawSize||(g.ignoreDefaults?void 0:32),V=g.eventId||Ct(),_=p.eventType||p.matchUpType||pl,B=_===fs?ft:It,G=wt(p.tieFormat)&&p.tieFormat||_===_t&&yc({event:{eventId:V,category:O,gender:x},namedFormat:R,hydrateCollections:o,isMock:d})||void 0,j=O?.categoryName||O?.ageCategoryCode||O?.ratingType,K=p.eventName||j||`Generated ${_}`,Y=c?.participants||[],X=(U?.flatMap(ce=>ce.structureProfiles||[]).reduce((ce,ye)=>{let be=!ye.participantsCount||ye.participantsCount>ye.drawSize?ye.drawSize:ye.participantsCount||0;return ce+be},0)||0)*(B===ft?2:1),Z=(!p.participantsCount||p.participantsCount>$?$:p.participantsCount)||0,J={eventName:K,eventType:_,tieFormat:G,category:O,eventId:V,gender:x};Array.isArray(N)&&N.forEach(ce=>Jh({event:J,timeItem:ce}));let{eventAttributes:ae}=p;if(typeof ae!="object"&&(ae={}),Object.assign(J,ae),P?.length&&Array.isArray(P)){let ce=P.filter(ml);ce?.length&&Object.assign(J,{extensions:ce})}let te=[];if(r?.participantsCount===0||p.uniqueParticipants||X||!c||x||O){let ce=(Z||0)+b+X,ye=ce,be={[tr]:0,[zr]:0},Fe,we;_===_t&&({teamSize:Fe,genders:we}=cG({alternatesCount:b,tieFormatName:R,tieFormat:G,drawSize:$}),Object.keys(we).forEach(Ee=>{let Le=ln(Ee);Le&&cl(Ee)&&we[Le]&&(be[Le]=$*we[Le])}),ye=Fe*(($||0)+X));let Ne=r?.idPrefix?`D-${m}-${r?.idPrefix}`:void 0,me=ay({...r,scaledParticipantsCount:p.scaledParticipantsCount||r.scaledParticipantsCount,participantsCount:ye,consideredDate:c?.startDate,sex:x||r?.sex,rankingRange:p.rankingRange,uuids:p.uuids||h,ratingsParameters:u,participantType:B,gendersCount:be,idPrefix:Ne,category:O}).participants;if(J.category&&(J.category.categoryName=j),c){let Ee=no({participants:me,tournamentRecord:c});if(Ee.error)return Ee}if(me.forEach(({participantId:Ee})=>te.push(Ee)),Y=me,_===_t){let Ee=we[tr]?me.filter(({participantType:Ue,person:ut})=>Ue===It&&ut?.sex===tr).map(yt):[],Le=we[zr]?me.filter(({participantType:Ue,person:ut})=>Ue===It&&up(ut?.sex)).map(yt):[],Q=me.filter(({participantType:Ue})=>Ue===It).map(yt).filter(Ue=>!Ee.includes(Ue)&&!Le.includes(Ue)),se=[...g.teamNames??[],...sE({count:ce}).names],oe=Fe-(we[tr]+we[zr]),ue=0,ee=0,Se=0,De=Ce(0,ce).map(Ue=>{let ut=Le.slice(ue,ue+we[zr]),yi=Ee.slice(ee,ee+we[tr]),qe=Q.slice(Se,Se+oe);ue+=we[zr],ee+=we[tr],Se+=oe;let bi=C!==!1?[...ut,...yi,...qe]:[];return{participantName:se[Ue]||`Team ${Ue+1}`,participantOtherName:`TM${Ue+1}`,participantRole:Jr,individualParticipantIds:bi,participantType:_t,participantId:Ct()}}),it=no({participants:De,tournamentRecord:c});if(!it.success)return it;Y=De}}let ne=ce=>{let{participantType:ye}=ce;return Pi(pl)(_)&&ye===It||Pi(fs)(_)&&ye===ft?!0:_===_t&&ye===_t},le=ce=>!p.gender||ce.person?.sex===p.gender?!0:ce.individualParticipantIds?.some(ye=>{let be=Y.find(Fe=>Fe.participantId===ye);return be&&le(be)}),de=Y.filter(ne).filter(le).filter(({participantId:ce})=>!i.includes(ce)),pe=de.slice(0,Z).map(ce=>ce.participantId);if(d&&pe?.length){let ce=Qo({autoEntryPositions:s,entryStage:L,tournamentRecord:c,participantIds:pe,event:J});if(ce.error)return ce}let ge=X?de.slice(Z,Z+X).map(ce=>ce.participantId):0;if(d&&ge?.length){let ce=0,ye=1,be=(we,Ne)=>we.stageSequence-Ne.stageSequence,Fe=(we,Ne)=>we.roundTarget-Ne.roundTarget;for(let we of U.sort(Fe)){ye=we.roundTarget||ye;let Ne=1,me;for(let Ee of we.structureProfiles.sort(be)){let Le=(Ee.drawSize||W$(Ee.participantsCount))-(me||0),Q=ge.slice(ce,ce+Le),se=Qo({entryStage:ze,entryStageSequence:Ne,autoEntryPositions:s,tournamentRecord:c,participantIds:Q,roundTarget:ye,event:J});if(se.error)return se;me=Ee.qualifyingPositions,ce+=Le,Ne+=1}ye+=1}}let Me=I&&c?.participants?.filter(({participantId:ce})=>!pe.includes(ce)).filter(ne).filter(le).slice(0,b||$-Z||y).map(ce=>ce.participantId);if(d&&Me?.length){let ce=Qo({participantIds:Me,autoEntryPositions:!1,entryStatus:Gs,tournamentRecord:c,event:J});if(ce.error)return ce.error}let Pe=j||K;c&&M&&M<=pe.length&&Ce(1,M+1).forEach((ce,ye)=>{let be={scaleName:Pe,scaleDate:f,scaleType:U2,scaleValue:ce,eventType:_},Fe=pe[ye];Kv({tournamentRecord:c,participantId:Fe,scaleItem:be})});let Be=iT({...Oe(p,!1,!0),tournamentRecord:c,seedingScaleName:Pe,matchUpFormat:v,eventId:V,isMock:d,event:J});if(Be.error)return Be;if(!Be.drawDefinition)return{error:_a};let{drawDefinition:fe}=Be,Te=fe.drawId;if(Array.isArray(D)&&D.filter(ml).forEach(ce=>Ft({element:fe,extension:ce})),T){if(rT({drawDefinition:fe,event:J,suppressNotifications:!0}),p.withPlayoffs){let ye=fe.structures?.[0].structureId,be=cN({...p.withPlayoffs,tournamentRecord:c,drawDefinition:fe,structureId:ye,idPrefix:k,isMock:d,event:J});if(be?.error)return be}let ce=p.automated===!1;if(d&&!ce){let ye=be=>{let Fe=oE({completeAllMatchUps:be.completeAllMatchUps,completionGoal:be.completionGoal,matchUpStatusProfile:n,randomWinningSide:l,tournamentRecord:c,drawDefinition:fe,matchUpFormat:v,event:J});if(Fe.error)return Fe;let we=Fe.completedCount;if(w===gu){let Ne=fe.structures?.find(Le=>Le.stage===Ae);if(!Ne)return{error:vi};qv({structureId:Ne.structureId,tournamentRecord:c,drawDefinition:fe});let me=E?E-(we??0):void 0,Ee=oE({completionGoal:E?me:void 0,matchUpStatusProfile:n,completeAllMatchUps:a,randomWinningSide:l,tournamentRecord:c,drawDefinition:fe,matchUpFormat:v,event:J});if(Ee.error)return Ee}};if(E&&ye({completionGoal:E}),p.outcomes){let{matchUps:be}=An({inContext:!0,drawDefinition:fe,event:J});for(let Fe of p.outcomes){let{matchUpStatus:we=Oi,matchUpStatusCodes:Ne,stageSequence:me=1,matchUpIndex:Ee=0,structureOrder:Le,matchUpFormat:Q,drawPositions:se,roundPosition:oe,stage:ue=Ae,roundNumber:ee,winningSide:Se,scoreString:De}=Fe,it=be?.reduce((qe,bi)=>{let{structureId:oi,matchUpId:nn}=bi;return qe[oi]?qe[oi].push(nn):qe[oi]=[nn],qe},{})??[],Ue=Object.assign({},...Object.keys(it).map((qe,bi)=>({[qe]:bi+1}))),ut=be?.filter(qe=>(!ue||qe.stage===ue)&&(!me||qe.stageSequence===me)&&(!ee||qe.roundNumber===ee)&&(!oe||qe.roundPosition===oe)&&(!Le||Ue[qe.structureId]===Le)&&(!se||Li(se,qe.drawPositions).length===2))?.[Ee],yi=Que({matchUpStatusCodes:Ne,tournamentRecord:c,drawDefinition:fe,targetMatchUp:ut,matchUpFormat:Q,matchUpStatus:we,scoreString:De,winningSide:Se});if(yi?.error)return yi}}a&&ye({completeAllMatchUps:a})}F&&ty({tournamentRecord:c,event:J})}else{let ce=zN({drawEntries:fe.entries,drawName:A||w,qualifyingPositions:S,drawId:Te,event:J,stage:L});if(ce.error)return ce}return{...W,event:je(J),uniqueParticipantIds:te,targetParticipants:Y,drawDefinition:fe,eventId:V,drawId:Te}}var rce=()=>({altitude:void 0,courtId:void 0,courtName:"",courtDimensions:void 0,latitude:void 0,longitude:void 0,surfaceCategory:void 0,surfaceType:void 0,surfacedDate:void 0,indoorOutdoor:void 0,floodlit:void 0,dateAvailability:[],onlineResources:[],pace:void 0,notes:void 0}),NWe=rce;function oA({tournamentRecord:t,disableNotice:e,venueId:i,courtId:r,court:n}){let{venue:a}=Ou({tournamentRecord:t,venueId:i});if(!a)return{error:gf};a.courts||(a.courts=[]);let s={...rce(),venueId:i,courtId:r};if(s.courtId||(s.courtId=Ct()),a.courts.some(o=>o.courtId===s.courtId))return{error:lie};{let o=(n?.dateAvailability||[]).map(c=>({...c,date:Ze(c.date),startTime:pi(c.startTime),endTime:pi(c.endTime),bookings:c.bookings?.map(({startTime:d,endTime:p,bookingType:f})=>({startTime:pi(d),endTime:pi(p),bookingType:f}))})),l=Object.keys(s);for(let c of l)if(n?.[c])if(c==="dateAvailability"){let d=YM({dateAvailability:o});if(!d.valid&&d.error)return d;s.dateAvailability=o}else s[c]=n[c];let u=s;return a.courts.push(u),e||st({payload:{venue:a,tournamentId:t.tournamentId},topic:Vc,key:a.venueId}),{...W,court:Oe(s),venueId:i}}}function fG(t){let{tournamentRecord:e,venueId:i}=t;if(typeof i!="string"||!i)return{error:zd};let r=t.tournamentRecords??(e&&{[e.tournamentId]:e})??{},n=[],a;for(let s of Object.values(r)){let{venue:o}=Ou({tournamentRecord:s,venueId:i});if(o){let l=AWe({...t,tournamentRecord:s});for(let u of l?.courts??[])n.push(u?.courtId);if(l.error)return l;a=!0}}return a?{...W,courtIds:n}:{error:gf}}function AWe({courtNameRoot:t="Court",dateAvailability:e=[],venueAbbreviationRoot:i,tournamentRecord:r,courtNames:n=[],courtTimings:a,courtsCount:s,startTime:o,courtIds:l,endTime:u,idPrefix:c,venueId:d,dates:p}){if(!d)return{error:zd};let f=Ou({tournamentRecord:r,venueId:d});if(f.error)return f;let{venue:m}=f;if(!Ai(s)||!n)return{error:oie};s=s??n.length;let h=Ce(0,s).map(g=>{let I=a?.[g],v=I?p.map(w=>({date:Bs(w),startTime:o,endTime:u,...I})):e;return I&&o&&u&&v.push({startTime:o,endTime:u}),{courtName:n[g]||i&&m?.venueAbbreviation&&`${m?.venueAbbreviation} ${g+1}`||`${t} ${g+1}`,dateAvailability:v}}).map((g,I)=>{let v=l?.pop()||c&&`${c}-${I+1}`;return oA({disableNotice:!0,tournamentRecord:r,courtId:v,venueId:d,court:g})}).map(g=>g.court).filter(Boolean);return h.length!==s?q({info:"not all courts could be generated",result:{error:re}}):(m&&st({payload:{venue:m,tournamentId:r.tournamentId},topic:Vc,key:m.venueId}),{...W,courts:Oe(h)})}function mG({tournamentRecord:t,ignoreExistingVenues:e,venueProfiles:i,uuids:r}){let{startDate:n,endDate:a}=t,s=[];for(let[o,l]of i.entries()){let{venueAbbreviation:u,venueId:c=r?.pop()??Ct(),dateAvailability:d,venueDateAvailability:p,defaultStartTime:f,defaultEndTime:m,startTime:h="07:00",endTime:g="19:00",courtTimings:I,courtsCount:v,courtNames:w,venueName:y,idPrefix:b,courtIds:S}=l,U={venueName:y||`Venue ${o+1}`,venueAbbreviation:u,venueId:c};f&&(U.defaultStartTime=f),m&&(U.defaultEndTime=m),l.isPrimary&&(U.isPrimary=!0),p&&(U.dateAvailability=p);let T=RU({tournamentRecord:t,venue:U});if(T.error){if(e)continue;return T}s.push(c);let P=wI(n,a),D=!Array.isArray(d)&&[{startTime:h,endTime:g}].concat(P.map(E=>({date:Bs(E),startTime:h,endTime:g})));if(v||w){let E=fG({dateAvailability:d||D,tournamentRecord:t,courtTimings:I,courtsCount:v,courtNames:w,startTime:h,idPrefix:b,courtIds:S,endTime:g,venueId:c,dates:P});if(E.error)return E}}return s}function kWe(t){let{tournamentRecord:e,leagueProfiles:i,eventIds:r,venueIds:n,drawIds:a,allUniqueParticipantIds:s,uuids:o}=t,l=0;for(let c of i){let d=[],{tieFormatName:p=LP,teamProfiles:f=[],teamsCount:m=0,category:h,idPrefix:g,gender:I}=c,v=c.leagueName??c.eventName??`League ${l+1}`,w=c.leagueId??c.eventId??o?.pop()??Ct();r.push(w);let y=wt(c.tieFormat)&&c.tieFormat||yc({event:{eventId:w,category:h,gender:I},namedFormat:p,isMock:t.isMock})||void 0;if(!y)return{error:Mv};let b=Math.max(m,f.length),S=Ce(0,b),{genders:U,teamSize:T}=cG({tieFormat:y,drawSize:b}),P={[zr]:0,[Oh]:0,[zu]:0,[tr]:0,ANY:0};Object.keys(U).forEach(E=>P[E]+=U[E]);for(let E of S){let R=f?.[E]?.teamName??`Team ${E+1}`,C=f?.[E]?.teamId||o?.pop()||Ct(),M=c.startDate??t.startDate,N=ay({...c?.participantsProfile,participantsCount:T,consideredDate:M,gendersCount:P,category:h,uuids:o}).participants,A=N.map($=>$.participantId),O=_t,k=C??aE({participantType:O,idPrefix:g,index:E,uuids:o});d.push({participantId:k,entryStatus:ua,entryStage:Ae});let F=f?.[E]?.venueIds??[],x={participantId:k,participantRole:Jr,participantName:R,individualParticipantIds:A,participantType:O,homeVenueIds:F};F.forEach($=>!n.includes($)&&n.push($)),s.push(...A,k);let L=no({participants:[x,...N],tournamentRecord:e});if(L.error)return L}let D={eventName:v,entries:d,eventType:_t,tieFormat:y,category:h,eventId:w,gender:I};if(e.events||(e.events=[]),e.events.push(D),d.length){let E=(Ai(c.roundsCount)&&c.roundsCount)??c.roundsCount===TFe?(b-1)*2:b-1,R=iT({automated:c.automated,tournamentRecord:e,drawType:la,roundsCount:E,drawSize:b,event:D});if(R.error)return R;let{drawDefinition:C}=R;if(C){let M=C?.drawId;rT({drawDefinition:C,event:D,suppressNotifications:!0}),a.push(M)}}l++}let u=n.map(c=>({venueId:c}));mG({tournamentRecord:e,ignoreExistingVenues:!0,venueProfiles:u,uuids:o})}var OWe=["Generated Tournament","CourtHive Challenge","Replication Crisis","Open Competition","Factory Follies","Mock Tournament","Atomic Culture","Racket Rally","Stats Fail"];function nce(t){let{startDate:e,endDate:i}=t??{},{tournamentName:r=ha(OWe),ratingsParameters:n=Dr,tournamentExtensions:a,policyDefinitions:s,schedulingProfile:o,venueProfiles:l,uuids:u}=t??{},c=t?.isMock===!1?void 0:!0;if(e&&!Mn(e)||i&&!Mn(i))return{error:or};if(t.leagueProfiles&&!Array.isArray(t.leagueProfiles)||t.eventProfiles&&!Array.isArray(t.eventProfiles)||t.drawProfiles&&!Array.isArray(t.drawProfiles))return{error:re};if(!e){let v=new Date;e=Bs(i??v),i=Bs(v.setDate(v.getDate()+7))}if(!i){let v=new Date(e);i=Bs(v.setDate(v.getDate()+7))}let d=aA({...t.tournamentAttributes??{},tournamentName:r,startDate:e,endDate:i,isMock:c}),p=l?.length?mG({tournamentRecord:d,venueProfiles:l,uuids:u}):[];if(a?.length&&Array.isArray(a)){let v=a.filter(w=>ml({extension:w}));v?.length&&Object.assign(d,{extensions:v,isMock:c})}if(typeof s=="object")for(let v of Object.keys(s))qp({policyDefinitions:{[v]:s[v]},tournamentRecord:d});if(!t?.leagueProfiles?.length||t.eventProfiles?.length||t.drawProfiles?.length||t.participantsProfile){let v=Kue({tournamentRecord:d,...t});if(!v.success)return v}let f=[],m=[],h=[];if(t.leagueProfiles){let v=kWe({allUniqueParticipantIds:f,tournamentRecord:d,...t,eventIds:m,venueIds:p,drawIds:h});if(v?.error)return v}if(t.drawProfiles){let v=xWe({allUniqueParticipantIds:f,ratingsParameters:n,tournamentRecord:d,...t,eventIds:m,drawIds:h});if(v?.error)return v}if(t.eventProfiles){let v=FWe({allUniqueParticipantIds:f,ratingsParameters:n,tournamentRecord:d,...t,eventIds:m,drawIds:h});if(v?.error)return v}let{scheduledRounds:g=void 0,schedulerResult:I={}}=o?LWe({...t,tournamentRecord:d}):{};return bB(),je({...W,tournamentRecord:d,scheduledRounds:g,schedulerResult:I,eventIds:m,venueIds:p,drawIds:h})}function xWe(t){let{tournamentRecord:e,drawProfiles:i,allUniqueParticipantIds:r,eventIds:n,drawIds:a}=t,s=0;for(let o of i){let l=sA({allUniqueParticipantIds:r,tournamentRecord:e,drawProfile:o,drawIndex:s,...t});if(l.error)return l;let{drawId:u,eventId:c,event:d,uniqueParticipantIds:p}=l;if(o?.addEvent!==!1){if(l=Zv({suppressNotifications:!1,internalUse:!0,tournamentRecord:e,event:d}),l.error)return l;u&&a.push(u),n.push(c)}p?.length&&r.push(...p),s+=1}}function FWe(t){let{eventProfiles:e,allUniqueParticipantIds:i,eventIds:r,drawIds:n}=t,a=0;for(let s of e){let o=ice({...t,eventIndex:a,eventProfile:s});if(o.error)return o;let{eventId:l,drawIds:u,uniqueParticipantIds:c}=o;u&&n.push(...u),r.push(l),c?.length&&i.push(...c),a+=1}}function LWe(t){let{schedulingProfile:e,tournamentRecord:i,autoSchedule:r,periodLength:n,scheduleCompletedMatchUps:a}=t,s=MWe({schedulingProfile:e,tournamentRecord:i});if(s.error)return s;let o=s.scheduledRounds;if(r){let{tournamentId:l}=i,u={[l]:i};return{schedulerResult:rA({scheduleCompletedMatchUps:a,tournamentRecords:u,periodLength:n}),scheduledRounds:o}}return{scheduledRounds:o}}var ace={};dt(ace,{anonymizeTournamentRecord:()=>sce,modifyTournamentRecord:()=>lce});function sce({keepExtensions:t=[],anonymizeParticipantNames:e=!0,tournamentRecord:i,tournamentName:r,personIds:n=[],tournamentId:a}){if(!i)return{error:ve};let s=Array.isArray(t)?qz.concat(...t):qz,o=k=>Array.isArray(t)?k?.extensions?.filter(F=>s.includes(F.name)):k?.extensions,l={};i.extensions=o(i);let u=a||Ct();l[i.tournamentId]=u,i.tournamentId=u,i.createdAt=new Date().toISOString(),i.tournamentName=r||`Anonymized: ${Bs(new Date)}`,i.isMock=!0,delete i.parentOrganisation;for(let k of i.participants||[]){k.extensions=o(k),k.onlineResources=[];let F=Ct();l[k.participantId]=F,k.participantId=F}for(let k of i.participants||[])Array.isArray(k.individualParticipantIds)&&(k.individualParticipantIds=k.individualParticipantIds.map(F=>l[F]));let c=0;for(let k of i.venues||[]){k.venueAbbreviation=`V${c}`,k.extensions=o(k),k.venueName=`Venue #${c}`,k.onlineResources=[],k.addresses=[];let F=Ct();l[k.venueId]=F,k.isMock=!0,c+=1;let x=0;for(let L of k.courts||[])L.courtName=`V${c}C${x}`,L.extensions=o(L),L.onlineResources=[],L.isMock=!0,x+=1}let d=1;for(let k of i.events||[]){k.extensions=o(k),k.onlineResources=[],k.isMock=!0;let F=Ct();l[k.eventId]=F,k.eventId=F;let x=k.category?.categoryName||k.category?.ageCategoryCode||k.category?.ratingType||k.gender;if(k.eventName=`Event ${d} ${x}`,Array.isArray(k.entries))for(let $ of k.entries)$.participantId=l[$.participantId];for(let $ of k.drawDefinitions||[]){$.extensions=o($);let V=Ct();if(l[$.drawId]=V,$.drawId=V,$.isMock=!0,Array.isArray($.entries))for(let B of $.entries)B.participantId=l[B.participantId];let _=B=>{B.extensions=o(B);let G=Ct();l[B.structureId]=G,B.structureId=G;for(let j of B.positionAssignments||[])j.participantId&&(j.participantId=l[j.participantId]);for(let j of B.seedAssignments||[])j.participantId&&(j.participantId=l[j.participantId]);for(let j of B.matchUps||[]){j.isMock=!0;for(let K of j.sides||[])K.lineUp&&(K.lineUp=K.lineUp.map(({participantId:Y,collectionAssignments:X})=>({participantId:l[Y],collectionAssignments:X})))}};for(let B of $.structures||[])if(_(B),Array.isArray(B.structures))for(let G of B.structures)_(G);for(let B of $.links||[])B.source.structureId=l[B.source.structureId],B.target.structureId=l[B.target.structureId]}let{extension:L}=ht({name:to,element:k});Array.isArray(L?.value?.flights)&&L?.value.flights?.forEach($=>{if($.drawId=l[$.drawId],Array.isArray($.drawEntries))for(let V of $.drawEntries)V.participantId=l[V.participantId]}),d+=1}let p=i.startDate||Bs(new Date),f=(i.participants||[]).filter(({participantType:k})=>k===It),m=f.reduce((k,F)=>{let x=F.person?.sex,L=ln(x);return L&&cl(x)?k[L]+=1:k[zu]+=1,k},{[tr]:0,[zr]:0,[zu]:0}),h=Object.assign({},...Object.keys(m).map(k=>({[k]:Yue({category:{ageCategoryCode:"O18"},count:m[k],personExtensions:[],consideredDate:p,sex:k})?.persons||[]}))),g={[tr]:0,[zr]:0,[zu]:0},I=f.length,v=f.reduce((k,F)=>{let x=F.person?.addresses?.[0]||{},{city:L,state:$,postalCode:V}=x;return k.cities.includes(L)||k.cities.push(L),k.states.includes($)||k.states.push($),k.postalCodes.includes(V)||k.postalCodes.push(V),k},{cities:[],postalCodes:[],states:[]}),w=v.postalCodes.length,y=v.cities.length,b=v.states.length,{cities:S}=Hue({count:y||I,participantsCount:I}),{states:U}=Wue({count:b||I,participantsCount:I}),{postalCodes:T}=zue({count:w||I,participantsCount:I}),P={cities:S,states:U,postalCodes:T};f.forEach((k,F)=>{let x=k?.person,L=x?.sex||zu,$=Ze(x?.birthDate)?.split("-")[0],V=g[L],_=h[L][V];if(g[L]+=1,$){let[,B,G]=_?.birthDate?.split("-")||[],j=[$,B,G].join("-");_.birthDate=j}if(x?.addresses){let B=que({...P,participantIndex:F,nationalityCode:_.nationalityCode});_.addresses=[B]}_.personId=n?.[F]||Ct(),e?(_.standardFamilyName=_.lastName,_.standardGivenName=_.firstName,k.participantName=`${_.standardGivenName} ${_.standardFamilyName}`):(_.standardFamilyName=x?.standardFamilyName,_.standardGivenName=x?.standardGivenName),delete _.firstName,delete _.lastName,_.extensions=o(x),k.person=_,l[x?.personId]=_.personId}),(i.participants||[]).filter(({participantType:k})=>k===ft).forEach(k=>{let{individualParticipantIds:F}=k;k.participantName=_We({individualParticipantIds:F,individualParticipants:f})});let D=(i.participants||[]).filter(({participantType:k})=>k===_t),E=D.length,R=sE({count:E}).names;D.forEach((k,F)=>{k.participantName=R[F]});let C=(i.participants||[]).filter(({participantType:k})=>k===Ya),M=C.length,N=sE({count:M,nameRoot:"Group"}).names;C.forEach((k,F)=>{k.participantName=N[F]});let{extension:A}=ht({element:i,name:Gm});Array.isArray(A?.value)&&A?.value.forEach(k=>{k.tournamentId=l[k.tournamentId],k.structureId=l[k.structureId],k.eventId=l[k.eventId],k.drawId=l[k.drawId]});let{extension:O}=ht({element:i,name:_v});return Array.isArray(O?.value)&&O?.value.forEach(k=>{k.personId=l[k.personId]}),{...W}}function _We({individualParticipantIds:t,individualParticipants:e}){let i=e.filter(({participantId:r})=>t.includes(r)).map(({person:r})=>r?.standardFamilyName).filter(Boolean).sort().join("/");return t.length===1&&(i+="/Unknown"),i}function $We({event:t,eventProfile:e,tournamentRecord:i,allUniqueParticipantIds:r,drawIds:n}){let{gender:a,category:s,eventType:o}=t,{drawProfiles:l,publish:u}=e,c=Pi(pl)(o)&&It||Pi(fs)(o)&&ft||o;if(l){let{stageParticipantsCount:d,uniqueParticipantsCount:p,uniqueParticipantStages:f}=Xue({drawProfiles:l,category:s,gender:a}),{uniqueDrawParticipants:m=[],uniqueParticipantIds:h=[]}=f?ece({event:{eventType:o,category:s,gender:a},uniqueParticipantsCount:p,participantsProfile:e.participantsProfile,ratingsParameters:e.ratingsParameters,tournamentRecord:i,eventProfile:e,uuids:e.uuids}):{};r.push(...h);let{stageParticipants:g}=Jue({targetParticipants:i.participants||[],allUniqueParticipantIds:r,stageParticipantsCount:d,eventParticipantType:c}),I=tce({uniqueDrawParticipants:m,autoEntryPositions:e.autoEntryPositions,stageParticipants:g,tournamentRecord:i,drawProfiles:l,category:s,gender:a,event:t});if(I.error||(I=Zue({matchUpStatusProfile:e.matchUpStatusProfile,completeAllMatchUps:e.completeAllMatchUps,randomWinningSide:e.randomWinningSide,tournamentRecord:i,drawProfiles:l,isMock:e.isMock,event:t}),I.error))return I;n.push(...I.drawIds)}return u&&ty({tournamentRecord:i,event:t}),W}function oce(t,e){return t?.find((i,r)=>e.eventIndex!==void 0&&r===e.eventIndex||e.eventName&&i.eventName===e.eventName||e.eventId&&i.eventId===e.eventId)}function BWe({event:t,eventProfile:e,tournamentRecord:i,allUniqueParticipantIds:r,drawIds:n,params:a}){return $We({event:t,eventProfile:{...e,...a},tournamentRecord:i,allUniqueParticipantIds:r,drawIds:n})}function VWe({eventProfile:t,tournamentRecord:e,allUniqueParticipantIds:i,eventIds:r,drawIds:n,params:a,eventIndex:s}){let o=ice({startDate:e.startDate,allUniqueParticipantIds:i,matchUpStatusProfile:a.matchUpStatusProfile,participantsProfile:a.participantsProfile,completeAllMatchUps:a.completeAllMatchUps,autoEntryPositions:a.autoEntryPositions,randomWinningSide:a.randomWinningSide,ratingsParameters:t.ratingsParameters,tournamentRecord:e,eventProfile:t,eventIndex:s,uuids:a.uuids});if(o.error)return o;let{eventId:l,drawIds:u,uniqueParticipantIds:c}=o;return u&&n.push(...u),r.push(l),c?.length&&i.push(...c),{eventIndexIncrement:1}}function jWe({eventProfiles:t,tournamentRecord:e,allUniqueParticipantIds:i,eventIds:r,drawIds:n,params:a}){let s=e.events?.length||0;for(let o of t){let l=oce(e.events,o);if(l){let u=BWe({event:l,eventProfile:o,tournamentRecord:e,allUniqueParticipantIds:i,drawIds:n,params:a});if(u?.error)return u}else{let u=VWe({eventProfile:o,tournamentRecord:e,allUniqueParticipantIds:i,eventIds:r,drawIds:n,params:a,eventIndex:s});if(u?.error)return u;s+=u?.eventIndexIncrement||1}}return W}function GWe({drawProfiles:t,tournamentRecord:e,allUniqueParticipantIds:i,eventIds:r,drawIds:n,params:a}){let s=(e.events||[]).flatMap(o=>o.drawDefinitions?.map(()=>1)||[]).reduce((o,l)=>o+l,0);for(let o of t){let l=sA({startDate:e.startDate,allUniqueParticipantIds:i,matchUpStatusProfile:a.matchUpStatusProfile,participantsProfile:a.participantsProfile,completeAllMatchUps:a.completeAllMatchUps,autoEntryPositions:a.autoEntryPositions,hydrateCollections:a.hydrateCollections,randomWinningSide:a.randomWinningSide,ratingsParameters:a.ratingsParameters,tournamentRecord:e,drawProfile:o,drawIndex:s,uuids:a.uuids});if(l.error)return l;let{drawId:u,eventId:c,event:d,uniqueParticipantIds:p}=l;if(l=Zv({tournamentRecord:e,event:d,internalUse:!0}),l.error)return l;u&&n.push(u),r.push(c),p?.length&&i.push(...p),s+=1}return W}function HWe({schedulingProfile:t,autoSchedule:e,periodLength:i,tournamentRecord:r}){let n=[],a={};if(t?.length){let s={[r.tournamentId]:r},o=Jv({tournamentRecords:s,schedulingProfile:t});if(o.error)return o;if(e){let{tournamentId:l}=r,u={[l]:r};a=rA({tournamentRecords:u,periodLength:i})}}return{scheduledRounds:n,schedulerResult:a}}function lce(t){let{participantsProfile:e={},schedulingProfile:i,tournamentRecord:r,autoSchedule:n,eventProfiles:a,periodLength:s,venueProfiles:o,drawProfiles:l,uuids:u}=t;if(!r)return{error:ve};let c=[],d=[],p=[];a?.forEach(w=>{let y=oce(r.events,w);y?.gender&&(w.gender=y.gender)});let f=r.participants?.length||void 0;f&&e?.idPrefix&&(e.idPrefix=`${e.idPrefix}-${f}`);let m=Kue({startDate:r.startDate,participantsProfile:e,tournamentRecord:r,eventProfiles:a,drawProfiles:l,uuids:u});if(!m.success)return m;if(a){let w=jWe({eventProfiles:a,tournamentRecord:r,allUniqueParticipantIds:c,eventIds:d,drawIds:p,params:t});if(w.error)return w}if(l){let w=GWe({drawProfiles:l,tournamentRecord:r,allUniqueParticipantIds:c,eventIds:d,drawIds:p,params:t});if(w.error)return w}let h=o?.length?mG({tournamentRecord:r,venueProfiles:o}):[],g=HWe({tournamentRecord:r,schedulingProfile:i,autoSchedule:n,periodLength:s});if(g.error)return g;let{scheduledRounds:I,schedulerResult:v}=g;return{totalParticipantsCount:r.participants.length,scheduledRounds:I,schedulerResult:v,...W,eventIds:d,venueIds:h,drawIds:p}}var uce={};dt(uce,{addDynamicRatings:()=>PV,addIndividualParticipantIds:()=>XN,addParticipant:()=>Il,addParticipants:()=>no,addPenalty:()=>Mce,addPersonRequests:()=>hce,addPersons:()=>Nce,createGroupParticipant:()=>wce,createTeamsFromParticipantAttributes:()=>uG,deleteParticipants:()=>qh,filterParticipants:()=>OU,findParticipant:()=>bce,getCompetitionParticipants:()=>ZV,getPairedParticipant:()=>ro,getParticipantEventDetails:()=>ej,getParticipantMembership:()=>tj,getParticipantScaleItem:()=>Wm,getParticipantSchedules:()=>ij,getParticipantSignInStatus:()=>rj,getParticipantTimeItem:()=>m2,getParticipants:()=>Ri,getScaleValues:()=>Fv,mergeParticipants:()=>Cce,modifyIndividualParticipantIds:()=>gce,modifyParticipant:()=>JN,modifyParticipantName:()=>Sce,modifyParticipantOtherName:()=>vce,modifyParticipantsSignInStatus:()=>Ice,modifyPenalty:()=>Ece,modifyPersonRequests:()=>fce,mutate:()=>cce,participantScaleItem:()=>Xl,query:()=>mle,regenerateParticipantNames:()=>yce,removeIndividualParticipantIds:()=>$2,removeParticipantIdsFromAllTeams:()=>eN,removePenalty:()=>Dce,removePersonRequests:()=>mce,removeRatings:()=>Tce,scaledTeamAssignment:()=>Uce,setParticipantScaleItem:()=>Kv,setParticipantScaleItems:()=>ooe,validateLineUp:()=>iN});var cce={};dt(cce,{addDynamicRatings:()=>PV,addIndividualParticipantIds:()=>XN,addParticipant:()=>Il,addParticipants:()=>no,addPenalty:()=>Mce,addPersonRequests:()=>hce,addPersons:()=>Nce,createGroupParticipant:()=>wce,createTeamsFromParticipantAttributes:()=>uG,deleteParticipants:()=>qh,findParticipant:()=>bce,mergeParticipants:()=>Cce,modifyIndividualParticipantIds:()=>gce,modifyParticipant:()=>JN,modifyParticipantName:()=>Sce,modifyParticipantOtherName:()=>vce,modifyParticipantsSignInStatus:()=>Ice,modifyPenalty:()=>Ece,modifyPersonRequests:()=>fce,regenerateParticipantNames:()=>yce,removeIndividualParticipantIds:()=>$2,removeParticipantIdsFromAllTeams:()=>eN,removePenalty:()=>Dce,removePersonRequests:()=>mce,removeRatings:()=>Tce,scaledTeamAssignment:()=>Uce,setParticipantScaleItem:()=>Kv,setParticipantScaleItems:()=>ooe});function dce(t=0){(typeof t!="number"||isNaN(t))&&(t=0);let e=new Date;return e.setHours(e.getHours()+t),e.getTime().toString(36).slice(-6).toUpperCase()}function pce({personRequests:t,personId:e,requests:i}){t[e]||(t[e]=[]);let r=i.filter(({requestType:n})=>n).map(n=>{let{date:a,startTime:s,endTime:o}=n;return n.requestType===sT&&(a=Ze(a),s=pi(s),o=pi(o),a&&s&&o)?{date:a,startTime:s,endTime:o,requestType:n.requestType}:n}).filter(Boolean);for(let n of r)n.requestId=dce(),t[e].push(n);return{mergeCount:r.length}}function hG(t){let{tournamentRecords:e,personRequests:i}=t,r=He(t,[{[pn]:!0}]);if(r.error)return r;if(!i)return{...W};let n=Object.values(e);for(let a of n){let s=a.participants??[],o=[];for(let l of Object.keys(i))if(Ud({tournamentParticipants:s,personId:l})){let u=i[l];u.length&&o.push({personId:l,requests:u})}Object.keys(o).length&&Ft({element:a,extension:{value:o,name:_v}})}return{...W}}function fce(t){let{tournamentRecords:e,requests:i,personId:r}=t,n=He(t,[{[pn]:!0},{requests:!0,[qn]:sn,[Ba]:re}]);if(n.error)return n;let a=i.map(({requestId:u})=>u).filter(Boolean),{personRequests:s}=Pf({tournamentRecords:e}),o=u=>{s&&(s[u]=s[u].map(c=>{if(!a.includes(c.requestId))return c;let d=i.find(p=>p.requestId===c.requestId);if(d.requestType)return Object.assign(c,d)}).filter(Boolean))};if(r&&s?.[r])o(r);else if(s)for(let u of Object.keys(s))o(u);let l=i.filter(u=>!u.requestId);return l.length&&pce({personRequests:s,personId:r,requests:l}),hG({tournamentRecords:e,personRequests:s})}function mce(t){let{tournamentRecords:e,requestType:i,requestId:r,personId:n,date:a}=t,s=He(t,[{[pn]:!0}]);if(s.error)return s;let{personRequests:o}=Pf({tournamentRecords:e}),l=c=>{o&&(o[c]=o[c].filter(d=>(!i||d.requestType!==i)&&(!r||d.requestId!==r)&&(!a||d.date!==a)),o?.[c]?.length||delete o[c])},u=!i&&!r&&!n&&!a;if(!u){if(n&&o?.[n])l(n);else if(o)for(let c of Object.keys(o))l(c)}return u||!o||!Object.keys(o).length?Nn({name:_v,tournamentRecords:e,discover:!0}):hG({tournamentRecords:e,personRequests:o})}function hce(t){let{tournamentRecords:e,personId:i,requests:r}=t,n=He(t,[{[pn]:!0,[NFe]:!0},{requests:!0,[qn]:sn,[Ba]:re}]);if(n.error)return n;let{personRequests:a}=Pf({tournamentRecords:e}),{mergeCount:s}=pce({personRequests:a,personId:i,requests:r});return s&&a?hG({tournamentRecords:e,personRequests:a}):{error:re}}function gce({individualParticipantIds:t,groupingParticipantId:e,tournamentRecord:i}){let r="modifyIndividualParticipantIds";if(!i)return q({result:{error:ve},stack:r});if(!e||!t)return q({result:{error:Je},stack:r});let n=i.participants||[],a=n.find(f=>f.participantId===e);if(!a)return q({result:{error:ji},stack:r});if(![_t,Ya].includes(a.participantType))return q({result:{error:Mo},context:{participantType:a.participantType},stack:r});let s=t.filter(f=>n.find(m=>m.participantId===f)?.participantType!==It);if(s.length)return q({result:{error:Ia,invalidParticipantIds:s},stack:r});let o=a.individualParticipantIds||[],l=t.filter(f=>!o.includes(f)),u=o.filter(f=>!t.includes(f)),c=XN({individualParticipantIds:l,groupingParticipantId:e,tournamentRecord:i});if(c.error)return q({result:c,stack:r});let d=$2({individualParticipantIds:u,groupingParticipantId:e,tournamentRecord:i});if(d.error)return q({result:d,stack:r});let{topics:p}=bs();if(p.includes(rn)){let f=n.find(({participantId:m})=>m===e);st({topic:rn,payload:{tournamentId:i.tournamentId,participants:[f]}})}return{...c,...d}}function Ice({tournamentRecord:t,participantIds:e,signInState:i}){if(!t)return{error:ve};if(!Array.isArray(e))return{error:Je};if(![Zb,Une].includes(i))return{error:re,signInState:i};let r=t.participants||[];if(!r.length)return{error:eU};let n=r.map(yt),a=e.filter(u=>!n.includes(u));if(a.length)return{error:re,context:{invalidParticipantIds:a}};let s=[],o=new Date().toISOString();for(let u of r){let{participantId:c}=u;if(e.includes(c)){let d=fV({duplicateValues:!1,tournamentRecord:t,participantId:c,timeItem:{itemType:gU,itemValue:i,createdAt:o}});if(d.error)return d;s.push(u)}}let{topics:l}=bs();return s.length&&l.includes(rn)&&st({topic:rn,payload:{tournamentId:t.tournamentId,participants:s}}),{...W}}function vce({tournamentRecord:t,participantId:e,participantOtherName:i}){if(!t)return{error:ve};if(!e)return{error:dr};let{participant:r}=Xd({tournamentRecord:t,participantId:e});if(!r)return{error:ji};r.participantOtherName=i;let{topics:n}=bs();return n.includes(rn)&&st({topic:rn,payload:{tournamentId:t.tournamentId,participants:[r]}}),{...W}}function Wq({personFormat:t,person:e}){let i=h=>h.replace(/\W/g,""),r=h=>/^[a-z]*$/.test(i(h)),n=h=>/^[A-Z]*$/.test(i(h)),a=h=>/^[LAST]{4}/.test(i(h)),s=h=>h.toLowerCase().indexOf("l")<h.toLowerCase().indexOf("f"),o=h=>h.indexOf(",")>=0,l=h=>h.toLowerCase().indexOf("f.")>=0,u=h=>h.toLowerCase().indexOf("f")<0,c=h=>h.indexOf(" ")>0;if(!e)return;let d=c(t)?" ":"",p=Ex(e?.standardGivenName??""),f=Ex(e?.standardFamilyName??"");if(!t)return`${p}${d}${f}`;l(t)&&!o(t)&&!s(t)&&(p=`${p[0]}.`),r(t)?(p=p.toLowerCase(),f=f.toLowerCase()):n(t)?(p=p.toUpperCase(),f=f.toUpperCase()):a(t)&&(f=f.toUpperCase());let m=`${p}${d}${f}`;return u(t)?m=f:s(t)&&(o(t)?m=`${f},${d}${p}`:m=`${f}${d}${p}`),m}function WWe({participantMap:t,participant:e,formats:i}){let{participantType:r,individualParticipantIds:n,person:a}=e,s=r&&i[r];if(r!==$n&&s){let{personFormat:o,doublesJoiner:l}=s;r===It&&(e.participantName=Wq({person:a,personFormat:o})),r===ft&&(e.participantName=n?.map(u=>{let c=t[u]?.person;return Wq({person:c,personFormat:o})}).filter(Boolean).join(l??"/"))}}function yce({tournamentRecord:t,formats:e}){if(!t)return{error:ve};if(!wt(e))return{error:Je};let i=t.participants??[],r=ite(i,"participantId");for(let n of i)WWe({participant:n,participantMap:r,formats:e});return{...W}}function bce(t){let{tournamentRecord:e,policyDefinitions:i,contextProfile:r,participantId:n,personId:a}=t,s=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(typeof n!="string"&&typeof a!="string")return{error:Je,stack:"publicFindParticipant"};let o,l;for(let u of Object.values(s)){l=u.tournamentId;let c=u.participants||[];if(o=Ud({tournamentParticipants:c,internalUse:!0,policyDefinitions:i,contextProfile:r,participantId:n,personId:a}),o)break}return{participant:o,tournamentId:l,...W}}function wce({individualParticipantIds:t=[],participantRoleResponsibilities:e,participantRole:i=Cae,tournamentRecord:r,participantId:n,groupName:a}){if(!r)return{error:ve};if(!a)return{error:Je,info:"Missing groupName"};if(!Array.isArray(t))return{info:"Invalid individualParticipantIds",error:re};let s=(Ri({participantFilters:{participantTypes:[It]},tournamentRecord:r}).participants??[]).map(c=>c.participantId);for(let c of t)if(!s.includes(c))return{error:Mo,participantId:c};let o=je({participantId:n||Ct(),participantRoleResponsibilities:e,participantName:a,individualParticipantIds:t,participantType:Ya,participantRole:i}),l=Il({participant:o,tournamentRecord:r});if(l.error)return l;let{topics:u}=bs();return u.includes(Td)&&st({topic:Td,payload:{tournamentId:r.tournamentId,participants:[o]}}),{...W,participant:Oe(o)}}function Sce({tournamentRecord:t,participantName:e,participantId:i}){if(!t)return{error:ve};if(!i)return{error:dr};if(!e)return{error:Je,info:"Missing participantName"};let{participant:r}=Xd({tournamentRecord:t,participantId:i});if(!r)return{error:ji};r.participantName=e;let{topics:n}=bs();return n.includes(rn)&&st({topic:rn,payload:{tournamentId:t.tournamentId,participants:[r]}}),{...W}}function Uce({clearExistingAssignments:t=!0,individualParticipantIds:e,reverseAssignmentOrder:i,initialTeamIndex:r=0,scaledParticipants:n=[],teamParticipantIds:a,tournamentRecord:s,scaleAttributes:o,teamNameBase:l,teamsCount:u,eventId:c,event:d}){if(!s)return{error:ve};if(!Array.isArray(a)&&!lt(u)&&!c||!lt(r)||n&&!Array.isArray(n)||o&&(typeof o!="object"||!Object.keys(o).length))return{error:re};if(!o&&!n.length||!n&&!(e&&o))return{error:Je,info:"Missing scaling details"};if(c&&!a){if(d?.eventType!==Ua)return{error:cu};a=d?.entries?.filter(({entryStatus:I})=>I===ua).map(yt)}if(!a?.length&&!u)return{info:"Missing teamParticipantIds or teamsCount",error:Je};let p=e??n.map(({participantId:I})=>I);i&&(a?.reverse(),r+=1),r>(a?.length||0)-1&&(r=0);let f=a?.slice(r).concat(...a.slice(0,r))??[],m=[];for(let I of s.participants??[]){let{participantId:v,participantType:w}=I;if(f.includes(v)){if(w!==$n)return{error:Mo,participant:I};m.push(I)}}if(u&&m.length<u){let I=u-(m?.length||0),v=l??"Team",w=Ce(0,I).map(U=>({participantName:`${v} ${U+1}`,participantType:$n,participantRole:Jr})),{participants:y=[]}=no({participants:w,returnParticipants:!0,tournamentRecord:s}),b=y.map(yt),S=s.participants?.filter(({participantId:U})=>b.includes(U))??[];m.push(...S)}if(!m.length)return{error:fB};if(t)for(let I of m)I.individualParticipantIds=[];else{let I=m.map(v=>v).flat();e?.length?p=p.filter(v=>!I.includes(v)):n=n?.filter(({participantId:v})=>!I.includes(v))}if(!e?.length&&!n?.length)return{error:fM,info:"Nothing to be done"};if(!n.length){for(let I of s.participants??[]){let{participantId:v,participantType:w}=I;if(!p.includes(v))continue;if(w!==It)return{error:Mo,participant:I};let y=Xl({scaleAttributes:o,participant:I})?.scaleItem,b=o?.accessor?y?.scaleValue?.[o?.accessor]:y?.scaleValue,S={participantId:v,scaleValue:b};n.push(S)}if(!n.length)return{error:ji}}n.sort((I,v)=>o?.sortOrder?(v?.scaleValue||0)-(I?.scaleValue||0):(I?.scaleValue||1/0)-(v?.scaleValue||1/0));for(let I of n)if(!I.participantId)return{error:re,scaledParticipant:I};let h=0;for(;h<n.length;){for(let I of m){if(h+1>n.length)break;let v=n[h];I.individualParticipantIds.push(v.participantId),h++}m.reverse()}let g=m.map(yt);for(let I of s.events??[]){if(I.eventType!==Ua)continue;let v=(I.entries??[]).filter(w=>g.includes(w.participantId));for(let w of v){let y=w.participantId,b=m.find(U=>U.participantId===y)?.individualParticipantIds;I.entries=(I.entries??[]).filter(U=>!b.includes(U.participantId)),(I.drawDefinitions??[]).forEach(U=>{U.entries=(U.entries??[]).filter(T=>!b.includes(T.participantId))});let{flightProfile:S}=Bi({event:I});(S?.flights||[]).forEach(U=>{U.drawEntries=(U.drawEntries||[]).filter(T=>!b.includes(T.participantId))})}}return{...W,scaledParticipants:n}}function Tce(t){let e=He(t,[{[hr]:!0,[$B]:!0},{ratingType:!1,[qr]:s=>Dr[s]}]);if(e.error)return e;let i=`${t.ratingType}.${GB}`,r=t.asDynamic?i:t.ratingType,n=[Sd,ld,t.eventType,r].join("."),a=t.tournamentRecord.participants??[];for(let s of a)s.timeItems&&(s.timeItems=s.timeItems.filter(o=>o.itemType!==n));return{...W}}function Dce(t){let{tournamentRecords:e}=t;if(typeof e!="object"||!Object.keys(e).length)return{error:Mi};for(let i of Object.values(e)){let r=zWe({...t,tournamentRecord:i});if(r.error&&r.error!==yI)return r}return{...W}}function zWe({tournamentRecord:t,penaltyId:e}){if(!t)return{error:ve};if(!e)return{error:lB};let i=t?.participants??[],r=[],n=!1,a;return i.forEach(s=>{let o=!1;s.penalties=(s.penalties??[]).filter(l=>(l.penaltyId===e&&(o=!0,n||(a=l,n=!0)),o&&r.push(s),l.penaltyId!==e))}),a&&st({topic:rn,payload:{tournamentId:t.tournamentId,participants:r}}),a?{...W,penalty:a}:{error:yI}}var qWe=({penaltyId:t=Ct()}={})=>({refereeParticipantId:void 0,penaltyCode:void 0,penaltyType:void 0,extensions:void 0,matchUpId:void 0,createdAt:void 0,issuedAt:void 0,notes:void 0,penaltyId:t}),Pce=qWe;function Ece(t){let{tournamentRecords:e}=t;if(typeof e!="object"||!Object.keys(e).length)return{error:Mi};for(let i of Object.values(e)){let r=YWe({...t,tournamentRecord:i});if(r.error&&r.error!==yI||r.success)return r}return{error:yI}}function YWe({tournamentRecord:t,modifications:e,penaltyId:i}){if(!t)return{error:ve};if(!e)return{error:re,modifications:e};if(!i)return{error:lB};let r=t?.participants??[],n=Object.keys(Pce()).filter(l=>l!=="penaltyId"),a=Object.keys(e).filter(l=>n.includes(l));if(!a.length)return{error:mM};let s,o=[];return r.forEach(l=>{let u=!1;l.penalties=(l.penalties??[]).map(c=>(c.penaltyId===i&&(u=!0,a.forEach(d=>Object.assign(c,{[d]:e[d]})),s||(s=c)),c)),u&&o.push(l)}),s&&st({topic:rn,payload:{tournamentId:t.tournamentId,participants:o}}),s?{...W,penalty:s}:{error:yI}}function Rce(t,e,i){return!t&&e?e:t&&!e||typeof t!="object"||typeof e!="object"?t:nt(Object.keys(t).concat(Object.keys(e))).reduce((r,n)=>{if(!e[n])r[n]=t[n];else if(!t[n])r[n]=e[n];else if(typeof t[n]!=typeof e[n])r[n]=e[n];else if(Array.isArray(t[n]))if(i===!0||Array.isArray(i)&&i.includes(n)){let a=nt(t[n].map(s=>JSON.stringify(s)).concat(e[n].map(s=>JSON.stringify(s)))).map(s=>JSON.parse(s));r[n]=a}else r[n]=e[n];else typeof t[n]=="object"?r[n]=Rce(t[n],e[n],i):r[n]=e[n];return r},{})}function Cce({participants:t=[],tournamentRecord:e,arraysToMerge:i}){if(!e)return{error:ve};e.participants||(e.participants=[]);let r=t.filter(Pa(Iu)).map(u=>({[u.participantId]:u})),n=Object.assign({},...r),a=[];e.participants=e.participants.map(u=>{if(n[u.participantId]){let c=Rce(u,n[u.participantId],i);return a.push(c),c}return u});let s=e.participants.map(Pa(Iu))||[],o=t.filter(({participantId:u})=>!s.includes(u)),{topics:l}=bs();return o.length&&(e.participants=e.participants.concat(...o),l.includes(Td)&&st({topic:Td,payload:{participants:o}})),a.length&&l.includes(rn)&&st({topic:rn,payload:{tournamentId:e.tournamentId,participants:a}}),{modifiedParticipantsCount:a.length,newParticipantsCount:o.length,...W}}function Mce(t){let{tournamentRecord:e,participantIds:i}=t,r=t.tournamentRecords??(e&&{[e.tournamentId]:e})??{},n;for(let a of Object.values(r)){let s=(Ri({tournamentRecord:a}).participants??[])?.map(yt).filter(o=>i.includes(o));s.length&&(n=KWe({...t,penaltyId:t.penaltyId??n,tournamentRecord:a,participantIds:s}).penaltyId)}return n?{...W,penaltyId:n}:{error:ji}}function KWe({refereeParticipantId:t,tournamentRecord:e,participantIds:i,penaltyCode:r,penaltyType:n,extensions:a,penaltyId:s,matchUpId:o,issuedAt:l,notes:u}){if(!e)return{error:ve};if(!i)return{error:dr};if(!n)return{error:sie};let c=(e?.participants??[]).filter(f=>i.includes(f.participantId));if(!c.length)return{error:ji};let d=new Date().toISOString(),p=Object.assign(Pce({penaltyId:s}),{refereeParticipantId:t,penaltyCode:r,penaltyType:n,matchUpId:o,createdAt:d,issuedAt:l,notes:u});return Array.isArray(a)&&a.forEach(f=>Ft({element:p,extension:f})),c.forEach(f=>{f.penalties??=[],f.penalties.push(p)}),st({topic:rn,payload:{tournamentId:e.tournamentId,participants:c}}),{...W,penaltyId:p.penaltyId}}function Nce({participantRole:t=Jr,tournamentRecord:e,persons:i}){if(!e)return{error:ve};if(!Array.isArray(i))return{error:re};if(!Object.keys(_2).includes(t))return{error:Kte};let r=new Set((e.participants||[]).map(({person:m})=>m?.personId).filter(Boolean)),n=[],a=i.filter(m=>m&&(!m.personId||!r.has(m.personId))).map(m=>(m.personId||(m.personId=Ct()),n.push(m.personId),m)),s=(m,h)=>Object.assign({},...Object.keys(m).filter(g=>!h.includes(g)).map(g=>({[g]:m[g]}))),o=a.map(m=>je({extensions:m.participantExtensions,timeItems:m.participantTimeItems,participantType:It,participantRole:t,person:s(m,["participantExtensions","participantTimeItems","pairedPersons"])})),l=0,u,c=no({participants:o,tournamentRecord:e});if(c.error)return c;u=c.addedCount||0;let d=[],p=Ri({participantFilters:{participantTypes:[It]},tournamentRecord:e})?.participants??[];if(t===Jr&&i.filter(({pairedPersons:m})=>m).forEach(({personId:m,pairedPersons:h})=>{Array.isArray(h)&&h.forEach(g=>{let I=[m,g.personId].map(v=>Ud({tournamentParticipants:p,personId:v})).filter(Boolean);if(I.length===2){let v=I.map(yt);d.push(je({extensions:g.participantExtensions,timeItems:g.timeItems,participantRole:Jr,individualParticipantIds:v,participantType:ft}))}})}),d.length){if(c=no({participants:d,tournamentRecord:e}),c.error)return c;l=c.addedCount||0}let f=u+l;return{...W,addedCount:f,newPersonIds:n}}var Ace={};dt(Ace,{bulkUpdatePublishedEventIds:()=>pj,getAllEventData:()=>fj,getCourtInfo:()=>KM,getDrawData:()=>fN,getEventData:()=>YU,getEventPublishStatus:()=>Qa,getPublishState:()=>zh,getTournamentPublishStatus:()=>kU,getVenueData:()=>MI,mutate:()=>kce,publishEvent:()=>ty,publishEventSeeding:()=>Oce,publishOrderOfPlay:()=>$ce,publishParticipants:()=>_ce,query:()=>wle,setEventDisplay:()=>WN,unPublishEvent:()=>Bce,unPublishEventSeeding:()=>xce,unPublishOrderOfPlay:()=>Lce,unPublishParticipants:()=>Fce});var kce={};dt(kce,{publishEvent:()=>ty,publishEventSeeding:()=>Oce,publishOrderOfPlay:()=>$ce,publishParticipants:()=>_ce,setEventDisplay:()=>WN,unPublishEvent:()=>Bce,unPublishEventSeeding:()=>xce,unPublishOrderOfPlay:()=>Lce,unPublishParticipants:()=>Fce});function Oce({removePriorValues:t=!0,stageSeedingScaleNames:e,seedingScaleNames:i,tournamentRecord:r,status:n=Xa,drawIds:a=[],event:s}){if(!r)return{error:ve};if(!s)return{error:ui};let o=Qa({event:s,status:n}),l=(o?.seeding?.seedingScaleNames||i)&&{...o?.seeding?.seedingScaleNames,...i},u=(o?.seeding?.stageSeedingScaleNames||e)&&{...o?.seeding?.stageSeedingScaleNames,...e},c=je({stageSeedingScaleNames:u,seedingScaleNames:l,published:!0,drawIds:a});return ey({statusObject:{seeding:c},removePriorValues:t,status:n,event:s}),st({topic:vne,payload:{tournamentId:r.tournamentId,eventId:s.eventId,drawIds:a}}),{...W}}function xce({removePriorValues:t=!0,seedingScaleNames:e,tournamentRecord:i,status:r=Xa,drawIds:n,stages:a,event:s}){if(!i)return{error:ve};if(!s)return{error:ui};let o=Qa({event:s});if(o){let l=o.seeding;if(Array.isArray(a)&&l.stageSeedingScaleNames)for(let u of a)l.stageSeedingScaleNames[u]&&delete l.stageSeedingScaleNames[u];Array.isArray(e)&&l?.seedingScaleNames&&(l.seedingScaleNames=l.seedingScaleNames.filter(u=>!e.includes(u))),Array.isArray(n)&&l?.drawIds&&(l.drawIds=l.drawIds.filter(u=>!n.includes(u))),(!Object.values(l.stageSeedingScaleNames??{}).length&&!l.seedingScaleNames?.length&&!l.drawIds?.length||!a&&!e&&!n?.length)&&(delete l.stageSeedingScaleNames,delete l.seedingScaleNames,delete l.drawIds,l.published=!1),ey({statusObject:{seeding:l},removePriorValues:t,status:r,event:s})}return st({topic:c2,payload:{tournamentId:i.tournamentId,eventId:s.eventId}}),{...W}}function Fce(t){let e=ws(t);if(!Object.keys(e).length)return{error:Mi};for(let i of Object.values(e)){let r=XWe({tournamentRecord:i,...t});if(r.error)return r}return{...W}}function XWe({removePriorValues:t=!0,tournamentRecord:e,status:i=Xa}){if(!e)return{error:ve};let r=`${Jd}.${Qd}`,{timeItem:n}=Ss({element:e,itemType:r}),a=n?.itemValue||{[i]:{}};return a[i]&&delete a[i].participants,Cl({timeItem:{itemValue:a,itemType:r},element:e,removePriorValues:t}),st({payload:{tournamentId:e.tournamentId},topic:sLe}),{...W}}function Lce(t){let e=ws(t);if(!Object.keys(e).length)return{error:Mi};for(let i of Object.values(e)){let r=JWe({tournamentRecord:i,...t});if(r.error)return r}return{...W}}function JWe({removePriorValues:t=!0,tournamentRecord:e,status:i=Xa}){if(!e)return{error:ve};let r=`${Jd}.${Qd}`,{timeItem:n}=Ss({element:e,itemType:r}),a=n?.itemValue||{[i]:{}};return a[i]&&delete a[i].orderOfPlay,Cl({timeItem:{itemValue:a,itemType:r},element:e,removePriorValues:t}),st({topic:d2,payload:{tournamentId:e.tournamentId}}),{...W}}function _ce(t){let e=ws(t);if(!Object.keys(e).length)return{error:Mi};for(let i of Object.values(e)){let r=QWe({tournamentRecord:i,...t});if(r.error)return r}return{...W}}function QWe({removePriorValues:t,tournamentRecord:e,status:i=Xa,embargo:r}){if(!e)return{error:ve};let n=`${Jd}.${Qd}`,{timeItem:a}=Ss({element:e,itemType:n}),s=a?.itemValue||{[i]:{}},o={published:!0};return r&&!rd(r)?{error:Ng}:(r&&(o.embargo=r),s[i].participants=o,Cl({timeItem:{itemValue:s,itemType:n},element:e,removePriorValues:t}),st({payload:{tournamentId:e.tournamentId},topic:bne}),{...W})}function $ce(t){let e=ws(t);if(!Object.keys(e).length)return{error:Mi};for(let i of Object.values(e)){let r=ZWe({tournamentRecord:i,...t});if(r.error)return r}return{...W}}function ZWe({scheduledDates:t=[],removePriorValues:e,tournamentRecord:i,status:r=Xa,eventIds:n=[],embargo:a}){if(!i)return{error:ve};let s=`${Jd}.${Qd}`,{timeItem:o}=Ss({element:i,itemType:s}),l=o?.itemValue||{[r]:{}},u={published:!0,scheduledDates:t,eventIds:n};return a&&!rd(a)?{error:Ng}:(a&&(u.embargo=a),l[r].orderOfPlay=u,Cl({timeItem:{itemValue:l,itemType:s},element:i,removePriorValues:e}),st({topic:yne,payload:{tournamentId:i.tournamentId,scheduledDates:t,eventIds:n}}),{...W})}function Bce({removePriorValues:t=!0,tournamentRecord:e,status:i=Xa,event:r}){if(!e)return{error:ve};if(!r)return{error:ui};let n=`${Jd}.${Qd}`,{timeItem:a}=IU({itemType:n,event:r}),s=a?.itemValue||{[i]:{}};return delete s[i].structureIds,delete s[i].drawDetails,delete s[i].drawIds,Jh({event:r,timeItem:{itemValue:s,itemType:n},removePriorValues:t}),ey({statusObject:{structureIds:void 0,drawIds:void 0,seeding:void 0},removePriorValues:t,status:i,event:r}),st({topic:u2,payload:{tournamentId:e.tournamentId,eventId:r.eventId}}),{eventId:r.eventId,...W}}var gG={};dt(gG,{applyTournamentRankingPoints:()=>Wce,generateRankingList:()=>jce,getAwardPoints:()=>tE,getAwardProfile:()=>cj,getParticipantPoints:()=>Gce,getQualityWinPoints:()=>uj,getTournamentPoints:()=>Xv,mutate:()=>Hce,query:()=>Vce});var Vce={};dt(Vce,{generateRankingList:()=>jce,getAwardPoints:()=>tE,getAwardProfile:()=>cj,getParticipantPoints:()=>Gce,getQualityWinPoints:()=>uj,getTournamentPoints:()=>Xv});function lE({awards:t,pointComponents:e,bestOfCount:i,maxResultsPerLevel:r,mandatoryRules:n}){let a=t.map(d=>{let p=0;for(let f of e)p+=typeof d[f]=="number"?d[f]:0;return{award:d,value:p}});a.sort((d,p)=>p.value-d.value);let s=a,o=[];if(r){let d={};s=[];for(let p of a){let f=p.award.level;f===void 0||!r[f]?s.push(p):(d[f]=(d[f]||0)+1,d[f]<=r[f]?s.push(p):o.push(p))}}if(n?.length)return eze(s,o,i,n);let l=i>0?s.slice(0,i):s,u=[...i>0?s.slice(i):[],...o],c=l.reduce((d,p)=>d+p.value,0);return{counting:l,dropped:u,bucketTotal:c}}function eze(t,e,i,r){let n=new Set;for(let p of r){let f=new Set(p.levels),m=[];for(let g=0;g<t.length;g++){let I=t[g].award.level;I!==void 0&&f.has(I)&&m.push(g)}let h=p.bestOfCount?m.slice(0,p.bestOfCount):m;for(let g of h)n.add(g)}let a=[],s=[];for(let p=0;p<t.length;p++)n.has(p)?a.push(t[p]):s.push(t[p]);let o,l;if(i>0){let p=Math.max(0,i-a.length);o=s.slice(0,p),l=s.slice(p)}else o=s,l=[];let u=[...a,...o],c=[...l,...e],d=u.reduce((p,f)=>p+f.value,0);return{counting:u,dropped:c,bucketTotal:d}}function jce({pointAwards:t,aggregationRules:e={},categoryFilter:i,asOfDate:r}){let{rollingPeriodDays:n,countingBuckets:a,tiebreakCriteria:s=[],minCountableResults:o=0,maxResultsPerLevel:l,bestOfCount:u}=e,c=t;if(i&&(c=c.filter(m=>{if(i.ageCategoryCodes?.length){let h=m.category?.ageCategoryCode;if(!h||!i.ageCategoryCodes.includes(h))return!1}if(i.genders?.length){let h=m.category?.gender||m.gender;if(!h||!i.genders.includes(h))return!1}return!(i.eventTypes?.length&&(!m.eventType||!i.eventTypes.includes(m.eventType)))})),n&&r){let m=new Date(r);m.setDate(m.getDate()-n);let h=m.getTime();c=c.filter(g=>g.endDate?new Date(g.endDate).getTime()>=h:!0)}let d={};for(let m of c){let h=m.personId;h&&(d[h]||(d[h]=[]),d[h].push(m))}let p=[];for(let[m,h]of Object.entries(d)){let g=0,I=[],v=[],w;if(a?.length){w=[];for(let S of a){let{bucketName:U,eventTypes:T,pointComponents:P,bestOfCount:D,maxResultsPerLevel:E,mandatoryRules:R}=S,C=h;T?.length&&(C=C.filter(O=>O.eventType&&T.includes(O.eventType)));let{counting:M,dropped:N,bucketTotal:A}=lE({awards:C,pointComponents:P,bestOfCount:D,maxResultsPerLevel:E,mandatoryRules:R});g+=A,I.push(...M.map(O=>O.award)),v.push(...N.map(O=>O.award)),w.push({bucketName:U,countingResults:M.map(O=>O.award),droppedResults:N.map(O=>O.award),bucketTotal:A})}}else{let{counting:S,dropped:U,bucketTotal:T}=lE({awards:h,pointComponents:["points","qualityWinPoints"],bestOfCount:u||0,maxResultsPerLevel:l});g=T,I=S.map(P=>P.award),v=U.map(P=>P.award)}let y=I.length>=o,b={personId:m,totalPoints:g,rank:0,meetsMinimum:y,countingResults:I,droppedResults:v};w&&(b.bucketBreakdown=w),p.push(b)}p.sort((m,h)=>h.totalPoints-m.totalPoints),s.length&&p.sort((m,h)=>{if(m.totalPoints!==h.totalPoints)return h.totalPoints-m.totalPoints;for(let g of s){let I=zq(g,m,h);if(I!==0)return I}return 0});let f=1;for(let m=0;m<p.length;m++)m>0&&p[m].totalPoints===p[m-1].totalPoints?s.length>0&&s.some(h=>zq(h,p[m-1],p[m])!==0)?p[m].rank=f:p[m].rank=p[m-1].rank:p[m].rank=f,f=m+2;return p}function zq(t,e,i){switch(t){case"highestSingleResult":{let r=Math.max(0,...e.countingResults.map(n=>n.points||0));return Math.max(0,...i.countingResults.map(n=>n.points||0))-r}case"mostCountingResults":return i.countingResults.length-e.countingResults.length;case"mostWins":{let r=e.countingResults.reduce((n,a)=>n+(a.winCount||0),0);return i.countingResults.reduce((n,a)=>n+(a.winCount||0),0)-r}default:return 0}}function Gce({pointAwards:t,personId:e,aggregationRules:i={}}){let{countingBuckets:r,maxResultsPerLevel:n,bestOfCount:a}=i,s=t.filter(c=>c.personId===e);if(r?.length){let c=[],d=0;for(let p of r){let{bucketName:f,eventTypes:m,pointComponents:h,bestOfCount:g,maxResultsPerLevel:I,mandatoryRules:v}=p,w=s;m?.length&&(w=w.filter(U=>U.eventType&&m.includes(U.eventType)));let{counting:y,dropped:b,bucketTotal:S}=lE({awards:w,pointComponents:h,bestOfCount:g,maxResultsPerLevel:I,mandatoryRules:v});d+=S,c.push({bucketName:f,countingResults:y.map(U=>U.award),droppedResults:b.map(U=>U.award),bucketTotal:S})}return{buckets:c,totalPoints:d}}let{counting:o,dropped:l,bucketTotal:u}=lE({awards:s,pointComponents:["points","qualityWinPoints"],bestOfCount:a||0,maxResultsPerLevel:n});return{buckets:[{bucketName:"All",countingResults:o.map(c=>c.award),droppedResults:l.map(c=>c.award),bucketTotal:u}],totalPoints:u}}var Hce={};dt(Hce,{applyTournamentRankingPoints:()=>Wce});function Wce({tournamentRecord:t,policyDefinitions:e,participantFilters:i,scaleName:r="RANKING_POINTS",level:n,removePriorValues:a}){if(!t)return{error:ve};let s=Xv({tournamentRecord:t,policyDefinitions:e,participantFilters:i,level:n});if(s.error)return s;let{personPoints:o,pairPoints:l,teamPoints:u}=s,c={};for(let f of t.participants||[])f.person?.personId&&(c[f.person.personId]=f.participantId);let d=t.endDate,p=0;for(let[f,m]of Object.entries(o)){let h=c[f];if(!h)continue;let g={};for(let I of m){let v=I.eventType||"SINGLES";g[v]||(g[v]=[]),g[v].push(I)}for(let[I,v]of Object.entries(g)){let w=v.reduce((b,S)=>b+(S.points||0)+(S.qualityWinPoints||0)+(S.linePoints||0),0),y=Kv({tournamentRecord:t,participantId:h,scaleItem:{scaleType:vu,scaleName:r,eventType:I,scaleDate:d,scaleValue:{points:w,awards:v}},removePriorValues:a});if(y.error)return y;p++}}return{...W,personPoints:o,pairPoints:l,teamPoints:u,modificationsApplied:p}}var zce={};dt(zce,{getEntryStatusReports:()=>ize,getParticipantStats:()=>tze,getStructureReports:()=>nze,getVenuesReport:()=>cze});function tze({withCompetitiveProfiles:t,opponentParticipantId:e,withIndividualStats:i,teamParticipantId:r,tournamentRecord:n,withScaleValues:a,tallyPolicy:s,matchUps:o}){if(!n)return{error:ve};if(o&&!Array.isArray(o))return{error:sa};if(o=o??Ur({tournamentRecord:n,participantsProfile:a?{withScaleValues:a}:void 0}).matchUps,!o?.length)return{error:Nu};let l=[];e&&l.push(e),r&&l.push(r);let u=l.length?{participantIds:l}:{participantTypes:[$n]},c=Ri({participantFilters:u,tournamentRecord:n}).participants??[];if(!c.every(({participantType:U})=>U===$n))return{error:Ia};l.length||l.push(...c.map(yt));let d=new Map,p=new Map,f=new Map,m=new Map,h=(U,T="")=>p.get(U)||p.set(U,{participantName:T,participantId:U,competitorIds:[],competitiveness:{},matchUpStatuses:{},tiebreaks:[0,0],matchUps:[0,0],points:[0,0],games:[0,0],sets:[0,0]})&&p.get(U);for(let U of c){let{participantId:T,individualParticipantIds:P}=U;m.set(T,P??[]),h(T,U.participantName)}if(r&&!m.get(r))return q({result:{error:ji},context:{teamParticipantId:r}});if(e&&!m.get(e))return q({result:{error:ji},context:{opponentParticipantId:e}});let g=[],I=U=>{let T=[[],[]];for(let D of U){let E=D.participant;if(E?.participantName){d.set(E.participantId,{participantName:E.participantName,ratings:E.ratings});let R=p.get(E.participantId);R&&(R.participantName=E.participantName)}}let P=({side:D,individualParticipantIds:E})=>D.participantId&&(!E?.length||E.includes(D.participantId))&&[D.participantId]||D.participant?.individualParticipantIds?.length&&(!E?.length||Li(E,D.participant?.individualParticipantIds).length===D.participant?.individualParticipantIds?.length)&&D.participant.individualParticipantIds;if(m.size){let D=(E,R)=>{for(let C of U){if(!C.participant)continue;let M=P({individualParticipantIds:R,side:C});if(M?.length){let N=C.sideNumber;if(!N)continue;let A=[E];i&&A.push(...M),T[N-1]=A;let O=p.get(E);for(let k of M.filter(Boolean))O&&!O.competitorIds.includes(k)&&O.competitorIds.push(k)}}};if(r)(!e||U.every(E=>E.participant&&(P({individualParticipantIds:m.get(r),side:E})||P({individualParticipantIds:m.get(e),side:E}))))&&D(r,m.get(r));else for(let[E,R]of m)D(E,R)}else if(i)for(let D of U){if(!D.participant)continue;let E=P({individualParticipantIds:[],side:D}),R=D.sideNumber;R&&(T[R-1]=E)}return T};for(let U of o){if(!wt(U))return{error:sa};let{matchUpStatus:T,matchUpFormat:P,matchUpType:D,winningSide:E,score:R,sides:C}=U;if(!C||!R||D===La||T==="BYE")continue;let M=I(C);if(!M.filter(Boolean).length)continue;let N=t&&E&&PU({matchUp:U})?.competitiveness;g.push(U);let A=N2({matchUpStatus:T,matchUpFormat:P,tallyPolicy:s,winningSide:E,score:R}),O=hae({matchUpStatus:T,matchUpFormat:P,tallyPolicy:s,winningSide:E,score:R}),{pointsTally:k,tiebreaksTally:F}=gae({matchUpFormat:P,score:R});M.forEach((x,L)=>{for(let $ of x){let V=d.get($)?.participantName,_=h($,V);if(_){let B=(X,Z)=>Z.forEach((J,ae)=>_[X][ae]+=J),G=L?[...F].reverse():F,j=L?[...k].reverse():k,K=L?[...O].reverse():O,Y=L?[...A].reverse():A;if(B("tiebreaks",G),B("points",j),B("games",K),B("sets",Y),E){let X=E-1===L?0:1;_.matchUps[X]+=1}if(N){let X=N.toLowerCase();_.competitiveness[X]||(_.competitiveness[X]=[0,0]),_.competitiveness[X][L]+=1}if(T){let X=T.toLowerCase();_.matchUpStatuses[X]||(_.matchUpStatuses[X]=0),_.matchUpStatuses[X]+=1}}}})}let v=["tiebreaks","matchUps","points","games","sets"],w=["competitive","routine","decisive"],y=new Map,b=(U,T)=>(U??0)+(T??0);for(let[U,T]of p.entries()){for(let P of v){let D=T[P].reduce(b);if(D){let E=T[P][0]/D,R=`${P}Ratio`,C=parseFloat(E.toFixed(2));T[R]=C,f.set(U,!0),y.has(R)||y.set(R,[]),y.get(R)?.push(C)}}for(let P of w){let D=T.competitiveness?.[P]?.reduce(b);if(D){let E=T.competitiveness[P][0]/D,R=`${P}Ratio`,C=parseFloat(E.toFixed(2));T[R]=C}}}if(!r){let U=(T,P)=>P-T;for(let T of p.values())for(let P of v){let D=`${P}Ratio`;if(typeof T[D]=="number"){let E=y.get(D)?.sort(U).indexOf(T[D]);if(typeof E=="number"&&E>=0){let R=`${P}Rank`;T[R]=E+1}}}}let S={relevantMatchUps:g,...W};return r?(S.teamStats=p.get(r),e&&(S.opponentStats=p.get(e))):S.participatingTeamsCount=f.size,S.allParticipantStats=[...p.values()],S}function uE({participant:t,eventType:e}){let i=t?.person?.personId,r=t?.person?.personOtherIds?.[0],n=t?.person?.tennisId,a=t?.ratings?.[e]?.find(({scaleName:u})=>u==="WTN"),s=a?.scaleValue,{wtnRating:o,confidence:l}=s||{};return{timeStamp:a?.scaleDate,personOtherId:r,confidence:l,wtnRating:o,personId:i,tennisId:n}}function ize({tournamentRecord:t}){if(!t)return{error:ve};let e=t.tournamentId,{participantMap:i}=Ri({withScaleValues:!0,withEvents:!0,withSeeding:!0,tournamentRecord:t,withDraws:!0}),r=(Ur({matchUpFilters:{matchUpTypes:[dm,Lp]},tournamentRecord:t}).matchUps??[]).flatMap(({sides:f,matchUpType:m})=>f?.flatMap(h=>m===Lp?h?.participant?.individualParticipantIds:h?.participant?.participantId||h.participantId).filter(Boolean)).filter(Boolean),n=[],a={},s={},o={},l=0,u=({id:f,entry:m,eventId:h,eventType:g})=>{let{qualifyingSeeding:I,mainSeeding:v,entryStatus:w,entryStage:y,drawId:b}=m;a[f]||(a[f]=[]);let{participant:S,events:U}=i?.[f]??{},T=uE({participant:S,eventType:g}),P=U?.[h]?.ranking;w===rV&&n.push(f),a[f].push({participantType:S?.participantType,participantId:f,tournamentId:e,eventType:g,eventId:h,drawId:b,entryStatus:w,entryStage:y,...T,ranking:P,mainSeeding:v,qualifyingSeeding:I})};for(let f of t.events??[]){let m={},h=U=>{m[U]||(m[U]={count:0}),m[U].count+=1},{drawDefinitions:g=[],eventType:I,eventId:v}=f,w=g.flatMap(U=>{let{drawId:T,entries:P}=U;l+=1;let D=({stage:M,stageSequence:N})=>M===Ae&&N===1||M===ze,E=(U.structures??[]).filter(D).flatMap(({positionAssignments:M})=>M).filter(Boolean).map(({participantId:M})=>M),R=({participantId:M})=>E.includes(M),C=M=>{let{participantId:N,entryStatus:A,entryStage:O}=M;h(A);let k=i?.[N]?.draws?.[T]?.seedAssignments?.[Ae];return{qualifyingSeeding:i?.[N]?.draws?.[T]?.seedAssignments?.[ze],participantId:N,mainSeeding:k,entryStatus:A,entryStage:O,drawId:T}};return P?.filter(R).map(C)}),y=U=>{let T=U.participantId,P=i?.[T].participant.individualParticipantIds?.filter(D=>r.includes(D));return T&&{[T]:{individualParticipantIds:P}}};I===bc?(()=>{let U=Object.assign({},...w.map(y).filter(Boolean)),T=P=>{U[P.participantId].individualParticipantIds.forEach(D=>{u({id:D,eventType:I,eventId:v,entry:P})})};w.forEach(T)})():w.forEach(U=>{u({id:U?.participantId,eventType:I,eventId:v,entry:U})});let b=Object.values(m).reduce((U,T)=>U+T.count,0);Object.keys(m).forEach(U=>{m[U].pct=m[U].count/b*100}),o[v]={tournamentId:e,eventId:v,entries:w,entryStatuses:m};let S=Object.assign({},...uo.flatMap(U=>[{[U+"_count"]:m[U]?.count},{[U+"_pct"]:m[U]?.pct}]));s[v]={tournamentId:e,eventId:v,...S}}let c=Object.values(i??{}).filter(({participant:{participantType:f,participantRole:m}})=>f===It&&m===Jr),d=c.filter(({participant:f})=>!r.includes(f.participantId)).map(({participant:f})=>f.participantId),p={nonParticipatingEntriesCount:d.length,individualParticipantsCount:c.length,eventsCount:Object.values(o).length,nonParticipatingParticipantIds:d,drawDefinitionsCount:l,tournamentId:e};return{entryStatusReports:Object.values(s).flat(),participantEntryReports:Object.values(a).flat(),eventReports:Object.values(o).flat(),withDrawnParticipantIds:n,tournamentEntryReport:p}}function rze({eventType:t,matchUps:e,eventId:i,drawId:r}){let n={},a=m=>{let h=m?.matchUpFormat;h&&(n[h]||(n[h]=0),n[h]+=1)},s=e.filter(m=>i?m.eventId===i:m.drawId===r).reduce((m,h)=>(a(h),(h.sides??[]).flatMap(g=>(g?.participant?.individualParticipants||[g?.participant]).filter(Boolean)).forEach(g=>m[g.participantId]=g),m),{}),o=Object.values(s),l=o.map(m=>uE({participant:m,eventType:t})).filter(({wtnRating:m})=>m),u=(o.length-l.length)/o.length*100,c=l.reduce((m,h)=>{let{wtnRating:g,confidence:I}=h;return m.totalWTN+=g,m.totalConfidence+=I,m},{totalWTN:0,totalConfidence:0}),d=l?.length?c.totalWTN/l.length:0,p=l?.length?c.totalConfidence/l.length:0,f=Object.values(n).reduce((m,h)=>m+(h||0),0);return{matchUpFormatCounts:n,matchUpsCount:f,avgConfidence:p,pctNoRating:u,avgWTN:d}}function nze(t){let{tournamentRecord:e,extensionProfiles:i,firstFlightOnly:r,firstStageSequenceOnly:n=!0}=t;if(!e)return{error:II};let a=[],s={},o={},l=[],u=g=>I=>I.structureId===g,c=Object.assign({},...(i??[]).map(({name:g,label:I,accessor:v})=>{let w=ht({element:e,name:g})?.extension?.value,y=v?yp({element:w,accessor:v})?.value:w;return{[I??g]:y}})),d=e?.tournamentId,p=Ur({participantsProfile:{withScaleValues:!0},tournamentRecord:e}).matchUps??[],f=g=>Ss({itemType:ZB,itemSubTypes:[Yl],element:{timeItems:g}})?.timeItem?.itemValue?.scaleBasis,m=({positionManipulations:g})=>{g?.forEach(I=>{let{structureId:v,name:w}=I,y=I.drawPositions??[I.drawPosition];s[v]??=[],s[v].push(`${w}: ${y.join("/")}`)})},h=e?.events?.flatMap(({timeItems:g,drawDefinitions:I=[],extensions:v,eventType:w,eventName:y,eventId:b,category:S})=>{let U=v?.find(N=>N.name===to)?.value?.flights?.map(N=>({[N.drawId]:N.flightNumber})),T=U&&Object.assign({},...U),P=v?.find(N=>N.name===Ip),D=g?.find(N=>N.itemType===Ip),E=P?.value?.length??D?.itemValue??0,R=Object.values(T??{}),C=T&&Math.min(...R),M=f(g);return o[b]={seedingBasis:M?JSON.stringify(M):void 0,totalPositionManipulations:0,maxPositionManipulations:0,generatedDrawsCount:0,drawDeletionsCount:E,tournamentId:d,eventId:b},I.filter(N=>!r||!U||T[N.drawId]===C).flatMap(N=>{let{matchUpFormat:A,tieFormat:O,timeItems:k,extensions:F,structures:x,drawName:L,drawType:$,drawId:V}=N,{matchUpFormatCounts:_,matchUpsCount:B,avgConfidence:G,pctNoRating:j,avgWTN:K}=rze({eventType:w,matchUps:p,drawId:V}),Y=f(k)??M,X=aze({extensions:F}),Z=X?.length??0;return m({positionManipulations:X}),o[b].totalPositionManipulations+=Z,o[b].generatedDrawsCount+=1,Z>o[b].maxPositionManipulations&&(o[b].maxPositionManipulations=Z),x?.filter(J=>(J.stageSequence===1||!n)&&[ze,Ae,tn,Ti].includes(J.stage)).map(J=>{let ae=[Ae,Ti].includes(J.stage)?sze(p,J.structureId):void 0;J.stage===Ae&&a.push({eventName:y,drawName:L,structureId:J.structureId});let te=oze(ae)?.participant,ne=lze(te),le=uze(te),de=uE({participant:le?.[0]??te,eventType:w}),{personId:pe,personOtherId:ge,tennisId:Me,confidence:Pe,wtnRating:Be}=de||{},fe=uE({participant:le?.[1],eventType:w}),{personId:Te,personOtherId:ce,tennisId:ye,confidence:be,wtnRating:Fe}=fe||{},{ageCategoryCode:we,categoryName:Ne,subType:me}=S??{},Ee=J.matchUpFormat??A,Le=(_[Ee]??0)/B*100,{tieFormatName:Q,tieFormatDesc:se}=iE(O),{tieFormatName:oe,tieFormatDesc:ue}=iE(J.tieFormat),ee=se===ue,Se=!ee&&oe,De=J.tieFormat&&!ee&&ue,it=X?.filter(u(J.structureId))?.length??0;return{...c,tournamentId:d,eventId:b,structureId:J.structureId,drawId:V,eventType:w,category:me,categoryName:Ne,ageCategoryCode:we,flightNumber:T?.[V],drawType:$,stage:J.stage,seedingBasis:Y?JSON.stringify(Y):void 0,winningPersonId:pe,winningPersonOtherId:ge,winningPersonTennisId:Me,winningPersonWTNrating:Be,winningPersonWTNconfidence:Pe,winningPerson2Id:Te,winningPerson2OtherId:ce,winningPerson2TennisId:ye,winningPerson2WTNrating:Fe,winningPerson2WTNconfidence:be,winningTeamId:ne,positionManipulations:it,pctNoRating:j,matchUpFormat:Ee,pctInitialMatchUpFormat:Le,matchUpsCount:B,drawTieFormatName:Q,drawTieFormatDesc:se,tieFormatName:Se,tieFormatDesc:De,avgConfidence:G,avgWTN:K}})})});return a.forEach(({eventName:g,drawName:I,structureId:v})=>{s[v]?.length&&l.push({eventName:g,drawName:I,actions:s[v]})}),{eventStructureReports:Object.values(o),structureReports:h,flightReports:l}}function aze({extensions:t}){return t?.find(({name:e})=>e===Bg)?.value?.slice(1)}function sze(t,e){return t.find(i=>i.structureId===e&&i.finishingRound===1&&i.winningSide)}function oze(t){if(t?.sides)return t.sides.find(e=>e.sideNumber===t.winningSide)}function lze(t){return t?.participantType===$n?t.participantId:void 0}function uze(t){return t?.participantType===ft?t.individualParticipants??[]:[]}function cze({ignoreDisabled:t=!0,tournamentRecords:e,tournamentId:i,venueIds:r=[],dates:n=[]}){if(!Array.isArray(n))return{error:re,dates:n};if(!Array.isArray(r))return{error:re,venueIds:r};if(!(e&&Object.keys(e).filter(c=>!i||c===i)||[]).length)return{error:Mi};if(!n.every(Mn))return{error:or};let a=Fu({tournamentRecords:e,ignoreDisabled:t,dates:n});if(a.error)return a;let s=a?.venues?.filter(({venueId:c})=>!r?.length||r.includes(c)),o=a.courts?.reduce((c,d)=>(d.dateAvailability?.forEach(p=>{let f=p.date;c.includes(f)||c.push(f)}),c),[]).filter(c=>!n.length||n.includes(c)),l={venueIds:s?.map(({venueId:c})=>c)},{matchUps:u}=No({afterRecoveryTimes:!0,tournamentRecords:e,matchUpFilters:l});return{venuesReport:s?.map(c=>dze(o,c,u))}}function dze(t,e,i){let{venueId:r,courts:n,venueName:a}=e,s={};return t.forEach(o=>{let l=0,u=0,c=0;for(let f of n){let m=f.dateAvailability.find(g=>g.date===o),h=(m&&iy({courtDate:m}).timeSlots)?.reduce((g,I)=>{let{startTime:v,endTime:w}=I,y=Rt(w)-Rt(v);return g+y},0);h&&(c+=1),l+=h}let d=i.filter(({schedule:f})=>f.venueId===r&&pu(o,f.scheduledDate));d.forEach(({schedule:f})=>{let m=pi(f.scheduledTime),h=Qn(m,f.averageMinutes),g=Rt(h)-Rt(m);u+=g});let p=l?(u/l*100).toFixed(2):"100";s[o]={scheduledMatchUpsCount:d.length,availableCourts:c,availableMinutes:l,scheduledMinutes:u,percentUtilization:p}}),{venueId:r,venueName:a,venueReport:s}}var qce={};dt(qce,{addCourtGridBooking:()=>ade,addMatchUpCourtOrder:()=>Kj,addMatchUpEndTime:()=>Jj,addMatchUpOfficial:()=>Pue,addMatchUpResumeTime:()=>Zj,addMatchUpScheduleItems:()=>eA,addMatchUpScheduledDate:()=>QN,addMatchUpScheduledTime:()=>tp,addMatchUpStartTime:()=>Xj,addMatchUpStopTime:()=>Qj,addSchedulingProfileRound:()=>pG,allocateTeamMatchUpCourts:()=>ZN,assignMatchUpCourt:()=>tg,assignMatchUpVenue:()=>ny,bulkRescheduleMatchUps:()=>tde,bulkScheduleMatchUps:()=>oT,bulkScheduleTournamentMatchUps:()=>cw,bulkUpdateCourtAssignments:()=>Jce,calculateScheduleTimes:()=>IG,clearMatchUpSchedule:()=>rde,clearScheduledMatchUps:()=>iA,courtGridRows:()=>LN,findMatchUpFormatTiming:()=>ON,findVenue:()=>Ou,generateBookings:()=>tA,generateVirtualCourts:()=>qN,getMatchUpsToSchedule:()=>kN,getPersonRequests:()=>Pf,getProfileRounds:()=>FN,getScheduledRoundsDetails:()=>QU,getSchedulingProfile:()=>Wc,getSchedulingProfileIssues:()=>mj,matchUpScheduleChange:()=>ide,modifyMatchUpFormatTiming:()=>kj,mutate:()=>Yce,proAutoSchedule:()=>Xce,proConflicts:()=>Zce,publicFindCourt:()=>P2,query:()=>Sle,removeCourtGridBooking:()=>sde,removeEventMatchUpFormatTiming:()=>HN,removeMatchUpCourtAssignment:()=>Kce,reorderUpcomingMatchUps:()=>ede,scheduleMatchUps:()=>Qce,scheduleProfileRounds:()=>rA,setMatchUpDailyLimits:()=>nde,setMatchUpHomeParticipantId:()=>Yj,setSchedulingProfile:()=>Jv,toggleParticipantCheckInState:()=>KN,validateSchedulingProfile:()=>xN});var Yce={};dt(Yce,{addCourtGridBooking:()=>ade,addMatchUpCourtOrder:()=>Kj,addMatchUpEndTime:()=>Jj,addMatchUpOfficial:()=>Pue,addMatchUpResumeTime:()=>Zj,addMatchUpScheduleItems:()=>eA,addMatchUpScheduledDate:()=>QN,addMatchUpScheduledTime:()=>tp,addMatchUpStartTime:()=>Xj,addMatchUpStopTime:()=>Qj,addSchedulingProfileRound:()=>pG,allocateTeamMatchUpCourts:()=>ZN,assignMatchUpCourt:()=>tg,assignMatchUpVenue:()=>ny,bulkRescheduleMatchUps:()=>tde,bulkScheduleMatchUps:()=>oT,bulkScheduleTournamentMatchUps:()=>cw,bulkUpdateCourtAssignments:()=>Jce,calculateScheduleTimes:()=>IG,clearMatchUpSchedule:()=>rde,clearScheduledMatchUps:()=>iA,findMatchUpFormatTiming:()=>ON,generateBookings:()=>tA,generateVirtualCourts:()=>qN,matchUpScheduleChange:()=>ide,modifyMatchUpFormatTiming:()=>kj,proAutoSchedule:()=>Xce,proConflicts:()=>Zce,removeCourtGridBooking:()=>sde,removeEventMatchUpFormatTiming:()=>HN,removeMatchUpCourtAssignment:()=>Kce,reorderUpcomingMatchUps:()=>ede,scheduleMatchUps:()=>Qce,scheduleProfileRounds:()=>rA,setMatchUpDailyLimits:()=>nde,setMatchUpHomeParticipantId:()=>Yj,setSchedulingProfile:()=>Jv,toggleParticipantCheckInState:()=>KN,validateSchedulingProfile:()=>xN});function IG({calculateStartTimeFromCourts:t=!0,defaultRecoveryMinutes:e=0,averageMatchUpMinutes:i=90,remainingScheduleTimes:r,clearScheduleDates:n,tournamentRecords:a,periodLength:s,scheduleDate:o,startTime:l,venueIds:u,endTime:c}){if(typeof a!="object"||!Object.keys(a).length)return{error:Mi};s=s??YN({recoveryMinutes:e,averageMatchUpMinutes:i});let{courts:d,venues:p}=Fu({dates:[o],ignoreDisabled:!0,tournamentRecords:a}),f=d?.filter(D=>!u||u.includes(D.venueId));l||(l=f?.reduce((D,E)=>{let R=E.dateAvailability?.find(C=>!C.date||pu(o,C.date))?.startTime??E.startTime;return R&&(!D||Rt(R)<Rt(D))?R:D},void 0)),c||(c=f?.reduce((D,E)=>{let R=E.dateAvailability?.find(C=>!C.date||pu(o,C.date))?.endTime??E.endTime;return R&&(!D||Rt(R)>Rt(D))?R:D},void 0));let m=Object.values(a),h=Object.assign({},...m.map(D=>(D.events??[]).map(E=>{let{scheduleTiming:R}=vU({tournamentRecord:D,event:E});return{[E.eventId]:{event:E,scheduleTiming:R}}})).flat()),g=tT({sortDateMatchUps:!1,tournamentRecords:a,matchUpFilters:{scheduledDate:o,venueIds:u}}),I=g?.dateMatchUps??[],v=g?.completedMatchUps??[],w=[];w.push(...I),w.push(...v);let y={averageTimes:[{minutes:{default:i}}],recoveryTimes:[{minutes:{default:e}}]},b=w?.map(({eventId:D,schedule:E,matchUpFormat:R})=>{let{event:C,scheduleTiming:M}=h[D],N=C?.eventType,A={...M,defaultTiming:y,matchUpFormat:R},{averageMinutes:O,recoveryMinutes:k}=qM({eventType:N,timingDetails:A}),{courtId:F,venueId:x}=E,L=pi(E.scheduledTime),$=Qn(L,O);return{recoveryMinutes:k,averageMinutes:O,periodLength:s,startTime:L,endTime:$,courtId:F,venueId:x}}),S={calculateStartTimeFromCourts:t,remainingScheduleTimes:r,averageMatchUpMinutes:i,date:o,clearScheduleDates:n,periodLength:s,startTime:l,endTime:c,bookings:b,courts:f},{scheduleTimes:U}=jj(S),T=u?.length===1&&u[0]||p?.length===1&&p[0].venueId||void 0,P=w.map(vr);return{venueId:T,scheduleTimes:U,dateScheduledMatchUpIds:P}}function Kce(t){let e=He(t,[{[pn]:!0}]);if(e.error)return e;let{removePriorValues:i,tournamentRecords:r,tournamentId:n,courtDayDate:a,matchUpId:s,courtId:o,drawId:l}=t,u=r[n];if(!u)return{error:ve};let{drawDefinition:c,event:d}=ep({tournamentRecord:u,drawId:l});if(!c)return{error:$e};let p=fi({drawDefinition:c,event:d,matchUpId:s});if(p.error)return p;if(p?.matchUp?.matchUpType===La){let{itemValue:f}=Uf({timeItems:p.matchUp.timeItems??[],itemType:wu}),m=o&&f.filter(h=>h.courtId!==o);return Ea({duplicateValues:!1,removePriorValues:i,tournamentRecord:u,drawDefinition:c,matchUpId:s,timeItem:{itemType:wu,itemValue:m}})}else return tg({tournamentRecord:u,drawDefinition:c,courtDayDate:a,courtId:"",matchUpId:s})}function Xce({scheduleCompletedMatchUps:t,minCourtGridRows:e=10,tournamentRecords:i,scheduledDate:r,matchUps:n}){if(!Ka(n))return{error:re};if(n.some(({hasContext:m})=>!m))return{info:"matchUps must have { inContext: true, nextMatchUps: true }",error:pM};let a=tT({courtCompletedMatchUps:!0,withCourtGridRows:!0,minCourtGridRows:e,tournamentRecords:i,matchUpFilters:{localPerspective:!0,scheduledDate:r}});if(a.error)return a;let{rows:s}=a,o=[],l=m=>[(m.sides||[]).map(h=>[h.participantId,h.participant?.individualParticipantIds]),(m.potentialParticipants||[]).flat().map(h=>[h.participantId,h.individualParticipantIds])].flat(1/0).filter(Boolean),u=s?.reduce((m,h)=>{let g=[],I=[];Object.values(h).forEach(w=>{if(wt(w)&&(w.matchUpId&&(g.push(w.matchUpId),o.push(w)),w.sides)){let y=l(w);I.push(...y)}});let v=Object.values(h).filter(w=>wt(w)&&!w.matchUpId&&!w.isBlocked);return m.concat({matchUpIds:g,availableCourts:v,rowId:h.rowId,participantIds:I})},[]);n.filter(({matchUpStatus:m})=>m&&m!=="BYE"&&(t||!Ki.includes(m))).sort(Hh);let c=co({matchUps:n.concat(o),includeParticipantDependencies:!0,tournamentRecords:i}).matchUpDependencies,d=[],p=[];for(;n.length&&u.length;){let m=u.shift(),h=[];for(;n.length&&m.availableCourts.length;){let g=n.concat(h).map(P=>P.matchUpId),I=n.shift(),v=I?.matchUpId,w=v&&c[v].matchUpIds.concat(c[v].dependentMatchUpIds),y=v&&g.some(P=>c[v].matchUpIds.includes(P)),b=v&&p.some(P=>c[v].dependentMatchUpIds.includes(P)),S=m.matchUpIds.some(P=>w.includes(P)),U=l(I),T=m.participantIds.some(P=>U.includes(P));if(I&&!S&&!y&&!T&&!b){let P=m.availableCourts.shift();Object.assign(I.schedule,P.schedule),Object.assign(P,I),d.push(I),m.participantIds.push(...U),m.matchUpIds.push(v)}else I&&h.push(I)}n.push(...h),p.push(...m.matchUpIds)}let f=d.map(({matchUpId:m,tournamentId:h,schedule:g,drawId:I})=>({tournamentId:h,matchUpId:m,drawId:I,schedule:{...g,scheduledDate:r}}));return a=oT({tournamentRecords:i,matchUpDetails:f}),{...a,scheduled:d,notScheduled:n}}function Jce(t){let{courtDayDate:e}=t,i=He(t,[{courtAssignments:!0,[qn]:sn,[Ba]:Je},{[pn]:!0}]);if(i.error)return i;let r=t.courtAssignments.reduce((a,s)=>{let{tournamentId:o}=s;return a[o]||(a[o]=[]),a[o].push(s),a},{}),n;return Object.keys(r).every(a=>{let s=t[pn][a];if(!s)return n={error:ve},!1;let o=r[a].reduce((l,u)=>{let{drawId:c}=u;return l[c]||(l[c]=[]),l[c].push(u),l},{});Object.keys(o).every(l=>{let{drawDefinition:u}=Wn({tournamentRecord:s,drawId:l});return u?(o[l].every(c=>{let{matchUpId:d,courtId:p}=c,f=tg({tournamentRecord:s,drawDefinition:u,courtDayDate:e,matchUpId:d,courtId:p});if(f.success)return f?.success;n={error:Iie}}),!0):(n={error:$e},!1)})}),n||W}function Qce(t){let{tournamentRecords:e,allDateMatchUpIds:i=[],averageMatchUpMinutes:r=90,recoveryMinutes:n=0,recoveryMinutesMap:a,matchUpPotentialParticipantIds:s={},individualParticipantProfiles:o={},matchUpNotBeforeTimes:l={},matchUpDailyLimits:u={},checkPotentialRequestConflicts:c=!0,remainingScheduleTimes:d,clearScheduleDates:p,periodLength:f=30,scheduleDate:m,matchUpIds:h,venueIds:g,startTime:I,endTime:v,dryRun:w}=t,y=He(t,[{[pn]:!0,[cU]:!0},{[qr]:Mn,[Ba]:or,[RFe]:!0},{[qr]:B=>!B||!isNaN(B),[AFe]:!1,[Ba]:re,[kFe]:!1,[OFe]:!1}]);if(y.error)return y;let b=t.competitionMatchUps??No({nextMatchUps:!0,tournamentRecords:e}).matchUps??[],S=t.matchUpDependencies??co({includeParticipantDependencies:!0,matchUps:b,tournamentRecords:e}).matchUpDependencies;b.forEach(B=>{B.schedule?.scheduledDate&&pu(m,Ze(B.schedule.scheduledDate))&&OI({matchUpPotentialParticipantIds:s,matchUpNotBeforeTimes:l,matchUp:B})});let U=h.map(B=>b.find(G=>G.matchUpId===B)).filter(Boolean),{venueId:T,scheduleTimes:P,dateScheduledMatchUpIds:D}=IG({tournamentRecords:e,remainingScheduleTimes:d,startTime:pi(I),endTime:pi(v),scheduleDate:Ze(m),averageMatchUpMinutes:r,clearScheduleDates:p,periodLength:f,venueIds:g}),E={},R=[],C={},M={},N={};b.filter(({matchUpId:B})=>D?.includes(B)).forEach(B=>{Xx({matchUpPotentialParticipantIds:s,individualParticipantProfiles:o,matchUp:B,value:1});let G=B.schedule?.scheduledTime;if(G){C[B.matchUpId]=G;let j=a?.[B.matchUpId];uw({recoveryMinutes:j||n,matchUpPotentialParticipantIds:s,individualParticipantProfiles:o,matchUpNotBeforeTimes:l,averageMatchUpMinutes:r,matchUpDependencies:S,scheduleTime:G,matchUp:B})}});let A=U.filter(B=>{let G=D?.includes(B.matchUpId),j=["BYE",qt,Oi,Ta,Sr,ai].includes(B?.matchUpStatus);return!G&&!B.winningSide&&!j}),{matchUpMap:O,overLimitMatchUpIds:k,participantIdsAtLimit:F}=A.reduce((B,G)=>{let{drawId:j,tournamentId:K,matchUpType:Y}=G,{participantIdsAtLimit:X,relevantParticipantIds:Z}=lG({individualParticipantProfiles:o,matchUpPotentialParticipantIds:s,matchUpDailyLimits:u,matchUp:G});return X?.length?(B.overLimitMatchUpIds.push(G.matchUpId),B.participantIdsAtLimit.push(...X),B):(Z.forEach(J=>{aT({individualParticipantProfiles:o,participantId:J});let ae=o[J].counters;ae[Y]?ae[Y]+=1:ae[Y]=1,ae[Hs]?ae[Hs]+=1:ae[Hs]=1}),B.matchUpMap[K]||(B.matchUpMap[K]={}),B.matchUpMap[K][j]?B.matchUpMap[K][j].push(G):B.matchUpMap[K][j]=[G],OI({matchUpPotentialParticipantIds:s,matchUpNotBeforeTimes:l,matchUp:G}),B)},{matchUpMap:{},overLimitMatchUpIds:[],participantIdsAtLimit:[]});A=A.filter(({matchUpId:B})=>!k.includes(B));let x=0,L=P?.length??0,{personRequests:$}=Pf({tournamentRecords:e,requestType:sT});for(;P?.length&&A.length&&x<=L;){x++;let{scheduleTime:B}=P.shift(),G=A.find(j=>{let{matchUpId:K}=j,{dependenciesScheduled:Y,remainingDependencies:X}=aG({matchUpScheduleTimes:C,matchUpDependencies:S,allDateMatchUpIds:i,matchUp:j});if(!Y)return N[K]||(N[K]=[]),N[K].push({scheduleTime:B,remainingDependencies:X}),!1;let{enoughTime:Z}=oG({individualParticipantProfiles:o,matchUpNotBeforeTimes:l,matchUpDependencies:S,scheduleTime:B,matchUp:j});if(!Z)return M[K]||(M[K]=[]),M[K].push({scheduleTime:B}),!1;let{conflicts:J}=sG({potentials:c,averageMatchUpMinutes:r,requestConflicts:E,personRequests:$,scheduleTime:B,scheduleDate:m,matchUp:j});if(J?.length)return!1;let ae=a?.[j.matchUpId];return uw({recoveryMinutes:ae||n,matchUpPotentialParticipantIds:s,individualParticipantProfiles:o,matchUpNotBeforeTimes:l,averageMatchUpMinutes:r,matchUpDependencies:S,scheduleTime:B,matchUp:j}),C[j.matchUpId]=B,!0});A=A.filter(({matchUpId:j})=>j!==G?.matchUpId),G||R.push(B)}A.forEach(B=>{Xx({individualParticipantProfiles:o,matchUpPotentialParticipantIds:s,value:-1,matchUp:B})});let V=[];Object.keys(O).forEach(B=>{let G=e[B];G&&Object.keys(O[B]).forEach(j=>{let{drawDefinition:K}=ep({tournamentRecord:G,drawId:j});K&&O[B][j].forEach(({matchUpId:Y})=>{let X=C[Y];if(X){let Z=X.split(":").map(as).join(":"),J=`${Ze(m)}T${Z}`;w?V.push(Y):(tp({drawDefinition:K,matchUpId:Y,scheduledTime:J}).success&&V.push(Y),T&&ny({tournamentRecords:e,tournamentRecord:G,drawDefinition:K,matchUpId:Y,venueId:T}))}})})});let _=KB(A);return{...W,requestConflicts:Object.values(E),remainingScheduleTimes:P?.map(({scheduleTime:B})=>B),individualParticipantProfiles:o,matchUpNotBeforeTimes:l,participantIdsAtLimit:F,skippedScheduleTimes:R,overLimitMatchUpIds:k,scheduledMatchUpIds:V,noTimeMatchUpIds:_,recoveryTimeDeferred:M,dependencyDeferred:N}}function Zce({useDeepDependencies:t=!1,tournamentRecords:e,matchUps:i}){if(!Ka(i))return{error:Nu};if(i.some(({matchUpId:b,hasContext:S})=>b&&!S))return{info:"matchUps must have { inContext: true, nextMatchUps: true }",error:pM};let r=Math.max(...i.map(({schedule:b})=>b?.courtOrder||1).map(b=>Ke(b))),n=Ce(1,r+1).map(b=>i.filter(S=>Ke(S.schedule?.courtOrder)===b)),a={},s={},o={};n.flat().filter(Boolean).sort(Hh).forEach(({schedule:b})=>delete b[mD]);let l=nt(i.map(({drawId:b})=>b)),u=co({includeParticipantDependencies:!0,tournamentRecords:e,drawIds:l}),c=u.matchUpDependencies,d=t?u.positionDependencies??{}:{},p=n.map((b,S)=>b.reduce((U,T)=>{if(!T.matchUpId)return U;let{matchUpId:P,winnerMatchUpId:D,loserMatchUpId:E,schedule:R,sides:C,potentialParticipants:M}=T,N=R?.courtId;a[P]=S,s[N]=[],U.matchUpIds.push(P),o[P]=T;let A=c[P].matchUpIds;A.length&&U.sourceMatchUpIds.push(...A);let O=C?.flatMap(F=>[F.participant?.individualParticipantIds,F.participantId]).flat().filter(Boolean)??[],k=M?.flat().flatMap(({individualParticipantIds:F,participantId:x})=>[F,x]).flat().filter(Boolean)||[];return U.participantIds.push(...k,...O),D&&U.targetMatchUpIds.push(D),E&&U.targetMatchUpIds.push(E),U},{sourceMatchUpIds:[],targetMatchUpIds:[],participantIds:[],matchUpIds:[]})),f=(b,S)=>c[b].sources.reduce((U,T,P)=>T.includes(S)&&P+1||U,0),m=p.map(()=>[]),h=(b,S,U)=>{U[b]||(U[b]={}),U[b][Fl]||(U[b][Fl]=S.filter(T=>T!==b))},g=(b,S,U)=>{S.participantIds.filter(T=>b.participantIds.includes(T)).forEach(T=>{let P=S.matchUpIds.concat(b.matchUpIds).filter(D=>c[D].participantIds.includes(T));P.forEach(D=>{h(D,P,U)})})},I=(b,S,U)=>{U[b]||(U[b]={}),U[b][xl]||(U[b][xl]=S.filter(T=>T!==b))},v=b=>{let S={},U=Sa(b.participantIds),T=new Set(Object.keys(U).filter(D=>U[D]>1)),P=b.matchUpIds.filter(D=>c[D].participantIds.some(E=>T.has(E)));return P.forEach(D=>{I(D,P,S)}),S},w=b=>{let S={},U={};return b.forEach(T=>{let{matchUpId:P,schedule:D}=T;if(!P||!D?.courtId||!D?.scheduledDate)return;let E=`${D.courtId}|${D.scheduledDate}`;U[E]||(U[E]=[]),U[E].push(P)}),Object.values(U).forEach(T=>{T.length>1&&T.forEach(P=>{S[P]=T.filter(D=>D!==P)})}),S},y=(b,S,U,T)=>{if(!o[b].schedule[mD]){o[b].schedule[mD]=S,o[b].schedule[Jne]=T,m[a[b]].push({matchUpId:b,issueType:U,issueIds:T,issue:S});let P=o[b].schedule.courtId;s[P]||(s[P]=[]),s[P].push({matchUpId:b,issue:S,issueType:U,issueIds:T})}};if(p.forEach((b,S)=>{let U=S?p[S-1]:void 0,T=p.slice(S+1),P=v(b),D=w(n[S].filter(E=>b.matchUpIds.includes(E.matchUpId)));U&&g(U,b,P),b.matchUpIds.forEach(E=>{let R=c[E].matchUpIds;for(let M of T){let N=M.matchUpIds.filter(A=>R.includes(A));N?.length&&(N.forEach(A=>y(A,Uy,es,[E])),y(E,Uy,es,N))}if(D[E]&&y(E,xl,Kne,D[E]),P[E]?.[xl]&&y(E,xl,Ux,P[E][xl]),b.sourceMatchUpIds.includes(E)){let M=b.matchUpIds.filter(N=>c[N].matchUpIds.includes(E));y(E,xl,es,M),b.matchUpIds.filter(N=>c[N].matchUpIds.includes(E)).forEach(N=>y(N,xl,es,[E]))}let C=U?.matchUpIds?.filter(M=>f(E,M)>1);if(C?.length&&(y(E,Ty,es,C),C.forEach(M=>y(M,Ty,es,[E]))),P[E]?.[Fl]&&y(E,Fl,Ux,P[E][Fl]),U?.targetMatchUpIds?.includes(E)){let M=o[E].schedule.courtId,N=R.filter(A=>U.matchUpIds.includes(A));N.some(A=>o[A].schedule.courtId===M)||(N.forEach(A=>y(A,Fl,es,[E])),y(E,Fl,es,N))}})}),t){let b=new Set(Object.keys(a)),S={};for(let P of b)S[P]=new Set(c[P]?.dependentMatchUpIds??[]);let U=0;for(let P of b){let D=c[P]?.sources?.length??0;D>U&&(U=D)}let T=P=>{let D=new Set(P.participantIds),E={};for(let R of P.matchUpIds){let C=c[R]?.participantIds??[];for(let M of C)D.has(M)||(E[M]||(E[M]=new Set),E[M].add(R))}return E};if(p.forEach((P,D)=>{let E=T(P);for(let[,R]of Object.entries(E))if(R.size>1){let C=[...R];for(let M of C)y(M,Fl,Tx,C.filter(N=>N!==M))}if(D>0){let R=p[D-1],C=T(R);for(let[M,N]of Object.entries(E))if(C[M]){let A=[...new Set([...N,...C[M]])];for(let O of A)y(O,Fl,Tx,A.filter(k=>k!==O))}}}),p.forEach((P,D)=>{for(let E of P.matchUpIds)for(let R=2;R<=Math.min(D,U);R++){let C=p[D-R];for(let M of C.matchUpIds){let N=f(E,M);N>0&&R<N&&(y(E,Ty,es,[M]),y(M,Ty,es,[E]))}}}),p.forEach((P,D)=>{for(let E of P.matchUpIds){let R=S[E];if(!R?.size)continue;for(let M=0;M<D;M++){let N=p[M].matchUpIds.filter(A=>R.has(A));if(N.length){for(let A of N)y(A,Uy,es,[E]);y(E,Uy,es,N)}}let C=P.matchUpIds.filter(M=>M!==E&&R.has(M));if(C.length){for(let M of C)y(M,xl,es,[E]);y(E,xl,es,C)}}}),Object.keys(d).length){let P=new Set(Object.values(d).flat());p.forEach(D=>{for(let E of D.matchUpIds){let R=(c[E]?.matchUpIds??[]).filter(C=>P.has(C)).filter(C=>!b.has(C));R.length&&y(E,Fl,Xne,R)}})}}return{courtIssues:s,rowIssues:m}}function ede(t){let e="reorderUpcomingMatchUps",{tournamentRecords:i}=t;if(typeof i!="object"||!Object.keys(i).length)return q({result:{error:Mi},stack:e});let{matchUpsContextIds:r,firstToLast:n}=t;if(!r)return q({result:{error:Je},stack:e});let a=r?.length;if(!a)return{...W};let s=0;return r.forEach((l,u)=>{let{tournamentId:c,drawId:d,matchUpId:p}=l,f=u+(n?-1:1);f<0&&(f=a-1),f===a&&(f=0);let m=r[f].schedule.scheduledTime,h=o({tournamentId:c,scheduledTime:m,matchUpId:p,drawId:d});if(h.success)s++;else return h}),s===a?W:q({result:{error:gie},stack:e});function o({tournamentId:l,scheduledTime:u,matchUpId:c,drawId:d}){let p=i[l],{drawDefinition:f}=ep({tournamentRecord:p,drawId:d});return f?tp({drawDefinition:f,scheduledTime:u,matchUpId:c}):{error:_a}}}function tde(t){let{scheduleChange:e,matchUpIds:i,dryRun:r}=t;if(!i||!Array.isArray(i))return{error:Ch};if(typeof e!="object")return{error:re};let n=ws(t),a=[],s=[];for(let l of Object.values(n)){let u=pze({tournamentRecord:l,scheduleChange:e,matchUpIds:i,dryRun:r});if(u.error)return u;Array.isArray(u.notRescheduled)&&s.push(...u.notRescheduled);let c=KB(u.notRescheduled),d=[];u.rescheduled?.forEach(p=>{let{matchUpId:f}=p;c.includes(f)&&d.push(f),a.push(p)}),d.length&&(s=u?.notRescheduled?.filter(({matchUpId:p})=>!d.includes(p))||[])}let o=!!(a.length&&!s.length);return{...W,rescheduled:a,notRescheduled:s,allRescheduled:o}}function pze({tournamentRecord:t,scheduleChange:e,matchUpIds:i,dryRun:r}){if(!t)return{error:ve};if(!i||!Array.isArray(i))return{error:Ch};if(typeof e!="object")return{error:re};let n=[],a=[],{minutesChange:s,daysChange:o}=e;if(!s&&!o)return{...W};if(s&&isNaN(s))return{error:re};if(o&&isNaN(o))return{error:re};let{matchUps:l}=Ur({matchUpFilters:{matchUpIds:i},tournamentRecord:t}),u=({matchUpStatus:y})=>!Ki.includes(y),c=l?.filter(y=>eT({schedule:y.schedule})).filter(y=>u({matchUpStatus:y.matchUpStatus}));if(!c?.length)return{...W};let{tournamentInfo:d}=Qh({tournamentRecord:t}),{startDate:p,endDate:f}=d,m=c?.reduce((y,b)=>{let{matchUpId:S,drawId:U}=b;return y[U]?y[U].push(S):y[U]=[S],y},{}),h=1440;for(let y of Object.keys(m)){let b=ep({tournamentRecord:t,drawId:y});if(b.error)return b;let S=b.drawDefinition,U=m[y].filter(T=>i.includes(T));for(let T of U)if(T&&S){let P=c.find(N=>N.matchUpId===T)?.schedule,{scheduledTime:D,scheduledDate:E}=P,R,C,M;if(!R&&o&&E){let N=Ze(E);M=Sy(N,o),R=new Date(M)<new Date(p)||new Date(M)>new Date(f)}if(s&&D){let N=Ze(D),A=Rt(pi(D))+s;if(R=A<0||A>h,!R){let O=Qn(D,s),k=N&&M||E===N&&N;C=k?`${k}T${O}`:O}}if(R)a.push(T);else{if(!r){if(C){let N=tp({scheduledTime:C,drawDefinition:S,matchUpId:T});if(N.error)return N}if(M){let N=QN({scheduledDate:M,drawDefinition:S,matchUpId:T});if(N.error)return N}}(C||M)&&n.push(T)}}}let g=Ur({matchUpFilters:{matchUpIds:i},tournamentRecord:t}).matchUps??[],I=g.filter(({matchUpId:y})=>n.includes(y)),v=g.filter(({matchUpId:y})=>a.includes(y)),w=I.length&&!v.length;return{...W,rescheduled:I,notRescheduled:v,allRescheduled:w}}function ide(t){let e="matchUpScheduleChange",{tournamentRecords:i}=t;if(typeof i!="object"||!Object.keys(i).length)return{error:Mi};let{sourceMatchUpContextIds:r,targetMatchUpContextIds:n,sourceCourtId:a,targetCourtId:s,courtDayDate:o}=t||{},{drawId:l,matchUpId:u,tournamentId:c}=r||{},{drawId:d,matchUpId:p,tournamentId:f}=n||{};if(!u&&!p)return q({result:{error:Je},stack:e});let{matchUps:m}=No({matchUpFilters:{matchUpIds:[u,p].filter(Boolean),drawIds:[l,d].filter(Boolean)},tournamentRecords:t.tournamentRecords}),h=m?.find(({matchUpId:y})=>y===u),g=m?.find(({matchUpId:y})=>y===p),I=0;if(s&&u&&!p){let y=v({tournamentId:c,matchUpId:u,courtId:s,matchUp:h,drawId:l,tournamentRecords:i,sourceCourtId:a,courtDayDate:o});if(y?.success&&I++,y.error)return q({result:y,stack:e})}else if(a&&s&&u&&p){let y=v({tournamentId:c,matchUpId:u,courtId:s,matchUp:h,drawId:l,tournamentRecords:i,sourceCourtId:a,courtDayDate:o});if(y.success&&I++,y.error)return q({result:y,stack:e,info:"source"});let b=v({tournamentId:f,sourceCourtId:s,matchUpId:p,matchUp:g,courtId:a,drawId:d,tournamentRecords:i,courtDayDate:o});if(b.success&&I++,b.error)return q({result:b,stack:e,info:"target"})}else return{error:Je};return I?W:q({result:{error:Av},stack:e});function v(y){let{tournamentRecords:b,tournamentId:S,matchUp:U,drawId:T}=y,P=b[S],{drawDefinition:D}=ep({tournamentRecord:P,drawId:T});return U.matchUpType===ei?w({...y,tournamentRecord:P,drawDefinition:D}):tg({...y,tournamentRecord:P,drawDefinition:D})}function w({removePriorValues:y,tournamentRecords:b,tournamentRecord:S,drawDefinition:U,sourceCourtId:T,courtDayDate:P,matchUpId:D,matchUp:E,courtId:R}){let C=[R].concat(E.schedule.allocatedCourts.map(({courtId:M})=>M).filter(M=>M!==T));return ZN({removePriorValues:y,tournamentRecords:b,tournamentRecord:S,drawDefinition:U,courtDayDate:P,matchUpId:D,courtIds:C})}}function rde({scheduleAttributes:t=[wu,Ed,Bh,Vh,jh,go,Ec,Kl,ec],tournamentRecord:e,drawDefinition:i,matchUpId:r}){let n="clearMatchUpSchedule",a=i?An({matchUpFilters:{matchUpIds:[r]},inContext:!1,drawDefinition:i}).matchUps?.[0]:Ur({matchUpFilters:{matchUpIds:[r]},tournamentRecord:e,inContext:!1}).matchUps?.[0];if(!a)return{error:dn};let s=(a.timeItems??[]).filter(o=>o?.itemType&&!t.includes(o?.itemType));return a.timeItems=s,Ut({tournamentId:e.tournamentId,context:n,drawDefinition:i,matchUp:a}),{...W}}function nde(t){let{tournamentRecord:e,tournamentId:i,dailyLimits:r}=t,n=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(typeof n!="object"||!Object.keys(n).length)return{error:Mi};if(typeof r!="object")return{error:$c};let a=Object.keys(n).filter(s=>!i||i===s);if(i&&!a.includes(i))return{error:re};for(let s of a){let o=n[s],l=Ft({extension:{name:pU,value:{dailyLimits:r}},element:o});if(l.error)return l}return{...W}}function ade(t){let{tournamentRecord:e,disableNotice:i,scheduledDate:r,bookingType:n,courtOrder:a,rowCount:s=1,courtId:o,notes:l}=t;if(!e)return q({result:{error:re},info:"tournamentRecord is required"});if(!o)return{error:Ic};if(!r)return q({result:{error:re},info:"scheduledDate is required"});if(!n)return q({result:{error:re},info:"bookingType is required"});if(a==null)return q({result:{error:re},info:"courtOrder is required"});if(!Number.isInteger(a)||a<1)return q({result:{error:re},info:"courtOrder must be a positive integer"});if(!Number.isInteger(s)||s<1)return q({result:{error:re},info:"rowCount must be a positive integer"});let{court:u,venue:c}=Zd({tournamentRecord:e,courtId:o});if(!u)return{error:Ic};if(!Md({court:u,date:r})){u.dateAvailability||(u.dateAvailability=[]);let f={date:r,bookings:[]};u.dateAvailability.push(f)}let d=Md({court:u,date:r});if(d.bookings){for(let f of d.bookings)if(typeof f.courtOrder=="number"){let m=f.courtOrder,h=m+(f.rowCount||1)-1,g=a,I=a+s-1;if(g<=h&&I>=m)return q({result:{error:uie},info:`Booking conflicts with existing booking at rows ${m}-${h}`})}}let p={courtOrder:a,rowCount:s,bookingType:n,notes:l,createdAt:new Date().toISOString()};return d.bookings||(d.bookings=[]),d.bookings.push(p),!i&&c&&st({payload:{venue:c,tournamentId:e.tournamentId},topic:Vc,key:c.venueId}),{...W,booking:p}}function sde(t){let{tournamentRecord:e,disableNotice:i,scheduledDate:r,courtOrder:n,courtId:a}=t;if(!e)return q({result:{error:re},info:"tournamentRecord is required"});if(!a)return{error:Ic};if(!r)return q({result:{error:re},info:"scheduledDate is required"});if(n==null)return q({result:{error:re},info:"courtOrder is required"});let{court:s,venue:o}=Zd({tournamentRecord:e,courtId:a});if(!s)return{error:Ic};let l=Md({court:s,date:r});if(!l?.bookings)return q({result:{error:ux},info:"No bookings found for this date"});let u=l.bookings.findIndex(d=>d.courtOrder===n);if(u===-1)return q({result:{error:ux},info:`No booking found at row ${n}`});let c=l.bookings.splice(u,1)[0];return!i&&o&&st({payload:{venue:o,tournamentId:e.tournamentId},topic:Vc,key:o.venueId}),{...W,booking:c}}var ode={};dt(ode,{addCollectionDefinition:()=>bG,addCollectionGroup:()=>fde,aggregateTieFormats:()=>hde,compareTieFormats:()=>Rc,getTieFormat:()=>AN,modifyCollectionDefinition:()=>vG,modifyTieFormat:()=>mde,mutate:()=>lde,orderCollectionDefinitions:()=>dde,query:()=>yle,removeCollectionDefinition:()=>yG,removeCollectionGroup:()=>cde,tieFormatGenderValidityCheck:()=>bM,validateCollectionDefinition:()=>aU});var lde={};dt(lde,{addCollectionDefinition:()=>bG,addCollectionGroup:()=>fde,aggregateTieFormats:()=>hde,modifyCollectionDefinition:()=>vG,modifyTieFormat:()=>mde,orderCollectionDefinitions:()=>dde,removeCollectionDefinition:()=>yG,removeCollectionGroup:()=>cde});function Xp({drawDefinition:t,structureId:e,matchUpId:i,structure:r,matchUp:n,eventId:a,event:s}){let o="getTieFormat",l;if(e=r?.structureId??e,i=n?.matchUpId??i,(i||e)&&!t)return{error:$e};if(a&&s)l=Vo(s);else if(i){if(t&&(!n||!r)){let u=fi({drawDefinition:t,matchUpId:i});if(u.error)return u;if(u.matchUp?.matchUpType!==La)return q({result:{error:sa},stack:o});r||(r=u.structure),n||(n=u.matchUp)}l=qy({item:n,drawDefinition:t,structure:r,event:s})||qy({item:r,drawDefinition:t,structure:r,event:s})||Vo(t)||Vo(s)}else if(t&&e){if(!r){let u=tt({drawDefinition:t,structureId:e});if(u.error)return u;r=u?.structure}l=qy({item:r,drawDefinition:t,structure:r,event:s})||Vo(t)||Vo(s)}else l=Vo(t)||Vo(s);return l?{...W,structure:r,tieFormat:l,matchUp:n}:q({result:{error:Mv},stack:o})}function cE({matchUp:t,updateInProgressMatchUps:e}){return!t.winningSide&&![Ki].includes(t.matchUpStatus)&&(e||t.matchUpStatus!==lo&&!fr(t))}function gk({from:t,to:e}){let i=Object.keys(t),r=Li(i,Object.keys(e)).length===i.length,n=i.filter(s=>t[s]!==e[s]).map(s=>({countChange:e[s]-t[s],collectionId:s})),a=i.every(s=>t[s]===e[s]);return{equivalent:r&&a,matchUpsCountChanges:n}}function fze({updateInProgressMatchUps:t,tournamentRecord:e,drawDefinition:i,structure:r,tieFormat:n,eventId:a,matchUp:s,event:o,uuids:l}){let u="updateTieFormat",c=e?.tournamentId,d=0,p=0,f=0,m=0,h=n?.collectionDefinitions.reduce((S,U)=>(S[U.collectionId]=(S[U.collectionId]||0)+U.matchUpCount,S),{}),g=({tieFormat:S})=>{let U=S?.collectionDefinitions.reduce((T,P)=>(T[P.collectionId]=(T[P.collectionId]||0)+P.matchUpCount,T),{});return gk({from:U,to:h}).equivalent},I=Xp({drawDefinition:i})?.tieFormat,v=Xp({event:o})?.tieFormat;if(o&&a){for(let S of o.drawDefinitions??[])w({drawDefinition:S});o.tieFormat=Gr(n),m+=1}else if(s){if(!s.tieMatchUps)return q({result:{error:sa},stack:u});let S=Sa(s.tieMatchUps?.map(({collectionId:E})=>E)),U=gk({to:h,from:S}),{changes:T,changesArePossible:P,cannotChangeReaon:D}=qq({matchUp:s,check:U});if(U.equivalent)if(cE({matchUp:s,updateInProgressMatchUps:t}))s.tieFormat=Gr(n),m+=1;else return q({result:{error:nB},info:"matchUp is IN_PROGRESS or COMPLETE",stack:u});else if(P)b({tieFormat:n,matchUp:s,changes:T,uuids:l});else return q({context:{collectionMap:h,matchUpMap:S},result:{error:ql},info:D||"specified changes not possible",stack:u});p+=1,Ut({eventId:o?.eventId,context:u,drawDefinition:i,tournamentId:c,matchUp:s})}else if(r){let S=y({inheritedTieFormat:I??v,structure:r})?.modifiedMatchUpsCount;S&&(p+=S,d+=1,m+=1);let U=!r.tieFormat||Rc({ancestor:r.tieFormat,descendant:n}).different;U&&(r.tieFormat=Gr(n),d+=1,m+=1),(S||U)&&i&&ii({structureIds:[r.structureId],eventId:o?.eventId,drawDefinition:i})}else if(i)w({drawDefinition:i}),i.tieFormat=Gr(n),m+=1;else return{error:$e};return{modifiedStructuresCount:d,modifiedMatchUpsCount:p,addedMatchUpsCount:f,modifiedCount:m,...W,tieFormat:n};function w({drawDefinition:S}){let U=S.structures||[],T=[];for(let P of U){if(P.tieFormat)continue;let D=y({inheritedTieFormat:v,structure:P})?.modifiedMatchUpsCount;if(D){d+=1,p+=D;let E=P.structureId;T.push(E)}}return ii({structureIds:T,eventId:o?.eventId,drawDefinition:S}),T.length}function y({inheritedTieFormat:S,structure:U}){let T=0,P=At({matchUpFilters:{matchUpTypes:[ei]},structure:U})?.matchUps||[];for(let D of P){let E=cE({matchUp:D,updateInProgressMatchUps:t}),R=!1,C=Sa(D.tieMatchUps?.map(({collectionId:N})=>N)),M=gk({from:C,to:h});if(M.equivalent)D.tieFormat&&g(D)&&E&&(D.tieFormat=Gr(n),R=!0);else{let{changes:N,changesArePossible:A}=qq({matchUp:D,check:M});if(A&&!D.tieFormat)b({changes:N,matchUp:D,tieFormat:n,uuids:l});else if(S)(!D.tieFormat||Rc({ancestor:S,descendant:D.tieFormat}).different)&&(D.tieFormat=S,R=!0);else return q({result:{error:Mv},stack:u})}R&&(T+=1,Ut({tournamentId:e?.tournamentId,drawDefinition:i,context:u,eventId:a,matchUp:D}))}return{modifiedMatchUpsCount:T}}function b({uuids:S,matchUp:U,tieFormat:T,changes:P}){U.tieFormat=Gr(T);let D=[],E=[];return P.forEach(R=>{if(R.countChange>0){let C=Math.max(0,...U.tieMatchUps.filter(A=>A.collectionId===R.collectionId).map(Pa("collectionPosition"))),M=T.collectionDefinitions.find(A=>A.collectionId===R.collectionId),N=VU({matchUpsLimit:R.countChange,collectionPositionOffset:C,collectionDefinition:M,matchUp:U,uuids:S});E.push(...Oe(N,!1,!0)),f+=E.length,U.tieMatchUps.push(...N)}else{let C=R.toBePlayedTieMatchUpIds.slice(0,Math.abs(R.countChange));console.log("remove",C.length),D.push(...C),U.tieMatchUps=U.tieMatchUps.filter(({matchUpId:M})=>!C.includes(M))}}),E.length&&Dd({matchUps:E,drawDefinition:i,tournamentId:c,eventId:a}),D.length&&ku({matchUpIds:D,action:"updateTieFormat",drawDefinition:i,tournamentId:c,eventId:a}),{matchUpIdsRemoved:D,matchUpsAdded:E}}}function qq({check:t,matchUp:e}){let i="",r=[];return{changesArePossible:t.matchUpsCountChanges.every(({collectionId:n,countChange:a})=>{let s=e.tieMatchUps.filter(l=>l.collectionId===n&&l.matchUpStatus===_i).map(Pa("matchUpId")),o=s.length+a>=0||a>0;return!o&&a<0&&(i="Insufficient TO_BE_PLAYED matchUps"),r.push({toBePlayedTieMatchUpIds:s,collectionId:n,countChange:a}),o}),changes:r,cannotChangeReaon:i}}function lA({appliedPolicies:t,drawDefinition:e,auditData:i}){if(!t?.audit?.[Wy])return;let{extension:r}=ht({name:Wy,element:e}),n={value:Array.isArray(r?.value)?r?.value.concat(i):[i],name:Wy};Ft({element:e,extension:n})}function vG({updateInProgressMatchUps:t=!1,tournamentRecord:e,collectionOrder:i,collectionName:r,tieFormatName:n,drawDefinition:a,matchUpFormat:s,matchUpCount:o,collectionId:l,matchUpType:u,structureId:c,matchUpId:d,category:p,eventId:f,gender:m,event:h,collectionValueProfiles:g,collectionValue:I,matchUpValue:v,scoreValue:w,setValue:y}){let b="modifyCollectionDefinition";if(s&&!$a({matchUpFormat:s}))return q({result:{error:re},context:{matchUpFormat:s},stack:b});if(r&&typeof r!="string")return q({result:{error:re},context:{collectionName:r},stack:b});if(m&&!Object.values(UB).includes(m))return q({result:{error:re},context:{gender:m},stack:b});if(p&&typeof p!="object")return q({result:{error:re},context:{category:p},stack:b});let S={collectionValueProfiles:g,collectionValue:I,matchUpValue:v,scoreValue:w,setValue:y};if(!Object.values(S).filter(Boolean).length&&!i&&!r&&!s&&!o&&!u)return q({result:{error:Je},stack:b});if(Object.values(S).filter(Boolean).length>1)return q({info:"Only one value assignment allowed per collectionDefinition",result:{error:re},stack:b});let U=Xp({drawDefinition:a,structureId:c,matchUpId:d,eventId:f,event:h});if(U.error)return q({result:U,stack:b});let{matchUp:T,structure:P,tieFormat:D}=U,E=Gr(D),R=D?.collectionDefinitions.find(V=>V.collectionId===l),C=E?.collectionDefinitions.find(V=>V.collectionId===l);if(!R)return q({info:"source collectionDefinition",result:{error:Br},context:{collectionId:l},stack:b});let M=I??v??w??y;if(g?.length){let V=dte({matchUpCount:o??R?.matchUpCount??0,collectionValueProfiles:g});if(V.errors)return q({result:{error:re},info:V.errors,stack:b})}else if(M&&!lt(M))return q({result:{error:re},info:"value is not an integer",context:{value:M},stack:b});let N=(V,_)=>Li(Object.keys(V),Object.keys(_)).length===Object.keys(V).length&&Li(Object.values(V),Object.values(_)).length===Object.values(V).length,A=g&&(!R.collectionValueProfiles||!N(R.collectionValueProfiles,g)),O=lt(I)&&R.collectionValue!==I||lt(v)&&R.matchUpValue!==v||lt(w)&&R.scoreValue!==w||lt(y)&&R.setValue!==y||A,k=[];if(O&&(C.collectionValueProfiles=void 0,C.collectionValue=void 0,C.matchUpValue=void 0,C.scoreValue=void 0,C.setValue=void 0,Object.assign(C,S),k.push({collectionId:l,...je(S)})),(lt(w)||lt(y))&&C.collectionGroupNumber){let V=C.collectionGroupNumber;E.collectionDefinitions=E.collectionDefinitions.map(_=>{let{collectionGroupNumber:B,...G}=_;return B===V?G:_}),E.collectionGroups=E.collectionGroups.filter(({groupNumber:_})=>_!==V),k.push({collectionId:l,change:"collectionGroupNumber removed"})}let{aggregateValue:F,valueGoal:x}=eg(E),L=je({aggregateValue:F,valueGoal:x});if((L.aggregateValue!==D?.winCriteria.aggregateValue||L.valueGoal!==D?.winCriteria.valueGoal)&&(E.winCriteria=L,k.push({collectionId:l,winCriteria:L})),lt(i)&&R.collectionOrder!==i&&(C.collectionOrder=i,k.push({collectionId:l,collectionOrder:i})),r&&R.collectionName!==r&&(C.collectionName=r,k.push({collectionId:l,collectionName:r})),s&&R.matchUpFormat!==s&&(C.matchUpFormat=s,k.push({collectionId:l,matchUpFormat:s})),lt(o)&&R.matchUpCount!==o&&(C.matchUpCount=o,k.push({collectionId:l,matchUpCount:o})),u&&R.matchUpType!==u)return q({result:{error:hB},context:{matchUpType:u},stack:b});p&&R.category!==p&&(C.category=p,k.push({collectionId:l,category:p})),m&&R.gender!==m&&(C.gender=m,k.push({collectionId:l,gender:m}));let $=je(E);if(U=Gn({tieFormat:$}),U.error)return q({result:U,stack:b});if(!k.length)return q({result:{...W,modifications:k}});if(D?.tieFormatName!==n?($.tieFormatName=n,k.push({tieFormatName:n})):k.length&&(delete $.tieFormatName,k.push("tieFormatName removed: modifications without new tieFormatName")),U=fze({tieFormat:$,updateInProgressMatchUps:t,tournamentRecord:e,drawDefinition:a,structure:P,eventId:f,matchUp:T,event:h}),!U.error){let{appliedPolicies:V}=Dt({tournamentRecord:e}),_=je({collectionDefinition:C,drawId:a?.drawId,action:b,structureId:c,matchUpId:d,eventId:f});lA({appliedPolicies:V,drawDefinition:a,auditData:_})}return q({result:{...U,modifications:k},stack:b})}function mze({updateInProgressMatchUps:t,drawDefinition:e,structureId:i,structure:r,matchUpId:n,matchUp:a}){let s=[];return n&&a?s=[a]:i&&r?s=At({matchUpFilters:{matchUpTypes:[ei]},structure:r})?.matchUps??[]:e&&(s=An({matchUpFilters:{matchUpTypes:[ei]},drawDefinition:e})?.matchUps??[]),{targetMatchUps:s.filter(o=>!o.winningSide&&o.matchUpStatus!==Oi&&(t||o.matchUpStatus!==lo&&!fr(o)))}}function hze({updateInProgressMatchUps:t,tournamentRecord:e,drawDefinition:i,targetMatchUps:r,tieFormat:n,event:a}){for(let s of r){let o=!!s.tieFormat;o&&(s.tieFormat=Gr(n));let l;if(t){let u=Dt({tournamentRecord:e,drawDefinition:i,event:a}).appliedPolicies,c=Hc({matchUpId:s.matchUpId,exitWhenNoValues:!0,tournamentRecord:e,appliedPolicies:u,drawDefinition:i,event:a});if(c.error)return c;l=c.score}o&&!l&&Ut({tournamentId:e?.tournamentId,context:"updateTargetTeamMatchUps",eventId:a?.eventId,matchUp:s,drawDefinition:i})}return{...W}}function ude({updateInProgressMatchUps:t,originalValueGoal:e,tournamentRecord:i,wasAggregateValue:r,tieFormatName:n,drawDefinition:a,structureId:s,structure:o,tieFormat:l,matchUpId:u,matchUp:c,eventId:d,event:p}){let{aggregateValue:f,valueGoal:m}=eg(l);l.winCriteria=je({aggregateValue:f,valueGoal:m}),(e&&e!==m||f&&!r)&&(n?l.tieFormatName=n:delete l.tieFormatName);let{targetMatchUps:h}=mze({updateInProgressMatchUps:t,drawDefinition:a,structureId:s,structure:o,matchUpId:u,matchUp:c});hze({updateInProgressMatchUps:t,tournamentRecord:i,targetMatchUps:h,drawDefinition:a,tieFormat:l,event:p});let g=je(l),I=Gn({tieFormat:g});if(I.error)return I;if(d&&p)p.tieFormat=g;else if(u&&c)c.tieFormat=l;else if(o)o.tieFormat=g;else if(a)a.tieFormat=g;else if(!c||!a)return{error:$e};return ii({drawDefinition:a,eventId:p?.eventId}),{...W}}function cde({updateInProgressMatchUps:t=!0,collectionGroupNumber:e,tournamentRecord:i,drawDefinition:r,tieFormatName:n,structureId:a,matchUpId:s,matchUp:o,eventId:l,event:u}){if(!e)return{error:Je};if(isNaN(e))return{error:re};let c="removeCollectionGroup",d=o?void 0:Xp({drawDefinition:r,structureId:a,matchUpId:s,eventId:l,event:u});if(d?.error)return q({result:d,stack:c});let p=d?.structure;o=o??d?.matchUp;let f=d?.tieFormat,m=f?.winCriteria.valueGoal,h=f?.winCriteria.aggregateValue,g=Gr(f);if(d=Gn({tieFormat:g}),d.error)return q({result:d,stack:c});let I=[];if(g.collectionDefinitions=g.collectionDefinitions.map(v=>{let{collectionGroupNumber:w,...y}=v;return w!==e?v:(I.push(v.collectionId),y)}),g.collectionGroups=g.collectionGroups.filter(({groupNumber:v})=>v!==e),d=ude({updateInProgressMatchUps:t,originalValueGoal:m,wasAggregateValue:h,tournamentRecord:i,drawDefinition:r,tieFormatName:n,structureId:a,structure:p,tieFormat:g,matchUpId:s,matchUp:o,eventId:l,event:u}),!d.error){let{appliedPolicies:v}=Dt({tournamentRecord:i}),w=je({drawId:r?.drawId,collectionGroupNumber:e,action:c,structureId:a,matchUpId:s,eventId:l});lA({appliedPolicies:v,drawDefinition:r,auditData:w})}return q({result:{...d,modifiedCollectionIds:I},stack:c})}function FI({tieFormat:t,orderMap:e}){let i=Gr(t);return i.collectionDefinitions?.forEach(r=>{let n=e[r.collectionId];n&&(r.collectionOrder=n)}),i.collectionDefinitions?.sort((r,n)=>gI(r.collectionOrder)-gI(n.collectionOrder)),i}function dde({tournamentRecord:t,drawDefinition:e,structureId:i,matchUpId:r,orderMap:n,eventId:a,matchUp:s,event:o}){if(typeof n!="object"||!Object.values(n).every(c=>lt(c)))return q({result:{error:re},context:{orderMap:n}});let l=i?tt({drawDefinition:e,structureId:i}):void 0;if(l?.error)return l;let u=l?.structure;if(a&&o?.tieFormat)Yq({tournamentRecord:t,event:o,orderMap:n});else if(r){let c=e&&fi({drawDefinition:e,matchUpId:r});if(c?.error)return c;if(s=c.matchUp,!s)return{error:aa};let d=AN({tournamentRecord:t,matchUpId:r,structure:u,drawDefinition:e,event:o})?.tieFormat;s.tieFormat=FI({tieFormat:d,orderMap:n}),Ut({tournamentId:t?.tournamentId,eventId:o?.eventId,drawDefinition:e,matchUp:s})}else if(i)if(u?.tieFormat)u.tieFormat=FI({tieFormat:u.tieFormat,orderMap:n}),pde({eventId:o?.eventId,tournamentRecord:t,drawDefinition:e,structure:u,orderMap:n}),ii({drawDefinition:e,structureIds:[u.structureId]});else if(e.tieFormat)Qx({structureIds:[i],tournamentRecord:t,drawDefinition:e,orderMap:n,event:o});else if(o?.tieFormat)Yq({structureIds:[i],tournamentRecord:t,orderMap:n,event:o});else return{error:Br};else if(e?.tieFormat)Qx({tournamentRecord:t,drawDefinition:e,orderMap:n,event:o});else return{error:Br};return{...W}}function Yq({tournamentRecord:t,structureIds:e,orderMap:i,event:r}){let n=FI({tieFormat:r.tieFormat,orderMap:i});e?.length||(r.tieFormat=n);for(let a of r.drawDefinitions??[])Qx({tournamentRecord:t,drawDefinition:a,structureIds:e,orderMap:i,event:r})}function Qx({tournamentRecord:t,drawDefinition:e,structureIds:i,orderMap:r,event:n}){let a=e.tieFormat??n?.tieFormat,s=FI({tieFormat:a,orderMap:r});i?.length||(e.tieFormat=s);let o=[];for(let l of e.structures??[])i?.length&&!i.includes(l.structureId)||((l.tieFormat||i?.includes(l.structureId))&&(l.tieFormat=FI({tieFormat:l.tieFormat??e.tieFormat??n?.tieFormat,orderMap:r})),pde({eventId:n?.eventId,tournamentRecord:t,drawDefinition:e,structure:l,orderMap:r}),o.push(l.structureId));ii({drawDefinition:e,structureIds:o})}function pde({tournamentRecord:t,drawDefinition:e,structure:i,orderMap:r,eventId:n}){let a=At({matchUpFilters:{matchUpTypes:[ei]},structure:i})?.matchUps;for(let s of a)s.tieFormat&&(s.tieFormat=FI({tieFormat:s.tieFormat,orderMap:r}),Ut({tournamentId:t?.tournamentId,drawDefinition:e,eventId:n,matchUp:s}))}function yG({updateInProgressMatchUps:t=!0,tieFormatComparison:e,tournamentRecord:i,drawDefinition:r,tieFormatName:n,collectionId:a,structureId:s,matchUpId:o,eventId:l,matchUp:u,event:c}){let d="removeCollectionDefinition",p=u?void 0:Xp({drawDefinition:r,structureId:s,matchUpId:o,eventId:l,event:c});if(p?.error)return q({result:p,stack:d});let f=p?.structure;u=u??p?.matchUp;let m=p?.tieFormat,h=Gr(m);if(p=Gn({tieFormat:h}),p.error)return q({result:p,stack:d});let g=h?.collectionDefinitions?.find(E=>E.collectionId===a);if(!g)return q({result:{error:Br,collectionId:a}});h.collectionDefinitions=h.collectionDefinitions.filter(E=>E.collectionId!==a),g.collectionGroupNumber&&(h.collectionDefinitions=h.collectionDefinitions.map(E=>{let{collectionGroupNumber:R,...C}=E;return C}),h.collectionGroups=h.collectionGroups.filter(({groupNumber:E})=>E!==g.collectionGroupNumber));let{aggregateValue:I,valueGoal:v}=eg(h);h.winCriteria=je({aggregateValue:I,valueGoal:v});let w=m?.winCriteria.valueGoal,y=m?.winCriteria.aggregateValue;(w&&w!==v||I&&!y)&&(n?h.tieFormatName=n:delete h.tieFormatName);let b=[];o&&u?b=[u]:s&&f?b=At({matchUpFilters:{matchUpTypes:[ei]},structure:f})?.matchUps??[]:r?b=An({matchUpFilters:{matchUpTypes:[ei]},drawDefinition:r})?.matchUps??[]:c&&(b=xu({matchUpFilters:{matchUpTypes:[ei]}})?.matchUps??[]);let S=(b||[]).filter(E=>{let R=E.tieMatchUps?.filter(M=>M.collectionId===a)?.some(fr),C=e&&E.tieFormat?Rc({descendant:E.tieFormat,ancestor:h})?.different:!1;return t&&!R||!E.winningSide&&E.matchUpStatus!==Oi&&(t||E.matchUpStatus!==lo&&!fr(E)&&!C)});if(!S.length)return{error:Av};let{appliedPolicies:U}=Dt({tournamentRecord:i});if(o&&u&&t){let E=u.tieMatchUps?.filter(R=>R.collectionId===a);for(let R of E??[]){let C=Ef({matchUpId:R.matchUpId,tieMatchUpId:u?.matchUpId,winningSide:void 0,removeScore:!0,tournamentRecord:i,appliedPolicies:U,drawDefinition:r,event:c});if(C.error||(C=fi({drawDefinition:r,matchUpId:o}),C.error))return C;u=C?.matchUp}}let T=[];for(let E of S){for(let R of E?.sides??[])R.lineUp=(R.lineUp??[]).map(C=>({participantId:C.participantId,collectionAssignments:(C?.collectionAssignments??[]).filter(M=>M.collectionId!==a)}));if(E.tieMatchUps=(E.tieMatchUps??[]).filter(R=>{let C=R.collectionId===a;return C&&T.push(R.matchUpId),!C}),E.tieFormat&&(E.tieFormat=Gr(h)),t){let R=Hc({matchUpId:E.matchUpId,exitWhenNoValues:!0,tournamentRecord:i,appliedPolicies:U,drawDefinition:r,event:c});if(R.error)return R}Ut({tournamentId:i?.tournamentId,eventId:c?.eventId,drawDefinition:r,context:d,matchUp:E})}T.length&&ku({tournamentId:i?.tournamentId,matchUpIds:T,eventId:c?.eventId,drawDefinition:r});let P=je(h);if(p=Gn({tieFormat:P}),p.error)return q({result:p,stack:d});if(l&&c)c.tieFormat=P;else if(o&&u)u.tieFormat=P;else if(f)f.tieFormat=P;else if(r)r.tieFormat=P;else if(!u||!r)return{error:$e};ii({drawDefinition:r,eventId:c?.eventId});let D=je({drawId:r?.drawId,action:d,collectionId:a,structureId:s,matchUpId:o,eventId:l});return lA({appliedPolicies:U,drawDefinition:r,auditData:D}),{tieFormat:P,deletedMatchUpIds:T,targetMatchUps:S,...W}}function fde({updateInProgressMatchUps:t=!0,tournamentRecord:e,groupDefinition:i,drawDefinition:r,collectionIds:n,tieFormatName:a,structureId:s,matchUpId:o,matchUp:l,eventId:u,event:c}){let d="addCollectionGroup";if(!Array.isArray(n))return q({result:{error:Je},stack:d});let p=l?void 0:Xp({drawDefinition:r,structureId:s,matchUpId:o,eventId:u,event:c});if(p?.error)return q({result:p,stack:d});let f=p?.structure;l=l||p?.matchUp;let m=p?.tieFormat,h=m?.winCriteria.valueGoal,g=Gr(m);if(p=Gn({tieFormat:g}),p.error)return q({result:p,stack:d});for(let v of g.collectionDefinitions){let{collectionId:w,collectionGroupNumber:y}=v;if(y&&n.includes(w))return q({info:"collectionIds cannot be part of other collectionGroups",result:{error:re},stack:d})}let I=(g.collectionGroups||[]).reduce((v,w)=>w.groupNumber>v?w.groupNumber:v,0)+1;return i.groupNumber=I,g.collectionDefinitions=g.collectionDefinitions.map(v=>n.includes(v.collectionId)?{...v,collectionGroupNumber:I}:v),g.collectionGroups=[...g.collecitonGroups||[],i],ude({updateInProgressMatchUps:t,originalValueGoal:h,tournamentRecord:e,drawDefinition:r,tieFormatName:a,structureId:s,structure:f,tieFormat:g,matchUpId:o,matchUp:l,eventId:u,event:c})}function bG({updateInProgressMatchUps:t=!0,collectionDefinition:e,referenceCategory:i,tournamentRecord:r,policyDefinitions:n,enforceCategory:a,referenceGender:s,drawDefinition:o,tieFormatName:l,enforceGender:u,structureId:c,matchUpId:d,matchUp:p,eventId:f,uuids:m,event:h}){let g="addCollectionDefinition",I=Dt({tournamentRecord:r,drawDefinition:o,event:h}).appliedPolicies??{},v=n?.[Cr]??I?.[Cr];a=a??v?.participants?.enforceCategory;let w=(u??v?.participants?.enforceGender)!==!1,y=!!((i??h?.category)&&a!==!1),b=!!((s??h?.gender)&&w),S=aU({referenceCategory:i??h?.category,collectionDefinition:e,referenceGender:s,checkCategory:y,checkGender:b,event:h});if(S.error)return q({result:S,stack:g});let U=p?.tieFormat?void 0:Xp({drawDefinition:o,structureId:c,matchUpId:d,eventId:f,event:h});if(U?.error)return q({result:{error:U.error},stack:g});let T=U?.structure;p=p??U?.matchUp;let P=p?.tieFormat??U?.tieFormat,D=Gr(P);if(U=Gn({tieFormat:D}),U?.error)return q({result:{error:U.error},stack:g});if(!e.collectionId)e.collectionId=Ct();else if(D.collectionDefinitions.map(({collectionId:x})=>x).includes(e.collectionId))return q({context:{collectionId:e.collectionId},result:{error:bie}});D.collectionDefinitions.push(e),D.collectionDefinitions.sort((x,L)=>(x.collectionOrder||0)-(L.collectionOrder||0)).forEach((x,L)=>x.collectionOrder=L+1);let{aggregateValue:E,valueGoal:R}=eg(D);D.winCriteria=je({aggregateValue:E,valueGoal:R});let C=P?.winCriteria.valueGoal,M=P?.winCriteria.aggregateValue;(C&&C!==R||E&&!M)&&(l?D.tieFormatName=l:delete D.tieFormatName);let N=[],A=[],O=[],k=je(D);if(U=Gn({tieFormat:k}),U?.error)return q({result:{error:U.error},stack:g});if(f&&h){h.tieFormat=k;for(let x of h.drawDefinitions??[])if(!x.tieFormat)for(let L of x.structures??[]){if(L.tieFormat)continue;let $=Ik({updateInProgressMatchUps:t,collectionDefinition:e,structure:L,uuids:m});A.push(...$.newMatchUps),O.push(...$.targetMatchUps),N.push(L.structureId)}AT({modifiedMatchUps:O,eventId:h?.eventId,modifiedStructureIds:N,tournamentRecord:r,drawDefinition:o,addedMatchUps:A,stack:g})}else if(c&&T){T.tieFormat=k;let x=Ik({updateInProgressMatchUps:t,collectionDefinition:e,structure:T,uuids:m});A.push(...x.newMatchUps),O=x.targetMatchUps,AT({modifiedMatchUps:O,eventId:h?.eventId,modifiedStructureIds:N,tournamentRecord:r,drawDefinition:o,addedMatchUps:A,stack:g})}else if(d&&p){if(!cE({matchUp:p,updateInProgressMatchUps:t}))return q({result:{error:nB},stack:g});p.tieFormat=k;let x=VU({collectionDefinition:e,matchUp:p,uuids:m});Array.isArray(p.tieMatchUps)||(p.tieMatchUps=[]),p.tieMatchUps.push(...x),A.push(...x),AT({modifiedMatchUps:[p],eventId:h?.eventId,modifiedStructureIds:N,tournamentRecord:r,drawDefinition:o,addedMatchUps:A,stack:g})}else if(o){o.tieFormat=k;for(let x of o.structures??[]){let L=Ik({updateInProgressMatchUps:t,collectionDefinition:e,structure:x,uuids:m});N.push(x.structureId),A.push(...L.newMatchUps),O.push(...L.targetMatchUps)}AT({modifiedMatchUps:O,eventId:h?.eventId,tournamentRecord:r,drawDefinition:o,addedMatchUps:A,stack:g})}else return{error:$e};let F=je({drawId:o?.drawId,collectionDefinition:e,action:g,structureId:c,matchUpId:d,eventId:f});return lA({appliedPolicies:I,drawDefinition:o,auditData:F}),{tieFormat:k,targetMatchUps:O,addedMatchUps:A,...W}}function Ik({updateInProgressMatchUps:t,collectionDefinition:e,structure:i,uuids:r}){let n=[],a=(At({matchUpFilters:{matchUpTypes:[ei]},structure:i})?.matchUps).filter(s=>cE({matchUp:s,updateInProgressMatchUps:t})&&!s.tieFormat);for(let s of a){let o=VU({collectionDefinition:e,matchUp:s,uuids:r});Array.isArray(s.tieMatchUps)||(s.tieMatchUps=[]),s.tieMatchUps.push(...o),n.push(...o)}return{newMatchUps:n,targetMatchUps:a}}function AT({modifiedStructureIds:t,tournamentRecord:e,modifiedMatchUps:i,drawDefinition:r,addedMatchUps:n,eventId:a,stack:s}){Dd({tournamentId:e?.tournamentId,matchUps:n,drawDefinition:r,eventId:a}),i?.forEach(o=>{Ut({tournamentId:e?.tournamentId,drawDefinition:r,context:s,matchUp:o,eventId:a})}),ii({structureIds:t,drawDefinition:r,eventId:a})}function mde({updateInProgressMatchUps:t=!1,tieFormatComparison:e,modifiedTieFormat:i,tournamentRecord:r,considerations:n,drawDefinition:a,structureId:s,matchUpId:o,eventId:l,uuids:u,event:c}){let d="modifyTieFormat";if(!Gn({tieFormat:i}).valid)return q({result:{error:ql},info:"falied validation",stack:d});let p=Xp({drawDefinition:a,structureId:s,matchUpId:o,eventId:l,event:c});if(p.error)return q({result:p,stack:d});let{matchUp:f,tieFormat:m}=p,h=Gr(m),g=Rc({descendant:i,ancestor:h,considerations:n});if(g.invalid)return q({context:{invalid:g.invalid},result:{error:ql},stack:d});if(!g?.different)return q({result:{...W},info:"Nothing to do",stack:d});let I=h.collectionDefinitions.map(({collectionId:P})=>P),v=i.collectionDefinitions.map(({collectionId:P})=>P),w=I.filter(P=>!v.includes(P)),y=i.collectionDefinitions.filter(({collectionId:P})=>!I.includes(P)),b=y.map(Pa("collectionId")),S=[],U,T=i.tieFormatName;for(let P of i.collectionDefinitions){if(b.includes(P.collectionId))continue;let D=vG({updateInProgressMatchUps:t,...P,tournamentRecord:r,tieFormatName:T,drawDefinition:a,structureId:s,matchUpId:o,eventId:l,event:c});if(D.modifications&&S.push(...D.modifications),D.error)return q({result:D,stack:d});D.tieFormat&&(U=D.tieFormat)}for(let P of y){let D=bG({updateInProgressMatchUps:t,collectionDefinition:P,tournamentRecord:r,drawDefinition:a,tieFormatName:T,structureId:s,matchUpId:o,matchUp:f,eventId:l,uuids:u,event:c});if(D.error)return q({result:D,stack:d});D.tieFormat&&(U=D.tieFormat)}for(let P of w){let D=yG({updateInProgressMatchUps:t,tieFormatComparison:e,tournamentRecord:r,drawDefinition:a,tieFormatName:T,collectionId:P,structureId:s,matchUpId:o,eventId:l,matchUp:f,event:c});if(D.error)return q({result:D,stack:d});D.tieFormat&&(U=D.tieFormat)}return m?.tieFormatName!==T?(U.tieFormatName=T,S.push({tieFormatName:T})):(S.length||b.length||w.length)&&(delete U.tieFormatName,S.push("tieFormatName removed: modifications without new tieFormatName")),U.collectionDefinitions=U.collectionDefinitions.sort((P,D)=>gI(P.collectionOrder)-gI(D.collectionOrder)).map((P,D)=>({...P,collectionOrder:D+1})),{processedTieFormat:Gr(U),modifications:S,...W}}function hde({tournamentRecord:t}){if(!t)return{error:ve};let e=0;for(let i of t.events??[]){let r=i.tieFormats??[],n=u=>{if(!u.tieFormat)return;let c;for(let d of r)Rc({descendant:u.tieFormat,ancestor:d}).different||(c=d.tieFormatId);if(c)u.tieFormatId=c,delete u.tieFormat;else{let d=Oe(u.tieFormat,void 0,!0);d.tieFormatId||(d.tieFormatId=Ct()),u.tieFormatId=d.tieFormatId,delete u.tieFormat,r.push(d),e+=1}};i.eventType,n({tieFormat:i.tieFormat});for(let u of i.drawDefinitions??[]){n({tieFormat:u.tieFormat});for(let c of u.structures??[])n({tieFormat:c.tieFormat})}let a=(u,c)=>{let d=o.matchUps?.find(p=>p.matchUpId===u);d&&(d.tieFormatId=c,delete d.tieFormat,Ut({tournamentId:t?.tournamentId,eventId:i.eventId,matchUp:d}))},s=u=>{let c=Oe(u.tieFormat,void 0,!0);c.tieFormatId||(c.tieFormatId=Ct()),r.push(c),e+=1,a(u.matchUpId,c.tieFormatId)},o=xu({matchUpFilters:{matchUpTypes:[La]},event:i}),l=o.matchUps??[];for(let u of l){let c;for(let d of r)u.tieFormat&&Rc({descendant:u.tieFormat,ancestor:d}).different||(c=d.tieFormatId);c?a(u.matchUpId,c):s(u)}r.length&&(i.tieFormats=r)}return{...W,addedCount:e}}var gde={};dt(gde,{addDrawDefinitionExtension:()=>kM,addEventExtension:()=>Yd,addEventTimeItem:()=>Jh,addExtension:()=>Ft,addNotes:()=>oN,addOnlineResource:()=>Ude,addParticipantExtension:()=>Xre,addParticipantTimeItem:()=>fV,addTimeItem:()=>Cl,addTournamentExtension:()=>WB,addTournamentTimeItem:()=>WU,analyzeDraws:()=>zU,analyzeTournament:()=>lj,copyTournamentRecord:()=>vde,createTournamentRecord:()=>aA,generate:()=>Ide,getAggregateTeamResults:()=>oj,getAllowedDrawTypes:()=>CN,getAllowedMatchUpFormats:()=>nj,getAppliedPolicies:()=>Dt,getCompetitionDateRange:()=>NN,getCompetitionPenalties:()=>aj,getPolicyDefinitions:()=>jc,getTournamentInfo:()=>Qh,getTournamentPenalties:()=>MN,getTournamentPersons:()=>sj,getTournamentPoints:()=>Xv,getTournamentStructures:()=>X2,getTournamentTimeItem:()=>GM,hydrateTournamentRecord:()=>bde,mutate:()=>yde,query:()=>hle,removeDrawDefinitionExtension:()=>Jre,removeEventExtension:()=>OM,removeExtension:()=>Nn,removeNotes:()=>uV,removeOnlineResource:()=>Sde,removeParticipantExtension:()=>Qre,removeTournamentExtension:()=>zB,setTournamentCategories:()=>Pde,setTournamentDates:()=>uA,setTournamentEndDate:()=>Rde,setTournamentName:()=>Tde,setTournamentNotes:()=>Dde,setTournamentStartDate:()=>Ede,setTournamentStatus:()=>wde});var Ide={};dt(Ide,{copyTournamentRecord:()=>vde,createTournamentRecord:()=>aA});function vde(t){let e=He(t,[{tournamentRecord:!0,startDate:!0,endDate:!1,tournamentName:!0}]);if(e.error)return e;let{startDate:i,endDate:r}=t.tournamentRecord,n=1440*60*1e3,a=(i&&r?new Date(Ze(r)).getTime()-new Date(Ze(i)).getTime():0)/n,s=t.endDate||EB(t.startDate,a),o=p=>p?.filter(({itemType:f})=>t.itemTypeList?.includes(f)),l=p=>p?.filter(({name:f})=>t.extensionList?.includes(f)),u=p=>{let{timeItems:f,extensions:m,...h}=p;return Oe({...h,timeItems:o(f),extensions:l(m)},!1,!0)},c=p=>{let{drawDefinitions:f,timeItems:m,extensions:h,startDate:g,endDate:I,...v}=p;return Oe({extensions:l(h),timeItems:o(m),startDate:t.startDate,endDate:s,...v},!1,!0)},d={participants:t.copyParticipants?t.tournamentRecord.participants?.map(u)??[]:[],parentOrganisation:Oe({...t.tournamentRecord.parentOrganisation},!1,!0),venues:Oe(t.tournamentRecord.venues??[],!1,!0),extensions:l(t.tournamentRecord.extensions),timeItems:o(t.tournamentRecord.timeItems),events:t.tournamentRecord.events?.map(c)??[],weekdays:[...t.tournamentRecord.weekdays??[]],tournamentName:t.tournamentName,startDate:t.startDate,tournamentId:Ct(),endDate:s};return{...W,tournamentRecord:d}}var yde={};dt(yde,{addDrawDefinitionExtension:()=>kM,addEventExtension:()=>Yd,addEventTimeItem:()=>Jh,addExtension:()=>Ft,addNotes:()=>oN,addOnlineResource:()=>Ude,addParticipantExtension:()=>Xre,addParticipantTimeItem:()=>fV,addTimeItem:()=>Cl,addTournamentExtension:()=>WB,addTournamentTimeItem:()=>WU,hydrateTournamentRecord:()=>bde,removeDrawDefinitionExtension:()=>Jre,removeEventExtension:()=>OM,removeExtension:()=>Nn,removeNotes:()=>uV,removeOnlineResource:()=>Sde,removeParticipantExtension:()=>Qre,removeTournamentExtension:()=>zB,setTournamentCategories:()=>Pde,setTournamentDates:()=>uA,setTournamentEndDate:()=>Rde,setTournamentName:()=>Tde,setTournamentNotes:()=>Dde,setTournamentStartDate:()=>Ede,setTournamentStatus:()=>wde});function bde(t){let{tournamentRecord:e,eventProfiles:i=[],directives:r,policyDefinitions:n}=t;return e?((e.events||[]).forEach(a=>{let s=i.find(o=>o.eventId&&o.eventId===a.eventId);(s?.directives?.hydrateRoundNames||r?.hydrateRoundNames)&&a.drawDefinitions?.forEach(o=>{(s?.policyDefinitions?.[wc]||n?.[wc])&&Ale({drawDefinition:o,appliedPolicies:n})})}),{tournamentRecord:e}):{error:ve}}function wde({tournamentRecord:t,status:e}){return t?e&&!Object.keys(Gse).includes(e)?{error:re,info:"Unknown status"}:(t.tournamentStatus=e,{...W}):{error:ve}}function Sde(t){let e=He(t,[{tournamentRecord:!0,onlineResource:!0}]);if(e.error)return e;let{tournamentRecord:i,onlineResource:r,organisationId:n,participantId:a,personId:s,courtId:o,venueId:l}=t;if(n){if(i.parentOrganisation?.parentOrganisationId!==n)return q({result:{error:Br}});dg({element:i.parentOrganisation,onlineResource:r})}else if(a||s){let u=(i.participants??[]).find(c=>s&&c.person?.personId===s||c.participantId===a);if(!u)return q(s?{result:{error:Br}}:{result:{error:ji}});if(s){if(u.person?.personId!==s)return q({result:{error:_p}});dg({element:u.person,onlineResource:r})}else dg({element:u,onlineResource:r})}else if(o){let u=(i.venues??[]).filter(c=>!l||c.venueId===l).flatMap(c=>(c.courts??[]).filter(d=>d.courtId===o))?.[0];if(!u)return q({result:{error:Ic}});dg({element:u,onlineResource:r})}else if(l){let u=(i.venues??[]).find(c=>c.venueId===l);if(!u)return q({result:{error:gf}});dg({element:u,onlineResource:r})}else dg({element:i,onlineResource:r}),st({payload:{parentOrganisation:i.parentOrganisation,onlineResources:i.onlineResources,tournamentId:i.tournamentId},topic:vf});return{...W}}function dg({element:t,onlineResource:e}){let i=(t.onlineResources??[]).filter(r=>!(r?.[xP]===e[xP]&&r?.[FP]===e[FP]&&r?.[SI]===e[SI]));t.onlineResources=i}function Ude(t){let e=He(t,[{tournamentRecord:!0,onlineResource:!0}]);if(e.error)return e;let{tournamentRecord:i,onlineResource:r,organisationId:n,participantId:a,personId:s,courtId:o,venueId:l}=t;if(n){if(i.parentOrganisation?.parentOrganisationId!==n)return q({result:{error:Br}});pg({element:i.parentOrganisation,onlineResource:r})}else{if(a&&s&&a!==s)return q({result:{error:_p}});if(a||s){let u=(i.participants??[]).find(c=>s&&c.person?.personId===s||c.participantId===a);if(!u)return q(s?{result:{error:Br}}:{result:{error:ji}});if(s){if(u.person?.personId!==s)return q({result:{error:_p}});pg({element:u.person,onlineResource:r})}else pg({element:u,onlineResource:r})}else if(o){let u=(i.venues??[]).filter(c=>!l||c.venueId===l).flatMap(c=>(c.courts??[]).filter(d=>d.courtId===o))?.[0];if(!u)return q({result:{error:Ic}});pg({element:u,onlineResource:r})}else if(l){let u=(i.venues??[]).find(c=>c.venueId===l);if(!u)return q({result:{error:gf}});pg({element:u,onlineResource:r})}else pg({element:i,onlineResource:r}),st({payload:{parentOrganisation:i.parentOrganisation,onlineResources:i.onlineResources,tournamentId:i.tournamentId},topic:vf})}return{...W}}function pg({element:t,onlineResource:e}){let i=(t.onlineResources??[]).filter(r=>r?.[fx]!==e[fx]&&r?.[SI]!==e[SI]);return i.push(e),t.onlineResources=i,{...W}}function Tde({tournamentRecord:t,promotionalName:e,tournamentName:i,formalName:r}){if(!t)return{error:ve};let n=t.tournamentId,a={tournamentId:n};return i&&i!==t.tournamentName&&(t.tournamentName=i,a.tournamentName=i),e&&e!==t.promotionalName&&(t.promotionalName=e,a.promotionalName=e),r&&r!==t.formalName&&(t.formalName=r,a.formalName=r),t.promotionalName===t.tournamentName&&(delete t.promotionalName,a.promotionalName=""),t.formalName===t.tournamentName&&(delete t.formalName,a.formalName=""),Object.keys(a).length>1&&st({topic:vf,payload:{parentOrganisation:t.parentOrganisation,tournamentId:n,...a}}),{...W}}function Dde({tournamentRecord:t,notes:e}){if(!t)return{error:ve};let i=e?oN({element:t,notes:e}):uV({element:t});return i.error?i:(st({topic:vf,payload:{parentOrganisation:t.parentOrganisation,tournamentId:t.tournamentId,notes:e??""}}),{...W})}function Pde({tournamentRecord:t,categories:e}){return t?(e=(e||[]).filter(i=>i.categoryName&&i.type),t.tournamentCategories=e,st({topic:vf,payload:{parentOrganisation:t.parentOrganisation,tournamentId:t.tournamentId,categories:e}}),{...W}):{error:ve}}function gze({tournamentRecord:t}){if(!t)return{error:ve};let{startDate:e,endDate:i}=t,r=wI(e,i),n=[];for(let a of t.venues||[])a?.courts?.length&&n.push(...a.courts);for(let a of n){let{startTime:s,endTime:o}=(a.dateAvailability??[]).reduce((c,d)=>{let p=Rt(c.startTime),f=Rt(c.endTime);return d.startTime&&Rt(d.startTime)<p&&(c.startTime=d.startTime),d.endTime&&Rt(d.endTime)>f&&(c.endTime=d.endTime),c},{startTime:"08:00",endTime:"18:00"}),l=r.map(c=>a.dateAvailability?.find(d=>d.date===c)??{date:c,startTime:s,endTime:o}),u=a.dateAvailability?.find(c=>!c.date);u&&l.unshift(u),a.dateAvailability=l}return{...W}}function uA(t){let{tournamentRecord:e,startDate:i,endDate:r,weekdays:n}=t,a=t.activeDates?.filter(Boolean),s=He(t,[{tournamentRecord:!0},{[qr]:f=>dl.test(f),[Ba]:or,startDate:!1,endDate:!1},{[qr]:f=>f.filter(Boolean).every(m=>dl.test(m)),[Ba]:or,activeDates:!1},{[qr]:Xle,weekdays:!1}]);if(s.error)return s;if(r&&i&&new Date(r)<new Date(i))return{error:re};if(r&&i&&new Date(i)>new Date(r))return{error:re};if(a?.length){let f=i||e.startDate,m=r||e.endDate,h=!f||a.every(I=>new Date(I)>=new Date(f)),g=!m||a.every(I=>new Date(I)<=new Date(m));if(!h||!g)return{error:or}}let o;(i&&e.startDate&&new Date(i)>new Date(e.startDate)||r&&e.endDate&&new Date(r)<new Date(e.endDate))&&(o=!0);let l=wI(e.startDate,e.endDate);i&&(e.startDate=i),r&&(e.endDate=r);let u=wI(e.startDate,e.endDate),c=l.filter(f=>!u.includes(f)),d=u.filter(f=>!l.includes(f));for(let f of e.events??[])i&&f.startDate&&new Date(f.startDate)<new Date(i)&&(f.startDate=i),r&&f.startDate&&new Date(f.startDate)>new Date(r)&&(f.startDate=i??r),r&&f.endDate&&new Date(f.endDate)>new Date(r)&&(f.endDate=r),i&&f.endDate&&new Date(f.endDate)<new Date(i)&&(f.endDate=r??i);i&&e.endDate&&new Date(i)>new Date(e.endDate)&&(e.endDate=i),r&&e.startDate&&new Date(r)<new Date(e.startDate)&&(e.startDate=r),a&&(e.activeDates=a),n&&(e.weekdays=n);let p=o&&Ize({tournamentRecord:e})?.unscheduledMatchUpIds;return gze({tournamentRecord:e}),st({payload:je({parentOrganisation:e.parentOrganisation,tournamentId:e.tournamentId,activeDates:a,startDate:i,weekdays:n,endDate:r}),topic:vf}),{...W,unscheduledMatchUpIds:p,datesAdded:d,datesRemoved:c}}function Ede({tournamentRecord:t,startDate:e}){return e?uA({tournamentRecord:t,startDate:e}):{error:or}}function Rde({tournamentRecord:t,endDate:e}){return e?uA({tournamentRecord:t,endDate:e}):{error:or}}function Ize({tournamentRecord:t}){let e=Ur({tournamentRecord:t}).matchUps??[],i=t.startDate&&new Date(t.startDate),r=t.endDate&&new Date(t.endDate),n=[],a=[];for(let s of e){let{schedule:o,matchUpId:l}=s;if(o&&o.scheduledDate){let u=new Date(o.scheduledDate);(i&&u<i||r&&u>r)&&(a.push(l),n.includes(o.scheduledDate)||n.push(o.scheduledDate))}}return n.length&&!iA({scheduledDates:n,tournamentRecord:t}).clearedScheduleCount?{error:mte}:{unscheduledMatchUpIds:a}}var Cde={};dt(Cde,{BLOCK_TYPES:()=>Ot,EvaluatorRegistry:()=>Gde,adjacentBlockEvaluator:()=>NG,applyTemporalAvailabilityToTournamentRecord:()=>Jde,blockDurationEvaluator:()=>kG,buildDayRange:()=>Ade,buildEdges:()=>UG,buildSchedulingProfileFromUISelections:()=>Qde,calculateCapacityStats:()=>Ode,calculateCourtHours:()=>rpe,clampDragToCollisions:()=>Bde,clampToDayRange:()=>wG,compareCapacityCurves:()=>Lde,computePlanItemId:()=>pE,courtDayKey:()=>Qy,courtKey:()=>xg,courtOverlapEvaluator:()=>CG,createFollowByEvaluator:()=>Hde,dayBoundaryEvaluator:()=>OG,defaultEvaluators:()=>jde,deriveRailSegments:()=>DG,diffMinutes:()=>lT,extractDay:()=>np,filterCapacityCurve:()=>xde,findBlocksContainingTime:()=>$de,formatConflicts:()=>qde,generateCapacityCurve:()=>EG,getHighestSeverity:()=>zde,groupConflictsBySeverity:()=>Wde,hhmmToMinutes:()=>dw,intervalsOverlap:()=>_de,iterateDayTicks:()=>Kde,lightingEvaluator:()=>AG,maintenanceWindowEvaluator:()=>xG,matchWindowEvaluator:()=>MG,mergeAdjacentSegments:()=>PG,mergeOverlappingAvailability:()=>ipe,minutesToHhmm:()=>cA,overlappingRange:()=>Nde,railsToDateAvailability:()=>LG,rangesOverlap:()=>SG,resolveCourtId:()=>Kf,resolveStatus:()=>dE,resolveVenueId:()=>ym,runValidationPipeline:()=>Xde,sampleCapacityCurve:()=>Fde,snapIsoToGranularity:()=>Yde,snapToGranularity:()=>FG,sortBlocksByStart:()=>Vde,sortEdges:()=>TG,timeInsideBlock:()=>RG,todsAvailabilityToBlocks:()=>Zde,validateDateAvailability:()=>tpe,validateSchedulingProfileFormat:()=>epe,validateSegments:()=>kde,venueDayKey:()=>Mde,venueKey:()=>Hf});var Ot={MAINTENANCE:"MAINTENANCE",PRACTICE:"PRACTICE",RESERVED:"RESERVED",BLOCKED:"BLOCKED",CLOSED:"CLOSED",SCHEDULED:"SCHEDULED",SOFT_BLOCK:"SOFT_BLOCK",HARD_BLOCK:"HARD_BLOCK",LOCKED:"LOCKED",AVAILABLE:"AVAILABLE",UNSPECIFIED:"UNSPECIFIED"};function Qy(t,e){return`${t.tournamentId}|${t.venueId}|${t.courtId}|${e}`}function xg(t){return`${t.tournamentId}|${t.venueId}|${t.courtId}`}function Hf(t,e){return`${t}|${e}`}function Mde(t,e,i){return`${t}|${e}|${i}`}function ym(t){return t.venueId||t.venueName||"unknown-venue"}function Kf(t){return t.courtId||t.courtName||"unknown-court"}function wG(t,e){let i=t.start,r=t.end,n=e?.start,a=e?.end;if(r<=n||i>=a)return null;let s=i<n?n:i,o=r>a?a:r;return{...t,start:s,end:o}}function SG(t,e){return t?.start<e?.end&&e?.start<t?.end}function Nde(t,e){let i=t?.start>e?.start?t?.start:e?.start,r=t?.end<e?.end?t?.end:e?.end;return{start:i,end:r}}function lT(t,e){let i=new Date(t),r=(new Date(e).getTime()-i.getTime())/(1e3*60);return Number.isNaN(r)?0:r}function dE(t,e,i){if(t.length===0||!i||i.length===0)return Ot.AVAILABLE;let r=new Map(i.map((s,o)=>[s,o])),n=Ot.AVAILABLE,a=1/0;for(let s of t){let o=e.get(s);if(!o)continue;let l=r.get(o.type);l!==void 0&&l<a&&(a=l,n=o.type)}return n}function UG(t){let e=[];if(!Array.isArray(t))return e;for(let i of t)e.push({time:i.start,type:"START",blockId:i.id}),e.push({time:i.end,type:"END",blockId:i.id});return e}function TG(t){return Array.isArray(t)?t.slice().sort((e,i)=>{let r=e.time.localeCompare(i.time);return r!==0?r:e.type==="END"&&i.type==="START"?-1:e.type==="START"&&i.type==="END"?1:0}):[]}function DG(t,e,i){if(!Array.isArray(t)||!e||!i)return[];let r=t.map(u=>wG(u,e)).filter(u=>u!==null);if(r.length===0)return[{start:e.start,end:e.end,status:Ot.AVAILABLE,contributingBlocks:[]}];let n=new Map(r.map(u=>[u.id,u])),a=TG(UG(r)),s=new Set,o=[],l=e.start;for(let u of a){let c=u.time;if(c>l){let d=Array.from(s),p=dE(d,n,i.typePrecedence);o.push({start:l,end:c,status:p,contributingBlocks:d})}u.type==="START"?s.add(u.blockId):s.delete(u.blockId),l=c}if(l<e.end){let u=Array.from(s),c=dE(u,n,i.typePrecedence);o.push({start:l,end:e.end,status:c,contributingBlocks:u})}return PG(o)}function PG(t){if(t.length===0)return t;let e=[],i={...t[0]};for(let r=1;r<t.length;r++){let n=t[r],a=i.status===n.status,s=i.contributingBlocks.length===n.contributingBlocks.length&&i.contributingBlocks.every(l=>n.contributingBlocks.includes(l)),o=i.end===n.start;a&&s&&o?i.end=n.end:(e.push(i),i={...n})}return e.push(i),e}function np(t){return Ze(t)}function Ade(t,e){return{start:`${t}T${e?.dayStartTime}:00`,end:`${t}T${e?.dayEndTime}:00`}}function kde(t){for(let e=0;e<t.length;e++){let i=t[e];if(i.start>=i.end)return!1;if(e<t.length-1){let r=t[e+1];if(i.end>r.start||i.end!==r.start)return!1}}return!0}function EG(t,e){let i=new Set;if(!Array.isArray(e))return{day:t,points:[]};for(let a of e)for(let s of a.rails)for(let o of s.segments)i.add(o.start),i.add(o.end);let r=Array.from(i).sort(),n=r.map(a=>({time:a,courtsAvailable:0,courtsSoftBlocked:0,courtsHardBlocked:0}));for(let a of e)for(let s of a.rails)for(let o=0;o<r.length;o++){let l=r[o],u=vze(s.segments,l);if(u){let c=n[o];yze(u,c)}}return{day:t,points:n}}function vze(t,e){for(let i of t)if(e>=i.start&&e<i.end)return i;return null}function yze(t,e){switch(t.status){case Ot.AVAILABLE:e.courtsAvailable++;break;case Ot.RESERVED:case Ot.SOFT_BLOCK:e.courtsSoftBlocked++;break;case Ot.BLOCKED:case Ot.PRACTICE:case Ot.MAINTENANCE:case Ot.CLOSED:e.courtsSoftBlocked++;break;case Ot.SCHEDULED:case Ot.HARD_BLOCK:case Ot.LOCKED:e.courtsHardBlocked++;break}}function Ode(t){if(!t.points||t.points.length===0)return{peakAvailable:0,peakTime:"",minAvailable:0,minTime:"",avgAvailable:0,totalCourtHours:0,utilizationPercent:0,peakUnavailable:0,peakUnavailableTime:"",totalCourts:0,totalAvailableHours:0,totalUnavailableHours:0,availablePercent:0,avgBlockedHoursPerCourt:0};let e=0,i=t.points[0].time,r=1/0,n=t.points[0].time,a=0,s=t.points[0].time,o=0,l=0,u=0;for(let g=0;g<t.points.length-1;g++){let I=t.points[g],v=t.points[g+1],w=(new Date(v.time).getTime()-new Date(I.time).getTime())/(1e3*60*60),y=I.courtsAvailable+I.courtsSoftBlocked+I.courtsHardBlocked;u=Math.max(u,y);let b=I.courtsSoftBlocked+I.courtsHardBlocked;I.courtsAvailable>e&&(e=I.courtsAvailable,i=I.time),I.courtsAvailable<r&&(r=I.courtsAvailable,n=I.time),b>a&&(a=b,s=I.time),o+=I.courtsAvailable*w,l+=b*w}let c=(new Date(t.points.at(-1).time).getTime()-new Date(t.points[0].time).getTime())/(1e3*60*60),d=u*c,p=d>0?o/d*100:0,f=d>0?l/d*100:0,m=u>0?l/u:0,h=t.points.length>1?t.points.slice(0,-1).reduce((g,I)=>g+I.courtsAvailable,0)/(t.points.length-1):0;return{peakAvailable:e,peakTime:i,minAvailable:r===1/0?0:r,minTime:n,avgAvailable:h,totalCourtHours:d,utilizationPercent:f,peakUnavailable:a,peakUnavailableTime:s,totalCourts:u,totalAvailableHours:o,totalUnavailableHours:l,availablePercent:p,avgBlockedHoursPerCourt:m}}function xde(t,e){let i=t.points?.filter(r=>r.time>=e.start&&r.time<=e.end);return{...t,points:i}}function Fde(t,e){if(!t.points||t.points.length===0)return t;let i=[],r=new Date(t.points[0].time),n=new Date(t.points.at(-1).time),a=new Date(r);for(;a<=n;){let s=a.toISOString(),o=bze(t.points,s);o&&i.push(o),a=new Date(a.getTime()+e*60*1e3)}return{...t,points:i}}function bze(t,e){for(let i=t.length-1;i>=0;i--)if(t[i].time<=e)return{time:e,courtsAvailable:t[i].courtsAvailable,courtsSoftBlocked:t[i].courtsSoftBlocked,courtsHardBlocked:t[i].courtsHardBlocked};return null}function Lde(t,e){let i=[],r=new Set;t.points?.forEach(a=>r.add(a.time)),e?.points?.forEach(a=>r.add(a.time));let n=Array.from(r).sort();for(let a of n){let s=t.points?.find(l=>l.time===a)||{courtsAvailable:0,courtsSoftBlocked:0,courtsHardBlocked:0},o=e.points?.find(l=>l.time===a)||{courtsAvailable:0,courtsSoftBlocked:0,courtsHardBlocked:0};i.push({time:a,availableDelta:o.courtsAvailable-s.courtsAvailable,softBlockedDelta:o.courtsSoftBlocked-s.courtsSoftBlocked,hardBlockedDelta:o.courtsHardBlocked-s.courtsHardBlocked})}return i}function _de(t,e){let i=new Date(t.start?.endsWith("Z")?t.start:t.start+"Z").getTime(),r=new Date(t.end?.endsWith("Z")?t.end:t.end+"Z").getTime(),n=new Date(e?.start?.endsWith("Z")?e?.start:e?.start+"Z").getTime(),a=new Date(e?.end?.endsWith("Z")?e?.end:e?.end+"Z").getTime();return i<a&&r>n}function RG(t,e){let i=new Date(e?.start?.endsWith("Z")?e?.start:e?.start+"Z").getTime(),r=new Date(e?.end?.endsWith("Z")?e?.end:e?.end+"Z").getTime();return i<=t&&t<r}function $de(t,e){return Array.isArray(e)?e.filter(i=>RG(t,i)):[]}function Bde(t,e,i){let r=e>=t?"forward":"backward",n=Math.min(t,e),a=Math.max(t,e),s,o,l=!1,u;if(r==="forward"){let c=a;for(let d of i){let p=new Date(d.start.endsWith("Z")?d.start:d.start+"Z").getTime(),f=new Date(d.end.endsWith("Z")?d.end:d.end+"Z").getTime();p>t&&p<a&&p<c&&(c=p,l=!0,u=d),p<a&&f>t&&p<c&&p>t&&(c=p,l=!0,u=d)}s=t,o=c}else{let c=n;if(Array.isArray(i))for(let d of i){let p=new Date(d.start.endsWith("Z")?d.start:d.start+"Z").getTime(),f=new Date(d.end.endsWith("Z")?d.end:d.end+"Z").getTime();f<t&&f>n&&f>c&&(c=f,l=!0,u=d),p<t&&f>n&&f>c&&f<t&&(c=f,l=!0,u=d)}s=c,o=t}return{start:s,end:o,clamped:l,clampedBy:u,direction:r}}function Vde(t){Array.isArray(t)&&t.sort((e,i)=>{let r=new Date(e.start.endsWith("Z")?e.start:e.start+"Z").getTime(),n=new Date(i.start.endsWith("Z")?i.start:i.start+"Z").getTime();return r-n})}var CG={id:"COURT_OVERLAP",description:"Prevent double-booking courts or overriding hard blocks",evaluate:(t,e)=>{let i=[];for(let r of e){if(r.kind==="REMOVE_BLOCK")continue;let n=r.block,a=Ze(n.start),s=`${n.court.tournamentId}|${n.court.venueId}|${n.court.courtId}|${a}`,o=t.blocksByCourtDay.get(s)||[];for(let l of o){if(l===n.id)continue;let u=t.blocksById.get(l);if(u&&SG(n,u)){let c=u.type===Ot.HARD_BLOCK||u.type===Ot.LOCKED||n.type===Ot.HARD_BLOCK||n.type===Ot.LOCKED?"ERROR":"WARN",d=n.start>u.start?n.start:u.start,p=n.end<u.end?n.end:u.end;i.push({code:"COURT_OVERLAP",message:`Block overlaps existing ${u.type.toLowerCase()} (${u.reason||"no reason"}) on court ${n.court.courtId}`,severity:c,timeRange:{start:d,end:p},courts:[n.court]})}}}return i}},MG={id:"MATCH_WINDOW",description:"Ensure availability windows are large enough for typical matches",evaluate:(t,e)=>{let i=[],r=new Set;for(let n of e){let a=n.block,s=Ze(a.start),o=`${a.court.tournamentId}|${a.court.venueId}|${a.court.courtId}|${s}`;r.add(o)}for(let n of r){let a=(t.blocksByCourtDay.get(n)||[]).map(o=>t.blocksById.get(o)).filter(Boolean).slice().sort((o,l)=>o.start.localeCompare(l.start)),s=null;for(let o of a)if(o.type!==Ot.AVAILABLE&&o.type!==Ot.SOFT_BLOCK&&o.type!==Ot.RESERVED){if(s){let l=lT(s,o.start);l>0&&l<60&&i.push({code:"MATCH_WINDOW_TOO_SMALL",message:`Availability window (${l} minutes) is smaller than typical match duration (60 minutes)`,severity:"WARN",timeRange:{start:s,end:o.start},courts:[o.court]})}s=o.end}}return i}},NG={id:"ADJACENT_BLOCK",description:"Warn about blocks with no transition time",evaluate:(t,e)=>{let i=[];for(let r of e){if(r.kind==="REMOVE_BLOCK")continue;let n=r.block,a=Ze(n.start),s=`${n.court.tournamentId}|${n.court.venueId}|${n.court.courtId}|${a}`,o=t.blocksByCourtDay.get(s)||[];for(let l of o){if(l===n.id)continue;let u=t.blocksById.get(l);u&&(u.end===n.start||n.end===u.start)&&u.type!==n.type&&i.push({code:"NO_TRANSITION_TIME",message:`${n.type} immediately follows ${u.type} with no transition time (recommended: 15 minutes)`,severity:"INFO",timeRange:{start:u.end,end:n.start},courts:[n.court]})}}return i}},AG={id:"LIGHTING",description:"Prevent scheduling on unlit courts after sunset",evaluate:(t,e)=>{let i=[],r="19:00";for(let n of e){if(n.kind==="REMOVE_BLOCK")continue;let a=n.block;a.end.slice(11,16)>r&&(a.type===Ot.AVAILABLE||a.type===Ot.RESERVED)&&i.push({code:"AFTER_SUNSET",message:`Court scheduled after sunset (${r}). Verify court has adequate lighting.`,severity:"WARN",timeRange:{start:`${a.start.slice(0,11)}${r}:00`,end:a.end},courts:[a.court]})}return i}},kG={id:"BLOCK_DURATION",description:"Validate block durations are reasonable",evaluate:(t,e)=>{let i=[];for(let r of e){if(r.kind==="REMOVE_BLOCK")continue;let n=r.block,a=lT(n.start,n.end);a<15?i.push({code:"BLOCK_TOO_SHORT",message:`Block duration (${a} minutes) is unusually short. Minimum recommended: 15 minutes.`,severity:"WARN",timeRange:n,courts:[n.court]}):a>720&&i.push({code:"BLOCK_TOO_LONG",message:`Block duration (${a/60} hours) is unusually long. Maximum recommended: ${720/60} hours.`,severity:"WARN",timeRange:n,courts:[n.court]})}return i}},OG={id:"DAY_BOUNDARY",description:"Ensure blocks do not span multiple days",evaluate:(t,e)=>{let i=[];for(let r of e){if(r.kind==="REMOVE_BLOCK")continue;let n=r.block,a=Ze(n.start),s=Ze(n.end);a!==s&&i.push({code:"SPANS_MULTIPLE_DAYS",message:`Block spans from ${a} to ${s}. Blocks should be contained within a single day.`,severity:"ERROR",timeRange:n,courts:[n.court]})}return i}},xG={id:"MAINTENANCE_WINDOW",description:"Validate maintenance scheduling practices",evaluate:(t,e)=>{let i=[],r="09:00",n="17:00";for(let a of e){if(a.kind==="REMOVE_BLOCK")continue;let s=a.block;if(s.type===Ot.MAINTENANCE){let o=s.start.slice(11,16),l=s.end.slice(11,16),u=lT(s.start,s.end);(o>=r&&o<n||l>r&&l<=n)&&i.push({code:"MAINTENANCE_DURING_PEAK",message:`Maintenance scheduled during peak hours (${r}-${n}). Consider scheduling during off-peak times.`,severity:"INFO",timeRange:s,courts:[s.court]}),u<30&&i.push({code:"MAINTENANCE_TOO_SHORT",message:`Maintenance duration (${u} minutes) may be insufficient. Recommended minimum: 30 minutes.`,severity:"INFO",timeRange:s,courts:[s.court]})}}return i}},jde=[CG,OG,kG,MG,NG,AG,xG],Gde=class{constructor(){this.evaluators=new Map}register(t){this.evaluators.set(t.id,t)}unregister(t){this.evaluators.delete(t)}get(t){return this.evaluators.get(t)}getAll(){return Array.from(this.evaluators.values())}clear(){this.evaluators.clear()}},Hde=t=>({id:"FOLLOW_BY",description:"Player rest and follow-by conflicts using Competition Factory",evaluate:(e,i)=>[]});function Wde(t){return Array.isArray(t)?{errors:t?.filter(e=>e.severity==="ERROR"),warnings:t.filter(e=>e.severity==="WARN"),info:t.filter(e=>e.severity==="INFO")}:{errors:[],warnings:[],info:[]}}function zde(t){return Array.isArray(t)?t.some(e=>e.severity==="ERROR")?"ERROR":t.some(e=>e.severity==="WARN")?"WARN":t.some(e=>e.severity==="INFO")?"INFO":null:null}function qde(t){return Array.isArray(t)?t.map(e=>{let i=e.courts.map(n=>n.courtId).join(", "),r=`${e.timeRange.start.slice(11,16)}-${e.timeRange.end.slice(11,16)}`;return`[${e.severity}] ${e.code}: ${e.message} (${i} @ ${r})`}):[]}function dw(t){if(typeof t!="string")return 0;let[e,i]=t.split(":").map(Number);return e*60+i}function cA(t){let e=Math.max(0,Math.min(1439,Math.round(t))),i=Math.floor(e/60),r=e%60;return`${String(i).padStart(2,"0")}:${String(r).padStart(2,"0")}`}function FG(t,e,i="round"){if(e<=0)return t;switch(i){case"floor":return Math.floor(t/e)*e;case"ceil":return Math.ceil(t/e)*e;case"round":return Math.round(t/e)*e}}function Yde(t,e,i="round"){if(!t||typeof t!="string")return t;let r=t.slice(0,10),n=t.slice(11,16),a=dw(n),s=FG(a,e,i),o=cA(s);return`${r}T${o}:00`}function*Kde(t,e,i){if(i<=0)return;let r=dw(t),n=dw(e);for(let a=r;a<n;a+=i)yield cA(a)}function pE(t){let e=[t.day,t.venueId,t.eventId];return t.drawId&&e.push(t.drawId),e.push(`R${t.roundNumber}`),e.join("|")}function wze(t,e){let i=[],r=new Set(t.getTournamentDays()),n=t.listCourtMeta(),a=new Set(n.map(s=>s.ref.venueId));for(let s of e){r.has(s.day)||i.push({ruleId:"PRECHECK_INVALID_DAY",phase:"PRECHECK",severity:"ERROR",message:`Day '${s.day}' is not within the tournament date range`,context:{day:s.day}});for(let o of s.items)a.has(o.venueId)||i.push({ruleId:"PRECHECK_INVALID_VENUE",phase:"PRECHECK",severity:"ERROR",message:`Venue '${o.venueId}' does not exist in the tournament record`,context:{day:s.day,venueId:o.venueId,planItemId:o.planItemId}}),o.notBeforeTime&&!/^\d{2}:\d{2}$/.test(o.notBeforeTime)&&i.push({ruleId:"PRECHECK_INVALID_TIME_FORMAT",phase:"PRECHECK",severity:"ERROR",message:`notBeforeTime '${o.notBeforeTime}' is not valid HH:MM format`,context:{day:s.day,planItemId:o.planItemId}}),o.roundNumber<1&&i.push({ruleId:"PRECHECK_INVALID_ROUND",phase:"PRECHECK",severity:"ERROR",message:`roundNumber must be >= 1, got ${o.roundNumber}`,context:{day:s.day,planItemId:o.planItemId}})}return i}function Sze(t,e){let i=[],r=new Set;for(let n of e)for(let a of n.items)r.has(a.planItemId)&&i.push({ruleId:"INTEGRITY_DUPLICATE_PLAN_ITEM",phase:"INTEGRITY",severity:"ERROR",message:`Duplicate plan item '${a.planItemId}'`,context:{day:n.day,planItemId:a.planItemId}}),r.add(a.planItemId);return i}function Uze(t,e){let i=[],r=new Map;for(let n of e)for(let a of n.items){let s=`${a.eventId}|${a.drawId||""}`,o=r.get(s)||[];o.push({day:n.day,roundNumber:a.roundNumber,planItemId:a.planItemId}),r.set(s,o)}for(let[n,a]of r.entries()){if(a.length<2)continue;let s=[...a].sort((o,l)=>o.roundNumber-l.roundNumber);for(let o=1;o<s.length;o++){let l=s[o-1],u=s[o];u.day<l.day&&i.push({ruleId:"ORDERING_ROUND_DAY_SEQUENCE",phase:"ORDERING",severity:"WARN",message:`Round ${u.roundNumber} is scheduled on ${u.day} which is before round ${l.roundNumber} on ${l.day} (event: ${n.split("|")[0]})`,context:{day:u.day,planItemId:u.planItemId},fixAction:{type:"MOVE_PLAN_ITEM",description:`Move round ${u.roundNumber} to ${l.day} or later`,payload:{planItemId:u.planItemId,suggestedDay:l.day}}})}}return i}function Tze(t,e){let i=[];for(let r of e){let n=0,a=r.items.filter(p=>p.estimatedDurationMinutes);for(let p of a)n+=p.estimatedDurationMinutes;if(n===0)continue;let s=t.getVisibleTimeRange(r.day),o=Kq(s.startTime),l=Kq(s.endTime)-o,u=t.listCourtMeta(),c=new Set(r.items.map(p=>p.venueId)),d=(c.size===1?u.filter(p=>p.ref.venueId===[...c][0]):u).length*l;n>d?i.push({ruleId:"CAPACITY_DEMAND_EXCEEDS_SUPPLY",phase:"CAPACITY",severity:"WARN",message:`Estimated demand (${Math.round(n/60)}h) exceeds available court-hours (${Math.round(d/60)}h) on ${r.day}`,context:{day:r.day}}):n>d*.9&&i.push({ruleId:"CAPACITY_NEAR_LIMIT",phase:"CAPACITY",severity:"INFO",message:`Demand is at ${Math.round(n/d*100)}% of capacity on ${r.day}`,context:{day:r.day}})}return i}function Kq(t){let[e,i]=t.split(":").map(Number);return e*60+i}var Xq=["PRECHECK","INTEGRITY","ORDERING","CAPACITY"],Dze={PRECHECK:wze,INTEGRITY:Sze,ORDERING:Uze,CAPACITY:Tze};function Xde(t){let{engine:e,day:i,phases:r}=t,n;if(i){let l=e.getDayPlan(i);n=l?[l]:[]}else n=e?.getAllPlans();let a=r?Xq.filter(l=>r.includes(l)):Xq,s=[];for(let l of a){let u=Dze[l],c=u(e,n);if(s.push(...c),l==="PRECHECK"&&c.some(d=>d.severity==="ERROR"))break}let o=new Map;for(let l of s){let u=l.context?.planItemId||"__global__",c=o.get(u)||[];c.push(l),o.set(u,c)}return{results:s,issueIndex:o}}var Pze={courtToCourtId:t=>t.courtId,isSchedulableStatus:t=>t===Ot.AVAILABLE||t===Ot.SOFT_BLOCK||t===Ot.RESERVED,aggregateByVenue:!1};function LG(t,e={}){let i={...Pze,...e},r=[];for(let n of t){let{day:a,venueId:s,rails:o}=n;for(let l of o){let{court:u,segments:c}=l,d=i.courtToCourtId(u),p=Eze(c,i);for(let f of p)r.push({date:a,startTime:Jq(f.start),endTime:Jq(f.end),venueId:s,courtIds:[d]})}}return i.aggregateByVenue?Rze(r):r}function Eze(t,e){let i=[],r=null,n=null;for(let a of t)e.isSchedulableStatus(a.status)?(r||(r=a.start),n=a.end):(r&&n&&i.push({start:r,end:n}),r=null,n=null);return r&&n&&i.push({start:r,end:n}),i}function Jq(t){return t.slice(11,16)}function Rze(t){let e=new Map;for(let i of t){let r=`${i.venueId}|${i.date}|${i.startTime}|${i.endTime}`;if(e.has(r)){let n=e.get(r);i.courtIds&&(n.courtIds=[...n.courtIds||[],...i.courtIds])}else e.set(r,{...i})}return Array.from(e.values())}function Jde(t){let{tournamentRecord:e,timelines:i,config:r={},engine:n}=t,a=LG(i,r),s=structuredClone(e),o=new Map;for(let l of a){let u=o.get(l.venueId)||[];u.push(l),o.set(l.venueId,u)}if(s.venues&&Array.isArray(s.venues)){let l=n?.getConfig()?.tournamentId;for(let u of s.venues){let c=ym(u),d=o.get(c);if(d&&(u.dateAvailability=d),n&&l){let p=n.getVenueAvailability(l,c);p&&(u.defaultStartTime=p.startTime,u.defaultEndTime=p.endTime)}}}return s}function Qde(t){let e=[];for(let i of t)!i.scheduleDate||!i.venueIds.length||e.push({scheduleDate:i.scheduleDate,venueIds:i.venueIds,rounds:i.rounds||[]});return e}function Zde(t){let{venue:e,tournamentId:i,blockType:r=Ot.AVAILABLE}=t,n=[];if(!e.dateAvailability)return n;let a=ym(e);for(let s of e.dateAvailability){let{date:o,startTime:l,endTime:u,courtIds:c}=s;if(c&&c.length>0)for(let d of c)n.push({court:{tournamentId:i,venueId:a,courtId:d},start:`${o}T${l}:00`,end:`${o}T${u}:00`,type:r});else if(e.courts&&e.courts.length>0)for(let d of e.courts){let p=Kf(d);n.push({court:{tournamentId:i,venueId:a,courtId:p},start:`${o}T${l}:00`,end:`${o}T${u}:00`,type:r})}}return n}function epe(t){let e=[];if(!Array.isArray(t))return e.push("Profile must be an array"),{valid:!1,errors:e};for(let i=0;i<t.length;i++){let r=t[i];if(r.scheduleDate?/^\d{4}-\d{2}-\d{2}$/.test(r.scheduleDate)||e.push(`Item ${i}: invalid scheduleDate format (expected YYYY-MM-DD)`):e.push(`Item ${i}: missing scheduleDate`),(!r.venueIds||!Array.isArray(r.venueIds)||r.venueIds.length===0)&&e.push(`Item ${i}: missing or empty venueIds array`),r.rounds)if(!Array.isArray(r.rounds))e.push(`Item ${i}: rounds must be an array`);else for(let n=0;n<r.rounds.length;n++)r.rounds[n].eventId||e.push(`Item ${i}, round ${n}: missing eventId`)}return{valid:e.length===0,errors:e}}function tpe(t){let e=[];if(!Array.isArray(t))return e.push("Entries must be an array"),{valid:!1,errors:e};for(let i=0;i<t.length;i++){let r=t[i];(!r.date||!/^\d{4}-\d{2}-\d{2}$/.test(r.date))&&e.push(`Entry ${i}: invalid or missing date`),(!r.startTime||!/^\d{2}:\d{2}$/.test(r.startTime))&&e.push(`Entry ${i}: invalid or missing startTime (expected HH:MM)`),(!r.endTime||!/^\d{2}:\d{2}$/.test(r.endTime))&&e.push(`Entry ${i}: invalid or missing endTime (expected HH:MM)`),r.startTime&&r.endTime&&r.startTime>=r.endTime&&e.push(`Entry ${i}: startTime must be before endTime`),r.venueId||e.push(`Entry ${i}: missing venueId`)}return{valid:e.length===0,errors:e}}function ipe(t){if(t.length===0)return t;let e=new Map;for(let r of t){let n=`${r.venueId}|${r.date}`,a=e.get(n)||[];a.push(r),e.set(n,a)}let i=[];for(let r of e.values()){r.sort((a,s)=>a.startTime.localeCompare(s.startTime));let n={...r[0]};for(let a=1;a<r.length;a++){let s=r[a];s.startTime<=n.endTime?(n.endTime=s.endTime>n.endTime?s.endTime:n.endTime,n.courtIds&&s.courtIds&&(n.courtIds=[...new Set([...n.courtIds,...s.courtIds])])):(i.push(n),n={...s})}i.push(n)}return i}function rpe(t){let e=0;for(let i of t){let r=Qq(i.startTime),n=(Qq(i.endTime)-r)/60,a=i.courtIds?.length||1;e+=n*a}return e}function Qq(t){let[e,i]=t.split(":").map(Number);return e*60+i}var npe={};dt(npe,{addCourt:()=>oA,addCourts:()=>fG,addVenue:()=>RU,deleteCourt:()=>fpe,deleteVenue:()=>VG,deleteVenues:()=>lpe,disableCourts:()=>upe,disableVenues:()=>cpe,enableCourts:()=>dpe,enableVenues:()=>ppe,generate:()=>ape,generateCourts:()=>Vj,getCompetitionVenues:()=>qU,getCourts:()=>Ej,getVenuesAndCourts:()=>Fu,modifyCourt:()=>jG,modifyCourtAvailability:()=>$G,modifyVenue:()=>mpe,mutate:()=>spe,publicFindVenue:()=>D2,query:()=>Cle});var ape={};dt(ape,{generateCourts:()=>Vj});var spe={};dt(spe,{addCourt:()=>oA,addCourts:()=>fG,addVenue:()=>RU,deleteCourt:()=>fpe,deleteVenue:()=>VG,deleteVenues:()=>lpe,disableCourts:()=>upe,disableVenues:()=>cpe,enableCourts:()=>dpe,enableVenues:()=>ppe,modifyCourt:()=>jG,modifyCourtAvailability:()=>$G,modifyVenue:()=>mpe});function _G(t){if(!t?.tournamentRecord&&!Array.isArray(t?.venueMatchUps))return{error:ve};if(!t?.courtId)return{error:Mh};let{scheduleVisibilityFilters:e,tournamentRecord:i,matchUpFilters:r,venueMatchUps:n,courtId:a}=t,{schedulingProfile:s}=Wc({tournamentRecord:i});if(Array.isArray(n))return{matchUps:l({matchUps:n,courtId:a})};let{matchUps:o}=Ur({scheduleVisibilityFilters:e,tournamentRecord:i,matchUpFilters:r});return{matchUps:l({matchUps:o,courtId:a})};function l({matchUps:u,courtId:c}){let d=u.filter(p=>{let f=p.schedule?.allocatedCourts?.map(({courtId:m})=>m);return p.schedule?.courtId===c||f?.includes(c)});return rE({matchUps:d,schedulingProfile:s})}}function Cze({scheduleVisibilityFilters:t,tournamentRecord:e,matchUpFilters:i,venueId:r}){if(!e)return{error:ve};if(!r)return{error:zd};let{schedulingProfile:n}=Wc({tournamentRecord:e}),{matchUps:a}=Ur({scheduleVisibilityFilters:t,tournamentRecord:e,matchUpFilters:i});return{matchUps:s({matchUps:a,venueId:r})};function s({matchUps:o,venueId:l}){let u=o.filter(c=>{let d=c.schedule?.allocatedCourts?.map(({venueId:p})=>p);return c.schedule?.venueId===l||d?.includes(l)});return rE({matchUps:u,schedulingProfile:n})}}function $G({tournamentRecord:t,dateAvailability:e,disableNotice:i,venueMatchUps:r,courtId:n,force:a}){if(!t)return{error:ve};if(!n)return{error:Mh};let s=YM({dateAvailability:e});if(s.error)return s;let{updatedDateAvailability:o,totalMergeCount:l}=Mze(e);e=o;let u=Zd({tournamentRecord:t,courtId:n});if(u.error)return u;let{court:c,venue:d}=u,{matchUps:p}=_G({tournamentRecord:t,venueMatchUps:r,courtId:n});if(p?.length){let f=Dt({tournamentRecord:t})?.appliedPolicies,m=a??f?.[qd]?.allowDeletionWithScoresPresent?.courts,h=[];h.length&&(m||console.log("throw error: scheduled court matchUps",h.length))}return c&&(c.dateAvailability=e,!i&&d&&st({payload:{venue:d,tournamentId:t.tournamentId},topic:Vc,key:d.venueId})),{...W,totalMergeCount:l}}function Mze(t){let e=0,i=t.reduce((n,a)=>{let{date:s,startTime:o,endTime:l,bookings:u}=a;return n[s]||(n[s]=[]),n[s].push({startTime:o,endTime:l,bookings:u}),n},{}),r=[];return Object.keys(i).forEach(n=>{i[n].sort(ZLe);let{mergedAvailability:a,mergeCount:s}=Nze(i[n]);r.push(...a.map(o=>({date:n,...o}))),e+=s}),{updatedDateAvailability:r,totalMergeCount:e}}function Nze(t){let e,i,r,n=t.length,a=0,s=[];for(;t.length&&n;){let l=t.shift(),{startTime:u,endTime:c,bookings:d}=l;if(n-=1,!e)e=u,r=d,i=c;else if(rU(Ji(i),Ji(u),!1)>0){let p={startTime:e,endTime:i};r?.length&&(p.bookings=r),s.push(p),e=u,r=d,i=c}else d&&(r?r.push(d):r=d),i=c,a+=1}let o={startTime:e,endTime:i};return r?.length&&(o.bookings=r),s.push(o),{mergedAvailability:s,mergeCount:a}}function BG({matchUpsCount:t=0}){let e=`Schedule would be deleted from ${t} ${t===1?"matchUp":"matchUps"}; use { force: true }`;return{error:Die,info:e}}function ope({tournamentRecord:t,drawDefinition:e,matchUpId:i,drawId:r}){let n="removeCourtAssignment";if(!i)return{error:Tn};if(!e&&!r)return{error:xo};let a;if(!e){if(!t)return{error:ve};({drawDefinition:e}=Wn({tournamentRecord:t,drawId:r}))}if(e)({matchUp:a}=fi({drawDefinition:e,matchUpId:i}));else{if(!t)return{error:ve};let s=Ur({tournamentRecord:t,inContext:!1}).matchUps??[];({matchUp:a}=Tse({matchUps:s,matchUpId:i}))}return a?(a.timeItems&&a.timeItems.find(s=>[Ed,wu].includes(s.itemType))&&(a.timeItems=a.timeItems.filter(({itemType:s})=>![Ed,wu].includes(s)),Ut({tournamentId:t?.tournamentId,context:n,drawDefinition:e,matchUp:a})),{...W}):{error:dn}}function VG(t){if(typeof t?.venueId!="string")return{error:zd};let{tournamentRecord:e,venueId:i,force:r}=t,n=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(!Object.keys(n).length)return{error:ve};let a=No({tournamentRecords:n,contextFilters:{venueIds:[i]}}).matchUps??[],s=Dt({tournamentRecord:e})?.appliedPolicies,o=r??s?.[qd]?.allowDeletionWithScoresPresent?.venues;if(!a.length||o)for(let l of Object.values(n)){for(let c of a){let d=ope({matchUpId:c.matchUpId,drawId:c.drawId,tournamentRecord:l});if(d.error)return d}let u;l.venues=(l.venues??[]).filter(c=>c?.venueId!==i?!0:(u=!0,!1)),u&&st({payload:{venueId:i,tournamentId:l.tournamentId},topic:i2,key:i})}else return BG({matchUpsCount:a.length});return ZU({tournamentRecords:n}),{...W}}function lpe({tournamentRecord:t,venueIds:e,force:i}){if(!t)return{error:ve};if(!Array.isArray(e))return{error:re};for(let r of t.venues||[]){let{venueId:n}=r;if(e.includes(n)){let{venueId:a}=r,s=VG({tournamentRecord:t,venueId:a,force:i});if(s.error)return s}}return{...W}}function upe(t){let{courtIds:e,dates:i}=t,r=ws(t),n=[{[pn]:!0,[NM]:!0}],a=He(t,n);if(a.error)return a;for(let s of Object.values(r))Aze({tournamentRecord:s,courtIds:e,dates:i});return{...W}}function Aze({tournamentRecord:t,courtIds:e,dates:i}){let r=Array.isArray(i)&&i.length?{dates:i}:!0,n=a=>Ft({extension:{value:r,name:bo},creationTime:!1,element:a});for(let a of t.venues||[])for(let s of a.courts||[])if(e?.includes(s.courtId)){let o=n(s);if(o.error)return o}return{...W}}function cpe(t){let{tournamentRecords:e,tournamentId:i,venueIds:r}=t,n=[{[pn]:!0,[AM]:!0}],a=He(t,n);if(a.error)return a;let s=Object.keys(e).filter(o=>!i||o===i);for(let o of s){let l=e[o];kze({tournamentRecord:l,venueIds:r})}return{...W}}function kze({tournamentRecord:t,venueIds:e}){for(let i of t.venues||[])if(e?.includes(i.venueId)){let r=Ft({creationTime:!1,element:i,extension:{name:bo,value:!0}});if(r.error)return r}return{...W}}function dpe(t){let e=ws(t),i=[{[pn]:!0}];!t.enableAll&&i.push({[NM]:!0});let r=He(t,i);if(r.error)return r;let{enableAll:n,courtIds:a,dates:s}=t;for(let o of Object.values(e))Oze({tournamentRecord:o,courtIds:a,enableAll:n,dates:s});return{...W}}function Oze({tournamentRecord:t,courtIds:e,enableAll:i,dates:r}){for(let n of t.venues||[])for(let a of n.courts||[])if(i||e?.includes(a.courtId))if(Array.isArray(r)){let{extension:s}=ht({element:a,name:bo});if(s){let o=s.value;Array.isArray(o.dates)&&(o.dates=o.dates.filter(l=>!r.includes(l))),Ft({extension:{name:bo,value:o},creationTime:!1,element:a})}}else Nn({element:a,name:bo});return{...W}}function ppe(t){let e=ws(t),i=[{[pn]:!0}];!t.enableAll&&i.push({[AM]:!0});let r=He(t,i);if(r.error)return r;let{venueIds:n,enableAll:a}=t;for(let s of Object.values(e))for(let o of s.venues||[])(a||n?.includes(o.venueId))&&Nn({element:o,name:bo});return{...W}}function fpe(t){let{courtId:e,disableNotice:i,force:r}=t,n=ws(t),a=He(t,[{[pn]:!0,[Wre]:!0}]);if(a.error)return a;let s,o;for(let l of Object.values(n)){if(o=xze({tournamentRecord:l,disableNotice:i,courtId:e,force:r}),o.error&&o.error!==Ic)return o;o.success&&(s=!0)}return s?{...W}:o}function xze({tournamentRecord:t,disableNotice:e,courtId:i,force:r}){let n=Zd({tournamentRecord:t,courtId:i});if(n.error)return n;let a=n.venue,{matchUps:s}=_G({tournamentRecord:t,courtId:i}),o=Dt({tournamentRecord:t})?.appliedPolicies,l=r??o?.[qd]?.allowDeletionWithScoresPresent?.courts;if(!s?.length||l){for(let u of s??[]){let c=ope({matchUpId:u.matchUpId,drawId:u.drawId,tournamentRecord:t});if(c.error)return c}a&&(a.courts=(a.courts??[]).filter(u=>u.courtId!==i),e||st({payload:{venue:a,tournamentId:t.tournamentId},topic:Vc,key:a.venueId}))}else return BG({matchUpsCount:s.length});return{...W}}function jG(t){let{disableNotice:e,modifications:i,courtId:r,force:n,venueMatchUps:a}=t,s=ws(t);if(!Object.keys(s).length)return{error:Mi};let o;for(let l of Object.values(s)){let u=Fze({tournamentRecord:l,disableNotice:e,venueMatchUps:a,modifications:i,courtId:r,force:n});if(u?.error)return u;o=!0}return o?{...W}:void 0}function Fze({tournamentRecord:t,disableNotice:e,venueMatchUps:i,modifications:r,courtId:n,force:a}){if(!t)return{error:ve};if(!n)return{error:Mh};if(!r||typeof r!="object")return{error:$c};let s=Zd({tournamentRecord:t,courtId:n});if(s.error)return s;let{venue:o,court:l}=s,u=Object.keys(NWe()).filter(p=>p!=="courtId");if(!Object.keys(r).filter(p=>u.includes(p)).length)return{error:mM};let c=new Set(u.filter(p=>!["dateAvailability"].includes(p))),d=Object.keys(r).filter(p=>c.has(p));if(l&&d.forEach(p=>Object.assign(l,{[p]:r[p]})),r.dateAvailability){let p=$G({dateAvailability:r.dateAvailability,tournamentRecord:t,venueMatchUps:i,disableNotice:e,courtId:n,force:a});if(p.error)return p}return e||st({payload:{venue:o,tournamentId:t.tournamentId},topic:Vc,key:o?.venueId}),{...W,court:Oe(l)}}var Lze=()=>({venueId:void 0,venueName:"",venueAbbreviation:"",onlineResources:[],venueType:void 0,defaultStartTime:void 0,defaultEndTime:void 0,isPrimary:void 0,dateAvailability:[],addresses:[],contacts:[],courts:[],roles:[]}),_ze=Lze;function mpe(t){let{modifications:e,venueId:i,force:r}=t,n=ws(t);if(!Object.keys(n).length)return{error:Mi};if(typeof i!="string")return{error:zd};let a,s;for(let o of Object.values(n)){let l=Vze({tournamentRecord:o,modifications:e,venueId:i,force:r});if(l.success&&(s=!0),l.error&&(a=l.error),l.error&&l.error!==gf)return l}return ZU({tournamentRecords:n}),s?{...W}:{error:a}}function $ze({venue:t,modifications:e,tournamentRecord:i,venueMatchUps:r,allowModificationWhenMatchUpsScheduled:n}){let a=t?.courts?.map(u=>u.courtId)??[],s=e.courts?.map(u=>u.courtId)||[],o=s.length?a.filter(u=>!s.includes(u)):e?.courts&&a,l=[];if(o?.length){let u=t?.courts?.filter(c=>o.includes(c.courtId))?.map(c=>{let d=_G({courtId:c.courtId,tournamentRecord:i,venueMatchUps:r});for(let p of d.matchUps??[])l.push({matchUpId:p.matchUpId,drawId:p.drawId});return d.matchUps?.length??0}).reduce((c,d)=>c+d);return t&&(!u||n)?(t.courts=t.courts?.filter(c=>s.includes(c.courtId)),cw({schedule:{courtId:"",scheduledDate:""},matchUpDetails:l,removePriorValues:!0,tournamentRecord:i}),{success:!0}):BG({matchUpsCount:u})}return{success:!0}}function Bze({modifications:t,tournamentRecord:e,venueMatchUps:i,venueId:r,force:n}){if(t.courts)for(let a of t.courts){let{courtId:s}=a||{},o=jG({modifications:a,disableNotice:!0,tournamentRecord:e,venueMatchUps:i,courtId:s,force:n});if(o?.error===Ic&&(o=oA({disableNotice:!0,tournamentRecord:e,venueId:r,court:a})),o?.error)return o}return{success:!0}}function Vze({tournamentRecord:t,modifications:e,venueId:i,force:r}){if(!t)return{error:ve};if(!e||typeof e!="object")return{error:$c};if(!i)return{error:zd};let n=Dt({tournamentRecord:t})?.appliedPolicies,a=r??n?.[qd]?.allowDeletionWithScoresPresent?.venues,{matchUps:s}=Cze({tournamentRecord:t,venueId:i}),o=Ou({tournamentRecord:t,venueId:i});if(o.error)return o;let l=o.venue,u=Object.keys(_ze()).filter(g=>g!=="venueId");if(!Object.keys(e).filter(g=>u.includes(g)).length)return{error:mM};let c=new Set(u.filter(g=>!["courts","onlineResources","dateAvailability","isPrimary"].includes(g))),d=Object.keys(e).filter(g=>c.has(g));if(!l)return{error:gf};let p=e.defaultStartTime??l.defaultStartTime,f=e.defaultEndTime??l.defaultEndTime;if(p||f){if(!p||!f)return{error:re,info:"both defaultStartTime and defaultEndTime are required"};if(!WP({startTime:p,endTime:f}))return{error:re,info:"defaultEndTime must be after defaultStartTime"}}if(d.forEach(g=>Object.assign(l,{[g]:e[g]})),"isPrimary"in e&&(e.isPrimary?(Qne({tournamentRecord:t}),l.isPrimary=!0):delete l.isPrimary),e.dateAvailability!==void 0){if(Array.isArray(e.dateAvailability)&&e.dateAvailability.length){let g=YM({dateAvailability:e.dateAvailability});if(g.error)return g}l.dateAvailability=e.dateAvailability}let m=$ze({venue:l,modifications:e,tournamentRecord:t,venueMatchUps:s,allowModificationWhenMatchUpsScheduled:a});if("error"in m&&m.error)return m;let h=Bze({modifications:e,tournamentRecord:t,venueMatchUps:s,venueId:i,force:r});return h?.error?h:(ZU({tournamentRecord:t}),l&&st({payload:{venue:l,tournamentId:t.tournamentId},topic:Vc,key:l?.venueId}),{...W,venue:Oe(l)})}var GG={};dt(GG,{JSON2CSV:()=>Yze,UUID:()=>Ct,UUIDS:()=>Kie,allNumeric:()=>lte,attributeFilter:()=>Vm,chunkArray:()=>wr,chunkByNth:()=>tx,chunkSizeProfile:()=>ote,constantToString:()=>Qr,countValues:()=>xxe,createMap:()=>ite,dateTime:()=>Yie,definedAttributes:()=>je,dehydrateMatchUps:()=>Hze,extractAttributes:()=>tae,flattenJSON:()=>HG,generateDateRange:()=>wI,generateHashCode:()=>Mxe,generateRange:()=>Ce,generateTimeCode:()=>dce,groupValues:()=>ate,hasAttributeValues:()=>Cxe,instanceCount:()=>Sa,intersection:()=>Li,isConvertableInteger:()=>lt,isNumeric:()=>Ai,isOdd:()=>rte,isPowerOf2:()=>Ro,isValidEmbargoDate:()=>rd,makeDeepCopy:()=>Oe,matchUpScheduleSort:()=>Gze,matchUpSort:()=>Hh,nearestPowerOf2:()=>z$,nextPowerOf2:()=>Ev,noNulls:()=>Oxe,noNumeric:()=>ute,numericSort:()=>nr,occurrences:()=>Lxe,overlap:()=>xn,randomMember:()=>Ns,randomPop:()=>ha,shuffleArray:()=>Cn,structureSort:()=>_h,subSort:()=>_xe,timeZone:()=>vWe,undefinedToNull:()=>ZO,unique:()=>nt,visualizeScheduledMatchUps:()=>jze});function jze({scheduledMatchUps:t,showGlobalLog:e}){b0e();let i=t?.reduce((n,{structureId:a})=>n.includes(a)?n:n.concat(a),[]),r=Array.isArray(i)&&{...i.map(n=>{let{structureName:a,matchUpType:s}=t.find(o=>o.structureId===n);return{[n]:`${a} ${s}`}})};i?.forEach(n=>{Ht({color:"blue",method:"draw",structure:r[n],keyColors:{structure:"magenta"}},!0);let a=t.filter(o=>o.structureId===n),s=Sn({matchUps:a})?.roundMatchUps||[];Object.keys(s).forEach(o=>{Ht({roundNumber:o,keyColors:{roundNumber:"brightcyan"}},!0),s[o].forEach(({matchUpId:l,schedule:u})=>{let c=pi(u.scheduledTime);Ht({matchUpId:l,time:c,date:u.scheduledDate,venue:u.venueId,keyColors:{time:"brightcyan",date:"brightcyan",matchUpId:"yellow",venue:"magenta"}},!0)})})}),e&&y0e()}var{extractTime:Zq,timeStringMinutes:e3}=Yie;function Gze(t,e){let i=t.schedule??{},r=e.schedule??{};if(i.scheduledDate&&!r.scheduledDate)return 1;if(r.scheduledDate&&!i.scheduledDate)return-1;if(i.scheduledDate&&r.scheduledDate){if(i.scheduledDate===r.scheduledDate){if(i.scheduledTime&&!r.scheduledTime)return 1;if(r.scheduledTime&&!i.scheduledTime)return-1;if(i.scheduledTime&&r.scheduledTime){let n=e3(Zq(i.scheduledTime)),a=e3(Zq(r.scheduledTime));return n-a}}return new Date(i.scheduledDate).getTime()-new Date(r.scheduledDate).getTime()}return 0}function Hze({tournamentRecord:t}){if(!t)return{error:ve};if(typeof t!="object"||!t.tournamentId)return{error:re};let{matchUps:e}=Ur({tournamentRecord:t,inContext:!1});if(e?.length){let i=Wze({tournamentRecord:t});qze(e,i)}return{...W}}function Wze({tournamentRecord:t}){let e={};for(let i of t.events||[]){i.matchUpFormat&&(e[i.eventId]=i.matchUpFormat);for(let r of i.drawDefinitions||[]){r.matchUpFormat&&(e[r.drawId]=r.matchUpFormat);for(let n of r.structures||[]){n.matchUpFormat&&(e[n.structureId]=n.matchUpFormat);for(let a of n.structures||[])a.matchUpFormat&&(e[a.structureId]=a.matchUpFormat)}}}return e}var zze=["collectionId","collectionPosition","drawPositions","extensions","finishingPositionRange","finishingRound","isMock","matchUpId","matchUpStatus","matchUpStatusCodes","orderOfFinish","processCodes","roundNumber","tieFormat","tieMatchUps","roundPosition","score","sides","winnerMatchUpId","loserMatchUpId","matchUpDuration","winningSide"];function qze(t,e={}){for(let i of t){let{structureId:r,drawId:n,eventId:a}=i,s=e[r]||e[n]||e[a],o=i.matchUpFormat===s?void 0:i.matchUpFormat;for(let l of Object.keys(i))zze.includes(l)||delete i[l];i.sides&&i.drawPositions&&!i.tieMatchUps&&delete i.sides,o&&(i.matchUpFormat=o)}}function Yze(t,e){if(e&&typeof e!="object")return{error:re};let{columnTransform:i={}}=e||{},{includeTransformAccessors:r,includeHeaderRow:n=!0,returnTransformedJSON:a,removeEmptyColumns:s,onlyHeaderRow:o,columnAccessors:l=[],functionMap:u={},columnMap:c={},valuesMap:d={},context:p={},delimiter:f='"',columnJoiner:m=",",rowJoiner:h=`\r
`,keyJoiner:g="."}=e||{};if(!Array.isArray(t)||!Array.isArray(l)||typeof p!="object"||typeof c!="object"||typeof i!="object"||typeof u!="object"||typeof d!="object"||typeof m!="string"||typeof h!="string"||typeof g!="string"||typeof f!="string")return{error:re};i=Object.assign({},...Object.keys(i).reverse().map(M=>({[M]:Array.isArray(i[M])?i[M]:[typeof i[M]=="string"&&i[M]].filter(Boolean)})));let I=t.filter(Boolean).map(M=>HG(M,g)),v=Object.values(i).flat();r&&l.push(...v);let w=I.reduce((M,N)=>Object.keys(N).every(A=>!M.includes(A)&&M.push(A)||!0)&&M,[]).filter(M=>!l?.length||l.includes(M)),y=Object.assign({},...Object.keys(i).reverse().map(M=>i[M].map(N=>({[N]:M})).flat()).flat()),b=(M,N)=>e?.sortOrder?e.sortOrder.includes(M)&&e.sortOrder.includes(N)&&e.sortOrder.indexOf(M)-e.sortOrder.indexOf(N)||!e.sortOrder.includes(N)&&-1:0,S=w.reduce((M,N)=>{let A=y[N];return A?M.includes(A)||M.push(A):M.push(N),M},[]).sort(b);Object.keys(c).forEach(M=>!S.includes(M)&&S.unshift(M)),Object.keys(i).forEach(M=>!S.includes(M)&&S.unshift(M)),typeof p=="object"&&Object.keys(p).forEach(M=>!S.includes(M)&&S.unshift(M));let U=S.map(M=>c[M]||M);if(o)return[U];let T=M=>`${f}${M}${f}`,P=[],D=M=>Object.values(S.reduce((N,A,O)=>{let k=i[A],F=(k?.length?M[k.find($=>M[$])]:M[A])||p?.[A]||"",x=d[A]?.[F]||F,L=fa(u[A])?u[A](x):x;return N[A]=T(L),L&&(P[O]=(P[O]||0)+1),N},{})),E=I.map(D),R=s&&[...P].map((M,N)=>!M&&N).filter(Ai).reverse();if(R){let M=N=>N.filter((A,O)=>!R.includes(O));E=E.map(M),U=M(U)}let C=E.map(M=>M.join(m));return a?C.map(M=>{let N=M.split(m);return Object.assign({},...N.map((A,O)=>({[U[O]]:A})))}):n?[U.map(T).join(m),...C].join(h):C.join(h)}function HG(t,e=".",i=[]){return typeof t=="object"&&Object.keys(t).reduce((r,n)=>typeof t[n]!="object"?(r[i.concat(n).join(e)]=t[n],r):Object.assign(r,HG(t[n],e,i.concat(n))),{})}var{FACTORY:t3}=ene;function Kze({tournamentRecord:t,value:e}){let{extension:i}=ht({element:t,name:t3}),r={name:t3,value:{...i?.value,...e}};Ft({element:t,extension:r})}function hpe({timeStamp:t}){let e=kh(),i=bB();return i&&Object.values(e).forEach(r=>{Kze({tournamentRecord:r,value:{version:rM(),timeStamp:t}})}),i}function gpe({engineType:t,methodName:e,elapsed:i,params:r,result:n}){let a=oa();if(typeof a!="object")return;let s={method:e},o=n?.error&&(a.errors===!0||Array.isArray(a.errors)&&a.errors.includes(e)),l=Array.isArray(a.params)&&a.params?.includes(e),u=a.params&&!Array.isArray(a.params)||l,c=Array.isArray(a.exclude)&&a.exclude.includes(e);!c&&![void 0,!1].includes(a.perf)&&!isNaN(a.perf)&&i>=a.perf&&(s.elapsed=i),!c&&(o||u)&&(s.params=r),!c&&(o||a.result&&!Array.isArray(a.result)&&(!Array.isArray(a.params)||l)||Array.isArray(a.result)&&a.result?.includes(e))&&(s.result=n),Object.keys(s).length>1&&Fie(s,t)}function WG({methodName:t,params:e,start:i}){let r={error:hM,methodName:t},n=i?Date.now()-i:0;return gpe({result:r,methodName:t,elapsed:n,params:e,engineType:"sync"}),r}function Xze(t,e){if(e._middleware===!1)return e;if(e.tournamentId&&!t[e.tournamentId])return{error:ve};let i=e.drawId||e.matchUp?.drawId;if(i){let{event:a,drawDefinition:s,tournamentId:o}=Wn({tournamentRecords:t,drawId:i});s&&(e.drawDefinition=s),o&&(e.tournamentId=o),a&&(e.event=a)}if(e.eventId&&!e.event){let{event:a,tournamentId:s}=Wn({eventId:e.eventId,tournamentRecords:t});if(!a)return{error:ps};e.tournamentId=s,e.event=a}let r=e.tournamentId??Ah();if(!r&&e)return e;let n=t[r];return r&&!n?{error:ve}:(n&&(e.tournamentRecord=n),e)}function zG(t,e,i,r,n){delete t.success,delete t.error;let a=Date.now(),s=Ah();i&&(i.activeTournamentId=s);let o=i?.tournamentRecord||SB(s),l=typeof i?.tournamentRecord=="object"&&{[i?.tournamentRecord.tournamentId]:i.tournamentRecord}||kh(),u=i?Oe(i,void 0,!0):void 0,c=i?Xze(l,i):void 0;if(c?.error)return c;let d=Jze({params:c,tournamentRecords:l,tournamentRecord:o,methodName:r,method:e}),p=Date.now()-a;return gpe({result:d,methodName:r,elapsed:p,params:u,engineType:n}),d}function Jze({tournamentRecords:t,tournamentRecord:e,params:i,methodName:r,method:n}){if(oa())return n({tournamentRecords:t,tournamentRecord:e,...i});try{return n({tournamentRecords:t,tournamentRecord:e,...i})}catch(a){return yM({engineName:"engine",methodName:r,params:i,err:a})}}function dA(t){let{mutationStatus:e,tournamentId:i,directives:r,timeStamp:n}=t||{},{topics:a}=bs();for(let s of[...a].sort(Qze)){let o=kie({topic:s});o?.length&&dx({topic:s,notices:o})}e&&n&&a.includes(yx)&&dx({notices:[{tournamentId:i,directives:r,timeStamp:n}],topic:yx})}var i3={[c2]:5,[u2]:5,[d2]:5,[l2]:5,[o2]:5,[a2]:5,[gne]:5,[Ine]:5,[s2]:1,[$M]:1,[rn]:5,[Vc]:5,[n2]:4,[t2]:4,[i2]:4,[r2]:4,[_M]:3,[QB]:2};function Qze(t,e){return(i3[e]||0)-(i3[t]||0)}function Zze({convertExtensions:t,removeExtensions:e}){let i=kh();return{tournamentId:Ah(),tournamentRecords:Oe(i,t,!1,e)}}function eqe(t){let{convertExtensions:e=!1,removeExtensions:i=!1}=t??{},r=t?.tournamentId??Ah();if(typeof r!="string")return{};let n=SB(r);return{tournamentRecord:Oe(n,e,!1,i)}}function tqe(){let t=kh(),{extension:e}=ht({name:Gp,tournamentRecords:t,discover:!0}),i=e?.value?.tournamentIds||[];return Object.keys(t).forEach(r=>{i.includes(r)||delete t[r]}),vM(t)}function r3(t,e=!0){return typeof t!="object"||Array.isArray(t)?{error:$c}:t?.tournamentId?Oie(e?Oe(t):t):{error:re}}function pw(t,e=!0){if(typeof t!="object")return{error:$c};if(Vb(),Array.isArray(t)){if(t.filter(i=>i?.tournamentId).length!==t.length)return{error:rx};t=Object.assign({},...t.map(i=>({[i.tournamentId]:i})))}else if(t?.tournamentId)t={[t.tournamentId]:t},Vb(t.tournamentId);else if(!Object.keys(t).every(i=>t[i].tournamentId===i))return{error:rx};return vM(e?Oe(t):t)}function iqe(t,e,i,r,n,a){let s=Lie(i,r,n,a);if(s.error)return s;let o=s.methods??[];return Object.keys(o).filter(l=>fa(o[l])).forEach(l=>{t[l]=u=>{let c=()=>e(t,{[l]:o[l],...u});if(oa())return c();try{return c()}catch(d){yM({engineName:"engine",methodName:l,params:u,err:d})}}}),{...W,...t}}function fg(t,e){return e?.error?(t.error=e.error,t.success=!1):(t.error=void 0,t.success=!0),t}function Ipe(t,e){t.importMethods=(i,r,n,a)=>iqe(t,e,i,r,n,a),t.getTournament=i=>eqe(i),t.getState=i=>Zze({convertExtensions:i?.convertExtensions,removeExtensions:i?.removeExtensions}),t.version=()=>rM(),t.reset=()=>(vM({}),fg(t)),t.devContext=i=>($b(i),fg(t)),t.getDevContext=i=>oa(i),t.newTournamentRecord=(i={})=>{let r=aA(i),n=r.tournamentId;return r.error?r:(r3(r),Vb(n),{...W,tournamentId:n})},t.setState=(i,r,n)=>{Bb(r,n);let a=pw(i,r);return fg(t,a)},t.setTournamentId=i=>Vb(i),t.getTournamentId=()=>Ah(),t.setTournamentRecord=(i,r,n)=>{Bb(r,n);let a=r3(i,r);return fg(t,a)},t.removeTournamentRecord=i=>{let r=xie(i);return fg(t,r)},t.removeUnlinkedTournamentRecords=()=>{let i=tqe();return fg(t,i)}}function rqe(t,e,i){if(!Array.isArray(e))return{error:re,message:"directives must be an array"};let r=Aie(),n=Date.now(),a=i&&Oe(kh(),!1,!0),s=[];for(let u of e){if(typeof u!="object")return{error:re,message:"directive must be an object"};if(u.params&&typeof u.params!="object")return{error:re,message:"params must be an object"};let{method:c,pipe:d}=u,p=u.params?{...u.params}:{};if(!r[c])return WG({methodName:c,start:n,params:p});if(d){let m=s.at(-1),h=Object.keys(d);for(let g of h)m[g]&&(p[g]=m[g])}let f=zG(t,r[c],p,c,"sync");if(f?.error)return a&&pw(a),{...f,rolledBack:!!a};s.push({...f,methodName:c})}let o=Date.now(),l=hpe({timeStamp:o});return dA({directives:e,mutationStatus:l,timeStamp:o}),iU(),{success:s.every(u=>u.success),results:s}}function n3(t,e){if(!wt(e))return{error:re,message:"args must be an object"};let i=Object.values(e).filter(fa).length;if(i>1)return{message:"there must be only one arg with typeof function",error:re};let r=i?Object.keys(e).find(f=>fa(e[f])):ni(e.method)&&e.method;if(!r)return{error:hM};let{[r]:n,...a}=e,s=e?.params?{...e.params}:{...a},o=s.rollbackOnError&&Oe(kh(),!1,!0),l=n||t[r]||vB()[r];if(!l)return WG({methodName:r,params:s});let u=zG(t,l,s,r,"sync")??{};u?.error&&o&&pw(o);let c=Date.now(),d=hpe({timeStamp:c}),p=u?.success&&s?.delayNotify!==!0&&s?.doNotNotify!==!0;return p&&dA({directives:[{method:l,params:s}],mutationStatus:d,timeStamp:c}),(p||!u?.success||s?.doNotNotify)&&iU(),u}var nqe=(()=>{let t={executionQueue:(e,i)=>rqe(t,e,i),execute:e=>n3(t,e)};return Ipe(t,n3),t})(),qG=nqe;function a3(t,e){if(!wt(e))return{error:re,message:"args must be an object"};let i=Object.values(e).filter(fa).length;if(i>1)return{message:"there must be only one arg with typeof function",error:re};let r=i?Object.keys(e).find(l=>fa(e[l])):ni(e.method)&&e.method;if(!r)return{error:hM};let{[r]:n,...a}=e,s=e?.params?{...e.params}:{...a},o=n||t[r]||vB()[r];return o?zG(t,o,s,r,"ask"):WG({methodName:r,params:s})}(()=>{let t={execute:e=>a3(t,e)};return Ipe(t,a3),t})();var bm={},ed;function vpe(t,e=!0){if(!t)return{error:Je};if(typeof t!="object")return{error:$c};if(t.matchUpId)ed=t.matchUpId,bm[ed]=e?Oe(t):t;else if(Array.isArray(t))for(let i of t.reverse())i.matchUpId&&(bm[i.matchUpId]=e?Oe(i):i,ed||(ed=i.matchUpId));else for(let i of Object.values(t))i.matchUpId&&(bm[i.matchUpId]=e?Oe(i):i,ed||(ed=i.matchUpId));return e?Oe(t):t}function aqe(){return bm[ed]}function sqe(){return Object.values(bm)}function oqe(){ed=void 0,bm={}}function lqe(t){return Oe(bm[ed],t?.convertExtensions,!1,t?.removeExtensions)}(()=>{let t={getState:i=>lqe(i),version:()=>rM(),reset:()=>(oqe(),{...W}),drawId:void 0,error:void 0,success:!1,devContext:i=>($b(i),t),setState:(i,r,n)=>{Bb(r,n);let a=vpe(i);return e(a)}};function e(i){return i?.error?(t.error=i.error,t.success=!1):(t.error=void 0,t.success=!0,t.drawId=i.drawId),t}return uqe(t,[RV]),t})();function uqe(t,e){e.forEach(i=>{Object.keys(i).forEach(r=>{t[r]=n=>{if(oa())return s3(t,{params:n,governor:i,methodName:r});try{return s3(t,{params:n,governor:i,methodName:r})}catch(a){yM({engineName:"matchUpEngine",methodName:r,params:n,err:a})}}})})}function s3(t,{params:e,governor:i,methodName:r}){t.error=void 0,t.success=!1;let n=e?.matchUp||aqe(),a=e?.matchUps||sqe(),s=e?.rollbackOnError&&Oe(n,!1,!0);e={...e,matchUpId:n?.matchUpId,matchUps:a,matchUp:n};let o=i[r](e);if(o?.error)return s&&vpe(s),{...o,rolledBack:!!s};let l=o?.success&&e?.delayNotify!==!0&&e?.doNotNotify!==!0;return l&&dA(),(l||!o?.success||e?.doNotNotify)&&iU(),o}var vk=!1;(()=>{let t={version:()=>rM(),setDeepCopy:(n,a)=>(Bb(n,a),t),devContext:n=>($b(n),vk=!0,t)};return i([rG]),t;function e(n,a){let s=n({...a});return s?.error||dA(),iU(),vk&&($b(!1),vk=!1),s}function i(n){n.forEach(a=>{Object.keys(a).forEach(s=>{t[s]=r(a,s)})})}function r(n,a){return s=>{if(oa()){let o=e(n[a],s);return!o?.error&&s?.setState&&o?.tournamentRecord&&pw(o.tournamentRecord),o}else try{let o=e(n[a],s);return!o?.error&&s?.setState&&o?.tournamentRecord&&pw(o.tournamentRecord),o}catch(o){let l;typeof o=="string"?l=o.toUpperCase():o instanceof Error&&(l=o.message),console.log("ERROR",{params:JSON.stringify(s),method:a,error:l})}}}})();var cqe={};dt(cqe,{BLOCK_TYPES:()=>Ot,EvaluatorRegistry:()=>Gde,TemporalEngine:()=>dqe,adjacentBlockEvaluator:()=>NG,applyTemporalAvailabilityToTournamentRecord:()=>Jde,blockDurationEvaluator:()=>kG,buildDayRange:()=>Ade,buildEdges:()=>UG,buildSchedulingProfileFromUISelections:()=>Qde,calculateCapacityStats:()=>Ode,calculateCourtHours:()=>rpe,clampDragToCollisions:()=>Bde,clampToDayRange:()=>wG,compareCapacityCurves:()=>Lde,computePlanItemId:()=>pE,courtDayKey:()=>Qy,courtKey:()=>xg,courtOverlapEvaluator:()=>CG,createFollowByEvaluator:()=>Hde,dayBoundaryEvaluator:()=>OG,defaultEvaluators:()=>jde,deriveRailSegments:()=>DG,diffMinutes:()=>lT,extractDay:()=>np,filterCapacityCurve:()=>xde,findBlocksContainingTime:()=>$de,formatConflicts:()=>qde,generateCapacityCurve:()=>EG,getHighestSeverity:()=>zde,groupConflictsBySeverity:()=>Wde,hhmmToMinutes:()=>dw,intervalsOverlap:()=>_de,iterateDayTicks:()=>Kde,lightingEvaluator:()=>AG,maintenanceWindowEvaluator:()=>xG,matchWindowEvaluator:()=>MG,mergeAdjacentSegments:()=>PG,mergeOverlappingAvailability:()=>ipe,minutesToHhmm:()=>cA,overlappingRange:()=>Nde,railsToDateAvailability:()=>LG,rangesOverlap:()=>SG,resolveCourtId:()=>Kf,resolveStatus:()=>dE,resolveVenueId:()=>ym,runValidationPipeline:()=>Xde,sampleCapacityCurve:()=>Fde,snapIsoToGranularity:()=>Yde,snapToGranularity:()=>FG,sortBlocksByStart:()=>Vde,sortEdges:()=>TG,timeInsideBlock:()=>RG,todsAvailabilityToBlocks:()=>Zde,validateDateAvailability:()=>tpe,validateSchedulingProfileFormat:()=>epe,validateSegments:()=>kde,venueDayKey:()=>Mde,venueKey:()=>Hf});var mg,dqe=(mg=class{constructor(){this.tournamentRecord=null,this.blocksById=new Map,this.blocksByCourtDay=new Map,this.courtDayAvailability=new Map,this.venueDayAvailability=new Map,this.templates=new Map,this.rules=new Map,this.plans=new Map,this.subscribers=[],this.resolvedGranularity=15,this.nextBlockId=1}init(t,e){this.tournamentRecord=t,this.config={tournamentId:e?.tournamentId||t?.tournamentId||"tournament-1",dayStartTime:e?.dayStartTime||"06:00",dayEndTime:e?.dayEndTime||"23:00",slotMinutes:e?.slotMinutes||15,granularityMinutes:e?.granularityMinutes,typePrecedence:e?.typePrecedence||[Ot.HARD_BLOCK,Ot.LOCKED,Ot.MAINTENANCE,Ot.BLOCKED,Ot.PRACTICE,Ot.RESERVED,Ot.SOFT_BLOCK,Ot.AVAILABLE,Ot.UNSPECIFIED],conflictEvaluators:e?.conflictEvaluators||[]},this.resolvedGranularity=this.config.granularityMinutes??this.config.slotMinutes??15,this.plans.clear(),this.loadBlocksFromTournamentRecord(),this.emit({type:"STATE_CHANGED",payload:{reason:"INIT"}})}updateTournamentRecord(t){this.tournamentRecord=t,this.loadBlocksFromTournamentRecord(),this.emit({type:"STATE_CHANGED",payload:{reason:"TOURNAMENT_RECORD_UPDATED"}})}getConfig(){return{...this.config}}getResolvedGranularityMinutes(){return this.resolvedGranularity}getCourtAvailability(t,e){let i=xg(t),r=this.courtDayAvailability.get(`${i}|${e}`)??this.courtDayAvailability.get(`${i}|DEFAULT`)??null,n=Hf(t.tournamentId,t.venueId),a=this.venueDayAvailability.get(`${n}|${e}`)??this.venueDayAvailability.get(`${n}|DEFAULT`)??null;if(r&&a){let s=r.startTime>a.startTime?r.startTime:a.startTime,o=r.endTime<a.endTime?r.endTime:a.endTime;return s>=o?a:{startTime:s,endTime:o}}return r||a||this.courtDayAvailability.get("GLOBAL|DEFAULT")||{startTime:this.config.dayStartTime,endTime:this.config.dayEndTime}}setCourtAvailability(t,e,i){let r=xg(t);this.courtDayAvailability.set(`${r}|${e}`,i),this.emit({type:"AVAILABILITY_CHANGED",payload:{court:t,day:e,avail:i}})}setCourtAvailabilityAllDays(t,e){let i=xg(t);this.courtDayAvailability.set(`${i}|DEFAULT`,e),this.emit({type:"AVAILABILITY_CHANGED",payload:{court:t,scope:"all-days",avail:e}})}setAllCourtsDefaultAvailability(t){this.courtDayAvailability.set("GLOBAL|DEFAULT",t),this.emit({type:"AVAILABILITY_CHANGED",payload:{scope:"global",avail:t}})}getVenueAvailability(t,e,i){let r=Hf(t,e);if(i){let n=this.venueDayAvailability.get(`${r}|${i}`);if(n)return n}return this.venueDayAvailability.get(`${r}|DEFAULT`)??null}setVenueDefaultAvailability(t,e,i){let r=Hf(t,e);this.venueDayAvailability.set(`${r}|DEFAULT`,i),this.emit({type:"AVAILABILITY_CHANGED",payload:{tournamentId:t,venueId:e,scope:"venue",avail:i}})}setVenueDayAvailability(t,e,i,r){let n=Hf(t,e);this.venueDayAvailability.set(`${n}|${i}`,r),this.emit({type:"AVAILABILITY_CHANGED",payload:{tournamentId:t,venueId:e,day:i,scope:"venue-day",avail:r}})}getVisibleTimeRange(t,e){let i=e&&e.length>0?e:this.getAllCourtsFromTournamentRecord(),r="23:59",n="00:00";for(let a of i){let s=this.getCourtAvailability(a,t);s.startTime<r&&(r=s.startTime),s.endTime>n&&(n=s.endTime)}return i.length===0?{startTime:this.config.dayStartTime,endTime:this.config.dayEndTime}:{startTime:r,endTime:n}}getTournamentDays(){if(!this.tournamentRecord?.startDate)return[];let t=this.tournamentRecord.startDate,e=this.tournamentRecord.endDate||t,i=[],r=new Date(t),n=new Date(e);for(;r<=n;)i.push(r.toISOString().slice(0,10)),r.setDate(r.getDate()+1);return i}getDayTimeline(t){let e=this.getAllCourtsFromTournamentRecord(),i=new Map;for(let n of e){let a=i.get(n.venueId)||[];a.push(n),i.set(n.venueId,a)}let r=[];for(let[n,a]of i.entries()){let s=[];for(let o of a){let l=this.getCourtRail(t,o);l&&s.push(l)}r.push({day:t,venueId:n,rails:s})}return r}getVenueTimeline(t,e){return this.getDayTimeline(t).find(i=>i.venueId===e)||null}getCourtRail(t,e){let i=this.getCourtAvailability(e,t),r={start:`${t}T${i.startTime}:00`,end:`${t}T${i.endTime}:00`},n=Qy(e,t),a=(this.blocksByCourtDay.get(n)||[]).map(o=>this.blocksById.get(o)).filter(o=>!!o),s=DG(a,r,this.config);return{court:e,segments:s}}getCapacityCurve(t){let e=this.getDayTimeline(t);return EG(t,e)}getDayBlocks(t){let e=[];for(let i of this.blocksById.values())np(i.start)===t&&e.push(i);return e}getAllBlocks(){return Array.from(this.blocksById.values())}getTemplates(){return Array.from(this.templates.values())}getTemplate(t){return this.templates.get(t)||null}getRules(){return Array.from(this.rules.values())}getRule(t){return this.rules.get(t)||null}addPlanItem(t){let e=pE(t),i={...t,planItemId:e},r=this.plans.get(t.day)||{day:t.day,items:[]};return r.items=r.items.filter(n=>n.planItemId!==e),r.items.push(i),this.plans.set(t.day,r),this.emit({type:"PLAN_CHANGED",payload:{action:"ADD",planItem:i}}),this.emit({type:"STATE_CHANGED",payload:{reason:"PLAN_CHANGED"}}),i}removePlanItem(t){for(let[e,i]of this.plans.entries()){let r=i.items.findIndex(n=>n.planItemId===t);if(r!==-1){let n=i.items.splice(r,1)[0];return i.items.length===0&&this.plans.delete(e),this.emit({type:"PLAN_CHANGED",payload:{action:"REMOVE",planItem:n}}),this.emit({type:"STATE_CHANGED",payload:{reason:"PLAN_CHANGED"}}),!0}}return!1}updatePlanItem(t,e){for(let i of this.plans.values()){let r=i.items.find(n=>n.planItemId===t);if(r)return Object.assign(r,e),this.emit({type:"PLAN_CHANGED",payload:{action:"UPDATE",planItem:r}}),this.emit({type:"STATE_CHANGED",payload:{reason:"PLAN_CHANGED"}}),r}return null}movePlanItem(t,e){let i=null;for(let[a,s]of this.plans.entries()){let o=s.items.findIndex(l=>l.planItemId===t);if(o!==-1){i=s.items.splice(o,1)[0],s.items.length===0&&this.plans.delete(a);break}}if(!i)return null;let r={...i,day:e};r.planItemId=pE(r);let n=this.plans.get(e)||{day:e,items:[]};return n.items=n.items.filter(a=>a.planItemId!==r.planItemId),n.items.push(r),this.plans.set(e,n),this.emit({type:"PLAN_CHANGED",payload:{action:"MOVE",planItem:r,fromDay:i.day}}),this.emit({type:"STATE_CHANGED",payload:{reason:"PLAN_CHANGED"}}),r}getDayPlan(t){return this.plans.get(t)||null}getAllPlans(){return Array.from(this.plans.values())}applyBlock(t){let e=[];for(let i of t.courts){let r=np(t.timeRange.start),n=this.clampToAvailability(i,r,t.timeRange.start,t.timeRange.end);if(!n)continue;let a={id:this.generateBlockId(),court:i,start:n.start,end:n.end,type:t.type,reason:t.reason,hardSoft:t.hardSoft,source:t.source||"USER"};e.push({kind:"ADD_BLOCK",block:a})}return this.applyMutations(e)}moveBlock(t){let e=this.blocksById.get(t.blockId);if(!e)return{applied:[],rejected:[],warnings:[{code:"BLOCK_NOT_FOUND",message:`Block ${t.blockId} not found`}],conflicts:[]};let i=t.newCourt||e.court,r=np(t.newTimeRange.start),n=this.clampToAvailability(i,r,t.newTimeRange.start,t.newTimeRange.end);if(!n)return{applied:[],rejected:[],warnings:[{code:"OUTSIDE_AVAILABILITY",message:"Block falls outside court availability"}],conflicts:[]};let a={...e,start:n.start,end:n.end,court:i};return this.applyMutations([{kind:"UPDATE_BLOCK",block:a,previousBlock:e}])}resizeBlock(t){let e=this.blocksById.get(t.blockId);if(!e)return{applied:[],rejected:[],warnings:[{code:"BLOCK_NOT_FOUND",message:`Block ${t.blockId} not found`}],conflicts:[]};let i=np(t.newTimeRange.start),r=this.clampToAvailability(e.court,i,t.newTimeRange.start,t.newTimeRange.end);if(!r)return{applied:[],rejected:[],warnings:[{code:"OUTSIDE_AVAILABILITY",message:"Block falls outside court availability"}],conflicts:[]};let n={...e,start:r.start,end:r.end};return this.applyMutations([{kind:"UPDATE_BLOCK",block:n,previousBlock:e}])}removeBlock(t){let e=this.blocksById.get(t);return e?this.applyMutations([{kind:"REMOVE_BLOCK",block:e}]):{applied:[],rejected:[],warnings:[{code:"BLOCK_NOT_FOUND",message:`Block ${t} not found`}],conflicts:[]}}applyTemplate(t){return this.templates.get(t.templateId)?{applied:[],rejected:[],warnings:[],conflicts:[]}:{applied:[],rejected:[],warnings:[{code:"TEMPLATE_NOT_FOUND",message:`Template ${t.templateId} not found`}],conflicts:[]}}importScheduledMatchUps(t){let e=[];for(let n of this.blocksById.values())n.type===Ot.SCHEDULED&&n.source==="SYSTEM"&&e.push({kind:"REMOVE_BLOCK",block:n});for(let n of e)this.applyMutation(n);let i=[];for(let n of t){let a=n.startTime.length===5?`${n.startTime}:00`:n.startTime,s=this.timeToMinutes(a)+n.durationMinutes,o=Math.floor(s/60),l=s%60,u=`${String(o).padStart(2,"0")}:${String(l).padStart(2,"0")}:00`,c={id:this.generateBlockId(),court:{tournamentId:this.config.tournamentId,venueId:n.venueId,courtId:n.courtId},start:`${n.date}T${a}`,end:`${n.date}T${u}`,type:Ot.SCHEDULED,source:"SYSTEM",matchUpId:n.matchUpId,reason:"Scheduled Match"};i.push({kind:"ADD_BLOCK",block:c})}let r=this.applyMutations(i);return{...r,applied:[...e,...r.applied]}}timeToMinutes(t){let e=t.split(":").map(Number);return e[0]*60+e[1]}simulateBlocks(t,e){let i=this.createSnapshot(),r=i.applyMutations(t),n=e||this.getFirstAvailableDay(),a=n?i.getDayTimeline(n):[],s=n?i.getCapacityCurve(n):void 0;return{previewRails:a,capacityImpact:s,conflicts:r.conflicts}}subscribe(t){return this.subscribers.push(t),()=>{let e=this.subscribers.indexOf(t);e>-1&&this.subscribers.splice(e,1)}}emit(t){for(let e of this.subscribers)try{e(t)}catch(i){console.error("Error in event listener:",i)}}applyMutations(t){let e=this.evaluateConflicts(t);if(e.filter(r=>r.severity==="ERROR").length>0)return{applied:[],rejected:t,warnings:[],conflicts:e};let i=[];for(let r of t)this.applyMutation(r),i.push(r);return this.emit({type:"BLOCKS_CHANGED",payload:{mutations:i}}),this.emit({type:"STATE_CHANGED",payload:{reason:"BLOCKS_MUTATED"}}),e.length>0&&this.emit({type:"CONFLICTS_CHANGED",payload:{conflicts:e}}),{applied:i,rejected:[],warnings:e.filter(r=>r.severity==="WARN").map(r=>({code:r.code,message:r.message})),conflicts:e}}applyMutation(t){let{kind:e,block:i,previousBlock:r}=t;switch(e){case"ADD_BLOCK":this.blocksById.set(i.id,i),this.indexBlock(i);break;case"UPDATE_BLOCK":r&&this.unindexBlock(r),this.blocksById.set(i.id,i),this.indexBlock(i);break;case"REMOVE_BLOCK":this.unindexBlock(i),this.blocksById.delete(i.id);break}}indexBlock(t){let e=np(t.start),i=Qy(t.court,e),r=this.blocksByCourtDay.get(i)||[];r.includes(t.id)||(r.push(t.id),this.blocksByCourtDay.set(i,r))}unindexBlock(t){let e=np(t.start),i=Qy(t.court,e),r=(this.blocksByCourtDay.get(i)||[]).filter(n=>n!==t.id);r.length>0?this.blocksByCourtDay.set(i,r):this.blocksByCourtDay.delete(i)}evaluateConflicts(t){let e=this.createContext(),i=[];for(let r of this.config.conflictEvaluators||[])try{let n=r.evaluate(e,t);i.push(...n)}catch(n){console.error(`Error in evaluator ${r.id}:`,n)}return i}createContext(){return{config:this.config,tournamentRecord:this.tournamentRecord,blocksById:new Map(this.blocksById),blocksByCourtDay:new Map(this.blocksByCourtDay),templates:new Map(this.templates),rules:new Map(this.rules)}}createSnapshot(){let t=new mg;return t.config={...this.config},t.tournamentRecord=this.tournamentRecord,t.blocksById=new Map(this.blocksById),t.blocksByCourtDay=new Map(this.blocksByCourtDay),t.courtDayAvailability=new Map(this.courtDayAvailability),t.venueDayAvailability=new Map(this.venueDayAvailability),t.templates=new Map(this.templates),t.rules=new Map(this.rules),t.plans=new Map([...this.plans.entries()].map(([e,i])=>[e,{...i,items:[...i.items]}])),t.nextBlockId=this.nextBlockId,t.resolvedGranularity=this.resolvedGranularity,t}loadBlocksFromTournamentRecord(){if(this.blocksById.clear(),this.blocksByCourtDay.clear(),this.courtDayAvailability.clear(),this.venueDayAvailability.clear(),!!this.tournamentRecord?.venues)for(let t of this.tournamentRecord.venues){let e=ym(t),i=Hf(this.config.tournamentId,e);if(t.defaultStartTime&&t.defaultEndTime&&this.venueDayAvailability.set(`${i}|DEFAULT`,{startTime:t.defaultStartTime,endTime:t.defaultEndTime}),t.dateAvailability?.length){for(let r of t.dateAvailability)if(r.date?r.startTime&&r.endTime&&this.venueDayAvailability.set(`${i}|${r.date}`,{startTime:r.startTime,endTime:r.endTime}):r.startTime&&r.endTime&&this.venueDayAvailability.set(`${i}|DEFAULT`,{startTime:r.startTime,endTime:r.endTime}),r.bookings?.length&&t.courts?.length){let n=r.date||this.tournamentRecord.startDate;for(let a of r.bookings){if(!a.startTime||!a.endTime)continue;let s=a.startTime.length===5?`${a.startTime}:00`:a.startTime,o=a.endTime.length===5?`${a.endTime}:00`:a.endTime,l=mg.BOOKING_TYPE_MAP[(a.bookingType||"").toUpperCase()]||Ot.RESERVED;for(let u of t.courts){let c={tournamentId:this.config.tournamentId,venueId:e,courtId:Kf(u)},d=this.generateBlockId(),p={id:d,court:c,start:`${n}T${s}`,end:`${n}T${o}`,type:l,reason:a.bookingType||"Booking",source:"SYSTEM"};this.blocksById.set(d,p),this.indexBlock(p)}}}}for(let r of t.courts||[]){if(!r.dateAvailability?.length)continue;let n={tournamentId:this.config.tournamentId,venueId:e,courtId:Kf(r)};for(let a of r.dateAvailability){let s=a.date||this.tournamentRecord.startDate;if(a.startTime&&a.endTime){let o=xg(n);this.courtDayAvailability.set(`${o}|${s}`,{startTime:a.startTime,endTime:a.endTime})}if(a.bookings?.length)for(let o of a.bookings){if(!o.startTime||!o.endTime)continue;let l=o.startTime.length===5?`${o.startTime}:00`:o.startTime,u=o.endTime.length===5?`${o.endTime}:00`:o.endTime,c=mg.BOOKING_TYPE_MAP[(o.bookingType||"").toUpperCase()]||Ot.RESERVED,d=this.generateBlockId(),p={id:d,court:n,start:`${s}T${l}`,end:`${s}T${u}`,type:c,reason:o.bookingType||"Booking",source:"SYSTEM"};this.blocksById.set(d,p),this.indexBlock(p)}}}}}getAllCourtsFromTournamentRecord(){if(!this.tournamentRecord?.venues)return[];let t=[];for(let e of this.tournamentRecord.venues){let i=ym(e);if(e.courts)for(let r of e.courts)t.push({tournamentId:this.config.tournamentId,venueId:i,courtId:Kf(r)})}return t}getFirstAvailableDay(){return this.tournamentRecord?.startDate?Ze(this.tournamentRecord.startDate):null}generateBlockId(){return`block-${this.nextBlockId++}`}clampToAvailability(t,e,i,r){let n=this.getCourtAvailability(t,e),a=`${e}T${n.startTime}:00`,s=`${e}T${n.endTime}:00`,o=i<a?a:i,l=r>s?s:r;return o>=l?null:{start:o,end:l}}listCourtMeta(){return this.getAllCourtsFromTournamentRecord().map(t=>this.getCourtMeta(t))}getCourtMeta(t){if(this.tournamentRecord?.venues){for(let e of this.tournamentRecord.venues)if(ym(e)===t.venueId)for(let i of e.courts||[]){if(Kf(i)!==t.courtId)continue;let r=this.getFirstAvailableDay(),n=r?this.getCourtAvailability(t,r):void 0;return{ref:t,name:i.courtName||i.courtId,surface:i.surfaceCategory||i.surfaceType||"hard",indoor:i.indoorOutdoor==="INDOOR"||i.indoor||!1,hasLights:i.hasLights||!1,tags:[],openTime:n?.startTime,closeTime:n?.endTime}}}return{ref:t,name:t.courtId,surface:"hard",indoor:!1,hasLights:!1,tags:[]}}},mg.BOOKING_TYPE_MAP={MAINTENANCE:Ot.MAINTENANCE,PRACTICE:Ot.PRACTICE,RESERVED:Ot.RESERVED,MATCH:Ot.SCHEDULED,SCHEDULED:Ot.SCHEDULED},mg),pqe={calculateNewRatings:coe,generateDynamicRatings:doe};qG.importMethods({...gG,...pqe});qG.importMethods(H$,!0,1);var ype=qG,fqe={competitionFormatName:"INTENNSE_STANDARD",matchUpFormat:"SET7XA-S:T10P",sport:"INTENNSE",timerProfile:{shotClockSeconds:14,segmentTimers:[{segmentType:"set",direction:"down",minutes:10}],changeoverSeconds:0,setBreakSeconds:120},timeoutRules:{count:5,per:"MATCHUP",durationSeconds:60},substitutionRules:{allowed:!0,allowedMatchUpTypes:["SINGLES","DOUBLES"],timing:"BETWEEN_POINTS"},playerRules:{maxMinutesPerSegment:6,matchUpTypes:["SINGLES"]},penaltyProfile:{sport:"INTENNSE",penaltyTypes:[{penaltyType:"UNSPORTSMANLIKE_CONDUCT",label:"Unsportsmanlike",category:"conduct"},{penaltyType:"BALL_ABUSE",label:"Ball Abuse",category:"conduct"},{penaltyType:"RACKET_ABUSE",label:"Racket Abuse",category:"conduct"}],escalation:[{step:1,consequence:"warning"},{step:2,consequence:"point"},{step:3,consequence:"game"},{step:4,consequence:"default"}]},pointProfile:{sport:"INTENNSE",pointResults:[{result:"Ace",label:"Ace",isServe:!0},{result:"Winner",label:"Winner"},{result:"Serve Winner",label:"Serve Winner",isServe:!0},{result:"Forced Error",label:"Forced Error",isError:!0},{result:"Unforced Error",label:"Unforced Error",isError:!0},{result:"Double Fault",label:"Double Fault",isServe:!0,isError:!0},{result:"Touch",label:"Touch"},{result:"Penalty",label:"Penalty"}]},pointMultipliers:[{condition:{results:["Ace"]},value:2},{condition:{results:["Winner"]},value:2}]},mqe={competitionFormatName:"TENNIS_STANDARD",matchUpFormat:"SET3-S:6/TB7",sport:"TENNIS",timerProfile:{changeoverSeconds:90,setBreakSeconds:120},timeoutRules:{count:0,per:"MATCHUP"},substitutionRules:{allowed:!1},penaltyProfile:{sport:"TENNIS",penaltyTypes:[{penaltyType:"TIME_VIOLATION",label:"Time Violation",category:"time_violation"},{penaltyType:"COACHING",label:"Coaching",category:"code_violation"},{penaltyType:"UNSPORTSMANLIKE_CONDUCT",label:"Unsportsmanlike",category:"conduct"},{penaltyType:"BALL_ABUSE",label:"Ball Abuse",category:"conduct"},{penaltyType:"RACKET_ABUSE",label:"Racket Abuse",category:"conduct"},{penaltyType:"VERBAL_ABUSE",label:"Verbal Abuse",category:"conduct"},{penaltyType:"AUDIBLE_OBSCENITY",label:"Audible Obscenity",category:"conduct"},{penaltyType:"VISIBLE_OBSCENITY",label:"Visible Obscenity",category:"conduct"}],escalation:[{step:1,consequence:"warning"},{step:2,consequence:"point"},{step:3,consequence:"game"},{step:4,consequence:"default"}]},pointProfile:{sport:"TENNIS",pointResults:[{result:"Ace",label:"Ace",isServe:!0},{result:"Winner",label:"Winner"},{result:"Serve Winner",label:"Serve Winner",isServe:!0},{result:"Forced Error",label:"Forced Error",isError:!0},{result:"Unforced Error",label:"Unforced Error",isError:!0},{result:"Double Fault",label:"Double Fault",isServe:!0,isError:!0},{result:"Penalty",label:"Penalty"}]},pointMultipliers:[]},hqe={INTENNSE_STANDARD:fqe,TENNIS_STANDARD:mqe},gqe={[Xb]:{roundsToSeparate:void 0,policyName:"Nationality Code",policyAttributes:[{key:"person.nationalityCode"},{key:"individualParticipants.person.nationalityCode"}]}},Iqe={[yu]:{policyName:"positionActionsUnrestricted",enabledStructures:[],otherFlightEntries:!0,disableRoundRestrictions:!0,activePositionOverrides:[gm,Xy]}},vqe={[yu]:{policyName:"positionActionsNoMovement",enabledStructures:[{stages:[],stageSequences:[],enabledActions:[gm,nw,qm],disabledActions:[]}]}},yqe={[yu]:{policyName:"positionActionsDisabled",enabledStructures:!1}},bqe={[Lv]:{policyName:"Participant Privacy Policy",participant:{contacts:!1,individualParticipants:{onlineResources:!1,participantName:!0,participantOtherName:!0,participantId:!0,participantRole:!0,participantStatus:!0,penalties:!1,rankings:!0,ratings:!0,representing:!0,participantRoleResponsibilities:!1,participantType:!0,person:{addresses:!1,biographicalInformation:!1,birthDate:!1,contacts:!1,nationalityCode:!0,nativeFamilyName:!1,nativeGivenName:!1,onlineResources:!1,otherNames:!0,parentOrganisationId:!1,passportFamilyName:!1,passportGivenName:!1,personId:!1,personOtherIds:!1,previousNames:!1,sex:!1,standardFamilyName:!0,standardGivenName:!0,status:!1,tennisId:!1,wheelchair:!0}},individualParticipantIds:!0,onlineResources:!1,participantName:!0,participantOtherName:!0,participantId:!0,participantRole:!0,participantStatus:!0,penalties:!1,rankings:!0,ratings:!0,representing:!0,participantRoleResponsibilities:!1,participantType:!0,person:{addresses:!1,biographicalInformation:!1,birthDate:!1,contacts:!1,nationalityCode:!0,nativeFamilyName:!1,nativeGivenName:!1,onlineResources:!1,otherNames:!0,parentOrganisationId:!1,passportFamilyName:!1,passportGivenName:!1,personId:!1,personOtherIds:!1,previousNames:!1,sex:!1,standardFamilyName:!0,standardGivenName:!0,status:!1,tennisId:!1,wheelchair:!0}}}},wqe={[ms]:{processCodes:{incompleteAssignmentsOnDefault:["RANKING.IGNORE"]},defaultMatchUpFormat:Vs,allowDeletionWithScoresPresent:{drawDefinitions:!1,structures:!1},requireParticipantsForScoring:!1,requireAllPositionsAssigned:void 0,allowChangePropagation:!1,stage:{[Ae]:{stageSequence:{1:{requireAllPositionsAssigned:!0}}}},matchUpFormats:[],matchUpStatusCodes:{[Ta]:[],[Rl]:[],[qt]:[],[Da]:[],[Sr]:[],[ai]:[]}}},yk="Personal circumstance",Sqe={[ms]:{requireAllPositionsAssigned:!1,stage:{[Ae]:{stageSequence:{1:{requireAllPositionsAssigned:!0}}}},defaultMatchUpFormat:Vs,matchUpFormats:[{description:"Best of 3 tiebreak sets",matchUpFormat:Vs,categoryNames:[],categoryTypes:[]},{description:"Two tiebreak sets, 7-point match tiebreak at one set all",matchUpFormat:"SET3-S:6/TB7-F:TB7"},{description:"Two tiebreak sets, 10-point match tiebreak at one set all",matchUpFormat:"SET3-S:6/TB7-F:TB10"},{description:"One standard tiebreak set to 6, 7-point tiebreak at 6 games all",matchUpFormat:"SET1-S:6/TB7"},{description:"Best of 3 sets to 4",matchUpFormat:"SET3-S:4/TB7"},{description:"Two out of three short sets to 4 with 5-point tiebreak at 3 games all",matchUpFormat:"SET3-S:4/TB5@3"},{description:"One short set to 4, 7-point tiebreak at 4 games all",matchUpFormat:"SET1-S:4/TB7"},{description:"One short set to 4, 5-point tiebreak at 3 games all",matchUpFormat:"SET1-S:4/TB5@3"},{description:"Two short sets to 4, 10-point match tiebreak at one set all",matchUpFormat:"SET3-S:4/TB7-F:TB10"},{description:"Two short sets to 4, 7-point match tiebreak at one set all",matchUpFormat:"SET3-S:4/TB7-F:TB7"},{description:"One no advantage set to 5, tiebreak to 9 at 4-4",matchUpFormat:"SET1-S:5/TB9@4"},{description:"One set to 6 with deciding game at 5 games all",matchUpFormat:"SET1-S:6NOAD"},{description:"One short set to 4, deciding game is played at 3 games all",matchUpFormat:"SET1-S:4NOAD"},{description:"Two short sets to 4 with deciding game at 3-3, 7-point match tiebreak at one set all",matchUpFormat:"SET3-S:4NOAD-F:TB7"},{description:"8 game pro-set with 7 point tiebreak at 8 games all",matchUpFormat:"SET1-S:8/TB7"},{description:"8 game pro-set with 7 point tiebreak at 7 games all",matchUpFormat:"SET1-S:8/TB7@7"},{description:"Best of 3 10-point tiebreak games",matchUpFormat:"SET3-S:TB10"},{description:"One 10-point tiebreak game",matchUpFormat:"SET1-S:TB10"},{description:"Timed 20 minute game - game based",matchUpFormat:"SET1-S:T20"}],matchUpStatusCodes:{[Ta]:[{matchUpStatusCodeDisplay:"Abandoned",label:"Abandoned match",matchUpStatusCode:"OA"}],[Rl]:[{matchUpStatusCodeDisplay:"Unplayed or Cancelled",label:"Cancelled match",matchUpStatusCode:"OC"}],[Da]:[{matchUpStatusCodeDisplay:"Incomplete",label:"Incomplete match",matchUpStatusCode:"OI"}],[qt]:[{description:"Disqualification for cause or ineligibility",label:"Disqualification (ineligibility)",matchUpStatusCodeDisplay:"Def [dq]",matchUpStatusCode:"DQ"},{description:"Misconduct before or between matches",label:"Misconduct",matchUpStatusCodeDisplay:"Def [cond]",matchUpStatusCode:"DM"},{description:"Failure to start match because of adult discipline",label:"Fail. (adult discipline)",matchUpStatusCodeDisplay:"Def [ad]",matchUpStatusCode:"D5"},{description:"Refusal to start match for reason other than adult discipline, injury, illness, or personal circumstance. (After the Referee has conclusively confirmed that a player refuses to play a match, the Referee need not wait until the scheduled time of the match to records the result.)",label:"Refusal to start match",matchUpStatusCodeDisplay:"Def [refsl]",matchUpStatusCode:"D4"},{label:"Not showing up",matchUpStatusCodeDisplay:"Def [ns]",matchUpStatusCode:"D6"},{description:"Lateness for match including, but not limited to, intending to play but mistakenly arriving at the wrong time, location, or without proper equipment",label:"Lateness for match",matchUpStatusCodeDisplay:"Score + Def [late]",matchUpStatusCode:"D7"},{label:"Double default",matchUpStatusCodeDisplay:"Def/Def",matchUpStatusCode:"DD"},{description:"Refusal to continue playing a match for reason other than injury, illness, personal circumstance, or adult discipline",label:"Refusal to continue match",matchUpStatusCodeDisplay:"Def [refsl]",matchUpStatusCode:"D9"},{description:"Default for receiving an injection, IV, or supplemental oxygen",label:"Default (PEDs)",matchUpStatusCodeDisplay:"Def [med]",matchUpStatusCode:"DI"},{description:"Default under Point Penalty System",label:"Default (Point Penalty System)",matchUpStatusCodeDisplay:"Def [pps]",matchUpStatusCode:"DP"}],[ai]:[{matchUpStatusCodeDisplay:"Wo [inj]",matchUpStatusCode:"W1",label:"Injury"},{matchUpStatusCodeDisplay:"Wo [ill]",matchUpStatusCode:"W2",label:"Illness"},{matchUpStatusCodeDisplay:"Wo [pc]",label:yk,matchUpStatusCode:"W3"},{matchUpStatusCodeDisplay:"Wo/Wo",matchUpStatusCode:"WOWO",label:"Double walkover"},{matchUpStatusCodeDisplay:"Wo [Tae]",label:"Tournament Administrative Error",matchUpStatusCode:"W4"},{matchUpStatusCodeDisplay:"Wo/Withdrawn",matchUpStatusCode:"W5",label:"Withdrawn"}],[Sr]:[{matchUpStatusCodeDisplay:"Ret [inj]",matchUpStatusCode:"RJ",label:"Injury"},{matchUpStatusCodeDisplay:"Ret [ill]",matchUpStatusCode:"RI",label:"Illness"},{matchUpStatusCodeDisplay:"Ret [pc]",label:yk,matchUpStatusCode:"RC"},{description:"Retirement because of adult discipline",label:"Ret. (adult discipline)",matchUpStatusCodeDisplay:"Ret [ad]",matchUpStatusCode:"RD"},{description:"A player who retires from a match remains eligible for consolations, place playoffs, doubles and subsequent round robin matches",matchUpStatusCodeDisplay:"Ret [elg]",label:"Ret. (eligible)",matchUpStatusCode:"RU"}],[bu]:[{matchUpStatusCodeDisplay:"Wd [inj]",matchUpStatusCode:"WD.INJ",label:"Injury"},{matchUpStatusCodeDisplay:"Wd [ill]",matchUpStatusCode:"WD.ILL",label:"Illness"},{matchUpStatusCodeDisplay:"Wd [pc]",label:yk,matchUpStatusCode:"WD.PC"},{matchUpStatusCodeDisplay:"Wd/Wd",matchUpStatusCode:"WD.WD",label:"Double withdrawal"},{label:"Tournament Administrative Error",matchUpStatusCodeDisplay:"Wd [Tae]",matchUpStatusCode:"WD.TAE"}]}}},Uqe={[Rs]:{seedingProfile:{positioning:sU},validSeedPositions:{ignore:!0},duplicateSeedNumbers:!0,drawSizeProgression:!0,policyName:"ITF SEEDING",seedsCountThresholds:[{drawSize:4,minimumParticipantCount:3,seedsCount:2},{drawSize:16,minimumParticipantCount:12,seedsCount:4},{drawSize:32,minimumParticipantCount:24,seedsCount:8},{drawSize:64,minimumParticipantCount:48,seedsCount:16},{drawSize:128,minimumParticipantCount:97,seedsCount:32},{drawSize:256,minimumParticipantCount:192,seedsCount:64}]}},Tqe={POLICY_AVOIDANCE_COUNTRY:gqe,POLICY_POSITION_ACTIONS_DEFAULT:zse,POLICY_POSITION_ACTIONS_DISABLED:yqe,POLICY_POSITION_ACTIONS_NO_MOVEMENT:vqe,POLICY_POSITION_ACTIONS_UNRESTRICTED:Iqe,POLICY_PRIVACY_DEFAULT:bqe,POLICY_ROUND_NAMING_DEFAULT:b2,POLICY_SCHEDULING_DEFAULT:Ele,POLICY_SCORING_DEFAULT:wqe,POLICY_SCORING_USTA:Sqe,POLICY_SEEDING_ITF:Uqe,POLICY_SEEDING_DEFAULT:ple},Zx={competitionFormats:hqe,ratingsParameters:Dr,matchUpFormats:mFe,countryToFlag:Tne,tieFormats:Gle,countries:ud,policies:Tqe,flagIOC:dLe},uT={};dt(uT,{activeMatchUpStatuses:()=>JB,auditConstants:()=>tHe,competitionFormatConstants:()=>Aqe,completedMatchUpStatuses:()=>Ki,directingMatchUpStatuses:()=>cne,displayConstants:()=>PBe,drawDefinitionConstants:()=>Bre,entryStatusConstants:()=>bLe,errorConditionConstants:()=>a1e,eventConstants:()=>yFe,extensionConstants:()=>ene,flightConstants:()=>mHe,genderConstants:()=>UB,keyValueConstants:()=>gVe,matchUpActionConstants:()=>ABe,matchUpStatusConstants:()=>LM,matchUpTypes:()=>Exe,nonDirectingMatchUpStatuses:()=>dne,particicipantsRequiredMatchUpStatuses:()=>lne,participantConstants:()=>cLe,participantRoles:()=>_2,participantTypes:()=>zy,penaltyConstants:()=>Xqe,policyConstants:()=>qFe,positionActionConstants:()=>F$e,rankingConstants:()=>UGe,ratingConstants:()=>D0e,recoveryTimeRequiredMatchUpStatuses:()=>aLe,requestConstants:()=>lWe,resourceContants:()=>oFe,resultConstants:()=>Vxe,scaleConstants:()=>GFe,scheduleConstants:()=>KLe,sortingConstants:()=>wHe,surfaceConstants:()=>i3e,tieFormatConstants:()=>hFe,timeItemConstants:()=>GLe,topicConstants:()=>oLe,tournamentConstants:()=>Gse,upcomingMatchUpStatuses:()=>pne,validMatchUpStatuses:()=>une,venueConstants:()=>a3e,weekdayConstants:()=>Kle});var Dqe="INTENNSE_STANDARD",Pqe="TENNIS_STANDARD",Eqe="MATCHUP",Rqe="HALF",Cqe="SEGMENT",Mqe="BETWEEN_GAMES",Nqe="BETWEEN_POINTS",Aqe={INTENNSE_STANDARD:Dqe,TENNIS_STANDARD:Pqe,MATCHUP:Eqe,SET:"SET",HALF:Rqe,SEGMENT:Cqe,BETWEEN_GAMES:Mqe,BETWEEN_POINTS:Nqe,ANY:"ANY"},kqe="Coaching",Oqe="Ball Abuse",xqe="Racket Abuse",Fqe="Verbal Abuse",Lqe="INELIGIBILITY",_qe="Physical Abuse",$qe="Unsportmanlike Conduct",Bqe="Dress Code Violation",Vqe="Equipment Violation",jqe="Leaving the court",Gqe="Failure to complete",Hqe="No Show",Wqe="Other",zqe="REFUSAL_TO_PLAY",qqe="PROHIBITED_SUBSTANCE",Yqe="Puncuality",Kqe="Failure to sign in",Xqe={COACHING:kqe,BALL_ABUSE:Oqe,RACKET_ABUSE:xqe,VERBAL_ABUSE:Fqe,PHYSICAL_ABUSE:_qe,INELIGIBILITY:Lqe,UNSPORTSMANLIKE_CONDUCT:$qe,PROHIBITED_SUBSTANCE:qqe,DRESS_CODE_VIOLATION:Bqe,EQUIMENT_VIOLATION:Vqe,LEAVING_THE_COURT:jqe,REFUSAL_TO_PLAY:zqe,FAILURE_TO_COMPLETE:Gqe,NO_SHOW:Hqe,OTHER:Wqe,PUNCTUALITY:Yqe,FAILUIRE_TO_SIGN_IN:Kqe},Jqe="CLAY",Qqe="HARD",Zqe="GRASS",e3e="CARPET",t3e="ARTIFICIAL",i3e={CLAY:Jqe,HARD:Qqe,GRASS:Zqe,CARPET:e3e,ARTIFICIAL:t3e},r3e="INDOOR",n3e="OUTDOOR",a3e={INDOOR:r3e,OUTDOOR:n3e};const s3e=t=>hn("chc-flag",t?.variant&&`chc-flag--${t.variant}`);function o3e({matchUp:t,individualParticipant:e,spacer:i}){const r=e?.person?.iso2NationalityCode||"",n=r?Zx.countryToFlag(r)?.slice(0,4):"",a=document.createElement("span"),s=t?.matchUpType?.toLowerCase();return i||(a.className=s3e({variant:s})),a.innerHTML=i?"":n,a}function bk({individualParticipant:t,composition:e,className:i,matchUp:r,spacer:n,side:a,type:s}){if(s==="scale")return Dxe({individualParticipant:t,composition:e,className:i,matchUp:r,spacer:n});const o=e?.configuration||{},l=document.createElement("div");if(s==="flag"&&o.flags)return o3e({matchUp:r,individualParticipant:t,spacer:n});if(s==="seeding"){const u=Uxe({className:i,composition:e,side:a});return typeof u=="string"?l:u}return l}const l3e="Qualifier",u3e="BYE",c3e="TBD";function o3(t){const{isWinningSide:e,side:i,sideNumber:r,individualParticipant:n,matchUp:a,composition:s}=t||{},o=e?"winner":void 0,l=t.eventHandlers||{},u=s?.configuration,c={QUALIFIER:u?.placeHolders?.qualifier||l3e,BYE:u?.placeHolders?.bye||u3e,TBD:u?.placeHolders?.tbd||c3e},d=n?.participantName,p=U=>{da(l?.participantClick)&&(U.stopPropagation(),l.participantClick({individualParticipant:n,pointerEvent:U,matchUp:a,side:i}))},f=document.createElement("div");f.classList.add("tmx-i"),f.setAttribute("sideNumber",String(r)),f.setAttribute("id",n?.participantId),f.onclick=p;const m=document.createElement("div");m.className=SOe();const h=u?.flags&&bk({...t,type:"flag"});if(h)m.appendChild(h);else{const U=bk({type:"scale",...t});U&&m.appendChild(U)}const g=document.createElement("div");g.className=UOe({variant:o});const I=a?.roundNumber===1,v=a?.drawType==="FEED_IN"&&a?.roundNumber>1&&i?.drawPosition&&!i?.sourceMatchUp,w=I||v,y=u?.persistInputFields;if(u?.inlineAssignment&&da(l?.assignParticipant)&&da(u?.participantProvider)&&w&&(!i?.bye||y)&&(!i?.qualifier||y)&&a&&(!d||i?.bye||i?.qualifier||y)){let U;i?.bye?U={participantId:"__BYE__",participantName:"â BYE â"}:i?.qualifier?U={participantId:"__QUALIFIER__",participantName:"â QUALIFIER â"}:U=n;const T=wxe({matchUp:a,side:i,sideNumber:r,eventHandlers:l,composition:s,currentParticipant:U});g.appendChild(T)}else if(d){const U=document.createElement("span");if(e&&u?.winnerColor)U.style.color=typeof u.winnerColor=="string"?u.winnerColor:"green";else if(u?.genderColor){const T=n?.person?.sex,P=T==="MALE"&&"#2E86C1"||T==="FEMALE"&&"#AA336A"||"";U.style.color=typeof u.genderColor=="string"?u.genderColor:P}U.innerHTML=d,g.appendChild(U)}else{const U=document.createElement("abbr");U.className=wOe({variant:u?.showAddress?"showAddress":""}),U.innerHTML=i?.bye&&c.BYE||i?.qualifier&&c.QUALIFIER||c.TBD,g.appendChild(U)}const b=bk({...t,className:Sxe(),type:"seeding"});b&&g.appendChild(b),m.appendChild(g),f.appendChild(m);const S=AOe(t);return f.appendChild(S),{element:f}}const d3e=t=>hn("chc-pill",t?.variant&&`chc-pill--${t.variant}`),{WALKOVER:p3e,DEFAULTED:f3e,DOUBLE_WALKOVER:m3e,DOUBLE_DEFAULT:h3e,ABANDONED:g3e}=LM;function I3e({matchUpStatus:t}){const e=t?.toLowerCase(),i=["defaulted","retired","walkover","defaulted","double_walkover","double_default","cancelled","in_progress","awaiting_result","dead_rubber","incomplete","suspended","abandoned"].includes(e)?e:void 0,r=[p3e,m3e].includes(t||"")?"WO":[f3e,h3e].includes(t||"")?"DEF":t===g3e?"ABD":t?.split("_").join("").slice(0,3)||"",n=document.createElement("div");n.className=d3e(i?{variant:i}:{});const a=document.createElement("abbr");return a.setAttribute("title",t||""),a.style.textDecoration="none",a.style.borderBottom="none",a.innerHTML=r,n.appendChild(a),n}function v3e(t){return t instanceof Element||t}const y3e=()=>"chc-team-logo";function b3e({teamLogo:t}){console.log({teamLogo:t});const e=document.createElement("div");return e.className=y3e(),e}const w3e=()=>"chc-side-container",S3e=()=>"chc-side-row",U3e=()=>"chc-tick";function T3e({dim:t="20px"}={}){const e=U3e();return`
    <div style="line-height: 0;">
      <svg height="${t}" viewBox="0 0 18 24" width="${t}" xmlns="http://www.w3.org/2000/svg" class="${e}" style="fill: currentcolor;">
        <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"></path>
      </svg>
    </div>
  `}const{WALKOVER:D3e,DEFAULTED:P3e,DOUBLE_WALKOVER:E3e,DOUBLE_DEFAULT:R3e,RETIRED:C3e,SUSPENDED:M3e,CANCELLED:N3e,IN_PROGRESS:A3e,ABANDONED:k3e}=LM;function bpe({initialRoundNumber:t=1,eventHandlers:e,sideContainer:i,composition:r,participant:n,placeholder:a,sideNumber:s,matchUp:o}){const{winningSide:l,matchUpType:u,isRoundRobin:c,matchUpStatus:d}=o||{},p=r?.configuration;let f;const m=s?o?.sides?.find(E=>E.sideNumber===s):void 0;n||(n=m?.participant,f=p?.allDrawPositions||p?.drawPositions&&m?.drawPosition&&(o?.roundNumber===t||m?.participantFed||c)?m?.drawPosition:"");const h=u==="DOUBLES",g=h?n?.individualParticipants?.[0]:n,I=h&&n?.individualParticipants?.[1],v=!!(s===l||d==="BYE"&&n),w=p?.winnerChevron&&v,y=p?.teamLogo,b=[C3e,D3e,P3e,E3e,R3e,M3e,N3e,A3e,k3e].includes(d)&&!v,S=p?.gameScoreOnly,U=document.createElement("div");if(i&&(U.className=DOe({drawPosition:f,sideNumber:s}),f&&(U.dataset.drawPosition=String(f))),U.classList.add("tmx-p"),U.setAttribute("id",n?.participantId||""),y){const E=b3e({teamLogo:y});U.appendChild(E)}const T=document.createElement("div");T.className=TOe(h?{variant:"doubles"}:{});const P=document.createElement("div");P.className=POe({winnerChevron:w,isDoubles:h});const D=o3({individualParticipant:g,eventHandlers:e,isWinningSide:v,composition:r,sideNumber:s,matchUp:o,side:m}).element;if(P.appendChild(D),I){const E=o3({individualParticipant:I,eventHandlers:e,isWinningSide:v,composition:r,sideNumber:s,matchUp:o,side:m}).element;P.appendChild(E)}else h&&a&&v3e(a)&&P.appendChild(a);if(T.appendChild(P),U.appendChild(T),i){const E=document.createElement("div");if(v&&!S){const R=T3e();typeof R=="string"?E.innerHTML=R:E.appendChild(R)}else if(b){const R=I3e({matchUpStatus:d});E.appendChild(R)}U.appendChild(E)}return U}const O3e=()=>"chc-round-header";function x3e({eventHandlers:t,roundMatchUps:e,roundProfile:i,roundNumber:r,context:n}){const a=document.createElement("div");a.className=O3e(),a.classList.add("tmx-rh"),a.setAttribute("roundNumber",String(r));const s=da(t?.roundHeaderClick);s&&(a.onclick=c=>t.roundHeaderClick({roundNumber:r,roundProfile:i,roundMatchUps:e,context:n,pointerEvent:c}));const o=s?"â®":"",l=i?.[r]?.roundName,u=l&&` <div style="display: flex; flex-direction: row; justify-content: space-between">
        <div>${l}</div>
        <div style="font-weight: bold">${o}</div>
      </div>
  `;return a.innerHTML=u||"",a}const wpe=()=>"chc-round-container",F3e=()=>"chc-structure",Spe=t=>hn("chc-round",t?.variant==="adHoc"&&"chc-round--adhoc"),L3e=t=>hn("chc-group-separator",t?.variant===0&&"chc-group-separator--0",t?.roundOrder==="first"&&"chc-group-separator--round-first",t?.roundOrder==="last"&&"chc-group-separator--round-last"),_3e=()=>"chc-group-name",l3=t=>hn("chc-results-item",t?.variant&&`chc-results-item--${t.variant}`),$3e=()=>"chc-results-info";function B3e(){return"chc-selected-matchup"}const V3e=()=>"chc-matchup-container";function j3e({configuration:t}){return t?.matchUpHover?"chc-matchup chc-matchup--custom-hover":"chc-matchup"}function G3e({variant:t}){return hn("chc-center-info",t!=null&&`chc-center-info--${t}`)}const H3e=()=>"chc-column",W3e=()=>"chc-entry",u3=()=>"chc-status";function z3e({eventHandlers:t,entryStatus:e,sideNumber:i,className:r,matchUp:n}){const a=document.createElement("div");da(t?.centerInfoClick)&&(a.onclick=c=>t.centerInfoClick({matchUp:n,sideNumber:i,pointerEvent:c})),a.className=hn(G3e({variant:i}),r),a.classList.add("tmx-ci"),a.setAttribute("sideNumber",String(i));const s=document.createElement("div");s.className=H3e();const o=document.createElement("div");o.className=W3e();const l=document.createElement("div");l.className=u3(),l.innerHTML=e?"Entry status:&nbsp;":"",o.appendChild(l);const u=document.createElement("div");return u.className=u3(),u.innerHTML=e||"",o.appendChild(u),s.appendChild(o),a.appendChild(s),{element:a}}const c3={scheduleInfo:1.8,centerInfo:1.5};function q3e({composition:t,isDoubles:e,roundFactor:i=1}){const r=parseInt(window.getComputedStyle(document.body).getPropertyValue("font-size")),n=t?.configuration||{},a=n?.connectorWidth||16,s=n.centerInfo?c3.centerInfo*r:0,o=n.scheduleInfo?c3.scheduleInfo*r:0,l=(60+(n.showAddress?r:0))*(e?1.3:1)+s,u=l*i,c=(l+o)*i;return d=>{const p=hn("chc-link",d.isFirstRound&&"chc-link--first-round",d.link==="mr"&&"chc-link--no-link",d.link==="m1"&&"chc-link--m1",d.link==="m2"&&"chc-link--m2",d.link==="m0"&&"chc-link--m0",d.link==="noProgression"&&"chc-link--no-progression");return{className:p,applyStyles(f){f.style.setProperty("--chc-connector-w",`${a}px`),f.style.setProperty("--chc-link-m1-h",`${u}px`),f.style.setProperty("--chc-link-m2-h",`${c}px`)},toString(){return p}}}}const Upe=t=>e=>hn("chc-score-wrapper",(e?.sideNumber===1||String(e?.sideNumber)==="1")&&"chc-score-wrapper--side1",e?.fontSize==="small"&&"chc-score-wrapper--small"),Y3e=()=>"chc-tiebreak",Tpe=t=>hn("chc-game-score",t?.variant&&`chc-game-score--${t.variant}`),K3e=()=>"chc-game-wrapper";function X3e({value:t}={}){const e=document.createElement("input");return e.onclick=i=>i.target.select(),e.className=Tpe(),e.value=String(t||""),e}function J3e({gameScoreOnly:t,scoreStripes:e,set:i,sideNumber:r}){const n=r===i?.winningSide||i?.winningSide?"loser":void 0,a=r===2?i.side2Score:i.side1Score,s=i.side2TiebreakScore||i.side1TiebreakScore,o=r===2?i.side2TiebreakScore:i.side1TiebreakScore,l=a===void 0&&o,u=l||a,c=e&&i.setNumber%2?"var(--chc-bg-secondary)":"transparent",d=i.editing?i.editing===r:void 0;let p;if(d)p=X3e({value:u});else if(p=document.createElement("p"),p.className=Tpe({variant:n}),p.classList.add("tmx-st"),p.setAttribute("setNumber",i.setNumber),p.style.backgroundColor=c,p.innerHTML=isNaN(u)?"":u,!t){const f=document.createElement("span");f.className=Y3e(),f.innerHTML=s&&!l?String(o):"",p.appendChild(f)}return p}function Q3e({participantHeight:t,eventHandlers:e,composition:i,sideNumber:r,matchUp:n}){const a=i?.configuration?.winnerChevron,s=i?.configuration?.gameScoreOnly,o=n?.score?.sets||[],l=i?.configuration?.scoreBox,u=t?r===2?t:t-1:void 0,c=f=>{da(e?.scoreClick)&&(f.stopPropagation(),e.scoreClick({pointerEvent:f,matchUp:n}))},d=document.createElement("div");d.className=Upe()({...!l&&r===1&&{sideNumber:1},fontSize:"small"}),u&&(d.style.height=`${u}px`),d.classList.add("sideScore"),d.classList.add("tmx-scr"),d.onclick=c;const p=document.createElement("div");p.className=K3e();for(const f of o||[]){const m=J3e({gameScoreOnly:s,scoreStripes:a,sideNumber:r,set:f});p.appendChild(m)}return d.appendChild(p),d}const Z3e=()=>"chc-scheduling";var e1={exports:{}},eYe=e1.exports,d3;function tYe(){return d3||(d3=1,(function(t,e){(function(i,r){t.exports=r()})(eYe,(function(){var i=1e3,r=6e4,n=36e5,a="millisecond",s="second",o="minute",l="hour",u="day",c="week",d="month",p="quarter",f="year",m="date",h="Invalid Date",g=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,I=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,v={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(M){var N=["th","st","nd","rd"],A=M%100;return"["+M+(N[(A-20)%10]||N[A]||N[0])+"]"}},w=function(M,N,A){var O=String(M);return!O||O.length>=N?M:""+Array(N+1-O.length).join(A)+M},y={s:w,z:function(M){var N=-M.utcOffset(),A=Math.abs(N),O=Math.floor(A/60),k=A%60;return(N<=0?"+":"-")+w(O,2,"0")+":"+w(k,2,"0")},m:function M(N,A){if(N.date()<A.date())return-M(A,N);var O=12*(A.year()-N.year())+(A.month()-N.month()),k=N.clone().add(O,d),F=A-k<0,x=N.clone().add(O+(F?-1:1),d);return+(-(O+(A-k)/(F?k-x:x-k))||0)},a:function(M){return M<0?Math.ceil(M)||0:Math.floor(M)},p:function(M){return{M:d,y:f,w:c,d:u,D:m,h:l,m:o,s,ms:a,Q:p}[M]||String(M||"").toLowerCase().replace(/s$/,"")},u:function(M){return M===void 0}},b="en",S={};S[b]=v;var U="$isDayjsObject",T=function(M){return M instanceof R||!(!M||!M[U])},P=function M(N,A,O){var k;if(!N)return b;if(typeof N=="string"){var F=N.toLowerCase();S[F]&&(k=F),A&&(S[F]=A,k=F);var x=N.split("-");if(!k&&x.length>1)return M(x[0])}else{var L=N.name;S[L]=N,k=L}return!O&&k&&(b=k),k||!O&&b},D=function(M,N){if(T(M))return M.clone();var A=typeof N=="object"?N:{};return A.date=M,A.args=arguments,new R(A)},E=y;E.l=P,E.i=T,E.w=function(M,N){return D(M,{locale:N.$L,utc:N.$u,x:N.$x,$offset:N.$offset})};var R=(function(){function M(A){this.$L=P(A.locale,null,!0),this.parse(A),this.$x=this.$x||A.x||{},this[U]=!0}var N=M.prototype;return N.parse=function(A){this.$d=(function(O){var k=O.date,F=O.utc;if(k===null)return new Date(NaN);if(E.u(k))return new Date;if(k instanceof Date)return new Date(k);if(typeof k=="string"&&!/Z$/i.test(k)){var x=k.match(g);if(x){var L=x[2]-1||0,$=(x[7]||"0").substring(0,3);return F?new Date(Date.UTC(x[1],L,x[3]||1,x[4]||0,x[5]||0,x[6]||0,$)):new Date(x[1],L,x[3]||1,x[4]||0,x[5]||0,x[6]||0,$)}}return new Date(k)})(A),this.init()},N.init=function(){var A=this.$d;this.$y=A.getFullYear(),this.$M=A.getMonth(),this.$D=A.getDate(),this.$W=A.getDay(),this.$H=A.getHours(),this.$m=A.getMinutes(),this.$s=A.getSeconds(),this.$ms=A.getMilliseconds()},N.$utils=function(){return E},N.isValid=function(){return this.$d.toString()!==h},N.isSame=function(A,O){var k=D(A);return this.startOf(O)<=k&&k<=this.endOf(O)},N.isAfter=function(A,O){return D(A)<this.startOf(O)},N.isBefore=function(A,O){return this.endOf(O)<D(A)},N.$g=function(A,O,k){return E.u(A)?this[O]:this.set(k,A)},N.unix=function(){return Math.floor(this.valueOf()/1e3)},N.valueOf=function(){return this.$d.getTime()},N.startOf=function(A,O){var k=this,F=!!E.u(O)||O,x=E.p(A),L=function(Y,X){var Z=E.w(k.$u?Date.UTC(k.$y,X,Y):new Date(k.$y,X,Y),k);return F?Z:Z.endOf(u)},$=function(Y,X){return E.w(k.toDate()[Y].apply(k.toDate("s"),(F?[0,0,0,0]:[23,59,59,999]).slice(X)),k)},V=this.$W,_=this.$M,B=this.$D,G="set"+(this.$u?"UTC":"");switch(x){case f:return F?L(1,0):L(31,11);case d:return F?L(1,_):L(0,_+1);case c:var j=this.$locale().weekStart||0,K=(V<j?V+7:V)-j;return L(F?B-K:B+(6-K),_);case u:case m:return $(G+"Hours",0);case l:return $(G+"Minutes",1);case o:return $(G+"Seconds",2);case s:return $(G+"Milliseconds",3);default:return this.clone()}},N.endOf=function(A){return this.startOf(A,!1)},N.$set=function(A,O){var k,F=E.p(A),x="set"+(this.$u?"UTC":""),L=(k={},k[u]=x+"Date",k[m]=x+"Date",k[d]=x+"Month",k[f]=x+"FullYear",k[l]=x+"Hours",k[o]=x+"Minutes",k[s]=x+"Seconds",k[a]=x+"Milliseconds",k)[F],$=F===u?this.$D+(O-this.$W):O;if(F===d||F===f){var V=this.clone().set(m,1);V.$d[L]($),V.init(),this.$d=V.set(m,Math.min(this.$D,V.daysInMonth())).$d}else L&&this.$d[L]($);return this.init(),this},N.set=function(A,O){return this.clone().$set(A,O)},N.get=function(A){return this[E.p(A)]()},N.add=function(A,O){var k,F=this;A=Number(A);var x=E.p(O),L=function(_){var B=D(F);return E.w(B.date(B.date()+Math.round(_*A)),F)};if(x===d)return this.set(d,this.$M+A);if(x===f)return this.set(f,this.$y+A);if(x===u)return L(1);if(x===c)return L(7);var $=(k={},k[o]=r,k[l]=n,k[s]=i,k)[x]||1,V=this.$d.getTime()+A*$;return E.w(V,this)},N.subtract=function(A,O){return this.add(-1*A,O)},N.format=function(A){var O=this,k=this.$locale();if(!this.isValid())return k.invalidDate||h;var F=A||"YYYY-MM-DDTHH:mm:ssZ",x=E.z(this),L=this.$H,$=this.$m,V=this.$M,_=k.weekdays,B=k.months,G=k.meridiem,j=function(X,Z,J,ae){return X&&(X[Z]||X(O,F))||J[Z].slice(0,ae)},K=function(X){return E.s(L%12||12,X,"0")},Y=G||function(X,Z,J){var ae=X<12?"AM":"PM";return J?ae.toLowerCase():ae};return F.replace(I,(function(X,Z){return Z||(function(J){switch(J){case"YY":return String(O.$y).slice(-2);case"YYYY":return E.s(O.$y,4,"0");case"M":return V+1;case"MM":return E.s(V+1,2,"0");case"MMM":return j(k.monthsShort,V,B,3);case"MMMM":return j(B,V);case"D":return O.$D;case"DD":return E.s(O.$D,2,"0");case"d":return String(O.$W);case"dd":return j(k.weekdaysMin,O.$W,_,2);case"ddd":return j(k.weekdaysShort,O.$W,_,3);case"dddd":return _[O.$W];case"H":return String(L);case"HH":return E.s(L,2,"0");case"h":return K(1);case"hh":return K(2);case"a":return Y(L,$,!0);case"A":return Y(L,$,!1);case"m":return String($);case"mm":return E.s($,2,"0");case"s":return String(O.$s);case"ss":return E.s(O.$s,2,"0");case"SSS":return E.s(O.$ms,3,"0");case"Z":return x}return null})(X)||x.replace(":","")}))},N.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},N.diff=function(A,O,k){var F,x=this,L=E.p(O),$=D(A),V=($.utcOffset()-this.utcOffset())*r,_=this-$,B=function(){return E.m(x,$)};switch(L){case f:F=B()/12;break;case d:F=B();break;case p:F=B()/3;break;case c:F=(_-V)/6048e5;break;case u:F=(_-V)/864e5;break;case l:F=_/n;break;case o:F=_/r;break;case s:F=_/i;break;default:F=_}return k?F:E.a(F)},N.daysInMonth=function(){return this.endOf(d).$D},N.$locale=function(){return S[this.$L]},N.locale=function(A,O){if(!A)return this.$L;var k=this.clone(),F=P(A,O,!0);return F&&(k.$L=F),k},N.clone=function(){return E.w(this.$d,this)},N.toDate=function(){return new Date(this.valueOf())},N.toJSON=function(){return this.isValid()?this.toISOString():null},N.toISOString=function(){return this.$d.toISOString()},N.toString=function(){return this.$d.toUTCString()},M})(),C=R.prototype;return D.prototype=C,[["$ms",a],["$s",s],["$m",o],["$H",l],["$W",u],["$M",d],["$y",f],["$D",m]].forEach((function(M){C[M[1]]=function(N){return this.$g(N,M[0],M[1])}})),D.extend=function(M,N){return M.$i||(M(N,R,D),M.$i=!0),D},D.locale=P,D.isDayjs=T,D.unix=function(M){return D(1e3*M)},D.en=S[b],D.Ls=S,D.p={},D}))})(e1)),e1.exports}var iYe=tYe();const rYe=L$(iYe);function nYe({matchUp:t,eventHandlers:e}){const{scheduledTime:i,scheduledDate:r,venueAbbreviation:n,courtName:a}=t?.schedule||{},{dateTime:{extractDate:s,extractTime:o}}=GG,l=o(i);let u=s(r),c="ddd D MMMM";l&&(c+=", hh:mm A",u+=`T${l}`);const d=r?rYe(u).format(c):"Not scheduled",p=n&&a?.toString().startsWith(n)&&a||n&&a&&`${n} ${a}`||a||n||"",f=document.createElement("div");f.className=Z3e(),f.classList.add("tmx-sch"),da(e?.scheduleClick)&&(f.onclick=v=>e.scheduleClick({matchUp:t,pointerEvent:v}));const m=document.createElement("div");m.innerHTML=d,f.append(m);const h=v=>{da(e?.venueClick)&&(v.stopPropagation(),e.venueClick({pointerEvent:v,matchUp:t}))},g=document.createElement("div");g.style="display: flex; flex-direction: row";const I=document.createElement("div");if(I.style.paddingRight=".2rem",I.onclick=h,I.innerHTML=p,g.append(I),f.append(g),f.onclick){const v=document.createElement("div");v.innerHTML="â®",g.append(v)}return f}const{completedMatchUpStatuses:aYe}=uT;function p3({initialRoundNumber:t=1,eventHandlers:e,composition:i,sideNumber:r,className:n,matchUp:a}){const s=(i?.configuration||{})?.scheduleInfo,o=a?.score?.scoreStringSide1,l=i?.configuration?.scoreBox&&o,u=a?.matchUpStatus&&aYe.includes(a.matchUpStatus),c=a?.readyToScore&&e?.scoreClick&&!ype.checkScoreHasValue({matchUp:a})&&!u,d=document.createElement("div");if(d.className=hn(w3e(),n),d.classList.add("tmx-sd"),d.setAttribute("sideNumber",String(r)),s&&r===1){const m=nYe({matchUp:a,eventHandlers:e});d.appendChild(m)}const p=document.createElement("div");p.className=S3e();const f=bpe({sideContainer:!0,initialRoundNumber:t,eventHandlers:e,composition:i,sideNumber:r,matchUp:a});if(p.appendChild(f),l){const m=document.createElement("div");m.style.border="1px solid var(--chc-border-secondary)",p.appendChild(m)}if(o){const m=Q3e({eventHandlers:e,composition:i,sideNumber:r,matchUp:a});p.appendChild(m)}if(c){const m=g=>{da(e?.scoreClick)&&(g.stopPropagation(),e.scoreClick({pointerEvent:g,matchUp:a}))},h=document.createElement("div");h.className=Upe()({...!l&&r===1&&{sideNumber:1},fontSize:"small"}),h.onclick=m,h.innerHTML="[Score]",p.appendChild(h)}return d.appendChild(p),d}function sYe(t){const{composition:e,initialRoundNumber:i=1,matchUp:r,moiety:n,selectedMatchUpId:a,searchActive:s}=t,{roundFactor:o,roundNumber:l,finishingRound:u,matchUpType:c,preFeedRound:d,stage:p}=r,f=t.isFinalRound||(u?Number.parseInt(String(u))===1:!1),m=p==="QUALIFYING"&&f,h=f,g=l?Number.parseInt(String(l))===i:!1,I=c==="DOUBLES",v=(s||r.isRoundRobin||r.collectionId||t.isLucky||t.isAdHoc)&&"mr"||h&&"noProgression"||(m||d)&&"m0"||n&&"m1"||"m2",w=q3e({composition:e,isDoubles:I,roundFactor:o})({isFirstRound:g,link:v}),y=w.className,b=e?.configuration||{},{resultsInfo:S,centerInfo:U}=b||{},T=t.eventHandlers||{},P=N=>{da(T?.matchUpClick)&&T.matchUpClick({pointerEvent:N,matchUp:r})},D=document.createElement("div");D.className=hn(e?.theme,t?.className,"matchup",V3e()),D.classList.add("tmx-m"),D.setAttribute("id",r?.matchUpId),D.onclick=P;const E=document.createElement("div");E.className=j3e({configuration:b});const R=({sideNumber:N})=>{const A=r?.sides?.find(O=>O.sideNumber===N)?.participant?.entryStatus?.replace("_"," ");return z3e({eventHandlers:T,entryStatus:A,sideNumber:N,className:N===2?y:void 0,matchUp:r})},C=p3({initialRoundNumber:i,eventHandlers:T,sideNumber:1,composition:e,matchUp:r}),M=p3({className:!U&&y,initialRoundNumber:i,eventHandlers:T,sideNumber:2,composition:e,matchUp:r});if(E.appendChild(C),U){const N=R({sideNumber:1}),A=R({sideNumber:2});E.appendChild(N.element),A.element&&w.applyStyles(A.element),E.appendChild(A.element)}if(E.appendChild(M),U||w.applyStyles(M),S){const N=oYe({score:r.score});E.appendChild(N)}if(D.appendChild(E),a===r.matchUpId){const N=document.createElement("div");N.className=B3e(),D.appendChild(N)}return D}function oYe({score:t}){const e=t?.sets?.filter(Boolean).sort((a,s)=>(a.setNumber||0)-(s.setNumber||0)),i=e?.at(-1),r=i?.side1PointsScore||i?.side2PointsScore,n=document.createElement("div");if(n.className=$3e(),r){const a=document.createElement("div");a.className=l3({variant:"points"}),a.innerHTML="PTS",n.appendChild(a)}for(const a of e||[]){const s=document.createElement("div");s.setAttribute("key",String(a.setNumber)),s.className=l3({variant:"set"}),s.innerHTML=String(a.setNumber),n.appendChild(s)}return n}function lYe({initialRoundNumber:t=1,selectedMatchUpId:e,eventHandlers:i,isFinalRound:r,isRoundRobin:n,searchActive:a,composition:s,roundFactor:o,roundNumber:l,roundProfile:u,minWidth:c,matchUps:d,context:p,isLucky:f}){const m=d.filter(D=>D.roundNumber===l).sort((D,E)=>(D.roundPosition||0)-(E.roundPosition||0)),h=m.every(({roundPosition:D,drawPositions:E})=>!D&&!E),g=s?.configuration||{},I=document.createElement("div");if(I.className=wpe(),I.classList.add("tmx-rd"),I.setAttribute("roundNumber",String(l)),g.roundHeader){const D=x3e({roundProfile:u,roundMatchUps:m,roundNumber:l,eventHandlers:i,context:p});I.appendChild(D)}const v=document.createElement("div");v.className=Spe({variant:h?"adHoc":void 0}),c&&(v.style.minWidth=c);let w,y,b;if(n){const D=R=>(R||[]).reduce((C,M)=>M+C,0);m.sort((R,C)=>{const M=D(R.drawPositions)-D(C.drawPositions),N=R.drawPositions||[],A=C.drawPositions||[],O=(N.length?Math.min.apply(null,N):0)-(A.length?Math.min.apply(null,A):0);return M||O});const E=m.reduce((R,C)=>(R[C.structureId]=C.structureName,R),{});w=Object.values(E),y=Object.keys(E),b=Object.keys(GG.instanceCount(m.map(({structureId:R})=>R))).length}else h&&m.sort((D,E)=>(D.roundOrder??0)-(E.roundOrder??0));const S=b&&m.length/b,U=Object.keys(u).map(D=>parseInt(D)),T=U.indexOf(l),P=T===0&&"first"||T===U.length-1&&"last";return m.forEach((D,E)=>{const R=S&&!(E%S),C=S&&Math.floor(E/S),M=S&&w[C];if(R){const O=document.createElement("div");O.className=L3e({...C===0&&{variant:0},...P&&{roundOrder:P}}),v.appendChild(O);const k=document.createElement("div");if(k.className=_3e(),da(i?.groupHeaderClick)){const{drawId:F,containerStructureId:x}=m[0];v.onclick=L=>i.groupHeaderClick({structureId:y[C],containerStructureId:x,pointerEvent:L,drawId:F})}l===t&&(k.innerHTML=M),v.appendChild(k)}const N=E%2===0;o?D.roundFactor=o:t>1&&(D.roundFactor=Math.pow(2,l-t));const A=sYe({initialRoundNumber:t,selectedMatchUpId:e,eventHandlers:i,isFinalRound:r,searchActive:a,composition:s,isAdHoc:h,isLucky:f,matchUp:D,moiety:N});v.appendChild(A)}),I.appendChild(v),I}function uYe({initialRoundNumber:t=1,selectedMatchUpId:e,eventHandlers:i,searchActive:r,composition:n,structureId:a,finalColumn:s,matchUps:o,minWidth:l,context:u}){const{roundNumbers:c,roundProfile:d,hasOddMatchUpsCount:p,isNotEliminationStructure:f}=ype.getRoundMatchUps({matchUps:o});a=a||u?.structureId||o?.[0]?.structureId;const m=o.some(({isRoundRobin:v})=>v),h=p||f,g=document.createElement("div");g.className=F3e(),g.classList.add("tmx-str"),g.setAttribute("id",a||"");const I=c.length?Math.max.apply(null,c):0;for(const v of c){if(v<t)continue;const w=lYe({initialRoundNumber:t,selectedMatchUpId:e,eventHandlers:i,isFinalRound:v===I,isRoundRobin:m,searchActive:r,composition:n,roundNumber:v,roundProfile:d,matchUps:o,minWidth:l,context:u,isLucky:h});g.appendChild(w)}if(s&&typeof s!="boolean"){const v=document.createElement("div");v.className=wpe();const w=document.createElement("div");w.className=Spe(),w.appendChild(s),v.appendChild(w),g.appendChild(v)}return g}const f3=()=>"chc-container";function cYe({content:t,theme:e}){const i=document.createElement("div");return i.className=e?hn(f3(),e):f3(),e&&i.classList.add(e),typeof t=="string"?i.innerHTML=t:i.appendChild(t),i}function sy(t,e){return`chc-theme-${t.replace("-theme","")}`}const m3=sy("australian-theme"),dYe=sy("wimbledon-theme"),pYe=sy("french-theme"),fYe=sy("usopen-theme"),h3=sy("basic-theme"),mYe=sy("itf-theme"),hYe={Australian:{configuration:{flags:!0},theme:m3},Basic:{configuration:{gameScoreOnly:!0,teamLogo:!1,roundHeader:!0,placeHolders:{tbd:"-",bye:"Bye"}},theme:h3},DrawPositions:{configuration:{gameScoreOnly:!0,drawPositions:!0,teamLogo:!1},theme:h3},French:{configuration:{bracketedSeeds:!0,flags:!0},theme:pYe},Wimbledon:{configuration:{resultsInfo:!0,flags:!0},theme:dYe},"US Open":{configuration:{scoreBox:!0,flags:!0},theme:fYe},ITF:{configuration:{winnerChevron:!0,centerInfo:!0,flags:!0,roundHeader:!0},theme:mYe},National:{configuration:{bracketedSeeds:"square",allDrawPositions:!0,drawPositions:!0,scheduleInfo:!0,roundHeader:!0,showAddress:!0,scaleAttributes:{scaleColor:"red",scaleType:"RATING",scaleName:"WTN",accessor:"wtnRating"}},theme:m3}},{WTN:HQe,UTR:WQe}=uT.ratingConstants;new Date().toISOString().split("T")[0];new Date().toISOString().split("T")[0];const{WTN:zQe,UTR:qQe,TRN:YQe,NTRP:KQe,DUPR:XQe}=uT.ratingConstants,{RATING:JQe}=uT.scaleConstants,{validateMatchUpScore:QQe,validateSetScore:ZQe}=H$.scoreGovernor;var Ws="top",vl="bottom",yl="right",zs="left",YG="auto",cT=[Ws,vl,yl,zs],LI="start",fw="end",gYe="clippingParents",Dpe="viewport",hy="popper",IYe="reference",g3=cT.reduce(function(t,e){return t.concat([e+"-"+LI,e+"-"+fw])},[]),Ppe=[].concat(cT,[YG]).reduce(function(t,e){return t.concat([e,e+"-"+LI,e+"-"+fw])},[]),vYe="beforeRead",yYe="read",bYe="afterRead",wYe="beforeMain",SYe="main",UYe="afterMain",TYe="beforeWrite",DYe="write",PYe="afterWrite",EYe=[vYe,yYe,bYe,wYe,SYe,UYe,TYe,DYe,PYe];function Cc(t){return t?(t.nodeName||"").toLowerCase():null}function Ao(t){if(t==null)return window;if(t.toString()!=="[object Window]"){var e=t.ownerDocument;return e&&e.defaultView||window}return t}function Xm(t){var e=Ao(t).Element;return t instanceof e||t instanceof Element}function Zo(t){var e=Ao(t).HTMLElement;return t instanceof e||t instanceof HTMLElement}function KG(t){if(typeof ShadowRoot>"u")return!1;var e=Ao(t).ShadowRoot;return t instanceof e||t instanceof ShadowRoot}function RYe(t){var e=t.state;Object.keys(e.elements).forEach(function(i){var r=e.styles[i]||{},n=e.attributes[i]||{},a=e.elements[i];!Zo(a)||!Cc(a)||(Object.assign(a.style,r),Object.keys(n).forEach(function(s){var o=n[s];o===!1?a.removeAttribute(s):a.setAttribute(s,o===!0?"":o)}))})}function CYe(t){var e=t.state,i={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(e.elements.popper.style,i.popper),e.styles=i,e.elements.arrow&&Object.assign(e.elements.arrow.style,i.arrow),function(){Object.keys(e.elements).forEach(function(r){var n=e.elements[r],a=e.attributes[r]||{},s=Object.keys(e.styles.hasOwnProperty(r)?e.styles[r]:i[r]),o=s.reduce(function(l,u){return l[u]="",l},{});!Zo(n)||!Cc(n)||(Object.assign(n.style,o),Object.keys(a).forEach(function(l){n.removeAttribute(l)}))})}}const Epe={name:"applyStyles",enabled:!0,phase:"write",fn:RYe,effect:CYe,requires:["computeStyles"]};function tc(t){return t.split("-")[0]}var wm=Math.max,fE=Math.min,_I=Math.round;function t1(){var t=navigator.userAgentData;return t!=null&&t.brands&&Array.isArray(t.brands)?t.brands.map(function(e){return e.brand+"/"+e.version}).join(" "):navigator.userAgent}function Rpe(){return!/^((?!chrome|android).)*safari/i.test(t1())}function $I(t,e,i){e===void 0&&(e=!1),i===void 0&&(i=!1);var r=t.getBoundingClientRect(),n=1,a=1;e&&Zo(t)&&(n=t.offsetWidth>0&&_I(r.width)/t.offsetWidth||1,a=t.offsetHeight>0&&_I(r.height)/t.offsetHeight||1);var s=Xm(t)?Ao(t):window,o=s.visualViewport,l=!Rpe()&&i,u=(r.left+(l&&o?o.offsetLeft:0))/n,c=(r.top+(l&&o?o.offsetTop:0))/a,d=r.width/n,p=r.height/a;return{width:d,height:p,top:c,right:u+d,bottom:c+p,left:u,x:u,y:c}}function XG(t){var e=$I(t),i=t.offsetWidth,r=t.offsetHeight;return Math.abs(e.width-i)<=1&&(i=e.width),Math.abs(e.height-r)<=1&&(r=e.height),{x:t.offsetLeft,y:t.offsetTop,width:i,height:r}}function Cpe(t,e){var i=e.getRootNode&&e.getRootNode();if(t.contains(e))return!0;if(i&&KG(i)){var r=e;do{if(r&&t.isSameNode(r))return!0;r=r.parentNode||r.host}while(r)}return!1}function Nd(t){return Ao(t).getComputedStyle(t)}function MYe(t){return["table","td","th"].indexOf(Cc(t))>=0}function Rf(t){return((Xm(t)?t.ownerDocument:t.document)||window.document).documentElement}function pA(t){return Cc(t)==="html"?t:t.assignedSlot||t.parentNode||(KG(t)?t.host:null)||Rf(t)}function I3(t){return!Zo(t)||Nd(t).position==="fixed"?null:t.offsetParent}function NYe(t){var e=/firefox/i.test(t1()),i=/Trident/i.test(t1());if(i&&Zo(t)){var r=Nd(t);if(r.position==="fixed")return null}var n=pA(t);for(KG(n)&&(n=n.host);Zo(n)&&["html","body"].indexOf(Cc(n))<0;){var a=Nd(n);if(a.transform!=="none"||a.perspective!=="none"||a.contain==="paint"||["transform","perspective"].indexOf(a.willChange)!==-1||e&&a.willChange==="filter"||e&&a.filter&&a.filter!=="none")return n;n=n.parentNode}return null}function dT(t){for(var e=Ao(t),i=I3(t);i&&MYe(i)&&Nd(i).position==="static";)i=I3(i);return i&&(Cc(i)==="html"||Cc(i)==="body"&&Nd(i).position==="static")?e:i||NYe(t)||e}function JG(t){return["top","bottom"].indexOf(t)>=0?"x":"y"}function Zy(t,e,i){return wm(t,fE(e,i))}function AYe(t,e,i){var r=Zy(t,e,i);return r>i?i:r}function Mpe(){return{top:0,right:0,bottom:0,left:0}}function Npe(t){return Object.assign({},Mpe(),t)}function Ape(t,e){return e.reduce(function(i,r){return i[r]=t,i},{})}var kYe=function(t,e){return t=typeof t=="function"?t(Object.assign({},e.rects,{placement:e.placement})):t,Npe(typeof t!="number"?t:Ape(t,cT))};function OYe(t){var e,i=t.state,r=t.name,n=t.options,a=i.elements.arrow,s=i.modifiersData.popperOffsets,o=tc(i.placement),l=JG(o),u=[zs,yl].indexOf(o)>=0,c=u?"height":"width";if(!(!a||!s)){var d=kYe(n.padding,i),p=XG(a),f=l==="y"?Ws:zs,m=l==="y"?vl:yl,h=i.rects.reference[c]+i.rects.reference[l]-s[l]-i.rects.popper[c],g=s[l]-i.rects.reference[l],I=dT(a),v=I?l==="y"?I.clientHeight||0:I.clientWidth||0:0,w=h/2-g/2,y=d[f],b=v-p[c]-d[m],S=v/2-p[c]/2+w,U=Zy(y,S,b),T=l;i.modifiersData[r]=(e={},e[T]=U,e.centerOffset=U-S,e)}}function xYe(t){var e=t.state,i=t.options,r=i.element,n=r===void 0?"[data-popper-arrow]":r;n!=null&&(typeof n=="string"&&(n=e.elements.popper.querySelector(n),!n)||Cpe(e.elements.popper,n)&&(e.elements.arrow=n))}const FYe={name:"arrow",enabled:!0,phase:"main",fn:OYe,effect:xYe,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function BI(t){return t.split("-")[1]}var LYe={top:"auto",right:"auto",bottom:"auto",left:"auto"};function _Ye(t,e){var i=t.x,r=t.y,n=e.devicePixelRatio||1;return{x:_I(i*n)/n||0,y:_I(r*n)/n||0}}function v3(t){var e,i=t.popper,r=t.popperRect,n=t.placement,a=t.variation,s=t.offsets,o=t.position,l=t.gpuAcceleration,u=t.adaptive,c=t.roundOffsets,d=t.isFixed,p=s.x,f=p===void 0?0:p,m=s.y,h=m===void 0?0:m,g=typeof c=="function"?c({x:f,y:h}):{x:f,y:h};f=g.x,h=g.y;var I=s.hasOwnProperty("x"),v=s.hasOwnProperty("y"),w=zs,y=Ws,b=window;if(u){var S=dT(i),U="clientHeight",T="clientWidth";if(S===Ao(i)&&(S=Rf(i),Nd(S).position!=="static"&&o==="absolute"&&(U="scrollHeight",T="scrollWidth")),S=S,n===Ws||(n===zs||n===yl)&&a===fw){y=vl;var P=d&&S===b&&b.visualViewport?b.visualViewport.height:S[U];h-=P-r.height,h*=l?1:-1}if(n===zs||(n===Ws||n===vl)&&a===fw){w=yl;var D=d&&S===b&&b.visualViewport?b.visualViewport.width:S[T];f-=D-r.width,f*=l?1:-1}}var E=Object.assign({position:o},u&&LYe),R=c===!0?_Ye({x:f,y:h},Ao(i)):{x:f,y:h};if(f=R.x,h=R.y,l){var C;return Object.assign({},E,(C={},C[y]=v?"0":"",C[w]=I?"0":"",C.transform=(b.devicePixelRatio||1)<=1?"translate("+f+"px, "+h+"px)":"translate3d("+f+"px, "+h+"px, 0)",C))}return Object.assign({},E,(e={},e[y]=v?h+"px":"",e[w]=I?f+"px":"",e.transform="",e))}function $Ye(t){var e=t.state,i=t.options,r=i.gpuAcceleration,n=r===void 0?!0:r,a=i.adaptive,s=a===void 0?!0:a,o=i.roundOffsets,l=o===void 0?!0:o,u={placement:tc(e.placement),variation:BI(e.placement),popper:e.elements.popper,popperRect:e.rects.popper,gpuAcceleration:n,isFixed:e.options.strategy==="fixed"};e.modifiersData.popperOffsets!=null&&(e.styles.popper=Object.assign({},e.styles.popper,v3(Object.assign({},u,{offsets:e.modifiersData.popperOffsets,position:e.options.strategy,adaptive:s,roundOffsets:l})))),e.modifiersData.arrow!=null&&(e.styles.arrow=Object.assign({},e.styles.arrow,v3(Object.assign({},u,{offsets:e.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:l})))),e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-placement":e.placement})}const BYe={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:$Ye,data:{}};var kT={passive:!0};function VYe(t){var e=t.state,i=t.instance,r=t.options,n=r.scroll,a=n===void 0?!0:n,s=r.resize,o=s===void 0?!0:s,l=Ao(e.elements.popper),u=[].concat(e.scrollParents.reference,e.scrollParents.popper);return a&&u.forEach(function(c){c.addEventListener("scroll",i.update,kT)}),o&&l.addEventListener("resize",i.update,kT),function(){a&&u.forEach(function(c){c.removeEventListener("scroll",i.update,kT)}),o&&l.removeEventListener("resize",i.update,kT)}}const jYe={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:VYe,data:{}};var GYe={left:"right",right:"left",bottom:"top",top:"bottom"};function SD(t){return t.replace(/left|right|bottom|top/g,function(e){return GYe[e]})}var HYe={start:"end",end:"start"};function y3(t){return t.replace(/start|end/g,function(e){return HYe[e]})}function QG(t){var e=Ao(t),i=e.pageXOffset,r=e.pageYOffset;return{scrollLeft:i,scrollTop:r}}function ZG(t){return $I(Rf(t)).left+QG(t).scrollLeft}function WYe(t,e){var i=Ao(t),r=Rf(t),n=i.visualViewport,a=r.clientWidth,s=r.clientHeight,o=0,l=0;if(n){a=n.width,s=n.height;var u=Rpe();(u||!u&&e==="fixed")&&(o=n.offsetLeft,l=n.offsetTop)}return{width:a,height:s,x:o+ZG(t),y:l}}function zYe(t){var e,i=Rf(t),r=QG(t),n=(e=t.ownerDocument)==null?void 0:e.body,a=wm(i.scrollWidth,i.clientWidth,n?n.scrollWidth:0,n?n.clientWidth:0),s=wm(i.scrollHeight,i.clientHeight,n?n.scrollHeight:0,n?n.clientHeight:0),o=-r.scrollLeft+ZG(t),l=-r.scrollTop;return Nd(n||i).direction==="rtl"&&(o+=wm(i.clientWidth,n?n.clientWidth:0)-a),{width:a,height:s,x:o,y:l}}function eH(t){var e=Nd(t),i=e.overflow,r=e.overflowX,n=e.overflowY;return/auto|scroll|overlay|hidden/.test(i+n+r)}function kpe(t){return["html","body","#document"].indexOf(Cc(t))>=0?t.ownerDocument.body:Zo(t)&&eH(t)?t:kpe(pA(t))}function eb(t,e){var i;e===void 0&&(e=[]);var r=kpe(t),n=r===((i=t.ownerDocument)==null?void 0:i.body),a=Ao(r),s=n?[a].concat(a.visualViewport||[],eH(r)?r:[]):r,o=e.concat(s);return n?o:o.concat(eb(pA(s)))}function i1(t){return Object.assign({},t,{left:t.x,top:t.y,right:t.x+t.width,bottom:t.y+t.height})}function qYe(t,e){var i=$I(t,!1,e==="fixed");return i.top=i.top+t.clientTop,i.left=i.left+t.clientLeft,i.bottom=i.top+t.clientHeight,i.right=i.left+t.clientWidth,i.width=t.clientWidth,i.height=t.clientHeight,i.x=i.left,i.y=i.top,i}function b3(t,e,i){return e===Dpe?i1(WYe(t,i)):Xm(e)?qYe(e,i):i1(zYe(Rf(t)))}function YYe(t){var e=eb(pA(t)),i=["absolute","fixed"].indexOf(Nd(t).position)>=0,r=i&&Zo(t)?dT(t):t;return Xm(r)?e.filter(function(n){return Xm(n)&&Cpe(n,r)&&Cc(n)!=="body"}):[]}function KYe(t,e,i,r){var n=e==="clippingParents"?YYe(t):[].concat(e),a=[].concat(n,[i]),s=a[0],o=a.reduce(function(l,u){var c=b3(t,u,r);return l.top=wm(c.top,l.top),l.right=fE(c.right,l.right),l.bottom=fE(c.bottom,l.bottom),l.left=wm(c.left,l.left),l},b3(t,s,r));return o.width=o.right-o.left,o.height=o.bottom-o.top,o.x=o.left,o.y=o.top,o}function Ope(t){var e=t.reference,i=t.element,r=t.placement,n=r?tc(r):null,a=r?BI(r):null,s=e.x+e.width/2-i.width/2,o=e.y+e.height/2-i.height/2,l;switch(n){case Ws:l={x:s,y:e.y-i.height};break;case vl:l={x:s,y:e.y+e.height};break;case yl:l={x:e.x+e.width,y:o};break;case zs:l={x:e.x-i.width,y:o};break;default:l={x:e.x,y:e.y}}var u=n?JG(n):null;if(u!=null){var c=u==="y"?"height":"width";switch(a){case LI:l[u]=l[u]-(e[c]/2-i[c]/2);break;case fw:l[u]=l[u]+(e[c]/2-i[c]/2);break}}return l}function mw(t,e){e===void 0&&(e={});var i=e,r=i.placement,n=r===void 0?t.placement:r,a=i.strategy,s=a===void 0?t.strategy:a,o=i.boundary,l=o===void 0?gYe:o,u=i.rootBoundary,c=u===void 0?Dpe:u,d=i.elementContext,p=d===void 0?hy:d,f=i.altBoundary,m=f===void 0?!1:f,h=i.padding,g=h===void 0?0:h,I=Npe(typeof g!="number"?g:Ape(g,cT)),v=p===hy?IYe:hy,w=t.rects.popper,y=t.elements[m?v:p],b=KYe(Xm(y)?y:y.contextElement||Rf(t.elements.popper),l,c,s),S=$I(t.elements.reference),U=Ope({reference:S,element:w,placement:n}),T=i1(Object.assign({},w,U)),P=p===hy?T:S,D={top:b.top-P.top+I.top,bottom:P.bottom-b.bottom+I.bottom,left:b.left-P.left+I.left,right:P.right-b.right+I.right},E=t.modifiersData.offset;if(p===hy&&E){var R=E[n];Object.keys(D).forEach(function(C){var M=[yl,vl].indexOf(C)>=0?1:-1,N=[Ws,vl].indexOf(C)>=0?"y":"x";D[C]+=R[N]*M})}return D}function XYe(t,e){e===void 0&&(e={});var i=e,r=i.placement,n=i.boundary,a=i.rootBoundary,s=i.padding,o=i.flipVariations,l=i.allowedAutoPlacements,u=l===void 0?Ppe:l,c=BI(r),d=c?o?g3:g3.filter(function(m){return BI(m)===c}):cT,p=d.filter(function(m){return u.indexOf(m)>=0});p.length===0&&(p=d);var f=p.reduce(function(m,h){return m[h]=mw(t,{placement:h,boundary:n,rootBoundary:a,padding:s})[tc(h)],m},{});return Object.keys(f).sort(function(m,h){return f[m]-f[h]})}function JYe(t){if(tc(t)===YG)return[];var e=SD(t);return[y3(t),e,y3(e)]}function QYe(t){var e=t.state,i=t.options,r=t.name;if(!e.modifiersData[r]._skip){for(var n=i.mainAxis,a=n===void 0?!0:n,s=i.altAxis,o=s===void 0?!0:s,l=i.fallbackPlacements,u=i.padding,c=i.boundary,d=i.rootBoundary,p=i.altBoundary,f=i.flipVariations,m=f===void 0?!0:f,h=i.allowedAutoPlacements,g=e.options.placement,I=tc(g),v=I===g,w=l||(v||!m?[SD(g)]:JYe(g)),y=[g].concat(w).reduce(function(_,B){return _.concat(tc(B)===YG?XYe(e,{placement:B,boundary:c,rootBoundary:d,padding:u,flipVariations:m,allowedAutoPlacements:h}):B)},[]),b=e.rects.reference,S=e.rects.popper,U=new Map,T=!0,P=y[0],D=0;D<y.length;D++){var E=y[D],R=tc(E),C=BI(E)===LI,M=[Ws,vl].indexOf(R)>=0,N=M?"width":"height",A=mw(e,{placement:E,boundary:c,rootBoundary:d,altBoundary:p,padding:u}),O=M?C?yl:zs:C?vl:Ws;b[N]>S[N]&&(O=SD(O));var k=SD(O),F=[];if(a&&F.push(A[R]<=0),o&&F.push(A[O]<=0,A[k]<=0),F.every(function(_){return _})){P=E,T=!1;break}U.set(E,F)}if(T)for(var x=m?3:1,L=function(_){var B=y.find(function(G){var j=U.get(G);if(j)return j.slice(0,_).every(function(K){return K})});if(B)return P=B,"break"},$=x;$>0;$--){var V=L($);if(V==="break")break}e.placement!==P&&(e.modifiersData[r]._skip=!0,e.placement=P,e.reset=!0)}}const ZYe={name:"flip",enabled:!0,phase:"main",fn:QYe,requiresIfExists:["offset"],data:{_skip:!1}};function w3(t,e,i){return i===void 0&&(i={x:0,y:0}),{top:t.top-e.height-i.y,right:t.right-e.width+i.x,bottom:t.bottom-e.height+i.y,left:t.left-e.width-i.x}}function S3(t){return[Ws,yl,vl,zs].some(function(e){return t[e]>=0})}function e6e(t){var e=t.state,i=t.name,r=e.rects.reference,n=e.rects.popper,a=e.modifiersData.preventOverflow,s=mw(e,{elementContext:"reference"}),o=mw(e,{altBoundary:!0}),l=w3(s,r),u=w3(o,n,a),c=S3(l),d=S3(u);e.modifiersData[i]={referenceClippingOffsets:l,popperEscapeOffsets:u,isReferenceHidden:c,hasPopperEscaped:d},e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-reference-hidden":c,"data-popper-escaped":d})}const t6e={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:e6e};function i6e(t,e,i){var r=tc(t),n=[zs,Ws].indexOf(r)>=0?-1:1,a=typeof i=="function"?i(Object.assign({},e,{placement:t})):i,s=a[0],o=a[1];return s=s||0,o=(o||0)*n,[zs,yl].indexOf(r)>=0?{x:o,y:s}:{x:s,y:o}}function r6e(t){var e=t.state,i=t.options,r=t.name,n=i.offset,a=n===void 0?[0,0]:n,s=Ppe.reduce(function(c,d){return c[d]=i6e(d,e.rects,a),c},{}),o=s[e.placement],l=o.x,u=o.y;e.modifiersData.popperOffsets!=null&&(e.modifiersData.popperOffsets.x+=l,e.modifiersData.popperOffsets.y+=u),e.modifiersData[r]=s}const n6e={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:r6e};function a6e(t){var e=t.state,i=t.name;e.modifiersData[i]=Ope({reference:e.rects.reference,element:e.rects.popper,placement:e.placement})}const s6e={name:"popperOffsets",enabled:!0,phase:"read",fn:a6e,data:{}};function o6e(t){return t==="x"?"y":"x"}function l6e(t){var e=t.state,i=t.options,r=t.name,n=i.mainAxis,a=n===void 0?!0:n,s=i.altAxis,o=s===void 0?!1:s,l=i.boundary,u=i.rootBoundary,c=i.altBoundary,d=i.padding,p=i.tether,f=p===void 0?!0:p,m=i.tetherOffset,h=m===void 0?0:m,g=mw(e,{boundary:l,rootBoundary:u,padding:d,altBoundary:c}),I=tc(e.placement),v=BI(e.placement),w=!v,y=JG(I),b=o6e(y),S=e.modifiersData.popperOffsets,U=e.rects.reference,T=e.rects.popper,P=typeof h=="function"?h(Object.assign({},e.rects,{placement:e.placement})):h,D=typeof P=="number"?{mainAxis:P,altAxis:P}:Object.assign({mainAxis:0,altAxis:0},P),E=e.modifiersData.offset?e.modifiersData.offset[e.placement]:null,R={x:0,y:0};if(S){if(a){var C,M=y==="y"?Ws:zs,N=y==="y"?vl:yl,A=y==="y"?"height":"width",O=S[y],k=O+g[M],F=O-g[N],x=f?-T[A]/2:0,L=v===LI?U[A]:T[A],$=v===LI?-T[A]:-U[A],V=e.elements.arrow,_=f&&V?XG(V):{width:0,height:0},B=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:Mpe(),G=B[M],j=B[N],K=Zy(0,U[A],_[A]),Y=w?U[A]/2-x-K-G-D.mainAxis:L-K-G-D.mainAxis,X=w?-U[A]/2+x+K+j+D.mainAxis:$+K+j+D.mainAxis,Z=e.elements.arrow&&dT(e.elements.arrow),J=Z?y==="y"?Z.clientTop||0:Z.clientLeft||0:0,ae=(C=E?.[y])!=null?C:0,te=O+Y-ae-J,ne=O+X-ae,le=Zy(f?fE(k,te):k,O,f?wm(F,ne):F);S[y]=le,R[y]=le-O}if(o){var de,pe=y==="x"?Ws:zs,ge=y==="x"?vl:yl,Me=S[b],Pe=b==="y"?"height":"width",Be=Me+g[pe],fe=Me-g[ge],Te=[Ws,zs].indexOf(I)!==-1,ce=(de=E?.[b])!=null?de:0,ye=Te?Be:Me-U[Pe]-T[Pe]-ce+D.altAxis,be=Te?Me+U[Pe]+T[Pe]-ce-D.altAxis:fe,Fe=f&&Te?AYe(ye,Me,be):Zy(f?ye:Be,Me,f?be:fe);S[b]=Fe,R[b]=Fe-Me}e.modifiersData[r]=R}}const u6e={name:"preventOverflow",enabled:!0,phase:"main",fn:l6e,requiresIfExists:["offset"]};function c6e(t){return{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}}function d6e(t){return t===Ao(t)||!Zo(t)?QG(t):c6e(t)}function p6e(t){var e=t.getBoundingClientRect(),i=_I(e.width)/t.offsetWidth||1,r=_I(e.height)/t.offsetHeight||1;return i!==1||r!==1}function f6e(t,e,i){i===void 0&&(i=!1);var r=Zo(e),n=Zo(e)&&p6e(e),a=Rf(e),s=$I(t,n,i),o={scrollLeft:0,scrollTop:0},l={x:0,y:0};return(r||!r&&!i)&&((Cc(e)!=="body"||eH(a))&&(o=d6e(e)),Zo(e)?(l=$I(e,!0),l.x+=e.clientLeft,l.y+=e.clientTop):a&&(l.x=ZG(a))),{x:s.left+o.scrollLeft-l.x,y:s.top+o.scrollTop-l.y,width:s.width,height:s.height}}function m6e(t){var e=new Map,i=new Set,r=[];t.forEach(function(a){e.set(a.name,a)});function n(a){i.add(a.name);var s=[].concat(a.requires||[],a.requiresIfExists||[]);s.forEach(function(o){if(!i.has(o)){var l=e.get(o);l&&n(l)}}),r.push(a)}return t.forEach(function(a){i.has(a.name)||n(a)}),r}function h6e(t){var e=m6e(t);return EYe.reduce(function(i,r){return i.concat(e.filter(function(n){return n.phase===r}))},[])}function g6e(t){var e;return function(){return e||(e=new Promise(function(i){Promise.resolve().then(function(){e=void 0,i(t())})})),e}}function I6e(t){var e=t.reduce(function(i,r){var n=i[r.name];return i[r.name]=n?Object.assign({},n,r,{options:Object.assign({},n.options,r.options),data:Object.assign({},n.data,r.data)}):r,i},{});return Object.keys(e).map(function(i){return e[i]})}var U3={placement:"bottom",modifiers:[],strategy:"absolute"};function T3(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return!e.some(function(r){return!(r&&typeof r.getBoundingClientRect=="function")})}function v6e(t){t===void 0&&(t={});var e=t,i=e.defaultModifiers,r=i===void 0?[]:i,n=e.defaultOptions,a=n===void 0?U3:n;return function(s,o,l){l===void 0&&(l=a);var u={placement:"bottom",orderedModifiers:[],options:Object.assign({},U3,a),modifiersData:{},elements:{reference:s,popper:o},attributes:{},styles:{}},c=[],d=!1,p={state:u,setOptions:function(h){var g=typeof h=="function"?h(u.options):h;m(),u.options=Object.assign({},a,u.options,g),u.scrollParents={reference:Xm(s)?eb(s):s.contextElement?eb(s.contextElement):[],popper:eb(o)};var I=h6e(I6e([].concat(r,u.options.modifiers)));return u.orderedModifiers=I.filter(function(v){return v.enabled}),f(),p.update()},forceUpdate:function(){if(!d){var h=u.elements,g=h.reference,I=h.popper;if(T3(g,I)){u.rects={reference:f6e(g,dT(I),u.options.strategy==="fixed"),popper:XG(I)},u.reset=!1,u.placement=u.options.placement,u.orderedModifiers.forEach(function(T){return u.modifiersData[T.name]=Object.assign({},T.data)});for(var v=0;v<u.orderedModifiers.length;v++){if(u.reset===!0){u.reset=!1,v=-1;continue}var w=u.orderedModifiers[v],y=w.fn,b=w.options,S=b===void 0?{}:b,U=w.name;typeof y=="function"&&(u=y({state:u,options:S,name:U,instance:p})||u)}}}},update:g6e(function(){return new Promise(function(h){p.forceUpdate(),h(u)})}),destroy:function(){m(),d=!0}};if(!T3(s,o))return p;p.setOptions(l).then(function(h){!d&&l.onFirstUpdate&&l.onFirstUpdate(h)});function f(){u.orderedModifiers.forEach(function(h){var g=h.name,I=h.options,v=I===void 0?{}:I,w=h.effect;if(typeof w=="function"){var y=w({state:u,name:g,instance:p,options:v}),b=function(){};c.push(y||b)}})}function m(){c.forEach(function(h){return h()}),c=[]}return p}}var y6e=[jYe,s6e,BYe,Epe,n6e,ZYe,u6e,FYe,t6e],b6e=v6e({defaultModifiers:y6e}),w6e="tippy-box",xpe="tippy-content",S6e="tippy-backdrop",Fpe="tippy-arrow",Lpe="tippy-svg-arrow",Bf={passive:!0,capture:!0},_pe=function(){return document.body};function wk(t,e,i){if(Array.isArray(t)){var r=t[e];return r??(Array.isArray(i)?i[e]:i)}return t}function tH(t,e){var i={}.toString.call(t);return i.indexOf("[object")===0&&i.indexOf(e+"]")>-1}function $pe(t,e){return typeof t=="function"?t.apply(void 0,e):t}function D3(t,e){if(e===0)return t;var i;return function(r){clearTimeout(i),i=setTimeout(function(){t(r)},e)}}function U6e(t){return t.split(/\s+/).filter(Boolean)}function bg(t){return[].concat(t)}function P3(t,e){t.indexOf(e)===-1&&t.push(e)}function T6e(t){return t.filter(function(e,i){return t.indexOf(e)===i})}function D6e(t){return t.split("-")[0]}function mE(t){return[].slice.call(t)}function E3(t){return Object.keys(t).reduce(function(e,i){return t[i]!==void 0&&(e[i]=t[i]),e},{})}function tb(){return document.createElement("div")}function fA(t){return["Element","Fragment"].some(function(e){return tH(t,e)})}function P6e(t){return tH(t,"NodeList")}function E6e(t){return tH(t,"MouseEvent")}function R6e(t){return!!(t&&t._tippy&&t._tippy.reference===t)}function C6e(t){return fA(t)?[t]:P6e(t)?mE(t):Array.isArray(t)?t:mE(document.querySelectorAll(t))}function Sk(t,e){t.forEach(function(i){i&&(i.style.transitionDuration=e+"ms")})}function R3(t,e){t.forEach(function(i){i&&i.setAttribute("data-state",e)})}function M6e(t){var e,i=bg(t),r=i[0];return r!=null&&(e=r.ownerDocument)!=null&&e.body?r.ownerDocument:document}function N6e(t,e){var i=e.clientX,r=e.clientY;return t.every(function(n){var a=n.popperRect,s=n.popperState,o=n.props,l=o.interactiveBorder,u=D6e(s.placement),c=s.modifiersData.offset;if(!c)return!0;var d=u==="bottom"?c.top.y:0,p=u==="top"?c.bottom.y:0,f=u==="right"?c.left.x:0,m=u==="left"?c.right.x:0,h=a.top-r+d>l,g=r-a.bottom-p>l,I=a.left-i+f>l,v=i-a.right-m>l;return h||g||I||v})}function Uk(t,e,i){var r=e+"EventListener";["transitionend","webkitTransitionEnd"].forEach(function(n){t[r](n,i)})}function C3(t,e){for(var i=e;i;){var r;if(t.contains(i))return!0;i=i.getRootNode==null||(r=i.getRootNode())==null?void 0:r.host}return!1}var $u={isTouch:!1},M3=0;function A6e(){$u.isTouch||($u.isTouch=!0,window.performance&&document.addEventListener("mousemove",Bpe))}function Bpe(){var t=performance.now();t-M3<20&&($u.isTouch=!1,document.removeEventListener("mousemove",Bpe)),M3=t}function k6e(){var t=document.activeElement;if(R6e(t)){var e=t._tippy;t.blur&&!e.state.isVisible&&t.blur()}}function O6e(){document.addEventListener("touchstart",A6e,Bf),window.addEventListener("blur",k6e)}var x6e=typeof window<"u"&&typeof document<"u",F6e=x6e?!!window.msCrypto:!1,L6e={animateFill:!1,followCursor:!1,inlinePositioning:!1,sticky:!1},_6e={allowHTML:!1,animation:"fade",arrow:!0,content:"",inertia:!1,maxWidth:350,role:"tooltip",theme:"",zIndex:9999},$l=Object.assign({appendTo:_pe,aria:{content:"auto",expanded:"auto"},delay:0,duration:[300,250],getReferenceClientRect:null,hideOnClick:!0,ignoreAttributes:!1,interactive:!1,interactiveBorder:2,interactiveDebounce:0,moveTransition:"",offset:[0,10],onAfterUpdate:function(){},onBeforeUpdate:function(){},onCreate:function(){},onDestroy:function(){},onHidden:function(){},onHide:function(){},onMount:function(){},onShow:function(){},onShown:function(){},onTrigger:function(){},onUntrigger:function(){},onClickOutside:function(){},placement:"top",plugins:[],popperOptions:{},render:null,showOnCreate:!1,touch:!0,trigger:"mouseenter focus",triggerTarget:null},L6e,_6e),$6e=Object.keys($l),B6e=function(t){var e=Object.keys(t);e.forEach(function(i){$l[i]=t[i]})};function Vpe(t){var e=t.plugins||[],i=e.reduce(function(r,n){var a=n.name,s=n.defaultValue;if(a){var o;r[a]=t[a]!==void 0?t[a]:(o=$l[a])!=null?o:s}return r},{});return Object.assign({},t,i)}function V6e(t,e){var i=e?Object.keys(Vpe(Object.assign({},$l,{plugins:e}))):$6e,r=i.reduce(function(n,a){var s=(t.getAttribute("data-tippy-"+a)||"").trim();if(!s)return n;if(a==="content")n[a]=s;else try{n[a]=JSON.parse(s)}catch{n[a]=s}return n},{});return r}function N3(t,e){var i=Object.assign({},e,{content:$pe(e.content,[t])},e.ignoreAttributes?{}:V6e(t,e.plugins));return i.aria=Object.assign({},$l.aria,i.aria),i.aria={expanded:i.aria.expanded==="auto"?e.interactive:i.aria.expanded,content:i.aria.content==="auto"?e.interactive?null:"describedby":i.aria.content},i}var j6e=function(){return"innerHTML"};function r1(t,e){t[j6e()]=e}function A3(t){var e=tb();return t===!0?e.className=Fpe:(e.className=Lpe,fA(t)?e.appendChild(t):r1(e,t)),e}function k3(t,e){fA(e.content)?(r1(t,""),t.appendChild(e.content)):typeof e.content!="function"&&(e.allowHTML?r1(t,e.content):t.textContent=e.content)}function n1(t){var e=t.firstElementChild,i=mE(e.children);return{box:e,content:i.find(function(r){return r.classList.contains(xpe)}),arrow:i.find(function(r){return r.classList.contains(Fpe)||r.classList.contains(Lpe)}),backdrop:i.find(function(r){return r.classList.contains(S6e)})}}function jpe(t){var e=tb(),i=tb();i.className=w6e,i.setAttribute("data-state","hidden"),i.setAttribute("tabindex","-1");var r=tb();r.className=xpe,r.setAttribute("data-state","hidden"),k3(r,t.props),e.appendChild(i),i.appendChild(r),n(t.props,t.props);function n(a,s){var o=n1(e),l=o.box,u=o.content,c=o.arrow;s.theme?l.setAttribute("data-theme",s.theme):l.removeAttribute("data-theme"),typeof s.animation=="string"?l.setAttribute("data-animation",s.animation):l.removeAttribute("data-animation"),s.inertia?l.setAttribute("data-inertia",""):l.removeAttribute("data-inertia"),l.style.maxWidth=typeof s.maxWidth=="number"?s.maxWidth+"px":s.maxWidth,s.role?l.setAttribute("role",s.role):l.removeAttribute("role"),(a.content!==s.content||a.allowHTML!==s.allowHTML)&&k3(u,t.props),s.arrow?c?a.arrow!==s.arrow&&(l.removeChild(c),l.appendChild(A3(s.arrow))):l.appendChild(A3(s.arrow)):c&&l.removeChild(c)}return{popper:e,onUpdate:n}}jpe.$$tippy=!0;var G6e=1,OT=[],Tk=[];function H6e(t,e){var i=N3(t,Object.assign({},$l,Vpe(E3(e)))),r,n,a,s=!1,o=!1,l=!1,u=!1,c,d,p,f=[],m=D3(te,i.interactiveDebounce),h,g=G6e++,I=null,v=T6e(i.plugins),w={isEnabled:!0,isVisible:!1,isDestroyed:!1,isMounted:!1,isShown:!1},y={id:g,reference:t,popper:tb(),popperInstance:I,props:i,state:w,plugins:v,clearDelayTimeouts:ye,setProps:be,setContent:Fe,show:we,hide:Ne,hideWithInteractivity:me,enable:Te,disable:ce,unmount:Ee,destroy:Le};if(!i.render)return y;var b=i.render(y),S=b.popper,U=b.onUpdate;S.setAttribute("data-tippy-root",""),S.id="tippy-"+y.id,y.popper=S,t._tippy=y,S._tippy=y;var T=v.map(function(Q){return Q.fn(y)}),P=t.hasAttribute("aria-expanded");return Z(),x(),O(),k("onCreate",[y]),i.showOnCreate&&Be(),S.addEventListener("mouseenter",function(){y.props.interactive&&y.state.isVisible&&y.clearDelayTimeouts()}),S.addEventListener("mouseleave",function(){y.props.interactive&&y.props.trigger.indexOf("mouseenter")>=0&&M().addEventListener("mousemove",m)}),y;function D(){var Q=y.props.touch;return Array.isArray(Q)?Q:[Q,0]}function E(){return D()[0]==="hold"}function R(){var Q;return!!((Q=y.props.render)!=null&&Q.$$tippy)}function C(){return h||t}function M(){var Q=C().parentNode;return Q?M6e(Q):document}function N(){return n1(S)}function A(Q){return y.state.isMounted&&!y.state.isVisible||$u.isTouch||c&&c.type==="focus"?0:wk(y.props.delay,Q?0:1,$l.delay)}function O(Q){Q===void 0&&(Q=!1),S.style.pointerEvents=y.props.interactive&&!Q?"":"none",S.style.zIndex=""+y.props.zIndex}function k(Q,se,oe){if(oe===void 0&&(oe=!0),T.forEach(function(ee){ee[Q]&&ee[Q].apply(ee,se)}),oe){var ue;(ue=y.props)[Q].apply(ue,se)}}function F(){var Q=y.props.aria;if(Q.content){var se="aria-"+Q.content,oe=S.id,ue=bg(y.props.triggerTarget||t);ue.forEach(function(ee){var Se=ee.getAttribute(se);if(y.state.isVisible)ee.setAttribute(se,Se?Se+" "+oe:oe);else{var De=Se&&Se.replace(oe,"").trim();De?ee.setAttribute(se,De):ee.removeAttribute(se)}})}}function x(){if(!(P||!y.props.aria.expanded)){var Q=bg(y.props.triggerTarget||t);Q.forEach(function(se){y.props.interactive?se.setAttribute("aria-expanded",y.state.isVisible&&se===C()?"true":"false"):se.removeAttribute("aria-expanded")})}}function L(){M().removeEventListener("mousemove",m),OT=OT.filter(function(Q){return Q!==m})}function $(Q){if(!($u.isTouch&&(l||Q.type==="mousedown"))){var se=Q.composedPath&&Q.composedPath()[0]||Q.target;if(!(y.props.interactive&&C3(S,se))){if(bg(y.props.triggerTarget||t).some(function(oe){return C3(oe,se)})){if($u.isTouch||y.state.isVisible&&y.props.trigger.indexOf("click")>=0)return}else k("onClickOutside",[y,Q]);y.props.hideOnClick===!0&&(y.clearDelayTimeouts(),y.hide(),o=!0,setTimeout(function(){o=!1}),y.state.isMounted||G())}}}function V(){l=!0}function _(){l=!1}function B(){var Q=M();Q.addEventListener("mousedown",$,!0),Q.addEventListener("touchend",$,Bf),Q.addEventListener("touchstart",_,Bf),Q.addEventListener("touchmove",V,Bf)}function G(){var Q=M();Q.removeEventListener("mousedown",$,!0),Q.removeEventListener("touchend",$,Bf),Q.removeEventListener("touchstart",_,Bf),Q.removeEventListener("touchmove",V,Bf)}function j(Q,se){Y(Q,function(){!y.state.isVisible&&S.parentNode&&S.parentNode.contains(S)&&se()})}function K(Q,se){Y(Q,se)}function Y(Q,se){var oe=N().box;function ue(ee){ee.target===oe&&(Uk(oe,"remove",ue),se())}if(Q===0)return se();Uk(oe,"remove",d),Uk(oe,"add",ue),d=ue}function X(Q,se,oe){oe===void 0&&(oe=!1);var ue=bg(y.props.triggerTarget||t);ue.forEach(function(ee){ee.addEventListener(Q,se,oe),f.push({node:ee,eventType:Q,handler:se,options:oe})})}function Z(){E()&&(X("touchstart",ae,{passive:!0}),X("touchend",ne,{passive:!0})),U6e(y.props.trigger).forEach(function(Q){if(Q!=="manual")switch(X(Q,ae),Q){case"mouseenter":X("mouseleave",ne);break;case"focus":X(F6e?"focusout":"blur",le);break;case"focusin":X("focusout",le);break}})}function J(){f.forEach(function(Q){var se=Q.node,oe=Q.eventType,ue=Q.handler,ee=Q.options;se.removeEventListener(oe,ue,ee)}),f=[]}function ae(Q){var se,oe=!1;if(!(!y.state.isEnabled||de(Q)||o)){var ue=((se=c)==null?void 0:se.type)==="focus";c=Q,h=Q.currentTarget,x(),!y.state.isVisible&&E6e(Q)&&OT.forEach(function(ee){return ee(Q)}),Q.type==="click"&&(y.props.trigger.indexOf("mouseenter")<0||s)&&y.props.hideOnClick!==!1&&y.state.isVisible?oe=!0:Be(Q),Q.type==="click"&&(s=!oe),oe&&!ue&&fe(Q)}}function te(Q){var se=Q.target,oe=C().contains(se)||S.contains(se);if(!(Q.type==="mousemove"&&oe)){var ue=Pe().concat(S).map(function(ee){var Se,De=ee._tippy,it=(Se=De.popperInstance)==null?void 0:Se.state;return it?{popperRect:ee.getBoundingClientRect(),popperState:it,props:i}:null}).filter(Boolean);N6e(ue,Q)&&(L(),fe(Q))}}function ne(Q){var se=de(Q)||y.props.trigger.indexOf("click")>=0&&s;if(!se){if(y.props.interactive){y.hideWithInteractivity(Q);return}fe(Q)}}function le(Q){y.props.trigger.indexOf("focusin")<0&&Q.target!==C()||y.props.interactive&&Q.relatedTarget&&S.contains(Q.relatedTarget)||fe(Q)}function de(Q){return $u.isTouch?E()!==Q.type.indexOf("touch")>=0:!1}function pe(){ge();var Q=y.props,se=Q.popperOptions,oe=Q.placement,ue=Q.offset,ee=Q.getReferenceClientRect,Se=Q.moveTransition,De=R()?n1(S).arrow:null,it=ee?{getBoundingClientRect:ee,contextElement:ee.contextElement||C()}:t,Ue={name:"$$tippy",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:function(yi){var qe=yi.state;if(R()){var bi=N(),oi=bi.box;["placement","reference-hidden","escaped"].forEach(function(nn){nn==="placement"?oi.setAttribute("data-placement",qe.placement):qe.attributes.popper["data-popper-"+nn]?oi.setAttribute("data-"+nn,""):oi.removeAttribute("data-"+nn)}),qe.attributes.popper={}}}},ut=[{name:"offset",options:{offset:ue}},{name:"preventOverflow",options:{padding:{top:2,bottom:2,left:5,right:5}}},{name:"flip",options:{padding:5}},{name:"computeStyles",options:{adaptive:!Se}},Ue];R()&&De&&ut.push({name:"arrow",options:{element:De,padding:3}}),ut.push.apply(ut,se?.modifiers||[]),y.popperInstance=b6e(it,S,Object.assign({},se,{placement:oe,onFirstUpdate:p,modifiers:ut}))}function ge(){y.popperInstance&&(y.popperInstance.destroy(),y.popperInstance=null)}function Me(){var Q=y.props.appendTo,se,oe=C();y.props.interactive&&Q===_pe||Q==="parent"?se=oe.parentNode:se=$pe(Q,[oe]),se.contains(S)||se.appendChild(S),y.state.isMounted=!0,pe()}function Pe(){return mE(S.querySelectorAll("[data-tippy-root]"))}function Be(Q){y.clearDelayTimeouts(),Q&&k("onTrigger",[y,Q]),B();var se=A(!0),oe=D(),ue=oe[0],ee=oe[1];$u.isTouch&&ue==="hold"&&ee&&(se=ee),se?r=setTimeout(function(){y.show()},se):y.show()}function fe(Q){if(y.clearDelayTimeouts(),k("onUntrigger",[y,Q]),!y.state.isVisible){G();return}if(!(y.props.trigger.indexOf("mouseenter")>=0&&y.props.trigger.indexOf("click")>=0&&["mouseleave","mousemove"].indexOf(Q.type)>=0&&s)){var se=A(!1);se?n=setTimeout(function(){y.state.isVisible&&y.hide()},se):a=requestAnimationFrame(function(){y.hide()})}}function Te(){y.state.isEnabled=!0}function ce(){y.hide(),y.state.isEnabled=!1}function ye(){clearTimeout(r),clearTimeout(n),cancelAnimationFrame(a)}function be(Q){if(!y.state.isDestroyed){k("onBeforeUpdate",[y,Q]),J();var se=y.props,oe=N3(t,Object.assign({},se,E3(Q),{ignoreAttributes:!0}));y.props=oe,Z(),se.interactiveDebounce!==oe.interactiveDebounce&&(L(),m=D3(te,oe.interactiveDebounce)),se.triggerTarget&&!oe.triggerTarget?bg(se.triggerTarget).forEach(function(ue){ue.removeAttribute("aria-expanded")}):oe.triggerTarget&&t.removeAttribute("aria-expanded"),x(),O(),U&&U(se,oe),y.popperInstance&&(pe(),Pe().forEach(function(ue){requestAnimationFrame(ue._tippy.popperInstance.forceUpdate)})),k("onAfterUpdate",[y,Q])}}function Fe(Q){y.setProps({content:Q})}function we(){var Q=y.state.isVisible,se=y.state.isDestroyed,oe=!y.state.isEnabled,ue=$u.isTouch&&!y.props.touch,ee=wk(y.props.duration,0,$l.duration);if(!(Q||se||oe||ue)&&!C().hasAttribute("disabled")&&(k("onShow",[y],!1),y.props.onShow(y)!==!1)){if(y.state.isVisible=!0,R()&&(S.style.visibility="visible"),O(),B(),y.state.isMounted||(S.style.transition="none"),R()){var Se=N(),De=Se.box,it=Se.content;Sk([De,it],0)}p=function(){var Ue;if(!(!y.state.isVisible||u)){if(u=!0,S.offsetHeight,S.style.transition=y.props.moveTransition,R()&&y.props.animation){var ut=N(),yi=ut.box,qe=ut.content;Sk([yi,qe],ee),R3([yi,qe],"visible")}F(),x(),P3(Tk,y),(Ue=y.popperInstance)==null||Ue.forceUpdate(),k("onMount",[y]),y.props.animation&&R()&&K(ee,function(){y.state.isShown=!0,k("onShown",[y])})}},Me()}}function Ne(){var Q=!y.state.isVisible,se=y.state.isDestroyed,oe=!y.state.isEnabled,ue=wk(y.props.duration,1,$l.duration);if(!(Q||se||oe)&&(k("onHide",[y],!1),y.props.onHide(y)!==!1)){if(y.state.isVisible=!1,y.state.isShown=!1,u=!1,s=!1,R()&&(S.style.visibility="hidden"),L(),G(),O(!0),R()){var ee=N(),Se=ee.box,De=ee.content;y.props.animation&&(Sk([Se,De],ue),R3([Se,De],"hidden"))}F(),x(),y.props.animation?R()&&j(ue,y.unmount):y.unmount()}}function me(Q){M().addEventListener("mousemove",m),P3(OT,m),m(Q)}function Ee(){y.state.isVisible&&y.hide(),y.state.isMounted&&(ge(),Pe().forEach(function(Q){Q._tippy.unmount()}),S.parentNode&&S.parentNode.removeChild(S),Tk=Tk.filter(function(Q){return Q!==y}),y.state.isMounted=!1,k("onHidden",[y]))}function Le(){!y.state.isDestroyed&&(y.clearDelayTimeouts(),y.unmount(),J(),delete t._tippy,y.state.isDestroyed=!0,k("onDestroy",[y]))}}function mA(t,e){e===void 0&&(e={});var i=$l.plugins.concat(e.plugins||[]);O6e();var r=Object.assign({},e,{plugins:i}),n=C6e(t),a=n.reduce(function(s,o){var l=o&&H6e(o,r);return l&&s.push(l),s},[]);return fA(t)?a[0]:a}mA.defaultProps=$l;mA.setDefaultProps=B6e;mA.currentInput=$u;Object.assign({},Epe,{effect:function(t){var e=t.state,i={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};Object.assign(e.elements.popper.style,i.popper),e.styles=i,e.elements.arrow&&Object.assign(e.elements.arrow.style,i.arrow)}});mA.setDefaultProps({render:jpe});function UD(t,e){return t==null||e==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function W6e(t,e){return t==null||e==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function Gpe(t){let e,i,r;t.length!==2?(e=UD,i=(o,l)=>UD(t(o),l),r=(o,l)=>t(o)-l):(e=t===UD||t===W6e?t:z6e,i=t,r=t);function n(o,l,u=0,c=o.length){if(u<c){if(e(l,l)!==0)return c;do{const d=u+c>>>1;i(o[d],l)<0?u=d+1:c=d}while(u<c)}return u}function a(o,l,u=0,c=o.length){if(u<c){if(e(l,l)!==0)return c;do{const d=u+c>>>1;i(o[d],l)<=0?u=d+1:c=d}while(u<c)}return u}function s(o,l,u=0,c=o.length){const d=n(o,l,u,c-1);return d>u&&r(o[d-1],l)>-r(o[d],l)?d-1:d}return{left:n,center:s,right:a}}function z6e(){return 0}function q6e(t){return t===null?NaN:+t}Gpe(UD);Gpe(q6e).center;var Y6e={value:()=>{}};function Hpe(){for(var t=0,e=arguments.length,i={},r;t<e;++t){if(!(r=arguments[t]+"")||r in i||/[\s.]/.test(r))throw new Error("illegal type: "+r);i[r]=[]}return new TD(i)}function TD(t){this._=t}function K6e(t,e){return t.trim().split(/^|\s+/).map(function(i){var r="",n=i.indexOf(".");if(n>=0&&(r=i.slice(n+1),i=i.slice(0,n)),i&&!e.hasOwnProperty(i))throw new Error("unknown type: "+i);return{type:i,name:r}})}TD.prototype=Hpe.prototype={constructor:TD,on:function(t,e){var i=this._,r=K6e(t+"",i),n,a=-1,s=r.length;if(arguments.length<2){for(;++a<s;)if((n=(t=r[a]).type)&&(n=X6e(i[n],t.name)))return n;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++a<s;)if(n=(t=r[a]).type)i[n]=O3(i[n],t.name,e);else if(e==null)for(n in i)i[n]=O3(i[n],t.name,null);return this},copy:function(){var t={},e=this._;for(var i in e)t[i]=e[i].slice();return new TD(t)},call:function(t,e){if((n=arguments.length-2)>0)for(var i=new Array(n),r=0,n,a;r<n;++r)i[r]=arguments[r+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(a=this._[t],r=0,n=a.length;r<n;++r)a[r].value.apply(e,i)},apply:function(t,e,i){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var r=this._[t],n=0,a=r.length;n<a;++n)r[n].value.apply(e,i)}};function X6e(t,e){for(var i=0,r=t.length,n;i<r;++i)if((n=t[i]).name===e)return n.value}function O3(t,e,i){for(var r=0,n=t.length;r<n;++r)if(t[r].name===e){t[r]=Y6e,t=t.slice(0,r).concat(t.slice(r+1));break}return i!=null&&t.push({name:e,value:i}),t}var a1="http://www.w3.org/1999/xhtml";const x3={svg:"http://www.w3.org/2000/svg",xhtml:a1,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function hA(t){var e=t+="",i=e.indexOf(":");return i>=0&&(e=t.slice(0,i))!=="xmlns"&&(t=t.slice(i+1)),x3.hasOwnProperty(e)?{space:x3[e],local:t}:t}function J6e(t){return function(){var e=this.ownerDocument,i=this.namespaceURI;return i===a1&&e.documentElement.namespaceURI===a1?e.createElement(t):e.createElementNS(i,t)}}function Q6e(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function Wpe(t){var e=hA(t);return(e.local?Q6e:J6e)(e)}function Z6e(){}function iH(t){return t==null?Z6e:function(){return this.querySelector(t)}}function e4e(t){typeof t!="function"&&(t=iH(t));for(var e=this._groups,i=e.length,r=new Array(i),n=0;n<i;++n)for(var a=e[n],s=a.length,o=r[n]=new Array(s),l,u,c=0;c<s;++c)(l=a[c])&&(u=t.call(l,l.__data__,c,a))&&("__data__"in l&&(u.__data__=l.__data__),o[c]=u);return new Uu(r,this._parents)}function t4e(t){return t==null?[]:Array.isArray(t)?t:Array.from(t)}function i4e(){return[]}function zpe(t){return t==null?i4e:function(){return this.querySelectorAll(t)}}function r4e(t){return function(){return t4e(t.apply(this,arguments))}}function n4e(t){typeof t=="function"?t=r4e(t):t=zpe(t);for(var e=this._groups,i=e.length,r=[],n=[],a=0;a<i;++a)for(var s=e[a],o=s.length,l,u=0;u<o;++u)(l=s[u])&&(r.push(t.call(l,l.__data__,u,s)),n.push(l));return new Uu(r,n)}function qpe(t){return function(){return this.matches(t)}}function Ype(t){return function(e){return e.matches(t)}}var a4e=Array.prototype.find;function s4e(t){return function(){return a4e.call(this.children,t)}}function o4e(){return this.firstElementChild}function l4e(t){return this.select(t==null?o4e:s4e(typeof t=="function"?t:Ype(t)))}var u4e=Array.prototype.filter;function c4e(){return Array.from(this.children)}function d4e(t){return function(){return u4e.call(this.children,t)}}function p4e(t){return this.selectAll(t==null?c4e:d4e(typeof t=="function"?t:Ype(t)))}function f4e(t){typeof t!="function"&&(t=qpe(t));for(var e=this._groups,i=e.length,r=new Array(i),n=0;n<i;++n)for(var a=e[n],s=a.length,o=r[n]=[],l,u=0;u<s;++u)(l=a[u])&&t.call(l,l.__data__,u,a)&&o.push(l);return new Uu(r,this._parents)}function Kpe(t){return new Array(t.length)}function m4e(){return new Uu(this._enter||this._groups.map(Kpe),this._parents)}function hE(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}hE.prototype={constructor:hE,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};function h4e(t){return function(){return t}}function g4e(t,e,i,r,n,a){for(var s=0,o,l=e.length,u=a.length;s<u;++s)(o=e[s])?(o.__data__=a[s],r[s]=o):i[s]=new hE(t,a[s]);for(;s<l;++s)(o=e[s])&&(n[s]=o)}function I4e(t,e,i,r,n,a,s){var o,l,u=new Map,c=e.length,d=a.length,p=new Array(c),f;for(o=0;o<c;++o)(l=e[o])&&(p[o]=f=s.call(l,l.__data__,o,e)+"",u.has(f)?n[o]=l:u.set(f,l));for(o=0;o<d;++o)f=s.call(t,a[o],o,a)+"",(l=u.get(f))?(r[o]=l,l.__data__=a[o],u.delete(f)):i[o]=new hE(t,a[o]);for(o=0;o<c;++o)(l=e[o])&&u.get(p[o])===l&&(n[o]=l)}function v4e(t){return t.__data__}function y4e(t,e){if(!arguments.length)return Array.from(this,v4e);var i=e?I4e:g4e,r=this._parents,n=this._groups;typeof t!="function"&&(t=h4e(t));for(var a=n.length,s=new Array(a),o=new Array(a),l=new Array(a),u=0;u<a;++u){var c=r[u],d=n[u],p=d.length,f=b4e(t.call(c,c&&c.__data__,u,r)),m=f.length,h=o[u]=new Array(m),g=s[u]=new Array(m),I=l[u]=new Array(p);i(c,d,h,g,I,f,e);for(var v=0,w=0,y,b;v<m;++v)if(y=h[v]){for(v>=w&&(w=v+1);!(b=g[w])&&++w<m;);y._next=b||null}}return s=new Uu(s,r),s._enter=o,s._exit=l,s}function b4e(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function w4e(){return new Uu(this._exit||this._groups.map(Kpe),this._parents)}function S4e(t,e,i){var r=this.enter(),n=this,a=this.exit();return typeof t=="function"?(r=t(r),r&&(r=r.selection())):r=r.append(t+""),e!=null&&(n=e(n),n&&(n=n.selection())),i==null?a.remove():i(a),r&&n?r.merge(n).order():n}function U4e(t){for(var e=t.selection?t.selection():t,i=this._groups,r=e._groups,n=i.length,a=r.length,s=Math.min(n,a),o=new Array(n),l=0;l<s;++l)for(var u=i[l],c=r[l],d=u.length,p=o[l]=new Array(d),f,m=0;m<d;++m)(f=u[m]||c[m])&&(p[m]=f);for(;l<n;++l)o[l]=i[l];return new Uu(o,this._parents)}function T4e(){for(var t=this._groups,e=-1,i=t.length;++e<i;)for(var r=t[e],n=r.length-1,a=r[n],s;--n>=0;)(s=r[n])&&(a&&s.compareDocumentPosition(a)^4&&a.parentNode.insertBefore(s,a),a=s);return this}function D4e(t){t||(t=P4e);function e(d,p){return d&&p?t(d.__data__,p.__data__):!d-!p}for(var i=this._groups,r=i.length,n=new Array(r),a=0;a<r;++a){for(var s=i[a],o=s.length,l=n[a]=new Array(o),u,c=0;c<o;++c)(u=s[c])&&(l[c]=u);l.sort(e)}return new Uu(n,this._parents).order()}function P4e(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function E4e(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this}function R4e(){return Array.from(this)}function C4e(){for(var t=this._groups,e=0,i=t.length;e<i;++e)for(var r=t[e],n=0,a=r.length;n<a;++n){var s=r[n];if(s)return s}return null}function M4e(){let t=0;for(const e of this)++t;return t}function N4e(){return!this.node()}function A4e(t){for(var e=this._groups,i=0,r=e.length;i<r;++i)for(var n=e[i],a=0,s=n.length,o;a<s;++a)(o=n[a])&&t.call(o,o.__data__,a,n);return this}function k4e(t){return function(){this.removeAttribute(t)}}function O4e(t){return function(){this.removeAttributeNS(t.space,t.local)}}function x4e(t,e){return function(){this.setAttribute(t,e)}}function F4e(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function L4e(t,e){return function(){var i=e.apply(this,arguments);i==null?this.removeAttribute(t):this.setAttribute(t,i)}}function _4e(t,e){return function(){var i=e.apply(this,arguments);i==null?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,i)}}function $4e(t,e){var i=hA(t);if(arguments.length<2){var r=this.node();return i.local?r.getAttributeNS(i.space,i.local):r.getAttribute(i)}return this.each((e==null?i.local?O4e:k4e:typeof e=="function"?i.local?_4e:L4e:i.local?F4e:x4e)(i,e))}function Xpe(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function B4e(t){return function(){this.style.removeProperty(t)}}function V4e(t,e,i){return function(){this.style.setProperty(t,e,i)}}function j4e(t,e,i){return function(){var r=e.apply(this,arguments);r==null?this.style.removeProperty(t):this.style.setProperty(t,r,i)}}function G4e(t,e,i){return arguments.length>1?this.each((e==null?B4e:typeof e=="function"?j4e:V4e)(t,e,i??"")):VI(this.node(),t)}function VI(t,e){return t.style.getPropertyValue(e)||Xpe(t).getComputedStyle(t,null).getPropertyValue(e)}function H4e(t){return function(){delete this[t]}}function W4e(t,e){return function(){this[t]=e}}function z4e(t,e){return function(){var i=e.apply(this,arguments);i==null?delete this[t]:this[t]=i}}function q4e(t,e){return arguments.length>1?this.each((e==null?H4e:typeof e=="function"?z4e:W4e)(t,e)):this.node()[t]}function Jpe(t){return t.trim().split(/^|\s+/)}function rH(t){return t.classList||new Qpe(t)}function Qpe(t){this._node=t,this._names=Jpe(t.getAttribute("class")||"")}Qpe.prototype={add:function(t){var e=this._names.indexOf(t);e<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};function Zpe(t,e){for(var i=rH(t),r=-1,n=e.length;++r<n;)i.add(e[r])}function efe(t,e){for(var i=rH(t),r=-1,n=e.length;++r<n;)i.remove(e[r])}function Y4e(t){return function(){Zpe(this,t)}}function K4e(t){return function(){efe(this,t)}}function X4e(t,e){return function(){(e.apply(this,arguments)?Zpe:efe)(this,t)}}function J4e(t,e){var i=Jpe(t+"");if(arguments.length<2){for(var r=rH(this.node()),n=-1,a=i.length;++n<a;)if(!r.contains(i[n]))return!1;return!0}return this.each((typeof e=="function"?X4e:e?Y4e:K4e)(i,e))}function Q4e(){this.textContent=""}function Z4e(t){return function(){this.textContent=t}}function e5e(t){return function(){var e=t.apply(this,arguments);this.textContent=e??""}}function t5e(t){return arguments.length?this.each(t==null?Q4e:(typeof t=="function"?e5e:Z4e)(t)):this.node().textContent}function i5e(){this.innerHTML=""}function r5e(t){return function(){this.innerHTML=t}}function n5e(t){return function(){var e=t.apply(this,arguments);this.innerHTML=e??""}}function a5e(t){return arguments.length?this.each(t==null?i5e:(typeof t=="function"?n5e:r5e)(t)):this.node().innerHTML}function s5e(){this.nextSibling&&this.parentNode.appendChild(this)}function o5e(){return this.each(s5e)}function l5e(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function u5e(){return this.each(l5e)}function c5e(t){var e=typeof t=="function"?t:Wpe(t);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function d5e(){return null}function p5e(t,e){var i=typeof t=="function"?t:Wpe(t),r=e==null?d5e:typeof e=="function"?e:iH(e);return this.select(function(){return this.insertBefore(i.apply(this,arguments),r.apply(this,arguments)||null)})}function f5e(){var t=this.parentNode;t&&t.removeChild(this)}function m5e(){return this.each(f5e)}function h5e(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function g5e(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function I5e(t){return this.select(t?g5e:h5e)}function v5e(t){return arguments.length?this.property("__data__",t):this.node().__data__}function y5e(t){return function(e){t.call(this,e,this.__data__)}}function b5e(t){return t.trim().split(/^|\s+/).map(function(e){var i="",r=e.indexOf(".");return r>=0&&(i=e.slice(r+1),e=e.slice(0,r)),{type:e,name:i}})}function w5e(t){return function(){var e=this.__on;if(e){for(var i=0,r=-1,n=e.length,a;i<n;++i)a=e[i],(!t.type||a.type===t.type)&&a.name===t.name?this.removeEventListener(a.type,a.listener,a.options):e[++r]=a;++r?e.length=r:delete this.__on}}}function S5e(t,e,i){return function(){var r=this.__on,n,a=y5e(e);if(r){for(var s=0,o=r.length;s<o;++s)if((n=r[s]).type===t.type&&n.name===t.name){this.removeEventListener(n.type,n.listener,n.options),this.addEventListener(n.type,n.listener=a,n.options=i),n.value=e;return}}this.addEventListener(t.type,a,i),n={type:t.type,name:t.name,value:e,listener:a,options:i},r?r.push(n):this.__on=[n]}}function U5e(t,e,i){var r=b5e(t+""),n,a=r.length,s;if(arguments.length<2){var o=this.node().__on;if(o){for(var l=0,u=o.length,c;l<u;++l)for(n=0,c=o[l];n<a;++n)if((s=r[n]).type===c.type&&s.name===c.name)return c.value}return}for(o=e?S5e:w5e,n=0;n<a;++n)this.each(o(r[n],e,i));return this}function tfe(t,e,i){var r=Xpe(t),n=r.CustomEvent;typeof n=="function"?n=new n(e,i):(n=r.document.createEvent("Event"),i?(n.initEvent(e,i.bubbles,i.cancelable),n.detail=i.detail):n.initEvent(e,!1,!1)),t.dispatchEvent(n)}function T5e(t,e){return function(){return tfe(this,t,e)}}function D5e(t,e){return function(){return tfe(this,t,e.apply(this,arguments))}}function P5e(t,e){return this.each((typeof e=="function"?D5e:T5e)(t,e))}function*E5e(){for(var t=this._groups,e=0,i=t.length;e<i;++e)for(var r=t[e],n=0,a=r.length,s;n<a;++n)(s=r[n])&&(yield s)}var R5e=[null];function Uu(t,e){this._groups=t,this._parents=e}function pT(){return new Uu([[document.documentElement]],R5e)}function C5e(){return this}Uu.prototype=pT.prototype={constructor:Uu,select:e4e,selectAll:n4e,selectChild:l4e,selectChildren:p4e,filter:f4e,data:y4e,enter:m4e,exit:w4e,join:S4e,merge:U4e,selection:C5e,order:T4e,sort:D4e,call:E4e,nodes:R4e,node:C4e,size:M4e,empty:N4e,each:A4e,attr:$4e,style:G4e,property:q4e,classed:J4e,text:t5e,html:a5e,raise:o5e,lower:u5e,append:c5e,insert:p5e,remove:m5e,clone:I5e,datum:v5e,on:U5e,dispatch:P5e,[Symbol.iterator]:E5e};function nH(t,e,i){t.prototype=e.prototype=i,i.constructor=t}function ife(t,e){var i=Object.create(t.prototype);for(var r in e)i[r]=e[r];return i}function fT(){}var hw=.7,gE=1/hw,Gg="\\s*([+-]?\\d+)\\s*",gw="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",ic="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",M5e=/^#([0-9a-f]{3,8})$/,N5e=new RegExp(`^rgb\\(${Gg},${Gg},${Gg}\\)$`),A5e=new RegExp(`^rgb\\(${ic},${ic},${ic}\\)$`),k5e=new RegExp(`^rgba\\(${Gg},${Gg},${Gg},${gw}\\)$`),O5e=new RegExp(`^rgba\\(${ic},${ic},${ic},${gw}\\)$`),x5e=new RegExp(`^hsl\\(${gw},${ic},${ic}\\)$`),F5e=new RegExp(`^hsla\\(${gw},${ic},${ic},${gw}\\)$`),F3={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};nH(fT,Iw,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:L3,formatHex:L3,formatHex8:L5e,formatHsl:_5e,formatRgb:_3,toString:_3});function L3(){return this.rgb().formatHex()}function L5e(){return this.rgb().formatHex8()}function _5e(){return rfe(this).formatHsl()}function _3(){return this.rgb().formatRgb()}function Iw(t){var e,i;return t=(t+"").trim().toLowerCase(),(e=M5e.exec(t))?(i=e[1].length,e=parseInt(e[1],16),i===6?$3(e):i===3?new ks(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):i===8?xT(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):i===4?xT(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=N5e.exec(t))?new ks(e[1],e[2],e[3],1):(e=A5e.exec(t))?new ks(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=k5e.exec(t))?xT(e[1],e[2],e[3],e[4]):(e=O5e.exec(t))?xT(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=x5e.exec(t))?j3(e[1],e[2]/100,e[3]/100,1):(e=F5e.exec(t))?j3(e[1],e[2]/100,e[3]/100,e[4]):F3.hasOwnProperty(t)?$3(F3[t]):t==="transparent"?new ks(NaN,NaN,NaN,0):null}function $3(t){return new ks(t>>16&255,t>>8&255,t&255,1)}function xT(t,e,i,r){return r<=0&&(t=e=i=NaN),new ks(t,e,i,r)}function $5e(t){return t instanceof fT||(t=Iw(t)),t?(t=t.rgb(),new ks(t.r,t.g,t.b,t.opacity)):new ks}function s1(t,e,i,r){return arguments.length===1?$5e(t):new ks(t,e,i,r??1)}function ks(t,e,i,r){this.r=+t,this.g=+e,this.b=+i,this.opacity=+r}nH(ks,s1,ife(fT,{brighter(t){return t=t==null?gE:Math.pow(gE,t),new ks(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=t==null?hw:Math.pow(hw,t),new ks(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new ks(Sm(this.r),Sm(this.g),Sm(this.b),IE(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:B3,formatHex:B3,formatHex8:B5e,formatRgb:V3,toString:V3}));function B3(){return`#${Xf(this.r)}${Xf(this.g)}${Xf(this.b)}`}function B5e(){return`#${Xf(this.r)}${Xf(this.g)}${Xf(this.b)}${Xf((isNaN(this.opacity)?1:this.opacity)*255)}`}function V3(){const t=IE(this.opacity);return`${t===1?"rgb(":"rgba("}${Sm(this.r)}, ${Sm(this.g)}, ${Sm(this.b)}${t===1?")":`, ${t})`}`}function IE(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function Sm(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function Xf(t){return t=Sm(t),(t<16?"0":"")+t.toString(16)}function j3(t,e,i,r){return r<=0?t=e=i=NaN:i<=0||i>=1?t=e=NaN:e<=0&&(t=NaN),new _l(t,e,i,r)}function rfe(t){if(t instanceof _l)return new _l(t.h,t.s,t.l,t.opacity);if(t instanceof fT||(t=Iw(t)),!t)return new _l;if(t instanceof _l)return t;t=t.rgb();var e=t.r/255,i=t.g/255,r=t.b/255,n=Math.min(e,i,r),a=Math.max(e,i,r),s=NaN,o=a-n,l=(a+n)/2;return o?(e===a?s=(i-r)/o+(i<r)*6:i===a?s=(r-e)/o+2:s=(e-i)/o+4,o/=l<.5?a+n:2-a-n,s*=60):o=l>0&&l<1?0:s,new _l(s,o,l,t.opacity)}function V5e(t,e,i,r){return arguments.length===1?rfe(t):new _l(t,e,i,r??1)}function _l(t,e,i,r){this.h=+t,this.s=+e,this.l=+i,this.opacity=+r}nH(_l,V5e,ife(fT,{brighter(t){return t=t==null?gE:Math.pow(gE,t),new _l(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=t==null?hw:Math.pow(hw,t),new _l(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+(this.h<0)*360,e=isNaN(t)||isNaN(this.s)?0:this.s,i=this.l,r=i+(i<.5?i:1-i)*e,n=2*i-r;return new ks(Dk(t>=240?t-240:t+120,n,r),Dk(t,n,r),Dk(t<120?t+240:t-120,n,r),this.opacity)},clamp(){return new _l(G3(this.h),FT(this.s),FT(this.l),IE(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=IE(this.opacity);return`${t===1?"hsl(":"hsla("}${G3(this.h)}, ${FT(this.s)*100}%, ${FT(this.l)*100}%${t===1?")":`, ${t})`}`}}));function G3(t){return t=(t||0)%360,t<0?t+360:t}function FT(t){return Math.max(0,Math.min(1,t||0))}function Dk(t,e,i){return(t<60?e+(i-e)*t/60:t<180?i:t<240?e+(i-e)*(240-t)/60:e)*255}const nfe=t=>()=>t;function j5e(t,e){return function(i){return t+i*e}}function G5e(t,e,i){return t=Math.pow(t,i),e=Math.pow(e,i)-t,i=1/i,function(r){return Math.pow(t+r*e,i)}}function H5e(t){return(t=+t)==1?afe:function(e,i){return i-e?G5e(e,i,t):nfe(isNaN(e)?i:e)}}function afe(t,e){var i=e-t;return i?j5e(t,i):nfe(isNaN(t)?e:t)}const H3=(function t(e){var i=H5e(e);function r(n,a){var s=i((n=s1(n)).r,(a=s1(a)).r),o=i(n.g,a.g),l=i(n.b,a.b),u=afe(n.opacity,a.opacity);return function(c){return n.r=s(c),n.g=o(c),n.b=l(c),n.opacity=u(c),n+""}}return r.gamma=t,r})(1);function ap(t,e){return t=+t,e=+e,function(i){return t*(1-i)+e*i}}var o1=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Pk=new RegExp(o1.source,"g");function W5e(t){return function(){return t}}function z5e(t){return function(e){return t(e)+""}}function q5e(t,e){var i=o1.lastIndex=Pk.lastIndex=0,r,n,a,s=-1,o=[],l=[];for(t=t+"",e=e+"";(r=o1.exec(t))&&(n=Pk.exec(e));)(a=n.index)>i&&(a=e.slice(i,a),o[s]?o[s]+=a:o[++s]=a),(r=r[0])===(n=n[0])?o[s]?o[s]+=n:o[++s]=n:(o[++s]=null,l.push({i:s,x:ap(r,n)})),i=Pk.lastIndex;return i<e.length&&(a=e.slice(i),o[s]?o[s]+=a:o[++s]=a),o.length<2?l[0]?z5e(l[0].x):W5e(e):(e=l.length,function(u){for(var c=0,d;c<e;++c)o[(d=l[c]).i]=d.x(u);return o.join("")})}var W3=180/Math.PI,sfe={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function ofe(t,e,i,r,n,a){var s,o,l;return(s=Math.sqrt(t*t+e*e))&&(t/=s,e/=s),(l=t*i+e*r)&&(i-=t*l,r-=e*l),(o=Math.sqrt(i*i+r*r))&&(i/=o,r/=o,l/=o),t*r<e*i&&(t=-t,e=-e,l=-l,s=-s),{translateX:n,translateY:a,rotate:Math.atan2(e,t)*W3,skewX:Math.atan(l)*W3,scaleX:s,scaleY:o}}var LT;function Y5e(t){const e=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(t+"");return e.isIdentity?sfe:ofe(e.a,e.b,e.c,e.d,e.e,e.f)}function K5e(t){return t==null||(LT||(LT=document.createElementNS("http://www.w3.org/2000/svg","g")),LT.setAttribute("transform",t),!(t=LT.transform.baseVal.consolidate()))?sfe:(t=t.matrix,ofe(t.a,t.b,t.c,t.d,t.e,t.f))}function lfe(t,e,i,r){function n(u){return u.length?u.pop()+" ":""}function a(u,c,d,p,f,m){if(u!==d||c!==p){var h=f.push("translate(",null,e,null,i);m.push({i:h-4,x:ap(u,d)},{i:h-2,x:ap(c,p)})}else(d||p)&&f.push("translate("+d+e+p+i)}function s(u,c,d,p){u!==c?(u-c>180?c+=360:c-u>180&&(u+=360),p.push({i:d.push(n(d)+"rotate(",null,r)-2,x:ap(u,c)})):c&&d.push(n(d)+"rotate("+c+r)}function o(u,c,d,p){u!==c?p.push({i:d.push(n(d)+"skewX(",null,r)-2,x:ap(u,c)}):c&&d.push(n(d)+"skewX("+c+r)}function l(u,c,d,p,f,m){if(u!==d||c!==p){var h=f.push(n(f)+"scale(",null,",",null,")");m.push({i:h-4,x:ap(u,d)},{i:h-2,x:ap(c,p)})}else(d!==1||p!==1)&&f.push(n(f)+"scale("+d+","+p+")")}return function(u,c){var d=[],p=[];return u=t(u),c=t(c),a(u.translateX,u.translateY,c.translateX,c.translateY,d,p),s(u.rotate,c.rotate,d,p),o(u.skewX,c.skewX,d,p),l(u.scaleX,u.scaleY,c.scaleX,c.scaleY,d,p),u=c=null,function(f){for(var m=-1,h=p.length,g;++m<h;)d[(g=p[m]).i]=g.x(f);return d.join("")}}}var X5e=lfe(Y5e,"px, ","px)","deg)"),J5e=lfe(K5e,", ",")",")"),jI=0,Dy=0,gy=0,ufe=1e3,vE,Py,yE=0,Jm=0,gA=0,vw=typeof performance=="object"&&performance.now?performance:Date,cfe=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function aH(){return Jm||(cfe(Q5e),Jm=vw.now()+gA)}function Q5e(){Jm=0}function bE(){this._call=this._time=this._next=null}bE.prototype=dfe.prototype={constructor:bE,restart:function(t,e,i){if(typeof t!="function")throw new TypeError("callback is not a function");i=(i==null?aH():+i)+(e==null?0:+e),!this._next&&Py!==this&&(Py?Py._next=this:vE=this,Py=this),this._call=t,this._time=i,l1()},stop:function(){this._call&&(this._call=null,this._time=1/0,l1())}};function dfe(t,e,i){var r=new bE;return r.restart(t,e,i),r}function Z5e(){aH(),++jI;for(var t=vE,e;t;)(e=Jm-t._time)>=0&&t._call.call(void 0,e),t=t._next;--jI}function z3(){Jm=(yE=vw.now())+gA,jI=Dy=0;try{Z5e()}finally{jI=0,tKe(),Jm=0}}function eKe(){var t=vw.now(),e=t-yE;e>ufe&&(gA-=e,yE=t)}function tKe(){for(var t,e=vE,i,r=1/0;e;)e._call?(r>e._time&&(r=e._time),t=e,e=e._next):(i=e._next,e._next=null,e=t?t._next=i:vE=i);Py=t,l1(r)}function l1(t){if(!jI){Dy&&(Dy=clearTimeout(Dy));var e=t-Jm;e>24?(t<1/0&&(Dy=setTimeout(z3,t-vw.now()-gA)),gy&&(gy=clearInterval(gy))):(gy||(yE=vw.now(),gy=setInterval(eKe,ufe)),jI=1,cfe(z3))}}function q3(t,e,i){var r=new bE;return e=e==null?0:+e,r.restart(n=>{r.stop(),t(n+e)},e,i),r}var iKe=Hpe("start","end","cancel","interrupt"),rKe=[],pfe=0,Y3=1,u1=2,DD=3,K3=4,c1=5,PD=6;function IA(t,e,i,r,n,a){var s=t.__transition;if(!s)t.__transition={};else if(i in s)return;nKe(t,i,{name:e,index:r,group:n,on:iKe,tween:rKe,time:a.time,delay:a.delay,duration:a.duration,ease:a.ease,timer:null,state:pfe})}function sH(t,e){var i=Lu(t,e);if(i.state>pfe)throw new Error("too late; already scheduled");return i}function zc(t,e){var i=Lu(t,e);if(i.state>DD)throw new Error("too late; already running");return i}function Lu(t,e){var i=t.__transition;if(!i||!(i=i[e]))throw new Error("transition not found");return i}function nKe(t,e,i){var r=t.__transition,n;r[e]=i,i.timer=dfe(a,0,i.time);function a(u){i.state=Y3,i.timer.restart(s,i.delay,i.time),i.delay<=u&&s(u-i.delay)}function s(u){var c,d,p,f;if(i.state!==Y3)return l();for(c in r)if(f=r[c],f.name===i.name){if(f.state===DD)return q3(s);f.state===K3?(f.state=PD,f.timer.stop(),f.on.call("interrupt",t,t.__data__,f.index,f.group),delete r[c]):+c<e&&(f.state=PD,f.timer.stop(),f.on.call("cancel",t,t.__data__,f.index,f.group),delete r[c])}if(q3(function(){i.state===DD&&(i.state=K3,i.timer.restart(o,i.delay,i.time),o(u))}),i.state=u1,i.on.call("start",t,t.__data__,i.index,i.group),i.state===u1){for(i.state=DD,n=new Array(p=i.tween.length),c=0,d=-1;c<p;++c)(f=i.tween[c].value.call(t,t.__data__,i.index,i.group))&&(n[++d]=f);n.length=d+1}}function o(u){for(var c=u<i.duration?i.ease.call(null,u/i.duration):(i.timer.restart(l),i.state=c1,1),d=-1,p=n.length;++d<p;)n[d].call(t,c);i.state===c1&&(i.on.call("end",t,t.__data__,i.index,i.group),l())}function l(){i.state=PD,i.timer.stop(),delete r[e];for(var u in r)return;delete t.__transition}}function aKe(t,e){var i=t.__transition,r,n,a=!0,s;if(i){e=e==null?null:e+"";for(s in i){if((r=i[s]).name!==e){a=!1;continue}n=r.state>u1&&r.state<c1,r.state=PD,r.timer.stop(),r.on.call(n?"interrupt":"cancel",t,t.__data__,r.index,r.group),delete i[s]}a&&delete t.__transition}}function sKe(t){return this.each(function(){aKe(this,t)})}function oKe(t,e){var i,r;return function(){var n=zc(this,t),a=n.tween;if(a!==i){r=i=a;for(var s=0,o=r.length;s<o;++s)if(r[s].name===e){r=r.slice(),r.splice(s,1);break}}n.tween=r}}function lKe(t,e,i){var r,n;if(typeof i!="function")throw new Error;return function(){var a=zc(this,t),s=a.tween;if(s!==r){n=(r=s).slice();for(var o={name:e,value:i},l=0,u=n.length;l<u;++l)if(n[l].name===e){n[l]=o;break}l===u&&n.push(o)}a.tween=n}}function uKe(t,e){var i=this._id;if(t+="",arguments.length<2){for(var r=Lu(this.node(),i).tween,n=0,a=r.length,s;n<a;++n)if((s=r[n]).name===t)return s.value;return null}return this.each((e==null?oKe:lKe)(i,t,e))}function oH(t,e,i){var r=t._id;return t.each(function(){var n=zc(this,r);(n.value||(n.value={}))[e]=i.apply(this,arguments)}),function(n){return Lu(n,r).value[e]}}function ffe(t,e){var i;return(typeof e=="number"?ap:e instanceof Iw?H3:(i=Iw(e))?(e=i,H3):q5e)(t,e)}function cKe(t){return function(){this.removeAttribute(t)}}function dKe(t){return function(){this.removeAttributeNS(t.space,t.local)}}function pKe(t,e,i){var r,n=i+"",a;return function(){var s=this.getAttribute(t);return s===n?null:s===r?a:a=e(r=s,i)}}function fKe(t,e,i){var r,n=i+"",a;return function(){var s=this.getAttributeNS(t.space,t.local);return s===n?null:s===r?a:a=e(r=s,i)}}function mKe(t,e,i){var r,n,a;return function(){var s,o=i(this),l;return o==null?void this.removeAttribute(t):(s=this.getAttribute(t),l=o+"",s===l?null:s===r&&l===n?a:(n=l,a=e(r=s,o)))}}function hKe(t,e,i){var r,n,a;return function(){var s,o=i(this),l;return o==null?void this.removeAttributeNS(t.space,t.local):(s=this.getAttributeNS(t.space,t.local),l=o+"",s===l?null:s===r&&l===n?a:(n=l,a=e(r=s,o)))}}function gKe(t,e){var i=hA(t),r=i==="transform"?J5e:ffe;return this.attrTween(t,typeof e=="function"?(i.local?hKe:mKe)(i,r,oH(this,"attr."+t,e)):e==null?(i.local?dKe:cKe)(i):(i.local?fKe:pKe)(i,r,e))}function IKe(t,e){return function(i){this.setAttribute(t,e.call(this,i))}}function vKe(t,e){return function(i){this.setAttributeNS(t.space,t.local,e.call(this,i))}}function yKe(t,e){var i,r;function n(){var a=e.apply(this,arguments);return a!==r&&(i=(r=a)&&vKe(t,a)),i}return n._value=e,n}function bKe(t,e){var i,r;function n(){var a=e.apply(this,arguments);return a!==r&&(i=(r=a)&&IKe(t,a)),i}return n._value=e,n}function wKe(t,e){var i="attr."+t;if(arguments.length<2)return(i=this.tween(i))&&i._value;if(e==null)return this.tween(i,null);if(typeof e!="function")throw new Error;var r=hA(t);return this.tween(i,(r.local?yKe:bKe)(r,e))}function SKe(t,e){return function(){sH(this,t).delay=+e.apply(this,arguments)}}function UKe(t,e){return e=+e,function(){sH(this,t).delay=e}}function TKe(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?SKe:UKe)(e,t)):Lu(this.node(),e).delay}function DKe(t,e){return function(){zc(this,t).duration=+e.apply(this,arguments)}}function PKe(t,e){return e=+e,function(){zc(this,t).duration=e}}function EKe(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?DKe:PKe)(e,t)):Lu(this.node(),e).duration}function RKe(t,e){if(typeof e!="function")throw new Error;return function(){zc(this,t).ease=e}}function CKe(t){var e=this._id;return arguments.length?this.each(RKe(e,t)):Lu(this.node(),e).ease}function MKe(t,e){return function(){var i=e.apply(this,arguments);if(typeof i!="function")throw new Error;zc(this,t).ease=i}}function NKe(t){if(typeof t!="function")throw new Error;return this.each(MKe(this._id,t))}function AKe(t){typeof t!="function"&&(t=qpe(t));for(var e=this._groups,i=e.length,r=new Array(i),n=0;n<i;++n)for(var a=e[n],s=a.length,o=r[n]=[],l,u=0;u<s;++u)(l=a[u])&&t.call(l,l.__data__,u,a)&&o.push(l);return new Ad(r,this._parents,this._name,this._id)}function kKe(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,i=t._groups,r=e.length,n=i.length,a=Math.min(r,n),s=new Array(r),o=0;o<a;++o)for(var l=e[o],u=i[o],c=l.length,d=s[o]=new Array(c),p,f=0;f<c;++f)(p=l[f]||u[f])&&(d[f]=p);for(;o<r;++o)s[o]=e[o];return new Ad(s,this._parents,this._name,this._id)}function OKe(t){return(t+"").trim().split(/^|\s+/).every(function(e){var i=e.indexOf(".");return i>=0&&(e=e.slice(0,i)),!e||e==="start"})}function xKe(t,e,i){var r,n,a=OKe(e)?sH:zc;return function(){var s=a(this,t),o=s.on;o!==r&&(n=(r=o).copy()).on(e,i),s.on=n}}function FKe(t,e){var i=this._id;return arguments.length<2?Lu(this.node(),i).on.on(t):this.each(xKe(i,t,e))}function LKe(t){return function(){var e=this.parentNode;for(var i in this.__transition)if(+i!==t)return;e&&e.removeChild(this)}}function _Ke(){return this.on("end.remove",LKe(this._id))}function $Ke(t){var e=this._name,i=this._id;typeof t!="function"&&(t=iH(t));for(var r=this._groups,n=r.length,a=new Array(n),s=0;s<n;++s)for(var o=r[s],l=o.length,u=a[s]=new Array(l),c,d,p=0;p<l;++p)(c=o[p])&&(d=t.call(c,c.__data__,p,o))&&("__data__"in c&&(d.__data__=c.__data__),u[p]=d,IA(u[p],e,i,p,u,Lu(c,i)));return new Ad(a,this._parents,e,i)}function BKe(t){var e=this._name,i=this._id;typeof t!="function"&&(t=zpe(t));for(var r=this._groups,n=r.length,a=[],s=[],o=0;o<n;++o)for(var l=r[o],u=l.length,c,d=0;d<u;++d)if(c=l[d]){for(var p=t.call(c,c.__data__,d,l),f,m=Lu(c,i),h=0,g=p.length;h<g;++h)(f=p[h])&&IA(f,e,i,h,p,m);a.push(p),s.push(c)}return new Ad(a,s,e,i)}var VKe=pT.prototype.constructor;function jKe(){return new VKe(this._groups,this._parents)}function GKe(t,e){var i,r,n;return function(){var a=VI(this,t),s=(this.style.removeProperty(t),VI(this,t));return a===s?null:a===i&&s===r?n:n=e(i=a,r=s)}}function mfe(t){return function(){this.style.removeProperty(t)}}function HKe(t,e,i){var r,n=i+"",a;return function(){var s=VI(this,t);return s===n?null:s===r?a:a=e(r=s,i)}}function WKe(t,e,i){var r,n,a;return function(){var s=VI(this,t),o=i(this),l=o+"";return o==null&&(l=o=(this.style.removeProperty(t),VI(this,t))),s===l?null:s===r&&l===n?a:(n=l,a=e(r=s,o))}}function zKe(t,e){var i,r,n,a="style."+e,s="end."+a,o;return function(){var l=zc(this,t),u=l.on,c=l.value[a]==null?o||(o=mfe(e)):void 0;(u!==i||n!==c)&&(r=(i=u).copy()).on(s,n=c),l.on=r}}function qKe(t,e,i){var r=(t+="")=="transform"?X5e:ffe;return e==null?this.styleTween(t,GKe(t,r)).on("end.style."+t,mfe(t)):typeof e=="function"?this.styleTween(t,WKe(t,r,oH(this,"style."+t,e))).each(zKe(this._id,t)):this.styleTween(t,HKe(t,r,e),i).on("end.style."+t,null)}function YKe(t,e,i){return function(r){this.style.setProperty(t,e.call(this,r),i)}}function KKe(t,e,i){var r,n;function a(){var s=e.apply(this,arguments);return s!==n&&(r=(n=s)&&YKe(t,s,i)),r}return a._value=e,a}function XKe(t,e,i){var r="style."+(t+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(e==null)return this.tween(r,null);if(typeof e!="function")throw new Error;return this.tween(r,KKe(t,e,i??""))}function JKe(t){return function(){this.textContent=t}}function QKe(t){return function(){var e=t(this);this.textContent=e??""}}function ZKe(t){return this.tween("text",typeof t=="function"?QKe(oH(this,"text",t)):JKe(t==null?"":t+""))}function e7e(t){return function(e){this.textContent=t.call(this,e)}}function t7e(t){var e,i;function r(){var n=t.apply(this,arguments);return n!==i&&(e=(i=n)&&e7e(n)),e}return r._value=t,r}function i7e(t){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(t==null)return this.tween(e,null);if(typeof t!="function")throw new Error;return this.tween(e,t7e(t))}function r7e(){for(var t=this._name,e=this._id,i=hfe(),r=this._groups,n=r.length,a=0;a<n;++a)for(var s=r[a],o=s.length,l,u=0;u<o;++u)if(l=s[u]){var c=Lu(l,e);IA(l,t,i,u,s,{time:c.time+c.delay+c.duration,delay:0,duration:c.duration,ease:c.ease})}return new Ad(r,this._parents,t,i)}function n7e(){var t,e,i=this,r=i._id,n=i.size();return new Promise(function(a,s){var o={value:s},l={value:function(){--n===0&&a()}};i.each(function(){var u=zc(this,r),c=u.on;c!==t&&(e=(t=c).copy(),e._.cancel.push(o),e._.interrupt.push(o),e._.end.push(l)),u.on=e}),n===0&&a()})}var a7e=0;function Ad(t,e,i,r){this._groups=t,this._parents=e,this._name=i,this._id=r}function hfe(){return++a7e}var Kc=pT.prototype;Ad.prototype={constructor:Ad,select:$Ke,selectAll:BKe,selectChild:Kc.selectChild,selectChildren:Kc.selectChildren,filter:AKe,merge:kKe,selection:jKe,transition:r7e,call:Kc.call,nodes:Kc.nodes,node:Kc.node,size:Kc.size,empty:Kc.empty,each:Kc.each,on:FKe,attr:gKe,attrTween:wKe,style:qKe,styleTween:XKe,text:ZKe,textTween:i7e,remove:_Ke,tween:uKe,delay:TKe,duration:EKe,ease:CKe,easeVarying:NKe,end:n7e,[Symbol.iterator]:Kc[Symbol.iterator]};function s7e(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}var o7e={time:null,delay:0,duration:250,ease:s7e};function l7e(t,e){for(var i;!(i=t.__transition)||!(i=i[e]);)if(!(t=t.parentNode))throw new Error(`transition ${e} not found`);return i}function u7e(t){var e,i;t instanceof Ad?(e=t._id,t=t._name):(e=hfe(),(i=o7e).time=aH(),t=t==null?null:t+"");for(var r=this._groups,n=r.length,a=0;a<n;++a)for(var s=r[a],o=s.length,l,u=0;u<o;++u)(l=s[u])&&IA(l,t,e,u,s,i||l7e(l,e));return new Ad(r,this._parents,t,e)}pT.prototype.interrupt=sKe;pT.prototype.transition=u7e;function c7e(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)}function wE(t,e){if(!isFinite(t)||t===0)return null;var i=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"),r=t.slice(0,i);return[r.length>1?r[0]+r.slice(2):r,+t.slice(i+1)]}function d7e(t){return t=wE(Math.abs(t)),t?t[1]:NaN}function p7e(t,e){return function(i,r){for(var n=i.length,a=[],s=0,o=t[0],l=0;n>0&&o>0&&(l+o+1>r&&(o=Math.max(1,r-l)),a.push(i.substring(n-=o,n+o)),!((l+=o+1)>r));)o=t[s=(s+1)%t.length];return a.reverse().join(e)}}function f7e(t){return function(e){return e.replace(/[0-9]/g,function(i){return t[+i]})}}var m7e=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function d1(t){if(!(e=m7e.exec(t)))throw new Error("invalid format: "+t);var e;return new lH({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}d1.prototype=lH.prototype;function lH(t){this.fill=t.fill===void 0?" ":t.fill+"",this.align=t.align===void 0?">":t.align+"",this.sign=t.sign===void 0?"-":t.sign+"",this.symbol=t.symbol===void 0?"":t.symbol+"",this.zero=!!t.zero,this.width=t.width===void 0?void 0:+t.width,this.comma=!!t.comma,this.precision=t.precision===void 0?void 0:+t.precision,this.trim=!!t.trim,this.type=t.type===void 0?"":t.type+""}lH.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function h7e(t){e:for(var e=t.length,i=1,r=-1,n;i<e;++i)switch(t[i]){case".":r=n=i;break;case"0":r===0&&(r=i),n=i;break;default:if(!+t[i])break e;r>0&&(r=0);break}return r>0?t.slice(0,r)+t.slice(n+1):t}var SE;function g7e(t,e){var i=wE(t,e);if(!i)return SE=void 0,t.toPrecision(e);var r=i[0],n=i[1],a=n-(SE=Math.max(-8,Math.min(8,Math.floor(n/3)))*3)+1,s=r.length;return a===s?r:a>s?r+new Array(a-s+1).join("0"):a>0?r.slice(0,a)+"."+r.slice(a):"0."+new Array(1-a).join("0")+wE(t,Math.max(0,e+a-1))[0]}function X3(t,e){var i=wE(t,e);if(!i)return t+"";var r=i[0],n=i[1];return n<0?"0."+new Array(-n).join("0")+r:r.length>n+1?r.slice(0,n+1)+"."+r.slice(n+1):r+new Array(n-r.length+2).join("0")}const J3={"%":(t,e)=>(t*100).toFixed(e),b:t=>Math.round(t).toString(2),c:t=>t+"",d:c7e,e:(t,e)=>t.toExponential(e),f:(t,e)=>t.toFixed(e),g:(t,e)=>t.toPrecision(e),o:t=>Math.round(t).toString(8),p:(t,e)=>X3(t*100,e),r:X3,s:g7e,X:t=>Math.round(t).toString(16).toUpperCase(),x:t=>Math.round(t).toString(16)};function Q3(t){return t}var Z3=Array.prototype.map,eY=["y","z","a","f","p","n","Âµ","m","","k","M","G","T","P","E","Z","Y"];function I7e(t){var e=t.grouping===void 0||t.thousands===void 0?Q3:p7e(Z3.call(t.grouping,Number),t.thousands+""),i=t.currency===void 0?"":t.currency[0]+"",r=t.currency===void 0?"":t.currency[1]+"",n=t.decimal===void 0?".":t.decimal+"",a=t.numerals===void 0?Q3:f7e(Z3.call(t.numerals,String)),s=t.percent===void 0?"%":t.percent+"",o=t.minus===void 0?"â":t.minus+"",l=t.nan===void 0?"NaN":t.nan+"";function u(d,p){d=d1(d);var f=d.fill,m=d.align,h=d.sign,g=d.symbol,I=d.zero,v=d.width,w=d.comma,y=d.precision,b=d.trim,S=d.type;S==="n"?(w=!0,S="g"):J3[S]||(y===void 0&&(y=12),b=!0,S="g"),(I||f==="0"&&m==="=")&&(I=!0,f="0",m="=");var U=(p&&p.prefix!==void 0?p.prefix:"")+(g==="$"?i:g==="#"&&/[boxX]/.test(S)?"0"+S.toLowerCase():""),T=(g==="$"?r:/[%p]/.test(S)?s:"")+(p&&p.suffix!==void 0?p.suffix:""),P=J3[S],D=/[defgprs%]/.test(S);y=y===void 0?6:/[gprs]/.test(S)?Math.max(1,Math.min(21,y)):Math.max(0,Math.min(20,y));function E(R){var C=U,M=T,N,A,O;if(S==="c")M=P(R)+M,R="";else{R=+R;var k=R<0||1/R<0;if(R=isNaN(R)?l:P(Math.abs(R),y),b&&(R=h7e(R)),k&&+R==0&&h!=="+"&&(k=!1),C=(k?h==="("?h:o:h==="-"||h==="("?"":h)+C,M=(S==="s"&&!isNaN(R)&&SE!==void 0?eY[8+SE/3]:"")+M+(k&&h==="("?")":""),D){for(N=-1,A=R.length;++N<A;)if(O=R.charCodeAt(N),48>O||O>57){M=(O===46?n+R.slice(N+1):R.slice(N))+M,R=R.slice(0,N);break}}}w&&!I&&(R=e(R,1/0));var F=C.length+R.length+M.length,x=F<v?new Array(v-F+1).join(f):"";switch(w&&I&&(R=e(x+R,x.length?v-M.length:1/0),x=""),m){case"<":R=C+R+M+x;break;case"=":R=C+x+R+M;break;case"^":R=x.slice(0,F=x.length>>1)+C+R+M+x.slice(F);break;default:R=x+C+R+M;break}return a(R)}return E.toString=function(){return d+""},E}function c(d,p){var f=Math.max(-8,Math.min(8,Math.floor(d7e(p)/3)))*3,m=Math.pow(10,-f),h=u((d=d1(d),d.type="f",d),{suffix:eY[8+f/3]});return function(g){return h(m*g)}}return{format:u,formatPrefix:c}}var _T;v7e({thousands:",",grouping:[3],currency:["$",""]});function v7e(t){return _T=I7e(t),_T.format,_T.formatPrefix,_T}function y7e(t){var e=0,i=t.children,r=i&&i.length;if(!r)e=1;else for(;--r>=0;)e+=i[r].value;t.value=e}function b7e(){return this.eachAfter(y7e)}function w7e(t,e){let i=-1;for(const r of this)t.call(e,r,++i,this);return this}function S7e(t,e){for(var i=this,r=[i],n,a,s=-1;i=r.pop();)if(t.call(e,i,++s,this),n=i.children)for(a=n.length-1;a>=0;--a)r.push(n[a]);return this}function U7e(t,e){for(var i=this,r=[i],n=[],a,s,o,l=-1;i=r.pop();)if(n.push(i),a=i.children)for(s=0,o=a.length;s<o;++s)r.push(a[s]);for(;i=n.pop();)t.call(e,i,++l,this);return this}function T7e(t,e){let i=-1;for(const r of this)if(t.call(e,r,++i,this))return r}function D7e(t){return this.eachAfter(function(e){for(var i=+t(e.data)||0,r=e.children,n=r&&r.length;--n>=0;)i+=r[n].value;e.value=i})}function P7e(t){return this.eachBefore(function(e){e.children&&e.children.sort(t)})}function E7e(t){for(var e=this,i=R7e(e,t),r=[e];e!==i;)e=e.parent,r.push(e);for(var n=r.length;t!==i;)r.splice(n,0,t),t=t.parent;return r}function R7e(t,e){if(t===e)return t;var i=t.ancestors(),r=e.ancestors(),n=null;for(t=i.pop(),e=r.pop();t===e;)n=t,t=i.pop(),e=r.pop();return n}function C7e(){for(var t=this,e=[t];t=t.parent;)e.push(t);return e}function M7e(){return Array.from(this)}function N7e(){var t=[];return this.eachBefore(function(e){e.children||t.push(e)}),t}function A7e(){var t=this,e=[];return t.each(function(i){i!==t&&e.push({source:i.parent,target:i})}),e}function*k7e(){var t=this,e,i=[t],r,n,a;do for(e=i.reverse(),i=[];t=e.pop();)if(yield t,r=t.children)for(n=0,a=r.length;n<a;++n)i.push(r[n]);while(i.length)}function gfe(t,e){t instanceof Map?(t=[void 0,t],e===void 0&&(e=F7e)):e===void 0&&(e=x7e);for(var i=new UE(t),r,n=[i],a,s,o,l;r=n.pop();)if((s=e(r.data))&&(l=(s=Array.from(s)).length))for(r.children=s,o=l-1;o>=0;--o)n.push(a=s[o]=new UE(s[o])),a.parent=r,a.depth=r.depth+1;return i.eachBefore(_7e)}function O7e(){return gfe(this).eachBefore(L7e)}function x7e(t){return t.children}function F7e(t){return Array.isArray(t)?t[1]:null}function L7e(t){t.data.value!==void 0&&(t.value=t.data.value),t.data=t.data.data}function _7e(t){var e=0;do t.height=e;while((t=t.parent)&&t.height<++e)}function UE(t){this.data=t,this.depth=this.height=0,this.parent=null}UE.prototype=gfe.prototype={constructor:UE,count:b7e,each:w7e,eachAfter:U7e,eachBefore:S7e,find:T7e,sum:D7e,sort:P7e,path:E7e,ancestors:C7e,descendants:M7e,leaves:N7e,links:A7e,copy:O7e,[Symbol.iterator]:k7e};function Ey(t,e,i){this.k=t,this.x=e,this.y=i}Ey.prototype={constructor:Ey,scale:function(t){return t===1?this:new Ey(this.k*t,this.x,this.y)},translate:function(t,e){return t===0&e===0?this:new Ey(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};Ey.prototype;Object.assign({},...Zx.countries.filter(t=>t.ioc).map(t=>({[t.ioc]:t.iso2})),...Zx.countries.filter(t=>t.iso).map(t=>({[t.iso]:t.iso2})));const{MALE:$7e,FEMALE:B7e}=XE,{PAIR:V7e}=uK,j7e="utr",G7e={utr:{accessor:"utrRating",scaleType:"RATING",scaleColor:"blue",scaleName:"UTR",fallback:!0},wtn:{accessor:"wtnRating",scaleType:"RATING",scaleColor:"red",scaleName:"WTN",fallback:!0}},Ife=t=>(e,i,r)=>{const n=e.getColumn().getDefinition(),a=n.field==="side1"&&1||n.field==="side2"&&2,s=document.createElement("div"),o=e.getRow().getData(),l=o.winningSide,u=e.getValue(),c=o.participant||u.participant||o.person&&o;if(c){const d=G7e[j7e],p=m=>bpe({eventHandlers:{participantClick:h=>Hu(t)&&t({...h,event:h.pointerEvent,cell:e})},composition:{configuration:{participantDetail:"TEAM",winnerColor:!0,genderColor:!0,scaleAttributes:d,flag:!1},theme:""},matchUp:o.matchUp,participant:m,placeholder:i,sideNumber:a}),f=m=>{const h=document.createElement("div");return h.className="flexrow flexjustifystart",m.individualParticipants.forEach((g,I)=>{if(h.appendChild(p(g)),!I){const v=document.createElement("span");v.style.width="1em",v.innerHTML="&nbsp;",h.appendChild(v)}}),h};return r==="sideBySide"&&c.participantType===V7e?f(c):p(c)}if(l){const d=n.field===o.winningSide;s.style.color=d?"green":"red"}else{const d=u?.sex||o?.person?.sex,p=d===$7e&&"#2E86C1"||d===B7e&&"#AA336A"||"";s.style.color=p}return s.innerHTML=(jO(u)?u.participantName:u)||"",s};function H7e(t){const e=t.getRow().getData();if(!e.competitiveProfile?.competitiveness)return"";const{competitiveProfile:i,score:r}=e,n=document.createElement("span"),a={COMPETITIVE:"green",DECISIVE:"magenta",ROUTINE:"blue"};if(r){const{competitiveness:s}=i;n.style.fontSize="smaller",n.style.color=a[s],n.innerHTML=s}return n}function W7e(t){const e=t.getRow().getData();if(!e.readyToScore)return"";const i=e.matchUp.matchUpStatus==="WALKOVER",r=document.createElement("span");return r.classList.add("scoreCell"),e.score?(r.style.fontSize="smaller",r.innerHTML=e.score):i?r.innerHTML="WO":(r.style.fontSize="smaller",r.style.color="blue",r.innerHTML="--- --- ---"),r}function p1(t,e){const i=t?.person||t?.participant?.person,r=e?.person||e?.participant?.person;return i||r?i?.standardFamilyName&&!r?.standardFamilyName||r?.standardFamilyName&&!i?.standardFamilyName||!i?.standardFamilyName&&!r?.standardFamilyName?1:i.standardFamilyName?.localeCompare(r?.standardFamilyName):t.participantName&&!e.participantName||e.participantName&&!t.participantName||!t?.participantName&&!e?.participantName?1:t?.participantName?.localeCompare(e?.participantName)}function z7e(t,e){if(!t.score&&!e.score){if(t.readyToScore&&!e.readyToScore)return-1;if(e.readyToScore&&!t.readyToScore)return 1}return t.score&&!e.score?-1:e.score&&!t.score?1:0}function q7e({data:t}){const e=t.some(r=>r.courtName),i=r=>{const n=document.createElement("div");n.className="has-text-warning-dark",n.innerHTML="Select participant";const a=()=>console.log("boo");return r.getValue().participantName&&Ife(a)(r,n)};return[{formatter:"responsiveCollapse",headerSort:!1,resizable:!1,hozAlign:Gi,minWidth:50,width:50},{formatter:"rownum",headerSort:!1,hozAlign:Fp,width:55},{title:"Flight",visible:!1,minWidth:150,field:"flight",widthGrow:1},{field:"scheduledDate",title:"Date",width:110},{visible:!!e,field:"courtName",title:"Court",width:100},{field:"scheduleTime",headerSort:!1,visible:!1,title:"Time",width:70},{formatter:i,sorter:p1,responsive:!1,title:"Side 1",minWidth:180,field:"side1",widthGrow:1},{formatter:i,sorter:p1,responsive:!1,title:"Side 2",minWidth:180,field:"side2",widthGrow:1},{formatter:W7e,sorter:z7e,field:"scoreDetail",responsive:!1,title:"Score",width:140},{sorter:vOe,formatter:H7e,field:"competitiveProfile",responsive:!1,title:"Profile",visible:!1,width:140},{title:"<div class='fa-solid fa-check' style='color: green' />",formatter:"tickCross",field:"complete",hozAlign:Fp,tooltip:!1,width:40},{field:"matchUp.matchUpStatus",title:"Status",width:150},{title:"<div class='fa-solid fa-clock' style='color: blue' />",headerSort:!1,field:"duration",visible:!1,width:70}]}var Y7e=function(t){return String.prototype.normalize?t.normalize("NFKD").replace(/[\u0300-\u036F]/g,""):t};const{TEAM:K7e}=I5,tY=t=>{const{potentialParticipants:e,structureName:i,matchUpType:r,roundNumber:n,matchUpId:a,roundName:s,schedule:o,eventId:l,drawId:u,sides:c,...d}=t,{scheduledDate:p,scheduleTime:f,courtName:m}=o||{},h=N=>N.person?.standardFamilyName||N.participantName,g=e?.map(N=>({participantName:N.map(h).filter(Boolean).join(" or ")}))||[],I=c?.[0]?.participant||g.shift(),v=c?.[1]?.participant||g.shift(),w={participantName:I?.participantName,sex:I?.person?.sex,participant:I},y={participantName:v?.participantName,sex:v?.person?.sex,participant:v},b=c.flatMap(({participant:N})=>N?.individualParticipantIds?.length?N.individualParticipantIds:N?.participantId).filter(Boolean),S=d.winningSide===1&&"side1"||d.winningSide===2&&"side2"||void 0,U=!!d.winningSide,T=!!(d.winningSide||d.readyToScore),P=d.score?.scoreStringSide1,D=c.flatMap(N=>{const A=N.participant?.person;return A?[A.standardGivenName,A.standardFamilyName]:N.participant?.individualParticipants?.map(({person:O})=>[O.standardGivenName,O.standardFamilyName])}).filter(Boolean).join(" ").toLowerCase(),E=Y7e([D,I?.participantName,v?.participantName].filter(Boolean).join(" ")).toLowerCase(),R=t.collectionId?K7e:r,C=t.competitiveness?{competitiveness:t.competitiveness}:t.competitiveProfile,M={score:P,matchUpStatus:t.matchUpStatus,readyToScore:T,complete:U,winningSide:S};return{matchUpStatus:t.matchUpStatus,individualParticipantIds:b,flight:t.drawName,competitiveProfile:C,structureName:i,scheduledDate:p,readyToScore:T,scheduleTime:f,matchUpType:r,scoreDetail:M,winningSide:S,roundNumber:n,searchText:E,courtName:m,eventType:R,matchUpId:a,roundName:s,complete:U,eventId:l,matchUp:t,drawId:u,side1:w,side2:y,score:P}},{CONTAINER:X7e}=aR;async function J7e(t){const{drawId:e,structureId:i,eventData:r}=t;let n,a,s,o,l=t.matchUps;const u=()=>{a=r?.drawsData?.find(y=>y.drawId===e)?.structures?.find(y=>y.structureId===i),o=a?.structureType===X7e;const v=a?.roundMatchUps?Object.values(a?.roundMatchUps||{}).flat():[],w=v.flatMap(y=>y.tieMatchUps||[]);return w.length&&v.push(...w),v.filter(({matchUpStatus:y})=>y!=="BYE").filter(({sides:y})=>!s||y.find(b=>b.participant?.participantName?.toLowerCase().includes(s?.toLowerCase())))};l||(l=await u()),r&&l.forEach(I=>I.eventName=r.eventInfo.eventName);const c=()=>l.map(tY),d=()=>u().map(tY),p=I=>{I.participantFilter&&(s=I.participantFilter),n.replaceData(d())},f=c(),m=q7e({data:f}),h=o?["roundName","structureName"]:["roundName"];return(I=>{KC({anchorId:"flightDisplay"});const v=document.getElementById("flightDisplay");n=new BS(v,{groupHeader:[IOe,w=>w],headerSortElement:xee(["complete","duration","score"]),responsiveLayoutCollapseStartOpen:!1,height:window.innerHeight*.85,responsiveLayout:"collapse",placeholder:"No matches",layout:"fitColumns",reactiveData:!0,index:"matchUpId",groupBy:h,columns:m,data:I})})(f),{table:n,replaceTableData:p}}const Q7e=t=>t.reduce((e,i)=>e+parseFloat(i),0),iY=t=>parseFloat((Q7e(t)/t.length).toFixed(2));function rY(t){const{participantResult:e,drawPosition:i,participantId:r,participantMap:n}=t,a=e?.ratingVariation?.length?iY(e.ratingVariation):0,s=e?.pressureScores?.length?iY(e.pressureScores):0,o=`${e?.pointsWon||0}/${e?.pointsLost||0}`,l=`${e?.gamesWon||0}/${e?.gamesLost||0}`,u=`${e?.setsWon||0}/${e?.setsLost||0}`,c=e?.groupOrder||e?.provisionalOrder,d=n[r];return{participantName:d.participantName,groupName:d.groupName,...e,averageVariation:a,averagePressure:s,participantId:r,pointsResult:o,drawPosition:i,participant:d,gamesResult:l,setsResult:u,order:c}}function TE(t,e){return!t&&!e||t&&!e?-1:e&&!t?1:t-e}function hg(t){const e=t.getValue();return e&&`${(parseFloat(e)*100).toFixed(0)}%`}function nY(t,e){return!t&&!e||t&&!e?-1:e&&!t?1:e-t}function Z7e({isAdHoc:t}){return[{formatter:Ife(({event:e,cell:i,...r})=>console.log("cell clicked",{event:e,cell:i,undefined:void 0,params:r})),sorter:p1,field:"participantName",responsive:!1,resizable:!1,maxWidth:400,minWidth:200,title:"Name",widthGrow:2,frozen:!0},{headerHozAlign:Gi,headerWordWrap:!0,title:"Match W/L",hozAlign:Gi,maxWidth:80,field:"result"},{formatter:hg,headerHozAlign:Gi,headerWordWrap:!0,field:"matchUpsPct",title:"Match Win%",hozAlign:Gi,maxWidth:80},{headerHozAlign:Gi,headerWordWrap:!0,field:"setsResult",title:"Sets W/L",hozAlign:Gi,maxWidth:80},{formatter:hg,headerHozAlign:Gi,headerWordWrap:!0,title:"Set Win%",hozAlign:Gi,field:"setsPct",maxWidth:80},{headerHozAlign:Gi,headerWordWrap:!0,field:"gamesResult",title:"Games W/L",hozAlign:Gi,maxWidth:80},{formatter:hg,headerHozAlign:Gi,headerWordWrap:!0,title:"Game Win%",hozAlign:Gi,field:"gamesPct",maxWidth:80},{headerHozAlign:Gi,headerWordWrap:!0,field:"pointsResult",title:"Points W/L",hozAlign:Gi,maxWidth:80},{formatter:hg,headerHozAlign:Gi,headerWordWrap:!0,title:"Points Win%",field:"pointsPct",hozAlign:Gi,maxWidth:80},{formatter:hg,field:"averagePressure",headerHozAlign:Gi,sorter:nY,hozAlign:Gi,maxWidth:70,title:"PS"},{formatter:hg,field:"averageVariation",headerHozAlign:Gi,sorter:nY,hozAlign:Gi,maxWidth:70,title:"RV"},{headerHozAlign:Gi,field:"pressureOrder",sorter:TE,hozAlign:Gi,visible:t,title:"Order",maxWidth:80},{headerHozAlign:Gi,sorter:TE,visible:!t,hozAlign:Gi,title:"Order",field:"order",maxWidth:80},{field:"groupName",visible:!1,title:"Group"}]}async function e8e({drawId:t,structureId:e,eventData:i,participants:r=[]}){let n,a,s,l=i?.drawsData?.find(y=>y.drawId===t)?.structures?.find(y=>y.structureId===e);const u=gR.isAdHoc({structure:l}),c=y=>(y??[]).reduce((b,S)=>(b[S.participantId]=S,b),{}),d={},p=()=>(l=i?.drawsData?.find(S=>S.drawId===t)?.structures?.find(S=>S.structureId===e),s||(s=c(r)),(l?.roundMatchUps?Object.values(l.roundMatchUps).flat():[]).forEach(({sides:S,structureName:U,structureId:T})=>{d[T]=U,S.forEach(P=>{P.participantId&&(s[P.participantId].groupName=U)})}),(l?.participantResults??[]).filter(S=>{const U=s[S.participantId];return!a||U?.participantName?.toLowerCase().includes(a?.toLowerCase())})),f=p(),m=()=>f?.map(y=>rY({...y,participantMap:s})).sort((y,b)=>u?TE(y.pressureOrder,b.pressureOrder):TE(y.order,b.order)),h=()=>p()?.map(y=>rY({...y,participantMap:s})),g=y=>{y?.participantFilter!==void 0&&(a=y.participantFilter),n.replaceData(h())},I=m(),v=Z7e({isAdHoc:u});return(y=>{KC({anchorId:"flightDisplay"});const b=document.getElementById("flightDisplay"),S=Object.values(d).length>1?["groupName"]:void 0;n=new BS(b,{headerSortElement:xee(["averageVariation","averagePressure","participantName","gamesResult","matchUpsPct","setsResult","gamesPct","setsPct","result","order"]),height:window.innerHeight*.85,groupHeader:[U=>U],placeholder:"No participants",renderHorizontal:"virtual",index:"matchUpId",groupBy:S,columns:v,data:y})})(I),{table:n,replaceTableData:g}}const{CONTAINER:t8e}=aR;function i8e(t){const{callback:e,structure:i,existingView:r}=t,n=l=>r!==l&&Hu(e)&&e({refresh:!0,view:l}),a=i?.structureType===t8e,s=qRe.isAdHoc({structure:i}),o=[];return r!==YW&&o.push({onClick:()=>n(YW),label:s?"Columns":"Draw",close:!0}),r!==XW&&o.push({onClick:()=>n(XW),label:"Table view",close:!0}),(s||a)&&r!==KW&&o.push({onClick:()=>n(KW),label:"Statistics",close:!0}),{label:"Display",id:"roundDisplayButton",options:o,selection:!1,location:xm,align:xm}}function aY({tournamentId:t,eventId:e,header:i,flightDisplay:r,displayFormat:n,drawId:a,structureId:s}){const o=()=>document.getElementById("structureButton")?.remove(),l=()=>document.getElementById("roundDisplayButton")?.remove();Oee({tournamentId:t,eventId:e,hydrateParticipants:!1}).then(c=>{const d=c?.data?.eventData||c?.data,p=c?.data?.participants||[];window?.dev&&(window.dev.eventData=d);const f=b=>Object.values(b.roundMatchUps||{}).flat(),m=b=>b.structures?.some(S=>f(S).length>0),h=d?.drawsData.filter(m);{const b=new Map(p.map(U=>[U.participantId,U])),S=U=>{for(const T of U.sides||[])T.participantId&&(T.participant=b.get(T.participantId),T.participant?.individualParticipantIds&&(T.participant.individualParticipants=T.participant.individualParticipantIds.map(P=>b.get(P))))};for(const U of h)for(const T of U.structures)Object.values(T.roundMatchUps||{}).flat().forEach(P=>{S(P),P.tieMatchUps?.forEach(S)})}const g=b=>{const S=h[b];if(!S)return;const U=S.drawId,T=({view:R})=>{R&&(n=R),g(b)},P=R=>{const C=S.structures?.[R];l();const M=i8e({callback:T,structure:C}),N=lm({button:M});i.appendChild(N);const A=C.structureId,O=Object.values(C.roundMatchUps||{}).flat();gR.isAdHoc({structure:C})&&O.sort(HC.matchUpScheduleSort),r.innerHTML=S.drawName,Jf(r);const F={...d?.eventInfo?.display,...S?.display,...C?.display},x=F?.compositionName,L=F?.configuration,$=hYe[x??"National"];if(Object.assign($.configuration,L),$.configuration.genderColor=!0,n==="roundsColumns"){const V=cYe({content:uYe({context:{drawId:U,structureId:A},matchUps:O,composition:$,structureId:A}),theme:$.theme});r.appendChild(V)}else n==="roundsStats"?e8e({drawId:U,structureId:A,eventData:d,participants:p}):J7e({drawId:U,structureId:A,eventData:d})},D=s?Math.max(S.structures?.findIndex(R=>R.structureId===s)??-1,0):0;if(s=void 0,S.structures?.length>1){const R=S.structures.map(({structureName:N,structureId:A},O)=>({onClick:()=>{Hg({tournamentId:t,eventId:e,drawId:U,structureId:A}),P(O)},isActive:O===D,label:N,close:!0})),C={label:S.structures[D].structureName,options:R,id:"structureButton",modifyLabel:!0,selection:!0,location:Fp},M=lm({button:C});i.appendChild(M)}S.structures?.[D]&&P(D)},I=a?Math.max(h.findIndex(b=>b.drawId===a),0):0;a=void 0;const v=h.map(({drawName:b,drawId:S},U)=>({onClick:()=>{Hg({tournamentId:t,eventId:e,drawId:S}),g(U)},isActive:U===I,label:b,close:!0})),w={label:h?.[I]?.drawName,options:v,modifyLabel:!0,id:"flightButton",selection:!0,location:Fp},y=lm({button:w,stateChange:o});i.appendChild(y),g(I)})}function Jf(t){if(t)for(;t.firstChild;)t.removeChild(t.firstChild)}function r8e(t,e,i,r,n){if(n){const a=e.target.value;n(a)?(r.innerHTML="",r.classList.remove("is-danger"),i.classList.remove("is-danger"),i.classList.add("is-success")):(r.innerHTML=t.error||"Invalid",i.classList.remove("is-success"),i.classList.add("is-danger"),r.classList.add("is-danger"))}}var qs="top",bl="bottom",wl="right",Ys="left",uH="auto",mT=[qs,bl,wl,Ys],GI="start",yw="end",n8e="clippingParents",vfe="viewport",Iy="popper",a8e="reference",sY=mT.reduce(function(t,e){return t.concat([e+"-"+GI,e+"-"+yw])},[]),yfe=[].concat(mT,[uH]).reduce(function(t,e){return t.concat([e,e+"-"+GI,e+"-"+yw])},[]),s8e="beforeRead",o8e="read",l8e="afterRead",u8e="beforeMain",c8e="main",d8e="afterMain",p8e="beforeWrite",f8e="write",m8e="afterWrite",h8e=[s8e,o8e,l8e,u8e,c8e,d8e,p8e,f8e,m8e];function Mc(t){return t?(t.nodeName||"").toLowerCase():null}function ko(t){if(t==null)return window;if(t.toString()!=="[object Window]"){var e=t.ownerDocument;return e&&e.defaultView||window}return t}function Qm(t){var e=ko(t).Element;return t instanceof e||t instanceof Element}function el(t){var e=ko(t).HTMLElement;return t instanceof e||t instanceof HTMLElement}function cH(t){if(typeof ShadowRoot>"u")return!1;var e=ko(t).ShadowRoot;return t instanceof e||t instanceof ShadowRoot}function g8e(t){var e=t.state;Object.keys(e.elements).forEach(function(i){var r=e.styles[i]||{},n=e.attributes[i]||{},a=e.elements[i];!el(a)||!Mc(a)||(Object.assign(a.style,r),Object.keys(n).forEach(function(s){var o=n[s];o===!1?a.removeAttribute(s):a.setAttribute(s,o===!0?"":o)}))})}function I8e(t){var e=t.state,i={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(e.elements.popper.style,i.popper),e.styles=i,e.elements.arrow&&Object.assign(e.elements.arrow.style,i.arrow),function(){Object.keys(e.elements).forEach(function(r){var n=e.elements[r],a=e.attributes[r]||{},s=Object.keys(e.styles.hasOwnProperty(r)?e.styles[r]:i[r]),o=s.reduce(function(l,u){return l[u]="",l},{});!el(n)||!Mc(n)||(Object.assign(n.style,o),Object.keys(a).forEach(function(l){n.removeAttribute(l)}))})}}const bfe={name:"applyStyles",enabled:!0,phase:"write",fn:g8e,effect:I8e,requires:["computeStyles"]};function rc(t){return t.split("-")[0]}var Um=Math.max,DE=Math.min,HI=Math.round;function f1(){var t=navigator.userAgentData;return t!=null&&t.brands&&Array.isArray(t.brands)?t.brands.map(function(e){return e.brand+"/"+e.version}).join(" "):navigator.userAgent}function wfe(){return!/^((?!chrome|android).)*safari/i.test(f1())}function WI(t,e,i){e===void 0&&(e=!1),i===void 0&&(i=!1);var r=t.getBoundingClientRect(),n=1,a=1;e&&el(t)&&(n=t.offsetWidth>0&&HI(r.width)/t.offsetWidth||1,a=t.offsetHeight>0&&HI(r.height)/t.offsetHeight||1);var s=Qm(t)?ko(t):window,o=s.visualViewport,l=!wfe()&&i,u=(r.left+(l&&o?o.offsetLeft:0))/n,c=(r.top+(l&&o?o.offsetTop:0))/a,d=r.width/n,p=r.height/a;return{width:d,height:p,top:c,right:u+d,bottom:c+p,left:u,x:u,y:c}}function dH(t){var e=WI(t),i=t.offsetWidth,r=t.offsetHeight;return Math.abs(e.width-i)<=1&&(i=e.width),Math.abs(e.height-r)<=1&&(r=e.height),{x:t.offsetLeft,y:t.offsetTop,width:i,height:r}}function Sfe(t,e){var i=e.getRootNode&&e.getRootNode();if(t.contains(e))return!0;if(i&&cH(i)){var r=e;do{if(r&&t.isSameNode(r))return!0;r=r.parentNode||r.host}while(r)}return!1}function kd(t){return ko(t).getComputedStyle(t)}function v8e(t){return["table","td","th"].indexOf(Mc(t))>=0}function Cf(t){return((Qm(t)?t.ownerDocument:t.document)||window.document).documentElement}function vA(t){return Mc(t)==="html"?t:t.assignedSlot||t.parentNode||(cH(t)?t.host:null)||Cf(t)}function oY(t){return!el(t)||kd(t).position==="fixed"?null:t.offsetParent}function y8e(t){var e=/firefox/i.test(f1()),i=/Trident/i.test(f1());if(i&&el(t)){var r=kd(t);if(r.position==="fixed")return null}var n=vA(t);for(cH(n)&&(n=n.host);el(n)&&["html","body"].indexOf(Mc(n))<0;){var a=kd(n);if(a.transform!=="none"||a.perspective!=="none"||a.contain==="paint"||["transform","perspective"].indexOf(a.willChange)!==-1||e&&a.willChange==="filter"||e&&a.filter&&a.filter!=="none")return n;n=n.parentNode}return null}function hT(t){for(var e=ko(t),i=oY(t);i&&v8e(i)&&kd(i).position==="static";)i=oY(i);return i&&(Mc(i)==="html"||Mc(i)==="body"&&kd(i).position==="static")?e:i||y8e(t)||e}function pH(t){return["top","bottom"].indexOf(t)>=0?"x":"y"}function ib(t,e,i){return Um(t,DE(e,i))}function b8e(t,e,i){var r=ib(t,e,i);return r>i?i:r}function Ufe(){return{top:0,right:0,bottom:0,left:0}}function Tfe(t){return Object.assign({},Ufe(),t)}function Dfe(t,e){return e.reduce(function(i,r){return i[r]=t,i},{})}var w8e=function(e,i){return e=typeof e=="function"?e(Object.assign({},i.rects,{placement:i.placement})):e,Tfe(typeof e!="number"?e:Dfe(e,mT))};function S8e(t){var e,i=t.state,r=t.name,n=t.options,a=i.elements.arrow,s=i.modifiersData.popperOffsets,o=rc(i.placement),l=pH(o),u=[Ys,wl].indexOf(o)>=0,c=u?"height":"width";if(!(!a||!s)){var d=w8e(n.padding,i),p=dH(a),f=l==="y"?qs:Ys,m=l==="y"?bl:wl,h=i.rects.reference[c]+i.rects.reference[l]-s[l]-i.rects.popper[c],g=s[l]-i.rects.reference[l],I=hT(a),v=I?l==="y"?I.clientHeight||0:I.clientWidth||0:0,w=h/2-g/2,y=d[f],b=v-p[c]-d[m],S=v/2-p[c]/2+w,U=ib(y,S,b),T=l;i.modifiersData[r]=(e={},e[T]=U,e.centerOffset=U-S,e)}}function U8e(t){var e=t.state,i=t.options,r=i.element,n=r===void 0?"[data-popper-arrow]":r;n!=null&&(typeof n=="string"&&(n=e.elements.popper.querySelector(n),!n)||Sfe(e.elements.popper,n)&&(e.elements.arrow=n))}const T8e={name:"arrow",enabled:!0,phase:"main",fn:S8e,effect:U8e,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function zI(t){return t.split("-")[1]}var D8e={top:"auto",right:"auto",bottom:"auto",left:"auto"};function P8e(t,e){var i=t.x,r=t.y,n=e.devicePixelRatio||1;return{x:HI(i*n)/n||0,y:HI(r*n)/n||0}}function lY(t){var e,i=t.popper,r=t.popperRect,n=t.placement,a=t.variation,s=t.offsets,o=t.position,l=t.gpuAcceleration,u=t.adaptive,c=t.roundOffsets,d=t.isFixed,p=s.x,f=p===void 0?0:p,m=s.y,h=m===void 0?0:m,g=typeof c=="function"?c({x:f,y:h}):{x:f,y:h};f=g.x,h=g.y;var I=s.hasOwnProperty("x"),v=s.hasOwnProperty("y"),w=Ys,y=qs,b=window;if(u){var S=hT(i),U="clientHeight",T="clientWidth";if(S===ko(i)&&(S=Cf(i),kd(S).position!=="static"&&o==="absolute"&&(U="scrollHeight",T="scrollWidth")),S=S,n===qs||(n===Ys||n===wl)&&a===yw){y=bl;var P=d&&S===b&&b.visualViewport?b.visualViewport.height:S[U];h-=P-r.height,h*=l?1:-1}if(n===Ys||(n===qs||n===bl)&&a===yw){w=wl;var D=d&&S===b&&b.visualViewport?b.visualViewport.width:S[T];f-=D-r.width,f*=l?1:-1}}var E=Object.assign({position:o},u&&D8e),R=c===!0?P8e({x:f,y:h},ko(i)):{x:f,y:h};if(f=R.x,h=R.y,l){var C;return Object.assign({},E,(C={},C[y]=v?"0":"",C[w]=I?"0":"",C.transform=(b.devicePixelRatio||1)<=1?"translate("+f+"px, "+h+"px)":"translate3d("+f+"px, "+h+"px, 0)",C))}return Object.assign({},E,(e={},e[y]=v?h+"px":"",e[w]=I?f+"px":"",e.transform="",e))}function E8e(t){var e=t.state,i=t.options,r=i.gpuAcceleration,n=r===void 0?!0:r,a=i.adaptive,s=a===void 0?!0:a,o=i.roundOffsets,l=o===void 0?!0:o,u={placement:rc(e.placement),variation:zI(e.placement),popper:e.elements.popper,popperRect:e.rects.popper,gpuAcceleration:n,isFixed:e.options.strategy==="fixed"};e.modifiersData.popperOffsets!=null&&(e.styles.popper=Object.assign({},e.styles.popper,lY(Object.assign({},u,{offsets:e.modifiersData.popperOffsets,position:e.options.strategy,adaptive:s,roundOffsets:l})))),e.modifiersData.arrow!=null&&(e.styles.arrow=Object.assign({},e.styles.arrow,lY(Object.assign({},u,{offsets:e.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:l})))),e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-placement":e.placement})}const R8e={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:E8e,data:{}};var $T={passive:!0};function C8e(t){var e=t.state,i=t.instance,r=t.options,n=r.scroll,a=n===void 0?!0:n,s=r.resize,o=s===void 0?!0:s,l=ko(e.elements.popper),u=[].concat(e.scrollParents.reference,e.scrollParents.popper);return a&&u.forEach(function(c){c.addEventListener("scroll",i.update,$T)}),o&&l.addEventListener("resize",i.update,$T),function(){a&&u.forEach(function(c){c.removeEventListener("scroll",i.update,$T)}),o&&l.removeEventListener("resize",i.update,$T)}}const M8e={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:C8e,data:{}};var N8e={left:"right",right:"left",bottom:"top",top:"bottom"};function ED(t){return t.replace(/left|right|bottom|top/g,function(e){return N8e[e]})}var A8e={start:"end",end:"start"};function uY(t){return t.replace(/start|end/g,function(e){return A8e[e]})}function fH(t){var e=ko(t),i=e.pageXOffset,r=e.pageYOffset;return{scrollLeft:i,scrollTop:r}}function mH(t){return WI(Cf(t)).left+fH(t).scrollLeft}function k8e(t,e){var i=ko(t),r=Cf(t),n=i.visualViewport,a=r.clientWidth,s=r.clientHeight,o=0,l=0;if(n){a=n.width,s=n.height;var u=wfe();(u||!u&&e==="fixed")&&(o=n.offsetLeft,l=n.offsetTop)}return{width:a,height:s,x:o+mH(t),y:l}}function O8e(t){var e,i=Cf(t),r=fH(t),n=(e=t.ownerDocument)==null?void 0:e.body,a=Um(i.scrollWidth,i.clientWidth,n?n.scrollWidth:0,n?n.clientWidth:0),s=Um(i.scrollHeight,i.clientHeight,n?n.scrollHeight:0,n?n.clientHeight:0),o=-r.scrollLeft+mH(t),l=-r.scrollTop;return kd(n||i).direction==="rtl"&&(o+=Um(i.clientWidth,n?n.clientWidth:0)-a),{width:a,height:s,x:o,y:l}}function hH(t){var e=kd(t),i=e.overflow,r=e.overflowX,n=e.overflowY;return/auto|scroll|overlay|hidden/.test(i+n+r)}function Pfe(t){return["html","body","#document"].indexOf(Mc(t))>=0?t.ownerDocument.body:el(t)&&hH(t)?t:Pfe(vA(t))}function rb(t,e){var i;e===void 0&&(e=[]);var r=Pfe(t),n=r===((i=t.ownerDocument)==null?void 0:i.body),a=ko(r),s=n?[a].concat(a.visualViewport||[],hH(r)?r:[]):r,o=e.concat(s);return n?o:o.concat(rb(vA(s)))}function m1(t){return Object.assign({},t,{left:t.x,top:t.y,right:t.x+t.width,bottom:t.y+t.height})}function x8e(t,e){var i=WI(t,!1,e==="fixed");return i.top=i.top+t.clientTop,i.left=i.left+t.clientLeft,i.bottom=i.top+t.clientHeight,i.right=i.left+t.clientWidth,i.width=t.clientWidth,i.height=t.clientHeight,i.x=i.left,i.y=i.top,i}function cY(t,e,i){return e===vfe?m1(k8e(t,i)):Qm(e)?x8e(e,i):m1(O8e(Cf(t)))}function F8e(t){var e=rb(vA(t)),i=["absolute","fixed"].indexOf(kd(t).position)>=0,r=i&&el(t)?hT(t):t;return Qm(r)?e.filter(function(n){return Qm(n)&&Sfe(n,r)&&Mc(n)!=="body"}):[]}function L8e(t,e,i,r){var n=e==="clippingParents"?F8e(t):[].concat(e),a=[].concat(n,[i]),s=a[0],o=a.reduce(function(l,u){var c=cY(t,u,r);return l.top=Um(c.top,l.top),l.right=DE(c.right,l.right),l.bottom=DE(c.bottom,l.bottom),l.left=Um(c.left,l.left),l},cY(t,s,r));return o.width=o.right-o.left,o.height=o.bottom-o.top,o.x=o.left,o.y=o.top,o}function Efe(t){var e=t.reference,i=t.element,r=t.placement,n=r?rc(r):null,a=r?zI(r):null,s=e.x+e.width/2-i.width/2,o=e.y+e.height/2-i.height/2,l;switch(n){case qs:l={x:s,y:e.y-i.height};break;case bl:l={x:s,y:e.y+e.height};break;case wl:l={x:e.x+e.width,y:o};break;case Ys:l={x:e.x-i.width,y:o};break;default:l={x:e.x,y:e.y}}var u=n?pH(n):null;if(u!=null){var c=u==="y"?"height":"width";switch(a){case GI:l[u]=l[u]-(e[c]/2-i[c]/2);break;case yw:l[u]=l[u]+(e[c]/2-i[c]/2);break}}return l}function bw(t,e){e===void 0&&(e={});var i=e,r=i.placement,n=r===void 0?t.placement:r,a=i.strategy,s=a===void 0?t.strategy:a,o=i.boundary,l=o===void 0?n8e:o,u=i.rootBoundary,c=u===void 0?vfe:u,d=i.elementContext,p=d===void 0?Iy:d,f=i.altBoundary,m=f===void 0?!1:f,h=i.padding,g=h===void 0?0:h,I=Tfe(typeof g!="number"?g:Dfe(g,mT)),v=p===Iy?a8e:Iy,w=t.rects.popper,y=t.elements[m?v:p],b=L8e(Qm(y)?y:y.contextElement||Cf(t.elements.popper),l,c,s),S=WI(t.elements.reference),U=Efe({reference:S,element:w,placement:n}),T=m1(Object.assign({},w,U)),P=p===Iy?T:S,D={top:b.top-P.top+I.top,bottom:P.bottom-b.bottom+I.bottom,left:b.left-P.left+I.left,right:P.right-b.right+I.right},E=t.modifiersData.offset;if(p===Iy&&E){var R=E[n];Object.keys(D).forEach(function(C){var M=[wl,bl].indexOf(C)>=0?1:-1,N=[qs,bl].indexOf(C)>=0?"y":"x";D[C]+=R[N]*M})}return D}function _8e(t,e){e===void 0&&(e={});var i=e,r=i.placement,n=i.boundary,a=i.rootBoundary,s=i.padding,o=i.flipVariations,l=i.allowedAutoPlacements,u=l===void 0?yfe:l,c=zI(r),d=c?o?sY:sY.filter(function(m){return zI(m)===c}):mT,p=d.filter(function(m){return u.indexOf(m)>=0});p.length===0&&(p=d);var f=p.reduce(function(m,h){return m[h]=bw(t,{placement:h,boundary:n,rootBoundary:a,padding:s})[rc(h)],m},{});return Object.keys(f).sort(function(m,h){return f[m]-f[h]})}function $8e(t){if(rc(t)===uH)return[];var e=ED(t);return[uY(t),e,uY(e)]}function B8e(t){var e=t.state,i=t.options,r=t.name;if(!e.modifiersData[r]._skip){for(var n=i.mainAxis,a=n===void 0?!0:n,s=i.altAxis,o=s===void 0?!0:s,l=i.fallbackPlacements,u=i.padding,c=i.boundary,d=i.rootBoundary,p=i.altBoundary,f=i.flipVariations,m=f===void 0?!0:f,h=i.allowedAutoPlacements,g=e.options.placement,I=rc(g),v=I===g,w=l||(v||!m?[ED(g)]:$8e(g)),y=[g].concat(w).reduce(function(_,B){return _.concat(rc(B)===uH?_8e(e,{placement:B,boundary:c,rootBoundary:d,padding:u,flipVariations:m,allowedAutoPlacements:h}):B)},[]),b=e.rects.reference,S=e.rects.popper,U=new Map,T=!0,P=y[0],D=0;D<y.length;D++){var E=y[D],R=rc(E),C=zI(E)===GI,M=[qs,bl].indexOf(R)>=0,N=M?"width":"height",A=bw(e,{placement:E,boundary:c,rootBoundary:d,altBoundary:p,padding:u}),O=M?C?wl:Ys:C?bl:qs;b[N]>S[N]&&(O=ED(O));var k=ED(O),F=[];if(a&&F.push(A[R]<=0),o&&F.push(A[O]<=0,A[k]<=0),F.every(function(_){return _})){P=E,T=!1;break}U.set(E,F)}if(T)for(var x=m?3:1,L=function(B){var G=y.find(function(j){var K=U.get(j);if(K)return K.slice(0,B).every(function(Y){return Y})});if(G)return P=G,"break"},$=x;$>0;$--){var V=L($);if(V==="break")break}e.placement!==P&&(e.modifiersData[r]._skip=!0,e.placement=P,e.reset=!0)}}const V8e={name:"flip",enabled:!0,phase:"main",fn:B8e,requiresIfExists:["offset"],data:{_skip:!1}};function dY(t,e,i){return i===void 0&&(i={x:0,y:0}),{top:t.top-e.height-i.y,right:t.right-e.width+i.x,bottom:t.bottom-e.height+i.y,left:t.left-e.width-i.x}}function pY(t){return[qs,wl,bl,Ys].some(function(e){return t[e]>=0})}function j8e(t){var e=t.state,i=t.name,r=e.rects.reference,n=e.rects.popper,a=e.modifiersData.preventOverflow,s=bw(e,{elementContext:"reference"}),o=bw(e,{altBoundary:!0}),l=dY(s,r),u=dY(o,n,a),c=pY(l),d=pY(u);e.modifiersData[i]={referenceClippingOffsets:l,popperEscapeOffsets:u,isReferenceHidden:c,hasPopperEscaped:d},e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-reference-hidden":c,"data-popper-escaped":d})}const G8e={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:j8e};function H8e(t,e,i){var r=rc(t),n=[Ys,qs].indexOf(r)>=0?-1:1,a=typeof i=="function"?i(Object.assign({},e,{placement:t})):i,s=a[0],o=a[1];return s=s||0,o=(o||0)*n,[Ys,wl].indexOf(r)>=0?{x:o,y:s}:{x:s,y:o}}function W8e(t){var e=t.state,i=t.options,r=t.name,n=i.offset,a=n===void 0?[0,0]:n,s=yfe.reduce(function(c,d){return c[d]=H8e(d,e.rects,a),c},{}),o=s[e.placement],l=o.x,u=o.y;e.modifiersData.popperOffsets!=null&&(e.modifiersData.popperOffsets.x+=l,e.modifiersData.popperOffsets.y+=u),e.modifiersData[r]=s}const z8e={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:W8e};function q8e(t){var e=t.state,i=t.name;e.modifiersData[i]=Efe({reference:e.rects.reference,element:e.rects.popper,placement:e.placement})}const Y8e={name:"popperOffsets",enabled:!0,phase:"read",fn:q8e,data:{}};function K8e(t){return t==="x"?"y":"x"}function X8e(t){var e=t.state,i=t.options,r=t.name,n=i.mainAxis,a=n===void 0?!0:n,s=i.altAxis,o=s===void 0?!1:s,l=i.boundary,u=i.rootBoundary,c=i.altBoundary,d=i.padding,p=i.tether,f=p===void 0?!0:p,m=i.tetherOffset,h=m===void 0?0:m,g=bw(e,{boundary:l,rootBoundary:u,padding:d,altBoundary:c}),I=rc(e.placement),v=zI(e.placement),w=!v,y=pH(I),b=K8e(y),S=e.modifiersData.popperOffsets,U=e.rects.reference,T=e.rects.popper,P=typeof h=="function"?h(Object.assign({},e.rects,{placement:e.placement})):h,D=typeof P=="number"?{mainAxis:P,altAxis:P}:Object.assign({mainAxis:0,altAxis:0},P),E=e.modifiersData.offset?e.modifiersData.offset[e.placement]:null,R={x:0,y:0};if(S){if(a){var C,M=y==="y"?qs:Ys,N=y==="y"?bl:wl,A=y==="y"?"height":"width",O=S[y],k=O+g[M],F=O-g[N],x=f?-T[A]/2:0,L=v===GI?U[A]:T[A],$=v===GI?-T[A]:-U[A],V=e.elements.arrow,_=f&&V?dH(V):{width:0,height:0},B=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:Ufe(),G=B[M],j=B[N],K=ib(0,U[A],_[A]),Y=w?U[A]/2-x-K-G-D.mainAxis:L-K-G-D.mainAxis,X=w?-U[A]/2+x+K+j+D.mainAxis:$+K+j+D.mainAxis,Z=e.elements.arrow&&hT(e.elements.arrow),J=Z?y==="y"?Z.clientTop||0:Z.clientLeft||0:0,ae=(C=E?.[y])!=null?C:0,te=O+Y-ae-J,ne=O+X-ae,le=ib(f?DE(k,te):k,O,f?Um(F,ne):F);S[y]=le,R[y]=le-O}if(o){var de,pe=y==="x"?qs:Ys,ge=y==="x"?bl:wl,Me=S[b],Pe=b==="y"?"height":"width",Be=Me+g[pe],fe=Me-g[ge],Te=[qs,Ys].indexOf(I)!==-1,ce=(de=E?.[b])!=null?de:0,ye=Te?Be:Me-U[Pe]-T[Pe]-ce+D.altAxis,be=Te?Me+U[Pe]+T[Pe]-ce-D.altAxis:fe,Fe=f&&Te?b8e(ye,Me,be):ib(f?ye:Be,Me,f?be:fe);S[b]=Fe,R[b]=Fe-Me}e.modifiersData[r]=R}}const J8e={name:"preventOverflow",enabled:!0,phase:"main",fn:X8e,requiresIfExists:["offset"]};function Q8e(t){return{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}}function Z8e(t){return t===ko(t)||!el(t)?fH(t):Q8e(t)}function e9e(t){var e=t.getBoundingClientRect(),i=HI(e.width)/t.offsetWidth||1,r=HI(e.height)/t.offsetHeight||1;return i!==1||r!==1}function t9e(t,e,i){i===void 0&&(i=!1);var r=el(e),n=el(e)&&e9e(e),a=Cf(e),s=WI(t,n,i),o={scrollLeft:0,scrollTop:0},l={x:0,y:0};return(r||!r&&!i)&&((Mc(e)!=="body"||hH(a))&&(o=Z8e(e)),el(e)?(l=WI(e,!0),l.x+=e.clientLeft,l.y+=e.clientTop):a&&(l.x=mH(a))),{x:s.left+o.scrollLeft-l.x,y:s.top+o.scrollTop-l.y,width:s.width,height:s.height}}function i9e(t){var e=new Map,i=new Set,r=[];t.forEach(function(a){e.set(a.name,a)});function n(a){i.add(a.name);var s=[].concat(a.requires||[],a.requiresIfExists||[]);s.forEach(function(o){if(!i.has(o)){var l=e.get(o);l&&n(l)}}),r.push(a)}return t.forEach(function(a){i.has(a.name)||n(a)}),r}function r9e(t){var e=i9e(t);return h8e.reduce(function(i,r){return i.concat(e.filter(function(n){return n.phase===r}))},[])}function n9e(t){var e;return function(){return e||(e=new Promise(function(i){Promise.resolve().then(function(){e=void 0,i(t())})})),e}}function a9e(t){var e=t.reduce(function(i,r){var n=i[r.name];return i[r.name]=n?Object.assign({},n,r,{options:Object.assign({},n.options,r.options),data:Object.assign({},n.data,r.data)}):r,i},{});return Object.keys(e).map(function(i){return e[i]})}var fY={placement:"bottom",modifiers:[],strategy:"absolute"};function mY(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return!e.some(function(r){return!(r&&typeof r.getBoundingClientRect=="function")})}function s9e(t){t===void 0&&(t={});var e=t,i=e.defaultModifiers,r=i===void 0?[]:i,n=e.defaultOptions,a=n===void 0?fY:n;return function(o,l,u){u===void 0&&(u=a);var c={placement:"bottom",orderedModifiers:[],options:Object.assign({},fY,a),modifiersData:{},elements:{reference:o,popper:l},attributes:{},styles:{}},d=[],p=!1,f={state:c,setOptions:function(I){var v=typeof I=="function"?I(c.options):I;h(),c.options=Object.assign({},a,c.options,v),c.scrollParents={reference:Qm(o)?rb(o):o.contextElement?rb(o.contextElement):[],popper:rb(l)};var w=r9e(a9e([].concat(r,c.options.modifiers)));return c.orderedModifiers=w.filter(function(y){return y.enabled}),m(),f.update()},forceUpdate:function(){if(!p){var I=c.elements,v=I.reference,w=I.popper;if(mY(v,w)){c.rects={reference:t9e(v,hT(w),c.options.strategy==="fixed"),popper:dH(w)},c.reset=!1,c.placement=c.options.placement,c.orderedModifiers.forEach(function(D){return c.modifiersData[D.name]=Object.assign({},D.data)});for(var y=0;y<c.orderedModifiers.length;y++){if(c.reset===!0){c.reset=!1,y=-1;continue}var b=c.orderedModifiers[y],S=b.fn,U=b.options,T=U===void 0?{}:U,P=b.name;typeof S=="function"&&(c=S({state:c,options:T,name:P,instance:f})||c)}}}},update:n9e(function(){return new Promise(function(g){f.forceUpdate(),g(c)})}),destroy:function(){h(),p=!0}};if(!mY(o,l))return f;f.setOptions(u).then(function(g){!p&&u.onFirstUpdate&&u.onFirstUpdate(g)});function m(){c.orderedModifiers.forEach(function(g){var I=g.name,v=g.options,w=v===void 0?{}:v,y=g.effect;if(typeof y=="function"){var b=y({state:c,name:I,instance:f,options:w}),S=function(){};d.push(b||S)}})}function h(){d.forEach(function(g){return g()}),d=[]}return f}}var o9e=[M8e,Y8e,R8e,bfe,z8e,V8e,J8e,T8e,G8e],l9e=s9e({defaultModifiers:o9e}),u9e="tippy-box",Rfe="tippy-content",c9e="tippy-backdrop",Cfe="tippy-arrow",Mfe="tippy-svg-arrow",Vf={passive:!0,capture:!0},Nfe=function(){return document.body};function Ek(t,e,i){if(Array.isArray(t)){var r=t[e];return r??(Array.isArray(i)?i[e]:i)}return t}function gH(t,e){var i={}.toString.call(t);return i.indexOf("[object")===0&&i.indexOf(e+"]")>-1}function Afe(t,e){return typeof t=="function"?t.apply(void 0,e):t}function hY(t,e){if(e===0)return t;var i;return function(r){clearTimeout(i),i=setTimeout(function(){t(r)},e)}}function d9e(t){return t.split(/\s+/).filter(Boolean)}function wg(t){return[].concat(t)}function gY(t,e){t.indexOf(e)===-1&&t.push(e)}function p9e(t){return t.filter(function(e,i){return t.indexOf(e)===i})}function f9e(t){return t.split("-")[0]}function PE(t){return[].slice.call(t)}function IY(t){return Object.keys(t).reduce(function(e,i){return t[i]!==void 0&&(e[i]=t[i]),e},{})}function nb(){return document.createElement("div")}function yA(t){return["Element","Fragment"].some(function(e){return gH(t,e)})}function m9e(t){return gH(t,"NodeList")}function h9e(t){return gH(t,"MouseEvent")}function g9e(t){return!!(t&&t._tippy&&t._tippy.reference===t)}function I9e(t){return yA(t)?[t]:m9e(t)?PE(t):Array.isArray(t)?t:PE(document.querySelectorAll(t))}function Rk(t,e){t.forEach(function(i){i&&(i.style.transitionDuration=e+"ms")})}function vY(t,e){t.forEach(function(i){i&&i.setAttribute("data-state",e)})}function v9e(t){var e,i=wg(t),r=i[0];return r!=null&&(e=r.ownerDocument)!=null&&e.body?r.ownerDocument:document}function y9e(t,e){var i=e.clientX,r=e.clientY;return t.every(function(n){var a=n.popperRect,s=n.popperState,o=n.props,l=o.interactiveBorder,u=f9e(s.placement),c=s.modifiersData.offset;if(!c)return!0;var d=u==="bottom"?c.top.y:0,p=u==="top"?c.bottom.y:0,f=u==="right"?c.left.x:0,m=u==="left"?c.right.x:0,h=a.top-r+d>l,g=r-a.bottom-p>l,I=a.left-i+f>l,v=i-a.right-m>l;return h||g||I||v})}function Ck(t,e,i){var r=e+"EventListener";["transitionend","webkitTransitionEnd"].forEach(function(n){t[r](n,i)})}function yY(t,e){for(var i=e;i;){var r;if(t.contains(i))return!0;i=i.getRootNode==null||(r=i.getRootNode())==null?void 0:r.host}return!1}var Bu={isTouch:!1},bY=0;function b9e(){Bu.isTouch||(Bu.isTouch=!0,window.performance&&document.addEventListener("mousemove",kfe))}function kfe(){var t=performance.now();t-bY<20&&(Bu.isTouch=!1,document.removeEventListener("mousemove",kfe)),bY=t}function w9e(){var t=document.activeElement;if(g9e(t)){var e=t._tippy;t.blur&&!e.state.isVisible&&t.blur()}}function S9e(){document.addEventListener("touchstart",b9e,Vf),window.addEventListener("blur",w9e)}var U9e=typeof window<"u"&&typeof document<"u",T9e=U9e?!!window.msCrypto:!1,D9e={animateFill:!1,followCursor:!1,inlinePositioning:!1,sticky:!1},P9e={allowHTML:!1,animation:"fade",arrow:!0,content:"",inertia:!1,maxWidth:350,role:"tooltip",theme:"",zIndex:9999},Bl=Object.assign({appendTo:Nfe,aria:{content:"auto",expanded:"auto"},delay:0,duration:[300,250],getReferenceClientRect:null,hideOnClick:!0,ignoreAttributes:!1,interactive:!1,interactiveBorder:2,interactiveDebounce:0,moveTransition:"",offset:[0,10],onAfterUpdate:function(){},onBeforeUpdate:function(){},onCreate:function(){},onDestroy:function(){},onHidden:function(){},onHide:function(){},onMount:function(){},onShow:function(){},onShown:function(){},onTrigger:function(){},onUntrigger:function(){},onClickOutside:function(){},placement:"top",plugins:[],popperOptions:{},render:null,showOnCreate:!1,touch:!0,trigger:"mouseenter focus",triggerTarget:null},D9e,P9e),E9e=Object.keys(Bl),R9e=function(e){var i=Object.keys(e);i.forEach(function(r){Bl[r]=e[r]})};function Ofe(t){var e=t.plugins||[],i=e.reduce(function(r,n){var a=n.name,s=n.defaultValue;if(a){var o;r[a]=t[a]!==void 0?t[a]:(o=Bl[a])!=null?o:s}return r},{});return Object.assign({},t,i)}function C9e(t,e){var i=e?Object.keys(Ofe(Object.assign({},Bl,{plugins:e}))):E9e,r=i.reduce(function(n,a){var s=(t.getAttribute("data-tippy-"+a)||"").trim();if(!s)return n;if(a==="content")n[a]=s;else try{n[a]=JSON.parse(s)}catch{n[a]=s}return n},{});return r}function wY(t,e){var i=Object.assign({},e,{content:Afe(e.content,[t])},e.ignoreAttributes?{}:C9e(t,e.plugins));return i.aria=Object.assign({},Bl.aria,i.aria),i.aria={expanded:i.aria.expanded==="auto"?e.interactive:i.aria.expanded,content:i.aria.content==="auto"?e.interactive?null:"describedby":i.aria.content},i}var M9e=function(){return"innerHTML"};function h1(t,e){t[M9e()]=e}function SY(t){var e=nb();return t===!0?e.className=Cfe:(e.className=Mfe,yA(t)?e.appendChild(t):h1(e,t)),e}function UY(t,e){yA(e.content)?(h1(t,""),t.appendChild(e.content)):typeof e.content!="function"&&(e.allowHTML?h1(t,e.content):t.textContent=e.content)}function g1(t){var e=t.firstElementChild,i=PE(e.children);return{box:e,content:i.find(function(r){return r.classList.contains(Rfe)}),arrow:i.find(function(r){return r.classList.contains(Cfe)||r.classList.contains(Mfe)}),backdrop:i.find(function(r){return r.classList.contains(c9e)})}}function xfe(t){var e=nb(),i=nb();i.className=u9e,i.setAttribute("data-state","hidden"),i.setAttribute("tabindex","-1");var r=nb();r.className=Rfe,r.setAttribute("data-state","hidden"),UY(r,t.props),e.appendChild(i),i.appendChild(r),n(t.props,t.props);function n(a,s){var o=g1(e),l=o.box,u=o.content,c=o.arrow;s.theme?l.setAttribute("data-theme",s.theme):l.removeAttribute("data-theme"),typeof s.animation=="string"?l.setAttribute("data-animation",s.animation):l.removeAttribute("data-animation"),s.inertia?l.setAttribute("data-inertia",""):l.removeAttribute("data-inertia"),l.style.maxWidth=typeof s.maxWidth=="number"?s.maxWidth+"px":s.maxWidth,s.role?l.setAttribute("role",s.role):l.removeAttribute("role"),(a.content!==s.content||a.allowHTML!==s.allowHTML)&&UY(u,t.props),s.arrow?c?a.arrow!==s.arrow&&(l.removeChild(c),l.appendChild(SY(s.arrow))):l.appendChild(SY(s.arrow)):c&&l.removeChild(c)}return{popper:e,onUpdate:n}}xfe.$$tippy=!0;var N9e=1,BT=[],Mk=[];function A9e(t,e){var i=wY(t,Object.assign({},Bl,Ofe(IY(e)))),r,n,a,s=!1,o=!1,l=!1,u=!1,c,d,p,f=[],m=hY(te,i.interactiveDebounce),h,g=N9e++,I=null,v=p9e(i.plugins),w={isEnabled:!0,isVisible:!1,isDestroyed:!1,isMounted:!1,isShown:!1},y={id:g,reference:t,popper:nb(),popperInstance:I,props:i,state:w,plugins:v,clearDelayTimeouts:ye,setProps:be,setContent:Fe,show:we,hide:Ne,hideWithInteractivity:me,enable:Te,disable:ce,unmount:Ee,destroy:Le};if(!i.render)return y;var b=i.render(y),S=b.popper,U=b.onUpdate;S.setAttribute("data-tippy-root",""),S.id="tippy-"+y.id,y.popper=S,t._tippy=y,S._tippy=y;var T=v.map(function(Q){return Q.fn(y)}),P=t.hasAttribute("aria-expanded");return Z(),x(),O(),k("onCreate",[y]),i.showOnCreate&&Be(),S.addEventListener("mouseenter",function(){y.props.interactive&&y.state.isVisible&&y.clearDelayTimeouts()}),S.addEventListener("mouseleave",function(){y.props.interactive&&y.props.trigger.indexOf("mouseenter")>=0&&M().addEventListener("mousemove",m)}),y;function D(){var Q=y.props.touch;return Array.isArray(Q)?Q:[Q,0]}function E(){return D()[0]==="hold"}function R(){var Q;return!!((Q=y.props.render)!=null&&Q.$$tippy)}function C(){return h||t}function M(){var Q=C().parentNode;return Q?v9e(Q):document}function N(){return g1(S)}function A(Q){return y.state.isMounted&&!y.state.isVisible||Bu.isTouch||c&&c.type==="focus"?0:Ek(y.props.delay,Q?0:1,Bl.delay)}function O(Q){Q===void 0&&(Q=!1),S.style.pointerEvents=y.props.interactive&&!Q?"":"none",S.style.zIndex=""+y.props.zIndex}function k(Q,se,oe){if(oe===void 0&&(oe=!0),T.forEach(function(ee){ee[Q]&&ee[Q].apply(ee,se)}),oe){var ue;(ue=y.props)[Q].apply(ue,se)}}function F(){var Q=y.props.aria;if(Q.content){var se="aria-"+Q.content,oe=S.id,ue=wg(y.props.triggerTarget||t);ue.forEach(function(ee){var Se=ee.getAttribute(se);if(y.state.isVisible)ee.setAttribute(se,Se?Se+" "+oe:oe);else{var De=Se&&Se.replace(oe,"").trim();De?ee.setAttribute(se,De):ee.removeAttribute(se)}})}}function x(){if(!(P||!y.props.aria.expanded)){var Q=wg(y.props.triggerTarget||t);Q.forEach(function(se){y.props.interactive?se.setAttribute("aria-expanded",y.state.isVisible&&se===C()?"true":"false"):se.removeAttribute("aria-expanded")})}}function L(){M().removeEventListener("mousemove",m),BT=BT.filter(function(Q){return Q!==m})}function $(Q){if(!(Bu.isTouch&&(l||Q.type==="mousedown"))){var se=Q.composedPath&&Q.composedPath()[0]||Q.target;if(!(y.props.interactive&&yY(S,se))){if(wg(y.props.triggerTarget||t).some(function(oe){return yY(oe,se)})){if(Bu.isTouch||y.state.isVisible&&y.props.trigger.indexOf("click")>=0)return}else k("onClickOutside",[y,Q]);y.props.hideOnClick===!0&&(y.clearDelayTimeouts(),y.hide(),o=!0,setTimeout(function(){o=!1}),y.state.isMounted||G())}}}function V(){l=!0}function _(){l=!1}function B(){var Q=M();Q.addEventListener("mousedown",$,!0),Q.addEventListener("touchend",$,Vf),Q.addEventListener("touchstart",_,Vf),Q.addEventListener("touchmove",V,Vf)}function G(){var Q=M();Q.removeEventListener("mousedown",$,!0),Q.removeEventListener("touchend",$,Vf),Q.removeEventListener("touchstart",_,Vf),Q.removeEventListener("touchmove",V,Vf)}function j(Q,se){Y(Q,function(){!y.state.isVisible&&S.parentNode&&S.parentNode.contains(S)&&se()})}function K(Q,se){Y(Q,se)}function Y(Q,se){var oe=N().box;function ue(ee){ee.target===oe&&(Ck(oe,"remove",ue),se())}if(Q===0)return se();Ck(oe,"remove",d),Ck(oe,"add",ue),d=ue}function X(Q,se,oe){oe===void 0&&(oe=!1);var ue=wg(y.props.triggerTarget||t);ue.forEach(function(ee){ee.addEventListener(Q,se,oe),f.push({node:ee,eventType:Q,handler:se,options:oe})})}function Z(){E()&&(X("touchstart",ae,{passive:!0}),X("touchend",ne,{passive:!0})),d9e(y.props.trigger).forEach(function(Q){if(Q!=="manual")switch(X(Q,ae),Q){case"mouseenter":X("mouseleave",ne);break;case"focus":X(T9e?"focusout":"blur",le);break;case"focusin":X("focusout",le);break}})}function J(){f.forEach(function(Q){var se=Q.node,oe=Q.eventType,ue=Q.handler,ee=Q.options;se.removeEventListener(oe,ue,ee)}),f=[]}function ae(Q){var se,oe=!1;if(!(!y.state.isEnabled||de(Q)||o)){var ue=((se=c)==null?void 0:se.type)==="focus";c=Q,h=Q.currentTarget,x(),!y.state.isVisible&&h9e(Q)&&BT.forEach(function(ee){return ee(Q)}),Q.type==="click"&&(y.props.trigger.indexOf("mouseenter")<0||s)&&y.props.hideOnClick!==!1&&y.state.isVisible?oe=!0:Be(Q),Q.type==="click"&&(s=!oe),oe&&!ue&&fe(Q)}}function te(Q){var se=Q.target,oe=C().contains(se)||S.contains(se);if(!(Q.type==="mousemove"&&oe)){var ue=Pe().concat(S).map(function(ee){var Se,De=ee._tippy,it=(Se=De.popperInstance)==null?void 0:Se.state;return it?{popperRect:ee.getBoundingClientRect(),popperState:it,props:i}:null}).filter(Boolean);y9e(ue,Q)&&(L(),fe(Q))}}function ne(Q){var se=de(Q)||y.props.trigger.indexOf("click")>=0&&s;if(!se){if(y.props.interactive){y.hideWithInteractivity(Q);return}fe(Q)}}function le(Q){y.props.trigger.indexOf("focusin")<0&&Q.target!==C()||y.props.interactive&&Q.relatedTarget&&S.contains(Q.relatedTarget)||fe(Q)}function de(Q){return Bu.isTouch?E()!==Q.type.indexOf("touch")>=0:!1}function pe(){ge();var Q=y.props,se=Q.popperOptions,oe=Q.placement,ue=Q.offset,ee=Q.getReferenceClientRect,Se=Q.moveTransition,De=R()?g1(S).arrow:null,it=ee?{getBoundingClientRect:ee,contextElement:ee.contextElement||C()}:t,Ue={name:"$$tippy",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:function(qe){var bi=qe.state;if(R()){var oi=N(),nn=oi.box;["placement","reference-hidden","escaped"].forEach(function(Fo){Fo==="placement"?nn.setAttribute("data-placement",bi.placement):bi.attributes.popper["data-popper-"+Fo]?nn.setAttribute("data-"+Fo,""):nn.removeAttribute("data-"+Fo)}),bi.attributes.popper={}}}},ut=[{name:"offset",options:{offset:ue}},{name:"preventOverflow",options:{padding:{top:2,bottom:2,left:5,right:5}}},{name:"flip",options:{padding:5}},{name:"computeStyles",options:{adaptive:!Se}},Ue];R()&&De&&ut.push({name:"arrow",options:{element:De,padding:3}}),ut.push.apply(ut,se?.modifiers||[]),y.popperInstance=l9e(it,S,Object.assign({},se,{placement:oe,onFirstUpdate:p,modifiers:ut}))}function ge(){y.popperInstance&&(y.popperInstance.destroy(),y.popperInstance=null)}function Me(){var Q=y.props.appendTo,se,oe=C();y.props.interactive&&Q===Nfe||Q==="parent"?se=oe.parentNode:se=Afe(Q,[oe]),se.contains(S)||se.appendChild(S),y.state.isMounted=!0,pe()}function Pe(){return PE(S.querySelectorAll("[data-tippy-root]"))}function Be(Q){y.clearDelayTimeouts(),Q&&k("onTrigger",[y,Q]),B();var se=A(!0),oe=D(),ue=oe[0],ee=oe[1];Bu.isTouch&&ue==="hold"&&ee&&(se=ee),se?r=setTimeout(function(){y.show()},se):y.show()}function fe(Q){if(y.clearDelayTimeouts(),k("onUntrigger",[y,Q]),!y.state.isVisible){G();return}if(!(y.props.trigger.indexOf("mouseenter")>=0&&y.props.trigger.indexOf("click")>=0&&["mouseleave","mousemove"].indexOf(Q.type)>=0&&s)){var se=A(!1);se?n=setTimeout(function(){y.state.isVisible&&y.hide()},se):a=requestAnimationFrame(function(){y.hide()})}}function Te(){y.state.isEnabled=!0}function ce(){y.hide(),y.state.isEnabled=!1}function ye(){clearTimeout(r),clearTimeout(n),cancelAnimationFrame(a)}function be(Q){if(!y.state.isDestroyed){k("onBeforeUpdate",[y,Q]),J();var se=y.props,oe=wY(t,Object.assign({},se,IY(Q),{ignoreAttributes:!0}));y.props=oe,Z(),se.interactiveDebounce!==oe.interactiveDebounce&&(L(),m=hY(te,oe.interactiveDebounce)),se.triggerTarget&&!oe.triggerTarget?wg(se.triggerTarget).forEach(function(ue){ue.removeAttribute("aria-expanded")}):oe.triggerTarget&&t.removeAttribute("aria-expanded"),x(),O(),U&&U(se,oe),y.popperInstance&&(pe(),Pe().forEach(function(ue){requestAnimationFrame(ue._tippy.popperInstance.forceUpdate)})),k("onAfterUpdate",[y,Q])}}function Fe(Q){y.setProps({content:Q})}function we(){var Q=y.state.isVisible,se=y.state.isDestroyed,oe=!y.state.isEnabled,ue=Bu.isTouch&&!y.props.touch,ee=Ek(y.props.duration,0,Bl.duration);if(!(Q||se||oe||ue)&&!C().hasAttribute("disabled")&&(k("onShow",[y],!1),y.props.onShow(y)!==!1)){if(y.state.isVisible=!0,R()&&(S.style.visibility="visible"),O(),B(),y.state.isMounted||(S.style.transition="none"),R()){var Se=N(),De=Se.box,it=Se.content;Rk([De,it],0)}p=function(){var ut;if(!(!y.state.isVisible||u)){if(u=!0,S.offsetHeight,S.style.transition=y.props.moveTransition,R()&&y.props.animation){var yi=N(),qe=yi.box,bi=yi.content;Rk([qe,bi],ee),vY([qe,bi],"visible")}F(),x(),gY(Mk,y),(ut=y.popperInstance)==null||ut.forceUpdate(),k("onMount",[y]),y.props.animation&&R()&&K(ee,function(){y.state.isShown=!0,k("onShown",[y])})}},Me()}}function Ne(){var Q=!y.state.isVisible,se=y.state.isDestroyed,oe=!y.state.isEnabled,ue=Ek(y.props.duration,1,Bl.duration);if(!(Q||se||oe)&&(k("onHide",[y],!1),y.props.onHide(y)!==!1)){if(y.state.isVisible=!1,y.state.isShown=!1,u=!1,s=!1,R()&&(S.style.visibility="hidden"),L(),G(),O(!0),R()){var ee=N(),Se=ee.box,De=ee.content;y.props.animation&&(Rk([Se,De],ue),vY([Se,De],"hidden"))}F(),x(),y.props.animation?R()&&j(ue,y.unmount):y.unmount()}}function me(Q){M().addEventListener("mousemove",m),gY(BT,m),m(Q)}function Ee(){y.state.isVisible&&y.hide(),y.state.isMounted&&(ge(),Pe().forEach(function(Q){Q._tippy.unmount()}),S.parentNode&&S.parentNode.removeChild(S),Mk=Mk.filter(function(Q){return Q!==y}),y.state.isMounted=!1,k("onHidden",[y]))}function Le(){y.state.isDestroyed||(y.clearDelayTimeouts(),y.unmount(),J(),delete t._tippy,y.state.isDestroyed=!0,k("onDestroy",[y]))}}function gT(t,e){e===void 0&&(e={});var i=Bl.plugins.concat(e.plugins||[]);S9e();var r=Object.assign({},e,{plugins:i}),n=I9e(t),a=n.reduce(function(s,o){var l=o&&A9e(o,r);return l&&s.push(l),s},[]);return yA(t)?a[0]:a}gT.defaultProps=Bl;gT.setDefaultProps=R9e;gT.currentInput=Bu;Object.assign({},bfe,{effect:function(e){var i=e.state,r={popper:{position:i.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};Object.assign(i.elements.popper.style,r.popper),i.styles=r,i.elements.arrow&&Object.assign(i.elements.arrow.style,r.arrow)}});gT.setDefaultProps({render:xfe});function TY(t){const e=document.createElement("button");return e.className="button font-medium",t.disabled&&(e.disabled=!0),t.class&&e.classList.add(t.class),t.id&&(e.id=t.id),t.location===xm?e.style.marginLeft="1em":e.style.marginRight="1em",t.intent&&e.classList.add(t.intent),t.toolTip?.content&&gT(e,t.toolTip),e.innerHTML=t.label,t.visible===!1&&(e.style.display=Go),e}const k9e=({target:t})=>(e=[])=>{t.style.backgroundColor=e?.length?"var(--chc-active-bg)":VO;const i=(r,n,a)=>{const s=t.getElementsByClassName(`options_${r}`)[0];s&&(s.style.display=e?.length?n:a)};i(BO,UT,Go),i(Fp,Go,UT),i(Gi,Go,UT),i(xm,Go,UT)};function O9e(t){const{table:e,targetClassName:i,items:r=[],onSelection:n}=t,a=!!t.target,s=t.target||i&&document.getElementsByClassName(i)?.[0];if(!s)return{};let o=0,l=0;const u={},c={};let d;if(a){Jf(s);const I=x9e();Object.assign(u,I.elements),s.appendChild(I.anchor)}const p=Object.assign({},...[BO,Fp,Gi,xm,zW].map(I=>{const v=s.getElementsByClassName(`options_${I}`)?.[0];return Jf(v),{[I]:v}}).filter(Boolean)),f=k9e({target:s}),m=(I,v)=>{Hu(v.onClick)&&(I.stopPropagation(),!v.disabled&&v.onClick(I,e),v.stateChange&&f())},h={onClick:()=>{},location:xm};for(const I of r){const v={...h};jO(I)&&Object.assign(v,I);const w=p[v.location];if(!w){console.log(v.location,p);continue}if(v.location===BO&&(o+=1),v.location===zW){if(Hu(v.headerClick)){const y=s.getElementsByClassName("panelHeader")[0];y&&(y.onclick=v.headerClick)}l+=1}if(!v.hide&&(v.input||v.placeholder||v.search)){const y=document.createElement("p");y.style.marginRight="1em",y.className=`control ${v.search?"has-icons-left has-icons-right":""}`;const b=document.createElement("input");if(v.focus&&(d=b),b.className="input font-medium",b.setAttribute("type","text"),b.setAttribute("autocomplete","cc-number"),b.setAttribute("placeholder",I.placeholder||VO),v.id&&(c[v.id]=b),v.id&&b.setAttribute("id",v.id),v.onKeyDown&&b.addEventListener("keydown",S=>v.onKeyDown(S,v)),v.onChange&&b.addEventListener("change",S=>v.onChange(S,v)),v.onKeyUp&&b.addEventListener("keyup",S=>{v.clearSearch&&S.key==="Escape"&&(S.stopPropagation(),b.value="",v.clearSearch()),v.onKeyUp(S,v)}),v.class&&b.classList.add(v.class),v.visible===!1&&(y.style.display=Go),v.value&&(b.value=v.value),y.appendChild(b),v.search){const S=document.createElement("span");if(S.className="icon is-small is-left font-medium",S.innerHTML='<i class="fa-solid fa-magnifying-glass"></i>',y.appendChild(S),Hu(v.clearSearch)){const U=document.createElement("span");U.className="icon is-small is-right font-medium",U.innerHTML='<i class="fa-solid fa-circle-xmark" style="color: #dddada; pointer-events: all; cursor: pointer"></i>',U.onclick=T=>{T.stopPropagation(),b.value="",v.clearSearch()},y.appendChild(U)}}if(I.validator){const S=document.createElement("p");S.className="help font-medium",y.appendChild(S),b.addEventListener("input",U=>r8e(I,U,b,S,I.validator))}v.id&&(u[v.id]=y,y.id=v.id),w?.appendChild(y);continue}if(!v.hide&&v.text){const y=document.createElement("div");y.className="font-medium",v.id&&(u[v.id]=y,y.id=v.id),y.innerHTML=v.text,y.onclick=b=>m(b,v),w?.appendChild(y);continue}if(!(!v.id&&(!v?.label||v.hide))){if(v.options){const y=lm({target:w,button:v,stateChange:f});v.visible===!1&&(y.style.display=Go),v.id&&(u[v.id]=y)}else if(jO(v.selection)){const{selection:{options:y,actions:b},actionPlacement:S,threshold:U=8,...T}=v;if(y?.length<U){y.length&&(S===qW?y.unshift({divider:!0}):y.push({divider:!0})),b.forEach(E=>{const{label:R,...C}=E,M={...C,label:`<p style="font-weight: bold">${R}</p>`};S===qW?y.unshift(M):y.push(M)});const P={...T,options:y},D=lm({target:w,button:P,stateChange:f});P.visible===!1&&(D.style.display=Go),P.id&&(u[v.id]=D)}else{const P=TY(v);P.onclick=D=>{D.stopPropagation()},v.id&&(u[v.id]=P),w?.appendChild(P)}}else{const y=TY(v);y.onclick=b=>m(b,v),v.id&&(u[v.id]=y),w?.appendChild(y)}(!v?.label||v.hide)&&(u[v.id].style.display=Go)}}const g=s.getElementsByClassName("panelHeader")[0];return g&&(g.style.display=l?VO:Go),e?.on("rowSelectionChanged",(I,v)=>{Hu(n)&&n(v),o&&f(v)}),f(),d&&setTimeout(()=>d.focus(),200),{elements:u,inputs:c}}function x9e(){const t=document.createElement("div");t.className="panel_container flexcol flexcenter";const e=document.createElement("div");e.className="panelHeader options_header",e.style.display=Go,t.appendChild(e);const i=document.createElement("div");i.className=OCe,i.style.flexWrap="wrap-reverse;";const r={optionsOverlay:document.createElement("div"),optionsLeft:document.createElement("div"),optionsCenter:document.createElement("div"),optionsRight:document.createElement("div")};r.optionsOverlay.className="options_overlay",r.optionsCenter.className="options_center",r.optionsRight.className="options_right",r.optionsLeft.className="options_left";for(const n of Object.values(r))i.appendChild(n);return t.appendChild(i),{elements:r,anchor:t,header:e}}function F9e(t){const e=gOe(t),i=[{onKeyDown:n=>n.keyCode===8&&n.target.value.length===1&&e(""),onChange:n=>e(n.target.value),onKeyUp:n=>e(n.target.value),clearSearch:()=>e(""),placeholder:"Search tournaments",location:Fp,search:!0}],r=document.getElementById(FY);O9e({target:r,items:i})}function L9e(t){const e=document.createElement("span"),i=document.createElement("table"),r=t.getValue();i.style.width="400px";const n="4em",a=document.createElement("tr"),s=r.tournamentImageURL||r.onlineResources?.find(({name:u,resourceType:c})=>u==="tournamentImage"&&c==="URL")?.identifier,o=s?`<img src='${s}' style='width: ${n}' alt=''>`:"",l=`<td style='min-width: ${n}'>${o}</td><td><div style='margin-left: 1em'><strong style='font-size: 1.5em'>${r.tournamentName}</strong></div><div style='margin-left: 1em'>${r.startDate} / ${r.endDate}</div></td>`;return a.innerHTML=l,i.appendChild(a),e.appendChild(i),e}const dd={};function _9e(){return[{formatter:L9e,cellClick:(e,i)=>{const r=i.getRow().getData().tournamentId;if(r){const n=`/${AE}/${r}`;dd.router.navigate(n)}},field:"tournament",headerSort:!1,resizable:!0,minWidth:250,widthGrow:3}]}function $9e({providerAbbr:t}){const e=o=>console.log("Network error",{error:o});let i;const r=({providerAbbr:o})=>{setTimeout(()=>{const u=c=>c?.data?.calendar&&i.replaceData(c.data.calendar);KO({providerAbbr:o}).then(u,e)},1e3)},n=_9e(),a=o=>{KC({anchorId:$k});const l=document.getElementById($k);i=new BS(l,{height:window.innerHeight*.9,placeholder:"No tournaments",index:"tournament.tournamentId",headerVisible:!1,layout:"fitColumns",reactiveData:!0,data:o,columns:n}),i.on("tableBuilt",()=>{F9e(i)})},s=o=>{o.tournaments.sort((l,u)=>new Date(u.tournament.startDate).getTime()-new Date(l.tournament.startDate).getTime()),a(o.tournaments)};if(t){const o=l=>{l?.data?.calendar&&s(l.data.calendar)};KO({providerAbbr:t}).then(o,e)}return{table:i,replaceTableData:r}}function ab(t){return`tournament_${t.toLowerCase()}`}function IH(t){return`tab_tournament_${t.toLowerCase()}`}function B9e({startDate:t,endDate:e}){const i=new Date(t),r=new Date(e),n=["January","February","March","April","May","June","July","August","September","October","November","December"],a=i.getDate()===r.getDate(),s=i.getFullYear()===r.getFullYear(),o=s&&i.getMonth()===r.getMonth(),l=u=>[u.getFullYear(),u.getMonth()+1,u.getDate()].join("/");return a&&s&&o?`${n[i.getMonth()]} ${i.getDate()}, ${i.getFullYear()}`:s&&o?`${n[i.getMonth()]} ${i.getDate()}-${r.getDate()}, ${i.getFullYear()}`:s?`${n[i.getMonth()]} ${i.getDate()} - ${n[r.getMonth()]} ${r.getDate()}, ${i.getFullYear()}`:`${l(i)} - ${l(r)}`}async function V9e(t,e){const i=document.getElementById(ume);Jf(i);const r=t?.data?.tournamentInfo??{},n=r.onlineResources?.find(d=>d.name==="tournamentImage"),a=document.getElementById(LY);if(n?.identifier?a.innerHTML=`<img src="${n.identifier}" alt="${r.name}" style="max-height: 20em" />`:Jf(a),r.tournamentName){const d=document.getElementById(xY),p=`<h1>${r.tournamentName}</h1>`,f=`<h2>${B9e(r)}</h2>`;d.innerHTML=`${p}${f}`}const s=document.getElementById(ab("Info")),o=!!r.notes;o?(s.innerHTML=r.notes,Ok("Info")):(Jf(s),xk("Info"));const l=!!r.eventInfo?.length;if(l){const d=r.tournamentId,p=document.getElementById(ab("Events"));Jf(p);const f=document.createElement("div"),m=document.createElement("div");m.id="flightDisplay";const h=e?.eventId,g=h?Math.max(r.eventInfo.findIndex(S=>S.eventId===h),0):0,I=r.eventInfo.map(({eventId:S,eventName:U},T)=>({onClick:()=>{Hg({tournamentId:d,eventId:S}),aY({tournamentId:d,eventId:S,header:f,flightDisplay:m,displayFormat:"roundsColumns"})},isActive:T===g,label:U,close:!0})),v={label:r.eventInfo[g].eventName,options:I,id:"eventButton",modifyLabel:!0,selection:!0,location:Fp},y=lm({button:v,stateChange:()=>{document.getElementById("structureButton")?.remove(),document.getElementById("flightButton")?.remove()}}),b=r.eventInfo[g].eventId;f.className="block",f.appendChild(y),p.appendChild(f),p.appendChild(m),aY({tournamentId:d,eventId:b,header:f,flightDisplay:m,displayFormat:"roundsColumns",drawId:e?.drawId,structureId:e?.structureId}),Ok("Events")}else xk("Events");const u=!!r.publishState?.orderOfPlay?.published;if(u){const d=document.getElementById(ab("Schedule")),p=document.createElement("div");p.style.width="100%",p.className="block",p.id="scheduleHeader",d.appendChild(p);const f=document.createElement("div");f.id="tournamentSchedule",d.appendChild(f),Ok("Schedule")}else xk("Schedule");let c;e?.tab==="Schedule"&&u?c="Schedule":e?.tab==="Events"&&l||e?.eventId&&l?c="Events":o?c="Info":l&&(c="Events"),c&&Qfe(c)}var I1="http://www.w3.org/1999/xhtml";const DY={svg:"http://www.w3.org/2000/svg",xhtml:I1,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Ffe(t){var e=t+="",i=e.indexOf(":");return i>=0&&(e=t.slice(0,i))!=="xmlns"&&(t=t.slice(i+1)),DY.hasOwnProperty(e)?{space:DY[e],local:t}:t}function j9e(t){return function(){var e=this.ownerDocument,i=this.namespaceURI;return i===I1&&e.documentElement.namespaceURI===I1?e.createElement(t):e.createElementNS(i,t)}}function G9e(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function vH(t){var e=Ffe(t);return(e.local?G9e:j9e)(e)}function H9e(){}function Lfe(t){return t==null?H9e:function(){return this.querySelector(t)}}function W9e(t){typeof t!="function"&&(t=Lfe(t));for(var e=this._groups,i=e.length,r=new Array(i),n=0;n<i;++n)for(var a=e[n],s=a.length,o=r[n]=new Array(s),l,u,c=0;c<s;++c)(l=a[c])&&(u=t.call(l,l.__data__,c,a))&&("__data__"in l&&(u.__data__=l.__data__),o[c]=u);return new Sl(r,this._parents)}function z9e(t){return t==null?[]:Array.isArray(t)?t:Array.from(t)}function q9e(){return[]}function Y9e(t){return t==null?q9e:function(){return this.querySelectorAll(t)}}function K9e(t){return function(){return z9e(t.apply(this,arguments))}}function X9e(t){typeof t=="function"?t=K9e(t):t=Y9e(t);for(var e=this._groups,i=e.length,r=[],n=[],a=0;a<i;++a)for(var s=e[a],o=s.length,l,u=0;u<o;++u)(l=s[u])&&(r.push(t.call(l,l.__data__,u,s)),n.push(l));return new Sl(r,n)}function J9e(t){return function(){return this.matches(t)}}function _fe(t){return function(e){return e.matches(t)}}var Q9e=Array.prototype.find;function Z9e(t){return function(){return Q9e.call(this.children,t)}}function eXe(){return this.firstElementChild}function tXe(t){return this.select(t==null?eXe:Z9e(typeof t=="function"?t:_fe(t)))}var iXe=Array.prototype.filter;function rXe(){return Array.from(this.children)}function nXe(t){return function(){return iXe.call(this.children,t)}}function aXe(t){return this.selectAll(t==null?rXe:nXe(typeof t=="function"?t:_fe(t)))}function sXe(t){typeof t!="function"&&(t=J9e(t));for(var e=this._groups,i=e.length,r=new Array(i),n=0;n<i;++n)for(var a=e[n],s=a.length,o=r[n]=[],l,u=0;u<s;++u)(l=a[u])&&t.call(l,l.__data__,u,a)&&o.push(l);return new Sl(r,this._parents)}function $fe(t){return new Array(t.length)}function oXe(){return new Sl(this._enter||this._groups.map($fe),this._parents)}function EE(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}EE.prototype={constructor:EE,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};function lXe(t){return function(){return t}}function uXe(t,e,i,r,n,a){for(var s=0,o,l=e.length,u=a.length;s<u;++s)(o=e[s])?(o.__data__=a[s],r[s]=o):i[s]=new EE(t,a[s]);for(;s<l;++s)(o=e[s])&&(n[s]=o)}function cXe(t,e,i,r,n,a,s){var o,l,u=new Map,c=e.length,d=a.length,p=new Array(c),f;for(o=0;o<c;++o)(l=e[o])&&(p[o]=f=s.call(l,l.__data__,o,e)+"",u.has(f)?n[o]=l:u.set(f,l));for(o=0;o<d;++o)f=s.call(t,a[o],o,a)+"",(l=u.get(f))?(r[o]=l,l.__data__=a[o],u.delete(f)):i[o]=new EE(t,a[o]);for(o=0;o<c;++o)(l=e[o])&&u.get(p[o])===l&&(n[o]=l)}function dXe(t){return t.__data__}function pXe(t,e){if(!arguments.length)return Array.from(this,dXe);var i=e?cXe:uXe,r=this._parents,n=this._groups;typeof t!="function"&&(t=lXe(t));for(var a=n.length,s=new Array(a),o=new Array(a),l=new Array(a),u=0;u<a;++u){var c=r[u],d=n[u],p=d.length,f=fXe(t.call(c,c&&c.__data__,u,r)),m=f.length,h=o[u]=new Array(m),g=s[u]=new Array(m),I=l[u]=new Array(p);i(c,d,h,g,I,f,e);for(var v=0,w=0,y,b;v<m;++v)if(y=h[v]){for(v>=w&&(w=v+1);!(b=g[w])&&++w<m;);y._next=b||null}}return s=new Sl(s,r),s._enter=o,s._exit=l,s}function fXe(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function mXe(){return new Sl(this._exit||this._groups.map($fe),this._parents)}function hXe(t,e,i){var r=this.enter(),n=this,a=this.exit();return typeof t=="function"?(r=t(r),r&&(r=r.selection())):r=r.append(t+""),e!=null&&(n=e(n),n&&(n=n.selection())),i==null?a.remove():i(a),r&&n?r.merge(n).order():n}function gXe(t){for(var e=t.selection?t.selection():t,i=this._groups,r=e._groups,n=i.length,a=r.length,s=Math.min(n,a),o=new Array(n),l=0;l<s;++l)for(var u=i[l],c=r[l],d=u.length,p=o[l]=new Array(d),f,m=0;m<d;++m)(f=u[m]||c[m])&&(p[m]=f);for(;l<n;++l)o[l]=i[l];return new Sl(o,this._parents)}function IXe(){for(var t=this._groups,e=-1,i=t.length;++e<i;)for(var r=t[e],n=r.length-1,a=r[n],s;--n>=0;)(s=r[n])&&(a&&s.compareDocumentPosition(a)^4&&a.parentNode.insertBefore(s,a),a=s);return this}function vXe(t){t||(t=yXe);function e(d,p){return d&&p?t(d.__data__,p.__data__):!d-!p}for(var i=this._groups,r=i.length,n=new Array(r),a=0;a<r;++a){for(var s=i[a],o=s.length,l=n[a]=new Array(o),u,c=0;c<o;++c)(u=s[c])&&(l[c]=u);l.sort(e)}return new Sl(n,this._parents).order()}function yXe(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function bXe(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this}function wXe(){return Array.from(this)}function SXe(){for(var t=this._groups,e=0,i=t.length;e<i;++e)for(var r=t[e],n=0,a=r.length;n<a;++n){var s=r[n];if(s)return s}return null}function UXe(){let t=0;for(const e of this)++t;return t}function TXe(){return!this.node()}function DXe(t){for(var e=this._groups,i=0,r=e.length;i<r;++i)for(var n=e[i],a=0,s=n.length,o;a<s;++a)(o=n[a])&&t.call(o,o.__data__,a,n);return this}function PXe(t){return function(){this.removeAttribute(t)}}function EXe(t){return function(){this.removeAttributeNS(t.space,t.local)}}function RXe(t,e){return function(){this.setAttribute(t,e)}}function CXe(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function MXe(t,e){return function(){var i=e.apply(this,arguments);i==null?this.removeAttribute(t):this.setAttribute(t,i)}}function NXe(t,e){return function(){var i=e.apply(this,arguments);i==null?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,i)}}function AXe(t,e){var i=Ffe(t);if(arguments.length<2){var r=this.node();return i.local?r.getAttributeNS(i.space,i.local):r.getAttribute(i)}return this.each((e==null?i.local?EXe:PXe:typeof e=="function"?i.local?NXe:MXe:i.local?CXe:RXe)(i,e))}function Bfe(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function kXe(t){return function(){this.style.removeProperty(t)}}function OXe(t,e,i){return function(){this.style.setProperty(t,e,i)}}function xXe(t,e,i){return function(){var r=e.apply(this,arguments);r==null?this.style.removeProperty(t):this.style.setProperty(t,r,i)}}function FXe(t,e,i){return arguments.length>1?this.each((e==null?kXe:typeof e=="function"?xXe:OXe)(t,e,i??"")):LXe(this.node(),t)}function LXe(t,e){return t.style.getPropertyValue(e)||Bfe(t).getComputedStyle(t,null).getPropertyValue(e)}function _Xe(t){return function(){delete this[t]}}function $Xe(t,e){return function(){this[t]=e}}function BXe(t,e){return function(){var i=e.apply(this,arguments);i==null?delete this[t]:this[t]=i}}function VXe(t,e){return arguments.length>1?this.each((e==null?_Xe:typeof e=="function"?BXe:$Xe)(t,e)):this.node()[t]}function Vfe(t){return t.trim().split(/^|\s+/)}function yH(t){return t.classList||new jfe(t)}function jfe(t){this._node=t,this._names=Vfe(t.getAttribute("class")||"")}jfe.prototype={add:function(t){var e=this._names.indexOf(t);e<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};function Gfe(t,e){for(var i=yH(t),r=-1,n=e.length;++r<n;)i.add(e[r])}function Hfe(t,e){for(var i=yH(t),r=-1,n=e.length;++r<n;)i.remove(e[r])}function jXe(t){return function(){Gfe(this,t)}}function GXe(t){return function(){Hfe(this,t)}}function HXe(t,e){return function(){(e.apply(this,arguments)?Gfe:Hfe)(this,t)}}function WXe(t,e){var i=Vfe(t+"");if(arguments.length<2){for(var r=yH(this.node()),n=-1,a=i.length;++n<a;)if(!r.contains(i[n]))return!1;return!0}return this.each((typeof e=="function"?HXe:e?jXe:GXe)(i,e))}function zXe(){this.textContent=""}function qXe(t){return function(){this.textContent=t}}function YXe(t){return function(){var e=t.apply(this,arguments);this.textContent=e??""}}function KXe(t){return arguments.length?this.each(t==null?zXe:(typeof t=="function"?YXe:qXe)(t)):this.node().textContent}function XXe(){this.innerHTML=""}function JXe(t){return function(){this.innerHTML=t}}function QXe(t){return function(){var e=t.apply(this,arguments);this.innerHTML=e??""}}function ZXe(t){return arguments.length?this.each(t==null?XXe:(typeof t=="function"?QXe:JXe)(t)):this.node().innerHTML}function eJe(){this.nextSibling&&this.parentNode.appendChild(this)}function tJe(){return this.each(eJe)}function iJe(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function rJe(){return this.each(iJe)}function nJe(t){var e=typeof t=="function"?t:vH(t);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function aJe(){return null}function sJe(t,e){var i=typeof t=="function"?t:vH(t),r=e==null?aJe:typeof e=="function"?e:Lfe(e);return this.select(function(){return this.insertBefore(i.apply(this,arguments),r.apply(this,arguments)||null)})}function oJe(){var t=this.parentNode;t&&t.removeChild(this)}function lJe(){return this.each(oJe)}function uJe(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function cJe(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function dJe(t){return this.select(t?cJe:uJe)}function pJe(t){return arguments.length?this.property("__data__",t):this.node().__data__}function fJe(t){return function(e){t.call(this,e,this.__data__)}}function mJe(t){return t.trim().split(/^|\s+/).map(function(e){var i="",r=e.indexOf(".");return r>=0&&(i=e.slice(r+1),e=e.slice(0,r)),{type:e,name:i}})}function hJe(t){return function(){var e=this.__on;if(e){for(var i=0,r=-1,n=e.length,a;i<n;++i)a=e[i],(!t.type||a.type===t.type)&&a.name===t.name?this.removeEventListener(a.type,a.listener,a.options):e[++r]=a;++r?e.length=r:delete this.__on}}}function gJe(t,e,i){return function(){var r=this.__on,n,a=fJe(e);if(r){for(var s=0,o=r.length;s<o;++s)if((n=r[s]).type===t.type&&n.name===t.name){this.removeEventListener(n.type,n.listener,n.options),this.addEventListener(n.type,n.listener=a,n.options=i),n.value=e;return}}this.addEventListener(t.type,a,i),n={type:t.type,name:t.name,value:e,listener:a,options:i},r?r.push(n):this.__on=[n]}}function IJe(t,e,i){var r=mJe(t+""),n,a=r.length,s;if(arguments.length<2){var o=this.node().__on;if(o){for(var l=0,u=o.length,c;l<u;++l)for(n=0,c=o[l];n<a;++n)if((s=r[n]).type===c.type&&s.name===c.name)return c.value}return}for(o=e?gJe:hJe,n=0;n<a;++n)this.each(o(r[n],e,i));return this}function Wfe(t,e,i){var r=Bfe(t),n=r.CustomEvent;typeof n=="function"?n=new n(e,i):(n=r.document.createEvent("Event"),i?(n.initEvent(e,i.bubbles,i.cancelable),n.detail=i.detail):n.initEvent(e,!1,!1)),t.dispatchEvent(n)}function vJe(t,e){return function(){return Wfe(this,t,e)}}function yJe(t,e){return function(){return Wfe(this,t,e.apply(this,arguments))}}function bJe(t,e){return this.each((typeof e=="function"?yJe:vJe)(t,e))}function*wJe(){for(var t=this._groups,e=0,i=t.length;e<i;++e)for(var r=t[e],n=0,a=r.length,s;n<a;++n)(s=r[n])&&(yield s)}var SJe=[null];function Sl(t,e){this._groups=t,this._parents=e}function UJe(){return this}Sl.prototype={constructor:Sl,select:W9e,selectAll:X9e,selectChild:tXe,selectChildren:aXe,filter:sXe,data:pXe,enter:oXe,exit:mXe,join:hXe,merge:gXe,selection:UJe,order:IXe,sort:vXe,call:bXe,nodes:wXe,node:SXe,size:UXe,empty:TXe,each:DXe,attr:AXe,style:FXe,property:VXe,classed:WXe,text:KXe,html:ZXe,raise:tJe,lower:rJe,append:nJe,insert:sJe,remove:lJe,clone:dJe,datum:pJe,on:IJe,dispatch:bJe,[Symbol.iterator]:wJe};function TJe(t){return typeof t=="string"?new Sl([[document.querySelector(t)]],[document.documentElement]):new Sl([[t]],SJe)}function DJe(t){return TJe(vH(t).call(document.documentElement))}function PJe(t={}){const{maxWidth:e="450px",color:i="#000000",strokeWidth:r=5,lineWidth:n=5,fill:a="none",className:s="courthive-logo",serviceLinePosition:o=.3,centerMarkLength:l=12}=t,u=n??r,c=100,d=Math.sqrt(3),p=c*d/2,f=c*d,m=c/2,h=r,g=`M 0,${-m} L ${-p},${-c} L ${-f},${-m} L ${-f},${m} L ${-p},${c} L 0,${m}`,I=`M 0,${-m} L ${p},${-c} L ${f},${-m} L ${f},${m} L ${p},${c} L 0,${m}`,v=o*p,w=-p-v,y=p+v,b=-c+v/d,S=c-v/d,U=DJe("svg").attr("viewBox",`${-f-h} ${-c-h} ${2*f+2*h} ${2*c+2*h}`).attr("xmlns","http://www.w3.org/2000/svg").attr("class",s).style("width","100%").style("max-width",e),T=U.append("g").attr("class","logo-group"),P="stroke-width",D="court-marking";return T.append("path").attr("d",g).attr("fill",a).attr("stroke",i).attr(P,r).attr("stroke-linejoin","miter").attr("stroke-linecap","round"),T.append("path").attr("d",I).attr("fill",a).attr("stroke",i).attr(P,r).attr("stroke-linejoin","miter").attr("stroke-linecap","round"),T.append("line").attr("class",D).attr("x1",0).attr("y1",-m).attr("x2",0).attr("y2",m).attr("stroke",i).attr(P,r),T.append("line").attr("class",D).attr("x1",w).attr("y1",b).attr("x2",w).attr("y2",S).attr("stroke",i).attr(P,u),T.append("line").attr("class",D).attr("x1",y).attr("y1",b).attr("x2",y).attr("y2",S).attr("stroke",i).attr(P,u),T.append("line").attr("class",D).attr("x1",w).attr("y1",0).attr("x2",y).attr("y2",0).attr("stroke",i).attr(P,u),T.append("line").attr("class",D).attr("x1",-f).attr("y1",0).attr("x2",-f+l).attr("y2",0).attr("stroke",i).attr(P,u),T.append("line").attr("class",D).attr("x1",f-l).attr("y1",0).attr("x2",f).attr("y2",0).attr("stroke",i).attr(P,u),U.node()}function EJe(){const t=document.querySelector(`#${Uw}`);t.innerHTML="";const e=document.createElement("div"),i=document.createElement("a");i.href="https://courthive.com",i.target="_blank";const r=PJe({color:"#000000",maxWidth:"300px"});i.appendChild(r),e.appendChild(i);const n=document.createElement("h1");n.className="name",n.textContent="CourtHive",e.appendChild(n),t.appendChild(e)}function RE(t){cme.forEach(e=>{const i=document.querySelector(`#${e}`);i&&(i.style.display=e===t?"block":"none")})}var RJe=/([:*])(\w+)/g,CJe="([^/]+)",MJe=/\*/g,NJe="?(?:.*)",AJe=/\/\?/g,kJe="/?([^/]+|)",OJe="(?:/^|^)",xJe="";function zfe(t){return t===void 0&&(t="/"),wH()?location.pathname+location.search+location.hash:t}function Vr(t){return t.replace(/\/+$/,"").replace(/^\/+/,"")}function CE(t){return typeof t=="string"}function FJe(t){return typeof t=="function"}function ME(t){return t&&t.indexOf("#")>=0&&t.split("#").pop()||""}function LJe(t,e){return e.length===0||!t?null:t.slice(1,t.length).reduce(function(i,r,n){return i===null&&(i={}),i[e[n]]=decodeURIComponent(r),i},null)}function NE(t){var e=Vr(t).split(/\?(.*)?$/);return[Vr(e[0]),e.slice(1).join("")]}function bH(t){for(var e={},i=t.split("&"),r=0;r<i.length;r++){var n=i[r].split("=");if(n[0]!==""){var a=decodeURIComponent(n[0]);e[a]?(Array.isArray(e[a])||(e[a]=[e[a]]),e[a].push(decodeURIComponent(n[1]||""))):e[a]=decodeURIComponent(n[1]||"")}}return e}function qfe(t,e){var i=NE(Vr(t.currentLocationPath)),r=i[0],n=i[1],a=n===""?null:bH(n),s=[],o;if(CE(e.path)){if(o=OJe+Vr(e.path).replace(RJe,function(d,p,f){return s.push(f),CJe}).replace(MJe,NJe).replace(AJe,kJe)+"$",Vr(e.path)===""&&Vr(r)==="")return{url:r,queryString:n,hashString:ME(t.to),route:e,data:null,params:a}}else o=e.path;var l=new RegExp(o,xJe),u=r.match(l);if(u){var c=CE(e.path)?LJe(u,s):u.groups?u.groups:u.slice(1);return{url:Vr(r.replace(new RegExp("^"+t.instance.root),"")),queryString:n,hashString:ME(t.to),route:e,data:c,params:a}}return!1}function Yfe(){return!!(typeof window<"u"&&window.history&&window.history.pushState)}function ig(t,e){return typeof t[e]>"u"||t[e]===!0}function _Je(t){if(!t)return{};var e=t.split(","),i={},r;return e.forEach(function(n){var a=n.split(":").map(function(s){return s.replace(/(^ +| +$)/g,"")});switch(a[0]){case"historyAPIMethod":i.historyAPIMethod=a[1];break;case"resolveOptionsStrategy":r||(r={}),r.strategy=a[1];break;case"resolveOptionsHash":r||(r={}),r.hash=a[1]==="true";break;case"updateBrowserURL":case"callHandler":case"updateState":case"force":i[a[0]]=a[1]==="true";break}}),r&&(i.resolveOptions=r),i}function wH(){return typeof window<"u"}function $Je(t,e){return t===void 0&&(t=[]),e===void 0&&(e={}),t.filter(function(i){return i}).forEach(function(i){["before","after","already","leave"].forEach(function(r){i[r]&&(e[r]||(e[r]=[]),e[r].push(i[r]))})}),e}function Ku(t,e,i){var r=e||{},n=0;(function a(){if(!t[n]){i&&i(r);return}Array.isArray(t[n])?(t.splice.apply(t,[n,1].concat(t[n][0](r)?t[n][1]:t[n][2])),a()):t[n](r,function(s){typeof s>"u"||s===!0?(n+=1,a()):i&&i(r)})})()}Ku.if=function(t,e,i){return Array.isArray(e)||(e=[e]),Array.isArray(i)||(i=[i]),[t,e,i]};function PY(t,e){typeof t.currentLocationPath>"u"&&(t.currentLocationPath=t.to=zfe(t.instance.root)),t.currentLocationPath=t.instance._checkForAHash(t.currentLocationPath),e()}function Nk(t,e){for(var i=0;i<t.instance.routes.length;i++){var r=t.instance.routes[i],n=qfe(t,r);if(n&&(t.matches||(t.matches=[]),t.matches.push(n),t.resolveOptions.strategy==="ONE")){e();return}}e()}function BJe(t,e){t.navigateOptions&&(typeof t.navigateOptions.shouldResolve<"u"&&console.warn('"shouldResolve" is deprecated. Please check the documentation.'),typeof t.navigateOptions.silent<"u"&&console.warn('"silent" is deprecated. Please check the documentation.')),e()}function VJe(t,e){t.navigateOptions.force===!0?(t.instance._setCurrent([t.instance._pathToMatchObject(t.to)]),e(!1)):e()}var EY=wH(),jJe=Yfe();function GJe(t,e){if(ig(t.navigateOptions,"updateBrowserURL")){var i=("/"+t.to).replace(/\/\//g,"/"),r=EY&&t.resolveOptions&&t.resolveOptions.hash===!0;jJe?(history[t.navigateOptions.historyAPIMethod||"pushState"](t.navigateOptions.stateObj||{},t.navigateOptions.title||"",r?"#"+i:i),location&&location.hash&&(t.instance.__freezeListening=!0,setTimeout(function(){if(!r){var n=location.hash;location.hash="",location.hash=n}t.instance.__freezeListening=!1},1))):EY&&(window.location.href=t.to)}e()}function Kfe(t,e){var i=t.instance;if(!i.lastResolved()){e();return}Ku(i.lastResolved().map(function(r){return function(n,a){if(!r.route.hooks||!r.route.hooks.leave){a();return}var s=!1,o=t.instance.matchLocation(r.route.path,t.currentLocationPath,!1);if(r.route.path!=="*")s=!o;else{var l=t.matches?t.matches.find(function(u){return r.route.path===u.route.path}):!1;s=!l}if(ig(t.navigateOptions,"callHooks")&&s){Ku(r.route.hooks.leave.map(function(u){return function(c,d){return u(function(p){p===!1?t.instance.__markAsClean(t):d()},t.matches&&t.matches.length>0?t.matches.length===1?t.matches[0]:t.matches:void 0)}}).concat([function(){return a()}]));return}else a()}}),{},function(){return e()})}function HJe(t,e){t.match.route.hooks&&t.match.route.hooks.before&&ig(t.navigateOptions,"callHooks")?Ku(t.match.route.hooks.before.map(function(i){return function(n,a){return i(function(s){s===!1?t.instance.__markAsClean(t):a()},t.match)}}).concat([function(){return e()}])):e()}function WJe(t,e){ig(t.navigateOptions,"callHandler")&&t.match.route.handler(t.match),t.instance.updatePageLinks(),e()}function zJe(t,e){t.match.route.hooks&&t.match.route.hooks.after&&ig(t.navigateOptions,"callHooks")&&t.match.route.hooks.after.forEach(function(i){return i(t.match)}),e()}function qJe(t,e){var i=t.instance.lastResolved();if(i&&i[0]&&i[0].route===t.match.route&&i[0].url===t.match.url&&i[0].queryString===t.match.queryString){i.forEach(function(r){r.route.hooks&&r.route.hooks.already&&ig(t.navigateOptions,"callHooks")&&r.route.hooks.already.forEach(function(n){return n(t.match)})}),e(!1);return}e()}function YJe(t,e){var i=t.instance._notFoundRoute;if(i){t.notFoundHandled=!0;var r=NE(t.currentLocationPath),n=r[0],a=r[1],s=ME(t.to);i.path=Vr(n);var o={url:i.path,queryString:a,hashString:s,data:null,route:i,params:a!==""?bH(a):null};t.matches=[o],t.match=o}e()}function KJe(t,e){(!t.resolveOptions||t.resolveOptions.noMatchWarning===!1||typeof t.resolveOptions.noMatchWarning>"u")&&console.warn('Navigo: "'+t.currentLocationPath+`" didn't match any of the registered routes.`),e()}function XJe(t,e){t.instance._setCurrent(null),e()}function Xfe(t,e){ig(t.navigateOptions,"updateState")&&t.instance._setCurrent(t.matches),e()}var Jfe=[qJe,HJe,WJe,zJe],RY=[Kfe,YJe,Ku.if(function(t){var e=t.notFoundHandled;return e},Jfe.concat([Xfe]),[KJe,XJe])];function v1(){return v1=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(t[r]=i[r])}return t},v1.apply(this,arguments)}function CY(t,e){var i=0;function r(){if(i===t.matches.length){Xfe(t,e);return}Ku(Jfe,v1({},t,{match:t.matches[i]}),function(){i+=1,r()})}Kfe(t,r)}function Ak(t){t.instance.__markAsClean(t)}function y1(){return y1=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(t[r]=i[r])}return t},y1.apply(this,arguments)}var MY="[data-navigo]";function JJe(t,e){var i=e||{strategy:"ONE",hash:!1,noMatchWarning:!1,linksSelector:MY},r=this,n="/",a=null,s=[],o=!1,l,u=Yfe(),c=wH();t?n=Vr(t):console.warn('Navigo requires a root path in its constructor. If not provided will use "/" as default.');function d(x){return x.indexOf("#")>=0&&(i.hash===!0?x=x.split("#")[1]||"/":x=x.split("#")[0]),x}function p(x){return Vr(n+"/"+Vr(x))}function f(x,L,$,V){return x=CE(x)?p(x):x,{name:V||Vr(String(x)),path:x,handler:L,hooks:$Je($)}}function m(x,L,$){var V=this;return typeof x=="object"&&!(x instanceof RegExp)?(Object.keys(x).forEach(function(_){if(typeof x[_]=="function")V.on(_,x[_]);else{var B=x[_],G=B.uses,j=B.as,K=B.hooks;s.push(f(_,G,[l,K],j))}}),this):(typeof x=="function"&&($=L,L=x,x=n),s.push(f(x,L,[l,$])),this)}function h(x,L){if(r.__dirty){r.__waiting.push(function(){return r.resolve(x,L)});return}else r.__dirty=!0;x=x?Vr(n)+"/"+Vr(x):void 0;var $={instance:r,to:x,currentLocationPath:x,navigateOptions:{},resolveOptions:y1({},i,L)};return Ku([PY,Nk,Ku.if(function(V){var _=V.matches;return _&&_.length>0},CY,RY)],$,Ak),$.matches?$.matches:!1}function g(x,L){if(r.__dirty){r.__waiting.push(function(){return r.navigate(x,L)});return}else r.__dirty=!0;x=Vr(n)+"/"+Vr(x);var $={instance:r,to:x,navigateOptions:L||{},resolveOptions:L&&L.resolveOptions?L.resolveOptions:i,currentLocationPath:d(x)};Ku([BJe,VJe,Nk,Ku.if(function(V){var _=V.matches;return _&&_.length>0},CY,RY),GJe,Ak],$,Ak)}function I(x,L,$){var V=E(x,L);return V!==null?(g(V.replace(new RegExp("^/?"+n),""),$),!0):!1}function v(x){return this.routes=s=s.filter(function(L){return CE(x)?Vr(L.path)!==Vr(x):FJe(x)?x!==L.handler:String(L.path)!==String(x)}),this}function w(){u&&(this.__popstateListener=function(){r.__freezeListening||h()},window.addEventListener("popstate",this.__popstateListener))}function y(){this.routes=s=[],u&&window.removeEventListener("popstate",this.__popstateListener),this.destroyed=o=!0}function b(x,L){return r._notFoundRoute=f("*",x,[l,L],"__NOT_FOUND__"),this}function S(){if(c)return U().forEach(function(x){if(x.getAttribute("data-navigo")==="false"||x.getAttribute("target")==="_blank"){x.hasListenerAttached&&x.removeEventListener("click",x.navigoHandler);return}x.hasListenerAttached||(x.hasListenerAttached=!0,x.navigoHandler=function(L){if((L.ctrlKey||L.metaKey)&&L.target.tagName.toLowerCase()==="a")return!1;var $=x.getAttribute("href");if(typeof $>"u"||$===null)return!1;if($.match(/^(http|https)/)&&typeof URL<"u")try{var V=new URL($);$=V.pathname+V.search}catch{}var _=_Je(x.getAttribute("data-navigo-options"));o||(L.preventDefault(),L.stopPropagation(),r.navigate(Vr($),_))},x.addEventListener("click",x.navigoHandler))}),r}function U(){return c?[].slice.call(document.querySelectorAll(i.linksSelector||MY)):[]}function T(x){return"/"+n+"/"+Vr(x)}function P(x){return l=x,this}function D(){return a}function E(x,L,$){var V=s.find(function(G){return G.name===x}),_=null;if(V){if(_=V.path,L)for(var B in L)_=_.replace(":"+B,L[B]);_=_.match(/^\//)?_:"/"+_}return _&&$&&!$.includeRoot&&(_=_.replace(new RegExp("^/"+n),"")),_}function R(x){return x.getAttribute("href")}function C(x){var L=NE(Vr(x)),$=L[0],V=L[1],_=V===""?null:bH(V),B=ME(x),G=f($,function(){},[l],$);return{url:$,queryString:V,hashString:B,route:G,data:null,params:_}}function M(){return C(Vr(zfe(n)).replace(new RegExp("^"+n),""))}function N(x){var L={instance:r,currentLocationPath:x,to:x,resolveOptions:i};return Nk(L,function(){}),L.matches?L.matches:!1}function A(x,L,$){typeof L<"u"&&(typeof $>"u"||$)&&(L=p(L));var V={instance:r,to:L,currentLocationPath:L};PY(V,function(){}),typeof x=="string"&&(x=typeof $>"u"||$?p(x):x);var _=qfe(V,{name:String(x),path:x,handler:function(){},hooks:{}});return _||!1}function O(x,L,$){return typeof L=="string"&&(L=k(L)),L?(L.hooks[x]||(L.hooks[x]=[]),L.hooks[x].push($),function(){L.hooks[x]=L.hooks[x].filter(function(V){return V!==$})}):(console.warn("Route doesn't exists: "+L),function(){})}function k(x){return typeof x=="string"?s.find(function(L){return L.name===p(x)}):s.find(function(L){return L.handler===x})}function F(x){x.instance.__dirty=!1,x.instance.__waiting.length>0&&x.instance.__waiting.shift()()}this.root=n,this.routes=s,this.destroyed=o,this.current=a,this.__freezeListening=!1,this.__waiting=[],this.__dirty=!1,this.__markAsClean=F,this.on=m,this.off=v,this.resolve=h,this.navigate=g,this.navigateByName=I,this.destroy=y,this.notFound=b,this.updatePageLinks=S,this.link=T,this.hooks=P,this.extractGETParameters=function(x){return NE(d(x))},this.lastResolved=D,this.generate=E,this.getLinkPath=R,this.match=N,this.matchLocation=A,this.getCurrentLocation=M,this.addBeforeHook=O.bind(this,"before"),this.addAfterHook=O.bind(this,"after"),this.addAlreadyHook=O.bind(this,"already"),this.addLeaveHook=O.bind(this,"leave"),this.getRoute=k,this._pathToMatchObject=C,this._clean=Vr,this._checkForAHash=d,this._setCurrent=function(x){return a=r.current=x},w.call(this),S.call(this)}function gg({tournamentId:t,eventId:e,drawId:i,structureId:r,tab:n}){const a=document.getElementById("back");a.style.display="block",dd.tournamentId=t,delete dd.tab,RE(AE),kee({tournamentId:t}).then(s=>V9e(s,{eventId:e,drawId:i,structureId:r,tab:n}))}function Hg({tournamentId:t,eventId:e,drawId:i,structureId:r,tab:n}){let a=`/tournament/${t}`;n==="Schedule"?a+="/schedule":n==="Events"?a+="/events":(e&&(a+=`/event/${e}`),i&&(a+=`/draw/${i}`),r&&(a+=`/structure/${r}`)),history.pushState(null,"",`#${a}`)}function QJe(){const e=new JJe("/",{hash:!0});dd.router=e;const i=document.getElementById("back");return e.on("/",()=>{console.log("[router] matched: / (splash)"),i.style.display="none",RE(Uw),EJe()}),e.on("/tournaments/:providerAbbr",r=>{console.log("[router] matched: /tournaments/:providerAbbr",r?.data),i.style.display="none";const n=r?.data?.providerAbbr?.toUpperCase();RE(U1),$9e({providerAbbr:n})}),e.on("/tournament/:tournamentId/event/:eventId/draw/:drawId/structure/:structureId",r=>{console.log("[router] matched: /tournament/.../structure/:structureId",r?.data),gg({tournamentId:r?.data?.tournamentId,eventId:r?.data?.eventId,drawId:r?.data?.drawId,structureId:r?.data?.structureId})}),e.on("/tournament/:tournamentId/event/:eventId/draw/:drawId",r=>{console.log("[router] matched: /tournament/.../draw/:drawId",r?.data),gg({tournamentId:r?.data?.tournamentId,eventId:r?.data?.eventId,drawId:r?.data?.drawId})}),e.on("/tournament/:tournamentId/event/:eventId",r=>{console.log("[router] matched: /tournament/.../event/:eventId",r?.data),gg({tournamentId:r?.data?.tournamentId,eventId:r?.data?.eventId})}),e.on("/tournament/:tournamentId/events",r=>{gg({tournamentId:r?.data?.tournamentId,tab:"Events"})}),e.on("/tournament/:tournamentId/schedule",r=>{gg({tournamentId:r?.data?.tournamentId,tab:"Schedule"})}),e.on("/tournament/:tournamentId",r=>{gg({tournamentId:r?.data?.tournamentId})}),e.notFound(r=>{console.log("[router] notFound â url:",r?.url,"hashString:",r?.hashString,"data:",r?.data),e.navigate("/")}),e.resolve(),window.addEventListener("hashchange",()=>e.resolve()),e}const b1=["Info","Events","Schedule","Matches","Players","Stats"];let kk=!1;function Qfe(t,e){if(e?.updateUrl){if(kk)return;kk=!0,requestAnimationFrame(()=>{kk=!1})}if(t==="Schedule"&&mOe({tournamentId:dd.tournamentId,hydrateParticipants:!1}).then(r=>{OAe({data:r?.data})}),dd.tab=t,b1.forEach(i=>{const r=document.getElementById(ab(i));r.style.display=i===t?"block":"none"}),e?.updateUrl){const i=dd.tournamentId;Hg(t==="Schedule"?{tournamentId:i,tab:"Schedule"}:t==="Events"?{tournamentId:i,tab:"Events"}:{tournamentId:i})}}function Ok(t){const e=document.getElementById(IH(t));e.style.display="block"}function xk(t){const e=document.getElementById(IH(t));e.style.display=Go}const ZJe=()=>{const t=document.createElement("div");t.className="container";const e=document.createElement("section");e.className="hero";const i=document.createElement("div");i.className="hero-body",i.id="tournament-hero";const r=document.createElement("div");r.className="columns";const n=document.createElement("div");n.className="column is-one-quarter has-text-centered",n.id=LY,r.appendChild(n);const a=document.createElement("div");a.className="column has-text-centered",a.id=xY,r.appendChild(a),i.appendChild(r),e.appendChild(i),t.appendChild(e);const s=document.createElement("div"),o=document.createElement("div");t.appendChild(s),t.appendChild(o),b1.forEach(u=>{const c=document.createElement("section");c.className="section is-fluid is-centered",c.style.display="none",c.style.width="100%",c.id=ab(u),o.appendChild(c)}),s.className="tabs is-centered";const l=document.createElement("ul");return b1.forEach(u=>{const c=document.createElement("li");c.id=IH(u),c.style.display="none",c.className="menu";const d=document.createElement("a");d.textContent=u,d.onclick=()=>Qfe(u,{updateUrl:!0}),c.appendChild(d),l.appendChild(c)}),s.appendChild(l),t},Zfe="chp_theme";let NY=null;function eme(t){return t==="system"?globalThis.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light":t}function w1(t){const e=eme(t);document.documentElement.dataset.theme=e,localStorage.setItem(Zfe,t)}function eQe(){const t=S1();w1(t),NY=globalThis.matchMedia("(prefers-color-scheme: dark)"),NY.addEventListener("change",()=>{S1()==="system"&&w1("system")})}function tQe(){const t=eme(S1());w1(t==="light"?"dark":"light")}function S1(){return localStorage.getItem(Zfe)??"light"}function iQe(){const t=document.createElement("div");t.className="main noselect";const e=document.createElement("nav");e.className="navbar";const i=document.createElement("div");i.className="navbar-brand";const r=document.createElement("div");r.onclick=()=>globalThis.history.back(),r.className="navbar-item",r.innerHTML="<<",r.id="back";const n=document.createElement("div");n.className="navbar-end";const a=document.createElement("button");a.className="navbar-item theme-toggle",a.title="Toggle dark mode";const s=()=>{const p=document.documentElement.dataset.theme==="dark";a.textContent=p?"â":"â¾"};s(),a.onclick=()=>{tQe(),s()},n.appendChild(a),i.appendChild(r),e.appendChild(i),e.appendChild(n),t.appendChild(e);const o=document.createElement("div");o.style.display="none",o.id=Uw;const l=document.createElement("div");l.style.display="none",l.id=U1;const u=document.createElement("div");u.className="controlBar flexcol flexgrow flexcenter",u.id=FY,l.appendChild(u);const c=document.createElement("div");c.className="flexcol flexgrow flexcenter box",c.id=$k,l.appendChild(c);const d=document.createElement("div");return d.style.display="none",d.id=AE,d.appendChild(ZJe()),t.appendChild(l),t.appendChild(d),t.appendChild(o),t}function rQe(t){for(const e of Array.from(document.querySelectorAll(".tmx-tm")).filter(i=>i.innerHTML===t.innerHTML)){const i=e;i.style.fontWeight="bold",i.style.color="#ed0c76"}}function nQe(t){for(const e of Array.from(document.querySelectorAll(".tmx-tm")).filter(i=>i.innerHTML===t.innerHTML)){const i=e;i.style.fontWeight="",i.style.color=""}}const AY=(function(){let t,e={elapsed:1e5,held:void 0,touched:void 0,holdTime:800,holdAction:void 0,holdActions:{}};const i={};let r={};const n=(d,p)=>d.filter(f=>p.indexOf(f)!==-1).filter((f,m,h)=>h.indexOf(f)===m);e.reset=()=>(r={},e),e.register=(d,p,f,m)=>(typeof f=="function"&&(r[p]||(r[p]={},i[p]=[]),r[p][d]={fx:f,delay:m},i[p]=Object.keys(r[p])),e),e.deRegister=(d,p)=>(r[p]&&(delete r[p][d],i[p]=Object.keys(r[p])),e),e.call=(d,p,...f)=>r?.[p]?.[d]?.fx(...f),e.trigger=(d,p,f,m)=>r[p][d].fx(f,m,p),e.list=()=>console.log(r);const a="ontouchstart"in document.documentElement?"touchstart":"click";document.addEventListener(a,d=>o({evt:d,evnt:"tap"})),document.addEventListener("change",d=>o({evt:d,evnt:"change"})),document.addEventListener("click",d=>o({evt:d,evnt:"click"})),document.addEventListener("mouseover",d=>o({evt:d,evnt:"mouseover",stopPropagation:!1})),document.addEventListener("mouseout",d=>o({evt:d,evnt:"mouseout",stopPropagation:!1})),document.addEventListener("keyup",d=>o({evt:d,evnt:"keyup",stopPropagation:!1}));let s=0;function o({evt:d,evnt:p,stopPropagation:f=!0}){f&&d.stopPropagation();const m={x:d.clientX,y:d.clientY,pageX:d.pageX,pageY:d.pageY};let h=Array.from(d.target.classList),g=h.length&&i[p]?n(h,i[p]):[];if(g.length){let I=new Date().getTime();e.elapsed=I-s,s=I,g.forEach(v=>{l({cls:v,evt:d,evnt:p,mouse:m})})}}function l({cls:d,evt:p,evnt:f,mouse:m}){let h=p.target;r[f][d].fx(h,m,f,p)}document.addEventListener("touchstart",d=>{e.touched=d.target,e.coords=[d.touches[0].clientX,d.touches[0].clientY],e.touched&&(t=setTimeout(function(){c()},e.holdTime))},!1),document.addEventListener("touchend",function(){u()},!1),document.addEventListener("touchmove",function(d){e.touched!==d.target&&u()},!1);function u(){clearTimeout(t)}function c(){typeof e.holdAction=="function"&&(e.held=e.touched,e.holdAction(e.held,e.coords))}return(function(){let d=!1,p,f="";function m(){clearTimeout(p),d=!0,f!=="can-touch"&&(f="can-touch",document.documentElement.classList.add(f)),p=setTimeout(function(){d=!1},500)}function h(){!d&&f==="can-touch"&&(d=!1,f="",document.documentElement.classList.remove("can-touch"))}document.addEventListener("touchstart",m,!1),document.addEventListener("mouseover",h,!1)})(),e})();function aQe(){if(!window.dev)console.log("%c dev initialized","color: yellow"),window.dev={};else return;const t=i=>r=>i(r).then(n=>console.log(n.data),n=>console.log(n));sQe({...{getServerFactoryVersion:i=>t(hOe)(i),getProviderCalendar:i=>t(KO)(i),getTournamentInfo:i=>t(kee)(i),getEventData:i=>t(Oee(i))},baseApi:Pv,context:dd})}function sQe(t){if(typeof window?.dev=="object")try{Object.keys(t).forEach(e=>window.dev[e]=t[e])}catch{console.log("production environment")}}function oQe(){document.oncontextmenu=()=>!1,window.addEventListener("contextmenu",t=>{t.preventDefault()},!1),window.onunhandledrejection=t=>{t.preventDefault();const e=t.reason,i=e&&(e.stack||e);i&&i.indexOf("blocked")>0?console.warn("popup blocked"):console.warn("Unhandled rejection:",e&&(e.stack||e))}}const lQe="@VERSION@";const Fk=typeof navigator<"u"?navigator.userAgent.toLowerCase().indexOf("firefox")>0:!1;function Lk(t,e,i,r){t.addEventListener?t.addEventListener(e,i,r):t.attachEvent&&t.attachEvent(`on${e}`,i)}function vy(t,e,i,r){t&&(t.removeEventListener?t.removeEventListener(e,i,r):t.detachEvent&&t.detachEvent(`on${e}`,i))}function tme(t,e){const i=e.slice(0,e.length-1),r=[];for(let n=0;n<i.length;n++)r.push(t[i[n].toLowerCase()]);return r}function ime(t){typeof t!="string"&&(t=""),t=t.replace(/\s/g,"");const e=t.split(",");let i=e.lastIndexOf("");for(;i>=0;)e[i-1]+=",",e.splice(i,1),i=e.lastIndexOf("");return e}function uQe(t,e){const i=t.length>=e.length?t:e,r=t.length>=e.length?e:t;let n=!0;for(let a=0;a<i.length;a++)r.indexOf(i[a])===-1&&(n=!1);return n}function rme(t){let e=t.keyCode||t.which||t.charCode;return t.code&&/^Key[A-Z]$/.test(t.code)&&(e=t.code.charCodeAt(3)),e}const ww={backspace:8,"â«":8,tab:9,clear:12,enter:13,"â©":13,return:13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,arrowup:38,arrowdown:40,arrowleft:37,arrowright:39,del:46,delete:46,ins:45,insert:45,home:36,end:35,pageup:33,pagedown:34,capslock:20,num_0:96,num_1:97,num_2:98,num_3:99,num_4:100,num_5:101,num_6:102,num_7:103,num_8:104,num_9:105,num_multiply:106,num_add:107,num_enter:108,num_subtract:109,num_decimal:110,num_divide:111,"âª":20,",":188,".":190,"/":191,"`":192,"-":Fk?173:189,"=":Fk?61:187,";":Fk?59:186,"'":222,"{":219,"}":221,"[":219,"]":221,"\\":220},tl={"â§":16,shift:16,"â¥":18,alt:18,option:18,"â":17,ctrl:17,control:17,"â":91,cmd:91,meta:91,command:91},Ry={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey",shiftKey:16,ctrlKey:17,altKey:18,metaKey:91},Ln={16:!1,18:!1,17:!1,91:!1},Yr={};for(let t=1;t<20;t++)ww[`f${t}`]=111+t;let Tr=[],sb=null,Fg=null,nme="all";const Qc=new Map,oy=t=>ww[t.toLowerCase()]||tl[t.toLowerCase()]||t.toUpperCase().charCodeAt(0),cQe=t=>Object.keys(ww).find(e=>ww[e]===t),dQe=t=>Object.keys(tl).find(e=>tl[e]===t),ame=t=>{nme=t||"all"},Sw=()=>nme||"all",pQe=()=>Tr.slice(0),fQe=()=>Tr.map(t=>cQe(t)||dQe(t)||String.fromCharCode(t)),mQe=()=>{const t=[];return Object.keys(Yr).forEach(e=>{Yr[e].forEach(({key:i,scope:r,mods:n,shortcut:a})=>{t.push({scope:r,shortcut:a,mods:n,keys:i.split("+").map(s=>oy(s))})})}),t},sme=t=>{const e=t.target||t.srcElement,{tagName:i}=e;let r=!0;const n=i==="INPUT"&&!["checkbox","radio","range","button","file","reset","submit","color"].includes(e.type);return(e.isContentEditable||(n||i==="TEXTAREA"||i==="SELECT")&&!e.readOnly)&&(r=!1),r},hQe=t=>(typeof t=="string"&&(t=oy(t)),Tr.indexOf(t)!==-1),gQe=(t,e)=>{let i,r;t||(t=Sw());for(const n in Yr)if(Object.prototype.hasOwnProperty.call(Yr,n))for(i=Yr[n],r=0;r<i.length;)i[r].scope===t?i.splice(r,1).forEach(({element:s})=>SH(s)):r++;Sw()===t&&ame(e||"all")};function IQe(t){let e=rme(t);t.key&&t.key.toLowerCase()==="capslock"&&(e=oy(t.key));const i=Tr.indexOf(e);if(i>=0&&Tr.splice(i,1),t.key&&t.key.toLowerCase()==="meta"&&Tr.splice(0,Tr.length),(e===93||e===224)&&(e=91),e in Ln){Ln[e]=!1;for(const r in tl)tl[r]===e&&(zo[r]=!1)}}const ome=(t,...e)=>{if(typeof t>"u")Object.keys(Yr).forEach(i=>{Array.isArray(Yr[i])&&Yr[i].forEach(r=>VT(r)),delete Yr[i]}),SH(null);else if(Array.isArray(t))t.forEach(i=>{i.key&&VT(i)});else if(typeof t=="object")t.key&&VT(t);else if(typeof t=="string"){let[i,r]=e;typeof i=="function"&&(r=i,i=""),VT({key:t,scope:i,method:r,splitKey:"+"})}},VT=({key:t,scope:e,method:i,splitKey:r="+"})=>{ime(t).forEach(a=>{const s=a.split(r),o=s.length,l=s[o-1],u=l==="*"?"*":oy(l);if(!Yr[u])return;e||(e=Sw());const c=o>1?tme(tl,s):[],d=[];Yr[u]=Yr[u].filter(p=>{const m=(i?p.method===i:!0)&&p.scope===e&&uQe(p.mods,c);return m&&d.push(p.element),!m}),d.forEach(p=>SH(p))})};function kY(t,e,i,r){if(e.element!==r)return;let n;if(e.scope===i||e.scope==="all"){n=e.mods.length>0;for(const a in Ln)Object.prototype.hasOwnProperty.call(Ln,a)&&(!Ln[a]&&e.mods.indexOf(+a)>-1||Ln[a]&&e.mods.indexOf(+a)===-1)&&(n=!1);(e.mods.length===0&&!Ln[16]&&!Ln[18]&&!Ln[17]&&!Ln[91]||n||e.shortcut==="*")&&(e.keys=[],e.keys=e.keys.concat(Tr),e.method(t,e)===!1&&(t.preventDefault?t.preventDefault():t.returnValue=!1,t.stopPropagation&&t.stopPropagation(),t.cancelBubble&&(t.cancelBubble=!0)))}}function OY(t,e){const i=Yr["*"];let r=rme(t);if(t.key&&t.key.toLowerCase()==="capslock"||!(zo.filter||sme).call(this,t))return;if((r===93||r===224)&&(r=91),Tr.indexOf(r)===-1&&r!==229&&Tr.push(r),["metaKey","ctrlKey","altKey","shiftKey"].forEach(l=>{const u=Ry[l];t[l]&&Tr.indexOf(u)===-1?Tr.push(u):!t[l]&&Tr.indexOf(u)>-1?Tr.splice(Tr.indexOf(u),1):l==="metaKey"&&t[l]&&(Tr=Tr.filter(c=>c in Ry||c===r))}),r in Ln){Ln[r]=!0;for(const l in tl)if(Object.prototype.hasOwnProperty.call(tl,l)){const u=Ry[tl[l]];zo[l]=t[u]}if(!i)return}for(const l in Ln)Object.prototype.hasOwnProperty.call(Ln,l)&&(Ln[l]=t[Ry[l]]);t.getModifierState&&!(t.altKey&&!t.ctrlKey)&&t.getModifierState("AltGraph")&&(Tr.indexOf(17)===-1&&Tr.push(17),Tr.indexOf(18)===-1&&Tr.push(18),Ln[17]=!0,Ln[18]=!0);const a=Sw();if(i)for(let l=0;l<i.length;l++)i[l].scope===a&&(t.type==="keydown"&&i[l].keydown||t.type==="keyup"&&i[l].keyup)&&kY(t,i[l],a,e);if(!(r in Yr))return;const s=Yr[r],o=s.length;for(let l=0;l<o;l++)if((t.type==="keydown"&&s[l].keydown||t.type==="keyup"&&s[l].keyup)&&s[l].key){const u=s[l],{splitKey:c}=u,d=u.key.split(c),p=[];for(let f=0;f<d.length;f++)p.push(oy(d[f]));p.sort().join("")===Tr.sort().join("")&&kY(t,u,a,e)}}const zo=function t(e,i,r){Tr=[];const n=ime(e);let a=[],s="all",o=document,l=0,u=!1,c=!0,d="+",p=!1,f=!1;if(r===void 0&&typeof i=="function"&&(r=i),Object.prototype.toString.call(i)==="[object Object]"){const m=i;m.scope&&(s=m.scope),m.element&&(o=m.element),m.keyup&&(u=m.keyup),m.keydown!==void 0&&(c=m.keydown),m.capture!==void 0&&(p=m.capture),typeof m.splitKey=="string"&&(d=m.splitKey),m.single===!0&&(f=!0)}for(typeof i=="string"&&(s=i),f&&ome(e,s);l<n.length;l++){const m=n[l].split(d);a=[],m.length>1&&(a=tme(tl,m));let h=m[m.length-1];h=h==="*"?"*":oy(h),h in Yr||(Yr[h]=[]),Yr[h].push({keyup:u,keydown:c,scope:s,mods:a,shortcut:n[l],method:r,key:n[l],splitKey:d,element:o})}if(typeof o<"u"&&typeof window<"u"){if(!Qc.has(o)){const m=(g=window.event)=>OY(g,o),h=(g=window.event)=>{OY(g,o),IQe(g)};Qc.set(o,{keydownListener:m,keyupListenr:h,capture:p}),Lk(o,"keydown",m,p),Lk(o,"keyup",h,p)}if(!sb){const m=()=>{Tr=[]};sb={listener:m,capture:p},Lk(window,"focus",m,p)}if(!Fg&&typeof document<"u"){const m=()=>{Tr=[];for(const I in Ln)Ln[I]=!1;for(const I in tl)t[I]=!1},h=m,g=m;document.addEventListener("fullscreenchange",h),document.addEventListener("webkitfullscreenchange",g),Fg={fullscreen:h,webkit:g}}}};function vQe(t,e="all"){Object.keys(Yr).forEach(i=>{Yr[i].filter(n=>n.scope===e&&n.shortcut===t).forEach(n=>{n&&n.method&&n.method({},n)})})}function SH(t){const e=Object.values(Yr).flat();if(e.findIndex(({element:r})=>r===t)<0&&t){const{keydownListener:r,keyupListenr:n,capture:a}=Qc.get(t)||{};r&&n&&(vy(t,"keyup",n,a),vy(t,"keydown",r,a),Qc.delete(t))}if(e.length<=0||Qc.size<=0){if(Array.from(Qc.keys()).forEach(n=>{const{keydownListener:a,keyupListenr:s,capture:o}=Qc.get(n)||{};a&&s&&(vy(n,"keyup",s,o),vy(n,"keydown",a,o),Qc.delete(n))}),Qc.clear(),Object.keys(Yr).forEach(n=>delete Yr[n]),sb){const{listener:n,capture:a}=sb;vy(window,"focus",n,a),sb=null}Fg&&typeof document<"u"&&(document.removeEventListener("fullscreenchange",Fg.fullscreen),document.removeEventListener("webkitfullscreenchange",Fg.webkit),Fg=null)}}const _k={getPressedKeyString:fQe,setScope:ame,getScope:Sw,deleteScope:gQe,getPressedKeyCodes:pQe,getAllKeyCodes:mQe,isPressed:hQe,filter:sme,trigger:vQe,unbind:ome,keyMap:ww,modifier:tl,modifierMap:Ry};for(const t in _k){const e=t;Object.prototype.hasOwnProperty.call(_k,e)&&(zo[e]=_k[e])}if(typeof window<"u"){const t=window.hotkeys;zo.noConflict=e=>(e&&window.hotkeys===zo&&(window.hotkeys=t),zo),window.hotkeys=zo}typeof Cy<"u"&&Cy.exports&&(Cy.exports=zo,Cy.exports.default=zo);const jT=[];function yQe(){eQe(),console.log(`%cversion: ${lQe}`,"color: lightblue"),zo("shift+1,shift+3,esc,/",(t,e)=>{t.preventDefault();const r=zo.shift?e.key.split(e.splitKey)[1]:e.key;r==="/"&&jT.splice(0,jT.length),jT.push(r),jT.join("")==="esc13"&&aQe()}),RE(Uw),oQe(),AY.register("tmx-tm","mouseover",rQe),AY.register("tmx-tm","mouseout",nQe)}const bQe=document.body;bQe.appendChild(iQe());yQe();dd.router=QJe()});export default wQe();
//# sourceMappingURL=index-FHY0-Uxs.js.map
